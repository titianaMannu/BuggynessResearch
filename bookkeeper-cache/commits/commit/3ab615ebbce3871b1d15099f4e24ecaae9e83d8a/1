{"sha":"3ab615ebbce3871b1d15099f4e24ecaae9e83d8a","node_id":"MDY6Q29tbWl0MTU3NTk1NjozYWI2MTVlYmJjZTM4NzFiMWQxNTA5OWY0ZTI0ZWNhYWU5ZTgzZDhh","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2012-12-18T05:48:26Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2012-12-18T05:48:26Z"},"message":"BOOKKEEPER-490: add documentation for MetaStore interface (sijie, ivank via sijie)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1423278 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"55741a88b48b8fc2f28b3dcf8852c0ed0a1255a1","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/55741a88b48b8fc2f28b3dcf8852c0ed0a1255a1"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a","html_url":"https://github.com/apache/bookkeeper/commit/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"a8d61e64604a6ea5ce6caccc5d29aea2abac69f3","url":"https://api.github.com/repos/apache/bookkeeper/commits/a8d61e64604a6ea5ce6caccc5d29aea2abac69f3","html_url":"https://github.com/apache/bookkeeper/commit/a8d61e64604a6ea5ce6caccc5d29aea2abac69f3"}],"stats":{"total":53,"additions":53,"deletions":0},"files":[{"sha":"8440e6d982dbce92c52b7a40409f98168fda33f5","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=3ab615ebbce3871b1d15099f4e24ecaae9e83d8a","patch":"@@ -260,6 +260,8 @@ Trunk (unreleased changes)\n \n         BOOKKEEPER-375: Document about Auto replication service in BK (umamahesh via ivank)\n \n+        BOOKKEEPER-490: add documentation for MetaStore interface (sijie, ivank via sijie)\n+\n       hedwig-server:\n \n         BOOKKEEPER-250: Need a ledger manager like interface to manage metadata operations in Hedwig (sijie via ivank)"},{"sha":"276067ff6a8aedfe2eaf87c9632e43e0084a8c44","filename":"doc/index.textile","status":"modified","additions":4,"deletions":0,"changes":4,"blob_url":"https://github.com/apache/bookkeeper/blob/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a/doc/index.textile","raw_url":"https://github.com/apache/bookkeeper/raw/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a/doc/index.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/index.textile?ref=3ab615ebbce3871b1d15099f4e24ecaae9e83d8a","patch":"@@ -45,3 +45,7 @@ h2. Hedwig Admin & Ops\n \n * \"Hedwig Console\":./hedwigConsole.html\n * \"Hedwig JMX\":./hedwigJMX.html\n+\n+h1. Metastore documentation\n+\n+* \"Metastore Interface\":./metastore.textile"},{"sha":"aa9d508e79e09fb42786943db41b4ee4ecb9e91a","filename":"doc/metastore.textile","status":"added","additions":47,"deletions":0,"changes":47,"blob_url":"https://github.com/apache/bookkeeper/blob/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a/doc/metastore.textile","raw_url":"https://github.com/apache/bookkeeper/raw/3ab615ebbce3871b1d15099f4e24ecaae9e83d8a/doc/metastore.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/metastore.textile?ref=3ab615ebbce3871b1d15099f4e24ecaae9e83d8a","patch":"@@ -0,0 +1,47 @@\n+Title:        Metastore Interface\n+Notice: Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License. You may\n+        obtain a copy of the License at \"http://www.apache.org/licenses/LICENSE-2.0\":http://www.apache.org/licenses/LICENSE-2.0.\n+        .\n+        .\n+        Unless required by applicable law or agreed to in writing,\n+        software distributed under the License is distributed on an \"AS IS\"\n+        BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+        implied. See the License for the specific language governing permissions\n+        and limitations under the License.\n+        .\n+        .\n+\n+h1. Metastore Interface\n+\n+Although Apache BookKeeper provides \"LedgerManager\":./bookkeeperMetadata.html and \"Hedwig Metadata Managers\":./hedwigMetadata.html for users to plugin different metadata storages for both BookKeeper and Hedwig, it is quite difficult to implement a correct and efficient manager version based on the knowledge for both projects. The __MetaStore__ interface extracts the commonality of the metadata storage interfaces and is provided for users to focus on adapting the underlying storage itself w/o having to worry about the detailed logic for BookKeeper and Hedwig.\n+\n+h2. MetaStore\n+\n+The __MetaStore__ interface provide users with access to __MetastoreTable__s used for BookKeeper and Hedwig metadata management. There are two kinds of table defined in a __MetaStore__, __MetastoreTable__ which provides basic __PUT__,__GET__,__REMOVE__,__SCAN__ operations and which does not assume any ordering requirements from the underlying storage; and __MetastoreScannableTable__ which is derived from __MetastoreTable__, but *does* assume that data is stored in key order in the underlying storage.\n+\n+* @getName@: Return the name of the __MetaStore__.\n+* @getVersion@: Return current __MetaStore__ plugin version.\n+* @init@: Initialize the __MetaStore__ library with the given configuration and its version.\n+* @close@: Close the __MetaStore__, freeing all resources. i.e. release all the open connections and occupied memory etc.\n+* @createTable@: Create a table instance to access the data stored in it. A table name is given to locate the table. An __MetastoreTable__ object is returned.\n+* @createScannableTable@: Similar as __createTable__, but returns __MetastoreScannableTable__ rather then __MetastoreTable__ object. If the underlying table is not an ordered table, __MetastoreException__ should be thrown.\n+\n+h2. MetaStore Table\n+\n+__MetastoreTable__ is a basic unit in a __MetaStore__, which is used to handle different types of metadata, i.e. A __MetastoreTable__ is used to store metadata for ledgers, while the other __MetastoreTable__ is used to store metadata for topic persistence info. The interface for a __MetastoreTable__ is quite simple:\n+\n+* @get@: Retrieve a entry by a given __key__. __OK__ and its current version in metadata storage is returned when succeed. __NoKey__ returned for a non-existent key. If __fields__ are specified, return only the specified fields for the key.\n+* @put@: Put the given __value__ associated with __key__ with given __version__. The value is only updated when the given __version__ equals the current version in metadata storage. A new __version__ should be returned when updated successfully. __NoKey__ is returned for a non-existent key, __BadVersion__ is returned when an update is attempted with a __version__ which does not match the one in the metadata store.\n+* @remove@: Remove the given __value__ associated with __key__. The value is only removed when the given __version__ equals its current version in metadata storage. __NoKey__ is returned for a non-existent key, __BadVersion__ is returned when remove is attempted with a __version__ which does not match.\n+* @openCursor@: Open a __cursor__ to iterate over all the entries of a table. The returned cursor doesn't need to guarantee any order and transaction.\n+\n+h2. MetaStore Scannable Table\n+\n+__MetastoreScannableTable__ is identical to a __MetastoreTable__ except that it provides an addition interface to iterate over entries in the table in key order.\n+\n+* @openCursor@: Open a __cursor__ to iterate over all the entries of a table between the key range of __firstKey__ and __lastKey__.\n+\n+h2. How to organize your metadata.\n+\n+Some metadata in Hedwig and BookKeeper does not need to be stored in the order of the ledger id or the topic. You could use kind of hash table to store metadata for them. These metadata are topic ownership and topic persistence info. Besides that, subscription state and ledger metadata must be stored in key order due to the current logic in Hedwig/BookKeeper."}]}

