{"sha":"42185c2e3d9e6d85b095842ac051f3a3c4a4d22f","node_id":"MDY6Q29tbWl0MTU3NTk1Njo0MjE4NWMyZTNkOWU2ZDg1YjA5NTg0MmFjMDUxZjNhM2M0YTRkMjJm","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2013-12-05T06:35:56Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2013-12-05T06:35:56Z"},"message":"BOOKKEEPER-712: bookkeeper script should use java from JAVA_HOME (vinay via sijie)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1548024 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"155af3b650c356bc32e587aa52720520e67c50e4","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/155af3b650c356bc32e587aa52720520e67c50e4"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f","html_url":"https://github.com/apache/bookkeeper/commit/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"810f10e9c628604a7697172df79478d9186be637","url":"https://api.github.com/repos/apache/bookkeeper/commits/810f10e9c628604a7697172df79478d9186be637","html_url":"https://github.com/apache/bookkeeper/commit/810f10e9c628604a7697172df79478d9186be637"}],"stats":{"total":21,"additions":15,"deletions":6},"files":[{"sha":"54b2f3d2ffd739d66c8a1906f3bde96c655d8395","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=42185c2e3d9e6d85b095842ac051f3a3c4a4d22f","patch":"@@ -128,6 +128,8 @@ Trunk (unreleased changes)\n \n         BOOKKEEPER-711: bookkeeper-daemon.sh will not remove the pid file one successful stop (vinay via sijie)\n \n+        BOOKKEEPER-712: bookkeeper script should use 'java' from JAVA_HOME (vinay via sijie)\n+\n       hedwig-server:\n \n         BOOKKEEPER-601: readahead cache size isn't updated correctly (sijie via fpj)"},{"sha":"a48110bdaba157744b8cf3dd65c7ddde295a598d","filename":"bookkeeper-server/bin/bookkeeper","status":"modified","additions":13,"deletions":6,"changes":19,"blob_url":"https://github.com/apache/bookkeeper/blob/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f/bookkeeper-server/bin/bookkeeper","raw_url":"https://github.com/apache/bookkeeper/raw/42185c2e3d9e6d85b095842ac051f3a3c4a4d22f/bookkeeper-server/bin/bookkeeper","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/bin/bookkeeper?ref=42185c2e3d9e6d85b095842ac051f3a3c4a4d22f","patch":"@@ -20,6 +20,13 @@\n # * limitations under the License.\n # */\n \n+# Check for the Java\n+if [[ -z $JAVA_HOME ]]; then\n+   echo \"Error: JAVA_HOME is not set\" 1>&2\n+   exit 1\n+fi\n+JAVA=$JAVA_HOME/bin/java\n+\n # check if net.ipv6.bindv6only is set to 1\n bindv6only=$(/sbin/sysctl -n net.ipv6.bindv6only 2> /dev/null)\n if [ -n \"$bindv6only\" ] && [ \"$bindv6only\" -eq \"1\" ]\n@@ -168,21 +175,21 @@ OPTS=\"$OPTS -Dbookkeeper.log.file=$BOOKIE_LOG_FILE\"\n #Change to BK_HOME to support relative paths\n cd \"$BK_HOME\"\n if [ $COMMAND == \"bookie\" ]; then\n-    exec java $OPTS $JMX_ARGS org.apache.bookkeeper.proto.BookieServer --conf $BOOKIE_CONF $@\n+    exec $JAVA $OPTS $JMX_ARGS org.apache.bookkeeper.proto.BookieServer --conf $BOOKIE_CONF $@\n elif [ $COMMAND == \"autorecovery\" ]; then\n-    exec java $OPTS $JMX_ARGS org.apache.bookkeeper.replication.AutoRecoveryMain --conf $BOOKIE_CONF $@\n+    exec $JAVA $OPTS $JMX_ARGS org.apache.bookkeeper.replication.AutoRecoveryMain --conf $BOOKIE_CONF $@\n elif [ $COMMAND == \"localbookie\" ]; then\n     NUMBER=$1\n     shift\n-    exec java $OPTS $JMX_ARGS org.apache.bookkeeper.util.LocalBookKeeper $NUMBER $BOOKIE_CONF $@\n+    exec $JAVA $OPTS $JMX_ARGS org.apache.bookkeeper.util.LocalBookKeeper $NUMBER $BOOKIE_CONF $@\n elif [ $COMMAND == \"upgrade\" ]; then\n-    exec java $OPTS org.apache.bookkeeper.bookie.FileSystemUpgrade --conf $BOOKIE_CONF $@\n+    exec $JAVA $OPTS org.apache.bookkeeper.bookie.FileSystemUpgrade --conf $BOOKIE_CONF $@\n elif [ $COMMAND == \"shell\" ]; then\n     ENTRY_FORMATTER_ARG=\"-DentryFormatterClass=${ENTRY_FORMATTER_CLASS:-org.apache.bookkeeper.util.StringEntryFormatter}\"\n-    exec java $OPTS $ENTRY_FORMATTER_ARG org.apache.bookkeeper.bookie.BookieShell -conf $BOOKIE_CONF $@\n+    exec $JAVA $OPTS $ENTRY_FORMATTER_ARG org.apache.bookkeeper.bookie.BookieShell -conf $BOOKIE_CONF $@\n elif [ $COMMAND == \"help\" ]; then\n     bookkeeper_help;\n else\n-    exec java $OPTS $COMMAND $@\n+    exec $JAVA $OPTS $COMMAND $@\n fi\n "}]}

