{"sha":"49aa4df144abcd6b117ac376b71ac70a5af946b7","node_id":"MDY6Q29tbWl0MTU3NTk1Njo0OWFhNGRmMTQ0YWJjZDZiMTE3YWMzNzZiNzFhYzcwYTVhZjk0NmI3","commit":{"author":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2011-11-29T23:19:38Z"},"committer":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2011-11-29T23:19:38Z"},"message":"BOOKKEEPER-111: Document bookie recovery feature (ivank)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1208133 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"5010e91a73f42866f2f61b78481364a29cd657da","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/5010e91a73f42866f2f61b78481364a29cd657da"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/49aa4df144abcd6b117ac376b71ac70a5af946b7","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/49aa4df144abcd6b117ac376b71ac70a5af946b7","html_url":"https://github.com/apache/bookkeeper/commit/49aa4df144abcd6b117ac376b71ac70a5af946b7","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/49aa4df144abcd6b117ac376b71ac70a5af946b7/comments","author":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"committer":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"parents":[{"sha":"86040b51874dcb40d1693593942d975c8327e919","url":"https://api.github.com/repos/apache/bookkeeper/commits/86040b51874dcb40d1693593942d975c8327e919","html_url":"https://github.com/apache/bookkeeper/commit/86040b51874dcb40d1693593942d975c8327e919"}],"stats":{"total":43,"additions":43,"deletions":0},"files":[{"sha":"a461ac39a9c18dc4d916575722ad14d237211e78","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/49aa4df144abcd6b117ac376b71ac70a5af946b7/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/49aa4df144abcd6b117ac376b71ac70a5af946b7/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=49aa4df144abcd6b117ac376b71ac70a5af946b7","patch":"@@ -96,6 +96,8 @@ BUGFIXES:\n \n   BOOKKEEPER-62: Bookie can not start when encountering corrupted records (breed via ivank)\n \n+  BOOKKEEPER-111: Document bookie recovery feature (ivank)\n+\n  hedwig-server/\n \n   BOOKKEEPER-43: NullPointException when releasing topic (Sijie Guo via breed)"},{"sha":"3f409bad9a138c992271e321928b3cfe0adb6104","filename":"doc/bookieRecovery.textile","status":"added","additions":41,"deletions":0,"changes":41,"blob_url":"https://github.com/apache/bookkeeper/blob/49aa4df144abcd6b117ac376b71ac70a5af946b7/doc/bookieRecovery.textile","raw_url":"https://github.com/apache/bookkeeper/raw/49aa4df144abcd6b117ac376b71ac70a5af946b7/doc/bookieRecovery.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/bookieRecovery.textile?ref=49aa4df144abcd6b117ac376b71ac70a5af946b7","patch":"@@ -0,0 +1,41 @@\n+Title:     BookKeeper Bookie Recovery\n+Notice:    Licensed to the Apache Software Foundation (ASF) under one\n+           or more contributor license agreements.  See the NOTICE file\n+           distributed with this work for additional information\n+           regarding copyright ownership.  The ASF licenses this file\n+           to you under the Apache License, Version 2.0 (the\n+           \"License\"); you may not use this file except in compliance\n+           with the License.  You may obtain a copy of the License at\n+           .\n+             http://www.apache.org/licenses/LICENSE-2.0\n+           .\n+           Unless required by applicable law or agreed to in writing,\n+           software distributed under the License is distributed on an\n+           \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+           KIND, either express or implied.  See the License for the\n+           specific language governing permissions and limitations\n+           under the License.\n+\n+h1. Bookie Recovery\n+\n+p. When a bookie crashes, any ledgers with entries on the bookie potentially become underreplicated. For this reason, we provide a recovery tool which will ensure that all ledgers which had entries on the bookie are fully replicated. At the moment, this is not an automatic process. The administrator must run this tool manually when he sees that the bookie has died. \n+\n+To run recovery, with zk1.example.com as the zookeeper ensemble, and bk3.example.com as the failed bookie, do the following:\n+\n+@bookkeeper-server/bin/bookkeeper org.apache.bookkeeper.tools.BookKeeperTools zk1.example.com:2181 bk3.example.com:3181@\n+\n+It is necessary to specify the host and port portion of failed bookie, as this is how it identifies itself to zookeeper. It is possible to specify a third argument, which is the bookie to replicate to. If this is omitted, as in our example, a random bookie is chosen for each ledger fragment. A ledger fragment is a continous sequence of entries in a bookie, which share the same ensemble. \n+\n+The recovery process is as follows.\n+\n+# The client reads the metadata of active ledgers from zookeeper;\n+# From this, the ledgers which contain fragments using the failed bookie in their ensemble are selected;\n+# A recovery process is initiated for each ledger in this list;\n+## The client goes through all ledger fragments in the ledger, selecting those which contain the failed bookie;\n+## A recovery process is initiated for each ledger fragment in this list;\n+### The client selects a bookie to which all entries in the ledger fragment will be replicated;\n+### the client reads entries that belong to the ledger fragment from other bookies in the ensemble and writes them to the selected bookie;\n+### Once all entries have been replicated, the zookeeper metadata for the fragment is updated to reflect the new ensemble;\n+### The fragment is marked as fully replicated in the recovery tool;\n+## Once all ledger fragements are marked as fully replicated, the ledger is marked as fully replicated;\n+# Once all ledgers are marked as fully replicated, bookie recovery is finished.\n\\ No newline at end of file"}]}

