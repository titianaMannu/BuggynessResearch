{"sha":"4bb59f526340ba8efa82a36b72fa7414bc9d02a2","node_id":"MDY6Q29tbWl0MTU3NTk1Njo0YmI1OWY1MjYzNDBiYThlZmE4MmEzNmI3MmZhNzQxNGJjOWQwMmEy","commit":{"author":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2013-09-10T20:13:14Z"},"committer":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2013-09-10T20:13:14Z"},"message":"BOOKKEEPER-675: Log noise fixup before cutting 4.2.2 (ivank)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/branches/branch-4.2@1521624 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"582114bfe161b06be85a80504b7bc48a6be554ed","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/582114bfe161b06be85a80504b7bc48a6be554ed"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/4bb59f526340ba8efa82a36b72fa7414bc9d02a2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/4bb59f526340ba8efa82a36b72fa7414bc9d02a2","html_url":"https://github.com/apache/bookkeeper/commit/4bb59f526340ba8efa82a36b72fa7414bc9d02a2","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/comments","author":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"committer":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"parents":[{"sha":"e41c41102a509ed84a116e7789fc4a5c2f3c8609","url":"https://api.github.com/repos/apache/bookkeeper/commits/e41c41102a509ed84a116e7789fc4a5c2f3c8609","html_url":"https://github.com/apache/bookkeeper/commit/e41c41102a509ed84a116e7789fc4a5c2f3c8609"}],"stats":{"total":105,"additions":70,"deletions":35},"files":[{"sha":"b8106e6704b115981134ce84e0a6161a9f85589f","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -78,6 +78,8 @@ Release 4.2.2 - Unreleased\n \n         BOOKKEEPER-446: BookKeeper.createLedger(..) should not mask the error with ZKException (sijie via ivank)\n \n+        BOOKKEEPER-675: Log noise fixup before cutting 4.2.2 (ivank)\n+\n       hedwig-server:\n \n         BOOKKEEPER-579: TestSubAfterCloseSub was put in a wrong package (sijie via ivank)"},{"sha":"53c2db03466c7cb61fb34fb220b2a3cd5f64a72b","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -507,7 +507,7 @@ private String getInstanceId(ZooKeeper zk) throws KeeperException,\n                     + BookKeeperConstants.INSTANCEID, false, null);\n             instanceId = new String(data);\n         } catch (KeeperException.NoNodeException e) {\n-            LOG.warn(\"INSTANCEID not exists in zookeeper. Not considering it for data verification\");\n+            LOG.info(\"INSTANCEID not exists in zookeeper. Not considering it for data verification\");\n         }\n         return instanceId;\n     }\n@@ -624,6 +624,7 @@ synchronized public void start() {\n             shutdown(ExitCode.BOOKIE_EXCEPTION);\n             return;\n         }\n+        LOG.info(\"Finished reading journal, starting bookie\");\n         // start bookie thread\n         super.start();\n "},{"sha":"ea926ed9b667636ed184c1dea26e4b5680fab538","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java","status":"modified","additions":3,"deletions":3,"changes":6,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/GarbageCollectorThread.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -570,7 +570,7 @@ public void process(long ledgerId, long offset, ByteBuffer entry) {\n                 continue;\n             }\n \n-            LOG.info(\"Extracting entry log meta from entryLogId: \" + entryLogId);\n+            LOG.info(\"Extracting entry log meta from entryLogId: {}\", entryLogId);\n \n             try {\n                 // Read through the entry log file and extract the entry log meta\n@@ -598,8 +598,8 @@ static EntryLogMetadata extractMetaFromEntryLog(EntryLogger entryLogger, long en\n         ExtractionScanner scanner = new ExtractionScanner(entryLogMeta);\n         // Read through the entry log file and extract the entry log meta\n         entryLogger.scanEntryLog(entryLogId, scanner);\n-        LOG.info(\"Retrieved entry log meta data entryLogId: \"\n-                 + entryLogId + \", meta: \" + entryLogMeta);\n+        LOG.debug(\"Retrieved entry log meta data entryLogId: {}, meta: {}\",\n+                  entryLogId, entryLogMeta);\n         return entryLogMeta;\n     }\n }"},{"sha":"72f337020c9087dde506a4a658c36f4c9b75588e","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Journal.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Journal.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Journal.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Journal.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -433,6 +433,7 @@ public boolean accept(long journalId) {\n             if(id == markedLogId) {\n                 logPosition = lastLogMark.getTxnLogPosition();\n             }\n+            LOG.info(\"Replaying journal {} from position {}\", id, logPosition);\n             scanJournal(id, logPosition, scanner);\n         }\n     }"},{"sha":"8e316e64e63d2582fa920f7447ff5d4a3ce5cef9","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCacheImpl.java","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCacheImpl.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCacheImpl.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCacheImpl.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -803,8 +803,10 @@ private void evictFileInfoIfNecessary() throws IOException {\n         synchronized (fileInfoCache) {\n             if (openLedgers.size() > openFileLimit) {\n                 long ledgerToRemove = openLedgers.removeFirst();\n-                LOG.info(\"Ledger {} is evicted from file info cache.\",\n-                         ledgerToRemove);\n+                // TODO Add a statistic here, we don't care really which\n+                // ledger is evicted, but the rate at which they get evicted\n+                LOG.debug(\"Ledger {} is evicted from file info cache.\",\n+                          ledgerToRemove);\n                 FileInfo fi = fileInfoCache.remove(ledgerToRemove);\n                 if (fi != null) {\n                     fi.close(true);"},{"sha":"c0cfdb736ab0b9a8db51178716d6151c5d7791e4","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -628,6 +628,7 @@ void handleUnrecoverableErrorDuringAdd(int rc) {\n             errorOutPendingAdds(rc);\n             return;\n         }\n+        LOG.error(\"Closing ledger {} due to error {}\", ledgerId, rc);\n         asyncCloseInternal(NoopCloseCallback.instance, null, rc);\n     }\n "},{"sha":"3bc488564839744669aae3cc5f8b1ebd385525b3","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java","status":"modified","additions":11,"deletions":3,"changes":14,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -143,15 +143,18 @@ public void writeComplete(int rc, long ledgerId, long entryId, InetSocketAddress\n             // continue\n             break;\n         case BKException.Code.LedgerFencedException:\n-            LOG.warn(\"Fencing exception on write: \" + ledgerId + \", \" + entryId);\n+            LOG.warn(\"Fencing exception on write: L{} E{} on {}\",\n+                     new Object[] { ledgerId, entryId, addr });\n             lh.handleUnrecoverableErrorDuringAdd(rc);\n             return;\n         case BKException.Code.UnauthorizedAccessException:\n-            LOG.warn(\"Unauthorized access exception on write: \" + ledgerId + \", \" + entryId);\n+            LOG.warn(\"Unauthorized access exception on write: L{} E{} on {}\",\n+                     new Object[] { ledgerId, entryId, addr });\n             lh.handleUnrecoverableErrorDuringAdd(rc);\n             return;\n         default:\n-            LOG.warn(\"Write did not succeed: \" + ledgerId + \", \" + entryId);\n+            LOG.warn(\"Write did not succeed: L{} E{} on {}\",\n+                     new Object[] { ledgerId, entryId, addr });\n             lh.handleBookieFailure(addr, bookieIndex);\n             return;\n         }\n@@ -172,6 +175,11 @@ public void writeComplete(int rc, long ledgerId, long entryId, InetSocketAddress\n     }\n \n     void submitCallback(final int rc) {\n+        if (rc != BKException.Code.OK) {\n+            LOG.error(\"Write of ledger entry to quorum failed: L{} E{}\",\n+                      lh.getId(), entryId);\n+        }\n+\n         cb.addComplete(rc, lh, entryId, ctx);\n     }\n "},{"sha":"0f6ef3fc8ed0eaafe8448af43e3e83e933f18b1d","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java","status":"modified","additions":17,"deletions":6,"changes":23,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -190,11 +190,11 @@ synchronized void logErrorAndReattemptRead(InetSocketAddress host, String errMsg\n             }\n             if (BKException.Code.NoSuchEntryException == rc) {\n                 ++numMissedEntryReads;\n-                LOG.info(\"No such entry found on bookie. entry: {} ledgerId: {} bookie: {}\", new Object[] { entryId,\n-                        lh.ledgerId, host });\n+                LOG.debug(\"No such entry found on bookie.  L{} E{} bookie: {}\",\n+                        new Object[] { lh.ledgerId, entryId, host });\n             } else {\n-                LOG.error(errMsg + \" while reading entry: \" + entryId + \" ledgerId: \" + lh.ledgerId + \" from bookie: \"\n-                        + host);\n+                LOG.debug(errMsg + \" while reading L{} E{} from bookie: {}\",\n+                          new Object[] { lh.ledgerId, entryId, host });\n             }\n \n             int replica = getReplicaIndex(host);\n@@ -282,8 +282,8 @@ public void run() {\n                             }\n                         }\n                         if (x > 0) {\n-                            LOG.info(\"Send {} speculative reads for ledger {} ({}, {}). Hosts heard are {}.\",\n-                                     new Object[] { x, lh.getId(), startEntryId, endEntryId, heardFromHosts });\n+                            LOG.debug(\"Send {} speculative reads for ledger {} ({}, {}). Hosts heard are {}.\",\n+                                      new Object[] { x, lh.getId(), startEntryId, endEntryId, heardFromHosts });\n                         }\n                     }\n                 }, speculativeReadTimeout, speculativeReadTimeout, TimeUnit.MILLISECONDS);\n@@ -347,6 +347,17 @@ private void submitCallback(int code) {\n             speculativeTask.cancel(true);\n             speculativeTask = null;\n         }\n+        if (code != BKException.Code.OK) {\n+            long firstUnread = LedgerHandle.INVALID_ENTRY_ID;\n+            for (LedgerEntryRequest req : seq) {\n+                if (!req.isComplete()) {\n+                    firstUnread = req.getEntryId();\n+                    break;\n+                }\n+            }\n+            LOG.error(\"Read of ledger entry failed: L{} E{}-E{}, Heard from {}. First unread entry is {}\",\n+                    new Object[] { lh.getId(), startEntryId, endEntryId, heardFromHosts, firstUnread });\n+        }\n         cb.readComplete(code, lh, PendingReadOp.this, PendingReadOp.this.ctx);\n     }\n     public boolean hasMoreElements() {"},{"sha":"cc1cf1506c8917ad65d1e83f611d9c06aeb67d4e","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadOnlyLedgerHandle.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadOnlyLedgerHandle.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadOnlyLedgerHandle.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadOnlyLedgerHandle.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -84,8 +84,8 @@ void handleBookieFailure(final InetSocketAddress addr, final int bookieIndex) {\n             try {\n                 if (!metadata.currentEnsemble.get(bookieIndex).equals(addr)) {\n                     // ensemble has already changed, failure of this addr is immaterial\n-                    LOG.warn(\"Write did not succeed to {}, bookieIndex {}, but we have already fixed it.\",\n-                             addr, bookieIndex);\n+                    LOG.debug(\"Write did not succeed to {}, bookieIndex {},\"\n+                              +\" but we have already fixed it.\", addr, bookieIndex);\n                     blockAddCompletions.decrementAndGet();\n                     return;\n                 }"},{"sha":"e97b06ac139839d2c4c120ca92f57679117c018c","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -203,6 +203,7 @@ public void close() {\n             for (PerChannelBookieClient channel: channels.values()) {\n                 channel.close();\n             }\n+            channels.clear();\n         } finally {\n             closeLock.writeLock().unlock();\n         }"},{"sha":"0de47f1f493fbb50fba77cc951cbd4ab101ef3a5","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java","status":"modified","additions":26,"deletions":18,"changes":44,"blob_url":"https://github.com/apache/bookkeeper/blob/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java","raw_url":"https://github.com/apache/bookkeeper/raw/4bb59f526340ba8efa82a36b72fa7414bc9d02a2/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java?ref=4bb59f526340ba8efa82a36b72fa7414bc9d02a2","patch":"@@ -404,7 +404,7 @@ public void safeRun() {\n                 }\n \n                 if (readCompletion != null) {\n-                    LOG.error(\"Could not write request for reading entry: {}\"\n+                    LOG.debug(\"Could not write request for reading entry: {}\"\n                               + \" ledger-id: {} bookie: {}\",\n                               new Object[] { key.entryId, key.ledgerId, bAddress });\n \n@@ -429,12 +429,12 @@ public void safeRun() {\n                     if(c != null) {\n                         bAddress = c.getRemoteAddress().toString();\n                     }\n-                    LOG.error(\"Could not write request for adding entry: {} ledger-id: {} bookie: {}\",\n+                    LOG.debug(\"Could not write request for adding entry: {} ledger-id: {} bookie: {}\",\n                               new Object[] { key.entryId, key.ledgerId, bAddress });\n \n                     addCompletion.cb.writeComplete(BKException.Code.BookieHandleNotAvailableException, key.ledgerId,\n                                                    key.entryId, addr, addCompletion.ctx);\n-                    LOG.error(\"Invoked callback method: \" + key.entryId);\n+                    LOG.debug(\"Invoked callback method: {}\", key.entryId);\n                 }\n             }\n \n@@ -516,8 +516,8 @@ public void channelDisconnected(ChannelHandlerContext ctx, ChannelStateEvent e)\n     public void exceptionCaught(ChannelHandlerContext ctx, ExceptionEvent e) throws Exception {\n         Throwable t = e.getCause();\n         if (t instanceof CorruptedFrameException || t instanceof TooLongFrameException) {\n-            LOG.error(\"Corrupted fram received from bookie: \"\n-                      + e.getChannel().getRemoteAddress());\n+            LOG.error(\"Corrupted frame received from bookie: {}\",\n+                      e.getChannel().getRemoteAddress());\n             return;\n         }\n         if (t instanceof ReadTimeoutException) {\n@@ -541,7 +541,14 @@ public void exceptionCaught(ChannelHandlerContext ctx, ExceptionEvent e) throws\n             return;\n         }\n \n-        LOG.error(\"Unexpected exception caught by bookie client channel handler\", t);\n+        synchronized (this) {\n+            if (state == ConnectionState.CLOSED) {\n+                LOG.debug(\"Unexpected exception caught by bookie client channel handler, \"\n+                          + \"but the client is closed, so it isn't important\", t);\n+            } else {\n+                LOG.error(\"Unexpected exception caught by bookie client channel handler\", t);\n+            }\n+        }\n         // Since we are a library, cant terminate App here, can we?\n     }\n \n@@ -590,8 +597,8 @@ public void safeRun() {\n \n     void handleAddResponse(long ledgerId, long entryId, int rc) {\n         if (LOG.isDebugEnabled()) {\n-            LOG.debug(\"Got response for add request from bookie: \" + addr + \" for ledger: \" + ledgerId + \" entry: \"\n-                      + entryId + \" rc: \" + rc);\n+            LOG.debug(\"Got response for add request from bookie: {} for ledger: {} entry: {}\"\n+                      + \" rc: {}\", new Object[] { addr, ledgerId, entryId, rc });\n         }\n \n         // convert to BKException code because thats what the uppper\n@@ -614,17 +621,17 @@ void handleAddResponse(long ledgerId, long entryId, int rc) {\n             rc = BKException.Code.WriteOnReadOnlyBookieException;\n             break;\n         default:\n-            LOG.error(\"Add for ledger: \" + ledgerId + \", entry: \" + entryId + \" failed on bookie: \" + addr\n-                      + \" with code: \" + rc);\n+            LOG.warn(\"Add for ledger: {}, entry: {} failed on bookie: {}\"\n+                    + \" with unknown code: {}\", new Object[] { ledgerId, entryId, addr, rc });\n             rc = BKException.Code.WriteException;\n             break;\n         }\n \n         AddCompletion ac;\n         ac = addCompletions.remove(new CompletionKey(ledgerId, entryId));\n         if (ac == null) {\n-            LOG.error(\"Unexpected add response received from bookie: \" + addr + \" for ledger: \" + ledgerId\n-                      + \", entry: \" + entryId + \" , ignoring\");\n+            LOG.debug(\"Unexpected add response received from bookie: {} for ledger: {}\"\n+                    + \", entry: {}, ignoring\", new Object[] { addr,  ledgerId, entryId });\n             return;\n         }\n \n@@ -636,8 +643,9 @@ void handleAddResponse(long ledgerId, long entryId, int rc) {\n \n     void handleReadResponse(long ledgerId, long entryId, int rc, ChannelBuffer buffer) {\n         if (LOG.isDebugEnabled()) {\n-            LOG.debug(\"Got response for read request from bookie: \" + addr + \" for ledger: \" + ledgerId + \" entry: \"\n-                      + entryId + \" rc: \" + rc + \" entry length: \" + buffer.readableBytes());\n+            LOG.debug(\"Got response for read request from bookie: {} for ledger: {} entry: {}\"\n+                    + \" rc: {} entry length: {}\",\n+                    new Object[] { addr, ledgerId, entryId, rc, buffer.readableBytes() });\n         }\n \n         // convert to BKException code because thats what the uppper\n@@ -652,8 +660,8 @@ void handleReadResponse(long ledgerId, long entryId, int rc, ChannelBuffer buffe\n         } else if (rc == BookieProtocol.EUA) {\n             rc = BKException.Code.UnauthorizedAccessException;\n         } else {\n-            LOG.error(\"Read for ledger: \" + ledgerId + \", entry: \" + entryId + \" failed on bookie: \" + addr\n-                      + \" with code: \" + rc);\n+            LOG.warn(\"Read for ledger: {}, entry: {} failed on bookie: {}\"\n+                    + \" with unknown code: {}\", new Object[] { ledgerId, entryId, addr, rc });\n             rc = BKException.Code.ReadException;\n         }\n \n@@ -671,8 +679,8 @@ void handleReadResponse(long ledgerId, long entryId, int rc, ChannelBuffer buffe\n         }\n \n         if (readCompletion == null) {\n-            LOG.error(\"Unexpected read response received from bookie: \" + addr + \" for ledger: \" + ledgerId\n-                      + \", entry: \" + entryId + \" , ignoring\");\n+            LOG.debug(\"Unexpected read response received from bookie: {} for ledger: {}\"\n+                    + \", entry: {} , ignoring\", new Object[] { addr, ledgerId, entryId });\n             return;\n         }\n "}]}

