{"sha":"6698912e4d35119a2e85a6ea3877c6771073489c","node_id":"MDY6Q29tbWl0MTU3NTk1Njo2Njk4OTEyZTRkMzUxMTlhMmU4NWE2ZWEzODc3YzY3NzEwNzM0ODlj","commit":{"author":{"name":"Sijie Guo","email":"sijieg@twitter.com","date":"2017-05-26T10:38:28Z"},"committer":{"name":"eolivelli","email":"eolivelli@apache.org","date":"2017-05-26T10:38:28Z"},"message":"BOOKKEEPER-1077: Allow configuration journal/ledger paths for local bookkeeper.\n\nAuthor: Sijie Guo <sijieg@twitter.com>\nAuthor: Robin Dhamankar <rdhamankar@twitter.com>\n\nReviewers: Enrico Olivelli <eolivelli@apache.org>\n\nCloses #163 from sijie/to_string_mark","tree":{"sha":"8f42c771ee5db9f9c64166f39288cfe7bf3f718f","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/8f42c771ee5db9f9c64166f39288cfe7bf3f718f"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/6698912e4d35119a2e85a6ea3877c6771073489c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/6698912e4d35119a2e85a6ea3877c6771073489c","html_url":"https://github.com/apache/bookkeeper/commit/6698912e4d35119a2e85a6ea3877c6771073489c","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/6698912e4d35119a2e85a6ea3877c6771073489c/comments","author":null,"committer":{"login":"eolivelli","id":9469110,"node_id":"MDQ6VXNlcjk0NjkxMTA=","avatar_url":"https://avatars.githubusercontent.com/u/9469110?v=4","gravatar_id":"","url":"https://api.github.com/users/eolivelli","html_url":"https://github.com/eolivelli","followers_url":"https://api.github.com/users/eolivelli/followers","following_url":"https://api.github.com/users/eolivelli/following{/other_user}","gists_url":"https://api.github.com/users/eolivelli/gists{/gist_id}","starred_url":"https://api.github.com/users/eolivelli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eolivelli/subscriptions","organizations_url":"https://api.github.com/users/eolivelli/orgs","repos_url":"https://api.github.com/users/eolivelli/repos","events_url":"https://api.github.com/users/eolivelli/events{/privacy}","received_events_url":"https://api.github.com/users/eolivelli/received_events","type":"User","site_admin":false},"parents":[{"sha":"64bedc2f92d5bb17783c6ea2a2db7ea29170f264","url":"https://api.github.com/repos/apache/bookkeeper/commits/64bedc2f92d5bb17783c6ea2a2db7ea29170f264","html_url":"https://github.com/apache/bookkeeper/commit/64bedc2f92d5bb17783c6ea2a2db7ea29170f264"}],"stats":{"total":34,"additions":30,"deletions":4},"files":[{"sha":"d0184091b2640f1037f8631081509e2b75aa1e8a","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","status":"modified","additions":20,"deletions":1,"changes":21,"blob_url":"https://github.com/apache/bookkeeper/blob/6698912e4d35119a2e85a6ea3877c6771073489c/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","raw_url":"https://github.com/apache/bookkeeper/raw/6698912e4d35119a2e85a6ea3877c6771073489c/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java?ref=6698912e4d35119a2e85a6ea3877c6771073489c","patch":"@@ -603,6 +603,16 @@ public String getJournalDirName() {\n         return this.getString(JOURNAL_DIR, \"/tmp/bk-txn\");\n     }\n \n+    /**\n+     * Get dir name to store journal files\n+     *\n+     * @return journal dir name\n+     */\n+    public String getJournalDirNameWithoutDefault() {\n+        return this.getString(JOURNAL_DIR);\n+    }\n+\n+\n     /**\n      * Set dir name to store journal files\n      *\n@@ -641,14 +651,23 @@ public ServerConfiguration setJournalDirsName(String[] journalDirs) {\n         return journalDirs;\n     }\n \n+    /**\n+     * Get dir names to store ledger data\n+     *\n+     * @return ledger dir names, if not provided return null\n+     */\n+    public String[] getLedgerDirWithoutDefault() {\n+        return this.getStringArray(LEDGER_DIRS);\n+    }\n+\n     /**\n      * Get dir names to store ledger data\n      *\n      * @return ledger dir names, if not provided return null\n      */\n     public String[] getLedgerDirNames() {\n         String[] ledgerDirs = this.getStringArray(LEDGER_DIRS);\n-        if (null == ledgerDirs) {\n+        if ((null == ledgerDirs) || (0 == ledgerDirs.length)) {\n             return new String[] { \"/tmp/bk-data\" };\n         }\n         return ledgerDirs;"},{"sha":"5dc0053fbd13102b4e0441fd11670c4d53758558","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java","status":"modified","additions":10,"deletions":3,"changes":13,"blob_url":"https://github.com/apache/bookkeeper/blob/6698912e4d35119a2e85a6ea3877c6771073489c/bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java","raw_url":"https://github.com/apache/bookkeeper/raw/6698912e4d35119a2e85a6ea3877c6771073489c/bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/util/LocalBookKeeper.java?ref=6698912e4d35119a2e85a6ea3877c6771073489c","patch":"@@ -45,7 +45,6 @@\n import org.apache.zookeeper.ZooDefs.Ids;\n \n import static com.google.common.base.Charsets.UTF_8;\n-import org.apache.zookeeper.data.ACL;\n \n public class LocalBookKeeper {\n     protected static final Logger LOG = LoggerFactory.getLogger(LocalBookKeeper.class);\n@@ -180,8 +179,16 @@ private void runBookies(ServerConfiguration baseConf, List<File> tempDirs, Strin\n             bsConfs[i].setBookiePort(initialPort + i);\n             LOG.info(\"Connecting to Zookeeper at \" + loopbackIPAddr + \" port:\" + ZooKeeperDefaultPort);\n             bsConfs[i].setZkServers(loopbackIPAddr + \":\" + ZooKeeperDefaultPort);\n-            bsConfs[i].setJournalDirName(tmpDirs[i].getPath());\n-            bsConfs[i].setLedgerDirNames(new String[] { tmpDirs[i].getPath() });\n+\n+            if (null == bsConfs[i].getJournalDirNameWithoutDefault()) {\n+                bsConfs[i].setJournalDirName(tmpDirs[i].getPath());\n+            }\n+\n+            String [] ledgerDirs = bsConfs[i].getLedgerDirWithoutDefault();\n+            if ((null == ledgerDirs) || (0 == ledgerDirs.length)) {\n+                bsConfs[i].setLedgerDirNames(new String[] { tmpDirs[i].getPath() });\n+            }\n+\n             bsConfs[i].setAllowLoopback(true);\n \n             bs[i] = new BookieServer(bsConfs[i]);"}]}

