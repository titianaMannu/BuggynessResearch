{"sha":"7467d2697103abba54d8f665724d630721064e78","node_id":"MDY6Q29tbWl0MTU3NTk1Njo3NDY3ZDI2OTcxMDNhYmJhNTRkOGY2NjU3MjRkNjMwNzIxMDY0ZTc4","commit":{"author":{"name":"Flavio Paiva Junqueira","email":"fpj@apache.org","date":"2012-12-11T17:59:21Z"},"committer":{"name":"Flavio Paiva Junqueira","email":"fpj@apache.org","date":"2012-12-11T17:59:21Z"},"message":"BOOKKEEPER-495: Revise BK config doc (fpj, ivank via fpj)\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1420308 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"56e15ced9922e83fbeeae3040dcae53f0f4c5d2c","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/56e15ced9922e83fbeeae3040dcae53f0f4c5d2c"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/7467d2697103abba54d8f665724d630721064e78","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/7467d2697103abba54d8f665724d630721064e78","html_url":"https://github.com/apache/bookkeeper/commit/7467d2697103abba54d8f665724d630721064e78","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/7467d2697103abba54d8f665724d630721064e78/comments","author":{"login":"fpj","id":572920,"node_id":"MDQ6VXNlcjU3MjkyMA==","avatar_url":"https://avatars.githubusercontent.com/u/572920?v=4","gravatar_id":"","url":"https://api.github.com/users/fpj","html_url":"https://github.com/fpj","followers_url":"https://api.github.com/users/fpj/followers","following_url":"https://api.github.com/users/fpj/following{/other_user}","gists_url":"https://api.github.com/users/fpj/gists{/gist_id}","starred_url":"https://api.github.com/users/fpj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fpj/subscriptions","organizations_url":"https://api.github.com/users/fpj/orgs","repos_url":"https://api.github.com/users/fpj/repos","events_url":"https://api.github.com/users/fpj/events{/privacy}","received_events_url":"https://api.github.com/users/fpj/received_events","type":"User","site_admin":false},"committer":{"login":"fpj","id":572920,"node_id":"MDQ6VXNlcjU3MjkyMA==","avatar_url":"https://avatars.githubusercontent.com/u/572920?v=4","gravatar_id":"","url":"https://api.github.com/users/fpj","html_url":"https://github.com/fpj","followers_url":"https://api.github.com/users/fpj/followers","following_url":"https://api.github.com/users/fpj/following{/other_user}","gists_url":"https://api.github.com/users/fpj/gists{/gist_id}","starred_url":"https://api.github.com/users/fpj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fpj/subscriptions","organizations_url":"https://api.github.com/users/fpj/orgs","repos_url":"https://api.github.com/users/fpj/repos","events_url":"https://api.github.com/users/fpj/events{/privacy}","received_events_url":"https://api.github.com/users/fpj/received_events","type":"User","site_admin":false},"parents":[{"sha":"be155aa0c61f6b7bc0bf3d4f2ea56a9b97e590bf","url":"https://api.github.com/repos/apache/bookkeeper/commits/be155aa0c61f6b7bc0bf3d4f2ea56a9b97e590bf","html_url":"https://github.com/apache/bookkeeper/commit/be155aa0c61f6b7bc0bf3d4f2ea56a9b97e590bf"}],"stats":{"total":79,"additions":62,"deletions":17},"files":[{"sha":"01fa28b65f3b9bae7c8626806be40045b44b4855","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/7467d2697103abba54d8f665724d630721064e78/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/7467d2697103abba54d8f665724d630721064e78/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=7467d2697103abba54d8f665724d630721064e78","patch":"@@ -190,6 +190,8 @@ Trunk (unreleased changes)\n \n       BOOKKEEPER-491: Hedwig doc for configuration (fpj, sijie via fpj)\n \n+      BOOKKEEPER-495: Revise BK config doc (fpj, ivank via fpj)\n+\n       bookkeeper-server:\n \n         BOOKKEEPER-328: Bookie DeathWatcher is missing thread name (Rakesh via sijie)"},{"sha":"ed90e5bb9156e9d78d81e84ef522ba838f03a91a","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","status":"modified","additions":30,"deletions":7,"changes":37,"blob_url":"https://github.com/apache/bookkeeper/blob/7467d2697103abba54d8f665724d630721064e78/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","raw_url":"https://github.com/apache/bookkeeper/raw/7467d2697103abba54d8f665724d630721064e78/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java?ref=7467d2697103abba54d8f665724d630721064e78","patch":"@@ -60,6 +60,7 @@\n     protected final static String OPEN_LEDGER_REREPLICATION_GRACE_PERIOD = \"openLedgerRereplicationGracePeriod\";\n     //ReadOnly mode support on all disk full\n     protected final static String READ_ONLY_MODE_ENABLED = \"readOnlyModeEnabled\";\n+    //Disk utilization\n     protected final static String DISK_USAGE_THRESHOLD = \"diskUsageThreshold\";\n     protected final static String DISK_CHECK_INTERVAL = \"diskCheckInterval\";\n \n@@ -557,13 +558,15 @@ public ServerConfiguration setMajorCompactionInterval(long interval) {\n      * fencing and rereplicating a ledger fragment which is still being written\n      * to, on bookie failure.\n      * \n-     * The grace period allows the writer to detect the bookie failure, and and\n-     * start writing to another ledger fragment. If the writer writes nothing\n+     * The grace period allows the writer to detect the bookie failure, and\n+     * start replicating the ledger fragment. If the writer writes nothing\n      * during the grace period, the rereplication worker assumes that it has\n-     * crashed and therefore fences the ledger, preventing any further writes to\n-     * that ledger.\n+     * crashed and fences the ledger, preventing any further writes to that \n+     * ledger.\n      * \n      * @see org.apache.bookkeeper.client.BookKeeper#openLedger\n+     * \n+     * @param waitTime time to wait before replicating ledger fragment\n      */\n     public void setOpenLedgerRereplicationGracePeriod(String waitTime) {\n         setProperty(OPEN_LEDGER_REREPLICATION_GRACE_PERIOD, waitTime);\n@@ -573,13 +576,19 @@ public void setOpenLedgerRereplicationGracePeriod(String waitTime) {\n      * Get the grace period which the rereplication worker to wait before\n      * fencing and rereplicating a ledger fragment which is still being written\n      * to, on bookie failure.\n+     * \n+     * @return long\n      */\n     public long getOpenLedgerRereplicationGracePeriod() {\n         return getLong(OPEN_LEDGER_REREPLICATION_GRACE_PERIOD, 30000);\n     }\n \n     /**\n      * Set the ReadOnlyModeEnabled status\n+     * \n+     * @param enabled enables read-only mode.\n+     * \n+     * @return ServerConfiguration \n      */\n     public ServerConfiguration setReadOnlyModeEnabled(boolean enabled) {\n         setProperty(READ_ONLY_MODE_ENABLED, enabled);\n@@ -588,29 +597,41 @@ public ServerConfiguration setReadOnlyModeEnabled(boolean enabled) {\n \n     /**\n      * Get ReadOnlyModeEnabled status\n+     * \n+     * @return boolean\n      */\n     public boolean isReadOnlyModeEnabled() {\n         return getBoolean(READ_ONLY_MODE_ENABLED, false);\n     }\n \n     /**\n-     * Set the Disk free space threshold in Bytes after which disk will be\n-     * considered as full during diskcheck.\n+     * Set the Disk free space threshold as a fraction of the total\n+     * after which disk will be considered as full during disk check.\n+     * \n+     * @param threshold threshold to declare a disk full\n+     * \n+     * @return ServerConfiguration\n      */\n     public ServerConfiguration setDiskUsageThreshold(float threshold) {\n         setProperty(DISK_USAGE_THRESHOLD, threshold);\n         return this;\n     }\n \n     /**\n-     * Returns disk free space threshold. By default 100MB\n+     * Returns disk free space threshold. By default it is 0.95.\n+     * \n+     * @return float\n      */\n     public float getDiskUsageThreshold() {\n         return getFloat(DISK_USAGE_THRESHOLD, 0.95f);\n     }\n \n     /**\n      * Set the disk checker interval to monitor ledger disk space\n+     * \n+     * @param interval interval between disk checks for space.\n+     * \n+     * @return ServerConfiguration\n      */\n     public ServerConfiguration setDiskCheckInterval(int interval) {\n         setProperty(DISK_CHECK_INTERVAL, interval);\n@@ -619,6 +640,8 @@ public ServerConfiguration setDiskCheckInterval(int interval) {\n \n     /**\n      * Get the disk checker interval\n+     * \n+     * @return int\n      */\n     public int getDiskCheckInterval() {\n         return getInt(DISK_CHECK_INTERVAL, 10 * 1000);"},{"sha":"3c30646c82981a3a79155263e70f37bf7bd9478c","filename":"doc/bookieConfigParams.textile","status":"modified","additions":30,"deletions":10,"changes":40,"blob_url":"https://github.com/apache/bookkeeper/blob/7467d2697103abba54d8f665724d630721064e78/doc/bookieConfigParams.textile","raw_url":"https://github.com/apache/bookkeeper/raw/7467d2697103abba54d8f665724d630721064e78/doc/bookieConfigParams.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/bookieConfigParams.textile?ref=7467d2697103abba54d8f665724d630721064e78","patch":"@@ -14,38 +14,58 @@ h1. Bookie Configuration Parameters\n \n This page contains detailed information about configuration parameters used for configuring a bookie server. There is an example in \"bookkeeper-server/conf/bk_server.conf\". \n \n-h3. General parameters\n+h2. Server parameters\n \n-| @zkServers@ | A list of one of more servers on which zookeeper is running. The server list can be comma separated values, e.g., zk1:2181,zk2:2181,zk3:2181 |\n-| @zkTimeout@ | ZooKeeper client session timeout in milliseconds. Bookie server will exit if it received SESSION_EXPIRED because it was partitioned off from ZooKeeper for more than the session timeout JVM garbage collection, disk I/O will cause SESSION_EXPIRED. Increment this value could help avoiding this issue. The default value is 10,000. |\n | @bookiePort@        |Port that bookie server listens on. The default value is 3181.|\n-| @journalDir@        | Directory Bookkeeper outputs its write ahead log, ideally in a dedicated device. The default value is \"/tmp/bk-txn\". |\n-| @ledgerDirs@        | Directory Bookkeeper outputs ledger snapshots could define multiple directories to store snapshots, comma separated. For example: /tmp/bk1-data,/tmp/bk2-data. Ideally ledger dirs and journal dir are each in a differet device, which reduce the contention between random i/o and sequential write. It is possible to run with a single disk,  but performance will be significantly lower.|\n+| @journalDirectory@        | Directory to which Bookkeeper outputs its write ahead log, ideally on a dedicated device. The default value is \"/tmp/bk-txn\". |\n+| @ledgerDirectories@        | Directory to which Bookkeeper outputs ledger snapshots.  Multiple directories can be defined, separated by comma, e.g. /tmp/bk1-data,/tmp/bk2-data. Ideally ledger dirs and journal dir are each on a differet device, which reduces the contention between random I/O and sequential writes. It is possible to run with a single disk,  but performance will be significantly lower.|\n | @logSizeLimit@      | Maximum file size of entry logger, in bytes. A new entry log file will be created when the old one reaches the file size limitation. The default value is 2GB. |\n-| @journalMaxSizeMB@  |  Maximum file size of journal file, in mega bytes. A new journal file will be created when the old one reaches the file size limitation. The default value is 2kB. |\n+| @journalMaxSizeMB@  |  Maximum file size of journal file, in megabytes. A new journal file will be created when the old one reaches the file size limitation. The default value is 2kB. |\n | @journalMaxBackups@ |  Max number of old journal file to keep. Keeping a number of old journal files might help data recovery in some special cases. The default value is 5. |\n | @gcWaitTime@        | Interval to trigger next garbage collection, in milliseconds. Since garbage collection is running in the background, running the garbage collector too frequently hurts performance. It is best to set its value high enough if there is sufficient disk capacity.|\n | @flushInterval@ | Interval to flush ledger index pages to disk, in milliseconds. Flushing index files will introduce random disk I/O. Consequently, it is important to have journal dir and ledger dirs each on different devices. However,  if it necessary to have journal dir and ledger dirs on the same device, one option is to increment the flush interval to get higher performance. Upon a failure, the bookie will take longer to recover. |\n | @bookieDeathWatchInterval@ | Interval to check whether a bookie is dead or not, in milliseconds. |\n \n-h3. NIO server settings\n+h2. NIO server settings\n \n | @serverTcpNoDelay@ | This settings is used to enabled/disabled Nagle's algorithm, which is a means of improving the efficiency of TCP/IP networks by reducing the number of packets that need to be sent over the network. If you are sending many small messages, such that more than one can fit in a single IP packet, setting server.tcpnodelay to false to enable Nagle algorithm can provide better performance. Default value is true. |\n \n-h3. Ledger cache settings\n+h2. Ledger cache settings\n \n | @openFileLimit@ | Maximum number of ledger index files that can be opened in a bookie. If the number of ledger index files reaches this limit, the bookie starts to flush some ledger indexes from memory to disk. If flushing happens too frequently, then performance is affected. You can tune this number to improve performance according. |\n | @pageSize@ | Size of an index page in ledger cache, in bytes. A larger index page can improve performance when writing page to disk, which is efficient when you have small number of ledgers and these ledgers have a similar number of entries. With a large number of ledgers and a few entries per ledger, a smaller index page would improves memory usage. |\n | @pageLimit@ | Maximum number of index pages to store in the ledger cache. If the number of index pages reaches this limit, bookie server starts to flush ledger indexes from memory to disk. Incrementing this value is an option when flushing becomes frequent. It is important to make sure, though, that pageLimit*pageSize is not more than JVM max memory limit; otherwise it will raise an OutOfMemoryException. In general, incrementing pageLimit, using smaller index page would gain better performance in the case of a large number of ledgers with few entries per ledger. If pageLimit is -1, a bookie uses 1/3 of the JVM memory to compute the maximum number of index pages. |\n \n-h3. Ledger manager settings\n+h2. Ledger manager settings\n \n | @ledgerManagerType@ | What kind of ledger manager is used to manage how ledgers are stored, managed and garbage collected. See \"BookKeeper Internals\":./bookkeeperInternals.html for detailed info. Default is flat. |\n | @zkLedgersRootPath@ | Root zookeeper path to store ledger metadata. Default is /ledgers. |\n \n-h3. Entry Log compaction settings\n+h2. Entry Log compaction settings\n \n | @minorCompactionInterval@ | Interval to run minor compaction, in seconds. If it is set to less than or equal to zero, then minor compaction is disabled. Default is 1 hour. |\n | @minorCompactionThreshold@ | Entry log files with remaining size under this threshold value will be compacted in a minor compaction. If it is set to less than or equal to zero, the minor compaction is disabled. Default is 0.2 |\n | @majorCompactionInterval@ | Interval to run major compaction, in seconds. If it is set to less than or equal to zero, then major compaction is disabled. Default is 1 day. |\n | @majorCompactionThreshold@ | Entry log files with remaining size below this threshold value will be compacted in a major compaction. Those entry log files whose remaining size percentage is still higher than the threshold value will never be compacted. If it is set to less than or equal to zero, the major compaction is disabled. Default is 0.8. |\n+\n+h2. Statistics\n+\n+| @enableStatistics@ | Enables the collection of statistics. Default is on. |\n+\n+h2. Auto-replication\n+\n+| @openLedgerRereplicationGracePeriod@ | This is the grace period which the rereplication worker waits before fencing and replicating a ledger fragment which is still being written to upon a bookie failure. The default is 30s. |\n+\n+h2. Read-only mode support\n+\n+| @readOnlyModeEnabled@ | Enables/disables the read-only Bookie feature. A bookie goes into read-only mode when it finds integrity issues with stored data. If @readOnlyModeEnabled@ is false, the bookie shuts down if it finds integrity issues. By default it is enabled. |\n+\n+h2. Disk utilization\n+\n+| @diskUsageThreshold@ | Fraction of the total utilized usable disk space to declare the disk full. The total available disk space is obtained with File.getUsableSpace(). Default is 0.95. |\n+| @diskCheckInterval@ | Interval between consecutive checks of disk utilization. Default is 10s. |\n+\n+h2. ZooKeeper parameters\n+\n+| @zkServers@ | A list of one or more servers on which zookeeper is running. The server list is comma separated, e.g., zk1:2181,zk2:2181,zk3:2181 |\n+| @zkTimeout@ | ZooKeeper client session timeout in milliseconds. Bookie server will exit if it received SESSION_EXPIRED because it was partitioned off from ZooKeeper for more than the session timeout. JVM garbage collection or disk I/O can cause SESSION_EXPIRED. Increment this value could help avoiding this issue. The default value is 10,000. |\n\\ No newline at end of file"}]}

