{"sha":"8125700069b14f80ebd135ddd1a2b67de256cb1e","node_id":"MDY6Q29tbWl0MTU3NTk1Njo4MTI1NzAwMDY5YjE0ZjgwZWJkMTM1ZGRkMWEyYjY3ZGUyNTZjYjFl","commit":{"author":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2012-12-14T10:18:04Z"},"committer":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2012-12-14T10:18:04Z"},"message":"BOOKKEEPER-426: Make auditor Vote znode store a protobuf containing the host that voted (ivank)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1421781 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"35d802cef01c73201b88b67efbbd2a6b11002bb6","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/35d802cef01c73201b88b67efbbd2a6b11002bb6"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/8125700069b14f80ebd135ddd1a2b67de256cb1e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/8125700069b14f80ebd135ddd1a2b67de256cb1e","html_url":"https://github.com/apache/bookkeeper/commit/8125700069b14f80ebd135ddd1a2b67de256cb1e","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/8125700069b14f80ebd135ddd1a2b67de256cb1e/comments","author":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"committer":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"parents":[{"sha":"e0011de4475969c19023694f5074b50e5d12a08f","url":"https://api.github.com/repos/apache/bookkeeper/commits/e0011de4475969c19023694f5074b50e5d12a08f","html_url":"https://github.com/apache/bookkeeper/commit/e0011de4475969c19023694f5074b50e5d12a08f"}],"stats":{"total":431,"additions":419,"deletions":12},"files":[{"sha":"4207317e21cb6762513f3fe16d2fd5fa65971877","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/8125700069b14f80ebd135ddd1a2b67de256cb1e/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/8125700069b14f80ebd135ddd1a2b67de256cb1e/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=8125700069b14f80ebd135ddd1a2b67de256cb1e","patch":"@@ -250,6 +250,8 @@ Trunk (unreleased changes)\n \n         BOOKKEEPER-205: implement a MetaStore based ledger manager for bookkeeper client. (jiannan via ivank)\n \n+        BOOKKEEPER-426: Make auditor Vote znode store a protobuf containing the host that voted (ivank)\n+\n       hedwig-server:\n \n         BOOKKEEPER-250: Need a ledger manager like interface to manage metadata operations in Hedwig (sijie via ivank)"},{"sha":"5757a491fba322f8c59b4ac678bc913104c8b79c","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java","status":"modified","additions":8,"deletions":8,"changes":16,"blob_url":"https://github.com/apache/bookkeeper/blob/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java","raw_url":"https://github.com/apache/bookkeeper/raw/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java?ref=8125700069b14f80ebd135ddd1a2b67de256cb1e","patch":"@@ -38,10 +38,10 @@\n \n import com.google.protobuf.TextFormat;\n import com.google.common.base.Joiner;\n+import static com.google.common.base.Charsets.UTF_8;\n \n import java.net.InetAddress;\n import java.net.UnknownHostException;\n-import java.nio.charset.Charset;\n \n import java.util.concurrent.CountDownLatch;\n import java.util.concurrent.ConcurrentHashMap;\n@@ -50,6 +50,7 @@\n import java.util.Collections;\n import java.util.Arrays;\n \n+\n import java.util.regex.Pattern;\n import java.util.regex.Matcher;\n \n@@ -73,7 +74,6 @@\n  */\n public class ZkLedgerUnderreplicationManager implements LedgerUnderreplicationManager {\n     static final Logger LOG = LoggerFactory.getLogger(ZkLedgerUnderreplicationManager.class);\n-    static final Charset UTF8 = Charset.forName(\"UTF-8\");\n     static final String LAYOUT=\"BASIC\";\n     static final int LAYOUT_VERSION=1;\n \n@@ -139,7 +139,7 @@ private void checkLayout()\n                     = LedgerRereplicationLayoutFormat.newBuilder();\n                 builder.setType(LAYOUT).setVersion(LAYOUT_VERSION);\n                 try {\n-                    zkc.create(layoutZNode, TextFormat.printToString(builder.build()).getBytes(UTF8),\n+                    zkc.create(layoutZNode, TextFormat.printToString(builder.build()).getBytes(UTF_8),\n                                Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n                 } catch (KeeperException.NodeExistsException nne) {\n                     // someone else managed to create it\n@@ -152,7 +152,7 @@ private void checkLayout()\n                     = LedgerRereplicationLayoutFormat.newBuilder();\n \n                 try {\n-                    TextFormat.merge(new String(layoutData, UTF8), builder);\n+                    TextFormat.merge(new String(layoutData, UTF_8), builder);\n                     LedgerRereplicationLayoutFormat layout = builder.build();\n                     if (!layout.getType().equals(LAYOUT)\n                             || layout.getVersion() != LAYOUT_VERSION) {\n@@ -217,7 +217,7 @@ public void markLedgerUnderreplicated(long ledgerId, String missingReplica)\n                 try {\n                     builder.addReplica(missingReplica);\n                     ZkUtils.createFullPathOptimistic(zkc, znode, TextFormat\n-                            .printToString(builder.build()).getBytes(UTF8),\n+                            .printToString(builder.build()).getBytes(UTF_8),\n                             Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);\n                 } catch (KeeperException.NodeExistsException nee) {\n                     Stat s = zkc.exists(znode, false);\n@@ -227,14 +227,14 @@ public void markLedgerUnderreplicated(long ledgerId, String missingReplica)\n                     try {\n                         byte[] bytes = zkc.getData(znode, false, s);\n                         builder.clear();\n-                        TextFormat.merge(new String(bytes, UTF8), builder);\n+                        TextFormat.merge(new String(bytes, UTF_8), builder);\n                         UnderreplicatedLedgerFormat data = builder.build();\n                         if (data.getReplicaList().contains(missingReplica)) {\n                             return; // nothing to add\n                         }\n                         builder.addReplica(missingReplica);\n                         zkc.setData(znode,\n-                                    TextFormat.printToString(builder.build()).getBytes(UTF8),\n+                                    TextFormat.printToString(builder.build()).getBytes(UTF_8),\n                                     s.getVersion());\n                     } catch (KeeperException.NoNodeException nne) {\n                         continue;\n@@ -329,7 +329,7 @@ private long getLedgerToRereplicateFromHierarchy(String parent, long depth, Watc\n                     }\n \n                     long ledgerId = getLedgerId(tryChild);\n-                    zkc.create(lockPath, TextFormat.printToString(lockData).getBytes(UTF8),\n+                    zkc.create(lockPath, TextFormat.printToString(lockData).getBytes(UTF_8),\n                                Ids.OPEN_ACL_UNSAFE, CreateMode.EPHEMERAL);\n                     heldLocks.put(ledgerId, new Lock(lockPath, stat.getVersion()));\n                     return ledgerId;"},{"sha":"65d5444d10dfd2d372872137bdf8f01dcc6de05d","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/DataFormats.java","status":"modified","additions":391,"deletions":2,"changes":393,"blob_url":"https://github.com/apache/bookkeeper/blob/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/DataFormats.java","raw_url":"https://github.com/apache/bookkeeper/raw/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/DataFormats.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/DataFormats.java?ref=8125700069b14f80ebd135ddd1a2b67de256cb1e","patch":"@@ -3574,6 +3574,381 @@ void setBookieId(com.google.protobuf.ByteString value) {\n     // @@protoc_insertion_point(class_scope:LockDataFormat)\n   }\n   \n+  public interface AuditorVoteFormatOrBuilder\n+      extends com.google.protobuf.MessageOrBuilder {\n+    \n+    // optional string bookieId = 1;\n+    boolean hasBookieId();\n+    String getBookieId();\n+  }\n+  public static final class AuditorVoteFormat extends\n+      com.google.protobuf.GeneratedMessage\n+      implements AuditorVoteFormatOrBuilder {\n+    // Use AuditorVoteFormat.newBuilder() to construct.\n+    private AuditorVoteFormat(Builder builder) {\n+      super(builder);\n+    }\n+    private AuditorVoteFormat(boolean noInit) {}\n+    \n+    private static final AuditorVoteFormat defaultInstance;\n+    public static AuditorVoteFormat getDefaultInstance() {\n+      return defaultInstance;\n+    }\n+    \n+    public AuditorVoteFormat getDefaultInstanceForType() {\n+      return defaultInstance;\n+    }\n+    \n+    public static final com.google.protobuf.Descriptors.Descriptor\n+        getDescriptor() {\n+      return org.apache.bookkeeper.proto.DataFormats.internal_static_AuditorVoteFormat_descriptor;\n+    }\n+    \n+    protected com.google.protobuf.GeneratedMessage.FieldAccessorTable\n+        internalGetFieldAccessorTable() {\n+      return org.apache.bookkeeper.proto.DataFormats.internal_static_AuditorVoteFormat_fieldAccessorTable;\n+    }\n+    \n+    private int bitField0_;\n+    // optional string bookieId = 1;\n+    public static final int BOOKIEID_FIELD_NUMBER = 1;\n+    private java.lang.Object bookieId_;\n+    public boolean hasBookieId() {\n+      return ((bitField0_ & 0x00000001) == 0x00000001);\n+    }\n+    public String getBookieId() {\n+      java.lang.Object ref = bookieId_;\n+      if (ref instanceof String) {\n+        return (String) ref;\n+      } else {\n+        com.google.protobuf.ByteString bs = \n+            (com.google.protobuf.ByteString) ref;\n+        String s = bs.toStringUtf8();\n+        if (com.google.protobuf.Internal.isValidUtf8(bs)) {\n+          bookieId_ = s;\n+        }\n+        return s;\n+      }\n+    }\n+    private com.google.protobuf.ByteString getBookieIdBytes() {\n+      java.lang.Object ref = bookieId_;\n+      if (ref instanceof String) {\n+        com.google.protobuf.ByteString b = \n+            com.google.protobuf.ByteString.copyFromUtf8((String) ref);\n+        bookieId_ = b;\n+        return b;\n+      } else {\n+        return (com.google.protobuf.ByteString) ref;\n+      }\n+    }\n+    \n+    private void initFields() {\n+      bookieId_ = \"\";\n+    }\n+    private byte memoizedIsInitialized = -1;\n+    public final boolean isInitialized() {\n+      byte isInitialized = memoizedIsInitialized;\n+      if (isInitialized != -1) return isInitialized == 1;\n+      \n+      memoizedIsInitialized = 1;\n+      return true;\n+    }\n+    \n+    public void writeTo(com.google.protobuf.CodedOutputStream output)\n+                        throws java.io.IOException {\n+      getSerializedSize();\n+      if (((bitField0_ & 0x00000001) == 0x00000001)) {\n+        output.writeBytes(1, getBookieIdBytes());\n+      }\n+      getUnknownFields().writeTo(output);\n+    }\n+    \n+    private int memoizedSerializedSize = -1;\n+    public int getSerializedSize() {\n+      int size = memoizedSerializedSize;\n+      if (size != -1) return size;\n+    \n+      size = 0;\n+      if (((bitField0_ & 0x00000001) == 0x00000001)) {\n+        size += com.google.protobuf.CodedOutputStream\n+          .computeBytesSize(1, getBookieIdBytes());\n+      }\n+      size += getUnknownFields().getSerializedSize();\n+      memoizedSerializedSize = size;\n+      return size;\n+    }\n+    \n+    private static final long serialVersionUID = 0L;\n+    @java.lang.Override\n+    protected java.lang.Object writeReplace()\n+        throws java.io.ObjectStreamException {\n+      return super.writeReplace();\n+    }\n+    \n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(\n+        com.google.protobuf.ByteString data)\n+        throws com.google.protobuf.InvalidProtocolBufferException {\n+      return newBuilder().mergeFrom(data).buildParsed();\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(\n+        com.google.protobuf.ByteString data,\n+        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n+        throws com.google.protobuf.InvalidProtocolBufferException {\n+      return newBuilder().mergeFrom(data, extensionRegistry)\n+               .buildParsed();\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(byte[] data)\n+        throws com.google.protobuf.InvalidProtocolBufferException {\n+      return newBuilder().mergeFrom(data).buildParsed();\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(\n+        byte[] data,\n+        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n+        throws com.google.protobuf.InvalidProtocolBufferException {\n+      return newBuilder().mergeFrom(data, extensionRegistry)\n+               .buildParsed();\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(java.io.InputStream input)\n+        throws java.io.IOException {\n+      return newBuilder().mergeFrom(input).buildParsed();\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(\n+        java.io.InputStream input,\n+        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n+        throws java.io.IOException {\n+      return newBuilder().mergeFrom(input, extensionRegistry)\n+               .buildParsed();\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseDelimitedFrom(java.io.InputStream input)\n+        throws java.io.IOException {\n+      Builder builder = newBuilder();\n+      if (builder.mergeDelimitedFrom(input)) {\n+        return builder.buildParsed();\n+      } else {\n+        return null;\n+      }\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseDelimitedFrom(\n+        java.io.InputStream input,\n+        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n+        throws java.io.IOException {\n+      Builder builder = newBuilder();\n+      if (builder.mergeDelimitedFrom(input, extensionRegistry)) {\n+        return builder.buildParsed();\n+      } else {\n+        return null;\n+      }\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(\n+        com.google.protobuf.CodedInputStream input)\n+        throws java.io.IOException {\n+      return newBuilder().mergeFrom(input).buildParsed();\n+    }\n+    public static org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat parseFrom(\n+        com.google.protobuf.CodedInputStream input,\n+        com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n+        throws java.io.IOException {\n+      return newBuilder().mergeFrom(input, extensionRegistry)\n+               .buildParsed();\n+    }\n+    \n+    public static Builder newBuilder() { return Builder.create(); }\n+    public Builder newBuilderForType() { return newBuilder(); }\n+    public static Builder newBuilder(org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat prototype) {\n+      return newBuilder().mergeFrom(prototype);\n+    }\n+    public Builder toBuilder() { return newBuilder(this); }\n+    \n+    @java.lang.Override\n+    protected Builder newBuilderForType(\n+        com.google.protobuf.GeneratedMessage.BuilderParent parent) {\n+      Builder builder = new Builder(parent);\n+      return builder;\n+    }\n+    public static final class Builder extends\n+        com.google.protobuf.GeneratedMessage.Builder<Builder>\n+       implements org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormatOrBuilder {\n+      public static final com.google.protobuf.Descriptors.Descriptor\n+          getDescriptor() {\n+        return org.apache.bookkeeper.proto.DataFormats.internal_static_AuditorVoteFormat_descriptor;\n+      }\n+      \n+      protected com.google.protobuf.GeneratedMessage.FieldAccessorTable\n+          internalGetFieldAccessorTable() {\n+        return org.apache.bookkeeper.proto.DataFormats.internal_static_AuditorVoteFormat_fieldAccessorTable;\n+      }\n+      \n+      // Construct using org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat.newBuilder()\n+      private Builder() {\n+        maybeForceBuilderInitialization();\n+      }\n+      \n+      private Builder(BuilderParent parent) {\n+        super(parent);\n+        maybeForceBuilderInitialization();\n+      }\n+      private void maybeForceBuilderInitialization() {\n+        if (com.google.protobuf.GeneratedMessage.alwaysUseFieldBuilders) {\n+        }\n+      }\n+      private static Builder create() {\n+        return new Builder();\n+      }\n+      \n+      public Builder clear() {\n+        super.clear();\n+        bookieId_ = \"\";\n+        bitField0_ = (bitField0_ & ~0x00000001);\n+        return this;\n+      }\n+      \n+      public Builder clone() {\n+        return create().mergeFrom(buildPartial());\n+      }\n+      \n+      public com.google.protobuf.Descriptors.Descriptor\n+          getDescriptorForType() {\n+        return org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat.getDescriptor();\n+      }\n+      \n+      public org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat getDefaultInstanceForType() {\n+        return org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat.getDefaultInstance();\n+      }\n+      \n+      public org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat build() {\n+        org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat result = buildPartial();\n+        if (!result.isInitialized()) {\n+          throw newUninitializedMessageException(result);\n+        }\n+        return result;\n+      }\n+      \n+      private org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat buildParsed()\n+          throws com.google.protobuf.InvalidProtocolBufferException {\n+        org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat result = buildPartial();\n+        if (!result.isInitialized()) {\n+          throw newUninitializedMessageException(\n+            result).asInvalidProtocolBufferException();\n+        }\n+        return result;\n+      }\n+      \n+      public org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat buildPartial() {\n+        org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat result = new org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat(this);\n+        int from_bitField0_ = bitField0_;\n+        int to_bitField0_ = 0;\n+        if (((from_bitField0_ & 0x00000001) == 0x00000001)) {\n+          to_bitField0_ |= 0x00000001;\n+        }\n+        result.bookieId_ = bookieId_;\n+        result.bitField0_ = to_bitField0_;\n+        onBuilt();\n+        return result;\n+      }\n+      \n+      public Builder mergeFrom(com.google.protobuf.Message other) {\n+        if (other instanceof org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat) {\n+          return mergeFrom((org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat)other);\n+        } else {\n+          super.mergeFrom(other);\n+          return this;\n+        }\n+      }\n+      \n+      public Builder mergeFrom(org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat other) {\n+        if (other == org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat.getDefaultInstance()) return this;\n+        if (other.hasBookieId()) {\n+          setBookieId(other.getBookieId());\n+        }\n+        this.mergeUnknownFields(other.getUnknownFields());\n+        return this;\n+      }\n+      \n+      public final boolean isInitialized() {\n+        return true;\n+      }\n+      \n+      public Builder mergeFrom(\n+          com.google.protobuf.CodedInputStream input,\n+          com.google.protobuf.ExtensionRegistryLite extensionRegistry)\n+          throws java.io.IOException {\n+        com.google.protobuf.UnknownFieldSet.Builder unknownFields =\n+          com.google.protobuf.UnknownFieldSet.newBuilder(\n+            this.getUnknownFields());\n+        while (true) {\n+          int tag = input.readTag();\n+          switch (tag) {\n+            case 0:\n+              this.setUnknownFields(unknownFields.build());\n+              onChanged();\n+              return this;\n+            default: {\n+              if (!parseUnknownField(input, unknownFields,\n+                                     extensionRegistry, tag)) {\n+                this.setUnknownFields(unknownFields.build());\n+                onChanged();\n+                return this;\n+              }\n+              break;\n+            }\n+            case 10: {\n+              bitField0_ |= 0x00000001;\n+              bookieId_ = input.readBytes();\n+              break;\n+            }\n+          }\n+        }\n+      }\n+      \n+      private int bitField0_;\n+      \n+      // optional string bookieId = 1;\n+      private java.lang.Object bookieId_ = \"\";\n+      public boolean hasBookieId() {\n+        return ((bitField0_ & 0x00000001) == 0x00000001);\n+      }\n+      public String getBookieId() {\n+        java.lang.Object ref = bookieId_;\n+        if (!(ref instanceof String)) {\n+          String s = ((com.google.protobuf.ByteString) ref).toStringUtf8();\n+          bookieId_ = s;\n+          return s;\n+        } else {\n+          return (String) ref;\n+        }\n+      }\n+      public Builder setBookieId(String value) {\n+        if (value == null) {\n+    throw new NullPointerException();\n+  }\n+  bitField0_ |= 0x00000001;\n+        bookieId_ = value;\n+        onChanged();\n+        return this;\n+      }\n+      public Builder clearBookieId() {\n+        bitField0_ = (bitField0_ & ~0x00000001);\n+        bookieId_ = getDefaultInstance().getBookieId();\n+        onChanged();\n+        return this;\n+      }\n+      void setBookieId(com.google.protobuf.ByteString value) {\n+        bitField0_ |= 0x00000001;\n+        bookieId_ = value;\n+        onChanged();\n+      }\n+      \n+      // @@protoc_insertion_point(builder_scope:AuditorVoteFormat)\n+    }\n+    \n+    static {\n+      defaultInstance = new AuditorVoteFormat(true);\n+      defaultInstance.initFields();\n+    }\n+    \n+    // @@protoc_insertion_point(class_scope:AuditorVoteFormat)\n+  }\n+  \n   private static com.google.protobuf.Descriptors.Descriptor\n     internal_static_LedgerMetadataFormat_descriptor;\n   private static\n@@ -3604,6 +3979,11 @@ void setBookieId(com.google.protobuf.ByteString value) {\n   private static\n     com.google.protobuf.GeneratedMessage.FieldAccessorTable\n       internal_static_LockDataFormat_fieldAccessorTable;\n+  private static com.google.protobuf.Descriptors.Descriptor\n+    internal_static_AuditorVoteFormat_descriptor;\n+  private static\n+    com.google.protobuf.GeneratedMessage.FieldAccessorTable\n+      internal_static_AuditorVoteFormat_fieldAccessorTable;\n   \n   public static com.google.protobuf.Descriptors.FileDescriptor\n       getDescriptor() {\n@@ -3630,8 +4010,9 @@ void setBookieId(com.google.protobuf.ByteString value) {\n       \"erFormat\\022\\017\\n\\007replica\\030\\001 \\003(\\t\\\"^\\n\\014CookieForma\" +\n       \"t\\022\\022\\n\\nbookieHost\\030\\001 \\002(\\t\\022\\022\\n\\njournalDir\\030\\002 \\002(\" +\n       \"\\t\\022\\022\\n\\nledgerDirs\\030\\003 \\002(\\t\\022\\022\\n\\ninstanceId\\030\\004 \\001(\" +\n-      \"\\t\\\"\\\"\\n\\016LockDataFormat\\022\\020\\n\\010bookieId\\030\\001 \\001(\\tB\\037\\n\" +\n-      \"\\033org.apache.bookkeeper.protoH\\001\"\n+      \"\\t\\\"\\\"\\n\\016LockDataFormat\\022\\020\\n\\010bookieId\\030\\001 \\001(\\t\\\"%\\n\" +\n+      \"\\021AuditorVoteFormat\\022\\020\\n\\010bookieId\\030\\001 \\001(\\tB\\037\\n\\033\" +\n+      \"org.apache.bookkeeper.protoH\\001\"\n     };\n     com.google.protobuf.Descriptors.FileDescriptor.InternalDescriptorAssigner assigner =\n       new com.google.protobuf.Descriptors.FileDescriptor.InternalDescriptorAssigner() {\n@@ -3686,6 +4067,14 @@ void setBookieId(com.google.protobuf.ByteString value) {\n               new java.lang.String[] { \"BookieId\", },\n               org.apache.bookkeeper.proto.DataFormats.LockDataFormat.class,\n               org.apache.bookkeeper.proto.DataFormats.LockDataFormat.Builder.class);\n+          internal_static_AuditorVoteFormat_descriptor =\n+            getDescriptor().getMessageTypes().get(5);\n+          internal_static_AuditorVoteFormat_fieldAccessorTable = new\n+            com.google.protobuf.GeneratedMessage.FieldAccessorTable(\n+              internal_static_AuditorVoteFormat_descriptor,\n+              new java.lang.String[] { \"BookieId\", },\n+              org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat.class,\n+              org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat.Builder.class);\n           return null;\n         }\n       };"},{"sha":"1b876fcb7126367a6ebf0459d269740e1ebca7dc","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java","status":"modified","additions":11,"deletions":2,"changes":13,"blob_url":"https://github.com/apache/bookkeeper/blob/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java","raw_url":"https://github.com/apache/bookkeeper/raw/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/AuditorElector.java?ref=8125700069b14f80ebd135ddd1a2b67de256cb1e","patch":"@@ -25,6 +25,7 @@\n import java.util.List;\n import java.io.Serializable;\n \n+import org.apache.bookkeeper.proto.DataFormats.AuditorVoteFormat;\n import org.apache.bookkeeper.conf.AbstractConfiguration;\n import org.apache.bookkeeper.replication.ReplicationException.UnavailableException;\n import org.apache.bookkeeper.util.BookKeeperConstants;\n@@ -36,6 +37,9 @@\n import org.apache.zookeeper.ZooKeeper;\n import org.apache.zookeeper.Watcher.Event.EventType;\n import org.apache.zookeeper.ZooDefs.Ids;\n+import com.google.protobuf.TextFormat;\n+import static com.google.common.base.Charsets.UTF_8;\n+\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n@@ -122,7 +126,10 @@ public void doElection() throws UnavailableException {\n             if (children.get(AUDITOR_INDEX).equals(voteNode)) {\n                 // update the auditor bookie id in the election path. This is\n                 // done for debugging purpose\n-                zkc.setData(getVotePath(\"\"), bookieId.getBytes(), -1);\n+                AuditorVoteFormat.Builder builder = AuditorVoteFormat.newBuilder()\n+                    .setBookieId(bookieId);\n+\n+                zkc.setData(getVotePath(\"\"), TextFormat.printToString(builder.build()).getBytes(UTF_8), -1);\n                 auditor = new Auditor(bookieId, conf, zkc);\n                 auditor.start();\n             } else {\n@@ -150,8 +157,10 @@ public void doElection() throws UnavailableException {\n \n     private void createMyVote() throws KeeperException, InterruptedException {\n         if (null == myVote || null == zkc.exists(myVote, false)) {\n+            AuditorVoteFormat.Builder builder = AuditorVoteFormat.newBuilder()\n+                .setBookieId(bookieId);\n             myVote = zkc.create(getVotePath(PATH_SEPARATOR + VOTE_PREFIX),\n-                    bookieId.getBytes(), Ids.OPEN_ACL_UNSAFE,\n+                    TextFormat.printToString(builder.build()).getBytes(UTF_8), Ids.OPEN_ACL_UNSAFE,\n                     CreateMode.EPHEMERAL_SEQUENTIAL);\n         }\n     }"},{"sha":"67623ac614880b11684afff624e8f5b0551f1854","filename":"bookkeeper-server/src/main/proto/DataFormats.proto","status":"modified","additions":7,"deletions":0,"changes":7,"blob_url":"https://github.com/apache/bookkeeper/blob/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/proto/DataFormats.proto","raw_url":"https://github.com/apache/bookkeeper/raw/8125700069b14f80ebd135ddd1a2b67de256cb1e/bookkeeper-server/src/main/proto/DataFormats.proto","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/proto/DataFormats.proto?ref=8125700069b14f80ebd135ddd1a2b67de256cb1e","patch":"@@ -74,4 +74,11 @@ message CookieFormat {\n  */\n message LockDataFormat {\n     optional string bookieId = 1;\n+}\n+\n+/**\n+ * Debug information for auditor votes\n+ */\n+message AuditorVoteFormat {\n+    optional string bookieId = 1;\n }\n\\ No newline at end of file"}]}

