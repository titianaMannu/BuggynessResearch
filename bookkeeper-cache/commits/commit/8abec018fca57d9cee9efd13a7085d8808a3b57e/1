{"sha":"8abec018fca57d9cee9efd13a7085d8808a3b57e","node_id":"MDY6Q29tbWl0MTU3NTk1Njo4YWJlYzAxOGZjYTU3ZDljZWU5ZWZkMTNhNzA4NWQ4ODA4YTNiNTdl","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2014-09-06T05:51:08Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2014-09-06T05:51:08Z"},"message":"BOOKKEEPER-718: AuditorLedgerCheckerTest is flakey (ivank via sijie)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1622830 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"1bac5d50ce5d98e7133c7cbfbf5095ca3f7f9e7f","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/1bac5d50ce5d98e7133c7cbfbf5095ca3f7f9e7f"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/8abec018fca57d9cee9efd13a7085d8808a3b57e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/8abec018fca57d9cee9efd13a7085d8808a3b57e","html_url":"https://github.com/apache/bookkeeper/commit/8abec018fca57d9cee9efd13a7085d8808a3b57e","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/8abec018fca57d9cee9efd13a7085d8808a3b57e/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"fd6835e4f06d3cbb6a33062f582e4756d0a3139b","url":"https://api.github.com/repos/apache/bookkeeper/commits/fd6835e4f06d3cbb6a33062f582e4756d0a3139b","html_url":"https://github.com/apache/bookkeeper/commit/fd6835e4f06d3cbb6a33062f582e4756d0a3139b"}],"stats":{"total":19,"additions":17,"deletions":2},"files":[{"sha":"943d23da8c8b696e89e2f5a253e1c0c85c212c7d","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/8abec018fca57d9cee9efd13a7085d8808a3b57e/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/8abec018fca57d9cee9efd13a7085d8808a3b57e/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=8abec018fca57d9cee9efd13a7085d8808a3b57e","patch":"@@ -220,6 +220,8 @@ Trunk (unreleased changes)\n \n         BOOKKEEPER-777: Flake in LedgerCloseTest (ivank via fpj)\n \n+        BOOKKEEPER-718: AuditorLedgerCheckerTest is flakey (ivank via sijie)\n+\n       bookkeeper-benchmark:\n \n         BOOKKEEPER-768: fix typo 'seconds' to milliseconds in benchmark output (jialin via sijie)"},{"sha":"18a801cba914b2f6ce25af904a6d4d44ce9e0b2f","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java","status":"modified","additions":15,"deletions":2,"changes":17,"blob_url":"https://github.com/apache/bookkeeper/blob/8abec018fca57d9cee9efd13a7085d8808a3b57e/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java","raw_url":"https://github.com/apache/bookkeeper/raw/8abec018fca57d9cee9efd13a7085d8808a3b57e/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeperAdmin.java?ref=8abec018fca57d9cee9efd13a7085d8808a3b57e","patch":"@@ -65,11 +65,14 @@\n     private final static Logger LOG = LoggerFactory.getLogger(BookKeeperAdmin.class);\n     // ZK client instance\n     private ZooKeeper zk;\n+    private final boolean ownsZK;\n+\n     // ZK ledgers related String constants\n     private final String bookiesPath;\n \n     // BookKeeper client instance\n     private BookKeeper bkc;\n+    private final boolean ownsBK;\n \n     // LedgerFragmentReplicator instance\n     private LedgerFragmentReplicator lfr;\n@@ -125,10 +128,14 @@ public BookKeeperAdmin(ClientConfiguration conf) throws IOException, Interrupted\n         // Create the ZooKeeper client instance\n         ZooKeeperWatcherBase w = new ZooKeeperWatcherBase(conf.getZkTimeout());\n         zk = ZkUtils.createConnectedZookeeperClient(conf.getZkServers(), w);\n+        ownsZK = true;\n+\n         // Create the bookie path\n         bookiesPath = conf.getZkAvailableBookiesPath();\n         // Create the BookKeeper client instance\n         bkc = new BookKeeper(conf, zk);\n+        ownsBK = true;\n+\n         this.lfr = new LedgerFragmentReplicator(bkc);\n     }\n \n@@ -141,7 +148,9 @@ public BookKeeperAdmin(ClientConfiguration conf) throws IOException, Interrupted\n      */\n     public BookKeeperAdmin(final BookKeeper bkc) {\n         this.bkc = bkc;\n+        ownsBK = false;\n         this.zk = bkc.zk;\n+        ownsZK = false;\n         this.bookiesPath = bkc.getConf().getZkAvailableBookiesPath();\n         this.lfr = new LedgerFragmentReplicator(bkc);\n     }\n@@ -154,8 +163,12 @@ public BookKeeperAdmin(final BookKeeper bkc) {\n      *             class uses.\n      */\n     public void close() throws InterruptedException, BKException {\n-        bkc.close();\n-        zk.close();\n+        if (ownsBK) {\n+            bkc.close();\n+        }\n+        if (ownsZK) {\n+            zk.close();\n+        }\n     }\n \n     /**"}]}

