{"sha":"9868081b708b27f272e2a92cf04163996caf9544","node_id":"MDY6Q29tbWl0MTU3NTk1Njo5ODY4MDgxYjcwOGIyN2YyNzJlMmE5MmNmMDQxNjM5OTZjYWY5NTQ0","commit":{"author":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2013-03-17T23:40:07Z"},"committer":{"name":"Sijie Guo","email":"sijie@apache.org","date":"2013-03-17T23:40:07Z"},"message":"BOOKKEEPER-573: Script to start a bookkeeper cluster (ivank via sijie)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1457598 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"8aa28eb5a709cf1d3d7a361d415bcaff73aaa529","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/8aa28eb5a709cf1d3d7a361d415bcaff73aaa529"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/9868081b708b27f272e2a92cf04163996caf9544","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/9868081b708b27f272e2a92cf04163996caf9544","html_url":"https://github.com/apache/bookkeeper/commit/9868081b708b27f272e2a92cf04163996caf9544","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/9868081b708b27f272e2a92cf04163996caf9544/comments","author":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"committer":{"login":"sijie","id":1217863,"node_id":"MDQ6VXNlcjEyMTc4NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1217863?v=4","gravatar_id":"","url":"https://api.github.com/users/sijie","html_url":"https://github.com/sijie","followers_url":"https://api.github.com/users/sijie/followers","following_url":"https://api.github.com/users/sijie/following{/other_user}","gists_url":"https://api.github.com/users/sijie/gists{/gist_id}","starred_url":"https://api.github.com/users/sijie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sijie/subscriptions","organizations_url":"https://api.github.com/users/sijie/orgs","repos_url":"https://api.github.com/users/sijie/repos","events_url":"https://api.github.com/users/sijie/events{/privacy}","received_events_url":"https://api.github.com/users/sijie/received_events","type":"User","site_admin":false},"parents":[{"sha":"9f0d2a3e2f4279921f8fa1df8aad708773124cd5","url":"https://api.github.com/repos/apache/bookkeeper/commits/9f0d2a3e2f4279921f8fa1df8aad708773124cd5","html_url":"https://github.com/apache/bookkeeper/commit/9f0d2a3e2f4279921f8fa1df8aad708773124cd5"}],"stats":{"total":137,"additions":137,"deletions":0},"files":[{"sha":"83e9dfb2bf963fbfaf3e534f0587742f43af5588","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/9868081b708b27f272e2a92cf04163996caf9544/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/9868081b708b27f272e2a92cf04163996caf9544/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=9868081b708b27f272e2a92cf04163996caf9544","patch":"@@ -48,6 +48,8 @@ Trunk (unreleased changes)\n \n       BOOKKEEPER-585: Auditor logs noisily when a ledger has been deleted (ivank via sijie)\n \n+      BOOKKEEPER-573: Script to start a bookkeeper cluster (ivank via sijie)\n+\n Release 4.2.0 - 2013-01-14\n \n   Non-backward compatible changes:"},{"sha":"d27236d25a116db3592f9461c90959c58058023d","filename":"bookkeeper-server/bin/bookkeeper-cluster.sh","status":"added","additions":135,"deletions":0,"changes":135,"blob_url":"https://github.com/apache/bookkeeper/blob/9868081b708b27f272e2a92cf04163996caf9544/bookkeeper-server/bin/bookkeeper-cluster.sh","raw_url":"https://github.com/apache/bookkeeper/raw/9868081b708b27f272e2a92cf04163996caf9544/bookkeeper-server/bin/bookkeeper-cluster.sh","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/bin/bookkeeper-cluster.sh?ref=9868081b708b27f272e2a92cf04163996caf9544","patch":"@@ -0,0 +1,135 @@\n+#!/usr/bin/env bash\n+#\n+#/**\n+# * Licensed to the Apache Software Foundation (ASF) under one\n+# * or more contributor license agreements.  See the NOTICE file\n+# * distributed with this work for additional information\n+# * regarding copyright ownership.  The ASF licenses this file\n+# * to you under the Apache License, Version 2.0 (the\n+# * \"License\"); you may not use this file except in compliance\n+# * with the License.  You may obtain a copy of the License at\n+# *\n+# *     http://www.apache.org/licenses/LICENSE-2.0\n+# *\n+# * Unless required by applicable law or agreed to in writing, software\n+# * distributed under the License is distributed on an \"AS IS\" BASIS,\n+# * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# * See the License for the specific language governing permissions and\n+# * limitations under the License.\n+# */\n+\n+\n+BINDIR=`dirname \"$0\"`\n+BK_HOME=`cd $BINDIR/..;pwd`\n+if [ -f $BK_HOME/conf/bkenv.sh ]\n+then\n+ . $BK_HOME/conf/bkenv.sh\n+fi\n+\n+BKCFG=$BK_HOME/conf/bk_server.conf\n+CLUSTER=$BK_HOME/conf/bookies\n+usage() {\n+    cat <<EOF\n+Usage: bookkeeper-cluster.sh (start|stop|kill)\n+\n+The list of hosts in the cluster must be available in\n+$CLUSTER\n+with one hostname per line.\n+\n+BookKeeper must be installed in the same location on each host.\n+EOF\n+}\n+\n+if [ ! -f $CLUSTER ]; then\n+    echo -e \"\\nCluster file ($CLUSTER) does not exist\\n\"\n+    usage\n+    exit 1\n+fi\n+\n+NUMHOSTS=$(wc -l $CLUSTER | awk '{print $1}')\n+if [ \"$NUMHOSTS\" = \"0\" ]; then\n+    echo -e \"\\nCluster file ($CLUSTER) is empty\\n\"\n+    usage\n+    exit 1\n+fi\n+\n+bookies_list() {\n+    $BINDIR/bookkeeper shell listbookies 2> /dev/null\n+}\n+\n+bookies_available() {\n+    bookies_list | wc -l\n+}\n+\n+start() {\n+    for B in `cat $CLUSTER`; do\n+\techo \"Starting bookie on $B\"\n+\tssh $B $BINDIR/bookkeeper-daemon.sh start bookie\n+    done\n+\n+    BOOKIESSTARTED=0\n+    COUNT=0\n+\n+    while [ $BOOKIESSTARTED -lt $NUMHOSTS ];  do\n+\tsleep 1\n+\tCOUNT=$(($COUNT+1))\n+\tif [ $COUNT = 20 ]; then\n+\t    echo \"Could not start all bookies\"\n+\t    exit 1\n+\tfi\n+\n+\tBOOKIESSTARTED=$(bookies_available)\n+\n+\techo \"$BOOKIESSTARTED bookies started\"\n+    done\n+}\n+\n+stop() {\n+    for B in `cat $CLUSTER`; do\n+\techo \"Stopping bookie on $B\"\n+\tssh $B $BINDIR/bookkeeper-daemon.sh stop bookie $FORCE\n+    done\n+\n+    COUNT=0\n+    BOOKIESSTARTED=$NUMHOSTS\n+    while [ $BOOKIESSTARTED -gt 0 ];  do\n+\tsleep 1\n+\t\n+\tCOUNT=$((COUNT+1))\n+\tif [ $COUNT = 20 ]; then\n+\t    echo \"Couldn not stop all bookies. $BOOKIESSTARTED still running\"\n+\t    exit 2\n+\tfi\n+\n+\tBOOKIESSTARTED=$(bookies_available)\n+    done\n+}\n+\n+status() {\n+    BOOKIESSTARTED=$(bookies_available)\n+    echo \"$BOOKIESSTARTED bookies running\"\n+    COUNT=1\n+    for b in $(bookies_list); do\n+\techo \"$COUNT: $b\"\n+\tCOUNT=$(($COUNT+1))\n+    done\n+}\n+\n+case $1 in\n+    start)\n+\tstart\n+\t;;\n+    stop)\n+\tstop\n+\t;;\n+    kill)\n+\tFORCE=\"-force\"\n+\tstop\n+\t;;\n+    status)\n+\tstatus\n+\t;;\n+    *)\n+\tusage\n+\t;;\n+esac"}]}

