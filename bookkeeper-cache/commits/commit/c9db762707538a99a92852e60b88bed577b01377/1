{"sha":"c9db762707538a99a92852e60b88bed577b01377","node_id":"MDY6Q29tbWl0MTU3NTk1NjpjOWRiNzYyNzA3NTM4YTk5YTkyODUyZTYwYjg4YmVkNTc3YjAxMzc3","commit":{"author":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2014-06-10T10:01:45Z"},"committer":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2014-06-10T10:01:45Z"},"message":"BOOKKEEPER-765 bookkeeper script should fall back to java in path if JAVA_HOME is not set (ivank)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1601592 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a993ecd52afc91703df176727a9b7515c4be9037","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/a993ecd52afc91703df176727a9b7515c4be9037"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/c9db762707538a99a92852e60b88bed577b01377","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/c9db762707538a99a92852e60b88bed577b01377","html_url":"https://github.com/apache/bookkeeper/commit/c9db762707538a99a92852e60b88bed577b01377","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/c9db762707538a99a92852e60b88bed577b01377/comments","author":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"committer":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"parents":[{"sha":"80c6e5526c63409e4f359905d0fd319ac7d2b129","url":"https://api.github.com/repos/apache/bookkeeper/commits/80c6e5526c63409e4f359905d0fd319ac7d2b129","html_url":"https://github.com/apache/bookkeeper/commit/80c6e5526c63409e4f359905d0fd319ac7d2b129"}],"stats":{"total":50,"additions":39,"deletions":11},"files":[{"sha":"53f91234eee65fb599d06f6e2a644655af8e53e1","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/c9db762707538a99a92852e60b88bed577b01377/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/c9db762707538a99a92852e60b88bed577b01377/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=c9db762707538a99a92852e60b88bed577b01377","patch":"@@ -64,6 +64,8 @@ Trunk (unreleased changes)\n       \n       BOOKKEEPER-767: Allow loopback in tests (ivank via fpj)\n \n+      BOOKKEEPER-765: bookkeeper script should fall back to java in path if JAVA_HOME is not set (ivank)\n+\n       bookkeeper-server:\n \n         BOOKKEEPER-567: ReadOnlyBookieTest hangs on shutdown (sijie via ivank)"},{"sha":"daa499170839896c041727bd82e4fc907cf7020d","filename":"bookkeeper-server/bin/bookkeeper","status":"modified","additions":13,"deletions":7,"changes":20,"blob_url":"https://github.com/apache/bookkeeper/blob/c9db762707538a99a92852e60b88bed577b01377/bookkeeper-server/bin/bookkeeper","raw_url":"https://github.com/apache/bookkeeper/raw/c9db762707538a99a92852e60b88bed577b01377/bookkeeper-server/bin/bookkeeper","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/bin/bookkeeper?ref=c9db762707538a99a92852e60b88bed577b01377","patch":"@@ -20,13 +20,6 @@\n # * limitations under the License.\n # */\n \n-# Check for the Java\n-if [[ -z $JAVA_HOME ]]; then\n-   echo \"Error: JAVA_HOME is not set\" 1>&2\n-   exit 1\n-fi\n-JAVA=$JAVA_HOME/bin/java\n-\n # check if net.ipv6.bindv6only is set to 1\n bindv6only=$(/sbin/sysctl -n net.ipv6.bindv6only 2> /dev/null)\n if [ -n \"$bindv6only\" ] && [ \"$bindv6only\" -eq \"1\" ]\n@@ -64,6 +57,19 @@ DEFAULT_LOG_CONF=$BK_HOME/conf/log4j.properties\n \n source $BK_HOME/conf/bkenv.sh\n \n+# Check for the java to use\n+if [[ -z $JAVA_HOME ]]; then\n+    JAVA=$(which java)\n+    if [ $? = 0 ]; then\n+        echo \"JAVA_HOME not set, using java from PATH. ($JAVA)\"\n+    else\n+        echo \"Error: JAVA_HOME not set, and no java executable found in $PATH.\" 1>&2\n+        exit 1\n+    fi\n+else\n+    JAVA=$JAVA_HOME/bin/java\n+fi\n+\n # exclude tests jar\n RELEASE_JAR=`ls $BK_HOME/bookkeeper-server-*.jar 2> /dev/null | grep -v tests | tail -1` \n if [ $? == 0 ]; then"},{"sha":"c85b295c23dec0ebee6f361f73e6beaf478974c5","filename":"bookkeeper-server/conf/bkenv.sh","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/apache/bookkeeper/blob/c9db762707538a99a92852e60b88bed577b01377/bookkeeper-server/conf/bkenv.sh","raw_url":"https://github.com/apache/bookkeeper/raw/c9db762707538a99a92852e60b88bed577b01377/bookkeeper-server/conf/bkenv.sh","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/conf/bkenv.sh?ref=c9db762707538a99a92852e60b88bed577b01377","patch":"@@ -20,6 +20,9 @@\n # * limitations under the License.\n # */\n \n+# Set JAVA_HOME here to override the environment setting\n+# JAVA_HOME=\n+\n # default settings for starting bookkeeper\n \n # Configuration file of settings used in bookie server\n@@ -44,4 +47,4 @@\n #BOOKIE_STOP_TIMEOUT=\n \n #Entry formatter class to format entries.\n-#ENTRY_FORMATTER_CLASS=\n\\ No newline at end of file\n+#ENTRY_FORMATTER_CLASS="},{"sha":"a2ff83b839f95130eaf3d6a57561b929c3bccd62","filename":"hedwig-server/bin/hedwig","status":"modified","additions":17,"deletions":3,"changes":20,"blob_url":"https://github.com/apache/bookkeeper/blob/c9db762707538a99a92852e60b88bed577b01377/hedwig-server/bin/hedwig","raw_url":"https://github.com/apache/bookkeeper/raw/c9db762707538a99a92852e60b88bed577b01377/hedwig-server/bin/hedwig","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/hedwig-server/bin/hedwig?ref=c9db762707538a99a92852e60b88bed577b01377","patch":"@@ -58,7 +58,21 @@ DEFAULT_LOG_CONF=$HW_HOME/conf/log4j.properties\n \n . $HW_HOME/conf/hwenv.sh\n \n+# Check for the java to use\n+if [[ -z $JAVA_HOME ]]; then\n+    JAVA=$(which java)\n+    if [ $? = 0 ]; then\n+        echo \"JAVA_HOME not set, using java from PATH. ($JAVA)\"\n+    else\n+        echo \"Error: JAVA_HOME not set, and no java executable found in $PATH.\" 1>&2\n+        exit 1\n+    fi\n+else\n+    JAVA=$JAVA_HOME/bin/java\n+fi\n+\n RELEASE_JAR=`ls $HW_HOME/hedwig-server-*.jar 2> /dev/null | grep -v tests | tail -1`\n+\n if [ $? == 0 ]; then\n     HEDWIG_JAR=$RELEASE_JAR\n fi\n@@ -171,7 +185,7 @@ OPTS=\"$OPTS -Dhedwig.log.file=$HEDWIG_LOG_FILE\"\n # Change to HW_HOME to support relative paths\n cd \"$BK_HOME\"\n if [ $COMMAND == \"server\" ]; then\n-    exec java $OPTS $JMX_ARGS org.apache.hedwig.server.netty.PubSubServer $HEDWIG_SERVER_CONF $HEDWIG_REGION_CLIENT_CONF $@\n+    exec $JAVA $OPTS $JMX_ARGS org.apache.hedwig.server.netty.PubSubServer $HEDWIG_SERVER_CONF $HEDWIG_REGION_CLIENT_CONF $@\n elif [ $COMMAND == \"console\" ]; then\n     # hedwig console configuration server part\n     if [ -z \"$HEDWIG_CONSOLE_SERVER_CONF\" ]; then\n@@ -181,11 +195,11 @@ elif [ $COMMAND == \"console\" ]; then\n     if [ -n \"$HEDWIG_CONSOLE_CLIENT_CONF\" ]; then\n         HEDWIG_CONSOLE_CLIENT_OPTIONS=\"-client-cfg $HEDWIG_CONSOLE_CLIENT_CONF\"\n     fi\n-    exec java $OPTS org.apache.hedwig.admin.console.HedwigConsole -server-cfg $HEDWIG_CONSOLE_SERVER_CONF $HEDWIG_CONSOLE_CLIENT_OPTIONS $@\n+    exec $JAVA $OPTS org.apache.hedwig.admin.console.HedwigConsole -server-cfg $HEDWIG_CONSOLE_SERVER_CONF $HEDWIG_CONSOLE_CLIENT_OPTIONS $@\n elif [ $COMMAND == \"help\" ]; then\n     hedwig_help;\n else\n-    exec java $OPTS $COMMAND $@\n+    exec $JAVA $OPTS $COMMAND $@\n fi\n \n "},{"sha":"8d379b6a11d5ba580f21e7a73fa7d0c54ae5d36a","filename":"hedwig-server/conf/hwenv.sh","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/apache/bookkeeper/blob/c9db762707538a99a92852e60b88bed577b01377/hedwig-server/conf/hwenv.sh","raw_url":"https://github.com/apache/bookkeeper/raw/c9db762707538a99a92852e60b88bed577b01377/hedwig-server/conf/hwenv.sh","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/hedwig-server/conf/hwenv.sh?ref=c9db762707538a99a92852e60b88bed577b01377","patch":"@@ -20,6 +20,9 @@\n # * limitations under the License.\n # */\n \n+# Set JAVA_HOME here to override the environment setting\n+# JAVA_HOME=\n+\n # default settings for starting hedwig\n # HEDWIG_SERVER_CONF=\n "}]}

