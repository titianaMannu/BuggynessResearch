{"sha":"cc28541520136968edd3258861e88c5433c5e154","node_id":"MDY6Q29tbWl0MTU3NTk1NjpjYzI4NTQxNTIwMTM2OTY4ZWRkMzI1ODg2MWU4OGM1NDMzYzVlMTU0","commit":{"author":{"name":"Flavio Paiva Junqueira","email":"fpj@apache.org","date":"2012-05-25T14:38:23Z"},"committer":{"name":"Flavio Paiva Junqueira","email":"fpj@apache.org","date":"2012-05-25T14:38:23Z"},"message":"BOOKKEEPER-265: Review JMX documentation (sijie via fpj)\n\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1342646 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"fdaaf2c08f61c8cd4b77fc07ca7ae1d7f2ecd4bb","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/fdaaf2c08f61c8cd4b77fc07ca7ae1d7f2ecd4bb"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/cc28541520136968edd3258861e88c5433c5e154","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/cc28541520136968edd3258861e88c5433c5e154","html_url":"https://github.com/apache/bookkeeper/commit/cc28541520136968edd3258861e88c5433c5e154","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/cc28541520136968edd3258861e88c5433c5e154/comments","author":{"login":"fpj","id":572920,"node_id":"MDQ6VXNlcjU3MjkyMA==","avatar_url":"https://avatars.githubusercontent.com/u/572920?v=4","gravatar_id":"","url":"https://api.github.com/users/fpj","html_url":"https://github.com/fpj","followers_url":"https://api.github.com/users/fpj/followers","following_url":"https://api.github.com/users/fpj/following{/other_user}","gists_url":"https://api.github.com/users/fpj/gists{/gist_id}","starred_url":"https://api.github.com/users/fpj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fpj/subscriptions","organizations_url":"https://api.github.com/users/fpj/orgs","repos_url":"https://api.github.com/users/fpj/repos","events_url":"https://api.github.com/users/fpj/events{/privacy}","received_events_url":"https://api.github.com/users/fpj/received_events","type":"User","site_admin":false},"committer":{"login":"fpj","id":572920,"node_id":"MDQ6VXNlcjU3MjkyMA==","avatar_url":"https://avatars.githubusercontent.com/u/572920?v=4","gravatar_id":"","url":"https://api.github.com/users/fpj","html_url":"https://github.com/fpj","followers_url":"https://api.github.com/users/fpj/followers","following_url":"https://api.github.com/users/fpj/following{/other_user}","gists_url":"https://api.github.com/users/fpj/gists{/gist_id}","starred_url":"https://api.github.com/users/fpj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fpj/subscriptions","organizations_url":"https://api.github.com/users/fpj/orgs","repos_url":"https://api.github.com/users/fpj/repos","events_url":"https://api.github.com/users/fpj/events{/privacy}","received_events_url":"https://api.github.com/users/fpj/received_events","type":"User","site_admin":false},"parents":[{"sha":"7ed489997c11c891f91b9fe0659c803a87d57489","url":"https://api.github.com/repos/apache/bookkeeper/commits/7ed489997c11c891f91b9fe0659c803a87d57489","html_url":"https://github.com/apache/bookkeeper/commit/7ed489997c11c891f91b9fe0659c803a87d57489"}],"stats":{"total":121,"additions":117,"deletions":4},"files":[{"sha":"22e91fd795d5079cdc1e7605dba9334823b45e3d","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/cc28541520136968edd3258861e88c5433c5e154/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/cc28541520136968edd3258861e88c5433c5e154/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=cc28541520136968edd3258861e88c5433c5e154","patch":"@@ -150,6 +150,8 @@ Trunk (unreleased changes)\n \n     IMPROVEMENTS:\n \n+\tBOOKKEEPER-265: Review JMX documentation (sijie via fpj)\n+\n       bookkeeper-server/\n \n         BOOKKEEPER-95: extends zookeeper JMX to monitor and manage bookie server (Sijie Guo via ivank)"},{"sha":"01869ca942880821785e1219da649b81b769f3a4","filename":"bookkeeper-server/bin/bookkeeper","status":"modified","additions":22,"deletions":2,"changes":24,"blob_url":"https://github.com/apache/bookkeeper/blob/cc28541520136968edd3258861e88c5433c5e154/bookkeeper-server/bin/bookkeeper","raw_url":"https://github.com/apache/bookkeeper/raw/cc28541520136968edd3258861e88c5433c5e154/bookkeeper-server/bin/bookkeeper","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/bin/bookkeeper?ref=cc28541520136968edd3258861e88c5433c5e154","patch":"@@ -29,6 +29,26 @@ then\n   exit 1\n fi\n \n+# See the following page for extensive details on setting\n+# up the JVM to accept JMX remote management:\n+# http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html\n+# by default we allow local JMX connections\n+if [ \"x$JMXLOCALONLY\" = \"x\" ]\n+then\n+    JMXLOCALONLY=false\n+fi\n+\n+if [ \"x$JMXDISABLE\" = \"x\" ]\n+then\n+    echo \"JMX enabled by default\" >&2\n+    # for some reason these two options are necessary on jdk6 on Ubuntu\n+    #   accord to the docs they are not necessary, but otw jconsole cannot\n+    #   do a local attach\n+    JMX_ARGS=\"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=$JMXLOCALONLY\"\n+else\n+    echo \"JMX disabled by user request\" >&2\n+fi\n+\n BINDIR=`dirname \"$0\"`\n BK_HOME=`cd $BINDIR/..;pwd`\n \n@@ -128,11 +148,11 @@ OPTS=\"$OPTS $BOOKIE_EXTRA_OPTS\"\n OPTS=\"$OPTS -Djava.net.preferIPv4Stack=true\"\n \n if [ $COMMAND == \"bookie\" ]; then\n-    exec java $OPTS org.apache.bookkeeper.proto.BookieServer --conf $BOOKIE_CONF $@\n+    exec java $OPTS $JMX_ARGS org.apache.bookkeeper.proto.BookieServer --conf $BOOKIE_CONF $@\n elif [ $COMMAND == \"localbookie\" ]; then\n     NUMBER=$1\n     shift\n-    exec java $OPTS org.apache.bookkeeper.util.LocalBookKeeper $NUMBER $BOOKIE_CONF $@\n+    exec java $OPTS $JMX_ARGS org.apache.bookkeeper.util.LocalBookKeeper $NUMBER $BOOKIE_CONF $@\n elif [ $COMMAND == \"upgrade\" ]; then\n     exec java $OPTS org.apache.bookkeeper.bookie.FileSystemUpgrade --conf $BOOKIE_CONF $@\n elif [ $COMMAND == \"help\" ]; then"},{"sha":"289fb3c7a228728b482c113eb019f2488eebeaf3","filename":"doc/bookkeeperJMX.textile","status":"added","additions":32,"deletions":0,"changes":32,"blob_url":"https://github.com/apache/bookkeeper/blob/cc28541520136968edd3258861e88c5433c5e154/doc/bookkeeperJMX.textile","raw_url":"https://github.com/apache/bookkeeper/raw/cc28541520136968edd3258861e88c5433c5e154/doc/bookkeeperJMX.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/bookkeeperJMX.textile?ref=cc28541520136968edd3258861e88c5433c5e154","patch":"@@ -0,0 +1,32 @@\n+Title:        BookKeeper JMX\n+Notice: Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License. You may\n+        obtain a copy of the License at \"http://www.apache.org/licenses/LICENSE-2.0\":http://www.apache.org/licenses/LICENSE-2.0.\n+        .\n+        .        \n+        Unless required by applicable law or agreed to in writing,\n+        software distributed under the License is distributed on an \"AS IS\"\n+        BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+        implied. See the License for the specific language governing permissions\n+        and limitations under the License.\n+        .\n+        .\n+\n+h1. JMX\n+\n+Apache BookKeeper has extensive support for JMX, which allows viewing and managing a BookKeeper cluster.\n+\n+This document assumes that you have basic knowledge of JMX. See \"Sun JMX Technology\":http://java.sun.com/javase/technologies/core/mntr-mgmt/javamanagement/ page to get started with JMX.\n+\n+See the \"JMX Management Guide\":http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html for details on setting up local and remote management of VM instances. By default the included __bookkeeper__ script supports only local management - review the linked document to enable support for remote management (beyond the scope of this document).\n+\n+__Bookie Server__ is a JMX manageable server, which registers the proper MBeans during initialization to support JMX monitoring and management of the instance.\n+\n+h1. Bookie Server MBean Reference\n+\n+This table details JMX for a bookie server.\n+\n+| _.MBean | _.MBean Object Name | _.Description |\n+| BookieServer | BookieServer_<port> | Represents a bookie server. Note that the object name includes bookie port that the server listens on. It is the root MBean for bookie server, which includes statistics for a bookie server. E.g. number packets sent/received, and statistics for add/read operations. |\n+| Bookie | Bookie | Provide bookie statistics. Currently it just returns current journal queue length waiting to be committed. |\n+| LedgerCache | LedgerCache | Provide ledger cache statistics. E.g. number of page cached in page cache, number of files opened for ledger index files. |"},{"sha":"4c694993a8f0599155f649a1fe5a190c7682edb4","filename":"doc/hedwigJMX.textile","status":"added","additions":32,"deletions":0,"changes":32,"blob_url":"https://github.com/apache/bookkeeper/blob/cc28541520136968edd3258861e88c5433c5e154/doc/hedwigJMX.textile","raw_url":"https://github.com/apache/bookkeeper/raw/cc28541520136968edd3258861e88c5433c5e154/doc/hedwigJMX.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/hedwigJMX.textile?ref=cc28541520136968edd3258861e88c5433c5e154","patch":"@@ -0,0 +1,32 @@\n+Title:        Hedwig JMX\n+Notice: Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License. You may\n+        obtain a copy of the License at \"http://www.apache.org/licenses/LICENSE-2.0\":http://www.apache.org/licenses/LICENSE-2.0.\n+        .\n+        .        \n+        Unless required by applicable law or agreed to in writing,\n+        software distributed under the License is distributed on an \"AS IS\"\n+        BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or\n+        implied. See the License for the specific language governing permissions\n+        and limitations under the License.\n+        .\n+        .\n+\n+h1. JMX\n+\n+Apache Hedwig has extensive support for JMX, which allows viewing and managing a hedwig cluster.\n+\n+This document assumes that you have basic knowledge of JMX. See \"Sun JMX Technology\":http://java.sun.com/javase/technologies/core/mntr-mgmt/javamanagement/ page to get started with JMX.\n+\n+See the \"JMX Management Guide\":http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html for details on setting up local and remote management of VM instances. By default the included __hedwig__ script supports only local management - review the linked document to enable support for remote management (beyond the scope of this document).\n+\n+__Hub Server__ is a JMX manageable server, which registers the proper MBeans during initialization to support JMX monitoring and management of the instance.\n+\n+h1. Hub Server MBean Reference\n+\n+This table details JMX for a hub server.\n+\n+| _.MBean | _.MBean Object Name | _.Description |\n+| PubSubServer | PubSubServer | Represents a hub server. It is the root MBean for hub server, which includes statistics for a hub server. E.g. number packets sent/received/redirected, and statistics for pub/sub/unsub/consume operations. |\n+| NettyHandlers | NettyHandler | Provide statistics for netty handlers. Currently it just returns number of subscription channels established to a hub server. |\n+| ReadAheadCache | ReadAheadCache | Provide read ahead cache statistics. |"},{"sha":"96449be62982c684e42ffda49a592b067d6edfbf","filename":"doc/index.textile","status":"modified","additions":8,"deletions":1,"changes":9,"blob_url":"https://github.com/apache/bookkeeper/blob/cc28541520136968edd3258861e88c5433c5e154/doc/index.textile","raw_url":"https://github.com/apache/bookkeeper/raw/cc28541520136968edd3258861e88c5433c5e154/doc/index.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/index.textile?ref=cc28541520136968edd3258861e88c5433c5e154","patch":"@@ -21,16 +21,23 @@ h1. Apache BookKeeper documentation\n * \"Overview\":./bookkeeperOverview.html\n * \"Getting started\":./bookkeeperStarted.html\n * \"Programmer's Guide\":./bookkeeperProgrammer.html\n-* \"Admin Guide\":./bookkeeperConfig.html\n * \"Bookie Server Configuration Parameters\":./bookieConfigParams.html\n * \"BookKeeper Configuration Parameters\":./bookkeeperConfigParams.html\n * \"BookKeeper Internals\":./bookkeeperInternals.html\n * \"Bookie Recovery\":./bookieRecovery.html\n * \"Using BookKeeper stream library\":./bookkeeperStream.html\n \n+h2. BookKeeper Admin & Ops\n+\n+* \"Admin Guide\":./bookkeeperConfig.html\n+* \"BookKeeper JMX\":./bookkeeperJMX.html\n+\n h1. Apache Hedwig documentation\n \n * \"Building Hedwig, or how to set up Hedwig\":./hedwigBuild.html\n * \"User's Guide, or how to program against the Hedwig API and how to run it\":./hedwigUser.html\n * \"Developer's Guide, or Hedwig internals and hacking details\":./hedwigDesign.html\n \n+h2. Hedwig Admin & Ops\n+\n+* \"Hedwig JMX\":./hedwigJMX.html"},{"sha":"7071e04f9e874ccca26201a6cd97c6830db7c689","filename":"hedwig-server/bin/hedwig","status":"modified","additions":21,"deletions":1,"changes":22,"blob_url":"https://github.com/apache/bookkeeper/blob/cc28541520136968edd3258861e88c5433c5e154/hedwig-server/bin/hedwig","raw_url":"https://github.com/apache/bookkeeper/raw/cc28541520136968edd3258861e88c5433c5e154/hedwig-server/bin/hedwig","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/hedwig-server/bin/hedwig?ref=cc28541520136968edd3258861e88c5433c5e154","patch":"@@ -29,6 +29,26 @@ then\n   exit 1\n fi\n \n+# See the following page for extensive details on setting\n+# up the JVM to accept JMX remote management:\n+# http://java.sun.com/javase/6/docs/technotes/guides/management/agent.html\n+# by default we allow local JMX connections\n+if [ \"x$JMXLOCALONLY\" = \"x\" ]\n+then\n+    JMXLOCALONLY=false\n+fi\n+\n+if [ \"x$JMXDISABLE\" = \"x\" ]\n+then\n+    echo \"JMX enabled by default\" >&2\n+    # for some reason these two options are necessary on jdk6 on Ubuntu\n+    #   accord to the docs they are not necessary, but otw jconsole cannot\n+    #   do a local attach\n+    JMX_ARGS=\"-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.local.only=$JMXLOCALONLY\"\n+else\n+    echo \"JMX disabled by user request\" >&2\n+fi\n+\n BINDIR=`dirname \"$0\"`\n HW_HOME=`cd $BINDIR/..;pwd`\n \n@@ -129,7 +149,7 @@ OPTS=\"-cp $HEDWIG_CLASSPATH $OPTS $HEDWIG_EXTRA_OPTS\"\n OPTS=\"$OPTS -Djava.net.preferIPv4Stack=true\"\n \n if [ $COMMAND == \"server\" ]; then\n-    exec java $OPTS org.apache.hedwig.server.netty.PubSubServer $HEDWIG_SERVER_CONF $@\n+    exec java $OPTS $JMX_ARGS org.apache.hedwig.server.netty.PubSubServer $HEDWIG_SERVER_CONF $@\n elif [ $COMMAND == \"console\" ]; then\n     # hedwig console configuration server part\n     if [ -n \"$HEDWIG_CONSOLE_SERVER_CONF\" ]; then"}]}

