{"sha":"f4d189431ee77d1133b617dba9e939756cb9d721","node_id":"MDY6Q29tbWl0MTU3NTk1NjpmNGQxODk0MzFlZTc3ZDExMzNiNjE3ZGJhOWU5Mzk3NTZjYjlkNzIx","commit":{"author":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2013-02-19T15:19:22Z"},"committer":{"name":"Ivan Brendan Kelly","email":"ivank@apache.org","date":"2013-02-19T15:19:22Z"},"message":"BOOKKEEPER-549: Documentation missed for readOnlyMode support (ivank)\n\ngit-svn-id: https://svn.apache.org/repos/asf/zookeeper/bookkeeper/trunk@1447759 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"9d868052e5c8766e983d42bea91b60f8dfa9f180","url":"https://api.github.com/repos/apache/bookkeeper/git/trees/9d868052e5c8766e983d42bea91b60f8dfa9f180"},"url":"https://api.github.com/repos/apache/bookkeeper/git/commits/f4d189431ee77d1133b617dba9e939756cb9d721","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/bookkeeper/commits/f4d189431ee77d1133b617dba9e939756cb9d721","html_url":"https://github.com/apache/bookkeeper/commit/f4d189431ee77d1133b617dba9e939756cb9d721","comments_url":"https://api.github.com/repos/apache/bookkeeper/commits/f4d189431ee77d1133b617dba9e939756cb9d721/comments","author":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"committer":{"login":"ivankelly","id":54955,"node_id":"MDQ6VXNlcjU0OTU1","avatar_url":"https://avatars.githubusercontent.com/u/54955?v=4","gravatar_id":"","url":"https://api.github.com/users/ivankelly","html_url":"https://github.com/ivankelly","followers_url":"https://api.github.com/users/ivankelly/followers","following_url":"https://api.github.com/users/ivankelly/following{/other_user}","gists_url":"https://api.github.com/users/ivankelly/gists{/gist_id}","starred_url":"https://api.github.com/users/ivankelly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivankelly/subscriptions","organizations_url":"https://api.github.com/users/ivankelly/orgs","repos_url":"https://api.github.com/users/ivankelly/repos","events_url":"https://api.github.com/users/ivankelly/events{/privacy}","received_events_url":"https://api.github.com/users/ivankelly/received_events","type":"User","site_admin":false},"parents":[{"sha":"040a442bef5b93143a9e07c0b601fddea88c5712","url":"https://api.github.com/repos/apache/bookkeeper/commits/040a442bef5b93143a9e07c0b601fddea88c5712","html_url":"https://github.com/apache/bookkeeper/commit/040a442bef5b93143a9e07c0b601fddea88c5712"}],"stats":{"total":31,"additions":25,"deletions":6},"files":[{"sha":"c31af13d3069a47ab4aea78cccfec1c7ce023104","filename":"CHANGES.txt","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/bookkeeper/blob/f4d189431ee77d1133b617dba9e939756cb9d721/CHANGES.txt","raw_url":"https://github.com/apache/bookkeeper/raw/f4d189431ee77d1133b617dba9e939756cb9d721/CHANGES.txt","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/CHANGES.txt?ref=f4d189431ee77d1133b617dba9e939756cb9d721","patch":"@@ -11,6 +11,8 @@ Trunk (unreleased changes)\n     BUGFIXES:\n       bookkeeper-server:\n \n+        BOOKKEEPER-549: Documentation missed for readOnlyMode support (ivank)\n+\n         BOOKKEEPER-548: Document about periodic ledger checker configuration (ivank)\n \n         BOOKKEEPER-561: Findbugs report errors with openjdk (ivank via umamahesh)"},{"sha":"427c4304a7b36b27b44a6714d6eb83c70b3b3961","filename":"bookkeeper-server/conf/bk_server.conf","status":"modified","additions":2,"deletions":3,"changes":5,"blob_url":"https://github.com/apache/bookkeeper/blob/f4d189431ee77d1133b617dba9e939756cb9d721/bookkeeper-server/conf/bk_server.conf","raw_url":"https://github.com/apache/bookkeeper/raw/f4d189431ee77d1133b617dba9e939756cb9d721/bookkeeper-server/conf/bk_server.conf","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/conf/bk_server.conf?ref=f4d189431ee77d1133b617dba9e939756cb9d721","patch":"@@ -159,10 +159,9 @@ zkTimeout=10000\n # the limitation of number of index pages.\n # pageLimit=-1\n \n-#If all ledger directories configured are full, then support only read \n-#requests for clients.\n+#If all ledger directories configured are full, then support only read requests for clients.\n #If \"readOnlyModeEnabled=true\" then on all ledger disks full, bookie will be converted\n-#to read-only mode and serve only read requests. Else bookie will get shutdown.\n+#to read-only mode and serve only read requests. Otherwise the bookie will be shutdown.\n #By default this will be disabled.\n #readOnlyModeEnabled=false\n "},{"sha":"21619894ba85fb9e902e5c7936c8e363e78ff2cd","filename":"bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","status":"modified","additions":5,"deletions":3,"changes":8,"blob_url":"https://github.com/apache/bookkeeper/blob/f4d189431ee77d1133b617dba9e939756cb9d721/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","raw_url":"https://github.com/apache/bookkeeper/raw/f4d189431ee77d1133b617dba9e939756cb9d721/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/bookkeeper-server/src/main/java/org/apache/bookkeeper/conf/ServerConfiguration.java?ref=f4d189431ee77d1133b617dba9e939756cb9d721","patch":"@@ -584,9 +584,11 @@ public long getOpenLedgerRereplicationGracePeriod() {\n     }\n \n     /**\n-     * Set the ReadOnlyModeEnabled status\n+     * Set whether the bookie is able to go into read-only mode.\n+     * If this is set to false, the bookie will shutdown on encountering\n+     * an error condition.\n      * \n-     * @param enabled enables read-only mode.\n+     * @param enabled whether to enable read-only mode.\n      * \n      * @return ServerConfiguration \n      */\n@@ -596,7 +598,7 @@ public ServerConfiguration setReadOnlyModeEnabled(boolean enabled) {\n     }\n \n     /**\n-     * Get ReadOnlyModeEnabled status\n+     * Get whether read-only mode is enabled. The default is false.\n      * \n      * @return boolean\n      */"},{"sha":"4b9d5534c395372efd29c299c09b2c98781ac6a0","filename":"doc/bookkeeperConfig.textile","status":"modified","additions":16,"deletions":0,"changes":16,"blob_url":"https://github.com/apache/bookkeeper/blob/f4d189431ee77d1133b617dba9e939756cb9d721/doc/bookkeeperConfig.textile","raw_url":"https://github.com/apache/bookkeeper/raw/f4d189431ee77d1133b617dba9e939756cb9d721/doc/bookkeeperConfig.textile","contents_url":"https://api.github.com/repos/apache/bookkeeper/contents/doc/bookkeeperConfig.textile?ref=f4d189431ee77d1133b617dba9e939756cb9d721","patch":"@@ -115,6 +115,22 @@ The mechanism to prevent the bookie from starting up in the case of configuratio\n # A strict subset of the ledger devices (among multiple ledger devices) has been replaced, consequently making the content of the replaced devices unavailable;\n # A strict subset of the ledger directories has been accidentally deleted.\n \n+h3. Full or failing disks\n+\n+A bookie can go into read-only mode if it detects problems with its disks. In read-only mode, the bookie will serve read requests, but will not allow any writes. Any ledger currently writing to the bookie will replace the bookie in its ensemble. No new ledgers will select the read-only bookie for writing.\n+\n+The bookie goes into read-only mode in the following conditions.\n+\n+# All disks are full.\n+# An error occurred flushing to the ledger disks.\n+# An error occurred writing to the journal disk.\n+\n+Important parameters are:\n+\n+* @readOnlyModeEnabled@, whether read-only mode is enabled. If read-only mode is not enabled, the bookie will shutdown on encountering any of the above conditions. By default, read-only mode is disabled.\n+* @diskUsageThreshold@, percentage threshold at which a disk will be considered full. This value must be between 0 and 1.0. By default, the value is 0.95.\n+* @diskCheckInterval@, interval at which the disks are checked to see if they are full. Specified in milliseconds. By default the check occurs every 10000 milliseconds (10 seconds).\n+\n h2. Running Autorecovery nodes\n \n To run autorecovery nodes, we execute the following command in every Bookie node:"}]}

