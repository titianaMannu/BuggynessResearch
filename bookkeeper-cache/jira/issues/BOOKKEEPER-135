{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12533597","self":"https://issues.apache.org/jira/rest/api/2/issue/12533597","key":"BOOKKEEPER-135","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319145","id":"12319145","name":"4.1.0","archived":false,"released":true,"releaseDate":"2012-06-13"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"219325","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[{"id":"12348112","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12348112","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"outwardIssue":{"id":"12538035","key":"BOOKKEEPER-152","self":"https://issues.apache.org/jira/rest/api/2/issue/12538035","fields":{"summary":"Can't recover a ledger whose current ensemble contain failed bookie.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"61721","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-135/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@4c1ccf74[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6e7e437a[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5fce720d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@43b79f1d[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7110f7c4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@1f580b14[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@33aa5ce8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@4c9a62f7[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3ac21277[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@659dae90[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4b1e3d7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@1ba3a46c[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-04-02T10:38:52.404+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-135/watchers","watchCount":1,"isWatching":false},"created":"2011-12-02T11:11:35.003+0000","updated":"2013-05-02T02:29:49.501+0000","timeoriginalestimate":null,"description":"When fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12520626","id":"12520626","filename":"BOOKKEEPER-135.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-03-30T16:58:54.616+0000","size":29100,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12520626/BOOKKEEPER-135.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12519102","id":"12519102","filename":"BOOKKEEPER-135.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-03-20T18:12:59.556+0000","size":27153,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12519102/BOOKKEEPER-135.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514358","id":"12514358","filename":"BOOKKEEPER-135.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T14:52:20.403+0000","size":42444,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12514358/BOOKKEEPER-135.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514133","id":"12514133","filename":"BOOKKEEPER-135.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-10T18:20:39.234+0000","size":42293,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12514133/BOOKKEEPER-135.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12512023","id":"12512023","filename":"BOOKKEEPER-135.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-01-26T19:24:45.164+0000","size":20114,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12512023/BOOKKEEPER-135.diff"}],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Fencing does not check the ledger masterPasswd","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13194108","id":"13194108","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/\n-----------------------------------------------------------\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nWhen fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\n\n\nThis addresses bug BOOKKEEPER-135.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-135\n\n\nDiffs\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java cb3bb26 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 29070eb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 4466ce3 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java bc1cfb0 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java beab5e8 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 2fa79bb \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java 8526db5 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 015e4e4 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \n\nDiff: https://reviews.apache.org/r/3642/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-26T19:27:39.382+0000","updated":"2012-01-26T19:27:39.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13195484","id":"13195484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/#review4668\n-----------------------------------------------------------\n\n\nIf I understand the overall flow right, giving the wrong password will make readEntryAndDoFencing fail in the initiate call of the recovery procedure. It fails because the bookie server checks and returns an error (IOException in BookieServer). I don't fully understand the flow once we determine that the password is incorrect based on the two comments below.\n\n\nbookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java\n<https://reviews.apache.org/r/3642/#comment10387>\n\n    Is this where we fail the openLedger? If so, by checking the method, it doesn't seem to be using the right code. This is related to my other comment on the exception not being the right one.\n\n\n\nbookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java\n<https://reviews.apache.org/r/3642/#comment10385>\n\n    I don't think we currently throw this exception anywhere in the code (BKLedgerRecoveryException). It is nowhere else in this patch and it is not present in trunk. I think we are throwing an exception here, but not the the right one.\n    \n\n\n- fpj\n\n\nOn 2012-01-26 19:26:03, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3642/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-01-26 19:26:03)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  When fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-135.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-135\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java cb3bb26 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 29070eb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 4466ce3 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java bc1cfb0 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java beab5e8 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 2fa79bb \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java 8526db5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 015e4e4 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3642/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-28T11:01:09.144+0000","updated":"2012-01-28T11:01:09.144+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13195544","id":"13195544","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n\nbq.  On 2012-01-28 11:00:01, fpj wrote:\nbq.  > bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java, line 370\nbq.  > <https://reviews.apache.org/r/3642/diff/1/?file=70865#file70865line370>\nbq.  >\nbq.  >     I don't think we currently throw this exception anywhere in the code (BKLedgerRecoveryException). It is nowhere else in this patch and it is not present in trunk. I think we are throwing an exception here, but not the the right one.\nbq.  >\n\nMy bad, I just realized that we do it here in LedgerOpenOp:\n\n                   public void operationComplete(int rc, Void result) {\n                        if (rc != BKException.Code.OK) {\n                            cb.openComplete(BKException.Code.LedgerRecoveryException, null, LedgerOpenOp.this.ctx);\n                        } else {\n                            cb.openComplete(BKException.Code.OK, lh, LedgerOpenOp.this.ctx);\n                        }\n                    }\n\n\nbq.  On 2012-01-28 11:00:01, fpj wrote:\nbq.  > bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java, line 293\nbq.  > <https://reviews.apache.org/r/3642/diff/1/?file=70863#file70863line293>\nbq.  >\nbq.  >     Is this where we fail the openLedger? If so, by checking the method, it doesn't seem to be using the right code. This is related to my other comment on the exception not being the right one.\n\nIt sounds like in LedgerRecoveryOp we just pass the error code to LedgerOpenOp and if it is not OK, we make it a LedgerRecoveryException. Consequently, it works to return BKException.Code.BookieHandleNotAvailableException in PerChannelBookieClient.errorOutReadKey(). The error here is not BookieHandleNotAvailable. Should we fix this one here?\n\n\n- fpj\n\n\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/#review4668\n-----------------------------------------------------------\n\n\nOn 2012-01-26 19:26:03, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3642/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-01-26 19:26:03)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  When fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-135.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-135\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java cb3bb26 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 29070eb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 4466ce3 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java bc1cfb0 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java beab5e8 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 2fa79bb \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java 8526db5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 015e4e4 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3642/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-28T14:13:10.163+0000","updated":"2012-01-28T14:13:10.163+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13196021","id":"13196021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/#review4685\n-----------------------------------------------------------\n\n\nI'm thinking I should add something more explicit to allow the client see that the actual issue is the wrong password, maybe by throwing a different exception, or logging a very explicit error message.\n\n\n\nbookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java\n<https://reviews.apache.org/r/3642/#comment10426>\n\n    This isn't were the error would come from in the case of wrong password for fencing. Listener here is only for writing to the socket. Once you've written to the socket the callback is invoked. \n    \n    For wrong password errors, we have to wait for the response from the bookie, which is handled in #messageReceived, and in this case by #handleReadResponse, which will interpret the rc as a ReadException. When LedgerRecoveryOp#readEntryComplete receives ReadException for all of the read requests, it throws a LedgerRecoveryException to the client. \n\n\n- Ivan\n\n\nOn 2012-01-26 19:26:03, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3642/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-01-26 19:26:03)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  When fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-135.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-135\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java cb3bb26 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 29070eb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 4466ce3 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java bc1cfb0 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java beab5e8 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 2fa79bb \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java 8526db5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 015e4e4 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3642/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-30T10:07:10.357+0000","updated":"2012-01-30T10:07:10.357+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13196051","id":"13196051","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n\nbq.  On 2012-01-30 10:06:44, Ivan Kelly wrote:\nbq.  > I'm thinking I should add something more explicit to allow the client see that the actual issue is the wrong password, maybe by throwing a different exception, or logging a very explicit error message.\nbq.  >\n\nSounds like a good idea, since LedgerRecoveryException is not precise enough. The ReadException is also mixing wrong password and read failure, right?\n\n\nbq.  On 2012-01-30 10:06:44, Ivan Kelly wrote:\nbq.  > bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java, line 293\nbq.  > <https://reviews.apache.org/r/3642/diff/1/?file=70863#file70863line293>\nbq.  >\nbq.  >     This isn't were the error would come from in the case of wrong password for fencing. Listener here is only for writing to the socket. Once you've written to the socket the callback is invoked. \nbq.  >     \nbq.  >     For wrong password errors, we have to wait for the response from the bookie, which is handled in #messageReceived, and in this case by #handleReadResponse, which will interpret the rc as a ReadException. When LedgerRecoveryOp#readEntryComplete receives ReadException for all of the read requests, it throws a LedgerRecoveryException to the client.\n\nGot it, seems right to me.\n\n\n- fpj\n\n\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/#review4685\n-----------------------------------------------------------\n\n\nOn 2012-01-26 19:26:03, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3642/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-01-26 19:26:03)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  When fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-135.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-135\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java cb3bb26 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 29070eb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 4466ce3 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java bc1cfb0 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java beab5e8 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 2fa79bb \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java 8526db5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 015e4e4 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3642/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-01-30T11:07:09.676+0000","updated":"2012-01-30T11:07:09.676+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13205600","id":"13205600","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"new patch fixes the issue, and does some refactoring on the bookie side to try to make flow clearer.\n\nThis patch depends on BOOKKEEPER-152","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-10T18:20:39.783+0000","updated":"2012-02-10T18:20:39.783+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13205602","id":"13205602","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/\n-----------------------------------------------------------\n\n(Updated 2012-02-10 18:21:40.588207)\n\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nWhen fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\n\n\nThis addresses bug BOOKKEEPER-135.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-135\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java 57a6c29 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCache.java 3e96d46 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDescriptor.java 9da4aec \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java 911c660 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java 56186ab \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java 7aad751 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 29070eb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 8a32c64 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java bc1cfb0 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java 7217da6 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 015e4e4 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \n\nDiff: https://reviews.apache.org/r/3642/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-10T18:22:58.061+0000","updated":"2012-02-10T18:22:58.061+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13206912","id":"13206912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"For some reason I couldn't update the patch in review board. Newest patch is a rebase of the changes on trunk, so reviewing whats in reviewboard is equivalent.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T14:54:23.355+0000","updated":"2012-02-13T14:54:23.355+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13209493","id":"13209493","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/\n-----------------------------------------------------------\n\n(Updated 2012-02-16 16:51:41.014079)\n\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nWhen fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\n\n\nThis addresses bug BOOKKEEPER-135.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-135\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java 57a6c29 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerCache.java 3e96d46 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/LedgerDescriptor.java 9da4aec \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java 911c660 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java 56186ab \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java c67a79c \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java 7aad751 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 29070eb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 7dd5363 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 8a32c64 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java 8598c08 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java 7217da6 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java ca055e8 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java 99258ac \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 015e4e4 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \n\nDiff: https://reviews.apache.org/r/3642/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-16T16:52:58.972+0000","updated":"2012-02-16T16:52:58.972+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13210322","id":"13210322","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"BOOKKEEPER-174 breaks the current patch, and I can't see a simple way to fix, so cancelling the patch for now.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-17T15:24:26.620+0000","updated":"2012-02-17T15:24:26.620+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13228307","id":"13228307","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Should we make this one 4.2.0 or should it keep it for 4.1.0?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-03-13T11:00:06.382+0000","updated":"2012-03-13T11:00:06.382+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13233641","id":"13233641","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"New patch is much simpler on the server side. A lot of the changes are just added the new error path for unauthorized fencing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-03-20T18:12:59.677+0000","updated":"2012-03-20T18:12:59.677+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13233643","id":"13233643","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/\n-----------------------------------------------------------\n\n(Updated 2012-03-20 18:13:56.162926)\n\n\nReview request for bookkeeper.\n\n\nChanges\n-------\n\nNew patch is much simpler on the server side. A lot of the changes are just added the new error path for unauthorized fencing.\n\n\nSummary\n-------\n\nWhen fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\n\n\nThis addresses bug BOOKKEEPER-135.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-135\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java ad41ba5 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java 911c660 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java 56186ab \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java c67a79c \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java 7aad751 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 539d6b2 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 7dd5363 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 8a32c64 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java 8598c08 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java 1a315e1 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 75a8e8c \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java b8923e8 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 7de1c10 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \n\nDiff: https://reviews.apache.org/r/3642/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-20T18:15:35.975+0000","updated":"2012-03-20T18:15:35.975+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13241253","id":"13241253","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/#review6519\n-----------------------------------------------------------\n\n\nthe whole patch is very good. I just have some slight comments as below.\n\n\nbookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java\n<https://reviews.apache.org/r/3642/#comment14182>\n\n    just curious, do we need any cases to test different version compatibility? \n\n\n\nbookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java\n<https://reviews.apache.org/r/3642/#comment14183>\n\n    it would better to define 20 as constant, since there is several places referencing it.\n\n\n\nbookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java\n<https://reviews.apache.org/r/3642/#comment14181>\n\n    it would better to throw a BookieException, so it would be caught as EUA error.\n\n\n- Sijie\n\n\nOn 2012-03-20 18:13:56, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3642/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-03-20 18:13:56)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  When fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-135.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-135\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java ad41ba5 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java 911c660 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java 56186ab \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java c67a79c \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java 7aad751 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 539d6b2 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 7dd5363 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 8a32c64 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java 8598c08 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java 1a315e1 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 75a8e8c \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java b8923e8 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 7de1c10 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3642/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-29T14:10:26.059+0000","updated":"2012-03-29T14:10:26.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13242536","id":"13242536","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n\nbq.  On 2012-03-29 14:10:15, Sijie Guo wrote:\nbq.  > bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java, line 385\nbq.  > <https://reviews.apache.org/r/3642/diff/4/?file=93827#file93827line385>\nbq.  >\nbq.  >     just curious, do we need any cases to test different version compatibility?\n\nI think this would be very hard to test, as it would mean either pulling down a different version of the code, or duplicating the old code in our tests. It's possible, but the benefit vs payoff is very little.\n\n\n- Ivan\n\n\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/#review6519\n-----------------------------------------------------------\n\n\nOn 2012-03-20 18:13:56, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3642/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-03-20 18:13:56)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  When fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-135.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-135\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java ad41ba5 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java 911c660 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java 56186ab \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java c67a79c \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java 7aad751 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 539d6b2 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 7dd5363 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 8a32c64 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java 8598c08 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java 1a315e1 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 75a8e8c \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java b8923e8 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 7de1c10 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3642/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-30T16:58:25.364+0000","updated":"2012-03-30T16:58:25.364+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13242538","id":"13242538","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Addressed Sijie's comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-03-30T16:58:54.769+0000","updated":"2012-03-30T16:58:54.769+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13242540","id":"13242540","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3642/\n-----------------------------------------------------------\n\n(Updated 2012-03-30 16:58:23.130753)\n\n\nReview request for bookkeeper.\n\n\nChanges\n-------\n\nAddressed Sijie's comments\n\n\nSummary\n-------\n\nWhen fencing, the ledger handle is not checked before the fencing is applied. Currently the openLedger does fail, on because it will addEntry and fail at that point, but by this stage, fencing has already been applied. The check should be earlier.\n\n\nThis addresses bug BOOKKEEPER-135.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-135\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java ee38862 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java 911c660 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java 56186ab \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java c67a79c \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java 7aad751 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java 539d6b2 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 7dd5363 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java 8a32c64 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java 8598c08 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java c5c1422 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 75a8e8c \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java b8923e8 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java 7de1c10 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java 99d6ef0 \n\nDiff: https://reviews.apache.org/r/3642/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-03-30T17:00:24.658+0000","updated":"2012-03-30T17:00:24.658+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13243081","id":"13243081","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"new patch looks good to me, +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-03-31T08:25:31.684+0000","updated":"2012-03-31T08:25:31.684+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13244113","id":"13244113","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Committed as r1308294. Thanks for reviewing Sijie.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-04-02T10:38:52.723+0000","updated":"2012-04-02T10:38:52.723+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12533597/comment/13244116","id":"13244116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in bookkeeper-trunk #441 (See [https://builds.apache.org/job/bookkeeper-trunk/441/])\n    BOOKKEEPER-135: Fencing does not check the ledger masterPasswd (ivank) (Revision 1308294)\n\n     Result = SUCCESS\nivank : \nFiles : \n* /zookeeper/bookkeeper/trunk/CHANGES.txt\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/bookie/Bookie.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BKException.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerOpenOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingAddOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieServer.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestFencing.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieClientTest.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-04-02T10:52:58.232+0000","updated":"2012-04-02T10:52:58.232+0000"}],"maxResults":20,"total":20,"startAt":0},"customfield_12311820":"0|i0axmn:","customfield_12314139":null}}

