{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12538035","self":"https://issues.apache.org/jira/rest/api/2/issue/12538035","key":"BOOKKEEPER-152","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319145","id":"12319145","name":"4.1.0","archived":false,"released":true,"releaseDate":"2012-06-13"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"223541","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317843","id":"12317843","description":"","name":"4.0.0","archived":false,"released":true,"releaseDate":"2011-12-07"}],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[{"id":"12348112","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12348112","type":{"id":"10001","name":"dependent","inward":"is depended upon by","outward":"depends upon","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10001"},"inwardIssue":{"id":"12533597","key":"BOOKKEEPER-135","self":"https://issues.apache.org/jira/rest/api/2/issue/12533597","fields":{"summary":"Fencing does not check the ledger masterPasswd","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12314393","id":"12314393","name":"bookkeeper-client","description":"Bookkeeper client."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"61696","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-152/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@5a588c92[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@707afded[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1672f465[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@31c0f6d3[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6b7bc273[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@658a7da0[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@64da7ca8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@529a788e[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@674750f4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@511646c1[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@661e4f77[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@67411532[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-02-13T14:47:26.408+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-152/watchers","watchCount":0,"isWatching":false},"created":"2012-01-11T10:10:15.588+0000","updated":"2013-05-02T02:29:49.505+0000","timeoriginalestimate":null,"description":"Suppose we have a unclosed ledger L, whose ensemble size is 2, quorum size is 2. the ledger's current ensemble is <bk1, bk2>.\n\nbk2 is crashed. \n\nwe use recovery tool to recover entries in bk2. $ bookkeeper-server/bin/bookkeeper org.apache.bookkeeper.tools.BookKeeperTools bk2 \n\nrecovery failed due to recovery tool can't open ledger L, since ledger L doesn't have enough quorum to readLastConfirmed entry. (asyncOpenLedgerNoRecovery)\n\n\n\n\n\n\n\n\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12510177","id":"12510177","filename":"BK-152.draft.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-01-11T12:18:22.685+0000","size":11014,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12510177/BK-152.draft.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514344","id":"12514344","filename":"BOOKKEEPER-152.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T12:15:55.088+0000","size":28072,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12514344/BOOKKEEPER-152.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514333","id":"12514333","filename":"BOOKKEEPER-152.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T10:18:21.957+0000","size":27419,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12514333/BOOKKEEPER-152.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514110","id":"12514110","filename":"BOOKKEEPER-152.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-10T15:22:54.220+0000","size":27350,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12514110/BOOKKEEPER-152.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514095","id":"12514095","filename":"BOOKKEEPER-152.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-10T10:34:43.380+0000","size":24432,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12514095/BOOKKEEPER-152.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12514091","id":"12514091","filename":"BOOKKEEPER-152.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-10T09:47:06.497+0000","size":23788,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12514091/BOOKKEEPER-152.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513011","id":"12513011","filename":"BOOKKEEPER-152.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-02T18:18:22.994+0000","size":25228,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12513011/BOOKKEEPER-152.diff"}],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Can't recover a ledger whose current ensemble contain failed bookie.","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13184010","id":"13184010","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"attach a draft patch.\n\nthe idea is to add a excluded list of bookies when openLedgerNoRecovery. If the excluded bookie is in the quorum set which maxAddConfirmed entry belongs to, bookie client just needs to wait quorumSize-n responses when readLastConfirmed.\n\nthen in recovery tool, we can pass the failed bookie as excluded bookies.\n\nhow is your opinion?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-01-11T12:18:22.958+0000","updated":"2012-01-11T12:18:22.958+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13198687","id":"13198687","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"I think a simpler solution to this is to modify LedgerRecoveryOp to access timeout as a valid response. Then the quorum checking should take care of the rest. I'll test this hypothesis later.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-02T11:01:03.593+0000","updated":"2012-02-02T11:01:03.593+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13198709","id":"13198709","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"It appears that ReadLastConfirmedOp isn't actually correct. It duplicates code from RecoverLedgerOp but doesn't check that all quorums have replied, just that the number of responses is the same as quorum size. In practice, this isn't a big issue, but the code for checking the last confirmed entry should be common, so I'll merge them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-02T11:42:25.191+0000","updated":"2012-02-02T11:42:25.191+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13198751","id":"13198751","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"> modify LedgerRecoveryOp to access timeout as a valid response\n\nIf I remember correctly, if a bookie is crashed, the operation would return could not connect exception not timeout exception.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-02T12:52:05.539+0000","updated":"2012-02-02T12:52:05.539+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13199050","id":"13199050","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Proposed fix ensures that at least one of each quorum replies to ReadLastConfirmed. \n\nRefactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\n\nThe bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\n\nThere's a fix for the timeouts and an improvement in fencing which fixing this uncovered.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-02T18:18:23.174+0000","updated":"2012-02-02T18:18:23.174+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13199057","id":"13199057","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/\n-----------------------------------------------------------\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nProposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\n\nRefactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\n\nThe bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\n\nThere's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\n\n\nThis addresses bug BOOKKEEPER-152.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-152\n\n\nDiffs\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java 547e240 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java ded1379 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java 8526db5 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java db1a763 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \n\nDiff: https://reviews.apache.org/r/3737/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-02T18:20:53.780+0000","updated":"2012-02-02T18:20:53.780+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13202260","id":"13202260","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"BOOKKEEPER-163 and BOOKKEEPER-164 has been created to prevent incorrect responses to avoid reading wrong last confirmed. so I think we can let the jira go first, since the bug here is more related to logic of reading last confirmed as Ivan stated. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-07T11:59:07.687+0000","updated":"2012-02-07T11:59:07.687+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13205316","id":"13205316","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Brought up to trunk","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-10T09:47:06.597+0000","updated":"2012-02-10T09:47:06.597+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13205319","id":"13205319","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/\n-----------------------------------------------------------\n\n(Updated 2012-02-10 09:47:35.723185)\n\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nProposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\n\nRefactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\n\nThe bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\n\nThere's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\n\n\nThis addresses bug BOOKKEEPER-152.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-152\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \n\nDiff: https://reviews.apache.org/r/3737/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-10T09:47:59.926+0000","updated":"2012-02-10T09:47:59.926+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13205330","id":"13205330","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/#review5006\n-----------------------------------------------------------\n\n\nmost is good to me. but it seems that you didn't assign right last confirmed value in readLastConfirmedOp callback.\n\n\nbookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java\n<https://reviews.apache.org/r/3737/#comment11009>\n\n    actually the result is not maxAddConfirmed, is lastAddConfirmed. maxAddConfirmed is member parameter in LedgerRecoveryOp.\n\n\n- Sijie\n\n\nOn 2012-02-10 09:47:35, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3737/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-02-10 09:47:35)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  Proposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\nbq.  \nbq.  Refactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\nbq.  \nbq.  The bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\nbq.  \nbq.  There's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-152.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-152\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3737/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-10T10:15:58.738+0000","updated":"2012-02-10T10:15:58.738+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13205349","id":"13205349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/\n-----------------------------------------------------------\n\n(Updated 2012-02-10 10:33:25.397382)\n\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nProposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\n\nRefactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\n\nThe bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\n\nThere's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\n\n\nThis addresses bug BOOKKEEPER-152.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-152\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \n\nDiff: https://reviews.apache.org/r/3737/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-10T10:33:58.252+0000","updated":"2012-02-10T10:33:58.252+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13205350","id":"13205350","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/#review5007\n-----------------------------------------------------------\n\nShip it!\n\n\n+1. thanks Ivan.\n\n- Sijie\n\n\nOn 2012-02-10 10:33:25, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3737/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-02-10 10:33:25)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  Proposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\nbq.  \nbq.  Refactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\nbq.  \nbq.  The bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\nbq.  \nbq.  There's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-152.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-152\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3737/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-10T10:35:58.192+0000","updated":"2012-02-10T10:35:58.192+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13205497","id":"13205497","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"The previous patch wasn't passing all tests. LedgerRecoveryTest was failing. This one fixes that problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-10T15:22:54.305+0000","updated":"2012-02-10T15:22:54.305+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13205498","id":"13205498","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/\n-----------------------------------------------------------\n\n(Updated 2012-02-10 15:23:20.842439)\n\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nProposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\n\nRefactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\n\nThe bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\n\nThere's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\n\n\nThis addresses bug BOOKKEEPER-152.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-152\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DigestManager.java ae375ec \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \n\nDiff: https://reviews.apache.org/r/3737/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-10T15:24:58.048+0000","updated":"2012-02-10T15:24:58.048+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13206370","id":"13206370","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/#review5029\n-----------------------------------------------------------\n\n\nah, thanks Ivan for fixing the wrong assignment of ledger length. \nthe new patch is good to me. but I don't like the new callback name 'RecoveredDataCallback', which sounds like that the data is returned by some recovery actions although it doesn't. This data is retrieved by reading last confirmed without recovery. I prefer changing this callback to 'ReadLastConfirmedDataCallback' and the method to 'readLastConfirmedDataComplete'. \n\n- Sijie\n\n\nOn 2012-02-10 15:23:20, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3737/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-02-10 15:23:20)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  Proposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\nbq.  \nbq.  Refactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\nbq.  \nbq.  The bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\nbq.  \nbq.  There's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-152.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-152\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DigestManager.java ae375ec \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3737/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-12T08:34:57.774+0000","updated":"2012-02-12T08:34:57.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13206788","id":"13206788","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/\n-----------------------------------------------------------\n\n(Updated 2012-02-13 10:18:44.480209)\n\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nProposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\n\nRefactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\n\nThe bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\n\nThere's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\n\n\nThis addresses bug BOOKKEEPER-152.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-152\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DigestManager.java ae375ec \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \n\nDiff: https://reviews.apache.org/r/3737/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-13T10:18:58.267+0000","updated":"2012-02-13T10:18:58.267+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13206801","id":"13206801","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/#review5050\n-----------------------------------------------------------\n\nShip it!\n\n\n+1\n\n- Sijie\n\n\nOn 2012-02-13 10:18:44, Ivan Kelly wrote:\nbq.  \nbq.  -----------------------------------------------------------\nbq.  This is an automatically generated e-mail. To reply, visit:\nbq.  https://reviews.apache.org/r/3737/\nbq.  -----------------------------------------------------------\nbq.  \nbq.  (Updated 2012-02-13 10:18:44)\nbq.  \nbq.  \nbq.  Review request for bookkeeper.\nbq.  \nbq.  \nbq.  Summary\nbq.  -------\nbq.  \nbq.  Proposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\nbq.  \nbq.  Refactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\nbq.  \nbq.  The bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\nbq.  \nbq.  There's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\nbq.  \nbq.  \nbq.  This addresses bug BOOKKEEPER-152.\nbq.      https://issues.apache.org/jira/browse/BOOKKEEPER-152\nbq.  \nbq.  \nbq.  Diffs\nbq.  -----\nbq.  \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DigestManager.java ae375ec \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java e3d1847 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java 4625bbb \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java 43e999d \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \nbq.    bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java a68fc8c \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \nbq.    bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \nbq.  \nbq.  Diff: https://reviews.apache.org/r/3737/diff\nbq.  \nbq.  \nbq.  Testing\nbq.  -------\nbq.  \nbq.  \nbq.  Thanks,\nbq.  \nbq.  Ivan\nbq.  \nbq.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-13T10:48:57.589+0000","updated":"2012-02-13T10:48:57.589+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13206831","id":"13206831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Hopefully the final patch for this JIRA. Resolves the conflicts with BOOKKEEPER-162.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T12:15:55.149+0000","updated":"2012-02-13T12:15:55.149+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13206832","id":"13206832","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"body":"\n-----------------------------------------------------------\nThis is an automatically generated e-mail. To reply, visit:\nhttps://reviews.apache.org/r/3737/\n-----------------------------------------------------------\n\n(Updated 2012-02-13 12:16:12.769117)\n\n\nReview request for bookkeeper.\n\n\nSummary\n-------\n\nProposed fix ensures that at least one of each quorum replies to ReadLastConfirmed.\n\nRefactors code a bit to make the read last confirmed common for recovery and standalone read last confirmed.\n\nThe bug here was actually that we were waiting for quorumSize responses, from the bookies, when really all we need to get a response from one bookie in each possible quorum. in the 2/2 case as above this means only 1 bookie need response.\n\nThere's a fix for the timeouts and an improvement in fencing which fixing this uncovered.\n\n\nThis addresses bug BOOKKEEPER-152.\n    https://issues.apache.org/jira/browse/BOOKKEEPER-152\n\n\nDiffs (updated)\n-----\n\n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DigestManager.java ae375ec \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/DistributionSchedule.java f2ed6bd \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java d6ade83 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java db2f782 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java f5f0523 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/client/RoundRobinDistributionSchedule.java 4a88747 \n  bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java 0064e24 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/client/BookieRecoveryTest.java cbd2277 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BaseTestCase.java da52ca5 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieFailureTest.java 5873255 \n  bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java 77a2f69 \n\nDiff: https://reviews.apache.org/r/3737/diff\n\n\nTesting\n-------\n\n\nThanks,\n\nIvan\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiraposter%40reviews.apache.org","name":"jiraposter@reviews.apache.org","key":"jiraposter@reviews.apache.org","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"jiraposter@reviews.apache.org","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-13T12:16:58.920+0000","updated":"2012-02-13T12:16:58.920+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13206858","id":"13206858","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"yeah. I am ok with the final patch :) +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-13T13:17:40.518+0000","updated":"2012-02-13T13:17:40.518+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12538035/comment/13206907","id":"13206907","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Committed as r1243539. Thanks for all the reviews Sijie.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T14:47:26.451+0000","updated":"2012-02-13T14:47:26.451+0000"}],"maxResults":21,"total":21,"startAt":0},"customfield_12311820":"0|i0axh3:","customfield_12314139":null}}

