{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12541562","self":"https://issues.apache.org/jira/rest/api/2/issue/12541562","key":"BOOKKEEPER-162","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319145","id":"12319145","name":"4.1.0","archived":false,"released":true,"releaseDate":"2012-06-13"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"226849","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317843","id":"12317843","description":"","name":"4.0.0","archived":false,"released":true,"releaseDate":"2011-12-07"}],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12314393","id":"12314393","name":"bookkeeper-client","description":"Bookkeeper client."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"61748","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-162/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@79d71c27[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@545cfa3[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@757ad428[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@5ee925f3[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@64c3f830[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3e91ec82[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1d69a4ec[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@ab8dc0f[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7141a710[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@4005b046[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@101b326e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@5c8fccc6[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-02-13T10:20:11.045+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-162/watchers","watchCount":0,"isWatching":false},"created":"2012-02-07T05:15:35.782+0000","updated":"2012-10-22T14:50:13.623+0000","timeoriginalestimate":null,"description":"Two bookkeeper clients.\n1st continuously writing to ledger X.\n2nd (bk.openLedgerNoRecovery) polling ledger X for new entries and reading them.\n\nIn response we always reveiceing 0 as last confirmed entry id (in fact we are receiving -1 from each bookie RecoveryData but then in ReadLastConfirmedOp, but uninitialized \"long maxAddConfirmed;\" takes priority in Math.max(...).\n\nMain question - is given scenario is expected to work at all?\n\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513604","id":"12513604","filename":"BookieReadWriteTest.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T12:18:04.140+0000","size":4049,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12513604/BookieReadWriteTest.java.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513603","id":"12513603","filename":"BookieReadWriteTest.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T12:12:41.097+0000","size":4404,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12513603/BookieReadWriteTest.java.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513597","id":"12513597","filename":"BookieReadWriteTest.java.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T11:57:52.870+0000","size":4113,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12513597/BookieReadWriteTest.java.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513596","id":"12513596","filename":"bookkeeper.log","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T11:47:24.092+0000","size":120186,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12513596/bookkeeper.log"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513925","id":"12513925","filename":"BOOKKEEPER-162.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-09T08:08:37.660+0000","size":13243,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12513925/BOOKKEEPER-162.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513829","id":"12513829","filename":"BOOKKEEPER-162.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-08T15:55:38.413+0000","size":14742,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12513829/BOOKKEEPER-162.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513612","id":"12513612","filename":"BOOKKEEPER-162.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T13:39:09.367+0000","size":4861,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12513612/BOOKKEEPER-162.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513606","id":"12513606","filename":"BOOKKEEPER-162.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T12:57:03.082+0000","size":4819,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12513606/BOOKKEEPER-162.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12513602","id":"12513602","filename":"BOOKKEEPER-162.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T12:12:38.934+0000","size":4648,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12513602/BOOKKEEPER-162.patch"}],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"LedgerHandle.readLastConfirmed does not work","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202106","id":"13202106","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Philipp, Are the adds to the ledger asynchronous? Are you calling readLastConfirmed after receiving an ack for some add operation?\n\nIn principle, it should work. Check testReadFromOpenLedger in BookieReadWriteTest. \n\nDo you have logs you can share with us, both bookie and client?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T06:13:19.557+0000","updated":"2012-02-07T06:13:19.557+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202122","id":"13202122","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"Thanks, I tried updated version of testReadFromOpenLedger\n\nSo looks like it was misusing of lhOpen.getLastAddConfirmed(), should use lhOpen.readLastConfirmed() instead.\n\n*Closing issue.*\n\n{code}\n@Test\n    public void testReadFromOpenLedger2() throws IOException {\n        try {\n            // Create a ledger\n            lh = bkc.createLedger(digestType, ledgerPassword);\n            // bkc.initMessageDigest(\"SHA1\");\n            ledgerId = lh.getId();\n            LedgerHandle lhOpen = bkc.openLedgerNoRecovery(ledgerId, digestType, ledgerPassword);\n            LOG.info(\"Ledger ID: \" + lh.getId());\n            for (int i = 0; i < numEntriesToWrite; i++) {\n                ByteBuffer entry = ByteBuffer.allocate(4);\n                entry.putInt(rng.nextInt(maxInt));\n                entry.position(0);\n\n                entries.add(entry.array());\n                entriesSize.add(entry.array().length);\n                lh.addEntry(entry.array());\n                if (i == numEntriesToWrite / 2) {\n                    // no recovery opened ledger 's last confirmed entry id is\n                    // less than written\n                    // and it just can read until (i-1)\n                    int toRead = i - 1;\n                    long readLastConfirmed = lhOpen.readLastConfirmed();\n                    assertTrue(readLastConfirmed != 0);\n                    assertTrue(lhOpen.getLastAddConfirmed() != 0);\n                    Enumeration<LedgerEntry> readEntry = lhOpen.readEntries(toRead, toRead);\n                    assertTrue(\"Enumeration of ledger entries has no element\", readEntry.hasMoreElements() == true);\n                    LedgerEntry e = readEntry.nextElement();\n                    assertEquals(toRead, e.getEntryId());\n                    Assert.assertArrayEquals(entries.get(toRead), e.getEntry());\n                    // should not written to a read only ledger\n                    try {\n                        lhOpen.addEntry(entry.array());\n                        fail(\"Should have thrown an exception here\");\n                    } catch (BKException.BKIllegalOpException bkioe) {\n                        // this is the correct response\n                    } catch (Exception ex) {\n                        LOG.error(\"Unexpected exception\", ex);\n                        fail(\"Unexpected exception\");\n                    }\n\n                }\n            }\n            long last = lh.readLastConfirmed();\n            assertTrue(\"Last confirmed add: \" + last, last == (numEntriesToWrite - 2));\n\n            LOG.debug(\"*** WRITE COMPLETE ***\");\n            // close ledger\n            lh.close();\n            // close read only ledger should not change metadata\n            lhOpen.close();\n        } catch (BKException e) {\n            LOG.error(\"Test failed\", e);\n            fail(\"Test failed due to BookKeeper exception\");\n        } catch (InterruptedException e) {\n            LOG.error(\"Test failed\", e);\n            fail(\"Test failed due to interruption\");\n        }\n    }\n{code}\n\nIn fact nothing is done to original test, but\n\n{code}\nLedgerHandle lhOpen = bkc.openLedgerNoRecovery(ledgerId, digestType, ledgerPassword);\n{code}\nand \n{code}\n// close read only ledger should not change metadata\nlhOpen.close();\n{code}\nmoved out, and \n{code}\nlong readLastConfirmed = lhOpen.readLastConfirmed();\nassertTrue(readLastConfirmed != 0);\nassertTrue(lhOpen.getLastAddConfirmed() != 0);\n{code}\n\n\nSmall question - is there any way to get and updateledger status (closed?) using ledger handle? As I see currently there is no public api for that.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T07:05:37.782+0000","updated":"2012-02-07T07:23:43.254+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202156","id":"13202156","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Correct, we currently don't have an api to check if a ledger is closed. We assume that it is communicated from a writer to a reader by an external channel, e.g., through zookeeper. It wouldn't be difficult to have such a call, though. It is simply checking the ledger metadata on zookeeper.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T08:12:16.130+0000","updated":"2012-02-07T08:12:16.130+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202222","id":"13202222","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"I modified test a little bit to make it fail.\n\nPlease find failing version. It changed to use 2 different BookKeeperTestClient to simulate 2 different pc (may failing case) more precisely.\n\n{code}\n@Test\n    public void testReadFromOpenLedger2() throws Exception {\n        try {\n            BookKeeperTestClient  writerBkc = new BookKeeperTestClient(baseClientConf);\n            BookKeeperTestClient  readerBkc = new BookKeeperTestClient(baseClientConf);\n            // Create a ledger\n            lh = writerBkc.createLedger(digestType, ledgerPassword);\n            // bkc.initMessageDigest(\"SHA1\");\n            ledgerId = lh.getId();\n            LedgerHandle lhOpen = readerBkc.openLedgerNoRecovery(ledgerId, digestType, ledgerPassword);\n            LOG.info(\"Ledger ID: \" + lh.getId());\n            for (int i = 0; i < numEntriesToWrite; i++) {\n                ByteBuffer entry = ByteBuffer.allocate(4);\n                entry.putInt(rng.nextInt(maxInt));\n                entry.position(0);\n\n                entries.add(entry.array());\n                entriesSize.add(entry.array().length);\n                lh.addEntry(entry.array());\n                if (i == numEntriesToWrite / 2) {\n                    // no recovery opened ledger 's last confirmed entry id is\n                    // less than written\n                    // and it just can read until (i-1)\n                    int toRead = i - 1;\n                    long readLastConfirmed = lhOpen.readLastConfirmed();\n                    assertTrue(readLastConfirmed != 0);\n                    Enumeration<LedgerEntry> readEntry = lhOpen.readEntries(toRead, toRead);\n                    assertTrue(\"Enumeration of ledger entries has no element\", readEntry.hasMoreElements() == true);\n                    LedgerEntry e = readEntry.nextElement();\n                    assertEquals(toRead, e.getEntryId());\n                    Assert.assertArrayEquals(entries.get(toRead), e.getEntry());\n                    // should not written to a read only ledger\n                    try {\n                        lhOpen.addEntry(entry.array());\n                        fail(\"Should have thrown an exception here\");\n                    } catch (BKException.BKIllegalOpException bkioe) {\n                        // this is the correct response\n                    } catch (Exception ex) {\n                        LOG.error(\"Unexpected exception\", ex);\n                        fail(\"Unexpected exception\");\n                    }\n\n                }\n            }\n            long last = lh.readLastConfirmed();\n            assertTrue(\"Last confirmed add: \" + last, last == (numEntriesToWrite - 2));\n\n            LOG.debug(\"*** WRITE COMPLETE ***\");\n            // close ledger\n            lh.close();\n            // close read only ledger should not change metadata\n            lhOpen.close();\n        } catch (BKException e) {\n            LOG.error(\"Test failed\", e);\n            fail(\"Test failed due to BookKeeper exception\");\n        } catch (InterruptedException e) {\n            LOG.error(\"Test failed\", e);\n            fail(\"Test failed due to interruption\");\n        }\n    }\n{code}\n\n\nI am getting it failing, as I understand, because of \"lastEntry > lastAddConfirmed\" check.\n{code:title=LedgerHandle.java|borderStyle=solid}\n    public void asyncReadEntries(long firstEntry, long lastEntry,\n                                 ReadCallback cb, Object ctx) {\n        // Little sanity check\n        if (firstEntry < 0 || lastEntry > lastAddConfirmed\n                || firstEntry > lastEntry) {\n            cb.readComplete(BKException.Code.ReadException, this, null, ctx);\n            return;\n        }\n...\n{code}\n\nSo looks like recreation of ledger landle is required every read iteration.\n\nIs it expected?\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T10:45:12.605+0000","updated":"2012-02-07T10:45:12.605+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202251","id":"13202251","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Philipp, Can you generate a patch with your new test, please?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T11:46:12.757+0000","updated":"2012-02-07T11:46:12.757+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202254","id":"13202254","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"Also reproduced situation where noRecover reader always getting 0 .\n\nUnfortunately, I cannot reproduce it using bookkeeper test, only with my app. Currently trying to investigate where I could fail.\n\nAttaching log:\nWriter sends 2 entries with simple content '1', '2'\nReader tries to read lh.readLastConfirmed(), but always getting 0.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T11:47:24.212+0000","updated":"2012-02-07T11:47:24.212+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202259","id":"13202259","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"Please find patch with test attached.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T11:57:53.017+0000","updated":"2012-02-07T11:57:53.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202269","id":"13202269","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"I am confused, now it is passing...\nEither it happens from time to time, or something was corrupted when I was writing it. \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T12:07:26.832+0000","updated":"2012-02-07T12:07:26.832+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202271","id":"13202271","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Uploading patch that fixes this issue. It includes the test Philipp provided.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T12:12:39.111+0000","updated":"2012-02-07T12:12:39.111+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202272","id":"13202272","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"Please find new patch attached, now test failing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T12:12:41.211+0000","updated":"2012-02-07T12:12:41.211+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202274","id":"13202274","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"As you pointed out, the current test in trunk reopens the ledger every time, and it passes if you reopen because we set the lastAddConfirmed value to the max value read from bookies. A second read should fail if you keep reading because the lastEntry the call requests may be larger than the lastAddConfirmed, which is not updated. The patch I provided fixes this issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T12:16:31.964+0000","updated":"2012-02-07T12:16:31.964+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202275","id":"13202275","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"Same patch, but reverted constructor change (I don't use Parametrized test, ofcourse).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T12:18:04.301+0000","updated":"2012-02-07T12:18:04.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202284","id":"13202284","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":">> The patch I provided fixes this issue.\n\nThanks a lot.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T12:27:56.065+0000","updated":"2012-02-07T12:27:56.065+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202335","id":"13202335","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I have refined the test a bit. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T12:57:03.183+0000","updated":"2012-02-07T12:57:03.183+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202362","id":"13202362","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"I started to debug and do have small question.\n\nSame case 1 writer, 1 reader.\nReader tries to request lastAddConfirmed.\n\nOn server side I see there is header:\n{panel}\n[1, 2, 0, 0, 0, 0, 0, 0,\n 0, 0, 0, 0, 0, 0, 0, 2,\n -1, -1, -1, -1, -1, -1, -1, -1]\n{panel}\n\nbuilt in BookieServer\n{code:title=BookieServer.java|borderStyle=solid}\n    private ByteBuffer buildResponse(int errorCode, byte version, byte opCode, long ledgerId, long entryId) {\n        ByteBuffer rsp = ByteBuffer.allocate(24);\n        rsp.putInt(new PacketHeader(version, \n                                    opCode, (short)0).toInt());\n        rsp.putInt(errorCode);\n        rsp.putLong(ledgerId);\n        rsp.putLong(entryId);\n\n        rsp.flip();\n        return rsp;\n    }\n{code}\n\nEntryId here -1, because I was requesting last confirmed.\nRequest looked like\n{panel}\n[1, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, -1, -1, -1, -1, -1, -1, -1, -1]\n{panel}\n\nAlso data itself\n{code:title=EntryLogger.java|borderStyle=solid}\nbyte[] readEntry(long ledgerId, long entryId, long location) throws IOException {\n...\n        byte data[] = new byte[entrySize];\n        ByteBuffer buff = ByteBuffer.wrap(data);\n        int rc = fc.read(buff, pos);\n ...\n    }\n{code}\nI see data itself\n{panel}\n [0, 0, 0, 0, 0, 0, 0, 2,\n 0, 0, 0, 0, 0, 0, 0, 1,\n -1, -1, -1, -1, -1, -1, -1, -1,\n 0, 0, 0, 0, 0, 0, 0, 2,\n -16, 41, -22, 25, 26, 93, -80, -40, -80, -15, 7, -36, 72, -52, 13, -54, 39, 117, 12, -56, 2]\n{panel}\n\nOn client in \n{code:title=DigestManager.java|borderStyle=solid}\n    RecoveryData verifyDigestAndReturnLastConfirmed(ChannelBuffer dataReceived) throws BKDigestMatchException {\n        verifyDigest(dataReceived);\n        dataReceived.readerIndex(8);\n\n        long entryId = dataReceived.readLong();\n        long lastAddConfirmed = dataReceived.readLong();\n        long length = dataReceived.readLong();\n        return new RecoveryData(lastAddConfirmed, entryId);\n\n    }\n{code}\n\nI see (reader offset 32 after \"dataReceived.readerIndex(8);\" - *adjustm. 24 + 8)\n{panel}\n[1, 2, 0, 0, 0, 0, 0, 0,\n 0, 0, 0, 0, 0, 0, 0, 2,\n -1, -1, -1, -1, -1, -1, -1, -1, \n 0, 0, 0, 0, 0, 0, 0, 2,  < ledgerId\n 0, 0, 0, 0, 0, 0, 0, 1,  < long entryId = dataReceived.readLong();\n -1, -1, -1, -1, -1, -1, -1, -1, < long lastAddConfirmed = dataReceived.readLong(); *PROBLEM HERE*\n 0, 0, 0, 0, 0, 0, 0, 2,\n -16, 41, -22, 25, 26, 93, -80, -40, -80, -15, 7, -36, 72, -52, 13, -54, 39, 117, 12, -56, 2]\n{panel}\n\n\nSo, am I right: lastAddConfirmed is a part of record, not calculated on request?\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-07T13:20:54.447+0000","updated":"2012-02-07T13:51:28.720+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202372","id":"13202372","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"It is safer to check if the maxAddConfirmed is larger than lastAddConfirmed before setting. I realized that if the ledger writer invokes it, the patch may set lastAddConfirmed incorrectly. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T13:39:09.509+0000","updated":"2012-02-07T13:39:09.509+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13202521","id":"13202521","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Yes, we write lastAddConfirmed upon every add. No bookie alone knows whether an add has been confirmed to the client application or not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-07T16:46:21.569+0000","updated":"2012-02-07T16:46:21.569+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203255","id":"13203255","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"body":"So my problem - using async adds. That is why LedgerHandle.readLastConfirmed returns 0.\nIn fact, as I understand, it is not correct anyway. It should be -1 in this case (everybookie returned -1) ...\n\nFor my particular problem - will try to to send empty messages periodically just to maintain\nLedgerHandle.readLastConfirmed working on readers...\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=philipp.sushkin","name":"philipp.sushkin","key":"philipp.sushkin","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Philipp Sushkin","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-08T04:13:10.446+0000","updated":"2012-02-08T05:37:57.680+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203349","id":"13203349","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"hmm. currently readLastConfirmed doesn't work correctly in following case:\n\n1) there is no entries in the ledger, readLastConfirmed returns 0.\n2) there is 1 entries in the ledger, readLastConfirmed returns 0.\n\nthis issue is caused by giving a wrong initial value (0) for maxAddConfirmed in ReadLastConfirmedOp.\n\nthe expected value would be better as below: \n\n1) there is no entries in the ledger, readLastConfirmed returns -2.\n2) there is 1 entry in the ledger, readLastConfirmed returns -1.\n\nwhat is your opinion, flavio?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-08T08:06:37.567+0000","updated":"2012-02-08T08:06:37.567+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203355","id":"13203355","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"BTW, if a ledger is closed, readLastConfirmedOp would return wrong last confirmed.\nwe should check a ledger when reading last confirmed. if the ledger is closed, we use the close value in ledger metadata as last confirmed directly, we don't need read it again.\n\nI think this is also a bug related to readLastConfirmed. it is better to fix it in this jira.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-08T08:10:14.415+0000","updated":"2012-02-08T08:10:14.415+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203358","id":"13203358","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Agreed, it shouldn't return 0 when the ledger is empty. In the case the ledger has one element, it should still return -1 (empty) according to the semantics of the call. readLastConfirmed returns the maximum hint across all bookies, and the hint for a ledger is the value of the last confirmed field in the last entry it wrote. Consequently, if there is only one entry written, the hint will say that there is no add confirmed before that one, which is correct.\n\nPerhaps if you need to know precisely which entries have been confirmed, you may want to have the writer communicating to the readers though ZooKeeper or directly (e.g., TCP). The readLastConfirmed mechanism gives an approximation of the state of the ledger, and is particularly useful when writing streams continuously. \n\nIf you can say more about your use case, we may be able to help you decide, Philipp.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-08T08:15:52.933+0000","updated":"2012-02-08T08:15:52.933+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203378","id":"13203378","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'll fix the initialization issue and resubmit the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-08T08:36:28.763+0000","updated":"2012-02-08T08:36:28.763+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203379","id":"13203379","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"About the point on readLastConfirmed, I don't think that's a bug. This call gets the hints from the bookies. There is a similar call that simply reads the local value of the ledger handle once the ledger is open.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-08T08:38:13.865+0000","updated":"2012-02-08T08:38:13.865+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203383","id":"13203383","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"hmm, I think it would be better to add more documents in readLastConfirmed to tell the difference between readLastConfirmed and getLastAddConfirmed. otherwise the different return value would make user confused. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-08T08:47:28.362+0000","updated":"2012-02-08T08:47:28.362+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203387","id":"13203387","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Check the API docs: http://zookeeper.apache.org/bookkeeper/docs/r4.0.0/apidocs/\n\nI don't mind having more documentation added if it is not clear the distinction. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-08T08:56:16.347+0000","updated":"2012-02-08T08:56:16.347+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203408","id":"13203408","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"seems the document is not so clear. It would better to add more :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-08T09:21:37.465+0000","updated":"2012-02-08T09:21:37.465+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13203688","id":"13203688","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Fixed the initialization problem.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-08T15:55:38.504+0000","updated":"2012-02-08T15:55:38.504+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13204323","id":"13204323","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"thanks Flavio. most of the patch is good to me, except that you import LedgerHandle in PerChannelBookieClient and BookKeeperTestClient in BookieReadWriteTest, these two classes are not used, and in ReadLastConfirmedOp.java why you don't use Math.max ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-09T07:23:28.143+0000","updated":"2012-02-09T07:23:28.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13204344","id":"13204344","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks, Sijie. Not using max was part of debugging. I've put it back.\n\nThe reference to LedgerHandle in PerChannelBookieCliet is due to the constant LAST_ADD_CONFIRMED that I moved to BookieProtocol. I think we forgot to move it when we wrote BookieProtocol. To me at least it makes more sense there, though.\n\nThe reference to BookKeeperTestClient was a leftover from Philipp's patch that I forgot to remove when I cleaned it up.\n\nI'm attaching a new patch that fixes all these.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-09T08:08:37.721+0000","updated":"2012-02-09T08:08:37.721+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13204431","id":"13204431","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"the new patch is good to me. +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-02-09T10:35:40.969+0000","updated":"2012-02-09T10:35:40.969+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13204472","id":"13204472","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks, Sijie. If no one else has an issue with this patch, I'll commit it later today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-09T12:14:21.081+0000","updated":"2012-02-09T12:14:21.081+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13206789","id":"13206789","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Committed revision 1243462.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T10:20:11.128+0000","updated":"2012-02-13T10:20:11.128+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13206797","id":"13206797","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in bookkeeper-trunk #356 (See [https://builds.apache.org/job/bookkeeper-trunk/356/])\n    BOOKKEEPER-162: LedgerHandle.readLastConfirmed does not work (fpj) (Revision 1243462)\n\n     Result = SUCCESS\nfpj : \nFiles : \n* /zookeeper/bookkeeper/trunk/CHANGES.txt\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerHandle.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/LedgerRecoveryOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/ReadLastConfirmedOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieProtocol.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookieReadWriteTest.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-02-13T10:39:43.902+0000","updated":"2012-02-13T10:39:43.902+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12541562/comment/13206807","id":"13206807","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Thanks for reporting and helping, Philipp.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-02-13T11:15:44.138+0000","updated":"2012-02-13T11:15:44.138+0000"}],"maxResults":34,"total":34,"startAt":0},"customfield_12311820":"0|i0axsn:","customfield_12314139":null}}

