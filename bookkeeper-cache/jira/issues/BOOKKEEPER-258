{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12555249","self":"https://issues.apache.org/jira/rest/api/2/issue/12555249","key":"BOOKKEEPER-258","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319145","id":"12319145","name":"4.1.0","archived":false,"released":true,"releaseDate":"2012-06-13"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"250345","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12314394","id":"12314394","name":"bookkeeper-server","description":"Bookkeeper server."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"61679","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-258/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7c67b328[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@23ead034[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@725fa0ef[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@741b5e0[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@14a43ee[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@374692e4[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3891143b[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@3275587c[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@61f328ef[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@62214787[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5221b734[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@4a8fb3b4[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-05-26T17:17:46.591+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-258/watchers","watchCount":4,"isWatching":false},"created":"2012-05-14T23:11:52.021+0000","updated":"2012-10-22T14:50:18.058+0000","timeoriginalestimate":null,"description":"{noformat}\n-------------------------------------------------------------------------------\nTest set: org.apache.bookkeeper.bookie.CompactionTest\n-------------------------------------------------------------------------------\nTests run: 5, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 32.557 sec <<< FAILURE!\ntestCompactionSmallEntryLogs(org.apache.bookkeeper.bookie.CompactionTest)  Time elapsed: 6.507 sec  <<< ERROR!\norg.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException\n        at org.apache.bookkeeper.client.BKException.create(BKException.java:62)\n        at org.apache.bookkeeper.client.LedgerHandle.readEntries(LedgerHandle.java:347)\n        at org.apache.bookkeeper.bookie.CompactionTest.verifyLedger(CompactionTest.java:128)\n        at org.apache.bookkeeper.bookie.CompactionTest.testCompactionSmallEntryLogs(CompactionTest.java:317)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at junit.framework.TestCase.runTest(TestCase.java:168)\n        at junit.framework.TestCase.runBare(TestCase.java:134)\n        at junit.framework.TestResult$1.protect(TestResult.java:110)\n        at junit.framework.TestResult.runProtected(TestResult.java:128)\n        at junit.framework.TestResult.run(TestResult.java:113)\n        at junit.framework.TestCase.run(TestCase.java:124)\n        at junit.framework.TestSuite.runTest(TestSuite.java:232)\n        at junit.framework.TestSuite.run(TestSuite.java:227)\n        at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)\n        at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:53)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:123)\n        at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:104)\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)\n        at java.lang.reflect.Method.invoke(Method.java:597)\n        at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:164)\n        at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:110)\n        at org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:172)\n        at org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcessWhenForked(SurefireStarter.java:78)\n        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:70)\n\n{noformat}","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12529739","id":"12529739","filename":"BOOKKEEPER-258.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-25T16:18:21.637+0000","size":6980,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12529739/BOOKKEEPER-258.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12529738","id":"12529738","filename":"BOOKKEEPER-258.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-25T16:17:21.365+0000","size":30008,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12529738/BOOKKEEPER-258.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12528036","id":"12528036","filename":"BOOKKEEPER-258.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-18T10:52:39.481+0000","size":3148,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12528036/BOOKKEEPER-258.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12527846","id":"12527846","filename":"BOOKKEEPER-258.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-17T15:14:41.432+0000","size":4320,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12527846/BOOKKEEPER-258.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12527591","id":"12527591","filename":"BOOKKEEPER-258.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-16T08:35:26.752+0000","size":750,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12527591/BOOKKEEPER-258.diff"}],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"CompactionTest failed","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13275147","id":"13275147","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"@Flavio, from the exception seems that there is no available bookies to connect. I tried to reproduce this issue by running ' while [ $? = 0 ]; do mvn test -Dtest=CompactionTest; done '. but there is no failure for 15 minutes. I will try to run it longer time. \n\nin additional to it, could you provide more details about this, for example any logs?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-15T02:48:46.449+0000","updated":"2012-05-15T02:48:46.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13275160","id":"13275160","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Hi Sijie, I got it while checking BOOKKEEPER-145, but I don't think it is related to the patch. Unfortunately, I was not logging so I only had the exception. I'll also see if I can reproduce it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-15T03:50:40.423+0000","updated":"2012-05-15T03:50:40.423+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13275181","id":"13275181","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"I have reproduced the issue by running 'while [ $? = 0 ]; do mvn test -Dtest=CompactionTest; done ' with logging. but I failed to upload the error log seems that the jira system has some problems. I attached parts of logging infos as below.\n\n{code}\n2012-05-15 12:53:16,530 - INFO  - [Hashed wheel timer #5:PerChannelBookieClient@438] - Disconnected from bookie: /10.82.129.91:5000\n2012-05-15 12:53:16,531 - ERROR - [pool-28-thread-1:PerChannelBookieClient$5@352] - Could not write  request for reading entry: 5 ledger-id: 4 bookie: /10.82.129.91:5000\n2012-05-15 12:53:16,566 - ERROR - [pool-28-thread-1:PendingReadOp@114] - Error: Bookie handle is not available while reading entry: 5 ledgerId: 4 from bookie: /10.  82.129.91:5000\n2012-05-15 12:53:16,567 - ERROR - [pool-28-thread-1:PerChannelBookieClient$5@352] - Could not write  request for reading entry: 0 ledger-id: 4 bookie: /10.82.129.91:5000\n2012-05-15 12:53:16,567 - ERROR - [pool-28-thread-1:PendingReadOp@114] - Error: Bookie handle is not available while reading entry: 0 ledgerId: 4 from bookie: /10.  82.129.91:5000\n2012-05-15 12:53:16,567 - ERROR - [pool-28-thread-1:PerChannelBookieClient$5@352] - Could not write  request for reading entry: 1 ledger-id: 4 bookie: /10.82.129.91:5000\n2012-05-15 12:53:16,567 - INFO  - [main:BookKeeperClusterTestCase@92] - TearDown\n2012-05-15 12:53:16,567 - ERROR - [pool-28-thread-1:PendingReadOp@114] - Error: Bookie handle is not available while reading entry: 1 ledgerId: 4 from bookie: /10.  82.129.91:5000\n2012-05-15 12:53:16,568 - ERROR - [pool-28-thread-1:PerChannelBookieClient$5@352] - Could not write  request for reading entry: 2 ledger-id: 4 bookie: /10.82.129.91:5000\n2012-05-15 12:53:16,568 - ERROR - [pool-28-thread-1:PendingReadOp@114] - Error: Bookie handle is not available while reading entry: 2 ledgerId: 4 from bookie: /10.  82.129.91:5000\n2012-05-15 12:53:16,568 - ERROR - [pool-28-thread-1:PerChannelBookieClient$5@352] - Could not write  request for reading entry: 3 ledger-id: 4 bookie: /10.82.129.91:5000\n2012-05-15 12:53:16,568 - ERROR - [pool-28-thread-1:PendingReadOp@114] - Error: Bookie handle is not available while reading entry: 3 ledgerId: 4 from bookie: /10.  82.129.91:5000\n2012-05-15 12:53:16,568 - ERROR - [pool-28-thread-1:PerChannelBookieClient$5@352] - Could not write  request for reading entry: 4 ledger-id: 4 bookie: /10.82.129.91:5000\n2012-05-15 12:53:16,569 - ERROR - [pool-28-thread-1:PendingReadOp@114] - Error: Bookie handle is not available while reading entry: 4 ledgerId: 4 from bookie: /10.  82.129.91:5000\n2012-05-15 12:53:16,575 - INFO  - [ProcessThread(sid:0 cport:-1)::PrepRequestProcessor@466] - Processed session termination for sessionid: 0x1374ed7ba800001\n2012-05-15 12:53:16,576 - INFO  - [main:ZooKeeper@679] - Session: 0x1374ed7ba800001 closed\n2012-05-15 12:53:16,576 - INFO  - [NIOServerCxn.Factory:0.0.0.0/0.0.0.0:2181:NIOServerCnxn@1000] - Closed socket connection for client /fe80:0:0:0:0:0:0:1%1:58923   which had sessionid 0x1374ed7ba800001\n{code}","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-15T05:10:44.945+0000","updated":"2012-05-15T05:11:17.228+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13275194","id":"13275194","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"looked at the logging messages, seems that it is a race in channel timeout (which is introduced in BOOKKEEPER-23).\n\n{code}\n    public void readEntry(final long ledgerId, final long entryId, ReadEntryCallback cb, Object ctx) {\n        final CompletionKey key = new CompletionKey(ledgerId, entryId);\n        readCompletions.put(key, new ReadCompletion(cb, ctx));\n\n        int totalHeaderSize = 4 // for the length of the packet\n                              + 4 // for request type\n                              + 8 // for ledgerId\n                              + 8; // for entryId\n\n        try{\n            ChannelBuffer tmpEntry = channel.getConfig().getBufferFactory().getBuffer(totalHeaderSize);\n            tmpEntry.writeInt(totalHeaderSize - 4); \n\n            tmpEntry.writeInt(new PacketHeader(BookieProtocol.CURRENT_PROTOCOL_VERSION,\n                                               BookieProtocol.READENTRY, BookieProtocol.FLAG_NONE).toInt());\n            tmpEntry.writeLong(ledgerId);\n            tmpEntry.writeLong(entryId);\n\n            ChannelFuture future = channel.write(tmpEntry);\n            future.addListener(new ChannelFutureListener() {\n                @Override\n                public void operationComplete(ChannelFuture future) throws Exception {\n                    if (future.isSuccess()) {\n                        if (LOG.isDebugEnabled()) {\n                            LOG.debug(\"Successfully wrote request for reading entry: \" + entryId + \" ledger-id: \"\n                                                            + ledgerId + \" bookie: \" + channel.getRemoteAddress());\n                        }\n                    } else {\n                        errorOutReadKey(key);\n                    }\n                }\n            });\n        } catch(Throwable e) {\n            LOG.warn(\"Read entry operation failed\", e);\n            errorOutReadKey(key);\n        }\n    }\n{code}\n\nin PerChannelBookieClient#readEntry, it first added CompletionKey and ReadCompletion in readCompletions queue and then write the request to bookie server.\n\nIf the channel timeout happened (in CompactionTest there is a time period waiting for compaction finished, so there are no activities in that channel, a timeout would happen), it will try to error out all pending requests.\n\n{code}\n    @Override\n    public void channelDisconnected(ChannelHandlerContext ctx, ChannelStateEvent e) throws Exception {\n        LOG.info(\"Disconnected from bookie: \" + addr);\n        errorOutOutstandingEntries(); // <-- here to error all pending requests.\n        channel.close();\n        synchronized (this) {\n            state = ConnectionState.DISCONNECTED;\n        }\n\n        // we don't want to reconnect right away. If someone sends a request to\n        // this address, we will reconnect.\n    }\n{code} \n\ndid a summary of this issue, the read operations are failed due to a channel timeout. the channel timeout is because there is no activities on the channel.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-15T05:41:45.034+0000","updated":"2012-05-15T05:41:45.034+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13275203","id":"13275203","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"the timeout mechanism deployed in BOOKKEEPER-23 is to use Netty's ReadTimeoutHandler, which monitors a connection rather than an individual messages. this mechanism is quite simple and useful when the traffic is continuous. but the side-effect of such mechanism is if the traffic arrives per timeout interval. these requests would be failed by mistake when connection timeout.\n\nI don't think we have good idea to handle it using ReadTimeoutHandler unless employing new timeout mechanism for individual messages like in Hedwig Client. Because the channel timeout behavior is in Netty, we have no control on it. If the connection timeouts, the channel would be closed by Netty.\n\nFrom the Netty mailist ( http://lists.jboss.org/pipermail/netty-users/2010-August/003088.html ), modifying pipeline is relatively an expensive operation, so it is expensive to set a new ReadTimeoutHandler for every single write to avoid the above issue.\n\nSo I suggested that we added a configuration setting to disable readTimeout for the test, and we needed a new jira to discuss a more robust timeout mechanism. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-15T06:02:30.870+0000","updated":"2012-05-15T06:02:30.870+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13275484","id":"13275484","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Why does the connection timing out cause a problem though? It should reconnect the next time a request comes in. This error indicates to me that the read request itself is timing out, which means the client is making a request and of receiving a response for the length of the readTimeout. This is bad, and indicates that the serverside is hung. Does the compaction block client requests from completing?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-15T10:36:29.566+0000","updated":"2012-05-15T10:36:29.566+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13276593","id":"13276593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"I did set readTimeout to a large value to disable readTimeout during testing. and I ran \" while [ $? = 0 ]; do mvn test -Dtest=CompactionTest >> compaction.log; done \" for several hours, it doesn't reproduce the issue.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-16T08:35:26.779+0000","updated":"2012-05-16T08:35:26.779+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13276601","id":"13276601","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"This indicates that compaction is causing big GC waits though, or something similar, which is bad. We should run this test with profiling on to see what GC is doing.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-16T08:44:05.010+0000","updated":"2012-05-16T08:44:05.010+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13276607","id":"13276607","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"@Ivan\n\nto explain why readTimeout cause this issue. we had to clarify two things, 1) how readTimeout works? 2) how the test runs.\n\nfor first thing, from Netty documents (http://docs.jboss.org/netty/3.1/api/org/jboss/netty/handler/timeout/ReadTimeoutHandler.html). The timeout happened when no data was read within a certain of period time.\n\nfor second thing, CompactionTest#testCompactionSmallEntryLogs ran as below:\n1) add several messages to bookkeeper. (so the connection will be established to bookie server)\n2) delete ledgers and sleep to wait for GC. the sleep interval is {MajorCompactionInterval + GcWaitTime}, which is 5 seconds, equals to ReadTimeout (is also 5 seconds). so during 5 seconds, there is no activities. The channel might be time out after the sleep interval.\n3) read entries to verify them.\n{code}\n\n        client.connectIfNeededAndDoOp(new GenericCallback<Void>() {\n            @Override\n            public void operationComplete(int rc, Void result) {\n\n                if (rc != BKException.Code.OK) {\n                    cb.readEntryComplete(rc, ledgerId, entryId, null, ctx);\n                    return;\n                }   \n                client.readEntry(ledgerId, entryId, cb, ctx);\n            }   \n        }); \n{code}\n\nAs the code indicated above, the channel is only checked when calling client.connectIfNeededAndDoOp. If  the channel is not set to disconnected, the client.readEntry will be called to send requests. After client.readEntry put the completion keys in completion pending queue, the channel timeout happened (there is no data read from channel, and the time has been up to 5 seconds due to sleep), all those requests would be error out.\n\n\nFor continuous traffic, it is OK because there is data to read on the channel. But if the traffic arrives in readtimeout interval, there is no data to read for readtimeout interval, the channel has to be closed due to readtimeout.\n\nFor more, the timeout callback is triggered by Netty. so we have no idea that when the timeout callback will be triggered. So it is difficult to guarantee the readEntry/addEntry operations be executed atomically before/after timeout callback.  \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-16T08:53:38.258+0000","updated":"2012-05-16T08:53:38.258+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13276615","id":"13276615","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"ah, so it's a race between the check of connection state and the timeout. If the timeout occurs between the check for being connected, and the op being done, then we get this error.\n\nIm not sure how to fix this nicely. I need to think about it.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-16T09:21:23.213+0000","updated":"2012-05-16T09:21:23.213+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13277883","id":"13277883","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"This patch takes a different approach. I keep track of whether there has been any request on the channel when we receive a read timeout. If there is no unacked request, do not disconnect, if I timeout waiting for a response, disconnect (the bookie is down or unresponsive).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-17T15:14:41.741+0000","updated":"2012-05-17T15:14:41.741+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13277894","id":"13277894","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"This is still failing after about 30 minutes of running. Fix must be incomplete.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-17T15:34:58.297+0000","updated":"2012-05-17T15:34:58.297+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13278416","id":"13278416","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"the problem of the new patch here is there is no synchronization between calling ctx.getChannel().disconnect() and channlDisconnected() is called. so the read operations would have chances to be executed after you called ctx.getChannel().diconnect().","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-17T23:54:23.594+0000","updated":"2012-05-17T23:54:23.594+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13278713","id":"13278713","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Another new approach. Now I don't timeout the whole channel, just the individual requests on the channel. This means that a timeout can't kill the channel half way through a request. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-18T10:52:39.570+0000","updated":"2012-05-18T10:52:39.570+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13278791","id":"13278791","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"After running for 2 hours, no failures, so i'd consider this last fix to be good.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-18T13:09:32.599+0000","updated":"2012-05-18T13:09:32.599+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13279983","id":"13279983","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"@Ivan, the patch seems good to me. I was thinking that is there any side effects in this approach. You don't close the channel when first read timeout. If another {readTimeout} seconds goes again and no read activities came in, will the readTimeout be triggered again? should we add another test case for such case?\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-21T06:39:44.641+0000","updated":"2012-05-21T06:39:44.641+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13280839","id":"13280839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"The ReadTimeoutHandler sets the timeout again after triggering the exceptionCaught callback.\n\nhttp://www.grepcode.com/file/repo1.maven.org/maven2/org.jboss.netty/netty/3.2.4.Final/org/jboss/netty/handler/timeout/ReadTimeoutHandler.java\n\nIn terms of sideeffects, there shouldn't be any. The Channel will stay around, but any ledger handle using it will stop using it, once write or read requests have been timed out. The channel will eventually go away. At this point, there'll be no outstanding requests, so nothing will happen to the client. If there are outstanding requests, they'll simply be errored out. \n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-22T09:35:00.449+0000","updated":"2012-05-22T09:35:00.449+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13282155","id":"13282155","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Ivan for explanation. The patch looks good to me. +1\n\n@Flavio, could you take a look at this patch and give your opinion on it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-24T03:19:13.202+0000","updated":"2012-05-24T03:19:13.202+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13282285","id":"13282285","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I don't fully understand the consequences of removing \"ctx.getChannel().disconnect();\" in this patch. Can we get sockets lingering over if we don't call disconnect? Could you guys please clarify?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-24T11:29:43.872+0000","updated":"2012-05-24T11:29:43.872+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13282598","id":"13282598","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"The removal of the disconnect means that the channel will not immediately be closed on a read timeout. If anything is subsequently written to the socket, it will timeout. Se 4.2.3.5 of [1]. From a quick test I did of this on one of our clusters, the retransmits are exhausted after about 15 minutes. \n\nSo the upshot of this is that the channel may stick around for 15 minutes after failure, even though any requests to the socket will be failed after readTimeout. In practice, after the read timeout occurs on the socket, no new requests will be sent to the socket, as it should have been removed from the ensemble of the writing ledger. \n\n[1] http://tools.ietf.org/html/rfc1122","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-24T16:25:03.059+0000","updated":"2012-05-24T16:25:03.059+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13282694","id":"13282694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I'm a bit confused about the semantics of that exception. This page:\n\nhttp://docs.jboss.org/netty/3.2/api/org/jboss/netty/handler/timeout/ReadTimeoutHandler.html\n\nsays: Raises a ReadTimeoutException when no data was read within a certain period of time. We don't do heartbeats, so the absence of data to read does not necessarily imply that the bookie is gone.\n\nbq. If anything is subsequently written to the socket, it will timeout.\n\nI'm not sure how you're drawing this conclusion, Ivan.\n\nbq. even though any requests to the socket will be failed after readTimeout. \n\nSame here, I'm not sure how we can guarantee this.\n\nbq. In practice, after the read timeout occurs on the socket, no new requests will be sent to the socket, as it should have been removed from the ensemble of the writing ledger.\n\nIs it guaranteed that after a read timeout exception, a new attempt to write to the socket will fail? The description of the read timeout exception does not seem to imply that the socket has gone broken once such an exception is thrown.  ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-24T20:52:37.391+0000","updated":"2012-05-24T20:52:37.391+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13283213","id":"13283213","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"bq.  {quote}If anything is subsequently written to the socket, it will timeout. {quote} I'm not sure how you're drawing this conclusion, Ivan.\nSection 4.2.3.5 of the TCP rfc[1] states this. \n{quote}\n(c)  When the number of transmissions of the same segment\n     reaches a threshold R2 greater than R1, close the\n     connection.\n{quote}\nR2 & R1 are defined by the kernel. they are 15 & 3 respectively on the machines I tested on.\n\nbq. {quote}even though any requests to the socket will be failed after readTimeout. {quote} Same here, I'm not sure how we can guarantee this.\n\nThe requests on the sockets are stored in addCompletions and readCompletions. This patch errors out the completions on receiving a ReadTimeoutException.\n\nbq. {quote} In practice, after the read timeout occurs on the socket, no new requests will be sent to the socket, as it should have been removed from the ensemble of the writing ledger. {quote} Is it guaranteed that after a read timeout exception, a new attempt to write to the socket will fail? The description of the read timeout exception does not seem to imply that the socket has gone broken once such an exception is thrown. \n\nThe ReadTimeoutException is simply a notification that nothing has been read from the channel in the timeout period. It does nothing to modify the state of the channel/socket[2].\n\n[1] http://tools.ietf.org/html/rfc1122\n[2] http://www.grepcode.com/file/repo1.maven.org/maven2/org.jboss.netty/netty/3.2.4.Final/org/jboss/netty/handler/timeout/ReadTimeoutHandler.java","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-25T08:25:54.406+0000","updated":"2012-05-25T08:25:54.406+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13283249","id":"13283249","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"> says: Raises a ReadTimeoutException when no data was read within a certain period of time. We don't do heartbeats, so the absence of data to read does not necessarily imply that the bookie is gone.\n\nyes. you are right.\n\nas Ivan indicated in the previous comment, the ReadTimeoutException is a simple notification to tell the client that there is no data read in the timeout period. And this readTimeout notification is running periodically every ${readTimeout} seconds when there is no data read from channel. (the channel would still be alive.)\n\nthe issue to do 'ctx.getChannel().disconnect()' when read timeout happened is that it would fail those requests issued right at that time by mistake. Checking the request time when read timeout instead of killing the channel would avoid this mistake.\n\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-25T09:35:58.675+0000","updated":"2012-05-25T09:35:58.675+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13283492","id":"13283492","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Ivan and I discussed offline and Ivan proposed to disconnect from BookieWatcher once the client determines that a bookie has failed (through ZooKeeper). Cancelling this patch until Ivan uploads a new one.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-25T14:43:10.298+0000","updated":"2012-05-25T14:43:10.298+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13283570","id":"13283570","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Same as before, but closes channels when it sees bookies go away in /ledgers/available","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-25T16:17:21.422+0000","updated":"2012-05-25T16:17:21.422+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13283571","id":"13283571","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Forgot to rebase before old patch. This one has rebase","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-25T16:18:21.666+0000","updated":"2012-05-25T16:18:21.666+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13283596","id":"13283596","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"+1, it is good for me. I have also verified that tests run fine.\n\nSijie, what do you say?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-05-25T16:55:58.576+0000","updated":"2012-05-25T16:55:58.576+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13283866","id":"13283866","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"new patch looks good to me too. closing channels when bookies go away is a good idea. +1","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-26T01:27:09.260+0000","updated":"2012-05-26T01:27:09.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13284019","id":"13284019","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"committed as r1342933.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-26T17:17:05.968+0000","updated":"2012-05-26T17:17:05.968+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13284021","id":"13284021","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Thanks Ivan for the work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-05-26T17:17:46.629+0000","updated":"2012-05-26T17:17:46.629+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12555249/comment/13284024","id":"13284024","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in bookkeeper-trunk #529 (See [https://builds.apache.org/job/bookkeeper-trunk/529/])\n    BOOKKEEPER-258: CompactionTest failed (ivank via sijie) (Revision 1342933)\n\n     Result = SUCCESS\nsijie : \nFiles : \n* /zookeeper/bookkeeper/trunk/CHANGES.txt\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookieWatcher.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/BookieClient.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/proto/PerChannelBookieClient.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/proto/TestProtoVersions.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-05-26T17:37:31.429+0000","updated":"2012-05-26T17:37:31.429+0000"}],"maxResults":31,"total":31,"startAt":0},"customfield_12311820":"0|i0axdb:","customfield_12314139":null}}

