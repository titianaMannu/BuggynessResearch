{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12603455","self":"https://issues.apache.org/jira/rest/api/2/issue/12603455","key":"BOOKKEEPER-365","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320244","id":"12320244","description":"Release 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2013-01-19"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"255149","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12317843","id":"12317843","description":"","name":"4.0.0","archived":false,"released":true,"releaseDate":"2011-12-07"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12319145","id":"12319145","name":"4.1.0","archived":false,"released":true,"releaseDate":"2012-06-13"}],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[{"id":"12361840","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12361840","type":{"id":"10032","name":"Blocker","inward":"is blocked by","outward":"blocks","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10032"},"outwardIssue":{"id":"12602144","key":"BOOKKEEPER-355","self":"https://issues.apache.org/jira/rest/api/2/issue/12602144","fields":{"summary":"Ledger recovery will mark ledger as closed with -1, in case of slow bookie is added to ensemble during  recovery add","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12357025","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12357025","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12602475","key":"BOOKKEEPER-361","self":"https://issues.apache.org/jira/rest/api/2/issue/12602475","fields":{"summary":"Ledger will never recover if one of the quorum bookie is down forever and others dont have entry.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}},{"id":"12357024","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12357024","type":{"id":"12310000","name":"Duplicate","inward":"is duplicated by","outward":"duplicates","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/12310000"},"outwardIssue":{"id":"12602404","key":"BOOKKEEPER-356","self":"https://issues.apache.org/jira/rest/api/2/issue/12602404","fields":{"summary":"Ledger will never recover if one of the quorum bookie is down forever and others dont have entry","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/5","description":"A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/resolved.png","name":"Resolved","id":"5","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/4","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/minor.svg","name":"Minor","id":"4"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"83922","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-365/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@630eaeb1[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5f4404aa[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@45c44e3c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@3a5a637a[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@227772c7[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@390b68ae[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@5e59641d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@37f19d1f[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2e89206c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@4c25730b[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@59c99f1e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@62ebe85d[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-12-13T11:33:40.739+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-365/watchers","watchCount":5,"isWatching":false},"created":"2012-08-14T14:09:04.767+0000","updated":"2013-02-13T15:46:25.031+0000","timeoriginalestimate":null,"description":"As discussed in BOOKKEEPER-355, current fix to handle the below issue is not correct. Need to find out new solution\nIf some bookies of a quorum gone forever, some bookies of this quorum are still alive but doesn't have that entry (NoSuchEntry or NoSuchLedger), then the ledger doesn't have any evidence to recovery/close it.","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12560626","id":"12560626","filename":"BOOKKEEPER-365.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-12T19:58:40.497+0000","size":19122,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12560626/BOOKKEEPER-365.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12560509","id":"12560509","filename":"BOOKKEEPER-365.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-12T05:46:57.518+0000","size":18989,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12560509/BOOKKEEPER-365.diff"}],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Ledger will never recover if one of the quorum bookie is down forever and others dont have entry","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13434177","id":"13434177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"I would try to summarize the problem of recovery read causing by current read strategy.\n\nsuppose A, B, C is the quorum that an entry try to read.\n\n1) if A, B returns NoSuchEntry/NoSuchLedger, C couldn't connect. the read response return CouldNotConnectException.\n2) if A couldn't connect, B, C returns NoSuchEntry/NoSuchLedger. the read response return NoSuchEntry/NoSuchLedger.\n\nLedgerRecovery treats 1) as failure would not close ledger while treats 2) as normal case to close the ledger.\n\nBut neither 1) nor 2) acts correctly.\n\nFor 1), if recovery read tries read an non-existed entry, all A, B, C don't have the entry. if C goes down't forever, BookKeeperAdmin runs BookieRecovery to replace C. But it still can't close the ledger to proceed recovery. so the ledger would not be available for read.\n\nFor 2), closing the ledger would cause entry loss if A encountering a transient failure such as network partition.\n\nOne possible idea for recovery read of last entry, we only close the ledger when received NoSuchLedger/NoSuchEntry from all quorums, which resolves 2). But it still have problem 1) if a machine is gone forever. for 1), the ledger status is undetermined. it would cause lots of ledgers are unreadable (could not be open) if we try to replace a bookie (using BookieAdmin) which happens to be the last bookie in last ensemble. \n\nJust wrote down my previous ideas. Welcome for comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-08-14T15:09:46.012+0000","updated":"2012-08-14T15:09:46.012+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13490273","id":"13490273","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"In general, Quorum based read/write requires that Qw + Qr > Q. e.g. the ensemble size is 3, write quorum is 2, read quorum needs to be at least 2.\n\nIn BK, we relax it by using read quorum 1. It works because it never updates an entry once its written.\n\nIn your example, it seems the ensemble size 3, read quorum 1, write quorum 2.\n\nDuring recovery, we can raise the standard, requiring read quorum 2, which address above issue.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-04T19:30:23.904+0000","updated":"2012-11-04T19:30:23.904+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13490288","id":"13490288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"To add more detail, the recovery needs to consult at least read-quorum (2) bookies to get last-confirmed entry id, instead of max of all, uses the max entry id which at least two bookies have. Let us call this read_quorum_rule.\n\nNow we go back to your example,\n1) can proceed since both A, B claim no entries for the ledger, the last-confirmed-entry-id is 0 based on the read_quorum_rule.\n2) is correct, as B and C claim no entries for the ledger.\n\nOf course, if recovery cannot reach at least read-quorum(2) bookies, then it cannot close the ledger.\n\nThe reasoning is based on the fact that if Write-quorum is not reached, then the entry is not acknowledged to clients. It is legal for it to be lost.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-11-04T20:15:33.384+0000","updated":"2012-11-04T20:15:33.384+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13529078","id":"13529078","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Let me add a few comments to this discussion.\n\nIn Sijie's example, has the entry is being read ever written successfully to all of A, B, and C? From the example, it is not clear, but I'm assuming that the write quorum is 3. If so, then it violates an assumption we make for the system. We can detect corrupt entries with the digest, but we can't really always guarantee recovery in the case that bookies drop entries altogether. \n\nTo simplify perhaps the discussion and illustrate what we guarantee, say that we write entries to two bookies. When it is time to read a given entry (successfully written) let's say that one bookie has corrupted it and the other is partitioned away. The client executing the recovery procedure see the corrupt copy of the entry and it doesn't know if the other bookie has a good copy or not. If it does, then the entry has been written successfully. If it doesn't, then the entry hasn't been written successfully. To decide, we need the second bookie, so we can't close the ledger until the second bookie comes back. We should perhaps review what exception we would get in this case. \n\nIn Andrew's observation, it is correct that if the client hasn't written enough copies (ack quorum), then we don't guarantee that the entry will be there when the ledger is closed. Keep in mind that we don't use all possible read/write quorums, since we pick quorums in a round-robin fashion. When recovering a ledger, we need to touch every write quorum we can possibly use to fence off the writer. Read and write quorums overlap fully by design. \n\nOne point I don't understand is why we should expect to get the same LAC (Last Add Confirmed) from two different bookies. Each bookie could have a different one, and it would be ok. Also, keep in mind that LAC is only a hint. After we pick a LAC, we still try to read after that value to see how far we can go.\n\nFinally, it would be good to decide if there is anything here to fix for 4.2.0. I'm smelling that there isn't, but I'd like to hear opinions.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-11T16:02:07.306+0000","updated":"2012-12-11T16:02:07.306+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13529398","id":"13529398","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Rethinking a bit of BOOKKEEPER-365 and BOOKKEEPER-355. They are quite irrelative.\n\nNoSuchEntry and NoSuchLedger are treated as the termination condition for LedgerRecovery. So it is important that how to decide it was NoSuchEntry/NoSuchLedger. otherwise, the client would be be mislead.\n\nCurrently we used a kind of read-all-write-quorums to ensure it was actually NoSuchLedger and NoSuchEntry. But it wasn't necessary, we just need check at least (write_quorum_size - ack_quorum_size + 1) bookies regarding entries missing case. So when the write_quorum_size and ack_quorum_size is same, we just need 1 bookie to confirm NoSuchLedger and NoSuchEntry (it is what we did currently). But it should be fixed since we already separated ack_quorum_size from write_quorum_size. This jira tends to fix it.\n\nGo back to entries/ledgers missing case. How would missing case happen?\n\n1) a ledger disk (ledger directory) doesn't mount correctly. All the ledgers in that ledger disk would be lost and respond NoSuchLedger.\n2) an entry is corrupted. \n3) A brand new bookie is replaced when changing ensemble.\n4) a ledger index file is removed or truncated by mistake.\n5) some other bugs causing entries missing.\n\n1) is already addressed by Cookie. \n\nfor 2), bookie should respond ReadException rather than NoSuchLedger and NoSuchEntry. so it would be treated as a valid read instead of NoSuchLedger and NoSuchEntry. so it would not affect how we decide if it was NoSuchEntry.\n\nfor 3), it was actually the root cause of BOOKKEEPER-355. A brand new bookie is introduced in last ensemble which affect how we decide if it was NoSuchEntry/NoSuchLedger. Lets take an example from BOOKKEEPER-355.\n\nSuppose there are 3 bookie A, B, C. ensemble size = 2, write quorum size = 2, ack quorum size = 1.\n\n1) Ledger L is created with A, B.\n2) Add entry 0. entry 0 is written to A. but failed to add to B.\n3) A client came in and fence ledger L.\n4) client reads entry 0 and try to add this entry back to A, B again.\n5) network partition happened, client could not connect to A.\n6) C is picked up to replace A.\n7) B, C are not connected. client failed the recovery\n8) another client tried to recover again.\n9) it connected to B, C. they respond NoSuchLedger. and the ledger is closed with zero entries. and entry 0 is lost.\n\nthe problem is that we replaced C with A before writing recovered entries, which caused the info in A are lost, which would cause wrong decision during ledger recover. even worse, if the whole ensemble is replaced totally, we lost all the info to recover a ledger. it would be pretty bad.\n\nso fixing BOOKKEEPER-355 doesn't depend on how we read from the quorum, but how we could avoid such replacement by mistake.\n\nfor 4), I think it should not be addressed by the project itself, shouldn't it?\n\nfor 5), I have to say we need to avoid such bugs at the best.\n\nI think for BOOKKEEPER-355, we have to fix it in 4.2.0. otherwise, it looks bad. for BOOKKEEPER-365, we need to add some code to cover the cases we separating write_quorum_size and ack_quorum_size. so it tends to be in 4.2.0 too.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-11T22:22:09.407+0000","updated":"2012-12-11T22:23:12.420+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13529638","id":"13529638","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Attach a patch tries to address the issue separating write_quorum_size and ack_quorum_size.\n\nthe patch includes:\n\n1) a test case produce the issue separating write_quorum_size and ack_quorum_size.\n2) move LedgerRecoveryTest to client package, for ease to access ledger metadata. and it also make more sense that ledger recovery is a client procedure.\n3) the fix check how many missed read (NoSuchLedger/NoSuchEntry) we had received and if it reaches more than (write_quorum_size - ack_quorum_size + 1) and there was no sensible exceptions (like ReadException) found during reading. we treated the entry is missed, return submit NoSuchEntry to client.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-12T05:46:57.521+0000","updated":"2012-12-12T05:46:57.521+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530001","id":"13530001","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Part of the problem here is that we're updating ledger metadata on recovery before we actually write anything to the new bookie. On an active ledgerhandle we need to update the metadata before writing so that we don't loose data. But on a recovery ledger handle, we can do all the recovery, and just update the ledger handle when we close. So why don't we do just that? We already have a ReadOnlyLedgerHandle. We can just block metadata updates for handleBookieFailure and that should solve the problem.\n\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-12T14:47:10.515+0000","updated":"2012-12-12T14:47:10.515+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530072","id":"13530072","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Actually, the client will never get NoSuchLedger back from the bookie. It only ever gets NoSuchEntry. See PerChannelBookieClient.java. This should allow you to make your patch simpler. I'm unclear on what maxMissedReadsAllowed actually means.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-12T16:21:26.390+0000","updated":"2012-12-12T16:21:26.390+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530184","id":"13530184","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nBut on a recovery ledger handle, we can do all the recovery, and just update the ledger handle when we close. So why don't we do just that? We already have a ReadOnlyLedgerHandle. We can just block metadata updates for handleBookieFailure and that should solve the problem.\n{quote}\n\nyup. this is the idea fixing BOOKKEEPER-355, which the case 3) I described in previous comment.\n\nfor this jira, I tends to fix the issue caused by separating write_quorum_size and ack_quorum_size.\n\n{quote}\nIt only ever gets NoSuchEntry. See PerChannelBookieClient.java. This should allow you to make your patch simpler\n{quote}\n\nYou are right. I missed that part in PerChannelBookieClient.\n\n{quote}\nI'm unclear on what maxMissedReadsAllowed actually means.\n{quote}\n\nmaxMissedReadsAllowed means the max number of NoSuchEntry reads happened in a quorum. if this number is larger than (write_quorum_size - ack_quorum_size), it means that the entry hasn't ack'ed successfully based on the guarantee provides by 'ack_quorum'.\n\n ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-12T18:29:51.072+0000","updated":"2012-12-12T18:29:51.072+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530227","id":"13530227","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"ah, so the test in BOOKKEEPER-355 and your test are different. I didn't go through them line by line, as they looked very similiar, I thought you were fixing 355 within this patch also. In that case, I have a preliminary patch for 355, ill post it tomorrow after I submit this.\n\n{quote}\nmaxMissedReadsAllowed means the max number of NoSuchEntry reads happened in a quorum. if this number is larger than (write_quorum_size - ack_quorum_size), it means that the entry hasn't ack'ed successfully based on the guarantee provides by 'ack_quorum'.{quote}\nOk, I understand now. If the number of NoSuchEntry is greater than the difference between ack quorum and write quorum, then the ack quorum could never have been completed. However, in your patch, you have\n{code}\nmaxMissedReadsAllowed = lh.metadata.getWriteQuorumSize() - lh.metadata.getAckQuorumSize() + 1;\n{code}\nIs the + 1 correct?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-12T19:19:39.166+0000","updated":"2012-12-12T19:19:39.166+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530261","id":"13530261","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Update a new patch to reflect right meaning for maxMissingReadsAllowed. and also remove NoSuchLedger checking in the code.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-12T19:58:40.499+0000","updated":"2012-12-12T19:58:40.499+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530265","id":"13530265","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nah, so the test in BOOKKEEPER-355 and your test are different. I didn't go through them line by line, as they looked very similiar, I thought you were fixing 355 within this patch also.\n{quote}\n\nI think it would fix BOOKKEEPER-355 because the test case in BOOKKEEPER-355 is not perfect to cover the reason you described.\n\nthe solution you described in the previous comment would be the right way to fix BOOKKEEPER-355.\n\n{quote}\nIs the + 1 correct?\n{quote}\n\nUpdate a new patch to reflect to right meaning of maxMissingReadsAllowed.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-12T20:01:43.204+0000","updated":"2012-12-12T20:01:43.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530419","id":"13530419","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Hey guys, I'm trying to catch up with all the updates. If I understand your patch, Sijie, you're making sure that we return NoSuchEntry when enough bookies say they don't know about a given entry. Your patch also performs this check using write and quorum sizes. If this is the case, it sounds reasonable to me.\n\nI don't particularly like the example you used here, though:  \n\nhttps://issues.apache.org/jira/browse/BOOKKEEPER-365?focusedCommentId=13529398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13529398\n\nIf ack quorum size is 1, then we can't tolerate a single failure, consequently the example is not fault tolerant by definition. Replacing the bookie actually is the wrong thing to do, but I think it is a special case that we shouldn't take care of. \n\nI was actually wondering about warning users in the case they use such a value for ack quorums.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-12T22:15:03.612+0000","updated":"2012-12-12T22:15:03.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530686","id":"13530686","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nIf this is the case, it sounds reasonable to me.\n{quote}\n\nYes, as you described.\n\n{quote}\nIf ack quorum size is 1, then we can't tolerate a single failure, consequently the example is not fault tolerant by definition.\n{quote}\n\nTaking quorum size 1 just to ease explaining that it was a bad idea to replace a bookie before writing entries for a recover procedure. I think we need to avoid it using Ivan's proposal. This would be adressed in BOOKKEEPER-355. Ivan already worked on it, I think.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-12-13T05:13:51.841+0000","updated":"2012-12-13T05:13:51.841+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530912","id":"13530912","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"new patch lgtm +1\n\ncommitting.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-13T11:31:17.326+0000","updated":"2012-12-13T11:31:17.326+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13530914","id":"13530914","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Committed as r1421235. Thanks Sijie.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-13T11:33:40.798+0000","updated":"2012-12-13T11:33:40.798+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12603455/comment/13532107","id":"13532107","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in bookkeeper-trunk #860 (See [https://builds.apache.org/job/bookkeeper-trunk/860/])\n    BOOKKEEPER-365: Ledger will never recover if one of the quorum bookie is down forever and others dont have entry (sijie via ivank) (Revision 1421235)\n\n     Result = FAILURE\nivank : \nFiles : \n* /zookeeper/bookkeeper/trunk/CHANGES.txt\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/PendingReadOp.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/LedgerRecoveryTest.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/BookKeeperClusterTestCase.java\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/test/java/org/apache/bookkeeper/test/LedgerRecoveryTest.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-12-14T06:51:28.558+0000","updated":"2012-12-14T06:51:28.558+0000"}],"maxResults":17,"total":17,"startAt":0},"customfield_12311820":"0|i0epof:","customfield_12314139":null}}

