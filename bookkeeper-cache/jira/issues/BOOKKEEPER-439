{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12612647","self":"https://issues.apache.org/jira/rest/api/2/issue/12612647","key":"BOOKKEEPER-439","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320244","id":"12320244","description":"Release 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2013-01-19"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"249896","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12319145","id":"12319145","name":"4.1.0","archived":false,"released":true,"releaseDate":"2012-06-13"},{"self":"https://issues.apache.org/jira/rest/api/2/version/12320244","id":"12320244","description":"Release 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2013-01-19"}],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[{"id":"12359469","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12359469","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"inwardIssue":{"id":"12613433","key":"BOOKKEEPER-442","self":"https://issues.apache.org/jira/rest/api/2/issue/12613433","fields":{"summary":"Failed to deliver messages due to inconsistency between SubscriptionState and LedgerRanges.","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12314392","id":"12314392","name":"hedwig-server","description":"Hedwig server."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"60003","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-439/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@7ed110d[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1823b208[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@6426f29e[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@6190bfe0[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@12c4a87a[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@7ef86d3a[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2d19d279[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@49920785[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7e22e1b5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@430ed2f6[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@20674af4[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@7990df52[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2012-10-26T13:17:45.457+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-439/watchers","watchCount":5,"isWatching":false},"created":"2012-10-19T10:08:27.465+0000","updated":"2013-02-13T15:46:55.073+0000","timeoriginalestimate":null,"description":"We encountered exception as below:\n\n{quote}\n\n2012-10-18 09:27:27,248 - DEBUG [CacheThread:BookkeeperPersistenceManager$RangeScanOp@247] - Issuing a bk read for ledger: L2 from entry-id: 100 to entry-id: 103\n2012-10-18 09:27:27,248 - ERROR [CacheThread:BookkeeperPersistenceManager$RangeScanOp$2@261] - Error while reading from ledger: L2 for topic: TOPIC\norg.apache.bookkeeper.client.BKException$BKReadException\n        at org.apache.bookkeeper.client.BKException.create(BKException.java:48)\n        at org.apache.hedwig.server.persistence.BookkeeperPersistenceManager$RangeScanOp$2.safeReadComplete(BookkeeperPersistenceManager.java:260)\n        at org.apache.hedwig.zookeeper.SafeAsynBKCallback$ReadCallback.readComplete(SafeAsynBKCallback.java:61)\n        at org.apache.bookkeeper.client.LedgerHandle.asyncReadEntries(LedgerHandle.java:380)\n        at org.apache.hedwig.server.persistence.BookkeeperPersistenceManager$RangeScanOp.read(BookkeeperPersistenceManager.java:252)\n        at org.apache.hedwig.server.persistence.BookkeeperPersistenceManager$RangeScanOp.startReadingFrom(BookkeeperPersistenceManager.java:327)\n        at org.apache.hedwig.server.persistence.BookkeeperPersistenceManager$RangeScanOp.runInternal(BookkeeperPersistenceManager.java:217)\n        at org.apache.hedwig.server.common.TopicOpQueuer$SynchronousOp.run(TopicOpQueuer.java:77)\n        at org.apache.hedwig.server.common.TopicOpQueuer.pushAndMaybeRun(TopicOpQueuer.java:105)\n        at org.apache.hedwig.server.persistence.BookkeeperPersistenceManager.scanMessages(BookkeeperPersistenceManager.java:336)\n        at org.apache.hedwig.server.persistence.ReadAheadCache$ScanRequestWrapper.performRequest(ReadAheadCache.java:704)\n        at org.apache.hedwig.server.persistence.ReadAheadCache.run(ReadAheadCache.java:291)\n        at java.lang.Thread.run(Thread.java:662)\n\n{quote}\n\ntopic TOPIC has 2 ledgers L1, L2, each ledger has 100 entries.\n\n1) all the 100 entries in L1 has been delivered and consumed.\n2) 100 entries have been wrote to L2 but not delivered.\n3) L1 is deleted since all its entries have been consumed.\n4) hub server shuts down\n5) TOPIC recovered L2 and started delivering from 101.\n\nTOPIC was expected to issue a read [0-3] from L2, but a read [100-103] was issued from the exception log, so no entries would be expected to read from L2 at [100-103].\n\nThe problem of this issue is that we used 0 and 1 for the start of message id and ledger id even we had some consumed ledgers deleted.\n\n{code}\n        void processTopicLedgerRanges(final LedgerRanges ranges, final Version version) {\n            Iterator<LedgerRange> lrIterator = ranges.getRangesList().iterator();\n            TopicInfo topicInfo = new TopicInfo();\n\n            long startOfLedger = 1;\n\n            while (lrIterator.hasNext()) {\n                LedgerRange range = lrIterator.next();\n\n                if (range.hasEndSeqIdIncluded()) {\n                    // this means it was a valid and completely closed ledger\n                    long endOfLedger = range.getEndSeqIdIncluded().getLocalComponent();\n                    topicInfo.ledgerRanges.put(endOfLedger, new InMemoryLedgerRange(range,           startOfLedger));                             startOfLedger = endOfLedger + 1;\n                    continue;\n                }        \n\n                // If it doesn't have a valid end, it must be the last ledger\n                if (lrIterator.hasNext()) {\n                    String msg = \"Ledger-id: \" + range.getLedgerId() + \" for topic: \" + topic.       toStringUtf8()                                            + \" is not the last one but still does not have an end seq-id\";\n                    logger.error(msg);\n                    cb.operationFailed(ctx, new PubSubException.UnexpectedConditionException(msg));\n                    return;                }\n\n                // The last ledger does not have a valid seq-id, lets try to\n                // find it out\n                recoverLastTopicLedgerAndOpenNewOne(range.getLedgerId(), version, topicInfo);\n                return;\n            }\n{code}\n\n{code}\n                            long prevLedgerEnd = topicInfo.ledgerRanges.isEmpty() ? 0 : topicInfo.   ledgerRanges\n                                                 .lastKey();\n                            LedgerRange lr = LedgerRange.newBuilder().setLedgerId(ledgerId)\n                                             .setEndSeqIdIncluded(lastMessage.getMsgId()).build();\n                            topicInfo.ledgerRanges.put(lr.getEndSeqIdIncluded().getLocalComponent(),\n                                    new InMemoryLedgerRange(lr, prevLedgerEnd + 1, lh));\n{code}","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12550947","id":"12550947","filename":"BOOKKEEPER-439.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-26T10:44:44.159+0000","size":75026,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12550947/BOOKKEEPER-439.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12550421","id":"12550421","filename":"BOOKKEEPER-439.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T07:38:09.141+0000","size":74385,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12550421/BOOKKEEPER-439.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12550271","id":"12550271","filename":"BOOKKEEPER-439.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T13:41:41.169+0000","size":63767,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12550271/BOOKKEEPER-439.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12550252","id":"12550252","filename":"BOOKKEEPER-439.diff","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T07:21:01.331+0000","size":47651,"mimeType":"application/octet-stream","content":"https://issues.apache.org/jira/secure/attachment/12550252/BOOKKEEPER-439.diff"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12550318","id":"12550318","filename":"TopicMetadataAddStartSeqId.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T18:21:33.851+0000","size":46529,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12550318/TopicMetadataAddStartSeqId.patch"}],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"No more messages delivered after deleted consumed ledgers.","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13479927","id":"13479927","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"the fix would be quite simple, we just need to compute the right start seq id of the topic. Besides that, hedwig console have same issue to print right range about topic's persistence info.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-19T10:10:26.072+0000","updated":"2012-10-19T10:10:26.072+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13480618","id":"13480618","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=i0exception","name":"i0exception","key":"i0exception","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aniruddha","active":true,"timeZone":"America/Los_Angeles"},"body":"[~hustlmsp] How about persisting this in Zookeeper? ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=i0exception","name":"i0exception","key":"i0exception","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aniruddha","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-20T03:28:02.574+0000","updated":"2012-10-20T03:28:02.574+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13480816","id":"13480816","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"I have a patch ready and tested, since we encountered this issue in our production system.\nTrying to figure out how to enlist to the repository to rebase my patch. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-20T19:45:25.588+0000","updated":"2012-10-20T19:45:25.588+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481216","id":"13481216","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Ah, [~yx3zhu@gmail.com] I missed your comment last friday. I had a patch when I created this jira but forgot to attach it interrupted by other things. I would attach it here for review to see whether it works for you or not.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T06:48:26.260+0000","updated":"2012-10-22T06:48:26.260+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481231","id":"13481231","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Attach a patch to address the issue. The main idea is to open first ledger to get num entries to compute right start seq id.\n\nbut it could not resolve a case (a test case I added in the patch testScanMessagesOnEmptyLedgerAfterDeleteLedger).\n\n1) published 2 messages into a topic.\n2) release/acquire topic to force a new ledger\n3) consumed published messages, so the previous ledger is deleted, but no messages are in current ledger.\n4) release/acquire topic, the ledger created in 2) will be pruned due to there is no ledgers in it. a new ledger is created to serving new messages.\n5) publish 2 more messages.\n\nthe expected message ids published in 5) would be 3 and 4. but we had no knowledge about start seq id, so messages would assigned seq id with 1 and 2.\n\nin order to fix this case, I improve protocol of LedgerRanges to add a field 'startSeqId'.\n\nBesides these two fixes, I added 3 test cases to verify them.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T07:21:01.333+0000","updated":"2012-10-22T07:21:01.333+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481233","id":"13481233","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~i0exception] I added 'startSeqId' in LedgerRanges to address an issue I described in above comment. Could you take a look at the patch to see whether it works for you or not?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T07:22:32.987+0000","updated":"2012-10-22T07:22:32.987+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481361","id":"13481361","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"update a patch to cover another case when failed to update ledger ranges.\n\n1) suppose T has L1, L2.\n2) consumeUntil to delete L1 and L2.\n3) delete ledger L1 and updateLedgerRange to remove L1 range. update failed.\n4) delate ledger L2 and updateLedgerRange to remove L2 range. update succeed.\n5) topic is acquired again, but there is range L1 existed (L2 has been removed). so message seq id is assigned starting from last seq id of L1, which is duplicated with consumed L2.\n\nthe fix is to update delete ledgers in batch to avoid gap existed in ledger ranges.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T13:41:41.171+0000","updated":"2012-10-22T13:41:41.171+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481498","id":"13481498","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"Sijie,\n\nIn my patch, startSeqId is added inside LedgerRange itself. (I was told that it is ok to introduce breaking change).\nIt should be simpler.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T16:53:25.278+0000","updated":"2012-10-22T16:53:25.278+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481578","id":"13481578","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"Added my patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T18:21:33.854+0000","updated":"2012-10-22T18:21:33.854+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481582","id":"13481582","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"Sijie,\nI feel that my patch is simpler. Could you take a look?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T18:25:53.451+0000","updated":"2012-10-22T18:25:53.451+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481919","id":"13481919","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yx3zhu@gmail.com] your patch looks simpler. but there are several issues that the patch doesn't fix.\n\n1) the patch break backward compatibility. the patch could not process the metadata introduced in previous building (4.1.0).\n\n2) the patch doesn't address the gap of ledger ranges introduced by deleted consumed ledgers. there was still gap existed in ledger ranges when deleting consumed ledgers, which would introduce duplicated sequence id, those messages have duplicated sequence id would not be delivered to consumer since their sequence id is smaller than consume ptr although they are newly published messages.\n\nmy patch focused on fixing the above 2 issues.\n\nEither adding startSeqId in LedgerRange or in LedgerRanges could not resolve 2). We need to change ConsumedUntilOp to avoid gap introduced ledger ranges. If there is no gap could be introduced in LedgerRanges, I think we just only need to add startSeqId in LedgerRanges. I don't feel strong where to add startSeqId. I just want to clarify my changes for this issue is not just adding startSeqId.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T23:21:24.156+0000","updated":"2012-10-22T23:21:24.156+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481939","id":"13481939","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"Hi Sijie,\n\nThanks for your comment -\nAs to 1), As stated in \"comment - 22/Oct/12 09:53\", it is Ok to introduce breaking change in hedwig per folks in our team.\nAs to 2), the gap of ledger ranges are Ok, as you may observe, anytime we delete consumed ledgers, we always add current-ledger-range in the ledger metadata, which carries the start-seq-id in itself.\nYour patch to fix 2) is due to the usage of start-seq-id only in LedgerRanges, which lack this kind of information.\n\nlet me know if you see any issues.\nBest Regards\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T23:45:52.211+0000","updated":"2012-10-22T23:45:52.211+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481941","id":"13481941","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"Sijie,\nI can add the unit-test you introduced.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T23:46:57.410+0000","updated":"2012-10-22T23:46:57.410+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481947","id":"13481947","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=i0exception","name":"i0exception","key":"i0exception","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aniruddha","active":true,"timeZone":"America/Los_Angeles"},"body":"To clarify (1), I believe there have been a few breaking changes introduced in Hedwig that are not compatible with 4.1.0 (Storing topic ownership information/storing hub load information etc.) I feel it should be okay to introduce breaking changes in a major version update. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=i0exception","name":"i0exception","key":"i0exception","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aniruddha","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-22T23:53:48.241+0000","updated":"2012-10-22T23:53:48.241+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481960","id":"13481960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~i0exception] I don't think topic ownership info and hub load info break compatibility. All compatibilities are introduced by features like message filter, message bound, which are documented in TestBackward. I think for metadata, we need to take care of it, since there are already systems running using old version. It is not a good idea to ask users to delete their metadata and use new package directly.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T00:06:32.455+0000","updated":"2012-10-23T00:06:32.455+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481980","id":"13481980","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~yx3zhu@gmail.com] Ur right about 2) adding startSeqId in ledger range. You could add unit tests (in order to pass unit tests, you need include changes in bookkeeper-server to throw BKNoSuchLedgerExistsException when delete non-existed ledger and catch it when deleteLedger otherwise that ledger range entry would never removed from ledger ranges).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T00:26:41.377+0000","updated":"2012-10-23T00:26:41.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13481999","id":"13481999","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"More points added for ConsumeUntilOp changes:\n1) I changed deleteLedger from synchronous call to asynchronous call, so it would not block other requests in topic queuer.\n2) Batching removed deleted ledgers would reduce number of UpdateLedgerOp in topic queuer, while UpdateLedgerOp is asynchronous op, which also block other requests in topic queuer.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T00:54:13.350+0000","updated":"2012-10-23T00:54:13.350+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13482002","id":"13482002","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=i0exception","name":"i0exception","key":"i0exception","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aniruddha","active":true,"timeZone":"America/Los_Angeles"},"body":"[~hustlmsp] Well, the metadata that they're currently running with is inconsistent so I'm assuming they would want to clear state and get into a correct state. I'd prefer storing the start sequence ID with LedgerRange instead of LedgerRanges. One way to keep BC would be to make this an optional field and as we invoke UpdateLedgerOp, update this lazily. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=i0exception","name":"i0exception","key":"i0exception","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Aniruddha","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T00:59:29.576+0000","updated":"2012-10-23T00:59:29.576+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13482025","id":"13482025","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"Sijie,\nThe async and batching can be tracked as a separate task.\nI will add unit-test and update the patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T01:40:39.186+0000","updated":"2012-10-23T01:40:39.186+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13482048","id":"13482048","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~i0exception] \n\n{quote}\nWell, the metadata that they're currently running with is inconsistent so I'm assuming they would want to clear state and get into a correct state. \n{quote}\n\nThe problem here is a scan on wrong entry id so continuous message would not be delivered. it just needs to fix the computation of offset.\n\n{quote}\nI'd prefer storing the start sequence ID with LedgerRange instead of LedgerRanges.\n{quote}\n\nI would change startSeqId to LedgerRange, since you already have it. I would attach a patch moving startSeqId from LedgerRanges to LedgerRange, since my patch already addressed BC issue, which would be easy to do the change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T02:09:08.199+0000","updated":"2012-10-23T02:09:08.199+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13482100","id":"13482100","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"body":"Sijie,\nJust fixing the computation wont adress the already-wrong metadata, where all closed ranges GCed.\nI understand that you have worked on it, but I am not sure if your patch is closer to the solution, rather the other way around.\nTo be clear, I started with adding startSeqId in LedgerRanges, the switch is non-trivial work.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=yx3zhu%40gmail.com","name":"yx3zhu@gmail.com","key":"yx3zhu@gmail.com","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Yixue Zhu","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T04:26:16.204+0000","updated":"2012-10-23T04:26:16.204+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13482114","id":"13482114","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nJust fixing the computation wont adress the already-wrong metadata, where all closed ranges GCed.\n{quote}\n\nAt least, the new code needs to read 1) correct old version metadata, 2) the metadata described in #testScanMessagesOnClosedLedgerAfterDeleteLedger and #testScanMessagesOnUnclosedLedgerAfterDeleteLedger (in my patch).\n\nThe ledger ranges introduced gap like #testScanMessagesOnEmptyLedgerAfterDeleteLedger and #failedToDeleteLedgersTest. The sequence is already wrong as you described but it would not block delivering continuous messages if future published messages fill up the gap. The only bad part of these topics would be missing the messages in this gap.\n\nI think my patch works same as your patch to address this issue. the only difference between your patch with mine is different place to put start seq id, it introduced different LedgerRanges metadata. since you already had a metadata change, I am OK to align with your changes putting startSeqId in LedgerRange rather than LedgerRanges, which would not break your running system.\n\nI had a patch ready now, but needs to run the tests before attaching it. You could take a look at it after that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T05:01:34.372+0000","updated":"2012-10-23T05:01:34.372+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13482177","id":"13482177","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Attach a new patch to move startSeqId from LedgerRanges to LedgerRange while keeping the code to maintain BC.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-23T07:38:09.143+0000","updated":"2012-10-23T07:38:09.143+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13484087","id":"13484087","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Why are you changing the return code for delete?\n\nYou never close the ledger opened in getStartSeqIdToProcessTopicLedgerRanges()\nYou never close the ledger in recoverLastTopicLedgerAndOpenNewOne()\n\nin getStartSeqIdToProcessTopicLedgerRanges, for\n{code}\nif (!range.hasEndSeqIdIncluded()) {\n    // process topic ledger ranges directly\n    processTopicLedgerRanges(rangesList, version, START_SEQ_ID);\n    return;\n}\n{code}\nadd a comment that, as the ledger will be recovered, the start seq id will be discovered at that point.\n\nfor the NoSuchLedgerExistsException case in getStartSeqIdToProcessTopicLedgerRanges(),\nshouldn't we try the next ledger in this case? what if the next ledger is also missing the start id?\n\nIn UpdateLedgerOp#run, doRemove is a confusing name, I expected it to be used later on to decide whether the update was done, and it was only when i looked at the later code that i realised that keysToRemove.empty() was what was used. I would rename it to foundUnconsumedLedger.\n\nIt would be good to have a backwards compat test for this.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-25T12:55:28.871+0000","updated":"2012-10-25T12:55:28.871+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13484593","id":"13484593","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"{quote}\nWhy are you changing the return code for delete?\n{quote}\n\nDelete ledger doesn't throw the right exception according to the returned rc. So when you delete a non-existent ledger, you will got ZKException rather than NoSuchLedgerExistsException.\n\n{quote}\nYou never close the ledger opened in getStartSeqIdToProcessTopicLedgerRanges()\n{quote}\n\nUr right. will close ledger handle in next patch.\n\n{quote}\nYou never close the ledger in recoverLastTopicLedgerAndOpenNewOne()\n{quote}\n\nThe ledger handle could not be closed, since it passed to InMemoryLedgerRanges to future reading.\n\n{quote}\nfor the NoSuchLedgerExistsException case in getStartSeqIdToProcessTopicLedgerRanges(),\nshouldn't we try the next ledger in this case? what if the next ledger is also missing the start id?\n{quote}\n\nNo, we don't need to. Because the end seq id of current ledger plus 1 would be the the start id of next ledger id, it could be calculated using previous one's ledger id.\n\n{quote}\nI would rename it to foundUnconsumedLedger.\n{quote}\n\nWill update it in next patch.\n\n{quote}\nIt would be good to have a backwards compat test for this.\n{quote}\n\nI did it on TestBookKeeperPersistenceManager. I removed start seq id in LedgerRanges to test reading old version metadata.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-26T00:03:27.378+0000","updated":"2012-10-26T00:03:27.378+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13484839","id":"13484839","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Update a new patch addressing Ivan's comments.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2012-10-26T10:44:44.161+0000","updated":"2012-10-26T10:44:44.161+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13484905","id":"13484905","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Committed r1402501. Good work Sijie.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-10-26T13:17:45.472+0000","updated":"2012-10-26T13:17:45.472+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12612647/comment/13484987","id":"13484987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in bookkeeper-trunk #776 (See [https://builds.apache.org/job/bookkeeper-trunk/776/])\n    BOOKKEEPER-439: No more messages delivered after deleted consumed ledgers. (sijie via ivank) (Revision 1402501)\n\n     Result = UNSTABLE\nivank : \nFiles : \n* /zookeeper/bookkeeper/trunk/CHANGES.txt\n* /zookeeper/bookkeeper/trunk/bookkeeper-server/src/main/java/org/apache/bookkeeper/client/BookKeeper.java\n* /zookeeper/bookkeeper/trunk/hedwig-protocol/src/main/java/org/apache/hedwig/protocol/PubSubProtocol.java\n* /zookeeper/bookkeeper/trunk/hedwig-protocol/src/main/protobuf/PubSubProtocol.proto\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/admin/HedwigAdmin.java\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/admin/console/HedwigConsole.java\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/admin/console/ReadTopic.java\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/persistence/BookkeeperPersistenceManager.java\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/test/java/org/apache/hedwig/server/persistence/TestBookKeeperPersistenceManager.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2012-10-26T15:18:40.810+0000","updated":"2012-10-26T15:18:40.810+0000"}],"maxResults":28,"total":28,"startAt":0},"customfield_12311820":"0|i0an0v:","customfield_12314139":null}}

