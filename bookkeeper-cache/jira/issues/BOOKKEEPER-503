{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12623785","self":"https://issues.apache.org/jira/rest/api/2/issue/12623785","key":"BOOKKEEPER-503","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12320244","id":"12320244","description":"Release 4.2.0","name":"4.2.0","archived":false,"released":true,"releaseDate":"2013-01-19"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"297485","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":[],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[{"id":"12362877","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12362877","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12626710","key":"BOOKKEEPER-539","self":"https://issues.apache.org/jira/rest/api/2/issue/12626710","fields":{"summary":"ClientNotSubscribedException & doesn't receive enough messages in TestThrottlingDelivery#testServerSideThrottle","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/1","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/blocker.svg","name":"Blocker","id":"1"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12314392","id":"12314392","name":"hedwig-server","description":"Hedwig server."}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"235518","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-503/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@3b993bc8[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@77cd8c49[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@2ff8ece8[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@344c829a[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@952e8a5[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@3a7330a6[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@520404ac[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@20c1424[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@1c85d300[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@3fd02636[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@4d037404[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@2f4ce4b4[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2013-01-12T17:55:49.968+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-503/watchers","watchCount":5,"isWatching":false},"created":"2012-12-13T17:11:05.758+0000","updated":"2013-02-13T15:46:45.269+0000","timeoriginalestimate":null,"description":"Running follow script in hedwig-server project\n{code:java}\nwhile mvn test -Dtest=TestThrottlingDelivery; do echo .; done\n{code}\nWe may get assertion failure:\n{code:java}\ntestServerSideThrottle[0](org.apache.hedwig.server.delivery.TestThrottlingDelivery)  Time elapsed: 14.922 sec  <<< FAILURE!\njunit.framework.AssertionFailedError: Timed out waiting for messages 31\n\tat junit.framework.Assert.fail(Assert.java:47)\n\tat junit.framework.Assert.assertTrue(Assert.java:20)\n\tat org.apache.hedwig.server.delivery.TestThrottlingDelivery.throttleX(TestThrottlingDelivery.java:159)\n\tat org.apache.hedwig.server.delivery.TestThrottlingDelivery.testServerSideThrottle(TestThrottlingDelivery.java:206)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:601)\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)\n\tat org.junit.internal.runners.statements.FailOnTimeout$1.run(FailOnTimeout.java:28)\n{code}\n\nThis is a race issue which may cause messages been throttled by mistake, the root cause is ActiveSubscriberState.messageConsumed() and ActiveSubscriberState.deliverNextMessage() may be executed in different threads by AbstractSubscriptionManager and FIFODeliveryManager.\n\nRead the log in attachement around Line 2420 if you want to get more information, here I replay the logs onto the code (Line XX denotes code listed below):\n# Messages 1-30 are to be delivered and the message window size in Hub server is 10.\n# Messages 1-10 are delivered to subscriber while message 11-30 is throttled by the window size limitation.\n# Subscriber calls consume 1-10 asynchronously.\n# CONSUME 1 is handled and FIFODeliveryManager continue to deliver message 11.\n# Subscriber receive message 11 and quickly ack CONSUME 11 to Hub.\n# Now there are two threads operate on a same ActiveSubscriberState:\n#* Thread in AbstractSubscriptionManager: call ActiveSubscriberState.messageConsumed() for message 2, 3, 11 (4-10 is still on the way since it's asynchronous consume). Let's assume this thread happen to run in Line (14) for message 11.\n#* Thread in FIFODeliveryManager:  Coincidently, it's in Line (36) now (with last delivered 11, last consumed 1 and variable isThrottled is still false).\n# If thread in AbstractSubscriptionManager executed before FIFODeliveryManager, then consume operator for 11 does nothing more.\n# CONSUME [4-10] will be just ignored by the if statement in Line (2) since lastSeqIdConsumedUtil is now 11.\n# Further messages like 12 have no chance to been delivered at this time.\n\n{code:java}\n(01) protected void messageConsumed(long newSeqIdConsumed) {\n(02)     if (newSeqIdConsumed <= lastSeqIdConsumedUtil) {\n(03)         return;\n(04)     }\n(05)     if (logger.isDebugEnabled()) {\n(06)         logger.debug(\"Subscriber ({}) moved consumed ptr from {} to {}.\",\n(07)                      va(this, lastSeqIdConsumedUtil, newSeqIdConsumed));\n(08)     }\n(09)     lastSeqIdConsumedUtil = newSeqIdConsumed;\n(10)     // after updated seq id check whether it still exceed msg limitation\n(11)     if (msgLimitExceeded()) {\n(12)         return;\n(13)     }\n(14)     if (isThrottled) {\n(15)         isThrottled = false;\n(16)         logger.info(\"Try to wake up subscriber ({}) to deliver messages again : last delivered {}, last consumed {}.\",\n(17)                     va(this, lastLocalSeqIdDelivered, lastSeqIdConsumedUtil));\n(18) \n(19)         enqueueWithoutFailure(new DeliveryManagerRequest() {\n(20)             @Override\n(21)             public void performRequest() {\n(22)                 // enqueue \n(23)                 clearRetryDelayForSubscriber(ActiveSubscriberState.this);            \n(24)             }\n(25)         });\n(26)     }\n(27) }\n(28) \n(29) public void deliverNextMessage() {\n(30)     if (!isConnected()) {\n(31)         return;\n(32)     }\n(33) \n(34)     // check whether we have delivered enough messages without receiving their consumes\n(35)     if (msgLimitExceeded()) {\n(36)         logger.info(\"Subscriber ({}) is throttled : last delivered {}, last consumed {}.\",\n(37)                     va(this, lastLocalSeqIdDelivered, lastSeqIdConsumedUtil));\n(38)         isThrottled = true;\n(39)         // do nothing, since the delivery process would be throttled.\n(40)         // After message consumed, it would be added back to retry queue.\n(41)         return;\n(42)     }\n(43) \n(44)     localSeqIdDeliveringNow = persistenceMgr.getSeqIdAfterSkipping(topic, lastLocalSeqIdDelivered, 1);\n(45) \n(46)     ScanRequest scanRequest = new ScanRequest(topic, localSeqIdDeliveringNow,\n(47)             /* callback= */this, /* ctx= */null);\n(48) \n(49)     persistenceMgr.scanSingleMessage(scanRequest);\n(50) }\n{code}\n\nBy the way, we should also take care of thread-safe issue in other methods for ActiveSubscriberState, which implements some other callback interface.","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12564201","id":"12564201","filename":"0001-BOOKKEEPER-503-Test-case.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-10T17:17:32.251+0000","size":9081,"mimeType":"text/x-patch","content":"https://issues.apache.org/jira/secure/attachment/12564201/0001-BOOKKEEPER-503-Test-case.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12564558","id":"12564558","filename":"BOOKKEEPER-503.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-12T06:29:40.432+0000","size":16405,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12564558/BOOKKEEPER-503.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12564499","id":"12564499","filename":"BOOKKEEPER-503.patch","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-11T21:59:08.297+0000","size":16980,"mimeType":"text/plain","content":"https://issues.apache.org/jira/secure/attachment/12564499/BOOKKEEPER-503.patch"},{"self":"https://issues.apache.org/jira/rest/api/2/attachment/12563410","id":"12563410","filename":"logs.tar","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-05T10:06:43.237+0000","size":101969,"mimeType":"application/x-tar","content":"https://issues.apache.org/jira/secure/attachment/12563410/logs.tar"}],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"The test case of TestThrottlingDelivery#testServerSideThrottle failed sometimes","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13537242","id":"13537242","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"I had a quick look at this. I think it's something to do with BOOKKEEPER-507.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2012-12-20T18:33:53.519+0000","updated":"2012-12-20T18:33:53.519+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13543644","id":"13543644","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"I had run 'while [ 0 -lt 10 ]; do mvn test -Dtest=TestThrottlingDelivery; echo '-----'; done' for hours. it doesn't reproduce the issue described as above. I think it is fixed after fixing BOOKKEEPER-507. so is it OK to close it? it could be reopened if it reproduced.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-04T06:50:02.116+0000","updated":"2013-01-04T06:50:02.116+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13543779","id":"13543779","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"Let's close it as you suggest, Sijie. I'm marking it as \"Cannot reproduce\".","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-04T10:44:43.476+0000","updated":"2013-01-04T10:44:43.476+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13543834","id":"13543834","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"I pull the newest code and run with command \"while mvn test -Dtest=TestThrottlingDelivery; do echo .; done\" and it failed in my dev box.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-04T12:19:43.986+0000","updated":"2013-01-04T12:19:43.986+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13543835","id":"13543835","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"Reopen since it happen in my dev box.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-04T12:21:08.178+0000","updated":"2013-01-04T12:21:08.178+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13543966","id":"13543966","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"body":"I can't reproduce this one. Jiannan, is there anything special about your setup? Could you have a closer look at the issue to see what's going since you're able to reproduce it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=fpj","name":"fpj","key":"fpj","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=fpj&avatarId=16030","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=fpj&avatarId=16030","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=fpj&avatarId=16030","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=fpj&avatarId=16030"},"displayName":"Flavio Paiva Junqueira","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-04T15:49:43.062+0000","updated":"2013-01-04T15:49:43.062+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13544291","id":"13544291","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jiannan]\n\n{quote}\nMessage 12 has no chance to been delivered.\n{quote}\n\nif CONSUME 11 arrives before CONSUME[2-10], so the gap becomes to 1 which is less than the window size, right? so we should deliver message 12, right?\n\nCould you enable DEBUG when you run the test and attach the log for failures? \n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-04T22:03:33.834+0000","updated":"2013-01-04T22:03:33.834+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13544575","id":"13544575","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"Sorry, there are some problem in my description, I didn't post it last night but I run out of battery in my Mac book. I'll update it today.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-05T04:28:33.136+0000","updated":"2013-01-05T04:28:33.136+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13544648","id":"13544648","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"Attach fail logs","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-05T10:06:43.240+0000","updated":"2013-01-05T10:06:43.240+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13544771","id":"13544771","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"good job, [~jiannan]\n\nthe race condition happened between checking and setting isThrottled variable.\n\nfor simplification,\n\nA.1 check #msgLimitExceed\nA.2 set isThrottled to true\n\nB.1 modified last consume seq id\nB.2 check #msgLimitExceed\nB.3 check isThrottled\n\nif the sequence is A.1 B.1 B.2 B.3 A.2, then no one could pick the throttled subscriber back to normal.\n\nwe might need some synchronization between these two methods. we could not just simply change messageConsumed to run in DeliveryThread. since #deliveryNextMessage not only run in DeliveryThread, but also run in netty worker thread, in the delivery callback of previous message.\n\n[~jiannan] Could you generate a patch for it?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-05T17:39:32.244+0000","updated":"2013-01-05T17:39:32.244+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13545288","id":"13545288","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"Sure, I'm working on it, I guess I can generate a patch today.\nThanks for Sijie's tip, or I may make the mistake.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-06T03:16:47.274+0000","updated":"2013-01-06T03:16:47.274+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13545705","id":"13545705","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"I find other error messages during test without my patch: \"Client is not yet subscribed to Topic: testServerSideThrottleWithHigherValue, SubscriberId: serverThrottleSub\".\n\nI think I should take a look at it before uploading patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-07T08:56:21.722+0000","updated":"2013-01-07T08:56:21.722+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13548694","id":"13548694","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"The fact that deliverNextMessage is in another thread seems to cause a lot of problems (also BOOKKEEPER-529). Could we solve all this, just by making deliverNextMessage submit a task to the executor, which does that deliverNextMessage does now?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-09T17:23:51.890+0000","updated":"2013-01-09T17:23:51.890+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13549357","id":"13549357","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"we could do it. if we want to do that way, we need to provide multiple threads for delivery manager first, moving BOOKKEEPER-526 from 4.3.0 to 4.2.0. Otherwise, we might encounter performance issue, since original implementation only #deliverNextMessage first time in delivery manager thread, after that it would #deliverNextMessage in netty worker threads. if we submit deliverNextMessage back to delivery manager thread, there is only one delivery manager now. we have to let BOOKKEEPER-526 in before taking this solution here.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-10T04:56:27.510+0000","updated":"2013-01-10T04:56:27.510+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13549803","id":"13549803","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"I've written a test case which should trigger this (if i understand the description correctly). Do you have a fix for this [~jiannan]?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-10T17:17:32.255+0000","updated":"2013-01-10T17:17:32.255+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13549878","id":"13549878","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"I used the same test class for BOOKKEEPER-539, so the test attached for this should be applied on top of that.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-10T18:31:54.619+0000","updated":"2013-01-10T18:31:54.619+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13550804","id":"13550804","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"thanks Ivan for adding test case, I'm basing on 539 to generate patch.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-11T04:17:27.190+0000","updated":"2013-01-11T04:17:27.190+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551552","id":"13551552","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"I go through all variables in ActiveSubscriberState and check which need to be synchronized:\n* {color:red}lastLocalSeqIdDelivered{color}\n** WRITE by sendingFinished(), which is called in netty thread\n** READ by msgLimitExceeded(), which maybe called by messageConsumed() in AbstractSubscriptionManager thread\n* connected\n** has been synchronized\n* {color:red}lastScanErrorTime{color}\n** WRITE by clearLastScanErrorTime(), which is called by clearRetryDelayForSubscriber() in delivery manager thread\n** WRITE by scanFailed(), which is called in netty thread\n* localSeqIdDeliveringNow\n** WRITE by doDeliverNextMessage(), which is called in netty thread\n** READ by sendingFinished(), which is called in the same thread above\n* {color:red}lastSeqIdCommunicatedExternally{color}\n** WRITE by sendingFinished(), which is called in netty thread\n** READ by doStopServingSubscriber(), which is called in delivery manager thread\n* {color:red}lastSeqIdConsumedUtil{color}\n** WRITE by messageConsumed(), which is called in AbstractSubscriptionManager thread\n** READ by msgLimitExceeded(), which maybe called by doDeliverNextMessage() in netty thread\n* {color:red}isThrottled{color}\n** WRITE by messageConsumed(), which is called in AbstractSubscriptionManager thread\n** READ by sendingFinished(), which is called in netty thread\n* Other variables\n** assigned in ActiveSubscriberState constructor and only READ in other methods\n\nSince there are many variables require synchronization, I only share a common ReentrantReadWriteLock between them. After [BOOKKEEPER-526|https://issues.apache.org/jira/browse/BOOKKEEPER-526], we can remove this lock and run all operations of ActiveSubscriberState in same thread. By the way, there has been a ReentrantReadWriteLock \"connectedLock\" in ActiveSubscriberState, I think it's Ok to reuse instead of adding a new ReentrantReadWriteLock object, but I don't change it in this patch (should I reuse it?).\n\nAnd I fix another two problem to make my code pass all test cases:\n* StubPersistenceManager#scanSingleMessage doesn't response with seq ID (and then response.getMessage().getMsgId() always return 0)\n* TestFIFODeliveryManager#testFIFODeliverySubCloseSubRace() startServingSubscription should start delivery from 1.\n\nWith this patch, there is no error found in my dev box with running TestThrottlingDelivery for 2 hours (it taks about 20 minutes to fail test in my dev box before).","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-11T21:59:08.301+0000","updated":"2013-01-11T21:59:08.301+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551825","id":"13551825","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jiannan] good job, thanks for detail analyzing the variables. actually you don't need to use ReadWriteLock. Read/Write locks allow in multiple readers a the same time, but only if no writers are already in. Hence under some usage scenarios we can get better concurrency, because the reader populations can proceed together. but in this case, reader and writer are only one. you could use synchronized to make the code simple and clean. in honestly, connectLock could use synchronized too.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-12T06:23:21.554+0000","updated":"2013-01-12T06:23:21.554+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551827","id":"13551827","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"provide a version using synchronized which might make code clean.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-12T06:29:40.436+0000","updated":"2013-01-12T06:29:40.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551828","id":"13551828","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"[~jiannan] could you take a look at the patch using synchronized?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2013-01-12T06:30:58.522+0000","updated":"2013-01-12T06:30:58.522+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551831","id":"13551831","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"Testing JIRA BOOKKEEPER-503\n\n\nPatch [BOOKKEEPER-503.patch|https://issues.apache.org/jira/secure/attachment/12564499/BOOKKEEPER-503.patch] downloaded at Sat Jan 12 06:08:20 UTC 2013\n\n----------------------------\n\n{color:green}+1 PATCH_APPLIES{color}\n{color:green}+1 CLEAN{color}\n{color:green}+1 RAW_PATCH_ANALYSIS{color}\n.    {color:green}+1{color} the patch does not introduce any @author tags\n.    {color:green}+1{color} the patch does not introduce any tabs\n.    {color:green}+1{color} the patch does not introduce any trailing spaces\n.    {color:green}+1{color} the patch does not introduce any line longer than 120\n.    {color:green}+1{color} the patch does adds/modifies 2 testcase(s)\n{color:green}+1 RAT{color}\n.    {color:green}+1{color} the patch does not seem to introduce new RAT warnings\n{color:green}+1 JAVADOC{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Javadoc warnings\n{color:green}+1 COMPILE{color}\n.    {color:green}+1{color} HEAD compiles\n.    {color:green}+1{color} patch compiles\n.    {color:green}+1{color} the patch does not seem to introduce new javac warnings\n{color:red}-1 FINDBUGS{color}\n.    {color:red}-1{color} the patch seems to introduce 3 new Findbugs warning(s) in module(s) [hedwig-server]\n{color:green}+1 TESTS{color}\n.    Tests run: 788\n{color:green}+1 DISTRO{color}\n.    {color:green}+1{color} distro tarball builds with the patch \n\n----------------------------\n{color:red}*-1 Overall result, please check the reported -1(s)*{color}\n\n\nThe full output of the test-patch run is available at\n\n.   https://builds.apache.org/job/bookkeeper-trunk-precommit-build/243/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-12T06:39:24.074+0000","updated":"2013-01-12T06:39:24.074+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551841","id":"13551841","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"body":"Testing JIRA BOOKKEEPER-503\n\n\nPatch [BOOKKEEPER-503.patch|https://issues.apache.org/jira/secure/attachment/12564558/BOOKKEEPER-503.patch] downloaded at Sat Jan 12 06:39:32 UTC 2013\n\n----------------------------\n\n{color:green}+1 PATCH_APPLIES{color}\n{color:green}+1 CLEAN{color}\n{color:green}+1 RAW_PATCH_ANALYSIS{color}\n.    {color:green}+1{color} the patch does not introduce any @author tags\n.    {color:green}+1{color} the patch does not introduce any tabs\n.    {color:green}+1{color} the patch does not introduce any trailing spaces\n.    {color:green}+1{color} the patch does not introduce any line longer than 120\n.    {color:green}+1{color} the patch does adds/modifies 2 testcase(s)\n{color:green}+1 RAT{color}\n.    {color:green}+1{color} the patch does not seem to introduce new RAT warnings\n{color:green}+1 JAVADOC{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Javadoc warnings\n{color:green}+1 COMPILE{color}\n.    {color:green}+1{color} HEAD compiles\n.    {color:green}+1{color} patch compiles\n.    {color:green}+1{color} the patch does not seem to introduce new javac warnings\n{color:green}+1 FINDBUGS{color}\n.    {color:green}+1{color} the patch does not seem to introduce new Findbugs warnings\n{color:green}+1 TESTS{color}\n.    Tests run: 788\n{color:green}+1 DISTRO{color}\n.    {color:green}+1{color} distro tarball builds with the patch \n\n----------------------------\n{color:green}*+1 Overall result, good!, no -1s*{color}\n\n\nThe full output of the test-patch run is available at\n\n.   https://builds.apache.org/job/bookkeeper-trunk-precommit-build/244/","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hadoopqa","name":"hadoopqa","key":"hadoopqa","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=hadoopqa&avatarId=10393","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=hadoopqa&avatarId=10393","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=hadoopqa&avatarId=10393","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=hadoopqa&avatarId=10393"},"displayName":"Hadoop QA","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-12T07:10:39.596+0000","updated":"2013-01-12T07:10:39.596+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551851","id":"13551851","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"Thanks sijie for clean the code, it looks much better now. The new patch look good to me, only a line in ActiveSubscriberState.toString():\n+            sb.append(\"Subscriber: \"); -> sb.append(\", Subscriber: \");\n+            sb.append(subscriberId.toStringUtf8());\n+            sb.append(\", DeliveryPtr: \");","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-12T07:39:05.356+0000","updated":"2013-01-12T07:39:05.356+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551852","id":"13551852","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"body":"By the way, thanks for explaining ReadWriteLock usage, I didn't think so deep about it. But I think for this scenario, there may more readers, since the ReadWriteLock of my previous patch is shared by many variables. But I can't agree more to use synchronized instead of ReadWriteLock, my previous patch is very very ugly when it compared to yours :)","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=jiannan","name":"jiannan","key":"jiannan","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Jiannan Wang","active":true,"timeZone":"Asia/Shanghai"},"created":"2013-01-12T07:46:55.640+0000","updated":"2013-01-12T07:46:55.640+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551960","id":"13551960","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Patch looks good. +1 from me. synchronized is fine at the ActiveSubscriberState level, as we should only be executing one operation at at time for each subscriber anyhow.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-12T16:54:18.790+0000","updated":"2013-01-12T16:54:18.790+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551976","id":"13551976","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"body":"Committed as r1432485. Thanks guys.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=ikelly","name":"ikelly","key":"ikelly","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Ivan Kelly","active":true,"timeZone":"Europe/Berlin"},"created":"2013-01-12T17:55:49.995+0000","updated":"2013-01-12T17:55:49.995+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12623785/comment/13551987","id":"13551987","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"Integrated in bookkeeper-trunk2 #56 (See [https://builds.apache.org/job/bookkeeper-trunk2/56/])\n    BOOKKEEPER-503: The test case of TestThrottlingDelivery#testServerSideThrottle failed sometimes (jiannan & sijie via ivank) (Revision 1432485)\n\n     Result = SUCCESS\nivank : \nFiles : \n* /zookeeper/bookkeeper/trunk/CHANGES.txt\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/main/java/org/apache/hedwig/server/delivery/FIFODeliveryManager.java\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/test/java/org/apache/hedwig/server/delivery/TestFIFODeliveryManager.java\n* /zookeeper/bookkeeper/trunk/hedwig-server/src/test/java/org/apache/hedwig/server/persistence/StubPersistenceManager.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2013-01-12T18:29:15.187+0000","updated":"2013-01-12T18:29:15.187+0000"}],"maxResults":28,"total":28,"startAt":0},"customfield_12311820":"0|i14p0n:","customfield_12314139":null}}

