{"expand":"renderedFields,names,schema,operations,editmeta,changelog,versionedRepresentations","id":"12955528","self":"https://issues.apache.org/jira/rest/api/2/issue/12955528","key":"BOOKKEEPER-911","fields":{"fixVersions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12325566","id":"12325566","name":"4.4.0","archived":false,"released":true,"releaseDate":"2016-05-16"}],"resolution":{"self":"https://issues.apache.org/jira/rest/api/2/resolution/1","id":"1","description":"A fix for this issue is checked into the tree and tested.","name":"Fixed"},"customfield_12312322":null,"customfield_12312323":null,"customfield_12310420":"9223372036854775807","customfield_12312320":null,"customfield_12312321":null,"customfield_12312328":null,"customfield_12312329":null,"customfield_12312326":null,"customfield_12310300":null,"customfield_12312327":null,"customfield_12312324":null,"customfield_12312720":null,"customfield_12312325":null,"lastViewed":null,"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/3","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/major.svg","name":"Major","id":"3"},"labels":["tests"],"customfield_12312333":null,"customfield_12312334":null,"customfield_12313422":"false","customfield_12312331":null,"customfield_12312332":null,"aggregatetimeoriginalestimate":null,"timeestimate":null,"customfield_12312330":null,"versions":[{"self":"https://issues.apache.org/jira/rest/api/2/version/12333529","id":"12333529","description":"Bug fix release for 4.3 branch","name":"4.3.2","archived":false,"released":true,"releaseDate":"2015-11-17"}],"customfield_12311120":null,"customfield_12313826":null,"issuelinks":[{"id":"12462817","self":"https://issues.apache.org/jira/rest/api/2/issueLink/12462817","type":{"id":"10030","name":"Reference","inward":"is related to","outward":"relates to","self":"https://issues.apache.org/jira/rest/api/2/issueLinkType/10030"},"outwardIssue":{"id":"12639153","key":"BOOKKEEPER-594","self":"https://issues.apache.org/jira/rest/api/2/issue/12639153","fields":{"summary":"AutoRecovery shutting down on SyncDisconnected","status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"priority":{"self":"https://issues.apache.org/jira/rest/api/2/priority/2","iconUrl":"https://issues.apache.org/jira/images/icons/priorities/critical.svg","name":"Critical","id":"2"},"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133}}}}],"customfield_12312339":null,"customfield_12313825":null,"assignee":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmerli","name":"mmerli","key":"mmerli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matteo Merli","active":true,"timeZone":"America/Los_Angeles"},"customfield_12312337":null,"customfield_12313823":null,"customfield_12312338":null,"customfield_12311920":null,"customfield_12313822":null,"customfield_12312335":null,"customfield_12313821":null,"customfield_12312336":null,"customfield_12313820":null,"status":{"self":"https://issues.apache.org/jira/rest/api/2/status/6","description":"The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.","iconUrl":"https://issues.apache.org/jira/images/icons/statuses/closed.png","name":"Closed","id":"6","statusCategory":{"self":"https://issues.apache.org/jira/rest/api/2/statuscategory/3","id":3,"key":"done","colorName":"green","name":"Done"}},"components":[{"self":"https://issues.apache.org/jira/rest/api/2/component/12319500","id":"12319500","name":"bookkeeper-auto-recovery","description":"Auditor and recovery worker component for bookkeeper"}],"customfield_12312026":null,"customfield_12312023":null,"customfield_12312024":null,"aggregatetimeestimate":null,"customfield_12312022":null,"customfield_12310921":null,"customfield_12310920":"9223372036854775807","customfield_12312823":null,"creator":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"subtasks":[],"reporter":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"aggregateprogress":{"progress":0,"total":0},"customfield_12313520":null,"customfield_12310250":null,"progress":{"progress":0,"total":0},"customfield_12313924":null,"votes":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-911/votes","votes":0,"hasVoted":false},"worklog":{"startAt":0,"maxResults":20,"total":0,"worklogs":[]},"customfield_12313920":null,"issuetype":{"self":"https://issues.apache.org/jira/rest/api/2/issuetype/1","id":"1","description":"A problem which impairs or prevents the functions of the product.","iconUrl":"https://issues.apache.org/jira/secure/viewavatar?size=xsmall&avatarId=21133&avatarType=issuetype","name":"Bug","subtask":false,"avatarId":21133},"timespent":null,"customfield_12314020":"{summaryBean=com.atlassian.jira.plugin.devstatus.rest.SummaryBean@6b8a7e4c[summary={pullrequest=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@107f5394[overall=PullRequestOverallBean{stateCount=0, state='OPEN', details=PullRequestOverallDetails{openCount=0, mergedCount=0, declinedCount=0}},byInstanceType={}], build=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7065644c[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BuildOverallBean@1aec6a27[failedBuildCount=0,successfulBuildCount=0,unknownBuildCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], review=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3298bf2d[overall=com.atlassian.jira.plugin.devstatus.summary.beans.ReviewsOverallBean@52050f2f[stateCount=0,state=<null>,dueDate=<null>,overDue=false,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], deployment-environment=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@9995627[overall=com.atlassian.jira.plugin.devstatus.summary.beans.DeploymentOverallBean@70ddb861[topEnvironments=[],showProjects=false,successfulCount=0,count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], repository=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@7cb1080[overall=com.atlassian.jira.plugin.devstatus.summary.beans.CommitOverallBean@7d4d0b21[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}], branch=com.atlassian.jira.plugin.devstatus.rest.SummaryItemBean@3ea642c1[overall=com.atlassian.jira.plugin.devstatus.summary.beans.BranchOverallBean@23a5fbc4[count=0,lastUpdated=<null>,lastUpdatedTimestamp=<null>],byInstanceType={}]},errors=[],configErrors=[]], devSummaryJson={\"cachedValue\":{\"errors\":[],\"configErrors\":[],\"summary\":{\"pullrequest\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":\"OPEN\",\"details\":{\"openCount\":0,\"mergedCount\":0,\"declinedCount\":0,\"total\":0},\"open\":true},\"byInstanceType\":{}},\"build\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"failedBuildCount\":0,\"successfulBuildCount\":0,\"unknownBuildCount\":0},\"byInstanceType\":{}},\"review\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"stateCount\":0,\"state\":null,\"dueDate\":null,\"overDue\":false,\"completed\":false},\"byInstanceType\":{}},\"deployment-environment\":{\"overall\":{\"count\":0,\"lastUpdated\":null,\"topEnvironments\":[],\"showProjects\":false,\"successfulCount\":0},\"byInstanceType\":{}},\"repository\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}},\"branch\":{\"overall\":{\"count\":0,\"lastUpdated\":null},\"byInstanceType\":{}}}},\"isStale\":false}}","customfield_12314141":null,"customfield_12314140":null,"project":{"self":"https://issues.apache.org/jira/rest/api/2/project/12311293","id":"12311293","key":"BOOKKEEPER","name":"Bookkeeper","projectTypeKey":"software","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/projectavatar?pid=12311293&avatarId=10011","24x24":"https://issues.apache.org/jira/secure/projectavatar?size=small&pid=12311293&avatarId=10011","16x16":"https://issues.apache.org/jira/secure/projectavatar?size=xsmall&pid=12311293&avatarId=10011","32x32":"https://issues.apache.org/jira/secure/projectavatar?size=medium&pid=12311293&avatarId=10011"},"projectCategory":{"self":"https://issues.apache.org/jira/rest/api/2/projectCategory/14780","id":"14780","description":"BookKeeper","name":"BookKeeper"}},"aggregatetimespent":null,"customfield_12312520":null,"customfield_12314422":null,"customfield_12314421":null,"customfield_12314146":null,"customfield_12314420":null,"customfield_12314145":null,"customfield_12314144":null,"customfield_12314143":null,"resolutiondate":"2016-04-27T07:01:22.614+0000","workratio":-1,"customfield_12312923":null,"customfield_12312920":null,"customfield_12312921":null,"watches":{"self":"https://issues.apache.org/jira/rest/api/2/issue/BOOKKEEPER-911/watchers","watchCount":7,"isWatching":false},"created":"2016-04-02T17:38:29.609+0000","updated":"2016-05-16T21:47:47.059+0000","timeoriginalestimate":null,"description":"Currently we have the following test failures in master branch:\nResults :\n\nFailed tests:   testRWZKSessionLost[0](org.apache.bookkeeper.replication.TestReplicationWorker): Replication worker should have shut down\n  testRWZKSessionLost[1](org.apache.bookkeeper.replication.TestReplicationWorker): Replication worker should have shut down\n  testRWZKSessionLost[2](org.apache.bookkeeper.replication.TestReplicationWorker): Replication worker should have shut down\n\nTests in error: \n  testRWShutdownOnLocalBookieReadonlyTransition[0](org.apache.bookkeeper.replication.TestReplicationWorker): test timed out after 20000 milliseconds\n  testRWShutdownOnLocalBookieReadonlyTransition[1](org.apache.bookkeeper.replication.TestReplicationWorker): test timed out after 20000 milliseconds\n  testRWShutdownOnLocalBookieReadonlyTransition[2](org.apache.bookkeeper.replication.TestReplicationWorker): test timed out after 20000 milliseconds\n\nTests run: 654, Failures: 3, Errors: 3, Skipped: 0\n","customfield_10010":null,"timetracking":{},"customfield_12314523":null,"customfield_12314127":null,"customfield_12314522":null,"customfield_12314126":null,"customfield_12314521":null,"customfield_12314125":null,"customfield_12314520":null,"customfield_12314124":null,"customfield_12312340":null,"attachment":[],"customfield_12314123":null,"customfield_12312341":null,"customfield_12312220":null,"customfield_12314122":null,"customfield_12314121":null,"customfield_12314120":null,"customfield_12314129":null,"customfield_12314524":null,"customfield_12314128":null,"summary":"Fix TestReplicationWorker test failures","customfield_12314130":null,"customfield_12310291":null,"customfield_12310290":null,"customfield_12311024":null,"customfield_12314138":null,"customfield_12314137":null,"environment":null,"customfield_12314136":null,"customfield_12314135":null,"customfield_12311020":null,"customfield_12314134":null,"duedate":null,"customfield_12314132":null,"customfield_12314131":null,"comment":{"comments":[{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15223116","id":"15223116","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh Radhakrishnan","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~arunmk] for working on this. I could see BOOKKEEPER-594 has changed the {{ReplicationWorker#run()}} exception handling behaviors. We could modify the tests by enabling {{BookKeeperClusterTestCase#setAutoRecoveryEnabled(true)}} and expire the zk session rather than simply stopping zk cluster. Probably you can refer [TestBookieWatcher.java#L96|https://github.com/apache/bookkeeper/blob/master/bookkeeper-server/src/test/java/org/apache/bookkeeper/client/TestBookieWatcher.java#L96] to signal zk session expired in BK tests.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh Radhakrishnan","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-04-03T04:05:02.612+0000","updated":"2016-04-03T04:05:02.612+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15223117","id":"15223117","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh Radhakrishnan","active":true,"timeZone":"Asia/Kolkata"},"body":"On a second thought - while correcting the test case, I think you can take a call to enable BookKeeperClusterTestCase#setAutoRecoveryEnabled(true) or not . It may not be required.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh Radhakrishnan","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-04-03T04:11:50.460+0000","updated":"2016-04-03T04:11:50.460+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15223454","id":"15223454","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"body":"Thanks [~rakeshr]. I'll take a look at the code and try out the fixes.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"created":"2016-04-03T18:45:19.385+0000","updated":"2016-04-03T18:45:19.385+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15223729","id":"15223729","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"body":"So the main difference now is that when we get the {{UnavailableException}} due to Zookeeper being absent, we {{waitBackOffTime()}} and continue. This is different from the previous code where the {{shutdown()}} would be called. ","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"created":"2016-04-04T06:38:27.630+0000","updated":"2016-04-04T06:38:27.630+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15224481","id":"15224481","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"body":"It looks like the functionality of {{ReplicationWorker}} after the fix for [BOOKKEEPER-594|https://issues.apache.org/jira/browse/BOOKKEEPER-594] is to not to shutdown but to let the {{AutoRecoveryMain}} daemon do the job. Since the current tests directly create the {{ReplicationWorker}} we run into these issues. Some options are:\n# Use the {{AutoRecoveryMain}} methods so that we can use the Zookeeper session-expiry watcher it creates, and also use its shutdown methods. Such cases are already covered in {{AutoRecoveryMainTest}}.\n# What is the intent behind the removal of the {{shutdown()}} from the {{UnavailableBookieHandling}} ? Is it the same as mentioned above ? Probably we could change the code flow there.\n\n[~rakeshr], [~merlimat] could you please advise ?","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"created":"2016-04-04T16:40:15.942+0000","updated":"2016-04-04T16:40:15.942+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15224568","id":"15224568","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"body":"[~merlimat], the reason I ask this is: as per the comments, the {{ReplicationWorker}} should shutdown in some cases but the code has a change from [https://issues.apache.org/jira/browse/BOOKKEEPER-594] to explicitly not do it. So it will be good to know if we should fix the tests or fix the code. For example, one of the failing tests says:\n{noformat}\n    /**\n     * Test that if the local bookie turns out to be readonly, then no point in running RW. So RW should shutdown.\n     */\n{noformat}\n\nAnd the code explicitly has a change to wait for the bookie to become writeable in case there is a {{BKWriteOnReadOnlyBookieException}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"created":"2016-04-04T17:29:16.207+0000","updated":"2016-04-04T17:29:16.207+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15225806","id":"15225806","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh Radhakrishnan","active":true,"timeZone":"Asia/Kolkata"},"body":"Thanks [~arunmk], good analysis.\n\nbq. the ReplicationWorker should shutdown in some cases but the code has a change from BOOKKEEPER-594 to explicitly not do it. So it will be good to know if we should fix the tests or fix the code\nLike described in BK-594, the idea is not to shutdown the ReplicationWorker due to an error contacting ZooKeeper, instead it should wait for some backoff time and continue running. With this change all the shutdown decisions are unified to one place - DeathWatcher daemon, which is responsible for taking any shutdown action. yes, we should fix the failing test cases.\n\nbq. Use the AutoRecoveryMain methods so that we can use the Zookeeper session-expiry watcher it creates, and also use its shutdown methods. Such cases are already covered in AutoRecoveryMainTest.\nHere we need ZK reference to simulate disconnection or expiry. You can use AutoRecoveryMain to get ZK handle or pass zookeeper object reference to RW and simulate session expiry.\n\n{code}\nnew ReplicationWorker(zk, baseConf, getBookie(0))\n{code}\n\n Test cases should verify that: case-1) ReplicationWorker is still running even after hitting ZK#Disconnected event. case-2) Should be able to perform the operation once ZK connection re-establishes after a disconnection. case-3) on zk session expiry watch notification, DeathWatcher will bring down RW.  I think we can remove the unit test which is already taken care through another well written test case. I meant, case-3 session expiry behavior is already covered through {{AutoRecoveryMainTest#testAutoRecoverySessionLoss}}.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=rakeshr","name":"rakeshr","key":"rakeshr","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=rakeshr&avatarId=29267","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=rakeshr&avatarId=29267","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=rakeshr&avatarId=29267","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=rakeshr&avatarId=29267"},"displayName":"Rakesh Radhakrishnan","active":true,"timeZone":"Asia/Kolkata"},"created":"2016-04-05T07:11:07.765+0000","updated":"2016-04-05T07:11:07.765+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15225842","id":"15225842","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmerli","name":"mmerli","key":"mmerli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matteo Merli","active":true,"timeZone":"America/Los_Angeles"},"body":"[~rakeshr] [~arunmk] Thanks for looking into it. I think that for {{testRWShutdownOnLocalBookieReadonlyTransition}} the fix should be to account for the new state of the replicator staying \"up\" while the bookie is in read-only and check that state. \n\nAnd of for the {{testRWZKSessionLost}}, I think we should rename it into {{testRWZKConnectionLost}} and just bounce quickly the ZK server to verify the disconnection/reconnection.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmerli","name":"mmerli","key":"mmerli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matteo Merli","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-05T07:50:25.953+0000","updated":"2016-04-05T07:50:25.953+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15225844","id":"15225844","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"GitHub user merlimat opened a pull request:\n\n    https://github.com/apache/bookkeeper/pull/29\n\n    BOOKKEEPER-911: Fix TestReplicationWorker tests in master\n\n    \n\nYou can merge this pull request into a Git repository by running:\n\n    $ git pull https://github.com/merlimat/bookkeeper bk-911\n\nAlternatively you can review and apply these changes as the patch at:\n\n    https://github.com/apache/bookkeeper/pull/29.patch\n\nTo close this pull request, make a commit to your master/trunk branch\nwith (at least) the following in the commit message:\n\n    This closes #29\n    \n----\ncommit 999ab9205e12456ea2cdc826d0962a3137e356ac\nAuthor: Matteo Merli <mmerli@apache.org>\nDate:   2016-04-05T07:50:16Z\n\n    BOOKKEEPER-911: Fix TestReplicationWorker tests in master\n\n----\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-05T07:51:39.806+0000","updated":"2016-04-05T07:51:39.806+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15226532","id":"15226532","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user merlimat commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-205871553\n  \n    Tests failures are unrelated with this fix. I created a separate Jira for them https://issues.apache.org/jira/browse/BOOKKEEPER-913\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-05T16:03:28.377+0000","updated":"2016-04-05T16:03:28.377+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15226653","id":"15226653","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"body":"Thanks [~mmerli], [~rakeshr]. I was going along the lines of doing something similar to {{AutoRecoveryMainTest}} and had initiated the {{ReplicationWorker}} using the {{startAutoRecovery}} of the daemon. That daemon shuts down the {{ReplicationWorker}} on Zookeeper session-expiry, but the second case of read-only-bookie transition will not be easy to accomplish. But it looks like the pull of [~mmerli] does what you mention above, so I'll stop working on the change.","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=arunmk","name":"arunmk","key":"arunmk","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Arun M. Krishnakumar","active":true,"timeZone":"America/Vancouver"},"created":"2016-04-05T16:56:02.774+0000","updated":"2016-04-05T16:56:02.774+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15226770","id":"15226770","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user rakeshadr commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-205918589\n  \n    Thanks for the patch. Apart from the above comments, overall changes looks good.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-05T17:53:23.017+0000","updated":"2016-04-05T17:53:23.017+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15226792","id":"15226792","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user merlimat commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-205923031\n  \n    @rakeshadr Updated\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-05T18:04:48.134+0000","updated":"2016-04-05T18:04:48.134+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15233862","id":"15233862","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user sijie commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-207913174\n  \n    the change looks good to me. +1. the jenkins seems to pass on tests, and it failures on pulling sunfire plugin. \n    \n    If I didn't hear any objections until Monday, I will merge this PR\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-10T03:55:06.662+0000","updated":"2016-04-10T03:55:06.662+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15235027","id":"15235027","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user fpj commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-208321074\n  \n    According to the latest build, this is still failing:\n    ```\n        org.apache.bookkeeper.replication.AuditorLedgerCheckerTest.testReadOnlyBookieExclusionFromURLedgersCheck[0]\n        org.apache.bookkeeper.replication.TestReplicationWorker.testRWZKSessionLost[0]\n        org.apache.bookkeeper.replication.TestReplicationWorker.testRWShutdownOnLocalBookieReadonlyTransition[0]\n        org.apache.bookkeeper.replication.TestReplicationWorker.testRWZKSessionLost[1]\n        org.apache.bookkeeper.replication.TestReplicationWorker.testRWShutdownOnLocalBookieReadonlyTransition[1]\n        org.apache.bookkeeper.replication.TestReplicationWorker.testRWZKSessionLost[2]\n        org.apache.bookkeeper.replication.TestReplicationWorker.testRWShutdownOnLocalBookieReadonlyTransition[2]\n    ```\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T12:42:22.330+0000","updated":"2016-04-11T12:42:22.330+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15235585","id":"15235585","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user merlimat commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-208470391\n  \n    There is something wrong with the build. The PR hash ref is 38ca7258bd1f011282b7521f8bd9128b0f1ffa8b, but the jenkins build https://builds.apache.org/job/bookkeeper-master-git-pullrequest/68/ did check-out a different revision: b42d8db2b03079ce65d603d808442297ad759433\n    \n    @fpj Did you manually triggered the \"rebuild\" on Jenkins? It looks like it's building either master or some other revision, but not the one from the PR again.\n    \n    If you look at the job triggered by my commit:\n    https://builds.apache.org/job/bookkeeper-master-git-pullrequest/60/\n    \n    The only failure there is the LocalBookieTest that's silently failing and fixed in master already.\n    \n    I'll rebase on last master version to get a clean run.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T17:48:32.466+0000","updated":"2016-04-11T17:48:32.466+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15235860","id":"15235860","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user fpj commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-208530803\n  \n    @merlimat I did retrigger it\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T19:59:21.730+0000","updated":"2016-04-11T19:59:21.730+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15235920","id":"15235920","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user sijie commented on the pull request:\n\n    https://github.com/apache/bookkeeper/pull/29#issuecomment-208544151\n  \n    @fpj @merlimat checking the original build : https://builds.apache.org/job/bookkeeper-master-git-pullrequest/60/ it passed.\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-11T20:26:45.944+0000","updated":"2016-04-11T20:26:45.944+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15244095","id":"15244095","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaijia","name":"zhaijia","key":"zhaijia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhaijia&avatarId=21925","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhaijia&avatarId=21925","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhaijia&avatarId=21925","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhaijia&avatarId=21925"},"displayName":"Jia Zhai","active":true,"timeZone":"Asia/Shanghai"},"body":"Manually test this patch on my machine, and it works, here is the result:\nwithout patch:\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning org.apache.bookkeeper.replication.TestReplicationWorker\nTests run: 27, Failures: 3, Errors: 3, Skipped: 0, Time elapsed: 128.776 sec <<< FAILURE!\nResults :\nFailed tests:   testRWZKSessionLost[0](org.apache.bookkeeper.replication.TestReplicationWorker): Replication worker should have shut down\n  testRWZKSessionLost[1](org.apache.bookkeeper.replication.TestReplicationWorker): Replication worker should have shut down\n  testRWZKSessionLost[2](org.apache.bookkeeper.replication.TestReplicationWorker): Replication worker should have shut down\n\nTests in error:\n  testRWShutdownOnLocalBookieReadonlyTransition[0](org.apache.bookkeeper.replication.TestReplicationWorker): test timed out after 20000 milliseconds\n  testRWShutdownOnLocalBookieReadonlyTransition[1](org.apache.bookkeeper.replication.TestReplicationWorker): test timed out after 20000 milliseconds\n  testRWShutdownOnLocalBookieReadonlyTransition[2](org.apache.bookkeeper.replication.TestReplicationWorker): test timed out after 20000 milliseconds\n\nTests run: 27, Failures: 3, Errors: 3, Skipped: 0\n\nwith patch:\n-------------------------------------------------------\n-------------------------------------------------------\n T E S T S\n-------------------------------------------------------\nRunning org.apache.bookkeeper.replication.TestReplicationWorker\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 43.998 sec\n\nResults :\nTests run: 27, Failures: 0, Errors: 0, Skipped: 0","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=zhaijia","name":"zhaijia","key":"zhaijia","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?ownerId=zhaijia&avatarId=21925","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&ownerId=zhaijia&avatarId=21925","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&ownerId=zhaijia&avatarId=21925","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&ownerId=zhaijia&avatarId=21925"},"displayName":"Jia Zhai","active":true,"timeZone":"Asia/Shanghai"},"created":"2016-04-16T08:42:13.408+0000","updated":"2016-04-16T08:42:13.408+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15259665","id":"15259665","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"body":"Issue resolved by pull request 29\n[https://github.com/apache/bookkeeper/pull/29]","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hustlmsp","name":"hustlmsp","key":"hustlmsp","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Sijie Guo","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-04-27T07:01:22.644+0000","updated":"2016-04-27T07:01:22.644+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15259666","id":"15259666","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"body":"Github user asfgit closed the pull request at:\n\n    https://github.com/apache/bookkeeper/pull/29\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=githubbot","name":"githubbot","key":"githubbot","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"ASF GitHub Bot","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-27T07:01:31.575+0000","updated":"2016-04-27T07:01:31.575+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15260140","id":"15260140","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"body":"FAILURE: Integrated in bookkeeper-master #1358 (See [https://builds.apache.org/job/bookkeeper-master/1358/])\nBOOKKEEPER-911: Fix TestReplicationWorker tests in master (sijie: rev 91595fc04ac6168b5a652e803e55caadae757f74)\n* bookkeeper-server/src/test/java/org/apache/bookkeeper/replication/TestReplicationWorker.java\n* bookkeeper-server/src/main/java/org/apache/bookkeeper/replication/ReplicationWorker.java\n","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=hudson","name":"hudson","key":"hudson","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Hudson","active":true,"timeZone":"Etc/UTC"},"created":"2016-04-27T13:29:05.436+0000","updated":"2016-04-27T13:29:05.436+0000"},{"self":"https://issues.apache.org/jira/rest/api/2/issue/12955528/comment/15285456","id":"15285456","author":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmerli","name":"mmerli","key":"mmerli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matteo Merli","active":true,"timeZone":"America/Los_Angeles"},"body":"Closed as part of BookKeeper-4.4.0 release","updateAuthor":{"self":"https://issues.apache.org/jira/rest/api/2/user?username=mmerli","name":"mmerli","key":"mmerli","avatarUrls":{"48x48":"https://issues.apache.org/jira/secure/useravatar?avatarId=10452","24x24":"https://issues.apache.org/jira/secure/useravatar?size=small&avatarId=10452","16x16":"https://issues.apache.org/jira/secure/useravatar?size=xsmall&avatarId=10452","32x32":"https://issues.apache.org/jira/secure/useravatar?size=medium&avatarId=10452"},"displayName":"Matteo Merli","active":true,"timeZone":"America/Los_Angeles"},"created":"2016-05-16T21:47:47.050+0000","updated":"2016-05-16T21:47:47.050+0000"}],"maxResults":23,"total":23,"startAt":0},"customfield_12311820":"0|i2vk0f:","customfield_12314139":null}}

