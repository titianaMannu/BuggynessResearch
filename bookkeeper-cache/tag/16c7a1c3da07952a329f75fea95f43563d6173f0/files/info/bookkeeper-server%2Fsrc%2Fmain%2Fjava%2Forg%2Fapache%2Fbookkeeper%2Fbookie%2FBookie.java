{"sha":"53c2db03466c7cb61fb34fb220b2a3cd5f64a72b","node_id":"MDQ6QmxvYjE1NzU5NTY6NTNjMmRiMDM0NjZjN2NiNjFmYjM0ZmIyMjBiMmEzY2Q1ZjY0YTcyYg==","size":47412,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/53c2db03466c7cb61fb34fb220b2a3cd5f64a72b","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZv\ndW5kRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuaW8uRmlsZW5hbWVGaWx0ZXI7CmltcG9ydCBqYXZhLm5ldC5J\nbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0LlVua25vd25Ib3N0\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGls\nLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuRnV0dXJlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5h\ndG9taWMuQXRvbWljQm9vbGVhbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuSm91cm5hbC5K\nb3VybmFsU2Nhbm5lcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5i\nb29raWUuTGVkZ2VyRGlyc01hbmFnZXIuTGVkZ2VyRGlyc0xpc3RlbmVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5MZWRnZXJEaXJz\nTWFuYWdlci5Ob1dyaXRhYmxlTGVkZ2VyRGlyRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5qbXguQktNQmVhbklu\nZm87CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuam14LkJLTUJlYW5S\nZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5C\nb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLkJvb2tLZWVwZXJDb25z\ndGFudHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5JT1V0\naWxzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuTWF0aFV0\naWxzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuWmtVdGls\nczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlN0cmluZ1V0\naWxzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm5ldC5ETlM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuem9va2VlcGVyLlpvb0tlZXBl\ncldhdGNoZXJCYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmlvLkZp\nbGVVdGlsczsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5L\nZWVwZXJFeGNlcHRpb24uTm9kZUV4aXN0c0V4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpv\nb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5ab29EZWZzLklkczsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldh\ndGNoZXIuRXZlbnQuRXZlbnRUeXBlOwoKaW1wb3J0IGNvbS5nb29nbGUuY29t\nbW9uLmFubm90YXRpb25zLlZpc2libGVGb3JUZXN0aW5nOwoKLyoqCiAqIElt\ncGxlbWVudHMgYSBib29raWUuCiAqCiAqLwoKcHVibGljIGNsYXNzIEJvb2tp\nZSBleHRlbmRzIFRocmVhZCB7CgogICAgc3RhdGljIExvZ2dlciBMT0cgPSBM\nb2dnZXJGYWN0b3J5LmdldExvZ2dlcihCb29raWUuY2xhc3MpOwoKICAgIGZp\nbmFsIEZpbGUgam91cm5hbERpcmVjdG9yeTsKICAgIGZpbmFsIFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZjsKCiAgICBmaW5hbCBTeW5jVGhyZWFkIHN5bmNU\naHJlYWQ7CiAgICBmaW5hbCBMZWRnZXJNYW5hZ2VyRmFjdG9yeSBsZWRnZXJN\nYW5hZ2VyRmFjdG9yeTsKICAgIGZpbmFsIExlZGdlck1hbmFnZXIgbGVkZ2Vy\nTWFuYWdlcjsKICAgIGZpbmFsIExlZGdlclN0b3JhZ2UgbGVkZ2VyU3RvcmFn\nZTsKICAgIGZpbmFsIEpvdXJuYWwgam91cm5hbDsKCiAgICBmaW5hbCBIYW5k\nbGVGYWN0b3J5IGhhbmRsZXM7CgogICAgc3RhdGljIGZpbmFsIGxvbmcgTUVU\nQUVOVFJZX0lEX0xFREdFUl9LRVkgPSAtMHgxMDAwOwogICAgc3RhdGljIGZp\nbmFsIGxvbmcgTUVUQUVOVFJZX0lEX0ZFTkNFX0tFWSAgPSAtMHgyMDAwOwoK\nICAgIC8vIFpLIHJlZ2lzdHJhdGlvbiBwYXRoIGZvciB0aGlzIGJvb2tpZQog\nICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgYm9va2llUmVnaXN0cmF0aW9uUGF0\naDsKCiAgICBwcml2YXRlIExlZGdlckRpcnNNYW5hZ2VyIGxlZGdlckRpcnNN\nYW5hZ2VyOwoKICAgIC8vIFpvb0tlZXBlciBjbGllbnQgaW5zdGFuY2UgZm9y\nIHRoZSBCb29raWUKICAgIFpvb0tlZXBlciB6azsKCiAgICAvLyBSdW5uaW5n\nIGZsYWcKICAgIHByaXZhdGUgdm9sYXRpbGUgYm9vbGVhbiBydW5uaW5nID0g\nZmFsc2U7CiAgICAvLyBGbGFnIGlkZW50aWZ5IHdoZXRoZXIgaXQgaXMgaW4g\nc2h1dHRpbmcgZG93biBwcm9ncmVzcwogICAgcHJpdmF0ZSB2b2xhdGlsZSBi\nb29sZWFuIHNodXR0aW5nZG93biA9IGZhbHNlOwoKICAgIHByaXZhdGUgaW50\nIGV4aXRDb2RlID0gRXhpdENvZGUuT0s7CgogICAgLy8gam14IHJlbGF0ZWQg\nYmVhbnMKICAgIEJvb2tpZUJlYW4gam14Qm9va2llQmVhbjsKICAgIEJLTUJl\nYW5JbmZvIGpteExlZGdlclN0b3JhZ2VCZWFuOwoKICAgIE1hcDxMb25nLCBi\neXRlW10+IG1hc3RlcktleUNhY2hlID0gQ29sbGVjdGlvbnMuc3luY2hyb25p\nemVkTWFwKG5ldyBIYXNoTWFwPExvbmcsIGJ5dGVbXT4oKSk7CgogICAgZmlu\nYWwgcHJpdmF0ZSBTdHJpbmcgemtCb29raWVSZWdQYXRoOwoKICAgIGZpbmFs\nIHByaXZhdGUgQXRvbWljQm9vbGVhbiByZWFkT25seSA9IG5ldyBBdG9taWNC\nb29sZWFuKGZhbHNlKTsKCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIE5vTGVk\nZ2VyRXhjZXB0aW9uIGV4dGVuZHMgSU9FeGNlcHRpb24gewogICAgICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDFM\nOwogICAgICAgIHByaXZhdGUgbG9uZyBsZWRnZXJJZDsKICAgICAgICBwdWJs\naWMgTm9MZWRnZXJFeGNlcHRpb24obG9uZyBsZWRnZXJJZCkgewogICAgICAg\nICAgICBzdXBlcigiTGVkZ2VyICIgKyBsZWRnZXJJZCArICIgbm90IGZvdW5k\nIik7CiAgICAgICAgICAgIHRoaXMubGVkZ2VySWQgPSBsZWRnZXJJZDsKICAg\nICAgICB9CiAgICAgICAgcHVibGljIGxvbmcgZ2V0TGVkZ2VySWQoKSB7CiAg\nICAgICAgICAgIHJldHVybiBsZWRnZXJJZDsKICAgICAgICB9CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIGNsYXNzIE5vRW50cnlFeGNlcHRpb24gZXh0ZW5k\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMUw7CiAgICAgICAgcHJpdmF0ZSBs\nb25nIGxlZGdlcklkOwogICAgICAgIHByaXZhdGUgbG9uZyBlbnRyeUlkOwog\nICAgICAgIHB1YmxpYyBOb0VudHJ5RXhjZXB0aW9uKGxvbmcgbGVkZ2VySWQs\nIGxvbmcgZW50cnlJZCkgewogICAgICAgICAgICB0aGlzKCJFbnRyeSAiICsg\nZW50cnlJZCArICIgbm90IGZvdW5kIGluICIgKyBsZWRnZXJJZCwgbGVkZ2Vy\nSWQsIGVudHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE5vRW50\ncnlFeGNlcHRpb24oU3RyaW5nIG1zZywgbG9uZyBsZWRnZXJJZCwgbG9uZyBl\nbnRyeUlkKSB7CiAgICAgICAgICAgIHN1cGVyKG1zZyk7CiAgICAgICAgICAg\nIHRoaXMubGVkZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5l\nbnRyeUlkID0gZW50cnlJZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBs\nb25nIGdldExlZGdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIGxlZGdlcklk\nOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgbG9uZyBnZXRFbnRyeSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIGVudHJ5SWQ7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vIFdyaXRlIENhbGxiYWNrIGRvIG5vdGhpbmcKICAgIHN0YXRpYyBj\nbGFzcyBOb3BXcml0ZUNhbGxiYWNrIGltcGxlbWVudHMgV3JpdGVDYWxsYmFj\nayB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgd3Jp\ndGVDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJ\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZXRTb2Nr\nZXRBZGRyZXNzIGFkZHIsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgaWYg\nKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cu\nZGVidWcoIkZpbmlzaGVkIHdyaXRpbmcgZW50cnkge30gQCBsZWRnZXIge30g\nZm9yIHt9IDoge30iLAogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXSB7IGVudHJ5SWQsIGxlZGdlcklkLCBhZGRyLCByYyB9KTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBmaW5hbCBzdGF0aWMg\nRnV0dXJlPEJvb2xlYW4+IFNVQ0NFU1NfRlVUVVJFID0gbmV3IEZ1dHVyZTxC\nb29sZWFuPigpIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBjYW5jZWwoYm9vbGVhbiBtYXlJbnRlcnJ1cHRJZlJ1bm5pbmcp\nIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIEJvb2xlYW4gZ2V0KCkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICAg\nIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBCb29sZWFuIGdldChsb25nIHRp\nbWVvdXQsIFRpbWVVbml0IHVuaXQpIHsgcmV0dXJuIHRydWU7IH0KICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0NhbmNlbGxl\nZCgpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIGJvb2xlYW4gaXNEb25lKCkgewogICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICB9CiAgICB9OwoKICAgIHN0YXRpYyBjbGFzcyBD\nb3VudERvd25MYXRjaEZ1dHVyZTxUPiBpbXBsZW1lbnRzIEZ1dHVyZTxUPiB7\nCgogICAgICAgIFQgdmFsdWUgPSBudWxsOwogICAgICAgIHZvbGF0aWxlIGJv\nb2xlYW4gZG9uZSA9IGZhbHNlOwogICAgICAgIENvdW50RG93bkxhdGNoIGxh\ndGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBjYW5jZWwoYm9vbGVhbiBtYXlJ\nbnRlcnJ1cHRJZlJ1bm5pbmcpIHsgcmV0dXJuIGZhbHNlOyB9CiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFQgZ2V0KCkgdGhyb3dzIEludGVy\ncnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgbGF0Y2guYXdhaXQoKTsK\nICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgVCBnZXQobG9uZyB0aW1lb3V0LCBU\naW1lVW5pdCB1bml0KSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewog\nICAgICAgICAgICBsYXRjaC5hd2FpdCh0aW1lb3V0LCB1bml0KTsKICAgICAg\nICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNDYW5jZWxsZWQoKSB7IHJl\ndHVybiBmYWxzZTsgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBpc0RvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiBkb25l\nOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXREb25lKFQgdmFsdWUpIHsK\nICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICBk\nb25lID0gdHJ1ZTsKICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBjbGFzcyBGdXR1cmVXcml0ZUNh\nbGxiYWNrIGltcGxlbWVudHMgV3JpdGVDYWxsYmFjayB7CgogICAgICAgIENv\ndW50RG93bkxhdGNoRnV0dXJlPEJvb2xlYW4+IHJlc3VsdCA9CiAgICAgICAg\nICAgIG5ldyBDb3VudERvd25MYXRjaEZ1dHVyZTxCb29sZWFuPigpOwoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCB3cml0ZUNvbXBs\nZXRlKGludCByYywgbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJl\nc3MgYWRkciwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBpZiAoTE9HLmlz\nRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIExPRy5kZWJ1Zygi\nRmluaXNoZWQgd3JpdGluZyBlbnRyeSB7fSBAIGxlZGdlciB7fSBmb3Ige30g\nOiB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtd\nIHsgZW50cnlJZCwgbGVkZ2VySWQsIGFkZHIsIHJjIH0pOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJlc3VsdC5zZXREb25lKDAgPT0gcmMpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIEZ1dHVyZTxCb29sZWFuPiBnZXRSZXN1\nbHQoKSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogU3luY1RocmVhZCBpcyBhIGJhY2tncm91\nbmQgdGhyZWFkIHdoaWNoIGZsdXNoZXMgbGVkZ2VyIGluZGV4IHBhZ2VzIHBl\ncmlvZGljYWxseS4KICAgICAqIEFsc28gaXQgdGFrZXMgcmVzcG9uc2liaWxp\ndHkgb2YgZ2FyYmFnZSBjb2xsZWN0aW5nIGpvdXJuYWwgZmlsZXMuCiAgICAg\nKgogICAgICogPHA+CiAgICAgKiBCZWZvcmUgZmx1c2hpbmcsIFN5bmNUaHJl\nYWQgZmlyc3QgcmVjb3JkcyBhIGxvZyBtYXJrZXIge2pvdXJuYWxJZCwgam91\ncm5hbFBvc30gaW4gbWVtb3J5LAogICAgICogd2hpY2ggaW5kaWNhdGVzIGVu\ndHJpZXMgYmVmb3JlIHRoaXMgbG9nIG1hcmtlciB3b3VsZCBiZSBwZXJzaXN0\nZWQgdG8gbGVkZ2VyIGZpbGVzLgogICAgICogVGhlbiBzeW5jIHRocmVhZCBi\nZWdpbnMgZmx1c2hpbmcgbGVkZ2VyIGluZGV4IHBhZ2VzIHRvIGxlZGdlciBp\nbmRleCBmaWxlcywgZmx1c2ggZW50cnkKICAgICAqIGxvZ2dlciB0byBlbnN1\ncmUgYWxsIGVudHJpZXMgcGVyc2lzdGVkIHRvIGVudHJ5IGxvZ2dlcnMgZm9y\nIGZ1dHVyZSByZWFkcy4KICAgICAqIDwvcD4KICAgICAqIDxwPgogICAgICog\nQWZ0ZXIgYWxsIGRhdGEgaGFzIGJlZW4gcGVyc2lzdGVkIHRvIGxlZGdlciBp\nbmRleCBmaWxlcyBhbmQgZW50cnkgbG9nZ2VycywgaXQgaXMgc2FmZQogICAg\nICogdG8gcGVyc2lzdCB0aGUgbG9nIG1hcmtlciB0byBkaXNrLiBJZiBib29r\naWUgZmFpbGVkIGFmdGVyIHBlcnNpc3QgbG9nIG1hcmssCiAgICAgKiBib29r\naWUgaXMgYWJsZSB0byByZWxheSBqb3VybmFsIGVudHJpZXMgc3RhcnRlZCBm\ncm9tIGxhc3QgbG9nIG1hcmsgd2l0aG91dCBsb3NpbmcKICAgICAqIGFueSBl\nbnRyaWVzLgogICAgICogPC9wPgogICAgICogPHA+CiAgICAgKiBUaG9zZSBq\nb3VybmFsIGZpbGVzIHdob3NlIGlkIGFyZSBsZXNzIHRoYW4gdGhlIGxvZyBp\nZCBpbiBsYXN0IGxvZyBtYXJrLCBjb3VsZCBiZQogICAgICogcmVtb3ZlZCBz\nYWZlbHkgYWZ0ZXIgcGVyc2lzdGluZyBsYXN0IGxvZyBtYXJrLiBXZSBwcm92\naWRlIGEgc2V0dGluZyB0byBsZXQgdXNlciBrZWVwaW5nCiAgICAgKiBudW1i\nZXIgb2Ygb2xkIGpvdXJuYWwgZmlsZXMgd2hpY2ggbWF5IGJlIHVzZWQgZm9y\nIG1hbnVhbCByZWNvdmVyeSBpbiBjcml0aWNhbCBkaXNhc3Rlci4KICAgICAq\nIDwvcD4KICAgICAqLwogICAgY2xhc3MgU3luY1RocmVhZCBleHRlbmRzIFRo\ncmVhZCB7CiAgICAgICAgdm9sYXRpbGUgYm9vbGVhbiBydW5uaW5nID0gdHJ1\nZTsKICAgICAgICAvLyBmbGFnIHRvIGVuc3VyZSBzeW5jIHRocmVhZCB3aWxs\nIG5vdCBiZSBpbnRlcnJ1cHRlZCBkdXJpbmcgZmx1c2gKICAgICAgICBmaW5h\nbCBBdG9taWNCb29sZWFuIGZsdXNoaW5nID0gbmV3IEF0b21pY0Jvb2xlYW4o\nZmFsc2UpOwogICAgICAgIC8vIG1ha2UgZmx1c2ggaW50ZXJ2YWwgYXMgYSBw\nYXJhbWV0ZXIKICAgICAgICBmaW5hbCBpbnQgZmx1c2hJbnRlcnZhbDsKICAg\nICAgICBwdWJsaWMgU3luY1RocmVhZChTZXJ2ZXJDb25maWd1cmF0aW9uIGNv\nbmYpIHsKICAgICAgICAgICAgc3VwZXIoIlN5bmNUaHJlYWQiKTsKICAgICAg\nICAgICAgZmx1c2hJbnRlcnZhbCA9IGNvbmYuZ2V0Rmx1c2hJbnRlcnZhbCgp\nOwogICAgICAgICAgICBMT0cuZGVidWcoIkZsdXNoIEludGVydmFsIDoge30i\nLCBmbHVzaEludGVydmFsKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\nT2JqZWN0IHN1c3BlbnNpb25Mb2NrID0gbmV3IE9iamVjdCgpOwogICAgICAg\nIHByaXZhdGUgYm9vbGVhbiBzdXNwZW5kZWQgPSBmYWxzZTsKCiAgICAgICAg\nLyoqCiAgICAgICAgICogU3VzcGVuZCBzeW5jIHRocmVhZC4gKGZvciB0ZXN0\naW5nKQogICAgICAgICAqLwogICAgICAgIEBWaXNpYmxlRm9yVGVzdGluZwog\nICAgICAgIHB1YmxpYyB2b2lkIHN1c3BlbmRTeW5jKCkgewogICAgICAgICAg\nICBzeW5jaHJvbml6ZWQoc3VzcGVuc2lvbkxvY2spIHsKICAgICAgICAgICAg\nICAgIHN1c3BlbmRlZCA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8qKgogICAgICAgICAqIFJlc3VtZSBzeW5jIHRocmVhZC4g\nKGZvciB0ZXN0aW5nKQogICAgICAgICAqLwogICAgICAgIEBWaXNpYmxlRm9y\nVGVzdGluZwogICAgICAgIHB1YmxpYyB2b2lkIHJlc3VtZVN5bmMoKSB7CiAg\nICAgICAgICAgIHN5bmNocm9uaXplZChzdXNwZW5zaW9uTG9jaykgewogICAg\nICAgICAgICAgICAgc3VzcGVuZGVkID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICBzdXNwZW5zaW9uTG9jay5ub3RpZnkoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgd2hp\nbGUgKHJ1bm5pbmcpIHsKICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoZmx1c2hJbnRlcnZhbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWxlZGdlclN0b3Jh\nZ2UuaXNGbHVzaFJlcXVpcmVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIHN5bmNocm9uaXplZCAoc3VzcGVuc2lvbkxvY2spIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHN1c3BlbmRlZCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgc3VzcGVuc2lvbkxvY2sud2FpdCgp\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIC8vIHRyeSB0byBtYXJrIGZsdXNo\naW5nIGZsYWcgdG8gbWFrZSBzdXJlIGl0IHdvdWxkIG5vdCBiZSBpbnRlcnJ1\ncHRlZAogICAgICAgICAgICAgICAgICAgIC8vIGJ5IHNodXRkb3duIGR1cmlu\nZyBmbHVzaGluZy4gb3RoZXJ3aXNlIGl0IHdpbGwgcmVjZWl2ZQogICAgICAg\nICAgICAgICAgICAgIC8vIENsb3NlZEJ5SW50ZXJydXB0RXhjZXB0aW9uIHdo\naWNoIG1heSBjYXVzZSBpbmRleCBmaWxlICYgZW50cnkgbG9nZ2VyCiAgICAg\nICAgICAgICAgICAgICAgLy8gY2xvc2VkIGFuZCBjb3JydXB0ZWQuCiAgICAg\nICAgICAgICAgICAgICAgaWYgKCFmbHVzaGluZy5jb21wYXJlQW5kU2V0KGZh\nbHNlLCB0cnVlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQg\nZmx1c2hpbmcgZmxhZyBmYWlsZWQsIG1lYW5zIGZsdXNoaW5nIGlzIHRydWUg\nbm93CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluZGljYXRlcyBhbm90\naGVyIHRocmVhZCB3YW50cyB0byBpbnRlcnJ1cHQgc3luYyB0aHJlYWQgdG8g\nZXhpdAogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGpvdXJuYWwg\nbWFyayBsb2cKICAgICAgICAgICAgICAgICAgICBqb3VybmFsLm1hcmtMb2co\nKTsKCiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBmbHVzaEZhaWxlZCA9\nIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGxlZGdlclN0b3JhZ2UuZmx1c2goKTsKICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChOb1dyaXRhYmxlTGVkZ2VyRGlyRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hGYWlsZWQg\nPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICBmbHVzaGluZy5zZXQo\nZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uVG9S\nZWFkT25seU1vZGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiRXhjZXB0aW9uIGZsdXNoaW5nIExlZGdlciIsIGUpOwogICAgICAg\nICAgICAgICAgICAgICAgICBmbHVzaEZhaWxlZCA9IHRydWU7CiAgICAgICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyBpZiBmbHVz\naCBmYWlsZWQsIHdlIHNob3VsZCBub3Qgcm9sbCBsYXN0IG1hcmssIG90aGVy\nd2lzZSB3ZSB3b3VsZAogICAgICAgICAgICAgICAgICAgIC8vIGhhdmUgc29t\nZSBsZWRnZXJzIGFyZSBub3QgZmx1c2hlZCBhbmQgdGhlaXIgam91cm5hbCBl\nbnRyaWVzIHdlcmUgbG9zdAogICAgICAgICAgICAgICAgICAgIGlmICghZmx1\nc2hGYWlsZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWwucm9sbExvZygpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbC5nY0pvdXJuYWxz\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vV3JpdGFi\nbGVMZWRnZXJEaXJFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZmx1c2hpbmcuc2V0KGZhbHNlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHRyYW5zaXRpb25Ub1JlYWRPbmx5TW9kZSgpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgICAgICAvLyBjbGVhciBmbHVzaGluZyBmbGFnCiAg\nICAgICAgICAgICAgICAgICAgZmx1c2hpbmcuc2V0KGZhbHNlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQp\nIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIFN5\nbmNUaHJlYWQiLCB0KTsKICAgICAgICAgICAgICAgIGZsdXNoaW5nLnNldChm\nYWxzZSk7CiAgICAgICAgICAgICAgICB0cmlnZ2VyQm9va2llU2h1dGRvd24o\nRXhpdENvZGUuQk9PS0lFX0VYQ0VQVElPTik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIHNodXRkb3duIHN5bmMgdGhyZWFkCiAgICAg\nICAgdm9pZCBzaHV0ZG93bigpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTsKICAgICAgICAgICAg\naWYgKGZsdXNoaW5nLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7CiAg\nICAgICAgICAgICAgICAvLyBpZiBzZXR0aW5nIGZsdXNoaW5nIGZsYWcgc3Vj\nY2VlZCwgbWVhbnMgc3luY1RocmVhZCBpcyBub3QgZmx1c2hpbmcgbm93CiAg\nICAgICAgICAgICAgICAvLyBpdCBpcyBzYWZlIHRvIGludGVycnVwdCBpdHNl\nbGYgbm93IAogICAgICAgICAgICAgICAgdGhpcy5pbnRlcnJ1cHQoKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmpvaW4oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHN0YXRpYyB2b2lkIGNoZWNrRGlyZWN0b3J5\nU3RydWN0dXJlKEZpbGUgZGlyKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIGlmICghZGlyLmV4aXN0cygpKSB7CiAgICAgICAgICAgIEZpbGUgcGFy\nZW50ID0gZGlyLmdldFBhcmVudEZpbGUoKTsKICAgICAgICAgICAgRmlsZSBw\ncmVWM3ZlcnNpb25GaWxlID0gbmV3IEZpbGUoZGlyLmdldFBhcmVudCgpLAog\nICAgICAgICAgICAgICAgICAgIEJvb2tLZWVwZXJDb25zdGFudHMuVkVSU0lP\nTl9GSUxFTkFNRSk7CgogICAgICAgICAgICBmaW5hbCBBdG9taWNCb29sZWFu\nIG9sZERhdGFFeGlzdHMgPSBuZXcgQXRvbWljQm9vbGVhbihmYWxzZSk7CiAg\nICAgICAgICAgIHBhcmVudC5saXN0KG5ldyBGaWxlbmFtZUZpbHRlcigpIHsK\nICAgICAgICAgICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBhY2NlcHQoRmls\nZSBkaXIsIFN0cmluZyBuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChuYW1lLmVuZHNXaXRoKCIudHhuIikgfHwgbmFtZS5lbmRzV2l0aCgi\nLmlkeCIpIHx8IG5hbWUuZW5kc1dpdGgoIi5sb2ciKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgb2xkRGF0YUV4aXN0cy5zZXQodHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfSk7CiAgICAgICAgICAgIGlmIChwcmVWM3ZlcnNpb25GaWxl\nLmV4aXN0cygpIHx8IG9sZERhdGFFeGlzdHMuZ2V0KCkpIHsKICAgICAgICAg\nICAgICAgIFN0cmluZyBlcnIgPSAiRGlyZWN0b3J5IGxheW91dCB2ZXJzaW9u\nIGlzIGxlc3MgdGhhbiAzLCB1cGdyYWRlIG5lZWRlZCI7CiAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbihlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmICghZGlyLm1rZGlycygpKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcg\nZXJyID0gIlVuYWJsZSB0byBjcmVhdGUgZGlyZWN0b3J5ICIgKyBkaXI7CiAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoZXJyKTsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJT0V4Y2VwdGlvbihlcnIpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgdGhhdCB0aGUg\nZW52aXJvbm1lbnQgZm9yIHRoZSBib29raWUgaXMgY29ycmVjdC4KICAgICAq\nIFRoaXMgbWVhbnMgdGhhdCB0aGUgY29uZmlndXJhdGlvbiBoYXMgc3RheWVk\nIHRoZSBzYW1lIGFzIHRoZQogICAgICogZmlyc3QgcnVuIGFuZCB0aGUgZmls\nZXN5c3RlbSBzdHJ1Y3R1cmUgaXMgdXAgdG8gZGF0ZS4KICAgICAqLwogICAg\ncHJpdmF0ZSB2b2lkIGNoZWNrRW52aXJvbm1lbnQoWm9vS2VlcGVyIHprKSB0\naHJvd3MgQm9va2llRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKHprID09IG51bGwpIHsgLy8gZXhpc3RzIG9ubHkgZm9yIHRlc3Rpbmcs\nIGp1c3QgbWFrZSBzdXJlIGRpcmVjdG9yaWVzIGFyZSBjb3JyZWN0CiAgICAg\nICAgICAgIGNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKGpvdXJuYWxEaXJlY3Rv\ncnkpOwogICAgICAgICAgICBmb3IgKEZpbGUgZGlyIDogbGVkZ2VyRGlyc01h\nbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAgICAgICAgICAgICAg\nICAgY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoZGlyKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIFN0cmluZyBpbnN0YW5jZUlkID0gZ2V0SW5zdGFuY2VJ\nZCh6ayk7CiAgICAgICAgICAgIGJvb2xlYW4gbmV3RW52ID0gZmFsc2U7CiAg\nICAgICAgICAgIENvb2tpZSBtYXN0ZXJDb29raWUgPSBDb29raWUuZ2VuZXJh\ndGVDb29raWUoY29uZik7CiAgICAgICAgICAgIGlmIChudWxsICE9IGluc3Rh\nbmNlSWQpIHsKICAgICAgICAgICAgICAgIG1hc3RlckNvb2tpZS5zZXRJbnN0\nYW5jZUlkKGluc3RhbmNlSWQpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBDb29raWUgemtDb29raWUgPSBDb29r\naWUucmVhZEZyb21ab29LZWVwZXIoemssIGNvbmYpOwogICAgICAgICAgICAg\nICAgbWFzdGVyQ29va2llLnZlcmlmeSh6a0Nvb2tpZSk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNlcHRpb24gbm5l\nKSB7CiAgICAgICAgICAgICAgICBuZXdFbnYgPSB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIExpc3Q8RmlsZT4gbWlzc2VkQ29va2llRGlycyA9\nIG5ldyBBcnJheUxpc3Q8RmlsZT4oKTsKICAgICAgICAgICAgY2hlY2tEaXJl\nY3RvcnlTdHJ1Y3R1cmUoam91cm5hbERpcmVjdG9yeSk7CgogICAgICAgICAg\nICAvLyB0cnkgdG8gcmVhZCBjb29raWUgZnJvbSBqb3VybmFsIGRpcmVjdG9y\neQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgQ29va2llIGpv\ndXJuYWxDb29raWUgPSBDb29raWUucmVhZEZyb21EaXJlY3Rvcnkoam91cm5h\nbERpcmVjdG9yeSk7CiAgICAgICAgICAgICAgICBqb3VybmFsQ29va2llLnZl\ncmlmeShtYXN0ZXJDb29raWUpOwogICAgICAgICAgICB9IGNhdGNoIChGaWxl\nTm90Rm91bmRFeGNlcHRpb24gZm5mKSB7CiAgICAgICAgICAgICAgICBtaXNz\nZWRDb29raWVEaXJzLmFkZChqb3VybmFsRGlyZWN0b3J5KTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBmb3IgKEZpbGUgZGlyIDogbGVkZ2VyRGlyc01h\nbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAgICAgICAgICAgICBj\naGVja0RpcmVjdG9yeVN0cnVjdHVyZShkaXIpOwogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBDb29raWUgYyA9IENvb2tpZS5y\nZWFkRnJvbURpcmVjdG9yeShkaXIpOwogICAgICAgICAgICAgICAgICAgIGMu\ndmVyaWZ5KG1hc3RlckNvb2tpZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChGaWxlTm90Rm91bmRFeGNlcHRpb24gZm5mKSB7CiAgICAgICAgICAgICAg\nICAgICAgbWlzc2VkQ29va2llRGlycy5hZGQoZGlyKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFuZXdFbnYg\nJiYgbWlzc2VkQ29va2llRGlycy5zaXplKCkgPiAwKXsKICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiQ29va2llIGV4aXN0cyBpbiB6b29rZWVwZXIsIGJ1\ndCBub3QgaW4gYWxsIGxvY2FsIGRpcmVjdG9yaWVzLiAiCiAgICAgICAgICAg\nICAgICAgICAgICAgICsgIiBEaXJlY3RvcmllcyBtaXNzaW5nIGNvb2tpZSBm\naWxlIGFyZSAiICsgbWlzc2VkQ29va2llRGlycyk7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV3RW52\nKSB7CiAgICAgICAgICAgICAgICBpZiAobWlzc2VkQ29va2llRGlycy5zaXpl\nKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJEaXJl\nY3RvcmllcyBtaXNzaW5nIGNvb2tpZSBmaWxlIGFyZSB7fSIsIG1pc3NlZENv\nb2tpZURpcnMpOwogICAgICAgICAgICAgICAgICAgIG1hc3RlckNvb2tpZS53\ncml0ZVRvRGlyZWN0b3J5KGpvdXJuYWxEaXJlY3RvcnkpOwogICAgICAgICAg\nICAgICAgICAgIGZvciAoRmlsZSBkaXIgOiBsZWRnZXJEaXJzTWFuYWdlci5n\nZXRBbGxMZWRnZXJEaXJzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbWFzdGVyQ29va2llLndyaXRlVG9EaXJlY3RvcnkoZGlyKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBtYXN0ZXJDb29raWUud3JpdGVUb1pvb0tlZXBlcih6aywgY29uZik7CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZG4ndCBhY2Nlc3Mg\nY29va2llIGluIHpvb2tlZXBlciIsIGtlKTsKICAgICAgICAgICAgdGhyb3cg\nbmV3IEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uKGtl\nKTsKICAgICAgICB9IGNhdGNoIChVbmtub3duSG9zdEV4Y2VwdGlvbiB1aGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZG4ndCBjaGVjayBjb29r\naWVzLCBuZXR3b3JraW5nIGlzIGJyb2tlbiIsIHVoZSk7CiAgICAgICAgICAg\nIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2Vw\ndGlvbih1aGUpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkg\newogICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGFjY2Vzc2luZyBjb29r\naWUgb24gZGlza3MiLCBpb2UpOwogICAgICAgICAgICB0aHJvdyBuZXcgQm9v\na2llRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNlcHRpb24oaW9lKTsKICAg\nICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIlRocmVhZCBpbnRlcnJ1cHRlZCB3aGlsZSBj\naGVja2luZyBjb29raWVzLCBleGl0aW5nIiwgaWUpOwogICAgICAgICAgICB0\naHJvdyBuZXcgQm9va2llRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNlcHRp\nb24oaWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVy\nbiB0aGUgY29uZmlndXJlZCBhZGRyZXNzIG9mIHRoZSBib29raWUuCiAgICAg\nKi8KICAgIHB1YmxpYyBzdGF0aWMgSW5ldFNvY2tldEFkZHJlc3MgZ2V0Qm9v\na2llQWRkcmVzcyhTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAg\nICAgIHRocm93cyBVbmtub3duSG9zdEV4Y2VwdGlvbiB7CiAgICAgICAgU3Ry\naW5nIGlmYWNlID0gY29uZi5nZXRMaXN0ZW5pbmdJbnRlcmZhY2UoKTsKICAg\nICAgICBpZiAoaWZhY2UgPT0gbnVsbCkgewogICAgICAgICAgICBpZmFjZSA9\nICJkZWZhdWx0IjsKICAgICAgICB9CiAgICAgICAgSW5ldFNvY2tldEFkZHJl\nc3MgYWRkciA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcygKICAgICAgICAgICAg\nICAgIEROUy5nZXREZWZhdWx0SG9zdChpZmFjZSksCiAgICAgICAgICAgICAg\nICBjb25mLmdldEJvb2tpZVBvcnQoKSk7CiAgICAgICAgaWYgKGFkZHIuZ2V0\nQWRkcmVzcygpLmlzTG9vcGJhY2tBZGRyZXNzKCkKICAgICAgICAgICAgJiYg\nIWNvbmYuZ2V0QWxsb3dMb29wYmFjaygpKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBVbmtub3duSG9zdEV4Y2VwdGlvbigiVHJ5aW5nIHRvIGxpc3RlbiBv\nbiBsb29wYmFjayBhZGRyZXNzLCAiCiAgICAgICAgICAgICAgICAgICAgKyBh\nZGRyICsgIiBidXQgdGhpcyBpcyBmb3JiaWRkZW4gYnkgZGVmYXVsdCAiCiAg\nICAgICAgICAgICAgICAgICAgKyAiKHNlZSBTZXJ2ZXJDb25maWd1cmF0aW9u\nI2dldEFsbG93TG9vcGJhY2soKSkiKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGFkZHI7CiAgICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0SW5zdGFu\nY2VJZChab29LZWVwZXIgemspIHRocm93cyBLZWVwZXJFeGNlcHRpb24sCiAg\nICAgICAgICAgIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBTdHJp\nbmcgaW5zdGFuY2VJZCA9IG51bGw7CiAgICAgICAgaWYgKHprLmV4aXN0cyhj\nb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCksIG51bGwpID09IG51bGwpIHsK\nICAgICAgICAgICAgTE9HLmVycm9yKCJCb29rS2VlcGVyIG1ldGFkYXRhIGRv\nZXNuJ3QgZXhpc3QgaW4gem9va2VlcGVyLiAiCiAgICAgICAgICAgICAgICAg\nICAgICArICJIYXMgdGhlIGNsdXN0ZXIgYmVlbiBpbml0aWFsaXplZD8gIgog\nICAgICAgICAgICAgICAgICAgICAgKyAiVHJ5IHJ1bm5pbmcgYmluL2Jvb2tr\nZWVwZXIgc2hlbGwgbWV0YWZvcm1hdCIpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgS2VlcGVyRXhjZXB0aW9uLk5vTm9kZUV4Y2VwdGlvbigiQm9va0tlZXBl\nciBtZXRhZGF0YSIpOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAg\nICAgICBieXRlW10gZGF0YSA9IHprLmdldERhdGEoY29uZi5nZXRaa0xlZGdl\ncnNSb290UGF0aCgpICsgIi8iCiAgICAgICAgICAgICAgICAgICAgKyBCb29r\nS2VlcGVyQ29uc3RhbnRzLklOU1RBTkNFSUQsIGZhbHNlLCBudWxsKTsKICAg\nICAgICAgICAgaW5zdGFuY2VJZCA9IG5ldyBTdHJpbmcoZGF0YSk7CiAgICAg\nICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vTm9kZUV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIExPRy5pbmZvKCJJTlNUQU5DRUlEIG5vdCBleGlz\ndHMgaW4gem9va2VlcGVyLiBOb3QgY29uc2lkZXJpbmcgaXQgZm9yIGRhdGEg\ndmVyaWZpY2F0aW9uIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbnN0\nYW5jZUlkOwogICAgfQoKICAgIHB1YmxpYyBMZWRnZXJEaXJzTWFuYWdlciBn\nZXRMZWRnZXJEaXJzTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gbGVkZ2Vy\nRGlyc01hbmFnZXI7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBGaWxlIGdl\ndEN1cnJlbnREaXJlY3RvcnkoRmlsZSBkaXIpIHsKICAgICAgICByZXR1cm4g\nbmV3IEZpbGUoZGlyLCBCb29rS2VlcGVyQ29uc3RhbnRzLkNVUlJFTlRfRElS\nKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIEZpbGVbXSBnZXRDdXJyZW50\nRGlyZWN0b3JpZXMoRmlsZVtdIGRpcnMpIHsKICAgICAgICBGaWxlW10gY3Vy\ncmVudERpcnMgPSBuZXcgRmlsZVtkaXJzLmxlbmd0aF07CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBkaXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGN1cnJlbnREaXJzW2ldID0gZ2V0Q3VycmVudERpcmVjdG9yeShkaXJz\nW2ldKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGN1cnJlbnREaXJzOwog\nICAgfQoKCiAgICBwdWJsaWMgQm9va2llKFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZikKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBLZWVwZXJF\neGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNlcHRp\nb24gewogICAgICAgIHN1cGVyKCJCb29raWUtIiArIGNvbmYuZ2V0Qm9va2ll\nUG9ydCgpKTsKICAgICAgICB0aGlzLmJvb2tpZVJlZ2lzdHJhdGlvblBhdGgg\nPSBjb25mLmdldFprQXZhaWxhYmxlQm9va2llc1BhdGgoKSArICIvIjsKICAg\nICAgICB0aGlzLmNvbmYgPSBjb25mOwogICAgICAgIHRoaXMuam91cm5hbERp\ncmVjdG9yeSA9IGdldEN1cnJlbnREaXJlY3RvcnkoY29uZi5nZXRKb3VybmFs\nRGlyKCkpOwogICAgICAgIHRoaXMubGVkZ2VyRGlyc01hbmFnZXIgPSBuZXcg\nTGVkZ2VyRGlyc01hbmFnZXIoY29uZik7CiAgICAgICAgLy8gaW5zdGFudGlh\ndGUgem9va2VlcGVyIGNsaWVudCB0byBpbml0aWFsaXplIGxlZGdlciBtYW5h\nZ2VyCiAgICAgICAgdGhpcy56ayA9IGluc3RhbnRpYXRlWm9va2VlcGVyQ2xp\nZW50KGNvbmYpOwogICAgICAgIGNoZWNrRW52aXJvbm1lbnQodGhpcy56ayk7\nCiAgICAgICAgbGVkZ2VyTWFuYWdlckZhY3RvcnkgPSBMZWRnZXJNYW5hZ2Vy\nRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeShjb25mLCB0aGlzLnpr\nKTsKICAgICAgICBMT0cuaW5mbygiaW5zdGFudGlhdGUgbGVkZ2VyIG1hbmFn\nZXIge30iLCBsZWRnZXJNYW5hZ2VyRmFjdG9yeS5nZXRDbGFzcygpLmdldE5h\nbWUoKSk7CiAgICAgICAgbGVkZ2VyTWFuYWdlciA9IGxlZGdlck1hbmFnZXJG\nYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXIoKTsKICAgICAgICBzeW5jVGhyZWFk\nID0gbmV3IFN5bmNUaHJlYWQoY29uZik7CiAgICAgICAgbGVkZ2VyU3RvcmFn\nZSA9IG5ldyBJbnRlcmxlYXZlZExlZGdlclN0b3JhZ2UoY29uZiwgbGVkZ2Vy\nTWFuYWdlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJEaXJzTWFuYWdlcik7CiAgICAgICAg\naGFuZGxlcyA9IG5ldyBIYW5kbGVGYWN0b3J5SW1wbChsZWRnZXJTdG9yYWdl\nKTsKICAgICAgICAvLyBpbnN0YW50aWF0ZSB0aGUgam91cm5hbAogICAgICAg\nIGpvdXJuYWwgPSBuZXcgSm91cm5hbChjb25mLCBsZWRnZXJEaXJzTWFuYWdl\ncik7CgogICAgICAgIC8vIFpLIGVwaGVtZXJhbCBub2RlIGZvciB0aGlzIEJv\nb2tpZS4KICAgICAgICB6a0Jvb2tpZVJlZ1BhdGggPSB0aGlzLmJvb2tpZVJl\nZ2lzdHJhdGlvblBhdGggKyBnZXRNeUlkKCk7CiAgICB9CgogICAgcHJpdmF0\nZSBTdHJpbmcgZ2V0TXlJZCgpIHRocm93cyBVbmtub3duSG9zdEV4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIFN0cmluZ1V0aWxzLmFkZHJUb1N0cmluZyhC\nb29raWUuZ2V0Qm9va2llQWRkcmVzcyhjb25mKSk7CiAgICB9CgogICAgdm9p\nZCByZWFkSm91cm5hbCgpIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhj\nZXB0aW9uIHsKICAgICAgICBqb3VybmFsLnJlcGxheShuZXcgSm91cm5hbFNj\nYW5uZXIoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBwcm9jZXNzKGludCBqb3VybmFsVmVyc2lvbiwgbG9uZyBv\nZmZzZXQsIEJ5dGVCdWZmZXIgcmVjQnVmZikgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgICAgIGxvbmcgbGVkZ2VySWQgPSByZWNCdWZmLmdl\ndExvbmcoKTsKICAgICAgICAgICAgICAgIGxvbmcgZW50cnlJZCA9IHJlY0J1\nZmYuZ2V0TG9uZygpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBMT0cuZGVidWcoIlJlcGxheSBqb3VybmFsIC0gbGVkZ2Vy\nIGlkIDoge30sIGVudHJ5IGlkIDoge30uIiwgbGVkZ2VySWQsIGVudHJ5SWQp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChlbnRyeUlkID09IE1FVEFFTlRS\nWV9JRF9MRURHRVJfS0VZKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChqb3VybmFsVmVyc2lvbiA+PSAzKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpbnQgbWFzdGVyS2V5TGVuID0gcmVjQnVmZi5nZXRJbnQoKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkg\nPSBuZXcgYnl0ZVttYXN0ZXJLZXlMZW5dOwoKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJlY0J1ZmYuZ2V0KG1hc3RlcktleSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBtYXN0ZXJLZXlDYWNoZS5wdXQobGVkZ2VySWQs\nIG1hc3RlcktleSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oIkludmFsaWQgam91cm5hbC4gQ29udGFpbnMgam91cm5hbEtleSAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBidXQg\nbGF5b3V0IHZlcnNpb24gKCIgKyBqb3VybmFsVmVyc2lvbgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArICIpIGlzIHRvbyBvbGQgdG8g\naG9sZCB0aGlzIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5SWQgPT0gTUVUQUVOVFJZ\nX0lEX0ZFTkNFX0tFWSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nam91cm5hbFZlcnNpb24gPj0gNCkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnl0ZVtdIGtleSA9IG1hc3RlcktleUNhY2hlLmdldChsZWRnZXJJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSBs\nZWRnZXJTdG9yYWdlLnJlYWRNYXN0ZXJLZXkobGVkZ2VySWQpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUgPSBoYW5kbGVzLmdldEhh\nbmRsZShsZWRnZXJJZCwga2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGhhbmRsZS5zZXRGZW5jZWQoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbigiSW52YWxpZCBqb3VybmFsLiBDb250YWlucyBm\nZW5jZUtleSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgIiBidXQgbGF5b3V0IHZlcnNpb24gKCIgKyBqb3VybmFsVmVyc2lvbgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIpIGlzIHRv\nbyBvbGQgdG8gaG9sZCB0aGlzIik7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICBieXRlW10ga2V5ID0gbWFzdGVyS2V5Q2FjaGUuZ2V0KGxl\nZGdlcklkKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkgPSBsZWRn\nZXJTdG9yYWdlLnJlYWRNYXN0ZXJLZXkobGVkZ2VySWQpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIExlZGdl\nckRlc2NyaXB0b3IgaGFuZGxlID0gaGFuZGxlcy5nZXRIYW5kbGUobGVkZ2Vy\nSWQsIGtleSk7CgogICAgICAgICAgICAgICAgICAgICAgICByZWNCdWZmLnJl\nd2luZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGUuYWRkRW50\ncnkocmVjQnVmZik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoTm9MZWRnZXJFeGNlcHRpb24gbnNsZSkgewogICAg\nICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiU2tpcCByZXBsYXlpbmcgZW50\ncmllcyBvZiBsZWRnZXIge30gc2luY2UgaXQgd2FzIGRlbGV0ZWQuIiwgbGVk\nZ2VySWQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoQm9va2llRXhjZXB0\naW9uIGJlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKGJlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0pOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9p\nZCBzdGFydCgpIHsKICAgICAgICBzZXREYWVtb24odHJ1ZSk7CiAgICAgICAg\nTE9HLmRlYnVnKCJJJ20gc3RhcnRpbmcgYSBib29raWUgd2l0aCBqb3VybmFs\nIGRpcmVjdG9yeSB7fSIsIGpvdXJuYWxEaXJlY3RvcnkuZ2V0TmFtZSgpKTsK\nICAgICAgICAvLyByZXBsYXkgam91cm5hbHMKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZWFkSm91cm5hbCgpOwogICAgICAgIH0gY2F0Y2ggKElPRXhj\nZXB0aW9uIGlvZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlv\nbiB3aGlsZSByZXBsYXlpbmcgam91cm5hbHMsIHNodXR0aW5nIGRvd24iLCBp\nb2UpOwogICAgICAgICAgICBzaHV0ZG93bihFeGl0Q29kZS5CT09LSUVfRVhD\nRVBUSU9OKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gY2F0Y2gg\nKEJvb2tpZUV4Y2VwdGlvbiBiZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIkV4Y2VwdGlvbiB3aGlsZSByZXBsYXlpbmcgam91cm5hbHMsIHNodXR0aW5n\nIGRvd24iLCBiZSk7CiAgICAgICAgICAgIHNodXRkb3duKEV4aXRDb2RlLkJP\nT0tJRV9FWENFUFRJT04pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIExPRy5pbmZvKCJGaW5pc2hlZCByZWFkaW5nIGpvdXJuYWws\nIHN0YXJ0aW5nIGJvb2tpZSIpOwogICAgICAgIC8vIHN0YXJ0IGJvb2tpZSB0\naHJlYWQKICAgICAgICBzdXBlci5zdGFydCgpOwoKICAgICAgICBsZWRnZXJE\naXJzTWFuYWdlci5hZGRMZWRnZXJEaXJzTGlzdGVuZXIoZ2V0TGVkZ2VyRGly\nc0xpc3RlbmVyKCkpOwogICAgICAgIC8vU3RhcnQgRGlza0NoZWNrZXIgdGhy\nZWFkCiAgICAgICAgbGVkZ2VyRGlyc01hbmFnZXIuc3RhcnQoKTsKCiAgICAg\nICAgbGVkZ2VyU3RvcmFnZS5zdGFydCgpOwoKICAgICAgICBzeW5jVGhyZWFk\nLnN0YXJ0KCk7CiAgICAgICAgLy8gc2V0IHJ1bm5pbmcgaGVyZS4KICAgICAg\nICAvLyBzaW5jZSBib29raWUgc2VydmVyIHVzZSBydW5uaW5nIGFzIGEgZmxh\nZyB0byB0ZWxsIGJvb2tpZSBzZXJ2ZXIgd2hldGhlciBpdCBpcyBhbGl2ZQog\nICAgICAgIC8vIGlmIHNldHRpbmcgaXQgaW4gYm9va2llIHRocmVhZCwgdGhl\nIHdhdGNoZXIgbWlnaHQgcnVuIGJlZm9yZSBib29raWUgdGhyZWFkLgogICAg\nICAgIHJ1bm5pbmcgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJlZ2lzdGVyQm9va2llKGNvbmYpOwogICAgICAgIH0gY2F0Y2ggKElPRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZG4ndCBy\nZWdpc3RlciBib29raWUgd2l0aCB6b29rZWVwZXIsIHNodXR0aW5nIGRvd24i\nLCBlKTsKICAgICAgICAgICAgc2h1dGRvd24oRXhpdENvZGUuWktfUkVHX0ZB\nSUwpOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogR2V0IHRoZSBE\naXNrRmFpbHVyZSBsaXN0ZW5lciBmb3IgdGhlIGJvb2tpZQogICAgICovCiAg\nICBwcml2YXRlIExlZGdlckRpcnNMaXN0ZW5lciBnZXRMZWRnZXJEaXJzTGlz\ndGVuZXIoKSB7CgogICAgICAgIHJldHVybiBuZXcgTGVkZ2VyRGlyc0xpc3Rl\nbmVyKCkgewoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIGRpc2tGdWxsKEZpbGUgZGlzaykgewogICAgICAgICAgICAg\nICAgLy8gTm90aGluZyBuZWVkcyB0byBiZSBoYW5kbGVkIGhlcmUuCiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBkaXNrRmFpbGVkKEZpbGUgZGlzaykgewogICAgICAgICAg\nICAgICAgLy8gU2h1dGRvd24gdGhlIGJvb2tpZSBvbiBkaXNrIGZhaWx1cmUu\nCiAgICAgICAgICAgICAgICB0cmlnZ2VyQm9va2llU2h1dGRvd24oRXhpdENv\nZGUuQk9PS0lFX0VYQ0VQVElPTik7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBhbGxEaXNr\nc0Z1bGwoKSB7CiAgICAgICAgICAgICAgICAvLyBUcmFuc2l0aW9uIHRvIHJl\nYWRPbmx5IG1vZGUgb24gYWxsIGRpc2tzIGZ1bGwKICAgICAgICAgICAgICAg\nIHRyYW5zaXRpb25Ub1JlYWRPbmx5TW9kZSgpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\nZmF0YWxFcnJvcigpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRmF0\nYWwgZXJyb3IgcmVwb3J0ZWQgYnkgbGVkZ2VyRGlyc01hbmFnZXIiKTsKICAg\nICAgICAgICAgICAgIHRyaWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29kZS5C\nT09LSUVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZWdpc3RlciBqbXggd2l0aCBwYXJlbnQK\nICAgICAqCiAgICAgKiBAcGFyYW0gcGFyZW50IHBhcmVudCBiayBtYmVhbiBp\nbmZvCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVySk1YKEJLTUJl\nYW5JbmZvIHBhcmVudCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGpt\neEJvb2tpZUJlYW4gPSBuZXcgQm9va2llQmVhbih0aGlzKTsKICAgICAgICAg\nICAgQktNQmVhblJlZ2lzdHJ5LmdldEluc3RhbmNlKCkucmVnaXN0ZXIoam14\nQm9va2llQmVhbiwgcGFyZW50KTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBqbXhMZWRnZXJTdG9yYWdlQmVhbiA9IHRoaXMubGVkZ2Vy\nU3RvcmFnZS5nZXRKTVhCZWFuKCk7CiAgICAgICAgICAgICAgICBCS01CZWFu\nUmVnaXN0cnkuZ2V0SW5zdGFuY2UoKS5yZWdpc3RlcihqbXhMZWRnZXJTdG9y\nYWdlQmVhbiwgam14Qm9va2llQmVhbik7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRmFp\nbGVkIHRvIHJlZ2lzdGVyIHdpdGggSk1YIGZvciBsZWRnZXIgY2FjaGUiLCBl\nKTsKICAgICAgICAgICAgICAgIGpteExlZGdlclN0b3JhZ2VCZWFuID0gbnVs\nbDsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJGYWlsZWQgdG8gcmVnaXN0ZXIg\nd2l0aCBKTVgiLCBlKTsKICAgICAgICAgICAgam14Qm9va2llQmVhbiA9IG51\nbGw7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVW5yZWdpc3Rl\nciBqbXgKICAgICAqLwogICAgcHVibGljIHZvaWQgdW5yZWdpc3RlckpNWCgp\nIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoam14TGVkZ2VyU3Rv\ncmFnZUJlYW4gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgQktNQmVhblJl\nZ2lzdHJ5LmdldEluc3RhbmNlKCkudW5yZWdpc3RlcihqbXhMZWRnZXJTdG9y\nYWdlQmVhbik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBMT0cud2FybigiRmFpbGVkIHRvIHVu\ncmVnaXN0ZXIgd2l0aCBKTVgiLCBlKTsKICAgICAgICB9CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgaWYgKGpteEJvb2tpZUJlYW4gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgQktNQmVhblJlZ2lzdHJ5LmdldEluc3RhbmNlKCku\ndW5yZWdpc3RlcihqbXhCb29raWVCZWFuKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy53\nYXJuKCJGYWlsZWQgdG8gdW5yZWdpc3RlciB3aXRoIEpNWCIsIGUpOwogICAg\nICAgIH0KICAgICAgICBqbXhCb29raWVCZWFuID0gbnVsbDsKICAgICAgICBq\nbXhMZWRnZXJTdG9yYWdlQmVhbiA9IG51bGw7CiAgICB9CgoKICAgIC8qKgog\nICAgICogSW5zdGFudGlhdGUgdGhlIFpvb0tlZXBlciBjbGllbnQgZm9yIHRo\nZSBCb29raWUuCiAgICAgKi8KICAgIHByaXZhdGUgWm9vS2VlcGVyIGluc3Rh\nbnRpYXRlWm9va2VlcGVyQ2xpZW50KFNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZikKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29u\nZi5nZXRaa1NlcnZlcnMoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIExPRy53\nYXJuKCJObyBaSyBzZXJ2ZXJzIHBhc3NlZCB0byBCb29raWUgY29uc3RydWN0\nb3Igc28gQm9va0tlZXBlciBjbGllbnRzIHdvbid0IGtub3cgYWJvdXQgdGhp\ncyBzZXJ2ZXIhIik7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAg\nIH0KICAgICAgICAvLyBDcmVhdGUgdGhlIFpvb0tlZXBlciBjbGllbnQgaW5z\ndGFuY2UKICAgICAgICByZXR1cm4gbmV3Wm9va2VlcGVyKGNvbmYuZ2V0WmtT\nZXJ2ZXJzKCksIGNvbmYuZ2V0WmtUaW1lb3V0KCkpOwogICAgfQoKICAgIC8q\nKgogICAgICogUmVnaXN0ZXIgYXMgYW4gYXZhaWxhYmxlIGJvb2tpZQogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZWdpc3RlckJvb2tpZShTZXJ2ZXJD\nb25maWd1cmF0aW9uIGNvbmYpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKG51bGwgPT0gemspIHsKICAgICAgICAgICAgLy8gem9va2VlcGVy\nIGluc3RhbmNlIGlzIG51bGwsIG1lYW5zIG5vdCByZWdpc3RlciBpdHNlbGYg\ndG8gemsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nLy8gWksgZXBoZW1lcmFsIG5vZGUgZm9yIHRoaXMgQm9va2llLgogICAgICAg\nIFN0cmluZyB6a0Jvb2tpZVJlZ1BhdGggPSB0aGlzLmJvb2tpZVJlZ2lzdHJh\ndGlvblBhdGgKICAgICAgICAgICAgKyBTdHJpbmdVdGlscy5hZGRyVG9TdHJp\nbmcoZ2V0Qm9va2llQWRkcmVzcyhjb25mKSk7CiAgICAgICAgZmluYWwgQ291\nbnREb3duTGF0Y2ggcHJldk5vZGVMYXRjaCA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKICAgICAgICB0cnl7CiAgICAgICAgICAgIFdhdGNoZXIgemtQcmV2\nUmVnTm9kZXdhdGNoZXIgPSBuZXcgV2F0Y2hlcigpIHsKICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJv\nY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAgICAgICAgICAg\nICAvLyBDaGVjayBmb3IgcHJldiB6bm9kZSBkZWxldGlvbi4gQ29ubmVjdGlv\nbiBleHBpcmF0aW9uIGlzCiAgICAgICAgICAgICAgICAgICAgLy8gbm90IGhh\nbmRsaW5nLCBzaW5jZSBib29raWUgaGFzIGxvZ2ljIHRvIHNodXRkb3duLgog\nICAgICAgICAgICAgICAgICAgIGlmIChFdmVudFR5cGUuTm9kZURlbGV0ZWQg\nPT0gZXZlbnQuZ2V0VHlwZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHByZXZOb2RlTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAg\nICAgICBpZiAobnVsbCAhPSB6ay5leGlzdHMoemtCb29raWVSZWdQYXRoLCB6\na1ByZXZSZWdOb2Rld2F0Y2hlcikpIHsKICAgICAgICAgICAgICAgIExPRy5p\nbmZvKCJQcmV2aW91cyBib29raWUgcmVnaXN0cmF0aW9uIHpub2RlOiAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICsgemtCb29raWVSZWdQYXRoCiAgICAg\nICAgICAgICAgICAgICAgICAgICsgIiBleGlzdHMsIHNvIHdhaXRpbmcgemsg\nc2Vzc2lvbnRpbWVvdXQ6ICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBj\nb25mLmdldFprVGltZW91dCgpICsgIm1zIGZvciB6bm9kZSBkZWxldGlvbiIp\nOwogICAgICAgICAgICAgICAgLy8gd2FpdGluZyBmb3IgdGhlIHByZXZpb3Vz\nIGJvb2tpZSByZWcgem5vZGUgZGVsZXRpb24KICAgICAgICAgICAgICAgIGlm\nICghcHJldk5vZGVMYXRjaC5hd2FpdChjb25mLmdldFprVGltZW91dCgpLAog\nICAgICAgICAgICAgICAgICAgICAgICBUaW1lVW5pdC5NSUxMSVNFQ09ORFMp\nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEtlZXBlckV4Y2Vw\ndGlvbi5Ob2RlRXhpc3RzRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgemtCb29raWVSZWdQYXRoKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBaSyBl\ncGhlbWVyYWwgbm9kZSBmb3IgdGhpcyBCb29raWUuCiAgICAgICAgICAgIHpr\nLmNyZWF0ZSh6a0Jvb2tpZVJlZ1BhdGgsIG5ldyBieXRlWzBdLCBJZHMuT1BF\nTl9BQ0xfVU5TQUZFLAogICAgICAgICAgICAgICAgICAgIENyZWF0ZU1vZGUu\nRVBIRU1FUkFMKTsKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJaSyBleGNlcHRpb24gcmVn\naXN0ZXJpbmcgZXBoZW1lcmFsIFpub2RlIGZvciBCb29raWUhIiwKICAgICAg\nICAgICAgICAgICAgICBrZSk7CiAgICAgICAgICAgIC8vIFRocm93IGFuIElP\nRXhjZXB0aW9uIGJhY2sgdXAuIFRoaXMgd2lsbCBjYXVzZSB0aGUgQm9va2ll\nCiAgICAgICAgICAgIC8vIGNvbnN0cnVjdG9yIHRvIGVycm9yIG91dC4gQWx0\nZXJuYXRpdmVseSwgd2UgY291bGQgZG8gYSBTeXN0ZW0KICAgICAgICAgICAg\nLy8gZXhpdCBoZXJlIGFzIHRoaXMgaXMgYSBmYXRhbCBlcnJvci4KICAgICAg\nICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGtlKTsKICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIlpLIGV4Y2VwdGlvbiByZWdpc3RlcmluZyBlcGhlbWVyYWwg\nWm5vZGUgZm9yIEJvb2tpZSEiLAogICAgICAgICAgICAgICAgICAgIGllKTsK\nICAgICAgICAgICAgLy8gVGhyb3cgYW4gSU9FeGNlcHRpb24gYmFjayB1cC4g\nVGhpcyB3aWxsIGNhdXNlIHRoZSBCb29raWUKICAgICAgICAgICAgLy8gY29u\nc3RydWN0b3IgdG8gZXJyb3Igb3V0LiBBbHRlcm5hdGl2ZWx5LCB3ZSBjb3Vs\nZCBkbyBhIFN5c3RlbQogICAgICAgICAgICAvLyBleGl0IGhlcmUgYXMgdGhp\ncyBpcyBhIGZhdGFsIGVycm9yLgogICAgICAgICAgICB0aHJvdyBuZXcgSU9F\neGNlcHRpb24oaWUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICog\nVHJhbnNpdGlvbiB0aGUgYm9va2llIHRvIHJlYWRPbmx5IG1vZGUKICAgICAq\nLwogICAgQFZpc2libGVGb3JUZXN0aW5nCiAgICBwdWJsaWMgdm9pZCB0cmFu\nc2l0aW9uVG9SZWFkT25seU1vZGUoKSB7CiAgICAgICAgaWYgKHNodXR0aW5n\nZG93biA9PSB0cnVlKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIGlmICghcmVhZE9ubHkuY29tcGFyZUFuZFNldChmYWxzZSwg\ndHJ1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAg\nICBpZiAoIWNvbmYuaXNSZWFkT25seU1vZGVFbmFibGVkKCkpIHsKICAgICAg\nICAgICAgTE9HLndhcm4oIlJlYWRPbmx5IG1vZGUgaXMgbm90IGVuYWJsZWQu\nICIKICAgICAgICAgICAgICAgICAgICArICJDYW4gYmUgZW5hYmxlZCBieSBj\nb25maWd1cmluZyAiCiAgICAgICAgICAgICAgICAgICAgKyAiJ3JlYWRPbmx5\nTW9kZUVuYWJsZWQ9dHJ1ZScgaW4gY29uZmlndXJhdGlvbi4iCiAgICAgICAg\nICAgICAgICAgICAgKyAiU2h1dHRpbmcgZG93biBib29raWUiKTsKICAgICAg\nICAgICAgdHJpZ2dlckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9F\nWENFUFRJT04pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAg\nICAgIExPRy5pbmZvKCJUcmFuc2l0aW9uaW5nIEJvb2tpZSB0byBSZWFkT25s\neSBtb2RlLCIKICAgICAgICAgICAgICAgICsgIiBhbmQgd2lsbCBzZXJ2ZSBv\nbmx5IHJlYWQgcmVxdWVzdHMgZnJvbSBjbGllbnRzISIpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGlmIChudWxsID09IHprLmV4aXN0cyh0aGlzLmJv\nb2tpZVJlZ2lzdHJhdGlvblBhdGgKICAgICAgICAgICAgICAgICAgICArIEJv\nb2tLZWVwZXJDb25zdGFudHMuUkVBRE9OTFksIGZhbHNlKSkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB6ay5jcmVhdGUo\ndGhpcy5ib29raWVSZWdpc3RyYXRpb25QYXRoCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFudHMuUkVBRE9OTFksIG5l\ndyBieXRlWzBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgSWRzLk9Q\nRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJTSVNURU5UKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKE5vZGVFeGlzdHNFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgbm9kZSBpcyBqdXN0IG5vdyBj\ncmVhdGVkIGJ5IHNvbWVvbmUuCiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSByZWFkb25seSBub2Rl\nCiAgICAgICAgICAgIHprLmNyZWF0ZSh0aGlzLmJvb2tpZVJlZ2lzdHJhdGlv\nblBhdGgKICAgICAgICAgICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFu\ndHMuUkVBRE9OTFkgKyAiLyIgKyBnZXRNeUlkKCksCiAgICAgICAgICAgICAg\nICAgICAgbmV3IGJ5dGVbMF0sIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0\nZU1vZGUuRVBIRU1FUkFMKTsKICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIGN1\ncnJlbnQgcmVnaXN0ZXJlZCBub2RlCiAgICAgICAgICAgIHprLmRlbGV0ZSh6\na0Jvb2tpZVJlZ1BhdGgsIC0xKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgaW4gdHJh\nbnNpdGlvbiB0byBSZWFkT25seSBNb2RlLiIKICAgICAgICAgICAgICAgICAg\nICArICIgU2h1dHRpbmcgZG93biIsIGUpOwogICAgICAgICAgICB0cmlnZ2Vy\nQm9va2llU2h1dGRvd24oRXhpdENvZGUuQk9PS0lFX0VYQ0VQVElPTik7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGluIHRy\nYW5zaXRpb24gdG8gUmVhZE9ubHkgTW9kZS4iCiAgICAgICAgICAgICAgICAg\nICAgKyAiIFNodXR0aW5nIGRvd24iLCBlKTsKICAgICAgICAgICAgdHJpZ2dl\nckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9FWENFUFRJT04pOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0\nZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBUaHJlYWQuY3VycmVudFRo\ncmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICBMT0cud2FybigiSW50\nZXJydXB0ZWQgRXhjZXB0aW9uIHdoaWxlIHRyYW5zaXRpb25pbmcgdG8gUmVh\nZE9ubHkgTW9kZS4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKgogICAgICogQ2hlY2sgd2hldGhlciBCb29raWUgaXMg\nd3JpdGFibGUKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNSZWFkT25s\neSgpIHsKICAgICAgICByZXR1cm4gcmVhZE9ubHkuZ2V0KCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgem9va2VlcGVyIGNsaWVudCB0\nbyB6ayBjbHVzdGVyLgogICAgICoKICAgICAqIDxwPgogICAgICogQm9va2ll\nIFNlcnZlciBqdXN0IHVzZWQgemsgY2xpZW50IHdoZW4gc3luY2luZyBsZWRn\nZXJzIGZvciBnYXJiYWdlIGNvbGxlY3Rpb24uCiAgICAgKiBTbyB3aGVuIHpr\nIGNsaWVudCBpcyBleHBpcmVkLCBpdCBtZWFucyB0aGlzIGJvb2tpZSBzZXJ2\nZXIgaXMgbm90IGF2YWlsYWJsZSBpbgogICAgICogYm9va2llIHNlcnZlciBs\naXN0LiBUaGUgYm9va2llIGNsaWVudCB3aWxsIGJlIG5vdGlmaWVkIGZvciBp\ndHMgZXhwaXJhdGlvbi4gTm8KICAgICAqIG1vcmUgYm9va2llIHJlcXVlc3Qg\nd2lsbCBiZSBzZW50IHRvIHRoaXMgc2VydmVyLiBTbyBpdCdzIGJldHRlciB0\nbyBleGl0IHdoZW4gemsKICAgICAqIGV4cGlyZWQuCiAgICAgKiA8L3A+CiAg\nICAgKiA8cD4KICAgICAqIFNpbmNlIHRoZXJlIGFyZSBsb3RzIG9mIGJrIG9w\nZXJhdGlvbnMgY2FjaGVkIGluIHF1ZXVlLCBzbyB3ZSB3YWl0IGZvciBhbGwg\ndGhlIG9wZXJhdGlvbnMKICAgICAqIGFyZSBwcm9jZXNzZWQgYW5kIHF1aXQu\nIEl0IGlzIGRvbmUgYnkgY2FsbGluZyA8Yj5zaHV0ZG93bjwvYj4uCiAgICAg\nKiA8L3A+CiAgICAgKgogICAgICogQHBhcmFtIHprU2VydmVycyB0aGUgcXVv\ncnVtIGxpc3Qgb2Ygemsgc2VydmVycwogICAgICogQHBhcmFtIHNlc3Npb25U\naW1lb3V0IHNlc3Npb24gdGltZW91dCBvZiB6ayBjb25uZWN0aW9uCiAgICAg\nKgogICAgICogQHJldHVybiB6ayBjbGllbnQgaW5zdGFuY2UKICAgICAqLwog\nICAgcHJpdmF0ZSBab29LZWVwZXIgbmV3Wm9va2VlcGVyKGZpbmFsIFN0cmlu\nZyB6a1NlcnZlcnMsCiAgICAgICAgICAgIGZpbmFsIGludCBzZXNzaW9uVGlt\nZW91dCkgdGhyb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiwKICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIHsKICAgICAgICBab29L\nZWVwZXJXYXRjaGVyQmFzZSB3ID0gbmV3IFpvb0tlZXBlcldhdGNoZXJCYXNl\nKGNvbmYuZ2V0WmtUaW1lb3V0KCkpIHsKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50\nIGV2ZW50KSB7CiAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgZXhwaXJl\nZCBjb25uZWN0aW9uLgogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFN0\nYXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuRXhwaXJl\nZCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlpLIGNsaWVu\ndCBjb25uZWN0aW9uIHRvIHRoZSBaSyBzZXJ2ZXIgaGFzIGV4cGlyZWQhIik7\nCiAgICAgICAgICAgICAgICAgICAgc2h1dGRvd24oRXhpdENvZGUuWktfRVhQ\nSVJFRCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIHN1cGVyLnByb2Nlc3MoZXZlbnQpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4gWmtV\ndGlscy5jcmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGllbnQoemtTZXJ2ZXJz\nLCB3KTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1J1bm5pbmcoKSB7\nCiAgICAgICAgcmV0dXJuIHJ1bm5pbmc7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgLy8gYm9va2llIHRo\ncmVhZCB3YWl0IGZvciBqb3VybmFsIHRocmVhZAogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIHN0YXJ0IGpvdXJuYWwKICAgICAgICAgICAgam91cm5h\nbC5zdGFydCgpOwogICAgICAgICAgICAvLyB3YWl0IHVudGlsIGpvdXJuYWwg\ncXVpdHMKICAgICAgICAgICAgam91cm5hbC5qb2luKCk7CiAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICB9CiAg\nICAgICAgLy8gaWYgdGhlIGpvdXJuYWwgdGhyZWFkIHF1aXRzIGR1ZSB0byBz\naHV0dGluZyBkb3duLCBpdCBpcyBvawogICAgICAgIGlmICghc2h1dHRpbmdk\nb3duKSB7CiAgICAgICAgICAgIC8vIHNvbWUgZXJyb3IgZm91bmQgaW4gam91\ncm5hbCB0aHJlYWQgYW5kIGl0IHF1aXRzCiAgICAgICAgICAgIC8vIGZvbGxv\nd2luZyBhZGQgb3BlcmF0aW9ucyB0byBpdCB3b3VsZCBoYW5nIHVuaXQgY2xp\nZW50IHRpbWVvdXQKICAgICAgICAgICAgLy8gc28gd2Ugc2hvdWxkIGxldCBi\nb29raWUgc2VydmVyIGV4aXN0cwogICAgICAgICAgICBMT0cuZXJyb3IoIkpv\ndXJuYWwgbWFuYWdlciBxdWl0cyB1bmV4cGVjdGVkbHkuIik7CiAgICAgICAg\nICAgIHRyaWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29kZS5CT09LSUVfRVhD\nRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gVHJpZ2dlcmluZyB0\naGUgQm9va2llIHNodXRkb3duIGluIGl0cyBvd24gdGhyZWFkLAogICAgLy8g\nYmVjYXVzZSBzaHV0ZG93biBjYW4gYmUgY2FsbGVkIGZyb20gc3luYyB0aHJl\nYWQgd2hpY2ggd291bGQgYmUKICAgIC8vIGludGVycnVwdGVkIGJ5IHNodXRk\nb3duIGNhbGwuCiAgICBBdG9taWNCb29sZWFuIHNodXRkb3duVHJpZ2dlcmVk\nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAgdm9pZCB0cmlnZ2Vy\nQm9va2llU2h1dGRvd24oZmluYWwgaW50IGV4aXRDb2RlKSB7CiAgICAgICAg\naWYgKCFzaHV0ZG93blRyaWdnZXJlZC5jb21wYXJlQW5kU2V0KGZhbHNlLCB0\ncnVlKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAg\nIExPRy5pbmZvKCJUcmlnZ2VyaW5nIHNodXRkb3duIG9mIEJvb2tpZS17fSB3\naXRoIGV4aXRDb2RlIHt9IiwKICAgICAgICAgICAgICAgICBjb25mLmdldEJv\nb2tpZVBvcnQoKSwgZXhpdENvZGUpOwogICAgICAgIG5ldyBUaHJlYWQoIkJv\nb2tpZVNodXRkb3duVHJpZ2dlciIpIHsKICAgICAgICAgICAgcHVibGljIHZv\naWQgcnVuKCkgewogICAgICAgICAgICAgICAgQm9va2llLnRoaXMuc2h1dGRv\nd24oZXhpdENvZGUpOwogICAgICAgICAgICB9CiAgICAgICAgfS5zdGFydCgp\nOwogICAgfQoKICAgIC8vIHByb3ZpZGVkIGEgcHVibGljIHNodXRkb3duIG1l\ndGhvZCBmb3Igb3RoZXIgY2FsbGVyCiAgICAvLyB0byBzaHV0IGRvd24gYm9v\na2llIGdyYWNlZnVsbHkKICAgIHB1YmxpYyBpbnQgc2h1dGRvd24oKSB7CiAg\nICAgICAgcmV0dXJuIHNodXRkb3duKEV4aXRDb2RlLk9LKTsKICAgIH0KCiAg\nICAvLyBpbnRlcm5hbCBzaHV0ZG93biBtZXRob2QgdG8gbGV0IHNodXRkb3du\nIGJvb2tpZSBncmFjZWZ1bGx5CiAgICAvLyB3aGVuIGVuY291bnRlcmluZyBl\neGNlcHRpb24KICAgIHN5bmNocm9uaXplZCBpbnQgc2h1dGRvd24oaW50IGV4\naXRDb2RlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJ1bm5p\nbmcpIHsgLy8gYXZvaWQgc2h1dGRvd24gdHdpY2UKICAgICAgICAgICAgICAg\nIC8vIHRoZSBleGl0Q29kZSBvbmx5IHNldCB3aGVuIGZpcnN0IHNodXRkb3du\nIHVzdWFsbHkgZHVlIHRvIGV4Y2VwdGlvbiBmb3VuZAogICAgICAgICAgICAg\nICAgTE9HLmluZm8oIlNodXR0aW5nIGRvd24gQm9va2llLXt9IHdpdGggZXhp\ndENvZGUge30iLAogICAgICAgICAgICAgICAgICAgICAgICAgY29uZi5nZXRC\nb29raWVQb3J0KCksIGV4aXRDb2RlKTsKICAgICAgICAgICAgICAgIHRoaXMu\nZXhpdENvZGUgPSBleGl0Q29kZTsKICAgICAgICAgICAgICAgIC8vIG1hcmsg\nYm9va2llIGFzIGluIHNodXR0aW5nIGRvd24gcHJvZ3Jlc3MKICAgICAgICAg\nICAgICAgIHNodXR0aW5nZG93biA9IHRydWU7CgogICAgICAgICAgICAgICAg\nLy8gU2h1dGRvd24gam91cm5hbAogICAgICAgICAgICAgICAgam91cm5hbC5z\naHV0ZG93bigpOwogICAgICAgICAgICAgICAgdGhpcy5qb2luKCk7CiAgICAg\nICAgICAgICAgICBzeW5jVGhyZWFkLnNodXRkb3duKCk7CgogICAgICAgICAg\nICAgICAgLy8gU2h1dGRvd24gdGhlIEVudHJ5TG9nZ2VyIHdoaWNoIGhhcyB0\naGUgR2FyYmFnZUNvbGxlY3RvciBUaHJlYWQgcnVubmluZwogICAgICAgICAg\nICAgICAgbGVkZ2VyU3RvcmFnZS5zaHV0ZG93bigpOwoKICAgICAgICAgICAg\nICAgIC8vIGNsb3NlIExlZGdlciBNYW5hZ2VyCiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGxlZGdlck1hbmFnZXIuY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJNYW5hZ2VyRmFjdG9yeS51\nbmluaXRpYWxpemUoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhj\nZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJG\nYWlsZWQgdG8gY2xvc2UgYWN0aXZlIGxlZGdlciBtYW5hZ2VyIDogIiwgaWUp\nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vU2h1dGRv\nd24gZGlzayBjaGVja2VyCiAgICAgICAgICAgICAgICBsZWRnZXJEaXJzTWFu\nYWdlci5zaHV0ZG93bigpOwoKICAgICAgICAgICAgICAgIC8vIFNodXRkb3du\nIHRoZSBaSyBjbGllbnQKICAgICAgICAgICAgICAgIGlmKHprICE9IG51bGwp\nIHprLmNsb3NlKCk7CgogICAgICAgICAgICAgICAgLy8gc2V0dGluZyBydW5u\naW5nIHRvIGZhbHNlIGhlcmUsIHNvIHdhdGNoIHRocmVhZAogICAgICAgICAg\nICAgICAgLy8gaW4gYm9va2llIHNlcnZlciBrbm93IGl0IG9ubHkgYWZ0ZXIg\nYm9va2llIHNodXQgZG93bgogICAgICAgICAgICAgICAgcnVubmluZyA9IGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0\nZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJbnRl\ncnJ1cHRlZCBkdXJpbmcgc2h1dHRpbmcgZG93biBib29raWUgOiAiLCBpZSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmV4aXRDb2RlOwogICAg\nfQoKICAgIC8qKiAKICAgICAqIFJldHJpZXZlIHRoZSBsZWRnZXIgZGVzY3Jp\ncHRvciBmb3IgdGhlIGxlZGdlciB3aGljaCBlbnRyeSBzaG91bGQgYmUgYWRk\nZWQgdG8uCiAgICAgKiBUaGUgTGVkZ2VyRGVzY3JpcHRvciByZXR1cm5lZCBm\ncm9tIHRoaXMgbWV0aG9kIHNob3VsZCBiZSBldmVudHVhbGx5IGZyZWVkIHdp\ndGggCiAgICAgKiAjcHV0SGFuZGxlKCkuCiAgICAgKgogICAgICogQHRocm93\ncyBCb29raWVFeGNlcHRpb24gaWYgbWFzdGVyS2V5IGRvZXMgbm90IG1hdGNo\nIHRoZSBtYXN0ZXIga2V5IG9mIHRoZSBsZWRnZXIKICAgICAqLwogICAgcHJp\ndmF0ZSBMZWRnZXJEZXNjcmlwdG9yIGdldExlZGdlckZvckVudHJ5KEJ5dGVC\ndWZmZXIgZW50cnksIGJ5dGVbXSBtYXN0ZXJLZXkpIAogICAgICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAg\nbG9uZyBsZWRnZXJJZCA9IGVudHJ5LmdldExvbmcoKTsKICAgICAgICBMZWRn\nZXJEZXNjcmlwdG9yIGwgPSBoYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJZCwg\nbWFzdGVyS2V5KTsKICAgICAgICBpZiAoIW1hc3RlcktleUNhY2hlLmNvbnRh\naW5zS2V5KGxlZGdlcklkKSkgewogICAgICAgICAgICAvLyBuZXcgaGFuZGxl\nLCB3ZSBzaG91bGQgYWRkIHRoZSBrZXkgdG8gam91cm5hbCBlbnN1cmUgd2Ug\nY2FuIHJlYnVpbGQKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVC\ndWZmZXIuYWxsb2NhdGUoOCArIDggKyA0ICsgbWFzdGVyS2V5Lmxlbmd0aCk7\nCiAgICAgICAgICAgIGJiLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgICAg\nICBiYi5wdXRMb25nKE1FVEFFTlRSWV9JRF9MRURHRVJfS0VZKTsKICAgICAg\nICAgICAgYmIucHV0SW50KG1hc3RlcktleS5sZW5ndGgpOwogICAgICAgICAg\nICBiYi5wdXQobWFzdGVyS2V5KTsKICAgICAgICAgICAgYmIuZmxpcCgpOwoK\nICAgICAgICAgICAgam91cm5hbC5sb2dBZGRFbnRyeShiYiwgbmV3IE5vcFdy\naXRlQ2FsbGJhY2soKSwgbnVsbCk7CiAgICAgICAgICAgIG1hc3RlcktleUNh\nY2hlLnB1dChsZWRnZXJJZCwgbWFzdGVyS2V5KTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGw7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYWRkRW50\ncnlCeUxlZGdlcklkKGxvbmcgbGVkZ2VySWQsIEJ5dGVCdWZmZXIgZW50cnkp\nCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24g\newogICAgICAgIGJ5dGVbXSBrZXkgPSBsZWRnZXJTdG9yYWdlLnJlYWRNYXN0\nZXJLZXkobGVkZ2VySWQpOwogICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFu\nZGxlID0gaGFuZGxlcy5nZXRIYW5kbGUobGVkZ2VySWQsIGtleSk7CiAgICAg\nICAgaGFuZGxlLmFkZEVudHJ5KGVudHJ5KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEFkZCBhbiBlbnRyeSB0byBhIGxlZGdlciBhcyBzcGVjaWZpZWQgYnkg\naGFuZGxlLiAKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEVudHJ5SW50\nZXJuYWwoTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUsIEJ5dGVCdWZmZXIgZW50\ncnksIFdyaXRlQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgpCiAgICAgICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAg\nICBsb25nIGxlZGdlcklkID0gaGFuZGxlLmdldExlZGdlcklkKCk7CiAgICAg\nICAgZW50cnkucmV3aW5kKCk7CiAgICAgICAgbG9uZyBlbnRyeUlkID0gaGFu\nZGxlLmFkZEVudHJ5KGVudHJ5KTsKCiAgICAgICAgZW50cnkucmV3aW5kKCk7\nCiAgICAgICAgTE9HLnRyYWNlKCJBZGRpbmcge31Ae30iLCBlbnRyeUlkLCBs\nZWRnZXJJZCk7CiAgICAgICAgam91cm5hbC5sb2dBZGRFbnRyeShlbnRyeSwg\nY2IsIGN0eCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgZW50cnkgdG8g\nYSBsZWRnZXIsIGV2ZW4gaWYgdGhlIGxlZGdlciBoYXMgcHJldmlvdXMgYmVl\nbiBmZW5jZWQuIFRoaXMgc2hvdWxkIG9ubHkKICAgICAqIGhhcHBlbiBpbiBi\nb29raWUgcmVjb3Zlcnkgb3IgbGVkZ2VyIHJlY292ZXJ5IGNhc2VzLCB3aGVy\nZSBlbnRyaWVzIGFyZSBiZWluZyByZXBsaWNhdGVzIAogICAgICogc28gdGhh\ndCB0aGV5IGV4aXN0IG9uIGEgcXVvcnVtIG9mIGJvb2tpZXMuIFRoZSBjb3Jy\nZXNwb25kaW5nIGNsaWVudCBzaWRlIGNhbGwgZm9yIHRoaXMKICAgICAqIGlz\nIG5vdCBleHBvc2VkIHRvIHVzZXJzLgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCByZWNvdmVyeUFkZEVudHJ5KEJ5dGVCdWZmZXIgZW50cnksIFdyaXRlQ2Fs\nbGJhY2sgY2IsIE9iamVjdCBjdHgsIGJ5dGVbXSBtYXN0ZXJLZXkpIAogICAg\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBo\nYW5kbGUgPSBnZXRMZWRnZXJGb3JFbnRyeShlbnRyeSwgbWFzdGVyS2V5KTsK\nICAgICAgICAgICAgc3luY2hyb25pemVkIChoYW5kbGUpIHsKICAgICAgICAg\nICAgICAgIGFkZEVudHJ5SW50ZXJuYWwoaGFuZGxlLCBlbnRyeSwgY2IsIGN0\neCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChOb1dyaXRhYmxl\nTGVkZ2VyRGlyRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdHJhbnNpdGlv\nblRvUmVhZE9ubHlNb2RlKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKiAKICAg\nICAqIEFkZCBlbnRyeSB0byBhIGxlZGdlci4KICAgICAqIEB0aHJvd3MgQm9v\na2llRXhjZXB0aW9uLkxlZGdlckZlbmNlZEV4Y2VwdGlvbiBpZiB0aGUgbGVk\nZ2VyIGlzIGZlbmNlZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRFbnRy\neShCeXRlQnVmZmVyIGVudHJ5LCBXcml0ZUNhbGxiYWNrIGNiLCBPYmplY3Qg\nY3R4LCBieXRlW10gbWFzdGVyS2V5KQogICAgICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUgPSBnZXRMZWRnZXJG\nb3JFbnRyeShlbnRyeSwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChoYW5kbGUpIHsKICAgICAgICAgICAgICAgIGlmIChoYW5kbGUu\naXNGZW5jZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IEJvb2tp\nZUV4Y2VwdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0\nZShCb29raWVFeGNlcHRpb24uQ29kZS5MZWRnZXJGZW5jZWRFeGNlcHRpb24p\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYWRkRW50cnlJ\nbnRlcm5hbChoYW5kbGUsIGVudHJ5LCBjYiwgY3R4KTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gY2F0Y2ggKE5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICB0cmFuc2l0aW9uVG9SZWFkT25seU1vZGUo\nKTsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGUpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZlbmNlcyBhIGxlZGdlci4g\nRnJvbSB0aGlzIHBvaW50IG9uLCBjbGllbnRzIHdpbGwgYmUgdW5hYmxlIHRv\nCiAgICAgKiB3cml0ZSB0byB0aGlzIGxlZGdlci4gT25seSByZWNvdmVyeUFk\nZEVudHJ5IHdpbGwgYmUKICAgICAqIGFibGUgdG8gYWRkIGVudHJpZXMgdG8g\ndGhlIGxlZGdlci4KICAgICAqIFRoaXMgbWV0aG9kIGlzIGlkZW1wb3RlbnQu\nIE9uY2UgYSBsZWRnZXIgaXMgZmVuY2VkLCBpdCBjYW4KICAgICAqIG5ldmVy\nIGJlIHVuZmVuY2VkLiBGZW5jaW5nIGEgZmVuY2VkIGxlZGdlciBoYXMgbm8g\nZWZmZWN0LgogICAgICovCiAgICBwdWJsaWMgRnV0dXJlPEJvb2xlYW4+IGZl\nbmNlTGVkZ2VyKGxvbmcgbGVkZ2VySWQsIGJ5dGVbXSBtYXN0ZXJLZXkpIHRo\ncm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAgICBM\nZWRnZXJEZXNjcmlwdG9yIGhhbmRsZSA9IGhhbmRsZXMuZ2V0SGFuZGxlKGxl\nZGdlcklkLCBtYXN0ZXJLZXkpOwogICAgICAgIGJvb2xlYW4gc3VjY2VzczsK\nICAgICAgICBzeW5jaHJvbml6ZWQgKGhhbmRsZSkgewogICAgICAgICAgICBz\ndWNjZXNzID0gaGFuZGxlLnNldEZlbmNlZCgpOwogICAgICAgIH0KICAgICAg\nICBpZiAoc3VjY2VzcykgewogICAgICAgICAgICAvLyBmZW5jZWQgZmlyc3Qg\ndGltZSwgd2Ugc2hvdWxkIGFkZCB0aGUga2V5IHRvIGpvdXJuYWwgZW5zdXJl\nIHdlIGNhbiByZWJ1aWxkCiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBC\neXRlQnVmZmVyLmFsbG9jYXRlKDggKyA4KTsKICAgICAgICAgICAgYmIucHV0\nTG9uZyhsZWRnZXJJZCk7CiAgICAgICAgICAgIGJiLnB1dExvbmcoTUVUQUVO\nVFJZX0lEX0ZFTkNFX0tFWSk7CiAgICAgICAgICAgIGJiLmZsaXAoKTsKCiAg\nICAgICAgICAgIEZ1dHVyZVdyaXRlQ2FsbGJhY2sgZndjID0gbmV3IEZ1dHVy\nZVdyaXRlQ2FsbGJhY2soKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJyZWNv\ncmQgZmVuY2VkIHN0YXRlIGZvciBsZWRnZXIge30gaW4gam91cm5hbC4iLCBs\nZWRnZXJJZCk7CiAgICAgICAgICAgIGpvdXJuYWwubG9nQWRkRW50cnkoYmIs\nIGZ3YywgbnVsbCk7CiAgICAgICAgICAgIHJldHVybiBmd2MuZ2V0UmVzdWx0\nKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gYWxyZWFkeSBm\nZW5jZWQKICAgICAgICAgICAgcmV0dXJuIFNVQ0NFU1NfRlVUVVJFOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgQnl0ZUJ1ZmZlciByZWFkRW50cnko\nbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkKQogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIE5vTGVkZ2VyRXhjZXB0aW9uIHsKICAgICAgICBM\nZWRnZXJEZXNjcmlwdG9yIGhhbmRsZSA9IGhhbmRsZXMuZ2V0UmVhZE9ubHlI\nYW5kbGUobGVkZ2VySWQpOwogICAgICAgIExPRy50cmFjZSgiUmVhZGluZyB7\nfUB7fSIsIGVudHJ5SWQsIGxlZGdlcklkKTsKICAgICAgICByZXR1cm4gaGFu\nZGxlLnJlYWRFbnRyeShlbnRyeUlkKTsKICAgIH0KCiAgICAvLyBUaGUgcmVz\ndCBvZiB0aGUgY29kZSBpcyB0ZXN0IHN0dWZmCiAgICBzdGF0aWMgY2xhc3Mg\nQ291bnRlckNhbGxiYWNrIGltcGxlbWVudHMgV3JpdGVDYWxsYmFjayB7CiAg\nICAgICAgaW50IGNvdW50OwoKICAgICAgICBzeW5jaHJvbml6ZWQgcHVibGlj\nIHZvaWQgd3JpdGVDb21wbGV0ZShpbnQgcmMsIGxvbmcgbCwgbG9uZyBlLCBJ\nbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nICAgIGNvdW50LS07CiAgICAgICAgICAgIGlmIChjb3VudCA9PSAwKSB7CiAg\nICAgICAgICAgICAgICBub3RpZnlBbGwoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIGluY0Nv\ndW50KCkgewogICAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KCiAgICAg\nICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHdhaXRaZXJvKCkgdGhyb3dz\nIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgd2hpbGUgKGNv\ndW50ID4gMCkgewogICAgICAgICAgICAgICAgd2FpdCgpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRm9ybWF0IHRo\nZSBib29raWUgc2VydmVyIGRhdGEKICAgICAqIAogICAgICogQHBhcmFtIGNv\nbmYKICAgICAqICAgICAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbgogICAg\nICogQHBhcmFtIGlzSW50ZXJhY3RpdmUKICAgICAqICAgICAgICAgICAgV2hl\ndGhlciBmb3JtYXQgc2hvdWxkIGFzayBwcm9tcHQgZm9yIGNvbmZpcm1hdGlv\nbiBpZiBvbGQgZGF0YQogICAgICogICAgICAgICAgICBleGlzdHMgb3Igbm90\nLgogICAgICogQHBhcmFtIGZvcmNlCiAgICAgKiAgICAgICAgICAgIElmIG5v\nbiBpbnRlcmFjdGl2ZSBhbmQgZm9yY2UgaXMgdHJ1ZSwgdGhlbiBvbGQgZGF0\nYSB3aWxsIGJlCiAgICAgKiAgICAgICAgICAgIHJlbW92ZWQgd2l0aG91dCBj\nb25maXJtIHByb21wdC4KICAgICAqIEByZXR1cm4gUmV0dXJucyB0cnVlIGlm\nIHRoZSBmb3JtYXQgaXMgc3VjY2VzcyBlbHNlIHJldHVybnMgZmFsc2UKICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIGZvcm1hdChTZXJ2ZXJD\nb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgICAgIGJvb2xlYW4gaXNJbnRl\ncmFjdGl2ZSwgYm9vbGVhbiBmb3JjZSkgewogICAgICAgIEZpbGUgam91cm5h\nbERpciA9IGNvbmYuZ2V0Sm91cm5hbERpcigpOwogICAgICAgIGlmIChqb3Vy\nbmFsRGlyLmV4aXN0cygpICYmIGpvdXJuYWxEaXIuaXNEaXJlY3RvcnkoKQog\nICAgICAgICAgICAgICAgJiYgam91cm5hbERpci5saXN0KCkubGVuZ3RoICE9\nIDApIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGJvb2xl\nYW4gY29uZmlybSA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKCFpc0lu\ndGVyYWN0aXZlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm9uIGlu\ndGVyYWN0aXZlIGFuZCBmb3JjZSBpcyBzZXQsIHRoZW4gZGVsZXRlIG9sZAog\nICAgICAgICAgICAgICAgICAgIC8vIGRhdGEuCiAgICAgICAgICAgICAgICAg\nICAgaWYgKGZvcmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZp\ncm0gPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbmZpcm0gPSBmYWxzZTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgIGNvbmZpcm0gPSBJT1V0aWxzCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAuY29uZmlybVByb21wdCgiQXJlIHlvdSBzdXJlIHRv\nIGZvcm1hdCBCb29raWUgZGF0YS4uPyIpOwogICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIGlmICghY29uZmlybSkgewogICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiQm9va2llIGZvcm1hdCBhYm9ydGVkISEiKTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgZHVyaW5nIGJvb2tp\nZSBmb3JtYXQiLCBlKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWNsZWFuRGly\nKGpvdXJuYWxEaXIpKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRm9ybWF0\ndGluZyBqb3VybmFsIGRpcmVjdG9yeSBmYWlsZWQiKTsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgRmlsZVtdIGxlZGdl\nckRpcnMgPSBjb25mLmdldExlZGdlckRpcnMoKTsKICAgICAgICBmb3IgKEZp\nbGUgZGlyIDogbGVkZ2VyRGlycykgewogICAgICAgICAgICBpZiAoIWNsZWFu\nRGlyKGRpcikpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRm9ybWF0\ndGluZyBsZWRnZXIgZGlyZWN0b3J5ICIgKyBkaXIgKyAiIGZhaWxlZCIpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIExPRy5pbmZvKCJCb29raWUgZm9ybWF0IGNvbXBs\nZXRlZCBzdWNjZXNzZnVsbHkiKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIGNsZWFuRGlyKEZpbGUg\nZGlyKSB7CiAgICAgICAgaWYgKGRpci5leGlzdHMoKSkgewogICAgICAgICAg\nICBmb3IgKEZpbGUgY2hpbGQgOiBkaXIubGlzdEZpbGVzKCkpIHsKICAgICAg\nICAgICAgICAgIGJvb2xlYW4gZGVsZXRlID0gRmlsZVV0aWxzLmRlbGV0ZVF1\naWV0bHkoY2hpbGQpOwogICAgICAgICAgICAgICAgaWYgKCFkZWxldGUpIHsK\nICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIk5vdCBhYmxlIHRvIGRl\nbGV0ZSAiICsgY2hpbGQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSBpZiAoIWRpci5ta2RpcnMoKSkgewogICAgICAgICAgICBMT0cu\nZXJyb3IoIk5vdCBhYmxlIHRvIGNyZWF0ZSB0aGUgZGlyZWN0b3J5ICIgKyBk\naXIpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogQHBhcmFt\nIGFyZ3MKICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqIEB0aHJv\nd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgCiAgICAgICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJvb2tp\nZUV4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uIHsKICAgICAgICBCb29raWUg\nYiA9IG5ldyBCb29raWUobmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKSk7CiAg\nICAgICAgYi5zdGFydCgpOwogICAgICAgIENvdW50ZXJDYWxsYmFjayBjYiA9\nIG5ldyBDb3VudGVyQ2FsbGJhY2soKTsKICAgICAgICBsb25nIHN0YXJ0ID0g\nTWF0aFV0aWxzLm5vdygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nMTAwMDAwOyBpKyspIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBidWZmID0g\nQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgxMDI0KTsKICAgICAgICAgICAgYnVmZi5w\ndXRMb25nKDEpOwogICAgICAgICAgICBidWZmLnB1dExvbmcoaSk7CiAgICAg\nICAgICAgIGJ1ZmYubGltaXQoMTAyNCk7CiAgICAgICAgICAgIGJ1ZmYucG9z\naXRpb24oMCk7CiAgICAgICAgICAgIGNiLmluY0NvdW50KCk7CiAgICAgICAg\nICAgIGIuYWRkRW50cnkoYnVmZiwgY2IsIG51bGwsIG5ldyBieXRlWzBdKTsK\nICAgICAgICB9CiAgICAgICAgY2Iud2FpdFplcm8oKTsKICAgICAgICBsb25n\nIGVuZCA9IE1hdGhVdGlscy5ub3coKTsKICAgICAgICBTeXN0ZW0ub3V0LnBy\naW50bG4oIlRvb2sgIiArIChlbmQtc3RhcnQpICsgIm1zIik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm5zIGV4aXQgY29kZSAtIGNhdXNlIG9mIGZh\naWx1cmUKICAgICAqCiAgICAgKiBAcmV0dXJuIHtAbGluayBFeGl0Q29kZX0K\nICAgICAqLwogICAgcHVibGljIGludCBnZXRFeGl0Q29kZSgpIHsKICAgICAg\nICByZXR1cm4gZXhpdENvZGU7CiAgICB9Cn0K\n","encoding":"base64"}

