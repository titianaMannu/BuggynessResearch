{"sha":"af8b34d148ebd2a16083ff72d9ffceffbb3dabba","node_id":"MDQ6QmxvYjE1NzU5NTY6YWY4YjM0ZDE0OGViZDJhMTYwODNmZjcyZDlmZmNlZmZiYjNkYWJiYQ==","size":20923,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/af8b34d148ebd2a16083ff72d9ffceffbb3dabba","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8u\nQnVmZmVyZWRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBq\nYXZhLmlvLkZpbGVGaWx0ZXI7CmltcG9ydCBqYXZhLmlvLkZpbGVJbnB1dFN0\ncmVhbTsKaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5pby5GaWxlT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW1SZWFk\nZXI7CmltcG9ydCBqYXZhLmlvLk91dHB1dFN0cmVhbVdyaXRlcjsKaW1wb3J0\nIGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGphdmEubmlvLkJ5\ndGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxlQ2hhbm5l\nbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5NYXAuRW50cnk7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5Db25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNCb29sZWFuOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuQ29weU9uV3JpdGVBcnJheUxpc3Q7CgppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5\nOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuTGVkZ2Vy\nRGlyc01hbmFnZXIuTGVkZ2VyRGlyc0xpc3RlbmVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLklPVXRpbHM7CgovKioK\nICogVGhpcyBjbGFzcyBtYW5hZ2VzIHRoZSB3cml0aW5nIG9mIHRoZSBib29r\na2VlcGVyIGVudHJpZXMuIEFsbCB0aGUgbmV3CiAqIGVudHJpZXMgYXJlIHdy\naXR0ZW4gdG8gYSBjb21tb24gbG9nLiBUaGUgTGVkZ2VyQ2FjaGUgd2lsbCBo\nYXZlIHBvaW50ZXJzCiAqIGludG8gZmlsZXMgY3JlYXRlZCBieSB0aGlzIGNs\nYXNzIHdpdGggb2Zmc2V0cyBpbnRvIHRoZSBmaWxlcyB0byBmaW5kCiAqIHRo\nZSBhY3R1YWwgbGVkZ2VyIGVudHJ5LiBUaGUgZW50cnkgbG9nIGZpbGVzIGNy\nZWF0ZWQgYnkgdGhpcyBjbGFzcyBhcmUKICogaWRlbnRpZmllZCBieSBhIGxv\nbmcuCiAqLwpwdWJsaWMgY2xhc3MgRW50cnlMb2dnZXIgewogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0\nTG9nZ2VyKEVudHJ5TG9nZ2VyLmNsYXNzKTsKCiAgICB2b2xhdGlsZSBGaWxl\nIGN1cnJlbnREaXI7CiAgICBwcml2YXRlIExlZGdlckRpcnNNYW5hZ2VyIGxl\nZGdlckRpcnNNYW5hZ2VyOwogICAgcHJpdmF0ZSBBdG9taWNCb29sZWFuIHNo\nb3VsZENyZWF0ZU5ld0VudHJ5TG9nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFs\nc2UpOwoKICAgIHByaXZhdGUgbG9uZyBsb2dJZDsKCiAgICAvKioKICAgICAq\nIFRoZSBtYXhpbXVtIHNpemUgb2YgYSBlbnRyeSBsb2dnZXIgZmlsZS4KICAg\nICAqLwogICAgZmluYWwgbG9uZyBsb2dTaXplTGltaXQ7CiAgICBwcml2YXRl\nIHZvbGF0aWxlIEJ1ZmZlcmVkQ2hhbm5lbCBsb2dDaGFubmVsOwogICAgcHJp\ndmF0ZSBmaW5hbCBDb3B5T25Xcml0ZUFycmF5TGlzdDxFbnRyeUxvZ0xpc3Rl\nbmVyPiBsaXN0ZW5lcnMKICAgICAgICA9IG5ldyBDb3B5T25Xcml0ZUFycmF5\nTGlzdDxFbnRyeUxvZ0xpc3RlbmVyPigpOwogICAgLy8gdGhpcyBpbmRpY2F0\nZXMgdGhhdCBhIHdyaXRlIGhhcyBoYXBwZW5lZCBzaW5jZSB0aGUgbGFzdCBm\nbHVzaAogICAgcHJpdmF0ZSB2b2xhdGlsZSBib29sZWFuIHNvbWV0aGluZ1dy\naXR0ZW4gPSBmYWxzZTsKCiAgICAvKioKICAgICAqIFRoZSAxSyBibG9jayBh\ndCB0aGUgaGVhZCBvZiB0aGUgZW50cnkgbG9nZ2VyIGZpbGUKICAgICAqIHRo\nYXQgY29udGFpbnMgdGhlIGZpbmdlcnByaW50IGFuZCAoZnV0dXJlKSBtZXRh\nLWRhdGEKICAgICAqLwogICAgZmluYWwgc3RhdGljIGludCBMT0dGSUxFX0hF\nQURFUl9TSVpFID0gMTAyNDsKICAgIGZpbmFsIEJ5dGVCdWZmZXIgTE9HRklM\nRV9IRUFERVIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKExPR0ZJTEVfSEVBREVS\nX1NJWkUpOwoKICAgIGZpbmFsIHN0YXRpYyBpbnQgTUlOX1NBTkVfRU5UUllf\nU0laRSA9IDggKyA4OwogICAgZmluYWwgc3RhdGljIGxvbmcgTUIgPSAxMDI0\nICogMTAyNDsKCiAgICAvKioKICAgICAqIFNjYW4gZW50cmllcyBpbiBhIGVu\ndHJ5IGxvZyBmaWxlLgogICAgICovCiAgICBzdGF0aWMgaW50ZXJmYWNlIEVu\ndHJ5TG9nU2Nhbm5lciB7CiAgICAgICAgLyoqCiAgICAgICAgICogVGVzdHMg\nd2hldGhlciBvciBub3QgdGhlIGVudHJpZXMgYmVsb25ncyB0byB0aGUgc3Bl\nY2lmaWVkIGxlZGdlcgogICAgICAgICAqIHNob3VsZCBiZSBwcm9jZXNzZWQu\nCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAg\nICAgKiAgICAgICAgICBMZWRnZXIgSUQuCiAgICAgICAgICogQHJldHVybiB0\ncnVlIGlmIGFuZCBvbmx5IHRoZSBlbnRyaWVzIG9mIHRoZSBsZWRnZXIgc2hv\ndWxkIGJlIHNjYW5uZWQuCiAgICAgICAgICovCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gYWNjZXB0KGxvbmcgbGVkZ2VySWQpOwoKICAgICAgICAvKioKICAg\nICAgICAgKiBQcm9jZXNzIGFuIGVudHJ5LgogICAgICAgICAqCiAgICAgICAg\nICogQHBhcmFtIGxlZGdlcklkCiAgICAgICAgICogICAgICAgICAgTGVkZ2Vy\nIElELgogICAgICAgICAqIEBwYXJhbSBvZmZzZXQKICAgICAgICAgKiAgICAg\nICAgICBGaWxlIG9mZnNldCBvZiB0aGlzIGVudHJ5LgogICAgICAgICAqIEBw\nYXJhbSBlbnRyeQogICAgICAgICAqICAgICAgICAgIEVudHJ5IEJ5dGVCdWZm\nZXIKICAgICAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzcyhsb25nIGxlZGdlcklkLCBs\nb25nIG9mZnNldCwgQnl0ZUJ1ZmZlciBlbnRyeSkgdGhyb3dzIElPRXhjZXB0\naW9uOwogICAgfQoKICAgIC8qKgogICAgICogRW50cnkgTG9nIExpc3RlbmVy\nCiAgICAgKi8KICAgIHN0YXRpYyBpbnRlcmZhY2UgRW50cnlMb2dMaXN0ZW5l\nciB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsbGJhY2sgd2hlbiBlbnRy\neSBsb2cgaXMgZmx1c2hlZC4KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\ndm9pZCBvbkVudHJ5TG9nRmx1c2hlZCgpOwogICAgfQoKICAgIC8qKgogICAg\nICogQ3JlYXRlIGFuIEVudHJ5TG9nZ2VyIHRoYXQgc3RvcmVzIGl0J3MgbG9n\nIGZpbGVzIGluIHRoZSBnaXZlbgogICAgICogZGlyZWN0b3JpZXMKICAgICAq\nLwogICAgcHVibGljIEVudHJ5TG9nZ2VyKFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiwKICAgICAgICAgICAgTGVkZ2VyRGlyc01hbmFnZXIgbGVkZ2VyRGly\nc01hbmFnZXIpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5s\nZWRnZXJEaXJzTWFuYWdlciA9IGxlZGdlckRpcnNNYW5hZ2VyOwogICAgICAg\nIC8vIGxvZyBzaXplIGxpbWl0CiAgICAgICAgdGhpcy5sb2dTaXplTGltaXQg\nPSBjb25mLmdldEVudHJ5TG9nU2l6ZUxpbWl0KCk7CgogICAgICAgIC8vIElu\naXRpYWxpemUgdGhlIGVudHJ5IGxvZyBoZWFkZXIgYnVmZmVyLiBUaGlzIGNh\nbm5vdCBiZSBhIHN0YXRpYyBvYmplY3QKICAgICAgICAvLyBzaW5jZSBpbiBv\ndXIgdW5pdCB0ZXN0cywgd2UgcnVuIG11bHRpcGxlIEJvb2tpZXMgYW5kIHRo\ndXMgRW50cnlMb2dnZXJzCiAgICAgICAgLy8gd2l0aGluIHRoZSBzYW1lIEpW\nTS4gQWxsIG9mIHRoZXNlIEJvb2tpZSBpbnN0YW5jZXMgYWNjZXNzIHRoaXMg\naGVhZGVyCiAgICAgICAgLy8gc28gdGhlcmUgY2FuIGJlIHJhY2UgY29uZGl0\naW9ucyB3aGVuIGVudHJ5IGxvZ3MgYXJlIHJvbGxlZCBvdmVyIGFuZAogICAg\nICAgIC8vIHRoaXMgaGVhZGVyIGJ1ZmZlciBpcyBjbGVhcmVkIGJlZm9yZSB3\ncml0aW5nIGl0IGludG8gdGhlIG5ldyBsb2dDaGFubmVsLgogICAgICAgIExP\nR0ZJTEVfSEVBREVSLnB1dCgiQktMTyIuZ2V0Qnl0ZXMoKSk7CgogICAgICAg\nIC8vIEZpbmQgdGhlIGxhcmdlc3QgbG9nSWQKICAgICAgICBsb2dJZCA9IC0x\nOwogICAgICAgIGZvciAoRmlsZSBkaXIgOiBsZWRnZXJEaXJzTWFuYWdlci5n\nZXRBbGxMZWRnZXJEaXJzKCkpIHsKICAgICAgICAgICAgaWYgKCFkaXIuZXhp\nc3RzKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBGaWxlTm90Rm91\nbmRFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICJFbnRyeSBs\nb2cgZGlyZWN0b3J5IGRvZXMgbm90IGV4aXN0Iik7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgbG9uZyBsYXN0TG9nSWQgPSBnZXRMYXN0TG9nSWQoZGly\nKTsKICAgICAgICAgICAgaWYgKGxhc3RMb2dJZCA+IGxvZ0lkKSB7CiAgICAg\nICAgICAgICAgICBsb2dJZCA9IGxhc3RMb2dJZDsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgaW5pdGlhbGl6ZSgpOwogICAgfQoKICAgIHZv\naWQgYWRkTGlzdGVuZXIoRW50cnlMb2dMaXN0ZW5lciBsaXN0ZW5lcikgewog\nICAgICAgIGlmIChudWxsICE9IGxpc3RlbmVyKSB7CiAgICAgICAgICAgIGxp\nc3RlbmVycy5hZGQobGlzdGVuZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIE1hcHMgZW50cnkgbG9nIGZpbGVzIHRvIG9wZW4gY2hhbm5l\nbHMuCiAgICAgKi8KICAgIHByaXZhdGUgQ29uY3VycmVudEhhc2hNYXA8TG9u\nZywgQnVmZmVyZWRDaGFubmVsPiBjaGFubmVscyA9IG5ldyBDb25jdXJyZW50\nSGFzaE1hcDxMb25nLCBCdWZmZXJlZENoYW5uZWw+KCk7CgogICAgc3luY2hy\nb25pemVkIGxvbmcgZ2V0Q3VycmVudExvZ0lkKCkgewogICAgICAgIHJldHVy\nbiBsb2dJZDsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBpbml0aWFsaXpl\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAvLyBSZWdpc3RlciBs\naXN0ZW5lciBmb3IgZGlzayBmdWxsIG5vdGlmaWNhdGlvbnMuCiAgICAgICAg\nbGVkZ2VyRGlyc01hbmFnZXIuYWRkTGVkZ2VyRGlyc0xpc3RlbmVyKGdldExl\nZGdlckRpcnNMaXN0ZW5lcigpKTsKICAgICAgICAvLyBjcmVhdGUgYSBuZXcg\nbG9nIHRvIHdyaXRlCiAgICAgICAgY3JlYXRlTmV3TG9nKCk7CiAgICB9Cgog\nICAgcHJpdmF0ZSBMZWRnZXJEaXJzTGlzdGVuZXIgZ2V0TGVkZ2VyRGlyc0xp\nc3RlbmVyKCkgewogICAgICAgIHJldHVybiBuZXcgTGVkZ2VyRGlyc0xpc3Rl\nbmVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgZGlza0Z1bGwoRmlsZSBkaXNrKSB7CiAgICAgICAgICAgICAg\nICAvLyBJZiB0aGUgY3VycmVudCBlbnRyeSBsb2cgZGlzayBpcyBmdWxsLCB0\naGVuIGNyZWF0ZSBuZXcgZW50cnkKICAgICAgICAgICAgICAgIC8vIGxvZy4K\nICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RGlyICE9IG51bGwgJiYgY3Vy\ncmVudERpci5lcXVhbHMoZGlzaykpIHsKICAgICAgICAgICAgICAgICAgICBz\naG91bGRDcmVhdGVOZXdFbnRyeUxvZy5zZXQodHJ1ZSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBkaXNrRmFpbGVkKEZpbGUgZGlzaykg\newogICAgICAgICAgICAgICAgLy8gTm90aGluZyB0byBoYW5kbGUgaGVyZS4g\nV2lsbCBiZSBoYW5kbGVkIGluIEJvb2tpZQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgYWxs\nRGlza3NGdWxsKCkgewogICAgICAgICAgICAgICAgLy8gTm90aGluZyB0byBo\nYW5kbGUgaGVyZS4gV2lsbCBiZSBoYW5kbGVkIGluIEJvb2tpZQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgZmF0YWxFcnJvcigpIHsKICAgICAgICAgICAgICAgIC8vIE5v\ndGhpbmcgdG8gaGFuZGxlIGhlcmUuIFdpbGwgYmUgaGFuZGxlZCBpbiBCb29r\naWUKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDcmVhdGVzIGEgbmV3IGxvZyBmaWxlCiAgICAgKi8KICAgIHZvaWQg\nY3JlYXRlTmV3TG9nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAobG9nQ2hhbm5lbCAhPSBudWxsKSB7CiAgICAgICAgICAgIGxvZ0NoYW5u\nZWwuZmx1c2godHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICAvLyBJdCB3b3Vs\nZCBiZXR0ZXIgbm90IHRvIG92ZXJ3cml0ZSBleGlzdGluZyBlbnRyeSBsb2cg\nZmlsZXMKICAgICAgICBTdHJpbmcgbG9nRmlsZU5hbWUgPSBudWxsOwogICAg\nICAgIGRvIHsKICAgICAgICAgICAgbG9nRmlsZU5hbWUgPSBMb25nLnRvSGV4\nU3RyaW5nKCsrbG9nSWQpICsgIi5sb2ciOwogICAgICAgICAgICBmb3IgKEZp\nbGUgZGlyIDogbGVkZ2VyRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygp\nKSB7CiAgICAgICAgICAgICAgICBGaWxlIG5ld0xvZ0ZpbGUgPSBuZXcgRmls\nZShkaXIsIGxvZ0ZpbGVOYW1lKTsKICAgICAgICAgICAgICAgIGlmIChuZXdM\nb2dGaWxlLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLndh\ncm4oIkZvdW5kIGV4aXN0ZWQgZW50cnkgbG9nICIgKyBuZXdMb2dGaWxlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgIiB3aGVuIHRyeWluZyB0byBj\ncmVhdGUgaXQgYXMgYSBuZXcgbG9nLiIpOwogICAgICAgICAgICAgICAgICAg\nIGxvZ0ZpbGVOYW1lID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0g\nd2hpbGUgKGxvZ0ZpbGVOYW1lID09IG51bGwpOwoKICAgICAgICAvLyBVcGRh\ndGUgbGFzdCBsb2cgaWQgZmlyc3QKICAgICAgICBjdXJyZW50RGlyID0gbGVk\nZ2VyRGlyc01hbmFnZXIucGlja1JhbmRvbVdyaXRhYmxlRGlyKCk7CiAgICAg\nICAgc2V0TGFzdExvZ0lkKGN1cnJlbnREaXIsIGxvZ0lkKTsKCiAgICAgICAg\nRmlsZSBuZXdMb2dGaWxlID0gbmV3IEZpbGUoY3VycmVudERpciwgbG9nRmls\nZU5hbWUpOwogICAgICAgIGxvZ0NoYW5uZWwgPSBuZXcgQnVmZmVyZWRDaGFu\nbmVsKG5ldyBSYW5kb21BY2Nlc3NGaWxlKG5ld0xvZ0ZpbGUsICJydyIpLmdl\ndENoYW5uZWwoKSwgNjQqMTAyNCk7CiAgICAgICAgbG9nQ2hhbm5lbC53cml0\nZSgoQnl0ZUJ1ZmZlcikgTE9HRklMRV9IRUFERVIuY2xlYXIoKSk7CiAgICAg\nICAgY2hhbm5lbHMucHV0KGxvZ0lkLCBsb2dDaGFubmVsKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlbW92ZSBlbnRyeSBsb2cuCiAgICAgKgogICAgICog\nQHBhcmFtIGVudHJ5TG9nSWQKICAgICAqICAgICAgICAgIEVudHJ5IExvZyBG\naWxlIElkCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIHJlbW92ZUVu\ndHJ5TG9nKGxvbmcgZW50cnlMb2dJZCkgewogICAgICAgIEJ1ZmZlcmVkQ2hh\nbm5lbCBiYyA9IGNoYW5uZWxzLnJlbW92ZShlbnRyeUxvZ0lkKTsKICAgICAg\nICBpZiAobnVsbCAhPSBiYykgewogICAgICAgICAgICAvLyBjbG9zZSBpdHMg\ndW5kZXJseWluZyBmaWxlIGNoYW5uZWwsIHNvIGl0IGNvdWxkIGJlIGRlbGV0\nZWQgcmVhbGx5CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBi\nYy5nZXRGaWxlQ2hhbm5lbCgpLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKElPRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICBMT0cud2Fy\nbigiRXhjZXB0aW9uIHdoaWxlIGNsb3NpbmcgZ2FyYmFnZSBjb2xsZWN0ZWQg\nZW50cnlMb2cgZmlsZSA6ICIsIGllKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBGaWxlIGVudHJ5TG9nRmlsZTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBlbnRyeUxvZ0ZpbGUgPSBmaW5kRmlsZShlbnRyeUxvZ0lk\nKTsKICAgICAgICB9IGNhdGNoIChGaWxlTm90Rm91bmRFeGNlcHRpb24gZSkg\newogICAgICAgICAgICBMT0cuZXJyb3IoIlRyeWluZyB0byBkZWxldGUgYW4g\nZW50cnlMb2cgZmlsZSB0aGF0IGNvdWxkIG5vdCBiZSBmb3VuZDogIgogICAg\nICAgICAgICAgICAgICAgICsgZW50cnlMb2dJZCArICIubG9nIik7CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFl\nbnRyeUxvZ0ZpbGUuZGVsZXRlKCkpIHsKICAgICAgICAgICAgTE9HLndhcm4o\nIkNvdWxkIG5vdCBkZWxldGUgZW50cnkgbG9nIGZpbGUge30iLCBlbnRyeUxv\nZ0ZpbGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICAvKioKICAgICAqIHdyaXRlcyB0aGUgZ2l2ZW4gaWQgdG8gdGhlICJs\nYXN0SWQiIGZpbGUgaW4gdGhlIGdpdmVuIGRpcmVjdG9yeS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHNldExhc3RMb2dJZChGaWxlIGRpciwgbG9uZyBs\nb2dJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlT3V0cHV0\nU3RyZWFtIGZvczsKICAgICAgICBmb3MgPSBuZXcgRmlsZU91dHB1dFN0cmVh\nbShuZXcgRmlsZShkaXIsICJsYXN0SWQiKSk7CiAgICAgICAgQnVmZmVyZWRX\ncml0ZXIgYncgPSBuZXcgQnVmZmVyZWRXcml0ZXIobmV3IE91dHB1dFN0cmVh\nbVdyaXRlcihmb3MpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBidy53\ncml0ZShMb25nLnRvSGV4U3RyaW5nKGxvZ0lkKSArICJcbiIpOwogICAgICAg\nICAgICBidy5mbHVzaCgpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBidy5jbG9zZSgpOwogICAgICAg\nICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBsb25nIGdldExhc3RMb2dJ\nZChGaWxlIGRpcikgewogICAgICAgIGxvbmcgaWQgPSByZWFkTGFzdExvZ0lk\nKGRpcik7CiAgICAgICAgLy8gcmVhZCBzdWNjZXNzCiAgICAgICAgaWYgKGlk\nID4gMCkgewogICAgICAgICAgICByZXR1cm4gaWQ7CiAgICAgICAgfQogICAg\nICAgIC8vIHJlYWQgZmFpbGVkLCBzY2FuIHRoZSBsZWRnZXIgZGlyZWN0b3Jp\nZXMgdG8gZmluZCBiaWdnZXN0IGxvZyBpZAogICAgICAgIEZpbGVbXSBsb2dG\naWxlcyA9IGRpci5saXN0RmlsZXMobmV3IEZpbGVGaWx0ZXIoKSB7CiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBh\nY2NlcHQoRmlsZSBmaWxlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmls\nZS5nZXROYW1lKCkuZW5kc1dpdGgoIi5sb2ciKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0pOwogICAgICAgIExpc3Q8TG9uZz4gbG9ncyA9IG5ldyBBcnJh\neUxpc3Q8TG9uZz4oKTsKICAgICAgICBmb3IgKEZpbGUgbGYgOiBsb2dGaWxl\ncykgewogICAgICAgICAgICBTdHJpbmcgaWRTdHJpbmcgPSBsZi5nZXROYW1l\nKCkuc3BsaXQoIlxcLiIpWzBdOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgbG9uZyBsaWQgPSBMb25nLnBhcnNlTG9uZyhpZFN0cmluZywg\nMTYpOwogICAgICAgICAgICAgICAgbG9ncy5hZGQobGlkKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0aW9uIG5mZSkgewogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIG5vIGxvZyBmaWxlIGZv\ndW5kIGluIHRoaXMgZGlyZWN0b3J5CiAgICAgICAgaWYgKDAgPT0gbG9ncy5z\naXplKCkpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0KICAg\nICAgICAvLyBvcmRlciB0aGUgY29sbGVjdGlvbnMKICAgICAgICBDb2xsZWN0\naW9ucy5zb3J0KGxvZ3MpOwogICAgICAgIHJldHVybiBsb2dzLmdldChsb2dz\nLnNpemUoKSAtIDEpOwogICAgfQoKICAgIC8qKgogICAgICogcmVhZHMgaWQg\nZnJvbSB0aGUgImxhc3RJZCIgZmlsZSBpbiB0aGUgZ2l2ZW4gZGlyZWN0b3J5\nLgogICAgICovCiAgICBwcml2YXRlIGxvbmcgcmVhZExhc3RMb2dJZChGaWxl\nIGYpIHsKICAgICAgICBGaWxlSW5wdXRTdHJlYW0gZmlzOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGZpcyA9IG5ldyBGaWxlSW5wdXRTdHJlYW0obmV3\nIEZpbGUoZiwgImxhc3RJZCIpKTsKICAgICAgICB9IGNhdGNoIChGaWxlTm90\nRm91bmRFeGNlcHRpb24gZSkgewogICAgICAgICAgICByZXR1cm4gLTE7CiAg\nICAgICAgfQogICAgICAgIEJ1ZmZlcmVkUmVhZGVyIGJyID0gbmV3IEJ1ZmZl\ncmVkUmVhZGVyKG5ldyBJbnB1dFN0cmVhbVJlYWRlcihmaXMpKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBTdHJpbmcgbGFzdElkU3RyaW5nID0gYnIu\ncmVhZExpbmUoKTsKICAgICAgICAgICAgcmV0dXJuIExvbmcucGFyc2VMb25n\nKGxhc3RJZFN0cmluZywgMTYpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0gY2F0\nY2goTnVtYmVyRm9ybWF0RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgcmV0\ndXJuIC0xOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBici5jbG9zZSgpOwogICAgICAgICAgICB9IGNh\ndGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgc3luY2hyb25pemVkIHZvaWQgZmx1c2goKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIGlmIChsb2dDaGFubmVsICE9IG51bGwp\nIHsKICAgICAgICAgICAgbG9nQ2hhbm5lbC5mbHVzaCh0cnVlKTsKICAgICAg\nICB9CiAgICAgICAgc29tZXRoaW5nV3JpdHRlbiA9IGZhbHNlOwogICAgICAg\nIGZvciAoRW50cnlMb2dMaXN0ZW5lciBsaXN0ZW5lcjogbGlzdGVuZXJzKSB7\nCiAgICAgICAgICAgIGxpc3RlbmVyLm9uRW50cnlMb2dGbHVzaGVkKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIGJvb2xlYW4gaXNGbHVzaFJlcXVpcmVkKCkg\newogICAgICAgIHJldHVybiBzb21ldGhpbmdXcml0dGVuOwogICAgfQoKICAg\nIHN5bmNocm9uaXplZCBsb25nIGFkZEVudHJ5KGxvbmcgbGVkZ2VyLCBCeXRl\nQnVmZmVyIGVudHJ5KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIC8v\nIENyZWF0ZSBuZXcgbG9nIGlmIGxvZ1NpemVMaW1pdCByZWFjaGVkIG9yIGN1\ncnJlbnQgZGlzayBpcyBmdWxsCiAgICAgICAgYm9vbGVhbiBjcmVhdGVOZXdM\nb2cgPSBzaG91bGRDcmVhdGVOZXdFbnRyeUxvZy5nZXQoKTsKICAgICAgICBp\nZiAoY3JlYXRlTmV3TG9nCiAgICAgICAgICAgICAgICB8fCAobG9nQ2hhbm5l\nbC5wb3NpdGlvbigpICsgZW50cnkucmVtYWluaW5nKCkgKyA0ID4gbG9nU2l6\nZUxpbWl0KSkgewogICAgICAgICAgICBjcmVhdGVOZXdMb2coKTsKCiAgICAg\nICAgICAgIC8vIFJlc2V0IHRoZSBmbGFnCiAgICAgICAgICAgIGlmIChjcmVh\ndGVOZXdMb2cpIHsKICAgICAgICAgICAgICAgIHNob3VsZENyZWF0ZU5ld0Vu\ndHJ5TG9nLnNldChmYWxzZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgQnl0ZUJ1ZmZlciBidWZmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0\nKTsKICAgICAgICBidWZmLnB1dEludChlbnRyeS5yZW1haW5pbmcoKSk7CiAg\nICAgICAgYnVmZi5mbGlwKCk7CiAgICAgICAgbG9nQ2hhbm5lbC53cml0ZShi\ndWZmKTsKICAgICAgICBsb25nIHBvcyA9IGxvZ0NoYW5uZWwucG9zaXRpb24o\nKTsKICAgICAgICBsb2dDaGFubmVsLndyaXRlKGVudHJ5KTsKICAgICAgICAv\nL2xvZ0NoYW5uZWwuZmx1c2goZmFsc2UpOwoKICAgICAgICBzb21ldGhpbmdX\ncml0dGVuID0gdHJ1ZTsKCiAgICAgICAgcmV0dXJuIChsb2dJZCA8PCAzMkwp\nIHwgcG9zOwogICAgfQoKICAgIGJ5dGVbXSByZWFkRW50cnkobG9uZyBsZWRn\nZXJJZCwgbG9uZyBlbnRyeUlkLCBsb25nIGxvY2F0aW9uKSB0aHJvd3MgSU9F\neGNlcHRpb24sIEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIHsKICAgICAgICBs\nb25nIGVudHJ5TG9nSWQgPSBsb2NhdGlvbiA+PiAzMkw7CiAgICAgICAgbG9u\nZyBwb3MgPSBsb2NhdGlvbiAmIDB4ZmZmZmZmZmZMOwogICAgICAgIEJ5dGVC\ndWZmZXIgc2l6ZUJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAg\nICAgIHBvcyAtPSA0OyAvLyB3ZSB3YW50IHRvIGdldCB0aGUgbGVkZ2VySWQg\nYW5kIGxlbmd0aCB0byBjaGVjawogICAgICAgIEJ1ZmZlcmVkQ2hhbm5lbCBm\nYzsKICAgICAgICB0cnkgewogICAgICAgICAgICBmYyA9IGdldENoYW5uZWxG\nb3JMb2dJZChlbnRyeUxvZ0lkKTsKICAgICAgICB9IGNhdGNoIChGaWxlTm90\nRm91bmRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBGaWxlTm90Rm91bmRF\neGNlcHRpb24gbmV3ZSA9IG5ldyBGaWxlTm90Rm91bmRFeGNlcHRpb24oZS5n\nZXRNZXNzYWdlKCkgKyAiIGZvciAiICsgbGVkZ2VySWQgKyAiIHdpdGggbG9j\nYXRpb24gIiArIGxvY2F0aW9uKTsKICAgICAgICAgICAgbmV3ZS5zZXRTdGFj\na1RyYWNlKGUuZ2V0U3RhY2tUcmFjZSgpKTsKICAgICAgICAgICAgdGhyb3cg\nbmV3ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGZjLnJlYWQoc2l6ZUJ1ZmYs\nIHBvcykgIT0gc2l6ZUJ1ZmYuY2FwYWNpdHkoKSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgQm9va2llLk5vRW50cnlFeGNlcHRpb24oIlNob3J0IHJlYWQg\nZnJvbSBlbnRyeWxvZyAiICsgZW50cnlMb2dJZCwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcklkLCBlbnRy\neUlkKTsKICAgICAgICB9CiAgICAgICAgcG9zICs9IDQ7CiAgICAgICAgc2l6\nZUJ1ZmYuZmxpcCgpOwogICAgICAgIGludCBlbnRyeVNpemUgPSBzaXplQnVm\nZi5nZXRJbnQoKTsKICAgICAgICAvLyBlbnRyeVNpemUgZG9lcyBub3QgaW5j\nbHVkZSB0aGUgbGVkZ2VySWQKICAgICAgICBpZiAoZW50cnlTaXplID4gTUIp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJTYW5pdHkgY2hlY2sgZmFpbGVk\nIGZvciBlbnRyeSBzaXplIG9mICIgKyBlbnRyeVNpemUgKyAiIGF0IGxvY2F0\naW9uICIgKyBwb3MgKyAiIGluICIgKyBlbnRyeUxvZ0lkKTsKCiAgICAgICAg\nfQogICAgICAgIGlmIChlbnRyeVNpemUgPCBNSU5fU0FORV9FTlRSWV9TSVpF\nKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiUmVhZCBpbnZhbGlkIGVudHJ5\nIGxlbmd0aCB7fSIsIGVudHJ5U2l6ZSk7CiAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbigiSW52YWxpZCBlbnRyeSBsZW5ndGggIiArIGVudHJ5\nU2l6ZSk7CiAgICAgICAgfQogICAgICAgIGJ5dGUgZGF0YVtdID0gbmV3IGJ5\ndGVbZW50cnlTaXplXTsKICAgICAgICBCeXRlQnVmZmVyIGJ1ZmYgPSBCeXRl\nQnVmZmVyLndyYXAoZGF0YSk7CiAgICAgICAgaW50IHJjID0gZmMucmVhZChi\ndWZmLCBwb3MpOwogICAgICAgIGlmICggcmMgIT0gZGF0YS5sZW5ndGgpIHsK\nICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRocm93aW5nIE5vRW50cnlFeGNl\ncHRpb24gaGVyZSBpbnN0ZWFkIG9mIElPRXhjZXB0aW9uIGlzIG5vdAogICAg\nICAgICAgICAvLyB3aXRob3V0IHJpc2suIElmIGFsbCBib29raWVzIGluIGEg\ncXVvcnVtIHRocm93IHRoaXMgc2FtZSBleGNlcHRpb24KICAgICAgICAgICAg\nLy8gdGhlIGNsaWVudCB3aWxsIGFzc3VtZSB0aGF0IGl0IGhhcyByZWFjaGVk\nIHRoZSBlbmQgb2YgdGhlIGxlZGdlci4KICAgICAgICAgICAgLy8gSG93ZXZl\nciwgdGhpcyBtYXkgbm90IGJlIHRoZSBjYXNlLCBhcyBhIHZlcnkgc3BlY2lm\naWMgZXJyb3IgY29uZGl0aW9uCiAgICAgICAgICAgIC8vIGNvdWxkIGhhdmUg\nb2NjdXJyZWQsIHdoZXJlIHRoZSBsZW5ndGggb2YgdGhlIGVudHJ5IHdhcyBj\nb3JydXB0ZWQgb24gYWxsCiAgICAgICAgICAgIC8vIHJlcGxpY2FzLiBIb3dl\ndmVyLCB0aGUgY2hhbmNlIG9mIHRoaXMgaGFwcGVuaW5nIGlzIHZlcnkgdmVy\neSBsb3csIHNvCiAgICAgICAgICAgIC8vIHJldHVybmluZyBOb0VudHJ5RXhj\nZXB0aW9uIGlzIG1vc3RseSBzYWZlLgogICAgICAgICAgICB0aHJvdyBuZXcg\nQm9va2llLk5vRW50cnlFeGNlcHRpb24oIlNob3J0IHJlYWQgZm9yICIgKyBs\nZWRnZXJJZCArICJAIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKyBlbnRyeUlkICsgIiBpbiAiICsgZW50cnlMb2dJ\nZCArICJAIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyBwb3MgKyAiKCIrcmMrIiE9IitkYXRhLmxlbmd0aCsiKSIs\nIGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAgICB9CiAgICAgICAgYnVmZi5m\nbGlwKCk7CiAgICAgICAgbG9uZyB0aGlzTGVkZ2VySWQgPSBidWZmLmdldExv\nbmcoKTsKICAgICAgICBpZiAodGhpc0xlZGdlcklkICE9IGxlZGdlcklkKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigicHJvYmxlbSBm\nb3VuZCBpbiAiICsgZW50cnlMb2dJZCArICJAIiArIGVudHJ5SWQgKyAiIGF0\nIHBvc2l0aW9uICsgIiArIHBvcyArICIgZW50cnkgYmVsb25ncyB0byAiICsg\ndGhpc0xlZGdlcklkICsgIiBub3QgIiArIGxlZGdlcklkKTsKICAgICAgICB9\nCiAgICAgICAgbG9uZyB0aGlzRW50cnlJZCA9IGJ1ZmYuZ2V0TG9uZygpOwog\nICAgICAgIGlmICh0aGlzRW50cnlJZCAhPSBlbnRyeUlkKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigicHJvYmxlbSBmb3VuZCBpbiAi\nICsgZW50cnlMb2dJZCArICJAIiArIGVudHJ5SWQgKyAiIGF0IHBvc2l0aW9u\nICsgIiArIHBvcyArICIgZW50cnkgaXMgIiArIHRoaXNFbnRyeUlkICsgIiBu\nb3QgIiArIGVudHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRh\ndGE7CiAgICB9CgogICAgcHJpdmF0ZSBCdWZmZXJlZENoYW5uZWwgZ2V0Q2hh\nbm5lbEZvckxvZ0lkKGxvbmcgZW50cnlMb2dJZCkgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICBCdWZmZXJlZENoYW5uZWwgZmMgPSBjaGFubmVscy5n\nZXQoZW50cnlMb2dJZCk7CiAgICAgICAgaWYgKGZjICE9IG51bGwpIHsKICAg\nICAgICAgICAgcmV0dXJuIGZjOwogICAgICAgIH0KICAgICAgICBGaWxlIGZp\nbGUgPSBmaW5kRmlsZShlbnRyeUxvZ0lkKTsKICAgICAgICAvLyBnZXQgY2hh\nbm5lbCBpcyB1c2VkIHRvIG9wZW4gYW4gZXhpc3RpbmcgZW50cnkgbG9nIGZp\nbGUKICAgICAgICAvLyBpdCB3b3VsZCBiZSBiZXR0ZXIgdG8gb3BlbiB1c2lu\nZyByZWFkIG1vZGUKICAgICAgICBGaWxlQ2hhbm5lbCBuZXdGYyA9IG5ldyBS\nYW5kb21BY2Nlc3NGaWxlKGZpbGUsICJyIikuZ2V0Q2hhbm5lbCgpOwogICAg\nICAgIC8vIElmIHRoZSBmaWxlIGFscmVhZHkgZXhpc3RzIGJlZm9yZSBjcmVh\ndGluZyBhIEJ1ZmZlcmVkQ2hhbm5lbCBsYXllciBhYm92ZSBpdCwKICAgICAg\nICAvLyBzZXQgdGhlIEZpbGVDaGFubmVsJ3MgcG9zaXRpb24gdG8gdGhlIGVu\nZCBzbyB0aGUgd3JpdGUgYnVmZmVyIGtub3dzIHdoZXJlIHRvIHN0YXJ0Lgog\nICAgICAgIG5ld0ZjLnBvc2l0aW9uKG5ld0ZjLnNpemUoKSk7CiAgICAgICAg\nZmMgPSBuZXcgQnVmZmVyZWRDaGFubmVsKG5ld0ZjLCA4MTkyKTsKCiAgICAg\nICAgQnVmZmVyZWRDaGFubmVsIG9sZGZjID0gY2hhbm5lbHMucHV0SWZBYnNl\nbnQoZW50cnlMb2dJZCwgZmMpOwogICAgICAgIGlmIChvbGRmYyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIG5ld0ZjLmNsb3NlKCk7CiAgICAgICAgICAgIHJl\ndHVybiBvbGRmYzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1\ncm4gZmM7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2hldGhl\nciB0aGUgbG9nIGZpbGUgZXhpc3RzIG9yIG5vdC4KICAgICAqLwogICAgYm9v\nbGVhbiBsb2dFeGlzdHMobG9uZyBsb2dJZCkgewogICAgICAgIGZvciAoRmls\nZSBkIDogbGVkZ2VyRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7\nCiAgICAgICAgICAgIEZpbGUgZiA9IG5ldyBGaWxlKGQsIExvbmcudG9IZXhT\ndHJpbmcobG9nSWQpICsgIi5sb2ciKTsKICAgICAgICAgICAgaWYgKGYuZXhp\nc3RzKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICBwcml2YXRlIEZpbGUgZmluZEZpbGUobG9uZyBsb2dJZCkgdGhyb3dz\nIEZpbGVOb3RGb3VuZEV4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChGaWxlIGQg\nOiBsZWRnZXJEaXJzTWFuYWdlci5nZXRBbGxMZWRnZXJEaXJzKCkpIHsKICAg\nICAgICAgICAgRmlsZSBmID0gbmV3IEZpbGUoZCwgTG9uZy50b0hleFN0cmlu\nZyhsb2dJZCkrIi5sb2ciKTsKICAgICAgICAgICAgaWYgKGYuZXhpc3RzKCkp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBmOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHRocm93IG5ldyBGaWxlTm90Rm91bmRFeGNlcHRp\nb24oIk5vIGZpbGUgZm9yIGxvZyAiICsgTG9uZy50b0hleFN0cmluZyhsb2dJ\nZCkpOwogICAgfQoKICAgIC8qKgogICAgICogU2NhbiBlbnRyeSBsb2cKICAg\nICAqCiAgICAgKiBAcGFyYW0gZW50cnlMb2dJZAogICAgICogICAgICAgICAg\nRW50cnkgTG9nIElkCiAgICAgKiBAcGFyYW0gc2Nhbm5lcgogICAgICogICAg\nICAgICAgRW50cnkgTG9nIFNjYW5uZXIKICAgICAqIEB0aHJvd3MgSU9FeGNl\ncHRpb24KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc2NhbkVudHJ5TG9n\nKGxvbmcgZW50cnlMb2dJZCwgRW50cnlMb2dTY2FubmVyIHNjYW5uZXIpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZUJ1ZmZlciBzaXplQnVm\nZiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgQnl0ZUJ1ZmZl\nciBsaWRCdWZmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg4KTsKICAgICAgICBC\ndWZmZXJlZENoYW5uZWwgYmM7CiAgICAgICAgLy8gR2V0IHRoZSBCdWZmZXJl\nZENoYW5uZWwgZm9yIHRoZSBjdXJyZW50IGVudHJ5IGxvZyBmaWxlCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYmMgPSBnZXRDaGFubmVsRm9yTG9nSWQo\nZW50cnlMb2dJZCk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkg\newogICAgICAgICAgICBMT0cud2FybigiRmFpbGVkIHRvIGdldCBjaGFubmVs\nIHRvIHNjYW4gZW50cnkgbG9nOiAiICsgZW50cnlMb2dJZCArICIubG9nIik7\nCiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgICAgIC8vIFN0\nYXJ0IHRoZSByZWFkIHBvc2l0aW9uIGluIHRoZSBjdXJyZW50IGVudHJ5IGxv\nZyBmaWxlIHRvIGJlIGFmdGVyCiAgICAgICAgLy8gdGhlIGhlYWRlciB3aGVy\nZSBhbGwgb2YgdGhlIGxlZGdlciBlbnRyaWVzIGFyZS4KICAgICAgICBsb25n\nIHBvcyA9IExPR0ZJTEVfSEVBREVSX1NJWkU7CiAgICAgICAgLy8gUmVhZCB0\naHJvdWdoIHRoZSBlbnRyeSBsb2cgZmlsZSBhbmQgZXh0cmFjdCB0aGUgbGVk\nZ2VyIElEJ3MuCiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAg\nLy8gQ2hlY2sgaWYgd2UndmUgZmluaXNoZWQgcmVhZGluZyB0aGUgZW50cnkg\nbG9nIGZpbGUuCiAgICAgICAgICAgIGlmIChwb3MgPj0gYmMuc2l6ZSgpKSB7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBpZiAoYmMucmVhZChzaXplQnVmZiwgcG9zKSAhPSBzaXplQnVmZi5j\nYXBhY2l0eSgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oIlNob3J0IHJlYWQgZm9yIGVudHJ5IHNpemUgZnJvbSBlbnRyeWxv\nZyAiICsgZW50cnlMb2dJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nbG9uZyBvZmZzZXQgPSBwb3M7CiAgICAgICAgICAgIHBvcyArPSA0OwogICAg\nICAgICAgICBzaXplQnVmZi5mbGlwKCk7CiAgICAgICAgICAgIGludCBlbnRy\neVNpemUgPSBzaXplQnVmZi5nZXRJbnQoKTsKICAgICAgICAgICAgaWYgKGVu\ndHJ5U2l6ZSA+IE1CKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRm91\nbmQgbGFyZ2Ugc2l6ZSBlbnRyeSBvZiAiICsgZW50cnlTaXplICsgIiBhdCBs\nb2NhdGlvbiAiICsgcG9zICsgIiBpbiAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICsgZW50cnlMb2dJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nc2l6ZUJ1ZmYuY2xlYXIoKTsKICAgICAgICAgICAgLy8gdHJ5IHRvIHJlYWQg\nbGVkZ2VyIGlkIGZpcnN0CiAgICAgICAgICAgIGlmIChiYy5yZWFkKGxpZEJ1\nZmYsIHBvcykgIT0gbGlkQnVmZi5jYXBhY2l0eSgpKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlNob3J0IHJlYWQgZm9yIGxl\nZGdlciBpZCBmcm9tIGVudHJ5bG9nICIgKyBlbnRyeUxvZ0lkKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBsaWRCdWZmLmZsaXAoKTsKICAgICAgICAg\nICAgbG9uZyBsaWQgPSBsaWRCdWZmLmdldExvbmcoKTsKICAgICAgICAgICAg\nbGlkQnVmZi5jbGVhcigpOwogICAgICAgICAgICBpZiAoIXNjYW5uZXIuYWNj\nZXB0KGxpZCkpIHsKICAgICAgICAgICAgICAgIC8vIHNraXAgdGhpcyBlbnRy\neQogICAgICAgICAgICAgICAgcG9zICs9IGVudHJ5U2l6ZTsKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8v\nIHJlYWQgdGhlIGVudHJ5CiAgICAgICAgICAgIGJ5dGUgZGF0YVtdID0gbmV3\nIGJ5dGVbZW50cnlTaXplXTsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBidWZm\nID0gQnl0ZUJ1ZmZlci53cmFwKGRhdGEpOwogICAgICAgICAgICBpbnQgcmMg\nPSBiYy5yZWFkKGJ1ZmYsIHBvcyk7CiAgICAgICAgICAgIGlmIChyYyAhPSBk\nYXRhLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKCJTaG9ydCByZWFkIGZvciBsZWRnZXIgZW50cnkgZnJvbSBlbnRy\neUxvZyAiICsgZW50cnlMb2dJZAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICJAIiArIHBvcyArICIoIiArIHJjICsgIiE9IiArIGRh\ndGEubGVuZ3RoICsgIikiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBi\ndWZmLmZsaXAoKTsKICAgICAgICAgICAgLy8gcHJvY2VzcyB0aGUgZW50cnkK\nICAgICAgICAgICAgc2Nhbm5lci5wcm9jZXNzKGxpZCwgb2Zmc2V0LCBidWZm\nKTsKICAgICAgICAgICAgLy8gQWR2YW5jZSBwb3NpdGlvbiB0byB0aGUgbmV4\ndCBlbnRyeQogICAgICAgICAgICBwb3MgKz0gZW50cnlTaXplOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNodXRkb3duIG1ldGhvZCB0byBn\ncmFjZWZ1bGx5IHN0b3AgZW50cnkgbG9nZ2VyLgogICAgICovCiAgICBwdWJs\naWMgdm9pZCBzaHV0ZG93bigpIHsKICAgICAgICAvLyBzaW5jZSBsb2dDaGFu\nbmVsIGlzIGJ1ZmZlcmVkIGNoYW5uZWwsIGRvIGZsdXNoIHdoZW4gc2h1dHRp\nbmcgZG93bgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZsdXNoKCk7CiAg\nICAgICAgICAgIGZvciAoRW50cnk8TG9uZywgQnVmZmVyZWRDaGFubmVsPiBj\naGFubmVsRW50cnkgOiBjaGFubmVscwogICAgICAgICAgICAgICAgICAgIC5l\nbnRyeVNldCgpKSB7CiAgICAgICAgICAgICAgICBjaGFubmVsRW50cnkuZ2V0\nVmFsdWUoKS5nZXRGaWxlQ2hhbm5lbCgpLmNsb3NlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpZSkgewogICAgICAg\nICAgICAvLyB3ZSBoYXZlIG5vIGlkZWEgaG93IHRvIGF2b2lkIGlvIGV4Y2Vw\ndGlvbiBkdXJpbmcgc2h1dHRpbmcgZG93biwgc28ganVzdCBpZ25vcmUgaXQK\nICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBmbHVzaCBlbnRyeSBsb2cg\nZHVyaW5nIHNodXR0aW5nIGRvd24sIHdoaWNoIG1heSBjYXVzZSBlbnRyeSBs\nb2cgY29ycnVwdGVkLiIsIGllKTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBmb3IgKEVudHJ5PExvbmcsIEJ1ZmZlcmVkQ2hhbm5lbD4gY2hh\nbm5lbEVudHJ5IDogY2hhbm5lbHMKICAgICAgICAgICAgICAgICAgICAuZW50\ncnlTZXQoKSkgewogICAgICAgICAgICAgICAgRmlsZUNoYW5uZWwgZmlsZUNo\nYW5uZWwgPSBjaGFubmVsRW50cnkuZ2V0VmFsdWUoKQogICAgICAgICAgICAg\nICAgICAgICAgICAuZ2V0RmlsZUNoYW5uZWwoKTsKICAgICAgICAgICAgICAg\nIGlmIChmaWxlQ2hhbm5lbC5pc09wZW4oKSkgewogICAgICAgICAgICAgICAg\nICAgIElPVXRpbHMuY2xvc2UoTE9HLCBmaWxlQ2hhbm5lbCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgp9Cg==\n","encoding":"base64"}

