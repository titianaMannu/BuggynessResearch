{"sha":"1a0e8eb9c3dce677f0ec3237ec00c001909f7a97","node_id":"MDQ6QmxvYjE1NzU5NTY6MWEwZThlYjljM2RjZTY3N2YwZWMzMjM3ZWMwMGMwMDE5MDlmN2E5Nw==","size":12002,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1a0e8eb9c3dce677f0ec3237ec00c001909f7a97","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5CdWZmZXJVbmRl\ncmZsb3dFeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxl\nQ2hhbm5lbDsKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLmFubm90YXRpb25z\nLlZpc2libGVGb3JUZXN0aW5nOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUaGlz\nIGlzIHRoZSBmaWxlIGhhbmRsZSBmb3IgYSBsZWRnZXIncyBpbmRleCBmaWxl\nIHRoYXQgbWFwcyBlbnRyeSBpZHMgdG8gbG9jYXRpb24uCiAqIEl0IGlzIHVz\nZWQgYnkgTGVkZ2VyQ2FjaGUuCiAqCiAqIDxwPgogKiBMZWRnZXIgaW5kZXgg\nZmlsZSBpcyBtYWRlIG9mIGEgaGVhZGVyIGFuZCBzZXZlcmFsIGZpeGVkLWxl\nbmd0aCBpbmRleCBwYWdlcywgd2hpY2ggcmVjb3JkcyB0aGUgb2Zmc2V0cyBv\nZiBkYXRhIHN0b3JlZCBpbiBlbnRyeSBsb2dnZXJzCiAqIDxwcmU+Jmx0O2hl\nYWRlciZndDsmbHQ7aW5kZXggcGFnZXMmZ3Q7PC9wcmU+CiAqIDxiPkhlYWRl\ncjwvYj4gaXMgZm9ybWF0ZWQgYXMgYmVsb3c6CiAqIDxwcmU+Jmx0O21hZ2lj\nIGJ5dGVzJmd0OyZsdDtsZW4gb2YgbWFzdGVyIGtleSZndDsmbHQ7bWFzdGVy\nIGtleSZndDs8L3ByZT4KICogPHVsPgogKiA8bGk+bWFnaWMgYnl0ZXM6IDQg\nYnl0ZXMsICdCS0xFJywgdmVyc2lvbjogNCBieXRlcwogKiA8bGk+bGVuIG9m\nIG1hc3RlciBrZXk6IGluZGljYXRlcyBsZW5ndGggb2YgbWFzdGVyIGtleS4g\nLTEgbWVhbnMgbm8gbWFzdGVyIGtleSBzdG9yZWQgaW4gaGVhZGVyLgogKiA8\nbGk+bWFzdGVyIGtleTogbWFzdGVyIGtleQogKiA8bGk+c3RhdGU6IGJpdCBt\nYXAgdG8gaW5kaWNhdGUgdGhlIHN0YXRlLCAzMiBiaXRzLgogKiA8L3VsPgog\nKiA8Yj5JbmRleCBwYWdlPC9iPiBpcyBhIGZpeGVkLWxlbmd0aCBwYWdlLCB3\naGljaCBjb250YWlucyBzZXJ2ZXJhbCBlbnRyaWVzIHdoaWNoIHBvaW50IHRv\nIHRoZSBvZmZzZXRzIG9mIGRhdGEgc3RvcmVkIGluIGVudHJ5IGxvZ2dlcnMu\nCiAqIDwvcD4KICovCmNsYXNzIEZpbGVJbmZvIHsKICAgIHN0YXRpYyBMb2dn\nZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoRmlsZUluZm8uY2xh\nc3MpOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQgTk9fTUFTVEVSX0tFWSA9IC0x\nOwogICAgc3RhdGljIGZpbmFsIGludCBTVEFURV9GRU5DRURfQklUID0gMHgx\nOwoKICAgIHByaXZhdGUgRmlsZUNoYW5uZWwgZmM7CiAgICBwcml2YXRlIEZp\nbGUgbGY7CiAgICBieXRlW10gbWFzdGVyS2V5OwoKICAgIC8qKgogICAgICog\nVGhlIGZpbmdlcnByaW50IG9mIGEgbGVkZ2VyIGluZGV4IGZpbGUKICAgICAq\nLwogICAgc3RhdGljIGZpbmFsIHB1YmxpYyBpbnQgc2lnbmF0dXJlID0gQnl0\nZUJ1ZmZlci53cmFwKCJCS0xFIi5nZXRCeXRlcygpKS5nZXRJbnQoKTsKICAg\nIHN0YXRpYyBmaW5hbCBwdWJsaWMgaW50IGhlYWRlclZlcnNpb24gPSAwOwoK\nICAgIHN0YXRpYyBmaW5hbCBsb25nIFNUQVJUX09GX0RBVEEgPSAxMDI0Owog\nICAgcHJpdmF0ZSBsb25nIHNpemU7CiAgICBwcml2YXRlIGludCB1c2VDb3Vu\ndDsKICAgIHByaXZhdGUgYm9vbGVhbiBpc0Nsb3NlZDsKICAgIHByaXZhdGUg\nbG9uZyBzaXplU2luY2VMYXN0d3JpdGU7CgogICAgLy8gYml0IG1hcCBmb3Ig\nc3RhdGVzIG9mIHRoZSBsZWRnZXIuCiAgICBwcml2YXRlIGludCBzdGF0ZUJp\ndHM7CiAgICBwcml2YXRlIGJvb2xlYW4gbmVlZEZsdXNoSGVhZGVyID0gZmFs\nc2U7CgogICAgLy8gZmlsZSBhY2Nlc3MgbW9kZQogICAgcHJvdGVjdGVkIFN0\ncmluZyBtb2RlOwoKICAgIHB1YmxpYyBGaWxlSW5mbyhGaWxlIGxmLCBieXRl\nW10gbWFzdGVyS2V5KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRo\naXMubGYgPSBsZjsKCiAgICAgICAgdGhpcy5tYXN0ZXJLZXkgPSBtYXN0ZXJL\nZXk7CiAgICAgICAgbW9kZSA9ICJydyI7CiAgICB9CgogICAgcHVibGljIEZp\nbGUgZ2V0TGYoKSB7CiAgICAgICAgcmV0dXJuIGxmOwogICAgfQoKICAgIHB1\nYmxpYyBsb25nIGdldFNpemVTaW5jZUxhc3R3cml0ZSgpIHsKICAgICAgICBy\nZXR1cm4gc2l6ZVNpbmNlTGFzdHdyaXRlOwogICAgfQoKICAgIHN5bmNocm9u\naXplZCBwdWJsaWMgdm9pZCByZWFkSGVhZGVyKCkgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICBpZiAobGYuZXhpc3RzKCkpIHsKICAgICAgICAgICAg\naWYgKGZjICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgZmMgPSBuZXcgUmFuZG9tQWNjZXNz\nRmlsZShsZiwgbW9kZSkuZ2V0Q2hhbm5lbCgpOwogICAgICAgICAgICBzaXpl\nID0gZmMuc2l6ZSgpOwogICAgICAgICAgICBzaXplU2luY2VMYXN0d3JpdGUg\nPSBzaXplOwoKICAgICAgICAgICAgLy8gYXZvaWQgaGFuZyBvbiByZWFkaW5n\nIHBhcnRpYWwgaW5kZXgKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5\ndGVCdWZmZXIuYWxsb2NhdGUoKGludCkoTWF0aC5taW4oc2l6ZSwgU1RBUlRf\nT0ZfREFUQSkpKTsKICAgICAgICAgICAgd2hpbGUoYmIuaGFzUmVtYWluaW5n\nKCkpIHsKICAgICAgICAgICAgICAgIGZjLnJlYWQoYmIpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGJiLmZsaXAoKTsKICAgICAgICAgICAgaWYgKGJi\nLmdldEludCgpICE9IHNpZ25hdHVyZSkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJNaXNzaW5nIGxlZGdlciBzaWduYXR1cmUi\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbnQgdmVyc2lvbiA9IGJi\nLmdldEludCgpOwogICAgICAgICAgICBpZiAodmVyc2lvbiAhPSBoZWFkZXJW\nZXJzaW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRp\nb24oIkluY29tcGF0aWJsZSBsZWRnZXIgdmVyc2lvbiAiICsgdmVyc2lvbik7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW50IGxlbmd0aCA9IGJiLmdl\ndEludCgpOwogICAgICAgICAgICBpZiAobGVuZ3RoIDwgMCkgewogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJMZW5ndGggIiArIGxl\nbmd0aCArICIgaXMgaW52YWxpZCIpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKGxlbmd0aCA+IGJiLnJlbWFpbmluZygpKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgQnVmZmVyVW5kZXJmbG93RXhjZXB0aW9uKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgbWFzdGVyS2V5ID0gbmV3IGJ5dGVbbGVuZ3Ro\nXTsKICAgICAgICAgICAgYmIuZ2V0KG1hc3RlcktleSk7CiAgICAgICAgICAg\nIHN0YXRlQml0cyA9IGJiLmdldEludCgpOwogICAgICAgICAgICBuZWVkRmx1\nc2hIZWFkZXIgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkxlZGdlciBpbmRleCBmaWxlIGRv\nZXMgbm90IGV4aXN0Iik7CiAgICAgICAgfQogICAgfQoKICAgIHN5bmNocm9u\naXplZCBwcml2YXRlIHZvaWQgY2hlY2tPcGVuKGJvb2xlYW4gY3JlYXRlKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChmYyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYm9vbGVh\nbiBleGlzdHMgPSBsZi5leGlzdHMoKTsKICAgICAgICBpZiAobWFzdGVyS2V5\nID09IG51bGwgJiYgIWV4aXN0cykgewogICAgICAgICAgICB0aHJvdyBuZXcg\nSU9FeGNlcHRpb24obGYgKyAiIG5vdCBmb3VuZCIpOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKCFleGlzdHMpIHsgCiAgICAgICAgICAgIGlmIChjcmVhdGUp\nIHsKICAgICAgICAgICAgICAgIC8vIGRlbGF5ZWQgdGhlIGNyZWF0aW9uIG9m\nIHBhcmVudHMgZGlyZWN0b3JpZXMKICAgICAgICAgICAgICAgIGNoZWNrUGFy\nZW50cyhsZik7CiAgICAgICAgICAgICAgICBmYyA9IG5ldyBSYW5kb21BY2Nl\nc3NGaWxlKGxmLCBtb2RlKS5nZXRDaGFubmVsKCk7CiAgICAgICAgICAgICAg\nICBzaXplID0gZmMuc2l6ZSgpOwogICAgICAgICAgICAgICAgaWYgKHNpemUg\nPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHdyaXRlSGVhZGVyKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVhZEhlYWRl\ncigpOwogICAgICAgICAgICB9IGNhdGNoIChCdWZmZXJVbmRlcmZsb3dFeGNl\ncHRpb24gYnVmKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRXhjZXB0\naW9uIHdoZW4gcmVhZGluZyBoZWFkZXIgb2Yge30gOiB7fSIsIGxmLCBidWYp\nOwogICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gbWFzdGVyS2V5KSB7CiAg\nICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkF0dGVtcHRpbmcgdG8gd3Jp\ndGUgaGVhZGVyIG9mIHt9IGFnYWluLiIsIGxmKTsKICAgICAgICAgICAgICAg\nICAgICB3cml0ZUhlYWRlcigpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkVy\ncm9yIHJlYWRpbmcgaGVhZGVyICIgKyBsZik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIHdyaXRlSGVhZGVyKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgoaW50KVNU\nQVJUX09GX0RBVEEpOwogICAgICAgIGJiLnB1dEludChzaWduYXR1cmUpOwog\nICAgICAgIGJiLnB1dEludChoZWFkZXJWZXJzaW9uKTsKICAgICAgICBiYi5w\ndXRJbnQobWFzdGVyS2V5Lmxlbmd0aCk7CiAgICAgICAgYmIucHV0KG1hc3Rl\ncktleSk7CiAgICAgICAgYmIucHV0SW50KHN0YXRlQml0cyk7CiAgICAgICAg\nYmIucmV3aW5kKCk7CiAgICAgICAgZmMucG9zaXRpb24oMCk7CiAgICAgICAg\nZmMud3JpdGUoYmIpOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\nYm9vbGVhbiBpc0ZlbmNlZCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgY2hlY2tPcGVuKGZhbHNlKTsKICAgICAgICByZXR1cm4gKHN0YXRlQml0\ncyAmIFNUQVRFX0ZFTkNFRF9CSVQpID09IFNUQVRFX0ZFTkNFRF9CSVQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgc2V0IGZlbmNl\nIHN1Y2NlZWQsIG90aGVyd2lzZSBmYWxzZSB3aGVuCiAgICAgKiBpdCBhbHJl\nYWR5IGZlbmNlZCBvciBmYWlsZWQgdG8gc2V0IGZlbmNlZC4KICAgICAqLwog\nICAgc3luY2hyb25pemVkIHB1YmxpYyBib29sZWFuIHNldEZlbmNlZCgpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tPcGVuKGZhbHNlKTsK\nICAgICAgICBMT0cuZGVidWcoIlRyeSB0byBzZXQgZmVuY2VkIHN0YXRlIGlu\nIGZpbGUgaW5mbyB7fSA6IHN0YXRlIGJpdHMge30uIiwgbGYsIHN0YXRlQml0\ncyk7CiAgICAgICAgaWYgKChzdGF0ZUJpdHMgJiBTVEFURV9GRU5DRURfQklU\nKSAhPSBTVEFURV9GRU5DRURfQklUKSB7CiAgICAgICAgICAgIC8vIG5vdCBm\nZW5jZWQgeWV0CiAgICAgICAgICAgIHN0YXRlQml0cyB8PSBTVEFURV9GRU5D\nRURfQklUOwogICAgICAgICAgICBuZWVkRmx1c2hIZWFkZXIgPSB0cnVlOwog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8v\nIGZsdXNoIHRoZSBoZWFkZXIgd2hlbiBoZWFkZXIgaXMgY2hhbmdlZAogICAg\nc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIGZsdXNoSGVhZGVyKCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobmVlZEZsdXNoSGVhZGVyKSB7\nCiAgICAgICAgICAgIGNoZWNrT3Blbih0cnVlKTsKICAgICAgICAgICAgd3Jp\ndGVIZWFkZXIoKTsKICAgICAgICAgICAgbmVlZEZsdXNoSGVhZGVyID0gZmFs\nc2U7CiAgICAgICAgfQogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\nbG9uZyBzaXplKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBjaGVj\na09wZW4oZmFsc2UpOwogICAgICAgIGxvbmcgcmMgPSBzaXplLVNUQVJUX09G\nX0RBVEE7CiAgICAgICAgaWYgKHJjIDwgMCkgewogICAgICAgICAgICByYyA9\nIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiByYzsKICAgIH0KCiAgICBz\neW5jaHJvbml6ZWQgcHVibGljIGludCByZWFkKEJ5dGVCdWZmZXIgYmIsIGxv\nbmcgcG9zaXRpb24pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHJlYWRBYnNvbHV0ZShiYiwgcG9zaXRpb24gKyBTVEFSVF9PRl9EQVRB\nKTsKICAgIH0KCiAgICBwcml2YXRlIGludCByZWFkQWJzb2x1dGUoQnl0ZUJ1\nZmZlciBiYiwgbG9uZyBzdGFydCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBjaGVja09wZW4oZmFsc2UpOwogICAgICAgIGlmIChmYyA9PSBudWxs\nKSB7CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBp\nbnQgdG90YWwgPSAwOwogICAgICAgIHdoaWxlKGJiLnJlbWFpbmluZygpID4g\nMCkgewogICAgICAgICAgICBpbnQgcmMgPSBmYy5yZWFkKGJiLCBzdGFydCk7\nCiAgICAgICAgICAgIGlmIChyYyA8PSAwKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSU9FeGNlcHRpb24oIlNob3J0IHJlYWQiKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICB0b3RhbCArPSByYzsKICAgICAgICAgICAgLy8g\nc2hvdWxkIG1vdmUgcmVhZCBwb3NpdGlvbgogICAgICAgICAgICBzdGFydCAr\nPSByYzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgfQoK\nICAgIC8qKgogICAgICogQ2xvc2UgYSBmaWxlIGluZm8KICAgICAqCiAgICAg\nKiBAcGFyYW0gZm9yY2UKICAgICAqICAgICAgICAgIGlmIHNldCB0byB0cnVl\nLCB0aGUgaW5kZXggaXMgZm9yY2VkIHRvIGNyZWF0ZSBiZWZvcmUgY2xvc2Vk\nLAogICAgICogICAgICAgICAgaWYgc2V0IHRvIGZhbHNlLCB0aGUgaW5kZXgg\naXMgbm90IGZvcmNlZCB0byBjcmVhdGUuCiAgICAgKi8KICAgIHN5bmNocm9u\naXplZCBwdWJsaWMgdm9pZCBjbG9zZShib29sZWFuIGZvcmNlKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIGlzQ2xvc2VkID0gdHJ1ZTsKICAgICAg\nICBjaGVja09wZW4oZm9yY2UpOwogICAgICAgIGlmICh1c2VDb3VudCA9PSAw\nICYmIGZjICE9IG51bGwpIHsKICAgICAgICAgICAgZmMuY2xvc2UoKTsKICAg\nICAgICB9CiAgICB9CgogICAgc3luY2hyb25pemVkIHB1YmxpYyBsb25nIHdy\naXRlKEJ5dGVCdWZmZXJbXSBidWZmcywgbG9uZyBwb3NpdGlvbikgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBjaGVja09wZW4odHJ1ZSk7CiAgICAg\nICAgbG9uZyB0b3RhbCA9IDA7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nZmMucG9zaXRpb24ocG9zaXRpb24rU1RBUlRfT0ZfREFUQSk7CiAgICAgICAg\nICAgIHdoaWxlKGJ1ZmZzW2J1ZmZzLmxlbmd0aC0xXS5yZW1haW5pbmcoKSA+\nIDApIHsKICAgICAgICAgICAgICAgIGxvbmcgcmMgPSBmYy53cml0ZShidWZm\ncyk7CiAgICAgICAgICAgICAgICBpZiAocmMgPD0gMCkgewogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiU2hvcnQgd3JpdGUi\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRvdGFsICs9\nIHJjOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZmMuZm9yY2UodHJ1ZSk7CiAgICAgICAgICAgIGxvbmcgbmV3c2l6\nZSA9IHBvc2l0aW9uK1NUQVJUX09GX0RBVEErdG90YWw7CiAgICAgICAgICAg\nIGlmIChuZXdzaXplID4gc2l6ZSkgewogICAgICAgICAgICAgICAgc2l6ZSA9\nIG5ld3NpemU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgc2l6\nZVNpbmNlTGFzdHdyaXRlID0gZmMuc2l6ZSgpOwogICAgICAgIHJldHVybiB0\nb3RhbDsKICAgIH0KCiAgICAvKioKICAgICAqIENvcGllcyBjdXJyZW50IGZp\nbGUgY29udGVudHMgdXB0byBzcGVjaWZpZWQgc2l6ZSB0byB0aGUgdGFyZ2V0\nIGZpbGUgYW5kCiAgICAgKiBkZWxldGVzIHRoZSBjdXJyZW50IGZpbGUuIElm\nIHNpemUgbm90IGtub3duIHRoZW4gcGFzcyBzaXplIGFzCiAgICAgKiBMb25n\nLk1BWF9WQUxVRSB0byBjb3B5IGNvbXBsZXRlIGZpbGUuCiAgICAgKi8KICAg\nIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBtb3ZlVG9OZXdMb2NhdGlvbihG\naWxlIG5ld0ZpbGUsIGxvbmcgc2l6ZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBjaGVja09wZW4oZmFsc2UpOwogICAgICAgIGlmIChmYyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGlmIChzaXplID4gZmMuc2l6ZSgpKSB7CiAg\nICAgICAgICAgICAgICBzaXplID0gZmMuc2l6ZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIEZpbGUgcmxvY0ZpbGUgPSBuZXcgRmlsZShuZXdGaWxl\nLmdldFBhcmVudEZpbGUoKSwgbmV3RmlsZS5nZXROYW1lKCkgKyBMZWRnZXJD\nYWNoZUltcGwuUkxPQyk7CiAgICAgICAgICAgIGlmICghcmxvY0ZpbGUuZXhp\nc3RzKCkpIHsKICAgICAgICAgICAgICAgIGNoZWNrUGFyZW50cyhybG9jRmls\nZSk7CiAgICAgICAgICAgICAgICBpZiAoIXJsb2NGaWxlLmNyZWF0ZU5ld0Zp\nbGUoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbigiQ3JlYXRpbmcgbmV3IGNhY2hlIGluZGV4IGZpbGUgIiArIHJsb2NG\naWxlICsgIiBmYWlsZWQgIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gY29weSBjb250ZW50cyBmcm9tIG9sZC5p\nZHggdG8gbmV3LmlkeC5ybG9jCiAgICAgICAgICAgIEZpbGVDaGFubmVsIG5l\nd0ZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUocmxvY0ZpbGUsICJydyIpLmdl\ndENoYW5uZWwoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGxvbmcgd3JpdHRlbiA9IDA7CiAgICAgICAgICAgICAgICB3aGlsZSAod3Jp\ndHRlbiA8IHNpemUpIHsKICAgICAgICAgICAgICAgICAgICBsb25nIGNvdW50\nID0gZmMudHJhbnNmZXJUbyh3cml0dGVuLCBzaXplLCBuZXdGYyk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGNvdW50IDw9IDApIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJDb3B5aW5nIHRv\nIG5ldyBsb2NhdGlvbiAiICsgcmxvY0ZpbGUgKyAiIGZhaWxlZCIpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3cml0dGVu\nICs9IGNvdW50OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\naWYgKHdyaXR0ZW4gPD0gMCAmJiBzaXplID4gMCkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiQ29weWluZyB0byBuZXcg\nbG9jYXRpb24gIiArIHJsb2NGaWxlICsgIiBmYWlsZWQiKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nICAgIG5ld0ZjLmZvcmNlKHRydWUpOwogICAgICAgICAgICAgICAgbmV3RmMu\nY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBkZWxldGUg\nb2xkLmlkeAogICAgICAgICAgICBmYy5jbG9zZSgpOwogICAgICAgICAgICBp\nZiAoIWRlbGV0ZSgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkZh\naWxlZCB0byBkZWxldGUgdGhlIHByZXZpb3VzIGluZGV4IGZpbGUgIiArIGxm\nKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRmFp\nbGVkIHRvIGRlbGV0ZSB0aGUgcHJldmlvdXMgaW5kZXggZmlsZSAiICsgbGYp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByZW5hbWUgbmV3Lmlk\neC5ybG9jIHRvIG5ldy5pZHgKICAgICAgICAgICAgaWYgKCFybG9jRmlsZS5y\nZW5hbWVUbyhuZXdGaWxlKSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJGYWlsZWQgdG8gcmVuYW1lICIgKyBybG9jRmlsZSArICIgdG8gIiArIG5l\nd0ZpbGUpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9u\nKCJGYWlsZWQgdG8gcmVuYW1lICIgKyBybG9jRmlsZSArICIgdG8gIiArIG5l\nd0ZpbGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZjID0gbmV3IFJh\nbmRvbUFjY2Vzc0ZpbGUobmV3RmlsZSwgbW9kZSkuZ2V0Q2hhbm5lbCgpOwog\nICAgICAgIH0KICAgICAgICBsZiA9IG5ld0ZpbGU7CiAgICB9CgogICAgc3lu\nY2hyb25pemVkIHB1YmxpYyBieXRlW10gZ2V0TWFzdGVyS2V5KCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBjaGVja09wZW4oZmFsc2UpOwogICAg\nICAgIHJldHVybiBtYXN0ZXJLZXk7CiAgICB9CgogICAgc3luY2hyb25pemVk\nIHB1YmxpYyB2b2lkIHVzZSgpIHsKICAgICAgICB1c2VDb3VudCsrOwogICAg\nfQoKICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgc3luY2hyb25pemVkIGlu\ndCBnZXRVc2VDb3VudCgpIHsKICAgICAgICByZXR1cm4gdXNlQ291bnQ7CiAg\nICB9CgogICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHJlbGVhc2UoKSB7\nCiAgICAgICAgdXNlQ291bnQtLTsKICAgICAgICBpZiAoaXNDbG9zZWQgJiYg\ndXNlQ291bnQgPT0gMCAmJiBmYyAhPSBudWxsKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBmYy5jbG9zZSgpOwogICAgICAgICAgICB9\nIGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cu\nZXJyb3IoIkVycm9yIGNsb3NpbmcgZmlsZSBjaGFubmVsIiwgZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4g\nZGVsZXRlKCkgewogICAgICAgIHJldHVybiBsZi5kZWxldGUoKTsKICAgIH0K\nCiAgICBzdGF0aWMgZmluYWwgcHJpdmF0ZSB2b2lkIGNoZWNrUGFyZW50cyhG\naWxlIGYpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBwYXJl\nbnQgPSBmLmdldFBhcmVudEZpbGUoKTsKICAgICAgICBpZiAocGFyZW50LmV4\naXN0cygpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAg\nICAgaWYgKHBhcmVudC5ta2RpcnMoKSA9PSBmYWxzZSkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNvdW5sZG4ndCBta2RpcnMgZm9y\nICIgKyBwYXJlbnQpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

