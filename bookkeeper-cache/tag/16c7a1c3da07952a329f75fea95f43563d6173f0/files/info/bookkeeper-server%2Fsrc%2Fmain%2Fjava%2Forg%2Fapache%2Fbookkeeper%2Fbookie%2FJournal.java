{"sha":"72f337020c9087dde506a4a658c36f4c9b75588e","node_id":"MDQ6QmxvYjE1NzU5NTY6NzJmMzM3MDIwYzkwODdkZGU1MDZhNGE2NThjMzZmNGM5Yjc1NTg4ZQ==","size":20490,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/72f337020c9087dde506a4a658c36f4c9b75588e","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uRmlsZUlucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5GaWxlT3V0cHV0U3RyZWFtOwppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVC\ndWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2\nYS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkxpbmtlZEJsb2NraW5nUXVldWU7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5Ob1dy\naXRhYmxlTGVkZ2VyRGlyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci51dGlsLklPVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIudXRpbC5NYXRoVXRpbHM7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2Vy\nOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogUHJv\ndmlkZSBqb3VybmFsIHJlbGF0ZWQgbWFuYWdlbWVudC4KICovCmNsYXNzIEpv\ndXJuYWwgZXh0ZW5kcyBUaHJlYWQgewoKICAgIHN0YXRpYyBMb2dnZXIgTE9H\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSm91cm5hbC5jbGFzcyk7Cgog\nICAgLyoqCiAgICAgKiBGaWx0ZXIgdG8gcGlja3VwIGpvdXJuYWxzCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIGludGVyZmFjZSBKb3VybmFsSWRGaWx0\nZXIgewogICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChsb25nIGpvdXJu\nYWxJZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMaXN0IGFsbCBqb3VybmFs\nIGlkcyBieSBhIHNwZWNpZmllZCBqb3VybmFsIGlkIGZpbGVyCiAgICAgKgog\nICAgICogQHBhcmFtIGpvdXJuYWxEaXIgam91cm5hbCBkaXIKICAgICAqIEBw\nYXJhbSBmaWx0ZXIgam91cm5hbCBpZCBmaWx0ZXIKICAgICAqIEByZXR1cm4g\nbGlzdCBvZiBmaWx0ZXJlZCBpZHMKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgTGlzdDxMb25nPiBsaXN0Sm91cm5hbElkcyhGaWxlIGpvdXJuYWxEaXIs\nIEpvdXJuYWxJZEZpbHRlciBmaWx0ZXIpIHsKICAgICAgICBGaWxlIGxvZ0Zp\nbGVzW10gPSBqb3VybmFsRGlyLmxpc3RGaWxlcygpOwogICAgICAgIExpc3Q8\nTG9uZz4gbG9ncyA9IG5ldyBBcnJheUxpc3Q8TG9uZz4oKTsKICAgICAgICBm\nb3IoRmlsZSBmOiBsb2dGaWxlcykgewogICAgICAgICAgICBTdHJpbmcgbmFt\nZSA9IGYuZ2V0TmFtZSgpOwogICAgICAgICAgICBpZiAoIW5hbWUuZW5kc1dp\ndGgoIi50eG4iKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgU3RyaW5nIGlkU3RyaW5nID0gbmFtZS5z\ncGxpdCgiXFwuIilbMF07CiAgICAgICAgICAgIGxvbmcgaWQgPSBMb25nLnBh\ncnNlTG9uZyhpZFN0cmluZywgMTYpOwogICAgICAgICAgICBpZiAoZmlsdGVy\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlmIChmaWx0ZXIuYWNjZXB0\nKGlkKSkgewogICAgICAgICAgICAgICAgICAgIGxvZ3MuYWRkKGlkKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIGxvZ3MuYWRkKGlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBDb2xsZWN0aW9ucy5zb3J0KGxvZ3MpOwogICAgICAgIHJldHVy\nbiBsb2dzOwogICAgfQoKICAgIC8qKgogICAgICogTGFzdCBMb2cgTWFyawog\nICAgICovCiAgICBjbGFzcyBMYXN0TG9nTWFyayB7CiAgICAgICAgcHJpdmF0\nZSBsb25nIHR4bkxvZ0lkOwogICAgICAgIHByaXZhdGUgbG9uZyB0eG5Mb2dQ\nb3NpdGlvbjsKICAgICAgICBwcml2YXRlIExhc3RMb2dNYXJrIGxhc3RNYXJr\nOwogICAgICAgIExhc3RMb2dNYXJrKGxvbmcgbG9nSWQsIGxvbmcgbG9nUG9z\naXRpb24pIHsKICAgICAgICAgICAgdGhpcy50eG5Mb2dJZCA9IGxvZ0lkOwog\nICAgICAgICAgICB0aGlzLnR4bkxvZ1Bvc2l0aW9uID0gbG9nUG9zaXRpb247\nCiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZCB2b2lkIHNldExhc3RM\nb2dNYXJrKGxvbmcgbG9nSWQsIGxvbmcgbG9nUG9zaXRpb24pIHsKICAgICAg\nICAgICAgdHhuTG9nSWQgPSBsb2dJZDsKICAgICAgICAgICAgdHhuTG9nUG9z\naXRpb24gPSBsb2dQb3NpdGlvbjsKICAgICAgICB9CiAgICAgICAgc3luY2hy\nb25pemVkIHZvaWQgbWFya0xvZygpIHsKICAgICAgICAgICAgbGFzdE1hcmsg\nPSBuZXcgTGFzdExvZ01hcmsodHhuTG9nSWQsIHR4bkxvZ1Bvc2l0aW9uKTsK\nICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCBMYXN0TG9nTWFyayBn\nZXRMYXN0TWFyaygpIHsKICAgICAgICAgICAgcmV0dXJuIGxhc3RNYXJrOwog\nICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6ZWQgbG9uZyBnZXRUeG5Mb2dJ\nZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHR4bkxvZ0lkOwogICAgICAgIH0K\nICAgICAgICBzeW5jaHJvbml6ZWQgbG9uZyBnZXRUeG5Mb2dQb3NpdGlvbigp\nIHsKICAgICAgICAgICAgcmV0dXJuIHR4bkxvZ1Bvc2l0aW9uOwogICAgICAg\nIH0KCiAgICAgICAgc3luY2hyb25pemVkIHZvaWQgcm9sbExvZygpIHRocm93\ncyBOb1dyaXRhYmxlTGVkZ2VyRGlyRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nYnl0ZSBidWZmW10gPSBuZXcgYnl0ZVsxNl07CiAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgYmIgPSBCeXRlQnVmZmVyLndyYXAoYnVmZik7CiAgICAgICAgICAg\nIC8vIHdlIHNob3VsZCByZWNvcmQgPGxvZ0lkLCBsb2dQb3NpdGlvbj4gbWFy\na2VkIGluIG1hcmtMb2cKICAgICAgICAgICAgLy8gd2hpY2ggaXMgc2FmZSBz\naW5jZSByZWNvcmRzIGJlZm9yZSBsYXN0TWFyayBoYXZlIGJlZW4KICAgICAg\nICAgICAgLy8gcGVyc2lzdGVkIHRvIGRpc2sgKGJvdGggaW5kZXggJiBlbnRy\neSBsb2dnZXIpCiAgICAgICAgICAgIGJiLnB1dExvbmcobGFzdE1hcmsuZ2V0\nVHhuTG9nSWQoKSk7CiAgICAgICAgICAgIGJiLnB1dExvbmcobGFzdE1hcmsu\nZ2V0VHhuTG9nUG9zaXRpb24oKSk7CiAgICAgICAgICAgIExPRy5kZWJ1Zygi\nUm9sbExvZyB0byBwZXJzaXN0IGxhc3QgbWFya2VkIGxvZyA6IHt9IiwgbGFz\ndE1hcmspOwogICAgICAgICAgICBMaXN0PEZpbGU+IHdyaXRhYmxlTGVkZ2Vy\nRGlycyA9IGxlZGdlckRpcnNNYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAg\nLmdldFdyaXRhYmxlTGVkZ2VyRGlycygpOwogICAgICAgICAgICBmb3IgKEZp\nbGUgZGlyIDogd3JpdGFibGVMZWRnZXJEaXJzKSB7CiAgICAgICAgICAgICAg\nICBGaWxlIGZpbGUgPSBuZXcgRmlsZShkaXIsICJsYXN0TWFyayIpOwogICAg\nICAgICAgICAgICAgRmlsZU91dHB1dFN0cmVhbSBmb3MgPSBudWxsOwogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBmb3MgPSBu\nZXcgRmlsZU91dHB1dFN0cmVhbShmaWxlKTsKICAgICAgICAgICAgICAgICAg\nICBmb3Mud3JpdGUoYnVmZik7CiAgICAgICAgICAgICAgICAgICAgZm9zLmdl\ndENoYW5uZWwoKS5mb3JjZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICBm\nb3MuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICBmb3MgPSBudWxsOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiUHJvYmxlbXMgd3JpdGluZyB0\nbyAiICsgZmlsZSwgZSk7CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgICAgIC8vIGlmIHN0cmVhbSBhbHJlYWR5IGNsb3Nl\nZCBpbiB0cnkgYmxvY2sgc3VjY2Vzc2Z1bGx5LAogICAgICAgICAgICAgICAg\nICAgIC8vIHN0cmVhbSBtaWdodCBoYXZlIG51bGxpZmllZCwgaW4gc3VjaCBj\nYXNlIGJlbG93CiAgICAgICAgICAgICAgICAgICAgLy8gY2FsbCB3aWxsIHNp\nbXBseSByZXR1cm5zCiAgICAgICAgICAgICAgICAgICAgSU9VdGlscy5jbG9z\nZShMT0csIGZvcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFJlYWQgbGFzdCBt\nYXJrIGZyb20gbGFzdE1hcmsgZmlsZS4KICAgICAgICAgKiBUaGUgbGFzdCBt\nYXJrIHNob3VsZCBmaXJzdCBiZSBtYXggam91cm5hbCBsb2cgaWQsCiAgICAg\nICAgICogYW5kIHRoZW4gbWF4IGxvZyBwb3NpdGlvbiBpbiBtYXggam91cm5h\nbCBsb2cuCiAgICAgICAgICovCiAgICAgICAgc3luY2hyb25pemVkIHZvaWQg\ncmVhZExvZygpIHsKICAgICAgICAgICAgYnl0ZSBidWZmW10gPSBuZXcgYnl0\nZVsxNl07CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVy\nLndyYXAoYnVmZik7CiAgICAgICAgICAgIGZvcihGaWxlIGRpcjogbGVkZ2Vy\nRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAgICAgICAg\nICAgICBGaWxlIGZpbGUgPSBuZXcgRmlsZShkaXIsICJsYXN0TWFyayIpOwog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBGaWxl\nSW5wdXRTdHJlYW0gZmlzID0gbmV3IEZpbGVJbnB1dFN0cmVhbShmaWxlKTsK\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpbnQgYnl0ZXNSZWFkID0gZmlzLnJlYWQoYnVmZik7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChieXRlc1JlYWQgIT0gMTYpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigi\nQ291bGRuJ3QgcmVhZCBlbm91Z2ggYnl0ZXMgZnJvbSBsYXN0TWFyay4iCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyAiIFdhbnRlZCAiICsgMTYgKyAiLCBnb3QgIiArIGJ5dGVzUmVhZCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICBmaXMuY2xv\nc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgYmIuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBsb25nIGkgPSBi\nYi5nZXRMb25nKCk7CiAgICAgICAgICAgICAgICAgICAgbG9uZyBwID0gYmIu\nZ2V0TG9uZygpOwogICAgICAgICAgICAgICAgICAgIGlmIChpID4gdHhuTG9n\nSWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHhuTG9nSWQgPSBpOwog\nICAgICAgICAgICAgICAgICAgICAgICBpZihwID4gdHhuTG9nUG9zaXRpb24p\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0eG5Mb2dQb3NpdGlvbiA9\nIHA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJQcm9ibGVtcyBy\nZWFkaW5nIGZyb20gIiArIGZpbGUgKyAiICh0aGlzIGlzIG9rYXkgaWYgaXQg\naXMgdGhlIGZpcnN0IHRpbWUgc3RhcnRpbmcgdGhpcyBib29raWUiKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygp\nIHsKICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdC\ndWlsZGVyKCk7CgogICAgICAgICAgICBzYi5hcHBlbmQoIkxhc3RNYXJrOiBs\nb2dJZCAtICIpLmFwcGVuZCh0eG5Mb2dJZCkKICAgICAgICAgICAgICAuYXBw\nZW5kKCIgLCBwb3NpdGlvbiAtICIpLmFwcGVuZCh0eG5Mb2dQb3NpdGlvbik7\nCgogICAgICAgICAgICByZXR1cm4gc2IudG9TdHJpbmcoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBGaWx0ZXIgdG8gcmV0dXJuIGxpc3Qg\nb2Ygam91cm5hbHMgZm9yIHJvbGxpbmcKICAgICAqLwogICAgcHJpdmF0ZSBj\nbGFzcyBKb3VybmFsUm9sbGluZ0ZpbHRlciBpbXBsZW1lbnRzIEpvdXJuYWxJ\nZEZpbHRlciB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gYWNjZXB0KGxvbmcgam91cm5hbElkKSB7CiAgICAgICAgICAgIGlm\nIChqb3VybmFsSWQgPCBsYXN0TG9nTWFyay5nZXRMYXN0TWFyaygpLmdldFR4\nbkxvZ0lkKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogU2Nhbm5lciB1c2VkIHRvIHNjYW4gYSBqb3VybmFsCiAgICAgKi8KICAg\nIHB1YmxpYyBzdGF0aWMgaW50ZXJmYWNlIEpvdXJuYWxTY2FubmVyIHsKICAg\nICAgICAvKioKICAgICAgICAgKiBQcm9jZXNzIGEgam91cm5hbCBlbnRyeS4K\nICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBqb3VybmFsVmVyc2lvbgog\nICAgICAgICAqICAgICAgICAgIEpvdXJuYWwgVmVyc2lvbgogICAgICAgICAq\nIEBwYXJhbSBvZmZzZXQKICAgICAgICAgKiAgICAgICAgICBGaWxlIG9mZnNl\ndCBvZiB0aGUgam91cm5hbCBlbnRyeQogICAgICAgICAqIEBwYXJhbSBlbnRy\neQogICAgICAgICAqICAgICAgICAgIEpvdXJuYWwgRW50cnkKICAgICAgICAg\nKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgICAgICovCiAgICAgICAgcHVi\nbGljIHZvaWQgcHJvY2VzcyhpbnQgam91cm5hbFZlcnNpb24sIGxvbmcgb2Zm\nc2V0LCBCeXRlQnVmZmVyIGVudHJ5KSB0aHJvd3MgSU9FeGNlcHRpb247CiAg\nICB9CgogICAgLyoqCiAgICAgKiBKb3VybmFsIEVudHJ5IHRvIFJlY29yZAog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBRdWV1ZUVudHJ5IHsK\nICAgICAgICBRdWV1ZUVudHJ5KEJ5dGVCdWZmZXIgZW50cnksIGxvbmcgbGVk\nZ2VySWQsIGxvbmcgZW50cnlJZCwKICAgICAgICAgICAgICAgICAgIFdyaXRl\nQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgdGhpcy5l\nbnRyeSA9IGVudHJ5LmR1cGxpY2F0ZSgpOwogICAgICAgICAgICB0aGlzLmNi\nID0gY2I7CiAgICAgICAgICAgIHRoaXMuY3R4ID0gY3R4OwogICAgICAgICAg\nICB0aGlzLmxlZGdlcklkID0gbGVkZ2VySWQ7CiAgICAgICAgICAgIHRoaXMu\nZW50cnlJZCA9IGVudHJ5SWQ7CiAgICAgICAgfQoKICAgICAgICBCeXRlQnVm\nZmVyIGVudHJ5OwoKICAgICAgICBsb25nIGxlZGdlcklkOwoKICAgICAgICBs\nb25nIGVudHJ5SWQ7CgogICAgICAgIFdyaXRlQ2FsbGJhY2sgY2I7CgogICAg\nICAgIE9iamVjdCBjdHg7CiAgICB9CgogICAgZmluYWwgc3RhdGljIGxvbmcg\nTUIgPSAxMDI0ICogMTAyNEw7CiAgICAvLyBtYXggam91cm5hbCBmaWxlIHNp\nemUKICAgIGZpbmFsIGxvbmcgbWF4Sm91cm5hbFNpemU7CiAgICAvLyBudW1i\nZXIgam91cm5hbCBmaWxlcyBrZXB0IGJlZm9yZSBtYXJrZWQgam91cm5hbAog\nICAgZmluYWwgaW50IG1heEJhY2t1cEpvdXJuYWxzOwoKICAgIGZpbmFsIEZp\nbGUgam91cm5hbERpcmVjdG9yeTsKICAgIGZpbmFsIFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZjsKCiAgICBwcml2YXRlIExhc3RMb2dNYXJrIGxhc3RMb2dN\nYXJrID0gbmV3IExhc3RMb2dNYXJrKDAsIDApOwoKICAgIC8vIGpvdXJuYWwg\nZW50cnkgcXVldWUgdG8gY29tbWl0CiAgICBMaW5rZWRCbG9ja2luZ1F1ZXVl\nPFF1ZXVlRW50cnk+IHF1ZXVlID0gbmV3IExpbmtlZEJsb2NraW5nUXVldWU8\nUXVldWVFbnRyeT4oKTsKCiAgICB2b2xhdGlsZSBib29sZWFuIHJ1bm5pbmcg\nPSB0cnVlOwogICAgcHJpdmF0ZSBMZWRnZXJEaXJzTWFuYWdlciBsZWRnZXJE\naXJzTWFuYWdlcjsKCiAgICBwdWJsaWMgSm91cm5hbChTZXJ2ZXJDb25maWd1\ncmF0aW9uIGNvbmYsIExlZGdlckRpcnNNYW5hZ2VyIGxlZGdlckRpcnNNYW5h\nZ2VyKSB7CiAgICAgICAgc3VwZXIoIkJvb2tpZUpvdXJuYWwtIiArIGNvbmYu\nZ2V0Qm9va2llUG9ydCgpKTsKICAgICAgICB0aGlzLmxlZGdlckRpcnNNYW5h\nZ2VyID0gbGVkZ2VyRGlyc01hbmFnZXI7CiAgICAgICAgdGhpcy5jb25mID0g\nY29uZjsKICAgICAgICB0aGlzLmpvdXJuYWxEaXJlY3RvcnkgPSBCb29raWUu\nZ2V0Q3VycmVudERpcmVjdG9yeShjb25mLmdldEpvdXJuYWxEaXIoKSk7CiAg\nICAgICAgdGhpcy5tYXhKb3VybmFsU2l6ZSA9IGNvbmYuZ2V0TWF4Sm91cm5h\nbFNpemUoKSAqIE1COwogICAgICAgIHRoaXMubWF4QmFja3VwSm91cm5hbHMg\nPSBjb25mLmdldE1heEJhY2t1cEpvdXJuYWxzKCk7CgogICAgICAgIC8vIHJl\nYWQgbGFzdCBsb2cgbWFyawogICAgICAgIGxhc3RMb2dNYXJrLnJlYWRMb2co\nKTsKICAgICAgICBMT0cuZGVidWcoIkxhc3QgTG9nIE1hcmsgOiB7fSIsIGxh\nc3RMb2dNYXJrKTsKICAgIH0KCiAgICBMYXN0TG9nTWFyayBnZXRMYXN0TG9n\nTWFyaygpIHsKICAgICAgICByZXR1cm4gbGFzdExvZ01hcms7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZWNvcmRzIGEgPGk+TGFzdExvZ01hcms8L2k+IGlu\nIG1lbW9yeS4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIFRoZSA8aT5MYXN0\nTG9nTWFyazwvaT4gY29udGFpbnMgdHdvIHBhcnRzOiBmaXJzdCBvbmUgaXMg\nPGk+dHhuTG9nSWQ8L2k+CiAgICAgKiAoZmlsZSBpZCBvZiBhIGpvdXJuYWwp\nIGFuZCB0aGUgc2Vjb25kIG9uZSBpcyA8aT50eG5Mb2dQb3M8L2k+IChvZmZz\nZXQgaW4KICAgICAqICBhIGpvdXJuYWwpLiBUaGUgPGk+TGFzdExvZ01hcms8\nL2k+IGluZGljYXRlcyB0aGF0IHRob3NlIGVudHJpZXMgYmVmb3JlCiAgICAg\nKiBpdCBoYXZlIGJlZW4gcGVyc2lzdGVkIHRvIGJvdGggaW5kZXggYW5kIGVu\ndHJ5IGxvZyBmaWxlcy4KICAgICAqIDwvcD4KICAgICAqCiAgICAgKiA8cD4K\nICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBiZWZvcmUgZmx1c2hpbmcg\nZW50cnkgbG9nIGZpbGVzIGFuZCBsZWRnZXIgY2FjaGUuCiAgICAgKiA8L3A+\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG1hcmtMb2coKSB7CiAgICAgICAg\nbGFzdExvZ01hcmsubWFya0xvZygpOwogICAgfQoKICAgIC8qKgogICAgICog\nUGVyc2lzdHMgdGhlIDxpPkxhc3RMb2dNYXJrPC9pPiBtYXJrZWQgYnkgI21h\ncmtMb2coKSB0byBkaXNrLgogICAgICoKICAgICAqIDxwPgogICAgICogVGhp\ncyBhY3Rpb24gbWVhbnMgZW50cmllcyBhZGRlZCBiZWZvcmUgPGk+TGFzdExv\nZ01hcms8L2k+IHdob3NlIGVudHJ5IGRhdGEKICAgICAqIGFuZCBpbmRleCBw\nYWdlcyB3ZXJlIGFscmVhZHkgcGVyc2lzdGVkIHRvIGRpc2suIEl0IGlzIHRo\nZSB0aW1lIHRvIHNhZmVseQogICAgICogcmVtb3ZlIGpvdXJuYWwgZmlsZXMg\nY3JlYXRlZCBlYXJsaWVyIHRoYW4gPGk+TGFzdExvZ01hcmsudHhuTG9nSWQ8\nL2k+LgogICAgICogPC9wPgogICAgICogPHA+CiAgICAgKiBJZiB0aGUgYm9v\na2llIGhhcyBjcmFzaGVkIGJlZm9yZSBwZXJzaXN0aW5nIDxpPkxhc3RMb2dN\nYXJrPC9pPiB0byBkaXNrLAogICAgICogaXQgc3RpbGwgaGFzIGpvdXJuYWwg\nZmlsZXMgY29udGFpbnMgZW50cmllcyBmb3Igd2hpY2ggaW5kZXggcGFnZXMg\nbWF5IG5vdAogICAgICogaGF2ZSBiZWVuIHBlcnNpc3RlZC4gQ29uc2VxdWVu\ndGx5LCB3aGVuIHRoZSBib29raWUgcmVzdGFydHMsIGl0IGluc3BlY3RzCiAg\nICAgKiBqb3VybmFsIGZpbGVzIHRvIHJlc3RvcmUgdGhvc2UgZW50cmllczsg\nZGF0YSBpc24ndCBsb3N0LgogICAgICogPC9wPgogICAgICogPHA+CiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgYWZ0ZXIgZmx1c2hpbmcgZW50cnkg\nbG9nIGZpbGVzIGFuZCBsZWRnZXIgY2FjaGUgc3VjY2Vzc2Z1bGx5LCB3aGlj\naCBpcyB0byBlbnN1cmUgPGk+TGFzdExvZ01hcms8L2k+IGlzIHBlc2lzdGVk\nLgogICAgICogPC9wPgogICAgICogQHNlZSAjbWFya0xvZygpCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHJvbGxMb2coKSB0aHJvd3MgTm9Xcml0YWJsZUxl\nZGdlckRpckV4Y2VwdGlvbiB7CiAgICAgICAgbGFzdExvZ01hcmsucm9sbExv\nZygpOwogICAgfQoKICAgIC8qKgogICAgICogR2FyYmFnZSBjb2xsZWN0IG9s\nZGVyIGpvdXJuYWxzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdjSm91cm5h\nbHMoKSB7CiAgICAgICAgLy8gbGlzdCB0aGUgam91cm5hbHMgdGhhdCBoYXZl\nIGJlZW4gbWFya2VkCiAgICAgICAgTGlzdDxMb25nPiBsb2dzID0gbGlzdEpv\ndXJuYWxJZHMoam91cm5hbERpcmVjdG9yeSwgbmV3IEpvdXJuYWxSb2xsaW5n\nRmlsdGVyKCkpOwogICAgICAgIC8vIGtlZXAgTUFYX0JBQ0tVUF9KT1VSTkFM\nUyBqb3VybmFsIGZpbGVzIGJlZm9yZSBtYXJrZWQgam91cm5hbAogICAgICAg\nIGlmIChsb2dzLnNpemUoKSA+PSBtYXhCYWNrdXBKb3VybmFscykgewogICAg\nICAgICAgICBpbnQgbWF4SWR4ID0gbG9ncy5zaXplKCkgLSBtYXhCYWNrdXBK\nb3VybmFsczsKICAgICAgICAgICAgZm9yIChpbnQgaT0wOyBpPG1heElkeDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBsb25nIGlkID0gbG9ncy5nZXQoaSk7\nCiAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGpvdXJuYWwgaWQg\naXMgc21hbGxlciB0aGFuIG1hcmtlZCBqb3VybmFsIGlkCiAgICAgICAgICAg\nICAgICBpZiAoaWQgPCBsYXN0TG9nTWFyay5nZXRMYXN0TWFyaygpLmdldFR4\nbkxvZ0lkKCkpIHsKICAgICAgICAgICAgICAgICAgICBGaWxlIGpvdXJuYWxG\naWxlID0gbmV3IEZpbGUoam91cm5hbERpcmVjdG9yeSwgTG9uZy50b0hleFN0\ncmluZyhpZCkgKyAiLnR4biIpOwogICAgICAgICAgICAgICAgICAgIGlmICgh\nam91cm5hbEZpbGUuZGVsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLndhcm4oIkNvdWxkIG5vdCBkZWxldGUgb2xkIGpvdXJuYWwgZmls\nZSB7fSIsIGpvdXJuYWxGaWxlKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgTE9HLmluZm8oImdhcmJhZ2UgY29sbGVjdGVk\nIGpvdXJuYWwgIiArIGpvdXJuYWxGaWxlLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTY2FuIHRoZSBqb3VybmFsCiAgICAgKgogICAgICogQHBh\ncmFtIGpvdXJuYWxJZAogICAgICogICAgICAgICAgSm91cm5hbCBMb2cgSWQK\nICAgICAqIEBwYXJhbSBqb3VybmFsUG9zCiAgICAgKiAgICAgICAgICBPZmZz\nZXQgdG8gc3RhcnQgc2Nhbm5pbmcKICAgICAqIEBwYXJhbSBzY2FubmVyCiAg\nICAgKiAgICAgICAgICBTY2FubmVyIHRvIGhhbmRsZSBlbnRyaWVzCiAgICAg\nKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNjYW5Kb3VybmFsKGxvbmcgam91cm5hbElkLCBsb25nIGpvdXJuYWxQb3Ms\nIEpvdXJuYWxTY2FubmVyIHNjYW5uZXIpCiAgICAgICAgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICBKb3VybmFsQ2hhbm5lbCByZWNMb2c7CiAgICAg\nICAgaWYgKGpvdXJuYWxQb3MgPD0gMCkgewogICAgICAgICAgICByZWNMb2cg\nPSBuZXcgSm91cm5hbENoYW5uZWwoam91cm5hbERpcmVjdG9yeSwgam91cm5h\nbElkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWNMb2cgPSBu\nZXcgSm91cm5hbENoYW5uZWwoam91cm5hbERpcmVjdG9yeSwgam91cm5hbElk\nLCBqb3VybmFsUG9zKTsKICAgICAgICB9CiAgICAgICAgaW50IGpvdXJuYWxW\nZXJzaW9uID0gcmVjTG9nLmdldEZvcm1hdFZlcnNpb24oKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBCeXRlQnVmZmVyIGxlbkJ1ZmYgPSBCeXRlQnVm\nZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAgICBCeXRlQnVmZmVyIHJlY0J1\nZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDY0KjEwMjQpOwogICAgICAgICAg\nICB3aGlsZSh0cnVlKSB7CiAgICAgICAgICAgICAgICAvLyBlbnRyeSBzdGFy\ndCBvZmZzZXQKICAgICAgICAgICAgICAgIGxvbmcgb2Zmc2V0ID0gcmVjTG9n\nLmZjLnBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgICAvLyBzdGFydCByZWFk\naW5nIGVudHJ5CiAgICAgICAgICAgICAgICBsZW5CdWZmLmNsZWFyKCk7CiAg\nICAgICAgICAgICAgICBmdWxsUmVhZChyZWNMb2csIGxlbkJ1ZmYpOwogICAg\nICAgICAgICAgICAgaWYgKGxlbkJ1ZmYucmVtYWluaW5nKCkgIT0gMCkgewog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgbGVuQnVmZi5mbGlwKCk7CiAgICAgICAgICAgICAg\nICBpbnQgbGVuID0gbGVuQnVmZi5nZXRJbnQoKTsKICAgICAgICAgICAgICAg\nIGlmIChsZW4gPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVjQnVmZi5jbGVh\ncigpOwogICAgICAgICAgICAgICAgaWYgKHJlY0J1ZmYucmVtYWluaW5nKCkg\nPCBsZW4pIHsKICAgICAgICAgICAgICAgICAgICByZWNCdWZmID0gQnl0ZUJ1\nZmZlci5hbGxvY2F0ZShsZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgcmVjQnVmZi5saW1pdChsZW4pOwogICAgICAgICAgICAgICAg\naWYgKGZ1bGxSZWFkKHJlY0xvZywgcmVjQnVmZikgIT0gbGVuKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gVGhpcyBzZWVtcyBzY2FyeSwgYnV0IGl0IGp1\nc3QgbWVhbnMgdGhhdCB0aGlzIGlzIHdoZXJlIHdlCiAgICAgICAgICAgICAg\nICAgICAgLy8gbGVmdCBvZmYgd3JpdGluZwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVj\nQnVmZi5mbGlwKCk7CiAgICAgICAgICAgICAgICBzY2FubmVyLnByb2Nlc3Mo\nam91cm5hbFZlcnNpb24sIG9mZnNldCwgcmVjQnVmZik7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICByZWNMb2cuY2xv\nc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYXkg\nam91cm5hbCBmaWxlcwogICAgICoKICAgICAqIEBwYXJhbSBzY2FubmVyCiAg\nICAgKiAgICAgICAgICBTY2FubmVyIHRvIHByb2Nlc3MgcmVwbGF5ZWQgZW50\ncmllcy4KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwogICAg\ncHVibGljIHZvaWQgcmVwbGF5KEpvdXJuYWxTY2FubmVyIHNjYW5uZXIpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgbG9uZyBtYXJrZWRM\nb2dJZCA9IGxhc3RMb2dNYXJrLmdldFR4bkxvZ0lkKCk7CiAgICAgICAgTGlz\ndDxMb25nPiBsb2dzID0gbGlzdEpvdXJuYWxJZHMoam91cm5hbERpcmVjdG9y\neSwgbmV3IEpvdXJuYWxJZEZpbHRlcigpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChsb25nIGpv\ndXJuYWxJZCkgewogICAgICAgICAgICAgICAgaWYgKGpvdXJuYWxJZCA8IG1h\ncmtlZExvZ0lkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAvLyBsYXN0\nIGxvZyBtYXJrIG1heSBiZSBtaXNzZWQgZHVlIHRvIG5vIHN5bmMgdXAgYmVm\nb3JlCiAgICAgICAgLy8gdmFsaWRhdGUgZmlsdGVyZWQgbG9nIGlkcyBvbmx5\nIHdoZW4gd2UgaGF2ZSBtYXJrZWRMb2dJZAogICAgICAgIGlmIChtYXJrZWRM\nb2dJZCA+IDApIHsKICAgICAgICAgICAgaWYgKGxvZ3Muc2l6ZSgpID09IDAg\nfHwgbG9ncy5nZXQoMCkgIT0gbWFya2VkTG9nSWQpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiUmVjb3ZlcnkgbG9nICIgKyBt\nYXJrZWRMb2dJZCArICIgaXMgbWlzc2luZyIpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIExPRy5kZWJ1ZygiVHJ5IHRvIHJlbGF5IGpvdXJu\nYWwgbG9ncyA6IHt9IiwgbG9ncyk7CiAgICAgICAgLy8gVE9ETzogV2hlbiBy\nZWFkaW5nIGluIHRoZSBqb3VybmFsIGxvZ3MgdGhhdCBuZWVkIHRvIGJlIHN5\nbmNlZCwgd2UKICAgICAgICAvLyBzaG91bGQgdXNlIEJ1ZmZlcmVkQ2hhbm5l\nbHMgaW5zdGVhZCB0byBtaW5pbWl6ZSB0aGUgYW1vdW50IG9mCiAgICAgICAg\nLy8gc3lzdGVtIGNhbGxzIGRvbmUuCiAgICAgICAgZm9yKExvbmcgaWQ6IGxv\nZ3MpIHsKICAgICAgICAgICAgbG9uZyBsb2dQb3NpdGlvbiA9IDBMOwogICAg\nICAgICAgICBpZihpZCA9PSBtYXJrZWRMb2dJZCkgewogICAgICAgICAgICAg\nICAgbG9nUG9zaXRpb24gPSBsYXN0TG9nTWFyay5nZXRUeG5Mb2dQb3NpdGlv\nbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExPRy5pbmZvKCJSZXBs\nYXlpbmcgam91cm5hbCB7fSBmcm9tIHBvc2l0aW9uIHt9IiwgaWQsIGxvZ1Bv\nc2l0aW9uKTsKICAgICAgICAgICAgc2NhbkpvdXJuYWwoaWQsIGxvZ1Bvc2l0\naW9uLCBzY2FubmVyKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiByZWNvcmQgYW4gYWRkIGVudHJ5IG9wZXJhdGlvbiBpbiBqb3VybmFsCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGxvZ0FkZEVudHJ5KEJ5dGVCdWZmZXIg\nZW50cnksIFdyaXRlQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgpIHsKICAgICAg\nICBsb25nIGxlZGdlcklkID0gZW50cnkuZ2V0TG9uZygpOwogICAgICAgIGxv\nbmcgZW50cnlJZCA9IGVudHJ5LmdldExvbmcoKTsKICAgICAgICBlbnRyeS5y\nZXdpbmQoKTsKICAgICAgICBxdWV1ZS5hZGQobmV3IFF1ZXVlRW50cnkoZW50\ncnksIGxlZGdlcklkLCBlbnRyeUlkLCBjYiwgY3R4KSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHZXQgdGhlIGxlbmd0aCBvZiBqb3VybmFsIGVudHJpZXMg\ncXVldWUuCiAgICAgKgogICAgICogQHJldHVybiBsZW5ndGggb2Ygam91cm5h\nbCBlbnRyeSBxdWV1ZS4KICAgICAqLwogICAgcHVibGljIGludCBnZXRKb3Vy\nbmFsUXVldWVMZW5ndGgoKSB7CiAgICAgICAgcmV0dXJuIHF1ZXVlLnNpemUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEEgdGhyZWFkIHVzZWQgZm9yIHBl\ncnNpc3Rpbmcgam91cm5hbCBlbnRyaWVzIHRvIGpvdXJuYWwgZmlsZXMuCiAg\nICAgKgogICAgICogPHA+CiAgICAgKiBCZXNpZGVzIHBlcnNpc3Rpbmcgam91\ncm5hbCBlbnRyaWVzLCBpdCBhbHNvIHRha2VzIHJlc3BvbnNpYmlsaXR5IG9m\nCiAgICAgKiByb2xsaW5nIGpvdXJuYWwgZmlsZXMgd2hlbiBhIGpvdXJuYWwg\nZmlsZSByZWFjaGVzIGpvdXJuYWwgZmlsZSBzaXplCiAgICAgKiBsaW1pdGF0\naW9uLgogICAgICogPC9wPgogICAgICogPHA+CiAgICAgKiBEdXJpbmcgam91\ncm5hbCByb2xsaW5nLCBpdCBmaXJzdCBjbG9zZXMgdGhlIHdyaXRpbmcgam91\ncm5hbCwgZ2VuZXJhdGVzCiAgICAgKiBuZXcgam91cm5hbCBmaWxlIHVzaW5n\nIGN1cnJlbnQgdGltZXN0YW1wLCBhbmQgY29udGludWUgcGVyc2lzdGVuY2Ug\nbG9naWMuCiAgICAgKiBUaG9zZSBqb3VybmFscyB3aWxsIGJlIGdhcmJhZ2Ug\nY29sbGVjdGVkIGluIFN5bmNUaHJlYWQuCiAgICAgKiA8L3A+CiAgICAgKiBA\nc2VlIEJvb2tpZSNTeW5jVGhyZWFkCiAgICAgKi8KICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIExpbmtlZExpc3Q8UXVl\ndWVFbnRyeT4gdG9GbHVzaCA9IG5ldyBMaW5rZWRMaXN0PFF1ZXVlRW50cnk+\nKCk7CiAgICAgICAgQnl0ZUJ1ZmZlciBsZW5CdWZmID0gQnl0ZUJ1ZmZlci5h\nbGxvY2F0ZSg0KTsKICAgICAgICBKb3VybmFsQ2hhbm5lbCBsb2dGaWxlID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBMaXN0PExvbmc+IGpv\ndXJuYWxJZHMgPSBsaXN0Sm91cm5hbElkcyhqb3VybmFsRGlyZWN0b3J5LCBu\ndWxsKTsKICAgICAgICAgICAgLy8gU2hvdWxkIG5vdCB1c2UgTWF0aFV0aWxz\nLm5vdygpLCB3aGljaCB1c2UgU3lzdGVtLm5hbm9UaW1lKCkgYW5kCiAgICAg\nICAgICAgIC8vIGNvdWxkIG9ubHkgYmUgdXNlZCB0byBtZWFzdXJlIGVsYXBz\nZWQgdGltZS4KICAgICAgICAgICAgLy8gaHR0cDovL2RvY3Mub3JhY2xlLmNv\nbS9qYXZhc2UvMS41LjAvZG9jcy9hcGkvamF2YS9sYW5nL1N5c3RlbS5odG1s\nI25hbm9UaW1lJTI4JTI5CiAgICAgICAgICAgIGxvbmcgbG9nSWQgPSBqb3Vy\nbmFsSWRzLmlzRW1wdHkoKSA/IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nIDogam91cm5hbElkcy5nZXQoam91cm5hbElkcy5zaXplKCkgLSAxKTsKICAg\nICAgICAgICAgQnVmZmVyZWRDaGFubmVsIGJjID0gbnVsbDsKICAgICAgICAg\nICAgbG9uZyBsYXN0Rmx1c2hQb3NpdGlvbiA9IDA7CgogICAgICAgICAgICBR\ndWV1ZUVudHJ5IHFlID0gbnVsbDsKICAgICAgICAgICAgd2hpbGUgKHRydWUp\nIHsKICAgICAgICAgICAgICAgIC8vIG5ldyBqb3VybmFsIGZpbGUgdG8gd3Jp\ndGUKICAgICAgICAgICAgICAgIGlmIChudWxsID09IGxvZ0ZpbGUpIHsKICAg\nICAgICAgICAgICAgICAgICBsb2dJZCA9IGxvZ0lkICsgMTsKICAgICAgICAg\nICAgICAgICAgICBsb2dGaWxlID0gbmV3IEpvdXJuYWxDaGFubmVsKGpvdXJu\nYWxEaXJlY3RvcnksIGxvZ0lkKTsKICAgICAgICAgICAgICAgICAgICBiYyA9\nIGxvZ0ZpbGUuZ2V0QnVmZmVyZWRDaGFubmVsKCk7CgogICAgICAgICAgICAg\nICAgICAgIGxhc3RGbHVzaFBvc2l0aW9uID0gMDsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICBpZiAocWUgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIGlmICh0b0ZsdXNoLmlzRW1wdHkoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBxZSA9IHF1ZXVlLnRha2UoKTsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBx\nZSA9IHF1ZXVlLnBvbGwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHFlID09IG51bGwgfHwgYmMucG9zaXRpb24oKSA+IGxhc3RGbHVzaFBvc2l0\naW9uICsgNTEyKjEwMjQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vbG9nRmlsZS5mb3JjZShmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBiYy5mbHVzaCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxhc3RGbHVzaFBvc2l0aW9uID0gYmMucG9zaXRpb24oKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RMb2dNYXJrLnNldExhc3RM\nb2dNYXJrKGxvZ0lkLCBsYXN0Rmx1c2hQb3NpdGlvbik7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmb3IgKFF1ZXVlRW50cnkgZSA6IHRvRmx1c2gp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmNiLndyaXRl\nQ29tcGxldGUoQm9va2llRXhjZXB0aW9uLkNvZGUuT0ssCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUubGVk\nZ2VySWQsIGUuZW50cnlJZCwgbnVsbCwgZS5jdHgpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndG9GbHVzaC5jbGVhcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGNoZWNrIHdoZXRoZXIgam91cm5hbCBmaWxlIGlzIG92ZXIgZmlsZSBs\naW1pdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJjLnBvc2l0\naW9uKCkgPiBtYXhKb3VybmFsU2l6ZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGxvZ0ZpbGUuY2xvc2UoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsb2dGaWxlID0gbnVsbDsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICBpZiAoIXJ1bm5pbmcpIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiSm91cm5hbCBNYW5hZ2VyIGlzIGFza2VkIHRvIHNodXQgZG93\nbiwgcXVpdC4iKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocWUgPT0gbnVsbCkg\neyAvLyBubyBtb3JlIHF1ZXVlIGVudHJ5CiAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBs\nZW5CdWZmLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBsZW5CdWZmLnB1dElu\ndChxZS5lbnRyeS5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgICAgICBsZW5C\ndWZmLmZsaXAoKTsKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAg\nICAvLyB3ZSBzaG91bGQgYmUgZG9pbmcgdGhlIGZvbGxvd2luZywgYnV0IHRo\nZW4gd2UgcnVuIG91dCBvZgogICAgICAgICAgICAgICAgLy8gZGlyZWN0IGJ5\ndGUgYnVmZmVycwogICAgICAgICAgICAgICAgLy8gbG9nRmlsZS53cml0ZShu\nZXcgQnl0ZUJ1ZmZlcltdIHsgbGVuQnVmZiwgcWUuZW50cnkgfSk7CiAgICAg\nICAgICAgICAgICBiYy53cml0ZShsZW5CdWZmKTsKICAgICAgICAgICAgICAg\nIGJjLndyaXRlKHFlLmVudHJ5KTsKCiAgICAgICAgICAgICAgICBsb2dGaWxl\nLnByZUFsbG9jSWZOZWVkZWQoKTsKCiAgICAgICAgICAgICAgICB0b0ZsdXNo\nLmFkZChxZSk7CiAgICAgICAgICAgICAgICBxZSA9IG51bGw7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgbG9nRmlsZS5jbG9zZSgpOwogICAgICAgICAg\nICBsb2dGaWxlID0gbnVsbDsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBpb2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJL08gZXhjZXB0aW9u\nIGluIEpvdXJuYWwgdGhyZWFkISIsIGlvZSk7CiAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgTE9HLndh\ncm4oIkpvdXJuYWwgZXhpdHMgd2hlbiBzaHV0dGluZyBkb3duIiwgaWUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIElPVXRpbHMuY2xvc2Uo\nTE9HLCBsb2dGaWxlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTaHV0cyBkb3duIHRoZSBqb3VybmFsLgogICAgICovCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIHZvaWQgc2h1dGRvd24oKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKCFydW5uaW5nKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcnVubmluZyA9IGZh\nbHNlOwogICAgICAgICAgICB0aGlzLmludGVycnVwdCgpOwogICAgICAgICAg\nICB0aGlzLmpvaW4oKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBpZSkgewogICAgICAgICAgICBMT0cud2FybigiSW50ZXJydXB0\nZWQgZHVyaW5nIHNodXR0aW5nIGRvd24gam91cm5hbCA6ICIsIGllKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgaW50IGZ1bGxSZWFk\nKEpvdXJuYWxDaGFubmVsIGZjLCBCeXRlQnVmZmVyIGJiKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGludCB0b3RhbCA9IDA7CiAgICAgICAgd2hp\nbGUoYmIucmVtYWluaW5nKCkgPiAwKSB7CiAgICAgICAgICAgIGludCByYyA9\nIGZjLnJlYWQoYmIpOwogICAgICAgICAgICBpZiAocmMgPD0gMCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHRvdGFsICs9IHJjOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\ndG90YWw7CiAgICB9Cn0K\n","encoding":"base64"}

