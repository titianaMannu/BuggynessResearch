{"sha":"e55ba7b417985e77f0371ce9cd0804a510b6a0cc","node_id":"MDQ6QmxvYjE1NzU5NTY6ZTU1YmE3YjQxNzk4NWU3N2YwMzcxY2U5Y2QwODA0YTUxMGI2YTBjYw==","size":5476,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/e55ba7b417985e77f0371ce9cd0804a510b6a0cc","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS51dGlsLkFycmF5czsKCmltcG9ydCBqYXZhLmlvLkNsb3Nl\nYWJsZTsKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uUmFu\nZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247Cmlt\ncG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxlQ2hhbm5lbDsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIFNpbXBs\nZSB3cmFwcGVyIGFyb3VuZCBGaWxlQ2hhbm5lbCB0byBhZGQgdmVyc2lvbmlu\nZwogKiBpbmZvcm1hdGlvbiB0byB0aGUgZmlsZS4KICovCmNsYXNzIEpvdXJu\nYWxDaGFubmVsIGltcGxlbWVudHMgQ2xvc2VhYmxlIHsKICAgIHN0YXRpYyBM\nb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSm91cm5hbENo\nYW5uZWwuY2xhc3MpOwoKICAgIGZpbmFsIEZpbGVDaGFubmVsIGZjOwogICAg\nZmluYWwgQnVmZmVyZWRDaGFubmVsIGJjOwogICAgZmluYWwgaW50IGZvcm1h\ndFZlcnNpb247CiAgICBsb25nIG5leHRQcmVhbGxvYyA9IDA7CgogICAgZmlu\nYWwgYnl0ZVtdIE1BR0lDX1dPUkQgPSAiQktMRyIuZ2V0Qnl0ZXMoKTsKCiAg\nICBwcml2YXRlIGZpbmFsIHN0YXRpYyBpbnQgU1RBUlRfT0ZfRklMRSA9IC0x\nMjM0NTsKCiAgICBpbnQgSEVBREVSX1NJWkUgPSA4OyAvLyA0Ynl0ZSBtYWdp\nYyB3b3JkLCA0IGJ5dGUgdmVyc2lvbgogICAgaW50IE1JTl9DT01QQVRfSk9V\nUk5BTF9GT1JNQVRfVkVSU0lPTiA9IDE7CiAgICBpbnQgQ1VSUkVOVF9KT1VS\nTkFMX0ZPUk1BVF9WRVJTSU9OID0gNDsKCiAgICBwdWJsaWMgZmluYWwgc3Rh\ndGljIGxvbmcgcHJlQWxsb2NTaXplID0gNCoxMDI0KjEwMjQ7CiAgICBwdWJs\naWMgZmluYWwgc3RhdGljIEJ5dGVCdWZmZXIgemVyb3MgPSBCeXRlQnVmZmVy\nLmFsbG9jYXRlKDUxMik7CgogICAgSm91cm5hbENoYW5uZWwoRmlsZSBqb3Vy\nbmFsRGlyZWN0b3J5LCBsb25nIGxvZ0lkKSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIHRoaXMoam91cm5hbERpcmVjdG9yeSwgbG9nSWQsIFNUQVJU\nX09GX0ZJTEUpOwogICAgfQoKICAgIEpvdXJuYWxDaGFubmVsKEZpbGUgam91\ncm5hbERpcmVjdG9yeSwgbG9uZyBsb2dJZCwgbG9uZyBwb3NpdGlvbikgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIGZuID0gbmV3IEZpbGUo\nam91cm5hbERpcmVjdG9yeSwgTG9uZy50b0hleFN0cmluZyhsb2dJZCkgKyAi\nLnR4biIpOwoKICAgICAgICBMT0cuaW5mbygiT3BlbmluZyBqb3VybmFsIHt9\nIiwgZm4pOwogICAgICAgIGlmICghZm4uZXhpc3RzKCkpIHsgLy8gbmV3IGZp\nbGUsIHdyaXRlIHZlcnNpb24KICAgICAgICAgICAgaWYgKCFmbi5jcmVhdGVO\nZXdGaWxlKCkpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiSm91cm5h\nbCBmaWxlIHt9LCB0aGF0IHNob3VsZG4ndCBleGlzdCwgYWxyZWFkeSBleGlz\ndHMuICIKICAgICAgICAgICAgICAgICAgICAgICAgICArICIgaXMgdGhlcmUg\nYW5vdGhlciBib29raWUgcHJvY2VzcyBydW5uaW5nPyIsIGZuKTsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRmlsZSAiICsgZm4K\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHN1ZGRlbmx5IGFwcGVhcmVk\nLCBpcyBhbm90aGVyIGJvb2tpZSBwcm9jZXNzIHJ1bm5pbmc/Iik7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgZmMgPSBuZXcgUmFuZG9tQWNjZXNzRmls\nZShmbiwgInJ3IikuZ2V0Q2hhbm5lbCgpOwogICAgICAgICAgICBmb3JtYXRW\nZXJzaW9uID0gQ1VSUkVOVF9KT1VSTkFMX0ZPUk1BVF9WRVJTSU9OOwoKICAg\nICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUo\nSEVBREVSX1NJWkUpOwogICAgICAgICAgICBiYi5wdXQoTUFHSUNfV09SRCk7\nCiAgICAgICAgICAgIGJiLnB1dEludChmb3JtYXRWZXJzaW9uKTsKICAgICAg\nICAgICAgYmIuZmxpcCgpOwogICAgICAgICAgICBmYy53cml0ZShiYik7CiAg\nICAgICAgICAgIGZjLmZvcmNlKHRydWUpOwoKICAgICAgICAgICAgYmMgPSBu\nZXcgQnVmZmVyZWRDaGFubmVsKGZjLCA2NTUzNik7CgogICAgICAgICAgICBu\nZXh0UHJlYWxsb2MgPSBwcmVBbGxvY1NpemU7CiAgICAgICAgICAgIGZjLndy\naXRlKHplcm9zLCBuZXh0UHJlYWxsb2MpOwogICAgICAgIH0gZWxzZSB7ICAv\nLyBvcGVuIGFuIGV4aXN0aW5nIGZpbGUKICAgICAgICAgICAgZmMgPSBuZXcg\nUmFuZG9tQWNjZXNzRmlsZShmbiwgInIiKS5nZXRDaGFubmVsKCk7CiAgICAg\nICAgICAgIGJjID0gbnVsbDsgLy8gcmVhZG9ubHkKCiAgICAgICAgICAgIEJ5\ndGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKEhFQURFUl9TSVpF\nKTsKICAgICAgICAgICAgaW50IGMgPSBmYy5yZWFkKGJiKTsKICAgICAgICAg\nICAgYmIuZmxpcCgpOwoKICAgICAgICAgICAgaWYgKGMgPT0gSEVBREVSX1NJ\nWkUpIHsKICAgICAgICAgICAgICAgIGJ5dGVbXSBmaXJzdDQgPSBuZXcgYnl0\nZVs0XTsKICAgICAgICAgICAgICAgIGJiLmdldChmaXJzdDQpOwoKICAgICAg\nICAgICAgICAgIGlmIChBcnJheXMuZXF1YWxzKGZpcnN0NCwgTUFHSUNfV09S\nRCkpIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXRWZXJzaW9uID0gYmIu\nZ2V0SW50KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIC8vIHByZSBtYWdpYyB3b3JkIGpvdXJuYWwsIHJlc2V0IHRv\nIDA7CiAgICAgICAgICAgICAgICAgICAgZm9ybWF0VmVyc2lvbiA9IDE7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAvLyBubyBoZWFkZXIsIG11c3QgYmUgb2xkIHZlcnNpb24KICAg\nICAgICAgICAgICAgIGZvcm1hdFZlcnNpb24gPSAxOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBpZiAoZm9ybWF0VmVyc2lvbiA8IE1JTl9DT01QQVRf\nSk9VUk5BTF9GT1JNQVRfVkVSU0lPTgogICAgICAgICAgICAgICAgfHwgZm9y\nbWF0VmVyc2lvbiA+IENVUlJFTlRfSk9VUk5BTF9GT1JNQVRfVkVSU0lPTikg\newogICAgICAgICAgICAgICAgU3RyaW5nIGVyciA9IFN0cmluZy5mb3JtYXQo\nIkludmFsaWQgam91cm5hbCB2ZXJzaW9uLCB1bmFibGUgdG8gcmVhZC4iCiAg\nICAgICAgICAgICAgICAgICAgICAgICsgIiBFeHBlY3RlZCBiZXR3ZWVuICgl\nZCkgYW5kICglZCksIGdvdCAoJWQpIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgTUlOX0NPTVBBVF9KT1VSTkFMX0ZPUk1BVF9WRVJTSU9OLCBDVVJSRU5U\nX0pPVVJOQUxfRk9STUFUX1ZFUlNJT04sCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZvcm1hdFZlcnNpb24pOwogICAgICAgICAgICAgICAgTE9HLmVycm9y\nKGVycik7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24o\nZXJyKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIGlmIChwb3NpdGlvbiA9PSBTVEFSVF9PRl9GSUxFKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGZvcm1hdFZlcnNpb24gPj0gMikgewog\nICAgICAgICAgICAgICAgICAgICAgICBmYy5wb3NpdGlvbihIRUFERVJfU0la\nRSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgZmMucG9zaXRpb24oMCk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBmYy5wb3NpdGlvbihwb3NpdGlvbik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIExPRy5lcnJvcigiQm9va2llIGpvdXJuYWwgZmlsZSBjYW4g\nc2VlayB0byBwb3NpdGlvbiA6IiwgZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgaW50IGdldEZvcm1hdFZlcnNpb24oKSB7CiAgICAg\nICAgcmV0dXJuIGZvcm1hdFZlcnNpb247CiAgICB9CgogICAgQnVmZmVyZWRD\naGFubmVsIGdldEJ1ZmZlcmVkQ2hhbm5lbCgpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGJjID09IG51bGwpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJSZWFkIG9ubHkgam91cm5hbCBjaGFubmVs\nIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBiYzsKICAgIH0KCiAgICB2\nb2lkIHByZUFsbG9jSWZOZWVkZWQoKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGlmIChiYy5wb3NpdGlvbigpID4gbmV4dFByZWFsbG9jKSB7CiAg\nICAgICAgICAgIG5leHRQcmVhbGxvYyA9ICgoZmMuc2l6ZSgpICsgSEVBREVS\nX1NJWkUpIC8gcHJlQWxsb2NTaXplICsgMSkgKiBwcmVBbGxvY1NpemU7CiAg\nICAgICAgICAgIHplcm9zLmNsZWFyKCk7CiAgICAgICAgICAgIGZjLndyaXRl\nKHplcm9zLCBuZXh0UHJlYWxsb2MpOwogICAgICAgIH0KICAgIH0KCiAgICBp\nbnQgcmVhZChCeXRlQnVmZmVyIGRzdCkKICAgICAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gZmMucmVhZChkc3QpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBmYy5jbG9zZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

