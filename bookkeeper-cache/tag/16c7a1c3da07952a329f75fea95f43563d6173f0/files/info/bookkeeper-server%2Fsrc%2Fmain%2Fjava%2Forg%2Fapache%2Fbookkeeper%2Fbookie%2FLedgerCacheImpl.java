{"sha":"8e316e64e63d2582fa920f7447ff5d4a3ce5cef9","node_id":"MDQ6QmxvYjE1NzU5NTY6OGUzMTZlNjRlNjNkMjU4MmZhOTIwZjc0NDdmZjVkNGEzY2U1Y2VmOQ==","size":33771,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8e316e64e63d2582fa920f7447ff5d4a3ce5cef9","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwpp\nbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRy\neTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNC\nb29sZWFuOwoKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLmFubm90YXRpb25z\nLlZpc2libGVGb3JUZXN0aW5nOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLlNuYXBzaG90TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmJvb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5MZWRnZXJEaXJzTGlz\ndGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkxl\nZGdlckRpcnNNYW5hZ2VyLk5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIEltcGxlbWVudGF0aW9u\nIG9mIExlZGdlckNhY2hlIGludGVyZmFjZS4KICogVGhpcyBjbGFzcyBzZXJ2\nZXMgdHdvIHB1cnBvc2VzLgogKi8KcHVibGljIGNsYXNzIExlZGdlckNhY2hl\nSW1wbCBpbXBsZW1lbnRzIExlZGdlckNhY2hlIHsKICAgIHByaXZhdGUgZmlu\nYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihMZWRnZXJDYWNoZUltcGwuY2xhc3MpOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3RyaW5nIElEWCA9ICIuaWR4IjsKICAgIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgUkxPQyA9ICIucmxvYyI7CgogICAgcHJpdmF0ZSBMZWRnZXJEaXJz\nTWFuYWdlciBsZWRnZXJEaXJzTWFuYWdlcjsKICAgIGZpbmFsIHByaXZhdGUg\nQXRvbWljQm9vbGVhbiBzaG91bGRSZWxvY2F0ZUluZGV4RmlsZSA9IG5ldyBB\ndG9taWNCb29sZWFuKGZhbHNlKTsKCiAgICBwdWJsaWMgTGVkZ2VyQ2FjaGVJ\nbXBsKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiwgU25hcHNob3RNYXA8TG9u\nZywgQm9vbGVhbj4gYWN0aXZlTGVkZ2VycywKICAgICAgICAgICAgTGVkZ2Vy\nRGlyc01hbmFnZXIgbGVkZ2VyRGlyc01hbmFnZXIpCiAgICAgICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5sZWRnZXJEaXJzTWFu\nYWdlciA9IGxlZGdlckRpcnNNYW5hZ2VyOwogICAgICAgIHRoaXMub3BlbkZp\nbGVMaW1pdCA9IGNvbmYuZ2V0T3BlbkZpbGVMaW1pdCgpOwogICAgICAgIHRo\naXMucGFnZVNpemUgPSBjb25mLmdldFBhZ2VTaXplKCk7CiAgICAgICAgdGhp\ncy5lbnRyaWVzUGVyUGFnZSA9IHBhZ2VTaXplIC8gODsKCiAgICAgICAgaWYg\nKGNvbmYuZ2V0UGFnZUxpbWl0KCkgPD0gMCkgewogICAgICAgICAgICAvLyBh\nbGxvY2F0ZSBoYWxmIG9mIHRoZSBtZW1vcnkgdG8gdGhlIHBhZ2UgY2FjaGUK\nICAgICAgICAgICAgdGhpcy5wYWdlTGltaXQgPSAoaW50KSgoUnVudGltZS5n\nZXRSdW50aW1lKCkubWF4TWVtb3J5KCkgLyAzKSAvIHRoaXMucGFnZVNpemUp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMucGFnZUxpbWl0\nID0gY29uZi5nZXRQYWdlTGltaXQoKTsKICAgICAgICB9CiAgICAgICAgTE9H\nLmluZm8oIm1heE1lbW9yeSA9ICIgKyBSdW50aW1lLmdldFJ1bnRpbWUoKS5t\nYXhNZW1vcnkoKSk7CiAgICAgICAgTE9HLmluZm8oIm9wZW5GaWxlTGltaXQg\naXMgIiArIG9wZW5GaWxlTGltaXQgKyAiLCBwYWdlU2l6ZSBpcyAiICsgcGFn\nZVNpemUgKyAiLCBwYWdlTGltaXQgaXMgIiArIHBhZ2VMaW1pdCk7CiAgICAg\nICAgdGhpcy5hY3RpdmVMZWRnZXJzID0gYWN0aXZlTGVkZ2VyczsKICAgICAg\nICAvLyBSZXRyaWV2ZSBhbGwgb2YgdGhlIGFjdGl2ZSBsZWRnZXJzLgogICAg\nICAgIGdldEFjdGl2ZUxlZGdlcnMoKTsKICAgICAgICBsZWRnZXJEaXJzTWFu\nYWdlci5hZGRMZWRnZXJEaXJzTGlzdGVuZXIoZ2V0TGVkZ2VyRGlyc0xpc3Rl\nbmVyKCkpOwogICAgfQogICAgLyoqCiAgICAgKiB0aGUgbGlzdCBvZiBwb3Rl\nbnRpYWxseSBjbGVhbiBsZWRnZXJzCiAgICAgKi8KICAgIExpbmtlZExpc3Q8\nTG9uZz4gY2xlYW5MZWRnZXJzID0gbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsK\nCiAgICAvKioKICAgICAqIHRoZSBsaXN0IG9mIHBvdGVudGlhbGx5IGRpcnR5\nIGxlZGdlcnMKICAgICAqLwogICAgTGlua2VkTGlzdDxMb25nPiBkaXJ0eUxl\nZGdlcnMgPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwoKICAgIEhhc2hNYXA8\nTG9uZywgRmlsZUluZm8+IGZpbGVJbmZvQ2FjaGUgPSBuZXcgSGFzaE1hcDxM\nb25nLCBGaWxlSW5mbz4oKTsKCiAgICBMaW5rZWRMaXN0PExvbmc+IG9wZW5M\nZWRnZXJzID0gbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsKCiAgICAvLyBNYW5h\nZ2UgYWxsIGFjdGl2ZSBsZWRnZXJzIGluIExlZGdlck1hbmFnZXIKICAgIC8v\nIHNvIExlZGdlck1hbmFnZXIgaGFzIGtub3dsZWRnZSB0byBnYXJiYWdlIGNv\nbGxlY3QgaW5hY3RpdmUvZGVsZXRlZCBsZWRnZXJzCiAgICBmaW5hbCBTbmFw\nc2hvdE1hcDxMb25nLCBCb29sZWFuPiBhY3RpdmVMZWRnZXJzOwoKICAgIGZp\nbmFsIGludCBvcGVuRmlsZUxpbWl0OwogICAgZmluYWwgaW50IHBhZ2VTaXpl\nOwogICAgZmluYWwgaW50IHBhZ2VMaW1pdDsKICAgIGZpbmFsIGludCBlbnRy\naWVzUGVyUGFnZTsKCiAgICAvKioKICAgICAqIEByZXR1cm4gcGFnZSBzaXpl\nIHVzZWQgaW4gbGVkZ2VyIGNhY2hlCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0UGFnZVNpemUoKSB7CiAgICAgICAgcmV0dXJuIHBhZ2VTaXplOwogICAg\nfQoKICAgIC8qKgogICAgICogQHJldHVybiBlbnRyaWVzIHBlciBwYWdlIHVz\nZWQgaW4gbGVkZ2VyIGNhY2hlCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0\nRW50cmllc1BlclBhZ2UoKSB7CiAgICAgICAgcmV0dXJuIGVudHJpZXNQZXJQ\nYWdlOwogICAgfQoKICAgIC8qKgogICAgICogQHJldHVybiBwYWdlIGxpbWl0\nYXRpb24gaW4gbGVkZ2VyIGNhY2hlCiAgICAgKi8KICAgIHB1YmxpYyBpbnQg\nZ2V0UGFnZUxpbWl0KCkgewogICAgICAgIHJldHVybiBwYWdlTGltaXQ7CiAg\nICB9CgogICAgLy8gVGhlIG51bWJlciBvZiBwYWdlcyB0aGF0IGhhdmUgYWN0\ndWFsbHkgYmVlbiB1c2VkCiAgICBwcml2YXRlIGludCBwYWdlQ291bnQgPSAw\nOwogICAgSGFzaE1hcDxMb25nLCBIYXNoTWFwPExvbmcsTGVkZ2VyRW50cnlQ\nYWdlPj4gcGFnZXMgPSBuZXcgSGFzaE1hcDxMb25nLCBIYXNoTWFwPExvbmcs\nTGVkZ2VyRW50cnlQYWdlPj4oKTsKCiAgICAvKioKICAgICAqIEByZXR1cm4g\nbnVtYmVyIG9mIHBhZ2UgdXNlZCBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwog\nICAgcHVibGljIGludCBnZXROdW1Vc2VkUGFnZXMoKSB7CiAgICAgICAgcmV0\ndXJuIHBhZ2VDb3VudDsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcHV0SW50\nb1RhYmxlKEhhc2hNYXA8TG9uZywgSGFzaE1hcDxMb25nLExlZGdlckVudHJ5\nUGFnZT4+IHRhYmxlLCBMZWRnZXJFbnRyeVBhZ2UgbGVwKSB7CiAgICAgICAg\nSGFzaE1hcDxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+IG1hcCA9IHRhYmxlLmdl\ndChsZXAuZ2V0TGVkZ2VyKCkpOwogICAgICAgIGlmIChtYXAgPT0gbnVsbCkg\newogICAgICAgICAgICBtYXAgPSBuZXcgSGFzaE1hcDxMb25nLCBMZWRnZXJF\nbnRyeVBhZ2U+KCk7CiAgICAgICAgICAgIHRhYmxlLnB1dChsZXAuZ2V0TGVk\nZ2VyKCksIG1hcCk7CiAgICAgICAgfQogICAgICAgIG1hcC5wdXQobGVwLmdl\ndEZpcnN0RW50cnkoKSwgbGVwKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBMZWRnZXJFbnRyeVBhZ2UgZ2V0RnJvbVRhYmxlKEhhc2hNYXA8TG9uZywg\nSGFzaE1hcDxMb25nLExlZGdlckVudHJ5UGFnZT4+IHRhYmxlLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb25n\nIGxlZGdlciwgTG9uZyBmaXJzdEVudHJ5KSB7CiAgICAgICAgSGFzaE1hcDxM\nb25nLCBMZWRnZXJFbnRyeVBhZ2U+IG1hcCA9IHRhYmxlLmdldChsZWRnZXIp\nOwogICAgICAgIGlmIChtYXAgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1\ncm4gbWFwLmdldChmaXJzdEVudHJ5KTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgc3luY2hyb25pemVkIHByb3RlY3RlZCBM\nZWRnZXJFbnRyeVBhZ2UgZ2V0TGVkZ2VyRW50cnlQYWdlKExvbmcgbGVkZ2Vy\nLCBMb25nIGZpcnN0RW50cnksIGJvb2xlYW4gb25seURpcnR5KSB7CiAgICAg\nICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGdldEZyb21UYWJsZShwYWdlcywg\nbGVkZ2VyLCBmaXJzdEVudHJ5KTsKICAgICAgICBpZiAobGVwID09IG51bGwp\nIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAg\nICBsZXAudXNlUGFnZSgpOwoKICAgICAgICBpZiAob25seURpcnR5ICYmIGxl\ncC5pc0NsZWFuKCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIGxlcDsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqIAogICAgICogR3JhYiBsZWRnZXIgZW50cnkgcGFn\nZSB3aG9zZSBmaXJzdCBlbnRyeSBpcyA8Y29kZT5wYWdlRW50cnk8L2NvZGU+\nLgogICAgICoKICAgICAqIElmIHRoZSBwYWdlIGRvZXNuJ3QgZXhpc3RlZCBi\nZWZvcmUsIHdlIGFsbG9jYXRlIGEgbWVtb3J5IHBhZ2UuCiAgICAgKiBPdGhl\ncndpc2UsIHdlIGdyYWIgYSBjbGVhbiBwYWdlIGFuZCByZWFkIGl0IGZyb20g\nZGlzay4KICAgICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VyCiAgICAgKiAgICAg\nICAgICBMZWRnZXIgSWQKICAgICAqIEBwYXJhbSBwYWdlRW50cnkKICAgICAq\nICAgICAgICAgIFN0YXJ0IGVudHJ5IG9mIHRoaXMgZW50cnkgcGFnZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBMZWRnZXJFbnRyeVBhZ2UgZ3JhYkxlZGdlckVu\ndHJ5UGFnZShsb25nIGxlZGdlciwgbG9uZyBwYWdlRW50cnkpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGdy\nYWJDbGVhblBhZ2UobGVkZ2VyLCBwYWdlRW50cnkpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIC8vIHNob3VsZCB1cGRhdGUgcGFnZSBiZWZvcmUgd2Ug\ncHV0IGl0IGludG8gdGFibGUKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHdl\nIHdvdWxkIHB1dCBhbiBlbXB0eSBwYWdlIGluIGl0CiAgICAgICAgICAgIHVw\nZGF0ZVBhZ2UobGVwKTsKICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMp\nIHsKICAgICAgICAgICAgICAgIHB1dEludG9UYWJsZShwYWdlcywgbGVwKTsK\nICAgICAgICAgICAgfSAgIAogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGllKSB7CiAgICAgICAgICAgIC8vIGlmIHdlIGdyYWIgYSBjbGVhbiBwYWdl\nLCBidXQgZmFpbGVkIHRvIHVwZGF0ZSB0aGUgcGFnZQogICAgICAgICAgICAv\nLyB3ZSBhcmUgZXhoYXVzdGluZyB0aGUgY291bnQgb2YgbGVkZ2VyIGVudHJ5\nIHBhZ2VzLgogICAgICAgICAgICAvLyBzaW5jZSB0aGlzIHBhZ2Ugd2lsbCBi\nZSBuZXZlciB1c2VkLCBzbyB3ZSBuZWVkIHRvIGRlY3JlbWVudAogICAgICAg\nICAgICAvLyBwYWdlIGNvdW50IG9mIGxlZGdlciBjYWNoZS4KICAgICAgICAg\nICAgbGVwLnJlbGVhc2VQYWdlKCk7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICAgICAgLS1wYWdlQ291bnQ7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgaWU7IAogICAgICAgIH0gICAK\nICAgICAgICByZXR1cm4gbGVwOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgcHV0RW50cnlPZmZzZXQobG9uZyBsZWRnZXIsIGxvbmcg\nZW50cnksIGxvbmcgb2Zmc2V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIGludCBvZmZzZXRJblBhZ2UgPSAoaW50KSAoZW50cnkgJSBlbnRyaWVz\nUGVyUGFnZSk7CiAgICAgICAgLy8gZmluZCB0aGUgaWQgb2YgdGhlIGZpcnN0\nIGVudHJ5IG9mIHRoZSBwYWdlIHRoYXQgaGFzIHRoZSBlbnRyeQogICAgICAg\nIC8vIHdlIGFyZSBsb29raW5nIGZvcgogICAgICAgIGxvbmcgcGFnZUVudHJ5\nID0gZW50cnktb2Zmc2V0SW5QYWdlOwogICAgICAgIExlZGdlckVudHJ5UGFn\nZSBsZXAgPSBnZXRMZWRnZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50cnks\nIGZhbHNlKTsKICAgICAgICBpZiAobGVwID09IG51bGwpIHsKICAgICAgICAg\nICAgbGVwID0gZ3JhYkxlZGdlckVudHJ5UGFnZShsZWRnZXIsIHBhZ2VFbnRy\neSk7IAogICAgICAgIH0KICAgICAgICBpZiAobGVwICE9IG51bGwpIHsKICAg\nICAgICAgICAgbGVwLnNldE9mZnNldChvZmZzZXQsIG9mZnNldEluUGFnZSo4\nKTsKICAgICAgICAgICAgbGVwLnJlbGVhc2VQYWdlKCk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgbG9uZyBnZXRFbnRyeU9mZnNldChsb25nIGxlZGdlciwgbG9uZyBl\nbnRyeSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpbnQgb2Zmc2V0\nSW5QYWdlID0gKGludCkgKGVudHJ5JWVudHJpZXNQZXJQYWdlKTsKICAgICAg\nICAvLyBmaW5kIHRoZSBpZCBvZiB0aGUgZmlyc3QgZW50cnkgb2YgdGhlIHBh\nZ2UgdGhhdCBoYXMgdGhlIGVudHJ5CiAgICAgICAgLy8gd2UgYXJlIGxvb2tp\nbmcgZm9yCiAgICAgICAgbG9uZyBwYWdlRW50cnkgPSBlbnRyeS1vZmZzZXRJ\nblBhZ2U7CiAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGdldExlZGdl\nckVudHJ5UGFnZShsZWRnZXIsIHBhZ2VFbnRyeSwgZmFsc2UpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmIChsZXAgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgbGVwID0gZ3JhYkxlZGdlckVudHJ5UGFnZShsZWRnZXIsIHBh\nZ2VFbnRyeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGxl\ncC5nZXRPZmZzZXQob2Zmc2V0SW5QYWdlKjgpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChsZXAgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgbGVwLnJlbGVhc2VQYWdlKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgQFZpc2libGVGb3JUZXN0aW5nCiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIFN0cmluZyBnZXRMZWRnZXJOYW1lKGxvbmcgbGVkZ2Vy\nSWQpIHsKICAgICAgICBpbnQgcGFyZW50ID0gKGludCkgKGxlZGdlcklkICYg\nMHhmZik7CiAgICAgICAgaW50IGdyYW5kUGFyZW50ID0gKGludCkgKChsZWRn\nZXJJZCAmIDB4ZmYwMCkgPj4gOCk7CiAgICAgICAgU3RyaW5nQnVpbGRlciBz\nYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2IuYXBwZW5kKElu\ndGVnZXIudG9IZXhTdHJpbmcoZ3JhbmRQYXJlbnQpKTsKICAgICAgICBzYi5h\ncHBlbmQoJy8nKTsKICAgICAgICBzYi5hcHBlbmQoSW50ZWdlci50b0hleFN0\ncmluZyhwYXJlbnQpKTsKICAgICAgICBzYi5hcHBlbmQoJy8nKTsKICAgICAg\nICBzYi5hcHBlbmQoTG9uZy50b0hleFN0cmluZyhsZWRnZXJJZCkpOwogICAg\nICAgIHNiLmFwcGVuZChJRFgpOwogICAgICAgIHJldHVybiBzYi50b1N0cmlu\nZygpOwogICAgfQoKICAgIEZpbGVJbmZvIGdldEZpbGVJbmZvKExvbmcgbGVk\nZ2VyLCBieXRlIG1hc3RlcktleVtdKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIHN5bmNocm9uaXplZChmaWxlSW5mb0NhY2hlKSB7CiAgICAgICAg\nICAgIEZpbGVJbmZvIGZpID0gZmlsZUluZm9DYWNoZS5nZXQobGVkZ2VyKTsK\nICAgICAgICAgICAgaWYgKGZpID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIEZpbGUgbGYgPSBmaW5kSW5kZXhGaWxlKGxlZGdlcik7CiAgICAgICAgICAg\nICAgICBpZiAobGYgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChtYXN0ZXJLZXkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgQm9va2llLk5vTGVkZ2VyRXhjZXB0aW9uKGxlZGdlcik7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxm\nID0gZ2V0TmV3TGVkZ2VySW5kZXhGaWxlKGxlZGdlciwgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gQSBuZXcgbGVkZ2VyIGluZGV4IGZpbGUgaGFz\nIGJlZW4gY3JlYXRlZCBmb3IgdGhpcyBCb29raWUuCiAgICAgICAgICAgICAg\nICAgICAgLy8gQWRkIHRoaXMgbmV3IGxlZGdlciB0byB0aGUgc2V0IG9mIGFj\ndGl2ZSBsZWRnZXJzLgogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1Zygi\nTmV3IGxlZGdlciBpbmRleCBmaWxlIGNyZWF0ZWQgZm9yIGxlZGdlcklkOiB7\nfSIsIGxlZGdlcik7CiAgICAgICAgICAgICAgICAgICAgYWN0aXZlTGVkZ2Vy\ncy5wdXQobGVkZ2VyLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGV2aWN0RmlsZUluZm9JZk5lY2Vzc2FyeSgpOwogICAgICAg\nICAgICAgICAgZmkgPSBuZXcgRmlsZUluZm8obGYsIG1hc3RlcktleSk7CiAg\nICAgICAgICAgICAgICBmaWxlSW5mb0NhY2hlLnB1dChsZWRnZXIsIGZpKTsK\nICAgICAgICAgICAgICAgIG9wZW5MZWRnZXJzLmFkZChsZWRnZXIpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaSAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICBmaS51c2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gZmk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nR2V0IGEgbmV3IGluZGV4IGZpbGUgZm9yIGxlZGdlciBleGNsdWRpbmcgZGly\nZWN0b3J5IDxjb2RlPmV4Y2x1ZGVkRGlyPC9jb2RlPi4KICAgICAqCiAgICAg\nKiBAcGFyYW0gbGVkZ2VyCiAgICAgKiAgICAgICAgICBMZWRnZXIgaWQuCiAg\nICAgKiBAcGFyYW0gZXhjbHVkZWREaXIKICAgICAqICAgICAgICAgIFRoZSBs\nZWRnZXIgZGlyZWN0b3J5IHRvIGV4Y2x1ZGUuCiAgICAgKiBAcmV0dXJuIG5l\ndyBpbmRleCBmaWxlIG9iamVjdC4KICAgICAqIEB0aHJvd3MgTm9Xcml0YWJs\nZUxlZGdlckRpckV4Y2VwdGlvbiBpZiB0aGVyZSBpcyBubyB3cml0YWJsZSBk\naXIgYXZhaWxhYmxlLgogICAgICovCiAgICBwcml2YXRlIEZpbGUgZ2V0TmV3\nTGVkZ2VySW5kZXhGaWxlKExvbmcgbGVkZ2VyLCBGaWxlIGV4Y2x1ZGVkRGly\nKQogICAgdGhyb3dzIE5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb24gewog\nICAgICAgIEZpbGUgZGlyID0gbGVkZ2VyRGlyc01hbmFnZXIucGlja1JhbmRv\nbVdyaXRhYmxlRGlyKGV4Y2x1ZGVkRGlyKTsKICAgICAgICBTdHJpbmcgbGVk\nZ2VyTmFtZSA9IGdldExlZGdlck5hbWUobGVkZ2VyKTsKICAgICAgICByZXR1\ncm4gbmV3IEZpbGUoZGlyLCBsZWRnZXJOYW1lKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgdXBkYXRlUGFnZShMZWRnZXJFbnRyeVBhZ2UgbGVwKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICghbGVwLmlzQ2xlYW4oKSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlRyeWluZyB0\nbyB1cGRhdGUgYSBkaXJ0eSBwYWdlIik7CiAgICAgICAgfQogICAgICAgIEZp\nbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBm\naSA9IGdldEZpbGVJbmZvKGxlcC5nZXRMZWRnZXIoKSwgbnVsbCk7CiAgICAg\nICAgICAgIGxvbmcgcG9zID0gbGVwLmdldEZpcnN0RW50cnkoKSo4OwogICAg\nICAgICAgICBpZiAocG9zID49IGZpLnNpemUoKSkgewogICAgICAgICAgICAg\nICAgbGVwLnplcm9QYWdlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBsZXAucmVhZFBhZ2UoZmkpOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGZpICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIExlZGdlckRpcnNMaXN0\nZW5lciBnZXRMZWRnZXJEaXJzTGlzdGVuZXIoKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBMZWRnZXJEaXJzTGlzdGVuZXIoKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBkaXNrRnVsbChGaWxlIGRp\nc2spIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBjdXJyZW50IGVudHJ5\nIGxvZyBkaXNrIGlzIGZ1bGwsIHRoZW4gY3JlYXRlIG5ldyBlbnRyeQogICAg\nICAgICAgICAgICAgLy8gbG9nLgogICAgICAgICAgICAgICAgc2hvdWxkUmVs\nb2NhdGVJbmRleEZpbGUuc2V0KHRydWUpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgZGlz\na0ZhaWxlZChGaWxlIGRpc2spIHsKICAgICAgICAgICAgICAgIC8vIE5vdGhp\nbmcgdG8gaGFuZGxlIGhlcmUuIFdpbGwgYmUgaGFuZGxlZCBpbiBCb29raWUK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIGFsbERpc2tzRnVsbCgpIHsKICAgICAgICAgICAg\nICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxlIGhlcmUuIFdpbGwgYmUgaGFuZGxl\nZCBpbiBCb29raWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGZhdGFsRXJyb3IoKSB7CiAg\nICAgICAgICAgICAgICAvLyBOb3RoaW5nIHRvIGhhbmRsZSBoZXJlLiBXaWxs\nIGJlIGhhbmRsZWQgaW4gQm9va2llCiAgICAgICAgICAgIH0KICAgICAgICB9\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgZmx1c2hM\nZWRnZXIoYm9vbGVhbiBkb0FsbCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBzeW5jaHJvbml6ZWQoZGlydHlMZWRnZXJzKSB7CiAgICAgICAgICAg\nIGlmIChkaXJ0eUxlZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAg\nICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgICAgIGZv\ncihMb25nIGw6IHBhZ2VzLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgTE9HLnRyYWNlKCJBZGRpbmcge30gdG8gZGly\ndHkgcGFnZXMiLCBMb25nLnRvSGV4U3RyaW5nKGwpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBkaXJ0eUxl\nZGdlcnMuYWRkKGwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZGlydHlM\nZWRnZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoc2hvdWxkUmVsb2NhdGVJ\nbmRleEZpbGUuZ2V0KCkpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHNvbWUg\nbmV3IGRpciBkZXRlY3RlZCBhcyBmdWxsLCB0aGVuIG1vdmUgYWxsIGNvcnJl\nc3BvbmRpbmcKICAgICAgICAgICAgICAgIC8vIG9wZW4gaW5kZXggZmlsZXMg\ndG8gbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAgICBmb3IgKExvbmcgbCA6\nIGRpcnR5TGVkZ2VycykgewogICAgICAgICAgICAgICAgICAgIEZpbGVJbmZv\nIGZpID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgICAgICBmaSA9IGdldEZpbGVJbmZvKGwsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgICAgICBGaWxlIGN1cnJlbnREaXIgPSBnZXRM\nZWRnZXJEaXJGb3JMZWRnZXIoZmkpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAobGVkZ2VyRGlyc01hbmFnZXIuaXNEaXJGdWxsKGN1cnJlbnREaXIp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb3ZlTGVkZ2VySW5k\nZXhGaWxlKGwsIGZpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChudWxsICE9IGZpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBzaG91bGRSZWxvY2F0ZUluZGV4RmlsZS5zZXQoZmFs\nc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3aGlsZSghZGlydHlM\nZWRnZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgTG9uZyBsID0g\nZGlydHlMZWRnZXJzLnJlbW92ZUZpcnN0KCk7CgogICAgICAgICAgICAgICAg\nZmx1c2hMZWRnZXIobCk7CgogICAgICAgICAgICAgICAgaWYgKCFkb0FsbCkg\newogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgLy8gWWllbGQuIGlmIHdlIGFyZSBkb2luZyBh\nbGwgdGhlIGxlZGdlcnMgd2UgZG9uJ3Qgd2FudCB0byBibG9jayBvdGhlciBm\nbHVzaGVzIHRoYXQKICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gaGFwcGVu\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGRp\ncnR5TGVkZ2Vycy53YWl0KDEpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAg\nIC8vIGp1c3QgcGFzcyBpdCBvbgogICAgICAgICAgICAgICAgICAgIFRocmVh\nZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBHZXQgdGhlIGxlZGdlciBkaXJlY3RvcnkgdGhhdCB0aGUgbGVkZ2Vy\nIGluZGV4IGJlbG9uZ3MgdG8uCiAgICAgKgogICAgICogQHBhcmFtIGZpIEZp\nbGUgaW5mbyBvZiBhIGxlZGdlcgogICAgICogQHJldHVybiBsZWRnZXIgZGly\nZWN0b3J5IHRoYXQgdGhlIGxlZGdlciBiZWxvbmdzIHRvLgogICAgICovCiAg\nICBwcml2YXRlIEZpbGUgZ2V0TGVkZ2VyRGlyRm9yTGVkZ2VyKEZpbGVJbmZv\nIGZpKSB7CiAgICAgICAgcmV0dXJuIGZpLmdldExmKCkuZ2V0UGFyZW50Rmls\nZSgpLmdldFBhcmVudEZpbGUoKS5nZXRQYXJlbnRGaWxlKCk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIG1vdmVMZWRnZXJJbmRleEZpbGUoTG9uZyBsLCBG\naWxlSW5mbyBmaSkgdGhyb3dzIE5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRp\nb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIG5ld0xlZGdlckluZGV4\nRmlsZSA9IGdldE5ld0xlZGdlckluZGV4RmlsZShsLCBnZXRMZWRnZXJEaXJG\nb3JMZWRnZXIoZmkpKTsKICAgICAgICBmaS5tb3ZlVG9OZXdMb2NhdGlvbihu\nZXdMZWRnZXJJbmRleEZpbGUsIGZpLmdldFNpemVTaW5jZUxhc3R3cml0ZSgp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNoIGEgc3BlY2lmaWVkIGxl\nZGdlcgogICAgICoKICAgICAqIEBwYXJhbSBsCiAgICAgKiAgICAgICAgICBM\nZWRnZXIgSWQKICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGZsdXNoTGVkZ2VyKGxvbmcgbCkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZmkgPSBnZXRGaWxlSW5mbyhsLCBudWxs\nKTsKICAgICAgICAgICAgZmx1c2hMZWRnZXIobCwgZmkpOwogICAgICAgIH0g\nY2F0Y2ggKEJvb2tpZS5Ob0xlZGdlckV4Y2VwdGlvbiBubGUpIHsKICAgICAg\nICAgICAgLy8gbGVkZ2VyIGhhcyBiZWVuIGRlbGV0ZWQKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBpZiAobnVsbCAhPSBmaSkgewogICAgICAg\nICAgICAgICAgZmkucmVsZWFzZSgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBmbHVzaExlZGdlcihsb25nIGws\nIEZpbGVJbmZvIGZpKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIExp\nbmtlZExpc3Q8TG9uZz4gZmlyc3RFbnRyeUxpc3Q7CiAgICAgICAgc3luY2hy\nb25pemVkKHRoaXMpIHsKICAgICAgICAgICAgSGFzaE1hcDxMb25nLCBMZWRn\nZXJFbnRyeVBhZ2U+IHBhZ2VNYXAgPSBwYWdlcy5nZXQobCk7CiAgICAgICAg\nICAgIGlmIChwYWdlTWFwID09IG51bGwgfHwgcGFnZU1hcC5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgICAgIGZpLmZsdXNoSGVhZGVyKCk7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmly\nc3RFbnRyeUxpc3QgPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwogICAgICAg\nICAgICBmb3IoTWFwLkVudHJ5PExvbmcsIExlZGdlckVudHJ5UGFnZT4gZW50\ncnk6IHBhZ2VNYXAuZW50cnlTZXQoKSkgewogICAgICAgICAgICAgICAgTGVk\nZ2VyRW50cnlQYWdlIGxlcCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAg\nICAgICAgICBpZiAobGVwLmlzQ2xlYW4oKSkgewogICAgICAgICAgICAgICAg\nICAgIExPRy50cmFjZSgiUGFnZSBpcyBjbGVhbiB7fSIsIGxlcCk7CiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBmaXJzdEVudHJ5TGlzdC5hZGQobGVwLmdldEZpcnN0\nRW50cnkoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nIChmaXJzdEVudHJ5TGlzdC5zaXplKCkgPT0gMCkgewogICAgICAgICAgICBM\nT0cuZGVidWcoIk5vdGhpbmcgdG8gZmx1c2ggZm9yIGxlZGdlciB7fS4iLCBs\nKTsKICAgICAgICAgICAgLy8gbm90aGluZyB0byBkbwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBOb3cgZmx1c2ggYWxsIHRo\nZSBwYWdlcyBvZiBhIGxlZGdlcgogICAgICAgIExpc3Q8TGVkZ2VyRW50cnlQ\nYWdlPiBlbnRyaWVzID0gbmV3IEFycmF5TGlzdDxMZWRnZXJFbnRyeVBhZ2U+\nKGZpcnN0RW50cnlMaXN0LnNpemUoKSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZm9yKExvbmcgZmlyc3RFbnRyeTogZmlyc3RFbnRyeUxpc3QpIHsK\nICAgICAgICAgICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRMZWRn\nZXJFbnRyeVBhZ2UobCwgZmlyc3RFbnRyeSwgdHJ1ZSk7CiAgICAgICAgICAg\nICAgICBpZiAobGVwICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBl\nbnRyaWVzLmFkZChsZXApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIENvbGxlY3Rpb25zLnNvcnQoZW50cmllcywgbmV3\nIENvbXBhcmF0b3I8TGVkZ2VyRW50cnlQYWdlPigpIHsKICAgICAgICAgICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMg\naW50IGNvbXBhcmUoTGVkZ2VyRW50cnlQYWdlIG8xLCBMZWRnZXJFbnRyeVBh\nZ2UgbzIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGludCkobzEu\nZ2V0Rmlyc3RFbnRyeSgpLW8yLmdldEZpcnN0RW50cnkoKSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAg\nICAgICBBcnJheUxpc3Q8SW50ZWdlcj4gdmVyc2lvbnMgPSBuZXcgQXJyYXlM\naXN0PEludGVnZXI+KGVudHJpZXMuc2l6ZSgpKTsKICAgICAgICAgICAgLy8g\nZmx1c2ggdGhlIGhlYWRlciBpZiBuZWNlc3NhcnkKICAgICAgICAgICAgZmku\nZmx1c2hIZWFkZXIoKTsKICAgICAgICAgICAgaW50IHN0YXJ0ID0gMDsKICAg\nICAgICAgICAgbG9uZyBsYXN0T2Zmc2V0ID0gLTE7CiAgICAgICAgICAgIGZv\ncihpbnQgaSA9IDA7IGkgPCBlbnRyaWVzLnNpemUoKTsgaSsrKSB7CiAgICAg\nICAgICAgICAgICB2ZXJzaW9ucy5hZGQoaSwgZW50cmllcy5nZXQoaSkuZ2V0\nVmVyc2lvbigpKTsKICAgICAgICAgICAgICAgIGlmIChsYXN0T2Zmc2V0ICE9\nIC0xICYmIChlbnRyaWVzLmdldChpKS5nZXRGaXJzdEVudHJ5KCkgLSBsYXN0\nT2Zmc2V0KSAhPSBlbnRyaWVzUGVyUGFnZSkgewogICAgICAgICAgICAgICAg\nICAgIC8vIHNlbmQgdXAgYSBzZXF1ZW50aWFsIGxpc3QKICAgICAgICAgICAg\nICAgICAgICBpbnQgY291bnQgPSBpIC0gc3RhcnQ7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLndhcm4oIkNvdW50IGNhbm5vdCBwb3NzaWJseSBiZSB6ZXJvISIp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3\ncml0ZUJ1ZmZlcnMobCwgZW50cmllcywgZmksIHN0YXJ0LCBjb3VudCk7CiAg\nICAgICAgICAgICAgICAgICAgc3RhcnQgPSBpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgbGFzdE9mZnNldCA9IGVudHJpZXMuZ2V0KGkp\nLmdldEZpcnN0RW50cnkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoZW50cmllcy5zaXplKCktc3RhcnQgPT0gMCAmJiBlbnRyaWVzLnNpemUo\nKSAhPSAwKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiTm90aGluZyB0\nbyB3cml0ZSwgYnV0IHRoZXJlIHdlcmUgZW50cmllcyEiKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICB3cml0ZUJ1ZmZlcnMobCwgZW50cmllcywgZmks\nIHN0YXJ0LCBlbnRyaWVzLnNpemUoKS1zdGFydCk7CiAgICAgICAgICAgIHN5\nbmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAgICAgICBmb3IoaW50IGkg\nPSAwOyBpIDwgZW50cmllcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAg\nICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBlbnRyaWVzLmdldChpKTsK\nICAgICAgICAgICAgICAgICAgICBsZXAuc2V0Q2xlYW4odmVyc2lvbnMuZ2V0\nKGkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIGZvcihMZWRnZXJFbnRyeVBhZ2Ug\nbGVwOiBlbnRyaWVzKSB7CiAgICAgICAgICAgICAgICBsZXAucmVsZWFzZVBh\nZ2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgd3JpdGVCdWZmZXJzKExvbmcgbGVkZ2VyLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBMaXN0PExlZGdlckVudHJ5UGFnZT4gZW50\ncmllcywgRmlsZUluZm8gZmksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGludCBzdGFydCwgaW50IGNvdW50KSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAg\nICAgICBMT0cudHJhY2UoIldyaXRpbmcge30gYnVmZmVycyBvZiB7fSIsIGNv\ndW50LCBMb25nLnRvSGV4U3RyaW5nKGxlZGdlcikpOwogICAgICAgIH0KICAg\nICAgICBpZiAoY291bnQgPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQogICAgICAgIEJ5dGVCdWZmZXIgYnVmZnNbXSA9IG5ldyBCeXRl\nQnVmZmVyW2NvdW50XTsKICAgICAgICBmb3IoaW50IGogPSAwOyBqIDwgY291\nbnQ7IGorKykgewogICAgICAgICAgICBidWZmc1tqXSA9IGVudHJpZXMuZ2V0\nKHN0YXJ0K2opLmdldFBhZ2VUb1dyaXRlKCk7CiAgICAgICAgICAgIGlmIChl\nbnRyaWVzLmdldChzdGFydCtqKS5nZXRMZWRnZXIoKSAhPSBsZWRnZXIpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiV3JpdGlu\nZyB0byAiICsgbGVkZ2VyICsgIiBidXQgcGFnZSBiZWxvbmdzIHRvICIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGVudHJpZXMu\nZ2V0KHN0YXJ0K2opLmdldExlZGdlcigpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBsb25nIHRvdGFsV3JpdHRlbiA9IDA7CiAgICAgICAg\nd2hpbGUoYnVmZnNbYnVmZnMubGVuZ3RoLTFdLnJlbWFpbmluZygpID4gMCkg\newogICAgICAgICAgICBsb25nIHJjID0gZmkud3JpdGUoYnVmZnMsIGVudHJp\nZXMuZ2V0KHN0YXJ0KzApLmdldEZpcnN0RW50cnkoKSo4KTsKICAgICAgICAg\nICAgaWYgKHJjIDw9IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbigiU2hvcnQgd3JpdGUgdG8gbGVkZ2VyICIgKyBsZWRnZXIg\nKyAiIHJjID0gIiArIHJjKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0\nb3RhbFdyaXR0ZW4gKz0gcmM7CiAgICAgICAgfQogICAgICAgIGlmICh0b3Rh\nbFdyaXR0ZW4gIT0gKGxvbmcpY291bnQgKiAobG9uZylwYWdlU2l6ZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlNob3J0IHdyaXRl\nIHRvIGxlZGdlciAiICsgbGVkZ2VyICsgIiB3cm90ZSAiICsgdG90YWxXcml0\ndGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgZXhw\nZWN0ZWQgIiArIGNvdW50ICogcGFnZVNpemUpOwogICAgICAgIH0KICAgIH0K\nICAgIHByaXZhdGUgTGVkZ2VyRW50cnlQYWdlIGdyYWJDbGVhblBhZ2UobG9u\nZyBsZWRnZXIsIGxvbmcgZW50cnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKGVudHJ5ICUgZW50cmllc1BlclBhZ2UgIT0gMCkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGVu\ndHJ5ICsgIiBpcyBub3QgYSBtdWx0aXBsZSBvZiAiICsgZW50cmllc1BlclBh\nZ2UpOwogICAgICAgIH0KICAgICAgICBvdXRlckxvb3A6CiAgICAgICAgd2hp\nbGUodHJ1ZSkgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewog\nICAgICAgICAgICAgICAgaWYgKHBhZ2VDb3VudCAgPCBwYWdlTGltaXQpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBsZXQncyBzZWUgaWYgd2UgY2FuIGFs\nbG9jYXRlIHNvbWV0aGluZwogICAgICAgICAgICAgICAgICAgIExlZGdlckVu\ndHJ5UGFnZSBsZXAgPSBuZXcgTGVkZ2VyRW50cnlQYWdlKHBhZ2VTaXplLCBl\nbnRyaWVzUGVyUGFnZSk7CiAgICAgICAgICAgICAgICAgICAgbGVwLnNldExl\nZGdlcihsZWRnZXIpOwogICAgICAgICAgICAgICAgICAgIGxlcC5zZXRGaXJz\ndEVudHJ5KGVudHJ5KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gbm90ZSwg\ndGhpcyB3aWxsIG5vdCBibG9jayBzaW5jZSBpdCBpcyBhIG5ldyBwYWdlCiAg\nICAgICAgICAgICAgICAgICAgbGVwLnVzZVBhZ2UoKTsKICAgICAgICAgICAg\nICAgICAgICBwYWdlQ291bnQrKzsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbGVwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQoY2xlYW5MZWRnZXJzKSB7CiAgICAgICAg\nICAgICAgICBpZiAoY2xlYW5MZWRnZXJzLmlzRW1wdHkoKSkgewogICAgICAg\nICAgICAgICAgICAgIGZsdXNoTGVkZ2VyKGZhbHNlKTsKICAgICAgICAgICAg\nICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAg\nICAgICAgICBmb3IoTG9uZyBsOiBwYWdlcy5rZXlTZXQoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY2xlYW5MZWRnZXJzLmFkZChsKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCh0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgbGVkZ2VycyBk\nZWxldGVkIGJldHdlZW4gY2hlY2tpbmcgcGFnZUNvdW50IGFuZCBwdXR0aW5n\nCiAgICAgICAgICAgICAgICAgICAgLy8gbGVkZ2VycyBpbnRvIGNsZWFuTGVk\nZ2VycyBsaXN0LCB0aGUgY2xlYW5MZWRnZXJzIGxpc3Qgd291bGQgYmUgZW1w\ndHkuCiAgICAgICAgICAgICAgICAgICAgLy8gc28gZ2l2ZSBpdCBhIGNoYW5j\nZSB0byBnbyBiYWNrIHRvIGNoZWNrIHBhZ2VDb3VudCBhZ2FpbiBiZWNhdXNl\nCiAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlTGVkZ2VyIHdvdWxkIGRl\nY3JlbWVudCBwYWdlQ291bnQgdG8gcmV0dXJuIHRoZSBudW1iZXIgb2YgcGFn\nZXMKICAgICAgICAgICAgICAgICAgICAvLyBvY2N1cGllZCBieSBkZWxldGVk\nIGxlZGdlcnMuCiAgICAgICAgICAgICAgICAgICAgaWYgKGNsZWFuTGVkZ2Vy\ncy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWUgb3V0ZXJMb29wOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBMb25nIGNsZWFuTGVkZ2VyID0gY2xlYW5MZWRnZXJzLmdl\ndEZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgTWFwPExvbmcsIExlZGdl\nckVudHJ5UGFnZT4gbWFwID0gcGFnZXMuZ2V0KGNsZWFuTGVkZ2VyKTsKICAg\nICAgICAgICAgICAgICAgICB3aGlsZSAobWFwID09IG51bGwgfHwgbWFwLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhbkxlZGdl\ncnMucmVtb3ZlRmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGNsZWFuTGVkZ2Vycy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlIG91dGVyTG9vcDsgCiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2xlYW5MZWRn\nZXIgPSBjbGVhbkxlZGdlcnMuZ2V0Rmlyc3QoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgbWFwID0gcGFnZXMuZ2V0KGNsZWFuTGVkZ2VyKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgSXRlcmF0b3I8\nTWFwLkVudHJ5PExvbmcsIExlZGdlckVudHJ5UGFnZT4+IGl0ID0gbWFwLmVu\ndHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAgICAgICAgICAgICAgICAgICBMZWRn\nZXJFbnRyeVBhZ2UgbGVwID0gaXQubmV4dCgpLmdldFZhbHVlKCk7CiAgICAg\nICAgICAgICAgICAgICAgd2hpbGUoKGxlcC5pblVzZSgpIHx8ICFsZXAuaXND\nbGVhbigpKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWl0Lmhh\nc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8g\nY2xlYW4gcGFnZSBmb3VuZCBpbiB0aGlzIGxlZGdlcgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY2xlYW5MZWRnZXJzLnJlbW92ZUZpcnN0KCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBvdXRlckxvb3A7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgbGVwID0gaXQubmV4dCgpLmdldFZhbHVlKCk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGl0LnJlbW92ZSgpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChtYXAuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHBhZ2VzLnJlbW92ZShsZXAuZ2V0TGVkZ2Vy\nKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBsZXAudXNlUGFnZSgpOwogICAgICAgICAgICAgICAgICAgIGxlcC56ZXJv\nUGFnZSgpOwogICAgICAgICAgICAgICAgICAgIGxlcC5zZXRMZWRnZXIobGVk\nZ2VyKTsKICAgICAgICAgICAgICAgICAgICBsZXAuc2V0Rmlyc3RFbnRyeShl\nbnRyeSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxlcDsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBsb25nIGdldExhc3RFbnRyeShsb25n\nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGxvbmcg\nbGFzdEVudHJ5ID0gMDsKICAgICAgICAvLyBGaW5kIHRoZSBsYXN0IGVudHJ5\nIGluIHRoZSBjYWNoZQogICAgICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAg\nICAgICAgICAgIE1hcDxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+IG1hcCA9IHBh\nZ2VzLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChtYXAgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgZm9yKExlZGdlckVudHJ5UGFnZSBsZXA6\nIG1hcC52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChsZXAu\nZ2V0Rmlyc3RFbnRyeSgpICsgZW50cmllc1BlclBhZ2UgPCBsYXN0RW50cnkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxlcC51c2VQYWdl\nKCk7CiAgICAgICAgICAgICAgICAgICAgbG9uZyBoaWdoZXN0ID0gbGVwLmdl\ndExhc3RFbnRyeSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChoaWdoZXN0\nID4gbGFzdEVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RF\nbnRyeSA9IGhpZ2hlc3Q7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBGaWxlSW5m\nbyBmaSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmkgPSBn\nZXRGaWxlSW5mbyhsZWRnZXJJZCwgbnVsbCk7CiAgICAgICAgICAgIGxvbmcg\nc2l6ZSA9IGZpLnNpemUoKTsKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRo\nZSBmaWxlIHNpemUgaXMgYWxpZ25lZCB3aXRoIGluZGV4IGVudHJ5IHNpemUK\nICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIG1heSByZWFkIGluY29ycmV0\nIGRhdGEKICAgICAgICAgICAgaWYgKDAgIT0gc2l6ZSAlIDgpIHsKICAgICAg\nICAgICAgICAgIExPRy53YXJuKCJJbmRleCBmaWxlIG9mIGxlZGdlciB7fSBp\ncyBub3QgYWxpZ25lZCB3aXRoIGluZGV4IGVudHJ5IHNpemUuIiwgbGVkZ2Vy\nSWQpOwogICAgICAgICAgICAgICAgc2l6ZSA9IHNpemUgLSBzaXplICUgODsK\nICAgICAgICAgICAgfQogICAgICAgICAgICAvLyB3ZSBtYXkgbm90IGhhdmUg\ndGhlIGxhc3QgZW50cnkgaW4gdGhlIGNhY2hlCiAgICAgICAgICAgIGlmIChz\naXplID4gbGFzdEVudHJ5KjgpIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZm\nZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKGdldFBhZ2VTaXplKCkpOwog\nICAgICAgICAgICAgICAgbG9uZyBwb3NpdGlvbiA9IHNpemUgLSBnZXRQYWdl\nU2l6ZSgpOwogICAgICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewog\nICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uID0gMDsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGZpLnJlYWQoYmIsIHBvc2l0aW9uKTsK\nICAgICAgICAgICAgICAgIGJiLmZsaXAoKTsKICAgICAgICAgICAgICAgIGxv\nbmcgc3RhcnRpbmdFbnRyeUlkID0gcG9zaXRpb24vODsKICAgICAgICAgICAg\nICAgIGZvcihpbnQgaSA9IGdldEVudHJpZXNQZXJQYWdlKCktMTsgaSA+PSAw\nOyBpLS0pIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYmIuZ2V0TG9uZyhp\nKjgpICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RF\nbnRyeSA8IHN0YXJ0aW5nRW50cnlJZCtpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsYXN0RW50cnkgPSBzdGFydGluZ0VudHJ5SWQraTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBpZiAoZmkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZmkucmVs\nZWFzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gbGFzdEVudHJ5OwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRo\nb2Qgd2lsbCBsb29rIHdpdGhpbiB0aGUgbGVkZ2VyIGRpcmVjdG9yaWVzIGZv\nciB0aGUgbGVkZ2VyIGluZGV4CiAgICAgKiBmaWxlcy4gVGhhdCB3aWxsIGNv\nbXByaXNlIHRoZSBzZXQgb2YgYWN0aXZlIGxlZGdlcnMgdGhpcyBwYXJ0aWN1\nbGFyCiAgICAgKiBCb29raWVTZXJ2ZXIga25vd3MgYWJvdXQgdGhhdCBoYXZl\nIG5vdCB5ZXQgYmVlbiBkZWxldGVkIGJ5IHRoZSBCb29rS2VlcGVyCiAgICAg\nKiBDbGllbnQuIFRoaXMgaXMgY2FsbGVkIG9ubHkgb25jZSBkdXJpbmcgaW5p\ndGlhbGl6YXRpb24uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRBY3Rp\ndmVMZWRnZXJzKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAvLyBM\nZWRnZXIgaW5kZXggZmlsZXMgYXJlIHN0b3JlZCBpbiBhIGZpbGUgaGllcmFy\nY2h5IHdpdGggYSBwYXJlbnQgYW5kCiAgICAgICAgLy8gZ3JhbmRQYXJlbnQg\nZGlyZWN0b3J5LiBXZSdsbCBoYXZlIHRvIGdvIHR3byBsZXZlbHMgZGVlcCBp\nbnRvIHRoZXNlCiAgICAgICAgLy8gZGlyZWN0b3JpZXMgdG8gZmluZCB0aGUg\naW5kZXggZmlsZXMuCiAgICAgICAgZm9yIChGaWxlIGxlZGdlckRpcmVjdG9y\neSA6IGxlZGdlckRpcnNNYW5hZ2VyLmdldEFsbExlZGdlckRpcnMoKSkgewog\nICAgICAgICAgICBmb3IgKEZpbGUgZ3JhbmRQYXJlbnQgOiBsZWRnZXJEaXJl\nY3RvcnkubGlzdEZpbGVzKCkpIHsKICAgICAgICAgICAgICAgIGlmIChncmFu\nZFBhcmVudC5pc0RpcmVjdG9yeSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nZm9yIChGaWxlIHBhcmVudCA6IGdyYW5kUGFyZW50Lmxpc3RGaWxlcygpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuaXNEaXJlY3Rv\ncnkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChGaWxl\nIGluZGV4IDogcGFyZW50Lmxpc3RGaWxlcygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKCFpbmRleC5pc0ZpbGUoKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKCFpbmRleC5n\nZXROYW1lKCkuZW5kc1dpdGgoSURYKSAmJiAhaW5kZXguZ2V0TmFtZSgpLmVu\nZHNXaXRoKFJMT0MpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFdl\nJ3ZlIGZvdW5kIGEgbGVkZ2VyIGluZGV4IGZpbGUuIFRoZSBmaWxlCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmFtZSBpcyB0aGUgSGV4\nU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGxlZGdlcklkLgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFN0cmluZyBsZWRnZXJJZEluSGV4ID0gaW5kZXgu\nZ2V0TmFtZSgpLnJlcGxhY2UoUkxPQywgIiIpLnJlcGxhY2UoSURYLCAiIik7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZGV4Lmdl\ndE5hbWUoKS5lbmRzV2l0aChSTE9DKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoZmluZEluZGV4RmlsZShMb25nLnBhcnNl\nTG9uZyhsZWRnZXJJZEluSGV4KSkgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbmRleC5kZWxldGUo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy53YXJuKCJEZWxldGluZyB0aGUgcmxvYyBmaWxlICIgKyBpbmRl\neCArICIgZmFpbGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIEZpbGUgZGVzdCA9IG5ldyBGaWxlKGluZGV4LmdldFBh\ncmVudEZpbGUoKSwgbGVkZ2VySWRJbkhleCArIElEWCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluZGV4LnJlbmFt\nZVRvKGRlc3QpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJSZW5hbWluZyBy\nbG9jIGZpbGUgIiArIGluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArICIgdG8gaW5kZXggZmlsZSBo\nYXMgZmFpbGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlTGVkZ2Vycy5wdXQoTG9u\nZy5wYXJzZUxvbmcobGVkZ2VySWRJbkhleCwgMTYpLCB0cnVlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aGVuZXZlciBhIGxlZGdlciBpcyBk\nZWxldGVkIGJ5IHRoZSBCb29rS2VlcGVyIENsaWVudAogICAgICogYW5kIHdl\nIHdhbnQgdG8gcmVtb3ZlIGFsbCByZWxldmFudCBkYXRhIGZvciBpdCBzdG9y\nZWQgaW4gdGhlIExlZGdlckNhY2hlLgogICAgICovCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIGRlbGV0ZUxlZGdlcihsb25nIGxlZGdlcklkKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIExPRy5kZWJ1ZygiRGVsZXRp\nbmcgbGVkZ2VySWQ6IHt9IiwgbGVkZ2VySWQpOwoKICAgICAgICAvLyByZW1v\ndmUgcGFnZXMgZmlyc3QgdG8gYXZvaWQgcGFnZSBmbHVzaGVkIHdoZW4gZGVs\nZXRpbmcgZmlsZSBpbmZvCiAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsK\nICAgICAgICAgICAgTWFwPExvbmcsIExlZGdlckVudHJ5UGFnZT4gbHBhZ2Vz\nID0gcGFnZXMucmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICAgICAgaWYgKG51\nbGwgIT0gbHBhZ2VzKSB7CiAgICAgICAgICAgICAgICBwYWdlQ291bnQgLT0g\nbHBhZ2VzLnNpemUoKTsKICAgICAgICAgICAgICAgIGlmIChwYWdlQ291bnQg\nPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJQYWdlIGNv\ndW50IG9mIGxlZGdlciBjYWNoZSBoYXMgYmVlbiBkZWNyZW1lbnRlZCB0byBi\nZSBsZXNzIHRoYW4gemVyby4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBEZWxldGUgdGhlIGxlZGdl\ncidzIGluZGV4IGZpbGUgYW5kIGNsb3NlIHRoZSBGaWxlSW5mbwogICAgICAg\nIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBmaSA9IGdldEZpbGVJbmZvKGxlZGdlcklkLCBudWxsKTsKICAgICAgICAg\nICAgZmkuY2xvc2UoZmFsc2UpOwogICAgICAgICAgICBmaS5kZWxldGUoKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyBzaG91bGQgcmVs\nZWFzZSB1c2UgY291bnQKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHRoZSBm\naWxlIGNoYW5uZWwgd291bGQgbm90IGJlIGNsb3NlZC4KICAgICAgICAgICAg\naWYgKG51bGwgIT0gZmkpIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2Uo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVtb3Zl\nIGl0IGZyb20gdGhlIGFjdGl2ZSBsZWRnZXIgbWFuYWdlcgogICAgICAgIGFj\ndGl2ZUxlZGdlcnMucmVtb3ZlKGxlZGdlcklkKTsKCiAgICAgICAgLy8gTm93\nIHJlbW92ZSBpdCBmcm9tIGFsbCB0aGUgb3RoZXIgbGlzdHMgYW5kIG1hcHMu\nCiAgICAgICAgLy8gVGhlc2UgZGF0YSBzdHJ1Y3R1cmVzIG5lZWQgdG8gYmUg\nc3luY2hyb25pemVkIGZpcnN0IGJlZm9yZSByZW1vdmluZyBlbnRyaWVzLgog\nICAgICAgIHN5bmNocm9uaXplZChmaWxlSW5mb0NhY2hlKSB7CiAgICAgICAg\nICAgIGZpbGVJbmZvQ2FjaGUucmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICB9\nCiAgICAgICAgc3luY2hyb25pemVkKGNsZWFuTGVkZ2VycykgewogICAgICAg\nICAgICBjbGVhbkxlZGdlcnMucmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICB9\nCiAgICAgICAgc3luY2hyb25pemVkKGRpcnR5TGVkZ2VycykgewogICAgICAg\nICAgICBkaXJ0eUxlZGdlcnMucmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICB9\nCiAgICAgICAgc3luY2hyb25pemVkKG9wZW5MZWRnZXJzKSB7CiAgICAgICAg\nICAgIG9wZW5MZWRnZXJzLnJlbW92ZShsZWRnZXJJZCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgRmlsZSBmaW5kSW5kZXhGaWxlKGxvbmcgbGVk\nZ2VySWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIGxl\nZGdlck5hbWUgPSBnZXRMZWRnZXJOYW1lKGxlZGdlcklkKTsKICAgICAgICBm\nb3IgKEZpbGUgZCA6IGxlZGdlckRpcnNNYW5hZ2VyLmdldEFsbExlZGdlckRp\ncnMoKSkgewogICAgICAgICAgICBGaWxlIGxmID0gbmV3IEZpbGUoZCwgbGVk\nZ2VyTmFtZSk7CiAgICAgICAgICAgIGlmIChsZi5leGlzdHMoKSkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGxmOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIGJ5dGVbXSByZWFkTWFzdGVyS2V5KGxvbmcgbGVkZ2VySWQp\nIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAg\nICBzeW5jaHJvbml6ZWQoZmlsZUluZm9DYWNoZSkgewogICAgICAgICAgICBG\naWxlSW5mbyBmaSA9IGZpbGVJbmZvQ2FjaGUuZ2V0KGxlZGdlcklkKTsKICAg\nICAgICAgICAgaWYgKGZpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIEZp\nbGUgbGYgPSBmaW5kSW5kZXhGaWxlKGxlZGdlcklkKTsKICAgICAgICAgICAg\nICAgIGlmIChsZiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEJvb2tpZS5Ob0xlZGdlckV4Y2VwdGlvbihsZWRnZXJJZCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBldmljdEZpbGVJbmZv\nSWZOZWNlc3NhcnkoKTsgICAgICAgIAogICAgICAgICAgICAgICAgZmkgPSBu\nZXcgRmlsZUluZm8obGYsIG51bGwpOwogICAgICAgICAgICAgICAgYnl0ZVtd\nIGtleSA9IGZpLmdldE1hc3RlcktleSgpOwogICAgICAgICAgICAgICAgZmls\nZUluZm9DYWNoZS5wdXQobGVkZ2VySWQsIGZpKTsKICAgICAgICAgICAgICAg\nIG9wZW5MZWRnZXJzLmFkZChsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4ga2V5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBm\naS5nZXRNYXN0ZXJLZXkoKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gZXZp\nY3QgZmlsZSBpbmZvIGlmIG5lY2Vzc2FyeQogICAgcHJpdmF0ZSB2b2lkIGV2\naWN0RmlsZUluZm9JZk5lY2Vzc2FyeSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgc3luY2hyb25pemVkIChmaWxlSW5mb0NhY2hlKSB7CiAgICAg\nICAgICAgIGlmIChvcGVuTGVkZ2Vycy5zaXplKCkgPiBvcGVuRmlsZUxpbWl0\nKSB7CiAgICAgICAgICAgICAgICBsb25nIGxlZGdlclRvUmVtb3ZlID0gb3Bl\nbkxlZGdlcnMucmVtb3ZlRmlyc3QoKTsKICAgICAgICAgICAgICAgIC8vIFRP\nRE8gQWRkIGEgc3RhdGlzdGljIGhlcmUsIHdlIGRvbid0IGNhcmUgcmVhbGx5\nIHdoaWNoCiAgICAgICAgICAgICAgICAvLyBsZWRnZXIgaXMgZXZpY3RlZCwg\nYnV0IHRoZSByYXRlIGF0IHdoaWNoIHRoZXkgZ2V0IGV2aWN0ZWQKICAgICAg\nICAgICAgICAgIExPRy5kZWJ1ZygiTGVkZ2VyIHt9IGlzIGV2aWN0ZWQgZnJv\nbSBmaWxlIGluZm8gY2FjaGUuIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nICBsZWRnZXJUb1JlbW92ZSk7CiAgICAgICAgICAgICAgICBGaWxlSW5mbyBm\naSA9IGZpbGVJbmZvQ2FjaGUucmVtb3ZlKGxlZGdlclRvUmVtb3ZlKTsKICAg\nICAgICAgICAgICAgIGlmIChmaSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgZmkuY2xvc2UodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgYm9vbGVhbiBzZXRGZW5jZWQobG9uZyBsZWRnZXJJZCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgZmkgPSBnZXRGaWxlSW5mbyhsZWRn\nZXJJZCwgbnVsbCk7CiAgICAgICAgICAgIGlmIChudWxsICE9IGZpKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmkuc2V0RmVuY2VkKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChudWxsICE9IGZpKSB7CiAgICAgICAg\nICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Zl\nbmNlZChsb25nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBmaSA9IGdldEZpbGVJbmZvKGxlZGdlcklkLCBudWxsKTsKICAgICAg\nICAgICAgaWYgKG51bGwgIT0gZmkpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiBmaS5pc0ZlbmNlZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAobnVsbCAhPSBmaSkgewogICAgICAgICAgICAgICAgZmkucmVsZWFzZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgc2V0TWFzdGVyS2V5KGxvbmcgbGVkZ2VySWQs\nIGJ5dGVbXSBtYXN0ZXJLZXkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgRmlsZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZpID0gZ2V0RmlsZUluZm8obGVkZ2VySWQsIG1hc3RlcktleSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKG51bGwgIT0gZmkp\nIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBi\nb29sZWFuIGxlZGdlckV4aXN0cyhsb25nIGxlZGdlcklkKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHN5bmNocm9uaXplZChmaWxlSW5mb0NhY2hl\nKSB7CiAgICAgICAgICAgIEZpbGVJbmZvIGZpID0gZmlsZUluZm9DYWNoZS5n\nZXQobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAoZmkgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgRmlsZSBsZiA9IGZpbmRJbmRleEZpbGUobGVkZ2Vy\nSWQpOwogICAgICAgICAgICAgICAgaWYgKGxmID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTGVkZ2VyQ2FjaGVC\nZWFuIGdldEpNWEJlYW4oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJD\nYWNoZUJlYW4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgU3RyaW5nIGdldE5hbWUoKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gIkxlZGdlckNhY2hlIjsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGlzSGlk\nZGVuKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIGludCBnZXRQYWdlQ291bnQoKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gTGVkZ2VyQ2FjaGVJbXBsLnRoaXMuZ2V0TnVtVXNlZFBhZ2VzKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgaW50IGdldFBhZ2VTaXplKCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIExlZGdlckNhY2hlSW1wbC50aGlzLmdldFBhZ2VTaXplKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgaW50IGdldE9wZW5GaWxlTGltaXQoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gb3BlbkZpbGVMaW1pdDsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0\nUGFnZUxpbWl0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIExlZGdlckNh\nY2hlSW1wbC50aGlzLmdldFBhZ2VMaW1pdCgpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGludCBn\nZXROdW1DbGVhbkxlZGdlcnMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nY2xlYW5MZWRnZXJzLnNpemUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0TnVtRGly\ndHlMZWRnZXJzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRpcnR5TGVk\nZ2Vycy5zaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgaW50IGdldE51bU9wZW5MZWRnZXJz\nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9wZW5MZWRnZXJzLnNpemUo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgc3luY2hyb25pemVkIChmaWxlSW5mb0NhY2hlKSB7CiAg\nICAgICAgICAgIGZvciAoRW50cnk8TG9uZywgRmlsZUluZm8+IGZpbGVJbmZv\nIDogZmlsZUluZm9DYWNoZS5lbnRyeVNldCgpKSB7CiAgICAgICAgICAgICAg\nICBGaWxlSW5mbyB2YWx1ZSA9IGZpbGVJbmZvLmdldFZhbHVlKCk7CiAgICAg\nICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIHZhbHVlLmNsb3NlKHRydWUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGZpbGVJbmZvQ2FjaGUuY2xlYXIo\nKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

