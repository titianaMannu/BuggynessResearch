{"sha":"2477fe86c22ed5078b14d1e677847cf8a251958c","node_id":"MDQ6QmxvYjE1NzU5NTY6MjQ3N2ZlODZjMjJlZDUwNzhiMTRkMWU2Nzc4NDdjZjhhMjUxOTU4Yw==","size":13892,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2477fe86c22ed5078b14d1e677847cf8a251958c","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNv\nZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhw\ncmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBz\ncGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq\nIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmltcG9ydCBq\nYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tl\ndEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEu\ndXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5MaW5rZWRCbG9ja2luZ1F1ZXVlOwppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNl\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CgppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbi5C\nS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuQm9va0tlZXBlckNvbnN0YW50\nczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlNhZmVSdW5u\nYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlN0cmlu\nZ1V0aWxzOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuQ3JlYXRlTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktl\nZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldh\ndGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNo\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNr\nLkNoaWxkcmVuQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5LZWVwZXJFeGNlcHRpb24uQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Ob2RlRXhpc3RzRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVudC5FdmVu\ndFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29EZWZzLklk\nczsKCi8qKgogKiBUaGlzIGNsYXNzIGlzIHJlc3BvbnNpYmxlIGZvciBtYWlu\ndGFpbmluZyBhIGNvbnNpc3RlbnQgdmlldyBvZiB3aGF0IGJvb2tpZXMKICog\nYXJlIGF2YWlsYWJsZSBieSByZWFkaW5nIFpvb2tlZXBlciAoYW5kIHNldHRp\nbmcgd2F0Y2hlcyBvbiB0aGUgYm9va2llIG5vZGVzKS4KICogV2hlbiBhIGJv\nb2tpZSBmYWlscywgdGhlIG90aGVyIHBhcnRzIG9mIHRoZSBjb2RlIHR1cm4g\ndG8gdGhpcyBjbGFzcyB0byBmaW5kIGEKICogcmVwbGFjZW1lbnQKICoKICov\nCmNsYXNzIEJvb2tpZVdhdGNoZXIgaW1wbGVtZW50cyBXYXRjaGVyLCBDaGls\nZHJlbkNhbGxiYWNrIHsKICAgIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2Vy\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va2llV2F0Y2hlci5jbGFz\ncyk7CgogICAgLy8gQm9va2llIHJlZ2lzdHJhdGlvbiBwYXRoIGluIFpLCiAg\nICBwcml2YXRlIGZpbmFsIFN0cmluZyBib29raWVSZWdpc3RyYXRpb25QYXRo\nOwogICAgc3RhdGljIGZpbmFsIFNldDxJbmV0U29ja2V0QWRkcmVzcz4gRU1Q\nVFlfU0VUID0gbmV3IEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+KCk7CiAg\nICBwdWJsaWMgc3RhdGljIGludCBaS19DT05ORUNUX0JBQ0tPRkZfU0VDID0g\nMTsKCiAgICBmaW5hbCBCb29rS2VlcGVyIGJrOwoKICAgIEhhc2hTZXQ8SW5l\ndFNvY2tldEFkZHJlc3M+IGtub3duQm9va2llcyA9IG5ldyBIYXNoU2V0PElu\nZXRTb2NrZXRBZGRyZXNzPigpOwogICAgZmluYWwgU2NoZWR1bGVkRXhlY3V0\nb3JTZXJ2aWNlIHNjaGVkdWxlcjsKCiAgICBTYWZlUnVubmFibGUgcmVSZWFk\nVGFzayA9IG5ldyBTYWZlUnVubmFibGUoKSB7CiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigpIHsKICAgICAgICAgICAg\ncmVhZEJvb2tpZXMoKTsKICAgICAgICB9CiAgICB9OwogICAgcHJpdmF0ZSBS\nZWFkT25seUJvb2tpZVdhdGNoZXIgcmVhZE9ubHlCb29raWVXYXRjaGVyOwoK\nICAgIHB1YmxpYyBCb29raWVXYXRjaGVyKENsaWVudENvbmZpZ3VyYXRpb24g\nY29uZiwKICAgICAgICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlZEV4ZWN1\ndG9yU2VydmljZSBzY2hlZHVsZXIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICBCb29rS2VlcGVyIGJrKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiAgewogICAgICAgIHRoaXMuYmsgPSBiazsKICAg\nICAgICAvLyBaSyBib29raWUgcmVnaXN0cmF0aW9uIHBhdGgKICAgICAgICB0\naGlzLmJvb2tpZVJlZ2lzdHJhdGlvblBhdGggPSBjb25mLmdldFprQXZhaWxh\nYmxlQm9va2llc1BhdGgoKTsKICAgICAgICB0aGlzLnNjaGVkdWxlciA9IHNj\naGVkdWxlcjsKICAgICAgICByZWFkT25seUJvb2tpZVdhdGNoZXIgPSBuZXcg\nUmVhZE9ubHlCb29raWVXYXRjaGVyKGNvbmYsIGJrKTsKICAgIH0KCiAgICB2\nb2lkIG5vdGlmeUJvb2tpZXNDaGFuZ2VkKGZpbmFsIEJvb2tpZXNMaXN0ZW5l\nciBsaXN0ZW5lcikgdGhyb3dzIEJLRXhjZXB0aW9uIHsKICAgICAgICB0cnkg\newogICAgICAgICAgICBiay5nZXRaa0hhbmRsZSgpLmdldENoaWxkcmVuKHRo\naXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aCwKICAgICAgICAgICAgICAgICAg\nICBuZXcgV2F0Y2hlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIGxpc3RlbiBjaGlsZHJlbiBjaGFu\nZ2VkIGV2ZW50IGZyb20gWm9vS2VlcGVyCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoZXZlbnQuZ2V0VHlwZSgpID09IEV2ZW50VHlwZS5Ob2Rl\nQ2hpbGRyZW5DaGFuZ2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbGlzdGVuZXIuYXZhaWxhYmxlQm9va2llc0NoYW5nZWQoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0\nY2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBsb2dnZXIu\nZXJyb3IoIkVycm9yIHJlZ2lzdGVyaW5nIHdhdGNoZXIgd2l0aCB6b29rZWVw\nZXIiLCBrZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBCS0V4Y2VwdGlvbi5a\nS0V4Y2VwdGlvbigpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhj\nZXB0aW9uIGllKSB7CiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFk\nKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiSW50\nZXJydXB0ZWQgcmVnaXN0ZXJpbmcgd2F0Y2hlciB3aXRoIHpvb2tlZXBlciIs\nIGllKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEJLRXhjZXB0aW9uLkJLSW50\nZXJydXB0ZWRFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICB9CgogICAgcHVi\nbGljIENvbGxlY3Rpb248SW5ldFNvY2tldEFkZHJlc3M+IGdldEJvb2tpZXMo\nKSB0aHJvd3MgQktFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIExpc3Q8U3RyaW5nPiBjaGlsZHJlbiA9IGJrLmdldFprSGFuZGxlKCku\nZ2V0Q2hpbGRyZW4odGhpcy5ib29raWVSZWdpc3RyYXRpb25QYXRoLCBmYWxz\nZSk7CiAgICAgICAgICAgIGNoaWxkcmVuLnJlbW92ZShCb29rS2VlcGVyQ29u\nc3RhbnRzLlJFQURPTkxZKTsKICAgICAgICAgICAgcmV0dXJuIGNvbnZlcnRU\nb0Jvb2tpZUFkZHJlc3NlcyhjaGlsZHJlbik7CiAgICAgICAgfSBjYXRjaCAo\nS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIGxvZ2dlci5lcnJv\ncigiRmFpbGVkIHRvIGdldCBib29raWUgbGlzdCA6ICIsIGtlKTsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEJLRXhjZXB0aW9uLlpLRXhjZXB0aW9uKCk7CiAg\nICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAg\nICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsK\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJJbnRlcnJ1cHRlZCByZWFkaW5n\nIGJvb2tpZSBsaXN0IiwgaWUpOwogICAgICAgICAgICB0aHJvdyBuZXcgQktF\neGNlcHRpb24uQktJbnRlcnJ1cHRlZEV4Y2VwdGlvbigpOwogICAgICAgIH0K\nICAgIH0KCiAgICBDb2xsZWN0aW9uPEluZXRTb2NrZXRBZGRyZXNzPiBnZXRS\nZWFkT25seUJvb2tpZXMoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBIYXNoU2V0\nPEluZXRTb2NrZXRBZGRyZXNzPihyZWFkT25seUJvb2tpZVdhdGNoZXIuZ2V0\nUmVhZE9ubHlCb29raWVzKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJl\nYWRCb29raWVzKCkgewogICAgICAgIHJlYWRCb29raWVzKHRoaXMpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRCb29raWVzKENoaWxkcmVuQ2FsbGJh\nY2sgY2FsbGJhY2spIHsKICAgICAgICBiay5nZXRaa0hhbmRsZSgpLmdldENo\naWxkcmVuKHRoaXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aCwgdGhpcywgY2Fs\nbGJhY2ssIG51bGwpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICBy\nZWFkQm9va2llcygpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmpl\nY3QgY3R4LCBMaXN0PFN0cmluZz4gY2hpbGRyZW4pIHsKCiAgICAgICAgaWYg\nKHJjICE9IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk9LLmludFZhbHVlKCkpIHsK\nICAgICAgICAgICAgLy9sb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIHJlYWRp\nbmcgYm9va2llcyIsIEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoQ29kZS5nZXQo\ncmMpLCBwYXRoKSk7CiAgICAgICAgICAgIC8vIHRyeSB0aGUgcmVhZCBhZnRl\nciBhIHNlY29uZCBhZ2FpbgogICAgICAgICAgICBzY2hlZHVsZXIuc2NoZWR1\nbGUocmVSZWFkVGFzaywgWktfQ09OTkVDVF9CQUNLT0ZGX1NFQywgVGltZVVu\naXQuU0VDT05EUyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIC8vIEp1c3QgZXhjbHVkZSB0aGUgJ3JlYWRvbmx5JyB6bm9kZSB0\nbyBleGNsdWRlIHItbyBib29raWVzIGZyb20KICAgICAgICAvLyBhdmFpbGFi\nbGUgbm9kZXMgbGlzdC4KICAgICAgICBjaGlsZHJlbi5yZW1vdmUoQm9va0tl\nZXBlckNvbnN0YW50cy5SRUFET05MWSk7CgogICAgICAgIEhhc2hTZXQ8SW5l\ndFNvY2tldEFkZHJlc3M+IG5ld0Jvb2tpZUFkZHJzID0gY29udmVydFRvQm9v\na2llQWRkcmVzc2VzKGNoaWxkcmVuKTsKCiAgICAgICAgZmluYWwgSGFzaFNl\ndDxJbmV0U29ja2V0QWRkcmVzcz4gZGVhZEJvb2tpZXM7CiAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGRlYWRCb29raWVzID0g\nKEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+KWtub3duQm9va2llcy5jbG9u\nZSgpOwogICAgICAgICAgICBkZWFkQm9va2llcy5yZW1vdmVBbGwobmV3Qm9v\na2llQWRkcnMpOwogICAgICAgICAgICAvLyBObyBuZWVkIHRvIGNsb3NlIHJl\nYWRvbmx5IGJvb2tpZSBjbGllbnRzLgogICAgICAgICAgICBkZWFkQm9va2ll\ncy5yZW1vdmVBbGwocmVhZE9ubHlCb29raWVXYXRjaGVyLmdldFJlYWRPbmx5\nQm9va2llcygpKTsKICAgICAgICAgICAga25vd25Cb29raWVzID0gbmV3Qm9v\na2llQWRkcnM7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmsuZ2V0Qm9va2ll\nQ2xpZW50KCkgIT0gbnVsbCkgewogICAgICAgICAgICBiay5nZXRCb29raWVD\nbGllbnQoKS5jbG9zZUNsaWVudHMoZGVhZEJvb2tpZXMpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBIYXNoU2V0PEluZXRTb2NrZXRB\nZGRyZXNzPiBjb252ZXJ0VG9Cb29raWVBZGRyZXNzZXMoTGlzdDxTdHJpbmc+\nIGNoaWxkcmVuKSB7CiAgICAgICAgLy8gUmVhZCB0aGUgYm9va2llIGFkZHJl\nc3NlcyBpbnRvIGEgc2V0IGZvciBlZmZpY2llbnQgbG9va3VwCiAgICAgICAg\nSGFzaFNldDxJbmV0U29ja2V0QWRkcmVzcz4gbmV3Qm9va2llQWRkcnMgPSBu\nZXcgSGFzaFNldDxJbmV0U29ja2V0QWRkcmVzcz4oKTsKICAgICAgICBmb3Ig\nKFN0cmluZyBib29raWVBZGRyU3RyaW5nIDogY2hpbGRyZW4pIHsKICAgICAg\nICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llQWRkcjsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGJvb2tpZUFkZHIgPSBTdHJpbmdV\ndGlscy5wYXJzZUFkZHIoYm9va2llQWRkclN0cmluZyk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGxv\nZ2dlci5lcnJvcigiQ291bGQgbm90IHBhcnNlIGJvb2tpZSBhZGRyZXNzOiAi\nICsgYm9va2llQWRkclN0cmluZyArICIsIGlnbm9yaW5nIHRoaXMgYm9va2ll\nIik7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBuZXdCb29raWVBZGRycy5hZGQoYm9va2llQWRkcik7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBuZXdCb29raWVBZGRyczsKICAgIH0K\nCiAgICAvKioKICAgICAqIEJsb2NrcyB1bnRpbCBib29raWVzIGFyZSByZWFk\nIGZyb20gem9va2VlcGVyLCB1c2VkIGluIHRoZSB7QGxpbmsgQm9va0tlZXBl\ncn0gY29uc3RydWN0b3IuCiAgICAgKiBAdGhyb3dzIEludGVycnVwdGVkRXhj\nZXB0aW9uCiAgICAgKiBAdGhyb3dzIEtlZXBlckV4Y2VwdGlvbgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCByZWFkQm9va2llc0Jsb2NraW5nKCkgdGhyb3dz\nIEludGVycnVwdGVkRXhjZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24gewogICAg\nICAgIC8vIFJlYWQgcmVhZG9ubHkgYm9va2llcyBmaXJzdAogICAgICAgIHJl\nYWRPbmx5Qm9va2llV2F0Y2hlci5yZWFkUk9Cb29raWVzQmxvY2tpbmcoKTsK\nCiAgICAgICAgZmluYWwgTGlua2VkQmxvY2tpbmdRdWV1ZTxJbnRlZ2VyPiBx\ndWV1ZSA9IG5ldyBMaW5rZWRCbG9ja2luZ1F1ZXVlPEludGVnZXI+KCk7CiAg\nICAgICAgcmVhZEJvb2tpZXMobmV3IENoaWxkcmVuQ2FsbGJhY2soKSB7CiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBT\ndHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgTGlzdDxTdHJpbmc+IGNoaWxkcmVu\nKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIEJvb2tpZVdhdGNoZXIudGhpcy5wcm9jZXNzUmVzdWx0KHJjLCBwYXRoLCBj\ndHgsIGNoaWxkcmVuKTsKICAgICAgICAgICAgICAgICAgICBxdWV1ZS5wdXQo\ncmMpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigi\nSW50ZXJydXBlZCB3aGVuIHRyeWluZyB0byByZWFkIGJvb2tpZXMgaW4gYSBi\nbG9ja2luZyBmYXNoaW9uIik7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IFJ1bnRpbWVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICBpbnQgcmMgPSBxdWV1\nZS50YWtlKCk7CgogICAgICAgIGlmIChyYyAhPSBLZWVwZXJFeGNlcHRpb24u\nQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgIHRocm93IEtlZXBl\nckV4Y2VwdGlvbi5jcmVhdGUoQ29kZS5nZXQocmMpKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBXcmFwcGVyIG92ZXIgdGhlIHtAbGluayAj\nZ2V0QWRkaXRpb25hbEJvb2tpZXMoU2V0LCBpbnQpfSBtZXRob2Qgd2hlbiB0\naGVyZSBpcyBubyBleGNsdXNpb24gbGlzdCAob3IgZXhpc2l0aW5nIGJvb2tp\nZXMpCiAgICAgKiBAcGFyYW0gbnVtQm9va2llc05lZWRlZAogICAgICogQHJl\ndHVybgogICAgICogQHRocm93cyBCS05vdEVub3VnaEJvb2tpZXNFeGNlcHRp\nb24KICAgICAqLwogICAgcHVibGljIEFycmF5TGlzdDxJbmV0U29ja2V0QWRk\ncmVzcz4gZ2V0TmV3Qm9va2llcyhpbnQgbnVtQm9va2llc05lZWRlZCkgdGhy\nb3dzIEJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIGdldEFkZGl0aW9uYWxCb29raWVzKEVNUFRZX1NFVCwgbnVtQm9va2ll\nc05lZWRlZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBXcmFwcGVyIG92ZXIg\ndGhlIHtAbGluayAjZ2V0QWRkaXRpb25hbEJvb2tpZXMoU2V0LCBpbnQpfSBt\nZXRob2Qgd2hlbiB5b3UganVzdCBuZWVkIDEgZXh0cmEgYm9va2llCiAgICAg\nKiBAcGFyYW0gZXhpc3RpbmdCb29raWVzCiAgICAgKiBAcmV0dXJuCiAgICAg\nKiBAdGhyb3dzIEJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbgogICAgICov\nCiAgICBwdWJsaWMgSW5ldFNvY2tldEFkZHJlc3MgZ2V0QWRkaXRpb25hbEJv\nb2tpZShMaXN0PEluZXRTb2NrZXRBZGRyZXNzPiBleGlzdGluZ0Jvb2tpZXMp\nCiAgICAgICAgICAgIHRocm93cyBCS05vdEVub3VnaEJvb2tpZXNFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBnZXRBZGRpdGlvbmFsQm9va2llcyhuZXcg\nSGFzaFNldDxJbmV0U29ja2V0QWRkcmVzcz4oZXhpc3RpbmdCb29raWVzKSwg\nMSkuZ2V0KDApOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJucyBhZGRp\ndGlvbmFsIGJvb2tpZXMgZ2l2ZW4gYW4gZXhjbHVzaW9uIGxpc3QgYW5kIGhv\ndyBtYW55IGFyZSBuZWVkZWQKICAgICAqIEBwYXJhbSBleGlzdGluZ0Jvb2tp\nZXMKICAgICAqIEBwYXJhbSBudW1BZGRpdGlvbmFsQm9va2llc05lZWRlZAog\nICAgICogQHJldHVybgogICAgICogQHRocm93cyBCS05vdEVub3VnaEJvb2tp\nZXNFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIEFycmF5TGlzdDxJbmV0\nU29ja2V0QWRkcmVzcz4gZ2V0QWRkaXRpb25hbEJvb2tpZXMoU2V0PEluZXRT\nb2NrZXRBZGRyZXNzPiBleGlzdGluZ0Jvb2tpZXMsCiAgICAgICAgICAgIGlu\ndCBudW1BZGRpdGlvbmFsQm9va2llc05lZWRlZCkgdGhyb3dzIEJLTm90RW5v\ndWdoQm9va2llc0V4Y2VwdGlvbiB7CgogICAgICAgIEFycmF5TGlzdDxJbmV0\nU29ja2V0QWRkcmVzcz4gbmV3Qm9va2llcyA9IG5ldyBBcnJheUxpc3Q8SW5l\ndFNvY2tldEFkZHJlc3M+KCk7CgogICAgICAgIGlmIChudW1BZGRpdGlvbmFs\nQm9va2llc05lZWRlZCA8PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBuZXdC\nb29raWVzOwogICAgICAgIH0KCiAgICAgICAgTGlzdDxJbmV0U29ja2V0QWRk\ncmVzcz4gYWxsQm9va2llczsKCiAgICAgICAgc3luY2hyb25pemVkICh0aGlz\nKSB7CiAgICAgICAgICAgIGFsbEJvb2tpZXMgPSBuZXcgQXJyYXlMaXN0PElu\nZXRTb2NrZXRBZGRyZXNzPihrbm93bkJvb2tpZXMpOwogICAgICAgIH0KCiAg\nICAgICAgQ29sbGVjdGlvbnMuc2h1ZmZsZShhbGxCb29raWVzKTsKCiAgICAg\nICAgZm9yIChJbmV0U29ja2V0QWRkcmVzcyBib29raWUgOiBhbGxCb29raWVz\nKSB7CiAgICAgICAgICAgIGlmIChleGlzdGluZ0Jvb2tpZXMuY29udGFpbnMo\nYm9va2llKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIG5ld0Jvb2tpZXMuYWRkKGJvb2tpZSk7CiAg\nICAgICAgICAgIG51bUFkZGl0aW9uYWxCb29raWVzTmVlZGVkLS07CgogICAg\nICAgICAgICBpZiAobnVtQWRkaXRpb25hbEJvb2tpZXNOZWVkZWQgPT0gMCkg\newogICAgICAgICAgICAgICAgcmV0dXJuIG5ld0Jvb2tpZXM7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHRocm93IG5ldyBCS05vdEVub3Vn\naEJvb2tpZXNFeGNlcHRpb24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdh\ndGNoZXIgaW1wbGVtZW50YXRpb24gdG8gd2F0Y2ggdGhlIHJlYWRvbmx5IGJv\nb2tpZXMgdW5kZXIKICAgICAqICZsdDthdmFpbGFibGUmZ3Q7L3JlYWRvbmx5\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFJlYWRPbmx5Qm9v\na2llV2F0Y2hlciBpbXBsZW1lbnRzIFdhdGNoZXIsIENoaWxkcmVuQ2FsbGJh\nY2sgewoKICAgICAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBMb2dnZXIgTE9H\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoUmVhZE9ubHlCb29raWVXYXRj\naGVyLmNsYXNzKTsKICAgICAgICBwcml2YXRlIEhhc2hTZXQ8SW5ldFNvY2tl\ndEFkZHJlc3M+IHJlYWRPbmx5Qm9va2llcyA9IG5ldyBIYXNoU2V0PEluZXRT\nb2NrZXRBZGRyZXNzPigpOwogICAgICAgIHByaXZhdGUgQm9va0tlZXBlciBi\nazsKICAgICAgICBwcml2YXRlIFN0cmluZyByZWFkT25seUJvb2tpZVJlZ1Bh\ndGg7CgogICAgICAgIHB1YmxpYyBSZWFkT25seUJvb2tpZVdhdGNoZXIoQ2xp\nZW50Q29uZmlndXJhdGlvbiBjb25mLCBCb29rS2VlcGVyIGJrKSB0aHJvd3Mg\nS2VlcGVyRXhjZXB0aW9uLAogICAgICAgICAgICAgICAgSW50ZXJydXB0ZWRF\neGNlcHRpb24gewogICAgICAgICAgICB0aGlzLmJrID0gYms7CiAgICAgICAg\nICAgIHJlYWRPbmx5Qm9va2llUmVnUGF0aCA9IGNvbmYuZ2V0WmtBdmFpbGFi\nbGVCb29raWVzUGF0aCgpICsgIi8iCiAgICAgICAgICAgICAgICAgICAgKyBC\nb29rS2VlcGVyQ29uc3RhbnRzLlJFQURPTkxZOwogICAgICAgICAgICBpZiAo\nbnVsbCA9PSBiay5nZXRaa0hhbmRsZSgpLmV4aXN0cyhyZWFkT25seUJvb2tp\nZVJlZ1BhdGgsIGZhbHNlKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICBiay5nZXRaa0hhbmRsZSgpLmNyZWF0ZShyZWFk\nT25seUJvb2tpZVJlZ1BhdGgsIG5ldyBieXRlWzBdLCBJZHMuT1BFTl9BQ0xf\nVU5TQUZFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlTW9k\nZS5QRVJTSVNURU5UKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vZGVF\neGlzdHNFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRo\naXMgbm9kZSBpcyBqdXN0IG5vdyBjcmVhdGVkIGJ5IHNvbWVvbmUuCiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hl\nZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgIHJlYWRST0Jvb2tpZXMoKTsK\nICAgICAgICB9CgogICAgICAgIC8vIHJlYWQgdGhlIHJlYWRvbmx5IGJvb2tp\nZXMgaW4gYmxvY2tpbmcgZmFzaGlvbi4gVXNlZCBvbmx5IGZvciBmaXJzdAog\nICAgICAgIC8vIHRpbWUuCiAgICAgICAgdm9pZCByZWFkUk9Cb29raWVzQmxv\nY2tpbmcoKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEtlZXBlckV4\nY2VwdGlvbiB7CgogICAgICAgICAgICBmaW5hbCBMaW5rZWRCbG9ja2luZ1F1\nZXVlPEludGVnZXI+IHF1ZXVlID0gbmV3IExpbmtlZEJsb2NraW5nUXVldWU8\nSW50ZWdlcj4oKTsKICAgICAgICAgICAgcmVhZFJPQm9va2llcyhuZXcgQ2hp\nbGRyZW5DYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0\neCwgTGlzdDxTdHJpbmc+IGNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgUmVhZE9ubHlCb29r\naWVXYXRjaGVyLnRoaXMucHJvY2Vzc1Jlc3VsdChyYywgcGF0aCwgY3R4LCBj\naGlsZHJlbik7CiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlLnB1dChy\nYyk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIu\nZXJyb3IoIkludGVycnVwZWQgd2hlbiB0cnlpbmcgdG8gcmVhZCByZWFkb25s\neSBib29raWVzIGluIGEgYmxvY2tpbmcgZmFzaGlvbiIpOwogICAgICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbihlKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0pOwogICAgICAgICAgICBpbnQgcmMgPSBxdWV1ZS50YWtlKCk7\nCgogICAgICAgICAgICBpZiAocmMgIT0gS2VlcGVyRXhjZXB0aW9uLkNvZGUu\nT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgS2VlcGVy\nRXhjZXB0aW9uLmNyZWF0ZShDb2RlLmdldChyYykpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvLyBSZWFkIGNoaWxkcmVuIGFuZCByZWdp\nc3RlciB3YXRjaGVyIGZvciByZWFkb25seSBib29raWVzIHBhdGgKICAgICAg\nICB2b2lkIHJlYWRST0Jvb2tpZXMoQ2hpbGRyZW5DYWxsYmFjayBjYWxsYmFj\naykgewogICAgICAgICAgICBiay5nZXRaa0hhbmRsZSgpLmdldENoaWxkcmVu\nKHRoaXMucmVhZE9ubHlCb29raWVSZWdQYXRoLCB0aGlzLCBjYWxsYmFjaywg\nbnVsbCk7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHJlYWRST0Jvb2tpZXMo\nKSB7CiAgICAgICAgICAgIHJlYWRST0Jvb2tpZXModGhpcyk7CiAgICAgICAg\nfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBwcm9j\nZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsIExp\nc3Q8U3RyaW5nPiBjaGlsZHJlbikgewogICAgICAgICAgICBpZiAocmMgIT0g\nQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIk5vdCBhYmxlIHRvIHJlYWQgcmVhZG9ubHkgYm9va2llcyA6ICIsIEtl\nZXBlckV4Y2VwdGlvbi5jcmVhdGUoQ29kZS5nZXQocmMpKSk7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEhh\nc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+IG5ld1JlYWRPbmx5Qm9va2llcyA9\nIGNvbnZlcnRUb0Jvb2tpZUFkZHJlc3NlcyhjaGlsZHJlbik7CiAgICAgICAg\nICAgIHJlYWRPbmx5Qm9va2llcyA9IG5ld1JlYWRPbmx5Qm9va2llczsKICAg\nICAgICB9CgogICAgICAgIC8vIHJldHVybnMgdGhlIHJlYWRvbmx5IGJvb2tp\nZXMKICAgICAgICBwdWJsaWMgSGFzaFNldDxJbmV0U29ja2V0QWRkcmVzcz4g\nZ2V0UmVhZE9ubHlCb29raWVzKCkgewogICAgICAgICAgICByZXR1cm4gcmVh\nZE9ubHlCb29raWVzOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

