{"sha":"c0cfdb736ab0b9a8db51178716d6151c5d7791e4","node_id":"MDQ6QmxvYjE1NzU5NTY6YzBjZmRiNzM2YWIwYjlhOGRiNTExNzg3MTZkNjE1MWM1ZDc3OTFlNA==","size":39835,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c0cfdb736ab0b9a8db51178716d6151c5d7791e4","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudDsKCmlt\ncG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuR2VuZXJhbFNlY3VyaXR5RXhjZXB0aW9uOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudExpbmtlZFF1ZXVlOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZh\nLnV0aWwuUXVldWU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suUmVhZExhc3RDb25maXJtZWRDYWxs\nYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50\nLkFzeW5jQ2FsbGJhY2suQWRkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suQ2xvc2VDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmND\nYWxsYmFjay5SZWFkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9va2llc0V4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQm9va0tlZXBlci5EaWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5MZWRnZXJNZXRhZGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnV0aWwuT3JkZXJlZFNhZmVFeGVjdXRvci5PcmRlcmVkU2FmZUdlbmVy\naWNDYWxsYmFjazsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uQm9va2llUHJvdG9jb2w7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU3Rh\ndGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TYWZlUnVu\nbmFibGU7CgppbXBvcnQgY29tLmdvb2dsZS5jb21tb24udXRpbC5jb25jdXJy\nZW50LlJhdGVMaW1pdGVyOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7Cmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7CgovKioKICogTGVkZ2Vy\nIGhhbmRsZSBjb250YWlucyBsZWRnZXIgbWV0YWRhdGEgYW5kIGlzIHVzZWQg\ndG8gYWNjZXNzIHRoZSByZWFkIGFuZAogKiB3cml0ZSBvcGVyYXRpb25zIHRv\nIGEgbGVkZ2VyLgogKi8KcHVibGljIGNsYXNzIExlZGdlckhhbmRsZSB7CiAg\nICBmaW5hbCBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0\nTG9nZ2VyKExlZGdlckhhbmRsZS5jbGFzcyk7CgogICAgZmluYWwgYnl0ZVtd\nIGxlZGdlcktleTsKICAgIExlZGdlck1ldGFkYXRhIG1ldGFkYXRhOwogICAg\nZmluYWwgQm9va0tlZXBlciBiazsKICAgIGZpbmFsIGxvbmcgbGVkZ2VySWQ7\nCiAgICBsb25nIGxhc3RBZGRQdXNoZWQ7CiAgICBsb25nIGxhc3RBZGRDb25m\naXJtZWQ7CiAgICBsb25nIGxlbmd0aDsKICAgIGZpbmFsIERpZ2VzdE1hbmFn\nZXIgbWFjTWFuYWdlcjsKICAgIGZpbmFsIERpc3RyaWJ1dGlvblNjaGVkdWxl\nIGRpc3RyaWJ1dGlvblNjaGVkdWxlOwoKICAgIGZpbmFsIFJhdGVMaW1pdGVy\nIHRocm90dGxlcjsKCiAgICAvKioKICAgICAqIEludmFsaWQgZW50cnkgaWQu\nIFRoaXMgdmFsdWUgaXMgcmV0dXJuZWQgZnJvbSBtZXRob2RzIHdoaWNoCiAg\nICAgKiBzaG91bGQgcmV0dXJuIGFuIGVudHJ5IGlkIGJ1dCB0aGVyZSBpcyBu\nbyB2YWxpZCBlbnRyeSBhdmFpbGFibGUuCiAgICAgKi8KICAgIGZpbmFsIHN0\nYXRpYyBwdWJsaWMgbG9uZyBJTlZBTElEX0VOVFJZX0lEID0gQm9va2llUHJv\ndG9jb2wuSU5WQUxJRF9FTlRSWV9JRDsKCiAgICBmaW5hbCBBdG9taWNJbnRl\nZ2VyIGJsb2NrQWRkQ29tcGxldGlvbnMgPSBuZXcgQXRvbWljSW50ZWdlcigw\nKTsKICAgIGZpbmFsIFF1ZXVlPFBlbmRpbmdBZGRPcD4gcGVuZGluZ0FkZE9w\ncyA9IG5ldyBDb25jdXJyZW50TGlua2VkUXVldWU8UGVuZGluZ0FkZE9wPigp\nOwoKICAgIExlZGdlckhhbmRsZShCb29rS2VlcGVyIGJrLCBsb25nIGxlZGdl\ncklkLCBMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YSwKICAgICAgICAgICAgICAg\nICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUsIGJ5dGVbXSBwYXNzd29yZCkKICAg\nICAgICAgICAgdGhyb3dzIEdlbmVyYWxTZWN1cml0eUV4Y2VwdGlvbiwgTnVt\nYmVyRm9ybWF0RXhjZXB0aW9uIHsKICAgICAgICB0aGlzLmJrID0gYms7CiAg\nICAgICAgdGhpcy5tZXRhZGF0YSA9IG1ldGFkYXRhOwoKICAgICAgICBpZiAo\nbWV0YWRhdGEuaXNDbG9zZWQoKSkgewogICAgICAgICAgICBsYXN0QWRkQ29u\nZmlybWVkID0gbGFzdEFkZFB1c2hlZCA9IG1ldGFkYXRhLmdldExhc3RFbnRy\neUlkKCk7CiAgICAgICAgICAgIGxlbmd0aCA9IG1ldGFkYXRhLmdldExlbmd0\naCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxhc3RBZGRDb25m\naXJtZWQgPSBsYXN0QWRkUHVzaGVkID0gSU5WQUxJRF9FTlRSWV9JRDsKICAg\nICAgICAgICAgbGVuZ3RoID0gMDsKICAgICAgICB9CgogICAgICAgIHRoaXMu\nbGVkZ2VySWQgPSBsZWRnZXJJZDsKCiAgICAgICAgdGhpcy50aHJvdHRsZXIg\nPSBSYXRlTGltaXRlci5jcmVhdGUoYmsuZ2V0Q29uZigpLmdldFRocm90dGxl\nVmFsdWUoKSk7CgogICAgICAgIG1hY01hbmFnZXIgPSBEaWdlc3RNYW5hZ2Vy\nLmluc3RhbnRpYXRlKGxlZGdlcklkLCBwYXNzd29yZCwgZGlnZXN0VHlwZSk7\nCiAgICAgICAgdGhpcy5sZWRnZXJLZXkgPSBNYWNEaWdlc3RNYW5hZ2VyLmdl\nbkRpZ2VzdCgibGVkZ2VyIiwgcGFzc3dvcmQpOwogICAgICAgIGRpc3RyaWJ1\ndGlvblNjaGVkdWxlID0gbmV3IFJvdW5kUm9iaW5EaXN0cmlidXRpb25TY2hl\nZHVsZSgKICAgICAgICAgICAgICAgIG1ldGFkYXRhLmdldFdyaXRlUXVvcnVt\nU2l6ZSgpLCBtZXRhZGF0YS5nZXRBY2tRdW9ydW1TaXplKCksIG1ldGFkYXRh\nLmdldEVuc2VtYmxlU2l6ZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdl\ndCB0aGUgaWQgb2YgdGhlIGN1cnJlbnQgbGVkZ2VyCiAgICAgKgogICAgICog\nQHJldHVybiB0aGUgaWQgb2YgdGhlIGxlZGdlcgogICAgICovCiAgICBwdWJs\naWMgbG9uZyBnZXRJZCgpIHsKICAgICAgICByZXR1cm4gbGVkZ2VySWQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxhc3QgY29uZmlybWVkIGVu\ndHJ5IGlkIG9uIHRoaXMgbGVkZ2VyLiBJdCByZWFkcwogICAgICogdGhlIGxv\nY2FsIHN0YXRlIG9mIHRoZSBsZWRnZXIgaGFuZGxlLCB3aGljaCBpcyBkaWZm\nZXJlbnQKICAgICAqIGZyb20gdGhlIHJlYWRMYXN0Q29uZmlybWVkIGNhbGwu\nIEluIHRoZSBjYXNlIHRoZSBsZWRnZXIKICAgICAqIGlzIG5vdCBjbG9zZWQg\nYW5kIHRoZSBjbGllbnQgaXMgYSByZWFkZXIsIGl0IGlzIG5lY2Vzc2FyeQog\nICAgICogdG8gY2FsbCByZWFkTGFzdENvbmZpcm1lZCB0byBvYnRhaW4gYW4g\nZXN0aW1hdGUgb2YgdGhlCiAgICAgKiBsYXN0IGFkZCBvcGVyYXRpb24gdGhh\ndCBoYXMgYmVlbiBjb25maXJtZWQuCiAgICAgKgogICAgICogQHNlZSAjcmVh\nZExhc3RDb25maXJtZWQoKQogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGxh\nc3QgY29uZmlybWVkIGVudHJ5IGlkIG9yIHtAbGluayAjSU5WQUxJRF9FTlRS\nWV9JRCBJTlZBTElEX0VOVFJZX0lEfSBpZiBubyBlbnRyeSBoYXMgYmVlbiBj\nb25maXJtZWQKICAgICAqLwogICAgcHVibGljIGxvbmcgZ2V0TGFzdEFkZENv\nbmZpcm1lZCgpIHsKICAgICAgICByZXR1cm4gbGFzdEFkZENvbmZpcm1lZDsK\nICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgZW50cnkgaWQgb2YgdGhl\nIGxhc3QgZW50cnkgdGhhdCBoYXMgYmVlbiBlbnF1ZXVlZCBmb3IgYWRkaXRp\nb24gKGJ1dAogICAgICogbWF5IG5vdCBoYXZlIHBvc3NpYmx5IGJlZW4gcGVy\nc2l0ZWQgdG8gdGhlIGxlZGdlcikKICAgICAqCiAgICAgKiBAcmV0dXJuIHRo\nZSBpZCBvZiB0aGUgbGFzdCBlbnRyeSBwdXNoZWQgb3Ige0BsaW5rICNJTlZB\nTElEX0VOVFJZX0lEIElOVkFMSURfRU5UUllfSUR9IGlmIG5vIGVudHJ5IGhh\ncyBiZWVuIHB1c2hlZAogICAgICovCiAgICBzeW5jaHJvbml6ZWQgcHVibGlj\nIGxvbmcgZ2V0TGFzdEFkZFB1c2hlZCgpIHsKICAgICAgICByZXR1cm4gbGFz\ndEFkZFB1c2hlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgTGVk\nZ2VyJ3Mga2V5L3Bhc3N3b3JkLgogICAgICoKICAgICAqIEByZXR1cm4gYnl0\nZSBhcnJheSBmb3IgdGhlIGxlZGdlcidzIGtleS9wYXNzd29yZC4KICAgICAq\nLwogICAgcHVibGljIGJ5dGVbXSBnZXRMZWRnZXJLZXkoKSB7CiAgICAgICAg\ncmV0dXJuIEFycmF5cy5jb3B5T2YobGVkZ2VyS2V5LCBsZWRnZXJLZXkubGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgTGVkZ2VyTWV0\nYWRhdGEKICAgICAqCiAgICAgKiBAcmV0dXJuIExlZGdlck1ldGFkYXRhIGZv\nciB0aGUgTGVkZ2VySGFuZGxlCiAgICAgKi8KICAgIExlZGdlck1ldGFkYXRh\nIGdldExlZGdlck1ldGFkYXRhKCkgewogICAgICAgIHJldHVybiBtZXRhZGF0\nYTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgRGlnZXN0TWFuYWdl\ncgogICAgICoKICAgICAqIEByZXR1cm4gRGlnZXN0TWFuYWdlciBmb3IgdGhl\nIExlZGdlckhhbmRsZQogICAgICovCiAgICBEaWdlc3RNYW5hZ2VyIGdldERp\nZ2VzdE1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIG1hY01hbmFnZXI7CiAg\nICB9CgogICAgLyoqCiAgICAgKiAgQWRkIHRvIHRoZSBsZW5ndGggb2YgdGhl\nIGxlZGdlciBpbiBieXRlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gZGVsdGEK\nICAgICAqIEByZXR1cm4KICAgICAqLwogICAgbG9uZyBhZGRUb0xlbmd0aChs\nb25nIGRlbHRhKSB7CiAgICAgICAgdGhpcy5sZW5ndGggKz0gZGVsdGE7CiAg\nICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoOwogICAgfQoKICAgIC8qKgogICAg\nICogUmV0dXJucyB0aGUgbGVuZ3RoIG9mIHRoZSBsZWRnZXIgaW4gYnl0ZXMu\nCiAgICAgKgogICAgICogQHJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBsZWRn\nZXIgaW4gYnl0ZXMKICAgICAqLwogICAgc3luY2hyb25pemVkIHB1YmxpYyBs\nb25nIGdldExlbmd0aCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGg7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIERpc3RyaWJ1dGlvbiBT\nY2hlZHVsZQogICAgICoKICAgICAqIEByZXR1cm4gRGlzdHJpYnV0aW9uU2No\nZWR1bGUgZm9yIHRoZSBMZWRnZXJIYW5kbGUKICAgICAqLwogICAgRGlzdHJp\nYnV0aW9uU2NoZWR1bGUgZ2V0RGlzdHJpYnV0aW9uU2NoZWR1bGUoKSB7CiAg\nICAgICAgcmV0dXJuIGRpc3RyaWJ1dGlvblNjaGVkdWxlOwogICAgfQoKICAg\nIHZvaWQgd3JpdGVMZWRnZXJDb25maWcoR2VuZXJpY0NhbGxiYWNrPFZvaWQ+\nIHdyaXRlQ2IpIHsKICAgICAgICBMT0cuZGVidWcoIldyaXRpbmcgbWV0YWRh\ndGEgdG8gbGVkZ2VyIG1hbmFnZXI6IHt9LCB7fSIsIHRoaXMubGVkZ2VySWQs\nIG1ldGFkYXRhLmdldFZlcnNpb24oKSk7CgogICAgICAgIGJrLmdldExlZGdl\nck1hbmFnZXIoKS53cml0ZUxlZGdlck1ldGFkYXRhKGxlZGdlcklkLCBtZXRh\nZGF0YSwgd3JpdGVDYik7CiAgICB9CgogICAgLyoqCiAgICAgKiBDbG9zZSB0\naGlzIGxlZGdlciBzeW5jaHJvbm91c2x5LgogICAgICogQHNlZSAjYXN5bmND\nbG9zZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIAogICAgICAg\nICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9u\nIHsKICAgICAgICBTeW5jQ291bnRlciBjb3VudGVyID0gbmV3IFN5bmNDb3Vu\ndGVyKCk7CiAgICAgICAgY291bnRlci5pbmMoKTsKCiAgICAgICAgYXN5bmND\nbG9zZShuZXcgU3luY0Nsb3NlQ2FsbGJhY2soKSwgY291bnRlcik7CgogICAg\nICAgIGNvdW50ZXIuYmxvY2soMCk7CiAgICAgICAgaWYgKGNvdW50ZXIuZ2V0\ncmMoKSAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgIHRo\ncm93IEJLRXhjZXB0aW9uLmNyZWF0ZShjb3VudGVyLmdldHJjKCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFzeW5jaHJvbm91cyBjbG9z\nZSwgYW55IGFkZHMgaW4gZmxpZ2h0IHdpbGwgcmV0dXJuIGVycm9ycy4KICAg\nICAqIAogICAgICogQ2xvc2luZyBhIGxlZGdlciB3aWxsIGVuc3VyZSB0aGF0\nIGFsbCBjbGllbnRzIGFncmVlIG9uIHdoYXQgdGhlIGxhc3QgZW50cnkgCiAg\nICAgKiBvZiB0aGUgbGVkZ2VyIGlzLiBUaGlzIGVuc3VyZXMgdGhhdCwgb25j\nZSB0aGUgbGVkZ2VyIGhhcyBiZWVuIGNsb3NlZCwgYWxsIAogICAgICogcmVh\nZHMgZnJvbSB0aGUgbGVkZ2VyIHdpbGwgcmV0dXJuIHRoZSBzYW1lIHNldCBv\nZiBlbnRyaWVzLiAKICAgICAqIAogICAgICogQHBhcmFtIGNiCiAgICAgKiAg\nICAgICAgICBjYWxsYmFjayBpbXBsZW1lbnRhdGlvbgogICAgICogQHBhcmFt\nIGN0eAogICAgICogICAgICAgICAgY29udHJvbCBvYmplY3QKICAgICAqIEB0\naHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgYXN5bmNDbG9zZShDbG9zZUNhbGxiYWNrIGNiLCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgYXN5bmNDbG9zZUludGVybmFsKGNiLCBjdHgsIEJLRXhj\nZXB0aW9uLkNvZGUuTGVkZ2VyQ2xvc2VkRXhjZXB0aW9uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNhbWUgYXMgcHVibGljIHZlcnNpb24gb2YgYXN5bmND\nbG9zZSBleGNlcHQgdGhhdCB0aGlzIG9uZSB0YWtlcyBhbgogICAgICogYWRk\naXRpb25hbCBwYXJhbWV0ZXIgd2hpY2ggaXMgdGhlIHJldHVybiBjb2RlIHRv\nIGhhbmQgdG8gYWxsIHRoZSBwZW5kaW5nCiAgICAgKiBhZGQgb3BzCiAgICAg\nKgogICAgICogQHBhcmFtIGNiCiAgICAgKiBAcGFyYW0gY3R4CiAgICAgKiBA\ncGFyYW0gcmMKICAgICAqLwogICAgdm9pZCBhc3luY0Nsb3NlSW50ZXJuYWwo\nZmluYWwgQ2xvc2VDYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCwgZmlu\nYWwgaW50IHJjKSB7CiAgICAgICAgYmsubWFpbldvcmtlclBvb2wuc3VibWl0\nT3JkZXJlZChsZWRnZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVS\ndW4oKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBsb25nIHByZXZMYXN0RW50\ncnlJZDsKICAgICAgICAgICAgICAgIGZpbmFsIGxvbmcgcHJldkxlbmd0aDsK\nICAgICAgICAgICAgICAgIGZpbmFsIFN0YXRlIHByZXZTdGF0ZTsKCiAgICAg\nICAgICAgICAgICBzeW5jaHJvbml6ZWQoTGVkZ2VySGFuZGxlLnRoaXMpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbWV0YWRhdGEgaXMgYWxy\nZWFkeSBjbG9zZWQsIHdlIGRvbid0IG5lZWQgdG8gcHJvY2VlZCB0aGUgcHJv\nY2VzcwogICAgICAgICAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgaXQgbWln\naHQgZW5kIHVwIGVuY291bnRlcmluZyBiYWQgdmVyc2lvbiBlcnJvciBsb2cg\nbWVzc2FnZXMgd2hlbiB1cGRhdGluZyBtZXRhZGF0YQogICAgICAgICAgICAg\nICAgICAgIGlmIChtZXRhZGF0YS5pc0Nsb3NlZCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLmNsb3NlQ29tcGxldGUoQktFeGNlcHRpb24uQ29k\nZS5PSywgTGVkZ2VySGFuZGxlLnRoaXMsIGN0eCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgcHJldlN0YXRlID0gbWV0YWRhdGEuZ2V0U3RhdGUo\nKTsKICAgICAgICAgICAgICAgICAgICBwcmV2TGFzdEVudHJ5SWQgPSBtZXRh\nZGF0YS5nZXRMYXN0RW50cnlJZCgpOwogICAgICAgICAgICAgICAgICAgIHBy\nZXZMZW5ndGggPSBtZXRhZGF0YS5nZXRMZW5ndGgoKTsKCiAgICAgICAgICAg\nICAgICAgICAgLy8gc3luY2hyb25pemVkIG9uIExlZGdlckhhbmRsZS50aGlz\nIHRvIGVuc3VyZSB0aGF0IAogICAgICAgICAgICAgICAgICAgIC8vIGxhc3RB\nZGRQdXNoZWQgY2FuIG5vdCBiZSB1cGRhdGVkIGFmdGVyIHRoZSBtZXRhZGF0\nYSAKICAgICAgICAgICAgICAgICAgICAvLyBpcyBjbG9zZWQuIAogICAgICAg\nICAgICAgICAgICAgIG1ldGFkYXRhLnNldExlbmd0aChsZW5ndGgpOwoKICAg\nICAgICAgICAgICAgICAgICBtZXRhZGF0YS5jbG9zZShsYXN0QWRkQ29uZmly\nbWVkKTsKICAgICAgICAgICAgICAgICAgICBlcnJvck91dFBlbmRpbmdBZGRz\nKHJjKTsKICAgICAgICAgICAgICAgICAgICBsYXN0QWRkUHVzaGVkID0gbGFz\ndEFkZENvbmZpcm1lZDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIkNsb3NpbmcgbGVkZ2VyOiAiICsgbGVkZ2Vy\nSWQgKyAiIGF0IGVudHJ5SWQ6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyBtZXRhZGF0YS5nZXRMYXN0RW50cnlJZCgpICsgIiB3aXRoIHRo\naXMgbWFueSBieXRlczogIiArIG1ldGFkYXRhLmdldExlbmd0aCgpKTsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBmaW5hbCBjbGFzcyBD\nbG9zZUNiIGV4dGVuZHMgT3JkZXJlZFNhZmVHZW5lcmljQ2FsbGJhY2s8Vm9p\nZD4gewogICAgICAgICAgICAgICAgICAgIENsb3NlQ2IoKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHN1cGVyKGJrLm1haW5Xb3JrZXJQb29sLCBsZWRn\nZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzYWZlT3BlcmF0aW9uQ29tcGxldGUoZmluYWwgaW50IHJjLCBWb2lkIHJl\nc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQktF\neGNlcHRpb24uQ29kZS5NZXRhZGF0YVZlcnNpb25FeGNlcHRpb24pIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHJlcmVhZE1ldGFkYXRhKG5ldyBP\ncmRlcmVkU2FmZUdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4oYmsu\nbWFpbldvcmtlclBvb2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxlZGdlcklkKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZXJhdGlvbkNvbXBsZXRl\nKGludCBuZXdyYywgTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3cmMgIT0gQktF\neGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciByZWFkaW5nIG5ldyBt\nZXRhZGF0YSBmcm9tIGxlZGdlciAiICsgbGVkZ2VySWQKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgd2hl\nbiBjbG9zaW5nLCBjb2RlPSIgKyBuZXdyYyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjYi5jbG9zZUNvbXBsZXRlKHJjLCBM\nZWRnZXJIYW5kbGUudGhpcywgY3R4KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLnNldFN0YXRlKHByZXZTdGF0\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAocHJldlN0YXRlLmVxdWFscyhTdGF0ZS5DTE9TRUQpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEu\nY2xvc2UocHJldkxhc3RFbnRyeUlkKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBtZXRhZGF0YS5zZXRMZW5ndGgocHJldkxlbmd0\naCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoIW1ldGFkYXRhLmlzTmV3ZXJUaGFuKG5ld01ldGEpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICFtZXRh\nZGF0YS5pc0NvbmZsaWN0V2l0aChuZXdNZXRhKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZSB0aGUgbmV3\nIG1ldGFkYXRhJ3MgZW5zZW1ibGUsIGluIGNhc2UgcmUtcmVwbGljYXRpb24g\nYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIHJlcGxhY2VkIHNvbWUgYm9va2llcyBpbiB0aGUgZW5zZW1i\nbGUuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbWV0YWRhdGEuc2V0RW5zZW1ibGVzKG5ld01ldGEuZ2V0RW5zZW1ibGVz\nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG1ldGFkYXRhLnNldFZlcnNpb24obmV3TWV0YS52ZXJzaW9uKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRh\nZGF0YS5zZXRMZW5ndGgobGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5jbG9zZShsYXN0QWRk\nQ29uZmlybWVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB3cml0ZUxlZGdlckNvbmZpZyhuZXcgQ2xvc2VDYigpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGFkYXRhLnNldExlbmd0aChsZW5ndGgpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRh\nLmNsb3NlKGxhc3RBZGRDb25maXJtZWQpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJDb25kaXRpb25h\nbCB1cGRhdGUgbGVkZ2VyIG1ldGFkYXRhIGZvciBsZWRnZXIgIiArIGxlZGdl\ncklkICsgIiBmYWlsZWQuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2IuY2xvc2VDb21wbGV0ZShyYywgTGVkZ2Vy\nSGFuZGxlLnRoaXMsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9L\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVy\ncm9yIHVwZGF0ZSBsZWRnZXIgbWV0YWRhdGEgZm9yIGxlZGdlciAiICsgbGVk\nZ2VySWQgKyAiIDogIiArIHJjKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGNiLmNsb3NlQ29tcGxldGUocmMsIExlZGdlckhhbmRsZS50aGlzLCBj\ndHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY2IuY2xvc2VDb21wbGV0ZShCS0V4Y2Vw\ndGlvbi5Db2RlLk9LLCBMZWRnZXJIYW5kbGUudGhpcywgY3R4KTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgd3JpdGVMZWRnZXJD\nb25maWcobmV3IENsb3NlQ2IoKSk7CgogICAgICAgICAgICB9CiAgICAgICAg\nfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWFkIGEgc2VxdWVuY2Ugb2Yg\nZW50cmllcyBzeW5jaHJvbm91c2x5LgogICAgICoKICAgICAqIEBwYXJhbSBm\naXJzdEVudHJ5CiAgICAgKiAgICAgICAgICBpZCBvZiBmaXJzdCBlbnRyeSBv\nZiBzZXF1ZW5jZSAoaW5jbHVkZWQpCiAgICAgKiBAcGFyYW0gbGFzdEVudHJ5\nCiAgICAgKiAgICAgICAgICBpZCBvZiBsYXN0IGVudHJ5IG9mIHNlcXVlbmNl\nIChpbmNsdWRlZCkKICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gcmVhZEVudHJpZXMobG9uZyBmaXJzdEVudHJ5\nLCBsb25nIGxhc3RFbnRyeSkKICAgICAgICAgICAgdGhyb3dzIEludGVycnVw\ndGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgU3luY0NvdW50\nZXIgY291bnRlciA9IG5ldyBTeW5jQ291bnRlcigpOwogICAgICAgIGNvdW50\nZXIuaW5jKCk7CgogICAgICAgIGFzeW5jUmVhZEVudHJpZXMoZmlyc3RFbnRy\neSwgbGFzdEVudHJ5LCBuZXcgU3luY1JlYWRDYWxsYmFjaygpLCBjb3VudGVy\nKTsKCiAgICAgICAgY291bnRlci5ibG9jaygwKTsKICAgICAgICBpZiAoY291\nbnRlci5nZXRyYygpICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAg\nICAgICAgdGhyb3cgQktFeGNlcHRpb24uY3JlYXRlKGNvdW50ZXIuZ2V0cmMo\nKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY291bnRlci5nZXRTZXF1\nZW5jZSgpOwogICAgfQoKICAgIC8qKgogICAgICogUmVhZCBhIHNlcXVlbmNl\nIG9mIGVudHJpZXMgYXN5bmNocm9ub3VzbHkuCiAgICAgKgogICAgICogQHBh\ncmFtIGZpcnN0RW50cnkKICAgICAqICAgICAgICAgIGlkIG9mIGZpcnN0IGVu\ndHJ5IG9mIHNlcXVlbmNlCiAgICAgKiBAcGFyYW0gbGFzdEVudHJ5CiAgICAg\nKiAgICAgICAgICBpZCBvZiBsYXN0IGVudHJ5IG9mIHNlcXVlbmNlCiAgICAg\nKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAgIG9iamVjdCBpbXBsZW1lbnRp\nbmcgcmVhZCBjYWxsYmFjayBpbnRlcmZhY2UKICAgICAqIEBwYXJhbSBjdHgK\nICAgICAqICAgICAgICAgIGNvbnRyb2wgb2JqZWN0CiAgICAgKi8KICAgIHB1\nYmxpYyB2b2lkIGFzeW5jUmVhZEVudHJpZXMobG9uZyBmaXJzdEVudHJ5LCBs\nb25nIGxhc3RFbnRyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgUmVhZENhbGxiYWNrIGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAgLy8g\nTGl0dGxlIHNhbml0eSBjaGVjawogICAgICAgIGlmIChmaXJzdEVudHJ5IDwg\nMCB8fCBsYXN0RW50cnkgPiBsYXN0QWRkQ29uZmlybWVkCiAgICAgICAgICAg\nICAgICB8fCBmaXJzdEVudHJ5ID4gbGFzdEVudHJ5KSB7CiAgICAgICAgICAg\nIGNiLnJlYWRDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLlJlYWRFeGNlcHRp\nb24sIHRoaXMsIG51bGwsIGN0eCk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG5ldyBQZW5kaW5n\nUmVhZE9wKHRoaXMsIGJrLnNjaGVkdWxlciwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZmlyc3RFbnRyeSwgbGFzdEVudHJ5LCBjYiwgY3R4KS5p\nbml0aWF0ZSgpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgY2IucmVhZENvbXBsZXRlKEJLRXhjZXB0\naW9uLkNvZGUuSW50ZXJydXB0ZWRFeGNlcHRpb24sIHRoaXMsIG51bGwsIGN0\neCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGVudHJ5\nIHN5bmNocm9ub3VzbHkgdG8gYW4gb3BlbiBsZWRnZXIuCiAgICAgKgogICAg\nICogQHBhcmFtIGRhdGEKICAgICAqICAgICAgICAgYXJyYXkgb2YgYnl0ZXMg\ndG8gYmUgd3JpdHRlbiB0byB0aGUgbGVkZ2VyCiAgICAgKiBAcmV0dXJuIHRo\nZSBlbnRyeUlkIG9mIHRoZSBuZXcgaW5zZXJ0ZWQgZW50cnkKICAgICAqLwog\nICAgcHVibGljIGxvbmcgYWRkRW50cnkoYnl0ZVtdIGRhdGEpIHRocm93cyBJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBhZGRFbnRyeShkYXRhLCAwLCBkYXRhLmxlbmd0aCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgZW50cnkgc3luY2hyb25vdXNseSB0byBhbiBv\ncGVuIGxlZGdlci4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YQogICAgICog\nICAgICAgICBhcnJheSBvZiBieXRlcyB0byBiZSB3cml0dGVuIHRvIHRoZSBs\nZWRnZXIKICAgICAqIEBwYXJhbSBvZmZzZXQKICAgICAqICAgICAgICAgIG9m\nZnNldCBmcm9tIHdoaWNoIHRvIHRha2UgYnl0ZXMgZnJvbSBkYXRhCiAgICAg\nKiBAcGFyYW0gbGVuZ3RoCiAgICAgKiAgICAgICAgICBudW1iZXIgb2YgYnl0\nZXMgdG8gdGFrZSBmcm9tIGRhdGEKICAgICAqIEByZXR1cm4gdGhlIGVudHJ5\nSWQgb2YgdGhlIG5ldyBpbnNlcnRlZCBlbnRyeQogICAgICovCiAgICBwdWJs\naWMgbG9uZyBhZGRFbnRyeShieXRlW10gZGF0YSwgaW50IG9mZnNldCwgaW50\nIGxlbmd0aCkKICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0\naW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgTE9HLmRlYnVnKCJBZGRpbmcg\nZW50cnkge30iLCBkYXRhKTsKCiAgICAgICAgU3luY0NvdW50ZXIgY291bnRl\nciA9IG5ldyBTeW5jQ291bnRlcigpOwogICAgICAgIGNvdW50ZXIuaW5jKCk7\nCgogICAgICAgIFN5bmNBZGRDYWxsYmFjayBjYWxsYmFjayA9IG5ldyBTeW5j\nQWRkQ2FsbGJhY2soKTsKICAgICAgICBhc3luY0FkZEVudHJ5KGRhdGEsIG9m\nZnNldCwgbGVuZ3RoLCBjYWxsYmFjaywgY291bnRlcik7CiAgICAgICAgY291\nbnRlci5ibG9jaygwKTsKICAgICAgICAKICAgICAgICBpZiAoY291bnRlci5n\nZXRyYygpICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAg\ndGhyb3cgQktFeGNlcHRpb24uY3JlYXRlKGNvdW50ZXIuZ2V0cmMoKSk7CiAg\nICAgICAgfQoKICAgICAgICByZXR1cm4gY2FsbGJhY2suZW50cnlJZDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEFkZCBlbnRyeSBhc3luY2hyb25vdXNseSB0\nbyBhbiBvcGVuIGxlZGdlci4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YQog\nICAgICogICAgICAgICAgYXJyYXkgb2YgYnl0ZXMgdG8gYmUgd3JpdHRlbgog\nICAgICogQHBhcmFtIGNiCiAgICAgKiAgICAgICAgICBvYmplY3QgaW1wbGVt\nZW50aW5nIGNhbGxiYWNraW50ZXJmYWNlCiAgICAgKiBAcGFyYW0gY3R4CiAg\nICAgKiAgICAgICAgICBzb21lIGNvbnRyb2wgb2JqZWN0CiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFzeW5jQWRkRW50cnkoZmluYWwgYnl0ZVtdIGRhdGEs\nIGZpbmFsIEFkZENhbGxiYWNrIGNiLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgYXN5bmNBZGRF\nbnRyeShkYXRhLCAwLCBkYXRhLmxlbmd0aCwgY2IsIGN0eCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBBZGQgZW50cnkgYXN5bmNocm9ub3VzbHkgdG8gYW4g\nb3BlbiBsZWRnZXIsIHVzaW5nIGFuIG9mZnNldCBhbmQgcmFuZ2UuCiAgICAg\nKgogICAgICogQHBhcmFtIGRhdGEKICAgICAqICAgICAgICAgIGFycmF5IG9m\nIGJ5dGVzIHRvIGJlIHdyaXR0ZW4KICAgICAqIEBwYXJhbSBvZmZzZXQKICAg\nICAqICAgICAgICAgIG9mZnNldCBmcm9tIHdoaWNoIHRvIHRha2UgYnl0ZXMg\nZnJvbSBkYXRhCiAgICAgKiBAcGFyYW0gbGVuZ3RoCiAgICAgKiAgICAgICAg\nICBudW1iZXIgb2YgYnl0ZXMgdG8gdGFrZSBmcm9tIGRhdGEKICAgICAqIEBw\nYXJhbSBjYgogICAgICogICAgICAgICAgb2JqZWN0IGltcGxlbWVudGluZyBj\nYWxsYmFja2ludGVyZmFjZQogICAgICogQHBhcmFtIGN0eAogICAgICogICAg\nICAgICAgc29tZSBjb250cm9sIG9iamVjdAogICAgICogQHRocm93cyBBcnJh\neUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gaWYgb2Zmc2V0IG9yIGxlbmd0\naCBpcyBuZWdhdGl2ZSBvcgogICAgICogICAgICAgICAgb2Zmc2V0IGFuZCBs\nZW5ndGggc3VtIHRvIGEgdmFsdWUgaGlnaGVyIHRoYW4gdGhlIGxlbmd0aCBv\nZiBkYXRhLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3luY0FkZEVudHJ5\nKGZpbmFsIGJ5dGVbXSBkYXRhLCBmaW5hbCBpbnQgb2Zmc2V0LCBmaW5hbCBp\nbnQgbGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5h\nbCBBZGRDYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAg\nIFBlbmRpbmdBZGRPcCBvcCA9IG5ldyBQZW5kaW5nQWRkT3AoTGVkZ2VySGFu\nZGxlLnRoaXMsIGNiLCBjdHgpOwogICAgICAgIGRvQXN5bmNBZGRFbnRyeShv\ncCwgZGF0YSwgb2Zmc2V0LCBsZW5ndGgsIGNiLCBjdHgpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWFrZSBhIHJlY292ZXJ5IGFkZCBlbnRyeSByZXF1ZXN0\nLiBSZWNvdmVyeSBhZGRzIGNhbiBhZGQgdG8gYSBsZWRnZXIgZXZlbiBpZgog\nICAgICogaXQgaGFzIGJlZW4gZmVuY2VkLgogICAgICoKICAgICAqIFRoaXMg\naXMgb25seSB2YWxpZCBmb3IgYm9va2llIGFuZCBsZWRnZXIgcmVjb3Zlcnks\nIHdoaWNoIG1heSBuZWVkIHRvIHJlcGxpY2F0ZQogICAgICogZW50cmllcyB0\nbyBhIHF1b3J1bSBvZiBib29raWVzIHRvIGVuc3VyZSBkYXRhIHNhZmV0eS4K\nICAgICAqCiAgICAgKiBOb3JtYWwgY2xpZW50IHNob3VsZCBuZXZlciBjYWxs\nIHRoaXMgbWV0aG9kLgogICAgICovCiAgICB2b2lkIGFzeW5jUmVjb3ZlcnlB\nZGRFbnRyeShmaW5hbCBieXRlW10gZGF0YSwgZmluYWwgaW50IG9mZnNldCwg\nZmluYWwgaW50IGxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZpbmFsIEFkZENhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7\nCiAgICAgICAgUGVuZGluZ0FkZE9wIG9wID0gbmV3IFBlbmRpbmdBZGRPcChM\nZWRnZXJIYW5kbGUudGhpcywgY2IsIGN0eCkuZW5hYmxlUmVjb3ZlcnlBZGQo\nKTsKICAgICAgICBkb0FzeW5jQWRkRW50cnkob3AsIGRhdGEsIG9mZnNldCwg\nbGVuZ3RoLCBjYiwgY3R4KTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZG9B\nc3luY0FkZEVudHJ5KGZpbmFsIFBlbmRpbmdBZGRPcCBvcCwgZmluYWwgYnl0\nZVtdIGRhdGEsIGZpbmFsIGludCBvZmZzZXQsIGZpbmFsIGludCBsZW5ndGgs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIEFkZENh\nbGxiYWNrIGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgaWYgKG9m\nZnNldCA8IDAgfHwgbGVuZ3RoIDwgMAogICAgICAgICAgICAgICAgfHwgKG9m\nZnNldCArIGxlbmd0aCkgPiBkYXRhLmxlbmd0aCkgewogICAgICAgICAgICB0\naHJvdyBuZXcgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKAogICAg\nICAgICAgICAgICAgIkludmFsaWQgdmFsdWVzIGZvciBvZmZzZXQoIitvZmZz\nZXQKICAgICAgICAgICAgICAgICsiKSBvciBsZW5ndGgoIitsZW5ndGgrIiki\nKTsKICAgICAgICB9CiAgICAgICAgdGhyb3R0bGVyLmFjcXVpcmUoKTsKCiAg\nICAgICAgZmluYWwgbG9uZyBlbnRyeUlkOwogICAgICAgIGZpbmFsIGxvbmcg\nY3VycmVudExlbmd0aDsKICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewog\nICAgICAgICAgICAvLyBzeW5jaHJvbml6ZWQgb24gdGhpcyB0byBlbnN1cmUg\ndGhhdAogICAgICAgICAgICAvLyB0aGUgbGVkZ2VyIGlzbid0IGNsb3NlZCBi\nZXR3ZWVuIGNoZWNraW5nIGFuZAogICAgICAgICAgICAvLyB1cGRhdGluZyBs\nYXN0QWRkUHVzaGVkCiAgICAgICAgICAgIGlmIChtZXRhZGF0YS5pc0Nsb3Nl\nZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiQXR0ZW1wdCB0byBh\nZGQgdG8gY2xvc2VkIGxlZGdlcjogIiArIGxlZGdlcklkKTsKICAgICAgICAg\nICAgICAgIGNiLmFkZENvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuTGVkZ2Vy\nQ2xvc2VkRXhjZXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgTGVkZ2VySGFuZGxlLnRoaXMsIElOVkFMSURfRU5UUllfSUQsIGN0eCk7\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGVudHJ5SWQgPSArK2xhc3RBZGRQdXNoZWQ7CiAgICAgICAgICAg\nIGN1cnJlbnRMZW5ndGggPSBhZGRUb0xlbmd0aChsZW5ndGgpOwogICAgICAg\nICAgICBvcC5zZXRFbnRyeUlkKGVudHJ5SWQpOwogICAgICAgICAgICBwZW5k\naW5nQWRkT3BzLmFkZChvcCk7CiAgICAgICAgfQoKICAgICAgICB0cnkgewog\nICAgICAgICAgICBiay5tYWluV29ya2VyUG9vbC5zdWJtaXQobmV3IFNhZmVS\ndW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigpIHsKICAgICAgICAgICAg\nICAgICAgICBDaGFubmVsQnVmZmVyIHRvU2VuZCA9IG1hY01hbmFnZXIuY29t\ncHV0ZURpZ2VzdEFuZFBhY2thZ2VGb3JTZW5kaW5nKAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVudHJ5SWQsIGxh\nc3RBZGRDb25maXJtZWQsIGN1cnJlbnRMZW5ndGgsIGRhdGEsIG9mZnNldCwg\nbGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICBvcC5pbml0aWF0ZSh0b1Nl\nbmQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAg\nICB9IGNhdGNoIChSdW50aW1lRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nY2IuYWRkQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4\nY2VwdGlvbiwKICAgICAgICAgICAgICAgICAgICBMZWRnZXJIYW5kbGUudGhp\ncywgSU5WQUxJRF9FTlRSWV9JRCwgY3R4KTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBPYnRhaW5zIGFzeW5jaHJvbm91c2x5IHRoZSBsYXN0\nIGNvbmZpcm1lZCB3cml0ZSBmcm9tIGEgcXVvcnVtIG9mIGJvb2tpZXMuIFRo\naXMgCiAgICAgKiBjYWxsIG9idGFpbnMgdGhlIHRoZSBsYXN0IGFkZCBjb25m\naXJtZWQgZWFjaCBib29raWUgaGFzIHJlY2VpdmVkIGZvciB0aGlzIGxlZGdl\ncgogICAgICogYW5kIHJldHVybnMgdGhlIG1heGltdW0uIElmIHRoZSBsZWRn\nZXIgaGFzIGJlZW4gY2xvc2VkLCB0aGUgdmFsdWUgcmV0dXJuZWQgYnkgdGhp\ncwogICAgICogY2FsbCBtYXkgbm90IGNvcnJlc3BvbmQgdG8gdGhlIGlkIG9m\nIHRoZSBsYXN0IGVudHJ5IG9mIHRoZSBsZWRnZXIsIHNpbmNlIGl0IHJlYWRz\nCiAgICAgKiB0aGUgaGludCBvZiBib29raWVzLiBDb25zZXF1ZW50bHksIGlu\nIHRoZSBjYXNlIHRoZSBsZWRnZXIgaGFzIGJlZW4gY2xvc2VkLCBpdCBtYXkg\nCiAgICAgKiByZXR1cm4gYSBkaWZmZXJlbnQgdmFsdWUgdGhhbiBnZXRMYXN0\nQWRkQ29uZmlybWVkLCB3aGljaCByZXR1cm5zIHRoZSBsb2NhbCB2YWx1ZSAK\nICAgICAqIG9mIHRoZSBsZWRnZXIgaGFuZGxlLgogICAgICogCiAgICAgKiBA\nc2VlICNnZXRMYXN0QWRkQ29uZmlybWVkKCkKICAgICAqCiAgICAgKiBAcGFy\nYW0gY2IKICAgICAqIEBwYXJhbSBjdHgKICAgICAqLwoKICAgIHB1YmxpYyB2\nb2lkIGFzeW5jUmVhZExhc3RDb25maXJtZWQoZmluYWwgUmVhZExhc3RDb25m\naXJtZWRDYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAg\nIFJlYWRMYXN0Q29uZmlybWVkT3AuTGFzdENvbmZpcm1lZERhdGFDYWxsYmFj\nayBpbm5lcmNiID0gbmV3IFJlYWRMYXN0Q29uZmlybWVkT3AuTGFzdENvbmZp\ncm1lZERhdGFDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJt\nZWREYXRhQ29tcGxldGUoaW50IHJjLCBEaWdlc3RNYW5hZ2VyLlJlY292ZXJ5\nRGF0YSBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbGFzdEFkZENvbmZpcm1lZCA9IE1hdGgubWF4KGxhc3RBZGRDb25maXJtZWQs\nIGRhdGEubGFzdEFkZENvbmZpcm1lZCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGxhc3RBZGRQdXNoZWQgPSBNYXRoLm1heChsYXN0QWRkUHVzaGVkLCBk\nYXRhLmxhc3RBZGRDb25maXJtZWQpOwogICAgICAgICAgICAgICAgICAgICAg\nICBsZW5ndGggPSBNYXRoLm1heChsZW5ndGgsIGRhdGEubGVuZ3RoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgY2IucmVhZExhc3RDb25maXJtZWRDb21w\nbGV0ZShyYywgZGF0YS5sYXN0QWRkQ29uZmlybWVkLCBjdHgpOwogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLnJlYWRMYXN0Q29uZmlybWVkQ29tcGxldGUocmMsIElOVkFMSURfRU5U\nUllfSUQsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIG5ldyBSZWFkTGFzdENv\nbmZpcm1lZE9wKHRoaXMsIGlubmVyY2IpLmluaXRpYXRlKCk7CiAgICB9CgoK\nICAgIC8qKgogICAgICogQ29udGV4dCBvYmplY3RzIGZvciBzeW5jaHJvbm91\ncyBjYWxsIHRvIHJlYWQgbGFzdCBjb25maXJtZWQuCiAgICAgKi8KICAgIHN0\nYXRpYyBjbGFzcyBMYXN0Q29uZmlybWVkQ3R4IHsKICAgICAgICBmaW5hbCBz\ndGF0aWMgbG9uZyBFTlRSWV9JRF9QRU5ESU5HID0gLTEwOwogICAgICAgIGxv\nbmcgcmVzcG9uc2U7CiAgICAgICAgaW50IHJjOwoKICAgICAgICBMYXN0Q29u\nZmlybWVkQ3R4KCkgewogICAgICAgICAgICB0aGlzLnJlc3BvbnNlID0gRU5U\nUllfSURfUEVORElORzsKICAgICAgICB9CgogICAgICAgIHZvaWQgc2V0TGFz\ndENvbmZpcm1lZChsb25nIGxhc3RDb25maXJtZWQpIHsKICAgICAgICAgICAg\ndGhpcy5yZXNwb25zZSA9IGxhc3RDb25maXJtZWQ7CiAgICAgICAgfQoKICAg\nICAgICBsb25nIGdldGxhc3RDb25maXJtZWQoKSB7CiAgICAgICAgICAgIHJl\ndHVybiB0aGlzLnJlc3BvbnNlOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBz\nZXRSQyhpbnQgcmMpIHsKICAgICAgICAgICAgdGhpcy5yYyA9IHJjOwogICAg\nICAgIH0KCiAgICAgICAgaW50IGdldFJDKCkgewogICAgICAgICAgICByZXR1\ncm4gdGhpcy5yYzsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gcmVhZHko\nKSB7CiAgICAgICAgICAgIHJldHVybiAodGhpcy5yZXNwb25zZSAhPSBFTlRS\nWV9JRF9QRU5ESU5HKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBPYnRhaW5zIHN5bmNocm9ub3VzbHkgdGhlIGxhc3QgY29uZmlybWVkIHdy\naXRlIGZyb20gYSBxdW9ydW0gb2YgYm9va2llcy4gVGhpcyBjYWxsCiAgICAg\nKiBvYnRhaW5zIHRoZSB0aGUgbGFzdCBhZGQgY29uZmlybWVkIGVhY2ggYm9v\na2llIGhhcyByZWNlaXZlZCBmb3IgdGhpcyBsZWRnZXIKICAgICAqIGFuZCBy\nZXR1cm5zIHRoZSBtYXhpbXVtLiBJZiB0aGUgbGVkZ2VyIGhhcyBiZWVuIGNs\nb3NlZCwgdGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoaXMKICAgICAqIGNhbGwg\nbWF5IG5vdCBjb3JyZXNwb25kIHRvIHRoZSBpZCBvZiB0aGUgbGFzdCBlbnRy\neSBvZiB0aGUgbGVkZ2VyLCBzaW5jZSBpdCByZWFkcwogICAgICogdGhlIGhp\nbnQgb2YgYm9va2llcy4gQ29uc2VxdWVudGx5LCBpbiB0aGUgY2FzZSB0aGUg\nbGVkZ2VyIGhhcyBiZWVuIGNsb3NlZCwgaXQgbWF5IAogICAgICogcmV0dXJu\nIGEgZGlmZmVyZW50IHZhbHVlIHRoYW4gZ2V0TGFzdEFkZENvbmZpcm1lZCwg\nd2hpY2ggcmV0dXJucyB0aGUgbG9jYWwgdmFsdWUgCiAgICAgKiBvZiB0aGUg\nbGVkZ2VyIGhhbmRsZS4KICAgICAqIAogICAgICogQHNlZSAjZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpCiAgICAgKiAKICAgICAqIEByZXR1cm4gVGhlIGVudHJ5\nIGlkIG9mIHRoZSBsYXN0IGNvbmZpcm1lZCB3cml0ZSBvciB7QGxpbmsgI0lO\nVkFMSURfRU5UUllfSUQgSU5WQUxJRF9FTlRSWV9JRH0KICAgICAqICAgICAg\nICAgaWYgbm8gZW50cnkgaGFzIGJlZW4gY29uZmlybWVkCiAgICAgKiBAdGhy\nb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIEJLRXhj\nZXB0aW9uCiAgICAgKi8KICAgIAogICAgcHVibGljIGxvbmcgcmVhZExhc3RD\nb25maXJtZWQoKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBMYXN0Q29uZmlybWVkQ3R4\nIGN0eCA9IG5ldyBMYXN0Q29uZmlybWVkQ3R4KCk7CiAgICAgICAgYXN5bmNS\nZWFkTGFzdENvbmZpcm1lZChuZXcgU3luY1JlYWRMYXN0Q29uZmlybWVkQ2Fs\nbGJhY2soKSwgY3R4KTsKICAgICAgICBzeW5jaHJvbml6ZWQoY3R4KSB7CiAg\nICAgICAgICAgIHdoaWxlKCFjdHgucmVhZHkoKSkgewogICAgICAgICAgICAg\nICAgY3R4LndhaXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgaWYoY3R4LmdldFJDKCkgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgdGhy\nb3cgQktFeGNlcHRpb24uY3JlYXRlKGN0eC5nZXRSQygpKTsKICAgICAgICBy\nZXR1cm4gY3R4LmdldGxhc3RDb25maXJtZWQoKTsKICAgIH0KCiAgICAvLyBj\nbG9zZSB0aGUgbGVkZ2VyIGFuZCBzZW5kIGZhaWxzIHRvIGFsbCB0aGUgYWRk\ncyBpbiB0aGUgcGlwZWxpbmUKICAgIHZvaWQgaGFuZGxlVW5yZWNvdmVyYWJs\nZUVycm9yRHVyaW5nQWRkKGludCByYykgewogICAgICAgIGlmIChtZXRhZGF0\nYS5pc0luUmVjb3ZlcnkoKSkgewogICAgICAgICAgICAvLyB3ZSBzaG91bGQg\nbm90IGNsb3NlIGxlZGdlciBpZiBsZWRnZXIgaXMgcmVjb3ZlcnkgbW9kZQog\nICAgICAgICAgICAvLyBvdGhlcndpc2Ugd2UgbWF5IGxvc2UgZW50cnkuCiAg\nICAgICAgICAgIGVycm9yT3V0UGVuZGluZ0FkZHMocmMpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQogICAgICAgIExPRy5lcnJvcigiQ2xvc2lu\nZyBsZWRnZXIge30gZHVlIHRvIGVycm9yIHt9IiwgbGVkZ2VySWQsIHJjKTsK\nICAgICAgICBhc3luY0Nsb3NlSW50ZXJuYWwoTm9vcENsb3NlQ2FsbGJhY2su\naW5zdGFuY2UsIG51bGwsIHJjKTsKICAgIH0KCiAgICB2b2lkIGVycm9yT3V0\nUGVuZGluZ0FkZHMoaW50IHJjKSB7CiAgICAgICAgUGVuZGluZ0FkZE9wIHBl\nbmRpbmdBZGRPcDsKICAgICAgICB3aGlsZSAoKHBlbmRpbmdBZGRPcCA9IHBl\nbmRpbmdBZGRPcHMucG9sbCgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHBl\nbmRpbmdBZGRPcC5zdWJtaXRDYWxsYmFjayhyYyk7CiAgICAgICAgfQogICAg\nfQoKICAgIHZvaWQgc2VuZEFkZFN1Y2Nlc3NDYWxsYmFja3MoKSB7CiAgICAg\nICAgLy8gU3RhcnQgZnJvbSB0aGUgaGVhZCBvZiB0aGUgcXVldWUgYW5kIHBy\nb2NlZWQgd2hpbGUgdGhlcmUgYXJlCiAgICAgICAgLy8gZW50cmllcyB0aGF0\nIGhhdmUgaGFkIGFsbCB0aGVpciByZXNwb25zZXMgY29tZSBiYWNrCiAgICAg\nICAgUGVuZGluZ0FkZE9wIHBlbmRpbmdBZGRPcDsKICAgICAgICB3aGlsZSAo\nKHBlbmRpbmdBZGRPcCA9IHBlbmRpbmdBZGRPcHMucGVlaygpKSAhPSBudWxs\nCiAgICAgICAgICAgICAgICYmIGJsb2NrQWRkQ29tcGxldGlvbnMuZ2V0KCkg\nPT0gMCkgewogICAgICAgICAgICBpZiAoIXBlbmRpbmdBZGRPcC5jb21wbGV0\nZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBwZW5kaW5nQWRkT3BzLnJlbW92ZSgpOwogICAgICAgICAg\nICBsYXN0QWRkQ29uZmlybWVkID0gcGVuZGluZ0FkZE9wLmVudHJ5SWQ7CiAg\nICAgICAgICAgIHBlbmRpbmdBZGRPcC5zdWJtaXRDYWxsYmFjayhCS0V4Y2Vw\ndGlvbi5Db2RlLk9LKTsKICAgICAgICB9CgogICAgfQoKICAgIEFycmF5TGlz\ndDxJbmV0U29ja2V0QWRkcmVzcz4gcmVwbGFjZUJvb2tpZUluTWV0YWRhdGEo\nZmluYWwgSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgZmluYWwgaW50IGJvb2tp\nZUluZGV4KQogICAgICAgICAgICB0aHJvd3MgQktFeGNlcHRpb24uQktOb3RF\nbm91Z2hCb29raWVzRXhjZXB0aW9uIHsKICAgICAgICBJbmV0U29ja2V0QWRk\ncmVzcyBuZXdCb29raWU7CiAgICAgICAgTE9HLmluZm8oIkhhbmRsaW5nIGZh\naWx1cmUgb2YgYm9va2llOiB7fSBpbmRleDoge30iLCBhZGRyLCBib29raWVJ\nbmRleCk7CiAgICAgICAgZmluYWwgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRy\nZXNzPiBuZXdFbnNlbWJsZSA9IG5ldyBBcnJheUxpc3Q8SW5ldFNvY2tldEFk\nZHJlc3M+KCk7CiAgICAgICAgZmluYWwgbG9uZyBuZXdFbnNlbWJsZVN0YXJ0\nRW50cnkgPSBsYXN0QWRkQ29uZmlybWVkICsgMTsKCiAgICAgICAgLy8gYXZv\naWQgcGFyYWxsZWwgZW5zZW1ibGUgY2hhbmdlcyB0byBzYW1lIGVuc2VtYmxl\nLgogICAgICAgIHN5bmNocm9uaXplZCAobWV0YWRhdGEpIHsKICAgICAgICAg\nICAgbmV3Qm9va2llID0gYmsuYm9va2llV2F0Y2hlci5nZXRBZGRpdGlvbmFs\nQm9va2llKG1ldGFkYXRhLmN1cnJlbnRFbnNlbWJsZSk7CgogICAgICAgICAg\nICBuZXdFbnNlbWJsZS5hZGRBbGwobWV0YWRhdGEuY3VycmVudEVuc2VtYmxl\nKTsKICAgICAgICAgICAgbmV3RW5zZW1ibGUuc2V0KGJvb2tpZUluZGV4LCBu\nZXdCb29raWUpOwoKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxl\nZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkNoYW5naW5nIGVu\nc2VtYmxlIGZyb206ICIgKyBtZXRhZGF0YS5jdXJyZW50RW5zZW1ibGUKICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiIHRvOiAiICsgbmV3RW5zZW1ibGUg\nKyAiIGZvciBsZWRnZXI6ICIgKyBsZWRnZXJJZAogICAgICAgICAgICAgICAg\nICAgICAgICArICIgc3RhcnRpbmcgYXQgZW50cnk6ICIgKyAobGFzdEFkZENv\nbmZpcm1lZCArIDEpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbWV0\nYWRhdGEuYWRkRW5zZW1ibGUobmV3RW5zZW1ibGVTdGFydEVudHJ5LCBuZXdF\nbnNlbWJsZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXdFbnNlbWJs\nZTsKICAgIH0KCiAgICB2b2lkIGhhbmRsZUJvb2tpZUZhaWx1cmUoZmluYWwg\nSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgZmluYWwgaW50IGJvb2tpZUluZGV4\nKSB7CiAgICAgICAgYmxvY2tBZGRDb21wbGV0aW9ucy5pbmNyZW1lbnRBbmRH\nZXQoKTsKCiAgICAgICAgc3luY2hyb25pemVkIChtZXRhZGF0YSkgewogICAg\nICAgICAgICBpZiAoIW1ldGFkYXRhLmN1cnJlbnRFbnNlbWJsZS5nZXQoYm9v\na2llSW5kZXgpLmVxdWFscyhhZGRyKSkgewogICAgICAgICAgICAgICAgLy8g\nZW5zZW1ibGUgaGFzIGFscmVhZHkgY2hhbmdlZCwgZmFpbHVyZSBvZiB0aGlz\nIGFkZHIgaXMgaW1tYXRlcmlhbAogICAgICAgICAgICAgICAgTE9HLndhcm4o\nIldyaXRlIGRpZCBub3Qgc3VjY2VlZCB0byB7fSwgYm9va2llSW5kZXgge30s\nIGJ1dCB3ZSBoYXZlIGFscmVhZHkgZml4ZWQgaXQuIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgIGFkZHIsIGJvb2tpZUluZGV4KTsKICAgICAgICAgICAg\nICAgIGJsb2NrQWRkQ29tcGxldGlvbnMuZGVjcmVtZW50QW5kR2V0KCk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBBcnJheUxpc3Q8SW5ldFNvY2tl\ndEFkZHJlc3M+IG5ld0Vuc2VtYmxlID0gcmVwbGFjZUJvb2tpZUluTWV0YWRh\ndGEoYWRkciwgYm9va2llSW5kZXgpOwoKICAgICAgICAgICAgICAgIEVuc2Vt\nYmxlSW5mbyBlbnNlbWJsZUluZm8gPSBuZXcgRW5zZW1ibGVJbmZvKG5ld0Vu\nc2VtYmxlLCBib29raWVJbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHIpOwog\nICAgICAgICAgICAgICAgd3JpdGVMZWRnZXJDb25maWcobmV3IENoYW5nZUVu\nc2VtYmxlQ2IoZW5zZW1ibGVJbmZvKSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCBnZXQgYWRk\naXRpb25hbCBib29raWUgdG8gIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICsgInJlbWFrZSBlbnNlbWJsZSwgY2xvc2luZyBsZWRnZXI6ICIgKyBsZWRn\nZXJJZCk7CiAgICAgICAgICAgICAgICBoYW5kbGVVbnJlY292ZXJhYmxlRXJy\nb3JEdXJpbmdBZGQoZS5nZXRDb2RlKCkpOwogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8vIENv\nbnRhaW5zIG5ld2x5IHJlZm9ybWVkIGVuc2VtYmxlLCBib29raWVJbmRleCwg\nZmFpbGVkQm9va2llQWRkcmVzcwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nY2xhc3MgRW5zZW1ibGVJbmZvIHsKICAgICAgICBwcml2YXRlIGZpbmFsIEFy\ncmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gbmV3RW5zZW1ibGU7CiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBpbnQgYm9va2llSW5kZXg7CiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBJbmV0U29ja2V0QWRkcmVzcyBhZGRyOwoKICAgICAgICBw\ndWJsaWMgRW5zZW1ibGVJbmZvKEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVz\ncz4gbmV3RW5zZW1ibGUsCiAgICAgICAgICAgICAgICBpbnQgYm9va2llSW5k\nZXgsIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIpIHsKICAgICAgICAgICAgdGhp\ncy5uZXdFbnNlbWJsZSA9IG5ld0Vuc2VtYmxlOwogICAgICAgICAgICB0aGlz\nLmJvb2tpZUluZGV4ID0gYm9va2llSW5kZXg7CiAgICAgICAgICAgIHRoaXMu\nYWRkciA9IGFkZHI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nQ2FsbGJhY2sgd2hpY2ggaXMgdXBkYXRpbmcgdGhlIGxlZGdlck1ldGFkYXRh\nIGluIHprIHdpdGggdGhlIG5ld2x5CiAgICAgKiByZWZvcm1lZCBlbnNlbWJs\nZS4gT24gTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uLCB3aWxsIHJlcmVhZCBs\nYXRlc3QKICAgICAqIGxlZGdlck1ldGFkYXRhIGFuZCBhY3QgdXBvbi4KICAg\nICAqLwogICAgcHJpdmF0ZSBmaW5hbCBjbGFzcyBDaGFuZ2VFbnNlbWJsZUNi\nIGV4dGVuZHMgT3JkZXJlZFNhZmVHZW5lcmljQ2FsbGJhY2s8Vm9pZD4gewog\nICAgICAgIHByaXZhdGUgZmluYWwgRW5zZW1ibGVJbmZvIGVuc2VtYmxlSW5m\nbzsKCiAgICAgICAgQ2hhbmdlRW5zZW1ibGVDYihFbnNlbWJsZUluZm8gZW5z\nZW1ibGVJbmZvKSB7CiAgICAgICAgICAgIHN1cGVyKGJrLm1haW5Xb3JrZXJQ\nb29sLCBsZWRnZXJJZCk7CiAgICAgICAgICAgIHRoaXMuZW5zZW1ibGVJbmZv\nID0gZW5zZW1ibGVJbmZvOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZXJhdGlvbkNvbXBsZXRlKGZp\nbmFsIGludCByYywgVm9pZCByZXN1bHQpIHsKICAgICAgICAgICAgaWYgKHJj\nID09IEJLRXhjZXB0aW9uLkNvZGUuTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9u\nKSB7CiAgICAgICAgICAgICAgICByZXJlYWRNZXRhZGF0YShuZXcgUmVSZWFk\nTGVkZ2VyTWV0YWRhdGFDYihyYywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZW5zZW1ibGVJbmZvKSk7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSBpZiAocmMgIT0gQktFeGNl\ncHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJD\nb3VsZCBub3QgcGVyc2lzdCBsZWRnZXIgbWV0YWRhdGEgd2hpbGUgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICsgImNoYW5naW5nIGVuc2VtYmxlIHRv\nOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyBlbnNlbWJsZUluZm8u\nbmV3RW5zZW1ibGUKICAgICAgICAgICAgICAgICAgICAgICAgICArICIgLCBj\nbG9zaW5nIGxlZGdlciIpOwogICAgICAgICAgICAgICAgaGFuZGxlVW5yZWNv\ndmVyYWJsZUVycm9yRHVyaW5nQWRkKHJjKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBibG9ja0FkZENvbXBs\nZXRpb25zLmRlY3JlbWVudEFuZEdldCgpOwoKICAgICAgICAgICAgLy8gdGhl\nIGZhaWxlZCBib29raWUgaGFzIGJlZW4gcmVwbGFjZWQKICAgICAgICAgICAg\ndW5zZXRTdWNjZXNzQW5kU2VuZFdyaXRlUmVxdWVzdChlbnNlbWJsZUluZm8u\nYm9va2llSW5kZXgpOwogICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAg\nKiBDYWxsYmFjayB3aGljaCBpcyByZWFkaW5nIHRoZSBsZWRnZXJNZXRhZGF0\nYSBwcmVzZW50IGluIHprLiBUaGlzIHdpbGwgdHJ5CiAgICAgKiB0byByZXNv\nbHZlIHRoZSB2ZXJzaW9uIGNvbmZsaWN0cy4KICAgICAqLwogICAgcHJpdmF0\nZSBmaW5hbCBjbGFzcyBSZVJlYWRMZWRnZXJNZXRhZGF0YUNiIGV4dGVuZHMg\nT3JkZXJlZFNhZmVHZW5lcmljQ2FsbGJhY2s8TGVkZ2VyTWV0YWRhdGE+IHsK\nICAgICAgICBwcml2YXRlIGZpbmFsIGludCByYzsKICAgICAgICBwcml2YXRl\nIGZpbmFsIEVuc2VtYmxlSW5mbyBlbnNlbWJsZUluZm87CgogICAgICAgIFJl\nUmVhZExlZGdlck1ldGFkYXRhQ2IoaW50IHJjLCBFbnNlbWJsZUluZm8gZW5z\nZW1ibGVJbmZvKSB7CiAgICAgICAgICAgIHN1cGVyKGJrLm1haW5Xb3JrZXJQ\nb29sLCBsZWRnZXJJZCk7CiAgICAgICAgICAgIHRoaXMucmMgPSByYzsKICAg\nICAgICAgICAgdGhpcy5lbnNlbWJsZUluZm8gPSBlbnNlbWJsZUluZm87CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9p\nZCBzYWZlT3BlcmF0aW9uQ29tcGxldGUoaW50IG5ld3JjLCBMZWRnZXJNZXRh\nZGF0YSBuZXdNZXRhKSB7CiAgICAgICAgICAgIGlmIChuZXdyYyAhPSBCS0V4\nY2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkVycm9yIHJlYWRpbmcgbmV3IG1ldGFkYXRhIGZyb20gbGVkZ2VyICIKICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiYWZ0ZXIgY2hhbmdpbmcgZW5zZW1i\nbGUsIGNvZGU9IiArIG5ld3JjKTsKICAgICAgICAgICAgICAgIGhhbmRsZVVu\ncmVjb3ZlcmFibGVFcnJvckR1cmluZ0FkZChyYyk7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoIXJlc29sdmVDb25mbGljdChu\nZXdNZXRhKSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291\nbGQgbm90IHJlc29sdmUgbGVkZ2VyIG1ldGFkYXRhIGNvbmZsaWN0ICIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgIndoaWxlIGNoYW5naW5nIGVu\nc2VtYmxlIHRvOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGVu\nc2VtYmxlSW5mby5uZXdFbnNlbWJsZQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiLCBvbGQgbWV0YSBkYXRhIGlzIFxuIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKyBuZXcgU3RyaW5nKG1ldGFkYXRhLnNlcmlhbGl6\nZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiXG4sIG5ldyBt\nZXRhIGRhdGEgaXMgXG4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nIG5ldyBTdHJpbmcobmV3TWV0YS5zZXJpYWxpemUoKSkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIlxuICxjbG9zaW5nIGxlZGdlciIpOwogICAg\nICAgICAgICAgICAgICAgIGhhbmRsZVVucmVjb3ZlcmFibGVFcnJvckR1cmlu\nZ0FkZChyYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFNwZWNpZmljIHJlc29s\ndmUgY29uZmxpY3RzIGhhcHBlbmVkIHdoZW4gbXVsdGlwbGUgYm9va2llcyBm\nYWlsdXJlcyBpbiBzYW1lIGVuc2VtYmxlLgogICAgICAgICAqIDxwPgogICAg\nICAgICAqIFJlc29sdmluZyB0aGUgdmVyc2lvbiBjb25mbGljdHMgYmV0d2Vl\nbiBsb2NhbCBsZWRnZXJNZXRhZGF0YSBhbmQgemsKICAgICAgICAgKiBsZWRn\nZXJNZXRhZGF0YS4gVGhpcyB3aWxsIGRvIHRoZSBmb2xsb3dpbmc6CiAgICAg\nICAgICogPHVsPgogICAgICAgICAqIDxsaT4KICAgICAgICAgKiBjaGVjayB3\naGV0aGVyIGxlZGdlck1ldGFkYXRhIHN0YXRlIG1hdGNoZXMgb2YgbG9jYWwg\nYW5kIHprPC9saT4KICAgICAgICAgKiA8bGk+CiAgICAgICAgICogaWYgdGhl\nIHprIGxlZGdlck1ldGFkYXRhIHN0aWxsIGNvbnRhaW5zIHRoZSBmYWlsZWQg\nYm9va2llLCB0aGVuCiAgICAgICAgICogdXBkYXRlIHpvb2tlZXBlciB3aXRo\nIHRoZSBuZXdCb29raWUgb3RoZXJ3aXNlIHNlbmQgd3JpdGUgcmVxdWVzdDwv\nbGk+CiAgICAgICAgICogPC91bD4KICAgICAgICAgKiA8L3A+CiAgICAgICAg\nICovCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIHJlc29sdmVDb25mbGljdChM\nZWRnZXJNZXRhZGF0YSBuZXdNZXRhKSB7CiAgICAgICAgICAgIC8vIG1ha2Ug\nc3VyZSB0aGUgbGVkZ2VyIGlzbid0IGNsb3NlZCBieSBvdGhlciBvbmVzLgog\nICAgICAgICAgICBpZiAobWV0YWRhdGEuZ2V0U3RhdGUoKSAhPSBuZXdNZXRh\nLmdldFN0YXRlKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIGNoZWNr\nIG51bWJlciBvZiBlbnNlbWJsZXMgc2luY2UgdGhlcmUgYXJlIHR3byBraW5k\ncyBvZiBtZXRhZGF0YSBjb25mbGljdHM6CiAgICAgICAgICAgIC8vIC0gQ2Fz\nZSAxOiBNdWx0aXBsZSBib29raWVzIGludm9sdmVkIGluIGVuc2VtYmxlIGNo\nYW5nZS4KICAgICAgICAgICAgLy8gICAgICAgICAgIE51bWJlciBvZiBlbnNl\nbWJsZXMgc2hvdWxkIGJlIHNhbWUgaW4gdGhpcyBjYXNlLgogICAgICAgICAg\nICAvLyAtIENhc2UgMjogUmVjb3ZlcnkgKEF1dG8vTWFudWFsbHkpIHJlcGxh\nY2VkIGVuc2VtYmxlIGFuZCBlbnNlbWJsZSBjaGFuZ2VkLgogICAgICAgICAg\nICAvLyAgICAgICAgICAgVGhlIG1ldGFkYXRhIGNoYW5nZWQgZHVlIHRvIGVu\nc2VtYmxlIGNoYW5nZSB3b3VsZCBoYXZlIG9uZSBtb3JlIGVuc2VtYmxlCiAg\nICAgICAgICAgIC8vICAgICAgICAgICB0aGFuIHRoZSBtZXRhZGF0YSBjaGFu\nZ2VkIGJ5IHJlY292ZXJ5LgogICAgICAgICAgICBpbnQgZGlmZiA9IG5ld01l\ndGEuZ2V0RW5zZW1ibGVzKCkuc2l6ZSgpIC0gbWV0YWRhdGEuZ2V0RW5zZW1i\nbGVzKCkuc2l6ZSgpOwogICAgICAgICAgICBpZiAoMCAhPSBkaWZmKSB7CiAg\nICAgICAgICAgICAgICBpZiAoLTEgPT0gZGlmZikgewogICAgICAgICAgICAg\nICAgICAgIC8vIENhc2UgMTogbWV0YWRhdGEgaXMgY2hhbmdlZCBieSBvdGhl\nciBvbmVzIChlLmcuIFJlY292ZXJ5KQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB1cGRhdGVNZXRhZGF0YUlmUG9zc2libGUobmV3TWV0YSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIENh\nc2UgMjoKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gSWYgdGhlIGZh\naWxlZCB0aGUgYm9va2llIGlzIHN0aWxsIGV4aXN0ZWQgaW4gdGhlIG1ldGFk\nYXRhIChpbiB6b29rZWVwZXIpLCBpdCBtZWFucyB0aGF0CiAgICAgICAgICAg\nIC8vIHRoZSBlbnNlbWJsZSBjaGFuZ2Ugb2YgdGhlIGZhaWxlZCBib29raWUg\naXMgZmFpbGVkIGR1ZSB0byBtZXRhZGF0YSBjb25mbGljdHMuIHNvIHRyeSB0\nbwogICAgICAgICAgICAvLyB1cGRhdGUgdGhlIGVuc2VtYmxlIGNoYW5nZSBt\nZXRhZGF0YSBhZ2Fpbi4gT3RoZXJ3aXNlLCBpdCBtZWFucyB0aGF0IHRoZSBl\nbnNlbWJsZSBjaGFuZ2UKICAgICAgICAgICAgLy8gaXMgYWxyZWFkeSBzdWNj\nZWVkLCB1bnNldCB0aGUgc3VjY2VzcyBhbmQgcmUtYWRkaW5nIGVudHJpZXMu\nCiAgICAgICAgICAgIGlmIChuZXdNZXRhLmN1cnJlbnRFbnNlbWJsZS5nZXQo\nZW5zZW1ibGVJbmZvLmJvb2tpZUluZGV4KS5lcXVhbHMoCiAgICAgICAgICAg\nICAgICAgICAgZW5zZW1ibGVJbmZvLmFkZHIpKSB7CiAgICAgICAgICAgICAg\nICAvLyBJZiB0aGUgaW4tbWVtb3J5IGRhdGEgZG9lc24ndCBjb250YWlucyB0\naGUgZmFpbGVkIGJvb2tpZSwgaXQgbWVhbnMgdGhlIGVuc2VtYmxlIGNoYW5n\nZQogICAgICAgICAgICAgICAgLy8gZGlkbid0IGZpbmlzaCwgc28gdHJ5IHRv\nIHJlc29sdmUgY29uZmxpY3RzIHdpdGggdGhlIG1ldGFkYXRhIHJlYWQgZnJv\nbSB6b29rZWVwZXIgYW5kCiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgZW5z\nZW1ibGUgY2hhbmdlZCBtZXRhZGF0YSBhZ2Fpbi4KICAgICAgICAgICAgICAg\nIGlmICghbWV0YWRhdGEuY3VycmVudEVuc2VtYmxlLmdldChlbnNlbWJsZUlu\nZm8uYm9va2llSW5kZXgpCiAgICAgICAgICAgICAgICAgICAgICAgIC5lcXVh\nbHMoZW5zZW1ibGVJbmZvLmFkZHIpKSB7CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHVwZGF0ZU1ldGFkYXRhSWZQb3NzaWJsZShuZXdNZXRhKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIC8vIHRoZSBmYWlsZWQgYm9va2llIGhhcyBiZWVuIHJlcGxhY2Vk\nCiAgICAgICAgICAgICAgICBibG9ja0FkZENvbXBsZXRpb25zLmRlY3JlbWVu\ndEFuZEdldCgpOwogICAgICAgICAgICAgICAgdW5zZXRTdWNjZXNzQW5kU2Vu\nZFdyaXRlUmVxdWVzdChlbnNlbWJsZUluZm8uYm9va2llSW5kZXgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIHVwZGF0ZU1ldGFkYXRhSWZQb3Nz\naWJsZShMZWRnZXJNZXRhZGF0YSBuZXdNZXRhKSB7CiAgICAgICAgICAgIC8v\nIGlmIHRoZSBsb2NhbCBtZXRhZGF0YSBpcyBuZXdlciB0aGFuIHpvb2tlZXBl\nciBtZXRhZGF0YSwgaXQgbWVhbnMgdGhhdCBtZXRhZGF0YSBpcyB1cGRhdGVk\nCiAgICAgICAgICAgIC8vIGFnYWluIHdoZW4gaXQgd2FzIHRyeWluZyByZS1y\nZWFkaW5nIHRoZSBtZXRhdGFkYSwgcmUta2ljayB0aGUgcmVyZWFkIGFnYWlu\nCiAgICAgICAgICAgIGlmIChtZXRhZGF0YS5pc05ld2VyVGhhbihuZXdNZXRh\nKSkgewogICAgICAgICAgICAgICAgcmVyZWFkTWV0YWRhdGEodGhpcyk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIG1ldGFkYXRhIGRvZXNuJ3QgY2hh\nbmdlZCBieSBvdGhlciBvbmVzLgogICAgICAgICAgICBpZiAobWV0YWRhdGEu\naXNDb25mbGljdFdpdGgobmV3TWV0YSkpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBMT0cuaW5m\nbygiUmVzb2x2ZSBsZWRnZXIgbWV0YWRhdGEgY29uZmxpY3Qgd2hpbGUgY2hh\nbmdpbmcgZW5zZW1ibGUgdG86IHt9LCIKICAgICAgICAgICAgICAgICAgICAr\nICIgb2xkIG1ldGEgZGF0YSBpcyBcbiB7fSBcbiwgbmV3IG1ldGEgZGF0YSBp\ncyBcbiB7fS4iLCBuZXcgT2JqZWN0W10gewogICAgICAgICAgICAgICAgICAg\nIGVuc2VtYmxlSW5mby5uZXdFbnNlbWJsZSwgbWV0YWRhdGEsIG5ld01ldGEg\nfSk7CiAgICAgICAgICAgIC8vIHVwZGF0ZSB6bm9kZSB2ZXJzaW9uCiAgICAg\nICAgICAgIG1ldGFkYXRhLnNldFZlcnNpb24obmV3TWV0YS5nZXRWZXJzaW9u\nKCkpOwogICAgICAgICAgICAvLyBtZXJnZSBlbnNlbWJsZSBpbmZvcyBmcm9t\nIG5ldyBtZXRhIGV4Y2VwdCBsYXN0IGVuc2VtYmxlCiAgICAgICAgICAgIC8v\nIHNpbmNlIHRoZXkgbWlnaHQgYmUgbW9kaWZpZWQgYnkgcmVjb3ZlcnkgdG9v\nbC4KICAgICAgICAgICAgbWV0YWRhdGEubWVyZ2VFbnNlbWJsZXMobmV3TWV0\nYS5nZXRFbnNlbWJsZXMoKSk7CiAgICAgICAgICAgIHdyaXRlTGVkZ2VyQ29u\nZmlnKG5ldyBDaGFuZ2VFbnNlbWJsZUNiKGVuc2VtYmxlSW5mbykpOwogICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgfTsKCiAgICB2\nb2lkIHVuc2V0U3VjY2Vzc0FuZFNlbmRXcml0ZVJlcXVlc3QoZmluYWwgaW50\nIGJvb2tpZUluZGV4KSB7CiAgICAgICAgZm9yIChQZW5kaW5nQWRkT3AgcGVu\nZGluZ0FkZE9wIDogcGVuZGluZ0FkZE9wcykgewogICAgICAgICAgICBwZW5k\naW5nQWRkT3AudW5zZXRTdWNjZXNzQW5kU2VuZFdyaXRlUmVxdWVzdChib29r\naWVJbmRleCk7CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgcmVyZWFkTWV0\nYWRhdGEoZmluYWwgR2VuZXJpY0NhbGxiYWNrPExlZGdlck1ldGFkYXRhPiBj\nYikgewogICAgICAgIGJrLmdldExlZGdlck1hbmFnZXIoKS5yZWFkTGVkZ2Vy\nTWV0YWRhdGEobGVkZ2VySWQsIGNiKTsKICAgIH0KCiAgICBzeW5jaHJvbml6\nZWQgdm9pZCByZWNvdmVyKGZpbmFsIEdlbmVyaWNDYWxsYmFjazxWb2lkPiBj\nYikgewogICAgICAgIGlmIChtZXRhZGF0YS5pc0Nsb3NlZCgpKSB7CiAgICAg\nICAgICAgIGxhc3RBZGRDb25maXJtZWQgPSBsYXN0QWRkUHVzaGVkID0gbWV0\nYWRhdGEuZ2V0TGFzdEVudHJ5SWQoKTsKICAgICAgICAgICAgbGVuZ3RoID0g\nbWV0YWRhdGEuZ2V0TGVuZ3RoKCk7CgogICAgICAgICAgICAvLyBXZSBhcmUg\nYWxyZWFkeSBjbG9zZWQsIG5vdGhpbmcgdG8gZG8KICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgbnVsbCk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIGlm\nIG1ldGFkYXRhIGlzIGFscmVhZHkgaW4gcmVjb3ZlciwgZG9udCB0cnkgdG8g\nd3JpdGUgYWdhaW4sCiAgICAgICAgLy8ganVzdCBkbyB0aGUgcmVjb3Zlcnkg\nZnJvbSB0aGUgc3RhcnRpbmcgcG9pbnQKICAgICAgICBpZiAobWV0YWRhdGEu\naXNJblJlY292ZXJ5KCkpIHsKICAgICAgICAgICAgbmV3IExlZGdlclJlY292\nZXJ5T3AoTGVkZ2VySGFuZGxlLnRoaXMsIGNiKS5pbml0aWF0ZSgpOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBtZXRhZGF0YS5t\nYXJrTGVkZ2VySW5SZWNvdmVyeSgpOwoKICAgICAgICB3cml0ZUxlZGdlckNv\nbmZpZyhuZXcgT3JkZXJlZFNhZmVHZW5lcmljQ2FsbGJhY2s8Vm9pZD4oYmsu\nbWFpbldvcmtlclBvb2wsIGxlZGdlcklkKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlT3BlcmF0aW9uQ29t\ncGxldGUoZmluYWwgaW50IHJjLCBWb2lkIHJlc3VsdCkgewogICAgICAgICAg\nICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuTWV0YWRhdGFWZXJz\naW9uRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmVyZWFkTWV0\nYWRhdGEobmV3IE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrPExlZGdlck1l\ndGFkYXRhPihiay5tYWluV29ya2VyUG9vbCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxlZGdlcklkKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzYWZlT3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBMZWRn\nZXJNZXRhZGF0YSBuZXdNZXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpZiAocmMgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRl\nKHJjLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEg\nPSBuZXdNZXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl\nY292ZXIoY2IpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJjID09IEJLRXhjZXB0aW9u\nLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICBuZXcgTGVkZ2VyUmVj\nb3ZlcnlPcChMZWRnZXJIYW5kbGUudGhpcywgY2IpLmluaXRpYXRlKCk7CiAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiRXJyb3Igd3JpdGluZyBsZWRnZXIgY29uZmlnICIgKyByYyAr\nICIgb2YgbGVkZ2VyICIgKyBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uQ29tcGxldGUocmMsIG51bGwpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAg\nc3RhdGljIGNsYXNzIE5vb3BDbG9zZUNhbGxiYWNrIGltcGxlbWVudHMgQ2xv\nc2VDYWxsYmFjayB7CiAgICAgICAgc3RhdGljIE5vb3BDbG9zZUNhbGxiYWNr\nIGluc3RhbmNlID0gbmV3IE5vb3BDbG9zZUNhbGxiYWNrKCk7CgogICAgICAg\nIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlQ29tcGxldGUo\naW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIE9iamVjdCBjdHgpIHsKICAgICAg\nICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAg\nICAgICAgICAgIExPRy53YXJuKCJDbG9zZSBmYWlsZWQ6ICIgKyBCS0V4Y2Vw\ndGlvbi5nZXRNZXNzYWdlKHJjKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgLy8gbm9vcAogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgU3luY1JlYWRDYWxsYmFjayBpbXBsZW1lbnRzIFJlYWRD\nYWxsYmFjayB7CiAgICAgICAgLyoqCiAgICAgICAgICogSW1wbGVtZW50YXRp\nb24gb2YgY2FsbGJhY2sgaW50ZXJmYWNlIGZvciBzeW5jaHJvbm91cyByZWFk\nIG1ldGhvZC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSByYwogICAg\nICAgICAqICAgICAgICAgIHJldHVybiBjb2RlCiAgICAgICAgICogQHBhcmFt\nIGxlZGVyCiAgICAgICAgICogICAgICAgICAgbGVkZ2VyIGlkZW50aWZpZXIK\nICAgICAgICAgKiBAcGFyYW0gc2VxCiAgICAgICAgICogICAgICAgICAgc2Vx\ndWVuY2Ugb2YgZW50cmllcwogICAgICAgICAqIEBwYXJhbSBjdHgKICAgICAg\nICAgKiAgICAgICAgICBjb250cm9sIG9iamVjdAogICAgICAgICAqLwogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJlYWRDb21wbGV0\nZShpbnQgcmMsIExlZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNlcSwg\nT2JqZWN0IGN0eCkgewogICAgICAgICAgICAKICAgICAgICAgICAgU3luY0Nv\ndW50ZXIgY291bnRlciA9IChTeW5jQ291bnRlcikgY3R4OwogICAgICAgICAg\nICBzeW5jaHJvbml6ZWQgKGNvdW50ZXIpIHsKICAgICAgICAgICAgICAgIGNv\ndW50ZXIuc2V0U2VxdWVuY2Uoc2VxKTsKICAgICAgICAgICAgICAgIGNvdW50\nZXIuc2V0cmMocmMpOwogICAgICAgICAgICAgICAgY291bnRlci5kZWMoKTsK\nICAgICAgICAgICAgICAgIGNvdW50ZXIubm90aWZ5KCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nU3luY0FkZENhbGxiYWNrIGltcGxlbWVudHMgQWRkQ2FsbGJhY2sgewogICAg\nICAgIGxvbmcgZW50cnlJZCA9IC0xOwoKICAgICAgICAvKioKICAgICAgICAg\nKiBJbXBsZW1lbnRhdGlvbiBvZiBjYWxsYmFjayBpbnRlcmZhY2UgZm9yIHN5\nbmNocm9ub3VzIHJlYWQgbWV0aG9kLgogICAgICAgICAqCiAgICAgICAgICog\nQHBhcmFtIHJjCiAgICAgICAgICogICAgICAgICAgcmV0dXJuIGNvZGUKICAg\nICAgICAgKiBAcGFyYW0gbGVkZXIKICAgICAgICAgKiAgICAgICAgICBsZWRn\nZXIgaWRlbnRpZmllcgogICAgICAgICAqIEBwYXJhbSBlbnRyeQogICAgICAg\nICAqICAgICAgICAgIGVudHJ5IGlkZW50aWZpZXIKICAgICAgICAgKiBAcGFy\nYW0gY3R4CiAgICAgICAgICogICAgICAgICAgY29udHJvbCBvYmplY3QKICAg\nICAgICAgKi8KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9p\nZCBhZGRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBsaCwgbG9uZyBl\nbnRyeSwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBTeW5jQ291bnRlciBj\nb3VudGVyID0gKFN5bmNDb3VudGVyKSBjdHg7CgogICAgICAgICAgICB0aGlz\nLmVudHJ5SWQgPSBlbnRyeTsKICAgICAgICAgICAgY291bnRlci5zZXRyYyhy\nYyk7CiAgICAgICAgICAgIGNvdW50ZXIuZGVjKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFN5bmNSZWFkTGFzdENvbmZp\ncm1lZENhbGxiYWNrIGltcGxlbWVudHMgUmVhZExhc3RDb25maXJtZWRDYWxs\nYmFjayB7CiAgICAgICAgLyoqCiAgICAgICAgICogSW1wbGVtZW50YXRpb24g\nb2YgIGNhbGxiYWNrIGludGVyZmFjZSBmb3Igc3luY2hyb25vdXMgcmVhZCBs\nYXN0IGNvbmZpcm1lZCBtZXRob2QuCiAgICAgICAgICovCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJtZWRD\nb21wbGV0ZShpbnQgcmMsIGxvbmcgbGFzdENvbmZpcm1lZCwgT2JqZWN0IGN0\neCkgewogICAgICAgICAgICBMYXN0Q29uZmlybWVkQ3R4IGxjQ3R4ID0gKExh\nc3RDb25maXJtZWRDdHgpIGN0eDsKICAgICAgICAgICAgCiAgICAgICAgICAg\nIHN5bmNocm9uaXplZChsY0N0eCkgewogICAgICAgICAgICAgICAgbGNDdHgu\nc2V0UkMocmMpOwogICAgICAgICAgICAgICAgbGNDdHguc2V0TGFzdENvbmZp\ncm1lZChsYXN0Q29uZmlybWVkKTsKICAgICAgICAgICAgICAgIGxjQ3R4Lm5v\ndGlmeSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIFN5bmNDbG9zZUNhbGxiYWNrIGltcGxlbWVu\ndHMgQ2xvc2VDYWxsYmFjayB7CiAgICAgICAgLyoqCiAgICAgICAgICogQ2xv\nc2UgY2FsbGJhY2sgbWV0aG9kCiAgICAgICAgICoKICAgICAgICAgKiBAcGFy\nYW0gcmMKICAgICAgICAgKiBAcGFyYW0gbGgKICAgICAgICAgKiBAcGFyYW0g\nY3R4CiAgICAgICAgICovCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIHZvaWQgY2xvc2VDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBs\naCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBTeW5jQ291bnRlciBjb3Vu\ndGVyID0gKFN5bmNDb3VudGVyKSBjdHg7CiAgICAgICAgICAgIGNvdW50ZXIu\nc2V0cmMocmMpOwogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGNvdW50ZXIp\nIHsKICAgICAgICAgICAgICAgIGNvdW50ZXIuZGVjKCk7CiAgICAgICAgICAg\nICAgICBjb3VudGVyLm5vdGlmeSgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQp9Cg==\n","encoding":"base64"}

