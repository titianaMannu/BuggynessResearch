{"sha":"1a8167d9b96c667073358bff45907555a5d7273f","node_id":"MDQ6QmxvYjE1NzU5NTY6MWE4MTY3ZDliOTZjNjY3MDczMzU4YmZmNDU5MDc1NTVhNWQ3MjczZg==","size":18932,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1a8167d9b96c667073358bff45907555a5d7273f","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKaW1wb3J0IHN0\nYXRpYyBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLkNoYXJzZXRzLlVURl84OwoK\naW1wb3J0IGphdmEuaW8uQnVmZmVyZWRSZWFkZXI7CmltcG9ydCBqYXZhLmlv\nLlN0cmluZ1JlYWRlcjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247Cmlt\ncG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEu\ndXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRy\neTsKaW1wb3J0IGphdmEudXRpbC5Tb3J0ZWRNYXA7CmltcG9ydCBqYXZhLnV0\naWwuVHJlZU1hcDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CgppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lvbjsKaW1w\nb3J0IGNvbS5nb29nbGUucHJvdG9idWYuVGV4dEZvcm1hdDsKaW1wb3J0IGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0\nYUZvcm1hdDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlN0\ncmluZ1V0aWxzOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIFRoaXMgY2xhc3MgZW5j\nYXBzdWxhdGVzIGFsbCB0aGUgbGVkZ2VyIG1ldGFkYXRhIHRoYXQgaXMgcGVy\nc2lzdGVudGx5IHN0b3JlZAogKiBpbiB6b29rZWVwZXIuIEl0IHByb3ZpZGVz\nIHBhcnNpbmcgYW5kIHNlcmlhbGl6YXRpb24gbWV0aG9kcyBvZiBzdWNoIG1l\ndGFkYXRhLgogKgogKi8KcHVibGljIGNsYXNzIExlZGdlck1ldGFkYXRhIHsK\nICAgIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5n\nZXRMb2dnZXIoTGVkZ2VyTWV0YWRhdGEuY2xhc3MpOwoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIFN0cmluZyBjbG9zZWQgPSAiQ0xPU0VEIjsKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBsU3BsaXR0ZXIgPSAiXG4iOwog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIHRTcGxpdHRlciA9ICJc\ndCI7CgogICAgLy8gY2FuJ3QgdXNlIC0xIGZvciBOT1RDTE9TRUQgYmVjYXVz\nZSB0aGF0IGlzIHJlc2VydmVkIGZvciBhIGNsb3NlZCwgZW1wdHkKICAgIC8v\nIGxlZGdlcgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IE5PVENMT1NF\nRCA9IC0xMDE7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBpbnQgSU5fUkVD\nT1ZFUlkgPSAtMTAyOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IExP\nV0VTVF9DT01QQVRfTUVUQURBVEFfRk9STUFUX1ZFUlNJT04gPSAwOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ1VSUkVOVF9NRVRBREFUQV9GT1JN\nQVRfVkVSU0lPTiA9IDI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmlu\nZyBWRVJTSU9OX0tFWSA9ICJCb29raWVNZXRhZGF0YUZvcm1hdFZlcnNpb24i\nOwoKICAgIHByaXZhdGUgaW50IG1ldGFkYXRhRm9ybWF0VmVyc2lvbiA9IDA7\nCgogICAgcHJpdmF0ZSBpbnQgZW5zZW1ibGVTaXplOwogICAgcHJpdmF0ZSBp\nbnQgd3JpdGVRdW9ydW1TaXplOwogICAgcHJpdmF0ZSBpbnQgYWNrUXVvcnVt\nU2l6ZTsKICAgIHByaXZhdGUgbG9uZyBsZW5ndGg7CiAgICBwcml2YXRlIGxv\nbmcgbGFzdEVudHJ5SWQ7CgogICAgcHJpdmF0ZSBMZWRnZXJNZXRhZGF0YUZv\ncm1hdC5TdGF0ZSBzdGF0ZTsKICAgIHByaXZhdGUgU29ydGVkTWFwPExvbmcs\nIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4+IGVuc2VtYmxlcyA9IG5l\ndyBUcmVlTWFwPExvbmcsIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4+\nKCk7CiAgICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGN1cnJlbnRF\nbnNlbWJsZTsKICAgIHZvbGF0aWxlIFZlcnNpb24gdmVyc2lvbiA9IFZlcnNp\nb24uTkVXOwoKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNQYXNzd29yZCA9IGZh\nbHNlOwogICAgcHJpdmF0ZSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5EaWdlc3RU\neXBlIGRpZ2VzdFR5cGU7CiAgICBwcml2YXRlIGJ5dGVbXSBwYXNzd29yZDsK\nCiAgICBwdWJsaWMgTGVkZ2VyTWV0YWRhdGEoaW50IGVuc2VtYmxlU2l6ZSwg\naW50IHdyaXRlUXVvcnVtU2l6ZSwgaW50IGFja1F1b3J1bVNpemUsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgQm9va0tlZXBlci5EaWdlc3RUeXBlIGRp\nZ2VzdFR5cGUsIGJ5dGVbXSBwYXNzd29yZCkgewogICAgICAgIHRoaXMuZW5z\nZW1ibGVTaXplID0gZW5zZW1ibGVTaXplOwogICAgICAgIHRoaXMud3JpdGVR\ndW9ydW1TaXplID0gd3JpdGVRdW9ydW1TaXplOwogICAgICAgIHRoaXMuYWNr\nUXVvcnVtU2l6ZSA9IGFja1F1b3J1bVNpemU7CgogICAgICAgIC8qCiAgICAg\nICAgICogSXQgaXMgc2V0IGluIFBlbmRpbmdSZWFkT3AucmVhZEVudHJ5Q29t\ncGxldGUsIGFuZAogICAgICAgICAqIHdlIHJlYWQgaXQgaW4gTGVkZ2VyUmVj\nb3ZlcnlPcC5yZWFkQ29tcGxldGUuCiAgICAgICAgICovCiAgICAgICAgdGhp\ncy5sZW5ndGggPSAwOwogICAgICAgIHRoaXMuc3RhdGUgPSBMZWRnZXJNZXRh\nZGF0YUZvcm1hdC5TdGF0ZS5PUEVOOwogICAgICAgIHRoaXMubGFzdEVudHJ5\nSWQgPSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9JRDsKICAgICAgICB0\naGlzLm1ldGFkYXRhRm9ybWF0VmVyc2lvbiA9IENVUlJFTlRfTUVUQURBVEFf\nRk9STUFUX1ZFUlNJT047CgogICAgICAgIHRoaXMuZGlnZXN0VHlwZSA9IGRp\nZ2VzdFR5cGUuZXF1YWxzKEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5NQUMpID8K\nICAgICAgICAgICAgTGVkZ2VyTWV0YWRhdGFGb3JtYXQuRGlnZXN0VHlwZS5I\nTUFDIDogTGVkZ2VyTWV0YWRhdGFGb3JtYXQuRGlnZXN0VHlwZS5DUkMzMjsK\nICAgICAgICB0aGlzLnBhc3N3b3JkID0gQXJyYXlzLmNvcHlPZihwYXNzd29y\nZCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgICAgICB0aGlzLmhhc1Bhc3N3b3Jk\nID0gdHJ1ZTsKICAgIH0KCiAgICAvKioKICAgICAqIENvcHkgQ29uc3RydWN0\nb3IuCiAgICAgKi8KICAgIExlZGdlck1ldGFkYXRhKExlZGdlck1ldGFkYXRh\nIG90aGVyKSB7CiAgICAgICAgdGhpcy5lbnNlbWJsZVNpemUgPSBvdGhlci5l\nbnNlbWJsZVNpemU7CiAgICAgICAgdGhpcy53cml0ZVF1b3J1bVNpemUgPSBv\ndGhlci53cml0ZVF1b3J1bVNpemU7CiAgICAgICAgdGhpcy5hY2tRdW9ydW1T\naXplID0gb3RoZXIuYWNrUXVvcnVtU2l6ZTsKICAgICAgICB0aGlzLmxlbmd0\naCA9IG90aGVyLmxlbmd0aDsKICAgICAgICB0aGlzLmxhc3RFbnRyeUlkID0g\nb3RoZXIubGFzdEVudHJ5SWQ7CiAgICAgICAgdGhpcy5tZXRhZGF0YUZvcm1h\ndFZlcnNpb24gPSBvdGhlci5tZXRhZGF0YUZvcm1hdFZlcnNpb247CiAgICAg\nICAgdGhpcy5zdGF0ZSA9IG90aGVyLnN0YXRlOwogICAgICAgIHRoaXMudmVy\nc2lvbiA9IG90aGVyLnZlcnNpb247CiAgICAgICAgdGhpcy5oYXNQYXNzd29y\nZCA9IG90aGVyLmhhc1Bhc3N3b3JkOwogICAgICAgIHRoaXMuZGlnZXN0VHlw\nZSA9IG90aGVyLmRpZ2VzdFR5cGU7CiAgICAgICAgdGhpcy5wYXNzd29yZCA9\nIG5ldyBieXRlW290aGVyLnBhc3N3b3JkLmxlbmd0aF07CiAgICAgICAgU3lz\ndGVtLmFycmF5Y29weShvdGhlci5wYXNzd29yZCwgMCwgdGhpcy5wYXNzd29y\nZCwgMCwgb3RoZXIucGFzc3dvcmQubGVuZ3RoKTsKICAgICAgICAvLyBjb3B5\nIHRoZSBlbnNlbWJsZXMKICAgICAgICBmb3IgKEVudHJ5PExvbmcsIEFycmF5\nTGlzdDxJbmV0U29ja2V0QWRkcmVzcz4+IGVudHJ5IDogb3RoZXIuZW5zZW1i\nbGVzLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgbG9uZyBzdGFydEVudHJ5\nSWQgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgQXJyYXlMaXN0PElu\nZXRTb2NrZXRBZGRyZXNzPiBuZXdFbnNlbWJsZSA9IG5ldyBBcnJheUxpc3Q8\nSW5ldFNvY2tldEFkZHJlc3M+KGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAg\nICAgICB0aGlzLmFkZEVuc2VtYmxlKHN0YXJ0RW50cnlJZCwgbmV3RW5zZW1i\nbGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIExlZGdlck1ldGFk\nYXRhKCkgewogICAgICAgIHRoaXMoMCwgMCwgMCwgQm9va0tlZXBlci5EaWdl\nc3RUeXBlLk1BQywgbmV3IGJ5dGVbXSB7fSk7CiAgICAgICAgdGhpcy5oYXNQ\nYXNzd29yZCA9IGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRo\nZSBNYXAgb2YgYm9va2llIGVuc2VtYmxlcyBmb3IgdGhlIHZhcmlvdXMgbGVk\nZ2VyIGZyYWdtZW50cwogICAgICogdGhhdCBtYWtlIHVwIHRoZSBsZWRnZXIu\nCiAgICAgKgogICAgICogQHJldHVybiBTb3J0ZWRNYXAgb2YgTGVkZ2VyIEZy\nYWdtZW50cyBhbmQgdGhlIGNvcnJlc3BvbmRpbmcKICAgICAqIGJvb2tpZSBl\nbnNlbWJsZXMgdGhhdCBzdG9yZSB0aGUgZW50cmllcy4KICAgICAqLwogICAg\ncHVibGljIFNvcnRlZE1hcDxMb25nLCBBcnJheUxpc3Q8SW5ldFNvY2tldEFk\nZHJlc3M+PiBnZXRFbnNlbWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIGVuc2Vt\nYmxlczsKICAgIH0KCiAgICB2b2lkIHNldEVuc2VtYmxlcyhTb3J0ZWRNYXA8\nTG9uZywgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPj4gZW5zZW1ibGVz\nKSB7CiAgICAgICAgdGhpcy5lbnNlbWJsZXMgPSBlbnNlbWJsZXM7CiAgICB9\nCgogICAgcHVibGljIGludCBnZXRFbnNlbWJsZVNpemUoKSB7CiAgICAgICAg\ncmV0dXJuIGVuc2VtYmxlU2l6ZTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdl\ndFdyaXRlUXVvcnVtU2l6ZSgpIHsKICAgICAgICByZXR1cm4gd3JpdGVRdW9y\ndW1TaXplOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0QWNrUXVvcnVtU2l6\nZSgpIHsKICAgICAgICByZXR1cm4gYWNrUXVvcnVtU2l6ZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEluIHZlcnNpb25zIDQuMS4wIGFuZCBiZWxvdywgdGhl\nIGRpZ2VzdCB0eXBlIGFuZCBwYXNzd29yZCB3ZXJlIG5vdAogICAgICogc3Rv\ncmVkIGluIHRoZSBtZXRhZGF0YS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHdo\nZXRoZXIgdGhlIHBhc3N3b3JkIGhhcyBiZWVuIHN0b3JlZCBpbiB0aGUgbWV0\nYWRhdGEKICAgICAqLwogICAgYm9vbGVhbiBoYXNQYXNzd29yZCgpIHsKICAg\nICAgICByZXR1cm4gaGFzUGFzc3dvcmQ7CiAgICB9CgogICAgYnl0ZVtdIGdl\ndFBhc3N3b3JkKCkgewogICAgICAgIHJldHVybiBBcnJheXMuY29weU9mKHBh\nc3N3b3JkLCBwYXNzd29yZC5sZW5ndGgpOwogICAgfQoKICAgIEJvb2tLZWVw\nZXIuRGlnZXN0VHlwZSBnZXREaWdlc3RUeXBlKCkgewogICAgICAgIGlmIChk\naWdlc3RUeXBlLmVxdWFscyhMZWRnZXJNZXRhZGF0YUZvcm1hdC5EaWdlc3RU\neXBlLkhNQUMpKSB7CiAgICAgICAgICAgIHJldHVybiBCb29rS2VlcGVyLkRp\nZ2VzdFR5cGUuTUFDOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJl\ndHVybiBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzI7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBsb25nIGdldExhc3RFbnRyeUlkKCkgewogICAg\nICAgIHJldHVybiBsYXN0RW50cnlJZDsKICAgIH0KCiAgICBwdWJsaWMgbG9u\nZyBnZXRMZW5ndGgoKSB7CiAgICAgICAgcmV0dXJuIGxlbmd0aDsKICAgIH0K\nCiAgICB2b2lkIHNldExlbmd0aChsb25nIGxlbmd0aCkgewogICAgICAgIHRo\naXMubGVuZ3RoID0gbGVuZ3RoOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzQ2xvc2VkKCkgewogICAgICAgIHJldHVybiBzdGF0ZSA9PSBMZWRnZXJN\nZXRhZGF0YUZvcm1hdC5TdGF0ZS5DTE9TRUQ7CiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaXNJblJlY292ZXJ5KCkgewogICAgICAgIHJldHVybiBzdGF0\nZSA9PSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZS5JTl9SRUNPVkVSWTsK\nICAgIH0KCiAgICBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSBnZXRTdGF0\nZSgpIHsKICAgICAgICByZXR1cm4gc3RhdGU7CiAgICB9CgogICAgdm9pZCBz\nZXRTdGF0ZShMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSBzdGF0ZSkgewog\nICAgICAgIHRoaXMuc3RhdGUgPSBzdGF0ZTsKICAgIH0KCiAgICB2b2lkIG1h\ncmtMZWRnZXJJblJlY292ZXJ5KCkgewogICAgICAgIHN0YXRlID0gTGVkZ2Vy\nTWV0YWRhdGFGb3JtYXQuU3RhdGUuSU5fUkVDT1ZFUlk7CiAgICB9CgogICAg\ndm9pZCBjbG9zZShsb25nIGVudHJ5SWQpIHsKICAgICAgICBsYXN0RW50cnlJ\nZCA9IGVudHJ5SWQ7CiAgICAgICAgc3RhdGUgPSBMZWRnZXJNZXRhZGF0YUZv\ncm1hdC5TdGF0ZS5DTE9TRUQ7CiAgICB9CgogICAgdm9pZCBhZGRFbnNlbWJs\nZShsb25nIHN0YXJ0RW50cnlJZCwgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRy\nZXNzPiBlbnNlbWJsZSkgewogICAgICAgIGFzc2VydCBlbnNlbWJsZXMuaXNF\nbXB0eSgpIHx8IHN0YXJ0RW50cnlJZCA+PSBlbnNlbWJsZXMubGFzdEtleSgp\nOwoKICAgICAgICBlbnNlbWJsZXMucHV0KHN0YXJ0RW50cnlJZCwgZW5zZW1i\nbGUpOwogICAgICAgIGN1cnJlbnRFbnNlbWJsZSA9IGVuc2VtYmxlOwogICAg\nfQoKICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gZ2V0RW5zZW1i\nbGUobG9uZyBlbnRyeUlkKSB7CiAgICAgICAgLy8gdGhlIGhlYWQgbWFwIGNh\nbm5vdCBiZSBlbXB0eSwgc2luY2Ugd2UgaW5zZXJ0IGFuIGVuc2VtYmxlIGZv\ncgogICAgICAgIC8vIGVudHJ5LWlkIDAsIHJpZ2h0IHdoZW4gd2Ugc3RhcnQK\nICAgICAgICByZXR1cm4gZW5zZW1ibGVzLmdldChlbnNlbWJsZXMuaGVhZE1h\ncChlbnRyeUlkICsgMSkubGFzdEtleSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIHRoZSBlbnRyeSBpZCA+IHRoZSBnaXZlbiBlbnRyeS1pZCBhdCB3aGlj\naCB0aGUgbmV4dCBlbnNlbWJsZSBjaGFuZ2UgdGFrZXMKICAgICAqIHBsYWNl\nICggLTEgaWYgbm8gZnVydGhlciBlbnNlbWJsZSBjaGFuZ2VzKQogICAgICoK\nICAgICAqIEBwYXJhbSBlbnRyeUlkCiAgICAgKiBAcmV0dXJuCiAgICAgKi8K\nICAgIGxvbmcgZ2V0TmV4dEVuc2VtYmxlQ2hhbmdlKGxvbmcgZW50cnlJZCkg\newogICAgICAgIFNvcnRlZE1hcDxMb25nLCBBcnJheUxpc3Q8SW5ldFNvY2tl\ndEFkZHJlc3M+PiB0YWlsTWFwID0gZW5zZW1ibGVzLnRhaWxNYXAoZW50cnlJ\nZCArIDEpOwoKICAgICAgICBpZiAodGFpbE1hcC5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgIHJldHVybiB0YWlsTWFwLmZpcnN0S2V5KCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogR2VuZXJhdGVzIGEgYnl0ZSBhcnJheSBvZiB0\naGlzIG9iamVjdAogICAgICoKICAgICAqIEByZXR1cm4gdGhlIG1ldGFkYXRh\nIHNlcmlhbGl6ZWQgaW50byBhIGJ5dGUgYXJyYXkKICAgICAqLwogICAgcHVi\nbGljIGJ5dGVbXSBzZXJpYWxpemUoKSB7CiAgICAgICAgaWYgKG1ldGFkYXRh\nRm9ybWF0VmVyc2lvbiA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiBzZXJp\nYWxpemVWZXJzaW9uMSgpOwogICAgICAgIH0KICAgICAgICBMZWRnZXJNZXRh\nZGF0YUZvcm1hdC5CdWlsZGVyIGJ1aWxkZXIgPSBMZWRnZXJNZXRhZGF0YUZv\ncm1hdC5uZXdCdWlsZGVyKCk7CiAgICAgICAgYnVpbGRlci5zZXRRdW9ydW1T\naXplKHdyaXRlUXVvcnVtU2l6ZSkuc2V0QWNrUXVvcnVtU2l6ZShhY2tRdW9y\ndW1TaXplKQogICAgICAgICAgICAuc2V0RW5zZW1ibGVTaXplKGVuc2VtYmxl\nU2l6ZSkuc2V0TGVuZ3RoKGxlbmd0aCkKICAgICAgICAgICAgLnNldFN0YXRl\nKHN0YXRlKS5zZXRMYXN0RW50cnlJZChsYXN0RW50cnlJZCk7CgogICAgICAg\nIGlmIChoYXNQYXNzd29yZCkgewogICAgICAgICAgICBidWlsZGVyLnNldERp\nZ2VzdFR5cGUoZGlnZXN0VHlwZSkuc2V0UGFzc3dvcmQoQnl0ZVN0cmluZy5j\nb3B5RnJvbShwYXNzd29yZCkpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChN\nYXAuRW50cnk8TG9uZywgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPj4g\nZW50cnkgOiBlbnNlbWJsZXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBM\nZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50LkJ1aWxkZXIgc2VnbWVudEJ1\naWxkZXIgPSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50Lm5ld0J1aWxk\nZXIoKTsKICAgICAgICAgICAgc2VnbWVudEJ1aWxkZXIuc2V0Rmlyc3RFbnRy\neUlkKGVudHJ5LmdldEtleSgpKTsKICAgICAgICAgICAgZm9yIChJbmV0U29j\na2V0QWRkcmVzcyBhZGRyIDogZW50cnkuZ2V0VmFsdWUoKSkgewogICAgICAg\nICAgICAgICAgc2VnbWVudEJ1aWxkZXIuYWRkRW5zZW1ibGVNZW1iZXIoU3Ry\naW5nVXRpbHMuYWRkclRvU3RyaW5nKGFkZHIpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBidWlsZGVyLmFkZFNlZ21lbnQoc2VnbWVudEJ1aWxkZXIu\nYnVpbGQoKSk7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmdCdWlsZGVyIHMg\nPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHMuYXBwZW5kKFZFUlNJ\nT05fS0VZKS5hcHBlbmQodFNwbGl0dGVyKS5hcHBlbmQoQ1VSUkVOVF9NRVRB\nREFUQV9GT1JNQVRfVkVSU0lPTikuYXBwZW5kKGxTcGxpdHRlcik7CiAgICAg\nICAgcy5hcHBlbmQoVGV4dEZvcm1hdC5wcmludFRvU3RyaW5nKGJ1aWxkZXIu\nYnVpbGQoKSkpOwogICAgICAgIExPRy5kZWJ1ZygiU2VyaWFsaXplZCBjb25m\naWc6IHt9Iiwgcyk7CiAgICAgICAgcmV0dXJuIHMudG9TdHJpbmcoKS5nZXRC\neXRlcygpOwogICAgfQoKICAgIHByaXZhdGUgYnl0ZVtdIHNlcmlhbGl6ZVZl\ncnNpb24xKCkgewogICAgICAgIFN0cmluZ0J1aWxkZXIgcyA9IG5ldyBTdHJp\nbmdCdWlsZGVyKCk7CiAgICAgICAgcy5hcHBlbmQoVkVSU0lPTl9LRVkpLmFw\ncGVuZCh0U3BsaXR0ZXIpLmFwcGVuZChtZXRhZGF0YUZvcm1hdFZlcnNpb24p\nLmFwcGVuZChsU3BsaXR0ZXIpOwogICAgICAgIHMuYXBwZW5kKHdyaXRlUXVv\ncnVtU2l6ZSkuYXBwZW5kKGxTcGxpdHRlcikuYXBwZW5kKGVuc2VtYmxlU2l6\nZSkuYXBwZW5kKGxTcGxpdHRlcikuYXBwZW5kKGxlbmd0aCk7CgogICAgICAg\nIGZvciAoTWFwLkVudHJ5PExvbmcsIEFycmF5TGlzdDxJbmV0U29ja2V0QWRk\ncmVzcz4+IGVudHJ5IDogZW5zZW1ibGVzLmVudHJ5U2V0KCkpIHsKICAgICAg\nICAgICAgcy5hcHBlbmQobFNwbGl0dGVyKS5hcHBlbmQoZW50cnkuZ2V0S2V5\nKCkpOwogICAgICAgICAgICBmb3IgKEluZXRTb2NrZXRBZGRyZXNzIGFkZHIg\nOiBlbnRyeS5nZXRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICBzLmFwcGVu\nZCh0U3BsaXR0ZXIpOwogICAgICAgICAgICAgICAgcy5hcHBlbmQoU3RyaW5n\nVXRpbHMuYWRkclRvU3RyaW5nKGFkZHIpKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgaWYgKHN0YXRlID09IExlZGdlck1ldGFkYXRhRm9y\nbWF0LlN0YXRlLklOX1JFQ09WRVJZKSB7CiAgICAgICAgICAgIHMuYXBwZW5k\nKGxTcGxpdHRlcikuYXBwZW5kKElOX1JFQ09WRVJZKS5hcHBlbmQodFNwbGl0\ndGVyKS5hcHBlbmQoY2xvc2VkKTsKICAgICAgICB9IGVsc2UgaWYgKHN0YXRl\nID09IExlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlLkNMT1NFRCkgewogICAg\nICAgICAgICBzLmFwcGVuZChsU3BsaXR0ZXIpLmFwcGVuZChnZXRMYXN0RW50\ncnlJZCgpKS5hcHBlbmQodFNwbGl0dGVyKS5hcHBlbmQoY2xvc2VkKTsKICAg\nICAgICB9CgogICAgICAgIExPRy5kZWJ1ZygiU2VyaWFsaXplZCBjb25maWc6\nIHt9Iiwgcyk7CgogICAgICAgIHJldHVybiBzLnRvU3RyaW5nKCkuZ2V0Qnl0\nZXMoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlcyBhIGdpdmVuIGJ5\ndGUgYXJyYXkgYW5kIHRyYW5zZm9ybXMgaW50byBhIExlZGdlckNvbmZpZyBv\nYmplY3QKICAgICAqCiAgICAgKiBAcGFyYW0gYnl0ZXMKICAgICAqICAgICAg\nICAgICAgYnl0ZSBhcnJheSB0byBwYXJzZQogICAgICogQHBhcmFtIHZlcnNp\nb24KICAgICAqICAgICAgICAgICAgdmVyc2lvbiBvZiB0aGUgbGVkZ2VyIG1l\ndGFkYXRhCiAgICAgKiBAcmV0dXJuIExlZGdlckNvbmZpZwogICAgICogQHRo\ncm93cyBJT0V4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgaWYgdGhlIGdp\ndmVuIGJ5dGVbXSBjYW5ub3QgYmUgcGFyc2VkCiAgICAgKi8KICAgIHB1Ymxp\nYyBzdGF0aWMgTGVkZ2VyTWV0YWRhdGEgcGFyc2VDb25maWcoYnl0ZVtdIGJ5\ndGVzLCBWZXJzaW9uIHZlcnNpb24pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgTGVkZ2VyTWV0YWRhdGEgbGMgPSBuZXcgTGVkZ2VyTWV0YWRhdGEo\nKTsKICAgICAgICBsYy52ZXJzaW9uID0gdmVyc2lvbjsKCiAgICAgICAgU3Ry\naW5nIGNvbmZpZyA9IG5ldyBTdHJpbmcoYnl0ZXMpOwoKICAgICAgICBMT0cu\nZGVidWcoIlBhcnNpbmcgQ29uZmlnOiB7fSIsIGNvbmZpZyk7CiAgICAgICAg\nQnVmZmVyZWRSZWFkZXIgcmVhZGVyID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5l\ndyBTdHJpbmdSZWFkZXIoY29uZmlnKSk7CiAgICAgICAgU3RyaW5nIHZlcnNp\nb25MaW5lID0gcmVhZGVyLnJlYWRMaW5lKCk7CiAgICAgICAgaWYgKHZlcnNp\nb25MaW5lID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKCJJbnZhbGlkIG1ldGFkYXRhLiBDb250ZW50IG1pc3NpbmciKTsK\nICAgICAgICB9CiAgICAgICAgaW50IGkgPSAwOwogICAgICAgIGlmICh2ZXJz\naW9uTGluZS5zdGFydHNXaXRoKFZFUlNJT05fS0VZKSkgewogICAgICAgICAg\nICBTdHJpbmcgcGFydHNbXSA9IHZlcnNpb25MaW5lLnNwbGl0KHRTcGxpdHRl\ncik7CiAgICAgICAgICAgIGxjLm1ldGFkYXRhRm9ybWF0VmVyc2lvbiA9IG5l\ndyBJbnRlZ2VyKHBhcnRzWzFdKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAvLyBpZiBubyB2ZXJzaW9uIGlzIHNldCwgdGFrZSBpdCB0byBiZSB2\nZXJzaW9uIDEKICAgICAgICAgICAgLy8gYXMgdGhlIHBhcnNpbmcgaXMgdGhl\nIHNhbWUgYXMgd2hhdCB3ZSBoYWQgYmVmb3JlCiAgICAgICAgICAgIC8vIHdl\nIGludHJvZHVjZSB2ZXJzaW9ucwogICAgICAgICAgICBsYy5tZXRhZGF0YUZv\ncm1hdFZlcnNpb24gPSAxOwogICAgICAgICAgICAvLyByZXNldCB0aGUgcmVh\nZGVyCiAgICAgICAgICAgIHJlYWRlci5jbG9zZSgpOwogICAgICAgICAgICBy\nZWFkZXIgPSBuZXcgQnVmZmVyZWRSZWFkZXIobmV3IFN0cmluZ1JlYWRlcihj\nb25maWcpKTsKICAgICAgICB9CgogICAgICAgIGlmIChsYy5tZXRhZGF0YUZv\ncm1hdFZlcnNpb24gPCBMT1dFU1RfQ09NUEFUX01FVEFEQVRBX0ZPUk1BVF9W\nRVJTSU9OCiAgICAgICAgICAgIHx8IGxjLm1ldGFkYXRhRm9ybWF0VmVyc2lv\nbiA+IENVUlJFTlRfTUVUQURBVEFfRk9STUFUX1ZFUlNJT04pIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJNZXRhZGF0YSB2ZXJzaW9u\nIG5vdCBjb21wYXRpYmxlLiBFeHBlY3RlZCBiZXR3ZWVuICIKICAgICAgICAg\nICAgICAgICAgICArIExPV0VTVF9DT01QQVRfTUVUQURBVEFfRk9STUFUX1ZF\nUlNJT04gKyAiIGFuZCAiICsgQ1VSUkVOVF9NRVRBREFUQV9GT1JNQVRfVkVS\nU0lPTgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBi\ndXQgZ290ICIgKyBsYy5tZXRhZGF0YUZvcm1hdFZlcnNpb24pOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKGxjLm1ldGFkYXRhRm9ybWF0VmVyc2lvbiA9PSAx\nKSB7CiAgICAgICAgICAgIHJldHVybiBwYXJzZVZlcnNpb24xQ29uZmlnKGxj\nLCByZWFkZXIpOwogICAgICAgIH0KCiAgICAgICAgTGVkZ2VyTWV0YWRhdGFG\nb3JtYXQuQnVpbGRlciBidWlsZGVyID0gTGVkZ2VyTWV0YWRhdGFGb3JtYXQu\nbmV3QnVpbGRlcigpOwogICAgICAgIFRleHRGb3JtYXQubWVyZ2UocmVhZGVy\nLCBidWlsZGVyKTsKICAgICAgICBMZWRnZXJNZXRhZGF0YUZvcm1hdCBkYXRh\nID0gYnVpbGRlci5idWlsZCgpOwogICAgICAgIGxjLndyaXRlUXVvcnVtU2l6\nZSA9IGRhdGEuZ2V0UXVvcnVtU2l6ZSgpOwogICAgICAgIGlmIChkYXRhLmhh\nc0Fja1F1b3J1bVNpemUoKSkgewogICAgICAgICAgICBsYy5hY2tRdW9ydW1T\naXplID0gZGF0YS5nZXRBY2tRdW9ydW1TaXplKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgbGMuYWNrUXVvcnVtU2l6ZSA9IGxjLndyaXRlUXVv\ncnVtU2l6ZTsKICAgICAgICB9CgogICAgICAgIGxjLmVuc2VtYmxlU2l6ZSA9\nIGRhdGEuZ2V0RW5zZW1ibGVTaXplKCk7CiAgICAgICAgbGMubGVuZ3RoID0g\nZGF0YS5nZXRMZW5ndGgoKTsKICAgICAgICBsYy5zdGF0ZSA9IGRhdGEuZ2V0\nU3RhdGUoKTsKICAgICAgICBsYy5sYXN0RW50cnlJZCA9IGRhdGEuZ2V0TGFz\ndEVudHJ5SWQoKTsKCiAgICAgICAgaWYgKGRhdGEuaGFzUGFzc3dvcmQoKSkg\newogICAgICAgICAgICBsYy5kaWdlc3RUeXBlID0gZGF0YS5nZXREaWdlc3RU\neXBlKCk7CiAgICAgICAgICAgIGxjLnBhc3N3b3JkID0gZGF0YS5nZXRQYXNz\nd29yZCgpLnRvQnl0ZUFycmF5KCk7CiAgICAgICAgICAgIGxjLmhhc1Bhc3N3\nb3JkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGZvciAoTGVkZ2VyTWV0\nYWRhdGFGb3JtYXQuU2VnbWVudCBzIDogZGF0YS5nZXRTZWdtZW50TGlzdCgp\nKSB7CiAgICAgICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4g\nYWRkcnMgPSBuZXcgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPigpOwog\nICAgICAgICAgICBmb3IgKFN0cmluZyBtZW1iZXIgOiBzLmdldEVuc2VtYmxl\nTWVtYmVyTGlzdCgpKSB7CiAgICAgICAgICAgICAgICBhZGRycy5hZGQoU3Ry\naW5nVXRpbHMucGFyc2VBZGRyKG1lbWJlcikpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGxjLmFkZEVuc2VtYmxlKHMuZ2V0Rmlyc3RFbnRyeUlkKCks\nIGFkZHJzKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxjOwogICAgfQoK\nICAgIHN0YXRpYyBMZWRnZXJNZXRhZGF0YSBwYXJzZVZlcnNpb24xQ29uZmln\nKExlZGdlck1ldGFkYXRhIGxjLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgQnVmZmVyZWRSZWFkZXIgcmVhZGVyKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGxjLndyaXRlUXVvcnVtU2l6ZSA9IGxjLmFja1F1b3J1bVNpemUgPSBuZXcg\nSW50ZWdlcihyZWFkZXIucmVhZExpbmUoKSk7CiAgICAgICAgICAgIGxjLmVu\nc2VtYmxlU2l6ZSA9IG5ldyBJbnRlZ2VyKHJlYWRlci5yZWFkTGluZSgpKTsK\nICAgICAgICAgICAgbGMubGVuZ3RoID0gbmV3IExvbmcocmVhZGVyLnJlYWRM\naW5lKCkpOwoKICAgICAgICAgICAgU3RyaW5nIGxpbmUgPSByZWFkZXIucmVh\nZExpbmUoKTsKICAgICAgICAgICAgd2hpbGUgKGxpbmUgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgU3RyaW5nIHBhcnRzW10gPSBsaW5lLnNwbGl0KHRT\ncGxpdHRlcik7CgogICAgICAgICAgICAgICAgaWYgKHBhcnRzWzFdLmVxdWFs\ncyhjbG9zZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgTG9uZyBsID0gbmV3\nIExvbmcocGFydHNbMF0pOwogICAgICAgICAgICAgICAgICAgIGlmIChsID09\nIElOX1JFQ09WRVJZKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxjLnN0\nYXRlID0gTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU3RhdGUuSU5fUkVDT1ZFUlk7\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgbGMuc3RhdGUgPSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0\nZS5DTE9TRUQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxjLmxhc3RFbnRy\neUlkID0gbDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgIGxjLnN0YXRlID0gTGVkZ2VyTWV0YWRhdGFGb3JtYXQu\nU3RhdGUuT1BFTjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGFkZHJzID0gbmV3IEFy\ncmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4oKTsKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGogPSAxOyBqIDwgcGFydHMubGVuZ3RoOyBqKyspIHsKICAg\nICAgICAgICAgICAgICAgICBhZGRycy5hZGQoU3RyaW5nVXRpbHMucGFyc2VB\nZGRyKHBhcnRzW2pdKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBsYy5hZGRFbnNlbWJsZShuZXcgTG9uZyhwYXJ0c1swXSksIGFkZHJz\nKTsKICAgICAgICAgICAgICAgIGxpbmUgPSByZWFkZXIucmVhZExpbmUoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbihlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxjOwogICAgfQoKICAg\nIC8qKgogICAgICogVXBkYXRlcyB0aGUgdmVyc2lvbiBvZiB0aGlzIG1ldGFk\nYXRhLgogICAgICogCiAgICAgKiBAcGFyYW0gdiBWZXJzaW9uCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHNldFZlcnNpb24oVmVyc2lvbiB2KSB7CiAgICAg\nICAgdGhpcy52ZXJzaW9uID0gdjsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybnMgdGhlIGxhc3QgdmVyc2lvbi4KICAgICAqIAogICAgICogQHJldHVy\nbiB2ZXJzaW9uCiAgICAgKi8KICAgIHB1YmxpYyBWZXJzaW9uIGdldFZlcnNp\nb24oKSB7CiAgICAgICAgcmV0dXJuIHRoaXMudmVyc2lvbjsKICAgIH0KCiAg\nICAvKioKICAgICAqIElzIHRoZSBtZXRhZGF0YSBuZXdlciB0aGF0IGdpdmVu\nIDxpPm5ld01ldGE8L2k+LgogICAgICoKICAgICAqIEBwYXJhbSBuZXdNZXRh\nCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIGJvb2xlYW4gaXNOZXdlclRo\nYW4oTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkgewogICAgICAgIGlmIChudWxs\nID09IHZlcnNpb24pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gVmVyc2lvbi5PY2N1cnJlZC5BRlRFUiA9\nPSB2ZXJzaW9uLmNvbXBhcmUobmV3TWV0YS52ZXJzaW9uKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIElzIHRoZSBtZXRhZGF0YSBjb25mbGljdCB3aXRoIG5l\ndyB1cGRhdGVkIG1ldGFkYXRhLgogICAgICoKICAgICAqIEBwYXJhbSBuZXdN\nZXRhCiAgICAgKiAgICAgICAgICBSZS1yZWFkIG1ldGFkYXRhCiAgICAgKiBA\ncmV0dXJuIHRydWUgaWYgdGhlIG1ldGFkYXRhIGlzIGNvbmZsaWN0LgogICAg\nICovCiAgICBib29sZWFuIGlzQ29uZmxpY3RXaXRoKExlZGdlck1ldGFkYXRh\nIG5ld01ldGEpIHsKICAgICAgICAvKgogICAgICAgICAqICBpZiBsZW5ndGgg\nJiBjbG9zZSBoYXZlIGNoYW5nZWQsIHRoZW4gYW5vdGhlciBjbGllbnQgaGFz\nCiAgICAgICAgICogIG9wZW5lZCB0aGUgbGVkZ2VyLCBjYW4ndCByZXNvbHZl\nIHRoaXMgY29uZmxpY3QuCiAgICAgICAgICovCgogICAgICAgIGlmIChtZXRh\nZGF0YUZvcm1hdFZlcnNpb24gIT0gbmV3TWV0YS5tZXRhZGF0YUZvcm1hdFZl\ncnNpb24gfHwKICAgICAgICAgICAgZW5zZW1ibGVTaXplICE9IG5ld01ldGEu\nZW5zZW1ibGVTaXplIHx8CiAgICAgICAgICAgIHdyaXRlUXVvcnVtU2l6ZSAh\nPSBuZXdNZXRhLndyaXRlUXVvcnVtU2l6ZSB8fAogICAgICAgICAgICBhY2tR\ndW9ydW1TaXplICE9IG5ld01ldGEuYWNrUXVvcnVtU2l6ZSB8fAogICAgICAg\nICAgICBsZW5ndGggIT0gbmV3TWV0YS5sZW5ndGggfHwKICAgICAgICAgICAg\nc3RhdGUgIT0gbmV3TWV0YS5zdGF0ZSB8fAogICAgICAgICAgICAhZGlnZXN0\nVHlwZS5lcXVhbHMobmV3TWV0YS5kaWdlc3RUeXBlKSB8fAogICAgICAgICAg\nICAhQXJyYXlzLmVxdWFscyhwYXNzd29yZCwgbmV3TWV0YS5wYXNzd29yZCkp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAg\nIGlmIChzdGF0ZSA9PSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZS5DTE9T\nRUQKICAgICAgICAgICAgJiYgbGFzdEVudHJ5SWQgIT0gbmV3TWV0YS5sYXN0\nRW50cnlJZCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCiAgICAgICAgLy8gaWYgbGVkZ2VyIGlzIGNsb3NlZCwgd2UgY2FuIGp1c3Qg\ndGFrZSB0aGUgbmV3IGVuc2VtYmxlcwogICAgICAgIGlmIChuZXdNZXRhLnN0\nYXRlICE9IExlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlLkNMT1NFRCkgewog\nICAgICAgICAgICAvLyBhbGxvdyBuZXcgbWV0YWRhdGEgdG8gYmUgb25lIGVu\nc2VtYmxlIGxlc3MgdGhhbiBjdXJyZW50IG1ldGFkYXRhCiAgICAgICAgICAg\nIC8vIHNpbmNlIGVuc2VtYmxlIGNoYW5nZSBtaWdodCBraWNrIGluIHdoZW4g\ncmVjb3ZlcnkgY2hhbmdlZCBtZXRhZGF0YQogICAgICAgICAgICBpbnQgZGlm\nZiA9IGVuc2VtYmxlcy5zaXplKCkgLSBuZXdNZXRhLmVuc2VtYmxlcy5zaXpl\nKCk7CiAgICAgICAgICAgIGlmICgwICE9IGRpZmYgJiYgMSAhPSBkaWZmKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAvLyBlbnNlbWJsZSBkaXN0cmlidXRpb24gc2hvdWxkIGJl\nIHNhbWUKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgY2hlY2sgdGhlIGRldGFp\nbCBlbnNlbWJsZSwgc2luY2UgbmV3IGJvb2tpZSB3aWxsIGJlIHNldAogICAg\nICAgICAgICAvLyB1c2luZyByZWNvdmVyeSB0b29sLgogICAgICAgICAgICBJ\ndGVyYXRvcjxMb25nPiBrZXlJdGVyID0gZW5zZW1ibGVzLmtleVNldCgpLml0\nZXJhdG9yKCk7CiAgICAgICAgICAgIEl0ZXJhdG9yPExvbmc+IG5ld01ldGFL\nZXlJdGVyID0gbmV3TWV0YS5lbnNlbWJsZXMua2V5U2V0KCkuaXRlcmF0b3Io\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaT0wOyBpPG5ld01ldGEuZW5zZW1i\nbGVzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICBMb25nIGN1cktl\neSA9IGtleUl0ZXIubmV4dCgpOwogICAgICAgICAgICAgICAgTG9uZyBuZXdN\nZXRhS2V5ID0gbmV3TWV0YUtleUl0ZXIubmV4dCgpOwogICAgICAgICAgICAg\nICAgaWYgKCFjdXJLZXkuZXF1YWxzKG5ld01ldGFLZXkpKSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFN0cmluZyB0b1N0cmlu\nZygpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1\naWxkZXIoKTsKICAgICAgICBzYi5hcHBlbmQoIihtZXRhOiIpLmFwcGVuZChu\nZXcgU3RyaW5nKHNlcmlhbGl6ZSgpLCBVVEZfOCkpLmFwcGVuZCgiLCB2ZXJz\naW9uOiIpLmFwcGVuZCh2ZXJzaW9uKS5hcHBlbmQoIikiKTsKICAgICAgICBy\nZXR1cm4gc2IudG9TdHJpbmcoKTsKICAgIH0KCiAgICB2b2lkIG1lcmdlRW5z\nZW1ibGVzKFNvcnRlZE1hcDxMb25nLCBBcnJheUxpc3Q8SW5ldFNvY2tldEFk\nZHJlc3M+PiBuZXdFbnNlbWJsZXMpIHsKICAgICAgICAvLyBhbGxvdyBuZXcg\nbWV0YWRhdGEgdG8gYmUgb25lIGVuc2VtYmxlIGxlc3MgdGhhbiBjdXJyZW50\nIG1ldGFkYXRhCiAgICAgICAgLy8gc2luY2UgZW5zZW1ibGUgY2hhbmdlIG1p\nZ2h0IGtpY2sgaW4gd2hlbiByZWNvdmVyeSBjaGFuZ2VkIG1ldGFkYXRhCiAg\nICAgICAgaW50IGRpZmYgPSBlbnNlbWJsZXMuc2l6ZSgpIC0gbmV3RW5zZW1i\nbGVzLnNpemUoKTsKICAgICAgICBpZiAoMCAhPSBkaWZmICYmIDEgIT0gZGlm\nZikgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlu\ndCBpID0gMDsKICAgICAgICBmb3IgKEVudHJ5PExvbmcsIEFycmF5TGlzdDxJ\nbmV0U29ja2V0QWRkcmVzcz4+IGVudHJ5IDogbmV3RW5zZW1ibGVzLmVudHJ5\nU2V0KCkpIHsKICAgICAgICAgICAgKytpOwogICAgICAgICAgICBpZiAoZW5z\nZW1ibGVzLnNpemUoKSAhPSBpKSB7CiAgICAgICAgICAgICAgICAvLyB3ZSBz\naG91bGQgdXNlIGxhc3QgZW5zZW1ibGUgZnJvbSBjdXJyZW50IG1ldGFkYXRh\nCiAgICAgICAgICAgICAgICAvLyBub3QgdGhlIG5ldyBtZXRhZGF0YSByZWFk\nIGZyb20gem9va2VlcGVyCiAgICAgICAgICAgICAgICBsb25nIGtleSA9IGVu\ndHJ5LmdldEtleSgpOwogICAgICAgICAgICAgICAgQXJyYXlMaXN0PEluZXRT\nb2NrZXRBZGRyZXNzPiBlbnNlbWJsZSA9IGVudHJ5LmdldFZhbHVlKCk7CiAg\nICAgICAgICAgICAgICBlbnNlbWJsZXMucHV0KGtleSwgZW5zZW1ibGUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

