{"sha":"3bc488564839744669aae3cc5f8b1ebd385525b3","node_id":"MDQ6QmxvYjE1NzU5NTY6M2JjNDg4NTY0ODM5NzQ0NjY5YWFlM2NjNWY4YjFlYmQzODU1MjViMw==","size":7269,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3bc488564839744669aae3cc5f8b1ebd385525b3","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKaW1wb3J0IGph\ndmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0\nIGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLkFkZENhbGxiYWNr\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVBy\nb3RvY29sOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNhbGxiYWNrOwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVyOwppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJG\nYWN0b3J5OwoKLyoqCiAqIFRoaXMgcmVwcmVzZW50cyBhIHBlbmRpbmcgYWRk\nIG9wZXJhdGlvbi4gV2hlbiBpdCBoYXMgZ290IHN1Y2Nlc3MgZnJvbSBhbGwK\nICogYm9va2llcywgaXQgc2VlcyBpZiBpdHMgYXQgdGhlIGhlYWQgb2YgdGhl\nIHBlbmRpbmcgYWRkcyBxdWV1ZSwgYW5kIGlmIHllcywKICogc2VuZHMgYWNr\nIGJhY2sgdG8gdGhlIGFwcGxpY2F0aW9uLiBJZiBhIGJvb2tpZSBmYWlscywg\nYSByZXBsYWNlbWVudCBpcyBtYWRlCiAqIGFuZCBwbGFjZWQgYXQgdGhlIHNh\nbWUgcG9zaXRpb24gaW4gdGhlIGVuc2VtYmxlLiBUaGUgcGVuZGluZyBhZGRz\nIGFyZSB0aGVuCiAqIHJlcmVwbGljYXRlZC4KICoKICoKICovCmNsYXNzIFBl\nbmRpbmdBZGRPcCBpbXBsZW1lbnRzIFdyaXRlQ2FsbGJhY2sgewogICAgZmlu\nYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihQZW5kaW5nQWRkT3AuY2xhc3MpOwoKICAgIENoYW5uZWxCdWZmZXIgdG9T\nZW5kOwogICAgQWRkQ2FsbGJhY2sgY2I7CiAgICBPYmplY3QgY3R4OwogICAg\nbG9uZyBlbnRyeUlkOwogICAgU2V0PEludGVnZXI+IHdyaXRlU2V0OwoKICAg\nIERpc3RyaWJ1dGlvblNjaGVkdWxlLkFja1NldCBhY2tTZXQ7CiAgICBib29s\nZWFuIGNvbXBsZXRlZCA9IGZhbHNlOwoKICAgIExlZGdlckhhbmRsZSBsaDsK\nICAgIGJvb2xlYW4gaXNSZWNvdmVyeUFkZCA9IGZhbHNlOwoKICAgIFBlbmRp\nbmdBZGRPcChMZWRnZXJIYW5kbGUgbGgsIEFkZENhbGxiYWNrIGNiLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgdGhpcy5saCA9IGxoOwogICAgICAgIHRoaXMu\nY2IgPSBjYjsKICAgICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICB0aGlz\nLmVudHJ5SWQgPSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9JRDsKICAg\nICAgICAKICAgICAgICBhY2tTZXQgPSBsaC5kaXN0cmlidXRpb25TY2hlZHVs\nZS5nZXRBY2tTZXQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuYWJsZSB0\naGUgcmVjb3ZlcnkgYWRkIGZsYWcgZm9yIHRoaXMgb3BlcmF0aW9uLgogICAg\nICogQHNlZSBMZWRnZXJIYW5kbGUjYXN5bmNSZWNvdmVyeUFkZEVudHJ5CiAg\nICAgKi8KICAgIFBlbmRpbmdBZGRPcCBlbmFibGVSZWNvdmVyeUFkZCgpIHsK\nICAgICAgICBpc1JlY292ZXJ5QWRkID0gdHJ1ZTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgIH0KCiAgICB2b2lkIHNldEVudHJ5SWQobG9uZyBlbnRyeUlk\nKSB7CiAgICAgICAgdGhpcy5lbnRyeUlkID0gZW50cnlJZDsKICAgICAgICB3\ncml0ZVNldCA9IG5ldyBIYXNoU2V0PEludGVnZXI+KGxoLmRpc3RyaWJ1dGlv\nblNjaGVkdWxlLmdldFdyaXRlU2V0KGVudHJ5SWQpKTsKICAgIH0KCiAgICB2\nb2lkIHNlbmRXcml0ZVJlcXVlc3QoaW50IGJvb2tpZUluZGV4KSB7CiAgICAg\nICAgaW50IGZsYWdzID0gaXNSZWNvdmVyeUFkZCA/IEJvb2tpZVByb3RvY29s\nLkZMQUdfUkVDT1ZFUllfQUREIDogQm9va2llUHJvdG9jb2wuRkxBR19OT05F\nOwoKICAgICAgICBsaC5iay5ib29raWVDbGllbnQuYWRkRW50cnkobGgubWV0\nYWRhdGEuY3VycmVudEVuc2VtYmxlLmdldChib29raWVJbmRleCksIGxoLmxl\nZGdlcklkLCBsaC5sZWRnZXJLZXksIGVudHJ5SWQsIHRvU2VuZCwKICAgICAg\nICAgICAgICAgIHRoaXMsIGJvb2tpZUluZGV4LCBmbGFncyk7CiAgICB9Cgog\nICAgdm9pZCB1bnNldFN1Y2Nlc3NBbmRTZW5kV3JpdGVSZXF1ZXN0KGludCBi\nb29raWVJbmRleCkgewogICAgICAgIGlmICh0b1NlbmQgPT0gbnVsbCkgewog\nICAgICAgICAgICAvLyB0aGlzIGFkZE9wIGhhc24ndCB5ZXQgaGFkIGl0cyBt\nYWMgY29tcHV0ZWQuIFdoZW4gdGhlIG1hYyBpcwogICAgICAgICAgICAvLyBj\nb21wdXRlZCwgaXRzIHdyaXRlIHJlcXVlc3RzIHdpbGwgYmUgc2VudCwgc28g\nbm8gbmVlZCB0byBzZW5kIGl0CiAgICAgICAgICAgIC8vIG5vdwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIFN1cHBvc2UgdGhh\ndCB1bnNldCBkb2Vzbid0IGhhcHBlbiBvbiB0aGUgd3JpdGUgc2V0IG9mIGFu\nIGVudHJ5LiBJbiB0aGlzCiAgICAgICAgLy8gY2FzZSB3ZSBkb24ndCBuZWVk\nIHRvIHJlc2VuZCB0aGUgd3JpdGUgcmVxdWVzdCB1cG9uIGFuIGVuc2VtYmxl\nIGNoYW5nZS4KICAgICAgICAvLyBXZSBkbyBuZWVkIHRvIGludm9rZSAjc2Vu\nZEFkZFN1Y2Nlc3NDYWxsYmFja3MoKSBmb3Igc3VjaCBlbnRyaWVzIGJlY2F1\nc2UKICAgICAgICAvLyB0aGV5IG1heSBoYXZlIGFscmVhZHkgY29tcGxldGVk\nLCBidXQgdGhleSBhcmUganVzdCB3YWl0aW5nIGZvciB0aGUgZW5zZW1ibGUK\nICAgICAgICAvLyB0byBjaGFuZ2UuCiAgICAgICAgLy8gRS5nLgogICAgICAg\nIC8vIGVuc2VtYmxlIChBLCBCLCBDLCBEKSwgZW50cnkgayBpcyB3cml0dGVu\nIHRvIChBLCBCLCBEKS4gQW4gZW5zZW1ibGUgY2hhbmdlCiAgICAgICAgLy8g\naGFwcGVucyB0byByZXBsYWNlIEMgd2l0aCBFLiBFbnRyeSBrIGRvZXMgbm90\nIGNvbXBsZXRlIHVudGlsIEMgaXMKICAgICAgICAvLyByZXBsYWNlZCB3aXRo\nIEUgc3VjY2Vzc2Z1bGx5LiBXaGVuIHRoZSBlbnNlbWJsZSBjaGFuZ2UgY29t\ncGxldGVzLCBpdCB0cmllcwogICAgICAgIC8vIHRvIHVuc2V0IGVudHJ5IGsu\nIEMgaG93ZXZlciBpcyBub3QgaW4gaydzIHdyaXRlIHNldCwgc28gbm8gZW50\ncnkgaXMgd3JpdHRlbgogICAgICAgIC8vIGFnYWluLCBhbmQgbm8gb25lIHRy\naWdnZXJzICNzZW5kQWRkU3VjY2Vzc0NhbGxiYWNrcy4gQ29uc2VxdWVudGx5\nLCBrIG5ldmVyCiAgICAgICAgLy8gY29tcGxldGVzLgogICAgICAgIC8vCiAg\nICAgICAgLy8gV2UgY2FsbCBzZW5kQWRkU3VjY2Vzc0NhbGxiYWNrIHdoZW4g\ndW5zZXR0aW5nIHQgY292ZXIgdGhpcyBjYXNlLgogICAgICAgIGlmICghd3Jp\ndGVTZXQuY29udGFpbnMoYm9va2llSW5kZXgpKSB7CiAgICAgICAgICAgIGxo\nLnNlbmRBZGRTdWNjZXNzQ2FsbGJhY2tzKCk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQo\nKSkgewogICAgICAgICAgICBMT0cuZGVidWcoIlVuc2V0dGluZyBzdWNjZXNz\nIGZvciBsZWRnZXI6ICIgKyBsaC5sZWRnZXJJZCArICIgZW50cnk6ICIgKyBl\nbnRyeUlkICsgIiBib29raWUgaW5kZXg6ICIKICAgICAgICAgICAgICAgICAg\nICAgICsgYm9va2llSW5kZXgpOwogICAgICAgIH0KCiAgICAgICAgLy8gaWYg\nd2UgaGFkIGFscmVhZHkgaGVhcmQgYSBzdWNjZXNzIGZyb20gdGhpcyBhcnJh\neSBpbmRleCwgbmVlZCB0bwogICAgICAgIC8vIGluY3JlbWVudCBvdXIgbnVt\nYmVyIG9mIHJlc3BvbnNlcyB0aGF0IGFyZSBwZW5kaW5nLCBzaW5jZSB3ZSBh\ncmUKICAgICAgICAvLyBnb2luZyB0byB1bnNldCB0aGlzIHN1Y2Nlc3MKICAg\nICAgICBhY2tTZXQucmVtb3ZlQm9va2llKGJvb2tpZUluZGV4KTsKICAgICAg\nICBjb21wbGV0ZWQgPSBmYWxzZTsKCiAgICAgICAgc2VuZFdyaXRlUmVxdWVz\ndChib29raWVJbmRleCk7CiAgICB9CgogICAgdm9pZCBpbml0aWF0ZShDaGFu\nbmVsQnVmZmVyIHRvU2VuZCkgewogICAgICAgIHRoaXMudG9TZW5kID0gdG9T\nZW5kOwogICAgICAgIGZvciAoaW50IGJvb2tpZUluZGV4IDogd3JpdGVTZXQp\nIHsKICAgICAgICAgICAgc2VuZFdyaXRlUmVxdWVzdChib29raWVJbmRleCk7\nCiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgd3JpdGVDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxvbmcg\nZW50cnlJZCwgSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgT2JqZWN0IGN0eCkg\newogICAgICAgIGludCBib29raWVJbmRleCA9IChJbnRlZ2VyKSBjdHg7Cgog\nICAgICAgIGlmIChjb21wbGV0ZWQpIHsKICAgICAgICAgICAgLy8gSSBhbSBh\nbHJlYWR5IGZpbmlzaGVkLCBpZ25vcmUgaW5jb21pbmcgcmVzcG9uc2VzLgog\nICAgICAgICAgICAvLyBvdGhlcndpc2UsIHdlIG1pZ2h0IGhpdCB0aGUgZm9s\nbG93aW5nIGVycm9yIGhhbmRsaW5nIGxvZ2ljLCB3aGljaCBtaWdodCBjYXVz\nZSBiYWQgdGhpbmdzLgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICBzd2l0Y2ggKHJjKSB7CiAgICAgICAgY2FzZSBCS0V4Y2VwdGlv\nbi5Db2RlLk9LOgogICAgICAgICAgICAvLyBjb250aW51ZQogICAgICAgICAg\nICBicmVhazsKICAgICAgICBjYXNlIEJLRXhjZXB0aW9uLkNvZGUuTGVkZ2Vy\nRmVuY2VkRXhjZXB0aW9uOgogICAgICAgICAgICBMT0cud2FybigiRmVuY2lu\nZyBleGNlcHRpb24gb24gd3JpdGU6IEx7fSBFe30gb24ge30iLAogICAgICAg\nICAgICAgICAgICAgICBuZXcgT2JqZWN0W10geyBsZWRnZXJJZCwgZW50cnlJ\nZCwgYWRkciB9KTsKICAgICAgICAgICAgbGguaGFuZGxlVW5yZWNvdmVyYWJs\nZUVycm9yRHVyaW5nQWRkKHJjKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIGNhc2UgQktFeGNlcHRpb24uQ29kZS5VbmF1dGhvcml6ZWRBY2Nlc3NF\neGNlcHRpb246CiAgICAgICAgICAgIExPRy53YXJuKCJVbmF1dGhvcml6ZWQg\nYWNjZXNzIGV4Y2VwdGlvbiBvbiB3cml0ZTogTHt9IEV7fSBvbiB7fSIsCiAg\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGxlZGdlcklkLCBl\nbnRyeUlkLCBhZGRyIH0pOwogICAgICAgICAgICBsaC5oYW5kbGVVbnJlY292\nZXJhYmxlRXJyb3JEdXJpbmdBZGQocmMpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgTE9HLndhcm4oIldyaXRl\nIGRpZCBub3Qgc3VjY2VlZDogTHt9IEV7fSBvbiB7fSIsCiAgICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGxlZGdlcklkLCBlbnRyeUlkLCBh\nZGRyIH0pOwogICAgICAgICAgICBsaC5oYW5kbGVCb29raWVGYWlsdXJlKGFk\nZHIsIGJvb2tpZUluZGV4KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKCF3cml0ZVNldC5jb250YWlucyhib29raWVJbmRl\neCkpIHsKICAgICAgICAgICAgTE9HLndhcm4oIlJlY2VpdmVkIGEgcmVzcG9u\nc2UgZm9yIChsaWQ6e30sIGVpZDp7fSkgZnJvbSB7fUB7fSwgYnV0IGl0IGRv\nZXNuJ3QgYmVsb25nIHRvIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXSB7IGxlZGdlcklkLCBlbnRyeUlkLCBhZGRyLCBib29raWVJ\nbmRleCwgd3JpdGVTZXQgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIGlmIChhY2tTZXQuYWRkQm9va2llQW5kQ2hlY2soYm9v\na2llSW5kZXgpICYmICFjb21wbGV0ZWQpIHsKICAgICAgICAgICAgY29tcGxl\ndGVkID0gdHJ1ZTsKCiAgICAgICAgICAgIExPRy5kZWJ1ZygiQ29tcGxldGUg\nKGxpZDp7fSwgZWlkOnt9KS4iLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAg\nICAgICAgIC8vIHdoZW4gY29tcGxldGVkIGFuIGVudHJ5LCB0cnkgdG8gc2Vu\nZCBzdWNjZXNzIGFkZCBjYWxsYmFja3MgaW4gb3JkZXIKICAgICAgICAgICAg\nbGguc2VuZEFkZFN1Y2Nlc3NDYWxsYmFja3MoKTsKICAgICAgICB9CiAgICB9\nCgogICAgdm9pZCBzdWJtaXRDYWxsYmFjayhmaW5hbCBpbnQgcmMpIHsKICAg\nICAgICBpZiAocmMgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAg\nICAgICBMT0cuZXJyb3IoIldyaXRlIG9mIGxlZGdlciBlbnRyeSB0byBxdW9y\ndW0gZmFpbGVkOiBMe30gRXt9IiwKICAgICAgICAgICAgICAgICAgICAgIGxo\nLmdldElkKCksIGVudHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgY2IuYWRk\nQ29tcGxldGUocmMsIGxoLCBlbnRyeUlkLCBjdHgpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAg\nICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAg\nICAgICBzYi5hcHBlbmQoIlBlbmRpbmdBZGRPcChsaWQ6IikuYXBwZW5kKGxo\nLmxlZGdlcklkKQogICAgICAgICAgLmFwcGVuZCgiLCBlaWQ6IikuYXBwZW5k\nKGVudHJ5SWQpLmFwcGVuZCgiLCBjb21wbGV0ZWQ6IikKICAgICAgICAgIC5h\ncHBlbmQoY29tcGxldGVkKS5hcHBlbmQoIikiKTsKICAgICAgICByZXR1cm4g\nc2IudG9TdHJpbmcoKTsKICAgIH0KCn0K\n","encoding":"base64"}

