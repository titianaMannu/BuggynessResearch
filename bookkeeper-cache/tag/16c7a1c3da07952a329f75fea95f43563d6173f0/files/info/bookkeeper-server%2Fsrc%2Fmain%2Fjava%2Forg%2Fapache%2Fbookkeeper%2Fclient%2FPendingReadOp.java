{"sha":"0f6ef3fc8ed0eaafe8448af43e3e83e933f18b1d","node_id":"MDQ6QmxvYjE1NzU5NTY6MGY2ZWYzZmM4ZWQwZWFhZmU4NDQ4YWY0M2UzZTgzZTkzM2YxOGIxZA==","size":14516,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0f6ef3fc8ed0eaafe8448af43e3e83e933f18b1d","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCmlt\ncG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEu\ndXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQml0U2V0OwppbXBv\ncnQgamF2YS51dGlsLkVudW1lcmF0aW9uOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5Ob1N1Y2hFbGVtZW50RXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLlF1\nZXVlOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZTsKaW1wb3J0IGphdmEudXRp\nbC5jb25jdXJyZW50LlNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxlZEZ1dHVyZTsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0Jvb2xlYW47CgppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJl\nYWRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQktFeGNlcHRpb24uQktEaWdlc3RNYXRjaEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJu\nYWxDYWxsYmFja3MuUmVhZEVudHJ5Q2FsbGJhY2s7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXJJbnB1dFN0cmVhbTsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2Vy\nRmFjdG9yeTsKCi8qKgogKiBTZXF1ZW5jZSBvZiBlbnRyaWVzIG9mIGEgbGVk\nZ2VyIHRoYXQgcmVwcmVzZW50cyBhIHBlbmRpbmcgcmVhZCBvcGVyYXRpb24u\nCiAqIFdoZW4gYWxsIHRoZSBkYXRhIHJlYWQgaGFzIGNvbWUgYmFjaywgdGhl\nIGFwcGxpY2F0aW9uIGNhbGxiYWNrIGlzIGNhbGxlZC4KICogVGhpcyBjbGFz\ncyBjb3VsZCBiZSBpbXByb3ZlZCBiZWNhdXNlIHdlIGNvdWxkIHN0YXJ0IHB1\nc2hpbmcgZGF0YSB0byB0aGUKICogYXBwbGljYXRpb24gYXMgc29vbiBhcyBp\ndCBhcnJpdmVzIHJhdGhlciB0aGFuIHdhaXRpbmcgZm9yIHRoZSB3aG9sZSB0\naGluZy4KICoKICovCmNsYXNzIFBlbmRpbmdSZWFkT3AgaW1wbGVtZW50cyBF\nbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4sIFJlYWRFbnRyeUNhbGxiYWNrIHsK\nICAgIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihQZW5k\naW5nUmVhZE9wLmNsYXNzKTsKCiAgICBmaW5hbCBpbnQgc3BlY3VsYXRpdmVS\nZWFkVGltZW91dDsKICAgIGZpbmFsIHByaXZhdGUgU2NoZWR1bGVkRXhlY3V0\nb3JTZXJ2aWNlIHNjaGVkdWxlcjsKICAgIHByaXZhdGUgU2NoZWR1bGVkRnV0\ndXJlPD8+IHNwZWN1bGF0aXZlVGFzayA9IG51bGw7CiAgICBRdWV1ZTxMZWRn\nZXJFbnRyeVJlcXVlc3Q+IHNlcTsKICAgIFNldDxJbmV0U29ja2V0QWRkcmVz\ncz4gaGVhcmRGcm9tSG9zdHM7CiAgICBSZWFkQ2FsbGJhY2sgY2I7CiAgICBP\nYmplY3QgY3R4OwogICAgTGVkZ2VySGFuZGxlIGxoOwogICAgbG9uZyBudW1Q\nZW5kaW5nRW50cmllczsKICAgIGxvbmcgc3RhcnRFbnRyeUlkOwogICAgbG9u\nZyBlbmRFbnRyeUlkOwogICAgZmluYWwgaW50IG1heE1pc3NlZFJlYWRzQWxs\nb3dlZDsKCiAgICBjbGFzcyBMZWRnZXJFbnRyeVJlcXVlc3QgZXh0ZW5kcyBM\nZWRnZXJFbnRyeSB7CiAgICAgICAgZmluYWwgc3RhdGljIGludCBOT1RfRk9V\nTkQgPSAtMTsKICAgICAgICBpbnQgbmV4dFJlcGxpY2FJbmRleFRvUmVhZEZy\nb20gPSAwOwogICAgICAgIEF0b21pY0Jvb2xlYW4gY29tcGxldGUgPSBuZXcg\nQXRvbWljQm9vbGVhbihmYWxzZSk7CgogICAgICAgIGludCBmaXJzdEVycm9y\nID0gQktFeGNlcHRpb24uQ29kZS5PSzsKICAgICAgICBpbnQgbnVtTWlzc2Vk\nRW50cnlSZWFkcyA9IDA7CgogICAgICAgIGZpbmFsIEFycmF5TGlzdDxJbmV0\nU29ja2V0QWRkcmVzcz4gZW5zZW1ibGU7CiAgICAgICAgZmluYWwgTGlzdDxJ\nbnRlZ2VyPiB3cml0ZVNldDsKICAgICAgICBmaW5hbCBCaXRTZXQgc2VudFJl\ncGxpY2FzOwogICAgICAgIGZpbmFsIEJpdFNldCBlcnJvcmVkUmVwbGljYXM7\nCgogICAgICAgIExlZGdlckVudHJ5UmVxdWVzdChBcnJheUxpc3Q8SW5ldFNv\nY2tldEFkZHJlc3M+IGVuc2VtYmxlLCBsb25nIGxJZCwgbG9uZyBlSWQpIHsK\nICAgICAgICAgICAgc3VwZXIobElkLCBlSWQpOwoKICAgICAgICAgICAgdGhp\ncy5lbnNlbWJsZSA9IGVuc2VtYmxlOwogICAgICAgICAgICB0aGlzLndyaXRl\nU2V0ID0gbGguZGlzdHJpYnV0aW9uU2NoZWR1bGUuZ2V0V3JpdGVTZXQoZW50\ncnlJZCk7CiAgICAgICAgICAgIHRoaXMuc2VudFJlcGxpY2FzID0gbmV3IEJp\ndFNldChsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldFdyaXRlUXVvcnVtU2l6\nZSgpKTsKICAgICAgICAgICAgdGhpcy5lcnJvcmVkUmVwbGljYXMgPSBuZXcg\nQml0U2V0KGxoLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0V3JpdGVRdW9ydW1T\naXplKCkpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBpbnQgZ2V0UmVw\nbGljYUluZGV4KEluZXRTb2NrZXRBZGRyZXNzIGhvc3QpIHsKICAgICAgICAg\nICAgaW50IGJvb2tpZUluZGV4ID0gZW5zZW1ibGUuaW5kZXhPZihob3N0KTsK\nICAgICAgICAgICAgaWYgKGJvb2tpZUluZGV4ID09IC0xKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gTk9UX0ZPVU5EOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB3cml0ZVNldC5pbmRleE9mKGJvb2tpZUluZGV4KTsK\nICAgICAgICB9CgogICAgICAgIHByaXZhdGUgQml0U2V0IGdldFNlbnRUb0Jp\ndFNldCgpIHsKICAgICAgICAgICAgQml0U2V0IGIgPSBuZXcgQml0U2V0KGVu\nc2VtYmxlLnNpemUoKSk7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHNlbnRSZXBsaWNhcy5sZW5ndGgoKTsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBpZiAoc2VudFJlcGxpY2FzLmdldChpKSkgewogICAgICAgICAgICAg\nICAgICAgIGIuc2V0KHdyaXRlU2V0LmdldChpKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAg\nICAgfQoKICAgICAgICBwcml2YXRlIEJpdFNldCBnZXRIZWFyZEZyb21CaXRT\nZXQoU2V0PEluZXRTb2NrZXRBZGRyZXNzPiBoZWFyZEZyb21Ib3N0cykgewog\nICAgICAgICAgICBCaXRTZXQgYiA9IG5ldyBCaXRTZXQoZW5zZW1ibGUuc2l6\nZSgpKTsKICAgICAgICAgICAgZm9yIChJbmV0U29ja2V0QWRkcmVzcyBpIDog\naGVhcmRGcm9tSG9zdHMpIHsKICAgICAgICAgICAgICAgIGludCBpbmRleCA9\nIGVuc2VtYmxlLmluZGV4T2YoaSk7CiAgICAgICAgICAgICAgICBpZiAoaW5k\nZXggIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBiLnNldChpbmRleCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIGI7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGJvb2xlYW4g\ncmVhZHNPdXRzdGFuZGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIChzZW50\nUmVwbGljYXMuY2FyZGluYWxpdHkoKSAtIGVycm9yZWRSZXBsaWNhcy5jYXJk\naW5hbGl0eSgpKSA+IDA7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBTZW5kIHRvIG5leHQgcmVwbGljYSBzcGVjdWxhdGl2ZWx5LCBpZiBy\nZXF1aXJlZCBhbmQgcG9zc2libGUuCiAgICAgICAgICogVGhpcyByZXR1cm5z\nIHRoZSBob3N0IHdlIG1heSBoYXZlIHNlbnQgdG8gZm9yIHVuaXQgdGVzdGlu\nZy4KICAgICAgICAgKiBAcmV0dXJuIGhvc3Qgd2Ugc2VudCB0byBpZiB3ZSBz\nZW50LiBudWxsIG90aGVyd2lzZS4KICAgICAgICAgKi8KICAgICAgICBzeW5j\naHJvbml6ZWQgSW5ldFNvY2tldEFkZHJlc3MgbWF5YmVTZW5kU3BlY3VsYXRp\ndmVSZWFkKFNldDxJbmV0U29ja2V0QWRkcmVzcz4gaGVhcmRGcm9tSG9zdHMp\nIHsKICAgICAgICAgICAgaWYgKG5leHRSZXBsaWNhSW5kZXhUb1JlYWRGcm9t\nID49IGdldExlZGdlck1ldGFkYXRhKCkuZ2V0V3JpdGVRdW9ydW1TaXplKCkp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBCaXRTZXQgc2VudFRvID0gZ2V0U2VudFRvQml0U2V0\nKCk7CiAgICAgICAgICAgIEJpdFNldCBoZWFyZEZyb20gPSBnZXRIZWFyZEZy\nb21CaXRTZXQoaGVhcmRGcm9tSG9zdHMpOwogICAgICAgICAgICBzZW50VG8u\nYW5kKGhlYXJkRnJvbSk7CgogICAgICAgICAgICAvLyBvbmx5IHNlbmQgYW5v\ndGhlciByZWFkLCBpZiB3ZSBoYXZlIGhhZCBubyByZXNwb25zZSBhdCBhbGwg\nKGV2ZW4gZm9yIG90aGVyIGVudHJpZXMpCiAgICAgICAgICAgIC8vIGZyb20g\nYW55IG9mIHRoZSBvdGhlciBib29raWVzIHdlIGhhdmUgc2VudCB0aGUgcmVx\ndWVzdCB0bwogICAgICAgICAgICBpZiAoc2VudFRvLmNhcmRpbmFsaXR5KCkg\nPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbmROZXh0UmVhZCgp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN5bmNo\ncm9uaXplZCBJbmV0U29ja2V0QWRkcmVzcyBzZW5kTmV4dFJlYWQoKSB7CiAg\nICAgICAgICAgIGlmIChuZXh0UmVwbGljYUluZGV4VG9SZWFkRnJvbSA+PSBn\nZXRMZWRnZXJNZXRhZGF0YSgpLmdldFdyaXRlUXVvcnVtU2l6ZSgpKSB7CiAg\nICAgICAgICAgICAgICAvLyB3ZSBhcmUgZG9uZSwgdGhlIHJlYWQgaGFzIGZh\naWxlZCBmcm9tIGFsbCByZXBsaWNhcywganVzdCBmYWlsIHRoZQogICAgICAg\nICAgICAgICAgLy8gcmVhZAoKICAgICAgICAgICAgICAgIC8vIERvIGl0IGEg\nYml0IHBlc3NpbWlzdGljYWxseSwgb25seSB3aGVuIGZpbmlzaGVkIHRyeWlu\nZyBhbGwgcmVwbGljYXMKICAgICAgICAgICAgICAgIC8vIHRvIGNoZWNrIHdo\nZXRoZXIgd2UgcmVjZWl2ZWQgbW9yZSBtaXNzZWQgcmVhZHMgdGhhbiBtYXhN\naXNzZWRSZWFkc0FsbG93ZWQKICAgICAgICAgICAgICAgIGlmIChCS0V4Y2Vw\ndGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2YWlsYWJsZUV4Y2VwdGlvbiA9\nPSBmaXJzdEVycm9yICYmCiAgICAgICAgICAgICAgICAgICAgbnVtTWlzc2Vk\nRW50cnlSZWFkcyA+IG1heE1pc3NlZFJlYWRzQWxsb3dlZCkgewogICAgICAg\nICAgICAgICAgICAgIGZpcnN0RXJyb3IgPSBCS0V4Y2VwdGlvbi5Db2RlLk5v\nU3VjaEVudHJ5RXhjZXB0aW9uOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIHN1Ym1pdENhbGxiYWNrKGZpcnN0RXJyb3IpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGludCByZXBsaWNhID0gbmV4dFJlcGxpY2FJbmRleFRvUmVhZEZyb207\nCiAgICAgICAgICAgIGludCBib29raWVJbmRleCA9IGxoLmRpc3RyaWJ1dGlv\nblNjaGVkdWxlLmdldFdyaXRlU2V0KGVudHJ5SWQpLmdldChuZXh0UmVwbGlj\nYUluZGV4VG9SZWFkRnJvbSk7CiAgICAgICAgICAgIG5leHRSZXBsaWNhSW5k\nZXhUb1JlYWRGcm9tKys7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgSW5ldFNvY2tldEFkZHJlc3MgdG8gPSBlbnNlbWJsZS5nZXQoYm9v\na2llSW5kZXgpOwogICAgICAgICAgICAgICAgc2VuZFJlYWRUbyh0bywgdGhp\ncyk7CiAgICAgICAgICAgICAgICBzZW50UmVwbGljYXMuc2V0KHJlcGxpY2Ep\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHRvOwogICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJJbnRlcnJ1cHRlZCByZWFkaW5nIGVudHJ5ICIgKyB0\naGlzLCBpZSk7CiAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVh\nZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgc3VibWl0Q2FsbGJh\nY2soQktFeGNlcHRpb24uQ29kZS5SZWFkRXhjZXB0aW9uKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBzeW5jaHJvbml6ZWQgdm9pZCBsb2dFcnJvckFuZFJlYXR0ZW1w\ndFJlYWQoSW5ldFNvY2tldEFkZHJlc3MgaG9zdCwgU3RyaW5nIGVyck1zZywg\naW50IHJjKSB7CiAgICAgICAgICAgIGlmIChCS0V4Y2VwdGlvbi5Db2RlLk9L\nID09IGZpcnN0RXJyb3IgfHwKICAgICAgICAgICAgICAgIEJLRXhjZXB0aW9u\nLkNvZGUuTm9TdWNoRW50cnlFeGNlcHRpb24gPT0gZmlyc3RFcnJvcikgewog\nICAgICAgICAgICAgICAgZmlyc3RFcnJvciA9IHJjOwogICAgICAgICAgICB9\nIGVsc2UgaWYgKEJLRXhjZXB0aW9uLkNvZGUuQm9va2llSGFuZGxlTm90QXZh\naWxhYmxlRXhjZXB0aW9uID09IGZpcnN0RXJyb3IgJiYKICAgICAgICAgICAg\nICAgICAgICAgICBCS0V4Y2VwdGlvbi5Db2RlLk5vU3VjaEVudHJ5RXhjZXB0\naW9uICE9IHJjKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBvdGhlciBleGNl\ncHRpb24gcmF0aGVyIHRoYW4gTm9TdWNoRW50cnlFeGNlcHRpb24gaXMgcmV0\ndXJuZWQKICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgdG8gdXBkYXRlIGZp\ncnN0RXJyb3IgdG8gaW5kaWNhdGUgdGhhdCBpdCBtaWdodCBiZSBhIHZhbGlk\nIHJlYWQgYnV0IGp1c3QgZmFpbGVkLgogICAgICAgICAgICAgICAgZmlyc3RF\ncnJvciA9IHJjOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChCS0V4\nY2VwdGlvbi5Db2RlLk5vU3VjaEVudHJ5RXhjZXB0aW9uID09IHJjKSB7CiAg\nICAgICAgICAgICAgICArK251bU1pc3NlZEVudHJ5UmVhZHM7CiAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIk5vIHN1Y2ggZW50cnkgZm91bmQgb24gYm9v\na2llLiAgTHt9IEV7fSBib29raWU6IHt9IiwKICAgICAgICAgICAgICAgICAg\nICAgICAgbmV3IE9iamVjdFtdIHsgbGgubGVkZ2VySWQsIGVudHJ5SWQsIGhv\nc3QgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoZXJyTXNnICsgIiB3aGlsZSByZWFkaW5nIEx7fSBFe30gZnJv\nbSBib29raWU6IHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W10geyBsaC5sZWRnZXJJZCwgZW50cnlJZCwgaG9zdCB9KTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgaW50IHJlcGxpY2EgPSBnZXRSZXBs\naWNhSW5kZXgoaG9zdCk7CiAgICAgICAgICAgIGlmIChyZXBsaWNhID09IE5P\nVF9GT1VORCkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJSZWNlaXZl\nZCBlcnJvciBmcm9tIGEgaG9zdCB3aGljaCBpcyBub3QgaW4gdGhlIGVuc2Vt\nYmxlIHt9IHt9LiIsIGhvc3QsIGVuc2VtYmxlKTsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvcmVkUmVw\nbGljYXMuc2V0KHJlcGxpY2EpOwoKICAgICAgICAgICAgaWYgKCFyZWFkc091\ndHN0YW5kaW5nKCkpIHsKICAgICAgICAgICAgICAgIHNlbmROZXh0UmVhZCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyByZXR1cm4g\ndHJ1ZSBpZiB3ZSBtYW5hZ2VkIHRvIGNvbXBsZXRlIHRoZSBlbnRyeQogICAg\nICAgIC8vIHJldHVybiBmYWxzZSBpZiB0aGUgcmVhZCBlbnRyeSBpcyBub3Qg\nY29tcGxldGUgb3IgaXQgaXMgYWxyZWFkeSBjb21wbGV0ZWQgYmVmb3JlCiAg\nICAgICAgYm9vbGVhbiBjb21wbGV0ZShJbmV0U29ja2V0QWRkcmVzcyBob3N0\nLCBmaW5hbCBDaGFubmVsQnVmZmVyIGJ1ZmZlcikgewogICAgICAgICAgICBD\naGFubmVsQnVmZmVySW5wdXRTdHJlYW0gaXM7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBpcyA9IGxoLm1hY01hbmFnZXIudmVyaWZ5RGln\nZXN0QW5kUmV0dXJuRGF0YShlbnRyeUlkLCBidWZmZXIpOwogICAgICAgICAg\nICB9IGNhdGNoIChCS0RpZ2VzdE1hdGNoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIGxvZ0Vycm9yQW5kUmVhdHRlbXB0UmVhZChob3N0LCAiTWFj\nIG1pc21hdGNoIiwgQktFeGNlcHRpb24uQ29kZS5EaWdlc3RNYXRjaEV4Y2Vw\ndGlvbik7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGlmICghY29tcGxldGUuZ2V0QW5kU2V0KHRy\ndWUpKSB7CiAgICAgICAgICAgICAgICBlbnRyeURhdGFTdHJlYW0gPSBpczsK\nCiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICogVGhlIGxl\nbmd0aCBpcyBhIGxvbmcgYW5kIGl0IGlzIHRoZSBsYXN0IGZpZWxkIG9mIHRo\nZSBtZXRhZGF0YSBvZiBhbiBlbnRyeS4KICAgICAgICAgICAgICAgICAqIENv\nbnNlcXVlbnRseSwgd2UgaGF2ZSB0byBzdWJ0cmFjdCA4IGZyb20gTUVUQURB\nVEFfTEVOR1RIIHRvIGdldCB0aGUgbGVuZ3RoLgogICAgICAgICAgICAgICAg\nICovCiAgICAgICAgICAgICAgICBsZW5ndGggPSBidWZmZXIuZ2V0TG9uZyhE\naWdlc3RNYW5hZ2VyLk1FVEFEQVRBX0xFTkdUSCAtIDgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIGJvb2xlYW4gaXNDb21wbGV0ZSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGNvbXBsZXRlLmdldCgpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJu\nIFN0cmluZy5mb3JtYXQoIkwlZC1FJWQiLCBsZWRnZXJJZCwgZW50cnlJZCk7\nCiAgICAgICAgfQogICAgfQoKICAgIFBlbmRpbmdSZWFkT3AoTGVkZ2VySGFu\nZGxlIGxoLCBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1bGVyLAog\nICAgICAgICAgICAgICAgICBsb25nIHN0YXJ0RW50cnlJZCwgbG9uZyBlbmRF\nbnRyeUlkLCBSZWFkQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgpIHsKICAgICAg\nICBzZXEgPSBuZXcgQXJyYXlCbG9ja2luZ1F1ZXVlPExlZGdlckVudHJ5UmVx\ndWVzdD4oKGludCkgKChlbmRFbnRyeUlkICsgMSkgLSBzdGFydEVudHJ5SWQp\nKTsKICAgICAgICB0aGlzLmNiID0gY2I7CiAgICAgICAgdGhpcy5jdHggPSBj\ndHg7CiAgICAgICAgdGhpcy5saCA9IGxoOwogICAgICAgIHRoaXMuc3RhcnRF\nbnRyeUlkID0gc3RhcnRFbnRyeUlkOwogICAgICAgIHRoaXMuZW5kRW50cnlJ\nZCA9IGVuZEVudHJ5SWQ7CiAgICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hl\nZHVsZXI7CiAgICAgICAgbnVtUGVuZGluZ0VudHJpZXMgPSBlbmRFbnRyeUlk\nIC0gc3RhcnRFbnRyeUlkICsgMTsKICAgICAgICBtYXhNaXNzZWRSZWFkc0Fs\nbG93ZWQgPSBnZXRMZWRnZXJNZXRhZGF0YSgpLmdldFdyaXRlUXVvcnVtU2l6\nZSgpCiAgICAgICAgICAgICAgICAtIGdldExlZGdlck1ldGFkYXRhKCkuZ2V0\nQWNrUXVvcnVtU2l6ZSgpOwogICAgICAgIHNwZWN1bGF0aXZlUmVhZFRpbWVv\ndXQgPSBsaC5iay5nZXRDb25mKCkuZ2V0U3BlY3VsYXRpdmVSZWFkVGltZW91\ndCgpOwogICAgICAgIGhlYXJkRnJvbUhvc3RzID0gbmV3IEhhc2hTZXQ8SW5l\ndFNvY2tldEFkZHJlc3M+KCk7CiAgICB9CgogICAgcHJvdGVjdGVkIExlZGdl\nck1ldGFkYXRhIGdldExlZGdlck1ldGFkYXRhKCkgewogICAgICAgIHJldHVy\nbiBsaC5tZXRhZGF0YTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbml0aWF0\nZSgpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgbG9u\nZyBuZXh0RW5zZW1ibGVDaGFuZ2UgPSBzdGFydEVudHJ5SWQsIGkgPSBzdGFy\ndEVudHJ5SWQ7CgogICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVz\ncz4gZW5zZW1ibGUgPSBudWxsOwoKICAgICAgICBpZiAoc3BlY3VsYXRpdmVS\nZWFkVGltZW91dCA+IDApIHsKICAgICAgICAgICAgc3BlY3VsYXRpdmVUYXNr\nID0gc2NoZWR1bGVyLnNjaGVkdWxlV2l0aEZpeGVkRGVsYXkobmV3IFJ1bm5h\nYmxlKCkgewogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW50IHggPSAwOwogICAgICAg\nICAgICAgICAgICAgICAgICBmb3IgKExlZGdlckVudHJ5UmVxdWVzdCByIDog\nc2VxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXIuaXND\nb21wbGV0ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKG51bGwgIT0gci5tYXliZVNlbmRTcGVjdWxhdGl2ZVJlYWQoaGVhcmRG\ncm9tSG9zdHMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy5kZWJ1ZygiU2VuZCBzcGVjdWxhdGl2ZSByZWFkIGZvciB7fS4g\nSG9zdHMgaGVhcmQgYXJlIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByLCBoZWFyZEZyb21Ib3N0cyk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsreDsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHggPiAwKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cuZGVidWcoIlNlbmQge30gc3BlY3VsYXRpdmUg\ncmVhZHMgZm9yIGxlZGdlciB7fSAoe30sIHt9KS4gSG9zdHMgaGVhcmQgYXJl\nIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbmV3IE9iamVjdFtdIHsgeCwgbGguZ2V0SWQoKSwgc3RhcnRFbnRyeUlkLCBl\nbmRFbnRyeUlkLCBoZWFyZEZyb21Ib3N0cyB9KTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0sIHNwZWN1bGF0aXZlUmVhZFRpbWVvdXQsIHNwZWN1bGF0aXZlUmVh\nZFRpbWVvdXQsIFRpbWVVbml0Lk1JTExJU0VDT05EUyk7CiAgICAgICAgfQoK\nICAgICAgICBkbyB7CiAgICAgICAgICAgIGlmIChpID09IG5leHRFbnNlbWJs\nZUNoYW5nZSkgewogICAgICAgICAgICAgICAgZW5zZW1ibGUgPSBnZXRMZWRn\nZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlKGkpOwogICAgICAgICAgICAgICAg\nbmV4dEVuc2VtYmxlQ2hhbmdlID0gZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRO\nZXh0RW5zZW1ibGVDaGFuZ2UoaSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgTGVkZ2VyRW50cnlSZXF1ZXN0IGVudHJ5ID0gbmV3IExlZGdlckVudHJ5\nUmVxdWVzdChlbnNlbWJsZSwgbGgubGVkZ2VySWQsIGkpOwogICAgICAgICAg\nICBzZXEuYWRkKGVudHJ5KTsKICAgICAgICAgICAgaSsrOwoKICAgICAgICAg\nICAgZW50cnkuc2VuZE5leHRSZWFkKCk7CiAgICAgICAgfSB3aGlsZSAoaSA8\nPSBlbmRFbnRyeUlkKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBjbGFz\ncyBSZWFkQ29udGV4dCB7CiAgICAgICAgZmluYWwgSW5ldFNvY2tldEFkZHJl\nc3MgdG87CiAgICAgICAgZmluYWwgTGVkZ2VyRW50cnlSZXF1ZXN0IGVudHJ5\nOwoKICAgICAgICBSZWFkQ29udGV4dChJbmV0U29ja2V0QWRkcmVzcyB0bywg\nTGVkZ2VyRW50cnlSZXF1ZXN0IGVudHJ5KSB7CiAgICAgICAgICAgIHRoaXMu\ndG8gPSB0bzsKICAgICAgICAgICAgdGhpcy5lbnRyeSA9IGVudHJ5OwogICAg\nICAgIH0KICAgIH0KCiAgICB2b2lkIHNlbmRSZWFkVG8oSW5ldFNvY2tldEFk\nZHJlc3MgdG8sIExlZGdlckVudHJ5UmVxdWVzdCBlbnRyeSkgdGhyb3dzIElu\ndGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBsaC50aHJvdHRsZXIuYWNx\ndWlyZSgpOwoKICAgICAgICBsaC5iay5ib29raWVDbGllbnQucmVhZEVudHJ5\nKHRvLCBsaC5sZWRnZXJJZCwgZW50cnkuZW50cnlJZCwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLCBuZXcgUmVhZENvbnRl\neHQodG8sIGVudHJ5KSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCByZWFkRW50cnlDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2Vy\nSWQsIGZpbmFsIGxvbmcgZW50cnlJZCwgZmluYWwgQ2hhbm5lbEJ1ZmZlciBi\ndWZmZXIsIE9iamVjdCBjdHgpIHsKICAgICAgICBmaW5hbCBSZWFkQ29udGV4\ndCByY3R4ID0gKFJlYWRDb250ZXh0KWN0eDsKICAgICAgICBmaW5hbCBMZWRn\nZXJFbnRyeVJlcXVlc3QgZW50cnkgPSByY3R4LmVudHJ5OwoKICAgICAgICBp\nZiAocmMgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICBl\nbnRyeS5sb2dFcnJvckFuZFJlYXR0ZW1wdFJlYWQocmN0eC50bywgIkVycm9y\nOiAiICsgQktFeGNlcHRpb24uZ2V0TWVzc2FnZShyYyksIHJjKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaGVhcmRGcm9tSG9z\ndHMuYWRkKHJjdHgudG8pOwoKICAgICAgICBpZiAoZW50cnkuY29tcGxldGUo\ncmN0eC50bywgYnVmZmVyKSkgewogICAgICAgICAgICBudW1QZW5kaW5nRW50\ncmllcy0tOwogICAgICAgICAgICBpZiAobnVtUGVuZGluZ0VudHJpZXMgPT0g\nMCkgewogICAgICAgICAgICAgICAgc3VibWl0Q2FsbGJhY2soQktFeGNlcHRp\nb24uQ29kZS5PSyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIGlmKG51bVBlbmRpbmdFbnRyaWVzIDwgMCkKICAgICAgICAgICAgTE9HLmVy\ncm9yKCJSZWFkIHRvbyBtYW55IHZhbHVlcyIpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBzdWJtaXRDYWxsYmFjayhpbnQgY29kZSkgewogICAgICAgIGlm\nIChzcGVjdWxhdGl2ZVRhc2sgIT0gbnVsbCkgewogICAgICAgICAgICBzcGVj\ndWxhdGl2ZVRhc2suY2FuY2VsKHRydWUpOwogICAgICAgICAgICBzcGVjdWxh\ndGl2ZVRhc2sgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoY29kZSAh\nPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgIGxvbmcgZmly\nc3RVbnJlYWQgPSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9JRDsKICAg\nICAgICAgICAgZm9yIChMZWRnZXJFbnRyeVJlcXVlc3QgcmVxIDogc2VxKSB7\nCiAgICAgICAgICAgICAgICBpZiAoIXJlcS5pc0NvbXBsZXRlKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBmaXJzdFVucmVhZCA9IHJlcS5nZXRFbnRyeUlk\nKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTE9HLmVycm9yKCJSZWFk\nIG9mIGxlZGdlciBlbnRyeSBmYWlsZWQ6IEx7fSBFe30tRXt9LCBIZWFyZCBm\ncm9tIHt9LiBGaXJzdCB1bnJlYWQgZW50cnkgaXMge30iLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGxoLmdldElkKCksIHN0YXJ0RW50\ncnlJZCwgZW5kRW50cnlJZCwgaGVhcmRGcm9tSG9zdHMsIGZpcnN0VW5yZWFk\nIH0pOwogICAgICAgIH0KICAgICAgICBjYi5yZWFkQ29tcGxldGUoY29kZSwg\nbGgsIFBlbmRpbmdSZWFkT3AudGhpcywgUGVuZGluZ1JlYWRPcC50aGlzLmN0\neCk7CiAgICB9CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNNb3JlRWxlbWVudHMo\nKSB7CiAgICAgICAgcmV0dXJuICFzZXEuaXNFbXB0eSgpOwogICAgfQoKICAg\nIHB1YmxpYyBMZWRnZXJFbnRyeSBuZXh0RWxlbWVudCgpIHRocm93cyBOb1N1\nY2hFbGVtZW50RXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gc2VxLnJlbW92\nZSgpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgc2l6ZSgpIHsKICAgICAgICBy\nZXR1cm4gc2VxLnNpemUoKTsKICAgIH0KfQo=\n","encoding":"base64"}

