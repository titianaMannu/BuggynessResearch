{"sha":"1dd719163ba0a7cbf09a0d6b691d280c32827c1b","node_id":"MDQ6QmxvYjE1NzU5NTY6MWRkNzE5MTYzYmEwYTdjYmYwOWEwZDZiNjkxZDI4MGMzMjgyN2MxYg==","size":20354,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1dd719163ba0a7cbf09a0d6b691d280c32827c1b","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBq\nYXZhLm5pby5jaGFubmVscy5DYW5jZWxsZWRLZXlFeGNlcHRpb247CmltcG9y\ndCBqYXZhLm5pby5jaGFubmVscy5DaGFubmVsOwppbXBvcnQgamF2YS5uaW8u\nY2hhbm5lbHMuU2VsZWN0aW9uS2V5OwppbXBvcnQgamF2YS5uaW8uY2hhbm5l\nbHMuU2VsZWN0b3I7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5TZXJ2ZXJT\nb2NrZXRDaGFubmVsOwppbXBvcnQgamF2YS5uaW8uY2hhbm5lbHMuU29ja2V0\nQ2hhbm5lbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNl\ndDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5MaW5rZWRCbG9j\na2luZ1F1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWlj\nLkF0b21pY0Jvb2xlYW47CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmJvb2tpZS5Cb29raWU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwoKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9y\ndCBjb20uZ29vZ2xlLmNvbW1vbi5hbm5vdGF0aW9ucy5WaXNpYmxlRm9yVGVz\ndGluZzsKCi8qKgogKiBUaGlzIGNsYXNzIGhhbmRsZXMgY29tbXVuaWNhdGlv\nbiB3aXRoIGNsaWVudHMgdXNpbmcgTklPLiBUaGVyZSBpcyBvbmUgQ254bgog\nKiBwZXIgY2xpZW50LCBidXQgb25seSBvbmUgdGhyZWFkIGRvaW5nIHRoZSBj\nb21tdW5pY2F0aW9uLgogKi8KcHVibGljIGNsYXNzIE5JT1NlcnZlckZhY3Rv\ncnkgZXh0ZW5kcyBUaHJlYWQgewoKICAgIHB1YmxpYyBpbnRlcmZhY2UgUGFj\na2V0UHJvY2Vzc29yIHsKICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUGFj\na2V0KEJ5dGVCdWZmZXIgcGFja2V0LCBDbnhuIHNyYyk7CiAgICB9CgogICAg\nU2VydmVyU3RhdHMgc3RhdHMgPSBuZXcgU2VydmVyU3RhdHMoKTsKCiAgICBM\nb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTklPU2VydmVy\nRmFjdG9yeS5jbGFzcyk7CgogICAgU2VydmVyU29ja2V0Q2hhbm5lbCBzczsK\nCiAgICBTZWxlY3RvciBzZWxlY3RvciA9IFNlbGVjdG9yLm9wZW4oKTsKCiAg\nICAvKioKICAgICAqIFdlIHVzZSB0aGlzIGJ1ZmZlciB0byBkbyBlZmZpY2ll\nbnQgc29ja2V0IEkvTy4gU2luY2UgdGhlcmUgaXMgYSBzaW5nbGUKICAgICAq\nIHNlbmRlciB0aHJlYWQgcGVyIE5JT1NlcnZlckNueG4gaW5zdGFuY2UsIHdl\nIGNhbiB1c2UgYSBtZW1iZXIgdmFyaWFibGUgdG8KICAgICAqIG9ubHkgYWxs\nb2NhdGUgaXQgb25jZS4KICAgICAqLwogICAgQnl0ZUJ1ZmZlciBkaXJlY3RC\ndWZmZXIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlRGlyZWN0KDY0ICogMTAyNCk7\nCgogICAgSGFzaFNldDxDbnhuPiBjbnhucyA9IG5ldyBIYXNoU2V0PENueG4+\nKCk7CgogICAgaW50IG91dHN0YW5kaW5nTGltaXQgPSAyMDAwOwoKICAgIFBh\nY2tldFByb2Nlc3NvciBwcm9jZXNzb3I7CgogICAgbG9uZyBtaW5MYXRlbmN5\nID0gOTk5OTk5OTk7CgogICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwoK\nICAgIHByaXZhdGUgQXRvbWljQm9vbGVhbiBjcmFzaGVkID0gbmV3IEF0b21p\nY0Jvb2xlYW4oZmFsc2UpOwogICAgcHJpdmF0ZSBPYmplY3Qgc3VzcGVuc2lv\nbkxvY2sgPSBuZXcgT2JqZWN0KCk7CiAgICBwcml2YXRlIGJvb2xlYW4gc3Vz\ncGVuZGVkID0gZmFsc2U7CgogICAgcHVibGljIE5JT1NlcnZlckZhY3Rvcnko\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mLCBQYWNrZXRQcm9jZXNzb3IgcHJv\nY2Vzc29yKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHN1cGVyKCJO\nSU9TZXJ2ZXJGYWN0b3J5LSIgKyBjb25mLmdldEJvb2tpZVBvcnQoKSk7CiAg\nICAgICAgc2V0RGFlbW9uKHRydWUpOwogICAgICAgIHRoaXMucHJvY2Vzc29y\nID0gcHJvY2Vzc29yOwogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAg\nICAgdGhpcy5zcyA9IFNlcnZlclNvY2tldENoYW5uZWwub3BlbigpOwogICAg\nICAgIGlmIChjb25mLmdldExpc3RlbmluZ0ludGVyZmFjZSgpID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gbGlzdGVuIG9uIGFsbCBpbnRlcmZhY2VzCiAg\nICAgICAgICAgIHNzLnNvY2tldCgpLmJpbmQobmV3IEluZXRTb2NrZXRBZGRy\nZXNzKGNvbmYuZ2V0Qm9va2llUG9ydCgpKSk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgc3Muc29ja2V0KCkuYmluZChCb29raWUuZ2V0Qm9va2ll\nQWRkcmVzcyhjb25mKSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHNz\nLmNvbmZpZ3VyZUJsb2NraW5nKGZhbHNlKTsKICAgICAgICBzcy5yZWdpc3Rl\ncihzZWxlY3RvciwgU2VsZWN0aW9uS2V5Lk9QX0FDQ0VQVCk7CiAgICB9Cgog\nICAgcHVibGljIEluZXRTb2NrZXRBZGRyZXNzIGdldExvY2FsQWRkcmVzcygp\nIHsKICAgICAgICByZXR1cm4gKEluZXRTb2NrZXRBZGRyZXNzKSBzcy5zb2Nr\nZXQoKS5nZXRMb2NhbFNvY2tldEFkZHJlc3MoKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgYWRkQ254bihDbnhuIGNueG4pIHsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKGNueG5zKSB7CiAgICAgICAgICAgIGNueG5zLmFkZChjbnhuKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNSdW5uaW5n\nKCkgewogICAgICAgIHJldHVybiAhc3Muc29ja2V0KCkuaXNDbG9zZWQoKSAm\nJiBpc0FsaXZlKCk7CiAgICB9CgogICAgYm9vbGVhbiBoYXNDcmFzaGVkKCkg\newogICAgICAgIHJldHVybiBjcmFzaGVkLmdldCgpOwogICAgfQoKICAgIC8q\nKgogICAgICogU3RvcCBuaW8gc2VydmVyIGZyb20gcHJvY2Vzc2luZyByZXF1\nZXN0cy4gKGZvciB0ZXN0aW5nKQogICAgICovCiAgICBAVmlzaWJsZUZvclRl\nc3RpbmcKICAgIHB1YmxpYyB2b2lkIHN1c3BlbmRQcm9jZXNzaW5nKCkgewog\nICAgICAgIHN5bmNocm9uaXplZChzdXNwZW5zaW9uTG9jaykgewogICAgICAg\nICAgICBzdXNwZW5kZWQgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlc3VtZSBwcm9jZXNzaW5nIHJlcXVlc3RzIGluIG5pbyBz\nZXJ2ZXIuIChmb3IgdGVzdGluZykKICAgICAqLwogICAgQFZpc2libGVGb3JU\nZXN0aW5nCiAgICBwdWJsaWMgdm9pZCByZXN1bWVQcm9jZXNzaW5nKCkgewog\nICAgICAgIHN5bmNocm9uaXplZChzdXNwZW5zaW9uTG9jaykgewogICAgICAg\nICAgICBzdXNwZW5kZWQgPSBmYWxzZTsKICAgICAgICAgICAgc3VzcGVuc2lv\nbkxvY2subm90aWZ5KCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIHdoaWxlICghc3Mu\nc29ja2V0KCkuaXNDbG9zZWQoKSkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgc2VsZWN0b3Iuc2VsZWN0KDEwMDApOwogICAgICAgICAg\nICAgICAgc3luY2hyb25pemVkKHN1c3BlbnNpb25Mb2NrKSB7CiAgICAgICAg\nICAgICAgICAgICAgd2hpbGUgKHN1c3BlbmRlZCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBzdXNwZW5zaW9uTG9jay53YWl0KCk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nU2V0PFNlbGVjdGlvbktleT4gc2VsZWN0ZWQ7CiAgICAgICAgICAgICAgICBz\neW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgICAgICBzZWxl\nY3RlZCA9IHNlbGVjdG9yLnNlbGVjdGVkS2V5cygpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgQXJyYXlMaXN0PFNlbGVjdGlvbktleT4g\nc2VsZWN0ZWRMaXN0ID0gbmV3IEFycmF5TGlzdDxTZWxlY3Rpb25LZXk+KHNl\nbGVjdGVkKTsKICAgICAgICAgICAgICAgIENvbGxlY3Rpb25zLnNodWZmbGUo\nc2VsZWN0ZWRMaXN0KTsKICAgICAgICAgICAgICAgIGZvciAoU2VsZWN0aW9u\nS2V5IGsgOiBzZWxlY3RlZExpc3QpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoKGsucmVhZHlPcHMoKSAmIFNlbGVjdGlvbktleS5PUF9BQ0NFUFQpICE9\nIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgU29ja2V0Q2hhbm5lbCBz\nYyA9ICgoU2VydmVyU29ja2V0Q2hhbm5lbCkgay5jaGFubmVsKCkpLmFjY2Vw\ndCgpOwogICAgICAgICAgICAgICAgICAgICAgICBzYy5jb25maWd1cmVCbG9j\na2luZyhmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFNlbGVjdGlv\nbktleSBzayA9IHNjLnJlZ2lzdGVyKHNlbGVjdG9yLCBTZWxlY3Rpb25LZXku\nT1BfUkVBRCk7CiAgICAgICAgICAgICAgICAgICAgICAgIENueG4gY254biA9\nIG5ldyBDbnhuKHNjLCBzayk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNr\nLmF0dGFjaChjbnhuKTsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkQ254\nbihjbnhuKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKChrLnJl\nYWR5T3BzKCkgJiAoU2VsZWN0aW9uS2V5Lk9QX1JFQUQgfCBTZWxlY3Rpb25L\nZXkuT1BfV1JJVEUpKSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIENueG4gYyA9IChDbnhuKSBrLmF0dGFjaG1lbnQoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgYy5kb0lPKGspOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlbGVjdGVkLmNs\nZWFyKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICBMT0cud2FybigiRXhjZXB0aW9uIGluIHNlcnZlciBz\nb2NrZXQgbG9vcDogIiArIHNzLnNvY2tldCgpLmdldEluZXRBZGRyZXNzKCks\nIGUpOwogICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewogICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBpbiBzZXJ2ZXIgc29ja2V0\nIGxvb3A6ICIgKyBzcy5zb2NrZXQoKS5nZXRJbmV0QWRkcmVzcygpLCBlKTsK\nICAgICAgICAgICAgICAgIGNyYXNoZWQuc2V0KHRydWUpOwogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\nTE9HLmluZm8oIk5JT1NlcnZlckNueG4gZmFjdG9yeSBleGl0ZWRsb29wLiIp\nOwogICAgICAgIGNsZWFyKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBjbGVh\nciBhbGwgdGhlIGNvbm5lY3Rpb25zIGluIHRoZSBzZWxlY3RvcgogICAgICoK\nICAgICAqLwogICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIGNsZWFyKCkg\newogICAgICAgIHNlbGVjdG9yLndha2V1cCgpOwogICAgICAgIHN5bmNocm9u\naXplZCAoY254bnMpIHsKICAgICAgICAgICAgLy8gZ290IHRvIGNsZWFyIGFs\nbCB0aGUgY29ubmVjdGlvbnMgdGhhdCB3ZSBoYXZlIGluIHRoZSBzZWxlY3Rv\ncgogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPENueG4+IGl0ID0gY254bnMu\naXRlcmF0b3IoKTsgaXQuaGFzTmV4dCgpOykgewogICAgICAgICAgICAgICAg\nQ254biBjbnhuID0gaXQubmV4dCgpOwogICAgICAgICAgICAgICAgaXQucmVt\nb3ZlKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIGNueG4uY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRG8gbm90aGlu\nZy4KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICB9CgogICAgcHVibGljIHZvaWQgc2h1dGRvd24oKSB7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgc3MuY2xvc2UoKTsKICAgICAgICAgICAgY2xl\nYXIoKTsKICAgICAgICAgICAgdGhpcy5pbnRlcnJ1cHQoKTsKICAgICAgICAg\nICAgdGhpcy5qb2luKCk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cud2FybigiSW50ZXJydXB0\nZWQiLCBlKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIiwgZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhlIGJ1ZmZlciB3\naWxsIGNhdXNlIHRoZSBjb25uZWN0aW9uIHRvIGJlIGNsb3NlIHdoZW4gd2Ug\nZG8gYSBzZW5kLgogICAgICovCiAgICBzdGF0aWMgZmluYWwgQnl0ZUJ1ZmZl\nciBjbG9zZUNvbm4gPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDApOwoKICAgIHB1\nYmxpYyBjbGFzcyBDbnhuIHsKCiAgICAgICAgcHJpdmF0ZSBTb2NrZXRDaGFu\nbmVsIHNvY2s7CgogICAgICAgIHByaXZhdGUgU2VsZWN0aW9uS2V5IHNrOwoK\nICAgICAgICBib29sZWFuIGluaXRpYWxpemVkOwoKICAgICAgICBCeXRlQnVm\nZmVyIGxlbkJ1ZmZlciA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CgogICAg\nICAgIEJ5dGVCdWZmZXIgaW5jb21pbmdCdWZmZXIgPSBsZW5CdWZmZXI7Cgog\nICAgICAgIExpbmtlZEJsb2NraW5nUXVldWU8Qnl0ZUJ1ZmZlcj4gb3V0Z29p\nbmdCdWZmZXJzID0gbmV3IExpbmtlZEJsb2NraW5nUXVldWU8Qnl0ZUJ1ZmZl\ncj4oKTsKCiAgICAgICAgaW50IHNlc3Npb25UaW1lb3V0OwoKICAgICAgICB2\nb2lkIGRvSU8oU2VsZWN0aW9uS2V5IGspIHRocm93cyBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBp\nZiAoc29jayA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGsuaXNS\nZWFkYWJsZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IHJjID0gc29j\nay5yZWFkKGluY29taW5nQnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAocmMgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZv\nKCJQZWVyIGNsb3NlZCBjb25uZWN0aW9uLiByYz17fSB7fSIsIHJjLCBzb2Nr\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBpZiAoaW5jb21pbmdCdWZmZXIucmVtYWlu\naW5nKCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpbmNvbWlu\nZ0J1ZmZlci5mbGlwKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChp\nbmNvbWluZ0J1ZmZlciA9PSBsZW5CdWZmZXIpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJlYWRMZW5ndGgoayk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nbnhuU3RhdHMucGFja2V0c1JlY2VpdmVkKys7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBTZXJ2ZXJTdGF0cy5nZXRJbnN0YW5jZSgpLmluY3JlbWVu\ndFBhY2tldHNSZWNlaXZlZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFk\nUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZW5CdWZm\nZXIuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nbmNvbWluZ0J1ZmZlciA9IGxlbkJ1ZmZlcjsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGlmIChrLmlzV3JpdGFibGUoKSkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChvdXRnb2luZ0J1ZmZlcnMuc2l6ZSgpID4gMCkgewogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBab29Mb2cubG9nVHJhY2VNZXNzYWdlKExPRywK\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gWm9vTG9nLkNMSUVOVF9EQVRB\nX1BBQ0tFVF9UUkFDRV9NQVNLLAogICAgICAgICAgICAgICAgICAgICAgICAv\nLyAic2sgIiArIGsgKyAiIGlzIHZhbGlkOiAiICsKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gay5pc1ZhbGlkKCkpOwoKICAgICAgICAgICAgICAgICAg\nICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogVGhpcyBpcyBn\nb2luZyB0byByZXNldCB0aGUgYnVmZmVyIHBvc2l0aW9uIHRvIDAgYW5kCiAg\nICAgICAgICAgICAgICAgICAgICAgICAqIHRoZSBsaW1pdCB0byB0aGUgc2l6\nZSBvZiB0aGUgYnVmZmVyLCBzbyB0aGF0IHdlIGNhbgogICAgICAgICAgICAg\nICAgICAgICAgICAgKiBmaWxsIGl0IHdpdGggZGF0YSBmcm9tIHRoZSBub24t\nZGlyZWN0IGJ1ZmZlcnMgdGhhdCB3ZQogICAgICAgICAgICAgICAgICAgICAg\nICAgKiBuZWVkIHRvIHNlbmQuCiAgICAgICAgICAgICAgICAgICAgICAgICAq\nLwogICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3RCdWZmZXIuY2xlYXIo\nKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoQnl0ZUJ1ZmZlciBi\nIDogb3V0Z29pbmdCdWZmZXJzKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoZGlyZWN0QnVmZmVyLnJlbWFpbmluZygpIDwgYi5yZW1haW5p\nbmcoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICogV2hlbiB3ZSBjYWxs\nIHB1dCBsYXRlciwgaWYgdGhlIGRpcmVjdEJ1ZmZlcgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAqIGlzIHRvIHNtYWxsIHRvIGhvbGQgZXZl\ncnl0aGluZywgbm90aGluZyB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICogYmUgY29waWVkLCBzbyB3ZSd2ZSBnb3QgdG8gc2xpY2Ug\ndGhlIGJ1ZmZlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAq\nIGlmIGl0J3MgdG9vIGJpZy4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiID0g\nKEJ5dGVCdWZmZXIpIGIuc2xpY2UoKS5saW1pdChkaXJlY3RCdWZmZXIucmVt\nYWluaW5nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAqIHB1dCgpIGlzIGdvaW5nIHRvIG1vZGlmeSB0aGUgcG9z\naXRpb25zIG9mIGJvdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAq\nIGJ1ZmZlcnMsIHB1dCB3ZSBkb24ndCB3YW50IHRvIGNoYW5nZSB0aGUgcG9z\naXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIG9mIHRoZSBz\nb3VyY2UgYnVmZmVycyAod2UnbGwgZG8gdGhhdCBhZnRlciB0aGUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAqIHNlbmQsIGlmIG5lZWRlZCksIHNv\nIHdlIHNhdmUgYW5kIHJlc2V0IHRoZQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICogcG9zaXRpb24gYWZ0ZXIgdGhlIGNvcHkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaW50IHAgPSBiLnBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBkaXJlY3RCdWZmZXIucHV0KGIpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYi5wb3NpdGlvbihwKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChkaXJlY3RCdWZmZXIucmVtYWluaW5nKCkgPT0gMCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAg\nICAgICAgICAgICAgICAqIERvIHRoZSBmbGlwOiBsaW1pdCBiZWNvbWVzIHBv\nc2l0aW9uLCBwb3NpdGlvbiBnZXRzCiAgICAgICAgICAgICAgICAgICAgICAg\nICAqIHNldCB0byAwLiBUaGlzIHNldHMgdXMgdXAgZm9yIHRoZSB3cml0ZS4K\nICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAg\nICAgICAgIGRpcmVjdEJ1ZmZlci5mbGlwKCk7CgogICAgICAgICAgICAgICAg\nICAgICAgICBpbnQgc2VudCA9IHNvY2sud3JpdGUoZGlyZWN0QnVmZmVyKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYjsKCiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGUgYnVmZmVycyB0aGF0\nIHdlIGhhdmUgc2VudAogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAo\nb3V0Z29pbmdCdWZmZXJzLnNpemUoKSA+IDApIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGJiID0gb3V0Z29pbmdCdWZmZXJzLnBlZWsoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiYiA9PSBjbG9zZUNvbm4p\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSU9FeGNlcHRpb24oImNsb3NpbmciKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBsZWZ0\nID0gYmIucmVtYWluaW5nKCkgLSBzZW50OwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGxlZnQgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKiBXZSBvbmx5IHBhcnRpYWxseSBzZW50IHRoaXMgYnVmZmVyLCBzbyB3\nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHVwZGF0ZSB0\naGUgcG9zaXRpb24gYW5kIGV4aXQgdGhlIGxvb3AuCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYmIucG9zaXRpb24oYmIucG9zaXRpb24oKSArIHNlbnQpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY254blN0YXRzLnBhY2tldHNTZW50Kys7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAvKiBXZSd2ZSBzZW50IHRoZSB3aG9sZSBidWZmZXIs\nIHNvIGRyb3AgdGhlIGJ1ZmZlciAqLwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc2VudCAtPSBiYi5yZW1haW5pbmcoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIFNlcnZlclN0YXRzLmdldEluc3RhbmNlKCkuaW5jcmVt\nZW50UGFja2V0c1NlbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG91dGdvaW5nQnVmZmVycy5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAvLyBab29Mb2cubG9n\nVHJhY2VNZXNzYWdlKExPRywKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nWm9vTG9nLkNMSUVOVF9EQVRBX1BBQ0tFVF9UUkFDRV9NQVNLLCAiYWZ0ZXIg\nc2VuZCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3V0Z29pbmdCdWZm\nZXJzLnNpemUoKSA9ICIgKyBvdXRnb2luZ0J1ZmZlcnMuc2l6ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3luY2hy\nb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChv\ndXRnb2luZ0J1ZmZlcnMuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmICghaW5pdGlhbGl6ZWQgJiYgKHNrLmludGVyZXN0\nT3BzKCkgJiBTZWxlY3Rpb25LZXkuT1BfUkVBRCkgPT0gMCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbigiUmVzcG9uZGVkIHRvIGluZm8gcHJvYmUiKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNr\nLmludGVyZXN0T3BzKHNrLmludGVyZXN0T3BzKCkgJiAoflNlbGVjdGlvbktl\neS5PUF9XUklURSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2suaW50ZXJlc3RPcHMo\nc2suaW50ZXJlc3RPcHMoKSB8IFNlbGVjdGlvbktleS5PUF9XUklURSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKENhbmNl\nbGxlZEtleUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBjbG9zZSgp\nOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAvLyBMT0cuZXJyb3IoIkZJWE1TRyIsZSk7CiAgICAgICAg\nICAgICAgICBjbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBwcml2YXRlIHZvaWQgcmVhZFJlcXVlc3QoKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgICAgICBpbmNvbWluZ0J1ZmZlciA9IGluY29taW5n\nQnVmZmVyLnNsaWNlKCk7CiAgICAgICAgICAgIHByb2Nlc3Nvci5wcm9jZXNz\nUGFja2V0KGluY29taW5nQnVmZmVyLCB0aGlzKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIGRpc2FibGVSZWN2KCkgewogICAgICAgICAgICBz\nay5pbnRlcmVzdE9wcyhzay5pbnRlcmVzdE9wcygpICYgKH5TZWxlY3Rpb25L\nZXkuT1BfUkVBRCkpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nZW5hYmxlUmVjdigpIHsKICAgICAgICAgICAgaWYgKHNrLmlzVmFsaWQoKSkg\newogICAgICAgICAgICAgICAgaW50IGludGVyZXN0ID0gc2suaW50ZXJlc3RP\ncHMoKTsKICAgICAgICAgICAgICAgIGlmICgoaW50ZXJlc3QgJiBTZWxlY3Rp\nb25LZXkuT1BfUkVBRCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHNr\nLmludGVyZXN0T3BzKGludGVyZXN0IHwgU2VsZWN0aW9uS2V5Lk9QX1JFQUQp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwcml2YXRlIHZvaWQgcmVhZExlbmd0aChTZWxlY3Rpb25LZXkg\naykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgLy8gUmVhZCB0\naGUgbGVuZ3RoLCBub3cgZ2V0IHRoZSBidWZmZXIKICAgICAgICAgICAgaW50\nIGxlbiA9IGxlbkJ1ZmZlci5nZXRJbnQoKTsKICAgICAgICAgICAgaWYgKGxl\nbiA8IDAgfHwgbGVuID4gMHhmZmZmZikgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJMZW4gZXJyb3IgIiArIGxlbik7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaW5jb21pbmdCdWZmZXIgPSBCeXRlQnVm\nZmVyLmFsbG9jYXRlKGxlbik7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBUaGUgbnVtYmVyIG9mIHJlcXVlc3RzIHRoYXQgaGF2ZSBiZWVu\nIHN1Ym1pdHRlZCBidXQgbm90IHlldCByZXNwb25kZWQKICAgICAgICAgKiB0\nby4KICAgICAgICAgKi8KICAgICAgICBpbnQgb3V0c3RhbmRpbmdSZXF1ZXN0\nczsKCiAgICAgICAgLyoKICAgICAgICAgKiAobm9uLUphdmFkb2MpCiAgICAg\nICAgICoKICAgICAgICAgKiBAc2VlIG9yZy5hcGFjaGUuem9va2VlcGVyLnNl\ncnZlci5TZXJ2ZXJDbnhuSWZhY2UjZ2V0U2Vzc2lvblRpbWVvdXQoKQogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyBpbnQgZ2V0U2Vzc2lvblRpbWVvdXQo\nKSB7CiAgICAgICAgICAgIHJldHVybiBzZXNzaW9uVGltZW91dDsKICAgICAg\nICB9CgogICAgICAgIFN0cmluZyBwZWVyTmFtZSA9IG51bGw7CgogICAgICAg\nIHB1YmxpYyBDbnhuKFNvY2tldENoYW5uZWwgc29jaywgU2VsZWN0aW9uS2V5\nIHNrKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICB0aGlzLnNv\nY2sgPSBzb2NrOwogICAgICAgICAgICB0aGlzLnNrID0gc2s7CiAgICAgICAg\nICAgIHNvY2suc29ja2V0KCkuc2V0VGNwTm9EZWxheShjb25mLmdldFNlcnZl\nclRjcE5vRGVsYXkoKSk7CiAgICAgICAgICAgIHNvY2suc29ja2V0KCkuc2V0\nU29MaW5nZXIodHJ1ZSwgMik7CiAgICAgICAgICAgIHNrLmludGVyZXN0T3Bz\nKFNlbGVjdGlvbktleS5PUF9SRUFEKTsKICAgICAgICAgICAgaWYgKExPRy5p\nc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBwZWVyTmFtZSA9\nIHNvY2suc29ja2V0KCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgbGVuQnVmZmVyLmNsZWFyKCk7CiAgICAgICAgICAgIGluY29t\naW5nQnVmZmVyID0gbGVuQnVmZmVyOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgcmV0dXJuICJOSU9TZXJ2ZXJDbnhuIG9iamVjdCB3aXRoIHNv\nY2sgPSAiICsgc29jayArICIgYW5kIHNrID0gIiArIHNrOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRQZWVyTmFtZSgpIHsKICAgICAg\nICAgICAgaWYgKHBlZXJOYW1lID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIHBlZXJOYW1lID0gc29jay5zb2NrZXQoKS50b1N0cmluZygpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiBwZWVyTmFtZTsKICAgICAgICB9\nCgogICAgICAgIGJvb2xlYW4gY2xvc2VkOwoKICAgICAgICAvKgogICAgICAg\nICAqIChub24tSmF2YWRvYykKICAgICAgICAgKgogICAgICAgICAqIEBzZWUg\nb3JnLmFwYWNoZS56b29rZWVwZXIuc2VydmVyLlNlcnZlckNueG5JZmFjZSNj\nbG9zZSgpCiAgICAgICAgICovCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2Uo\nKSB7CiAgICAgICAgICAgIGlmIChjbG9zZWQpIHsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjbG9zZWQgPSB0\ncnVlOwogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGNueG5zKSB7CiAgICAg\nICAgICAgICAgICBjbnhucy5yZW1vdmUodGhpcyk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgTE9HLmRlYnVnKCJjbG9zZSBOSU9TZXJ2ZXJDbnhuOiB7\nfSIsIHNvY2spOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nLyoKICAgICAgICAgICAgICAgICAqIFRoZSBmb2xsb3dpbmcgc2VxdWVuY2Ug\nb2YgY29kZSBpcyBzdHVwaWQhIFlvdSB3b3VsZCB0aGluawogICAgICAgICAg\nICAgICAgICogdGhhdCBvbmx5IHNvY2suY2xvc2UoKSBpcyBuZWVkZWQsIGJ1\ndCBhbGFzLCBpdCBkb2Vzbid0IHdvcmsKICAgICAgICAgICAgICAgICAqIHRo\nYXQgd2F5LiBJZiB5b3UganVzdCBkbyBzb2NrLmNsb3NlKCkgdGhlcmUgYXJl\nIGNhc2VzIHdoZXJlCiAgICAgICAgICAgICAgICAgKiB0aGUgc29ja2V0IGRv\nZXNuJ3QgYWN0dWFsbHkgY2xvc2UuLi4KICAgICAgICAgICAgICAgICAqLwog\nICAgICAgICAgICAgICAgc29jay5zb2NrZXQoKS5zaHV0ZG93bk91dHB1dCgp\nOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAvLyBUaGlzIGlzIGEgcmVsYXRpdmVseSBjb21tb24gZXhj\nZXB0aW9uIHRoYXQgd2UgY2FuJ3QgYXZvaWQKICAgICAgICAgICAgfQogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc29jay5zb2NrZXQoKS5z\naHV0ZG93bklucHV0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgc29jay5zb2NrZXQoKS5jbG9zZSgpOwogICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkZJWE1TRyIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzb2NrLmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICAvLyBYWFggVGhlIG5leHQgbGluZSBkb2Vzbid0IHNlZW0g\ndG8gYmUgbmVlZGVkLCBidXQgc29tZSBwb3N0cwogICAgICAgICAgICAgICAg\nLy8gdG8gZm9ydW1zIHN1Z2dlc3QgdGhhdCBpdCBpcyBuZWVkZWQuIEtlZXAg\naW4gbWluZCBpZiBlcnJvcnMKICAgICAgICAgICAgICAgIC8vIGluCiAgICAg\nICAgICAgICAgICAvLyB0aGlzIHNlY3Rpb24gYXJpc2UuCiAgICAgICAgICAg\nICAgICAvLyBmYWN0b3J5LnNlbGVjdG9yLndha2V1cCgpOwogICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkZJWE1TRyIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHNvY2sgPSBudWxsOwogICAgICAgICAgICBpZiAoc2sgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAv\nLyBuZWVkIHRvIGNhbmNlbCB0aGlzIHNlbGVjdGlvbiBrZXkgZnJvbSB0aGUg\nc2VsZWN0b3IKICAgICAgICAgICAgICAgICAgICBzay5jYW5jZWwoKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHBy\naXZhdGUgdm9pZCBtYWtlV3JpdGFibGUoU2VsZWN0aW9uS2V5IHNrKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzZWxlY3Rvci53YWtl\ndXAoKTsKICAgICAgICAgICAgICAgIGlmIChzay5pc1ZhbGlkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBzay5pbnRlcmVzdE9wcyhzay5pbnRlcmVzdE9w\ncygpIHwgU2VsZWN0aW9uS2V5Lk9QX1dSSVRFKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSBjYXRjaCAoUnVudGltZUV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlByb2JsZW0gc2V0dGluZyB3\ncml0YWJsZSIsIGUpOwogICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHNlbmRC\ndWZmZXJzKEJ5dGVCdWZmZXIgYmJbXSkgewogICAgICAgICAgICBCeXRlQnVm\nZmVyIGxlbiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAg\nIGludCB0b3RhbCA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYmIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChiYltp\nXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdG90YWwgKz0gYmJb\naV0ucmVtYWluaW5nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgTE9HLmRlYnVnKCJTZW5kaW5nIHJlc3BvbnNlIG9m\nIHNpemUge30gdG8ge30iLCB0b3RhbCwgcGVlck5hbWUpOwogICAgICAgICAg\nICBsZW4ucHV0SW50KHRvdGFsKTsKICAgICAgICAgICAgbGVuLmZsaXAoKTsK\nICAgICAgICAgICAgb3V0Z29pbmdCdWZmZXJzLmFkZChsZW4pOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJiLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoYmJbaV0gIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIG91dGdvaW5nQnVmZmVycy5hZGQoYmJbaV0pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG1ha2VXcml0\nYWJsZShzayk7CiAgICAgICAgfQoKICAgICAgICBzeW5jaHJvbml6ZWQgcHVi\nbGljIHZvaWQgc2VuZFJlc3BvbnNlKEJ5dGVCdWZmZXIuLi4gYmIpIHsKICAg\nICAgICAgICAgaWYgKGNsb3NlZCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlbmRCdWZmZXJzKGJiKTsK\nICAgICAgICAgICAgc3luY2hyb25pemVkIChOSU9TZXJ2ZXJGYWN0b3J5LnRo\naXMpIHsKICAgICAgICAgICAgICAgIG91dHN0YW5kaW5nUmVxdWVzdHMtLTsK\nICAgICAgICAgICAgICAgIC8vIGNoZWNrIHRocm90dGxpbmcKICAgICAgICAg\nICAgICAgIGlmIChvdXRzdGFuZGluZ1JlcXVlc3RzIDwgb3V0c3RhbmRpbmdM\naW1pdCkgewogICAgICAgICAgICAgICAgICAgIHNrLnNlbGVjdG9yKCkud2Fr\nZXVwKCk7CiAgICAgICAgICAgICAgICAgICAgZW5hYmxlUmVjdigpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgSW5ldFNvY2tldEFkZHJlc3MgZ2V0UmVtb3RlQWRkcmVzcygp\nIHsKICAgICAgICAgICAgcmV0dXJuIChJbmV0U29ja2V0QWRkcmVzcykgc29j\nay5zb2NrZXQoKS5nZXRSZW1vdGVTb2NrZXRBZGRyZXNzKCk7CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIGNsYXNzIENueG5TdGF0cyB7CiAgICAgICAg\nICAgIGxvbmcgcGFja2V0c1NlbnQgPSAwOwogICAgICAgICAgICBsb25nIHBh\nY2tldHNSZWNlaXZlZCA9IDA7CgogICAgICAgICAgICAvKioKICAgICAgICAg\nICAgICogVGhlIG51bWJlciBvZiByZXF1ZXN0cyB0aGF0IGhhdmUgYmVlbiBz\ndWJtaXR0ZWQgYnV0IG5vdCB5ZXQKICAgICAgICAgICAgICogcmVzcG9uZGVk\nIHRvLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgcHVibGljIGxvbmcg\nZ2V0T3V0c3RhbmRpbmdSZXF1ZXN0cygpIHsKICAgICAgICAgICAgICAgIHN5\nbmNocm9uaXplZChDbnhuLnRoaXMpIHsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gb3V0c3RhbmRpbmdSZXF1ZXN0czsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGxvbmcgZ2V0UGFj\na2V0c1JlY2VpdmVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhY2tl\ndHNSZWNlaXZlZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGlj\nIGxvbmcgZ2V0UGFja2V0c1NlbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gcGFja2V0c1NlbnQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkg\newogICAgICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJp\nbmdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICBDaGFubmVsIGNoYW5uZWwg\nPSBzay5jaGFubmVsKCk7CiAgICAgICAgICAgICAgICBpZiAoY2hhbm5lbCBp\nbnN0YW5jZW9mIFNvY2tldENoYW5uZWwpIHsKICAgICAgICAgICAgICAgICAg\nICBzYi5hcHBlbmQoIiAiKS5hcHBlbmQoKChTb2NrZXRDaGFubmVsKSBjaGFu\nbmVsKS5zb2NrZXQoKS5nZXRSZW1vdGVTb2NrZXRBZGRyZXNzKCkpLmFwcGVu\nZCgiWyIpCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChJbnRlZ2VyLnRv\nSGV4U3RyaW5nKHNrLmludGVyZXN0T3BzKCkpKS5hcHBlbmQoIl0ocXVldWVk\nPSIpLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0T3V0c3Rh\nbmRpbmdSZXF1ZXN0cygpKS5hcHBlbmQoIixyZWN2ZWQ9IikuYXBwZW5kKGdl\ndFBhY2tldHNSZWNlaXZlZCgpKS5hcHBlbmQoCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAiLHNlbnQ9IikuYXBwZW5kKGdldFBhY2tldHNTZW50KCkp\nLmFwcGVuZCgiKVxuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXR1cm4gc2IudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHJpdmF0ZSBDbnhuU3RhdHMgY254blN0YXRzID0g\nbmV3IENueG5TdGF0cygpOwoKICAgICAgICBwdWJsaWMgQ254blN0YXRzIGdl\ndFN0YXRzKCkgewogICAgICAgICAgICByZXR1cm4gY254blN0YXRzOwogICAg\nICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

