{"sha":"0de47f1f493fbb50fba77cc951cbd4ab101ef3a5","node_id":"MDQ6QmxvYjE1NzU5NTY6MGRlNDdmMWY0OTNmYmI1MGZiYTc3Y2M5NTFjYmQ0YWIxMDFlZjNhNQ==","size":30877,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0de47f1f493fbb50fba77cc951cbd4ab101ef3a5","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG87CgppbXBvcnQgamF2\nYS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRB\nZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLkFycmF5RGVxdWU7CmltcG9ydCBq\nYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwpp\nbXBvcnQgamF2YS51dGlsLlF1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5hdG9taWMuQXRvbWljTG9uZzsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1v\nbi5jb2xsZWN0LkltbXV0YWJsZVNldDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVByb3RvY29sLlBh\nY2tldEhlYWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxiYWNr\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVw\nZXJJbnRlcm5hbENhbGxiYWNrcy5SZWFkRW50cnlDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJu\nYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci51dGlsLk1hdGhVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci51dGlsLk9yZGVyZWRTYWZlRXhlY3V0b3I7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TYWZlUnVubmFibGU7CmltcG9y\ndCBvcmcuamJvc3MubmV0dHkuYm9vdHN0cmFwLkNsaWVudEJvb3RzdHJhcDsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcjsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcnM7\nCmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsOwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbEZ1dHVyZTsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxGdXR1cmVMaXN0\nZW5lcjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxI\nYW5kbGVyQ29udGV4dDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVs\nLkNoYW5uZWxQaXBlbGluZTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFu\nbmVsLkNoYW5uZWxQaXBlbGluZUNvdmVyYWdlOwppbXBvcnQgb3JnLmpib3Nz\nLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbFBpcGVsaW5lRmFjdG9yeTsKaW1wb3J0\nIG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxTdGF0ZUV2ZW50Owpp\nbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbHM7CmltcG9y\ndCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5FeGNlcHRpb25FdmVudDsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLk1lc3NhZ2VFdmVudDsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLlNpbXBsZUNoYW5uZWxIYW5k\nbGVyOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuc29ja2V0LkNs\naWVudFNvY2tldENoYW5uZWxGYWN0b3J5OwppbXBvcnQgb3JnLmpib3NzLm5l\ndHR5LmhhbmRsZXIuY29kZWMuZnJhbWUuQ29ycnVwdGVkRnJhbWVFeGNlcHRp\nb247CmltcG9ydCBvcmcuamJvc3MubmV0dHkuaGFuZGxlci5jb2RlYy5mcmFt\nZS5MZW5ndGhGaWVsZEJhc2VkRnJhbWVEZWNvZGVyOwppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmhhbmRsZXIuY29kZWMuZnJhbWUuVG9vTG9uZ0ZyYW1lRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmhhbmRsZXIudGltZW91\ndC5SZWFkVGltZW91dEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0\neS5oYW5kbGVyLnRpbWVvdXQuUmVhZFRpbWVvdXRIYW5kbGVyOwppbXBvcnQg\nb3JnLmpib3NzLm5ldHR5LnV0aWwuSGFzaGVkV2hlZWxUaW1lcjsKaW1wb3J0\nIG9yZy5qYm9zcy5uZXR0eS51dGlsLlRpbWVyOwppbXBvcnQgb3JnLnNsZjRq\nLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoq\nCiAqIFRoaXMgY2xhc3MgbWFuYWdlcyBhbGwgZGV0YWlscyBvZiBjb25uZWN0\naW9uIHRvIGEgcGFydGljdWxhciBib29raWUuIEl0IGFsc28KICogaGFzIHJl\nY29ubmVjdCBsb2dpYyBpZiBhIGNvbm5lY3Rpb24gdG8gYSBib29raWUgZmFp\nbHMuCiAqCiAqLwoKQENoYW5uZWxQaXBlbGluZUNvdmVyYWdlKCJvbmUiKQpw\ndWJsaWMgY2xhc3MgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudCBleHRlbmRzIFNp\nbXBsZUNoYW5uZWxIYW5kbGVyIGltcGxlbWVudHMgQ2hhbm5lbFBpcGVsaW5l\nRmFjdG9yeSB7CgogICAgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dn\nZXJGYWN0b3J5LmdldExvZ2dlcihQZXJDaGFubmVsQm9va2llQ2xpZW50LmNs\nYXNzKTsKCiAgICBzdGF0aWMgZmluYWwgbG9uZyBtYXhNZW1vcnkgPSBSdW50\naW1lLmdldFJ1bnRpbWUoKS5tYXhNZW1vcnkoKSAvIDU7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBNQVhfRlJBTUVfTEVOR1RIID0gMiAqIDEwMjQg\nKiAxMDI0OyAvLyAyTQoKICAgIEluZXRTb2NrZXRBZGRyZXNzIGFkZHI7CiAg\nICBBdG9taWNMb25nIHRvdGFsQnl0ZXNPdXRzdGFuZGluZzsKICAgIENsaWVu\ndFNvY2tldENoYW5uZWxGYWN0b3J5IGNoYW5uZWxGYWN0b3J5OwogICAgT3Jk\nZXJlZFNhZmVFeGVjdXRvciBleGVjdXRvcjsKCiAgICBDb25jdXJyZW50SGFz\naE1hcDxDb21wbGV0aW9uS2V5LCBBZGRDb21wbGV0aW9uPiBhZGRDb21wbGV0\naW9ucyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBB\nZGRDb21wbGV0aW9uPigpOwogICAgQ29uY3VycmVudEhhc2hNYXA8Q29tcGxl\ndGlvbktleSwgUmVhZENvbXBsZXRpb24+IHJlYWRDb21wbGV0aW9ucyA9IG5l\ndyBDb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBSZWFkQ29tcGxl\ndGlvbj4oKTsKCiAgICAvKioKICAgICAqIFRoZSBmb2xsb3dpbmcgbWVtYmVy\nIHZhcmlhYmxlcyBkbyBub3QgbmVlZCB0byBiZSBjb25jdXJyZW50LCBvciB2\nb2xhdGlsZQogICAgICogYmVjYXVzZSB0aGV5IGFyZSBhbHdheXMgdXBkYXRl\nZCB1bmRlciBhIGxvY2sKICAgICAqLwogICAgUXVldWU8R2VuZXJpY0NhbGxi\nYWNrPFZvaWQ+PiBwZW5kaW5nT3BzID0gbmV3IEFycmF5RGVxdWU8R2VuZXJp\nY0NhbGxiYWNrPFZvaWQ+PigpOwogICAgdm9sYXRpbGUgQ2hhbm5lbCBjaGFu\nbmVsID0gbnVsbDsKCiAgICBlbnVtIENvbm5lY3Rpb25TdGF0ZSB7CiAgICAg\nICAgRElTQ09OTkVDVEVELCBDT05ORUNUSU5HLCBDT05ORUNURUQsIENMT1NF\nRAogICAgICAgICAgICB9OwoKICAgIHZvbGF0aWxlIENvbm5lY3Rpb25TdGF0\nZSBzdGF0ZTsKICAgIHByaXZhdGUgZmluYWwgQ2xpZW50Q29uZmlndXJhdGlv\nbiBjb25mOwoKICAgIHB1YmxpYyBQZXJDaGFubmVsQm9va2llQ2xpZW50KE9y\nZGVyZWRTYWZlRXhlY3V0b3IgZXhlY3V0b3IsIENsaWVudFNvY2tldENoYW5u\nZWxGYWN0b3J5IGNoYW5uZWxGYWN0b3J5LAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgQXRvbWlj\nTG9uZyB0b3RhbEJ5dGVzT3V0c3RhbmRpbmcpIHsKICAgICAgICB0aGlzKG5l\ndyBDbGllbnRDb25maWd1cmF0aW9uKCksIGV4ZWN1dG9yLCBjaGFubmVsRmFj\ndG9yeSwgYWRkciwgdG90YWxCeXRlc091dHN0YW5kaW5nKTsKICAgIH0KICAg\nICAgICAgICAgCiAgICBwdWJsaWMgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudChD\nbGllbnRDb25maWd1cmF0aW9uIGNvbmYsIE9yZGVyZWRTYWZlRXhlY3V0b3Ig\nZXhlY3V0b3IsIENsaWVudFNvY2tldENoYW5uZWxGYWN0b3J5IGNoYW5uZWxG\nYWN0b3J5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSW5l\ndFNvY2tldEFkZHJlc3MgYWRkciwgQXRvbWljTG9uZyB0b3RhbEJ5dGVzT3V0\nc3RhbmRpbmcpIHsKICAgICAgICB0aGlzLmNvbmYgPSBjb25mOwogICAgICAg\nIHRoaXMuYWRkciA9IGFkZHI7CiAgICAgICAgdGhpcy5leGVjdXRvciA9IGV4\nZWN1dG9yOwogICAgICAgIHRoaXMudG90YWxCeXRlc091dHN0YW5kaW5nID0g\ndG90YWxCeXRlc091dHN0YW5kaW5nOwogICAgICAgIHRoaXMuY2hhbm5lbEZh\nY3RvcnkgPSBjaGFubmVsRmFjdG9yeTsKICAgICAgICB0aGlzLnN0YXRlID0g\nQ29ubmVjdGlvblN0YXRlLkRJU0NPTk5FQ1RFRDsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgY29ubmVjdCgpIHsKICAgICAgICBMT0cuaW5mbygiQ29ubmVj\ndGluZyB0byBib29raWU6IHt9IiwgYWRkcik7CgogICAgICAgIC8vIFNldCB1\ncCB0aGUgQ2xpZW50Qm9vdFN0cmFwIHNvIHdlIGNhbiBjcmVhdGUgYSBuZXcg\nQ2hhbm5lbCBjb25uZWN0aW9uCiAgICAgICAgLy8gdG8gdGhlIGJvb2tpZS4K\nICAgICAgICBDbGllbnRCb290c3RyYXAgYm9vdHN0cmFwID0gbmV3IENsaWVu\ndEJvb3RzdHJhcChjaGFubmVsRmFjdG9yeSk7CiAgICAgICAgYm9vdHN0cmFw\nLnNldFBpcGVsaW5lRmFjdG9yeSh0aGlzKTsKICAgICAgICBib290c3RyYXAu\nc2V0T3B0aW9uKCJ0Y3BOb0RlbGF5IiwgY29uZi5nZXRDbGllbnRUY3BOb0Rl\nbGF5KCkpOwogICAgICAgIGJvb3RzdHJhcC5zZXRPcHRpb24oImtlZXBBbGl2\nZSIsIHRydWUpOwoKICAgICAgICBDaGFubmVsRnV0dXJlIGZ1dHVyZSA9IGJv\nb3RzdHJhcC5jb25uZWN0KGFkZHIpOwogICAgICAgIGZ1dHVyZS5hZGRMaXN0\nZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyKCkgewogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9u\nQ29tcGxldGUoQ2hhbm5lbEZ1dHVyZSBmdXR1cmUpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJDaGFubmVsIGNvbm5l\nY3RlZCAoe30pIHt9IiwgZnV0dXJlLmlzU3VjY2VzcygpLCBmdXR1cmUuZ2V0\nQ2hhbm5lbCgpKTsKICAgICAgICAgICAgICAgIGludCByYzsKICAgICAgICAg\nICAgICAgIFF1ZXVlPEdlbmVyaWNDYWxsYmFjazxWb2lkPj4gb2xkUGVuZGlu\nZ09wczsKCiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKFBlckNoYW5u\nZWxCb29raWVDbGllbnQudGhpcykgewogICAgICAgICAgICAgICAgICAgIGlm\nIChmdXR1cmUuaXNTdWNjZXNzKCkgJiYgc3RhdGUgPT0gQ29ubmVjdGlvblN0\nYXRlLkNPTk5FQ1RJTkcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmluZm8oIlN1Y2Nlc3NmdWxseSBjb25uZWN0ZWQgdG8gYm9va2llOiB7fSIs\nIGZ1dHVyZS5nZXRDaGFubmVsKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNoYW5uZWwgPSBmdXR1cmUuZ2V0Q2hhbm5lbCgpOwogICAgICAg\nICAgICAgICAgICAgICAgICBzdGF0ZSA9IENvbm5lY3Rpb25TdGF0ZS5DT05O\nRUNURUQ7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChmdXR1cmUu\naXNTdWNjZXNzKCkgJiYgKHN0YXRlID09IENvbm5lY3Rpb25TdGF0ZS5DTE9T\nRUQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfHwgc3RhdGUgPT0gQ29ubmVjdGlvblN0YXRlLkRJU0NP\nTk5FQ1RFRCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4o\nIkNsb3NlZCBiZWZvcmUgY29ubmVjdGlvbiBjb21wbGV0ZWQsIGNsZWFuIHVw\nOiB7fSwgY3VycmVudCBzdGF0ZSB7fSIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZ1dHVyZS5nZXRDaGFubmVsKCksIHN0YXRlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgY2xvc2VDaGFubmVsKGZ1dHVyZS5nZXRD\naGFubmVsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICByYyA9IEJLRXhj\nZXB0aW9uLkNvZGUuQm9va2llSGFuZGxlTm90QXZhaWxhYmxlRXhjZXB0aW9u\nOwogICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVsID0gbnVsbDsKICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZ1dHVyZS5pc1N1Y2Nlc3Mo\nKSAmJiBzdGF0ZSA9PSBDb25uZWN0aW9uU3RhdGUuQ09OTkVDVEVEKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiQWxyZWFkeSBjb25u\nZWN0ZWQgd2l0aCBhbm90aGVyIGNoYW5uZWwoe30pLCBzbyBjbG9zZSB0aGUg\nbmV3IGNoYW5uZWwoe30pIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNoYW5uZWwsIGZ1dHVyZS5nZXRDaGFubmVsKCkpOwogICAgICAg\nICAgICAgICAgICAgICAgICBjbG9zZUNoYW5uZWwoZnV0dXJlLmdldENoYW5u\nZWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsgLy8gcGVu\nZGluZ09wcyBzaG91bGQgaGF2ZSBiZWVuIGNvbXBsZXRlZCB3aGVuIG90aGVy\nIGNoYW5uZWwgY29ubmVjdGVkCiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBu\nb3QgY29ubmVjdCB0byBib29raWU6IHt9LCBjdXJyZW50IHN0YXRlIHt9IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1dHVyZS5nZXRD\naGFubmVsKCksIHN0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmMg\nPSBCS0V4Y2VwdGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2YWlsYWJsZUV4\nY2VwdGlvbjsKICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VDaGFubmVs\nKGZ1dHVyZS5nZXRDaGFubmVsKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICBjaGFubmVsID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHN0YXRlICE9IENvbm5lY3Rpb25TdGF0ZS5DTE9TRUQpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkRJ\nU0NPTk5FQ1RFRDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gdHJpY2sg\ndG8gbm90IGRvIG9wZXJhdGlvbnMgdW5kZXIgdGhlIGxvY2ssIHRha2UgdGhl\nIGxpc3QKICAgICAgICAgICAgICAgICAgICAvLyBvZiBwZW5kaW5nIG9wcyBh\nbmQgYXNzaWduIGl0IHRvIGEgbmV3IHZhcmlhYmxlLCB3aGlsZQogICAgICAg\nICAgICAgICAgICAgIC8vIGVtcHR5aW5nIHRoZSBwZW5kaW5nIG9wcyBieSBq\ndXN0IGFzc2lnbmluZyBpdCB0byBhIG5ldwogICAgICAgICAgICAgICAgICAg\nIC8vIGxpc3QKICAgICAgICAgICAgICAgICAgICBvbGRQZW5kaW5nT3BzID0g\ncGVuZGluZ09wczsKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nT3BzID0g\nbmV3IEFycmF5RGVxdWU8R2VuZXJpY0NhbGxiYWNrPFZvaWQ+PigpOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAoR2VuZXJpY0Nh\nbGxiYWNrPFZvaWQ+IHBlbmRpbmdPcCA6IG9sZFBlbmRpbmdPcHMpIHsKICAg\nICAgICAgICAgICAgICAgICBwZW5kaW5nT3Aub3BlcmF0aW9uQ29tcGxldGUo\ncmMsIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSk7CiAgICB9CgogICAgdm9pZCBjb25uZWN0SWZOZWVkZWRBbmRE\nb09wKEdlbmVyaWNDYWxsYmFjazxWb2lkPiBvcCkgewogICAgICAgIGJvb2xl\nYW4gY29tcGxldGVPcE5vdyA9IGZhbHNlOwogICAgICAgIGludCBvcFJjID0g\nQktFeGNlcHRpb24uQ29kZS5PSzsKICAgICAgICAvLyBjb21tb24gY2FzZSB3\naXRob3V0IGxvY2sgZmlyc3QKICAgICAgICBpZiAoY2hhbm5lbCAhPSBudWxs\nICYmIHN0YXRlID09IENvbm5lY3Rpb25TdGF0ZS5DT05ORUNURUQpIHsKICAg\nICAgICAgICAgY29tcGxldGVPcE5vdyA9IHRydWU7CiAgICAgICAgfSBlbHNl\nIHsKCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAg\nICAgICAgICAgLy8gY2hlY2sgdGhlIGNoYW5uZWwgc3RhdHVzIGFnYWluIHVu\nZGVyIGxvY2sKICAgICAgICAgICAgICAgIGlmIChjaGFubmVsICE9IG51bGwg\nJiYgc3RhdGUgPT0gQ29ubmVjdGlvblN0YXRlLkNPTk5FQ1RFRCkgewogICAg\nICAgICAgICAgICAgICAgIGNvbXBsZXRlT3BOb3cgPSB0cnVlOwogICAgICAg\nICAgICAgICAgICAgIG9wUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAg\nICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PSBDb25uZWN0aW9uU3Rh\ndGUuQ0xPU0VEKSB7CiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVPcE5v\ndyA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgb3BSYyA9IEJLRXhjZXB0\naW9uLkNvZGUuQm9va2llSGFuZGxlTm90QXZhaWxhYmxlRXhjZXB0aW9uOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAv\nLyBjaGFubmVsIGlzIGVpdGhlciBudWxsIChmaXJzdCBjb25uZWN0aW9uIGF0\ndGVtcHQpLCBvciB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBjaGFubmVs\nIGlzIGRpc2Nvbm5lY3RlZC4gQ29ubmVjdGlvbiBhdHRlbXB0IGlzIHN0aWxs\nIGluCiAgICAgICAgICAgICAgICAgICAgLy8gcHJvZ3Jlc3MsIHF1ZXVlIHVw\nIHRoaXMgb3AuIE9wIHdpbGwgYmUgZXhlY3V0ZWQgd2hlbgogICAgICAgICAg\nICAgICAgICAgIC8vIGNvbm5lY3Rpb24gYXR0ZW1wdCBlaXRoZXIgZmFpbHMg\nb3Igc3VjY2VlZHMKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nT3BzLmFk\nZChvcCk7CgogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PSBDb25u\nZWN0aW9uU3RhdGUuQ09OTkVDVElORykgewogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBqdXN0IHJldHVybiBhcyBjb25uZWN0aW9uIHJlcXVlc3QgaGFz\nIGFscmVhZHkgc2VuZAogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQg\nd2FpdGluZyBmb3IgdGhlIHJlc3BvbnNlLgogICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIC8vIHN3aXRjaCBzdGF0ZSB0byBjb25uZWN0aW5nIGFuZCBk\nbyBjb25uZWN0aW9uIGF0dGVtcHQKICAgICAgICAgICAgICAgICAgICBzdGF0\nZSA9IENvbm5lY3Rpb25TdGF0ZS5DT05ORUNUSU5HOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghY29tcGxldGVP\ncE5vdykgewogICAgICAgICAgICAgICAgLy8gU3RhcnQgY29ubmVjdGlvbiBh\ndHRlbXB0IHRvIHRoZSBpbnB1dCBzZXJ2ZXIgaG9zdC4KICAgICAgICAgICAg\nICAgIGNvbm5lY3QoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgaWYgKGNvbXBsZXRlT3BOb3cpIHsKICAgICAgICAgICAgb3Aub3BlcmF0\naW9uQ29tcGxldGUob3BSYywgbnVsbCk7CiAgICAgICAgfQoKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgb25s\neSBhZnRlciBjb25uZWN0aW9uIGhhcyBiZWVuIGNoZWNrZWQgZm9yCiAgICAg\nKiB7QGxpbmsgI2Nvbm5lY3RJZk5lZWRlZEFuZERvT3AoR2VuZXJpY0NhbGxi\nYWNrKX0KICAgICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAqIEBw\nYXJhbSBtYXN0ZXJLZXkKICAgICAqIEBwYXJhbSBlbnRyeUlkCiAgICAgKiBA\ncGFyYW0gbGFzdENvbmZpcm1lZAogICAgICogQHBhcmFtIG1hY0NvZGUKICAg\nICAqIEBwYXJhbSBkYXRhCiAgICAgKiBAcGFyYW0gY2IKICAgICAqIEBwYXJh\nbSBjdHgKICAgICAqLwogICAgdm9pZCBhZGRFbnRyeShmaW5hbCBsb25nIGxl\nZGdlcklkLCBieXRlW10gbWFzdGVyS2V5LCBmaW5hbCBsb25nIGVudHJ5SWQs\nIENoYW5uZWxCdWZmZXIgdG9TZW5kLCBXcml0ZUNhbGxiYWNrIGNiLAogICAg\nICAgICAgICAgICAgICBPYmplY3QgY3R4LCBmaW5hbCBpbnQgb3B0aW9ucykg\newogICAgICAgIGZpbmFsIGludCBlbnRyeVNpemUgPSB0b1NlbmQucmVhZGFi\nbGVCeXRlcygpOwoKICAgICAgICBmaW5hbCBDb21wbGV0aW9uS2V5IGNvbXBs\nZXRpb25LZXkgPSBuZXcgQ29tcGxldGlvbktleShsZWRnZXJJZCwgZW50cnlJ\nZCk7CgogICAgICAgIGFkZENvbXBsZXRpb25zLnB1dChjb21wbGV0aW9uS2V5\nLCBuZXcgQWRkQ29tcGxldGlvbihjYiwgZW50cnlTaXplLCBjdHgpKTsKCiAg\nICAgICAgaW50IHRvdGFsSGVhZGVyU2l6ZSA9IDQgLy8gZm9yIHRoZSBsZW5n\ndGggb2YgdGhlIHBhY2tldAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIDQgLy8gZm9yIHRoZSB0eXBlIG9mIHJlcXVlc3QKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyBCb29raWVQcm90b2NvbC5NQVNURVJfS0VZ\nX0xFTkdUSDsgLy8gZm9yIHRoZSBtYXN0ZXIga2V5CgogICAgICAgIHRyeXsK\nICAgICAgICAgICAgQ2hhbm5lbEJ1ZmZlciBoZWFkZXIgPSBjaGFubmVsLmdl\ndENvbmZpZygpLmdldEJ1ZmZlckZhY3RvcnkoKS5nZXRCdWZmZXIodG90YWxI\nZWFkZXJTaXplKTsKCiAgICAgICAgICAgIGhlYWRlci53cml0ZUludCh0b3Rh\nbEhlYWRlclNpemUgLSA0ICsgZW50cnlTaXplKTsKICAgICAgICAgICAgaGVh\nZGVyLndyaXRlSW50KG5ldyBQYWNrZXRIZWFkZXIoQm9va2llUHJvdG9jb2wu\nQ1VSUkVOVF9QUk9UT0NPTF9WRVJTSU9OLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBCb29raWVQcm90b2NvbC5BRERF\nTlRSWSwgKHNob3J0KW9wdGlvbnMpLnRvSW50KCkpOwogICAgICAgICAgICBo\nZWFkZXIud3JpdGVCeXRlcyhtYXN0ZXJLZXksIDAsIEJvb2tpZVByb3RvY29s\nLk1BU1RFUl9LRVlfTEVOR1RIKTsKCiAgICAgICAgICAgIENoYW5uZWxCdWZm\nZXIgd3JhcHBlZEJ1ZmZlciA9IENoYW5uZWxCdWZmZXJzLndyYXBwZWRCdWZm\nZXIoaGVhZGVyLCB0b1NlbmQpOwoKICAgICAgICAgICAgQ2hhbm5lbEZ1dHVy\nZSBmdXR1cmUgPSBjaGFubmVsLndyaXRlKHdyYXBwZWRCdWZmZXIpOwogICAg\nICAgICAgICBmdXR1cmUuYWRkTGlzdGVuZXIobmV3IENoYW5uZWxGdXR1cmVM\naXN0ZW5lcigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoQ2hhbm5l\nbEZ1dHVyZSBmdXR1cmUpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgICAgIGlmIChmdXR1cmUuaXNTdWNjZXNzKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlN1Y2Nlc3Nm\ndWxseSB3cm90ZSByZXF1ZXN0IGZvciBhZGRpbmcgZW50cnk6ICIgKyBlbnRy\neUlkICsgIiBsZWRnZXItaWQ6ICIgKyBsZWRnZXJJZAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArICIgYm9va2llOiAiICsgY2hhbm5lbC5nZXRSZW1vdGVBZGRyZXNzKCkg\nKyAiIGVudHJ5IGxlbmd0aDogIiArIGVudHJ5U2l6ZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG90\nYWxCeXRlc091dHN0YW5kaW5nLmFkZEFuZEdldChlbnRyeVNpemUpOwogICAg\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGVycm9yT3V0QWRkS2V5KGNvbXBsZXRpb25LZXkpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7\nCiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIGUpIHsKICAgICAgICAgICAg\nTE9HLndhcm4oIkFkZCBlbnRyeSBvcGVyYXRpb24gZmFpbGVkIiwgZSk7CiAg\nICAgICAgICAgIGVycm9yT3V0QWRkS2V5KGNvbXBsZXRpb25LZXkpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWFkRW50cnlBbmRGZW5j\nZUxlZGdlcihmaW5hbCBsb25nIGxlZGdlcklkLCBieXRlW10gbWFzdGVyS2V5\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlu\nYWwgbG9uZyBlbnRyeUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgUmVhZEVudHJ5Q2FsbGJhY2sgY2IsIE9iamVjdCBjdHgp\nIHsKICAgICAgICBmaW5hbCBDb21wbGV0aW9uS2V5IGtleSA9IG5ldyBDb21w\nbGV0aW9uS2V5KGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAgICByZWFkQ29t\ncGxldGlvbnMucHV0KGtleSwgbmV3IFJlYWRDb21wbGV0aW9uKGNiLCBjdHgp\nKTsKCiAgICAgICAgaW50IHRvdGFsSGVhZGVyU2l6ZSA9IDQgLy8gZm9yIHRo\nZSBsZW5ndGggb2YgdGhlIHBhY2tldAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArIDQgLy8gZm9yIHJlcXVlc3QgdHlwZQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICArIDggLy8gZm9yIGxlZGdlcklkCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgOCAvLyBmb3IgZW50cnlJZAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIEJvb2tpZVByb3RvY29sLk1B\nU1RFUl9LRVlfTEVOR1RIOyAvLyBmb3IgbWFzdGVyS2V5CgogICAgICAgIENo\nYW5uZWxCdWZmZXIgdG1wRW50cnkgPSBjaGFubmVsLmdldENvbmZpZygpLmdl\ndEJ1ZmZlckZhY3RvcnkoKS5nZXRCdWZmZXIodG90YWxIZWFkZXJTaXplKTsK\nICAgICAgICB0bXBFbnRyeS53cml0ZUludCh0b3RhbEhlYWRlclNpemUgLSA0\nKTsKCiAgICAgICAgdG1wRW50cnkud3JpdGVJbnQobmV3IFBhY2tldEhlYWRl\ncihCb29raWVQcm90b2NvbC5DVVJSRU5UX1BST1RPQ09MX1ZFUlNJT04sCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb29r\naWVQcm90b2NvbC5SRUFERU5UUlksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBCb29raWVQcm90b2NvbC5GTEFHX0RPX0ZF\nTkNJTkcpLnRvSW50KCkpOwogICAgICAgIHRtcEVudHJ5LndyaXRlTG9uZyhs\nZWRnZXJJZCk7CiAgICAgICAgdG1wRW50cnkud3JpdGVMb25nKGVudHJ5SWQp\nOwogICAgICAgIHRtcEVudHJ5LndyaXRlQnl0ZXMobWFzdGVyS2V5LCAwLCBC\nb29raWVQcm90b2NvbC5NQVNURVJfS0VZX0xFTkdUSCk7CgogICAgICAgIENo\nYW5uZWxGdXR1cmUgZnV0dXJlID0gY2hhbm5lbC53cml0ZSh0bXBFbnRyeSk7\nCiAgICAgICAgZnV0dXJlLmFkZExpc3RlbmVyKG5ldyBDaGFubmVsRnV0dXJl\nTGlzdGVuZXIoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21wbGV0ZShDaGFubmVsRnV0dXJl\nIGZ1dHVyZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBp\nZiAoZnV0dXJlLmlzU3VjY2VzcygpKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiU3VjY2Vzc2Z1bGx5IHdyb3RlIHJlcXVlc3Qg\nZm9yIHJlYWRpbmcgZW50cnk6ICIgKyBlbnRyeUlkICsgIiBsZWRnZXItaWQ6\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbGVkZ2Vy\nSWQgKyAiIGJvb2tpZTogIiArIGNoYW5uZWwuZ2V0UmVtb3RlQWRkcmVzcygp\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIGVycm9yT3V0UmVhZEtleShrZXkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcmVhZEVudHJ5KGZpbmFsIGxvbmcg\nbGVkZ2VySWQsIGZpbmFsIGxvbmcgZW50cnlJZCwgUmVhZEVudHJ5Q2FsbGJh\nY2sgY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICBmaW5hbCBDb21wbGV0aW9u\nS2V5IGtleSA9IG5ldyBDb21wbGV0aW9uS2V5KGxlZGdlcklkLCBlbnRyeUlk\nKTsKICAgICAgICByZWFkQ29tcGxldGlvbnMucHV0KGtleSwgbmV3IFJlYWRD\nb21wbGV0aW9uKGNiLCBjdHgpKTsKCiAgICAgICAgaW50IHRvdGFsSGVhZGVy\nU2l6ZSA9IDQgLy8gZm9yIHRoZSBsZW5ndGggb2YgdGhlIHBhY2tldAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIDQgLy8gZm9yIHJlcXVlc3Qg\ndHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIDggLy8gZm9y\nIGxlZGdlcklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgODsg\nLy8gZm9yIGVudHJ5SWQKCiAgICAgICAgdHJ5ewogICAgICAgICAgICBDaGFu\nbmVsQnVmZmVyIHRtcEVudHJ5ID0gY2hhbm5lbC5nZXRDb25maWcoKS5nZXRC\ndWZmZXJGYWN0b3J5KCkuZ2V0QnVmZmVyKHRvdGFsSGVhZGVyU2l6ZSk7CiAg\nICAgICAgICAgIHRtcEVudHJ5LndyaXRlSW50KHRvdGFsSGVhZGVyU2l6ZSAt\nIDQpOwoKICAgICAgICAgICAgdG1wRW50cnkud3JpdGVJbnQobmV3IFBhY2tl\ndEhlYWRlcihCb29raWVQcm90b2NvbC5DVVJSRU5UX1BST1RPQ09MX1ZFUlNJ\nT04sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQm9va2llUHJvdG9jb2wuUkVBREVOVFJZLCBCb29raWVQcm90b2Nv\nbC5GTEFHX05PTkUpLnRvSW50KCkpOwogICAgICAgICAgICB0bXBFbnRyeS53\ncml0ZUxvbmcobGVkZ2VySWQpOwogICAgICAgICAgICB0bXBFbnRyeS53cml0\nZUxvbmcoZW50cnlJZCk7CgogICAgICAgICAgICBDaGFubmVsRnV0dXJlIGZ1\ndHVyZSA9IGNoYW5uZWwud3JpdGUodG1wRW50cnkpOwogICAgICAgICAgICBm\ndXR1cmUuYWRkTGlzdGVuZXIobmV3IENoYW5uZWxGdXR1cmVMaXN0ZW5lcigp\nIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoQ2hhbm5lbEZ1dHVyZSBm\ndXR1cmUpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICAgICAgICAg\nIGlmIChmdXR1cmUuaXNTdWNjZXNzKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlN1Y2Nlc3NmdWxseSB3cm90\nZSByZXF1ZXN0IGZvciByZWFkaW5nIGVudHJ5OiAiICsgZW50cnlJZCArICIg\nbGVkZ2VyLWlkOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbGVkZ2VySWQgKyAiIGJv\nb2tpZTogIiArIGNoYW5uZWwuZ2V0UmVtb3RlQWRkcmVzcygpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yT3V0UmVhZEtleShr\nZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaChUaHJvd2FibGUgZSkg\newogICAgICAgICAgICBMT0cud2FybigiUmVhZCBlbnRyeSBvcGVyYXRpb24g\nZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGVycm9yT3V0UmVhZEtleShrZXkp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERpc2Nvbm5lY3Rz\nIHRoZSBib29raWUgY2xpZW50LiBJdCBjYW4gYmUgcmV1c2VkLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBkaXNjb25uZWN0KCkgewogICAgICAgIGNsb3Nl\nSW50ZXJuYWwoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2Vz\nIHRoZSBib29raWUgY2xpZW50IHBlcm1hbmVudGx5LiBJdCBjYW5ub3QgYmUg\ncmV1c2VkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAg\nICAgICBjbG9zZUludGVybmFsKHRydWUpOwogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBjbG9zZUludGVybmFsKGJvb2xlYW4gcGVybWFuZW50KSB7CiAgICAg\nICAgQ2hhbm5lbCB0b0Nsb3NlID0gbnVsbDsKICAgICAgICBzeW5jaHJvbml6\nZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYgKHBlcm1hbmVudCkgewogICAg\nICAgICAgICAgICAgc3RhdGUgPSBDb25uZWN0aW9uU3RhdGUuQ0xPU0VEOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlICE9IENvbm5lY3Rpb25TdGF0\nZS5DTE9TRUQpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gQ29ubmVjdGlv\nblN0YXRlLkRJU0NPTk5FQ1RFRDsKICAgICAgICAgICAgfQogICAgICAgICAg\nICB0b0Nsb3NlID0gY2hhbm5lbDsKICAgICAgICAgICAgY2hhbm5lbCA9IG51\nbGw7CiAgICAgICAgfQogICAgICAgIGlmICh0b0Nsb3NlICE9IG51bGwpIHsK\nICAgICAgICAgICAgY2xvc2VDaGFubmVsKHRvQ2xvc2UpLmF3YWl0VW5pbnRl\ncnJ1cHRpYmx5KCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgQ2hh\nbm5lbEZ1dHVyZSBjbG9zZUNoYW5uZWwoQ2hhbm5lbCBjKSB7CiAgICAgICAg\nTE9HLmRlYnVnKCJDbG9zaW5nIGNoYW5uZWwge30iLCBjKTsKICAgICAgICBS\nZWFkVGltZW91dEhhbmRsZXIgdGltZW91dCA9IGMuZ2V0UGlwZWxpbmUoKS5n\nZXQoUmVhZFRpbWVvdXRIYW5kbGVyLmNsYXNzKTsKICAgICAgICBpZiAodGlt\nZW91dCAhPSBudWxsKSB7CiAgICAgICAgICAgIHRpbWVvdXQucmVsZWFzZUV4\ndGVybmFsUmVzb3VyY2VzKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBj\nLmNsb3NlKCk7CiAgICB9CgogICAgdm9pZCBlcnJvck91dFJlYWRLZXkoZmlu\nYWwgQ29tcGxldGlvbktleSBrZXkpIHsKICAgICAgICBleGVjdXRvci5zdWJt\naXRPcmRlcmVkKGtleS5sZWRnZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHNhZmVSdW4oKSB7CgogICAgICAgICAgICAgICAgUmVhZENvbXBsZXRpb24g\ncmVhZENvbXBsZXRpb24gPSByZWFkQ29tcGxldGlvbnMucmVtb3ZlKGtleSk7\nCiAgICAgICAgICAgICAgICBTdHJpbmcgYkFkZHJlc3MgPSAibnVsbCI7CiAg\nICAgICAgICAgICAgICBDaGFubmVsIGMgPSBjaGFubmVsOwogICAgICAgICAg\nICAgICAgaWYoYyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYkFk\nZHJlc3MgPSBjLmdldFJlbW90ZUFkZHJlc3MoKS50b1N0cmluZygpOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZWFkQ29tcGxl\ndGlvbiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVn\nKCJDb3VsZCBub3Qgd3JpdGUgcmVxdWVzdCBmb3IgcmVhZGluZyBlbnRyeTog\ne30iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBsZWRnZXIt\naWQ6IHt9IGJvb2tpZToge30iLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W10geyBrZXkuZW50cnlJZCwga2V5LmxlZGdlcklk\nLCBiQWRkcmVzcyB9KTsKCiAgICAgICAgICAgICAgICAgICAgcmVhZENvbXBs\nZXRpb24uY2IucmVhZEVudHJ5Q29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5C\nb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24sCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\na2V5LmxlZGdlcklkLCBrZXkuZW50cnlJZCwgbnVsbCwgcmVhZENvbXBsZXRp\nb24uY3R4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICB9KTsKICAgIH0KCiAgICB2b2lkIGVycm9yT3V0QWRkS2V5KGZpbmFs\nIENvbXBsZXRpb25LZXkga2V5KSB7CiAgICAgICAgZXhlY3V0b3Iuc3VibWl0\nT3JkZXJlZChrZXkubGVkZ2VySWQsIG5ldyBTYWZlUnVubmFibGUoKSB7CiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBz\nYWZlUnVuKCkgewoKICAgICAgICAgICAgICAgIEFkZENvbXBsZXRpb24gYWRk\nQ29tcGxldGlvbiA9IGFkZENvbXBsZXRpb25zLnJlbW92ZShrZXkpOwoKICAg\nICAgICAgICAgICAgIGlmIChhZGRDb21wbGV0aW9uICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICBTdHJpbmcgYkFkZHJlc3MgPSAibnVsbCI7CiAg\nICAgICAgICAgICAgICAgICAgQ2hhbm5lbCBjID0gY2hhbm5lbDsKICAgICAg\nICAgICAgICAgICAgICBpZihjICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgYkFkZHJlc3MgPSBjLmdldFJlbW90ZUFkZHJlc3MoKS50b1N0\ncmluZygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBMT0cuZGVidWcoIkNvdWxkIG5vdCB3cml0ZSByZXF1ZXN0IGZvciBh\nZGRpbmcgZW50cnk6IHt9IGxlZGdlci1pZDoge30gYm9va2llOiB7fSIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGtl\neS5lbnRyeUlkLCBrZXkubGVkZ2VySWQsIGJBZGRyZXNzIH0pOwoKICAgICAg\nICAgICAgICAgICAgICBhZGRDb21wbGV0aW9uLmNiLndyaXRlQ29tcGxldGUo\nQktFeGNlcHRpb24uQ29kZS5Cb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNl\ncHRpb24sIGtleS5sZWRnZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5LmVudHJ5SWQsIGFkZHIs\nIGFkZENvbXBsZXRpb24uY3R4KTsKICAgICAgICAgICAgICAgICAgICBMT0cu\nZGVidWcoIkludm9rZWQgY2FsbGJhY2sgbWV0aG9kOiB7fSIsIGtleS5lbnRy\neUlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICB9KTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBFcnJvcnMgb3V0IHBlbmRp\nbmcgZW50cmllcy4gV2UgY2FsbCB0aGlzIG1ldGhvZCBmcm9tIG9uZSB0aHJl\nYWQgdG8gYXZvaWQKICAgICAqIGNvbmN1cnJlbnQgZXhlY3V0aW9ucyB0byBR\ndW9ydW1PcE1vbml0b3IgKGltcGxlbWVudHMgY2FsbGJhY2tzKS4gSXQgc2Vl\nbXMKICAgICAqIHNpbXBsZXIgdG8gY2FsbCBpdCBmcm9tIEJvb2tpZUhhbmRs\nZSBpbnN0ZWFkIG9mIGNhbGxpbmcgZGlyZWN0bHkgZnJvbQogICAgICogaGVy\nZS4KICAgICAqLwoKICAgIHZvaWQgZXJyb3JPdXRPdXRzdGFuZGluZ0VudHJp\nZXMoKSB7CgogICAgICAgIC8vIERPIE5PVCByZXdyaXRlIHRoZXNlIHVzaW5n\nIE1hcC5FbnRyeSBpdGVyYXRpb25zLiBXZSB3YW50IHRvIGl0ZXJhdGUKICAg\nICAgICAvLyBvbiBrZXlzIGFuZCBzZWUgaWYgd2UgYXJlIHN1Y2Nlc3NmdWxs\neSBhYmxlIHRvIHJlbW92ZSB0aGUga2V5IGZyb20KICAgICAgICAvLyB0aGUg\nbWFwLiBCZWNhdXNlIHRoZSBhZGQgYW5kIHRoZSByZWFkIG1ldGhvZHMgYWxz\nbyBkbyB0aGUgc2FtZSB0aGluZwogICAgICAgIC8vIGluIGNhc2UgdGhleSBn\nZXQgYSB3cml0ZSBmYWlsdXJlIG9uIHRoZSBzb2NrZXQuIFRoZSBvbmUgd2hv\nCiAgICAgICAgLy8gc3VjY2Vzc2Z1bGx5IHJlbW92ZXMgdGhlIGtleSBmcm9t\nIHRoZSBtYXAgaXMgdGhlIG9uZSByZXNwb25zaWJsZSBmb3IKICAgICAgICAv\nLyBjYWxsaW5nIHRoZSBhcHBsaWNhdGlvbiBjYWxsYmFjay4KCiAgICAgICAg\nZm9yIChDb21wbGV0aW9uS2V5IGtleSA6IGFkZENvbXBsZXRpb25zLmtleVNl\ndCgpKSB7CiAgICAgICAgICAgIGVycm9yT3V0QWRkS2V5KGtleSk7CiAgICAg\nICAgfQoKICAgICAgICBmb3IgKENvbXBsZXRpb25LZXkga2V5IDogcmVhZENv\nbXBsZXRpb25zLmtleVNldCgpKSB7CiAgICAgICAgICAgIGVycm9yT3V0UmVh\nZEtleShrZXkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIElu\nIHRoZSBuZXR0eSBwaXBlbGluZSwgd2UgbmVlZCB0byBzcGxpdCBwYWNrZXRz\nIGJhc2VkIG9uIGxlbmd0aCwgc28gd2UKICAgICAqIHVzZSB0aGUge0BsaW5r\nIExlbmd0aEZpZWxkQmFzZWRGcmFtZURlY29kZXJ9LiBPdGhlciB0aGFuIHRo\nYXQgYWxsIGFjdGlvbnMKICAgICAqIGFyZSBjYXJyaWVkIG91dCBpbiB0aGlz\nIGNsYXNzLCBlLmcuLCBtYWtpbmcgc2Vuc2Ugb2YgcmVjZWl2ZWQgbWVzc2Fn\nZXMsCiAgICAgKiBwcmVwZW5kaW5nIHRoZSBsZW5ndGggdG8gb3V0Z29pbmcg\ncGFja2V0cyBldGMuCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIENoYW5uZWxQaXBlbGluZSBnZXRQaXBlbGluZSgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIENoYW5uZWxQaXBlbGluZSBwaXBlbGluZSA9IENoYW5u\nZWxzLnBpcGVsaW5lKCk7CgogICAgICAgIHBpcGVsaW5lLmFkZExhc3QoInJl\nYWRUaW1lb3V0IiwgbmV3IFJlYWRUaW1lb3V0SGFuZGxlcihuZXcgSGFzaGVk\nV2hlZWxUaW1lcigpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25mLmdldFJlYWRU\naW1lb3V0KCkpKTsKICAgICAgICBwaXBlbGluZS5hZGRMYXN0KCJsZW5ndGhi\nYXNlZGZyYW1lZGVjb2RlciIsIG5ldyBMZW5ndGhGaWVsZEJhc2VkRnJhbWVE\nZWNvZGVyKE1BWF9GUkFNRV9MRU5HVEgsIDAsIDQsIDAsIDQpKTsKICAgICAg\nICBwaXBlbGluZS5hZGRMYXN0KCJtYWluaGFuZGxlciIsIHRoaXMpOwogICAg\nICAgIHJldHVybiBwaXBlbGluZTsKICAgIH0KCiAgICAvKioKICAgICAqIElm\nIG91ciBjaGFubmVsIGhhcyBkaXNjb25uZWN0ZWQsIHdlIGp1c3QgZXJyb3Ig\nb3V0IHRoZSBwZW5kaW5nIGVudHJpZXMKICAgICAqLwogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgdm9pZCBjaGFubmVsRGlzY29ubmVjdGVkKENoYW5uZWxI\nYW5kbGVyQ29udGV4dCBjdHgsIENoYW5uZWxTdGF0ZUV2ZW50IGUpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIENoYW5uZWwgYyA9IGN0eC5nZXRDaGFu\nbmVsKCk7CiAgICAgICAgTE9HLmluZm8oIkRpc2Nvbm5lY3RlZCBmcm9tIGJv\nb2tpZSBjaGFubmVsIHt9IiwgYyk7CiAgICAgICAgaWYgKGMgIT0gbnVsbCkg\newogICAgICAgICAgICBjbG9zZUNoYW5uZWwoYyk7CiAgICAgICAgfQoKICAg\nICAgICBlcnJvck91dE91dHN0YW5kaW5nRW50cmllcygpOwoKICAgICAgICBz\neW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYgKHRoaXMuY2hh\nbm5lbCA9PSBjCiAgICAgICAgICAgICAgICAmJiBzdGF0ZSAhPSBDb25uZWN0\naW9uU3RhdGUuQ0xPU0VEKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IENv\nbm5lY3Rpb25TdGF0ZS5ESVNDT05ORUNURUQ7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIC8vIHdlIGRvbid0IHdhbnQgdG8gcmVjb25uZWN0\nIHJpZ2h0IGF3YXkuIElmIHNvbWVvbmUgc2VuZHMgYSByZXF1ZXN0IHRvCiAg\nICAgICAgLy8gdGhpcyBhZGRyZXNzLCB3ZSB3aWxsIHJlY29ubmVjdC4KICAg\nIH0KCiAgICAvKioKICAgICAqIENhbGxlZCBieSBuZXR0eSB3aGVuIGFuIGV4\nY2VwdGlvbiBoYXBwZW5zIGluIG9uZSBvZiB0aGUgbmV0dHkgdGhyZWFkcwog\nICAgICogKG1vc3RseSBkdWUgdG8gd2hhdCB3ZSBkbyBpbiB0aGUgbmV0dHkg\ndGhyZWFkcykKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCBleGNlcHRpb25DYXVnaHQoQ2hhbm5lbEhhbmRsZXJDb250ZXh0IGN0eCwg\nRXhjZXB0aW9uRXZlbnQgZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nVGhyb3dhYmxlIHQgPSBlLmdldENhdXNlKCk7CiAgICAgICAgaWYgKHQgaW5z\ndGFuY2VvZiBDb3JydXB0ZWRGcmFtZUV4Y2VwdGlvbiB8fCB0IGluc3RhbmNl\nb2YgVG9vTG9uZ0ZyYW1lRXhjZXB0aW9uKSB7CiAgICAgICAgICAgIExPRy5l\ncnJvcigiQ29ycnVwdGVkIGZyYW1lIHJlY2VpdmVkIGZyb20gYm9va2llOiB7\nfSIsCiAgICAgICAgICAgICAgICAgICAgICBlLmdldENoYW5uZWwoKS5nZXRS\nZW1vdGVBZGRyZXNzKCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIGlmICh0IGluc3RhbmNlb2YgUmVhZFRpbWVvdXRFeGNlcHRp\nb24pIHsKICAgICAgICAgICAgZm9yIChDb21wbGV0aW9uS2V5IGtleSA6IGFk\nZENvbXBsZXRpb25zLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICBpZiAo\na2V5LnNob3VsZFRpbWVvdXQoKSkgewogICAgICAgICAgICAgICAgICAgIGVy\ncm9yT3V0QWRkS2V5KGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgZm9yIChDb21wbGV0aW9uS2V5IGtleSA6IHJl\nYWRDb21wbGV0aW9ucy5rZXlTZXQoKSkgewogICAgICAgICAgICAgICAgaWYg\nKGtleS5zaG91bGRUaW1lb3V0KCkpIHsKICAgICAgICAgICAgICAgICAgICBl\ncnJvck91dFJlYWRLZXkoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICBpZiAodCBpbnN0YW5jZW9mIElPRXhjZXB0aW9uKSB7CiAgICAgICAgICAg\nIC8vIHRoZXNlIGFyZSB0aHJvd24gd2hlbiBhIGJvb2tpZSBmYWlscywgbG9n\nZ2luZyB0aGVtIGp1c3QgcG9sbHV0ZXMKICAgICAgICAgICAgLy8gdGhlIGxv\nZ3MgKHRoZSBmYWlsdXJlIGlzIGxvZ2dlZCBmcm9tIHRoZSBsaXN0ZW5lcnMg\nb24gdGhlIHdyaXRlCiAgICAgICAgICAgIC8vIG9wZXJhdGlvbiksIHNvIEkn\nbGwganVzdCBpZ25vcmUgaXQgaGVyZS4KICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAg\nICAgICAgIGlmIChzdGF0ZSA9PSBDb25uZWN0aW9uU3RhdGUuQ0xPU0VEKSB7\nCiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlVuZXhwZWN0ZWQgZXhjZXB0\naW9uIGNhdWdodCBieSBib29raWUgY2xpZW50IGNoYW5uZWwgaGFuZGxlciwg\nIgogICAgICAgICAgICAgICAgICAgICAgICAgICsgImJ1dCB0aGUgY2xpZW50\nIGlzIGNsb3NlZCwgc28gaXQgaXNuJ3QgaW1wb3J0YW50IiwgdCk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlVu\nZXhwZWN0ZWQgZXhjZXB0aW9uIGNhdWdodCBieSBib29raWUgY2xpZW50IGNo\nYW5uZWwgaGFuZGxlciIsIHQpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIC8vIFNpbmNlIHdlIGFyZSBhIGxpYnJhcnksIGNhbnQgdGVybWlu\nYXRlIEFwcCBoZXJlLCBjYW4gd2U/CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nYWxsZWQgYnkgbmV0dHkgd2hlbiBhIG1lc3NhZ2UgaXMgcmVjZWl2ZWQgb24g\nYSBjaGFubmVsCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgbWVzc2FnZVJlY2VpdmVkKENoYW5uZWxIYW5kbGVyQ29udGV4dCBjdHgs\nIE1lc3NhZ2VFdmVudCBlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoIShlLmdldE1lc3NhZ2UoKSBpbnN0YW5jZW9mIENoYW5uZWxCdWZmZXIp\nKSB7CiAgICAgICAgICAgIGN0eC5zZW5kVXBzdHJlYW0oZSk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGZpbmFsIENoYW5uZWxC\ndWZmZXIgYnVmZmVyID0gKENoYW5uZWxCdWZmZXIpIGUuZ2V0TWVzc2FnZSgp\nOwogICAgICAgIGZpbmFsIGludCByYzsKICAgICAgICBmaW5hbCBsb25nIGxl\nZGdlcklkLCBlbnRyeUlkOwogICAgICAgIGZpbmFsIFBhY2tldEhlYWRlciBo\nZWFkZXI7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGhlYWRlciA9IFBh\nY2tldEhlYWRlci5mcm9tSW50KGJ1ZmZlci5yZWFkSW50KCkpOwogICAgICAg\nICAgICByYyA9IGJ1ZmZlci5yZWFkSW50KCk7CiAgICAgICAgICAgIGxlZGdl\ncklkID0gYnVmZmVyLnJlYWRMb25nKCk7CiAgICAgICAgICAgIGVudHJ5SWQg\nPSBidWZmZXIucmVhZExvbmcoKTsKICAgICAgICB9IGNhdGNoIChJbmRleE91\ndE9mQm91bmRzRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiVW5wYXJzZWFibGUgcmVzcG9uc2UgZnJvbSBib29raWU6ICIgKyBhZGRy\nLCBleCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIGV4ZWN1dG9yLnN1Ym1pdE9yZGVyZWQobGVkZ2VySWQsIG5ldyBTYWZlUnVu\nbmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzYWZlUnVuKCkgewogICAgICAgICAgICAgICAgc3dpdGNo\nIChoZWFkZXIuZ2V0T3BDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2Ug\nQm9va2llUHJvdG9jb2wuQURERU5UUlk6CiAgICAgICAgICAgICAgICAgICAg\naGFuZGxlQWRkUmVzcG9uc2UobGVkZ2VySWQsIGVudHJ5SWQsIHJjKTsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2Ug\nQm9va2llUHJvdG9jb2wuUkVBREVOVFJZOgogICAgICAgICAgICAgICAgICAg\nIGhhbmRsZVJlYWRSZXNwb25zZShsZWRnZXJJZCwgZW50cnlJZCwgcmMsIGJ1\nZmZlcik7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigi\nVW5leHBlY3RlZCByZXNwb25zZSwgdHlwZTogIiArIGhlYWRlci5nZXRPcENv\nZGUoKSAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHJlY2Vp\ndmVkIGZyb20gYm9va2llOiAiICsgYWRkciArICIgLCBpZ25vcmluZyIpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAg\nICB9CgogICAgdm9pZCBoYW5kbGVBZGRSZXNwb25zZShsb25nIGxlZGdlcklk\nLCBsb25nIGVudHJ5SWQsIGludCByYykgewogICAgICAgIGlmIChMT0cuaXNE\nZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cuZGVidWcoIkdvdCBy\nZXNwb25zZSBmb3IgYWRkIHJlcXVlc3QgZnJvbSBib29raWU6IHt9IGZvciBs\nZWRnZXI6IHt9IGVudHJ5OiB7fSIKICAgICAgICAgICAgICAgICAgICAgICsg\nIiByYzoge30iLCBuZXcgT2JqZWN0W10geyBhZGRyLCBsZWRnZXJJZCwgZW50\ncnlJZCwgcmMgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBjb252ZXJ0IHRv\nIEJLRXhjZXB0aW9uIGNvZGUgYmVjYXVzZSB0aGF0cyB3aGF0IHRoZSB1cHBw\nZXIKICAgICAgICAvLyBsYXllcnMgZXhwZWN0LiBUaGlzIGlzIFVHTFksIHRo\nZXJlIHNob3VsZCBqdXN0IGJlIG9uZSBzZXQgb2YKICAgICAgICAvLyBlcnJv\nciBjb2Rlcy4KICAgICAgICBzd2l0Y2ggKHJjKSB7CiAgICAgICAgY2FzZSBC\nb29raWVQcm90b2NvbC5FT0s6CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRp\nb24uQ29kZS5PSzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBC\nb29raWVQcm90b2NvbC5FQkFEVkVSU0lPTjoKICAgICAgICAgICAgcmMgPSBC\nS0V4Y2VwdGlvbi5Db2RlLlByb3RvY29sVmVyc2lvbkV4Y2VwdGlvbjsKICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBCb29raWVQcm90b2NvbC5F\nRkVOQ0VEOgogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuTGVk\nZ2VyRmVuY2VkRXhjZXB0aW9uOwogICAgICAgICAgICBicmVhazsKICAgICAg\nICBjYXNlIEJvb2tpZVByb3RvY29sLkVVQToKICAgICAgICAgICAgcmMgPSBC\nS0V4Y2VwdGlvbi5Db2RlLlVuYXV0aG9yaXplZEFjY2Vzc0V4Y2VwdGlvbjsK\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBCb29raWVQcm90b2Nv\nbC5FUkVBRE9OTFk6CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29k\nZS5Xcml0ZU9uUmVhZE9ubHlCb29raWVFeGNlcHRpb247CiAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIExPRy53YXJu\nKCJBZGQgZm9yIGxlZGdlcjoge30sIGVudHJ5OiB7fSBmYWlsZWQgb24gYm9v\na2llOiB7fSIKICAgICAgICAgICAgICAgICAgICArICIgd2l0aCB1bmtub3du\nIGNvZGU6IHt9IiwgbmV3IE9iamVjdFtdIHsgbGVkZ2VySWQsIGVudHJ5SWQs\nIGFkZHIsIHJjIH0pOwogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNv\nZGUuV3JpdGVFeGNlcHRpb247CiAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nIH0KCiAgICAgICAgQWRkQ29tcGxldGlvbiBhYzsKICAgICAgICBhYyA9IGFk\nZENvbXBsZXRpb25zLnJlbW92ZShuZXcgQ29tcGxldGlvbktleShsZWRnZXJJ\nZCwgZW50cnlJZCkpOwogICAgICAgIGlmIChhYyA9PSBudWxsKSB7CiAgICAg\nICAgICAgIExPRy5kZWJ1ZygiVW5leHBlY3RlZCBhZGQgcmVzcG9uc2UgcmVj\nZWl2ZWQgZnJvbSBib29raWU6IHt9IGZvciBsZWRnZXI6IHt9IgogICAgICAg\nICAgICAgICAgICAgICsgIiwgZW50cnk6IHt9LCBpZ25vcmluZyIsIG5ldyBP\nYmplY3RbXSB7IGFkZHIsICBsZWRnZXJJZCwgZW50cnlJZCB9KTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gdG90YWxCeXRl\nc091dHN0YW5kaW5nLmFkZEFuZEdldCgtYWMuc2l6ZSk7CgogICAgICAgIGFj\nLmNiLndyaXRlQ29tcGxldGUocmMsIGxlZGdlcklkLCBlbnRyeUlkLCBhZGRy\nLCBhYy5jdHgpOwoKICAgIH0KCiAgICB2b2lkIGhhbmRsZVJlYWRSZXNwb25z\nZShsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQsIGludCByYywgQ2hhbm5l\nbEJ1ZmZlciBidWZmZXIpIHsKICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRlYnVnKCJHb3QgcmVzcG9uc2Ug\nZm9yIHJlYWQgcmVxdWVzdCBmcm9tIGJvb2tpZToge30gZm9yIGxlZGdlcjog\ne30gZW50cnk6IHt9IgogICAgICAgICAgICAgICAgICAgICsgIiByYzoge30g\nZW50cnkgbGVuZ3RoOiB7fSIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9i\namVjdFtdIHsgYWRkciwgbGVkZ2VySWQsIGVudHJ5SWQsIHJjLCBidWZmZXIu\ncmVhZGFibGVCeXRlcygpIH0pOwogICAgICAgIH0KCiAgICAgICAgLy8gY29u\ndmVydCB0byBCS0V4Y2VwdGlvbiBjb2RlIGJlY2F1c2UgdGhhdHMgd2hhdCB0\naGUgdXBwcGVyCiAgICAgICAgLy8gbGF5ZXJzIGV4cGVjdC4gVGhpcyBpcyBV\nR0xZLCB0aGVyZSBzaG91bGQganVzdCBiZSBvbmUgc2V0IG9mCiAgICAgICAg\nLy8gZXJyb3IgY29kZXMuCiAgICAgICAgaWYgKHJjID09IEJvb2tpZVByb3Rv\nY29sLkVPSykgewogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUu\nT0s7CiAgICAgICAgfSBlbHNlIGlmIChyYyA9PSBCb29raWVQcm90b2NvbC5F\nTk9FTlRSWSB8fCByYyA9PSBCb29raWVQcm90b2NvbC5FTk9MRURHRVIpIHsK\nICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk5vU3VjaEVudHJ5\nRXhjZXB0aW9uOwogICAgICAgIH0gZWxzZSBpZiAocmMgPT0gQm9va2llUHJv\ndG9jb2wuRUJBRFZFUlNJT04pIHsKICAgICAgICAgICAgcmMgPSBCS0V4Y2Vw\ndGlvbi5Db2RlLlByb3RvY29sVmVyc2lvbkV4Y2VwdGlvbjsKICAgICAgICB9\nIGVsc2UgaWYgKHJjID09IEJvb2tpZVByb3RvY29sLkVVQSkgewogICAgICAg\nICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuVW5hdXRob3JpemVkQWNjZXNz\nRXhjZXB0aW9uOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIExPRy53\nYXJuKCJSZWFkIGZvciBsZWRnZXI6IHt9LCBlbnRyeToge30gZmFpbGVkIG9u\nIGJvb2tpZToge30iCiAgICAgICAgICAgICAgICAgICAgKyAiIHdpdGggdW5r\nbm93biBjb2RlOiB7fSIsIG5ldyBPYmplY3RbXSB7IGxlZGdlcklkLCBlbnRy\neUlkLCBhZGRyLCByYyB9KTsKICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlv\nbi5Db2RlLlJlYWRFeGNlcHRpb247CiAgICAgICAgfQoKICAgICAgICBDb21w\nbGV0aW9uS2V5IGtleSA9IG5ldyBDb21wbGV0aW9uS2V5KGxlZGdlcklkLCBl\nbnRyeUlkKTsKICAgICAgICBSZWFkQ29tcGxldGlvbiByZWFkQ29tcGxldGlv\nbiA9IHJlYWRDb21wbGV0aW9ucy5yZW1vdmUoa2V5KTsKCiAgICAgICAgaWYg\nKHJlYWRDb21wbGV0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgLyoKICAg\nICAgICAgICAgICogVGhpcyBpcyBhIHNwZWNpYWwgY2FzZS4gV2hlbiByZWNv\ndmVyaW5nIGEgbGVkZ2VyLCBhIGNsaWVudAogICAgICAgICAgICAgKiBzdWJt\naXRzIGEgcmVhZCByZXF1ZXN0IHdpdGggaWQgLTEsIGFuZCByZWNlaXZlcyBh\nIHJlc3BvbnNlIHdpdGggYQogICAgICAgICAgICAgKiBkaWZmZXJlbnQgZW50\ncnkgaWQuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICAKICAgICAgICAg\nICAgcmVhZENvbXBsZXRpb24gPSByZWFkQ29tcGxldGlvbnMucmVtb3ZlKG5l\ndyBDb21wbGV0aW9uS2V5KGxlZGdlcklkLCBCb29raWVQcm90b2NvbC5MQVNU\nX0FERF9DT05GSVJNRUQpKTsKICAgICAgICB9CgogICAgICAgIGlmIChyZWFk\nQ29tcGxldGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgIExPRy5kZWJ1Zygi\nVW5leHBlY3RlZCByZWFkIHJlc3BvbnNlIHJlY2VpdmVkIGZyb20gYm9va2ll\nOiB7fSBmb3IgbGVkZ2VyOiB7fSIKICAgICAgICAgICAgICAgICAgICArICIs\nIGVudHJ5OiB7fSAsIGlnbm9yaW5nIiwgbmV3IE9iamVjdFtdIHsgYWRkciwg\nbGVkZ2VySWQsIGVudHJ5SWQgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIHJlYWRDb21wbGV0aW9uLmNiLnJlYWRFbnRyeUNv\nbXBsZXRlKHJjLCBsZWRnZXJJZCwgZW50cnlJZCwgYnVmZmVyLnNsaWNlKCks\nIHJlYWRDb21wbGV0aW9uLmN0eCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBC\nb2lsZXItcGxhdGUgd3JhcHBlciBjbGFzc2VzIGZvbGxvdwogICAgICoKICAg\nICAqLwogICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZwogICAgc3RhdGljIGNs\nYXNzIFJlYWRDb21wbGV0aW9uIHsKICAgICAgICBmaW5hbCBSZWFkRW50cnlD\nYWxsYmFjayBjYjsKICAgICAgICBmaW5hbCBPYmplY3QgY3R4OwoKICAgICAg\nICBwdWJsaWMgUmVhZENvbXBsZXRpb24oUmVhZEVudHJ5Q2FsbGJhY2sgY2Is\nIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAg\nICAgICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICB9CiAgICB9CgogICAg\nLy8gdmlzaWJsZSBmb3IgdGVzdGluZwogICAgc3RhdGljIGNsYXNzIEFkZENv\nbXBsZXRpb24gewogICAgICAgIGZpbmFsIFdyaXRlQ2FsbGJhY2sgY2I7CiAg\nICAgICAgLy9maW5hbCBsb25nIHNpemU7CiAgICAgICAgZmluYWwgT2JqZWN0\nIGN0eDsKCiAgICAgICAgcHVibGljIEFkZENvbXBsZXRpb24oV3JpdGVDYWxs\nYmFjayBjYiwgbG9uZyBzaXplLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAg\nIHRoaXMuY2IgPSBjYjsKICAgICAgICAgICAgLy90aGlzLnNpemUgPSBzaXpl\nOwogICAgICAgICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICB9CiAgICB9\nCgogICAgLy8gdmlzYWJsZSBmb3IgdGVzdGluZwogICAgQ29tcGxldGlvbktl\neSBuZXdDb21wbGV0aW9uS2V5KGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJ\nZCkgewogICAgICAgIHJldHVybiBuZXcgQ29tcGxldGlvbktleShsZWRnZXJJ\nZCwgZW50cnlJZCk7CiAgICB9CgogICAgLy8gdmlzYWJsZSBmb3IgdGVzdGlu\nZwogICAgY2xhc3MgQ29tcGxldGlvbktleSB7CiAgICAgICAgbG9uZyBsZWRn\nZXJJZDsKICAgICAgICBsb25nIGVudHJ5SWQ7CiAgICAgICAgZmluYWwgbG9u\nZyB0aW1lb3V0QXQ7CgogICAgICAgIENvbXBsZXRpb25LZXkobG9uZyBsZWRn\nZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgICAgIHRoaXMubGVkZ2Vy\nSWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5lbnRyeUlkID0gZW50\ncnlJZDsKICAgICAgICAgICAgdGhpcy50aW1lb3V0QXQgPSBNYXRoVXRpbHMu\nbm93KCkgKyAoY29uZi5nZXRSZWFkVGltZW91dCgpKjEwMDApOwogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvYmopIHsKICAgICAgICAgICAgaWYgKCEob2JqIGlu\nc3RhbmNlb2YgQ29tcGxldGlvbktleSkgfHwgb2JqID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBDb21wbGV0aW9uS2V5IHRoYXQgPSAoQ29tcGxldGlvbktleSkg\nb2JqOwogICAgICAgICAgICByZXR1cm4gdGhpcy5sZWRnZXJJZCA9PSB0aGF0\nLmxlZGdlcklkICYmIHRoaXMuZW50cnlJZCA9PSB0aGF0LmVudHJ5SWQ7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgaW50\nIGhhc2hDb2RlKCkgewogICAgICAgICAgICByZXR1cm4gKChpbnQpIGxlZGdl\ncklkIDw8IDE2KSBeICgoaW50KSBlbnRyeUlkKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBTdHJpbmcuZm9ybWF0KCJMZWRnZXJFbnRyeSglZCwgJWQpIiwgbGVk\nZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gc2hvdWxkVGltZW91dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRo\naXMudGltZW91dEF0IDw9IE1hdGhVdGlscy5ub3coKTsKICAgICAgICB9CiAg\nICB9Cgp9Cg==\n","encoding":"base64"}

