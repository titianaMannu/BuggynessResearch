{"sha":"55c57af95c1cb671a88a5383acaee4a0d2b55062","node_id":"MDQ6QmxvYjE1NzU5NTY6NTVjNTdhZjk1YzFjYjY3MWE4OGE1MzgzYWNhZWU0YTBkMmI1NTA2Mg==","size":13015,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/55c57af95c1cb671a88a5383acaee4a0d2b55062","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CgppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3RlRm9ybWF0\nOwppbXBvcnQgY29tLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJs\nZUZvclRlc3Rpbmc7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVj\ndXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvclNl\ncnZpY2U7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaHJlYWRGYWN0\nb3J5OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21p\nY0Jvb2xlYW47CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYu\nU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWls\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51\ndGlsLkJvb2tLZWVwZXJDb25zdGFudHM7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5X\nYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVudC5F\ndmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVy\nLkV2ZW50LktlZXBlclN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLlRl\neHRGb3JtYXQ7CmltcG9ydCBzdGF0aWMgY29tLmdvb2dsZS5jb21tb24uYmFz\nZS5DaGFyc2V0cy5VVEZfODsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogUGVyZm9y\nbWluZyBhdWRpdG9yIGVsZWN0aW9uIHVzaW5nIEFwYWNoZSBab29LZWVwZXIu\nIFVzaW5nIFpvb0tlZXBlciBhcyBhCiAqIGNvb3JkaW5hdGlvbiBzZXJ2aWNl\nLCB3aGVuIGEgYm9va2llIGJpZHMgZm9yIGF1ZGl0b3IsIGl0IGNyZWF0ZXMg\nYW4gZXBoZW1lcmFsCiAqIHNlcXVlbnRpYWwgZmlsZSAoem5vZGUpIG9uIFpv\nb0tlZXBlciBhbmQgY29uc2lkZXJlZCBhcyB0aGVpciB2b3RlLiBWb3RlCiAq\nIGZvcm1hdCBpcyAnVl9zZXF1ZW5jZW51bWJlcicuIEVsZWN0aW9uIHdpbGwg\nYmUgZG9uZSBieSBjb21wYXJpbmcgdGhlCiAqIGVwaGVtZXJhbCBzZXF1ZW50\naWFsIG51bWJlcnMgYW5kIHRoZSBib29raWUgd2hpY2ggaGFzIGNyZWF0ZWQg\ndGhlIGxlYXN0IHpub2RlCiAqIHdpbGwgYmUgZWxlY3RlZCBhcyBBdWRpdG9y\nLiBBbGwgdGhlIG90aGVyIGJvb2tpZXMgd2lsbCBiZSB3YXRjaGluZyBvbiB0\naGVpcgogKiBwcmVkZWNlc3NvciB6bm9kZSBhY2NvcmRpbmcgdG8gdGhlIGVw\naGVtZXJhbCBzZXF1ZW5jZSBudW1iZXJzLgogKi8KcHVibGljIGNsYXNzIEF1\nZGl0b3JFbGVjdG9yIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dl\nciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAgICAgICAgIC5nZXRMb2dnZXIo\nQXVkaXRvckVsZWN0b3IuY2xhc3MpOwogICAgLy8gUmVwcmVzZW50cyB0aGUg\naW5kZXggb2YgdGhlIGF1ZGl0b3Igbm9kZQogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEFVRElUT1JfSU5ERVggPSAwOwogICAgLy8gUmVwcmVzZW50\ncyB2b3RlIHByZWZpeAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5n\nIFZPVEVfUFJFRklYID0gIlZfIjsKICAgIC8vIFJlcHJlc2VudHMgcGF0aCBT\nZXBhcmF0b3IKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBQQVRI\nX1NFUEFSQVRPUiA9ICIvIjsKICAgIC8vIFJlcHJlc2VudHMgdXJMZWRnZXIg\ncGF0aCBpbiB6awogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgYmFzZVBhdGg7\nCiAgICAvLyBSZXByZXNlbnRzIGF1ZGl0b3IgZWxlY3Rpb24gcGF0aCBpbiB6\nawogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgZWxlY3Rpb25QYXRoOwoKICAg\nIHByaXZhdGUgZmluYWwgU3RyaW5nIGJvb2tpZUlkOwogICAgcHJpdmF0ZSBm\naW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICBwcml2YXRlIGZp\nbmFsIFpvb0tlZXBlciB6a2M7CiAgICBwcml2YXRlIGZpbmFsIEV4ZWN1dG9y\nU2VydmljZSBleGVjdXRvcjsKCiAgICBwcml2YXRlIFN0cmluZyBteVZvdGU7\nCiAgICBBdWRpdG9yIGF1ZGl0b3I7CiAgICBwcml2YXRlIEF0b21pY0Jvb2xl\nYW4gcnVubmluZyA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKCgogICAg\nLyoqCiAgICAgKiBBdWRpdG9yRWxlY3RvciBmb3IgcGVyZm9ybWluZyB0aGUg\nYXVkaXRvciBlbGVjdGlvbgogICAgICogCiAgICAgKiBAcGFyYW0gYm9va2ll\nSWQKICAgICAqICAgICAgICAgICAgLSBib29raWUgaWRlbnRpZmllciwgY29t\ncHJpc2VzIEhvc3RBZGRyZXNzOlBvcnQKICAgICAqIEBwYXJhbSBjb25mCiAg\nICAgKiAgICAgICAgICAgIC0gY29uZmlndXJhdGlvbgogICAgICogQHBhcmFt\nIHprYwogICAgICogICAgICAgICAgICAtIFpLIGluc3RhbmNlCiAgICAgKiBA\ndGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uCiAgICAgKiAgICAgICAgICAg\nICB0aHJvd3MgdW5hdmFpbGFibGUgZXhjZXB0aW9uIHdoaWxlIGluaXRpYWxp\nemluZyB0aGUgZWxlY3RvcgogICAgICovCiAgICBwdWJsaWMgQXVkaXRvckVs\nZWN0b3IoZmluYWwgU3RyaW5nIGJvb2tpZUlkLCBTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgWm9vS2VlcGVy\nIHprYykgdGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAgICAgICB0\naGlzLmJvb2tpZUlkID0gYm9va2llSWQ7CiAgICAgICAgdGhpcy5jb25mID0g\nY29uZjsKICAgICAgICB0aGlzLnprYyA9IHprYzsKICAgICAgICBiYXNlUGF0\naCA9IGNvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICcvJwogICAgICAg\nICAgICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlVOREVSX1JFUExJQ0FU\nSU9OX05PREU7CiAgICAgICAgZWxlY3Rpb25QYXRoID0gYmFzZVBhdGggKyAi\nL2F1ZGl0b3JlbGVjdGlvbiI7CiAgICAgICAgY3JlYXRlRWxlY3RvclBhdGgo\nKTsKICAgICAgICBleGVjdXRvciA9IEV4ZWN1dG9ycy5uZXdTaW5nbGVUaHJl\nYWRFeGVjdXRvcihuZXcgVGhyZWFkRmFjdG9yeSgpIHsKICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIFRocmVhZCBu\nZXdUaHJlYWQoUnVubmFibGUgcikgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgVGhyZWFkKHIsICJBdWRpdG9yRWxlY3Rvci0iK2Jvb2tpZUlk\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICB9CgoK\nCiAgICBwcml2YXRlIHZvaWQgY3JlYXRlTXlWb3RlKCkgdGhyb3dzIEtlZXBl\nckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIGlm\nIChudWxsID09IG15Vm90ZSB8fCBudWxsID09IHprYy5leGlzdHMobXlWb3Rl\nLCBmYWxzZSkpIHsKICAgICAgICAgICAgQXVkaXRvclZvdGVGb3JtYXQuQnVp\nbGRlciBidWlsZGVyID0gQXVkaXRvclZvdGVGb3JtYXQubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgICAgICAuc2V0Qm9va2llSWQoYm9va2llSWQpOwogICAg\nICAgICAgICBteVZvdGUgPSB6a2MuY3JlYXRlKGdldFZvdGVQYXRoKFBBVEhf\nU0VQQVJBVE9SICsgVk9URV9QUkVGSVgpLAogICAgICAgICAgICAgICAgICAg\nIFRleHRGb3JtYXQucHJpbnRUb1N0cmluZyhidWlsZGVyLmJ1aWxkKCkpLmdl\ndEJ5dGVzKFVURl84KSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAg\nICAgICAgICAgICBDcmVhdGVNb2RlLkVQSEVNRVJBTF9TRVFVRU5USUFMKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Vm90ZVBh\ndGgoU3RyaW5nIHZvdGUpIHsKICAgICAgICByZXR1cm4gZWxlY3Rpb25QYXRo\nICsgdm90ZTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY3JlYXRlRWxlY3Rv\nclBhdGgoKSB0aHJvd3MgVW5hdmFpbGFibGVFeGNlcHRpb24gewogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmICh6a2MuZXhpc3RzKGJhc2VQYXRoLCBm\nYWxzZSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICB6a2MuY3JlYXRlKGJhc2VQYXRoLCBuZXcgYnl0ZVsw\nXSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIENyZWF0ZU1vZGUuUEVSU0lTVEVOVCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24uTm9kZUV4aXN0c0V4Y2VwdGlv\nbiBuZWUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nLCBz\nb21lb25lIGVsc2UgY291bGQgaGF2ZSBjcmVhdGVkIGl0CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHprYy5leGlz\ndHMoZ2V0Vm90ZVBhdGgoIiIpLCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB6a2MuY3JlYXRl\nKGdldFZvdGVQYXRoKCIiKSwgbmV3IGJ5dGVbMF0sCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2Rl\nLlBFUlNJU1RFTlQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVy\nRXhjZXB0aW9uLk5vZGVFeGlzdHNFeGNlcHRpb24gbmVlKSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gZG8gbm90aGluZywgc29tZW9uZSBlbHNlIGNvdWxk\nIGhhdmUgY3JlYXRlZCBpdAogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVbmF2YWlsYWJsZUV4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGluaXRpYWxpemUgQXVkaXRv\nciBFbGVjdG9yIiwga2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVk\nRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhy\nZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIHRocm93IG5ldyBVbmF2\nYWlsYWJsZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAiRmFpbGVk\nIHRvIGluaXRpYWxpemUgQXVkaXRvciBFbGVjdG9yIiwgaWUpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdhdGNoaW5nIHRoZSBwcmVkZWNl\nc3NvciBib29raWVzIGFuZCB3aWxsIGRvIGVsZWN0aW9uIG9uIHByZWRlY2Vz\nc29yIG5vZGUKICAgICAqIGRlbGV0aW9uIG9yIGV4cGlyYXRpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgY2xhc3MgRWxlY3Rpb25XYXRjaGVyIGltcGxlbWVu\ndHMgV2F0Y2hlciB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAg\nICAgaWYgKGV2ZW50LmdldFN0YXRlKCkgPT0gS2VlcGVyU3RhdGUuRXhwaXJl\nZCkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJMb3N0IFpLIGNvbm5l\nY3Rpb24sIHNodXR0aW5nIGRvd24iKTsKICAgICAgICAgICAgICAgIHN1Ym1p\ndFNodXRkb3duVGFzaygpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50\nLmdldFR5cGUoKSA9PSBFdmVudFR5cGUuTm9kZURlbGV0ZWQpIHsKICAgICAg\nICAgICAgICAgIHN1Ym1pdEVsZWN0aW9uVGFzaygpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0KCkgewog\nICAgICAgIHJ1bm5pbmcuc2V0KHRydWUpOwogICAgICAgIHN1Ym1pdEVsZWN0\naW9uVGFzaygpOwogICAgfQoKICAgIC8qKgogICAgICogUnVuIGNsZWFudXAg\nb3BlcmF0aW9ucyBmb3IgdGhlIGF1ZGl0b3IgZWxlY3Rvci4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHN1Ym1pdFNodXRkb3duVGFzaygpIHsKICAgICAg\nICBleGVjdXRvci5zdWJtaXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAg\nIGlmICghcnVubmluZy5jb21wYXJlQW5kU2V0KHRydWUsIGZhbHNlKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJTaHV0dGlu\nZyBkb3duIEF1ZGl0b3JFbGVjdG9yIik7CiAgICAgICAgICAgICAgICAgICAg\naWYgKG15Vm90ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6a2MuZGVsZXRl\nKG15Vm90ZSwgLTEpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLndhcm4oIkludGVycnVwdGVkRXhjZXB0aW9uIHdo\naWxlIGRlbGV0aW5nIG15Vm90ZTogIiArIG15Vm90ZSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGllKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3\naGlsZSBkZWxldGluZyBteVZvdGU6IiArIG15Vm90ZSwga2UpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFBlcmZvcm1pbmcgdGhlIGF1ZGl0b3IgZWxlY3Rpb24gdXNpbmcg\ndGhlIFpvb0tlZXBlciBlcGhlbWVyYWwgc2VxdWVudGlhbAogICAgICogem5v\nZGUuIFRoZSBib29raWUgd2hpY2ggaGFzIGNyZWF0ZWQgdGhlIGxlYXN0IHNl\ncXVlbnRpYWwgd2lsbCBiZSBlbGVjdCBhcwogICAgICogQXVkaXRvci4KICAg\nICAqLwogICAgQFZpc2libGVGb3JUZXN0aW5nCiAgICB2b2lkIHN1Ym1pdEVs\nZWN0aW9uVGFzaygpIHsKCiAgICAgICAgUnVubmFibGUgciA9IG5ldyBSdW5u\nYWJsZSgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoIXJ1bm5pbmcuZ2V0KCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBjcmVhdGluZyBteSB2b3RlIGluIHprLiBWb3RlIGZv\ncm1hdCBpcyAnVl9udW1lcmljJwogICAgICAgICAgICAgICAgICAgICAgICBj\ncmVhdGVNeVZvdGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxT\ndHJpbmc+IGNoaWxkcmVuID0gemtjLmdldENoaWxkcmVuKGdldFZvdGVQYXRo\nKCIiKSwgZmFsc2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAg\nPj0gY2hpbGRyZW4uc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQXRsZWFzdCBvbmUg\nYm9va2llIHNlcnZlciBzaG91bGQgcHJlc2VudCB0byBlbGVjdCB0aGUgQXVk\naXRvciEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gc29ydGluZyBpbiBhc2NlbmRpbmcgb3JkZXIg\nb2Ygc2VxdWVudGlhbCBudW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAg\nQ29sbGVjdGlvbnMuc29ydChjaGlsZHJlbiwgbmV3IEVsZWN0aW9uQ29tcGFy\nYXRvcigpKTsKICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHZvdGVO\nb2RlID0gU3RyaW5nVXRpbHMuc3Vic3RyaW5nQWZ0ZXJMYXN0KG15Vm90ZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBBVEhfU0VQQVJBVE9SKTsK\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0aW5nIEF1ZGl0aW5n\nIHNlcnZpY2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVu\nLmdldChBVURJVE9SX0lOREVYKS5lcXVhbHModm90ZU5vZGUpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdGhlIGF1ZGl0b3Ig\nYm9va2llIGlkIGluIHRoZSBlbGVjdGlvbiBwYXRoLiBUaGlzIGlzCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyBkb25lIGZvciBkZWJ1Z2dpbmcg\ncHVycG9zZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgQXVkaXRvclZv\ndGVGb3JtYXQuQnVpbGRlciBidWlsZGVyID0gQXVkaXRvclZvdGVGb3JtYXQu\nbmV3QnVpbGRlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLnNldEJvb2tpZUlkKGJvb2tpZUlkKTsKCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB6a2Muc2V0RGF0YShnZXRWb3RlUGF0aCgiIiksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUZXh0Rm9ybWF0LnBy\naW50VG9TdHJpbmcoYnVpbGRlci5idWlsZCgpKS5nZXRCeXRlcyhVVEZfOCks\nIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGl0b3IgPSBu\nZXcgQXVkaXRvcihib29raWVJZCwgY29uZiwgemtjKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGF1ZGl0b3Iuc3RhcnQoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIElmIG5vdCBhbiBhdWRpdG9yLCB3aWxsIGJlIHdhdGNoaW5nIHRv\nIG15IHByZWRlY2Vzc29yIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gbG9va2luZyB0aGUgcHJldmlvdXMgbm9kZSBkZWxldGlvbi4KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIFdhdGNoZXIgZWxlY3Rpb25XYXRj\naGVyID0gbmV3IEVsZWN0aW9uV2F0Y2hlcigpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaW50IG15SW5kZXggPSBjaGlsZHJlbi5pbmRleE9mKHZv\ndGVOb2RlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBwcmV2\nTm9kZUluZGV4ID0gbXlJbmRleCAtIDE7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAobnVsbCA9PSB6a2MuZXhpc3RzKGdldFZvdGVQYXRoKFBB\nVEhfU0VQQVJBVE9SKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIGNoaWxkcmVuLmdldChwcmV2Tm9kZUlu\nZGV4KSwgZWxlY3Rpb25XYXRjaGVyKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIFdoaWxlIGFkZGluZywgdGhlIHByZXZpb3VzIHpu\nb2RlIGRvZXNuJ3QgZXhpc3RzLgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIEFnYWluIGdvaW5nIHRvIGVsZWN0aW9uLgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdEVsZWN0aW9uVGFzaygpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVy\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVy\ncm9yKCJFeGNlcHRpb24gd2hpbGUgcGVyZm9ybWluZyBhdWRpdG9yIGVsZWN0\naW9uIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdFNodXRk\nb3duVGFzaygpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLmVycm9yKCJJbnRlcnJ1cHRlZCB3aGlsZSBwZXJmb3JtaW5nIGF1ZGl0\nb3IgZWxlY3Rpb24iLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgVGhy\nZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgc3VibWl0U2h1dGRvd25UYXNrKCk7CiAgICAgICAgICAg\nICAgICAgICAgfSBjYXRjaCAoVW5hdmFpbGFibGVFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkxlZGdlciB1bmRl\ncnJlcGxpY2F0aW9uIG1hbmFnZXIgdW5hdmFpbGFibGUgZHVyaW5nIGVsZWN0\naW9uIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdFNodXRk\nb3duVGFzaygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICBleGVjdXRvci5zdWJtaXQo\ncik7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaHV0dGluZyBkb3duIEF1ZGl0\nb3JFbGVjdG9yCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNodXRkb3duKCkg\ndGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYgKGV4ZWN1dG9yLmlzU2h1\ndGRvd24oKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHN1Ym1pdFNodXRkb3duVGFzaygpOwogICAgICAg\nICAgICBleGVjdXRvci5zaHV0ZG93bigpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKGF1ZGl0b3IgIT0gbnVsbCkgewogICAgICAgICAgICBhdWRpdG9yLnNo\ndXRkb3duKCk7CiAgICAgICAgICAgIGF1ZGl0b3IgPSBudWxsOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIElmIGN1cnJlbnQgYm9va2llIGlz\nIHJ1bm5pbmcgYXMgYXVkaXRvciwgcmV0dXJuIHRoZSBzdGF0dXMgb2YgdGhl\nCiAgICAgKiBhdWRpdG9yLiBPdGhlcndpc2UgcmV0dXJuIHRoZSBzdGF0dXMg\nb2YgZWxlY3Rvci4KICAgICAqIAogICAgICogQHJldHVybgogICAgICovCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc1J1bm5pbmcoKSB7CiAgICAgICAgaWYgKGF1\nZGl0b3IgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gYXVkaXRvci5p\nc1J1bm5pbmcoKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJ1bm5pbmcu\nZ2V0KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYXJlIHRoZSB2b3Rl\ncyBpbiB0aGUgYXNjZW5kaW5nIG9yZGVyIG9mIHRoZSBzZXF1ZW5jZSBudW1i\nZXIuIFZvdGUKICAgICAqIGZvcm1hdCBpcyAnVl9zZXF1ZW5jZW51bWJlcics\nIGNvbXBhcmF0b3Igd2lsbCBkbyBzb3J0aW5nIGJhc2VkIG9uIHRoZQogICAg\nICogbnVtZXJpYyBzZXF1ZW5jZSB2YWx1ZS4KICAgICAqLwogICAgcHJpdmF0\nZSBzdGF0aWMgY2xhc3MgRWxlY3Rpb25Db21wYXJhdG9yCiAgICAgICAgaW1w\nbGVtZW50cyBDb21wYXJhdG9yPFN0cmluZz4sIFNlcmlhbGl6YWJsZSB7CiAg\nICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIC0xIGlmIHRoZSBmaXJzdCB2\nb3RlIGlzIGxlc3MgdGhhbiBzZWNvbmQuIFJldHVybiAxIGlmIHRoZQogICAg\nICAgICAqIGZpcnN0IHZvdGUgaXMgZ3JlYXRlciB0aGFuIHNlY29uZC4gUmV0\ndXJuIDAgaWYgdGhlIHZvdGVzIGFyZSBlcXVhbC4KICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgaW50IGNvbXBhcmUoU3RyaW5nIHZvdGUxLCBTdHJpbmcg\ndm90ZTIpIHsKICAgICAgICAgICAgbG9uZyB2b3RlU2VxSWQxID0gZ2V0Vm90\nZVNlcXVlbmNlSWQodm90ZTEpOwogICAgICAgICAgICBsb25nIHZvdGVTZXFJ\nZDIgPSBnZXRWb3RlU2VxdWVuY2VJZCh2b3RlMik7CiAgICAgICAgICAgIGlu\ndCByZXN1bHQgPSB2b3RlU2VxSWQxIDwgdm90ZVNlcUlkMiA/IC0xCiAgICAg\nICAgICAgICAgICAgICAgOiAodm90ZVNlcUlkMSA+IHZvdGVTZXFJZDIgPyAx\nIDogMCk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfQoK\nICAgICAgICBwcml2YXRlIGxvbmcgZ2V0Vm90ZVNlcXVlbmNlSWQoU3RyaW5n\nIHZvdGUpIHsKICAgICAgICAgICAgU3RyaW5nIHZvdGVJZCA9IFN0cmluZ1V0\naWxzLnN1YnN0cmluZ0FmdGVyKHZvdGUsIFZPVEVfUFJFRklYKTsKICAgICAg\nICAgICAgcmV0dXJuIExvbmcucGFyc2VMb25nKHZvdGVJZCk7CiAgICAgICAg\nfQogICAgfQp9Cg==\n","encoding":"base64"}

