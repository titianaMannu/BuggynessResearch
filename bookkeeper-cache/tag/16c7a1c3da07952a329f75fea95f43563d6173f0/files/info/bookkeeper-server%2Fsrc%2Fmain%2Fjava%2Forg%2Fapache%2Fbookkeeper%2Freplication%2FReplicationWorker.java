{"sha":"1ac4be8e28c6130d1a69c250078dc52639a74503","node_id":"MDQ6QmxvYjE1NzU5NTY6MWFjNGJlOGUyOGM2MTMwZDFhNjljMjUwMDc4ZGM1MjYzOWE3NDUwMw==","size":14667,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1ac4be8e28c6130d1a69c250078dc52639a74503","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZSAKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24gCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UgCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQgCiAqIAogKiAgIGh0dHA6Ly93\nd3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMCAKICogCiAqIFVu\nbGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8g\naW4gd3JpdGluZywgCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRo\nZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIAogKiAiQVMgSVMiIEJB\nU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkg\nCiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhl\nIExpY2Vuc2UgZm9yIHRoZSAKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJu\naW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyAKICogdW5kZXIgdGhl\nIExpY2Vuc2UuIAogKiAKICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnJlcGxpY2F0aW9uOwoKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGph\ndmEudXRpbC5UaW1lcjsKaW1wb3J0IGphdmEudXRpbC5UaW1lclRhc2s7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2Vl\ncGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyQWRtaW47CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkxlZGdlckNoZWNrZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkxlZGdlckZyYWdtZW50OwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9uLkJLQm9va2llSGFu\nZGxlTm90QXZhaWxhYmxlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbi5CS05vU3VjaExlZGdlckV4\naXN0c0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuQktFeGNlcHRpb24uQktSZWFkRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5M\nZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhLkxlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRl\ncm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNlcHRp\nb24uQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2VwdGlvbi5V\nbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBSZXBsaWNhdGlv\nbldvcmtlciB3aWxsIHRha2UgdGhlIGZyYWdtZW50cyBvbmUgYnkgb25lIGZy\nb20KICogWktMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBhbmQgcmVw\nbGljYXRlcyB0byBpdC4KICovCnB1YmxpYyBjbGFzcyBSZXBsaWNhdGlvbldv\ncmtlciBpbXBsZW1lbnRzIFJ1bm5hYmxlIHsKICAgIHByaXZhdGUgc3RhdGlj\nIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAgICAgICAgIC5nZXRM\nb2dnZXIoUmVwbGljYXRpb25Xb3JrZXIuY2xhc3MpOwogICAgZmluYWwgcHJp\ndmF0ZSBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB1bmRlcnJlcGxp\nY2F0aW9uTWFuYWdlcjsKICAgIHByaXZhdGUgU2VydmVyQ29uZmlndXJhdGlv\nbiBjb25mOwogICAgcHJpdmF0ZSBab29LZWVwZXIgemtjOwogICAgcHJpdmF0\nZSB2b2xhdGlsZSBib29sZWFuIHdvcmtlclJ1bm5pbmcgPSBmYWxzZTsKICAg\nIGZpbmFsIHByaXZhdGUgQm9va0tlZXBlckFkbWluIGFkbWluOwogICAgcHJp\ndmF0ZSBMZWRnZXJDaGVja2VyIGxlZGdlckNoZWNrZXI7CiAgICBwcml2YXRl\nIEluZXRTb2NrZXRBZGRyZXNzIHRhcmdldEJvb2tpZTsKICAgIHByaXZhdGUg\nQm9va0tlZXBlciBia2M7CiAgICBwcml2YXRlIFRocmVhZCB3b3JrZXJUaHJl\nYWQ7CiAgICBwcml2YXRlIGxvbmcgb3BlbkxlZGdlclJlcmVwbGljYXRpb25H\ncmFjZVBlcmlvZDsKICAgIHByaXZhdGUgVGltZXIgcGVuZGluZ1JlcGxpY2F0\naW9uVGltZXI7CgogICAgLyoqCiAgICAgKiBSZXBsaWNhdGlvbiB3b3JrZXIg\nZm9yIHJlcGxpY2F0aW5nIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGZyb20KICAg\nICAqIFVuZGVyUmVwbGljYXRpb25NYW5hZ2VyIHRvIHRoZSB0YXJnZXRCb29r\naWUuIFRoaXMgdGFyZ2V0IGJvb2tpZSB3aWxsIGJlIGEKICAgICAqIGxvY2Fs\nIGJvb2tpZS4KICAgICAqIAogICAgICogQHBhcmFtIHprYwogICAgICogICAg\nICAgICAgICAtIFpLIGluc3RhbmNlCiAgICAgKiBAcGFyYW0gY29uZgogICAg\nICogICAgICAgICAgICAtIGNvbmZpZ3VyYXRpb25zCiAgICAgKiBAcGFyYW0g\ndGFyZ2V0QktBZGRyCiAgICAgKiAgICAgICAgICAgIC0gdG8gd2hlcmUgcmVw\nbGljYXRpb24gc2hvdWxkIGhhcHBlbi4gSWRlYWxseSB0aGlzIHdpbGwgYmUK\nICAgICAqICAgICAgICAgICAgbG9jYWwgQm9va2llIGFkZHJlc3MuCiAgICAg\nKi8KICAgIHB1YmxpYyBSZXBsaWNhdGlvbldvcmtlcihmaW5hbCBab29LZWVw\nZXIgemtjLAogICAgICAgICAgICBmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9u\nIGNvbmYsIEluZXRTb2NrZXRBZGRyZXNzIHRhcmdldEJLQWRkcikKICAgICAg\nICAgICAgdGhyb3dzIENvbXBhdGliaWxpdHlFeGNlcHRpb24sIEtlZXBlckV4\nY2VwdGlvbiwKICAgICAgICAgICAgSW50ZXJydXB0ZWRFeGNlcHRpb24sIElP\nRXhjZXB0aW9uIHsKICAgICAgICB0aGlzLnprYyA9IHprYzsKICAgICAgICB0\naGlzLmNvbmYgPSBjb25mOwogICAgICAgIHRoaXMudGFyZ2V0Qm9va2llID0g\ndGFyZ2V0QktBZGRyOwogICAgICAgIExlZGdlck1hbmFnZXJGYWN0b3J5IG1G\nYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkKICAgICAgICAgICAgICAg\nIC5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeSh0aGlzLmNvbmYsIHRoaXMuemtj\nKTsKICAgICAgICB0aGlzLnVuZGVycmVwbGljYXRpb25NYW5hZ2VyID0gbUZh\nY3RvcnkKICAgICAgICAgICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0\naW9uTWFuYWdlcigpOwogICAgICAgIHRoaXMuYmtjID0gbmV3IEJvb2tLZWVw\nZXIobmV3IENsaWVudENvbmZpZ3VyYXRpb24oY29uZiksIHprYyk7CiAgICAg\nICAgdGhpcy5hZG1pbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYmtjKTsKICAg\nICAgICB0aGlzLmxlZGdlckNoZWNrZXIgPSBuZXcgTGVkZ2VyQ2hlY2tlcihi\na2MpOwogICAgICAgIHRoaXMud29ya2VyVGhyZWFkID0gbmV3IFRocmVhZCh0\naGlzLCAiUmVwbGljYXRpb25Xb3JrZXIiKTsKICAgICAgICB0aGlzLm9wZW5M\nZWRnZXJSZXJlcGxpY2F0aW9uR3JhY2VQZXJpb2QgPSBjb25mCiAgICAgICAg\nICAgICAgICAuZ2V0T3BlbkxlZGdlclJlcmVwbGljYXRpb25HcmFjZVBlcmlv\nZCgpOwogICAgICAgIHRoaXMucGVuZGluZ1JlcGxpY2F0aW9uVGltZXIgPSBu\nZXcgVGltZXIoIlBlbmRpbmdSZXBsaWNhdGlvblRpbWVyIik7CiAgICB9Cgog\nICAgLyoqIFN0YXJ0IHRoZSByZXBsaWNhdGlvbiB3b3JrZXIgKi8KICAgIHB1\nYmxpYyB2b2lkIHN0YXJ0KCkgewogICAgICAgIHRoaXMud29ya2VyVGhyZWFk\nLnN0YXJ0KCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCBydW4oKSB7CiAgICAgICAgd29ya2VyUnVubmluZyA9IHRydWU7CiAgICAg\nICAgd2hpbGUgKHdvcmtlclJ1bm5pbmcpIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIHJlcmVwbGljYXRlKCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIHNodXRkb3duKCk7CiAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVu\ndFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIkludGVycnVwdGVkRXhjZXB0aW9uICIKICAgICAgICAgICAgICAgICAg\nICAgICAgKyAid2hpbGUgcmVwbGljYXRpbmcgZnJhZ21lbnRzIiwgZSk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gY2F0Y2ggKEJL\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHNodXRkb3duKCk7CiAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIkJLRXhjZXB0aW9uIHdoaWxlIHJl\ncGxpY2F0aW5nIGZyYWdtZW50cyIsIGUpOwogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9IGNhdGNoIChVbmF2YWlsYWJsZUV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICBzaHV0ZG93bigpOwogICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJVbmF2YWlsYWJsZUV4Y2VwdGlvbiAiCiAgICAg\nICAgICAgICAgICAgICAgICAgICsgIndoaWxlIHJlcGxpY2F0aW5nIGZyYWdt\nZW50cyIsIGUpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVwbGljYXRl\ncyB0aGUgdW5kZXIgcmVwbGljYXRlZCBmcmFnbWVudHMgZnJvbSBmYWlsZWQg\nYm9va2llIGxlZGdlciB0bwogICAgICogdGFyZ2V0Qm9va2llCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCByZXJlcGxpY2F0ZSgpIHRocm93cyBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24sCiAgICAgICAgICAgIFVuYXZh\naWxhYmxlRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGxlZGdlcklkVG9SZXBs\naWNhdGUgPSB1bmRlcnJlcGxpY2F0aW9uTWFuYWdlcgogICAgICAgICAgICAg\nICAgLmdldExlZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICBMT0cuZGVi\ndWcoIkdvaW5nIHRvIHJlcGxpY2F0ZSB0aGUgZnJhZ21lbnRzIG9mIHRoZSBs\nZWRnZXI6IHt9IiwgbGVkZ2VySWRUb1JlcGxpY2F0ZSk7CiAgICAgICAgTGVk\nZ2VySGFuZGxlIGxoOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxoID0g\nYWRtaW4ub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWRUb1JlcGxpY2F0\nZSk7CiAgICAgICAgfSBjYXRjaCAoQktOb1N1Y2hMZWRnZXJFeGlzdHNFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAvLyBMZWRnZXIgbWlnaHQgaGF2ZSBi\nZWVuIGRlbGV0ZWQgYnkgdXNlcgogICAgICAgICAgICBMT0cuaW5mbygiQktO\nb1N1Y2hMZWRnZXJFeGlzdHNFeGNlcHRpb24gd2hpbGUgb3BlbmluZyAiCiAg\nICAgICAgICAgICAgICAgICAgKyAibGVkZ2VyIGZvciByZXBsaWNhdGlvbi4g\nT3RoZXIgY2xpZW50cyAiCiAgICAgICAgICAgICAgICAgICAgKyAibWlnaHQg\naGF2ZSBkZWxldGVkIHRoZSBsZWRnZXIuICIKICAgICAgICAgICAgICAgICAg\nICArICJTbywgbm8gaGFybSB0byBjb250aW51ZSIpOwogICAgICAgICAgICB1\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlci5tYXJrTGVkZ2VyUmVwbGljYXRlZChs\nZWRnZXJJZFRvUmVwbGljYXRlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0gY2F0Y2ggKEJLUmVhZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIExPRy5pbmZvKCJCS1JlYWRFeGNlcHRpb24gd2hpbGUiCiAgICAgICAgICAg\nICAgICAgICAgKyAiIG9wZW5pbmcgbGVkZ2VyIGZvciByZXBsaWNhdGlvbi4i\nCiAgICAgICAgICAgICAgICAgICAgKyAiIEVub3VnaCBCb29raWVzIG1pZ2h0\nIG5vdCBoYXZlIGF2YWlsYWJsZSIKICAgICAgICAgICAgICAgICAgICArICJT\nbywgbm8gaGFybSB0byBjb250aW51ZSIpOwogICAgICAgICAgICB1bmRlcnJl\ncGxpY2F0aW9uTWFuYWdlcgogICAgICAgICAgICAgICAgICAgIC5yZWxlYXNl\nVW5kZXJyZXBsaWNhdGVkTGVkZ2VyKGxlZGdlcklkVG9SZXBsaWNhdGUpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBjYXRjaCAoQktCb29raWVI\nYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24gZSkgewogICAgICAgICAgICBM\nT0cuaW5mbygiQktCb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24g\nd2hpbGUiCiAgICAgICAgICAgICAgICAgICAgKyAiIG9wZW5pbmcgbGVkZ2Vy\nIGZvciByZXBsaWNhdGlvbi4iCiAgICAgICAgICAgICAgICAgICAgKyAiIEVu\nb3VnaCBCb29raWVzIG1pZ2h0IG5vdCBoYXZlIGF2YWlsYWJsZSIKICAgICAg\nICAgICAgICAgICAgICArICJTbywgbm8gaGFybSB0byBjb250aW51ZSIpOwog\nICAgICAgICAgICB1bmRlcnJlcGxpY2F0aW9uTWFuYWdlcgogICAgICAgICAg\nICAgICAgICAgIC5yZWxlYXNlVW5kZXJyZXBsaWNhdGVkTGVkZ2VyKGxlZGdl\ncklkVG9SZXBsaWNhdGUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIFNldDxMZWRnZXJGcmFnbWVudD4gZnJhZ21lbnRzID0gZ2V0\nVW5kZXJyZXBsaWNhdGVkRnJhZ21lbnRzKGxoKTsKICAgICAgICBMT0cuZGVi\ndWcoIkZvdW5kcyBmcmFnbWVudHMge30gZm9yIHJlcGxpY2F0aW9uIGZyb20g\nbGVkZ2VyOiB7fSIsIGZyYWdtZW50cywgbGVkZ2VySWRUb1JlcGxpY2F0ZSk7\nCgogICAgICAgIGJvb2xlYW4gZm91bmRPcGVuRnJhZ21lbnRzID0gZmFsc2U7\nCiAgICAgICAgZm9yIChMZWRnZXJGcmFnbWVudCBsZWRnZXJGcmFnbWVudCA6\nIGZyYWdtZW50cykgewogICAgICAgICAgICBpZiAoIWxlZGdlckZyYWdtZW50\nLmlzQ2xvc2VkKCkpIHsKICAgICAgICAgICAgICAgIGZvdW5kT3BlbkZyYWdt\nZW50cyA9IHRydWU7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChpc1RhcmdldEJvb2tpZUV4aXN0c0luRnJhZ21l\nbnRFbnNlbWJsZShsaCwKICAgICAgICAgICAgICAgICAgICBsZWRnZXJGcmFn\nbWVudCkpIHsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiVGFyZ2V0IEJv\nb2tpZVt7fV0gZm91bmQgaW4gdGhlIGZyYWdtZW50IGVuc2VtYmxlOiB7fSIs\nIHRhcmdldEJvb2tpZSwKICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2Vy\nRnJhZ21lbnQuZ2V0RW5zZW1ibGUoKSk7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgYWRtaW4ucmVwbGljYXRlTGVkZ2VyRnJhZ21lbnQobGgsIGxl\nZGdlckZyYWdtZW50LCB0YXJnZXRCb29raWUpOwogICAgICAgICAgICB9IGNh\ndGNoIChCS0V4Y2VwdGlvbi5CS0Jvb2tpZUhhbmRsZU5vdEF2YWlsYWJsZUV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiQktCb29r\naWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24gIgogICAgICAgICAgICAg\nICAgICAgICAgICArICJ3aGlsZSByZXBsaWNhdGluZyB0aGUgZnJhZ21lbnQi\nLCBlKTsKICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktMZWRn\nZXJSZWNvdmVyeUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cu\nd2FybigiQktMZWRnZXJSZWNvdmVyeUV4Y2VwdGlvbiAiCiAgICAgICAgICAg\nICAgICAgICAgICAgICsgIndoaWxlIHJlcGxpY2F0aW5nIHRoZSBmcmFnbWVu\ndCIsIGUpOwogICAgICAgICAgICAgICAgaWYgKGFkbWluLmdldFJlYWRPbmx5\nQm9va2llcygpLmNvbnRhaW5zKHRhcmdldEJvb2tpZSkpIHsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgQktFeGNlcHRpb24uQktXcml0ZU9uUmVh\nZE9ubHlCb29raWVFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGZvdW5kT3BlbkZy\nYWdtZW50cykgewogICAgICAgICAgICBkZWZlckxlZGdlckxvY2tSZWxlYXNl\nKGxlZGdlcklkVG9SZXBsaWNhdGUpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIGZyYWdtZW50cyA9IGdldFVuZGVy\ncmVwbGljYXRlZEZyYWdtZW50cyhsaCk7CiAgICAgICAgaWYgKGZyYWdtZW50\ncy5zaXplKCkgPT0gMCkgewogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2Vy\nIHJlcGxpY2F0ZWQgc3VjY2Vzc2Z1bGx5LiBsZWRnZXIgaWQgaXM6ICIKICAg\nICAgICAgICAgICAgICAgICArIGxlZGdlcklkVG9SZXBsaWNhdGUpOwogICAg\nICAgICAgICB1bmRlcnJlcGxpY2F0aW9uTWFuYWdlci5tYXJrTGVkZ2VyUmVw\nbGljYXRlZChsZWRnZXJJZFRvUmVwbGljYXRlKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAvLyBSZWxlYXNpbmcgdGhlIHVuZGVyUmVwbGljYXRp\nb24gbGVkZ2VyIGxvY2sgYW5kIGNvbXBldGUKICAgICAgICAgICAgLy8gZm9y\nIHRoZSByZXBsaWNhdGlvbiBhZ2FpbiBmb3IgdGhlIHBlbmRpbmcgZnJhZ21l\nbnRzCiAgICAgICAgICAgIHVuZGVycmVwbGljYXRpb25NYW5hZ2VyCiAgICAg\nICAgICAgICAgICAgICAgLnJlbGVhc2VVbmRlcnJlcGxpY2F0ZWRMZWRnZXIo\nbGVkZ2VySWRUb1JlcGxpY2F0ZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKiBHZXRzIHRoZSB1bmRlciByZXBsaWNhdGVkIGZyYWdtZW50cyAqLwogICAg\ncHJpdmF0ZSBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IGdldFVuZGVycmVwbGljYXRl\nZEZyYWdtZW50cyhMZWRnZXJIYW5kbGUgbGgpCiAgICAgICAgICAgIHRocm93\ncyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgQ2hlY2tlckNhbGxi\nYWNrIGNoZWNrZXJDYiA9IG5ldyBDaGVja2VyQ2FsbGJhY2soKTsKICAgICAg\nICBsZWRnZXJDaGVja2VyLmNoZWNrTGVkZ2VyKGxoLCBjaGVja2VyQ2IpOwog\nICAgICAgIFNldDxMZWRnZXJGcmFnbWVudD4gZnJhZ21lbnRzID0gY2hlY2tl\nckNiLndhaXRBbmRHZXRSZXN1bHQoKTsKICAgICAgICByZXR1cm4gZnJhZ21l\nbnRzOwogICAgfQoKICAgIC8qKgogICAgICogU2NoZWR1bGVzIGEgdGltZXIg\ndGFzayBmb3IgcmVsZWFzaW5nIHRoZSBsb2NrIHdoaWNoIHdpbGwgYmUgc2No\nZWR1bGVkCiAgICAgKiBhZnRlciBvcGVuIGxlZGdlciBmcmFnbWVudCByZXBs\naWNhdGlvbiB0aW1lLiBMZWRnZXIgd2lsbCBiZSBmZW5jZWQgaWYgaXQKICAg\nICAqIGlzIHN0aWxsIGluIG9wZW4gc3RhdGUgd2hlbiB0aW1lciB0YXNrIGZp\ncmVkCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkZWZlckxlZGdlckxvY2tS\nZWxlYXNlKGZpbmFsIGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICBsb25nIGdy\nYWNlUGVyaW9kID0gdGhpcy5vcGVuTGVkZ2VyUmVyZXBsaWNhdGlvbkdyYWNl\nUGVyaW9kOwogICAgICAgIFRpbWVyVGFzayB0aW1lclRhc2sgPSBuZXcgVGlt\nZXJUYXNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgbGggPSBhZG1pbi5vcGVuTGVkZ2VyTm9SZWNvdmVyeShs\nZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgU2V0PExlZGdlckZyYWdt\nZW50PiBmcmFnbWVudHMgPSBnZXRVbmRlcnJlcGxpY2F0ZWRGcmFnbWVudHMo\nbGgpOwogICAgICAgICAgICAgICAgICAgIGZvciAoTGVkZ2VyRnJhZ21lbnQg\nZnJhZ21lbnQgOiBmcmFnbWVudHMpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKCFmcmFnbWVudC5pc0Nsb3NlZCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsaCA9IGFkbWluLm9wZW5MZWRnZXIobGVkZ2VySWQp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5p\nbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiSW50\nZXJydXB0ZWRFeGNlcHRpb24gIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyAid2hpbGUgcmVwbGljYXRpbmcgZnJhZ21lbnRzIiwgZSk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChCS05vU3VjaExlZGdlckV4aXN0c0V4Y2Vw\ndGlvbiBia25zbGUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIkxlZGdlciB3YXMgZGVsZXRlZCwgc2FmZSB0byBjb250aW51ZSIsIGJrbnNs\nZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJCS0V4Y2VwdGlvbiB3\naGlsZSBmZW5jaW5nIHRoZSBsZWRnZXIiCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArICIgZm9yIHJlcmVwbGljYXRpb24gb2YgcG9zdHBvbmVkIGxl\nZGdlcnMiLCBlKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGxoICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhy\nZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5pbmZvKCJJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB3aGlsZSBjbG9zaW5nICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICJsZWRnZXIiLCBl\nKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIExldHMgZ28gYWhlYWQg\nYW5kIHJlbGVhc2UgdGhlIGxvY2suIENhdGNoIGFjdHVhbAogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBleGNlcHRpb24gaW4gbm9ybWFsIHJlcGxpY2F0\naW9uIGZsb3cgYW5kIHRha2UKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nYWN0aW9uLgogICAgICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQktF\neGNlcHRpb24gd2hpbGUgY2xvc2luZyBsZWRnZXIgIiwgZSk7CiAgICAgICAg\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVuZGVycmVw\nbGljYXRpb25NYW5hZ2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC5yZWxlYXNlVW5kZXJyZXBsaWNhdGVkTGVkZ2VyKGxlZGdlcklk\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoVW5hdmFpbGFi\nbGVFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiVW5hdmFpbGFibGVFeGNlcHRpb24gIgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArICJ3aGlsZSByZXBsaWNhdGluZyBmcmFn\nbWVudHMiLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH07CiAgICAgICAgcGVuZGluZ1JlcGxpY2F0aW9uVGltZXIu\nc2NoZWR1bGUodGltZXJUYXNrLCBncmFjZVBlcmlvZCk7CiAgICB9CiAgICAK\nICAgIC8qKgogICAgICogU3RvcCB0aGUgcmVwbGljYXRpb24gd29ya2VyIHNl\ncnZpY2UKICAgICAqLwogICAgcHVibGljIHZvaWQgc2h1dGRvd24oKSB7CiAg\nICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmICgh\nd29ya2VyUnVubmluZykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHdvcmtlclJ1bm5pbmcgPSBmYWxzZTsK\nICAgICAgICB9CiAgICAgICAgdGhpcy5wZW5kaW5nUmVwbGljYXRpb25UaW1l\nci5jYW5jZWwoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLndv\ncmtlclRocmVhZC5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgdGhpcy53b3Jr\nZXJUaHJlYWQuam9pbigpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVk\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJbnRlcnJ1\ncHRlZCBkdXJpbmcgc2h1dHRpbmcgZG93biByZXBsaWNhdGlvbiB3b3JrZXIg\nOiAiLAogICAgICAgICAgICAgICAgICAgIGUpOwogICAgICAgICAgICBUaHJl\nYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgIH0KICAg\nICAgICB0cnkgewogICAgICAgICAgICBia2MuY2xvc2UoKTsKICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIExPRy53YXJuKCJJbnRlcnJ1cHRlZCB3aGlsZSBjbG9zaW5nIHRoZSBCb29r\naWUgY2xpZW50IiwgZSk7CiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhy\nZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cud2FybigiRXhjZXB0aW9uIHdoaWxl\nIGNsb3NpbmcgdGhlIEJvb2tpZSBjbGllbnQiLCBlKTsKICAgICAgICB9CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgdW5kZXJyZXBsaWNhdGlvbk1hbmFn\nZXIuY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChVbmF2YWlsYWJsZUV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJFeGNlcHRpb24gd2hp\nbGUgY2xvc2luZyB0aGUgIgogICAgICAgICAgICAgICAgICAgICsgIlprTGVk\nZ2VyVW5kZXJyZXBsaWF0aW9uTWFuYWdlciIsIGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEdpdmVzIHRoZSBydW5uaW5nIHN0YXR1cyBv\nZiBSZXBsaWNhdGlvbldvcmtlcgogICAgICovCiAgICBib29sZWFuIGlzUnVu\nbmluZygpIHsKICAgICAgICByZXR1cm4gd29ya2VyUnVubmluZzsKICAgIH0K\nCiAgICBwcml2YXRlIGJvb2xlYW4gaXNUYXJnZXRCb29raWVFeGlzdHNJbkZy\nYWdtZW50RW5zZW1ibGUoTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICBM\nZWRnZXJGcmFnbWVudCBsZWRnZXJGcmFnbWVudCkgewogICAgICAgIExpc3Q8\nSW5ldFNvY2tldEFkZHJlc3M+IGVuc2VtYmxlID0gbGVkZ2VyRnJhZ21lbnQu\nZ2V0RW5zZW1ibGUoKTsKICAgICAgICBmb3IgKEluZXRTb2NrZXRBZGRyZXNz\nIGJrQWRkciA6IGVuc2VtYmxlKSB7CiAgICAgICAgICAgIGlmICh0YXJnZXRC\nb29raWUuZXF1YWxzKGJrQWRkcikpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgIH0KCiAgICAvKiogTGVkZ2VyIGNoZWNrZXIgY2FsbCBi\nYWNrICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBDaGVja2VyQ2FsbGJh\nY2sgaW1wbGVtZW50cwogICAgICAgICAgICBHZW5lcmljQ2FsbGJhY2s8U2V0\nPExlZGdlckZyYWdtZW50Pj4gewogICAgICAgIHByaXZhdGUgU2V0PExlZGdl\nckZyYWdtZW50PiByZXN1bHQgPSBudWxsOwogICAgICAgIHByaXZhdGUgQ291\nbnREb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkNvbXBsZXRlKGludCByYywgU2V0PExlZGdlckZyYWdtZW50PiByZXN1bHQp\nIHsKICAgICAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAg\nICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogV2FpdCB1bnRpbCBvcGVyYXRpb24gY29tcGxldGUgY2Fs\nbCBiYWNrIGNvbWVzIGFuZCByZXR1cm4gdGhlIGxlZGdlcgogICAgICAgICAq\nIGZyYWdtZW50cyBzZXQKICAgICAgICAgKi8KICAgICAgICBTZXQ8TGVkZ2Vy\nRnJhZ21lbnQ+IHdhaXRBbmRHZXRSZXN1bHQoKSB0aHJvd3MgSW50ZXJydXB0\nZWRFeGNlcHRpb24gewogICAgICAgICAgICBsYXRjaC5hd2FpdCgpOwogICAg\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0KCn0K\n","encoding":"base64"}

