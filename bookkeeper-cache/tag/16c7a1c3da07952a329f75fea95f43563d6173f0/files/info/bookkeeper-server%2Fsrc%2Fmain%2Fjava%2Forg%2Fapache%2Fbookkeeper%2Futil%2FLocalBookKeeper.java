{"sha":"76d89ad83bb765e29140e4a57e5f27185bc0230d","node_id":"MDQ6QmxvYjE1NzU5NTY6NzZkODlhZDgzYmI3NjVlMjkxNDBlNGE1N2U1ZjI3MTg1YmMwMjMwZA==","size":9865,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/76d89ad83bb765e29140e4a57e5f27185bc0230d","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbDsKCmltcG9ydCBqYXZh\nLmlvLkJ1ZmZlcmVkUmVhZGVyOwppbXBvcnQgamF2YS5pby5GaWxlOwppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uSW5wdXRT\ndHJlYW1SZWFkZXI7CmltcG9ydCBqYXZhLmlvLk91dHB1dFN0cmVhbTsKaW1w\nb3J0IGphdmEubmV0LkluZXRBZGRyZXNzOwppbXBvcnQgamF2YS5uZXQuSW5l\ndFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLm5ldC5Tb2NrZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwoKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29r\naWVTZXJ2ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGlj\nYXRpb24uUmVwbGljYXRpb25FeGNlcHRpb24uQ29tcGF0aWJpbGl0eUV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbi5SZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0\nZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZl\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZTsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0RlZnMuSWRzOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuc2VydmVyLk5JT1NlcnZlckNueG5G\nYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuc2VydmVyLlpv\nb0tlZXBlclNlcnZlcjsKCnB1YmxpYyBjbGFzcyBMb2NhbEJvb2tLZWVwZXIg\newogICAgcHJvdGVjdGVkIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTG9jYWxCb29rS2VlcGVyLmNsYXNzKTsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENPTk5FQ1RJT05fVElNRU9V\nVCA9IDMwMDAwOwoKICAgIGludCBudW1iZXJPZkJvb2tpZXM7CgogICAgcHVi\nbGljIExvY2FsQm9va0tlZXBlcigpIHsKICAgICAgICBudW1iZXJPZkJvb2tp\nZXMgPSAzOwogICAgfQoKICAgIHB1YmxpYyBMb2NhbEJvb2tLZWVwZXIoaW50\nIG51bWJlck9mQm9va2llcykgewogICAgICAgIHRoaXMoKTsKICAgICAgICB0\naGlzLm51bWJlck9mQm9va2llcyA9IG51bWJlck9mQm9va2llczsKICAgICAg\nICBMT0cuaW5mbygiUnVubmluZyAiICsgdGhpcy5udW1iZXJPZkJvb2tpZXMg\nKyAiIGJvb2tpZShzKS4iKTsKICAgIH0KCiAgICBwcml2YXRlIGZpbmFsIFN0\ncmluZyBIT1NUUE9SVCA9ICIxMjcuMC4wLjE6MjE4MSI7CiAgICBOSU9TZXJ2\nZXJDbnhuRmFjdG9yeSBzZXJ2ZXJGYWN0b3J5OwogICAgWm9vS2VlcGVyU2Vy\ndmVyIHprczsKICAgIFpvb0tlZXBlciB6a2M7CiAgICBpbnQgWm9vS2VlcGVy\nRGVmYXVsdFBvcnQgPSAyMTgxOwogICAgc3RhdGljIGludCB6a1Nlc3Npb25U\naW1lT3V0ID0gNTAwMDsKICAgIEZpbGUgWmtUbXBEaXI7CgogICAgLy9Cb29r\nS2VlcGVyIHZhcmlhYmxlcwogICAgRmlsZSB0bXBEaXJzW107CiAgICBCb29r\naWVTZXJ2ZXIgYnNbXTsKICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gYnNDb25m\nc1tdOwogICAgSW50ZWdlciBpbml0aWFsUG9ydCA9IDUwMDA7CgogICAgLyoq\nCiAgICAgKiBAcGFyYW0gYXJncwogICAgICovCgogICAgcHJpdmF0ZSB2b2lk\nIHJ1blpvb2tlZXBlcihpbnQgbWF4Q0MpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gY3JlYXRlIGEgWm9vS2VlcGVyIHNlcnZlcihkYXRhRGly\nLCBkYXRhTG9nRGlyLCBwb3J0KQogICAgICAgIExPRy5pbmZvKCJTdGFydGlu\nZyBaSyBzZXJ2ZXIiKTsKICAgICAgICAvL1NlcnZlclN0YXRzLnJlZ2lzdGVy\nQXNDb25jcmV0ZSgpOwogICAgICAgIC8vQ2xpZW50QmFzZS5zZXR1cFRlc3RF\nbnYoKTsKICAgICAgICBaa1RtcERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUo\nInpvb2tlZXBlciIsICJ0ZXN0Iik7CiAgICAgICAgaWYgKCFaa1RtcERpci5k\nZWxldGUoKSB8fCAhWmtUbXBEaXIubWtkaXIoKSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgSU9FeGNlcHRpb24oIkNvdWxkbid0IGNyZWF0ZSB6ayBkaXJl\nY3RvcnkgIiArIFprVG1wRGlyKTsKICAgICAgICB9CgogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHprcyA9IG5ldyBab29LZWVwZXJTZXJ2ZXIoWmtUbXBE\naXIsIFprVG1wRGlyLCBab29LZWVwZXJEZWZhdWx0UG9ydCk7CiAgICAgICAg\nICAgIHNlcnZlckZhY3RvcnkgPSAgbmV3IE5JT1NlcnZlckNueG5GYWN0b3J5\nKCk7CiAgICAgICAgICAgIHNlcnZlckZhY3RvcnkuY29uZmlndXJlKG5ldyBJ\nbmV0U29ja2V0QWRkcmVzcyhab29LZWVwZXJEZWZhdWx0UG9ydCksIG1heEND\nKTsKICAgICAgICAgICAgc2VydmVyRmFjdG9yeS5zdGFydHVwKHprcyk7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8g\nVE9ETyBBdXRvLWdlbmVyYXRlZCBjYXRjaCBibG9jawogICAgICAgICAgICBM\nT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSBpbnN0YW50aWF0aW5nIFpvb0tl\nZXBlciIsIGUpOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBiID0gd2Fp\ndEZvclNlcnZlclVwKEhPU1RQT1JULCBDT05ORUNUSU9OX1RJTUVPVVQpOwog\nICAgICAgIExPRy5kZWJ1ZygiWm9vS2VlcGVyIHNlcnZlciB1cDoge30iLCBi\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5pdGlhbGl6ZVpvb2tlcGVy\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiSW5z\ndGFudGlhdGUgWksgQ2xpZW50Iik7CiAgICAgICAgLy9pbml0aWFsaXplIHRo\nZSB6ayBjbGllbnQgd2l0aCB2YWx1ZXMKICAgICAgICB0cnkgewogICAgICAg\nICAgICBaS0Nvbm5lY3Rpb25XYXRjaGVyIHprQ29ubmVjdGlvbldhdGNoZXIg\nPSBuZXcgWktDb25uZWN0aW9uV2F0Y2hlcigpOwogICAgICAgICAgICB6a2Mg\nPSBuZXcgWm9vS2VlcGVyKEhPU1RQT1JULCB6a1Nlc3Npb25UaW1lT3V0LAog\nICAgICAgICAgICAgICAgICAgIHprQ29ubmVjdGlvbldhdGNoZXIpOwogICAg\nICAgICAgICB6a0Nvbm5lY3Rpb25XYXRjaGVyLndhaXRGb3JDb25uZWN0aW9u\nKCk7CiAgICAgICAgICAgIHprYy5jcmVhdGUoIi9sZWRnZXJzIiwgbmV3IGJ5\ndGVbMF0sIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1vZGUuUEVSU0lT\nVEVOVCk7CiAgICAgICAgICAgIHprYy5jcmVhdGUoIi9sZWRnZXJzL2F2YWls\nYWJsZSIsIG5ldyBieXRlWzBdLCBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVh\ndGVNb2RlLlBFUlNJU1RFTlQpOwogICAgICAgICAgICAvLyBObyBuZWVkIHRv\nIGNyZWF0ZSBhbiBlbnRyeSBmb3IgZWFjaCByZXF1ZXN0ZWQgYm9va2llIGFu\neW1vcmUgYXMgdGhlCiAgICAgICAgICAgIC8vIEJvb2tpZVNlcnZlcnMgd2ls\nbCByZWdpc3RlciB0aGVtc2VsdmVzIHdpdGggWm9vS2VlcGVyIG9uIHN0YXJ0\ndXAuCiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgLy8gVE9ETyBBdXRvLWdlbmVyYXRlZCBjYXRjaCBibG9jawog\nICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSBjcmVhdGlu\nZyB6bm9kZXMiLCBlKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIFRPRE8gQXV0by1nZW5lcmF0\nZWQgY2F0Y2ggYmxvY2sKICAgICAgICAgICAgTE9HLmVycm9yKCJJbnRlcnJ1\ncHRlZCB3aGlsZSBjcmVhdGluZyB6bm9kZXMiLCBlKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIHJ1bkJvb2tpZXMoU2VydmVyQ29uZmln\ndXJhdGlvbiBiYXNlQ29uZikgdGhyb3dzIElPRXhjZXB0aW9uLAogICAgICAg\nICAgICBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBC\nb29raWVFeGNlcHRpb24sCiAgICAgICAgICAgIFVuYXZhaWxhYmxlRXhjZXB0\naW9uLCBDb21wYXRpYmlsaXR5RXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5m\nbygiU3RhcnRpbmcgQm9va2llKHMpIik7CiAgICAgICAgLy8gQ3JlYXRlIEJv\nb2tpZSBTZXJ2ZXJzIChCMSwgQjIsIEIzKQoKICAgICAgICB0bXBEaXJzID0g\nbmV3IEZpbGVbbnVtYmVyT2ZCb29raWVzXTsKICAgICAgICBicyA9IG5ldyBC\nb29raWVTZXJ2ZXJbbnVtYmVyT2ZCb29raWVzXTsKICAgICAgICBic0NvbmZz\nID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb25bbnVtYmVyT2ZCb29raWVzXTsK\nCiAgICAgICAgZm9yKGludCBpID0gMDsgaSA8IG51bWJlck9mQm9va2llczsg\naSsrKSB7CiAgICAgICAgICAgIHRtcERpcnNbaV0gPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiICsgSW50ZWdlci50b1N0cmluZyhpKSwgInRlc3Qi\nKTsKICAgICAgICAgICAgaWYgKCF0bXBEaXJzW2ldLmRlbGV0ZSgpIHx8ICF0\nbXBEaXJzW2ldLm1rZGlyKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbigiQ291bGRuJ3QgY3JlYXRlIGJvb2tpZSBkaXIgIiAr\nIHRtcERpcnNbaV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBic0Nv\nbmZzW2ldID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oYmFzZUNvbmYpOwog\nICAgICAgICAgICAvLyBvdmVycmlkZSBzZXR0aW5ncwogICAgICAgICAgICBi\nc0NvbmZzW2ldLnNldEJvb2tpZVBvcnQoaW5pdGlhbFBvcnQgKyBpKTsKICAg\nICAgICAgICAgYnNDb25mc1tpXS5zZXRaa1NlcnZlcnMoSW5ldEFkZHJlc3Mu\nZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSArICI6IgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBab29LZWVwZXJEZWZhdWx0\nUG9ydCk7CiAgICAgICAgICAgIGJzQ29uZnNbaV0uc2V0Sm91cm5hbERpck5h\nbWUodG1wRGlyc1tpXS5nZXRQYXRoKCkpOwogICAgICAgICAgICBic0NvbmZz\nW2ldLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IHRtcERpcnNb\naV0uZ2V0UGF0aCgpIH0pOwogICAgICAgICAgICBic0NvbmZzW2ldLnNldEFs\nbG93TG9vcGJhY2sodHJ1ZSk7CgogICAgICAgICAgICBic1tpXSA9IG5ldyBC\nb29raWVTZXJ2ZXIoYnNDb25mc1tpXSk7CiAgICAgICAgICAgIGJzW2ldLnN0\nYXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBJT0V4Y2VwdGlvbiwgS2Vl\ncGVyRXhjZXB0aW9uLAogICAgICAgICAgICBJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiwgQm9va2llRXhjZXB0aW9uLCBVbmF2YWlsYWJsZUV4Y2VwdGlvbiwKICAg\nICAgICAgICAgQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiB7CiAgICAgICAgaWYo\nYXJncy5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHVzYWdlKCk7CiAgICAg\nICAgICAgIFN5c3RlbS5leGl0KC0xKTsKICAgICAgICB9CiAgICAgICAgTG9j\nYWxCb29rS2VlcGVyIGxiID0gbmV3IExvY2FsQm9va0tlZXBlcihJbnRlZ2Vy\nLnBhcnNlSW50KGFyZ3NbMF0pKTsKCiAgICAgICAgU2VydmVyQ29uZmlndXJh\ndGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAg\nICBpZiAoYXJncy5sZW5ndGggPj0gMikgewogICAgICAgICAgICBTdHJpbmcg\nY29uZkZpbGUgPSBhcmdzWzFdOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgY29uZi5sb2FkQ29uZihuZXcgRmlsZShjb25mRmlsZSkudG9V\nUkkoKS50b1VSTCgpKTsKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJVc2lu\nZyBjb25maWd1cmF0aW9uIGZpbGUgIiArIGNvbmZGaWxlKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8v\nIGxvYWQgY29uZiBmYWlsZWQKICAgICAgICAgICAgICAgIExPRy53YXJuKCJF\ncnJvciBsb2FkaW5nIGNvbmZpZ3VyYXRpb24gZmlsZSAiICsgY29uZkZpbGUs\nIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBsYi5ydW5a\nb29rZWVwZXIoMTAwMCk7CiAgICAgICAgbGIuaW5pdGlhbGl6ZVpvb2tlcGVy\nKCk7CiAgICAgICAgbGIucnVuQm9va2llcyhjb25mKTsKICAgICAgICB3aGls\nZSAodHJ1ZSkgewogICAgICAgICAgICBUaHJlYWQuc2xlZXAoNTAwMCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgdXNhZ2Uo\nKSB7CiAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJVc2FnZTogTG9jYWxC\nb29rS2VlcGVyIG51bWJlci1vZi1ib29raWVzIik7CiAgICB9CgogICAgLyog\nV2F0Y2hpbmcgU3luY0Nvbm5lY3RlZCBldmVudCBmcm9tIFpvb0tlZXBlciAq\nLwogICAgc3RhdGljIGNsYXNzIFpLQ29ubmVjdGlvbldhdGNoZXIgaW1wbGVt\nZW50cyBXYXRjaGVyIHsKICAgICAgICBwcml2YXRlIENvdW50RG93bkxhdGNo\nIGNsaWVudENvbm5lY3RMYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsK\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vz\ncyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGV2ZW50\nLmdldFN0YXRlKCkgPT0gS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZCkgewog\nICAgICAgICAgICAgICAgY2xpZW50Q29ubmVjdExhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBXYWl0aW5n\nIGZvciB0aGUgU3luY0Nvbm5lY3RlZCBldmVudCBmcm9tIHRoZSBab29LZWVw\nZXIgc2VydmVyCiAgICAgICAgcHVibGljIHZvaWQgd2FpdEZvckNvbm5lY3Rp\nb24oKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgaWYgKCFjbGllbnRDb25uZWN0TGF0Y2guYXdhaXQo\nemtTZXNzaW9uVGltZU91dCwKICAgICAgICAgICAgICAgICAgICAgICAgVGlt\nZVVuaXQuTUlMTElTRUNPTkRTKSkgewogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJT0V4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICJDb3VsZG4ndCBjb25uZWN0IHRvIHpvb2tlZXBlciBzZXJ2ZXIiKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiSW50ZXJy\ndXB0ZWQgd2hlbiBjb25uZWN0aW5nIHRvIHpvb2tlZXBlciBzZXJ2ZXIiLCBl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nc3RhdGljIGJvb2xlYW4gd2FpdEZvclNlcnZlclVwKFN0cmluZyBocCwgbG9u\nZyB0aW1lb3V0KSB7CiAgICAgICAgbG9uZyBzdGFydCA9IE1hdGhVdGlscy5u\nb3coKTsKICAgICAgICBTdHJpbmcgc3BsaXRbXSA9IGhwLnNwbGl0KCI6Iik7\nCiAgICAgICAgU3RyaW5nIGhvc3QgPSBzcGxpdFswXTsKICAgICAgICBpbnQg\ncG9ydCA9IEludGVnZXIucGFyc2VJbnQoc3BsaXRbMV0pOwogICAgICAgIHdo\naWxlICh0cnVlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBTb2NrZXQgc29jayA9IG5ldyBTb2NrZXQoaG9zdCwgcG9ydCk7CiAgICAg\nICAgICAgICAgICBCdWZmZXJlZFJlYWRlciByZWFkZXIgPSBudWxsOwogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBPdXRwdXRT\ndHJlYW0gb3V0c3RyZWFtID0gc29jay5nZXRPdXRwdXRTdHJlYW0oKTsKICAg\nICAgICAgICAgICAgICAgICBvdXRzdHJlYW0ud3JpdGUoInN0YXQiLmdldEJ5\ndGVzKCkpOwogICAgICAgICAgICAgICAgICAgIG91dHN0cmVhbS5mbHVzaCgp\nOwoKICAgICAgICAgICAgICAgICAgICByZWFkZXIgPQogICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgQnVmZmVyZWRSZWFkZXIoCiAgICAgICAgICAgICAg\nICAgICAgICAgIG5ldyBJbnB1dFN0cmVhbVJlYWRlcihzb2NrLmdldElucHV0\nU3RyZWFtKCkpKTsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgbGluZSA9\nIHJlYWRlci5yZWFkTGluZSgpOwogICAgICAgICAgICAgICAgICAgIGlmIChs\naW5lICE9IG51bGwgJiYgbGluZS5zdGFydHNXaXRoKCJab29rZWVwZXIgdmVy\nc2lvbjoiKSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygi\nU2VydmVyIFVQIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICAgICAgc29jay5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChyZWFkZXIgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICByZWFkZXIuY2xvc2UoKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIGln\nbm9yZSBhcyB0aGlzIGlzIGV4cGVjdGVkCiAgICAgICAgICAgICAgICBMT0cu\naW5mbygic2VydmVyICIgKyBocCArICIgbm90IHVwICIgKyBlKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKE1hdGhVdGlscy5ub3coKSA+IHN0\nYXJ0ICsgdGltZW91dCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFRo\ncmVhZC5zbGVlcCgyNTApOwogICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBpZ25vcmUK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICB9Cgp9Cg==\n","encoding":"base64"}

