{"sha":"9608240c70c01ac7ab1805f7aa1ee999cbc76a4c","node_id":"MDQ6QmxvYjE1NzU5NTY6OTYwODI0MGM3MGMwMWFjN2FiMTgwNWY3YWExZWU5OTljYmM3NmE0Yw==","size":9915,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9608240c70c01ac7ab1805f7aa1ee999cbc76a4c","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsOwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKCmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnpvb2tlZXBlci5ab29LZWVwZXJXYXRjaGVyQmFzZTsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuQXN5bmNDYWxsYmFjay5TdHJpbmdDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Db2Rl\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuZGF0YS5BQ0w7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7\nCgovKioKICogUHJvdmlkZWQgdXRpbGl0ZXMgZm9yIHpvb2tlZXBlciBhY2Nl\nc3MsIGV0Yy4KICovCnB1YmxpYyBjbGFzcyBaa1V0aWxzIHsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5Lmdl\ndExvZ2dlcihaa1V0aWxzLmNsYXNzKTsKCiAgICAvKioKICAgICAqIEFzeW5j\naHJvbm91c2x5IGNyZWF0ZSB6b29rZWVwZXIgcGF0aCByZWN1cnNpdmVseSBh\nbmQgb3B0aW1pc3RpY2FsbHkuCiAgICAgKgogICAgICogQHNlZSAjY3JlYXRl\nRnVsbFBhdGhPcHRpbWlzdGljKFpvb0tlZXBlcixTdHJpbmcsYnl0ZVtdLExp\nc3Q8QUNMPixDcmVhdGVNb2RlKQogICAgICoKICAgICAqIEBwYXJhbSB6awog\nICAgICogICAgICAgICAgWm9va2VlcGVyIGNsaWVudAogICAgICogQHBhcmFt\nIG9yaWdpbmFsUGF0aAogICAgICogICAgICAgICAgWm9va2VlcGVyIGZ1bGwg\ncGF0aAogICAgICogQHBhcmFtIGRhdGEKICAgICAqICAgICAgICAgIFpvb2tl\nZXBlciBkYXRhCiAgICAgKiBAcGFyYW0gYWNsCiAgICAgKiAgICAgICAgICBB\nY2wgb2YgdGhlIHprIHBhdGgKICAgICAqIEBwYXJhbSBjcmVhdGVNb2RlCiAg\nICAgKiAgICAgICAgICBDcmVhdGUgbW9kZSBvZiB6ayBwYXRoCiAgICAgKiBA\ncGFyYW0gY2FsbGJhY2sKICAgICAqICAgICAgICAgIENhbGxiYWNrCiAgICAg\nKiBAcGFyYW0gY3R4CiAgICAgKiAgICAgICAgICBDb250ZXh0IG9iamVjdAog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgYXN5bmNDcmVhdGVGdWxs\nUGF0aE9wdGltaXN0aWMoCiAgICAgICAgZmluYWwgWm9vS2VlcGVyIHprLCBm\naW5hbCBTdHJpbmcgb3JpZ2luYWxQYXRoLCBmaW5hbCBieXRlW10gZGF0YSwK\nICAgICAgICBmaW5hbCBMaXN0PEFDTD4gYWNsLCBmaW5hbCBDcmVhdGVNb2Rl\nIGNyZWF0ZU1vZGUsCiAgICAgICAgZmluYWwgQXN5bmNDYWxsYmFjay5TdHJp\nbmdDYWxsYmFjayBjYWxsYmFjaywgZmluYWwgT2JqZWN0IGN0eCkgewoKICAg\nICAgICB6ay5jcmVhdGUob3JpZ2luYWxQYXRoLCBkYXRhLCBhY2wsIGNyZWF0\nZU1vZGUsIG5ldyBTdHJpbmdDYWxsYmFjaygpIHsKICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQo\naW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgU3RyaW5nIG5hbWUp\nIHsKCiAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5OT05PREUuaW50\nVmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLnByb2Nl\nc3NSZXN1bHQocmMsIHBhdGgsIGN0eCwgbmFtZSk7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIC8vIFNpbmNlIEkgZ290IGEgbm9ub2RlLCBpdCBtZWFucyB0aGF0IG15\nIHBhcmVudHMgZG9uJ3QgZXhpc3QKICAgICAgICAgICAgICAgIC8vIGNyZWF0\nZSBtb2RlIGlzIHBlcnNpc3RlbnQgc2luY2UgZXBoZW1lcmFsIG5vZGVzIGNh\nbid0IGJlCiAgICAgICAgICAgICAgICAvLyBwYXJlbnRzCiAgICAgICAgICAg\nICAgICBTdHJpbmcgcGFyZW50ID0gbmV3IEZpbGUob3JpZ2luYWxQYXRoKS5n\nZXRQYXJlbnQoKS5yZXBsYWNlKCJcXCIsICIvIik7CiAgICAgICAgICAgICAg\nICBhc3luY0NyZWF0ZUZ1bGxQYXRoT3B0aW1pc3RpYyh6aywgcGFyZW50LCBu\nZXcgYnl0ZVswXSwgYWNsLAogICAgICAgICAgICAgICAgICAgICAgICBDcmVh\ndGVNb2RlLlBFUlNJU1RFTlQsIG5ldyBTdHJpbmdDYWxsYmFjaygpIHsKCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQo\naW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgU3RyaW5nIG5hbWUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0g\nQ29kZS5PSy5pbnRWYWx1ZSgpIHx8IHJjID09IENvZGUuTk9ERUVYSVNUUy5p\nbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHN1Y2NlZWRlZCBpbiBjcmVhdGluZyB0aGUgcGFyZW50LCBub3cK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRl\nIHRoZSBvcmlnaW5hbCBwYXRoCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGFzeW5jQ3JlYXRlRnVsbFBhdGhPcHRpbWlzdGljKHprLCBv\ncmlnaW5hbFBhdGgsIGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYWNsLCBjcmVhdGVNb2RlLCBjYWxsYmFjaywg\nY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFj\nay5wcm9jZXNzUmVzdWx0KHJjLCBwYXRoLCBjdHgsIG5hbWUpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3R4KTsK\nICAgICAgICAgICAgfQogICAgICAgIH0sIGN0eCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgem9va2VlcGVyIHBhdGggcmVjdXJzaXZlbHkgYW5k\nIG9wdGltaXN0aWNhbGx5LiBUaGlzIG1ldGhvZCBjYW4gdGhyb3cKICAgICAq\nIGFueSBvZiB0aGUgS2VlcGVyRXhjZXB0aW9ucyB3aGljaCBjYW4gYmUgdGhy\nb3duIGJ5IFpvb0tlZXBlciNjcmVhdGUuCiAgICAgKiBLZWVwZXJFeGNlcHRp\nb24uTm9kZUV4aXN0c0V4Y2VwdGlvbiB3aWxsIG9ubHkgYmUgdGhyb3duIGlm\nIHRoZSBmdWxsIHBhdGggc3BlY2lmaWVkCiAgICAgKiBieSBfcGF0aF8gYWxy\nZWFkeSBleGlzdHMuIFRoZSBleGlzdGVuY2Ugb2YgYW55IHBhcmVudCB6bm9k\nZXMgaXMgbm90IGFuIGVycm9yCiAgICAgKiBjb25kaXRpb24uCiAgICAgKgog\nICAgICogQHBhcmFtIHprYwogICAgICogICAgICAgICAgICAtIFpLIGluc3Rh\nbmNlCiAgICAgKiBAcGFyYW0gcGF0aAogICAgICogICAgICAgICAgICAtIHpu\nb2RlIHBhdGgKICAgICAqIEBwYXJhbSBkYXRhCiAgICAgKiAgICAgICAgICAg\nIC0gem5vZGUgZGF0YQogICAgICogQHBhcmFtIGFjbAogICAgICogICAgICAg\nICAgICAtIEFjbCBvZiB0aGUgemsgcGF0aAogICAgICogQHBhcmFtIGNyZWF0\nZU1vZGUKICAgICAqICAgICAgICAgICAgLSBDcmVhdGUgbW9kZSBvZiB6ayBw\nYXRoCiAgICAgKiBAdGhyb3dzIEtlZXBlckV4Y2VwdGlvbgogICAgICogICAg\nICAgICAgICAgaWYgdGhlIHNlcnZlciByZXR1cm5zIGEgbm9uLXplcm8gZXJy\nb3IgY29kZSwgb3IgaW52YWxpZCBBQ0wKICAgICAqIEB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24KICAgICAqICAgICAgICAgICAgIGlmIHRoZSB0cmFu\nc2FjdGlvbiBpcyBpbnRlcnJ1cHRlZAogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgY3JlYXRlRnVsbFBhdGhPcHRpbWlzdGljKFpvb0tlZXBlciB6\na2MsIFN0cmluZyBwYXRoLAogICAgICAgICAgICBieXRlW10gZGF0YSwgZmlu\nYWwgTGlzdDxBQ0w+IGFjbCwgZmluYWwgQ3JlYXRlTW9kZSBjcmVhdGVNb2Rl\nKQogICAgICAgICAgICB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2gg\nbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwg\nQXRvbWljSW50ZWdlciByYyA9IG5ldyBBdG9taWNJbnRlZ2VyKENvZGUuT0su\naW50VmFsdWUoKSk7CiAgICAgICAgYXN5bmNDcmVhdGVGdWxsUGF0aE9wdGlt\naXN0aWMoemtjLCBwYXRoLCBkYXRhLCBhY2wsIGNyZWF0ZU1vZGUsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFN0cmluZ0Nh\nbGxiYWNrKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQg\ncmMyLCBTdHJpbmcgcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmpl\nY3QgY3R4LCBTdHJpbmcgbmFtZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcmMuc2V0KHJjMik7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRjaC5j\nb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0sIG51bGwpOwogICAgICAgIGxhdGNoLmF3YWl0KCk7CiAgICAgICAg\naWYgKHJjLmdldCgpICE9IENvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAg\nICAgICB0aHJvdyBLZWVwZXJFeGNlcHRpb24uY3JlYXRlKENvZGUuZ2V0KHJj\nLmdldCgpKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIEdldENoaWxkcmVuQ3R4IHsKICAgICAgICBpbnQgcmM7CiAgICAg\nICAgYm9vbGVhbiBkb25lID0gZmFsc2U7CiAgICAgICAgTGlzdDxTdHJpbmc+\nIGNoaWxkcmVuID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAqIFN5bmMg\nZ2V0IGFsbCBjaGlsZHJlbiB1bmRlciBzaW5nbGUgemsgbm9kZQogICAgICoK\nICAgICAqIEBwYXJhbSB6awogICAgICogICAgICAgICAgem9va2VlcGVyIGNs\naWVudAogICAgICogQHBhcmFtIG5vZGUKICAgICAqICAgICAgICAgIG5vZGUg\ncGF0aAogICAgICogQHJldHVybiBkaXJlY3QgY2hpbGRyZW4KICAgICAqIEB0\naHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqIEB0aHJvd3MgSU9F\neGNlcHRpb24KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBMaXN0PFN0cmlu\nZz4gZ2V0Q2hpbGRyZW5JblNpbmdsZU5vZGUoZmluYWwgWm9vS2VlcGVyIHpr\nLCBmaW5hbCBTdHJpbmcgbm9kZSkKICAgICAgICAgICAgdGhyb3dzIEludGVy\ncnVwdGVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwg\nR2V0Q2hpbGRyZW5DdHggY3R4ID0gbmV3IEdldENoaWxkcmVuQ3R4KCk7CiAg\nICAgICAgZ2V0Q2hpbGRyZW5JblNpbmdsZU5vZGUoemssIG5vZGUsIG5ldyBH\nZW5lcmljQ2FsbGJhY2s8TGlzdDxTdHJpbmc+PigpIHsKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNv\nbXBsZXRlKGludCByYywgTGlzdDxTdHJpbmc+IGxlZGdlcnMpIHsKICAgICAg\nICAgICAgICAgIHN5bmNocm9uaXplZCAoY3R4KSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKENvZGUuT0suaW50VmFsdWUoKSA9PSByYykgewogICAgICAg\nICAgICAgICAgICAgICAgICBjdHguY2hpbGRyZW4gPSBsZWRnZXJzOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjdHgucmMg\nPSByYzsKICAgICAgICAgICAgICAgICAgICBjdHguZG9uZSA9IHRydWU7CiAg\nICAgICAgICAgICAgICAgICAgY3R4Lm5vdGlmeUFsbCgpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIHN5\nbmNocm9uaXplZCAoY3R4KSB7CiAgICAgICAgICAgIHdoaWxlIChjdHguZG9u\nZSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgY3R4LndhaXQoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoQ29kZS5PSy5pbnRW\nYWx1ZSgpICE9IGN0eC5yYykgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9F\neGNlcHRpb24oIkVycm9yIG9uIGdldHRpbmcgY2hpbGRyZW4gZnJvbSBub2Rl\nICIgKyBub2RlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGN0eC5jaGls\nZHJlbjsKCiAgICB9CgogICAgLyoqCiAgICAgKiBBc3luYyBnZXQgZGlyZWN0\nIGNoaWxkcmVuIHVuZGVyIHNpbmdsZSBub2RlCiAgICAgKgogICAgICogQHBh\ncmFtIHprCiAgICAgKiAgICAgICAgICB6b29rZWVwZXIgY2xpZW50CiAgICAg\nKiBAcGFyYW0gbm9kZQogICAgICogICAgICAgICAgbm9kZSBwYXRoCiAgICAg\nKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAgIGNhbGxiYWNrIGZ1bmN0aW9u\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBnZXRDaGlsZHJlbklu\nU2luZ2xlTm9kZShmaW5hbCBab29LZWVwZXIgemssIGZpbmFsIFN0cmluZyBu\nb2RlLAogICAgICAgICAgICBmaW5hbCBHZW5lcmljQ2FsbGJhY2s8TGlzdDxT\ndHJpbmc+PiBjYikgewogICAgICAgIHprLnN5bmMobm9kZSwgbmV3IEFzeW5j\nQ2FsbGJhY2suVm9pZENhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQg\ncmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAg\nICBpZiAocmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJaSyBlcnJvciBzeW5jaW5nIG5vZGVzIHdo\nZW4gZ2V0dGluZyBjaGlsZHJlbjogIiwgS2VlcGVyRXhjZXB0aW9uCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuY3JlYXRlKEtlZXBlckV4Y2VwdGlv\nbi5Db2RlLmdldChyYyksIHBhdGgpKTsKICAgICAgICAgICAgICAgICAgICBj\nYi5vcGVyYXRpb25Db21wbGV0ZShyYywgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgemsuZ2V0Q2hpbGRyZW4obm9kZSwgZmFsc2UsIG5ldyBBc3luY0NhbGxi\nYWNrLkNoaWxkcmVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJv\nY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBM\naXN0PFN0cmluZz4gbm9kZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHJjICE9IENvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBwb2xsaW5nIFpLIGZv\nciB0aGUgYXZhaWxhYmxlIG5vZGVzOiAiLCBLZWVwZXJFeGNlcHRpb24KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZShLZWVw\nZXJFeGNlcHRpb24uQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25Db21wbGV0ZShyYywgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLm9wZXJhdGlvbkNvbXBsZXRlKHJjLCBub2Rlcyk7CgogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBHZXQgbmV3IFpvb0tlZXBlciBjbGllbnQuIFdhaXRzIHRpbGwgdGhlIGNv\nbm5lY3Rpb24gaXMgY29tcGxldGUuIElmCiAgICAgKiBjb25uZWN0aW9uIGlz\nIG5vdCBzdWNjZXNzZnVsIHdpdGhpbiB0aW1lb3V0LCB0aGVuIHRocm93cyBi\nYWNrIGV4Y2VwdGlvbi4KICAgICAqCiAgICAgKiBAcGFyYW0gc2VydmVycwog\nICAgICogICAgICAgICAgICBaSyBzZXJ2ZXJzIGNvbm5lY3Rpb24gc3RyaW5n\nLgogICAgICogQHBhcmFtIHRpbWVvdXQKICAgICAqICAgICAgICAgICAgU2Vz\nc2lvbiB0aW1lb3V0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFpvb0tl\nZXBlciBjcmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGllbnQoU3RyaW5nIHNl\ncnZlcnMsCiAgICAgICAgICAgIFpvb0tlZXBlcldhdGNoZXJCYXNlIHcpIHRo\ncm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sCiAgICAg\nICAgICAgIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHNlcnZlcnMg\nPT0gbnVsbCB8fCBzZXJ2ZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJzZXJ2ZXJzIGNh\nbm5vdCBiZSBlbXB0eSIpOwogICAgICAgIH0KICAgICAgICBmaW5hbCBab29L\nZWVwZXIgbmV3WmsgPSBuZXcgWm9vS2VlcGVyKHNlcnZlcnMsIHcuZ2V0WmtT\nZXNzaW9uVGltZU91dCgpLAogICAgICAgICAgICAgICAgdyk7CiAgICAgICAg\ndy53YWl0Rm9yQ29ubmVjdGlvbigpOwogICAgICAgIC8vIFJlLWNoZWNraW5n\nIHpvb2tlZXBlciBjb25uZWN0aW9uIHN0YXR1cwogICAgICAgIGlmICghbmV3\nWmsuZ2V0U3RhdGUoKS5pc0Nvbm5lY3RlZCgpKSB7CiAgICAgICAgICAgIHRo\ncm93IEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoS2VlcGVyRXhjZXB0aW9uLkNv\nZGUuQ09OTkVDVElPTkxPU1MpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nbmV3Wms7CiAgICB9Cn0K\n","encoding":"base64"}

