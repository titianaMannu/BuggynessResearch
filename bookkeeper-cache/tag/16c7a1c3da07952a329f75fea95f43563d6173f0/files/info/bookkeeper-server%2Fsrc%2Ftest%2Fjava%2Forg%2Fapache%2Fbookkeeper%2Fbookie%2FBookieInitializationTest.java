{"sha":"bdc54cd1ceb91b4f820c5066daf54c6e55276863","node_id":"MDQ6QmxvYjE1NzU5NTY6YmRjNTRjZDFjZWI5MWI0ZjgyMGM1MDY2ZGFmNTRjNmU1NTI3Njg2Mw==","size":13336,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/bdc54cd1ceb91b4f820c5066daf54c6e55276863","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuZmFpbDsKCmltcG9ydCBq\nYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uZXQuQmluZEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRBZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnRE\nb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5p\ndDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuQXNzZXJ0OwoKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2llOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWVFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2Vy\ndmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQm9va0tlZXBlckFkbWluOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci50ZXN0Llpvb0tlZXBlclV0aWw7CmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMuaW8uRmlsZVV0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLmRhdGEu\nU3RhdDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5p\ndC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\nCi8qKgogKiBUZXN0aW5nIGJvb2tpZSBpbml0aWFsaXphdGlvbiBjYXNlcwog\nKi8KcHVibGljIGNsYXNzIEJvb2tpZUluaXRpYWxpemF0aW9uVGVzdCB7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFj\ndG9yeQogICAgICAgICAgICAuZ2V0TG9nZ2VyKEJvb2tpZUluaXRpYWxpemF0\naW9uVGVzdC5jbGFzcyk7CiAgICBab29LZWVwZXJVdGlsIHprdXRpbDsKICAg\nIFpvb0tlZXBlciB6a2MgPSBudWxsOwogICAgWm9vS2VlcGVyIG5ld3prID0g\nbnVsbDsKCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBzZXR1cFpvb0tl\nZXBlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHprdXRpbCA9IG5l\ndyBab29LZWVwZXJVdGlsKCk7CiAgICAgICAgemt1dGlsLnN0YXJ0U2VydmVy\nKCk7CiAgICAgICAgemtjID0gemt1dGlsLmdldFpvb0tlZXBlckNsaWVudCgp\nOwogICAgfQoKICAgIEBBZnRlcgogICAgcHVibGljIHZvaWQgdGVhckRvd25a\nb29LZWVwZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAobmV3\nemsgIT0gbnVsbCkgewogICAgICAgICAgICBuZXd6ay5jbG9zZSgpOwogICAg\nICAgIH0KICAgICAgICB6a3V0aWwua2lsbFNlcnZlcigpOwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIE1vY2tCb29raWUgZXh0ZW5kcyBCb29r\naWUgewogICAgICAgIE1vY2tCb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBj\nb25mKSB0aHJvd3MgSU9FeGNlcHRpb24sCiAgICAgICAgICAgICAgICBLZWVw\nZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNl\ncHRpb24gewogICAgICAgICAgICBzdXBlcihjb25mKTsKICAgICAgICB9Cgog\nICAgICAgIHZvaWQgdGVzdFJlZ2lzdGVyQm9va2llKFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nc3VwZXIucmVnaXN0ZXJCb29raWUoY29uZik7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVmVyaWZ5IHRoZSBib29raWUgc2VydmVyIGV4aXQg\nY29kZS4gT24gWm9vS2VlcGVyIGV4Y2VwdGlvbiwgc2hvdWxkIHJldHVybgog\nICAgICogZXhpdCBjb2RlIFpLX1JFR19GQUlMID0gNAogICAgICovCiAgICBA\nVGVzdCh0aW1lb3V0ID0gMjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RXhp\ndENvZGVaS19SRUdfRkFJTCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIEZpbGUgdG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwg\nInRlc3QiKTsKICAgICAgICB0bXBEaXIuZGVsZXRlKCk7CiAgICAgICAgdG1w\nRGlyLm1rZGlyKCk7CgogICAgICAgIGZpbmFsIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAg\nICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkuc2V0Sm91cm5hbERpck5hbWUo\ndG1wRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgICAgIC5zZXRMZWRnZXJE\naXJOYW1lcyhuZXcgU3RyaW5nW10geyB0bXBEaXIuZ2V0UGF0aCgpIH0pOwoK\nICAgICAgICAvLyBzaW11bGF0aW5nIFpvb0tlZXBlciBleGNlcHRpb24gYnkg\nYXNzaWduaW5nIGEgY2xvc2VkIHprIGNsaWVudCB0byBiawogICAgICAgIEJv\nb2tpZVNlcnZlciBia1NlcnZlciA9IG5ldyBCb29raWVTZXJ2ZXIoY29uZikg\newogICAgICAgICAgICBwcm90ZWN0ZWQgQm9va2llIG5ld0Jvb2tpZShTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVk\nRXhjZXB0aW9uLAogICAgICAgICAgICAgICAgICAgIEJvb2tpZUV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgICAgICBNb2NrQm9va2llIGJvb2tpZSA9IG5ldyBN\nb2NrQm9va2llKGNvbmYpOwogICAgICAgICAgICAgICAgYm9va2llLnprID0g\nemtjOwogICAgICAgICAgICAgICAgemtjLmNsb3NlKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gYm9va2llOwogICAgICAgICAgICB9OwogICAgICAgIH07\nCgogICAgICAgIGJrU2VydmVyLnN0YXJ0KCk7CiAgICAgICAgYmtTZXJ2ZXIu\nam9pbigpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMoIkZhaWxlZCB0\nbyByZXR1cm4gRXhpdENvZGUuWktfUkVHX0ZBSUwiLAogICAgICAgICAgICAg\nICAgRXhpdENvZGUuWktfUkVHX0ZBSUwsIGJrU2VydmVyLmdldEV4aXRDb2Rl\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICogVmVyaWZ5IHRoZSBib29raWUg\ncmVnLiBSZXN0YXJ0aW5nIGJvb2tpZSBzZXJ2ZXIgd2lsbCB3YWl0IGZvciB0\naGUgc2Vzc2lvbgogICAgICogdGltZW91dCB3aGVuIHByZXZpb3VzIHJlZyBu\nb2RlIGV4aXN0cyBpbiB6ay4gT24gek5vZGUgZGVsZXRlIGV2ZW50LAogICAg\nICogc2hvdWxkIGNvbnRpbnVlIHN0YXJ0dXAKICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dCA9IDIwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEJvb2tpZVJl\nZ2lzdHJhdGlvbigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUg\ndG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgInRlc3Qi\nKTsKICAgICAgICB0bXBEaXIuZGVsZXRlKCk7CiAgICAgICAgdG1wRGlyLm1r\nZGlyKCk7CgogICAgICAgIGZpbmFsIFNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgICAg\nIC5zZXRaa1NlcnZlcnMobnVsbCkuc2V0Sm91cm5hbERpck5hbWUodG1wRGly\nLmdldFBhdGgoKSkKICAgICAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1l\ncyhuZXcgU3RyaW5nW10geyB0bXBEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAg\nICBmaW5hbCBTdHJpbmcgYmtSZWdQYXRoID0gY29uZi5nZXRaa0F2YWlsYWJs\nZUJvb2tpZXNQYXRoKCkgKyAiLyIKICAgICAgICAgICAgICAgICsgSW5ldEFk\nZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSArICI6Igog\nICAgICAgICAgICAgICAgKyBjb25mLmdldEJvb2tpZVBvcnQoKTsKCiAgICAg\nICAgTW9ja0Jvb2tpZSBiID0gbmV3IE1vY2tCb29raWUoY29uZik7CiAgICAg\nICAgYi56ayA9IHprYzsKICAgICAgICBiLnRlc3RSZWdpc3RlckJvb2tpZShj\nb25mKTsKICAgICAgICBTdGF0IGJrUmVnTm9kZTEgPSB6a2MuZXhpc3RzKGJr\nUmVnUGF0aCwgZmFsc2UpOwogICAgICAgIEFzc2VydC5hc3NlcnROb3ROdWxs\nKCJCb29raWUgcmVnaXN0cmF0aW9uIG5vZGUgZG9lc24ndCBleGlzdHMhIiwK\nICAgICAgICAgICAgICAgIGJrUmVnTm9kZTEpOwoKICAgICAgICAvLyBzaW11\nbGF0aW5nIGJvb2tpZSByZXN0YXJ0LCBvbiByZXN0YXJ0IGJvb2tpZSB3aWxs\nIGNyZWF0ZSBuZXcKICAgICAgICAvLyB6a2NsaWVudCBhbmQgZG9pbmcgdGhl\nIHJlZ2lzdHJhdGlvbi4KICAgICAgICBjcmVhdGVOZXdaS0NsaWVudCgpOwog\nICAgICAgIGIuemsgPSBuZXd6azsKCiAgICAgICAgLy8gZGVsZXRpbmcgdGhl\nIHpub2RlLCBzbyB0aGF0IHRoZSBib29raWUgcmVnaXN0cmF0aW9uIHNob3Vs\nZAogICAgICAgIC8vIGNvbnRpbnVlIHN1Y2Nlc3NmdWxseSBvbiBOb2RlRGVs\nZXRlZCBldmVudAogICAgICAgIG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIFRocmVh\nZC5zbGVlcChjb25mLmdldFprVGltZW91dCgpIC8gMyk7CiAgICAgICAgICAg\nICAgICAgICAgemtjLmRlbGV0ZShia1JlZ1BhdGgsIC0xKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICAgICAgLy8gTm90IGhhbmRsaW5nLCBzaW5jZSB0aGUgdGVzdFJlZ2lzdGVy\nQm9va2llIHdpbGwgZmFpbAogICAgICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiRmFpbGVkIHRvIGRlbGV0ZSB0aGUgem5vZGUgOiIgKyBia1JlZ1BhdGgs\nIGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfS5zdGFydCgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGIudGVzdFJl\nZ2lzdGVyQm9va2llKGNvbmYpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgVGhyb3dhYmxlIHQgPSBlLmdldENhdXNl\nKCk7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2YgS2VlcGVyRXhjZXB0\naW9uKSB7CiAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24ga2UgPSAo\nS2VlcGVyRXhjZXB0aW9uKSB0OwogICAgICAgICAgICAgICAgQXNzZXJ0LmFz\nc2VydFRydWUoIkVycm9yQ29kZToiICsga2UuY29kZSgpCiAgICAgICAgICAg\nICAgICAgICAgICAgICsgIiwgUmVnaXN0cmF0aW9uIG5vZGUgZXhpc3RzIiwK\nICAgICAgICAgICAgICAgICAgICAgICAga2UuY29kZSgpICE9IEtlZXBlckV4\nY2VwdGlvbi5Db2RlLk5PREVFWElTVFMpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHRocm93IGU7CiAgICAgICAgfQoKICAgICAgICAvLyB2ZXJpZnkg\nZXBoZW1lcmFsIG93bmVyIG9mIHRoZSBia1JlZyB6bm9kZQogICAgICAgIFN0\nYXQgYmtSZWdOb2RlMiA9IG5ld3prLmV4aXN0cyhia1JlZ1BhdGgsIGZhbHNl\nKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0Tm90TnVsbCgiQm9va2llIHJlZ2lz\ndHJhdGlvbiBoYXMgYmVlbiBmYWlsZWQiLCBia1JlZ05vZGUyKTsKICAgICAg\nICBBc3NlcnQuYXNzZXJ0VHJ1ZSgiQm9va2llIGlzIHJlZmVycmluZyB0byBv\nbGQgcmVnaXN0cmF0aW9uIHpub2RlOiIKICAgICAgICAgICAgICAgICsgYmtS\nZWdOb2RlMSArICIsIE5ldyBaTm9kZToiICsgYmtSZWdOb2RlMiwgYmtSZWdO\nb2RlMQogICAgICAgICAgICAgICAgLmdldEVwaGVtZXJhbE93bmVyKCkgIT0g\nYmtSZWdOb2RlMi5nZXRFcGhlbWVyYWxPd25lcigpKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFZlcmlmeSB0aGUgYm9va2llIHJlZ2lzdHJhdGlvbiwgaXQg\nc2hvdWxkIHRocm93CiAgICAgKiBLZWVwZXJFeGNlcHRpb24uTm9kZUV4aXN0\nc0V4Y2VwdGlvbiBpZiB0aGUgem5vZGUgc3RpbGwgZXhpc3RzIGV2ZW4gYWZ0\nZXIKICAgICAqIHRoZSB6ayBzZXNzaW9uIHRpbWVvdXQuCiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQgPSAzMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RS\nZWdOb2RlRXhpc3RzQWZ0ZXJTZXNzaW9uVGltZU91dCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIEZpbGUgdG1wRGlyID0gRmlsZS5jcmVhdGVUZW1w\nRmlsZSgiYm9va2llIiwgInRlc3QiKTsKICAgICAgICB0bXBEaXIuZGVsZXRl\nKCk7CiAgICAgICAgdG1wRGlyLm1rZGlyKCk7CgogICAgICAgIFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCku\nc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAgICAgICAgICAuc2V0Sm91cm5h\nbERpck5hbWUodG1wRGlyLmdldFBhdGgoKSkuc2V0TGVkZ2VyRGlyTmFtZXMo\nCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBTdHJpbmdbXSB7IHRtcERp\nci5nZXRQYXRoKCkgfSk7CgogICAgICAgIFN0cmluZyBia1JlZ1BhdGggPSBj\nb25mLmdldFprQXZhaWxhYmxlQm9va2llc1BhdGgoKSArICIvIgogICAgICAg\nICAgICAgICAgKyBJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0\nQWRkcmVzcygpICsgIjoiCiAgICAgICAgICAgICAgICArIGNvbmYuZ2V0Qm9v\na2llUG9ydCgpOwoKICAgICAgICBNb2NrQm9va2llIGIgPSBuZXcgTW9ja0Jv\nb2tpZShjb25mKTsKICAgICAgICBiLnprID0gemtjOwogICAgICAgIGIudGVz\ndFJlZ2lzdGVyQm9va2llKGNvbmYpOwogICAgICAgIFN0YXQgYmtSZWdOb2Rl\nMSA9IHprYy5leGlzdHMoYmtSZWdQYXRoLCBmYWxzZSk7CiAgICAgICAgQXNz\nZXJ0LmFzc2VydE5vdE51bGwoIkJvb2tpZSByZWdpc3RyYXRpb24gbm9kZSBk\nb2Vzbid0IGV4aXN0cyEiLAogICAgICAgICAgICAgICAgYmtSZWdOb2RlMSk7\nCgogICAgICAgIC8vIHNpbXVsYXRpbmcgYm9va2llIHJlc3RhcnQsIG9uIHJl\nc3RhcnQgYm9va2llIHdpbGwgY3JlYXRlIG5ldwogICAgICAgIC8vIHprY2xp\nZW50IGFuZCBkb2luZyB0aGUgcmVnaXN0cmF0aW9uLgogICAgICAgIGNyZWF0\nZU5ld1pLQ2xpZW50KCk7CiAgICAgICAgYi56ayA9IG5ld3prOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGIudGVzdFJlZ2lzdGVyQm9va2llKGNvbmYp\nOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgdGhyb3cgTm9kZUV4aXN0c0V4\nY2VwdGlvbiBhcyB0aGUgem5vZGUgaXMgbm90IGdldHRpbmcgZXhwaXJlZCIp\nOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgVGhyb3dhYmxlIHQgPSBlLmdldENhdXNlKCk7CiAgICAgICAgICAgIGlm\nICh0IGluc3RhbmNlb2YgS2VlcGVyRXhjZXB0aW9uKSB7CiAgICAgICAgICAg\nICAgICBLZWVwZXJFeGNlcHRpb24ga2UgPSAoS2VlcGVyRXhjZXB0aW9uKSB0\nOwogICAgICAgICAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUoIkVycm9yQ29k\nZToiICsga2UuY29kZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICsgIiwg\nUmVnaXN0cmF0aW9uIG5vZGUgZG9lc24ndCBleGlzdHMiLAogICAgICAgICAg\nICAgICAgICAgICAgICBrZS5jb2RlKCkgPT0gS2VlcGVyRXhjZXB0aW9uLkNv\nZGUuTk9ERUVYSVNUUyk7CgogICAgICAgICAgICAgICAgLy8gdmVyaWZ5IGVw\naGVtZXJhbCBvd25lciBvZiB0aGUgYmtSZWcgem5vZGUKICAgICAgICAgICAg\nICAgIFN0YXQgYmtSZWdOb2RlMiA9IG5ld3prLmV4aXN0cyhia1JlZ1BhdGgs\nIGZhbHNlKTsKICAgICAgICAgICAgICAgIEFzc2VydC5hc3NlcnROb3ROdWxs\nKCJCb29raWUgcmVnaXN0cmF0aW9uIGhhcyBiZWVuIGZhaWxlZCIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIGJrUmVnTm9kZTIpOwogICAgICAgICAgICAg\nICAgQXNzZXJ0LmFzc2VydFRydWUoCiAgICAgICAgICAgICAgICAgICAgICAg\nICJCb29raWUgd3JvbmdseSByZWdpc3RlcmVkLiBPbGQgcmVnaXN0cmF0aW9u\nIHpub2RlOiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGJr\nUmVnTm9kZTEgKyAiLCBOZXcgem5vZGU6IiArIGJrUmVnTm9kZTIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIGJrUmVnTm9kZTEuZ2V0RXBoZW1lcmFsT3du\nZXIoKSA9PSBia1JlZ05vZGUyCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLmdldEVwaGVtZXJhbE93bmVyKCkpOwogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IGU7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmVyaWZ5IGR1cGxpY2F0\nZSBib29raWUgc2VydmVyIHN0YXJ0dXAuIFNob3VsZCB0aHJvdwogICAgICog\namF2YS5uZXQuQmluZEV4Y2VwdGlvbiBpZiBhbHJlYWR5IEJLIHNlcnZlciBp\ncyBydW5uaW5nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAyMDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3REdXBsaWNhdGVCb29raWVTZXJ2ZXJTdGFy\ndHVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSB0bXBEaXIg\nPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAidGVzdCIpOwogICAg\nICAgIHRtcERpci5kZWxldGUoKTsKICAgICAgICB0bXBEaXIubWtkaXIoKTsK\nCiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZl\nckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICBpbnQgcG9ydCA9IDEyNTU1Owog\nICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKG51bGwpLnNldEJvb2tpZVBvcnQo\ncG9ydCkuc2V0Sm91cm5hbERpck5hbWUoCiAgICAgICAgICAgICAgICB0bXBE\naXIuZ2V0UGF0aCgpKS5zZXRMZWRnZXJEaXJOYW1lcygKICAgICAgICAgICAg\nICAgIG5ldyBTdHJpbmdbXSB7IHRtcERpci5nZXRQYXRoKCkgfSk7CiAgICAg\nICAgQm9va2llU2VydmVyIGJzMSA9IG5ldyBCb29raWVTZXJ2ZXIoY29uZik7\nCiAgICAgICAgYnMxLnN0YXJ0KCk7CgogICAgICAgIC8vIHN0YXJ0aW5nIGJr\nIHNlcnZlciB3aXRoIHNhbWUgY29uZgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEJvb2tpZVNlcnZlciBiczIgPSBuZXcgQm9va2llU2VydmVyKGNvbmYp\nOwogICAgICAgICAgICBiczIuc3RhcnQoKTsKICAgICAgICAgICAgZmFpbCgi\nU2hvdWxkIHRocm93IEJpbmRFeGNlcHRpb24sIGFzIHRoZSBiayBzZXJ2ZXIg\naXMgYWxyZWFkeSBydW5uaW5nISIpOwogICAgICAgIH0gY2F0Y2ggKEJpbmRF\neGNlcHRpb24gYmUpIHsKICAgICAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUo\nIkJLU2VydmVyIGFsbG93ZWQgZHVwbGljYXRlIHN0YXJ0dXBzISIsIGJlCiAg\nICAgICAgICAgICAgICAgICAgLmdldE1lc3NhZ2UoKS5jb250YWlucygiQWRk\ncmVzcyBhbHJlYWR5IGluIHVzZSIpKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBWZXJpZnkgYm9va2llIHN0YXJ0IGJlaGF2aW91ciB3aGVu\nIFpLIFNlcnZlciBpcyBub3QgcnVubmluZy4KICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dCA9IDIwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN0YXJ0Qm9v\na2llV2l0aG91dFpLU2VydmVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgemt1dGlsLmtpbGxTZXJ2ZXIoKTsKCiAgICAgICAgRmlsZSB0bXBEaXIg\nPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAidGVzdCIpOwogICAg\nICAgIHRtcERpci5kZWxldGUoKTsKICAgICAgICB0bXBEaXIubWtkaXIoKTsK\nCiAgICAgICAgZmluYWwgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3\nIFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAgICAgLnNldFpr\nU2VydmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKQog\nICAgICAgICAgICAgICAgLnNldFprVGltZW91dCg1MDAwKS5zZXRKb3VybmFs\nRGlyTmFtZSh0bXBEaXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAgICAgLnNl\ndExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IHRtcERpci5nZXRQYXRo\nKCkgfSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbmV3IEJvb2tpZShj\nb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIHRocm93IENvbm5lY3Rp\nb25Mb3NzRXhjZXB0aW9uIGFzIFpLU2VydmVyIGlzIG5vdCBydW5uaW5nISIp\nOwogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Db25uZWN0aW9u\nTG9zc0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGV4cGVjdGVkIGJl\naGF2aW91cgogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIEZpbGVV\ndGlscy5kZWxldGVEaXJlY3RvcnkodG1wRGlyKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBWZXJpZnkgdGhhdCBpZiBJIHRyeSB0byBzdGFy\ndCBhIGJvb2tpZSB3aXRob3V0IHprIGluaXRpYWxpemVkLCBpdCB3b24ndAog\nICAgICogcHJldmVudCBtZSBmcm9tIHN0YXJ0aW5nIHRoZSBib29raWUgd2hl\nbiB6ayBpcyBpbml0aWFsaXplZAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0\nID0gMjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3RhcnRCb29raWVXaXRo\nb3V0WktJbml0aWFsaXplZCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIEZpbGUgdG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwg\nInRlc3QiKTsKICAgICAgICB0bXBEaXIuZGVsZXRlKCk7CiAgICAgICAgdG1w\nRGlyLm1rZGlyKCk7CiAgICAgICAgZmluYWwgU3RyaW5nIFpLX1JPT1QgPSAi\nL2xlZGdlcnMyIjsKCiAgICAgICAgZmluYWwgU2VydmVyQ29uZmlndXJhdGlv\nbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAg\nICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3Ry\naW5nKCkpCiAgICAgICAgICAgIC5zZXRaa1RpbWVvdXQoNTAwMCkuc2V0Sm91\ncm5hbERpck5hbWUodG1wRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNl\ndExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IHRtcERpci5nZXRQYXRo\nKCkgfSk7CiAgICAgICAgY29uZi5zZXRaa0xlZGdlcnNSb290UGF0aChaS19S\nT09UKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAgICAgIGZh\naWwoIlNob3VsZCB0aHJvdyBOb05vZGVFeGNlcHRpb24iKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8v\nIHNob3VsZG4ndCBiZSBhYmxlIHRvIHN0YXJ0CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgQ2xpZW50Q29uZmlndXJhdGlvbiBjbGllbnRDb25mID0gbmV3\nIENsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgY2xpZW50Q29u\nZi5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJp\nbmcoKSk7CiAgICAgICAgICAgIGNsaWVudENvbmYuc2V0WmtMZWRnZXJzUm9v\ndFBhdGgoWktfUk9PVCk7CiAgICAgICAgICAgIEJvb2tLZWVwZXJBZG1pbi5m\nb3JtYXQoY2xpZW50Q29uZiwgZmFsc2UsIGZhbHNlKTsKCiAgICAgICAgICAg\nIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAgYi5z\naHV0ZG93bigpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIEZp\nbGVVdGlscy5kZWxldGVEaXJlY3RvcnkodG1wRGlyKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIGNyZWF0ZU5ld1pLQ2xpZW50KCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gY3JlYXRlIGEgem9va2VlcGVy\nIGNsaWVudAogICAgICAgIExPRy5kZWJ1ZygiSW5zdGFudGlhdGUgWksgQ2xp\nZW50Iik7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggbGF0Y2ggPSBu\nZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgbmV3emsgPSBuZXcgWm9v\nS2VlcGVyKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIDEw\nMDAwLAogICAgICAgICAgICAgICAgbmV3IFdhdGNoZXIoKSB7CiAgICAgICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIHNlc3Npb24gZGlzY29ubmVj\ndHMgYW5kIGV4cGlyZXMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2\nZW50LmdldFN0YXRlKCkuZXF1YWxzKAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5l\nY3RlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGNoLmNv\ndW50RG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgaWYg\nKCFsYXRjaC5hd2FpdCgxMDAwMCwgVGltZVVuaXQuTUlMTElTRUNPTkRTKSkg\newogICAgICAgICAgICBuZXd6ay5jbG9zZSgpOwogICAgICAgICAgICBmYWls\nKCJDb3VsZCBub3QgY29ubmVjdCB0byB6b29rZWVwZXIgc2VydmVyIik7CiAg\nICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

