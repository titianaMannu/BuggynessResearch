{"sha":"716018133f1c485781bcd96e9eef7d051c5fd92a","node_id":"MDQ6QmxvYjE1NzU5NTY6NzE2MDE4MTMzZjFjNDg1NzgxYmNkOTZlOWVlZjdkMDUxYzVmZDkyYQ==","size":19156,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/716018133f1c485781bcd96e9eef7d051c5fd92a","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWUuTm9MZWRnZXJFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGEuTGVkZ2VyTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuU25hcHNob3RNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkxpbmtlZEJsb2NraW5nUXVldWU7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmlvLkZpbGVVdGlsczsKaW1w\nb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5Bc3NlcnQ7\nCmltcG9ydCBvcmcuanVuaXQuQmVmb3JlOwppbXBvcnQgb3JnLmp1bml0LlRl\nc3Q7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0\nQ2FzZTsKCi8qKgogKiBMZWRnZXJDYWNoZSByZWxhdGVkIHRlc3QgY2FzZXMK\nICovCnB1YmxpYyBjbGFzcyBMZWRnZXJDYWNoZVRlc3QgZXh0ZW5kcyBUZXN0\nQ2FzZSB7CiAgICBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3Rvcnku\nZ2V0TG9nZ2VyKExlZGdlckNhY2hlVGVzdC5jbGFzcyk7CgogICAgU25hcHNo\nb3RNYXA8TG9uZywgQm9vbGVhbj4gYWN0aXZlTGVkZ2VyczsKICAgIExlZGdl\nck1hbmFnZXJGYWN0b3J5IGxlZGdlck1hbmFnZXJGYWN0b3J5OwogICAgTGVk\nZ2VyQ2FjaGUgbGVkZ2VyQ2FjaGU7CiAgICBUaHJlYWQgZmx1c2hUaHJlYWQ7\nCiAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICBGaWxlIHR4bkRp\nciwgbGVkZ2VyRGlyOwoKICAgIHByaXZhdGUgQm9va2llIGJvb2tpZTsKCiAg\nICBAT3ZlcnJpZGUKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldFVw\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdHhuRGlyID0gRmlsZS5j\ncmVhdGVUZW1wRmlsZSgibGVkZ2VyY2FjaGUiLCAidHhuIik7CiAgICAgICAg\ndHhuRGlyLmRlbGV0ZSgpOwogICAgICAgIHR4bkRpci5ta2RpcigpOwogICAg\nICAgIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImxlZGdlcmNh\nY2hlIiwgImxlZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsK\nICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICAvLyBjcmVhdGUg\nY3VycmVudCBkaXIKICAgICAgICBuZXcgRmlsZShsZWRnZXJEaXIsIEJvb2tL\nZWVwZXJDb25zdGFudHMuQ1VSUkVOVF9ESVIpLm1rZGlyKCk7CgogICAgICAg\nIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgIGNv\nbmYuc2V0WmtTZXJ2ZXJzKG51bGwpOwogICAgICAgIGNvbmYuc2V0Sm91cm5h\nbERpck5hbWUodHhuRGlyLmdldFBhdGgoKSk7CiAgICAgICAgY29uZi5zZXRM\nZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0\naCgpIH0pOwogICAgICAgIGJvb2tpZSA9IG5ldyBCb29raWUoY29uZik7Cgog\nICAgICAgIGxlZGdlck1hbmFnZXJGYWN0b3J5ID0KICAgICAgICAgICAgTGVk\nZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2VyTWFuYWdlckZhY3RvcnkoY29u\nZiwgbnVsbCk7CiAgICAgICAgYWN0aXZlTGVkZ2VycyA9IG5ldyBTbmFwc2hv\ndE1hcDxMb25nLCBCb29sZWFuPigpOwogICAgICAgIGxlZGdlckNhY2hlID0g\nKChJbnRlcmxlYXZlZExlZGdlclN0b3JhZ2UpIGJvb2tpZS5sZWRnZXJTdG9y\nYWdlKS5sZWRnZXJDYWNoZTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIEBB\nZnRlcgogICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoZmx1c2hUaHJlYWQgIT0gbnVsbCkgewogICAg\nICAgICAgICBmbHVzaFRocmVhZC5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAg\nZmx1c2hUaHJlYWQuam9pbigpOwogICAgICAgIH0KICAgICAgICBib29raWUu\nbGVkZ2VyU3RvcmFnZS5zaHV0ZG93bigpOwogICAgICAgIGxlZGdlck1hbmFn\nZXJGYWN0b3J5LnVuaW5pdGlhbGl6ZSgpOwogICAgICAgIEZpbGVVdGlscy5k\nZWxldGVEaXJlY3RvcnkodHhuRGlyKTsKICAgICAgICBGaWxlVXRpbHMuZGVs\nZXRlRGlyZWN0b3J5KGxlZGdlckRpcik7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIG5ld0xlZGdlckNhY2hlKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAobGVkZ2VyQ2FjaGUgIT0gbnVsbCkgewogICAgICAgICAgICBs\nZWRnZXJDYWNoZS5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBsZWRnZXJD\nYWNoZSA9ICgoSW50ZXJsZWF2ZWRMZWRnZXJTdG9yYWdlKSBib29raWUubGVk\nZ2VyU3RvcmFnZSkubGVkZ2VyQ2FjaGUgPSBuZXcgTGVkZ2VyQ2FjaGVJbXBs\nKAogICAgICAgICAgICAgICAgY29uZiwgYWN0aXZlTGVkZ2VycywgYm9va2ll\nLmdldExlZGdlckRpcnNNYW5hZ2VyKCkpOwogICAgICAgIGZsdXNoVGhyZWFk\nID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgc2xlZXAoY29uZi5nZXRGbHVzaEludGVydmFsKCkpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuZmx1c2hM\nZWRnZXIodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBraWxsZWQgYnkgdGVhcmRvd24KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJy\ndXB0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2Vw\ndGlvbiBpbiBmbHVzaCB0aHJlYWQiLCBlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfTsKICAgICAgICBmbHVzaFRocmVhZC5zdGFydCgp\nOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0QWRkRW50cnlFeGNlcHRpb24oKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIC8vIHNldCBwYWdlIGxpbWl0YXRpb24KICAgICAgICBj\nb25mLnNldFBhZ2VMaW1pdCgxMCk7CiAgICAgICAgLy8gY3JlYXRlIGEgbGVk\nZ2VyIGNhY2hlCiAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsKICAgICAgICAv\nKgogICAgICAgICAqIFBvcHVsYXRlIGxlZGdlciBjYWNoZS4KICAgICAgICAg\nKi8KICAgICAgICB0cnkgewogICAgICAgICAgICBieXRlW10gbWFzdGVyS2V5\nID0gImJsYWgiLmdldEJ5dGVzKCk7CiAgICAgICAgICAgIGZvciggaW50IGkg\nPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckNh\nY2hlLnNldE1hc3RlcktleSgobG9uZylpLCBtYXN0ZXJLZXkpOwogICAgICAg\nICAgICAgICAgbGVkZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoaSwgMCwgaSo4\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJHb3QgSU9FeGNlcHRpb24u\nIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIkZhaWxlZCB0byBhZGQgZW50cnku\nIik7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0TGVkZ2VyRXZpY3Rpb24oKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBpbnQgbnVtRW50cmllcyA9IDEwOwogICAg\nICAgIC8vIGxpbWl0IG9wZW4gZmlsZXMgJiBwYWdlcwogICAgICAgIGNvbmYu\nc2V0T3BlbkZpbGVMaW1pdCgxKS5zZXRQYWdlTGltaXQoMikKICAgICAgICAg\nICAgLnNldFBhZ2VTaXplKDggKiBudW1FbnRyaWVzKTsKICAgICAgICAvLyBj\ncmVhdGUgbGVkZ2VyIGNhY2hlCiAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpbnQgbnVtTGVkZ2VycyA9IDM7\nCiAgICAgICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkgPSAiYmxhaCIuZ2V0Qnl0\nZXMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRnZXJz\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLnNldE1hc3Rl\ncktleSgobG9uZylpLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaj0wOyBqPG51bUVudHJpZXM7IGorKykgewogICAgICAgICAgICAg\nICAgICAgIGxlZGdlckNhY2hlLnB1dEVudHJ5T2Zmc2V0KGksIGosIGkgKiBu\ndW1FbnRyaWVzICsgaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIkdvdCBFeGNlcHRpb24uIiwgZSk7CiAgICAgICAgICAg\nIGZhaWwoIkZhaWxlZCB0byBhZGQgZW50cnkuIik7CiAgICAgICAgfQogICAg\nfQoKICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0RGVsZXRlTGVkZ2VyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\naW50IG51bUVudHJpZXMgPSAxMDsKICAgICAgICAvLyBsaW1pdCBvcGVuIGZp\nbGVzICYgcGFnZXMKICAgICAgICBjb25mLnNldE9wZW5GaWxlTGltaXQoOTk5\nKS5zZXRQYWdlTGltaXQoMikKICAgICAgICAgICAgLnNldFBhZ2VTaXplKDgg\nKiBudW1FbnRyaWVzKTsKICAgICAgICAvLyBjcmVhdGUgbGVkZ2VyIGNhY2hl\nCiAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpbnQgbnVtTGVkZ2VycyA9IDI7CiAgICAgICAgICAgIGJ5dGVb\nXSBtYXN0ZXJLZXkgPSAiYmxhaCIuZ2V0Qnl0ZXMoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaT0xOyBpPD1udW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGxlZGdlckNhY2hlLnNldE1hc3RlcktleSgobG9uZylpLCBtYXN0\nZXJLZXkpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaj0wOyBqPG51bUVu\ndHJpZXM7IGorKykgewogICAgICAgICAgICAgICAgICAgIGxlZGdlckNhY2hl\nLnB1dEVudHJ5T2Zmc2V0KGksIGosIGkqbnVtRW50cmllcyArIGopOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGxl\nZGdlciBjYWNoZSBpcyBleGhhdXN0ZWQKICAgICAgICAgICAgLy8gZGVsZXRl\nIGxlZGdlcnMKICAgICAgICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRn\nZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLmRlbGV0\nZUxlZGdlcigobG9uZylpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBjcmVhdGUgbnVtIGxlZGdlcnMgdG8gYWRkIGVudHJpZXMKICAgICAgICAg\nICAgZm9yIChpbnQgaT1udW1MZWRnZXJzKzE7IGk8PTIqbnVtTGVkZ2Vyczsg\naSsrKSB7CiAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5zZXRNYXN0ZXJL\nZXkoKGxvbmcpaSwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgIGZvciAo\naW50IGo9MDsgajxudW1FbnRyaWVzOyBqKyspIHsKICAgICAgICAgICAgICAg\nICAgICBsZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNldChpLCBqLCBpKm51bUVu\ndHJpZXMgKyBqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiR290IEV4Y2VwdGlvbi4iLCBlKTsKICAgICAgICAgICAgZmFp\nbCgiRmFpbGVkIHRvIGFkZCBlbnRyeS4iKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUZXN0IHNpbXVsYXRpbmcgcmFjZSBjb25kaXRpb24g\nYmV0d2VlbiB3aGVuIGEgbGVkZ2VyIGlzIGRlbGV0aW5nIGFuZCBhbgogICAg\nICogZXZpY3Rpb24gZnJvbSBMZWRnZXJDYWNoZSBzaW11bHRhbmVvdXNseQog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0UGFnZUV2aWN0aW9uV2hpbGVEZWxldGVMZWRnZXJJblByb2dy\nZXNzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBsZWRnZXJE\naXIxID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYmtUZXN0IiwgIi5kaXIiKTsK\nICAgICAgICBsZWRnZXJEaXIxLmRlbGV0ZSgpOwogICAgICAgIEZpbGUgbGVk\nZ2VyRGlyMiA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJrVGVzdCIsICIuZGly\nIik7CiAgICAgICAgbGVkZ2VyRGlyMi5kZWxldGUoKTsKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlv\nbigpOwogICAgICAgIGNvbmYuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmlu\nZ1tdIHsgbGVkZ2VyRGlyMS5nZXRBYnNvbHV0ZVBhdGgoKSwKICAgICAgICAg\nICAgICAgIGxlZGdlckRpcjIuZ2V0QWJzb2x1dGVQYXRoKCkgfSk7CiAgICAg\nICAgY29uZi5zZXRPcGVuRmlsZUxpbWl0KDEpOwogICAgICAgIEJvb2tpZSBi\nb29raWUgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgIEludGVybGVhdmVk\nTGVkZ2VyU3RvcmFnZSBsZWRnZXJTdG9yYWdlID0gKChJbnRlcmxlYXZlZExl\nZGdlclN0b3JhZ2UpIGJvb2tpZS5sZWRnZXJTdG9yYWdlKTsKICAgICAgICBm\naW5hbCBMZWRnZXJDYWNoZUltcGwgbGVkZ2VyQ2FjaGUgPSAoTGVkZ2VyQ2Fj\naGVJbXBsKSBsZWRnZXJTdG9yYWdlLmxlZGdlckNhY2hlOwogICAgICAgIC8v\nIENyZWF0ZSBsZWRnZXIgaW5kZXgKICAgICAgICBmaW5hbCBpbnQgbGVkZ2Vy\nQ291bnQgPSAyOwogICAgICAgIHB1dExlZGdlcihsZWRnZXJDYWNoZSwgbGVk\nZ2VyQ291bnQpOwogICAgICAgIGZvciAoaW50IGlkID0gMDsgaWQgPCBsZWRn\nZXJDb3VudDsgaWQrKykgewogICAgICAgICAgICBMT0cuaW5mbygiRGVsZXRp\nbmcgbGVkZ2VyIGlkIHt9IiwgaWQpOwogICAgICAgICAgICBsZWRnZXJDYWNo\nZS5kZWxldGVMZWRnZXIoaWQpOwogICAgICAgIH0KICAgICAgICAvLyBBZGRp\nbmcgbGVkZ2VycyBiYWNrIHRvIHRoZSBvcGVuTGVkZ2VycyBkYXRhIHN0cnVj\ndHVyZS4gVGhpcyBpcyBkb25lCiAgICAgICAgLy8gdG8gc2ltdWxhdGUgdGhl\nIGNhc2UgLSBkdXJpbmcgbGVkZ2VyIGV2aWN0aW9uIGl0IHdvdWxkIGJlIGRl\nbGV0ZWQKICAgICAgICAvLyBmcm9tIGZpbGVJbmZvQ2FjaGUgYW5kIGV4aXN0\ncyBvbmx5IGluIG9wZW5MZWRnZXJzIGxpc3QsIGFzIHRoZXNlIHR3bwogICAg\nICAgIC8vIGFyZSBub3QgYXRvbWljIG9wZXJhdGlvbnMKICAgICAgICBsZWRn\nZXJDYWNoZS5vcGVuTGVkZ2Vycy5hZGQoTG9uZy52YWx1ZU9mKDApKTsKICAg\nICAgICBsZWRnZXJDYWNoZS5vcGVuTGVkZ2Vycy5hZGQoTG9uZy52YWx1ZU9m\nKDEpKTsKICAgICAgICBmb3IgKGludCBpZCA9IDA7IGlkIDwgbGVkZ2VyQ291\nbnQ7IGlkKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIExPRy5pbmZvKCJSZWFkaW5nIGxlZGdlciBpZCB7fSIsIGlkKTsKICAgICAg\nICAgICAgICAgIGxlZGdlckNhY2hlLmdldEZpbGVJbmZvKExvbmcudmFsdWVP\nZihpZCksICJrZXkiLmdldEJ5dGVzKCkpOwogICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmluZm8oIkV4\nY2VwdGlvbiBvY2N1cmVkIHdoaWxlIGdldHRpbmcgdGhlIGxlZGdlciBpbmZv\nISIsIGUpOwogICAgICAgICAgICAgICAgQXNzZXJ0LmZhaWwoIkV4Y2VwdGlv\nbiBvY2N1cmVkIHdoaWxlIGdldHRpbmcgdGhlIGxlZGdlciBpZCAiCiAgICAg\nICAgICAgICAgICAgICAgICAgICsgaWQpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBwdXRMZWRnZXIoTGVkZ2Vy\nQ2FjaGVJbXBsIGxlZGdlckNhY2hlLCBpbnQgY291bnQpCiAgICAgICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChpbnQgaWQgPSAw\nOyBpZCA8IGNvdW50OyBpZCsrKSB7CiAgICAgICAgICAgIGxlZGdlckNhY2hl\nLmdldEZpbGVJbmZvKExvbmcudmFsdWVPZihpZCksICJrZXkiLmdldEJ5dGVz\nKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTMwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdFBhZ2VFdmljdGlvbigpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIGludCBudW1MZWRnZXJzID0gMTA7CiAgICAg\nICAgYnl0ZVtdIG1hc3RlcktleSA9ICJibGFoIi5nZXRCeXRlcygpOwogICAg\nICAgIC8vIGxpbWl0IHBhZ2UgY291bnQKICAgICAgICBjb25mLnNldE9wZW5G\naWxlTGltaXQoOTk5OTk5KS5zZXRQYWdlTGltaXQoMyk7CiAgICAgICAgLy8g\nY3JlYXRlIGxlZGdlciBjYWNoZQogICAgICAgIG5ld0xlZGdlckNhY2hlKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY3JlYXRlIHNlcnZlcmFs\nIGxlZGdlcnMKICAgICAgICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRn\nZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLnNldE1h\nc3RlcktleSgobG9uZylpLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAg\nbGVkZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoaSwgMCwgaSo4KTsKICAgICAg\nICAgICAgICAgIGxlZGdlckNhY2hlLnB1dEVudHJ5T2Zmc2V0KGksIDEsIGkq\nOCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGZsdXNoIGFsbCBm\naXJzdCB0byBjbGVhbiBwcmV2aW91cyBkaXJ0eSBsZWRnZXJzCiAgICAgICAg\nICAgIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2VyKHRydWUpOwogICAgICAgICAg\nICAvLyBmbHVzaCBhbGwgCiAgICAgICAgICAgIGxlZGdlckNhY2hlLmZsdXNo\nTGVkZ2VyKHRydWUpOwoKICAgICAgICAgICAgLy8gZGVsZXRlIHNlcnZlcmFs\nIGxlZGdlcnMKICAgICAgICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRn\nZXJzLzI7IGkrKykgewogICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuZGVs\nZXRlTGVkZ2VyKGkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBi\nb29raWUgcmVzdGFydHMKICAgICAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsK\nCiAgICAgICAgICAgIC8vIHNpbXVsYXRlIHJlcGxheWluZyBqb3VybmFscyB0\nbyBhZGQgZW50cmllcyBhZ2FpbgogICAgICAgICAgICBmb3IgKGludCBpPTE7\nIGk8PW51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNl\ndChpLCAxLCBpKjgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoTm9MZWRn\nZXJFeGNlcHRpb24gbnNsZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChp\nPD1udW1MZWRnZXJzLzIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\naXQgaXMgb2sKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHB1dCBlbnRyeSBv\nZmZzZXQgOiAiLCBuc2xlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmFp\nbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlLiIpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiR290IEV4Y2VwdGlvbi4iLCBlKTsKICAgICAgICAgICAgZmFpbCgiRmFp\nbGVkIHRvIGFkZCBlbnRyeS4iKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUZXN0IExlZGdlciBDYWNoZSBmbHVzaCBmYWlsdXJlCiAgICAg\nKi8KICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0TGVkZ2VyQ2FjaGVGbHVzaEZhaWx1cmVPbkRpc2tGdWxsKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBsZWRnZXJEaXIxID0gRmlsZS5j\ncmVhdGVUZW1wRmlsZSgiYmtUZXN0IiwgIi5kaXIiKTsKICAgICAgICBsZWRn\nZXJEaXIxLmRlbGV0ZSgpOwogICAgICAgIEZpbGUgbGVkZ2VyRGlyMiA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJrVGVzdCIsICIuZGlyIik7CiAgICAgICAg\nbGVkZ2VyRGlyMi5kZWxldGUoKTsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAg\nIGNvbmYuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2Vy\nRGlyMS5nZXRBYnNvbHV0ZVBhdGgoKSwgbGVkZ2VyRGlyMi5nZXRBYnNvbHV0\nZVBhdGgoKSB9KTsKCiAgICAgICAgQm9va2llIGJvb2tpZSA9IG5ldyBCb29r\naWUoY29uZik7CiAgICAgICAgSW50ZXJsZWF2ZWRMZWRnZXJTdG9yYWdlIGxl\nZGdlclN0b3JhZ2UgPSAoKEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZSkgYm9v\na2llLmxlZGdlclN0b3JhZ2UpOwogICAgICAgIExlZGdlckNhY2hlSW1wbCBs\nZWRnZXJDYWNoZSA9IChMZWRnZXJDYWNoZUltcGwpIGxlZGdlclN0b3JhZ2Uu\nbGVkZ2VyQ2FjaGU7CiAgICAgICAgLy8gQ3JlYXRlIGxlZGdlciBpbmRleCBm\naWxlCiAgICAgICAgbGVkZ2VyU3RvcmFnZS5zZXRNYXN0ZXJLZXkoMSwgImtl\neSIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIEZpbGVJbmZvIGZpbGVJbmZvID0g\nbGVkZ2VyQ2FjaGUuZ2V0RmlsZUluZm8oTG9uZy52YWx1ZU9mKDEpLCBudWxs\nKTsKCiAgICAgICAgLy8gU2ltdWxhdGUgdGhlIGZsdXNoIGZhaWx1cmUKICAg\nICAgICBGaWxlSW5mbyBuZXdGaWxlSW5mbyA9IG5ldyBGaWxlSW5mbyhmaWxl\nSW5mby5nZXRMZigpLCBmaWxlSW5mby5nZXRNYXN0ZXJLZXkoKSk7CiAgICAg\nICAgbGVkZ2VyQ2FjaGUuZmlsZUluZm9DYWNoZS5wdXQoTG9uZy52YWx1ZU9m\nKDEpLCBuZXdGaWxlSW5mbyk7CiAgICAgICAgLy8gQWRkIGVudHJpZXMKICAg\nICAgICBsZWRnZXJTdG9yYWdlLmFkZEVudHJ5KGdlbmVyYXRlRW50cnkoMSwg\nMSkpOwogICAgICAgIGxlZGdlclN0b3JhZ2UuYWRkRW50cnkoZ2VuZXJhdGVF\nbnRyeSgxLCAyKSk7CiAgICAgICAgbGVkZ2VyU3RvcmFnZS5mbHVzaCgpOwoK\nICAgICAgICBsZWRnZXJTdG9yYWdlLmFkZEVudHJ5KGdlbmVyYXRlRW50cnko\nMSwgMykpOwogICAgICAgIC8vIGFkZCB0aGUgZGlyIHRvIGZhaWxlZCBkaXJz\nCiAgICAgICAgYm9va2llLmdldExlZGdlckRpcnNNYW5hZ2VyKCkuYWRkVG9G\naWxsZWREaXJzKAogICAgICAgICAgICAgICAgbmV3RmlsZUluZm8uZ2V0TGYo\nKS5nZXRQYXJlbnRGaWxlKCkuZ2V0UGFyZW50RmlsZSgpLmdldFBhcmVudEZp\nbGUoKSk7CiAgICAgICAgRmlsZSBiZWZvcmUgPSBuZXdGaWxlSW5mby5nZXRM\nZigpOwogICAgICAgIC8vIGZsdXNoIGFmdGVyIGRpc2sgaXMgYWRkZWQgYXMg\nZmFpbGVkLgogICAgICAgIGxlZGdlclN0b3JhZ2UuZmx1c2goKTsKICAgICAg\nICBGaWxlIGFmdGVyID0gbmV3RmlsZUluZm8uZ2V0TGYoKTsKCiAgICAgICAg\nYXNzZXJ0RXF1YWxzKCJSZWZlcmVuY2UgY291bnRpbmcgZm9yIHRoZSBmaWxl\nIGluZm8gc2hvdWxkIGJlIHplcm8uIiwgMCwgbmV3RmlsZUluZm8uZ2V0VXNl\nQ291bnQoKSk7CgogICAgICAgIGFzc2VydEZhbHNlKCJBZnRlciBmbHVzaCBp\nbmRleCBmaWxlIHNob3VsZCBiZSBjaGFuZ2VkIiwgYmVmb3JlLmVxdWFscyhh\nZnRlcikpOwogICAgICAgIC8vIFZlcmlmeSB3cml0dGVuIGVudHJpZXMKICAg\nICAgICBBc3NlcnQuYXNzZXJ0QXJyYXlFcXVhbHMoZ2VuZXJhdGVFbnRyeSgx\nLCAxKS5hcnJheSgpLCBsZWRnZXJTdG9yYWdlLmdldEVudHJ5KDEsIDEpLmFy\ncmF5KCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRBcnJheUVxdWFscyhnZW5l\ncmF0ZUVudHJ5KDEsIDIpLmFycmF5KCksIGxlZGdlclN0b3JhZ2UuZ2V0RW50\ncnkoMSwgMikuYXJyYXkoKSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEFycmF5\nRXF1YWxzKGdlbmVyYXRlRW50cnkoMSwgMykuYXJyYXkoKSwgbGVkZ2VyU3Rv\ncmFnZS5nZXRFbnRyeSgxLCAzKS5hcnJheSgpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRlc3QgdGhhdCBpZiB3ZSBhcmUgd3JpdGluZyB0byBtb3JlIGxl\nZGdlcnMgdGhhbiB0aGVyZQogICAgICogYXJlIHBhZ2VzLCB0aGVuIHdlIHdp\nbGwgbm90IGZsdXNoIHRoZSBpbmRleCBiZWZvcmUgdGhlCiAgICAgKiBlbnRy\naWVzIGluIHRoZSBlbnRyeWxvZ2dlciBoYXZlIGJlZW4gcGVyc2lzdGVkIHRv\nIGRpc2suCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9y\nZy9qaXJhL2Jyb3dzZS9CT09LS0VFUEVSLTQ0N30KICAgICAqLwogICAgQFRl\nc3QodGltZW91dD0zMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RJbmRleFBh\nZ2VFdmljdGlvbldyaXRlT3JkZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBmaW5hbCBpbnQgbnVtTGVkZ2VycyA9IDEwOwogICAgICAgIEZpbGUg\nam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJq\nb3VybmFsIik7CiAgICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAg\nICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGly\nZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpv\ndXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNy\nZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVk\nZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwog\nICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUu\nZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRp\nb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAg\nICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGlyLmdldFBhdGgoKSkK\nICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7\nIGxlZGdlckRpci5nZXRQYXRoKCkgfSkKICAgICAgICAgICAgLnNldEZsdXNo\nSW50ZXJ2YWwoMTAwMCkKICAgICAgICAgICAgLnNldFBhZ2VMaW1pdCgxKTsK\nCiAgICAgICAgQm9va2llIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAg\nIGIuc3RhcnQoKTsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8PSBudW1M\nZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBwYWNrZXQg\nPSBnZW5lcmF0ZUVudHJ5KGksIDEpOwogICAgICAgICAgICBiLmFkZEVudHJ5\nKHBhY2tldCwgbmV3IEJvb2tpZS5Ob3BXcml0ZUNhbGxiYWNrKCksIG51bGws\nICJwYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgY29u\nZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNl\ndFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5h\nbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRn\nZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgp\nIH0pOwoKICAgICAgICBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICBm\nb3IgKGludCBpID0gMTsgaSA8PSBudW1MZWRnZXJzOyBpKyspIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGIucmVhZEVudHJ5KGksIDEp\nOwogICAgICAgICAgICB9IGNhdGNoIChCb29raWUuTm9MZWRnZXJFeGNlcHRp\nb24gbmxlKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGZpbmUsIG1l\nYW5zIHRoZSBsZWRnZXIgd2FzIG5ldmVyIHdyaXR0ZW4gdG8gdGhlIGluZGV4\nIGNhY2hlCiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoIk5vIGxlZGdl\nciBzaG91bGQgb25seSBoYXBwZW4gZm9yIHRoZSBsYXN0IGxlZGdlciIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaSwgbnVtTGVkZ2Vycyk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIG5l\nZSkgewogICAgICAgICAgICAgICAgLy8gdGhpcyBpcyBmaW5lLCBtZWFucyB0\naGUgbGVkZ2VyIHdhcyB3cml0dGVuIHRvIHRoZSBpbmRleCBjYWNoZSwgYnV0\nIG5vdAogICAgICAgICAgICAgICAgLy8gdGhlIGVudHJ5IGxvZwogICAgICAg\nICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAg\nICAgIExPRy5pbmZvKCJTaG91bGRuJ3QgaGF2ZSByZWNlaXZlZCBJT0V4Y2Vw\ndGlvbiIsIGlvZSk7CiAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3Qg\ndGhyb3cgSU9FeGNlcHRpb24sIHNob3VsZCBzYXkgdGhhdCBlbnRyeSBpcyBu\nb3QgZm91bmQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgog\nICAgLyoqCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9y\nZy9qaXJhL2Jyb3dzZS9CT09LS0VFUEVSLTUyNH0KICAgICAqIENoZWNrcyB0\naGF0IGdldExlZGdlckVudHJ5UGFnZSBkb2VzIG5vdCB0aHJvdyBhbiBOUEUg\naW4gdGhlCiAgICAgKiBjYXNlIGdldEZyb21UYWJsZSByZXR1cm5zIGEgbnVs\nbCBsZWRnZXIgZW50cnkgcGFnZSByZWZlcmVuY2UuCiAgICAgKiBUaGlzIE5Q\nRSBtaWdodCBraWxsIHRoZSBzeW5jIHRocmVhZCBsZWF2aW5nIGEgYm9va2ll\nIHdpdGggbm8KICAgICAqIHN5bmMgdGhyZWFkIHJ1bm5pbmcuCiAgICAgKgog\nICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAgICovCiAgICBAVGVzdCh0\naW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN5bmNUaHJlYWRO\nUEUoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIG5ld0xlZGdlckNh\nY2hlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgKChMZWRnZXJDYWNo\nZUltcGwpIGxlZGdlckNhY2hlKS5nZXRMZWRnZXJFbnRyeVBhZ2UoMEwsIDBM\nLCB0cnVlKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGVuIHRyeWluZyB0byBn\nZXQgYSBsZWRnZXIgZW50cnkgcGFnZSIsIGUpOwogICAgICAgICAgICBmYWls\nKCJTaG91bGRuJ3QgaGF2ZSB0aHJvd24gYW4gZXhjZXB0aW9uIik7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmFjZSB3aGVyZSBhIGZsdXNo\nIHdvdWxkIGZhaWwgYmVjYXVzZSBhIGdhcmJhZ2UgY29sbGVjdGlvbiBvY2N1\ncnJlZCBhdAogICAgICogdGhlIHdyb25nIHRpbWUuCiAgICAgKiB7QGxpbmsg\naHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9yZy9qaXJhL2Jyb3dzZS9CT09LS0VF\nUEVSLTYwNH0KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RGbHVzaERlbGV0ZVJhY2UoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBuZXdMZWRnZXJDYWNoZSgpOwogICAgICAgIGZp\nbmFsIEF0b21pY0ludGVnZXIgcmMgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsK\nICAgICAgICBmaW5hbCBMaW5rZWRCbG9ja2luZ1F1ZXVlPExvbmc+IGxlZGdl\nclEgPSBuZXcgTGlua2VkQmxvY2tpbmdRdWV1ZTxMb25nPigxKTsKICAgICAg\nICBmaW5hbCBieXRlW10gbWFzdGVyS2V5ID0gIm1hc3RlcktleSIuZ2V0Qnl0\nZXMoKTsKICAgICAgICBUaHJlYWQgbmV3TGVkZ2VyVGhyZWFkID0gbmV3IFRo\ncmVhZCgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDAgJiYgcmMuZ2V0KCkgPT0g\nMDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJD\nYWNoZS5zZXRNYXN0ZXJLZXkoaSwgbWFzdGVyS2V5KTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxlZGdlclEucHV0KChsb25nKWkpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmMu\nc2V0KC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJF\neGNlcHRpb24gaW4gbmV3IGxlZGdlciB0aHJlYWQiLCBlKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07\nCiAgICAgICAgbmV3TGVkZ2VyVGhyZWFkLnN0YXJ0KCk7CgogICAgICAgIFRo\ncmVhZCBmbHVzaFRocmVhZCA9IG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvbmcgaWQgPSBsZWRnZXJR\nLnBlZWsoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpZCA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiUHV0IGVudHJ5IGZvciB7\nfSIsIGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUucHV0\nRW50cnlPZmZzZXQoKGxvbmcpaWQsIDEsIDApOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoQm9va2llLk5vTGVkZ2VyRXhjZXB0aW9u\nIG5sZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vaWdu\nb3JlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5mbHVzaExlZGdlcih0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJjLnNldCgtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiRXhjZXB0aW9uIGluIGZsdXNoIHRocmVhZCIsIGUpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfTsKICAgICAgICBmbHVzaFRocmVhZC5zdGFydCgpOwoKICAgICAgICBU\naHJlYWQgZGVsZXRlVGhyZWFkID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZyBpZCA9IGxlZGdl\nclEudGFrZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIkRlbGV0aW5nIHt9IiwgaWQpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbGVkZ2VyQ2FjaGUuZGVsZXRlTGVkZ2VyKGlkKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJjLnNl\ndCgtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhj\nZXB0aW9uIGluIGRlbGV0ZSB0aHJlYWQiLCBlKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAg\nICAgZGVsZXRlVGhyZWFkLnN0YXJ0KCk7CgogICAgICAgIG5ld0xlZGdlclRo\ncmVhZC5qb2luKCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgaGF2\nZSBiZWVuIG5vIGVycm9ycyIsIHJjLmdldCgpLCAwKTsKCiAgICAgICAgZGVs\nZXRlVGhyZWFkLmludGVycnVwdCgpOwogICAgICAgIGZsdXNoVGhyZWFkLmlu\ndGVycnVwdCgpOwogICAgfQoKICAgIHByaXZhdGUgQnl0ZUJ1ZmZlciBnZW5l\ncmF0ZUVudHJ5KGxvbmcgbGVkZ2VyLCBsb25nIGVudHJ5KSB7CiAgICAgICAg\nYnl0ZVtdIGRhdGEgPSAoImxlZGdlci0iICsgbGVkZ2VyICsgIi0iICsgZW50\ncnkpLmdldEJ5dGVzKCk7CiAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVC\ndWZmZXIud3JhcChuZXcgYnl0ZVs4ICsgOCArIGRhdGEubGVuZ3RoXSk7CiAg\nICAgICAgYmIucHV0TG9uZyhsZWRnZXIpOwogICAgICAgIGJiLnB1dExvbmco\nZW50cnkpOwogICAgICAgIGJiLnB1dChkYXRhKTsKICAgICAgICBiYi5mbGlw\nKCk7CiAgICAgICAgcmV0dXJuIGJiOwogICAgfQp9Cg==\n","encoding":"base64"}

