{"sha":"f0432c18d43307f9075f69d0c2f11cafb1081100","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjA0MzJjMThkNDMzMDdmOTA3NWY2OWQwYzJmMTFjYWZiMTA4MTEwMA==","size":39007,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f0432c18d43307f9075f69d0c2f11cafb1081100","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRBZGRyZXNzOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkVudW1lcmF0aW9uOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uczsKaW1wb3J0IGphdmEudXRpbC5SYW5kb207CgppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVyOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0xvbmc7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnRlc3QuTXVsdGlMZWRnZXJNYW5hZ2VyTXVsdGlEaWdlc3RU\nZXN0Q2FzZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkNs\naWVudENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLm1ldGEuTVNMZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50\nZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxi\nYWNrcy5SZWFkRW50cnlDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5SZWNvdmVyQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVw\nZXIuRGlnZXN0VHlwZTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5qdW5pdC5B\nZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVu\naXQuVGVzdDsKCi8qKgogKiBUaGlzIGNsYXNzIHRlc3RzIHRoZSBib29raWUg\ncmVjb3ZlcnkgYWRtaW4gZnVuY3Rpb25hbGl0eS4KICovCnB1YmxpYyBjbGFz\ncyBCb29raWVSZWNvdmVyeVRlc3QgZXh0ZW5kcyBNdWx0aUxlZGdlck1hbmFn\nZXJNdWx0aURpZ2VzdFRlc3RDYXNlIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9H\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va2llUmVjb3ZlcnlUZXN0\nLmNsYXNzKTsKCiAgICAvLyBPYmplY3QgdXNlZCBmb3Igc3luY2hyb25pemlu\nZyBhc3luYyBtZXRob2QgY2FsbHMKICAgIGNsYXNzIFN5bmNPYmplY3Qgewog\nICAgICAgIGJvb2xlYW4gdmFsdWU7CgogICAgICAgIHB1YmxpYyBTeW5jT2Jq\nZWN0KCkgewogICAgICAgICAgICB2YWx1ZSA9IGZhbHNlOwogICAgICAgIH0K\nICAgIH0KCiAgICAvLyBPYmplY3QgdXNlZCBmb3IgaW1wbGVtZW50aW5nIHRo\nZSBCb29raWUgUmVjb3ZlckNhbGxiYWNrIGZvciB0aGlzIGpVbml0CiAgICAv\nLyB0ZXN0LiBUaGlzIHZlcmlmaWVzIHRoYXQgdGhlIG9wZXJhdGlvbiBjb21w\nbGV0ZWQgc3VjY2Vzc2Z1bGx5LgogICAgY2xhc3MgQm9va2llUmVjb3ZlckNh\nbGxiYWNrIGltcGxlbWVudHMgUmVjb3ZlckNhbGxiYWNrIHsKICAgICAgICBi\nb29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgdm9pZCByZWNvdmVyQ29tcGxldGUoaW50IHJjLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgIExPRy5pbmZvKCJSZWNvdmVyZWQgYm9v\na2llIG9wZXJhdGlvbiBjb21wbGV0ZWQgd2l0aCByYzogIiArIHJjKTsKICAg\nICAgICAgICAgc3VjY2VzcyA9IHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0s7\nCiAgICAgICAgICAgIFN5bmNPYmplY3Qgc3luYyA9IChTeW5jT2JqZWN0KSBj\ndHg7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAg\nICAgICAgICAgc3luYy52YWx1ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBz\neW5jLm5vdGlmeSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8vIE9iamVjdHMgdG8gdXNlIGZvciB0aGlzIGpVbml0IHRlc3QuCiAg\nICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGU7CiAgICBTdHJpbmcgbGVkZ2VyTWFu\nYWdlckZhY3Rvcnk7CiAgICBTeW5jT2JqZWN0IHN5bmM7CiAgICBCb29raWVS\nZWNvdmVyQ2FsbGJhY2sgYm9va2llUmVjb3ZlckNiOwogICAgQm9va0tlZXBl\nckFkbWluIGJrQWRtaW47CgogICAgLy8gQ29uc3RydWN0b3IKICAgIHB1Ymxp\nYyBCb29raWVSZWNvdmVyeVRlc3QoU3RyaW5nIGxlZGdlck1hbmFnZXJGYWN0\nb3J5LCBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHsKICAgICAgICBzdXBlcigz\nKTsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBkaWdlc3RUeXBlOwogICAg\nICAgIHRoaXMubGVkZ2VyTWFuYWdlckZhY3RvcnkgPSBsZWRnZXJNYW5hZ2Vy\nRmFjdG9yeTsKICAgICAgICBMT0cuaW5mbygiVXNpbmcgbGVkZ2VyIG1hbmFn\nZXIgIiArIGxlZGdlck1hbmFnZXJGYWN0b3J5KTsKICAgICAgICAvLyBzZXQg\nbGVkZ2VyIG1hbmFnZXIKICAgICAgICBiYXNlQ29uZi5zZXRMZWRnZXJNYW5h\nZ2VyRmFjdG9yeUNsYXNzTmFtZShsZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAg\nICAgICAgYmFzZUNsaWVudENvbmYuc2V0TGVkZ2VyTWFuYWdlckZhY3RvcnlD\nbGFzc05hbWUobGVkZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgfQoKICAgIEBC\nZWZvcmUKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBTZXQgdXAgdGhlIGNvbmZp\nZ3VyYXRpb24gcHJvcGVydGllcyBuZWVkZWQuCiAgICAgICAgYmFzZUNsaWVu\ndENvbmYuc2V0Qm9va2llUmVjb3ZlcnlEaWdlc3RUeXBlKGRpZ2VzdFR5cGUp\nOwogICAgICAgIGJhc2VDbGllbnRDb25mLnNldEJvb2tpZVJlY292ZXJ5UGFz\nc3dkKCIiLmdldEJ5dGVzKCkpOwogICAgICAgIHN1cGVyLnNldFVwKCk7Cgog\nICAgICAgIHN5bmMgPSBuZXcgU3luY09iamVjdCgpOwogICAgICAgIGJvb2tp\nZVJlY292ZXJDYiA9IG5ldyBCb29raWVSZWNvdmVyQ2FsbGJhY2soKTsKICAg\nICAgICBDbGllbnRDb25maWd1cmF0aW9uIGFkbWluQ29uZiA9IG5ldyBDbGll\nbnRDb25maWd1cmF0aW9uKGJhc2VDbGllbnRDb25mKTsKICAgICAgICBhZG1p\nbkNvbmYuc2V0WmtTZXJ2ZXJzKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0\nU3RyaW5nKCkpOwogICAgICAgIGJrQWRtaW4gPSBuZXcgQm9va0tlZXBlckFk\nbWluKGFkbWluQ29uZik7CiAgICB9CgogICAgQEFmdGVyCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gUmVsZWFzZSBhbnkgcmVzb3VyY2VzIHVzZWQgYnkg\ndGhlIEJvb2tLZWVwZXJUb29scyBpbnN0YW5jZS4KICAgICAgICBpZihia0Fk\nbWluICE9IG51bGwpewogICAgICAgICAgICBia0FkbWluLmNsb3NlKCk7CiAg\nICAgICAgfQogICAgICAgIHN1cGVyLnRlYXJEb3duKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGNyZWF0ZSBhIG51bWJlciBv\nZiBsZWRnZXJzCiAgICAgKgogICAgICogQHBhcmFtIG51bUxlZGdlcnMKICAg\nICAqICAgICAgICAgICAgTnVtYmVyIG9mIGxlZGdlcnMgdG8gY3JlYXRlCiAg\nICAgKiBAcmV0dXJuIExpc3Qgb2YgTGVkZ2VySGFuZGxlcyBmb3IgZWFjaCBv\nZiB0aGUgbGVkZ2VycyBjcmVhdGVkCiAgICAgKi8KICAgIHByaXZhdGUgTGlz\ndDxMZWRnZXJIYW5kbGU+IGNyZWF0ZUxlZGdlcnMoaW50IG51bUxlZGdlcnMp\nCiAgICAgICAgICAgIHRocm93cyBCS0V4Y2VwdGlvbiwgSU9FeGNlcHRpb24s\nIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICB7CiAgICAgICAgcmV0dXJuIGNy\nZWF0ZUxlZGdlcnMobnVtTGVkZ2VycywgMywgMik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGNyZWF0ZSBhIG51bWJlciBvZiBs\nZWRnZXJzCiAgICAgKgogICAgICogQHBhcmFtIG51bUxlZGdlcnMKICAgICAq\nICAgICAgICAgICAgTnVtYmVyIG9mIGxlZGdlcnMgdG8gY3JlYXRlCiAgICAg\nKiBAcGFyYW0gZW5zZW1ibGUgRW5zZW1ibGUgc2l6ZSBmb3IgbGVkZ2Vycwog\nICAgICogQHBhcmFtIHF1b3J1bSBRdW9ydW0gc2l6ZSBmb3IgbGVkZ2Vycwog\nICAgICogQHJldHVybiBMaXN0IG9mIExlZGdlckhhbmRsZXMgZm9yIGVhY2gg\nb2YgdGhlIGxlZGdlcnMgY3JlYXRlZAogICAgICovCiAgICBwcml2YXRlIExp\nc3Q8TGVkZ2VySGFuZGxlPiBjcmVhdGVMZWRnZXJzKGludCBudW1MZWRnZXJz\nLCBpbnQgZW5zZW1ibGUsIGludCBxdW9ydW0pCiAgICAgICAgICAgIHRocm93\ncyBCS0V4Y2VwdGlvbiwgSU9FeGNlcHRpb24sCiAgICAgICAgSW50ZXJydXB0\nZWRFeGNlcHRpb24gewogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMg\nPSBuZXcgQXJyYXlMaXN0PExlZGdlckhhbmRsZT4oKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAg\nICBsaHMuYWRkKGJrYy5jcmVhdGVMZWRnZXIoZW5zZW1ibGUsIHF1b3J1bSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2VzdFR5\ncGUsIGJhc2VDbGllbnRDb25mLmdldEJvb2tpZVJlY292ZXJ5UGFzc3dkKCkp\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxoczsKICAgIH0KCiAgICBw\ncml2YXRlIExpc3Q8TGVkZ2VySGFuZGxlPiBvcGVuTGVkZ2VycyhMaXN0PExl\nZGdlckhhbmRsZT4gb2xkTGhzKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbmV3TGhzID0gbmV3\nIEFycmF5TGlzdDxMZWRnZXJIYW5kbGU+KCk7CiAgICAgICAgZm9yIChMZWRn\nZXJIYW5kbGUgb2xkTGggOiBvbGRMaHMpIHsKICAgICAgICAgICAgbmV3TGhz\nLmFkZChia2Mub3BlbkxlZGdlcihvbGRMaC5nZXRJZCgpLCBkaWdlc3RUeXBl\nLCBiYXNlQ2xpZW50Q29uZi5nZXRCb29raWVSZWNvdmVyeVBhc3N3ZCgpKSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXdMaHM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHdyaXRlIGR1bW15IGxlZGdl\nciBlbnRyaWVzIHRvIGFsbCBvZiB0aGUgbGVkZ2VycyBwYXNzZWQuCiAgICAg\nKgogICAgICogQHBhcmFtIG51bUVudHJpZXMKICAgICAqICAgICAgICAgICAg\nTnVtYmVyIG9mIGxlZGdlciBlbnRyaWVzIHRvIHdyaXRlIGZvciBlYWNoIGxl\nZGdlcgogICAgICogQHBhcmFtIHN0YXJ0RW50cnlJZAogICAgICogICAgICAg\nICAgICBUaGUgZmlyc3QgZW50cnkgSWQgd2UncmUgZXhwZWN0aW5nIHRvIHdy\naXRlIGZvciBlYWNoIGxlZGdlcgogICAgICogQHBhcmFtIGxocwogICAgICog\nICAgICAgICAgICBMaXN0IG9mIExlZGdlckhhbmRsZXMgZm9yIGFsbCBsZWRn\nZXJzIHRvIHdyaXRlIGVudHJpZXMgdG8KICAgICAqIEB0aHJvd3MgQktFeGNl\ncHRpb24KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlRW50cmllc3RvTGVkZ2Vycyhp\nbnQgbnVtRW50cmllcywgbG9uZyBzdGFydEVudHJ5SWQsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8TGVkZ2VySGFuZGxl\nPiBsaHMpCiAgICAgICAgdGhyb3dzIEJLRXhjZXB0aW9uLCBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBs\naHMpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRy\naWVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KCgiTGVk\nZ2VySWQ6ICIgKyBsaC5nZXRJZCgpICsgIiwgRW50cnlJZDogIiArIChzdGFy\ndEVudHJ5SWQgKyBpKSkuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNsb3NlTGVkZ2VycyhM\naXN0PExlZGdlckhhbmRsZT4gbGhzKSB0aHJvd3MgQktFeGNlcHRpb24sIElu\ndGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBmb3IgKExlZGdlckhhbmRs\nZSBsaCA6IGxocykgewogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gdmVy\naWZ5IHRoYXQgd2UgY2FuIHJlYWQgdGhlIHJlY292ZXJlZCBsZWRnZXIgZW50\ncmllcy4KICAgICAqCiAgICAgKiBAcGFyYW0gb2xkTGhzCiAgICAgKiAgICAg\nICAgICAgIE9sZCBMZWRnZXIgSGFuZGxlcwogICAgICogQHBhcmFtIHN0YXJ0\nRW50cnlJZAogICAgICogICAgICAgICAgICBTdGFydCBFbnRyeSBJZCB0byBy\nZWFkCiAgICAgKiBAcGFyYW0gZW5kRW50cnlJZAogICAgICogICAgICAgICAg\nICBFbmQgRW50cnkgSWQgdG8gcmVhZAogICAgICogQHRocm93cyBCS0V4Y2Vw\ndGlvbgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhM\naXN0PExlZGdlckhhbmRsZT4gb2xkTGhzLCBsb25nIHN0YXJ0RW50cnlJZCwg\nbG9uZyBlbmRFbnRyeUlkKSB0aHJvd3MgQktFeGNlcHRpb24sCiAgICAgICAg\nSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIC8vIEdldCBhIHNldCBv\nZiBMZWRnZXJIYW5kbGVzIGZvciBhbGwgb2YgdGhlIGxlZGdlcnMgdG8gdmVy\naWZ5CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9IG5ldyBBcnJh\neUxpc3Q8TGVkZ2VySGFuZGxlPigpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgb2xkTGhzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIGxocy5h\nZGQoYmtjLm9wZW5MZWRnZXIob2xkTGhzLmdldChpKS5nZXRJZCgpLCBkaWdl\nc3RUeXBlLCBiYXNlQ2xpZW50Q29uZi5nZXRCb29raWVSZWNvdmVyeVBhc3N3\nZCgpKSk7CiAgICAgICAgfQogICAgICAgIC8vIFJlYWQgdGhlIGxlZGdlciBl\nbnRyaWVzIHRvIHZlcmlmeSB0aGF0IHRoZXkgYXJlIGFsbCBwcmVzZW50IGFu\nZAogICAgICAgIC8vIGNvcnJlY3QgaW4gdGhlIG5ldyBib29raWUuCiAgICAg\nICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMpIHsKICAgICAgICAgICAg\nRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGVudHJpZXMgPSBsaC5yZWFkRW50\ncmllcyhzdGFydEVudHJ5SWQsIGVuZEVudHJ5SWQpOwogICAgICAgICAgICB3\naGlsZSAoZW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAg\nICAgICAgTGVkZ2VyRW50cnkgZW50cnkgPSBlbnRyaWVzLm5leHRFbGVtZW50\nKCk7CiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKG5ldyBTdHJpbmcoZW50\ncnkuZ2V0RW50cnkoKSkuZXF1YWxzKCJMZWRnZXJJZDogIiArIGVudHJ5Lmdl\ndExlZGdlcklkKCkgKyAiLCBFbnRyeUlkOiAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgZW50cnkuZ2V0RW50cnlJZCgpKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgfQoKICAgIC8qKgogICAgICogVGhpcyB0ZXN0\ncyB0aGUgYm9va2llIHJlY292ZXJ5IGZ1bmN0aW9uYWxpdHkgd2l0aCBlbnNl\nbWJsZSBjaGFuZ2VzLgogICAgICogV2UnbGwgdmVyaWZ5IHRoYXQ6CiAgICAg\nKiAtIGJvb2tpZSByZWNvdmVyeSBzaG91bGQgbm90IGFmZmVjdCBlbnNlbWJs\nZSBjaGFuZ2UuCiAgICAgKiAtIGVuc2VtYmxlIGNoYW5nZSBzaG91bGQgbm90\nIGVyYXNlIGNoYW5nZXMgbWFkZSBieSByZWNvdmVyeS4KICAgICAqCiAgICAg\nKiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9yZy9qaXJhL2Jyb3dz\nZS9CT09LS0VFUEVSLTY2N30KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9\nIDYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE1ldGFkYXRhQ29uZmxpY3RX\naXRoUmVjb3ZlcnkoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQg\nbnVtRW50cmllcyA9IDEwOwogICAgICAgIGJ5dGVbXSBkYXRhID0gInRlc3RN\nZXRhZGF0YUNvbmZsaWN0V2l0aFJlY292ZXJ5Ii5nZXRCeXRlcygpOwoKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDIsIDIs\nIGRpZ2VzdFR5cGUsIGJhc2VDbGllbnRDb25mLmdldEJvb2tpZVJlY292ZXJ5\nUGFzc3dkKCkpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50\ncmllczsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwog\nICAgICAgIH0KICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVUb0tp\nbGwgPSBsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlKG51bUVu\ndHJpZXMgLSAxKS5nZXQoMSk7CiAgICAgICAga2lsbEJvb2tpZShib29raWVU\nb0tpbGwpOwogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAg\nICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIGJrQWRt\naW4ucmVjb3ZlckJvb2tpZURhdGEoYm9va2llVG9LaWxsLCBudWxsKTsKICAg\nICAgICAvLyBmYWlsIGFub3RoZXIgYm9va2llIHRvIGNhdXNlIGVuc2VtYmxl\nIGNoYW5nZSBhZ2FpbgogICAgICAgIGJvb2tpZVRvS2lsbCA9IGxoLmdldExl\nZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGUoMiAqIG51bUVudHJpZXMgLSAx\nKS5nZXQoMSk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mT2ZL\naWxsZWRCb29raWUgPSBraWxsQm9va2llKGJvb2tpZVRvS2lsbCk7CiAgICAg\nICAgc3RhcnROZXdCb29raWUoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRy\neShkYXRhKTsKICAgICAgICB9CiAgICAgICAgLy8gc3RhcnQgdGhlIGtpbGxl\nZCBib29raWUgYWdhaW4KICAgICAgICBic0NvbmZzLmFkZChjb25mT2ZLaWxs\nZWRCb29raWUpOwogICAgICAgIGJzLmFkZChzdGFydEJvb2tpZShjb25mT2ZL\naWxsZWRCb29raWUpKTsKICAgICAgICAvLyBhbGwgZW5zZW1ibGVzIHNob3Vs\nZCBiZSBmdWxseSByZXBsaWNhdGVkIHNpbmNlIGl0IGlzIHJlY292ZXJlZAog\nICAgICAgIGFzc2VydFRydWUoIk5vdCBmdWxseSByZXBsaWNhdGVkIiwgdmVy\naWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCAzICogbnVtRW50cmllcykpOwogICAg\nICAgIGxoLmNsb3NlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIHRl\nc3RzIHRoZSBhc3luY2hyb25vdXMgYm9va2llIHJlY292ZXJ5IGZ1bmN0aW9u\nYWxpdHkgYnkgd3JpdGluZwogICAgICogZW50cmllcyBpbnRvIDMgYm9va2ll\ncywga2lsbGluZyBvbmUgYm9va2llLCBzdGFydGluZyB1cCBhIG5ldyBvbmUg\ndG8KICAgICAqIHJlcGxhY2UgaXQsIGFuZCB0aGVuIHJlY292ZXJpbmcgdGhl\nIGxlZGdlciBlbnRyaWVzIGZyb20gdGhlIGtpbGxlZCBib29raWUKICAgICAq\nIG9udG8gdGhlIG5ldyBvbmUuIFdlJ2xsIHZlcmlmeSB0aGF0IHRoZSBlbnRy\naWVzIHN0b3JlZCBvbiB0aGUga2lsbGVkCiAgICAgKiBib29raWUgYXJlIHBy\nb3Blcmx5IGNvcGllZCBvdmVyIGFuZCByZXN0b3JlZCBvbnRvIHRoZSBuZXcg\nb25lLgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nQXN5bmNCb29raWVSZWNvdmVyeVRvU3BlY2lmaWNCb29raWUoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAg\nICAgICBpbnQgbnVtTGVkZ2VycyA9IDM7CiAgICAgICAgTGlzdDxMZWRnZXJI\nYW5kbGU+IGxocyA9IGNyZWF0ZUxlZGdlcnMobnVtTGVkZ2Vycyk7CgogICAg\nICAgIC8vIFdyaXRlIHRoZSBlbnRyaWVzIGZvciB0aGUgbGVkZ2VycyB3aXRo\nIGR1bW15IHZhbHVlcy4KICAgICAgICBpbnQgbnVtTXNncyA9IDEwOwogICAg\nICAgIHdyaXRlRW50cmllc3RvTGVkZ2VycyhudW1Nc2dzLCAwLCBsaHMpOwoK\nICAgICAgICAvLyBTaHV0ZG93biB0aGUgZmlyc3QgYm9va2llIHNlcnZlcgog\nICAgICAgIExPRy5pbmZvKCJGaW5pc2hlZCB3cml0aW5nIGFsbCBsZWRnZXIg\nZW50cmllcyBzbyBzaHV0ZG93biBvbmUgb2YgdGhlIGJvb2tpZXMuIik7CiAg\nICAgICAgaW50IGluaXRpYWxQb3J0ID0gYnNDb25mcy5nZXQoMCkuZ2V0Qm9v\na2llUG9ydCgpOwogICAgICAgIGJzLmdldCgwKS5zaHV0ZG93bigpOwogICAg\nICAgIGJzLnJlbW92ZSgwKTsKCiAgICAgICAgLy8gU3RhcnR1cCBhIG5ldyBi\nb29raWUgc2VydmVyCiAgICAgICAgaW50IG5ld0Jvb2tpZVBvcnQgPSBzdGFy\ndE5ld0Jvb2tpZSgpOwoKICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50\ncmllcyBmb3IgdGhlIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBi\nZQogICAgICAgIC8vIGNyZWF0ZWQgZm9yIHRoZW0uCiAgICAgICAgd3JpdGVF\nbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDEwLCBsaHMpOwoKICAgICAgICAv\nLyBDYWxsIHRoZSBhc3luYyByZWNvdmVyIGJvb2tpZSBtZXRob2QuCiAgICAg\nICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llU3JjID0gbmV3IEluZXRTb2Nr\nZXRBZGRyZXNzKEluZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RB\nZGRyZXNzKCksIGluaXRpYWxQb3J0KTsKICAgICAgICBJbmV0U29ja2V0QWRk\ncmVzcyBib29raWVEZXN0ID0gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRB\nZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIG5ld0Jv\nb2tpZVBvcnQpOwogICAgICAgIExPRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUg\nZGF0YSBvbiB0aGUga2lsbGVkIGJvb2tpZSAoIiArIGJvb2tpZVNyYyArICIp\nIGFuZCByZXBsaWNhdGUgaXQgdG8gdGhlIG5ldyBvbmUgKCIKICAgICAgICAg\nICAgICAgICArIGJvb2tpZURlc3QgKyAiKSIpOwogICAgICAgIC8vIEluaXRp\nYXRlIHRoZSBzeW5jIG9iamVjdAogICAgICAgIHN5bmMudmFsdWUgPSBmYWxz\nZTsKICAgICAgICBia0FkbWluLmFzeW5jUmVjb3ZlckJvb2tpZURhdGEoYm9v\na2llU3JjLCBib29raWVEZXN0LCBib29raWVSZWNvdmVyQ2IsIHN5bmMpOwoK\nICAgICAgICAvLyBXYWl0IGZvciB0aGUgYXN5bmMgbWV0aG9kIHRvIGNvbXBs\nZXRlLgogICAgICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAgICAg\nICB3aGlsZSAoc3luYy52YWx1ZSA9PSBmYWxzZSkgewogICAgICAgICAgICAg\nICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZShib29raWVSZWNvdmVyQ2Iuc3VjY2Vzcyk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBWZXJpZnkgdGhlIHJlY292ZXJlZCBsZWRnZXIgZW50cmll\ncyBhcmUgb2theS4KICAgICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxo\ncywgMCwgMiAqIG51bU1zZ3MgLSAxKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoaXMgdGVzdHMgdGhlIGFzeW5jaHJvbm91cyBib29raWUgcmVjb3Zlcnkg\nZnVuY3Rpb25hbGl0eSBieSB3cml0aW5nCiAgICAgKiBlbnRyaWVzIGludG8g\nMyBib29raWVzLCBraWxsaW5nIG9uZSBib29raWUsIHN0YXJ0aW5nIHVwIGEg\nZmV3IG5ldwogICAgICogYm9va2llcywgYW5kIHRoZW4gcmVjb3ZlcmluZyB0\naGUgbGVkZ2VyIGVudHJpZXMgZnJvbSB0aGUga2lsbGVkIGJvb2tpZQogICAg\nICogb250byByYW5kb20gYXZhaWxhYmxlIGJvb2tpZSBzZXJ2ZXJzLiBXZSds\nbCB2ZXJpZnkgdGhhdCB0aGUgZW50cmllcwogICAgICogc3RvcmVkIG9uIHRo\nZSBraWxsZWQgYm9va2llIGFyZSBwcm9wZXJseSBjb3BpZWQgb3ZlciBhbmQg\ncmVzdG9yZWQgb250bwogICAgICogdGhlIG90aGVyIGJvb2tpZXMuCiAgICAg\nKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RBc3luY0Jvb2tp\nZVJlY292ZXJ5VG9SYW5kb21Cb29raWVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAgICAgaW50IG51\nbUxlZGdlcnMgPSAzOwogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMg\nPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMpOwoKICAgICAgICAvLyBXcml0\nZSB0aGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1\nZXMuCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0ZUVu\ndHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgLy8g\nU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBMT0cu\naW5mbygiRmluaXNoZWQgd3JpdGluZyBhbGwgbGVkZ2VyIGVudHJpZXMgc28g\nc2h1dGRvd24gb25lIG9mIHRoZSBib29raWVzLiIpOwogICAgICAgIGludCBp\nbml0aWFsUG9ydCA9IGJzQ29uZnMuZ2V0KDApLmdldEJvb2tpZVBvcnQoKTsK\nICAgICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1v\ndmUoMCk7CgogICAgICAgIC8vIFN0YXJ0dXAgdGhyZWUgbmV3IGJvb2tpZSBz\nZXJ2ZXJzCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAzOyBpKyspIHsK\nICAgICAgICAgICAgc3RhcnROZXdCb29raWUoKTsKICAgICAgICB9CgogICAg\nICAgIC8vIFdyaXRlIHNvbWUgbW9yZSBlbnRyaWVzIGZvciB0aGUgbGVkZ2Vy\ncyBzbyBhIG5ldyBlbnNlbWJsZSB3aWxsIGJlCiAgICAgICAgLy8gY3JlYXRl\nZCBmb3IgdGhlbS4KICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVt\nTXNncywgMTAsIGxocyk7CgogICAgICAgIC8vIENhbGwgdGhlIGFzeW5jIHJl\nY292ZXIgYm9va2llIG1ldGhvZC4KICAgICAgICBJbmV0U29ja2V0QWRkcmVz\ncyBib29raWVTcmMgPSBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFkZHJl\nc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgaW5pdGlhbFBv\ncnQpOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZURlc3QgPSBu\ndWxsOwogICAgICAgIExPRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUgZGF0YSBv\nbiB0aGUga2lsbGVkIGJvb2tpZSAoIiArIGJvb2tpZVNyYwogICAgICAgICAg\nICAgICAgICsgIikgYW5kIHJlcGxpY2F0ZSBpdCB0byBhIHJhbmRvbSBhdmFp\nbGFibGUgb25lIik7CiAgICAgICAgLy8gSW5pdGlhdGUgdGhlIHN5bmMgb2Jq\nZWN0CiAgICAgICAgc3luYy52YWx1ZSA9IGZhbHNlOwogICAgICAgIGJrQWRt\naW4uYXN5bmNSZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIGJvb2tpZURl\nc3QsIGJvb2tpZVJlY292ZXJDYiwgc3luYyk7CgogICAgICAgIC8vIFdhaXQg\nZm9yIHRoZSBhc3luYyBtZXRob2QgdG8gY29tcGxldGUuCiAgICAgICAgc3lu\nY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgIHdoaWxlIChzeW5jLnZh\nbHVlID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICBzeW5jLndhaXQoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBhc3NlcnRUcnVlKGJvb2tpZVJl\nY292ZXJDYi5zdWNjZXNzKTsKICAgICAgICB9CgogICAgICAgIC8vIFZlcmlm\neSB0aGUgcmVjb3ZlcmVkIGxlZGdlciBlbnRyaWVzIGFyZSBva2F5LgogICAg\nICAgIHZlcmlmeVJlY292ZXJlZExlZGdlcnMobGhzLCAwLCAyICogbnVtTXNn\ncyAtIDEpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyB0ZXN0cyB0aGUg\nc3luY2hyb25vdXMgYm9va2llIHJlY292ZXJ5IGZ1bmN0aW9uYWxpdHkgYnkg\nd3JpdGluZwogICAgICogZW50cmllcyBpbnRvIDMgYm9va2llcywga2lsbGlu\nZyBvbmUgYm9va2llLCBzdGFydGluZyB1cCBhIG5ldyBvbmUgdG8KICAgICAq\nIHJlcGxhY2UgaXQsIGFuZCB0aGVuIHJlY292ZXJpbmcgdGhlIGxlZGdlciBl\nbnRyaWVzIGZyb20gdGhlIGtpbGxlZCBib29raWUKICAgICAqIG9udG8gdGhl\nIG5ldyBvbmUuIFdlJ2xsIHZlcmlmeSB0aGF0IHRoZSBlbnRyaWVzIHN0b3Jl\nZCBvbiB0aGUga2lsbGVkCiAgICAgKiBib29raWUgYXJlIHByb3Blcmx5IGNv\ncGllZCBvdmVyIGFuZCByZXN0b3JlZCBvbnRvIHRoZSBuZXcgb25lLgogICAg\nICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0\nKHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY0Jvb2tp\nZVJlY292ZXJ5VG9TcGVjaWZpY0Jvb2tpZSgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIC8vIENyZWF0ZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBu\ndW1MZWRnZXJzID0gMzsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhz\nID0gY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJzKTsKCiAgICAgICAgLy8gV3Jp\ndGUgdGhlIGVudHJpZXMgZm9yIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFs\ndWVzLgogICAgICAgIGludCBudW1Nc2dzID0gMTA7CiAgICAgICAgd3JpdGVF\nbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDAsIGxocyk7CgogICAgICAgIC8v\nIFNodXRkb3duIHRoZSBmaXJzdCBib29raWUgc2VydmVyCiAgICAgICAgTE9H\nLmluZm8oIkZpbmlzaGVkIHdyaXRpbmcgYWxsIGxlZGdlciBlbnRyaWVzIHNv\nIHNodXRkb3duIG9uZSBvZiB0aGUgYm9va2llcy4iKTsKICAgICAgICBpbnQg\naW5pdGlhbFBvcnQgPSBic0NvbmZzLmdldCgwKS5nZXRCb29raWVQb3J0KCk7\nCiAgICAgICAgYnMuZ2V0KDApLnNodXRkb3duKCk7CiAgICAgICAgYnMucmVt\nb3ZlKDApOwoKICAgICAgICAvLyBTdGFydHVwIGEgbmV3IGJvb2tpZSBzZXJ2\nZXIKICAgICAgICBpbnQgbmV3Qm9va2llUG9ydCA9IHN0YXJ0TmV3Qm9va2ll\nKCk7CgogICAgICAgIC8vIFdyaXRlIHNvbWUgbW9yZSBlbnRyaWVzIGZvciB0\naGUgbGVkZ2VycyBzbyBhIG5ldyBlbnNlbWJsZSB3aWxsIGJlCiAgICAgICAg\nLy8gY3JlYXRlZCBmb3IgdGhlbS4KICAgICAgICB3cml0ZUVudHJpZXN0b0xl\nZGdlcnMobnVtTXNncywgMTAsIGxocyk7CgogICAgICAgIC8vIENhbGwgdGhl\nIHN5bmMgcmVjb3ZlciBib29raWUgbWV0aG9kLgogICAgICAgIEluZXRTb2Nr\nZXRBZGRyZXNzIGJvb2tpZVNyYyA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcyhJ\nbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBp\nbml0aWFsUG9ydCk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2ll\nRGVzdCA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcy5nZXRM\nb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBuZXdCb29raWVQb3J0KTsK\nICAgICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhl\nIGtpbGxlZCBib29raWUgKCIgKyBib29raWVTcmMgKyAiKSBhbmQgcmVwbGlj\nYXRlIGl0IHRvIHRoZSBuZXcgb25lICgiCiAgICAgICAgICAgICAgICAgKyBi\nb29raWVEZXN0ICsgIikiKTsKICAgICAgICBia0FkbWluLnJlY292ZXJCb29r\naWVEYXRhKGJvb2tpZVNyYywgYm9va2llRGVzdCk7CgogICAgICAgIC8vIFZl\ncmlmeSB0aGUgcmVjb3ZlcmVkIGxlZGdlciBlbnRyaWVzIGFyZSBva2F5Lgog\nICAgICAgIHZlcmlmeVJlY292ZXJlZExlZGdlcnMobGhzLCAwLCAyICogbnVt\nTXNncyAtIDEpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyB0ZXN0cyB0\naGUgc3luY2hyb25vdXMgYm9va2llIHJlY292ZXJ5IGZ1bmN0aW9uYWxpdHkg\nYnkgd3JpdGluZwogICAgICogZW50cmllcyBpbnRvIDMgYm9va2llcywga2ls\nbGluZyBvbmUgYm9va2llLCBzdGFydGluZyB1cCBhIGZldyBuZXcKICAgICAq\nIGJvb2tpZXMsIGFuZCB0aGVuIHJlY292ZXJpbmcgdGhlIGxlZGdlciBlbnRy\naWVzIGZyb20gdGhlIGtpbGxlZCBib29raWUKICAgICAqIG9udG8gcmFuZG9t\nIGF2YWlsYWJsZSBib29raWUgc2VydmVycy4gV2UnbGwgdmVyaWZ5IHRoYXQg\ndGhlIGVudHJpZXMKICAgICAqIHN0b3JlZCBvbiB0aGUga2lsbGVkIGJvb2tp\nZSBhcmUgcHJvcGVybHkgY29waWVkIG92ZXIgYW5kIHJlc3RvcmVkIG9udG8K\nICAgICAqIHRoZSBvdGhlciBib29raWVzLgogICAgICoKICAgICAqIEB0aHJv\nd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY0Jvb2tpZVJlY292ZXJ5VG9SYW5k\nb21Cb29raWVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gQ3Jl\nYXRlIHRoZSBsZWRnZXJzCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAzOwog\nICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJz\nKG51bUxlZGdlcnMpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmllcyBm\nb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMuCiAgICAgICAgaW50\nIG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMo\nbnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZp\ncnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBMT0cuaW5mbygiRmluaXNoZWQg\nd3JpdGluZyBhbGwgbGVkZ2VyIGVudHJpZXMgc28gc2h1dGRvd24gb25lIG9m\nIHRoZSBib29raWVzLiIpOwogICAgICAgIGludCBpbml0aWFsUG9ydCA9IGJz\nQ29uZnMuZ2V0KDApLmdldEJvb2tpZVBvcnQoKTsKICAgICAgICBicy5nZXQo\nMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1vdmUoMCk7CgogICAgICAg\nIC8vIFN0YXJ0dXAgdGhyZWUgbmV3IGJvb2tpZSBzZXJ2ZXJzCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICAgICAgc3Rh\ncnROZXdCb29raWUoKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIHNv\nbWUgbW9yZSBlbnRyaWVzIGZvciB0aGUgbGVkZ2VycyBzbyBhIG5ldyBlbnNl\nbWJsZSB3aWxsIGJlCiAgICAgICAgLy8gY3JlYXRlZCBmb3IgdGhlbS4KICAg\nICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMTAsIGxocyk7\nCgogICAgICAgIC8vIENhbGwgdGhlIHN5bmMgcmVjb3ZlciBib29raWUgbWV0\naG9kLgogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZVNyYyA9IG5l\ndyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3Qo\nKS5nZXRIb3N0QWRkcmVzcygpLCBpbml0aWFsUG9ydCk7CiAgICAgICAgSW5l\ndFNvY2tldEFkZHJlc3MgYm9va2llRGVzdCA9IG51bGw7CiAgICAgICAgTE9H\nLmluZm8oIk5vdyByZWNvdmVyIHRoZSBkYXRhIG9uIHRoZSBraWxsZWQgYm9v\na2llICgiICsgYm9va2llU3JjCiAgICAgICAgICAgICAgICAgKyAiKSBhbmQg\ncmVwbGljYXRlIGl0IHRvIGEgcmFuZG9tIGF2YWlsYWJsZSBvbmUiKTsKICAg\nICAgICBia0FkbWluLnJlY292ZXJCb29raWVEYXRhKGJvb2tpZVNyYywgYm9v\na2llRGVzdCk7CgogICAgICAgIC8vIFZlcmlmeSB0aGUgcmVjb3ZlcmVkIGxl\nZGdlciBlbnRyaWVzIGFyZSBva2F5LgogICAgICAgIHZlcmlmeVJlY292ZXJl\nZExlZGdlcnMobGhzLCAwLCAyICogbnVtTXNncyAtIDEpOwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIFJlcGxpY2F0aW9uVmVyaWZpY2F0aW9u\nQ2FsbGJhY2sgaW1wbGVtZW50cyBSZWFkRW50cnlDYWxsYmFjayB7CiAgICAg\nICAgZmluYWwgQ291bnREb3duTGF0Y2ggbGF0Y2g7CiAgICAgICAgZmluYWwg\nQXRvbWljTG9uZyBudW1TdWNjZXNzOwoKICAgICAgICBSZXBsaWNhdGlvblZl\ncmlmaWNhdGlvbkNhbGxiYWNrKGludCBudW1SZXF1ZXN0cykgewogICAgICAg\nICAgICBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaChudW1SZXF1ZXN0cyk7\nCiAgICAgICAgICAgIG51bVN1Y2Nlc3MgPSBuZXcgQXRvbWljTG9uZygwKTsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2\nb2lkIHJlYWRFbnRyeUNvbXBsZXRlKGludCByYywgbG9uZyBsZWRnZXJJZCwg\nbG9uZyBlbnRyeUlkLCBDaGFubmVsQnVmZmVyIGJ1ZmZlciwgT2JqZWN0IGN0\neCkgewogICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIgPSAoSW5l\ndFNvY2tldEFkZHJlc3MpY3R4OwogICAgICAgICAgICAgICAgTE9HLmRlYnVn\nKCJHb3QgIiArIHJjICsgIiBmb3IgbGVkZ2VyICIgKyBsZWRnZXJJZCArICIg\nZW50cnkgIiArIGVudHJ5SWQgKyAiIGZyb20gIiArIGN0eCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUu\nT0spIHsKICAgICAgICAgICAgICAgIG51bVN1Y2Nlc3MuaW5jcmVtZW50QW5k\nR2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGF0Y2guY291bnRE\nb3duKCk7CiAgICAgICAgfQoKICAgICAgICBsb25nIGF3YWl0KCkgdGhyb3dz\nIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKGxhdGNo\nLmF3YWl0KDYwLCBUaW1lVW5pdC5TRUNPTkRTKSA9PSBmYWxzZSkgewogICAg\nICAgICAgICAgICAgTE9HLndhcm4oIkRpZG4ndCBnZXQgYWxsIHJlc3BvbnNl\ncyBpbiB2ZXJpZmljYXRpb24iKTsKICAgICAgICAgICAgICAgIHJldHVybiAw\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bVN1Y2Nlc3MuZ2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBib29sZWFuIHZlcmlmeUZ1bGx5UmVwbGljYXRl\nZChMZWRnZXJIYW5kbGUgbGgsIGxvbmcgdW50aWxFbnRyeSkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyTWV0YWRhdGEgbWQgPSBnZXRMZWRn\nZXJNZXRhZGF0YShsaCk7CgogICAgICAgIE1hcDxMb25nLCBBcnJheUxpc3Q8\nSW5ldFNvY2tldEFkZHJlc3M+PiBlbnNlbWJsZXMgPSBtZC5nZXRFbnNlbWJs\nZXMoKTsKCiAgICAgICAgSGFzaE1hcDxMb25nLCBMb25nPiByYW5nZXMgPSBu\nZXcgSGFzaE1hcDxMb25nLCBMb25nPigpOwogICAgICAgIEFycmF5TGlzdDxM\nb25nPiBrZXlMaXN0ID0gQ29sbGVjdGlvbnMubGlzdCgKICAgICAgICAgICAg\nICAgIENvbGxlY3Rpb25zLmVudW1lcmF0aW9uKGVuc2VtYmxlcy5rZXlTZXQo\nKSkpOwogICAgICAgIENvbGxlY3Rpb25zLnNvcnQoa2V5TGlzdCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBrZXlMaXN0LnNpemUoKSAtIDE7IGkr\nKykgewogICAgICAgICAgICByYW5nZXMucHV0KGtleUxpc3QuZ2V0KGkpLCBr\nZXlMaXN0LmdldChpKzEpKTsKICAgICAgICB9CiAgICAgICAgcmFuZ2VzLnB1\ndChrZXlMaXN0LmdldChrZXlMaXN0LnNpemUoKS0xKSwgdW50aWxFbnRyeSk7\nCgogICAgICAgIGZvciAoTWFwLkVudHJ5PExvbmcsIEFycmF5TGlzdDxJbmV0\nU29ja2V0QWRkcmVzcz4+IGUgOiBlbnNlbWJsZXMuZW50cnlTZXQoKSkgewog\nICAgICAgICAgICBpbnQgcXVvcnVtID0gbWQuZ2V0QWNrUXVvcnVtU2l6ZSgp\nOwogICAgICAgICAgICBsb25nIHN0YXJ0RW50cnlJZCA9IGUuZ2V0S2V5KCk7\nCiAgICAgICAgICAgIGxvbmcgZW5kRW50cnlJZCA9IHJhbmdlcy5nZXQoc3Rh\ncnRFbnRyeUlkKTsKICAgICAgICAgICAgbG9uZyBleHBlY3RlZFN1Y2Nlc3Mg\nPSBxdW9ydW0qKGVuZEVudHJ5SWQtc3RhcnRFbnRyeUlkKTsKICAgICAgICAg\nICAgaW50IG51bVJlcXVlc3RzID0gZS5nZXRWYWx1ZSgpLnNpemUoKSooKGlu\ndCkoZW5kRW50cnlJZC1zdGFydEVudHJ5SWQpKTsKCiAgICAgICAgICAgIFJl\ncGxpY2F0aW9uVmVyaWZpY2F0aW9uQ2FsbGJhY2sgY2IgPSBuZXcgUmVwbGlj\nYXRpb25WZXJpZmljYXRpb25DYWxsYmFjayhudW1SZXF1ZXN0cyk7CiAgICAg\nICAgICAgIGZvciAobG9uZyBpID0gc3RhcnRFbnRyeUlkOyBpIDwgZW5kRW50\ncnlJZDsgaSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKEluZXRTb2NrZXRB\nZGRyZXNzIGFkZHIgOiBlLmdldFZhbHVlKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBia2MuYm9va2llQ2xpZW50LnJlYWRFbnRyeShhZGRyLCBsaC5nZXRJ\nZCgpLCBpLCBjYiwgYWRkcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGxvbmcgbnVtU3VjY2VzcyA9IGNiLmF3YWl0\nKCk7CiAgICAgICAgICAgIGlmIChudW1TdWNjZXNzIDwgZXhwZWN0ZWRTdWNj\nZXNzKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRnJhZ21lbnQgbm90\nIGZ1bGx5IHJlcGxpY2F0ZWQgbGVkZ2VySWQgPSAiICsgbGguZ2V0SWQoKQog\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHN0YXJ0RW50cnlJZCA9ICIg\nKyBzdGFydEVudHJ5SWQKICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBl\nbmRFbnRyeUlkID0gIiArIGVuZEVudHJ5SWQKICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIiBleHBlY3RlZFN1Y2Nlc3MgPSAiICsgZXhwZWN0ZWRTdWNj\nZXNzCiAgICAgICAgICAgICAgICAgICAgICAgICArICIgZ290U3VjY2VzcyA9\nICIgKyBudW1TdWNjZXNzKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICAvLyBPYmplY3QgdXNlZCBmb3Igc3luY2hyb25pemlu\nZyBhc3luYyBtZXRob2QgY2FsbHMKICAgIGNsYXNzIFN5bmNMZWRnZXJNZXRh\nT2JqZWN0IHsKICAgICAgICBib29sZWFuIHZhbHVlOwogICAgICAgIGludCBy\nYzsKICAgICAgICBMZWRnZXJNZXRhZGF0YSBtZXRhOwoKICAgICAgICBwdWJs\naWMgU3luY0xlZGdlck1ldGFPYmplY3QoKSB7CiAgICAgICAgICAgIHZhbHVl\nID0gZmFsc2U7CiAgICAgICAgICAgIG1ldGEgPSBudWxsOwogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIExlZGdlck1ldGFkYXRhIGdldExlZGdlck1l\ndGFkYXRhKExlZGdlckhhbmRsZSBsaCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgZmluYWwgU3luY0xlZGdlck1ldGFPYmplY3Qgc3luY09iaiA9IG5l\ndyBTeW5jTGVkZ2VyTWV0YU9iamVjdCgpOwogICAgICAgIGJrYy5nZXRMZWRn\nZXJNYW5hZ2VyKCkucmVhZExlZGdlck1ldGFkYXRhKGxoLmdldElkKCksIG5l\ndyBHZW5lcmljQ2FsbGJhY2s8TGVkZ2VyTWV0YWRhdGE+KCkgewoKICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkNvbXBsZXRlKGludCByYywgTGVkZ2VyTWV0YWRhdGEgcmVzdWx0KSB7\nCiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmNPYmopIHsKICAg\nICAgICAgICAgICAgICAgICBzeW5jT2JqLnJjID0gcmM7CiAgICAgICAgICAg\nICAgICAgICAgc3luY09iai5tZXRhID0gcmVzdWx0OwogICAgICAgICAgICAg\nICAgICAgIHN5bmNPYmoudmFsdWUgPSB0cnVlOwogICAgICAgICAgICAgICAg\nICAgIHN5bmNPYmoubm90aWZ5KCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgfSk7CgogICAgICAgIHN5bmNocm9uaXplZCAo\nc3luY09iaikgewogICAgICAgICAgICB3aGlsZSAoc3luY09iai52YWx1ZSA9\nPSBmYWxzZSkgewogICAgICAgICAgICAgICAgc3luY09iai53YWl0KCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKEJL\nRXhjZXB0aW9uLkNvZGUuT0ssIHN5bmNPYmoucmMpOwogICAgICAgIHJldHVy\nbiBzeW5jT2JqLm1ldGE7CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIGZp\nbmREdXBlc0luRW5zZW1ibGVzKExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIGxvbmcgbnVtRHVwZXMgPSAwOwog\nICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGhzKSB7CiAgICAgICAg\nICAgIExlZGdlck1ldGFkYXRhIG1kID0gZ2V0TGVkZ2VyTWV0YWRhdGEobGgp\nOwogICAgICAgICAgICBmb3IgKE1hcC5FbnRyeTxMb25nLCBBcnJheUxpc3Q8\nSW5ldFNvY2tldEFkZHJlc3M+PiBlIDogbWQuZ2V0RW5zZW1ibGVzKCkuZW50\ncnlTZXQoKSkgewogICAgICAgICAgICAgICAgSGFzaFNldDxJbmV0U29ja2V0\nQWRkcmVzcz4gc2V0ID0gbmV3IEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+\nKCk7CiAgICAgICAgICAgICAgICBsb25nIGZyYWdtZW50ID0gZS5nZXRLZXko\nKTsKCiAgICAgICAgICAgICAgICBmb3IgKEluZXRTb2NrZXRBZGRyZXNzIGFk\nZHIgOiBlLmdldFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nc2V0LmNvbnRhaW5zKGFkZHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRHVwZSAiICsgYWRkciArICIgZm91bmQgaW4gZW5zZW1i\nbGUgZm9yIGZyYWdtZW50ICIgKyBmcmFnbWVudAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiBvZiBsZWRnZXIgIiArIGxoLmdldElkKCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBudW1EdXBlcysrOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzZXQuYWRkKGFk\nZHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBudW1EdXBlcyA+IDA7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUZXN0IHJlY292ZXJ5aW5nIHRoZSBjbG9zZWQgbGVkZ2VycyB3\naGVuIHRoZSBmYWlsZWQgYm9va2llIHNlcnZlciBpcyBpbiB0aGUgbGFzdCBl\nbnNlbWJsZQogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAg\ncHVibGljIHZvaWQgdGVzdEJvb2tpZVJlY292ZXJ5T25DbG9zZWRMZWRnZXJz\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBs\nZWRnZXJzCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAgICAgIExp\nc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdl\ncnMsIG51bUJvb2tpZXMsIDIpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgZW50\ncmllcyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMKICAgICAg\nICBpbnQgbnVtTXNncyA9IDEwOwogICAgICAgIHdyaXRlRW50cmllc3RvTGVk\nZ2VycyhudW1Nc2dzLCAwLCBsaHMpOwoKICAgICAgICBjbG9zZUxlZGdlcnMo\nbGhzKTsKCiAgICAgICAgLy8gU2h1dGRvd24gbGFzdCBib29raWUgc2VydmVy\nIGluIGxhc3QgZW5zZW1ibGUKICAgICAgICBBcnJheUxpc3Q8SW5ldFNvY2tl\ndEFkZHJlc3M+IGxhc3RFbnNlbWJsZSA9IGxocy5nZXQoMCkuZ2V0TGVkZ2Vy\nTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVudHJ5U2V0\nKCkuaXRlcmF0b3IoKS5uZXh0KCkuZ2V0VmFsdWUoKTsKICAgICAgICBJbmV0\nU29ja2V0QWRkcmVzcyBib29raWVUb0tpbGwgPSBsYXN0RW5zZW1ibGUuZ2V0\nKGxhc3RFbnNlbWJsZS5zaXplKCkgLSAxKTsKICAgICAgICBraWxsQm9va2ll\nKGJvb2tpZVRvS2lsbCk7CgogICAgICAgIC8vIHN0YXJ0IGEgbmV3IGJvb2tp\nZQogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAgIEluZXRTb2Nr\nZXRBZGRyZXNzIGJvb2tpZURlc3QgPSBudWxsOwogICAgICAgIExPRy5pbmZv\nKCJOb3cgcmVjb3ZlciB0aGUgZGF0YSBvbiB0aGUga2lsbGVkIGJvb2tpZSAo\nIiArIGJvb2tpZVRvS2lsbAogICAgICAgICAgICAgICArICIpIGFuZCByZXBs\naWNhdGUgaXQgdG8gYSByYW5kb20gYXZhaWxhYmxlIG9uZSIpOwoKICAgICAg\nICBia0FkbWluLnJlY292ZXJCb29raWVEYXRhKGJvb2tpZVRvS2lsbCwgYm9v\na2llRGVzdCk7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMp\nIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTm90IGZ1bGx5IHJlcGxpY2F0\nZWQiLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQobGgsIG51bU1zZ3MpKTsKICAg\nICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgQFRl\nc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RCb29raWVS\nZWNvdmVyeU9uT3BlbmVkTGVkZ2VycygpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIC8vIENyZWF0ZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBudW1M\nZWRnZXJzID0gMzsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzID0g\nY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJzLCBudW1Cb29raWVzLCAyKTsKCiAg\nICAgICAgLy8gV3JpdGUgdGhlIGVudHJpZXMgZm9yIHRoZSBsZWRnZXJzIHdp\ndGggZHVtbXkgdmFsdWVzCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAg\nICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsK\nCiAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIK\nICAgICAgICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGxhc3RFbnNl\nbWJsZSA9IGxocy5nZXQoMCkuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNl\nbWJsZXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0\nKCkuZ2V0VmFsdWUoKTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29r\naWVUb0tpbGwgPSBsYXN0RW5zZW1ibGUuZ2V0KGxhc3RFbnNlbWJsZS5zaXpl\nKCkgLSAxKTsKICAgICAgICBraWxsQm9va2llKGJvb2tpZVRvS2lsbCk7Cgog\nICAgICAgIC8vIHN0YXJ0IGEgbmV3IGJvb2tpZQogICAgICAgIHN0YXJ0TmV3\nQm9va2llKCk7CgogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZURl\nc3QgPSBudWxsOwogICAgICAgIExPRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUg\nZGF0YSBvbiB0aGUga2lsbGVkIGJvb2tpZSAoIiArIGJvb2tpZVRvS2lsbAog\nICAgICAgICAgICAgICArICIpIGFuZCByZXBsaWNhdGUgaXQgdG8gYSByYW5k\nb20gYXZhaWxhYmxlIG9uZSIpOwoKICAgICAgICBia0FkbWluLnJlY292ZXJC\nb29raWVEYXRhKGJvb2tpZVRvS2lsbCwgYm9va2llRGVzdCk7CgogICAgICAg\nIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGhzKSB7CiAgICAgICAgICAgIGFz\nc2VydFRydWUoIk5vdCBmdWxseSByZXBsaWNhdGVkIiwgdmVyaWZ5RnVsbHlS\nZXBsaWNhdGVkKGxoLCBudW1Nc2dzKSk7CiAgICAgICAgfQoKICAgICAgICB0\ncnkgewogICAgICAgICAgICAvLyB3ZSBjYW4ndCB3cml0ZSBlbnRyaWVzCiAg\nICAgICAgICAgIHdyaXRlRW50cmllc3RvTGVkZ2VycyhudW1Nc2dzLCAwLCBs\naHMpOwogICAgICAgICAgICBmYWlsKCJzaG91bGQgbm90IHJlYWNoIGhlcmUi\nKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgIH0K\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEJvb2tpZVJlY292ZXJ5T25JblJlY292ZXJ5TGVkZ2VyKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAg\nICAgICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAgICAgICBpbnQgbnVtTGVk\nZ2VycyA9IDE7CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9IGNy\nZWF0ZUxlZGdlcnMobnVtTGVkZ2VycywgMiwgMik7CgogICAgICAgIC8vIFdy\naXRlIHRoZSBlbnRyaWVzIGZvciB0aGUgbGVkZ2VycyB3aXRoIGR1bW15IHZh\nbHVlcwogICAgICAgIHdyaXRlRW50cmllc3RvTGVkZ2VycyhudW1Nc2dzLCAw\nLCBsaHMpOwoKICAgICAgICAvLyBTaHV0ZG93biB0aGUgZmlyc3QgYm9va2ll\nIHNlcnZlcgogICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4g\nbGFzdEVuc2VtYmxlID0gbGhzLmdldCgwKS5nZXRMZWRnZXJNZXRhZGF0YSgp\nLmdldEVuc2VtYmxlcygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAuZW50cnlTZXQoKS5pdGVyYXRv\ncigpLm5leHQoKS5nZXRWYWx1ZSgpOwogICAgICAgIC8vIHJlbW92ZWQgYm9v\na2llCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llVG9LaWxsID0g\nbGFzdEVuc2VtYmxlLmdldCgwKTsKICAgICAgICBraWxsQm9va2llKGJvb2tp\nZVRvS2lsbCk7CiAgICAgICAgLy8gdGVtcCBmYWlsdXJlCiAgICAgICAgSW5l\ndFNvY2tldEFkZHJlc3MgYm9va2llVG9LaWxsMiA9IGxhc3RFbnNlbWJsZS5n\nZXQoMSk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mMiA9IGtp\nbGxCb29raWUoYm9va2llVG9LaWxsMik7CgogICAgICAgIC8vIHN0YXJ0IGEg\nbmV3IGJvb2tpZQogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAg\nIC8vIG9wZW4gdGhlc2UgbGVkZ2VycwogICAgICAgIGZvciAoTGVkZ2VySGFu\nZGxlIG9sZExoIDogbGhzKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBia2Mub3BlbkxlZGdlcihvbGRMaC5nZXRJZCgpLCBkaWdlc3RU\neXBlLCBiYXNlQ2xpZW50Q29uZi5nZXRCb29raWVSZWNvdmVyeVBhc3N3ZCgp\nKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZCBoYXZlIHRocm93biBl\neGNlcHRpb24iKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29raWVUb0tp\nbGwsIG51bGwpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgaGF2ZSB0aHJv\nd24gZXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24u\nQktMZWRnZXJSZWNvdmVyeUV4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAg\nLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CgogICAgICAgIC8vIHJl\nc3RhcnQgZmFpbGVkIGJvb2tpZQogICAgICAgIGJzLmFkZChzdGFydEJvb2tp\nZShjb25mMikpOwogICAgICAgIGJzQ29uZnMuYWRkKGNvbmYyKTsKCiAgICAg\nICAgLy8gcmVjb3ZlciB0aGVtCiAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9v\na2llRGF0YShib29raWVUb0tpbGwsIG51bGwpOwoKICAgICAgICBmb3IgKExl\nZGdlckhhbmRsZSBsaCA6IGxocykgewogICAgICAgICAgICBhc3NlcnRUcnVl\nKCJOb3QgZnVsbHkgcmVwbGljYXRlZCIsIHZlcmlmeUZ1bGx5UmVwbGljYXRl\nZChsaCwgbnVtTXNncykpOwogICAgICAgIH0KCiAgICAgICAgLy8gb3BlbiBs\nZWRnZXJzIHRvIHJlYWQgbWV0YWRhdGEKICAgICAgICBMaXN0PExlZGdlckhh\nbmRsZT4gbmV3TGhzID0gb3BlbkxlZGdlcnMobGhzKTsKICAgICAgICBmb3Ig\nKExlZGdlckhhbmRsZSBuZXdMaCA6IG5ld0xocykgewogICAgICAgICAgICAv\nLyBmaXJzdCBlbnNlbWJsZSBzaG91bGQgY29udGFpbnMgYm9va2llVG9LaWxs\nMiBhbmQgbm90IGNvbnRhaW4gYm9va2llVG9LaWxsCiAgICAgICAgICAgIE1h\ncC5FbnRyeTxMb25nLCBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+PiBl\nbnRyeSA9CiAgICAgICAgICAgICAgICBuZXdMaC5nZXRMZWRnZXJNZXRhZGF0\nYSgpLmdldEVuc2VtYmxlcygpLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0\nKCk7CiAgICAgICAgICAgIGFzc2VydEZhbHNlKGVudHJ5LmdldFZhbHVlKCku\nY29udGFpbnMoYm9va2llVG9LaWxsKSk7CiAgICAgICAgICAgIGFzc2VydFRy\ndWUoZW50cnkuZ2V0VmFsdWUoKS5jb250YWlucyhib29raWVUb0tpbGwyKSk7\nCiAgICAgICAgfQoKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdEFzeW5jQm9va2llUmVjb3ZlcnlUb1JhbmRv\nbUJvb2tpZXNOb3RFbm91Z2hCb29raWVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAgICAgaW50IG51\nbUxlZGdlcnMgPSAzOwogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMg\nPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMsIG51bUJvb2tpZXMsIDIpOwoK\nICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMg\nd2l0aCBkdW1teSB2YWx1ZXMuCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsK\nICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhz\nKTsKCiAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2\nZXIKICAgICAgICBMT0cuaW5mbygiRmluaXNoZWQgd3JpdGluZyBhbGwgbGVk\nZ2VyIGVudHJpZXMgc28gc2h1dGRvd24gb25lIG9mIHRoZSBib29raWVzLiIp\nOwogICAgICAgIGludCBpbml0aWFsUG9ydCA9IGJzQ29uZnMuZ2V0KDApLmdl\ndEJvb2tpZVBvcnQoKTsKICAgICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsK\nICAgICAgICBicy5yZW1vdmUoMCk7CgogICAgICAgIC8vIENhbGwgdGhlIGFz\neW5jIHJlY292ZXIgYm9va2llIG1ldGhvZC4KICAgICAgICBJbmV0U29ja2V0\nQWRkcmVzcyBib29raWVTcmMgPSBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5l\ndEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgaW5p\ndGlhbFBvcnQpOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZURl\nc3QgPSBudWxsOwogICAgICAgIExPRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUg\nZGF0YSBvbiB0aGUga2lsbGVkIGJvb2tpZSAoIiArIGJvb2tpZVNyYwogICAg\nICAgICAgICAgICAgICsgIikgYW5kIHJlcGxpY2F0ZSBpdCB0byBhIHJhbmRv\nbSBhdmFpbGFibGUgb25lIik7CiAgICAgICAgLy8gSW5pdGlhdGUgdGhlIHN5\nbmMgb2JqZWN0CiAgICAgICAgc3luYy52YWx1ZSA9IGZhbHNlOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tpZURhdGEo\nYm9va2llU3JjLCBudWxsKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGhh\ndmUgdGhyb3duIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhj\nZXB0aW9uLkJLTGVkZ2VyUmVjb3ZlcnlFeGNlcHRpb24gYmtlKSB7CiAgICAg\nICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoK\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nU3luY0Jvb2tpZVJlY292ZXJ5VG9SYW5kb21Cb29raWVzQ2hlY2tGb3JEdXBl\ncygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFJhbmRvbSByID0gbmV3\nIFJhbmRvbSgpOwoKICAgICAgICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAg\nICAgICBpbnQgbnVtTGVkZ2VycyA9IDM7CiAgICAgICAgTGlzdDxMZWRnZXJI\nYW5kbGU+IGxocyA9IGNyZWF0ZUxlZGdlcnMobnVtTGVkZ2VycywgbnVtQm9v\na2llcywgMik7CgogICAgICAgIC8vIFdyaXRlIHRoZSBlbnRyaWVzIGZvciB0\naGUgbGVkZ2VycyB3aXRoIGR1bW15IHZhbHVlcy4KICAgICAgICBpbnQgbnVt\nTXNncyA9IDEwOwogICAgICAgIHdyaXRlRW50cmllc3RvTGVkZ2VycyhudW1N\nc2dzLCAwLCBsaHMpOwoKICAgICAgICAvLyBTaHV0ZG93biB0aGUgZmlyc3Qg\nYm9va2llIHNlcnZlcgogICAgICAgIExPRy5pbmZvKCJGaW5pc2hlZCB3cml0\naW5nIGFsbCBsZWRnZXIgZW50cmllcyBzbyBzaHV0ZG93biBvbmUgb2YgdGhl\nIGJvb2tpZXMuIik7CiAgICAgICAgaW50IHJlbW92ZUluZGV4ID0gci5uZXh0\nSW50KGJzLnNpemUoKSk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9v\na2llU3JjID0gYnMuZ2V0KHJlbW92ZUluZGV4KS5nZXRMb2NhbEFkZHJlc3Mo\nKTsKICAgICAgICBicy5nZXQocmVtb3ZlSW5kZXgpLnNodXRkb3duKCk7CiAg\nICAgICAgYnMucmVtb3ZlKHJlbW92ZUluZGV4KTsKCiAgICAgICAgLy8gU3Rh\ncnR1cCBuZXcgYm9va2llIHNlcnZlcgogICAgICAgIHN0YXJ0TmV3Qm9va2ll\nKCk7CgogICAgICAgIC8vIFdyaXRlIHNvbWUgbW9yZSBlbnRyaWVzIGZvciB0\naGUgbGVkZ2VycyBzbyBhIG5ldyBlbnNlbWJsZSB3aWxsIGJlCiAgICAgICAg\nLy8gY3JlYXRlZCBmb3IgdGhlbS4KICAgICAgICB3cml0ZUVudHJpZXN0b0xl\nZGdlcnMobnVtTXNncywgbnVtTXNncywgbGhzKTsKCiAgICAgICAgLy8gQ2Fs\nbCB0aGUgYXN5bmMgcmVjb3ZlciBib29raWUgbWV0aG9kLgogICAgICAgIExP\nRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUgZGF0YSBvbiB0aGUga2lsbGVkIGJv\nb2tpZSAoIiArIGJvb2tpZVNyYwogICAgICAgICAgICAgICAgICsgIikgYW5k\nIHJlcGxpY2F0ZSBpdCB0byBhIHJhbmRvbSBhdmFpbGFibGUgb25lIik7CiAg\nICAgICAgLy8gSW5pdGlhdGUgdGhlIHN5bmMgb2JqZWN0CiAgICAgICAgc3lu\nYy52YWx1ZSA9IGZhbHNlOwogICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tp\nZURhdGEoYm9va2llU3JjLCBudWxsKTsKCiAgICAgICAgYXNzZXJ0RmFsc2Uo\nIkR1cGVzIGV4aXN0IGluIGVuc2VtYmxlcyIsIGZpbmREdXBlc0luRW5zZW1i\nbGVzKGxocykpOwoKICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmll\ncyB0byBlbnN1cmUgZmVuY2luZyBoYXNuJ3QgYnJva2VuIHN0dWZmCiAgICAg\nICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIG51bU1zZ3MqMiwg\nbGhzKTsKCiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMpIHsK\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTm90IGZ1bGx5IHJlcGxpY2F0ZWQi\nLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQobGgsIG51bU1zZ3MqMykpOwogICAg\nICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgcmVjb3ZlcldpdGhv\ndXRQYXNzd29yZEluQ29uZigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIGJ5dGVbXSBwYXNzd2RDb3JyZWN0ID0gIkFBQUFBQSIuZ2V0Qnl0ZXMoKTsK\nICAgICAgICBieXRlW10gcGFzc3dkQmFkID0gIkJCQkJCQiIuZ2V0Qnl0ZXMo\nKTsKICAgICAgICBEaWdlc3RUeXBlIGRpZ2VzdENvcnJlY3QgPSBkaWdlc3RU\neXBlOwogICAgICAgIERpZ2VzdFR5cGUgZGlnZXN0QmFkID0gKGRpZ2VzdFR5\ncGUgPT0gRGlnZXN0VHlwZS5NQUMpID8gRGlnZXN0VHlwZS5DUkMzMiA6IERp\nZ2VzdFR5cGUuTUFDOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2Mu\nY3JlYXRlTGVkZ2VyKDMsIDIsIGRpZ2VzdENvcnJlY3QsIHBhc3N3ZENvcnJl\nY3QpOwogICAgICAgIGxvbmcgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAg\nICAgbGguYWRkRW50cnkoImZvb2JhciIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAg\nfQogICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgIEluZXRTb2NrZXRBZGRy\nZXNzIGJvb2tpZVNyYyA9IGJzLmdldCgwKS5nZXRMb2NhbEFkZHJlc3MoKTsK\nICAgICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1v\ndmUoMCk7CiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAgLy8g\nQ2hlY2sgdGhhdCBlbnRyaWVzIGFyZSBtaXNzaW5nCiAgICAgICAgbGggPSBi\na2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENvcnJl\nY3QsIHBhc3N3ZENvcnJlY3QpOwogICAgICAgIGFzc2VydEZhbHNlKCJTaG91\nbGQgYmUgZW50cmllcyBtaXNzaW5nIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVk\nKGxoLCAxMDApKTsKICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICAvLyBU\ncnkgdG8gcmVjb3ZlciB3aXRoIGJhZCBwYXNzd29yZCBpbiBjb25mCiAgICAg\nICAgLy8gVGhpcyBpcyBmaW5lLCBiZWNhdXNlIGl0IG9ubHkgZmFsbHMgYmFj\nayB0byB0aGUgY29uZmlndXJlZAogICAgICAgIC8vIHBhc3N3b3JkIGlmIHRo\nZSBwYXNzd29yZCBpbmZvIGlzIG1pc3NpbmcgZnJvbSB0aGUgbWV0YWRhdGEK\nICAgICAgICBDbGllbnRDb25maWd1cmF0aW9uIGFkbWluQ29uZiA9IG5ldyBD\nbGllbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgYWRtaW5Db25mLnNldFpr\nU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKTsK\nICAgICAgICBhZG1pbkNvbmYuc2V0Qm9va2llUmVjb3ZlcnlEaWdlc3RUeXBl\nKGRpZ2VzdENvcnJlY3QpOwogICAgICAgIGFkbWluQ29uZi5zZXRCb29raWVS\nZWNvdmVyeVBhc3N3ZChwYXNzd2RCYWQpOwogICAgICAgIHNldE1ldGFzdG9y\nZUltcGxDbGFzcyhhZG1pbkNvbmYpOwoKICAgICAgICBCb29rS2VlcGVyQWRt\naW4gYmthID0gbmV3IEJvb2tLZWVwZXJBZG1pbihhZG1pbkNvbmYpOwogICAg\nICAgIGJrYS5yZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIG51bGwpOwog\nICAgICAgIGJrYS5jbG9zZSgpOwoKICAgICAgICBsaCA9IGJrYy5vcGVuTGVk\nZ2VyTm9SZWNvdmVyeShsZWRnZXJJZCwgZGlnZXN0Q29ycmVjdCwgcGFzc3dk\nQ29ycmVjdCk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiU2hvdWxkIGJlIGJhY2sg\ndG8gZnVsbHkgcmVwbGljYXRpb24iLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQo\nbGgsIDEwMCkpOwogICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgIGJvb2tp\nZVNyYyA9IGJzLmdldCgwKS5nZXRMb2NhbEFkZHJlc3MoKTsKICAgICAgICBi\ncy5nZXQoMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1vdmUoMCk7CiAg\nICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhh\ndCBlbnRyaWVzIGFyZSBtaXNzaW5nCiAgICAgICAgbGggPSBia2Mub3Blbkxl\nZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENvcnJlY3QsIHBhc3N3\nZENvcnJlY3QpOwogICAgICAgIGFzc2VydEZhbHNlKCJTaG91bGQgYmUgZW50\ncmllcyBtaXNzaW5nIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCAxMDAp\nKTsKICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICAvLyBUcnkgdG8gcmVj\nb3ZlciB3aXRoIG5vIHBhc3N3b3JkIGluIGNvbmYKICAgICAgICBhZG1pbkNv\nbmYgPSBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgIGFkbWlu\nQ29uZi5zZXRaa1NlcnZlcnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RT\ndHJpbmcoKSk7CiAgICAgICAgc2V0TWV0YXN0b3JlSW1wbENsYXNzKGFkbWlu\nQ29uZik7CgogICAgICAgIGJrYSA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYWRt\naW5Db25mKTsKICAgICAgICBia2EucmVjb3ZlckJvb2tpZURhdGEoYm9va2ll\nU3JjLCBudWxsKTsKICAgICAgICBia2EuY2xvc2UoKTsKCiAgICAgICAgbGgg\nPSBia2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENv\ncnJlY3QsIHBhc3N3ZENvcnJlY3QpOwogICAgICAgIGFzc2VydFRydWUoIlNo\nb3VsZCBiZSBiYWNrIHRvIGZ1bGx5IHJlcGxpY2F0aW9uIiwgdmVyaWZ5RnVs\nbHlSZXBsaWNhdGVkKGxoLCAxMDApKTsKICAgICAgICBsaC5jbG9zZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IHdoZW4gd2UgdHJ5IHRv\nIHJlY292ZXIgYSBsZWRnZXIgd2hpY2ggZG9lc24ndCBoYXZlCiAgICAgKiB0\naGUgcGFzc3dvcmQgc3RvcmVkIGluIHRoZSBjb25maWd1cmF0aW9uLCB3ZSBk\nb24ndCBzdWNjZWVkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCBlbnN1cmVQYXNzd29yZFVzZWRGb3JPbGRMZWRn\nZXJzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gVGhpcyB0ZXN0\nIGJhc2VzIG9uIGNyZWF0aW5nIG9sZCBsZWRnZXJzIGluIHZlcnNpb24gNC4x\nLjAsIHdoaWNoIG9ubHkKICAgICAgICAvLyBzdXBwb3J0cyBab29LZWVwZXIg\nYmFzZWQgZmxhdCBhbmQgaGllcmFyY2hpY2FsIExlZGdlck1hbmFnZXJGYWN0\nb3J5LgogICAgICAgIC8vIFNvIHdlIGlnbm9yZSBpdCBmb3IgTVNMZWRnZXJN\nYW5hZ2VyRmFjdG9yeS4KICAgICAgICBpZiAoTVNMZWRnZXJNYW5hZ2VyRmFj\ndG9yeS5jbGFzcy5nZXROYW1lKCkuZXF1YWxzKGxlZGdlck1hbmFnZXJGYWN0\nb3J5KSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICAvLyBzdG9wIGFsbCBib29raWVzCiAgICAgICAgLy8gYW5kIHdpcGUgdGhl\nIGxlZGdlciBsYXlvdXQgc28gd2UgY2FuIHVzZSBhbiBvbGQgY2xpZW50CiAg\nICAgICAgemtVdGlsLmdldFpvb0tlZXBlckNsaWVudCgpLmRlbGV0ZSgiL2xl\nZGdlcnMvTEFZT1VUIiwgLTEpOwoKICAgICAgICBieXRlW10gcGFzc3dkQ29y\ncmVjdCA9ICJBQUFBQUEiLmdldEJ5dGVzKCk7CiAgICAgICAgYnl0ZVtdIHBh\nc3N3ZEJhZCA9ICJCQkJCQkIiLmdldEJ5dGVzKCk7CiAgICAgICAgRGlnZXN0\nVHlwZSBkaWdlc3RDb3JyZWN0ID0gZGlnZXN0VHlwZTsKICAgICAgICBEaWdl\nc3RUeXBlIGRpZ2VzdEJhZCA9IGRpZ2VzdENvcnJlY3QgPT0gRGlnZXN0VHlw\nZS5NQUMgPyBEaWdlc3RUeXBlLkNSQzMyIDogRGlnZXN0VHlwZS5NQUM7Cgog\nICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50\nLkJvb2tLZWVwZXIuRGlnZXN0VHlwZSBkaWdlc3RDb3JyZWN0NDEwCiAgICAg\nICAgICAgID0gb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tlZXBlci5jbGll\nbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlLnZhbHVlT2YoZGlnZXN0VHlwZS50\nb1N0cmluZygpKTsKCiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9v\na2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24gYwogICAgICAgICAg\nICA9IG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNvbmYu\nQ2xpZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgIGMuc2V0WmtTZXJ2ZXJz\nKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpCiAgICAgICAg\nICAgIC5zZXRMZWRnZXJNYW5hZ2VyVHlwZSgKICAgICAgICAgICAgICAgICAg\nICBsZWRnZXJNYW5hZ2VyRmFjdG9yeS5lcXVhbHMoIm9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhLkZsYXRMZWRnZXJNYW5hZ2VyRmFjdG9yeSIpID8KICAg\nICAgICAgICAgICAgICAgICAiZmxhdCIgOiAiaGllcmFyY2hpY2FsIik7Cgog\nICAgICAgIC8vIGNyZWF0ZSBjbGllbnQgdG8gc2V0IHVwIGxheW91dCwgY2xv\nc2UgaXQsIHJlc3RhcnQgYm9va2llcywgYW5kIG9wZW4gYSBuZXcgY2xpZW50\nLgogICAgICAgIC8vIHRoZSBuZXcgY2xpZW50IGlzIG5lY2Vzc2FyeSB0byBl\nbnN1cmUgdGhhdCBpdCBoYXMgYWxsIHRoZSByZXN0YXJ0ZWQgYm9va2llcyBp\nbiB0aGUKICAgICAgICAvLyBpdHMgYXZhaWxhYmxlIGJvb2tpZSBsaXN0CiAg\nICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tlZXBlci5jbGllbnQu\nQm9va0tlZXBlciBia2M0MQogICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hl\nLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyKGMpOwog\nICAgICAgIGJrYzQxLmNsb3NlKCk7CiAgICAgICAgcmVzdGFydEJvb2tpZXMo\nKTsKICAgICAgICBia2M0MSA9IG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5i\nb29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyKGMpOwoKICAgICAgICBvcmcu\nYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5k\nbGUgbGg0MQogICAgICAgICAgICA9IGJrYzQxLmNyZWF0ZUxlZGdlcigzLCAy\nLCBkaWdlc3RDb3JyZWN0NDEwLCBwYXNzd2RDb3JyZWN0KTsKICAgICAgICBs\nb25nIGxlZGdlcklkID0gbGg0MS5nZXRJZCgpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgbGg0MS5hZGRF\nbnRyeSgiZm9vYmFyIi5nZXRCeXRlcygpKTsKICAgICAgICB9CiAgICAgICAg\nbGg0MS5jbG9zZSgpOwogICAgICAgIGJrYzQxLmNsb3NlKCk7CgogICAgICAg\nIC8vIFN0YXJ0dXAgYSBuZXcgYm9va2llIHNlcnZlcgogICAgICAgIGludCBu\nZXdCb29raWVQb3J0ID0gc3RhcnROZXdCb29raWUoKTsKICAgICAgICBpbnQg\ncmVtb3ZlSW5kZXggPSAwOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJv\nb2tpZVNyYyA9IGJzLmdldChyZW1vdmVJbmRleCkuZ2V0TG9jYWxBZGRyZXNz\nKCk7CiAgICAgICAgYnMuZ2V0KHJlbW92ZUluZGV4KS5zaHV0ZG93bigpOwog\nICAgICAgIGJzLnJlbW92ZShyZW1vdmVJbmRleCk7CgogICAgICAgIC8vIENo\nZWNrIHRoYXQgZW50cmllcyBhcmUgbWlzc2luZwogICAgICAgIExlZGdlckhh\nbmRsZSBsaCA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJZCwg\nZGlnZXN0Q29ycmVjdCwgcGFzc3dkQ29ycmVjdCk7CiAgICAgICAgYXNzZXJ0\nRmFsc2UoIlNob3VsZCBiZSBlbnRyaWVzIG1pc3NpbmciLCB2ZXJpZnlGdWxs\neVJlcGxpY2F0ZWQobGgsIDEwMCkpOwogICAgICAgIGxoLmNsb3NlKCk7Cgog\nICAgICAgIC8vIFRyeSB0byByZWNvdmVyIHdpdGggYmFkIHBhc3N3b3JkIGlu\nIGNvbmYKICAgICAgICAvLyBpZiB0aGUgZGlnZXN0IHR5cGUgaXMgTUFDCiAg\nICAgICAgLy8gZm9yIENSQzMyLCB0aGUgcGFzc3dvcmQgaXMgb25seSBjaGVj\na2VkCiAgICAgICAgLy8gd2hlbiBhZGRpbmcgbmV3IGVudHJpZXMsIHdoaWNo\nIHJlY292ZXJ5IHdpbGwKICAgICAgICAvLyBuZXZlciBkbwogICAgICAgIENs\naWVudENvbmZpZ3VyYXRpb24gYWRtaW5Db25mOwogICAgICAgIEJvb2tLZWVw\nZXJBZG1pbiBia2E7CiAgICAgICAgaWYgKGRpZ2VzdENvcnJlY3QgPT0gRGln\nZXN0VHlwZS5NQUMpIHsKICAgICAgICAgICAgYWRtaW5Db25mID0gbmV3IENs\naWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgYWRtaW5Db25mLnNl\ndFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygp\nKTsKICAgICAgICAgICAgYWRtaW5Db25mLnNldExlZGdlck1hbmFnZXJGYWN0\nb3J5Q2xhc3NOYW1lKGxlZGdlck1hbmFnZXJGYWN0b3J5KTsKICAgICAgICAg\nICAgYWRtaW5Db25mLnNldEJvb2tpZVJlY292ZXJ5RGlnZXN0VHlwZShkaWdl\nc3RDb3JyZWN0KTsKICAgICAgICAgICAgYWRtaW5Db25mLnNldEJvb2tpZVJl\nY292ZXJ5UGFzc3dkKHBhc3N3ZEJhZCk7CgogICAgICAgICAgICBia2EgPSBu\nZXcgQm9va0tlZXBlckFkbWluKGFkbWluQ29uZik7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBia2EucmVjb3ZlckJvb2tpZURhdGEoYm9v\na2llU3JjLCBudWxsKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4n\ndCBiZSBhYmxlIHRvIHJlY292ZXIgd2l0aCB3cm9uZyBwYXNzd29yZCIpOwog\nICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAg\nICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICBia2EuY2xvc2UoKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gVHJ5IHRvIHJlY292ZXIg\nd2l0aCBiYWQgZGlnZXN0IGluIGNvbmYKICAgICAgICBhZG1pbkNvbmYgPSBu\nZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgIGFkbWluQ29uZi5z\nZXRaa1NlcnZlcnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmco\nKSk7CiAgICAgICAgYWRtaW5Db25mLnNldExlZGdlck1hbmFnZXJGYWN0b3J5\nQ2xhc3NOYW1lKGxlZGdlck1hbmFnZXJGYWN0b3J5KTsKICAgICAgICBhZG1p\nbkNvbmYuc2V0Qm9va2llUmVjb3ZlcnlEaWdlc3RUeXBlKGRpZ2VzdEJhZCk7\nCiAgICAgICAgYWRtaW5Db25mLnNldEJvb2tpZVJlY292ZXJ5UGFzc3dkKHBh\nc3N3ZENvcnJlY3QpOwoKICAgICAgICBia2EgPSBuZXcgQm9va0tlZXBlckFk\nbWluKGFkbWluQ29uZik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmth\nLnJlY292ZXJCb29raWVEYXRhKGJvb2tpZVNyYywgbnVsbCk7CiAgICAgICAg\nICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHJlY292ZXIgd2l0aCB3\ncm9uZyBkaWdlc3QiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBi\na2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBia2EuY2xvc2UoKTsKICAgICAg\nICB9CgogICAgICAgIC8vIENoZWNrIHRoYXQgZW50cmllcyBhcmUgc3RpbGwg\nbWlzc2luZwogICAgICAgIGxoID0gYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5\nKGxlZGdlcklkLCBkaWdlc3RDb3JyZWN0LCBwYXNzd2RDb3JyZWN0KTsKICAg\nICAgICBhc3NlcnRGYWxzZSgiU2hvdWxkIGJlIGVudHJpZXMgbWlzc2luZyIs\nIHZlcmlmeUZ1bGx5UmVwbGljYXRlZChsaCwgMTAwKSk7CiAgICAgICAgbGgu\nY2xvc2UoKTsKCiAgICAgICAgYWRtaW5Db25mLnNldEJvb2tpZVJlY292ZXJ5\nRGlnZXN0VHlwZShkaWdlc3RDb3JyZWN0KTsKICAgICAgICBhZG1pbkNvbmYu\nc2V0Qm9va2llUmVjb3ZlcnlQYXNzd2QocGFzc3dkQ29ycmVjdCk7CgogICAg\nICAgIGJrYSA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYWRtaW5Db25mKTsKICAg\nICAgICBia2EucmVjb3ZlckJvb2tpZURhdGEoYm9va2llU3JjLCBudWxsKTsK\nICAgICAgICBia2EuY2xvc2UoKTsKCiAgICAgICAgbGggPSBia2Mub3Blbkxl\nZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENvcnJlY3QsIHBhc3N3\nZENvcnJlY3QpOwogICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBoYXZlIHJl\nY292ZXJlZCBldmVyeXRoaW5nIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxo\nLCAxMDApKTsKICAgICAgICBsaC5jbG9zZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

