{"sha":"125452d8ae87076fedf6895bd71eef8ea8175d90","node_id":"MDQ6QmxvYjE1NzU5NTY6MTI1NDUyZDhhZTg3MDc2ZmVkZjY4OTViZDcxZWVmOGVhODE3NWQ5MA==","size":10528,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/125452d8ae87076fedf6895bd71eef8ea8175d90","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhOwoKaW1w\nb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGph\ndmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuUXVldWU7CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9t\nOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5Tb3J0\nZWRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJlZVNldDsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuYm9va2llLkdhcmJhZ2VDb2xsZWN0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLlNjYW5BbmRDb21wYXJl\nR2FyYmFnZUNvbGxlY3RvcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyTWV0YWRhdGE7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2Vy\nLkxlZGdlclJhbmdlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGEuTGVkZ2VyTWFuYWdlci5MZWRnZXJSYW5nZUl0ZXJhdG9yOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5h\nbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIudmVyc2lvbmluZy5WZXJzaW9uOwppbXBvcnQgb3JnLmp1\nbml0LlRlc3Q7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogVGVzdCBnYXJiYWdlIGNv\nbGxlY3Rpb24gbGVkZ2VycyBpbiBsZWRnZXIgbWFuYWdlcgogKi8KcHVibGlj\nIGNsYXNzIEdjTGVkZ2Vyc1Rlc3QgZXh0ZW5kcyBMZWRnZXJNYW5hZ2VyVGVz\ndENhc2UgewogICAgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihHY0xlZGdlcnNUZXN0LmNsYXNzKTsKCiAgICBw\ndWJsaWMgR2NMZWRnZXJzVGVzdChDbGFzczw/IGV4dGVuZHMgTGVkZ2VyTWFu\nYWdlckZhY3Rvcnk+IGxtRmFjdG9yeUNscykgewogICAgICAgIHN1cGVyKGxt\nRmFjdG9yeUNscyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgbGVk\nZ2VycwogICAgICovCiAgICBwcml2YXRlIHZvaWQgY3JlYXRlTGVkZ2Vycyhp\nbnQgbnVtTGVkZ2VycywgZmluYWwgU2V0PExvbmc+IGNyZWF0ZWRMZWRnZXJz\nKSB7CiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBleHBlY3RlZCA9IG5l\ndyBBdG9taWNJbnRlZ2VyKG51bUxlZGdlcnMpOwogICAgICAgIGZvciAoaW50\nIGk9MDsgaTxudW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgZ2V0TGVk\nZ2VyTWFuYWdlcigpLmNyZWF0ZUxlZGdlcihuZXcgTGVkZ2VyTWV0YWRhdGEo\nMSwgMSwgMSwgRGlnZXN0VHlwZS5NQUMsICIiLmdldEJ5dGVzKCkpLAogICAg\nICAgICAgICAgICAgbmV3IEdlbmVyaWNDYWxsYmFjazxMb25nPigpIHsKICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBMb25nIGxlZGdlcklk\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9u\nLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlTGVk\nZ2Vycy5wdXQobGVkZ2VySWQsIHRydWUpOwogICAgICAgICAgICAgICAgICAg\nICAgICBjcmVhdGVkTGVkZ2Vycy5hZGQobGVkZ2VySWQpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQg\nKGV4cGVjdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCBudW0g\nPSBleHBlY3RlZC5kZWNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKG51bSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBleHBlY3RlZC5ub3RpZnkoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9u\naXplZCAoZXhwZWN0ZWQpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHdoaWxlIChleHBlY3RlZC5nZXQoKSA+IDApIHsKICAgICAgICAg\nICAgICAgICAgICBleHBlY3RlZC53YWl0KDEwMCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGllKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIHJlbW92ZUxlZGdlcihsb25nIGxlZGdlcklkKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBBdG9taWNJbnRlZ2VyIHJjID0g\nbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgZmluYWwgQ291bnREb3du\nTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAg\nZ2V0TGVkZ2VyTWFuYWdlcigpLnJlbW92ZUxlZGdlck1ldGFkYXRhKGxlZGdl\ncklkLCBWZXJzaW9uLkFOWSwKICAgICAgICAgICAgICAgIG5ldyBHZW5lcmlj\nQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9u\nQ29tcGxldGUoaW50IHJjMiwgVm9pZCByZXN1bHQpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgcmMuc2V0KHJjMik7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgIGFzc2VydFRydWUobGF0\nY2guYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICBhc3Nl\ncnRFcXVhbHMoIlJlbW92ZSBzaG91bGQgaGF2ZSBzdWNjZWVkZWQiLCAwLCBy\nYy5nZXQoKSk7CiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RHYXJiYWdlQ29sbGVjdExlZGdlcnMoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgbnVtTGVkZ2VycyA9IDEwMDsK\nICAgICAgICBpbnQgbnVtUmVtb3ZlZExlZGdlcnMgPSAxMDsKCiAgICAgICAg\nZmluYWwgU2V0PExvbmc+IGNyZWF0ZWRMZWRnZXJzID0gbmV3IEhhc2hTZXQ8\nTG9uZz4oKTsKICAgICAgICBmaW5hbCBTZXQ8TG9uZz4gcmVtb3ZlZExlZGdl\ncnMgPSBuZXcgSGFzaFNldDxMb25nPigpOwoKICAgICAgICAvLyBjcmVhdGUg\nMTAwIGxlZGdlcnMKICAgICAgICBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMs\nIGNyZWF0ZWRMZWRnZXJzKTsKCiAgICAgICAgUmFuZG9tIHIgPSBuZXcgUmFu\nZG9tKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAgICAgICBmaW5h\nbCBMaXN0PExvbmc+IHRtcExpc3QgPSBuZXcgQXJyYXlMaXN0PExvbmc+KCk7\nCiAgICAgICAgdG1wTGlzdC5hZGRBbGwoY3JlYXRlZExlZGdlcnMpOwogICAg\nICAgIENvbGxlY3Rpb25zLnNodWZmbGUodG1wTGlzdCwgcik7CiAgICAgICAg\nLy8gcmFuZG9tIHJlbW92ZSBzZXZlcmFsIGxlZGdlcnMKICAgICAgICBmb3Ig\nKGludCBpPTA7IGk8bnVtUmVtb3ZlZExlZGdlcnM7IGkrKykgewogICAgICAg\nICAgICBsb25nIGxlZGdlcklkID0gdG1wTGlzdC5nZXQoaSk7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAocmVtb3ZlZExlZGdlcnMpIHsKICAgICAgICAg\nICAgICAgIGdldExlZGdlck1hbmFnZXIoKS5yZW1vdmVMZWRnZXJNZXRhZGF0\nYShsZWRnZXJJZCwgVmVyc2lvbi5BTlksCiAgICAgICAgICAgICAgICAgICAg\nbmV3IEdlbmVyaWNDYWxsYmFjazxWb2lkPigpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgVm9pZCByZXN1\nbHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAocmVtb3ZlZExlZGdlcnMpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZW1vdmVkTGVkZ2Vycy5ub3RpZnkoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZW1vdmVk\nTGVkZ2Vycy53YWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVt\nb3ZlZExlZGdlcnMuYWRkKGxlZGdlcklkKTsKICAgICAgICAgICAgY3JlYXRl\nZExlZGdlcnMucmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICB9CiAgICAgICAg\nZmluYWwgQ291bnREb3duTGF0Y2ggaW5HY1Byb2dyZXNzID0gbmV3IENvdW50\nRG93bkxhdGNoKDEpOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGNy\nZWF0ZUxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIGZp\nbmFsIENvdW50RG93bkxhdGNoIGVuZExhdGNoID0gbmV3IENvdW50RG93bkxh\ndGNoKDIpOwogICAgICAgIGZpbmFsIEdhcmJhZ2VDb2xsZWN0b3IgZ2FyYmFn\nZUNvbGxlY3RvciA9CiAgICAgICAgICAgICAgICBuZXcgU2NhbkFuZENvbXBh\ncmVHYXJiYWdlQ29sbGVjdG9yKGdldExlZGdlck1hbmFnZXIoKSwgYWN0aXZl\nTGVkZ2Vycyk7CiAgICAgICAgVGhyZWFkIGdjVGhyZWFkID0gbmV3IFRocmVh\nZCgpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgIGdhcmJhZ2VDb2xsZWN0\nb3IuZ2MobmV3IEdhcmJhZ2VDb2xsZWN0b3IuR2FyYmFnZUNsZWFuZXIoKSB7\nCiAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBwYXVzZWQgPSBmYWxzZTsK\nICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBjbGVhbihsb25nIGxlZGdlcklkKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmICghcGF1c2VkKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpbkdjUHJvZ3Jlc3MuY291bnREb3duKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGNyZWF0ZUxhdGNoLmF3YWl0KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBMT0cuaW5mbygiR2FyYmFnZSBDb2xsZWN0ZWQgbGVkZ2VyIHt9IiwgbGVk\nZ2VySWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0pOwogICAgICAgICAgICAgICAgTE9HLmluZm8oIkdjIFRocmVhZCBxdWl0\ncy4iKTsKICAgICAgICAgICAgICAgIGVuZExhdGNoLmNvdW50RG93bigpOwog\nICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgVGhyZWFkIGNyZWF0\nZVRocmVhZCA9IG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGluR2NQcm9ncmVzcy5h\nd2FpdCgpOwogICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSAxMCBtb3Jl\nIGxlZGdlcnMKICAgICAgICAgICAgICAgICAgICBjcmVhdGVMZWRnZXJzKDEw\nLCBjcmVhdGVkTGVkZ2Vycyk7CiAgICAgICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIkZpbmlzaGVkIGNyZWF0aW5nIDEwIG1vcmUgbGVkZ2Vycy4iKTsKICAg\nICAgICAgICAgICAgICAgICBjcmVhdGVMYXRjaC5jb3VudERvd24oKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiQ3JlYXRlIFRo\ncmVhZCBxdWl0cy4iKTsKICAgICAgICAgICAgICAgIGVuZExhdGNoLmNvdW50\nRG93bigpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgY3Jl\nYXRlVGhyZWFkLnN0YXJ0KCk7CiAgICAgICAgZ2NUaHJlYWQuc3RhcnQoKTsK\nCiAgICAgICAgZW5kTGF0Y2guYXdhaXQoKTsKCiAgICAgICAgLy8gdGVzdCBs\nZWRnZXJzCiAgICAgICAgZm9yIChMb25nIGxlZGdlciA6IHJlbW92ZWRMZWRn\nZXJzKSB7CiAgICAgICAgICAgIGFzc2VydEZhbHNlKGFjdGl2ZUxlZGdlcnMu\nY29udGFpbnNLZXkobGVkZ2VyKSk7CiAgICAgICAgfQogICAgICAgIGZvciAo\nTG9uZyBsZWRnZXIgOiBjcmVhdGVkTGVkZ2VycykgewogICAgICAgICAgICBh\nc3NlcnRUcnVlKGFjdGl2ZUxlZGdlcnMuY29udGFpbnNLZXkobGVkZ2VyKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0R2NMZWRnZXJzT3V0c2lkZVJhbmdlKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgU29ydGVkU2V0PExvbmc+\nIGNyZWF0ZWRMZWRnZXJzID0gQ29sbGVjdGlvbnMuc3luY2hyb25pemVkU29y\ndGVkU2V0KG5ldyBUcmVlU2V0PExvbmc+KCkpOwogICAgICAgIGZpbmFsIFF1\nZXVlPExvbmc+IGNsZWFuZWQgPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwog\nICAgICAgIGludCBudW1MZWRnZXJzID0gMTAwOwoKICAgICAgICBjcmVhdGVM\nZWRnZXJzKG51bUxlZGdlcnMsIGNyZWF0ZWRMZWRnZXJzKTsKCiAgICAgICAg\nZmluYWwgR2FyYmFnZUNvbGxlY3RvciBnYXJiYWdlQ29sbGVjdG9yID0KICAg\nICAgICAgICAgICAgIG5ldyBTY2FuQW5kQ29tcGFyZUdhcmJhZ2VDb2xsZWN0\nb3IoZ2V0TGVkZ2VyTWFuYWdlcigpLCBhY3RpdmVMZWRnZXJzKTsKICAgICAg\nICBHYXJiYWdlQ29sbGVjdG9yLkdhcmJhZ2VDbGVhbmVyIGNsZWFuZXIgPSBu\nZXcgR2FyYmFnZUNvbGxlY3Rvci5HYXJiYWdlQ2xlYW5lcigpIHsKICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgY2xlYW4obG9uZyBsZWRnZXJJZCkgewogICAgICAgICAgICAgICAgICAg\nIExPRy5pbmZvKCJDbGVhbmVkIHt9IiwgbGVkZ2VySWQpOwogICAgICAgICAg\nICAgICAgICAgIGNsZWFuZWQuYWRkKGxlZGdlcklkKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgZ2FyYmFnZUNvbGxlY3Rv\nci5nYyhjbGVhbmVyKTsKICAgICAgICBhc3NlcnROdWxsKCJTaG91bGQgaGF2\nZSBjbGVhbmVkIG5vdGhpbmciLCBjbGVhbmVkLnBvbGwoKSk7CgogICAgICAg\nIGxvbmcgbGFzdCA9IGNyZWF0ZWRMZWRnZXJzLmxhc3QoKTsKICAgICAgICBy\nZW1vdmVMZWRnZXIobGFzdCk7CiAgICAgICAgZ2FyYmFnZUNvbGxlY3Rvci5n\nYyhjbGVhbmVyKTsKICAgICAgICBhc3NlcnROb3ROdWxsKCJTaG91bGQgaGF2\nZSBjbGVhbmVkIHNvbWV0aGluZyIsIGNsZWFuZWQucGVlaygpKTsKICAgICAg\nICBhc3NlcnRFcXVhbHMoIlNob3VsZCBoYXZlIGNsZWFuZWQgbGFzdCBsZWRn\nZXIiICsgbGFzdCwgKGxvbmcpbGFzdCwgKGxvbmcpY2xlYW5lZC5wb2xsKCkp\nOwoKICAgICAgICBsb25nIGZpcnN0ID0gY3JlYXRlZExlZGdlcnMuZmlyc3Qo\nKTsKICAgICAgICByZW1vdmVMZWRnZXIoZmlyc3QpOwogICAgICAgIGdhcmJh\nZ2VDb2xsZWN0b3IuZ2MoY2xlYW5lcik7CiAgICAgICAgYXNzZXJ0Tm90TnVs\nbCgiU2hvdWxkIGhhdmUgY2xlYW5lZCBzb21ldGhpbmciLCBjbGVhbmVkLnBl\nZWsoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgaGF2ZSBjbGVh\nbmVkIGZpcnN0IGxlZGdlciIgKyBmaXJzdCwgKGxvbmcpZmlyc3QsIChsb25n\nKWNsZWFuZWQucG9sbCgpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEdjTGVkZ2Vyc05vdExhc3QoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBTb3J0ZWRTZXQ8TG9u\nZz4gY3JlYXRlZExlZGdlcnMgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRT\nb3J0ZWRTZXQobmV3IFRyZWVTZXQ8TG9uZz4oKSk7CiAgICAgICAgZmluYWwg\nTGlzdDxMb25nPiBjbGVhbmVkID0gbmV3IEFycmF5TGlzdDxMb25nPigpOwoK\nICAgICAgICAvLyBDcmVhdGUgZW5vdWdoIGxlZGdlcnMgdG8gc3BhbiBvdmVy\nIDQgcmFuZ2VzIGluIHRoZSBoaWVyYXJjaGljYWwgbGVkZ2VyIG1hbmFnZXIg\naW1wbGVtZW50YXRpb24KICAgICAgICBmaW5hbCBpbnQgbnVtTGVkZ2VycyA9\nIDMwMDAxOwoKICAgICAgICBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMsIGNy\nZWF0ZWRMZWRnZXJzKTsKCiAgICAgICAgZmluYWwgR2FyYmFnZUNvbGxlY3Rv\nciBnYXJiYWdlQ29sbGVjdG9yID0KICAgICAgICAgICAgICAgIG5ldyBTY2Fu\nQW5kQ29tcGFyZUdhcmJhZ2VDb2xsZWN0b3IoZ2V0TGVkZ2VyTWFuYWdlcigp\nLCBhY3RpdmVMZWRnZXJzKTsKICAgICAgICBHYXJiYWdlQ29sbGVjdG9yLkdh\ncmJhZ2VDbGVhbmVyIGNsZWFuZXIgPSBuZXcgR2FyYmFnZUNvbGxlY3Rvci5H\nYXJiYWdlQ2xlYW5lcigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgY2xlYW4obG9uZyBsZWRnZXJJ\nZCkgewogICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJDbGVhbmVkIHt9\nIiwgbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAgIGNsZWFuZWQuYWRk\nKGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsK\nCiAgICAgICAgU29ydGVkU2V0PExvbmc+IHNjYW5uZWRMZWRnZXJzID0gbmV3\nIFRyZWVTZXQ8TG9uZz4oKTsKICAgICAgICBMZWRnZXJSYW5nZUl0ZXJhdG9y\nIGl0ZXJhdG9yID0gZ2V0TGVkZ2VyTWFuYWdlcigpLmdldExlZGdlclJhbmdl\ncygpOwogICAgICAgIHdoaWxlIChpdGVyYXRvci5oYXNOZXh0KCkpIHsKICAg\nICAgICAgICAgTGVkZ2VyUmFuZ2UgbGVkZ2VyUmFuZ2UgPSBpdGVyYXRvci5u\nZXh0KCk7CiAgICAgICAgICAgIHNjYW5uZWRMZWRnZXJzLmFkZEFsbChsZWRn\nZXJSYW5nZS5nZXRMZWRnZXJzKCkpOwogICAgICAgIH0KCiAgICAgICAgYXNz\nZXJ0RXF1YWxzKGNyZWF0ZWRMZWRnZXJzLCBzY2FubmVkTGVkZ2Vycyk7Cgog\nICAgICAgIGdhcmJhZ2VDb2xsZWN0b3IuZ2MoY2xlYW5lcik7CiAgICAgICAg\nYXNzZXJ0VHJ1ZSgiU2hvdWxkIGhhdmUgY2xlYW5lZCBub3RoaW5nIiwgY2xl\nYW5lZC5pc0VtcHR5KCkpOwoKICAgICAgICBsb25nIGZpcnN0ID0gY3JlYXRl\nZExlZGdlcnMuZmlyc3QoKTsKICAgICAgICByZW1vdmVMZWRnZXIoZmlyc3Qp\nOwogICAgICAgIGdhcmJhZ2VDb2xsZWN0b3IuZ2MoY2xlYW5lcik7CiAgICAg\nICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgaGF2ZSBjbGVhbmVkIHNvbWV0aGlu\nZyIsIDEsIGNsZWFuZWQuc2l6ZSgpKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nIlNob3VsZCBoYXZlIGNsZWFuZWQgZmlyc3QgbGVkZ2VyIiArIGZpcnN0LCAo\nbG9uZylmaXJzdCwgKGxvbmcpY2xlYW5lZC5nZXQoMCkpOwogICAgfQp9Cg==\n","encoding":"base64"}

