{"sha":"0a2bad2ec1f5561799dd2b5ef7dbbf3ae4d1743e","node_id":"MDQ6QmxvYjE1NzU5NTY6MGEyYmFkMmVjMWY1NTYxNzk5ZGQyYjVlZjdkYmJmM2FlNGQxNzQzZQ==","size":12351,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0a2bad2ec1f5561799dd2b5ef7dbbf3ae4d1743e","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdC5Cb29rS2Vl\ncGVyQ2x1c3RlclRlc3RDYXNlOwoKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuYXRvbWljLkF0b21pY0Jvb2xlYW47CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0\nIGphdmEuaW8uRmlsZU91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uRmls\nZW5hbWVGaWx0ZXI7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuYm9va2llLkJvb2tpZUFjY2Vzc29yOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnV0aWwuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuem9va2VlcGVyLlpvb0tlZXBlcldhdGNoZXJC\nYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyRmFjdG9yeTsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLlprVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuTGVkZ2VyQ2FjaGVJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsK\naW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0\nOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1YWxz\nOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUaGlzIHRlc3QgdmVyaWZpZXMgdGhh\ndCB0aGUgcGVyaW9kIGNoZWNrIG9uIHRoZSBhdWRpdG9yCiAqIHdpbGwgcGlj\nayB1cCBvbiBtaXNzaW5nIGRhdGEgaW4gdGhlIGNsaWVudAogKi8KcHVibGlj\nIGNsYXNzIEF1ZGl0b3JQZXJpb2RpY0NoZWNrVGVzdCBleHRlbmRzIEJvb2tL\nZWVwZXJDbHVzdGVyVGVzdENhc2UgewogICAgcHJpdmF0ZSBmaW5hbCBzdGF0\naWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkKICAgICAgICAgICAgLmdl\ndExvZ2dlcihBdWRpdG9yUGVyaW9kaWNDaGVja1Rlc3QuY2xhc3MpOwoKICAg\nIHByaXZhdGUgSGFzaE1hcDxTdHJpbmcsIEF1ZGl0b3JFbGVjdG9yPiBhdWRp\ndG9yRWxlY3RvcnMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIEF1ZGl0b3JFbGVj\ndG9yPigpOwogICAgcHJpdmF0ZSBMaXN0PFpvb0tlZXBlcj4gemtDbGllbnRz\nID0gbmV3IExpbmtlZExpc3Q8Wm9vS2VlcGVyPigpOwoKICAgIHByaXZhdGUg\nZmluYWwgc3RhdGljIGludCBDSEVDS19JTlRFUlZBTCA9IDEwMDA7IC8vIHJ1\nbiBldmVyeSBzZWNvbmQKCiAgICBwdWJsaWMgQXVkaXRvclBlcmlvZGljQ2hl\nY2tUZXN0KCkgewogICAgICAgIHN1cGVyKDMpOwogICAgICAgIGJhc2VDb25m\nLnNldFBhZ2VMaW1pdCgxKTsgLy8gdG8gbWFrZSBpdCBlYXN5IHRvIHB1c2gg\nbGVkZ2VyIG91dCBvZiBjYWNoZQogICAgfQoKICAgIEBCZWZvcmUKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBzdXBlci5zZXRVcCgpOwoKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IG51bUJvb2tpZXM7IGkrKykgewogICAgICAgICAgICBT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJh\ndGlvbihic0NvbmZzLmdldChpKSk7CiAgICAgICAgICAgIGNvbmYuc2V0QXVk\naXRvclBlcmlvZGljQ2hlY2tJbnRlcnZhbChDSEVDS19JTlRFUlZBTCk7Cgog\nICAgICAgICAgICBTdHJpbmcgYWRkciA9IFN0cmluZ1V0aWxzLmFkZHJUb1N0\ncmluZyhicy5nZXQoaSkuZ2V0TG9jYWxBZGRyZXNzKCkpOwoKICAgICAgICAg\nICAgWm9vS2VlcGVyV2F0Y2hlckJhc2UgdyA9IG5ldyBab29LZWVwZXJXYXRj\naGVyQmFzZSgxMDAwMCk7CiAgICAgICAgICAgIFpvb0tlZXBlciB6ayA9IFpr\nVXRpbHMuY3JlYXRlQ29ubmVjdGVkWm9va2VlcGVyQ2xpZW50KAogICAgICAg\nICAgICAgICAgICAgIHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5n\nKCksIHcpOwogICAgICAgICAgICB6a0NsaWVudHMuYWRkKHprKTsKCiAgICAg\nICAgICAgIEF1ZGl0b3JFbGVjdG9yIGF1ZGl0b3JFbGVjdG9yID0gbmV3IEF1\nZGl0b3JFbGVjdG9yKGFkZHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmYsIHpr\nKTsKICAgICAgICAgICAgYXVkaXRvckVsZWN0b3JzLnB1dChhZGRyLCBhdWRp\ndG9yRWxlY3Rvcik7CiAgICAgICAgICAgIGF1ZGl0b3JFbGVjdG9yLnN0YXJ0\nKCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiU3RhcnRpbmcgQXVkaXRvciBF\nbGVjdG9yIik7CiAgICAgICAgfQogICAgfQoKICAgIEBBZnRlcgogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIGZvciAoQXVkaXRvckVsZWN0b3IgZSA6IGF1ZGl0\nb3JFbGVjdG9ycy52YWx1ZXMoKSkgewogICAgICAgICAgICBlLnNodXRkb3du\nKCk7CiAgICAgICAgfQogICAgICAgIGZvciAoWm9vS2VlcGVyIHprIDogemtD\nbGllbnRzKSB7CiAgICAgICAgICAgIHprLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgICAgIHprQ2xpZW50cy5jbGVhcigpOwogICAgICAgIHN1cGVyLnRlYXJE\nb3duKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiB0ZXN0IHRoYXQgdGhlIHBl\ncmlvZGljIGNoZWNraW5nIHdpbGwgZGV0ZWN0IGNvcnJ1cHRpb25zIGluCiAg\nICAgKiB0aGUgYm9va2llIGVudHJ5IGxvZwogICAgICovCiAgICBAVGVzdCh0\naW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEVudHJ5TG9nQ29y\ncnVwdGlvbigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExlZGdlck1h\nbmFnZXJGYWN0b3J5IG1GYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZhY3Rvcnku\nbmV3TGVkZ2VyTWFuYWdlckZhY3RvcnkoYnNDb25mcy5nZXQoMCksIHprYyk7\nCiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgdW5kZXJS\nZXBsaWNhdGlvbk1hbmFnZXIgPSBtRmFjdG9yeS5uZXdMZWRnZXJVbmRlcnJl\ncGxpY2F0aW9uTWFuYWdlcigpOwogICAgICAgIHVuZGVyUmVwbGljYXRpb25N\nYW5hZ2VyLmRpc2FibGVMZWRnZXJSZXBsaWNhdGlvbigpOwoKICAgICAgICBM\nZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIERpZ2Vz\ndFR5cGUuQ1JDMzIsICJwYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAgIGxv\nbmcgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgbGguYWRkRW50cnko\nInRlc3RkYXRhIi5nZXRCeXRlcygpKTsKICAgICAgICB9CiAgICAgICAgbGgu\nY2xvc2UoKTsKCiAgICAgICAgQm9va2llQWNjZXNzb3IuZm9yY2VGbHVzaChi\ncy5nZXQoMCkuZ2V0Qm9va2llKCkpOwoKCiAgICAgICAgRmlsZSBsZWRnZXJE\naXIgPSBic0NvbmZzLmdldCgwKS5nZXRMZWRnZXJEaXJzKClbMF07CiAgICAg\nICAgbGVkZ2VyRGlyID0gQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVk\nZ2VyRGlyKTsKICAgICAgICAvLyBjb3JydXB0IG9mIGVudHJ5TG9ncwogICAg\nICAgIEZpbGVbXSBlbnRyeUxvZ3MgPSBsZWRnZXJEaXIubGlzdEZpbGVzKG5l\ndyBGaWxlbmFtZUZpbHRlcigpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGFjY2VwdChGaWxlIGRpciwgU3RyaW5nIG5hbWUpIHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gbmFtZS5lbmRzV2l0aCgiLmxvZyIpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICBCeXRl\nQnVmZmVyIGp1bmsgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDEwMjQqMTAyNCk7\nCiAgICAgICAgZm9yIChGaWxlIGYgOiBlbnRyeUxvZ3MpIHsKICAgICAgICAg\nICAgRmlsZU91dHB1dFN0cmVhbSBvdXQgPSBuZXcgRmlsZU91dHB1dFN0cmVh\nbShmKTsKICAgICAgICAgICAgb3V0LmdldENoYW5uZWwoKS53cml0ZShqdW5r\nKTsKICAgICAgICAgICAgb3V0LmNsb3NlKCk7CiAgICAgICAgfQogICAgICAg\nIHJlc3RhcnRCb29raWVzKCk7IC8vIHJlc3RhcnQgdG8gY2xlYXIgcmVhZCBi\ndWZmZXJzCgogICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmVuYWJs\nZUxlZGdlclJlcGxpY2F0aW9uKCk7CiAgICAgICAgbG9uZyB1bmRlclJlcGxp\nY2F0ZWRMZWRnZXIgPSAtMTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIDEwOyBpKyspIHsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGVkTGVkZ2Vy\nID0gdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIucG9sbExlZGdlclRvUmVyZXBs\naWNhdGUoKTsKICAgICAgICAgICAgaWYgKHVuZGVyUmVwbGljYXRlZExlZGdl\nciAhPSAtMSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgVGhyZWFkLnNsZWVwKENIRUNLX0lOVEVSVkFMKTsK\nICAgICAgICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJMZWRnZXIgc2hvdWxk\nIGJlIHVuZGVyIHJlcGxpY2F0ZWQiLCBsZWRnZXJJZCwgdW5kZXJSZXBsaWNh\ndGVkTGVkZ2VyKTsKICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5j\nbG9zZSgpOwogICAgfQoKICAgIC8qKgogICAgICogdGVzdCB0aGF0IHRoZSBw\nZXJpb2QgY2hlY2tlciB3aWxsIGRldGVjdCBjb3JydXB0aW9ucyBpbgogICAg\nICogdGhlIGJvb2tpZSBpbmRleCBmaWxlcwogICAgICovCiAgICBAVGVzdCh0\naW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEluZGV4Q29ycnVw\ndGlvbigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExlZGdlck1hbmFn\nZXJGYWN0b3J5IG1GYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3\nTGVkZ2VyTWFuYWdlckZhY3RvcnkoYnNDb25mcy5nZXQoMCksIHprYyk7CiAg\nICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgdW5kZXJSZXBs\naWNhdGlvbk1hbmFnZXIgPSBtRmFjdG9yeS5uZXdMZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBi\na2MuY3JlYXRlTGVkZ2VyKDMsIDMsIERpZ2VzdFR5cGUuQ1JDMzIsICJwYXNz\nd2QiLmdldEJ5dGVzKCkpOwogICAgICAgIGxvbmcgbGVkZ2VyVG9Db3JydXB0\nID0gbGguZ2V0SWQoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEw\nMDsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KCJ0ZXN0ZGF0YSIu\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQogICAgICAgIGxoLmNsb3NlKCk7Cgog\nICAgICAgIC8vIHB1c2ggbGVkZ2VyVG9Db3JydXB0IG91dCBvZiBwYWdlIGNh\nY2hlIChib29raWUgaXMgY29uZmlndXJlZCB0byBvbmx5IHVzZSAxIHBhZ2Up\nCiAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIERpZ2VzdFR5\ncGUuQ1JDMzIsICJwYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgbGguYWRk\nRW50cnkoInRlc3RkYXRhIi5nZXRCeXRlcygpKTsKICAgICAgICB9CiAgICAg\nICAgbGguY2xvc2UoKTsKCiAgICAgICAgQm9va2llQWNjZXNzb3IuZm9yY2VG\nbHVzaChicy5nZXQoMCkuZ2V0Qm9va2llKCkpOwoKICAgICAgICBGaWxlIGxl\nZGdlckRpciA9IGJzQ29uZnMuZ2V0KDApLmdldExlZGdlckRpcnMoKVswXTsK\nICAgICAgICBsZWRnZXJEaXIgPSBCb29raWUuZ2V0Q3VycmVudERpcmVjdG9y\neShsZWRnZXJEaXIpOwoKICAgICAgICAvLyBjb3JydXB0IG9mIGVudHJ5TG9n\ncwogICAgICAgIEZpbGUgaW5kZXggPSBuZXcgRmlsZShsZWRnZXJEaXIsIExl\nZGdlckNhY2hlSW1wbC5nZXRMZWRnZXJOYW1lKGxlZGdlclRvQ29ycnVwdCkp\nOwogICAgICAgIExPRy5pbmZvKCJmaWxlIHRvIGNvcnJ1cHR7fSIgLCBpbmRl\neCk7CiAgICAgICAgQnl0ZUJ1ZmZlciBqdW5rID0gQnl0ZUJ1ZmZlci5hbGxv\nY2F0ZSgxMDI0KjEwMjQpOwogICAgICAgIEZpbGVPdXRwdXRTdHJlYW0gb3V0\nID0gbmV3IEZpbGVPdXRwdXRTdHJlYW0oaW5kZXgpOwogICAgICAgIG91dC5n\nZXRDaGFubmVsKCkud3JpdGUoanVuayk7CiAgICAgICAgb3V0LmNsb3NlKCk7\nCgogICAgICAgIGxvbmcgdW5kZXJSZXBsaWNhdGVkTGVkZ2VyID0gLTE7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAg\nICAgIHVuZGVyUmVwbGljYXRlZExlZGdlciA9IHVuZGVyUmVwbGljYXRpb25N\nYW5hZ2VyLnBvbGxMZWRnZXJUb1JlcmVwbGljYXRlKCk7CiAgICAgICAgICAg\nIGlmICh1bmRlclJlcGxpY2F0ZWRMZWRnZXIgIT0gLTEpIHsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFRocmVh\nZC5zbGVlcChDSEVDS19JTlRFUlZBTCk7CiAgICAgICAgfQogICAgICAgIGFz\nc2VydEVxdWFscygiTGVkZ2VyIHNob3VsZCBiZSB1bmRlciByZXBsaWNhdGVk\nIiwgbGVkZ2VyVG9Db3JydXB0LCB1bmRlclJlcGxpY2F0ZWRMZWRnZXIpOwog\nICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmNsb3NlKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgdGhlIHBlcmlvZCBjaGVja2Vy\nIHdpbGwgbm90IHJ1biB3aGVuIGF1dG8gcmVwbGljYXRpb24gaGFzIGJlZW4g\nZGlzYWJsZWQKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RQZXJpb2RpY0NoZWNrV2hlbkRpc2FibGVkKCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyTWFuYWdlckZhY3Rv\ncnkgbUZhY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJN\nYW5hZ2VyRmFjdG9yeShic0NvbmZzLmdldCgwKSwgemtjKTsKICAgICAgICBm\naW5hbCBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB1bmRlclJlcGxp\nY2F0aW9uTWFuYWdlciA9IG1GYWN0b3J5Lm5ld0xlZGdlclVuZGVycmVwbGlj\nYXRpb25NYW5hZ2VyKCk7CiAgICAgICAgZmluYWwgaW50IG51bUxlZGdlcnMg\nPSAxMDA7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtTGVkZ2Vy\nczsgaSsrKSB7CiAgICAgICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5j\ncmVhdGVMZWRnZXIoMywgMywgRGlnZXN0VHlwZS5DUkMzMiwgInBhc3N3ZCIu\nZ2V0Qnl0ZXMoKSk7CgogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8\nIDEwMDsgaisrKSB7CiAgICAgICAgICAgICAgICBsaC5hZGRFbnRyeSgidGVz\ndGRhdGEiLmdldEJ5dGVzKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGxoLmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIHVuZGVyUmVwbGljYXRp\nb25NYW5hZ2VyLmRpc2FibGVMZWRnZXJSZXBsaWNhdGlvbigpOwoKICAgICAg\nICBmaW5hbCBBdG9taWNJbnRlZ2VyIG51bVJlYWRzID0gbmV3IEF0b21pY0lu\ndGVnZXIoMCk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0g\na2lsbEJvb2tpZSgwKTsKCiAgICAgICAgQm9va2llIGRlYWRCb29raWUgPSBu\nZXcgQm9va2llKGNvbmYpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyBCeXRlQnVmZmVyIHJlYWRFbnRyeShsb25nIGxlZGdl\ncklkLCBsb25nIGVudHJ5SWQpCiAgICAgICAgICAgICAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uLCBOb0xlZGdlckV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICAvLyB3ZSB3YW50IHRvIGRpc2FibGUgZHVyaW5nIGNoZWNraW5nCiAg\nICAgICAgICAgICAgICBudW1SZWFkcy5pbmNyZW1lbnRBbmRHZXQoKTsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRmFrZSBJL08g\nZXhjZXB0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAg\nIGJzQ29uZnMuYWRkKGNvbmYpOwogICAgICAgIGJzLmFkZChzdGFydEJvb2tp\nZShjb25mLCBkZWFkQm9va2llKSk7CgogICAgICAgIFRocmVhZC5zbGVlcChD\nSEVDS19JTlRFUlZBTCAqIDIpOwogICAgICAgIGFzc2VydEVxdWFscygiTm90\naGluZyBzaG91bGQgaGF2ZSB0cmllZCB0byByZWFkIiwgMCwgbnVtUmVhZHMu\nZ2V0KCkpOwogICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmVuYWJs\nZUxlZGdlclJlcGxpY2F0aW9uKCk7CiAgICAgICAgVGhyZWFkLnNsZWVwKENI\nRUNLX0lOVEVSVkFMICogMik7IC8vIGdpdmUgaXQgdGltZSB0byBydW4KCiAg\nICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIuZGlzYWJsZUxlZGdlclJl\ncGxpY2F0aW9uKCk7CiAgICAgICAgLy8gZ2l2ZSBpdCB0aW1lIHRvIHN0b3As\nIGZyb20gdGhpcyBwb2ludCBub3RoaW5nIG5ldyBzaG91bGQgYmUgbWFya2Vk\nCiAgICAgICAgVGhyZWFkLnNsZWVwKENIRUNLX0lOVEVSVkFMICogMik7Cgog\nICAgICAgIGludCBudW1VbmRlcnJlcGxpY2F0ZWQgPSAwOwogICAgICAgIGxv\nbmcgdW5kZXJSZXBsaWNhdGVkTGVkZ2VyID0gLTE7CiAgICAgICAgZG8gewog\nICAgICAgICAgICB1bmRlclJlcGxpY2F0ZWRMZWRnZXIgPSB1bmRlclJlcGxp\nY2F0aW9uTWFuYWdlci5wb2xsTGVkZ2VyVG9SZXJlcGxpY2F0ZSgpOwogICAg\nICAgICAgICBpZiAodW5kZXJSZXBsaWNhdGVkTGVkZ2VyID09IC0xKSB7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBudW1VbmRlcnJlcGxpY2F0ZWQrKzsKCiAgICAgICAgICAgIHVuZGVyUmVw\nbGljYXRpb25NYW5hZ2VyLm1hcmtMZWRnZXJSZXBsaWNhdGVkKHVuZGVyUmVw\nbGljYXRlZExlZGdlcik7CiAgICAgICAgfSB3aGlsZSAodW5kZXJSZXBsaWNh\ndGVkTGVkZ2VyICE9IC0xKTsKCiAgICAgICAgVGhyZWFkLnNsZWVwKENIRUNL\nX0lOVEVSVkFMICogMik7IC8vIGdpdmUgYSBjaGFuY2UgdG8gcnVuIGFnYWlu\nIChpdCBzaG91bGRuJ3QsIGl0J3MgZGlzYWJsZWQpCgogICAgICAgIC8vIGVu\nc3VyZSB0aGF0IG5vdGhpbmcgaXMgbWFya2VkIGFzIHVuZGVycmVwbGljYXRl\nZAogICAgICAgIHVuZGVyUmVwbGljYXRlZExlZGdlciA9IHVuZGVyUmVwbGlj\nYXRpb25NYW5hZ2VyLnBvbGxMZWRnZXJUb1JlcmVwbGljYXRlKCk7CiAgICAg\nICAgYXNzZXJ0RXF1YWxzKCJUaGVyZSBzaG91bGQgYmUgbm8gdW5kZXJyZXBs\naWNhdGVkIGxlZGdlcnMiLCAtMSwgdW5kZXJSZXBsaWNhdGVkTGVkZ2VyKTsK\nCiAgICAgICAgTE9HLmluZm8oInt9IG9mIHt9IGxlZGdlcnMgdW5kZXJyZXBs\naWNhdGVkIiwgbnVtVW5kZXJyZXBsaWNhdGVkLCBudW1VbmRlcnJlcGxpY2F0\nZWQpOwogICAgICAgIGFzc2VydFRydWUoIkFsbCBzaG91bGQgYmUgdW5kZXJy\nZXBsaWNhdGVkIiwKICAgICAgICAgICAgICAgIG51bVVuZGVycmVwbGljYXRl\nZCA8PSBudW1MZWRnZXJzICYmIG51bVVuZGVycmVwbGljYXRlZCA+IDApOwog\nICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IHRoZSBwZXJpb2QgY2hl\nY2sgd2lsbCBzdWNjZWVkIGlmIGEgbGVkZ2VyIGlzIGRlbGV0ZWQgbWlkd2F5\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0UGVyaW9kaWNDaGVja1doZW5MZWRnZXJEZWxldGVkKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChBdWRpdG9yRWxlY3RvciBl\nIDogYXVkaXRvckVsZWN0b3JzLnZhbHVlcygpKSB7CiAgICAgICAgICAgIGUu\nc2h1dGRvd24oKTsKICAgICAgICB9CgogICAgICAgIGZpbmFsIGludCBudW1M\nZWRnZXJzID0gMTAwOwogICAgICAgIExpc3Q8TG9uZz4gaWRzID0gbmV3IExp\nbmtlZExpc3Q8TG9uZz4oKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAgICBMZWRnZXJIYW5kbGUg\nbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIERpZ2VzdFR5cGUuQ1JDMzIs\nICJwYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAgICAgICBpZHMuYWRkKGxo\nLmdldElkKCkpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IDEw\nOyBqKyspIHsKICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KCJ0ZXN0ZGF0\nYSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGgu\nY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgZmluYWwgQXVkaXRvciBhdWRp\ndG9yID0gbmV3IEF1ZGl0b3IoCiAgICAgICAgICAgICAgICBTdHJpbmdVdGls\ncy5hZGRyVG9TdHJpbmcoQm9va2llLmdldEJvb2tpZUFkZHJlc3MoYnNDb25m\ncy5nZXQoMCkpKSwKICAgICAgICAgICAgICAgIGJzQ29uZnMuZ2V0KDApLCB6\na2MpOwogICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gZXhjZXB0aW9uQ2F1\nZ2h0ID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAgICAgIGZpbmFs\nIENvdW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEp\nOwogICAgICAgIFRocmVhZCB0ID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBudW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGF1ZGl0b3IuY2hlY2tBbGxMZWRnZXJzKCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkNhdWdodCBleGNlcHRpb24gd2hpbGUgY2hlY2tpbmcgYWxsIGxlZGdl\ncnMiLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0aW9uQ2F1\nZ2h0LnNldCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgdC5zdGFydCgpOwog\nICAgICAgIGxhdGNoLmF3YWl0KCk7CiAgICAgICAgZm9yIChMb25nIGlkIDog\naWRzKSB7CiAgICAgICAgICAgIGJrYy5kZWxldGVMZWRnZXIoaWQpOwogICAg\nICAgIH0KICAgICAgICB0LmpvaW4oKTsKICAgICAgICBhc3NlcnRGYWxzZSgi\nU2hvdWxkbid0IGhhdmUgdGhyb3duIGV4Y2VwdGlvbiIsIGV4Y2VwdGlvbkNh\ndWdodC5nZXQoKSk7CiAgICB9Cn0K\n","encoding":"base64"}

