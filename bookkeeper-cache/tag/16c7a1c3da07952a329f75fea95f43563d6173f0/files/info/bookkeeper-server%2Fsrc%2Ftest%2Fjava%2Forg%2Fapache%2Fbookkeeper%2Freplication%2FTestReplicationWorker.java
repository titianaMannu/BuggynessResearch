{"sha":"450f871fe8173123295e40b116d523d8b850d2b0","node_id":"MDQ6QmxvYjE1NzU5NTY6NDUwZjg3MWZlODE3MzEyMzI5NWU0MGIxMTZkNTIzZDhiODUwZDJiMA==","size":22719,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/450f871fe8173123295e40b116d523d8b850d2b0","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZSAKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24gCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UgCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQgCiAqIAogKiAgIGh0dHA6Ly93\nd3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMCAKICogCiAqIFVu\nbGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8g\naW4gd3JpdGluZywgCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRo\nZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIAogKiAiQVMgSVMiIEJB\nU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkg\nCiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhl\nIExpY2Vuc2UgZm9yIHRoZSAKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJu\naW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyAKICogdW5kZXIgdGhl\nIExpY2Vuc2UuIAogKiAKICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnJlcGxpY2F0aW9uOwoKaW1wb3J0IGphdmEubmV0LkluZXRBZGRyZXNz\nOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0\naW9uOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5N\nYXAuRW50cnk7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQ2xpZW50VXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuTGVkZ2VyRW50cnk7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlQWRhcHRlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRn\nZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5tZXRhLkxlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0Lk11bHRpTGVkZ2VyTWFu\nYWdlclRlc3RDYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0\naWwuQm9va0tlZXBlckNvbnN0YW50czsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci51dGlsLlprVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuem9va2VlcGVyLlpvb0tlZXBlcldhdGNoZXJCYXNlOwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmp1\nbml0LlRlc3Q7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogVGVzdCB0aGUgUmVwbGlj\nYXRpb25Xcm9rZXIsIHdoZXJlIGl0IGhhcyB0byByZXBsaWNhdGUgdGhlIGZy\nYWdtZW50cyBmcm9tCiAqIGZhaWxlZCBCb29raWVzIHRvIGdpdmVuIHRhcmdl\ndCBCb29raWUuCiAqLwpwdWJsaWMgY2xhc3MgVGVzdFJlcGxpY2F0aW9uV29y\na2VyIGV4dGVuZHMgTXVsdGlMZWRnZXJNYW5hZ2VyVGVzdENhc2UgewoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGJ5dGVbXSBURVNUUEFTU1dEID0gInRl\nc3RwYXNzd2QiLmdldEJ5dGVzKCk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeQogICAgICAgICAgICAuZ2V0\nTG9nZ2VyKFRlc3RSZXBsaWNhdGlvbldvcmtlci5jbGFzcyk7CiAgICBwcml2\nYXRlIFN0cmluZyBiYXNlUGF0aCA9ICIiOwogICAgcHJpdmF0ZSBMZWRnZXJN\nYW5hZ2VyRmFjdG9yeSBtRmFjdG9yeTsKICAgIHByaXZhdGUgTGVkZ2VyVW5k\nZXJyZXBsaWNhdGlvbk1hbmFnZXIgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXI7\nCiAgICBwcml2YXRlIHN0YXRpYyBieXRlW10gZGF0YSA9ICJUZXN0UmVwbGlj\nYXRpb25Xb3JrZXIiLmdldEJ5dGVzKCk7CgogICAgcHVibGljIFRlc3RSZXBs\naWNhdGlvbldvcmtlcihTdHJpbmcgbGVkZ2VyTWFuYWdlckZhY3RvcnkpIHsK\nICAgICAgICBzdXBlcigzKTsKICAgICAgICBMT0cuaW5mbygiUnVubmluZyB0\nZXN0IGNhc2UgdXNpbmcgbGVkZ2VyIG1hbmFnZXIgOiAiCiAgICAgICAgICAg\nICAgICArIGxlZGdlck1hbmFnZXJGYWN0b3J5KTsKICAgICAgICAvLyBzZXQg\nbGVkZ2VyIG1hbmFnZXIgbmFtZQogICAgICAgIGJhc2VDb25mLnNldExlZGdl\nck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKGxlZGdlck1hbmFnZXJGYWN0b3J5\nKTsKICAgICAgICBiYXNlQ2xpZW50Q29uZi5zZXRMZWRnZXJNYW5hZ2VyRmFj\ndG9yeUNsYXNzTmFtZShsZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAgICAgICAg\nYmFzZVBhdGggPSBiYXNlQ2xpZW50Q29uZi5nZXRaa0xlZGdlcnNSb290UGF0\naCgpICsgJy8nCiAgICAgICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFu\ndHMuVU5ERVJfUkVQTElDQVRJT05fTk9ERQogICAgICAgICAgICAgICAgKyBC\nb29rS2VlcGVyQ29uc3RhbnRzLkRFRkFVTFRfWktfTEVER0VSU19ST09UX1BB\nVEg7CiAgICAgICAgYmFzZUNvbmYuc2V0UmVyZXBsaWNhdGlvbkVudHJ5QmF0\nY2hTaXplKDMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5z\nZXRVcCgpOwogICAgICAgIC8vIGluaXRpYWxpemUgdXJSZXBsaWNhdGlvbk1h\nbmFnZXIKICAgICAgICBtRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0b3J5\nLm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGJhc2VDbGllbnRDb25mLAogICAg\nICAgICAgICAgICAgemtjKTsKICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFu\nYWdlciA9IG1GYWN0b3J5Lm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5h\nZ2VyKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCB0\nZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHN1cGVyLnRl\nYXJEb3duKCk7CiAgICAgICAgaWYobnVsbCAhPSBtRmFjdG9yeSl7CiAgICAg\nICAgICAgIG1GYWN0b3J5LnVuaW5pdGlhbGl6ZSgpOwogICAgICAgICAgICBt\nRmFjdG9yeSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmKG51bGwgIT0g\ndW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIpewogICAgICAgICAgICB1bmRlclJl\ncGxpY2F0aW9uTWFuYWdlci5jbG9zZSgpOwogICAgICAgICAgICB1bmRlclJl\ncGxpY2F0aW9uTWFuYWdlciA9IG51bGw7CiAgICAgICAgfQogICAgfQogICAg\nCiAgICAvKioKICAgICAqIFRlc3RzIHRoYXQgcmVwbGljYXRpb24gd29ya2Vy\nIHNob3VsZCByZXBsaWNhdGUgdGhlIGZhaWxlZCBib29raWUKICAgICAqIGZy\nYWdtZW50cyB0byB0YXJnZXQgYm9va2llIGdpdmVuIHRvIHRoZSB3b3JrZXIu\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAzMDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RSV1Nob3VsZFJlcGxpY2F0ZUZyYWdtZW50c1RvVGFyZ2V0\nQm9va2llKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBCb29rS2VlcGVyLkRp\nZ2VzdFR5cGUuQ1JDMzIsCiAgICAgICAgICAgICAgICBURVNUUEFTU1dEKTsK\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAg\nICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAgICBJ\nbmV0U29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsID0gTGVkZ2VySGFuZGxl\nQWRhcHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxo\nKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKCiAgICAgICAgTE9H\nLmluZm8oIktpbGxpbmcgQm9va2llIiwgcmVwbGljYVRvS2lsbCk7CiAgICAg\nICAga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsKTsKCiAgICAgICAgaW50IHN0\nYXJ0TmV3Qm9va2llID0gc3RhcnROZXdCb29raWUoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgbGguYWRk\nRW50cnkoZGF0YSk7CiAgICAgICAgfQoKICAgICAgICBJbmV0U29ja2V0QWRk\ncmVzcyBuZXdCa0FkZHIgPSBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFk\nZHJlc3MKICAgICAgICAgICAgICAgIC5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0\nQWRkcmVzcygpLCBzdGFydE5ld0Jvb2tpZSk7CiAgICAgICAgTE9HLmluZm8o\nIk5ldyBCb29raWUgYWRkciA6IiArIG5ld0JrQWRkcik7CgogICAgICAgIFJl\ncGxpY2F0aW9uV29ya2VyIHJ3ID0gbmV3IFJlcGxpY2F0aW9uV29ya2VyKHpr\nYywgYmFzZUNvbmYsIG5ld0JrQWRkcik7CgogICAgICAgIHJ3LnN0YXJ0KCk7\nCiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRpb25N\nYW5hZ2VyLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGguZ2V0SWQoKSwK\nICAgICAgICAgICAgICAgICAgICByZXBsaWNhVG9LaWxsLnRvU3RyaW5nKCkp\nOwoKICAgICAgICAgICAgd2hpbGUgKFJlcGxpY2F0aW9uVGVzdFV0aWwuaXNM\nZWRnZXJJblVuZGVyUmVwbGljYXRpb24oemtjLCBsaAogICAgICAgICAgICAg\nICAgICAgIC5nZXRJZCgpLCBiYXNlUGF0aCkpIHsKICAgICAgICAgICAgICAg\nIFRocmVhZC5zbGVlcCgxMDApOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBraWxsQWxsQm9va2llcyhsaCwgbmV3QmtBZGRyKTsKCiAgICAgICAgICAg\nIC8vIFNob3VsZCBiZSBhYmxlIHRvIHJlYWQgdGhlIGVudHJpZXMgZnJvbSAw\nLTkKICAgICAgICAgICAgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaCwgMCwg\nOSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcncuc2h1dGRv\nd24oKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0cyB0\naGF0IHJlcGxpY2F0aW9uIHdvcmtlciBzaG91bGQgcmV0cnkgZm9yIHJlcGxp\nY2F0aW9uIHVudGlsIGVub3VnaAogICAgICogYm9va2llcyBhdmFpbGFibGUg\nZm9yIHJlcGxpY2F0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSV1Nob3VsZFJldHJ5VW50aWxU\naGVyZUFyZUVub3VnaEJrc0F2YWlsYWJsZUZvclJlcGxpY2F0aW9uKCkKICAg\nICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigxLCAxLCBCb29rS2VlcGVyLkRp\nZ2VzdFR5cGUuQ1JDMzIsCiAgICAgICAgICAgICAgICBURVNUUEFTU1dEKTsK\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAg\nICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAgICBs\naC5jbG9zZSgpOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIHJlcGxpY2FU\nb0tpbGwgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAu\nZ2V0TGVkZ2VyTWV0YWRhdGEobGgpLmdldEVuc2VtYmxlcygpLmdldCgwTCku\nZ2V0KDApOwogICAgICAgIExPRy5pbmZvKCJLaWxsaW5nIEJvb2tpZSIsIHJl\ncGxpY2FUb0tpbGwpOwogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24ga2ls\nbGVkQm9va2llQ29uZmlnID0ga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsKTsK\nCiAgICAgICAgaW50IHN0YXJ0TmV3Qm9va2llID0gc3RhcnROZXdCb29raWUo\nKTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBuZXdCa0FkZHIgPSBuZXcg\nSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MKICAgICAgICAgICAgICAg\nIC5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBzdGFydE5ld0Jv\nb2tpZSk7CiAgICAgICAgTE9HLmluZm8oIk5ldyBCb29raWUgYWRkciA6IiAr\nIG5ld0JrQWRkcik7CgogICAgICAgIGtpbGxBbGxCb29raWVzKGxoLCBuZXdC\na0FkZHIpOwogICAgICAgIFJlcGxpY2F0aW9uV29ya2VyIHJ3ID0gbmV3IFJl\ncGxpY2F0aW9uV29ya2VyKHprYywgYmFzZUNvbmYsIG5ld0JrQWRkcik7Cgog\nICAgICAgIHJ3LnN0YXJ0KCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ndW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdlclVuZGVycmVwbGlj\nYXRlZChsaC5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgIHJlcGxpY2FU\nb0tpbGwudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGludCBjb3VudGVyID0g\nMTAwOwogICAgICAgICAgICB3aGlsZSAoY291bnRlci0tID4gMCkgewogICAg\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRXhwZWN0aW5nIHRoYXQgcmVwbGlj\nYXRpb24gc2hvdWxkIG5vdCBjb21wbGV0ZSIsCiAgICAgICAgICAgICAgICAg\nICAgICAgIFJlcGxpY2F0aW9uVGVzdFV0aWwuaXNMZWRnZXJJblVuZGVyUmVw\nbGljYXRpb24oemtjLCBsaAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC5nZXRJZCgpLCBiYXNlUGF0aCkpOwogICAgICAgICAgICAgICAgVGhy\nZWFkLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g\ncmVzdGFydCBraWxsZWQgYm9va2llCiAgICAgICAgICAgIGJzLmFkZChzdGFy\ndEJvb2tpZShraWxsZWRCb29raWVDb25maWcpKTsKICAgICAgICAgICAgYnND\nb25mcy5hZGQoa2lsbGVkQm9va2llQ29uZmlnKTsKICAgICAgICAgICAgd2hp\nbGUgKFJlcGxpY2F0aW9uVGVzdFV0aWwuaXNMZWRnZXJJblVuZGVyUmVwbGlj\nYXRpb24oemtjLCBsaAogICAgICAgICAgICAgICAgICAgIC5nZXRJZCgpLCBi\nYXNlUGF0aCkpIHsKICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDAp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIFNob3VsZCBiZSBhYmxl\nIHRvIHJlYWQgdGhlIGVudHJpZXMgZnJvbSAwLTkKICAgICAgICAgICAgdmVy\naWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaCwgMCwgOSk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgcncuc2h1dGRvd24oKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUZXN0cyB0aGF0IHJlcGxpY2F0aW9uIHdv\ncmtlcjEgc2hvdWxkIHRha2Ugb25lIGZyYWdtZW50IHJlcGxpY2F0aW9uIGFu\nZAogICAgICogb3RoZXIgcmVwbGljYXRpb24gd29ya2VyIGFsc28gc2hvdWxk\nIGNvbXBldGUgZm9yIHRoZSByZXBsaWNhdGlvbi4KICAgICAqLwogICAgQFRl\nc3QodGltZW91dCA9IDkwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdDJSV3NT\naG91bGRDb21wZXRlRm9yUmVwbGljYXRpb25PZjJGcmFnbWVudHNBbmRDb21w\nbGV0ZVJlcGxpY2F0aW9uKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdl\ncigyLCAyLCBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsCiAgICAgICAg\nICAgICAgICBURVNUUEFTU1dEKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEp\nOwogICAgICAgIH0KICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwgPSBMZWRnZXJIYW5kbGVBZGFw\ndGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEobGgpLmdl\ndEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwogICAgICAgIExPRy5pbmZv\nKCJLaWxsaW5nIEJvb2tpZSIsIHJlcGxpY2FUb0tpbGwpOwogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24ga2lsbGVkQm9va2llQ29uZmlnID0ga2lsbEJv\nb2tpZShyZXBsaWNhVG9LaWxsKTsKCiAgICAgICAga2lsbEFsbEJvb2tpZXMo\nbGgsIG51bGwpOwogICAgICAgIC8vIFN0YXJ0ZSBSVzEKICAgICAgICBpbnQg\nc3RhcnROZXdCb29raWUxID0gc3RhcnROZXdCb29raWUoKTsKICAgICAgICBJ\nbmV0U29ja2V0QWRkcmVzcyBuZXdCa0FkZHIxID0gbmV3IEluZXRTb2NrZXRB\nZGRyZXNzKEluZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAuZ2V0TG9jYWxI\nb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29raWUxKTsKICAg\nICAgICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoiICsgbmV3QmtBZGRy\nMSk7CiAgICAgICAgUmVwbGljYXRpb25Xb3JrZXIgcncxID0gbmV3IFJlcGxp\nY2F0aW9uV29ya2VyKHprYywgYmFzZUNvbmYsIG5ld0JrQWRkcjEpOwoKICAg\nICAgICAvLyBTdGFydGUgUlcyCiAgICAgICAgaW50IHN0YXJ0TmV3Qm9va2ll\nMiA9IHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJl\nc3MgbmV3QmtBZGRyMiA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRk\ncmVzcwogICAgICAgICAgICAgICAgLmdldExvY2FsSG9zdCgpLmdldEhvc3RB\nZGRyZXNzKCksIHN0YXJ0TmV3Qm9va2llMik7CiAgICAgICAgTE9HLmluZm8o\nIk5ldyBCb29raWUgYWRkciA6IiArIG5ld0JrQWRkcjIpOwogICAgICAgIFpv\nb0tlZXBlcldhdGNoZXJCYXNlIHcgPSBuZXcgWm9vS2VlcGVyV2F0Y2hlckJh\nc2UoMTAwMDApOwogICAgICAgIFpvb0tlZXBlciB6a2MxID0gWmtVdGlscy5j\ncmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGllbnQoCiAgICAgICAgICAgICAg\nICB6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLCB3KTsKICAg\nICAgICBSZXBsaWNhdGlvbldvcmtlciBydzIgPSBuZXcgUmVwbGljYXRpb25X\nb3JrZXIoemtjMSwgYmFzZUNvbmYsCiAgICAgICAgICAgICAgICBuZXdCa0Fk\nZHIyKTsKICAgICAgICBydzEuc3RhcnQoKTsKICAgICAgICBydzIuc3RhcnQo\nKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlv\nbk1hbmFnZXIubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsaC5nZXRJZCgp\nLAogICAgICAgICAgICAgICAgICAgIHJlcGxpY2FUb0tpbGwudG9TdHJpbmco\nKSk7CiAgICAgICAgICAgIGludCBjb3VudGVyID0gMTA7CiAgICAgICAgICAg\nIHdoaWxlIChjb3VudGVyLS0gPiAwKSB7CiAgICAgICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJFeHBlY3RpbmcgdGhhdCByZXBsaWNhdGlvbiBzaG91bGQgbm90\nIGNvbXBsZXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAgUmVwbGljYXRp\nb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxo\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldElkKCksIGJh\nc2VQYXRoKSk7CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXN0YXJ0IGtpbGxlZCBi\nb29raWUKICAgICAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2llKGtpbGxlZEJv\nb2tpZUNvbmZpZykpOwogICAgICAgICAgICBic0NvbmZzLmFkZChraWxsZWRC\nb29raWVDb25maWcpOwogICAgICAgICAgICB3aGlsZSAoUmVwbGljYXRpb25U\nZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxoCiAg\nICAgICAgICAgICAgICAgICAgLmdldElkKCksIGJhc2VQYXRoKSkgewogICAg\nICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgLy8gU2hvdWxkIGJlIGFibGUgdG8gcmVhZCB0aGUgZW50\ncmllcyBmcm9tIDAtOQogICAgICAgICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRn\nZXJzKGxoLCAwLCA5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBydzEuc2h1dGRvd24oKTsKICAgICAgICAgICAgcncyLnNodXRkb3duKCk7\nCiAgICAgICAgICAgIHprYzEuY2xvc2UoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUZXN0cyB0aGF0IFJlcGxpY2F0aW9uIHdvcmtlciBz\naG91bGQgY2xlYW4gdGhlIGxlYWRnZXIgdW5kZXIgcmVwbGljYXRpb24KICAg\nICAqIG5vZGUgb2YgdGhlIGxlZGdlciBhbHJlYWR5IGRlbGV0ZWQKICAgICAq\nLwogICAgQFRlc3QodGltZW91dCA9IDMwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0UldTaG91bGRDbGVhblRoZUxlZGdlckZyb21VbmRlclJlcGxpY2F0aW9u\nSWZMZWRnZXJBbHJlYWR5RGVsZXRlZCgpCiAgICAgICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVh\ndGVMZWRnZXIoMiwgMiwgQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMyLAog\nICAgICAgICAgICAgICAgVEVTVFBBU1NXRCk7CgogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRy\neShkYXRhKTsKICAgICAgICB9CiAgICAgICAgbGguY2xvc2UoKTsKICAgICAg\nICBJbmV0U29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsID0gTGVkZ2VySGFu\nZGxlQWRhcHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRh\nKGxoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKICAgICAgICBM\nT0cuaW5mbygiS2lsbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxsKTsKICAg\nICAgICBraWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICBpbnQg\nc3RhcnROZXdCb29raWUgPSBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIElu\nZXRTb2NrZXRBZGRyZXNzIG5ld0JrQWRkciA9IG5ldyBJbmV0U29ja2V0QWRk\ncmVzcyhJbmV0QWRkcmVzcwogICAgICAgICAgICAgICAgLmdldExvY2FsSG9z\ndCgpLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3Qm9va2llKTsKICAgICAg\nICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoiICsgbmV3QmtBZGRyKTsK\nICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydyA9IG5ldyBSZXBsaWNhdGlv\nbldvcmtlcih6a2MsIGJhc2VDb25mLCBuZXdCa0FkZHIpOwogICAgICAgIHJ3\nLnN0YXJ0KCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJrYy5kZWxl\ndGVMZWRnZXIobGguZ2V0SWQoKSk7IC8vIERlbGV0aW5nIHRoZSBsZWRnZXIK\nICAgICAgICAgICAgLy8gQWxzbyBtYXJrIGxlZGdlciBhcyBpbiBVbmRlclJl\ncGxpY2F0aW9uCiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2Vy\nLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGguZ2V0SWQoKSwKICAgICAg\nICAgICAgICAgICAgICByZXBsaWNhVG9LaWxsLnRvU3RyaW5nKCkpOwogICAg\nICAgICAgICB3aGlsZSAoUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlcklu\nVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxoCiAgICAgICAgICAgICAgICAgICAg\nLmdldElkKCksIGJhc2VQYXRoKSkgewogICAgICAgICAgICAgICAgVGhyZWFk\nLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBydy5zaHV0ZG93bigpOwogICAgICAgIH0KCiAgICB9\nCgogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdE11bHRpcGxlTGVkZ2VyUmVwbGljYXRpb25XaXRoUmVwbGljYXRpb25X\nb3JrZXIoKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAvLyBMZWRnZXIxCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoMSA9IGJrYy5j\ncmVhdGVMZWRnZXIoMywgMywgQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMy\nLAogICAgICAgICAgICAgICAgVEVTVFBBU1NXRCk7CgogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaDEuYWRk\nRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIEluZXRTb2NrZXRBZGRy\nZXNzIHJlcGxpY2FUb0tpbGxGcm9tRmlyc3RMZWRnZXIgPSBMZWRnZXJIYW5k\nbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEo\nbGgxKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKCiAgICAgICAg\nTE9HLmluZm8oIktpbGxpbmcgQm9va2llIiwgcmVwbGljYVRvS2lsbEZyb21G\naXJzdExlZGdlcik7CgogICAgICAgIC8vIExlZGdlcjIKICAgICAgICBMZWRn\nZXJIYW5kbGUgbGgyID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBCb29rS2Vl\ncGVyLkRpZ2VzdFR5cGUuQ1JDMzIsCiAgICAgICAgICAgICAgICBURVNUUEFT\nU1dEKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7\nCiAgICAgICAgICAgIGxoMi5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAg\nICAgICAgSW5ldFNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbEZyb21TZWNv\nbmRMZWRnZXIgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAg\nICAuZ2V0TGVkZ2VyTWV0YWRhdGEobGgyKS5nZXRFbnNlbWJsZXMoKS5nZXQo\nMEwpLmdldCgwKTsKCiAgICAgICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2ll\nIiwgcmVwbGljYVRvS2lsbEZyb21TZWNvbmRMZWRnZXIpOwoKICAgICAgICAv\nLyBLaWxsIGxlZGdlcjEKICAgICAgICBraWxsQm9va2llKHJlcGxpY2FUb0tp\nbGxGcm9tRmlyc3RMZWRnZXIpOwogICAgICAgIGxoMS5jbG9zZSgpOwogICAg\nICAgIC8vIEtpbGwgbGVkZ2VyMgogICAgICAgIGtpbGxCb29raWUocmVwbGlj\nYVRvS2lsbEZyb21GaXJzdExlZGdlcik7CiAgICAgICAgbGgyLmNsb3NlKCk7\nCgogICAgICAgIGludCBzdGFydE5ld0Jvb2tpZSA9IHN0YXJ0TmV3Qm9va2ll\nKCk7CgogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIG5ld0JrQWRkciA9IG5l\ndyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcwogICAgICAgICAgICAg\nICAgLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3\nQm9va2llKTsKICAgICAgICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoi\nICsgbmV3QmtBZGRyKTsKCiAgICAgICAgUmVwbGljYXRpb25Xb3JrZXIgcncg\nPSBuZXcgUmVwbGljYXRpb25Xb3JrZXIoemtjLCBiYXNlQ29uZiwgbmV3QmtB\nZGRyKTsKCiAgICAgICAgcncuc3RhcnQoKTsKICAgICAgICB0cnkgewoKICAg\nICAgICAgICAgLy8gTWFyayBsZWRnZXIxIGFuZCAyIGFzIHVuZGVycmVwbGlj\nYXRlZAogICAgICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5tYXJr\nTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxoMS5nZXRJZCgpLAogICAgICAgICAg\nICAgICAgICAgIHJlcGxpY2FUb0tpbGxGcm9tRmlyc3RMZWRnZXIudG9TdHJp\nbmcoKSk7CiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLm1h\ncmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGgyLmdldElkKCksCiAgICAgICAg\nICAgICAgICAgICAgcmVwbGljYVRvS2lsbEZyb21TZWNvbmRMZWRnZXIudG9T\ndHJpbmcoKSk7CgogICAgICAgICAgICB3aGlsZSAoUmVwbGljYXRpb25UZXN0\nVXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxoMQogICAg\nICAgICAgICAgICAgICAgIC5nZXRJZCgpLCBiYXNlUGF0aCkpIHsKICAgICAg\nICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDApOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICB3aGlsZSAoUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdl\nckluVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxoMgogICAgICAgICAgICAgICAg\nICAgIC5nZXRJZCgpLCBiYXNlUGF0aCkpIHsKICAgICAgICAgICAgICAgIFRo\ncmVhZC5zbGVlcCgxMDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBr\naWxsQWxsQm9va2llcyhsaDEsIG5ld0JrQWRkcik7CgogICAgICAgICAgICAv\nLyBTaG91bGQgYmUgYWJsZSB0byByZWFkIHRoZSBlbnRyaWVzIGZyb20gMC05\nCiAgICAgICAgICAgIHZlcmlmeVJlY292ZXJlZExlZGdlcnMobGgxLCAwLCA5\nKTsKICAgICAgICAgICAgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaDIsIDAs\nIDkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJ3LnNodXRk\nb3duKCk7CiAgICAgICAgfQoKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBU\nZXN0cyB0aGF0IFJlcGxpY2F0aW9uV29ya2VyIHNob3VsZCBmZW5jZSB0aGUg\nbGVkZ2VyIGFuZCByZWxlYXNlIGxlZGdlcgogICAgICogbG9jayBhZnRlciB0\naW1lb3V0LiBUaGVuIHJlcGxpY2F0aW9uIHNob3VsZCBoYXBwZW4gbm9ybWFs\nbHkuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RSV1Nob3VsZFJlcGxpY2F0ZVRoZUxlZGdlcnNBZnRl\nclRpbWVvdXRJZkxhc3RGcmFnbWVudElzVVIoKQogICAgICAgICAgICB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2Mu\nY3JlYXRlTGVkZ2VyKDMsIDMsIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMz\nMiwKICAgICAgICAgICAgICAgIFRFU1RQQVNTV0QpOwoKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgbGguYWRk\nRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIEluZXRTb2NrZXRBZGRy\nZXNzIHJlcGxpY2FUb0tpbGwgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAg\nICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEobGgpLmdldEVuc2VtYmxl\ncygpLmdldCgwTCkuZ2V0KDApOwoKICAgICAgICBMT0cuaW5mbygiS2lsbGlu\nZyBCb29raWUiLCByZXBsaWNhVG9LaWxsKTsKICAgICAgICBraWxsQm9va2ll\nKHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICBpbnQgc3RhcnROZXdCb29raWUg\nPSBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICBJbmV0U29ja2V0QWRkcmVz\ncyBuZXdCa0FkZHIgPSBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFkZHJl\nc3MKICAgICAgICAgICAgICAgIC5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRk\ncmVzcygpLCBzdGFydE5ld0Jvb2tpZSk7CiAgICAgICAgTE9HLmluZm8oIk5l\ndyBCb29raWUgYWRkciA6IiArIG5ld0JrQWRkcik7CgogICAgICAgIFJlcGxp\nY2F0aW9uV29ya2VyIHJ3ID0gbmV3IFJlcGxpY2F0aW9uV29ya2VyKHprYywg\nYmFzZUNvbmYsIG5ld0JrQWRkcik7CgogICAgICAgIExlZGdlck1hbmFnZXJG\nYWN0b3J5IG1GYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkKICAgICAg\nICAgICAgICAgIC5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeShiYXNlQ2xpZW50\nQ29uZiwgemtjKTsKICAgICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFu\nYWdlciB1bmRlclJlcGxpY2F0aW9uTWFuYWdlciA9IG1GYWN0b3J5CiAgICAg\nICAgICAgICAgICAubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIo\nKTsKICAgICAgICBydy5zdGFydCgpOwogICAgICAgIHRyeSB7CgogICAgICAg\nICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5tYXJrTGVkZ2VyVW5kZXJy\nZXBsaWNhdGVkKGxoLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgcmVw\nbGljYVRvS2lsbC50b1N0cmluZygpKTsKICAgICAgICAgICAgd2hpbGUgKFJl\ncGxpY2F0aW9uVGVzdFV0aWwuaXNMZWRnZXJJblVuZGVyUmVwbGljYXRpb24o\nemtjLCBsaAogICAgICAgICAgICAgICAgICAgIC5nZXRJZCgpLCBiYXNlUGF0\naCkpIHsKICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDApOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGtpbGxBbGxCb29raWVzKGxoLCBuZXdC\na0FkZHIpOwogICAgICAgICAgICAvLyBTaG91bGQgYmUgYWJsZSB0byByZWFk\nIHRoZSBlbnRyaWVzIGZyb20gMC05CiAgICAgICAgICAgIHZlcmlmeVJlY292\nZXJlZExlZGdlcnMobGgsIDAsIDkpOwogICAgICAgICAgICBsaCA9IGJrYy5v\ncGVuTGVkZ2VyTm9SZWNvdmVyeShsaC5nZXRJZCgpLAogICAgICAgICAgICAg\nICAgICAgIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwgVEVTVFBBU1NX\nRCk7CiAgICAgICAgICAgIGFzc2VydEZhbHNlKCJMZWRnZXIgbXVzdCBoYXZl\nIGJlZW4gY2xvc2VkIGJ5IFJXIiwgQ2xpZW50VXRpbAogICAgICAgICAgICAg\nICAgICAgIC5pc0xlZGdlck9wZW4obGgpKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBydy5zaHV0ZG93bigpOwogICAgICAgICAgICB1bmRl\nclJlcGxpY2F0aW9uTWFuYWdlci5jbG9zZSgpOwogICAgICAgIH0KCiAgICB9\nCgogICAgLyoqCiAgICAgKiBUZXN0cyB0aGF0IFJlcGxpY2F0aW9uV29ya2Vy\nIHNob3VsZCBub3QgaGF2ZSBpZGVudGlmaWVkIGZvciBwb3N0cG9uaW5nCiAg\nICAgKiB0aGUgcmVwbGljYXRpb24gaWYgbGVkZ2VyIGlzIGluIG9wZW4gc3Rh\ndGUgYW5kIGxhc3RGcmFnbWVudCBpcyBub3QgaW4KICAgICAqIHVuZGVyUmVw\nbGljYXRpb24gc3RhdGUuIE5vdGUgdGhhdCBSVyBzaG91bGQgbm90IGZlbmNl\nIHN1Y2ggbGVkZ2Vycy4KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDMw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFJXU2hvdWxkUmVwbGljYXRlVGhl\nTGVkZ2Vyc0FmdGVyVGltZW91dElmTGFzdEZyYWdtZW50SXNOb3RVUigpCiAg\nICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExlZGdlckhh\nbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoMywgMywgQm9va0tlZXBlci5E\naWdlc3RUeXBlLkNSQzMyLAogICAgICAgICAgICAgICAgVEVTVFBBU1NXRCk7\nCgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAg\nICAgICAgICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAgICAgICAg\nSW5ldFNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbCA9IExlZGdlckhhbmRs\nZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShs\naCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQoMCk7CgogICAgICAgIExP\nRy5pbmZvKCJLaWxsaW5nIEJvb2tpZSIsIHJlcGxpY2FUb0tpbGwpOwogICAg\nICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbCk7CgogICAgICAgIGludCBz\ndGFydE5ld0Jvb2tpZSA9IHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAgIC8v\nIFJlZm9ybSBlbnNlbWJsZS4uLk1ha2luZyBzdXJlIHRoYXQgbGFzdCBmcmFn\nbWVudCBpcyBub3QgaW4KICAgICAgICAvLyB1bmRlci1yZXBsaWNhdGlvbgog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAg\nICAgICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CgogICAgICAgIElu\nZXRTb2NrZXRBZGRyZXNzIG5ld0JrQWRkciA9IG5ldyBJbmV0U29ja2V0QWRk\ncmVzcyhJbmV0QWRkcmVzcwogICAgICAgICAgICAgICAgLmdldExvY2FsSG9z\ndCgpLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3Qm9va2llKTsKICAgICAg\nICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoiICsgbmV3QmtBZGRyKTsK\nCiAgICAgICAgUmVwbGljYXRpb25Xb3JrZXIgcncgPSBuZXcgUmVwbGljYXRp\nb25Xb3JrZXIoemtjLCBiYXNlQ29uZiwgbmV3QmtBZGRyKTsKCiAgICAgICAg\nTGVkZ2VyTWFuYWdlckZhY3RvcnkgbUZhY3RvcnkgPSBMZWRnZXJNYW5hZ2Vy\nRmFjdG9yeQogICAgICAgICAgICAgICAgLm5ld0xlZGdlck1hbmFnZXJGYWN0\nb3J5KGJhc2VDbGllbnRDb25mLCB6a2MpOwogICAgICAgIExlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyID0g\nbUZhY3RvcnkKICAgICAgICAgICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICBydy5zdGFydCgpOwogICAgICAg\nIHRyeSB7CgogICAgICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5t\nYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxoLmdldElkKCksCiAgICAgICAg\nICAgICAgICAgICAgcmVwbGljYVRvS2lsbC50b1N0cmluZygpKTsKICAgICAg\nICAgICAgd2hpbGUgKFJlcGxpY2F0aW9uVGVzdFV0aWwuaXNMZWRnZXJJblVu\nZGVyUmVwbGljYXRpb24oemtjLCBsaAogICAgICAgICAgICAgICAgICAgIC5n\nZXRJZCgpLCBiYXNlUGF0aCkpIHsKICAgICAgICAgICAgICAgIFRocmVhZC5z\nbGVlcCgxMDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBraWxsQWxs\nQm9va2llcyhsaCwgbmV3QmtBZGRyKTsKCiAgICAgICAgICAgIC8vIFNob3Vs\nZCBiZSBhYmxlIHRvIHJlYWQgdGhlIGVudHJpZXMgZnJvbSAwLTkKICAgICAg\nICAgICAgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaCwgMCwgOSk7CiAgICAg\nICAgICAgIGxoID0gYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxoLmdldElk\nKCksCiAgICAgICAgICAgICAgICAgICAgQm9va0tlZXBlci5EaWdlc3RUeXBl\nLkNSQzMyLCBURVNUUEFTU1dEKTsKCiAgICAgICAgICAgIC8vIExlZGdlciBz\naG91bGQgYmUgc3RpbGwgaW4gb3BlbiBzdGF0ZQogICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJMZWRnZXIgbXVzdCBoYXZlIGJlZW4gY2xvc2VkIGJ5IFJXIiwg\nQ2xpZW50VXRpbAogICAgICAgICAgICAgICAgICAgIC5pc0xlZGdlck9wZW4o\nbGgpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBydy5zaHV0\nZG93bigpOwogICAgICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5j\nbG9zZSgpOwogICAgICAgIH0KCiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0\nIHRoYXQgaWYgdGhlIGxvY2FsIGJvb2tpZSB0dXJucyBvdXQgdG8gYmUgcmVh\nZG9ubHksIHRoZW4gbm8gcG9pbnQgaW4gcnVubmluZyBSVy4gU28gUlcgc2hv\ndWxkIHNodXRkb3duLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gMjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0UldTaHV0ZG93bk9uTG9jYWxCb29r\naWVSZWFkb25seVRyYW5zaXRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMs\nIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwgVEVTVFBBU1NXRCk7Cgog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAg\nICAgICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAgICAgICAgSW5l\ndFNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbCA9IExlZGdlckhhbmRsZUFk\nYXB0ZXIuZ2V0TGVkZ2VyTWV0YWRhdGEobGgpLmdldEVuc2VtYmxlcygpLmdl\ndCgwTCkuZ2V0KDApOwoKICAgICAgICBMT0cuaW5mbygiS2lsbGluZyBCb29r\naWUiLCByZXBsaWNhVG9LaWxsKTsKICAgICAgICBraWxsQm9va2llKHJlcGxp\nY2FUb0tpbGwpOwoKICAgICAgICBpbnQgbmV3QmtQb3J0ID0gc3RhcnROZXdC\nb29raWUoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKysp\nIHsKICAgICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQoK\nICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBuZXdCa0FkZHIgPSBuZXcgSW5l\ndFNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0\nSG9zdEFkZHJlc3MoKSwgbmV3QmtQb3J0KTsKICAgICAgICBMT0cuaW5mbygi\nTmV3IEJvb2tpZSBhZGRyIDoiICsgbmV3QmtBZGRyKTsKCiAgICAgICAgUmVw\nbGljYXRpb25Xb3JrZXIgcncgPSBuZXcgUmVwbGljYXRpb25Xb3JrZXIoemtj\nLCBiYXNlQ29uZiwgbmV3QmtBZGRyKTsKCiAgICAgICAgcncuc3RhcnQoKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBCb29raWVTZXJ2ZXIgbmV3Qmsg\nPSBicy5nZXQoYnMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgIGJzQ29uZnMu\nZ2V0KGJzQ29uZnMuc2l6ZSgpIC0gMSkuc2V0UmVhZE9ubHlNb2RlRW5hYmxl\nZCh0cnVlKTsKICAgICAgICAgICAgbmV3QmsuZ2V0Qm9va2llKCkudHJhbnNp\ndGlvblRvUmVhZE9ubHlNb2RlKCk7CiAgICAgICAgICAgIHVuZGVyUmVwbGlj\nYXRpb25NYW5hZ2VyLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGguZ2V0\nSWQoKSwgcmVwbGljYVRvS2lsbC50b1N0cmluZygpKTsKICAgICAgICAgICAg\nd2hpbGUgKFJlcGxpY2F0aW9uVGVzdFV0aWwuaXNMZWRnZXJJblVuZGVyUmVw\nbGljYXRpb24oemtjLCBsaC5nZXRJZCgpLCBiYXNlUGF0aCkgJiYgcncuaXNS\ndW5uaW5nKCkpIHsKICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDAp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2VydEZhbHNlKCJSVyBz\naG91bGQgc2h1dGRvd24gaWYgdGhlIGJvb2tpZSBpcyByZWFkb25seSIsIHJ3\nLmlzUnVubmluZygpKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBydy5zaHV0ZG93bigpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgdGhhdCB0aGUgcmVwbGljYXRpb24gd29ya2VyIHdpbGwgc2h1\ndGRvd24gaWYgaXQgbG9zZSBpdHMgem9va2VlcGVyIHNlc3Npb24KICAgICAq\nLwogICAgQFRlc3QodGltZW91dD0zMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRl\nc3RSV1pLU2Vzc2lvbkxvc3QoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBab29LZWVwZXJXYXRjaGVyQmFzZSB3ID0gbmV3IFpvb0tlZXBlcldhdGNo\nZXJCYXNlKDEwMDAwKTsKICAgICAgICBab29LZWVwZXIgemsgPSBaa1V0aWxz\nLmNyZWF0ZUNvbm5lY3RlZFpvb2tlZXBlckNsaWVudCgKICAgICAgICAgICAg\nICAgIHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHcpOwoK\nICAgICAgICB0cnkgewogICAgICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBy\ndyA9IG5ldyBSZXBsaWNhdGlvbldvcmtlcih6aywgYmFzZUNvbmYsIGdldEJv\nb2tpZSgwKSk7CiAgICAgICAgICAgIHJ3LnN0YXJ0KCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICAg\nICAgaWYgKHJ3LmlzUnVubmluZygpKSB7CiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBUaHJl\nYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZSgiUmVwbGljYXRpb24gd29ya2VyIHNob3VsZCBiZSBydW5uaW5n\nIiwgcncuaXNSdW5uaW5nKCkpOwogICAgICAgICAgICBzdG9wWktDbHVzdGVy\nKCk7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKysp\nIHsKICAgICAgICAgICAgICAgIGlmICghcncuaXNSdW5uaW5nKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBhc3NlcnRGYWxzZSgiUmVwbGljYXRpb24gd29ya2Vy\nIHNob3VsZCBoYXZlIHNodXQgZG93biIsIHJ3LmlzUnVubmluZygpKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB6ay5jbG9zZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQga2lsbEFsbEJvb2tpZXMo\nTGVkZ2VySGFuZGxlIGxoLCBJbmV0U29ja2V0QWRkcmVzcyBleGNsdWRlQksp\nCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIEtp\nbGxpbmcgYWxsIGJvb2tpZXMgZXhjZXB0IG5ld2x5IHJlcGxpY2F0ZWQgYm9v\na2llCiAgICAgICAgU2V0PEVudHJ5PExvbmcsIEFycmF5TGlzdDxJbmV0U29j\na2V0QWRkcmVzcz4+PiBlbnRyeVNldCA9IExlZGdlckhhbmRsZUFkYXB0ZXIK\nICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5z\nZW1ibGVzKCkuZW50cnlTZXQoKTsKICAgICAgICBmb3IgKEVudHJ5PExvbmcs\nIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4+IGVudHJ5IDogZW50cnlT\nZXQpIHsKICAgICAgICAgICAgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNz\nPiBib29raWVzID0gZW50cnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgZm9y\nIChJbmV0U29ja2V0QWRkcmVzcyBib29raWUgOiBib29raWVzKSB7CiAgICAg\nICAgICAgICAgICBpZiAoYm9va2llLmVxdWFscyhleGNsdWRlQkspKSB7CiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBraWxsQm9va2llKGJvb2tpZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlm\neVJlY292ZXJlZExlZGdlcnMoTGVkZ2VySGFuZGxlIGxoLCBsb25nIHN0YXJ0\nRW50cnlJZCwKICAgICAgICAgICAgbG9uZyBlbmRFbnRyeUlkKSB0aHJvd3Mg\nQktFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBM\nZWRnZXJIYW5kbGUgbGhzID0gYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxo\nLmdldElkKCksCiAgICAgICAgICAgICAgICBCb29rS2VlcGVyLkRpZ2VzdFR5\ncGUuQ1JDMzIsIFRFU1RQQVNTV0QpOwogICAgICAgIEVudW1lcmF0aW9uPExl\nZGdlckVudHJ5PiBlbnRyaWVzID0gbGhzLnJlYWRFbnRyaWVzKHN0YXJ0RW50\ncnlJZCwKICAgICAgICAgICAgICAgIGVuZEVudHJ5SWQpOwogICAgICAgIGFz\nc2VydFRydWUoIlNob3VsZCBoYXZlIHRoZSBlbGVtZW50cyIsIGVudHJpZXMu\naGFzTW9yZUVsZW1lbnRzKCkpOwogICAgICAgIHdoaWxlIChlbnRyaWVzLmhh\nc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgIExlZGdlckVudHJ5IGVu\ndHJ5ID0gZW50cmllcy5uZXh0RWxlbWVudCgpOwogICAgICAgICAgICBhc3Nl\ncnRFcXVhbHMoIlRlc3RSZXBsaWNhdGlvbldvcmtlciIsIG5ldyBTdHJpbmco\nZW50cnkuZ2V0RW50cnkoKSkpOwogICAgICAgIH0KICAgIH0KCn0K\n","encoding":"base64"}

