{"sha":"ae51c05125f89af752a92ca2831e0c311881e5e6","node_id":"MDQ6QmxvYjE1NzU5NTY6YWU1MWMwNTEyNWY4OWFmNzUyYTkyY2EyODMxZTBjMzExODgxZTVlNg==","size":13689,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ae51c05125f89af752a92ca2831e0c311881e5e6","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdDsKCi8qCiAqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBz\nb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4\ncHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAq\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQg\nbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAqLwoKaW1w\nb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5CeXRl\nQnVmZmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5SYW5kb207\nCmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVw\nZXJUZXN0Q2xpZW50OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNs\naWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5E\naWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkJvb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5qdW5pdC5C\nZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKCi8qKgogKiBUaGlzIHRl\nc3QgdGVzdHMgcmVhZCBhbmQgd3JpdGUsIHN5bmNocm9ub3VzIGFuZCBhc3lu\nY2hyb25vdXMsIHN0cmluZ3MgYW5kCiAqIGludGVnZXJzIGZvciBhIEJvb2tL\nZWVwZXIgY2xpZW50LiBUaGUgdGVzdCBkZXBsb3ltZW50IHVzZXMgYSBab29L\nZWVwZXIgc2VydmVyCiAqIGFuZCB0aHJlZSBCb29rS2VlcGVycy4KICoKICov\nCgpwdWJsaWMgY2xhc3MgQm9va2llRmFpbHVyZVRlc3QgZXh0ZW5kcyBNdWx0\naUxlZGdlck1hbmFnZXJNdWx0aURpZ2VzdFRlc3RDYXNlCiAgICBpbXBsZW1l\nbnRzIEFkZENhbGxiYWNrLCBSZWFkQ2FsbGJhY2sgewoKICAgIC8vIERlcGVu\nZGluZyBvbiB0aGUgdGFzdGUsIHNlbGVjdCB0aGUgYW1vdW50IG9mIGxvZ2dp\nbmcKICAgIC8vIGJ5IGRlY29tbWVudGluZyBvbmUgb2YgdGhlIHR3byBsaW5l\ncyBiZWxvdwogICAgLy8gc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXIuZ2V0\nUm9vdExvZ2dlcigpOwogICAgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihCb29raWVGYWlsdXJlVGVzdC5jbGFzcyk7Cgog\nICAgYnl0ZVtdIGxlZGdlclBhc3N3b3JkID0gImFhYSIuZ2V0Qnl0ZXMoKTsK\nICAgIExlZGdlckhhbmRsZSBsaCwgbGgyOwogICAgbG9uZyBsZWRnZXJJZDsK\nCiAgICAvLyB0ZXN0IHJlbGF0ZWQgdmFyaWFibGVzCiAgICBpbnQgbnVtRW50\ncmllc1RvV3JpdGUgPSAyMDA7CiAgICBpbnQgbWF4SW50ID0gMjE0NzQ4MzY0\nNzsKICAgIFJhbmRvbSBybmc7IC8vIFJhbmRvbSBOdW1iZXIgR2VuZXJhdG9y\nCiAgICBBcnJheUxpc3Q8Ynl0ZVtdPiBlbnRyaWVzOyAvLyBnZW5lcmF0ZWQg\nZW50cmllcwogICAgQXJyYXlMaXN0PEludGVnZXI+IGVudHJpZXNTaXplOwog\nICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwoKICAgIGNsYXNzIFN5bmNPYmog\newogICAgICAgIGludCBjb3VudGVyOwogICAgICAgIGJvb2xlYW4gdmFsdWU7\nCiAgICAgICAgYm9vbGVhbiBmYWlsdXJlT2NjdXJyZWQ7CiAgICAgICAgRW51\nbWVyYXRpb248TGVkZ2VyRW50cnk+IGxzOwoKICAgICAgICBwdWJsaWMgU3lu\nY09iaigpIHsKICAgICAgICAgICAgY291bnRlciA9IDA7CiAgICAgICAgICAg\nIHZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIGZhaWx1cmVPY2N1cnJlZCA9\nIGZhbHNlOwogICAgICAgICAgICBscyA9IG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBCb29raWVGYWlsdXJlVGVzdChTdHJpbmcgbGVkZ2Vy\nTWFuYWdlckZhY3RvcnksIERpZ2VzdFR5cGUgZGlnZXN0VHlwZSkgewogICAg\nICAgIHN1cGVyKDQpOwogICAgICAgIHRoaXMuZGlnZXN0VHlwZSA9IGRpZ2Vz\ndFR5cGU7CiAgICAgICAgLy8gc2V0IGxlZGdlciBtYW5hZ2VyCiAgICAgICAg\nYmFzZUNvbmYuc2V0TGVkZ2VyTWFuYWdlckZhY3RvcnlDbGFzc05hbWUobGVk\nZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgICAgIGJhc2VDbGllbnRDb25mLnNl\ndExlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKGxlZGdlck1hbmFnZXJG\nYWN0b3J5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3RzIHdyaXRlcyBh\nbmQgcmVhZHMgd2hlbiBhIGJvb2tpZSBmYWlscy4KICAgICAqCiAgICAgKiBA\ndGhyb3dzIHtAbGluayBJT0V4Y2VwdGlvbn0KICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RBc3luY0JLMSgp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgTE9HLmluZm8oIiMjIyMg\nQksxICMjIyMiKTsKICAgICAgICBhdXhUZXN0UmVhZFdyaXRlQXN5bmNTaW5n\nbGVDbGllbnQoYnMuZ2V0KDApKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEFzeW5jQksyKCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiIyMjIyBCSzIgIyMj\nIyIpOwogICAgICAgIGF1eFRlc3RSZWFkV3JpdGVBc3luY1NpbmdsZUNsaWVu\ndChicy5nZXQoMSkpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0QXN5bmNCSzMoKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIExPRy5pbmZvKCIjIyMjIEJLMyAjIyMjIik7CiAg\nICAgICAgYXV4VGVzdFJlYWRXcml0ZUFzeW5jU2luZ2xlQ2xpZW50KGJzLmdl\ndCgyKSk7CiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RBc3luY0JLNCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgTE9HLmluZm8oIiMjIyMgQks0ICMjIyMiKTsKICAgICAgICBh\ndXhUZXN0UmVhZFdyaXRlQXN5bmNTaW5nbGVDbGllbnQoYnMuZ2V0KDMpKTsK\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEJvb2tpZVJlY292ZXJ5KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy9TaHV0ZG93biBhbGwgYnV0IDEgYm9va2llCiAgICAgICAgYnMu\nZ2V0KDApLnNodXRkb3duKCk7CiAgICAgICAgYnMuZ2V0KDEpLnNodXRkb3du\nKCk7CiAgICAgICAgYnMuZ2V0KDIpLnNodXRkb3duKCk7CgogICAgICAgIGJ5\ndGVbXSBwYXNzd2QgPSAiYmxhaCIuZ2V0Qnl0ZXMoKTsKICAgICAgICBMZWRn\nZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDEsIDEsZGlnZXN0VHlw\nZSwgcGFzc3dkKTsKCiAgICAgICAgaW50IG51bUVudHJpZXMgPSAxMDA7CiAg\nICAgICAgZm9yIChpbnQgaT0wOyBpPCBudW1FbnRyaWVzOyBpKyspIHsKICAg\nICAgICAgICAgYnl0ZVtdIGRhdGEgPSAoIiIraSkuZ2V0Qnl0ZXMoKTsKICAg\nICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQoKICAgICAg\nICBicy5nZXQoMykuc2h1dGRvd24oKTsKICAgICAgICBCb29raWVTZXJ2ZXIg\nc2VydmVyID0gbmV3IEJvb2tpZVNlcnZlcihic0NvbmZzLmdldCgzKSk7CiAg\nICAgICAgc2VydmVyLnN0YXJ0KCk7CiAgICAgICAgYnMuc2V0KDMsIHNlcnZl\ncik7CgogICAgICAgIGFzc2VydEVxdWFscyhudW1FbnRyaWVzIC0gMSAsIGxo\nLmdldExhc3RBZGRDb25maXJtZWQoKSk7CiAgICAgICAgRW51bWVyYXRpb248\nTGVkZ2VyRW50cnk+IGVudHJpZXMgPSBsaC5yZWFkRW50cmllcygwLCBsaC5n\nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwoKICAgICAgICBpbnQgbnVtU2Nhbm5l\nZCA9IDA7CiAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFzTW9yZUVsZW1lbnRz\nKCkpIHsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCgiIitudW1TY2FubmVk\nKSwgbmV3IFN0cmluZyhlbnRyaWVzLm5leHRFbGVtZW50KCkuZ2V0RW50cnko\nKSkpOwogICAgICAgICAgICBudW1TY2FubmVkKys7CiAgICAgICAgfQogICAg\nICAgIGFzc2VydEVxdWFscyhudW1FbnRyaWVzLCBudW1TY2FubmVkKTsKICAg\nIH0KCiAgICB2b2lkIGF1eFRlc3RSZWFkV3JpdGVBc3luY1NpbmdsZUNsaWVu\ndChCb29raWVTZXJ2ZXIgYnMpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgU3luY09iaiBzeW5jID0gbmV3IFN5bmNPYmooKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAg\nbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDIsIGRpZ2VzdFR5cGUsIGxlZGdl\nclBhc3N3b3JkKTsKCiAgICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQo\nKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdl\ndElkKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVu\ndHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZm\nZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAg\nICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAg\nICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CgogICAgICAgICAgICAg\nICAgZW50cmllcy5hZGQoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgICAg\nICBlbnRyaWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAg\nICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShlbnRyeS5hcnJheSgpLCB0\naGlzLCBzeW5jKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTE9HLmlu\nZm8oIldyb3RlICIgKyBudW1FbnRyaWVzVG9Xcml0ZSArICIgYW5kIG5vdyBn\nb2luZyB0byBmYWlsIGJvb2tpZS4iKTsKICAgICAgICAgICAgLy8gQm9va2ll\nIGZhaWwKICAgICAgICAgICAgYnMuc2h1dGRvd24oKTsKCiAgICAgICAgICAg\nIC8vIHdhaXQgZm9yIGFsbCBlbnRyaWVzIHRvIGJlIGFja25vd2xlZGdlZAog\nICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAg\nICAgIHdoaWxlIChzeW5jLmNvdW50ZXIgPCBudW1FbnRyaWVzVG9Xcml0ZSkg\newogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRW50cmllcyBjb3Vu\ndGVyID0gIiArIHN5bmMuY291bnRlcik7CiAgICAgICAgICAgICAgICAgICAg\nc3luYy53YWl0KDEwMDAwKTsKICAgICAgICAgICAgICAgICAgICBhc3NlcnRG\nYWxzZSgiRmFpbHVyZSBvY2N1cnJlZCBkdXJpbmcgd3JpdGUiLCBzeW5jLmZh\naWx1cmVPY2N1cnJlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFdSSVRFIENPTVBMRVRF\nICoqKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAg\nICAgbGguY2xvc2UoKTsKCiAgICAgICAgICAgIC8vICoqKiBXUklUSU5HIFBB\nUlQgQ09NUExFVEUgLy8gUkVBRCBQQVJUIEJFR0lOUyAqKioKCiAgICAgICAg\nICAgIC8vIG9wZW4gbGVkZ2VyCiAgICAgICAgICAgIGJrYy5jbG9zZSgpOwog\nICAgICAgICAgICBia2MgPSBuZXcgQm9va0tlZXBlclRlc3RDbGllbnQoYmFz\nZUNsaWVudENvbmYpOwogICAgICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2Vy\nKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAg\nICAgICAgIExPRy5kZWJ1ZygiTnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbjog\nIiArIChsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgKyAxKSk7CiAgICAgICAg\nICAgIGFzc2VydFRydWUoIlZlcmlmeWluZyBudW1iZXIgb2YgZW50cmllcyB3\ncml0dGVuIiwgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpID09IChudW1FbnRy\naWVzVG9Xcml0ZSAtIDEpKTsKCiAgICAgICAgICAgIC8vIHJlYWQgZW50cmll\ncwoKICAgICAgICAgICAgbGguYXN5bmNSZWFkRW50cmllcygwLCBudW1FbnRy\naWVzVG9Xcml0ZSAtIDEsIHRoaXMsIHN5bmMpOwoKICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICBpbnQgaSA9IDA7\nCiAgICAgICAgICAgICAgICBzeW5jLndhaXQoMTAwMDApOwogICAgICAgICAg\nICAgICAgYXNzZXJ0RmFsc2UoIkZhaWx1cmUgb2NjdXJyZWQgZHVyaW5nIHJl\nYWQiLCBzeW5jLmZhaWx1cmVPY2N1cnJlZCk7CiAgICAgICAgICAgICAgICBh\nc3NlcnRUcnVlKCJIYXZlbid0IHJlY2VpdmVkIGVudHJpZXMiLCBzeW5jLnZh\nbHVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTE9HLmRlYnVnKCIq\nKiogUkVBRCBDT01QTEVURSAqKioiKTsKCiAgICAgICAgICAgIC8vIGF0IHRo\naXMgcG9pbnQsIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiBscyBpcyBmaWxs\nZWQgd2l0aCB0aGUgcmV0dXJuZWQKICAgICAgICAgICAgLy8gdmFsdWVzCiAg\nICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgd2hpbGUgKHN5bmMu\nbHMuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgb3JpZ2JiID0gQnl0ZUJ1ZmZlci53cmFwKGVudHJpZXMuZ2V0KGkp\nKTsKICAgICAgICAgICAgICAgIEludGVnZXIgb3JpZ0VudHJ5ID0gb3JpZ2Ji\nLmdldEludCgpOwogICAgICAgICAgICAgICAgYnl0ZVtdIGVudHJ5ID0gc3lu\nYy5scy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCk7CiAgICAgICAgICAgICAg\nICBCeXRlQnVmZmVyIHJlc3VsdCA9IEJ5dGVCdWZmZXIud3JhcChlbnRyeSk7\nCgogICAgICAgICAgICAgICAgSW50ZWdlciByZXRyRW50cnkgPSByZXN1bHQu\nZ2V0SW50KCk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlJldHJpZXZl\nZCBlbnRyeTogIiArIGkpOwogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgi\nQ2hlY2tpbmcgZW50cnkgIiArIGkgKyAiIGZvciBlcXVhbGl0eSIsIG9yaWdF\nbnRyeS5lcXVhbHMocmV0ckVudHJ5KSk7CiAgICAgICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJDaGVja2luZyBlbnRyeSAiICsgaSArICIgZm9yIHNpemUiLCBl\nbnRyeS5sZW5ndGggPT0gZW50cmllc1NpemUuZ2V0KGkpLmludFZhbHVlKCkp\nOwogICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBhc3NlcnRUcnVlKCJDaGVja2luZyBudW1iZXIgb2YgcmVhZCBlbnRy\naWVzIiwgaSA9PSBudW1FbnRyaWVzVG9Xcml0ZSk7CgogICAgICAgICAgICBM\nT0cuaW5mbygiVmVyaWZpZWQgdGhhdCBlbnRyaWVzIGFyZSBvaywgYW5kIG5v\ndyBjbG9zaW5nIGxlZGdlciIpOwogICAgICAgICAgICBsaC5jbG9zZSgpOwog\nICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIExPRy5lcnJvcigiQ2F1Z2h0IEtlZXBlckV4Y2VwdGlvbiIsIGUpOwog\nICAgICAgICAgICBmYWlsKGUudG9TdHJpbmcoKSk7CiAgICAgICAgfSBjYXRj\naCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkNh\ndWdodCBCS0V4Y2VwdGlvbiIsIGUpOwogICAgICAgICAgICBmYWlsKGUudG9T\ndHJpbmcoKSk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkNhdWdodCBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiIsIGUpOwogICAgICAgICAgICBmYWlsKGUudG9TdHJp\nbmcoKSk7CiAgICAgICAgfQoKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIGFkZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxo\nLCBsb25nIGVudHJ5SWQsIE9iamVjdCBjdHgpIHsKICAgICAgICBTeW5jT2Jq\nIHggPSAoU3luY09iaikgY3R4OwogICAgICAgIGlmIChyYyAhPSAwKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiRmFpbHVyZSBkdXJpbmcgYWRkIHt9IHt9\nIiwgZW50cnlJZCwgcmMpOwogICAgICAgICAgICB4LmZhaWx1cmVPY2N1cnJl\nZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZCAoeCkg\newogICAgICAgICAgICB4LmNvdW50ZXIrKzsKICAgICAgICAgICAgeC5ub3Rp\nZnkoKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCByZWFkQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgs\nIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiBzZXEsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBTeW5jT2JqIHggPSAoU3luY09iaikgY3R4OwogICAgICAgIGlm\nIChyYyAhPSAwKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRmFpbHVyZSBk\ndXJpbmcgYWRkIHt9IiwgcmMpOwogICAgICAgICAgICB4LmZhaWx1cmVPY2N1\ncnJlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZCAo\neCkgewogICAgICAgICAgICB4LnZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAg\neC5scyA9IHNlcTsKICAgICAgICAgICAgeC5ub3RpZnkoKTsKICAgICAgICB9\nCiAgICB9CgogICAgQEJlZm9yZQogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHN1cGVy\nLnNldFVwKCk7CgogICAgICAgIHJuZyA9IG5ldyBSYW5kb20oU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCkpOyAvLyBJbml0aWFsaXplIHRoZSBSYW5kb20K\nICAgICAgICAvLyBOdW1iZXIgR2VuZXJhdG9yCiAgICAgICAgZW50cmllcyA9\nIG5ldyBBcnJheUxpc3Q8Ynl0ZVtdPigpOyAvLyBpbml0aWFsaXplIHRoZSBl\nbnRyaWVzIGxpc3QKICAgICAgICBlbnRyaWVzU2l6ZSA9IG5ldyBBcnJheUxp\nc3Q8SW50ZWdlcj4oKTsKCiAgICAgICAgemtjLmNsb3NlKCk7CiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RM\nZWRnZXJOb1JlY292ZXJ5T3BlbkFmdGVyQktDcmFzaGVkKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAg\nTGVkZ2VySGFuZGxlIGJlZm9yZWxoID0gYmtjLmNyZWF0ZUxlZGdlcihudW1C\nb29raWVzLCBudW1Cb29raWVzLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygp\nKTsKCiAgICAgICAgaW50IG51bUVudHJpZXMgPSAxMDsKICAgICAgICBTdHJp\nbmcgdG1wID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZvciAo\naW50IGk9MDsgaTxudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgYmVm\nb3JlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gc2h1dGRvd24gZmlyc3QgYm9va2llIHNlcnZlcgogICAgICAg\nIGtpbGxCb29raWUoMCk7CgogICAgICAgIC8vIHRyeSB0byBvcGVuIGxlZGdl\nciBubyByZWNvdmVyeQogICAgICAgIExlZGdlckhhbmRsZSBhZnRlcmxoID0g\nYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGJlZm9yZWxoLmdldElkKCksIGRp\nZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwoKICAgICAgICBhc3NlcnRFcXVh\nbHMobnVtRW50cmllcyAtIDIsIGFmdGVybGguZ2V0TGFzdEFkZENvbmZpcm1l\nZCgpKTsKCiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKICAgICAgICBMZWRn\nZXJIYW5kbGUgYmVmb3JlbGgyID0gYmtjLmNyZWF0ZUxlZGdlcihudW1Cb29r\naWVzLCAxLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKCiAgICAgICAg\nZm9yIChpbnQgaT0wOyBpPG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAg\nICBiZWZvcmVsaDIuYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gc2h1dGRvd24gZmlyc3QgYm9va2llIHNlcnZlcgog\nICAgICAgIGtpbGxCb29raWUoMCk7CgogICAgICAgIC8vIHRyeSB0byBvcGVu\nIGxlZGdlciBubyByZWNvdmVyeQogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShiZWZvcmVsaDIuZ2V0SWQoKSwg\nZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIGZhaWwo\nIlNob3VsZCBoYXZlIHRocm93biBleGNlcHRpb24iKTsKICAgICAgICB9IGNh\ndGNoIChCS0V4Y2VwdGlvbi5CS1JlYWRFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgIH0KCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdExl\nZGdlck9wZW5BZnRlckJLQ3Jhc2hlZCgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgIExlZGdlckhhbmRs\nZSBiZWZvcmVsaCA9IGJrYy5jcmVhdGVMZWRnZXIobnVtQm9va2llcywgbnVt\nQm9va2llcywgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CgogICAgICAg\nIGludCBudW1FbnRyaWVzID0gMTA7CiAgICAgICAgU3RyaW5nIHRtcCA9ICJC\nb29rS2VlcGVyIGlzIGNvb2whIjsKICAgICAgICBmb3IgKGludCBpPTA7IGk8\nbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIGJlZm9yZWxoLmFkZEVu\ndHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICB9CgogICAgICAgIC8vIHNo\ndXRkb3duIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBraWxsQm9va2ll\nKDApOwogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAgIC8vIHRy\neSB0byBvcGVuIGxlZGdlciBubyByZWNvdmVyeQogICAgICAgIExlZGdlckhh\nbmRsZSBhZnRlcmxoID0gYmtjLm9wZW5MZWRnZXIoYmVmb3JlbGguZ2V0SWQo\nKSwgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIGFzc2Vy\ndEVxdWFscyhiZWZvcmVsaC5nZXRMYXN0QWRkUHVzaGVkKCksIGFmdGVybGgu\nZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKCiAgICAgICAgTGVkZ2VySGFuZGxl\nIGJlZm9yZWxoMiA9IGJrYy5jcmVhdGVMZWRnZXIobnVtQm9va2llcywgMSwg\nZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIGZvciAoaW50\nIGk9MDsgaTxudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgYmVmb3Jl\nbGgyLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICB9CgogICAg\nICAgIC8vIHNodXRkb3duIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBr\naWxsQm9va2llKDApOwoKICAgICAgICAvLyB0cnkgdG8gb3BlbiBsZWRnZXIg\nbm8gcmVjb3ZlcnkKICAgICAgICB0cnkgewogICAgICAgICAgICBia2Mub3Bl\nbkxlZGdlcihiZWZvcmVsaDIuZ2V0SWQoKSwgZGlnZXN0VHlwZSwgIiIuZ2V0\nQnl0ZXMoKSk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBoYXZlIHRocm93\nbiBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5C\nS0xlZGdlclJlY292ZXJ5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8g\nY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBWZXJpZnkgcmVhZCBsYXN0IGNvbmZpcm1lZCBvcCwgaXQgc2hvdWxk\nbid0IGNhdXNlIGFueSBkZWFkbG9jayBhcyBuZXcKICAgICAqIGJvb2tpZSBj\nb25uZWN0aW9uIGlzIGJlaW5nIGVzdGFibGlzaGVkIGFuZCByZXR1cm5pbmcg\ndGhlIGNvbm5lY3Rpb24KICAgICAqIG5vdGlmaWNhdGlvbiBpbiB0aGUgc2Ft\nZSBjYWxsZXIgdGhyZWFkLiBJdCB3b3VsZCBiZSBzaW11bGF0ZWQgYnkgZGVs\nYXlpbmcKICAgICAqIHRoZSBmdXR1cmUuYWRkbGlzdGVuZXIoKSBpbiBQZXJD\naGFubmVsQm9va2llQ2xpZW50IGFmdGVyIHRoZSBjb25uZWN0aW9uCiAgICAg\nKiBlc3RhYmxpc2htZW50LiBOb3cgdGhlIGZ1dHVyZS5hZGRsaXN0ZW5lcigp\nIHdpbGwgbm90aWZ5IGJhY2sgaW4gdGhlIHNhbWUKICAgICAqIHRocmVhZCBh\nbmQgc2ltdWx0YW5lb3VzbHkgaW52b2tlIHRoZSBwZW5kaW5nT3Aub3BlcmF0\naW9uQ29tcGxldGUoKSBldmVudC4KICAgICAqIAogICAgICogQk9PS0tFRVBF\nUi0zMjYKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RSZWFkTGFzdENvbmZpcm1lZE9wKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKICAgICAgICBz\ndGFydE5ld0Jvb2tpZSgpOwogICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgog\nICAgICAgIExlZGdlckhhbmRsZSBiZWZvcmVsaCA9IGJrYy5jcmVhdGVMZWRn\nZXIobnVtQm9va2llcyArIDIsCiAgICAgICAgICAgICAgICBudW1Cb29raWVz\nICsgMiwgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIGlu\ndCBudW1FbnRyaWVzID0gMTA7CiAgICAgICAgU3RyaW5nIHRtcCA9ICJCb29r\nS2VlcGVyIGlzIGNvb2whIjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAgICBiZWZvcmVsaC5hZGRF\nbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBz\naHV0ZG93biBmaXJzdCBib29raWUgc2VydmVyCiAgICAgICAga2lsbEJvb2tp\nZSgwKTsKICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICAvLyBj\ncmVhdGUgbmV3IGJvb2tpZSBjbGllbnQsIGFuZCBmb3JjaW5nIHRvIGVzdGFi\nbGlzaCBuZXcKICAgICAgICAvLyBQZXJDaGFubmVsQm9va2llQ2xpZW50IGNv\nbm5lY3Rpb25zIGZvciByZWNvdmVyeSBmbG93cy4KICAgICAgICBCb29rS2Vl\ncGVyVGVzdENsaWVudCBia2MxID0gbmV3IEJvb2tLZWVwZXJUZXN0Q2xpZW50\nKGJhc2VDbGllbnRDb25mKTsKICAgICAgICAvLyB0cnkgdG8gb3BlbiBsZWRn\nZXIgd2l0aCByZWNvdmVyeQogICAgICAgIExlZGdlckhhbmRsZSBhZnRlcmxo\nID0gYmtjMS5vcGVuTGVkZ2VyKGJlZm9yZWxoLmdldElkKCksIGRpZ2VzdFR5\ncGUsICIiCiAgICAgICAgICAgICAgICAuZ2V0Qnl0ZXMoKSk7CgogICAgICAg\nIGFzc2VydEVxdWFscygiRW50cmllcyBnb3QgbWlzc2VkIiwgYmVmb3JlbGgu\nZ2V0TGFzdEFkZFB1c2hlZCgpLCBhZnRlcmxoCiAgICAgICAgICAgICAgICAu\nZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAgICAgICBia2MxLmNsb3NlKCk7\nCiAgICB9Cn0K\n","encoding":"base64"}

