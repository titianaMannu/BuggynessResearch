{"sha":"28b044d4b12a1744a7c7a49f020cab3aeb045ffe","node_id":"MDQ6QmxvYjE1NzU5NTY6MjhiMDQ0ZDRiMTJhMTc0NGE3YzdhNDlmMDIwY2FiM2FlYjA0NWZmZQ==","size":35282,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/28b044d4b12a1744a7c7a49f020cab3aeb045ffe","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuZGVsaXZlcnk7CgppbXBv\ncnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51\ndGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5RdWV1ZTsKaW1wb3J0IGphdmEu\ndXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQg\namF2YS51dGlsLlRyZWVNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5CbG9ja2luZ1F1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nUHJpb3JpdHlCbG9ja2luZ1F1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuTGlua2VkQmxvY2tpbmdRdWV1ZTsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJl\nbnQubG9ja3MuUmVlbnRyYW50UmVhZFdyaXRlTG9jazsKCmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7\nCgppbXBvcnQgY29tLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJs\nZUZvclRlc3Rpbmc7CmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmc7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuTWF0\naFV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmRhdGEu\nVG9waWNTdWJzY3JpYmVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhj\nZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5maWx0ZXIuU2VydmVyTWVzc2FnZUZpbHRlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2U7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJTdWJSZXNwb25zZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN0YXR1c0NvZGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25FdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9leHRlbnNpb25zLlB1YlN1YlJlc3Bv\nbnNlVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29t\nbW9uLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5zZXJ2ZXIuY29tbW9uLlVuZXhwZWN0ZWRFcnJvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5oYW5kbGVycy5TdWJzY3JpcHRpb25D\naGFubmVsTWFuYWdlci5TdWJDaGFubmVsRGlzY29ubmVjdGVkTGlzdGVuZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIubmV0dHkuU2VydmVy\nU3RhdHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lz\ndGVuY2UuQ2FuY2VsU2NhblJlcXVlc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2UuRmFjdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnNlcnZlci5wZXJzaXN0ZW5jZS5NYXBNZXRob2RzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBlcnNpc3RlbmNlLlBl\ncnNpc3RlbmNlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNl\ncnZlci5wZXJzaXN0ZW5jZS5SZWFkQWhlYWRDYWNoZTsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnNlcnZlci5wZXJzaXN0ZW5jZS5TY2FuQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2Uu\nU2NhblJlcXVlc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNh\nbGxiYWNrOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwu\nVmFyQXJncy52YTsKCnB1YmxpYyBjbGFzcyBGSUZPRGVsaXZlcnlNYW5hZ2Vy\nIGltcGxlbWVudHMgUnVubmFibGUsIERlbGl2ZXJ5TWFuYWdlciwgU3ViQ2hh\nbm5lbERpc2Nvbm5lY3RlZExpc3RlbmVyIHsKCiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihGSUZPRGVsaXZlcnlNYW5hZ2VyLmNsYXNzKTsKCiAgICBwcml2YXRl\nIHN0YXRpYyBDYWxsYmFjazxWb2lkPiBOT1BfQ0FMTEJBQ0sgPSBuZXcgQ2Fs\nbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCBy\nZXN1bHQpIHsKICAgICAgICB9CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1\nYkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICB9CiAgICB9OwoKICAg\nIHByb3RlY3RlZCBpbnRlcmZhY2UgRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdCB7\nCiAgICAgICAgcHVibGljIHZvaWQgcGVyZm9ybVJlcXVlc3QoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIHRoZSBtYWluIHF1ZXVlIHRoYXQgdGhlIHNpbmds\nZS10aHJlYWRlZCBkZWxpdmVyeSBtYW5hZ2VyIHdvcmtzIG9mZiBvZgogICAg\nICovCiAgICBCbG9ja2luZ1F1ZXVlPERlbGl2ZXJ5TWFuYWdlclJlcXVlc3Q+\nIHJlcXVlc3RRdWV1ZSA9IG5ldyBMaW5rZWRCbG9ja2luZ1F1ZXVlPERlbGl2\nZXJ5TWFuYWdlclJlcXVlc3Q+KCk7CgogICAgLyoqCiAgICAgKiBUaGUgcXVl\ndWUgb2YgYWxsIHN1YnNjcmlwdGlvbnMgdGhhdCBhcmUgZmFjaW5nIGEgdHJh\nbnNpZW50IGVycm9yIGVpdGhlcgogICAgICogaW4gc2Nhbm5pbmcgZnJvbSB0\naGUgcGVyc2lzdGVuY2UgbWFuYWdlciwgb3IgaW4gc2VuZGluZyB0byB0aGUg\nY29uc3VtZXIKICAgICAqLwogICAgUXVldWU8QWN0aXZlU3Vic2NyaWJlclN0\nYXRlPiByZXRyeVF1ZXVlID0KICAgICAgICBuZXcgUHJpb3JpdHlCbG9ja2lu\nZ1F1ZXVlPEFjdGl2ZVN1YnNjcmliZXJTdGF0ZT4oMzIsIG5ldyBDb21wYXJh\ndG9yPEFjdGl2ZVN1YnNjcmliZXJTdGF0ZT4oKSB7CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoQWN0aXZl\nU3Vic2NyaWJlclN0YXRlIGFzMSwgQWN0aXZlU3Vic2NyaWJlclN0YXRlIGFz\nMikgewogICAgICAgICAgICAgICAgbG9uZyBzID0gYXMxLmxhc3RTY2FuRXJy\nb3JUaW1lIC0gYXMyLmxhc3RTY2FuRXJyb3JUaW1lOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHMgPiAwID8gMSA6IChzIDwgMCA/IC0xIDogMCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9KTsKCiAgICAvKioKICAgICAqIFN0b3JlcyBh\nIG1hcHBpbmcgZnJvbSB0b3BpYyB0byB0aGUgZGVsaXZlcnkgcG9pbnRlcnMg\nb24gdGhlIHRvcGljLiBUaGUKICAgICAqIGRlbGl2ZXJ5IHBvaW50ZXJzIGFy\nZSBzdG9yZWQgaW4gYSBzb3J0ZWQgbWFwIGZyb20gc2VxLWlkIHRvIHRoZSBz\nZXQgb2YKICAgICAqIHN1YnNjcmliZXJzIGF0IHRoYXQgc2VxLWlkCiAgICAg\nKi8KICAgIE1hcDxCeXRlU3RyaW5nLCBTb3J0ZWRNYXA8TG9uZywgU2V0PEFj\ndGl2ZVN1YnNjcmliZXJTdGF0ZT4+PiBwZXJUb3BpY0RlbGl2ZXJ5UHRyczsK\nCiAgICAvKioKICAgICAqIE1hcHBpbmcgZnJvbSBkZWxpdmVyeSBlbmQgcG9p\nbnQgdG8gdGhlIHN1YnNjcmliZXIgc3RhdGUgdGhhdCB3ZSBhcmUKICAgICAq\nIHNlcnZpbmcgYXQgdGhhdCBlbmQgcG9pbnQuIFRoaXMgcHJldmVudHMgdXMg\nZS5nLiwgZnJvbSBzZXJ2aW5nIHR3bwogICAgICogc3Vic2NyaXB0aW9ucyB0\nbyB0aGUgc2FtZSBlbmRwb2ludAogICAgICovCiAgICBNYXA8VG9waWNTdWJz\nY3JpYmVyLCBBY3RpdmVTdWJzY3JpYmVyU3RhdGU+IHN1YnNjcmliZXJTdGF0\nZXM7CgogICAgcHJpdmF0ZSBmaW5hbCBSZWFkQWhlYWRDYWNoZSBjYWNoZTsK\nICAgIHByaXZhdGUgZmluYWwgUGVyc2lzdGVuY2VNYW5hZ2VyIHBlcnNpc3Rl\nbmNlTWdyOwoKICAgIHByaXZhdGUgU2VydmVyQ29uZmlndXJhdGlvbiBjZmc7\nCgogICAgLy8gQm9vbGVhbiBpbmRpY2F0aW5nIGlmIHRoaXMgdGhyZWFkIHNo\nb3VsZCBjb250aW51ZSBydW5uaW5nLiBUaGlzIGlzIHVzZWQKICAgIC8vIHdo\nZW4gd2Ugd2FudCB0byBzdG9wIHRoZSB0aHJlYWQgZHVyaW5nIGEgUHViU3Vi\nU2VydmVyIHNodXRkb3duLgogICAgcHJvdGVjdGVkIGJvb2xlYW4ga2VlcFJ1\nbm5pbmcgPSB0cnVlOwogICAgcHJpdmF0ZSBmaW5hbCBUaHJlYWQgd29ya2Vy\nVGhyZWFkOwoKICAgIHByaXZhdGUgT2JqZWN0IHN1c3BlbnNpb25Mb2NrID0g\nbmV3IE9iamVjdCgpOwogICAgcHJpdmF0ZSBib29sZWFuIHN1c3BlbmRlZCA9\nIGZhbHNlOwoKCiAgICBwdWJsaWMgRklGT0RlbGl2ZXJ5TWFuYWdlcihQZXJz\naXN0ZW5jZU1hbmFnZXIgcGVyc2lzdGVuY2VNZ3IsIFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY2ZnKSB7CiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZU1nciA9IHBl\ncnNpc3RlbmNlTWdyOwogICAgICAgIGlmIChwZXJzaXN0ZW5jZU1nciBpbnN0\nYW5jZW9mIFJlYWRBaGVhZENhY2hlKSB7CiAgICAgICAgICAgIHRoaXMuY2Fj\naGUgPSAoUmVhZEFoZWFkQ2FjaGUpIHBlcnNpc3RlbmNlTWdyOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuY2FjaGUgPSBudWxsOwogICAg\nICAgIH0KICAgICAgICBwZXJUb3BpY0RlbGl2ZXJ5UHRycyA9IG5ldyBIYXNo\nTWFwPEJ5dGVTdHJpbmcsIFNvcnRlZE1hcDxMb25nLCBTZXQ8QWN0aXZlU3Vi\nc2NyaWJlclN0YXRlPj4+KCk7CiAgICAgICAgc3Vic2NyaWJlclN0YXRlcyA9\nIG5ldyBIYXNoTWFwPFRvcGljU3Vic2NyaWJlciwgQWN0aXZlU3Vic2NyaWJl\nclN0YXRlPigpOwogICAgICAgIHdvcmtlclRocmVhZCA9IG5ldyBUaHJlYWQo\ndGhpcywgIkRlbGl2ZXJ5TWFuYWdlclRocmVhZCIpOwogICAgICAgIHRoaXMu\nY2ZnID0gY2ZnOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgc3RhcnQoKSB7CiAgICAgICAgd29ya2VyVGhyZWFkLnN0YXJ0KCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTdG9wIEZJRk8gZGVsaXZlcnkgbWFuYWdl\nciBmcm9tIHByb2Nlc3NpbmcgcmVxdWVzdHMuIChmb3IgdGVzdGluZykKICAg\nICAqLwogICAgQFZpc2libGVGb3JUZXN0aW5nCiAgICBwdWJsaWMgdm9pZCBz\ndXNwZW5kUHJvY2Vzc2luZygpIHsKICAgICAgICBzeW5jaHJvbml6ZWQoc3Vz\ncGVuc2lvbkxvY2spIHsKICAgICAgICAgICAgc3VzcGVuZGVkID0gdHJ1ZTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXN1bWUgRklGTyBk\nZWxpdmVyeSBtYW5hZ2VyLiAoZm9yIHRlc3RpbmcpCiAgICAgKi8KICAgIEBW\naXNpYmxlRm9yVGVzdGluZwogICAgcHVibGljIHZvaWQgcmVzdW1lUHJvY2Vz\nc2luZygpIHsKICAgICAgICBzeW5jaHJvbml6ZWQoc3VzcGVuc2lvbkxvY2sp\nIHsKICAgICAgICAgICAgc3VzcGVuZGVkID0gZmFsc2U7CiAgICAgICAgICAg\nIHN1c3BlbnNpb25Mb2NrLm5vdGlmeSgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSBPdXIKICAg\nICAqIHVzdWFsIGVucXVldWUgZnVuY3Rpb24sIHN0b3AgaWYgZXJyb3IgYmVj\nYXVzZSBvZiB1bmJvdW5kZWQgcXVldWUsIHNob3VsZAogICAgICogbmV2ZXIg\naGFwcGVuCiAgICAgKgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBlbnF1\nZXVlV2l0aG91dEZhaWx1cmUoRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdCByZXF1\nZXN0KSB7CiAgICAgICAgaWYgKCFyZXF1ZXN0UXVldWUub2ZmZXIocmVxdWVz\ndCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRFcnJvcigi\nQ291bGQgbm90IGVucXVldWUgb2JqZWN0OiAiICsgcmVxdWVzdCArICIgdG8g\nZGVsaXZlcnkgbWFuYWdlciByZXF1ZXN0IHF1ZXVlLiIpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqID09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nCiAgICAgKiBQdWJsaWMgaW50ZXJmYWNlIG9mIHRoZSBkZWxpdmVyeSBtYW5h\nZ2VyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRlbGxzIHRoZSBkZWxpdmVy\neSBtYW5hZ2VyIHRvIHN0YXJ0IHNlbmRpbmcgb3V0IG1lc3NhZ2VzIGZvciBh\nIHBhcnRpY3VsYXIKICAgICAqIHN1YnNjcmlwdGlvbgogICAgICoKICAgICAq\nIEBwYXJhbSB0b3BpYwogICAgICogQHBhcmFtIHN1YnNjcmliZXJJZAogICAg\nICogQHBhcmFtIHNlcUlkVG9TdGFydEZyb20KICAgICAqICAgICAgICAgICAg\nTWVzc2FnZSBzZXF1ZW5jZS1pZCBmcm9tIHdoZXJlIGRlbGl2ZXJ5IHNob3Vs\nZCBiZSBzdGFydGVkCiAgICAgKiBAcGFyYW0gZW5kUG9pbnQKICAgICAqICAg\nICAgICAgICAgVGhlIGRlbGl2ZXJ5IGVuZCBwb2ludCB0byB3aGljaCBzZW5k\nIG1lc3NhZ2VzIHRvCiAgICAgKiBAcGFyYW0gZmlsdGVyCiAgICAgKiAgICAg\nICAgICAgIE9ubHkgbWVzc2FnZXMgcGFzc2luZyB0aGlzIGZpbHRlciBzaG91\nbGQgYmUgc2VudCB0byB0aGlzCiAgICAgKiAgICAgICAgICAgIHN1YnNjcmli\nZXIKICAgICAqIEBwYXJhbSBjYWxsYmFjawogICAgICogICAgICAgICAgICBD\nYWxsYmFjayBpbnN0YW5jZQogICAgICogQHBhcmFtIGN0eAogICAgICogICAg\nICAgICAgICBDYWxsYmFjayBjb250ZXh0CiAgICAgKi8KICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgc3RhcnRTZXJ2aW5nU3Vic2NyaXB0aW9uKEJ5\ndGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN1YnNjcmlw\ndGlvblByZWZlcmVuY2VzIHByZWZlcmVuY2VzLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXFJZCBzZXFJZFRv\nU3RhcnRGcm9tLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIERlbGl2ZXJ5RW5kUG9pbnQgZW5kUG9pbnQsIFNlcnZlck1lc3Nh\nZ2VGaWx0ZXIgZmlsdGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgQWN0aXZlU3Vic2NyaWJlclN0YXRlIHN1YnNjcmli\nZXIgPQogICAgICAgICAgICBuZXcgQWN0aXZlU3Vic2NyaWJlclN0YXRlKHRv\ncGljLCBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcHJlZmVyZW5jZXMsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgc2VxSWRUb1N0YXJ0RnJvbS5nZXRMb2NhbENv\nbXBvbmVudCgpIC0gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBlbmRQb2ludCwgZmlsdGVyLCBjYWxsYmFjaywgY3R4KTsKCiAg\nICAgICAgZW5xdWV1ZVdpdGhvdXRGYWlsdXJlKHN1YnNjcmliZXIpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHN0b3BTZXJ2aW5nU3Vic2NyaWJlcihCeXRl\nU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25F\ndmVudCBldmVudCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBDYWxsYmFjazxWb2lkPiBjYiwgT2JqZWN0IGN0eCkgewogICAgICAg\nIGVucXVldWVXaXRob3V0RmFpbHVyZShuZXcgU3RvcFNlcnZpbmdTdWJzY3Jp\nYmVyKHRvcGljLCBzdWJzY3JpYmVySWQsIGV2ZW50LCBjYiwgY3R4KSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBJbnN0cnVjdHMgdGhlIGRlbGl2ZXJ5IG1h\nbmFnZXIgdG8gYmFja29mZiBvbiB0aGUgZ2l2ZW4gc3Vic2NyaWJlciBhbmQK\nICAgICAqIHJldHJ5IHNlbmRpbmcgYWZ0ZXIgc29tZSB0aW1lCiAgICAgKgog\nICAgICogQHBhcmFtIHN1YnNjcmliZXIKICAgICAqLwogICAgcHVibGljIHZv\naWQgcmV0cnlFcnJvcmVkU3Vic2NyaWJlckFmdGVyRGVsYXkoQWN0aXZlU3Vi\nc2NyaWJlclN0YXRlIHN1YnNjcmliZXIpIHsKCiAgICAgICAgc3Vic2NyaWJl\nci5zZXRMYXN0U2NhbkVycm9yVGltZShNYXRoVXRpbHMubm93KCkpOwoKICAg\nICAgICBpZiAoIXJldHJ5UXVldWUub2ZmZXIoc3Vic2NyaWJlcikpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRFcnJvcigiQ291bGQgbm90\nIGVucXVldWUgdG8gZGVsaXZlcnkgbWFuYWdlciByZXRyeSBxdWV1ZSIpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhclJldHJ5RGVs\nYXlGb3JTdWJzY3JpYmVyKEFjdGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJzY3Jp\nYmVyKSB7CiAgICAgICAgc3Vic2NyaWJlci5jbGVhckxhc3RTY2FuRXJyb3JU\naW1lKCk7CiAgICAgICAgaWYgKCFyZXRyeVF1ZXVlLm9mZmVyKHN1YnNjcmli\nZXIpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBVbmV4cGVjdGVkRXJyb3Io\nIkNvdWxkIG5vdCBlbnF1ZXVlIHRvIGRlbGl2ZXJ5IG1hbmFnZXIgcmV0cnkg\ncXVldWUiKTsKICAgICAgICB9CiAgICAgICAgLy8gbm8gcmVxdWVzdCBpbiBy\nZXF1ZXN0IHF1ZXVlIG5vdwogICAgICAgIC8vIGlzc3VlIGEgZW1wdHkgZGVs\naXZlcnkgcmVxdWVzdCB0byBub3Qgd2FpdGluZyBmb3IgcG9sbGluZyByZXF1\nZXN0cyBxdWV1ZQogICAgICAgIGlmIChyZXF1ZXN0UXVldWUuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIGVucXVldWVXaXRob3V0RmFpbHVyZShuZXcgRGVs\naXZlcnlNYW5hZ2VyUmVxdWVzdCgpIHsKICAgICAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwZXJm\nb3JtUmVxdWVzdCgpIHsKICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3Ro\naW5nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0pOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBUT0RPOiBmb3Igbm93LCBJ\nIGRvbid0IG1vdmUgbWVzc2FnZUNvbnN1bWVkIHJlcXVlc3QgdG8gZGVsaXZl\ncnkgbWFuYWdlciB0aHJlYWQsCiAgICAvLyAgICAgICB3aGljaCBpcyBzdXBw\nb3NlZCB0byBiZSBmaXhlZCBpbiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBh\nY2hlLm9yZy9qaXJhL2Jyb3dzZS9CT09LS0VFUEVSLTUwM30KICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgbWVzc2FnZUNvbnN1bWVkKEJ5dGVTdHJp\nbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXFJZCBjb25zdW1lZFNl\ncUlkKSB7CiAgICAgICAgQWN0aXZlU3Vic2NyaWJlclN0YXRlIHN1YlN0YXRl\nID0KICAgICAgICAgICAgc3Vic2NyaWJlclN0YXRlcy5nZXQobmV3IFRvcGlj\nU3Vic2NyaWJlcih0b3BpYywgc3Vic2NyaWJlcklkKSk7CiAgICAgICAgaWYg\nKG51bGwgPT0gc3ViU3RhdGUpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICBzdWJTdGF0ZS5tZXNzYWdlQ29uc3VtZWQoY29uc3Vt\nZWRTZXFJZC5nZXRMb2NhbENvbXBvbmVudCgpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEluc3RydWN0cyB0aGUgZGVsaXZlcnkgbWFuYWdlciB0byBtb3Zl\nIHRoZSBkZWxpdmVyeSBwb2ludGVyIGZvciBhIGdpdmVuCiAgICAgKiBzdWJz\nY3JpYmVyCiAgICAgKgogICAgICogQHBhcmFtIHN1YnNjcmliZXIKICAgICAq\nIEBwYXJhbSBwcmV2U2VxSWQKICAgICAqIEBwYXJhbSBuZXdTZXFJZAogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBtb3ZlRGVsaXZlcnlQdHJGb3J3YXJkKEFj\ndGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJzY3JpYmVyLCBsb25nIHByZXZTZXFJ\nZCwgbG9uZyBuZXdTZXFJZCkgewogICAgICAgIGVucXVldWVXaXRob3V0RmFp\nbHVyZShuZXcgRGVsaXZlcnlQdHJNb3ZlKHN1YnNjcmliZXIsIHByZXZTZXFJ\nZCwgbmV3U2VxSWQpKTsKICAgIH0KCiAgICAvKgogICAgICogPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT0KICAgICAqID09IEVuZCBvZiBwdWJsaWMg\naW50ZXJmYWNlLCBpbnRlcm5hbCBtYWNoaW5lcnkgYmVnaW5zLgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgd2hpbGUgKGtlZXBS\ndW5uaW5nKSB7CiAgICAgICAgICAgIERlbGl2ZXJ5TWFuYWdlclJlcXVlc3Qg\ncmVxdWVzdCA9IG51bGw7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgLy8gV2UgdXNlIGEgdGltZW91dCBvZiAxIHNlY29uZCwgc28gdGhh\ndCB3ZSBjYW4gd2FrZSB1cCBvbmNlIGluCiAgICAgICAgICAgICAgICAvLyBh\nIHdoaWxlIHRvIGNoZWNrIGlmIHRoZXJlIGlzIHNvbWV0aGluZyBpbiB0aGUg\ncmV0cnkgcXVldWUuCiAgICAgICAgICAgICAgICByZXF1ZXN0ID0gcmVxdWVz\ndFF1ZXVlLnBvbGwoMSwgVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgICAg\nICAgICBzeW5jaHJvbml6ZWQoc3VzcGVuc2lvbkxvY2spIHsKICAgICAgICAg\nICAgICAgICAgICB3aGlsZSAoc3VzcGVuZGVkKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHN1c3BlbnNpb25Mb2NrLndhaXQoKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0\nY2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIEZpcnN0IHJldHJ5IGFueSBzdWJzY3Jp\ncHRpb25zIHRoYXQgaGFkIGZhaWxlZCBhbmQgbmVlZCBhIHJldHJ5CiAgICAg\nICAgICAgIHJldHJ5RXJyb3JlZFN1YnNjcmliZXJzKCk7CgogICAgICAgICAg\nICBpZiAocmVxdWVzdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVxdWVzdC5wZXJm\nb3JtUmVxdWVzdCgpOwoKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTdG9wIG1ldGhvZCB3aGljaCB3aWxsIGVucXVldWUgYSBTaHV0ZG93bkRl\nbGl2ZXJ5TWFuYWdlclJlcXVlc3QuCiAgICAgKi8KICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgc3RvcCgpIHsKICAgICAgICBlbnF1ZXVlV2l0aG91\ndEZhaWx1cmUobmV3IFNodXRkb3duRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdCgp\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCByZXRyeUVycm9yZWRTdWJz\nY3JpYmVycygpIHsKICAgICAgICBsb25nIGxhc3RJbnRlcmVzdGluZ0ZhaWx1\ncmVUaW1lID0gTWF0aFV0aWxzLm5vdygpIC0gY2ZnLmdldFNjYW5CYWNrb2Zm\nUGVyaW9kTXMoKTsKICAgICAgICBBY3RpdmVTdWJzY3JpYmVyU3RhdGUgc3Vi\nc2NyaWJlcjsKCiAgICAgICAgd2hpbGUgKChzdWJzY3JpYmVyID0gcmV0cnlR\ndWV1ZS5wZWVrKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgaWYgKHN1YnNj\ncmliZXIuZ2V0TGFzdFNjYW5FcnJvclRpbWUoKSA+IGxhc3RJbnRlcmVzdGlu\nZ0ZhaWx1cmVUaW1lKSB7CiAgICAgICAgICAgICAgICAvLyBOb3QgZW5vdWdo\nIHRpbWUgaGFzIGVsYXBzZWQgeWV0LCB3aWxsIHJldHJ5IGxhdGVyCiAgICAg\nICAgICAgICAgICAvLyBTaW5jZSB0aGUgcXVldWUgaXMgZmlmbywgbm8gbmVl\nZCB0byBjaGVjayBsYXRlciBpdGVtcwogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByZXRyeSBub3cKICAg\nICAgICAgICAgc3Vic2NyaWJlci5kZWxpdmVyTmV4dE1lc3NhZ2UoKTsKICAg\nICAgICAgICAgcmV0cnlRdWV1ZS5wb2xsKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHByb3RlY3RlZCB2b2lkIHJlbW92ZURlbGl2ZXJ5UHRyKEFjdGl2ZVN1\nYnNjcmliZXJTdGF0ZSBzdWJzY3JpYmVyLCBMb25nIHNlcUlkLCBib29sZWFu\nIGlzQWJzZW5jZU9rLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYm9vbGVhbiBwcnVuZVRvcGljKSB7CgogICAgICAgIGFzc2VydCBz\nZXFJZCAhPSBudWxsOwoKICAgICAgICAvLyByZW1vdmUgdGhpcyBzdWJzY3Jp\nYmVyIGZyb20gdGhlIGRlbGl2ZXJ5IHBvaW50ZXJzIGRhdGEgc3RydWN0dXJl\nCiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IHN1YnNjcmliZXIuZ2V0VG9w\naWMoKTsKICAgICAgICBTb3J0ZWRNYXA8TG9uZywgU2V0PEFjdGl2ZVN1YnNj\ncmliZXJTdGF0ZT4+IGRlbGl2ZXJ5UHRycyA9IHBlclRvcGljRGVsaXZlcnlQ\ndHJzLmdldCh0b3BpYyk7CgogICAgICAgIGlmIChkZWxpdmVyeVB0cnMgPT0g\nbnVsbCAmJiAhaXNBYnNlbmNlT2spIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuZXhwZWN0ZWRFcnJvcigiTm8gZGVsaXZlcnkgcG9pbnRlcnMgZm91bmQg\nd2hpbGUgZGlzY29ubmVjdGluZyAiICsgImNoYW5uZWwgZm9yIHRvcGljOiIg\nKyB0b3BpYyk7CiAgICAgICAgfQoKICAgICAgICBpZihudWxsID09IGRlbGl2\nZXJ5UHRycykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBpZiAoIU1hcE1ldGhvZHMucmVtb3ZlRnJvbU11bHRpTWFwKGRlbGl2\nZXJ5UHRycywgc2VxSWQsIHN1YnNjcmliZXIpICYmICFpc0Fic2VuY2VPaykg\newoKICAgICAgICAgICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRFcnJvcigiQ291\nbGQgbm90IGZpbmQgc3Vic2NyaWJlcjoiICsgc3Vic2NyaWJlciArICIgYXQg\ndGhlIGV4cGVjdGVkIGRlbGl2ZXJ5IHBvaW50ZXIiKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChwcnVuZVRvcGljICYmIGRlbGl2ZXJ5UHRycy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgcGVyVG9waWNEZWxpdmVyeVB0cnMucmVtb3Zl\nKHRvcGljKTsKICAgICAgICB9CgogICAgfQoKICAgIHByb3RlY3RlZCBsb25n\nIGdldE1pbmltdW1TZXFJZChCeXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAg\nU29ydGVkTWFwPExvbmcsIFNldDxBY3RpdmVTdWJzY3JpYmVyU3RhdGU+PiBk\nZWxpdmVyeVB0cnMgPSBwZXJUb3BpY0RlbGl2ZXJ5UHRycy5nZXQodG9waWMp\nOwoKICAgICAgICBpZiAoZGVsaXZlcnlQdHJzID09IG51bGwgfHwgZGVsaXZl\ncnlQdHJzLmlzRW1wdHkoKSkgewogICAgICAgICAgICByZXR1cm4gTG9uZy5N\nQVhfVkFMVUUgLSAxOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGVsaXZl\ncnlQdHJzLmZpcnN0S2V5KCk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQg\nYWRkRGVsaXZlcnlQdHIoQWN0aXZlU3Vic2NyaWJlclN0YXRlIHN1YnNjcmli\nZXIsIExvbmcgc2VxSWQpIHsKCiAgICAgICAgLy8gSWYgdGhpcyB0b3BpYyBk\nb2Vzbid0IGV4aXN0IGluIHRoZSBwZXItdG9waWMgZGVsaXZlcnkgcG9pbnRl\ncnMgdGFibGUsCiAgICAgICAgLy8gY3JlYXRlIGFuIGVudHJ5IGZvciBpdAog\nICAgICAgIFNvcnRlZE1hcDxMb25nLCBTZXQ8QWN0aXZlU3Vic2NyaWJlclN0\nYXRlPj4gZGVsaXZlcnlQdHJzID0gTWFwTWV0aG9kcy5nZXRBZnRlckluc2Vy\ndGluZ0lmQWJzZW50KAogICAgICAgICAgICAgICAgICAgIHBlclRvcGljRGVs\naXZlcnlQdHJzLCBzdWJzY3JpYmVyLmdldFRvcGljKCksIFRyZWVNYXBMb25n\nVG9TZXRTdWJzY3JpYmVyRmFjdG9yeS5pbnN0YW5jZSk7CgogICAgICAgIE1h\ncE1ldGhvZHMuYWRkVG9NdWx0aU1hcChkZWxpdmVyeVB0cnMsIHNlcUlkLCBz\ndWJzY3JpYmVyLCBIYXNoTWFwU3Vic2NyaWJlckZhY3RvcnkuaW5zdGFuY2Up\nOwogICAgfQoKICAgIHB1YmxpYyBjbGFzcyBBY3RpdmVTdWJzY3JpYmVyU3Rh\ndGUKICAgICAgICBpbXBsZW1lbnRzIFNjYW5DYWxsYmFjaywgRGVsaXZlcnlD\nYWxsYmFjaywgRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdCwgQ2FuY2VsU2NhblJl\ncXVlc3QgewoKICAgICAgICBzdGF0aWMgZmluYWwgaW50IFVOTElNSVRFRCA9\nIDA7CgogICAgICAgIEJ5dGVTdHJpbmcgdG9waWM7CiAgICAgICAgQnl0ZVN0\ncmluZyBzdWJzY3JpYmVySWQ7CiAgICAgICAgbG9uZyBsYXN0TG9jYWxTZXFJ\nZERlbGl2ZXJlZDsKICAgICAgICBib29sZWFuIGNvbm5lY3RlZCA9IHRydWU7\nCiAgICAgICAgUmVlbnRyYW50UmVhZFdyaXRlTG9jayBjb25uZWN0ZWRMb2Nr\nID0gbmV3IFJlZW50cmFudFJlYWRXcml0ZUxvY2soKTsKICAgICAgICBEZWxp\ndmVyeUVuZFBvaW50IGRlbGl2ZXJ5RW5kUG9pbnQ7CiAgICAgICAgbG9uZyBs\nYXN0U2NhbkVycm9yVGltZSA9IC0xOwogICAgICAgIGxvbmcgbG9jYWxTZXFJ\nZERlbGl2ZXJpbmdOb3c7CiAgICAgICAgbG9uZyBsYXN0U2VxSWRDb21tdW5p\nY2F0ZWRFeHRlcm5hbGx5OwogICAgICAgIGxvbmcgbGFzdFNlcUlkQ29uc3Vt\nZWRVdGlsOwogICAgICAgIGJvb2xlYW4gaXNUaHJvdHRsZWQgPSBmYWxzZTsK\nICAgICAgICBmaW5hbCBpbnQgbWVzc2FnZVdpbmRvd1NpemU7CiAgICAgICAg\nU2VydmVyTWVzc2FnZUZpbHRlciBmaWx0ZXI7CiAgICAgICAgQ2FsbGJhY2s8\nVm9pZD4gY2I7CiAgICAgICAgT2JqZWN0IGN0eDsKCiAgICAgICAgLy8gdHJh\nY2sgdGhlIG91dHN0YW5kaW5nIHNjYW4gcmVxdWVzdAogICAgICAgIC8vIHNv\nIHdlIGNvdWxkIGNhbmNlbCBpdAogICAgICAgIFNjYW5SZXF1ZXN0IG91dHN0\nYW5kaW5nU2NhblJlcXVlc3Q7CgogICAgICAgIGZpbmFsIHN0YXRpYyBpbnQg\nU0VRX0lEX1NMQUNLID0gMTA7CgogICAgICAgIHB1YmxpYyBBY3RpdmVTdWJz\nY3JpYmVyU3RhdGUoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBTdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBwcmVmZXJlbmNlcywKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcgbGFzdExvY2Fs\nU2VxSWREZWxpdmVyZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBEZWxpdmVyeUVuZFBvaW50IGRlbGl2ZXJ5RW5kUG9pbnQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXJ2ZXJNZXNz\nYWdlRmlsdGVyIGZpbHRlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIENhbGxiYWNrPFZvaWQ+IGNiLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgICAgIHRoaXMudG9waWMgPSB0b3BpYzsKICAgICAgICAgICAgdGhp\ncy5zdWJzY3JpYmVySWQgPSBzdWJzY3JpYmVySWQ7CiAgICAgICAgICAgIHRo\naXMubGFzdExvY2FsU2VxSWREZWxpdmVyZWQgPSBsYXN0TG9jYWxTZXFJZERl\nbGl2ZXJlZDsKICAgICAgICAgICAgdGhpcy5sYXN0U2VxSWRDb25zdW1lZFV0\naWwgPSBsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZDsKICAgICAgICAgICAgdGhp\ncy5kZWxpdmVyeUVuZFBvaW50ID0gZGVsaXZlcnlFbmRQb2ludDsKICAgICAg\nICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0ZXI7CiAgICAgICAgICAgIGlmIChw\ncmVmZXJlbmNlcy5oYXNNZXNzYWdlV2luZG93U2l6ZSgpKSB7CiAgICAgICAg\nICAgICAgICBtZXNzYWdlV2luZG93U2l6ZSA9IHByZWZlcmVuY2VzLmdldE1l\nc3NhZ2VXaW5kb3dTaXplKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBpZiAoRklGT0RlbGl2ZXJ5TWFuYWdlci50aGlzLmNmZy5n\nZXREZWZhdWx0TWVzc2FnZVdpbmRvd1NpemUoKSA+IDApIHsKICAgICAgICAg\nICAgICAgICAgICBtZXNzYWdlV2luZG93U2l6ZSA9CiAgICAgICAgICAgICAg\nICAgICAgICAgIEZJRk9EZWxpdmVyeU1hbmFnZXIudGhpcy5jZmcuZ2V0RGVm\nYXVsdE1lc3NhZ2VXaW5kb3dTaXplKCk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VXaW5kb3dTaXplID0g\nVU5MSU1JVEVEOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHRoaXMuY2IgPSBjYjsKICAgICAgICAgICAgdGhpcy5jdHgg\nPSBjdHg7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZXROb3RD\nb25uZWN0ZWQoU3Vic2NyaXB0aW9uRXZlbnQgZXZlbnQpIHsKICAgICAgICAg\nICAgdGhpcy5jb25uZWN0ZWRMb2NrLndyaXRlTG9jaygpLmxvY2soKTsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIGhhdmUgY2xvc2Vk\nIGl0LgogICAgICAgICAgICAgICAgaWYgKCFjb25uZWN0ZWQpIHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB0aGlzLmNvbm5lY3RlZCA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgLy8gcHV0IGl0c2VsZiBpbiBSZWFkQWhlYWQgcXVldWUgdG8gY2Fu\nY2VsIG91dHN0YW5kaW5nIHNjYW4gcmVxdWVzdAogICAgICAgICAgICAgICAg\nLy8gaWYgb3V0c3RhbmRpbmcgc2NhbiByZXF1ZXN0IGNhbGxiYWNrIGJlZm9y\nZSBjYW5jZWwgb3AgZXhlY3V0ZWQsCiAgICAgICAgICAgICAgICAvLyBub3Ro\naW5nIGl0IHdvdWxkIGNhbmNlbC4KICAgICAgICAgICAgICAgIGlmIChudWxs\nICE9IGNhY2hlICYmIG51bGwgIT0gb3V0c3RhbmRpbmdTY2FuUmVxdWVzdCkg\newogICAgICAgICAgICAgICAgICAgIGNhY2hlLmNhbmNlbFNjYW5SZXF1ZXN0\nKHRvcGljLCB0aGlzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkTG9j\nay53cml0ZUxvY2soKS51bmxvY2soKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKG51bGwgIT0gZXZlbnQgJiYKICAgICAgICAgICAgICAgIChT\ndWJzY3JpcHRpb25FdmVudC5UT1BJQ19NT1ZFRCA9PSBldmVudCB8fAogICAg\nICAgICAgICAgICAgIFN1YnNjcmlwdGlvbkV2ZW50LlNVQlNDUklQVElPTl9G\nT1JDRURfQ0xPU0VEID09IGV2ZW50KSkgewogICAgICAgICAgICAgICAgLy8g\nd2Ugc2hvdWxkIG5vdCBjbG9zZSB0aGUgY2hhbm5lbCBub3cgYWZ0ZXIgZW5h\nYmxpbmcgbXVsdGlwbGV4aW5nCiAgICAgICAgICAgICAgICBQdWJTdWJSZXNw\nb25zZSByZXNwb25zZSA9IFB1YlN1YlJlc3BvbnNlVXRpbHMuZ2V0UmVzcG9u\nc2VGb3JTdWJzY3JpcHRpb25FdmVudCgKICAgICAgICAgICAgICAgICAgICB0\nb3BpYywgc3Vic2NyaWJlcklkLCBldmVudAogICAgICAgICAgICAgICAgKTsK\nICAgICAgICAgICAgICAgIGRlbGl2ZXJ5RW5kUG9pbnQuc2VuZChyZXNwb25z\nZSwgbmV3IERlbGl2ZXJ5Q2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2VuZGluZ0ZpbmlzaGVkKCkgewogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBkbyBub3RoaW5nIG5vdwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCB0cmFuc2llbnRFcnJvck9uU2VuZCgpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZyBub3cKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcGVybWFuZW50RXJyb3JPblNl\nbmQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIGNoYW5uZWwg\naXMgYnJva2VuLCBjbG9zZSB0aGUgY2hhbm5lbAogICAgICAgICAgICAgICAg\nICAgICAgICBkZWxpdmVyeUVuZFBvaW50LmNsb3NlKCk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgLy8gdW5pbml0aWFsaXplIGZpbHRlcgogICAgICAgICAg\nICB0aGlzLmZpbHRlci51bmluaXRpYWxpemUoKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBCeXRlU3RyaW5nIGdldFRvcGljKCkgewogICAgICAgICAg\nICByZXR1cm4gdG9waWM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3lu\nY2hyb25pemVkIGxvbmcgZ2V0TGFzdFNjYW5FcnJvclRpbWUoKSB7CiAgICAg\nICAgICAgIHJldHVybiBsYXN0U2NhbkVycm9yVGltZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBzZXRMYXN0U2NhbkVy\ncm9yVGltZShsb25nIGxhc3RTY2FuRXJyb3JUaW1lKSB7CiAgICAgICAgICAg\nIHRoaXMubGFzdFNjYW5FcnJvclRpbWUgPSBsYXN0U2NhbkVycm9yVGltZTsK\nICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIENsZWFyIHRoZSBs\nYXN0IHNjYW4gZXJyb3IgdGltZSBzbyBpdCBjb3VsZCBiZSByZXRyeSBpbW1l\nZGlhdGVseS4KICAgICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQgc3luY2hy\nb25pemVkIHZvaWQgY2xlYXJMYXN0U2NhbkVycm9yVGltZSgpIHsKICAgICAg\nICAgICAgdGhpcy5sYXN0U2NhbkVycm9yVGltZSA9IC0xOwogICAgICAgIH0K\nCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNDb25uZWN0ZWQoKSB7CiAg\nICAgICAgICAgIGNvbm5lY3RlZExvY2sucmVhZExvY2soKS5sb2NrKCk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29ubmVj\ndGVkOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAg\nY29ubmVjdGVkTG9jay5yZWFkTG9jaygpLnVubG9jaygpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgc3luY2hyb25pemVk\nIHZvaWQgbWVzc2FnZUNvbnN1bWVkKGxvbmcgbmV3U2VxSWRDb25zdW1lZCkg\newogICAgICAgICAgICBpZiAobmV3U2VxSWRDb25zdW1lZCA8PSBsYXN0U2Vx\nSWRDb25zdW1lZFV0aWwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiU3Vic2Ny\naWJlciAoe30pIG1vdmVkIGNvbnN1bWVkIHB0ciBmcm9tIHt9IHRvIHt9LiIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmEodGhpcywgbGFzdFNl\ncUlkQ29uc3VtZWRVdGlsLCBuZXdTZXFJZENvbnN1bWVkKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgbGFzdFNlcUlkQ29uc3VtZWRVdGlsID0gbmV3\nU2VxSWRDb25zdW1lZDsKICAgICAgICAgICAgLy8gYWZ0ZXIgdXBkYXRlZCBz\nZXEgaWQgY2hlY2sgd2hldGhlciBpdCBzdGlsbCBleGNlZWQgbXNnIGxpbWl0\nYXRpb24KICAgICAgICAgICAgaWYgKG1zZ0xpbWl0RXhjZWVkZWQoKSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChpc1Rocm90dGxlZCkgewogICAgICAgICAgICAgICAgaXNUaHJv\ndHRsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJU\ncnkgdG8gd2FrZSB1cCBzdWJzY3JpYmVyICh7fSkgdG8gZGVsaXZlciBtZXNz\nYWdlcyBhZ2FpbiA6IGxhc3QgZGVsaXZlcmVkIHt9LCBsYXN0IGNvbnN1bWVk\nIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YSh0aGlzLCBs\nYXN0TG9jYWxTZXFJZERlbGl2ZXJlZCwgbGFzdFNlcUlkQ29uc3VtZWRVdGls\nKSk7CgogICAgICAgICAgICAgICAgZW5xdWV1ZVdpdGhvdXRGYWlsdXJlKG5l\ndyBEZWxpdmVyeU1hbmFnZXJSZXF1ZXN0KCkgewogICAgICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHBlcmZvcm1SZXF1ZXN0KCkgewogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBlbnF1ZXVlCiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyUmV0cnlE\nZWxheUZvclN1YnNjcmliZXIoQWN0aXZlU3Vic2NyaWJlclN0YXRlLnRoaXMp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgYm9v\nbGVhbiBtc2dMaW1pdEV4Y2VlZGVkKCkgewogICAgICAgICAgICBpZiAobWVz\nc2FnZVdpbmRvd1NpemUgPT0gVU5MSU1JVEVEKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGxhc3RMb2NhbFNlcUlkRGVsaXZlcmVkIC0gbGFzdFNlcUlkQ29uc3VtZWRV\ndGlsID49IG1lc3NhZ2VXaW5kb3dTaXplKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBkZWxpdmVy\nTmV4dE1lc3NhZ2UoKSB7CiAgICAgICAgICAgIGNvbm5lY3RlZExvY2sucmVh\nZExvY2soKS5sb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBkb0RlbGl2ZXJOZXh0TWVzc2FnZSgpOwogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgY29ubmVjdGVkTG9jay5yZWFkTG9j\naygpLnVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwcml2YXRlIHZvaWQgZG9EZWxpdmVyTmV4dE1lc3NhZ2UoKSB7CiAgICAg\nICAgICAgIGlmICghY29ubmVjdGVkKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\ndGhpcykgewogICAgICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciB3ZSBo\nYXZlIGRlbGl2ZXJlZCBlbm91Z2ggbWVzc2FnZXMgd2l0aG91dCByZWNlaXZp\nbmcgdGhlaXIgY29uc3VtZXMKICAgICAgICAgICAgICAgIGlmIChtc2dMaW1p\ndEV4Y2VlZGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5m\nbygiU3Vic2NyaWJlciAoe30pIGlzIHRocm90dGxlZCA6IGxhc3QgZGVsaXZl\ncmVkIHt9LCBsYXN0IGNvbnN1bWVkIHt9LiIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdmEodGhpcywgbGFzdExvY2FsU2VxSWREZWxpdmVy\nZWQsIGxhc3RTZXFJZENvbnN1bWVkVXRpbCkpOwogICAgICAgICAgICAgICAg\nICAgIGlzVGhyb3R0bGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAv\nLyBkbyBub3RoaW5nLCBzaW5jZSB0aGUgZGVsaXZlcnkgcHJvY2VzcyB3b3Vs\nZCBiZSB0aHJvdHRsZWQuCiAgICAgICAgICAgICAgICAgICAgLy8gQWZ0ZXIg\nbWVzc2FnZSBjb25zdW1lZCwgaXQgd291bGQgYmUgYWRkZWQgYmFjayB0byBy\nZXRyeSBxdWV1ZS4KICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbG9jYWxTZXFJZERlbGl2\nZXJpbmdOb3cgPSBwZXJzaXN0ZW5jZU1nci5nZXRTZXFJZEFmdGVyU2tpcHBp\nbmcodG9waWMsIGxhc3RMb2NhbFNlcUlkRGVsaXZlcmVkLCAxKTsKCiAgICAg\nICAgICAgICAgICBvdXRzdGFuZGluZ1NjYW5SZXF1ZXN0ID0gbmV3IFNjYW5S\nZXF1ZXN0KHRvcGljLCBsb2NhbFNlcUlkRGVsaXZlcmluZ05vdywKICAgICAg\nICAgICAgICAgICAgICAgICAgLyogY2FsbGJhY2s9ICovdGhpcywgLyogY3R4\nPSAqL251bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwZXJzaXN0\nZW5jZU1nci5zY2FuU2luZ2xlTWVzc2FnZShvdXRzdGFuZGluZ1NjYW5SZXF1\nZXN0KTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqID09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PQogICAgICAgICAqIHtAbGluayBDYW5jZWxTY2FuUmVx\ndWVzdH0gbWV0aG9kcwogICAgICAgICAqCiAgICAgICAgICogVGhpcyBtZXRo\nb2QgcnVucyBpbnMgc2FtZSB0aHJlYWRzIHdpdGggU2NhbkNhbGxiYWNrLiBX\naGVuIGl0IHJ1bnMsCiAgICAgICAgICogaXQgY2hlY2tlZCB3aGV0aGVyIGl0\nIGlzIG91dHN0YW5kaW5nIHNjYW4gcmVxdWVzdC4gaWYgdGhlcmUgaXMgb25l\nLAogICAgICAgICAqIGNhbmNlbCBpdC4KICAgICAgICAgKi8KICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgU2NhblJlcXVlc3QgZ2V0U2NhblJl\ncXVlc3QoKSB7CiAgICAgICAgICAgIC8vIG5vIHJhY2UgYmV0d2VlbiBjYW5j\nZWwgcmVxdWVzdCBhbmQgc2NhbiBjYWxsYmFjawogICAgICAgICAgICAvLyB0\naGUgb25seSByYWNlIGlzIGJldHdlZW4gc3RvcFNlcnZpbmcgYW5kIGRlbGl2\nZXJOZXh0TWVzc2FnZQogICAgICAgICAgICAvLyBkZWxpdmVyTmV4dE1lc3Nh\nZ2Ugd291bGQgYmUgZXhlY3V0ZWQgaW4gbmV0dHkgY2FsbGJhY2sgd2hpY2gg\naXMgaW4gbmV0dHkgdGhyZWFkCiAgICAgICAgICAgIC8vIHN0b3BTZXJ2aW5n\nIGlzIHJ1biBpbiBkZWxpdmVyeSB0aHJlYWQuIGlmIHN0b3BTZXJ2aW5nIHJ1\nbnMgYmVmb3JlIGRlbGl2ZXJOZXh0TWVzc2FnZQogICAgICAgICAgICAvLyBk\nZWxpdmVyTmV4dE1lc3NhZ2Ugd291bGQgaGF2ZSBjaGFuY2UgdG8gcHV0IGEg\nc3R1YiBpbiBSZWFkQWhlYWRDYWNoZQogICAgICAgICAgICAvLyB0aGVuIHdl\nIGRvbid0IGhhdmUgYW55IGNoYW5jZSB0byBjYW5jZWwgaXQuCiAgICAgICAg\nICAgIC8vIHVzZSBjb25uZWN0ZWRMb2NrIHRvIGF2b2lkIHN1Y2ggcmFjZS4K\nICAgICAgICAgICAgcmV0dXJuIG91dHN0YW5kaW5nU2NhblJlcXVlc3Q7CiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIGJvb2xlYW4gY2hlY2tDb25uZWN0\nZWQoKSB7CiAgICAgICAgICAgIGNvbm5lY3RlZExvY2sucmVhZExvY2soKS5s\nb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBt\nZXNzYWdlIHNjYW5uZWQgbWVhbnMgdGhlIG91dHN0YW5kaW5nIHJlcXVlc3Qg\naXMgZXhlY3V0ZWQKICAgICAgICAgICAgICAgIG91dHN0YW5kaW5nU2NhblJl\ncXVlc3QgPSBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbm5lY3Rl\nZDsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIGNv\nbm5lY3RlZExvY2sucmVhZExvY2soKS51bmxvY2soKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09CiAgICAgICAgICoge0BsaW5rIFNjYW5DYWxsYmFja30gbWV0\naG9kcwogICAgICAgICAqLwoKICAgICAgICBwdWJsaWMgdm9pZCBtZXNzYWdl\nU2Nhbm5lZChPYmplY3QgY3R4LCBNZXNzYWdlIG1lc3NhZ2UpIHsKICAgICAg\nICAgICAgaWYgKCFjaGVja0Nvbm5lY3RlZCgpKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghZmls\ndGVyLnRlc3RNZXNzYWdlKG1lc3NhZ2UpKSB7CiAgICAgICAgICAgICAgICAv\nLyBmb3IgZmlsdGVyZWQgb3V0IG1lc3NhZ2VzLCB3ZSBkb24ndCBkZWxpdmVy\nIHRoZSBtZXNzYWdlIHRvIGNsaWVudCwgc28gd2Ugd291bGQgbm90CiAgICAg\nICAgICAgICAgICAvLyByZWNlaXZlIGl0cyBjb25zdW1lIHJlcXVlc3Qgd2hp\nY2ggbW92ZXMgdGhlIDxpPmxhc3RTZXFJZENvbnN1bWVkVXRpbDwvaT4gcG9p\nbnRlci4KICAgICAgICAgICAgICAgIC8vIHdlIG1vdmUgdGhlIDxpPmxhc3RT\nZXFJZENvbnN1bWVkVXRpbDwvaT4gaGVyZSBmb3IgZmlsdGVyZWQgb3V0IG1l\nc3NhZ2VzLCB3aGljaCB3b3VsZAogICAgICAgICAgICAgICAgLy8gYXZvaWQg\nYSBzdWJzY3JpYmVyIGJlaW5nIHRocm90dGxlZCBkdWUgdG8gdGhlIG1lc3Nh\nZ2UgZ2FwIGludHJvZHVjZWQgYnkgZmlsdGVyaW5nLgogICAgICAgICAgICAg\nICAgLy8KICAgICAgICAgICAgICAgIC8vIGl0IGlzIE9LIHRvIG1vdmUgPGk+\nbGFzdFNlcUlkQ29uc3VtZWRVdGlsPC9pPiBoZXJlLCBzaW5jZSB0aGlzIHBv\naW50ZXIgaXMgc3Vic2NyaWJlcidzCiAgICAgICAgICAgICAgICAvLyBkZWxp\ndmVyeSBzdGF0ZSB3aGljaCB0byB0cm90dGxpbmcgZGVsaXZlci4gY2hhbmdp\nbmcgPGk+bGFzdFNlcUlkQ29uc3VtZWRVdGlsPC9pPiB3b3VsZAogICAgICAg\nICAgICAgICAgLy8gbm90IGFmZmVjdCB0aGUgc3Vic2NyaWJlcidzIGNvbnN1\nbWUgcG9pbnRlciBpbiB6b29rZWVwZXIgd2hpY2ggaXMgbWFuYWdlZCBpbiBz\ndWJzY3JpcHRpb24KICAgICAgICAgICAgICAgIC8vIG1hbmFnZXIuCiAgICAg\nICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gQW5kIG1hcmtpbmcg\nbWVzc2FnZSBjb25zdW1lZCBiZWZvcmUgY2FsbGluZyBzZW5kaW5nIGZpbmlz\naGVkLCB3b3VsZCBhdm9pZCB0aGUgc3Vic2NyaWJlcgogICAgICAgICAgICAg\nICAgLy8gYmVpbmcgdGhyb3R0bGVkIGZpcnN0IGFuZCByZWxlYXNlZCBmcm9t\nIHRocm90dGxlZCBzdGF0ZSBsYXN0ZXIuCiAgICAgICAgICAgICAgICBtZXNz\nYWdlQ29uc3VtZWQobWVzc2FnZS5nZXRNc2dJZCgpLmdldExvY2FsQ29tcG9u\nZW50KCkpOwogICAgICAgICAgICAgICAgc2VuZGluZ0ZpbmlzaGVkKCk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgbWV0aG9kIGJlbG93IHdpbGwg\naW52b2tlIG91ciBzZW5kaW5nRmluaXNoZWQoKSBtZXRob2Qgd2hlbgogICAg\nICAgICAgICAgKiBkb25lCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBQ\ndWJTdWJSZXNwb25zZSByZXNwb25zZSA9IFB1YlN1YlJlc3BvbnNlLm5ld0J1\naWxkZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC5zZXRQcm90b2NvbFZlcnNpb24oUHJvdG9jb2xWZXJzaW9uLlZFUlNJT05f\nT05FKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5z\nZXRTdGF0dXNDb2RlKFN0YXR1c0NvZGUuU1VDQ0VTUykuc2V0VHhuSWQoMCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0TWVz\nc2FnZShtZXNzYWdlKS5zZXRUb3BpYyh0b3BpYykKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuc2V0U3Vic2NyaWJlcklkKHN1YnNj\ncmliZXJJZCkuYnVpbGQoKTsKCiAgICAgICAgICAgIGRlbGl2ZXJ5RW5kUG9p\nbnQuc2VuZChyZXNwb25zZSwgLy8KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGNhbGxiYWNrID0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHRoaXMpOwoKICAgICAgICB9CgogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHNjYW5GYWlsZWQoT2JqZWN0IGN0\neCwgRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICBpZiAoIWNo\nZWNrQ29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gd2FpdCBmb3Igc29tZSB0aW1l\nIGFuZCB0aGVuIHJldHJ5CiAgICAgICAgICAgIHJldHJ5RXJyb3JlZFN1YnNj\ncmliZXJBZnRlckRlbGF5KHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgc2NhbkZpbmlzaGVkKE9iamVj\ndCBjdHgsIFJlYXNvbkZvckZpbmlzaCByZWFzb24pIHsKICAgICAgICAgICAg\nY2hlY2tDb25uZWN0ZWQoKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgICAqIHtAbGluayBE\nZWxpdmVyeUNhbGxiYWNrfSBtZXRob2RzCiAgICAgICAgICovCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgc2VuZGluZ0ZpbmlzaGVk\nKCkgewogICAgICAgICAgICBpZiAoIWlzQ29ubmVjdGVkKCkpIHsKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBsYXN0TG9j\nYWxTZXFJZERlbGl2ZXJlZCA9IGxvY2FsU2VxSWREZWxpdmVyaW5nTm93OwoK\nICAgICAgICAgICAgICAgIGlmIChsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZCA+\nIGxhc3RTZXFJZENvbW11bmljYXRlZEV4dGVybmFsbHkgKyBTRVFfSURfU0xB\nQ0spIHsKICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBUaGUgb3JkZXIg\nb2YgdGhlIG5leHQgMiBzdGF0ZW1lbnRzIGlzIGltcG9ydGFudC4gV2Ugc2hv\ndWxkCiAgICAgICAgICAgICAgICAgICAgLy8gc3VibWl0IGEgcmVxdWVzdCB0\nbyBjaGFuZ2Ugb3VyIGRlbGl2ZXJ5IHBvaW50ZXIgb25seSAqYWZ0ZXIqIHdl\nCiAgICAgICAgICAgICAgICAgICAgLy8gaGF2ZSBhY3R1YWxseSBjaGFuZ2Vk\nIGl0LiBPdGhlcndpc2UsIHRoZXJlIGlzIGEgcmFjZSBjb25kaXRpb24KICAg\nICAgICAgICAgICAgICAgICAvLyB3aXRoIHJlbW92YWwgb2YgdGhpcyBjaGFu\nbmVsLCB3LnIudCwgbWFpbnRhaW5pbmcgdGhlIGRlbGl2ZXJ5UHRycwogICAg\nICAgICAgICAgICAgICAgIC8vIHRyZWUgbWFwLgogICAgICAgICAgICAgICAg\nICAgIGxvbmcgcHJldklkID0gbGFzdFNlcUlkQ29tbXVuaWNhdGVkRXh0ZXJu\nYWxseTsKICAgICAgICAgICAgICAgICAgICBsYXN0U2VxSWRDb21tdW5pY2F0\nZWRFeHRlcm5hbGx5ID0gbGFzdExvY2FsU2VxSWREZWxpdmVyZWQ7CiAgICAg\nICAgICAgICAgICAgICAgbW92ZURlbGl2ZXJ5UHRyRm9yd2FyZCh0aGlzLCBw\ncmV2SWQsIGxhc3RMb2NhbFNlcUlkRGVsaXZlcmVkKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBpbmNyZW1lbnQg\nZGVsaXZlcmllZCBtZXNzYWdlCiAgICAgICAgICAgIFNlcnZlclN0YXRzLmdl\ndEluc3RhbmNlKCkuaW5jcmVtZW50TWVzc2FnZXNEZWxpdmVyZWQoKTsKICAg\nICAgICAgICAgZGVsaXZlck5leHRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgc3luY2hyb25pemVkIGxvbmcgZ2V0TGFzdFNlcUlkQ29t\nbXVuaWNhdGVkRXh0ZXJuYWxseSgpIHsKICAgICAgICAgICAgcmV0dXJuIGxh\nc3RTZXFJZENvbW11bmljYXRlZEV4dGVybmFsbHk7CiAgICAgICAgfQoKCiAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcGVybWFuZW50\nRXJyb3JPblNlbmQoKSB7CiAgICAgICAgICAgIC8vIHRoZSB1bmRlcmx5aW5n\nIGNoYW5uZWwgaXMgYnJva2VuLCB0aGUgY2hhbm5lbCB3aWxsCiAgICAgICAg\nICAgIC8vIGJlIGNsb3NlZCBpbiBVbWJyZWxsYUhhbmRsZXIgd2hlbiBleGNl\ncHRpb24gaGFwcGVuZWQuCiAgICAgICAgICAgIC8vIHNvIHdlIGRvbid0IG5l\nZWQgdG8gY2xvc2UgdGhlIGNoYW5uZWwgYWdhaW4KICAgICAgICAgICAgc3Rv\ncFNlcnZpbmdTdWJzY3JpYmVyKHRvcGljLCBzdWJzY3JpYmVySWQsIG51bGws\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOT1BfQ0FMTEJB\nQ0ssIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIHZvaWQgdHJhbnNpZW50RXJyb3JPblNlbmQoKSB7CiAgICAg\nICAgICAgIHJldHJ5RXJyb3JlZFN1YnNjcmliZXJBZnRlckRlbGF5KHRoaXMp\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09CiAgICAgICAgICoge0BsaW5rIERlbGl2ZXJ5TWFuYWdlclJl\ncXVlc3R9IG1ldGhvZHMKICAgICAgICAgKi8KICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwdWJsaWMgdm9pZCBwZXJmb3JtUmVxdWVzdCgpIHsKICAgICAg\nICAgICAgLy8gUHV0IHRoaXMgc3Vic2NyaWJlciBpbiB0aGUgY2hhbm5lbCB0\nbyBzdWJzY3JpYmVyIG1hcHBpbmcKICAgICAgICAgICAgQWN0aXZlU3Vic2Ny\naWJlclN0YXRlIHByZXZTdWJzY3JpYmVyID0KICAgICAgICAgICAgICAgIHN1\nYnNjcmliZXJTdGF0ZXMucHV0KG5ldyBUb3BpY1N1YnNjcmliZXIodG9waWMs\nIHN1YnNjcmliZXJJZCksIHRoaXMpOwoKICAgICAgICAgICAgLy8gYWZ0ZXIg\ncHV0IHRoZSBhY3RpdmUgc3Vic2NyaWJlciBpbiBzdWJzY3JpYmVyIHN0YXRl\ncyBtYXBwaW5nCiAgICAgICAgICAgIC8vIHRyaWdnZXIgdGhlIGNhbGxiYWNr\nIHRvIHRlbGwgaXQgc3RhcnRlZCB0byBkZWxpdmVyIHRoZSBtZXNzYWdlCiAg\nICAgICAgICAgIC8vIHNob3VsZCBsZXQgc3Vic2NyaWJlciByZXNwb25zZSBn\nbyBmaXJzdCBiZWZvcmUgZmlyc3QgZGVsaXZlcmVkIG1lc3NhZ2UuCiAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgKFZvaWQpbnVsbCk7\nCgogICAgICAgICAgICBpZiAocHJldlN1YnNjcmliZXIgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgLy8gd2UgYWxyZWFkeSBpbiB0aGUgZGVsaXZlcnkg\ndGhyZWFkLCB3ZSBkb24ndCBuZWVkIHRvIGVxdWV1ZSBhIHN0b3AgcmVxdWVz\ndAogICAgICAgICAgICAgICAgLy8ganVzdCBzdG9wIGl0IG5vdywgc2luY2Ug\nc3RvcCBpcyBub3QgYmxvY2tpbmcgb3BlcmF0aW9uLgogICAgICAgICAgICAg\nICAgLy8gYW5kIGFsc28gaXQgY2xlYW5zIHRoZSBvbGQgc3RhdGUgb2YgdGhl\nIGFjdGl2ZSBzdWJzY3JpYmVyIGltbWVkaWF0ZWx5LgogICAgICAgICAgICAg\nICAgU3Vic2NyaXB0aW9uRXZlbnQgc2U7CiAgICAgICAgICAgICAgICBpZiAo\nZGVsaXZlcnlFbmRQb2ludC5lcXVhbHMocHJldlN1YnNjcmliZXIuZGVsaXZl\ncnlFbmRQb2ludCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVi\ndWcoIlN1YnNjcmliZXIge30gcmVwbGFjZWQgYSBkdXBsaWNhdGVkIHN1YnNj\ncmliZXIge30gYXQgc2FtZSBkZWxpdmVyeSBwb2ludCB7fS4iLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2YSh0aGlzLCBwcmV2U3Vic2Ny\naWJlciwgZGVsaXZlcnlFbmRQb2ludCkpOwogICAgICAgICAgICAgICAgICAg\nIHNlID0gbnVsbDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJTdWJzY3JpYmVyIHt9IGZyb20g\nZGVsaXZlcnkgcG9pbnQge30gZm9yY2VsbHkgY2xvc2VkIGRlbGl2ZXJ5IHBv\naW50IHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZh\nKHRoaXMsIGRlbGl2ZXJ5RW5kUG9pbnQsIHByZXZTdWJzY3JpYmVyLmRlbGl2\nZXJ5RW5kUG9pbnQpKTsKICAgICAgICAgICAgICAgICAgICBzZSA9IFN1YnNj\ncmlwdGlvbkV2ZW50LlNVQlNDUklQVElPTl9GT1JDRURfQ0xPU0VEOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZG9TdG9wU2VydmluZ1N1\nYnNjcmliZXIocHJldlN1YnNjcmliZXIsIHNlKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAg\nICAgICBsYXN0U2VxSWRDb21tdW5pY2F0ZWRFeHRlcm5hbGx5ID0gbGFzdExv\nY2FsU2VxSWREZWxpdmVyZWQ7CiAgICAgICAgICAgICAgICBhZGREZWxpdmVy\neVB0cih0aGlzLCBsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGRlbGl2ZXJOZXh0TWVzc2FnZSgpOwogICAg\nICAgIH07CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2Ig\nPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAgICBzYi5hcHBlbmQo\nIlRvcGljOiAiKTsKICAgICAgICAgICAgc2IuYXBwZW5kKHRvcGljLnRvU3Ry\naW5nVXRmOCgpKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCJTdWJzY3JpYmVy\nOiAiKTsKICAgICAgICAgICAgc2IuYXBwZW5kKHN1YnNjcmliZXJJZC50b1N0\ncmluZ1V0ZjgoKSk7CiAgICAgICAgICAgIHNiLmFwcGVuZCgiLCBEZWxpdmVy\neVB0cjogIik7CiAgICAgICAgICAgIHNiLmFwcGVuZChsYXN0TG9jYWxTZXFJ\nZERlbGl2ZXJlZCk7CiAgICAgICAgICAgIHJldHVybiBzYi50b1N0cmluZygp\nOwoKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGNsYXNzIFN0b3BT\nZXJ2aW5nU3Vic2NyaWJlciBpbXBsZW1lbnRzIERlbGl2ZXJ5TWFuYWdlclJl\ncXVlc3QgewogICAgICAgIFRvcGljU3Vic2NyaWJlciB0czsKICAgICAgICBT\ndWJzY3JpcHRpb25FdmVudCBldmVudDsKICAgICAgICBmaW5hbCBDYWxsYmFj\nazxWb2lkPiBjYjsKICAgICAgICBmaW5hbCBPYmplY3QgY3R4OwoKICAgICAg\nICBwdWJsaWMgU3RvcFNlcnZpbmdTdWJzY3JpYmVyKEJ5dGVTdHJpbmcgdG9w\naWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uRXZlbnQgZXZlbnQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFj\nazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgICAgICB0\naGlzLnRzID0gbmV3IFRvcGljU3Vic2NyaWJlcih0b3BpYywgc3Vic2NyaWJl\ncklkKTsKICAgICAgICAgICAgdGhpcy5ldmVudCA9IGV2ZW50OwogICAgICAg\nICAgICB0aGlzLmNiID0gY2FsbGJhY2s7CiAgICAgICAgICAgIHRoaXMuY3R4\nID0gY3R4OwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgcGVyZm9ybVJlcXVlc3QoKSB7CiAgICAgICAgICAgIEFj\ndGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJzY3JpYmVyID0gc3Vic2NyaWJlclN0\nYXRlcy5yZW1vdmUodHMpOwogICAgICAgICAgICBpZiAobnVsbCAhPSBzdWJz\nY3JpYmVyKSB7CiAgICAgICAgICAgICAgICBkb1N0b3BTZXJ2aW5nU3Vic2Ny\naWJlcihzdWJzY3JpYmVyLCBldmVudCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAg\nICB9CgogICAgfQoKICAgIC8qKgogICAgICogU3RvcCBzZXJ2aW5nIGEgc3Vi\nc2NyaWJlci4gVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBpbiBhCiAg\nICAgKiB7QGxpbmsgRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdH0uCiAgICAgKgog\nICAgICogQHBhcmFtIHN1YnNjcmliZXIKICAgICAqICAgICAgICAgIEFjdGl2\nZSBTdWJzY3JpYmVyIHRvIHN0b3AKICAgICAqIEBwYXJhbSBldmVudAogICAg\nICogICAgICAgICAgU3Vic2NyaXB0aW9uIEV2ZW50IGZvciB0aGUgc3RvcCBy\nZWFzb24KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRvU3RvcFNlcnZpbmdT\ndWJzY3JpYmVyKEFjdGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJzY3JpYmVyLCBT\ndWJzY3JpcHRpb25FdmVudCBldmVudCkgewogICAgICAgIC8vIFRoaXMgd2ls\nbCBhdXRvbWF0aWNhbGx5IHN0b3AgZGVsaXZlcnksIGFuZCBkaXNjb25uZWN0\nIHRoZSBjaGFubmVsCiAgICAgICAgc3Vic2NyaWJlci5zZXROb3RDb25uZWN0\nZWQoZXZlbnQpOwoKICAgICAgICAvLyBpZiB0aGUgc3Vic2NyaWJlciBoYXMg\nbW92ZWQgb24sIGEgbW92ZSByZXF1ZXN0IGZvciBpdHMgZGVsaXZlcnkKICAg\nICAgICAvLyBwb2ludGVyIG11c3QgYmUgcGVuZGluZyBpbiB0aGUgcmVxdWVz\ndCBxdWV1ZS4gTm90ZSB0aGF0IHRoZQogICAgICAgIC8vIHN1YnNjcmliZXIg\nZmlyc3QgY2hhbmdlcyBpdHMgZGVsaXZlcnkgcG9pbnRlciBhbmQgdGhlbiBz\ndWJtaXRzIGEKICAgICAgICAvLyByZXF1ZXN0IHRvIG1vdmUgc28gdGhpcyB3\nb3Jrcy4KICAgICAgICByZW1vdmVEZWxpdmVyeVB0cihzdWJzY3JpYmVyLCBz\ndWJzY3JpYmVyLmdldExhc3RTZXFJZENvbW11bmljYXRlZEV4dGVybmFsbHko\nKSwgLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpc0Fic2VuY2VP\naz0KICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHBydW5lVG9waWM9CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgdHJ1ZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGNsYXNz\nIERlbGl2ZXJ5UHRyTW92ZSBpbXBsZW1lbnRzIERlbGl2ZXJ5TWFuYWdlclJl\ncXVlc3QgewoKICAgICAgICBBY3RpdmVTdWJzY3JpYmVyU3RhdGUgc3Vic2Ny\naWJlcjsKICAgICAgICBMb25nIG9sZFNlcUlkOwogICAgICAgIExvbmcgbmV3\nU2VxSWQ7CgogICAgICAgIHB1YmxpYyBEZWxpdmVyeVB0ck1vdmUoQWN0aXZl\nU3Vic2NyaWJlclN0YXRlIHN1YnNjcmliZXIsIExvbmcgb2xkU2VxSWQsIExv\nbmcgbmV3U2VxSWQpIHsKICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVyID0g\nc3Vic2NyaWJlcjsKICAgICAgICAgICAgdGhpcy5vbGRTZXFJZCA9IG9sZFNl\ncUlkOwogICAgICAgICAgICB0aGlzLm5ld1NlcUlkID0gbmV3U2VxSWQ7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9p\nZCBwZXJmb3JtUmVxdWVzdCgpIHsKICAgICAgICAgICAgQnl0ZVN0cmluZyB0\nb3BpYyA9IHN1YnNjcmliZXIuZ2V0VG9waWMoKTsKICAgICAgICAgICAgbG9u\nZyBwcmV2TWluU2VxSWQgPSBnZXRNaW5pbXVtU2VxSWQodG9waWMpOwoKICAg\nICAgICAgICAgaWYgKHN1YnNjcmliZXIuaXNDb25uZWN0ZWQoKSkgewogICAg\nICAgICAgICAgICAgcmVtb3ZlRGVsaXZlcnlQdHIoc3Vic2NyaWJlciwgb2xk\nU2VxSWQsIC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAv\nLyBpc0Fic2VuY2VPaz0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gcHJ1bmVUb3BpYz0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZhbHNlKTsKCiAgICAgICAgICAgICAgICBhZGREZWxpdmVyeVB0cihz\ndWJzY3JpYmVyLCBuZXdTZXFJZCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICByZW1vdmVEZWxpdmVyeVB0cihzdWJzY3JpYmVyLCBv\nbGRTZXFJZCwgLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGlzQWJzZW5jZU9rPQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdHJ1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIHBydW5lVG9waWM9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0cnVlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9uZyBu\nb3dNaW5TZXFJZCA9IGdldE1pbmltdW1TZXFJZCh0b3BpYyk7CgogICAgICAg\nICAgICBpZiAobm93TWluU2VxSWQgPiBwcmV2TWluU2VxSWQpIHsKICAgICAg\nICAgICAgICAgIHBlcnNpc3RlbmNlTWdyLmRlbGl2ZXJlZFVudGlsKHRvcGlj\nLCBub3dNaW5TZXFJZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHJvdGVjdGVkIGNsYXNzIFNodXRkb3duRGVsaXZlcnlNYW5hZ2Vy\nUmVxdWVzdCBpbXBsZW1lbnRzIERlbGl2ZXJ5TWFuYWdlclJlcXVlc3Qgewog\nICAgICAgIC8vIFRoaXMgaXMgYSBzaW1wbGUgdHlwZSBvZiBSZXF1ZXN0IHdl\nIHdpbGwgZW5xdWV1ZSB3aGVuIHRoZQogICAgICAgIC8vIFB1YlN1YlNlcnZl\nciBpcyBzaHV0IGRvd24gYW5kIHdlIHdhbnQgdG8gc3RvcCB0aGUgRGVsaXZl\ncnlNYW5hZ2VyCiAgICAgICAgLy8gdGhyZWFkLgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHBlcmZvcm1SZXF1ZXN0KCkgewogICAg\nICAgICAgICBrZWVwUnVubmluZyA9IGZhbHNlOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAg\nKgogICAgICogRHVtYiBmYWN0b3JpZXMgZm9yIG91ciBtYXAgbWV0aG9kcwog\nICAgICovCiAgICBwcm90ZWN0ZWQgc3RhdGljIGNsYXNzIFRyZWVNYXBMb25n\nVG9TZXRTdWJzY3JpYmVyRmFjdG9yeSBpbXBsZW1lbnRzCiAgICAgICAgRmFj\ndG9yeTxTb3J0ZWRNYXA8TG9uZywgU2V0PEFjdGl2ZVN1YnNjcmliZXJTdGF0\nZT4+PiB7CiAgICAgICAgc3RhdGljIFRyZWVNYXBMb25nVG9TZXRTdWJzY3Jp\nYmVyRmFjdG9yeSBpbnN0YW5jZSA9IG5ldyBUcmVlTWFwTG9uZ1RvU2V0U3Vi\nc2NyaWJlckZhY3RvcnkoKTsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIFNvcnRlZE1hcDxMb25nLCBTZXQ8QWN0aXZlU3Vic2NyaWJlclN0\nYXRlPj4gbmV3SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nVHJlZU1hcDxMb25nLCBTZXQ8QWN0aXZlU3Vic2NyaWJlclN0YXRlPj4oKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBI\nYXNoTWFwU3Vic2NyaWJlckZhY3RvcnkgaW1wbGVtZW50cyBGYWN0b3J5PFNl\ndDxBY3RpdmVTdWJzY3JpYmVyU3RhdGU+PiB7CiAgICAgICAgc3RhdGljIEhh\nc2hNYXBTdWJzY3JpYmVyRmFjdG9yeSBpbnN0YW5jZSA9IG5ldyBIYXNoTWFw\nU3Vic2NyaWJlckZhY3RvcnkoKTsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIFNldDxBY3RpdmVTdWJzY3JpYmVyU3RhdGU+IG5ld0luc3Rh\nbmNlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IEhhc2hTZXQ8QWN0aXZl\nU3Vic2NyaWJlclN0YXRlPigpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyB2b2lkIG9uU3ViQ2hhbm5lbERpc2Nvbm5lY3Rl\nZChUb3BpY1N1YnNjcmliZXIgdG9waWNTdWJzY3JpYmVyKSB7CiAgICAgICAg\nc3RvcFNlcnZpbmdTdWJzY3JpYmVyKHRvcGljU3Vic2NyaWJlci5nZXRUb3Bp\nYygpLCB0b3BpY1N1YnNjcmliZXIuZ2V0U3Vic2NyaWJlcklkKCksCiAgICAg\nICAgICAgICAgICBudWxsLCBOT1BfQ0FMTEJBQ0ssIG51bGwpOwogICAgfQoK\nfQo=\n","encoding":"base64"}

