{"sha":"e284ace554c987eb9ff1e23490f316bf8793f95a","node_id":"MDQ6QmxvYjE1NzU5NTY6ZTI4NGFjZTU1NGM5ODdlYjlmZjFlMjM0OTBmMzE2YmY4NzkzZjk1YQ==","size":15509,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/e284ace554c987eb9ff1e23490f316bf8793f95a","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuZGVsaXZlcnk7CgppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKCmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZh\nLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnRE\nb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5p\ndDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNJ\nbnRlZ2VyOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb25maWd1cmF0\naW9uLkNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nY29uZmlndXJhdGlvbi5Db25maWd1cmF0aW9uRXhjZXB0aW9uOwogCmltcG9y\ndCBvcmcuanVuaXQuQmVmb3JlOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7Cmlt\ncG9ydCBvcmcuanVuaXQucnVubmVyLlJ1bldpdGg7CmltcG9ydCBvcmcuanVu\naXQucnVubmVycy5QYXJhbWV0ZXJpemVkOwppbXBvcnQgb3JnLmp1bml0LnJ1\nbm5lcnMuUGFyYW1ldGVyaXplZC5QYXJhbWV0ZXJzOwppbXBvcnQgc3RhdGlj\nIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RmFsc2U7CmltcG9ydCBzdGF0aWMg\nb3JnLmp1bml0LkFzc2VydC5hc3NlcnRUcnVlOwppbXBvcnQgc3RhdGljIG9y\nZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1YWxzOwoKaW1wb3J0IGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5jbGllbnQuSGVkd2lnQ2xpZW50OwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuY2xpZW50LmFwaS5NZXNzYWdlSGFuZGxlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuUHVibGlzaGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3JpYmVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVyLkNsaWVudE1lc3NhZ2VGaWx0ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5maWx0ZXIuTWVzc2FnZUZpbHRl\nckJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5maWx0ZXIuU2VydmVy\nTWVzc2FnZUZpbHRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2U7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nSGVhZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlczsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvZXh0ZW5zaW9ucy5TdWJzY3JpcHRpb25TdGF0ZVV0aWxz\nOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5IZWR3aWdIdWJU\nZXN0QmFzZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21t\nb24uU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnV0aWwuQ2FsbGJhY2s7CgpAUnVuV2l0aChQYXJhbWV0ZXJpemVkLmNs\nYXNzKQpwdWJsaWMgY2xhc3MgVGVzdFRocm90dGxpbmdEZWxpdmVyeSBleHRl\nbmRzIEhlZHdpZ0h1YlRlc3RCYXNlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgREVGQVVMVF9NRVNTQUdFX1dJTkRPV19TSVpFID0gMTA7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgT1BUX01PRCA9ICJNT0Qi\nOwoKICAgIHN0YXRpYyBjbGFzcyBNb2RNZXNzYWdlRmlsdGVyIGltcGxlbWVu\ndHMgU2VydmVyTWVzc2FnZUZpbHRlciwgQ2xpZW50TWVzc2FnZUZpbHRlciB7\nCgogICAgICAgIGludCBtb2Q7CgogICAgICAgIEBPdmVycmlkZQogICAgICAg\nIHB1YmxpYyBNZXNzYWdlRmlsdGVyQmFzZSBzZXRTdWJzY3JpcHRpb25QcmVm\nZXJlbmNlcyhCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmli\nZXJJZCwKICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvblByZWZlcmVuY2Vz\nIHByZWZlcmVuY2VzKSB7CiAgICAgICAgICAgIE1hcDxTdHJpbmcsIEJ5dGVT\ndHJpbmc+IHVzZXJPcHRpb25zID0gU3Vic2NyaXB0aW9uU3RhdGVVdGlscy5i\ndWlsZFVzZXJPcHRpb25zKHByZWZlcmVuY2VzKTsKICAgICAgICAgICAgQnl0\nZVN0cmluZyBtb2RWYWx1ZSA9IHVzZXJPcHRpb25zLmdldChPUFRfTU9EKTsK\nICAgICAgICAgICAgaWYgKG51bGwgPT0gbW9kVmFsdWUpIHsKICAgICAgICAg\nICAgICAgIG1vZCA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBtb2QgPSBJbnRlZ2VyLnZhbHVlT2YobW9kVmFsdWUudG9TdHJp\nbmdVdGY4KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gdGVzdE1lc3NhZ2UoTWVzc2FnZSBtZXNzYWdlKSB7CiAg\nICAgICAgICAgIGludCB2YWx1ZSA9IEludGVnZXIudmFsdWVPZihtZXNzYWdl\nLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgIHJldHVy\nbiAwID09IHZhbHVlICUgbW9kOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIFNlcnZlck1lc3NhZ2VGaWx0ZXIgaW5pdGlh\nbGl6ZShDb25maWd1cmF0aW9uIGNvbmYpIHRocm93cyBDb25maWd1cmF0aW9u\nRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIC8vIGRvIG5v\ndGhpbmcKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCB1bmluaXRpYWxp\nemUoKSB7CiAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcKICAgICAgICB9Cgog\nICAgfQoKICAgIHByb3RlY3RlZCBjbGFzcyBUaHJvdHRsZURlbGl2ZXJ5U2Vy\ndmVyQ29uZmlndXJhdGlvbiBleHRlbmRzIEh1YlNlcnZlckNvbmZpZ3VyYXRp\nb24gewoKICAgICAgICBUaHJvdHRsZURlbGl2ZXJ5U2VydmVyQ29uZmlndXJh\ndGlvbihpbnQgc2VydmVyUG9ydCwgaW50IHNzbFNlcnZlclBvcnQpIHsKICAg\nICAgICAgICAgc3VwZXIoc2VydmVyUG9ydCwgc3NsU2VydmVyUG9ydCk7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgaW50\nIGdldERlZmF1bHRNZXNzYWdlV2luZG93U2l6ZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIFRlc3RUaHJvdHRsaW5nRGVsaXZlcnkuREVGQVVMVF9NRVNTQUdF\nX1dJTkRPV19TSVpFOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQg\nY2xhc3MgVGhyb3R0bGVEZWxpdmVyeUNsaWVudENvbmZpZ3VyYXRpb24gZXh0\nZW5kcyBIdWJDbGllbnRDb25maWd1cmF0aW9uIHsKCiAgICAgICAgaW50IG1l\nc3NhZ2VXaW5kb3dTaXplOwoKICAgICAgICBUaHJvdHRsZURlbGl2ZXJ5Q2xp\nZW50Q29uZmlndXJhdGlvbigpIHsKICAgICAgICAgICAgdGhpcyhUZXN0VGhy\nb3R0bGluZ0RlbGl2ZXJ5LkRFRkFVTFRfTUVTU0FHRV9XSU5ET1dfU0laRSk7\nCiAgICAgICAgfQoKICAgICAgICBUaHJvdHRsZURlbGl2ZXJ5Q2xpZW50Q29u\nZmlndXJhdGlvbihpbnQgbWVzc2FnZVdpbmRvd1NpemUpIHsKICAgICAgICAg\nICAgdGhpcy5tZXNzYWdlV2luZG93U2l6ZSA9IG1lc3NhZ2VXaW5kb3dTaXpl\nOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIGludCBnZXRNYXhpbXVtT3V0c3RhbmRpbmdNZXNzYWdlcygpIHsKICAgICAg\nICAgICAgcmV0dXJuIG1lc3NhZ2VXaW5kb3dTaXplOwogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBzZXRNZXNzYWdlV2luZG93U2l6ZShpbnQgbWVzc2FnZVdp\nbmRvd1NpemUpIHsKICAgICAgICAgICAgdGhpcy5tZXNzYWdlV2luZG93U2l6\nZSA9IG1lc3NhZ2VXaW5kb3dTaXplOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNBdXRvU2VuZENvbnN1\nbWVNZXNzYWdlRW5hYmxlZCgpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaXNTdWJzY3JpcHRpb25DaGFubmVsU2hhcmluZ0VuYWJsZWQo\nKSB7CiAgICAgICAgICAgIHJldHVybiBpc1N1YnNjcmlwdGlvbkNoYW5uZWxT\naGFyaW5nRW5hYmxlZDsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIHB1Ymxpc2hOdW1zKFB1Ymxpc2hlciBwdWIsIEJ5dGVTdHJpbmcgdG9w\naWMsIGludCBzdGFydCwgaW50IG51bSwgaW50IE0pIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDw9IG51bTsgaSsrKSB7\nCiAgICAgICAgICAgIFB1YlN1YlByb3RvY29sLk1hcC5CdWlsZGVyIHByb3Bz\nQnVpbGRlciA9IFB1YlN1YlByb3RvY29sLk1hcC5uZXdCdWlsZGVyKCkuYWRk\nRW50cmllcygKICAgICAgICAgICAgICAgICAgICBQdWJTdWJQcm90b2NvbC5N\nYXAuRW50cnkubmV3QnVpbGRlcigpLnNldEtleShPUFRfTU9EKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KFN0cmluZy52YWx1ZU9mKChzdGFydCArIGkpICUgTSkpKSk7\nCiAgICAgICAgICAgIE1lc3NhZ2VIZWFkZXIuQnVpbGRlciBoZWFkZXJCdWls\nZGVyID0gTWVzc2FnZUhlYWRlci5uZXdCdWlsZGVyKCkuc2V0UHJvcGVydGll\ncyhwcm9wc0J1aWxkZXIpOwogICAgICAgICAgICBNZXNzYWdlIG1zZyA9IE1l\nc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5RnJv\nbVV0ZjgoU3RyaW5nLnZhbHVlT2Yoc3RhcnQgKyBpKSkpCiAgICAgICAgICAg\nICAgICAgICAgLnNldEhlYWRlcihoZWFkZXJCdWlsZGVyKS5idWlsZCgpOwog\nICAgICAgICAgICBwdWIucHVibGlzaCh0b3BpYywgbXNnKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHRocm90dGxlV2l0aEZpbHRlcihQ\ndWJsaXNoZXIgcHViLCBmaW5hbCBTdWJzY3JpYmVyIHN1YiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmlu\nZyBzdWJpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50\nIFgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIHB1Ymxpc2ggbnVt\nYmVycyB3aXRoIGhlYWRlciAoc28gb25seSAzIG1lc3NhZ2VzIHdvdWxkIGJl\nIGRlbGl2ZXJlZCkKICAgICAgICBwdWJsaXNoTnVtcyhwdWIsIHRvcGljLCAw\nLCAzICogWCwgWCk7CgogICAgICAgIC8vIHN1YnNjcmliZSB0aGUgdG9waWMg\nd2l0aCBmaWx0ZXIKICAgICAgICBQdWJTdWJQcm90b2NvbC5NYXAgdXNlck9w\ndGlvbnMgPSBQdWJTdWJQcm90b2NvbC5NYXAKICAgICAgICAgICAgICAgIC5u\nZXdCdWlsZGVyKCkKICAgICAgICAgICAgICAgIC5hZGRFbnRyaWVzKAogICAg\nICAgICAgICAgICAgICAgICAgICBQdWJTdWJQcm90b2NvbC5NYXAuRW50cnku\nbmV3QnVpbGRlcigpLnNldEtleShPUFRfTU9EKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOChTdHJpbmcudmFsdWVPZihYKSkpKS5idWlsZCgpOwogICAgICAgIFN1\nYnNjcmlwdGlvbk9wdGlvbnMgb3B0cyA9IFN1YnNjcmlwdGlvbk9wdGlvbnMu\nbmV3QnVpbGRlcigpLnNldENyZWF0ZU9yQXR0YWNoKENyZWF0ZU9yQXR0YWNo\nLkFUVEFDSCkKICAgICAgICAgICAgICAgIC5zZXRPcHRpb25zKHVzZXJPcHRp\nb25zKS5zZXRNZXNzYWdlRmlsdGVyKE1vZE1lc3NhZ2VGaWx0ZXIuY2xhc3Mu\nZ2V0TmFtZSgpKS5idWlsZCgpOwogICAgICAgIHN1Yi5zdWJzY3JpYmUodG9w\naWMsIHN1YmlkLCBvcHRzKTsKCiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdl\nciBleHBlY3RlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKFgpOwogICAgICAgIGZp\nbmFsIENvdW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNo\nKDEpOwogICAgICAgIHN1Yi5zdGFydERlbGl2ZXJ5KHRvcGljLCBzdWJpZCwg\nbmV3IE1lc3NhZ2VIYW5kbGVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIGRlbGl2ZXIo\nQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1l\nc3NhZ2UgbXNnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGNv\nbnRleHQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgaW50IHZhbHVlID0gSW50ZWdlci52YWx1ZU9mKG1zZy5nZXRCb2R5\nKCkudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICAgICAgICAgIGxvZ2dl\nci5kZWJ1ZygiUmVjZWl2ZWQgbWVzc2FnZSB7fSwiLCB2YWx1ZSk7CgogICAg\nICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBleHBlY3RlZC5nZXQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZC5hZGRBbmRHZXQo\nWCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gZXJyb3IgY29uZGl0aW9uCiAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5lcnJvcigiRGlkIG5vdCByZWNlaXZlIGV4cGVj\ndGVkIHZhbHVlLCBleHBlY3RlZCB7fSwgZ290IHt9IiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLmdldCgpLCB2YWx1\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLnNldCgwKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmICh2\nYWx1ZSA9PSAzICogWCkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXRj\naC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4\ndCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgc3ViLmNvbnN1bWUodG9w\naWMsIHN1YnNjcmliZXJJZCwgbXNnLmdldE1zZ0lkKCkpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIlJlY2VpdmVkIGJhZCBtZXNzYWdlIiwgZSk7\nCiAgICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAg\nICAgYXNzZXJ0VHJ1ZSgiVGltZWQgb3V0IHdhaXRpbmcgZm9yIG1lc3NhZ2Vz\nICIgKyAzICogWCwgbGF0Y2guYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMp\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBleHBlY3RlZCBt\nZXNzYWdlIHdpdGggIiArIDQgKiBYLCA0ICogWCwgZXhwZWN0ZWQuZ2V0KCkp\nOwoKICAgICAgICBzdWIuc3RvcERlbGl2ZXJ5KHRvcGljLCBzdWJpZCk7CiAg\nICAgICAgc3ViLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJpZCk7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIHRocm90dGxlWChQdWJsaXNoZXIgcHVi\nLCBmaW5hbCBTdWJzY3JpYmVyIHN1YiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJpZCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50IFgpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIGZvciAoaW50IGk9MTsgaTw9MypYOyBpKysp\nIHsKICAgICAgICAgICAgcHViLnB1Ymxpc2godG9waWMsIE1lc3NhZ2UubmV3\nQnVpbGRlcigpLnNldEJvZHkoCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChTdHJpbmcudmFsdWVPZihp\nKSkpLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBzdWIuc3Vic2NyaWJl\nKHRvcGljLCBzdWJpZCwgQ3JlYXRlT3JBdHRhY2guQVRUQUNIKTsKCiAgICAg\nICAgZmluYWwgQXRvbWljSW50ZWdlciBleHBlY3RlZCA9IG5ldyBBdG9taWNJ\nbnRlZ2VyKDEpOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHRocm90\ndGxlTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgZmlu\nYWwgQ291bnREb3duTGF0Y2ggbm9uVGhyb3R0bGVMYXRjaCA9IG5ldyBDb3Vu\ndERvd25MYXRjaCgxKTsKICAgICAgICBzdWIuc3RhcnREZWxpdmVyeSh0b3Bp\nYywgc3ViaWQsIG5ldyBNZXNzYWdlSGFuZGxlcigpIHsKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9p\nZCBkZWxpdmVyKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2Ny\naWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBNZXNzYWdlIG1zZywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ss\nIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIGludCB2YWx1ZSA9IEludGVnZXIudmFsdWVPZiht\nc2cuZ2V0Qm9keSgpLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZGVidWcoIlJlY2VpdmVkIG1lc3NhZ2Uge30sIiwgdmFs\ndWUpOwoKICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gZXhwZWN0\nZWQuZ2V0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQu\naW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXJyb3IgY29uZGl0aW9u\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRGlkIG5v\ndCByZWNlaXZlIGV4cGVjdGVkIHZhbHVlLCBleHBlY3RlZCB7fSwgZ290IHt9\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVj\ndGVkLmdldCgpLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4\ncGVjdGVkLnNldCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3R0\nbGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nbm9uVGhyb3R0bGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGV4cGVjdGVkLmdldCgp\nID4gWCsxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm90dGxlTGF0\nY2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGlmIChleHBlY3RlZC5nZXQoKSA9PSAoMyAqIFggKyAx\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBub25UaHJvdHRsZUxhdGNo\nLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjb250ZXh0\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWQuZ2V0\nKCkgPiBYICsgMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWIuY29u\nc3VtZSh0b3BpYywgc3Vic2NyaWJlcklkLCBtc2cuZ2V0TXNnSWQoKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJy\nb3IoIlJlY2VpdmVkIGJhZCBtZXNzYWdlIiwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgdGhyb3R0bGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAg\nICAgICAgICBub25UaHJvdHRsZUxhdGNoLmNvdW50RG93bigpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAg\nYXNzZXJ0RmFsc2UoIlJlY2VpdmVkIG1vcmUgbWVzc2FnZXMgdGhhbiB0aHJv\ndHRsZSB2YWx1ZSAiICsgWCwKICAgICAgICAgICAgICAgICAgICB0aHJvdHRs\nZUxhdGNoLmF3YWl0KDMsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICBh\nc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBleHBlY3RlZCBtZXNzYWdlcyB3aXRo\nIG9ubHkgIiArIChYKzEpLCBYKzEsIGV4cGVjdGVkLmdldCgpKTsKCiAgICAg\nICAgLy8gY29uc3VtZSBtZXNzYWdlcyB0byBub3QgdGhyb3R0bGUgaXQKICAg\nICAgICBmb3IgKGludCBpPTE7IGk8PVg7IGkrKykgewogICAgICAgICAgICBz\ndWIuY29uc3VtZSh0b3BpYywgc3ViaWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgIE1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCkuc2V0TG9jYWxDb21wb25l\nbnQoaSkuYnVpbGQoKSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRUcnVl\nKCJUaW1lZCBvdXQgd2FpdGluZyBmb3IgbWVzc2FnZXMgIiArICgzKlggKyAx\nKSwKICAgICAgICAgICAgICAgICAgIG5vblRocm90dGxlTGF0Y2guYXdhaXQo\nMTAsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nIlNob3VsZCBiZSBleHBlY3RlZCBtZXNzYWdlIHdpdGggIiArICgzKlggKyAx\nKSwKICAgICAgICAgICAgICAgICAgICAgMypYICsgMSwgZXhwZWN0ZWQuZ2V0\nKCkpOwoKICAgICAgICBzdWIuc3RvcERlbGl2ZXJ5KHRvcGljLCBzdWJpZCk7\nCiAgICAgICAgc3ViLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJpZCk7\nCiAgICB9CgogICAgQFBhcmFtZXRlcnMKICAgIHB1YmxpYyBzdGF0aWMgQ29s\nbGVjdGlvbjxPYmplY3RbXT4gY29uZmlncygpIHsKICAgICAgICByZXR1cm4g\nQXJyYXlzLmFzTGlzdChuZXcgT2JqZWN0W11bXSB7IHsgZmFsc2UgfSwgeyB0\ncnVlIH0gfSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNTdWJz\nY3JpcHRpb25DaGFubmVsU2hhcmluZ0VuYWJsZWQ7CgogICAgcHVibGljIFRl\nc3RUaHJvdHRsaW5nRGVsaXZlcnkoYm9vbGVhbiBpc1N1YnNjcmlwdGlvbkNo\nYW5uZWxTaGFyaW5nRW5hYmxlZCkgewogICAgICAgIHN1cGVyKDEpOwogICAg\nICAgIHRoaXMuaXNTdWJzY3JpcHRpb25DaGFubmVsU2hhcmluZ0VuYWJsZWQg\nPSBpc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZDsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNl\ndFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc2V0VXAo\nKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBTZXJ2ZXJD\nb25maWd1cmF0aW9uIGdldFNlcnZlckNvbmZpZ3VyYXRpb24oaW50IHBvcnQs\nIGludCBzc2xQb3J0KSB7CiAgICAgICAgcmV0dXJuIG5ldyBUaHJvdHRsZURl\nbGl2ZXJ5U2VydmVyQ29uZmlndXJhdGlvbihwb3J0LCBzc2xQb3J0KTsKICAg\nIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdFNlcnZlclNpZGVUaHJvdHRsZSgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIGludCBtZXNzYWdlV2luZG93U2l6ZSA9IERFRkFVTFRfTUVTU0FH\nRV9XSU5ET1dfU0laRTsKICAgICAgICBUaHJvdHRsZURlbGl2ZXJ5Q2xpZW50\nQ29uZmlndXJhdGlvbiBjb25mID0KICAgICAgICAgICAgbmV3IFRocm90dGxl\nRGVsaXZlcnlDbGllbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgSGVkd2ln\nQ2xpZW50IGNsaWVudCA9IG5ldyBIZWR3aWdDbGllbnQoY29uZik7CiAgICAg\nICAgUHVibGlzaGVyIHB1YiA9IGNsaWVudC5nZXRQdWJsaXNoZXIoKTsKICAg\nICAgICBTdWJzY3JpYmVyIHN1YiA9IGNsaWVudC5nZXRTdWJzY3JpYmVyKCk7\nCgogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOCgidGVzdFNlcnZlclNpZGVUaHJvdHRsZSIpOwogICAgICAgIEJ5\ndGVTdHJpbmcgc3ViaWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgic2Vy\ndmVyVGhyb3R0bGVTdWIiKTsKICAgICAgICBzdWIuc3Vic2NyaWJlKHRvcGlj\nLCBzdWJpZCwgQ3JlYXRlT3JBdHRhY2guQ1JFQVRFKTsKICAgICAgICBzdWIu\nY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YmlkKTsKCiAgICAgICAgLy8g\ndGhyb3R0bGUgd2l0aCBodWIgc2VydmVyJ3Mgc2V0dGluZwogICAgICAgIHRo\ncm90dGxlWChwdWIsIHN1YiwgdG9waWMsIHN1YmlkLCBERUZBVUxUX01FU1NB\nR0VfV0lORE9XX1NJWkUpOwoKICAgICAgICBtZXNzYWdlV2luZG93U2l6ZSA9\nIERFRkFVTFRfTUVTU0FHRV9XSU5ET1dfU0laRSAvIDI7CiAgICAgICAgLy8g\ndGhyb3R0bGUgd2l0aCBhIGxvd2VyIHZhbHVlIHRoYW4gaHViIHNlcnZlcidz\nIHNldHRpbmcKICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zLkJ1aWxkZXIg\nb3B0aW9uc0J1aWxkZXIgPSBTdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1aWxk\nZXIoKQogICAgICAgICAgICAuc2V0Q3JlYXRlT3JBdHRhY2goQ3JlYXRlT3JB\ndHRhY2guQ1JFQVRFKQogICAgICAgICAgICAuc2V0TWVzc2FnZVdpbmRvd1Np\nemUobWVzc2FnZVdpbmRvd1NpemUpOwogICAgICAgIHRvcGljID0gQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0ZjgoInRlc3RTZXJ2ZXJTaWRlVGhyb3R0bGVXaXRo\nTG93ZXJWYWx1ZSIpOwogICAgICAgIHN1Yi5zdWJzY3JpYmUodG9waWMsIHN1\nYmlkLCBvcHRpb25zQnVpbGRlci5idWlsZCgpKTsKICAgICAgICBzdWIuY2xv\nc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YmlkKTsKICAgICAgICB0aHJvdHRs\nZVgocHViLCBzdWIsIHRvcGljLCBzdWJpZCwgbWVzc2FnZVdpbmRvd1NpemUp\nOwoKICAgICAgICBtZXNzYWdlV2luZG93U2l6ZSA9IERFRkFVTFRfTUVTU0FH\nRV9XSU5ET1dfU0laRSArIDU7CiAgICAgICAgLy8gdGhyb3R0bGUgd2l0aCBh\nIGhpZ2hlciB2YWx1ZSB0aGFuIGh1YiBzZXJ2ZXIncyBzZXR0aW5nCiAgICAg\nICAgb3B0aW9uc0J1aWxkZXIgPSBTdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1\naWxkZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgLnNldENyZWF0ZU9y\nQXR0YWNoKENyZWF0ZU9yQXR0YWNoLkNSRUFURSkKICAgICAgICAgICAgICAg\nICAgICAgICAgIC5zZXRNZXNzYWdlV2luZG93U2l6ZShtZXNzYWdlV2luZG93\nU2l6ZSk7CiAgICAgICAgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRm\nOCgidGVzdFNlcnZlclNpZGVUaHJvdHRsZVdpdGhIaWdoZXJWYWx1ZSIpOwog\nICAgICAgIHN1Yi5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRpb25zQnVp\nbGRlci5idWlsZCgpKTsKICAgICAgICBzdWIuY2xvc2VTdWJzY3JpcHRpb24o\ndG9waWMsIHN1YmlkKTsKICAgICAgICB0aHJvdHRsZVgocHViLCBzdWIsIHRv\ncGljLCBzdWJpZCwgbWVzc2FnZVdpbmRvd1NpemUpOwoKICAgICAgICBjbGll\nbnQuY2xvc2UoKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0VGhyb3R0bGVXaXRoU2VydmVyU2lkZUZp\nbHRlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBtZXNzYWdl\nV2luZG93U2l6ZSA9IERFRkFVTFRfTUVTU0FHRV9XSU5ET1dfU0laRTsKICAg\nICAgICBUaHJvdHRsZURlbGl2ZXJ5Q2xpZW50Q29uZmlndXJhdGlvbiBjb25m\nID0gbmV3IFRocm90dGxlRGVsaXZlcnlDbGllbnRDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgSGVkd2lnQ2xpZW50IGNsaWVudCA9IG5ldyBIZWR3aWdDbGll\nbnQoY29uZik7CiAgICAgICAgUHVibGlzaGVyIHB1YiA9IGNsaWVudC5nZXRQ\ndWJsaXNoZXIoKTsKICAgICAgICBTdWJzY3JpYmVyIHN1YiA9IGNsaWVudC5n\nZXRTdWJzY3JpYmVyKCk7CgogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBC\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgidGVzdFRocm90dGxlV2l0aFNlcnZl\nclNpZGVGaWx0ZXIiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1YmlkID0gQnl0\nZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15c3ViIik7CiAgICAgICAgU3Vic2Ny\naXB0aW9uT3B0aW9ucyBvcHRzID0gU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdC\ndWlsZGVyKCkuc2V0Q3JlYXRlT3JBdHRhY2goQ3JlYXRlT3JBdHRhY2guQ1JF\nQVRFKS5idWlsZCgpOwogICAgICAgIHN1Yi5zdWJzY3JpYmUodG9waWMsIHN1\nYmlkLCBvcHRzKTsKICAgICAgICBzdWIuY2xvc2VTdWJzY3JpcHRpb24odG9w\naWMsIHN1YmlkKTsKCiAgICAgICAgLy8gbWVzc2FnZSBnYXA6IGhhbGYgb2Yg\ndGhlIHRocm90dGxlIHRocmVzaG9sZAogICAgICAgIHRocm90dGxlV2l0aEZp\nbHRlcihwdWIsIHN1YiwgdG9waWMsIHN1YmlkLCBtZXNzYWdlV2luZG93U2l6\nZSAvIDIpOwogICAgICAgIC8vIG1lc3NhZ2UgZ2FwOiBlcXVhbHMgdG8gdGhl\nIHRocm90dGxlIHRocmVzaG9sZAogICAgICAgIHRocm90dGxlV2l0aEZpbHRl\ncihwdWIsIHN1YiwgdG9waWMsIHN1YmlkLCBtZXNzYWdlV2luZG93U2l6ZSk7\nCiAgICAgICAgLy8gbWVzc2FnZSBnYXA6IGxhcmdlciB0aGFuIHRoZSB0aHJv\ndHRsZSB0aHJlc2hvbGQKICAgICAgICB0aHJvdHRsZVdpdGhGaWx0ZXIocHVi\nLCBzdWIsIHRvcGljLCBzdWJpZCwgbWVzc2FnZVdpbmRvd1NpemUgKyBtZXNz\nYWdlV2luZG93U2l6ZSAvIDIpOwogICAgfQoKfQo=\n","encoding":"base64"}

