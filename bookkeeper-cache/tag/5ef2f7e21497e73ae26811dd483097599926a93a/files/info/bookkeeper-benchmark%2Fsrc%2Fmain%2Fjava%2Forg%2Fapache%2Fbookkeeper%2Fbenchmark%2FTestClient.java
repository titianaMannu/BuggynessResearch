{"sha":"a47559b25a99bf44b2f354eead02c5e31a9688e6","node_id":"MDQ6QmxvYjE1NzU5NTY6YTQ3NTU5YjI1YTk5YmY0NGIyZjM1NGVlYWQwMmM1ZTMxYTk2ODhlNg==","size":14589,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a47559b25a99bf44b2f354eead02c5e31a9688e6","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsK\nCmltcG9ydCBqYXZhLmlvLkZpbGVPdXRwdXRTdHJlYW07CmltcG9ydCBqYXZh\nLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlJhbmRv\nbTsKaW1wb3J0IGphdmEudXRpbC5UaW1lcjsKaW1wb3J0IGphdmEudXRpbC5U\naW1lclRhc2s7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5DYWxsYWJs\nZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dGlvbkV4Y2Vw\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yU2Vy\ndmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkZ1dHVyZTsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0xvbmc7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxi\nYWNrLkFkZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Db21tYW5kTGluZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmVQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBGb3JtYXR0ZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9wdGlvbnM7CmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMuY2xpLlBhcnNlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Qb3NpeFBhcnNlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGFkb29wLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGFkb29wLmZzLkZTRGF0YU91dHB1dFN0cmVhbTsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGFkb29wLmZzLkZpbGVTeXN0ZW07CmltcG9ydCBvcmcu\nYXBhY2hlLmhhZG9vcC5mcy5QYXRoOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\ncjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKCi8qKgogKiBU\naGlzIGlzIGEgc2ltcGxlIHRlc3QgcHJvZ3JhbSB0byBjb21wYXJlIHRoZSBw\nZXJmb3JtYW5jZSBvZiB3cml0aW5nIHRvCiAqIEJvb2tLZWVwZXIgYW5kIHRv\nIHRoZSBsb2NhbCBmaWxlIHN5c3RlbS4KICoKICovCgpwdWJsaWMgY2xhc3Mg\nVGVzdENsaWVudCB7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIg\nTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVzdENsaWVudC5jbGFz\ncyk7CgogICAgLyoqCiAgICAgKiBGaXJzdCBzYXlzIGlmIGVudHJpZXMgc2hv\ndWxkIGJlIHdyaXR0ZW4gdG8gQm9va0tlZXBlciAoMCkgb3IgdG8gdGhlIGxv\nY2FsCiAgICAgKiBkaXNrICgxKS4gU2Vjb25kIHBhcmFtZXRlciBpcyBhbiBp\nbnRlZ2VyIGRlZmluaW5nIHRoZSBsZW5ndGggb2YgYSBsZWRnZXIgZW50cnku\nCiAgICAgKiBUaGlyZCBwYXJhbWV0ZXIgaXMgdGhlIG51bWJlciBvZiB3cml0\nZXMuCiAgICAgKgogICAgICogQHBhcmFtIGFyZ3MKICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgdGhyb3dzIFBh\ncnNlRXhjZXB0aW9uIHsKICAgICAgICBPcHRpb25zIG9wdGlvbnMgPSBuZXcg\nT3B0aW9ucygpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJsZW5ndGgi\nLCB0cnVlLCAiTGVuZ3RoIG9mIHBhY2tldHMgYmVpbmcgd3JpdHRlbi4gRGVm\nYXVsdCAxMDI0Iik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oInRhcmdl\ndCIsIHRydWUsICJUYXJnZXQgbWVkaXVtIHRvIHdyaXRlIHRvLiBPcHRpb25z\nIGFyZSBiaywgZnMgJiBoZGZzLiBEZWZhdWx0IGZzIik7CiAgICAgICAgb3B0\naW9ucy5hZGRPcHRpb24oInJ1bmZvciIsIHRydWUsICJOdW1iZXIgb2Ygc2Vj\nb25kcyB0byBydW4gZm9yLiBEZWZhdWx0IDYwIik7CiAgICAgICAgb3B0aW9u\ncy5hZGRPcHRpb24oInBhdGgiLCB0cnVlLCAiUGF0aCB0byB3cml0ZSB0by4g\nZnMgJiBoZGZzIG9ubHkuIERlZmF1bHQgL2Zvb2JhciIpOwogICAgICAgIG9w\ndGlvbnMuYWRkT3B0aW9uKCJ6a3NlcnZlcnMiLCB0cnVlLCAiWm9vS2VlcGVy\nIHNlcnZlcnMsIGNvbW1hIHNlcGFyYXRlZC4gYmsgb25seS4gRGVmYXVsdCBs\nb2NhbGhvc3Q6MjE4MS4iKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigi\nYmtlbnNlbWJsZSIsIHRydWUsICJCb29rS2VlcGVyIGxlZGdlciBlbnNlbWJs\nZSBzaXplLiBiayBvbmx5LiBEZWZhdWx0IDMiKTsKICAgICAgICBvcHRpb25z\nLmFkZE9wdGlvbigiYmtxdW9ydW0iLCB0cnVlLCAiQm9va0tlZXBlciBsZWRn\nZXIgcXVvcnVtIHNpemUuIGJrIG9ubHkuIERlZmF1bHQgMiIpOwogICAgICAg\nIG9wdGlvbnMuYWRkT3B0aW9uKCJia3Rocm90dGxlIiwgdHJ1ZSwgIkJvb2tL\nZWVwZXIgdGhyb3R0bGUgc2l6ZS4gYmsgb25seS4gRGVmYXVsdCAxMDAwMCIp\nOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJzeW5jIiwgZmFsc2UsICJV\nc2Ugc3luY2hyb25vdXMgd3JpdGVzIHdpdGggQm9va0tlZXBlci4gYmsgb25s\neS4iKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigibnVtY29uY3VycmVu\ndCIsIHRydWUsICJOdW1iZXIgb2YgY29uY3VycmVudGx5IGNsaWVudHMuIERl\nZmF1bHQgMSIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJ0aW1lb3V0\nIiwgdHJ1ZSwgIk51bWJlciBvZiBzZWNvbmRzIGFmdGVyIHdoaWNoIHRvIGdp\ndmUgdXAiKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigiaGVscCIsIGZh\nbHNlLCAiVGhpcyBtZXNzYWdlIik7CgogICAgICAgIENvbW1hbmRMaW5lUGFy\nc2VyIHBhcnNlciA9IG5ldyBQb3NpeFBhcnNlcigpOwogICAgICAgIENvbW1h\nbmRMaW5lIGNtZCA9IHBhcnNlci5wYXJzZShvcHRpb25zLCBhcmdzKTsKCiAg\nICAgICAgaWYgKGNtZC5oYXNPcHRpb24oImhlbHAiKSkgewogICAgICAgICAg\nICBIZWxwRm9ybWF0dGVyIGZvcm1hdHRlciA9IG5ldyBIZWxwRm9ybWF0dGVy\nKCk7CiAgICAgICAgICAgIGZvcm1hdHRlci5wcmludEhlbHAoIlRlc3RDbGll\nbnQgPG9wdGlvbnM+Iiwgb3B0aW9ucyk7CiAgICAgICAgICAgIFN5c3RlbS5l\neGl0KC0xKTsKICAgICAgICB9CgogICAgICAgIGludCBsZW5ndGggPSBJbnRl\nZ2VyLnZhbHVlT2YoY21kLmdldE9wdGlvblZhbHVlKCJsZW5ndGgiLCAiMTAy\nNCIpKTsKICAgICAgICBTdHJpbmcgdGFyZ2V0ID0gY21kLmdldE9wdGlvblZh\nbHVlKCJ0YXJnZXQiLCAiZnMiKTsKICAgICAgICBsb25nIHJ1bmZvciA9IExv\nbmcudmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoInJ1bmZvciIsICI2MCIp\nKSAqIDEwMDA7CgogICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3Ry\naW5nQnVpbGRlcigpOwogICAgICAgIHdoaWxlKGxlbmd0aC0tID4gMCkgewog\nICAgICAgICAgICBzYi5hcHBlbmQoJ2EnKTsKICAgICAgICB9CgogICAgICAg\nIFRpbWVyIHRpbWVvdXRlciA9IG5ldyBUaW1lcigpOwogICAgICAgIGlmIChj\nbWQuaGFzT3B0aW9uKCJ0aW1lb3V0IikpIHsKICAgICAgICAgICAgZmluYWwg\nbG9uZyB0aW1lb3V0ID0gTG9uZy52YWx1ZU9mKGNtZC5nZXRPcHRpb25WYWx1\nZSgidGltZW91dCIsICIzNjAiKSkgKiAxMDAwOwoKICAgICAgICAgICAgdGlt\nZW91dGVyLnNjaGVkdWxlKG5ldyBUaW1lclRhc2soKSB7CiAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIlRpbWluZyBvdXQgYmVuY2ht\nYXJrIGFmdGVyICIgKyB0aW1lb3V0ICsgIm1zIik7CiAgICAgICAgICAgICAg\nICAgICAgICAgIFN5c3RlbS5leGl0KC0xKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9LCB0aW1lb3V0KTsKICAgICAgICB9Cgog\nICAgICAgIEJvb2tLZWVwZXIgYmtjID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpbnQgbnVtRmlsZXMgPSBJbnRlZ2VyLnZhbHVlT2YoY21k\nLmdldE9wdGlvblZhbHVlKCJudW1jb25jdXJyZW50IiwgIjEiKSk7CiAgICAg\nICAgICAgIGludCBudW1UaHJlYWRzID0gTWF0aC5taW4obnVtRmlsZXMsIDEw\nMDApOwogICAgICAgICAgICBieXRlW10gZGF0YSA9IHNiLnRvU3RyaW5nKCku\nZ2V0Qnl0ZXMoKTsKICAgICAgICAgICAgbG9uZyBydW5pZCA9IFN5c3RlbS5j\ndXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICBMaXN0PENhbGxhYmxl\nPExvbmc+PiBjbGllbnRzID0gbmV3IEFycmF5TGlzdDxDYWxsYWJsZTxMb25n\nPj4oKTsKCiAgICAgICAgICAgIGlmICh0YXJnZXQuZXF1YWxzKCJiayIpKSB7\nCiAgICAgICAgICAgICAgICBTdHJpbmcgemtzZXJ2ZXJzID0gY21kLmdldE9w\ndGlvblZhbHVlKCJ6a3NlcnZlcnMiLCAibG9jYWxob3N0OjIxODEiKTsKICAg\nICAgICAgICAgICAgIGludCBia2Vuc2VtYmxlID0gSW50ZWdlci52YWx1ZU9m\nKGNtZC5nZXRPcHRpb25WYWx1ZSgiYmtlbnNlbWJsZSIsICIzIikpOwogICAg\nICAgICAgICAgICAgaW50IGJrcXVvcnVtID0gSW50ZWdlci52YWx1ZU9mKGNt\nZC5nZXRPcHRpb25WYWx1ZSgiYmtxdW9ydW0iLCAiMiIpKTsKICAgICAgICAg\nICAgICAgIGludCBia3Rocm90dGxlID0gSW50ZWdlci52YWx1ZU9mKGNtZC5n\nZXRPcHRpb25WYWx1ZSgiYmt0aHJvdHRsZSIsICIxMDAwMCIpKTsKCiAgICAg\nICAgICAgICAgICBDbGllbnRDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgQ2xp\nZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgICAgICAgICAgY29uZi5zZXRU\naHJvdHRsZVZhbHVlKGJrdGhyb3R0bGUpOwogICAgICAgICAgICAgICAgY29u\nZi5zZXRaa1NlcnZlcnMoemtzZXJ2ZXJzKTsKCiAgICAgICAgICAgICAgICBi\na2MgPSBuZXcgQm9va0tlZXBlcihjb25mKTsKICAgICAgICAgICAgICAgIExp\nc3Q8TGVkZ2VySGFuZGxlPiBoYW5kbGVzID0gbmV3IEFycmF5TGlzdDxMZWRn\nZXJIYW5kbGU+KCk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG51bUZpbGVzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBoYW5k\nbGVzLmFkZChia2MuY3JlYXRlTGVkZ2VyKGJrZW5zZW1ibGUsIGJrcXVvcnVt\nLCBEaWdlc3RUeXBlLkNSQzMyLCBuZXcgYnl0ZVtdIHsnYScsICdiJ30pKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbnVtRmlsZXM7IGkrKykgewogICAgICAgICAgICAgICAgICAg\nIGNsaWVudHMuYWRkKG5ldyBCS0NsaWVudChoYW5kbGVzLCBkYXRhLCBydW5m\nb3IsIGNtZC5oYXNPcHRpb24oInN5bmMiKSkpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldC5lcXVhbHMoImhkZnMi\nKSkgewogICAgICAgICAgICAgICAgRmlsZVN5c3RlbSBmcyA9IEZpbGVTeXN0\nZW0uZ2V0KG5ldyBDb25maWd1cmF0aW9uKCkpOwogICAgICAgICAgICAgICAg\nTE9HLmluZm8oIkRlZmF1bHQgcmVwbGljYXRpb24gZm9yIEhERlM6IHt9Iiwg\nZnMuZ2V0RGVmYXVsdFJlcGxpY2F0aW9uKCkpOwoKICAgICAgICAgICAgICAg\nIExpc3Q8RlNEYXRhT3V0cHV0U3RyZWFtPiBzdHJlYW1zID0gbmV3IEFycmF5\nTGlzdDxGU0RhdGFPdXRwdXRTdHJlYW0+KCk7CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IG51bUZpbGVzOyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICBTdHJpbmcgcGF0aCA9IGNtZC5nZXRPcHRpb25WYWx1ZSgi\ncGF0aCIsICIvZm9vYmFyIik7CiAgICAgICAgICAgICAgICAgICAgc3RyZWFt\ncy5hZGQoZnMuY3JlYXRlKG5ldyBQYXRoKHBhdGggKyBydW5pZCArICJfIiAr\nIGkpKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBudW1UaHJlYWRzOyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICBjbGllbnRzLmFkZChuZXcgSERGU0NsaWVudChzdHJlYW1z\nLCBkYXRhLCBydW5mb3IpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBlbHNlIGlmICh0YXJnZXQuZXF1YWxzKCJmcyIpKSB7CiAgICAgICAg\nICAgICAgICBMaXN0PEZpbGVPdXRwdXRTdHJlYW0+IHN0cmVhbXMgPSBuZXcg\nQXJyYXlMaXN0PEZpbGVPdXRwdXRTdHJlYW0+KCk7CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG51bUZpbGVzOyBpKyspIHsKICAgICAg\nICAgICAgICAgICAgICBTdHJpbmcgcGF0aCA9IGNtZC5nZXRPcHRpb25WYWx1\nZSgicGF0aCIsICIvZm9vYmFyICIgKyBpKTsKICAgICAgICAgICAgICAgICAg\nICBzdHJlYW1zLmFkZChuZXcgRmlsZU91dHB1dFN0cmVhbShwYXRoICsgcnVu\naWQgKyAiXyIgKyBpKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1UaHJlYWRzOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICBjbGllbnRzLmFkZChuZXcgRmlsZUNsaWVu\ndChzdHJlYW1zLCBkYXRhLCBydW5mb3IpKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiVW5rbm93biBvcHRpb246ICIgKyB0YXJnZXQpOwogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiVW5rbm93\nbiB0YXJnZXQgIiArIHRhcmdldCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIEV4ZWN1dG9yU2VydmljZSBleGVjdXRvciA9IEV4ZWN1dG9ycy5uZXdG\naXhlZFRocmVhZFBvb2wobnVtVGhyZWFkcyk7CiAgICAgICAgICAgIGxvbmcg\nc3RhcnQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKCiAgICAgICAg\nICAgIExpc3Q8RnV0dXJlPExvbmc+PiByZXN1bHRzID0gZXhlY3V0b3IuaW52\nb2tlQWxsKGNsaWVudHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEwLCBUaW1lVW5pdC5N\nSU5VVEVTKTsKICAgICAgICAgICAgbG9uZyBlbmQgPSBTeXN0ZW0uY3VycmVu\ndFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgbG9uZyBjb3VudCA9IDA7CiAg\nICAgICAgICAgIGZvciAoRnV0dXJlPExvbmc+IHIgOiByZXN1bHRzKSB7CiAg\nICAgICAgICAgICAgICBpZiAoIXIuaXNEb25lKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cud2FybigiSm9iIGRpZG4ndCBjb21wbGV0ZSIpOwogICAg\nICAgICAgICAgICAgICAgIFN5c3RlbS5leGl0KDIpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgbG9uZyBjID0gci5nZXQoKTsKICAgICAg\nICAgICAgICAgIGlmIChjID09IDApIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cud2FybigiVGFzayBkaWRuJ3QgY29tcGxldGUiKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGNvdW50ICs9IGM7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgbG9uZyB0aW1lID0gZW5kLXN0YXJ0OwogICAgICAg\nICAgICBMT0cuaW5mbygiRmluaXNoZWQgcHJvY2Vzc2luZyB3cml0ZXMgKG1z\nKToge30gVFBUOiB7fSBvcC9zIiwKICAgICAgICAgICAgICAgICAgICAgdGlt\nZSwgY291bnQvKChkb3VibGUpdGltZS8xMDAwKSk7CiAgICAgICAgICAgIGV4\nZWN1dG9yLnNodXRkb3duKCk7CiAgICAgICAgfSBjYXRjaCAoRXhlY3V0aW9u\nRXhjZXB0aW9uIGVlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0\naW9uIGluIHdvcmtlciIsIGVlKTsKICAgICAgICB9ICBjYXRjaCAoS2VlcGVy\nRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Ig\nYWNjZXNzaW5nIHpvb2tlZXBlciIsIGtlKTsKICAgICAgICB9IGNhdGNoIChC\nS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Ig\nYWNjZXNzaW5nIGJvb2trZWVwZXIiLCBlKTsKICAgICAgICB9IGNhdGNoIChJ\nT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJL08g\nZXhjZXB0aW9uIGR1cmluZyBiZW5jaG1hcmsiLCBpb2UpOwogICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiQmVuY2htYXJrIGludGVycnVwdGVkIiwgaWUpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChia2MgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBi\na2MuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0\naW9uIGJrZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJy\nb3IgY2xvc2luZyBib29ra2VlcGVyIGNsaWVudCIsIGJrZSk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewog\nICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJJbnRlcnJ1cHRlZCBjbG9z\naW5nIGJvb2trZWVwZXIgY2xpZW50IiwgaWUpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRpbWVvdXRlci5j\nYW5jZWwoKTsKICAgIH0KCiAgICBzdGF0aWMgY2xhc3MgSERGU0NsaWVudCBp\nbXBsZW1lbnRzIENhbGxhYmxlPExvbmc+IHsKICAgICAgICBmaW5hbCBMaXN0\nPEZTRGF0YU91dHB1dFN0cmVhbT4gc3RyZWFtczsKICAgICAgICBmaW5hbCBi\neXRlW10gZGF0YTsKICAgICAgICBmaW5hbCBsb25nIHRpbWU7CiAgICAgICAg\nZmluYWwgUmFuZG9tIHI7CgogICAgICAgIEhERlNDbGllbnQoTGlzdDxGU0Rh\ndGFPdXRwdXRTdHJlYW0+IHN0cmVhbXMsIGJ5dGVbXSBkYXRhLCBsb25nIHRp\nbWUpIHsKICAgICAgICAgICAgdGhpcy5zdHJlYW1zID0gc3RyZWFtczsKICAg\nICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgICAgICAgdGhpcy50\naW1lID0gdGltZTsKICAgICAgICAgICAgdGhpcy5yID0gbmV3IFJhbmRvbShT\neXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0aGlzKSk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgTG9uZyBjYWxsKCkgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgbG9uZyBjb3VudCA9IDA7CiAgICAgICAgICAgICAg\nICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAg\nICAgICAgICAgICAgICBsb25nIHN0b3BhdCA9IHN0YXJ0ICsgdGltZTsKICAg\nICAgICAgICAgICAgIHdoaWxlKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nIDwgc3RvcGF0KSB7CiAgICAgICAgICAgICAgICAgICAgRlNEYXRhT3V0cHV0\nU3RyZWFtIHN0cmVhbSA9IHN0cmVhbXMuZ2V0KHIubmV4dEludChzdHJlYW1z\nLnNpemUoKSkpOwogICAgICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZChz\ndHJlYW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLndyaXRl\nKGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uZmx1c2go\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmhmbHVzaCgpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjb3Vu\ndCsrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxvbmcg\ndGltZSA9IChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0KTsK\nICAgICAgICAgICAgICAgIExPRy5pbmZvKCJXb3JrZXIgZmluaXNoZWQgcHJv\nY2Vzc2luZyB3cml0ZXMgKG1zKToge30gVFBUOiB7fSBvcC9zIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgIHRpbWUsIGNvdW50LygoZG91YmxlKXRpbWUv\nMTAwMCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvdW50OwogICAgICAg\nICAgICB9IGNhdGNoKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4gd29ya2VyIHRocmVhZCIsIGlv\nZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gMEw7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNsYXNzIEZpbGVDbGllbnQg\naW1wbGVtZW50cyBDYWxsYWJsZTxMb25nPiB7CiAgICAgICAgZmluYWwgTGlz\ndDxGaWxlT3V0cHV0U3RyZWFtPiBzdHJlYW1zOwogICAgICAgIGZpbmFsIGJ5\ndGVbXSBkYXRhOwogICAgICAgIGZpbmFsIGxvbmcgdGltZTsKICAgICAgICBm\naW5hbCBSYW5kb20gcjsKCiAgICAgICAgRmlsZUNsaWVudChMaXN0PEZpbGVP\ndXRwdXRTdHJlYW0+IHN0cmVhbXMsIGJ5dGVbXSBkYXRhLCBsb25nIHRpbWUp\nIHsKICAgICAgICAgICAgdGhpcy5zdHJlYW1zID0gc3RyZWFtczsKICAgICAg\nICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgICAgICAgdGhpcy50aW1l\nID0gdGltZTsKICAgICAgICAgICAgdGhpcy5yID0gbmV3IFJhbmRvbShTeXN0\nZW0uaWRlbnRpdHlIYXNoQ29kZSh0aGlzKSk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgTG9uZyBjYWxsKCkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgbG9uZyBjb3VudCA9IDA7CiAgICAgICAgICAgICAgICBs\nb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CgogICAg\nICAgICAgICAgICAgbG9uZyBzdG9wYXQgPSBzdGFydCArIHRpbWU7CiAgICAg\nICAgICAgICAgICB3aGlsZShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSA8\nIHN0b3BhdCkgewogICAgICAgICAgICAgICAgICAgIEZpbGVPdXRwdXRTdHJl\nYW0gc3RyZWFtID0gc3RyZWFtcy5nZXQoci5uZXh0SW50KHN0cmVhbXMuc2l6\nZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkKHN0cmVh\nbSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0ud3JpdGUoZGF0\nYSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbS5mbHVzaCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uZ2V0Q2hhbm5lbCgpLmZv\ncmNlKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICBsb25nIHRpbWUgPSAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCkgLSBzdGFydCk7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiV29ya2Vy\nIGZpbmlzaGVkIHByb2Nlc3Npbmcgd3JpdGVzIChtcyk6IHt9IFRQVDoge30g\nb3AvcyIsIHRpbWUsIGNvdW50LygoZG91YmxlKXRpbWUvMTAwMCkpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGNvdW50OwogICAgICAgICAgICB9IGNhdGNo\nKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJFeGNlcHRpb24gaW4gd29ya2VyIHRocmVhZCIsIGlvZSk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gMEw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgc3RhdGljIGNsYXNzIEJLQ2xpZW50IGltcGxlbWVudHMgQ2Fs\nbGFibGU8TG9uZz4sIEFkZENhbGxiYWNrIHsKICAgICAgICBmaW5hbCBMaXN0\nPExlZGdlckhhbmRsZT4gaGFuZGxlczsKICAgICAgICBmaW5hbCBieXRlW10g\nZGF0YTsKICAgICAgICBmaW5hbCBsb25nIHRpbWU7CiAgICAgICAgZmluYWwg\nUmFuZG9tIHI7CiAgICAgICAgZmluYWwgYm9vbGVhbiBzeW5jOwogICAgICAg\nIGZpbmFsIEF0b21pY0xvbmcgc3VjY2VzcyA9IG5ldyBBdG9taWNMb25nKDAp\nOwogICAgICAgIGZpbmFsIEF0b21pY0xvbmcgb3V0c3RhbmRpbmcgPSBuZXcg\nQXRvbWljTG9uZygwKTsKCiAgICAgICAgQktDbGllbnQoTGlzdDxMZWRnZXJI\nYW5kbGU+IGhhbmRsZXMsIGJ5dGVbXSBkYXRhLCBsb25nIHRpbWUsIGJvb2xl\nYW4gc3luYykgewogICAgICAgICAgICB0aGlzLmhhbmRsZXMgPSBoYW5kbGVz\nOwogICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgICAgICAgICB0\naGlzLnRpbWUgPSB0aW1lOwogICAgICAgICAgICB0aGlzLnIgPSBuZXcgUmFu\nZG9tKFN5c3RlbS5pZGVudGl0eUhhc2hDb2RlKHRoaXMpKTsKICAgICAgICAg\nICAgdGhpcy5zeW5jID0gc3luYzsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBMb25nIGNhbGwoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCgogICAgICAgICAgICAgICAgbG9uZyBzdG9wYXQgPSBzdGFydCArIHRpbWU7\nCiAgICAgICAgICAgICAgICB3aGlsZShTeXN0ZW0uY3VycmVudFRpbWVNaWxs\naXMoKSA8IHN0b3BhdCkgewogICAgICAgICAgICAgICAgICAgIExlZGdlckhh\nbmRsZSBsaCA9IGhhbmRsZXMuZ2V0KHIubmV4dEludChoYW5kbGVzLnNpemUo\nKSkpOwogICAgICAgICAgICAgICAgICAgIGlmIChzeW5jKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgICAg\nICAgICAgICAgICAgICBzdWNjZXNzLmluY3JlbWVudEFuZEdldCgpOwogICAg\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGxoLmFzeW5jQWRkRW50cnkoZGF0YSwgdGhpcywgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIG91dHN0YW5kaW5nLmluY3JlbWVudEFuZEdl\ndCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICBpbnQgdGlja3MgPSAxMDsgLy8gZG9uJ3Qgd2Fp\ndCBmb3IgbW9yZSB0aGFuIDEwIHNlY29uZHMKICAgICAgICAgICAgICAgIHdo\naWxlIChvdXRzdGFuZGluZy5nZXQoKSA+IDAgJiYgdGlja3MtLSA+IDApIHsK\nICAgICAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTApOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxvbmcgdGltZSA9IChTeXN0\nZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0KTsKICAgICAgICAgICAg\nICAgIExPRy5pbmZvKCJXb3JrZXIgZmluaXNoZWQgcHJvY2Vzc2luZyB3cml0\nZXMgKG1zKToge30gVFBUOiB7fSBvcC9zIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgIHRpbWUsIHN1Y2Nlc3MuZ2V0KCkvKChkb3VibGUpdGltZS8xMDAw\nKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2Vzcy5nZXQoKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4gd29ya2VyIHRocmVhZCIs\nIGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIDBMOwogICAgICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4gd29ya2VyIHRocmVhZCIs\nIGllKTsKICAgICAgICAgICAgICAgIHJldHVybiAwTDsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgYWRkQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIGxv\nbmcgZW50cnlJZCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBpZiAocmMg\nPT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgc3Vj\nY2Vzcy5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBvdXRzdGFuZGluZy5kZWNyZW1lbnRBbmRHZXQoKTsKICAgICAgICB9\nCiAgICB9Cn0K\n","encoding":"base64"}

