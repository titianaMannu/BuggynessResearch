{"sha":"1f848f55279d12c20472f2600142c366ed656481","node_id":"MDQ6QmxvYjE1NzU5NTY6MWY4NDhmNTUyNzlkMTJjMjA0NzJmMjYwMDE0MmMzNjZlZDY1NjQ4MQ==","size":48111,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1f848f55279d12c20472f2600142c366ed656481","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZv\ndW5kRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuaW8uRmlsZW5hbWVGaWx0ZXI7CmltcG9ydCBqYXZhLm5ldC5J\nbmV0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNz\nOwppbXBvcnQgamF2YS5uZXQuVW5rbm93bkhvc3RFeGNlcHRpb247CmltcG9y\ndCBqYXZhLm5pby5CeXRlQnVmZmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5G\ndXR1cmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNCb29s\nZWFuOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdl\nck1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5M\nZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmJvb2tpZS5HYXJiYWdlQ29sbGVjdG9yVGhyZWFkLlNh\nZmVFbnRyeUFkZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJv\nb2tpZS5Kb3VybmFsLkpvdXJuYWxTY2FubmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmJvb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5MZWRnZXJE\naXJzTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9v\na2llLkxlZGdlckRpcnNNYW5hZ2VyLk5vV3JpdGFibGVMZWRnZXJEaXJFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2\nZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmpteC5CS01CZWFuSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5qbXguQktNQmVhblJlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0\nZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5Cb29rS2VlcGVy\nQ29uc3RhbnRzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwu\nSU9VdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLk1h\ndGhVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlpr\nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TdHJp\nbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci56b29rZWVw\nZXIuWm9vS2VlcGVyV2F0Y2hlckJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMuaW8uRmlsZVV0aWxzOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuQ3JlYXRlTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Ob2RlRXhpc3RzRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLlpvb0RlZnMuSWRzOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlci5FdmVudC5FdmVudFR5cGU7CgppbXBvcnQgY29t\nLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJsZUZvclRlc3Rpbmc7\nCgovKioKICogSW1wbGVtZW50cyBhIGJvb2tpZS4KICoKICovCgpwdWJsaWMg\nY2xhc3MgQm9va2llIGV4dGVuZHMgVGhyZWFkIHsKCiAgICBzdGF0aWMgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tpZS5jbGFz\ncyk7CgogICAgZmluYWwgRmlsZSBqb3VybmFsRGlyZWN0b3J5OwogICAgZmlu\nYWwgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwoKICAgIGZpbmFsIFN5bmNU\naHJlYWQgc3luY1RocmVhZDsKICAgIGZpbmFsIExlZGdlck1hbmFnZXJGYWN0\nb3J5IGxlZGdlck1hbmFnZXJGYWN0b3J5OwogICAgZmluYWwgTGVkZ2VyTWFu\nYWdlciBsZWRnZXJNYW5hZ2VyOwogICAgZmluYWwgTGVkZ2VyU3RvcmFnZSBs\nZWRnZXJTdG9yYWdlOwogICAgZmluYWwgSm91cm5hbCBqb3VybmFsOwoKICAg\nIGZpbmFsIEhhbmRsZUZhY3RvcnkgaGFuZGxlczsKCiAgICBzdGF0aWMgZmlu\nYWwgbG9uZyBNRVRBRU5UUllfSURfTEVER0VSX0tFWSA9IC0weDEwMDA7CiAg\nICBzdGF0aWMgZmluYWwgbG9uZyBNRVRBRU5UUllfSURfRkVOQ0VfS0VZICA9\nIC0weDIwMDA7CgogICAgLy8gWksgcmVnaXN0cmF0aW9uIHBhdGggZm9yIHRo\naXMgYm9va2llCiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBib29raWVSZWdp\nc3RyYXRpb25QYXRoOwoKICAgIHByaXZhdGUgTGVkZ2VyRGlyc01hbmFnZXIg\nbGVkZ2VyRGlyc01hbmFnZXI7CgogICAgLy8gWm9vS2VlcGVyIGNsaWVudCBp\nbnN0YW5jZSBmb3IgdGhlIEJvb2tpZQogICAgWm9vS2VlcGVyIHprOwoKICAg\nIC8vIFJ1bm5pbmcgZmxhZwogICAgcHJpdmF0ZSB2b2xhdGlsZSBib29sZWFu\nIHJ1bm5pbmcgPSBmYWxzZTsKICAgIC8vIEZsYWcgaWRlbnRpZnkgd2hldGhl\nciBpdCBpcyBpbiBzaHV0dGluZyBkb3duIHByb2dyZXNzCiAgICBwcml2YXRl\nIHZvbGF0aWxlIGJvb2xlYW4gc2h1dHRpbmdkb3duID0gZmFsc2U7CgogICAg\ncHJpdmF0ZSBpbnQgZXhpdENvZGUgPSBFeGl0Q29kZS5PSzsKCiAgICAvLyBq\nbXggcmVsYXRlZCBiZWFucwogICAgQm9va2llQmVhbiBqbXhCb29raWVCZWFu\nOwogICAgQktNQmVhbkluZm8gam14TGVkZ2VyU3RvcmFnZUJlYW47CgogICAg\nTWFwPExvbmcsIGJ5dGVbXT4gbWFzdGVyS2V5Q2FjaGUgPSBDb2xsZWN0aW9u\ncy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8TG9uZywgYnl0ZVtdPigp\nKTsKCiAgICBmaW5hbCBwcml2YXRlIFN0cmluZyB6a0Jvb2tpZVJlZ1BhdGg7\nCgogICAgZmluYWwgcHJpdmF0ZSBBdG9taWNCb29sZWFuIHJlYWRPbmx5ID0g\nbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwoKICAgIHB1YmxpYyBzdGF0aWMg\nY2xhc3MgTm9MZWRnZXJFeGNlcHRpb24gZXh0ZW5kcyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJz\naW9uVUlEID0gMUw7CiAgICAgICAgcHJpdmF0ZSBsb25nIGxlZGdlcklkOwog\nICAgICAgIHB1YmxpYyBOb0xlZGdlckV4Y2VwdGlvbihsb25nIGxlZGdlcklk\nKSB7CiAgICAgICAgICAgIHN1cGVyKCJMZWRnZXIgIiArIGxlZGdlcklkICsg\nIiBub3QgZm91bmQiKTsKICAgICAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxl\nZGdlcklkOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgbG9uZyBnZXRMZWRn\nZXJJZCgpIHsKICAgICAgICAgICAgcmV0dXJuIGxlZGdlcklkOwogICAgICAg\nIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTm9FbnRyeUV4Y2Vw\ndGlvbiBleHRlbmRzIElPRXhjZXB0aW9uIHsKICAgICAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAxTDsKICAgICAg\nICBwcml2YXRlIGxvbmcgbGVkZ2VySWQ7CiAgICAgICAgcHJpdmF0ZSBsb25n\nIGVudHJ5SWQ7CiAgICAgICAgcHVibGljIE5vRW50cnlFeGNlcHRpb24obG9u\nZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgICAgIHRoaXMo\nIkVudHJ5ICIgKyBlbnRyeUlkICsgIiBub3QgZm91bmQgaW4gIiArIGxlZGdl\ncklkLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgTm9FbnRyeUV4Y2VwdGlvbihTdHJpbmcgbXNnLCBsb25nIGxlZGdl\ncklkLCBsb25nIGVudHJ5SWQpIHsKICAgICAgICAgICAgc3VwZXIobXNnKTsK\nICAgICAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAgICAg\nICAgICB0aGlzLmVudHJ5SWQgPSBlbnRyeUlkOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGxvbmcgZ2V0TGVkZ2VyKCkgewogICAgICAgICAgICByZXR1\ncm4gbGVkZ2VySWQ7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBsb25nIGdl\ndEVudHJ5KCkgewogICAgICAgICAgICByZXR1cm4gZW50cnlJZDsKICAgICAg\nICB9CiAgICB9CgogICAgLy8gV3JpdGUgQ2FsbGJhY2sgZG8gbm90aGluZwog\nICAgc3RhdGljIGNsYXNzIE5vcFdyaXRlQ2FsbGJhY2sgaW1wbGVtZW50cyBX\ncml0ZUNhbGxiYWNrIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCB3cml0ZUNvbXBsZXRlKGludCByYywgbG9uZyBsZWRnZXJJZCwg\nbG9uZyBlbnRyeUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiRmluaXNoZWQgd3JpdGluZyBlbnRyeSB7fSBA\nIGxlZGdlciB7fSBmb3Ige30gOiB7fSIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgbmV3IE9iamVjdFtdIHsgZW50cnlJZCwgbGVkZ2VySWQsIGFkZHIs\nIHJjIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZp\nbmFsIHN0YXRpYyBGdXR1cmU8Qm9vbGVhbj4gU1VDQ0VTU19GVVRVUkUgPSBu\nZXcgRnV0dXJlPEJvb2xlYW4+KCkgewogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbChib29sZWFuIG1heUludGVycnVw\ndElmUnVubmluZykgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgQm9vbGVhbiBnZXQoKSB7IHJldHVybiB0cnVl\nOyB9CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIEJvb2xlYW4g\nZ2V0KGxvbmcgdGltZW91dCwgVGltZVVuaXQgdW5pdCkgeyByZXR1cm4gdHJ1\nZTsgfQogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFu\nIGlzQ2FuY2VsbGVkKCkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RvbmUoKSB7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH07CgogICAgc3Rh\ndGljIGNsYXNzIENvdW50RG93bkxhdGNoRnV0dXJlPFQ+IGltcGxlbWVudHMg\nRnV0dXJlPFQ+IHsKCiAgICAgICAgVCB2YWx1ZSA9IG51bGw7CiAgICAgICAg\ndm9sYXRpbGUgYm9vbGVhbiBkb25lID0gZmFsc2U7CiAgICAgICAgQ291bnRE\nb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbChi\nb29sZWFuIG1heUludGVycnVwdElmUnVubmluZykgeyByZXR1cm4gZmFsc2U7\nIH0KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgVCBnZXQoKSB0\naHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICBsYXRj\naC5hd2FpdCgpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAg\nfQogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBUIGdldChsb25n\nIHRpbWVvdXQsIFRpbWVVbml0IHVuaXQpIHRocm93cyBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGxhdGNoLmF3YWl0KHRpbWVvdXQsIHVu\naXQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0NhbmNl\nbGxlZCgpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzRG9uZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIGRvbmU7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHNldERvbmUo\nVCB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAg\nICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICBsYXRjaC5jb3Vu\ndERvd24oKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNsYXNzIEZ1\ndHVyZVdyaXRlQ2FsbGJhY2sgaW1wbGVtZW50cyBXcml0ZUNhbGxiYWNrIHsK\nCiAgICAgICAgQ291bnREb3duTGF0Y2hGdXR1cmU8Qm9vbGVhbj4gcmVzdWx0\nID0KICAgICAgICAgICAgbmV3IENvdW50RG93bkxhdGNoRnV0dXJlPEJvb2xl\nYW4+KCk7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIHdyaXRlQ29tcGxldGUoaW50IHJjLCBsb25nIGxlZGdlcklkLCBsb25nIGVu\ndHJ5SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmV0\nU29ja2V0QWRkcmVzcyBhZGRyLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAg\nIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nTE9HLmRlYnVnKCJGaW5pc2hlZCB3cml0aW5nIGVudHJ5IHt9IEAgbGVkZ2Vy\nIHt9IGZvciB7fSA6IHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W10geyBlbnRyeUlkLCBsZWRnZXJJZCwgYWRkciwgcmMgfSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzdWx0LnNldERvbmUoMCA9\nPSByYyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgRnV0dXJlPEJvb2xl\nYW4+IGdldFJlc3VsdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5jVGhyZWFkIGlz\nIGEgYmFja2dyb3VuZCB0aHJlYWQgd2hpY2ggZmx1c2hlcyBsZWRnZXIgaW5k\nZXggcGFnZXMgcGVyaW9kaWNhbGx5LgogICAgICogQWxzbyBpdCB0YWtlcyBy\nZXNwb25zaWJpbGl0eSBvZiBnYXJiYWdlIGNvbGxlY3Rpbmcgam91cm5hbCBm\naWxlcy4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIEJlZm9yZSBmbHVzaGlu\nZywgU3luY1RocmVhZCBmaXJzdCByZWNvcmRzIGEgbG9nIG1hcmtlciB7am91\ncm5hbElkLCBqb3VybmFsUG9zfSBpbiBtZW1vcnksCiAgICAgKiB3aGljaCBp\nbmRpY2F0ZXMgZW50cmllcyBiZWZvcmUgdGhpcyBsb2cgbWFya2VyIHdvdWxk\nIGJlIHBlcnNpc3RlZCB0byBsZWRnZXIgZmlsZXMuCiAgICAgKiBUaGVuIHN5\nbmMgdGhyZWFkIGJlZ2lucyBmbHVzaGluZyBsZWRnZXIgaW5kZXggcGFnZXMg\ndG8gbGVkZ2VyIGluZGV4IGZpbGVzLCBmbHVzaCBlbnRyeQogICAgICogbG9n\nZ2VyIHRvIGVuc3VyZSBhbGwgZW50cmllcyBwZXJzaXN0ZWQgdG8gZW50cnkg\nbG9nZ2VycyBmb3IgZnV0dXJlIHJlYWRzLgogICAgICogPC9wPgogICAgICog\nPHA+CiAgICAgKiBBZnRlciBhbGwgZGF0YSBoYXMgYmVlbiBwZXJzaXN0ZWQg\ndG8gbGVkZ2VyIGluZGV4IGZpbGVzIGFuZCBlbnRyeSBsb2dnZXJzLCBpdCBp\ncyBzYWZlCiAgICAgKiB0byBwZXJzaXN0IHRoZSBsb2cgbWFya2VyIHRvIGRp\nc2suIElmIGJvb2tpZSBmYWlsZWQgYWZ0ZXIgcGVyc2lzdCBsb2cgbWFyaywK\nICAgICAqIGJvb2tpZSBpcyBhYmxlIHRvIHJlbGF5IGpvdXJuYWwgZW50cmll\ncyBzdGFydGVkIGZyb20gbGFzdCBsb2cgbWFyayB3aXRob3V0IGxvc2luZwog\nICAgICogYW55IGVudHJpZXMuCiAgICAgKiA8L3A+CiAgICAgKiA8cD4KICAg\nICAqIFRob3NlIGpvdXJuYWwgZmlsZXMgd2hvc2UgaWQgYXJlIGxlc3MgdGhh\nbiB0aGUgbG9nIGlkIGluIGxhc3QgbG9nIG1hcmssIGNvdWxkIGJlCiAgICAg\nKiByZW1vdmVkIHNhZmVseSBhZnRlciBwZXJzaXN0aW5nIGxhc3QgbG9nIG1h\ncmsuIFdlIHByb3ZpZGUgYSBzZXR0aW5nIHRvIGxldCB1c2VyIGtlZXBpbmcK\nICAgICAqIG51bWJlciBvZiBvbGQgam91cm5hbCBmaWxlcyB3aGljaCBtYXkg\nYmUgdXNlZCBmb3IgbWFudWFsIHJlY292ZXJ5IGluIGNyaXRpY2FsIGRpc2Fz\ndGVyLgogICAgICogPC9wPgogICAgICovCiAgICBjbGFzcyBTeW5jVGhyZWFk\nIGV4dGVuZHMgVGhyZWFkIHsKICAgICAgICB2b2xhdGlsZSBib29sZWFuIHJ1\nbm5pbmcgPSB0cnVlOwogICAgICAgIC8vIGZsYWcgdG8gZW5zdXJlIHN5bmMg\ndGhyZWFkIHdpbGwgbm90IGJlIGludGVycnVwdGVkIGR1cmluZyBmbHVzaAog\nICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gZmx1c2hpbmcgPSBuZXcgQXRv\nbWljQm9vbGVhbihmYWxzZSk7CiAgICAgICAgLy8gbWFrZSBmbHVzaCBpbnRl\ncnZhbCBhcyBhIHBhcmFtZXRlcgogICAgICAgIGZpbmFsIGludCBmbHVzaElu\ndGVydmFsOwogICAgICAgIHB1YmxpYyBTeW5jVGhyZWFkKFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZikgewogICAgICAgICAgICBzdXBlcigiU3luY1RocmVh\nZCIpOwogICAgICAgICAgICBmbHVzaEludGVydmFsID0gY29uZi5nZXRGbHVz\naEludGVydmFsKCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiRmx1c2ggSW50\nZXJ2YWwgOiB7fSIsIGZsdXNoSW50ZXJ2YWwpOwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBPYmplY3Qgc3VzcGVuc2lvbkxvY2sgPSBuZXcgT2JqZWN0\nKCk7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIHN1c3BlbmRlZCA9IGZhbHNl\nOwoKICAgICAgICAvKioKICAgICAgICAgKiBTdXNwZW5kIHN5bmMgdGhyZWFk\nLiAoZm9yIHRlc3RpbmcpCiAgICAgICAgICovCiAgICAgICAgQFZpc2libGVG\nb3JUZXN0aW5nCiAgICAgICAgcHVibGljIHZvaWQgc3VzcGVuZFN5bmMoKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZChzdXNwZW5zaW9uTG9jaykgewog\nICAgICAgICAgICAgICAgc3VzcGVuZGVkID0gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVzdW1lIHN5\nbmMgdGhyZWFkLiAoZm9yIHRlc3RpbmcpCiAgICAgICAgICovCiAgICAgICAg\nQFZpc2libGVGb3JUZXN0aW5nCiAgICAgICAgcHVibGljIHZvaWQgcmVzdW1l\nU3luYygpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkKHN1c3BlbnNpb25M\nb2NrKSB7CiAgICAgICAgICAgICAgICBzdXNwZW5kZWQgPSBmYWxzZTsKICAg\nICAgICAgICAgICAgIHN1c3BlbnNpb25Mb2NrLm5vdGlmeSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICB3aGlsZSAocnVubmluZykgewogICAgICAgICAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdChmbHVz\naEludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgh\nbGVkZ2VyU3RvcmFnZS5pc0ZsdXNoUmVxdWlyZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVw\ndCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChzdXNwZW5zaW9u\nTG9jaykgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3VzcGVu\nZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXNwZW5zaW9u\nTG9jay53YWl0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IHRv\nIG1hcmsgZmx1c2hpbmcgZmxhZyB0byBtYWtlIHN1cmUgaXQgd291bGQgbm90\nIGJlIGludGVycnVwdGVkCiAgICAgICAgICAgICAgICAgICAgLy8gYnkgc2h1\ndGRvd24gZHVyaW5nIGZsdXNoaW5nLiBvdGhlcndpc2UgaXQgd2lsbCByZWNl\naXZlCiAgICAgICAgICAgICAgICAgICAgLy8gQ2xvc2VkQnlJbnRlcnJ1cHRF\neGNlcHRpb24gd2hpY2ggbWF5IGNhdXNlIGluZGV4IGZpbGUgJiBlbnRyeSBs\nb2dnZXIKICAgICAgICAgICAgICAgICAgICAvLyBjbG9zZWQgYW5kIGNvcnJ1\ncHRlZC4KICAgICAgICAgICAgICAgICAgICBpZiAoIWZsdXNoaW5nLmNvbXBh\ncmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHNldCBmbHVzaGluZyBmbGFnIGZhaWxlZCwgbWVhbnMgZmx1c2hp\nbmcgaXMgdHJ1ZSBub3cKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5k\naWNhdGVzIGFub3RoZXIgdGhyZWFkIHdhbnRzIHRvIGludGVycnVwdCBzeW5j\nIHRocmVhZCB0byBleGl0CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\nLy8gam91cm5hbCBtYXJrIGxvZwogICAgICAgICAgICAgICAgICAgIGpvdXJu\nYWwubWFya0xvZygpOwoKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGZs\ndXNoRmFpbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyU3RvcmFnZS5mbHVzaCgp\nOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vV3JpdGFibGVMZWRn\nZXJEaXJFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBm\nbHVzaEZhaWxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGZs\ndXNoaW5nLnNldChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRy\nYW5zaXRpb25Ub1JlYWRPbmx5TW9kZSgpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gZmx1c2hpbmcgTGVkZ2VyIiwg\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoRmFpbGVkID0gdHJ1\nZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAg\nIC8vIGlmIGZsdXNoIGZhaWxlZCwgd2Ugc2hvdWxkIG5vdCByb2xsIGxhc3Qg\nbWFyaywgb3RoZXJ3aXNlIHdlIHdvdWxkCiAgICAgICAgICAgICAgICAgICAg\nLy8gaGF2ZSBzb21lIGxlZGdlcnMgYXJlIG5vdCBmbHVzaGVkIGFuZCB0aGVp\nciBqb3VybmFsIGVudHJpZXMgd2VyZSBsb3N0CiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFmbHVzaEZhaWxlZCkgewogICAgICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbC5y\nb2xsTG9nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFs\nLmdjSm91cm5hbHMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmbHVzaGluZy5zZXQoZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvblRvUmVhZE9ubHlN\nb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIGZsdXNo\naW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICBmbHVzaGluZy5zZXQoZmFs\nc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChU\naHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNl\ncHRpb24gaW4gU3luY1RocmVhZCIsIHQpOwogICAgICAgICAgICAgICAgdHJp\nZ2dlckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9FWENFUFRJT04p\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBzaHV0ZG93\nbiBzeW5jIHRocmVhZAogICAgICAgIHZvaWQgc2h1dGRvd24oKSB0aHJvd3Mg\nSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICBydW5uaW5nID0g\nZmFsc2U7CiAgICAgICAgICAgIGlmIChmbHVzaGluZy5jb21wYXJlQW5kU2V0\nKGZhbHNlLCB0cnVlKSkgewogICAgICAgICAgICAgICAgLy8gaWYgc2V0dGlu\nZyBmbHVzaGluZyBmbGFnIHN1Y2NlZWQsIG1lYW5zIHN5bmNUaHJlYWQgaXMg\nbm90IGZsdXNoaW5nIG5vdwogICAgICAgICAgICAgICAgLy8gaXQgaXMgc2Fm\nZSB0byBpbnRlcnJ1cHQgaXRzZWxmIG5vdyAKICAgICAgICAgICAgICAgIHRo\naXMuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhp\ncy5qb2luKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMg\ndm9pZCBjaGVja0RpcmVjdG9yeVN0cnVjdHVyZShGaWxlIGRpcikgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWRpci5leGlzdHMoKSkgewog\nICAgICAgICAgICBGaWxlIHBhcmVudCA9IGRpci5nZXRQYXJlbnRGaWxlKCk7\nCiAgICAgICAgICAgIEZpbGUgcHJlVjN2ZXJzaW9uRmlsZSA9IG5ldyBGaWxl\nKGRpci5nZXRQYXJlbnQoKSwKICAgICAgICAgICAgICAgICAgICBCb29rS2Vl\ncGVyQ29uc3RhbnRzLlZFUlNJT05fRklMRU5BTUUpOwoKICAgICAgICAgICAg\nZmluYWwgQXRvbWljQm9vbGVhbiBvbGREYXRhRXhpc3RzID0gbmV3IEF0b21p\nY0Jvb2xlYW4oZmFsc2UpOwogICAgICAgICAgICBwYXJlbnQubGlzdChuZXcg\nRmlsZW5hbWVGaWx0ZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIGJvb2xlYW4gYWNjZXB0KEZpbGUgZGlyLCBTdHJpbmcgbmFtZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobmFtZS5lbmRzV2l0aCgiLnR4biIp\nIHx8IG5hbWUuZW5kc1dpdGgoIi5pZHgiKSB8fCBuYW1lLmVuZHNXaXRoKCIu\nbG9nIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZERhdGFF\neGlzdHMuc2V0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBp\nZiAocHJlVjN2ZXJzaW9uRmlsZS5leGlzdHMoKSB8fCBvbGREYXRhRXhpc3Rz\nLmdldCgpKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcgZXJyID0gIkRpcmVj\ndG9yeSBsYXlvdXQgdmVyc2lvbiBpcyBsZXNzIHRoYW4gMywgdXBncmFkZSBu\nZWVkZWQiOwogICAgICAgICAgICAgICAgTE9HLmVycm9yKGVycik7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZXJyKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoIWRpci5ta2RpcnMoKSkgewogICAg\nICAgICAgICAgICAgU3RyaW5nIGVyciA9ICJVbmFibGUgdG8gY3JlYXRlIGRp\ncmVjdG9yeSAiICsgZGlyOwogICAgICAgICAgICAgICAgTE9HLmVycm9yKGVy\ncik7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZXJy\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENoZWNrIHRoYXQgdGhlIGVudmlyb25tZW50IGZvciB0aGUgYm9va2ll\nIGlzIGNvcnJlY3QuCiAgICAgKiBUaGlzIG1lYW5zIHRoYXQgdGhlIGNvbmZp\nZ3VyYXRpb24gaGFzIHN0YXllZCB0aGUgc2FtZSBhcyB0aGUKICAgICAqIGZp\ncnN0IHJ1biBhbmQgdGhlIGZpbGVzeXN0ZW0gc3RydWN0dXJlIGlzIHVwIHRv\nIGRhdGUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBjaGVja0Vudmlyb25t\nZW50KFpvb0tlZXBlciB6aykgdGhyb3dzIEJvb2tpZUV4Y2VwdGlvbiwgSU9F\neGNlcHRpb24gewogICAgICAgIGlmICh6ayA9PSBudWxsKSB7IC8vIGV4aXN0\ncyBvbmx5IGZvciB0ZXN0aW5nLCBqdXN0IG1ha2Ugc3VyZSBkaXJlY3Rvcmll\ncyBhcmUgY29ycmVjdAogICAgICAgICAgICBjaGVja0RpcmVjdG9yeVN0cnVj\ndHVyZShqb3VybmFsRGlyZWN0b3J5KTsKICAgICAgICAgICAgZm9yIChGaWxl\nIGRpciA6IGxlZGdlckRpcnNNYW5hZ2VyLmdldEFsbExlZGdlckRpcnMoKSkg\newogICAgICAgICAgICAgICAgICAgIGNoZWNrRGlyZWN0b3J5U3RydWN0dXJl\nKGRpcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmcgaW5zdGFu\nY2VJZCA9IGdldEluc3RhbmNlSWQoemspOwogICAgICAgICAgICBib29sZWFu\nIG5ld0VudiA9IGZhbHNlOwogICAgICAgICAgICBDb29raWUgbWFzdGVyQ29v\na2llID0gQ29va2llLmdlbmVyYXRlQ29va2llKGNvbmYpOwogICAgICAgICAg\nICBpZiAobnVsbCAhPSBpbnN0YW5jZUlkKSB7CiAgICAgICAgICAgICAgICBt\nYXN0ZXJDb29raWUuc2V0SW5zdGFuY2VJZChpbnN0YW5jZUlkKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgQ29v\na2llIHprQ29va2llID0gQ29va2llLnJlYWRGcm9tWm9vS2VlcGVyKHprLCBj\nb25mKTsKICAgICAgICAgICAgICAgIG1hc3RlckNvb2tpZS52ZXJpZnkoemtD\nb29raWUpOwogICAgICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24u\nTm9Ob2RlRXhjZXB0aW9uIG5uZSkgewogICAgICAgICAgICAgICAgbmV3RW52\nID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBMaXN0PEZpbGU+\nIG1pc3NlZENvb2tpZURpcnMgPSBuZXcgQXJyYXlMaXN0PEZpbGU+KCk7CiAg\nICAgICAgICAgIGNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKGpvdXJuYWxEaXJl\nY3RvcnkpOwoKICAgICAgICAgICAgLy8gdHJ5IHRvIHJlYWQgY29va2llIGZy\nb20gam91cm5hbCBkaXJlY3RvcnkKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIENvb2tpZSBqb3VybmFsQ29va2llID0gQ29va2llLnJlYWRG\ncm9tRGlyZWN0b3J5KGpvdXJuYWxEaXJlY3RvcnkpOwogICAgICAgICAgICAg\nICAgam91cm5hbENvb2tpZS52ZXJpZnkobWFzdGVyQ29va2llKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGZuZikgewog\nICAgICAgICAgICAgICAgbWlzc2VkQ29va2llRGlycy5hZGQoam91cm5hbERp\ncmVjdG9yeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChGaWxl\nIGRpciA6IGxlZGdlckRpcnNNYW5hZ2VyLmdldEFsbExlZGdlckRpcnMoKSkg\newogICAgICAgICAgICAgICAgY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoZGly\nKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nQ29va2llIGMgPSBDb29raWUucmVhZEZyb21EaXJlY3RvcnkoZGlyKTsKICAg\nICAgICAgICAgICAgICAgICBjLnZlcmlmeShtYXN0ZXJDb29raWUpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGZu\nZikgewogICAgICAgICAgICAgICAgICAgIG1pc3NlZENvb2tpZURpcnMuYWRk\nKGRpcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGlmICghbmV3RW52ICYmIG1pc3NlZENvb2tpZURpcnMuc2l6ZSgp\nID4gMCl7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvb2tpZSBleGlz\ndHMgaW4gem9va2VlcGVyLCBidXQgbm90IGluIGFsbCBsb2NhbCBkaXJlY3Rv\ncmllcy4gIgogICAgICAgICAgICAgICAgICAgICAgICArICIgRGlyZWN0b3Jp\nZXMgbWlzc2luZyBjb29raWUgZmlsZSBhcmUgIiArIG1pc3NlZENvb2tpZURp\ncnMpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlv\nbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKG5ld0VudikgewogICAgICAgICAgICAgICAgaWYgKG1p\nc3NlZENvb2tpZURpcnMuc2l6ZSgpID4gMCkgewogICAgICAgICAgICAgICAg\nICAgIExPRy5kZWJ1ZygiRGlyZWN0b3JpZXMgbWlzc2luZyBjb29raWUgZmls\nZSBhcmUge30iLCBtaXNzZWRDb29raWVEaXJzKTsKICAgICAgICAgICAgICAg\nICAgICBtYXN0ZXJDb29raWUud3JpdGVUb0RpcmVjdG9yeShqb3VybmFsRGly\nZWN0b3J5KTsKICAgICAgICAgICAgICAgICAgICBmb3IgKEZpbGUgZGlyIDog\nbGVkZ2VyRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIG1hc3RlckNvb2tpZS53cml0ZVRvRGlyZWN0\nb3J5KGRpcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgbWFzdGVyQ29va2llLndyaXRlVG9ab29L\nZWVwZXIoemssIGNvbmYpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRj\naCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiQ291bGRuJ3QgYWNjZXNzIGNvb2tpZSBpbiB6b29rZWVwZXIiLCBrZSk7\nCiAgICAgICAgICAgIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uSW52YWxp\nZENvb2tpZUV4Y2VwdGlvbihrZSk7CiAgICAgICAgfSBjYXRjaCAoVW5rbm93\nbkhvc3RFeGNlcHRpb24gdWhlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nQ291bGRuJ3QgY2hlY2sgY29va2llcywgbmV0d29ya2luZyBpcyBicm9rZW4i\nLCB1aGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9u\nLkludmFsaWRDb29raWVFeGNlcHRpb24odWhlKTsKICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJF\ncnJvciBhY2Nlc3NpbmcgY29va2llIG9uIGRpc2tzIiwgaW9lKTsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2ll\nRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUaHJlYWQg\naW50ZXJydXB0ZWQgd2hpbGUgY2hlY2tpbmcgY29va2llcywgZXhpdGluZyIs\nIGllKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5J\nbnZhbGlkQ29va2llRXhjZXB0aW9uKGllKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBSZXR1cm4gdGhlIGNvbmZpZ3VyZWQgYWRkcmVzcyBv\nZiB0aGUgYm9va2llLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIEluZXRT\nb2NrZXRBZGRyZXNzIGdldEJvb2tpZUFkZHJlc3MoU2VydmVyQ29uZmlndXJh\ndGlvbiBjb25mKQogICAgICAgICAgICB0aHJvd3MgVW5rbm93bkhvc3RFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBuZXcgSW5ldFNvY2tldEFkZHJlc3Mo\nSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkKICAgICAgICAgICAgICAgIC5n\nZXRIb3N0QWRkcmVzcygpLCBjb25mLmdldEJvb2tpZVBvcnQoKSk7CiAgICB9\nCgogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0SW5zdGFuY2VJZChab29LZWVwZXIg\nemspIHRocm93cyBLZWVwZXJFeGNlcHRpb24sCiAgICAgICAgICAgIEludGVy\ncnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgaW5zdGFuY2VJZCA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYnl0ZVtdIGRhdGEg\nPSB6ay5nZXREYXRhKGNvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICIv\nIgogICAgICAgICAgICAgICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5J\nTlNUQU5DRUlELCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICAgIGluc3RhbmNl\nSWQgPSBuZXcgU3RyaW5nKGRhdGEpOwogICAgICAgIH0gY2F0Y2ggKEtlZXBl\nckV4Y2VwdGlvbi5Ob05vZGVFeGNlcHRpb24gZSkgewogICAgICAgICAgICBM\nT0cud2FybigiSU5TVEFOQ0VJRCBub3QgZXhpc3RzIGluIHpvb2tlZXBlci4g\nTm90IGNvbnNpZGVyaW5nIGl0IGZvciBkYXRhIHZlcmlmaWNhdGlvbiIpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gaW5zdGFuY2VJZDsKICAgIH0KCiAg\nICBwdWJsaWMgTGVkZ2VyRGlyc01hbmFnZXIgZ2V0TGVkZ2VyRGlyc01hbmFn\nZXIoKSB7CiAgICAgICAgcmV0dXJuIGxlZGdlckRpcnNNYW5hZ2VyOwogICAg\nfQoKICAgIHB1YmxpYyBzdGF0aWMgRmlsZSBnZXRDdXJyZW50RGlyZWN0b3J5\nKEZpbGUgZGlyKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWxlKGRpciwgQm9v\na0tlZXBlckNvbnN0YW50cy5DVVJSRU5UX0RJUik7CiAgICB9CgogICAgcHVi\nbGljIHN0YXRpYyBGaWxlW10gZ2V0Q3VycmVudERpcmVjdG9yaWVzKEZpbGVb\nXSBkaXJzKSB7CiAgICAgICAgRmlsZVtdIGN1cnJlbnREaXJzID0gbmV3IEZp\nbGVbZGlycy5sZW5ndGhdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nZGlycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjdXJyZW50RGlyc1tp\nXSA9IGdldEN1cnJlbnREaXJlY3RvcnkoZGlyc1tpXSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBjdXJyZW50RGlyczsKICAgIH0KCgogICAgcHVibGlj\nIEJvb2tpZShTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAgICBzdXBl\ncigiQm9va2llLSIgKyBjb25mLmdldEJvb2tpZVBvcnQoKSk7CiAgICAgICAg\ndGhpcy5ib29raWVSZWdpc3RyYXRpb25QYXRoID0gY29uZi5nZXRaa0F2YWls\nYWJsZUJvb2tpZXNQYXRoKCkgKyAiLyI7CiAgICAgICAgdGhpcy5jb25mID0g\nY29uZjsKICAgICAgICB0aGlzLmpvdXJuYWxEaXJlY3RvcnkgPSBnZXRDdXJy\nZW50RGlyZWN0b3J5KGNvbmYuZ2V0Sm91cm5hbERpcigpKTsKICAgICAgICB0\naGlzLmxlZGdlckRpcnNNYW5hZ2VyID0gbmV3IExlZGdlckRpcnNNYW5hZ2Vy\nKGNvbmYpOwogICAgICAgIC8vIGluc3RhbnRpYXRlIHpvb2tlZXBlciBjbGll\nbnQgdG8gaW5pdGlhbGl6ZSBsZWRnZXIgbWFuYWdlcgogICAgICAgIHRoaXMu\nemsgPSBpbnN0YW50aWF0ZVpvb2tlZXBlckNsaWVudChjb25mKTsKICAgICAg\nICBjaGVja0Vudmlyb25tZW50KHRoaXMuemspOwogICAgICAgIGxlZGdlck1h\nbmFnZXJGYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2Vy\nTWFuYWdlckZhY3RvcnkoY29uZiwgdGhpcy56ayk7CiAgICAgICAgTE9HLmlu\nZm8oImluc3RhbnRpYXRlIGxlZGdlciBtYW5hZ2VyIHt9IiwgbGVkZ2VyTWFu\nYWdlckZhY3RvcnkuZ2V0Q2xhc3MoKS5nZXROYW1lKCkpOwogICAgICAgIGxl\nZGdlck1hbmFnZXIgPSBsZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJN\nYW5hZ2VyKCk7CiAgICAgICAgc3luY1RocmVhZCA9IG5ldyBTeW5jVGhyZWFk\nKGNvbmYpOwogICAgICAgIGxlZGdlclN0b3JhZ2UgPSBuZXcgSW50ZXJsZWF2\nZWRMZWRnZXJTdG9yYWdlKGNvbmYsIGxlZGdlck1hbmFnZXIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbGVkZ2VyRGlyc01hbmFnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEJvb2tpZVNhZmVFbnRy\neUFkZGVyKCkpOwogICAgICAgIGhhbmRsZXMgPSBuZXcgSGFuZGxlRmFjdG9y\neUltcGwobGVkZ2VyU3RvcmFnZSk7CiAgICAgICAgLy8gaW5zdGFudGlhdGUg\ndGhlIGpvdXJuYWwKICAgICAgICBqb3VybmFsID0gbmV3IEpvdXJuYWwoY29u\nZiwgbGVkZ2VyRGlyc01hbmFnZXIpOwoKICAgICAgICAvLyBaSyBlcGhlbWVy\nYWwgbm9kZSBmb3IgdGhpcyBCb29raWUuCiAgICAgICAgemtCb29raWVSZWdQ\nYXRoID0gdGhpcy5ib29raWVSZWdpc3RyYXRpb25QYXRoICsgZ2V0TXlJZCgp\nOwogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIGdldE15SWQoKSB0aHJvd3Mg\nVW5rbm93bkhvc3RFeGNlcHRpb24gewogICAgICAgIHJldHVybiBJbmV0QWRk\ncmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpICsgIjoiCiAg\nICAgICAgICAgICAgICArIGNvbmYuZ2V0Qm9va2llUG9ydCgpOwogICAgfQoK\nICAgIHZvaWQgcmVhZEpvdXJuYWwoKSB0aHJvd3MgSU9FeGNlcHRpb24sIEJv\nb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgam91cm5hbC5yZXBsYXkobmV3IEpv\ndXJuYWxTY2FubmVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhpbnQgam91cm5hbFZlcnNpb24s\nIGxvbmcgb2Zmc2V0LCBCeXRlQnVmZmVyIHJlY0J1ZmYpIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICBsb25nIGxlZGdlcklkID0gcmVj\nQnVmZi5nZXRMb25nKCk7CiAgICAgICAgICAgICAgICBsb25nIGVudHJ5SWQg\nPSByZWNCdWZmLmdldExvbmcoKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJSZXBsYXkgam91cm5hbCAt\nIGxlZGdlciBpZCA6IHt9LCBlbnRyeSBpZCA6IHt9LiIsIGxlZGdlcklkLCBl\nbnRyeUlkKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnlJZCA9PSBN\nRVRBRU5UUllfSURfTEVER0VSX0tFWSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAoam91cm5hbFZlcnNpb24gPj0gMykgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaW50IG1hc3RlcktleUxlbiA9IHJlY0J1ZmYuZ2V0\nSW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gbWFz\ndGVyS2V5ID0gbmV3IGJ5dGVbbWFzdGVyS2V5TGVuXTsKCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZWNCdWZmLmdldChtYXN0ZXJLZXkpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbWFzdGVyS2V5Q2FjaGUucHV0KGxl\nZGdlcklkLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKCJJbnZhbGlkIGpvdXJuYWwuIENvbnRhaW5zIGpvdXJu\nYWxLZXkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nICIgYnV0IGxheW91dCB2ZXJzaW9uICgiICsgam91cm5hbFZlcnNpb24KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiKSBpcyB0b28g\nb2xkIHRvIGhvbGQgdGhpcyIpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbnRyeUlkID09IE1F\nVEFFTlRSWV9JRF9GRU5DRV9LRVkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGpvdXJuYWxWZXJzaW9uID49IDQpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGJ5dGVbXSBrZXkgPSBtYXN0ZXJLZXlDYWNoZS5nZXQo\nbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtl\neSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\na2V5ID0gbGVkZ2VyU3RvcmFnZS5yZWFkTWFzdGVyS2V5KGxlZGdlcklkKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gaGFuZGxl\ncy5nZXRIYW5kbGUobGVkZ2VySWQsIGtleSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBoYW5kbGUuc2V0RmVuY2VkKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkludmFsaWQgam91cm5hbC4gQ29u\ndGFpbnMgZmVuY2VLZXkgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArICIgYnV0IGxheW91dCB2ZXJzaW9uICgiICsgam91cm5hbFZl\ncnNpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nKSBpcyB0b28gb2xkIHRvIGhvbGQgdGhpcyIpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgYnl0ZVtdIGtleSA9IG1hc3RlcktleUNhY2hl\nLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChr\nZXkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5\nID0gbGVkZ2VyU3RvcmFnZS5yZWFkTWFzdGVyS2V5KGxlZGdlcklkKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBMZWRnZXJEZXNjcmlwdG9yIGhhbmRsZSA9IGhhbmRsZXMuZ2V0SGFuZGxl\nKGxlZGdlcklkLCBrZXkpOwoKICAgICAgICAgICAgICAgICAgICAgICAgcmVj\nQnVmZi5yZXdpbmQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaGFuZGxl\nLmFkZEVudHJ5KHJlY0J1ZmYpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKE5vTGVkZ2VyRXhjZXB0aW9uIG5zbGUp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlNraXAgcmVwbGF5\naW5nIGVudHJpZXMgb2YgbGVkZ2VyIHt9IHNpbmNlIGl0IHdhcyBkZWxldGVk\nLiIsIGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJvb2tp\nZUV4Y2VwdGlvbiBiZSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbihiZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVi\nbGljIHZvaWQgc3RhcnQoKSB7CiAgICAgICAgc2V0RGFlbW9uKHRydWUpOwog\nICAgICAgIExPRy5kZWJ1ZygiSSdtIHN0YXJ0aW5nIGEgYm9va2llIHdpdGgg\nam91cm5hbCBkaXJlY3Rvcnkge30iLCBqb3VybmFsRGlyZWN0b3J5LmdldE5h\nbWUoKSk7CiAgICAgICAgLy8gcmVwbGF5IGpvdXJuYWxzCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcmVhZEpvdXJuYWwoKTsKICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJF\neGNlcHRpb24gd2hpbGUgcmVwbGF5aW5nIGpvdXJuYWxzLCBzaHV0dGluZyBk\nb3duIiwgaW9lKTsKICAgICAgICAgICAgc2h1dGRvd24oRXhpdENvZGUuQk9P\nS0lFX0VYQ0VQVElPTik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nIGNhdGNoIChCb29raWVFeGNlcHRpb24gYmUpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJFeGNlcHRpb24gd2hpbGUgcmVwbGF5aW5nIGpvdXJuYWxzLCBz\naHV0dGluZyBkb3duIiwgYmUpOwogICAgICAgICAgICBzaHV0ZG93bihFeGl0\nQ29kZS5CT09LSUVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KICAgICAgICAvLyBzdGFydCBib29raWUgdGhyZWFkCiAgICAg\nICAgc3VwZXIuc3RhcnQoKTsKCiAgICAgICAgbGVkZ2VyRGlyc01hbmFnZXIu\nYWRkTGVkZ2VyRGlyc0xpc3RlbmVyKGdldExlZGdlckRpcnNMaXN0ZW5lcigp\nKTsKICAgICAgICAvL1N0YXJ0IERpc2tDaGVja2VyIHRocmVhZAogICAgICAg\nIGxlZGdlckRpcnNNYW5hZ2VyLnN0YXJ0KCk7CgogICAgICAgIGxlZGdlclN0\nb3JhZ2Uuc3RhcnQoKTsKCiAgICAgICAgc3luY1RocmVhZC5zdGFydCgpOwog\nICAgICAgIC8vIHNldCBydW5uaW5nIGhlcmUuCiAgICAgICAgLy8gc2luY2Ug\nYm9va2llIHNlcnZlciB1c2UgcnVubmluZyBhcyBhIGZsYWcgdG8gdGVsbCBi\nb29raWUgc2VydmVyIHdoZXRoZXIgaXQgaXMgYWxpdmUKICAgICAgICAvLyBp\nZiBzZXR0aW5nIGl0IGluIGJvb2tpZSB0aHJlYWQsIHRoZSB3YXRjaGVyIG1p\nZ2h0IHJ1biBiZWZvcmUgYm9va2llIHRocmVhZC4KICAgICAgICBydW5uaW5n\nID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZWdpc3RlckJv\nb2tpZShjb25mKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGRuJ3QgcmVnaXN0ZXIgYm9v\na2llIHdpdGggem9va2VlcGVyLCBzaHV0dGluZyBkb3duIiwgZSk7CiAgICAg\nICAgICAgIHNodXRkb3duKEV4aXRDb2RlLlpLX1JFR19GQUlMKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoKICAgICAqIEdldCB0aGUgRGlza0ZhaWx1cmUg\nbGlzdGVuZXIgZm9yIHRoZSBib29raWUKICAgICAqLwogICAgcHJpdmF0ZSBM\nZWRnZXJEaXJzTGlzdGVuZXIgZ2V0TGVkZ2VyRGlyc0xpc3RlbmVyKCkgewoK\nICAgICAgICByZXR1cm4gbmV3IExlZGdlckRpcnNMaXN0ZW5lcigpIHsKCiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBk\naXNrRnVsbChGaWxlIGRpc2spIHsKICAgICAgICAgICAgICAgIC8vIE5vdGhp\nbmcgbmVlZHMgdG8gYmUgaGFuZGxlZCBoZXJlLgogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\nZGlza0ZhaWxlZChGaWxlIGRpc2spIHsKICAgICAgICAgICAgICAgIC8vIFNo\ndXRkb3duIHRoZSBib29raWUgb24gZGlzayBmYWlsdXJlLgogICAgICAgICAg\nICAgICAgdHJpZ2dlckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9F\nWENFUFRJT04pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgYWxsRGlza3NGdWxsKCkgewog\nICAgICAgICAgICAgICAgLy8gVHJhbnNpdGlvbiB0byByZWFkT25seSBtb2Rl\nIG9uIGFsbCBkaXNrcyBmdWxsCiAgICAgICAgICAgICAgICB0cmFuc2l0aW9u\nVG9SZWFkT25seU1vZGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGZhdGFsRXJyb3Io\nKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkZhdGFsIGVycm9yIHJl\ncG9ydGVkIGJ5IGxlZGdlckRpcnNNYW5hZ2VyIik7CiAgICAgICAgICAgICAg\nICB0cmlnZ2VyQm9va2llU2h1dGRvd24oRXhpdENvZGUuQk9PS0lFX0VYQ0VQ\nVElPTik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIC8q\nKgogICAgICogUmVnaXN0ZXIgam14IHdpdGggcGFyZW50CiAgICAgKgogICAg\nICogQHBhcmFtIHBhcmVudCBwYXJlbnQgYmsgbWJlYW4gaW5mbwogICAgICov\nCiAgICBwdWJsaWMgdm9pZCByZWdpc3RlckpNWChCS01CZWFuSW5mbyBwYXJl\nbnQpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBqbXhCb29raWVCZWFu\nID0gbmV3IEJvb2tpZUJlYW4odGhpcyk7CiAgICAgICAgICAgIEJLTUJlYW5S\nZWdpc3RyeS5nZXRJbnN0YW5jZSgpLnJlZ2lzdGVyKGpteEJvb2tpZUJlYW4s\nIHBhcmVudCk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nam14TGVkZ2VyU3RvcmFnZUJlYW4gPSB0aGlzLmxlZGdlclN0b3JhZ2UuZ2V0\nSk1YQmVhbigpOwogICAgICAgICAgICAgICAgQktNQmVhblJlZ2lzdHJ5Lmdl\ndEluc3RhbmNlKCkucmVnaXN0ZXIoam14TGVkZ2VyU3RvcmFnZUJlYW4sIGpt\neEJvb2tpZUJlYW4pOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIkZhaWxlZCB0byByZWdp\nc3RlciB3aXRoIEpNWCBmb3IgbGVkZ2VyIGNhY2hlIiwgZSk7CiAgICAgICAg\nICAgICAgICBqbXhMZWRnZXJTdG9yYWdlQmVhbiA9IG51bGw7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBMT0cud2FybigiRmFpbGVkIHRvIHJlZ2lzdGVyIHdpdGggSk1YIiwg\nZSk7CiAgICAgICAgICAgIGpteEJvb2tpZUJlYW4gPSBudWxsOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVucmVnaXN0ZXIgam14CiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHVucmVnaXN0ZXJKTVgoKSB7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaWYgKGpteExlZGdlclN0b3JhZ2VCZWFuICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgIEJLTUJlYW5SZWdpc3RyeS5nZXRJ\nbnN0YW5jZSgpLnVucmVnaXN0ZXIoam14TGVkZ2VyU3RvcmFnZUJlYW4pOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgTE9HLndhcm4oIkZhaWxlZCB0byB1bnJlZ2lzdGVyIHdp\ndGggSk1YIiwgZSk7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChqbXhCb29raWVCZWFuICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIEJLTUJlYW5SZWdpc3RyeS5nZXRJbnN0YW5jZSgpLnVucmVnaXN0ZXIo\nam14Qm9va2llQmVhbik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cud2FybigiRmFpbGVk\nIHRvIHVucmVnaXN0ZXIgd2l0aCBKTVgiLCBlKTsKICAgICAgICB9CiAgICAg\nICAgam14Qm9va2llQmVhbiA9IG51bGw7CiAgICAgICAgam14TGVkZ2VyU3Rv\ncmFnZUJlYW4gPSBudWxsOwogICAgfQoKCiAgICAvKioKICAgICAqIEluc3Rh\nbnRpYXRlIHRoZSBab29LZWVwZXIgY2xpZW50IGZvciB0aGUgQm9va2llLgog\nICAgICovCiAgICBwcml2YXRlIFpvb0tlZXBlciBpbnN0YW50aWF0ZVpvb2tl\nZXBlckNsaWVudChTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24s\nIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGNvbmYuZ2V0WmtTZXJ2\nZXJzKCkgPT0gbnVsbCkgewogICAgICAgICAgICBMT0cud2FybigiTm8gWksg\nc2VydmVycyBwYXNzZWQgdG8gQm9va2llIGNvbnN0cnVjdG9yIHNvIEJvb2tL\nZWVwZXIgY2xpZW50cyB3b24ndCBrbm93IGFib3V0IHRoaXMgc2VydmVyISIp\nOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAg\nLy8gQ3JlYXRlIHRoZSBab29LZWVwZXIgY2xpZW50IGluc3RhbmNlCiAgICAg\nICAgcmV0dXJuIG5ld1pvb2tlZXBlcihjb25mLmdldFprU2VydmVycygpLCBj\nb25mLmdldFprVGltZW91dCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nZ2lzdGVyIGFzIGFuIGF2YWlsYWJsZSBib29raWUKICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgcmVnaXN0ZXJCb29raWUoU2VydmVyQ29uZmlndXJhdGlv\nbiBjb25mKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChudWxs\nID09IHprKSB7CiAgICAgICAgICAgIC8vIHpvb2tlZXBlciBpbnN0YW5jZSBp\ncyBudWxsLCBtZWFucyBub3QgcmVnaXN0ZXIgaXRzZWxmIHRvIHprCiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIFpLIGVwaGVt\nZXJhbCBub2RlIGZvciB0aGlzIEJvb2tpZS4KICAgICAgICBTdHJpbmcgemtC\nb29raWVSZWdQYXRoID0gdGhpcy5ib29raWVSZWdpc3RyYXRpb25QYXRoCiAg\nICAgICAgICAgICsgU3RyaW5nVXRpbHMuYWRkclRvU3RyaW5nKGdldEJvb2tp\nZUFkZHJlc3MoY29uZikpOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNo\nIHByZXZOb2RlTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAg\nICAgdHJ5ewogICAgICAgICAgICBXYXRjaGVyIHprUHJldlJlZ05vZGV3YXRj\naGVyID0gbmV3IFdhdGNoZXIoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hl\nZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sg\nZm9yIHByZXYgem5vZGUgZGVsZXRpb24uIENvbm5lY3Rpb24gZXhwaXJhdGlv\nbiBpcwogICAgICAgICAgICAgICAgICAgIC8vIG5vdCBoYW5kbGluZywgc2lu\nY2UgYm9va2llIGhhcyBsb2dpYyB0byBzaHV0ZG93bi4KICAgICAgICAgICAg\nICAgICAgICBpZiAoRXZlbnRUeXBlLk5vZGVEZWxldGVkID09IGV2ZW50Lmdl\ndFR5cGUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwcmV2Tm9kZUxh\ndGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKG51\nbGwgIT0gemsuZXhpc3RzKHprQm9va2llUmVnUGF0aCwgemtQcmV2UmVnTm9k\nZXdhdGNoZXIpKSB7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiUHJldmlv\ndXMgYm9va2llIHJlZ2lzdHJhdGlvbiB6bm9kZTogIgogICAgICAgICAgICAg\nICAgICAgICAgICArIHprQm9va2llUmVnUGF0aAogICAgICAgICAgICAgICAg\nICAgICAgICArICIgZXhpc3RzLCBzbyB3YWl0aW5nIHprIHNlc3Npb250aW1l\nb3V0OiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgY29uZi5nZXRaa1Rp\nbWVvdXQoKSArICJtcyBmb3Igem5vZGUgZGVsZXRpb24iKTsKICAgICAgICAg\nICAgICAgIC8vIHdhaXRpbmcgZm9yIHRoZSBwcmV2aW91cyBib29raWUgcmVn\nIHpub2RlIGRlbGV0aW9uCiAgICAgICAgICAgICAgICBpZiAoIXByZXZOb2Rl\nTGF0Y2guYXdhaXQoY29uZi5nZXRaa1RpbWVvdXQoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgVGltZVVuaXQuTUlMTElTRUNPTkRTKSkgewogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBLZWVwZXJFeGNlcHRpb24uTm9kZUV4\naXN0c0V4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHpr\nQm9va2llUmVnUGF0aCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgWksgZXBoZW1lcmFsIG5v\nZGUgZm9yIHRoaXMgQm9va2llLgogICAgICAgICAgICB6ay5jcmVhdGUoemtC\nb29raWVSZWdQYXRoLCBuZXcgYnl0ZVswXSwgSWRzLk9QRU5fQUNMX1VOU0FG\nRSwKICAgICAgICAgICAgICAgICAgICBDcmVhdGVNb2RlLkVQSEVNRVJBTCk7\nCiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAg\nICAgICAgIExPRy5lcnJvcigiWksgZXhjZXB0aW9uIHJlZ2lzdGVyaW5nIGVw\naGVtZXJhbCBabm9kZSBmb3IgQm9va2llISIsCiAgICAgICAgICAgICAgICAg\nICAga2UpOwogICAgICAgICAgICAvLyBUaHJvdyBhbiBJT0V4Y2VwdGlvbiBi\nYWNrIHVwLiBUaGlzIHdpbGwgY2F1c2UgdGhlIEJvb2tpZQogICAgICAgICAg\nICAvLyBjb25zdHJ1Y3RvciB0byBlcnJvciBvdXQuIEFsdGVybmF0aXZlbHks\nIHdlIGNvdWxkIGRvIGEgU3lzdGVtCiAgICAgICAgICAgIC8vIGV4aXQgaGVy\nZSBhcyB0aGlzIGlzIGEgZmF0YWwgZXJyb3IuCiAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbihrZSk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJa\nSyBleGNlcHRpb24gcmVnaXN0ZXJpbmcgZXBoZW1lcmFsIFpub2RlIGZvciBC\nb29raWUhIiwKICAgICAgICAgICAgICAgICAgICBpZSk7CiAgICAgICAgICAg\nIC8vIFRocm93IGFuIElPRXhjZXB0aW9uIGJhY2sgdXAuIFRoaXMgd2lsbCBj\nYXVzZSB0aGUgQm9va2llCiAgICAgICAgICAgIC8vIGNvbnN0cnVjdG9yIHRv\nIGVycm9yIG91dC4gQWx0ZXJuYXRpdmVseSwgd2UgY291bGQgZG8gYSBTeXN0\nZW0KICAgICAgICAgICAgLy8gZXhpdCBoZXJlIGFzIHRoaXMgaXMgYSBmYXRh\nbCBlcnJvci4KICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGll\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIFRyYW5zaXRpb24g\ndGhlIGJvb2tpZSB0byByZWFkT25seSBtb2RlCiAgICAgKi8KICAgIEBWaXNp\nYmxlRm9yVGVzdGluZwogICAgcHVibGljIHZvaWQgdHJhbnNpdGlvblRvUmVh\nZE9ubHlNb2RlKCkgewogICAgICAgIGlmICghcmVhZE9ubHkuY29tcGFyZUFu\nZFNldChmYWxzZSwgdHJ1ZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICBpZiAoIWNvbmYuaXNSZWFkT25seU1vZGVFbmFibGVk\nKCkpIHsKICAgICAgICAgICAgTE9HLndhcm4oIlJlYWRPbmx5IG1vZGUgaXMg\nbm90IGVuYWJsZWQuICIKICAgICAgICAgICAgICAgICAgICArICJDYW4gYmUg\nZW5hYmxlZCBieSBjb25maWd1cmluZyAiCiAgICAgICAgICAgICAgICAgICAg\nKyAiJ3JlYWRPbmx5TW9kZUVuYWJsZWQ9dHJ1ZScgaW4gY29uZmlndXJhdGlv\nbi4iCiAgICAgICAgICAgICAgICAgICAgKyAiU2h1dHRpbmcgZG93biBib29r\naWUiKTsKICAgICAgICAgICAgdHJpZ2dlckJvb2tpZVNodXRkb3duKEV4aXRD\nb2RlLkJPT0tJRV9FWENFUFRJT04pOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQogICAgICAgIExPRy5pbmZvKCJUcmFuc2l0aW9uaW5nIEJvb2tp\nZSB0byBSZWFkT25seSBtb2RlLCIKICAgICAgICAgICAgICAgICsgIiBhbmQg\nd2lsbCBzZXJ2ZSBvbmx5IHJlYWQgcmVxdWVzdHMgZnJvbSBjbGllbnRzISIp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChudWxsID09IHprLmV4\naXN0cyh0aGlzLmJvb2tpZVJlZ2lzdHJhdGlvblBhdGgKICAgICAgICAgICAg\nICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFudHMuUkVBRE9OTFksIGZhbHNl\nKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICB6ay5jcmVhdGUodGhpcy5ib29raWVSZWdpc3RyYXRpb25QYXRoCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFudHMu\nUkVBRE9OTFksIG5ldyBieXRlWzBdLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgSWRzLk9QRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJTSVNU\nRU5UKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vZGVFeGlzdHNFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgbm9kZSBp\ncyBqdXN0IG5vdyBjcmVhdGVkIGJ5IHNvbWVvbmUuCiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBy\nZWFkb25seSBub2RlCiAgICAgICAgICAgIHprLmNyZWF0ZSh0aGlzLmJvb2tp\nZVJlZ2lzdHJhdGlvblBhdGgKICAgICAgICAgICAgICAgICAgICArIEJvb2tL\nZWVwZXJDb25zdGFudHMuUkVBRE9OTFkgKyAiLyIgKyBnZXRNeUlkKCksCiAg\nICAgICAgICAgICAgICAgICAgbmV3IGJ5dGVbMF0sIElkcy5PUEVOX0FDTF9V\nTlNBRkUsIENyZWF0ZU1vZGUuRVBIRU1FUkFMKTsKICAgICAgICAgICAgLy8g\nQ2xlYXIgdGhlIGN1cnJlbnQgcmVnaXN0ZXJlZCBub2RlCiAgICAgICAgICAg\nIHprLmRlbGV0ZSh6a0Jvb2tpZVJlZ1BhdGgsIC0xKTsKICAgICAgICB9IGNh\ndGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nRXJyb3IgaW4gdHJhbnNpdGlvbiB0byBSZWFkT25seSBNb2RlLiIKICAgICAg\nICAgICAgICAgICAgICArICIgU2h1dHRpbmcgZG93biIsIGUpOwogICAgICAg\nICAgICB0cmlnZ2VyQm9va2llU2h1dGRvd24oRXhpdENvZGUuQk9PS0lFX0VY\nQ0VQVElPTik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGNhdGNo\nIChLZWVwZXJFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIkVycm9yIGluIHRyYW5zaXRpb24gdG8gUmVhZE9ubHkgTW9kZS4iCiAgICAg\nICAgICAgICAgICAgICAgKyAiIFNodXR0aW5nIGRvd24iLCBlKTsKICAgICAg\nICAgICAgdHJpZ2dlckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9F\nWENFUFRJT04pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBjYXRj\naCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBUaHJl\nYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICBM\nT0cud2FybigiSW50ZXJydXB0ZWQgRXhjZXB0aW9uIHdoaWxlIHRyYW5zaXRp\nb25pbmcgdG8gUmVhZE9ubHkgTW9kZS4iKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKgogICAgICogQ2hlY2sgd2hldGhl\nciBCb29raWUgaXMgd3JpdGFibGUKICAgICAqLwogICAgcHVibGljIGJvb2xl\nYW4gaXNSZWFkT25seSgpIHsKICAgICAgICByZXR1cm4gcmVhZE9ubHkuZ2V0\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgem9va2Vl\ncGVyIGNsaWVudCB0byB6ayBjbHVzdGVyLgogICAgICoKICAgICAqIDxwPgog\nICAgICogQm9va2llIFNlcnZlciBqdXN0IHVzZWQgemsgY2xpZW50IHdoZW4g\nc3luY2luZyBsZWRnZXJzIGZvciBnYXJiYWdlIGNvbGxlY3Rpb24uCiAgICAg\nKiBTbyB3aGVuIHprIGNsaWVudCBpcyBleHBpcmVkLCBpdCBtZWFucyB0aGlz\nIGJvb2tpZSBzZXJ2ZXIgaXMgbm90IGF2YWlsYWJsZSBpbgogICAgICogYm9v\na2llIHNlcnZlciBsaXN0LiBUaGUgYm9va2llIGNsaWVudCB3aWxsIGJlIG5v\ndGlmaWVkIGZvciBpdHMgZXhwaXJhdGlvbi4gTm8KICAgICAqIG1vcmUgYm9v\na2llIHJlcXVlc3Qgd2lsbCBiZSBzZW50IHRvIHRoaXMgc2VydmVyLiBTbyBp\ndCdzIGJldHRlciB0byBleGl0IHdoZW4gemsKICAgICAqIGV4cGlyZWQuCiAg\nICAgKiA8L3A+CiAgICAgKiA8cD4KICAgICAqIFNpbmNlIHRoZXJlIGFyZSBs\nb3RzIG9mIGJrIG9wZXJhdGlvbnMgY2FjaGVkIGluIHF1ZXVlLCBzbyB3ZSB3\nYWl0IGZvciBhbGwgdGhlIG9wZXJhdGlvbnMKICAgICAqIGFyZSBwcm9jZXNz\nZWQgYW5kIHF1aXQuIEl0IGlzIGRvbmUgYnkgY2FsbGluZyA8Yj5zaHV0ZG93\nbjwvYj4uCiAgICAgKiA8L3A+CiAgICAgKgogICAgICogQHBhcmFtIHprU2Vy\ndmVycyB0aGUgcXVvcnVtIGxpc3Qgb2Ygemsgc2VydmVycwogICAgICogQHBh\ncmFtIHNlc3Npb25UaW1lb3V0IHNlc3Npb24gdGltZW91dCBvZiB6ayBjb25u\nZWN0aW9uCiAgICAgKgogICAgICogQHJldHVybiB6ayBjbGllbnQgaW5zdGFu\nY2UKICAgICAqLwogICAgcHJpdmF0ZSBab29LZWVwZXIgbmV3Wm9va2VlcGVy\nKGZpbmFsIFN0cmluZyB6a1NlcnZlcnMsCiAgICAgICAgICAgIGZpbmFsIGlu\ndCBzZXNzaW9uVGltZW91dCkgdGhyb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiwKICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIHsK\nICAgICAgICBab29LZWVwZXJXYXRjaGVyQmFzZSB3ID0gbmV3IFpvb0tlZXBl\ncldhdGNoZXJCYXNlKGNvbmYuZ2V0WmtUaW1lb3V0KCkpIHsKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3Mo\nV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAgICAvLyBDaGVj\nayBmb3IgZXhwaXJlZCBjb25uZWN0aW9uLgogICAgICAgICAgICAgICAgaWYg\nKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2VlcGVy\nU3RhdGUuRXhwaXJlZCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIlpLIGNsaWVudCBjb25uZWN0aW9uIHRvIHRoZSBaSyBzZXJ2ZXIgaGFz\nIGV4cGlyZWQhIik7CiAgICAgICAgICAgICAgICAgICAgc2h1dGRvd24oRXhp\ndENvZGUuWktfRVhQSVJFRCk7CiAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIHN1cGVyLnByb2Nlc3MoZXZlbnQpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAg\nICByZXR1cm4gWmtVdGlscy5jcmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGll\nbnQoemtTZXJ2ZXJzLCB3KTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBp\nc1J1bm5pbmcoKSB7CiAgICAgICAgcmV0dXJuIHJ1bm5pbmc7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAg\nLy8gYm9va2llIHRocmVhZCB3YWl0IGZvciBqb3VybmFsIHRocmVhZAogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHN0YXJ0IGpvdXJuYWwKICAgICAg\nICAgICAgam91cm5hbC5zdGFydCgpOwogICAgICAgICAgICAvLyB3YWl0IHVu\ndGlsIGpvdXJuYWwgcXVpdHMKICAgICAgICAgICAgam91cm5hbC5qb2luKCk7\nCiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsK\nICAgICAgICB9CiAgICAgICAgLy8gaWYgdGhlIGpvdXJuYWwgdGhyZWFkIHF1\naXRzIGR1ZSB0byBzaHV0dGluZyBkb3duLCBpdCBpcyBvawogICAgICAgIGlm\nICghc2h1dHRpbmdkb3duKSB7CiAgICAgICAgICAgIC8vIHNvbWUgZXJyb3Ig\nZm91bmQgaW4gam91cm5hbCB0aHJlYWQgYW5kIGl0IHF1aXRzCiAgICAgICAg\nICAgIC8vIGZvbGxvd2luZyBhZGQgb3BlcmF0aW9ucyB0byBpdCB3b3VsZCBo\nYW5nIHVuaXQgY2xpZW50IHRpbWVvdXQKICAgICAgICAgICAgLy8gc28gd2Ug\nc2hvdWxkIGxldCBib29raWUgc2VydmVyIGV4aXN0cwogICAgICAgICAgICBM\nT0cuZXJyb3IoIkpvdXJuYWwgbWFuYWdlciBxdWl0cyB1bmV4cGVjdGVkbHku\nIik7CiAgICAgICAgICAgIHRyaWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29k\nZS5CT09LSUVfRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLy8g\nVHJpZ2dlcmluZyB0aGUgQm9va2llIHNodXRkb3duIGluIGl0cyBvd24gdGhy\nZWFkLAogICAgLy8gYmVjYXVzZSBzaHV0ZG93biBjYW4gYmUgY2FsbGVkIGZy\nb20gc3luYyB0aHJlYWQgd2hpY2ggd291bGQgYmUKICAgIC8vIGludGVycnVw\ndGVkIGJ5IHNodXRkb3duIGNhbGwuCiAgICB2b2lkIHRyaWdnZXJCb29raWVT\naHV0ZG93bihmaW5hbCBpbnQgZXhpdENvZGUpIHsKICAgICAgICBUaHJlYWQg\nc2h1dGRvd25UaHJlYWQgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBCb29raWUudGhp\ncy5zaHV0ZG93bihleGl0Q29kZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nOwogICAgICAgIHNodXRkb3duVGhyZWFkLnN0YXJ0KCk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgc2h1dGRvd25UaHJlYWQuam9pbigpOwogICAgICAg\nIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAg\nICAgICAgTE9HLmRlYnVnKCJJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB3aGlsZSB3\nYWl0aW5nIGZvciBzaHV0ZG93bi4gTm90IGEgcHJvYmxlbSEhIik7CiAgICAg\nICAgfQogICAgfQoKICAgIC8vIHByb3ZpZGVkIGEgcHVibGljIHNodXRkb3du\nIG1ldGhvZCBmb3Igb3RoZXIgY2FsbGVyCiAgICAvLyB0byBzaHV0IGRvd24g\nYm9va2llIGdyYWNlZnVsbHkKICAgIHB1YmxpYyBpbnQgc2h1dGRvd24oKSB7\nCiAgICAgICAgcmV0dXJuIHNodXRkb3duKEV4aXRDb2RlLk9LKTsKICAgIH0K\nCiAgICAvLyBpbnRlcm5hbCBzaHV0ZG93biBtZXRob2QgdG8gbGV0IHNodXRk\nb3duIGJvb2tpZSBncmFjZWZ1bGx5CiAgICAvLyB3aGVuIGVuY291bnRlcmlu\nZyBleGNlcHRpb24KICAgIHN5bmNocm9uaXplZCBpbnQgc2h1dGRvd24oaW50\nIGV4aXRDb2RlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJ1\nbm5pbmcpIHsgLy8gYXZvaWQgc2h1dGRvd24gdHdpY2UKICAgICAgICAgICAg\nICAgIC8vIHRoZSBleGl0Q29kZSBvbmx5IHNldCB3aGVuIGZpcnN0IHNodXRk\nb3duIHVzdWFsbHkgZHVlIHRvIGV4Y2VwdGlvbiBmb3VuZAogICAgICAgICAg\nICAgICAgdGhpcy5leGl0Q29kZSA9IGV4aXRDb2RlOwogICAgICAgICAgICAg\nICAgLy8gbWFyayBib29raWUgYXMgaW4gc2h1dHRpbmcgZG93biBwcm9ncmVz\ncwogICAgICAgICAgICAgICAgc2h1dHRpbmdkb3duID0gdHJ1ZTsKCiAgICAg\nICAgICAgICAgICAvLyBTaHV0ZG93biB0aGUgWksgY2xpZW50CiAgICAgICAg\nICAgICAgICBpZih6ayAhPSBudWxsKSB6ay5jbG9zZSgpOwoKICAgICAgICAg\nICAgICAgIC8vU2h1dGRvd24gZGlzayBjaGVja2VyCiAgICAgICAgICAgICAg\nICBsZWRnZXJEaXJzTWFuYWdlci5zaHV0ZG93bigpOwoKICAgICAgICAgICAg\nICAgIC8vIFNodXRkb3duIGpvdXJuYWwKICAgICAgICAgICAgICAgIGpvdXJu\nYWwuc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgIHRoaXMuam9pbigpOwog\nICAgICAgICAgICAgICAgc3luY1RocmVhZC5zaHV0ZG93bigpOwoKICAgICAg\nICAgICAgICAgIC8vIFNodXRkb3duIHRoZSBFbnRyeUxvZ2dlciB3aGljaCBo\nYXMgdGhlIEdhcmJhZ2VDb2xsZWN0b3IgVGhyZWFkIHJ1bm5pbmcKICAgICAg\nICAgICAgICAgIGxlZGdlclN0b3JhZ2Uuc2h1dGRvd24oKTsKCiAgICAgICAg\nICAgICAgICAvLyBjbG9zZSBMZWRnZXIgTWFuYWdlcgogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJNYW5hZ2VyLmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgbGVkZ2VyTWFuYWdlckZhY3Rv\ncnkudW5pbml0aWFsaXplKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nT0V4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiRmFpbGVkIHRvIGNsb3NlIGFjdGl2ZSBsZWRnZXIgbWFuYWdlciA6ICIs\nIGllKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHNl\ndHRpbmcgcnVubmluZyB0byBmYWxzZSBoZXJlLCBzbyB3YXRjaCB0aHJlYWQg\naW4gYm9va2llIHNlcnZlciBrbm93IGl0IG9ubHkgYWZ0ZXIgYm9va2llIHNo\ndXQgZG93bgogICAgICAgICAgICAgICAgcnVubmluZyA9IGZhbHNlOwogICAg\nICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRp\nb24gaWUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJbnRlcnJ1cHRlZCBk\ndXJpbmcgc2h1dHRpbmcgZG93biBib29raWUgOiAiLCBpZSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0aGlzLmV4aXRDb2RlOwogICAgfQoKICAgIC8q\nKiAKICAgICAqIFJldHJpZXZlIHRoZSBsZWRnZXIgZGVzY3JpcHRvciBmb3Ig\ndGhlIGxlZGdlciB3aGljaCBlbnRyeSBzaG91bGQgYmUgYWRkZWQgdG8uCiAg\nICAgKiBUaGUgTGVkZ2VyRGVzY3JpcHRvciByZXR1cm5lZCBmcm9tIHRoaXMg\nbWV0aG9kIHNob3VsZCBiZSBldmVudHVhbGx5IGZyZWVkIHdpdGggCiAgICAg\nKiAjcHV0SGFuZGxlKCkuCiAgICAgKgogICAgICogQHRocm93cyBCb29raWVF\neGNlcHRpb24gaWYgbWFzdGVyS2V5IGRvZXMgbm90IG1hdGNoIHRoZSBtYXN0\nZXIga2V5IG9mIHRoZSBsZWRnZXIKICAgICAqLwogICAgcHJpdmF0ZSBMZWRn\nZXJEZXNjcmlwdG9yIGdldExlZGdlckZvckVudHJ5KEJ5dGVCdWZmZXIgZW50\ncnksIGJ5dGVbXSBtYXN0ZXJLZXkpIAogICAgICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBsZWRn\nZXJJZCA9IGVudHJ5LmdldExvbmcoKTsKICAgICAgICBMZWRnZXJEZXNjcmlw\ndG9yIGwgPSBoYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJZCwgbWFzdGVyS2V5\nKTsKICAgICAgICBpZiAoIW1hc3RlcktleUNhY2hlLmNvbnRhaW5zS2V5KGxl\nZGdlcklkKSkgewogICAgICAgICAgICAvLyBuZXcgaGFuZGxlLCB3ZSBzaG91\nbGQgYWRkIHRoZSBrZXkgdG8gam91cm5hbCBlbnN1cmUgd2UgY2FuIHJlYnVp\nbGQKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoOCArIDggKyA0ICsgbWFzdGVyS2V5Lmxlbmd0aCk7CiAgICAgICAg\nICAgIGJiLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgICAgICBiYi5wdXRM\nb25nKE1FVEFFTlRSWV9JRF9MRURHRVJfS0VZKTsKICAgICAgICAgICAgYmIu\ncHV0SW50KG1hc3RlcktleS5sZW5ndGgpOwogICAgICAgICAgICBiYi5wdXQo\nbWFzdGVyS2V5KTsKICAgICAgICAgICAgYmIuZmxpcCgpOwoKICAgICAgICAg\nICAgam91cm5hbC5sb2dBZGRFbnRyeShiYiwgbmV3IE5vcFdyaXRlQ2FsbGJh\nY2soKSwgbnVsbCk7CiAgICAgICAgICAgIG1hc3RlcktleUNhY2hlLnB1dChs\nZWRnZXJJZCwgbWFzdGVyS2V5KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGw7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYWRkRW50cnlCeUxlZGdl\ncklkKGxvbmcgbGVkZ2VySWQsIEJ5dGVCdWZmZXIgZW50cnkpCiAgICAgICAg\ndGhyb3dzIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAg\nIGJ5dGVbXSBrZXkgPSBsZWRnZXJTdG9yYWdlLnJlYWRNYXN0ZXJLZXkobGVk\nZ2VySWQpOwogICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gaGFu\nZGxlcy5nZXRIYW5kbGUobGVkZ2VySWQsIGtleSk7CiAgICAgICAgaGFuZGxl\nLmFkZEVudHJ5KGVudHJ5KTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBh\nbiBlbnRyeSB0byBhIGxlZGdlciBhcyBzcGVjaWZpZWQgYnkgaGFuZGxlLiAK\nICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGFkZEVudHJ5SW50ZXJuYWwoTGVk\nZ2VyRGVzY3JpcHRvciBoYW5kbGUsIEJ5dGVCdWZmZXIgZW50cnksIFdyaXRl\nQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgpCiAgICAgICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGxl\nZGdlcklkID0gaGFuZGxlLmdldExlZGdlcklkKCk7CiAgICAgICAgZW50cnku\ncmV3aW5kKCk7CiAgICAgICAgbG9uZyBlbnRyeUlkID0gaGFuZGxlLmFkZEVu\ndHJ5KGVudHJ5KTsKCiAgICAgICAgZW50cnkucmV3aW5kKCk7CiAgICAgICAg\nTE9HLnRyYWNlKCJBZGRpbmcge31Ae30iLCBlbnRyeUlkLCBsZWRnZXJJZCk7\nCiAgICAgICAgam91cm5hbC5sb2dBZGRFbnRyeShlbnRyeSwgY2IsIGN0eCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgZW50cnkgdG8gYSBsZWRnZXIs\nIGV2ZW4gaWYgdGhlIGxlZGdlciBoYXMgcHJldmlvdXMgYmVlbiBmZW5jZWQu\nIFRoaXMgc2hvdWxkIG9ubHkKICAgICAqIGhhcHBlbiBpbiBib29raWUgcmVj\nb3Zlcnkgb3IgbGVkZ2VyIHJlY292ZXJ5IGNhc2VzLCB3aGVyZSBlbnRyaWVz\nIGFyZSBiZWluZyByZXBsaWNhdGVzIAogICAgICogc28gdGhhdCB0aGV5IGV4\naXN0IG9uIGEgcXVvcnVtIG9mIGJvb2tpZXMuIFRoZSBjb3JyZXNwb25kaW5n\nIGNsaWVudCBzaWRlIGNhbGwgZm9yIHRoaXMKICAgICAqIGlzIG5vdCBleHBv\nc2VkIHRvIHVzZXJzLgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWNvdmVy\neUFkZEVudHJ5KEJ5dGVCdWZmZXIgZW50cnksIFdyaXRlQ2FsbGJhY2sgY2Is\nIE9iamVjdCBjdHgsIGJ5dGVbXSBtYXN0ZXJLZXkpIAogICAgICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUgPSBn\nZXRMZWRnZXJGb3JFbnRyeShlbnRyeSwgbWFzdGVyS2V5KTsKICAgICAgICAg\nICAgc3luY2hyb25pemVkIChoYW5kbGUpIHsKICAgICAgICAgICAgICAgIGFk\nZEVudHJ5SW50ZXJuYWwoaGFuZGxlLCBlbnRyeSwgY2IsIGN0eCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGNhdGNoIChOb1dyaXRhYmxlTGVkZ2VyRGly\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdHJhbnNpdGlvblRvUmVhZE9u\nbHlNb2RlKCk7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbihl\nKTsKICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKiAKICAgICAqIEFkZCBl\nbnRyeSB0byBhIGxlZGdlci4KICAgICAqIEB0aHJvd3MgQm9va2llRXhjZXB0\naW9uLkxlZGdlckZlbmNlZEV4Y2VwdGlvbiBpZiB0aGUgbGVkZ2VyIGlzIGZl\nbmNlZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRFbnRyeShCeXRlQnVm\nZmVyIGVudHJ5LCBXcml0ZUNhbGxiYWNrIGNiLCBPYmplY3QgY3R4LCBieXRl\nW10gbWFzdGVyS2V5KQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24s\nIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUgPSBnZXRMZWRnZXJGb3JFbnRyeShl\nbnRyeSwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgc3luY2hyb25pemVkICho\nYW5kbGUpIHsKICAgICAgICAgICAgICAgIGlmIChoYW5kbGUuaXNGZW5jZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IEJvb2tpZUV4Y2VwdGlv\nbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNyZWF0ZShCb29raWVF\neGNlcHRpb24uQ29kZS5MZWRnZXJGZW5jZWRFeGNlcHRpb24pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgYWRkRW50cnlJbnRlcm5hbCho\nYW5kbGUsIGVudHJ5LCBjYiwgY3R4KTsKICAgICAgICAgICAgfQogICAgICAg\nIH0gY2F0Y2ggKE5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICB0cmFuc2l0aW9uVG9SZWFkT25seU1vZGUoKTsKICAgICAg\nICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEZlbmNlcyBhIGxlZGdlci4gRnJvbSB0aGlz\nIHBvaW50IG9uLCBjbGllbnRzIHdpbGwgYmUgdW5hYmxlIHRvCiAgICAgKiB3\ncml0ZSB0byB0aGlzIGxlZGdlci4gT25seSByZWNvdmVyeUFkZEVudHJ5IHdp\nbGwgYmUKICAgICAqIGFibGUgdG8gYWRkIGVudHJpZXMgdG8gdGhlIGxlZGdl\nci4KICAgICAqIFRoaXMgbWV0aG9kIGlzIGlkZW1wb3RlbnQuIE9uY2UgYSBs\nZWRnZXIgaXMgZmVuY2VkLCBpdCBjYW4KICAgICAqIG5ldmVyIGJlIHVuZmVu\nY2VkLiBGZW5jaW5nIGEgZmVuY2VkIGxlZGdlciBoYXMgbm8gZWZmZWN0Lgog\nICAgICovCiAgICBwdWJsaWMgRnV0dXJlPEJvb2xlYW4+IGZlbmNlTGVkZ2Vy\nKGxvbmcgbGVkZ2VySWQsIGJ5dGVbXSBtYXN0ZXJLZXkpIHRocm93cyBJT0V4\nY2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJEZXNj\ncmlwdG9yIGhhbmRsZSA9IGhhbmRsZXMuZ2V0SGFuZGxlKGxlZGdlcklkLCBt\nYXN0ZXJLZXkpOwogICAgICAgIGJvb2xlYW4gc3VjY2VzczsKICAgICAgICBz\neW5jaHJvbml6ZWQgKGhhbmRsZSkgewogICAgICAgICAgICBzdWNjZXNzID0g\naGFuZGxlLnNldEZlbmNlZCgpOwogICAgICAgIH0KICAgICAgICBpZiAoc3Vj\nY2VzcykgewogICAgICAgICAgICAvLyBmZW5jZWQgZmlyc3QgdGltZSwgd2Ug\nc2hvdWxkIGFkZCB0aGUga2V5IHRvIGpvdXJuYWwgZW5zdXJlIHdlIGNhbiBy\nZWJ1aWxkCiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVy\nLmFsbG9jYXRlKDggKyA4KTsKICAgICAgICAgICAgYmIucHV0TG9uZyhsZWRn\nZXJJZCk7CiAgICAgICAgICAgIGJiLnB1dExvbmcoTUVUQUVOVFJZX0lEX0ZF\nTkNFX0tFWSk7CiAgICAgICAgICAgIGJiLmZsaXAoKTsKCiAgICAgICAgICAg\nIEZ1dHVyZVdyaXRlQ2FsbGJhY2sgZndjID0gbmV3IEZ1dHVyZVdyaXRlQ2Fs\nbGJhY2soKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJyZWNvcmQgZmVuY2Vk\nIHN0YXRlIGZvciBsZWRnZXIge30gaW4gam91cm5hbC4iLCBsZWRnZXJJZCk7\nCiAgICAgICAgICAgIGpvdXJuYWwubG9nQWRkRW50cnkoYmIsIGZ3YywgbnVs\nbCk7CiAgICAgICAgICAgIHJldHVybiBmd2MuZ2V0UmVzdWx0KCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8gYWxyZWFkeSBmZW5jZWQKICAg\nICAgICAgICAgcmV0dXJuIFNVQ0NFU1NfRlVUVVJFOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgQnl0ZUJ1ZmZlciByZWFkRW50cnkobG9uZyBsZWRn\nZXJJZCwgbG9uZyBlbnRyeUlkKQogICAgICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24sIE5vTGVkZ2VyRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJEZXNj\ncmlwdG9yIGhhbmRsZSA9IGhhbmRsZXMuZ2V0UmVhZE9ubHlIYW5kbGUobGVk\nZ2VySWQpOwogICAgICAgIExPRy50cmFjZSgiUmVhZGluZyB7fUB7fSIsIGVu\ndHJ5SWQsIGxlZGdlcklkKTsKICAgICAgICByZXR1cm4gaGFuZGxlLnJlYWRF\nbnRyeShlbnRyeUlkKTsKICAgIH0KCiAgICAvLyBUaGUgcmVzdCBvZiB0aGUg\nY29kZSBpcyB0ZXN0IHN0dWZmCiAgICBzdGF0aWMgY2xhc3MgQ291bnRlckNh\nbGxiYWNrIGltcGxlbWVudHMgV3JpdGVDYWxsYmFjayB7CiAgICAgICAgaW50\nIGNvdW50OwoKICAgICAgICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQgd3Jp\ndGVDb21wbGV0ZShpbnQgcmMsIGxvbmcgbCwgbG9uZyBlLCBJbmV0U29ja2V0\nQWRkcmVzcyBhZGRyLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIGNvdW50\nLS07CiAgICAgICAgICAgIGlmIChjb3VudCA9PSAwKSB7CiAgICAgICAgICAg\nICAgICBub3RpZnlBbGwoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIGluY0NvdW50KCkgewog\nICAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KCiAgICAgICAgc3luY2hy\nb25pemVkIHB1YmxpYyB2b2lkIHdhaXRaZXJvKCkgdGhyb3dzIEludGVycnVw\ndGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgd2hpbGUgKGNvdW50ID4gMCkg\newogICAgICAgICAgICAgICAgd2FpdCgpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogRm9ybWF0IHRoZSBib29raWUg\nc2VydmVyIGRhdGEKICAgICAqIAogICAgICogQHBhcmFtIGNvbmYKICAgICAq\nICAgICAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbgogICAgICogQHBhcmFt\nIGlzSW50ZXJhY3RpdmUKICAgICAqICAgICAgICAgICAgV2hldGhlciBmb3Jt\nYXQgc2hvdWxkIGFzayBwcm9tcHQgZm9yIGNvbmZpcm1hdGlvbiBpZiBvbGQg\nZGF0YQogICAgICogICAgICAgICAgICBleGlzdHMgb3Igbm90LgogICAgICog\nQHBhcmFtIGZvcmNlCiAgICAgKiAgICAgICAgICAgIElmIG5vbiBpbnRlcmFj\ndGl2ZSBhbmQgZm9yY2UgaXMgdHJ1ZSwgdGhlbiBvbGQgZGF0YSB3aWxsIGJl\nCiAgICAgKiAgICAgICAgICAgIHJlbW92ZWQgd2l0aG91dCBjb25maXJtIHBy\nb21wdC4KICAgICAqIEByZXR1cm4gUmV0dXJucyB0cnVlIGlmIHRoZSBmb3Jt\nYXQgaXMgc3VjY2VzcyBlbHNlIHJldHVybnMgZmFsc2UKICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBib29sZWFuIGZvcm1hdChTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYsCiAgICAgICAgICAgIGJvb2xlYW4gaXNJbnRlcmFjdGl2ZSwg\nYm9vbGVhbiBmb3JjZSkgewogICAgICAgIEZpbGUgam91cm5hbERpciA9IGNv\nbmYuZ2V0Sm91cm5hbERpcigpOwogICAgICAgIGlmIChqb3VybmFsRGlyLmV4\naXN0cygpICYmIGpvdXJuYWxEaXIuaXNEaXJlY3RvcnkoKQogICAgICAgICAg\nICAgICAgJiYgam91cm5hbERpci5saXN0KCkubGVuZ3RoICE9IDApIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGJvb2xlYW4gY29uZmly\nbSA9IGZhbHNlOwogICAgICAgICAgICAgICAgaWYgKCFpc0ludGVyYWN0aXZl\nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gSWYgbm9uIGludGVyYWN0aXZl\nIGFuZCBmb3JjZSBpcyBzZXQsIHRoZW4gZGVsZXRlIG9sZAogICAgICAgICAg\nICAgICAgICAgIC8vIGRhdGEuCiAgICAgICAgICAgICAgICAgICAgaWYgKGZv\ncmNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm0gPSB0cnVl\nOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbmZpcm0gPSBmYWxzZTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIGNvbmZpcm0gPSBJT1V0aWxzCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAuY29uZmlybVByb21wdCgiQXJlIHlvdSBzdXJlIHRvIGZvcm1hdCBC\nb29raWUgZGF0YS4uPyIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIGlmICghY29uZmlybSkgewogICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiQm9va2llIGZvcm1hdCBhYm9ydGVkISEiKTsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRXJyb3IgZHVyaW5nIGJvb2tpZSBmb3JtYXQi\nLCBlKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIWNsZWFuRGlyKGpvdXJuYWxE\naXIpKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRm9ybWF0dGluZyBqb3Vy\nbmFsIGRpcmVjdG9yeSBmYWlsZWQiKTsKICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIH0KCiAgICAgICAgRmlsZVtdIGxlZGdlckRpcnMgPSBj\nb25mLmdldExlZGdlckRpcnMoKTsKICAgICAgICBmb3IgKEZpbGUgZGlyIDog\nbGVkZ2VyRGlycykgewogICAgICAgICAgICBpZiAoIWNsZWFuRGlyKGRpcikp\nIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRm9ybWF0dGluZyBsZWRn\nZXIgZGlyZWN0b3J5ICIgKyBkaXIgKyAiIGZhaWxlZCIpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIExPRy5pbmZvKCJCb29raWUgZm9ybWF0IGNvbXBsZXRlZCBzdWNj\nZXNzZnVsbHkiKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBw\ncml2YXRlIHN0YXRpYyBib29sZWFuIGNsZWFuRGlyKEZpbGUgZGlyKSB7CiAg\nICAgICAgaWYgKGRpci5leGlzdHMoKSkgewogICAgICAgICAgICBmb3IgKEZp\nbGUgY2hpbGQgOiBkaXIubGlzdEZpbGVzKCkpIHsKICAgICAgICAgICAgICAg\nIGJvb2xlYW4gZGVsZXRlID0gRmlsZVV0aWxzLmRlbGV0ZVF1aWV0bHkoY2hp\nbGQpOwogICAgICAgICAgICAgICAgaWYgKCFkZWxldGUpIHsKICAgICAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIk5vdCBhYmxlIHRvIGRlbGV0ZSAiICsg\nY2hpbGQpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBp\nZiAoIWRpci5ta2RpcnMoKSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIk5v\ndCBhYmxlIHRvIGNyZWF0ZSB0aGUgZGlyZWN0b3J5ICIgKyBkaXIpOwogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiB0cnVlOwogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQm9va2llU2FmZUVu\ndHJ5QWRkZXIgaW1wbGVtZW50cyBTYWZlRW50cnlBZGRlciB7CiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgc2FmZUFkZEVudHJ5KGZp\nbmFsIGxvbmcgbGVkZ2VySWQsIGZpbmFsIEJ5dGVCdWZmZXIgYnVmZmVyLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBHZW5lcmlj\nQ2FsbGJhY2s8Vm9pZD4gY2IpIHsKICAgICAgICAgICAgam91cm5hbC5sb2dB\nZGRFbnRyeShidWZmZXIsIG5ldyBXcml0ZUNhbGxiYWNrKCkgewogICAgICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHdyaXRlQ29tcGxldGUoaW50IHJjLCBsb25nIGxlZGdlcklk\nMiwgbG9uZyBlbnRyeUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgT2Jq\nZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0g\nQm9va2llRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgcmV3cml0aW5nIHRvIGpvdXJu\nYWwgKGxlZGdlciB7fSwgZW50cnkge30pIiwgbGVkZ2VySWQyLCBlbnRyeUlk\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNv\nbXBsZXRlKHJjLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYWRkRW50cnlCeUxlZGdlcklkKGxlZGdlcklkLCBidWZmZXIpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUo\ncmMsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRXJyb3IgYWRkaW5nIHRvIGxlZGdlciBzdG9yYWdlIChs\nZWRnZXIgIiArIGxlZGdlcklkMgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgIiwgZW50cnkgIiArIGVudHJ5SWQgKyAiKSIsIGlv\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjb3VsZG4ndCBh\nZGQgdG8gbGVkZ2VyIHN0b3JhZ2UKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKEJvb2tpZUV4Y2VwdGlvbi5Db2Rl\nLklsbGVnYWxPcEV4Y2VwdGlvbiwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbiBia2UpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQm9va2llIGVycm9y\nIGFkZGluZyB0byBsZWRnZXIgc3RvcmFnZSAobGVkZ2VyICIgKyBsZWRnZXJJ\nZDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIs\nIGVudHJ5ICIgKyBlbnRyeUlkICsgIikiLCBia2UpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gY291bGRuJ3QgYWRkIHRvIGxlZGdlciBzdG9y\nYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25D\nb21wbGV0ZShia2UuZ2V0Q29kZSgpLCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0sIG51bGwpOwogICAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICog\nQHBhcmFtIGFyZ3MKICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAq\nIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqLwogICAgcHVi\nbGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgCiAgICAgICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24s\nIEJvb2tpZUV4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uIHsKICAgICAgICBC\nb29raWUgYiA9IG5ldyBCb29raWUobmV3IFNlcnZlckNvbmZpZ3VyYXRpb24o\nKSk7CiAgICAgICAgYi5zdGFydCgpOwogICAgICAgIENvdW50ZXJDYWxsYmFj\nayBjYiA9IG5ldyBDb3VudGVyQ2FsbGJhY2soKTsKICAgICAgICBsb25nIHN0\nYXJ0ID0gTWF0aFV0aWxzLm5vdygpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgMTAwMDAwOyBpKyspIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBi\ndWZmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgxMDI0KTsKICAgICAgICAgICAg\nYnVmZi5wdXRMb25nKDEpOwogICAgICAgICAgICBidWZmLnB1dExvbmcoaSk7\nCiAgICAgICAgICAgIGJ1ZmYubGltaXQoMTAyNCk7CiAgICAgICAgICAgIGJ1\nZmYucG9zaXRpb24oMCk7CiAgICAgICAgICAgIGNiLmluY0NvdW50KCk7CiAg\nICAgICAgICAgIGIuYWRkRW50cnkoYnVmZiwgY2IsIG51bGwsIG5ldyBieXRl\nWzBdKTsKICAgICAgICB9CiAgICAgICAgY2Iud2FpdFplcm8oKTsKICAgICAg\nICBsb25nIGVuZCA9IE1hdGhVdGlscy5ub3coKTsKICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oIlRvb2sgIiArIChlbmQtc3RhcnQpICsgIm1zIik7CiAg\nICB9Cn0K\n","encoding":"base64"}

