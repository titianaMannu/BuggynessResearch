{"sha":"9f1b52a4bafd59610231b3da6de730d9c8b02279","node_id":"MDQ6QmxvYjE1NzU5NTY6OWYxYjUyYTRiYWZkNTk2MTAyMzFiM2RhNmRlNzMwZDljOGIwMjI3OQ==","size":20042,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9f1b52a4bafd59610231b3da6de730d9c8b02279","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8u\nQnVmZmVyZWRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBq\nYXZhLmlvLkZpbGVGaWx0ZXI7CmltcG9ydCBqYXZhLmlvLkZpbGVJbnB1dFN0\ncmVhbTsKaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS5pby5GaWxlT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5p\nby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW1SZWFk\nZXI7CmltcG9ydCBqYXZhLmlvLk91dHB1dFN0cmVhbVdyaXRlcjsKaW1wb3J0\nIGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGphdmEubmlvLkJ5\ndGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxlQ2hhbm5l\nbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5NYXAuRW50cnk7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5Db25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNCb29sZWFuOwoKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkxlZGdlckRpcnNN\nYW5hZ2VyLkxlZGdlckRpcnNMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5JT1V0aWxzOwoKLyoqCiAqIFRo\naXMgY2xhc3MgbWFuYWdlcyB0aGUgd3JpdGluZyBvZiB0aGUgYm9va2tlZXBl\nciBlbnRyaWVzLiBBbGwgdGhlIG5ldwogKiBlbnRyaWVzIGFyZSB3cml0dGVu\nIHRvIGEgY29tbW9uIGxvZy4gVGhlIExlZGdlckNhY2hlIHdpbGwgaGF2ZSBw\nb2ludGVycwogKiBpbnRvIGZpbGVzIGNyZWF0ZWQgYnkgdGhpcyBjbGFzcyB3\naXRoIG9mZnNldHMgaW50byB0aGUgZmlsZXMgdG8gZmluZAogKiB0aGUgYWN0\ndWFsIGxlZGdlciBlbnRyeS4gVGhlIGVudHJ5IGxvZyBmaWxlcyBjcmVhdGVk\nIGJ5IHRoaXMgY2xhc3MgYXJlCiAqIGlkZW50aWZpZWQgYnkgYSBsb25nLgog\nKi8KcHVibGljIGNsYXNzIEVudHJ5TG9nZ2VyIHsKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihFbnRyeUxvZ2dlci5jbGFzcyk7CgogICAgdm9sYXRpbGUgRmlsZSBjdXJy\nZW50RGlyOwogICAgcHJpdmF0ZSBMZWRnZXJEaXJzTWFuYWdlciBsZWRnZXJE\naXJzTWFuYWdlcjsKICAgIHByaXZhdGUgQXRvbWljQm9vbGVhbiBzaG91bGRD\ncmVhdGVOZXdFbnRyeUxvZyA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsK\nCiAgICBwcml2YXRlIGxvbmcgbG9nSWQ7CgogICAgLyoqCiAgICAgKiBUaGUg\nbWF4aW11bSBzaXplIG9mIGEgZW50cnkgbG9nZ2VyIGZpbGUuCiAgICAgKi8K\nICAgIGZpbmFsIGxvbmcgbG9nU2l6ZUxpbWl0OwogICAgcHJpdmF0ZSB2b2xh\ndGlsZSBCdWZmZXJlZENoYW5uZWwgbG9nQ2hhbm5lbDsKICAgIC8qKgogICAg\nICogVGhlIDFLIGJsb2NrIGF0IHRoZSBoZWFkIG9mIHRoZSBlbnRyeSBsb2dn\nZXIgZmlsZQogICAgICogdGhhdCBjb250YWlucyB0aGUgZmluZ2VycHJpbnQg\nYW5kIChmdXR1cmUpIG1ldGEtZGF0YQogICAgICovCiAgICBmaW5hbCBzdGF0\naWMgaW50IExPR0ZJTEVfSEVBREVSX1NJWkUgPSAxMDI0OwogICAgZmluYWwg\nQnl0ZUJ1ZmZlciBMT0dGSUxFX0hFQURFUiA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGUoTE9HRklMRV9IRUFERVJfU0laRSk7CgogICAgZmluYWwgc3RhdGljIGlu\ndCBNSU5fU0FORV9FTlRSWV9TSVpFID0gOCArIDg7CiAgICBmaW5hbCBzdGF0\naWMgbG9uZyBNQiA9IDEwMjQgKiAxMDI0OwoKICAgIC8qKgogICAgICogU2Nh\nbiBlbnRyaWVzIGluIGEgZW50cnkgbG9nIGZpbGUuCiAgICAgKi8KICAgIHN0\nYXRpYyBpbnRlcmZhY2UgRW50cnlMb2dTY2FubmVyIHsKICAgICAgICAvKioK\nICAgICAgICAgKiBUZXN0cyB3aGV0aGVyIG9yIG5vdCB0aGUgZW50cmllcyBi\nZWxvbmdzIHRvIHRoZSBzcGVjaWZpZWQgbGVkZ2VyCiAgICAgICAgICogc2hv\ndWxkIGJlIHByb2Nlc3NlZC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJh\nbSBsZWRnZXJJZAogICAgICAgICAqICAgICAgICAgIExlZGdlciBJRC4KICAg\nICAgICAgKiBAcmV0dXJuIHRydWUgaWYgYW5kIG9ubHkgdGhlIGVudHJpZXMg\nb2YgdGhlIGxlZGdlciBzaG91bGQgYmUgc2Nhbm5lZC4KICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBhY2NlcHQobG9uZyBsZWRnZXJJZCk7\nCgogICAgICAgIC8qKgogICAgICAgICAqIFByb2Nlc3MgYW4gZW50cnkuCiAg\nICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAgICAg\nKiAgICAgICAgICBMZWRnZXIgSUQuCiAgICAgICAgICogQHBhcmFtIG9mZnNl\ndAogICAgICAgICAqICAgICAgICAgIEZpbGUgb2Zmc2V0IG9mIHRoaXMgZW50\ncnkuCiAgICAgICAgICogQHBhcmFtIGVudHJ5CiAgICAgICAgICogICAgICAg\nICAgRW50cnkgQnl0ZUJ1ZmZlcgogICAgICAgICAqIEB0aHJvd3MgSU9FeGNl\ncHRpb24KICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNz\nKGxvbmcgbGVkZ2VySWQsIGxvbmcgb2Zmc2V0LCBCeXRlQnVmZmVyIGVudHJ5\nKSB0aHJvd3MgSU9FeGNlcHRpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBD\ncmVhdGUgYW4gRW50cnlMb2dnZXIgdGhhdCBzdG9yZXMgaXQncyBsb2cgZmls\nZXMgaW4gdGhlIGdpdmVuCiAgICAgKiBkaXJlY3RvcmllcwogICAgICovCiAg\nICBwdWJsaWMgRW50cnlMb2dnZXIoU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nLAogICAgICAgICAgICBMZWRnZXJEaXJzTWFuYWdlciBsZWRnZXJEaXJzTWFu\nYWdlcikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0aGlzLmxlZGdl\nckRpcnNNYW5hZ2VyID0gbGVkZ2VyRGlyc01hbmFnZXI7CiAgICAgICAgLy8g\nbG9nIHNpemUgbGltaXQKICAgICAgICB0aGlzLmxvZ1NpemVMaW1pdCA9IGNv\nbmYuZ2V0RW50cnlMb2dTaXplTGltaXQoKTsKCiAgICAgICAgLy8gSW5pdGlh\nbGl6ZSB0aGUgZW50cnkgbG9nIGhlYWRlciBidWZmZXIuIFRoaXMgY2Fubm90\nIGJlIGEgc3RhdGljIG9iamVjdAogICAgICAgIC8vIHNpbmNlIGluIG91ciB1\nbml0IHRlc3RzLCB3ZSBydW4gbXVsdGlwbGUgQm9va2llcyBhbmQgdGh1cyBF\nbnRyeUxvZ2dlcnMKICAgICAgICAvLyB3aXRoaW4gdGhlIHNhbWUgSlZNLiBB\nbGwgb2YgdGhlc2UgQm9va2llIGluc3RhbmNlcyBhY2Nlc3MgdGhpcyBoZWFk\nZXIKICAgICAgICAvLyBzbyB0aGVyZSBjYW4gYmUgcmFjZSBjb25kaXRpb25z\nIHdoZW4gZW50cnkgbG9ncyBhcmUgcm9sbGVkIG92ZXIgYW5kCiAgICAgICAg\nLy8gdGhpcyBoZWFkZXIgYnVmZmVyIGlzIGNsZWFyZWQgYmVmb3JlIHdyaXRp\nbmcgaXQgaW50byB0aGUgbmV3IGxvZ0NoYW5uZWwuCiAgICAgICAgTE9HRklM\nRV9IRUFERVIucHV0KCJCS0xPIi5nZXRCeXRlcygpKTsKCiAgICAgICAgLy8g\nRmluZCB0aGUgbGFyZ2VzdCBsb2dJZAogICAgICAgIGxvZ0lkID0gLTE7CiAg\nICAgICAgZm9yIChGaWxlIGRpciA6IGxlZGdlckRpcnNNYW5hZ2VyLmdldEFs\nbExlZGdlckRpcnMoKSkgewogICAgICAgICAgICBpZiAoIWRpci5leGlzdHMo\nKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZpbGVOb3RGb3VuZEV4\nY2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgIkVudHJ5IGxvZyBk\naXJlY3RvcnkgZG9lcyBub3QgZXhpc3QiKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBsb25nIGxhc3RMb2dJZCA9IGdldExhc3RMb2dJZChkaXIpOwog\nICAgICAgICAgICBpZiAobGFzdExvZ0lkID4gbG9nSWQpIHsKICAgICAgICAg\nICAgICAgIGxvZ0lkID0gbGFzdExvZ0lkOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBpbml0aWFsaXplKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBNYXBzIGVudHJ5IGxvZyBmaWxlcyB0byBvcGVuIGNoYW5uZWxzLgog\nICAgICovCiAgICBwcml2YXRlIENvbmN1cnJlbnRIYXNoTWFwPExvbmcsIEJ1\nZmZlcmVkQ2hhbm5lbD4gY2hhbm5lbHMgPSBuZXcgQ29uY3VycmVudEhhc2hN\nYXA8TG9uZywgQnVmZmVyZWRDaGFubmVsPigpOwoKICAgIHN5bmNocm9uaXpl\nZCBsb25nIGdldEN1cnJlbnRMb2dJZCgpIHsKICAgICAgICByZXR1cm4gbG9n\nSWQ7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgaW5pdGlhbGl6ZSgpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgLy8gUmVnaXN0ZXIgbGlzdGVu\nZXIgZm9yIGRpc2sgZnVsbCBub3RpZmljYXRpb25zLgogICAgICAgIGxlZGdl\nckRpcnNNYW5hZ2VyLmFkZExlZGdlckRpcnNMaXN0ZW5lcihnZXRMZWRnZXJE\naXJzTGlzdGVuZXIoKSk7CiAgICAgICAgLy8gY3JlYXRlIGEgbmV3IGxvZyB0\nbyB3cml0ZQogICAgICAgIGNyZWF0ZU5ld0xvZygpOwogICAgfQoKICAgIHBy\naXZhdGUgTGVkZ2VyRGlyc0xpc3RlbmVyIGdldExlZGdlckRpcnNMaXN0ZW5l\ncigpIHsKICAgICAgICByZXR1cm4gbmV3IExlZGdlckRpcnNMaXN0ZW5lcigp\nIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIGRpc2tGdWxsKEZpbGUgZGlzaykgewogICAgICAgICAgICAgICAgLy8g\nSWYgdGhlIGN1cnJlbnQgZW50cnkgbG9nIGRpc2sgaXMgZnVsbCwgdGhlbiBj\ncmVhdGUgbmV3IGVudHJ5CiAgICAgICAgICAgICAgICAvLyBsb2cuCiAgICAg\nICAgICAgICAgICBpZiAoY3VycmVudERpciAhPSBudWxsICYmIGN1cnJlbnRE\naXIuZXF1YWxzKGRpc2spKSB7CiAgICAgICAgICAgICAgICAgICAgc2hvdWxk\nQ3JlYXRlTmV3RW50cnlMb2cuc2V0KHRydWUpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgZGlza0ZhaWxlZChGaWxlIGRpc2spIHsKICAg\nICAgICAgICAgICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxlIGhlcmUuIFdpbGwg\nYmUgaGFuZGxlZCBpbiBCb29raWUKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFsbERpc2tz\nRnVsbCgpIHsKICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxl\nIGhlcmUuIFdpbGwgYmUgaGFuZGxlZCBpbiBCb29raWUKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIGZhdGFsRXJyb3IoKSB7CiAgICAgICAgICAgICAgICAvLyBOb3RoaW5n\nIHRvIGhhbmRsZSBoZXJlLiBXaWxsIGJlIGhhbmRsZWQgaW4gQm9va2llCiAg\nICAgICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIC8qKgogICAgICog\nQ3JlYXRlcyBhIG5ldyBsb2cgZmlsZQogICAgICovCiAgICB2b2lkIGNyZWF0\nZU5ld0xvZygpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxv\nZ0NoYW5uZWwgIT0gbnVsbCkgewogICAgICAgICAgICBsb2dDaGFubmVsLmZs\ndXNoKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgLy8gSXQgd291bGQgYmV0\ndGVyIG5vdCB0byBvdmVyd3JpdGUgZXhpc3RpbmcgZW50cnkgbG9nIGZpbGVz\nCiAgICAgICAgU3RyaW5nIGxvZ0ZpbGVOYW1lID0gbnVsbDsKICAgICAgICBk\nbyB7CiAgICAgICAgICAgIGxvZ0ZpbGVOYW1lID0gTG9uZy50b0hleFN0cmlu\nZygrK2xvZ0lkKSArICIubG9nIjsKICAgICAgICAgICAgZm9yIChGaWxlIGRp\nciA6IGxlZGdlckRpcnNNYW5hZ2VyLmdldEFsbExlZGdlckRpcnMoKSkgewog\nICAgICAgICAgICAgICAgRmlsZSBuZXdMb2dGaWxlID0gbmV3IEZpbGUoZGly\nLCBsb2dGaWxlTmFtZSk7CiAgICAgICAgICAgICAgICBpZiAobmV3TG9nRmls\nZS5leGlzdHMoKSkgewogICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJG\nb3VuZCBleGlzdGVkIGVudHJ5IGxvZyAiICsgbmV3TG9nRmlsZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICArICIgd2hlbiB0cnlpbmcgdG8gY3JlYXRl\nIGl0IGFzIGEgbmV3IGxvZy4iKTsKICAgICAgICAgICAgICAgICAgICBsb2dG\naWxlTmFtZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IHdoaWxl\nIChsb2dGaWxlTmFtZSA9PSBudWxsKTsKCiAgICAgICAgLy8gVXBkYXRlIGxh\nc3QgbG9nIGlkIGZpcnN0CiAgICAgICAgY3VycmVudERpciA9IGxlZGdlckRp\ncnNNYW5hZ2VyLnBpY2tSYW5kb21Xcml0YWJsZURpcigpOwogICAgICAgIHNl\ndExhc3RMb2dJZChjdXJyZW50RGlyLCBsb2dJZCk7CgogICAgICAgIEZpbGUg\nbmV3TG9nRmlsZSA9IG5ldyBGaWxlKGN1cnJlbnREaXIsIGxvZ0ZpbGVOYW1l\nKTsKICAgICAgICBsb2dDaGFubmVsID0gbmV3IEJ1ZmZlcmVkQ2hhbm5lbChu\nZXcgUmFuZG9tQWNjZXNzRmlsZShuZXdMb2dGaWxlLCAicnciKS5nZXRDaGFu\nbmVsKCksIDY0KjEwMjQpOwogICAgICAgIGxvZ0NoYW5uZWwud3JpdGUoKEJ5\ndGVCdWZmZXIpIExPR0ZJTEVfSEVBREVSLmNsZWFyKCkpOwogICAgICAgIGNo\nYW5uZWxzLnB1dChsb2dJZCwgbG9nQ2hhbm5lbCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZW1vdmUgZW50cnkgbG9nLgogICAgICoKICAgICAqIEBwYXJh\nbSBlbnRyeUxvZ0lkCiAgICAgKiAgICAgICAgICBFbnRyeSBMb2cgRmlsZSBJ\nZAogICAgICovCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiByZW1vdmVFbnRyeUxv\nZyhsb25nIGVudHJ5TG9nSWQpIHsKICAgICAgICBCdWZmZXJlZENoYW5uZWwg\nYmMgPSBjaGFubmVscy5yZW1vdmUoZW50cnlMb2dJZCk7CiAgICAgICAgaWYg\nKG51bGwgIT0gYmMpIHsKICAgICAgICAgICAgLy8gY2xvc2UgaXRzIHVuZGVy\nbHlpbmcgZmlsZSBjaGFubmVsLCBzbyBpdCBjb3VsZCBiZSBkZWxldGVkIHJl\nYWxseQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYmMuZ2V0\nRmlsZUNoYW5uZWwoKS5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJ\nT0V4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIkV4\nY2VwdGlvbiB3aGlsZSBjbG9zaW5nIGdhcmJhZ2UgY29sbGVjdGVkIGVudHJ5\nTG9nIGZpbGUgOiAiLCBpZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgRmlsZSBlbnRyeUxvZ0ZpbGU7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZW50cnlMb2dGaWxlID0gZmluZEZpbGUoZW50cnlMb2dJZCk7CiAg\nICAgICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJUcnlpbmcgdG8gZGVsZXRlIGFuIGVudHJ5\nTG9nIGZpbGUgdGhhdCBjb3VsZCBub3QgYmUgZm91bmQ6ICIKICAgICAgICAg\nICAgICAgICAgICArIGVudHJ5TG9nSWQgKyAiLmxvZyIpOwogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghZW50cnlM\nb2dGaWxlLmRlbGV0ZSgpKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJDb3Vs\nZCBub3QgZGVsZXRlIGVudHJ5IGxvZyBmaWxlIHt9IiwgZW50cnlMb2dGaWxl\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAg\nLyoqCiAgICAgKiB3cml0ZXMgdGhlIGdpdmVuIGlkIHRvIHRoZSAibGFzdElk\nIiBmaWxlIGluIHRoZSBnaXZlbiBkaXJlY3RvcnkuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBzZXRMYXN0TG9nSWQoRmlsZSBkaXIsIGxvbmcgbG9nSWQp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZU91dHB1dFN0cmVh\nbSBmb3M7CiAgICAgICAgZm9zID0gbmV3IEZpbGVPdXRwdXRTdHJlYW0obmV3\nIEZpbGUoZGlyLCAibGFzdElkIikpOwogICAgICAgIEJ1ZmZlcmVkV3JpdGVy\nIGJ3ID0gbmV3IEJ1ZmZlcmVkV3JpdGVyKG5ldyBPdXRwdXRTdHJlYW1Xcml0\nZXIoZm9zKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYncud3JpdGUo\nTG9uZy50b0hleFN0cmluZyhsb2dJZCkgKyAiXG4iKTsKICAgICAgICAgICAg\nYncuZmx1c2goKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgYncuY2xvc2UoKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIHByaXZhdGUgbG9uZyBnZXRMYXN0TG9nSWQoRmls\nZSBkaXIpIHsKICAgICAgICBsb25nIGlkID0gcmVhZExhc3RMb2dJZChkaXIp\nOwogICAgICAgIC8vIHJlYWQgc3VjY2VzcwogICAgICAgIGlmIChpZCA+IDAp\nIHsKICAgICAgICAgICAgcmV0dXJuIGlkOwogICAgICAgIH0KICAgICAgICAv\nLyByZWFkIGZhaWxlZCwgc2NhbiB0aGUgbGVkZ2VyIGRpcmVjdG9yaWVzIHRv\nIGZpbmQgYmlnZ2VzdCBsb2cgaWQKICAgICAgICBGaWxlW10gbG9nRmlsZXMg\nPSBkaXIubGlzdEZpbGVzKG5ldyBGaWxlRmlsdGVyKCkgewogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gYWNjZXB0\nKEZpbGUgZmlsZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZpbGUuZ2V0\nTmFtZSgpLmVuZHNXaXRoKCIubG9nIik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9KTsKICAgICAgICBMaXN0PExvbmc+IGxvZ3MgPSBuZXcgQXJyYXlMaXN0\nPExvbmc+KCk7CiAgICAgICAgZm9yIChGaWxlIGxmIDogbG9nRmlsZXMpIHsK\nICAgICAgICAgICAgU3RyaW5nIGlkU3RyaW5nID0gbGYuZ2V0TmFtZSgpLnNw\nbGl0KCJcXC4iKVswXTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGxvbmcgbGlkID0gTG9uZy5wYXJzZUxvbmcoaWRTdHJpbmcsIDE2KTsK\nICAgICAgICAgICAgICAgIGxvZ3MuYWRkKGxpZCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBuZmUpIHsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICAvLyBubyBsb2cgZmlsZSBmb3VuZCBp\nbiB0aGlzIGRpcmVjdG9yeQogICAgICAgIGlmICgwID09IGxvZ3Muc2l6ZSgp\nKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CiAgICAgICAg\nLy8gb3JkZXIgdGhlIGNvbGxlY3Rpb25zCiAgICAgICAgQ29sbGVjdGlvbnMu\nc29ydChsb2dzKTsKICAgICAgICByZXR1cm4gbG9ncy5nZXQobG9ncy5zaXpl\nKCkgLSAxKTsKICAgIH0KCiAgICAvKioKICAgICAqIHJlYWRzIGlkIGZyb20g\ndGhlICJsYXN0SWQiIGZpbGUgaW4gdGhlIGdpdmVuIGRpcmVjdG9yeS4KICAg\nICAqLwogICAgcHJpdmF0ZSBsb25nIHJlYWRMYXN0TG9nSWQoRmlsZSBmKSB7\nCiAgICAgICAgRmlsZUlucHV0U3RyZWFtIGZpczsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBmaXMgPSBuZXcgRmlsZUlucHV0U3RyZWFtKG5ldyBGaWxl\nKGYsICJsYXN0SWQiKSk7CiAgICAgICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5k\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAg\nIH0KICAgICAgICBCdWZmZXJlZFJlYWRlciBiciA9IG5ldyBCdWZmZXJlZFJl\nYWRlcihuZXcgSW5wdXRTdHJlYW1SZWFkZXIoZmlzKSk7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgU3RyaW5nIGxhc3RJZFN0cmluZyA9IGJyLnJlYWRM\naW5lKCk7CiAgICAgICAgICAgIHJldHVybiBMb25nLnBhcnNlTG9uZyhsYXN0\nSWRTdHJpbmcsIDE2KTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9IGNhdGNoKE51\nbWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHJldHVybiAt\nMTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgYnIuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIHN5bmNocm9uaXplZCB2b2lkIGZsdXNoKCkgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAobG9nQ2hhbm5lbCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGxvZ0NoYW5uZWwuZmx1c2godHJ1ZSk7CiAgICAgICAgfQog\nICAgfQogICAgc3luY2hyb25pemVkIGxvbmcgYWRkRW50cnkobG9uZyBsZWRn\nZXIsIEJ5dGVCdWZmZXIgZW50cnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gQ3JlYXRlIG5ldyBsb2cgaWYgbG9nU2l6ZUxpbWl0IHJlYWNo\nZWQgb3IgY3VycmVudCBkaXNrIGlzIGZ1bGwKICAgICAgICBib29sZWFuIGNy\nZWF0ZU5ld0xvZyA9IHNob3VsZENyZWF0ZU5ld0VudHJ5TG9nLmdldCgpOwog\nICAgICAgIGlmIChjcmVhdGVOZXdMb2cKICAgICAgICAgICAgICAgIHx8IChs\nb2dDaGFubmVsLnBvc2l0aW9uKCkgKyBlbnRyeS5yZW1haW5pbmcoKSArIDQg\nPiBsb2dTaXplTGltaXQpKSB7CiAgICAgICAgICAgIGNyZWF0ZU5ld0xvZygp\nOwoKICAgICAgICAgICAgLy8gUmVzZXQgdGhlIGZsYWcKICAgICAgICAgICAg\naWYgKGNyZWF0ZU5ld0xvZykgewogICAgICAgICAgICAgICAgc2hvdWxkQ3Jl\nYXRlTmV3RW50cnlMb2cuc2V0KGZhbHNlKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBCeXRlQnVmZmVyIGJ1ZmYgPSBCeXRlQnVmZmVyLmFs\nbG9jYXRlKDQpOwogICAgICAgIGJ1ZmYucHV0SW50KGVudHJ5LnJlbWFpbmlu\nZygpKTsKICAgICAgICBidWZmLmZsaXAoKTsKICAgICAgICBsb2dDaGFubmVs\nLndyaXRlKGJ1ZmYpOwogICAgICAgIGxvbmcgcG9zID0gbG9nQ2hhbm5lbC5w\nb3NpdGlvbigpOwogICAgICAgIGxvZ0NoYW5uZWwud3JpdGUoZW50cnkpOwog\nICAgICAgIC8vbG9nQ2hhbm5lbC5mbHVzaChmYWxzZSk7CgogICAgICAgIHJl\ndHVybiAobG9nSWQgPDwgMzJMKSB8IHBvczsKICAgIH0KCiAgICBieXRlW10g\ncmVhZEVudHJ5KGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCwgbG9uZyBs\nb2NhdGlvbikgdGhyb3dzIElPRXhjZXB0aW9uLCBCb29raWUuTm9FbnRyeUV4\nY2VwdGlvbiB7CiAgICAgICAgbG9uZyBlbnRyeUxvZ0lkID0gbG9jYXRpb24g\nPj4gMzJMOwogICAgICAgIGxvbmcgcG9zID0gbG9jYXRpb24gJiAweGZmZmZm\nZmZmTDsKICAgICAgICBCeXRlQnVmZmVyIHNpemVCdWZmID0gQnl0ZUJ1ZmZl\nci5hbGxvY2F0ZSg0KTsKICAgICAgICBwb3MgLT0gNDsgLy8gd2Ugd2FudCB0\nbyBnZXQgdGhlIGxlZGdlcklkIGFuZCBsZW5ndGggdG8gY2hlY2sKICAgICAg\nICBCdWZmZXJlZENoYW5uZWwgZmM7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgZmMgPSBnZXRDaGFubmVsRm9yTG9nSWQoZW50cnlMb2dJZCk7CiAgICAg\nICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgRmlsZU5vdEZvdW5kRXhjZXB0aW9uIG5ld2UgPSBuZXcgRmlsZU5v\ndEZvdW5kRXhjZXB0aW9uKGUuZ2V0TWVzc2FnZSgpICsgIiBmb3IgIiArIGxl\nZGdlcklkICsgIiB3aXRoIGxvY2F0aW9uICIgKyBsb2NhdGlvbik7CiAgICAg\nICAgICAgIG5ld2Uuc2V0U3RhY2tUcmFjZShlLmdldFN0YWNrVHJhY2UoKSk7\nCiAgICAgICAgICAgIHRocm93IG5ld2U7CiAgICAgICAgfQogICAgICAgIGlm\nIChmYy5yZWFkKHNpemVCdWZmLCBwb3MpICE9IHNpemVCdWZmLmNhcGFjaXR5\nKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZS5Ob0VudHJ5RXhj\nZXB0aW9uKCJTaG9ydCByZWFkIGZyb20gZW50cnlsb2cgIiArIGVudHJ5TG9n\nSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgfQogICAgICAgIHBv\ncyArPSA0OwogICAgICAgIHNpemVCdWZmLmZsaXAoKTsKICAgICAgICBpbnQg\nZW50cnlTaXplID0gc2l6ZUJ1ZmYuZ2V0SW50KCk7CiAgICAgICAgLy8gZW50\ncnlTaXplIGRvZXMgbm90IGluY2x1ZGUgdGhlIGxlZGdlcklkCiAgICAgICAg\naWYgKGVudHJ5U2l6ZSA+IE1CKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nU2FuaXR5IGNoZWNrIGZhaWxlZCBmb3IgZW50cnkgc2l6ZSBvZiAiICsgZW50\ncnlTaXplICsgIiBhdCBsb2NhdGlvbiAiICsgcG9zICsgIiBpbiAiICsgZW50\ncnlMb2dJZCk7CgogICAgICAgIH0KICAgICAgICBpZiAoZW50cnlTaXplIDwg\nTUlOX1NBTkVfRU5UUllfU0laRSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIlJlYWQgaW52YWxpZCBlbnRyeSBsZW5ndGgge30iLCBlbnRyeVNpemUpOwog\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkludmFsaWQgZW50\ncnkgbGVuZ3RoICIgKyBlbnRyeVNpemUpOwogICAgICAgIH0KICAgICAgICBi\neXRlIGRhdGFbXSA9IG5ldyBieXRlW2VudHJ5U2l6ZV07CiAgICAgICAgQnl0\nZUJ1ZmZlciBidWZmID0gQnl0ZUJ1ZmZlci53cmFwKGRhdGEpOwogICAgICAg\nIGludCByYyA9IGZjLnJlYWQoYnVmZiwgcG9zKTsKICAgICAgICBpZiAoIHJj\nICE9IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0\naHJvd2luZyBOb0VudHJ5RXhjZXB0aW9uIGhlcmUgaW5zdGVhZCBvZiBJT0V4\nY2VwdGlvbiBpcyBub3QKICAgICAgICAgICAgLy8gd2l0aG91dCByaXNrLiBJ\nZiBhbGwgYm9va2llcyBpbiBhIHF1b3J1bSB0aHJvdyB0aGlzIHNhbWUgZXhj\nZXB0aW9uCiAgICAgICAgICAgIC8vIHRoZSBjbGllbnQgd2lsbCBhc3N1bWUg\ndGhhdCBpdCBoYXMgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBsZWRnZXIuCiAg\nICAgICAgICAgIC8vIEhvd2V2ZXIsIHRoaXMgbWF5IG5vdCBiZSB0aGUgY2Fz\nZSwgYXMgYSB2ZXJ5IHNwZWNpZmljIGVycm9yIGNvbmRpdGlvbgogICAgICAg\nICAgICAvLyBjb3VsZCBoYXZlIG9jY3VycmVkLCB3aGVyZSB0aGUgbGVuZ3Ro\nIG9mIHRoZSBlbnRyeSB3YXMgY29ycnVwdGVkIG9uIGFsbAogICAgICAgICAg\nICAvLyByZXBsaWNhcy4gSG93ZXZlciwgdGhlIGNoYW5jZSBvZiB0aGlzIGhh\ncHBlbmluZyBpcyB2ZXJ5IHZlcnkgbG93LCBzbwogICAgICAgICAgICAvLyBy\nZXR1cm5pbmcgTm9FbnRyeUV4Y2VwdGlvbiBpcyBtb3N0bHkgc2FmZS4KICAg\nICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uKCJT\naG9ydCByZWFkIGZvciAiICsgbGVkZ2VySWQgKyAiQCIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgZW50cnlJZCAr\nICIgaW4gIiArIGVudHJ5TG9nSWQgKyAiQCIKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgcG9zICsgIigiK3JjKyIh\nPSIrZGF0YS5sZW5ndGgrIikiLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAg\nICAgfQogICAgICAgIGJ1ZmYuZmxpcCgpOwogICAgICAgIGxvbmcgdGhpc0xl\nZGdlcklkID0gYnVmZi5nZXRMb25nKCk7CiAgICAgICAgaWYgKHRoaXNMZWRn\nZXJJZCAhPSBsZWRnZXJJZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9F\neGNlcHRpb24oInByb2JsZW0gZm91bmQgaW4gIiArIGVudHJ5TG9nSWQgKyAi\nQCIgKyBlbnRyeUlkICsgIiBhdCBwb3NpdGlvbiArICIgKyBwb3MgKyAiIGVu\ndHJ5IGJlbG9uZ3MgdG8gIiArIHRoaXNMZWRnZXJJZCArICIgbm90ICIgKyBs\nZWRnZXJJZCk7CiAgICAgICAgfQogICAgICAgIGxvbmcgdGhpc0VudHJ5SWQg\nPSBidWZmLmdldExvbmcoKTsKICAgICAgICBpZiAodGhpc0VudHJ5SWQgIT0g\nZW50cnlJZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24o\nInByb2JsZW0gZm91bmQgaW4gIiArIGVudHJ5TG9nSWQgKyAiQCIgKyBlbnRy\neUlkICsgIiBhdCBwb3NpdGlvbiArICIgKyBwb3MgKyAiIGVudHJ5IGlzICIg\nKyB0aGlzRW50cnlJZCArICIgbm90ICIgKyBlbnRyeUlkKTsKICAgICAgICB9\nCgogICAgICAgIHJldHVybiBkYXRhOwogICAgfQoKICAgIHByaXZhdGUgQnVm\nZmVyZWRDaGFubmVsIGdldENoYW5uZWxGb3JMb2dJZChsb25nIGVudHJ5TG9n\nSWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQnVmZmVyZWRDaGFu\nbmVsIGZjID0gY2hhbm5lbHMuZ2V0KGVudHJ5TG9nSWQpOwogICAgICAgIGlm\nIChmYyAhPSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybiBmYzsKICAgICAg\nICB9CiAgICAgICAgRmlsZSBmaWxlID0gZmluZEZpbGUoZW50cnlMb2dJZCk7\nCiAgICAgICAgLy8gZ2V0IGNoYW5uZWwgaXMgdXNlZCB0byBvcGVuIGFuIGV4\naXN0aW5nIGVudHJ5IGxvZyBmaWxlCiAgICAgICAgLy8gaXQgd291bGQgYmUg\nYmV0dGVyIHRvIG9wZW4gdXNpbmcgcmVhZCBtb2RlCiAgICAgICAgRmlsZUNo\nYW5uZWwgbmV3RmMgPSBuZXcgUmFuZG9tQWNjZXNzRmlsZShmaWxlLCAiciIp\nLmdldENoYW5uZWwoKTsKICAgICAgICAvLyBJZiB0aGUgZmlsZSBhbHJlYWR5\nIGV4aXN0cyBiZWZvcmUgY3JlYXRpbmcgYSBCdWZmZXJlZENoYW5uZWwgbGF5\nZXIgYWJvdmUgaXQsCiAgICAgICAgLy8gc2V0IHRoZSBGaWxlQ2hhbm5lbCdz\nIHBvc2l0aW9uIHRvIHRoZSBlbmQgc28gdGhlIHdyaXRlIGJ1ZmZlciBrbm93\ncyB3aGVyZSB0byBzdGFydC4KICAgICAgICBuZXdGYy5wb3NpdGlvbihuZXdG\nYy5zaXplKCkpOwogICAgICAgIGZjID0gbmV3IEJ1ZmZlcmVkQ2hhbm5lbChu\nZXdGYywgODE5Mik7CgogICAgICAgIEJ1ZmZlcmVkQ2hhbm5lbCBvbGRmYyA9\nIGNoYW5uZWxzLnB1dElmQWJzZW50KGVudHJ5TG9nSWQsIGZjKTsKICAgICAg\nICBpZiAob2xkZmMgIT0gbnVsbCkgewogICAgICAgICAgICBuZXdGYy5jbG9z\nZSgpOwogICAgICAgICAgICByZXR1cm4gb2xkZmM7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgcmV0dXJuIGZjOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFdoZXRoZXIgdGhlIGxvZyBmaWxlIGV4aXN0cyBvciBu\nb3QuCiAgICAgKi8KICAgIGJvb2xlYW4gbG9nRXhpc3RzKGxvbmcgbG9nSWQp\nIHsKICAgICAgICBmb3IgKEZpbGUgZCA6IGxlZGdlckRpcnNNYW5hZ2VyLmdl\ndEFsbExlZGdlckRpcnMoKSkgewogICAgICAgICAgICBGaWxlIGYgPSBuZXcg\nRmlsZShkLCBMb25nLnRvSGV4U3RyaW5nKGxvZ0lkKSArICIubG9nIik7CiAg\nICAgICAgICAgIGlmIChmLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICB9CgogICAgcHJpdmF0ZSBGaWxlIGZpbmRGaWxl\nKGxvbmcgbG9nSWQpIHRocm93cyBGaWxlTm90Rm91bmRFeGNlcHRpb24gewog\nICAgICAgIGZvciAoRmlsZSBkIDogbGVkZ2VyRGlyc01hbmFnZXIuZ2V0QWxs\nTGVkZ2VyRGlycygpKSB7CiAgICAgICAgICAgIEZpbGUgZiA9IG5ldyBGaWxl\nKGQsIExvbmcudG9IZXhTdHJpbmcobG9nSWQpKyIubG9nIik7CiAgICAgICAg\nICAgIGlmIChmLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcg\nRmlsZU5vdEZvdW5kRXhjZXB0aW9uKCJObyBmaWxlIGZvciBsb2cgIiArIExv\nbmcudG9IZXhTdHJpbmcobG9nSWQpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFNjYW4gZW50cnkgbG9nCiAgICAgKgogICAgICogQHBhcmFtIGVudHJ5TG9n\nSWQKICAgICAqICAgICAgICAgIEVudHJ5IExvZyBJZAogICAgICogQHBhcmFt\nIHNjYW5uZXIKICAgICAqICAgICAgICAgIEVudHJ5IExvZyBTY2FubmVyCiAg\nICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHNjYW5FbnRyeUxvZyhsb25nIGVudHJ5TG9nSWQsIEVudHJ5TG9n\nU2Nhbm5lciBzY2FubmVyKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIEJ5dGVCdWZmZXIgc2l6ZUJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQp\nOwogICAgICAgIEJ5dGVCdWZmZXIgbGlkQnVmZiA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoOCk7CiAgICAgICAgQnVmZmVyZWRDaGFubmVsIGJjOwogICAgICAg\nIC8vIEdldCB0aGUgQnVmZmVyZWRDaGFubmVsIGZvciB0aGUgY3VycmVudCBl\nbnRyeSBsb2cgZmlsZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJjID0g\nZ2V0Q2hhbm5lbEZvckxvZ0lkKGVudHJ5TG9nSWQpOwogICAgICAgIH0gY2F0\nY2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLndhcm4oIkZh\naWxlZCB0byBnZXQgY2hhbm5lbCB0byBzY2FuIGVudHJ5IGxvZzogIiArIGVu\ndHJ5TG9nSWQgKyAiLmxvZyIpOwogICAgICAgICAgICB0aHJvdyBlOwogICAg\nICAgIH0KICAgICAgICAvLyBTdGFydCB0aGUgcmVhZCBwb3NpdGlvbiBpbiB0\naGUgY3VycmVudCBlbnRyeSBsb2cgZmlsZSB0byBiZSBhZnRlcgogICAgICAg\nIC8vIHRoZSBoZWFkZXIgd2hlcmUgYWxsIG9mIHRoZSBsZWRnZXIgZW50cmll\ncyBhcmUuCiAgICAgICAgbG9uZyBwb3MgPSBMT0dGSUxFX0hFQURFUl9TSVpF\nOwogICAgICAgIC8vIFJlYWQgdGhyb3VnaCB0aGUgZW50cnkgbG9nIGZpbGUg\nYW5kIGV4dHJhY3QgdGhlIGxlZGdlciBJRCdzLgogICAgICAgIHdoaWxlICh0\ncnVlKSB7CiAgICAgICAgICAgIC8vIENoZWNrIGlmIHdlJ3ZlIGZpbmlzaGVk\nIHJlYWRpbmcgdGhlIGVudHJ5IGxvZyBmaWxlLgogICAgICAgICAgICBpZiAo\ncG9zID49IGJjLnNpemUoKSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJjLnJlYWQoc2l6ZUJ1ZmYs\nIHBvcykgIT0gc2l6ZUJ1ZmYuY2FwYWNpdHkoKSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJTaG9ydCByZWFkIGZvciBlbnRy\neSBzaXplIGZyb20gZW50cnlsb2cgIiArIGVudHJ5TG9nSWQpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGxvbmcgb2Zmc2V0ID0gcG9zOwogICAgICAg\nICAgICBwb3MgKz0gNDsKICAgICAgICAgICAgc2l6ZUJ1ZmYuZmxpcCgpOwog\nICAgICAgICAgICBpbnQgZW50cnlTaXplID0gc2l6ZUJ1ZmYuZ2V0SW50KCk7\nCiAgICAgICAgICAgIGlmIChlbnRyeVNpemUgPiBNQikgewogICAgICAgICAg\nICAgICAgTE9HLndhcm4oIkZvdW5kIGxhcmdlIHNpemUgZW50cnkgb2YgIiAr\nIGVudHJ5U2l6ZSArICIgYXQgbG9jYXRpb24gIiArIHBvcyArICIgaW4gIgog\nICAgICAgICAgICAgICAgICAgICAgICArIGVudHJ5TG9nSWQpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHNpemVCdWZmLmNsZWFyKCk7CiAgICAgICAg\nICAgIC8vIHRyeSB0byByZWFkIGxlZGdlciBpZCBmaXJzdAogICAgICAgICAg\nICBpZiAoYmMucmVhZChsaWRCdWZmLCBwb3MpICE9IGxpZEJ1ZmYuY2FwYWNp\ndHkoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9u\nKCJTaG9ydCByZWFkIGZvciBsZWRnZXIgaWQgZnJvbSBlbnRyeWxvZyAiICsg\nZW50cnlMb2dJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGlkQnVm\nZi5mbGlwKCk7CiAgICAgICAgICAgIGxvbmcgbGlkID0gbGlkQnVmZi5nZXRM\nb25nKCk7CiAgICAgICAgICAgIGxpZEJ1ZmYuY2xlYXIoKTsKICAgICAgICAg\nICAgaWYgKCFzY2FubmVyLmFjY2VwdChsaWQpKSB7CiAgICAgICAgICAgICAg\nICAvLyBza2lwIHRoaXMgZW50cnkKICAgICAgICAgICAgICAgIHBvcyArPSBl\nbnRyeVNpemU7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICAvLyByZWFkIHRoZSBlbnRyeQogICAgICAgICAg\nICBieXRlIGRhdGFbXSA9IG5ldyBieXRlW2VudHJ5U2l6ZV07CiAgICAgICAg\nICAgIEJ5dGVCdWZmZXIgYnVmZiA9IEJ5dGVCdWZmZXIud3JhcChkYXRhKTsK\nICAgICAgICAgICAgaW50IHJjID0gYmMucmVhZChidWZmLCBwb3MpOwogICAg\nICAgICAgICBpZiAocmMgIT0gZGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiU2hvcnQgcmVhZCBmb3IgbGVk\nZ2VyIGVudHJ5IGZyb20gZW50cnlMb2cgIiArIGVudHJ5TG9nSWQKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiQCIgKyBwb3MgKyAi\nKCIgKyByYyArICIhPSIgKyBkYXRhLmxlbmd0aCArICIpIik7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgYnVmZi5mbGlwKCk7CiAgICAgICAgICAgIC8v\nIHByb2Nlc3MgdGhlIGVudHJ5CiAgICAgICAgICAgIHNjYW5uZXIucHJvY2Vz\ncyhsaWQsIG9mZnNldCwgYnVmZik7CiAgICAgICAgICAgIC8vIEFkdmFuY2Ug\ncG9zaXRpb24gdG8gdGhlIG5leHQgZW50cnkKICAgICAgICAgICAgcG9zICs9\nIGVudHJ5U2l6ZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\naHV0ZG93biBtZXRob2QgdG8gZ3JhY2VmdWxseSBzdG9wIGVudHJ5IGxvZ2dl\nci4KICAgICAqLwogICAgcHVibGljIHZvaWQgc2h1dGRvd24oKSB7CiAgICAg\nICAgLy8gc2luY2UgbG9nQ2hhbm5lbCBpcyBidWZmZXJlZCBjaGFubmVsLCBk\nbyBmbHVzaCB3aGVuIHNodXR0aW5nIGRvd24KICAgICAgICB0cnkgewogICAg\nICAgICAgICBmbHVzaCgpOwogICAgICAgICAgICBmb3IgKEVudHJ5PExvbmcs\nIEJ1ZmZlcmVkQ2hhbm5lbD4gY2hhbm5lbEVudHJ5IDogY2hhbm5lbHMKICAg\nICAgICAgICAgICAgICAgICAuZW50cnlTZXQoKSkgewogICAgICAgICAgICAg\nICAgY2hhbm5lbEVudHJ5LmdldFZhbHVlKCkuZ2V0RmlsZUNoYW5uZWwoKS5j\nbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoSU9FeGNl\ncHRpb24gaWUpIHsKICAgICAgICAgICAgLy8gd2UgaGF2ZSBubyBpZGVhIGhv\ndyB0byBhdm9pZCBpbyBleGNlcHRpb24gZHVyaW5nIHNodXR0aW5nIGRvd24s\nIHNvIGp1c3QgaWdub3JlIGl0CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJy\nb3IgZmx1c2ggZW50cnkgbG9nIGR1cmluZyBzaHV0dGluZyBkb3duLCB3aGlj\naCBtYXkgY2F1c2UgZW50cnkgbG9nIGNvcnJ1cHRlZC4iLCBpZSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZm9yIChFbnRyeTxMb25nLCBC\ndWZmZXJlZENoYW5uZWw+IGNoYW5uZWxFbnRyeSA6IGNoYW5uZWxzCiAgICAg\nICAgICAgICAgICAgICAgLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgICAg\nIEZpbGVDaGFubmVsIGZpbGVDaGFubmVsID0gY2hhbm5lbEVudHJ5LmdldFZh\nbHVlKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmdldEZpbGVDaGFubmVs\nKCk7CiAgICAgICAgICAgICAgICBpZiAoZmlsZUNoYW5uZWwuaXNPcGVuKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBJT1V0aWxzLmNsb3NlKExPRywgZmls\nZUNoYW5uZWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

