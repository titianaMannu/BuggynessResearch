{"sha":"b554ab1065751afcbf7617cd55caf5d9a8ca105e","node_id":"MDQ6QmxvYjE1NzU5NTY6YjU1NGFiMTA2NTc1MWFmY2JmNzYxN2NkNTVjYWY1ZDlhOGNhMTA1ZQ==","size":11600,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b554ab1065751afcbf7617cd55caf5d9a8ca105e","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5CdWZmZXJVbmRl\ncmZsb3dFeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxl\nQ2hhbm5lbDsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogVGhpcyBpcyB0aGUgZmls\nZSBoYW5kbGUgZm9yIGEgbGVkZ2VyJ3MgaW5kZXggZmlsZSB0aGF0IG1hcHMg\nZW50cnkgaWRzIHRvIGxvY2F0aW9uLgogKiBJdCBpcyB1c2VkIGJ5IExlZGdl\nckNhY2hlLgogKgogKiA8cD4KICogTGVkZ2VyIGluZGV4IGZpbGUgaXMgbWFk\nZSBvZiBhIGhlYWRlciBhbmQgc2V2ZXJhbCBmaXhlZC1sZW5ndGggaW5kZXgg\ncGFnZXMsIHdoaWNoIHJlY29yZHMgdGhlIG9mZnNldHMgb2YgZGF0YSBzdG9y\nZWQgaW4gZW50cnkgbG9nZ2VycwogKiA8cHJlPiZsdDtoZWFkZXImZ3Q7Jmx0\nO2luZGV4IHBhZ2VzJmd0OzwvcHJlPgogKiA8Yj5IZWFkZXI8L2I+IGlzIGZv\ncm1hdGVkIGFzIGJlbG93OgogKiA8cHJlPiZsdDttYWdpYyBieXRlcyZndDsm\nbHQ7bGVuIG9mIG1hc3RlciBrZXkmZ3Q7Jmx0O21hc3RlciBrZXkmZ3Q7PC9w\ncmU+CiAqIDx1bD4KICogPGxpPm1hZ2ljIGJ5dGVzOiA0IGJ5dGVzLCAnQktM\nRScsIHZlcnNpb246IDQgYnl0ZXMKICogPGxpPmxlbiBvZiBtYXN0ZXIga2V5\nOiBpbmRpY2F0ZXMgbGVuZ3RoIG9mIG1hc3RlciBrZXkuIC0xIG1lYW5zIG5v\nIG1hc3RlciBrZXkgc3RvcmVkIGluIGhlYWRlci4KICogPGxpPm1hc3RlciBr\nZXk6IG1hc3RlciBrZXkKICogPGxpPnN0YXRlOiBiaXQgbWFwIHRvIGluZGlj\nYXRlIHRoZSBzdGF0ZSwgMzIgYml0cy4KICogPC91bD4KICogPGI+SW5kZXgg\ncGFnZTwvYj4gaXMgYSBmaXhlZC1sZW5ndGggcGFnZSwgd2hpY2ggY29udGFp\nbnMgc2VydmVyYWwgZW50cmllcyB3aGljaCBwb2ludCB0byB0aGUgb2Zmc2V0\ncyBvZiBkYXRhIHN0b3JlZCBpbiBlbnRyeSBsb2dnZXJzLgogKiA8L3A+CiAq\nLwpjbGFzcyBGaWxlSW5mbyB7CiAgICBzdGF0aWMgTG9nZ2VyIExPRyA9IExv\nZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEZpbGVJbmZvLmNsYXNzKTsKCiAgICBz\ndGF0aWMgZmluYWwgaW50IE5PX01BU1RFUl9LRVkgPSAtMTsKICAgIHN0YXRp\nYyBmaW5hbCBpbnQgU1RBVEVfRkVOQ0VEX0JJVCA9IDB4MTsKCiAgICBwcml2\nYXRlIEZpbGVDaGFubmVsIGZjOwogICAgcHJpdmF0ZSBGaWxlIGxmOwogICAg\nYnl0ZVtdIG1hc3RlcktleTsKCiAgICAvKioKICAgICAqIFRoZSBmaW5nZXJw\ncmludCBvZiBhIGxlZGdlciBpbmRleCBmaWxlCiAgICAgKi8KICAgIHN0YXRp\nYyBmaW5hbCBwdWJsaWMgaW50IHNpZ25hdHVyZSA9IEJ5dGVCdWZmZXIud3Jh\ncCgiQktMRSIuZ2V0Qnl0ZXMoKSkuZ2V0SW50KCk7CiAgICBzdGF0aWMgZmlu\nYWwgcHVibGljIGludCBoZWFkZXJWZXJzaW9uID0gMDsKCiAgICBzdGF0aWMg\nZmluYWwgbG9uZyBTVEFSVF9PRl9EQVRBID0gMTAyNDsKICAgIHByaXZhdGUg\nbG9uZyBzaXplOwogICAgcHJpdmF0ZSBpbnQgdXNlQ291bnQ7CiAgICBwcml2\nYXRlIGJvb2xlYW4gaXNDbG9zZWQ7CiAgICBwcml2YXRlIGxvbmcgc2l6ZVNp\nbmNlTGFzdHdyaXRlOwoKICAgIC8vIGJpdCBtYXAgZm9yIHN0YXRlcyBvZiB0\naGUgbGVkZ2VyLgogICAgcHJpdmF0ZSBpbnQgc3RhdGVCaXRzOwogICAgcHJp\ndmF0ZSBib29sZWFuIG5lZWRGbHVzaEhlYWRlciA9IGZhbHNlOwoKICAgIC8v\nIGZpbGUgYWNjZXNzIG1vZGUKICAgIHByb3RlY3RlZCBTdHJpbmcgbW9kZTsK\nCiAgICBwdWJsaWMgRmlsZUluZm8oRmlsZSBsZiwgYnl0ZVtdIG1hc3Rlcktl\neSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0aGlzLmxmID0gbGY7\nCgogICAgICAgIHRoaXMubWFzdGVyS2V5ID0gbWFzdGVyS2V5OwogICAgICAg\nIG1vZGUgPSAicnciOwogICAgfQoKICAgIHB1YmxpYyBGaWxlIGdldExmKCkg\newogICAgICAgIHJldHVybiBsZjsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBn\nZXRTaXplU2luY2VMYXN0d3JpdGUoKSB7CiAgICAgICAgcmV0dXJuIHNpemVT\naW5jZUxhc3R3cml0ZTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGlj\nIHZvaWQgcmVhZEhlYWRlcigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGxmLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGlmIChmYyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUobGYsIG1v\nZGUpLmdldENoYW5uZWwoKTsKICAgICAgICAgICAgc2l6ZSA9IGZjLnNpemUo\nKTsKICAgICAgICAgICAgc2l6ZVNpbmNlTGFzdHdyaXRlID0gc2l6ZTsKCiAg\nICAgICAgICAgIC8vIGF2b2lkIGhhbmcgb24gcmVhZGluZyBwYXJ0aWFsIGlu\nZGV4CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFs\nbG9jYXRlKChpbnQpKE1hdGgubWluKHNpemUsIFNUQVJUX09GX0RBVEEpKSk7\nCiAgICAgICAgICAgIHdoaWxlKGJiLmhhc1JlbWFpbmluZygpKSB7CiAgICAg\nICAgICAgICAgICBmYy5yZWFkKGJiKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBiYi5mbGlwKCk7CiAgICAgICAgICAgIGlmIChiYi5nZXRJbnQoKSAh\nPSBzaWduYXR1cmUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbigiTWlzc2luZyBsZWRnZXIgc2lnbmF0dXJlIik7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaW50IHZlcnNpb24gPSBiYi5nZXRJbnQoKTsK\nICAgICAgICAgICAgaWYgKHZlcnNpb24gIT0gaGVhZGVyVmVyc2lvbikgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJJbmNvbXBh\ndGlibGUgbGVkZ2VyIHZlcnNpb24gIiArIHZlcnNpb24pOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGludCBsZW5ndGggPSBiYi5nZXRJbnQoKTsKICAg\nICAgICAgICAgaWYgKGxlbmd0aCA8IDApIHsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJT0V4Y2VwdGlvbigiTGVuZ3RoICIgKyBsZW5ndGggKyAiIGlz\nIGludmFsaWQiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChsZW5ndGggPiBi\nYi5yZW1haW5pbmcoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJ1\nZmZlclVuZGVyZmxvd0V4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIG1hc3RlcktleSA9IG5ldyBieXRlW2xlbmd0aF07CiAgICAgICAg\nICAgIGJiLmdldChtYXN0ZXJLZXkpOwogICAgICAgICAgICBzdGF0ZUJpdHMg\nPSBiYi5nZXRJbnQoKTsKICAgICAgICAgICAgbmVlZEZsdXNoSGVhZGVyID0g\nZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKCJMZWRnZXIgaW5kZXggZmlsZSBkb2VzIG5vdCBleGlz\ndCIpOwogICAgICAgIH0KICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHJpdmF0\nZSB2b2lkIGNoZWNrT3Blbihib29sZWFuIGNyZWF0ZSkgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoZmMgIT0gbnVsbCkgewogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGJvb2xlYW4gZXhpc3RzID0g\nbGYuZXhpc3RzKCk7CiAgICAgICAgaWYgKG1hc3RlcktleSA9PSBudWxsICYm\nICFleGlzdHMpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9u\nKGxmICsgIiBub3QgZm91bmQiKTsKICAgICAgICB9CgogICAgICAgIGlmICgh\nZXhpc3RzKSB7IAogICAgICAgICAgICBpZiAoY3JlYXRlKSB7CiAgICAgICAg\nICAgICAgICAvLyBkZWxheWVkIHRoZSBjcmVhdGlvbiBvZiBwYXJlbnRzIGRp\ncmVjdG9yaWVzCiAgICAgICAgICAgICAgICBjaGVja1BhcmVudHMobGYpOwog\nICAgICAgICAgICAgICAgZmMgPSBuZXcgUmFuZG9tQWNjZXNzRmlsZShsZiwg\nbW9kZSkuZ2V0Q2hhbm5lbCgpOwogICAgICAgICAgICAgICAgc2l6ZSA9IGZj\nLnNpemUoKTsKICAgICAgICAgICAgICAgIGlmIChzaXplID09IDApIHsKICAg\nICAgICAgICAgICAgICAgICB3cml0ZUhlYWRlcigpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJlYWRIZWFkZXIoKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoQnVmZmVyVW5kZXJmbG93RXhjZXB0aW9uIGJ1Zikg\newogICAgICAgICAgICAgICAgTE9HLndhcm4oIkV4Y2VwdGlvbiB3aGVuIHJl\nYWRpbmcgaGVhZGVyIG9mIHt9IDoge30iLCBsZiwgYnVmKTsKICAgICAgICAg\nICAgICAgIGlmIChudWxsICE9IG1hc3RlcktleSkgewogICAgICAgICAgICAg\nICAgICAgIExPRy53YXJuKCJBdHRlbXB0aW5nIHRvIHdyaXRlIGhlYWRlciBv\nZiB7fSBhZ2Fpbi4iLCBsZik7CiAgICAgICAgICAgICAgICAgICAgd3JpdGVI\nZWFkZXIoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJFcnJvciByZWFkaW5n\nIGhlYWRlciAiICsgbGYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCB3cml0ZUhl\nYWRlcigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZUJ1ZmZl\nciBiYiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoKGludClTVEFSVF9PRl9EQVRB\nKTsKICAgICAgICBiYi5wdXRJbnQoc2lnbmF0dXJlKTsKICAgICAgICBiYi5w\ndXRJbnQoaGVhZGVyVmVyc2lvbik7CiAgICAgICAgYmIucHV0SW50KG1hc3Rl\ncktleS5sZW5ndGgpOwogICAgICAgIGJiLnB1dChtYXN0ZXJLZXkpOwogICAg\nICAgIGJiLnB1dEludChzdGF0ZUJpdHMpOwogICAgICAgIGJiLnJld2luZCgp\nOwogICAgICAgIGZjLnBvc2l0aW9uKDApOwogICAgICAgIGZjLndyaXRlKGJi\nKTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIGJvb2xlYW4gaXNG\nZW5jZWQoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoZWNrT3Bl\nbihmYWxzZSk7CiAgICAgICAgcmV0dXJuIChzdGF0ZUJpdHMgJiBTVEFURV9G\nRU5DRURfQklUKSA9PSBTVEFURV9GRU5DRURfQklUOwogICAgfQoKICAgIC8q\nKgogICAgICogQHJldHVybiB0cnVlIGlmIHNldCBmZW5jZSBzdWNjZWVkLCBv\ndGhlcndpc2UgZmFsc2Ugd2hlbgogICAgICogaXQgYWxyZWFkeSBmZW5jZWQg\nb3IgZmFpbGVkIHRvIHNldCBmZW5jZWQuCiAgICAgKi8KICAgIHN5bmNocm9u\naXplZCBwdWJsaWMgYm9vbGVhbiBzZXRGZW5jZWQoKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIGNoZWNrT3BlbihmYWxzZSk7CiAgICAgICAgTE9H\nLmRlYnVnKCJUcnkgdG8gc2V0IGZlbmNlZCBzdGF0ZSBpbiBmaWxlIGluZm8g\ne30gOiBzdGF0ZSBiaXRzIHt9LiIsIGxmLCBzdGF0ZUJpdHMpOwogICAgICAg\nIGlmICgoc3RhdGVCaXRzICYgU1RBVEVfRkVOQ0VEX0JJVCkgIT0gU1RBVEVf\nRkVOQ0VEX0JJVCkgewogICAgICAgICAgICAvLyBub3QgZmVuY2VkIHlldAog\nICAgICAgICAgICBzdGF0ZUJpdHMgfD0gU1RBVEVfRkVOQ0VEX0JJVDsKICAg\nICAgICAgICAgbmVlZEZsdXNoSGVhZGVyID0gdHJ1ZTsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBmbHVzaCB0aGUg\naGVhZGVyIHdoZW4gaGVhZGVyIGlzIGNoYW5nZWQKICAgIHN5bmNocm9uaXpl\nZCBwdWJsaWMgdm9pZCBmbHVzaEhlYWRlcigpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKG5lZWRGbHVzaEhlYWRlcikgewogICAgICAgICAg\nICBjaGVja09wZW4odHJ1ZSk7CiAgICAgICAgICAgIHdyaXRlSGVhZGVyKCk7\nCiAgICAgICAgICAgIG5lZWRGbHVzaEhlYWRlciA9IGZhbHNlOwogICAgICAg\nIH0KICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIGxvbmcgc2l6ZSgp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tPcGVuKGZhbHNl\nKTsKICAgICAgICBsb25nIHJjID0gc2l6ZS1TVEFSVF9PRl9EQVRBOwogICAg\nICAgIGlmIChyYyA8IDApIHsKICAgICAgICAgICAgcmMgPSAwOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gcmM7CiAgICB9CgogICAgc3luY2hyb25pemVk\nIHB1YmxpYyBpbnQgcmVhZChCeXRlQnVmZmVyIGJiLCBsb25nIHBvc2l0aW9u\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHJldHVybiByZWFkQWJz\nb2x1dGUoYmIsIHBvc2l0aW9uICsgU1RBUlRfT0ZfREFUQSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSBpbnQgcmVhZEFic29sdXRlKEJ5dGVCdWZmZXIgYmIsIGxv\nbmcgc3RhcnQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tP\ncGVuKGZhbHNlKTsKICAgICAgICBpbnQgdG90YWwgPSAwOwogICAgICAgIHdo\naWxlKGJiLnJlbWFpbmluZygpID4gMCkgewogICAgICAgICAgICBpbnQgcmMg\nPSBmYy5yZWFkKGJiLCBzdGFydCk7CiAgICAgICAgICAgIGlmIChyYyA8PSAw\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlNo\nb3J0IHJlYWQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0b3RhbCAr\nPSByYzsKICAgICAgICAgICAgLy8gc2hvdWxkIG1vdmUgcmVhZCBwb3NpdGlv\nbgogICAgICAgICAgICBzdGFydCArPSByYzsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRvdGFsOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2UgYSBm\naWxlIGluZm8KICAgICAqCiAgICAgKiBAcGFyYW0gZm9yY2UKICAgICAqICAg\nICAgICAgIGlmIHNldCB0byB0cnVlLCB0aGUgaW5kZXggaXMgZm9yY2VkIHRv\nIGNyZWF0ZSBiZWZvcmUgY2xvc2VkLAogICAgICogICAgICAgICAgaWYgc2V0\nIHRvIGZhbHNlLCB0aGUgaW5kZXggaXMgbm90IGZvcmNlZCB0byBjcmVhdGUu\nCiAgICAgKi8KICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9pZCBjbG9zZShi\nb29sZWFuIGZvcmNlKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlz\nQ2xvc2VkID0gdHJ1ZTsKICAgICAgICBjaGVja09wZW4oZm9yY2UpOwogICAg\nICAgIGlmICh1c2VDb3VudCA9PSAwICYmIGZjICE9IG51bGwpIHsKICAgICAg\nICAgICAgZmMuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgc3luY2hy\nb25pemVkIHB1YmxpYyBsb25nIHdyaXRlKEJ5dGVCdWZmZXJbXSBidWZmcywg\nbG9uZyBwb3NpdGlvbikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBj\naGVja09wZW4odHJ1ZSk7CiAgICAgICAgbG9uZyB0b3RhbCA9IDA7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZmMucG9zaXRpb24ocG9zaXRpb24rU1RB\nUlRfT0ZfREFUQSk7CiAgICAgICAgICAgIHdoaWxlKGJ1ZmZzW2J1ZmZzLmxl\nbmd0aC0xXS5yZW1haW5pbmcoKSA+IDApIHsKICAgICAgICAgICAgICAgIGxv\nbmcgcmMgPSBmYy53cml0ZShidWZmcyk7CiAgICAgICAgICAgICAgICBpZiAo\ncmMgPD0gMCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbigiU2hvcnQgd3JpdGUiKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHRvdGFsICs9IHJjOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZmMuZm9yY2UodHJ1ZSk7CiAg\nICAgICAgICAgIGxvbmcgbmV3c2l6ZSA9IHBvc2l0aW9uK1NUQVJUX09GX0RB\nVEErdG90YWw7CiAgICAgICAgICAgIGlmIChuZXdzaXplID4gc2l6ZSkgewog\nICAgICAgICAgICAgICAgc2l6ZSA9IG5ld3NpemU7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgc2l6ZVNpbmNlTGFzdHdyaXRlID0gZmMuc2l6\nZSgpOwogICAgICAgIHJldHVybiB0b3RhbDsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvcGllcyBjdXJyZW50IGZpbGUgY29udGVudHMgdXB0byBzcGVjaWZp\nZWQgc2l6ZSB0byB0aGUgdGFyZ2V0IGZpbGUgYW5kCiAgICAgKiBkZWxldGVz\nIHRoZSBjdXJyZW50IGZpbGUuIElmIHNpemUgbm90IGtub3duIHRoZW4gcGFz\ncyBzaXplIGFzCiAgICAgKiBMb25nLk1BWF9WQUxVRSB0byBjb3B5IGNvbXBs\nZXRlIGZpbGUuCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9p\nZCBtb3ZlVG9OZXdMb2NhdGlvbihGaWxlIG5ld0ZpbGUsIGxvbmcgc2l6ZSkg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBjaGVja09wZW4oZmFsc2Up\nOwogICAgICAgIGlmIChzaXplID4gZmMuc2l6ZSgpKSB7CiAgICAgICAgICAg\nIHNpemUgPSBmYy5zaXplKCk7CiAgICAgICAgfQogICAgICAgIEZpbGUgcmxv\nY0ZpbGUgPSBuZXcgRmlsZShuZXdGaWxlLmdldFBhcmVudEZpbGUoKSwgbmV3\nRmlsZS5nZXROYW1lKCkgKyBMZWRnZXJDYWNoZUltcGwuUkxPQyk7CiAgICAg\nICAgaWYgKCFybG9jRmlsZS5leGlzdHMoKSkgewogICAgICAgICAgICBjaGVj\na1BhcmVudHMocmxvY0ZpbGUpOwogICAgICAgICAgICBpZiAoIXJsb2NGaWxl\nLmNyZWF0ZU5ld0ZpbGUoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKCJDcmVhdGluZyBuZXcgY2FjaGUgaW5kZXggZmlsZSAi\nICsgcmxvY0ZpbGUgKyAiIGZhaWxlZCAiKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICAvLyBjb3B5IGNvbnRlbnRzIGZyb20gb2xkLmlkeCB0\nbyBuZXcuaWR4LnJsb2MKICAgICAgICBGaWxlQ2hhbm5lbCBuZXdGYyA9IG5l\ndyBSYW5kb21BY2Nlc3NGaWxlKHJsb2NGaWxlLCAicnciKS5nZXRDaGFubmVs\nKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9uZyB3cml0dGVuID0g\nMDsKICAgICAgICAgICAgd2hpbGUgKHdyaXR0ZW4gPCBzaXplKSB7CiAgICAg\nICAgICAgICAgICBsb25nIGNvdW50ID0gZmMudHJhbnNmZXJUbyh3cml0dGVu\nLCBzaXplLCBuZXdGYyk7CiAgICAgICAgICAgICAgICBpZiAoY291bnQgPD0g\nMCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbigiQ29weWluZyB0byBuZXcgbG9jYXRpb24gIiArIHJsb2NGaWxlICsgIiBm\nYWlsZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdy\naXR0ZW4gKz0gY291bnQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKHdyaXR0ZW4gPD0gMCAmJiBzaXplID4gMCkgewogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IElPRXhjZXB0aW9uKCJDb3B5aW5nIHRvIG5ldyBsb2NhdGlv\nbiAiICsgcmxvY0ZpbGUgKyAiIGZhaWxlZCIpOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgbmV3RmMuZm9yY2UodHJ1\nZSk7CiAgICAgICAgICAgIG5ld0ZjLmNsb3NlKCk7CiAgICAgICAgfQogICAg\nICAgIC8vIGRlbGV0ZSBvbGQuaWR4CiAgICAgICAgZmMuY2xvc2UoKTsKICAg\nICAgICBpZiAoIWRlbGV0ZSgpKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nRmFpbGVkIHRvIGRlbGV0ZSB0aGUgcHJldmlvdXMgaW5kZXggZmlsZSAiICsg\nbGYpOwogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkZhaWxl\nZCB0byBkZWxldGUgdGhlIHByZXZpb3VzIGluZGV4IGZpbGUgIiArIGxmKTsK\nICAgICAgICB9CgogICAgICAgIC8vIHJlbmFtZSBuZXcuaWR4LnJsb2MgdG8g\nbmV3LmlkeAogICAgICAgIGlmICghcmxvY0ZpbGUucmVuYW1lVG8obmV3Rmls\nZSkpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJGYWlsZWQgdG8gcmVuYW1l\nICIgKyBybG9jRmlsZSArICIgdG8gIiArIG5ld0ZpbGUpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkZhaWxlZCB0byByZW5hbWUgIiAr\nIHJsb2NGaWxlICsgIiB0byAiICsgbmV3RmlsZSk7CiAgICAgICAgfQogICAg\nICAgIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUobmV3RmlsZSwgbW9kZSku\nZ2V0Q2hhbm5lbCgpOwogICAgICAgIGxmID0gbmV3RmlsZTsKICAgIH0KCiAg\nICBzeW5jaHJvbml6ZWQgcHVibGljIGJ5dGVbXSBnZXRNYXN0ZXJLZXkoKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoZWNrT3BlbihmYWxzZSk7\nCiAgICAgICAgcmV0dXJuIG1hc3RlcktleTsKICAgIH0KCiAgICBzeW5jaHJv\nbml6ZWQgcHVibGljIHZvaWQgdXNlKCkgewogICAgICAgIHVzZUNvdW50Kys7\nCiAgICB9CgogICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHJlbGVhc2Uo\nKSB7CiAgICAgICAgdXNlQ291bnQtLTsKICAgICAgICBpZiAoaXNDbG9zZWQg\nJiYgdXNlQ291bnQgPT0gMCAmJiBmYyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBmYy5jbG9zZSgpOwogICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkVycm9yIGNsb3NpbmcgZmlsZSBjaGFubmVsIiwgZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xl\nYW4gZGVsZXRlKCkgewogICAgICAgIHJldHVybiBsZi5kZWxldGUoKTsKICAg\nIH0KCiAgICBzdGF0aWMgZmluYWwgcHJpdmF0ZSB2b2lkIGNoZWNrUGFyZW50\ncyhGaWxlIGYpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBw\nYXJlbnQgPSBmLmdldFBhcmVudEZpbGUoKTsKICAgICAgICBpZiAocGFyZW50\nLmV4aXN0cygpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAg\nICAgICAgaWYgKHBhcmVudC5ta2RpcnMoKSA9PSBmYWxzZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNvdW5sZG4ndCBta2RpcnMg\nZm9yICIgKyBwYXJlbnQpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

