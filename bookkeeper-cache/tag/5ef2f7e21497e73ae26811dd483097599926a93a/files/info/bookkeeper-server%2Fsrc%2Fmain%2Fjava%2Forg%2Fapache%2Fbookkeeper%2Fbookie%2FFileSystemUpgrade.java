{"sha":"a4d9cdacefbb1de9b2fa095573a23c161bdf4268","node_id":"MDQ6QmxvYjE1NzU5NTY6YTRkOWNkYWNlZmJiMWRlOWIyZmEwOTU1NzNhMjNjMTYxYmRmNDI2OA==","size":15316,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a4d9cdacefbb1de9b2fa095573a23c161bdf4268","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLkJvb2tLZWVwZXJD\nb25zdGFudHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5I\nYXJkTGluazsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuaW8uRmlsZVV0\naWxzOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5CYXNpY1BhcnNl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuT3B0aW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmU7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBGb3JtYXR0ZXI7CgppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJG\nYWN0b3J5OwoKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8u\nRmlsZW5hbWVGaWx0ZXI7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwoK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CgppbXBvcnQg\namF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0\nOwppbXBvcnQgamF2YS51dGlsLlNjYW5uZXI7CmltcG9ydCBqYXZhLnV0aWwu\nTm9TdWNoRWxlbWVudEV4Y2VwdGlvbjsKCmltcG9ydCBqYXZhLm5ldC5NYWxm\nb3JtZWRVUkxFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmNvbmZpZ3VyYXRpb24uQ29uZmlndXJhdGlvbkV4Y2VwdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwoKLyoqCiAqIEFwcGxp\nY2F0aW9uIGZvciB1cGdyYWRpbmcgdGhlIGJvb2trZWVwZXIgZmlsZXN5c3Rl\nbQogKiBiZXR3ZWVuIHZlcnNpb25zCiAqLwpwdWJsaWMgY2xhc3MgRmlsZVN5\nc3RlbVVwZ3JhZGUgewogICAgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihGaWxlU3lzdGVtVXBncmFkZS5jbGFzcyk7Cgog\nICAgc3RhdGljIEZpbGVuYW1lRmlsdGVyIEJPT0tJRV9GSUxFU19GSUxURVIg\nPSBuZXcgRmlsZW5hbWVGaWx0ZXIoKSB7CiAgICAgICAgICAgIHByaXZhdGUg\nYm9vbGVhbiBjb250YWluc0luZGV4RmlsZXMoRmlsZSBkaXIsIFN0cmluZyBu\nYW1lKSB7CiAgICAgICAgICAgICAgICBpZiAobmFtZS5lbmRzV2l0aCgiLmlk\neCIpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBMb25nLnBhcnNlTG9uZyhuYW1lLCAxNik7CiAgICAgICAg\nICAgICAgICAgICAgRmlsZSBkID0gbmV3IEZpbGUoZGlyLCBuYW1lKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoZC5pc0RpcmVjdG9yeSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIFN0cmluZ1tdIGZpbGVzID0gZC5saXN0KCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoU3RyaW5nIGYgOiBmaWxl\ncykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5z\nSW5kZXhGaWxlcyhkLCBmKSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0\nRXhjZXB0aW9uIG5mZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJv\nb2xlYW4gYWNjZXB0KEZpbGUgZGlyLCBTdHJpbmcgbmFtZSkgewogICAgICAg\nICAgICAgICAgaWYgKG5hbWUuZW5kc1dpdGgoIi50eG4iKSB8fCBuYW1lLmVu\nZHNXaXRoKCIubG9nIikKICAgICAgICAgICAgICAgICAgICB8fCBuYW1lLmVx\ndWFscygibGFzdElkIikgfHwgbmFtZS5lcXVhbHMoImxhc3RNYXJrIikpIHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGlmIChjb250YWluc0luZGV4RmlsZXMo\nZGlyLCBuYW1lKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICBwcml2YXRlIHN0\nYXRpYyBMaXN0PEZpbGU+IGdldEFsbERpcmVjdG9yaWVzKFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZikgewogICAgICAgIExpc3Q8RmlsZT4gZGlycyA9IG5l\ndyBBcnJheUxpc3Q8RmlsZT4oKTsKICAgICAgICBkaXJzLmFkZChjb25mLmdl\ndEpvdXJuYWxEaXIoKSk7CiAgICAgICAgZm9yIChGaWxlIGQ6IGNvbmYuZ2V0\nTGVkZ2VyRGlycygpKSB7CiAgICAgICAgICAgIGRpcnMuYWRkKGQpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZGlyczsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBpbnQgZGV0ZWN0UHJldmlvdXNWZXJzaW9uKEZpbGUgZGlyZWN0\nb3J5KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIFN0cmluZ1tdIGZp\nbGVzID0gZGlyZWN0b3J5Lmxpc3QoQk9PS0lFX0ZJTEVTX0ZJTFRFUik7CiAg\nICAgICAgRmlsZSB2MnZlcnNpb25GaWxlID0gbmV3IEZpbGUoZGlyZWN0b3J5\nLAogICAgICAgICAgICAgICAgQm9va0tlZXBlckNvbnN0YW50cy5WRVJTSU9O\nX0ZJTEVOQU1FKTsKICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID09IDAgJiYg\nIXYydmVyc2lvbkZpbGUuZXhpc3RzKCkpIHsgLy8gbm8gb2xkIGRhdGEsIHNv\nIHdlJ3JlIG9rCiAgICAgICAgICAgIHJldHVybiBDb29raWUuQ1VSUkVOVF9D\nT09LSUVfTEFZT1VUX1ZFUlNJT047CiAgICAgICAgfQoKICAgICAgICBpZiAo\nIXYydmVyc2lvbkZpbGUuZXhpc3RzKCkpIHsKICAgICAgICAgICAgcmV0dXJu\nIDE7CiAgICAgICAgfQogICAgICAgIFNjYW5uZXIgcyA9IG5ldyBTY2FubmVy\nKHYydmVyc2lvbkZpbGUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBzLm5leHRJbnQoKTsKICAgICAgICB9IGNhdGNoIChOb1N1Y2hFbGVt\nZW50RXhjZXB0aW9uIG5zZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkNv\ndWxkbid0IHBhcnNlIHZlcnNpb24gZmlsZSAiICsgdjJ2ZXJzaW9uRmlsZSAs\nIG5zZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiQ291\nbGRuJ3QgcGFyc2UgdmVyc2lvbiBmaWxlIiwgbnNlKTsKICAgICAgICB9IGNh\ndGNoIChJbGxlZ2FsU3RhdGVFeGNlcHRpb24gaXNlKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiRXJyb3IgcmVhZGluZyBmaWxlICIgKyB2MnZlcnNpb25G\naWxlLCBpc2UpOwogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24o\nIkVycm9yIHJlYWRpbmcgdmVyc2lvbiBmaWxlIiwgaXNlKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBzLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgc3RhdGljIFpvb0tlZXBlciBuZXdab29rZWVw\nZXIoZmluYWwgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAg\nICB0aHJvd3MgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24gewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNo\nIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgICAgICBa\nb29LZWVwZXIgemsgPSBuZXcgWm9vS2VlcGVyKGNvbmYuZ2V0WmtTZXJ2ZXJz\nKCksIGNvbmYuZ2V0WmtUaW1lb3V0KCksCiAgICAgICAgICAgICAgICAgICAg\nbmV3IFdhdGNoZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9j\nZXNzKFdhdGNoZWRFdmVudCBldmVudCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gaGFuZGxlIHNlc3Npb24gZGlzY29ubmVjdHMgYW5kIGV4\ncGlyZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5n\nZXRTdGF0ZSgpLmVxdWFscyhXYXRjaGVyLkV2ZW50LktlZXBlclN0YXRlLlN5\nbmNDb25uZWN0ZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKCFsYXRjaC5hd2FpdChjb25m\nLmdldFprVGltZW91dCgpKjIsIFRpbWVVbml0Lk1JTExJU0VDT05EUykpIHsK\nICAgICAgICAgICAgICAgIHprLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24oIkNv\ndWxkbid0IGNvbm5lY3QgdG8gem9va2VlcGVyIik7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIHprOwogICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBC\nb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbihpZSk7CiAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbihpb2UpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIGxpbmtJ\nbmRleERpcmVjdG9yaWVzKEZpbGUgc3JjUGF0aCwgRmlsZSB0YXJnZXRQYXRo\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIFN0cmluZ1tdIGZpbGVz\nID0gc3JjUGF0aC5saXN0KCk7CgogICAgICAgIGZvciAoU3RyaW5nIGYgOiBm\naWxlcykgewogICAgICAgICAgICBpZiAoZi5lbmRzV2l0aCgiLmlkeCIpKSB7\nIC8vIHRoaXMgaXMgYW4gaW5kZXggZGlyLCBjcmVhdGUgdGhlIGxpbmtzCiAg\nICAgICAgICAgICAgICBpZiAoIXRhcmdldFBhdGgubWtkaXJzKCkpIHsKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNvdWxk\nIG5vdCBjcmVhdGUgdGFyZ2V0IHBhdGggWyIrdGFyZ2V0UGF0aCsiXSIpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgSGFyZExpbmsuY3Jl\nYXRlSGFyZExpbmtNdWx0KHNyY1BhdGgsIGZpbGVzLCB0YXJnZXRQYXRoKTsK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBGaWxlIG5ld1NyY1BhdGggPSBuZXcgRmlsZShzcmNQYXRoLCBmKTsK\nICAgICAgICAgICAgaWYgKG5ld1NyY1BhdGguaXNEaXJlY3RvcnkoKSkgewog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBMb25n\nLnBhcnNlTG9uZyhmLCAxNik7CiAgICAgICAgICAgICAgICAgICAgbGlua0lu\nZGV4RGlyZWN0b3JpZXMobmV3U3JjUGF0aCwgbmV3IEZpbGUodGFyZ2V0UGF0\naCwgZikpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0\nRXhjZXB0aW9uIG5mZSkgewogICAgICAgICAgICAgICAgICAgIC8vIGZpbGVu\nYW1lIGRvZXMgbm90IHBhcnNlIHRvIGEgaGV4IExvbmcsIHNvCiAgICAgICAg\nICAgICAgICAgICAgLy8gaXQgd2lsbCBub3QgY29udGFpbiBpZHggZmlsZXMu\nIElnbm9yaW5nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHN0YXRpYyB2b2lkIHVwZ3JhZGUo\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAgICB0aHJvd3Mg\nQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24sIEludGVycnVwdGVk\nRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiVXBncmFkaW5nLi4uIik7\nCgogICAgICAgIFpvb0tlZXBlciB6ayA9IG5ld1pvb2tlZXBlcihjb25mKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBNYXA8RmlsZSxGaWxlPiBkZWZl\ncnJlZE1vdmVzID0gbmV3IEhhc2hNYXA8RmlsZSwgRmlsZT4oKTsKICAgICAg\nICAgICAgQ29va2llIGMgPSBDb29raWUuZ2VuZXJhdGVDb29raWUoY29uZik7\nCiAgICAgICAgICAgIGZvciAoRmlsZSBkIDogZ2V0QWxsRGlyZWN0b3JpZXMo\nY29uZikpIHsKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJVcGdyYWRpbmcg\ne30iLCBkKTsKICAgICAgICAgICAgICAgIGludCB2ZXJzaW9uID0gZGV0ZWN0\nUHJldmlvdXNWZXJzaW9uKGQpOwogICAgICAgICAgICAgICAgaWYgKHZlcnNp\nb24gPT0gQ29va2llLkNVUlJFTlRfQ09PS0lFX0xBWU9VVF9WRVJTSU9OKSB7\nCiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIkRpcmVjdG9yeSBpcyBj\ndXJyZW50LCBubyBuZWVkIHRvIHVwZ3JhZGUiKTsKICAgICAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgRmlsZSBjdXJEaXIgPSBu\nZXcgRmlsZShkLCBCb29rS2VlcGVyQ29uc3RhbnRzLkNVUlJFTlRfRElSKTsK\nICAgICAgICAgICAgICAgICAgICBGaWxlIHRtcERpciA9IG5ldyBGaWxlKGQs\nICJ1cGdyYWRlVG1wLiIgKyBTeXN0ZW0ubmFub1RpbWUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgZGVmZXJyZWRNb3Zlcy5wdXQoY3VyRGlyLCB0bXBEaXIp\nOwogICAgICAgICAgICAgICAgICAgIGlmICghdG1wRGlyLm1rZGlycygpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBCb29raWVFeGNl\ncHRpb24uVXBncmFkZUV4Y2VwdGlvbigiQ291bGQgbm90IGNyZWF0ZSB0ZW1w\nb3JhcnkgZGlyZWN0b3J5ICIgKyB0bXBEaXIpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBjLndyaXRlVG9EaXJlY3Rvcnko\ndG1wRGlyKTsKCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nW10gZmlsZXMg\nPSBkLmxpc3QobmV3IEZpbGVuYW1lRmlsdGVyKCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gYWNjZXB0KEZpbGUgZGly\nLCBTdHJpbmcgbmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybiBCT09LSUVfRklMRVNfRklMVEVSLmFjY2VwdChkaXIsIG5h\nbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICYmICEo\nbmV3IEZpbGUoZGlyLCBuYW1lKS5pc0RpcmVjdG9yeSgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nfSk7CiAgICAgICAgICAgICAgICAgICAgSGFyZExpbmsuY3JlYXRlSGFyZExp\nbmtNdWx0KGQsIGZpbGVzLCB0bXBEaXIpOwoKICAgICAgICAgICAgICAgICAg\nICBsaW5rSW5kZXhEaXJlY3RvcmllcyhkLCB0bXBEaXIpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJFcnJvciB1cGdyYWRpbmcge30iLCBkKTsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9u\nLlVwZ3JhZGVFeGNlcHRpb24oaW9lKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8RmlsZSxG\naWxlPiBlIDogZGVmZXJyZWRNb3Zlcy5lbnRyeVNldCgpKSB7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIEZpbGVVdGlscy5t\nb3ZlRGlyZWN0b3J5KGUuZ2V0VmFsdWUoKSwgZS5nZXRLZXkoKSk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAg\nICAgICAgICAgICAgICBTdHJpbmcgZXJyID0gU3RyaW5nLmZvcm1hdCgiRXJy\nb3IgbW92aW5nIHVwZ3JhZGVkIGRpcmVjdG9yaWVzIGludG8gcGxhY2UgJXMg\nLT4gJXMgIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBlLmdldFZhbHVlKCksIGUuZ2V0S2V5KCkpOwogICAgICAg\nICAgICAgICAgICAgIExPRy5lcnJvcihlcnIsIGlvZSk7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhj\nZXB0aW9uKGlvZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmIChkZWZlcnJlZE1vdmVzLmlzRW1wdHkoKSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgYy53cml0ZVRvWm9vS2VlcGVy\nKHprLCBjb25mKTsKICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHdy\naXRpbmcgY29va2llIHRvIHpvb2tlZXBlciIpOwogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGtl\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGlvZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9u\nLlVwZ3JhZGVFeGNlcHRpb24oaW9lKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICB6ay5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBMT0cu\naW5mbygiRG9uZSIpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBm\naW5hbGl6ZVVwZ3JhZGUoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAg\nICAgICAgICB0aHJvd3MgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRp\nb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygi\nRmluYWxpemluZyB1cGdyYWRlLi4uIik7CiAgICAgICAgLy8gdmVyaWZ5IHRo\nYXQgdXBncmFkZSBpcyBjb3JyZWN0CiAgICAgICAgZm9yIChGaWxlIGQgOiBn\nZXRBbGxEaXJlY3Rvcmllcyhjb25mKSkgewogICAgICAgICAgICBMT0cuaW5m\nbygiRmluYWxpemluZyB7fSIsIGQpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgaW50IHZlcnNpb24gPSBkZXRlY3RQcmV2aW91c1ZlcnNp\nb24oZCk7CiAgICAgICAgICAgICAgICBpZiAodmVyc2lvbiA8IDMpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAodmVyc2lvbiA9PSAyKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIEZpbGUgdjJ2ZXJzaW9uRmlsZSA9IG5ldyBGaWxl\nKGQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9va0tlZXBl\nckNvbnN0YW50cy5WRVJTSU9OX0ZJTEVOQU1FKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKCF2MnZlcnNpb25GaWxlLmRlbGV0ZSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQ291bGQgbm90IGRl\nbGV0ZSBvbGQgdmVyc2lvbiBmaWxlIHt9IiwgdjJ2ZXJzaW9uRmlsZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgRmlsZVtdIGZpbGVzID0gZC5saXN0Rmls\nZXMoQk9PS0lFX0ZJTEVTX0ZJTFRFUik7CiAgICAgICAgICAgICAgICAgICAg\nZm9yIChGaWxlIGYgOiBmaWxlcykgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoZi5pc0RpcmVjdG9yeSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBGaWxlVXRpbHMuZGVsZXRlRGlyZWN0b3J5KGYpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9IGVsc2V7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoIWYuZGVsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cud2FybigiQ291bGQgbm90IGRlbGV0ZSB7fSIs\nIGYpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBp\nb2UpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgZmluYWxp\nemluZyB7fSIsIGQpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tp\nZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgLy8gbm9vcCBhdCB0aGUgbW9tZW50CiAg\nICAgICAgTE9HLmluZm8oIkRvbmUiKTsKICAgIH0KCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgcm9sbGJhY2soU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQog\nICAgICAgICAgICB0aHJvd3MgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNl\ncHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5m\nbygiUm9sbGluZyBiYWNrIHVwZ3JhZGUuLi4iKTsKICAgICAgICBab29LZWVw\nZXIgemsgPSBuZXdab29rZWVwZXIoY29uZik7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgZm9yIChGaWxlIGQgOiBnZXRBbGxEaXJlY3Rvcmllcyhjb25m\nKSkgewogICAgICAgICAgICAgICAgTE9HLmluZm8oIlJvbGxpbmcgYmFjayB7\nfSIsIGQpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAvLyBlbnN1cmUgdGhlcmUgaXMgYSBwcmV2aW91cyB2ZXJzaW9uIGJl\nZm9yZSByb2xsYmFjawogICAgICAgICAgICAgICAgICAgIGludCB2ZXJzaW9u\nID0gZGV0ZWN0UHJldmlvdXNWZXJzaW9uKGQpOwoKICAgICAgICAgICAgICAg\nICAgICBpZiAodmVyc2lvbiA8PSBDb29raWUuQ1VSUkVOVF9DT09LSUVfTEFZ\nT1VUX1ZFUlNJT04pIHsKICAgICAgICAgICAgICAgICAgICAgICAgRmlsZSBj\ndXJEaXIgPSBuZXcgRmlsZShkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIEJvb2tLZWVwZXJDb25zdGFudHMuQ1VSUkVOVF9ESVIpOwogICAg\nICAgICAgICAgICAgICAgICAgICBGaWxlVXRpbHMuZGVsZXRlRGlyZWN0b3J5\nKGN1ckRpcik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5V\ncGdyYWRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICJDYW5ub3Qgcm9sbGJhY2sgYXMgcHJldmlvdXMgZGF0YSBkb2VzIG5v\ndCBleGlzdCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRXJyb3Igcm9sbGluZyBiYWNrIHt9IiwgZCk7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlv\nbi5VcGdyYWRlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIENvb2tpZSBjID0gQ29va2llLnJlYWRGcm9tWm9vS2VlcGVyKHprLCBjb25m\nKTsKICAgICAgICAgICAgICAgIGMuZGVsZXRlRnJvbVpvb0tlZXBlcih6aywg\nY29uZik7CiAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBkZWxldGlu\nZyBjb29raWUgZnJvbSBab29LZWVwZXIiKTsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbihrZSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJJL08gRXJyb3IgZGVsZXRpbmcgY29v\na2llIGZyb20gWm9vS2VlcGVyIik7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24oaW9lKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHpr\nLmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIExPRy5pbmZvKCJEb25lIik7\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgdm9pZCBwcmludEhlbHAoT3B0\naW9ucyBvcHRzKSB7CiAgICAgICAgSGVscEZvcm1hdHRlciBoZiA9IG5ldyBI\nZWxwRm9ybWF0dGVyKCk7CiAgICAgICAgaGYucHJpbnRIZWxwKCJGaWxlU3lz\ndGVtVXBncmFkZSBbb3B0aW9uc10iLCBvcHRzKTsKICAgIH0KCiAgICBwdWJs\naWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmxvZzRqLkxvZ2dlciByb290\nID0gb3JnLmFwYWNoZS5sb2c0ai5Mb2dnZXIuZ2V0Um9vdExvZ2dlcigpOwog\nICAgICAgIHJvb3QuYWRkQXBwZW5kZXIobmV3IG9yZy5hcGFjaGUubG9nNGou\nQ29uc29sZUFwcGVuZGVyKAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgb3JnLmFwYWNoZS5sb2c0ai5QYXR0ZXJuTGF5b3V0KCIlLTVw\nIFsldF06ICVtJW4iKSkpOwogICAgICAgIHJvb3Quc2V0TGV2ZWwob3JnLmFw\nYWNoZS5sb2c0ai5MZXZlbC5FUlJPUik7CiAgICAgICAgb3JnLmFwYWNoZS5s\nb2c0ai5Mb2dnZXIuZ2V0TG9nZ2VyKEZpbGVTeXN0ZW1VcGdyYWRlLmNsYXNz\nKS5zZXRMZXZlbCgKICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUubG9nNGou\nTGV2ZWwuSU5GTyk7CgogICAgICAgIGZpbmFsIE9wdGlvbnMgb3B0cyA9IG5l\ndyBPcHRpb25zKCk7CiAgICAgICAgb3B0cy5hZGRPcHRpb24oImMiLCAiY29u\nZiIsIHRydWUsICJDb25maWd1cmF0aW9uIGZvciBCb29raWUiKTsKICAgICAg\nICBvcHRzLmFkZE9wdGlvbigidSIsICJ1cGdyYWRlIiwgZmFsc2UsICJVcGdy\nYWRlIGJvb2tpZSBkaXJlY3RvcmllcyIpOwogICAgICAgIG9wdHMuYWRkT3B0\naW9uKCJmIiwgImZpbmFsaXplIiwgZmFsc2UsICJGaW5hbGl6ZSB1cGdyYWRl\nIik7CiAgICAgICAgb3B0cy5hZGRPcHRpb24oInIiLCAicm9sbGJhY2siLCBm\nYWxzZSwgIlJvbGxiYWNrIHVwZ3JhZGUiKTsKICAgICAgICBvcHRzLmFkZE9w\ndGlvbigiaCIsICJoZWxwIiwgZmFsc2UsICJQcmludCBoZWxwIG1lc3NhZ2Ui\nKTsKCiAgICAgICAgQmFzaWNQYXJzZXIgcGFyc2VyID0gbmV3IEJhc2ljUGFy\nc2VyKCk7CiAgICAgICAgQ29tbWFuZExpbmUgY21kTGluZSA9IHBhcnNlci5w\nYXJzZShvcHRzLCBhcmdzKTsKICAgICAgICBpZiAoY21kTGluZS5oYXNPcHRp\nb24oImgiKSkgewogICAgICAgICAgICBwcmludEhlbHAob3B0cyk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICghY21kTGlu\nZS5oYXNPcHRpb24oImMiKSkgewogICAgICAgICAgICBTdHJpbmcgZXJyID0g\nIkNhbm5vdCB1cGdyYWRlIHdpdGhvdXQgY29uZmlndXJhdGlvbiI7CiAgICAg\nICAgICAgIExPRy5lcnJvcihlcnIpOwogICAgICAgICAgICBwcmludEhlbHAo\nb3B0cyk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24oZXJyKTsKICAgICAgICB9CgogICAgICAgIFN0cmluZyBjb25m\nRmlsZSA9IGNtZExpbmUuZ2V0T3B0aW9uVmFsdWUoImMiKTsKICAgICAgICBT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJh\ndGlvbigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbmYubG9hZENv\nbmYobmV3IEZpbGUoY29uZkZpbGUpLnRvVVJJKCkudG9VUkwoKSk7CiAgICAg\nICAgfSBjYXRjaCAoTWFsZm9ybWVkVVJMRXhjZXB0aW9uIG11ZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCBvcGVuIGNvbmZpZ3VyYXRp\nb24gZmlsZSAiICsgY29uZkZpbGUsIG11ZSk7CiAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsKICAgICAgICB9IGNh\ndGNoIChDb25maWd1cmF0aW9uRXhjZXB0aW9uIGNlKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiSW52YWxpZCBjb25maWd1cmF0aW9uIGZpbGUgIiArIGNv\nbmZGaWxlLCBjZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgICAgIGlmIChjbWRM\naW5lLmhhc09wdGlvbigidSIpKSB7CiAgICAgICAgICAgIHVwZ3JhZGUoY29u\nZik7CiAgICAgICAgfSBlbHNlIGlmIChjbWRMaW5lLmhhc09wdGlvbigiciIp\nKSB7CiAgICAgICAgICAgIHJvbGxiYWNrKGNvbmYpOwogICAgICAgIH0gZWxz\nZSBpZiAoY21kTGluZS5oYXNPcHRpb24oImYiKSkgewogICAgICAgICAgICBm\naW5hbGl6ZVVwZ3JhZGUoY29uZik7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgU3RyaW5nIGVyciA9ICJNdXN0IHNwZWNpZnkgLXVwZ3JhZGUsIC1m\naW5hbGl6ZSBvciAtcm9sbGJhY2siOwogICAgICAgICAgICBMT0cuZXJyb3Io\nZXJyKTsKICAgICAgICAgICAgcHJpbnRIZWxwKG9wdHMpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGVycik7CiAg\nICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

