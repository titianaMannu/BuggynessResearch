{"sha":"c9f5adebdb2b6a4993d58c8716113856c4f68f64","node_id":"MDQ6QmxvYjE1NzU5NTY6YzlmNWFkZWJkYjJiNmE0OTkzZDU4Yzg3MTYxMTM4NTZjNGY2OGY2NA==","size":22117,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c9f5adebdb2b6a4993d58c8716113856c4f68f64","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5C\neXRlQnVmZmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5Db21w\nYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVu\ndEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMu\nQXRvbWljQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0\nb21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJp\nY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tp\nZS5FbnRyeUxvZ2dlci5FbnRyeUxvZ1NjYW5uZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuYm9va2llLkdhcmJhZ2VDb2xsZWN0b3IuR2FyYmFn\nZUNsZWFuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5T\nZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLm1ldGEuTGVkZ2VyTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci51dGlsLk1hdGhVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci51dGlsLlNuYXBzaG90TWFwOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAq\nIFRoaXMgaXMgdGhlIGdhcmJhZ2UgY29sbGVjdG9yIHRocmVhZCB0aGF0IHJ1\nbnMgaW4gdGhlIGJhY2tncm91bmQgdG8KICogcmVtb3ZlIGFueSBlbnRyeSBs\nb2cgZmlsZXMgdGhhdCBubyBsb25nZXIgY29udGFpbnMgYW55IGFjdGl2ZSBs\nZWRnZXIuCiAqLwpwdWJsaWMgY2xhc3MgR2FyYmFnZUNvbGxlY3RvclRocmVh\nZCBleHRlbmRzIFRocmVhZCB7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoR2FyYmFnZUNv\nbGxlY3RvclRocmVhZC5jbGFzcyk7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBpbnQgQ09NUEFDVElPTl9NQVhfT1VUU1RBTkRJTkdfUkVRVUVTVFMgPSAx\nMDAwOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFNFQ09ORCA9IDEw\nMDA7CgogICAgLy8gTWFwcyBlbnRyeSBsb2cgZmlsZXMgdG8gdGhlIHNldCBv\nZiBsZWRnZXJzIHRoYXQgY29tcHJpc2UgdGhlIGZpbGUgYW5kIHRoZSBzaXpl\nIHVzYWdlIHBlciBsZWRnZXIKICAgIHByaXZhdGUgTWFwPExvbmcsIEVudHJ5\nTG9nTWV0YWRhdGE+IGVudHJ5TG9nTWV0YU1hcCA9IG5ldyBDb25jdXJyZW50\nSGFzaE1hcDxMb25nLCBFbnRyeUxvZ01ldGFkYXRhPigpOwoKICAgIC8vIFRo\naXMgaXMgaG93IG9mdGVuIHdlIHdhbnQgdG8gcnVuIHRoZSBHYXJiYWdlIENv\nbGxlY3RvciBUaHJlYWQgKGluIG1pbGxpc2Vjb25kcykuCiAgICBmaW5hbCBs\nb25nIGdjV2FpdFRpbWU7CgogICAgLy8gQ29tcGFjdGlvbiBwYXJhbWV0ZXJz\nCiAgICBib29sZWFuIGVuYWJsZU1pbm9yQ29tcGFjdGlvbiA9IGZhbHNlOwog\nICAgZmluYWwgZG91YmxlIG1pbm9yQ29tcGFjdGlvblRocmVzaG9sZDsKICAg\nIGZpbmFsIGxvbmcgbWlub3JDb21wYWN0aW9uSW50ZXJ2YWw7CgogICAgYm9v\nbGVhbiBlbmFibGVNYWpvckNvbXBhY3Rpb24gPSBmYWxzZTsKICAgIGZpbmFs\nIGRvdWJsZSBtYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQ7CiAgICBmaW5hbCBs\nb25nIG1ham9yQ29tcGFjdGlvbkludGVydmFsOwoKICAgIGxvbmcgbGFzdE1p\nbm9yQ29tcGFjdGlvblRpbWU7CiAgICBsb25nIGxhc3RNYWpvckNvbXBhY3Rp\nb25UaW1lOwoKICAgIC8vIEVudHJ5IExvZ2dlciBIYW5kbGUKICAgIGZpbmFs\nIEVudHJ5TG9nZ2VyIGVudHJ5TG9nZ2VyOwogICAgZmluYWwgU2FmZUVudHJ5\nQWRkZXIgc2FmZUVudHJ5QWRkZXI7CgogICAgLy8gTGVkZ2VyIENhY2hlIEhh\nbmRsZQogICAgZmluYWwgTGVkZ2VyQ2FjaGUgbGVkZ2VyQ2FjaGU7CiAgICBm\naW5hbCBTbmFwc2hvdE1hcDxMb25nLCBCb29sZWFuPiBhY3RpdmVMZWRnZXJz\nOwoKICAgIC8vIGZsYWcgdG8gZW5zdXJlIGdjIHRocmVhZCB3aWxsIG5vdCBi\nZSBpbnRlcnJ1cHRlZCBkdXJpbmcgY29tcGFjdGlvbgogICAgLy8gdG8gcmVk\ndWNlIHRoZSByaXNrIGdldHRpbmcgZW50cnkgbG9nIGNvcnJ1cHRlZAogICAg\nZmluYWwgQXRvbWljQm9vbGVhbiBjb21wYWN0aW5nID0gbmV3IEF0b21pY0Jv\nb2xlYW4oZmFsc2UpOwoKICAgIHZvbGF0aWxlIGJvb2xlYW4gcnVubmluZyA9\nIHRydWU7CgogICAgLy8gdHJhY2sgdGhlIGxhc3Qgc2Nhbm5lZCBzdWNjZXNz\nZnVsbHkgbG9nIGlkCiAgICBsb25nIHNjYW5uZWRMb2dJZCA9IDA7CgogICAg\nZmluYWwgR2FyYmFnZUNvbGxlY3RvciBnYXJiYWdlQ29sbGVjdG9yOwogICAg\nZmluYWwgR2FyYmFnZUNsZWFuZXIgZ2FyYmFnZUNsZWFuZXI7CgoKICAgIC8q\nKgogICAgICogSW50ZXJmYWNlIGZvciBhZGRpbmcgZW50cmllcy4gV2hlbiB0\naGUgd3JpdGUgY2FsbGJhY2sgaXMgdHJpZ2dlcmVkLCB0aGUKICAgICAqIGVu\ndHJ5IG11c3QgYmUgZ3VhcmFudGVlZCB0byBiZSBwcmVzaXN0ZWQuCiAgICAg\nKi8KICAgIGludGVyZmFjZSBTYWZlRW50cnlBZGRlciB7CiAgICAgICAgcHVi\nbGljIHZvaWQgc2FmZUFkZEVudHJ5KGxvbmcgbGVkZ2VySWQsIEJ5dGVCdWZm\nZXIgYnVmZmVyLCBHZW5lcmljQ2FsbGJhY2s8Vm9pZD4gY2IpOwogICAgfQoK\nICAgIC8qKgogICAgICogQSBzY2FubmVyIHdyYXBwZXIgdG8gY2hlY2sgd2hl\ndGhlciBhIGxlZGdlciBpcyBhbGl2ZSBpbiBhbiBlbnRyeSBsb2cgZmlsZQog\nICAgICovCiAgICBjbGFzcyBDb21wYWN0aW9uU2Nhbm5lciBpbXBsZW1lbnRz\nIEVudHJ5TG9nU2Nhbm5lciB7CiAgICAgICAgRW50cnlMb2dNZXRhZGF0YSBt\nZXRhOwogICAgICAgIE9iamVjdCBjb21wbGV0aW9uTG9jayA9IG5ldyBPYmpl\nY3QoKTsKICAgICAgICBBdG9taWNJbnRlZ2VyIG91dHN0YW5kaW5nUmVxdWVz\ndHMgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAgICAgICBBdG9taWNCb29s\nZWFuIGFsbFN1Y2Nlc3NmdWwgPSBuZXcgQXRvbWljQm9vbGVhbih0cnVlKTsK\nCiAgICAgICAgcHVibGljIENvbXBhY3Rpb25TY2FubmVyKEVudHJ5TG9nTWV0\nYWRhdGEgbWV0YSkgewogICAgICAgICAgICB0aGlzLm1ldGEgPSBtZXRhOwog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gYWNjZXB0KGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICAgICAgcmV0\ndXJuIG1ldGEuY29udGFpbnNMZWRnZXIobGVkZ2VySWQpOwogICAgICAgIH0K\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vz\ncyhmaW5hbCBsb25nIGxlZGdlcklkLCBsb25nIG9mZnNldCwgQnl0ZUJ1ZmZl\nciBlbnRyeSkKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgaWYgKCFhbGxTdWNjZXNzZnVsLmdldCgpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG91\ndHN0YW5kaW5nUmVxdWVzdHMuaW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAoY29tcGxldGlvbkxvY2spIHsKICAgICAgICAg\nICAgICAgIHdoaWxlIChvdXRzdGFuZGluZ1JlcXVlc3RzLmdldCgpID49IENP\nTVBBQ1RJT05fTUFYX09VVFNUQU5ESU5HX1JFUVVFU1RTKSB7CiAgICAgICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgY29t\ncGxldGlvbkxvY2sud2FpdCgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJydXB0ZWQgd2hpbGUgd2FpdGlu\nZyB0byByZS1hZGQgZW50cnkiLCBpZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiSW50\nZXJydXB0ZWQgd2hpbGUgd2FpdGluZyB0byByZS1hZGQgZW50cnkiLCBpZSk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHNhZmVFbnRyeUFkZGVyLnNhZmVBZGRF\nbnRyeShsZWRnZXJJZCwgZW50cnksIG5ldyBHZW5lcmljQ2FsbGJhY2s8Vm9p\nZD4oKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50\nIHJjLCBWb2lkIHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAocmMgIT0gQm9va2llRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Ige30gcmUtYWRk\naW5nIGVudHJ5IGZvciBsZWRnZXIge30pIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByYywgbGVkZ2VySWQpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYWxsU3VjY2Vzc2Z1bC5zZXQoZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIHN5bmNocm9uaXplZChjb21wbGV0aW9uTG9jaykgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgb3V0c3RhbmRpbmdSZXF1ZXN0cy5kZWNyZW1l\nbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBs\nZXRpb25Mb2NrLm5vdGlmeUFsbCgpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7\nCiAgICAgICAgfQoKICAgICAgICB2b2lkIGF3YWl0Q29tcGxldGUoKSB0aHJv\nd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgc3luY2hyb25pemVkKGNvbXBsZXRpb25Mb2NrKSB7CiAgICAgICAg\nICAgICAgICB3aGlsZSAob3V0c3RhbmRpbmdSZXF1ZXN0cy5nZXQoKSA+IDAp\nIHsKICAgICAgICAgICAgICAgICAgICBjb21wbGV0aW9uTG9jay53YWl0KCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoYWxsU3Vj\nY2Vzc2Z1bC5nZXQoKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiQ291bGRuJ3QgcmUtYWRkIGFsbCBl\nbnRyaWVzIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgZ2FyYmFn\nZSBjb2xsZWN0b3IgdGhyZWFkLgogICAgICoKICAgICAqIEBwYXJhbSBjb25m\nCiAgICAgKiAgICAgICAgICBTZXJ2ZXIgQ29uZmlndXJhdGlvbiBPYmplY3Qu\nCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1Ymxp\nYyBHYXJiYWdlQ29sbGVjdG9yVGhyZWFkKFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFs\nIExlZGdlckNhY2hlIGxlZGdlckNhY2hlLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgRW50cnlMb2dnZXIgZW50cnlMb2dnZXIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTbmFwc2hvdE1hcDxMb25n\nLCBCb29sZWFuPiBhY3RpdmVMZWRnZXJzLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgU2FmZUVudHJ5QWRkZXIgc2FmZUVudHJ5QWRkZXIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJNYW5h\nZ2VyIGxlZGdlck1hbmFnZXIpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBzdXBlcigiR2FyYmFnZUNvbGxlY3RvclRocmVhZCIpOwoK\nICAgICAgICB0aGlzLmxlZGdlckNhY2hlID0gbGVkZ2VyQ2FjaGU7CiAgICAg\nICAgdGhpcy5lbnRyeUxvZ2dlciA9IGVudHJ5TG9nZ2VyOwogICAgICAgIHRo\naXMuYWN0aXZlTGVkZ2VycyA9IGFjdGl2ZUxlZGdlcnM7CiAgICAgICAgdGhp\ncy5zYWZlRW50cnlBZGRlciA9IHNhZmVFbnRyeUFkZGVyOwoKICAgICAgICB0\naGlzLmdjV2FpdFRpbWUgPSBjb25mLmdldEdjV2FpdFRpbWUoKTsKCiAgICAg\nICAgdGhpcy5nYXJiYWdlQ2xlYW5lciA9IG5ldyBHYXJiYWdlQ29sbGVjdG9y\nLkdhcmJhZ2VDbGVhbmVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgY2xlYW4obG9uZyBsZWRnZXJJZCkgewog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBpZiAo\nTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLmRlYnVnKCJkZWxldGUgbGVkZ2VyIDogIiArIGxlZGdlcklkKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VyQ2FjaGUuZGVsZXRlTGVkZ2VyKGxlZGdlcklkKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGVuIGRlbGV0aW5nIHRoZSBs\nZWRnZXIgaW5kZXggZmlsZSBvbiB0aGUgQm9va2llOiAiLCBlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAg\nIHRoaXMuZ2FyYmFnZUNvbGxlY3RvciA9IG5ldyBTY2FuQW5kQ29tcGFyZUdh\ncmJhZ2VDb2xsZWN0b3IobGVkZ2VyTWFuYWdlciwgYWN0aXZlTGVkZ2Vycyk7\nCgogICAgICAgIC8vIGNvbXBhY3Rpb24gcGFyYW1ldGVycwogICAgICAgIG1p\nbm9yQ29tcGFjdGlvblRocmVzaG9sZCA9IGNvbmYuZ2V0TWlub3JDb21wYWN0\naW9uVGhyZXNob2xkKCk7CiAgICAgICAgbWlub3JDb21wYWN0aW9uSW50ZXJ2\nYWwgPSBjb25mLmdldE1pbm9yQ29tcGFjdGlvbkludGVydmFsKCkgKiBTRUNP\nTkQ7CiAgICAgICAgbWFqb3JDb21wYWN0aW9uVGhyZXNob2xkID0gY29uZi5n\nZXRNYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQoKTsKICAgICAgICBtYWpvckNv\nbXBhY3Rpb25JbnRlcnZhbCA9IGNvbmYuZ2V0TWFqb3JDb21wYWN0aW9uSW50\nZXJ2YWwoKSAqIFNFQ09ORDsKCiAgICAgICAgaWYgKG1pbm9yQ29tcGFjdGlv\nbkludGVydmFsID4gMCAmJiBtaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQgPiAw\nKSB7CiAgICAgICAgICAgIGlmIChtaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQg\nPiAxLjBmKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRp\nb24oIkludmFsaWQgbWlub3IgY29tcGFjdGlvbiB0aHJlc2hvbGQgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIG1pbm9yQ29tcGFj\ndGlvblRocmVzaG9sZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKG1pbm9yQ29tcGFjdGlvbkludGVydmFsIDw9IGdjV2FpdFRpbWUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiVG9vIHNob3J0\nIG1pbm9yIGNvbXBhY3Rpb24gaW50ZXJ2YWwgOiAiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgbWlub3JDb21wYWN0aW9uSW50ZXJ2\nYWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVuYWJsZU1pbm9yQ29t\ncGFjdGlvbiA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAobWFqb3JD\nb21wYWN0aW9uSW50ZXJ2YWwgPiAwICYmIG1ham9yQ29tcGFjdGlvblRocmVz\naG9sZCA+IDApIHsKICAgICAgICAgICAgaWYgKG1ham9yQ29tcGFjdGlvblRo\ncmVzaG9sZCA+IDEuMGYpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbigiSW52YWxpZCBtYWpvciBjb21wYWN0aW9uIHRocmVzaG9s\nZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbWFq\nb3JDb21wYWN0aW9uVGhyZXNob2xkKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBpZiAobWFqb3JDb21wYWN0aW9uSW50ZXJ2YWwgPD0gZ2NXYWl0VGlt\nZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJU\nb28gc2hvcnQgbWFqb3IgY29tcGFjdGlvbiBpbnRlcnZhbCA6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBtYWpvckNvbXBhY3Rp\nb25JbnRlcnZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZW5hYmxl\nTWFqb3JDb21wYWN0aW9uID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlm\nIChlbmFibGVNaW5vckNvbXBhY3Rpb24gJiYgZW5hYmxlTWFqb3JDb21wYWN0\naW9uKSB7CiAgICAgICAgICAgIGlmIChtaW5vckNvbXBhY3Rpb25JbnRlcnZh\nbCA+PSBtYWpvckNvbXBhY3Rpb25JbnRlcnZhbCB8fAogICAgICAgICAgICAg\nICAgbWlub3JDb21wYWN0aW9uVGhyZXNob2xkID49IG1ham9yQ29tcGFjdGlv\nblRocmVzaG9sZCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKCJJbnZhbGlkIG1pbm9yL21ham9yIGNvbXBhY3Rpb24gc2V0dGlu\nZ3MgOiBtaW5vciAoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArIG1pbm9yQ29tcGFjdGlvblRocmVzaG9sZCArICIsICIgKyBtaW5v\nckNvbXBhY3Rpb25JbnRlcnZhbAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICIpLCBtYWpvciAoIiArIG1ham9yQ29tcGFjdGlvblRo\ncmVzaG9sZCArICIsICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyBtYWpvckNvbXBhY3Rpb25JbnRlcnZhbCArICIpIik7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIExPRy5pbmZvKCJNaW5vciBD\nb21wYWN0aW9uIDogZW5hYmxlZD0iICsgZW5hYmxlTWlub3JDb21wYWN0aW9u\nICsgIiwgdGhyZXNob2xkPSIKICAgICAgICAgICAgICAgKyBtaW5vckNvbXBh\nY3Rpb25UaHJlc2hvbGQgKyAiLCBpbnRlcnZhbD0iICsgbWlub3JDb21wYWN0\naW9uSW50ZXJ2YWwpOwogICAgICAgIExPRy5pbmZvKCJNYWpvciBDb21wYWN0\naW9uIDogZW5hYmxlZD0iICsgZW5hYmxlTWFqb3JDb21wYWN0aW9uICsgIiwg\ndGhyZXNob2xkPSIKICAgICAgICAgICAgICAgKyBtYWpvckNvbXBhY3Rpb25U\naHJlc2hvbGQgKyAiLCBpbnRlcnZhbD0iICsgbWFqb3JDb21wYWN0aW9uSW50\nZXJ2YWwpOwoKICAgICAgICBsYXN0TWlub3JDb21wYWN0aW9uVGltZSA9IGxh\nc3RNYWpvckNvbXBhY3Rpb25UaW1lID0gTWF0aFV0aWxzLm5vdygpOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcnVuKCkgewogICAg\nICAgIHdoaWxlIChydW5uaW5nKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICB3YWl0KGdjV2FpdFRpbWUpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEV4dHJhY3QgYWxsIG9m\nIHRoZSBsZWRnZXIgSUQncyB0aGF0IGNvbXByaXNlIGFsbCBvZiB0aGUgZW50\ncnkgbG9ncwogICAgICAgICAgICAvLyAoZXhjZXB0IGZvciB0aGUgY3VycmVu\ndCBuZXcgb25lIHdoaWNoIGlzIHN0aWxsIGJlaW5nIHdyaXR0ZW4gdG8pLgog\nICAgICAgICAgICBlbnRyeUxvZ01ldGFNYXAgPSBleHRyYWN0TWV0YUZyb21F\nbnRyeUxvZ3MoZW50cnlMb2dNZXRhTWFwKTsKCiAgICAgICAgICAgIC8vIGdj\nIGluYWN0aXZlL2RlbGV0ZWQgbGVkZ2VycwogICAgICAgICAgICBkb0djTGVk\nZ2VycygpOwoKICAgICAgICAgICAgLy8gZ2MgZW50cnkgbG9ncwogICAgICAg\nICAgICBkb0djRW50cnlMb2dzKCk7CgogICAgICAgICAgICBsb25nIGN1clRp\nbWUgPSBNYXRoVXRpbHMubm93KCk7CiAgICAgICAgICAgIGlmIChlbmFibGVN\nYWpvckNvbXBhY3Rpb24gJiYKICAgICAgICAgICAgICAgIGN1clRpbWUgLSBs\nYXN0TWFqb3JDb21wYWN0aW9uVGltZSA+IG1ham9yQ29tcGFjdGlvbkludGVy\ndmFsKSB7CiAgICAgICAgICAgICAgICAvLyBlbnRlciBtYWpvciBjb21wYWN0\naW9uCiAgICAgICAgICAgICAgICBMT0cuaW5mbygiRW50ZXIgbWFqb3IgY29t\ncGFjdGlvbiIpOwogICAgICAgICAgICAgICAgZG9Db21wYWN0RW50cnlMb2dz\nKG1ham9yQ29tcGFjdGlvblRocmVzaG9sZCk7CiAgICAgICAgICAgICAgICBs\nYXN0TWFqb3JDb21wYWN0aW9uVGltZSA9IE1hdGhVdGlscy5ub3coKTsKICAg\nICAgICAgICAgICAgIC8vIGFsc28gbW92ZSBtaW5vciBjb21wYWN0aW9uIHRp\nbWUKICAgICAgICAgICAgICAgIGxhc3RNaW5vckNvbXBhY3Rpb25UaW1lID0g\nbGFzdE1ham9yQ29tcGFjdGlvblRpbWU7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVuYWJsZU1p\nbm9yQ29tcGFjdGlvbiAmJgogICAgICAgICAgICAgICAgY3VyVGltZSAtIGxh\nc3RNaW5vckNvbXBhY3Rpb25UaW1lID4gbWlub3JDb21wYWN0aW9uSW50ZXJ2\nYWwpIHsKICAgICAgICAgICAgICAgIC8vIGVudGVyIG1pbm9yIGNvbXBhY3Rp\nb24KICAgICAgICAgICAgICAgIExPRy5pbmZvKCJFbnRlciBtaW5vciBjb21w\nYWN0aW9uIik7CiAgICAgICAgICAgICAgICBkb0NvbXBhY3RFbnRyeUxvZ3Mo\nbWlub3JDb21wYWN0aW9uVGhyZXNob2xkKTsKICAgICAgICAgICAgICAgIGxh\nc3RNaW5vckNvbXBhY3Rpb25UaW1lID0gTWF0aFV0aWxzLm5vdygpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRG8g\nZ2FyYmFnZSBjb2xsZWN0aW9uIGxlZGdlciBpbmRleCBmaWxlcwogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgZG9HY0xlZGdlcnMoKSB7CiAgICAgICAgZ2Fy\nYmFnZUNvbGxlY3Rvci5nYyhnYXJiYWdlQ2xlYW5lcik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBHYXJiYWdlIGNvbGxlY3QgdGhvc2UgZW50cnkgbG9nZ2Vy\ncyB3aGljaCBhcmUgbm90IGFzc29jaWF0ZWQgd2l0aCBhbnkgYWN0aXZlIGxl\nZGdlcnMKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRvR2NFbnRyeUxvZ3Mo\nKSB7CiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBvZiB0aGUgZW50cnkg\nbG9ncyBhbmQgcmVtb3ZlIHRoZSBub24tYWN0aXZlIGxlZGdlcnMuCiAgICAg\nICAgZm9yIChMb25nIGVudHJ5TG9nSWQgOiBlbnRyeUxvZ01ldGFNYXAua2V5\nU2V0KCkpIHsKICAgICAgICAgICAgRW50cnlMb2dNZXRhZGF0YSBtZXRhID0g\nZW50cnlMb2dNZXRhTWFwLmdldChlbnRyeUxvZ0lkKTsKICAgICAgICAgICAg\nZm9yIChMb25nIGVudHJ5TG9nTGVkZ2VyIDogbWV0YS5sZWRnZXJzTWFwLmtl\neVNldCgpKSB7CiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGVudHJ5\nIGxvZyBsZWRnZXIgZnJvbSB0aGUgc2V0IGlmIGl0IGlzbid0IGFjdGl2ZS4K\nICAgICAgICAgICAgICAgIGlmICghYWN0aXZlTGVkZ2Vycy5jb250YWluc0tl\neShlbnRyeUxvZ0xlZGdlcikpIHsKICAgICAgICAgICAgICAgICAgICBtZXRh\nLnJlbW92ZUxlZGdlcihlbnRyeUxvZ0xlZGdlcik7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1ldGEuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgICAgICAvLyBUaGlzIG1lYW5zIHRoZSBlbnRy\neSBsb2cgaXMgbm90IGFzc29jaWF0ZWQgd2l0aCBhbnkgYWN0aXZlIGxlZGdl\ncnMgYW55bW9yZS4KICAgICAgICAgICAgICAgIC8vIFdlIGNhbiByZW1vdmUg\ndGhpcyBlbnRyeSBsb2cgZmlsZSBub3cuCiAgICAgICAgICAgICAgICBMT0cu\naW5mbygiRGVsZXRpbmcgZW50cnlMb2dJZCAiICsgZW50cnlMb2dJZCArICIg\nYXMgaXQgaGFzIG5vIGFjdGl2ZSBsZWRnZXJzISIpOwogICAgICAgICAgICAg\nICAgcmVtb3ZlRW50cnlMb2coZW50cnlMb2dJZCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDb21wYWN0IGVudHJ5\nIGxvZ3MgaWYgbmVjZXNzYXJ5LgogICAgICoKICAgICAqIDxwPgogICAgICog\nQ29tcGFjdGlvbiB3aWxsIGJlIGV4ZWN1dGVkIGZyb20gbG93IHVudXNlZCBz\ncGFjZSB0byBoaWdoIHVudXNlZCBzcGFjZS4KICAgICAqIFRob3NlIGVudHJ5\nIGxvZyBmaWxlcyB3aG9zZSByZW1haW5pbmcgc2l6ZSBwZXJjZW50YWdlIGlz\nIGhpZ2hlciB0aGFuIHRocmVzaG9sZAogICAgICogd291bGQgbm90IGJlIGNv\nbXBhY3RlZC4KICAgICAqIDwvcD4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGRvQ29tcGFjdEVudHJ5TG9ncyhkb3VibGUgdGhyZXNob2xkKSB7CiAgICAg\nICAgTE9HLmluZm8oIkRvIGNvbXBhY3Rpb24gdG8gY29tcGFjdCB0aG9zZSBm\naWxlcyBsb3dlciB0aGFuICIgKyB0aHJlc2hvbGQpOwogICAgICAgIC8vIHNv\ncnQgdGhlIGxlZGdlciBtZXRhIGJ5IG9jY3VwaWVkIHVudXNlZCBzcGFjZQog\nICAgICAgIENvbXBhcmF0b3I8RW50cnlMb2dNZXRhZGF0YT4gc2l6ZUNvbXBh\ncmF0b3IgPSBuZXcgQ29tcGFyYXRvcjxFbnRyeUxvZ01ldGFkYXRhPigpIHsK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBpbnQg\nY29tcGFyZShFbnRyeUxvZ01ldGFkYXRhIG0xLCBFbnRyeUxvZ01ldGFkYXRh\nIG0yKSB7CiAgICAgICAgICAgICAgICBsb25nIHVudXNlZFNpemUxID0gbTEu\ndG90YWxTaXplIC0gbTEucmVtYWluaW5nU2l6ZTsKICAgICAgICAgICAgICAg\nIGxvbmcgdW51c2VkU2l6ZTIgPSBtMi50b3RhbFNpemUgLSBtMi5yZW1haW5p\nbmdTaXplOwogICAgICAgICAgICAgICAgaWYgKHVudXNlZFNpemUxID4gdW51\nc2VkU2l6ZTIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7CiAg\nICAgICAgICAgICAgICB9IGVsc2UgaWYgKHVudXNlZFNpemUxIDwgdW51c2Vk\nU2l6ZTIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIDA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nOwogICAgICAgIExpc3Q8RW50cnlMb2dNZXRhZGF0YT4gbG9nc1RvQ29tcGFj\ndCA9IG5ldyBBcnJheUxpc3Q8RW50cnlMb2dNZXRhZGF0YT4oKTsKICAgICAg\nICBsb2dzVG9Db21wYWN0LmFkZEFsbChlbnRyeUxvZ01ldGFNYXAudmFsdWVz\nKCkpOwogICAgICAgIENvbGxlY3Rpb25zLnNvcnQobG9nc1RvQ29tcGFjdCwg\nc2l6ZUNvbXBhcmF0b3IpOwogICAgICAgIGZvciAoRW50cnlMb2dNZXRhZGF0\nYSBtZXRhIDogbG9nc1RvQ29tcGFjdCkgewogICAgICAgICAgICBpZiAobWV0\nYS5nZXRVc2FnZSgpID49IHRocmVzaG9sZCkgewogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTE9HLmRlYnVnKCJD\nb21wYWN0aW5nIGVudHJ5IGxvZyB7fSBiZWxvdyB0aHJlc2hvbGQge30uIiwg\nbWV0YS5lbnRyeUxvZ0lkLCB0aHJlc2hvbGQpOwogICAgICAgICAgICBjb21w\nYWN0RW50cnlMb2cobWV0YS5lbnRyeUxvZ0lkKTsKICAgICAgICAgICAgaWYg\nKCFydW5uaW5nKSB7IC8vIGlmIGdjIHRocmVhZCBpcyBub3QgcnVubmluZywg\nc3RvcCBjb21wYWN0aW9uCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTaHV0\nZG93biB0aGUgZ2FyYmFnZSBjb2xsZWN0b3IgdGhyZWFkLgogICAgICoKICAg\nICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gaWYgdGhlcmUgaXMg\nYW4gZXhjZXB0aW9uIHN0b3BwaW5nIGdjIHRocmVhZC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2h1dGRvd24oKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlOwogICAgICAg\nIGlmIChjb21wYWN0aW5nLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7\nCiAgICAgICAgICAgIC8vIGlmIHNldHRpbmcgY29tcGFjdGluZyBmbGFnIHN1\nY2NlZWQsIG1lYW5zIGdjVGhyZWFkIGlzIG5vdCBjb21wYWN0aW5nIG5vdwog\nICAgICAgICAgICAvLyBpdCBpcyBzYWZlIHRvIGludGVycnVwdCBpdHNlbGYg\nbm93CiAgICAgICAgICAgIHRoaXMuaW50ZXJydXB0KCk7CiAgICAgICAgfQog\nICAgICAgIHRoaXMuam9pbigpOwogICAgfQoKICAgIC8qKgogICAgICogUmVt\nb3ZlIGVudHJ5IGxvZy4KICAgICAqCiAgICAgKiBAcGFyYW0gZW50cnlMb2dJ\nZAogICAgICogICAgICAgICAgRW50cnkgTG9nIEZpbGUgSWQKICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUVudHJ5TG9nKGxvbmcgZW50cnlMb2dJ\nZCkgewogICAgICAgIC8vIHJlbW92ZSBlbnRyeSBsb2cgZmlsZSBzdWNjZXNz\nZnVsbHkKICAgICAgICBpZiAoZW50cnlMb2dnZXIucmVtb3ZlRW50cnlMb2co\nZW50cnlMb2dJZCkpIHsKICAgICAgICAgICAgZW50cnlMb2dNZXRhTWFwLnJl\nbW92ZShlbnRyeUxvZ0lkKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb21wYWN0IGFuIGVudHJ5IGxvZy4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZW50cnlMb2dJZAogICAgICogICAgICAgICAgRW50cnkgTG9nIEZpbGUg\nSWQKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY29tcGFjdEVudHJ5TG9n\nKGxvbmcgZW50cnlMb2dJZCkgewogICAgICAgIEVudHJ5TG9nTWV0YWRhdGEg\nZW50cnlMb2dNZXRhID0gZW50cnlMb2dNZXRhTWFwLmdldChlbnRyeUxvZ0lk\nKTsKICAgICAgICBpZiAobnVsbCA9PSBlbnRyeUxvZ01ldGEpIHsKICAgICAg\nICAgICAgTE9HLndhcm4oIkNhbid0IGdldCBlbnRyeSBsb2cgbWV0YSB3aGVu\nIGNvbXBhY3RpbmcgZW50cnkgbG9nICIgKyBlbnRyeUxvZ0lkICsgIi4iKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gU2lt\naWxhciB3aXRoIFN5bmMgVGhyZWFkCiAgICAgICAgLy8gdHJ5IHRvIG1hcmsg\nY29tcGFjdGluZyBmbGFnIHRvIG1ha2Ugc3VyZSBpdCB3b3VsZCBub3QgYmUg\naW50ZXJydXB0ZWQKICAgICAgICAvLyBieSBzaHV0ZG93biBkdXJpbmcgY29t\ncGFjdGlvbi4gb3RoZXJ3aXNlIGl0IHdpbGwgcmVjZWl2ZQogICAgICAgIC8v\nIENsb3NlZEJ5SW50ZXJydXB0RXhjZXB0aW9uIHdoaWNoIG1heSBjYXVzZSBp\nbmRleCBmaWxlICYgZW50cnkgbG9nZ2VyCiAgICAgICAgLy8gY2xvc2VkIGFu\nZCBjb3JydXB0ZWQuCiAgICAgICAgaWYgKCFjb21wYWN0aW5nLmNvbXBhcmVB\nbmRTZXQoZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgIC8vIHNldCBjb21w\nYWN0aW5nIGZsYWcgZmFpbGVkLCBtZWFucyBjb21wYWN0aW5nIGlzIHRydWUg\nbm93CiAgICAgICAgICAgIC8vIGluZGljYXRlcyBhbm90aGVyIHRocmVhZCB3\nYW50cyB0byBpbnRlcnJ1cHQgZ2MgdGhyZWFkIHRvIGV4aXQKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTE9HLmluZm8oIkNvbXBh\nY3RpbmcgZW50cnkgbG9nIDogIiArIGVudHJ5TG9nSWQpOwoKICAgICAgICB0\ncnkgewogICAgICAgICAgICBDb21wYWN0aW9uU2Nhbm5lciBzY2FubmVyID0g\nbmV3IENvbXBhY3Rpb25TY2FubmVyKGVudHJ5TG9nTWV0YSk7CiAgICAgICAg\nICAgIGVudHJ5TG9nZ2VyLnNjYW5FbnRyeUxvZyhlbnRyeUxvZ0lkLCBzY2Fu\nbmVyKTsKICAgICAgICAgICAgc2Nhbm5lci5hd2FpdENvbXBsZXRlKCk7CiAg\nICAgICAgICAgIC8vIGFmdGVyIG1vdmluZyBlbnRyaWVzIHRvIG5ldyBlbnRy\neSBsb2csIHJlbW92ZSB0aGlzIG9sZCBvbmUKICAgICAgICAgICAgcmVtb3Zl\nRW50cnlMb2coZW50cnlMb2dJZCk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBMT0cuaW5mbygiUHJlbWF0dXJlIGV4\nY2VwdGlvbiB3aGVuIGNvbXBhY3RpbmcgIiArIGVudHJ5TG9nSWQsIGUpOwog\nICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAg\nICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7\nCiAgICAgICAgICAgIExPRy53YXJuKCJJbnRlcnJ1cHRlZCB3aGlsZSBjb21w\nYWN0aW5nIiwgaWUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIC8vIGNsZWFyIGNvbXBhY3RpbmcgZmxhZwogICAgICAgICAgICBjb21wYWN0\naW5nLnNldChmYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVjb3JkcyB0aGUgdG90YWwgc2l6ZSwgcmVtYWluaW5nIHNpemUgYW5k\nIHRoZSBzZXQgb2YgbGVkZ2VycyB0aGF0IGNvbXByaXNlIGEgZW50cnkgbG9n\nLgogICAgICovCiAgICBzdGF0aWMgY2xhc3MgRW50cnlMb2dNZXRhZGF0YSB7\nCiAgICAgICAgbG9uZyBlbnRyeUxvZ0lkOwogICAgICAgIGxvbmcgdG90YWxT\naXplOwogICAgICAgIGxvbmcgcmVtYWluaW5nU2l6ZTsKICAgICAgICBDb25j\ndXJyZW50SGFzaE1hcDxMb25nLCBMb25nPiBsZWRnZXJzTWFwOwoKICAgICAg\nICBwdWJsaWMgRW50cnlMb2dNZXRhZGF0YShsb25nIGxvZ0lkKSB7CiAgICAg\nICAgICAgIHRoaXMuZW50cnlMb2dJZCA9IGxvZ0lkOwoKICAgICAgICAgICAg\ndG90YWxTaXplID0gcmVtYWluaW5nU2l6ZSA9IDA7CiAgICAgICAgICAgIGxl\nZGdlcnNNYXAgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8TG9uZywgTG9uZz4o\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGFkZExlZGdlclNp\nemUobG9uZyBsZWRnZXJJZCwgbG9uZyBzaXplKSB7CiAgICAgICAgICAgIHRv\ndGFsU2l6ZSArPSBzaXplOwogICAgICAgICAgICByZW1haW5pbmdTaXplICs9\nIHNpemU7CiAgICAgICAgICAgIExvbmcgbGVkZ2VyU2l6ZSA9IGxlZGdlcnNN\nYXAuZ2V0KGxlZGdlcklkKTsKICAgICAgICAgICAgaWYgKG51bGwgPT0gbGVk\nZ2VyU2l6ZSkgewogICAgICAgICAgICAgICAgbGVkZ2VyU2l6ZSA9IDBMOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGxlZGdlclNpemUgKz0gc2l6ZTsK\nICAgICAgICAgICAgbGVkZ2Vyc01hcC5wdXQobGVkZ2VySWQsIGxlZGdlclNp\nemUpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlTGVk\nZ2VyKGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICAgICAgTG9uZyBzaXplID0g\nbGVkZ2Vyc01hcC5yZW1vdmUobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAo\nbnVsbCA9PSBzaXplKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmVtYWluaW5nU2l6ZSAtPSBzaXplOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gY29udGFpbnNMZWRn\nZXIobG9uZyBsZWRnZXJJZCkgewogICAgICAgICAgICByZXR1cm4gbGVkZ2Vy\nc01hcC5jb250YWluc0tleShsZWRnZXJJZCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgZG91YmxlIGdldFVzYWdlKCkgewogICAgICAgICAgICBpZiAo\ndG90YWxTaXplID09IDBMKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMC4w\nZjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gKGRvdWJsZSly\nZW1haW5pbmdTaXplIC8gdG90YWxTaXplOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIGxlZGdlcnNNYXAuaXNFbXB0eSgpOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVy\nKCk7CiAgICAgICAgICAgIHNiLmFwcGVuZCgieyB0b3RhbFNpemUgPSAiKS5h\ncHBlbmQodG90YWxTaXplKS5hcHBlbmQoIiwgcmVtYWluaW5nU2l6ZSA9ICIp\nCiAgICAgICAgICAgICAgLmFwcGVuZChyZW1haW5pbmdTaXplKS5hcHBlbmQo\nIiwgbGVkZ2Vyc01hcCA9ICIpLmFwcGVuZChsZWRnZXJzTWFwKS5hcHBlbmQo\nIiB9Iik7CiAgICAgICAgICAgIHJldHVybiBzYi50b1N0cmluZygpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEEgc2Nhbm5lciB1c2VkIHRv\nIGV4dHJhY3QgZW50cnkgbG9nIG1ldGEgZnJvbSBlbnRyeSBsb2cgZmlsZXMu\nCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBFeHRyYWN0aW9uU2Nhbm5lciBp\nbXBsZW1lbnRzIEVudHJ5TG9nU2Nhbm5lciB7CiAgICAgICAgRW50cnlMb2dN\nZXRhZGF0YSBtZXRhOwoKICAgICAgICBwdWJsaWMgRXh0cmFjdGlvblNjYW5u\nZXIoRW50cnlMb2dNZXRhZGF0YSBtZXRhKSB7CiAgICAgICAgICAgIHRoaXMu\nbWV0YSA9IG1ldGE7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBhY2NlcHQobG9uZyBsZWRnZXJJZCkgewog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzcyhsb25nIGxlZGdl\ncklkLCBsb25nIG9mZnNldCwgQnl0ZUJ1ZmZlciBlbnRyeSkgewogICAgICAg\nICAgICAvLyBhZGQgbmV3IGVudHJ5IHNpemUgb2YgYSBsZWRnZXIgdG8gZW50\ncnkgbG9nIG1ldGEKICAgICAgICAgICAgbWV0YS5hZGRMZWRnZXJTaXplKGxl\nZGdlcklkLCBlbnRyeS5saW1pdCgpICsgNCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogTWV0aG9kIHRvIHJlYWQgaW4gYWxsIG9mIHRoZSBl\nbnRyeSBsb2dzICh0aG9zZSB0aGF0IHdlIGhhdmVuJ3QgZG9uZSBzbyB5ZXQp\nLAogICAgICogYW5kIGZpbmQgdGhlIHNldCBvZiBsZWRnZXIgSUQncyB0aGF0\nIG1ha2UgdXAgZWFjaCBlbnRyeSBsb2cgZmlsZS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZW50cnlMb2dNZXRhTWFwCiAgICAgKiAgICAgICAgICBFeGlzdGlu\nZyBFbnRyeUxvZ3MgdG8gTWV0YQogICAgICogQHRocm93cyBJT0V4Y2VwdGlv\nbgogICAgICovCiAgICBwcm90ZWN0ZWQgTWFwPExvbmcsIEVudHJ5TG9nTWV0\nYWRhdGE+IGV4dHJhY3RNZXRhRnJvbUVudHJ5TG9ncyhNYXA8TG9uZywgRW50\ncnlMb2dNZXRhZGF0YT4gZW50cnlMb2dNZXRhTWFwKSB7CiAgICAgICAgLy8g\nRXh0cmFjdCBpdCBmb3IgZXZlcnkgZW50cnkgbG9nIGV4Y2VwdCBmb3IgdGhl\nIGN1cnJlbnQgb25lLgogICAgICAgIC8vIEVudHJ5IExvZyBJRCdzIGFyZSBq\ndXN0IGEgbG9uZyB2YWx1ZSB0aGF0IHN0YXJ0cyBhdCAwIGFuZCBpbmNyZW1l\nbnRzCiAgICAgICAgLy8gYnkgMSB3aGVuIHRoZSBsb2cgZmlsbHMgdXAgYW5k\nIHdlIHJvbGwgdG8gYSBuZXcgb25lLgogICAgICAgIGxvbmcgY3VyTG9nSWQg\nPSBlbnRyeUxvZ2dlci5nZXRDdXJyZW50TG9nSWQoKTsKICAgICAgICBib29s\nZWFuIGhhc0V4Y2VwdGlvbldoZW5TY2FuID0gZmFsc2U7CiAgICAgICAgZm9y\nIChsb25nIGVudHJ5TG9nSWQgPSBzY2FubmVkTG9nSWQ7IGVudHJ5TG9nSWQg\nPCBjdXJMb2dJZDsgZW50cnlMb2dJZCsrKSB7CiAgICAgICAgICAgIC8vIENv\nbWIgdGhlIGN1cnJlbnQgZW50cnkgbG9nIGZpbGUgaWYgaXQgaGFzIG5vdCBh\nbHJlYWR5IGJlZW4gZXh0cmFjdGVkLgogICAgICAgICAgICBpZiAoZW50cnlM\nb2dNZXRhTWFwLmNvbnRhaW5zS2V5KGVudHJ5TG9nSWQpKSB7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gY2hlY2sgd2hldGhlciBsb2cgZmlsZSBleGlzdHMgb3Igbm90CiAgICAg\nICAgICAgIC8vIGlmIGl0IGRvZXNuJ3QgZXhpc3QsIHRoaXMgbG9nIGZpbGUg\nbWlnaHQgaGF2ZSBiZWVuIGdhcmJhZ2UgY29sbGVjdGVkLgogICAgICAgICAg\nICBpZiAoIWVudHJ5TG9nZ2VyLmxvZ0V4aXN0cyhlbnRyeUxvZ0lkKSkgewog\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIExPRy5pbmZvKCJFeHRyYWN0aW5nIGVudHJ5IGxvZyBtZXRhIGZy\nb20gZW50cnlMb2dJZDogIiArIGVudHJ5TG9nSWQpOwoKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIC8vIFJlYWQgdGhyb3VnaCB0aGUgZW50\ncnkgbG9nIGZpbGUgYW5kIGV4dHJhY3QgdGhlIGVudHJ5IGxvZyBtZXRhCiAg\nICAgICAgICAgICAgICBFbnRyeUxvZ01ldGFkYXRhIGVudHJ5TG9nTWV0YSA9\nIGV4dHJhY3RNZXRhRnJvbUVudHJ5TG9nKGVudHJ5TG9nZ2VyLCBlbnRyeUxv\nZ0lkKTsKICAgICAgICAgICAgICAgIGVudHJ5TG9nTWV0YU1hcC5wdXQoZW50\ncnlMb2dJZCwgZW50cnlMb2dNZXRhKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgaGFzRXhjZXB0aW9u\nV2hlblNjYW4gPSB0cnVlOwogICAgICAgICAgICAgICAgTE9HLndhcm4oIlBy\nZW1hdHVyZSBleGNlcHRpb24gd2hlbiBwcm9jZXNzaW5nICIgKyBlbnRyeUxv\nZ0lkICsKICAgICAgICAgICAgICAgICAgICAgICAgICIgcmVjb3Zlcnkgd2ls\nbCB0YWtlIGNhcmUgb2YgdGhlIHByb2JsZW0iLCBlKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gaWYgc2NhbiBmYWlsZWQgb24gc29tZSBlbnRy\neSBsb2csIHdlIGRvbid0IG1vdmUgJ3NjYW5uZWRMb2dJZCcgdG8gbmV4dCBp\nZAogICAgICAgICAgICAvLyBpZiBzY2FuIHN1Y2NlZWQsIHdlIGRvbid0IG5l\nZWQgdG8gc2NhbiBpdCBhZ2FpbiBkdXJpbmcgbmV4dCBnYyBydW4sCiAgICAg\nICAgICAgIC8vIHdlIG1vdmUgJ3NjYW5uZWRMb2dJZCcgdG8gbmV4dCBpZAog\nICAgICAgICAgICBpZiAoIWhhc0V4Y2VwdGlvbldoZW5TY2FuKSB7CiAgICAg\nICAgICAgICAgICArK3NjYW5uZWRMb2dJZDsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gZW50cnlMb2dNZXRhTWFwOwogICAgfQoK\nICAgIHN0YXRpYyBFbnRyeUxvZ01ldGFkYXRhIGV4dHJhY3RNZXRhRnJvbUVu\ndHJ5TG9nKEVudHJ5TG9nZ2VyIGVudHJ5TG9nZ2VyLCBsb25nIGVudHJ5TG9n\nSWQpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\nRW50cnlMb2dNZXRhZGF0YSBlbnRyeUxvZ01ldGEgPSBuZXcgRW50cnlMb2dN\nZXRhZGF0YShlbnRyeUxvZ0lkKTsKICAgICAgICBFeHRyYWN0aW9uU2Nhbm5l\nciBzY2FubmVyID0gbmV3IEV4dHJhY3Rpb25TY2FubmVyKGVudHJ5TG9nTWV0\nYSk7CiAgICAgICAgLy8gUmVhZCB0aHJvdWdoIHRoZSBlbnRyeSBsb2cgZmls\nZSBhbmQgZXh0cmFjdCB0aGUgZW50cnkgbG9nIG1ldGEKICAgICAgICBlbnRy\neUxvZ2dlci5zY2FuRW50cnlMb2coZW50cnlMb2dJZCwgc2Nhbm5lcik7CiAg\nICAgICAgTE9HLmluZm8oIlJldHJpZXZlZCBlbnRyeSBsb2cgbWV0YSBkYXRh\nIGVudHJ5TG9nSWQ6ICIKICAgICAgICAgICAgICAgICArIGVudHJ5TG9nSWQg\nKyAiLCBtZXRhOiAiICsgZW50cnlMb2dNZXRhKTsKICAgICAgICByZXR1cm4g\nZW50cnlMb2dNZXRhOwogICAgfQp9Cg==\n","encoding":"base64"}

