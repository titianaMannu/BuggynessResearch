{"sha":"cf526194e70fa3f325cec99c5ba60d267f6a544c","node_id":"MDQ6QmxvYjE1NzU5NTY6Y2Y1MjYxOTRlNzBmYTNmMzI1Y2VjOTljNWJhNjBkMjY3ZjZhNTQ0Yw==","size":33449,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/cf526194e70fa3f325cec99c5ba60d267f6a544c","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwpp\nbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRy\neTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNC\nb29sZWFuOwoKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLmFubm90YXRpb25z\nLlZpc2libGVGb3JUZXN0aW5nOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLlNuYXBzaG90TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmJvb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5MZWRnZXJEaXJzTGlz\ndGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkxl\nZGdlckRpcnNNYW5hZ2VyLk5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIEltcGxlbWVudGF0aW9u\nIG9mIExlZGdlckNhY2hlIGludGVyZmFjZS4KICogVGhpcyBjbGFzcyBzZXJ2\nZXMgdHdvIHB1cnBvc2VzLgogKi8KcHVibGljIGNsYXNzIExlZGdlckNhY2hl\nSW1wbCBpbXBsZW1lbnRzIExlZGdlckNhY2hlIHsKICAgIHByaXZhdGUgZmlu\nYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihMZWRnZXJEZXNjcmlwdG9yLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBJRFggPSAiLmlkeCI7CiAgICBzdGF0aWMgZmluYWwg\nU3RyaW5nIFJMT0MgPSAiLnJsb2MiOwoKICAgIHByaXZhdGUgTGVkZ2VyRGly\nc01hbmFnZXIgbGVkZ2VyRGlyc01hbmFnZXI7CiAgICBmaW5hbCBwcml2YXRl\nIEF0b21pY0Jvb2xlYW4gc2hvdWxkUmVsb2NhdGVJbmRleEZpbGUgPSBuZXcg\nQXRvbWljQm9vbGVhbihmYWxzZSk7CgogICAgcHVibGljIExlZGdlckNhY2hl\nSW1wbChTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYsIFNuYXBzaG90TWFwPExv\nbmcsIEJvb2xlYW4+IGFjdGl2ZUxlZGdlcnMsCiAgICAgICAgICAgIExlZGdl\nckRpcnNNYW5hZ2VyIGxlZGdlckRpcnNNYW5hZ2VyKQogICAgICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRoaXMubGVkZ2VyRGlyc01h\nbmFnZXIgPSBsZWRnZXJEaXJzTWFuYWdlcjsKICAgICAgICB0aGlzLm9wZW5G\naWxlTGltaXQgPSBjb25mLmdldE9wZW5GaWxlTGltaXQoKTsKICAgICAgICB0\naGlzLnBhZ2VTaXplID0gY29uZi5nZXRQYWdlU2l6ZSgpOwogICAgICAgIHRo\naXMuZW50cmllc1BlclBhZ2UgPSBwYWdlU2l6ZSAvIDg7CgogICAgICAgIGlm\nIChjb25mLmdldFBhZ2VMaW1pdCgpIDw9IDApIHsKICAgICAgICAgICAgLy8g\nYWxsb2NhdGUgaGFsZiBvZiB0aGUgbWVtb3J5IHRvIHRoZSBwYWdlIGNhY2hl\nCiAgICAgICAgICAgIHRoaXMucGFnZUxpbWl0ID0gKGludCkoKFJ1bnRpbWUu\nZ2V0UnVudGltZSgpLm1heE1lbW9yeSgpIC8gMykgLyB0aGlzLnBhZ2VTaXpl\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2VMaW1p\ndCA9IGNvbmYuZ2V0UGFnZUxpbWl0KCk7CiAgICAgICAgfQogICAgICAgIExP\nRy5pbmZvKCJtYXhNZW1vcnkgPSAiICsgUnVudGltZS5nZXRSdW50aW1lKCku\nbWF4TWVtb3J5KCkpOwogICAgICAgIExPRy5pbmZvKCJvcGVuRmlsZUxpbWl0\nIGlzICIgKyBvcGVuRmlsZUxpbWl0ICsgIiwgcGFnZVNpemUgaXMgIiArIHBh\nZ2VTaXplICsgIiwgcGFnZUxpbWl0IGlzICIgKyBwYWdlTGltaXQpOwogICAg\nICAgIHRoaXMuYWN0aXZlTGVkZ2VycyA9IGFjdGl2ZUxlZGdlcnM7CiAgICAg\nICAgLy8gUmV0cmlldmUgYWxsIG9mIHRoZSBhY3RpdmUgbGVkZ2Vycy4KICAg\nICAgICBnZXRBY3RpdmVMZWRnZXJzKCk7CiAgICAgICAgbGVkZ2VyRGlyc01h\nbmFnZXIuYWRkTGVkZ2VyRGlyc0xpc3RlbmVyKGdldExlZGdlckRpcnNMaXN0\nZW5lcigpKTsKICAgIH0KICAgIC8qKgogICAgICogdGhlIGxpc3Qgb2YgcG90\nZW50aWFsbHkgY2xlYW4gbGVkZ2VycwogICAgICovCiAgICBMaW5rZWRMaXN0\nPExvbmc+IGNsZWFuTGVkZ2VycyA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7\nCgogICAgLyoqCiAgICAgKiB0aGUgbGlzdCBvZiBwb3RlbnRpYWxseSBkaXJ0\neSBsZWRnZXJzCiAgICAgKi8KICAgIExpbmtlZExpc3Q8TG9uZz4gZGlydHlM\nZWRnZXJzID0gbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsKCiAgICBIYXNoTWFw\nPExvbmcsIEZpbGVJbmZvPiBmaWxlSW5mb0NhY2hlID0gbmV3IEhhc2hNYXA8\nTG9uZywgRmlsZUluZm8+KCk7CgogICAgTGlua2VkTGlzdDxMb25nPiBvcGVu\nTGVkZ2VycyA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7CgogICAgLy8gTWFu\nYWdlIGFsbCBhY3RpdmUgbGVkZ2VycyBpbiBMZWRnZXJNYW5hZ2VyCiAgICAv\nLyBzbyBMZWRnZXJNYW5hZ2VyIGhhcyBrbm93bGVkZ2UgdG8gZ2FyYmFnZSBj\nb2xsZWN0IGluYWN0aXZlL2RlbGV0ZWQgbGVkZ2VycwogICAgZmluYWwgU25h\ncHNob3RNYXA8TG9uZywgQm9vbGVhbj4gYWN0aXZlTGVkZ2VyczsKCiAgICBm\naW5hbCBpbnQgb3BlbkZpbGVMaW1pdDsKICAgIGZpbmFsIGludCBwYWdlU2l6\nZTsKICAgIGZpbmFsIGludCBwYWdlTGltaXQ7CiAgICBmaW5hbCBpbnQgZW50\ncmllc1BlclBhZ2U7CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHBhZ2Ugc2l6\nZSB1c2VkIGluIGxlZGdlciBjYWNoZQogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFBhZ2VTaXplKCkgewogICAgICAgIHJldHVybiBwYWdlU2l6ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4gZW50cmllcyBwZXIgcGFnZSB1\nc2VkIGluIGxlZGdlciBjYWNoZQogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndEVudHJpZXNQZXJQYWdlKCkgewogICAgICAgIHJldHVybiBlbnRyaWVzUGVy\nUGFnZTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4gcGFnZSBsaW1p\ndGF0aW9uIGluIGxlZGdlciBjYWNoZQogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFBhZ2VMaW1pdCgpIHsKICAgICAgICByZXR1cm4gcGFnZUxpbWl0Owog\nICAgfQoKICAgIC8vIFRoZSBudW1iZXIgb2YgcGFnZXMgdGhhdCBoYXZlIGFj\ndHVhbGx5IGJlZW4gdXNlZAogICAgcHJpdmF0ZSBpbnQgcGFnZUNvdW50ID0g\nMDsKICAgIEhhc2hNYXA8TG9uZywgSGFzaE1hcDxMb25nLExlZGdlckVudHJ5\nUGFnZT4+IHBhZ2VzID0gbmV3IEhhc2hNYXA8TG9uZywgSGFzaE1hcDxMb25n\nLExlZGdlckVudHJ5UGFnZT4+KCk7CgogICAgLyoqCiAgICAgKiBAcmV0dXJu\nIG51bWJlciBvZiBwYWdlIHVzZWQgaW4gbGVkZ2VyIGNhY2hlCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0TnVtVXNlZFBhZ2VzKCkgewogICAgICAgIHJl\ndHVybiBwYWdlQ291bnQ7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHB1dElu\ndG9UYWJsZShIYXNoTWFwPExvbmcsIEhhc2hNYXA8TG9uZyxMZWRnZXJFbnRy\neVBhZ2U+PiB0YWJsZSwgTGVkZ2VyRW50cnlQYWdlIGxlcCkgewogICAgICAg\nIEhhc2hNYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdlPiBtYXAgPSB0YWJsZS5n\nZXQobGVwLmdldExlZGdlcigpKTsKICAgICAgICBpZiAobWFwID09IG51bGwp\nIHsKICAgICAgICAgICAgbWFwID0gbmV3IEhhc2hNYXA8TG9uZywgTGVkZ2Vy\nRW50cnlQYWdlPigpOwogICAgICAgICAgICB0YWJsZS5wdXQobGVwLmdldExl\nZGdlcigpLCBtYXApOwogICAgICAgIH0KICAgICAgICBtYXAucHV0KGxlcC5n\nZXRGaXJzdEVudHJ5KCksIGxlcCk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgTGVkZ2VyRW50cnlQYWdlIGdldEZyb21UYWJsZShIYXNoTWFwPExvbmcs\nIEhhc2hNYXA8TG9uZyxMZWRnZXJFbnRyeVBhZ2U+PiB0YWJsZSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9u\nZyBsZWRnZXIsIExvbmcgZmlyc3RFbnRyeSkgewogICAgICAgIEhhc2hNYXA8\nTG9uZywgTGVkZ2VyRW50cnlQYWdlPiBtYXAgPSB0YWJsZS5nZXQobGVkZ2Vy\nKTsKICAgICAgICBpZiAobWFwICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0\ndXJuIG1hcC5nZXQoZmlyc3RFbnRyeSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwcm90ZWN0ZWQg\nTGVkZ2VyRW50cnlQYWdlIGdldExlZGdlckVudHJ5UGFnZShMb25nIGxlZGdl\nciwgTG9uZyBmaXJzdEVudHJ5LCBib29sZWFuIG9ubHlEaXJ0eSkgewogICAg\nICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRGcm9tVGFibGUocGFnZXMs\nIGxlZGdlciwgZmlyc3RFbnRyeSk7CiAgICAgICAgaWYgKGxlcCA9PSBudWxs\nKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgbGVwLnVzZVBhZ2UoKTsKCiAgICAgICAgaWYgKG9ubHlEaXJ0eSAmJiBs\nZXAuaXNDbGVhbigpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBsZXA7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKiAKICAgICAqIEdyYWIgbGVkZ2VyIGVudHJ5IHBh\nZ2Ugd2hvc2UgZmlyc3QgZW50cnkgaXMgPGNvZGU+cGFnZUVudHJ5PC9jb2Rl\nPi4KICAgICAqCiAgICAgKiBJZiB0aGUgcGFnZSBkb2Vzbid0IGV4aXN0ZWQg\nYmVmb3JlLCB3ZSBhbGxvY2F0ZSBhIG1lbW9yeSBwYWdlLgogICAgICogT3Ro\nZXJ3aXNlLCB3ZSBncmFiIGEgY2xlYW4gcGFnZSBhbmQgcmVhZCBpdCBmcm9t\nIGRpc2suCiAgICAgKgogICAgICogQHBhcmFtIGxlZGdlcgogICAgICogICAg\nICAgICAgTGVkZ2VyIElkCiAgICAgKiBAcGFyYW0gcGFnZUVudHJ5CiAgICAg\nKiAgICAgICAgICBTdGFydCBlbnRyeSBvZiB0aGlzIGVudHJ5IHBhZ2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgTGVkZ2VyRW50cnlQYWdlIGdyYWJMZWRnZXJF\nbnRyeVBhZ2UobG9uZyBsZWRnZXIsIGxvbmcgcGFnZUVudHJ5KSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBn\ncmFiQ2xlYW5QYWdlKGxlZGdlciwgcGFnZUVudHJ5KTsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBzaG91bGQgdXBkYXRlIHBhZ2UgYmVmb3JlIHdl\nIHB1dCBpdCBpbnRvIHRhYmxlCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3\nZSB3b3VsZCBwdXQgYW4gZW1wdHkgcGFnZSBpbiBpdAogICAgICAgICAgICB1\ncGRhdGVQYWdlKGxlcCk7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCh0aGlz\nKSB7CiAgICAgICAgICAgICAgICBwdXRJbnRvVGFibGUocGFnZXMsIGxlcCk7\nCiAgICAgICAgICAgIH0gICAKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBpZSkgewogICAgICAgICAgICAvLyBpZiB3ZSBncmFiIGEgY2xlYW4gcGFn\nZSwgYnV0IGZhaWxlZCB0byB1cGRhdGUgdGhlIHBhZ2UKICAgICAgICAgICAg\nLy8gd2UgYXJlIGV4aGF1c3RpbmcgdGhlIGNvdW50IG9mIGxlZGdlciBlbnRy\neSBwYWdlcy4KICAgICAgICAgICAgLy8gc2luY2UgdGhpcyBwYWdlIHdpbGwg\nYmUgbmV2ZXIgdXNlZCwgc28gd2UgbmVlZCB0byBkZWNyZW1lbnQKICAgICAg\nICAgICAgLy8gcGFnZSBjb3VudCBvZiBsZWRnZXIgY2FjaGUuCiAgICAgICAg\nICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIC0tcGFnZUNvdW50OwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRocm93IGllOyAKICAgICAgICB9ICAg\nCiAgICAgICAgcmV0dXJuIGxlcDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIHB1dEVudHJ5T2Zmc2V0KGxvbmcgbGVkZ2VyLCBsb25n\nIGVudHJ5LCBsb25nIG9mZnNldCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBpbnQgb2Zmc2V0SW5QYWdlID0gKGludCkgKGVudHJ5ICUgZW50cmll\nc1BlclBhZ2UpOwogICAgICAgIC8vIGZpbmQgdGhlIGlkIG9mIHRoZSBmaXJz\ndCBlbnRyeSBvZiB0aGUgcGFnZSB0aGF0IGhhcyB0aGUgZW50cnkKICAgICAg\nICAvLyB3ZSBhcmUgbG9va2luZyBmb3IKICAgICAgICBsb25nIHBhZ2VFbnRy\neSA9IGVudHJ5LW9mZnNldEluUGFnZTsKICAgICAgICBMZWRnZXJFbnRyeVBh\nZ2UgbGVwID0gZ2V0TGVkZ2VyRW50cnlQYWdlKGxlZGdlciwgcGFnZUVudHJ5\nLCBmYWxzZSk7CiAgICAgICAgaWYgKGxlcCA9PSBudWxsKSB7CiAgICAgICAg\nICAgIGxlcCA9IGdyYWJMZWRnZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50\ncnkpOyAKICAgICAgICB9CiAgICAgICAgaWYgKGxlcCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGxlcC5zZXRPZmZzZXQob2Zmc2V0LCBvZmZzZXRJblBhZ2Uq\nOCk7CiAgICAgICAgICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIGxvbmcgZ2V0RW50cnlPZmZzZXQobG9uZyBsZWRnZXIsIGxvbmcg\nZW50cnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaW50IG9mZnNl\ndEluUGFnZSA9IChpbnQpIChlbnRyeSVlbnRyaWVzUGVyUGFnZSk7CiAgICAg\nICAgLy8gZmluZCB0aGUgaWQgb2YgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBw\nYWdlIHRoYXQgaGFzIHRoZSBlbnRyeQogICAgICAgIC8vIHdlIGFyZSBsb29r\naW5nIGZvcgogICAgICAgIGxvbmcgcGFnZUVudHJ5ID0gZW50cnktb2Zmc2V0\nSW5QYWdlOwogICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRMZWRn\nZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50cnksIGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAobGVwID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGxlcCA9IGdyYWJMZWRnZXJFbnRyeVBhZ2UobGVkZ2VyLCBw\nYWdlRW50cnkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBs\nZXAuZ2V0T2Zmc2V0KG9mZnNldEluUGFnZSo4KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAobGVwICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBTdHJpbmcgZ2V0TGVkZ2VyTmFtZShsb25nIGxlZGdl\ncklkKSB7CiAgICAgICAgaW50IHBhcmVudCA9IChpbnQpIChsZWRnZXJJZCAm\nIDB4ZmYpOwogICAgICAgIGludCBncmFuZFBhcmVudCA9IChpbnQpICgobGVk\nZ2VySWQgJiAweGZmMDApID4+IDgpOwogICAgICAgIFN0cmluZ0J1aWxkZXIg\nc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLmFwcGVuZChJ\nbnRlZ2VyLnRvSGV4U3RyaW5nKGdyYW5kUGFyZW50KSk7CiAgICAgICAgc2Iu\nYXBwZW5kKCcvJyk7CiAgICAgICAgc2IuYXBwZW5kKEludGVnZXIudG9IZXhT\ndHJpbmcocGFyZW50KSk7CiAgICAgICAgc2IuYXBwZW5kKCcvJyk7CiAgICAg\nICAgc2IuYXBwZW5kKExvbmcudG9IZXhTdHJpbmcobGVkZ2VySWQpKTsKICAg\nICAgICBzYi5hcHBlbmQoSURYKTsKICAgICAgICByZXR1cm4gc2IudG9TdHJp\nbmcoKTsKICAgIH0KCiAgICBGaWxlSW5mbyBnZXRGaWxlSW5mbyhMb25nIGxl\nZGdlciwgYnl0ZSBtYXN0ZXJLZXlbXSkgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBzeW5jaHJvbml6ZWQoZmlsZUluZm9DYWNoZSkgewogICAgICAg\nICAgICBGaWxlSW5mbyBmaSA9IGZpbGVJbmZvQ2FjaGUuZ2V0KGxlZGdlcik7\nCiAgICAgICAgICAgIGlmIChmaSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBGaWxlIGxmID0gZmluZEluZGV4RmlsZShsZWRnZXIpOwogICAgICAgICAg\nICAgICAgaWYgKGxmID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAobWFzdGVyS2V5ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEJvb2tpZS5Ob0xlZGdlckV4Y2VwdGlvbihsZWRnZXIp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBs\nZiA9IGdldE5ld0xlZGdlckluZGV4RmlsZShsZWRnZXIsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIC8vIEEgbmV3IGxlZGdlciBpbmRleCBmaWxlIGhh\ncyBiZWVuIGNyZWF0ZWQgZm9yIHRoaXMgQm9va2llLgogICAgICAgICAgICAg\nICAgICAgIC8vIEFkZCB0aGlzIG5ldyBsZWRnZXIgdG8gdGhlIHNldCBvZiBh\nY3RpdmUgbGVkZ2Vycy4KICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIk5ldyBsZWRnZXIgaW5kZXggZmlsZSBjcmVhdGVkIGZvciBsZWRnZXJJZDog\ne30iLCBsZWRnZXIpOwogICAgICAgICAgICAgICAgICAgIGFjdGl2ZUxlZGdl\ncnMucHV0KGxlZGdlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBldmljdEZpbGVJbmZvSWZOZWNlc3NhcnkoKTsKICAgICAg\nICAgICAgICAgIGZpID0gbmV3IEZpbGVJbmZvKGxmLCBtYXN0ZXJLZXkpOwog\nICAgICAgICAgICAgICAgaWYgKGxlZGdlckRpcnNNYW5hZ2VyLmlzRGlyRnVs\nbChnZXRMZWRnZXJEaXJGb3JMZWRnZXIoZmkpKSkgewogICAgICAgICAgICAg\nICAgICAgIG1vdmVMZWRnZXJJbmRleEZpbGUobGVkZ2VyLCBmaSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaWxlSW5mb0NhY2hlLnB1\ndChsZWRnZXIsIGZpKTsKICAgICAgICAgICAgICAgIG9wZW5MZWRnZXJzLmFk\nZChsZWRnZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaS51c2UoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gZmk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2V0IGEgbmV3IGluZGV4IGZpbGUgZm9yIGxlZGdl\nciBleGNsdWRpbmcgZGlyZWN0b3J5IDxjb2RlPmV4Y2x1ZGVkRGlyPC9jb2Rl\nPi4KICAgICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VyCiAgICAgKiAgICAgICAg\nICBMZWRnZXIgaWQuCiAgICAgKiBAcGFyYW0gZXhjbHVkZWREaXIKICAgICAq\nICAgICAgICAgIFRoZSBsZWRnZXIgZGlyZWN0b3J5IHRvIGV4Y2x1ZGUuCiAg\nICAgKiBAcmV0dXJuIG5ldyBpbmRleCBmaWxlIG9iamVjdC4KICAgICAqIEB0\naHJvd3MgTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlvbiBpZiB0aGVyZSBp\ncyBubyB3cml0YWJsZSBkaXIgYXZhaWxhYmxlLgogICAgICovCiAgICBwcml2\nYXRlIEZpbGUgZ2V0TmV3TGVkZ2VySW5kZXhGaWxlKExvbmcgbGVkZ2VyLCBG\naWxlIGV4Y2x1ZGVkRGlyKQogICAgdGhyb3dzIE5vV3JpdGFibGVMZWRnZXJE\naXJFeGNlcHRpb24gewogICAgICAgIEZpbGUgZGlyID0gbGVkZ2VyRGlyc01h\nbmFnZXIucGlja1JhbmRvbVdyaXRhYmxlRGlyKGV4Y2x1ZGVkRGlyKTsKICAg\nICAgICBTdHJpbmcgbGVkZ2VyTmFtZSA9IGdldExlZGdlck5hbWUobGVkZ2Vy\nKTsKICAgICAgICByZXR1cm4gbmV3IEZpbGUoZGlyLCBsZWRnZXJOYW1lKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgdXBkYXRlUGFnZShMZWRnZXJFbnRy\neVBhZ2UgbGVwKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICgh\nbGVwLmlzQ2xlYW4oKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oIlRyeWluZyB0byB1cGRhdGUgYSBkaXJ0eSBwYWdlIik7CiAgICAg\nICAgfQogICAgICAgIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBmaSA9IGdldEZpbGVJbmZvKGxlcC5nZXRMZWRnZXIo\nKSwgbnVsbCk7CiAgICAgICAgICAgIGxvbmcgcG9zID0gbGVwLmdldEZpcnN0\nRW50cnkoKSo4OwogICAgICAgICAgICBpZiAocG9zID49IGZpLnNpemUoKSkg\newogICAgICAgICAgICAgICAgbGVwLnplcm9QYWdlKCk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXAucmVhZFBhZ2UoZmkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKGZpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2Uo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIExlZGdlckRpcnNMaXN0ZW5lciBnZXRMZWRnZXJEaXJzTGlzdGVuZXIoKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJEaXJzTGlzdGVuZXIoKSB7CiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBk\naXNrRnVsbChGaWxlIGRpc2spIHsKICAgICAgICAgICAgICAgIC8vIElmIHRo\nZSBjdXJyZW50IGVudHJ5IGxvZyBkaXNrIGlzIGZ1bGwsIHRoZW4gY3JlYXRl\nIG5ldyBlbnRyeQogICAgICAgICAgICAgICAgLy8gbG9nLgogICAgICAgICAg\nICAgICAgc2hvdWxkUmVsb2NhdGVJbmRleEZpbGUuc2V0KHRydWUpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgZGlza0ZhaWxlZChGaWxlIGRpc2spIHsKICAgICAgICAg\nICAgICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxlIGhlcmUuIFdpbGwgYmUgaGFu\nZGxlZCBpbiBCb29raWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFsbERpc2tzRnVsbCgp\nIHsKICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxlIGhlcmUu\nIFdpbGwgYmUgaGFuZGxlZCBpbiBCb29raWUKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGZh\ndGFsRXJyb3IoKSB7CiAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIHRvIGhh\nbmRsZSBoZXJlLiBXaWxsIGJlIGhhbmRsZWQgaW4gQm9va2llCiAgICAgICAg\nICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgZmx1c2hMZWRnZXIoYm9vbGVhbiBkb0FsbCkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBzeW5jaHJvbml6ZWQoZGlydHlMZWRnZXJz\nKSB7CiAgICAgICAgICAgIGlmIChkaXJ0eUxlZGdlcnMuaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAg\nICAgICAgICAgICAgIGZvcihMb25nIGw6IHBhZ2VzLmtleVNldCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLnRyYWNlKCJB\nZGRpbmcge30gdG8gZGlydHkgcGFnZXMiLCBMb25nLnRvSGV4U3RyaW5nKGwp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICBkaXJ0eUxlZGdlcnMuYWRkKGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nICAgICBpZiAoZGlydHlMZWRnZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nc2hvdWxkUmVsb2NhdGVJbmRleEZpbGUuZ2V0KCkpIHsKICAgICAgICAgICAg\nICAgIC8vIGlmIHNvbWUgbmV3IGRpciBkZXRlY3RlZCBhcyBmdWxsLCB0aGVu\nIG1vdmUgYWxsIGNvcnJlc3BvbmRpbmcKICAgICAgICAgICAgICAgIC8vIG9w\nZW4gaW5kZXggZmlsZXMgdG8gbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAg\nICBmb3IgKExvbmcgbCA6IGRpcnR5TGVkZ2VycykgewogICAgICAgICAgICAg\nICAgICAgIEZpbGVJbmZvIGZpID0gZ2V0RmlsZUluZm8obCwgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgRmlsZSBjdXJyZW50RGlyID0gZ2V0TGVkZ2Vy\nRGlyRm9yTGVkZ2VyKGZpKTsKICAgICAgICAgICAgICAgICAgICBpZiAobGVk\nZ2VyRGlyc01hbmFnZXIuaXNEaXJGdWxsKGN1cnJlbnREaXIpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIG1vdmVMZWRnZXJJbmRleEZpbGUobCwgZmkp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHNob3VsZFJlbG9jYXRlSW5kZXhGaWxlLnNldChmYWxz\nZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdoaWxlKCFkaXJ0eUxl\nZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBMb25nIGwgPSBk\naXJ0eUxlZGdlcnMucmVtb3ZlRmlyc3QoKTsKCiAgICAgICAgICAgICAgICBm\nbHVzaExlZGdlcihsKTsKCiAgICAgICAgICAgICAgICBpZiAoIWRvQWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAvLyBZaWVsZC4gaWYgd2UgYXJlIGRvaW5nIGFs\nbCB0aGUgbGVkZ2VycyB3ZSBkb24ndCB3YW50IHRvIGJsb2NrIG90aGVyIGZs\ndXNoZXMgdGhhdAogICAgICAgICAgICAgICAgLy8gbmVlZCB0byBoYXBwZW4K\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZGly\ndHlMZWRnZXJzLndhaXQoMSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8ganVzdCBwYXNzIGl0IG9uCiAgICAgICAgICAgICAgICAgICAgVGhyZWFk\nLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEdldCB0aGUgbGVkZ2VyIGRpcmVjdG9yeSB0aGF0IHRoZSBsZWRnZXIg\naW5kZXggYmVsb25ncyB0by4KICAgICAqCiAgICAgKiBAcGFyYW0gZmkgRmls\nZSBpbmZvIG9mIGEgbGVkZ2VyCiAgICAgKiBAcmV0dXJuIGxlZGdlciBkaXJl\nY3RvcnkgdGhhdCB0aGUgbGVkZ2VyIGJlbG9uZ3MgdG8uCiAgICAgKi8KICAg\nIHByaXZhdGUgRmlsZSBnZXRMZWRnZXJEaXJGb3JMZWRnZXIoRmlsZUluZm8g\nZmkpIHsKICAgICAgICByZXR1cm4gZmkuZ2V0TGYoKS5nZXRQYXJlbnRGaWxl\nKCkuZ2V0UGFyZW50RmlsZSgpLmdldFBhcmVudEZpbGUoKTsKICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgbW92ZUxlZGdlckluZGV4RmlsZShMb25nIGwsIEZp\nbGVJbmZvIGZpKSB0aHJvd3MgTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlv\nbiwgSU9FeGNlcHRpb24gewogICAgICAgIEZpbGUgbmV3TGVkZ2VySW5kZXhG\naWxlID0gZ2V0TmV3TGVkZ2VySW5kZXhGaWxlKGwsIGdldExlZGdlckRpckZv\nckxlZGdlcihmaSkpOwogICAgICAgIGZpLm1vdmVUb05ld0xvY2F0aW9uKG5l\nd0xlZGdlckluZGV4RmlsZSwgZmkuZ2V0U2l6ZVNpbmNlTGFzdHdyaXRlKCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogRmx1c2ggYSBzcGVjaWZpZWQgbGVk\nZ2VyCiAgICAgKgogICAgICogQHBhcmFtIGwKICAgICAqICAgICAgICAgIExl\nZGdlciBJZAogICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgZmx1c2hMZWRnZXIobG9uZyBsKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIExpbmtlZExpc3Q8TG9uZz4gZmlyc3RFbnRy\neUxpc3Q7CiAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAg\nICAgSGFzaE1hcDxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+IHBhZ2VNYXAgPSBw\nYWdlcy5nZXQobCk7CiAgICAgICAgICAgIGlmIChwYWdlTWFwID09IG51bGwg\nfHwgcGFnZU1hcC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIEZpbGVJ\nbmZvIGZpID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgZmkgPSBnZXRGaWxlSW5mbyhsLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICBmaS5mbHVzaEhlYWRlcigpOwogICAgICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAh\nPSBmaSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGZpcnN0RW50cnlMaXN0ID0gbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsKICAg\nICAgICAgICAgZm9yKE1hcC5FbnRyeTxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+\nIGVudHJ5OiBwYWdlTWFwLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgICAg\nIExlZGdlckVudHJ5UGFnZSBsZXAgPSBlbnRyeS5nZXRWYWx1ZSgpOwogICAg\nICAgICAgICAgICAgaWYgKGxlcC5pc0NsZWFuKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cudHJhY2UoIlBhZ2UgaXMgY2xlYW4ge30iLCBsZXApOwog\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgZmlyc3RFbnRyeUxpc3QuYWRkKGxlcC5nZXRG\naXJzdEVudHJ5KCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBpZiAoZmlyc3RFbnRyeUxpc3Quc2l6ZSgpID09IDApIHsKICAgICAgICAg\nICAgTE9HLmRlYnVnKCJOb3RoaW5nIHRvIGZsdXNoIGZvciBsZWRnZXIge30u\nIiwgbCk7CiAgICAgICAgICAgIC8vIG5vdGhpbmcgdG8gZG8KICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gTm93IGZsdXNoIGFs\nbCB0aGUgcGFnZXMgb2YgYSBsZWRnZXIKICAgICAgICBMaXN0PExlZGdlckVu\ndHJ5UGFnZT4gZW50cmllcyA9IG5ldyBBcnJheUxpc3Q8TGVkZ2VyRW50cnlQ\nYWdlPihmaXJzdEVudHJ5TGlzdC5zaXplKCkpOwogICAgICAgIEZpbGVJbmZv\nIGZpID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IoTG9u\nZyBmaXJzdEVudHJ5OiBmaXJzdEVudHJ5TGlzdCkgewogICAgICAgICAgICAg\nICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGdldExlZGdlckVudHJ5UGFnZShs\nLCBmaXJzdEVudHJ5LCB0cnVlKTsKICAgICAgICAgICAgICAgIGlmIChsZXAg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGVudHJpZXMuYWRkKGxl\ncCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgQ29sbGVjdGlvbnMuc29ydChlbnRyaWVzLCBuZXcgQ29tcGFyYXRvcjxM\nZWRnZXJFbnRyeVBhZ2U+KCkgewogICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShM\nZWRnZXJFbnRyeVBhZ2UgbzEsIExlZGdlckVudHJ5UGFnZSBvMikgewogICAg\nICAgICAgICAgICAgICAgIHJldHVybiAoaW50KShvMS5nZXRGaXJzdEVudHJ5\nKCktbzIuZ2V0Rmlyc3RFbnRyeSgpKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIEFycmF5TGlz\ndDxJbnRlZ2VyPiB2ZXJzaW9ucyA9IG5ldyBBcnJheUxpc3Q8SW50ZWdlcj4o\nZW50cmllcy5zaXplKCkpOwogICAgICAgICAgICBmaSA9IGdldEZpbGVJbmZv\nKGwsIG51bGwpOwogICAgICAgICAgICAvLyBmbHVzaCB0aGUgaGVhZGVyIGlm\nIG5lY2Vzc2FyeQogICAgICAgICAgICBmaS5mbHVzaEhlYWRlcigpOwogICAg\nICAgICAgICBpbnQgc3RhcnQgPSAwOwogICAgICAgICAgICBsb25nIGxhc3RP\nZmZzZXQgPSAtMTsKICAgICAgICAgICAgZm9yKGludCBpID0gMDsgaSA8IGVu\ndHJpZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIHZlcnNpb25z\nLmFkZChpLCBlbnRyaWVzLmdldChpKS5nZXRWZXJzaW9uKCkpOwogICAgICAg\nICAgICAgICAgaWYgKGxhc3RPZmZzZXQgIT0gLTEgJiYgKGVudHJpZXMuZ2V0\nKGkpLmdldEZpcnN0RW50cnkoKSAtIGxhc3RPZmZzZXQpICE9IGVudHJpZXNQ\nZXJQYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCB1cCBhIHNl\ncXVlbnRpYWwgbGlzdAogICAgICAgICAgICAgICAgICAgIGludCBjb3VudCA9\nIGkgLSBzdGFydDsKICAgICAgICAgICAgICAgICAgICBpZiAoY291bnQgPT0g\nMCkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQ291bnQg\nY2Fubm90IHBvc3NpYmx5IGJlIHplcm8hIik7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIHdyaXRlQnVmZmVycyhsLCBlbnRy\naWVzLCBmaSwgc3RhcnQsIGNvdW50KTsKICAgICAgICAgICAgICAgICAgICBz\ndGFydCA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBs\nYXN0T2Zmc2V0ID0gZW50cmllcy5nZXQoaSkuZ2V0Rmlyc3RFbnRyeSgpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChlbnRyaWVzLnNpemUoKS1z\ndGFydCA9PSAwICYmIGVudHJpZXMuc2l6ZSgpICE9IDApIHsKICAgICAgICAg\nICAgICAgIExPRy53YXJuKCJOb3RoaW5nIHRvIHdyaXRlLCBidXQgdGhlcmUg\nd2VyZSBlbnRyaWVzISIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdy\naXRlQnVmZmVycyhsLCBlbnRyaWVzLCBmaSwgc3RhcnQsIGVudHJpZXMuc2l6\nZSgpLXN0YXJ0KTsKICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsK\nICAgICAgICAgICAgICAgIGZvcihpbnQgaSA9IDA7IGkgPCBlbnRyaWVzLnNp\nemUoKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgTGVkZ2VyRW50cnlQ\nYWdlIGxlcCA9IGVudHJpZXMuZ2V0KGkpOwogICAgICAgICAgICAgICAgICAg\nIGxlcC5zZXRDbGVhbih2ZXJzaW9ucy5nZXQoaSkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgZm9yKExlZGdlckVudHJ5UGFnZSBsZXA6IGVudHJpZXMpIHsKICAg\nICAgICAgICAgICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmIChmaSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBmaS5yZWxlYXNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlQnVmZmVycyhMb25nIGxlZGdlciwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxMZWRnZXJFbnRy\neVBhZ2U+IGVudHJpZXMsIEZpbGVJbmZvIGZpLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpbnQgc3RhcnQsIGludCBjb3VudCkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgTE9HLnRyYWNlKCJXcml0aW5nIHt9IGJ1ZmZlcnMg\nb2Yge30iLCBjb3VudCwgTG9uZy50b0hleFN0cmluZyhsZWRnZXIpKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KICAgICAgICBCeXRlQnVmZmVyIGJ1ZmZzW10g\nPSBuZXcgQnl0ZUJ1ZmZlcltjb3VudF07CiAgICAgICAgZm9yKGludCBqID0g\nMDsgaiA8IGNvdW50OyBqKyspIHsKICAgICAgICAgICAgYnVmZnNbal0gPSBl\nbnRyaWVzLmdldChzdGFydCtqKS5nZXRQYWdlVG9Xcml0ZSgpOwogICAgICAg\nICAgICBpZiAoZW50cmllcy5nZXQoc3RhcnQraikuZ2V0TGVkZ2VyKCkgIT0g\nbGVkZ2VyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRp\nb24oIldyaXRpbmcgdG8gIiArIGxlZGdlciArICIgYnV0IHBhZ2UgYmVsb25n\ncyB0byAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyBlbnRyaWVzLmdldChzdGFydCtqKS5nZXRMZWRnZXIoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgbG9uZyB0b3RhbFdyaXR0ZW4gPSAw\nOwogICAgICAgIHdoaWxlKGJ1ZmZzW2J1ZmZzLmxlbmd0aC0xXS5yZW1haW5p\nbmcoKSA+IDApIHsKICAgICAgICAgICAgbG9uZyByYyA9IGZpLndyaXRlKGJ1\nZmZzLCBlbnRyaWVzLmdldChzdGFydCswKS5nZXRGaXJzdEVudHJ5KCkqOCk7\nCiAgICAgICAgICAgIGlmIChyYyA8PSAwKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSU9FeGNlcHRpb24oIlNob3J0IHdyaXRlIHRvIGxlZGdlciAi\nICsgbGVkZ2VyICsgIiByYyA9ICIgKyByYyk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgdG90YWxXcml0dGVuICs9IHJjOwogICAgICAgIH0KICAgICAg\nICBpZiAodG90YWxXcml0dGVuICE9IChsb25nKWNvdW50ICogKGxvbmcpcGFn\nZVNpemUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJT\naG9ydCB3cml0ZSB0byBsZWRnZXIgIiArIGxlZGdlciArICIgd3JvdGUgIiAr\nIHRvdGFsV3JpdHRlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyAiIGV4cGVjdGVkICIgKyBjb3VudCAqIHBhZ2VTaXplKTsKICAgICAg\nICB9CiAgICB9CiAgICBwcml2YXRlIExlZGdlckVudHJ5UGFnZSBncmFiQ2xl\nYW5QYWdlKGxvbmcgbGVkZ2VyLCBsb25nIGVudHJ5KSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIGlmIChlbnRyeSAlIGVudHJpZXNQZXJQYWdlICE9\nIDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbihlbnRyeSArICIgaXMgbm90IGEgbXVsdGlwbGUgb2YgIiArIGVu\ndHJpZXNQZXJQYWdlKTsKICAgICAgICB9CiAgICAgICAgb3V0ZXJMb29wOgog\nICAgICAgIHdoaWxlKHRydWUpIHsKICAgICAgICAgICAgc3luY2hyb25pemVk\nKHRoaXMpIHsKICAgICAgICAgICAgICAgIGlmIChwYWdlQ291bnQgIDwgcGFn\nZUxpbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgLy8gbGV0J3Mgc2VlIGlm\nIHdlIGNhbiBhbGxvY2F0ZSBzb21ldGhpbmcKICAgICAgICAgICAgICAgICAg\nICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gbmV3IExlZGdlckVudHJ5UGFnZShw\nYWdlU2l6ZSwgZW50cmllc1BlclBhZ2UpOwogICAgICAgICAgICAgICAgICAg\nIGxlcC5zZXRMZWRnZXIobGVkZ2VyKTsKICAgICAgICAgICAgICAgICAgICBs\nZXAuc2V0Rmlyc3RFbnRyeShlbnRyeSk7CgogICAgICAgICAgICAgICAgICAg\nIC8vIG5vdGUsIHRoaXMgd2lsbCBub3QgYmxvY2sgc2luY2UgaXQgaXMgYSBu\nZXcgcGFnZQogICAgICAgICAgICAgICAgICAgIGxlcC51c2VQYWdlKCk7CiAg\nICAgICAgICAgICAgICAgICAgcGFnZUNvdW50Kys7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGxlcDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgc3luY2hyb25pemVkKGNsZWFuTGVkZ2Vycykg\newogICAgICAgICAgICAgICAgaWYgKGNsZWFuTGVkZ2Vycy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgICAgICAgICBmbHVzaExlZGdlcihmYWxzZSk7CiAg\nICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgZm9yKExvbmcgbDogcGFnZXMua2V5U2V0KCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFuTGVkZ2Vycy5h\nZGQobCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBz\neW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgICAgIC8vIGlm\nIGxlZGdlcnMgZGVsZXRlZCBiZXR3ZWVuIGNoZWNraW5nIHBhZ2VDb3VudCBh\nbmQgcHV0dGluZwogICAgICAgICAgICAgICAgICAgIC8vIGxlZGdlcnMgaW50\nbyBjbGVhbkxlZGdlcnMgbGlzdCwgdGhlIGNsZWFuTGVkZ2VycyBsaXN0IHdv\ndWxkIGJlIGVtcHR5LgogICAgICAgICAgICAgICAgICAgIC8vIHNvIGdpdmUg\naXQgYSBjaGFuY2UgdG8gZ28gYmFjayB0byBjaGVjayBwYWdlQ291bnQgYWdh\naW4gYmVjYXVzZQogICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZUxlZGdl\nciB3b3VsZCBkZWNyZW1lbnQgcGFnZUNvdW50IHRvIHJldHVybiB0aGUgbnVt\nYmVyIG9mIHBhZ2VzCiAgICAgICAgICAgICAgICAgICAgLy8gb2NjdXBpZWQg\nYnkgZGVsZXRlZCBsZWRnZXJzLgogICAgICAgICAgICAgICAgICAgIGlmIChj\nbGVhbkxlZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlIG91dGVyTG9vcDsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgTG9uZyBjbGVhbkxlZGdlciA9IGNsZWFu\nTGVkZ2Vycy5nZXRGaXJzdCgpOwogICAgICAgICAgICAgICAgICAgIE1hcDxM\nb25nLCBMZWRnZXJFbnRyeVBhZ2U+IG1hcCA9IHBhZ2VzLmdldChjbGVhbkxl\nZGdlcik7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG1hcCA9PSBudWxs\nIHx8IG1hcC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nY2xlYW5MZWRnZXJzLnJlbW92ZUZpcnN0KCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChjbGVhbkxlZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBvdXRlckxvb3A7IAogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNsZWFuTGVkZ2VyID0gY2xlYW5MZWRnZXJzLmdldEZpcnN0KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIG1hcCA9IHBhZ2VzLmdldChjbGVhbkxlZGdl\ncik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIEl0ZXJhdG9yPE1hcC5FbnRyeTxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+PiBp\ndCA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAgICAg\nICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGl0Lm5leHQoKS5nZXRWYWx1\nZSgpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKChsZXAuaW5Vc2UoKSB8\nfCAhbGVwLmlzQ2xlYW4oKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKCFpdC5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIG5vIGNsZWFuIHBhZ2UgZm91bmQgaW4gdGhpcyBsZWRnZXIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFuTGVkZ2Vycy5yZW1vdmVG\naXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUg\nb3V0ZXJMb29wOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIGxlcCA9IGl0Lm5leHQoKS5nZXRWYWx1ZSgpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpdC5y\nZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWFwLmlzRW1wdHko\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYWdlcy5yZW1vdmUobGVw\nLmdldExlZGdlcigpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgbGVwLnVzZVBhZ2UoKTsKICAgICAgICAgICAgICAgICAg\nICBsZXAuemVyb1BhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBsZXAuc2V0\nTGVkZ2VyKGxlZGdlcik7CiAgICAgICAgICAgICAgICAgICAgbGVwLnNldEZp\ncnN0RW50cnkoZW50cnkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBs\nZXA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgbG9uZyBnZXRMYXN0\nRW50cnkobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBsb25nIGxhc3RFbnRyeSA9IDA7CiAgICAgICAgLy8gRmluZCB0aGUg\nbGFzdCBlbnRyeSBpbiB0aGUgY2FjaGUKICAgICAgICBzeW5jaHJvbml6ZWQo\ndGhpcykgewogICAgICAgICAgICBNYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdl\nPiBtYXAgPSBwYWdlcy5nZXQobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAo\nbWFwICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZvcihMZWRnZXJFbnRy\neVBhZ2UgbGVwOiBtYXAudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBpZiAobGVwLmdldEZpcnN0RW50cnkoKSArIGVudHJpZXNQZXJQYWdlIDwg\nbGFzdEVudHJ5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBs\nZXAudXNlUGFnZSgpOwogICAgICAgICAgICAgICAgICAgIGxvbmcgaGlnaGVz\ndCA9IGxlcC5nZXRMYXN0RW50cnkoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAoaGlnaGVzdCA+IGxhc3RFbnRyeSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBsYXN0RW50cnkgPSBoaWdoZXN0OwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICBsZXAucmVsZWFzZVBhZ2UoKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgRmlsZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZpID0gZ2V0RmlsZUluZm8obGVkZ2VySWQsIG51bGwpOwogICAgICAg\nICAgICBsb25nIHNpemUgPSBmaS5zaXplKCk7CiAgICAgICAgICAgIC8vIG1h\na2Ugc3VyZSB0aGUgZmlsZSBzaXplIGlzIGFsaWduZWQgd2l0aCBpbmRleCBl\nbnRyeSBzaXplCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZSBtYXkgcmVh\nZCBpbmNvcnJldCBkYXRhCiAgICAgICAgICAgIGlmICgwICE9IHNpemUgJSA4\nKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiSW5kZXggZmlsZSBvZiBs\nZWRnZXIge30gaXMgbm90IGFsaWduZWQgd2l0aCBpbmRleCBlbnRyeSBzaXpl\nLiIsIGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIHNpemUgPSBzaXplIC0g\nc2l6ZSAlIDg7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gd2UgbWF5\nIG5vdCBoYXZlIHRoZSBsYXN0IGVudHJ5IGluIHRoZSBjYWNoZQogICAgICAg\nICAgICBpZiAoc2l6ZSA+IGxhc3RFbnRyeSo4KSB7CiAgICAgICAgICAgICAg\nICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZShnZXRQYWdl\nU2l6ZSgpKTsKICAgICAgICAgICAgICAgIGxvbmcgcG9zaXRpb24gPSBzaXpl\nIC0gZ2V0UGFnZVNpemUoKTsKICAgICAgICAgICAgICAgIGlmIChwb3NpdGlv\nbiA8IDApIHsKICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbiA9IDA7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaS5yZWFkKGJiLCBw\nb3NpdGlvbik7CiAgICAgICAgICAgICAgICBiYi5mbGlwKCk7CiAgICAgICAg\nICAgICAgICBsb25nIHN0YXJ0aW5nRW50cnlJZCA9IHBvc2l0aW9uLzg7CiAg\nICAgICAgICAgICAgICBmb3IoaW50IGkgPSBnZXRFbnRyaWVzUGVyUGFnZSgp\nLTE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGJi\nLmdldExvbmcoaSo4KSAhPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChsYXN0RW50cnkgPCBzdGFydGluZ0VudHJ5SWQraSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbGFzdEVudHJ5ID0gc3RhcnRpbmdFbnRy\neUlkK2k7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgaWYgKGZpICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGZpLnJlbGVhc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcmV0dXJuIGxhc3RFbnRyeTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoaXMgbWV0aG9kIHdpbGwgbG9vayB3aXRoaW4gdGhlIGxlZGdlciBkaXJl\nY3RvcmllcyBmb3IgdGhlIGxlZGdlciBpbmRleAogICAgICogZmlsZXMuIFRo\nYXQgd2lsbCBjb21wcmlzZSB0aGUgc2V0IG9mIGFjdGl2ZSBsZWRnZXJzIHRo\naXMgcGFydGljdWxhcgogICAgICogQm9va2llU2VydmVyIGtub3dzIGFib3V0\nIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gZGVsZXRlZCBieSB0aGUgQm9va0tl\nZXBlcgogICAgICogQ2xpZW50LiBUaGlzIGlzIGNhbGxlZCBvbmx5IG9uY2Ug\nZHVyaW5nIGluaXRpYWxpemF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZ2V0QWN0aXZlTGVkZ2VycygpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gTGVkZ2VyIGluZGV4IGZpbGVzIGFyZSBzdG9yZWQgaW4gYSBm\naWxlIGhpZXJhcmNoeSB3aXRoIGEgcGFyZW50IGFuZAogICAgICAgIC8vIGdy\nYW5kUGFyZW50IGRpcmVjdG9yeS4gV2UnbGwgaGF2ZSB0byBnbyB0d28gbGV2\nZWxzIGRlZXAgaW50byB0aGVzZQogICAgICAgIC8vIGRpcmVjdG9yaWVzIHRv\nIGZpbmQgdGhlIGluZGV4IGZpbGVzLgogICAgICAgIGZvciAoRmlsZSBsZWRn\nZXJEaXJlY3RvcnkgOiBsZWRnZXJEaXJzTWFuYWdlci5nZXRBbGxMZWRnZXJE\naXJzKCkpIHsKICAgICAgICAgICAgZm9yIChGaWxlIGdyYW5kUGFyZW50IDog\nbGVkZ2VyRGlyZWN0b3J5Lmxpc3RGaWxlcygpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZ3JhbmRQYXJlbnQuaXNEaXJlY3RvcnkoKSkgewogICAgICAgICAg\nICAgICAgICAgIGZvciAoRmlsZSBwYXJlbnQgOiBncmFuZFBhcmVudC5saXN0\nRmlsZXMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50\nLmlzRGlyZWN0b3J5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZvciAoRmlsZSBpbmRleCA6IHBhcmVudC5saXN0RmlsZXMoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5kZXguaXNGaWxl\nKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8\nICghaW5kZXguZ2V0TmFtZSgpLmVuZHNXaXRoKElEWCkgJiYgIWluZGV4Lmdl\ndE5hbWUoKS5lbmRzV2l0aChSTE9DKSkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBXZSd2ZSBmb3VuZCBhIGxlZGdlciBpbmRleCBmaWxlLiBUaGUg\nZmlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hbWUg\naXMgdGhlIEhleFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsZWRnZXJJZC4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgbGVkZ2VySWRJbkhl\neCA9IGluZGV4LmdldE5hbWUoKS5yZXBsYWNlKFJMT0MsICIiKS5yZXBsYWNl\nKElEWCwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChpbmRleC5nZXROYW1lKCkuZW5kc1dpdGgoUkxPQykpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmRJbmRleEZpbGUo\nTG9uZy5wYXJzZUxvbmcobGVkZ2VySWRJbkhleCkpICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5k\nZXguZGVsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cud2FybigiRGVsZXRpbmcgdGhlIHJsb2MgZmls\nZSAiICsgaW5kZXggKyAiIGZhaWxlZCIpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBGaWxlIGRlc3QgPSBuZXcgRmlsZShp\nbmRleC5nZXRQYXJlbnRGaWxlKCksIGxlZGdlcklkSW5IZXggKyBJRFgpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFp\nbmRleC5yZW5hbWVUbyhkZXN0KSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigi\nUmVuYW1pbmcgcmxvYyBmaWxlICIgKyBpbmRleAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHRvIGlu\nZGV4IGZpbGUgaGFzIGZhaWxlZCIpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUxlZGdl\ncnMucHV0KExvbmcucGFyc2VMb25nKGxlZGdlcklkSW5IZXgsIDE2KSwgdHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBs\nZWRnZXIgaXMgZGVsZXRlZCBieSB0aGUgQm9va0tlZXBlciBDbGllbnQKICAg\nICAqIGFuZCB3ZSB3YW50IHRvIHJlbW92ZSBhbGwgcmVsZXZhbnQgZGF0YSBm\nb3IgaXQgc3RvcmVkIGluIHRoZSBMZWRnZXJDYWNoZS4KICAgICAqLwogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBkZWxldGVMZWRnZXIobG9uZyBs\nZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBMT0cuZGVi\ndWcoIkRlbGV0aW5nIGxlZGdlcklkOiB7fSIsIGxlZGdlcklkKTsKCiAgICAg\nICAgLy8gcmVtb3ZlIHBhZ2VzIGZpcnN0IHRvIGF2b2lkIHBhZ2UgZmx1c2hl\nZCB3aGVuIGRlbGV0aW5nIGZpbGUgaW5mbwogICAgICAgIHN5bmNocm9uaXpl\nZCh0aGlzKSB7CiAgICAgICAgICAgIE1hcDxMb25nLCBMZWRnZXJFbnRyeVBh\nZ2U+IGxwYWdlcyA9IHBhZ2VzLnJlbW92ZShsZWRnZXJJZCk7CiAgICAgICAg\nICAgIGlmIChudWxsICE9IGxwYWdlcykgewogICAgICAgICAgICAgICAgcGFn\nZUNvdW50IC09IGxwYWdlcy5zaXplKCk7CiAgICAgICAgICAgICAgICBpZiAo\ncGFnZUNvdW50IDwgMCkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiUGFnZSBjb3VudCBvZiBsZWRnZXIgY2FjaGUgaGFzIGJlZW4gZGVjcmVt\nZW50ZWQgdG8gYmUgbGVzcyB0aGFuIHplcm8uIik7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gRGVsZXRl\nIHRoZSBsZWRnZXIncyBpbmRleCBmaWxlIGFuZCBjbG9zZSB0aGUgRmlsZUlu\nZm8KICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgZmkgPSBnZXRGaWxlSW5mbyhsZWRnZXJJZCwgbnVsbCk7\nCiAgICAgICAgICAgIGZpLmNsb3NlKGZhbHNlKTsKICAgICAgICAgICAgZmku\nZGVsZXRlKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgLy8g\nc2hvdWxkIHJlbGVhc2UgdXNlIGNvdW50CiAgICAgICAgICAgIC8vIG90aGVy\nd2lzZSB0aGUgZmlsZSBjaGFubmVsIHdvdWxkIG5vdCBiZSBjbG9zZWQuCiAg\nICAgICAgICAgIGlmIChudWxsICE9IGZpKSB7CiAgICAgICAgICAgICAgICBm\naS5yZWxlYXNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIFJlbW92ZSBpdCBmcm9tIHRoZSBhY3RpdmUgbGVkZ2VyIG1hbmFnZXIK\nICAgICAgICBhY3RpdmVMZWRnZXJzLnJlbW92ZShsZWRnZXJJZCk7CgogICAg\nICAgIC8vIE5vdyByZW1vdmUgaXQgZnJvbSBhbGwgdGhlIG90aGVyIGxpc3Rz\nIGFuZCBtYXBzLgogICAgICAgIC8vIFRoZXNlIGRhdGEgc3RydWN0dXJlcyBu\nZWVkIHRvIGJlIHN5bmNocm9uaXplZCBmaXJzdCBiZWZvcmUgcmVtb3Zpbmcg\nZW50cmllcy4KICAgICAgICBzeW5jaHJvbml6ZWQoZmlsZUluZm9DYWNoZSkg\newogICAgICAgICAgICBmaWxlSW5mb0NhY2hlLnJlbW92ZShsZWRnZXJJZCk7\nCiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZChjbGVhbkxlZGdlcnMp\nIHsKICAgICAgICAgICAgY2xlYW5MZWRnZXJzLnJlbW92ZShsZWRnZXJJZCk7\nCiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZChkaXJ0eUxlZGdlcnMp\nIHsKICAgICAgICAgICAgZGlydHlMZWRnZXJzLnJlbW92ZShsZWRnZXJJZCk7\nCiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZChvcGVuTGVkZ2Vycykg\newogICAgICAgICAgICBvcGVuTGVkZ2Vycy5yZW1vdmUobGVkZ2VySWQpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIEZpbGUgZmluZEluZGV4Rmls\nZShsb25nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIFN0cmluZyBsZWRnZXJOYW1lID0gZ2V0TGVkZ2VyTmFtZShsZWRnZXJJZCk7\nCiAgICAgICAgZm9yIChGaWxlIGQgOiBsZWRnZXJEaXJzTWFuYWdlci5nZXRB\nbGxMZWRnZXJEaXJzKCkpIHsKICAgICAgICAgICAgRmlsZSBsZiA9IG5ldyBG\naWxlKGQsIGxlZGdlck5hbWUpOwogICAgICAgICAgICBpZiAobGYuZXhpc3Rz\nKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBsZjsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyBieXRlW10gcmVhZE1hc3RlcktleShsb25n\nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlv\nbiB7CiAgICAgICAgc3luY2hyb25pemVkKGZpbGVJbmZvQ2FjaGUpIHsKICAg\nICAgICAgICAgRmlsZUluZm8gZmkgPSBmaWxlSW5mb0NhY2hlLmdldChsZWRn\nZXJJZCk7CiAgICAgICAgICAgIGlmIChmaSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBGaWxlIGxmID0gZmluZEluZGV4RmlsZShsZWRnZXJJZCk7CiAg\nICAgICAgICAgICAgICBpZiAobGYgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBCb29raWUuTm9MZWRnZXJFeGNlcHRpb24obGVk\nZ2VySWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZXZp\nY3RGaWxlSW5mb0lmTmVjZXNzYXJ5KCk7ICAgICAgICAKICAgICAgICAgICAg\nICAgIGZpID0gbmV3IEZpbGVJbmZvKGxmLCBudWxsKTsKICAgICAgICAgICAg\nICAgIGJ5dGVbXSBrZXkgPSBmaS5nZXRNYXN0ZXJLZXkoKTsKICAgICAgICAg\nICAgICAgIGZpbGVJbmZvQ2FjaGUucHV0KGxlZGdlcklkLCBmaSk7CiAgICAg\nICAgICAgICAgICBvcGVuTGVkZ2Vycy5hZGQobGVkZ2VySWQpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gZmkuZ2V0TWFzdGVyS2V5KCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vIGV2aWN0IGZpbGUgaW5mbyBpZiBuZWNlc3NhcnkKICAgIHByaXZh\ndGUgdm9pZCBldmljdEZpbGVJbmZvSWZOZWNlc3NhcnkoKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHN5bmNocm9uaXplZCAoZmlsZUluZm9DYWNo\nZSkgewogICAgICAgICAgICBpZiAob3BlbkxlZGdlcnMuc2l6ZSgpID4gb3Bl\nbkZpbGVMaW1pdCkgewogICAgICAgICAgICAgICAgbG9uZyBsZWRnZXJUb1Jl\nbW92ZSA9IG9wZW5MZWRnZXJzLnJlbW92ZUZpcnN0KCk7CiAgICAgICAgICAg\nICAgICBMT0cuaW5mbygiTGVkZ2VyIHt9IGlzIGV2aWN0ZWQgZnJvbSBmaWxl\nIGluZm8gY2FjaGUuIiwKICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdl\nclRvUmVtb3ZlKTsKICAgICAgICAgICAgICAgIGZpbGVJbmZvQ2FjaGUucmVt\nb3ZlKGxlZGdlclRvUmVtb3ZlKS5jbG9zZSh0cnVlKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBi\nb29sZWFuIHNldEZlbmNlZChsb25nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBmaSA9IGdldEZpbGVJbmZvKGxlZGdlcklkLCBu\ndWxsKTsKICAgICAgICAgICAgaWYgKG51bGwgIT0gZmkpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBmaS5zZXRGZW5jZWQoKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgaWYgKG51bGwgIT0gZmkpIHsKICAgICAgICAgICAgICAg\nIGZpLnJlbGVhc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBib29sZWFuIGlzRmVuY2VkKGxv\nbmcgbGVkZ2VySWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmls\nZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZp\nID0gZ2V0RmlsZUluZm8obGVkZ2VySWQsIG51bGwpOwogICAgICAgICAgICBp\nZiAobnVsbCAhPSBmaSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZpLmlz\nRmVuY2VkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChudWxs\nICE9IGZpKSB7CiAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBzZXRNYXN0ZXJLZXkobG9uZyBsZWRnZXJJZCwgYnl0ZVtd\nIG1hc3RlcktleSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxl\nSW5mbyBmaSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmkg\nPSBnZXRGaWxlSW5mbyhsZWRnZXJJZCwgbWFzdGVyS2V5KTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAobnVsbCAhPSBmaSkgewogICAg\nICAgICAgICAgICAgZmkucmVsZWFzZSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xlYW4g\nbGVkZ2VyRXhpc3RzKGxvbmcgbGVkZ2VySWQpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgc3luY2hyb25pemVkKGZpbGVJbmZvQ2FjaGUpIHsKICAg\nICAgICAgICAgRmlsZUluZm8gZmkgPSBmaWxlSW5mb0NhY2hlLmdldChsZWRn\nZXJJZCk7CiAgICAgICAgICAgIGlmIChmaSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBGaWxlIGxmID0gZmluZEluZGV4RmlsZShsZWRnZXJJZCk7CiAg\nICAgICAgICAgICAgICBpZiAobGYgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBMZWRnZXJDYWNoZUJlYW4gZ2V0\nSk1YQmVhbigpIHsKICAgICAgICByZXR1cm4gbmV3IExlZGdlckNhY2hlQmVh\nbigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0TmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAi\nTGVkZ2VyQ2FjaGUiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaXNIaWRkZW4oKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgaW50\nIGdldFBhZ2VDb3VudCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBMZWRn\nZXJDYWNoZUltcGwudGhpcy5nZXROdW1Vc2VkUGFnZXMoKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyBpbnQgZ2V0UGFnZVNpemUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nTGVkZ2VyQ2FjaGVJbXBsLnRoaXMuZ2V0UGFnZVNpemUoKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyBpbnQgZ2V0T3BlbkZpbGVMaW1pdCgpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBvcGVuRmlsZUxpbWl0OwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGludCBnZXRQYWdlTGlt\naXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTGVkZ2VyQ2FjaGVJbXBs\nLnRoaXMuZ2V0UGFnZUxpbWl0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgaW50IGdldE51bUNs\nZWFuTGVkZ2VycygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjbGVhbkxl\nZGdlcnMuc2l6ZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIGludCBnZXROdW1EaXJ0eUxlZGdl\ncnMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGlydHlMZWRnZXJzLnNp\nemUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0TnVtT3BlbkxlZGdlcnMoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gb3BlbkxlZGdlcnMuc2l6ZSgpOwogICAg\nICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBzeW5jaHJvbml6ZWQgKGZpbGVJbmZvQ2FjaGUpIHsKICAgICAgICAg\nICAgZm9yIChFbnRyeTxMb25nLCBGaWxlSW5mbz4gZmlsZUluZm8gOiBmaWxl\nSW5mb0NhY2hlLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgICAgIEZpbGVJ\nbmZvIHZhbHVlID0gZmlsZUluZm8uZ2V0VmFsdWUoKTsKICAgICAgICAgICAg\nICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\ndmFsdWUuY2xvc2UodHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgZmlsZUluZm9DYWNoZS5jbGVhcigpOwogICAg\nICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

