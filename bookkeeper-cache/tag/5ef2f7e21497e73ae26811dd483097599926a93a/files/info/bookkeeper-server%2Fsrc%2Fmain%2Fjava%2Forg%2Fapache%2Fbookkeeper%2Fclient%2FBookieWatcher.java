{"sha":"3ac082cde504554fe1fd77e1a4eebab54308c073","node_id":"MDQ6QmxvYjE1NzU5NTY6M2FjMDgyY2RlNTA0NTU0ZmUxZmQ3N2UxYTRlZWJhYjU0MzA4YzA3Mw==","size":11978,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3ac082cde504554fe1fd77e1a4eebab54308c073","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNv\nZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhw\ncmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBz\ncGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq\nIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmltcG9ydCBq\nYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tl\ndEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQg\namF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5T\nZXQ7CgppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuTGlua2VkQmxvY2tp\nbmdRdWV1ZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxl\nZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLlRpbWVVbml0OwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQktFeGNlcHRpb24uQktOb3RFbm91Z2hCb29raWVzRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLkJv\nb2tLZWVwZXJDb25zdGFudHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIudXRpbC5TYWZlUnVubmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIudXRpbC5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuQXN5bmNDYWxsYmFjay5DaGlsZHJlbkNhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uLkNvZGU7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb24uTm9kZUV4\naXN0c0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpv\nb0RlZnMuSWRzOwoKLyoqCiAqIFRoaXMgY2xhc3MgaXMgcmVzcG9uc2libGUg\nZm9yIG1haW50YWluaW5nIGEgY29uc2lzdGVudCB2aWV3IG9mIHdoYXQgYm9v\na2llcwogKiBhcmUgYXZhaWxhYmxlIGJ5IHJlYWRpbmcgWm9va2VlcGVyIChh\nbmQgc2V0dGluZyB3YXRjaGVzIG9uIHRoZSBib29raWUgbm9kZXMpLgogKiBX\naGVuIGEgYm9va2llIGZhaWxzLCB0aGUgb3RoZXIgcGFydHMgb2YgdGhlIGNv\nZGUgdHVybiB0byB0aGlzIGNsYXNzIHRvIGZpbmQgYQogKiByZXBsYWNlbWVu\ndAogKgogKi8KY2xhc3MgQm9va2llV2F0Y2hlciBpbXBsZW1lbnRzIFdhdGNo\nZXIsIENoaWxkcmVuQ2FsbGJhY2sgewogICAgc3RhdGljIGZpbmFsIExvZ2dl\nciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihCb29raWVXYXRj\naGVyLmNsYXNzKTsKCiAgICAvLyBCb29raWUgcmVnaXN0cmF0aW9uIHBhdGgg\naW4gWksKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIGJvb2tpZVJlZ2lzdHJh\ndGlvblBhdGg7CiAgICBzdGF0aWMgZmluYWwgU2V0PEluZXRTb2NrZXRBZGRy\nZXNzPiBFTVBUWV9TRVQgPSBuZXcgSGFzaFNldDxJbmV0U29ja2V0QWRkcmVz\ncz4oKTsKICAgIHB1YmxpYyBzdGF0aWMgaW50IFpLX0NPTk5FQ1RfQkFDS09G\nRl9TRUMgPSAxOwoKICAgIGZpbmFsIEJvb2tLZWVwZXIgYms7CgogICAgSGFz\naFNldDxJbmV0U29ja2V0QWRkcmVzcz4ga25vd25Cb29raWVzID0gbmV3IEhh\nc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+KCk7CiAgICBmaW5hbCBTY2hlZHVs\nZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1bGVyOwoKICAgIFNhZmVSdW5uYWJs\nZSByZVJlYWRUYXNrID0gbmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUnVuKCkgewogICAg\nICAgICAgICByZWFkQm9va2llcygpOwogICAgICAgIH0KICAgIH07CiAgICBw\ncml2YXRlIFJlYWRPbmx5Qm9va2llV2F0Y2hlciByZWFkT25seUJvb2tpZVdh\ndGNoZXI7CgogICAgcHVibGljIEJvb2tpZVdhdGNoZXIoQ2xpZW50Q29uZmln\ndXJhdGlvbiBjb25mLAogICAgICAgICAgICAgICAgICAgICAgICAgU2NoZWR1\nbGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxlciwKICAgICAgICAgICAgICAg\nICAgICAgICAgIEJvb2tLZWVwZXIgYmspIHRocm93cyBLZWVwZXJFeGNlcHRp\nb24sIEludGVycnVwdGVkRXhjZXB0aW9uICB7CiAgICAgICAgdGhpcy5iayA9\nIGJrOwogICAgICAgIC8vIFpLIGJvb2tpZSByZWdpc3RyYXRpb24gcGF0aAog\nICAgICAgIHRoaXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aCA9IGNvbmYuZ2V0\nWmtBdmFpbGFibGVCb29raWVzUGF0aCgpOwogICAgICAgIHRoaXMuc2NoZWR1\nbGVyID0gc2NoZWR1bGVyOwogICAgICAgIHJlYWRPbmx5Qm9va2llV2F0Y2hl\nciA9IG5ldyBSZWFkT25seUJvb2tpZVdhdGNoZXIoY29uZiwgYmspOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRCb29raWVzKCkgewogICAgICAgIHJl\nYWRCb29raWVzKHRoaXMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRC\nb29raWVzKENoaWxkcmVuQ2FsbGJhY2sgY2FsbGJhY2spIHsKICAgICAgICBi\nay5nZXRaa0hhbmRsZSgpLmdldENoaWxkcmVuKHRoaXMuYm9va2llUmVnaXN0\ncmF0aW9uUGF0aCwgdGhpcywgY2FsbGJhY2ssIG51bGwpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZl\nbnQgZXZlbnQpIHsKICAgICAgICByZWFkQm9va2llcygpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQg\ncmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBMaXN0PFN0cmluZz4gY2hp\nbGRyZW4pIHsKCiAgICAgICAgaWYgKHJjICE9IEtlZXBlckV4Y2VwdGlvbi5D\nb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgLy9sb2dnZXIuZXJy\nb3IoIkVycm9yIHdoaWxlIHJlYWRpbmcgYm9va2llcyIsIEtlZXBlckV4Y2Vw\ndGlvbi5jcmVhdGUoQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAg\nIC8vIHRyeSB0aGUgcmVhZCBhZnRlciBhIHNlY29uZCBhZ2FpbgogICAgICAg\nICAgICBzY2hlZHVsZXIuc2NoZWR1bGUocmVSZWFkVGFzaywgWktfQ09OTkVD\nVF9CQUNLT0ZGX1NFQywgVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIEp1c3QgZXhjbHVkZSB0\naGUgJ3JlYWRvbmx5JyB6bm9kZSB0byBleGNsdWRlIHItbyBib29raWVzIGZy\nb20KICAgICAgICAvLyBhdmFpbGFibGUgbm9kZXMgbGlzdC4KICAgICAgICBj\naGlsZHJlbi5yZW1vdmUoQm9va0tlZXBlckNvbnN0YW50cy5SRUFET05MWSk7\nCgogICAgICAgIEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+IG5ld0Jvb2tp\nZUFkZHJzID0gY29udmVydFRvQm9va2llQWRkcmVzc2VzKGNoaWxkcmVuKTsK\nCiAgICAgICAgZmluYWwgSGFzaFNldDxJbmV0U29ja2V0QWRkcmVzcz4gZGVh\nZEJvb2tpZXM7CiAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAg\nICAgICAgIGRlYWRCb29raWVzID0gKEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJl\nc3M+KWtub3duQm9va2llcy5jbG9uZSgpOwogICAgICAgICAgICBkZWFkQm9v\na2llcy5yZW1vdmVBbGwobmV3Qm9va2llQWRkcnMpOwogICAgICAgICAgICAv\nLyBObyBuZWVkIHRvIGNsb3NlIHJlYWRvbmx5IGJvb2tpZSBjbGllbnRzLgog\nICAgICAgICAgICBkZWFkQm9va2llcy5yZW1vdmVBbGwocmVhZE9ubHlCb29r\naWVXYXRjaGVyLmdldFJlYWRPbmx5Qm9va2llcygpKTsKICAgICAgICAgICAg\na25vd25Cb29raWVzID0gbmV3Qm9va2llQWRkcnM7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoYmsuZ2V0Qm9va2llQ2xpZW50KCkgIT0gbnVsbCkgewogICAg\nICAgICAgICBiay5nZXRCb29raWVDbGllbnQoKS5jbG9zZUNsaWVudHMoZGVh\nZEJvb2tpZXMpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyBIYXNoU2V0PEluZXRTb2NrZXRBZGRyZXNzPiBjb252ZXJ0VG9Cb29raWVB\nZGRyZXNzZXMoTGlzdDxTdHJpbmc+IGNoaWxkcmVuKSB7CiAgICAgICAgLy8g\nUmVhZCB0aGUgYm9va2llIGFkZHJlc3NlcyBpbnRvIGEgc2V0IGZvciBlZmZp\nY2llbnQgbG9va3VwCiAgICAgICAgSGFzaFNldDxJbmV0U29ja2V0QWRkcmVz\ncz4gbmV3Qm9va2llQWRkcnMgPSBuZXcgSGFzaFNldDxJbmV0U29ja2V0QWRk\ncmVzcz4oKTsKICAgICAgICBmb3IgKFN0cmluZyBib29raWVBZGRyU3RyaW5n\nIDogY2hpbGRyZW4pIHsKICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3Mg\nYm9va2llQWRkcjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGJvb2tpZUFkZHIgPSBTdHJpbmdVdGlscy5wYXJzZUFkZHIoYm9va2llQWRk\nclN0cmluZyk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ291bGQgbm90IHBh\ncnNlIGJvb2tpZSBhZGRyZXNzOiAiICsgYm9va2llQWRkclN0cmluZyArICIs\nIGlnbm9yaW5nIHRoaXMgYm9va2llIik7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXdCb29raWVBZGRy\ncy5hZGQoYm9va2llQWRkcik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBu\nZXdCb29raWVBZGRyczsKICAgIH0KCiAgICAvKioKICAgICAqIEJsb2NrcyB1\nbnRpbCBib29raWVzIGFyZSByZWFkIGZyb20gem9va2VlcGVyLCB1c2VkIGlu\nIHRoZSB7QGxpbmsgQm9va0tlZXBlcn0gY29uc3RydWN0b3IuCiAgICAgKiBA\ndGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIEtl\nZXBlckV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWFkQm9v\na2llc0Jsb2NraW5nKCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBL\nZWVwZXJFeGNlcHRpb24gewogICAgICAgIC8vIFJlYWQgcmVhZG9ubHkgYm9v\na2llcyBmaXJzdAogICAgICAgIHJlYWRPbmx5Qm9va2llV2F0Y2hlci5yZWFk\nUk9Cb29raWVzQmxvY2tpbmcoKTsKCiAgICAgICAgZmluYWwgTGlua2VkQmxv\nY2tpbmdRdWV1ZTxJbnRlZ2VyPiBxdWV1ZSA9IG5ldyBMaW5rZWRCbG9ja2lu\nZ1F1ZXVlPEludGVnZXI+KCk7CiAgICAgICAgcmVhZEJvb2tpZXMobmV3IENo\naWxkcmVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBy\nb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwg\nTGlzdDxTdHJpbmc+IGNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgIEJvb2tpZVdhdGNoZXIudGhpcy5wcm9j\nZXNzUmVzdWx0KHJjLCBwYXRoLCBjdHgsIGNoaWxkcmVuKTsKICAgICAgICAg\nICAgICAgICAgICBxdWV1ZS5wdXQocmMpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgICAgIGxvZ2dlci5lcnJvcigiSW50ZXJydXBlZCB3aGVuIHRyeWluZyB0\nbyByZWFkIGJvb2tpZXMgaW4gYSBibG9ja2luZyBmYXNoaW9uIik7CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsK\nICAgICAgICBpbnQgcmMgPSBxdWV1ZS50YWtlKCk7CgogICAgICAgIGlmIChy\nYyAhPSBLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAg\nICAgICAgICAgIHRocm93IEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoQ29kZS5n\nZXQocmMpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcmFw\ncGVyIG92ZXIgdGhlIHtAbGluayAjZ2V0QWRkaXRpb25hbEJvb2tpZXMoU2V0\nLCBpbnQpfSBtZXRob2Qgd2hlbiB0aGVyZSBpcyBubyBleGNsdXNpb24gbGlz\ndCAob3IgZXhpc2l0aW5nIGJvb2tpZXMpCiAgICAgKiBAcGFyYW0gbnVtQm9v\na2llc05lZWRlZAogICAgICogQHJldHVybgogICAgICogQHRocm93cyBCS05v\ndEVub3VnaEJvb2tpZXNFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIEFy\ncmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gZ2V0TmV3Qm9va2llcyhpbnQg\nbnVtQm9va2llc05lZWRlZCkgdGhyb3dzIEJLTm90RW5vdWdoQm9va2llc0V4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldEFkZGl0aW9uYWxCb29raWVz\nKEVNUFRZX1NFVCwgbnVtQm9va2llc05lZWRlZCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXcmFwcGVyIG92ZXIgdGhlIHtAbGluayAjZ2V0QWRkaXRpb25h\nbEJvb2tpZXMoU2V0LCBpbnQpfSBtZXRob2Qgd2hlbiB5b3UganVzdCBuZWVk\nIDEgZXh0cmEgYm9va2llCiAgICAgKiBAcGFyYW0gZXhpc3RpbmdCb29raWVz\nCiAgICAgKiBAcmV0dXJuCiAgICAgKiBAdGhyb3dzIEJLTm90RW5vdWdoQm9v\na2llc0V4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgSW5ldFNvY2tldEFk\nZHJlc3MgZ2V0QWRkaXRpb25hbEJvb2tpZShMaXN0PEluZXRTb2NrZXRBZGRy\nZXNzPiBleGlzdGluZ0Jvb2tpZXMpCiAgICAgICAgICAgIHRocm93cyBCS05v\ndEVub3VnaEJvb2tpZXNFeGNlcHRpb24gewogICAgICAgIHJldHVybiBnZXRB\nZGRpdGlvbmFsQm9va2llcyhuZXcgSGFzaFNldDxJbmV0U29ja2V0QWRkcmVz\ncz4oZXhpc3RpbmdCb29raWVzKSwgMSkuZ2V0KDApOwogICAgfQoKICAgIC8q\nKgogICAgICogUmV0dXJucyBhZGRpdGlvbmFsIGJvb2tpZXMgZ2l2ZW4gYW4g\nZXhjbHVzaW9uIGxpc3QgYW5kIGhvdyBtYW55IGFyZSBuZWVkZWQKICAgICAq\nIEBwYXJhbSBleGlzdGluZ0Jvb2tpZXMKICAgICAqIEBwYXJhbSBudW1BZGRp\ndGlvbmFsQm9va2llc05lZWRlZAogICAgICogQHJldHVybgogICAgICogQHRo\ncm93cyBCS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24KICAgICAqLwogICAg\ncHVibGljIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gZ2V0QWRkaXRp\nb25hbEJvb2tpZXMoU2V0PEluZXRTb2NrZXRBZGRyZXNzPiBleGlzdGluZ0Jv\nb2tpZXMsCiAgICAgICAgICAgIGludCBudW1BZGRpdGlvbmFsQm9va2llc05l\nZWRlZCkgdGhyb3dzIEJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbiB7Cgog\nICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gbmV3Qm9va2ll\ncyA9IG5ldyBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+KCk7CgogICAg\nICAgIGlmIChudW1BZGRpdGlvbmFsQm9va2llc05lZWRlZCA8PSAwKSB7CiAg\nICAgICAgICAgIHJldHVybiBuZXdCb29raWVzOwogICAgICAgIH0KCiAgICAg\nICAgTGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gYWxsQm9va2llczsKCiAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGFsbEJvb2tp\nZXMgPSBuZXcgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPihrbm93bkJv\nb2tpZXMpOwogICAgICAgIH0KCiAgICAgICAgQ29sbGVjdGlvbnMuc2h1ZmZs\nZShhbGxCb29raWVzKTsKCiAgICAgICAgZm9yIChJbmV0U29ja2V0QWRkcmVz\ncyBib29raWUgOiBhbGxCb29raWVzKSB7CiAgICAgICAgICAgIGlmIChleGlz\ndGluZ0Jvb2tpZXMuY29udGFpbnMoYm9va2llKSkgewogICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG5ld0Jv\nb2tpZXMuYWRkKGJvb2tpZSk7CiAgICAgICAgICAgIG51bUFkZGl0aW9uYWxC\nb29raWVzTmVlZGVkLS07CgogICAgICAgICAgICBpZiAobnVtQWRkaXRpb25h\nbEJvb2tpZXNOZWVkZWQgPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG5ld0Jvb2tpZXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIHRocm93IG5ldyBCS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24oKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFdhdGNoZXIgaW1wbGVtZW50YXRpb24gdG8g\nd2F0Y2ggdGhlIHJlYWRvbmx5IGJvb2tpZXMgdW5kZXIKICAgICAqICZsdDth\ndmFpbGFibGUmZ3Q7L3JlYWRvbmx5CiAgICAgKi8KICAgIHByaXZhdGUgc3Rh\ndGljIGNsYXNzIFJlYWRPbmx5Qm9va2llV2F0Y2hlciBpbXBsZW1lbnRzIFdh\ndGNoZXIsIENoaWxkcmVuQ2FsbGJhY2sgewoKICAgICAgICBwcml2YXRlIGZp\nbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dn\nZXIoUmVhZE9ubHlCb29raWVXYXRjaGVyLmNsYXNzKTsKICAgICAgICBwcml2\nYXRlIEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+IHJlYWRPbmx5Qm9va2ll\ncyA9IG5ldyBIYXNoU2V0PEluZXRTb2NrZXRBZGRyZXNzPigpOwogICAgICAg\nIHByaXZhdGUgQm9va0tlZXBlciBiazsKICAgICAgICBwcml2YXRlIFN0cmlu\nZyByZWFkT25seUJvb2tpZVJlZ1BhdGg7CgogICAgICAgIHB1YmxpYyBSZWFk\nT25seUJvb2tpZVdhdGNoZXIoQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mLCBC\nb29rS2VlcGVyIGJrKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLAogICAgICAg\nICAgICAgICAgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICB0\naGlzLmJrID0gYms7CiAgICAgICAgICAgIHJlYWRPbmx5Qm9va2llUmVnUGF0\naCA9IGNvbmYuZ2V0WmtBdmFpbGFibGVCb29raWVzUGF0aCgpICsgIi8iCiAg\nICAgICAgICAgICAgICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlJFQURP\nTkxZOwogICAgICAgICAgICBpZiAobnVsbCA9PSBiay5nZXRaa0hhbmRsZSgp\nLmV4aXN0cyhyZWFkT25seUJvb2tpZVJlZ1BhdGgsIGZhbHNlKSkgewogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBiay5nZXRa\na0hhbmRsZSgpLmNyZWF0ZShyZWFkT25seUJvb2tpZVJlZ1BhdGgsIG5ldyBi\neXRlWzBdLCBJZHMuT1BFTl9BQ0xfVU5TQUZFLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQ3JlYXRlTW9kZS5QRVJTSVNURU5UKTsKICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKE5vZGVFeGlzdHNFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIHRoaXMgbm9kZSBpcyBqdXN0IG5vdyBjcmVh\ndGVkIGJ5IHNvbWVvbmUuCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAg\nICAgIHJlYWRST0Jvb2tpZXMoKTsKICAgICAgICB9CgogICAgICAgIC8vIHJl\nYWQgdGhlIHJlYWRvbmx5IGJvb2tpZXMgaW4gYmxvY2tpbmcgZmFzaGlvbi4g\nVXNlZCBvbmx5IGZvciBmaXJzdAogICAgICAgIC8vIHRpbWUuCiAgICAgICAg\ndm9pZCByZWFkUk9Cb29raWVzQmxvY2tpbmcoKSB0aHJvd3MgSW50ZXJydXB0\nZWRFeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiB7CgogICAgICAgICAgICBm\naW5hbCBMaW5rZWRCbG9ja2luZ1F1ZXVlPEludGVnZXI+IHF1ZXVlID0gbmV3\nIExpbmtlZEJsb2NraW5nUXVldWU8SW50ZWdlcj4oKTsKICAgICAgICAgICAg\ncmVhZFJPQm9va2llcyhuZXcgQ2hpbGRyZW5DYWxsYmFjaygpIHsKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBT\ndHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgTGlzdDxTdHJpbmc+IGNoaWxkcmVu\nKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgUmVhZE9ubHlCb29raWVXYXRjaGVyLnRoaXMucHJvY2Vzc1Jl\nc3VsdChyYywgcGF0aCwgY3R4LCBjaGlsZHJlbik7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHF1ZXVlLnB1dChyYyk7CiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkludGVycnVwZWQgd2hlbiB0\ncnlpbmcgdG8gcmVhZCByZWFkb25seSBib29raWVzIGluIGEgYmxvY2tpbmcg\nZmFzaGlvbiIpOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nUnVudGltZUV4Y2VwdGlvbihlKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBp\nbnQgcmMgPSBxdWV1ZS50YWtlKCk7CgogICAgICAgICAgICBpZiAocmMgIT0g\nS2VlcGVyRXhjZXB0aW9uLkNvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAg\nICAgICAgICAgdGhyb3cgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShDb2RlLmdl\ndChyYykpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBS\nZWFkIGNoaWxkcmVuIGFuZCByZWdpc3RlciB3YXRjaGVyIGZvciByZWFkb25s\neSBib29raWVzIHBhdGgKICAgICAgICB2b2lkIHJlYWRST0Jvb2tpZXMoQ2hp\nbGRyZW5DYWxsYmFjayBjYWxsYmFjaykgewogICAgICAgICAgICBiay5nZXRa\na0hhbmRsZSgpLmdldENoaWxkcmVuKHRoaXMucmVhZE9ubHlCb29raWVSZWdQ\nYXRoLCB0aGlzLCBjYWxsYmFjaywgbnVsbCk7CiAgICAgICAgfQoKICAgICAg\nICB2b2lkIHJlYWRST0Jvb2tpZXMoKSB7CiAgICAgICAgICAgIHJlYWRST0Jv\nb2tpZXModGhpcyk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5n\nIHBhdGgsIE9iamVjdCBjdHgsIExpc3Q8U3RyaW5nPiBjaGlsZHJlbikgewog\nICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIk5vdCBhYmxlIHRvIHJlYWQgcmVh\nZG9ubHkgYm9va2llcyA6ICIsIEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoQ29k\nZS5nZXQocmMpKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+\nIG5ld1JlYWRPbmx5Qm9va2llcyA9IGNvbnZlcnRUb0Jvb2tpZUFkZHJlc3Nl\ncyhjaGlsZHJlbik7CiAgICAgICAgICAgIHJlYWRPbmx5Qm9va2llcyA9IG5l\nd1JlYWRPbmx5Qm9va2llczsKICAgICAgICB9CgogICAgICAgIC8vIHJldHVy\nbnMgdGhlIHJlYWRvbmx5IGJvb2tpZXMKICAgICAgICBwdWJsaWMgSGFzaFNl\ndDxJbmV0U29ja2V0QWRkcmVzcz4gZ2V0UmVhZE9ubHlCb29raWVzKCkgewog\nICAgICAgICAgICByZXR1cm4gcmVhZE9ubHlCb29raWVzOwogICAgICAgIH0K\nICAgIH0KfQo=\n","encoding":"base64"}

