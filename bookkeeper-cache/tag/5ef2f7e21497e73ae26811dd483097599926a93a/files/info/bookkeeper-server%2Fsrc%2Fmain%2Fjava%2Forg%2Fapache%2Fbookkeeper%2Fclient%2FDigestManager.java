{"sha":"2753680f23a556109fdec840f9fa01b7e599873c","node_id":"MDQ6QmxvYjE1NzU5NTY6Mjc1MzY4MGYyM2E1NTYxMDlmZGVjODQwZjlmYTAxYjdlNTk5ODczYw==","size":7118,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2753680f23a556109fdec840f9fa01b7e599873c","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNv\nZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhw\ncmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBz\ncGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq\nIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmltcG9ydCBq\nYXZhLm5pby5CeXRlQnVmZmVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5HZW5l\ncmFsU2VjdXJpdHlFeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbi5CS0RpZ2VzdE1hdGNoRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXJJbnB1dFN0cmVhbTsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcnM7Cgov\nKioKICogVGhpcyBjbGFzcyB0YWtlcyBhbiBlbnRyeSwgYXR0YWNoZXMgYSBk\naWdlc3QgdG8gaXQgYW5kIHBhY2thZ2VzIGl0IHdpdGggcmVsZXZhbnQKICog\nZGF0YSBzbyB0aGF0IGl0IGNhbiBiZSBzaGlwcGVkIHRvIHRoZSBib29raWUu\nIE9uIHRoZSByZXR1cm4gc2lkZSwgaXQgYWxzbwogKiBnZXRzIGEgcGFja2V0\nLCBjaGVja3MgdGhhdCB0aGUgZGlnZXN0IG1hdGNoZXMsIGFuZCBleHRyYWN0\ncyB0aGUgb3JpZ2luYWwgZW50cnkKICogZm9yIHRoZSBwYWNrZXQuIEN1cnJl\nbnRseSAyIHR5cGVzIG9mIGRpZ2VzdHMgYXJlIHN1cHBvcnRlZDogTUFDIChi\nYXNlZCBvbiBTSEEtMSkgYW5kIENSQzMyCiAqLwoKYWJzdHJhY3QgY2xhc3Mg\nRGlnZXN0TWFuYWdlciB7CiAgICBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dl\nciA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKERpZ2VzdE1hbmFnZXIuY2xh\nc3MpOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQgTUVUQURBVEFfTEVOR1RIID0g\nMzI7CgogICAgbG9uZyBsZWRnZXJJZDsKCiAgICBhYnN0cmFjdCBpbnQgZ2V0\nTWFjQ29kZUxlbmd0aCgpOwoKICAgIHZvaWQgdXBkYXRlKGJ5dGVbXSBkYXRh\nKSB7CiAgICAgICAgdXBkYXRlKGRhdGEsIDAsIGRhdGEubGVuZ3RoKTsKICAg\nIH0KCiAgICBhYnN0cmFjdCB2b2lkIHVwZGF0ZShieXRlW10gZGF0YSwgaW50\nIG9mZnNldCwgaW50IGxlbmd0aCk7CiAgICBhYnN0cmFjdCBieXRlW10gZ2V0\nVmFsdWVBbmRSZXNldCgpOwoKICAgIGZpbmFsIGludCBtYWNDb2RlTGVuZ3Ro\nOwoKICAgIHB1YmxpYyBEaWdlc3RNYW5hZ2VyKGxvbmcgbGVkZ2VySWQpIHsK\nICAgICAgICB0aGlzLmxlZGdlcklkID0gbGVkZ2VySWQ7CiAgICAgICAgbWFj\nQ29kZUxlbmd0aCA9IGdldE1hY0NvZGVMZW5ndGgoKTsKICAgIH0KCiAgICBz\ndGF0aWMgRGlnZXN0TWFuYWdlciBpbnN0YW50aWF0ZShsb25nIGxlZGdlcklk\nLCBieXRlW10gcGFzc3dkLCBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHRocm93\ncyBHZW5lcmFsU2VjdXJpdHlFeGNlcHRpb24gewogICAgICAgIHN3aXRjaChk\naWdlc3RUeXBlKSB7CiAgICAgICAgY2FzZSBNQUM6CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgTWFjRGlnZXN0TWFuYWdlcihsZWRnZXJJZCwgcGFzc3dkKTsK\nICAgICAgICBjYXNlIENSQzMyOgogICAgICAgICAgICByZXR1cm4gbmV3IENS\nQzMyRGlnZXN0TWFuYWdlcihsZWRnZXJJZCk7CiAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxTZWN1cml0eUV4Y2VwdGlv\nbigiVW5rbm93biBjaGVja3N1bSB0eXBlOiAiICsgZGlnZXN0VHlwZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGRp\nZ2VzdCBmb3IgYW4gZW50cnkgYW5kIHB1dCBieXRlcyB0b2dldGhlciBmb3Ig\nc2VuZGluZy4KICAgICAqCiAgICAgKiBAcGFyYW0gZW50cnlJZAogICAgICog\nQHBhcmFtIGxhc3RBZGRDb25maXJtZWQKICAgICAqIEBwYXJhbSBsZW5ndGgK\nICAgICAqIEBwYXJhbSBkYXRhCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KCiAg\nICBwdWJsaWMgQ2hhbm5lbEJ1ZmZlciBjb21wdXRlRGlnZXN0QW5kUGFja2Fn\nZUZvclNlbmRpbmcobG9uZyBlbnRyeUlkLCBsb25nIGxhc3RBZGRDb25maXJt\nZWQsIGxvbmcgbGVuZ3RoLCBieXRlW10gZGF0YSwgaW50IGRvZmZzZXQsIGlu\ndCBkbGVuZ3RoKSB7CgogICAgICAgIGJ5dGVbXSBidWZmZXJBcnJheSA9IG5l\ndyBieXRlW01FVEFEQVRBX0xFTkdUSCArIG1hY0NvZGVMZW5ndGhdOwogICAg\nICAgIEJ5dGVCdWZmZXIgYnVmZmVyID0gQnl0ZUJ1ZmZlci53cmFwKGJ1ZmZl\nckFycmF5KTsKICAgICAgICBidWZmZXIucHV0TG9uZyhsZWRnZXJJZCk7CiAg\nICAgICAgYnVmZmVyLnB1dExvbmcoZW50cnlJZCk7CiAgICAgICAgYnVmZmVy\nLnB1dExvbmcobGFzdEFkZENvbmZpcm1lZCk7CiAgICAgICAgYnVmZmVyLnB1\ndExvbmcobGVuZ3RoKTsKICAgICAgICBidWZmZXIuZmxpcCgpOwoKICAgICAg\nICB1cGRhdGUoYnVmZmVyLmFycmF5KCksIDAsIE1FVEFEQVRBX0xFTkdUSCk7\nCiAgICAgICAgdXBkYXRlKGRhdGEsIGRvZmZzZXQsIGRsZW5ndGgpOwogICAg\nICAgIGJ5dGVbXSBkaWdlc3QgPSBnZXRWYWx1ZUFuZFJlc2V0KCk7CgogICAg\nICAgIGJ1ZmZlci5saW1pdChidWZmZXIuY2FwYWNpdHkoKSk7CiAgICAgICAg\nYnVmZmVyLnBvc2l0aW9uKE1FVEFEQVRBX0xFTkdUSCk7CiAgICAgICAgYnVm\nZmVyLnB1dChkaWdlc3QpOwogICAgICAgIGJ1ZmZlci5mbGlwKCk7CgogICAg\nICAgIHJldHVybiBDaGFubmVsQnVmZmVycy53cmFwcGVkQnVmZmVyKENoYW5u\nZWxCdWZmZXJzLndyYXBwZWRCdWZmZXIoYnVmZmVyKSwgQ2hhbm5lbEJ1ZmZl\ncnMud3JhcHBlZEJ1ZmZlcihkYXRhLCBkb2Zmc2V0LCBkbGVuZ3RoKSk7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlmeURpZ2VzdChDaGFubmVsQnVm\nZmVyIGRhdGFSZWNlaXZlZCkgdGhyb3dzIEJLRGlnZXN0TWF0Y2hFeGNlcHRp\nb24gewogICAgICAgIHZlcmlmeURpZ2VzdChMZWRnZXJIYW5kbGUuSU5WQUxJ\nRF9FTlRSWV9JRCwgZGF0YVJlY2VpdmVkLCB0cnVlKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgdmVyaWZ5RGlnZXN0KGxvbmcgZW50cnlJZCwgQ2hhbm5l\nbEJ1ZmZlciBkYXRhUmVjZWl2ZWQpIHRocm93cyBCS0RpZ2VzdE1hdGNoRXhj\nZXB0aW9uIHsKICAgICAgICB2ZXJpZnlEaWdlc3QoZW50cnlJZCwgZGF0YVJl\nY2VpdmVkLCBmYWxzZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlm\neURpZ2VzdChsb25nIGVudHJ5SWQsIENoYW5uZWxCdWZmZXIgZGF0YVJlY2Vp\ndmVkLCBib29sZWFuIHNraXBFbnRyeUlkQ2hlY2spCiAgICAgICAgICAgIHRo\ncm93cyBCS0RpZ2VzdE1hdGNoRXhjZXB0aW9uIHsKCiAgICAgICAgQnl0ZUJ1\nZmZlciBkYXRhUmVjZWl2ZWRCdWZmZXIgPSBkYXRhUmVjZWl2ZWQudG9CeXRl\nQnVmZmVyKCk7CiAgICAgICAgYnl0ZVtdIGRpZ2VzdDsKCiAgICAgICAgaWYg\nKChNRVRBREFUQV9MRU5HVEggKyBtYWNDb2RlTGVuZ3RoKSA+IGRhdGFSZWNl\naXZlZC5yZWFkYWJsZUJ5dGVzKCkpIHsKICAgICAgICAgICAgbG9nZ2VyLmVy\ncm9yKCJEYXRhIHJlY2VpdmVkIGlzIHNtYWxsZXIgdGhhbiB0aGUgbWluaW11\nbSBmb3IgdGhpcyBkaWdlc3QgdHlwZS4gIgogICAgICAgICAgICAgICAgICAg\nICsgIiBFaXRoZXIgdGhlIHBhY2tldCBpdCBjb3JydXB0LCBvciB0aGUgd3Jv\nbmcgZGlnZXN0IGlzIGNvbmZpZ3VyZWQuICIKICAgICAgICAgICAgICAgICAg\nICArICIgRGlnZXN0IHR5cGU6IHt9LCBQYWNrZXQgTGVuZ3RoOiB7fSIsCiAg\nICAgICAgICAgICAgICAgICAgdGhpcy5nZXRDbGFzcygpLmdldE5hbWUoKSwg\nZGF0YVJlY2VpdmVkLnJlYWRhYmxlQnl0ZXMoKSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBCS0RpZ2VzdE1hdGNoRXhjZXB0aW9uKCk7CiAgICAgICAgfQog\nICAgICAgIHVwZGF0ZShkYXRhUmVjZWl2ZWRCdWZmZXIuYXJyYXkoKSwgZGF0\nYVJlY2VpdmVkQnVmZmVyLnBvc2l0aW9uKCksIE1FVEFEQVRBX0xFTkdUSCk7\nCgogICAgICAgIGludCBvZmZzZXQgPSBNRVRBREFUQV9MRU5HVEggKyBtYWND\nb2RlTGVuZ3RoOwogICAgICAgIHVwZGF0ZShkYXRhUmVjZWl2ZWRCdWZmZXIu\nYXJyYXkoKSwgZGF0YVJlY2VpdmVkQnVmZmVyLnBvc2l0aW9uKCkgKyBvZmZz\nZXQsIGRhdGFSZWNlaXZlZC5yZWFkYWJsZUJ5dGVzKCkgLSBvZmZzZXQpOwog\nICAgICAgIGRpZ2VzdCA9IGdldFZhbHVlQW5kUmVzZXQoKTsKCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBkaWdlc3QubGVuZ3RoOyBpKyspIHsKICAg\nICAgICAgICAgaWYgKGRpZ2VzdFtpXSAhPSBkYXRhUmVjZWl2ZWQuZ2V0Qnl0\nZShNRVRBREFUQV9MRU5HVEggKyBpKSkgewogICAgICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJNYWMgbWlzbWF0Y2ggZm9yIGxlZGdlci1pZDogIiArIGxl\nZGdlcklkICsgIiwgZW50cnktaWQ6ICIgKyBlbnRyeUlkKTsKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBCS0RpZ2VzdE1hdGNoRXhjZXB0aW9uKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxvbmcgYWN0dWFsTGVk\nZ2VySWQgPSBkYXRhUmVjZWl2ZWQucmVhZExvbmcoKTsKICAgICAgICBsb25n\nIGFjdHVhbEVudHJ5SWQgPSBkYXRhUmVjZWl2ZWQucmVhZExvbmcoKTsKCiAg\nICAgICAgaWYgKGFjdHVhbExlZGdlcklkICE9IGxlZGdlcklkKSB7CiAgICAg\nICAgICAgIGxvZ2dlci5lcnJvcigiTGVkZ2VyLWlkIG1pc21hdGNoIGluIGF1\ndGhlbnRpY2F0ZWQgbWVzc2FnZSwgZXhwZWN0ZWQ6ICIgKyBsZWRnZXJJZCAr\nICIgLCBhY3R1YWw6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICsgYWN0\ndWFsTGVkZ2VySWQpOwogICAgICAgICAgICB0aHJvdyBuZXcgQktEaWdlc3RN\nYXRjaEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFza2lw\nRW50cnlJZENoZWNrICYmIGFjdHVhbEVudHJ5SWQgIT0gZW50cnlJZCkgewog\nICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkVudHJ5LWlkIG1pc21hdGNoIGlu\nIGF1dGhlbnRpY2F0ZWQgbWVzc2FnZSwgZXhwZWN0ZWQ6ICIgKyBlbnRyeUlk\nICsgIiAsIGFjdHVhbDogIgogICAgICAgICAgICAgICAgICAgICAgICAgKyBh\nY3R1YWxFbnRyeUlkKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEJLRGlnZXN0\nTWF0Y2hFeGNlcHRpb24oKTsKICAgICAgICB9CgogICAgfQoKICAgIC8qKgog\nICAgICogVmVyaWZ5IHRoYXQgdGhlIGRpZ2VzdCBtYXRjaGVzIGFuZCByZXR1\ncm5zIHRoZSBkYXRhIGluIHRoZSBlbnRyeS4KICAgICAqCiAgICAgKiBAcGFy\nYW0gZW50cnlJZAogICAgICogQHBhcmFtIGRhdGFSZWNlaXZlZAogICAgICog\nQHJldHVybgogICAgICogQHRocm93cyBCS0RpZ2VzdE1hdGNoRXhjZXB0aW9u\nCiAgICAgKi8KICAgIENoYW5uZWxCdWZmZXJJbnB1dFN0cmVhbSB2ZXJpZnlE\naWdlc3RBbmRSZXR1cm5EYXRhKGxvbmcgZW50cnlJZCwgQ2hhbm5lbEJ1ZmZl\nciBkYXRhUmVjZWl2ZWQpCiAgICAgICAgICAgIHRocm93cyBCS0RpZ2VzdE1h\ndGNoRXhjZXB0aW9uIHsKICAgICAgICB2ZXJpZnlEaWdlc3QoZW50cnlJZCwg\nZGF0YVJlY2VpdmVkKTsKICAgICAgICBkYXRhUmVjZWl2ZWQucmVhZGVySW5k\nZXgoTUVUQURBVEFfTEVOR1RIICsgbWFjQ29kZUxlbmd0aCk7CiAgICAgICAg\ncmV0dXJuIG5ldyBDaGFubmVsQnVmZmVySW5wdXRTdHJlYW0oZGF0YVJlY2Vp\ndmVkKTsKICAgIH0KCiAgICBzdGF0aWMgY2xhc3MgUmVjb3ZlcnlEYXRhIHsK\nICAgICAgICBsb25nIGxhc3RBZGRDb25maXJtZWQ7CiAgICAgICAgbG9uZyBs\nZW5ndGg7CgogICAgICAgIHB1YmxpYyBSZWNvdmVyeURhdGEobG9uZyBsYXN0\nQWRkQ29uZmlybWVkLCBsb25nIGxlbmd0aCkgewogICAgICAgICAgICB0aGlz\nLmxhc3RBZGRDb25maXJtZWQgPSBsYXN0QWRkQ29uZmlybWVkOwogICAgICAg\nICAgICB0aGlzLmxlbmd0aCA9IGxlbmd0aDsKICAgICAgICB9CgogICAgfQoK\nICAgIFJlY292ZXJ5RGF0YSB2ZXJpZnlEaWdlc3RBbmRSZXR1cm5MYXN0Q29u\nZmlybWVkKENoYW5uZWxCdWZmZXIgZGF0YVJlY2VpdmVkKSB0aHJvd3MgQktE\naWdlc3RNYXRjaEV4Y2VwdGlvbiB7CiAgICAgICAgdmVyaWZ5RGlnZXN0KGRh\ndGFSZWNlaXZlZCk7CiAgICAgICAgZGF0YVJlY2VpdmVkLnJlYWRlckluZGV4\nKDgpOwoKICAgICAgICBkYXRhUmVjZWl2ZWQucmVhZExvbmcoKTsgLy8gc2tp\ncCB1bnVzZWQgZW50cnlJZAogICAgICAgIGxvbmcgbGFzdEFkZENvbmZpcm1l\nZCA9IGRhdGFSZWNlaXZlZC5yZWFkTG9uZygpOwogICAgICAgIGxvbmcgbGVu\nZ3RoID0gZGF0YVJlY2VpdmVkLnJlYWRMb25nKCk7CiAgICAgICAgcmV0dXJu\nIG5ldyBSZWNvdmVyeURhdGEobGFzdEFkZENvbmZpcm1lZCwgbGVuZ3RoKTsK\nICAgIH0KfQo=\n","encoding":"base64"}

