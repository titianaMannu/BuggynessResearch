{"sha":"f2d863cf0dc3bcb5bd5243bc2d2842c39bc383ba","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjJkODYzY2YwZGMzYmNiNWJkNTI0M2JjMmQyODQyYzM5YmMzODNiYQ==","size":11375,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f2d863cf0dc3bcb5bd5243bc2d2842c39bc383ba","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7CgppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nU2V0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tp\nZUNsaWVudDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5C\nb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJ\nbnRlcm5hbENhbGxiYWNrcy5SZWFkRW50cnlDYWxsYmFjazsKCmltcG9ydCBv\ncmcuamJvc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7CmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rv\ncnk7CgppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljQm9vbGVhbjsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNMb25n\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0lu\ndGVnZXI7CgovKioKICpDaGVja3MgdGhlIGNvbXBsZXRlIGxlZGdlciBhbmQg\nZmluZHMgdGhlIFVuZGVyUmVwbGljYXRlZCBmcmFnbWVudHMgaWYgYW55CiAq\nLwpwdWJsaWMgY2xhc3MgTGVkZ2VyQ2hlY2tlciB7CiAgICBwcml2YXRlIHN0\nYXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTGVk\nZ2VyQ2hlY2tlci5jbGFzcyk7CgogICAgcHVibGljIGZpbmFsIEJvb2tpZUNs\naWVudCBib29raWVDbGllbnQ7CgogICAgc3RhdGljIGNsYXNzIEludmFsaWRG\ncmFnbWVudEV4Y2VwdGlvbiBleHRlbmRzIEV4Y2VwdGlvbiB7CiAgICAgICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0g\nMTQ2NzIwMTI3NjQxNzA2MjM1M0w7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGlzIHdpbGwgY29sbGVjdCBhbGwgdGhlIGVudHJ5IHJlYWQgY2FsbCBiYWNr\ncyBhbmQgZmluYWxseSBpdCB3aWxsIGdpdmUKICAgICAqIGNhbGwgYmFjayB0\nbyBwcmV2aW91cyBjYWxsIGJhY2sgQVBJIHdoaWNoIGlzIHdhaXRpbmcgZm9y\nIGl0IG9uY2UgaXQgbWVldHMKICAgICAqIHRoZSBleHBlY3RlZCBjYWxsIGJh\nY2tzIGZyb20gZG93bgogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFz\ncyBSZWFkTWFueUVudHJpZXNDYWxsYmFjayBpbXBsZW1lbnRzIFJlYWRFbnRy\neUNhbGxiYWNrIHsKICAgICAgICBBdG9taWNCb29sZWFuIGNvbXBsZXRlZCA9\nIG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICBmaW5hbCBBdG9t\naWNMb25nIG51bUVudHJpZXM7CiAgICAgICAgZmluYWwgTGVkZ2VyRnJhZ21l\nbnQgZnJhZ21lbnQ7CiAgICAgICAgZmluYWwgR2VuZXJpY0NhbGxiYWNrPExl\nZGdlckZyYWdtZW50PiBjYjsKCiAgICAgICAgUmVhZE1hbnlFbnRyaWVzQ2Fs\nbGJhY2sobG9uZyBudW1FbnRyaWVzLCBMZWRnZXJGcmFnbWVudCBmcmFnbWVu\ndCwKICAgICAgICAgICAgICAgIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJGcmFn\nbWVudD4gY2IpIHsKICAgICAgICAgICAgdGhpcy5udW1FbnRyaWVzID0gbmV3\nIEF0b21pY0xvbmcobnVtRW50cmllcyk7CiAgICAgICAgICAgIHRoaXMuZnJh\nZ21lbnQgPSBmcmFnbWVudDsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVhZEVudHJ5Q29tcGxl\ndGUoaW50IHJjLCBsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQsCiAgICAg\nICAgICAgICAgICBDaGFubmVsQnVmZmVyIGJ1ZmZlciwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSykg\newogICAgICAgICAgICAgICAgaWYgKG51bUVudHJpZXMuZGVjcmVtZW50QW5k\nR2V0KCkgPT0gMAogICAgICAgICAgICAgICAgICAgICAgICAmJiAhY29tcGxl\ndGVkLmdldEFuZFNldCh0cnVlKSkgewogICAgICAgICAgICAgICAgICAgIGNi\nLm9wZXJhdGlvbkNvbXBsZXRlKHJjLCBmcmFnbWVudCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoIWNvbXBsZXRlZC5nZXRB\nbmRTZXQodHJ1ZSkpIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNv\nbXBsZXRlKHJjLCBmcmFnbWVudCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIExlZGdlckNoZWNrZXIoQm9va0tlZXBlciBi\na2MpIHsKICAgICAgICBib29raWVDbGllbnQgPSBia2MuZ2V0Qm9va2llQ2xp\nZW50KCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlmeUxlZGdlckZy\nYWdtZW50KExlZGdlckZyYWdtZW50IGZyYWdtZW50LAogICAgICAgICAgICBH\nZW5lcmljQ2FsbGJhY2s8TGVkZ2VyRnJhZ21lbnQ+IGNiKSB0aHJvd3MgSW52\nYWxpZEZyYWdtZW50RXhjZXB0aW9uIHsKICAgICAgICBsb25nIGZpcnN0U3Rv\ncmVkID0gZnJhZ21lbnQuZ2V0Rmlyc3RTdG9yZWRFbnRyeUlkKCk7CiAgICAg\nICAgbG9uZyBsYXN0U3RvcmVkID0gZnJhZ21lbnQuZ2V0TGFzdFN0b3JlZEVu\ndHJ5SWQoKTsKCiAgICAgICAgaWYgKGZpcnN0U3RvcmVkID09IExlZGdlckhh\nbmRsZS5JTlZBTElEX0VOVFJZX0lEKSB7CiAgICAgICAgICAgIGlmIChsYXN0\nU3RvcmVkICE9IExlZGdlckhhbmRsZS5JTlZBTElEX0VOVFJZX0lEKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZEZyYWdtZW50RXhjZXB0\naW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2Iub3BlcmF0aW9u\nQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgZnJhZ21lbnQpOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGlmIChmaXJzdFN0\nb3JlZCA9PSBsYXN0U3RvcmVkKSB7CiAgICAgICAgICAgIFJlYWRNYW55RW50\ncmllc0NhbGxiYWNrIG1hbnljYiA9IG5ldyBSZWFkTWFueUVudHJpZXNDYWxs\nYmFjaygxLAogICAgICAgICAgICAgICAgICAgIGZyYWdtZW50LCBjYik7CiAg\nICAgICAgICAgIGJvb2tpZUNsaWVudC5yZWFkRW50cnkoZnJhZ21lbnQuZ2V0\nQWRkcmVzcygpLCBmcmFnbWVudAogICAgICAgICAgICAgICAgICAgIC5nZXRM\nZWRnZXJJZCgpLCBmaXJzdFN0b3JlZCwgbWFueWNiLCBudWxsKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBSZWFkTWFueUVudHJpZXNDYWxsYmFj\nayBtYW55Y2IgPSBuZXcgUmVhZE1hbnlFbnRyaWVzQ2FsbGJhY2soMiwKICAg\nICAgICAgICAgICAgICAgICBmcmFnbWVudCwgY2IpOwogICAgICAgICAgICBi\nb29raWVDbGllbnQucmVhZEVudHJ5KGZyYWdtZW50LmdldEFkZHJlc3MoKSwg\nZnJhZ21lbnQKICAgICAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VySWQoKSwg\nZmlyc3RTdG9yZWQsIG1hbnljYiwgbnVsbCk7CiAgICAgICAgICAgIGJvb2tp\nZUNsaWVudC5yZWFkRW50cnkoZnJhZ21lbnQuZ2V0QWRkcmVzcygpLCBmcmFn\nbWVudAogICAgICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJJZCgpLCBsYXN0\nU3RvcmVkLCBtYW55Y2IsIG51bGwpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIENhbGxiYWNrIGZvciBjaGVja2luZyB3aGV0aGVyIGFuIGVu\ndHJ5IGV4aXN0cyBvciBub3QuCiAgICAgKiBJdCBpcyB1c2VkIHRvIGRpZmZl\ncmVudGlhdGUgdGhlIGNhc2VzIHdoZXJlIGl0IGhhcyBiZWVuIHdyaXR0ZW4K\nICAgICAqIGJ1dCBub3cgY2Fubm90IGJlIHJlYWQsIGFuZCB3aGVyZSBpdCBu\nZXZlciBoYXMgYmVlbiB3cml0dGVuLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBjbGFzcyBFbnRyeUV4aXN0c0NhbGxiYWNrIGltcGxlbWVudHMgUmVh\nZEVudHJ5Q2FsbGJhY2sgewogICAgICAgIEF0b21pY0Jvb2xlYW4gZW50cnlN\nYXlFeGlzdCA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICBm\naW5hbCBBdG9taWNJbnRlZ2VyIG51bVJlYWRzOwogICAgICAgIGZpbmFsIEdl\nbmVyaWNDYWxsYmFjazxCb29sZWFuPiBjYjsKCiAgICAgICAgRW50cnlFeGlz\ndHNDYWxsYmFjayhpbnQgbnVtUmVhZHMsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBHZW5lcmljQ2FsbGJhY2s8Qm9vbGVhbj4gY2IpIHsKICAgICAg\nICAgICAgdGhpcy5udW1SZWFkcyA9IG5ldyBBdG9taWNJbnRlZ2VyKG51bVJl\nYWRzKTsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgcmVhZEVudHJ5Q29tcGxldGUoaW50IHJjLCBs\nb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgQ2hhbm5lbEJ1ZmZlciBidWZmZXIsIE9i\namVjdCBjdHgpIHsKICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9u\nLkNvZGUuTm9TdWNoRW50cnlFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAg\nIGVudHJ5TWF5RXhpc3Quc2V0KHRydWUpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAobnVtUmVhZHMuZGVjcmVtZW50QW5kR2V0KCkgPT0gMCkg\newogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUocmMsIGVu\ndHJ5TWF5RXhpc3QuZ2V0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogVGhpcyB3aWxsIGNvbGxlY3QgYWxsIHRo\nZSBmcmFnbWVudCByZWFkIGNhbGwgYmFja3MgYW5kIGZpbmFsbHkgaXQgd2ls\nbAogICAgICogZ2l2ZSBjYWxsIGJhY2sgdG8gYWJvdmUgY2FsbCBiYWNrIEFQ\nSSB3aGljaCBpcyB3YWl0aW5nIGZvciBpdCBvbmNlIGl0CiAgICAgKiBtZWV0\ncyB0aGUgZXhwZWN0ZWQgY2FsbCBiYWNrcyBmcm9tIGRvd24KICAgICAqLwog\nICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRnVsbExlZGdlckNhbGxiYWNrIGlt\ncGxlbWVudHMKICAgICAgICAgICAgR2VuZXJpY0NhbGxiYWNrPExlZGdlckZy\nYWdtZW50PiB7CiAgICAgICAgZmluYWwgU2V0PExlZGdlckZyYWdtZW50PiBi\nYWRGcmFnbWVudHM7CiAgICAgICAgZmluYWwgQXRvbWljTG9uZyBudW1GcmFn\nbWVudHM7CiAgICAgICAgZmluYWwgR2VuZXJpY0NhbGxiYWNrPFNldDxMZWRn\nZXJGcmFnbWVudD4+IGNiOwoKICAgICAgICBGdWxsTGVkZ2VyQ2FsbGJhY2so\nbG9uZyBudW1GcmFnbWVudHMsCiAgICAgICAgICAgICAgICBHZW5lcmljQ2Fs\nbGJhY2s8U2V0PExlZGdlckZyYWdtZW50Pj4gY2IpIHsKICAgICAgICAgICAg\nYmFkRnJhZ21lbnRzID0gbmV3IEhhc2hTZXQ8TGVkZ2VyRnJhZ21lbnQ+KCk7\nCiAgICAgICAgICAgIHRoaXMubnVtRnJhZ21lbnRzID0gbmV3IEF0b21pY0xv\nbmcobnVtRnJhZ21lbnRzKTsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxl\ndGUoaW50IHJjLCBMZWRnZXJGcmFnbWVudCByZXN1bHQpIHsKICAgICAgICAg\nICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAg\nICAgICAgIGJhZEZyYWdtZW50cy5hZGQocmVzdWx0KTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAobnVtRnJhZ21lbnRzLmRlY3JlbWVudEFuZEdl\ndCgpID09IDApIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBs\nZXRlKEJLRXhjZXB0aW9uLkNvZGUuT0ssIGJhZEZyYWdtZW50cyk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVj\nayB0aGF0IGFsbCB0aGUgZnJhZ21lbnRzIGluIHRoZSBwYXNzZWQgaW4gbGVk\nZ2VyLCBhbmQgcmVwb3J0IHRob3NlCiAgICAgKiB3aGljaCBhcmUgbWlzc2lu\nZy4KICAgICAqLwogICAgcHVibGljIHZvaWQgY2hlY2tMZWRnZXIoTGVkZ2Vy\nSGFuZGxlIGxoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwg\nR2VuZXJpY0NhbGxiYWNrPFNldDxMZWRnZXJGcmFnbWVudD4+IGNiKSB7CiAg\nICAgICAgLy8gYnVpbGQgYSBzZXQgb2YgYWxsIGZyYWdtZW50IHJlcGxpY2Fz\nCiAgICAgICAgZmluYWwgU2V0PExlZGdlckZyYWdtZW50PiBmcmFnbWVudHMg\nPSBuZXcgSGFzaFNldDxMZWRnZXJGcmFnbWVudD4oKTsKCiAgICAgICAgTG9u\nZyBjdXJFbnRyeUlkID0gbnVsbDsKICAgICAgICBBcnJheUxpc3Q8SW5ldFNv\nY2tldEFkZHJlc3M+IGN1ckVuc2VtYmxlID0gbnVsbDsKICAgICAgICBmb3Ig\nKE1hcC5FbnRyeTxMb25nLCBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+\nPiBlIDogbGgKICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YSgp\nLmdldEVuc2VtYmxlcygpLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgaWYg\nKGN1ckVudHJ5SWQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjdXJFbnNlbWJsZS5zaXplKCk7IGkrKykgewogICAg\nICAgICAgICAgICAgICAgIGZyYWdtZW50cy5hZGQobmV3IExlZGdlckZyYWdt\nZW50KGxoLCBjdXJFbnRyeUlkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZS5nZXRLZXkoKSAtIDEsIGkpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBjdXJFbnRyeUlkID0gZS5nZXRLZXko\nKTsKICAgICAgICAgICAgY3VyRW5zZW1ibGUgPSBlLmdldFZhbHVlKCk7CiAg\nICAgICAgfQoKICAgICAgICAvKiBDaGVja2luZyB0aGUgbGFzdCBzZWdtZW50\nIG9mIHRoZSBsZWRnZXIgY2FuIGJlIGNvbXBsaWNhdGVkIGluIHNvbWUgY2Fz\nZXMuCiAgICAgICAgICogSW4gdGhlIGNhc2UgdGhhdCB0aGUgbGVkZ2VyIGlz\nIGNsb3NlZCwgd2UgY2FuIGp1c3QgY2hlY2sgdGhlIGZyYWdtZW50cyBvZgog\nICAgICAgICAqIHRoZSBzZWdtZW50IGFzIG5vcm1hbCwgZXhjZXB0IGluIHRo\nZSBjYXNlIHRoYXQgbm8gZW50cnkgd2FzIGV2ZXIgd3JpdHRlbiwKICAgICAg\nICAgKiB0byB0aGUgbGVkZ2VyLCBpbiB3aGljaCBjYXNlIHdlIGNoZWNrIG5v\nIGZyYWdtZW50cy4KICAgICAgICAgKiBJbiB0aGUgY2FzZSB0aGF0IHRoZSBs\nZWRnZXIgaXMgb3BlbiwgYnV0IGVub3VnaCBlbnRyaWVzIGhhdmUgYmVlbiB3\ncml0dGVuLAogICAgICAgICAqIGZvciBsYXN0QWRkQ29uZmlybWVkIHRvIGJl\nIHNldCBhYm92ZSB0aGUgc3RhcnQgZW50cnkgb2YgdGhlIHNlZ21lbnQsIHdl\nCiAgICAgICAgICogY2FuIGFsc28gY2hlY2sgYXMgbm9ybWFsLgogICAgICAg\nICAqIEhvd2V2ZXIsIGlmIGxhc3RBZGRDb25maXJtZWQgY2Fubm90IGJlIHRy\ndXN0ZWQsIHN1Y2ggYXMgd2hlbiBpdCdzIGxvd2VyIHRoYW4KICAgICAgICAg\nKiB0aGUgZmlyc3QgZW50cnkgaWQsIG9yIG5vdCBzZXQgYXQgYWxsLCB3ZSBj\nYW5ub3QgYmUgc3VyZSBpZiB0aGVyZSBoYXMgYmVlbgogICAgICAgICAqIGRh\ndGEgd3JpdHRlbiB0byB0aGUgc2VnbWVudC4gRm9yIHRoaXMgcmVhc29uLCB3\nZSBoYXZlIHRvIHNlbmQgYSByZWFkIHJlcXVlc3QKICAgICAgICAgKiB0byB0\naGUgYm9va2llcyB3aGljaCBzaG91bGQgaGF2ZSB0aGUgZmlyc3QgZW50cnku\nIElmIHRoZXkgcmVzcG9uZCB3aXRoCiAgICAgICAgICogTm9TdWNoRW50cnkg\nd2UgY2FuIGFzc3VtZSBpdCB3YXMgbmV2ZXIgd3JpdHRlbi4gSWYgdGhleSBy\nZXNwb25kIHdpdGggYW55dGhpbmcKICAgICAgICAgKiBlbHNlLCB3ZSBtdXN0\nIGFzc3VtZSB0aGUgZW50cnkgaGFzIGJlZW4gd3JpdHRlbiwgc28gd2UgcnVu\nIHRoZSBjaGVjay4KICAgICAgICAgKi8KICAgICAgICBpZiAoY3VyRW50cnlJ\nZCAhPSBudWxsCiAgICAgICAgICAgICYmICEobGguZ2V0TGFzdEFkZENvbmZp\ncm1lZCgpID09IExlZGdlckhhbmRsZS5JTlZBTElEX0VOVFJZX0lECiAgICAg\nICAgICAgICAgICAgJiYgbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKS5pc0Nsb3Nl\nZCgpKSkgewogICAgICAgICAgICBsb25nIGxhc3RFbnRyeSA9IGxoLmdldExh\nc3RBZGRDb25maXJtZWQoKTsKCiAgICAgICAgICAgIGlmIChsYXN0RW50cnkg\nPCBjdXJFbnRyeUlkKSB7CiAgICAgICAgICAgICAgICBsYXN0RW50cnkgPSBj\ndXJFbnRyeUlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmaW5hbCBT\nZXQ8TGVkZ2VyRnJhZ21lbnQ+IGZpbmFsU2VnbWVudEZyYWdtZW50cyA9IG5l\ndyBIYXNoU2V0PExlZGdlckZyYWdtZW50PigpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGN1ckVuc2VtYmxlLnNpemUoKTsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBmaW5hbFNlZ21lbnRGcmFnbWVudHMuYWRkKG5ldyBM\nZWRnZXJGcmFnbWVudChsaCwgY3VyRW50cnlJZCwKICAgICAgICAgICAgICAg\nICAgICAgICAgbGFzdEVudHJ5LCBpKSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIENoZWNrIGZvciB0aGUgY2FzZSB0aGF0IG5vIGxhc3QgY29u\nZmlybWVkIGVudHJ5IGhhcwogICAgICAgICAgICAvLyBiZWVuIHNldC4KICAg\nICAgICAgICAgaWYgKGN1ckVudHJ5SWQgPT0gbGFzdEVudHJ5KSB7CiAgICAg\nICAgICAgICAgICBmaW5hbCBsb25nIGVudHJ5VG9SZWFkID0gY3VyRW50cnlJ\nZDsKCiAgICAgICAgICAgICAgICBFbnRyeUV4aXN0c0NhbGxiYWNrIGVlY2IK\nICAgICAgICAgICAgICAgICAgICA9IG5ldyBFbnRyeUV4aXN0c0NhbGxiYWNr\nKGxoLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0V3JpdGVRdW9ydW1TaXplKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBuZXcgR2VuZXJpY0NhbGxiYWNrPEJvb2xlYW4+KCkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgQm9vbGVhbiByZXN1\nbHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJh\nZ21lbnRzLmFkZEFsbChmaW5hbFNlZ21lbnRGcmFnbWVudHMpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNoZWNrRnJhZ21lbnRzKGZyYWdtZW50cywgY2IpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGZvciAoaW50IGJpIDogbGgu\nZ2V0RGlzdHJpYnV0aW9uU2NoZWR1bGUoKS5nZXRXcml0ZVNldChlbnRyeVRv\nUmVhZCkpIHsKICAgICAgICAgICAgICAgICAgICBJbmV0U29ja2V0QWRkcmVz\ncyBhZGRyID0gY3VyRW5zZW1ibGUuZ2V0KGJpKTsKICAgICAgICAgICAgICAg\nICAgICBib29raWVDbGllbnQucmVhZEVudHJ5KGFkZHIsIGxoLmdldElkKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBl\nbnRyeVRvUmVhZCwgZWVjYiwgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBmcmFnbWVudHMuYWRkQWxsKGZpbmFsU2VnbWVudEZy\nYWdtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNo\nZWNrRnJhZ21lbnRzKGZyYWdtZW50cywgY2IpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBjaGVja0ZyYWdtZW50cyhTZXQ8TGVkZ2VyRnJhZ21lbnQ+IGZy\nYWdtZW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZW5l\ncmljQ2FsbGJhY2s8U2V0PExlZGdlckZyYWdtZW50Pj4gY2IpIHsKICAgICAg\nICBpZiAoZnJhZ21lbnRzLnNpemUoKSA9PSAwKSB7IC8vIG5vIGZyYWdtZW50\ncyB0byB2ZXJpZnkKICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUo\nQktFeGNlcHRpb24uQ29kZS5PSywgZnJhZ21lbnRzKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gdmVyaWZ5IGFsbCB0aGUg\nY29sbGVjdGVkIGZyYWdtZW50IHJlcGxpY2FzCiAgICAgICAgRnVsbExlZGdl\nckNhbGxiYWNrIGFsbEZyYWdtZW50c0NiID0gbmV3IEZ1bGxMZWRnZXJDYWxs\nYmFjayhmcmFnbWVudHMKICAgICAgICAgICAgICAgIC5zaXplKCksIGNiKTsK\nICAgICAgICBmb3IgKExlZGdlckZyYWdtZW50IHIgOiBmcmFnbWVudHMpIHsK\nICAgICAgICAgICAgTE9HLmRlYnVnKCJDaGVja2luZyBmcmFnbWVudCB7fSIs\nIHIpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmVyaWZ5\nTGVkZ2VyRnJhZ21lbnQociwgYWxsRnJhZ21lbnRzQ2IpOwogICAgICAgICAg\nICB9IGNhdGNoIChJbnZhbGlkRnJhZ21lbnRFeGNlcHRpb24gaWZlKSB7CiAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIkludmFsaWQgZnJhZ21lbnQgZm91\nbmQgOiB7fSIsIHIpOwogICAgICAgICAgICAgICAgYWxsRnJhZ21lbnRzQ2Iu\nb3BlcmF0aW9uQ29tcGxldGUoCiAgICAgICAgICAgICAgICAgICAgICAgIEJL\nRXhjZXB0aW9uLkNvZGUuSW5jb3JyZWN0UGFyYW1ldGVyRXhjZXB0aW9uLCBy\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

