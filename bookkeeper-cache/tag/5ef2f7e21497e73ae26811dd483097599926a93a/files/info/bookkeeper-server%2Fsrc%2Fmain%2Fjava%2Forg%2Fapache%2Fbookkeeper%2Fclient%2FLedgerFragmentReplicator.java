{"sha":"0a4f045fc9e6dcab434c26456abdf2f1dc392251","node_id":"MDQ6QmxvYjE1NzU5NTY6MGE0ZjA0NWZjOWU2ZGNhYjQzNGMyNjQ1NmFiZGYyZjFkYzM5MjI1MQ==","size":19326,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0a4f045fc9e6dcab434c26456abdf2f1dc392251","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7CgppbXBv\ncnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRl\ncmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suUmVh\nZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkJvb2tpZVByb3RvY29sOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2Fs\nbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9v\na2tlZXBlckludGVybmFsQ2FsbGJhY2tzLk11bHRpQ2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVy\nbmFsQ2FsbGJhY2tzLldyaXRlQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIudXRpbC5PcmRlcmVkU2FmZUV4ZWN1dG9yLk9yZGVyZWRT\nYWZlR2VuZXJpY0NhbGxiYWNrOwoKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLkFzeW5jQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5LZWVwZXJFeGNlcHRpb24uQ29kZTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0\neS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBU\naGlzIGlzIHRoZSBoZWxwZXIgY2xhc3MgZm9yIHJlcGxpY2F0aW5nIHRoZSBm\ncmFnbWVudHMgZnJvbSBvbmUgYm9va2llIHRvCiAqIGFub3RoZXIKICovCnB1\nYmxpYyBjbGFzcyBMZWRnZXJGcmFnbWVudFJlcGxpY2F0b3IgewoKICAgIC8v\nIEJvb2tLZWVwZXIgaW5zdGFuY2UKICAgIHByaXZhdGUgQm9va0tlZXBlciBi\na2M7CgogICAgcHVibGljIExlZGdlckZyYWdtZW50UmVwbGljYXRvcihCb29r\nS2VlcGVyIGJrYykgewogICAgICAgIHRoaXMuYmtjID0gYmtjOwogICAgfQoK\nICAgIHByaXZhdGUgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5\nCiAgICAgICAgICAgIC5nZXRMb2dnZXIoTGVkZ2VyRnJhZ21lbnRSZXBsaWNh\ndG9yLmNsYXNzKTsKCiAgICBwcml2YXRlIHZvaWQgcmVwbGljYXRlRnJhZ21l\nbnRJbnRlcm5hbChmaW5hbCBMZWRnZXJIYW5kbGUgbGgsCiAgICAgICAgICAg\nIGZpbmFsIExlZGdlckZyYWdtZW50IGxmLAogICAgICAgICAgICBmaW5hbCBB\nc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBsZWRnZXJGcmFnbWVudE1jYiwK\nICAgICAgICAgICAgZmluYWwgSW5ldFNvY2tldEFkZHJlc3MgbmV3Qm9va2ll\nKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIGlmICgh\nbGYuaXNDbG9zZWQoKSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRyeWlu\nZyB0byByZXBsaWNhdGUgYW4gdW5jbG9zZWQgZnJhZ21lbnQ7IgogICAgICAg\nICAgICAgICAgICAgICAgKyAiIFRoaXMgaXMgbm90IHNhZmUge30iLCBsZik7\nCiAgICAgICAgICAgIGxlZGdlckZyYWdtZW50TWNiLnByb2Nlc3NSZXN1bHQo\nQktFeGNlcHRpb24uQ29kZS5VbmNsb3NlZEZyYWdtZW50RXhjZXB0aW9uLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51\nbGwsIG51bGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAg\nICAgIExvbmcgc3RhcnRFbnRyeUlkID0gbGYuZ2V0Rmlyc3RTdG9yZWRFbnRy\neUlkKCk7CiAgICAgICAgTG9uZyBlbmRFbnRyeUlkID0gbGYuZ2V0TGFzdFN0\nb3JlZEVudHJ5SWQoKTsKICAgICAgICBpZiAoZW5kRW50cnlJZCA9PSBudWxs\nKSB7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIElkZWFsbHkgdGhp\ncyBzaG91bGQgbmV2ZXIgaGFwcGVuIGlmIGJvb2tpZSBmYWlsdXJlIGlzIHRh\na2VuIGNhcmUKICAgICAgICAgICAgICogb2YgcHJvcGVybHkuIE5vdGhpbmcg\nd2UgY2FuIGRvIHRob3VnaCBpbiB0aGlzIGNhc2UuCiAgICAgICAgICAgICAq\nLwogICAgICAgICAgICBMT0cud2FybigiRGVhZCBib29raWUgKCIgKyBsZi5n\nZXRBZGRyZXNzKCkKICAgICAgICAgICAgICAgICAgICArICIpIGlzIHN0aWxs\nIHBhcnQgb2YgdGhlIGN1cnJlbnQiCiAgICAgICAgICAgICAgICAgICAgKyAi\nIGFjdGl2ZSBlbnNlbWJsZSBmb3IgbGVkZ2VySWQ6ICIgKyBsaC5nZXRJZCgp\nKTsKICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRNY2IucHJvY2Vzc1Jlc3Vs\ndChCS0V4Y2VwdGlvbi5Db2RlLk9LLCBudWxsLCBudWxsKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnRFbnRyeUlk\nID4gZW5kRW50cnlJZCkgewogICAgICAgICAgICAvLyBmb3Igb3BlbiBsZWRn\nZXIgd2hpY2ggdGhlcmUgaXMgbm8gZW50cnksIHRoZSBzdGFydCBlbnRyeSBp\nZCBpcyAwLAogICAgICAgICAgICAvLyB0aGUgZW5kIGVudHJ5IGlkIGlzIC0x\nLgogICAgICAgICAgICAvLyB3ZSBjYW4gcmV0dXJuIGltbWVkaWF0ZWx5IHRv\nIHRyaWdnZXIgZm9yd2FyZCByZWFkCiAgICAgICAgICAgIGxlZGdlckZyYWdt\nZW50TWNiLnByb2Nlc3NSZXN1bHQoQktFeGNlcHRpb24uQ29kZS5PSywgbnVs\nbCwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIC8qCiAgICAgICAgICogQWRkIGFsbCB0aGUgZW50cmllcyB0byBlbnRy\naWVzVG9SZXBsaWNhdGUgbGlzdCBmcm9tCiAgICAgICAgICogZmlyc3RTdG9y\nZWRFbnRyeUlkIHRvIGxhc3RTdG9yZWRFbnRyeUlELgogICAgICAgICAqLwog\nICAgICAgIExpc3Q8TG9uZz4gZW50cmllc1RvUmVwbGljYXRlID0gbmV3IExp\nbmtlZExpc3Q8TG9uZz4oKTsKICAgICAgICBsb25nIGxhc3RTdG9yZWRFbnRy\neUlkID0gbGYuZ2V0TGFzdFN0b3JlZEVudHJ5SWQoKTsKICAgICAgICBmb3Ig\nKGxvbmcgaSA9IGxmLmdldEZpcnN0U3RvcmVkRW50cnlJZCgpOyBpIDw9IGxh\nc3RTdG9yZWRFbnRyeUlkOyBpKyspIHsKICAgICAgICAgICAgZW50cmllc1Rv\nUmVwbGljYXRlLmFkZChpKTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAg\nICAgKiBOb3cgYXN5bmNocm9ub3VzbHkgcmVwbGljYXRlIGFsbCBvZiB0aGUg\nZW50cmllcyBmb3IgdGhlIGxlZGdlcgogICAgICAgICAqIGZyYWdtZW50IHRo\nYXQgd2VyZSBvbiB0aGUgZGVhZCBib29raWUuCiAgICAgICAgICovCiAgICAg\nICAgTXVsdGlDYWxsYmFjayBsZWRnZXJGcmFnbWVudEVudHJ5TWNiID0gbmV3\nIE11bHRpQ2FsbGJhY2soCiAgICAgICAgICAgICAgICBlbnRyaWVzVG9SZXBs\naWNhdGUuc2l6ZSgpLCBsZWRnZXJGcmFnbWVudE1jYiwgbnVsbCwgQktFeGNl\ncHRpb24uQ29kZS5PSywKICAgICAgICAgICAgICAgIEJLRXhjZXB0aW9uLkNv\nZGUuTGVkZ2VyUmVjb3ZlcnlFeGNlcHRpb24pOwogICAgICAgIGZvciAoZmlu\nYWwgTG9uZyBlbnRyeUlkIDogZW50cmllc1RvUmVwbGljYXRlKSB7CiAgICAg\nICAgICAgIHJlY292ZXJMZWRnZXJGcmFnbWVudEVudHJ5KGVudHJ5SWQsIGxo\nLCBsZWRnZXJGcmFnbWVudEVudHJ5TWNiLAogICAgICAgICAgICAgICAgICAg\nIG5ld0Jvb2tpZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVGhpcyBtZXRob2QgcmVwbGljYXRlIGEgbGVkZ2VyIGZyYWdtZW50IHdoaWNo\nIGlzIGEgY29udGlndW91cyBwb3J0aW9uIG9mCiAgICAgKiBhIGxlZGdlciB0\naGF0IHdhcyBzdG9yZWQgaW4gYW4gZW5zZW1ibGUgdGhhdCBpbmNsdWRlZCB0\naGUgZmFpbGVkIGJvb2tpZS4KICAgICAqIEl0IHdpbGwgU3BsaXRzIHRoZSBm\ncmFnbWVudCBpbnRvIG11bHRpcGxlIHN1YiBmcmFnbWVudHMgYnkga2VlcGlu\nZyB0aGUKICAgICAqIG1heCBlbnRyaWVzIHVwIHRvIHRoZSBjb25maWd1cmVk\nIHZhbHVlIG9mIHJlcmVwbGljYXRpb25FbnRyeUJhdGNoU2l6ZSBhbmQKICAg\nICAqIHRoZW4gaXQgcmUtcmVwbGljYXRlcyB0aGF0IGJhdGNoZWQgZW50cnkg\nZnJhZ21lbnRzIG9uZSBieSBvbmUuIEFmdGVyCiAgICAgKiByZS1yZXBsaWNh\ndGlvbiBvZiBhbGwgYmF0Y2hlZCBlbnRyeSBmcmFnbWVudHMsIGl0IHdpbGwg\ndXBkYXRlIHRoZQogICAgICogZW5zZW1ibGUgaW5mbyB3aXRoIG5ldyBCb29r\naWUgb25jZQogICAgICogCiAgICAgKiBAcGFyYW0gbGgKICAgICAqICAgICAg\nICAgICAgTGVkZ2VySGFuZGxlIGZvciB0aGUgbGVkZ2VyCiAgICAgKiBAcGFy\nYW0gbGYKICAgICAqICAgICAgICAgICAgTGVkZ2VyRnJhZ21lbnQgdG8gcmVw\nbGljYXRlCiAgICAgKiBAcGFyYW0gbGVkZ2VyRnJhZ21lbnRNY2IKICAgICAq\nICAgICAgICAgICAgTXVsdGlDYWxsYmFjayB0byBpbnZva2Ugb25jZSB3ZSd2\nZSByZWNvdmVyZWQgdGhlIGN1cnJlbnQKICAgICAqICAgICAgICAgICAgbGVk\nZ2VyIGZyYWdtZW50LgogICAgICogQHBhcmFtIHRhcmdldEJvb2tpZUFkZHJl\nc3MKICAgICAqICAgICAgICAgICAgTmV3IGJvb2tpZSB3ZSB3YW50IHRvIHVz\nZSB0byByZWNvdmVyIGFuZCByZXBsaWNhdGUgdGhlIGxlZGdlcgogICAgICog\nICAgICAgICAgICBlbnRyaWVzIHRoYXQgd2VyZSBzdG9yZWQgb24gdGhlIGZh\naWxlZCBib29raWUuCiAgICAgKi8KICAgIHZvaWQgcmVwbGljYXRlKGZpbmFs\nIExlZGdlckhhbmRsZSBsaCwgZmluYWwgTGVkZ2VyRnJhZ21lbnQgbGYsCiAg\nICAgICAgICAgIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGxl\nZGdlckZyYWdtZW50TWNiLAogICAgICAgICAgICBmaW5hbCBJbmV0U29ja2V0\nQWRkcmVzcyB0YXJnZXRCb29raWVBZGRyZXNzKQogICAgICAgICAgICB0aHJv\nd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIFNldDxMZWRnZXJG\ncmFnbWVudD4gcGFydGlvbmVkRnJhZ21lbnRzID0gc3BsaXRJbnRvU3ViRnJh\nZ21lbnRzKGxoLCBsZiwKICAgICAgICAgICAgICAgIGJrYy5nZXRDb25mKCku\nZ2V0UmVyZXBsaWNhdGlvbkVudHJ5QmF0Y2hTaXplKCkpOwogICAgICAgIExP\nRy5pbmZvKCJGcmFnbWVudCA6IiArIGxmICsgIiBpcyBzcGxpdCBpbnRvIHN1\nYiBmcmFnbWVudHMgOiIKICAgICAgICAgICAgICAgICsgcGFydGlvbmVkRnJh\nZ21lbnRzKTsKICAgICAgICByZXBsaWNhdGVOZXh0QmF0Y2gobGgsIHBhcnRp\nb25lZEZyYWdtZW50cy5pdGVyYXRvcigpLAogICAgICAgICAgICAgICAgbGVk\nZ2VyRnJhZ21lbnRNY2IsIHRhcmdldEJvb2tpZUFkZHJlc3MpOwogICAgfQoK\nICAgIC8qKiBSZXBsaWNhdGUgdGhlIGJhdGNoZWQgZW50cnkgZnJhZ21lbnRz\nIG9uZSBhZnRlciBvdGhlciAqLwogICAgcHJpdmF0ZSB2b2lkIHJlcGxpY2F0\nZU5leHRCYXRjaChmaW5hbCBMZWRnZXJIYW5kbGUgbGgsCiAgICAgICAgICAg\nIGZpbmFsIEl0ZXJhdG9yPExlZGdlckZyYWdtZW50PiBmcmFnbWVudHMsCiAg\nICAgICAgICAgIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGxl\nZGdlckZyYWdtZW50TWNiLAogICAgICAgICAgICBmaW5hbCBJbmV0U29ja2V0\nQWRkcmVzcyB0YXJnZXRCb29raWVBZGRyZXNzKSB7CiAgICAgICAgaWYgKGZy\nYWdtZW50cy5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIHJlcGxpY2F0ZUZyYWdtZW50SW50ZXJuYWwobGgsIGZyYWdt\nZW50cy5uZXh0KCksCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBBc3lu\nY0NhbGxiYWNrLlZvaWRDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyB2\nLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRNY2Iu\ncHJvY2Vzc1Jlc3VsdChyYywgbnVsbCwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXBsaWNhdGVOZXh0QmF0Y2gobGgsIGZyYWdt\nZW50cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsZWRnZXJGcmFnbWVudE1jYiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRCb29raWVBZGRyZXNzKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICB9\nLCB0YXJnZXRCb29raWVBZGRyZXNzKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgbGVk\nZ2VyRnJhZ21lbnRNY2IucHJvY2Vzc1Jlc3VsdCgKICAgICAgICAgICAgICAg\nICAgICAgICAgQktFeGNlcHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiwgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVu\ndFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRNY2IucHJvY2Vz\nc1Jlc3VsdChCS0V4Y2VwdGlvbi5Db2RlLk9LLCBudWxsLCBudWxsKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTcGxpdCB0aGUgZnVsbCBm\ncmFnbWVudCBpbnRvIGJhdGNoZWQgZW50cnkgZnJhZ21lbnRzIGJ5IGtlZXBp\nbmcKICAgICAqIHJlcmVwbGljYXRpb25FbnRyeUJhdGNoU2l6ZSBvZiBlbnRy\naWVzIGluIGVhY2ggb25lIGFuZCBjYW4gdHJlYXQgdGhlbSBhcwogICAgICog\nc3ViIGZyYWdtZW50cwogICAgICovCiAgICBzdGF0aWMgU2V0PExlZGdlckZy\nYWdtZW50PiBzcGxpdEludG9TdWJGcmFnbWVudHMoTGVkZ2VySGFuZGxlIGxo\nLAogICAgICAgICAgICBMZWRnZXJGcmFnbWVudCBsZWRnZXJGcmFnbWVudCwg\nbG9uZyByZXJlcGxpY2F0aW9uRW50cnlCYXRjaFNpemUpIHsKICAgICAgICBT\nZXQ8TGVkZ2VyRnJhZ21lbnQ+IGZyYWdtZW50cyA9IG5ldyBIYXNoU2V0PExl\nZGdlckZyYWdtZW50PigpOwogICAgICAgIGlmIChyZXJlcGxpY2F0aW9uRW50\ncnlCYXRjaFNpemUgPD0gMCkgewogICAgICAgICAgICAvLyByZXJlcGxpY2F0\naW9uRW50cnlCYXRjaFNpemUgY2FuIG5vdCBiZSAwIG9yIGxlc3MgdGhhbiAw\nLAogICAgICAgICAgICAvLyByZXR1cm5pbmcgd2l0aCB0aGUgY3VycmVudCBm\ncmFnbWVudAogICAgICAgICAgICBmcmFnbWVudHMuYWRkKGxlZGdlckZyYWdt\nZW50KTsKICAgICAgICAgICAgcmV0dXJuIGZyYWdtZW50czsKICAgICAgICB9\nCgogICAgICAgIGxvbmcgZmlyc3RFbnRyeUlkID0gbGVkZ2VyRnJhZ21lbnQu\nZ2V0Rmlyc3RTdG9yZWRFbnRyeUlkKCk7CiAgICAgICAgbG9uZyBsYXN0RW50\ncnlJZCA9IGxlZGdlckZyYWdtZW50LmdldExhc3RTdG9yZWRFbnRyeUlkKCk7\nCiAgICAgICAgbG9uZyBudW1iZXJPZkVudHJpZXNUb1JlcGxpY2F0ZSA9IChs\nYXN0RW50cnlJZCAtIGZpcnN0RW50cnlJZCkgKyAxOwogICAgICAgIGxvbmcg\nc3BsaXRzV2l0aEZ1bGxFbnRyaWVzID0gbnVtYmVyT2ZFbnRyaWVzVG9SZXBs\naWNhdGUKICAgICAgICAgICAgICAgIC8gcmVyZXBsaWNhdGlvbkVudHJ5QmF0\nY2hTaXplOwoKICAgICAgICBpZiAoc3BsaXRzV2l0aEZ1bGxFbnRyaWVzID09\nIDApIHsvLyBvbmx5IG9uZSBmcmFnbWVudAogICAgICAgICAgICBmcmFnbWVu\ndHMuYWRkKGxlZGdlckZyYWdtZW50KTsKICAgICAgICAgICAgcmV0dXJuIGZy\nYWdtZW50czsKICAgICAgICB9CgogICAgICAgIGxvbmcgZnJhZ21lbnRTcGxp\ndExhc3RFbnRyeSA9IDA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ncGxpdHNXaXRoRnVsbEVudHJpZXM7IGkrKykgewogICAgICAgICAgICBmcmFn\nbWVudFNwbGl0TGFzdEVudHJ5ID0gKGZpcnN0RW50cnlJZCArIHJlcmVwbGlj\nYXRpb25FbnRyeUJhdGNoU2l6ZSkgLSAxOwogICAgICAgICAgICBmcmFnbWVu\ndHMuYWRkKG5ldyBMZWRnZXJGcmFnbWVudChsaCwgZmlyc3RFbnRyeUlkLAog\nICAgICAgICAgICAgICAgICAgIGZyYWdtZW50U3BsaXRMYXN0RW50cnksIGxl\nZGdlckZyYWdtZW50LmdldEJvb2tpZXNJbmRleCgpKSk7CiAgICAgICAgICAg\nIGZpcnN0RW50cnlJZCA9IGZyYWdtZW50U3BsaXRMYXN0RW50cnkgKyAxOwog\nICAgICAgIH0KCiAgICAgICAgbG9uZyBsYXN0U3BsaXRXaXRoUGFydGlhbEVu\ndHJpZXMgPSBudW1iZXJPZkVudHJpZXNUb1JlcGxpY2F0ZQogICAgICAgICAg\nICAgICAgJSByZXJlcGxpY2F0aW9uRW50cnlCYXRjaFNpemU7CiAgICAgICAg\naWYgKGxhc3RTcGxpdFdpdGhQYXJ0aWFsRW50cmllcyA+IDApIHsKICAgICAg\nICAgICAgZnJhZ21lbnRzLmFkZChuZXcgTGVkZ2VyRnJhZ21lbnQobGgsIGZp\ncnN0RW50cnlJZCwgZmlyc3RFbnRyeUlkCiAgICAgICAgICAgICAgICAgICAg\nKyBsYXN0U3BsaXRXaXRoUGFydGlhbEVudHJpZXMgLSAxLCBsZWRnZXJGcmFn\nbWVudAogICAgICAgICAgICAgICAgICAgIC5nZXRCb29raWVzSW5kZXgoKSkp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZnJhZ21lbnRzOwogICAgfQoK\nICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgYXN5bmNocm9ub3VzbHkgcmVj\nb3ZlcnMgYSBzcGVjaWZpYyBsZWRnZXIgZW50cnkgYnkgcmVhZGluZwogICAg\nICogdGhlIHZhbHVlcyB2aWEgdGhlIEJvb2tLZWVwZXIgQ2xpZW50ICh3aGlj\naCB3b3VsZCByZWFkIGl0IGZyb20gdGhlIG90aGVyCiAgICAgKiByZXBsaWNh\ncykgYW5kIHRoZW4gd3JpdGluZyBpdCB0byB0aGUgY2hvc2VuIG5ldyBib29r\naWUuCiAgICAgKiAKICAgICAqIEBwYXJhbSBlbnRyeUlkCiAgICAgKiAgICAg\nICAgICAgIExlZGdlciBFbnRyeSBJRCB0byByZWNvdmVyLgogICAgICogQHBh\ncmFtIGxoCiAgICAgKiAgICAgICAgICAgIExlZGdlckhhbmRsZSBmb3IgdGhl\nIGxlZGdlcgogICAgICogQHBhcmFtIGxlZGdlckZyYWdtZW50RW50cnlNY2IK\nICAgICAqICAgICAgICAgICAgTXVsdGlDYWxsYmFjayB0byBpbnZva2Ugb25j\nZSB3ZSd2ZSByZWNvdmVyZWQgdGhlIGN1cnJlbnQKICAgICAqICAgICAgICAg\nICAgbGVkZ2VyIGVudHJ5LgogICAgICogQHBhcmFtIG5ld0Jvb2tpZQogICAg\nICogICAgICAgICAgICBOZXcgYm9va2llIHdlIHdhbnQgdG8gdXNlIHRvIHJl\nY292ZXIgYW5kIHJlcGxpY2F0ZSB0aGUgbGVkZ2VyCiAgICAgKiAgICAgICAg\nICAgIGVudHJpZXMgdGhhdCB3ZXJlIHN0b3JlZCBvbiB0aGUgZmFpbGVkIGJv\nb2tpZS4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY292ZXJMZWRnZXJG\ncmFnbWVudEVudHJ5KGZpbmFsIExvbmcgZW50cnlJZCwKICAgICAgICAgICAg\nZmluYWwgTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICBmaW5hbCBBc3lu\nY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBsZWRnZXJGcmFnbWVudEVudHJ5TWNi\nLAogICAgICAgICAgICBmaW5hbCBJbmV0U29ja2V0QWRkcmVzcyBuZXdCb29r\naWUpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgLyoK\nICAgICAgICAgKiBSZWFkIHRoZSBsZWRnZXIgZW50cnkgdXNpbmcgdGhlIExl\nZGdlckhhbmRsZS4gVGhpcyB3aWxsIGFsbG93IHVzIHRvCiAgICAgICAgICog\ncmVhZCB0aGUgZW50cnkgZnJvbSBvbmUgb2YgdGhlIG90aGVyIHJlcGxpY2F0\nZWQgYm9va2llcyBvdGhlciB0aGFuCiAgICAgICAgICogdGhlIGRlYWQgb25l\nLgogICAgICAgICAqLwogICAgICAgIGxoLmFzeW5jUmVhZEVudHJpZXMoZW50\ncnlJZCwgZW50cnlJZCwgbmV3IFJlYWRDYWxsYmFjaygpIHsKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJlYWRDb21w\nbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgICAg\nICAgICBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5PSy5pbnRWYWx1\nZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJCSyBlcnJv\nciByZWFkaW5nIGxlZGdlciBlbnRyeTogIiArIGVudHJ5SWQsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpKTsK\nICAgICAgICAgICAgICAgICAgICBsZWRnZXJGcmFnbWVudEVudHJ5TWNiLnBy\nb2Nlc3NSZXN1bHQocmMsIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIC8qCiAgICAgICAgICAgICAgICAgKiBOb3cgdGhhdCB3ZSd2ZSByZWFkIHRo\nZSBsZWRnZXIgZW50cnksIHdyaXRlIGl0IHRvIHRoZSBuZXcKICAgICAgICAg\nICAgICAgICAqIGJvb2tpZSB3ZSd2ZSBzZWxlY3RlZC4KICAgICAgICAgICAg\nICAgICAqLwogICAgICAgICAgICAgICAgTGVkZ2VyRW50cnkgZW50cnkgPSBz\nZXEubmV4dEVsZW1lbnQoKTsKICAgICAgICAgICAgICAgIGJ5dGVbXSBkYXRh\nID0gZW50cnkuZ2V0RW50cnkoKTsKICAgICAgICAgICAgICAgIENoYW5uZWxC\ndWZmZXIgdG9TZW5kID0gbGguZ2V0RGlnZXN0TWFuYWdlcigpCiAgICAgICAg\nICAgICAgICAgICAgICAgIC5jb21wdXRlRGlnZXN0QW5kUGFja2FnZUZvclNl\nbmRpbmcoZW50cnlJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCksIGVudHJ5LmdldExlbmd0aCgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEsIDAsIGRh\ndGEubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGJrYy5nZXRCb29raWVDbGll\nbnQoKS5hZGRFbnRyeShuZXdCb29raWUsIGxoLmdldElkKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgIGxoLmdldExlZGdlcktleSgpLCBlbnRyeUlkLCB0\nb1NlbmQsCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBXcml0ZUNhbGxi\nYWNrKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCB3cml0\nZUNvbXBsZXRlKGludCByYywgbG9uZyBsZWRnZXJJZCwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbG9uZyBlbnRyeUlkLCBJbmV0U29j\na2V0QWRkcmVzcyBhZGRyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFsdWUoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJL\nIGVycm9yIHdyaXRpbmcgZW50cnkgZm9yIGxlZGdlcklkOiAiCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nIGxlZGdlcklkICsgIiwgZW50cnlJZDogIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBlbnRyeUlkICsg\nIiwgYm9va2llOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIGFkZHIsIEJLRXhjZXB0aW9uCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAuY3JlYXRlKHJjKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlN1Y2Nlc3Mg\nd3JpdGluZyBsZWRnZXIgaWQgIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIGxlZGdlcklkICsgIiwgZW50cnkg\naWQgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArIGVudHJ5SWQgKyAiIHRvIGEgbmV3IGJvb2tpZSAiCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nYWRkciArICIhIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKiBQYXNzIHRoZSByZXR1cm4gY29kZSByZXN1\nbHQgdXAgdGhlIGNoYWluIHdpdGgKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKiB0aGUgcGFyZW50IGNhbGxiYWNrLgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGxlZGdlckZyYWdtZW50RW50cnlNY2IucHJvY2Vzc1Jlc3Vs\ndChyYywgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICB9LCBudWxsLCBCb29raWVQcm90b2Nv\nbC5GTEFHX1JFQ09WRVJZX0FERCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nLCBudWxsKTsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDYWxsYmFjayBm\nb3IgcmVjb3Zlcnkgb2YgYSBzaW5nbGUgbGVkZ2VyIGZyYWdtZW50LiBPbmNl\nIHRoZSBmcmFnbWVudCBoYXMKICAgICAqIGhhZCBhbGwgZW50cmllcyByZXBs\naWNhdGVkLCB1cGRhdGUgdGhlIGVuc2VtYmxlIGluIHpvb2tlZXBlci4gT25j\nZQogICAgICogZmluaXNoZWQgcHJvcG9nYXRlIGNhbGxiYWNrIHVwIHRvIGxl\nZGdlckZyYWdtZW50c01jYiB3aGljaCBzaG91bGQgYmUgYQogICAgICogbXVs\ndGljYWxsYmFjayByZXNwb25zaWJsZSBmb3IgYWxsIGZyYWdtZW50cyBpbiBh\nIHNpbmdsZSBsZWRnZXIKICAgICAqLwogICAgc3RhdGljIGNsYXNzIFNpbmds\nZUZyYWdtZW50Q2FsbGJhY2sgaW1wbGVtZW50cyBBc3luY0NhbGxiYWNrLlZv\naWRDYWxsYmFjayB7CiAgICAgICAgZmluYWwgQXN5bmNDYWxsYmFjay5Wb2lk\nQ2FsbGJhY2sgbGVkZ2VyRnJhZ21lbnRzTWNiOwogICAgICAgIGZpbmFsIExl\nZGdlckhhbmRsZSBsaDsKICAgICAgICBmaW5hbCBsb25nIGZyYWdtZW50U3Rh\ncnRJZDsKICAgICAgICBmaW5hbCBJbmV0U29ja2V0QWRkcmVzcyBvbGRCb29r\naWU7CiAgICAgICAgZmluYWwgSW5ldFNvY2tldEFkZHJlc3MgbmV3Qm9va2ll\nOwoKICAgICAgICBTaW5nbGVGcmFnbWVudENhbGxiYWNrKEFzeW5jQ2FsbGJh\nY2suVm9pZENhbGxiYWNrIGxlZGdlckZyYWdtZW50c01jYiwKICAgICAgICAg\nICAgICAgIExlZGdlckhhbmRsZSBsaCwgbG9uZyBmcmFnbWVudFN0YXJ0SWQs\nCiAgICAgICAgICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBvbGRCb29raWUs\nIEluZXRTb2NrZXRBZGRyZXNzIG5ld0Jvb2tpZSkgewogICAgICAgICAgICB0\naGlzLmxlZGdlckZyYWdtZW50c01jYiA9IGxlZGdlckZyYWdtZW50c01jYjsK\nICAgICAgICAgICAgdGhpcy5saCA9IGxoOwogICAgICAgICAgICB0aGlzLmZy\nYWdtZW50U3RhcnRJZCA9IGZyYWdtZW50U3RhcnRJZDsKICAgICAgICAgICAg\ndGhpcy5uZXdCb29raWUgPSBuZXdCb29raWU7CiAgICAgICAgICAgIHRoaXMu\nb2xkQm9va2llID0gb2xkQm9va2llOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQg\ncmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIGlm\nIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiQksgZXJyb3IgcmVwbGljYXRpbmcgbGVkZ2VyIGZyYWdt\nZW50cyBmb3IgbGVkZ2VyOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsg\nbGguZ2V0SWQoKSwgQktFeGNlcHRpb24uY3JlYXRlKHJjKSk7CiAgICAgICAg\nICAgICAgICBsZWRnZXJGcmFnbWVudHNNY2IucHJvY2Vzc1Jlc3VsdChyYywg\nbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgdXBkYXRlRW5zZW1ibGVJbmZvKGxlZGdlckZy\nYWdtZW50c01jYiwgZnJhZ21lbnRTdGFydElkLCBsaCwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZEJvb2tpZSwgbmV3Qm9v\na2llKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqIFVwZGF0ZXMgdGhlIGVu\nc2VtYmxlIHdpdGggbmV3Qm9va2llIGFuZCBub3RpZnkgdGhlIGVuc2VtYmxl\nVXBkYXRlZENiICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHVwZGF0ZUVu\nc2VtYmxlSW5mbygKICAgICAgICAgICAgQXN5bmNDYWxsYmFjay5Wb2lkQ2Fs\nbGJhY2sgZW5zZW1ibGVVcGRhdGVkQ2IsIGxvbmcgZnJhZ21lbnRTdGFydElk\nLAogICAgICAgICAgICBMZWRnZXJIYW5kbGUgbGgsIEluZXRTb2NrZXRBZGRy\nZXNzIG9sZEJvb2tpZSwKICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3Mg\nbmV3Qm9va2llKSB7CiAgICAgICAgLyoKICAgICAgICAgKiBVcGRhdGUgdGhl\nIGxlZGdlciBtZXRhZGF0YSdzIGVuc2VtYmxlIGluZm8gdG8gcG9pbnQgdG8g\ndGhlIG5ldwogICAgICAgICAqIGJvb2tpZS4KICAgICAgICAgKi8KICAgICAg\nICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGVuc2VtYmxlID0gbGgu\nZ2V0TGVkZ2VyTWV0YWRhdGEoKQogICAgICAgICAgICAgICAgLmdldEVuc2Vt\nYmxlcygpLmdldChmcmFnbWVudFN0YXJ0SWQpOwogICAgICAgIGludCBkZWFk\nQm9va2llSW5kZXggPSBlbnNlbWJsZS5pbmRleE9mKG9sZEJvb2tpZSk7CiAg\nICAgICAgZW5zZW1ibGUucmVtb3ZlKGRlYWRCb29raWVJbmRleCk7CiAgICAg\nICAgZW5zZW1ibGUuYWRkKGRlYWRCb29raWVJbmRleCwgbmV3Qm9va2llKTsK\nICAgICAgICBsaC53cml0ZUxlZGdlckNvbmZpZyhuZXcgVXBkYXRlRW5zZW1i\nbGVDYihlbnNlbWJsZVVwZGF0ZWRDYiwKICAgICAgICAgICAgICAgIGZyYWdt\nZW50U3RhcnRJZCwgbGgsIG9sZEJvb2tpZSwgbmV3Qm9va2llKSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGVuc2VtYmxlIGRhdGEgd2l0\naCBuZXdCb29raWUuIHJlLXJlYWRzIHRoZSBtZXRhZGF0YSBvbgogICAgICog\nTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uIGFuZCB1cGRhdGUgZW5zZW1ibGUg\nYWdhaW4uIE9uIHN1Y2Nlc3NmdWxsCiAgICAgKiB1cGRhdGlvbiwgaXQgd2ls\nbCBhbHNvIG5vdGlmeSB0byBzdXBlciBjYWxsIGJhY2sKICAgICAqLwogICAg\ncHJpdmF0ZSBzdGF0aWMgY2xhc3MgVXBkYXRlRW5zZW1ibGVDYiBpbXBsZW1l\nbnRzIEdlbmVyaWNDYWxsYmFjazxWb2lkPiB7CiAgICAgICAgZmluYWwgQXN5\nbmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgZW5zZW1ibGVVcGRhdGVkQ2I7CiAg\nICAgICAgZmluYWwgTGVkZ2VySGFuZGxlIGxoOwogICAgICAgIGZpbmFsIGxv\nbmcgZnJhZ21lbnRTdGFydElkOwogICAgICAgIGZpbmFsIEluZXRTb2NrZXRB\nZGRyZXNzIG9sZEJvb2tpZTsKICAgICAgICBmaW5hbCBJbmV0U29ja2V0QWRk\ncmVzcyBuZXdCb29raWU7CgogICAgICAgIHB1YmxpYyBVcGRhdGVFbnNlbWJs\nZUNiKEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGxlZGdlckZyYWdtZW50\nc01jYiwKICAgICAgICAgICAgICAgIGxvbmcgZnJhZ21lbnRTdGFydElkLCBM\nZWRnZXJIYW5kbGUgbGgsCiAgICAgICAgICAgICAgICBJbmV0U29ja2V0QWRk\ncmVzcyBvbGRCb29raWUsIEluZXRTb2NrZXRBZGRyZXNzIG5ld0Jvb2tpZSkg\newogICAgICAgICAgICB0aGlzLmVuc2VtYmxlVXBkYXRlZENiID0gbGVkZ2Vy\nRnJhZ21lbnRzTWNiOwogICAgICAgICAgICB0aGlzLmxoID0gbGg7CiAgICAg\nICAgICAgIHRoaXMuZnJhZ21lbnRTdGFydElkID0gZnJhZ21lbnRTdGFydElk\nOwogICAgICAgICAgICB0aGlzLm5ld0Jvb2tpZSA9IG5ld0Jvb2tpZTsKICAg\nICAgICAgICAgdGhpcy5vbGRCb29raWUgPSBvbGRCb29raWU7CiAgICAgICAg\nfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25Db21wbGV0ZShpbnQgcmMsIFZvaWQgcmVzdWx0KSB7CiAgICAgICAg\nICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lv\nbkV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIlR3byBm\ncmFnbWVudHMgYXR0ZW1wdGVkIHVwZGF0ZSBhdCBvbmNlOyBsZWRnZXIgaWQ6\nICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBsaC5nZXRJZCgpICsgIiBz\ndGFydGlkOiAiICsgZnJhZ21lbnRTdGFydElkKTsKICAgICAgICAgICAgICAg\nIC8vIHRyeSBhZ2FpbiwgdGhlIHByZXZpb3VzIHN1Y2Nlc3MgKHdpdGggd2hp\nY2ggdGhpcyBoYXMKICAgICAgICAgICAgICAgIC8vIGNvbmZsaWN0ZWQpIHdp\nbGwgaGF2ZSB1cGRhdGVkIHRoZSBzdGF0IG90aGVyIG9wZXJhdGlvbnMKICAg\nICAgICAgICAgICAgIC8vIHN1Y2ggYXMgKGFkZEVuc2VtYmxlKSB3b3VsZCB1\ncGRhdGUgaXQgdG9vLgogICAgICAgICAgICAgICAgbGgKICAgICAgICAgICAg\nICAgICAgICAgICAgLnJlcmVhZE1ldGFkYXRhKG5ldyBPcmRlcmVkU2FmZUdl\nbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4oCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbGguYmsubWFpbldvcmtlclBvb2wsIGxoLmdl\ndElkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2Fm\nZU9wZXJhdGlvbkNvbXBsZXRlKGludCByYywKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4\nY2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIExPRwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC5lcnJvcigiRXJyb3IgcmVhZGluZyB1cGRhdGVkIGxl\nZGdlciBtZXRhZGF0YSBmb3IgbGVkZ2VyICIKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbGguZ2V0SWQo\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuc2Vt\nYmxlVXBkYXRlZENiLnByb2Nlc3NSZXN1bHQocmMsIG51bGwsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGgubWV0YWRhdGEgPSBu\nZXdNZXRhOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1\ncGRhdGVFbnNlbWJsZUluZm8oZW5zZW1ibGVVcGRhdGVkQ2IsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnRT\ndGFydElkLCBsaCwgb2xkQm9va2llLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIG5ld0Jvb2tpZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfSBlbHNlIGlmIChyYyAhPSBC\nS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkVycm9yIHVwZGF0aW5nIGxlZGdlciBjb25maWcgbWV0YWRhdGEgZm9y\nIGxlZGdlcklkICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBsaC5nZXRJ\nZCgpICsgIiA6ICIgKyBCS0V4Y2VwdGlvbi5nZXRNZXNzYWdlKHJjKSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygi\nVXBkYXRlZCBaSyBmb3IgbGVkZ2VySWQ6ICgiICsgbGguZ2V0SWQoKSArICIg\nOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgZnJhZ21lbnRTdGFydElk\nCiAgICAgICAgICAgICAgICAgICAgICAgICsgIikgdG8gcG9pbnQgbGVkZ2Vy\nIGZyYWdtZW50cyBmcm9tIG9sZCBkZWFkIGJvb2tpZTogKCIKICAgICAgICAg\nICAgICAgICAgICAgICAgKyBvbGRCb29raWUgKyAiKSB0byBuZXcgYm9va2ll\nOiAoIiArIG5ld0Jvb2tpZSArICIpIik7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgLyoKICAgICAgICAgICAgICogUGFzcyB0aGUgcmV0dXJuIGNvZGUg\ncmVzdWx0IHVwIHRoZSBjaGFpbiB3aXRoIHRoZSBwYXJlbnQKICAgICAgICAg\nICAgICogY2FsbGJhY2suCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBl\nbnNlbWJsZVVwZGF0ZWRDYi5wcm9jZXNzUmVzdWx0KHJjLCBudWxsLCBudWxs\nKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

