{"sha":"033cb8aa08b7c5c88f8e5bbf2d38b07432577488","node_id":"MDQ6QmxvYjE1NzU5NTY6MDMzY2I4YWEwOGI3YzVjODhmOGU1YmJmMmQzOGIwNzQzMjU3NzQ4OA==","size":36848,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/033cb8aa08b7c5c88f8e5bbf2d38b07432577488","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZh\nLnNlY3VyaXR5LkdlbmVyYWxTZWN1cml0eUV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRMaW5rZWRRdWV1ZTsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlM\naXN0OwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0aW9uOwppbXBvcnQgamF2\nYS51dGlsLlF1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRv\nbWljLkF0b21pY0ludGVnZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRMYXN0Q29uZmlybWVkQ2Fs\nbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJL\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5Bc3luY0NhbGxiYWNrLkFkZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLkNsb3NlQ2FsbGJh\nY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5j\nQ2FsbGJhY2suUmVhZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbi5CS05vdEVub3VnaEJvb2tpZXNF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50\nLkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuTGVkZ2VyTWV0YWRhdGE7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJh\nY2tzLkdlbmVyaWNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLk9yZGVyZWRTYWZlRXhlY3V0b3IuT3JkZXJlZFNhZmVHZW5l\ncmljQ2FsbGJhY2s7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkJvb2tpZVByb3RvY29sOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlN0\nYXRlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuU2FmZVJ1\nbm5hYmxlOwoKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3Vy\ncmVudC5SYXRlTGltaXRlcjsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVyOwoKLyoqCiAqIExlZGdl\nciBoYW5kbGUgY29udGFpbnMgbGVkZ2VyIG1ldGFkYXRhIGFuZCBpcyB1c2Vk\nIHRvIGFjY2VzcyB0aGUgcmVhZCBhbmQKICogd3JpdGUgb3BlcmF0aW9ucyB0\nbyBhIGxlZGdlci4KICovCnB1YmxpYyBjbGFzcyBMZWRnZXJIYW5kbGUgewog\nICAgZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5Lmdl\ndExvZ2dlcihMZWRnZXJIYW5kbGUuY2xhc3MpOwoKICAgIGZpbmFsIGJ5dGVb\nXSBsZWRnZXJLZXk7CiAgICBMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YTsKICAg\nIGZpbmFsIEJvb2tLZWVwZXIgYms7CiAgICBmaW5hbCBsb25nIGxlZGdlcklk\nOwogICAgbG9uZyBsYXN0QWRkUHVzaGVkOwogICAgbG9uZyBsYXN0QWRkQ29u\nZmlybWVkOwogICAgbG9uZyBsZW5ndGg7CiAgICBmaW5hbCBEaWdlc3RNYW5h\nZ2VyIG1hY01hbmFnZXI7CiAgICBmaW5hbCBEaXN0cmlidXRpb25TY2hlZHVs\nZSBkaXN0cmlidXRpb25TY2hlZHVsZTsKCiAgICBmaW5hbCBSYXRlTGltaXRl\nciB0aHJvdHRsZXI7CgogICAgLyoqCiAgICAgKiBJbnZhbGlkIGVudHJ5IGlk\nLiBUaGlzIHZhbHVlIGlzIHJldHVybmVkIGZyb20gbWV0aG9kcyB3aGljaAog\nICAgICogc2hvdWxkIHJldHVybiBhbiBlbnRyeSBpZCBidXQgdGhlcmUgaXMg\nbm8gdmFsaWQgZW50cnkgYXZhaWxhYmxlLgogICAgICovCiAgICBmaW5hbCBz\ndGF0aWMgcHVibGljIGxvbmcgSU5WQUxJRF9FTlRSWV9JRCA9IEJvb2tpZVBy\nb3RvY29sLklOVkFMSURfRU5UUllfSUQ7CgogICAgZmluYWwgQXRvbWljSW50\nZWdlciBibG9ja0FkZENvbXBsZXRpb25zID0gbmV3IEF0b21pY0ludGVnZXIo\nMCk7CiAgICBmaW5hbCBRdWV1ZTxQZW5kaW5nQWRkT3A+IHBlbmRpbmdBZGRP\ncHMgPSBuZXcgQ29uY3VycmVudExpbmtlZFF1ZXVlPFBlbmRpbmdBZGRPcD4o\nKTsKCiAgICBMZWRnZXJIYW5kbGUoQm9va0tlZXBlciBiaywgbG9uZyBsZWRn\nZXJJZCwgTGVkZ2VyTWV0YWRhdGEgbWV0YWRhdGEsCiAgICAgICAgICAgICAg\nICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlLCBieXRlW10gcGFzc3dvcmQpCiAg\nICAgICAgICAgIHRocm93cyBHZW5lcmFsU2VjdXJpdHlFeGNlcHRpb24sIE51\nbWJlckZvcm1hdEV4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5iayA9IGJrOwog\nICAgICAgIHRoaXMubWV0YWRhdGEgPSBtZXRhZGF0YTsKCiAgICAgICAgaWYg\nKG1ldGFkYXRhLmlzQ2xvc2VkKCkpIHsKICAgICAgICAgICAgbGFzdEFkZENv\nbmZpcm1lZCA9IGxhc3RBZGRQdXNoZWQgPSBtZXRhZGF0YS5nZXRMYXN0RW50\ncnlJZCgpOwogICAgICAgICAgICBsZW5ndGggPSBtZXRhZGF0YS5nZXRMZW5n\ndGgoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsYXN0QWRkQ29u\nZmlybWVkID0gbGFzdEFkZFB1c2hlZCA9IElOVkFMSURfRU5UUllfSUQ7CiAg\nICAgICAgICAgIGxlbmd0aCA9IDA7CiAgICAgICAgfQoKICAgICAgICB0aGlz\nLmxlZGdlcklkID0gbGVkZ2VySWQ7CgogICAgICAgIHRoaXMudGhyb3R0bGVy\nID0gUmF0ZUxpbWl0ZXIuY3JlYXRlKGJrLmdldENvbmYoKS5nZXRUaHJvdHRs\nZVZhbHVlKCkpOwoKICAgICAgICBtYWNNYW5hZ2VyID0gRGlnZXN0TWFuYWdl\nci5pbnN0YW50aWF0ZShsZWRnZXJJZCwgcGFzc3dvcmQsIGRpZ2VzdFR5cGUp\nOwogICAgICAgIHRoaXMubGVkZ2VyS2V5ID0gTWFjRGlnZXN0TWFuYWdlci5n\nZW5EaWdlc3QoImxlZGdlciIsIHBhc3N3b3JkKTsKICAgICAgICBkaXN0cmli\ndXRpb25TY2hlZHVsZSA9IG5ldyBSb3VuZFJvYmluRGlzdHJpYnV0aW9uU2No\nZWR1bGUoCiAgICAgICAgICAgICAgICBtZXRhZGF0YS5nZXRXcml0ZVF1b3J1\nbVNpemUoKSwgbWV0YWRhdGEuZ2V0QWNrUXVvcnVtU2l6ZSgpLCBtZXRhZGF0\nYS5nZXRFbnNlbWJsZVNpemUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBH\nZXQgdGhlIGlkIG9mIHRoZSBjdXJyZW50IGxlZGdlcgogICAgICoKICAgICAq\nIEByZXR1cm4gdGhlIGlkIG9mIHRoZSBsZWRnZXIKICAgICAqLwogICAgcHVi\nbGljIGxvbmcgZ2V0SWQoKSB7CiAgICAgICAgcmV0dXJuIGxlZGdlcklkOwog\nICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBsYXN0IGNvbmZpcm1lZCBl\nbnRyeSBpZCBvbiB0aGlzIGxlZGdlci4gSXQgcmVhZHMKICAgICAqIHRoZSBs\nb2NhbCBzdGF0ZSBvZiB0aGUgbGVkZ2VyIGhhbmRsZSwgd2hpY2ggaXMgZGlm\nZmVyZW50CiAgICAgKiBmcm9tIHRoZSByZWFkTGFzdENvbmZpcm1lZCBjYWxs\nLiBJbiB0aGUgY2FzZSB0aGUgbGVkZ2VyCiAgICAgKiBpcyBub3QgY2xvc2Vk\nIGFuZCB0aGUgY2xpZW50IGlzIGEgcmVhZGVyLCBpdCBpcyBuZWNlc3NhcnkK\nICAgICAqIHRvIGNhbGwgcmVhZExhc3RDb25maXJtZWQgdG8gb2J0YWluIGFu\nIGVzdGltYXRlIG9mIHRoZQogICAgICogbGFzdCBhZGQgb3BlcmF0aW9uIHRo\nYXQgaGFzIGJlZW4gY29uZmlybWVkLgogICAgICoKICAgICAqIEBzZWUgI3Jl\nYWRMYXN0Q29uZmlybWVkKCkKICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBs\nYXN0IGNvbmZpcm1lZCBlbnRyeSBpZCBvciB7QGxpbmsgI0lOVkFMSURfRU5U\nUllfSUQgSU5WQUxJRF9FTlRSWV9JRH0gaWYgbm8gZW50cnkgaGFzIGJlZW4g\nY29uZmlybWVkCiAgICAgKi8KICAgIHB1YmxpYyBsb25nIGdldExhc3RBZGRD\nb25maXJtZWQoKSB7CiAgICAgICAgcmV0dXJuIGxhc3RBZGRDb25maXJtZWQ7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGVudHJ5IGlkIG9mIHRo\nZSBsYXN0IGVudHJ5IHRoYXQgaGFzIGJlZW4gZW5xdWV1ZWQgZm9yIGFkZGl0\naW9uIChidXQKICAgICAqIG1heSBub3QgaGF2ZSBwb3NzaWJseSBiZWVuIHBl\ncnNpdGVkIHRvIHRoZSBsZWRnZXIpCiAgICAgKgogICAgICogQHJldHVybiB0\naGUgaWQgb2YgdGhlIGxhc3QgZW50cnkgcHVzaGVkIG9yIHtAbGluayAjSU5W\nQUxJRF9FTlRSWV9JRCBJTlZBTElEX0VOVFJZX0lEfSBpZiBubyBlbnRyeSBo\nYXMgYmVlbiBwdXNoZWQKICAgICAqLwogICAgc3luY2hyb25pemVkIHB1Ymxp\nYyBsb25nIGdldExhc3RBZGRQdXNoZWQoKSB7CiAgICAgICAgcmV0dXJuIGxh\nc3RBZGRQdXNoZWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIExl\nZGdlcidzIGtleS9wYXNzd29yZC4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJ5\ndGUgYXJyYXkgZm9yIHRoZSBsZWRnZXIncyBrZXkvcGFzc3dvcmQuCiAgICAg\nKi8KICAgIHB1YmxpYyBieXRlW10gZ2V0TGVkZ2VyS2V5KCkgewogICAgICAg\nIHJldHVybiBBcnJheXMuY29weU9mKGxlZGdlcktleSwgbGVkZ2VyS2V5Lmxl\nbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIExlZGdlck1l\ndGFkYXRhCiAgICAgKgogICAgICogQHJldHVybiBMZWRnZXJNZXRhZGF0YSBm\nb3IgdGhlIExlZGdlckhhbmRsZQogICAgICovCiAgICBMZWRnZXJNZXRhZGF0\nYSBnZXRMZWRnZXJNZXRhZGF0YSgpIHsKICAgICAgICByZXR1cm4gbWV0YWRh\ndGE7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIERpZ2VzdE1hbmFn\nZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIERpZ2VzdE1hbmFnZXIgZm9yIHRo\nZSBMZWRnZXJIYW5kbGUKICAgICAqLwogICAgRGlnZXN0TWFuYWdlciBnZXRE\naWdlc3RNYW5hZ2VyKCkgewogICAgICAgIHJldHVybiBtYWNNYW5hZ2VyOwog\nICAgfQoKICAgIC8qKgogICAgICogIEFkZCB0byB0aGUgbGVuZ3RoIG9mIHRo\nZSBsZWRnZXIgaW4gYnl0ZXMuCiAgICAgKgogICAgICogQHBhcmFtIGRlbHRh\nCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KICAgIGxvbmcgYWRkVG9MZW5ndGgo\nbG9uZyBkZWx0YSkgewogICAgICAgIHRoaXMubGVuZ3RoICs9IGRlbHRhOwog\nICAgICAgIHJldHVybiB0aGlzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGUgbGVkZ2VyIGluIGJ5dGVz\nLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIGxlbmd0aCBvZiB0aGUgbGVk\nZ2VyIGluIGJ5dGVzCiAgICAgKi8KICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\nbG9uZyBnZXRMZW5ndGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3Ro\nOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBEaXN0cmlidXRpb24g\nU2NoZWR1bGUKICAgICAqCiAgICAgKiBAcmV0dXJuIERpc3RyaWJ1dGlvblNj\naGVkdWxlIGZvciB0aGUgTGVkZ2VySGFuZGxlCiAgICAgKi8KICAgIERpc3Ry\naWJ1dGlvblNjaGVkdWxlIGdldERpc3RyaWJ1dGlvblNjaGVkdWxlKCkgewog\nICAgICAgIHJldHVybiBkaXN0cmlidXRpb25TY2hlZHVsZTsKICAgIH0KCiAg\nICB2b2lkIHdyaXRlTGVkZ2VyQ29uZmlnKEdlbmVyaWNDYWxsYmFjazxWb2lk\nPiB3cml0ZUNiKSB7CiAgICAgICAgTE9HLmRlYnVnKCJXcml0aW5nIG1ldGFk\nYXRhIHRvIGxlZGdlciBtYW5hZ2VyOiB7fSwge30iLCB0aGlzLmxlZGdlcklk\nLCBtZXRhZGF0YS5nZXRWZXJzaW9uKCkpOwoKICAgICAgICBiay5nZXRMZWRn\nZXJNYW5hZ2VyKCkud3JpdGVMZWRnZXJNZXRhZGF0YShsZWRnZXJJZCwgbWV0\nYWRhdGEsIHdyaXRlQ2IpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2Ug\ndGhpcyBsZWRnZXIgc3luY2hyb25vdXNseS4KICAgICAqIEBzZWUgI2FzeW5j\nQ2xvc2UKICAgICAqLwogICAgcHVibGljIHZvaWQgY2xvc2UoKSAKICAgICAg\nICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlv\nbiB7CiAgICAgICAgU3luY0NvdW50ZXIgY291bnRlciA9IG5ldyBTeW5jQ291\nbnRlcigpOwogICAgICAgIGNvdW50ZXIuaW5jKCk7CgogICAgICAgIGFzeW5j\nQ2xvc2UobmV3IFN5bmNDbG9zZUNhbGxiYWNrKCksIGNvdW50ZXIpOwoKICAg\nICAgICBjb3VudGVyLmJsb2NrKDApOwogICAgICAgIGlmIChjb3VudGVyLmdl\ndHJjKCkgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICB0\naHJvdyBCS0V4Y2VwdGlvbi5jcmVhdGUoY291bnRlci5nZXRyYygpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3luY2hyb25vdXMgY2xv\nc2UsIGFueSBhZGRzIGluIGZsaWdodCB3aWxsIHJldHVybiBlcnJvcnMuCiAg\nICAgKiAKICAgICAqIENsb3NpbmcgYSBsZWRnZXIgd2lsbCBlbnN1cmUgdGhh\ndCBhbGwgY2xpZW50cyBhZ3JlZSBvbiB3aGF0IHRoZSBsYXN0IGVudHJ5IAog\nICAgICogb2YgdGhlIGxlZGdlciBpcy4gVGhpcyBlbnN1cmVzIHRoYXQsIG9u\nY2UgdGhlIGxlZGdlciBoYXMgYmVlbiBjbG9zZWQsIGFsbCAKICAgICAqIHJl\nYWRzIGZyb20gdGhlIGxlZGdlciB3aWxsIHJldHVybiB0aGUgc2FtZSBzZXQg\nb2YgZW50cmllcy4gCiAgICAgKiAKICAgICAqIEBwYXJhbSBjYgogICAgICog\nICAgICAgICAgY2FsbGJhY2sgaW1wbGVtZW50YXRpb24KICAgICAqIEBwYXJh\nbSBjdHgKICAgICAqICAgICAgICAgIGNvbnRyb2wgb2JqZWN0CiAgICAgKiBA\ndGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGFzeW5jQ2xvc2UoQ2xvc2VDYWxsYmFjayBjYiwgT2JqZWN0IGN0\neCkgewogICAgICAgIGFzeW5jQ2xvc2VJbnRlcm5hbChjYiwgY3R4LCBCS0V4\nY2VwdGlvbi5Db2RlLkxlZGdlckNsb3NlZEV4Y2VwdGlvbik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTYW1lIGFzIHB1YmxpYyB2ZXJzaW9uIG9mIGFzeW5j\nQ2xvc2UgZXhjZXB0IHRoYXQgdGhpcyBvbmUgdGFrZXMgYW4KICAgICAqIGFk\nZGl0aW9uYWwgcGFyYW1ldGVyIHdoaWNoIGlzIHRoZSByZXR1cm4gY29kZSB0\nbyBoYW5kIHRvIGFsbCB0aGUgcGVuZGluZwogICAgICogYWRkIG9wcwogICAg\nICoKICAgICAqIEBwYXJhbSBjYgogICAgICogQHBhcmFtIGN0eAogICAgICog\nQHBhcmFtIHJjCiAgICAgKi8KICAgIHZvaWQgYXN5bmNDbG9zZUludGVybmFs\nKGZpbmFsIENsb3NlQ2FsbGJhY2sgY2IsIGZpbmFsIE9iamVjdCBjdHgsIGZp\nbmFsIGludCByYykgewogICAgICAgIGJrLm1haW5Xb3JrZXJQb29sLnN1Ym1p\ndE9yZGVyZWQobGVkZ2VySWQsIG5ldyBTYWZlUnVubmFibGUoKSB7CiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZl\nUnVuKCkgewogICAgICAgICAgICAgICAgZmluYWwgbG9uZyBwcmV2TGFzdEVu\ndHJ5SWQ7CiAgICAgICAgICAgICAgICBmaW5hbCBsb25nIHByZXZMZW5ndGg7\nCiAgICAgICAgICAgICAgICBmaW5hbCBTdGF0ZSBwcmV2U3RhdGU7CgogICAg\nICAgICAgICAgICAgc3luY2hyb25pemVkKExlZGdlckhhbmRsZS50aGlzKSB7\nCiAgICAgICAgICAgICAgICAgICAgcHJldlN0YXRlID0gbWV0YWRhdGEuZ2V0\nU3RhdGUoKTsKICAgICAgICAgICAgICAgICAgICBwcmV2TGFzdEVudHJ5SWQg\nPSBtZXRhZGF0YS5nZXRMYXN0RW50cnlJZCgpOwogICAgICAgICAgICAgICAg\nICAgIHByZXZMZW5ndGggPSBtZXRhZGF0YS5nZXRMZW5ndGgoKTsKCiAgICAg\nICAgICAgICAgICAgICAgLy8gc3luY2hyb25pemVkIG9uIExlZGdlckhhbmRs\nZS50aGlzIHRvIGVuc3VyZSB0aGF0IAogICAgICAgICAgICAgICAgICAgIC8v\nIGxhc3RBZGRQdXNoZWQgY2FuIG5vdCBiZSB1cGRhdGVkIGFmdGVyIHRoZSBt\nZXRhZGF0YSAKICAgICAgICAgICAgICAgICAgICAvLyBpcyBjbG9zZWQuIAog\nICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLnNldExlbmd0aChsZW5ndGgp\nOwoKICAgICAgICAgICAgICAgICAgICAvLyBDbG9zZSBvcGVyYXRpb24gaXMg\naWRlbXBvdGVudCwgc28gbm8gbmVlZCB0byBjaGVjayBpZiB3ZSBhcmUKICAg\nICAgICAgICAgICAgICAgICAvLyBhbHJlYWR5IGNsb3NlZAogICAgICAgICAg\nICAgICAgICAgIG1ldGFkYXRhLmNsb3NlKGxhc3RBZGRDb25maXJtZWQpOwog\nICAgICAgICAgICAgICAgICAgIGVycm9yT3V0UGVuZGluZ0FkZHMocmMpOwog\nICAgICAgICAgICAgICAgICAgIGxhc3RBZGRQdXNoZWQgPSBsYXN0QWRkQ29u\nZmlybWVkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlm\nIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nIExPRy5kZWJ1ZygiQ2xvc2luZyBsZWRnZXI6ICIgKyBsZWRnZXJJZCArICIg\nYXQgZW50cnlJZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nIG1ldGFkYXRhLmdldExhc3RFbnRyeUlkKCkgKyAiIHdpdGggdGhpcyBtYW55\nIGJ5dGVzOiAiICsgbWV0YWRhdGEuZ2V0TGVuZ3RoKCkpOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIGZpbmFsIGNsYXNzIENsb3NlQ2Ig\nZXh0ZW5kcyBPcmRlcmVkU2FmZUdlbmVyaWNDYWxsYmFjazxWb2lkPiB7CiAg\nICAgICAgICAgICAgICAgICAgQ2xvc2VDYigpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgc3VwZXIoYmsubWFpbldvcmtlclBvb2wsIGxlZGdlcklkKTsK\nICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVP\ncGVyYXRpb25Db21wbGV0ZShmaW5hbCBpbnQgcmMsIFZvaWQgcmVzdWx0KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlv\nbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4Y2VwdGlvbikgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcmVyZWFkTWV0YWRhdGEobmV3IE9yZGVyZWRT\nYWZlR2VuZXJpY0NhbGxiYWNrPExlZGdlck1ldGFkYXRhPihiay5tYWluV29y\na2VyUG9vbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbGVkZ2VySWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzYWZlT3BlcmF0aW9uQ29tcGxldGUoaW50IG5l\nd3JjLCBMZWRnZXJNZXRhZGF0YSBuZXdNZXRhKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdyYyAhPSBCS0V4Y2VwdGlv\nbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHJlYWRpbmcgbmV3IG1ldGFkYXRh\nIGZyb20gbGVkZ2VyICIgKyBsZWRnZXJJZAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiB3aGVuIGNsb3Np\nbmcsIGNvZGU9IiArIG5ld3JjKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNiLmNsb3NlQ29tcGxldGUocmMsIExlZGdlckhh\nbmRsZS50aGlzLCBjdHgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbWV0YWRhdGEuc2V0U3RhdGUocHJldlN0YXRlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmV2\nU3RhdGUuZXF1YWxzKFN0YXRlLkNMT1NFRCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5jbG9zZShw\ncmV2TGFzdEVudHJ5SWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGFkYXRhLnNldExlbmd0aChwcmV2TGVuZ3RoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXRh\nZGF0YS5yZXNvbHZlQ29uZmxpY3QobmV3TWV0YSkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5zZXRM\nZW5ndGgobGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhZGF0YS5jbG9zZShsYXN0QWRkQ29uZmlybWVk\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB3cml0ZUxlZGdlckNvbmZpZyhuZXcgQ2xvc2VDYigpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG1ldGFkYXRhLnNldExlbmd0aChsZW5ndGgpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLmNsb3NlKGxh\nc3RBZGRDb25maXJtZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIExPRy53YXJuKCJDb25kaXRpb25hbCB1cGRhdGUg\nbGVkZ2VyIG1ldGFkYXRhIGZvciBsZWRnZXIgIiArIGxlZGdlcklkICsgIiBm\nYWlsZWQuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY2IuY2xvc2VDb21wbGV0ZShyYywgTGVkZ2VySGFuZGxlLnRo\naXMsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHVwZGF0\nZSBsZWRnZXIgbWV0YWRhdGEgZm9yIGxlZGdlciAiICsgbGVkZ2VySWQgKyAi\nIDogIiArIHJjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLmNs\nb3NlQ29tcGxldGUocmMsIExlZGdlckhhbmRsZS50aGlzLCBjdHgpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY2IuY2xvc2VDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2Rl\nLk9LLCBMZWRnZXJIYW5kbGUudGhpcywgY3R4KTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH07CgogICAgICAgICAgICAgICAgd3JpdGVMZWRnZXJDb25maWcobmV3\nIENsb3NlQ2IoKSk7CgogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSZWFkIGEgc2VxdWVuY2Ugb2YgZW50cmllcyBz\neW5jaHJvbm91c2x5LgogICAgICoKICAgICAqIEBwYXJhbSBmaXJzdEVudHJ5\nCiAgICAgKiAgICAgICAgICBpZCBvZiBmaXJzdCBlbnRyeSBvZiBzZXF1ZW5j\nZSAoaW5jbHVkZWQpCiAgICAgKiBAcGFyYW0gbGFzdEVudHJ5CiAgICAgKiAg\nICAgICAgICBpZCBvZiBsYXN0IGVudHJ5IG9mIHNlcXVlbmNlIChpbmNsdWRl\nZCkKICAgICAqCiAgICAgKi8KICAgIHB1YmxpYyBFbnVtZXJhdGlvbjxMZWRn\nZXJFbnRyeT4gcmVhZEVudHJpZXMobG9uZyBmaXJzdEVudHJ5LCBsb25nIGxh\nc3RFbnRyeSkKICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0\naW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgU3luY0NvdW50ZXIgY291bnRl\nciA9IG5ldyBTeW5jQ291bnRlcigpOwogICAgICAgIGNvdW50ZXIuaW5jKCk7\nCgogICAgICAgIGFzeW5jUmVhZEVudHJpZXMoZmlyc3RFbnRyeSwgbGFzdEVu\ndHJ5LCBuZXcgU3luY1JlYWRDYWxsYmFjaygpLCBjb3VudGVyKTsKCiAgICAg\nICAgY291bnRlci5ibG9jaygwKTsKICAgICAgICBpZiAoY291bnRlci5nZXRy\nYygpICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgdGhy\nb3cgQktFeGNlcHRpb24uY3JlYXRlKGNvdW50ZXIuZ2V0cmMoKSk7CiAgICAg\nICAgfQoKICAgICAgICByZXR1cm4gY291bnRlci5nZXRTZXF1ZW5jZSgpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVhZCBhIHNlcXVlbmNlIG9mIGVudHJp\nZXMgYXN5bmNocm9ub3VzbHkuCiAgICAgKgogICAgICogQHBhcmFtIGZpcnN0\nRW50cnkKICAgICAqICAgICAgICAgIGlkIG9mIGZpcnN0IGVudHJ5IG9mIHNl\ncXVlbmNlCiAgICAgKiBAcGFyYW0gbGFzdEVudHJ5CiAgICAgKiAgICAgICAg\nICBpZCBvZiBsYXN0IGVudHJ5IG9mIHNlcXVlbmNlCiAgICAgKiBAcGFyYW0g\nY2IKICAgICAqICAgICAgICAgIG9iamVjdCBpbXBsZW1lbnRpbmcgcmVhZCBj\nYWxsYmFjayBpbnRlcmZhY2UKICAgICAqIEBwYXJhbSBjdHgKICAgICAqICAg\nICAgICAgIGNvbnRyb2wgb2JqZWN0CiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFzeW5jUmVhZEVudHJpZXMobG9uZyBmaXJzdEVudHJ5LCBsb25nIGxhc3RF\nbnRyeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVhZENh\nbGxiYWNrIGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAgLy8gTGl0dGxlIHNh\nbml0eSBjaGVjawogICAgICAgIGlmIChmaXJzdEVudHJ5IDwgMCB8fCBsYXN0\nRW50cnkgPiBsYXN0QWRkQ29uZmlybWVkCiAgICAgICAgICAgICAgICB8fCBm\naXJzdEVudHJ5ID4gbGFzdEVudHJ5KSB7CiAgICAgICAgICAgIGNiLnJlYWRD\nb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLlJlYWRFeGNlcHRpb24sIHRoaXMs\nIG51bGwsIGN0eCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIG5ldyBQZW5kaW5nUmVhZE9wKHRo\naXMsIGJrLnNjaGVkdWxlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZmlyc3RFbnRyeSwgbGFzdEVudHJ5LCBjYiwgY3R4KS5pbml0aWF0ZSgp\nOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgY2IucmVhZENvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUu\nSW50ZXJydXB0ZWRFeGNlcHRpb24sIHRoaXMsIG51bGwsIGN0eCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogQWRkIGVudHJ5IHN5bmNocm9u\nb3VzbHkgdG8gYW4gb3BlbiBsZWRnZXIuCiAgICAgKgogICAgICogQHBhcmFt\nIGRhdGEKICAgICAqICAgICAgICAgYXJyYXkgb2YgYnl0ZXMgdG8gYmUgd3Jp\ndHRlbiB0byB0aGUgbGVkZ2VyCiAgICAgKiBAcmV0dXJuIHRoZSBlbnRyeUlk\nIG9mIHRoZSBuZXcgaW5zZXJ0ZWQgZW50cnkKICAgICAqLwogICAgcHVibGlj\nIGxvbmcgYWRkRW50cnkoYnl0ZVtdIGRhdGEpIHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIHJldHVybiBhZGRF\nbnRyeShkYXRhLCAwLCBkYXRhLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgZW50cnkgc3luY2hyb25vdXNseSB0byBhbiBvcGVuIGxlZGdl\nci4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YQogICAgICogICAgICAgICBh\ncnJheSBvZiBieXRlcyB0byBiZSB3cml0dGVuIHRvIHRoZSBsZWRnZXIKICAg\nICAqIEBwYXJhbSBvZmZzZXQKICAgICAqICAgICAgICAgIG9mZnNldCBmcm9t\nIHdoaWNoIHRvIHRha2UgYnl0ZXMgZnJvbSBkYXRhCiAgICAgKiBAcGFyYW0g\nbGVuZ3RoCiAgICAgKiAgICAgICAgICBudW1iZXIgb2YgYnl0ZXMgdG8gdGFr\nZSBmcm9tIGRhdGEKICAgICAqIEByZXR1cm4gdGhlIGVudHJ5SWQgb2YgdGhl\nIG5ldyBpbnNlcnRlZCBlbnRyeQogICAgICovCiAgICBwdWJsaWMgbG9uZyBh\nZGRFbnRyeShieXRlW10gZGF0YSwgaW50IG9mZnNldCwgaW50IGxlbmd0aCkK\nICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4\nY2VwdGlvbiB7CiAgICAgICAgTE9HLmRlYnVnKCJBZGRpbmcgZW50cnkge30i\nLCBkYXRhKTsKCiAgICAgICAgU3luY0NvdW50ZXIgY291bnRlciA9IG5ldyBT\neW5jQ291bnRlcigpOwogICAgICAgIGNvdW50ZXIuaW5jKCk7CgogICAgICAg\nIFN5bmNBZGRDYWxsYmFjayBjYWxsYmFjayA9IG5ldyBTeW5jQWRkQ2FsbGJh\nY2soKTsKICAgICAgICBhc3luY0FkZEVudHJ5KGRhdGEsIG9mZnNldCwgbGVu\nZ3RoLCBjYWxsYmFjaywgY291bnRlcik7CiAgICAgICAgY291bnRlci5ibG9j\naygwKTsKICAgICAgICAKICAgICAgICBpZiAoY291bnRlci5nZXRyYygpICE9\nIEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgdGhyb3cgQktF\neGNlcHRpb24uY3JlYXRlKGNvdW50ZXIuZ2V0cmMoKSk7CiAgICAgICAgfQoK\nICAgICAgICByZXR1cm4gY2FsbGJhY2suZW50cnlJZDsKICAgIH0KCiAgICAv\nKioKICAgICAqIEFkZCBlbnRyeSBhc3luY2hyb25vdXNseSB0byBhbiBvcGVu\nIGxlZGdlci4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YQogICAgICogICAg\nICAgICAgYXJyYXkgb2YgYnl0ZXMgdG8gYmUgd3JpdHRlbgogICAgICogQHBh\ncmFtIGNiCiAgICAgKiAgICAgICAgICBvYmplY3QgaW1wbGVtZW50aW5nIGNh\nbGxiYWNraW50ZXJmYWNlCiAgICAgKiBAcGFyYW0gY3R4CiAgICAgKiAgICAg\nICAgICBzb21lIGNvbnRyb2wgb2JqZWN0CiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGFzeW5jQWRkRW50cnkoZmluYWwgYnl0ZVtdIGRhdGEsIGZpbmFsIEFk\nZENhbGxiYWNrIGNiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgYXN5bmNBZGRFbnRyeShkYXRh\nLCAwLCBkYXRhLmxlbmd0aCwgY2IsIGN0eCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgZW50cnkgYXN5bmNocm9ub3VzbHkgdG8gYW4gb3BlbiBsZWRn\nZXIsIHVzaW5nIGFuIG9mZnNldCBhbmQgcmFuZ2UuCiAgICAgKgogICAgICog\nQHBhcmFtIGRhdGEKICAgICAqICAgICAgICAgIGFycmF5IG9mIGJ5dGVzIHRv\nIGJlIHdyaXR0ZW4KICAgICAqIEBwYXJhbSBvZmZzZXQKICAgICAqICAgICAg\nICAgIG9mZnNldCBmcm9tIHdoaWNoIHRvIHRha2UgYnl0ZXMgZnJvbSBkYXRh\nCiAgICAgKiBAcGFyYW0gbGVuZ3RoCiAgICAgKiAgICAgICAgICBudW1iZXIg\nb2YgYnl0ZXMgdG8gdGFrZSBmcm9tIGRhdGEKICAgICAqIEBwYXJhbSBjYgog\nICAgICogICAgICAgICAgb2JqZWN0IGltcGxlbWVudGluZyBjYWxsYmFja2lu\ndGVyZmFjZQogICAgICogQHBhcmFtIGN0eAogICAgICogICAgICAgICAgc29t\nZSBjb250cm9sIG9iamVjdAogICAgICogQHRocm93cyBBcnJheUluZGV4T3V0\nT2ZCb3VuZHNFeGNlcHRpb24gaWYgb2Zmc2V0IG9yIGxlbmd0aCBpcyBuZWdh\ndGl2ZSBvcgogICAgICogICAgICAgICAgb2Zmc2V0IGFuZCBsZW5ndGggc3Vt\nIHRvIGEgdmFsdWUgaGlnaGVyIHRoYW4gdGhlIGxlbmd0aCBvZiBkYXRhLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3luY0FkZEVudHJ5KGZpbmFsIGJ5\ndGVbXSBkYXRhLCBmaW5hbCBpbnQgb2Zmc2V0LCBmaW5hbCBpbnQgbGVuZ3Ro\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBBZGRDYWxs\nYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIFBlbmRpbmdB\nZGRPcCBvcCA9IG5ldyBQZW5kaW5nQWRkT3AoTGVkZ2VySGFuZGxlLnRoaXMs\nIGNiLCBjdHgpOwogICAgICAgIGRvQXN5bmNBZGRFbnRyeShvcCwgZGF0YSwg\nb2Zmc2V0LCBsZW5ndGgsIGNiLCBjdHgpOwogICAgfQoKICAgIC8qKgogICAg\nICogTWFrZSBhIHJlY292ZXJ5IGFkZCBlbnRyeSByZXF1ZXN0LiBSZWNvdmVy\neSBhZGRzIGNhbiBhZGQgdG8gYSBsZWRnZXIgZXZlbiBpZgogICAgICogaXQg\naGFzIGJlZW4gZmVuY2VkLgogICAgICoKICAgICAqIFRoaXMgaXMgb25seSB2\nYWxpZCBmb3IgYm9va2llIGFuZCBsZWRnZXIgcmVjb3ZlcnksIHdoaWNoIG1h\neSBuZWVkIHRvIHJlcGxpY2F0ZQogICAgICogZW50cmllcyB0byBhIHF1b3J1\nbSBvZiBib29raWVzIHRvIGVuc3VyZSBkYXRhIHNhZmV0eS4KICAgICAqCiAg\nICAgKiBOb3JtYWwgY2xpZW50IHNob3VsZCBuZXZlciBjYWxsIHRoaXMgbWV0\naG9kLgogICAgICovCiAgICB2b2lkIGFzeW5jUmVjb3ZlcnlBZGRFbnRyeShm\naW5hbCBieXRlW10gZGF0YSwgZmluYWwgaW50IG9mZnNldCwgZmluYWwgaW50\nIGxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFs\nIEFkZENhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nUGVuZGluZ0FkZE9wIG9wID0gbmV3IFBlbmRpbmdBZGRPcChMZWRnZXJIYW5k\nbGUudGhpcywgY2IsIGN0eCkuZW5hYmxlUmVjb3ZlcnlBZGQoKTsKICAgICAg\nICBkb0FzeW5jQWRkRW50cnkob3AsIGRhdGEsIG9mZnNldCwgbGVuZ3RoLCBj\nYiwgY3R4KTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZG9Bc3luY0FkZEVu\ndHJ5KGZpbmFsIFBlbmRpbmdBZGRPcCBvcCwgZmluYWwgYnl0ZVtdIGRhdGEs\nIGZpbmFsIGludCBvZmZzZXQsIGZpbmFsIGludCBsZW5ndGgsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIEFkZENhbGxiYWNrIGNi\nLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgaWYgKG9mZnNldCA8IDAg\nfHwgbGVuZ3RoIDwgMAogICAgICAgICAgICAgICAgfHwgKG9mZnNldCArIGxl\nbmd0aCkgPiBkYXRhLmxlbmd0aCkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uKAogICAgICAgICAgICAg\nICAgIkludmFsaWQgdmFsdWVzIGZvciBvZmZzZXQoIitvZmZzZXQKICAgICAg\nICAgICAgICAgICsiKSBvciBsZW5ndGgoIitsZW5ndGgrIikiKTsKICAgICAg\nICB9CiAgICAgICAgdGhyb3R0bGVyLmFjcXVpcmUoKTsKCiAgICAgICAgZmlu\nYWwgbG9uZyBlbnRyeUlkOwogICAgICAgIGZpbmFsIGxvbmcgY3VycmVudExl\nbmd0aDsKICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAg\nICAvLyBzeW5jaHJvbml6ZWQgb24gdGhpcyB0byBlbnN1cmUgdGhhdAogICAg\nICAgICAgICAvLyB0aGUgbGVkZ2VyIGlzbid0IGNsb3NlZCBiZXR3ZWVuIGNo\nZWNraW5nIGFuZCAKICAgICAgICAgICAgLy8gdXBkYXRpbmcgbGFzdEFkZFB1\nc2hlZAogICAgICAgICAgICBpZiAobWV0YWRhdGEuaXNDbG9zZWQoKSkgewog\nICAgICAgICAgICAgICAgTE9HLndhcm4oIkF0dGVtcHQgdG8gYWRkIHRvIGNs\nb3NlZCBsZWRnZXI6ICIgKyBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICBj\nYi5hZGRDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLkxlZGdlckNsb3NlZEV4\nY2VwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZGdl\nckhhbmRsZS50aGlzLCBJTlZBTElEX0VOVFJZX0lELCBjdHgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBl\nbnRyeUlkID0gKytsYXN0QWRkUHVzaGVkOwogICAgICAgICAgICBjdXJyZW50\nTGVuZ3RoID0gYWRkVG9MZW5ndGgobGVuZ3RoKTsKICAgICAgICAgICAgb3Au\nc2V0RW50cnlJZChlbnRyeUlkKTsKICAgICAgICAgICAgcGVuZGluZ0FkZE9w\ncy5hZGQob3ApOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYmsubWFpbldvcmtlclBvb2wuc3VibWl0KG5ldyBTYWZlUnVubmFibGUo\nKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHNhZmVSdW4oKSB7CiAgICAgICAgICAgICAgICAgICAg\nQ2hhbm5lbEJ1ZmZlciB0b1NlbmQgPSBtYWNNYW5hZ2VyLmNvbXB1dGVEaWdl\nc3RBbmRQYWNrYWdlRm9yU2VuZGluZygKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBlbnRyeUlkLCBsYXN0QWRkQ29u\nZmlybWVkLCBjdXJyZW50TGVuZ3RoLCBkYXRhLCBvZmZzZXQsIGxlbmd0aCk7\nCiAgICAgICAgICAgICAgICAgICAgb3AuaW5pdGlhdGUodG9TZW5kKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRj\naCAoUnVudGltZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGNiLmFkZENv\nbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuSW50ZXJydXB0ZWRFeGNlcHRpb24s\nCiAgICAgICAgICAgICAgICAgICAgTGVkZ2VySGFuZGxlLnRoaXMsIElOVkFM\nSURfRU5UUllfSUQsIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogT2J0YWlucyBhc3luY2hyb25vdXNseSB0aGUgbGFzdCBjb25maXJt\nZWQgd3JpdGUgZnJvbSBhIHF1b3J1bSBvZiBib29raWVzLiBUaGlzIAogICAg\nICogY2FsbCBvYnRhaW5zIHRoZSB0aGUgbGFzdCBhZGQgY29uZmlybWVkIGVh\nY2ggYm9va2llIGhhcyByZWNlaXZlZCBmb3IgdGhpcyBsZWRnZXIKICAgICAq\nIGFuZCByZXR1cm5zIHRoZSBtYXhpbXVtLiBJZiB0aGUgbGVkZ2VyIGhhcyBi\nZWVuIGNsb3NlZCwgdGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoaXMKICAgICAq\nIGNhbGwgbWF5IG5vdCBjb3JyZXNwb25kIHRvIHRoZSBpZCBvZiB0aGUgbGFz\ndCBlbnRyeSBvZiB0aGUgbGVkZ2VyLCBzaW5jZSBpdCByZWFkcwogICAgICog\ndGhlIGhpbnQgb2YgYm9va2llcy4gQ29uc2VxdWVudGx5LCBpbiB0aGUgY2Fz\nZSB0aGUgbGVkZ2VyIGhhcyBiZWVuIGNsb3NlZCwgaXQgbWF5IAogICAgICog\ncmV0dXJuIGEgZGlmZmVyZW50IHZhbHVlIHRoYW4gZ2V0TGFzdEFkZENvbmZp\ncm1lZCwgd2hpY2ggcmV0dXJucyB0aGUgbG9jYWwgdmFsdWUgCiAgICAgKiBv\nZiB0aGUgbGVkZ2VyIGhhbmRsZS4KICAgICAqIAogICAgICogQHNlZSAjZ2V0\nTGFzdEFkZENvbmZpcm1lZCgpCiAgICAgKgogICAgICogQHBhcmFtIGNiCiAg\nICAgKiBAcGFyYW0gY3R4CiAgICAgKi8KCiAgICBwdWJsaWMgdm9pZCBhc3lu\nY1JlYWRMYXN0Q29uZmlybWVkKGZpbmFsIFJlYWRMYXN0Q29uZmlybWVkQ2Fs\nbGJhY2sgY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBSZWFkTGFz\ndENvbmZpcm1lZE9wLkxhc3RDb25maXJtZWREYXRhQ2FsbGJhY2sgaW5uZXJj\nYiA9IG5ldyBSZWFkTGFzdENvbmZpcm1lZE9wLkxhc3RDb25maXJtZWREYXRh\nQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCByZWFk\nTGFzdENvbmZpcm1lZERhdGFDb21wbGV0ZShpbnQgcmMsIERpZ2VzdE1hbmFn\nZXIuUmVjb3ZlcnlEYXRhIGRhdGEpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAg\nICAgICAgICAgICBsYXN0QWRkQ29uZmlybWVkID0gTWF0aC5tYXgobGFzdEFk\nZENvbmZpcm1lZCwgZGF0YS5sYXN0QWRkQ29uZmlybWVkKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbGFzdEFkZFB1c2hlZCA9IE1hdGgubWF4KGxhc3RB\nZGRQdXNoZWQsIGRhdGEubGFzdEFkZENvbmZpcm1lZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGxlbmd0aCA9IE1hdGgubWF4KGxlbmd0aCwgZGF0YS5s\nZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICBjYi5yZWFkTGFzdENv\nbmZpcm1lZENvbXBsZXRlKHJjLCBkYXRhLmxhc3RBZGRDb25maXJtZWQsIGN0\neCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgY2IucmVhZExhc3RDb25maXJtZWRDb21wbGV0ZShyYywg\nSU5WQUxJRF9FTlRSWV9JRCwgY3R4KTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgbmV3\nIFJlYWRMYXN0Q29uZmlybWVkT3AodGhpcywgaW5uZXJjYikuaW5pdGlhdGUo\nKTsKICAgIH0KCgogICAgLyoqCiAgICAgKiBDb250ZXh0IG9iamVjdHMgZm9y\nIHN5bmNocm9ub3VzIGNhbGwgdG8gcmVhZCBsYXN0IGNvbmZpcm1lZC4KICAg\nICAqLwogICAgc3RhdGljIGNsYXNzIExhc3RDb25maXJtZWRDdHggewogICAg\nICAgIGZpbmFsIHN0YXRpYyBsb25nIEVOVFJZX0lEX1BFTkRJTkcgPSAtMTA7\nCiAgICAgICAgbG9uZyByZXNwb25zZTsKICAgICAgICBpbnQgcmM7CgogICAg\nICAgIExhc3RDb25maXJtZWRDdHgoKSB7CiAgICAgICAgICAgIHRoaXMucmVz\ncG9uc2UgPSBFTlRSWV9JRF9QRU5ESU5HOwogICAgICAgIH0KCiAgICAgICAg\ndm9pZCBzZXRMYXN0Q29uZmlybWVkKGxvbmcgbGFzdENvbmZpcm1lZCkgewog\nICAgICAgICAgICB0aGlzLnJlc3BvbnNlID0gbGFzdENvbmZpcm1lZDsKICAg\nICAgICB9CgogICAgICAgIGxvbmcgZ2V0bGFzdENvbmZpcm1lZCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIHRoaXMucmVzcG9uc2U7CiAgICAgICAgfQoKICAg\nICAgICB2b2lkIHNldFJDKGludCByYykgewogICAgICAgICAgICB0aGlzLnJj\nID0gcmM7CiAgICAgICAgfQoKICAgICAgICBpbnQgZ2V0UkMoKSB7CiAgICAg\nICAgICAgIHJldHVybiB0aGlzLnJjOwogICAgICAgIH0KCiAgICAgICAgYm9v\nbGVhbiByZWFkeSgpIHsKICAgICAgICAgICAgcmV0dXJuICh0aGlzLnJlc3Bv\nbnNlICE9IEVOVFJZX0lEX1BFTkRJTkcpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIE9idGFpbnMgc3luY2hyb25vdXNseSB0aGUgbGFzdCBj\nb25maXJtZWQgd3JpdGUgZnJvbSBhIHF1b3J1bSBvZiBib29raWVzLiBUaGlz\nIGNhbGwKICAgICAqIG9idGFpbnMgdGhlIHRoZSBsYXN0IGFkZCBjb25maXJt\nZWQgZWFjaCBib29raWUgaGFzIHJlY2VpdmVkIGZvciB0aGlzIGxlZGdlcgog\nICAgICogYW5kIHJldHVybnMgdGhlIG1heGltdW0uIElmIHRoZSBsZWRnZXIg\naGFzIGJlZW4gY2xvc2VkLCB0aGUgdmFsdWUgcmV0dXJuZWQgYnkgdGhpcwog\nICAgICogY2FsbCBtYXkgbm90IGNvcnJlc3BvbmQgdG8gdGhlIGlkIG9mIHRo\nZSBsYXN0IGVudHJ5IG9mIHRoZSBsZWRnZXIsIHNpbmNlIGl0IHJlYWRzCiAg\nICAgKiB0aGUgaGludCBvZiBib29raWVzLiBDb25zZXF1ZW50bHksIGluIHRo\nZSBjYXNlIHRoZSBsZWRnZXIgaGFzIGJlZW4gY2xvc2VkLCBpdCBtYXkgCiAg\nICAgKiByZXR1cm4gYSBkaWZmZXJlbnQgdmFsdWUgdGhhbiBnZXRMYXN0QWRk\nQ29uZmlybWVkLCB3aGljaCByZXR1cm5zIHRoZSBsb2NhbCB2YWx1ZSAKICAg\nICAqIG9mIHRoZSBsZWRnZXIgaGFuZGxlLgogICAgICogCiAgICAgKiBAc2Vl\nICNnZXRMYXN0QWRkQ29uZmlybWVkKCkKICAgICAqIAogICAgICogQHJldHVy\nbiBUaGUgZW50cnkgaWQgb2YgdGhlIGxhc3QgY29uZmlybWVkIHdyaXRlIG9y\nIHtAbGluayAjSU5WQUxJRF9FTlRSWV9JRCBJTlZBTElEX0VOVFJZX0lEfQog\nICAgICogICAgICAgICBpZiBubyBlbnRyeSBoYXMgYmVlbiBjb25maXJtZWQK\nICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqIEB0\naHJvd3MgQktFeGNlcHRpb24KICAgICAqLwogICAgCiAgICBwdWJsaWMgbG9u\nZyByZWFkTGFzdENvbmZpcm1lZCgpCiAgICAgICAgICAgIHRocm93cyBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIExhc3RD\nb25maXJtZWRDdHggY3R4ID0gbmV3IExhc3RDb25maXJtZWRDdHgoKTsKICAg\nICAgICBhc3luY1JlYWRMYXN0Q29uZmlybWVkKG5ldyBTeW5jUmVhZExhc3RD\nb25maXJtZWRDYWxsYmFjaygpLCBjdHgpOwogICAgICAgIHN5bmNocm9uaXpl\nZChjdHgpIHsKICAgICAgICAgICAgd2hpbGUoIWN0eC5yZWFkeSgpKSB7CiAg\nICAgICAgICAgICAgICBjdHgud2FpdCgpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBpZihjdHguZ2V0UkMoKSAhPSBCS0V4Y2VwdGlvbi5D\nb2RlLk9LKSB0aHJvdyBCS0V4Y2VwdGlvbi5jcmVhdGUoY3R4LmdldFJDKCkp\nOwogICAgICAgIHJldHVybiBjdHguZ2V0bGFzdENvbmZpcm1lZCgpOwogICAg\nfQoKICAgIC8vIGNsb3NlIHRoZSBsZWRnZXIgYW5kIHNlbmQgZmFpbHMgdG8g\nYWxsIHRoZSBhZGRzIGluIHRoZSBwaXBlbGluZQogICAgdm9pZCBoYW5kbGVV\nbnJlY292ZXJhYmxlRXJyb3JEdXJpbmdBZGQoaW50IHJjKSB7CiAgICAgICAg\naWYgKG1ldGFkYXRhLmlzSW5SZWNvdmVyeSgpKSB7CiAgICAgICAgICAgIC8v\nIHdlIHNob3VsZCBub3QgY2xvc2UgbGVkZ2VyIGlmIGxlZGdlciBpcyByZWNv\ndmVyeSBtb2RlCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZSBtYXkgbG9z\nZSBlbnRyeS4KICAgICAgICAgICAgZXJyb3JPdXRQZW5kaW5nQWRkcyhyYyk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYXN5bmND\nbG9zZUludGVybmFsKE5vb3BDbG9zZUNhbGxiYWNrLmluc3RhbmNlLCBudWxs\nLCByYyk7CiAgICB9CgogICAgdm9pZCBlcnJvck91dFBlbmRpbmdBZGRzKGlu\ndCByYykgewogICAgICAgIFBlbmRpbmdBZGRPcCBwZW5kaW5nQWRkT3A7CiAg\nICAgICAgd2hpbGUgKChwZW5kaW5nQWRkT3AgPSBwZW5kaW5nQWRkT3BzLnBv\nbGwoKSkgIT0gbnVsbCkgewogICAgICAgICAgICBwZW5kaW5nQWRkT3Auc3Vi\nbWl0Q2FsbGJhY2socmMpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIHNl\nbmRBZGRTdWNjZXNzQ2FsbGJhY2tzKCkgewogICAgICAgIC8vIFN0YXJ0IGZy\nb20gdGhlIGhlYWQgb2YgdGhlIHF1ZXVlIGFuZCBwcm9jZWVkIHdoaWxlIHRo\nZXJlIGFyZQogICAgICAgIC8vIGVudHJpZXMgdGhhdCBoYXZlIGhhZCBhbGwg\ndGhlaXIgcmVzcG9uc2VzIGNvbWUgYmFjawogICAgICAgIFBlbmRpbmdBZGRP\ncCBwZW5kaW5nQWRkT3A7CiAgICAgICAgd2hpbGUgKChwZW5kaW5nQWRkT3Ag\nPSBwZW5kaW5nQWRkT3BzLnBlZWsoKSkgIT0gbnVsbAogICAgICAgICAgICAg\nICAmJiBibG9ja0FkZENvbXBsZXRpb25zLmdldCgpID09IDApIHsKICAgICAg\nICAgICAgaWYgKCFwZW5kaW5nQWRkT3AuY29tcGxldGVkKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGVu\nZGluZ0FkZE9wcy5yZW1vdmUoKTsKICAgICAgICAgICAgbGFzdEFkZENvbmZp\ncm1lZCA9IHBlbmRpbmdBZGRPcC5lbnRyeUlkOwogICAgICAgICAgICBwZW5k\naW5nQWRkT3Auc3VibWl0Q2FsbGJhY2soQktFeGNlcHRpb24uQ29kZS5PSyk7\nCiAgICAgICAgfQoKICAgIH0KCiAgICBBcnJheUxpc3Q8SW5ldFNvY2tldEFk\nZHJlc3M+IHJlcGxhY2VCb29raWVJbk1ldGFkYXRhKGZpbmFsIEluZXRTb2Nr\nZXRBZGRyZXNzIGFkZHIsIGZpbmFsIGludCBib29raWVJbmRleCkKICAgICAg\nICAgICAgdGhyb3dzIEJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9va2llc0V4\nY2VwdGlvbiB7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgbmV3Qm9va2ll\nOwogICAgICAgIExPRy5pbmZvKCJIYW5kbGluZyBmYWlsdXJlIG9mIGJvb2tp\nZToge30gaW5kZXg6IHt9IiwgYWRkciwgYm9va2llSW5kZXgpOwogICAgICAg\nIGZpbmFsIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gbmV3RW5zZW1i\nbGUgPSBuZXcgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPigpOwogICAg\nICAgIGZpbmFsIGxvbmcgbmV3RW5zZW1ibGVTdGFydEVudHJ5ID0gbGFzdEFk\nZENvbmZpcm1lZCArIDE7CgogICAgICAgIC8vIGF2b2lkIHBhcmFsbGVsIGVu\nc2VtYmxlIGNoYW5nZXMgdG8gc2FtZSBlbnNlbWJsZS4KICAgICAgICBzeW5j\naHJvbml6ZWQgKG1ldGFkYXRhKSB7CiAgICAgICAgICAgIG5ld0Jvb2tpZSA9\nIGJrLmJvb2tpZVdhdGNoZXIuZ2V0QWRkaXRpb25hbEJvb2tpZShtZXRhZGF0\nYS5jdXJyZW50RW5zZW1ibGUpOwoKICAgICAgICAgICAgbmV3RW5zZW1ibGUu\nYWRkQWxsKG1ldGFkYXRhLmN1cnJlbnRFbnNlbWJsZSk7CiAgICAgICAgICAg\nIG5ld0Vuc2VtYmxlLnNldChib29raWVJbmRleCwgbmV3Qm9va2llKTsKCiAg\nICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAg\nICAgICAgICAgTE9HLmRlYnVnKCJDaGFuZ2luZyBlbnNlbWJsZSBmcm9tOiAi\nICsgbWV0YWRhdGEuY3VycmVudEVuc2VtYmxlCiAgICAgICAgICAgICAgICAg\nICAgICAgICsgIiB0bzogIiArIG5ld0Vuc2VtYmxlICsgIiBmb3IgbGVkZ2Vy\nOiAiICsgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHN0\nYXJ0aW5nIGF0IGVudHJ5OiAiICsgKGxhc3RBZGRDb25maXJtZWQgKyAxKSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1ldGFkYXRhLmFkZEVuc2Vt\nYmxlKG5ld0Vuc2VtYmxlU3RhcnRFbnRyeSwgbmV3RW5zZW1ibGUpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbmV3RW5zZW1ibGU7CiAgICB9CgogICAg\ndm9pZCBoYW5kbGVCb29raWVGYWlsdXJlKGZpbmFsIEluZXRTb2NrZXRBZGRy\nZXNzIGFkZHIsIGZpbmFsIGludCBib29raWVJbmRleCkgewogICAgICAgIGJs\nb2NrQWRkQ29tcGxldGlvbnMuaW5jcmVtZW50QW5kR2V0KCk7CgogICAgICAg\nIHN5bmNocm9uaXplZCAobWV0YWRhdGEpIHsKICAgICAgICAgICAgaWYgKCFt\nZXRhZGF0YS5jdXJyZW50RW5zZW1ibGUuZ2V0KGJvb2tpZUluZGV4KS5lcXVh\nbHMoYWRkcikpIHsKICAgICAgICAgICAgICAgIC8vIGVuc2VtYmxlIGhhcyBh\nbHJlYWR5IGNoYW5nZWQsIGZhaWx1cmUgb2YgdGhpcyBhZGRyIGlzIGltbWF0\nZXJpYWwKICAgICAgICAgICAgICAgIExPRy53YXJuKCJXcml0ZSBkaWQgbm90\nIHN1Y2NlZWQgdG8ge30sIGJvb2tpZUluZGV4IHt9LCBidXQgd2UgaGF2ZSBh\nbHJlYWR5IGZpeGVkIGl0LiIsCiAgICAgICAgICAgICAgICAgICAgICAgICBh\nZGRyLCBib29raWVJbmRleCk7CiAgICAgICAgICAgICAgICBibG9ja0FkZENv\nbXBsZXRpb25zLmRlY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPiBuZXdF\nbnNlbWJsZSA9IHJlcGxhY2VCb29raWVJbk1ldGFkYXRhKGFkZHIsIGJvb2tp\nZUluZGV4KTsKCiAgICAgICAgICAgICAgICBFbnNlbWJsZUluZm8gZW5zZW1i\nbGVJbmZvID0gbmV3IEVuc2VtYmxlSW5mbyhuZXdFbnNlbWJsZSwgYm9va2ll\nSW5kZXgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBhZGRyKTsKICAgICAgICAgICAgICAg\nIHdyaXRlTGVkZ2VyQ29uZmlnKG5ldyBDaGFuZ2VFbnNlbWJsZUNiKGVuc2Vt\nYmxlSW5mbykpOwogICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5C\nS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJDb3VsZCBub3QgZ2V0IGFkZGl0aW9uYWwgYm9va2ll\nIHRvICIKICAgICAgICAgICAgICAgICAgICAgICAgICArICJyZW1ha2UgZW5z\nZW1ibGUsIGNsb3NpbmcgbGVkZ2VyOiAiICsgbGVkZ2VySWQpOwogICAgICAg\nICAgICAgICAgaGFuZGxlVW5yZWNvdmVyYWJsZUVycm9yRHVyaW5nQWRkKGUu\nZ2V0Q29kZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBDb250YWlucyBuZXdseSBy\nZWZvcm1lZCBlbnNlbWJsZSwgYm9va2llSW5kZXgsIGZhaWxlZEJvb2tpZUFk\nZHJlc3MKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGNsYXNzIEVuc2VtYmxl\nSW5mbyB7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBBcnJheUxpc3Q8SW5ldFNv\nY2tldEFkZHJlc3M+IG5ld0Vuc2VtYmxlOwogICAgICAgIHByaXZhdGUgZmlu\nYWwgaW50IGJvb2tpZUluZGV4OwogICAgICAgIHByaXZhdGUgZmluYWwgSW5l\ndFNvY2tldEFkZHJlc3MgYWRkcjsKCiAgICAgICAgcHVibGljIEVuc2VtYmxl\nSW5mbyhBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IG5ld0Vuc2VtYmxl\nLAogICAgICAgICAgICAgICAgaW50IGJvb2tpZUluZGV4LCBJbmV0U29ja2V0\nQWRkcmVzcyBhZGRyKSB7CiAgICAgICAgICAgIHRoaXMubmV3RW5zZW1ibGUg\nPSBuZXdFbnNlbWJsZTsKICAgICAgICAgICAgdGhpcy5ib29raWVJbmRleCA9\nIGJvb2tpZUluZGV4OwogICAgICAgICAgICB0aGlzLmFkZHIgPSBhZGRyOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENhbGxiYWNrIHdoaWNo\nIGlzIHVwZGF0aW5nIHRoZSBsZWRnZXJNZXRhZGF0YSBpbiB6ayB3aXRoIHRo\nZSBuZXdseQogICAgICogcmVmb3JtZWQgZW5zZW1ibGUuIE9uIE1ldGFkYXRh\nVmVyc2lvbkV4Y2VwdGlvbiwgd2lsbCByZXJlYWQgbGF0ZXN0CiAgICAgKiBs\nZWRnZXJNZXRhZGF0YSBhbmQgYWN0IHVwb24uCiAgICAgKi8KICAgIHByaXZh\ndGUgZmluYWwgY2xhc3MgQ2hhbmdlRW5zZW1ibGVDYiBleHRlbmRzIE9yZGVy\nZWRTYWZlR2VuZXJpY0NhbGxiYWNrPFZvaWQ+IHsKICAgICAgICBwcml2YXRl\nIGZpbmFsIEVuc2VtYmxlSW5mbyBlbnNlbWJsZUluZm87CgogICAgICAgIENo\nYW5nZUVuc2VtYmxlQ2IoRW5zZW1ibGVJbmZvIGVuc2VtYmxlSW5mbykgewog\nICAgICAgICAgICBzdXBlcihiay5tYWluV29ya2VyUG9vbCwgbGVkZ2VySWQp\nOwogICAgICAgICAgICB0aGlzLmVuc2VtYmxlSW5mbyA9IGVuc2VtYmxlSW5m\nbzsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIHNhZmVPcGVyYXRpb25Db21wbGV0ZShmaW5hbCBpbnQgcmMsIFZv\naWQgcmVzdWx0KSB7CiAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlv\nbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4Y2VwdGlvbikgewogICAgICAgICAg\nICAgICAgcmVyZWFkTWV0YWRhdGEobmV3IFJlUmVhZExlZGdlck1ldGFkYXRh\nQ2IocmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGVuc2VtYmxlSW5mbykpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0sp\nIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IHBlcnNp\nc3QgbGVkZ2VyIG1ldGFkYXRhIHdoaWxlICIKICAgICAgICAgICAgICAgICAg\nICAgICAgICArICJjaGFuZ2luZyBlbnNlbWJsZSB0bzogIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICsgZW5zZW1ibGVJbmZvLm5ld0Vuc2VtYmxlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiICwgY2xvc2luZyBsZWRnZXIi\nKTsKICAgICAgICAgICAgICAgIGhhbmRsZVVucmVjb3ZlcmFibGVFcnJvckR1\ncmluZ0FkZChyYyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgYmxvY2tBZGRDb21wbGV0aW9ucy5kZWNyZW1l\nbnRBbmRHZXQoKTsKCiAgICAgICAgICAgIC8vIHRoZSBmYWlsZWQgYm9va2ll\nIGhhcyBiZWVuIHJlcGxhY2VkCiAgICAgICAgICAgIHVuc2V0U3VjY2Vzc0Fu\nZFNlbmRXcml0ZVJlcXVlc3QoZW5zZW1ibGVJbmZvLmJvb2tpZUluZGV4KTsK\nICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgd2hp\nY2ggaXMgcmVhZGluZyB0aGUgbGVkZ2VyTWV0YWRhdGEgcHJlc2VudCBpbiB6\nay4gVGhpcyB3aWxsIHRyeQogICAgICogdG8gcmVzb2x2ZSB0aGUgdmVyc2lv\nbiBjb25mbGljdHMuCiAgICAgKi8KICAgIHByaXZhdGUgZmluYWwgY2xhc3Mg\nUmVSZWFkTGVkZ2VyTWV0YWRhdGFDYiBleHRlbmRzIE9yZGVyZWRTYWZlR2Vu\nZXJpY0NhbGxiYWNrPExlZGdlck1ldGFkYXRhPiB7CiAgICAgICAgcHJpdmF0\nZSBmaW5hbCBpbnQgcmM7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBFbnNlbWJs\nZUluZm8gZW5zZW1ibGVJbmZvOwoKICAgICAgICBSZVJlYWRMZWRnZXJNZXRh\nZGF0YUNiKGludCByYywgRW5zZW1ibGVJbmZvIGVuc2VtYmxlSW5mbykgewog\nICAgICAgICAgICBzdXBlcihiay5tYWluV29ya2VyUG9vbCwgbGVkZ2VySWQp\nOwogICAgICAgICAgICB0aGlzLnJjID0gcmM7CiAgICAgICAgICAgIHRoaXMu\nZW5zZW1ibGVJbmZvID0gZW5zZW1ibGVJbmZvOwogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZXJhdGlv\nbkNvbXBsZXRlKGludCBuZXdyYywgTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkg\newogICAgICAgICAgICBpZiAobmV3cmMgIT0gQktFeGNlcHRpb24uQ29kZS5P\nSykgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciByZWFkaW5n\nIG5ldyBtZXRhZGF0YSBmcm9tIGxlZGdlciAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICsgImFmdGVyIGNoYW5naW5nIGVuc2VtYmxlLCBjb2RlPSIgKyBu\nZXdyYyk7CiAgICAgICAgICAgICAgICBoYW5kbGVVbnJlY292ZXJhYmxlRXJy\nb3JEdXJpbmdBZGQocmMpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgaWYgKCFyZXNvbHZlQ29uZmxpY3QobmV3TWV0YSkpIHsKICAg\nICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCByZXNvbHZl\nIGxlZGdlciBtZXRhZGF0YSBjb25mbGljdCAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICJ3aGlsZSBjaGFuZ2luZyBlbnNlbWJsZSB0bzogIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBlbnNlbWJsZUluZm8ubmV3\nRW5zZW1ibGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiwgb2xk\nIG1ldGEgZGF0YSBpcyBcbiIKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgbmV3IFN0cmluZyhtZXRhZGF0YS5zZXJpYWxpemUoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICsgIlxuLCBuZXcgbWV0YSBkYXRhIGlzIFxu\nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBuZXcgU3RyaW5nKG5l\nd01ldGEuc2VyaWFsaXplKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArICJcbiAsY2xvc2luZyBsZWRnZXIiKTsKICAgICAgICAgICAgICAgICAg\nICBoYW5kbGVVbnJlY292ZXJhYmxlRXJyb3JEdXJpbmdBZGQocmMpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICAvKioKICAgICAgICAgKiBSZXNvbHZpbmcgdGhlIHZlcnNpb24gY29uZmxp\nY3RzIGJldHdlZW4gbG9jYWwgbGVkZ2VyTWV0YWRhdGEgYW5kIHprCiAgICAg\nICAgICogbGVkZ2VyTWV0YWRhdGEuIFRoaXMgd2lsbCBkbyB0aGUgZm9sbG93\naW5nOgogICAgICAgICAqIDx1bD4KICAgICAgICAgKiA8bGk+CiAgICAgICAg\nICogY2hlY2sgd2hldGhlciBsZWRnZXJNZXRhZGF0YSBzdGF0ZSBtYXRjaGVz\nIG9mIGxvY2FsIGFuZCB6azwvbGk+CiAgICAgICAgICogPGxpPgogICAgICAg\nICAqIGlmIHRoZSB6ayBsZWRnZXJNZXRhZGF0YSBzdGlsbCBjb250YWlucyB0\naGUgZmFpbGVkIGJvb2tpZSwgdGhlbgogICAgICAgICAqIHVwZGF0ZSB6b29r\nZWVwZXIgd2l0aCB0aGUgbmV3Qm9va2llIG90aGVyd2lzZSBzZW5kIHdyaXRl\nIHJlcXVlc3Q8L2xpPgogICAgICAgICAqIDwvdWw+CiAgICAgICAgICovCiAg\nICAgICAgcHJpdmF0ZSBib29sZWFuIHJlc29sdmVDb25mbGljdChMZWRnZXJN\nZXRhZGF0YSBuZXdNZXRhKSB7CiAgICAgICAgICAgIC8vIGNsb3NlIGhhdmUg\nY2hhbmdlZCwgYW5vdGhlciBjbGllbnQgaGFzIG9wZW5lZAogICAgICAgICAg\nICAvLyB0aGUgbGVkZ2VyLCBjYW4ndCByZXNvbHZlIHRoaXMgY29uZmxpY3Qu\nCiAgICAgICAgICAgIGlmIChtZXRhZGF0YS5nZXRTdGF0ZSgpICE9IG5ld01l\ndGEuZ2V0U3RhdGUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHVwZGF0ZSB6bm9kZSB2\nZXJzaW9uCiAgICAgICAgICAgIG1ldGFkYXRhLnNldFZlcnNpb24obmV3TWV0\nYS5nZXRWZXJzaW9uKCkpOwogICAgICAgICAgICAvLyBSZXNvbHZlIHRoZSBj\nb25mbGljdHMgaWYgemsgbWV0YWRhdGEgc3RpbGwgY29udGFpbnMgZmFpbGVk\nCiAgICAgICAgICAgIC8vIGJvb2tpZS4KICAgICAgICAgICAgaWYgKG5ld01l\ndGEuY3VycmVudEVuc2VtYmxlLmdldChlbnNlbWJsZUluZm8uYm9va2llSW5k\nZXgpLmVxdWFscygKICAgICAgICAgICAgICAgICAgICBlbnNlbWJsZUluZm8u\nYWRkcikpIHsKICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBsZWRnZXIgbWV0\nYWRhdGEgaW4gemssIGlmIGluLW1lbW9yeSBtZXRhZGF0YSBkb2Vzbid0CiAg\nICAgICAgICAgICAgICAvLyBjb250YWlucyB0aGUgZmFpbGVkIGJvb2tpZS4K\nICAgICAgICAgICAgICAgIGlmICghbWV0YWRhdGEuY3VycmVudEVuc2VtYmxl\nLmdldChlbnNlbWJsZUluZm8uYm9va2llSW5kZXgpCiAgICAgICAgICAgICAg\nICAgICAgICAgIC5lcXVhbHMoZW5zZW1ibGVJbmZvLmFkZHIpKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmluZm8oIlJlc29sdmUgbGVkZ2VyIG1ldGFk\nYXRhIGNvbmZsaWN0ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nIndoaWxlIGNoYW5naW5nIGVuc2VtYmxlIHRvOiAiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIGVuc2VtYmxlSW5mby5uZXdFbnNlbWJsZQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBvbGQgbWV0YSBkYXRhIGlz\nIFxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBuZXcgU3RyaW5n\nKG1ldGFkYXRhLnNlcmlhbGl6ZSgpKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiXG4sIG5ldyBtZXRhIGRhdGEgaXMgXG4iCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICArIG5ldyBTdHJpbmcobmV3TWV0YS5zZXJpYWxp\nemUoKSkpOwogICAgICAgICAgICAgICAgICAgIHdyaXRlTGVkZ2VyQ29uZmln\nKG5ldyBDaGFuZ2VFbnNlbWJsZUNiKGVuc2VtYmxlSW5mbykpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgLy8gdGhlIGZhaWxlZCBib29raWUgaGFzIGJlZW4gcmVwbGFjZWQKICAg\nICAgICAgICAgICAgIGJsb2NrQWRkQ29tcGxldGlvbnMuZGVjcmVtZW50QW5k\nR2V0KCk7CiAgICAgICAgICAgICAgICB1bnNldFN1Y2Nlc3NBbmRTZW5kV3Jp\ndGVSZXF1ZXN0KGVuc2VtYmxlSW5mby5ib29raWVJbmRleCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAg\nIH07CgogICAgdm9pZCB1bnNldFN1Y2Nlc3NBbmRTZW5kV3JpdGVSZXF1ZXN0\nKGZpbmFsIGludCBib29raWVJbmRleCkgewogICAgICAgIGZvciAoUGVuZGlu\nZ0FkZE9wIHBlbmRpbmdBZGRPcCA6IHBlbmRpbmdBZGRPcHMpIHsKICAgICAg\nICAgICAgcGVuZGluZ0FkZE9wLnVuc2V0U3VjY2Vzc0FuZFNlbmRXcml0ZVJl\ncXVlc3QoYm9va2llSW5kZXgpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lk\nIHJlcmVhZE1ldGFkYXRhKGZpbmFsIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJN\nZXRhZGF0YT4gY2IpIHsKICAgICAgICBiay5nZXRMZWRnZXJNYW5hZ2VyKCku\ncmVhZExlZGdlck1ldGFkYXRhKGxlZGdlcklkLCBjYik7CiAgICB9CgogICAg\nc3luY2hyb25pemVkIHZvaWQgcmVjb3ZlcihmaW5hbCBHZW5lcmljQ2FsbGJh\nY2s8Vm9pZD4gY2IpIHsKICAgICAgICBpZiAobWV0YWRhdGEuaXNDbG9zZWQo\nKSkgewogICAgICAgICAgICBsYXN0QWRkQ29uZmlybWVkID0gbGFzdEFkZFB1\nc2hlZCA9IG1ldGFkYXRhLmdldExhc3RFbnRyeUlkKCk7CiAgICAgICAgICAg\nIGxlbmd0aCA9IG1ldGFkYXRhLmdldExlbmd0aCgpOwoKICAgICAgICAgICAg\nLy8gV2UgYXJlIGFscmVhZHkgY2xvc2VkLCBub3RoaW5nIHRvIGRvCiAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUu\nT0ssIG51bGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICAvLyBpZiBtZXRhZGF0YSBpcyBhbHJlYWR5IGluIHJlY292ZXIsIGRv\nbnQgdHJ5IHRvIHdyaXRlIGFnYWluLAogICAgICAgIC8vIGp1c3QgZG8gdGhl\nIHJlY292ZXJ5IGZyb20gdGhlIHN0YXJ0aW5nIHBvaW50CiAgICAgICAgaWYg\nKG1ldGFkYXRhLmlzSW5SZWNvdmVyeSgpKSB7CiAgICAgICAgICAgIG5ldyBM\nZWRnZXJSZWNvdmVyeU9wKExlZGdlckhhbmRsZS50aGlzLCBjYikuaW5pdGlh\ndGUoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nbWV0YWRhdGEubWFya0xlZGdlckluUmVjb3ZlcnkoKTsKCiAgICAgICAgd3Jp\ndGVMZWRnZXJDb25maWcobmV3IE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNr\nPFZvaWQ+KGJrLm1haW5Xb3JrZXJQb29sLCBsZWRnZXJJZCkgewogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZU9w\nZXJhdGlvbkNvbXBsZXRlKGZpbmFsIGludCByYywgVm9pZCByZXN1bHQpIHsK\nICAgICAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk1l\ndGFkYXRhVmVyc2lvbkV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAg\nIHJlcmVhZE1ldGFkYXRhKG5ldyBPcmRlcmVkU2FmZUdlbmVyaWNDYWxsYmFj\nazxMZWRnZXJNZXRhZGF0YT4oYmsubWFpbldvcmtlclBvb2wsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZCkgewogICAg\nICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZXJhdGlvbkNvbXBsZXRlKGlu\ndCByYywgTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0sp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRp\nb25Db21wbGV0ZShyYywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG1ldGFkYXRhID0gbmV3TWV0YTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZWNvdmVyKGNiKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYyA9PSBC\nS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3\nIExlZGdlclJlY292ZXJ5T3AoTGVkZ2VySGFuZGxlLnRoaXMsIGNiKS5pbml0\naWF0ZSgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHdyaXRpbmcgbGVkZ2VyIGNvbmZp\nZyAiICsgcmMgKyAiIG9mIGxlZGdlciAiICsgbGVkZ2VySWQpOwogICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKHJjLCBudWxsKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwog\nICAgfQoKICAgIHN0YXRpYyBjbGFzcyBOb29wQ2xvc2VDYWxsYmFjayBpbXBs\nZW1lbnRzIENsb3NlQ2FsbGJhY2sgewogICAgICAgIHN0YXRpYyBOb29wQ2xv\nc2VDYWxsYmFjayBpbnN0YW5jZSA9IG5ldyBOb29wQ2xvc2VDYWxsYmFjaygp\nOwoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBjbG9z\nZUNvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9L\nKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiQ2xvc2UgZmFpbGVkOiAi\nICsgQktFeGNlcHRpb24uZ2V0TWVzc2FnZShyYykpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIC8vIG5vb3AKICAgICAgICB9CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIFN5bmNSZWFkQ2FsbGJhY2sgaW1wbGVt\nZW50cyBSZWFkQ2FsbGJhY2sgewogICAgICAgIC8qKgogICAgICAgICAqIElt\ncGxlbWVudGF0aW9uIG9mIGNhbGxiYWNrIGludGVyZmFjZSBmb3Igc3luY2hy\nb25vdXMgcmVhZCBtZXRob2QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFy\nYW0gcmMKICAgICAgICAgKiAgICAgICAgICByZXR1cm4gY29kZQogICAgICAg\nICAqIEBwYXJhbSBsZWRlcgogICAgICAgICAqICAgICAgICAgIGxlZGdlciBp\nZGVudGlmaWVyCiAgICAgICAgICogQHBhcmFtIHNlcQogICAgICAgICAqICAg\nICAgICAgIHNlcXVlbmNlIG9mIGVudHJpZXMKICAgICAgICAgKiBAcGFyYW0g\nY3R4CiAgICAgICAgICogICAgICAgICAgY29udHJvbCBvYmplY3QKICAgICAg\nICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCByZWFkQ29tcGxldGUoaW50IHJj\nLCBMZWRnZXJIYW5kbGUgbGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiBzZXEsIE9iamVjdCBj\ndHgpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIFN5bmNDb3VudGVyIGNv\ndW50ZXIgPSAoU3luY0NvdW50ZXIpIGN0eDsKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChjb3VudGVyKSB7CiAgICAgICAgICAgICAgICBjb3VudGVyLnNl\ndFNlcXVlbmNlKHNlcSk7CiAgICAgICAgICAgICAgICBjb3VudGVyLnNldHJj\nKHJjKTsKICAgICAgICAgICAgICAgIGNvdW50ZXIuZGVjKCk7CiAgICAgICAg\nICAgICAgICBjb3VudGVyLm5vdGlmeSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFN5bmNBZGRD\nYWxsYmFjayBpbXBsZW1lbnRzIEFkZENhbGxiYWNrIHsKICAgICAgICBsb25n\nIGVudHJ5SWQgPSAtMTsKCiAgICAgICAgLyoqCiAgICAgICAgICogSW1wbGVt\nZW50YXRpb24gb2YgY2FsbGJhY2sgaW50ZXJmYWNlIGZvciBzeW5jaHJvbm91\ncyByZWFkIG1ldGhvZC4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBy\nYwogICAgICAgICAqICAgICAgICAgIHJldHVybiBjb2RlCiAgICAgICAgICog\nQHBhcmFtIGxlZGVyCiAgICAgICAgICogICAgICAgICAgbGVkZ2VyIGlkZW50\naWZpZXIKICAgICAgICAgKiBAcGFyYW0gZW50cnkKICAgICAgICAgKiAgICAg\nICAgICBlbnRyeSBpZGVudGlmaWVyCiAgICAgICAgICogQHBhcmFtIGN0eAog\nICAgICAgICAqICAgICAgICAgIGNvbnRyb2wgb2JqZWN0CiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIHZvaWQgYWRkQ29tcGxldGUoaW50IHJjLCBMZWRn\nZXJIYW5kbGUgbGgsIGxvbmcgZW50cnksIE9iamVjdCBjdHgpIHsKICAgICAg\nICAgICAgU3luY0NvdW50ZXIgY291bnRlciA9IChTeW5jQ291bnRlcikgY3R4\nOwoKICAgICAgICAgICAgdGhpcy5lbnRyeUlkID0gZW50cnk7CiAgICAgICAg\nICAgIGNvdW50ZXIuc2V0cmMocmMpOwogICAgICAgICAgICBjb3VudGVyLmRl\nYygpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBjbGFz\ncyBTeW5jUmVhZExhc3RDb25maXJtZWRDYWxsYmFjayBpbXBsZW1lbnRzIFJl\nYWRMYXN0Q29uZmlybWVkQ2FsbGJhY2sgewogICAgICAgIC8qKgogICAgICAg\nICAqIEltcGxlbWVudGF0aW9uIG9mICBjYWxsYmFjayBpbnRlcmZhY2UgZm9y\nIHN5bmNocm9ub3VzIHJlYWQgbGFzdCBjb25maXJtZWQgbWV0aG9kLgogICAg\nICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHJlYWRMYXN0Q29uZmlybWVk\nQ29tcGxldGUoaW50IHJjLCBsb25nIGxhc3RDb25maXJtZWQsIE9iamVjdCBj\ndHgpIHsKICAgICAgICAgICAgTGFzdENvbmZpcm1lZEN0eCBsY0N0eCA9IChM\nYXN0Q29uZmlybWVkQ3R4KSBjdHg7CiAgICAgICAgICAgIAogICAgICAgICAg\nICBzeW5jaHJvbml6ZWQobGNDdHgpIHsKICAgICAgICAgICAgICAgIGxjQ3R4\nLnNldFJDKHJjKTsKICAgICAgICAgICAgICAgIGxjQ3R4LnNldExhc3RDb25m\naXJtZWQobGFzdENvbmZpcm1lZCk7CiAgICAgICAgICAgICAgICBsY0N0eC5u\nb3RpZnkoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBTeW5jQ2xvc2VDYWxsYmFjayBpbXBsZW1l\nbnRzIENsb3NlQ2FsbGJhY2sgewogICAgICAgIC8qKgogICAgICAgICAqIENs\nb3NlIGNhbGxiYWNrIG1ldGhvZAogICAgICAgICAqCiAgICAgICAgICogQHBh\ncmFtIHJjCiAgICAgICAgICogQHBhcmFtIGxoCiAgICAgICAgICogQHBhcmFt\nIGN0eAogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlQ29t\ncGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIE9iamVjdCBjdHgpIHsK\nICAgICAgICAgICAgU3luY0NvdW50ZXIgY291bnRlciA9IChTeW5jQ291bnRl\ncikgY3R4OwogICAgICAgICAgICBjb3VudGVyLnNldHJjKHJjKTsKICAgICAg\nICAgICAgc3luY2hyb25pemVkIChjb3VudGVyKSB7CiAgICAgICAgICAgICAg\nICBjb3VudGVyLmRlYygpOwogICAgICAgICAgICAgICAgY291bnRlci5ub3Rp\nZnkoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

