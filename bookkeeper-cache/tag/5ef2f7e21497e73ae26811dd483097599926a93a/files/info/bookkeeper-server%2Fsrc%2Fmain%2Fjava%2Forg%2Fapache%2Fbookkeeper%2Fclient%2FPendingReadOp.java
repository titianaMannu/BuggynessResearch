{"sha":"90c0554b7283622ee0d78503f46a408ce651f8cf","node_id":"MDQ6QmxvYjE1NzU5NTY6OTBjMDU1NGI3MjgzNjIyZWUwZDc4NTAzZjQ2YTQwOGNlNjUxZjhjZg==","size":13723,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/90c0554b7283622ee0d78503f46a408ce651f8cf","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCmlt\ncG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LkFycmF5QmxvY2tpbmdRdWV1ZTsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZTsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRnV0dXJlOwppbXBvcnQg\namF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5FbnVtZXJh\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5Ob1N1Y2hFbGVtZW50RXhjZXB0aW9u\nOwppbXBvcnQgamF2YS51dGlsLlF1ZXVlOwppbXBvcnQgamF2YS51dGlsLkJp\ndFNldDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNCb29sZWFuOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJl\nYWRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQktFeGNlcHRpb24uQktEaWdlc3RNYXRjaEV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJu\nYWxDYWxsYmFja3MuUmVhZEVudHJ5Q2FsbGJhY2s7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7Cmlt\ncG9ydCBvcmcuamJvc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7Cmlt\ncG9ydCBvcmcuamJvc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXJJbnB1\ndFN0cmVhbTsKCi8qKgogKiBTZXF1ZW5jZSBvZiBlbnRyaWVzIG9mIGEgbGVk\nZ2VyIHRoYXQgcmVwcmVzZW50cyBhIHBlbmRpbmcgcmVhZCBvcGVyYXRpb24u\nCiAqIFdoZW4gYWxsIHRoZSBkYXRhIHJlYWQgaGFzIGNvbWUgYmFjaywgdGhl\nIGFwcGxpY2F0aW9uIGNhbGxiYWNrIGlzIGNhbGxlZC4KICogVGhpcyBjbGFz\ncyBjb3VsZCBiZSBpbXByb3ZlZCBiZWNhdXNlIHdlIGNvdWxkIHN0YXJ0IHB1\nc2hpbmcgZGF0YSB0byB0aGUKICogYXBwbGljYXRpb24gYXMgc29vbiBhcyBp\ndCBhcnJpdmVzIHJhdGhlciB0aGFuIHdhaXRpbmcgZm9yIHRoZSB3aG9sZSB0\naGluZy4KICoKICovCmNsYXNzIFBlbmRpbmdSZWFkT3AgaW1wbGVtZW50cyBF\nbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4sIFJlYWRFbnRyeUNhbGxiYWNrIHsK\nICAgIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihQZW5k\naW5nUmVhZE9wLmNsYXNzKTsKCiAgICBmaW5hbCBpbnQgc3BlY3VsYXRpdmVS\nZWFkVGltZW91dDsKICAgIGZpbmFsIHByaXZhdGUgU2NoZWR1bGVkRXhlY3V0\nb3JTZXJ2aWNlIHNjaGVkdWxlcjsKICAgIHByaXZhdGUgU2NoZWR1bGVkRnV0\ndXJlPD8+IHNwZWN1bGF0aXZlVGFzayA9IG51bGw7CiAgICBRdWV1ZTxMZWRn\nZXJFbnRyeVJlcXVlc3Q+IHNlcTsKICAgIFNldDxJbmV0U29ja2V0QWRkcmVz\ncz4gaGVhcmRGcm9tSG9zdHM7CiAgICBSZWFkQ2FsbGJhY2sgY2I7CiAgICBP\nYmplY3QgY3R4OwogICAgTGVkZ2VySGFuZGxlIGxoOwogICAgbG9uZyBudW1Q\nZW5kaW5nRW50cmllczsKICAgIGxvbmcgc3RhcnRFbnRyeUlkOwogICAgbG9u\nZyBlbmRFbnRyeUlkOwogICAgZmluYWwgaW50IG1heE1pc3NlZFJlYWRzQWxs\nb3dlZDsKCiAgICBjbGFzcyBMZWRnZXJFbnRyeVJlcXVlc3QgZXh0ZW5kcyBM\nZWRnZXJFbnRyeSB7CiAgICAgICAgZmluYWwgc3RhdGljIGludCBOT1RfRk9V\nTkQgPSAtMTsKICAgICAgICBpbnQgbmV4dFJlcGxpY2FJbmRleFRvUmVhZEZy\nb20gPSAwOwogICAgICAgIEF0b21pY0Jvb2xlYW4gY29tcGxldGUgPSBuZXcg\nQXRvbWljQm9vbGVhbihmYWxzZSk7CgogICAgICAgIGludCBmaXJzdEVycm9y\nID0gQktFeGNlcHRpb24uQ29kZS5PSzsKICAgICAgICBpbnQgbnVtTWlzc2Vk\nRW50cnlSZWFkcyA9IDA7CgogICAgICAgIGZpbmFsIEFycmF5TGlzdDxJbmV0\nU29ja2V0QWRkcmVzcz4gZW5zZW1ibGU7CiAgICAgICAgZmluYWwgTGlzdDxJ\nbnRlZ2VyPiB3cml0ZVNldDsKICAgICAgICBmaW5hbCBCaXRTZXQgc2VudFJl\ncGxpY2FzOwogICAgICAgIGZpbmFsIEJpdFNldCBlcnJvcmVkUmVwbGljYXM7\nCgogICAgICAgIExlZGdlckVudHJ5UmVxdWVzdChBcnJheUxpc3Q8SW5ldFNv\nY2tldEFkZHJlc3M+IGVuc2VtYmxlLCBsb25nIGxJZCwgbG9uZyBlSWQpIHsK\nICAgICAgICAgICAgc3VwZXIobElkLCBlSWQpOwoKICAgICAgICAgICAgdGhp\ncy5lbnNlbWJsZSA9IGVuc2VtYmxlOwogICAgICAgICAgICB0aGlzLndyaXRl\nU2V0ID0gbGguZGlzdHJpYnV0aW9uU2NoZWR1bGUuZ2V0V3JpdGVTZXQoZW50\ncnlJZCk7CiAgICAgICAgICAgIHRoaXMuc2VudFJlcGxpY2FzID0gbmV3IEJp\ndFNldChsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldFdyaXRlUXVvcnVtU2l6\nZSgpKTsKICAgICAgICAgICAgdGhpcy5lcnJvcmVkUmVwbGljYXMgPSBuZXcg\nQml0U2V0KGxoLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0V3JpdGVRdW9ydW1T\naXplKCkpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBpbnQgZ2V0UmVw\nbGljYUluZGV4KEluZXRTb2NrZXRBZGRyZXNzIGhvc3QpIHsKICAgICAgICAg\nICAgaW50IGJvb2tpZUluZGV4ID0gZW5zZW1ibGUuaW5kZXhPZihob3N0KTsK\nICAgICAgICAgICAgaWYgKGJvb2tpZUluZGV4ID09IC0xKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gTk9UX0ZPVU5EOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB3cml0ZVNldC5pbmRleE9mKGJvb2tpZUluZGV4KTsK\nICAgICAgICB9CgogICAgICAgIHByaXZhdGUgQml0U2V0IGdldFNlbnRUb0Jp\ndFNldCgpIHsKICAgICAgICAgICAgQml0U2V0IGIgPSBuZXcgQml0U2V0KGVu\nc2VtYmxlLnNpemUoKSk7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHNlbnRSZXBsaWNhcy5sZW5ndGgoKTsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBpZiAoc2VudFJlcGxpY2FzLmdldChpKSkgewogICAgICAgICAgICAg\nICAgICAgIGIuc2V0KHdyaXRlU2V0LmdldChpKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGI7CiAgICAg\nICAgfQoKICAgICAgICBwcml2YXRlIEJpdFNldCBnZXRIZWFyZEZyb21CaXRT\nZXQoU2V0PEluZXRTb2NrZXRBZGRyZXNzPiBoZWFyZEZyb21Ib3N0cykgewog\nICAgICAgICAgICBCaXRTZXQgYiA9IG5ldyBCaXRTZXQoZW5zZW1ibGUuc2l6\nZSgpKTsKICAgICAgICAgICAgZm9yIChJbmV0U29ja2V0QWRkcmVzcyBpIDog\naGVhcmRGcm9tSG9zdHMpIHsKICAgICAgICAgICAgICAgIGludCBpbmRleCA9\nIGVuc2VtYmxlLmluZGV4T2YoaSk7CiAgICAgICAgICAgICAgICBpZiAoaW5k\nZXggIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBiLnNldChpbmRleCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIGI7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGJvb2xlYW4g\ncmVhZHNPdXRzdGFuZGluZygpIHsKICAgICAgICAgICAgcmV0dXJuIChzZW50\nUmVwbGljYXMuY2FyZGluYWxpdHkoKSAtIGVycm9yZWRSZXBsaWNhcy5jYXJk\naW5hbGl0eSgpKSA+IDA7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBTZW5kIHRvIG5leHQgcmVwbGljYSBzcGVjdWxhdGl2ZWx5LCBpZiBy\nZXF1aXJlZCBhbmQgcG9zc2libGUuCiAgICAgICAgICogVGhpcyByZXR1cm5z\nIHRoZSBob3N0IHdlIG1heSBoYXZlIHNlbnQgdG8gZm9yIHVuaXQgdGVzdGlu\nZy4KICAgICAgICAgKiBAcmV0dXJuIGhvc3Qgd2Ugc2VudCB0byBpZiB3ZSBz\nZW50LiBudWxsIG90aGVyd2lzZS4KICAgICAgICAgKi8KICAgICAgICBzeW5j\naHJvbml6ZWQgSW5ldFNvY2tldEFkZHJlc3MgbWF5YmVTZW5kU3BlY3VsYXRp\ndmVSZWFkKFNldDxJbmV0U29ja2V0QWRkcmVzcz4gaGVhcmRGcm9tSG9zdHMp\nIHsKICAgICAgICAgICAgaWYgKG5leHRSZXBsaWNhSW5kZXhUb1JlYWRGcm9t\nID49IGxoLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0V3JpdGVRdW9ydW1TaXpl\nKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBCaXRTZXQgc2VudFRvID0gZ2V0U2VudFRvQml0\nU2V0KCk7CiAgICAgICAgICAgIEJpdFNldCBoZWFyZEZyb20gPSBnZXRIZWFy\nZEZyb21CaXRTZXQoaGVhcmRGcm9tSG9zdHMpOwogICAgICAgICAgICBzZW50\nVG8uYW5kKGhlYXJkRnJvbSk7CgogICAgICAgICAgICAvLyBvbmx5IHNlbmQg\nYW5vdGhlciByZWFkLCBpZiB3ZSBoYXZlIGhhZCBubyByZXNwb25zZSBhdCBh\nbGwgKGV2ZW4gZm9yIG90aGVyIGVudHJpZXMpCiAgICAgICAgICAgIC8vIGZy\nb20gYW55IG9mIHRoZSBvdGhlciBib29raWVzIHdlIGhhdmUgc2VudCB0aGUg\ncmVxdWVzdCB0bwogICAgICAgICAgICBpZiAoc2VudFRvLmNhcmRpbmFsaXR5\nKCkgPT0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHNlbmROZXh0UmVh\nZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN5\nbmNocm9uaXplZCBJbmV0U29ja2V0QWRkcmVzcyBzZW5kTmV4dFJlYWQoKSB7\nCiAgICAgICAgICAgIGlmIChuZXh0UmVwbGljYUluZGV4VG9SZWFkRnJvbSA+\nPSBsaC5tZXRhZGF0YS5nZXRXcml0ZVF1b3J1bVNpemUoKSkgewogICAgICAg\nICAgICAgICAgLy8gd2UgYXJlIGRvbmUsIHRoZSByZWFkIGhhcyBmYWlsZWQg\nZnJvbSBhbGwgcmVwbGljYXMsIGp1c3QgZmFpbCB0aGUKICAgICAgICAgICAg\nICAgIC8vIHJlYWQKCiAgICAgICAgICAgICAgICAvLyBEbyBpdCBhIGJpdCBw\nZXNzaW1pc3RpY2FsbHksIG9ubHkgd2hlbiBmaW5pc2hlZCB0cnlpbmcgYWxs\nIHJlcGxpY2FzCiAgICAgICAgICAgICAgICAvLyB0byBjaGVjayB3aGV0aGVy\nIHdlIHJlY2VpdmVkIG1vcmUgbWlzc2VkIHJlYWRzIHRoYW4gbWF4TWlzc2Vk\nUmVhZHNBbGxvd2VkCiAgICAgICAgICAgICAgICBpZiAoQktFeGNlcHRpb24u\nQ29kZS5Cb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24gPT0gZmly\nc3RFcnJvciAmJgogICAgICAgICAgICAgICAgICAgIG51bU1pc3NlZEVudHJ5\nUmVhZHMgPiBtYXhNaXNzZWRSZWFkc0FsbG93ZWQpIHsKICAgICAgICAgICAg\nICAgICAgICBmaXJzdEVycm9yID0gQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hF\nbnRyeUV4Y2VwdGlvbjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICBzdWJtaXRDYWxsYmFjayhmaXJzdEVycm9yKTsKICAgICAgICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nbnQgcmVwbGljYSA9IG5leHRSZXBsaWNhSW5kZXhUb1JlYWRGcm9tOwogICAg\nICAgICAgICBpbnQgYm9va2llSW5kZXggPSBsaC5kaXN0cmlidXRpb25TY2hl\nZHVsZS5nZXRXcml0ZVNldChlbnRyeUlkKS5nZXQobmV4dFJlcGxpY2FJbmRl\neFRvUmVhZEZyb20pOwogICAgICAgICAgICBuZXh0UmVwbGljYUluZGV4VG9S\nZWFkRnJvbSsrOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIEluZXRTb2NrZXRBZGRyZXNzIHRvID0gZW5zZW1ibGUuZ2V0KGJvb2tpZUlu\nZGV4KTsKICAgICAgICAgICAgICAgIHNlbmRSZWFkVG8odG8sIHRoaXMpOwog\nICAgICAgICAgICAgICAgc2VudFJlcGxpY2FzLnNldChyZXBsaWNhKTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0bzsKICAgICAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiSW50ZXJydXB0ZWQgcmVhZGluZyBlbnRyeSAiICsgdGhpcywg\naWUpOwogICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5p\nbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgIHN1Ym1pdENhbGxiYWNrKEJL\nRXhjZXB0aW9uLkNvZGUuUmVhZEV4Y2VwdGlvbik7CiAgICAgICAgICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgc3luY2hyb25pemVkIHZvaWQgbG9nRXJyb3JBbmRSZWF0dGVtcHRSZWFk\nKEluZXRTb2NrZXRBZGRyZXNzIGhvc3QsIFN0cmluZyBlcnJNc2csIGludCBy\nYykgewogICAgICAgICAgICBpZiAoQktFeGNlcHRpb24uQ29kZS5PSyA9PSBm\naXJzdEVycm9yIHx8CiAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbi5Db2Rl\nLk5vU3VjaEVudHJ5RXhjZXB0aW9uID09IGZpcnN0RXJyb3IpIHsKICAgICAg\nICAgICAgICAgIGZpcnN0RXJyb3IgPSByYzsKICAgICAgICAgICAgfSBlbHNl\nIGlmIChCS0V4Y2VwdGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2YWlsYWJs\nZUV4Y2VwdGlvbiA9PSBmaXJzdEVycm9yICYmCiAgICAgICAgICAgICAgICAg\nICAgICAgQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hFbnRyeUV4Y2VwdGlvbiAh\nPSByYykgewogICAgICAgICAgICAgICAgLy8gaWYgb3RoZXIgZXhjZXB0aW9u\nIHJhdGhlciB0aGFuIE5vU3VjaEVudHJ5RXhjZXB0aW9uIGlzIHJldHVybmVk\nCiAgICAgICAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHVwZGF0ZSBmaXJzdEVy\ncm9yIHRvIGluZGljYXRlIHRoYXQgaXQgbWlnaHQgYmUgYSB2YWxpZCByZWFk\nIGJ1dCBqdXN0IGZhaWxlZC4KICAgICAgICAgICAgICAgIGZpcnN0RXJyb3Ig\nPSByYzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoQktFeGNlcHRp\nb24uQ29kZS5Ob1N1Y2hFbnRyeUV4Y2VwdGlvbiA9PSByYykgewogICAgICAg\nICAgICAgICAgKytudW1NaXNzZWRFbnRyeVJlYWRzOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBMT0cuZXJyb3IoZXJyTXNnICsgIiB3aGlsZSByZWFk\naW5nIGVudHJ5OiAiICsgZW50cnlJZCArICIgbGVkZ2VySWQ6ICIgKyBsaC5s\nZWRnZXJJZCArICIgZnJvbSBib29raWU6ICIKICAgICAgICAgICAgICAgICAg\nICAgICsgaG9zdCk7CgogICAgICAgICAgICBpbnQgcmVwbGljYSA9IGdldFJl\ncGxpY2FJbmRleChob3N0KTsKICAgICAgICAgICAgaWYgKHJlcGxpY2EgPT0g\nTk9UX0ZPVU5EKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlJlY2Vp\ndmVkIGVycm9yIGZyb20gYSBob3N0IHdoaWNoIGlzIG5vdCBpbiB0aGUgZW5z\nZW1ibGUge30ge30uIiwgaG9zdCwgZW5zZW1ibGUpOwogICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yZWRS\nZXBsaWNhcy5zZXQocmVwbGljYSk7CgogICAgICAgICAgICBpZiAoIXJlYWRz\nT3V0c3RhbmRpbmcoKSkgewogICAgICAgICAgICAgICAgc2VuZE5leHRSZWFk\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHJldHVy\nbiB0cnVlIGlmIHdlIG1hbmFnZWQgdG8gY29tcGxldGUgdGhlIGVudHJ5CiAg\nICAgICAgLy8gcmV0dXJuIGZhbHNlIGlmIHRoZSByZWFkIGVudHJ5IGlzIG5v\ndCBjb21wbGV0ZSBvciBpdCBpcyBhbHJlYWR5IGNvbXBsZXRlZCBiZWZvcmUK\nICAgICAgICBib29sZWFuIGNvbXBsZXRlKEluZXRTb2NrZXRBZGRyZXNzIGhv\nc3QsIGZpbmFsIENoYW5uZWxCdWZmZXIgYnVmZmVyKSB7CiAgICAgICAgICAg\nIENoYW5uZWxCdWZmZXJJbnB1dFN0cmVhbSBpczsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGlzID0gbGgubWFjTWFuYWdlci52ZXJpZnlE\naWdlc3RBbmRSZXR1cm5EYXRhKGVudHJ5SWQsIGJ1ZmZlcik7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEJLRGlnZXN0TWF0Y2hFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgbG9nRXJyb3JBbmRSZWF0dGVtcHRSZWFkKGhvc3QsICJN\nYWMgbWlzbWF0Y2giLCBCS0V4Y2VwdGlvbi5Db2RlLkRpZ2VzdE1hdGNoRXhj\nZXB0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgaWYgKCFjb21wbGV0ZS5nZXRBbmRTZXQo\ndHJ1ZSkpIHsKICAgICAgICAgICAgICAgIGVudHJ5RGF0YVN0cmVhbSA9IGlz\nOwoKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBUaGUg\nbGVuZ3RoIGlzIGEgbG9uZyBhbmQgaXQgaXMgdGhlIGxhc3QgZmllbGQgb2Yg\ndGhlIG1ldGFkYXRhIG9mIGFuIGVudHJ5LgogICAgICAgICAgICAgICAgICog\nQ29uc2VxdWVudGx5LCB3ZSBoYXZlIHRvIHN1YnRyYWN0IDggZnJvbSBNRVRB\nREFUQV9MRU5HVEggdG8gZ2V0IHRoZSBsZW5ndGguCiAgICAgICAgICAgICAg\nICAgKi8KICAgICAgICAgICAgICAgIGxlbmd0aCA9IGJ1ZmZlci5nZXRMb25n\nKERpZ2VzdE1hbmFnZXIuTUVUQURBVEFfTEVOR1RIIC0gOCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgYm9vbGVhbiBpc0NvbXBsZXRlKCkgewogICAgICAg\nICAgICByZXR1cm4gY29tcGxldGUuZ2V0KCk7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1\ncm4gU3RyaW5nLmZvcm1hdCgiTCVkLUUlZCIsIGxlZGdlcklkLCBlbnRyeUlk\nKTsKICAgICAgICB9CiAgICB9CgogICAgUGVuZGluZ1JlYWRPcChMZWRnZXJI\nYW5kbGUgbGgsIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXIs\nCiAgICAgICAgICAgICAgICAgIGxvbmcgc3RhcnRFbnRyeUlkLCBsb25nIGVu\nZEVudHJ5SWQsIFJlYWRDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewogICAg\nICAgIHNlcSA9IG5ldyBBcnJheUJsb2NraW5nUXVldWU8TGVkZ2VyRW50cnlS\nZXF1ZXN0PigoaW50KSAoKGVuZEVudHJ5SWQgKyAxKSAtIHN0YXJ0RW50cnlJ\nZCkpOwogICAgICAgIHRoaXMuY2IgPSBjYjsKICAgICAgICB0aGlzLmN0eCA9\nIGN0eDsKICAgICAgICB0aGlzLmxoID0gbGg7CiAgICAgICAgdGhpcy5zdGFy\ndEVudHJ5SWQgPSBzdGFydEVudHJ5SWQ7CiAgICAgICAgdGhpcy5lbmRFbnRy\neUlkID0gZW5kRW50cnlJZDsKICAgICAgICB0aGlzLnNjaGVkdWxlciA9IHNj\naGVkdWxlcjsKICAgICAgICBudW1QZW5kaW5nRW50cmllcyA9IGVuZEVudHJ5\nSWQgLSBzdGFydEVudHJ5SWQgKyAxOwogICAgICAgIG1heE1pc3NlZFJlYWRz\nQWxsb3dlZCA9IGxoLm1ldGFkYXRhLmdldFdyaXRlUXVvcnVtU2l6ZSgpIC0g\nbGgubWV0YWRhdGEuZ2V0QWNrUXVvcnVtU2l6ZSgpOwogICAgICAgIHNwZWN1\nbGF0aXZlUmVhZFRpbWVvdXQgPSBsaC5iay5nZXRDb25mKCkuZ2V0U3BlY3Vs\nYXRpdmVSZWFkVGltZW91dCgpOwogICAgICAgIGhlYXJkRnJvbUhvc3RzID0g\nbmV3IEhhc2hTZXQ8SW5ldFNvY2tldEFkZHJlc3M+KCk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgaW5pdGlhdGUoKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgIGxvbmcgbmV4dEVuc2VtYmxlQ2hhbmdlID0gc3Rh\ncnRFbnRyeUlkLCBpID0gc3RhcnRFbnRyeUlkOwoKICAgICAgICBBcnJheUxp\nc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGVuc2VtYmxlID0gbnVsbDsKCiAgICAg\nICAgaWYgKHNwZWN1bGF0aXZlUmVhZFRpbWVvdXQgPiAwKSB7CiAgICAgICAg\nICAgIHNwZWN1bGF0aXZlVGFzayA9IHNjaGVkdWxlci5zY2hlZHVsZVdpdGhG\naXhlZERlbGF5KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGludCB4ID0gMDsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChMZWRn\nZXJFbnRyeVJlcXVlc3QgciA6IHNlcSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKCFyLmlzQ29tcGxldGUoKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IHIubWF5YmVTZW5kU3Bl\nY3VsYXRpdmVSZWFkKGhlYXJkRnJvbUhvc3RzKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlNlbmQgc3BlY3Vs\nYXRpdmUgcmVhZCBmb3Ige30uIEhvc3RzIGhlYXJkIGFyZSB7fS4iLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciwg\naGVhcmRGcm9tSG9zdHMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArK3g7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh4ID4g\nMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlNl\nbmQge30gc3BlY3VsYXRpdmUgcmVhZHMgZm9yIGxlZGdlciB7fSAoe30sIHt9\nKS4gSG9zdHMgaGVhcmQgYXJlIHt9LiIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W10geyB4LCBsaC5nZXRJZCgp\nLCBzdGFydEVudHJ5SWQsIGVuZEVudHJ5SWQsIGhlYXJkRnJvbUhvc3RzIH0p\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfSwgc3BlY3VsYXRpdmVSZWFkVGltZW91\ndCwgc3BlY3VsYXRpdmVSZWFkVGltZW91dCwgVGltZVVuaXQuTUlMTElTRUNP\nTkRTKTsKICAgICAgICB9CgogICAgICAgIGRvIHsKICAgICAgICAgICAgTE9H\nLmRlYnVnKCJBY3F1aXJpbmcgbG9jazoge30iLCBpKTsKCiAgICAgICAgICAg\nIGlmIChpID09IG5leHRFbnNlbWJsZUNoYW5nZSkgewogICAgICAgICAgICAg\nICAgZW5zZW1ibGUgPSBsaC5tZXRhZGF0YS5nZXRFbnNlbWJsZShpKTsKICAg\nICAgICAgICAgICAgIG5leHRFbnNlbWJsZUNoYW5nZSA9IGxoLm1ldGFkYXRh\nLmdldE5leHRFbnNlbWJsZUNoYW5nZShpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBMZWRnZXJFbnRyeVJlcXVlc3QgZW50cnkgPSBuZXcgTGVkZ2Vy\nRW50cnlSZXF1ZXN0KGVuc2VtYmxlLCBsaC5sZWRnZXJJZCwgaSk7CiAgICAg\nICAgICAgIHNlcS5hZGQoZW50cnkpOwogICAgICAgICAgICBpKys7CgogICAg\nICAgICAgICBlbnRyeS5zZW5kTmV4dFJlYWQoKTsKICAgICAgICB9IHdoaWxl\nIChpIDw9IGVuZEVudHJ5SWQpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIGNsYXNzIFJlYWRDb250ZXh0IHsKICAgICAgICBmaW5hbCBJbmV0U29ja2V0\nQWRkcmVzcyB0bzsKICAgICAgICBmaW5hbCBMZWRnZXJFbnRyeVJlcXVlc3Qg\nZW50cnk7CgogICAgICAgIFJlYWRDb250ZXh0KEluZXRTb2NrZXRBZGRyZXNz\nIHRvLCBMZWRnZXJFbnRyeVJlcXVlc3QgZW50cnkpIHsKICAgICAgICAgICAg\ndGhpcy50byA9IHRvOwogICAgICAgICAgICB0aGlzLmVudHJ5ID0gZW50cnk7\nCiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgc2VuZFJlYWRUbyhJbmV0U29j\na2V0QWRkcmVzcyB0bywgTGVkZ2VyRW50cnlSZXF1ZXN0IGVudHJ5KSB0aHJv\nd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIGxoLnRocm90dGxl\nci5hY3F1aXJlKCk7CgogICAgICAgIGxoLmJrLmJvb2tpZUNsaWVudC5yZWFk\nRW50cnkodG8sIGxoLmxlZGdlcklkLCBlbnRyeS5lbnRyeUlkLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMsIG5ldyBSZWFk\nQ29udGV4dCh0bywgZW50cnkpKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIHJlYWRFbnRyeUNvbXBsZXRlKGludCByYywgbG9uZyBs\nZWRnZXJJZCwgZmluYWwgbG9uZyBlbnRyeUlkLCBmaW5hbCBDaGFubmVsQnVm\nZmVyIGJ1ZmZlciwgT2JqZWN0IGN0eCkgewogICAgICAgIGZpbmFsIFJlYWRD\nb250ZXh0IHJjdHggPSAoUmVhZENvbnRleHQpY3R4OwogICAgICAgIGZpbmFs\nIExlZGdlckVudHJ5UmVxdWVzdCBlbnRyeSA9IHJjdHguZW50cnk7CgogICAg\nICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAg\nICAgIGVudHJ5LmxvZ0Vycm9yQW5kUmVhdHRlbXB0UmVhZChyY3R4LnRvLCAi\nRXJyb3I6ICIgKyBCS0V4Y2VwdGlvbi5nZXRNZXNzYWdlKHJjKSwgcmMpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBoZWFyZEZy\nb21Ib3N0cy5hZGQocmN0eC50byk7CgogICAgICAgIGlmIChlbnRyeS5jb21w\nbGV0ZShyY3R4LnRvLCBidWZmZXIpKSB7CiAgICAgICAgICAgIG51bVBlbmRp\nbmdFbnRyaWVzLS07CiAgICAgICAgICAgIGlmIChudW1QZW5kaW5nRW50cmll\ncyA9PSAwKSB7CiAgICAgICAgICAgICAgICBzdWJtaXRDYWxsYmFjayhCS0V4\nY2VwdGlvbi5Db2RlLk9LKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgaWYobnVtUGVuZGluZ0VudHJpZXMgPCAwKQogICAgICAgICAgICBM\nT0cuZXJyb3IoIlJlYWQgdG9vIG1hbnkgdmFsdWVzIik7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIHN1Ym1pdENhbGxiYWNrKGludCBjb2RlKSB7CiAgICAg\nICAgaWYgKHNwZWN1bGF0aXZlVGFzayAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHNwZWN1bGF0aXZlVGFzay5jYW5jZWwodHJ1ZSk7CiAgICAgICAgICAgIHNw\nZWN1bGF0aXZlVGFzayA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGNiLnJl\nYWRDb21wbGV0ZShjb2RlLCBsaCwgUGVuZGluZ1JlYWRPcC50aGlzLCBQZW5k\naW5nUmVhZE9wLnRoaXMuY3R4KTsKICAgIH0KICAgIHB1YmxpYyBib29sZWFu\nIGhhc01vcmVFbGVtZW50cygpIHsKICAgICAgICByZXR1cm4gIXNlcS5pc0Vt\ncHR5KCk7CiAgICB9CgogICAgcHVibGljIExlZGdlckVudHJ5IG5leHRFbGVt\nZW50KCkgdGhyb3dzIE5vU3VjaEVsZW1lbnRFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBzZXEucmVtb3ZlKCk7CiAgICB9CgogICAgcHVibGljIGludCBz\naXplKCkgewogICAgICAgIHJldHVybiBzZXEuc2l6ZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

