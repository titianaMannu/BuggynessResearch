{"sha":"aee9795093059a302555b12d4288a22003f9f0bc","node_id":"MDQ6QmxvYjE1NzU5NTY6YWVlOTc5NTA5MzA1OWEzMDI1NTViMTJkNDI4OGEyMjAwM2Y5ZjBiYw==","size":19669,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/aee9795093059a302555b12d4288a22003f9f0bc","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YTsKCi8qKgogKiBM\naWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFT\nRikgdW5kZXIgb25lCiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBh\nZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQogKiBkaXN0cmlidXRl\nZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvbgog\nKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGlj\nZW5zZXMgdGhpcyBmaWxlCiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExp\nY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUKICogIkxpY2Vuc2UiKTsgeW91IG1h\neSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZQogKiB3\naXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRo\nZSBMaWNlbnNlIGF0CiAqCiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0\nd2FyZQogKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbiAiQVMgSVMiIEJBU0lTLAogKiBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJl\nc3Mgb3IgaW1wbGllZC4KICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3Bl\nY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZAogKiBs\naW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS4KICovCgppbXBvcnQgamF2\nYS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLkV4ZWN1dG9yczsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNjaGVk\ndWxlZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwppbXBvcnQgamF2YS51dGlsLkl0\nZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTm9TdWNoRWxlbWVudEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5T\nZXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRn\nZXJNZXRhZGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLkFic3RyYWN0Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2Vu\nZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Qcm9jZXNzb3I7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TdHJpbmdVdGlsczsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlprVXRpbHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQXN5bmNDYWxsYmFjay5TdHJpbmdD\nYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1v\nZGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRp\nb24uQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0RlZnMu\nSWRzOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwoK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyRmFjdG9yeTsKCi8qKgogKiBIaWVyYXJjaGljYWwgTGVkZ2VyIE1hbmFn\nZXIgd2hpY2ggbWFuYWdlcyBsZWRnZXIgbWV0YSBpbiB6b29rZWVwZXIgdXNp\nbmcgMi1sZXZlbCBoaWVyYXJjaGljYWwgem5vZGVzLgogKgogKiA8cD4KICog\nSGllcmFyY2hpY2FsIExlZGdlciBNYW5hZ2VyIGZpcnN0IG9idGFpbiBhIGds\nb2JhbCB1bmlxdWUgaWQgZnJvbSB6b29rZWVwZXIgdXNpbmcgYSBFUEhFTUVS\nQUxfU0VRVUVOVElBTAogKiB6bm9kZSA8aT4obGVkZ2Vyc1Jvb3RQYXRoKS9s\nZWRnZXJzL2lkZ2VuL0lELTwvaT4uCiAqIFNpbmNlIHpvb2tlZXBlciBzZXF1\nZW50aWFsIGNvdW50ZXIgaGFzIGEgZm9ybWF0IG9mICUxMGQgLS0gdGhhdCBp\ncyAxMCBkaWdpdHMgd2l0aCAwICh6ZXJvKSBwYWRkaW5nLCBpLmUuCiAqICIm\nbHQ7cGF0aCZndDswMDAwMDAwMDAxIiwgSGllcmFyY2hpY2FsTGVkZ2VyTWFu\nYWdlciBzcGxpdHMgdGhlIGdlbmVyYXRlZCBpZCBpbnRvIDMgcGFydHMgKDIt\nNC00KToKICogPHByZT4mbHQ7bGV2ZWwxICgyIGRpZ2l0cykmZ3Q7Jmx0O2xl\ndmVsMiAoNCBkaWdpdHMpJmd0OyZsdDtsZXZlbDMgKDQgZGlnaXRzKSZndDs8\nL3ByZT4KICogVGhlc2UgMyBwYXJ0cyBhcmUgdXNlZCB0byBmb3JtIHRoZSBh\nY3R1YWwgbGVkZ2VyIG5vZGUgcGF0aCB1c2VkIHRvIHN0b3JlIGxlZGdlciBt\nZXRhZGF0YToKICogPHByZT4obGVkZ2Vyc1Jvb3RQYXRoKS9sZXZlbDEvbGV2\nZWwyL0wobGV2ZWwzKTwvcHJlPgogKiBFLmcgTGVkZ2VyIDAwMDAwMDAwMDEg\naXMgc3BsaXQgaW50byAzIHBhcnRzIDxpPjAwPC9pPiwgPGk+MDAwMDwvaT4s\nIDxpPjAwMDE8L2k+LCB3aGljaCBpcyBzdG9yZWQgaW4KICogPGk+KGxlZGdl\ncnNSb290UGF0aCkvMDAvMDAwMC9MMDAwMTwvaT4uIFNvIGVhY2ggem5vZGUg\nY291bGQgaGF2ZSBhdCBtb3N0IDEwMDAwIGxlZGdlcnMsIHdoaWNoIGF2b2lk\ncwogKiBlcnJvcnMgZHVyaW5nIGdhcmJhZ2UgY29sbGVjdGlvbiBkdWUgdG8g\nbGlzdHMgb2YgY2hpbGRyZW4gdGhhdCBhcmUgdG9vIGxvbmcuCiAqLwpjbGFz\ncyBIaWVyYXJjaGljYWxMZWRnZXJNYW5hZ2VyIGV4dGVuZHMgQWJzdHJhY3Ra\na0xlZGdlck1hbmFnZXIgewoKICAgIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9H\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSGllcmFyY2hpY2FsTGVkZ2Vy\nTWFuYWdlci5jbGFzcyk7CgogICAgc3RhdGljIGZpbmFsIFN0cmluZyBJREdF\nTl9aTk9ERSA9ICJpZGdlbiI7CiAgICBzdGF0aWMgZmluYWwgU3RyaW5nIElE\nR0VORVJBVElPTl9QUkVGSVggPSAiLyIgKyBJREdFTl9aTk9ERSArICIvSUQt\nIjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBNQVhfSURfU1VG\nRklYID0gIjk5OTkiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5n\nIE1JTl9JRF9TVUZGSVggPSAiMDAwMCI7CgogICAgLy8gUGF0aCB0byBnZW5l\ncmF0ZSBnbG9iYWwgaWQKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIGlkR2Vu\nUGF0aDsKCiAgICAvLyB3ZSB1c2UgdGhpcyB0byBwcmV2ZW50IGxvbmcgc3Rh\nY2sgY2hhaW5zIGZyb20gYnVpbGRpbmcgdXAgaW4gY2FsbGJhY2tzCiAgICBT\nY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1bGVyOwoKICAgIC8qKgog\nICAgICogQ29uc3RydWN0b3IKICAgICAqCiAgICAgKiBAcGFyYW0gY29uZgog\nICAgICogICAgICAgICAgQ29uZmlndXJhdGlvbiBvYmplY3QKICAgICAqIEBw\nYXJhbSB6awogICAgICogICAgICAgICAgWm9vS2VlcGVyIENsaWVudCBIYW5k\nbGUKICAgICAqLwogICAgcHVibGljIEhpZXJhcmNoaWNhbExlZGdlck1hbmFn\nZXIoQWJzdHJhY3RDb25maWd1cmF0aW9uIGNvbmYsIFpvb0tlZXBlciB6aykg\newogICAgICAgIHN1cGVyKGNvbmYsIHprKTsKCiAgICAgICAgdGhpcy5pZEdl\nblBhdGggPSBsZWRnZXJSb290UGF0aCArIElER0VORVJBVElPTl9QUkVGSVg7\nCiAgICAgICAgdGhpcy5zY2hlZHVsZXIgPSBFeGVjdXRvcnMubmV3U2luZ2xl\nVGhyZWFkU2NoZWR1bGVkRXhlY3V0b3IoKTsKICAgICAgICBMT0cuZGVidWco\nIlVzaW5nIEhpZXJhcmNoaWNhbExlZGdlck1hbmFnZXIgd2l0aCByb290IHBh\ndGggOiB7fSIsIGxlZGdlclJvb3RQYXRoKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIHNjaGVkdWxlci5zaHV0ZG93bigpOwogICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJFcnJv\nciB3aGVuIGNsb3NpbmcgSGllcmFyY2hpY2FsTGVkZ2VyTWFuYWdlciA6ICIs\nIGUpOwogICAgICAgIH0KICAgICAgICBzdXBlci5jbG9zZSgpOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY3JlYXRlTGVkZ2VyKGZp\nbmFsIExlZGdlck1ldGFkYXRhIG1ldGFkYXRhLCBmaW5hbCBHZW5lcmljQ2Fs\nbGJhY2s8TG9uZz4gbGVkZ2VyQ2IpIHsKICAgICAgICBaa1V0aWxzLmNyZWF0\nZUZ1bGxQYXRoT3B0aW1pc3RpYyh6aywgaWRHZW5QYXRoLCBuZXcgYnl0ZVsw\nXSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAgICAgQ3JlYXRlTW9k\nZS5FUEhFTUVSQUxfU0VRVUVOVElBTCwgbmV3IFN0cmluZ0NhbGxiYWNrKCkg\newogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZv\naWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3Qg\nY3R4LCBmaW5hbCBTdHJpbmcgaWRQYXRoTmFtZSkgewogICAgICAgICAgICAg\nICAgaWYgKHJjICE9IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk9LLmludFZhbHVl\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5v\ndCBnZW5lcmF0ZSBuZXcgbGVkZ2VyIGlkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNl\ncHRpb24uQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAg\nICAgbGVkZ2VyQ2Iub3BlcmF0aW9uQ29tcGxldGUocmMsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBFeHRyYWN0IGxl\nZGdlciBpZCBmcm9tIGdlbiBwYXRoCiAgICAgICAgICAgICAgICAgKi8KICAg\nICAgICAgICAgICAgIGxvbmcgbGVkZ2VySWQ7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGxlZGdlcklkID0gZ2V0TGVkZ2Vy\nSWRGcm9tR2VuUGF0aChpZFBhdGhOYW1lKTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkNvdWxkIG5vdCBleHRyYWN0IGxlZGdlci1pZCBmcm9tIGlk\nIGdlbiBwYXRoOiIgKyBwYXRoLCBlKTsKICAgICAgICAgICAgICAgICAgICBs\nZWRnZXJDYi5vcGVyYXRpb25Db21wbGV0ZShLZWVwZXJFeGNlcHRpb24uQ29k\nZS5TWVNURU1FUlJPUi5pbnRWYWx1ZSgpLCBudWxsKTsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBTdHJpbmcgbGVkZ2VyUGF0aCA9IGdldExlZGdlclBhdGgobGVkZ2Vy\nSWQpOwogICAgICAgICAgICAgICAgZmluYWwgbG9uZyBsaWQgPSBsZWRnZXJJ\nZDsKICAgICAgICAgICAgICAgIFN0cmluZ0NhbGxiYWNrIHNjYiA9IG5ldyBT\ndHJpbmdDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVz\ndWx0KGludCByYywgU3RyaW5nIHBhdGgsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBPYmplY3QgY3R4LCBTdHJpbmcgbmFtZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAocmMgIT0gS2VlcGVyRXhjZXB0aW9uLkNvZGUu\nT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLmVycm9yKCJDb3VsZCBub3QgY3JlYXRlIG5vZGUgZm9yIGxlZGdlciIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2VlcGVy\nRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNlcHRpb24uQ29kZS5nZXQocmMp\nLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJD\nYi5vcGVyYXRpb25Db21wbGV0ZShyYywgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyB1cGRhdGUgdmVyc2lvbgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbWV0YWRhdGEuc2V0VmVyc2lvbihuZXcgWmtWZXJzaW9uKDApKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckNiLm9wZXJhdGlvbkNv\nbXBsZXRlKHJjLCBsaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAg\nICAgICAgICAgIFprVXRpbHMuY3JlYXRlRnVsbFBhdGhPcHRpbWlzdGljKHpr\nLCBsZWRnZXJQYXRoLCBtZXRhZGF0YS5zZXJpYWxpemUoKSwKICAgICAgICAg\nICAgICAgICAgICBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBF\nUlNJU1RFTlQsIHNjYiwgbnVsbCk7CiAgICAgICAgICAgICAgICAvLyBkZWxl\ndGUgdGhlIHpub2RlIGZvciBpZCBnZW5lcmF0aW9uCiAgICAgICAgICAgICAg\nICBzY2hlZHVsZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHprLmRl\nbGV0ZShpZFBhdGhOYW1lLCAtMSwgbmV3IEFzeW5jQ2FsbGJhY2suVm9pZENh\nbGxiYWNrKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBw\ncm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0g\nS2VlcGVyRXhjZXB0aW9uLkNvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiRXhjZXB0\naW9uIGR1cmluZyBkZWxldGluZyB6bm9kZSBmb3IgaWQgZ2VuZXJhdGlvbiA6\nICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoS2VlcGVyRXhjZXB0aW9uLkNv\nZGUuZ2V0KHJjKSwgcGF0aCkpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiRGVsZXRpbmcgem5vZGUgZm9yIGlkIGdlbmVy\nYXRpb24gOiB7fSIsIGlkUGF0aE5hbWUpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9LCBudWxsKTsKICAgIH0KCiAgICAvLyBnZXQgbGVkZ2VyIGlk\nIGZyb20gZ2VuZXJhdGlvbiBwYXRoCiAgICBwcml2YXRlIGxvbmcgZ2V0TGVk\nZ2VySWRGcm9tR2VuUGF0aChTdHJpbmcgbm9kZU5hbWUpIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgbG9uZyBsZWRnZXJJZDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBTdHJpbmcgcGFydHNbXSA9IG5vZGVOYW1lLnNwbGl0\nKElER0VORVJBVElPTl9QUkVGSVgpOwogICAgICAgICAgICBsZWRnZXJJZCA9\nIExvbmcucGFyc2VMb25nKHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdKTsKICAg\nICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBsZWRnZXJJZDsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyBTdHJpbmcgZ2V0TGVkZ2VyUGF0aChsb25nIGxlZGdlcklk\nKSB7CiAgICAgICAgcmV0dXJuIGxlZGdlclJvb3RQYXRoICsgU3RyaW5nVXRp\nbHMuZ2V0SGllcmFyY2hpY2FsTGVkZ2VyUGF0aChsZWRnZXJJZCk7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgbG9uZyBnZXRMZWRnZXJJZChT\ndHJpbmcgcGF0aE5hbWUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKCFwYXRoTmFtZS5zdGFydHNXaXRoKGxlZGdlclJvb3RQYXRoKSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIml0IGlzIG5vdCBh\nIHZhbGlkIGhhc2hlZCBwYXRoIG5hbWUgOiAiICsgcGF0aE5hbWUpOwogICAg\nICAgIH0KICAgICAgICBTdHJpbmcgaGllcmFyY2hpY2FsUGF0aCA9IHBhdGhO\nYW1lLnN1YnN0cmluZyhsZWRnZXJSb290UGF0aC5sZW5ndGgoKSArIDEpOwog\nICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5zdHJpbmdUb0hpZXJhcmNoaWNh\nbExlZGdlcklkKGhpZXJhcmNoaWNhbFBhdGgpOwogICAgfQoKICAgIC8vIGdl\ndCBsZWRnZXIgZnJvbSBhbGwgbGV2ZWwgbm9kZXMKICAgIHByaXZhdGUgbG9u\nZyBnZXRMZWRnZXJJZChTdHJpbmcuLi5sZXZlbE5vZGVzKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHJldHVybiBTdHJpbmdVdGlscy5zdHJpbmdU\nb0hpZXJhcmNoaWNhbExlZGdlcklkKGxldmVsTm9kZXMpOwogICAgfQoKICAg\nIC8vCiAgICAvLyBBY3RpdmUgTGVkZ2VyIE1hbmFnZXIKICAgIC8vCgogICAg\nLyoqCiAgICAgKiBHZXQgdGhlIHNtYWxsZXN0IGNhY2hlIGlkIGluIGEgc3Bl\nY2lmaWVkIG5vZGUgL2xldmVsMS9sZXZlbDIKICAgICAqCiAgICAgKiBAcGFy\nYW0gbGV2ZWwxCiAgICAgKiAgICAgICAgICAxc3QgbGV2ZWwgbm9kZSBuYW1l\nCiAgICAgKiBAcGFyYW0gbGV2ZWwyCiAgICAgKiAgICAgICAgICAybmQgbGV2\nZWwgbm9kZSBuYW1lCiAgICAgKiBAcmV0dXJuIHRoZSBzbWFsbGVzdCBsZWRn\nZXIgaWQKICAgICAqLwogICAgcHJpdmF0ZSBsb25nIGdldFN0YXJ0TGVkZ2Vy\nSWRCeUxldmVsKFN0cmluZyBsZXZlbDEsIFN0cmluZyBsZXZlbDIpIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGdldExlZGdlcklkKGxl\ndmVsMSwgbGV2ZWwyLCBNSU5fSURfU1VGRklYKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEdldCB0aGUgbGFyZ2VzdCBjYWNoZSBpZCBpbiBhIHNwZWNpZmll\nZCBub2RlIC9sZXZlbDEvbGV2ZWwyCiAgICAgKgogICAgICogQHBhcmFtIGxl\ndmVsMQogICAgICogICAgICAgICAgMXN0IGxldmVsIG5vZGUgbmFtZQogICAg\nICogQHBhcmFtIGxldmVsMgogICAgICogICAgICAgICAgMm5kIGxldmVsIG5v\nZGUgbmFtZQogICAgICogQHJldHVybiB0aGUgbGFyZ2VzdCBsZWRnZXIgaWQK\nICAgICAqLwogICAgcHJpdmF0ZSBsb25nIGdldEVuZExlZGdlcklkQnlMZXZl\nbChTdHJpbmcgbGV2ZWwxLCBTdHJpbmcgbGV2ZWwyKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBnZXRMZWRnZXJJZChsZXZlbDEsIGxl\ndmVsMiwgTUFYX0lEX1NVRkZJWCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgdm9pZCBhc3luY1Byb2Nlc3NMZWRnZXJzKGZpbmFsIFByb2Nl\nc3NvcjxMb25nPiBwcm9jZXNzb3IsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNr\nIGZpbmFsQ2IsIGZpbmFsIE9iamVjdCBjb250ZXh0LAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBpbnQgc3VjY2Vzc1JjLCBm\naW5hbCBpbnQgZmFpbHVyZVJjKSB7CiAgICAgICAgLy8gcHJvY2VzcyAxc3Qg\nbGV2ZWwgbm9kZXMKICAgICAgICBhc3luY1Byb2Nlc3NMZXZlbE5vZGVzKGxl\nZGdlclJvb3RQYXRoLCBuZXcgUHJvY2Vzc29yPFN0cmluZz4oKSB7CiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9j\nZXNzKGZpbmFsIFN0cmluZyBsMU5vZGUsIGZpbmFsIEFzeW5jQ2FsbGJhY2su\nVm9pZENhbGxiYWNrIGNiMSkgewogICAgICAgICAgICAgICAgaWYgKGlzU3Bl\nY2lhbFpub2RlKGwxTm9kZSkpIHsKICAgICAgICAgICAgICAgICAgICBjYjEu\ncHJvY2Vzc1Jlc3VsdChzdWNjZXNzUmMsIG51bGwsIGNvbnRleHQpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGZpbmFsIFN0cmluZyBsMU5vZGVQYXRoID0gbGVkZ2Vy\nUm9vdFBhdGggKyAiLyIgKyBsMU5vZGU7CiAgICAgICAgICAgICAgICAvLyBw\ncm9jZXNzIGxldmVsMSBwYXRoLCBhZnRlciBhbGwgY2hpbGRyZW4gb2YgbGV2\nZWwxIHByb2Nlc3MKICAgICAgICAgICAgICAgIC8vIGl0IGNhbGxiYWNrIHRv\nIGNvbnRpbnVlIHByb2Nlc3NpbmcgbmV4dCBsZXZlbDEgbm9kZQogICAgICAg\nICAgICAgICAgYXN5bmNQcm9jZXNzTGV2ZWxOb2RlcyhsMU5vZGVQYXRoLCBu\nZXcgUHJvY2Vzc29yPFN0cmluZz4oKSB7CiAgICAgICAgICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJv\nY2VzcyhTdHJpbmcgbDJOb2RlLCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFj\nayBjYjIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBs\nZXZlbDEvbGV2ZWwyIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgU3Ry\naW5nIGwyTm9kZVBhdGggPSBsZWRnZXJSb290UGF0aCArICIvIiArIGwxTm9k\nZSArICIvIiArIGwyTm9kZTsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\ncHJvY2VzcyBlYWNoIGxlZGdlcgogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBhZnRlciBhbGwgbGVkZ2VyIGFyZSBwcm9jZXNzZWQsIGNiMiB3aWxsIGJl\nIGNhbGwgdG8gY29udGludWUgcHJvY2Vzc2luZyBuZXh0IGxldmVsMiBub2Rl\nCiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jUHJvY2Vzc0xlZGdlcnNJ\nblNpbmdsZU5vZGUobDJOb2RlUGF0aCwgcHJvY2Vzc29yLCBjYjIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY29udGV4dCwgc3VjY2Vzc1JjLCBmYWlsdXJlUmMpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIGNiMSwgY29udGV4\ndCwgc3VjY2Vzc1JjLCBmYWlsdXJlUmMpOwogICAgICAgICAgICB9CiAgICAg\nICAgfSwgZmluYWxDYiwgY29udGV4dCwgc3VjY2Vzc1JjLCBmYWlsdXJlUmMp\nOwogICAgfQoKICAgIC8qKgogICAgICogUHJvY2VzcyBoYXNoIG5vZGVzIGlu\nIGEgZ2l2ZW4gcGF0aAogICAgICovCiAgICBwcml2YXRlIHZvaWQgYXN5bmNQ\ncm9jZXNzTGV2ZWxOb2RlcygKICAgICAgICBmaW5hbCBTdHJpbmcgcGF0aCwg\nZmluYWwgUHJvY2Vzc29yPFN0cmluZz4gcHJvY2Vzc29yLAogICAgICAgIGZp\nbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGZpbmFsQ2IsIGZpbmFs\nIE9iamVjdCBjb250ZXh0LAogICAgICAgIGZpbmFsIGludCBzdWNjZXNzUmMs\nIGZpbmFsIGludCBmYWlsdXJlUmMpIHsKICAgICAgICB6ay5zeW5jKHBhdGgs\nIG5ldyBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjaygpIHsKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NS\nZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFsdWUoKSkgewog\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Igc3luY2luZyBw\nYXRoICIgKyBwYXRoICsgIiB3aGVuIGdldHRpbmcgaXRzIGNoaWRyZW46ICIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlv\nbi5jcmVhdGUoS2VlcGVyRXhjZXB0aW9uLkNvZGUuZ2V0KHJjKSwgcGF0aCkp\nOwogICAgICAgICAgICAgICAgICAgIGZpbmFsQ2IucHJvY2Vzc1Jlc3VsdChm\nYWlsdXJlUmMsIG51bGwsIGNvbnRleHQpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB6\nay5nZXRDaGlsZHJlbihwYXRoLCBmYWxzZSwgbmV3IEFzeW5jQ2FsbGJhY2su\nQ2hpbGRyZW5DYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNz\nUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMaXN0\nPFN0cmluZz4gbGV2ZWxOb2RlcykgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAocmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHBvbGxpbmcgaGFz\naCBub2RlcyBvZiAiICsgcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24uY3JlYXRlKEtlZXBlckV4\nY2VwdGlvbi5Db2RlLmdldChyYyksIHBhdGgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZpbmFsQ2IucHJvY2Vzc1Jlc3VsdChmYWlsdXJlUmMs\nIG51bGwsIGNvbnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIEFzeW5jTGlzdFByb2Nlc3NvcjxTdHJpbmc+IGxpc3RQ\ncm9jZXNzb3IgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBBc3luY0xpc3RQcm9jZXNzb3I8U3RyaW5nPihzY2hlZHVsZXIpOwogICAg\nICAgICAgICAgICAgICAgICAgICAvLyBwcm9jZXNzIGl0cyBjaGlsZHJlbgog\nICAgICAgICAgICAgICAgICAgICAgICBsaXN0UHJvY2Vzc29yLnByb2Nlc3Mo\nbGV2ZWxOb2RlcywgcHJvY2Vzc29yLCBmaW5hbENiLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCwgc3Vj\nY2Vzc1JjLCBmYWlsdXJlUmMpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNzIGxpc3Qg\nb25lIGJ5IG9uZSBpbiBhc3luY2hyb25pemUgd2F5LiBQcm9jZXNzIHdpbGwg\nYmUgc3RvcHBlZCBpbW1lZGlhdGVseQogICAgICogd2hlbiBlcnJvciBvY2N1\ncnJlZC4KICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQXN5bmNM\naXN0UHJvY2Vzc29yPFQ+IHsKICAgICAgICAvLyB1c2UgdGhpcyB0byBwcmV2\nZW50IGxvbmcgc3RhY2sgY2hhaW5zIGZyb20gYnVpbGRpbmcgdXAgaW4gY2Fs\nbGJhY2tzCiAgICAgICAgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVk\ndWxlcjsKCiAgICAgICAgLyoqCiAgICAgICAgICogQ29uc3RydWN0b3IKICAg\nICAgICAgKgogICAgICAgICAqIEBwYXJhbSBzY2hlZHVsZXIKICAgICAgICAg\nKiAgICAgICAgICBFeGVjdXRvciB1c2VkIHRvIHByZXZlbnQgbG9uZyBzdGFj\nayBjaGFpbnMKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQXN5bmNMaXN0\nUHJvY2Vzc29yKFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXIp\nIHsKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7CiAg\nICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBQcm9jZXNzIGxpc3Qg\nb2YgaXRlbXMKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBkYXRhCiAg\nICAgICAgICogICAgICAgICAgTGlzdCBvZiBkYXRhIHRvIHByb2Nlc3MKICAg\nICAgICAgKiBAcGFyYW0gcHJvY2Vzc29yCiAgICAgICAgICogICAgICAgICAg\nQ2FsbGJhY2sgdG8gcHJvY2VzcyBlbGVtZW50IG9mIGxpc3Qgd2hlbiBzdWNj\nZXNzCiAgICAgICAgICogQHBhcmFtIGZpbmFsQ2IKICAgICAgICAgKiAgICAg\nICAgICBGaW5hbCBjYWxsYmFjayB0byBiZSBjYWxsZWQgYWZ0ZXIgYWxsIGVs\nZW1lbnRzIGluIHRoZSBsaXN0IGFyZSBwcm9jZXNzZWQKICAgICAgICAgKiBA\ncGFyYW0gY29udHh0CiAgICAgICAgICogICAgICAgICAgQ29udGV4dCBvZiBm\naW5hbCBjYWxsYmFjawogICAgICAgICAqIEBwYXJhbSBzdWNjZXNzUmMKICAg\nICAgICAgKiAgICAgICAgICBSQyBwYXNzZWQgdG8gZmluYWwgY2FsbGJhY2sg\nb24gc3VjY2VzcwogICAgICAgICAqIEBwYXJhbSBmYWlsdXJlUmMKICAgICAg\nICAgKiAgICAgICAgICBSQyBwYXNzZWQgdG8gZmluYWwgY2FsbGJhY2sgb24g\nZmFpbHVyZQogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHByb2Nl\nc3MoZmluYWwgTGlzdDxUPiBkYXRhLCBmaW5hbCBQcm9jZXNzb3I8VD4gcHJv\nY2Vzc29yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgQXN5\nbmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgZmluYWxDYiwgZmluYWwgT2JqZWN0\nIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBp\nbnQgc3VjY2Vzc1JjLCBmaW5hbCBpbnQgZmFpbHVyZVJjKSB7CiAgICAgICAg\nICAgIGlmIChkYXRhID09IG51bGwgfHwgZGF0YS5zaXplKCkgPT0gMCkgewog\nICAgICAgICAgICAgICAgZmluYWxDYi5wcm9jZXNzUmVzdWx0KHN1Y2Nlc3NS\nYywgbnVsbCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWwgaW50IHNpemUgPSBkYXRh\nLnNpemUoKTsKICAgICAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBjdXJy\nZW50ID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgICAgIEFzeW5j\nQ2FsbGJhY2suVm9pZENhbGxiYWNrIHN0dWJDYWxsYmFjayA9IG5ldyBBc3lu\nY0NhbGxiYWNrLlZvaWRDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jl\nc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHJjICE9IHN1Y2Nlc3NSYykgewogICAgICAg\nICAgICAgICAgICAgICAgICAvLyB0ZXJtaW5hbCBpbW1lZGlhdGVseQogICAg\nICAgICAgICAgICAgICAgICAgICBmaW5hbENiLnByb2Nlc3NSZXN1bHQoZmFp\nbHVyZVJjLCBudWxsLCBjb250ZXh0KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAvLyBwcm9jZXNzIG5leHQgZWxlbWVudAogICAgICAgICAgICAg\nICAgICAgIGludCBuZXh0ID0gY3VycmVudC5pbmNyZW1lbnRBbmRHZXQoKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAobmV4dCA+PSBzaXplKSB7IC8vIHJl\nYWNoIHRoZSBlbmQgb2YgbGlzdAogICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbENiLnByb2Nlc3NSZXN1bHQoc3VjY2Vzc1JjLCBudWxsLCBjb250ZXh0\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmaW5hbCBUIGRhdGFU\nb1Byb2Nlc3MgPSBkYXRhLmdldChuZXh0KTsKICAgICAgICAgICAgICAgICAg\nICBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBzdHViID0gdGhp\nczsKICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuc3VibWl0KG5ldyBS\ndW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyBmaW5hbCB2b2lkIHJ1\nbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3Nvci5w\ncm9jZXNzKGRhdGFUb1Byb2Nlc3MsIHN0dWIpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIFQgZmlyc3RFbGVt\nZW50ID0gZGF0YS5nZXQoMCk7CiAgICAgICAgICAgIHByb2Nlc3Nvci5wcm9j\nZXNzKGZpcnN0RWxlbWVudCwgc3R1YkNhbGxiYWNrKTsKICAgICAgICB9CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBpc1Nw\nZWNpYWxabm9kZShTdHJpbmcgem5vZGUpIHsKICAgICAgICByZXR1cm4gSURH\nRU5fWk5PREUuZXF1YWxzKHpub2RlKSB8fCBzdXBlci5pc1NwZWNpYWxabm9k\nZSh6bm9kZSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTGVk\nZ2VyUmFuZ2VJdGVyYXRvciBnZXRMZWRnZXJSYW5nZXMoKSB7CiAgICAgICAg\ncmV0dXJuIG5ldyBIaWVyYXJjaGljYWxMZWRnZXJSYW5nZUl0ZXJhdG9yKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBJdGVyYXRvciB0aHJvdWdoIGVhY2gg\nbWV0YWRhdGEgYnVja2V0IHdpdGggaGllcmFyY2hpY2FsIG1vZGUKICAgICAq\nLwogICAgcHJpdmF0ZSBjbGFzcyBIaWVyYXJjaGljYWxMZWRnZXJSYW5nZUl0\nZXJhdG9yIGltcGxlbWVudHMgTGVkZ2VyUmFuZ2VJdGVyYXRvciB7CiAgICAg\nICAgcHJpdmF0ZSBJdGVyYXRvcjxTdHJpbmc+IGwxTm9kZXNJdGVyID0gbnVs\nbDsKICAgICAgICBwcml2YXRlIEl0ZXJhdG9yPFN0cmluZz4gbDJOb2Rlc0l0\nZXIgPSBudWxsOwogICAgICAgIHByaXZhdGUgU3RyaW5nIGN1ckwxTm9kZXMg\nPSAiIjsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFzTW9yZUVsZW1lbnQg\nPSB0cnVlOwoKICAgICAgICAvKioKICAgICAgICAgKiBpdGVyYXRlIG5leHQg\nbGV2ZWwxIHpub2RlCiAgICAgICAgICoKICAgICAgICAgKiBAcmV0dXJuIGZh\nbHNlIGlmIGhhdmUgdmlzaXRlZCBhbGwgbGV2ZWwxIG5vZGVzCiAgICAgICAg\nICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbi9LZWVwZXJFeGNlcHRp\nb24gaWYgZXJyb3Igb2NjdXJzIHJlYWRpbmcgem9va2VlcGVyIGNoaWxkcmVu\nCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIG5leHRMMU5v\nZGUoKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIGwyTm9kZXNJdGVyID0gbnVsbDsKICAgICAg\nICAgICAgd2hpbGUgKGwyTm9kZXNJdGVyID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGlmIChsMU5vZGVzSXRlci5oYXNOZXh0KCkpIHsKICAgICAgICAg\nICAgICAgICAgICBjdXJMMU5vZGVzID0gbDFOb2Rlc0l0ZXIubmV4dCgpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBpZiAoaXNTcGVjaWFsWm5vZGUoY3VyTDFOb2RlcykpIHsKICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIExpc3Q8U3RyaW5nPiBsMk5vZGVzID0gemsuZ2V0Q2hpbGRy\nZW4obGVkZ2VyUm9vdFBhdGggKyAiLyIgKyBjdXJMMU5vZGVzLCBudWxsKTsK\nICAgICAgICAgICAgICAgIGwyTm9kZXNJdGVyID0gbDJOb2Rlcy5pdGVyYXRv\ncigpOwogICAgICAgICAgICAgICAgaWYgKCFsMk5vZGVzSXRlci5oYXNOZXh0\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBsMk5vZGVzSXRlciA9IG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNOZXh0KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChsMU5vZGVzSXRlciA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgbDFOb2Rlc0l0ZXIgPSB6ay5n\nZXRDaGlsZHJlbihsZWRnZXJSb290UGF0aCwgbnVsbCkuaXRlcmF0b3IoKTsK\nICAgICAgICAgICAgICAgICAgICBoYXNNb3JlRWxlbWVudCA9IG5leHRMMU5v\nZGUoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIWwyTm9kZXNJdGVy\nLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgIGhhc01vcmVFbGVt\nZW50ID0gbmV4dEwxTm9kZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IElPRXhjZXB0aW9uKCJFcnJvciB3aGVuIGNoZWNrIG1vcmUg\nZWxlbWVudHMiLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gaGFzTW9yZUVsZW1lbnQ7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgTGVkZ2VyUmFuZ2UgbmV4dCgpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmICghaGFzTW9yZUVsZW1lbnQp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBOb1N1Y2hFbGVtZW50RXhj\nZXB0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGdl\ndExlZGdlclJhbmdlQnlMZXZlbChjdXJMMU5vZGVzLCBsMk5vZGVzSXRlci5u\nZXh0KCkpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogR2V0\nIGEgc2luZ2xlIG5vZGUgbGV2ZWwxL2xldmVsMgogICAgICAgICAqCiAgICAg\nICAgICogQHBhcmFtIGxldmVsMQogICAgICAgICAqICAgICAgICAgIDFzdCBs\nZXZlbCBub2RlIG5hbWUKICAgICAgICAgKiBAcGFyYW0gbGV2ZWwyCiAgICAg\nICAgICogICAgICAgICAgMm5kIGxldmVsIG5vZGUgbmFtZQogICAgICAgICAq\nIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAgICAgKi8KICAgICAgICBMZWRn\nZXJSYW5nZSBnZXRMZWRnZXJSYW5nZUJ5TGV2ZWwoZmluYWwgU3RyaW5nIGxl\ndmVsMSwgZmluYWwgU3RyaW5nIGxldmVsMikKICAgICAgICAgICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIg\nbm9kZUJ1aWxkZXIgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAg\nICBub2RlQnVpbGRlci5hcHBlbmQobGVkZ2VyUm9vdFBhdGgpLmFwcGVuZCgi\nLyIpCiAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChsZXZlbDEpLmFw\ncGVuZCgiLyIpLmFwcGVuZChsZXZlbDIpOwogICAgICAgICAgICBTdHJpbmcg\nbm9kZVBhdGggPSBub2RlQnVpbGRlci50b1N0cmluZygpOwogICAgICAgICAg\nICBMaXN0PFN0cmluZz4gbGVkZ2VyTm9kZXMgPSBudWxsOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgbGVkZ2VyTm9kZXMgPSBaa1V0aWxz\nLmdldENoaWxkcmVuSW5TaW5nbGVOb2RlKHprLCBub2RlUGF0aCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRXJyb3Igd2hl\nbiBnZXQgY2hpbGQgbm9kZXMgZnJvbSB6ayIsIGUpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIFNldDxMb25nPiB6a0FjdGl2ZUxlZGdlcnMgPSBsZWRn\nZXJMaXN0VG9TZXQobGVkZ2VyTm9kZXMsIG5vZGVQYXRoKTsKICAgICAgICAg\nICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIkFsbCBhY3RpdmUgbGVkZ2VycyBmcm9tIFpLIGZvciBo\nYXNoIG5vZGUgIgogICAgICAgICAgICAgICAgICAgICAgICAgICsgbGV2ZWwx\nICsgIi8iICsgbGV2ZWwyICsgIiA6ICIgKyB6a0FjdGl2ZUxlZGdlcnMpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBuZXcgTGVkZ2VyUmFu\nZ2UoemtBY3RpdmVMZWRnZXJzLAogICAgICAgICAgICAgICAgICAgIGdldFN0\nYXJ0TGVkZ2VySWRCeUxldmVsKGxldmVsMSwgbGV2ZWwyKSwgZ2V0RW5kTGVk\nZ2VySWRCeUxldmVsKGxldmVsMSwgbGV2ZWwyKSk7CiAgICAgICAgfQogICAg\nfQp9Cg==\n","encoding":"base64"}

