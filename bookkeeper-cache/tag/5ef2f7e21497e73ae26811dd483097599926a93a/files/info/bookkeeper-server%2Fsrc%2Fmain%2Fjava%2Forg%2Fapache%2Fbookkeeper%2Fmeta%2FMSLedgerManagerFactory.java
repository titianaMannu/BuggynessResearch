{"sha":"106dac5a45c81e850e273fb004e7ca7aa1eed490","node_id":"MDQ6QmxvYjE1NzU5NTY6MTA2ZGFjNWE0NWM4MWU4NTBlMjczZmIwMDRlN2NhN2FhMWVlZDQ5MA==","size":26590,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/106dac5a45c81e850e273fb004e7ca7aa1eed490","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YTsKCmltcG9ydCBzdGF0\naWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVU\nYWJsZS5BTExfRklFTERTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlVGFibGUuTk9OX0ZJRUxEUzsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGls\nLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEu\ndXRpbC5Tb3J0ZWRTZXQ7CmltcG9ydCBqYXZhLnV0aWwuVHJlZVNldDsKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZTsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwoK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdl\nck1ldGFkYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYu\nQWJzdHJhY3RDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLm1ldGFzdG9yZS5NU0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5tZXRhc3RvcmUuTWV0YVN0b3JlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhc3RvcmUuTWV0\nYXN0b3JlQ3Vyc29yOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGFzdG9yZS5NZXRhc3RvcmVDdXJzb3IuUmVhZEVudHJpZXNDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhc3RvcmUuTWV0YXN0\nb3JlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGFzdG9yZS5NZXRhc3RvcmVGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVTY2FubmFibGVUYWJsZTsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhc3RvcmUuTWV0YXN0\nb3JlVGFibGVJdGVtOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGFzdG9yZS5WYWx1ZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxi\nYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tr\nZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Qcm9jZXNzb3I7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TdHJp\nbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlpr\nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudmVyc2lvbmlu\nZy5WZXJzaW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNp\nb25pbmcuVmVyc2lvbmVkOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nQXN5bmNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkFz\neW5jQ2FsbGJhY2suU3RyaW5nQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5DcmVhdGVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5ab29LZWVwZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQg\nb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogTWV0YVN0b3JlIEJh\nc2VkIExlZGdlciBNYW5hZ2VyIEZhY3RvcnkKICovCnB1YmxpYyBjbGFzcyBN\nU0xlZGdlck1hbmFnZXJGYWN0b3J5IGV4dGVuZHMgTGVkZ2VyTWFuYWdlckZh\nY3RvcnkgewoKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9y\neS5nZXRMb2dnZXIoTVNMZWRnZXJNYW5hZ2VyRmFjdG9yeS5jbGFzcyk7Cgog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ1VSX1ZFUlNJT04gPSAxOwoK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIFRBQkxFX05BTUUgPSAi\nTEVER0VSIjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5nIE1FVEFf\nRklFTEQgPSAiLk1FVEEiOwoKICAgIEFic3RyYWN0Q29uZmlndXJhdGlvbiBj\nb25mOwogICAgWm9vS2VlcGVyIHprOwogICAgTWV0YVN0b3JlIG1ldGFzdG9y\nZTsKCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBpbnQgZ2V0Q3VycmVudFZl\ncnNpb24oKSB7CiAgICAgICAgcmV0dXJuIENVUl9WRVJTSU9OOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIExlZGdlck1hbmFnZXJGYWN0b3J5\nIGluaXRpYWxpemUoZmluYWwgQWJzdHJhY3RDb25maWd1cmF0aW9uIGNvbmYs\nIGZpbmFsIFpvb0tlZXBlciB6aywKICAgICAgICAgICAgZmluYWwgaW50IGZh\nY3RvcnlWZXJzaW9uKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlm\nIChDVVJfVkVSU0lPTiAhPSBmYWN0b3J5VmVyc2lvbikgewogICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkluY29tcGF0aWJsZSBsYXlvdXQg\ndmVyc2lvbiBmb3VuZCA6ICIgKyBmYWN0b3J5VmVyc2lvbik7CiAgICAgICAg\nfQogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAgICAgdGhpcy56ayA9\nIHprOwoKICAgICAgICAvLyBsb2FkIG1ldGFkYXRhIHN0b3JlCiAgICAgICAg\nU3RyaW5nIG1zTmFtZSA9IGNvbmYuZ2V0TWV0YXN0b3JlSW1wbENsYXNzKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbWV0YXN0b3JlID0gTWV0YXN0\nb3JlRmFjdG9yeS5jcmVhdGVNZXRhU3RvcmUobXNOYW1lKTsKCiAgICAgICAg\nICAgIC8vIFRPRE86IHNob3VsZCByZWNvcmQgdmVyc2lvbiBpbiBzb21ld2hl\ncmUuIGUuZy4gWm9vS2VlcGVyCiAgICAgICAgICAgIGludCBtc1ZlcnNpb24g\nPSBtZXRhc3RvcmUuZ2V0VmVyc2lvbigpOwogICAgICAgICAgICBtZXRhc3Rv\ncmUuaW5pdChjb25mLCBtc1ZlcnNpb24pOwogICAgICAgIH0gY2F0Y2ggKFRo\ncm93YWJsZSB0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbigiRmFpbGVkIHRvIGluaXRpYWxpemUgbWV0YXN0b3JlICIgKyBtc05hbWUg\nKyAiIDogIiwgdCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHVuaW5pdGlh\nbGl6ZSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbWV0YXN0b3Jl\nLmNsb3NlKCk7CiAgICB9CgogICAgc3RhdGljIExvbmcga2V5MkxlZGdlcklk\nKFN0cmluZyBrZXkpIHsKICAgICAgICByZXR1cm4gbnVsbCA9PSBrZXkgPyBu\ndWxsIDogTG9uZy5wYXJzZUxvbmcoa2V5LCAxMCk7CiAgICB9CgogICAgc3Rh\ndGljIFN0cmluZyBsZWRnZXJJZDJLZXkoTG9uZyBsaWQpIHsKICAgICAgICBy\nZXR1cm4gbnVsbCA9PSBsaWQgPyBudWxsIDogU3RyaW5nVXRpbHMuZ2V0WktT\ndHJpbmdJZChsaWQpOwogICAgfQoKICAgIHN0YXRpYyBTdHJpbmcgcmFuZ2VU\nb1N0cmluZyhMb25nIGZpcnN0TGVkZ2VyLCBib29sZWFuIGZpcnN0SW5jbHVz\naXZlLCBMb25nIGxhc3RMZWRnZXIsIGJvb2xlYW4gbGFzdEluY2x1c2l2ZSkg\newogICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRl\ncigpOwogICAgICAgIHNiLmFwcGVuZChmaXJzdEluY2x1c2l2ZSA/ICJbICIg\nOiAiKCAiKS5hcHBlbmQoZmlyc3RMZWRnZXIpLmFwcGVuZCgiIH4gIikuYXBw\nZW5kKGxhc3RMZWRnZXIpCiAgICAgICAgICAgICAgICAuYXBwZW5kKGxhc3RJ\nbmNsdXNpdmUgPyAiIF0iIDogIiApIik7CiAgICAgICAgcmV0dXJuIHNiLnRv\nU3RyaW5nKCk7CiAgICB9CgogICAgc3RhdGljIFNvcnRlZFNldDxMb25nPiBl\nbnRyaWVzMkxlZGdlcnMoSXRlcmF0b3I8TWV0YXN0b3JlVGFibGVJdGVtPiBl\nbnRyaWVzKSB7CiAgICAgICAgU29ydGVkU2V0PExvbmc+IGxlZGdlcnMgPSBu\nZXcgVHJlZVNldDxMb25nPigpOwogICAgICAgIHdoaWxlIChlbnRyaWVzLmhh\nc05leHQoKSkgewogICAgICAgICAgICBNZXRhc3RvcmVUYWJsZUl0ZW0gaXRl\nbSA9IGVudHJpZXMubmV4dCgpOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgbGVkZ2Vycy5hZGQoa2V5MkxlZGdlcklkKGl0ZW0uZ2V0S2V5\nKCkpKTsKICAgICAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0\naW9uIG5mZSkgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIkZvdW5kIGlu\ndmFsaWQgbGVkZ2VyIGtleSB7fSIsIGl0ZW0uZ2V0S2V5KCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBsZWRnZXJzOwogICAg\nfQoKICAgIHN0YXRpYyBjbGFzcyBTeW5jUmVzdWx0PFQ+IHsKICAgICAgICBU\nIHZhbHVlOwogICAgICAgIGludCByYzsKICAgICAgICBib29sZWFuIGZpbmlz\naGVkID0gZmFsc2U7CgogICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9p\nZCBjb21wbGV0ZShpbnQgcmMsIFQgdmFsdWUpIHsKICAgICAgICAgICAgdGhp\ncy5yYyA9IHJjOwogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAg\nICAgICAgICAgIGZpbmlzaGVkID0gdHJ1ZTsKCiAgICAgICAgICAgIG5vdGlm\neSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN5bmNocm9uaXplZCB2\nb2lkIGJsb2NrKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgd2hpbGUgKCFmaW5pc2hlZCkgewogICAgICAgICAgICAgICAgICAgIHdh\naXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIHN5bmNocm9uaXplZCBpbnQgZ2V0UmV0\nQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHJjOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHN5bmNocm9uaXplZCBUIGdldFJlc3VsdCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgIH0KICAgIH0KCiAgICBz\ndGF0aWMgY2xhc3MgTXNMZWRnZXJNYW5hZ2VyIGltcGxlbWVudHMgTGVkZ2Vy\nTWFuYWdlciB7CiAgICAgICAgZmluYWwgWm9vS2VlcGVyIHprOwogICAgICAg\nIGZpbmFsIEFic3RyYWN0Q29uZmlndXJhdGlvbiBjb25mOwoKICAgICAgICBm\naW5hbCBNZXRhU3RvcmUgbWV0YXN0b3JlOwogICAgICAgIGZpbmFsIE1ldGFz\ndG9yZVNjYW5uYWJsZVRhYmxlIGxlZGdlclRhYmxlOwogICAgICAgIGZpbmFs\nIGludCBtYXhFbnRyaWVzUGVyU2NhbjsKCiAgICAgICAgc3RhdGljIGZpbmFs\nIFN0cmluZyBJREdFTl9aTk9ERSA9ICJtcy1pZGdlbiI7CiAgICAgICAgc3Rh\ndGljIGZpbmFsIFN0cmluZyBJREdFTkVSQVRJT05fUFJFRklYID0gIi8iICsg\nSURHRU5fWk5PREUgKyAiL0lELSI7CgogICAgICAgIC8vIFBhdGggdG8gZ2Vu\nZXJhdGUgZ2xvYmFsIGlkCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcg\naWRHZW5QYXRoOwoKICAgICAgICAvLyB3ZSB1c2UgdGhpcyB0byBwcmV2ZW50\nIGxvbmcgc3RhY2sgY2hhaW5zIGZyb20gYnVpbGRpbmcgdXAgaW4KICAgICAg\nICAvLyBjYWxsYmFja3MKICAgICAgICBTY2hlZHVsZWRFeGVjdXRvclNlcnZp\nY2Ugc2NoZWR1bGVyOwoKICAgICAgICBNc0xlZGdlck1hbmFnZXIoZmluYWwg\nQWJzdHJhY3RDb25maWd1cmF0aW9uIGNvbmYsIGZpbmFsIFpvb0tlZXBlciB6\naywgZmluYWwgTWV0YVN0b3JlIG1ldGFzdG9yZSkgewogICAgICAgICAgICB0\naGlzLmNvbmYgPSBjb25mOwogICAgICAgICAgICB0aGlzLnprID0gems7CiAg\nICAgICAgICAgIHRoaXMubWV0YXN0b3JlID0gbWV0YXN0b3JlOwoKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxlZGdlclRhYmxlID0gbWV0\nYXN0b3JlLmNyZWF0ZVNjYW5uYWJsZVRhYmxlKFRBQkxFX05BTUUpOwogICAg\nICAgICAgICB9IGNhdGNoIChNZXRhc3RvcmVFeGNlcHRpb24gbXNlKSB7CiAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIkZhaWxlZCB0byBpbnN0YW50aWF0\nZSB0YWJsZSAiICsgVEFCTEVfTkFNRSArICIgaW4gbWV0YXN0b3JlICIgKyBt\nZXRhc3RvcmUuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBSdW50aW1lRXhjZXB0aW9uKCJGYWlsZWQgdG8gaW5zdGFudGlhdGUgdGFi\nbGUgIiArIFRBQkxFX05BTUUgKyAiIGluIG1ldGFzdG9yZSAiCiAgICAgICAg\nICAgICAgICAgICAgICAgICsgbWV0YXN0b3JlLmdldE5hbWUoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgLy8gY29uZmlndXJhdGlvbiBzZXR0aW5n\ncwogICAgICAgICAgICBtYXhFbnRyaWVzUGVyU2NhbiA9IGNvbmYuZ2V0TWV0\nYXN0b3JlTWF4RW50cmllc1BlclNjYW4oKTsKCiAgICAgICAgICAgIHRoaXMu\naWRHZW5QYXRoID0gY29uZi5nZXRaa0xlZGdlcnNSb290UGF0aCgpICsgSURH\nRU5FUkFUSU9OX1BSRUZJWDsKICAgICAgICAgICAgdGhpcy5zY2hlZHVsZXIg\nPSBFeGVjdXRvcnMubmV3U2luZ2xlVGhyZWFkU2NoZWR1bGVkRXhlY3V0b3Io\nKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgc2NoZWR1bGVyLnNodXRkb3duKCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cud2Fybigi\nRXJyb3Igd2hlbiBjbG9zaW5nIE1zTGVkZ2VyTWFuYWdlciA6ICIsIGUpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGxlZGdlclRhYmxlLmNsb3NlKCk7\nCiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMg\ndm9pZCBjcmVhdGVMZWRnZXIoZmluYWwgTGVkZ2VyTWV0YWRhdGEgbWV0YWRh\ndGEsIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxMb25nPiBsZWRnZXJDYikgewog\nICAgICAgICAgICBaa1V0aWxzLmNyZWF0ZUZ1bGxQYXRoT3B0aW1pc3RpYyh6\naywgaWRHZW5QYXRoLCBuZXcgYnl0ZVswXSwgSWRzLk9QRU5fQUNMX1VOU0FG\nRSwKICAgICAgICAgICAgICAgICAgICBDcmVhdGVNb2RlLkVQSEVNRVJBTF9T\nRVFVRU5USUFMLCBuZXcgU3RyaW5nQ2FsbGJhY2soKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBh\ndGgsIE9iamVjdCBjdHgsIGZpbmFsIFN0cmluZyBpZFBhdGhOYW1lKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0gS2VlcGVyRXhj\nZXB0aW9uLkNvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IGdlbmVyYXRl\nIG5ldyBsZWRnZXIgaWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNl\ncHRpb24uQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbGVkZ2VyQ2Iub3BlcmF0aW9uQ29tcGxldGUoQktF\neGNlcHRpb24uQ29kZS5aS0V4Y2VwdGlvbiwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIEV4dHJhY3QgbGVkZ2Vy\nIGlkIGZyb20gZ2VuIHBhdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZyBsZWRnZXJJ\nZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQgPSBnZXRMZWRnZXJJ\nZEZyb21HZW5QYXRoKGlkUGF0aE5hbWUpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IGV4\ndHJhY3QgbGVkZ2VyLWlkIGZyb20gaWQgZ2VuIHBhdGg6IiArIHBhdGgsIGUp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckNiLm9w\nZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuWktFeGNlcHRpb24s\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmaW5hbCBsb25nIGxpZCA9IGxlZGdlcklkOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgTWV0YXN0b3JlQ2FsbGJhY2s8\nVmVyc2lvbj4gbXNDYWxsYmFjayA9IG5ldyBNZXRhc3RvcmVDYWxsYmFjazxW\nZXJzaW9uPigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBjb21wbGV0ZShpbnQgcmMsIFZlcnNpb24gdmVyc2lvbiwgT2Jq\nZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoTVNFeGNlcHRpb24uQ29kZS5CYWRWZXJzaW9uLmdldENvZGUoKSA9\nPSByYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbGVkZ2VyQ2Iub3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29k\nZS5NZXRhZGF0YVZlcnNpb25FeGNlcHRpb24sIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChNU0V4Y2VwdGlvbi5Db2RlLk9L\nLmdldENvZGUoKSAhPSByYykgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbGVkZ2VyQ2Iub3BlcmF0aW9uQ29tcGxldGUoQktF\neGNlcHRpb24uQ29kZS5NZXRhU3RvcmVFeGNlcHRpb24sIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiQ3JlYXRl\nIGxlZGdlciB7fSB3aXRoIHZlcnNpb24ge30gc3VjY2Vzc2Z1bHkuIiwgbmV3\nIE9iamVjdFtdIHsgbGlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHZlcnNpb24gfSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSB2ZXJzaW9uCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLnNldFZlcnNp\nb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxlZGdlckNiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNv\nZGUuT0ssIGxpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJUYWJsZS5wdXQobGVkZ2VySWQyS2V5\nKGxpZCksIG5ldyBWYWx1ZSgpLnNldEZpZWxkKE1FVEFfRklFTEQsIG1ldGFk\nYXRhLnNlcmlhbGl6ZSgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgVmVyc2lvbi5ORVcsIG1zQ2FsbGJhY2ssIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgemsuZGVsZXRlKGlkUGF0aE5hbWUs\nIC0xLCBuZXcgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jl\nc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBLZWVw\nZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiRXhjZXB0\naW9uIGR1cmluZyBkZWxldGluZyB6bm9kZSBmb3IgaWQgZ2VuZXJhdGlvbiA6\nICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoS2VlcGVyRXhjZXB0aW9u\nLkNvZGUuZ2V0KHJjKSwgcGF0aCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJEZWxldGluZyB6bm9kZSBm\nb3IgaWQgZ2VuZXJhdGlvbiA6IHt9IiwgaWRQYXRoTmFtZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nZ2V0IGxlZGdlciBpZCBmcm9tIGdlbmVyYXRpb24gcGF0aAogICAgICAgIHBy\naXZhdGUgbG9uZyBnZXRMZWRnZXJJZEZyb21HZW5QYXRoKFN0cmluZyBub2Rl\nTmFtZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgbG9uZyBs\nZWRnZXJJZDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFN0\ncmluZyBwYXJ0c1tdID0gbm9kZU5hbWUuc3BsaXQoSURHRU5FUkFUSU9OX1BS\nRUZJWCk7CiAgICAgICAgICAgICAgICBsZWRnZXJJZCA9IExvbmcucGFyc2VM\nb25nKHBhcnRzW3BhcnRzLmxlbmd0aCAtIDFdKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gbGVkZ2VySWQ7CiAgICAgICAgfQoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCByZW1vdmVMZWRnZXJN\nZXRhZGF0YShmaW5hbCBsb25nIGxlZGdlcklkLCBmaW5hbCBWZXJzaW9uIHZl\ncnNpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZmluYWwgR2VuZXJpY0NhbGxiYWNrPFZvaWQ+IGNiKSB7CiAgICAgICAg\nICAgIE1ldGFzdG9yZUNhbGxiYWNrPFZvaWQ+IG1zQ2FsbGJhY2sgPSBuZXcg\nTWV0YXN0b3JlQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNvbXBsZXRl\nKGludCByYywgVm9pZCB2YWx1ZSwgT2JqZWN0IGN0eCkgewogICAgICAgICAg\nICAgICAgICAgIGludCBia1JjOwogICAgICAgICAgICAgICAgICAgIGlmIChN\nU0V4Y2VwdGlvbi5Db2RlLk5vS2V5LmdldENvZGUoKSA9PSByYykgewogICAg\nICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiTGVkZ2VyIGVudHJ5IGRv\nZXMgbm90IGV4aXN0IGluIG1ldGEgdGFibGU6IGxlZGdlcklkPXt9IiwgbGVk\nZ2VySWQpOwogICAgICAgICAgICAgICAgICAgICAgICBia1JjID0gQktFeGNl\ncHRpb24uQ29kZS5Ob1N1Y2hMZWRnZXJFeGlzdHNFeGNlcHRpb247CiAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChNU0V4Y2VwdGlvbi5Db2RlLk9L\nLmdldENvZGUoKSA9PSByYykgewogICAgICAgICAgICAgICAgICAgICAgICBi\na1JjID0gQktFeGNlcHRpb24uQ29kZS5PSzsKICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBia1JjID0gQktF\neGNlcHRpb24uQ29kZS5NZXRhU3RvcmVFeGNlcHRpb247CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNv\nbXBsZXRlKGJrUmMsIChWb2lkKSBudWxsKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfTsKICAgICAgICAgICAgbGVkZ2VyVGFibGUucmVtb3Zl\nKGxlZGdlcklkMktleShsZWRnZXJJZCksIHZlcnNpb24sIG1zQ2FsbGJhY2ss\nIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgcmVhZExlZGdlck1ldGFkYXRhKGZpbmFsIGxvbmcgbGVk\nZ2VySWQsIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4g\ncmVhZENiKSB7CiAgICAgICAgICAgIGZpbmFsIFN0cmluZyBrZXkgPSBsZWRn\nZXJJZDJLZXkobGVkZ2VySWQpOwogICAgICAgICAgICBNZXRhc3RvcmVDYWxs\nYmFjazxWZXJzaW9uZWQ8VmFsdWU+PiBtc0NhbGxiYWNrID0gbmV3IE1ldGFz\ndG9yZUNhbGxiYWNrPFZlcnNpb25lZDxWYWx1ZT4+KCkgewogICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBj\nb21wbGV0ZShpbnQgcmMsIFZlcnNpb25lZDxWYWx1ZT4gdmFsdWUsIE9iamVj\ndCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoTVNFeGNlcHRpb24u\nQ29kZS5Ob0tleS5nZXRDb2RlKCkgPT0gcmMpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJObyBsZWRnZXIgbWV0YWRhdGEgZm91bmQg\nZm9yIGxlZGdlciAiICsgbGVkZ2VySWQgKyAiIDogIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBNU0V4Y2VwdGlvbi5jcmVhdGUoTVNFeGNl\ncHRpb24uQ29kZS5nZXQocmMpLCAiTm8ga2V5ICIgKyBrZXkgKyAiIGZvdW5k\nLiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZENiLm9wZXJhdGlv\nbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNoTGVkZ2VyRXhpc3Rz\nRXhjZXB0aW9uLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBpZiAoTVNFeGNlcHRpb24uQ29kZS5PSy5nZXRDb2RlKCkgIT0gcmMpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3Qg\ncmVhZCBtZXRhZGF0YSBmb3IgbGVkZ2VyICIgKyBsZWRnZXJJZCArICIgOiAi\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1TRXhjZXB0aW9u\nLmNyZWF0ZShNU0V4Y2VwdGlvbi5Db2RlLmdldChyYyksICJGYWlsZWQgdG8g\nZ2V0IGtleSAiICsga2V5KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJl\nYWRDYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk1ldGFT\ndG9yZUV4Y2VwdGlvbiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgTGVkZ2VyTWV0YWRhdGEgbWV0YWRhdGE7CiAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEg\nPSBMZWRnZXJNZXRhZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC5wYXJzZUNvbmZpZyh2YWx1ZS5nZXRWYWx1ZSgpLmdldEZpZWxkKE1F\nVEFfRklFTEQpLCB2YWx1ZS5nZXRWZXJzaW9uKCkpOwogICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3QgcGFyc2UgbGVkZ2Vy\nIG1ldGFkYXRhIGZvciBsZWRnZXIgIiArIGxlZGdlcklkICsgIiA6ICIsIGUp\nOwogICAgICAgICAgICAgICAgICAgICAgICByZWFkQ2Iub3BlcmF0aW9uQ29t\ncGxldGUoQktFeGNlcHRpb24uQ29kZS5NZXRhU3RvcmVFeGNlcHRpb24sIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlYWRDYi5vcGVy\nYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9LLCBtZXRhZGF0YSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAg\nIGxlZGdlclRhYmxlLmdldChrZXksIG1zQ2FsbGJhY2ssIEFMTF9GSUVMRFMp\nOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgd3JpdGVMZWRnZXJNZXRhZGF0YShmaW5hbCBsb25nIGxlZGdlcklk\nLCBmaW5hbCBMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YSwKICAgICAgICAgICAg\nICAgIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxWb2lkPiBjYikgewogICAgICAg\nICAgICBWYWx1ZSBkYXRhID0gbmV3IFZhbHVlKCkuc2V0RmllbGQoTUVUQV9G\nSUVMRCwgbWV0YWRhdGEuc2VyaWFsaXplKCkpOwoKICAgICAgICAgICAgTE9H\nLmRlYnVnKCJXcml0aW5nIGxlZGdlciB7fSBtZXRhZGF0YSwgdmVyc2lvbiB7\nfSIsIG5ldyBPYmplY3RbXSB7IGxlZGdlcklkLCBtZXRhZGF0YS5nZXRWZXJz\naW9uKCkgfSk7CgogICAgICAgICAgICBmaW5hbCBTdHJpbmcga2V5ID0gbGVk\nZ2VySWQyS2V5KGxlZGdlcklkKTsKICAgICAgICAgICAgTWV0YXN0b3JlQ2Fs\nbGJhY2s8VmVyc2lvbj4gbXNDYWxsYmFjayA9IG5ldyBNZXRhc3RvcmVDYWxs\nYmFjazxWZXJzaW9uPigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgY29tcGxldGUoaW50IHJjLCBW\nZXJzaW9uIHZlcnNpb24sIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAg\nICAgICBpbnQgYmtSYzsKICAgICAgICAgICAgICAgICAgICBpZiAoTVNFeGNl\ncHRpb24uQ29kZS5CYWRWZXJzaW9uLmdldENvZGUoKSA9PSByYykgewogICAg\nICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiQmFkIHZlcnNpb24gcHJv\ndmlkZWQgdG8gdXBkYXQgbWV0YWRhdGEgZm9yIGxlZGdlciB7fSIsIGxlZGdl\ncklkKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmtSYyA9IEJLRXhjZXB0\naW9uLkNvZGUuTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSBpZiAoTVNFeGNlcHRpb24uQ29kZS5Ob0tleS5n\nZXRDb2RlKCkgPT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLndhcm4oIkxlZGdlciB7fSBkb2Vzbid0IGV4aXN0IHdoZW4gd3JpdGluZyBp\ndHMgbGVkZ2VyIG1ldGFkYXRhLiIsIGxlZGdlcklkKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgYmtSYyA9IEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNoTGVk\nZ2VyRXhpc3RzRXhjZXB0aW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSBpZiAoTVNFeGNlcHRpb24uQ29kZS5PSy5nZXRDb2RlKCkgPT0gcmMpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuc2V0VmVyc2lvbih2\nZXJzaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmtSYyA9IEJLRXhj\nZXB0aW9uLkNvZGUuT0s7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkNvbmRpdGlvbmFs\nIHVwZGF0ZSBsZWRnZXIgbWV0YWRhdGEgZmFpbGVkOiAiLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIE1TRXhjZXB0aW9uLmNyZWF0ZShNU0V4\nY2VwdGlvbi5Db2RlLmdldChyYyksICJGYWlsZWQgdG8gcHV0IGtleSAiICsg\na2V5KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJrUmMgPSBCS0V4Y2Vw\ndGlvbi5Db2RlLk1ldGFTdG9yZUV4Y2VwdGlvbjsKICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBs\nZXRlKGJrUmMsIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9OwogICAgICAgICAgICBsZWRnZXJUYWJsZS5wdXQoa2V5LCBkYXRhLCBt\nZXRhZGF0YS5nZXRWZXJzaW9uKCksIG1zQ2FsbGJhY2ssIG51bGwpOwogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQg\nYXN5bmNQcm9jZXNzTGVkZ2VycyhmaW5hbCBQcm9jZXNzb3I8TG9uZz4gcHJv\nY2Vzc29yLCBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBmaW5h\nbENiLAogICAgICAgICAgICAgICAgZmluYWwgT2JqZWN0IGNvbnRleHQsIGZp\nbmFsIGludCBzdWNjZXNzUmMsIGZpbmFsIGludCBmYWlsdXJlUmMpIHsKICAg\nICAgICAgICAgTWV0YXN0b3JlQ2FsbGJhY2s8TWV0YXN0b3JlQ3Vyc29yPiBv\ncGVuQ3Vyc29yQ2IgPSBuZXcgTWV0YXN0b3JlQ2FsbGJhY2s8TWV0YXN0b3Jl\nQ3Vyc29yPigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgY29tcGxldGUoaW50IHJjLCBNZXRhc3Rv\ncmVDdXJzb3IgY3Vyc29yLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKE1TRXhjZXB0aW9uLkNvZGUuT0suZ2V0Q29kZSgpICE9IHJj\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsQ2IucHJvY2Vzc1Jl\nc3VsdChmYWlsdXJlUmMsIG51bGwsIGNvbnRleHQpOwogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIGlmICghY3Vyc29yLmhhc01vcmVFbnRyaWVzKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxDYi5wcm9jZXNzUmVz\ndWx0KHN1Y2Nlc3NSYywgbnVsbCwgY29udGV4dCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgYXN5bmNQcm9jZXNzTGVkZ2VycyhjdXJzb3IsIHBy\nb2Nlc3NvciwgZmluYWxDYiwgY29udGV4dCwgc3VjY2Vzc1JjLCBmYWlsdXJl\nUmMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAg\nICAgICBsZWRnZXJUYWJsZS5vcGVuQ3Vyc29yKE5PTl9GSUVMRFMsIG9wZW5D\ndXJzb3JDYiwgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICB2b2lkIGFzeW5j\nUHJvY2Vzc0xlZGdlcnMoZmluYWwgTWV0YXN0b3JlQ3Vyc29yIGN1cnNvciwg\nZmluYWwgUHJvY2Vzc29yPExvbmc+IHByb2Nlc3NvciwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZmluYWwgQXN5bmNDYWxsYmFjay5Wb2lk\nQ2FsbGJhY2sgZmluYWxDYiwgZmluYWwgT2JqZWN0IGNvbnRleHQsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIGludCBzdWNjZXNz\nUmMsIGZpbmFsIGludCBmYWlsdXJlUmMpIHsKICAgICAgICAgICAgc2NoZWR1\nbGVyLnN1Ym1pdChuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgICAgICAgICBkb0FzeW5jUHJvY2Vzc0xlZGdlcnMoY3Vy\nc29yLCBwcm9jZXNzb3IsIGZpbmFsQ2IsIGNvbnRleHQsIHN1Y2Nlc3NSYywg\nZmFpbHVyZVJjKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7\nCiAgICAgICAgfQoKICAgICAgICB2b2lkIGRvQXN5bmNQcm9jZXNzTGVkZ2Vy\ncyhmaW5hbCBNZXRhc3RvcmVDdXJzb3IgY3Vyc29yLCBmaW5hbCBQcm9jZXNz\nb3I8TG9uZz4gcHJvY2Vzc29yLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGZp\nbmFsQ2IsIGZpbmFsIE9iamVjdCBjb250ZXh0LAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGZpbmFsIGludCBzdWNjZXNzUmMsIGZpbmFs\nIGludCBmYWlsdXJlUmMpIHsKICAgICAgICAgICAgLy8gbm8gZW50cmllcyBu\nb3cKICAgICAgICAgICAgaWYgKCFjdXJzb3IuaGFzTW9yZUVudHJpZXMoKSkg\newogICAgICAgICAgICAgICAgZmluYWxDYi5wcm9jZXNzUmVzdWx0KHN1Y2Nl\nc3NSYywgbnVsbCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgUmVhZEVudHJpZXNDYWxsYmFj\nayBtc0NhbGxiYWNrID0gbmV3IFJlYWRFbnRyaWVzQ2FsbGJhY2soKSB7CiAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGNvbXBsZXRlKGludCByYywgSXRlcmF0b3I8TWV0YXN0b3JlVGFi\nbGVJdGVtPiBlbnRyaWVzLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKE1TRXhjZXB0aW9uLkNvZGUuT0suZ2V0Q29kZSgpICE9IHJj\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsQ2IucHJvY2Vzc1Jl\nc3VsdChmYWlsdXJlUmMsIG51bGwsIGNvbnRleHQpOwogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgICAgICBTb3J0ZWRTZXQ8TG9uZz4gbGVkZ2VycyA9IG5l\ndyBUcmVlU2V0PExvbmc+KCk7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUg\nKGVudHJpZXMuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIE1ldGFzdG9yZVRhYmxlSXRlbSBpdGVtID0gZW50cmllcy5uZXh0KCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsZWRnZXJzLmFkZChrZXkyTGVkZ2VySWQoaXRlbS5nZXRL\nZXkoKSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChOdW1i\nZXJGb3JtYXRFeGNlcHRpb24gbmZlKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBMT0cud2FybigiRm91bmQgaW52YWxpZCBsZWRnZXIga2V5IHt9\nIiwgaXRlbS5nZXRLZXkoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlm\nICgwID09IGxlZGdlcnMuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHByb2Nlc3MgbmV4dCBiYXRjaCBvZiBsZWRnZXJzCiAgICAgICAg\nICAgICAgICAgICAgICAgIGFzeW5jUHJvY2Vzc0xlZGdlcnMoY3Vyc29yLCBw\ncm9jZXNzb3IsIGZpbmFsQ2IsIGNvbnRleHQsIHN1Y2Nlc3NSYywgZmFpbHVy\nZVJjKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgZmluYWwgbG9u\nZyBzdGFydExlZGdlciA9IGxlZGdlcnMuZmlyc3QoKTsKICAgICAgICAgICAg\nICAgICAgICBmaW5hbCBsb25nIGVuZExlZGdlciA9IGxlZGdlcnMubGFzdCgp\nOwoKICAgICAgICAgICAgICAgICAgICBBc3luY1NldFByb2Nlc3NvcjxMb25n\nPiBzZXRQcm9jZXNzb3IgPSBuZXcgQXN5bmNTZXRQcm9jZXNzb3I8TG9uZz4o\nc2NoZWR1bGVyKTsKICAgICAgICAgICAgICAgICAgICAvLyBwcm9jZXNzIHNl\ndAogICAgICAgICAgICAgICAgICAgIHNldFByb2Nlc3Nvci5wcm9jZXNzKGxl\nZGdlcnMsIHByb2Nlc3NvciwgbmV3IEFzeW5jQ2FsbGJhY2suVm9pZENhbGxi\nYWNrKCkgewogICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3Vs\ndChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoc3VjY2Vzc1JjICE9IHJjKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJGYWls\nZWQgd2hlbiBwcm9jZXNzaW5nIHJhbmdlICIKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgcmFuZ2VUb1N0cmluZyhzdGFydExl\nZGdlciwgdHJ1ZSwgZW5kTGVkZ2VyLCB0cnVlKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmluYWxDYi5wcm9jZXNzUmVzdWx0KGZhaWx1\ncmVSYywgbnVsbCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBuZXh0\nIGJhdGNoIG9mIGxlZGdlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGFzeW5jUHJvY2Vzc0xlZGdlcnMoY3Vyc29yLCBwcm9jZXNzb3IsIGZpbmFs\nQ2IsIGNvbnRleHQsIHN1Y2Nlc3NSYywgZmFpbHVyZVJjKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIGNvbnRl\neHQsIHN1Y2Nlc3NSYywgZmFpbHVyZVJjKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfTsKICAgICAgICAgICAgY3Vyc29yLmFzeW5jUmVhZEVu\ndHJpZXMobWF4RW50cmllc1BlclNjYW4sIG1zQ2FsbGJhY2ssIG51bGwpOwog\nICAgICAgIH0KCiAgICAgICAgY2xhc3MgTVNMZWRnZXJSYW5nZUl0ZXJhdG9y\nIGltcGxlbWVudHMgTGVkZ2VyUmFuZ2VJdGVyYXRvciB7CiAgICAgICAgICAg\nIGZpbmFsIENvdW50RG93bkxhdGNoIG9wZW5DdXJzb3JMYXRjaCA9IG5ldyBD\nb3VudERvd25MYXRjaCgxKTsKICAgICAgICAgICAgTWV0YXN0b3JlQ3Vyc29y\nIGN1cnNvciA9IG51bGw7CgogICAgICAgICAgICBNU0xlZGdlclJhbmdlSXRl\ncmF0b3IoKSB7CiAgICAgICAgICAgICAgICBNZXRhc3RvcmVDYWxsYmFjazxN\nZXRhc3RvcmVDdXJzb3I+IG9wZW5DdXJzb3JDYiA9IG5ldyBNZXRhc3RvcmVD\nYWxsYmFjazxNZXRhc3RvcmVDdXJzb3I+KCkgewogICAgICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIGNvbXBsZXRlKGludCByYywgTWV0YXN0b3JlQ3Vyc29yIG5ld0N1cnNvciwg\nT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTVNF\neGNlcHRpb24uQ29kZS5PSy5nZXRDb2RlKCkgIT0gcmMpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Igb3BlbmluZyBj\ndXJzb3IgZm9yIGxlZGdlciByYW5nZSBpdGVyYXRvciB7fSIsIHJjKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGN1cnNvciA9IG5ld0N1cnNvcjsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBvcGVuQ3Vy\nc29yTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGxlZGdlclRhYmxl\nLm9wZW5DdXJzb3IoTk9OX0ZJRUxEUywgb3BlbkN1cnNvckNiLCBudWxsKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc05leHQoKSB7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIG9wZW5DdXJzb3JMYXRjaC5h\nd2FpdCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkludGVycnVwdGVkIHdhaXRpbmcgZm9yIGN1cnNvciB0byBvcGVuIiwgaWUp\nOwogICAgICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCku\naW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGN1cnNv\nciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGN1\ncnNvci5oYXNNb3JlRW50cmllcygpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIExlZGdlclJhbmdl\nIG5leHQoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICBTZXQ8TG9uZz4gbGVkZ2VySWRz\nID0gbmV3IFRyZWVTZXQ8TG9uZz4oKTsKICAgICAgICAgICAgICAgICAgICBJ\ndGVyYXRvcjxNZXRhc3RvcmVUYWJsZUl0ZW0+IGl0ZXIgPSBjdXJzb3IucmVh\nZEVudHJpZXMobWF4RW50cmllc1BlclNjYW4pOwogICAgICAgICAgICAgICAg\nICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBsZWRnZXJJZHMuYWRkKGtleTJMZWRnZXJJZChpdGVyLm5leHQo\nKS5nZXRLZXkoKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IExlZGdlclJhbmdlKGxlZGdlcklkcyk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbiBtc2UpIHsK\nICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBvY2N1\ncnJlZCByZWFkaW5nIGZyb20gbWV0YXN0b3JlIiwgbXNlKTsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNvdWxkbid0IHJl\nYWQgZnJvbSBtZXRhc3RvcmUiLCBtc2UpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgTGVkZ2VyUmFuZ2VJdGVyYXRvciBnZXRMZWRnZXJSYW5n\nZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTVNMZWRnZXJSYW5nZUl0\nZXJhdG9yKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIExlZGdlck1hbmFnZXIgbmV3TGVkZ2VyTWFuYWdlcigpIHsKICAg\nICAgICByZXR1cm4gbmV3IE1zTGVkZ2VyTWFuYWdlcihjb25mLCB6aywgbWV0\nYXN0b3JlKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBMZWRn\nZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBuZXdMZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlcigpIHRocm93cyBLZWVwZXJFeGNlcHRpb24sCiAgICAg\nICAgICAgIEludGVycnVwdGVkRXhjZXB0aW9uLCBSZXBsaWNhdGlvbkV4Y2Vw\ndGlvbi5Db21wYXRpYmlsaXR5RXhjZXB0aW9uIHsKICAgICAgICAvLyBUT0RP\nOiBjdXJyZW50bHkganVzdCB1c2UgemsgbGVkZ2VyIHVuZGVycmVwbGljYXRp\nb24gbWFuYWdlcgogICAgICAgIHJldHVybiBuZXcgWmtMZWRnZXJVbmRlcnJl\ncGxpY2F0aW9uTWFuYWdlcihjb25mLCB6ayk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQcm9jZXNzIHNldCBvbmUgYnkgb25lIGluIGFzeW5jaHJvbml6ZSB3\nYXkuIFByb2Nlc3Mgd2lsbCBiZSBzdG9wcGVkCiAgICAgKiBpbW1lZGlhdGVs\neSB3aGVuIGVycm9yIG9jY3VycmVkLgogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBjbGFzcyBBc3luY1NldFByb2Nlc3NvcjxUPiB7CiAgICAgICAgLy8g\ndXNlIHRoaXMgdG8gcHJldmVudCBsb25nIHN0YWNrIGNoYWlucyBmcm9tIGJ1\naWxkaW5nIHVwIGluIGNhbGxiYWNrcwogICAgICAgIFNjaGVkdWxlZEV4ZWN1\ndG9yU2VydmljZSBzY2hlZHVsZXI7CgogICAgICAgIC8qKgogICAgICAgICAq\nIENvbnN0cnVjdG9yCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gc2No\nZWR1bGVyCiAgICAgICAgICogICAgICAgICAgICBFeGVjdXRvciB1c2VkIHRv\nIHByZXZlbnQgbG9uZyBzdGFjayBjaGFpbnMKICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgQXN5bmNTZXRQcm9jZXNzb3IoU2NoZWR1bGVkRXhlY3V0b3JT\nZXJ2aWNlIHNjaGVkdWxlcikgewogICAgICAgICAgICB0aGlzLnNjaGVkdWxl\nciA9IHNjaGVkdWxlcjsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIFByb2Nlc3Mgc2V0IG9mIGl0ZW1zCiAgICAgICAgICoKICAgICAgICAg\nKiBAcGFyYW0gZGF0YQogICAgICAgICAqICAgICAgICAgICAgU2V0IG9mIGRh\ndGEgdG8gcHJvY2VzcwogICAgICAgICAqIEBwYXJhbSBwcm9jZXNzb3IKICAg\nICAgICAgKiAgICAgICAgICAgIENhbGxiYWNrIHRvIHByb2Nlc3MgZWxlbWVu\ndCBvZiBsaXN0IHdoZW4gc3VjY2VzcwogICAgICAgICAqIEBwYXJhbSBmaW5h\nbENiCiAgICAgICAgICogICAgICAgICAgICBGaW5hbCBjYWxsYmFjayB0byBi\nZSBjYWxsZWQgYWZ0ZXIgYWxsIGVsZW1lbnRzIGluIHRoZSBsaXN0CiAgICAg\nICAgICogICAgICAgICAgICBhcmUgcHJvY2Vzc2VkCiAgICAgICAgICogQHBh\ncmFtIGNvbnR4dAogICAgICAgICAqICAgICAgICAgICAgQ29udGV4dCBvZiBm\naW5hbCBjYWxsYmFjawogICAgICAgICAqIEBwYXJhbSBzdWNjZXNzUmMKICAg\nICAgICAgKiAgICAgICAgICAgIFJDIHBhc3NlZCB0byBmaW5hbCBjYWxsYmFj\nayBvbiBzdWNjZXNzCiAgICAgICAgICogQHBhcmFtIGZhaWx1cmVSYwogICAg\nICAgICAqICAgICAgICAgICAgUkMgcGFzc2VkIHRvIGZpbmFsIGNhbGxiYWNr\nIG9uIGZhaWx1cmUKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBw\ncm9jZXNzKGZpbmFsIFNldDxUPiBkYXRhLCBmaW5hbCBQcm9jZXNzb3I8VD4g\ncHJvY2Vzc29yLCBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBm\naW5hbENiLAogICAgICAgICAgICAgICAgZmluYWwgT2JqZWN0IGNvbnRleHQs\nIGZpbmFsIGludCBzdWNjZXNzUmMsIGZpbmFsIGludCBmYWlsdXJlUmMpIHsK\nICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCB8fCBkYXRhLnNpemUoKSA9\nPSAwKSB7CiAgICAgICAgICAgICAgICBmaW5hbENiLnByb2Nlc3NSZXN1bHQo\nc3VjY2Vzc1JjLCBudWxsLCBjb250ZXh0KTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbCBJdGVyYXRv\ncjxUPiBpdGVyID0gZGF0YS5pdGVyYXRvcigpOwogICAgICAgICAgICBBc3lu\nY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBzdHViQ2FsbGJhY2sgPSBuZXcgQXN5\nbmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NS\nZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChyYyAhPSBzdWNjZXNzUmMpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gdGVybWluYWwgaW1tZWRpYXRlbHkKICAg\nICAgICAgICAgICAgICAgICAgICAgZmluYWxDYi5wcm9jZXNzUmVzdWx0KGZh\naWx1cmVSYywgbnVsbCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgaWYgKCFpdGVyLmhhc05leHQoKSkgeyAvLyByZWFjaCB0aGUg\nZW5kIG9mIGxpc3QKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxDYi5w\ncm9jZXNzUmVzdWx0KHN1Y2Nlc3NSYywgbnVsbCwgY29udGV4dCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBuZXh0IGVsZW1l\nbnQKICAgICAgICAgICAgICAgICAgICBmaW5hbCBUIGRhdGFUb1Byb2Nlc3Mg\nPSBpdGVyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBmaW5hbCBBc3lu\nY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBzdHViID0gdGhpczsKICAgICAgICAg\nICAgICAgICAgICBzY2hlZHVsZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICAgICAgICAgIHB1YmxpYyBmaW5hbCB2b2lkIHJ1bigpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3Nvci5wcm9jZXNzKGRhdGFU\nb1Byb2Nlc3MsIHN0dWIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH07CiAgICAgICAgICAgIFQgZmlyc3RFbGVtZW50ID0gaXRlci5u\nZXh0KCk7CiAgICAgICAgICAgIHByb2Nlc3Nvci5wcm9jZXNzKGZpcnN0RWxl\nbWVudCwgc3R1YkNhbGxiYWNrKTsKICAgICAgICB9CiAgICB9Cgp9Cg==\n","encoding":"base64"}

