{"sha":"0173f64f64a5906972fe93fb3d9ad9eb85cc3f18","node_id":"MDQ6QmxvYjE1NzU5NTY6MDE3M2Y2NGY2NGE1OTA2OTcyZmU5M2ZiM2Q5YWQ5ZWI4NWNjM2YxOA==","size":11878,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0173f64f64a5906972fe93fb3d9ad9eb85cc3f18","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlOwoKaW1wb3J0\nIGphdmEudXRpbC5OYXZpZ2FibGVNYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7CmltcG9ydCBqYXZhLnV0aWwu\nY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU0V4Y2VwdGlvbi5Db2RlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZl\ncnNpb25lZDsKCnB1YmxpYyBjbGFzcyBJbk1lbW9yeU1ldGFzdG9yZVRhYmxl\nIGltcGxlbWVudHMgTWV0YXN0b3JlU2Nhbm5hYmxlVGFibGUgewoKICAgIHB1\nYmxpYyBzdGF0aWMgY2xhc3MgTWV0YWRhdGFWZXJzaW9uIGltcGxlbWVudHMg\nVmVyc2lvbiB7CiAgICAgICAgaW50IHZlcnNpb247CgogICAgICAgIHB1Ymxp\nYyBNZXRhZGF0YVZlcnNpb24oaW50IHYpIHsKICAgICAgICAgICAgdGhpcy52\nZXJzaW9uID0gdjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBNZXRhZGF0\nYVZlcnNpb24oTWV0YWRhdGFWZXJzaW9uIHYpIHsKICAgICAgICAgICAgdGhp\ncy52ZXJzaW9uID0gdi52ZXJzaW9uOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHN5bmNocm9uaXplZCBNZXRhZGF0YVZlcnNpb24gaW5jcmVtZW50VmVy\nc2lvbigpIHsKICAgICAgICAgICAgKyt2ZXJzaW9uOwogICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBPY2N1cnJlZCBjb21wYXJlKFZlcnNpb24gdikgewogICAg\nICAgICAgICBpZiAobnVsbCA9PSB2KSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oIlZlcnNpb24gaXMgbm90IGFs\nbG93ZWQgdG8gYmUgbnVsbC4iKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAodiA9PSBWZXJzaW9uLk5FVykgewogICAgICAgICAgICAgICAgcmV0\ndXJuIE9jY3VycmVkLkFGVEVSOwogICAgICAgICAgICB9IGVsc2UgaWYgKHYg\nPT0gVmVyc2lvbi5BTlkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBPY2N1\ncnJlZC5DT05DVVJSRU5UTFk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoISh2\nIGluc3RhbmNlb2YgTWV0YWRhdGFWZXJzaW9uKSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiSW52YWxp\nZCB2ZXJzaW9uIHR5cGUiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBN\nZXRhZGF0YVZlcnNpb24gbXYgPSAoTWV0YWRhdGFWZXJzaW9uKXY7CiAgICAg\nICAgICAgIGludCByZXMgPSB2ZXJzaW9uIC0gbXYudmVyc2lvbjsKICAgICAg\nICAgICAgaWYgKHJlcyA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nT2NjdXJyZWQuQ09OQ1VSUkVOVExZOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHJlcyA8IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBPY2N1cnJlZC5C\nRUZPUkU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gT2NjdXJyZWQuQUZURVI7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGVx\ndWFscyhPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIGlmIChudWxsID09IG9i\naiB8fAogICAgICAgICAgICAgICAgIShvYmogaW5zdGFuY2VvZiBNZXRhZGF0\nYVZlcnNpb24pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgTWV0YWRhdGFWZXJzaW9uIHYgPSAo\nTWV0YWRhdGFWZXJzaW9uKW9iajsKICAgICAgICAgICAgcmV0dXJuIDAgPT0g\nKHZlcnNpb24gLSB2LnZlcnNpb24pOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgcmV0dXJuICJ2ZXJzaW9uPSIgKyB2ZXJzaW9uOwogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBoYXNo\nQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHZlcnNpb247CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIG5hbWU7CiAgICBwcml2YXRl\nIFRyZWVNYXA8U3RyaW5nLCBWZXJzaW9uZWQ8VmFsdWU+PiBtYXAgPSBudWxs\nOwogICAgcHJpdmF0ZSBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1\nbGVyOwoKICAgIHB1YmxpYyBJbk1lbW9yeU1ldGFzdG9yZVRhYmxlKEluTWVt\nb3J5TWV0YVN0b3JlIG1ldGFzdG9yZSwgU3RyaW5nIG5hbWUpIHsKICAgICAg\nICB0aGlzLm1hcCA9IG5ldyBUcmVlTWFwPFN0cmluZywgVmVyc2lvbmVkPFZh\nbHVlPj4oKTsKICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgIHRo\naXMuc2NoZWR1bGVyID0gRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZFNjaGVk\ndWxlZEV4ZWN1dG9yKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgU3RyaW5nIGdldE5hbWUgKCkgewogICAgICAgIHJldHVybiB0aGlzLm5h\nbWU7CiAgICB9CgogICAgc3RhdGljIFZlcnNpb25lZDxWYWx1ZT4gY2xvbmVW\nYWx1ZShWYWx1ZSB2YWx1ZSwgVmVyc2lvbiB2ZXJzaW9uLCBTZXQ8U3RyaW5n\nPiBmaWVsZHMpIHsKICAgICAgICBpZiAobnVsbCAhPSB2YWx1ZSkgewogICAg\nICAgICAgICBWYWx1ZSBuZXdWYWx1ZSA9IG5ldyBWYWx1ZSgpOwogICAgICAg\nICAgICBpZiAoQUxMX0ZJRUxEUyA9PSBmaWVsZHMpIHsKICAgICAgICAgICAg\nICAgIGZpZWxkcyA9IHZhbHVlLmdldEZpZWxkcygpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGZvciAoU3RyaW5nIGYgOiBmaWVsZHMpIHsKICAgICAg\nICAgICAgICAgIG5ld1ZhbHVlLnNldEZpZWxkKGYsIHZhbHVlLmdldEZpZWxk\nKGYpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YWx1ZSA9IG5ld1Zh\nbHVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKG51bGwgPT0gdmVyc2lvbikg\newogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24o\nIlZlcnNpb24gaXNuJ3QgYWxsb3dlZCB0byBiZSBudWxsLiIpOwogICAgICAg\nIH0KICAgICAgICBpZiAoVmVyc2lvbi5BTlkgIT0gdmVyc2lvbiAmJiBWZXJz\naW9uLk5FVyAhPSB2ZXJzaW9uKSB7CiAgICAgICAgICAgIGlmICh2ZXJzaW9u\nIGluc3RhbmNlb2YgTWV0YWRhdGFWZXJzaW9uKSB7CiAgICAgICAgICAgICAg\nICB2ZXJzaW9uID0gbmV3IE1ldGFkYXRhVmVyc2lvbigoKE1ldGFkYXRhVmVy\nc2lvbil2ZXJzaW9uKS52ZXJzaW9uKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24oIldyb25nIHZlcnNpb24gdHlwZS4iKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICByZXR1cm4gbmV3IFZlcnNpb25lZDxWYWx1ZT4odmFs\ndWUsIHZlcnNpb24pOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgZ2V0KGZpbmFsIFN0cmluZyBrZXksIGZpbmFsIE1ldGFzdG9yZUNh\nbGxiYWNrPFZlcnNpb25lZDxWYWx1ZT4+IGNiLCBmaW5hbCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgc2NoZWR1bGVyLnN1Ym1pdChuZXcgUnVubmFibGUoKSB7\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBydW4oKSB7CiAgICAgICAgICAgICAgICBzY2hlZHVsZUdldChrZXksIEFM\nTF9GSUVMRFMsIGNiLCBjdHgpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBnZXQoZmlu\nYWwgU3RyaW5nIGtleSwgZmluYWwgU2V0PFN0cmluZz4gZmllbGRzLCBmaW5h\nbCBNZXRhc3RvcmVDYWxsYmFjazxWZXJzaW9uZWQ8VmFsdWU+PiBjYiwKICAg\nICAgICAgICAgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIHNjaGVkdWxl\nci5zdWJtaXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICAgICAgc2NoZWR1bGVHZXQoa2V5LCBmaWVsZHMsIGNiLCBjdHgpOwogICAg\nICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgcHVibGljIHN5bmNo\ncm9uaXplZCB2b2lkIHNjaGVkdWxlR2V0KFN0cmluZyBrZXksIFNldDxTdHJp\nbmc+IGZpZWxkcywgTWV0YXN0b3JlQ2FsbGJhY2s8VmVyc2lvbmVkPFZhbHVl\nPj4gY2IsCiAgICAgICAgICAgIE9iamVjdCBjdHgpIHsKICAgICAgICBpZiAo\nbnVsbCA9PSBrZXkpIHsKICAgICAgICAgICAgY2IuY29tcGxldGUoQ29kZS5J\nbGxlZ2FsT3AuZ2V0Q29kZSgpLCBudWxsLCBjdHgpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQogICAgICAgIFZlcnNpb25lZDxWYWx1ZT4gdnYg\nPSBnZXQoa2V5KTsKICAgICAgICBpbnQgcmMgPSBudWxsID09IHZ2ID8gQ29k\nZS5Ob0tleS5nZXRDb2RlKCkgOiBDb2RlLk9LLmdldENvZGUoKTsKICAgICAg\nICBpZiAodnYgIT0gbnVsbCkgewogICAgICAgICAgICB2diA9IGNsb25lVmFs\ndWUodnYuZ2V0VmFsdWUoKSwgdnYuZ2V0VmVyc2lvbigpLCBmaWVsZHMpOwog\nICAgICAgIH0KICAgICAgICBjYi5jb21wbGV0ZShyYywgdnYsIGN0eCk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBwdXQoZmluYWwg\nU3RyaW5nIGtleSwgZmluYWwgVmFsdWUgdmFsdWUsIGZpbmFsIFZlcnNpb24g\ndmVyc2lvbiwgZmluYWwgTWV0YXN0b3JlQ2FsbGJhY2s8VmVyc2lvbj4gY2Is\nCiAgICAgICAgICAgIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBzY2hl\nZHVsZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAg\nICAgICAgICAgIGlmIChudWxsID09IGtleSB8fCBudWxsID09IHZhbHVlIHx8\nIG51bGwgPT0gdmVyc2lvbikgewogICAgICAgICAgICAgICAgICAgIGNiLmNv\nbXBsZXRlKENvZGUuSWxsZWdhbE9wLmdldENvZGUoKSwgbnVsbCwgY3R4KTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBSZXN1bHQ8VmVyc2lvbj4gcmVzdWx0ID0gcHV0\nKGtleSwgdmFsdWUsIHZlcnNpb24pOwogICAgICAgICAgICAgICAgY2IuY29t\ncGxldGUocmVzdWx0LmNvZGUuZ2V0Q29kZSgpLCByZXN1bHQudmFsdWUsIGN0\neCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyB2b2lkIHJlbW92ZShmaW5hbCBTdHJpbmcga2V5\nLCBmaW5hbCBWZXJzaW9uIHZlcnNpb24sIGZpbmFsIE1ldGFzdG9yZUNhbGxi\nYWNrPFZvaWQ+IGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgc2No\nZWR1bGVyLnN1Ym1pdChuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAg\nICAgICAgICAgICBpZiAobnVsbCA9PSBrZXkgfHwgbnVsbCA9PSB2ZXJzaW9u\nKSB7CiAgICAgICAgICAgICAgICAgICAgY2IuY29tcGxldGUoQ29kZS5JbGxl\nZ2FsT3AuZ2V0Q29kZSgpLCBudWxsLCBjdHgpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIENvZGUgY29kZSA9IHJlbW92ZShrZXksIHZlcnNpb24pOwogICAgICAgICAg\nICAgICAgY2IuY29tcGxldGUoY29kZS5nZXRDb2RlKCksIG51bGwsIGN0eCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIG9wZW5DdXJzb3IoTWV0YXN0b3JlQ2FsbGJh\nY2s8TWV0YXN0b3JlQ3Vyc29yPiBjYiwgT2JqZWN0IGN0eCkgewogICAgICAg\nIG9wZW5DdXJzb3IoRU1QVFlfU1RBUlRfS0VZLCB0cnVlLCBFTVBUWV9FTkRf\nS0VZLCB0cnVlLCBPcmRlci5BU0MsCiAgICAgICAgICAgICAgICAgICBBTExf\nRklFTERTLCBjYiwgY3R4KTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIG9wZW5DdXJzb3IoU2V0PFN0cmluZz4gZmllbGRzLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICBNZXRhc3RvcmVDYWxsYmFjazxNZXRh\nc3RvcmVDdXJzb3I+IGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAgb3BlbkN1\ncnNvcihFTVBUWV9TVEFSVF9LRVksIHRydWUsIEVNUFRZX0VORF9LRVksIHRy\ndWUsIE9yZGVyLkFTQywKICAgICAgICAgICAgICAgICAgIGZpZWxkcywgY2Is\nIGN0eCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBv\ncGVuQ3Vyc29yKFN0cmluZyBmaXJzdEtleSwgYm9vbGVhbiBmaXJzdEluY2x1\nc2l2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGxhc3RL\nZXksIGJvb2xlYW4gbGFzdEluY2x1c2l2ZSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgT3JkZXIgb3JkZXIsIE1ldGFzdG9yZUNhbGxiYWNrPE1ldGFz\ndG9yZUN1cnNvcj4gY2IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIE9i\namVjdCBjdHgpIHsKICAgICAgICBvcGVuQ3Vyc29yKGZpcnN0S2V5LCBmaXJz\ndEluY2x1c2l2ZSwgbGFzdEtleSwgbGFzdEluY2x1c2l2ZSwKICAgICAgICAg\nICAgICAgICAgIG9yZGVyLCBBTExfRklFTERTLCBjYiwgY3R4KTsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIG9wZW5DdXJzb3IoZmlu\nYWwgU3RyaW5nIGZpcnN0S2V5LCBmaW5hbCBib29sZWFuIGZpcnN0SW5jbHVz\naXZlLAogICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBTdHJpbmcg\nbGFzdEtleSwgZmluYWwgYm9vbGVhbiBsYXN0SW5jbHVzaXZlLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICBmaW5hbCBPcmRlciBvcmRlciwgZmluYWwg\nU2V0PFN0cmluZz4gZmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICBmaW5hbCBNZXRhc3RvcmVDYWxsYmFjazxNZXRhc3RvcmVDdXJzb3I+IGNi\nLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgc2NoZWR1bGVyLnN1Ym1p\ndChuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBS\nZXN1bHQ8TWV0YXN0b3JlQ3Vyc29yPiByZXN1bHQgPSBvcGVuQ3Vyc29yKGZp\ncnN0S2V5LCBmaXJzdEluY2x1c2l2ZSwgbGFzdEtleSwgbGFzdEluY2x1c2l2\nZSwKICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXIsIGZpZWxkcyk7CiAg\nICAgICAgICAgICAgICBjYi5jb21wbGV0ZShyZXN1bHQuY29kZS5nZXRDb2Rl\nKCksIHJlc3VsdC52YWx1ZSwgY3R4KTsKICAgICAgICAgICAgfQogICAgICAg\nIH0pOwogICAgfQoKICAgIHByaXZhdGUgc3luY2hyb25pemVkIFZlcnNpb25l\nZDxWYWx1ZT4gZ2V0KFN0cmluZyBrZXkpIHsKICAgICAgICByZXR1cm4gbWFw\nLmdldChrZXkpOwogICAgfQoKICAgIHByaXZhdGUgc3luY2hyb25pemVkIENv\nZGUgcmVtb3ZlKFN0cmluZyBrZXksIFZlcnNpb24gdmVyc2lvbikgewogICAg\nICAgIFZlcnNpb25lZDxWYWx1ZT4gdnYgPSBtYXAuZ2V0KGtleSk7CiAgICAg\nICAgaWYgKG51bGwgPT0gdnYpIHsKICAgICAgICAgICAgcmV0dXJuIENvZGUu\nTm9LZXk7CiAgICAgICAgfQogICAgICAgIGlmIChWZXJzaW9uLk9jY3VycmVk\nLkNPTkNVUlJFTlRMWSAhPSB2di5nZXRWZXJzaW9uKCkuY29tcGFyZSh2ZXJz\naW9uKSkgewogICAgICAgICAgICByZXR1cm4gQ29kZS5CYWRWZXJzaW9uOwog\nICAgICAgIH0KICAgICAgICBtYXAucmVtb3ZlKGtleSk7CiAgICAgICAgcmV0\ndXJuIENvZGUuT0s7CiAgICB9CgogICAgc3RhdGljIGNsYXNzIFJlc3VsdDxU\nPiB7CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAgIFQgdmFsdWU7CgogICAg\nICAgIHB1YmxpYyBSZXN1bHQoQ29kZSBjb2RlLCBUIHZhbHVlKSB7CiAgICAg\nICAgICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgICAgICAgICAgIHRoaXMudmFs\ndWUgPSB2YWx1ZTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzeW5j\naHJvbml6ZWQgUmVzdWx0PFZlcnNpb24+IHB1dChTdHJpbmcga2V5LCBWYWx1\nZSB2YWx1ZSwgVmVyc2lvbiB2ZXJzaW9uKSB7CiAgICAgICAgVmVyc2lvbmVk\nPFZhbHVlPiB2diA9IG1hcC5nZXQoa2V5KTsKICAgICAgICBpZiAodnYgPT0g\nbnVsbCkgewogICAgICAgICAgICBpZiAoVmVyc2lvbi5ORVcgIT0gdmVyc2lv\nbikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQ8VmVyc2lv\nbj4oQ29kZS5Ob0tleSwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgdnYgPSBjbG9uZVZhbHVlKHZhbHVlLCB2ZXJzaW9uLCBBTExfRklFTERT\nKTsKICAgICAgICAgICAgdnYuc2V0VmVyc2lvbihuZXcgTWV0YWRhdGFWZXJz\naW9uKDApKTsKICAgICAgICAgICAgbWFwLnB1dChrZXksIHZ2KTsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBSZXN1bHQ8VmVyc2lvbj4oQ29kZS5PSywgbmV3\nIE1ldGFkYXRhVmVyc2lvbigwKSk7CiAgICAgICAgfQogICAgICAgIGlmIChW\nZXJzaW9uLk5FVyA9PSB2ZXJzaW9uKSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgUmVzdWx0PFZlcnNpb24+KENvZGUuS2V5RXhpc3RzLCBudWxsKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKFZlcnNpb24uT2NjdXJyZWQuQ09OQ1VSUkVO\nVExZICE9IHZ2LmdldFZlcnNpb24oKS5jb21wYXJlKHZlcnNpb24pKSB7CiAg\nICAgICAgICAgIHJldHVybiBuZXcgUmVzdWx0PFZlcnNpb24+KENvZGUuQmFk\nVmVyc2lvbiwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIHZ2LnNldFZlcnNp\nb24oKChNZXRhZGF0YVZlcnNpb24pdnYuZ2V0VmVyc2lvbigpKS5pbmNyZW1l\nbnRWZXJzaW9uKCkpOwogICAgICAgIHZ2LnNldFZhbHVlKHZ2LmdldFZhbHVl\nKCkubWVyZ2UodmFsdWUpKTsKICAgICAgICByZXR1cm4gbmV3IFJlc3VsdDxW\nZXJzaW9uPihDb2RlLk9LLCBuZXcgTWV0YWRhdGFWZXJzaW9uKChNZXRhZGF0\nYVZlcnNpb24pdnYuZ2V0VmVyc2lvbigpKSk7CiAgICB9CgogICAgcHJpdmF0\nZSBzeW5jaHJvbml6ZWQgUmVzdWx0PE1ldGFzdG9yZUN1cnNvcj4gb3BlbkN1\ncnNvcigKICAgICAgICAgICAgU3RyaW5nIGZpcnN0S2V5LCBib29sZWFuIGZp\ncnN0SW5jbHVzaXZlLAogICAgICAgICAgICBTdHJpbmcgbGFzdEtleSwgYm9v\nbGVhbiBsYXN0SW5jbHVzaXZlLAogICAgICAgICAgICBPcmRlciBvcmRlciwg\nU2V0PFN0cmluZz4gZmllbGRzKSB7CiAgICAgICAgaWYgKDAgPT0gbWFwLnNp\nemUoKSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3VsdDxNZXRhc3Rv\ncmVDdXJzb3I+KENvZGUuT0ssIE1ldGFzdG9yZUN1cnNvci5FTVBUWV9DVVJT\nT1IpOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBpc0xlZ2FsQ3Vyc29y\nID0gZmFsc2U7CiAgICAgICAgTmF2aWdhYmxlTWFwPFN0cmluZywgVmVyc2lv\nbmVkPFZhbHVlPj4gbXlNYXAgPSBudWxsOwogICAgICAgIGlmIChPcmRlci5B\nU0MgPT0gb3JkZXIpIHsKICAgICAgICAgICAgbXlNYXAgPSBtYXA7CiAgICAg\nICAgICAgIGlmIChFTVBUWV9FTkRfS0VZID09IGxhc3RLZXkgfHwKICAgICAg\nICAgICAgICAgIGxhc3RLZXkuY29tcGFyZVRvKG15TWFwLmxhc3RLZXkoKSkg\nPiAwKSB7CiAgICAgICAgICAgICAgICBsYXN0S2V5ID0gbXlNYXAubGFzdEtl\neSgpOwogICAgICAgICAgICAgICAgbGFzdEluY2x1c2l2ZSA9IHRydWU7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEVNUFRZX1NUQVJUX0tFWSA9\nPSBmaXJzdEtleSB8fAogICAgICAgICAgICAgICAgZmlyc3RLZXkuY29tcGFy\nZVRvKG15TWFwLmZpcnN0S2V5KCkpIDwgMCkgewogICAgICAgICAgICAgICAg\nZmlyc3RLZXkgPSBteU1hcC5maXJzdEtleSgpOwogICAgICAgICAgICAgICAg\nZmlyc3RJbmNsdXNpdmUgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChmaXJzdEtleS5jb21wYXJlVG8obGFzdEtleSkgPD0gMCkgewog\nICAgICAgICAgICAgICAgaXNMZWdhbEN1cnNvciA9IHRydWU7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgaWYgKE9yZGVyLkRFU0MgPT0gb3JkZXIp\nIHsKICAgICAgICAgICAgbXlNYXAgPSBtYXAuZGVzY2VuZGluZ01hcCgpOwog\nICAgICAgICAgICBpZiAoRU1QVFlfU1RBUlRfS0VZID09IGxhc3RLZXkgfHwK\nICAgICAgICAgICAgICAgIGxhc3RLZXkuY29tcGFyZVRvKG15TWFwLmxhc3RL\nZXkoKSkgPCAwKSB7CiAgICAgICAgICAgICAgICBsYXN0S2V5ID0gbXlNYXAu\nbGFzdEtleSgpOwogICAgICAgICAgICAgICAgbGFzdEluY2x1c2l2ZSA9IHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEVNUFRZX0VORF9L\nRVkgPT0gZmlyc3RLZXkgfHwKICAgICAgICAgICAgICAgIGZpcnN0S2V5LmNv\nbXBhcmVUbyhteU1hcC5maXJzdEtleSgpKSA+IDApIHsKICAgICAgICAgICAg\nICAgIGZpcnN0S2V5ID0gbXlNYXAuZmlyc3RLZXkoKTsKICAgICAgICAgICAg\nICAgIGZpcnN0SW5jbHVzaXZlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoZmlyc3RLZXkuY29tcGFyZVRvKGxhc3RLZXkpID49IDAp\nIHsKICAgICAgICAgICAgICAgIGlzTGVnYWxDdXJzb3IgPSB0cnVlOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIWlzTGVnYWxDdXJz\nb3IgfHwgbnVsbCA9PSBteU1hcCkgewogICAgICAgICAgICByZXR1cm4gbmV3\nIFJlc3VsdDxNZXRhc3RvcmVDdXJzb3I+KENvZGUuSWxsZWdhbE9wLCBudWxs\nKTsKICAgICAgICB9CiAgICAgICAgTWV0YXN0b3JlQ3Vyc29yIGN1cnNvciA9\nIG5ldyBJbk1lbW9yeU1ldGFzdG9yZUN1cnNvcigKICAgICAgICAgICAgICAg\nIG15TWFwLnN1Yk1hcChmaXJzdEtleSwgZmlyc3RJbmNsdXNpdmUsIGxhc3RL\nZXksIGxhc3RJbmNsdXNpdmUpLCBmaWVsZHMsIHNjaGVkdWxlcik7CiAgICAg\nICAgcmV0dXJuIG5ldyBSZXN1bHQ8TWV0YXN0b3JlQ3Vyc29yPihDb2RlLk9L\nLCBjdXJzb3IpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgY2xvc2UoKSB7CiAgICAgICAgLy8gZG8gbm90aGluZwogICAgfQp9Cg==\n","encoding":"base64"}

