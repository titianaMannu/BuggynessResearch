{"sha":"b3e661d5276e9e17a9581a0904043d48bbd6ae02","node_id":"MDQ6QmxvYjE1NzU5NTY6YjNlNjYxZDUyNzZlOWUxN2E5NTgxYTA5MDQwNDNkNDhiYmQ2YWUwMg==","size":4320,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b3e661d5276e9e17a9581a0904043d48bbd6ae02","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlOwoKaW1wb3J0\nIGNvbS5nb29nbGUuY29tbW9uLnByaW1pdGl2ZXMuVW5zaWduZWRCeXRlczsK\naW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLmhhc2guSGFzaGVyOwppbXBvcnQg\nY29tLmdvb2dsZS5jb21tb24uaGFzaC5IYXNoRnVuY3Rpb247CmltcG9ydCBj\nb20uZ29vZ2xlLmNvbW1vbi5oYXNoLkhhc2hpbmc7CgppbXBvcnQgamF2YS51\ndGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwoKaW1wb3J0IHN0YXRpYyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLk1ldGFzdG9yZVRhYmxlLkFM\nTF9GSUVMRFM7CgpwdWJsaWMgY2xhc3MgVmFsdWUgewogICAgc3RhdGljIGZp\nbmFsIENvbXBhcmF0b3I8Ynl0ZVtdPiBjb21wYXJhdG9yID0KICAgICAgICBV\nbnNpZ25lZEJ5dGVzLmxleGljb2dyYXBoaWNhbENvbXBhcmF0b3IoKTsKCiAg\nICBwcm90ZWN0ZWQgTWFwPFN0cmluZywgYnl0ZVtdPiBmaWVsZHM7CgogICAg\ncHVibGljIFZhbHVlKCkgewogICAgICAgIGZpZWxkcyA9IG5ldyBIYXNoTWFw\nPFN0cmluZywgYnl0ZVtdPigpOwogICAgfQoKICAgIHB1YmxpYyBWYWx1ZShW\nYWx1ZSB2KSB7CiAgICAgICAgZmllbGRzID0gbmV3IEhhc2hNYXA8U3RyaW5n\nLCBieXRlW10+KHYuZmllbGRzKTsKICAgIH0KCiAgICBwdWJsaWMgYnl0ZVtd\nIGdldEZpZWxkKFN0cmluZyBmaWVsZCkgewogICAgICAgIHJldHVybiBmaWVs\nZHMuZ2V0KGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgVmFsdWUgc2V0Rmll\nbGQoU3RyaW5nIGZpZWxkLCBieXRlW10gZGF0YSkgewogICAgICAgIGZpZWxk\ncy5wdXQoZmllbGQsIGRhdGEpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIHB1YmxpYyBWYWx1ZSBjbGVhckZpZWxkcygpIHsKICAgICAgICBm\naWVsZHMuY2xlYXIoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAg\nICBwdWJsaWMgU2V0PFN0cmluZz4gZ2V0RmllbGRzKCkgewogICAgICAgIHJl\ndHVybiBmaWVsZHMua2V5U2V0KCk7CiAgICB9CgogICAgcHVibGljIE1hcDxT\ndHJpbmcsIGJ5dGVbXT4gZ2V0RmllbGRzTWFwKCkgewogICAgICAgIHJldHVy\nbiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVNYXAoZmllbGRzKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFNlbGVjdCBwYXJ0cyBvZiBmaWVsZHMuCiAgICAg\nKgogICAgICogQHBhcmFtIGZpZWxkcwogICAgICogICAgICAgICAgICBQYXJ0\ncyBvZiBmaWVsZHMKICAgICAqIEByZXR1cm4gbmV3IHZhbHVlIHdpdGggc3Bl\nY2lmaWVkIGZpZWxkcwogICAgICovCiAgICBwdWJsaWMgVmFsdWUgcHJvamVj\ndChTZXQ8U3RyaW5nPiBmaWVsZHMpIHsKICAgICAgICBpZiAoQUxMX0ZJRUxE\nUyA9PSBmaWVsZHMpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBWYWx1ZSh0\naGlzKTsKICAgICAgICB9CiAgICAgICAgVmFsdWUgdiA9IG5ldyBWYWx1ZSgp\nOwogICAgICAgIGZvciAoU3RyaW5nIGYgOiBmaWVsZHMpIHsKICAgICAgICAg\nICAgYnl0ZVtdIGRhdGEgPSB0aGlzLmZpZWxkcy5nZXQoZik7CiAgICAgICAg\nICAgIHYuc2V0RmllbGQoZiwgZGF0YSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB2OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGludCBo\nYXNoQ29kZSgpIHsKICAgICAgICBIYXNoRnVuY3Rpb24gaGYgPSBIYXNoaW5n\nLm11cm11cjNfMzIoKTsKICAgICAgICBIYXNoZXIgaGMgPSBoZi5uZXdIYXNo\nZXIoKTsKICAgICAgICBmb3IgKFN0cmluZyBrZXkgOiBmaWVsZHMua2V5U2V0\nKCkpIHsKICAgICAgICAgICAgaGMucHV0U3RyaW5nKGtleSk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBoYy5oYXNoKCkuYXNJbnQoKTsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qg\nbykgewogICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBWYWx1ZSkpIHsKICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBWYWx1\nZSBvdGhlciA9IChWYWx1ZSkgbzsKICAgICAgICBpZiAoZmllbGRzLnNpemUo\nKSAhPSBvdGhlci5maWVsZHMuc2l6ZSgpKSB7CiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZm9yIChTdHJpbmcgZiA6IGZp\nZWxkcy5rZXlTZXQoKSkgewogICAgICAgICAgICBieXRlW10gdjEgPSBmaWVs\nZHMuZ2V0KGYpOwogICAgICAgICAgICBieXRlW10gdjIgPSBvdGhlci5maWVs\nZHMuZ2V0KGYpOwogICAgICAgICAgICBpZiAoMCAhPSBjb21wYXJhdG9yLmNv\nbXBhcmUodjEsIHYyKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8qKgogICAgICogTWVyZ2Ugb3RoZXIgdmFsdWUuCiAg\nICAgKgogICAgICogQHBhcmFtIG90aGVyCiAgICAgKiAgICAgICAgICBPdGhl\nciBWYWx1ZQogICAgICovCiAgICBwdWJsaWMgVmFsdWUgbWVyZ2UoVmFsdWUg\nb3RoZXIpIHsKICAgICAgICBmb3IgKE1hcC5FbnRyeTxTdHJpbmcsIGJ5dGVb\nXT4gZW50cnkgOiBvdGhlci5maWVsZHMuZW50cnlTZXQoKSkgewogICAgICAg\nICAgICBpZiAobnVsbCA9PSBlbnRyeS5nZXRWYWx1ZSgpKSB7CiAgICAgICAg\nICAgICAgICBmaWVsZHMucmVtb3ZlKGVudHJ5LmdldEtleSgpKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpZWxkcy5wdXQoZW50\ncnkuZ2V0S2V5KCksIGVudHJ5LmdldFZhbHVlKCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAg\nICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAg\nICAgICBzYi5hcHBlbmQoIlsiKTsKICAgICAgICBmb3IgKE1hcC5FbnRyeTxT\ndHJpbmcsIGJ5dGVbXT4gZW50cnkgOiBmaWVsZHMuZW50cnlTZXQoKSkgewog\nICAgICAgICAgICBTdHJpbmcgZiA9IGVudHJ5LmdldEtleSgpOwogICAgICAg\nICAgICBpZiAobnVsbCA9PSBmKSB7CiAgICAgICAgICAgICAgICBmID0gIk5V\nTEwiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFN0cmluZyB2YWx1ZTsK\nICAgICAgICAgICAgaWYgKG51bGwgPT0gZW50cnkuZ2V0VmFsdWUoKSkgewog\nICAgICAgICAgICAgICAgdmFsdWUgPSAiTk9ORSI7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IG5ldyBTdHJpbmcoZW50\ncnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2Iu\nYXBwZW5kKCIoJyIpLmFwcGVuZChmKS5hcHBlbmQoIic9IikuYXBwZW5kKHZh\nbHVlKS5hcHBlbmQoIikiKTsKICAgICAgICB9CiAgICAgICAgc2IuYXBwZW5k\nKCJdIik7CiAgICAgICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICB9Cn0K\n","encoding":"base64"}

