{"sha":"da18b6c9100e0f3cfabd00c0960582334f69045b","node_id":"MDQ6QmxvYjE1NzU5NTY6ZGExOGI2YzkxMDBlMGYzY2ZhYmQwMGMwOTYwNTgyMzM0ZjY5MDQ1Yg==","size":23887,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/da18b6c9100e0f3cfabd00c0960582334f69045b","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90bzsKCmlt\ncG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBq\nYXZhLm5ldC5NYWxmb3JtZWRVUkxFeGNlcHRpb247CmltcG9ydCBqYXZhLm5l\ndC5Vbmtub3duSG9zdEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVC\ndWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRpb25F\neGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5GdXR1cmU7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVvdXRFeGNlcHRpb247CgppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2llOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWVFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkV4aXRD\nb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVy\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5q\nbXguQktNQmVhblJlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLk5JT1NlcnZlckZhY3RvcnkuQ254bjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5BdXRvUmVjb3ZlcnlNYWlu\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJl\ncGxpY2F0aW9uRXhjZXB0aW9uLkNvbXBhdGliaWxpdHlFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGlj\nYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5NYXRoVXRpbHM7CgppbXBvcnQg\nY29tLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJsZUZvclRlc3Rp\nbmc7CgppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5Cb29raWVQcm90b2NvbC5QYWNrZXRIZWFkZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY29uZmlndXJhdGlvbi5Db25maWd1cmF0aW9uRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5CYXNpY1BhcnNl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuT3B0aW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmU7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBGb3JtYXR0ZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLlBhcnNlRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNvZGVjLmJpbmFyeS5IZXg7CgppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJG\nYWN0b3J5OwoKLyoqCiAqIEltcGxlbWVudHMgdGhlIHNlcnZlci1zaWRlIHBh\ncnQgb2YgdGhlIEJvb2tLZWVwZXIgcHJvdG9jb2wuCiAqCiAqLwpwdWJsaWMg\nY2xhc3MgQm9va2llU2VydmVyIGltcGxlbWVudHMgTklPU2VydmVyRmFjdG9y\neS5QYWNrZXRQcm9jZXNzb3IsIEJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNr\ncy5Xcml0ZUNhbGxiYWNrIHsKICAgIGZpbmFsIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZjsKICAgIE5JT1NlcnZlckZhY3RvcnkgbmlvU2VydmVyRmFjdG9y\neTsKICAgIHByaXZhdGUgdm9sYXRpbGUgYm9vbGVhbiBydW5uaW5nID0gZmFs\nc2U7CiAgICBCb29raWUgYm9va2llOwogICAgRGVhdGhXYXRjaGVyIGRlYXRo\nV2F0Y2hlcjsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9y\neS5nZXRMb2dnZXIoQm9va2llU2VydmVyLmNsYXNzKTsKCiAgICBpbnQgZXhp\ndENvZGUgPSBFeGl0Q29kZS5PSzsKCiAgICAvLyBvcGVyYXRpb24gc3RhdHMK\nICAgIGZpbmFsIEJLU3RhdHMgYmtTdGF0cyA9IEJLU3RhdHMuZ2V0SW5zdGFu\nY2UoKTsKICAgIGZpbmFsIGJvb2xlYW4gaXNTdGF0c0VuYWJsZWQ7CiAgICBw\ncm90ZWN0ZWQgQm9va2llU2VydmVyQmVhbiBqbXhCa1NlcnZlckJlYW47CiAg\nICBwcml2YXRlIEF1dG9SZWNvdmVyeU1haW4gYXV0b1JlY292ZXJ5TWFpbiA9\nIG51bGw7CiAgICBwcml2YXRlIGJvb2xlYW4gaXNBdXRvUmVjb3ZlcnlEYWVt\nb25FbmFibGVkOwoKICAgIHB1YmxpYyBCb29raWVTZXJ2ZXIoU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mKSB0aHJvd3MgSU9FeGNlcHRpb24sCiAgICAgICAg\nICAgIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJv\nb2tpZUV4Y2VwdGlvbiwKICAgICAgICAgICAgVW5hdmFpbGFibGVFeGNlcHRp\nb24sIENvbXBhdGliaWxpdHlFeGNlcHRpb24gewogICAgICAgIHRoaXMuY29u\nZiA9IGNvbmY7CiAgICAgICAgdGhpcy5ib29raWUgPSBuZXdCb29raWUoY29u\nZik7CiAgICAgICAgaXNBdXRvUmVjb3ZlcnlEYWVtb25FbmFibGVkID0gY29u\nZi5pc0F1dG9SZWNvdmVyeURhZW1vbkVuYWJsZWQoKTsKICAgICAgICBpZiAo\naXNBdXRvUmVjb3ZlcnlEYWVtb25FbmFibGVkKSB7CiAgICAgICAgICAgIHRo\naXMuYXV0b1JlY292ZXJ5TWFpbiA9IG5ldyBBdXRvUmVjb3ZlcnlNYWluKGNv\nbmYpOwogICAgICAgIH0KICAgICAgICBpc1N0YXRzRW5hYmxlZCA9IGNvbmYu\naXNTdGF0aXN0aWNzRW5hYmxlZCgpOwogICAgfQoKICAgIHByb3RlY3RlZCBC\nb29raWUgbmV3Qm9va2llKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZikKICAg\nICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiwgSW50\nZXJydXB0ZWRFeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIG5ldyBCb29raWUoY29uZik7CiAgICB9CgogICAgcHVibGljIHZv\naWQgc3RhcnQoKSB0aHJvd3MgSU9FeGNlcHRpb24sIFVuYXZhaWxhYmxlRXhj\nZXB0aW9uIHsKICAgICAgICBuaW9TZXJ2ZXJGYWN0b3J5ID0gbmV3IE5JT1Nl\ncnZlckZhY3RvcnkoY29uZiwgdGhpcyk7CgogICAgICAgIHRoaXMuYm9va2ll\nLnN0YXJ0KCk7CiAgICAgICAgaWYgKGlzQXV0b1JlY292ZXJ5RGFlbW9uRW5h\nYmxlZCAmJiB0aGlzLmF1dG9SZWNvdmVyeU1haW4gIT0gbnVsbCkgewogICAg\nICAgICAgICB0aGlzLmF1dG9SZWNvdmVyeU1haW4uc3RhcnQoKTsKICAgICAg\nICB9CgogICAgICAgIG5pb1NlcnZlckZhY3Rvcnkuc3RhcnQoKTsKICAgICAg\nICBydW5uaW5nID0gdHJ1ZTsKICAgICAgICBkZWF0aFdhdGNoZXIgPSBuZXcg\nRGVhdGhXYXRjaGVyKGNvbmYpOwogICAgICAgIGRlYXRoV2F0Y2hlci5zdGFy\ndCgpOwoKICAgICAgICAvLyByZWdpc3RlciBqbXgKICAgICAgICByZWdpc3Rl\nckpNWCgpOwogICAgfQoKICAgIHB1YmxpYyBJbmV0U29ja2V0QWRkcmVzcyBn\nZXRMb2NhbEFkZHJlc3MoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncmV0dXJuIEJvb2tpZS5nZXRCb29raWVBZGRyZXNzKGNvbmYpOwogICAgICAg\nIH0gY2F0Y2ggKFVua25vd25Ib3N0RXhjZXB0aW9uIHVoZSkgewogICAgICAg\nICAgICByZXR1cm4gbmlvU2VydmVyRmFjdG9yeS5nZXRMb2NhbEFkZHJlc3Mo\nKTsKICAgICAgICB9CiAgICB9CgogICAgQFZpc2libGVGb3JUZXN0aW5nCiAg\nICBwdWJsaWMgQm9va2llIGdldEJvb2tpZSgpIHsKICAgICAgICByZXR1cm4g\nYm9va2llOwogICAgfQoKICAgIC8qKgogICAgICogU3VzcGVuZCBwcm9jZXNz\naW5nIG9mIHJlcXVlc3RzIGluIHRoZSBib29raWUgKGZvciB0ZXN0aW5nKQog\nICAgICovCiAgICBAVmlzaWJsZUZvclRlc3RpbmcKICAgIHB1YmxpYyB2b2lk\nIHN1c3BlbmRQcm9jZXNzaW5nKCkgewogICAgICAgIG5pb1NlcnZlckZhY3Rv\ncnkuc3VzcGVuZFByb2Nlc3NpbmcoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlc3VtZSBwcm9jZXNzaW5nIHJlcXVlc3RzIGluIHRoZSBib29raWUgKGZv\nciB0ZXN0aW5nKQogICAgICovCiAgICBAVmlzaWJsZUZvclRlc3RpbmcKICAg\nIHB1YmxpYyB2b2lkIHJlc3VtZVByb2Nlc3NpbmcoKSB7CiAgICAgICAgbmlv\nU2VydmVyRmFjdG9yeS5yZXN1bWVQcm9jZXNzaW5nKCk7CiAgICB9CgogICAg\ncHVibGljIHN5bmNocm9uaXplZCB2b2lkIHNodXRkb3duKCkgewogICAgICAg\nIGlmICghcnVubmluZykgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIG5pb1NlcnZlckZhY3Rvcnkuc2h1dGRvd24oKTsKICAgICAg\nICBleGl0Q29kZSA9IGJvb2tpZS5zaHV0ZG93bigpOwogICAgICAgIGlmIChp\nc0F1dG9SZWNvdmVyeURhZW1vbkVuYWJsZWQgJiYgdGhpcy5hdXRvUmVjb3Zl\ncnlNYWluICE9IG51bGwpIHsKICAgICAgICAgICAgdGhpcy5hdXRvUmVjb3Zl\ncnlNYWluLnNodXRkb3duKCk7CiAgICAgICAgfQogICAgICAgIHJ1bm5pbmcg\nPSBmYWxzZTsKCiAgICAgICAgLy8gdW5yZWdpc3RlciBKTVgKICAgICAgICB1\nbnJlZ2lzdGVySk1YKCk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgcmVn\naXN0ZXJKTVgoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgam14QmtT\nZXJ2ZXJCZWFuID0gbmV3IEJvb2tpZVNlcnZlckJlYW4oY29uZiwgdGhpcyk7\nCiAgICAgICAgICAgIEJLTUJlYW5SZWdpc3RyeS5nZXRJbnN0YW5jZSgpLnJl\nZ2lzdGVyKGpteEJrU2VydmVyQmVhbiwgbnVsbCk7CgogICAgICAgICAgICBi\nb29raWUucmVnaXN0ZXJKTVgoam14QmtTZXJ2ZXJCZWFuKTsKICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cud2Fybigi\nRmFpbGVkIHRvIHJlZ2lzdGVyIHdpdGggSk1YIiwgZSk7CiAgICAgICAgICAg\nIGpteEJrU2VydmVyQmVhbiA9IG51bGw7CiAgICAgICAgfQogICAgfQoKICAg\nIHByb3RlY3RlZCB2b2lkIHVucmVnaXN0ZXJKTVgoKSB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYm9va2llLnVucmVnaXN0ZXJKTVgoKTsKICAgICAg\nICAgICAgaWYgKGpteEJrU2VydmVyQmVhbiAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBCS01CZWFuUmVnaXN0cnkuZ2V0SW5zdGFuY2UoKS51bnJlZ2lz\ndGVyKGpteEJrU2VydmVyQmVhbik7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cud2Fybigi\nRmFpbGVkIHRvIHVucmVnaXN0ZXIgd2l0aCBKTVgiLCBlKTsKICAgICAgICB9\nCiAgICAgICAgam14QmtTZXJ2ZXJCZWFuID0gbnVsbDsKICAgIH0KCiAgICBw\ndWJsaWMgYm9vbGVhbiBpc1J1bm5pbmcoKSB7CiAgICAgICAgcmV0dXJuIGJv\nb2tpZS5pc1J1bm5pbmcoKSAmJiBuaW9TZXJ2ZXJGYWN0b3J5LmlzUnVubmlu\nZygpICYmIHJ1bm5pbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVy\nIGJvb2tpZSBpcyBydW5uaW5nPwogICAgICoKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiBib29raWUgaXMgcnVubmluZywgb3RoZXJ3aXNlIHJldHVybiBmYWxz\nZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Jvb2tpZVJ1bm5pbmco\nKSB7CiAgICAgICAgcmV0dXJuIGJvb2tpZS5pc1J1bm5pbmcoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFdoZXRoZXIgYXV0by1yZWNvdmVyeSBzZXJ2aWNl\nIHJ1bm5pbmcgd2l0aCBCb29raWU/CiAgICAgKgogICAgICogQHJldHVybiB0\ncnVlIGlmIGF1dG8tcmVjb3Zlcnkgc2VydmljZSBpcyBydW5uaW5nLCBvdGhl\ncndpc2UgcmV0dXJuIGZhbHNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFu\nIGlzQXV0b1JlY292ZXJ5UnVubmluZygpIHsKICAgICAgICByZXR1cm4gdGhp\ncy5hdXRvUmVjb3ZlcnlNYWluICE9IG51bGwKICAgICAgICAgICAgICAgICYm\nIHRoaXMuYXV0b1JlY292ZXJ5TWFpbi5pc0F1dG9SZWNvdmVyeVJ1bm5pbmco\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgbmlvIHNlcnZlciBp\ncyBydW5uaW5nPwogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBuaW8g\nc2VydmVyIGlzIHJ1bm5pbmcsIG90aGVyd2lzZSByZXR1cm4gZmFsc2UKICAg\nICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNOaW9TZXJ2ZXJSdW5uaW5nKCkg\newogICAgICAgIHJldHVybiBuaW9TZXJ2ZXJGYWN0b3J5LmlzUnVubmluZygp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGpvaW4oKSB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gewogICAgICAgIG5pb1NlcnZlckZhY3Rvcnkuam9p\nbigpOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0RXhpdENvZGUoKSB7CiAg\nICAgICAgcmV0dXJuIGV4aXRDb2RlOwogICAgfQoKICAgIC8qKgogICAgICog\nQSB0aHJlYWQgdG8gd2F0Y2ggd2hldGhlciBib29raWUgJiBuaW9zZXJ2ZXIg\naXMgc3RpbGwgYWxpdmUKICAgICAqLwogICAgY2xhc3MgRGVhdGhXYXRjaGVy\nIGV4dGVuZHMgVGhyZWFkIHsKCiAgICAgICAgZmluYWwgaW50IHdhdGNoSW50\nZXJ2YWw7CgogICAgICAgIERlYXRoV2F0Y2hlcihTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICAgICAgc3VwZXIoIkJvb2tpZURlYXRoV2F0\nY2hlci0iICsgY29uZi5nZXRCb29raWVQb3J0KCkpOwogICAgICAgICAgICB3\nYXRjaEludGVydmFsID0gY29uZi5nZXREZWF0aFdhdGNoSW50ZXJ2YWwoKTsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2\nb2lkIHJ1bigpIHsKICAgICAgICAgICAgd2hpbGUodHJ1ZSkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBUaHJlYWQuc2xl\nZXAod2F0Y2hJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAg\nIC8vIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGlmICghaXNCb29raWVSdW5uaW5nKCkKICAgICAgICAgICAgICAgICAg\nICAgICAgfHwgIWlzTmlvU2VydmVyUnVubmluZygpCiAgICAgICAgICAgICAg\nICAgICAgICAgIHx8IChpc0F1dG9SZWNvdmVyeURhZW1vbkVuYWJsZWQgJiYg\nIWlzQXV0b1JlY292ZXJ5UnVubmluZygpKSkgewogICAgICAgICAgICAgICAg\nICAgIHNodXRkb3duKCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgc3RhdGljIGZpbmFsIE9wdGlvbnMgYmtPcHRzID0gbmV3IE9wdGlv\nbnMoKTsKICAgIHN0YXRpYyB7CiAgICAgICAgYmtPcHRzLmFkZE9wdGlvbigi\nYyIsICJjb25mIiwgdHJ1ZSwgIkNvbmZpZ3VyYXRpb24gZm9yIEJvb2tpZSBT\nZXJ2ZXIiKTsKICAgICAgICBia09wdHMuYWRkT3B0aW9uKCJ3aXRoQXV0b1Jl\nY292ZXJ5IiwgZmFsc2UsCiAgICAgICAgICAgICAgICAiU3RhcnQgQXV0b3Jl\nY292ZXJ5IHNlcnZpY2UgQm9va2llIHNlcnZlciIpOwogICAgICAgIGJrT3B0\ncy5hZGRPcHRpb24oImgiLCAiaGVscCIsIGZhbHNlLCAiUHJpbnQgaGVscCBt\nZXNzYWdlIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcmludCB1c2FnZQog\nICAgICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHByaW50VXNhZ2UoKSB7\nCiAgICAgICAgSGVscEZvcm1hdHRlciBoZiA9IG5ldyBIZWxwRm9ybWF0dGVy\nKCk7CiAgICAgICAgaGYucHJpbnRIZWxwKCJCb29raWVTZXJ2ZXIgW29wdGlv\nbnNdXG5cdG9yXG4iCiAgICAgICAgICAgICAgICAgICArICJCb29raWVTZXJ2\nZXIgPGJvb2tpZV9wb3J0PiA8emtfc2VydmVycz4gPGpvdXJuYWxfZGlyPiA8\nbGVkZ2VyX2RpciBbbGVkZ2VyX2Rpcl0+IiwgYmtPcHRzKTsKICAgIH0KCiAg\nICBwcml2YXRlIHN0YXRpYyB2b2lkIGxvYWRDb25mRmlsZShTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYsIFN0cmluZyBjb25mRmlsZSkKICAgICAgICB0aHJv\nd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBjb25mLmxvYWRDb25mKG5ldyBGaWxlKGNvbmZGaWxlKS50\nb1VSSSgpLnRvVVJMKCkpOwogICAgICAgIH0gY2F0Y2ggKE1hbGZvcm1lZFVS\nTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQg\nbm90IG9wZW4gY29uZmlndXJhdGlvbiBmaWxlOiAiICsgY29uZkZpbGUsIGUp\nOwogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0\naW9uKCk7CiAgICAgICAgfSBjYXRjaCAoQ29uZmlndXJhdGlvbkV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiTWFsZm9ybWVkIGNvbmZp\nZ3VyYXRpb24gZmlsZTogIiArIGNvbmZGaWxlLCBlKTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAg\nIH0KICAgICAgICBMT0cuaW5mbygiVXNpbmcgY29uZmlndXJhdGlvbiBmaWxl\nICIgKyBjb25mRmlsZSk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBwYXJzZUFyZ3MoU3RyaW5nW10gYXJncykKICAg\nICAgICB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBCYXNpY1BhcnNlciBwYXJzZXIgPSBuZXcg\nQmFzaWNQYXJzZXIoKTsKICAgICAgICAgICAgQ29tbWFuZExpbmUgY21kTGlu\nZSA9IHBhcnNlci5wYXJzZShia09wdHMsIGFyZ3MpOwoKICAgICAgICAgICAg\naWYgKGNtZExpbmUuaGFzT3B0aW9uKCdoJykpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgU3Ry\naW5nW10gbGVmdEFyZ3MgPSBjbWRMaW5lLmdldEFyZ3MoKTsKCiAgICAgICAg\nICAgIGlmIChjbWRMaW5lLmhhc09wdGlvbignYycpKSB7CiAgICAgICAgICAg\nICAgICBpZiAobnVsbCAhPSBsZWZ0QXJncyAmJiBsZWZ0QXJncy5sZW5ndGgg\nPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgU3RyaW5nIGNvbmZGaWxlID0gY21kTGluZS5nZXRPcHRpb25W\nYWx1ZSgiYyIpOwogICAgICAgICAgICAgICAgbG9hZENvbmZGaWxlKGNvbmYs\nIGNvbmZGaWxlKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb25mOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBpZiAoY21kTGluZS5oYXNPcHRpb24o\nIndpdGhBdXRvUmVjb3ZlcnkiKSkgewogICAgICAgICAgICAgICAgY29uZi5z\nZXRBdXRvUmVjb3ZlcnlEYWVtb25FbmFibGVkKHRydWUpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBpZiAobGVmdEFyZ3MubGVuZ3RoIDwgNCkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBjb21tYW5k\nIGxpbmUgYXJndW1lbnRzIG92ZXJ3cml0ZSBzZXR0aW5ncyBpbiBjb25maWd1\ncmF0aW9uIGZpbGUKICAgICAgICAgICAgY29uZi5zZXRCb29raWVQb3J0KElu\ndGVnZXIucGFyc2VJbnQobGVmdEFyZ3NbMF0pKTsKICAgICAgICAgICAgY29u\nZi5zZXRaa1NlcnZlcnMobGVmdEFyZ3NbMV0pOwogICAgICAgICAgICBjb25m\nLnNldEpvdXJuYWxEaXJOYW1lKGxlZnRBcmdzWzJdKTsKICAgICAgICAgICAg\nU3RyaW5nW10gbGVkZ2VyRGlyTmFtZXMgPSBuZXcgU3RyaW5nW2xlZnRBcmdz\nLmxlbmd0aCAtIDNdOwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGxl\nZnRBcmdzLCAzLCBsZWRnZXJEaXJOYW1lcywgMCwgbGVkZ2VyRGlyTmFtZXMu\nbGVuZ3RoKTsKICAgICAgICAgICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhs\nZWRnZXJEaXJOYW1lcyk7CgogICAgICAgICAgICByZXR1cm4gY29uZjsKICAg\nICAgICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiRXJyb3IgcGFyc2luZyBjb21tYW5kIGxpbmUgYXJndW1l\nbnRzIDogIiwgZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQHBhcmFtIGFyZ3MKICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24K\nICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqLwog\nICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10gYXJncykgewog\nICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgY29uZiA9IHBhcnNlQXJncyhhcmdzKTsK\nICAgICAgICB9IGNhdGNoIChJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gaWFl\nKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgcGFyc2luZyBjb21t\nYW5kIGxpbmUgYXJndW1lbnRzIDogIiwgaWFlKTsKICAgICAgICAgICAgU3lz\ndGVtLmVyci5wcmludGxuKGlhZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAg\nICBwcmludFVzYWdlKCk7CiAgICAgICAgICAgIFN5c3RlbS5leGl0KEV4aXRD\nb2RlLklOVkFMSURfQ09ORik7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmdC\ndWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBTdHJp\nbmdbXSBsZWRnZXJEaXJOYW1lcyA9IGNvbmYuZ2V0TGVkZ2VyRGlyTmFtZXMo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlZGdlckRpck5hbWVz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpICE9IDApIHsKICAg\nICAgICAgICAgICAgIHNiLmFwcGVuZCgnLCcpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHNiLmFwcGVuZChsZWRnZXJEaXJOYW1lc1tpXSk7CiAgICAg\nICAgfQoKICAgICAgICBTdHJpbmcgaGVsbG8gPSBTdHJpbmcuZm9ybWF0KAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAiSGVsbG8sIEknbSB5b3VyIGJv\nb2tpZSwgbGlzdGVuaW5nIG9uIHBvcnQgJTEkcy4gWktTZXJ2ZXJzIGFyZSBv\nbiAlMiRzLiBKb3VybmFscyBhcmUgaW4gJTMkcy4gTGVkZ2VycyBhcmUgc3Rv\ncmVkIGluICU0JHMuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u\nZi5nZXRCb29raWVQb3J0KCksIGNvbmYuZ2V0WmtTZXJ2ZXJzKCksCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbmYuZ2V0Sm91cm5hbERpck5hbWUo\nKSwgc2IpOwogICAgICAgIExPRy5pbmZvKGhlbGxvKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBmaW5hbCBCb29raWVTZXJ2ZXIgYnMgPSBuZXcgQm9v\na2llU2VydmVyKGNvbmYpOwogICAgICAgICAgICBicy5zdGFydCgpOwogICAg\nICAgICAgICBSdW50aW1lLmdldFJ1bnRpbWUoKS5hZGRTaHV0ZG93bkhvb2so\nbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAg\nICAgICAgIGJzLnNodXRkb3duKCk7CiAgICAgICAgICAgICAgICAgICAgTE9H\nLmluZm8oIlNodXQgZG93biBib29raWUgc2VydmVyIHN1Y2Nlc3NmdWxseSIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAg\nICAgTE9HLmluZm8oIlJlZ2lzdGVyIHNodXRkb3duIGhvb2sgc3VjY2Vzc2Z1\nbGx5Iik7CiAgICAgICAgICAgIGJzLmpvaW4oKTsKCiAgICAgICAgICAgIFN5\nc3RlbS5leGl0KGJzLmdldEV4aXRDb2RlKCkpOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0\naW9uIHJ1bm5pbmcgYm9va2llIHNlcnZlciA6ICIsIGUpOwogICAgICAgICAg\nICBTeXN0ZW0uZXhpdChFeGl0Q29kZS5TRVJWRVJfRVhDRVBUSU9OKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcHJvY2Vzc1BhY2tldChC\neXRlQnVmZmVyIHBhY2tldCwgQ254biBzcmMpIHsKICAgICAgICBQYWNrZXRI\nZWFkZXIgaCA9IFBhY2tldEhlYWRlci5mcm9tSW50KHBhY2tldC5nZXRJbnQo\nKSk7CgogICAgICAgIGJvb2xlYW4gc3VjY2VzcyA9IGZhbHNlOwogICAgICAg\nIGludCBzdGF0VHlwZSA9IEJLU3RhdHMuU1RBVFNfVU5LTk9XTjsKICAgICAg\nICBsb25nIHN0YXJ0VGltZSA9IDA7CiAgICAgICAgaWYgKGlzU3RhdHNFbmFi\nbGVkKSB7CiAgICAgICAgICAgIHN0YXJ0VGltZSA9IE1hdGhVdGlscy5ub3co\nKTsKICAgICAgICB9CgogICAgICAgIC8vIHBhY2tldCBmb3JtYXQgaXMgZGlm\nZmVyZW50IGJldHdlZW4gQURERU5UUlkgYW5kIFJFQURFTlRSWQogICAgICAg\nIGxvbmcgbGVkZ2VySWQgPSAtMTsKICAgICAgICBsb25nIGVudHJ5SWQgPSBC\nb29raWVQcm90b2NvbC5JTlZBTElEX0VOVFJZX0lEOwogICAgICAgIGJ5dGVb\nXSBtYXN0ZXJLZXkgPSBudWxsOwogICAgICAgIHN3aXRjaCAoaC5nZXRPcENv\nZGUoKSkgewogICAgICAgIGNhc2UgQm9va2llUHJvdG9jb2wuQURERU5UUlk6\nCiAgICAgICAgICAgIC8vIGZpcnN0IHJlYWQgbWFzdGVyIGtleQogICAgICAg\nICAgICBtYXN0ZXJLZXkgPSBuZXcgYnl0ZVtCb29raWVQcm90b2NvbC5NQVNU\nRVJfS0VZX0xFTkdUSF07CiAgICAgICAgICAgIHBhY2tldC5nZXQobWFzdGVy\nS2V5LCAwLCBCb29raWVQcm90b2NvbC5NQVNURVJfS0VZX0xFTkdUSCk7CiAg\nICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBwYWNrZXQuZHVwbGljYXRlKCk7\nCiAgICAgICAgICAgIGxlZGdlcklkID0gYmIuZ2V0TG9uZygpOwogICAgICAg\nICAgICBlbnRyeUlkID0gYmIuZ2V0TG9uZygpOwogICAgICAgICAgICBicmVh\nazsKICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLlJFQURFTlRSWToKICAg\nICAgICAgICAgbGVkZ2VySWQgPSBwYWNrZXQuZ2V0TG9uZygpOwogICAgICAg\nICAgICBlbnRyeUlkID0gcGFja2V0LmdldExvbmcoKTsKICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAoaC5nZXRWZXJzaW9uKCkg\nPCBCb29raWVQcm90b2NvbC5MT1dFU1RfQ09NUEFUX1BST1RPQ09MX1ZFUlNJ\nT04KICAgICAgICAgICAgfHwgaC5nZXRWZXJzaW9uKCkgPiBCb29raWVQcm90\nb2NvbC5DVVJSRU5UX1BST1RPQ09MX1ZFUlNJT04pIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJJbnZhbGlkIHByb3RvY29sIHZlcnNpb24sIGV4cGVjdGVk\nIHNvbWV0aGluZyBiZXR3ZWVuICIKICAgICAgICAgICAgICAgICAgICAgICsg\nQm9va2llUHJvdG9jb2wuTE9XRVNUX0NPTVBBVF9QUk9UT0NPTF9WRVJTSU9O\nIAogICAgICAgICAgICAgICAgICAgICAgKyAiICYgIiArIEJvb2tpZVByb3Rv\nY29sLkNVUlJFTlRfUFJPVE9DT0xfVkVSU0lPTgogICAgICAgICAgICAgICAg\nICAgICsgIi4gZ290ICIgKyBoLmdldFZlcnNpb24oKSk7CiAgICAgICAgICAg\nIHNyYy5zZW5kUmVzcG9uc2UoYnVpbGRSZXNwb25zZShCb29raWVQcm90b2Nv\nbC5FQkFEVkVSU0lPTiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBoLmdldFZlcnNpb24oKSwgaC5nZXRPcENvZGUoKSwg\nbGVkZ2VySWQsIGVudHJ5SWQpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICBzaG9ydCBmbGFncyA9IGguZ2V0RmxhZ3MoKTsKICAg\nICAgICBzd2l0Y2ggKGguZ2V0T3BDb2RlKCkpIHsKICAgICAgICBjYXNlIEJv\nb2tpZVByb3RvY29sLkFEREVOVFJZOgogICAgICAgICAgICBzdGF0VHlwZSA9\nIEJLU3RhdHMuU1RBVFNfQUREOwoKICAgICAgICAgICAgaWYgKGJvb2tpZS5p\nc1JlYWRPbmx5KCkpIHsKICAgICAgICAgICAgICAgIExPRy53YXJuKCJCb29r\naWVTZXJ2ZXIgaXMgcnVubmluZyBhcyByZWFkb25seSBtb2RlLCIKICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiIHNvIHJlamVjdGluZyB0aGUgcmVxdWVz\ndCBmcm9tIHRoZSBjbGllbnQhIik7CiAgICAgICAgICAgICAgICBzcmMuc2Vu\nZFJlc3BvbnNlKGJ1aWxkUmVzcG9uc2UoQm9va2llUHJvdG9jb2wuRVJFQURP\nTkxZLAogICAgICAgICAgICAgICAgICAgICAgICBoLmdldFZlcnNpb24oKSwg\naC5nZXRPcENvZGUoKSwgbGVkZ2VySWQsIGVudHJ5SWQpKTsKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgVGltZWRDbnhuIHRzcmMgPSBuZXcgVGltZWRD\nbnhuKHNyYywgc3RhcnRUaW1lKTsKICAgICAgICAgICAgICAgIGlmICgoZmxh\nZ3MgJiBCb29raWVQcm90b2NvbC5GTEFHX1JFQ09WRVJZX0FERCkgPT0gQm9v\na2llUHJvdG9jb2wuRkxBR19SRUNPVkVSWV9BREQpIHsKICAgICAgICAgICAg\nICAgICAgICBib29raWUucmVjb3ZlcnlBZGRFbnRyeShwYWNrZXQuc2xpY2Uo\nKSwgdGhpcywgdHNyYywgbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYm9va2llLmFkZEVudHJ5KHBh\nY2tldC5zbGljZSgpLCB0aGlzLCB0c3JjLCBtYXN0ZXJLZXkpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgc3VjY2VzcyA9IHRydWU7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRXJyb3Igd3JpdGluZyAiICsgZW50cnlJZCAr\nICJAIiArIGxlZGdlcklkLCBlKTsKICAgICAgICAgICAgICAgIHNyYy5zZW5k\nUmVzcG9uc2UoYnVpbGRSZXNwb25zZShCb29raWVQcm90b2NvbC5FSU8sIGgu\nZ2V0VmVyc2lvbigpLCBoLmdldE9wQ29kZSgpLCBsZWRnZXJJZCwgZW50cnlJ\nZCkpOwogICAgICAgICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24uTGVk\nZ2VyRmVuY2VkRXhjZXB0aW9uIGxmZSkgewogICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJBdHRlbXB0IHRvIHdyaXRlIHRvIGZlbmNlZCBsZWRnZXIiLCBs\nZmUpOwogICAgICAgICAgICAgICAgc3JjLnNlbmRSZXNwb25zZShidWlsZFJl\nc3BvbnNlKEJvb2tpZVByb3RvY29sLkVGRU5DRUQsIGguZ2V0VmVyc2lvbigp\nLCBoLmdldE9wQ29kZSgpLCBsZWRnZXJJZCwgZW50cnlJZCkpOwogICAgICAg\nICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJVbmF1dGhvcml6ZWQgYWNjZXNzIHRvIGxlZGdl\nciAiICsgbGVkZ2VySWQsIGUpOwogICAgICAgICAgICAgICAgc3JjLnNlbmRS\nZXNwb25zZShidWlsZFJlc3BvbnNlKEJvb2tpZVByb3RvY29sLkVVQSwgaC5n\nZXRWZXJzaW9uKCksIGguZ2V0T3BDb2RlKCksIGxlZGdlcklkLCBlbnRyeUlk\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nY2FzZSBCb29raWVQcm90b2NvbC5SRUFERU5UUlk6CiAgICAgICAgICAgIHN0\nYXRUeXBlID0gQktTdGF0cy5TVEFUU19SRUFEOwogICAgICAgICAgICBCeXRl\nQnVmZmVyW10gcnNwID0gbmV3IEJ5dGVCdWZmZXJbMl07CiAgICAgICAgICAg\nIExPRy5kZWJ1ZygiUmVjZWl2ZWQgbmV3IHJlYWQgcmVxdWVzdDoge30sIHt9\nIiwgbGVkZ2VySWQsIGVudHJ5SWQpOwogICAgICAgICAgICBpbnQgZXJyb3JD\nb2RlID0gQm9va2llUHJvdG9jb2wuRUlPOwogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgRnV0dXJlPEJvb2xlYW4+IGZlbmNlUmVzdWx0ID0g\nbnVsbDsKICAgICAgICAgICAgICAgIGlmICgoZmxhZ3MgJiBCb29raWVQcm90\nb2NvbC5GTEFHX0RPX0ZFTkNJTkcpID09IEJvb2tpZVByb3RvY29sLkZMQUdf\nRE9fRkVOQ0lORykgewogICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJM\nZWRnZXIgIiArIGxlZGdlcklkICsgIiBmZW5jZWQgYnkgIiArIHNyYy5nZXRQ\nZWVyTmFtZSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaC5nZXRWZXJz\naW9uKCkgPj0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBtYXN0ZXJL\nZXkgPSBuZXcgYnl0ZVtCb29raWVQcm90b2NvbC5NQVNURVJfS0VZX0xFTkdU\nSF07CiAgICAgICAgICAgICAgICAgICAgICAgIHBhY2tldC5nZXQobWFzdGVy\nS2V5LCAwLCBCb29raWVQcm90b2NvbC5NQVNURVJfS0VZX0xFTkdUSCk7Cgog\nICAgICAgICAgICAgICAgICAgICAgICBmZW5jZVJlc3VsdCA9IGJvb2tpZS5m\nZW5jZUxlZGdlcihsZWRnZXJJZCwgbWFzdGVyS2V5KTsKICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cu\nZXJyb3IoIlBhc3N3b3JkIG5vdCBwcm92aWRlZCwgTm90IHNhZmUgdG8gZmVu\nY2Uge30iLCBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93IEJvb2tpZUV4Y2VwdGlvbi5jcmVhdGUoQm9va2llRXhjZXB0aW9uLkNv\nZGUuVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9uKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nc3BbMV0gPSBib29raWUucmVhZEVudHJ5KGxlZGdlcklkLCBlbnRyeUlkKTsK\nICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiIyMjIyMgUmVhZCBlbnRyeSAj\nIyMjIyB7fSIsIHJzcFsxXS5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgICAg\nICBpZiAobnVsbCAhPSBmZW5jZVJlc3VsdCkgewogICAgICAgICAgICAgICAg\nICAgIC8vIFRPRE86CiAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudGx5\nIHdlIGRvbid0IGhhdmUgcmVhZENhbGxiYWNrIHRvIHJ1biBpbiBzZXBhcmF0\nZWQgcmVhZAogICAgICAgICAgICAgICAgICAgIC8vIHRocmVhZHMuIGFmdGVy\nIEJPT0tLRUVQRVItNDI5IGlzIGNvbXBsZXRlLCB3ZSBjb3VsZCBpbXByb3Zl\nCiAgICAgICAgICAgICAgICAgICAgLy8gZm9sbG93aW5nIGNvZGUgdG8gbWFr\nZSBpdCBub3Qgd2FpdCBoZXJlCiAgICAgICAgICAgICAgICAgICAgLy8KICAg\nICAgICAgICAgICAgICAgICAvLyBGb3Igbm93LCBzaW5jZSB3ZSBvbmx5IHRy\neSB0byB3YWl0IGFmdGVyIHJlYWQgZW50cnkuIHNvIHdyaXRpbmcKICAgICAg\nICAgICAgICAgICAgICAvLyB0byBqb3VybmFsIGFuZCByZWFkIGVudHJ5IGFy\nZSBleGVjdXRlZCBpbiBkaWZmZXJlbnQgdGhyZWFkCiAgICAgICAgICAgICAg\nICAgICAgLy8gaXQgd291bGQgYmUgZmluZS4KICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBCb29sZWFuIGZlbmNl\nZCA9IGZlbmNlUmVzdWx0LmdldCgxMDAwLCBUaW1lVW5pdC5NSUxMSVNFQ09O\nRFMpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBmZW5j\nZWQgfHwgIWZlbmNlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gaWYgZmFpbGVkIHRvIGZlbmNlLCBmYWlsIHRoZSByZWFkIHJlcXVlc3Qg\ndG8gbWFrZSBpdCByZXRyeS4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGVycm9yQ29kZSA9IEJvb2tpZVByb3RvY29sLkVJTzsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJzcFsxXSA9IG51bGw7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBlcnJvckNvZGUgPSBCb29raWVQcm90b2NvbC5FT0s7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBzdWNjZXNzID0gdHJ1ZTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElu\ndGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiSW50ZXJydXB0aW5nIGZlbmNlIHJlYWQgZW50cnkg\nKGxpZDoiICsgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIiwgZWlkOiIgKyBlbnRyeUlkICsgIikgOiIsIGllKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZXJyb3JDb2RlID0gQm9va2llUHJvdG9j\nb2wuRUlPOwogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gZmFs\nc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHJzcFsxXSA9IG51bGw7CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhlY3V0aW9uRXhjZXB0aW9u\nIGVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRmFp\nbGVkIHRvIGZlbmNlIHJlYWQgZW50cnkgKGxpZDoiICsgbGVkZ2VySWQKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiwgZWlkOiIgKyBl\nbnRyeUlkICsgIikgOiIsIGVlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nZXJyb3JDb2RlID0gQm9va2llUHJvdG9jb2wuRUlPOwogICAgICAgICAgICAg\nICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJzcFsxXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoVGltZW91dEV4Y2VwdGlvbiB0ZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIlRpbWVvdXQgdG8gZmVuY2UgcmVhZCBlbnRy\neSAobGlkOiIgKyBsZWRnZXJJZAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiLCBlaWQ6IiArIGVudHJ5SWQgKyAiKSA6IiwgdGUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNvZGUgPSBCb29raWVQcm90\nb2NvbC5FSU87CiAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBm\nYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgcnNwWzFdID0gbnVsbDsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIGVycm9yQ29kZSA9IEJvb2tpZVByb3Rv\nY29sLkVPSzsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoQm9va2ll\nLk5vTGVkZ2VyRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChM\nT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiRXJyb3IgcmVhZGluZyAiICsgZW50cnlJZCArICJAIiArIGxl\nZGdlcklkLCBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGVycm9yQ29kZSA9IEJvb2tpZVByb3RvY29sLkVOT0xFREdFUjsKICAgICAg\nICAgICAgfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgaWYgKExPRy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciByZWFkaW5nICIg\nKyBlbnRyeUlkICsgIkAiICsgbGVkZ2VySWQsIGUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZXJyb3JDb2RlID0gQm9va2llUHJvdG9j\nb2wuRU5PRU5UUlk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgcmVh\nZGluZyAiICsgZW50cnlJZCArICJAIiArIGxlZGdlcklkLCBlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVycm9yQ29kZSA9IEJvb2tp\nZVByb3RvY29sLkVJTzsKICAgICAgICAgICAgfSBjYXRjaCAoQm9va2llRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiVW5hdXRo\nb3JpemVkIGFjY2VzcyB0byBsZWRnZXIgIiArIGxlZGdlcklkLCBlKTsKICAg\nICAgICAgICAgICAgIGVycm9yQ29kZSA9IEJvb2tpZVByb3RvY29sLkVVQTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByc3BbMF0gPSBidWlsZFJlc3Bv\nbnNlKGVycm9yQ29kZSwgaC5nZXRWZXJzaW9uKCksIGguZ2V0T3BDb2RlKCks\nIGxlZGdlcklkLCBlbnRyeUlkKTsKCiAgICAgICAgICAgIGlmIChMT0cuaXNU\ncmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgTE9HLnRyYWNlKCJS\nZWFkIGVudHJ5IHJjID0gIiArIGVycm9yQ29kZSArICIgZm9yICIgKyBlbnRy\neUlkICsgIkAiICsgbGVkZ2VySWQpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChyc3BbMV0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8g\nV2UgaGF2ZW4ndCBmaWxsZWQgaW4gZW50cnkgZGF0YSwgc28gd2UgaGF2ZSB0\nbyBzZW5kIGJhY2sKICAgICAgICAgICAgICAgIC8vIHRoZSBsZWRnZXIgYW5k\nIGVudHJ5IGlkcyBoZXJlCiAgICAgICAgICAgICAgICByc3BbMV0gPSBCeXRl\nQnVmZmVyLmFsbG9jYXRlKDE2KTsKICAgICAgICAgICAgICAgIHJzcFsxXS5w\ndXRMb25nKGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIHJzcFsxXS5wdXRM\nb25nKGVudHJ5SWQpOwogICAgICAgICAgICAgICAgcnNwWzFdLmZsaXAoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoTE9HLmlzVHJhY2VFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgICAgIGJ5dGVbXSBjb250ZW50ID0gbmV3\nIGJ5dGVbcnNwWzFdLnJlbWFpbmluZygpXTsKICAgICAgICAgICAgICAgIHJz\ncFsxXS5kdXBsaWNhdGUoKS5nZXQoY29udGVudCk7CiAgICAgICAgICAgICAg\nICBMT0cudHJhY2UoIlNlbmRpbmcgcmVzcG9uc2UgZm9yOiB7fSwgY29udGVu\ndDoge30iLCBlbnRyeUlkLCBIZXguZW5jb2RlSGV4U3RyaW5nKGNvbnRlbnQp\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExPRy5k\nZWJ1ZygiU2VuZGluZyByZXNwb25zZSBmb3I6IHt9LCBsZW5ndGg6IHt9Iiwg\nZW50cnlJZCwgcnNwWzFdLnJlbWFpbmluZygpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzcmMuc2VuZFJlc3BvbnNlKHJzcCk7CiAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHNyYy5zZW5k\nUmVzcG9uc2UoYnVpbGRSZXNwb25zZShCb29raWVQcm90b2NvbC5FQkFEUkVR\nLCBoLmdldFZlcnNpb24oKSwgaC5nZXRPcENvZGUoKSwgbGVkZ2VySWQsIGVu\ndHJ5SWQpKTsKICAgICAgICB9CiAgICAgICAgaWYgKGlzU3RhdHNFbmFibGVk\nKSB7CiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgICAg\nICAvLyBmb3IgYWRkIG9wZXJhdGlvbnMsIHdlIGNvbXB1dGUgbGF0ZW5jeSBp\nbiB3cml0ZUNvbXBsZXRlIGNhbGxiYWNrcy4KICAgICAgICAgICAgICAgIGlm\nIChzdGF0VHlwZSAhPSBCS1N0YXRzLlNUQVRTX0FERCkgewogICAgICAgICAg\nICAgICAgICAgIGxvbmcgZWxhcHNlZFRpbWUgPSBNYXRoVXRpbHMubm93KCkg\nLSBzdGFydFRpbWU7CiAgICAgICAgICAgICAgICAgICAgYmtTdGF0cy5nZXRP\ncFN0YXRzKHN0YXRUeXBlKS51cGRhdGVMYXRlbmN5KGVsYXBzZWRUaW1lKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIGJrU3RhdHMuZ2V0T3BTdGF0cyhzdGF0VHlwZSkuaW5jcmVt\nZW50RmFpbGVkT3BzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHJpdmF0ZSBCeXRlQnVmZmVyIGJ1aWxkUmVzcG9uc2UoaW50IGVy\ncm9yQ29kZSwgYnl0ZSB2ZXJzaW9uLCBieXRlIG9wQ29kZSwgbG9uZyBsZWRn\nZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgQnl0ZUJ1ZmZlciByc3Ag\nPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDI0KTsKICAgICAgICByc3AucHV0SW50\nKG5ldyBQYWNrZXRIZWFkZXIodmVyc2lvbiwgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG9wQ29kZSwgKHNob3J0KTApLnRvSW50KCkp\nOwogICAgICAgIHJzcC5wdXRJbnQoZXJyb3JDb2RlKTsKICAgICAgICByc3Au\ncHV0TG9uZyhsZWRnZXJJZCk7CiAgICAgICAgcnNwLnB1dExvbmcoZW50cnlJ\nZCk7CgogICAgICAgIHJzcC5mbGlwKCk7CiAgICAgICAgcmV0dXJuIHJzcDsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB3cml0ZUNvbXBsZXRlKGludCByYywg\nbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLCBJbmV0U29ja2V0QWRkcmVz\ncyBhZGRyLCBPYmplY3QgY3R4KSB7CiAgICAgICAgVGltZWRDbnhuIHRjbnhu\nID0gKFRpbWVkQ254bikgY3R4OwogICAgICAgIENueG4gc3JjID0gdGNueG4u\nY254bjsKICAgICAgICBsb25nIHN0YXJ0VGltZSA9IHRjbnhuLnRpbWU7CiAg\nICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMjQp\nOwogICAgICAgIGJiLnB1dEludChuZXcgUGFja2V0SGVhZGVyKEJvb2tpZVBy\nb3RvY29sLkNVUlJFTlRfUFJPVE9DT0xfVkVSU0lPTiwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgQm9va2llUHJvdG9jb2wuQURERU5U\nUlksIChzaG9ydCkwKS50b0ludCgpKTsKICAgICAgICBiYi5wdXRJbnQocmMp\nOwogICAgICAgIGJiLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgIGJiLnB1\ndExvbmcoZW50cnlJZCk7CiAgICAgICAgYmIuZmxpcCgpOwogICAgICAgIGlm\nIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cudHJh\nY2UoIkFkZCBlbnRyeSByYyA9ICIgKyByYyArICIgZm9yICIgKyBlbnRyeUlk\nICsgIkAiICsgbGVkZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzcmMuc2Vu\nZFJlc3BvbnNlKG5ldyBCeXRlQnVmZmVyW10geyBiYiB9KTsKICAgICAgICBp\nZiAoaXNTdGF0c0VuYWJsZWQpIHsKICAgICAgICAgICAgLy8gY29tcHV0ZSB0\naGUgbGF0ZW5jeQogICAgICAgICAgICBpZiAoMCA9PSByYykgewogICAgICAg\nICAgICAgICAgLy8gZm9yIGFkZCBvcGVyYXRpb25zLCB3ZSBjb21wdXRlIGxh\ndGVuY3kgaW4gd3JpdGVDb21wbGV0ZSBjYWxsYmFja3MuCiAgICAgICAgICAg\nICAgICBsb25nIGVsYXBzZWRUaW1lID0gTWF0aFV0aWxzLm5vdygpIC0gc3Rh\ncnRUaW1lOwogICAgICAgICAgICAgICAgYmtTdGF0cy5nZXRPcFN0YXRzKEJL\nU3RhdHMuU1RBVFNfQUREKS51cGRhdGVMYXRlbmN5KGVsYXBzZWRUaW1lKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJrU3RhdHMu\nZ2V0T3BTdGF0cyhCS1N0YXRzLlNUQVRTX0FERCkuaW5jcmVtZW50RmFpbGVk\nT3BzKCk7ICAgICAgICAgICAgICAgIAogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQSBjbnhuIHdyYXBwZXIgZm9yIHRp\nbWUKICAgICAqLwogICAgc3RhdGljIGNsYXNzIFRpbWVkQ254biB7CiAgICAg\nICAgQ254biBjbnhuOwogICAgICAgIGxvbmcgdGltZTsKCiAgICAgICAgcHVi\nbGljIFRpbWVkQ254bihDbnhuIGNueG4sIGxvbmcgc3RhcnRUaW1lKSB7CiAg\nICAgICAgICAgIHRoaXMuY254biA9IGNueG47CiAgICAgICAgICAgIHRoaXMu\ndGltZSA9IHN0YXJ0VGltZTsKICAgICAgICB9CiAgICB9Cgp9Cg==\n","encoding":"base64"}

