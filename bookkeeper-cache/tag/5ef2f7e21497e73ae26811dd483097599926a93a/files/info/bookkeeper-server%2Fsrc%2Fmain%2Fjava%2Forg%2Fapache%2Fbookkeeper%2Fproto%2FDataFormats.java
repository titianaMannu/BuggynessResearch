{"sha":"65d5444d10dfd2d372872137bdf8f01dcc6de05d","node_id":"MDQ6QmxvYjE1NzU5NTY6NjVkNTQ0NGQxMGRmZDJkMzcyODcyMTM3YmRmOGYwMWRjYzZkZTA1ZA==","size":152125,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/65d5444d10dfd2d372872137bdf8f01dcc6de05d","content":"Ly8gR2VuZXJhdGVkIGJ5IHRoZSBwcm90b2NvbCBidWZmZXIgY29tcGlsZXIu\nICBETyBOT1QgRURJVCEKLy8gc291cmNlOiBzcmMvbWFpbi9wcm90by9EYXRh\nRm9ybWF0cy5wcm90bwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG87CgpwdWJsaWMgZmluYWwgY2xhc3MgRGF0YUZvcm1hdHMgewogIHBy\naXZhdGUgRGF0YUZvcm1hdHMoKSB7fQogIHB1YmxpYyBzdGF0aWMgdm9pZCBy\nZWdpc3RlckFsbEV4dGVuc2lvbnMoCiAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnkgcmVnaXN0cnkpIHsKICB9CiAgcHVibGlj\nIGludGVyZmFjZSBMZWRnZXJNZXRhZGF0YUZvcm1hdE9yQnVpbGRlcgogICAg\nICBleHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRl\nciB7CiAgICAKICAgIC8vIHJlcXVpcmVkIGludDMyIHF1b3J1bVNpemUgPSAx\nOwogICAgYm9vbGVhbiBoYXNRdW9ydW1TaXplKCk7CiAgICBpbnQgZ2V0UXVv\ncnVtU2l6ZSgpOwogICAgCiAgICAvLyByZXF1aXJlZCBpbnQzMiBlbnNlbWJs\nZVNpemUgPSAyOwogICAgYm9vbGVhbiBoYXNFbnNlbWJsZVNpemUoKTsKICAg\nIGludCBnZXRFbnNlbWJsZVNpemUoKTsKICAgIAogICAgLy8gcmVxdWlyZWQg\naW50NjQgbGVuZ3RoID0gMzsKICAgIGJvb2xlYW4gaGFzTGVuZ3RoKCk7CiAg\nICBsb25nIGdldExlbmd0aCgpOwogICAgCiAgICAvLyBvcHRpb25hbCBpbnQ2\nNCBsYXN0RW50cnlJZCA9IDQ7CiAgICBib29sZWFuIGhhc0xhc3RFbnRyeUlk\nKCk7CiAgICBsb25nIGdldExhc3RFbnRyeUlkKCk7CiAgICAKICAgIC8vIHJl\ncXVpcmVkIC5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSBzdGF0ZSA9IDUg\nW2RlZmF1bHQgPSBPUEVOXTsKICAgIGJvb2xlYW4gaGFzU3RhdGUoKTsKICAg\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRn\nZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSBnZXRTdGF0ZSgpOwogICAgCiAgICAv\nLyByZXBlYXRlZCAuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCBzZWdt\nZW50ID0gNjsKICAgIGphdmEudXRpbC5MaXN0PG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5T\nZWdtZW50PiAKICAgICAgICBnZXRTZWdtZW50TGlzdCgpOwogICAgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFk\nYXRhRm9ybWF0LlNlZ21lbnQgZ2V0U2VnbWVudChpbnQgaW5kZXgpOwogICAg\naW50IGdldFNlZ21lbnRDb3VudCgpOwogICAgamF2YS51dGlsLkxpc3Q8PyBl\neHRlbmRzIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50T3JCdWlsZGVyPiAKICAg\nICAgICBnZXRTZWdtZW50T3JCdWlsZGVyTGlzdCgpOwogICAgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRh\nRm9ybWF0LlNlZ21lbnRPckJ1aWxkZXIgZ2V0U2VnbWVudE9yQnVpbGRlcigK\nICAgICAgICBpbnQgaW5kZXgpOwogICAgCiAgICAvLyBvcHRpb25hbCAuTGVk\nZ2VyTWV0YWRhdGFGb3JtYXQuRGlnZXN0VHlwZSBkaWdlc3RUeXBlID0gNzsK\nICAgIGJvb2xlYW4gaGFzRGlnZXN0VHlwZSgpOwogICAgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9y\nbWF0LkRpZ2VzdFR5cGUgZ2V0RGlnZXN0VHlwZSgpOwogICAgCiAgICAvLyBv\ncHRpb25hbCBieXRlcyBwYXNzd29yZCA9IDg7CiAgICBib29sZWFuIGhhc1Bh\nc3N3b3JkKCk7CiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nZ2V0UGFzc3dvcmQoKTsKICAgIAogICAgLy8gb3B0aW9uYWwgaW50MzIgYWNr\nUXVvcnVtU2l6ZSA9IDk7CiAgICBib29sZWFuIGhhc0Fja1F1b3J1bVNpemUo\nKTsKICAgIGludCBnZXRBY2tRdW9ydW1TaXplKCk7CiAgfQogIHB1YmxpYyBz\ndGF0aWMgZmluYWwgY2xhc3MgTGVkZ2VyTWV0YWRhdGFGb3JtYXQgZXh0ZW5k\ncwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UK\nICAgICAgaW1wbGVtZW50cyBMZWRnZXJNZXRhZGF0YUZvcm1hdE9yQnVpbGRl\nciB7CiAgICAvLyBVc2UgTGVkZ2VyTWV0YWRhdGFGb3JtYXQubmV3QnVpbGRl\ncigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgTGVkZ2VyTWV0YWRhdGFG\nb3JtYXQoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIp\nOwogICAgfQogICAgcHJpdmF0ZSBMZWRnZXJNZXRhZGF0YUZvcm1hdChib29s\nZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nTGVkZ2VyTWV0YWRhdGFGb3JtYXQgZGVmYXVsdEluc3RhbmNlOwogICAgcHVi\nbGljIHN0YXRpYyBMZWRnZXJNZXRhZGF0YUZvcm1hdCBnZXREZWZhdWx0SW5z\ndGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBMZWRnZXJNZXRhZGF0YUZvcm1hdCBnZXREZWZh\ndWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdElu\nc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxfc3RhdGlj\nX0xlZGdlck1ldGFkYXRhRm9ybWF0X2Rlc2NyaXB0b3I7CiAgICB9CiAgICAK\nICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRG\naWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxfc3RhdGlj\nX0xlZGdlck1ldGFkYXRhRm9ybWF0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nIH0KICAgIAogICAgcHVibGljIGVudW0gU3RhdGUKICAgICAgICBpbXBsZW1l\nbnRzIGNvbS5nb29nbGUucHJvdG9idWYuUHJvdG9jb2xNZXNzYWdlRW51bSB7\nCiAgICAgIE9QRU4oMCwgMSksCiAgICAgIElOX1JFQ09WRVJZKDEsIDIpLAog\nICAgICBDTE9TRUQoMiwgMyksCiAgICAgIDsKICAgICAgCiAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IE9QRU5fVkFMVUUgPSAxOwogICAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBJTl9SRUNPVkVSWV9WQUxVRSA9IDI7CiAg\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENMT1NFRF9WQUxVRSA9IDM7\nCiAgICAgIAogICAgICAKICAgICAgcHVibGljIGZpbmFsIGludCBnZXROdW1i\nZXIoKSB7IHJldHVybiB2YWx1ZTsgfQogICAgICAKICAgICAgcHVibGljIHN0\nYXRpYyBTdGF0ZSB2YWx1ZU9mKGludCB2YWx1ZSkgewogICAgICAgIHN3aXRj\naCAodmFsdWUpIHsKICAgICAgICAgIGNhc2UgMTogcmV0dXJuIE9QRU47CiAg\nICAgICAgICBjYXNlIDI6IHJldHVybiBJTl9SRUNPVkVSWTsKICAgICAgICAg\nIGNhc2UgMzogcmV0dXJuIENMT1NFRDsKICAgICAgICAgIGRlZmF1bHQ6IHJl\ndHVybiBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1M\naXRlTWFwPFN0YXRlPgogICAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgp\nIHsKICAgICAgICByZXR1cm4gaW50ZXJuYWxWYWx1ZU1hcDsKICAgICAgfQog\nICAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVy\nbmFsLkVudW1MaXRlTWFwPFN0YXRlPgogICAgICAgICAgaW50ZXJuYWxWYWx1\nZU1hcCA9CiAgICAgICAgICAgIG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndGVybmFsLkVudW1MaXRlTWFwPFN0YXRlPigpIHsKICAgICAgICAgICAgICBw\ndWJsaWMgU3RhdGUgZmluZFZhbHVlQnlOdW1iZXIoaW50IG51bWJlcikgewog\nICAgICAgICAgICAgICAgcmV0dXJuIFN0YXRlLnZhbHVlT2YobnVtYmVyKTsK\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgIAogICAgICBw\ndWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5F\nbnVtVmFsdWVEZXNjcmlwdG9yCiAgICAgICAgICBnZXRWYWx1ZURlc2NyaXB0\nb3IoKSB7CiAgICAgICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKS5nZXRWYWx1\nZXMoKS5nZXQoaW5kZXgpOwogICAgICB9CiAgICAgIHB1YmxpYyBmaW5hbCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1EZXNjcmlwdG9y\nCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gZ2V0RGVzY3JpcHRvcigpOwogICAgICB9CiAgICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5F\nbnVtRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAg\nICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LmdldERlc2NyaXB0b3IoKS5n\nZXRFbnVtVHlwZXMoKS5nZXQoMCk7CiAgICAgIH0KICAgICAgCiAgICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIFN0YXRlW10gVkFMVUVTID0gewogICAgICAg\nIE9QRU4sIElOX1JFQ09WRVJZLCBDTE9TRUQsIAogICAgICB9OwogICAgICAK\nICAgICAgcHVibGljIHN0YXRpYyBTdGF0ZSB2YWx1ZU9mKAogICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNj\ncmlwdG9yIGRlc2MpIHsKICAgICAgICBpZiAoZGVzYy5nZXRUeXBlKCkgIT0g\nZ2V0RGVzY3JpcHRvcigpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgamF2YS5s\nYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigKICAgICAgICAgICAgIkVu\ndW1WYWx1ZURlc2NyaXB0b3IgaXMgbm90IGZvciB0aGlzIHR5cGUuIik7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBWQUxVRVNbZGVzYy5nZXRJbmRleCgp\nXTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgaW5k\nZXg7CiAgICAgIHByaXZhdGUgZmluYWwgaW50IHZhbHVlOwogICAgICAKICAg\nICAgcHJpdmF0ZSBTdGF0ZShpbnQgaW5kZXgsIGludCB2YWx1ZSkgewogICAg\nICAgIHRoaXMuaW5kZXggPSBpbmRleDsKICAgICAgICB0aGlzLnZhbHVlID0g\ndmFsdWU7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2Vy\ndGlvbl9wb2ludChlbnVtX3Njb3BlOkxlZGdlck1ldGFkYXRhRm9ybWF0LlN0\nYXRlKQogICAgfQogICAgCiAgICBwdWJsaWMgZW51bSBEaWdlc3RUeXBlCiAg\nICAgICAgaW1wbGVtZW50cyBjb20uZ29vZ2xlLnByb3RvYnVmLlByb3RvY29s\nTWVzc2FnZUVudW0gewogICAgICBDUkMzMigwLCAxKSwKICAgICAgSE1BQygx\nLCAyKSwKICAgICAgOwogICAgICAKICAgICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgQ1JDMzJfVkFMVUUgPSAxOwogICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBITUFDX1ZBTFVFID0gMjsKICAgICAgCiAgICAgIAogICAgICBw\ndWJsaWMgZmluYWwgaW50IGdldE51bWJlcigpIHsgcmV0dXJuIHZhbHVlOyB9\nCiAgICAgIAogICAgICBwdWJsaWMgc3RhdGljIERpZ2VzdFR5cGUgdmFsdWVP\nZihpbnQgdmFsdWUpIHsKICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAg\nICAgICBjYXNlIDE6IHJldHVybiBDUkMzMjsKICAgICAgICAgIGNhc2UgMjog\ncmV0dXJuIEhNQUM7CiAgICAgICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDsK\nICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBzdGF0aWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxEaWdl\nc3RUeXBlPgogICAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgpIHsKICAg\nICAgICByZXR1cm4gaW50ZXJuYWxWYWx1ZU1hcDsKICAgICAgfQogICAgICBw\ncml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVu\ndW1MaXRlTWFwPERpZ2VzdFR5cGU+CiAgICAgICAgICBpbnRlcm5hbFZhbHVl\nTWFwID0KICAgICAgICAgICAgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuSW50\nZXJuYWwuRW51bUxpdGVNYXA8RGlnZXN0VHlwZT4oKSB7CiAgICAgICAgICAg\nICAgcHVibGljIERpZ2VzdFR5cGUgZmluZFZhbHVlQnlOdW1iZXIoaW50IG51\nbWJlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIERpZ2VzdFR5cGUudmFs\ndWVPZihudW1iZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsK\nICAgICAgCiAgICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVm\nLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3IKICAgICAgICAgIGdl\ndFZhbHVlRGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gZ2V0RGVzY3Jp\ncHRvcigpLmdldFZhbHVlcygpLmdldChpbmRleCk7CiAgICAgIH0KICAgICAg\ncHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMu\nRW51bURlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBl\nKCkgewogICAgICAgIHJldHVybiBnZXREZXNjcmlwdG9yKCk7CiAgICAgIH0K\nICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVm\nLkRlc2NyaXB0b3JzLkVudW1EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNj\ncmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuZ2V0\nRGVzY3JpcHRvcigpLmdldEVudW1UeXBlcygpLmdldCgxKTsKICAgICAgfQog\nICAgICAKICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgRGlnZXN0VHlwZVtd\nIFZBTFVFUyA9IHsKICAgICAgICBDUkMzMiwgSE1BQywgCiAgICAgIH07CiAg\nICAgIAogICAgICBwdWJsaWMgc3RhdGljIERpZ2VzdFR5cGUgdmFsdWVPZigK\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51\nbVZhbHVlRGVzY3JpcHRvciBkZXNjKSB7CiAgICAgICAgaWYgKGRlc2MuZ2V0\nVHlwZSgpICE9IGdldERlc2NyaXB0b3IoKSkgewogICAgICAgICAgdGhyb3cg\nbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oCiAgICAg\nICAgICAgICJFbnVtVmFsdWVEZXNjcmlwdG9yIGlzIG5vdCBmb3IgdGhpcyB0\neXBlLiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gVkFMVUVTW2Rlc2Mu\nZ2V0SW5kZXgoKV07CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgZmlu\nYWwgaW50IGluZGV4OwogICAgICBwcml2YXRlIGZpbmFsIGludCB2YWx1ZTsK\nICAgICAgCiAgICAgIHByaXZhdGUgRGlnZXN0VHlwZShpbnQgaW5kZXgsIGlu\ndCB2YWx1ZSkgewogICAgICAgIHRoaXMuaW5kZXggPSBpbmRleDsKICAgICAg\nICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAgIH0KICAgICAgCiAgICAgIC8v\nIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChlbnVtX3Njb3BlOkxlZGdlck1l\ndGFkYXRhRm9ybWF0LkRpZ2VzdFR5cGUpCiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBpbnRlcmZhY2UgU2VnbWVudE9yQnVpbGRlcgogICAgICAgIGV4dGVuZHMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsKICAgICAg\nCiAgICAgIC8vIHJlcGVhdGVkIHN0cmluZyBlbnNlbWJsZU1lbWJlciA9IDE7\nCiAgICAgIGphdmEudXRpbC5MaXN0PFN0cmluZz4gZ2V0RW5zZW1ibGVNZW1i\nZXJMaXN0KCk7CiAgICAgIGludCBnZXRFbnNlbWJsZU1lbWJlckNvdW50KCk7\nCiAgICAgIFN0cmluZyBnZXRFbnNlbWJsZU1lbWJlcihpbnQgaW5kZXgpOwog\nICAgICAKICAgICAgLy8gcmVxdWlyZWQgaW50NjQgZmlyc3RFbnRyeUlkID0g\nMjsKICAgICAgYm9vbGVhbiBoYXNGaXJzdEVudHJ5SWQoKTsKICAgICAgbG9u\nZyBnZXRGaXJzdEVudHJ5SWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY2xhc3MgU2VnbWVudCBleHRlbmRzCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlCiAgICAgICAgaW1wbGVtZW50\ncyBTZWdtZW50T3JCdWlsZGVyIHsKICAgICAgLy8gVXNlIFNlZ21lbnQubmV3\nQnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgICAgcHJpdmF0ZSBTZWdtZW50\nKEJ1aWxkZXIgYnVpbGRlcikgewogICAgICAgIHN1cGVyKGJ1aWxkZXIpOwog\nICAgICB9CiAgICAgIHByaXZhdGUgU2VnbWVudChib29sZWFuIG5vSW5pdCkg\ne30KICAgICAgCiAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFNlZ21lbnQg\nZGVmYXVsdEluc3RhbmNlOwogICAgICBwdWJsaWMgc3RhdGljIFNlZ21lbnQg\nZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICAgIHJldHVybiBkZWZhdWx0\nSW5zdGFuY2U7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBTZWdtZW50\nIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJu\nIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3Jz\nLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAg\nICAgcmV0dXJuIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5pbnRlcm5hbF9zdGF0aWNfTGVkZ2VyTWV0YWRhdGFGb3JtYXRfU2Vn\nbWVudF9kZXNjcmlwdG9yOwogICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0\nZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vz\nc29yVGFibGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5pbnRlcm5hbF9zdGF0aWNfTGVkZ2Vy\nTWV0YWRhdGFGb3JtYXRfU2VnbWVudF9maWVsZEFjY2Vzc29yVGFibGU7CiAg\nICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAg\nICAgIC8vIHJlcGVhdGVkIHN0cmluZyBlbnNlbWJsZU1lbWJlciA9IDE7CiAg\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVOU0VNQkxFTUVNQkVSX0ZJ\nRUxEX05VTUJFUiA9IDE7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90\nb2J1Zi5MYXp5U3RyaW5nTGlzdCBlbnNlbWJsZU1lbWJlcl87CiAgICAgIHB1\nYmxpYyBqYXZhLnV0aWwuTGlzdDxTdHJpbmc+CiAgICAgICAgICBnZXRFbnNl\nbWJsZU1lbWJlckxpc3QoKSB7CiAgICAgICAgcmV0dXJuIGVuc2VtYmxlTWVt\nYmVyXzsKICAgICAgfQogICAgICBwdWJsaWMgaW50IGdldEVuc2VtYmxlTWVt\nYmVyQ291bnQoKSB7CiAgICAgICAgcmV0dXJuIGVuc2VtYmxlTWVtYmVyXy5z\naXplKCk7CiAgICAgIH0KICAgICAgcHVibGljIFN0cmluZyBnZXRFbnNlbWJs\nZU1lbWJlcihpbnQgaW5kZXgpIHsKICAgICAgICByZXR1cm4gZW5zZW1ibGVN\nZW1iZXJfLmdldChpbmRleCk7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIHJl\ncXVpcmVkIGludDY0IGZpcnN0RW50cnlJZCA9IDI7CiAgICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IEZJUlNURU5UUllJRF9GSUVMRF9OVU1CRVIgPSAy\nOwogICAgICBwcml2YXRlIGxvbmcgZmlyc3RFbnRyeUlkXzsKICAgICAgcHVi\nbGljIGJvb2xlYW4gaGFzRmlyc3RFbnRyeUlkKCkgewogICAgICAgIHJldHVy\nbiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsK\nICAgICAgfQogICAgICBwdWJsaWMgbG9uZyBnZXRGaXJzdEVudHJ5SWQoKSB7\nCiAgICAgICAgcmV0dXJuIGZpcnN0RW50cnlJZF87CiAgICAgIH0KICAgICAg\nCiAgICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICAgIGVu\nc2VtYmxlTWVtYmVyXyA9IGNvbS5nb29nbGUucHJvdG9idWYuTGF6eVN0cmlu\nZ0FycmF5TGlzdC5FTVBUWTsKICAgICAgICBmaXJzdEVudHJ5SWRfID0gMEw7\nCiAgICAgIH0KICAgICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFs\naXplZCA9IC0xOwogICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRp\nYWxpemVkKCkgewogICAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9p\nemVkSXNJbml0aWFsaXplZDsKICAgICAgICBpZiAoaXNJbml0aWFsaXplZCAh\nPSAtMSkgcmV0dXJuIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAgICAKICAg\nICAgICBpZiAoIWhhc0ZpcnN0RW50cnlJZCgpKSB7CiAgICAgICAgICBtZW1v\naXplZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgIH0KICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAx\nOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRP\ndXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBnZXRTZXJp\nYWxpemVkU2l6ZSgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZW5z\nZW1ibGVNZW1iZXJfLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICBvdXRwdXQu\nd3JpdGVCeXRlcygxLCBlbnNlbWJsZU1lbWJlcl8uZ2V0Qnl0ZVN0cmluZyhp\nKSk7CiAgICAgICAgfQogICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgICAgb3V0cHV0Lndy\naXRlSW50NjQoMiwgZmlyc3RFbnRyeUlkXyk7CiAgICAgICAgfQogICAgICAg\nIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICAgIH0K\nICAgICAgCiAgICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNp\nemUgPSAtMTsKICAgICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgp\nIHsKICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7\nCiAgICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwogICAgICAK\nICAgICAgICBzaXplID0gMDsKICAgICAgICB7CiAgICAgICAgICBpbnQgZGF0\nYVNpemUgPSAwOwogICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBlbnNl\nbWJsZU1lbWJlcl8uc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgZGF0YVNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplTm9UYWcoZW5zZW1ibGVN\nZW1iZXJfLmdldEJ5dGVTdHJpbmcoaSkpOwogICAgICAgICAgfQogICAgICAg\nICAgc2l6ZSArPSBkYXRhU2l6ZTsKICAgICAgICAgIHNpemUgKz0gMSAqIGdl\ndEVuc2VtYmxlTWVtYmVyTGlzdCgpLnNpemUoKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAw\nMDEpKSB7CiAgICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgICAgLmNvbXB1dGVJbnQ2NFNp\nemUoMiwgZmlyc3RFbnRyeUlkXyk7CiAgICAgICAgfQogICAgICAgIHNpemUg\nKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAg\nICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgICAg\ncmV0dXJuIHNpemU7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOwogICAgICBA\namF2YS5sYW5nLk92ZXJyaWRlCiAgICAgIHByb3RlY3RlZCBqYXZhLmxhbmcu\nT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAgICAgICB0aHJvd3MgamF2YS5p\nby5PYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICAgIHJldHVybiBzdXBl\nci53cml0ZVJlcGxhY2UoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1h\ndHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCBwYXJzZUZyb20oCiAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkK\nICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgICAg\nfQogICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50\nIHBhcnNlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBkYXRhLAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQgcGFyc2VGcm9tKGJ5\ndGVbXSBkYXRhKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNl\nZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9y\nbWF0LlNlZ21lbnQgcGFyc2VGcm9tKAogICAgICAgICAgYnl0ZVtdIGRhdGEs\nCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lz\ndHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\nZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgLmJ1\naWxkUGFyc2VkKCk7CiAgICAgIH0KICAgICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0\nYWRhdGFGb3JtYXQuU2VnbWVudCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0\ncmVhbSBpbnB1dCkKICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShp\nbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50IHBhcnNlRnJvbSgKICAgICAg\nICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShp\nbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgLmJ1\naWxkUGFyc2VkKCk7CiAgICAgIH0KICAgICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0\nYWRhdGFGb3JtYXQuU2VnbWVudCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5p\nby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdC\ndWlsZGVyKCk7CiAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRG\ncm9tKGlucHV0KSkgewogICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1l\ndGFkYXRhRm9ybWF0LlNlZ21lbnQgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAg\nICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIo\nKTsKICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5w\ndXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgICAgcmV0dXJuIGJ1\naWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQgcGFyc2VGcm9tKAog\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0\nKS5idWlsZFBhcnNlZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdl\nck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQgcGFyc2VGcm9tKAogICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJu\nIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgICAgcHVibGljIEJ1aWxkZXIgbmV3\nQnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAg\nICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRh\nRm9ybWF0LlNlZ21lbnQgcHJvdG90eXBlKSB7CiAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgICAgfQogICAg\nICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBuZXdCdWls\nZGVyKHRoaXMpOyB9CiAgICAgIAogICAgICBAamF2YS5sYW5nLk92ZXJyaWRl\nCiAgICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAog\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgICAgQnVpbGRlciBidWls\nZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsKICAgICAgICByZXR1cm4gYnVp\nbGRlcjsKICAgICAgfQogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNz\nIEJ1aWxkZXIgZXh0ZW5kcwogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgICAg\naW1wbGVtZW50cyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudE9yQnVpbGRlciB7\nCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpIHsKICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxfc3RhdGljX0xlZGdl\nck1ldGFkYXRhRm9ybWF0X1NlZ21lbnRfZGVzY3JpcHRvcjsKICAgICAgICB9\nCiAgICAgICAgCiAgICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAg\nICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAg\nICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLmludGVybmFsX3N0YXRpY19MZWRnZXJNZXRhZGF0YUZvcm1hdF9T\nZWdtZW50X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5T\nZWdtZW50Lm5ld0J1aWxkZXIoKQogICAgICAgIHByaXZhdGUgQnVpbGRlcigp\nIHsKICAgICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24o\nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHJpdmF0ZSBCdWlsZGVy\nKEJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgICAgICBzdXBlcihwYXJl\nbnQpOwogICAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlv\nbigpOwogICAgICAgIH0KICAgICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3Jj\nZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsKICAgICAgICAgIGlmIChjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmll\nbGRCdWlsZGVycykgewogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBw\ncml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICAgIHJl\ndHVybiBuZXcgQnVpbGRlcigpOwogICAgICAgIH0KICAgICAgICAKICAgICAg\nICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAgICAgIHN1cGVyLmNs\nZWFyKCk7CiAgICAgICAgICBlbnNlbWJsZU1lbWJlcl8gPSBjb20uZ29vZ2xl\nLnByb3RvYnVmLkxhenlTdHJpbmdBcnJheUxpc3QuRU1QVFk7CiAgICAgICAg\nICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAg\nICAgICAgICBmaXJzdEVudHJ5SWRfID0gMEw7CiAgICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGlj\nIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAgICByZXR1cm4gY3JlYXRlKCku\nbWVyZ2VGcm9tKGJ1aWxkUGFydGlhbCgpKTsKICAgICAgICB9CiAgICAgICAg\nCiAgICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRv\ncnMuRGVzY3JpcHRvcgogICAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlw\nZSgpIHsKICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVu\ndC5nZXREZXNjcmlwdG9yKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1h\ndHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCBnZXREZWZhdWx0SW5z\ndGFuY2VGb3JUeXBlKCkgewogICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZv\ncm1hdC5TZWdtZW50LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIH0K\nICAgICAgICAKICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21l\nbnQgYnVpbGQoKSB7CiAgICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVu\ndCByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICAgIGlmICghcmVz\ndWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICB0aHJvdyBuZXdV\nbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAg\nICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCBi\ndWlsZFBhcnNlZCgpCiAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAg\nICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCByZXN1bHQgPSBidWlsZFBh\ncnRpYWwoKTsKICAgICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQo\nKSkgewogICAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2Fn\nZUV4Y2VwdGlvbigKICAgICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAg\nICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgICAgICAKICAgICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQgYnVpbGRQYXJ0aWFsKCkg\newogICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQgcmVzdWx0ID0g\nbmV3IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50KHRoaXMpOwogICAgICAgICAg\naW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87CiAgICAgICAgICBp\nbnQgdG9fYml0RmllbGQwXyA9IDA7CiAgICAgICAgICBpZiAoKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAg\nICAgZW5zZW1ibGVNZW1iZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYu\nVW5tb2RpZmlhYmxlTGF6eVN0cmluZ0xpc3QoCiAgICAgICAgICAgICAgICBl\nbnNlbWJsZU1lbWJlcl8pOwogICAgICAgICAgICBiaXRGaWVsZDBfID0gKGJp\ndEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgICB9CiAgICAgICAg\nICByZXN1bHQuZW5zZW1ibGVNZW1iZXJfID0gZW5zZW1ibGVNZW1iZXJfOwog\nICAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMikg\nPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICAgICAgdG9fYml0RmllbGQwXyB8\nPSAweDAwMDAwMDAxOwogICAgICAgICAgfQogICAgICAgICAgcmVzdWx0LmZp\ncnN0RW50cnlJZF8gPSBmaXJzdEVudHJ5SWRfOwogICAgICAgICAgcmVzdWx0\nLmJpdEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgICAgb25CdWls\ndCgpOwogICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICAg\nICAgCiAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29n\nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgICAgaWYgKG90\naGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRh\ndGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQpIHsKICAg\nICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNl\nZ21lbnQpb3RoZXIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVu\ndCBvdGhlcikgewogICAgICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZv\ncm1hdC5TZWdtZW50LmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhp\nczsKICAgICAgICAgIGlmICghb3RoZXIuZW5zZW1ibGVNZW1iZXJfLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICBpZiAoZW5zZW1ibGVNZW1iZXJfLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgIGVuc2VtYmxlTWVtYmVyXyA9IG90aGVy\nLmVuc2VtYmxlTWVtYmVyXzsKICAgICAgICAgICAgICBiaXRGaWVsZDBfID0g\nKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgZW5zdXJlRW5zZW1ibGVNZW1iZXJJc011dGFi\nbGUoKTsKICAgICAgICAgICAgICBlbnNlbWJsZU1lbWJlcl8uYWRkQWxsKG90\naGVyLmVuc2VtYmxlTWVtYmVyXyk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3Ro\nZXIuaGFzRmlyc3RFbnRyeUlkKCkpIHsKICAgICAgICAgICAgc2V0Rmlyc3RF\nbnRyeUlkKG90aGVyLmdldEZpcnN0RW50cnlJZCgpKTsKICAgICAgICAgIH0K\nICAgICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVu\na25vd25GaWVsZHMoKSk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJ\nbml0aWFsaXplZCgpIHsKICAgICAgICAgIGlmICghaGFzRmlyc3RFbnRyeUlk\nKCkpIHsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nICAgICAgICAKICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVh\nbSBpbnB1dCwKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5r\nbm93bkZpZWxkcyA9CiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAgICAgICAgdGhp\ncy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgd2hpbGUgKHRydWUp\nIHsKICAgICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAg\nICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICBjYXNlIDA6\nCiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93\nbkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAg\nZGVmYXVsdDogewogICAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25G\naWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykp\nIHsKICAgICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVu\na25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICBjYXNlIDEwOiB7CiAgICAgICAgICAgICAg\nICBlbnN1cmVFbnNlbWJsZU1lbWJlcklzTXV0YWJsZSgpOwogICAgICAgICAg\nICAgICAgZW5zZW1ibGVNZW1iZXJfLmFkZChpbnB1dC5yZWFkQnl0ZXMoKSk7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgY2FzZSAxNjogewogICAgICAgICAgICAgICAgYml0RmllbGQw\nXyB8PSAweDAwMDAwMDAyOwogICAgICAgICAgICAgICAgZmlyc3RFbnRyeUlk\nXyA9IGlucHV0LnJlYWRJbnQ2NCgpOwogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxk\nMF87CiAgICAgICAgCiAgICAgICAgLy8gcmVwZWF0ZWQgc3RyaW5nIGVuc2Vt\nYmxlTWVtYmVyID0gMTsKICAgICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJv\ndG9idWYuTGF6eVN0cmluZ0xpc3QgZW5zZW1ibGVNZW1iZXJfID0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5MYXp5U3RyaW5nQXJyYXlMaXN0LkVNUFRZOwogICAg\nICAgIHByaXZhdGUgdm9pZCBlbnN1cmVFbnNlbWJsZU1lbWJlcklzTXV0YWJs\nZSgpIHsKICAgICAgICAgIGlmICghKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgICAgZW5zZW1ibGVNZW1i\nZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuTGF6eVN0cmluZ0FycmF5\nTGlzdChlbnNlbWJsZU1lbWJlcl8pOwogICAgICAgICAgICBiaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8U3RyaW5nPgogICAgICAgICAgICBn\nZXRFbnNlbWJsZU1lbWJlckxpc3QoKSB7CiAgICAgICAgICByZXR1cm4gamF2\nYS51dGlsLkNvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QoZW5zZW1ibGVN\nZW1iZXJfKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIGludCBnZXRFbnNl\nbWJsZU1lbWJlckNvdW50KCkgewogICAgICAgICAgcmV0dXJuIGVuc2VtYmxl\nTWVtYmVyXy5zaXplKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0RW5zZW1ibGVNZW1iZXIoaW50IGluZGV4KSB7CiAgICAgICAgICBy\nZXR1cm4gZW5zZW1ibGVNZW1iZXJfLmdldChpbmRleCk7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEVuc2VtYmxlTWVtYmVyKAogICAg\nICAgICAgICBpbnQgaW5kZXgsIFN0cmluZyB2YWx1ZSkgewogICAgICAgICAg\naWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9pbnRl\nckV4Y2VwdGlvbigpOwogIH0KICBlbnN1cmVFbnNlbWJsZU1lbWJlcklzTXV0\nYWJsZSgpOwogICAgICAgICAgZW5zZW1ibGVNZW1iZXJfLnNldChpbmRleCwg\ndmFsdWUpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIgYWRk\nRW5zZW1ibGVNZW1iZXIoU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgICBpZiAo\ndmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgfQogIGVuc3VyZUVuc2VtYmxlTWVtYmVySXNNdXRhYmxl\nKCk7CiAgICAgICAgICBlbnNlbWJsZU1lbWJlcl8uYWRkKHZhbHVlKTsKICAg\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZEFsbEVuc2VtYmxl\nTWVtYmVyKAogICAgICAgICAgICBqYXZhLmxhbmcuSXRlcmFibGU8U3RyaW5n\nPiB2YWx1ZXMpIHsKICAgICAgICAgIGVuc3VyZUVuc2VtYmxlTWVtYmVySXNN\ndXRhYmxlKCk7CiAgICAgICAgICBzdXBlci5hZGRBbGwodmFsdWVzLCBlbnNl\nbWJsZU1lbWJlcl8pOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgICAgcHVibGljIEJ1aWxk\nZXIgY2xlYXJFbnNlbWJsZU1lbWJlcigpIHsKICAgICAgICAgIGVuc2VtYmxl\nTWVtYmVyXyA9IGNvbS5nb29nbGUucHJvdG9idWYuTGF6eVN0cmluZ0FycmF5\nTGlzdC5FTVBUWTsKICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQw\nXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIHZvaWQgYWRk\nRW5zZW1ibGVNZW1iZXIoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIHZhbHVlKSB7CiAgICAgICAgICBlbnN1cmVFbnNlbWJsZU1lbWJlcklzTXV0\nYWJsZSgpOwogICAgICAgICAgZW5zZW1ibGVNZW1iZXJfLmFkZCh2YWx1ZSk7\nCiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9CiAgICAgICAgCiAg\nICAgICAgLy8gcmVxdWlyZWQgaW50NjQgZmlyc3RFbnRyeUlkID0gMjsKICAg\nICAgICBwcml2YXRlIGxvbmcgZmlyc3RFbnRyeUlkXyA7CiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gaGFzRmlyc3RFbnRyeUlkKCkgewogICAgICAgICAgcmV0\ndXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIp\nOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgbG9uZyBnZXRGaXJzdEVudHJ5\nSWQoKSB7CiAgICAgICAgICByZXR1cm4gZmlyc3RFbnRyeUlkXzsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Rmlyc3RFbnRyeUlkKGxv\nbmcgdmFsdWUpIHsKICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAw\nMjsKICAgICAgICAgIGZpcnN0RW50cnlJZF8gPSB2YWx1ZTsKICAgICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRmlyc3RFbnRyeUlkKCkg\newogICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAw\nMDAwMDIpOwogICAgICAgICAgZmlyc3RFbnRyeUlkXyA9IDBMOwogICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICB9CiAgICAgICAgCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3Bv\naW50KGJ1aWxkZXJfc2NvcGU6TGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVu\ndCkKICAgICAgfQogICAgICAKICAgICAgc3RhdGljIHsKICAgICAgICBkZWZh\ndWx0SW5zdGFuY2UgPSBuZXcgU2VnbWVudCh0cnVlKTsKICAgICAgICBkZWZh\ndWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgICB9CiAgICAgIAogICAg\nICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6TGVk\nZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCkKICAgIH0KICAgIAogICAgcHJp\ndmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIHJlcXVpcmVkIGludDMyIHF1\nb3J1bVNpemUgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUVVP\nUlVNU0laRV9GSUVMRF9OVU1CRVIgPSAxOwogICAgcHJpdmF0ZSBpbnQgcXVv\ncnVtU2l6ZV87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNRdW9ydW1TaXplKCkg\newogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMgaW50IGdldFF1b3J1bVNp\nemUoKSB7CiAgICAgIHJldHVybiBxdW9ydW1TaXplXzsKICAgIH0KICAgIAog\nICAgLy8gcmVxdWlyZWQgaW50MzIgZW5zZW1ibGVTaXplID0gMjsKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IEVOU0VNQkxFU0laRV9GSUVMRF9OVU1C\nRVIgPSAyOwogICAgcHJpdmF0ZSBpbnQgZW5zZW1ibGVTaXplXzsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc0Vuc2VtYmxlU2l6ZSgpIHsKICAgICAgcmV0dXJu\nICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwog\nICAgfQogICAgcHVibGljIGludCBnZXRFbnNlbWJsZVNpemUoKSB7CiAgICAg\nIHJldHVybiBlbnNlbWJsZVNpemVfOwogICAgfQogICAgCiAgICAvLyByZXF1\naXJlZCBpbnQ2NCBsZW5ndGggPSAzOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgTEVOR1RIX0ZJRUxEX05VTUJFUiA9IDM7CiAgICBwcml2YXRlIGxv\nbmcgbGVuZ3RoXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc0xlbmd0aCgpIHsK\nICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4\nMDAwMDAwMDQpOwogICAgfQogICAgcHVibGljIGxvbmcgZ2V0TGVuZ3RoKCkg\newogICAgICByZXR1cm4gbGVuZ3RoXzsKICAgIH0KICAgIAogICAgLy8gb3B0\naW9uYWwgaW50NjQgbGFzdEVudHJ5SWQgPSA0OwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgTEFTVEVOVFJZSURfRklFTERfTlVNQkVSID0gNDsKICAg\nIHByaXZhdGUgbG9uZyBsYXN0RW50cnlJZF87CiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNMYXN0RW50cnlJZCgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpOwogICAgfQogICAgcHVi\nbGljIGxvbmcgZ2V0TGFzdEVudHJ5SWQoKSB7CiAgICAgIHJldHVybiBsYXN0\nRW50cnlJZF87CiAgICB9CiAgICAKICAgIC8vIHJlcXVpcmVkIC5MZWRnZXJN\nZXRhZGF0YUZvcm1hdC5TdGF0ZSBzdGF0ZSA9IDUgW2RlZmF1bHQgPSBPUEVO\nXTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNUQVRFX0ZJRUxEX05V\nTUJFUiA9IDU7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSBz\ndGF0ZV87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdGF0ZSgpIHsKICAgICAg\ncmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMTApID09IDB4MDAwMDAw\nMTApOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSBn\nZXRTdGF0ZSgpIHsKICAgICAgcmV0dXJuIHN0YXRlXzsKICAgIH0KICAgIAog\nICAgLy8gcmVwZWF0ZWQgLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQg\nc2VnbWVudCA9IDY7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTRUdN\nRU5UX0ZJRUxEX05VTUJFUiA9IDY7CiAgICBwcml2YXRlIGphdmEudXRpbC5M\naXN0PG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50PiBzZWdtZW50XzsKICAgIHB1\nYmxpYyBqYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudD4g\nZ2V0U2VnbWVudExpc3QoKSB7CiAgICAgIHJldHVybiBzZWdtZW50XzsKICAg\nIH0KICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDw/IGV4dGVuZHMgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFk\nYXRhRm9ybWF0LlNlZ21lbnRPckJ1aWxkZXI+IAogICAgICAgIGdldFNlZ21l\nbnRPckJ1aWxkZXJMaXN0KCkgewogICAgICByZXR1cm4gc2VnbWVudF87CiAg\nICB9CiAgICBwdWJsaWMgaW50IGdldFNlZ21lbnRDb3VudCgpIHsKICAgICAg\ncmV0dXJuIHNlZ21lbnRfLnNpemUoKTsKICAgIH0KICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0\nYWRhdGFGb3JtYXQuU2VnbWVudCBnZXRTZWdtZW50KGludCBpbmRleCkgewog\nICAgICByZXR1cm4gc2VnbWVudF8uZ2V0KGluZGV4KTsKICAgIH0KICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudE9yQnVpbGRlciBnZXRTZWdt\nZW50T3JCdWlsZGVyKAogICAgICAgIGludCBpbmRleCkgewogICAgICByZXR1\ncm4gc2VnbWVudF8uZ2V0KGluZGV4KTsKICAgIH0KICAgIAogICAgLy8gb3B0\naW9uYWwgLkxlZGdlck1ldGFkYXRhRm9ybWF0LkRpZ2VzdFR5cGUgZGlnZXN0\nVHlwZSA9IDc7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBESUdFU1RU\nWVBFX0ZJRUxEX05VTUJFUiA9IDc7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZv\ncm1hdC5EaWdlc3RUeXBlIGRpZ2VzdFR5cGVfOwogICAgcHVibGljIGJvb2xl\nYW4gaGFzRGlnZXN0VHlwZSgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMjApID09IDB4MDAwMDAwMjApOwogICAgfQogICAgcHVi\nbGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJNZXRhZGF0YUZvcm1hdC5EaWdlc3RUeXBlIGdldERpZ2VzdFR5cGUo\nKSB7CiAgICAgIHJldHVybiBkaWdlc3RUeXBlXzsKICAgIH0KICAgIAogICAg\nLy8gb3B0aW9uYWwgYnl0ZXMgcGFzc3dvcmQgPSA4OwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgUEFTU1dPUkRfRklFTERfTlVNQkVSID0gODsKICAg\nIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHBhc3N3\nb3JkXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc1Bhc3N3b3JkKCkgewogICAg\nICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDA0MCkgPT0gMHgwMDAw\nMDA0MCk7CiAgICB9CiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nIGdldFBhc3N3b3JkKCkgewogICAgICByZXR1cm4gcGFzc3dv\ncmRfOwogICAgfQogICAgCiAgICAvLyBvcHRpb25hbCBpbnQzMiBhY2tRdW9y\ndW1TaXplID0gOTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEFDS1FV\nT1JVTVNJWkVfRklFTERfTlVNQkVSID0gOTsKICAgIHByaXZhdGUgaW50IGFj\na1F1b3J1bVNpemVfOwogICAgcHVibGljIGJvb2xlYW4gaGFzQWNrUXVvcnVt\nU2l6ZSgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nODApID09IDB4MDAwMDAwODApOwogICAgfQogICAgcHVibGljIGludCBnZXRB\nY2tRdW9ydW1TaXplKCkgewogICAgICByZXR1cm4gYWNrUXVvcnVtU2l6ZV87\nCiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewog\nICAgICBxdW9ydW1TaXplXyA9IDA7CiAgICAgIGVuc2VtYmxlU2l6ZV8gPSAw\nOwogICAgICBsZW5ndGhfID0gMEw7CiAgICAgIGxhc3RFbnRyeUlkXyA9IDBM\nOwogICAgICBzdGF0ZV8gPSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU3RhdGUuT1BFTjsK\nICAgICAgc2VnbWVudF8gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlM\naXN0KCk7CiAgICAgIGRpZ2VzdFR5cGVfID0gb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LkRp\nZ2VzdFR5cGUuQ1JDMzI7CiAgICAgIHBhc3N3b3JkXyA9IGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgYWNrUXVvcnVtU2l6\nZV8gPSAwOwogICAgfQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0\naWFsaXplZCA9IC0xOwogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0\naWFsaXplZCgpIHsKICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6\nZWRJc0luaXRpYWxpemVkOwogICAgICBpZiAoaXNJbml0aWFsaXplZCAhPSAt\nMSkgcmV0dXJuIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAgCiAgICAgIGlm\nICghaGFzUXVvcnVtU2l6ZSgpKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRp\nYWxpemVkID0gMDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAg\nICAgaWYgKCFoYXNFbnNlbWJsZVNpemUoKSkgewogICAgICAgIG1lbW9pemVk\nSXNJbml0aWFsaXplZCA9IDA7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICB9CiAgICAgIGlmICghaGFzTGVuZ3RoKCkpIHsKICAgICAgICBtZW1vaXpl\nZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgfQogICAgICBpZiAoIWhhc1N0YXRlKCkpIHsKICAgICAgICBtZW1vaXpl\nZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgfQogICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdldFNlZ21lbnRDb3Vu\ndCgpOyBpKyspIHsKICAgICAgICBpZiAoIWdldFNlZ21lbnQoaSkuaXNJbml0\naWFsaXplZCgpKSB7CiAgICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQg\nPSAwOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAg\nfQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1\ncm4gdHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhj\nb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkK\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAo\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsK\nICAgICAgICBvdXRwdXQud3JpdGVJbnQzMigxLCBxdW9ydW1TaXplXyk7CiAg\nICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09\nIDB4MDAwMDAwMDIpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlSW50MzIoMiwg\nZW5zZW1ibGVTaXplXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpKSB7CiAgICAgICAgb3V0\ncHV0LndyaXRlSW50NjQoMywgbGVuZ3RoXyk7CiAgICAgIH0KICAgICAgaWYg\nKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpKSB7\nCiAgICAgICAgb3V0cHV0LndyaXRlSW50NjQoNCwgbGFzdEVudHJ5SWRfKTsK\nICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAxMCkg\nPT0gMHgwMDAwMDAxMCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVFbnVtKDUs\nIHN0YXRlXy5nZXROdW1iZXIoKSk7CiAgICAgIH0KICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBzZWdtZW50Xy5zaXplKCk7IGkrKykgewogICAgICAgIG91\ndHB1dC53cml0ZU1lc3NhZ2UoNiwgc2VnbWVudF8uZ2V0KGkpKTsKICAgICAg\nfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAyMCkgPT0gMHgw\nMDAwMDAyMCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVFbnVtKDcsIGRpZ2Vz\ndFR5cGVfLmdldE51bWJlcigpKTsKICAgICAgfQogICAgICBpZiAoKChiaXRG\naWVsZDBfICYgMHgwMDAwMDA0MCkgPT0gMHgwMDAwMDA0MCkpIHsKICAgICAg\nICBvdXRwdXQud3JpdGVCeXRlcyg4LCBwYXNzd29yZF8pOwogICAgICB9CiAg\nICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDgwKSA9PSAweDAwMDAw\nMDgwKSkgewogICAgICAgIG91dHB1dC53cml0ZUludDMyKDksIGFja1F1b3J1\nbVNpemVfKTsKICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCkud3Jp\ndGVUbyhvdXRwdXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBtZW1v\naXplZFNlcmlhbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdldFNl\ncmlhbGl6ZWRTaXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2Vy\naWFsaXplZFNpemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6\nZTsKICAgIAogICAgICBzaXplID0gMDsKICAgICAgaWYgKCgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgc2l6\nZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAg\nICAgICAgICAuY29tcHV0ZUludDMyU2l6ZSgxLCBxdW9ydW1TaXplXyk7CiAg\nICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09\nIDB4MDAwMDAwMDIpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUlu\ndDMyU2l6ZSgyLCBlbnNlbWJsZVNpemVfKTsKICAgICAgfQogICAgICBpZiAo\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCkpIHsK\nICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlSW50NjRTaXplKDMsIGxlbmd0\naF8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDA4KSA9PSAweDAwMDAwMDA4KSkgewogICAgICAgIHNpemUgKz0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNv\nbXB1dGVJbnQ2NFNpemUoNCwgbGFzdEVudHJ5SWRfKTsKICAgICAgfQogICAg\nICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAxMCkgPT0gMHgwMDAwMDAx\nMCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlRW51bVNpemUoNSwg\nc3RhdGVfLmdldE51bWJlcigpKTsKICAgICAgfQogICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IHNlZ21lbnRfLnNpemUoKTsgaSsrKSB7CiAgICAgICAgc2l6\nZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAg\nICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDYsIHNlZ21lbnRfLmdldChp\nKSk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nMjApID09IDB4MDAwMDAwMjApKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29t\ncHV0ZUVudW1TaXplKDcsIGRpZ2VzdFR5cGVfLmdldE51bWJlcigpKTsKICAg\nICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDA0MCkgPT0g\nMHgwMDAwMDA0MCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJv\ndG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0\nZXNTaXplKDgsIHBhc3N3b3JkXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwODApID09IDB4MDAwMDAwODApKSB7CiAgICAg\nICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3Ry\nZWFtCiAgICAgICAgICAuY29tcHV0ZUludDMyU2l6ZSg5LCBhY2tRdW9ydW1T\naXplXyk7CiAgICAgIH0KICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRz\nKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxp\nemVkU2l6ZSA9IHNpemU7CiAgICAgIHJldHVybiBzaXplOwogICAgfQogICAg\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25V\nSUQgPSAwTDsKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCBqYXZhLmxhbmcuT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIHN1cGVyLndyaXRlUmVwbGFjZSgpOwogICAgfQogICAgCiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCBwYXJzZUZyb20oCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkxlZGdlck1ldGFkYXRhRm9ybWF0IHBhcnNlRnJvbSgKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCBwYXJzZUZyb20oYnl0\nZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0IHBhcnNl\nRnJvbSgKICAgICAgICBieXRlW10gZGF0YSwKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZh\nbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCBwYXJzZUZyb20oamF2YS5pby5J\nbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVk\nZ2VyTWV0YWRhdGFGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8u\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQgcGFyc2VEZWxpbWl0\nZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxk\nZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVs\naW1pdGVkRnJvbShpbnB1dCkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5i\ndWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBu\ndWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0\nYUZvcm1hdCBwYXJzZURlbGltaXRlZEZyb20oCiAgICAgICAgamF2YS5pby5J\nbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxk\nZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIu\nbWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkp\nIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAg\nICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCBwYXJzZUZyb20o\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0\nYUZvcm1hdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxk\nZXIoKSB7IHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOyB9CiAgICBwdWJsaWMg\nQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxk\nZXIoKTsgfQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIo\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdl\nck1ldGFkYXRhRm9ybWF0IHByb3RvdHlwZSkgewogICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAgfQogICAgcHVi\nbGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4gbmV3QnVpbGRlcih0\naGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90\nZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlclBhcmVu\ndCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxk\nZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWls\nZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1lbnRzIG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1h\ndE9yQnVpbGRlciB7CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxfc3RhdGlj\nX0xlZGdlck1ldGFkYXRhRm9ybWF0X2Rlc2NyaXB0b3I7CiAgICAgIH0KICAg\nICAgCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRl\ncm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLmludGVy\nbmFsX3N0YXRpY19MZWRnZXJNZXRhZGF0YUZvcm1hdF9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2lu\nZyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVk\nZ2VyTWV0YWRhdGFGb3JtYXQubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUg\nQnVpbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxp\nemF0aW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRl\ncihCdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVu\ndCk7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigp\nOwogICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRl\nckluaXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVy\ncykgewogICAgICAgICAgZ2V0U2VnbWVudEZpZWxkQnVpbGRlcigpOwogICAg\nICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNy\nZWF0ZSgpIHsKICAgICAgICByZXR1cm4gbmV3IEJ1aWxkZXIoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAg\nICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICBxdW9ydW1TaXplXyA9IDA7CiAg\nICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEp\nOwogICAgICAgIGVuc2VtYmxlU2l6ZV8gPSAwOwogICAgICAgIGJpdEZpZWxk\nMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAgICAgICBsZW5n\ndGhfID0gMEw7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYg\nfjB4MDAwMDAwMDQpOwogICAgICAgIGxhc3RFbnRyeUlkXyA9IDBMOwogICAg\nICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA4KTsK\nICAgICAgICBzdGF0ZV8gPSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU3RhdGUuT1BFTjsK\nICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAx\nMCk7CiAgICAgICAgaWYgKHNlZ21lbnRCdWlsZGVyXyA9PSBudWxsKSB7CiAg\nICAgICAgICBzZWdtZW50XyA9IGphdmEudXRpbC5Db2xsZWN0aW9ucy5lbXB0\neUxpc3QoKTsKICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAm\nIH4weDAwMDAwMDIwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2Vn\nbWVudEJ1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIGRpZ2Vz\ndFR5cGVfID0gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LkRpZ2VzdFR5cGUuQ1JDMzI7CiAg\nICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwNDAp\nOwogICAgICAgIHBhc3N3b3JkXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZy5FTVBUWTsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxk\nMF8gJiB+MHgwMDAwMDA4MCk7CiAgICAgICAgYWNrUXVvcnVtU2l6ZV8gPSAw\nOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAw\nMTAwKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIGNy\nZWF0ZSgpLm1lcmdlRnJvbShidWlsZFBhcnRpYWwoKSk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBl\nKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuZ2V0RGVzY3Jp\ncHRvcigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRh\nRm9ybWF0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAg\ncmV0dXJuIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsK\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCBi\ndWlsZCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQgcmVzdWx0ID0gYnVp\nbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXpl\nZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2Fn\nZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\ncmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0\nYUZvcm1hdCBidWlsZFBhcnNlZCgpCiAgICAgICAgICB0aHJvd3MgY29tLmdv\nb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24g\newogICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCByZXN1bHQgPSBidWlsZFBhcnRp\nYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsK\nICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0\naW9uKAogICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1\nbHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3Jt\nYXQgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCBy\nZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0KHRoaXMpOwogICAgICAgIGlu\ndCBmcm9tX2JpdEZpZWxkMF8gPSBiaXRGaWVsZDBfOwogICAgICAgIGludCB0\nb19iaXRGaWVsZDBfID0gMDsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxk\nMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgICAg\ndG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIH0KICAgICAg\nICByZXN1bHQucXVvcnVtU2l6ZV8gPSBxdW9ydW1TaXplXzsKICAgICAgICBp\nZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAw\nMDAyKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDAy\nOwogICAgICAgIH0KICAgICAgICByZXN1bHQuZW5zZW1ibGVTaXplXyA9IGVu\nc2VtYmxlU2l6ZV87CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYg\nMHgwMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCkpIHsKICAgICAgICAgIHRvX2Jp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAwNDsKICAgICAgICB9CiAgICAgICAgcmVz\ndWx0Lmxlbmd0aF8gPSBsZW5ndGhfOwogICAgICAgIGlmICgoKGZyb21fYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpKSB7CiAgICAg\nICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgfQog\nICAgICAgIHJlc3VsdC5sYXN0RW50cnlJZF8gPSBsYXN0RW50cnlJZF87CiAg\nICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAxMCkgPT0g\nMHgwMDAwMDAxMCkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAxMDsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnN0YXRlXyA9IHN0\nYXRlXzsKICAgICAgICBpZiAoc2VnbWVudEJ1aWxkZXJfID09IG51bGwpIHsK\nICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDIwKSA9PSAw\neDAwMDAwMDIwKSkgewogICAgICAgICAgICBzZWdtZW50XyA9IGphdmEudXRp\nbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHNlZ21lbnRfKTsKICAg\nICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAw\nMjApOwogICAgICAgICAgfQogICAgICAgICAgcmVzdWx0LnNlZ21lbnRfID0g\nc2VnbWVudF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdC5z\nZWdtZW50XyA9IHNlZ21lbnRCdWlsZGVyXy5idWlsZCgpOwogICAgICAgIH0K\nICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDQwKSA9\nPSAweDAwMDAwMDQwKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAw\neDAwMDAwMDIwOwogICAgICAgIH0KICAgICAgICByZXN1bHQuZGlnZXN0VHlw\nZV8gPSBkaWdlc3RUeXBlXzsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxk\nMF8gJiAweDAwMDAwMDgwKSA9PSAweDAwMDAwMDgwKSkgewogICAgICAgICAg\ndG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDQwOwogICAgICAgIH0KICAgICAg\nICByZXN1bHQucGFzc3dvcmRfID0gcGFzc3dvcmRfOwogICAgICAgIGlmICgo\nKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAxMDApID09IDB4MDAwMDAxMDAp\nKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwODA7CiAg\nICAgICAgfQogICAgICAgIHJlc3VsdC5hY2tRdW9ydW1TaXplXyA9IGFja1F1\nb3J1bVNpemVfOwogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0\nRmllbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVy\nZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewog\nICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdCkg\newogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0\nKW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVy\nZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VG\ncm9tKG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJNZXRhZGF0YUZvcm1hdCBvdGhlcikgewogICAgICAgIGlmIChvdGhl\nciA9PSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTGVkZ2VyTWV0YWRhdGFGb3JtYXQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJl\ndHVybiB0aGlzOwogICAgICAgIGlmIChvdGhlci5oYXNRdW9ydW1TaXplKCkp\nIHsKICAgICAgICAgIHNldFF1b3J1bVNpemUob3RoZXIuZ2V0UXVvcnVtU2l6\nZSgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc0Vuc2VtYmxl\nU2l6ZSgpKSB7CiAgICAgICAgICBzZXRFbnNlbWJsZVNpemUob3RoZXIuZ2V0\nRW5zZW1ibGVTaXplKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIu\naGFzTGVuZ3RoKCkpIHsKICAgICAgICAgIHNldExlbmd0aChvdGhlci5nZXRM\nZW5ndGgoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNMYXN0\nRW50cnlJZCgpKSB7CiAgICAgICAgICBzZXRMYXN0RW50cnlJZChvdGhlci5n\nZXRMYXN0RW50cnlJZCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVy\nLmhhc1N0YXRlKCkpIHsKICAgICAgICAgIHNldFN0YXRlKG90aGVyLmdldFN0\nYXRlKCkpOwogICAgICAgIH0KICAgICAgICBpZiAoc2VnbWVudEJ1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIGlmICghb3RoZXIuc2VnbWVudF8uaXNF\nbXB0eSgpKSB7CiAgICAgICAgICAgIGlmIChzZWdtZW50Xy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgICBzZWdtZW50XyA9IG90aGVyLnNlZ21lbnRfOwog\nICAgICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAw\nMDAwMDIwKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBl\nbnN1cmVTZWdtZW50SXNNdXRhYmxlKCk7CiAgICAgICAgICAgICAgc2VnbWVu\ndF8uYWRkQWxsKG90aGVyLnNlZ21lbnRfKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgaWYgKCFvdGhlci5zZWdtZW50Xy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgaWYgKHNlZ21lbnRCdWlsZGVyXy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgICBzZWdtZW50QnVpbGRlcl8uZGlzcG9zZSgpOwog\nICAgICAgICAgICAgIHNlZ21lbnRCdWlsZGVyXyA9IG51bGw7CiAgICAgICAg\nICAgICAgc2VnbWVudF8gPSBvdGhlci5zZWdtZW50XzsKICAgICAgICAgICAg\nICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAyMCk7CiAg\nICAgICAgICAgICAgc2VnbWVudEJ1aWxkZXJfID0gCiAgICAgICAgICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlz\nVXNlRmllbGRCdWlsZGVycyA/CiAgICAgICAgICAgICAgICAgICBnZXRTZWdt\nZW50RmllbGRCdWlsZGVyKCkgOiBudWxsOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgIHNlZ21lbnRCdWlsZGVyXy5hZGRBbGxNZXNzYWdl\ncyhvdGhlci5zZWdtZW50Xyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc0RpZ2VzdFR5cGUoKSkg\newogICAgICAgICAgc2V0RGlnZXN0VHlwZShvdGhlci5nZXREaWdlc3RUeXBl\nKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzUGFzc3dvcmQo\nKSkgewogICAgICAgICAgc2V0UGFzc3dvcmQob3RoZXIuZ2V0UGFzc3dvcmQo\nKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNBY2tRdW9ydW1T\naXplKCkpIHsKICAgICAgICAgIHNldEFja1F1b3J1bVNpemUob3RoZXIuZ2V0\nQWNrUXVvcnVtU2l6ZSgpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tZXJn\nZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGlj\nIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICBpZiAo\nIWhhc1F1b3J1bVNpemUoKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghaGFzRW5zZW1ibGVT\naXplKCkpIHsKICAgICAgICAgIAogICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgICAgICBpZiAoIWhhc0xlbmd0aCgpKSB7CiAgICAgICAg\nICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAg\naWYgKCFoYXNTdGF0ZSgpKSB7CiAgICAgICAgICAKICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBnZXRTZWdtZW50Q291bnQoKTsgaSsrKSB7CiAgICAgICAgICBpZiAoIWdl\ndFNlZ21lbnQoaSkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgIAog\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25G\naWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigK\nICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAg\nIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVh\nZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAg\nY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1\nbmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICBk\nZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVs\nZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAg\nICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZp\nZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGNhc2UgODogewogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMTsKICAgICAgICAgICAgICBxdW9ydW1TaXplXyA9IGlucHV0LnJlYWRJ\nbnQzMigpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGNhc2UgMTY6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgICAgICAgZW5zZW1ibGVTaXplXyA9\nIGlucHV0LnJlYWRJbnQzMigpOwogICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMjQ6IHsKICAgICAgICAgICAg\nICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAgICAgICAgICAgICAgbGVu\nZ3RoXyA9IGlucHV0LnJlYWRJbnQ2NCgpOwogICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMzI6IHsKICAgICAg\nICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgICAg\nICAgbGFzdEVudHJ5SWRfID0gaW5wdXQucmVhZEludDY0KCk7CiAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA0\nMDogewogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlucHV0LnJlYWRF\nbnVtKCk7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlIHZh\nbHVlID0gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkxlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlLnZhbHVlT2YocmF3VmFsdWUp\nOwogICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICB1bmtub3duRmllbGRzLm1lcmdlVmFyaW50RmllbGQoNSwgcmF3\nVmFsdWUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMTA7CiAgICAgICAgICAgICAgICBz\ndGF0ZV8gPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA1MDogewog\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRh\nRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50LkJ1aWxkZXIg\nc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRh\nRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50Lm5ld0J1aWxk\nZXIoKTsKICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWls\nZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgYWRkU2Vn\nbWVudChzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDU2OiB7\nCiAgICAgICAgICAgICAgaW50IHJhd1ZhbHVlID0gaW5wdXQucmVhZEVudW0o\nKTsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuRGlnZXN0VHlwZSB2\nYWx1ZSA9IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5EaWdlc3RUeXBlLnZhbHVlT2YocmF3\nVmFsdWUpOwogICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICB1bmtub3duRmllbGRzLm1lcmdlVmFyaW50RmllbGQo\nNywgcmF3VmFsdWUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwNDA7CiAgICAgICAgICAg\nICAgICBkaWdlc3RUeXBlXyA9IHZhbHVlOwogICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBj\nYXNlIDY2OiB7CiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDgwOwogICAgICAgICAgICAgIHBhc3N3b3JkXyA9IGlucHV0LnJlYWRCeXRl\ncygpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGNhc2UgNzI6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9\nIDB4MDAwMDAxMDA7CiAgICAgICAgICAgICAgYWNrUXVvcnVtU2l6ZV8gPSBp\nbnB1dC5yZWFkSW50MzIoKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAK\nICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgICAgCiAgICAgIC8v\nIHJlcXVpcmVkIGludDMyIHF1b3J1bVNpemUgPSAxOwogICAgICBwcml2YXRl\nIGludCBxdW9ydW1TaXplXyA7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1F1\nb3J1bVNpemUoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBpbnQgZ2V0UXVvcnVtU2l6ZSgpIHsKICAgICAgICByZXR1cm4gcXVvcnVt\nU2l6ZV87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UXVvcnVt\nU2l6ZShpbnQgdmFsdWUpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDE7CiAgICAgICAgcXVvcnVtU2l6ZV8gPSB2YWx1ZTsKICAgICAgICBv\nbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICBwdWJsaWMgQnVpbGRlciBjbGVhclF1b3J1bVNpemUoKSB7CiAgICAgICAg\nYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAg\nICAgIHF1b3J1bVNpemVfID0gMDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gcmVx\ndWlyZWQgaW50MzIgZW5zZW1ibGVTaXplID0gMjsKICAgICAgcHJpdmF0ZSBp\nbnQgZW5zZW1ibGVTaXplXyA7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc0Vu\nc2VtYmxlU2l6ZSgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMik7CiAgICAgIH0KICAgICAgcHVi\nbGljIGludCBnZXRFbnNlbWJsZVNpemUoKSB7CiAgICAgICAgcmV0dXJuIGVu\nc2VtYmxlU2l6ZV87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0\nRW5zZW1ibGVTaXplKGludCB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwMjsKICAgICAgICBlbnNlbWJsZVNpemVfID0gdmFsdWU7\nCiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJFbnNlbWJsZVNpemUo\nKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAw\nMDAwMDIpOwogICAgICAgIGVuc2VtYmxlU2l6ZV8gPSAwOwogICAgICAgIG9u\nQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIAogICAgICAvLyByZXF1aXJlZCBpbnQ2NCBsZW5ndGggPSAzOwogICAgICBw\ncml2YXRlIGxvbmcgbGVuZ3RoXyA7CiAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc0xlbmd0aCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCk7CiAgICAgIH0KICAgICAgcHVibGlj\nIGxvbmcgZ2V0TGVuZ3RoKCkgewogICAgICAgIHJldHVybiBsZW5ndGhfOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldExlbmd0aChsb25nIHZh\nbHVlKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDA0OwogICAg\nICAgIGxlbmd0aF8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBjbGVhckxlbmd0aCgpIHsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZp\nZWxkMF8gJiB+MHgwMDAwMDAwNCk7CiAgICAgICAgbGVuZ3RoXyA9IDBMOwog\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCBpbnQ2NCBsYXN0RW50cnlJ\nZCA9IDQ7CiAgICAgIHByaXZhdGUgbG9uZyBsYXN0RW50cnlJZF8gOwogICAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNMYXN0RW50cnlJZCgpIHsKICAgICAgICBy\nZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwOCkgPT0gMHgwMDAwMDAw\nOCk7CiAgICAgIH0KICAgICAgcHVibGljIGxvbmcgZ2V0TGFzdEVudHJ5SWQo\nKSB7CiAgICAgICAgcmV0dXJuIGxhc3RFbnRyeUlkXzsKICAgICAgfQogICAg\nICBwdWJsaWMgQnVpbGRlciBzZXRMYXN0RW50cnlJZChsb25nIHZhbHVlKSB7\nCiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDA4OwogICAgICAgIGxh\nc3RFbnRyeUlkXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIGNsZWFyTGFzdEVudHJ5SWQoKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChi\naXRGaWVsZDBfICYgfjB4MDAwMDAwMDgpOwogICAgICAgIGxhc3RFbnRyeUlk\nXyA9IDBMOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyByZXF1aXJlZCAuTGVkZ2Vy\nTWV0YWRhdGFGb3JtYXQuU3RhdGUgc3RhdGUgPSA1IFtkZWZhdWx0ID0gT1BF\nTl07CiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlIHN0YXRl\nXyA9IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZS5PUEVOOwogICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNTdGF0ZSgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAxMCkgPT0gMHgwMDAwMDAxMCk7CiAgICAgIH0KICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSBnZXRTdGF0ZSgpIHsK\nICAgICAgICByZXR1cm4gc3RhdGVfOwogICAgICB9CiAgICAgIHB1YmxpYyBC\ndWlsZGVyIHNldFN0YXRlKG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZSB2YWx1ZSkg\newogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJv\ndyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAg\nICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDEwOwogICAgICAgIHN0YXRlXyA9\nIHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3RhdGUo\nKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAw\nMDAwMTApOwogICAgICAgIHN0YXRlXyA9IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0\nZS5PUEVOOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyByZXBlYXRlZCAuTGVkZ2Vy\nTWV0YWRhdGFGb3JtYXQuU2VnbWVudCBzZWdtZW50ID0gNjsKICAgICAgcHJp\ndmF0ZSBqYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudD4g\nc2VnbWVudF8gPQogICAgICAgIGphdmEudXRpbC5Db2xsZWN0aW9ucy5lbXB0\neUxpc3QoKTsKICAgICAgcHJpdmF0ZSB2b2lkIGVuc3VyZVNlZ21lbnRJc011\ndGFibGUoKSB7CiAgICAgICAgaWYgKCEoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDIwKSA9PSAweDAwMDAwMDIwKSkgewogICAgICAgICAgc2VnbWVudF8gPSBu\nZXcgamF2YS51dGlsLkFycmF5TGlzdDxvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVu\ndD4oc2VnbWVudF8pOwogICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDIwOwogICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUg\nY29tLmdvb2dsZS5wcm90b2J1Zi5SZXBlYXRlZEZpZWxkQnVpbGRlcjwKICAg\nICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50LCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3Jt\nYXQuU2VnbWVudC5CdWlsZGVyLCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudE9y\nQnVpbGRlcj4gc2VnbWVudEJ1aWxkZXJfOwogICAgICAKICAgICAgcHVibGlj\nIGphdmEudXRpbC5MaXN0PG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50PiBnZXRT\nZWdtZW50TGlzdCgpIHsKICAgICAgICBpZiAoc2VnbWVudEJ1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIHJldHVybiBqYXZhLnV0aWwuQ29sbGVjdGlv\nbnMudW5tb2RpZmlhYmxlTGlzdChzZWdtZW50Xyk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHJldHVybiBzZWdtZW50QnVpbGRlcl8uZ2V0TWVzc2Fn\nZUxpc3QoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHVibGljIGludCBn\nZXRTZWdtZW50Q291bnQoKSB7CiAgICAgICAgaWYgKHNlZ21lbnRCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gc2VnbWVudF8uc2l6ZSgp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gc2VnbWVudEJ1\naWxkZXJfLmdldENvdW50KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCBnZXRTZWdtZW50KGludCBp\nbmRleCkgewogICAgICAgIGlmIChzZWdtZW50QnVpbGRlcl8gPT0gbnVsbCkg\newogICAgICAgICAgcmV0dXJuIHNlZ21lbnRfLmdldChpbmRleCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBzZWdtZW50QnVpbGRlcl8u\nZ2V0TWVzc2FnZShpbmRleCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIHNldFNlZ21lbnQoCiAgICAgICAgICBpbnQgaW5kZXgs\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRn\nZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50IHZhbHVlKSB7CiAgICAgICAgaWYg\nKHNlZ21lbnRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodmFs\ndWUgPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50\nZXJFeGNlcHRpb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIGVuc3VyZVNl\nZ21lbnRJc011dGFibGUoKTsKICAgICAgICAgIHNlZ21lbnRfLnNldChpbmRl\neCwgdmFsdWUpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHNlZ21lbnRCdWlsZGVyXy5zZXRNZXNzYWdlKGlu\nZGV4LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFNlZ21lbnQoCiAgICAg\nICAgICBpbnQgaW5kZXgsIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50LkJ1aWxk\nZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgaWYgKHNlZ21lbnRCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBlbnN1cmVTZWdtZW50SXNNdXRh\nYmxlKCk7CiAgICAgICAgICBzZWdtZW50Xy5zZXQoaW5kZXgsIGJ1aWxkZXJG\nb3JWYWx1ZS5idWlsZCgpKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWdtZW50QnVpbGRlcl8uc2V0TWVz\nc2FnZShpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBhZGRTZWdtZW50KG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50IHZh\nbHVlKSB7CiAgICAgICAgaWYgKHNlZ21lbnRCdWlsZGVyXyA9PSBudWxsKSB7\nCiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICB0\naHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAgIH0K\nICAgICAgICAgIGVuc3VyZVNlZ21lbnRJc011dGFibGUoKTsKICAgICAgICAg\nIHNlZ21lbnRfLmFkZCh2YWx1ZSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2VnbWVudEJ1aWxkZXJfLmFk\nZE1lc3NhZ2UodmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRTZWdtZW50KAog\nICAgICAgICAgaW50IGluZGV4LCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudCB2\nYWx1ZSkgewogICAgICAgIGlmIChzZWdtZW50QnVpbGRlcl8gPT0gbnVsbCkg\newogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICB9\nCiAgICAgICAgICBlbnN1cmVTZWdtZW50SXNNdXRhYmxlKCk7CiAgICAgICAg\nICBzZWdtZW50Xy5hZGQoaW5kZXgsIHZhbHVlKTsKICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzZWdtZW50QnVp\nbGRlcl8uYWRkTWVzc2FnZShpbmRleCwgdmFsdWUpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBhZGRTZWdtZW50KAogICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21l\nbnQuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAoc2Vn\nbWVudEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGVuc3VyZVNlZ21l\nbnRJc011dGFibGUoKTsKICAgICAgICAgIHNlZ21lbnRfLmFkZChidWlsZGVy\nRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgc2VnbWVudEJ1aWxkZXJfLmFkZE1l\nc3NhZ2UoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBhZGRTZWdtZW50KAogICAgICAgICAgaW50IGluZGV4LCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFG\nb3JtYXQuU2VnbWVudC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAg\nICAgIGlmIChzZWdtZW50QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\nZW5zdXJlU2VnbWVudElzTXV0YWJsZSgpOwogICAgICAgICAgc2VnbWVudF8u\nYWRkKGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2Vn\nbWVudEJ1aWxkZXJfLmFkZE1lc3NhZ2UoaW5kZXgsIGJ1aWxkZXJGb3JWYWx1\nZS5idWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkQWxsU2VnbWVudCgKICAg\nICAgICAgIGphdmEubGFuZy5JdGVyYWJsZTw/IGV4dGVuZHMgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRh\nRm9ybWF0LlNlZ21lbnQ+IHZhbHVlcykgewogICAgICAgIGlmIChzZWdtZW50\nQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgZW5zdXJlU2VnbWVudElz\nTXV0YWJsZSgpOwogICAgICAgICAgc3VwZXIuYWRkQWxsKHZhbHVlcywgc2Vn\nbWVudF8pOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHNlZ21lbnRCdWlsZGVyXy5hZGRBbGxNZXNzYWdlcyh2\nYWx1ZXMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclNlZ21lbnQoKSB7CiAgICAg\nICAgaWYgKHNlZ21lbnRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBz\nZWdtZW50XyA9IGphdmEudXRpbC5Db2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsK\nICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAw\nMDIwKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICBzZWdtZW50QnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgcmVtb3ZlU2VnbWVudChpbnQgaW5kZXgpIHsKICAgICAgICBpZiAo\nc2VnbWVudEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGVuc3VyZVNl\nZ21lbnRJc011dGFibGUoKTsKICAgICAgICAgIHNlZ21lbnRfLnJlbW92ZShp\nbmRleCk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgc2VnbWVudEJ1aWxkZXJfLnJlbW92ZShpbmRleCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudC5CdWlsZGVyIGdldFNlZ21l\nbnRCdWlsZGVyKAogICAgICAgICAgaW50IGluZGV4KSB7CiAgICAgICAgcmV0\ndXJuIGdldFNlZ21lbnRGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKGluZGV4\nKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21l\nbnRPckJ1aWxkZXIgZ2V0U2VnbWVudE9yQnVpbGRlcigKICAgICAgICAgIGlu\ndCBpbmRleCkgewogICAgICAgIGlmIChzZWdtZW50QnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgcmV0dXJuIHNlZ21lbnRfLmdldChpbmRleCk7ICB9\nIGVsc2UgewogICAgICAgICAgcmV0dXJuIHNlZ21lbnRCdWlsZGVyXy5nZXRN\nZXNzYWdlT3JCdWlsZGVyKGluZGV4KTsKICAgICAgICB9CiAgICAgIH0KICAg\nICAgcHVibGljIGphdmEudXRpbC5MaXN0PD8gZXh0ZW5kcyBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFG\nb3JtYXQuU2VnbWVudE9yQnVpbGRlcj4gCiAgICAgICAgICAgZ2V0U2VnbWVu\ndE9yQnVpbGRlckxpc3QoKSB7CiAgICAgICAgaWYgKHNlZ21lbnRCdWlsZGVy\nXyAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gc2VnbWVudEJ1aWxkZXJf\nLmdldE1lc3NhZ2VPckJ1aWxkZXJMaXN0KCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIHJldHVybiBqYXZhLnV0aWwuQ29sbGVjdGlvbnMudW5tb2Rp\nZmlhYmxlTGlzdChzZWdtZW50Xyk7CiAgICAgICAgfQogICAgICB9CiAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1h\ndHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudC5CdWlsZGVyIGFkZFNl\nZ21lbnRCdWlsZGVyKCkgewogICAgICAgIHJldHVybiBnZXRTZWdtZW50Rmll\nbGRCdWlsZGVyKCkuYWRkQnVpbGRlcigKICAgICAgICAgICAgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRh\nRm9ybWF0LlNlZ21lbnQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpOwogICAgICB9\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0\nYUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudC5CdWlsZGVy\nIGFkZFNlZ21lbnRCdWlsZGVyKAogICAgICAgICAgaW50IGluZGV4KSB7CiAg\nICAgICAgcmV0dXJuIGdldFNlZ21lbnRGaWVsZEJ1aWxkZXIoKS5hZGRCdWls\nZGVyKAogICAgICAgICAgICBpbmRleCwgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21l\nbnQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBqYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudC5CdWls\nZGVyPiAKICAgICAgICAgICBnZXRTZWdtZW50QnVpbGRlckxpc3QoKSB7CiAg\nICAgICAgcmV0dXJuIGdldFNlZ21lbnRGaWVsZEJ1aWxkZXIoKS5nZXRCdWls\nZGVyTGlzdCgpOwogICAgICB9CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5w\ncm90b2J1Zi5SZXBlYXRlZEZpZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRh\nZGF0YUZvcm1hdC5TZWdtZW50LCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudC5C\ndWlsZGVyLCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1h\ndHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudE9yQnVpbGRlcj4gCiAg\nICAgICAgICBnZXRTZWdtZW50RmllbGRCdWlsZGVyKCkgewogICAgICAgIGlm\nIChzZWdtZW50QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgc2VnbWVu\ndEJ1aWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuUmVwZWF0ZWRG\naWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlNl\nZ21lbnQsIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5TZWdtZW50LkJ1aWxkZXIsIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRh\nZGF0YUZvcm1hdC5TZWdtZW50T3JCdWlsZGVyPigKICAgICAgICAgICAgICAg\nICAgc2VnbWVudF8sCiAgICAgICAgICAgICAgICAgICgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwMjApID09IDB4MDAwMDAwMjApLAogICAgICAgICAgICAgICAg\nICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLAogICAgICAgICAgICAgICAgICBp\nc0NsZWFuKCkpOwogICAgICAgICAgc2VnbWVudF8gPSBudWxsOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gc2VnbWVudEJ1aWxkZXJfOwogICAgICB9CiAg\nICAgIAogICAgICAvLyBvcHRpb25hbCAuTGVkZ2VyTWV0YWRhdGFGb3JtYXQu\nRGlnZXN0VHlwZSBkaWdlc3RUeXBlID0gNzsKICAgICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0\nYWRhdGFGb3JtYXQuRGlnZXN0VHlwZSBkaWdlc3RUeXBlXyA9IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0\nYUZvcm1hdC5EaWdlc3RUeXBlLkNSQzMyOwogICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNEaWdlc3RUeXBlKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDQwKSA9PSAweDAwMDAwMDQwKTsKICAgICAgfQogICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LkRpZ2VzdFR5cGUgZ2V0RGlnZXN0\nVHlwZSgpIHsKICAgICAgICByZXR1cm4gZGlnZXN0VHlwZV87CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RGlnZXN0VHlwZShvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFG\nb3JtYXQuRGlnZXN0VHlwZSB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9\nPSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNl\ncHRpb24oKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAw\nMDAwMDQwOwogICAgICAgIGRpZ2VzdFR5cGVfID0gdmFsdWU7CiAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xlYXJEaWdlc3RUeXBlKCkgewogICAgICAg\nIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDQwKTsKICAg\nICAgICBkaWdlc3RUeXBlXyA9IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5EaWdlc3RUeXBl\nLkNSQzMyOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCBieXRlcyBw\nYXNzd29yZCA9IDg7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIHBhc3N3b3JkXyA9IGNvbS5nb29nbGUucHJvdG9idWYu\nQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzUGFz\nc3dvcmQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAw\nMDAwODApID09IDB4MDAwMDAwODApOwogICAgICB9CiAgICAgIHB1YmxpYyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0UGFzc3dvcmQoKSB7\nCiAgICAgICAgcmV0dXJuIHBhc3N3b3JkXzsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRQYXNzd29yZChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkg\newogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQog\nIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDA4MDsKICAgICAgICBwYXNzd29yZF8g\nPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclBhc3N3\nb3JkKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDgwKTsKICAgICAgICBwYXNzd29yZF8gPSBnZXREZWZhdWx0SW5z\ndGFuY2UoKS5nZXRQYXNzd29yZCgpOwogICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBv\ncHRpb25hbCBpbnQzMiBhY2tRdW9ydW1TaXplID0gOTsKICAgICAgcHJpdmF0\nZSBpbnQgYWNrUXVvcnVtU2l6ZV8gOwogICAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNBY2tRdW9ydW1TaXplKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMTAwKSA9PSAweDAwMDAwMTAwKTsKICAgICAgfQogICAg\nICBwdWJsaWMgaW50IGdldEFja1F1b3J1bVNpemUoKSB7CiAgICAgICAgcmV0\ndXJuIGFja1F1b3J1bVNpemVfOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIHNldEFja1F1b3J1bVNpemUoaW50IHZhbHVlKSB7CiAgICAgICAgYml0\nRmllbGQwXyB8PSAweDAwMDAwMTAwOwogICAgICAgIGFja1F1b3J1bVNpemVf\nID0gdmFsdWU7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJBY2tR\ndW9ydW1TaXplKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQw\nXyAmIH4weDAwMDAwMTAwKTsKICAgICAgICBhY2tRdW9ydW1TaXplXyA9IDA7\nCiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2lu\ndChidWlsZGVyX3Njb3BlOkxlZGdlck1ldGFkYXRhRm9ybWF0KQogICAgfQog\nICAgCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcg\nTGVkZ2VyTWV0YWRhdGFGb3JtYXQodHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0\nYW5jZS5pbml0RmllbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9j\nX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpMZWRnZXJNZXRhZGF0YUZv\ncm1hdCkKICB9CiAgCiAgcHVibGljIGludGVyZmFjZSBMZWRnZXJSZXJlcGxp\nY2F0aW9uTGF5b3V0Rm9ybWF0T3JCdWlsZGVyCiAgICAgIGV4dGVuZHMgY29t\nLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsKICAgIAogICAg\nLy8gcmVxdWlyZWQgc3RyaW5nIHR5cGUgPSAxOwogICAgYm9vbGVhbiBoYXNU\neXBlKCk7CiAgICBTdHJpbmcgZ2V0VHlwZSgpOwogICAgCiAgICAvLyByZXF1\naXJlZCBpbnQzMiB2ZXJzaW9uID0gMjsKICAgIGJvb2xlYW4gaGFzVmVyc2lv\nbigpOwogICAgaW50IGdldFZlcnNpb24oKTsKICB9CiAgcHVibGljIHN0YXRp\nYyBmaW5hbCBjbGFzcyBMZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0\nIGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRN\nZXNzYWdlCiAgICAgIGltcGxlbWVudHMgTGVkZ2VyUmVyZXBsaWNhdGlvbkxh\neW91dEZvcm1hdE9yQnVpbGRlciB7CiAgICAvLyBVc2UgTGVkZ2VyUmVyZXBs\naWNhdGlvbkxheW91dEZvcm1hdC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0\nLgogICAgcHJpdmF0ZSBMZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0\nKEJ1aWxkZXIgYnVpbGRlcikgewogICAgICBzdXBlcihidWlsZGVyKTsKICAg\nIH0KICAgIHByaXZhdGUgTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1h\ndChib29sZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdCBkZWZhdWx0\nSW5zdGFuY2U7CiAgICBwdWJsaWMgc3RhdGljIExlZGdlclJlcmVwbGljYXRp\nb25MYXlvdXRGb3JtYXQgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICBy\nZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMg\nTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdCBnZXREZWZhdWx0SW5z\ndGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNl\nOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29n\nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgIGdl\ndERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxfc3RhdGljX0xlZGdl\nclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXRfZGVzY3JpcHRvcjsKICAgIH0K\nICAgIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5h\nbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5pbnRlcm5hbF9z\ndGF0aWNfTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdF9maWVsZEFj\nY2Vzc29yVGFibGU7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IGJpdEZp\nZWxkMF87CiAgICAvLyByZXF1aXJlZCBzdHJpbmcgdHlwZSA9IDE7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBUWVBFX0ZJRUxEX05VTUJFUiA9IDE7\nCiAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgdHlwZV87CiAgICBwdWJs\naWMgYm9vbGVhbiBoYXNUeXBlKCkgewogICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICB9CiAgICBw\ndWJsaWMgU3RyaW5nIGdldFR5cGUoKSB7CiAgICAgIGphdmEubGFuZy5PYmpl\nY3QgcmVmID0gdHlwZV87CiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJp\nbmcpIHsKICAgICAgICByZXR1cm4gKFN0cmluZykgcmVmOwogICAgICB9IGVs\nc2UgewogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBi\ncyA9IAogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nKSByZWY7CiAgICAgICAgU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0Zjgo\nKTsKICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5p\nc1ZhbGlkVXRmOChicykpIHsKICAgICAgICAgIHR5cGVfID0gczsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICAgIH0KICAgIH0KICAgIHByaXZh\ndGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFR5cGVCeXRl\ncygpIHsKICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSB0eXBlXzsKICAg\nICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gCiAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoKFN0\ncmluZykgcmVmKTsKICAgICAgICB0eXBlXyA9IGI7CiAgICAgICAgcmV0dXJu\nIGI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgfQogICAgfQogICAg\nCiAgICAvLyByZXF1aXJlZCBpbnQzMiB2ZXJzaW9uID0gMjsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IFZFUlNJT05fRklFTERfTlVNQkVSID0gMjsK\nICAgIHByaXZhdGUgaW50IHZlcnNpb25fOwogICAgcHVibGljIGJvb2xlYW4g\naGFzVmVyc2lvbigpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAgfQogICAgcHVibGljIGlu\ndCBnZXRWZXJzaW9uKCkgewogICAgICByZXR1cm4gdmVyc2lvbl87CiAgICB9\nCiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICB0\neXBlXyA9ICIiOwogICAgICB2ZXJzaW9uXyA9IDA7CiAgICB9CiAgICBwcml2\nYXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7CiAgICBwdWJs\naWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBieXRl\nIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAgICAg\nIGlmIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4gaXNJbml0aWFsaXpl\nZCA9PSAxOwogICAgICAKICAgICAgaWYgKCFoYXNUeXBlKCkpIHsKICAgICAg\nICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgfQogICAgICBpZiAoIWhhc1ZlcnNpb24oKSkgewogICAg\nICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICB9CiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9\nIDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwdWJsaWMg\ndm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6ZWRTaXpl\nKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAw\neDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDEsIGdl\ndFR5cGVCeXRlcygpKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBvdXRw\ndXQud3JpdGVJbnQzMigyLCB2ZXJzaW9uXyk7CiAgICAgIH0KICAgICAgZ2V0\nVW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAog\nICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwog\nICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50\nIHNpemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6\nZSAhPSAtMSkgcmV0dXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAg\nICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAw\nMDAxKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUo\nMSwgZ2V0VHlwZUJ5dGVzKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAg\nIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVh\nbQogICAgICAgICAgLmNvbXB1dGVJbnQzMlNpemUoMiwgdmVyc2lvbl8pOwog\nICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNl\ncmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUg\nPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsKICAgIH0KICAgIAogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7\nCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgamF2YS5s\nYW5nLk9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAgICAgIHRocm93cyBqYXZh\nLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBzdXBl\nci53cml0ZVJlcGxhY2UoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVk\nZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdCBwYXJzZUZyb20oCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAg\nICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLkxlZGdlclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXQgcGFyc2VGcm9t\nKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRh\nLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlclJlcmVwbGljYXRpb25M\nYXlvdXRGb3JtYXQgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0IHBhcnNlRnJvbSgKICAg\nICAgICBieXRlW10gZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAg\nICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRn\nZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0IHBhcnNlRnJvbShqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0IHBhcnNlRnJvbSgKICAg\nICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlclJlcmVwbGljYXRpb25M\nYXlvdXRGb3JtYXQgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAg\nICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkpIHsK\nICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9\nIGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5MZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0IHBh\ncnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFt\nIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9u\nUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVy\nID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGlt\naXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAg\nIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLkxlZGdlclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXQgcGFyc2VGcm9t\nKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVh\nbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5i\ndWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyUmVyZXBs\naWNhdGlvbkxheW91dEZvcm1hdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\naW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBCdWls\nZGVyIG5ld0J1aWxkZXIoKSB7IHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOyB9\nCiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0\ndXJuIG5ld0J1aWxkZXIoKTsgfQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVy\nIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLkxlZGdlclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXQgcHJvdG90\neXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHBy\nb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIo\nKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZh\nLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxk\nZXJGb3JUeXBlKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWls\nZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1\ncm4gYnVpbGRlcjsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xh\nc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGlt\ncGxlbWVudHMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLkxlZGdlclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXRPckJ1aWxkZXIg\newogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9i\ndWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3Jp\ncHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLmludGVybmFsX3N0YXRpY19MZWRnZXJSZXJl\ncGxpY2F0aW9uTGF5b3V0Rm9ybWF0X2Rlc2NyaXB0b3I7CiAgICAgIH0KICAg\nICAgCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRl\ncm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLmludGVy\nbmFsX3N0YXRpY19MZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0X2Zp\nZWxkQWNjZXNzb3JUYWJsZTsKICAgICAgfQogICAgICAKICAgICAgLy8gQ29u\nc3RydWN0IHVzaW5nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRh\nRm9ybWF0cy5MZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0Lm5ld0J1\naWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7CiAgICAgICAgbWF5\nYmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAgICAg\nIAogICAgICBwcml2YXRlIEJ1aWxkZXIoQnVpbGRlclBhcmVudCBwYXJlbnQp\nIHsKICAgICAgICBzdXBlcihwYXJlbnQpOwogICAgICAgIG1heWJlRm9yY2VC\ndWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICBwcml2YXRl\nIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsKICAg\nICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFy\nKCk7CiAgICAgICAgdHlwZV8gPSAiIjsKICAgICAgICBiaXRGaWVsZDBfID0g\nKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgdmVyc2lvbl8g\nPSAwOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAw\nMDAwMDAyKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJu\nIGNyZWF0ZSgpLm1lcmdlRnJvbShidWlsZFBhcnRpYWwoKSk7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2Ny\naXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JU\neXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZv\ncm1hdC5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdCBnZXREZWZhdWx0SW5z\ndGFuY2VGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyUmVyZXBsaWNhdGlv\nbkxheW91dEZvcm1hdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5MZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0\nIGJ1aWxkKCkgewogICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5MZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0\nIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0\nLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0\naWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHJp\ndmF0ZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdCBidWlsZFBhcnNlZCgp\nCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlk\nUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJSZXJlcGxpY2F0\naW9uTGF5b3V0Rm9ybWF0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAg\nICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAg\ndGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAg\nICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRp\nb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5MZWRnZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9y\nbWF0IGJ1aWxkUGFydGlhbCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyUmVyZXBsaWNhdGlvbkxh\neW91dEZvcm1hdCByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlclJlcmVwbGljYXRpb25MYXlvdXRG\nb3JtYXQodGhpcyk7CiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJp\ndEZpZWxkMF87CiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOwogICAg\nICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4\nMDAwMDAwMDEpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDE7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC50eXBlXyA9IHR5cGVf\nOwogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDIp\nID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9\nIDB4MDAwMDAwMDI7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC52ZXJzaW9u\nXyA9IHZlcnNpb25fOwogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9f\nYml0RmllbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJu\nIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIg\nbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikg\newogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJSZXJlcGxpY2F0aW9u\nTGF5b3V0Rm9ybWF0KSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChv\ncmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2Vy\nUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdClvdGhlcik7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyUmVyZXBsaWNhdGlvbkxh\neW91dEZvcm1hdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTGVkZ2VyUmVy\nZXBsaWNhdGlvbkxheW91dEZvcm1hdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkg\ncmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKG90aGVyLmhhc1R5cGUoKSkgewog\nICAgICAgICAgc2V0VHlwZShvdGhlci5nZXRUeXBlKCkpOwogICAgICAgIH0K\nICAgICAgICBpZiAob3RoZXIuaGFzVmVyc2lvbigpKSB7CiAgICAgICAgICBz\nZXRWZXJzaW9uKG90aGVyLmdldFZlcnNpb24oKSk7CiAgICAgICAgfQogICAg\nICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25G\naWVsZHMoKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7\nCiAgICAgICAgaWYgKCFoYXNUeXBlKCkpIHsKICAgICAgICAgIAogICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIWhhc1Zl\ncnNpb24oKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3\nQnVpbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkp\nOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0g\naW5wdXQucmVhZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAg\nICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93\nbkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVu\na25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0\nYWcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHMo\ndW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGNhc2UgMTA6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgICAgICAgdHlwZV8gPSBpbnB1dC5y\nZWFkQnl0ZXMoKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBjYXNlIDE2OiB7CiAgICAgICAgICAgICAgYml0Rmll\nbGQwXyB8PSAweDAwMDAwMDAyOwogICAgICAgICAgICAgIHZlcnNpb25fID0g\naW5wdXQucmVhZEludDMyKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAg\nCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAgIAogICAgICAv\nLyByZXF1aXJlZCBzdHJpbmcgdHlwZSA9IDE7CiAgICAgIHByaXZhdGUgamF2\nYS5sYW5nLk9iamVjdCB0eXBlXyA9ICIiOwogICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNUeXBlKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAw\neDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgICAgfQogICAgICBwdWJs\naWMgU3RyaW5nIGdldFR5cGUoKSB7CiAgICAgICAgamF2YS5sYW5nLk9iamVj\ndCByZWYgPSB0eXBlXzsKICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBT\ndHJpbmcpKSB7CiAgICAgICAgICBTdHJpbmcgcyA9ICgoY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nKSByZWYpLnRvU3RyaW5nVXRmOCgpOwogICAg\nICAgICAgdHlwZV8gPSBzOwogICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIHJldHVybiAoU3RyaW5nKSByZWY7CiAgICAg\nICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFR5cGUoU3Ry\naW5nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAg\nIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICBiaXRG\naWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgdHlwZV8gPSB2YWx1ZTsK\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclR5cGUoKSB7CiAgICAg\nICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwog\nICAgICAgIHR5cGVfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0VHlwZSgp\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHZvaWQgc2V0VHlwZShjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDE7CiAgICAgICAgdHlwZV8gPSB2YWx1ZTsKICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgfQogICAgICAKICAgICAgLy8gcmVxdWlyZWQgaW50\nMzIgdmVyc2lvbiA9IDI7CiAgICAgIHByaXZhdGUgaW50IHZlcnNpb25fIDsK\nICAgICAgcHVibGljIGJvb2xlYW4gaGFzVmVyc2lvbigpIHsKICAgICAgICBy\nZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAw\nMik7CiAgICAgIH0KICAgICAgcHVibGljIGludCBnZXRWZXJzaW9uKCkgewog\nICAgICAgIHJldHVybiB2ZXJzaW9uXzsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRWZXJzaW9uKGludCB2YWx1ZSkgewogICAgICAgIGJpdEZp\nZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICB2ZXJzaW9uXyA9IHZhbHVl\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVmVyc2lvbigpIHsK\nICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAw\nMik7CiAgICAgICAgdmVyc2lvbl8gPSAwOwogICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAv\nLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpMZWRn\nZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0KQogICAgfQogICAgCiAgICBz\ndGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgTGVkZ2VyUmVy\nZXBsaWNhdGlvbkxheW91dEZvcm1hdCh0cnVlKTsKICAgICAgZGVmYXVsdElu\nc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90\nb2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkxlZGdlclJlcmVwbGlj\nYXRpb25MYXlvdXRGb3JtYXQpCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2Ug\nVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0T3JCdWlsZGVyCiAgICAgIGV4\ndGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsK\nICAgIAogICAgLy8gcmVwZWF0ZWQgc3RyaW5nIHJlcGxpY2EgPSAxOwogICAg\namF2YS51dGlsLkxpc3Q8U3RyaW5nPiBnZXRSZXBsaWNhTGlzdCgpOwogICAg\naW50IGdldFJlcGxpY2FDb3VudCgpOwogICAgU3RyaW5nIGdldFJlcGxpY2Eo\naW50IGluZGV4KTsKICB9CiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBV\nbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQgZXh0ZW5kcwogICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVt\nZW50cyBVbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXRPckJ1aWxkZXIgewog\nICAgLy8gVXNlIFVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdC5uZXdCdWls\nZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJpdmF0ZSBVbmRlcnJlcGxpY2F0\nZWRMZWRnZXJGb3JtYXQoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVy\nKGJ1aWxkZXIpOwogICAgfQogICAgcHJpdmF0ZSBVbmRlcnJlcGxpY2F0ZWRM\nZWRnZXJGb3JtYXQoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIFVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdCBk\nZWZhdWx0SW5zdGFuY2U7CiAgICBwdWJsaWMgc3RhdGljIFVuZGVycmVwbGlj\nYXRlZExlZGdlckZvcm1hdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAg\nIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBVbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQgZ2V0RGVmYXVsdEluc3Rh\nbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXRE\nZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLmludGVybmFsX3N0YXRpY19VbmRlcnJl\ncGxpY2F0ZWRMZWRnZXJGb3JtYXRfZGVzY3JpcHRvcjsKICAgIH0KICAgIAog\nICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZp\nZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5pbnRlcm5hbF9zdGF0aWNf\nVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0X2ZpZWxkQWNjZXNzb3JUYWJs\nZTsKICAgIH0KICAgIAogICAgLy8gcmVwZWF0ZWQgc3RyaW5nIHJlcGxpY2Eg\nPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUkVQTElDQV9GSUVM\nRF9OVU1CRVIgPSAxOwogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVm\nLkxhenlTdHJpbmdMaXN0IHJlcGxpY2FfOwogICAgcHVibGljIGphdmEudXRp\nbC5MaXN0PFN0cmluZz4KICAgICAgICBnZXRSZXBsaWNhTGlzdCgpIHsKICAg\nICAgcmV0dXJuIHJlcGxpY2FfOwogICAgfQogICAgcHVibGljIGludCBnZXRS\nZXBsaWNhQ291bnQoKSB7CiAgICAgIHJldHVybiByZXBsaWNhXy5zaXplKCk7\nCiAgICB9CiAgICBwdWJsaWMgU3RyaW5nIGdldFJlcGxpY2EoaW50IGluZGV4\nKSB7CiAgICAgIHJldHVybiByZXBsaWNhXy5nZXQoaW5kZXgpOwogICAgfQog\nICAgCiAgICBwcml2YXRlIHZvaWQgaW5pdEZpZWxkcygpIHsKICAgICAgcmVw\nbGljYV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkxhenlTdHJpbmdBcnJheUxp\nc3QuRU1QVFk7CiAgICB9CiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0lu\naXRpYWxpemVkID0gLTE7CiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0lu\naXRpYWxpemVkKCkgewogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1v\naXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgIGlmIChpc0luaXRpYWxpemVkICE9\nIC0xKSByZXR1cm4gaXNJbml0aWFsaXplZCA9PSAxOwogICAgICAKICAgICAg\nbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsKICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCByZXBsaWNhXy5zaXplKCk7IGkrKykgewogICAgICAgIG91dHB1\ndC53cml0ZUJ5dGVzKDEsIHJlcGxpY2FfLmdldEJ5dGVTdHJpbmcoaSkpOwog\nICAgICB9CiAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1\ndCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFs\naXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNp\nemUoKSB7CiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6\nZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAg\nICAgIHNpemUgPSAwOwogICAgICB7CiAgICAgICAgaW50IGRhdGFTaXplID0g\nMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlcGxpY2FfLnNpemUo\nKTsgaSsrKSB7CiAgICAgICAgICBkYXRhU2l6ZSArPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAgIC5jb21wdXRl\nQnl0ZXNTaXplTm9UYWcocmVwbGljYV8uZ2V0Qnl0ZVN0cmluZyhpKSk7CiAg\nICAgICAgfQogICAgICAgIHNpemUgKz0gZGF0YVNpemU7CiAgICAgICAgc2l6\nZSArPSAxICogZ2V0UmVwbGljYUxpc3QoKS5zaXplKCk7CiAgICAgIH0KICAg\nICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNp\nemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAg\nICAgIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAgIEBqYXZh\nLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcuT2JqZWN0\nIHdyaXRlUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uT2JqZWN0\nU3RyZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndyaXRlUmVw\nbGFjZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0\nZWRMZWRnZXJGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEp\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxp\nY2F0ZWRMZWRnZXJGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLlVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdCBwYXJzZUZyb20o\nYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQo\nKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLlVuZGVycmVwbGljYXRlZExlZGdlckZv\ncm1hdCBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0IHBh\ncnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQgcGFy\nc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAg\nIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuVW5kZXJyZXBs\naWNhdGVkTGVkZ2VyRm9ybWF0IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRl\ncigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5w\ndXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsK\nICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG8uRGF0YUZvcm1hdHMuVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0\nIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWls\nZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURl\nbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLlVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdCBwYXJzZUZyb20o\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0\nZWRMZWRnZXJGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0\nLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBu\nZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAg\ncHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBu\nZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdC\ndWlsZGVyKG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5VbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQgcHJvdG90eXBlKSB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7\nCiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVy\nbiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3Zl\ncnJpZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBl\nKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5CdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxk\nZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRl\ncjsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRl\nciBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLlVuZGVy\ncmVwbGljYXRlZExlZGdlckZvcm1hdE9yQnVpbGRlciB7CiAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAg\nICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuaW50ZXJuYWxfc3RhdGljX1VuZGVycmVwbGljYXRlZExlZGdlckZv\ncm1hdF9kZXNjcmlwdG9yOwogICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0\nZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vz\nc29yVGFibGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5pbnRlcm5hbF9zdGF0aWNfVW5kZXJy\nZXBsaWNhdGVkTGVkZ2VyRm9ybWF0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nICAgfQogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0\nZWRMZWRnZXJGb3JtYXQubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVp\nbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRlcihC\ndWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVudCk7\nCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwog\nICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlcklu\naXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycykg\newogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIHN0YXRpYyBCdWls\nZGVyIGNyZWF0ZSgpIHsKICAgICAgICByZXR1cm4gbmV3IEJ1aWxkZXIoKTsK\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7\nCiAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICByZXBsaWNhXyA9IGNv\nbS5nb29nbGUucHJvdG9idWYuTGF6eVN0cmluZ0FycmF5TGlzdC5FTVBUWTsK\nICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAw\nMSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVh\ndGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgp\nIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkRhdGFGb3JtYXRzLlVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdC5nZXRE\nZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuVW5kZXJyZXBs\naWNhdGVkTGVkZ2VyRm9ybWF0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUo\nKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuVW5k\nZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0IGJ1aWxkKCkgewogICAgICAgIG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJl\ncGxpY2F0ZWRMZWRnZXJGb3JtYXQgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAg\nICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihy\nZXN1bHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAg\nICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3Jt\nYXQgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0IHJlc3VsdCA9IGJ1aWxkUGFy\ndGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkg\newogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNl\ncHRpb24oCiAgICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0ZWRM\nZWRnZXJGb3JtYXQgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0\nZWRMZWRnZXJGb3JtYXQgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0ZWRMZWRnZXJG\nb3JtYXQodGhpcyk7CiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJp\ndEZpZWxkMF87CiAgICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgICByZXBsaWNhXyA9IG5l\ndyBjb20uZ29vZ2xlLnByb3RvYnVmLlVubW9kaWZpYWJsZUxhenlTdHJpbmdM\naXN0KAogICAgICAgICAgICAgIHJlcGxpY2FfKTsKICAgICAgICAgIGJpdEZp\nZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICB9\nCiAgICAgICAgcmVzdWx0LnJlcGxpY2FfID0gcmVwbGljYV87CiAgICAgICAg\nb25CdWlsdCgpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xl\nLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIg\naW5zdGFuY2VvZiBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0KSB7CiAgICAgICAg\nICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0KW90\naGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VG\ncm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9t\nKG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRl\ncnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQgb3RoZXIpIHsKICAgICAgICBpZiAo\nb3RoZXIgPT0gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3Jt\nYXRzLlVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdC5nZXREZWZhdWx0SW5z\ndGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKCFvdGhlci5yZXBs\naWNhXy5pc0VtcHR5KCkpIHsKICAgICAgICAgIGlmIChyZXBsaWNhXy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgcmVwbGljYV8gPSBvdGhlci5yZXBsaWNh\nXzsKICAgICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4\nMDAwMDAwMDEpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW5z\ndXJlUmVwbGljYUlzTXV0YWJsZSgpOwogICAgICAgICAgICByZXBsaWNhXy5h\nZGRBbGwob3RoZXIucmVwbGljYV8pOwogICAgICAgICAgfQogICAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVyZ2VVbmtu\nb3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBmaW5h\nbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdl\nRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1\ndFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5r\nbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVu\na25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAgICB0aGlzLmdl\ndFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAg\nICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAgICAgICBz\nd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAg\nICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQo\nKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAg\nICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmll\nbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0\nZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAgICAgIHRoaXMu\nc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAg\nICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxMDogewogICAgICAg\nICAgICAgIGVuc3VyZVJlcGxpY2FJc011dGFibGUoKTsKICAgICAgICAgICAg\nICByZXBsaWNhXy5hZGQoaW5wdXQucmVhZEJ5dGVzKCkpOwogICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBiaXRGaWVsZDBf\nOwogICAgICAKICAgICAgLy8gcmVwZWF0ZWQgc3RyaW5nIHJlcGxpY2EgPSAx\nOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuTGF6eVN0cmlu\nZ0xpc3QgcmVwbGljYV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkxhenlTdHJp\nbmdBcnJheUxpc3QuRU1QVFk7CiAgICAgIHByaXZhdGUgdm9pZCBlbnN1cmVS\nZXBsaWNhSXNNdXRhYmxlKCkgewogICAgICAgIGlmICghKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHJl\ncGxpY2FfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuTGF6eVN0cmluZ0Fy\ncmF5TGlzdChyZXBsaWNhXyk7CiAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDE7CiAgICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgamF2\nYS51dGlsLkxpc3Q8U3RyaW5nPgogICAgICAgICAgZ2V0UmVwbGljYUxpc3Qo\nKSB7CiAgICAgICAgcmV0dXJuIGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1v\nZGlmaWFibGVMaXN0KHJlcGxpY2FfKTsKICAgICAgfQogICAgICBwdWJsaWMg\naW50IGdldFJlcGxpY2FDb3VudCgpIHsKICAgICAgICByZXR1cm4gcmVwbGlj\nYV8uc2l6ZSgpOwogICAgICB9CiAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0UmVw\nbGljYShpbnQgaW5kZXgpIHsKICAgICAgICByZXR1cm4gcmVwbGljYV8uZ2V0\nKGluZGV4KTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXBs\naWNhKAogICAgICAgICAgaW50IGluZGV4LCBTdHJpbmcgdmFsdWUpIHsKICAg\nICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQ\nb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIGVuc3VyZVJlcGxpY2FJc011dGFi\nbGUoKTsKICAgICAgICByZXBsaWNhXy5zZXQoaW5kZXgsIHZhbHVlKTsKICAg\nICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZXBsaWNhKFN0cmluZyB2YWx1\nZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBu\nZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICB9CiAgZW5zdXJlUmVwbGlj\nYUlzTXV0YWJsZSgpOwogICAgICAgIHJlcGxpY2FfLmFkZCh2YWx1ZSk7CiAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkQWxsUmVwbGljYSgKICAgICAg\nICAgIGphdmEubGFuZy5JdGVyYWJsZTxTdHJpbmc+IHZhbHVlcykgewogICAg\nICAgIGVuc3VyZVJlcGxpY2FJc011dGFibGUoKTsKICAgICAgICBzdXBlci5h\nZGRBbGwodmFsdWVzLCByZXBsaWNhXyk7CiAgICAgICAgb25DaGFuZ2VkKCk7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgY2xlYXJSZXBsaWNhKCkgewogICAgICAgIHJlcGxpY2FfID0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5MYXp5U3RyaW5nQXJyYXlMaXN0LkVNUFRZOwog\nICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAx\nKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICB2b2lkIGFkZFJlcGxpY2EoY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgZW5zdXJlUmVwbGlj\nYUlzTXV0YWJsZSgpOwogICAgICAgIHJlcGxpY2FfLmFkZCh2YWx1ZSk7CiAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIEBA\ncHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOlVuZGVycmVw\nbGljYXRlZExlZGdlckZvcm1hdCkKICAgIH0KICAgIAogICAgc3RhdGljIHsK\nICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFVuZGVycmVwbGljYXRlZExl\nZGdlckZvcm1hdCh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRG\naWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9u\nX3BvaW50KGNsYXNzX3Njb3BlOlVuZGVycmVwbGljYXRlZExlZGdlckZvcm1h\ndCkKICB9CiAgCiAgcHVibGljIGludGVyZmFjZSBDb29raWVGb3JtYXRPckJ1\naWxkZXIKICAgICAgZXh0ZW5kcyBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3Nh\nZ2VPckJ1aWxkZXIgewogICAgCiAgICAvLyByZXF1aXJlZCBzdHJpbmcgYm9v\na2llSG9zdCA9IDE7CiAgICBib29sZWFuIGhhc0Jvb2tpZUhvc3QoKTsKICAg\nIFN0cmluZyBnZXRCb29raWVIb3N0KCk7CiAgICAKICAgIC8vIHJlcXVpcmVk\nIHN0cmluZyBqb3VybmFsRGlyID0gMjsKICAgIGJvb2xlYW4gaGFzSm91cm5h\nbERpcigpOwogICAgU3RyaW5nIGdldEpvdXJuYWxEaXIoKTsKICAgIAogICAg\nLy8gcmVxdWlyZWQgc3RyaW5nIGxlZGdlckRpcnMgPSAzOwogICAgYm9vbGVh\nbiBoYXNMZWRnZXJEaXJzKCk7CiAgICBTdHJpbmcgZ2V0TGVkZ2VyRGlycygp\nOwogICAgCiAgICAvLyBvcHRpb25hbCBzdHJpbmcgaW5zdGFuY2VJZCA9IDQ7\nCiAgICBib29sZWFuIGhhc0luc3RhbmNlSWQoKTsKICAgIFN0cmluZyBnZXRJ\nbnN0YW5jZUlkKCk7CiAgfQogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3Mg\nQ29va2llRm9ybWF0IGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlCiAgICAgIGltcGxlbWVudHMgQ29va2llRm9y\nbWF0T3JCdWlsZGVyIHsKICAgIC8vIFVzZSBDb29raWVGb3JtYXQubmV3QnVp\nbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgQ29va2llRm9ybWF0\nKEJ1aWxkZXIgYnVpbGRlcikgewogICAgICBzdXBlcihidWlsZGVyKTsKICAg\nIH0KICAgIHByaXZhdGUgQ29va2llRm9ybWF0KGJvb2xlYW4gbm9Jbml0KSB7\nfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDb29raWVGb3JtYXQg\nZGVmYXVsdEluc3RhbmNlOwogICAgcHVibGljIHN0YXRpYyBDb29raWVGb3Jt\nYXQgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVs\ndEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgQ29va2llRm9ybWF0\nIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBk\nZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlw\ndG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5pbnRlcm5h\nbF9zdGF0aWNfQ29va2llRm9ybWF0X2Rlc2NyaXB0b3I7CiAgICB9CiAgICAK\nICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRG\naWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxfc3RhdGlj\nX0Nvb2tpZUZvcm1hdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAvLyByZXF1aXJlZCBz\ndHJpbmcgYm9va2llSG9zdCA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBCT09LSUVIT1NUX0ZJRUxEX05VTUJFUiA9IDE7CiAgICBwcml2YXRl\nIGphdmEubGFuZy5PYmplY3QgYm9va2llSG9zdF87CiAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNCb29raWVIb3N0KCkgewogICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICB9CiAgICBw\ndWJsaWMgU3RyaW5nIGdldEJvb2tpZUhvc3QoKSB7CiAgICAgIGphdmEubGFu\nZy5PYmplY3QgcmVmID0gYm9va2llSG9zdF87CiAgICAgIGlmIChyZWYgaW5z\ndGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICByZXR1cm4gKFN0cmluZykgcmVm\nOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQnl0ZVN0cmluZyBicyA9IAogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nKSByZWY7CiAgICAgICAgU3RyaW5nIHMgPSBicy50\nb1N0cmluZ1V0ZjgoKTsKICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnRlcm5hbC5pc1ZhbGlkVXRmOChicykpIHsKICAgICAgICAgIGJvb2tp\nZUhvc3RfID0gczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICAg\nIH0KICAgIH0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGdldEJvb2tpZUhvc3RCeXRlcygpIHsKICAgICAgamF2YS5sYW5n\nLk9iamVjdCByZWYgPSBib29raWVIb3N0XzsKICAgICAgaWYgKHJlZiBpbnN0\nYW5jZW9mIFN0cmluZykgewogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQnl0ZVN0cmluZyBiID0gCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoKFN0cmluZykgcmVmKTsKICAg\nICAgICBib29raWVIb3N0XyA9IGI7CiAgICAgICAgcmV0dXJuIGI7CiAgICAg\nIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgfQogICAgfQogICAgCiAgICAvLyBy\nZXF1aXJlZCBzdHJpbmcgam91cm5hbERpciA9IDI7CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBKT1VSTkFMRElSX0ZJRUxEX05VTUJFUiA9IDI7CiAg\nICBwcml2YXRlIGphdmEubGFuZy5PYmplY3Qgam91cm5hbERpcl87CiAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNKb3VybmFsRGlyKCkgewogICAgICByZXR1cm4g\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMik7CiAg\nICB9CiAgICBwdWJsaWMgU3RyaW5nIGdldEpvdXJuYWxEaXIoKSB7CiAgICAg\nIGphdmEubGFuZy5PYmplY3QgcmVmID0gam91cm5hbERpcl87CiAgICAgIGlm\nIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICByZXR1cm4gKFN0\ncmluZykgcmVmOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IAogICAgICAgICAgICAoY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7CiAgICAgICAgU3RyaW5n\nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsKICAgICAgICBpZiAoY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnRlcm5hbC5pc1ZhbGlkVXRmOChicykpIHsKICAgICAg\nICAgIGpvdXJuYWxEaXJfID0gczsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHM7CiAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIGdldEpvdXJuYWxEaXJCeXRlcygpIHsKICAgICAg\namF2YS5sYW5nLk9iamVjdCByZWYgPSBqb3VybmFsRGlyXzsKICAgICAgaWYg\nKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBiID0gCiAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoKFN0cmluZykg\ncmVmKTsKICAgICAgICBqb3VybmFsRGlyXyA9IGI7CiAgICAgICAgcmV0dXJu\nIGI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgfQogICAgfQogICAg\nCiAgICAvLyByZXF1aXJlZCBzdHJpbmcgbGVkZ2VyRGlycyA9IDM7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBMRURHRVJESVJTX0ZJRUxEX05VTUJF\nUiA9IDM7CiAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgbGVkZ2VyRGly\nc187CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNMZWRnZXJEaXJzKCkgewogICAg\nICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAw\nMDAwNCk7CiAgICB9CiAgICBwdWJsaWMgU3RyaW5nIGdldExlZGdlckRpcnMo\nKSB7CiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gbGVkZ2VyRGlyc187\nCiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICBy\nZXR1cm4gKFN0cmluZykgcmVmOwogICAgICB9IGVsc2UgewogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IAogICAgICAgICAg\nICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7CiAgICAg\nICAgU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsKICAgICAgICBpZiAo\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5pc1ZhbGlkVXRmOChicykp\nIHsKICAgICAgICAgIGxlZGdlckRpcnNfID0gczsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHM7CiAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldExlZGdlckRpcnNCeXRlcygp\nIHsKICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBsZWRnZXJEaXJzXzsK\nICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gCiAgICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nKFN0cmluZykgcmVmKTsKICAgICAgICBsZWRnZXJEaXJzXyA9IGI7CiAgICAg\nICAgcmV0dXJuIGI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIChj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgfQog\nICAgfQogICAgCiAgICAvLyBvcHRpb25hbCBzdHJpbmcgaW5zdGFuY2VJZCA9\nIDQ7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJTlNUQU5DRUlEX0ZJ\nRUxEX05VTUJFUiA9IDQ7CiAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3Qg\naW5zdGFuY2VJZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNJbnN0YW5jZUlk\nKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwOCkg\nPT0gMHgwMDAwMDAwOCk7CiAgICB9CiAgICBwdWJsaWMgU3RyaW5nIGdldElu\nc3RhbmNlSWQoKSB7CiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gaW5z\ndGFuY2VJZF87CiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsK\nICAgICAgICByZXR1cm4gKFN0cmluZykgcmVmOwogICAgICB9IGVsc2Ugewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IAog\nICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSBy\nZWY7CiAgICAgICAgU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsKICAg\nICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5pc1ZhbGlk\nVXRmOChicykpIHsKICAgICAgICAgIGluc3RhbmNlSWRfID0gczsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICAgIH0KICAgIH0KICAgIHByaXZh\ndGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldEluc3RhbmNl\nSWRCeXRlcygpIHsKICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBpbnN0\nYW5jZUlkXzsKICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gCiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgoKFN0cmluZykgcmVmKTsKICAgICAgICBpbnN0YW5jZUlkXyA9\nIGI7CiAgICAgICAgcmV0dXJuIGI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg\ncmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsK\nICAgICAgfQogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgaW5pdEZpZWxk\ncygpIHsKICAgICAgYm9va2llSG9zdF8gPSAiIjsKICAgICAgam91cm5hbERp\ncl8gPSAiIjsKICAgICAgbGVkZ2VyRGlyc18gPSAiIjsKICAgICAgaW5zdGFu\nY2VJZF8gPSAiIjsKICAgIH0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElz\nSW5pdGlhbGl6ZWQgPSAtMTsKICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlz\nSW5pdGlhbGl6ZWQoKSB7CiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1l\nbW9pemVkSXNJbml0aWFsaXplZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQg\nIT0gLTEpIHJldHVybiBpc0luaXRpYWxpemVkID09IDE7CiAgICAgIAogICAg\nICBpZiAoIWhhc0Jvb2tpZUhvc3QoKSkgewogICAgICAgIG1lbW9pemVkSXNJ\nbml0aWFsaXplZCA9IDA7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9\nCiAgICAgIGlmICghaGFzSm91cm5hbERpcigpKSB7CiAgICAgICAgbWVtb2l6\nZWRJc0luaXRpYWxpemVkID0gMDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgIH0KICAgICAgaWYgKCFoYXNMZWRnZXJEaXJzKCkpIHsKICAgICAgICBt\nZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgfQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwog\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQg\nd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nIG91dHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwog\nICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAw\nMDAwMSkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygxLCBnZXRCb29r\naWVIb3N0Qnl0ZXMoKSk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAgb3V0\ncHV0LndyaXRlQnl0ZXMoMiwgZ2V0Sm91cm5hbERpckJ5dGVzKCkpOwogICAg\nICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAw\neDAwMDAwMDA0KSkgewogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDMsIGdl\ndExlZGdlckRpcnNCeXRlcygpKTsKICAgICAgfQogICAgICBpZiAoKChiaXRG\naWVsZDBfICYgMHgwMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCkpIHsKICAgICAg\nICBvdXRwdXQud3JpdGVCeXRlcyg0LCBnZXRJbnN0YW5jZUlkQnl0ZXMoKSk7\nCiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0\ncHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJp\nYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVk\nU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRT\naXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7CiAgICAK\nICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIHNpemUgKz0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAg\nLmNvbXB1dGVCeXRlc1NpemUoMSwgZ2V0Qm9va2llSG9zdEJ5dGVzKCkpOwog\nICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9\nPSAweDAwMDAwMDAyKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVC\neXRlc1NpemUoMiwgZ2V0Sm91cm5hbERpckJ5dGVzKCkpOwogICAgICB9CiAg\nICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAw\nMDA0KSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUo\nMywgZ2V0TGVkZ2VyRGlyc0J5dGVzKCkpOwogICAgICB9CiAgICAgIGlmICgo\nKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAwMDAwMDA4KSkgewog\nICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1\ndFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoNCwgZ2V0SW5z\ndGFuY2VJZEJ5dGVzKCkpOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5r\nbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9p\nemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsK\nICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJp\nYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAg\nICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0ZVJlcGxhY2UoKQog\nICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2UoKTsKICAgIH0KICAg\nIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0IHBhcnNlRnJvbSgKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1h\ndHMuQ29va2llRm9ybWF0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZh\nbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5Db29raWVGb3JtYXQgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAg\nICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2Nv\nbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5Db29raWVGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBk\nYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkNvb2tpZUZvcm1hdCBwYXJz\nZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0IHBhcnNlRnJvbSgKICAgICAgICBq\nYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLkNvb2tpZUZvcm1hdCBwYXJzZURlbGltaXRl\nZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRl\nciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxp\nbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1\naWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkNvb2tpZUZvcm1hdCBw\nYXJzZURlbGltaXRlZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVh\nbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRl\nciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxp\nbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAg\nICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2Ug\newogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5Db29raWVGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0IHBhcnNlRnJvbSgKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQs\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3Rh\ndGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3Jl\nYXRlKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBl\nKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGlj\nIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0IHByb3RvdHlwZSkgewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwog\nICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4g\nbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5nLk92ZXJy\naWRlCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBidWlsZGVy\nID0gbmV3IEJ1aWxkZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIg\nZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1lbnRzIG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5Db29raWVG\nb3JtYXRPckJ1aWxkZXIgewogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLmludGVybmFsX3N0\nYXRpY19Db29raWVGb3JtYXRfZGVzY3JpcHRvcjsKICAgICAgfQogICAgICAK\nICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAgIGludGVybmFs\nR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxf\nc3RhdGljX0Nvb2tpZUZvcm1hdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0Lm5l\nd0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7CiAgICAgICAg\nbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAg\nICAgIAogICAgICBwcml2YXRlIEJ1aWxkZXIoQnVpbGRlclBhcmVudCBwYXJl\nbnQpIHsKICAgICAgICBzdXBlcihwYXJlbnQpOwogICAgICAgIG1heWJlRm9y\nY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICBwcml2\nYXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsK\nICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNz\nYWdlLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsKICAgICAgICB9CiAgICAg\nIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNs\nZWFyKCk7CiAgICAgICAgYm9va2llSG9zdF8gPSAiIjsKICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAg\nam91cm5hbERpcl8gPSAiIjsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZp\nZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAgbGVkZ2VyRGlyc18gPSAi\nIjsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAw\nMDAwNCk7CiAgICAgICAgaW5zdGFuY2VJZF8gPSAiIjsKICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwOCk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZy\nb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkNvb2tpZUZvcm1hdC5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0\nYUZvcm1hdHMuQ29va2llRm9ybWF0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5\ncGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5Db29raWVGb3JtYXQuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0IGJ1\naWxkKCkgewogICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5Db29raWVGb3JtYXQgcmVzdWx0ID0gYnVpbGRQYXJ0aWFs\nKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAg\nICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlv\nbihyZXN1bHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0Owog\nICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5Db29raWVGb3JtYXQgYnVpbGRQYXJz\nZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52\nYWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0\nIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0\nLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0\naWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJlc3VsdCku\nYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5Db29raWVGb3JtYXQgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5Db29raWVGb3Jt\nYXQgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5Db29raWVGb3JtYXQodGhpcyk7CiAgICAgICAgaW50IGZy\nb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87CiAgICAgICAgaW50IHRvX2Jp\ndEZpZWxkMF8gPSAwOwogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAm\nIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgICB0b19i\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgfQogICAgICAgIHJl\nc3VsdC5ib29raWVIb3N0XyA9IGJvb2tpZUhvc3RfOwogICAgICAgIGlmICgo\nKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIp\nKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAg\nICAgICAgfQogICAgICAgIHJlc3VsdC5qb3VybmFsRGlyXyA9IGpvdXJuYWxE\naXJfOwogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDQpID09IDB4MDAwMDAwMDQpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDQ7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5sZWRn\nZXJEaXJzXyA9IGxlZGdlckRpcnNfOwogICAgICAgIGlmICgoKGZyb21fYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpKSB7CiAgICAg\nICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgfQog\nICAgICAgIHJlc3VsdC5pbnN0YW5jZUlkXyA9IGluc3RhbmNlSWRfOwogICAg\nICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsKICAgICAg\nICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29n\nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhl\nciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRh\nRm9ybWF0cy5Db29raWVGb3JtYXQpIHsKICAgICAgICAgIHJldHVybiBtZXJn\nZUZyb20oKG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0\ncy5Db29raWVGb3JtYXQpb3RoZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkRhdGFGb3JtYXRzLkNvb2tpZUZvcm1hdCBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciA9PSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuQ29va2llRm9ybWF0LmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1\ncm4gdGhpczsKICAgICAgICBpZiAob3RoZXIuaGFzQm9va2llSG9zdCgpKSB7\nCiAgICAgICAgICBzZXRCb29raWVIb3N0KG90aGVyLmdldEJvb2tpZUhvc3Qo\nKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNKb3VybmFsRGly\nKCkpIHsKICAgICAgICAgIHNldEpvdXJuYWxEaXIob3RoZXIuZ2V0Sm91cm5h\nbERpcigpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc0xlZGdl\nckRpcnMoKSkgewogICAgICAgICAgc2V0TGVkZ2VyRGlycyhvdGhlci5nZXRM\nZWRnZXJEaXJzKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFz\nSW5zdGFuY2VJZCgpKSB7CiAgICAgICAgICBzZXRJbnN0YW5jZUlkKG90aGVy\nLmdldEluc3RhbmNlSWQoKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVy\nZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgaWYg\nKCFoYXNCb29raWVIb3N0KCkpIHsKICAgICAgICAgIAogICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIWhhc0pvdXJuYWxE\naXIoKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgICAgIGlmICghaGFzTGVkZ2VyRGlycygpKSB7CiAgICAg\nICAgICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0\nLkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAg\nICAgICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUg\nKHRydWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7\nCiAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6\nCiAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25G\naWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6\nIHsKICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0\nLCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAg\nICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1\naWxkKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAx\nMDogewogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsK\nICAgICAgICAgICAgICBib29raWVIb3N0XyA9IGlucHV0LnJlYWRCeXRlcygp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDI7CiAgICAgICAgICAgICAgam91cm5hbERpcl8gPSBpbnB1dC5y\nZWFkQnl0ZXMoKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBjYXNlIDI2OiB7CiAgICAgICAgICAgICAgYml0Rmll\nbGQwXyB8PSAweDAwMDAwMDA0OwogICAgICAgICAgICAgIGxlZGdlckRpcnNf\nID0gaW5wdXQucmVhZEJ5dGVzKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAzNDogewogICAgICAgICAg\nICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAgICAgICAgICBp\nbnN0YW5jZUlkXyA9IGlucHV0LnJlYWRCeXRlcygpOwogICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOwog\nICAgICAKICAgICAgLy8gcmVxdWlyZWQgc3RyaW5nIGJvb2tpZUhvc3QgPSAx\nOwogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3QgYm9va2llSG9zdF8g\nPSAiIjsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzQm9va2llSG9zdCgpIHsK\nICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSk7CiAgICAgIH0KICAgICAgcHVibGljIFN0cmluZyBnZXRC\nb29raWVIb3N0KCkgewogICAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0g\nYm9va2llSG9zdF87CiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgU3Ry\naW5nKSkgewogICAgICAgICAgU3RyaW5nIHMgPSAoKGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZykgcmVmKS50b1N0cmluZ1V0ZjgoKTsKICAgICAg\nICAgIGJvb2tpZUhvc3RfID0gczsKICAgICAgICAgIHJldHVybiBzOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gKFN0cmluZykgcmVmOwog\nICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRCb29r\naWVIb3N0KFN0cmluZyB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBu\ndWxsKSB7CiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsK\nICB9CiAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIGJvb2tp\nZUhvc3RfID0gdmFsdWU7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xl\nYXJCb29raWVIb3N0KCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0Rmll\nbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBib29raWVIb3N0XyA9IGdl\ndERlZmF1bHRJbnN0YW5jZSgpLmdldEJvb2tpZUhvc3QoKTsKICAgICAgICBv\nbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICB2b2lkIHNldEJvb2tpZUhvc3QoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDAxOwogICAgICAgIGJvb2tpZUhvc3RfID0gdmFsdWU7CiAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIHN0\ncmluZyBqb3VybmFsRGlyID0gMjsKICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcu\nT2JqZWN0IGpvdXJuYWxEaXJfID0gIiI7CiAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc0pvdXJuYWxEaXIoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAgICB9CiAgICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0Sm91cm5hbERpcigpIHsKICAgICAgICBqYXZh\nLmxhbmcuT2JqZWN0IHJlZiA9IGpvdXJuYWxEaXJfOwogICAgICAgIGlmICgh\nKHJlZiBpbnN0YW5jZW9mIFN0cmluZykpIHsKICAgICAgICAgIFN0cmluZyBz\nID0gKChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZikudG9T\ndHJpbmdVdGY4KCk7CiAgICAgICAgICBqb3VybmFsRGlyXyA9IHM7CiAgICAg\nICAgICByZXR1cm4gczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0\ndXJuIChTdHJpbmcpIHJlZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgc2V0Sm91cm5hbERpcihTdHJpbmcgdmFsdWUpIHsKICAg\nICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQ\nb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMjsKICAgICAgICBqb3VybmFsRGlyXyA9IHZhbHVlOwogICAgICAgIG9u\nQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsZWFySm91cm5hbERpcigpIHsKICAgICAgICBi\naXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAg\nICAgam91cm5hbERpcl8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRKb3Vy\nbmFsRGlyKCk7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgdm9pZCBzZXRKb3VybmFsRGlyKGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewogICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICBqb3VybmFsRGlyXyA9\nIHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICB9CiAgICAgIAog\nICAgICAvLyByZXF1aXJlZCBzdHJpbmcgbGVkZ2VyRGlycyA9IDM7CiAgICAg\nIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBsZWRnZXJEaXJzXyA9ICIiOwog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNMZWRnZXJEaXJzKCkgewogICAgICAg\nIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAw\nMDA0KTsKICAgICAgfQogICAgICBwdWJsaWMgU3RyaW5nIGdldExlZGdlckRp\ncnMoKSB7CiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBsZWRnZXJE\naXJzXzsKICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBTdHJpbmcpKSB7\nCiAgICAgICAgICBTdHJpbmcgcyA9ICgoY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nKSByZWYpLnRvU3RyaW5nVXRmOCgpOwogICAgICAgICAgbGVk\nZ2VyRGlyc18gPSBzOwogICAgICAgICAgcmV0dXJuIHM7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHJldHVybiAoU3RyaW5nKSByZWY7CiAgICAgICAg\nfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldExlZGdlckRpcnMo\nU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsK\nICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICBi\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAgICAgICAgbGVkZ2VyRGlyc18g\nPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckxlZGdl\nckRpcnMoKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYg\nfjB4MDAwMDAwMDQpOwogICAgICAgIGxlZGdlckRpcnNfID0gZ2V0RGVmYXVs\ndEluc3RhbmNlKCkuZ2V0TGVkZ2VyRGlycygpOwogICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHZvaWQg\nc2V0TGVkZ2VyRGlycyhjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\ndmFsdWUpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAg\nICAgICAgbGVkZ2VyRGlyc18gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgc3RyaW5nIGlu\nc3RhbmNlSWQgPSA0OwogICAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3Qg\naW5zdGFuY2VJZF8gPSAiIjsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzSW5z\ndGFuY2VJZCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCk7CiAgICAgIH0KICAgICAgcHVibGlj\nIFN0cmluZyBnZXRJbnN0YW5jZUlkKCkgewogICAgICAgIGphdmEubGFuZy5P\nYmplY3QgcmVmID0gaW5zdGFuY2VJZF87CiAgICAgICAgaWYgKCEocmVmIGlu\nc3RhbmNlb2YgU3RyaW5nKSkgewogICAgICAgICAgU3RyaW5nIHMgPSAoKGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmKS50b1N0cmluZ1V0\nZjgoKTsKICAgICAgICAgIGluc3RhbmNlSWRfID0gczsKICAgICAgICAgIHJl\ndHVybiBzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gKFN0\ncmluZykgcmVmOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRJbnN0YW5jZUlkKFN0cmluZyB2YWx1ZSkgewogICAgICAgIGlm\nICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJF\neGNlcHRpb24oKTsKICB9CiAgYml0RmllbGQwXyB8PSAweDAwMDAwMDA4Owog\nICAgICAgIGluc3RhbmNlSWRfID0gdmFsdWU7CiAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGlj\nIEJ1aWxkZXIgY2xlYXJJbnN0YW5jZUlkKCkgewogICAgICAgIGJpdEZpZWxk\nMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA4KTsKICAgICAgICBpbnN0\nYW5jZUlkXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEluc3RhbmNlSWQo\nKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICB2b2lkIHNldEluc3RhbmNlSWQoY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgYml0RmllbGQw\nXyB8PSAweDAwMDAwMDA4OwogICAgICAgIGluc3RhbmNlSWRfID0gdmFsdWU7\nCiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgIH0KICAgICAgCiAgICAgIC8v\nIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOkNvb2tp\nZUZvcm1hdCkKICAgIH0KICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVs\ndEluc3RhbmNlID0gbmV3IENvb2tpZUZvcm1hdCh0cnVlKTsKICAgICAgZGVm\nYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8g\nQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkNvb2tpZUZv\ncm1hdCkKICB9CiAgCiAgcHVibGljIGludGVyZmFjZSBMb2NrRGF0YUZvcm1h\ndE9yQnVpbGRlcgogICAgICBleHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYu\nTWVzc2FnZU9yQnVpbGRlciB7CiAgICAKICAgIC8vIG9wdGlvbmFsIHN0cmlu\nZyBib29raWVJZCA9IDE7CiAgICBib29sZWFuIGhhc0Jvb2tpZUlkKCk7CiAg\nICBTdHJpbmcgZ2V0Qm9va2llSWQoKTsKICB9CiAgcHVibGljIHN0YXRpYyBm\naW5hbCBjbGFzcyBMb2NrRGF0YUZvcm1hdCBleHRlbmRzCiAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZQogICAgICBpbXBsZW1l\nbnRzIExvY2tEYXRhRm9ybWF0T3JCdWlsZGVyIHsKICAgIC8vIFVzZSBMb2Nr\nRGF0YUZvcm1hdC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJp\ndmF0ZSBMb2NrRGF0YUZvcm1hdChCdWlsZGVyIGJ1aWxkZXIpIHsKICAgICAg\nc3VwZXIoYnVpbGRlcik7CiAgICB9CiAgICBwcml2YXRlIExvY2tEYXRhRm9y\nbWF0KGJvb2xlYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBMb2NrRGF0YUZvcm1hdCBkZWZhdWx0SW5zdGFuY2U7CiAgICBw\ndWJsaWMgc3RhdGljIExvY2tEYXRhRm9ybWF0IGdldERlZmF1bHRJbnN0YW5j\nZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAg\nIAogICAgcHVibGljIExvY2tEYXRhRm9ybWF0IGdldERlZmF1bHRJbnN0YW5j\nZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5w\ncm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5wcm90by5EYXRhRm9ybWF0cy5pbnRlcm5hbF9zdGF0aWNfTG9ja0RhdGFG\nb3JtYXRfZGVzY3JpcHRvcjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vz\nc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJs\nZSgpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5pbnRlcm5hbF9zdGF0aWNfTG9ja0RhdGFGb3JtYXRf\nZmllbGRBY2Nlc3NvclRhYmxlOwogICAgfQogICAgCiAgICBwcml2YXRlIGlu\ndCBiaXRGaWVsZDBfOwogICAgLy8gb3B0aW9uYWwgc3RyaW5nIGJvb2tpZUlk\nID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEJPT0tJRUlEX0ZJ\nRUxEX05VTUJFUiA9IDE7CiAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3Qg\nYm9va2llSWRfOwogICAgcHVibGljIGJvb2xlYW4gaGFzQm9va2llSWQoKSB7\nCiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAw\neDAwMDAwMDAxKTsKICAgIH0KICAgIHB1YmxpYyBTdHJpbmcgZ2V0Qm9va2ll\nSWQoKSB7CiAgICAgIGphdmEubGFuZy5PYmplY3QgcmVmID0gYm9va2llSWRf\nOwogICAgICBpZiAocmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAg\ncmV0dXJuIChTdHJpbmcpIHJlZjsKICAgICAgfSBlbHNlIHsKICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYnMgPSAKICAgICAgICAg\nICAgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOwogICAg\nICAgIFN0cmluZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7CiAgICAgICAgaWYg\nKGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuaXNWYWxpZFV0ZjgoYnMp\nKSB7CiAgICAgICAgICBib29raWVJZF8gPSBzOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gczsKICAgICAgfQogICAgfQogICAgcHJpdmF0ZSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9va2llSWRCeXRlcygpIHsK\nICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBib29raWVJZF87CiAgICAg\nIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYiA9IAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KChTdHJp\nbmcpIHJlZik7CiAgICAgICAgYm9va2llSWRfID0gYjsKICAgICAgICByZXR1\ncm4gYjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gKGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOwogICAgICB9CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICBib29r\naWVJZF8gPSAiIjsKICAgIH0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElz\nSW5pdGlhbGl6ZWQgPSAtMTsKICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlz\nSW5pdGlhbGl6ZWQoKSB7CiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1l\nbW9pemVkSXNJbml0aWFsaXplZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQg\nIT0gLTEpIHJldHVybiBpc0luaXRpYWxpemVkID09IDE7CiAgICAgIAogICAg\nICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRG\naWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAg\nICBvdXRwdXQud3JpdGVCeXRlcygxLCBnZXRCb29raWVJZEJ5dGVzKCkpOwog\nICAgICB9CiAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1\ndCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFs\naXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNp\nemUoKSB7CiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6\nZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAg\nICAgIHNpemUgPSAwOwogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBzaXplICs9IGNvbS5n\nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5j\nb21wdXRlQnl0ZXNTaXplKDEsIGdldEJvb2tpZUlkQnl0ZXMoKSk7CiAgICAg\nIH0KICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFs\naXplZFNpemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNp\nemU7CiAgICAgIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAg\nIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcu\nT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nT2JqZWN0U3RyZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndy\naXRlUmVwbGFjZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0\nYUZvcm1hdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxvY2tEYXRhRm9ybWF0IHBh\ncnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmcgZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJv\nd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJF\neGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0YUZvcm1h\ndCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSku\nYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxvY2tEYXRhRm9y\nbWF0IHBhcnNlRnJvbSgKICAgICAgICBieXRlW10gZGF0YSwKICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICBy\nZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5Mb2NrRGF0YUZvcm1hdCBwYXJzZUZyb20oamF2YS5p\nby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nTG9ja0RhdGFGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5w\ndXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0\nYUZvcm1hdHMuTG9ja0RhdGFGb3JtYXQgcGFyc2VEZWxpbWl0ZWRGcm9tKGph\ndmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdC\ndWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJv\nbShpbnB1dCkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNl\nZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAg\nICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0YUZvcm1hdCBwYXJzZURl\nbGltaXRlZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1\ndCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lz\ndHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\nd0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRG\ncm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1\ncm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAg\nICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nb2NrRGF0YUZvcm1hdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5Mb2NrRGF0YUZvcm1hdCBwYXJzZUZyb20oCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlM\naXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAg\nICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRp\nYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7IHJldHVybiBCdWlsZGVyLmNyZWF0\nZSgpOyB9CiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgp\nIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQogICAgcHVibGljIHN0YXRpYyBC\ndWlsZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkRhdGFGb3JtYXRzLkxvY2tEYXRhRm9ybWF0IHByb3RvdHlwZSkgewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwog\nICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4g\nbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5nLk92ZXJy\naWRlCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBidWlsZGVy\nID0gbmV3IEJ1aWxkZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIg\nZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1lbnRzIG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0\nYUZvcm1hdE9yQnVpbGRlciB7CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAg\nICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50ZXJuYWxf\nc3RhdGljX0xvY2tEYXRhRm9ybWF0X2Rlc2NyaXB0b3I7CiAgICAgIH0KICAg\nICAgCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRl\ncm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLmludGVy\nbmFsX3N0YXRpY19Mb2NrRGF0YUZvcm1hdF9maWVsZEFjY2Vzc29yVGFibGU7\nCiAgICAgIH0KICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTG9ja0RhdGFG\nb3JtYXQubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsK\nICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRlcihCdWlsZGVyUGFy\nZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVudCk7CiAgICAgICAg\nbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAg\nICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycykgewogICAgICAg\nIH0KICAgICAgfQogICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0\nZSgpIHsKICAgICAgICByZXR1cm4gbmV3IEJ1aWxkZXIoKTsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAg\nc3VwZXIuY2xlYXIoKTsKICAgICAgICBib29raWVJZF8gPSAiIjsKICAgICAg\nICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5t\nZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNj\ncmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAg\nICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLkxvY2tEYXRhRm9ybWF0LmdldERlc2NyaXB0b3IoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0YUZvcm1hdCBnZXREZWZhdWx0SW5z\ndGFuY2VGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTG9ja0RhdGFGb3JtYXQuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTG9j\na0RhdGFGb3JtYXQgYnVpbGQoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxvY2tEYXRhRm9ybWF0IHJlc3Vs\ndCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0LmlzSW5p\ndGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXpl\nZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTG9ja0Rh\ndGFGb3JtYXQgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuTG9ja0RhdGFGb3JtYXQgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAg\nICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4\nY2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0Owog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLkxvY2tEYXRhRm9ybWF0IGJ1aWxkUGFy\ndGlhbCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nRGF0YUZvcm1hdHMuTG9ja0RhdGFGb3JtYXQgcmVzdWx0ID0gbmV3IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0YUZv\ncm1hdCh0aGlzKTsKICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0\nRmllbGQwXzsKICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9IDA7CiAgICAg\nICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgw\nMDAwMDAwMSkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LmJvb2tpZUlkXyA9IGJv\nb2tpZUlkXzsKICAgICAgICByZXN1bHQuYml0RmllbGQwXyA9IHRvX2JpdEZp\nZWxkMF87CiAgICAgICAgb25CdWlsdCgpOwogICAgICAgIHJldHVybiByZXN1\nbHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdl\nRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAg\nICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIucHJvdG8uRGF0YUZvcm1hdHMuTG9ja0RhdGFGb3JtYXQpIHsKICAgICAg\nICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0YUZvcm1hdClvdGhlcik7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7\nCiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuTG9ja0RhdGFGb3JtYXQg\nb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxvY2tEYXRhRm9ybWF0LmdldERl\nZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3Ro\nZXIuaGFzQm9va2llSWQoKSkgewogICAgICAgICAgc2V0Qm9va2llSWQob3Ro\nZXIuZ2V0Qm9va2llSWQoKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVy\nZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxk\nZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAgICB0\naGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRydWUp\nIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAg\nICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAgICAg\nICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMu\nYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAg\nICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1bmtu\nb3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAgICAg\nIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkp\nOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxMDogewog\nICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAg\nICAgICAgICBib29raWVJZF8gPSBpbnB1dC5yZWFkQnl0ZXMoKTsKICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBpbnQgYml0Rmll\nbGQwXzsKICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIHN0cmluZyBib29raWVJ\nZCA9IDE7CiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBib29raWVJ\nZF8gPSAiIjsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzQm9va2llSWQoKSB7\nCiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09\nIDB4MDAwMDAwMDEpOwogICAgICB9CiAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0\nQm9va2llSWQoKSB7CiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBi\nb29raWVJZF87CiAgICAgICAgaWYgKCEocmVmIGluc3RhbmNlb2YgU3RyaW5n\nKSkgewogICAgICAgICAgU3RyaW5nIHMgPSAoKGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZykgcmVmKS50b1N0cmluZ1V0ZjgoKTsKICAgICAgICAg\nIGJvb2tpZUlkXyA9IHM7CiAgICAgICAgICByZXR1cm4gczsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgcmV0dXJuIChTdHJpbmcpIHJlZjsKICAgICAg\nICB9CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Qm9va2llSWQo\nU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsK\nICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICBi\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgYm9va2llSWRfID0g\ndmFsdWU7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJCb29raWVJ\nZCgpIHsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgw\nMDAwMDAwMSk7CiAgICAgICAgYm9va2llSWRfID0gZ2V0RGVmYXVsdEluc3Rh\nbmNlKCkuZ2V0Qm9va2llSWQoKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICB2b2lkIHNldEJvb2tp\nZUlkKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewog\nICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICBib29r\naWVJZF8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgfQog\nICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxk\nZXJfc2NvcGU6TG9ja0RhdGFGb3JtYXQpCiAgICB9CiAgICAKICAgIHN0YXRp\nYyB7CiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBMb2NrRGF0YUZvcm1h\ndCh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsK\nICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNs\nYXNzX3Njb3BlOkxvY2tEYXRhRm9ybWF0KQogIH0KICAKICBwdWJsaWMgaW50\nZXJmYWNlIEF1ZGl0b3JWb3RlRm9ybWF0T3JCdWlsZGVyCiAgICAgIGV4dGVu\nZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsKICAg\nIAogICAgLy8gb3B0aW9uYWwgc3RyaW5nIGJvb2tpZUlkID0gMTsKICAgIGJv\nb2xlYW4gaGFzQm9va2llSWQoKTsKICAgIFN0cmluZyBnZXRCb29raWVJZCgp\nOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEF1ZGl0b3JWb3Rl\nRm9ybWF0IGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlCiAgICAgIGltcGxlbWVudHMgQXVkaXRvclZvdGVGb3Jt\nYXRPckJ1aWxkZXIgewogICAgLy8gVXNlIEF1ZGl0b3JWb3RlRm9ybWF0Lm5l\nd0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIEF1ZGl0b3JW\nb3RlRm9ybWF0KEJ1aWxkZXIgYnVpbGRlcikgewogICAgICBzdXBlcihidWls\nZGVyKTsKICAgIH0KICAgIHByaXZhdGUgQXVkaXRvclZvdGVGb3JtYXQoYm9v\nbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIEF1ZGl0b3JWb3RlRm9ybWF0IGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1Ymxp\nYyBzdGF0aWMgQXVkaXRvclZvdGVGb3JtYXQgZ2V0RGVmYXVsdEluc3RhbmNl\nKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgQXVkaXRvclZvdGVGb3JtYXQgZ2V0RGVmYXVsdEluc3Rh\nbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXRE\nZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkRhdGFGb3JtYXRzLmludGVybmFsX3N0YXRpY19BdWRpdG9y\nVm90ZUZvcm1hdF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0\nZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3Nv\nclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkRhdGFGb3JtYXRzLmludGVybmFsX3N0YXRpY19BdWRpdG9yVm90\nZUZvcm1hdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAvLyBvcHRpb25hbCBzdHJpbmcg\nYm9va2llSWQgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQk9P\nS0lFSURfRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgamF2YS5sYW5n\nLk9iamVjdCBib29raWVJZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNCb29r\naWVJZCgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDEpID09IDB4MDAwMDAwMDEpOwogICAgfQogICAgcHVibGljIFN0cmluZyBn\nZXRCb29raWVJZCgpIHsKICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBi\nb29raWVJZF87CiAgICAgIGlmIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsK\nICAgICAgICByZXR1cm4gKFN0cmluZykgcmVmOwogICAgICB9IGVsc2Ugewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IAog\nICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSBy\nZWY7CiAgICAgICAgU3RyaW5nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsKICAg\nICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5pc1ZhbGlk\nVXRmOChicykpIHsKICAgICAgICAgIGJvb2tpZUlkXyA9IHM7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBzOwogICAgICB9CiAgICB9CiAgICBwcml2YXRl\nIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRCb29raWVJZEJ5\ndGVzKCkgewogICAgICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IGJvb2tpZUlk\nXzsKICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gCiAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgoKFN0cmluZykgcmVmKTsKICAgICAgICBib29raWVJZF8gPSBiOwogICAg\nICAgIHJldHVybiBiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAo\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7CiAgICAgIH0K\nICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAg\nICAgIGJvb2tpZUlkXyA9ICIiOwogICAgfQogICAgcHJpdmF0ZSBieXRlIG1l\nbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOwogICAgcHVibGljIGZpbmFsIGJv\nb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgYnl0ZSBpc0luaXRpYWxp\nemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOwogICAgICBpZiAoaXNJbml0\naWFsaXplZCAhPSAtMSkgcmV0dXJuIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAg\nICAgCiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7CiAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRv\nKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0\nKQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIGlm\nICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkg\newogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDEsIGdldEJvb2tpZUlkQnl0\nZXMoKSk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRl\nVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgbWVtb2l6\nZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBnZXRTZXJp\nYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlh\nbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7\nCiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIHNpemUg\nKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAg\nICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMSwgZ2V0Qm9va2llSWRCeXRlcygp\nKTsKICAgICAgfQogICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5n\nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNlcmlhbGl6ZWRT\naXplID0gc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9\nIDBMOwogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIGph\ndmEubGFuZy5PYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICB0aHJvd3Mg\namF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICByZXR1cm4g\nc3VwZXIud3JpdGVSZXBsYWNlKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkF1ZGl0b3JWb3RlRm9ybWF0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuQXVkaXRv\nclZvdGVGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkF1ZGl0b3JWb3RlRm9ybWF0IHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAg\nICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuQXVkaXRvclZvdGVGb3JtYXQgcGFyc2VGcm9tKAogICAgICAgIGJ5\ndGVbXSBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAu\nYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3Rl\nRm9ybWF0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQog\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5BdWRpdG9yVm90ZUZvcm1hdCBwYXJz\nZUZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAg\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5BdWRpdG9yVm90\nZUZvcm1hdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVh\nbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAg\naWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLkF1ZGl0b3JWb3RlRm9ybWF0IHBhcnNlRGVsaW1pdGVkRnJvbSgK\nICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwog\nICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1\naWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3RlRm9y\nbWF0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkF1ZGl0b3JWb3RlRm9ybWF0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShp\nbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWls\nZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxk\nZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0K\nICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1\ncm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIg\nbmV3QnVpbGRlcihvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuQXVkaXRvclZvdGVGb3JtYXQgcHJvdG90eXBlKSB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9\nCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBuZXdC\ndWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWls\nZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBu\nZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRlcjsKICAg\nIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRl\nbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNz\nYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3Rl\nRm9ybWF0T3JCdWlsZGVyIHsKICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAg\nICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5pbnRlcm5hbF9z\ndGF0aWNfQXVkaXRvclZvdGVGb3JtYXRfZGVzY3JpcHRvcjsKICAgICAgfQog\nICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAgIGlu\ndGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuaW50\nZXJuYWxfc3RhdGljX0F1ZGl0b3JWb3RlRm9ybWF0X2ZpZWxkQWNjZXNzb3JU\nYWJsZTsKICAgICAgfQogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5n\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5BdWRp\ndG9yVm90ZUZvcm1hdC5uZXdCdWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWls\nZGVyKCkgewogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRp\nb24oKTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBCdWlsZGVyKEJ1\naWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgICAgc3VwZXIocGFyZW50KTsK\nICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAg\nICAgIH0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5p\ndGlhbGl6YXRpb24oKSB7CiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZS5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7\nCiAgICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGUgc3RhdGljIEJ1aWxk\nZXIgY3JlYXRlKCkgewogICAgICAgIHJldHVybiBuZXcgQnVpbGRlcigpOwog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsK\nICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIGJvb2tpZUlkXyA9ICIi\nOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAw\nMDAxKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIGNy\nZWF0ZSgpLm1lcmdlRnJvbShidWlsZFBhcnRpYWwoKSk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBl\nKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuQXVkaXRvclZvdGVGb3JtYXQuZ2V0RGVzY3JpcHRv\ncigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3RlRm9ybWF0\nIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5BdWRp\ndG9yVm90ZUZvcm1hdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5BdWRpdG9yVm90ZUZvcm1hdCBidWlsZCgpIHsKICAg\nICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMu\nQXVkaXRvclZvdGVGb3JtYXQgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAg\nICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAg\nICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1\nbHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9\nCiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5EYXRhRm9ybWF0cy5BdWRpdG9yVm90ZUZvcm1hdCBidWlsZFBhcnNl\nZCgpCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZh\nbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5BdWRpdG9yVm90ZUZv\ncm1hdCByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJl\nc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1Vu\naW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICByZXN1\nbHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZv\ncm1hdHMuQXVkaXRvclZvdGVGb3JtYXQgYnVpbGRQYXJ0aWFsKCkgewogICAg\nICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5B\ndWRpdG9yVm90ZUZvcm1hdCByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3RlRm9ybWF0KHRo\naXMpOwogICAgICAgIGludCBmcm9tX2JpdEZpZWxkMF8gPSBiaXRGaWVsZDBf\nOwogICAgICAgIGludCB0b19iaXRGaWVsZDBfID0gMDsKICAgICAgICBpZiAo\nKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAx\nKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwog\nICAgICAgIH0KICAgICAgICByZXN1bHQuYm9va2llSWRfID0gYm9va2llSWRf\nOwogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsK\nICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNv\nbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90\nby5EYXRhRm9ybWF0cy5BdWRpdG9yVm90ZUZvcm1hdCkgewogICAgICAgICAg\ncmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3RlRm9ybWF0KW90aGVyKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsK\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5BdWRpdG9yVm90ZUZvcm1h\ndCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuQXVkaXRvclZvdGVGb3JtYXQu\nZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlm\nIChvdGhlci5oYXNCb29raWVJZCgpKSB7CiAgICAgICAgICBzZXRCb29raWVJ\nZChvdGhlci5nZXRCb29raWVJZCgpKTsKICAgICAgICB9CiAgICAgICAgdGhp\ncy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygp\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQu\nQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAg\nICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAo\ndHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsK\nICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoK\nICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZp\nZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDog\newogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQs\nIHVua25vd25GaWVsZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAg\nICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVp\nbGQoKSk7CiAgICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDEw\nOiB7CiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwog\nICAgICAgICAgICAgIGJvb2tpZUlkXyA9IGlucHV0LnJlYWRCeXRlcygpOwog\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBi\naXRGaWVsZDBfOwogICAgICAKICAgICAgLy8gb3B0aW9uYWwgc3RyaW5nIGJv\nb2tpZUlkID0gMTsKICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGJv\nb2tpZUlkXyA9ICIiOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNCb29raWVJ\nZCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAgICAgcHVibGljIFN0cmlu\nZyBnZXRCb29raWVJZCgpIHsKICAgICAgICBqYXZhLmxhbmcuT2JqZWN0IHJl\nZiA9IGJvb2tpZUlkXzsKICAgICAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBT\ndHJpbmcpKSB7CiAgICAgICAgICBTdHJpbmcgcyA9ICgoY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nKSByZWYpLnRvU3RyaW5nVXRmOCgpOwogICAg\nICAgICAgYm9va2llSWRfID0gczsKICAgICAgICAgIHJldHVybiBzOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gKFN0cmluZykgcmVmOwog\nICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRCb29r\naWVJZChTdHJpbmcgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVs\nbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAg\nfQogIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICBib29raWVJ\nZF8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckJv\nb2tpZUlkKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAm\nIH4weDAwMDAwMDAxKTsKICAgICAgICBib29raWVJZF8gPSBnZXREZWZhdWx0\nSW5zdGFuY2UoKS5nZXRCb29raWVJZCgpOwogICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHZvaWQgc2V0\nQm9va2llSWQoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVl\nKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAg\nIGJvb2tpZUlkXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAg\nICB9CiAgICAgIAogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQo\nYnVpbGRlcl9zY29wZTpBdWRpdG9yVm90ZUZvcm1hdCkKICAgIH0KICAgIAog\nICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IEF1ZGl0\nb3JWb3RlRm9ybWF0KHRydWUpOwogICAgICBkZWZhdWx0SW5zdGFuY2UuaW5p\ndEZpZWxkcygpOwogICAgfQogICAgCiAgICAvLyBAQHByb3RvY19pbnNlcnRp\nb25fcG9pbnQoY2xhc3Nfc2NvcGU6QXVkaXRvclZvdGVGb3JtYXQpCiAgfQog\nIAogIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3Jp\ncHRvcnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0xlZGdlck1l\ndGFkYXRhRm9ybWF0X2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0xlZGdlck1ldGFk\nYXRhRm9ybWF0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0YXRp\nYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IK\nICAgIGludGVybmFsX3N0YXRpY19MZWRnZXJNZXRhZGF0YUZvcm1hdF9TZWdt\nZW50X2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFi\nbGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0xlZGdlck1ldGFkYXRhRm9ybWF0\nX1NlZ21lbnRfZmllbGRBY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3RhdGlj\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgog\nICAgaW50ZXJuYWxfc3RhdGljX0xlZGdlclJlcmVwbGljYXRpb25MYXlvdXRG\nb3JtYXRfZGVzY3JpcHRvcjsKICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JU\nYWJsZQogICAgICBpbnRlcm5hbF9zdGF0aWNfTGVkZ2VyUmVyZXBsaWNhdGlv\nbkxheW91dEZvcm1hdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBz\ndGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlw\ndG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfVW5kZXJyZXBsaWNhdGVkTGVkZ2Vy\nRm9ybWF0X2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29y\nVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX1VuZGVycmVwbGljYXRlZExl\nZGdlckZvcm1hdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICBpbnRlcm5hbF9zdGF0aWNfQ29va2llRm9ybWF0X2Rlc2NyaXB0b3I7\nCiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJu\nYWxfc3RhdGljX0Nvb2tpZUZvcm1hdF9maWVsZEFjY2Vzc29yVGFibGU7CiAg\ncHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfTG9ja0RhdGFGb3Jt\nYXRfZGVzY3JpcHRvcjsKICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJs\nZQogICAgICBpbnRlcm5hbF9zdGF0aWNfTG9ja0RhdGFGb3JtYXRfZmllbGRB\nY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJv\ndG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3Rh\ndGljX0F1ZGl0b3JWb3RlRm9ybWF0X2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBz\ndGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0F1\nZGl0b3JWb3RlRm9ybWF0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAKICBwdWJs\naWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmls\nZURlc2NyaXB0b3IKICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgIHJldHVy\nbiBkZXNjcmlwdG9yOwogIH0KICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yCiAgICAgIGRl\nc2NyaXB0b3I7CiAgc3RhdGljIHsKICAgIGphdmEubGFuZy5TdHJpbmdbXSBk\nZXNjcmlwdG9yRGF0YSA9IHsKICAgICAgIlxuIHNyYy9tYWluL3Byb3RvL0Rh\ndGFGb3JtYXRzLnByb3RvXCJcMjYyXDAwM1xuXDAyNEwiICsKICAgICAgImVk\nZ2VyTWV0YWRhdGFGb3JtYXRcMDIyXDAyMlxuXG5xdW9ydW1TaXplXDAzMFww\nMDEgXDAwMihcMDA1XDAyMiIgKwogICAgICAiXDAyNFxuXDAxNGVuc2VtYmxl\nU2l6ZVwwMzBcMDAyIFwwMDIoXDAwNVwwMjJcMDE2XG5cMDA2bGVuZ3RoXDAz\nMFwwMDMgXDAwMihcMDAzXDAyMlwwMjNcbiIgKwogICAgICAiXDAxM2xhc3RF\nbnRyeUlkXDAzMFwwMDQgXDAwMShcMDAzXDAyMjBcblwwMDVzdGF0ZVwwMzBc\nMDA1IFwwMDIoXDAxNjJcMDMzLkxlZGciICsKICAgICAgImVyTWV0YWRhdGFG\nb3JtYXQuU3RhdGU6XDAwNE9QRU5cMDIyLlxuXDAwN3NlZ21lbnRcMDMwIiAr\nCiAgICAgICJcMDA2IFwwMDMoXDAxMzJcMDM1LkxlZGdlck1ldGFkYXRhRm9y\nbWF0LlNlZ21lbnRcMDIyNFxuXG4iICsKICAgICAgImRpZ2VzdFR5cGVcMDMw\nXDAwNyBcMDAxKFwwMTYyIC5MZWRnZXJNZXRhZGF0YUZvcm1hdC4iICsKICAg\nICAgIkRpZ2VzdFR5cGVcMDIyXDAyMFxuXDAxMHBhc3N3b3JkXDAzMFwwMTAg\nXDAwMShcMDE0XDAyMlwwMjVcblxyYWNrUXVvcnUiICsKICAgICAgIm1TaXpl\nXDAzMFx0IFwwMDEoXDAwNVwwMzI3XG5cMDA3U2VnbWVudFwwMjJcMDI2XG5c\nMDE2ZW5zZW1ibGVNZW1iZXIiICsKICAgICAgIlwwMzBcMDAxIFwwMDMoXHRc\nMDIyXDAyNFxuXDAxNGZpcnN0RW50cnlJZFwwMzBcMDAyIFwwMDIoXDAwM1wi\nLlxuXDAwNVN0YXRlXDAyMlwwMTBcbiIsCiAgICAgICJcMDA0T1BFTlwwMjBc\nMDAxXDAyMlwwMTdcblwwMTNJTl9SRUNPVkVSWVwwMjBcMDAyXDAyMlxuXG5c\nMDA2Q0xPU0VEXDAyMFwwMDNcIiFcblxuIiArCiAgICAgICJEaWdlc3RUeXBl\nXDAyMlx0XG5cMDA1Q1JDMzJcMDIwXDAwMVwwMjJcMDEwXG5cMDA0SE1BQ1ww\nMjBcMDAyXCJAXG5cMDM3TGVkZ2UiICsKICAgICAgInJSZXJlcGxpY2F0aW9u\nTGF5b3V0Rm9ybWF0XDAyMlwwMTRcblwwMDR0eXBlXDAzMFwwMDEgXDAwMihc\ndCIgKwogICAgICAiXDAyMlwwMTdcblwwMDd2ZXJzaW9uXDAzMFwwMDIgXDAw\nMihcMDA1XCIuXG5cMDMzVW5kZXJyZXBsaWNhdGVkTGVkZyIgKwogICAgICAi\nZXJGb3JtYXRcMDIyXDAxN1xuXDAwN3JlcGxpY2FcMDMwXDAwMSBcMDAzKFx0\nXCJeXG5cMDE0Q29va2llRm9ybWEiICsKICAgICAgInRcMDIyXDAyMlxuXG5i\nb29raWVIb3N0XDAzMFwwMDEgXDAwMihcdFwwMjJcMDIyXG5cbmpvdXJuYWxE\naXJcMDMwXDAwMiBcMDAyKCIgKwogICAgICAiXHRcMDIyXDAyMlxuXG5sZWRn\nZXJEaXJzXDAzMFwwMDMgXDAwMihcdFwwMjJcMDIyXG5cbmluc3RhbmNlSWRc\nMDMwXDAwNCBcMDAxKCIgKwogICAgICAiXHRcIlwiXG5cMDE2TG9ja0RhdGFG\nb3JtYXRcMDIyXDAyMFxuXDAxMGJvb2tpZUlkXDAzMFwwMDEgXDAwMShcdFwi\nJVxuIiArCiAgICAgICJcMDIxQXVkaXRvclZvdGVGb3JtYXRcMDIyXDAyMFxu\nXDAxMGJvb2tpZUlkXDAzMFwwMDEgXDAwMShcdEJcMDM3XG5cMDMzIiArCiAg\nICAgICJvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG9IXDAwMSIKICAgIH07\nCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNj\ncmlwdG9yLkludGVybmFsRGVzY3JpcHRvckFzc2lnbmVyIGFzc2lnbmVyID0K\nICAgICAgbmV3IGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmls\nZURlc2NyaXB0b3IuSW50ZXJuYWxEZXNjcmlwdG9yQXNzaWduZXIoKSB7CiAg\nICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnkgYXNzaWduRGVzY3JpcHRvcnMoCiAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3Igcm9vdCkg\newogICAgICAgICAgZGVzY3JpcHRvciA9IHJvb3Q7CiAgICAgICAgICBpbnRl\ncm5hbF9zdGF0aWNfTGVkZ2VyTWV0YWRhdGFGb3JtYXRfZGVzY3JpcHRvciA9\nCiAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMo\nKS5nZXQoMCk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfTGVkZ2VyTWV0\nYWRhdGFGb3JtYXRfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVs\nZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGlj\nX0xlZGdlck1ldGFkYXRhRm9ybWF0X2Rlc2NyaXB0b3IsCiAgICAgICAgICAg\nICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJRdW9ydW1TaXplIiwgIkVu\nc2VtYmxlU2l6ZSIsICJMZW5ndGgiLCAiTGFzdEVudHJ5SWQiLCAiU3RhdGUi\nLCAiU2VnbWVudCIsICJEaWdlc3RUeXBlIiwgIlBhc3N3b3JkIiwgIkFja1F1\nb3J1bVNpemUiLCB9LAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRhZGF0YUZvcm1hdC5j\nbGFzcywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuQnVpbGRlci5j\nbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfTGVkZ2VyTWV0YWRh\ndGFGb3JtYXRfU2VnbWVudF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgaW50\nZXJuYWxfc3RhdGljX0xlZGdlck1ldGFkYXRhRm9ybWF0X2Rlc2NyaXB0b3Iu\nZ2V0TmVzdGVkVHlwZXMoKS5nZXQoMCk7CiAgICAgICAgICBpbnRlcm5hbF9z\ndGF0aWNfTGVkZ2VyTWV0YWRhdGFGb3JtYXRfU2VnbWVudF9maWVsZEFjY2Vz\nc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAg\nICAgICAgICBpbnRlcm5hbF9zdGF0aWNfTGVkZ2VyTWV0YWRhdGFGb3JtYXRf\nU2VnbWVudF9kZXNjcmlwdG9yLAogICAgICAgICAgICAgIG5ldyBqYXZhLmxh\nbmcuU3RyaW5nW10geyAiRW5zZW1ibGVNZW1iZXIiLCAiRmlyc3RFbnRyeUlk\nIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudC5j\nbGFzcywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2VnbWVudC5C\ndWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19MZWRn\nZXJSZXJlcGxpY2F0aW9uTGF5b3V0Rm9ybWF0X2Rlc2NyaXB0b3IgPQogICAg\nICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0\nKDEpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0xlZGdlclJlcmVwbGlj\nYXRpb25MYXlvdXRGb3JtYXRfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxf\nc3RhdGljX0xlZGdlclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXRfZGVzY3Jp\ncHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsg\nIlR5cGUiLCAiVmVyc2lvbiIsIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlclJlcmVwbGlj\nYXRpb25MYXlvdXRGb3JtYXQuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxlZGdlclJlcmVw\nbGljYXRpb25MYXlvdXRGb3JtYXQuQnVpbGRlci5jbGFzcyk7CiAgICAgICAg\nICBpbnRlcm5hbF9zdGF0aWNfVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0\nX2Rlc2NyaXB0b3IgPQogICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0\nTWVzc2FnZVR5cGVzKCkuZ2V0KDIpOwogICAgICAgICAgaW50ZXJuYWxfc3Rh\ndGljX1VuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdF9maWVsZEFjY2Vzc29y\nVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAg\nICAgICBpbnRlcm5hbF9zdGF0aWNfVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9y\nbWF0X2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5T\ndHJpbmdbXSB7ICJSZXBsaWNhIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuVW5kZXJyZXBsaWNh\ndGVkTGVkZ2VyRm9ybWF0LmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5VbmRlcnJlcGxpY2F0\nZWRMZWRnZXJGb3JtYXQuQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICBpbnRl\ncm5hbF9zdGF0aWNfQ29va2llRm9ybWF0X2Rlc2NyaXB0b3IgPQogICAgICAg\nICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDMp\nOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0Nvb2tpZUZvcm1hdF9maWVs\nZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgK\nICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfQ29va2llRm9ybWF0X2Rl\nc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdb\nXSB7ICJCb29raWVIb3N0IiwgIkpvdXJuYWxEaXIiLCAiTGVkZ2VyRGlycyIs\nICJJbnN0YW5jZUlkIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuQ29va2llRm9ybWF0LmNsYXNz\nLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5Db29raWVGb3JtYXQuQnVpbGRlci5jbGFzcyk7CiAgICAg\nICAgICBpbnRlcm5hbF9zdGF0aWNfTG9ja0RhdGFGb3JtYXRfZGVzY3JpcHRv\nciA9CiAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlw\nZXMoKS5nZXQoNCk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfTG9ja0Rh\ndGFGb3JtYXRfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0xv\nY2tEYXRhRm9ybWF0X2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGph\ndmEubGFuZy5TdHJpbmdbXSB7ICJCb29raWVJZCIsIH0sCiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxv\nY2tEYXRhRm9ybWF0LmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5Mb2NrRGF0YUZvcm1hdC5C\ndWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19BdWRp\ndG9yVm90ZUZvcm1hdF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg1KTsKICAgICAgICAg\nIGludGVybmFsX3N0YXRpY19BdWRpdG9yVm90ZUZvcm1hdF9maWVsZEFjY2Vz\nc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAg\nICAgICAgICBpbnRlcm5hbF9zdGF0aWNfQXVkaXRvclZvdGVGb3JtYXRfZGVz\nY3JpcHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1td\nIHsgIkJvb2tpZUlkIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uRGF0YUZvcm1hdHMuQXVkaXRvclZvdGVGb3JtYXQu\nY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3RlRm9ybWF0LkJ1aWxkZXIuY2xh\nc3MpOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9\nOwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWxlRGVz\nY3JpcHRvcgogICAgICAuaW50ZXJuYWxCdWlsZEdlbmVyYXRlZEZpbGVGcm9t\nKGRlc2NyaXB0b3JEYXRhLAogICAgICAgIG5ldyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yW10gewogICAgICAgIH0s\nIGFzc2lnbmVyKTsKICB9CiAgCiAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3Bv\naW50KG91dGVyX2NsYXNzX3Njb3BlKQp9Cg==\n","encoding":"base64"}

