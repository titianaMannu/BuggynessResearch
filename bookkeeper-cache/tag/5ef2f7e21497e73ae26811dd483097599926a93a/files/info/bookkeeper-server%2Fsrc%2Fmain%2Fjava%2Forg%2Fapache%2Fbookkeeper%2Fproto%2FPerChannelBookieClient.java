{"sha":"296401c3147547b01620459d1cde7edf7ff9db3a","node_id":"MDQ6QmxvYjE1NzU5NTY6Mjk2NDAxYzMxNDc1NDdiMDE2MjA0NTlkMWNkZTdlZGY3ZmY5ZGIzYQ==","size":29212,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/296401c3147547b01620459d1cde7edf7ff9db3a","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG87CgppbXBvcnQgamF2\nYS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRB\nZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLkFycmF5RGVxdWU7CmltcG9ydCBq\nYXZhLnV0aWwuUXVldWU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5D\nb25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLlNlbWFwaG9yZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21p\nYy5BdG9taWNMb25nOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVByb3RvY29sLlBhY2tldEhlYWRl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2Vl\ncGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5h\nbENhbGxiYWNrcy5SZWFkRW50cnlDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci51dGlsLk1hdGhVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci51dGlsLk9yZGVyZWRTYWZlRXhlY3V0b3I7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIudXRpbC5TYWZlUnVubmFibGU7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYm9vdHN0cmFwLkNsaWVudEJvb3RzdHJhcDsKaW1wb3J0IG9y\nZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcjsKaW1wb3J0IG9y\nZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcnM7CmltcG9ydCBv\ncmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsOwppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbEZ1dHVyZTsKaW1wb3J0IG9yZy5q\nYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxGdXR1cmVMaXN0ZW5lcjsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxIYW5kbGVyQ29u\ndGV4dDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxQ\naXBlbGluZTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5u\nZWxQaXBlbGluZUNvdmVyYWdlOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNo\nYW5uZWwuQ2hhbm5lbFBpcGVsaW5lRmFjdG9yeTsKaW1wb3J0IG9yZy5qYm9z\ncy5uZXR0eS5jaGFubmVsLkNoYW5uZWxTdGF0ZUV2ZW50OwppbXBvcnQgb3Jn\nLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbHM7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuY2hhbm5lbC5FeGNlcHRpb25FdmVudDsKaW1wb3J0IG9yZy5q\nYm9zcy5uZXR0eS5jaGFubmVsLk1lc3NhZ2VFdmVudDsKaW1wb3J0IG9yZy5q\nYm9zcy5uZXR0eS5jaGFubmVsLlNpbXBsZUNoYW5uZWxIYW5kbGVyOwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuc29ja2V0LkNsaWVudFNvY2tl\ndENoYW5uZWxGYWN0b3J5OwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmhhbmRs\nZXIuY29kZWMuZnJhbWUuQ29ycnVwdGVkRnJhbWVFeGNlcHRpb247CmltcG9y\ndCBvcmcuamJvc3MubmV0dHkuaGFuZGxlci5jb2RlYy5mcmFtZS5MZW5ndGhG\naWVsZEJhc2VkRnJhbWVEZWNvZGVyOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5\nLmhhbmRsZXIuY29kZWMuZnJhbWUuVG9vTG9uZ0ZyYW1lRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmpib3NzLm5ldHR5LmhhbmRsZXIudGltZW91dC5SZWFkVGlt\nZW91dEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5oYW5kbGVy\nLnRpbWVvdXQuUmVhZFRpbWVvdXRIYW5kbGVyOwppbXBvcnQgb3JnLmpib3Nz\nLm5ldHR5LnV0aWwuSGFzaGVkV2hlZWxUaW1lcjsKaW1wb3J0IG9yZy5qYm9z\ncy5uZXR0eS51dGlsLlRpbWVyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIFRoaXMg\nY2xhc3MgbWFuYWdlcyBhbGwgZGV0YWlscyBvZiBjb25uZWN0aW9uIHRvIGEg\ncGFydGljdWxhciBib29raWUuIEl0IGFsc28KICogaGFzIHJlY29ubmVjdCBs\nb2dpYyBpZiBhIGNvbm5lY3Rpb24gdG8gYSBib29raWUgZmFpbHMuCiAqCiAq\nLwoKQENoYW5uZWxQaXBlbGluZUNvdmVyYWdlKCJvbmUiKQpwdWJsaWMgY2xh\nc3MgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudCBleHRlbmRzIFNpbXBsZUNoYW5u\nZWxIYW5kbGVyIGltcGxlbWVudHMgQ2hhbm5lbFBpcGVsaW5lRmFjdG9yeSB7\nCgogICAgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5\nLmdldExvZ2dlcihQZXJDaGFubmVsQm9va2llQ2xpZW50LmNsYXNzKTsKCiAg\nICBzdGF0aWMgZmluYWwgbG9uZyBtYXhNZW1vcnkgPSBSdW50aW1lLmdldFJ1\nbnRpbWUoKS5tYXhNZW1vcnkoKSAvIDU7CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBNQVhfRlJBTUVfTEVOR1RIID0gMiAqIDEwMjQgKiAxMDI0OyAv\nLyAyTQoKICAgIEluZXRTb2NrZXRBZGRyZXNzIGFkZHI7CiAgICBBdG9taWNM\nb25nIHRvdGFsQnl0ZXNPdXRzdGFuZGluZzsKICAgIENsaWVudFNvY2tldENo\nYW5uZWxGYWN0b3J5IGNoYW5uZWxGYWN0b3J5OwogICAgT3JkZXJlZFNhZmVF\neGVjdXRvciBleGVjdXRvcjsKICAgIHByaXZhdGUgVGltZXIgcmVhZFRpbWVv\ndXRUaW1lcjsKCiAgICBDb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5\nLCBBZGRDb21wbGV0aW9uPiBhZGRDb21wbGV0aW9ucyA9IG5ldyBDb25jdXJy\nZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBBZGRDb21wbGV0aW9uPigpOwog\nICAgQ29uY3VycmVudEhhc2hNYXA8Q29tcGxldGlvbktleSwgUmVhZENvbXBs\nZXRpb24+IHJlYWRDb21wbGV0aW9ucyA9IG5ldyBDb25jdXJyZW50SGFzaE1h\ncDxDb21wbGV0aW9uS2V5LCBSZWFkQ29tcGxldGlvbj4oKTsKCiAgICAvKioK\nICAgICAqIFRoZSBmb2xsb3dpbmcgbWVtYmVyIHZhcmlhYmxlcyBkbyBub3Qg\nbmVlZCB0byBiZSBjb25jdXJyZW50LCBvciB2b2xhdGlsZQogICAgICogYmVj\nYXVzZSB0aGV5IGFyZSBhbHdheXMgdXBkYXRlZCB1bmRlciBhIGxvY2sKICAg\nICAqLwogICAgUXVldWU8R2VuZXJpY0NhbGxiYWNrPFZvaWQ+PiBwZW5kaW5n\nT3BzID0gbmV3IEFycmF5RGVxdWU8R2VuZXJpY0NhbGxiYWNrPFZvaWQ+Pigp\nOwogICAgdm9sYXRpbGUgQ2hhbm5lbCBjaGFubmVsID0gbnVsbDsKCiAgICBw\ncml2YXRlIGVudW0gQ29ubmVjdGlvblN0YXRlIHsKICAgICAgICBESVNDT05O\nRUNURUQsIENPTk5FQ1RJTkcsIENPTk5FQ1RFRCwgQ0xPU0VECiAgICAgICAg\nICAgIH07CgogICAgcHJpdmF0ZSB2b2xhdGlsZSBDb25uZWN0aW9uU3RhdGUg\nc3RhdGU7CiAgICBwcml2YXRlIGZpbmFsIENsaWVudENvbmZpZ3VyYXRpb24g\nY29uZjsKCiAgICBwdWJsaWMgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudChPcmRl\ncmVkU2FmZUV4ZWN1dG9yIGV4ZWN1dG9yLCBDbGllbnRTb2NrZXRDaGFubmVs\nRmFjdG9yeSBjaGFubmVsRmFjdG9yeSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIEF0b21pY0xv\nbmcgdG90YWxCeXRlc091dHN0YW5kaW5nKSB7CiAgICAgICAgdGhpcyhuZXcg\nQ2xpZW50Q29uZmlndXJhdGlvbigpLCBleGVjdXRvciwgY2hhbm5lbEZhY3Rv\ncnksIGFkZHIsIHRvdGFsQnl0ZXNPdXRzdGFuZGluZyk7CiAgICB9CiAgICAg\nICAgICAgIAogICAgcHVibGljIFBlckNoYW5uZWxCb29raWVDbGllbnQoQ2xp\nZW50Q29uZmlndXJhdGlvbiBjb25mLCBPcmRlcmVkU2FmZUV4ZWN1dG9yIGV4\nZWN1dG9yLCBDbGllbnRTb2NrZXRDaGFubmVsRmFjdG9yeSBjaGFubmVsRmFj\ndG9yeSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIGFkZHIsIEF0b21pY0xvbmcgdG90YWxCeXRlc091dHN0\nYW5kaW5nKSB7CiAgICAgICAgdGhpcy5jb25mID0gY29uZjsKICAgICAgICB0\naGlzLmFkZHIgPSBhZGRyOwogICAgICAgIHRoaXMuZXhlY3V0b3IgPSBleGVj\ndXRvcjsKICAgICAgICB0aGlzLnRvdGFsQnl0ZXNPdXRzdGFuZGluZyA9IHRv\ndGFsQnl0ZXNPdXRzdGFuZGluZzsKICAgICAgICB0aGlzLmNoYW5uZWxGYWN0\nb3J5ID0gY2hhbm5lbEZhY3Rvcnk7CiAgICAgICAgdGhpcy5zdGF0ZSA9IENv\nbm5lY3Rpb25TdGF0ZS5ESVNDT05ORUNURUQ7CiAgICAgICAgdGhpcy5yZWFk\nVGltZW91dFRpbWVyID0gbnVsbDsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQg\nY29ubmVjdCgpIHsKICAgICAgICBMT0cuaW5mbygiQ29ubmVjdGluZyB0byBi\nb29raWU6IHt9IiwgYWRkcik7CgogICAgICAgIC8vIFNldCB1cCB0aGUgQ2xp\nZW50Qm9vdFN0cmFwIHNvIHdlIGNhbiBjcmVhdGUgYSBuZXcgQ2hhbm5lbCBj\nb25uZWN0aW9uCiAgICAgICAgLy8gdG8gdGhlIGJvb2tpZS4KICAgICAgICBD\nbGllbnRCb290c3RyYXAgYm9vdHN0cmFwID0gbmV3IENsaWVudEJvb3RzdHJh\ncChjaGFubmVsRmFjdG9yeSk7CiAgICAgICAgYm9vdHN0cmFwLnNldFBpcGVs\naW5lRmFjdG9yeSh0aGlzKTsKICAgICAgICBib290c3RyYXAuc2V0T3B0aW9u\nKCJ0Y3BOb0RlbGF5IiwgY29uZi5nZXRDbGllbnRUY3BOb0RlbGF5KCkpOwog\nICAgICAgIGJvb3RzdHJhcC5zZXRPcHRpb24oImtlZXBBbGl2ZSIsIHRydWUp\nOwoKICAgICAgICBDaGFubmVsRnV0dXJlIGZ1dHVyZSA9IGJvb3RzdHJhcC5j\nb25uZWN0KGFkZHIpOwoKICAgICAgICBmdXR1cmUuYWRkTGlzdGVuZXIobmV3\nIENoYW5uZWxGdXR1cmVMaXN0ZW5lcigpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRl\nKENoYW5uZWxGdXR1cmUgZnV0dXJlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgICAgIGludCByYzsKICAgICAgICAgICAgICAgIFF1ZXVlPEdl\nbmVyaWNDYWxsYmFjazxWb2lkPj4gb2xkUGVuZGluZ09wczsKCiAgICAgICAg\nICAgICAgICBzeW5jaHJvbml6ZWQgKFBlckNoYW5uZWxCb29raWVDbGllbnQu\ndGhpcykgewoKICAgICAgICAgICAgICAgICAgICBpZiAoZnV0dXJlLmlzU3Vj\nY2VzcygpICYmIHN0YXRlID09IENvbm5lY3Rpb25TdGF0ZS5DT05ORUNUSU5H\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJTdWNjZXNz\nZnVsbHkgY29ubmVjdGVkIHRvIGJvb2tpZTogIiArIGFkZHIpOwogICAgICAg\nICAgICAgICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWwgPSBmdXR1cmUuZ2V0Q2hh\nbm5lbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IENvbm5l\nY3Rpb25TdGF0ZS5DT05ORUNURUQ7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIGlmIChmdXR1cmUuaXNTdWNjZXNzKCkgJiYgKHN0YXRlID09IENvbm5l\nY3Rpb25TdGF0ZS5DTE9TRUQKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgc3RhdGUgPT0gQ29ubmVj\ndGlvblN0YXRlLkRJU0NPTk5FQ1RFRCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJDbG9zZWQgYmVmb3JlIGNvbm5lY3Rpb24gY29t\ncGxldGVkLCBjbGVhbiB1cDogIiArIGFkZHIpOwogICAgICAgICAgICAgICAg\nICAgICAgICBmdXR1cmUuZ2V0Q2hhbm5lbCgpLmNsb3NlKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5Cb29raWVI\nYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb247CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNoYW5uZWwgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291\nbGQgbm90IGNvbm5lY3QgdG8gYm9va2llOiAiICsgYWRkcik7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5Cb29raWVI\nYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb247CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNoYW5uZWwgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoc3RhdGUgIT0gQ29ubmVjdGlvblN0YXRlLkNMT1NFRCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBDb25uZWN0aW9uU3Rh\ndGUuRElTQ09OTkVDVEVEOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB0\ncmljayB0byBub3QgZG8gb3BlcmF0aW9ucyB1bmRlciB0aGUgbG9jaywgdGFr\nZSB0aGUgbGlzdAogICAgICAgICAgICAgICAgICAgIC8vIG9mIHBlbmRpbmcg\nb3BzIGFuZCBhc3NpZ24gaXQgdG8gYSBuZXcgdmFyaWFibGUsIHdoaWxlCiAg\nICAgICAgICAgICAgICAgICAgLy8gZW1wdHlpbmcgdGhlIHBlbmRpbmcgb3Bz\nIGJ5IGp1c3QgYXNzaWduaW5nIGl0IHRvIGEgbmV3CiAgICAgICAgICAgICAg\nICAgICAgLy8gbGlzdAogICAgICAgICAgICAgICAgICAgIG9sZFBlbmRpbmdP\ncHMgPSBwZW5kaW5nT3BzOwogICAgICAgICAgICAgICAgICAgIHBlbmRpbmdP\ncHMgPSBuZXcgQXJyYXlEZXF1ZTxHZW5lcmljQ2FsbGJhY2s8Vm9pZD4+KCk7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZm9yIChHZW5l\ncmljQ2FsbGJhY2s8Vm9pZD4gcGVuZGluZ09wIDogb2xkUGVuZGluZ09wcykg\newogICAgICAgICAgICAgICAgICAgIHBlbmRpbmdPcC5vcGVyYXRpb25Db21w\nbGV0ZShyYywgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9KTsKICAgIH0KCiAgICB2b2lkIGNvbm5lY3RJZk5lZWRl\nZEFuZERvT3AoR2VuZXJpY0NhbGxiYWNrPFZvaWQ+IG9wKSB7CiAgICAgICAg\nYm9vbGVhbiBjb21wbGV0ZU9wTm93ID0gZmFsc2U7CiAgICAgICAgaW50IG9w\nUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgIC8vIGNvbW1vbiBj\nYXNlIHdpdGhvdXQgbG9jayBmaXJzdAogICAgICAgIGlmIChjaGFubmVsICE9\nIG51bGwgJiYgc3RhdGUgPT0gQ29ubmVjdGlvblN0YXRlLkNPTk5FQ1RFRCkg\newogICAgICAgICAgICBjb21wbGV0ZU9wTm93ID0gdHJ1ZTsKICAgICAgICB9\nIGVsc2UgewoKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAg\nICAgICAgICAgICAgICAvLyBjaGVjayB0aGUgY2hhbm5lbCBzdGF0dXMgYWdh\naW4gdW5kZXIgbG9jawogICAgICAgICAgICAgICAgaWYgKGNoYW5uZWwgIT0g\nbnVsbCAmJiBzdGF0ZSA9PSBDb25uZWN0aW9uU3RhdGUuQ09OTkVDVEVEKSB7\nCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVPcE5vdyA9IHRydWU7CiAg\nICAgICAgICAgICAgICAgICAgb3BSYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlID09IENvbm5lY3Rp\nb25TdGF0ZS5DTE9TRUQpIHsKICAgICAgICAgICAgICAgICAgICBjb21wbGV0\nZU9wTm93ID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBvcFJjID0gQktF\neGNlcHRpb24uQ29kZS5Cb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRp\nb247CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIC8vIGNoYW5uZWwgaXMgZWl0aGVyIG51bGwgKGZpcnN0IGNvbm5lY3Rp\nb24gYXR0ZW1wdCksIG9yIHRoZQogICAgICAgICAgICAgICAgICAgIC8vIGNo\nYW5uZWwgaXMgZGlzY29ubmVjdGVkLiBDb25uZWN0aW9uIGF0dGVtcHQgaXMg\nc3RpbGwgaW4KICAgICAgICAgICAgICAgICAgICAvLyBwcm9ncmVzcywgcXVl\ndWUgdXAgdGhpcyBvcC4gT3Agd2lsbCBiZSBleGVjdXRlZCB3aGVuCiAgICAg\nICAgICAgICAgICAgICAgLy8gY29ubmVjdGlvbiBhdHRlbXB0IGVpdGhlciBm\nYWlscyBvciBzdWNjZWVkcwogICAgICAgICAgICAgICAgICAgIHBlbmRpbmdP\ncHMuYWRkKG9wKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlID09\nIENvbm5lY3Rpb25TdGF0ZS5DT05ORUNUSU5HKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIGp1c3QgcmV0dXJuIGFzIGNvbm5lY3Rpb24gcmVxdWVz\ndCBoYXMgYWxyZWFkeSBzZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGFuZCB3YWl0aW5nIGZvciB0aGUgcmVzcG9uc2UuCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgLy8gc3dpdGNoIHN0YXRlIHRvIGNvbm5lY3Rpbmcg\nYW5kIGRvIGNvbm5lY3Rpb24gYXR0ZW1wdAogICAgICAgICAgICAgICAgICAg\nIHN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkNPTk5FQ1RJTkc7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFjb21w\nbGV0ZU9wTm93KSB7CiAgICAgICAgICAgICAgICAvLyBTdGFydCBjb25uZWN0\naW9uIGF0dGVtcHQgdG8gdGhlIGlucHV0IHNlcnZlciBob3N0LgogICAgICAg\nICAgICAgICAgY29ubmVjdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBpZiAoY29tcGxldGVPcE5vdykgewogICAgICAgICAgICBvcC5v\ncGVyYXRpb25Db21wbGV0ZShvcFJjLCBudWxsKTsKICAgICAgICB9CgogICAg\nfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxl\nZCBvbmx5IGFmdGVyIGNvbm5lY3Rpb24gaGFzIGJlZW4gY2hlY2tlZCBmb3IK\nICAgICAqIHtAbGluayAjY29ubmVjdElmTmVlZGVkQW5kRG9PcChHZW5lcmlj\nQ2FsbGJhY2spfQogICAgICoKICAgICAqIEBwYXJhbSBsZWRnZXJJZAogICAg\nICogQHBhcmFtIG1hc3RlcktleQogICAgICogQHBhcmFtIGVudHJ5SWQKICAg\nICAqIEBwYXJhbSBsYXN0Q29uZmlybWVkCiAgICAgKiBAcGFyYW0gbWFjQ29k\nZQogICAgICogQHBhcmFtIGRhdGEKICAgICAqIEBwYXJhbSBjYgogICAgICog\nQHBhcmFtIGN0eAogICAgICovCiAgICB2b2lkIGFkZEVudHJ5KGZpbmFsIGxv\nbmcgbGVkZ2VySWQsIGJ5dGVbXSBtYXN0ZXJLZXksIGZpbmFsIGxvbmcgZW50\ncnlJZCwgQ2hhbm5lbEJ1ZmZlciB0b1NlbmQsIFdyaXRlQ2FsbGJhY2sgY2Is\nCiAgICAgICAgICAgICAgICAgIE9iamVjdCBjdHgsIGZpbmFsIGludCBvcHRp\nb25zKSB7CiAgICAgICAgZmluYWwgaW50IGVudHJ5U2l6ZSA9IHRvU2VuZC5y\nZWFkYWJsZUJ5dGVzKCk7CgogICAgICAgIGZpbmFsIENvbXBsZXRpb25LZXkg\nY29tcGxldGlvbktleSA9IG5ldyBDb21wbGV0aW9uS2V5KGxlZGdlcklkLCBl\nbnRyeUlkKTsKCiAgICAgICAgYWRkQ29tcGxldGlvbnMucHV0KGNvbXBsZXRp\nb25LZXksIG5ldyBBZGRDb21wbGV0aW9uKGNiLCBlbnRyeVNpemUsIGN0eCkp\nOwoKICAgICAgICBpbnQgdG90YWxIZWFkZXJTaXplID0gNCAvLyBmb3IgdGhl\nIGxlbmd0aCBvZiB0aGUgcGFja2V0CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgNCAvLyBmb3IgdGhlIHR5cGUgb2YgcmVxdWVzdAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIEJvb2tpZVByb3RvY29sLk1BU1RF\nUl9LRVlfTEVOR1RIOyAvLyBmb3IgdGhlIG1hc3RlciBrZXkKCiAgICAgICAg\ndHJ5ewogICAgICAgICAgICBDaGFubmVsQnVmZmVyIGhlYWRlciA9IGNoYW5u\nZWwuZ2V0Q29uZmlnKCkuZ2V0QnVmZmVyRmFjdG9yeSgpLmdldEJ1ZmZlcih0\nb3RhbEhlYWRlclNpemUpOwoKICAgICAgICAgICAgaGVhZGVyLndyaXRlSW50\nKHRvdGFsSGVhZGVyU2l6ZSAtIDQgKyBlbnRyeVNpemUpOwogICAgICAgICAg\nICBoZWFkZXIud3JpdGVJbnQobmV3IFBhY2tldEhlYWRlcihCb29raWVQcm90\nb2NvbC5DVVJSRU5UX1BST1RPQ09MX1ZFUlNJT04sCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvb2tpZVByb3RvY29s\nLkFEREVOVFJZLCAoc2hvcnQpb3B0aW9ucykudG9JbnQoKSk7CiAgICAgICAg\nICAgIGhlYWRlci53cml0ZUJ5dGVzKG1hc3RlcktleSwgMCwgQm9va2llUHJv\ndG9jb2wuTUFTVEVSX0tFWV9MRU5HVEgpOwoKICAgICAgICAgICAgQ2hhbm5l\nbEJ1ZmZlciB3cmFwcGVkQnVmZmVyID0gQ2hhbm5lbEJ1ZmZlcnMud3JhcHBl\nZEJ1ZmZlcihoZWFkZXIsIHRvU2VuZCk7CgogICAgICAgICAgICBDaGFubmVs\nRnV0dXJlIGZ1dHVyZSA9IGNoYW5uZWwud3JpdGUod3JhcHBlZEJ1ZmZlcik7\nCiAgICAgICAgICAgIGZ1dHVyZS5hZGRMaXN0ZW5lcihuZXcgQ2hhbm5lbEZ1\ndHVyZUxpc3RlbmVyKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21wbGV0ZShD\naGFubmVsRnV0dXJlIGZ1dHVyZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGZ1dHVyZS5pc1N1Y2Nlc3MoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiU3Vj\nY2Vzc2Z1bGx5IHdyb3RlIHJlcXVlc3QgZm9yIGFkZGluZyBlbnRyeTogIiAr\nIGVudHJ5SWQgKyAiIGxlZGdlci1pZDogIiArIGxlZGdlcklkCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIiBib29raWU6ICIgKyBjaGFubmVsLmdldFJlbW90ZUFkZHJl\nc3MoKSArICIgZW50cnkgbGVuZ3RoOiAiICsgZW50cnlTaXplKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAv\nLyB0b3RhbEJ5dGVzT3V0c3RhbmRpbmcuYWRkQW5kR2V0KGVudHJ5U2l6ZSk7\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgZXJyb3JPdXRBZGRLZXkoY29tcGxldGlvbktleSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9KTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewogICAgICAg\nICAgICBMT0cud2FybigiQWRkIGVudHJ5IG9wZXJhdGlvbiBmYWlsZWQiLCBl\nKTsKICAgICAgICAgICAgZXJyb3JPdXRBZGRLZXkoY29tcGxldGlvbktleSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRFbnRyeUFu\nZEZlbmNlTGVkZ2VyKGZpbmFsIGxvbmcgbGVkZ2VySWQsIGJ5dGVbXSBtYXN0\nZXJLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBmaW5hbCBsb25nIGVudHJ5SWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBSZWFkRW50cnlDYWxsYmFjayBjYiwgT2JqZWN0\nIGN0eCkgewogICAgICAgIGZpbmFsIENvbXBsZXRpb25LZXkga2V5ID0gbmV3\nIENvbXBsZXRpb25LZXkobGVkZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIHJl\nYWRDb21wbGV0aW9ucy5wdXQoa2V5LCBuZXcgUmVhZENvbXBsZXRpb24oY2Is\nIGN0eCkpOwoKICAgICAgICBpbnQgdG90YWxIZWFkZXJTaXplID0gNCAvLyBm\nb3IgdGhlIGxlbmd0aCBvZiB0aGUgcGFja2V0CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgNCAvLyBmb3IgcmVxdWVzdCB0eXBlCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgOCAvLyBmb3IgbGVkZ2VySWQKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKyA4IC8vIGZvciBlbnRyeUlk\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgQm9va2llUHJvdG9j\nb2wuTUFTVEVSX0tFWV9MRU5HVEg7IC8vIGZvciBtYXN0ZXJLZXkKCiAgICAg\nICAgQ2hhbm5lbEJ1ZmZlciB0bXBFbnRyeSA9IGNoYW5uZWwuZ2V0Q29uZmln\nKCkuZ2V0QnVmZmVyRmFjdG9yeSgpLmdldEJ1ZmZlcih0b3RhbEhlYWRlclNp\nemUpOwogICAgICAgIHRtcEVudHJ5LndyaXRlSW50KHRvdGFsSGVhZGVyU2l6\nZSAtIDQpOwoKICAgICAgICB0bXBFbnRyeS53cml0ZUludChuZXcgUGFja2V0\nSGVhZGVyKEJvb2tpZVByb3RvY29sLkNVUlJFTlRfUFJPVE9DT0xfVkVSU0lP\nTiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIEJvb2tpZVByb3RvY29sLlJFQURFTlRSWSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIEJvb2tpZVByb3RvY29sLkZMQUdf\nRE9fRkVOQ0lORykudG9JbnQoKSk7CiAgICAgICAgdG1wRW50cnkud3JpdGVM\nb25nKGxlZGdlcklkKTsKICAgICAgICB0bXBFbnRyeS53cml0ZUxvbmcoZW50\ncnlJZCk7CiAgICAgICAgdG1wRW50cnkud3JpdGVCeXRlcyhtYXN0ZXJLZXks\nIDAsIEJvb2tpZVByb3RvY29sLk1BU1RFUl9LRVlfTEVOR1RIKTsKCiAgICAg\nICAgQ2hhbm5lbEZ1dHVyZSBmdXR1cmUgPSBjaGFubmVsLndyaXRlKHRtcEVu\ndHJ5KTsKICAgICAgICBmdXR1cmUuYWRkTGlzdGVuZXIobmV3IENoYW5uZWxG\ndXR1cmVMaXN0ZW5lcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKENoYW5uZWxG\ndXR1cmUgZnV0dXJlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIGlmIChmdXR1cmUuaXNTdWNjZXNzKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJTdWNjZXNzZnVsbHkgd3JvdGUgcmVx\ndWVzdCBmb3IgcmVhZGluZyBlbnRyeTogIiArIGVudHJ5SWQgKyAiIGxlZGdl\nci1pZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBs\nZWRnZXJJZCArICIgYm9va2llOiAiICsgY2hhbm5lbC5nZXRSZW1vdGVBZGRy\nZXNzKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JPdXRSZWFkS2V5\nKGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWFkRW50cnkoZmluYWwg\nbG9uZyBsZWRnZXJJZCwgZmluYWwgbG9uZyBlbnRyeUlkLCBSZWFkRW50cnlD\nYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgIGZpbmFsIENvbXBs\nZXRpb25LZXkga2V5ID0gbmV3IENvbXBsZXRpb25LZXkobGVkZ2VySWQsIGVu\ndHJ5SWQpOwogICAgICAgIHJlYWRDb21wbGV0aW9ucy5wdXQoa2V5LCBuZXcg\nUmVhZENvbXBsZXRpb24oY2IsIGN0eCkpOwoKICAgICAgICBpbnQgdG90YWxI\nZWFkZXJTaXplID0gNCAvLyBmb3IgdGhlIGxlbmd0aCBvZiB0aGUgcGFja2V0\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgNCAvLyBmb3IgcmVx\ndWVzdCB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgOCAv\nLyBmb3IgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyA4OyAvLyBmb3IgZW50cnlJZAoKICAgICAgICB0cnl7CiAgICAgICAgICAg\nIENoYW5uZWxCdWZmZXIgdG1wRW50cnkgPSBjaGFubmVsLmdldENvbmZpZygp\nLmdldEJ1ZmZlckZhY3RvcnkoKS5nZXRCdWZmZXIodG90YWxIZWFkZXJTaXpl\nKTsKICAgICAgICAgICAgdG1wRW50cnkud3JpdGVJbnQodG90YWxIZWFkZXJT\naXplIC0gNCk7CgogICAgICAgICAgICB0bXBFbnRyeS53cml0ZUludChuZXcg\nUGFja2V0SGVhZGVyKEJvb2tpZVByb3RvY29sLkNVUlJFTlRfUFJPVE9DT0xf\nVkVSU0lPTiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBCb29raWVQcm90b2NvbC5SRUFERU5UUlksIEJvb2tpZVBy\nb3RvY29sLkZMQUdfTk9ORSkudG9JbnQoKSk7CiAgICAgICAgICAgIHRtcEVu\ndHJ5LndyaXRlTG9uZyhsZWRnZXJJZCk7CiAgICAgICAgICAgIHRtcEVudHJ5\nLndyaXRlTG9uZyhlbnRyeUlkKTsKCiAgICAgICAgICAgIENoYW5uZWxGdXR1\ncmUgZnV0dXJlID0gY2hhbm5lbC53cml0ZSh0bXBFbnRyeSk7CiAgICAgICAg\nICAgIGZ1dHVyZS5hZGRMaXN0ZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3Rl\nbmVyKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21wbGV0ZShDaGFubmVsRnV0\ndXJlIGZ1dHVyZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGZ1dHVyZS5pc1N1Y2Nlc3MoKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiU3VjY2Vzc2Z1bGx5\nIHdyb3RlIHJlcXVlc3QgZm9yIHJlYWRpbmcgZW50cnk6ICIgKyBlbnRyeUlk\nICsgIiBsZWRnZXItaWQ6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBsZWRnZXJJZCAr\nICIgYm9va2llOiAiICsgY2hhbm5lbC5nZXRSZW1vdGVBZGRyZXNzKCkpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JPdXRSZWFk\nS2V5KGtleSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoKFRocm93YWJs\nZSBlKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJSZWFkIGVudHJ5IG9wZXJh\ndGlvbiBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZXJyb3JPdXRSZWFkS2V5\nKGtleSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRGlzY29u\nbmVjdHMgdGhlIGJvb2tpZSBjbGllbnQuIEl0IGNhbiBiZSByZXVzZWQuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGRpc2Nvbm5lY3QoKSB7CiAgICAgICAg\nY2xvc2VJbnRlcm5hbChmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBD\nbG9zZXMgdGhlIGJvb2tpZSBjbGllbnQgcGVybWFuZW50bHkuIEl0IGNhbm5v\ndCBiZSByZXVzZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkg\newogICAgICAgIGNsb3NlSW50ZXJuYWwodHJ1ZSk7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGNsb3NlSW50ZXJuYWwoYm9vbGVhbiBwZXJtYW5lbnQpIHsK\nICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYg\nKHBlcm1hbmVudCkgewogICAgICAgICAgICAgICAgc3RhdGUgPSBDb25uZWN0\naW9uU3RhdGUuQ0xPU0VEOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRl\nICE9IENvbm5lY3Rpb25TdGF0ZS5DTE9TRUQpIHsKICAgICAgICAgICAgICAg\nIHN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkRJU0NPTk5FQ1RFRDsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoY2hhbm5lbCAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGNoYW5uZWwuY2xvc2UoKS5hd2FpdFVuaW50ZXJy\ndXB0aWJseSgpOwogICAgICAgIH0KICAgICAgICBpZiAocmVhZFRpbWVvdXRU\naW1lciAhPSBudWxsKSB7CiAgICAgICAgICAgIHJlYWRUaW1lb3V0VGltZXIu\nc3RvcCgpOwogICAgICAgICAgICByZWFkVGltZW91dFRpbWVyID0gbnVsbDsK\nICAgICAgICB9CiAgICB9CgogICAgdm9pZCBlcnJvck91dFJlYWRLZXkoZmlu\nYWwgQ29tcGxldGlvbktleSBrZXkpIHsKICAgICAgICBleGVjdXRvci5zdWJt\naXRPcmRlcmVkKGtleS5sZWRnZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHNhZmVSdW4oKSB7CgogICAgICAgICAgICAgICAgUmVhZENvbXBsZXRpb24g\ncmVhZENvbXBsZXRpb24gPSByZWFkQ29tcGxldGlvbnMucmVtb3ZlKGtleSk7\nCgogICAgICAgICAgICAgICAgaWYgKHJlYWRDb21wbGV0aW9uICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCB3\ncml0ZSAgcmVxdWVzdCBmb3IgcmVhZGluZyBlbnRyeTogIiArIGtleS5lbnRy\neUlkICsgIiBsZWRnZXItaWQ6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyBrZXkubGVkZ2VySWQgKyAiIGJvb2tpZTogIiArIGNoYW5uZWwu\nZ2V0UmVtb3RlQWRkcmVzcygpKTsKCiAgICAgICAgICAgICAgICAgICAgcmVh\nZENvbXBsZXRpb24uY2IucmVhZEVudHJ5Q29tcGxldGUoQktFeGNlcHRpb24u\nQ29kZS5Cb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24sCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAga2V5LmxlZGdlcklkLCBrZXkuZW50cnlJZCwgbnVsbCwgcmVhZENv\nbXBsZXRpb24uY3R4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICB9KTsKICAgIH0KCiAgICB2b2lkIGVycm9yT3V0QWRkS2V5\nKGZpbmFsIENvbXBsZXRpb25LZXkga2V5KSB7CiAgICAgICAgZXhlY3V0b3Iu\nc3VibWl0T3JkZXJlZChrZXkubGVkZ2VySWQsIG5ldyBTYWZlUnVubmFibGUo\nKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBzYWZlUnVuKCkgewoKICAgICAgICAgICAgICAgIEFkZENvbXBsZXRp\nb24gYWRkQ29tcGxldGlvbiA9IGFkZENvbXBsZXRpb25zLnJlbW92ZShrZXkp\nOwoKICAgICAgICAgICAgICAgIGlmIChhZGRDb21wbGV0aW9uICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgYkFkZHJlc3MgPSAibnVs\nbCI7CiAgICAgICAgICAgICAgICAgICAgaWYoY2hhbm5lbCAhPSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBiQWRkcmVzcyA9IGNoYW5uZWwuZ2V0\nUmVtb3RlQWRkcmVzcygpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJDb3VsZCBub3Qgd3JpdGUgcmVxdWVzdCBmb3IgYWRk\naW5nIGVudHJ5OiAiICsga2V5LmVudHJ5SWQgKyAiIGxlZGdlci1pZDogIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGtleS5sZWRnZXJJZCAr\nICIgYm9va2llOiAiICsgYkFkZHJlc3MpOwoKICAgICAgICAgICAgICAgICAg\nICBhZGRDb21wbGV0aW9uLmNiLndyaXRlQ29tcGxldGUoQktFeGNlcHRpb24u\nQ29kZS5Cb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24sIGtleS5s\nZWRnZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAga2V5LmVudHJ5SWQsIGFkZHIsIGFkZENvbXBsZXRp\nb24uY3R4KTsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkludm9r\nZWQgY2FsbGJhY2sgbWV0aG9kOiAiICsga2V5LmVudHJ5SWQpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0pOwoKICAgIH0K\nCiAgICAvKioKICAgICAqIEVycm9ycyBvdXQgcGVuZGluZyBlbnRyaWVzLiBX\nZSBjYWxsIHRoaXMgbWV0aG9kIGZyb20gb25lIHRocmVhZCB0byBhdm9pZAog\nICAgICogY29uY3VycmVudCBleGVjdXRpb25zIHRvIFF1b3J1bU9wTW9uaXRv\nciAoaW1wbGVtZW50cyBjYWxsYmFja3MpLiBJdCBzZWVtcwogICAgICogc2lt\ncGxlciB0byBjYWxsIGl0IGZyb20gQm9va2llSGFuZGxlIGluc3RlYWQgb2Yg\nY2FsbGluZyBkaXJlY3RseSBmcm9tCiAgICAgKiBoZXJlLgogICAgICovCgog\nICAgdm9pZCBlcnJvck91dE91dHN0YW5kaW5nRW50cmllcygpIHsKCiAgICAg\nICAgLy8gRE8gTk9UIHJld3JpdGUgdGhlc2UgdXNpbmcgTWFwLkVudHJ5IGl0\nZXJhdGlvbnMuIFdlIHdhbnQgdG8gaXRlcmF0ZQogICAgICAgIC8vIG9uIGtl\neXMgYW5kIHNlZSBpZiB3ZSBhcmUgc3VjY2Vzc2Z1bGx5IGFibGUgdG8gcmVt\nb3ZlIHRoZSBrZXkgZnJvbQogICAgICAgIC8vIHRoZSBtYXAuIEJlY2F1c2Ug\ndGhlIGFkZCBhbmQgdGhlIHJlYWQgbWV0aG9kcyBhbHNvIGRvIHRoZSBzYW1l\nIHRoaW5nCiAgICAgICAgLy8gaW4gY2FzZSB0aGV5IGdldCBhIHdyaXRlIGZh\naWx1cmUgb24gdGhlIHNvY2tldC4gVGhlIG9uZSB3aG8KICAgICAgICAvLyBz\ndWNjZXNzZnVsbHkgcmVtb3ZlcyB0aGUga2V5IGZyb20gdGhlIG1hcCBpcyB0\naGUgb25lIHJlc3BvbnNpYmxlIGZvcgogICAgICAgIC8vIGNhbGxpbmcgdGhl\nIGFwcGxpY2F0aW9uIGNhbGxiYWNrLgoKICAgICAgICBmb3IgKENvbXBsZXRp\nb25LZXkga2V5IDogYWRkQ29tcGxldGlvbnMua2V5U2V0KCkpIHsKICAgICAg\nICAgICAgZXJyb3JPdXRBZGRLZXkoa2V5KTsKICAgICAgICB9CgogICAgICAg\nIGZvciAoQ29tcGxldGlvbktleSBrZXkgOiByZWFkQ29tcGxldGlvbnMua2V5\nU2V0KCkpIHsKICAgICAgICAgICAgZXJyb3JPdXRSZWFkS2V5KGtleSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSW4gdGhlIG5ldHR5IHBp\ncGVsaW5lLCB3ZSBuZWVkIHRvIHNwbGl0IHBhY2tldHMgYmFzZWQgb24gbGVu\nZ3RoLCBzbyB3ZQogICAgICogdXNlIHRoZSB7QGxpbmsgTGVuZ3RoRmllbGRC\nYXNlZEZyYW1lRGVjb2Rlcn0uIE90aGVyIHRoYW4gdGhhdCBhbGwgYWN0aW9u\ncwogICAgICogYXJlIGNhcnJpZWQgb3V0IGluIHRoaXMgY2xhc3MsIGUuZy4s\nIG1ha2luZyBzZW5zZSBvZiByZWNlaXZlZCBtZXNzYWdlcywKICAgICAqIHBy\nZXBlbmRpbmcgdGhlIGxlbmd0aCB0byBvdXRnb2luZyBwYWNrZXRzIGV0Yy4K\nICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQ2hhbm5lbFBpcGVs\naW5lIGdldFBpcGVsaW5lKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nQ2hhbm5lbFBpcGVsaW5lIHBpcGVsaW5lID0gQ2hhbm5lbHMucGlwZWxpbmUo\nKTsKCiAgICAgICAgaWYgKHJlYWRUaW1lb3V0VGltZXIgPT0gbnVsbCkgewog\nICAgICAgICAgICByZWFkVGltZW91dFRpbWVyID0gbmV3IEhhc2hlZFdoZWVs\nVGltZXIoKTsKICAgICAgICB9CgogICAgICAgIHBpcGVsaW5lLmFkZExhc3Qo\nInJlYWRUaW1lb3V0IiwgbmV3IFJlYWRUaW1lb3V0SGFuZGxlcihyZWFkVGlt\nZW91dFRpbWVyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZi5nZXRSZWFkVGlt\nZW91dCgpKSk7CiAgICAgICAgcGlwZWxpbmUuYWRkTGFzdCgibGVuZ3RoYmFz\nZWRmcmFtZWRlY29kZXIiLCBuZXcgTGVuZ3RoRmllbGRCYXNlZEZyYW1lRGVj\nb2RlcihNQVhfRlJBTUVfTEVOR1RILCAwLCA0LCAwLCA0KSk7CiAgICAgICAg\ncGlwZWxpbmUuYWRkTGFzdCgibWFpbmhhbmRsZXIiLCB0aGlzKTsKICAgICAg\nICByZXR1cm4gcGlwZWxpbmU7CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBv\ndXIgY2hhbm5lbCBoYXMgZGlzY29ubmVjdGVkLCB3ZSBqdXN0IGVycm9yIG91\ndCB0aGUgcGVuZGluZyBlbnRyaWVzCiAgICAgKi8KICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgY2hhbm5lbERpc2Nvbm5lY3RlZChDaGFubmVsSGFu\nZGxlckNvbnRleHQgY3R4LCBDaGFubmVsU3RhdGVFdmVudCBlKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiRGlzY29ubmVjdGVkIGZy\nb20gYm9va2llOiAiICsgYWRkcik7CiAgICAgICAgZXJyb3JPdXRPdXRzdGFu\nZGluZ0VudHJpZXMoKTsKICAgICAgICBDaGFubmVsIGMgPSB0aGlzLmNoYW5u\nZWw7CiAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAgICAgICBjLmNs\nb3NlKCk7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZCAodGhpcykg\newogICAgICAgICAgICBpZiAoc3RhdGUgIT0gQ29ubmVjdGlvblN0YXRlLkNM\nT1NFRCkgewogICAgICAgICAgICAgICAgc3RhdGUgPSBDb25uZWN0aW9uU3Rh\ndGUuRElTQ09OTkVDVEVEOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICAvLyB3ZSBkb24ndCB3YW50IHRvIHJlY29ubmVjdCByaWdodCBhd2F5\nLiBJZiBzb21lb25lIHNlbmRzIGEgcmVxdWVzdCB0bwogICAgICAgIC8vIHRo\naXMgYWRkcmVzcywgd2Ugd2lsbCByZWNvbm5lY3QuCiAgICB9CgogICAgLyoq\nCiAgICAgKiBDYWxsZWQgYnkgbmV0dHkgd2hlbiBhbiBleGNlcHRpb24gaGFw\ncGVucyBpbiBvbmUgb2YgdGhlIG5ldHR5IHRocmVhZHMKICAgICAqIChtb3N0\nbHkgZHVlIHRvIHdoYXQgd2UgZG8gaW4gdGhlIG5ldHR5IHRocmVhZHMpCiAg\nICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgZXhjZXB0aW9u\nQ2F1Z2h0KENoYW5uZWxIYW5kbGVyQ29udGV4dCBjdHgsIEV4Y2VwdGlvbkV2\nZW50IGUpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFRocm93YWJsZSB0\nID0gZS5nZXRDYXVzZSgpOwogICAgICAgIGlmICh0IGluc3RhbmNlb2YgQ29y\ncnVwdGVkRnJhbWVFeGNlcHRpb24gfHwgdCBpbnN0YW5jZW9mIFRvb0xvbmdG\ncmFtZUV4Y2VwdGlvbikgewogICAgICAgICAgICBMT0cuZXJyb3IoIkNvcnJ1\ncHRlZCBmcmFtIHJlY2VpdmVkIGZyb20gYm9va2llOiAiCiAgICAgICAgICAg\nICAgICAgICAgICArIGUuZ2V0Q2hhbm5lbCgpLmdldFJlbW90ZUFkZHJlc3Mo\nKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYg\nKHQgaW5zdGFuY2VvZiBSZWFkVGltZW91dEV4Y2VwdGlvbikgewogICAgICAg\nICAgICBmb3IgKENvbXBsZXRpb25LZXkga2V5IDogYWRkQ29tcGxldGlvbnMu\na2V5U2V0KCkpIHsKICAgICAgICAgICAgICAgIGlmIChrZXkuc2hvdWxkVGlt\nZW91dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JPdXRBZGRLZXko\na2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nICAgICBmb3IgKENvbXBsZXRpb25LZXkga2V5IDogcmVhZENvbXBsZXRpb25z\nLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoa2V5LnNob3VsZFRp\nbWVvdXQoKSkgewogICAgICAgICAgICAgICAgICAgIGVycm9yT3V0UmVhZEtl\neShrZXkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0IGluc3Rh\nbmNlb2YgSU9FeGNlcHRpb24pIHsKICAgICAgICAgICAgLy8gdGhlc2UgYXJl\nIHRocm93biB3aGVuIGEgYm9va2llIGZhaWxzLCBsb2dnaW5nIHRoZW0ganVz\ndCBwb2xsdXRlcwogICAgICAgICAgICAvLyB0aGUgbG9ncyAodGhlIGZhaWx1\ncmUgaXMgbG9nZ2VkIGZyb20gdGhlIGxpc3RlbmVycyBvbiB0aGUgd3JpdGUK\nICAgICAgICAgICAgLy8gb3BlcmF0aW9uKSwgc28gSSdsbCBqdXN0IGlnbm9y\nZSBpdCBoZXJlLgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBMT0cuZXJyb3IoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIGNhdWdodCBi\neSBib29raWUgY2xpZW50IGNoYW5uZWwgaGFuZGxlciIsIHQpOwogICAgICAg\nIC8vIFNpbmNlIHdlIGFyZSBhIGxpYnJhcnksIGNhbnQgdGVybWluYXRlIEFw\ncCBoZXJlLCBjYW4gd2U/CiAgICB9CgogICAgLyoqCiAgICAgKiBDYWxsZWQg\nYnkgbmV0dHkgd2hlbiBhIG1lc3NhZ2UgaXMgcmVjZWl2ZWQgb24gYSBjaGFu\nbmVsCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgbWVz\nc2FnZVJlY2VpdmVkKENoYW5uZWxIYW5kbGVyQ29udGV4dCBjdHgsIE1lc3Nh\nZ2VFdmVudCBlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIShl\nLmdldE1lc3NhZ2UoKSBpbnN0YW5jZW9mIENoYW5uZWxCdWZmZXIpKSB7CiAg\nICAgICAgICAgIGN0eC5zZW5kVXBzdHJlYW0oZSk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CgogICAgICAgIGZpbmFsIENoYW5uZWxCdWZmZXIg\nYnVmZmVyID0gKENoYW5uZWxCdWZmZXIpIGUuZ2V0TWVzc2FnZSgpOwogICAg\nICAgIGZpbmFsIGludCByYzsKICAgICAgICBmaW5hbCBsb25nIGxlZGdlcklk\nLCBlbnRyeUlkOwogICAgICAgIGZpbmFsIFBhY2tldEhlYWRlciBoZWFkZXI7\nCgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGhlYWRlciA9IFBhY2tldEhl\nYWRlci5mcm9tSW50KGJ1ZmZlci5yZWFkSW50KCkpOwogICAgICAgICAgICBy\nYyA9IGJ1ZmZlci5yZWFkSW50KCk7CiAgICAgICAgICAgIGxlZGdlcklkID0g\nYnVmZmVyLnJlYWRMb25nKCk7CiAgICAgICAgICAgIGVudHJ5SWQgPSBidWZm\nZXIucmVhZExvbmcoKTsKICAgICAgICB9IGNhdGNoIChJbmRleE91dE9mQm91\nbmRzRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVW5w\nYXJzZWFibGUgcmVzcG9uc2UgZnJvbSBib29raWU6ICIgKyBhZGRyLCBleCk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGV4ZWN1\ndG9yLnN1Ym1pdE9yZGVyZWQobGVkZ2VySWQsIG5ldyBTYWZlUnVubmFibGUo\nKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBzYWZlUnVuKCkgewogICAgICAgICAgICAgICAgc3dpdGNoIChoZWFk\nZXIuZ2V0T3BDb2RlKCkpIHsKICAgICAgICAgICAgICAgIGNhc2UgQm9va2ll\nUHJvdG9jb2wuQURERU5UUlk6CiAgICAgICAgICAgICAgICAgICAgaGFuZGxl\nQWRkUmVzcG9uc2UobGVkZ2VySWQsIGVudHJ5SWQsIHJjKTsKICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgQm9va2ll\nUHJvdG9jb2wuUkVBREVOVFJZOgogICAgICAgICAgICAgICAgICAgIGhhbmRs\nZVJlYWRSZXNwb25zZShsZWRnZXJJZCwgZW50cnlJZCwgcmMsIGJ1ZmZlcik7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiVW5leHBl\nY3RlZCByZXNwb25zZSwgdHlwZTogIiArIGhlYWRlci5nZXRPcENvZGUoKSAK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHJlY2VpdmVkIGZy\nb20gYm9va2llOiAiICsgYWRkciArICIgLCBpZ25vcmluZyIpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cgog\nICAgdm9pZCBoYW5kbGVBZGRSZXNwb25zZShsb25nIGxlZGdlcklkLCBsb25n\nIGVudHJ5SWQsIGludCByYykgewogICAgICAgIGlmIChMT0cuaXNEZWJ1Z0Vu\nYWJsZWQoKSkgewogICAgICAgICAgICBMT0cuZGVidWcoIkdvdCByZXNwb25z\nZSBmb3IgYWRkIHJlcXVlc3QgZnJvbSBib29raWU6ICIgKyBhZGRyICsgIiBm\nb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQgKyAiIGVudHJ5OiAiCiAgICAgICAg\nICAgICAgICAgICAgICArIGVudHJ5SWQgKyAiIHJjOiAiICsgcmMpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gY29udmVydCB0byBCS0V4Y2VwdGlvbiBjb2Rl\nIGJlY2F1c2UgdGhhdHMgd2hhdCB0aGUgdXBwcGVyCiAgICAgICAgLy8gbGF5\nZXJzIGV4cGVjdC4gVGhpcyBpcyBVR0xZLCB0aGVyZSBzaG91bGQganVzdCBi\nZSBvbmUgc2V0IG9mCiAgICAgICAgLy8gZXJyb3IgY29kZXMuCiAgICAgICAg\nc3dpdGNoIChyYykgewogICAgICAgIGNhc2UgQm9va2llUHJvdG9jb2wuRU9L\nOgogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7CiAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgQm9va2llUHJvdG9jb2wuRUJB\nRFZFUlNJT046CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5Q\ncm90b2NvbFZlcnNpb25FeGNlcHRpb247CiAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgIGNhc2UgQm9va2llUHJvdG9jb2wuRUZFTkNFRDoKICAgICAgICAg\nICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2RlLkxlZGdlckZlbmNlZEV4Y2VwdGlv\nbjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBCb29raWVQcm90\nb2NvbC5FVUE6CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5V\nbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb247CiAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgIGNhc2UgQm9va2llUHJvdG9jb2wuRVJFQURPTkxZOgogICAg\nICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuV3JpdGVPblJlYWRPbmx5\nQm9va2llRXhjZXB0aW9uOwogICAgICAgICAgICBicmVhazsKICAgICAgICBk\nZWZhdWx0OgogICAgICAgICAgICBMT0cuZXJyb3IoIkFkZCBmb3IgbGVkZ2Vy\nOiAiICsgbGVkZ2VySWQgKyAiLCBlbnRyeTogIiArIGVudHJ5SWQgKyAiIGZh\naWxlZCBvbiBib29raWU6ICIgKyBhZGRyCiAgICAgICAgICAgICAgICAgICAg\nICArICIgd2l0aCBjb2RlOiAiICsgcmMpOwogICAgICAgICAgICByYyA9IEJL\nRXhjZXB0aW9uLkNvZGUuV3JpdGVFeGNlcHRpb247CiAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgIH0KCiAgICAgICAgQWRkQ29tcGxldGlvbiBhYzsKICAg\nICAgICBhYyA9IGFkZENvbXBsZXRpb25zLnJlbW92ZShuZXcgQ29tcGxldGlv\nbktleShsZWRnZXJJZCwgZW50cnlJZCkpOwogICAgICAgIGlmIChhYyA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVW5leHBlY3RlZCBhZGQg\ncmVzcG9uc2UgcmVjZWl2ZWQgZnJvbSBib29raWU6ICIgKyBhZGRyICsgIiBm\nb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAg\nICsgIiwgZW50cnk6ICIgKyBlbnRyeUlkICsgIiAsIGlnbm9yaW5nIik7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIHRvdGFs\nQnl0ZXNPdXRzdGFuZGluZy5hZGRBbmRHZXQoLWFjLnNpemUpOwoKICAgICAg\nICBhYy5jYi53cml0ZUNvbXBsZXRlKHJjLCBsZWRnZXJJZCwgZW50cnlJZCwg\nYWRkciwgYWMuY3R4KTsKCiAgICB9CgogICAgdm9pZCBoYW5kbGVSZWFkUmVz\ncG9uc2UobG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLCBpbnQgcmMsIENo\nYW5uZWxCdWZmZXIgYnVmZmVyKSB7CiAgICAgICAgaWYgKExPRy5pc0RlYnVn\nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiR290IHJlc3Bv\nbnNlIGZvciByZWFkIHJlcXVlc3QgZnJvbSBib29raWU6ICIgKyBhZGRyICsg\nIiBmb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQgKyAiIGVudHJ5OiAiCiAgICAg\nICAgICAgICAgICAgICAgICArIGVudHJ5SWQgKyAiIHJjOiAiICsgcmMgKyAi\nIGVudHJ5IGxlbmd0aDogIiArIGJ1ZmZlci5yZWFkYWJsZUJ5dGVzKCkpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gY29udmVydCB0byBCS0V4Y2VwdGlvbiBj\nb2RlIGJlY2F1c2UgdGhhdHMgd2hhdCB0aGUgdXBwcGVyCiAgICAgICAgLy8g\nbGF5ZXJzIGV4cGVjdC4gVGhpcyBpcyBVR0xZLCB0aGVyZSBzaG91bGQganVz\ndCBiZSBvbmUgc2V0IG9mCiAgICAgICAgLy8gZXJyb3IgY29kZXMuCiAgICAg\nICAgaWYgKHJjID09IEJvb2tpZVByb3RvY29sLkVPSykgewogICAgICAgICAg\nICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7CiAgICAgICAgfSBlbHNlIGlm\nIChyYyA9PSBCb29raWVQcm90b2NvbC5FTk9FTlRSWSB8fCByYyA9PSBCb29r\naWVQcm90b2NvbC5FTk9MRURHRVIpIHsKICAgICAgICAgICAgcmMgPSBCS0V4\nY2VwdGlvbi5Db2RlLk5vU3VjaEVudHJ5RXhjZXB0aW9uOwogICAgICAgIH0g\nZWxzZSBpZiAocmMgPT0gQm9va2llUHJvdG9jb2wuRUJBRFZFUlNJT04pIHsK\nICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2RlLlByb3RvY29sVmVy\nc2lvbkV4Y2VwdGlvbjsKICAgICAgICB9IGVsc2UgaWYgKHJjID09IEJvb2tp\nZVByb3RvY29sLkVVQSkgewogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9u\nLkNvZGUuVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9uOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiUmVhZCBmb3IgbGVkZ2Vy\nOiAiICsgbGVkZ2VySWQgKyAiLCBlbnRyeTogIiArIGVudHJ5SWQgKyAiIGZh\naWxlZCBvbiBib29raWU6ICIgKyBhZGRyCiAgICAgICAgICAgICAgICAgICAg\nICArICIgd2l0aCBjb2RlOiAiICsgcmMpOwogICAgICAgICAgICByYyA9IEJL\nRXhjZXB0aW9uLkNvZGUuUmVhZEV4Y2VwdGlvbjsKICAgICAgICB9CgogICAg\nICAgIENvbXBsZXRpb25LZXkga2V5ID0gbmV3IENvbXBsZXRpb25LZXkobGVk\nZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIFJlYWRDb21wbGV0aW9uIHJlYWRD\nb21wbGV0aW9uID0gcmVhZENvbXBsZXRpb25zLnJlbW92ZShrZXkpOwoKICAg\nICAgICBpZiAocmVhZENvbXBsZXRpb24gPT0gbnVsbCkgewogICAgICAgICAg\nICAvKgogICAgICAgICAgICAgKiBUaGlzIGlzIGEgc3BlY2lhbCBjYXNlLiBX\naGVuIHJlY292ZXJpbmcgYSBsZWRnZXIsIGEgY2xpZW50CiAgICAgICAgICAg\nICAqIHN1Ym1pdHMgYSByZWFkIHJlcXVlc3Qgd2l0aCBpZCAtMSwgYW5kIHJl\nY2VpdmVzIGEgcmVzcG9uc2Ugd2l0aCBhCiAgICAgICAgICAgICAqIGRpZmZl\ncmVudCBlbnRyeSBpZC4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIAog\nICAgICAgICAgICByZWFkQ29tcGxldGlvbiA9IHJlYWRDb21wbGV0aW9ucy5y\nZW1vdmUobmV3IENvbXBsZXRpb25LZXkobGVkZ2VySWQsIEJvb2tpZVByb3Rv\nY29sLkxBU1RfQUREX0NPTkZJUk1FRCkpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKHJlYWRDb21wbGV0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJVbmV4cGVjdGVkIHJlYWQgcmVzcG9uc2UgcmVjZWl2ZWQgZnJv\nbSBib29raWU6ICIgKyBhZGRyICsgIiBmb3IgbGVkZ2VyOiAiICsgbGVkZ2Vy\nSWQKICAgICAgICAgICAgICAgICAgICAgICsgIiwgZW50cnk6ICIgKyBlbnRy\neUlkICsgIiAsIGlnbm9yaW5nIik7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIHJlYWRDb21wbGV0aW9uLmNiLnJlYWRFbnRyeUNv\nbXBsZXRlKHJjLCBsZWRnZXJJZCwgZW50cnlJZCwgYnVmZmVyLnNsaWNlKCks\nIHJlYWRDb21wbGV0aW9uLmN0eCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBC\nb2lsZXItcGxhdGUgd3JhcHBlciBjbGFzc2VzIGZvbGxvdwogICAgICoKICAg\nICAqLwogICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZwogICAgc3RhdGljIGNs\nYXNzIFJlYWRDb21wbGV0aW9uIHsKICAgICAgICBmaW5hbCBSZWFkRW50cnlD\nYWxsYmFjayBjYjsKICAgICAgICBmaW5hbCBPYmplY3QgY3R4OwoKICAgICAg\nICBwdWJsaWMgUmVhZENvbXBsZXRpb24oUmVhZEVudHJ5Q2FsbGJhY2sgY2Is\nIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAg\nICAgICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICB9CiAgICB9CgogICAg\nLy8gdmlzaWJsZSBmb3IgdGVzdGluZwogICAgc3RhdGljIGNsYXNzIEFkZENv\nbXBsZXRpb24gewogICAgICAgIGZpbmFsIFdyaXRlQ2FsbGJhY2sgY2I7CiAg\nICAgICAgLy9maW5hbCBsb25nIHNpemU7CiAgICAgICAgZmluYWwgT2JqZWN0\nIGN0eDsKCiAgICAgICAgcHVibGljIEFkZENvbXBsZXRpb24oV3JpdGVDYWxs\nYmFjayBjYiwgbG9uZyBzaXplLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAg\nIHRoaXMuY2IgPSBjYjsKICAgICAgICAgICAgLy90aGlzLnNpemUgPSBzaXpl\nOwogICAgICAgICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICB9CiAgICB9\nCgogICAgLy8gdmlzYWJsZSBmb3IgdGVzdGluZwogICAgQ29tcGxldGlvbktl\neSBuZXdDb21wbGV0aW9uS2V5KGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJ\nZCkgewogICAgICAgIHJldHVybiBuZXcgQ29tcGxldGlvbktleShsZWRnZXJJ\nZCwgZW50cnlJZCk7CiAgICB9CgogICAgLy8gdmlzYWJsZSBmb3IgdGVzdGlu\nZwogICAgY2xhc3MgQ29tcGxldGlvbktleSB7CiAgICAgICAgbG9uZyBsZWRn\nZXJJZDsKICAgICAgICBsb25nIGVudHJ5SWQ7CiAgICAgICAgZmluYWwgbG9u\nZyB0aW1lb3V0QXQ7CgogICAgICAgIENvbXBsZXRpb25LZXkobG9uZyBsZWRn\nZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgICAgIHRoaXMubGVkZ2Vy\nSWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5lbnRyeUlkID0gZW50\ncnlJZDsKICAgICAgICAgICAgdGhpcy50aW1lb3V0QXQgPSBNYXRoVXRpbHMu\nbm93KCkgKyAoY29uZi5nZXRSZWFkVGltZW91dCgpKjEwMDApOwogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4g\nZXF1YWxzKE9iamVjdCBvYmopIHsKICAgICAgICAgICAgaWYgKCEob2JqIGlu\nc3RhbmNlb2YgQ29tcGxldGlvbktleSkgfHwgb2JqID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBDb21wbGV0aW9uS2V5IHRoYXQgPSAoQ29tcGxldGlvbktleSkg\nb2JqOwogICAgICAgICAgICByZXR1cm4gdGhpcy5sZWRnZXJJZCA9PSB0aGF0\nLmxlZGdlcklkICYmIHRoaXMuZW50cnlJZCA9PSB0aGF0LmVudHJ5SWQ7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgaW50\nIGhhc2hDb2RlKCkgewogICAgICAgICAgICByZXR1cm4gKChpbnQpIGxlZGdl\ncklkIDw8IDE2KSBeICgoaW50KSBlbnRyeUlkKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBTdHJpbmcuZm9ybWF0KCJMZWRnZXJFbnRyeSglZCwgJWQpIiwgbGVk\nZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gc2hvdWxkVGltZW91dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRo\naXMudGltZW91dEF0IDw9IE1hdGhVdGlscy5ub3coKTsKICAgICAgICB9CiAg\nICB9Cgp9Cg==\n","encoding":"base64"}

