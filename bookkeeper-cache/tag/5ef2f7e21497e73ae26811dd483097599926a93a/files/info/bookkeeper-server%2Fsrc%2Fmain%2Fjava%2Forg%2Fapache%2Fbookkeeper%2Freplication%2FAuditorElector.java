{"sha":"fb82dab6152eb91156657b3c2b2bad9e5159309d","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmI4MmRhYjYxNTJlYjkxMTU2NjU3YjNjMmIyYmFkOWU1MTU5MzA5ZA==","size":12983,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/fb82dab6152eb91156657b3c2b2bad9e5159309d","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CgppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkF1ZGl0b3JWb3RlRm9ybWF0\nOwppbXBvcnQgY29tLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJs\nZUZvclRlc3Rpbmc7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVj\ndXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvclNl\ncnZpY2U7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaHJlYWRGYWN0\nb3J5OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21p\nY0Jvb2xlYW47CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYu\nU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWls\nYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51\ndGlsLkJvb2tLZWVwZXJDb25zdGFudHM7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBl\nci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5X\nYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVudC5F\ndmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVy\nLkV2ZW50LktlZXBlclN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLlRl\neHRGb3JtYXQ7CmltcG9ydCBzdGF0aWMgY29tLmdvb2dsZS5jb21tb24uYmFz\nZS5DaGFyc2V0cy5VVEZfODsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogUGVyZm9y\nbWluZyBhdWRpdG9yIGVsZWN0aW9uIHVzaW5nIEFwYWNoZSBab29LZWVwZXIu\nIFVzaW5nIFpvb0tlZXBlciBhcyBhCiAqIGNvb3JkaW5hdGlvbiBzZXJ2aWNl\nLCB3aGVuIGEgYm9va2llIGJpZHMgZm9yIGF1ZGl0b3IsIGl0IGNyZWF0ZXMg\nYW4gZXBoZW1lcmFsCiAqIHNlcXVlbnRpYWwgZmlsZSAoem5vZGUpIG9uIFpv\nb0tlZXBlciBhbmQgY29uc2lkZXJlZCBhcyB0aGVpciB2b3RlLiBWb3RlCiAq\nIGZvcm1hdCBpcyAnVl9zZXF1ZW5jZW51bWJlcicuIEVsZWN0aW9uIHdpbGwg\nYmUgZG9uZSBieSBjb21wYXJpbmcgdGhlCiAqIGVwaGVtZXJhbCBzZXF1ZW50\naWFsIG51bWJlcnMgYW5kIHRoZSBib29raWUgd2hpY2ggaGFzIGNyZWF0ZWQg\ndGhlIGxlYXN0IHpub2RlCiAqIHdpbGwgYmUgZWxlY3RlZCBhcyBBdWRpdG9y\nLiBBbGwgdGhlIG90aGVyIGJvb2tpZXMgd2lsbCBiZSB3YXRjaGluZyBvbiB0\naGVpcgogKiBwcmVkZWNlc3NvciB6bm9kZSBhY2NvcmRpbmcgdG8gdGhlIGVw\naGVtZXJhbCBzZXF1ZW5jZSBudW1iZXJzLgogKi8KcHVibGljIGNsYXNzIEF1\nZGl0b3JFbGVjdG9yIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dl\nciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAgICAgICAgIC5nZXRMb2dnZXIo\nQXVkaXRvckVsZWN0b3IuY2xhc3MpOwogICAgLy8gUmVwcmVzZW50cyB0aGUg\naW5kZXggb2YgdGhlIGF1ZGl0b3Igbm9kZQogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgaW50IEFVRElUT1JfSU5ERVggPSAwOwogICAgLy8gUmVwcmVzZW50\ncyB2b3RlIHByZWZpeAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5n\nIFZPVEVfUFJFRklYID0gIlZfIjsKICAgIC8vIFJlcHJlc2VudHMgcGF0aCBT\nZXBhcmF0b3IKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBQQVRI\nX1NFUEFSQVRPUiA9ICIvIjsKICAgIC8vIFJlcHJlc2VudHMgdXJMZWRnZXIg\ncGF0aCBpbiB6awogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgYmFzZVBhdGg7\nCiAgICAvLyBSZXByZXNlbnRzIGF1ZGl0b3IgZWxlY3Rpb24gcGF0aCBpbiB6\nawogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgZWxlY3Rpb25QYXRoOwoKICAg\nIHByaXZhdGUgZmluYWwgU3RyaW5nIGJvb2tpZUlkOwogICAgcHJpdmF0ZSBm\naW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICBwcml2YXRlIGZp\nbmFsIFpvb0tlZXBlciB6a2M7CiAgICBwcml2YXRlIGZpbmFsIEV4ZWN1dG9y\nU2VydmljZSBleGVjdXRvcjsKCiAgICBwcml2YXRlIFN0cmluZyBteVZvdGU7\nCiAgICBBdWRpdG9yIGF1ZGl0b3I7CiAgICBwcml2YXRlIEF0b21pY0Jvb2xl\nYW4gcnVubmluZyA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKCgogICAg\nLyoqCiAgICAgKiBBdWRpdG9yRWxlY3RvciBmb3IgcGVyZm9ybWluZyB0aGUg\nYXVkaXRvciBlbGVjdGlvbgogICAgICogCiAgICAgKiBAcGFyYW0gYm9va2ll\nSWQKICAgICAqICAgICAgICAgICAgLSBib29raWUgaWRlbnRpZmllciwgY29t\ncHJpc2VzIEhvc3RBZGRyZXNzOlBvcnQKICAgICAqIEBwYXJhbSBjb25mCiAg\nICAgKiAgICAgICAgICAgIC0gY29uZmlndXJhdGlvbgogICAgICogQHBhcmFt\nIHprYwogICAgICogICAgICAgICAgICAtIFpLIGluc3RhbmNlCiAgICAgKiBA\ndGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uCiAgICAgKiAgICAgICAgICAg\nICB0aHJvd3MgdW5hdmFpbGFibGUgZXhjZXB0aW9uIHdoaWxlIGluaXRpYWxp\nemluZyB0aGUgZWxlY3RvcgogICAgICovCiAgICBwdWJsaWMgQXVkaXRvckVs\nZWN0b3IoZmluYWwgU3RyaW5nIGJvb2tpZUlkLCBTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgWm9vS2VlcGVy\nIHprYykgdGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAgICAgICB0\naGlzLmJvb2tpZUlkID0gYm9va2llSWQ7CiAgICAgICAgdGhpcy5jb25mID0g\nY29uZjsKICAgICAgICB0aGlzLnprYyA9IHprYzsKICAgICAgICBiYXNlUGF0\naCA9IGNvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICcvJwogICAgICAg\nICAgICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlVOREVSX1JFUExJQ0FU\nSU9OX05PREU7CiAgICAgICAgZWxlY3Rpb25QYXRoID0gYmFzZVBhdGggKyAi\nL2F1ZGl0b3JlbGVjdGlvbiI7CiAgICAgICAgY3JlYXRlRWxlY3RvclBhdGgo\nKTsKICAgICAgICBleGVjdXRvciA9IEV4ZWN1dG9ycy5uZXdTaW5nbGVUaHJl\nYWRFeGVjdXRvcihuZXcgVGhyZWFkRmFjdG9yeSgpIHsKICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIFRocmVhZCBu\nZXdUaHJlYWQoUnVubmFibGUgcikgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgVGhyZWFkKHIsICJBdWRpdG9yRWxlY3Rvci0iK2Jvb2tpZUlk\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICB9CgoK\nCiAgICBwcml2YXRlIHZvaWQgY3JlYXRlTXlWb3RlKCkgdGhyb3dzIEtlZXBl\nckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIGlm\nIChudWxsID09IG15Vm90ZSB8fCBudWxsID09IHprYy5leGlzdHMobXlWb3Rl\nLCBmYWxzZSkpIHsKICAgICAgICAgICAgQXVkaXRvclZvdGVGb3JtYXQuQnVp\nbGRlciBidWlsZGVyID0gQXVkaXRvclZvdGVGb3JtYXQubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgICAgICAuc2V0Qm9va2llSWQoYm9va2llSWQpOwogICAg\nICAgICAgICBteVZvdGUgPSB6a2MuY3JlYXRlKGdldFZvdGVQYXRoKFBBVEhf\nU0VQQVJBVE9SICsgVk9URV9QUkVGSVgpLAogICAgICAgICAgICAgICAgICAg\nIFRleHRGb3JtYXQucHJpbnRUb1N0cmluZyhidWlsZGVyLmJ1aWxkKCkpLmdl\ndEJ5dGVzKFVURl84KSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAg\nICAgICAgICAgICBDcmVhdGVNb2RlLkVQSEVNRVJBTF9TRVFVRU5USUFMKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Vm90ZVBh\ndGgoU3RyaW5nIHZvdGUpIHsKICAgICAgICByZXR1cm4gZWxlY3Rpb25QYXRo\nICsgdm90ZTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgY3JlYXRlRWxlY3Rv\nclBhdGgoKSB0aHJvd3MgVW5hdmFpbGFibGVFeGNlcHRpb24gewogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGlmICh6a2MuZXhpc3RzKGJhc2VQYXRoLCBm\nYWxzZSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICB6a2MuY3JlYXRlKGJhc2VQYXRoLCBuZXcgYnl0ZVsw\nXSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIENyZWF0ZU1vZGUuUEVSU0lTVEVOVCk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24uTm9kZUV4aXN0c0V4Y2VwdGlv\nbiBuZWUpIHsKICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nLCBz\nb21lb25lIGVsc2UgY291bGQgaGF2ZSBjcmVhdGVkIGl0CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHprYy5leGlz\ndHMoZ2V0Vm90ZVBhdGgoIiIpLCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB6a2MuY3JlYXRl\nKGdldFZvdGVQYXRoKCIiKSwgbmV3IGJ5dGVbMF0sCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2Rl\nLlBFUlNJU1RFTlQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVy\nRXhjZXB0aW9uLk5vZGVFeGlzdHNFeGNlcHRpb24gbmVlKSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gZG8gbm90aGluZywgc29tZW9uZSBlbHNlIGNvdWxk\nIGhhdmUgY3JlYXRlZCBpdAogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBVbmF2YWlsYWJsZUV4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGluaXRpYWxpemUgQXVkaXRv\nciBFbGVjdG9yIiwga2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVk\nRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhy\nZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIHRocm93IG5ldyBVbmF2\nYWlsYWJsZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAiRmFpbGVk\nIHRvIGluaXRpYWxpemUgQXVkaXRvciBFbGVjdG9yIiwgaWUpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdhdGNoaW5nIHRoZSBwcmVkZWNl\nc3NvciBib29raWVzIGFuZCB3aWxsIGRvIGVsZWN0aW9uIG9uIHByZWRlY2Vz\nc29yIG5vZGUKICAgICAqIGRlbGV0aW9uIG9yIGV4cGlyYXRpb24uCiAgICAg\nKi8KICAgIHByaXZhdGUgY2xhc3MgRWxlY3Rpb25XYXRjaGVyIGltcGxlbWVu\ndHMgV2F0Y2hlciB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAg\nICAgaWYgKGV2ZW50LmdldFN0YXRlKCkgPT0gS2VlcGVyU3RhdGUuRGlzY29u\nbmVjdGVkCiAgICAgICAgICAgICAgICB8fCBldmVudC5nZXRTdGF0ZSgpID09\nIEtlZXBlclN0YXRlLkV4cGlyZWQpIHsKICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiTG9zdCBaSyBjb25uZWN0aW9uLCBzaHV0dGluZyBkb3duIik7CiAg\nICAgICAgICAgICAgICBzdWJtaXRTaHV0ZG93blRhc2soKTsKICAgICAgICAg\nICAgfSBlbHNlIGlmIChldmVudC5nZXRUeXBlKCkgPT0gRXZlbnRUeXBlLk5v\nZGVEZWxldGVkKSB7CiAgICAgICAgICAgICAgICBzdWJtaXRFbGVjdGlvblRh\nc2soKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBzdGFydCgpIHsKICAgICAgICBydW5uaW5nLnNldCh0cnVlKTsK\nICAgICAgICBzdWJtaXRFbGVjdGlvblRhc2soKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFJ1biBjbGVhbnVwIG9wZXJhdGlvbnMgZm9yIHRoZSBhdWRpdG9y\nIGVsZWN0b3IuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBzdWJtaXRTaHV0\nZG93blRhc2soKSB7CiAgICAgICAgZXhlY3V0b3Iuc3VibWl0KG5ldyBSdW5u\nYWJsZSgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoIXJ1bm5pbmcuY29tcGFyZUFuZFNl\ndCh0cnVlLCBmYWxzZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBMT0cuaW5mbygiU2h1dHRpbmcgZG93biBBdWRpdG9yRWxlY3RvciIpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChteVZvdGUgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgemtjLmRlbGV0ZShteVZvdGUsIC0xKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiB3aGlsZSBkZWxldGluZyBteVZvdGU6ICIgKyBt\neVZvdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4\nY2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJFeGNlcHRpb24gd2hpbGUgZGVsZXRpbmcgbXlWb3RlOiIgKyBt\neVZvdGUsIGtlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQZXJmb3JtaW5nIHRoZSBhdWRp\ndG9yIGVsZWN0aW9uIHVzaW5nIHRoZSBab29LZWVwZXIgZXBoZW1lcmFsIHNl\ncXVlbnRpYWwKICAgICAqIHpub2RlLiBUaGUgYm9va2llIHdoaWNoIGhhcyBj\ncmVhdGVkIHRoZSBsZWFzdCBzZXF1ZW50aWFsIHdpbGwgYmUgZWxlY3QgYXMK\nICAgICAqIEF1ZGl0b3IuCiAgICAgKi8KICAgIEBWaXNpYmxlRm9yVGVzdGlu\nZwogICAgdm9pZCBzdWJtaXRFbGVjdGlvblRhc2soKSB7CgogICAgICAgIFJ1\nbm5hYmxlIHIgPSBuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3JlYXRpbmcgbXkgdm90ZSBp\nbiB6ay4gVm90ZSBmb3JtYXQgaXMgJ1ZfbnVtZXJpYycKICAgICAgICAgICAg\nICAgICAgICAgICAgY3JlYXRlTXlWb3RlKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExpc3Q8U3RyaW5nPiBjaGlsZHJlbiA9IHprYy5nZXRDaGlsZHJl\nbihnZXRWb3RlUGF0aCgiIiksIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmICgwID49IGNoaWxkcmVuLnNpemUoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIkF0bGVhc3Qgb25lIGJvb2tpZSBzZXJ2ZXIgc2hvdWxkIHByZXNlbnQgdG8g\nZWxlY3QgdGhlIEF1ZGl0b3IhIik7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvcnRpbmcgaW4gYXNj\nZW5kaW5nIG9yZGVyIG9mIHNlcXVlbnRpYWwgbnVtYmVyCiAgICAgICAgICAg\nICAgICAgICAgICAgIENvbGxlY3Rpb25zLnNvcnQoY2hpbGRyZW4sIG5ldyBF\nbGVjdGlvbkNvbXBhcmF0b3IoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIFN0cmluZyB2b3RlTm9kZSA9IFN0cmluZ1V0aWxzLnN1YnN0cmluZ0FmdGVy\nTGFzdChteVZvdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQQVRI\nX1NFUEFSQVRPUik7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGFy\ndGluZyBBdWRpdGluZyBzZXJ2aWNlCiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChjaGlsZHJlbi5nZXQoQVVESVRPUl9JTkRFWCkuZXF1YWxzKHZvdGVO\nb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRl\nIHRoZSBhdWRpdG9yIGJvb2tpZSBpZCBpbiB0aGUgZWxlY3Rpb24gcGF0aC4g\nVGhpcyBpcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9uZSBm\nb3IgZGVidWdnaW5nIHB1cnBvc2UKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIEF1ZGl0b3JWb3RlRm9ybWF0LkJ1aWxkZXIgYnVpbGRlciA9IEF1ZGl0\nb3JWb3RlRm9ybWF0Lm5ld0J1aWxkZXIoKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC5zZXRCb29raWVJZChib29raWVJZCk7CgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgemtjLnNldERhdGEoZ2V0Vm90ZVBhdGgo\nIiIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nVGV4dEZvcm1hdC5wcmludFRvU3RyaW5nKGJ1aWxkZXIuYnVpbGQoKSkuZ2V0\nQnl0ZXMoVVRGXzgpLCAtMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBhdWRpdG9yID0gbmV3IEF1ZGl0b3IoYm9va2llSWQsIGNvbmYsIHprYyk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpdG9yLnN0YXJ0KCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyBJZiBub3QgYW4gYXVkaXRvciwgd2lsbCBi\nZSB3YXRjaGluZyB0byBteSBwcmVkZWNlc3NvciBhbmQKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGxvb2tpbmcgdGhlIHByZXZpb3VzIG5vZGUg\nZGVsZXRpb24uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXYXRjaGVy\nIGVsZWN0aW9uV2F0Y2hlciA9IG5ldyBFbGVjdGlvbldhdGNoZXIoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGludCBteUluZGV4ID0gY2hpbGRy\nZW4uaW5kZXhPZih2b3RlTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpbnQgcHJldk5vZGVJbmRleCA9IG15SW5kZXggLSAxOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gemtjLmV4aXN0cyhn\nZXRWb3RlUGF0aChQQVRIX1NFUEFSQVRPUikKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBjaGlsZHJlbi5n\nZXQocHJldk5vZGVJbmRleCksIGVsZWN0aW9uV2F0Y2hlcikpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBXaGlsZSBhZGRpbmcsIHRo\nZSBwcmV2aW91cyB6bm9kZSBkb2Vzbid0IGV4aXN0cy4KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvLyBBZ2FpbiBnb2luZyB0byBlbGVjdGlv\nbi4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRFbGVj\ndGlvblRhc2soKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHBlcmZvcm1pbmcg\nYXVkaXRvciBlbGVjdGlvbiIsIGUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBzdWJtaXRTaHV0ZG93blRhc2soKTsKICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJydXB0ZWQgd2hpbGUgcGVy\nZm9ybWluZyBhdWRpdG9yIGVsZWN0aW9uIiwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdFNodXRkb3duVGFzaygp\nOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJMZWRnZXIgdW5kZXJyZXBsaWNhdGlvbiBtYW5hZ2VyIHVuYXZhaWxhYmxl\nIGR1cmluZyBlbGVjdGlvbiIsIGUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBzdWJtaXRTaHV0ZG93blRhc2soKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgZXhl\nY3V0b3Iuc3VibWl0KHIpOwogICAgfQoKICAgIC8qKgogICAgICogU2h1dHRp\nbmcgZG93biBBdWRpdG9yRWxlY3RvcgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCBzaHV0ZG93bigpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAg\nICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChl\neGVjdXRvci5pc1NodXRkb3duKCkpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWJtaXRTaHV0ZG93blRh\nc2soKTsKICAgICAgICAgICAgZXhlY3V0b3Iuc2h1dGRvd24oKTsKICAgICAg\nICB9CgogICAgICAgIGlmIChhdWRpdG9yICE9IG51bGwpIHsKICAgICAgICAg\nICAgYXVkaXRvci5zaHV0ZG93bigpOwogICAgICAgICAgICBhdWRpdG9yID0g\nbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBjdXJy\nZW50IGJvb2tpZSBpcyBydW5uaW5nIGFzIGF1ZGl0b3IsIHJldHVybiB0aGUg\nc3RhdHVzIG9mIHRoZQogICAgICogYXVkaXRvci4gT3RoZXJ3aXNlIHJldHVy\nbiB0aGUgc3RhdHVzIG9mIGVsZWN0b3IuCiAgICAgKiAKICAgICAqIEByZXR1\ncm4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNSdW5uaW5nKCkgewog\nICAgICAgIGlmIChhdWRpdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0\ndXJuIGF1ZGl0b3IuaXNSdW5uaW5nKCk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBydW5uaW5nLmdldCgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29t\ncGFyZSB0aGUgdm90ZXMgaW4gdGhlIGFzY2VuZGluZyBvcmRlciBvZiB0aGUg\nc2VxdWVuY2UgbnVtYmVyLiBWb3RlCiAgICAgKiBmb3JtYXQgaXMgJ1Zfc2Vx\ndWVuY2VudW1iZXInLCBjb21wYXJhdG9yIHdpbGwgZG8gc29ydGluZyBiYXNl\nZCBvbiB0aGUKICAgICAqIG51bWVyaWMgc2VxdWVuY2UgdmFsdWUuCiAgICAg\nKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEVsZWN0aW9uQ29tcGFyYXRv\ncgogICAgICAgIGltcGxlbWVudHMgQ29tcGFyYXRvcjxTdHJpbmc+LCBTZXJp\nYWxpemFibGUgewogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiAtMSBp\nZiB0aGUgZmlyc3Qgdm90ZSBpcyBsZXNzIHRoYW4gc2Vjb25kLiBSZXR1cm4g\nMSBpZiB0aGUKICAgICAgICAgKiBmaXJzdCB2b3RlIGlzIGdyZWF0ZXIgdGhh\nbiBzZWNvbmQuIFJldHVybiAwIGlmIHRoZSB2b3RlcyBhcmUgZXF1YWwuCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIGludCBjb21wYXJlKFN0cmluZyB2\nb3RlMSwgU3RyaW5nIHZvdGUyKSB7CiAgICAgICAgICAgIGxvbmcgdm90ZVNl\ncUlkMSA9IGdldFZvdGVTZXF1ZW5jZUlkKHZvdGUxKTsKICAgICAgICAgICAg\nbG9uZyB2b3RlU2VxSWQyID0gZ2V0Vm90ZVNlcXVlbmNlSWQodm90ZTIpOwog\nICAgICAgICAgICBpbnQgcmVzdWx0ID0gdm90ZVNlcUlkMSA8IHZvdGVTZXFJ\nZDIgPyAtMQogICAgICAgICAgICAgICAgICAgIDogKHZvdGVTZXFJZDEgPiB2\nb3RlU2VxSWQyID8gMSA6IDApOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0\nOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBsb25nIGdldFZvdGVTZXF1\nZW5jZUlkKFN0cmluZyB2b3RlKSB7CiAgICAgICAgICAgIFN0cmluZyB2b3Rl\nSWQgPSBTdHJpbmdVdGlscy5zdWJzdHJpbmdBZnRlcih2b3RlLCBWT1RFX1BS\nRUZJWCk7CiAgICAgICAgICAgIHJldHVybiBMb25nLnBhcnNlTG9uZyh2b3Rl\nSWQpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

