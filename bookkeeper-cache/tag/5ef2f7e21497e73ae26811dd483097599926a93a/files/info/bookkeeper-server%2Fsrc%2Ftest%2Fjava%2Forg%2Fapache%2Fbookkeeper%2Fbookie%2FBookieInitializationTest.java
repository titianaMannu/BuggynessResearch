{"sha":"14517e3451d80ccac83e75f745485dd1daa42979","node_id":"MDQ6QmxvYjE1NzU5NTY6MTQ1MTdlMzQ1MWQ4MGNjYWM4M2U3NWY3NDU0ODVkZDFkYWE0Mjk3OQ==","size":10648,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/14517e3451d80ccac83e75f745485dd1daa42979","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuZmFpbDsKCmltcG9ydCBq\nYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uZXQuQmluZEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRBZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnRE\nb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5p\ndDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuQXNzZXJ0OwoKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2llOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWVFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0\nLlpvb0tlZXBlclV0aWw7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuaW8u\nRmlsZVV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hl\nZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLmRhdGEuU3RhdDsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5q\ndW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBv\ncmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUZXN0aW5nIGJv\nb2tpZSBpbml0aWFsaXphdGlvbiBjYXNlcwogKi8KcHVibGljIGNsYXNzIEJv\nb2tpZUluaXRpYWxpemF0aW9uVGVzdCB7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeQogICAgICAgICAgICAu\nZ2V0TG9nZ2VyKEJvb2tpZUluaXRpYWxpemF0aW9uVGVzdC5jbGFzcyk7CiAg\nICBab29LZWVwZXJVdGlsIHprdXRpbDsKICAgIFpvb0tlZXBlciB6a2MgPSBu\ndWxsOwogICAgWm9vS2VlcGVyIG5ld3prID0gbnVsbDsKCiAgICBAQmVmb3Jl\nCiAgICBwdWJsaWMgdm9pZCBzZXR1cFpvb0tlZXBlcigpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIHprdXRpbCA9IG5ldyBab29LZWVwZXJVdGlsKCk7\nCiAgICAgICAgemt1dGlsLnN0YXJ0U2VydmVyKCk7CiAgICAgICAgemtjID0g\nemt1dGlsLmdldFpvb0tlZXBlckNsaWVudCgpOwogICAgfQoKICAgIEBBZnRl\ncgogICAgcHVibGljIHZvaWQgdGVhckRvd25ab29LZWVwZXIoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAobmV3emsgIT0gbnVsbCkgewogICAg\nICAgICAgICBuZXd6ay5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICB6a3V0\naWwua2lsbFNlcnZlcigpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNs\nYXNzIE1vY2tCb29raWUgZXh0ZW5kcyBCb29raWUgewogICAgICAgIE1vY2tC\nb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKSB0aHJvd3MgSU9FeGNl\ncHRpb24sCiAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24sIEludGVy\ncnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgICAg\nICBzdXBlcihjb25mKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgdGVzdFJl\nZ2lzdGVyQm9va2llKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZikgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgc3VwZXIucmVnaXN0ZXJCb29r\naWUoY29uZik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmVy\naWZ5IHRoZSBib29raWUgcmVnLiBSZXN0YXJ0aW5nIGJvb2tpZSBzZXJ2ZXIg\nd2lsbCB3YWl0IGZvciB0aGUgc2Vzc2lvbgogICAgICogdGltZW91dCB3aGVu\nIHByZXZpb3VzIHJlZyBub2RlIGV4aXN0cyBpbiB6ay4gT24gek5vZGUgZGVs\nZXRlIGV2ZW50LAogICAgICogc2hvdWxkIGNvbnRpbnVlIHN0YXJ0dXAKICAg\nICAqLwogICAgQFRlc3QodGltZW91dCA9IDIwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEJvb2tpZVJlZ2lzdHJhdGlvbigpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIEZpbGUgdG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgi\nYm9va2llIiwgInRlc3QiKTsKICAgICAgICB0bXBEaXIuZGVsZXRlKCk7CiAg\nICAgICAgdG1wRGlyLm1rZGlyKCk7CgogICAgICAgIGZpbmFsIFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkK\nICAgICAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkuc2V0Sm91cm5h\nbERpck5hbWUodG1wRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgICAgIC5z\nZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyB0bXBEaXIuZ2V0UGF0\naCgpIH0pOwoKICAgICAgICBmaW5hbCBTdHJpbmcgYmtSZWdQYXRoID0gY29u\nZi5nZXRaa0F2YWlsYWJsZUJvb2tpZXNQYXRoKCkgKyAiLyIKICAgICAgICAg\nICAgICAgICsgSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFk\nZHJlc3MoKSArICI6IgogICAgICAgICAgICAgICAgKyBjb25mLmdldEJvb2tp\nZVBvcnQoKTsKCiAgICAgICAgTW9ja0Jvb2tpZSBiID0gbmV3IE1vY2tCb29r\naWUoY29uZik7CiAgICAgICAgYi56ayA9IHprYzsKICAgICAgICBiLnRlc3RS\nZWdpc3RlckJvb2tpZShjb25mKTsKICAgICAgICBTdGF0IGJrUmVnTm9kZTEg\nPSB6a2MuZXhpc3RzKGJrUmVnUGF0aCwgZmFsc2UpOwogICAgICAgIEFzc2Vy\ndC5hc3NlcnROb3ROdWxsKCJCb29raWUgcmVnaXN0cmF0aW9uIG5vZGUgZG9l\nc24ndCBleGlzdHMhIiwKICAgICAgICAgICAgICAgIGJrUmVnTm9kZTEpOwoK\nICAgICAgICAvLyBzaW11bGF0aW5nIGJvb2tpZSByZXN0YXJ0LCBvbiByZXN0\nYXJ0IGJvb2tpZSB3aWxsIGNyZWF0ZSBuZXcKICAgICAgICAvLyB6a2NsaWVu\ndCBhbmQgZG9pbmcgdGhlIHJlZ2lzdHJhdGlvbi4KICAgICAgICBjcmVhdGVO\nZXdaS0NsaWVudCgpOwogICAgICAgIGIuemsgPSBuZXd6azsKCiAgICAgICAg\nLy8gZGVsZXRpbmcgdGhlIHpub2RlLCBzbyB0aGF0IHRoZSBib29raWUgcmVn\naXN0cmF0aW9uIHNob3VsZAogICAgICAgIC8vIGNvbnRpbnVlIHN1Y2Nlc3Nm\ndWxseSBvbiBOb2RlRGVsZXRlZCBldmVudAogICAgICAgIG5ldyBUaHJlYWQo\nKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIFRocmVhZC5zbGVlcChjb25mLmdldFprVGltZW91dCgpIC8g\nMyk7CiAgICAgICAgICAgICAgICAgICAgemtjLmRlbGV0ZShia1JlZ1BhdGgs\nIC0xKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gTm90IGhhbmRsaW5nLCBzaW5jZSB0\naGUgdGVzdFJlZ2lzdGVyQm9va2llIHdpbGwgZmFpbAogICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRmFpbGVkIHRvIGRlbGV0ZSB0aGUgem5vZGUg\nOiIgKyBia1JlZ1BhdGgsIGUpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfS5zdGFydCgpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGIudGVzdFJlZ2lzdGVyQm9va2llKGNvbmYpOwogICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgVGhyb3dhYmxl\nIHQgPSBlLmdldENhdXNlKCk7CiAgICAgICAgICAgIGlmICh0IGluc3RhbmNl\nb2YgS2VlcGVyRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBLZWVwZXJF\neGNlcHRpb24ga2UgPSAoS2VlcGVyRXhjZXB0aW9uKSB0OwogICAgICAgICAg\nICAgICAgQXNzZXJ0LmFzc2VydFRydWUoIkVycm9yQ29kZToiICsga2UuY29k\nZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICsgIiwgUmVnaXN0cmF0aW9u\nIG5vZGUgZXhpc3RzIiwKICAgICAgICAgICAgICAgICAgICAgICAga2UuY29k\nZSgpICE9IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk5PREVFWElTVFMpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQoKICAg\nICAgICAvLyB2ZXJpZnkgZXBoZW1lcmFsIG93bmVyIG9mIHRoZSBia1JlZyB6\nbm9kZQogICAgICAgIFN0YXQgYmtSZWdOb2RlMiA9IG5ld3prLmV4aXN0cyhi\na1JlZ1BhdGgsIGZhbHNlKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0Tm90TnVs\nbCgiQm9va2llIHJlZ2lzdHJhdGlvbiBoYXMgYmVlbiBmYWlsZWQiLCBia1Jl\nZ05vZGUyKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZSgiQm9va2llIGlz\nIHJlZmVycmluZyB0byBvbGQgcmVnaXN0cmF0aW9uIHpub2RlOiIKICAgICAg\nICAgICAgICAgICsgYmtSZWdOb2RlMSArICIsIE5ldyBaTm9kZToiICsgYmtS\nZWdOb2RlMiwgYmtSZWdOb2RlMQogICAgICAgICAgICAgICAgLmdldEVwaGVt\nZXJhbE93bmVyKCkgIT0gYmtSZWdOb2RlMi5nZXRFcGhlbWVyYWxPd25lcigp\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZlcmlmeSB0aGUgYm9va2llIHJl\nZ2lzdHJhdGlvbiwgaXQgc2hvdWxkIHRocm93CiAgICAgKiBLZWVwZXJFeGNl\ncHRpb24uTm9kZUV4aXN0c0V4Y2VwdGlvbiBpZiB0aGUgem5vZGUgc3RpbGwg\nZXhpc3RzIGV2ZW4gYWZ0ZXIKICAgICAqIHRoZSB6ayBzZXNzaW9uIHRpbWVv\ndXQuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAzMDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RSZWdOb2RlRXhpc3RzQWZ0ZXJTZXNzaW9uVGltZU91\ndCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgdG1wRGlyID0g\nRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgInRlc3QiKTsKICAgICAg\nICB0bXBEaXIuZGVsZXRlKCk7CiAgICAgICAgdG1wRGlyLm1rZGlyKCk7Cgog\nICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJD\nb25maWd1cmF0aW9uKCkuc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAgICAg\nICAgICAuc2V0Sm91cm5hbERpck5hbWUodG1wRGlyLmdldFBhdGgoKSkuc2V0\nTGVkZ2VyRGlyTmFtZXMoCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBT\ndHJpbmdbXSB7IHRtcERpci5nZXRQYXRoKCkgfSk7CgogICAgICAgIFN0cmlu\nZyBia1JlZ1BhdGggPSBjb25mLmdldFprQXZhaWxhYmxlQm9va2llc1BhdGgo\nKSArICIvIgogICAgICAgICAgICAgICAgKyBJbmV0QWRkcmVzcy5nZXRMb2Nh\nbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpICsgIjoiCiAgICAgICAgICAgICAg\nICArIGNvbmYuZ2V0Qm9va2llUG9ydCgpOwoKICAgICAgICBNb2NrQm9va2ll\nIGIgPSBuZXcgTW9ja0Jvb2tpZShjb25mKTsKICAgICAgICBiLnprID0gemtj\nOwogICAgICAgIGIudGVzdFJlZ2lzdGVyQm9va2llKGNvbmYpOwogICAgICAg\nIFN0YXQgYmtSZWdOb2RlMSA9IHprYy5leGlzdHMoYmtSZWdQYXRoLCBmYWxz\nZSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydE5vdE51bGwoIkJvb2tpZSByZWdp\nc3RyYXRpb24gbm9kZSBkb2Vzbid0IGV4aXN0cyEiLAogICAgICAgICAgICAg\nICAgYmtSZWdOb2RlMSk7CgogICAgICAgIC8vIHNpbXVsYXRpbmcgYm9va2ll\nIHJlc3RhcnQsIG9uIHJlc3RhcnQgYm9va2llIHdpbGwgY3JlYXRlIG5ldwog\nICAgICAgIC8vIHprY2xpZW50IGFuZCBkb2luZyB0aGUgcmVnaXN0cmF0aW9u\nLgogICAgICAgIGNyZWF0ZU5ld1pLQ2xpZW50KCk7CiAgICAgICAgYi56ayA9\nIG5ld3prOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGIudGVzdFJlZ2lz\ndGVyQm9va2llKGNvbmYpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgdGhy\nb3cgTm9kZUV4aXN0c0V4Y2VwdGlvbiBhcyB0aGUgem5vZGUgaXMgbm90IGdl\ndHRpbmcgZXhwaXJlZCIpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgVGhyb3dhYmxlIHQgPSBlLmdldENhdXNlKCk7\nCiAgICAgICAgICAgIGlmICh0IGluc3RhbmNlb2YgS2VlcGVyRXhjZXB0aW9u\nKSB7CiAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24ga2UgPSAoS2Vl\ncGVyRXhjZXB0aW9uKSB0OwogICAgICAgICAgICAgICAgQXNzZXJ0LmFzc2Vy\ndFRydWUoIkVycm9yQ29kZToiICsga2UuY29kZSgpCiAgICAgICAgICAgICAg\nICAgICAgICAgICsgIiwgUmVnaXN0cmF0aW9uIG5vZGUgZG9lc24ndCBleGlz\ndHMiLAogICAgICAgICAgICAgICAgICAgICAgICBrZS5jb2RlKCkgPT0gS2Vl\ncGVyRXhjZXB0aW9uLkNvZGUuTk9ERUVYSVNUUyk7CgogICAgICAgICAgICAg\nICAgLy8gdmVyaWZ5IGVwaGVtZXJhbCBvd25lciBvZiB0aGUgYmtSZWcgem5v\nZGUKICAgICAgICAgICAgICAgIFN0YXQgYmtSZWdOb2RlMiA9IG5ld3prLmV4\naXN0cyhia1JlZ1BhdGgsIGZhbHNlKTsKICAgICAgICAgICAgICAgIEFzc2Vy\ndC5hc3NlcnROb3ROdWxsKCJCb29raWUgcmVnaXN0cmF0aW9uIGhhcyBiZWVu\nIGZhaWxlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJrUmVnTm9kZTIp\nOwogICAgICAgICAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUoCiAgICAgICAg\nICAgICAgICAgICAgICAgICJCb29raWUgd3JvbmdseSByZWdpc3RlcmVkLiBP\nbGQgcmVnaXN0cmF0aW9uIHpub2RlOiIKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIGJrUmVnTm9kZTEgKyAiLCBOZXcgem5vZGU6IiArIGJr\nUmVnTm9kZTIsCiAgICAgICAgICAgICAgICAgICAgICAgIGJrUmVnTm9kZTEu\nZ2V0RXBoZW1lcmFsT3duZXIoKSA9PSBia1JlZ05vZGUyCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLmdldEVwaGVtZXJhbE93bmVyKCkpOwog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHRocm93IGU7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVmVyaWZ5IGR1cGxpY2F0ZSBib29raWUgc2VydmVyIHN0YXJ0dXAuIFNob3Vs\nZCB0aHJvdwogICAgICogamF2YS5uZXQuQmluZEV4Y2VwdGlvbiBpZiBhbHJl\nYWR5IEJLIHNlcnZlciBpcyBydW5uaW5nCiAgICAgKi8KICAgIEBUZXN0KHRp\nbWVvdXQgPSAyMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3REdXBsaWNhdGVC\nb29raWVTZXJ2ZXJTdGFydHVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgRmlsZSB0bXBEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUi\nLCAidGVzdCIpOwogICAgICAgIHRtcERpci5kZWxldGUoKTsKICAgICAgICB0\nbXBEaXIubWtkaXIoKTsKCiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBj\nb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICBpbnQg\ncG9ydCA9IDEyNTU1OwogICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKG51bGwp\nLnNldEJvb2tpZVBvcnQocG9ydCkuc2V0Sm91cm5hbERpck5hbWUoCiAgICAg\nICAgICAgICAgICB0bXBEaXIuZ2V0UGF0aCgpKS5zZXRMZWRnZXJEaXJOYW1l\ncygKICAgICAgICAgICAgICAgIG5ldyBTdHJpbmdbXSB7IHRtcERpci5nZXRQ\nYXRoKCkgfSk7CiAgICAgICAgQm9va2llU2VydmVyIGJzMSA9IG5ldyBCb29r\naWVTZXJ2ZXIoY29uZik7CiAgICAgICAgYnMxLnN0YXJ0KCk7CgogICAgICAg\nIC8vIHN0YXJ0aW5nIGJrIHNlcnZlciB3aXRoIHNhbWUgY29uZgogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIEJvb2tpZVNlcnZlciBiczIgPSBuZXcgQm9v\na2llU2VydmVyKGNvbmYpOwogICAgICAgICAgICBiczIuc3RhcnQoKTsKICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkIHRocm93IEJpbmRFeGNlcHRpb24sIGFz\nIHRoZSBiayBzZXJ2ZXIgaXMgYWxyZWFkeSBydW5uaW5nISIpOwogICAgICAg\nIH0gY2F0Y2ggKEJpbmRFeGNlcHRpb24gYmUpIHsKICAgICAgICAgICAgQXNz\nZXJ0LmFzc2VydFRydWUoIkJLU2VydmVyIGFsbG93ZWQgZHVwbGljYXRlIHN0\nYXJ0dXBzISIsIGJlCiAgICAgICAgICAgICAgICAgICAgLmdldE1lc3NhZ2Uo\nKS5jb250YWlucygiQWRkcmVzcyBhbHJlYWR5IGluIHVzZSIpKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWZXJpZnkgYm9va2llIHN0YXJ0\nIGJlaGF2aW91ciB3aGVuIFpLIFNlcnZlciBpcyBub3QgcnVubmluZy4KICAg\nICAqLwogICAgQFRlc3QodGltZW91dCA9IDIwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFN0YXJ0Qm9va2llV2l0aG91dFpLU2VydmVyKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgemt1dGlsLmtpbGxTZXJ2ZXIoKTsKCiAgICAg\nICAgRmlsZSB0bXBEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUi\nLCAidGVzdCIpOwogICAgICAgIHRtcERpci5kZWxldGUoKTsKICAgICAgICB0\nbXBEaXIubWtkaXIoKTsKCiAgICAgICAgZmluYWwgU2VydmVyQ29uZmlndXJh\ndGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAg\nICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpKQogICAgICAgICAgICAgICAgLnNldFprVGltZW91dCg1\nMDAwKS5zZXRKb3VybmFsRGlyTmFtZSh0bXBEaXIuZ2V0UGF0aCgpKQogICAg\nICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7\nIHRtcERpci5nZXRQYXRoKCkgfSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxk\nIHRocm93IENvbm5lY3Rpb25Mb3NzRXhjZXB0aW9uIGFzIFpLU2VydmVyIGlz\nIG5vdCBydW5uaW5nISIpOwogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2Vw\ndGlvbi5Db25uZWN0aW9uTG9zc0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIC8vIGV4cGVjdGVkIGJlaGF2aW91cgogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIEZpbGVVdGlscy5kZWxldGVEaXJlY3RvcnkodG1wRGlyKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNyZWF0ZU5ld1pL\nQ2xpZW50KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gY3JlYXRl\nIGEgem9va2VlcGVyIGNsaWVudAogICAgICAgIExPRy5kZWJ1ZygiSW5zdGFu\ndGlhdGUgWksgQ2xpZW50Iik7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0\nY2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgbmV3\nemsgPSBuZXcgWm9vS2VlcGVyKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0\nU3RyaW5nKCksIDEwMDAwLAogICAgICAgICAgICAgICAgbmV3IFdhdGNoZXIo\nKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZl\nbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIHNlc3Np\nb24gZGlzY29ubmVjdHMgYW5kIGV4cGlyZXMKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFdhdGNoZXIuRXZlbnQuS2VlcGVyU3Rh\ndGUuU3luY0Nvbm5lY3RlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7\nCiAgICAgICAgaWYgKCFsYXRjaC5hd2FpdCgxMDAwMCwgVGltZVVuaXQuTUlM\nTElTRUNPTkRTKSkgewogICAgICAgICAgICBuZXd6ay5jbG9zZSgpOwogICAg\nICAgICAgICBmYWlsKCJDb3VsZCBub3QgY29ubmVjdCB0byB6b29rZWVwZXIg\nc2VydmVyIik7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

