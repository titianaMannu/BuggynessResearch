{"sha":"965b95568ab368e74fb0e5bff22868adb172f3a1","node_id":"MDQ6QmxvYjE1NzU5NTY6OTY1Yjk1NTY4YWIzNjhlNzRmYjBlNWJmZjIyODY4YWRiMTcyZjNhMQ==","size":21153,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/965b95568ab368e74fb0e5bff22868adb172f3a1","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5SYW5kb21BY2Nl\nc3NGaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5G\naWxlQ2hhbm5lbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuUmFu\nZG9tOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2Vy\ndmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXJUZXN0\nQ2xpZW50OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5M\nZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQ2xpZW50VXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdl\nc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLldhdGNoZXI7CmltcG9ydCBvcmcuanVuaXQuQmVmb3JlOwppbXBvcnQg\nb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2Vy\ndC4qOwoKcHVibGljIGNsYXNzIEJvb2tpZUpvdXJuYWxUZXN0IHsKICAgIHN0\nYXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9v\na2llSm91cm5hbFRlc3QuY2xhc3MpOwoKICAgIGZpbmFsIFJhbmRvbSByID0g\nbmV3IFJhbmRvbShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CgogICAg\ncHJpdmF0ZSB2b2lkIHdyaXRlSW5kZXhGaWxlRm9yTGVkZ2VyKEZpbGUgaW5k\nZXhEaXIsIGxvbmcgbGVkZ2VySWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYnl0ZVtdIG1hc3RlcktleSkKICAgICAgICAg\nICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBmbiA9IG5ldyBG\naWxlKGluZGV4RGlyLCBMZWRnZXJDYWNoZUltcGwuZ2V0TGVkZ2VyTmFtZShs\nZWRnZXJJZCkpOwogICAgICAgIGZuLmdldFBhcmVudEZpbGUoKS5ta2RpcnMo\nKTsKICAgICAgICBGaWxlSW5mbyBmaSA9IG5ldyBGaWxlSW5mbyhmbiwgbWFz\ndGVyS2V5KTsKICAgICAgICAvLyBmb3JjZSBjcmVhdGlvbiBvZiBpbmRleCBm\naWxlCiAgICAgICAgZmkud3JpdGUobmV3IEJ5dGVCdWZmZXJbXXsgQnl0ZUJ1\nZmZlci5hbGxvY2F0ZSgwKSB9LCAwKTsKICAgICAgICBmaS5jbG9zZSh0cnVl\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVQYXJ0aWFsSW5kZXhG\naWxlRm9yTGVkZ2VyKEZpbGUgaW5kZXhEaXIsIGxvbmcgbGVkZ2VySWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGJ5dGVbXSBtYXN0ZXJLZXksIGJvb2xlYW4gdHJ1bmNhdGVUb01hc3Rlcktl\neSkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmls\nZSBmbiA9IG5ldyBGaWxlKGluZGV4RGlyLCBMZWRnZXJDYWNoZUltcGwuZ2V0\nTGVkZ2VyTmFtZShsZWRnZXJJZCkpOwogICAgICAgIGZuLmdldFBhcmVudEZp\nbGUoKS5ta2RpcnMoKTsKICAgICAgICBGaWxlSW5mbyBmaSA9IG5ldyBGaWxl\nSW5mbyhmbiwgbWFzdGVyS2V5KTsKICAgICAgICAvLyBmb3JjZSBjcmVhdGlv\nbiBvZiBpbmRleCBmaWxlCiAgICAgICAgZmkud3JpdGUobmV3IEJ5dGVCdWZm\nZXJbXXsgQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgwKSB9LCAwKTsKICAgICAgICBm\naS5jbG9zZSh0cnVlKTsKICAgICAgICAvLyBmaWxlIGluZm8gaGVhZGVyCiAg\nICAgICAgaW50IGhlYWRlckxlbiA9IDggKyA0ICsgbWFzdGVyS2V5Lmxlbmd0\naDsKICAgICAgICAvLyB0cnVuY2F0ZSB0aGUgaW5kZXggZmlsZQogICAgICAg\nIGludCBsZWZ0U2l6ZTsKICAgICAgICBpZiAodHJ1bmNhdGVUb01hc3Rlcktl\neSkgewogICAgICAgICAgICBsZWZ0U2l6ZSA9IHIubmV4dEludChoZWFkZXJM\nZW4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlZnRTaXplID0g\naGVhZGVyTGVuICsgci5uZXh0SW50KDEwMjQgLSBoZWFkZXJMZW4pOwogICAg\nICAgIH0KICAgICAgICBGaWxlQ2hhbm5lbCBmYyA9IG5ldyBSYW5kb21BY2Nl\nc3NGaWxlKGZuLCAicnciKS5nZXRDaGFubmVsKCk7CiAgICAgICAgZmMudHJ1\nbmNhdGUobGVmdFNpemUpOwogICAgICAgIGZjLmNsb3NlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBtZXRhIGVudHJ5IHdpdGggZ2l2ZW4g\nbWFzdGVyIGtleQogICAgICovCiAgICBwcml2YXRlIEJ5dGVCdWZmZXIgZ2Vu\nZXJhdGVNZXRhRW50cnkobG9uZyBsZWRnZXJJZCwgYnl0ZVtdIG1hc3Rlcktl\neSkgewogICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9j\nYXRlKDggKyA4ICsgNCArIG1hc3RlcktleS5sZW5ndGgpOwogICAgICAgIGJi\nLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgIGJiLnB1dExvbmcoQm9va2ll\nLk1FVEFFTlRSWV9JRF9MRURHRVJfS0VZKTsKICAgICAgICBiYi5wdXRJbnQo\nbWFzdGVyS2V5Lmxlbmd0aCk7CiAgICAgICAgYmIucHV0KG1hc3RlcktleSk7\nCiAgICAgICAgYmIuZmxpcCgpOwogICAgICAgIHJldHVybiBiYjsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgd3JpdGVKdW5rSm91cm5hbChGaWxlIGpvdXJu\nYWxEaXIpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxvbmcgbG9nSWQg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICBGaWxlIGZu\nID0gbmV3IEZpbGUoam91cm5hbERpciwgTG9uZy50b0hleFN0cmluZyhsb2dJ\nZCkgKyAiLnR4biIpOwoKICAgICAgICBGaWxlQ2hhbm5lbCBmYyA9IG5ldyBS\nYW5kb21BY2Nlc3NGaWxlKGZuLCAicnciKS5nZXRDaGFubmVsKCk7CgogICAg\nICAgIEJ5dGVCdWZmZXIgemVyb3MgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDUx\nMik7CiAgICAgICAgZmMud3JpdGUoemVyb3MsIDQqMTAyNCoxMDI0KTsKICAg\nICAgICBmYy5wb3NpdGlvbigwKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDE7\nIGkgPD0gMTA7IGkrKykgewogICAgICAgICAgICBmYy53cml0ZShCeXRlQnVm\nZmVyLndyYXAoIkp1bmtKdW5rSnVuayIuZ2V0Qnl0ZXMoKSkpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVQcmVWMkpvdXJuYWwo\nRmlsZSBqb3VybmFsRGlyLCBpbnQgbnVtRW50cmllcykgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgIEZpbGUgZm4gPSBuZXcgRmlsZShqb3VybmFs\nRGlyLCBMb25nLnRvSGV4U3RyaW5nKGxvZ0lkKSArICIudHhuIik7CgogICAg\nICAgIEZpbGVDaGFubmVsIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUoZm4s\nICJydyIpLmdldENoYW5uZWwoKTsKCiAgICAgICAgQnl0ZUJ1ZmZlciB6ZXJv\ncyA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNTEyKTsKICAgICAgICBmYy53cml0\nZSh6ZXJvcywgNCoxMDI0KjEwMjQpOwogICAgICAgIGZjLnBvc2l0aW9uKDAp\nOwoKICAgICAgICBieXRlW10gZGF0YSA9ICJKb3VybmFsVGVzdERhdGEiLmdl\ndEJ5dGVzKCk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gTGVkZ2Vy\nSGFuZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDE7IGkgPD0gbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgcGFja2V0ID0gQ2xpZW50VXRpbC5nZW5lcmF0ZVBhY2tldCgxLCBp\nLCBsYXN0Q29uZmlybWVkLCBpKmRhdGEubGVuZ3RoLCBkYXRhKS50b0J5dGVC\ndWZmZXIoKTsKICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IGk7CiAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50KHBhY2tldC5yZW1h\naW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwoKICAgICAg\nICAgICAgZmMud3JpdGUobGVuQnVmZik7CiAgICAgICAgICAgIGZjLndyaXRl\nKHBhY2tldCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgSm91cm5h\nbENoYW5uZWwgd3JpdGVQb3N0VjJKb3VybmFsKEZpbGUgam91cm5hbERpciwg\naW50IG51bUVudHJpZXMpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxv\nbmcgbG9nSWQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAg\nICBKb3VybmFsQ2hhbm5lbCBqYyA9IG5ldyBKb3VybmFsQ2hhbm5lbChqb3Vy\nbmFsRGlyLCBsb2dJZCk7CgogICAgICAgIEJ1ZmZlcmVkQ2hhbm5lbCBiYyA9\nIGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpOwoKICAgICAgICBieXRlW10gZGF0\nYSA9IG5ldyBieXRlWzEwMjRdOwogICAgICAgIEFycmF5cy5maWxsKGRhdGEs\nIChieXRlKSdYJyk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gTGVk\nZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgZm9yIChpbnQg\naSA9IDE7IGkgPD0gbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIEJ5\ndGVCdWZmZXIgcGFja2V0ID0gQ2xpZW50VXRpbC5nZW5lcmF0ZVBhY2tldCgx\nLCBpLCBsYXN0Q29uZmlybWVkLCBpKmRhdGEubGVuZ3RoLCBkYXRhKS50b0J5\ndGVCdWZmZXIoKTsKICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IGk7CiAg\nICAgICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50KHBhY2tldC5y\nZW1haW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwoKICAg\nICAgICAgICAgYmMud3JpdGUobGVuQnVmZik7CiAgICAgICAgICAgIGJjLndy\naXRlKHBhY2tldCk7CiAgICAgICAgfQogICAgICAgIGJjLmZsdXNoKHRydWUp\nOwoKICAgICAgICByZXR1cm4gamM7CiAgICB9CgogICAgcHJpdmF0ZSBKb3Vy\nbmFsQ2hhbm5lbCB3cml0ZVBvc3RWM0pvdXJuYWwoRmlsZSBqb3VybmFsRGly\nLCBpbnQgbnVtRW50cmllcywgYnl0ZVtdIG1hc3RlcktleSkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gbmV3\nIEpvdXJuYWxDaGFubmVsKGpvdXJuYWxEaXIsIGxvZ0lkKTsKCiAgICAgICAg\nQnVmZmVyZWRDaGFubmVsIGJjID0gamMuZ2V0QnVmZmVyZWRDaGFubmVsKCk7\nCgogICAgICAgIGJ5dGVbXSBkYXRhID0gbmV3IGJ5dGVbMTAyNF07CiAgICAg\nICAgQXJyYXlzLmZpbGwoZGF0YSwgKGJ5dGUpJ1gnKTsKICAgICAgICBsb25n\nIGxhc3RDb25maXJtZWQgPSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9J\nRDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8PSBudW1FbnRyaWVzOyBp\nKyspIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBwYWNrZXQ7CiAgICAgICAg\nICAgIGlmIChpID09IDApIHsKICAgICAgICAgICAgICAgIHBhY2tldCA9IGdl\nbmVyYXRlTWV0YUVudHJ5KDEsIG1hc3RlcktleSk7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBwYWNrZXQgPSBDbGllbnRVdGlsLmdl\nbmVyYXRlUGFja2V0KDEsIGksIGxhc3RDb25maXJtZWQsIGkqZGF0YS5sZW5n\ndGgsIGRhdGEpLnRvQnl0ZUJ1ZmZlcigpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGxhc3RDb25maXJtZWQgPSBpOwogICAgICAgICAgICBCeXRlQnVm\nZmVyIGxlbkJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAg\nICAgICBsZW5CdWZmLnB1dEludChwYWNrZXQucmVtYWluaW5nKCkpOwogICAg\nICAgICAgICBsZW5CdWZmLmZsaXAoKTsKCiAgICAgICAgICAgIGJjLndyaXRl\nKGxlbkJ1ZmYpOwogICAgICAgICAgICBiYy53cml0ZShwYWNrZXQpOwogICAg\nICAgIH0KICAgICAgICBiYy5mbHVzaCh0cnVlKTsKCiAgICAgICAgcmV0dXJu\nIGpjOwogICAgfQoKICAgIC8qKgogICAgICogdGVzdCB0aGF0IHdlIGNhbiBv\ncGVuIGEgam91cm5hbCB3cml0dGVuIHdpdGhvdXQgdGhlIG1hZ2ljCiAgICAg\nKiB3b3JkIGF0IHRoZSBzdGFydC4gVGhpcyBpcyBmb3IgdmVyc2lvbnMgb2Yg\nYm9va2tlZXBlciBiZWZvcmUKICAgICAqIHRoZSBtYWdpYyB3b3JkIHdhcyBp\nbnRyb2R1Y2VkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0UHJlVjJKb3VybmFsKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVU\nZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFs\nRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAg\nICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdl\ndEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxl\nIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJs\nZWRnZXIiKTsKICAgICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAg\nbGVkZ2VyRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0\nb3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdl\nckRpcikpOwoKICAgICAgICB3cml0ZVByZVYySm91cm5hbChCb29raWUuZ2V0\nQ3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSwgMTAwKTsKICAgICAgICB3\ncml0ZUluZGV4RmlsZUZvckxlZGdlcihCb29raWUuZ2V0Q3VycmVudERpcmVj\ndG9yeShsZWRnZXJEaXIpLCAxLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7\nCgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2\nZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFprU2VydmVycyhu\ndWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERp\nci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhu\nZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAg\nICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgYi5yZWFk\nSm91cm5hbCgpOwoKICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGIucmVhZEVudHJ5KDEsIDEwMSk7CiAg\nICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEw\nMSIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICB9CgogICAgICAgIGIuc2h1dGRvd24oKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgdGhhdCBpZiB0aGUgam91cm5hbCBpcyBhbGwgam91cm5hbCwg\nd2UgY2FuIG5vdAogICAgICogc3RhcnQgdGhlIGJvb2tpZS4gQW4gYWRtaW4g\nc2hvdWxkIGxvb2sgdG8gc2VlIHdoYXQgaGFzCiAgICAgKiBoYXBwZW5lZCBp\nbiB0aGlzIGNhc2UKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RBbGxKdW5rSm91cm5hbCgpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3Jl\nYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91\ncm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7\nCiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tp\nZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAg\nRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUi\nLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAg\nICAgIGxlZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0Rp\ncmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShs\nZWRnZXJEaXIpKTsKCiAgICAgICAgd3JpdGVKdW5rSm91cm5hbChCb29raWUu\nZ2V0Q3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0\naW9uKCkKICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAg\nICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkp\nCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10g\neyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwogICAgICAgIEJvb2tpZSBiID0g\nbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBiID0gbmV3IEJvb2tp\nZShjb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgYmVl\nbiBhYmxlIHRvIHN0YXJ0IHdpdGhvdXQgYWRtaW4iKTsKICAgICAgICB9IGNh\ndGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICAvLyBjb3JyZWN0IGJl\naGF2aW91cgogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChi\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGIuc2h1dGRvd24oKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRl\nc3QgdGhhdCB3ZSBjYW4gc3RhcnQgd2l0aCBhbiBlbXB0eSBqb3VybmFsLgog\nICAgICogVGhpcyBjYW4gaGFwcGVuIGlmIHRoZSBib29raWUgY3Jhc2hlcyBi\nZXR3ZWVuIGNyZWF0aW5nIHRoZQogICAgICogam91cm5hbCBhbmQgd3JpdGlu\nZyB0aGUgbWFnaWMgd29yZC4gSXQgY291bGQgYWxzbyBoYXBwZW4gYmVmb3Jl\nCiAgICAgKiB0aGUgbWFnaWMgd29yZCBleGlzdGVkLCBpZiB0aGUgYm9va2ll\nIHN0YXJ0ZWQgYnV0IG5vdGhpbmcgd2FzCiAgICAgKiBldmVyIHdyaXR0ZW4u\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0RW1wdHlKb3VybmFsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgi\nYm9va2llIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFsRGlyLmRlbGV0\nZSgpOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAgICAgICBCb29r\naWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnRE\naXJlY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxlIGxlZGdlckRp\nciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsK\nICAgICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGly\nLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0\ndXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpcikpOwoK\nICAgICAgICB3cml0ZVByZVYySm91cm5hbChCb29raWUuZ2V0Q3VycmVudERp\ncmVjdG9yeShqb3VybmFsRGlyKSwgMCk7CgogICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAg\nICAgICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0\nSm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAg\nICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJE\naXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBCb29raWUgYiA9IG5ldyBCb29r\naWUoY29uZik7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgYSBq\nb3VybmFsIGNhbiBsb2FkIGlmIG9ubHkgdGhlIG1hZ2ljIHdvcmQgYW5kCiAg\nICAgKiB2ZXJzaW9uIGFyZSB0aGVyZS4KICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RIZWFkZXJPbmx5Sm91\ncm5hbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5h\nbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFs\nIik7CiAgICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3Vy\nbmFsRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5\nU3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxE\naXIpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGly\nLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwogICAgICAg\nIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3Vy\ncmVudERpcmVjdG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgd3JpdGVQb3N0\nVjJKb3VybmFsKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxE\naXIpLCAwKTsKCiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0g\nbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtT\nZXJ2ZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShq\nb3VybmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNldExlZGdlckRp\nck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7\nCgogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBhIGpvdXJuYWwgaGFzIGp1\nbmsgYXQgdGhlIGVuZCwgaXQgZG9lcyBub3QgbG9hZC4KICAgICAqIElmIHRo\nZSBqb3VybmFsIGlzIGNvcnJ1cHQgbGlrZSB0aGlzLCBhZG1pbiBpbnRlcnZl\nbnRpb24gaXMgbmVlZGVkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0SnVua0VuZGVkSm91cm5hbCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAg\nICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1r\nZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJl\nKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAg\nICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJi\nb29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgp\nOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5j\naGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVj\ndG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgSm91cm5hbENoYW5uZWwgamMg\nPSB3cml0ZVBvc3RWMkpvdXJuYWwoQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoam91cm5hbERpciksIDApOwogICAgICAgIGpjLmdldEJ1ZmZlcmVkQ2hh\nbm5lbCgpLndyaXRlKEJ5dGVCdWZmZXIud3JhcCgiSnVua0p1bmtKdW5rIi5n\nZXRCeXRlcygpKSk7CiAgICAgICAgamMuZ2V0QnVmZmVyZWRDaGFubmVsKCku\nZmx1c2godHJ1ZSk7CgogICAgICAgIHdyaXRlSW5kZXhGaWxlRm9yTGVkZ2Vy\nKGxlZGdlckRpciwgMSwgInRlc3RQYXNzd2QiLmdldEJ5dGVzKCkpOwoKICAg\nICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29u\nZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkK\nICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0\nUGF0aCgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0\ncmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsKCiAgICAgICAgQm9v\na2llIGIgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGIgPSBu\nZXcgQm9va2llKGNvbmYpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0\nKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIHRoZSBib29r\naWUgY3Jhc2hlcyB3aGlsZSB3cml0aW5nIHRoZSBsZW5ndGgKICAgICAqIG9m\nIGFuIGVudHJ5LCB0aGF0IHdlIGNhbiByZWNvdmVyLgogICAgICoKICAgICAq\nIFRoaXMgaXMgY3VycmVudGx5IG5vdCB0aGUgY2FzZSwgd2hpY2ggaXMgYmFk\nIGFzIHJlY292ZXJ5CiAgICAgKiBzaG91bGQgYmUgZmluZSBoZXJlLiBUaGUg\nYm9va2llIGhhcyBjcmFzaGVkIHdoaWxlIHdyaXRpbmcKICAgICAqIGJ1dCBz\nbyB0aGUgY2xpZW50IGhhcyBub3QgYmUgbm90aWZpZWQgb2Ygc3VjY2Vzcy4K\nICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RUcnVuY2F0ZWRJbkxlbkpvdXJuYWwoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxE\naXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAg\nICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0\nQ3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUg\nbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxl\nZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBs\nZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3Rv\ncnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2Vy\nRGlyKSk7CgogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gd3JpdGVQb3N0\nVjJKb3VybmFsKAogICAgICAgICAgICAgICAgQm9va2llLmdldEN1cnJlbnRE\naXJlY3Rvcnkoam91cm5hbERpciksIDEwMCk7CiAgICAgICAgQnl0ZUJ1ZmZl\nciB6ZXJvcyA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMjA0OCk7CgogICAgICAg\nIGpjLmZjLnBvc2l0aW9uKGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpLnBvc2l0\naW9uKCkgLSAweDQyOSk7CiAgICAgICAgamMuZmMud3JpdGUoemVyb3MpOwog\nICAgICAgIGpjLmZjLmZvcmNlKGZhbHNlKTsKCiAgICAgICAgd3JpdGVJbmRl\neEZpbGVGb3JMZWRnZXIoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVk\nZ2VyRGlyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLCAi\ndGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAg\nICAgICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0\nSm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAg\nICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJE\naXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBCb29raWUgYiA9IG5ldyBCb29r\naWUoY29uZik7CiAgICAgICAgYi5yZWFkSm91cm5hbCgpOwoKICAgICAgICBi\nLnJlYWRFbnRyeSgxLCA5OSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGIucmVhZEVudHJ5KDEsIDEwMCk7CiAgICAgICAgICAgIGZhaWwoIlNob3Vs\nZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEwMCIpOwogICAgICAgIH0gY2F0Y2gg\nKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8g\nY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUZXN0IHRoYXQgaWYgdGhlIGJvb2tpZSBjcmFzaGVzIGluIHRoZSBt\naWRkbGUgb2Ygd3JpdGluZwogICAgICogdGhlIGFjdHVhbCBlbnRyeSBpdCBj\nYW4gcmVjb3Zlci4KICAgICAqIEluIHRoaXMgY2FzZSB0aGUgZW50cnkgd2ls\nbCBiZSBhdmFpbGFibGUsIGJ1dCBpdCB3aWxsIGNvcnJ1cHQuCiAgICAgKiBU\naGlzIGlzIG9rLCBhcyB0aGUgY2xpZW50IHdpbGwgZGlzcmVnYXJkIHRoZSBl\nbnRyeSBhZnRlciBsb29raW5nCiAgICAgKiBhdCBpdHMgY2hlY2tzdW0uCiAg\nICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0VHJ1bmNhdGVkSW5FbnRyeUpvdXJuYWwoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxE\naXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAg\nICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0\nQ3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUg\nbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxl\nZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBs\nZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3Rv\ncnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2Vy\nRGlyKSk7CgogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gd3JpdGVQb3N0\nVjJKb3VybmFsKAogICAgICAgICAgICAgICAgQm9va2llLmdldEN1cnJlbnRE\naXJlY3Rvcnkoam91cm5hbERpciksIDEwMCk7CiAgICAgICAgQnl0ZUJ1ZmZl\nciB6ZXJvcyA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMjA0OCk7CgogICAgICAg\nIGpjLmZjLnBvc2l0aW9uKGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpLnBvc2l0\naW9uKCkgLSAweDMwMCk7CiAgICAgICAgamMuZmMud3JpdGUoemVyb3MpOwog\nICAgICAgIGpjLmZjLmZvcmNlKGZhbHNlKTsKCiAgICAgICAgd3JpdGVJbmRl\neEZpbGVGb3JMZWRnZXIoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVk\nZ2VyRGlyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLCAi\ndGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAg\nICAgICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0\nSm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAg\nICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJE\naXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBCb29raWUgYiA9IG5ldyBCb29r\naWUoY29uZik7CiAgICAgICAgYi5yZWFkSm91cm5hbCgpOwogICAgICAgIGIu\ncmVhZEVudHJ5KDEsIDk5KTsKCiAgICAgICAgLy8gc3RpbGwgYWJsZSB0byBy\nZWFkIGxhc3QgZW50cnksIGJ1dCBpdCdzIGp1bmsKICAgICAgICBCeXRlQnVm\nZmVyIGJ1ZiA9IGIucmVhZEVudHJ5KDEsIDEwMCk7CiAgICAgICAgYXNzZXJ0\nRXF1YWxzKCJMZWRnZXIgSWQgaXMgd3JvbmciLCBidWYuZ2V0TG9uZygpLCAx\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkVudHJ5IElkIGlzIHdyb25nIiwg\nYnVmLmdldExvbmcoKSwgMTAwKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkxh\nc3QgY29uZmlybWVkIGlzIHdyb25nIiwgYnVmLmdldExvbmcoKSwgOTkpOwog\nICAgICAgIGFzc2VydEVxdWFscygiTGVuZ3RoIGlzIHdyb25nIiwgYnVmLmdl\ndExvbmcoKSwgMTAwKjEwMjQpOwogICAgICAgIGJ1Zi5nZXRMb25nKCk7IC8v\nIHNraXAgY2hlY2tzdW0KICAgICAgICBib29sZWFuIGFsbFggPSB0cnVlOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAyNDsgaSsrKSB7CiAgICAg\nICAgICAgIGJ5dGUgeCA9IGJ1Zi5nZXQoKTsKICAgICAgICAgICAgYWxsWCA9\nIGFsbFggJiYgeCA9PSAoYnl0ZSknWCc7CiAgICAgICAgfQogICAgICAgIGFz\nc2VydEZhbHNlKCJTb21lIG9mIGJ1ZmZlciBzaG91bGQgaGF2ZSBiZWVuIHpl\ncm9lZCIsIGFsbFgpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBiLnJl\nYWRFbnRyeSgxLCAxMDEpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3Qg\naGF2ZSBmb3VuZCBlbnRyeSAxMDEiKTsKICAgICAgICB9IGNhdGNoIChCb29r\naWUuTm9FbnRyeUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJl\nY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCBwYXJ0aWFsIGluZGV4ICh0cnVuY2F0ZSBtYXN0ZXIga2V5KSB3aXRo\nIHByZS12MyBqb3VybmFscwogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFBhcnRpYWxGaWxlSW5mb1ByZVYz\nSm91cm5hbDEoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB0ZXN0UGFy\ndGlhbEZpbGVJbmZvUHJlVjNKb3VybmFsKHRydWUpOwogICAgfQoKICAgIC8q\nKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4IHdpdGggcHJlLXYzIGpvdXJu\nYWxzCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0UGFydGlhbEZpbGVJbmZvUHJlVjNKb3VybmFsMigpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIHRlc3RQYXJ0aWFsRmlsZUluZm9Q\ncmVWM0pvdXJuYWwoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogVGVz\ndCBwYXJ0aWFsIGluZGV4IGZpbGUgd2l0aCBwcmUtdjMgam91cm5hbHMuCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCB0ZXN0UGFydGlhbEZpbGVJbmZvUHJl\nVjNKb3VybmFsKGJvb2xlYW4gdHJ1bmNhdGVNYXN0ZXJLZXkpCiAgICAgICAg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0g\nRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAg\nICAgICBqb3VybmFsRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIu\nbWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1\ncmUoQm9va2llLmdldEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERpcikpOwoK\nICAgICAgICBGaWxlIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUo\nImJvb2tpZSIsICJsZWRnZXIiKTsKICAgICAgICBsZWRnZXJEaXIuZGVsZXRl\nKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2ll\nLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGly\nZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgd3JpdGVQcmVWMkpvdXJu\nYWwoQm9va2llLmdldEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERpciksIDEw\nMCk7CiAgICAgICAgd3JpdGVQYXJ0aWFsSW5kZXhGaWxlRm9yTGVkZ2VyKEJv\nb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpciksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEsICJ0ZXN0UGFzc3dk\nIi5nZXRCeXRlcygpLCB0cnVuY2F0ZU1hc3RlcktleSk7CgogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0\naW9uKCkKICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAg\nICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkp\nCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10g\neyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBpZiAodHJ1bmNh\ndGVNYXN0ZXJLZXkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAg\nICAgIGIucmVhZEpvdXJuYWwoKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNo\nb3VsZCBub3QgcmVhY2ggaGVyZSEiKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nSU9FeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsK\nICAgICAgICAgICAgYi5yZWFkSm91cm5hbCgpOwogICAgICAgICAgICBiLnJl\nYWRFbnRyeSgxLCAxMDApOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgYi5yZWFkRW50cnkoMSwgMTAxKTsKICAgICAgICAgICAgICAgIGZh\naWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEwMSIpOwogICAgICAg\nICAgICB9IGNhdGNoIChCb29raWUuTm9FbnRyeUV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBwYXJ0\naWFsIGluZGV4ICh0cnVuY2F0ZSBtYXN0ZXIga2V5KSB3aXRoIHBvc3QtdjMg\nam91cm5hbHMKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RQYXJ0aWFsRmlsZUluZm9Qb3N0VjNKb3VybmFs\nMSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRlc3RQYXJ0aWFsRmls\nZUluZm9Qb3N0VjNKb3VybmFsKHRydWUpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGVzdCBwYXJ0aWFsIGluZGV4IHdpdGggcG9zdC12MyBqb3VybmFscwog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFBhcnRpYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwyKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgdGVzdFBhcnRpYWxGaWxlSW5mb1Bvc3RW\nM0pvdXJuYWwoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBw\nYXJ0aWFsIGluZGV4IGZpbGUgd2l0aCBwb3N0LXYzIGpvdXJuYWxzLgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdGVzdFBhcnRpYWxGaWxlSW5mb1Bvc3RW\nM0pvdXJuYWwoYm9vbGVhbiB0cnVuY2F0ZU1hc3RlcktleSkKICAgICAgICB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBG\naWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAg\nICAgIGpvdXJuYWxEaXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5t\na2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVy\nZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7Cgog\nICAgICAgIEZpbGUgbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgi\nYm9va2llIiwgImxlZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUo\nKTsKICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUu\nY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJl\nY3RvcnkobGVkZ2VyRGlyKSk7CgogICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkg\nPSAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKTsKCiAgICAgICAgd3JpdGVQb3N0\nVjNKb3VybmFsKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxE\naXIpLCAxMDAsIG1hc3RlcktleSk7CiAgICAgICAgd3JpdGVQYXJ0aWFsSW5k\nZXhGaWxlRm9yTGVkZ2VyKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxl\nZGdlckRpciksIDEsIG1hc3RlcktleSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdHJ1bmNhdGVNYXN0ZXJLZXkpOwoKICAgICAg\nICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmln\ndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkKICAg\nICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0\naCgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmlu\nZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsKCiAgICAgICAgQm9va2ll\nIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgIGIucmVhZEpvdXJuYWwo\nKTsKICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGIucmVhZEVudHJ5KDEsIDEwMSk7CiAgICAgICAgICAg\nIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEwMSIpOwogICAg\nICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAgICB9\nCn0K\n","encoding":"base64"}

