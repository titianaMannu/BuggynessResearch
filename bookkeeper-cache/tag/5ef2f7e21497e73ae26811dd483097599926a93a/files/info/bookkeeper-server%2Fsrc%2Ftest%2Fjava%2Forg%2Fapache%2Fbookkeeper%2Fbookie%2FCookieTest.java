{"sha":"ea961fe54374f2c9d1dd88951fcf64adc3cc41d5","node_id":"MDQ6QmxvYjE1NzU5NTY6ZWE5NjFmZTU0Mzc0ZjJjOWQxZGQ4ODk1MWZjZjY0YWRjM2NjNDFkNQ==","size":12701,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ea961fe54374f2c9d1dd88951fcf64adc3cc41d5","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmlvLkZpbGVVdGlsczsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlckFkbWlu\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIudGVzdC5ab29LZWVwZXJVdGlsOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnRlc3QuUG9ydE1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5ab29LZWVwZXI7CgppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKCmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5p\ndC5CZWZvcmU7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC4qOwoK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLlVw\nZ3JhZGVUZXN0Lio7CgpwdWJsaWMgY2xhc3MgQ29va2llVGVzdCB7CiAgICBa\nb29LZWVwZXJVdGlsIHprdXRpbDsKICAgIFpvb0tlZXBlciB6a2MgPSBudWxs\nOwogICAgZmluYWwgaW50IGJvb2tpZVBvcnQgPSBQb3J0TWFuYWdlci5uZXh0\nRnJlZVBvcnQoKTsKCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBzZXR1\ncFpvb0tlZXBlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHprdXRp\nbCA9IG5ldyBab29LZWVwZXJVdGlsKCk7CiAgICAgICAgemt1dGlsLnN0YXJ0\nU2VydmVyKCk7CiAgICAgICAgemtjID0gemt1dGlsLmdldFpvb0tlZXBlckNs\naWVudCgpOwogICAgfQoKICAgIEBBZnRlcgogICAgcHVibGljIHZvaWQgdGVh\nckRvd25ab29LZWVwZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB6\na3V0aWwua2lsbFNlcnZlcigpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIFN0cmluZyBuZXdEaXJlY3RvcnkoKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBuZXdEaXJlY3RvcnkodHJ1ZSk7CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgU3RyaW5nIG5ld0RpcmVjdG9yeShib29sZWFuIGNy\nZWF0ZUN1ckRpcikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxl\nIGQgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAidG1wZGlyIik7\nCiAgICAgICAgZC5kZWxldGUoKTsKICAgICAgICBkLm1rZGlycygpOwogICAg\nICAgIGlmIChjcmVhdGVDdXJEaXIpIHsKICAgICAgICAgICAgbmV3IEZpbGUo\nZCwgImN1cnJlbnQiKS5ta2RpcnMoKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGQuZ2V0UGF0aCgpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBz\ndGFydGluZyBib29raWUgd2l0aCBjbGVhbiBzdGF0ZS4KICAgICAqLwogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDbGVh\nblN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQog\nICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFt\nZShuZXdEaXJlY3RvcnkoZmFsc2UpKQogICAgICAgICAgICAuc2V0TGVkZ2Vy\nRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbmV3RGlyZWN0b3J5KGZhbHNlKSB9\nKQogICAgICAgICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0KTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUo\nY29uZik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgZmFpbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlLiIpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBhIHpvb2tl\nZXBlciBjb29raWUKICAgICAqIGlzIGRpZmZlcmVudCB0byBhIGxvY2FsIGNv\nb2tpZSwgdGhlIGJvb2tpZQogICAgICogd2lsbCBmYWlsIHRvIHN0YXJ0CiAg\nICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0QmFkSm91cm5hbENvb2tpZSgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjEgPSBuZXcgU2VydmVy\nQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFt\nZShuZXdEaXJlY3RvcnkoKSkKICAgICAgICAgICAgLnNldExlZGdlckRpck5h\nbWVzKG5ldyBTdHJpbmdbXSB7IG5ld0RpcmVjdG9yeSgpIH0pCiAgICAgICAg\nICAgIC5zZXRCb29raWVQb3J0KGJvb2tpZVBvcnQpOwogICAgICAgIENvb2tp\nZSBjID0gQ29va2llLmdlbmVyYXRlQ29va2llKGNvbmYxKTsKICAgICAgICBj\nLndyaXRlVG9ab29LZWVwZXIoemtjLCBjb25mMSk7CgogICAgICAgIFN0cmlu\nZyBqb3VybmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAgU3RyaW5n\nIGxlZGdlckRpciA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAgIFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZjIgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigp\nCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBl\nckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJO\nYW1lKGpvdXJuYWxEaXIpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1l\ncyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIgfSkKICAgICAgICAgICAgLnNl\ndEJvb2tpZVBvcnQoYm9va2llUG9ydCk7CiAgICAgICAgQ29va2llIGMyID0g\nQ29va2llLmdlbmVyYXRlQ29va2llKGNvbmYyKTsKICAgICAgICBjMi53cml0\nZVRvRGlyZWN0b3J5KG5ldyBGaWxlKGpvdXJuYWxEaXIsICJjdXJyZW50Iikp\nOwogICAgICAgIGMyLndyaXRlVG9EaXJlY3RvcnkobmV3IEZpbGUobGVkZ2Vy\nRGlyLCAiY3VycmVudCIpKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nQm9va2llIGIgPSBuZXcgQm9va2llKGNvbmYyKTsKICAgICAgICAgICAgZmFp\nbCgiU2hvdWxkbid0IGhhdmUgYmVlbiBhYmxlIHRvIHN0YXJ0Iik7CiAgICAg\nICAgfSBjYXRjaCAoQm9va2llRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNl\ncHRpb24gaWNlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3Vy\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlm\nIGEgZGlyZWN0b3J5IGlzIHJlbW92ZWQgZnJvbQogICAgICogdGhlIGNvbmZp\nZ3VyYXRpb24sIHRoZSBib29raWUgd2lsbCBmYWlsIHRvCiAgICAgKiBzdGFy\ndAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdERpcmVjdG9yeU1pc3NpbmcoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBTdHJpbmdbXSBsZWRnZXJEaXJzID0gbmV3IFN0cmluZ1td\nIHsKICAgICAgICAgICAgbmV3RGlyZWN0b3J5KCksIG5ld0RpcmVjdG9yeSgp\nLCBuZXdEaXJlY3RvcnkoKSB9OwogICAgICAgIFN0cmluZyBqb3VybmFsRGly\nID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlv\nbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAg\nICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3Ry\naW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFs\nRGlyKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobGVkZ2VyRGly\ncykKICAgICAgICAgICAgLnNldEJvb2tpZVBvcnQoYm9va2llUG9ydCk7Cgog\nICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsgLy8gc2hvdWxk\nIHdvcmsgZmluZQogICAgICAgIGIuc3RhcnQoKTsKICAgICAgICBiLnNodXRk\nb3duKCk7CgogICAgICAgIGNvbmYuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0\ncmluZ1tdIHsgbGVkZ2VyRGlyc1swXSwgbGVkZ2VyRGlyc1sxXSB9KTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBCb29raWUgYjIgPSBuZXcgQm9va2ll\nKGNvbmYpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgaGF2ZSBiZWVu\nIGFibGUgdG8gc3RhcnQiKTsKICAgICAgICB9IGNhdGNoIChCb29raWVFeGNl\ncHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlvbiBpY2UpIHsKICAgICAgICAg\nICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CgogICAgICAgIGNv\nbmYuc2V0Sm91cm5hbERpck5hbWUobmV3RGlyZWN0b3J5KCkpLnNldExlZGdl\nckRpck5hbWVzKGxlZGdlckRpcnMpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIEJvb2tpZSBiMiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgICAg\nIGZhaWwoIlNob3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0byBzdGFydCIpOwog\nICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2ll\nRXhjZXB0aW9uIGljZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2\naW91cgogICAgICAgIH0KCiAgICAgICAgY29uZi5zZXRKb3VybmFsRGlyTmFt\nZShqb3VybmFsRGlyKTsKICAgICAgICBiID0gbmV3IEJvb2tpZShjb25mKTsK\nICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93bigpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIGEgZGlyZWN0b3J5IGlz\nIGFkZGVkIHRvIGEKICAgICAqIHByZWV4aXN0aW5nIGJvb2tpZSwgdGhlIGJv\nb2tpZSB3aWxsIGZhaWwKICAgICAqIHRvIHN0YXJ0CiAgICAgKi8KICAgIEBU\nZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RGlyZWN0\nb3J5QWRkZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcg\nbGVkZ2VyRGlyMCA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAgIFN0cmluZyBq\nb3VybmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQog\nICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFt\nZShqb3VybmFsRGlyKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMo\nbmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyMCB9KQogICAgICAgICAgICAuc2V0\nQm9va2llUG9ydChib29raWVQb3J0KTsKCiAgICAgICAgQm9va2llIGIgPSBu\nZXcgQm9va2llKGNvbmYpOyAvLyBzaG91bGQgd29yayBmaW5lCiAgICAgICAg\nYi5zdGFydCgpOwogICAgICAgIGIuc2h1dGRvd24oKTsKCiAgICAgICAgY29u\nZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIw\nLCBuZXdEaXJlY3RvcnkoKSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBCb29raWUgYjIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBm\nYWlsKCJTaG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAg\nICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4\nY2VwdGlvbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlv\ndXIKICAgICAgICB9CgogICAgICAgIGNvbmYuc2V0TGVkZ2VyRGlyTmFtZXMo\nbmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyMCB9KTsKICAgICAgICBiID0gbmV3\nIEJvb2tpZShjb25mKTsKICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5z\naHV0ZG93bigpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlm\nIGEgZGlyZWN0b3J5J3MgY29udGVudHMKICAgICAqIGFyZSBlbXB0aWVkLCB0\naGUgYm9va2llIHdpbGwgZmFpbCB0byBzdGFydAogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdERpcmVjdG9y\neUNsZWFyZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcg\nbGVkZ2VyRGlyMCA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAgIFN0cmluZyBq\nb3VybmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQog\nICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFt\nZShqb3VybmFsRGlyKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMo\nbmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyMCAsIG5ld0RpcmVjdG9yeSgpIH0p\nCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0KGJvb2tpZVBvcnQpOwoKICAg\nICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7IC8vIHNob3VsZCB3\nb3JrIGZpbmUKICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93\nbigpOwoKICAgICAgICBGaWxlVXRpbHMuZGVsZXRlRGlyZWN0b3J5KG5ldyBG\naWxlKGxlZGdlckRpcjApKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBC\nb29raWUgYjIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBmYWls\nKCJTaG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAgICAg\nICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2Vw\ndGlvbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgaWYg\nYSBib29raWUncyBwb3J0IGlzIGNoYW5nZWQKICAgICAqIHRoZSBib29raWUg\nd2lsbCBmYWlsIHRvIHN0YXJ0CiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9\nNjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0Qm9va2llUG9ydENoYW5nZWQo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAg\nICAgIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RT\ndHJpbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKG5ld0Rp\ncmVjdG9yeSgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3\nIFN0cmluZ1tdIHsgbmV3RGlyZWN0b3J5KCkgLCBuZXdEaXJlY3RvcnkoKSB9\nKQogICAgICAgICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0KTsKICAg\nICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7IC8vIHNob3VsZCB3\nb3JrIGZpbmUKICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93\nbigpOwoKICAgICAgICBjb25mLnNldEJvb2tpZVBvcnQoMzE4Mik7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYiA9IG5ldyBCb29raWUoY29uZik7CiAg\nICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0byBz\ndGFydCIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5JbnZh\nbGlkQ29va2llRXhjZXB0aW9uIGljZSkgewogICAgICAgICAgICAvLyBjb3Jy\nZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIFRlc3QgdGhhdCBpZiBhIGJvb2tpZSB0cmllcyB0byBzdGFydAogICAgICog\nd2l0aCB0aGUgYWRkcmVzcyBvZiBhIGJvb2tpZSB3aGljaCBoYXMgYWxyZWFk\neQogICAgICogZXhpc3RlZCBpbiB0aGUgc3lzdGVtLCB0aGVuIHRoZSBib29r\naWUgd2lsbCBmYWlsCiAgICAgKiB0byBzdGFydAogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE5ld0Jvb2tp\nZVN0YXJ0aW5nV2l0aEFub3RoZXJCb29raWVzUG9ydCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5l\ndyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFprU2Vy\ndmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKQogICAg\nICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUobmV3RGlyZWN0b3J5KCkpCiAg\nICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBu\nZXdEaXJlY3RvcnkoKSAsIG5ld0RpcmVjdG9yeSgpIH0pCiAgICAgICAgICAg\nIC5zZXRCb29raWVQb3J0KGJvb2tpZVBvcnQpOwogICAgICAgIEJvb2tpZSBi\nID0gbmV3IEJvb2tpZShjb25mKTsgLy8gc2hvdWxkIHdvcmsgZmluZQogICAg\nICAgIGIuc3RhcnQoKTsKICAgICAgICBiLnNodXRkb3duKCk7CgogICAgICAg\nIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAg\nIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJp\nbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKG5ld0RpcmVj\ndG9yeSgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0\ncmluZ1tdIHsgbmV3RGlyZWN0b3J5KCkgLCBuZXdEaXJlY3RvcnkoKSB9KQog\nICAgICAgICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0KTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBiID0gbmV3IEJvb2tpZShjb25mKTsKICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgYmVlbiBhYmxlIHRvIHN0\nYXJ0Iik7CiAgICAgICAgfSBjYXRjaCAoQm9va2llRXhjZXB0aW9uLkludmFs\naWRDb29raWVFeGNlcHRpb24gaWNlKSB7CiAgICAgICAgICAgIC8vIGNvcnJl\nY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBU\nZXN0IENvb2tpZSB2ZXJpZmljYXRpb24gd2l0aCBmb3JtYXQuCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nVmVyaWZ5Q29va2llV2l0aEZvcm1hdCgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIENsaWVudENvbmZpZ3VyYXRpb24gYWRtaW5Db25mID0gbmV3IENs\naWVudENvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2ZXJz\nKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpOwoKICAgICAg\nICBhZG1pbkNvbmYuc2V0UHJvcGVydHkoImJvb2trZWVwZXIuZm9ybWF0Iiwg\ndHJ1ZSk7CiAgICAgICAgLy8gRm9ybWF0IHRoZSBCSyBNZXRhZGF0YSBhbmQg\nZ2VuZXJhdGUgSU5TVEFOQ0VJRAogICAgICAgIEJvb2tLZWVwZXJBZG1pbi5m\nb3JtYXQoYWRtaW5Db25mLCBmYWxzZSwgdHJ1ZSk7CgogICAgICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24gYm9va2llQ29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1\ncmF0aW9uKCkKICAgICAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1dGls\nLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAgICAgICAg\nIC5zZXRKb3VybmFsRGlyTmFtZShuZXdEaXJlY3RvcnkoZmFsc2UpKQogICAg\nICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7\nIG5ld0RpcmVjdG9yeShmYWxzZSkgfSkKICAgICAgICAgICAgICAgIC5zZXRC\nb29raWVQb3J0KGJvb2tpZVBvcnQpOwogICAgICAgIC8vIEJvb2tpZSBzaG91\nbGQgc3RhcnQgc3VjY2Vzc2Z1bGx5IGZvciBmcmVzaCBlbnYuCiAgICAgICAg\nbmV3IEJvb2tpZShib29raWVDb25mKTsKCiAgICAgICAgLy8gRm9ybWF0IG1l\ndGFkYXRhIG9uZSBtb3JlIHRpbWUuCiAgICAgICAgQm9va0tlZXBlckFkbWlu\nLmZvcm1hdChhZG1pbkNvbmYsIGZhbHNlLCB0cnVlKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBuZXcgQm9va2llKGJvb2tpZUNvbmYpOwogICAgICAg\nICAgICBmYWlsKCJCb29raWUgc2hvdWxkIG5vdCBzdGFydCB3aXRoIHByZXZp\nb3VzIGluc3RhbmNlIGlkLiIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4\nY2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZSgKICAgICAgICAgICAgICAgICAgICAiQm9va2llIHN0\nYXJ0dXAgc2hvdWxkIGZhaWwgYmVjYXVzZSBvZiBpbnZhbGlkIGluc3RhbmNl\nIGlkIiwKICAgICAgICAgICAgICAgICAgICBlLmdldE1lc3NhZ2UoKS5jb250\nYWlucygiaW5zdGFuY2VJZCIpKTsKICAgICAgICB9CgogICAgICAgIC8vIE5v\ndyBmb3JtYXQgdGhlIEJvb2tpZSBhbmQgcmVzdGFydC4KICAgICAgICBCb29r\naWUuZm9ybWF0KGJvb2tpZUNvbmYsIGZhbHNlLCB0cnVlKTsKICAgICAgICAv\nLyBBZnRlciBib29raWUgZm9ybWF0IGJvb2tpZSBzaG91bGQgYmUgYWJsZSB0\nbyBzdGFydCBhZ2Fpbi4KICAgICAgICBuZXcgQm9va2llKGJvb2tpZUNvbmYp\nOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIGEgYm9va2ll\nIGlzIHN0YXJ0ZWQgd2l0aCBkaXJlY3RvcmllcyB3aXRoCiAgICAgKiB2ZXJz\naW9uIDIgZGF0YSwgdGhhdCBpdCB3aWxsIGZhaWwgdG8gc3RhcnQgKGl0IG5l\nZWRzIHVwZ3JhZGUpCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0VjJkYXRhKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IFNl\ncnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2ZXJz\nKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpCiAgICAgICAg\nICAgIC5zZXRKb3VybmFsRGlyTmFtZShuZXdWMkpvdXJuYWxEaXJlY3Rvcnko\nKSkKICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdb\nXSB7IG5ld1YyTGVkZ2VyRGlyZWN0b3J5KCkgfSkKICAgICAgICAgICAgLnNl\ndEJvb2tpZVBvcnQoYm9va2llUG9ydCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgQm9va2llIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAg\nICBmYWlsKCJTaG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsK\nICAgICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tp\nZUV4Y2VwdGlvbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhh\ndmlvdXIKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgid3JvbmcgZXhjZXB0aW9u\nIiwgaWNlLmdldENhdXNlKCkuZ2V0TWVzc2FnZSgpLmNvbnRhaW5zKCJ1cGdy\nYWRlIG5lZWRlZCIpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUZXN0IHRoYXQgaWYgYSBib29raWUgaXMgc3RhcnRlZCB3aXRoIGRpcmVj\ndG9yaWVzIHdpdGgKICAgICAqIHZlcnNpb24gMSBkYXRhLCB0aGF0IGl0IHdp\nbGwgZmFpbCB0byBzdGFydCAoaXQgbmVlZHMgdXBncmFkZSkKICAgICAqLwog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RW\nMWRhdGEoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAg\nICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNv\nbm5lY3RTdHJpbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1l\nKG5ld1YxSm91cm5hbERpcmVjdG9yeSgpKQogICAgICAgICAgICAuc2V0TGVk\nZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbmV3VjFMZWRnZXJEaXJlY3Rv\ncnkoKSB9KQogICAgICAgICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29raWUgYiA9IG5ldyBC\nb29raWUoY29uZik7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZl\nIGJlZW4gYWJsZSB0byBzdGFydCIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tp\nZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uIGljZSkgewogICAg\nICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJ3cm9uZyBleGNlcHRpb24iLCBpY2UuZ2V0Q2F1c2UoKS5nZXRN\nZXNzYWdlKCkuY29udGFpbnMoInVwZ3JhZGUgbmVlZGVkIikpOwogICAgICAg\nIH0KICAgIH0KfQo=\n","encoding":"base64"}

