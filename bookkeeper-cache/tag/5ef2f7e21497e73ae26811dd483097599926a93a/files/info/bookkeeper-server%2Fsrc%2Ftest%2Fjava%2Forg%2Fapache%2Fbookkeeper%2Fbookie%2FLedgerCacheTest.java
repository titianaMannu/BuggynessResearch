{"sha":"16a6bf152da480cb7690e2b5a33bdc3803823ce2","node_id":"MDQ6QmxvYjE1NzU5NTY6MTZhNmJmMTUyZGE0ODBjYjc2OTBlMmI1YTMzYmRjMzgwMzgyM2NlMg==","size":13968,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/16a6bf152da480cb7690e2b5a33bdc3803823ce2","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWUuTm9MZWRnZXJFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGEuTGVkZ2VyTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuU25hcHNob3RNYXA7CmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMuaW8uRmlsZVV0aWxzOwppbXBvcnQgb3JnLmp1\nbml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkFzc2VydDsKaW1wb3J0IG9y\nZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKCmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZh\nY3Rvcnk7CgppbXBvcnQganVuaXQuZnJhbWV3b3JrLlRlc3RDYXNlOwoKLyoq\nCiAqIExlZGdlckNhY2hlIHJlbGF0ZWQgdGVzdCBjYXNlcwogKi8KcHVibGlj\nIGNsYXNzIExlZGdlckNhY2hlVGVzdCBleHRlbmRzIFRlc3RDYXNlIHsKICAg\nIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIo\nTGVkZ2VyQ2FjaGVUZXN0LmNsYXNzKTsKCiAgICBTbmFwc2hvdE1hcDxMb25n\nLCBCb29sZWFuPiBhY3RpdmVMZWRnZXJzOwogICAgTGVkZ2VyTWFuYWdlckZh\nY3RvcnkgbGVkZ2VyTWFuYWdlckZhY3Rvcnk7CiAgICBMZWRnZXJDYWNoZSBs\nZWRnZXJDYWNoZTsKICAgIFRocmVhZCBmbHVzaFRocmVhZDsKICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZjsKICAgIEZpbGUgdHhuRGlyLCBsZWRnZXJE\naXI7CgogICAgcHJpdmF0ZSBCb29raWUgYm9va2llOwoKICAgIEBPdmVycmlk\nZQogICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICB0eG5EaXIgPSBGaWxlLmNyZWF0ZVRlbXBG\naWxlKCJsZWRnZXJjYWNoZSIsICJ0eG4iKTsKICAgICAgICB0eG5EaXIuZGVs\nZXRlKCk7CiAgICAgICAgdHhuRGlyLm1rZGlyKCk7CiAgICAgICAgbGVkZ2Vy\nRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgibGVkZ2VyY2FjaGUiLCAibGVk\nZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxl\nZGdlckRpci5ta2RpcigpOwogICAgICAgIC8vIGNyZWF0ZSBjdXJyZW50IGRp\ncgogICAgICAgIG5ldyBGaWxlKGxlZGdlckRpciwgQm9va0tlZXBlckNvbnN0\nYW50cy5DVVJSRU5UX0RJUikubWtkaXIoKTsKCiAgICAgICAgY29uZiA9IG5l\ndyBTZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgY29uZi5zZXRaa1Nl\ncnZlcnMobnVsbCk7CiAgICAgICAgY29uZi5zZXRKb3VybmFsRGlyTmFtZSh0\neG5EaXIuZ2V0UGF0aCgpKTsKICAgICAgICBjb25mLnNldExlZGdlckRpck5h\nbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7CiAg\nICAgICAgYm9va2llID0gbmV3IEJvb2tpZShjb25mKTsKCiAgICAgICAgbGVk\nZ2VyTWFuYWdlckZhY3RvcnkgPQogICAgICAgICAgICBMZWRnZXJNYW5hZ2Vy\nRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeShjb25mLCBudWxsKTsK\nICAgICAgICBhY3RpdmVMZWRnZXJzID0gbmV3IFNuYXBzaG90TWFwPExvbmcs\nIEJvb2xlYW4+KCk7CiAgICAgICAgbGVkZ2VyQ2FjaGUgPSAoKEludGVybGVh\ndmVkTGVkZ2VyU3RvcmFnZSkgYm9va2llLmxlZGdlclN0b3JhZ2UpLmxlZGdl\nckNhY2hlOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgQEFmdGVyCiAgICBw\ndWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGlmIChmbHVzaFRocmVhZCAhPSBudWxsKSB7CiAgICAgICAgICAgIGZs\ndXNoVGhyZWFkLmludGVycnVwdCgpOwogICAgICAgICAgICBmbHVzaFRocmVh\nZC5qb2luKCk7CiAgICAgICAgfQogICAgICAgIGJvb2tpZS5sZWRnZXJTdG9y\nYWdlLnNodXRkb3duKCk7CiAgICAgICAgbGVkZ2VyTWFuYWdlckZhY3Rvcnku\ndW5pbml0aWFsaXplKCk7CiAgICAgICAgRmlsZVV0aWxzLmRlbGV0ZURpcmVj\ndG9yeSh0eG5EaXIpOwogICAgICAgIEZpbGVVdGlscy5kZWxldGVEaXJlY3Rv\ncnkobGVkZ2VyRGlyKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgbmV3TGVk\nZ2VyQ2FjaGUoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChs\nZWRnZXJDYWNoZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGxlZGdlckNhY2hl\nLmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIGxlZGdlckNhY2hlID0gKChJ\nbnRlcmxlYXZlZExlZGdlclN0b3JhZ2UpIGJvb2tpZS5sZWRnZXJTdG9yYWdl\nKS5sZWRnZXJDYWNoZSA9IG5ldyBMZWRnZXJDYWNoZUltcGwoCiAgICAgICAg\nICAgICAgICBjb25mLCBhY3RpdmVMZWRnZXJzLCBib29raWUuZ2V0TGVkZ2Vy\nRGlyc01hbmFnZXIoKSk7CiAgICAgICAgZmx1c2hUaHJlYWQgPSBuZXcgVGhy\nZWFkKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBzbGVlcChjb25mLmdldEZsdXNoSW50ZXJ2YWwoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5mbHVzaExlZGdlcih0cnVl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0\nZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGtpbGxlZCBieSB0ZWFyZG93bgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIGZs\ndXNoIHRocmVhZCIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9OwogICAgICAgIGZsdXNoVGhyZWFkLnN0YXJ0KCk7CiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD0zMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RB\nZGRFbnRyeUV4Y2VwdGlvbigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gc2V0IHBhZ2UgbGltaXRhdGlvbgogICAgICAgIGNvbmYuc2V0UGFn\nZUxpbWl0KDEwKTsKICAgICAgICAvLyBjcmVhdGUgYSBsZWRnZXIgY2FjaGUK\nICAgICAgICBuZXdMZWRnZXJDYWNoZSgpOwogICAgICAgIC8qCiAgICAgICAg\nICogUG9wdWxhdGUgbGVkZ2VyIGNhY2hlLgogICAgICAgICAqLwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkgPSAiYmxhaCIu\nZ2V0Qnl0ZXMoKTsKICAgICAgICAgICAgZm9yKCBpbnQgaSA9IDA7IGkgPCAx\nMDA7IGkrKykgewogICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuc2V0TWFz\ndGVyS2V5KChsb25nKWksIG1hc3RlcktleSk7CiAgICAgICAgICAgICAgICBs\nZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNldChpLCAwLCBpKjgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIkdvdCBJT0V4Y2VwdGlvbi4iLCBlKTsKICAg\nICAgICAgICAgZmFpbCgiRmFpbGVkIHRvIGFkZCBlbnRyeS4iKTsKICAgICAg\nICB9CiAgICB9CgogICAgQFRlc3QodGltZW91dD0zMDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RMZWRnZXJFdmljdGlvbigpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIGludCBudW1FbnRyaWVzID0gMTA7CiAgICAgICAgLy8gbGlt\naXQgb3BlbiBmaWxlcyAmIHBhZ2VzCiAgICAgICAgY29uZi5zZXRPcGVuRmls\nZUxpbWl0KDEpLnNldFBhZ2VMaW1pdCgyKQogICAgICAgICAgICAuc2V0UGFn\nZVNpemUoOCAqIG51bUVudHJpZXMpOwogICAgICAgIC8vIGNyZWF0ZSBsZWRn\nZXIgY2FjaGUKICAgICAgICBuZXdMZWRnZXJDYWNoZSgpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGludCBudW1MZWRnZXJzID0gMzsKICAgICAgICAg\nICAgYnl0ZVtdIG1hc3RlcktleSA9ICJibGFoIi5nZXRCeXRlcygpOwogICAg\nICAgICAgICBmb3IgKGludCBpPTE7IGk8PW51bUxlZGdlcnM7IGkrKykgewog\nICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuc2V0TWFzdGVyS2V5KChsb25n\nKWksIG1hc3RlcktleSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBqPTA7\nIGo8bnVtRW50cmllczsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoaSwgaiwgaSAqIG51bUVudHJpZXMg\nKyBqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiR290IEV4Y2VwdGlvbi4iLCBlKTsKICAgICAgICAgICAgZmFpbCgiRmFp\nbGVkIHRvIGFkZCBlbnRyeS4iKTsKICAgICAgICB9CiAgICB9CgogICAgQFRl\nc3QodGltZW91dD0zMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3REZWxldGVM\nZWRnZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgbnVtRW50\ncmllcyA9IDEwOwogICAgICAgIC8vIGxpbWl0IG9wZW4gZmlsZXMgJiBwYWdl\ncwogICAgICAgIGNvbmYuc2V0T3BlbkZpbGVMaW1pdCg5OTkpLnNldFBhZ2VM\naW1pdCgyKQogICAgICAgICAgICAuc2V0UGFnZVNpemUoOCAqIG51bUVudHJp\nZXMpOwogICAgICAgIC8vIGNyZWF0ZSBsZWRnZXIgY2FjaGUKICAgICAgICBu\nZXdMZWRnZXJDYWNoZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlu\ndCBudW1MZWRnZXJzID0gMjsKICAgICAgICAgICAgYnl0ZVtdIG1hc3Rlcktl\neSA9ICJibGFoIi5nZXRCeXRlcygpOwogICAgICAgICAgICBmb3IgKGludCBp\nPTE7IGk8PW51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAgICAgICAgbGVk\nZ2VyQ2FjaGUuc2V0TWFzdGVyS2V5KChsb25nKWksIG1hc3RlcktleSk7CiAg\nICAgICAgICAgICAgICBmb3IgKGludCBqPTA7IGo8bnVtRW50cmllczsgaisr\nKSB7CiAgICAgICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUucHV0RW50cnlP\nZmZzZXQoaSwgaiwgaSpudW1FbnRyaWVzICsgaik7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gbGVkZ2VyIGNhY2hl\nIGlzIGV4aGF1c3RlZAogICAgICAgICAgICAvLyBkZWxldGUgbGVkZ2Vycwog\nICAgICAgICAgICBmb3IgKGludCBpPTE7IGk8PW51bUxlZGdlcnM7IGkrKykg\newogICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuZGVsZXRlTGVkZ2VyKChs\nb25nKWkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNyZWF0ZSBu\ndW0gbGVkZ2VycyB0byBhZGQgZW50cmllcwogICAgICAgICAgICBmb3IgKGlu\ndCBpPW51bUxlZGdlcnMrMTsgaTw9MipudW1MZWRnZXJzOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGxlZGdlckNhY2hlLnNldE1hc3RlcktleSgobG9uZylp\nLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaj0wOyBq\nPG51bUVudHJpZXM7IGorKykgewogICAgICAgICAgICAgICAgICAgIGxlZGdl\nckNhY2hlLnB1dEVudHJ5T2Zmc2V0KGksIGosIGkqbnVtRW50cmllcyArIGop\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJH\nb3QgRXhjZXB0aW9uLiIsIGUpOwogICAgICAgICAgICBmYWlsKCJGYWlsZWQg\ndG8gYWRkIGVudHJ5LiIpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0\naW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFBhZ2VFdmljdGlv\nbigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBudW1MZWRnZXJz\nID0gMTA7CiAgICAgICAgYnl0ZVtdIG1hc3RlcktleSA9ICJibGFoIi5nZXRC\neXRlcygpOwogICAgICAgIC8vIGxpbWl0IHBhZ2UgY291bnQKICAgICAgICBj\nb25mLnNldE9wZW5GaWxlTGltaXQoOTk5OTk5KS5zZXRQYWdlTGltaXQoMyk7\nCiAgICAgICAgLy8gY3JlYXRlIGxlZGdlciBjYWNoZQogICAgICAgIG5ld0xl\nZGdlckNhY2hlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY3Jl\nYXRlIHNlcnZlcmFsIGxlZGdlcnMKICAgICAgICAgICAgZm9yIChpbnQgaT0x\nOyBpPD1udW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdl\nckNhY2hlLnNldE1hc3RlcktleSgobG9uZylpLCBtYXN0ZXJLZXkpOwogICAg\nICAgICAgICAgICAgbGVkZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoaSwgMCwg\naSo4KTsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLnB1dEVudHJ5T2Zm\nc2V0KGksIDEsIGkqOCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGZsdXNoIGFsbCBmaXJzdCB0byBjbGVhbiBwcmV2aW91cyBkaXJ0eSBsZWRn\nZXJzCiAgICAgICAgICAgIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2VyKHRydWUp\nOwogICAgICAgICAgICAvLyBmbHVzaCBhbGwgCiAgICAgICAgICAgIGxlZGdl\nckNhY2hlLmZsdXNoTGVkZ2VyKHRydWUpOwoKICAgICAgICAgICAgLy8gZGVs\nZXRlIHNlcnZlcmFsIGxlZGdlcnMKICAgICAgICAgICAgZm9yIChpbnQgaT0x\nOyBpPD1udW1MZWRnZXJzLzI7IGkrKykgewogICAgICAgICAgICAgICAgbGVk\nZ2VyQ2FjaGUuZGVsZXRlTGVkZ2VyKGkpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBib29raWUgcmVzdGFydHMKICAgICAgICAgICAgbmV3TGVk\nZ2VyQ2FjaGUoKTsKCiAgICAgICAgICAgIC8vIHNpbXVsYXRlIHJlcGxheWlu\nZyBqb3VybmFscyB0byBhZGQgZW50cmllcyBhZ2FpbgogICAgICAgICAgICBm\nb3IgKGludCBpPTE7IGk8PW51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5w\ndXRFbnRyeU9mZnNldChpLCAxLCBpKjgpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoTm9MZWRnZXJFeGNlcHRpb24gbnNsZSkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChpPD1udW1MZWRnZXJzLzIpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gaXQgaXMgb2sKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9y\nIHB1dCBlbnRyeSBvZmZzZXQgOiAiLCBuc2xlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlLiIpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIExPRy5lcnJvcigiR290IEV4Y2VwdGlvbi4iLCBlKTsKICAgICAgICAg\nICAgZmFpbCgiRmFpbGVkIHRvIGFkZCBlbnRyeS4iKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUZXN0IExlZGdlciBDYWNoZSBmbHVzaCBm\nYWlsdXJlCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0TGVkZ2VyQ2FjaGVGbHVzaEZhaWx1cmVPbkRpc2tG\ndWxsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBsZWRnZXJE\naXIxID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYmtUZXN0IiwgIi5kaXIiKTsK\nICAgICAgICBsZWRnZXJEaXIxLmRlbGV0ZSgpOwogICAgICAgIEZpbGUgbGVk\nZ2VyRGlyMiA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJrVGVzdCIsICIuZGly\nIik7CiAgICAgICAgbGVkZ2VyRGlyMi5kZWxldGUoKTsKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlv\nbigpOwogICAgICAgIGNvbmYuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmlu\nZ1tdIHsgbGVkZ2VyRGlyMS5nZXRBYnNvbHV0ZVBhdGgoKSwgbGVkZ2VyRGly\nMi5nZXRBYnNvbHV0ZVBhdGgoKSB9KTsKCiAgICAgICAgQm9va2llIGJvb2tp\nZSA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgSW50ZXJsZWF2ZWRMZWRn\nZXJTdG9yYWdlIGxlZGdlclN0b3JhZ2UgPSAoKEludGVybGVhdmVkTGVkZ2Vy\nU3RvcmFnZSkgYm9va2llLmxlZGdlclN0b3JhZ2UpOwogICAgICAgIExlZGdl\nckNhY2hlSW1wbCBsZWRnZXJDYWNoZSA9IChMZWRnZXJDYWNoZUltcGwpIGxl\nZGdlclN0b3JhZ2UubGVkZ2VyQ2FjaGU7CiAgICAgICAgLy8gQ3JlYXRlIGxl\nZGdlciBpbmRleCBmaWxlCiAgICAgICAgbGVkZ2VyU3RvcmFnZS5zZXRNYXN0\nZXJLZXkoMSwgImtleSIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIEZpbGVJbmZv\nIGZpbGVJbmZvID0gbGVkZ2VyQ2FjaGUuZ2V0RmlsZUluZm8oTG9uZy52YWx1\nZU9mKDEpLCBudWxsKTsKCiAgICAgICAgLy8gU2ltdWxhdGUgdGhlIGZsdXNo\nIGZhaWx1cmUKICAgICAgICBGaWxlSW5mbyBuZXdGaWxlSW5mbyA9IG5ldyBG\naWxlSW5mbyhmaWxlSW5mby5nZXRMZigpLCBmaWxlSW5mby5nZXRNYXN0ZXJL\nZXkoKSk7CiAgICAgICAgbGVkZ2VyQ2FjaGUuZmlsZUluZm9DYWNoZS5wdXQo\nTG9uZy52YWx1ZU9mKDEpLCBuZXdGaWxlSW5mbyk7CiAgICAgICAgLy8gQWRk\nIGVudHJpZXMKICAgICAgICBsZWRnZXJTdG9yYWdlLmFkZEVudHJ5KGdlbmVy\nYXRlRW50cnkoMSwgMSkpOwogICAgICAgIGxlZGdlclN0b3JhZ2UuYWRkRW50\ncnkoZ2VuZXJhdGVFbnRyeSgxLCAyKSk7CiAgICAgICAgbGVkZ2VyU3RvcmFn\nZS5mbHVzaCgpOwoKICAgICAgICBsZWRnZXJTdG9yYWdlLmFkZEVudHJ5KGdl\nbmVyYXRlRW50cnkoMSwgMykpOwogICAgICAgIC8vIGFkZCB0aGUgZGlyIHRv\nIGZhaWxlZCBkaXJzCiAgICAgICAgYm9va2llLmdldExlZGdlckRpcnNNYW5h\nZ2VyKCkuYWRkVG9GaWxsZWREaXJzKAogICAgICAgICAgICAgICAgbmV3Rmls\nZUluZm8uZ2V0TGYoKS5nZXRQYXJlbnRGaWxlKCkuZ2V0UGFyZW50RmlsZSgp\nLmdldFBhcmVudEZpbGUoKSk7CiAgICAgICAgRmlsZSBiZWZvcmUgPSBuZXdG\naWxlSW5mby5nZXRMZigpOwogICAgICAgIC8vIGZsdXNoIGFmdGVyIGRpc2sg\naXMgYWRkZWQgYXMgZmFpbGVkLgogICAgICAgIGxlZGdlclN0b3JhZ2UuZmx1\nc2goKTsKICAgICAgICBGaWxlIGFmdGVyID0gbmV3RmlsZUluZm8uZ2V0TGYo\nKTsKCiAgICAgICAgYXNzZXJ0RmFsc2UoIkFmdGVyIGZsdXNoIGluZGV4IGZp\nbGUgc2hvdWxkIGJlIGNoYW5nZWQiLCBiZWZvcmUuZXF1YWxzKGFmdGVyKSk7\nCiAgICAgICAgLy8gVmVyaWZ5IHdyaXR0ZW4gZW50cmllcwogICAgICAgIEFz\nc2VydC5hc3NlcnRBcnJheUVxdWFscyhnZW5lcmF0ZUVudHJ5KDEsIDEpLmFy\ncmF5KCksIGxlZGdlclN0b3JhZ2UuZ2V0RW50cnkoMSwgMSkuYXJyYXkoKSk7\nCiAgICAgICAgQXNzZXJ0LmFzc2VydEFycmF5RXF1YWxzKGdlbmVyYXRlRW50\ncnkoMSwgMikuYXJyYXkoKSwgbGVkZ2VyU3RvcmFnZS5nZXRFbnRyeSgxLCAy\nKS5hcnJheSgpKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0QXJyYXlFcXVhbHMo\nZ2VuZXJhdGVFbnRyeSgxLCAzKS5hcnJheSgpLCBsZWRnZXJTdG9yYWdlLmdl\ndEVudHJ5KDEsIDMpLmFycmF5KCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCB0aGF0IGlmIHdlIGFyZSB3cml0aW5nIHRvIG1vcmUgbGVkZ2VycyB0\naGFuIHRoZXJlCiAgICAgKiBhcmUgcGFnZXMsIHRoZW4gd2Ugd2lsbCBub3Qg\nZmx1c2ggdGhlIGluZGV4IGJlZm9yZSB0aGUKICAgICAqIGVudHJpZXMgaW4g\ndGhlIGVudHJ5bG9nZ2VyIGhhdmUgYmVlbiBwZXJzaXN0ZWQgdG8gZGlzay4K\nICAgICAqIHtAbGluayBodHRwczovL2lzc3Vlcy5hcGFjaGUub3JnL2ppcmEv\nYnJvd3NlL0JPT0tLRUVQRVItNDQ3fQogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEluZGV4UGFnZUV2aWN0\naW9uV3JpdGVPcmRlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZp\nbmFsIGludCBudW1MZWRnZXJzID0gMTA7CiAgICAgICAgRmlsZSBqb3VybmFs\nRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwi\nKTsKICAgICAgICBqb3VybmFsRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJu\nYWxEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlT\ndHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERp\ncikpOwoKICAgICAgICBGaWxlIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVt\ncEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsKICAgICAgICBsZWRnZXJEaXIu\nZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGlyKCk7CiAgICAgICAg\nQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJy\nZW50RGlyZWN0b3J5KGxlZGdlckRpcikpOwoKICAgICAgICBTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAg\nICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkKICAgICAgICAgICAgLnNl\ndEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQogICAgICAg\nICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2Vy\nRGlyLmdldFBhdGgoKSB9KQogICAgICAgICAgICAuc2V0Rmx1c2hJbnRlcnZh\nbCgxMDAwKQogICAgICAgICAgICAuc2V0UGFnZUxpbWl0KDEpOwoKICAgICAg\nICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgYi5zdGFy\ndCgpOwogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDw9IG51bUxlZGdlcnM7\nIGkrKykgewogICAgICAgICAgICBCeXRlQnVmZmVyIHBhY2tldCA9IGdlbmVy\nYXRlRW50cnkoaSwgMSk7CiAgICAgICAgICAgIGIuYWRkRW50cnkocGFja2V0\nLCBuZXcgQm9va2llLk5vcFdyaXRlQ2FsbGJhY2soKSwgbnVsbCwgInBhc3N3\nZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICBjb25mID0gbmV3\nIFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2\nZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3Vy\nbmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNldExlZGdlckRpck5h\nbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7Cgog\nICAgICAgIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgIGZvciAoaW50\nIGkgPSAxOyBpIDw9IG51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgYi5yZWFkRW50cnkoaSwgMSk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0xlZGdlckV4Y2VwdGlvbiBubGUp\nIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgZmluZSwgbWVhbnMgdGhl\nIGxlZGdlciB3YXMgbmV2ZXIgd3JpdHRlbiB0byB0aGUgaW5kZXggY2FjaGUK\nICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscygiTm8gbGVkZ2VyIHNob3Vs\nZCBvbmx5IGhhcHBlbiBmb3IgdGhlIGxhc3QgbGVkZ2VyIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpLCBudW1MZWRnZXJzKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNlcHRpb24gbmVlKSB7CiAg\nICAgICAgICAgICAgICAvLyB0aGlzIGlzIGZpbmUsIG1lYW5zIHRoZSBsZWRn\nZXIgd2FzIHdyaXR0ZW4gdG8gdGhlIGluZGV4IGNhY2hlLCBidXQgbm90CiAg\nICAgICAgICAgICAgICAvLyB0aGUgZW50cnkgbG9nCiAgICAgICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgTE9H\nLmluZm8oIlNob3VsZG4ndCBoYXZlIHJlY2VpdmVkIElPRXhjZXB0aW9uIiwg\naW9lKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCB0aHJvdyBJ\nT0V4Y2VwdGlvbiwgc2hvdWxkIHNheSB0aGF0IGVudHJ5IGlzIG5vdCBmb3Vu\nZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioK\nICAgICAqIHtAbGluayBodHRwczovL2lzc3Vlcy5hcGFjaGUub3JnL2ppcmEv\nYnJvd3NlL0JPT0tLRUVQRVItNTI0fQogICAgICogQ2hlY2tzIHRoYXQgZ2V0\nTGVkZ2VyRW50cnlQYWdlIGRvZXMgbm90IHRocm93IGFuIE5QRSBpbiB0aGUK\nICAgICAqIGNhc2UgZ2V0RnJvbVRhYmxlIHJldHVybnMgYSBudWxsIGxlZGdl\nciBlbnRyeSBwYWdlIHJlZmVyZW5jZS4KICAgICAqIFRoaXMgTlBFIG1pZ2h0\nIGtpbGwgdGhlIHN5bmMgdGhyZWFkIGxlYXZpbmcgYSBib29raWUgd2l0aCBu\nbwogICAgICogc3luYyB0aHJlYWQgcnVubmluZy4KICAgICAqCiAgICAgKiBA\ndGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9\nMzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY1RocmVhZE5QRSgpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICAoKExlZGdlckNhY2hlSW1wbCkg\nbGVkZ2VyQ2FjaGUpLmdldExlZGdlckVudHJ5UGFnZSgwTCwgMEwsIHRydWUp\nOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoZW4gdHJ5aW5nIHRvIGdldCBhIGxl\nZGdlciBlbnRyeSBwYWdlIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlNob3Vs\nZG4ndCBoYXZlIHRocm93biBhbiBleGNlcHRpb24iKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBCeXRlQnVmZmVyIGdlbmVyYXRlRW50cnkobG9u\nZyBsZWRnZXIsIGxvbmcgZW50cnkpIHsKICAgICAgICBieXRlW10gZGF0YSA9\nICgibGVkZ2VyLSIgKyBsZWRnZXIgKyAiLSIgKyBlbnRyeSkuZ2V0Qnl0ZXMo\nKTsKICAgICAgICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci53cmFwKG5l\ndyBieXRlWzggKyA4ICsgZGF0YS5sZW5ndGhdKTsKICAgICAgICBiYi5wdXRM\nb25nKGxlZGdlcik7CiAgICAgICAgYmIucHV0TG9uZyhlbnRyeSk7CiAgICAg\nICAgYmIucHV0KGRhdGEpOwogICAgICAgIGJiLmZsaXAoKTsKICAgICAgICBy\nZXR1cm4gYmI7CiAgICB9Cn0K\n","encoding":"base64"}

