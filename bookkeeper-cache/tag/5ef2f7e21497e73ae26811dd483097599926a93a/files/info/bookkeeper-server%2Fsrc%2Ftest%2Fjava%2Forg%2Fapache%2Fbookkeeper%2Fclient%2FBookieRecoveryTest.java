{"sha":"95a00f300ff8740d470210bcb24a272067c07d75","node_id":"MDQ6QmxvYjE1NzU5NTY6OTVhMDBmMzAwZmY4NzQwZDQ3MDIxMGJjYjI0YTI3MjA2N2MwN2Q3NQ==","size":37340,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/95a00f300ff8740d470210bcb24a272067c07d75","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRBZGRyZXNzOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkVudW1lcmF0aW9uOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0\naW9uczsKaW1wb3J0IGphdmEudXRpbC5SYW5kb207CgppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVyOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0xvbmc7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnRlc3QuTXVsdGlMZWRnZXJNYW5hZ2VyTXVsdGlEaWdlc3RU\nZXN0Q2FzZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkNs\naWVudENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLm1ldGEuTVNMZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50\nZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxi\nYWNrcy5SZWFkRW50cnlDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5SZWNvdmVyQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVw\nZXIuRGlnZXN0VHlwZTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5qdW5pdC5B\nZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVu\naXQuVGVzdDsKCi8qKgogKiBUaGlzIGNsYXNzIHRlc3RzIHRoZSBib29raWUg\ncmVjb3ZlcnkgYWRtaW4gZnVuY3Rpb25hbGl0eS4KICovCnB1YmxpYyBjbGFz\ncyBCb29raWVSZWNvdmVyeVRlc3QgZXh0ZW5kcyBNdWx0aUxlZGdlck1hbmFn\nZXJNdWx0aURpZ2VzdFRlc3RDYXNlIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9H\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va2llUmVjb3ZlcnlUZXN0\nLmNsYXNzKTsKCiAgICAvLyBPYmplY3QgdXNlZCBmb3Igc3luY2hyb25pemlu\nZyBhc3luYyBtZXRob2QgY2FsbHMKICAgIGNsYXNzIFN5bmNPYmplY3Qgewog\nICAgICAgIGJvb2xlYW4gdmFsdWU7CgogICAgICAgIHB1YmxpYyBTeW5jT2Jq\nZWN0KCkgewogICAgICAgICAgICB2YWx1ZSA9IGZhbHNlOwogICAgICAgIH0K\nICAgIH0KCiAgICAvLyBPYmplY3QgdXNlZCBmb3IgaW1wbGVtZW50aW5nIHRo\nZSBCb29raWUgUmVjb3ZlckNhbGxiYWNrIGZvciB0aGlzIGpVbml0CiAgICAv\nLyB0ZXN0LiBUaGlzIHZlcmlmaWVzIHRoYXQgdGhlIG9wZXJhdGlvbiBjb21w\nbGV0ZWQgc3VjY2Vzc2Z1bGx5LgogICAgY2xhc3MgQm9va2llUmVjb3ZlckNh\nbGxiYWNrIGltcGxlbWVudHMgUmVjb3ZlckNhbGxiYWNrIHsKICAgICAgICBi\nb29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgdm9pZCByZWNvdmVyQ29tcGxldGUoaW50IHJjLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgIExPRy5pbmZvKCJSZWNvdmVyZWQgYm9v\na2llIG9wZXJhdGlvbiBjb21wbGV0ZWQgd2l0aCByYzogIiArIHJjKTsKICAg\nICAgICAgICAgc3VjY2VzcyA9IHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0s7\nCiAgICAgICAgICAgIFN5bmNPYmplY3Qgc3luYyA9IChTeW5jT2JqZWN0KSBj\ndHg7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAg\nICAgICAgICAgc3luYy52YWx1ZSA9IHRydWU7CiAgICAgICAgICAgICAgICBz\neW5jLm5vdGlmeSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8vIE9iamVjdHMgdG8gdXNlIGZvciB0aGlzIGpVbml0IHRlc3QuCiAg\nICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGU7CiAgICBTdHJpbmcgbGVkZ2VyTWFu\nYWdlckZhY3Rvcnk7CiAgICBTeW5jT2JqZWN0IHN5bmM7CiAgICBCb29raWVS\nZWNvdmVyQ2FsbGJhY2sgYm9va2llUmVjb3ZlckNiOwogICAgQm9va0tlZXBl\nckFkbWluIGJrQWRtaW47CgogICAgLy8gQ29uc3RydWN0b3IKICAgIHB1Ymxp\nYyBCb29raWVSZWNvdmVyeVRlc3QoU3RyaW5nIGxlZGdlck1hbmFnZXJGYWN0\nb3J5LCBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHsKICAgICAgICBzdXBlcigz\nKTsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBkaWdlc3RUeXBlOwogICAg\nICAgIHRoaXMubGVkZ2VyTWFuYWdlckZhY3RvcnkgPSBsZWRnZXJNYW5hZ2Vy\nRmFjdG9yeTsKICAgICAgICBMT0cuaW5mbygiVXNpbmcgbGVkZ2VyIG1hbmFn\nZXIgIiArIGxlZGdlck1hbmFnZXJGYWN0b3J5KTsKICAgICAgICAvLyBzZXQg\nbGVkZ2VyIG1hbmFnZXIKICAgICAgICBiYXNlQ29uZi5zZXRMZWRnZXJNYW5h\nZ2VyRmFjdG9yeUNsYXNzTmFtZShsZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAg\nICAgICAgYmFzZUNsaWVudENvbmYuc2V0TGVkZ2VyTWFuYWdlckZhY3RvcnlD\nbGFzc05hbWUobGVkZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgfQoKICAgIEBC\nZWZvcmUKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBTZXQgdXAgdGhlIGNvbmZp\nZ3VyYXRpb24gcHJvcGVydGllcyBuZWVkZWQuCiAgICAgICAgYmFzZUNsaWVu\ndENvbmYuc2V0Qm9va2llUmVjb3ZlcnlEaWdlc3RUeXBlKGRpZ2VzdFR5cGUp\nOwogICAgICAgIGJhc2VDbGllbnRDb25mLnNldEJvb2tpZVJlY292ZXJ5UGFz\nc3dkKCIiLmdldEJ5dGVzKCkpOwogICAgICAgIHN1cGVyLnNldFVwKCk7Cgog\nICAgICAgIHN5bmMgPSBuZXcgU3luY09iamVjdCgpOwogICAgICAgIGJvb2tp\nZVJlY292ZXJDYiA9IG5ldyBCb29raWVSZWNvdmVyQ2FsbGJhY2soKTsKICAg\nICAgICBDbGllbnRDb25maWd1cmF0aW9uIGFkbWluQ29uZiA9IG5ldyBDbGll\nbnRDb25maWd1cmF0aW9uKGJhc2VDbGllbnRDb25mKTsKICAgICAgICBhZG1p\nbkNvbmYuc2V0WmtTZXJ2ZXJzKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0\nU3RyaW5nKCkpOwogICAgICAgIGJrQWRtaW4gPSBuZXcgQm9va0tlZXBlckFk\nbWluKGFkbWluQ29uZik7CiAgICB9CgogICAgQEFmdGVyCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gUmVsZWFzZSBhbnkgcmVzb3VyY2VzIHVzZWQgYnkg\ndGhlIEJvb2tLZWVwZXJUb29scyBpbnN0YW5jZS4KICAgICAgICBpZihia0Fk\nbWluICE9IG51bGwpewogICAgICAgICAgICBia0FkbWluLmNsb3NlKCk7CiAg\nICAgICAgfQogICAgICAgIHN1cGVyLnRlYXJEb3duKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGNyZWF0ZSBhIG51bWJlciBv\nZiBsZWRnZXJzCiAgICAgKgogICAgICogQHBhcmFtIG51bUxlZGdlcnMKICAg\nICAqICAgICAgICAgICAgTnVtYmVyIG9mIGxlZGdlcnMgdG8gY3JlYXRlCiAg\nICAgKiBAcmV0dXJuIExpc3Qgb2YgTGVkZ2VySGFuZGxlcyBmb3IgZWFjaCBv\nZiB0aGUgbGVkZ2VycyBjcmVhdGVkCiAgICAgKi8KICAgIHByaXZhdGUgTGlz\ndDxMZWRnZXJIYW5kbGU+IGNyZWF0ZUxlZGdlcnMoaW50IG51bUxlZGdlcnMp\nCiAgICAgICAgICAgIHRocm93cyBCS0V4Y2VwdGlvbiwgSU9FeGNlcHRpb24s\nIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICB7CiAgICAgICAgcmV0dXJuIGNy\nZWF0ZUxlZGdlcnMobnVtTGVkZ2VycywgMywgMik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGNyZWF0ZSBhIG51bWJlciBvZiBs\nZWRnZXJzCiAgICAgKgogICAgICogQHBhcmFtIG51bUxlZGdlcnMKICAgICAq\nICAgICAgICAgICAgTnVtYmVyIG9mIGxlZGdlcnMgdG8gY3JlYXRlCiAgICAg\nKiBAcGFyYW0gZW5zZW1ibGUgRW5zZW1ibGUgc2l6ZSBmb3IgbGVkZ2Vycwog\nICAgICogQHBhcmFtIHF1b3J1bSBRdW9ydW0gc2l6ZSBmb3IgbGVkZ2Vycwog\nICAgICogQHJldHVybiBMaXN0IG9mIExlZGdlckhhbmRsZXMgZm9yIGVhY2gg\nb2YgdGhlIGxlZGdlcnMgY3JlYXRlZAogICAgICovCiAgICBwcml2YXRlIExp\nc3Q8TGVkZ2VySGFuZGxlPiBjcmVhdGVMZWRnZXJzKGludCBudW1MZWRnZXJz\nLCBpbnQgZW5zZW1ibGUsIGludCBxdW9ydW0pCiAgICAgICAgICAgIHRocm93\ncyBCS0V4Y2VwdGlvbiwgSU9FeGNlcHRpb24sCiAgICAgICAgSW50ZXJydXB0\nZWRFeGNlcHRpb24gewogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMg\nPSBuZXcgQXJyYXlMaXN0PExlZGdlckhhbmRsZT4oKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAg\nICBsaHMuYWRkKGJrYy5jcmVhdGVMZWRnZXIoZW5zZW1ibGUsIHF1b3J1bSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2VzdFR5\ncGUsIGJhc2VDbGllbnRDb25mLmdldEJvb2tpZVJlY292ZXJ5UGFzc3dkKCkp\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxoczsKICAgIH0KCiAgICBw\ncml2YXRlIExpc3Q8TGVkZ2VySGFuZGxlPiBvcGVuTGVkZ2VycyhMaXN0PExl\nZGdlckhhbmRsZT4gb2xkTGhzKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbmV3TGhzID0gbmV3\nIEFycmF5TGlzdDxMZWRnZXJIYW5kbGU+KCk7CiAgICAgICAgZm9yIChMZWRn\nZXJIYW5kbGUgb2xkTGggOiBvbGRMaHMpIHsKICAgICAgICAgICAgbmV3TGhz\nLmFkZChia2Mub3BlbkxlZGdlcihvbGRMaC5nZXRJZCgpLCBkaWdlc3RUeXBl\nLCBiYXNlQ2xpZW50Q29uZi5nZXRCb29raWVSZWNvdmVyeVBhc3N3ZCgpKSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXdMaHM7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHdyaXRlIGR1bW15IGxlZGdl\nciBlbnRyaWVzIHRvIGFsbCBvZiB0aGUgbGVkZ2VycyBwYXNzZWQuCiAgICAg\nKgogICAgICogQHBhcmFtIG51bUVudHJpZXMKICAgICAqICAgICAgICAgICAg\nTnVtYmVyIG9mIGxlZGdlciBlbnRyaWVzIHRvIHdyaXRlIGZvciBlYWNoIGxl\nZGdlcgogICAgICogQHBhcmFtIHN0YXJ0RW50cnlJZAogICAgICogICAgICAg\nICAgICBUaGUgZmlyc3QgZW50cnkgSWQgd2UncmUgZXhwZWN0aW5nIHRvIHdy\naXRlIGZvciBlYWNoIGxlZGdlcgogICAgICogQHBhcmFtIGxocwogICAgICog\nICAgICAgICAgICBMaXN0IG9mIExlZGdlckhhbmRsZXMgZm9yIGFsbCBsZWRn\nZXJzIHRvIHdyaXRlIGVudHJpZXMgdG8KICAgICAqIEB0aHJvd3MgQktFeGNl\ncHRpb24KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlRW50cmllc3RvTGVkZ2Vycyhp\nbnQgbnVtRW50cmllcywgbG9uZyBzdGFydEVudHJ5SWQsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8TGVkZ2VySGFuZGxl\nPiBsaHMpCiAgICAgICAgdGhyb3dzIEJLRXhjZXB0aW9uLCBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBs\naHMpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRy\naWVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KCgiTGVk\nZ2VySWQ6ICIgKyBsaC5nZXRJZCgpICsgIiwgRW50cnlJZDogIiArIChzdGFy\ndEVudHJ5SWQgKyBpKSkuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNsb3NlTGVkZ2VycyhM\naXN0PExlZGdlckhhbmRsZT4gbGhzKSB0aHJvd3MgQktFeGNlcHRpb24sIElu\ndGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBmb3IgKExlZGdlckhhbmRs\nZSBsaCA6IGxocykgewogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gdmVy\naWZ5IHRoYXQgd2UgY2FuIHJlYWQgdGhlIHJlY292ZXJlZCBsZWRnZXIgZW50\ncmllcy4KICAgICAqCiAgICAgKiBAcGFyYW0gb2xkTGhzCiAgICAgKiAgICAg\nICAgICAgIE9sZCBMZWRnZXIgSGFuZGxlcwogICAgICogQHBhcmFtIHN0YXJ0\nRW50cnlJZAogICAgICogICAgICAgICAgICBTdGFydCBFbnRyeSBJZCB0byBy\nZWFkCiAgICAgKiBAcGFyYW0gZW5kRW50cnlJZAogICAgICogICAgICAgICAg\nICBFbmQgRW50cnkgSWQgdG8gcmVhZAogICAgICogQHRocm93cyBCS0V4Y2Vw\ndGlvbgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgogICAg\nICovCiAgICBwcml2YXRlIHZvaWQgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhM\naXN0PExlZGdlckhhbmRsZT4gb2xkTGhzLCBsb25nIHN0YXJ0RW50cnlJZCwg\nbG9uZyBlbmRFbnRyeUlkKSB0aHJvd3MgQktFeGNlcHRpb24sCiAgICAgICAg\nSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIC8vIEdldCBhIHNldCBv\nZiBMZWRnZXJIYW5kbGVzIGZvciBhbGwgb2YgdGhlIGxlZGdlcnMgdG8gdmVy\naWZ5CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9IG5ldyBBcnJh\neUxpc3Q8TGVkZ2VySGFuZGxlPigpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgb2xkTGhzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIGxocy5h\nZGQoYmtjLm9wZW5MZWRnZXIob2xkTGhzLmdldChpKS5nZXRJZCgpLCBkaWdl\nc3RUeXBlLCBiYXNlQ2xpZW50Q29uZi5nZXRCb29raWVSZWNvdmVyeVBhc3N3\nZCgpKSk7CiAgICAgICAgfQogICAgICAgIC8vIFJlYWQgdGhlIGxlZGdlciBl\nbnRyaWVzIHRvIHZlcmlmeSB0aGF0IHRoZXkgYXJlIGFsbCBwcmVzZW50IGFu\nZAogICAgICAgIC8vIGNvcnJlY3QgaW4gdGhlIG5ldyBib29raWUuCiAgICAg\nICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMpIHsKICAgICAgICAgICAg\nRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGVudHJpZXMgPSBsaC5yZWFkRW50\ncmllcyhzdGFydEVudHJ5SWQsIGVuZEVudHJ5SWQpOwogICAgICAgICAgICB3\naGlsZSAoZW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAg\nICAgICAgTGVkZ2VyRW50cnkgZW50cnkgPSBlbnRyaWVzLm5leHRFbGVtZW50\nKCk7CiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKG5ldyBTdHJpbmcoZW50\ncnkuZ2V0RW50cnkoKSkuZXF1YWxzKCJMZWRnZXJJZDogIiArIGVudHJ5Lmdl\ndExlZGdlcklkKCkgKyAiLCBFbnRyeUlkOiAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgZW50cnkuZ2V0RW50cnlJZCgpKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgfQoKICAgIC8qKgogICAgICogVGhpcyB0ZXN0\ncyB0aGUgYXN5bmNocm9ub3VzIGJvb2tpZSByZWNvdmVyeSBmdW5jdGlvbmFs\naXR5IGJ5IHdyaXRpbmcKICAgICAqIGVudHJpZXMgaW50byAzIGJvb2tpZXMs\nIGtpbGxpbmcgb25lIGJvb2tpZSwgc3RhcnRpbmcgdXAgYSBuZXcgb25lIHRv\nCiAgICAgKiByZXBsYWNlIGl0LCBhbmQgdGhlbiByZWNvdmVyaW5nIHRoZSBs\nZWRnZXIgZW50cmllcyBmcm9tIHRoZSBraWxsZWQgYm9va2llCiAgICAgKiBv\nbnRvIHRoZSBuZXcgb25lLiBXZSdsbCB2ZXJpZnkgdGhhdCB0aGUgZW50cmll\ncyBzdG9yZWQgb24gdGhlIGtpbGxlZAogICAgICogYm9va2llIGFyZSBwcm9w\nZXJseSBjb3BpZWQgb3ZlciBhbmQgcmVzdG9yZWQgb250byB0aGUgbmV3IG9u\nZS4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEFz\neW5jQm9va2llUmVjb3ZlcnlUb1NwZWNpZmljQm9va2llKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAg\nICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAgICAgIExpc3Q8TGVkZ2VySGFu\nZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMpOwoKICAgICAg\nICAvLyBXcml0ZSB0aGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBk\ndW1teSB2YWx1ZXMuCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAgICAg\nICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAg\nICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAg\nICAgICBMT0cuaW5mbygiRmluaXNoZWQgd3JpdGluZyBhbGwgbGVkZ2VyIGVu\ndHJpZXMgc28gc2h1dGRvd24gb25lIG9mIHRoZSBib29raWVzLiIpOwogICAg\nICAgIGludCBpbml0aWFsUG9ydCA9IGJzQ29uZnMuZ2V0KDApLmdldEJvb2tp\nZVBvcnQoKTsKICAgICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsKICAgICAg\nICBicy5yZW1vdmUoMCk7CgogICAgICAgIC8vIFN0YXJ0dXAgYSBuZXcgYm9v\na2llIHNlcnZlcgogICAgICAgIGludCBuZXdCb29raWVQb3J0ID0gc3RhcnRO\nZXdCb29raWUoKTsKCiAgICAgICAgLy8gV3JpdGUgc29tZSBtb3JlIGVudHJp\nZXMgZm9yIHRoZSBsZWRnZXJzIHNvIGEgbmV3IGVuc2VtYmxlIHdpbGwgYmUK\nICAgICAgICAvLyBjcmVhdGVkIGZvciB0aGVtLgogICAgICAgIHdyaXRlRW50\ncmllc3RvTGVkZ2VycyhudW1Nc2dzLCAxMCwgbGhzKTsKCiAgICAgICAgLy8g\nQ2FsbCB0aGUgYXN5bmMgcmVjb3ZlciBib29raWUgbWV0aG9kLgogICAgICAg\nIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZVNyYyA9IG5ldyBJbmV0U29ja2V0\nQWRkcmVzcyhJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRk\ncmVzcygpLCBpbml0aWFsUG9ydCk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJl\nc3MgYm9va2llRGVzdCA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRk\ncmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBuZXdCb29r\naWVQb3J0KTsKICAgICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRh\ndGEgb24gdGhlIGtpbGxlZCBib29raWUgKCIgKyBib29raWVTcmMgKyAiKSBh\nbmQgcmVwbGljYXRlIGl0IHRvIHRoZSBuZXcgb25lICgiCiAgICAgICAgICAg\nICAgICAgKyBib29raWVEZXN0ICsgIikiKTsKICAgICAgICAvLyBJbml0aWF0\nZSB0aGUgc3luYyBvYmplY3QKICAgICAgICBzeW5jLnZhbHVlID0gZmFsc2U7\nCiAgICAgICAgYmtBZG1pbi5hc3luY1JlY292ZXJCb29raWVEYXRhKGJvb2tp\nZVNyYywgYm9va2llRGVzdCwgYm9va2llUmVjb3ZlckNiLCBzeW5jKTsKCiAg\nICAgICAgLy8gV2FpdCBmb3IgdGhlIGFzeW5jIG1ldGhvZCB0byBjb21wbGV0\nZS4KICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAg\nd2hpbGUgKHN5bmMudmFsdWUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAg\nIHN5bmMud2FpdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2Vy\ndFRydWUoYm9va2llUmVjb3ZlckNiLnN1Y2Nlc3MpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gVmVyaWZ5IHRoZSByZWNvdmVyZWQgbGVkZ2VyIGVudHJpZXMg\nYXJlIG9rYXkuCiAgICAgICAgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaHMs\nIDAsIDIgKiBudW1Nc2dzIC0gMSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\naGlzIHRlc3RzIHRoZSBhc3luY2hyb25vdXMgYm9va2llIHJlY292ZXJ5IGZ1\nbmN0aW9uYWxpdHkgYnkgd3JpdGluZwogICAgICogZW50cmllcyBpbnRvIDMg\nYm9va2llcywga2lsbGluZyBvbmUgYm9va2llLCBzdGFydGluZyB1cCBhIGZl\ndyBuZXcKICAgICAqIGJvb2tpZXMsIGFuZCB0aGVuIHJlY292ZXJpbmcgdGhl\nIGxlZGdlciBlbnRyaWVzIGZyb20gdGhlIGtpbGxlZCBib29raWUKICAgICAq\nIG9udG8gcmFuZG9tIGF2YWlsYWJsZSBib29raWUgc2VydmVycy4gV2UnbGwg\ndmVyaWZ5IHRoYXQgdGhlIGVudHJpZXMKICAgICAqIHN0b3JlZCBvbiB0aGUg\na2lsbGVkIGJvb2tpZSBhcmUgcHJvcGVybHkgY29waWVkIG92ZXIgYW5kIHJl\nc3RvcmVkIG9udG8KICAgICAqIHRoZSBvdGhlciBib29raWVzLgogICAgICoK\nICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRp\nbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0QXN5bmNCb29raWVS\nZWNvdmVyeVRvUmFuZG9tQm9va2llcygpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIC8vIENyZWF0ZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBudW1M\nZWRnZXJzID0gMzsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzID0g\nY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJzKTsKCiAgICAgICAgLy8gV3JpdGUg\ndGhlIGVudHJpZXMgZm9yIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFsdWVz\nLgogICAgICAgIGludCBudW1Nc2dzID0gMTA7CiAgICAgICAgd3JpdGVFbnRy\naWVzdG9MZWRnZXJzKG51bU1zZ3MsIDAsIGxocyk7CgogICAgICAgIC8vIFNo\ndXRkb3duIHRoZSBmaXJzdCBib29raWUgc2VydmVyCiAgICAgICAgTE9HLmlu\nZm8oIkZpbmlzaGVkIHdyaXRpbmcgYWxsIGxlZGdlciBlbnRyaWVzIHNvIHNo\ndXRkb3duIG9uZSBvZiB0aGUgYm9va2llcy4iKTsKICAgICAgICBpbnQgaW5p\ndGlhbFBvcnQgPSBic0NvbmZzLmdldCgwKS5nZXRCb29raWVQb3J0KCk7CiAg\nICAgICAgYnMuZ2V0KDApLnNodXRkb3duKCk7CiAgICAgICAgYnMucmVtb3Zl\nKDApOwoKICAgICAgICAvLyBTdGFydHVwIHRocmVlIG5ldyBib29raWUgc2Vy\ndmVycwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAg\nICAgICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMg\nc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBiZQogICAgICAgIC8vIGNyZWF0ZWQg\nZm9yIHRoZW0uCiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1z\nZ3MsIDEwLCBsaHMpOwoKICAgICAgICAvLyBDYWxsIHRoZSBhc3luYyByZWNv\ndmVyIGJvb2tpZSBtZXRob2QuCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3Mg\nYm9va2llU3JjID0gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNz\nLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIGluaXRpYWxQb3J0\nKTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVEZXN0ID0gbnVs\nbDsKICAgICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24g\ndGhlIGtpbGxlZCBib29raWUgKCIgKyBib29raWVTcmMKICAgICAgICAgICAg\nICAgICArICIpIGFuZCByZXBsaWNhdGUgaXQgdG8gYSByYW5kb20gYXZhaWxh\nYmxlIG9uZSIpOwogICAgICAgIC8vIEluaXRpYXRlIHRoZSBzeW5jIG9iamVj\ndAogICAgICAgIHN5bmMudmFsdWUgPSBmYWxzZTsKICAgICAgICBia0FkbWlu\nLmFzeW5jUmVjb3ZlckJvb2tpZURhdGEoYm9va2llU3JjLCBib29raWVEZXN0\nLCBib29raWVSZWNvdmVyQ2IsIHN5bmMpOwoKICAgICAgICAvLyBXYWl0IGZv\nciB0aGUgYXN5bmMgbWV0aG9kIHRvIGNvbXBsZXRlLgogICAgICAgIHN5bmNo\ncm9uaXplZCAoc3luYykgewogICAgICAgICAgICB3aGlsZSAoc3luYy52YWx1\nZSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgc3luYy53YWl0KCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0VHJ1ZShib29raWVSZWNv\ndmVyQ2Iuc3VjY2Vzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBWZXJpZnkg\ndGhlIHJlY292ZXJlZCBsZWRnZXIgZW50cmllcyBhcmUgb2theS4KICAgICAg\nICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxocywgMCwgMiAqIG51bU1zZ3Mg\nLSAxKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgdGVzdHMgdGhlIHN5\nbmNocm9ub3VzIGJvb2tpZSByZWNvdmVyeSBmdW5jdGlvbmFsaXR5IGJ5IHdy\naXRpbmcKICAgICAqIGVudHJpZXMgaW50byAzIGJvb2tpZXMsIGtpbGxpbmcg\nb25lIGJvb2tpZSwgc3RhcnRpbmcgdXAgYSBuZXcgb25lIHRvCiAgICAgKiBy\nZXBsYWNlIGl0LCBhbmQgdGhlbiByZWNvdmVyaW5nIHRoZSBsZWRnZXIgZW50\ncmllcyBmcm9tIHRoZSBraWxsZWQgYm9va2llCiAgICAgKiBvbnRvIHRoZSBu\nZXcgb25lLiBXZSdsbCB2ZXJpZnkgdGhhdCB0aGUgZW50cmllcyBzdG9yZWQg\nb24gdGhlIGtpbGxlZAogICAgICogYm9va2llIGFyZSBwcm9wZXJseSBjb3Bp\nZWQgb3ZlciBhbmQgcmVzdG9yZWQgb250byB0aGUgbmV3IG9uZS4KICAgICAq\nCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBAVGVzdCh0\naW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN5bmNCb29raWVS\nZWNvdmVyeVRvU3BlY2lmaWNCb29raWUoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAgICAgICBpbnQgbnVt\nTGVkZ2VycyA9IDM7CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9\nIGNyZWF0ZUxlZGdlcnMobnVtTGVkZ2Vycyk7CgogICAgICAgIC8vIFdyaXRl\nIHRoZSBlbnRyaWVzIGZvciB0aGUgbGVkZ2VycyB3aXRoIGR1bW15IHZhbHVl\ncy4KICAgICAgICBpbnQgbnVtTXNncyA9IDEwOwogICAgICAgIHdyaXRlRW50\ncmllc3RvTGVkZ2VycyhudW1Nc2dzLCAwLCBsaHMpOwoKICAgICAgICAvLyBT\naHV0ZG93biB0aGUgZmlyc3QgYm9va2llIHNlcnZlcgogICAgICAgIExPRy5p\nbmZvKCJGaW5pc2hlZCB3cml0aW5nIGFsbCBsZWRnZXIgZW50cmllcyBzbyBz\naHV0ZG93biBvbmUgb2YgdGhlIGJvb2tpZXMuIik7CiAgICAgICAgaW50IGlu\naXRpYWxQb3J0ID0gYnNDb25mcy5nZXQoMCkuZ2V0Qm9va2llUG9ydCgpOwog\nICAgICAgIGJzLmdldCgwKS5zaHV0ZG93bigpOwogICAgICAgIGJzLnJlbW92\nZSgwKTsKCiAgICAgICAgLy8gU3RhcnR1cCBhIG5ldyBib29raWUgc2VydmVy\nCiAgICAgICAgaW50IG5ld0Jvb2tpZVBvcnQgPSBzdGFydE5ld0Jvb2tpZSgp\nOwoKICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcyBmb3IgdGhl\nIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBiZQogICAgICAgIC8v\nIGNyZWF0ZWQgZm9yIHRoZW0uCiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRn\nZXJzKG51bU1zZ3MsIDEwLCBsaHMpOwoKICAgICAgICAvLyBDYWxsIHRoZSBz\neW5jIHJlY292ZXIgYm9va2llIG1ldGhvZC4KICAgICAgICBJbmV0U29ja2V0\nQWRkcmVzcyBib29raWVTcmMgPSBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5l\ndEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgaW5p\ndGlhbFBvcnQpOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZURl\nc3QgPSBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MuZ2V0TG9j\nYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgbmV3Qm9va2llUG9ydCk7CiAg\nICAgICAgTE9HLmluZm8oIk5vdyByZWNvdmVyIHRoZSBkYXRhIG9uIHRoZSBr\naWxsZWQgYm9va2llICgiICsgYm9va2llU3JjICsgIikgYW5kIHJlcGxpY2F0\nZSBpdCB0byB0aGUgbmV3IG9uZSAoIgogICAgICAgICAgICAgICAgICsgYm9v\na2llRGVzdCArICIpIik7CiAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9va2ll\nRGF0YShib29raWVTcmMsIGJvb2tpZURlc3QpOwoKICAgICAgICAvLyBWZXJp\nZnkgdGhlIHJlY292ZXJlZCBsZWRnZXIgZW50cmllcyBhcmUgb2theS4KICAg\nICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxocywgMCwgMiAqIG51bU1z\nZ3MgLSAxKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgdGVzdHMgdGhl\nIHN5bmNocm9ub3VzIGJvb2tpZSByZWNvdmVyeSBmdW5jdGlvbmFsaXR5IGJ5\nIHdyaXRpbmcKICAgICAqIGVudHJpZXMgaW50byAzIGJvb2tpZXMsIGtpbGxp\nbmcgb25lIGJvb2tpZSwgc3RhcnRpbmcgdXAgYSBmZXcgbmV3CiAgICAgKiBi\nb29raWVzLCBhbmQgdGhlbiByZWNvdmVyaW5nIHRoZSBsZWRnZXIgZW50cmll\ncyBmcm9tIHRoZSBraWxsZWQgYm9va2llCiAgICAgKiBvbnRvIHJhbmRvbSBh\ndmFpbGFibGUgYm9va2llIHNlcnZlcnMuIFdlJ2xsIHZlcmlmeSB0aGF0IHRo\nZSBlbnRyaWVzCiAgICAgKiBzdG9yZWQgb24gdGhlIGtpbGxlZCBib29raWUg\nYXJlIHByb3Blcmx5IGNvcGllZCBvdmVyIGFuZCByZXN0b3JlZCBvbnRvCiAg\nICAgKiB0aGUgb3RoZXIgYm9va2llcy4KICAgICAqCiAgICAgKiBAdGhyb3dz\nIEV4Y2VwdGlvbgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdFN5bmNCb29raWVSZWNvdmVyeVRvUmFuZG9t\nQm9va2llcygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIENyZWF0\nZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBudW1MZWRnZXJzID0gMzsKICAg\nICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzID0gY3JlYXRlTGVkZ2Vycyhu\ndW1MZWRnZXJzKTsKCiAgICAgICAgLy8gV3JpdGUgdGhlIGVudHJpZXMgZm9y\nIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFsdWVzLgogICAgICAgIGludCBu\ndW1Nc2dzID0gMTA7CiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51\nbU1zZ3MsIDAsIGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJz\ndCBib29raWUgc2VydmVyCiAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIHdy\naXRpbmcgYWxsIGxlZGdlciBlbnRyaWVzIHNvIHNodXRkb3duIG9uZSBvZiB0\naGUgYm9va2llcy4iKTsKICAgICAgICBpbnQgaW5pdGlhbFBvcnQgPSBic0Nv\nbmZzLmdldCgwKS5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgYnMuZ2V0KDAp\nLnNodXRkb3duKCk7CiAgICAgICAgYnMucmVtb3ZlKDApOwoKICAgICAgICAv\nLyBTdGFydHVwIHRocmVlIG5ldyBib29raWUgc2VydmVycwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgICAgIHN0YXJ0\nTmV3Qm9va2llKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBXcml0ZSBzb21l\nIG1vcmUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1i\nbGUgd2lsbCBiZQogICAgICAgIC8vIGNyZWF0ZWQgZm9yIHRoZW0uCiAgICAg\nICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDEwLCBsaHMpOwoK\nICAgICAgICAvLyBDYWxsIHRoZSBzeW5jIHJlY292ZXIgYm9va2llIG1ldGhv\nZC4KICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVTcmMgPSBuZXcg\nSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCku\nZ2V0SG9zdEFkZHJlc3MoKSwgaW5pdGlhbFBvcnQpOwogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIGJvb2tpZURlc3QgPSBudWxsOwogICAgICAgIExPRy5p\nbmZvKCJOb3cgcmVjb3ZlciB0aGUgZGF0YSBvbiB0aGUga2lsbGVkIGJvb2tp\nZSAoIiArIGJvb2tpZVNyYwogICAgICAgICAgICAgICAgICsgIikgYW5kIHJl\ncGxpY2F0ZSBpdCB0byBhIHJhbmRvbSBhdmFpbGFibGUgb25lIik7CiAgICAg\nICAgYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIGJvb2tp\nZURlc3QpOwoKICAgICAgICAvLyBWZXJpZnkgdGhlIHJlY292ZXJlZCBsZWRn\nZXIgZW50cmllcyBhcmUgb2theS4KICAgICAgICB2ZXJpZnlSZWNvdmVyZWRM\nZWRnZXJzKGxocywgMCwgMiAqIG51bU1zZ3MgLSAxKTsKICAgIH0KCiAgICBw\ncml2YXRlIHN0YXRpYyBjbGFzcyBSZXBsaWNhdGlvblZlcmlmaWNhdGlvbkNh\nbGxiYWNrIGltcGxlbWVudHMgUmVhZEVudHJ5Q2FsbGJhY2sgewogICAgICAg\nIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNoOwogICAgICAgIGZpbmFsIEF0\nb21pY0xvbmcgbnVtU3VjY2VzczsKCiAgICAgICAgUmVwbGljYXRpb25WZXJp\nZmljYXRpb25DYWxsYmFjayhpbnQgbnVtUmVxdWVzdHMpIHsKICAgICAgICAg\nICAgbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2gobnVtUmVxdWVzdHMpOwog\nICAgICAgICAgICBudW1TdWNjZXNzID0gbmV3IEF0b21pY0xvbmcoMCk7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9p\nZCByZWFkRW50cnlDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxv\nbmcgZW50cnlJZCwgQ2hhbm5lbEJ1ZmZlciBidWZmZXIsIE9iamVjdCBjdHgp\nIHsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBhZGRyID0gKEluZXRT\nb2NrZXRBZGRyZXNzKWN0eDsKICAgICAgICAgICAgICAgIExPRy5kZWJ1Zygi\nR290ICIgKyByYyArICIgZm9yIGxlZGdlciAiICsgbGVkZ2VySWQgKyAiIGVu\ndHJ5ICIgKyBlbnRyeUlkICsgIiBmcm9tICIgKyBjdHgpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk9L\nKSB7CiAgICAgICAgICAgICAgICBudW1TdWNjZXNzLmluY3JlbWVudEFuZEdl\ndCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxhdGNoLmNvdW50RG93\nbigpOwogICAgICAgIH0KCiAgICAgICAgbG9uZyBhd2FpdCgpIHRocm93cyBJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChsYXRjaC5h\nd2FpdCg2MCwgVGltZVVuaXQuU0VDT05EUykgPT0gZmFsc2UpIHsKICAgICAg\nICAgICAgICAgIExPRy53YXJuKCJEaWRuJ3QgZ2V0IGFsbCByZXNwb25zZXMg\naW4gdmVyaWZpY2F0aW9uIik7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBu\ndW1TdWNjZXNzLmdldCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgYm9vbGVhbiB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQo\nTGVkZ2VySGFuZGxlIGxoLCBsb25nIHVudGlsRW50cnkpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIExlZGdlck1ldGFkYXRhIG1kID0gZ2V0TGVkZ2Vy\nTWV0YWRhdGEobGgpOwoKICAgICAgICBNYXA8TG9uZywgQXJyYXlMaXN0PElu\nZXRTb2NrZXRBZGRyZXNzPj4gZW5zZW1ibGVzID0gbWQuZ2V0RW5zZW1ibGVz\nKCk7CgogICAgICAgIEhhc2hNYXA8TG9uZywgTG9uZz4gcmFuZ2VzID0gbmV3\nIEhhc2hNYXA8TG9uZywgTG9uZz4oKTsKICAgICAgICBBcnJheUxpc3Q8TG9u\nZz4ga2V5TGlzdCA9IENvbGxlY3Rpb25zLmxpc3QoCiAgICAgICAgICAgICAg\nICBDb2xsZWN0aW9ucy5lbnVtZXJhdGlvbihlbnNlbWJsZXMua2V5U2V0KCkp\nKTsKICAgICAgICBDb2xsZWN0aW9ucy5zb3J0KGtleUxpc3QpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwga2V5TGlzdC5zaXplKCkgLSAxOyBpKysp\nIHsKICAgICAgICAgICAgcmFuZ2VzLnB1dChrZXlMaXN0LmdldChpKSwga2V5\nTGlzdC5nZXQoaSsxKSk7CiAgICAgICAgfQogICAgICAgIHJhbmdlcy5wdXQo\na2V5TGlzdC5nZXQoa2V5TGlzdC5zaXplKCktMSksIHVudGlsRW50cnkpOwoK\nICAgICAgICBmb3IgKE1hcC5FbnRyeTxMb25nLCBBcnJheUxpc3Q8SW5ldFNv\nY2tldEFkZHJlc3M+PiBlIDogZW5zZW1ibGVzLmVudHJ5U2V0KCkpIHsKICAg\nICAgICAgICAgaW50IHF1b3J1bSA9IG1kLmdldEFja1F1b3J1bVNpemUoKTsK\nICAgICAgICAgICAgbG9uZyBzdGFydEVudHJ5SWQgPSBlLmdldEtleSgpOwog\nICAgICAgICAgICBsb25nIGVuZEVudHJ5SWQgPSByYW5nZXMuZ2V0KHN0YXJ0\nRW50cnlJZCk7CiAgICAgICAgICAgIGxvbmcgZXhwZWN0ZWRTdWNjZXNzID0g\ncXVvcnVtKihlbmRFbnRyeUlkLXN0YXJ0RW50cnlJZCk7CiAgICAgICAgICAg\nIGludCBudW1SZXF1ZXN0cyA9IGUuZ2V0VmFsdWUoKS5zaXplKCkqKChpbnQp\nKGVuZEVudHJ5SWQtc3RhcnRFbnRyeUlkKSk7CgogICAgICAgICAgICBSZXBs\naWNhdGlvblZlcmlmaWNhdGlvbkNhbGxiYWNrIGNiID0gbmV3IFJlcGxpY2F0\naW9uVmVyaWZpY2F0aW9uQ2FsbGJhY2sobnVtUmVxdWVzdHMpOwogICAgICAg\nICAgICBmb3IgKGxvbmcgaSA9IHN0YXJ0RW50cnlJZDsgaSA8IGVuZEVudHJ5\nSWQ7IGkrKykgewogICAgICAgICAgICAgICAgZm9yIChJbmV0U29ja2V0QWRk\ncmVzcyBhZGRyIDogZS5nZXRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgYmtjLmJvb2tpZUNsaWVudC5yZWFkRW50cnkoYWRkciwgbGguZ2V0SWQo\nKSwgaSwgY2IsIGFkZHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICBsb25nIG51bVN1Y2Nlc3MgPSBjYi5hd2FpdCgp\nOwogICAgICAgICAgICBpZiAobnVtU3VjY2VzcyA8IGV4cGVjdGVkU3VjY2Vz\ncykgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIkZyYWdtZW50IG5vdCBm\ndWxseSByZXBsaWNhdGVkIGxlZGdlcklkID0gIiArIGxoLmdldElkKCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICsgIiBzdGFydEVudHJ5SWQgPSAiICsg\nc3RhcnRFbnRyeUlkCiAgICAgICAgICAgICAgICAgICAgICAgICArICIgZW5k\nRW50cnlJZCA9ICIgKyBlbmRFbnRyeUlkCiAgICAgICAgICAgICAgICAgICAg\nICAgICArICIgZXhwZWN0ZWRTdWNjZXNzID0gIiArIGV4cGVjdGVkU3VjY2Vz\ncwogICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGdvdFN1Y2Nlc3MgPSAi\nICsgbnVtU3VjY2Vzcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgLy8gT2JqZWN0IHVzZWQgZm9yIHN5bmNocm9uaXppbmcg\nYXN5bmMgbWV0aG9kIGNhbGxzCiAgICBjbGFzcyBTeW5jTGVkZ2VyTWV0YU9i\namVjdCB7CiAgICAgICAgYm9vbGVhbiB2YWx1ZTsKICAgICAgICBpbnQgcmM7\nCiAgICAgICAgTGVkZ2VyTWV0YWRhdGEgbWV0YTsKCiAgICAgICAgcHVibGlj\nIFN5bmNMZWRnZXJNZXRhT2JqZWN0KCkgewogICAgICAgICAgICB2YWx1ZSA9\nIGZhbHNlOwogICAgICAgICAgICBtZXRhID0gbnVsbDsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBMZWRnZXJNZXRhZGF0YSBnZXRMZWRnZXJNZXRh\nZGF0YShMZWRnZXJIYW5kbGUgbGgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGZpbmFsIFN5bmNMZWRnZXJNZXRhT2JqZWN0IHN5bmNPYmogPSBuZXcg\nU3luY0xlZGdlck1ldGFPYmplY3QoKTsKICAgICAgICBia2MuZ2V0TGVkZ2Vy\nTWFuYWdlcigpLnJlYWRMZWRnZXJNZXRhZGF0YShsaC5nZXRJZCgpLCBuZXcg\nR2VuZXJpY0NhbGxiYWNrPExlZGdlck1ldGFkYXRhPigpIHsKCiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRp\nb25Db21wbGV0ZShpbnQgcmMsIExlZGdlck1ldGFkYXRhIHJlc3VsdCkgewog\nICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5jT2JqKSB7CiAgICAg\nICAgICAgICAgICAgICAgc3luY09iai5yYyA9IHJjOwogICAgICAgICAgICAg\nICAgICAgIHN5bmNPYmoubWV0YSA9IHJlc3VsdDsKICAgICAgICAgICAgICAg\nICAgICBzeW5jT2JqLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAg\nICBzeW5jT2JqLm5vdGlmeSgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgIH0pOwoKICAgICAgICBzeW5jaHJvbml6ZWQgKHN5\nbmNPYmopIHsKICAgICAgICAgICAgd2hpbGUgKHN5bmNPYmoudmFsdWUgPT0g\nZmFsc2UpIHsKICAgICAgICAgICAgICAgIHN5bmNPYmoud2FpdCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGFzc2VydEVxdWFscyhCS0V4\nY2VwdGlvbi5Db2RlLk9LLCBzeW5jT2JqLnJjKTsKICAgICAgICByZXR1cm4g\nc3luY09iai5tZXRhOwogICAgfQoKICAgIHByaXZhdGUgYm9vbGVhbiBmaW5k\nRHVwZXNJbkVuc2VtYmxlcyhMaXN0PExlZGdlckhhbmRsZT4gbGhzKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb25nIG51bUR1cGVzID0gMDsKICAg\nICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6IGxocykgewogICAgICAgICAg\nICBMZWRnZXJNZXRhZGF0YSBtZCA9IGdldExlZGdlck1ldGFkYXRhKGxoKTsK\nICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8TG9uZywgQXJyYXlMaXN0PElu\nZXRTb2NrZXRBZGRyZXNzPj4gZSA6IG1kLmdldEVuc2VtYmxlcygpLmVudHJ5\nU2V0KCkpIHsKICAgICAgICAgICAgICAgIEhhc2hTZXQ8SW5ldFNvY2tldEFk\nZHJlc3M+IHNldCA9IG5ldyBIYXNoU2V0PEluZXRTb2NrZXRBZGRyZXNzPigp\nOwogICAgICAgICAgICAgICAgbG9uZyBmcmFnbWVudCA9IGUuZ2V0S2V5KCk7\nCgogICAgICAgICAgICAgICAgZm9yIChJbmV0U29ja2V0QWRkcmVzcyBhZGRy\nIDogZS5nZXRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNl\ndC5jb250YWlucyhhZGRyKSkgewogICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkR1cGUgIiArIGFkZHIgKyAiIGZvdW5kIGluIGVuc2VtYmxl\nIGZvciBmcmFnbWVudCAiICsgZnJhZ21lbnQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArICIgb2YgbGVkZ2VyICIgKyBsaC5nZXRJZCgpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgbnVtRHVwZXMrKzsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0LmFkZChhZGRy\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICByZXR1cm4gbnVtRHVwZXMgPiAwOwogICAgfQoKICAgIC8qKgog\nICAgICogVGVzdCByZWNvdmVyeWluZyB0aGUgY2xvc2VkIGxlZGdlcnMgd2hl\nbiB0aGUgZmFpbGVkIGJvb2tpZSBzZXJ2ZXIgaXMgaW4gdGhlIGxhc3QgZW5z\nZW1ibGUKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RCb29raWVSZWNvdmVyeU9uQ2xvc2VkTGVkZ2Vycygp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIENyZWF0ZSB0aGUgbGVk\nZ2VycwogICAgICAgIGludCBudW1MZWRnZXJzID0gMzsKICAgICAgICBMaXN0\nPExlZGdlckhhbmRsZT4gbGhzID0gY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJz\nLCBudW1Cb29raWVzLCAyKTsKCiAgICAgICAgLy8gV3JpdGUgdGhlIGVudHJp\nZXMgZm9yIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFsdWVzCiAgICAgICAg\naW50IG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdl\ncnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgY2xvc2VMZWRnZXJzKGxo\ncyk7CgogICAgICAgIC8vIFNodXRkb3duIGxhc3QgYm9va2llIHNlcnZlciBp\nbiBsYXN0IGVuc2VtYmxlCiAgICAgICAgQXJyYXlMaXN0PEluZXRTb2NrZXRB\nZGRyZXNzPiBsYXN0RW5zZW1ibGUgPSBsaHMuZ2V0KDApLmdldExlZGdlck1l\ndGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5lbnRyeVNldCgp\nLml0ZXJhdG9yKCkubmV4dCgpLmdldFZhbHVlKCk7CiAgICAgICAgSW5ldFNv\nY2tldEFkZHJlc3MgYm9va2llVG9LaWxsID0gbGFzdEVuc2VtYmxlLmdldChs\nYXN0RW5zZW1ibGUuc2l6ZSgpIC0gMSk7CiAgICAgICAga2lsbEJvb2tpZShi\nb29raWVUb0tpbGwpOwoKICAgICAgICAvLyBzdGFydCBhIG5ldyBib29raWUK\nICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICBJbmV0U29ja2V0\nQWRkcmVzcyBib29raWVEZXN0ID0gbnVsbDsKICAgICAgICBMT0cuaW5mbygi\nTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtpbGxlZCBib29raWUgKCIg\nKyBib29raWVUb0tpbGwKICAgICAgICAgICAgICAgKyAiKSBhbmQgcmVwbGlj\nYXRlIGl0IHRvIGEgcmFuZG9tIGF2YWlsYWJsZSBvbmUiKTsKCiAgICAgICAg\nYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29raWVUb0tpbGwsIGJvb2tp\nZURlc3QpOwogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGhzKSB7\nCiAgICAgICAgICAgIGFzc2VydFRydWUoIk5vdCBmdWxseSByZXBsaWNhdGVk\nIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCBudW1Nc2dzKSk7CiAgICAg\nICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0\nKHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0Qm9va2llUmVj\nb3ZlcnlPbk9wZW5lZExlZGdlcnMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAgICAgICBpbnQgbnVtTGVk\nZ2VycyA9IDM7CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9IGNy\nZWF0ZUxlZGdlcnMobnVtTGVkZ2VycywgbnVtQm9va2llcywgMik7CgogICAg\nICAgIC8vIFdyaXRlIHRoZSBlbnRyaWVzIGZvciB0aGUgbGVkZ2VycyB3aXRo\nIGR1bW15IHZhbHVlcwogICAgICAgIGludCBudW1Nc2dzID0gMTA7CiAgICAg\nICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDAsIGxocyk7Cgog\nICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJzdCBib29raWUgc2VydmVyCiAg\nICAgICAgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPiBsYXN0RW5zZW1i\nbGUgPSBsaHMuZ2V0KDApLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1i\nbGVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC5lbnRyeVNldCgpLml0ZXJhdG9yKCkubmV4dCgp\nLmdldFZhbHVlKCk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2ll\nVG9LaWxsID0gbGFzdEVuc2VtYmxlLmdldChsYXN0RW5zZW1ibGUuc2l6ZSgp\nIC0gMSk7CiAgICAgICAga2lsbEJvb2tpZShib29raWVUb0tpbGwpOwoKICAg\nICAgICAvLyBzdGFydCBhIG5ldyBib29raWUKICAgICAgICBzdGFydE5ld0Jv\nb2tpZSgpOwoKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVEZXN0\nID0gbnVsbDsKICAgICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRh\ndGEgb24gdGhlIGtpbGxlZCBib29raWUgKCIgKyBib29raWVUb0tpbGwKICAg\nICAgICAgICAgICAgKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIGEgcmFuZG9t\nIGF2YWlsYWJsZSBvbmUiKTsKCiAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9v\na2llRGF0YShib29raWVUb0tpbGwsIGJvb2tpZURlc3QpOwoKICAgICAgICBm\nb3IgKExlZGdlckhhbmRsZSBsaCA6IGxocykgewogICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJOb3QgZnVsbHkgcmVwbGljYXRlZCIsIHZlcmlmeUZ1bGx5UmVw\nbGljYXRlZChsaCwgbnVtTXNncykpOwogICAgICAgIH0KCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gd2UgY2FuJ3Qgd3JpdGUgZW50cmllcwogICAg\nICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhz\nKTsKICAgICAgICAgICAgZmFpbCgic2hvdWxkIG5vdCByZWFjaCBoZXJlIik7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICB9CiAg\nICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RCb29raWVSZWNvdmVyeU9uSW5SZWNvdmVyeUxlZGdlcigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIGludCBudW1Nc2dzID0gMTA7CiAgICAg\nICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAgICAgaW50IG51bUxlZGdl\ncnMgPSAxOwogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBjcmVh\ndGVMZWRnZXJzKG51bUxlZGdlcnMsIDIsIDIpOwoKICAgICAgICAvLyBXcml0\nZSB0aGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1\nZXMKICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwg\nbGhzKTsKCiAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBz\nZXJ2ZXIKICAgICAgICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGxh\nc3RFbnNlbWJsZSA9IGxocy5nZXQoMCkuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5n\nZXRFbnNlbWJsZXMoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLmVudHJ5U2V0KCkuaXRlcmF0b3Io\nKS5uZXh0KCkuZ2V0VmFsdWUoKTsKICAgICAgICAvLyByZW1vdmVkIGJvb2tp\nZQogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZVRvS2lsbCA9IGxh\nc3RFbnNlbWJsZS5nZXQoMCk7CiAgICAgICAga2lsbEJvb2tpZShib29raWVU\nb0tpbGwpOwogICAgICAgIC8vIHRlbXAgZmFpbHVyZQogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIGJvb2tpZVRvS2lsbDIgPSBsYXN0RW5zZW1ibGUuZ2V0\nKDEpOwogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjIgPSBraWxs\nQm9va2llKGJvb2tpZVRvS2lsbDIpOwoKICAgICAgICAvLyBzdGFydCBhIG5l\ndyBib29raWUKICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICAv\nLyBvcGVuIHRoZXNlIGxlZGdlcnMKICAgICAgICBmb3IgKExlZGdlckhhbmRs\nZSBvbGRMaCA6IGxocykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgYmtjLm9wZW5MZWRnZXIob2xkTGguZ2V0SWQoKSwgZGlnZXN0VHlw\nZSwgYmFzZUNsaWVudENvbmYuZ2V0Qm9va2llUmVjb3ZlcnlQYXNzd2QoKSk7\nCiAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGQgaGF2ZSB0aHJvd24gZXhj\nZXB0aW9uIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tpZURhdGEoYm9va2llVG9LaWxs\nLCBudWxsKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGhhdmUgdGhyb3du\nIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJL\nTGVkZ2VyUmVjb3ZlcnlFeGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgIC8v\nIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQoKICAgICAgICAvLyByZXN0\nYXJ0IGZhaWxlZCBib29raWUKICAgICAgICBicy5hZGQoc3RhcnRCb29raWUo\nY29uZjIpKTsKICAgICAgICBic0NvbmZzLmFkZChjb25mMik7CgogICAgICAg\nIC8vIHJlY292ZXIgdGhlbQogICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tp\nZURhdGEoYm9va2llVG9LaWxsLCBudWxsKTsKCiAgICAgICAgZm9yIChMZWRn\nZXJIYW5kbGUgbGggOiBsaHMpIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgi\nTm90IGZ1bGx5IHJlcGxpY2F0ZWQiLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQo\nbGgsIG51bU1zZ3MpKTsKICAgICAgICB9CgogICAgICAgIC8vIG9wZW4gbGVk\nZ2VycyB0byByZWFkIG1ldGFkYXRhCiAgICAgICAgTGlzdDxMZWRnZXJIYW5k\nbGU+IG5ld0xocyA9IG9wZW5MZWRnZXJzKGxocyk7CiAgICAgICAgZm9yIChM\nZWRnZXJIYW5kbGUgbmV3TGggOiBuZXdMaHMpIHsKICAgICAgICAgICAgLy8g\nZmlyc3QgZW5zZW1ibGUgc2hvdWxkIGNvbnRhaW5zIGJvb2tpZVRvS2lsbDIg\nYW5kIG5vdCBjb250YWluIGJvb2tpZVRvS2lsbAogICAgICAgICAgICBNYXAu\nRW50cnk8TG9uZywgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPj4gZW50\ncnkgPQogICAgICAgICAgICAgICAgbmV3TGguZ2V0TGVkZ2VyTWV0YWRhdGEo\nKS5nZXRFbnNlbWJsZXMoKS5lbnRyeVNldCgpLml0ZXJhdG9yKCkubmV4dCgp\nOwogICAgICAgICAgICBhc3NlcnRGYWxzZShlbnRyeS5nZXRWYWx1ZSgpLmNv\nbnRhaW5zKGJvb2tpZVRvS2lsbCkpOwogICAgICAgICAgICBhc3NlcnRUcnVl\nKGVudHJ5LmdldFZhbHVlKCkuY29udGFpbnMoYm9va2llVG9LaWxsMikpOwog\nICAgICAgIH0KCiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RBc3luY0Jvb2tpZVJlY292ZXJ5VG9SYW5kb21C\nb29raWVzTm90RW5vdWdoQm9va2llcygpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIC8vIENyZWF0ZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBudW1M\nZWRnZXJzID0gMzsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzID0g\nY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJzLCBudW1Cb29raWVzLCAyKTsKCiAg\nICAgICAgLy8gV3JpdGUgdGhlIGVudHJpZXMgZm9yIHRoZSBsZWRnZXJzIHdp\ndGggZHVtbXkgdmFsdWVzLgogICAgICAgIGludCBudW1Nc2dzID0gMTA7CiAg\nICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDAsIGxocyk7\nCgogICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJzdCBib29raWUgc2VydmVy\nCiAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIHdyaXRpbmcgYWxsIGxlZGdl\nciBlbnRyaWVzIHNvIHNodXRkb3duIG9uZSBvZiB0aGUgYm9va2llcy4iKTsK\nICAgICAgICBpbnQgaW5pdGlhbFBvcnQgPSBic0NvbmZzLmdldCgwKS5nZXRC\nb29raWVQb3J0KCk7CiAgICAgICAgYnMuZ2V0KDApLnNodXRkb3duKCk7CiAg\nICAgICAgYnMucmVtb3ZlKDApOwoKICAgICAgICAvLyBDYWxsIHRoZSBhc3lu\nYyByZWNvdmVyIGJvb2tpZSBtZXRob2QuCiAgICAgICAgSW5ldFNvY2tldEFk\nZHJlc3MgYm9va2llU3JjID0gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRB\nZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIGluaXRp\nYWxQb3J0KTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVEZXN0\nID0gbnVsbDsKICAgICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRh\ndGEgb24gdGhlIGtpbGxlZCBib29raWUgKCIgKyBib29raWVTcmMKICAgICAg\nICAgICAgICAgICArICIpIGFuZCByZXBsaWNhdGUgaXQgdG8gYSByYW5kb20g\nYXZhaWxhYmxlIG9uZSIpOwogICAgICAgIC8vIEluaXRpYXRlIHRoZSBzeW5j\nIG9iamVjdAogICAgICAgIHN5bmMudmFsdWUgPSBmYWxzZTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBia0FkbWluLnJlY292ZXJCb29raWVEYXRhKGJv\nb2tpZVNyYywgbnVsbCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBoYXZl\nIHRocm93biBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2Vw\ndGlvbi5CS0xlZGdlclJlY292ZXJ5RXhjZXB0aW9uIGJrZSkgewogICAgICAg\nICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgIH0KCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN5\nbmNCb29raWVSZWNvdmVyeVRvUmFuZG9tQm9va2llc0NoZWNrRm9yRHVwZXMo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBSYW5kb20gciA9IG5ldyBS\nYW5kb20oKTsKCiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAg\nICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAgICAgIExpc3Q8TGVkZ2VySGFu\nZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMsIG51bUJvb2tp\nZXMsIDIpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmllcyBmb3IgdGhl\nIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMuCiAgICAgICAgaW50IG51bU1z\nZ3MgPSAxMDsKICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNn\ncywgMCwgbGhzKTsKCiAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJv\nb2tpZSBzZXJ2ZXIKICAgICAgICBMT0cuaW5mbygiRmluaXNoZWQgd3JpdGlu\nZyBhbGwgbGVkZ2VyIGVudHJpZXMgc28gc2h1dGRvd24gb25lIG9mIHRoZSBi\nb29raWVzLiIpOwogICAgICAgIGludCByZW1vdmVJbmRleCA9IHIubmV4dElu\ndChicy5zaXplKCkpOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tp\nZVNyYyA9IGJzLmdldChyZW1vdmVJbmRleCkuZ2V0TG9jYWxBZGRyZXNzKCk7\nCiAgICAgICAgYnMuZ2V0KHJlbW92ZUluZGV4KS5zaHV0ZG93bigpOwogICAg\nICAgIGJzLnJlbW92ZShyZW1vdmVJbmRleCk7CgogICAgICAgIC8vIFN0YXJ0\ndXAgbmV3IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBzdGFydE5ld0Jvb2tpZSgp\nOwoKICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcyBmb3IgdGhl\nIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBiZQogICAgICAgIC8v\nIGNyZWF0ZWQgZm9yIHRoZW0uCiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRn\nZXJzKG51bU1zZ3MsIG51bU1zZ3MsIGxocyk7CgogICAgICAgIC8vIENhbGwg\ndGhlIGFzeW5jIHJlY292ZXIgYm9va2llIG1ldGhvZC4KICAgICAgICBMT0cu\naW5mbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtpbGxlZCBib29r\naWUgKCIgKyBib29raWVTcmMKICAgICAgICAgICAgICAgICArICIpIGFuZCBy\nZXBsaWNhdGUgaXQgdG8gYSByYW5kb20gYXZhaWxhYmxlIG9uZSIpOwogICAg\nICAgIC8vIEluaXRpYXRlIHRoZSBzeW5jIG9iamVjdAogICAgICAgIHN5bmMu\ndmFsdWUgPSBmYWxzZTsKICAgICAgICBia0FkbWluLnJlY292ZXJCb29raWVE\nYXRhKGJvb2tpZVNyYywgbnVsbCk7CgogICAgICAgIGFzc2VydEZhbHNlKCJE\ndXBlcyBleGlzdCBpbiBlbnNlbWJsZXMiLCBmaW5kRHVwZXNJbkVuc2VtYmxl\ncyhsaHMpKTsKCiAgICAgICAgLy8gV3JpdGUgc29tZSBtb3JlIGVudHJpZXMg\ndG8gZW5zdXJlIGZlbmNpbmcgaGFzbid0IGJyb2tlbiBzdHVmZgogICAgICAg\nIHdyaXRlRW50cmllc3RvTGVkZ2VycyhudW1Nc2dzLCBudW1Nc2dzKjIsIGxo\ncyk7CgogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGhzKSB7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoIk5vdCBmdWxseSByZXBsaWNhdGVkIiwg\ndmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCBudW1Nc2dzKjMpKTsKICAgICAg\nICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHJlY292ZXJXaXRob3V0\nUGFzc3dvcmRJbkNvbmYoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBi\neXRlW10gcGFzc3dkQ29ycmVjdCA9ICJBQUFBQUEiLmdldEJ5dGVzKCk7CiAg\nICAgICAgYnl0ZVtdIHBhc3N3ZEJhZCA9ICJCQkJCQkIiLmdldEJ5dGVzKCk7\nCiAgICAgICAgRGlnZXN0VHlwZSBkaWdlc3RDb3JyZWN0ID0gZGlnZXN0VHlw\nZTsKICAgICAgICBEaWdlc3RUeXBlIGRpZ2VzdEJhZCA9IChkaWdlc3RUeXBl\nID09IERpZ2VzdFR5cGUuTUFDKSA/IERpZ2VzdFR5cGUuQ1JDMzIgOiBEaWdl\nc3RUeXBlLk1BQzsKCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNy\nZWF0ZUxlZGdlcigzLCAyLCBkaWdlc3RDb3JyZWN0LCBwYXNzd2RDb3JyZWN0\nKTsKICAgICAgICBsb25nIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAg\nIGxoLmFkZEVudHJ5KCJmb29iYXIiLmdldEJ5dGVzKCkpOwogICAgICAgIH0K\nICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICBJbmV0U29ja2V0QWRkcmVz\ncyBib29raWVTcmMgPSBicy5nZXQoMCkuZ2V0TG9jYWxBZGRyZXNzKCk7CiAg\nICAgICAgYnMuZ2V0KDApLnNodXRkb3duKCk7CiAgICAgICAgYnMucmVtb3Zl\nKDApOwogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAgIC8vIENo\nZWNrIHRoYXQgZW50cmllcyBhcmUgbWlzc2luZwogICAgICAgIGxoID0gYmtj\nLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxlZGdlcklkLCBkaWdlc3RDb3JyZWN0\nLCBwYXNzd2RDb3JyZWN0KTsKICAgICAgICBhc3NlcnRGYWxzZSgiU2hvdWxk\nIGJlIGVudHJpZXMgbWlzc2luZyIsIHZlcmlmeUZ1bGx5UmVwbGljYXRlZChs\naCwgMTAwKSk7CiAgICAgICAgbGguY2xvc2UoKTsKCiAgICAgICAgLy8gVHJ5\nIHRvIHJlY292ZXIgd2l0aCBiYWQgcGFzc3dvcmQgaW4gY29uZgogICAgICAg\nIC8vIFRoaXMgaXMgZmluZSwgYmVjYXVzZSBpdCBvbmx5IGZhbGxzIGJhY2sg\ndG8gdGhlIGNvbmZpZ3VyZWQKICAgICAgICAvLyBwYXNzd29yZCBpZiB0aGUg\ncGFzc3dvcmQgaW5mbyBpcyBtaXNzaW5nIGZyb20gdGhlIG1ldGFkYXRhCiAg\nICAgICAgQ2xpZW50Q29uZmlndXJhdGlvbiBhZG1pbkNvbmYgPSBuZXcgQ2xp\nZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgIGFkbWluQ29uZi5zZXRaa1Nl\ncnZlcnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAg\nICAgICAgYWRtaW5Db25mLnNldEJvb2tpZVJlY292ZXJ5RGlnZXN0VHlwZShk\naWdlc3RDb3JyZWN0KTsKICAgICAgICBhZG1pbkNvbmYuc2V0Qm9va2llUmVj\nb3ZlcnlQYXNzd2QocGFzc3dkQmFkKTsKICAgICAgICBzZXRNZXRhc3RvcmVJ\nbXBsQ2xhc3MoYWRtaW5Db25mKTsKCiAgICAgICAgQm9va0tlZXBlckFkbWlu\nIGJrYSA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYWRtaW5Db25mKTsKICAgICAg\nICBia2EucmVjb3ZlckJvb2tpZURhdGEoYm9va2llU3JjLCBudWxsKTsKICAg\nICAgICBia2EuY2xvc2UoKTsKCiAgICAgICAgbGggPSBia2Mub3BlbkxlZGdl\nck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENvcnJlY3QsIHBhc3N3ZENv\ncnJlY3QpOwogICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBiZSBiYWNrIHRv\nIGZ1bGx5IHJlcGxpY2F0aW9uIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxo\nLCAxMDApKTsKICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICBib29raWVT\ncmMgPSBicy5nZXQoMCkuZ2V0TG9jYWxBZGRyZXNzKCk7CiAgICAgICAgYnMu\nZ2V0KDApLnNodXRkb3duKCk7CiAgICAgICAgYnMucmVtb3ZlKDApOwogICAg\nICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQg\nZW50cmllcyBhcmUgbWlzc2luZwogICAgICAgIGxoID0gYmtjLm9wZW5MZWRn\nZXJOb1JlY292ZXJ5KGxlZGdlcklkLCBkaWdlc3RDb3JyZWN0LCBwYXNzd2RD\nb3JyZWN0KTsKICAgICAgICBhc3NlcnRGYWxzZSgiU2hvdWxkIGJlIGVudHJp\nZXMgbWlzc2luZyIsIHZlcmlmeUZ1bGx5UmVwbGljYXRlZChsaCwgMTAwKSk7\nCiAgICAgICAgbGguY2xvc2UoKTsKCiAgICAgICAgLy8gVHJ5IHRvIHJlY292\nZXIgd2l0aCBubyBwYXNzd29yZCBpbiBjb25mCiAgICAgICAgYWRtaW5Db25m\nID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBhZG1pbkNv\nbmYuc2V0WmtTZXJ2ZXJzKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3Ry\naW5nKCkpOwogICAgICAgIHNldE1ldGFzdG9yZUltcGxDbGFzcyhhZG1pbkNv\nbmYpOwoKICAgICAgICBia2EgPSBuZXcgQm9va0tlZXBlckFkbWluKGFkbWlu\nQ29uZik7CiAgICAgICAgYmthLnJlY292ZXJCb29raWVEYXRhKGJvb2tpZVNy\nYywgbnVsbCk7CiAgICAgICAgYmthLmNsb3NlKCk7CgogICAgICAgIGxoID0g\nYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxlZGdlcklkLCBkaWdlc3RDb3Jy\nZWN0LCBwYXNzd2RDb3JyZWN0KTsKICAgICAgICBhc3NlcnRUcnVlKCJTaG91\nbGQgYmUgYmFjayB0byBmdWxseSByZXBsaWNhdGlvbiIsIHZlcmlmeUZ1bGx5\nUmVwbGljYXRlZChsaCwgMTAwKSk7CiAgICAgICAgbGguY2xvc2UoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCB3aGVuIHdlIHRyeSB0byBy\nZWNvdmVyIGEgbGVkZ2VyIHdoaWNoIGRvZXNuJ3QgaGF2ZQogICAgICogdGhl\nIHBhc3N3b3JkIHN0b3JlZCBpbiB0aGUgY29uZmlndXJhdGlvbiwgd2UgZG9u\nJ3Qgc3VjY2VlZAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgZW5zdXJlUGFzc3dvcmRVc2VkRm9yT2xkTGVkZ2Vy\ncygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIFRoaXMgdGVzdCBi\nYXNlcyBvbiBjcmVhdGluZyBvbGQgbGVkZ2VycyBpbiB2ZXJzaW9uIDQuMS4w\nLCB3aGljaCBvbmx5CiAgICAgICAgLy8gc3VwcG9ydHMgWm9vS2VlcGVyIGJh\nc2VkIGZsYXQgYW5kIGhpZXJhcmNoaWNhbCBMZWRnZXJNYW5hZ2VyRmFjdG9y\neS4KICAgICAgICAvLyBTbyB3ZSBpZ25vcmUgaXQgZm9yIE1TTGVkZ2VyTWFu\nYWdlckZhY3RvcnkuCiAgICAgICAgaWYgKE1TTGVkZ2VyTWFuYWdlckZhY3Rv\ncnkuY2xhc3MuZ2V0TmFtZSgpLmVxdWFscyhsZWRnZXJNYW5hZ2VyRmFjdG9y\neSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\nLy8gc3RvcCBhbGwgYm9va2llcwogICAgICAgIC8vIGFuZCB3aXBlIHRoZSBs\nZWRnZXIgbGF5b3V0IHNvIHdlIGNhbiB1c2UgYW4gb2xkIGNsaWVudAogICAg\nICAgIHprVXRpbC5nZXRab29LZWVwZXJDbGllbnQoKS5kZWxldGUoIi9sZWRn\nZXJzL0xBWU9VVCIsIC0xKTsKCiAgICAgICAgYnl0ZVtdIHBhc3N3ZENvcnJl\nY3QgPSAiQUFBQUFBIi5nZXRCeXRlcygpOwogICAgICAgIGJ5dGVbXSBwYXNz\nd2RCYWQgPSAiQkJCQkJCIi5nZXRCeXRlcygpOwogICAgICAgIERpZ2VzdFR5\ncGUgZGlnZXN0Q29ycmVjdCA9IGRpZ2VzdFR5cGU7CiAgICAgICAgRGlnZXN0\nVHlwZSBkaWdlc3RCYWQgPSBkaWdlc3RDb3JyZWN0ID09IERpZ2VzdFR5cGUu\nTUFDID8gRGlnZXN0VHlwZS5DUkMzMiA6IERpZ2VzdFR5cGUuTUFDOwoKICAg\nICAgICBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5C\nb29rS2VlcGVyLkRpZ2VzdFR5cGUgZGlnZXN0Q29ycmVjdDQxMAogICAgICAg\nICAgICA9IG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50\nLkJvb2tLZWVwZXIuRGlnZXN0VHlwZS52YWx1ZU9mKGRpZ2VzdFR5cGUudG9T\ndHJpbmcoKSk7CgogICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2tr\nZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uIGMKICAgICAgICAgICAg\nPSBuZXcgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tlZXBlci5jb25mLkNs\naWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBjLnNldFprU2VydmVycyh6\na1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKQogICAgICAgICAg\nICAuc2V0TGVkZ2VyTWFuYWdlclR5cGUoCiAgICAgICAgICAgICAgICAgICAg\nbGVkZ2VyTWFuYWdlckZhY3RvcnkuZXF1YWxzKCJvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubWV0YS5GbGF0TGVkZ2VyTWFuYWdlckZhY3RvcnkiKSA/CiAgICAg\nICAgICAgICAgICAgICAgImZsYXQiIDogImhpZXJhcmNoaWNhbCIpOwoKICAg\nICAgICAvLyBjcmVhdGUgY2xpZW50IHRvIHNldCB1cCBsYXlvdXQsIGNsb3Nl\nIGl0LCByZXN0YXJ0IGJvb2tpZXMsIGFuZCBvcGVuIGEgbmV3IGNsaWVudC4K\nICAgICAgICAvLyB0aGUgbmV3IGNsaWVudCBpcyBuZWNlc3NhcnkgdG8gZW5z\ndXJlIHRoYXQgaXQgaGFzIGFsbCB0aGUgcmVzdGFydGVkIGJvb2tpZXMgaW4g\ndGhlCiAgICAgICAgLy8gaXRzIGF2YWlsYWJsZSBib29raWUgbGlzdAogICAg\nICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJv\nb2tLZWVwZXIgYmtjNDEKICAgICAgICAgICAgPSBuZXcgb3JnLmFwYWNoZS5i\na192NF8xXzAuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlcihjKTsKICAg\nICAgICBia2M0MS5jbG9zZSgpOwogICAgICAgIHJlc3RhcnRCb29raWVzKCk7\nCiAgICAgICAgYmtjNDEgPSBuZXcgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9v\na2tlZXBlci5jbGllbnQuQm9va0tlZXBlcihjKTsKCiAgICAgICAgb3JnLmFw\nYWNoZS5ia192NF8xXzAuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxl\nIGxoNDEKICAgICAgICAgICAgPSBia2M0MS5jcmVhdGVMZWRnZXIoMywgMiwg\nZGlnZXN0Q29ycmVjdDQxMCwgcGFzc3dkQ29ycmVjdCk7CiAgICAgICAgbG9u\nZyBsZWRnZXJJZCA9IGxoNDEuZ2V0SWQoKTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgIGxoNDEuYWRkRW50\ncnkoImZvb2JhciIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQogICAgICAgIGxo\nNDEuY2xvc2UoKTsKICAgICAgICBia2M0MS5jbG9zZSgpOwoKICAgICAgICAv\nLyBTdGFydHVwIGEgbmV3IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBpbnQgbmV3\nQm9va2llUG9ydCA9IHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgaW50IHJl\nbW92ZUluZGV4ID0gMDsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29r\naWVTcmMgPSBicy5nZXQocmVtb3ZlSW5kZXgpLmdldExvY2FsQWRkcmVzcygp\nOwogICAgICAgIGJzLmdldChyZW1vdmVJbmRleCkuc2h1dGRvd24oKTsKICAg\nICAgICBicy5yZW1vdmUocmVtb3ZlSW5kZXgpOwoKICAgICAgICAvLyBDaGVj\nayB0aGF0IGVudHJpZXMgYXJlIG1pc3NpbmcKICAgICAgICBMZWRnZXJIYW5k\nbGUgbGggPSBia2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRp\nZ2VzdENvcnJlY3QsIHBhc3N3ZENvcnJlY3QpOwogICAgICAgIGFzc2VydEZh\nbHNlKCJTaG91bGQgYmUgZW50cmllcyBtaXNzaW5nIiwgdmVyaWZ5RnVsbHlS\nZXBsaWNhdGVkKGxoLCAxMDApKTsKICAgICAgICBsaC5jbG9zZSgpOwoKICAg\nICAgICAvLyBUcnkgdG8gcmVjb3ZlciB3aXRoIGJhZCBwYXNzd29yZCBpbiBj\nb25mCiAgICAgICAgLy8gaWYgdGhlIGRpZ2VzdCB0eXBlIGlzIE1BQwogICAg\nICAgIC8vIGZvciBDUkMzMiwgdGhlIHBhc3N3b3JkIGlzIG9ubHkgY2hlY2tl\nZAogICAgICAgIC8vIHdoZW4gYWRkaW5nIG5ldyBlbnRyaWVzLCB3aGljaCBy\nZWNvdmVyeSB3aWxsCiAgICAgICAgLy8gbmV2ZXIgZG8KICAgICAgICBDbGll\nbnRDb25maWd1cmF0aW9uIGFkbWluQ29uZjsKICAgICAgICBCb29rS2VlcGVy\nQWRtaW4gYmthOwogICAgICAgIGlmIChkaWdlc3RDb3JyZWN0ID09IERpZ2Vz\ndFR5cGUuTUFDKSB7CiAgICAgICAgICAgIGFkbWluQ29uZiA9IG5ldyBDbGll\nbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGFkbWluQ29uZi5zZXRa\na1NlcnZlcnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7\nCiAgICAgICAgICAgIGFkbWluQ29uZi5zZXRMZWRnZXJNYW5hZ2VyRmFjdG9y\neUNsYXNzTmFtZShsZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAgICAgICAgICAg\nIGFkbWluQ29uZi5zZXRCb29raWVSZWNvdmVyeURpZ2VzdFR5cGUoZGlnZXN0\nQ29ycmVjdCk7CiAgICAgICAgICAgIGFkbWluQ29uZi5zZXRCb29raWVSZWNv\ndmVyeVBhc3N3ZChwYXNzd2RCYWQpOwoKICAgICAgICAgICAgYmthID0gbmV3\nIEJvb2tLZWVwZXJBZG1pbihhZG1pbkNvbmYpOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgYmthLnJlY292ZXJCb29raWVEYXRhKGJvb2tp\nZVNyYywgbnVsbCk7CiAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3Qg\nYmUgYWJsZSB0byByZWNvdmVyIHdpdGggd3JvbmcgcGFzc3dvcmQiKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gYmtlKSB7CiAgICAgICAg\nICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICAgICAgYmthLmNsb3NlKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFRyeSB0byByZWNvdmVyIHdp\ndGggYmFkIGRpZ2VzdCBpbiBjb25mCiAgICAgICAgYWRtaW5Db25mID0gbmV3\nIENsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBhZG1pbkNvbmYuc2V0\nWmtTZXJ2ZXJzKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkp\nOwogICAgICAgIGFkbWluQ29uZi5zZXRMZWRnZXJNYW5hZ2VyRmFjdG9yeUNs\nYXNzTmFtZShsZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAgICAgICAgYWRtaW5D\nb25mLnNldEJvb2tpZVJlY292ZXJ5RGlnZXN0VHlwZShkaWdlc3RCYWQpOwog\nICAgICAgIGFkbWluQ29uZi5zZXRCb29raWVSZWNvdmVyeVBhc3N3ZChwYXNz\nd2RDb3JyZWN0KTsKCiAgICAgICAgYmthID0gbmV3IEJvb2tLZWVwZXJBZG1p\nbihhZG1pbkNvbmYpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJrYS5y\nZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIG51bGwpOwogICAgICAgICAg\nICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byByZWNvdmVyIHdpdGggd3Jv\nbmcgZGlnZXN0Iik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gYmtl\nKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgYmthLmNsb3NlKCk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBDaGVjayB0aGF0IGVudHJpZXMgYXJlIHN0aWxsIG1p\nc3NpbmcKICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShs\nZWRnZXJJZCwgZGlnZXN0Q29ycmVjdCwgcGFzc3dkQ29ycmVjdCk7CiAgICAg\nICAgYXNzZXJ0RmFsc2UoIlNob3VsZCBiZSBlbnRyaWVzIG1pc3NpbmciLCB2\nZXJpZnlGdWxseVJlcGxpY2F0ZWQobGgsIDEwMCkpOwogICAgICAgIGxoLmNs\nb3NlKCk7CgogICAgICAgIGFkbWluQ29uZi5zZXRCb29raWVSZWNvdmVyeURp\nZ2VzdFR5cGUoZGlnZXN0Q29ycmVjdCk7CiAgICAgICAgYWRtaW5Db25mLnNl\ndEJvb2tpZVJlY292ZXJ5UGFzc3dkKHBhc3N3ZENvcnJlY3QpOwoKICAgICAg\nICBia2EgPSBuZXcgQm9va0tlZXBlckFkbWluKGFkbWluQ29uZik7CiAgICAg\nICAgYmthLnJlY292ZXJCb29raWVEYXRhKGJvb2tpZVNyYywgbnVsbCk7CiAg\nICAgICAgYmthLmNsb3NlKCk7CgogICAgICAgIGxoID0gYmtjLm9wZW5MZWRn\nZXJOb1JlY292ZXJ5KGxlZGdlcklkLCBkaWdlc3RDb3JyZWN0LCBwYXNzd2RD\nb3JyZWN0KTsKICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgaGF2ZSByZWNv\ndmVyZWQgZXZlcnl0aGluZyIsIHZlcmlmeUZ1bGx5UmVwbGljYXRlZChsaCwg\nMTAwKSk7CiAgICAgICAgbGguY2xvc2UoKTsKICAgIH0KfQo=\n","encoding":"base64"}

