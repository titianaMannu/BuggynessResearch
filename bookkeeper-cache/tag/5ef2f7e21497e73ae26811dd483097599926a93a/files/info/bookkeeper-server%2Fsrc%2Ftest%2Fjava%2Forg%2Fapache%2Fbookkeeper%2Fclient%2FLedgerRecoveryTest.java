{"sha":"de0d319ad846d9b710ee6faa5987c15e0d513326","node_id":"MDQ6QmxvYjE1NzU5NTY6ZGUwZDMxOWFkODQ2ZDliNzEwZWU2ZmFhNTk4N2MxNWUwZDUxMzMyNg==","size":13740,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/de0d319ad846d9b710ee6faa5987c15e0d513326","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0\nb21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5qdW5pdC4qOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWU7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2Vy\nSGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5C\nS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci50ZXN0LkJhc2VUZXN0Q2FzZTsKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgog\nKiBUaGlzIHVuaXQgdGVzdCB0ZXN0cyBsZWRnZXIgcmVjb3ZlcnkuCiAqCiAq\nLwoKcHVibGljIGNsYXNzIExlZGdlclJlY292ZXJ5VGVzdCBleHRlbmRzIEJh\nc2VUZXN0Q2FzZSB7CiAgICBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZh\nY3RvcnkuZ2V0TG9nZ2VyKExlZGdlclJlY292ZXJ5VGVzdC5jbGFzcyk7Cgog\nICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwoKICAgIHB1YmxpYyBMZWRnZXJS\nZWNvdmVyeVRlc3QoRGlnZXN0VHlwZSBkaWdlc3RUeXBlKSB7CiAgICAgICAg\nc3VwZXIoMyk7CiAgICAgICAgdGhpcy5kaWdlc3RUeXBlID0gZGlnZXN0VHlw\nZTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgdGVzdEludGVybmFsKGludCBu\ndW1FbnRyaWVzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvKgogICAg\nICAgICAqIENyZWF0ZSBsZWRnZXIuCiAgICAgICAgICovCiAgICAgICAgTGVk\nZ2VySGFuZGxlIGJlZm9yZWxoID0gbnVsbDsKICAgICAgICBiZWZvcmVsaCA9\nIGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7\nCgogICAgICAgIFN0cmluZyB0bXAgPSAiQm9va0tlZXBlciBpcyBjb29sISI7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKysp\nIHsKICAgICAgICAgICAgYmVmb3JlbGguYWRkRW50cnkodG1wLmdldEJ5dGVz\nKCkpOwogICAgICAgIH0KCiAgICAgICAgbG9uZyBsZW5ndGggPSAobG9uZykg\nKG51bUVudHJpZXMgKiB0bXAubGVuZ3RoKCkpOwoKICAgICAgICAvKgogICAg\nICAgICAqIFRyeSB0byBvcGVuIGxlZGdlci4KICAgICAgICAgKi8KICAgICAg\nICBMZWRnZXJIYW5kbGUgYWZ0ZXJsaCA9IGJrYy5vcGVuTGVkZ2VyKGJlZm9y\nZWxoLmdldElkKCksIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwoKICAg\nICAgICAvKgogICAgICAgICAqIENoZWNrIGlmIGhhcyByZWNvdmVyZWQgcHJv\ncGVybHkuCiAgICAgICAgICovCiAgICAgICAgYXNzZXJ0VHJ1ZSgiSGFzIG5v\ndCByZWNvdmVyZWQgY29ycmVjdGx5OiAiICsgYWZ0ZXJsaC5nZXRMYXN0QWRk\nQ29uZmlybWVkKCksCiAgICAgICAgICAgICAgICAgICBhZnRlcmxoLmdldExh\nc3RBZGRDb25maXJtZWQoKSA9PSBudW1FbnRyaWVzIC0gMSk7CiAgICAgICAg\nYXNzZXJ0VHJ1ZSgiSGFzIG5vdCBzZXQgdGhlIGxlbmd0aCBjb3JyZWN0bHk6\nICIgKyBhZnRlcmxoLmdldExlbmd0aCgpICsgIiwgIiArIGxlbmd0aCwKICAg\nICAgICAgICAgICAgICAgIGFmdGVybGguZ2V0TGVuZ3RoKCkgPT0gbGVuZ3Ro\nKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdExlZGdlclJlY292ZXJ5KCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgdGVzdEludGVybmFsKDEwMCk7CgogICAgfQoKICAgIEBUZXN0\nKHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RW1wdHlMZWRn\nZXJSZWNvdmVyeU9uZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRl\nc3RJbnRlcm5hbCgxKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdEVtcHR5TGVkZ2VyUmVjb3ZlcnkoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB0ZXN0SW50ZXJuYWwoMCk7CiAg\nICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RMZWRnZXJSZWNvdmVyeVdpdGhXcm9uZ1Bhc3N3b3JkKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAg\nICAgYnl0ZVtdIGxlZGdlclBhc3N3b3JkID0gImFhYWEiLmdldEJ5dGVzKCk7\nCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihk\naWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgLy8gYmtjLmlu\naXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAgICAgICAgbG9uZyBsZWRnZXJJ\nZCA9IGxoLmdldElkKCk7CiAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDog\nIiArIGxoLmdldElkKCkpOwogICAgICAgIFN0cmluZyB0bXAgPSAiQm9va0tl\nZXBlciBpcyBjb29sISI7CiAgICAgICAgaW50IG51bUVudHJpZXMgPSAzMDsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJpZXM7IGkrKykg\newogICAgICAgICAgICBsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBVc2luZyB3cm9uZyBwYXNzd29yZAogICAg\nICAgIGxlZGdlclBhc3N3b3JkID0gImJiYmIiLmdldEJ5dGVzKCk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcihsZWRn\nZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAg\nICBmYWlsKCJPcGVuaW5nIGxlZGdlciB3aXRoIHdyb25nIHBhc3N3b3JkIHNo\nb3VsZCBmYWlsIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAvLyBzaG91bGQgZmFpbGVkCiAgICAgICAgfQogICAg\nfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0TGVkZ2VyUmVjb3ZlcnlXaXRoTm90RW5vdWdoQm9va2llcygpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIGludCBudW1FbnRyaWVzID0gMzsKCiAg\nICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgTGVkZ2VySGFuZGxl\nIGJlZm9yZWxoID0gbnVsbDsKICAgICAgICBiZWZvcmVsaCA9IGJrYy5jcmVh\ndGVMZWRnZXIoMywgMywgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7Cgog\nICAgICAgIFN0cmluZyB0bXAgPSAiQm9va0tlZXBlciBpcyBjb29sISI7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsK\nICAgICAgICAgICAgYmVmb3JlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gc2h1dGRvd24gZmlyc3QgYm9va2ll\nIHNlcnZlcgogICAgICAgIGJzLmdldCgwKS5zaHV0ZG93bigpOwogICAgICAg\nIGJzLnJlbW92ZSgwKTsKCiAgICAgICAgLyoKICAgICAgICAgKiBUcnkgdG8g\nb3BlbiBsZWRnZXIuCiAgICAgICAgICovCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYmtjLm9wZW5MZWRnZXIoYmVmb3JlbGguZ2V0SWQoKSwgZGlnZXN0\nVHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIGZhaWwoInNob3Vs\nZCBub3QgcmVhY2ggaGVyZSEiKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAvLyBzaG91bGQgdGhyb3duIHJlY292ZXJ5\nIGV4Y2VwdGlvbgogICAgICAgIH0KCiAgICAgICAgLy8gc3RhcnQgYSBuZXcg\nYm9va2llIHNlcnZlcgogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAg\nICAgIExlZGdlckhhbmRsZSBhZnRlcmxoID0gYmtjLm9wZW5MZWRnZXIoYmVm\nb3JlbGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7Cgog\nICAgICAgIC8qCiAgICAgICAgICogQ2hlY2sgaWYgaGFzIHJlY292ZXJlZCBw\ncm9wZXJseS4KICAgICAgICAgKi8KICAgICAgICBhc3NlcnRFcXVhbHMobnVt\nRW50cmllcyAtIDEsIGFmdGVybGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsK\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdExlZGdlclJlY292ZXJ5V2l0aFNsb3dCb29raWUoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDM7IGkr\nKykgewogICAgICAgICAgICBMT0cuaW5mbygiVGVzdExlZGdlclJlY292ZXJ5\nV2l0aEFja1F1b3J1bSBAIHNsb3cgYm9va2llIHt9IiwgaSk7CiAgICAgICAg\nICAgIGxlZGdlclJlY292ZXJ5V2l0aFNsb3dCb29raWUoMywgMywgMiwgMSwg\naSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBsZWRnZXJS\nZWNvdmVyeVdpdGhTbG93Qm9va2llKGludCBlbnNlbWJsZVNpemUsIGludCB3\ncml0ZVF1b3J1bVNpemUsCiAgICAgICAgaW50IGFja1F1b3J1bVNpemUsIGlu\ndCBudW1FbnRyaWVzLCBpbnQgc2xvd0Jvb2tpZUlkeCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CgogICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgIExl\nZGdlckhhbmRsZSBiZWZvcmVsaCA9IG51bGw7CiAgICAgICAgYmVmb3JlbGgg\nPSBia2MuY3JlYXRlTGVkZ2VyKGVuc2VtYmxlU2l6ZSwgd3JpdGVRdW9ydW1T\naXplLCBhY2tRdW9ydW1TaXplLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKCiAgICAg\nICAgLy8ga2lsbCBmaXJzdCBib29raWUgc2VydmVyIHRvIHN0YXJ0IGEgZmFr\nZSBvbmUgdG8gc2ltdWxhdGUgYSBzbG93IGJvb2tpZQogICAgICAgIC8vIGFu\nZCBmYWlsZWQgdG8gYWRkIGVudHJ5IG9uIGNyYXNoCiAgICAgICAgLy8gdW50\naWwgd3JpdGUgc3VjY2VlZAogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGhv\nc3QgPSBiZWZvcmVsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmN1cnJlbnRFbnNl\nbWJsZS5nZXQoc2xvd0Jvb2tpZUlkeCk7CiAgICAgICAgU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mID0ga2lsbEJvb2tpZShob3N0KTsKCiAgICAgICAgQm9v\na2llIGZha2VCb29raWUgPSBuZXcgQm9va2llKGNvbmYpIHsKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFkZEVudHJ5\nKEJ5dGVCdWZmZXIgZW50cnksIFdyaXRlQ2FsbGJhY2sgY2IsIE9iamVjdCBj\ndHgsIGJ5dGVbXSBtYXN0ZXJLZXkpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgICAg\nICAgICAgLy8gZHJvcCByZXF1ZXN0IHRvIHNpbXVsYXRlIGEgc2xvdyBhbmQg\nZmFpbGVkIGJvb2tpZQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAg\nICBic0NvbmZzLmFkZChjb25mKTsKICAgICAgICBicy5hZGQoc3RhcnRCb29r\naWUoY29uZiwgZmFrZUJvb2tpZSkpOwoKICAgICAgICAvLyBhdm9pZCBub3Qt\nZW5vdWdoLWJvb2tpZXMgY2FzZQogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7\nCgogICAgICAgIC8vIHdyaXRlIHdvdWxkIHN0aWxsIHN1Y2NlZWQgd2l0aCAy\nIGJvb2tpZXMgYWNrCiAgICAgICAgU3RyaW5nIHRtcCA9ICJCb29rS2VlcGVy\nIGlzIGNvb2whIjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVu\ndHJpZXM7IGkrKykgewogICAgICAgICAgICBiZWZvcmVsaC5hZGRFbnRyeSh0\nbXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICBjb25mID0ga2ls\nbEJvb2tpZShob3N0KTsKICAgICAgICBic0NvbmZzLmFkZChjb25mKTsKICAg\nICAgICAvLyB0aGUgYm9va2llIGdvZXMgbm9ybWFsbHkKICAgICAgICBicy5h\nZGQoc3RhcnRCb29raWUoY29uZikpOwoKICAgICAgICAvKgogICAgICAgICAq\nIFRyeSB0byBvcGVuIGxlZGdlci4KICAgICAgICAgKi8KICAgICAgICBMZWRn\nZXJIYW5kbGUgYWZ0ZXJsaCA9IGJrYy5vcGVuTGVkZ2VyKGJlZm9yZWxoLmdl\ndElkKCksIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwoKICAgICAgICAv\nKgogICAgICAgICAqIENoZWNrIGlmIGhhcyByZWNvdmVyZWQgcHJvcGVybHku\nCiAgICAgICAgICovCiAgICAgICAgYXNzZXJ0RXF1YWxzKG51bUVudHJpZXMg\nLSAxLCBhZnRlcmxoLmdldExhc3RBZGRDb25maXJtZWQoKSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9y\nZy9qaXJhL2Jyb3dzZS9CT09LS0VFUEVSLTM1NX0KICAgICAqIEEgcmVjb3Zl\ncnkgZHVyaW5nIGEgcm9sbGluZyByZXN0YXJ0IHNob3VsZG4ndCBhZmZlY3Qg\ndGhlIGFiaWxpdHkKICAgICAqIHRvIHJlY292ZXJ5IHRoZSBsZWRnZXIgbGF0\nZXIuCiAgICAgKiBXZSBoYXZlIGEgbGVkZ2VyIG9uIGVuc2VtYmxlIEIxLEIy\nLEIzLgogICAgICogVGhlIHNlcXVlbmNlIG9mIGV2ZW50cyBpcwogICAgICog\nMS4gQjEgYnJvdWdodCBkb3duIGZvciBtYWludGVuYW5jZQogICAgICogMi4g\nTGVkZ2VyIHJlY292ZXJ5IHN0YXJ0ZWQKICAgICAqIDMuIEIyIGFuc3dlcnMg\ncmVhZCBsYXN0IGNvbmZpcm1lZC4KICAgICAqIDQuIEIxIHJlcGxhY2VkIGlu\nIGVuc2VtYmxlIGJ5IEI0CiAgICAgKiA1LiBXcml0ZSB0byBCNCBmYWlscyBm\nb3Igc29tZSByZWFzb24KICAgICAqIDYuIEIxIGNvbWVzIGJhY2sgdXAuCiAg\nICAgKiA3LiBCMiBnb2VzIGRvd24gZm9yIG1haW50ZW5hbmNlLgogICAgICog\nOC4gTGVkZ2VyIHJlY292ZXJ5IHN0YXJ0cyAobGVkZ2VyIGlzIG5vdyB1bmF2\nYWlsYWJsZSkKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RMZWRnZXJSZWNvdmVyeVdpdGhSb2xsaW5nUmVz\ndGFydCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExlZGdlckhhbmRs\nZSBsaGJlZm9yZSA9IGJrYy5jcmVhdGVMZWRnZXIobnVtQm9va2llcywgMiwg\nZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCAobnVtQm9va2llcyozKSsxOyBpKyspIHsKICAgICAgICAg\nICAgbGhiZWZvcmUuYWRkRW50cnkoImRhdGEiLmdldEJ5dGVzKCkpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gQWRkIGEgZGVhZCBib29raWUgdG8gdGhlIGNs\ndXN0ZXIKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXdT\nZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgQm9va2llIGRlYWRCb29r\naWUxID0gbmV3IEJvb2tpZShjb25mKSB7CiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCByZWNvdmVyeUFkZEVudHJ5KEJ5\ndGVCdWZmZXIgZW50cnksIFdyaXRlQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgs\nIGJ5dGVbXSBtYXN0ZXJLZXkpCiAgICAgICAgICAgICAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgICAgICAg\nICAgLy8gZHJvcCByZXF1ZXN0IHRvIHNpbXVsYXRlIGEgc2xvdyBhbmQgZmFp\nbGVkIGJvb2tpZQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0\naW9uKCJDb3VsZG4ndCB3cml0ZSBmb3Igc29tZSByZWFzb24iKTsKICAgICAg\nICAgICAgfQogICAgICAgIH07CiAgICAgICAgYnNDb25mcy5hZGQoY29uZik7\nCiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2llKGNvbmYsIGRlYWRCb29raWUx\nKSk7CgogICAgICAgIC8vIGtpbGwgZmlyc3QgYm9va2llIHNlcnZlcgogICAg\nICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZTEgPSBsaGJlZm9yZS5nZXRM\nZWRnZXJNZXRhZGF0YSgpLmN1cnJlbnRFbnNlbWJsZS5nZXQoMCk7CiAgICAg\nICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mMSA9IGtpbGxCb29raWUoYm9v\na2llMSk7CgogICAgICAgIC8vIFRyeSB0byByZWNvdmVyIGFuZCBmZW5jZSB0\naGUgbGVkZ2VyIGFmdGVyIGtpbGxpbmcgb25lIGJvb2tpZSBpbiB0aGUKICAg\nICAgICAvLyBlbnNlbWJsZSBpbiB0aGUgZW5zZW1ibGUsIGFuZCBhbm90aGVy\nIGJvb2tpZSBpcyBhdmFpbGFibGUgaW4gemssIGJ1dCBub3Qgd3JpdHRhYmxl\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmtjLm9wZW5MZWRnZXIobGhi\nZWZvcmUuZ2V0SWQoKSwgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAg\nICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIG9wZW4gbGVk\nZ2VyLCB0aGVyZSBzaG91bGQgYmUgZW50cmllcyBtaXNzaW5nIik7CiAgICAg\nICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktMZWRnZXJSZWNvdmVyeUV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAgICAgICAgfQoK\nICAgICAgICAvLyByZXN0YXJ0IHRoZSBmaXJzdCBzZXJ2ZXIsIGtpbGwgdGhl\nIHNlY29uZAogICAgICAgIGJzQ29uZnMuYWRkKGNvbmYxKTsKICAgICAgICBi\ncy5hZGQoc3RhcnRCb29raWUoY29uZjEpKTsKICAgICAgICBJbmV0U29ja2V0\nQWRkcmVzcyBib29raWUyID0gbGhiZWZvcmUuZ2V0TGVkZ2VyTWV0YWRhdGEo\nKS5jdXJyZW50RW5zZW1ibGUuZ2V0KDEpOwogICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZjIgPSBraWxsQm9va2llKGJvb2tpZTIpOwoKICAgICAg\nICAvLyB1c2luZyBhc3luYywgYmVjYXVzZSB0aGlzIGNvdWxkIHRyaWdnZXIg\nYW4gYXNzZXJ0aW9uCiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciByZXR1\ncm5Db2RlID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggb3BlbkxhdGNoID0gbmV3IENvdW50RG93bkxhdGNo\nKDEpOwogICAgICAgIGJrYy5hc3luY09wZW5MZWRnZXIobGhiZWZvcmUuZ2V0\nSWQoKSwgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG5ldyBBc3luY0NhbGxiYWNrLk9wZW5DYWxsYmFj\naygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMg\ndm9pZCBvcGVuQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIE9i\namVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuQ29kZS5zZXQocmMpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBvcGVuTGF0Y2guY291bnREb3duKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2Vw\ndGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRXhjZXB0aW9uIGNsb3NpbmcgbGVkZ2VyIGhhbmRsZSIs\nIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiT3Bl\nbiBjYWxsIHNob3VsZCBoYXZlIGNvbXBsZXRlZCIsIG9wZW5MYXRjaC5hd2Fp\ndCg1LCBUaW1lVW5pdC5TRUNPTkRTKSk7CiAgICAgICAgYXNzZXJ0RmFsc2Uo\nIk9wZW4gc2hvdWxkIG5vdCBoYXZlIHN1Y2NlZWRlZCIsIHJldHVybkNvZGUu\nZ2V0KCkgPT0gQktFeGNlcHRpb24uQ29kZS5PSyk7CgogICAgICAgIGJzQ29u\nZnMuYWRkKGNvbmYyKTsKICAgICAgICBicy5hZGQoc3RhcnRCb29raWUoY29u\nZjIpKTsKCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoYWZ0ZXIgPSBia2Mub3Bl\nbkxlZGdlcihsaGJlZm9yZS5nZXRJZCgpLCBkaWdlc3RUeXBlLAogICAgICAg\nICAgICAgICAgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKCJGZW5jZWQgbGVkZ2VyIHNob3VsZCBoYXZlIGNvcnJlY3QgbGFzdEFkZENv\nbmZpcm1lZCIsCiAgICAgICAgICAgICAgICAgICAgIGxoYmVmb3JlLmdldExh\nc3RBZGRDb25maXJtZWQoKSwgbGhhZnRlci5nZXRMYXN0QWRkQ29uZmlybWVk\nKCkpOwogICAgfQoKICAgIC8qKgogICAgICoge0BsaW5rIGh0dHBzOi8vaXNz\ndWVzLmFwYWNoZS5vcmcvamlyYS9icm93c2UvQk9PS0tFRVBFUi0zNTV9CiAg\nICAgKiBWZXJpZnkgdGhhdCBpZiBhIHJlY292ZXJ5IGhhcHBlbnMgd2l0aCAx\nIHJlcGxpY2EgbWlzc2luZywgYW5kIGl0J3MgcmVwbGFjZWQKICAgICAqIHdp\ndGggYSBmYXVsdHkgYm9va2llLCBpdCBkb2Vzbid0IGJyZWFrIGZ1dHVyZSBy\nZWNvdmVyeSBmcm9tIGhhcHBlbmluZy4KICAgICAqIDEuIExlZGdlciBpcyBj\ncmVhdGVkIHdpdGggcXVvcnVtIHNpemUgYXMgMiwgYW5kIGVudHJpZXMgYXJl\nIHdyaXR0ZW4KICAgICAqIDIuIE5vdyBmaXJzdCBib29raWUgaXMgaW4gdGhl\nIGVuc2VtYmxlIGlzIGJyb3VnaHQgZG93bi4KICAgICAqIDMuIEFub3RoZXIg\nY2xpZW50IGZlbmNlIGFuZCB0cnlpbmcgdG8gcmVjb3ZlciB0aGUgc2FtZSBs\nZWRnZXIKICAgICAqIDQuIER1cmluZyB0aGlzIHRpbWUgZW5zZW1ibGUgY2hh\nbmdlIHdpbGwgaGFwcGVuCiAgICAgKiAgICBhbmQgbmV3IGJvb2tpZSB3aWxs\nIGJlIGFkZGVkLiBCdXQgdGhpcyBib29raWUgaXMgbm90IGFibGUgdG8gd3Jp\ndGUuCiAgICAgKiA1LiBUaGlzIHJlY292ZXJ5IHdpbGwgZmFpbC4KICAgICAq\nIDcuIEEgbmV3IG5vbi1mYXVsdHkgYm9va2llIGNvbWVzIHVwCiAgICAgKiA4\nLiBBbm90aGVyIGNsaWVudCB0cnlpbmcgdG8gcmVjb3ZlciB0aGUgc2FtZSBs\nZWRnZXIuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0Qm9va2llRmFpbHVyZUR1cmluZ1JlY292ZXJ5KCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxoYmVm\nb3JlID0gYmtjLmNyZWF0ZUxlZGdlcihudW1Cb29raWVzLCAyLCBkaWdlc3RU\neXBlLCAiIi5nZXRCeXRlcygpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IChudW1Cb29raWVzKjMpKzE7IGkrKykgewogICAgICAgICAgICBsaGJl\nZm9yZS5hZGRFbnRyeSgiZGF0YSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBBZGQgYSBkZWFkIGJvb2tpZSB0byB0aGUgY2x1c3Rlcgog\nICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ld1NlcnZlckNv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICBCb29raWUgZGVhZEJvb2tpZTEgPSBu\nZXcgQm9va2llKGNvbmYpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHJlY292ZXJ5QWRkRW50cnkoQnl0ZUJ1ZmZl\nciBlbnRyeSwgV3JpdGVDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCwgYnl0ZVtd\nIG1hc3RlcktleSkKICAgICAgICAgICAgICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICAvLyBk\ncm9wIHJlcXVlc3QgdG8gc2ltdWxhdGUgYSBzbG93IGFuZCBmYWlsZWQgYm9v\na2llCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNv\ndWxkbid0IHdyaXRlIGZvciBzb21lIHJlYXNvbiIpOwogICAgICAgICAgICB9\nCiAgICAgICAgfTsKICAgICAgICBic0NvbmZzLmFkZChjb25mKTsKICAgICAg\nICBicy5hZGQoc3RhcnRCb29raWUoY29uZiwgZGVhZEJvb2tpZTEpKTsKCiAg\nICAgICAgLy8ga2lsbCBmaXJzdCBib29raWUgc2VydmVyCiAgICAgICAgSW5l\ndFNvY2tldEFkZHJlc3MgYm9va2llMSA9IGxoYmVmb3JlLmdldExlZGdlck1l\ndGFkYXRhKCkuY3VycmVudEVuc2VtYmxlLmdldCgwKTsKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYxID0ga2lsbEJvb2tpZShib29raWUxKTsK\nCiAgICAgICAgLy8gVHJ5IHRvIHJlY292ZXIgYW5kIGZlbmNlIHRoZSBsZWRn\nZXIgYWZ0ZXIga2lsbGluZyBvbmUgYm9va2llIGluIHRoZQogICAgICAgIC8v\nIGVuc2VtYmxlIGluIHRoZSBlbnNlbWJsZSwgYW5kIGFub3RoZXIgYm9va2ll\nIGlzIGF2YWlsYWJsZSBpbiB6ayBidXQgbm90IHdyaXR0YWJsZQogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGJrYy5vcGVuTGVkZ2VyKGxoYmVmb3JlLmdl\ndElkKCksIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwogICAgICAgICAg\nICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byBvcGVuIGxlZGdlciwgdGhl\ncmUgc2hvdWxkIGJlIGVudHJpZXMgbWlzc2luZyIpOwogICAgICAgIH0gY2F0\nY2ggKEJLRXhjZXB0aW9uLkJLTGVkZ2VyUmVjb3ZlcnlFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAvLyBleHBlY3RlZAogICAgICAgIH0KCiAgICAgICAg\nLy8gc3RhcnQgYSBuZXcgZ29vZCBzZXJ2ZXIKICAgICAgICBzdGFydE5ld0Jv\nb2tpZSgpOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbGhhZnRlciA9IGJrYy5v\ncGVuTGVkZ2VyKGxoYmVmb3JlLmdldElkKCksIGRpZ2VzdFR5cGUsCiAgICAg\nICAgICAgICAgICAiIi5nZXRCeXRlcygpKTsKICAgICAgICBhc3NlcnRFcXVh\nbHMoIkZlbmNlZCBsZWRnZXIgc2hvdWxkIGhhdmUgY29ycmVjdCBsYXN0QWRk\nQ29uZmlybWVkIiwKICAgICAgICAgICAgICAgICAgICAgbGhiZWZvcmUuZ2V0\nTGFzdEFkZENvbmZpcm1lZCgpLCBsaGFmdGVyLmdldExhc3RBZGRDb25maXJt\nZWQoKSk7CiAgICB9Cn0K\n","encoding":"base64"}

