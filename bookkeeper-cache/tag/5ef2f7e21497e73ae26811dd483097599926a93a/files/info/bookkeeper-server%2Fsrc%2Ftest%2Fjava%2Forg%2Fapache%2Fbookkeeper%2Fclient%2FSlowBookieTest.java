{"sha":"071b5e4e086963f37925917db1eab2bc1e17d483","node_id":"MDQ6QmxvYjE1NzU5NTY6MDcxYjVlNGUwODY5NjNmMzc5MjU5MTdkYjFlYWIyYmMxZTE3ZDQ4Mw==","size":7914,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/071b5e4e086963f37925917db1eab2bc1e17d483","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7Cgpp\nbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0ludGVn\nZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWlj\nQm9vbGVhbjsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNzOwpp\nbXBvcnQgb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0\nLkFzc2VydC4qOwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0Q2FzZTsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyRmFjdG9yeTsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LkJvb2tLZWVw\nZXJDbHVzdGVyVGVzdENhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwoKcHVibGljIGNsYXNzIFNs\nb3dCb29raWVUZXN0IGV4dGVuZHMgQm9va0tlZXBlckNsdXN0ZXJUZXN0Q2Fz\nZSB7CiAgICBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0\nTG9nZ2VyKFNsb3dCb29raWVUZXN0LmNsYXNzKTsKCiAgICBwdWJsaWMgU2xv\nd0Jvb2tpZVRlc3QoKSB7CiAgICAgICAgc3VwZXIoNCk7CiAgICB9CgogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTbG93\nQm9va2llKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xpZW50Q29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBjb25mLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVy\nQ29ubmVjdFN0cmluZygpKS5zZXRSZWFkVGltZW91dCgzNjApOwoKICAgICAg\nICBCb29rS2VlcGVyIGJrYyA9IG5ldyBCb29rS2VlcGVyKGNvbmYpOwoKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDQsIDMs\nIDIsIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwgbmV3IGJ5dGVbXSB7\nfSk7CgogICAgICAgIGJ5dGVbXSBlbnRyeSA9ICJUZXN0IEVudHJ5Ii5nZXRC\neXRlcygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykg\newogICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRyeSk7CiAgICAgICAgfQog\nICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGIwbGF0Y2ggPSBuZXcgQ291\nbnREb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2gg\nYjFsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBMaXN0\nPEluZXRTb2NrZXRBZGRyZXNzPiBjdXJFbnMgPSBsaC5nZXRMZWRnZXJNZXRh\nZGF0YSgpLmN1cnJlbnRFbnNlbWJsZTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBzbGVlcEJvb2tpZShjdXJFbnMuZ2V0KDApLCBiMGxhdGNoKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRyeSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc2xlZXBCb29raWUoY3VyRW5zLmdldCgyKSwgYjFsYXRj\naCk7IC8vIHNob3VsZCBjb3ZlciBhbGwgcXVvcnVtcwoKICAgICAgICAgICAg\nZmluYWwgQXRvbWljSW50ZWdlciBpID0gbmV3IEF0b21pY0ludGVnZXIoMHhk\nZWFkYmVlZik7CiAgICAgICAgICAgIEFzeW5jQ2FsbGJhY2suQWRkQ2FsbGJh\nY2sgY2IgPSBuZXcgQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjaygpIHsKICAg\nICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBhZGRDb21wbGV0ZShpbnQg\ncmMsIExlZGdlckhhbmRsZSBsaCwgbG9uZyBlbnRyeUlkLCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGkuc2V0KHJjKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAg\nICBsaC5hc3luY0FkZEVudHJ5KGVudHJ5LCBjYiwgbnVsbCk7CgogICAgICAg\nICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7IC8vIHNsZWVwIGEgc2Vjb25kIHRv\nIGFsbG93IHRpbWUgdG8gY29tcGxldGUKICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKGkuZ2V0KCksIDB4ZGVhZGJlZWYpOwogICAgICAgICAgICBiMGxhdGNo\nLmNvdW50RG93bigpOwogICAgICAgICAgICBiMWxhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICBUaHJlYWQuc2xlZXAoMjAwMCk7CiAgICAgICAgICAg\nIGFzc2VydEVxdWFscyhpLmdldCgpLCBCS0V4Y2VwdGlvbi5Db2RlLk9LKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBiMGxhdGNoLmNvdW50\nRG93bigpOwogICAgICAgICAgICBiMWxhdGNoLmNvdW50RG93bigpOwogICAg\nICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdEJvb2tpZUZhaWx1cmVXaXRoU2xvd0Jvb2tpZSgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIENsaWVudENvbmZpZ3VyYXRpb24g\nY29uZiA9IG5ldyBDbGllbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgY29u\nZi5zZXRaa1NlcnZlcnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJp\nbmcoKSkuc2V0UmVhZFRpbWVvdXQoNSk7CgogICAgICAgIEJvb2tLZWVwZXIg\nYmtjID0gbmV3IEJvb2tLZWVwZXIoY29uZik7CgogICAgICAgIGJ5dGVbXSBw\nd2QgPSBuZXcgYnl0ZVtdIHt9OwogICAgICAgIGZpbmFsIExlZGdlckhhbmRs\nZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoNCwgMywgMiwgQm9va0tlZXBlci5E\naWdlc3RUeXBlLkNSQzMyLCBwd2QpOwogICAgICAgIGxvbmcgbGlkID0gbGgu\nZ2V0SWQoKTsKICAgICAgICBmaW5hbCBBdG9taWNCb29sZWFuIGZpbmlzaGVk\nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAgICAgIGZpbmFsIEF0\nb21pY0Jvb2xlYW4gZmFpbFRlc3QgPSBuZXcgQXRvbWljQm9vbGVhbihmYWxz\nZSk7CiAgICAgICAgZmluYWwgYnl0ZVtdIGVudHJ5ID0gIlRlc3QgRW50cnki\nLmdldEJ5dGVzKCk7CiAgICAgICAgVGhyZWFkIHQgPSBuZXcgVGhyZWFkKCkg\newogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdo\naWxlICghZmluaXNoZWQuZ2V0KCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxoLmFkZEVudHJ5KGVudHJ5KTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhj\nZXB0aW9uIGluIGFkZCBlbnRyeSB0aHJlYWQiLCBlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgZmFpbFRlc3Quc2V0KHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAg\nICAgICB0LnN0YXJ0KCk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2gg\nYjBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBzdGFy\ndE5ld0Jvb2tpZSgpOwogICAgICAgIHNsZWVwQm9va2llKGdldEJvb2tpZSgw\nKSwgYjBsYXRjaCk7CiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDAwKTsKICAg\nICAgICBiMGxhdGNoLmNvdW50RG93bigpOwogICAgICAgIGZpbmlzaGVkLnNl\ndCh0cnVlKTsKICAgICAgICB0LmpvaW4oKTsKCiAgICAgICAgYXNzZXJ0RmFs\nc2UoZmFpbFRlc3QuZ2V0KCkpOwoKICAgICAgICBsaC5jbG9zZSgpOwoKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGgyID0gYmtjLm9wZW5MZWRnZXIobGguZ2V0\nSWQoKSwgQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMyLCBwd2QpOwogICAg\nICAgIExlZGdlckNoZWNrZXIgbGMgPSBuZXcgTGVkZ2VyQ2hlY2tlcihia2Mp\nOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGNoZWNrbGF0Y2ggPSBu\nZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgQXRvbWljSW50\nZWdlciBudW1GcmFnbWVudHMgPSBuZXcgQXRvbWljSW50ZWdlcigtMSk7CiAg\nICAgICAgbGMuY2hlY2tMZWRnZXIobGgyLCBuZXcgR2VuZXJpY0NhbGxiYWNr\nPFNldDxMZWRnZXJGcmFnbWVudD4+KCkgewogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBTZXQ8TGVkZ2Vy\nRnJhZ21lbnQ+IGZyYWdtZW50cykgewogICAgICAgICAgICAgICAgICAgIExP\nRy5kZWJ1ZygiQ2hlY2tlZCBsZWRnZXJzIHJldHVybmVkIHt9IHt9IiwgcmMs\nIGZyYWdtZW50cyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbnVtRnJhZ21lbnRzLnNldChmcmFnbWVudHMuc2l6ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2hlY2tsYXRjaC5j\nb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7\nCiAgICAgICAgY2hlY2tsYXRjaC5hd2FpdCgpOwogICAgICAgIGFzc2VydEVx\ndWFscygiVGhlcmUgc2hvdWxkIGJlIG5vIG1pc3NpbmcgZnJhZ21lbnRzIiwg\nMCwgbnVtRnJhZ21lbnRzLmdldCgpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1l\nb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE1hbnlCb29raWVGYWls\ndXJlV2l0aFNsb3dCb29raWVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mID0gbmV3IENsaWVudENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICBjb25mLnNldFprU2VydmVycyh6a1V0aWwu\nZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKS5zZXRSZWFkVGltZW91dCg1\nKTsKCiAgICAgICAgQm9va0tlZXBlciBia2MgPSBuZXcgQm9va0tlZXBlcihj\nb25mKTsKCiAgICAgICAgYnl0ZVtdIHB3ZCA9IG5ldyBieXRlW10ge307CiAg\nICAgICAgZmluYWwgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdl\ncig0LCAzLCAxLCBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsIHB3ZCk7\nCiAgICAgICAgbG9uZyBsaWQgPSBsaC5nZXRJZCgpOwogICAgICAgIGZpbmFs\nIEF0b21pY0Jvb2xlYW4gZmluaXNoZWQgPSBuZXcgQXRvbWljQm9vbGVhbihm\nYWxzZSk7CiAgICAgICAgZmluYWwgQXRvbWljQm9vbGVhbiBmYWlsVGVzdCA9\nIG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICBmaW5hbCBieXRl\nW10gZW50cnkgPSAiVGVzdCBFbnRyeSIuZ2V0Qnl0ZXMoKTsKICAgICAgICBU\naHJlYWQgdCA9IG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFmaW5pc2hlZC5nZXQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGguYWRkRW50cnkoZW50\ncnkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4gYWRkIGVudHJ5IHRo\ncmVhZCIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBmYWlsVGVzdC5z\nZXQodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9OwogICAgICAgIHQuc3RhcnQoKTsKICAgICAg\nICBmaW5hbCBDb3VudERvd25MYXRjaCBiMGxhdGNoID0gbmV3IENvdW50RG93\nbkxhdGNoKDEpOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGIxbGF0\nY2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAgICAgIHN0YXJ0TmV3\nQm9va2llKCk7CiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAg\nc2xlZXBCb29raWUoZ2V0Qm9va2llKDApLCBiMGxhdGNoKTsKICAgICAgICBz\nbGVlcEJvb2tpZShnZXRCb29raWUoMSksIGIxbGF0Y2gpOwoKICAgICAgICBU\naHJlYWQuc2xlZXAoMTAwMDApOwogICAgICAgIGIwbGF0Y2guY291bnREb3du\nKCk7CiAgICAgICAgYjFsYXRjaC5jb3VudERvd24oKTsKICAgICAgICBmaW5p\nc2hlZC5zZXQodHJ1ZSk7CiAgICAgICAgdC5qb2luKCk7CgogICAgICAgIGFz\nc2VydEZhbHNlKGZhaWxUZXN0LmdldCgpKTsKCiAgICAgICAgbGguY2xvc2Uo\nKTsKCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoMiA9IGJrYy5vcGVuTGVkZ2Vy\nKGxoLmdldElkKCksIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwgcHdk\nKTsKICAgICAgICBMZWRnZXJDaGVja2VyIGxjID0gbmV3IExlZGdlckNoZWNr\nZXIoYmtjKTsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBjaGVja2xh\ndGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIGZpbmFsIEF0\nb21pY0ludGVnZXIgbnVtRnJhZ21lbnRzID0gbmV3IEF0b21pY0ludGVnZXIo\nLTEpOwogICAgICAgIGxjLmNoZWNrTGVkZ2VyKGxoMiwgbmV3IEdlbmVyaWND\nYWxsYmFjazxTZXQ8TGVkZ2VyRnJhZ21lbnQ+PigpIHsKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgU2V0\nPExlZGdlckZyYWdtZW50PiBmcmFnbWVudHMpIHsKICAgICAgICAgICAgICAg\nICAgICBMT0cuZGVidWcoIkNoZWNrZWQgbGVkZ2VycyByZXR1cm5lZCB7fSB7\nfSIsIHJjLCBmcmFnbWVudHMpOwogICAgICAgICAgICAgICAgICAgIGlmIChy\nYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIG51bUZyYWdtZW50cy5zZXQoZnJhZ21lbnRzLnNpemUoKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNoZWNr\nbGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0pOwogICAgICAgIGNoZWNrbGF0Y2guYXdhaXQoKTsKICAgICAgICBh\nc3NlcnRFcXVhbHMoIlRoZXJlIHNob3VsZCBiZSBubyBtaXNzaW5nIGZyYWdt\nZW50cyIsIDAsIG51bUZyYWdtZW50cy5nZXQoKSk7CiAgICB9Cn0K\n","encoding":"base64"}

