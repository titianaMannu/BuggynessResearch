{"sha":"d175fec8ebe35ce560bb9ec028b284c8b2e8ff48","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDE3NWZlYzhlYmUzNWNlNTYwYmI5ZWMwMjhiMjg0YzhiMmU4ZmY0OA==","size":13930,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d175fec8ebe35ce560bb9ec028b284c8b2e8ff48","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgb3JnLmp1bml0Lio7CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkN5Y2xpY0JhcnJpZXI7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhh\nbmRsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVk\nZ2VyRW50cnk7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50\nLkJvb2tLZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tLZWVwZXJBZG1pbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LkJhc2VUZXN0Q2FzZTsKCmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\nckZhY3Rvcnk7CgovKioKICogVGhpcyB1bml0IHRlc3QgdGVzdHMgbGVkZ2Vy\nIGZlbmNpbmc7CiAqCiAqLwpwdWJsaWMgY2xhc3MgVGVzdEZlbmNpbmcgZXh0\nZW5kcyBCYXNlVGVzdENhc2UgewogICAgc3RhdGljIExvZ2dlciBMT0cgPSBM\nb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZXN0RmVuY2luZy5jbGFzcyk7Cgog\nICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwoKICAgIHB1YmxpYyBUZXN0RmVu\nY2luZyhEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHsKICAgICAgICBzdXBlcigx\nMCk7CiAgICAgICAgdGhpcy5kaWdlc3RUeXBlID0gZGlnZXN0VHlwZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEJhc2ljIGZlbmNpbmcgdGVzdC4gQ3JlYXRl\nIGxlZGdlciwgd3JpdGUgdG8gaXQsCiAgICAgKiBvcGVuIGxlZGdlciwgd3Jp\ndGUgYWdhaW4gKHNob3VsZCBmYWlsKS4KICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RCYXNpY0ZlbmNpbmco\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvKgogICAgICAgICAqIENy\nZWF0ZSBsZWRnZXIuCiAgICAgICAgICovCiAgICAgICAgTGVkZ2VySGFuZGxl\nIHdyaXRlbGggPSBudWxsOwogICAgICAgIHdyaXRlbGggPSBia2MuY3JlYXRl\nTGVkZ2VyKGRpZ2VzdFR5cGUsICJwYXNzd29yZCIuZ2V0Qnl0ZXMoKSk7Cgog\nICAgICAgIFN0cmluZyB0bXAgPSAiQm9va0tlZXBlciBpcyBjb29sISI7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAg\nICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAg\nIH0KCiAgICAgICAgLyoKICAgICAgICAgKiBUcnkgdG8gb3BlbiBsZWRnZXIu\nCiAgICAgICAgICovCiAgICAgICAgTGVkZ2VySGFuZGxlIHJlYWRsaCA9IGJr\nYy5vcGVuTGVkZ2VyKHdyaXRlbGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgInBh\nc3N3b3JkIi5nZXRCeXRlcygpKTsKICAgICAgICAvLyBzaG91bGQgaGF2ZSB0\ncmlnZ2VyZWQgcmVjb3ZlcnkgYW5kIGZlbmNpbmcKICAgICAgICAKICAgICAg\nICB0cnkgewogICAgICAgICAgICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRC\neXRlcygpKTsKICAgICAgICAgICAgTE9HLmVycm9yKCJTaG91bGQgaGF2ZSB0\naHJvd24gYW4gZXhjZXB0aW9uIik7CiAgICAgICAgICAgIGZhaWwoIlNob3Vs\nZCBoYXZlIHRocm93biBhbiBleGNlcHRpb24gd2hlbiB0cnlpbmcgdG8gd3Jp\ndGUiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0xlZGdlckZl\nbmNlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVo\nYXZpb3VyCiAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgLyoK\nICAgICAgICAgKiBDaGVjayBpZiBoYXMgcmVjb3ZlcmVkIHByb3Blcmx5Lgog\nICAgICAgICAqLwogICAgICAgIGFzc2VydFRydWUoIkhhcyBub3QgcmVjb3Zl\ncmVkIGNvcnJlY3RseTogIiArIHJlYWRsaC5nZXRMYXN0QWRkQ29uZmlybWVk\nKCkgCiAgICAgICAgICAgICAgICAgICArICIgb3JpZ2luYWwgIiArIHdyaXRl\nbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpLAogICAgICAgICAgICAgICAgICAg\ncmVhZGxoLmdldExhc3RBZGRDb25maXJtZWQoKSA9PSB3cml0ZWxoLmdldExh\nc3RBZGRDb25maXJtZWQoKSk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMg\naW50IHRocmVhZENvdW50ID0gMDsKCiAgICBjbGFzcyBMZWRnZXJPcGVuVGhy\nZWFkIGV4dGVuZHMgVGhyZWFkIHsKICAgICAgICBwcml2YXRlIGZpbmFsIGxv\nbmcgbGVkZ2VySWQ7CiAgICAgICAgcHJpdmF0ZSBsb25nIGxhc3RDb25maXJt\nZWRFbnRyeSA9IDA7CgogICAgICAgIAogICAgICAgIHByaXZhdGUgZmluYWwg\nRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwogICAgICAgIHByaXZhdGUgZmluYWwg\nQ3ljbGljQmFycmllciBiYXJyaWVyOwoKICAgICAgICBMZWRnZXJPcGVuVGhy\nZWFkIChEaWdlc3RUeXBlIGRpZ2VzdFR5cGUsIGxvbmcgbGVkZ2VySWQsIEN5\nY2xpY0JhcnJpZXIgYmFycmllcikKICAgICAgICAgICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgICAgICBzdXBlcigiVGVzdEZlbmNpbmctTGVk\nZ2VyT3BlblRocmVhZC0iICsgdGhyZWFkQ291bnQrKyk7CiAgICAgICAgICAg\nIHRoaXMubGVkZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5k\naWdlc3RUeXBlID0gZGlnZXN0VHlwZTsKICAgICAgICAgICAgdGhpcy5iYXJy\naWVyID0gYmFycmllcjsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICBMZWRnZXJIYW5kbGUgbGggPSBudWxsOwogICAgICAgICAgICBCb29rS2Vl\ncGVyIGJrID0gbnVsbDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGJhcnJpZXIuYXdhaXQoKTsKICAgICAgICAgICAgICAgIHdoaWxlKHRy\ndWUpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICBiayA9IG5ldyBCb29rS2VlcGVyKG5ldyBDbGllbnRDb25m\naWd1cmF0aW9uKGJhc2VDbGllbnRDb25mKSwgYmtjLmdldFprSGFuZGxlKCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAg\nICAgICAgbGggPSBiay5vcGVuTGVkZ2VyKGxlZGdlcklkLCAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpZ2VzdFR5cGUs\nICIiLmdldEJ5dGVzKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBsYXN0\nQ29uZmlybWVkRW50cnkgPSBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEJLRXhjZXB0aW9uLkJLTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uIHpr\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiQ29udGVu\ndGlvbiB3aXRoIHNvbWVvbmUgZWxzZSByZWNvdmVyaW5nIik7CiAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktMZWRnZXJSZWNv\ndmVyeUV4Y2VwdGlvbiBia3JlKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5pbmZvKCJDb250ZW50aW9uIHdpdGggc29tZW9uZSBlbHNlIHJlY292\nZXJpbmciKTsKICAgICAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobGggIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmsg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmsuY2xv\nc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJrID0gbnVsbDsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIGp1c3QgZXhpdCwgdGVz\ndCBzaG91bGQgc3BvdCBiYWQgbGFzdCBhZGQgY29uZmlybWVkCiAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBvY2N1cnJlZCAiLCBlKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBMT0cuaW5mbygiVGhyZWFkIGV4\naXRpbmcsIGxhc3RDb25maXJtZWRFbnRyeSA9ICIgKyBsYXN0Q29uZmlybWVk\nRW50cnkpOwogICAgICAgIH0KCiAgICAgICAgbG9uZyBnZXRMYXN0Q29uZmly\nbWVkRW50cnkoKSB7CiAgICAgICAgICAgIHJldHVybiBsYXN0Q29uZmlybWVk\nRW50cnk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVHJ5IHRv\nIG9wZW4gYSBsZWRnZXIgbWFueSB0aW1lcyBpbiBwYXJhbGxlbC4KICAgICAq\nIEFsbCBvcGVucyBzaG91bGQgcmVzdWx0IGluIGEgbGVkZ2VyIHdpdGggYW4g\nZXF1YWxzIG51bWJlciBvZiAKICAgICAqIGVudHJpZXMuCiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0TWFu\neU9wZW5QYXJhbGxlbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8q\nCiAgICAgICAgICogQ3JlYXRlIGxlZGdlci4KICAgICAgICAgKi8KICAgICAg\nICBmaW5hbCBMZWRnZXJIYW5kbGUgd3JpdGVsaCA9IGJrYy5jcmVhdGVMZWRn\nZXIoZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIGZpbmFs\nIGludCBudW1SZWNvdmVyeSA9IDEwOwoKICAgICAgICBmaW5hbCBTdHJpbmcg\ndG1wID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZpbmFsIENv\ndW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKG51bVJl\nY292ZXJ5KTsKICAgICAgICBUaHJlYWQgd3JpdGV0aHJlYWQgPSBuZXcgVGhy\nZWFkKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmluZm8oIkV4Y2VwdGlvbiBhZGRpbmcgZW50cnkiLCBlKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07\nCiAgICAgICAgd3JpdGV0aHJlYWQuc3RhcnQoKTsKCgogICAgICAgIEN5Y2xp\nY0JhcnJpZXIgYmFycmllciA9IG5ldyBDeWNsaWNCYXJyaWVyKG51bVJlY292\nZXJ5KzEpOwogICAgICAgIExlZGdlck9wZW5UaHJlYWQgdGhyZWFkc1tdID0g\nbmV3IExlZGdlck9wZW5UaHJlYWRbbnVtUmVjb3ZlcnldOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbnVtUmVjb3Zlcnk7IGkrKykgewogICAgICAg\nICAgICB0aHJlYWRzW2ldID0gbmV3IExlZGdlck9wZW5UaHJlYWQoZGlnZXN0\nVHlwZSwgd3JpdGVsaC5nZXRJZCgpLCBiYXJyaWVyKTsKICAgICAgICAgICAg\ndGhyZWFkc1tpXS5zdGFydCgpOwogICAgICAgIH0KICAgICAgICBsYXRjaC5h\nd2FpdCgpOwogICAgICAgIGJhcnJpZXIuYXdhaXQoKTsgLy8gc2hvdWxkIHRy\naWdnZXIgdGhyZWFkcyB0byBnbwoKICAgICAgICB3cml0ZXRocmVhZC5qb2lu\nKCk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gd3JpdGVsaC5nZXRM\nYXN0QWRkQ29uZmlybWVkKCk7CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBudW1SZWNvdmVyeTsgaSsrKSB7CiAgICAgICAgICAgIHRo\ncmVhZHNbaV0uam9pbigpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJBZGRl\nZCBjb25maXJtZWQgaXMgaW5jb3JyZWN0IiwgCiAgICAgICAgICAgICAgICAg\nICAgICAgbGFzdENvbmZpcm1lZCA8PSB0aHJlYWRzW2ldLmdldExhc3RDb25m\naXJtZWRFbnRyeSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUZXN0IHRoYXQgb3BlbmluZyBhIGxlZGdlciBpbiBub3JlY292ZXJ5IG1v\nZGUKICAgICAqIGRvZXNuJ3QgZmVuY2Ugb2ZmIGEgbGVkZ2VyCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nTm9SZWNvdmVyeU9wZW4oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAv\nKgogICAgICAgICAqIENyZWF0ZSBsZWRnZXIuCiAgICAgICAgICovCiAgICAg\nICAgTGVkZ2VySGFuZGxlIHdyaXRlbGggPSBudWxsOwogICAgICAgIHdyaXRl\nbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVz\nKCkpOwoKICAgICAgICBTdHJpbmcgdG1wID0gIkJvb2tLZWVwZXIgaXMgY29v\nbCEiOwogICAgICAgIGZpbmFsIGludCBudW1FbnRyaWVzID0gMTA7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAg\nICAgICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAg\nICAgICAgfQoKICAgICAgICAvKgogICAgICAgICAqIFRyeSB0byBvcGVuIGxl\nZGdlci4KICAgICAgICAgKi8KICAgICAgICBMZWRnZXJIYW5kbGUgcmVhZGxo\nID0gYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KHdyaXRlbGguZ2V0SWQoKSwg\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAg\nICAgLy8gc2hvdWxkIG5vdCBoYXZlIHRyaWdnZXJlZCByZWNvdmVyeSBhbmQg\nZmVuY2luZwogICAgICAgIAogICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1w\nLmdldEJ5dGVzKCkpOwogICAgICAgIGxvbmcgbnVtUmVhZGFibGUgPSByZWFk\nbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpOwogICAgICAgIExPRy5lcnJvcigi\nbnVtUmVhZCAiICsgbnVtUmVhZGFibGUpOwogICAgICAgIEVudW1lcmF0aW9u\nPExlZGdlckVudHJ5PiBlbnRyaWVzID0gcmVhZGxoLnJlYWRFbnRyaWVzKDEs\nIG51bVJlYWRhYmxlKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZWFk\nbGgucmVhZEVudHJpZXMobnVtUmVhZGFibGUrMSwgbnVtUmVhZGFibGUrMSk7\nCiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0\nbyByZWFkIHRoaXMgZmFyIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRp\nb24uQktSZWFkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gYWxsIGlz\nIGdvb2QKICAgICAgICB9CgogICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1w\nLmdldEJ5dGVzKCkpOwogICAgICAgIGxvbmcgbnVtUmVhZGFibGUyID0gcmVh\nZGxoLmdldExhc3RBZGRDb25maXJtZWQoKTsKICAgICAgICBhc3NlcnRFcXVh\nbHMoIk51bWJlciBvZiByZWFkYWJsZSBlbnRyaWVzIGhhc24ndCBjaGFuZ2Vk\nIiwgbnVtUmVhZGFibGUyLCBudW1SZWFkYWJsZSk7CiAgICAgICAgcmVhZGxo\nLmNsb3NlKCk7CgogICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5\ndGVzKCkpOwogICAgICAgIHdyaXRlbGguY2xvc2UoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIGNyZWF0ZSBhIGxlZGdlciBhbmQgd3JpdGUgZW50cmllcy4g\nCiAgICAgKiBraWxsIGEgYm9va2llIGluIHRoZSBlbnNlbWJsZS4gUmVjb3Zl\nci4KICAgICAqIEZlbmNlIHRoZSBsZWRnZXIuIEtpbGwgYW5vdGhlciBib29r\naWUuIFJlY292ZXIuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0RmVuY2luZ0ludGVyYWN0aW9uV2l0aEJv\nb2tpZVJlY292ZXJ5KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3lz\ndGVtLnNldFByb3BlcnR5KCJkaWdlc3RUeXBlIiwgZGlnZXN0VHlwZS50b1N0\ncmluZygpKTsKICAgICAgICBTeXN0ZW0uc2V0UHJvcGVydHkoInBhc3N3ZCIs\nICJ0ZXN0UGFzc3dkIik7CgogICAgICAgIEJvb2tLZWVwZXJBZG1pbiBhZG1p\nbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oemtVdGlsLmdldFpvb0tlZXBlckNv\nbm5lY3RTdHJpbmcoKSk7CgogICAgICAgIExlZGdlckhhbmRsZSB3cml0ZWxo\nID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCAidGVzdFBhc3N3ZCIu\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgCiAgICAgICAgU3RyaW5nIHRtcCA9ICJG\nb29iYXIiOwogICAgICAgIAogICAgICAgIGZpbmFsIGludCBudW1FbnRyaWVz\nID0gMTA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVz\nOyBpKyspIHsKICAgICAgICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0\nQnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICBJbmV0U29ja2V0QWRkcmVz\ncyBib29raWVUb0tpbGwgCiAgICAgICAgICAgID0gd3JpdGVsaC5nZXRMZWRn\nZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlKG51bUVudHJpZXMpLmdldCgwKTsK\nICAgICAgICBraWxsQm9va2llKGJvb2tpZVRvS2lsbCk7CgogICAgICAgIC8v\nIHdyaXRlIGVudHJpZXMgdG8gY2hhbmdlIGVuc2VtYmxlCiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAg\nICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAg\nfQoKICAgICAgICBhZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29raWVUb0tp\nbGwsIG51bGwpOwogICAgICAgIAogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIHdyaXRlbGguYWRk\nRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgTGVk\nZ2VySGFuZGxlIHJlYWRsaCA9IGJrYy5vcGVuTGVkZ2VyKHdyaXRlbGguZ2V0\nSWQoKSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGRpZ2VzdFR5cGUsICJ0ZXN0UGFzc3dkIi5nZXRCeXRlcygpKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICB3cml0ZWxoLmFkZEVudHJ5KHRt\ncC5nZXRCeXRlcygpKTsKICAgICAgICAgICAgTE9HLmVycm9yKCJTaG91bGQg\naGF2ZSB0aHJvd24gYW4gZXhjZXB0aW9uIik7CiAgICAgICAgICAgIGZhaWwo\nIlNob3VsZCBoYXZlIHRocm93biBhbiBleGNlcHRpb24gd2hlbiB0cnlpbmcg\ndG8gd3JpdGUiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0xl\nZGdlckZlbmNlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJl\nY3QgYmVoYXZpb3VyCiAgICAgICAgfQoKICAgICAgICByZWFkbGguY2xvc2Uo\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3cml0ZWxoLmNsb3NlKCk7\nCiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBmYWlsIHRyeWluZyB0byB1cGRh\ndGUgbWV0YWRhdGEiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5C\nS01ldGFkYXRhVmVyc2lvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8v\nIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogY3JlYXRlIGEgbGVkZ2VyIGFuZCB3cml0ZSBlbnRyaWVzLiAKICAg\nICAqIEZlbmNlIHRoZSBsZWRnZXIuIEtpbGwgYSBib29raWUuIFJlY292ZXIu\nCiAgICAgKiBFbnN1cmUgdGhhdCByZWNvdmVyIGRvZXNuJ3QgcmVhbGxvdyBh\nZGRpbmcKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RGZW5jaW5nSW50ZXJhY3Rpb25XaXRoQm9va2llUmVj\nb3ZlcnkyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3lzdGVtLnNl\ndFByb3BlcnR5KCJkaWdlc3RUeXBlIiwgZGlnZXN0VHlwZS50b1N0cmluZygp\nKTsKICAgICAgICBTeXN0ZW0uc2V0UHJvcGVydHkoInBhc3N3ZCIsICJ0ZXN0\nUGFzc3dkIik7CgogICAgICAgIEJvb2tLZWVwZXJBZG1pbiBhZG1pbiA9IG5l\ndyBCb29rS2VlcGVyQWRtaW4oemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RT\ndHJpbmcoKSk7CgogICAgICAgIExlZGdlckhhbmRsZSB3cml0ZWxoID0gYmtj\nLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0\nZXMoKSk7CiAgICAgICAgCiAgICAgICAgU3RyaW5nIHRtcCA9ICJGb29iYXIi\nOwogICAgICAgIAogICAgICAgIGZpbmFsIGludCBudW1FbnRyaWVzID0gMTA7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKysp\nIHsKICAgICAgICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMo\nKSk7CiAgICAgICAgfQoKICAgICAgICBMZWRnZXJIYW5kbGUgcmVhZGxoID0g\nYmtjLm9wZW5MZWRnZXIod3JpdGVsaC5nZXRJZCgpLCAKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlnZXN0VHlwZSwg\nInRlc3RQYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAgIC8vIHNob3VsZCBi\nZSBmZW5jZWQgYnkgbm93CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9v\na2llVG9LaWxsIAogICAgICAgICAgICA9IHdyaXRlbGguZ2V0TGVkZ2VyTWV0\nYWRhdGEoKS5nZXRFbnNlbWJsZShudW1FbnRyaWVzKS5nZXQoMCk7CiAgICAg\nICAga2lsbEJvb2tpZShib29raWVUb0tpbGwpOwogICAgICAgIGFkbWluLnJl\nY292ZXJCb29raWVEYXRhKGJvb2tpZVRvS2lsbCwgbnVsbCk7CgogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5\ndGVzKCkpOwogICAgICAgICAgICBMT0cuZXJyb3IoIlNob3VsZCBoYXZlIHRo\ncm93biBhbiBleGNlcHRpb24iKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxk\nIGhhdmUgdGhyb3duIGFuIGV4Y2VwdGlvbiB3aGVuIHRyeWluZyB0byB3cml0\nZSIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTGVkZ2VyRmVu\nY2VkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhh\ndmlvdXIKICAgICAgICB9CgogICAgICAgIHJlYWRsaC5jbG9zZSgpOwoKICAg\nICAgICB0cnkgewogICAgICAgICAgICB3cml0ZWxoLmNsb3NlKCk7CiAgICAg\nICAgICAgIGZhaWwoIlNob3VsZCBmYWlsIHRyeWluZyB0byB1cGRhdGUgbWV0\nYWRhdGEiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS01ldGFk\nYXRhVmVyc2lvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJl\nY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCB0aGF0IGZlbmNpbmcgZG9lc24ndCB3b3JrIHdpdGggYSBiYWQgcGFz\nc3dvcmQKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RGZW5jaW5nQmFkUGFzc3dvcmQoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAvKgogICAgICAgICAqIENyZWF0ZSBsZWRnZXIu\nCiAgICAgICAgICovCiAgICAgICAgTGVkZ2VySGFuZGxlIHdyaXRlbGggPSBu\ndWxsOwogICAgICAgIHdyaXRlbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2Vz\ndFR5cGUsICJwYXNzd29yZDEiLmdldEJ5dGVzKCkpOwoKICAgICAgICBTdHJp\nbmcgdG1wID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICB3cml0ZWxo\nLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICB9CgogICAgICAg\nIC8qCiAgICAgICAgICogVHJ5IHRvIG9wZW4gbGVkZ2VyLgogICAgICAgICAq\nLwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExlZGdlckhhbmRsZSByZWFk\nbGggPSBia2Mub3BlbkxlZGdlcih3cml0ZWxoLmdldElkKCksIGRpZ2VzdFR5\ncGUsICJiYWRQYXNzd29yZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIGZh\naWwoIlNob3VsZCBub3QgaGF2ZSBiZWVuIGFibGUgdG8gb3BlbiB3aXRoIGEg\nYmFkIHBhc3N3b3JkIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24u\nQktVbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb24gdXVlKSB7CiAgICAgICAg\nICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgICAgIC8v\nIHNob3VsZCBoYXZlIHRyaWdnZXJlZCByZWNvdmVyeSBhbmQgZmVuY2luZwoK\nICAgICAgICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAg\nIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEZlbmNpbmdBbmRS\nZXN0YXJ0Qm9va2llcygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExl\nZGdlckhhbmRsZSB3cml0ZWxoID0gbnVsbDsKICAgICAgICB3cml0ZWxoID0g\nYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCAicGFzc3dvcmQiLmdldEJ5\ndGVzKCkpOwoKICAgICAgICBTdHJpbmcgdG1wID0gIkJvb2tLZWVwZXIgaXMg\nY29vbCEiOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykg\newogICAgICAgICAgICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygp\nKTsKICAgICAgICB9CgogICAgICAgIC8qCiAgICAgICAgICogVHJ5IHRvIG9w\nZW4gbGVkZ2VyLgogICAgICAgICAqLwogICAgICAgIExlZGdlckhhbmRsZSBy\nZWFkbGggPSBia2Mub3BlbkxlZGdlcih3cml0ZWxoLmdldElkKCksIGRpZ2Vz\ndFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICJwYXNzd29yZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIHJlc3Rh\ncnRCb29raWVzKCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdyaXRl\nbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAgICAgICBMT0cu\nZXJyb3IoIlNob3VsZCBoYXZlIHRocm93biBhbiBleGNlcHRpb24iKTsKICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkIGhhdmUgdGhyb3duIGFuIGV4Y2VwdGlv\nbiB3aGVuIHRyeWluZyB0byB3cml0ZSIpOwogICAgICAgIH0gY2F0Y2ggKEJL\nRXhjZXB0aW9uLkJLTGVkZ2VyRmVuY2VkRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CgogICAgICAg\nIHJlYWRsaC5jbG9zZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

