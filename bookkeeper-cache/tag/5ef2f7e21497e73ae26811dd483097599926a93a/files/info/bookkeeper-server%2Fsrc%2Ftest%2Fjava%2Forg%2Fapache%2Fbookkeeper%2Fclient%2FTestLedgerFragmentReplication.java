{"sha":"b250777827c6a0988e3590d65d7469cbde2495fa","node_id":"MDQ6QmxvYjE1NzU5NTY6YjI1MDc3NzgyN2M2YTA5ODhlMzU5MGQ2NWQ3NDY5Y2JkZTI0OTVmYQ==","size":13279,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b250777827c6a0988e3590d65d7469cbde2495fa","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZSAKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24gCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UgCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQgCiAqIAogKiAgIGh0dHA6Ly93\nd3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMCAKICogCiAqIFVu\nbGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8g\naW4gd3JpdGluZywgCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRo\nZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIAogKiAiQVMgSVMiIEJB\nU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkg\nCiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhl\nIExpY2Vuc2UgZm9yIHRoZSAKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJu\naW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyAKICogdW5kZXIgdGhl\nIExpY2Vuc2UuIAogKiAKICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudDsKCmltcG9ydCBqYXZhLm5ldC5JbmV0QWRkcmVzczsKaW1w\nb3J0IGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVk\nTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRyeTsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBl\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVw\nZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdC5Cb29rS2VlcGVyQ2x1c3RlclRl\nc3RDYXNlOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7Cgov\nKioKICogVGVzdHMgQktBZG1pbiB0aGF0IGl0IHNob3VsZCBiZSBhYmxlIHRv\nIHJlcGxpY2F0ZSB0aGUgZmFpbGVkIGJvb2tpZSBmcmFnbWVudHMKICogdG8g\ndGFyZ2V0IGJvb2tpZS4KICovCnB1YmxpYyBjbGFzcyBUZXN0TGVkZ2VyRnJh\nZ21lbnRSZXBsaWNhdGlvbiBleHRlbmRzIEJvb2tLZWVwZXJDbHVzdGVyVGVz\ndENhc2UgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGJ5dGVbXSBURVNU\nX1BTU1dEID0gInRlc3RwYXNzd2QiLmdldEJ5dGVzKCk7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBEaWdlc3RUeXBlIFRFU1RfRElHRVNUX1RZUEUgPSBC\nb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzI7CiAgICBwcml2YXRlIHN0YXRp\nYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeQogICAgICAgICAgICAuZ2V0\nTG9nZ2VyKFRlc3RMZWRnZXJGcmFnbWVudFJlcGxpY2F0aW9uLmNsYXNzKTsK\nCiAgICBwdWJsaWMgVGVzdExlZGdlckZyYWdtZW50UmVwbGljYXRpb24oKSB7\nCiAgICAgICAgc3VwZXIoMyk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMg\nY2xhc3MgQ2hlY2tlckNhbGxiYWNrIGltcGxlbWVudHMKICAgICAgICAgICAg\nR2VuZXJpY0NhbGxiYWNrPFNldDxMZWRnZXJGcmFnbWVudD4+IHsKICAgICAg\nICBwcml2YXRlIFNldDxMZWRnZXJGcmFnbWVudD4gcmVzdWx0ID0gbnVsbDsK\nICAgICAgICBwcml2YXRlIENvdW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENv\ndW50RG93bkxhdGNoKDEpOwoKICAgICAgICBTZXQ8TGVkZ2VyRnJhZ21lbnQ+\nIHdhaXRBbmRHZXRSZXN1bHQoKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRp\nb24gewogICAgICAgICAgICBsYXRjaC5hd2FpdCgpOwogICAgICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBT\nZXQ8TGVkZ2VyRnJhZ21lbnQ+IHJlc3VsdCkgewogICAgICAgICAgICB0aGlz\nLnJlc3VsdCA9IHJlc3VsdDsKICAgICAgICAgICAgbGF0Y2guY291bnREb3du\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdHMgdGhh\ndCByZXBsaWNhdGUgbWV0aG9kIHNob3VsZCByZXBsaWNhdGUgdGhlIGZhaWxl\nZCBib29raWUgZnJhZ21lbnRzCiAgICAgKiB0byB0YXJnZXQgYm9va2llIHBh\nc3NlZC4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RSZXBsaWNhdGVMRlNob3VsZENvcHlGYWlsZWRCb29r\naWVGcmFnbWVudHNUb1RhcmdldEJvb2tpZSgpCiAgICAgICAgICAgIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIGJ5dGVbXSBkYXRhID0gIlRlc3RMZWRn\nZXJGcmFnbWVudFJlcGxpY2F0aW9uIi5nZXRCeXRlcygpOwogICAgICAgIExl\nZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoMywgMywgVEVTVF9E\nSUdFU1RfVFlQRSwKICAgICAgICAgICAgICAgIFRFU1RfUFNTV0QpOwoKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAg\nICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwgPSBsaC5nZXRMZWRnZXJNZXRh\nZGF0YSgpLmdldEVuc2VtYmxlcygpCiAgICAgICAgICAgICAgICAuZ2V0KDBM\nKS5nZXQoMCk7CgogICAgICAgIExPRy5pbmZvKCJLaWxsaW5nIEJvb2tpZSIs\nIHJlcGxpY2FUb0tpbGwpOwogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRv\nS2lsbCk7CgogICAgICAgIGludCBzdGFydE5ld0Jvb2tpZSA9IHN0YXJ0TmV3\nQm9va2llKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsr\nKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0K\nCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgbmV3QmtBZGRyID0gbmV3IElu\nZXRTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAu\nZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29r\naWUpOwogICAgICAgIExPRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBu\nZXdCa0FkZHIpOwogICAgICAgIFNldDxMZWRnZXJGcmFnbWVudD4gcmVzdWx0\nID0gZ2V0RnJhZ21lbnRzVG9SZXBsaWNhdGUobGgpOwoKICAgICAgICBCb29r\nS2VlcGVyQWRtaW4gYWRtaW4gPSBuZXcgQm9va0tlZXBlckFkbWluKGJhc2VD\nbGllbnRDb25mKTsKICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIC8vIDAt\nOSBlbnRyaWVzIHNob3VsZCBiZSBjb3B5IHRvIG5ldyBib29raWUKICAgICAg\nICAKICAgICAgICBmb3IgKExlZGdlckZyYWdtZW50IGxmIDogcmVzdWx0KSB7\nCiAgICAgICAgICAgIGFkbWluLnJlcGxpY2F0ZUxlZGdlckZyYWdtZW50KGxo\nLCBsZiwgbmV3QmtBZGRyKTsKICAgICAgICB9CgogICAgICAgIC8vIEtpbGxp\nbmcgYWxsIGJvb2tpZXMgZXhjZXB0IG5ld2x5IHJlcGxpY2F0ZWQgYm9va2ll\nCiAgICAgICAgU29ydGVkTWFwPExvbmcsIEFycmF5TGlzdDxJbmV0U29ja2V0\nQWRkcmVzcz4+IGFsbEJvb2tpZXNCZWZvcmVSZXBsaWNhdGlvbiA9IGxoCiAg\nICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJs\nZXMoKTsKICAgICAgICBTZXQ8RW50cnk8TG9uZywgQXJyYXlMaXN0PEluZXRT\nb2NrZXRBZGRyZXNzPj4+IGVudHJ5U2V0ID0gYWxsQm9va2llc0JlZm9yZVJl\ncGxpY2F0aW9uCiAgICAgICAgICAgICAgICAuZW50cnlTZXQoKTsKICAgICAg\nICBmb3IgKEVudHJ5PExvbmcsIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVz\ncz4+IGVudHJ5IDogZW50cnlTZXQpIHsKICAgICAgICAgICAgQXJyYXlMaXN0\nPEluZXRTb2NrZXRBZGRyZXNzPiBib29raWVzID0gZW50cnkuZ2V0VmFsdWUo\nKTsKICAgICAgICAgICAgZm9yIChJbmV0U29ja2V0QWRkcmVzcyBib29raWUg\nOiBib29raWVzKSB7CiAgICAgICAgICAgICAgICBpZiAobmV3QmtBZGRyLmVx\ndWFscyhib29raWUpKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBraWxsQm9va2ll\nKGJvb2tpZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8v\nIFNob3VsZCBiZSBhYmxlIHRvIHJlYWQgdGhlIGVudHJpZXMgZnJvbSAwLTkK\nICAgICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxoLCAwLCA5KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRlc3RzIHRoYXQgZnJhZ21lbnQgcmUtcmVw\nbGljYXRpb24gZmFpbHMgb24gbGFzdCB1bmNsb3NlZCBsZWRnZXIKICAgICAq\nIGZyYWdtZW50cy4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RSZXBsaWNhdGVMRkZhaWxzT25seU9uTGFz\ndFVuQ2xvc2VkRnJhZ21lbnRzKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgYnl0ZVtdIGRhdGEgPSAiVGVzdExlZGdlckZyYWdt\nZW50UmVwbGljYXRpb24iLmdldEJ5dGVzKCk7CiAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBURVNUX0RJR0VTVF9U\nWVBFLAogICAgICAgICAgICAgICAgVEVTVF9QU1NXRCk7CgogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5h\nZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAgICAgICAgSW5ldFNvY2tldEFk\nZHJlc3MgcmVwbGljYVRvS2lsbCA9IGxoLmdldExlZGdlck1ldGFkYXRhKCku\nZ2V0RW5zZW1ibGVzKCkKICAgICAgICAgICAgICAgIC5nZXQoMEwpLmdldCgw\nKTsKCiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKICAgICAgICBMT0cuaW5m\nbygiS2lsbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxsKTsKICAgICAgICBr\naWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICAvLyBMZXRzIHJl\nZm9ybSBlbnNlbWJsZQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7\nIGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAg\nICB9CgogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwy\nID0gbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKQogICAgICAgICAgICAgICAgLmdl\ndEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDEpOwoKICAgICAgICBpbnQgc3Rh\ncnROZXdCb29raWUyID0gc3RhcnROZXdCb29raWUoKTsKICAgICAgICBMT0cu\naW5mbygiS2lsbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxsMik7CiAgICAg\nICAga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsMik7CgogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIG5ld0JrQWRkciA9IG5ldyBJbmV0U29ja2V0QWRkcmVz\ncyhJbmV0QWRkcmVzcwogICAgICAgICAgICAgICAgLmdldExvY2FsSG9zdCgp\nLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3Qm9va2llMik7CiAgICAgICAg\nTE9HLmluZm8oIk5ldyBCb29raWUgYWRkciA6IiArIG5ld0JrQWRkcik7CiAg\nICAgICAgU2V0PExlZGdlckZyYWdtZW50PiByZXN1bHQgPSBnZXRGcmFnbWVu\ndHNUb1JlcGxpY2F0ZShsaCk7CgogICAgICAgIEJvb2tLZWVwZXJBZG1pbiBh\nZG1pbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYmFzZUNsaWVudENvbmYpOwog\nICAgICAgIC8vIDAtOSBlbnRyaWVzIHNob3VsZCBiZSBjb3B5IHRvIG5ldyBi\nb29raWUKCiAgICAgICAgaW50IHVuY2xvc2VkQ291bnQgPSAwOwogICAgICAg\nIGZvciAoTGVkZ2VyRnJhZ21lbnQgbGYgOiByZXN1bHQpIHsKICAgICAgICAg\nICAgaWYgKGxmLmlzQ2xvc2VkKCkpIHsKICAgICAgICAgICAgICAgIGFkbWlu\nLnJlcGxpY2F0ZUxlZGdlckZyYWdtZW50KGxoLCBsZiwgbmV3QmtBZGRyKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVuY2xvc2Vk\nQ291bnQrKzsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgYWRtaW4ucmVwbGljYXRlTGVkZ2VyRnJhZ21lbnQobGgsIGxmLCBu\nZXdCa0FkZHIpOwogICAgICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4n\ndCBiZSBhYmxlIHRvIHJlcmVwbGljYXRlIHVuY2xvc2VkIGxlZGdlciIpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gYmtlKSB7CiAg\nICAgICAgICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBh\nc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBvbmx5IG9uZSB1bmNsb3NlZCBmcmFn\nbWVudCIsIDEsIHVuY2xvc2VkQ291bnQpOwogICAgfQogICAgCiAgICAvKioK\nICAgICAqIFRlc3RzIHRoYXQgUmVwbGljYXRlTGVkZ2VyRnJhZ21lbnQgc2hv\ndWxkIHJldHVybiBmYWxzZSBpZiByZXBsaWNhdGlvbgogICAgICogZmFpbHMK\nICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RSZXBsaWNhdGVMRlNob3VsZFJldHVybkZhbHNlSWZUaGVSZXBs\naWNhdGlvbkZhaWxzKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgYnl0ZVtdIGRhdGEgPSAiVGVzdExlZGdlckZyYWdtZW50UmVw\nbGljYXRpb24iLmdldEJ5dGVzKCk7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxo\nID0gYmtjLmNyZWF0ZUxlZGdlcigyLCAxLCBURVNUX0RJR0VTVF9UWVBFLAog\nICAgICAgICAgICAgICAgVEVTVF9QU1NXRCk7CgogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRy\neShkYXRhKTsKICAgICAgICB9CgogICAgICAgIC8vIEtpbGwgdGhlIGZpcnN0\nIEJvb2tpZQogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tp\nbGwgPSBsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpCiAg\nICAgICAgICAgICAgICAuZ2V0KDBMKS5nZXQoMCk7CiAgICAgICAga2lsbEJv\nb2tpZShyZXBsaWNhVG9LaWxsKTsKICAgICAgICBMT0cuaW5mbygiS2lsbGVk\nIEJvb2tpZSA9IiArIHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICAvLyBXcml0\nZSBzb21lIG1vcmUgZW50cmllcwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRyeShkYXRhKTsK\nICAgICAgICB9CiAgICAgICAgLy8gS2lsbCB0aGUgc2Vjb25kIEJvb2tpZQog\nICAgICAgIHJlcGxpY2FUb0tpbGwgPSBsaC5nZXRMZWRnZXJNZXRhZGF0YSgp\nLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwogICAgICAgIGtpbGxC\nb29raWUocmVwbGljYVRvS2lsbCk7CiAgICAgICAgTE9HLmluZm8oIktpbGxl\nZCBCb29raWUgPSIgKyByZXBsaWNhVG9LaWxsKTsKCiAgICAgICAgU2V0PExl\nZGdlckZyYWdtZW50PiBmcmFnbWVudHMgPSBnZXRGcmFnbWVudHNUb1JlcGxp\nY2F0ZShsaCk7CiAgICAgICAgQm9va0tlZXBlckFkbWluIGFkbWluID0gbmV3\nIEJvb2tLZWVwZXJBZG1pbihiYXNlQ2xpZW50Q29uZik7CiAgICAgICAgaW50\nIHN0YXJ0TmV3Qm9va2llID0gc3RhcnROZXdCb29raWUoKTsKICAgICAgICBJ\nbmV0U29ja2V0QWRkcmVzcyBhZGRpdGlvbmFsQksgPSBuZXcgSW5ldFNvY2tl\ndEFkZHJlc3MoSW5ldEFkZHJlc3MKICAgICAgICAgICAgICAgIC5nZXRMb2Nh\nbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBzdGFydE5ld0Jvb2tpZSk7CiAg\nICAgICAgZm9yIChMZWRnZXJGcmFnbWVudCBsZiA6IGZyYWdtZW50cykgewog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYWRtaW4ucmVwbGlj\nYXRlTGVkZ2VyRnJhZ21lbnQobGgsIGxmLCBhZGRpdGlvbmFsQkspOwogICAg\nICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0xlZGdlclJlY292ZXJ5\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAg\nICogVGVzdHMgdGhhdCBzcGxpdEludG9TdWJGcmFnbWVudCBzaG91bGQgYmUg\nYWJsZSB0byBzcGxpdCB0aGUgb3JpZ2luYWwKICAgICAqIHBhc3NlZCBmcmFn\nbWVudCBpbnRvIHN1YiBmcmFnbWVudHMgYXQgY29ycmVjdCBib3VuZGFyaWVz\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAzMDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RTcGxpdEludG9TdWJGcmFnbWVudHNXaXRoRGlmZmVyZW50\nRnJhZ21lbnRCb3VuZGFyaWVzKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgTGVkZ2VyTWV0YWRhdGEgbWV0YWRhdGEgPSBuZXcg\nTGVkZ2VyTWV0YWRhdGEoMywgMywgMywgVEVTVF9ESUdFU1RfVFlQRSwKICAg\nICAgICAgICAgICAgIFRFU1RfUFNTV0QpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4g\nZ2V0RW5zZW1ibGUobG9uZyBlbnRyeUlkKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2VkKCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAg\nICAgICB9OwogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IG5ldyBMZWRnZXJI\nYW5kbGUoYmtjLCAwLCBtZXRhZGF0YSwgVEVTVF9ESUdFU1RfVFlQRSwKICAg\nICAgICAgICAgICAgIFRFU1RfUFNTV0QpOwogICAgICAgIHRlc3RTcGxpdElu\ndG9TdWJGcmFnbWVudHMoMTAsIDIxLCAtMSwgMSwgbGgpOwogICAgICAgIHRl\nc3RTcGxpdEludG9TdWJGcmFnbWVudHMoMTAsIDIxLCAyMCwgMSwgbGgpOwog\nICAgICAgIHRlc3RTcGxpdEludG9TdWJGcmFnbWVudHMoMCwgMCwgMTAsIDEs\nIGxoKTsKICAgICAgICB0ZXN0U3BsaXRJbnRvU3ViRnJhZ21lbnRzKDAsIDEs\nIDEsIDIsIGxoKTsKICAgICAgICB0ZXN0U3BsaXRJbnRvU3ViRnJhZ21lbnRz\nKDIwLCAyNCwgMiwgMywgbGgpOwogICAgICAgIHRlc3RTcGxpdEludG9TdWJG\ncmFnbWVudHMoMjEsIDMyLCAzLCA0LCBsaCk7CiAgICAgICAgdGVzdFNwbGl0\nSW50b1N1YkZyYWdtZW50cygyMiwgMTAzLCAxMSwgOCwgbGgpOwogICAgICAg\nIHRlc3RTcGxpdEludG9TdWJGcmFnbWVudHMoNDksIDUxLCAxLCAzLCBsaCk7\nCiAgICAgICAgdGVzdFNwbGl0SW50b1N1YkZyYWdtZW50cygxMSwgMTAxLCAz\nLCAzMSwgbGgpOwogICAgfQoKICAgIC8qKiBhc3NlcnQgdGhlIHN1Yi1mcmFn\nbWVudCBib3VuZGFyaWVzICovCiAgICB2b2lkIHRlc3RTcGxpdEludG9TdWJG\ncmFnbWVudHMoZmluYWwgbG9uZyBvcmlGcmFnbWVudEZpcnN0RW50cnksCiAg\nICAgICAgICAgIGZpbmFsIGxvbmcgb3JpRnJhZ21lbnRMYXN0RW50cnksIGxv\nbmcgZW50cmllc1BlclN1YkZyYWdtZW50LAogICAgICAgICAgICBsb25nIGV4\ncGVjdGVkU3ViRnJhZ21lbnRzLCBMZWRnZXJIYW5kbGUgbGgpIHsKICAgICAg\nICBMZWRnZXJGcmFnbWVudCBmciA9IG5ldyBMZWRnZXJGcmFnbWVudChsaCwg\nb3JpRnJhZ21lbnRGaXJzdEVudHJ5LAogICAgICAgICAgICAgICAgb3JpRnJh\nZ21lbnRMYXN0RW50cnksIDApIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyBsb25nIGdldExhc3RTdG9yZWRFbnRyeUlkKCkg\newogICAgICAgICAgICAgICAgcmV0dXJuIG9yaUZyYWdtZW50TGFzdEVudHJ5\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIGxvbmcgZ2V0Rmlyc3RTdG9yZWRFbnRyeUlkKCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIG9yaUZyYWdtZW50Rmlyc3RFbnRyeTsK\nICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgU2V0PExlZGdlckZy\nYWdtZW50PiBzdWJGcmFnbWVudHMgPSBMZWRnZXJGcmFnbWVudFJlcGxpY2F0\nb3IKICAgICAgICAgICAgICAgIC5zcGxpdEludG9TdWJGcmFnbWVudHMobGgs\nIGZyLCBlbnRyaWVzUGVyU3ViRnJhZ21lbnQpOwogICAgICAgIGFzc2VydEVx\ndWFscyhleHBlY3RlZFN1YkZyYWdtZW50cywgc3ViRnJhZ21lbnRzLnNpemUo\nKSk7CiAgICAgICAgaW50IGZ1bGxTdWJGcmFnbWVudCA9IDA7CiAgICAgICAg\naW50IHBhcnRpYWxTdWJGcmFnbWVudCA9IDA7CiAgICAgICAgZm9yIChMZWRn\nZXJGcmFnbWVudCBsZWRnZXJGcmFnbWVudCA6IHN1YkZyYWdtZW50cykgewog\nICAgICAgICAgICBpZiAoKGxlZGdlckZyYWdtZW50LmdldExhc3RLbm93bkVu\ndHJ5SWQoKQogICAgICAgICAgICAgICAgICAgIC0gbGVkZ2VyRnJhZ21lbnQu\nZ2V0Rmlyc3RFbnRyeUlkKCkgKyAxKSA9PSBlbnRyaWVzUGVyU3ViRnJhZ21l\nbnQpIHsKICAgICAgICAgICAgICAgIGZ1bGxTdWJGcmFnbWVudCsrOwogICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9uZyB0b3RhbEVu\ndHJpZXNUb1JlcGxpY2F0ZSA9IG9yaUZyYWdtZW50TGFzdEVudHJ5CiAgICAg\nICAgICAgICAgICAgICAgICAgIC0gb3JpRnJhZ21lbnRGaXJzdEVudHJ5ICsg\nMTsKICAgICAgICAgICAgICAgIGlmIChlbnRyaWVzUGVyU3ViRnJhZ21lbnQg\nPD0gMAogICAgICAgICAgICAgICAgICAgICAgICB8fCB0b3RhbEVudHJpZXNU\nb1JlcGxpY2F0ZSAvIGVudHJpZXNQZXJTdWJGcmFnbWVudCA9PSAwKSB7CiAg\nICAgICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIkZpcnN0RW50cnlJZCBzaG91bGQgYmUgc2FtZSBh\ncyBvcmlnaW5hbCBmcmFnbWVudCdzIGZpcnN0RW50cnlJZCIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmci5nZXRGaXJzdEVudHJ5SWQoKSwgbGVk\nZ2VyRnJhZ21lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLmdldEZpcnN0RW50cnlJZCgpKTsKICAgICAgICAgICAgICAgICAgICBh\nc3NlcnRFcXVhbHMoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTGFz\ndEVudHJ5SWQgc2hvdWxkIGJlIHNhbWUgYXMgb3JpZ2luYWwgZnJhZ21lbnQn\ncyBsYXN0RW50cnlJZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBm\nci5nZXRMYXN0S25vd25FbnRyeUlkKCksIGxlZGdlckZyYWdtZW50CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRMYXN0S25vd25F\nbnRyeUlkKCkpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICBsb25nIHBhcnRpYWxTcGxpdEVudHJpZXMgPSB0b3RhbEVu\ndHJpZXNUb1JlcGxpY2F0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nJSBlbnRyaWVzUGVyU3ViRnJhZ21lbnQ7CiAgICAgICAgICAgICAgICAgICAg\nYXNzZXJ0RXF1YWxzKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIlBh\ncnRpYWwgZnJhZ21lbnQgd2l0aCB3cm9uZyBlbnRyeSBib3VuZGFyaWVzIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckZyYWdtZW50Lmdl\ndExhc3RLbm93bkVudHJ5SWQoKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAtIGxlZGdlckZyYWdtZW50LmdldEZpcnN0RW50cnlJZCgp\nICsgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnRpYWxTcGxp\ndEVudHJpZXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\ncGFydGlhbFN1YkZyYWdtZW50Kys7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJVbmV4cGVjdGVkIG51bWJlciBvZiBz\ndWIgZmFyZ21lbnRzIiwgZnVsbFN1YkZyYWdtZW50CiAgICAgICAgICAgICAg\nICArIHBhcnRpYWxTdWJGcmFnbWVudCwgZXhwZWN0ZWRTdWJGcmFnbWVudHMp\nOwogICAgICAgIGFzc2VydFRydWUoIlRoZXJlIHNob3VsZCBiZSBvbmx5IG9u\nZSBvciB6ZXJvIHBhcnRpYWwgc3ViIEZyYWdtZW50IiwKICAgICAgICAgICAg\nICAgIHBhcnRpYWxTdWJGcmFnbWVudCA9PSAwIHx8IHBhcnRpYWxTdWJGcmFn\nbWVudCA9PSAxKTsKICAgIH0KCiAgICBwcml2YXRlIFNldDxMZWRnZXJGcmFn\nbWVudD4gZ2V0RnJhZ21lbnRzVG9SZXBsaWNhdGUoTGVkZ2VySGFuZGxlIGxo\nKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewog\nICAgICAgIExlZGdlckNoZWNrZXIgY2hlY2tlciA9IG5ldyBMZWRnZXJDaGVj\na2VyKGJrYyk7CiAgICAgICAgQ2hlY2tlckNhbGxiYWNrIGNiID0gbmV3IENo\nZWNrZXJDYWxsYmFjaygpOwogICAgICAgIGNoZWNrZXIuY2hlY2tMZWRnZXIo\nbGgsIGNiKTsKICAgICAgICBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IGZyYWdtZW50\ncyA9IGNiLndhaXRBbmRHZXRSZXN1bHQoKTsKICAgICAgICByZXR1cm4gZnJh\nZ21lbnRzOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB2ZXJpZnlSZWNvdmVy\nZWRMZWRnZXJzKExlZGdlckhhbmRsZSBsaCwgbG9uZyBzdGFydEVudHJ5SWQs\nCiAgICAgICAgICAgIGxvbmcgZW5kRW50cnlJZCkgdGhyb3dzIEJLRXhjZXB0\naW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFu\nZGxlIGxocyA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsaC5nZXRJZCgp\nLAogICAgICAgICAgICAgICAgVEVTVF9ESUdFU1RfVFlQRSwgVEVTVF9QU1NX\nRCk7CiAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGVudHJpZXMg\nPSBsaHMucmVhZEVudHJpZXMoc3RhcnRFbnRyeUlkLAogICAgICAgICAgICAg\nICAgZW5kRW50cnlJZCk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiU2hvdWxkIGhh\ndmUgdGhlIGVsZW1lbnRzIiwgZW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSk7\nCiAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFzTW9yZUVsZW1lbnRzKCkpIHsK\nICAgICAgICAgICAgTGVkZ2VyRW50cnkgZW50cnkgPSBlbnRyaWVzLm5leHRF\nbGVtZW50KCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygiVGVzdExlZGdl\nckZyYWdtZW50UmVwbGljYXRpb24iLCBuZXcgU3RyaW5nKGVudHJ5CiAgICAg\nICAgICAgICAgICAgICAgLmdldEVudHJ5KCkpKTsKICAgICAgICB9CiAgICB9\nCgp9Cg==\n","encoding":"base64"}

