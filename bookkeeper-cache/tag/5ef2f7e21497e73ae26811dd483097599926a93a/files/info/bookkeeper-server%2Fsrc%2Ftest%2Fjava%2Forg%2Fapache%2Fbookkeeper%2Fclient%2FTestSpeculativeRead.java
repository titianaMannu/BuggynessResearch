{"sha":"64cd5dc1ab02ad85ca943e38d24ccdd3d2bad322","node_id":"MDQ6QmxvYjE1NzU5NTY6NjRjZDVkYzFhYjAyYWQ4NWNhOTQzZTM4ZDI0Y2NkZDNkMmJhZDMyMg==","size":13567,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/64cd5dc1ab02ad85ca943e38d24ccdd3d2bad322","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgb3JnLmp1bml0Lio7CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLkNvdW50RG93bkxhdGNoOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJh\nY2suUmVhZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIudGVzdC5CYXNlVGVzdENhc2U7CgppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5\nOwoKLyoqCiAqIFRoaXMgdW5pdCB0ZXN0IHRlc3RzIGxlZGdlciBmZW5jaW5n\nOwogKgogKi8KcHVibGljIGNsYXNzIFRlc3RTcGVjdWxhdGl2ZVJlYWQgZXh0\nZW5kcyBCYXNlVGVzdENhc2UgewogICAgc3RhdGljIExvZ2dlciBMT0cgPSBM\nb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZXN0U3BlY3VsYXRpdmVSZWFkLmNs\nYXNzKTsKCiAgICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGU7CiAgICBieXRlW10g\ncGFzc3dkID0gInNwZWNQVyIuZ2V0Qnl0ZXMoKTsKCiAgICBwdWJsaWMgVGVz\ndFNwZWN1bGF0aXZlUmVhZChEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHsKICAg\nICAgICBzdXBlcigxMCk7CiAgICAgICAgdGhpcy5kaWdlc3RUeXBlID0gZGln\nZXN0VHlwZTsKICAgIH0KCiAgICBsb25nIGdldExlZGdlclRvUmVhZChpbnQg\nZW5zZW1ibGUsIGludCBxdW9ydW0pIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGJ5dGVbXSBkYXRhID0gIkRhdGEgZm9yIHRlc3QiLmdldEJ5dGVzKCk7\nCiAgICAgICAgTGVkZ2VySGFuZGxlIGwgPSBia2MuY3JlYXRlTGVkZ2VyKGVu\nc2VtYmxlLCBxdW9ydW0sIGRpZ2VzdFR5cGUsIHBhc3N3ZCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGwu\nYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIGwuY2xvc2UoKTsK\nCiAgICAgICAgcmV0dXJuIGwuZ2V0SWQoKTsKICAgIH0KCiAgICBCb29rS2Vl\ncGVyIGNyZWF0ZUNsaWVudChpbnQgc3BlY1RpbWVvdXQpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIENsaWVudENvbmZpZ3VyYXRpb24gY29uZiA9IG5l\ndyBDbGllbnRDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFNwZWN1\nbGF0aXZlUmVhZFRpbWVvdXQoc3BlY1RpbWVvdXQpCiAgICAgICAgICAgIC5z\nZXRSZWFkVGltZW91dCgzMDAwMCk7CiAgICAgICAgY29uZi5zZXRaa1NlcnZl\ncnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAg\nICAgcmV0dXJuIG5ldyBCb29rS2VlcGVyKGNvbmYpOwogICAgfQoKICAgIGNs\nYXNzIExhdGNoQ2FsbGJhY2sgaW1wbGVtZW50cyBSZWFkQ2FsbGJhY2sgewog\nICAgICAgIENvdW50RG93bkxhdGNoIGwgPSBuZXcgQ291bnREb3duTGF0Y2go\nMSk7CiAgICAgICAgYm9vbGVhbiBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAg\nbG9uZyBzdGFydE1pbGxpcyA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nOwogICAgICAgIGxvbmcgZW5kTWlsbGlzID0gTG9uZy5NQVhfVkFMVUU7Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHJlYWRDb21wbGV0ZShpbnQgcmMsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZGdlckhhbmRsZSBsaCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRW51bWVyYXRpb248\nTGVkZ2VyRW50cnk+IHNlcSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBlbmRNaWxsaXMgPSBT\neXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgTE9HLmRl\nYnVnKCJHb3QgcmVzcG9uc2Uge30ge30iLCByYywgZ2V0RHVyYXRpb24oKSk7\nCiAgICAgICAgICAgIHN1Y2Nlc3MgPSByYyA9PSBCS0V4Y2VwdGlvbi5Db2Rl\nLk9LOwogICAgICAgICAgICBsLmNvdW50RG93bigpOwogICAgICAgIH0KCiAg\nICAgICAgbG9uZyBnZXREdXJhdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJu\nIGVuZE1pbGxpcyAtIHN0YXJ0TWlsbGlzOwogICAgICAgIH0KCiAgICAgICAg\ndm9pZCBleHBlY3RTdWNjZXNzKGludCBtaWxsaXNlY29uZHMpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgICAgICBhc3NlcnRUcnVlKGwuYXdhaXQobWls\nbGlzZWNvbmRzLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpKTsKICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZShzdWNjZXNzKTsKICAgICAgICB9CgogICAgICAgIHZv\naWQgZXhwZWN0RmFpbChpbnQgbWlsbGlzZWNvbmRzKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShsLmF3YWl0KG1pbGxpc2Vj\nb25kcywgVGltZVVuaXQuTUlMTElTRUNPTkRTKSk7CiAgICAgICAgICAgIGFz\nc2VydEZhbHNlKHN1Y2Nlc3MpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBl\neHBlY3RUaW1lb3V0KGludCBtaWxsaXNlY29uZHMpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICBhc3NlcnRGYWxzZShsLmF3YWl0KG1pbGxpc2Vj\nb25kcywgVGltZVVuaXQuTUlMTElTRUNPTkRTKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCBiYXNpYyBzcGVjdWxhdGl2ZSBmdW5j\ndGlvbmFsaXR5LgogICAgICogLSBDcmVhdGUgMiBjbGllbnRzIHdpdGggcmVh\nZCB0aW1lb3V0IGRpc2FibGVkLCBvbmUgd2l0aCBzcGVjCiAgICAgKiAgIHJl\nYWQgZW5hYmxlZCwgdGhlIG90aGVyIG5vdC4KICAgICAqIC0gY3JlYXRlIGxl\nZGdlcgogICAgICogLSBzbGVlcCBzZWNvbmQgYm9va2llIGluIGVuc2VtYmxl\nCiAgICAgKiAtIHJlYWQgZmlyc3QgZW50cnksIGJvdGggc2hvdWxkIGZpbmQg\nb24gZmlyc3QgYm9va2llLgogICAgICogLSByZWFkIHNlY29uZCBib29raWUs\nIHNwZWMgY2xpZW50IHNob3VsZCBmaW5kIG9uIGJvb2tpZSB0aHJlZSwKICAg\nICAqICAgbm9uIHNwZWMgY2xpZW50IHNob3VsZCBoYW5nLgogICAgICovCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFNw\nZWN1bGF0aXZlUmVhZCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxv\nbmcgaWQgPSBnZXRMZWRnZXJUb1JlYWQoMywyKTsKICAgICAgICBCb29rS2Vl\ncGVyIGJrbm9zcGVjID0gY3JlYXRlQ2xpZW50KDApOyAvLyBkaXNhYmxlZAog\nICAgICAgIEJvb2tLZWVwZXIgYmtzcGVjID0gY3JlYXRlQ2xpZW50KDIwMDAp\nOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbG5vc3BlYyA9IGJrbm9zcGVjLm9w\nZW5MZWRnZXIoaWQsIGRpZ2VzdFR5cGUsIHBhc3N3ZCk7CiAgICAgICAgTGVk\nZ2VySGFuZGxlIGxzcGVjID0gYmtzcGVjLm9wZW5MZWRnZXIoaWQsIGRpZ2Vz\ndFR5cGUsIHBhc3N3ZCk7CgogICAgICAgIC8vIHNsZWVwIHNlY29uZCBib29r\naWUKICAgICAgICBDb3VudERvd25MYXRjaCBzbGVlcExhdGNoID0gbmV3IENv\ndW50RG93bkxhdGNoKDEpOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIHNl\nY29uZCA9IGxub3NwZWMuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJs\nZXMoKS5nZXQoMEwpLmdldCgxKTsKICAgICAgICBzbGVlcEJvb2tpZShzZWNv\nbmQsIHNsZWVwTGF0Y2gpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyByZWFkIGZpcnN0IGVudHJ5LCBib3RoIGdvIHRvIGZpcnN0IGJvb2tpZSwg\nc2hvdWxkIGJlIGZpbmUKICAgICAgICAgICAgTGF0Y2hDYWxsYmFjayBub3Nw\nZWNjYiA9IG5ldyBMYXRjaENhbGxiYWNrKCk7CiAgICAgICAgICAgIExhdGNo\nQ2FsbGJhY2sgc3BlY2NiID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAgICAg\nICAgICAgbG5vc3BlYy5hc3luY1JlYWRFbnRyaWVzKDAsIDAsIG5vc3BlY2Ni\nLCBudWxsKTsKICAgICAgICAgICAgbHNwZWMuYXN5bmNSZWFkRW50cmllcygw\nLCAwLCBzcGVjY2IsIG51bGwpOwogICAgICAgICAgICBub3NwZWNjYi5leHBl\nY3RTdWNjZXNzKDIwMDApOwogICAgICAgICAgICBzcGVjY2IuZXhwZWN0U3Vj\nY2VzcygyMDAwKTsKCiAgICAgICAgICAgIC8vIHJlYWQgc2Vjb25kIGVudHJ5\nLCBib3RoIGxvb2sgZm9yIHNlY29uZCBib29rLCBzcGVjIHJlYWQgY2xpZW50\nCiAgICAgICAgICAgIC8vIHRyaWVzIHRoaXJkIGJvb2tpZSwgbm9uc3BlYyBj\nbGllbnQgaGFuZ3MgYXMgcmVhZCB0aW1lb3V0IGlzIHZlcnkgbG9uZy4KICAg\nICAgICAgICAgbm9zcGVjY2IgPSBuZXcgTGF0Y2hDYWxsYmFjaygpOwogICAg\nICAgICAgICBzcGVjY2IgPSBuZXcgTGF0Y2hDYWxsYmFjaygpOwogICAgICAg\nICAgICBsbm9zcGVjLmFzeW5jUmVhZEVudHJpZXMoMSwgMSwgbm9zcGVjY2Is\nIG51bGwpOwogICAgICAgICAgICBsc3BlYy5hc3luY1JlYWRFbnRyaWVzKDEs\nIDEsIHNwZWNjYiwgbnVsbCk7CiAgICAgICAgICAgIHNwZWNjYi5leHBlY3RT\ndWNjZXNzKDQwMDApOwogICAgICAgICAgICBub3NwZWNjYi5leHBlY3RUaW1l\nb3V0KDQwMDApOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHNs\nZWVwTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgIGxzcGVjLmNsb3Nl\nKCk7CiAgICAgICAgICAgIGxub3NwZWMuY2xvc2UoKTsKICAgICAgICAgICAg\nYmtzcGVjLmNsb3NlKCk7CiAgICAgICAgICAgIGJrbm9zcGVjLmNsb3NlKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlm\nIG1vcmUgdGhhbiBvbmUgcmVwbGljYSBpcyBkb3duLCB3ZSBjYW4gc3RpbGwg\ncmVhZCwgYXMgbG9uZyBhcyB0aGUgcXVvcnVtCiAgICAgKiBzaXplIGlzIGxh\ncmdlciB0aGFuIHRoZSBudW1iZXIgb2YgZG93biByZXBsaWNhcy4KICAgICAq\nLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRl\nc3RTcGVjdWxhdGl2ZVJlYWRNdWx0aXBsZVJlcGxpY2FzRG93bigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIGxvbmcgaWQgPSBnZXRMZWRnZXJUb1Jl\nYWQoNSw1KTsKICAgICAgICBpbnQgdGltZW91dCA9IDUwMDA7CiAgICAgICAg\nQm9va0tlZXBlciBia3NwZWMgPSBjcmVhdGVDbGllbnQodGltZW91dCk7Cgog\nICAgICAgIExlZGdlckhhbmRsZSBsID0gYmtzcGVjLm9wZW5MZWRnZXIoaWQs\nIGRpZ2VzdFR5cGUsIHBhc3N3ZCk7CgogICAgICAgIC8vIHNsZWVwIGJvb2tp\nZSAxLCAyICYgNAogICAgICAgIENvdW50RG93bkxhdGNoIHNsZWVwTGF0Y2gg\nPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgc2xlZXBCb29raWUo\nbC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpLmdldCgwTCku\nZ2V0KDEpLCBzbGVlcExhdGNoKTsKICAgICAgICBzbGVlcEJvb2tpZShsLmdl\ndExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQo\nMiksIHNsZWVwTGF0Y2gpOwogICAgICAgIHNsZWVwQm9va2llKGwuZ2V0TGVk\nZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCg0KSwg\nc2xlZXBMYXRjaCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHJl\nYWQgZmlyc3QgZW50cnksIHNob3VsZCBjb21wbGV0ZSBmYXN0ZXIgdGhhbiB0\naW1lb3V0CiAgICAgICAgICAgIC8vIGFzIGJvb2tpZSAwIGhhcyB0aGUgZW50\ncnkKICAgICAgICAgICAgTGF0Y2hDYWxsYmFjayBsYXRjaDAgPSBuZXcgTGF0\nY2hDYWxsYmFjaygpOwogICAgICAgICAgICBsLmFzeW5jUmVhZEVudHJpZXMo\nMCwgMCwgbGF0Y2gwLCBudWxsKTsKICAgICAgICAgICAgbGF0Y2gwLmV4cGVj\ndFN1Y2Nlc3ModGltZW91dC8yKTsKCiAgICAgICAgICAgIC8vIHNlY29uZCBz\naG91bGQgaGF2ZSB0byBoaXQgdHdvIHRpbWVvdXRzIChib29raWUgMSAmIDIp\nCiAgICAgICAgICAgIC8vIGJvb2tpZSAzIGhhcyB0aGUgZW50cnkKICAgICAg\nICAgICAgTGF0Y2hDYWxsYmFjayBsYXRjaDEgPSBuZXcgTGF0Y2hDYWxsYmFj\naygpOwogICAgICAgICAgICBsLmFzeW5jUmVhZEVudHJpZXMoMSwgMSwgbGF0\nY2gxLCBudWxsKTsKICAgICAgICAgICAgbGF0Y2gxLmV4cGVjdFRpbWVvdXQo\ndGltZW91dCk7CiAgICAgICAgICAgIGxhdGNoMS5leHBlY3RTdWNjZXNzKHRp\nbWVvdXQqMik7CiAgICAgICAgICAgIExPRy5pbmZvKCJUaW1lb3V0IHt9IGxh\ndGNoMSBkdXJhdGlvbiB7fSIsIHRpbWVvdXQsIGxhdGNoMS5nZXREdXJhdGlv\nbigpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgic2hvdWxkIGhhdmUgdGFr\nZW4gbG9uZ2VyIHRoYW4gdHdvIHRpbWVvdXRzLCBidXQgbGVzcyB0aGFuIDMi\nLAogICAgICAgICAgICAgICAgICAgICAgIGxhdGNoMS5nZXREdXJhdGlvbigp\nID49IHRpbWVvdXQqMgogICAgICAgICAgICAgICAgICAgICAgICYmIGxhdGNo\nMS5nZXREdXJhdGlvbigpIDwgdGltZW91dCozKTsKCiAgICAgICAgICAgIC8v\nIHRoaXJkIHNob3VsZCBoYXZlIHRvIGhpdCBvbmUgdGltZW91dHMgKGJvb2tp\nZSAyKQogICAgICAgICAgICAvLyBib29raWUgMyBoYXMgdGhlIGVudHJ5CiAg\nICAgICAgICAgIExhdGNoQ2FsbGJhY2sgbGF0Y2gyID0gbmV3IExhdGNoQ2Fs\nbGJhY2soKTsKICAgICAgICAgICAgbC5hc3luY1JlYWRFbnRyaWVzKDIsIDIs\nIGxhdGNoMiwgbnVsbCk7CiAgICAgICAgICAgIGxhdGNoMi5leHBlY3RUaW1l\nb3V0KHRpbWVvdXQvMik7CiAgICAgICAgICAgIGxhdGNoMi5leHBlY3RTdWNj\nZXNzKHRpbWVvdXQpOwogICAgICAgICAgICBMT0cuaW5mbygiVGltZW91dCB7\nfSBsYXRjaDIgZHVyYXRpb24ge30iLCB0aW1lb3V0LCBsYXRjaDIuZ2V0RHVy\nYXRpb24oKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoInNob3VsZCBoYXZl\nIHRha2VuIGxvbmdlciB0aGFuIG9uZSB0aW1lb3V0LCBidXQgbGVzcyB0aGFu\nIDIiLAogICAgICAgICAgICAgICAgICAgICAgIGxhdGNoMi5nZXREdXJhdGlv\nbigpID49IHRpbWVvdXQKICAgICAgICAgICAgICAgICAgICAgICAmJiBsYXRj\naDIuZ2V0RHVyYXRpb24oKSA8IHRpbWVvdXQqMik7CgogICAgICAgICAgICAv\nLyBmb3VydGggc2hvdWxkIGhhdmUgbm8gdGltZW91dAogICAgICAgICAgICAv\nLyBib29raWUgMyBoYXMgdGhlIGVudHJ5CiAgICAgICAgICAgIExhdGNoQ2Fs\nbGJhY2sgbGF0Y2gzID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAgICAgICAg\nICAgbC5hc3luY1JlYWRFbnRyaWVzKDMsIDMsIGxhdGNoMywgbnVsbCk7CiAg\nICAgICAgICAgIGxhdGNoMy5leHBlY3RTdWNjZXNzKHRpbWVvdXQvMik7Cgog\nICAgICAgICAgICAvLyBmaWZ0aCBzaG91bGQgaGl0IG9uZSB0aW1lb3V0LCAo\nYm9va2llIDQpCiAgICAgICAgICAgIC8vIGJvb2tpZSAwIGhhcyB0aGUgZW50\ncnkKICAgICAgICAgICAgTGF0Y2hDYWxsYmFjayBsYXRjaDQgPSBuZXcgTGF0\nY2hDYWxsYmFjaygpOwogICAgICAgICAgICBsLmFzeW5jUmVhZEVudHJpZXMo\nNCwgNCwgbGF0Y2g0LCBudWxsKTsKICAgICAgICAgICAgbGF0Y2g0LmV4cGVj\ndFRpbWVvdXQodGltZW91dC8yKTsKICAgICAgICAgICAgbGF0Y2g0LmV4cGVj\ndFN1Y2Nlc3ModGltZW91dCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJUaW1l\nb3V0IHt9IGxhdGNoNCBkdXJhdGlvbiB7fSIsIHRpbWVvdXQsIGxhdGNoNC5n\nZXREdXJhdGlvbigpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgic2hvdWxk\nIGhhdmUgdGFrZW4gbG9uZ2VyIHRoYW4gb25lIHRpbWVvdXQsIGJ1dCBsZXNz\nIHRoYW4gMiIsCiAgICAgICAgICAgICAgICAgICAgICAgbGF0Y2g0LmdldER1\ncmF0aW9uKCkgPj0gdGltZW91dAogICAgICAgICAgICAgICAgICAgICAgICYm\nIGxhdGNoNC5nZXREdXJhdGlvbigpIDwgdGltZW91dCoyKTsKCiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgc2xlZXBMYXRjaC5jb3VudERvd24o\nKTsKICAgICAgICAgICAgbC5jbG9zZSgpOwogICAgICAgICAgICBia3NwZWMu\nY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0\nIHRoYXQgaWYgYWZ0ZXIgYSBzcGVjdWxhdGl2ZSByZWFkIGlzIGtpY2tlZCBv\nZmYsIHRoZSBvcmlnaW5hbCByZWFkIGNvbXBsZXRlcwogICAgICogbm90aGlu\nZyBiYWQgaGFwcGVucy4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAw\nMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTcGVjdWxhdGl2ZVJlYWRGaXJzdFJl\nYWRDb21wbGV0ZUlzT2soKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBs\nb25nIGlkID0gZ2V0TGVkZ2VyVG9SZWFkKDIsMik7CiAgICAgICAgaW50IHRp\nbWVvdXQgPSAxMDAwOwogICAgICAgIEJvb2tLZWVwZXIgYmtzcGVjID0gY3Jl\nYXRlQ2xpZW50KHRpbWVvdXQpOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbCA9\nIGJrc3BlYy5vcGVuTGVkZ2VyKGlkLCBkaWdlc3RUeXBlLCBwYXNzd2QpOwoK\nICAgICAgICAvLyBzbGVlcCBib29raWVzCiAgICAgICAgQ291bnREb3duTGF0\nY2ggc2xlZXBMYXRjaDAgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAg\nICAgQ291bnREb3duTGF0Y2ggc2xlZXBMYXRjaDEgPSBuZXcgQ291bnREb3du\nTGF0Y2goMSk7CiAgICAgICAgc2xlZXBCb29raWUobC5nZXRMZWRnZXJNZXRh\nZGF0YSgpLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApLCBzbGVlcExh\ndGNoMCk7CiAgICAgICAgc2xlZXBCb29raWUobC5nZXRMZWRnZXJNZXRhZGF0\nYSgpLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDEpLCBzbGVlcExhdGNo\nMSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHJlYWQgZ29lcyB0\nbyBmaXJzdCBib29raWUsIHNwZWMgcmVhZCB0aW1lb3V0IG9jY3VycywKICAg\nICAgICAgICAgLy8gZ29lcyB0byBzZWNvbmQKICAgICAgICAgICAgTGF0Y2hD\nYWxsYmFjayBsYXRjaDAgPSBuZXcgTGF0Y2hDYWxsYmFjaygpOwogICAgICAg\nICAgICBsLmFzeW5jUmVhZEVudHJpZXMoMCwgMCwgbGF0Y2gwLCBudWxsKTsK\nICAgICAgICAgICAgbGF0Y2gwLmV4cGVjdFRpbWVvdXQodGltZW91dCk7Cgog\nICAgICAgICAgICAvLyB3YWtlIHVwIGZpcnN0IGJvb2tpZQogICAgICAgICAg\nICBzbGVlcExhdGNoMC5jb3VudERvd24oKTsKICAgICAgICAgICAgbGF0Y2gw\nLmV4cGVjdFN1Y2Nlc3ModGltZW91dC8yKTsKCiAgICAgICAgICAgIHNsZWVw\nTGF0Y2gxLmNvdW50RG93bigpOwoKICAgICAgICAgICAgLy8gY2hlY2sgd2Ug\nY2FuIHJlYWQgbmV4dCBlbnRyeSB3aXRob3V0IGlzc3VlCiAgICAgICAgICAg\nIExhdGNoQ2FsbGJhY2sgbGF0Y2gxID0gbmV3IExhdGNoQ2FsbGJhY2soKTsK\nICAgICAgICAgICAgbC5hc3luY1JlYWRFbnRyaWVzKDEsIDEsIGxhdGNoMSwg\nbnVsbCk7CiAgICAgICAgICAgIGxhdGNoMS5leHBlY3RTdWNjZXNzKHRpbWVv\ndXQvMik7CgogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHNsZWVw\nTGF0Y2gwLmNvdW50RG93bigpOwogICAgICAgICAgICBzbGVlcExhdGNoMS5j\nb3VudERvd24oKTsKICAgICAgICAgICAgbC5jbG9zZSgpOwogICAgICAgICAg\nICBia3NwZWMuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBVbml0IHRlc3QgZm9yIHRoZSBzcGVjdWxhdGl2ZSByZWFkIHNjaGVk\ndWxpbmcgbWV0aG9kCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3BlY3VsYXRpdmVSZWFkU2NoZWR1bGlu\nZygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxvbmcgaWQgPSBnZXRM\nZWRnZXJUb1JlYWQoMywyKTsKICAgICAgICBpbnQgdGltZW91dCA9IDEwMDA7\nCiAgICAgICAgQm9va0tlZXBlciBia3NwZWMgPSBjcmVhdGVDbGllbnQodGlt\nZW91dCk7CgogICAgICAgIExlZGdlckhhbmRsZSBsID0gYmtzcGVjLm9wZW5M\nZWRnZXIoaWQsIGRpZ2VzdFR5cGUsIHBhc3N3ZCk7CgogICAgICAgIEFycmF5\nTGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gZW5zZW1ibGUgPSBsLmdldExlZGdl\nck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKTsKICAgICAgICBT\nZXQ8SW5ldFNvY2tldEFkZHJlc3M+IGFsbEhvc3RzID0gbmV3IEhhc2hTZXQo\nZW5zZW1ibGUpOwogICAgICAgIFNldDxJbmV0U29ja2V0QWRkcmVzcz4gbm9I\nb3N0ID0gbmV3IEhhc2hTZXQoKTsKICAgICAgICBTZXQ8SW5ldFNvY2tldEFk\nZHJlc3M+IHNlY29uZEhvc3RPbmx5ID0gbmV3IEhhc2hTZXQoKTsKICAgICAg\nICBzZWNvbmRIb3N0T25seS5hZGQoZW5zZW1ibGUuZ2V0KDEpKTsKICAgICAg\nICBQZW5kaW5nUmVhZE9wLkxlZGdlckVudHJ5UmVxdWVzdCByZXEwID0gbnVs\nbCwgcmVxMiA9IG51bGwsIHJlcTQgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIExhdGNoQ2FsbGJhY2sgbGF0Y2gwID0gbmV3IExhdGNoQ2Fs\nbGJhY2soKTsKICAgICAgICAgICAgUGVuZGluZ1JlYWRPcCBvcCA9IG5ldyBQ\nZW5kaW5nUmVhZE9wKGwsIGJrc3BlYy5zY2hlZHVsZXIsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAwLCA1LCBs\nYXRjaDAsIG51bGwpOwoKICAgICAgICAgICAgLy8gaWYgd2UndmUgYWxyZWFk\neSBoZWFyZCBmcm9tIGFsbCBob3N0cywKICAgICAgICAgICAgLy8gd2Ugb25s\neSBzZW5kIHRoZSBpbml0aWFsIHJlYWQKICAgICAgICAgICAgcmVxMCA9IG9w\nLm5ldyBMZWRnZXJFbnRyeVJlcXVlc3QoZW5zZW1ibGUsIGwuZ2V0SWQoKSwg\nMCk7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBoYXZlIHNlbnQg\ndG8gZmlyc3QiLAogICAgICAgICAgICAgICAgICAgICAgIHJlcTAubWF5YmVT\nZW5kU3BlY3VsYXRpdmVSZWFkKGFsbEhvc3RzKS5lcXVhbHMoZW5zZW1ibGUu\nZ2V0KDApKSk7CiAgICAgICAgICAgIGFzc2VydE51bGwoIlNob3VsZCBub3Qg\naGF2ZSBzZW50IGFub3RoZXIiLAogICAgICAgICAgICAgICAgICAgICAgIHJl\ncTAubWF5YmVTZW5kU3BlY3VsYXRpdmVSZWFkKGFsbEhvc3RzKSk7CgogICAg\nICAgICAgICAvLyBpZiB3ZSBoYXZlIGhlYXJkIGZyb20gc29tZSBob3N0cywg\nYnV0IG5vdCBvbmUgd2UgaGF2ZSBzZW50IHRvCiAgICAgICAgICAgIC8vIHNl\nbmQgYWdhaW4KICAgICAgICAgICAgcmVxMiA9IG9wLm5ldyBMZWRnZXJFbnRy\neVJlcXVlc3QoZW5zZW1ibGUsIGwuZ2V0SWQoKSwgMik7CiAgICAgICAgICAg\nIGFzc2VydFRydWUoIlNob3VsZCBoYXZlIHNlbnQgdG8gdGhpcmQiLAogICAg\nICAgICAgICAgICAgICAgICAgIHJlcTIubWF5YmVTZW5kU3BlY3VsYXRpdmVS\nZWFkKG5vSG9zdCkuZXF1YWxzKGVuc2VtYmxlLmdldCgyKSkpOwogICAgICAg\nICAgICBhc3NlcnRUcnVlKCJTaG91bGQgaGF2ZSBzZW50IHRvIGZpcnN0IiwK\nICAgICAgICAgICAgICAgICAgICAgICByZXEyLm1heWJlU2VuZFNwZWN1bGF0\naXZlUmVhZChzZWNvbmRIb3N0T25seSkuZXF1YWxzKGVuc2VtYmxlLmdldCgw\nKSkpOwoKICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSBoZWFyZCBmcm9tIHNv\nbWUgaG9zdHMsIHdoaWNoIGluY2x1ZGVzIG9uZSB3ZSBzZW50IHRvCiAgICAg\nICAgICAgIC8vIGRvIG5vdCByZWFkIGFnYWluCiAgICAgICAgICAgIHJlcTQg\nPSBvcC5uZXcgTGVkZ2VyRW50cnlSZXF1ZXN0KGVuc2VtYmxlLCBsLmdldElk\nKCksIDQpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgaGF2ZSBz\nZW50IHRvIHNlY29uZCIsCiAgICAgICAgICAgICAgICAgICAgICAgcmVxNC5t\nYXliZVNlbmRTcGVjdWxhdGl2ZVJlYWQobm9Ib3N0KS5lcXVhbHMoZW5zZW1i\nbGUuZ2V0KDEpKSk7CiAgICAgICAgICAgIGFzc2VydE51bGwoIlNob3VsZCBu\nb3QgaGF2ZSBzZW50IGFub3RoZXIiLAogICAgICAgICAgICAgICAgICAgICAg\nIHJlcTQubWF5YmVTZW5kU3BlY3VsYXRpdmVSZWFkKHNlY29uZEhvc3RPbmx5\nKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgZm9yIChQZW5k\naW5nUmVhZE9wLkxlZGdlckVudHJ5UmVxdWVzdCByZXEKICAgICAgICAgICAg\nICAgICAgICAgOiBuZXcgUGVuZGluZ1JlYWRPcC5MZWRnZXJFbnRyeVJlcXVl\nc3RbXSB7IHJlcTAsIHJlcTIsIHJlcTQgfSkgewogICAgICAgICAgICAgICAg\naWYgKHJlcSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IGkg\nPSAwOwogICAgICAgICAgICAgICAgICAgIHdoaWxlICghcmVxLmlzQ29tcGxl\ndGUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSsrID4gMTAp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyB3YWl0\nIGZvciB1cCB0byAxMCBzZWNvbmRzCiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDAp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBh\nc3NlcnRUcnVlKCJSZXF1ZXN0IHNob3VsZCBiZSBkb25lIiwgcmVxMC5pc0Nv\nbXBsZXRlKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBsLmNsb3NlKCk7CiAgICAgICAgICAgIGJrc3BlYy5jbG9z\nZSgpOwogICAgICAgIH0KICAgIH0KfQ==\n","encoding":"base64"}

