{"sha":"2752bcf85311f67841b16b88667a48d58340a43d","node_id":"MDQ6QmxvYjE1NzU5NTY6Mjc1MmJjZjg1MzExZjY3ODQxYjE2Yjg4NjY3YTQ4ZDU4MzQwYTQzZA==","size":23196,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2752bcf85311f67841b16b88667a48d58340a43d","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlOwoKaW1wb3J0\nIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLk1ldGFz\ndG9yZVNjYW5uYWJsZVRhYmxlLkVNUFRZX0VORF9LRVk7CmltcG9ydCBzdGF0\naWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVT\nY2FubmFibGVUYWJsZS5FTVBUWV9TVEFSVF9LRVk7CmltcG9ydCBzdGF0aWMg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVUYWJs\nZS5BTExfRklFTERTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlVGFibGUuTk9OX0ZJRUxEUzsKCmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRp\nbC5UcmVlTWFwOwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0Q2FzZTsK\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLkluTWVt\nb3J5TWV0YXN0b3JlVGFibGUuTWV0YWRhdGFWZXJzaW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU0V4Y2VwdGlvbi5Db2Rl\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRh\nc3RvcmVTY2FubmFibGVUYWJsZS5PcmRlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb247CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIudmVyc2lvbmluZy5WZXJzaW9uZWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMuY29uZmlndXJhdGlvbi5Db21wb3NpdGVDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbmZpZ3Vy\nYXRpb24uQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsK\naW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVz\ndDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi5jb2xs\nZWN0Lk1hcERpZmZlcmVuY2U7CmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi5j\nb2xsZWN0Lk1hcHM7CmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi5jb2xsZWN0\nLlNldHM7CgpwdWJsaWMgY2xhc3MgVGVzdE1ldGFTdG9yZSBleHRlbmRzIFRl\nc3RDYXNlIHsKICAgIGZpbmFsIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVzdE1ldGFTdG9yZS5jbGFzcyk7Cgog\nICAgcHJvdGVjdGVkIGZpbmFsIHN0YXRpYyBTdHJpbmcgVEFCTEUgPSAibXlU\nYWJsZSI7CiAgICBwcm90ZWN0ZWQgZmluYWwgc3RhdGljIFN0cmluZyBSRUNP\nUkRJRCA9ICJ0ZXN0IjsKICAgIHByb3RlY3RlZCBmaW5hbCBzdGF0aWMgU3Ry\naW5nIEZJRUxEX05BTUUgPSAibmFtZSI7CiAgICBwcm90ZWN0ZWQgZmluYWwg\nc3RhdGljIFN0cmluZyBGSUVMRF9DT1VOVEVSID0gImNvdW50ZXIiOwoKICAg\nIHByb3RlY3RlZCBTdHJpbmcgZ2V0RmllbGRGcm9tVmFsdWUoVmFsdWUgdmFs\ndWUsIFN0cmluZyBmaWVsZCkgewogICAgICAgIGJ5dGVbXSB2ID0gdmFsdWUu\nZ2V0RmllbGQoZmllbGQpOwogICAgICAgIHJldHVybiB2ID09IG51bGwgPyBu\ndWxsIDogbmV3IFN0cmluZyh2KTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIFZhbHVlIG1ha2VWYWx1ZShTdHJpbmcgbmFtZSwgSW50ZWdlciBjb3Vu\ndGVyKSB7CiAgICAgICAgVmFsdWUgZGF0YSA9IG5ldyBWYWx1ZSgpOwoKICAg\nICAgICBpZiAobmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgIGRhdGEuc2V0\nRmllbGQoRklFTERfTkFNRSwgbmFtZS5nZXRCeXRlcygpKTsKICAgICAgICB9\nCgogICAgICAgIGlmIChjb3VudGVyICE9IG51bGwpIHsKICAgICAgICAgICAg\nZGF0YS5zZXRGaWVsZChGSUVMRF9DT1VOVEVSLCBjb3VudGVyLnRvU3RyaW5n\nKCkuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGF0\nYTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgY2xhc3MgUmVjb3JkIHsKICAgICAg\nICBTdHJpbmcgbmFtZTsKICAgICAgICBJbnRlZ2VyIGNvdW50ZXI7CiAgICAg\nICAgVmVyc2lvbiB2ZXJzaW9uOwoKICAgICAgICBwdWJsaWMgUmVjb3JkKCkg\newogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJlY29yZChTdHJpbmcgbmFt\nZSwgSW50ZWdlciBjb3VudGVyLCBWZXJzaW9uIHZlcnNpb24pIHsKICAgICAg\nICAgICAgdGhpcy5uYW1lID0gbmFtZTsKICAgICAgICAgICAgdGhpcy5jb3Vu\ndGVyID0gY291bnRlcjsKICAgICAgICAgICAgdGhpcy52ZXJzaW9uID0gdmVy\nc2lvbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBSZWNvcmQoVmVyc2lv\nbmVkPFZhbHVlPiB2dikgewogICAgICAgICAgICB2ZXJzaW9uID0gdnYuZ2V0\nVmVyc2lvbigpOwoKICAgICAgICAgICAgVmFsdWUgdmFsdWUgPSB2di5nZXRW\nYWx1ZSgpOwogICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBuYW1lID0gZ2V0RmllbGRGcm9tVmFsdWUodmFsdWUsIEZJRUxEX05BTUUp\nOwogICAgICAgICAgICBTdHJpbmcgYyA9IGdldEZpZWxkRnJvbVZhbHVlKHZh\nbHVlLCBGSUVMRF9DT1VOVEVSKTsKICAgICAgICAgICAgaWYgKGMgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgY291bnRlciA9IG5ldyBJbnRlZ2VyKGMp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgVmVy\nc2lvbiBnZXRWZXJzaW9uKCkgewogICAgICAgICAgICByZXR1cm4gdmVyc2lv\nbjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBWYWx1ZSBnZXRWYWx1ZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIFRlc3RNZXRhU3RvcmUubWFrZVZhbHVl\nKG5hbWUsIGNvdW50ZXIpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFZl\ncnNpb25lZDxWYWx1ZT4gZ2V0VmVyc2lvbmVkVmFsdWUoKSB7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgVmVyc2lvbmVkPFZhbHVlPihnZXRWYWx1ZSgpLCB2\nZXJzaW9uKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG1lcmdl\nKFN0cmluZyBuYW1lLCBJbnRlZ2VyIGNvdW50ZXIsIFZlcnNpb24gdmVyc2lv\nbikgewogICAgICAgICAgICBpZiAobmFtZSAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChjb3VudGVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIHRoaXMuY291bnRlciA9IGNvdW50ZXI7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKHZlcnNpb24gIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\ndGhpcy52ZXJzaW9uID0gdmVyc2lvbjsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgbWVyZ2UoUmVjb3JkIHJlY29yZCkg\newogICAgICAgICAgICBtZXJnZShyZWNvcmQubmFtZSwgcmVjb3JkLmNvdW50\nZXIsIHJlY29yZC52ZXJzaW9uKTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIGNoZWNrRXF1YWwoVmVyc2lvbmVkPFZhbHVlPiB2dikgewogICAg\nICAgICAgICBWZXJzaW9uIHYgPSB2di5nZXRWZXJzaW9uKCk7CiAgICAgICAg\nICAgIFZhbHVlIHZhbHVlID0gdnYuZ2V0VmFsdWUoKTsKCiAgICAgICAgICAg\nIGFzc2VydEVxdWFscyhuYW1lLCBnZXRGaWVsZEZyb21WYWx1ZSh2YWx1ZSwg\nRklFTERfTkFNRSkpOwoKICAgICAgICAgICAgU3RyaW5nIGMgPSBnZXRGaWVs\nZEZyb21WYWx1ZSh2YWx1ZSwgRklFTERfQ09VTlRFUik7CiAgICAgICAgICAg\nIGlmIChjb3VudGVyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGFzc2Vy\ndE51bGwoYyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBhc3NlcnRFcXVhbHMoY291bnRlci50b1N0cmluZygpLCBjKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShpc0VxdWFsVmVyc2lv\nbih2ZXJzaW9uLCB2KSk7CiAgICAgICAgfQoKICAgIH0KCiAgICBwcm90ZWN0\nZWQgTWV0YVN0b3JlIG1ldGFzdG9yZTsKICAgIHByb3RlY3RlZCBNZXRhc3Rv\ncmVTY2FubmFibGVUYWJsZSBteUFjdHVhbFRhYmxlOwogICAgcHJvdGVjdGVk\nIE1ldGFzdG9yZVNjYW5uYWJsZVRhYmxlQXN5bmNUb1N5bmNDb252ZXJ0ZXIg\nbXlUYWJsZTsKCiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldE1ldGFTdG9yZU5h\nbWUoKSB7CiAgICAgICAgcmV0dXJuIEluTWVtb3J5TWV0YVN0b3JlLmNsYXNz\nLmdldE5hbWUoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQ29uZmlndXJhdGlv\nbiBnZXRDb25maWd1cmF0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgQ29t\ncG9zaXRlQ29uZmlndXJhdGlvbigpOwogICAgfQoKICAgIHByb3RlY3RlZCBW\nZXJzaW9uIG5ld0JhZFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIG5ldyBN\nZXRhZGF0YVZlcnNpb24oLTEpOwogICAgfQoKICAgIHByb3RlY3RlZCBWZXJz\naW9uIG5leHRWZXJzaW9uKFZlcnNpb24gdmVyc2lvbikgewogICAgICAgIGlm\nIChWZXJzaW9uLk5FVyA9PSB2ZXJzaW9uKSB7CiAgICAgICAgICAgIHJldHVy\nbiBuZXcgTWV0YWRhdGFWZXJzaW9uKDApOwogICAgICAgIH0KICAgICAgICBp\nZiAoVmVyc2lvbi5BTlkgPT0gdmVyc2lvbikgewogICAgICAgICAgICByZXR1\ncm4gVmVyc2lvbi5BTlk7CiAgICAgICAgfQogICAgICAgIGFzc2VydFRydWUo\ndmVyc2lvbiBpbnN0YW5jZW9mIE1ldGFkYXRhVmVyc2lvbik7CiAgICAgICAg\ncmV0dXJuIG5ldyBNZXRhZGF0YVZlcnNpb24oKChNZXRhZGF0YVZlcnNpb24p\nIHZlcnNpb24pLmluY3JlbWVudFZlcnNpb24oKSk7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIGNoZWNrVmVyc2lvbihWZXJzaW9uIHYpIHsKICAgICAgICBh\nc3NlcnROb3ROdWxsKHYpOwogICAgICAgIGlmICh2ICE9IFZlcnNpb24uTkVX\nICYmIHYgIT0gVmVyc2lvbi5BTlkpIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1\nZSh2IGluc3RhbmNlb2YgTWV0YWRhdGFWZXJzaW9uKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNFcXVhbFZlcnNpb24oVmVy\nc2lvbiB2MSwgVmVyc2lvbiB2MikgewogICAgICAgIGNoZWNrVmVyc2lvbih2\nMSk7CiAgICAgICAgY2hlY2tWZXJzaW9uKHYyKTsKICAgICAgICByZXR1cm4g\ndjEuY29tcGFyZSh2MikgPT0gVmVyc2lvbi5PY2N1cnJlZC5DT05DVVJSRU5U\nTFk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBAQmVmb3JlCiAgICBwdWJs\naWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIG1l\ndGFzdG9yZSA9IE1ldGFzdG9yZUZhY3RvcnkuY3JlYXRlTWV0YVN0b3JlKGdl\ndE1ldGFTdG9yZU5hbWUoKSk7CiAgICAgICAgQ29uZmlndXJhdGlvbiBjb25m\naWcgPSBnZXRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgbWV0YXN0b3JlLmlu\naXQoY29uZmlnLCBtZXRhc3RvcmUuZ2V0VmVyc2lvbigpKTsKCiAgICAgICAg\nbXlBY3R1YWxUYWJsZSA9IG1ldGFzdG9yZS5jcmVhdGVTY2FubmFibGVUYWJs\nZShUQUJMRSk7CiAgICAgICAgbXlUYWJsZSA9IG5ldyBNZXRhc3RvcmVTY2Fu\nbmFibGVUYWJsZUFzeW5jVG9TeW5jQ29udmVydGVyKG15QWN0dWFsVGFibGUp\nOwoKICAgICAgICAvLyBzZXR1cCBhIGNsZWFuIGVudmlyb25tZW50CiAgICAg\nICAgY2xlYXJUYWJsZSgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgQEFm\ndGVyCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIC8vIGFsc28gY2xlYXIgdGFibGUgYWZ0ZXIgdGVzdAog\nICAgICAgIGNsZWFyVGFibGUoKTsKCiAgICAgICAgbXlBY3R1YWxUYWJsZS5j\nbG9zZSgpOwogICAgICAgIG1ldGFzdG9yZS5jbG9zZSgpOwogICAgfQoKICAg\nIHZvaWQgY2hlY2tFeHBlY3RlZFZhbHVlKFZlcnNpb25lZDxWYWx1ZT4gdnYs\nIFN0cmluZyBleHBlY3RlZE5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBJbnRlZ2VyIGV4cGVjdGVkQ291bnRlciwgVmVyc2lvbiBleHBlY3Rl\nZFZlcnNpb24pIHsKICAgICAgICBSZWNvcmQgZXhwZWN0ZWQgPSBuZXcgUmVj\nb3JkKGV4cGVjdGVkTmFtZSwgZXhwZWN0ZWRDb3VudGVyLCBleHBlY3RlZFZl\ncnNpb24pOwogICAgICAgIGV4cGVjdGVkLmNoZWNrRXF1YWwodnYpOwogICAg\nfQoKICAgIHByb3RlY3RlZCBJbnRlZ2VyIGdldFJhbmRvbSgpIHsKICAgICAg\nICByZXR1cm4gKGludCkoTWF0aC5yYW5kb20oKSo2NTUzNik7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIFZlcnNpb25lZDxWYWx1ZT4gZ2V0UmVjb3JkKFN0cmlu\nZyByZWNvcmRJZCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgcmV0dXJuIG15VGFibGUuZ2V0KHJlY29yZElkKTsKICAg\nICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5Ob0tleUV4Y2VwdGlvbiBua2Up\nIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogZ2V0IHJlY29yZCB3aXRoIHNwZWNpZmljIGZpZWxk\ncywgYXNzdW1lIHJlY29yZCBFWElTVCEKICAgICAqLwogICAgcHJvdGVjdGVk\nIFZlcnNpb25lZDxWYWx1ZT4gZ2V0RXhpc3RSZWNvcmRGaWVsZHMoU3RyaW5n\nIHJlY29yZElkLCBTZXQ8U3RyaW5nPiBmaWVsZHMpCiAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBWZXJzaW9uZWQ8VmFsdWU+IHJldFZhbHVlID0g\nbXlUYWJsZS5nZXQocmVjb3JkSWQsIGZpZWxkcyk7CiAgICAgICAgcmV0dXJu\nIHJldFZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogcHV0IGFuZCBjaGVj\nayBmaWVsZHMKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgcHV0QW5kQ2hl\nY2soU3RyaW5nIHJlY29yZElkLCBTdHJpbmcgbmFtZSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBJbnRlZ2VyIGNvdW50ZXIsIFZl\ncnNpb24gdmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBSZWNvcmQgZXhwZWN0ZWQsIENvZGUgZXhwZWN0ZWRDb2RlKQog\nICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgVmVyc2lvbiByZXRWZXJz\naW9uID0gbnVsbDsKICAgICAgICBDb2RlIGNvZGUgPSBDb2RlLk9wZXJhdGlv\nbkZhaWx1cmU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0VmVyc2lv\nbiA9IG15VGFibGUucHV0KHJlY29yZElkLCBtYWtlVmFsdWUobmFtZSwgY291\nbnRlciksIHZlcnNpb24pOwogICAgICAgICAgICBjb2RlID0gQ29kZS5PSzsK\nICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5CYWRWZXJzaW9uRXhjZXB0\naW9uIGJ2ZSkgewogICAgICAgICAgICBjb2RlID0gQ29kZS5CYWRWZXJzaW9u\nOwogICAgICAgIH0gY2F0Y2ggKE1TRXhjZXB0aW9uLk5vS2V5RXhjZXB0aW9u\nIG5rZSkgewogICAgICAgICAgICBjb2RlID0gQ29kZS5Ob0tleTsKICAgICAg\nICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5LZXlFeGlzdHNFeGNlcHRpb24ga2Vl\nKSB7CiAgICAgICAgICAgIGNvZGUgPSBDb2RlLktleUV4aXN0czsKICAgICAg\nICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKGV4cGVjdGVkQ29kZSwgY29kZSk7\nCgogICAgICAgIC8vIGdldCBhbmQgY2hlY2sgYWxsIGZpZWxkcyBvZiByZWNv\ncmQKICAgICAgICBpZiAoQ29kZS5PSyA9PSBjb2RlKSB7CiAgICAgICAgICAg\nIGFzc2VydFRydWUoaXNFcXVhbFZlcnNpb24ocmV0VmVyc2lvbiwgbmV4dFZl\ncnNpb24odmVyc2lvbikpKTsKICAgICAgICAgICAgZXhwZWN0ZWQubWVyZ2Uo\nbmFtZSwgY291bnRlciwgcmV0VmVyc2lvbik7CiAgICAgICAgfQoKICAgICAg\nICBWZXJzaW9uZWQ8VmFsdWU+IGV4aXN0ZWRWViA9IGdldFJlY29yZChyZWNv\ncmRJZCk7CiAgICAgICAgaWYgKG51bGwgPT0gZXhwZWN0ZWQpIHsKICAgICAg\nICAgICAgYXNzZXJ0TnVsbChleGlzdGVkVlYpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIGV4cGVjdGVkLmNoZWNrRXF1YWwoZXhpc3RlZFZWKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgY2xlYXJUYWJs\nZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIE1ldGFzdG9yZUN1cnNv\nciBjdXJzb3IgPSBteVRhYmxlLm9wZW5DdXJzb3IoKTsKICAgICAgICBpZiAo\nIWN1cnNvci5oYXNNb3JlRW50cmllcygpKSB7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKGN1cnNvci5oYXNNb3JlRW50\ncmllcygpKSB7CiAgICAgICAgICAgIEl0ZXJhdG9yPE1ldGFzdG9yZVRhYmxl\nSXRlbT4gaXRlciA9IGN1cnNvci5yZWFkRW50cmllcyg5OSk7CiAgICAgICAg\nICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAg\nTWV0YXN0b3JlVGFibGVJdGVtIGl0ZW0gPSBpdGVyLm5leHQoKTsKICAgICAg\nICAgICAgICAgIFN0cmluZyBrZXkgPSBpdGVtLmdldEtleSgpOwogICAgICAg\nICAgICAgICAgbXlUYWJsZS5yZW1vdmUoa2V5LCBWZXJzaW9uLkFOWSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3Vyc29yLmNsb3NlKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IChnZXQsIGdldCBwYXJ0aWFs\nIGZpZWxkLCByZW1vdmUpIG9uIG5vbi1leGlzdGVudCBlbGVtZW50LgogICAg\nICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdE5vbkV4aXN0ZW50KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gZ2V0CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbXlUYWJsZS5nZXQo\nUkVDT1JESUQpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgZmFpbCB0byBn\nZXQgYSBub24tZXhpc3RlbnQga2V5Iik7CiAgICAgICAgfSBjYXRjaCAoTVNF\neGNlcHRpb24uTm9LZXlFeGNlcHRpb24gbmtlKSB7CiAgICAgICAgfQoKICAg\nICAgICAvLyBnZXQgcGFydGlhbCBmaWVsZAogICAgICAgIFNldDxTdHJpbmc+\nIGZpZWxkcyA9CiAgICAgICAgICAgIG5ldyBIYXNoU2V0PFN0cmluZz4oQXJy\nYXlzLmFzTGlzdChuZXcgU3RyaW5nW10geyBGSUVMRF9DT1VOVEVSIH0pKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBteVRhYmxlLmdldChSRUNPUkRJ\nRCwgZmllbGRzKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGZhaWwgdG8g\nZ2V0IGEgbm9uLWV4aXN0ZW50IGtleSB3aXRoIHNwZWNpZmllZCBmaWVsZHMi\nKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5Ob0tleUV4Y2VwdGlv\nbiBua2UpIHsKICAgICAgICB9CgogICAgICAgIC8vIHJlbW92ZQogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIG15VGFibGUucmVtb3ZlKFJFQ09SRElELCBW\nZXJzaW9uLkFOWSk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBmYWlsIHRv\nIGRlbGV0ZSBhIG5vbi1leGlzdGVudCBrZXkiKTsKICAgICAgICB9IGNhdGNo\nIChNU0V4Y2VwdGlvbi5Ob0tleUV4Y2VwdGlvbiBua2UpIHsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHVzYWdlIG9mIGdldCBvcGVy\nYXRpb24gb24gKGZ1bGwgYW5kIHBhcnRpYWwpIGZpZWxkcy4KICAgICAqLwog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RH\nZXQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBWZXJzaW9uZWQ8VmFs\ndWU+IHZ2OwoKICAgICAgICBmaW5hbCBTZXQ8U3RyaW5nPiBmaWVsZHMgPQog\nICAgICAgICAgICBuZXcgSGFzaFNldDxTdHJpbmc+KEFycmF5cy5hc0xpc3Qo\nbmV3IFN0cmluZ1tdIHsgRklFTERfTkFNRSB9KSk7CgogICAgICAgIGZpbmFs\nIFN0cmluZyBuYW1lID0gImdldCI7CiAgICAgICAgZmluYWwgSW50ZWdlciBj\nb3VudGVyID0gZ2V0UmFuZG9tKCk7CgogICAgICAgIC8vIHB1dCB0ZXN0IGl0\nZW0KICAgICAgICBWZXJzaW9uIHZlcnNpb24gPSBteVRhYmxlLnB1dChSRUNP\nUkRJRCwgbWFrZVZhbHVlKG5hbWUsIGNvdW50ZXIpLCBWZXJzaW9uLk5FVyk7\nCiAgICAgICAgYXNzZXJ0Tm90TnVsbCh2ZXJzaW9uKTsKCiAgICAgICAgLy8g\nZmV0Y2ggd2l0aCBhbGwgZmllbGRzCiAgICAgICAgdnYgPSBnZXRFeGlzdFJl\nY29yZEZpZWxkcyhSRUNPUkRJRCwgQUxMX0ZJRUxEUyk7CiAgICAgICAgY2hl\nY2tFeHBlY3RlZFZhbHVlKHZ2LCBuYW1lLCBjb3VudGVyLCB2ZXJzaW9uKTsK\nCiAgICAgICAgLy8gcGFydGlhbCBnZXQgbmFtZQogICAgICAgIHZ2ID0gZ2V0\nRXhpc3RSZWNvcmRGaWVsZHMoUkVDT1JESUQsIGZpZWxkcyk7CiAgICAgICAg\nY2hlY2tFeHBlY3RlZFZhbHVlKHZ2LCBuYW1lLCBudWxsLCB2ZXJzaW9uKTsK\nCiAgICAgICAgLy8gbm9uIGZpZWxkcwogICAgICAgIHZ2ID0gZ2V0RXhpc3RS\nZWNvcmRGaWVsZHMoUkVDT1JESUQsIE5PTl9GSUVMRFMpOwogICAgICAgIGNo\nZWNrRXhwZWN0ZWRWYWx1ZSh2diwgbnVsbCwgbnVsbCwgdmVyc2lvbik7Cgog\nICAgICAgIC8vIGdldCBudWxsIGtleSBzaG91bGQgZmFpbAogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIGdldEV4aXN0UmVjb3JkRmllbGRzKG51bGwsIE5P\nTl9GSUVMRFMpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgZmFpbCB0byBn\nZXQgbnVsbCBrZXkgd2l0aCBOT04gZmllbGRzIik7CiAgICAgICAgfSBjYXRj\naCAoTVNFeGNlcHRpb24uSWxsZWdhbE9wRXhjZXB0aW9uIGlvZSkgewogICAg\nICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBnZXRFeGlzdFJlY29y\nZEZpZWxkcyhudWxsLCBBTExfRklFTERTKTsKICAgICAgICAgICAgZmFpbCgi\nU2hvdWxkIGZhaWwgdG8gZ2V0IG51bGwga2V5IHdpdGggQUxMIGZpZWxkcy4i\nKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5JbGxlZ2FsT3BFeGNl\ncHRpb24gaW9lKSB7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGdldEV4aXN0UmVjb3JkRmllbGRzKG51bGwsIGZpZWxkcyk7CiAgICAg\nICAgICAgIGZhaWwoIlNob3VsZCBmYWlsIHRvIGdldCBudWxsIGtleSB3aXRo\nIGZpZWxkcyAiICsgZmllbGRzKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2Vw\ndGlvbi5JbGxlZ2FsT3BFeGNlcHRpb24gaW9lKSB7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCB1c2FnZSBvZiBwdXQgb3BlcmF0aW9u\nIHdpdGggKGZ1bGwgYW5kIHBhcnRpYWwpIGZpZWxkcy4KICAgICAqLwogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RQdXQo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBJbnRlZ2VyIGNv\ndW50ZXIgPSBnZXRSYW5kb20oKTsKICAgICAgICBmaW5hbCBTdHJpbmcgbmFt\nZSA9ICJwdXQiOwoKICAgICAgICBWZXJzaW9uIHZlcnNpb247CgogICAgICAg\nIC8qKgogICAgICAgICAqIHRlc3QgY29ycmVjdCB2ZXJzaW9uIHB1dAogICAg\nICAgICAqLwogICAgICAgIC8vIHB1dCB0ZXN0IGl0ZW0KICAgICAgICB2ZXJz\naW9uID0gbXlUYWJsZS5wdXQoUkVDT1JESUQsIG1ha2VWYWx1ZShuYW1lLCBj\nb3VudGVyKSwgVmVyc2lvbi5ORVcpOwogICAgICAgIGFzc2VydE5vdE51bGwo\ndmVyc2lvbik7CiAgICAgICAgUmVjb3JkIGV4cGVjdGVkID0gbmV3IFJlY29y\nZChuYW1lLCBjb3VudGVyLCB2ZXJzaW9uKTsKCiAgICAgICAgLy8gY29ycmVj\ndCB2ZXJzaW9uIHB1dCB3aXRoIG9ubHkgbmFtZSBmaWVsZCBjaGFuZ2VkCiAg\nICAgICAgcHV0QW5kQ2hlY2soUkVDT1JESUQsICJuYW1lMSIsIG51bGwsIGV4\ncGVjdGVkLmdldFZlcnNpb24oKSwgZXhwZWN0ZWQsIENvZGUuT0spOwoKICAg\nICAgICAvLyBjb3JyZWN0IHZlcnNpb24gcHV0IHdpdGggb25seSBjb3VudGVy\nIGZpZWxkIGNoYW5nZWQKICAgICAgICBwdXRBbmRDaGVjayhSRUNPUkRJRCwg\nbnVsbCwgY291bnRlciArIDEsIGV4cGVjdGVkLmdldFZlcnNpb24oKSwgZXhw\nZWN0ZWQsIENvZGUuT0spOwoKICAgICAgICAvLyBjb3JyZWN0IHZlcnNpb24g\ncHV0IHdpdGggYWxsIGZpZWxkcyBmaWxsZWQKICAgICAgICBwdXRBbmRDaGVj\nayhSRUNPUkRJRCwgIm5hbWUyIiwgY291bnRlciArIDIsIGV4cGVjdGVkLmdl\ndFZlcnNpb24oKSwgZXhwZWN0ZWQsIENvZGUuT0spOwoKICAgICAgICAvLyB0\nZXN0IHB1dCBleGlzdCBlbnRyeSB3aXRoIFZlcnNpb24uQU5ZCiAgICAgICAg\nY2hlY2tQYXJ0aWFsUHV0KCJwdXQgZXhpc3QgZW50cnkgd2l0aCBWZXJzaW9u\nLkFOWSIsIFZlcnNpb24uQU5ZLCBleHBlY3RlZCwgQ29kZS5PSyk7CgogICAg\nICAgIC8qKgogICAgICAgICAqIHRlc3QgYmFkIHZlcnNpb24gcHV0CiAgICAg\nICAgICovCiAgICAgICAgLy8gcHV0IHRvIGV4aXN0ZWQgZW50cnkgd2l0aCBW\nZXJzaW9uLk5FVwogICAgICAgIGJhZFZlcnNpb25lZFB1dChWZXJzaW9uLk5F\nVywgQ29kZS5LZXlFeGlzdHMpOwogICAgICAgIC8vIHB1dCB0byBleGlzdGVk\nIGVudHJ5IHdpdGggYmFkIHZlcnNpb24KICAgICAgICBiYWRWZXJzaW9uZWRQ\ndXQobmV3QmFkVmVyc2lvbigpLCBDb2RlLkJhZFZlcnNpb24pOwoKICAgICAg\nICAvLyByZW1vdmUgdGhlIGVudHJ5CiAgICAgICAgbXlUYWJsZS5yZW1vdmUo\nUkVDT1JESUQsIFZlcnNpb24uQU5ZKTsKCiAgICAgICAgLy8gcHV0IHRvIG5v\nbi1leGlzdGVudCBlbnRyeSB3aXRoIGJhZCB2ZXJzaW9uCiAgICAgICAgYmFk\nVmVyc2lvbmVkUHV0KG5ld0JhZFZlcnNpb24oKSwgQ29kZS5Ob0tleSk7CiAg\nICAgICAgLy8gcHV0IHRvIG5vbi1leGlzdGVudCBlbnRyeSB3aXRoIFZlcnNp\nb24uQU5ZCiAgICAgICAgYmFkVmVyc2lvbmVkUHV0KFZlcnNpb24uQU5ZLCBD\nb2RlLk5vS2V5KTsKCiAgICAgICAgLyoqCiAgICAgICAgICogdGVzdCBpbGxl\nZ2FsIGFyZ3VtZW50cwogICAgICAgICAqLwogICAgICAgIGlsbGVnYWxQdXQo\nbnVsbCwgVmVyc2lvbi5ORVcpOwogICAgICAgIGlsbGVnYWxQdXQobWFrZVZh\nbHVlKCJpbGxlZ2FsIHZhbHVlIiwgZ2V0UmFuZG9tKCkpLCBudWxsKTsKICAg\nICAgICBpbGxlZ2FsUHV0KG51bGwsIG51bGwpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCB2b2lkIGJhZFZlcnNpb25lZFB1dChWZXJzaW9uIGJhZFZlcnNpb24s\nIENvZGUgZXhwZWN0ZWRDb2RlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBWZXJzaW9uZWQ8VmFsdWU+IHZ2ID0gZ2V0UmVjb3JkKFJFQ09SRElEKTsK\nICAgICAgICBSZWNvcmQgZXhwZWN0ZWQgPSBudWxsOwoKICAgICAgICBpZiAo\nZXhwZWN0ZWRDb2RlICE9IENvZGUuTm9LZXkpIHsKICAgICAgICAgICAgYXNz\nZXJ0Tm90TnVsbCh2dik7CiAgICAgICAgICAgIGV4cGVjdGVkID0gbmV3IFJl\nY29yZCh2dik7CiAgICAgICAgfQoKICAgICAgICBjaGVja1BhcnRpYWxQdXQo\nImJhZFZlcnNpb25lZFB1dCIsIGJhZFZlcnNpb24sIGV4cGVjdGVkLCBleHBl\nY3RlZENvZGUpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGNoZWNrUGFy\ndGlhbFB1dChTdHJpbmcgbmFtZSwgVmVyc2lvbiB2ZXJzaW9uLCBSZWNvcmQg\nZXhwZWN0ZWQsIENvZGUgZXhwZWN0ZWRDb2RlKQogICAgICAgICAgICB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBJbnRlZ2VyIGNvdW50ZXI7CgogICAg\nICAgIC8vIGJhZCB2ZXJzaW9uIHB1dCB3aXRoIGFsbCBmaWVsZHMgZmlsbGVk\nCiAgICAgICAgY291bnRlciA9IGdldFJhbmRvbSgpOwogICAgICAgIHB1dEFu\nZENoZWNrKFJFQ09SRElELCBuYW1lICsgY291bnRlciwgY291bnRlciwgdmVy\nc2lvbiwgZXhwZWN0ZWQsIGV4cGVjdGVkQ29kZSk7CgogICAgICAgIC8vIGJh\nZCB2ZXJzaW9uIHB1dCB3aXRoIG9ubHkgbmFtZSBmaWVsZCBjaGFuZ2VkCiAg\nICAgICAgY291bnRlciA9IGdldFJhbmRvbSgpOwogICAgICAgIHB1dEFuZENo\nZWNrKFJFQ09SRElELCBuYW1lICsgY291bnRlciwgbnVsbCwgdmVyc2lvbiwg\nZXhwZWN0ZWQsIGV4cGVjdGVkQ29kZSk7CgogICAgICAgIC8vIGJhZCB2ZXJz\naW9uIHB1dCB3aXRoIG9ubHkgY291bnRlciBmaWVsZCBjaGFuZ2VkCiAgICAg\nICAgcHV0QW5kQ2hlY2soUkVDT1JESUQsIG51bGwsIGNvdW50ZXIsIHZlcnNp\nb24sIGV4cGVjdGVkLCBleHBlY3RlZENvZGUpOwogICAgfQoKICAgIHByb3Rl\nY3RlZCB2b2lkIGlsbGVnYWxQdXQoVmFsdWUgdmFsdWUsIFZlcnNpb24gdmVy\nc2lvbikgdGhyb3dzIE1TRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBteVRhYmxlLnB1dChSRUNPUkRJRCwgdmFsdWUsIHZlcnNpb24p\nOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgZmFpbCB0byBkbyB2ZXJzaW9u\nZWQgcHV0IHdpdGggaWxsZWdhbCBhcmd1bWVudHMiKTsKICAgICAgICB9IGNh\ndGNoIChNU0V4Y2VwdGlvbi5JbGxlZ2FsT3BFeGNlcHRpb24gaW9lKSB7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB1c2FnZSBvZiAo\ndW5jb25kaXRpb25hbCByZW1vdmUsIEJhZFZlcnNpb24gcmVtb3ZlLCBDb3Jy\nZWN0VmVyc2lvbgogICAgICogcmVtb3ZlKSBvcGVyYXRpb24uCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nUmVtb3ZlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgSW50\nZWdlciBjb3VudGVyID0gZ2V0UmFuZG9tKCk7CiAgICAgICAgZmluYWwgU3Ry\naW5nIG5hbWUgPSAicmVtb3ZlIjsKICAgICAgICBWZXJzaW9uIHZlcnNpb247\nCgogICAgICAgIC8vIGluc2VydCB0ZXN0IGl0ZW0KICAgICAgICB2ZXJzaW9u\nID0gbXlUYWJsZS5wdXQoUkVDT1JESUQsIG1ha2VWYWx1ZShuYW1lLCBjb3Vu\ndGVyKSwgVmVyc2lvbi5ORVcpOwogICAgICAgIGFzc2VydE5vdE51bGwodmVy\nc2lvbik7CgogICAgICAgIC8vIHRlc3QgdW5jb25kaXRpb25hbCByZW1vdmUK\nICAgICAgICBteVRhYmxlLnJlbW92ZShSRUNPUkRJRCwgVmVyc2lvbi5BTlkp\nOwoKICAgICAgICAvLyBpbnNlcnQgdGVzdCBpdGVtCiAgICAgICAgdmVyc2lv\nbiA9IG15VGFibGUucHV0KFJFQ09SRElELCBtYWtlVmFsdWUobmFtZSwgY291\nbnRlciksIFZlcnNpb24uTkVXKTsKICAgICAgICBhc3NlcnROb3ROdWxsKHZl\ncnNpb24pOwoKICAgICAgICAvLyB0ZXN0IHJlbW92ZSB3aXRoIGJhZCB2ZXJz\naW9uCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbXlUYWJsZS5yZW1vdmUo\nUkVDT1JESUQsIFZlcnNpb24uTkVXKTsKICAgICAgICAgICAgZmFpbCgiU2hv\ndWxkIGZhaWwgdG8gcmVtb3ZlIGEgZ2l2ZW4ga2V5IHdpdGggYmFkIHZlcnNp\nb24iKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5CYWRWZXJzaW9u\nRXhjZXB0aW9uIGJ2ZSkgewogICAgICAgIH0KICAgICAgICB0cnkgewogICAg\nICAgICAgICBteVRhYmxlLnJlbW92ZShSRUNPUkRJRCwgbmV3QmFkVmVyc2lv\nbigpKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGZhaWwgdG8gcmVtb3Zl\nIGEgZ2l2ZW4ga2V5IHdpdGggYmFkIHZlcnNpb24iKTsKICAgICAgICB9IGNh\ndGNoIChNU0V4Y2VwdGlvbi5CYWRWZXJzaW9uRXhjZXB0aW9uIGJ2ZSkgewog\nICAgICAgIH0KCiAgICAgICAgLy8gdGVzdCByZW1vdmUgd2l0aCBjb3JyZWN0\nIHZlcnNpb24KICAgICAgICBteVRhYmxlLnJlbW92ZShSRUNPUkRJRCwgdmVy\nc2lvbik7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgb3BlbkN1cnNvclRl\nc3QoTWV0YXN0b3JlQ3Vyc29yIGN1cnNvciwgTWFwPFN0cmluZywgVmFsdWU+\nIGV4cGVjdGVkVmFsdWVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaW50IG51bUVudHJpZXNQZXJTY2FuKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBNYXA8U3RyaW5nLCBWYWx1\nZT4gZW50cmllcyA9IE1hcHMubmV3SGFzaE1hcCgpOwogICAgICAgICAgICB3\naGlsZSAoY3Vyc29yLmhhc01vcmVFbnRyaWVzKCkpIHsKICAgICAgICAgICAg\nICAgIEl0ZXJhdG9yPE1ldGFzdG9yZVRhYmxlSXRlbT4gaXRlciA9IGN1cnNv\nci5yZWFkRW50cmllcyhudW1FbnRyaWVzUGVyU2Nhbik7CiAgICAgICAgICAg\nICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAg\nICAgICBNZXRhc3RvcmVUYWJsZUl0ZW0gaXRlbSA9IGl0ZXIubmV4dCgpOwog\nICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHV0KGl0ZW0uZ2V0S2V5KCks\nIGl0ZW0uZ2V0VmFsdWUoKS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBNYXBEaWZmZXJlbmNlPFN0\ncmluZywgVmFsdWU+IGRpZmYgPSBNYXBzLmRpZmZlcmVuY2UoZXhwZWN0ZWRW\nYWx1ZXMsIGVudHJpZXMpOwogICAgICAgICAgICBhc3NlcnRUcnVlKGRpZmYu\nYXJlRXF1YWwoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nY3Vyc29yLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgb3Bl\nblJhbmdlQ3Vyc29yVGVzdChTdHJpbmcgZmlyc3RLZXksIGJvb2xlYW4gZmly\nc3RJbmNsdXNpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3Ry\naW5nIGxhc3RLZXksIGJvb2xlYW4gbGFzdEluY2x1c2l2ZSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBPcmRlciBvcmRlciwgU2V0PFN0cmluZz4g\nZmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIEl0ZXJhdG9y\nPE1hcC5FbnRyeTxTdHJpbmcsIFZhbHVlPj4gZXhwZWN0ZWRWYWx1ZXMsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bUVudHJpZXNQZXJT\nY2FuKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBNZXRhc3RvcmVDdXJz\nb3IgY3Vyc29yID0gbXlUYWJsZS5vcGVuQ3Vyc29yKGZpcnN0S2V5LCBmaXJz\ndEluY2x1c2l2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxhc3RLZXksIGxhc3RJbmNsdXNpdmUsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBvcmRlciwgZmllbGRzKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICB3aGlsZSAoY3Vyc29yLmhhc01vcmVFbnRyaWVzKCkpIHsKICAgICAgICAg\nICAgICAgIEl0ZXJhdG9yPE1ldGFzdG9yZVRhYmxlSXRlbT4gaXRlciA9IGN1\ncnNvci5yZWFkRW50cmllcyhudW1FbnRyaWVzUGVyU2Nhbik7CiAgICAgICAg\nICAgICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAg\nICAgICAgICBhc3NlcnRUcnVlKGV4cGVjdGVkVmFsdWVzLmhhc05leHQoKSk7\nCiAgICAgICAgICAgICAgICAgICAgTWV0YXN0b3JlVGFibGVJdGVtIGl0ZW0g\nPSBpdGVyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBNYXAuRW50cnk8\nU3RyaW5nLCBWYWx1ZT4gZXhwZWN0ZWRJdGVtID0gZXhwZWN0ZWRWYWx1ZXMu\nbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscyhleHBl\nY3RlZEl0ZW0uZ2V0S2V5KCksIGl0ZW0uZ2V0S2V5KCkpOwogICAgICAgICAg\nICAgICAgICAgIGFzc2VydEVxdWFscyhleHBlY3RlZEl0ZW0uZ2V0VmFsdWUo\nKSwgaXRlbS5nZXRWYWx1ZSgpLmdldFZhbHVlKCkpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2VydEZhbHNlKGV4\ncGVjdGVkVmFsdWVzLmhhc05leHQoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdCB1c2FnZSBvZiAoc2Nhbikgb3BlcmF0aW9u\nIG9uIChmdWxsIGFuZCBwYXJ0aWFsKSBmaWVsZHMuCiAgICAgKi8KICAgIEBU\nZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0T3BlbkN1\ncnNvcigpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBUcmVlTWFwPFN0\ncmluZywgVmFsdWU+IGFsbFZhbHVlcyA9IE1hcHMubmV3VHJlZU1hcCgpOwog\nICAgICAgIFRyZWVNYXA8U3RyaW5nLCBWYWx1ZT4gcGFydGlhbFZhbHVlcyA9\nIE1hcHMubmV3VHJlZU1hcCgpOwogICAgICAgIFRyZWVNYXA8U3RyaW5nLCBW\nYWx1ZT4gbm9uVmFsdWVzID0gTWFwcy5uZXdUcmVlTWFwKCk7CgogICAgICAg\nIFNldDxTdHJpbmc+IGNvdW50ZXJGaWVsZHMgPSBTZXRzLm5ld0hhc2hTZXQo\nRklFTERfQ09VTlRFUik7CgogICAgICAgIGZvciAoaW50IGk9NTsgaTwyNDsg\naSsrKSB7CiAgICAgICAgICAgIGNoYXIgYyA9IChjaGFyKSgnYScgKyBpKTsK\nICAgICAgICAgICAgU3RyaW5nIGtleSA9IFN0cmluZy52YWx1ZU9mKGMpOwog\nICAgICAgICAgICBWYWx1ZSB2ID0gbWFrZVZhbHVlKCJ2YWx1ZSIgKyBpLCBp\nKTsKICAgICAgICAgICAgVmFsdWUgY3YgPSB2LnByb2plY3QoY291bnRlckZp\nZWxkcyk7CiAgICAgICAgICAgIFZhbHVlIG52ID0gdi5wcm9qZWN0KE5PTl9G\nSUVMRFMpOwoKICAgICAgICAgICAgbXlUYWJsZS5wdXQoa2V5LCBuZXcgVmFs\ndWUodiksIFZlcnNpb24uTkVXKTsKICAgICAgICAgICAgYWxsVmFsdWVzLnB1\ndChrZXksIHYpOwogICAgICAgICAgICBwYXJ0aWFsVmFsdWVzLnB1dChrZXks\nIGN2KTsKICAgICAgICAgICAgbm9uVmFsdWVzLnB1dChrZXksIG52KTsKICAg\nICAgICB9CgogICAgICAgIC8vIHRlc3Qgb3BlbiBjdXJzb3IKICAgICAgICBN\nZXRhc3RvcmVDdXJzb3IgY3Vyc29yID0gbXlUYWJsZS5vcGVuQ3Vyc29yKEFM\nTF9GSUVMRFMpOwogICAgICAgIG9wZW5DdXJzb3JUZXN0KGN1cnNvciwgYWxs\nVmFsdWVzLCA3KTsKCiAgICAgICAgY3Vyc29yID0gbXlUYWJsZS5vcGVuQ3Vy\nc29yKGNvdW50ZXJGaWVsZHMpOwogICAgICAgIG9wZW5DdXJzb3JUZXN0KGN1\ncnNvciwgcGFydGlhbFZhbHVlcywgNyk7CgogICAgICAgIGN1cnNvciA9IG15\nVGFibGUub3BlbkN1cnNvcihOT05fRklFTERTKTsKICAgICAgICBvcGVuQ3Vy\nc29yVGVzdChjdXJzb3IsIG5vblZhbHVlcywgNyk7CgogICAgICAgIC8vIHRl\nc3Qgb3JkZXIgaW5jbHVzaXZlIGV4Y2x1c2l2ZQogICAgICAgIEl0ZXJhdG9y\nPE1hcC5FbnRyeTxTdHJpbmcsIFZhbHVlPj4gZXhwZWN0ZWRJdGVyYXRvcjsK\nCiAgICAgICAgZXhwZWN0ZWRJdGVyYXRvciA9IGFsbFZhbHVlcy5zdWJNYXAo\nImwiLCB0cnVlLCAidSIsIHRydWUpLmVudHJ5U2V0KCkuaXRlcmF0b3IoKTsK\nICAgICAgICBvcGVuUmFuZ2VDdXJzb3JUZXN0KCJsIiwgdHJ1ZSwgInUiLCB0\ncnVlLCBPcmRlci5BU0MsIEFMTF9GSUVMRFMsIGV4cGVjdGVkSXRlcmF0b3Is\nIDcpOwoKICAgICAgICBleHBlY3RlZEl0ZXJhdG9yID0gYWxsVmFsdWVzLmRl\nc2NlbmRpbmdNYXAoKS5zdWJNYXAoInUiLCB0cnVlLCAibCIsIHRydWUpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7CiAgICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdCgidSIsIHRydWUsICJs\nIiwgdHJ1ZSwgT3JkZXIuREVTQywgQUxMX0ZJRUxEUywgZXhwZWN0ZWRJdGVy\nYXRvciwgNyk7CgogICAgICAgIGV4cGVjdGVkSXRlcmF0b3IgPSBhbGxWYWx1\nZXMuc3ViTWFwKCJsIiwgZmFsc2UsICJ1IiwgZmFsc2UpLmVudHJ5U2V0KCku\naXRlcmF0b3IoKTsKICAgICAgICBvcGVuUmFuZ2VDdXJzb3JUZXN0KCJsIiwg\nZmFsc2UsICJ1IiwgZmFsc2UsIE9yZGVyLkFTQywgQUxMX0ZJRUxEUywgZXhw\nZWN0ZWRJdGVyYXRvciwgNyk7CgogICAgICAgIGV4cGVjdGVkSXRlcmF0b3Ig\nPSBhbGxWYWx1ZXMuZGVzY2VuZGluZ01hcCgpLnN1Yk1hcCgidSIsIGZhbHNl\nLCAibCIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAgICAgICAuZW50\ncnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIG9wZW5SYW5nZUN1cnNvclRl\nc3QoInUiLCBmYWxzZSwgImwiLCBmYWxzZSwgT3JkZXIuREVTQywgQUxMX0ZJ\nRUxEUywgZXhwZWN0ZWRJdGVyYXRvciwgNyk7CgogICAgICAgIGV4cGVjdGVk\nSXRlcmF0b3IgPSBhbGxWYWx1ZXMuc3ViTWFwKCJsIiwgdHJ1ZSwgInUiLCBm\nYWxzZSkuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIG9wZW5SYW5n\nZUN1cnNvclRlc3QoImwiLCB0cnVlLCAidSIsIGZhbHNlLCBPcmRlci5BU0Ms\nIEFMTF9GSUVMRFMsIGV4cGVjdGVkSXRlcmF0b3IsIDcpOwoKICAgICAgICBl\neHBlY3RlZEl0ZXJhdG9yID0gYWxsVmFsdWVzLmRlc2NlbmRpbmdNYXAoKS5z\ndWJNYXAoInUiLCB0cnVlLCAibCIsIGZhbHNlKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIG9w\nZW5SYW5nZUN1cnNvclRlc3QoInUiLCB0cnVlLCAibCIsIGZhbHNlLCBPcmRl\nci5ERVNDLCBBTExfRklFTERTLCBleHBlY3RlZEl0ZXJhdG9yLCA3KTsKCiAg\nICAgICAgZXhwZWN0ZWRJdGVyYXRvciA9IGFsbFZhbHVlcy5zdWJNYXAoImwi\nLCBmYWxzZSwgInUiLCB0cnVlKS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAg\nICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdCgibCIsIGZhbHNlLCAidSIsIHRy\ndWUsIE9yZGVyLkFTQywgQUxMX0ZJRUxEUywgZXhwZWN0ZWRJdGVyYXRvciwg\nNyk7CgogICAgICAgIGV4cGVjdGVkSXRlcmF0b3IgPSBhbGxWYWx1ZXMuZGVz\nY2VuZGluZ01hcCgpLnN1Yk1hcCgidSIsIGZhbHNlLCAibCIsIHRydWUpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7CiAgICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdCgidSIsIGZhbHNlLCAi\nbCIsIHRydWUsIE9yZGVyLkRFU0MsIEFMTF9GSUVMRFMsIGV4cGVjdGVkSXRl\ncmF0b3IsIDcpOwoKICAgICAgICAvLyB0ZXN0IG91dCBvZiByYW5nZQogICAg\nICAgIFN0cmluZyBmaXJzdEtleSA9ICJmIjsKICAgICAgICBTdHJpbmcgbGFz\ndEtleSA9ICJ4IjsKICAgICAgICBleHBlY3RlZEl0ZXJhdG9yID0gYWxsVmFs\ndWVzLnN1Yk1hcChmaXJzdEtleSwgdHJ1ZSwgbGFzdEtleSwgdHJ1ZSkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLmVudHJ5U2V0KCkuaXRlcmF0b3Io\nKTsKICAgICAgICBvcGVuUmFuZ2VDdXJzb3JUZXN0KCJhIiwgdHJ1ZSwgInoi\nLCB0cnVlLCBPcmRlci5BU0MsIEFMTF9GSUVMRFMsIGV4cGVjdGVkSXRlcmF0\nb3IsIDcpOwoKICAgICAgICBleHBlY3RlZEl0ZXJhdG9yID0gYWxsVmFsdWVz\nLnN1Yk1hcCgibCIsIHRydWUsIGxhc3RLZXksIHRydWUpLmVudHJ5U2V0KCku\naXRlcmF0b3IoKTsKICAgICAgICBvcGVuUmFuZ2VDdXJzb3JUZXN0KCJsIiwg\ndHJ1ZSwgInoiLCB0cnVlLCBPcmRlci5BU0MsIEFMTF9GSUVMRFMsIGV4cGVj\ndGVkSXRlcmF0b3IsIDcpOwoKICAgICAgICBleHBlY3RlZEl0ZXJhdG9yID0g\nYWxsVmFsdWVzLnN1Yk1hcChmaXJzdEtleSwgdHJ1ZSwgInUiLCB0cnVlKS5l\nbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgb3BlblJhbmdlQ3Vyc29y\nVGVzdCgiYSIsIHRydWUsICJ1IiwgdHJ1ZSwgT3JkZXIuQVNDLCBBTExfRklF\nTERTLCBleHBlY3RlZEl0ZXJhdG9yLCA3KTsKCiAgICAgICAgLy8gdGVzdCBF\nTVBUWV9TVEFSVF9LRVkgYW5kIEVNUFRZX0VORF9LRVkKICAgICAgICBleHBl\nY3RlZEl0ZXJhdG9yID0gYWxsVmFsdWVzLnN1Yk1hcChmaXJzdEtleSwgdHJ1\nZSwgInUiLCB0cnVlKS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAg\nb3BlblJhbmdlQ3Vyc29yVGVzdChFTVBUWV9TVEFSVF9LRVksIHRydWUsICJ1\nIiwgdHJ1ZSwgT3JkZXIuQVNDLCBBTExfRklFTERTLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZXhwZWN0ZWRJdGVyYXRvciwgNyk7CgogICAgICAg\nIGV4cGVjdGVkSXRlcmF0b3IgPSBhbGxWYWx1ZXMuZGVzY2VuZGluZ01hcCgp\nLnN1Yk1hcChsYXN0S2V5LCB0cnVlLCAibCIsIHRydWUpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAg\nICAgb3BlblJhbmdlQ3Vyc29yVGVzdChFTVBUWV9FTkRfS0VZLCB0cnVlLCAi\nbCIsIHRydWUsIE9yZGVyLkRFU0MsIEFMTF9GSUVMRFMsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBleHBlY3RlZEl0ZXJhdG9yLCA3KTsKCiAgICAg\nICAgLy8gdGVzdCBpbGxlZ2FsIGFyZ3VtZW50cwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIG15VGFibGUub3BlbkN1cnNvcigiYSIsIHRydWUsICJ6Iiwg\ndHJ1ZSwgT3JkZXIuREVTQywgQUxMX0ZJRUxEUyk7CiAgICAgICAgICAgIGZh\naWwoIlNob3VsZCBmYWlsIHdpdGggd3JvbmcgcmFuZ2UiKTsKICAgICAgICB9\nIGNhdGNoIChNU0V4Y2VwdGlvbi5JbGxlZ2FsT3BFeGNlcHRpb24gaW9lKSB7\nCiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG15VGFibGUu\nb3BlbkN1cnNvcigieiIsIHRydWUsICJhIiwgdHJ1ZSwgT3JkZXIuQVNDLCBB\nTExfRklFTERTKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGZhaWwgd2l0\naCB3cm9uZyByYW5nZSIpOwogICAgICAgIH0gY2F0Y2ggKE1TRXhjZXB0aW9u\nLklsbGVnYWxPcEV4Y2VwdGlvbiBpb2UpIHsKICAgICAgICB9CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgbXlUYWJsZS5vcGVuQ3Vyc29yKCJhIiwgdHJ1\nZSwgInoiLCB0cnVlLCBudWxsLCBBTExfRklFTERTKTsKICAgICAgICAgICAg\nZmFpbCgiU2hvdWxkIGZhaWwgd2l0aCBudWxsIG9yZGVyIik7CiAgICAgICAg\nfSBjYXRjaCAoTVNFeGNlcHRpb24uSWxsZWdhbE9wRXhjZXB0aW9uIGlvZSkg\newogICAgICAgIH0KICAgIH0KCn0K\n","encoding":"base64"}

