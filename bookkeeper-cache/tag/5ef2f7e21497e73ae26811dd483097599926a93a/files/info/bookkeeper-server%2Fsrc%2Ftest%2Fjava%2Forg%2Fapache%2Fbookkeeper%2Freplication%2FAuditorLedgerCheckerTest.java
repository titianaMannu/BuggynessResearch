{"sha":"8e35d6ce0d8652b93c994b47617526e78c767be2","node_id":"MDQ6QmxvYjE1NzU5NTY6OGUzNWQ2Y2UwZDg2NTJiOTNjOTk0YjQ3NjE3NTI2ZTc4Yzc2N2JlMg==","size":15728,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8e35d6ce0d8652b93c994b47617526e78c767be2","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5u\naW8uQnl0ZUJ1ZmZlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5SYW5kb207CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5UaW1lVW5pdDsKCmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlw\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNv\nbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0\nYS5MZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5tZXRhLlprTGVkZ2VyVW5kZXJyZXBsaWNhdGlv\nbk1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nQm9va2llU2VydmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJl\ncGxpY2F0aW9uLlJlcGxpY2F0aW9uRXhjZXB0aW9uLkNvbXBhdGliaWxpdHlF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGlj\nYXRpb24uUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdC5NdWx0aUxl\nZGdlck1hbmFnZXJUZXN0Q2FzZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuV2F0Y2hlcjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBv\ncmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUZXN0cyBwdWJs\naXNoaW5nIG9mIHVuZGVyIHJlcGxpY2F0ZWQgbGVkZ2VycyBieSB0aGUgQXVk\naXRvciBib29raWUgbm9kZSB3aGVuCiAqIGNvcnJlc3BvbmRpbmcgYm9va2ll\ncyBpZGVudGlmZXMgYXMgbm90IHJ1bm5pbmcKICovCnB1YmxpYyBjbGFzcyBB\ndWRpdG9yTGVkZ2VyQ2hlY2tlclRlc3QgZXh0ZW5kcyBNdWx0aUxlZGdlck1h\nbmFnZXJUZXN0Q2FzZSB7CgogICAgLy8gRGVwZW5kaW5nIG9uIHRoZSB0YXN0\nZSwgc2VsZWN0IHRoZSBhbW91bnQgb2YgbG9nZ2luZwogICAgLy8gYnkgZGVj\nb21tZW50aW5nIG9uZSBvZiB0aGUgdHdvIGxpbmVzIGJlbG93CiAgICAvLyBz\ndGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlci5nZXRSb290TG9nZ2VyKCk7CiAg\nICBwcml2YXRlIGZpbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFj\ndG9yeQogICAgICAgICAgICAuZ2V0TG9nZ2VyKEF1ZGl0b3JMZWRnZXJDaGVj\na2VyVGVzdC5jbGFzcyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgYnl0\nZVtdIGxlZGdlclBhc3N3b3JkID0gImFhYSIuZ2V0Qnl0ZXMoKTsKICAgIHBy\naXZhdGUgUmFuZG9tIHJuZzsgLy8gUmFuZG9tIE51bWJlciBHZW5lcmF0b3IK\nCiAgICBwcml2YXRlIERpZ2VzdFR5cGUgZGlnZXN0VHlwZTsKCiAgICBwcml2\nYXRlIGZpbmFsIFN0cmluZyBVTkRFUlJFUExJQ0FURURfUEFUSCA9IGJhc2VD\nbGllbnRDb25mCiAgICAgICAgICAgIC5nZXRaa0xlZGdlcnNSb290UGF0aCgp\nCiAgICAgICAgICAgICsgIi91bmRlcnJlcGxpY2F0aW9uL2xlZGdlcnMiOwog\nICAgcHJpdmF0ZSBIYXNoTWFwPFN0cmluZywgQXVkaXRvckVsZWN0b3I+IGF1\nZGl0b3JFbGVjdG9ycyA9IG5ldyBIYXNoTWFwPFN0cmluZywgQXVkaXRvckVs\nZWN0b3I+KCk7CiAgICBwcml2YXRlIExlZGdlclVuZGVycmVwbGljYXRpb25N\nYW5hZ2VyIHVyTGVkZ2VyTWdyOwogICAgcHJpdmF0ZSBTZXQ8TG9uZz4gdXJM\nZWRnZXJMaXN0OwoKICAgIHByaXZhdGUgTGlzdDxMb25nPiBsZWRnZXJMaXN0\nOwoKICAgIHB1YmxpYyBBdWRpdG9yTGVkZ2VyQ2hlY2tlclRlc3QoU3RyaW5n\nIGxlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3MpCiAgICAgICAgICAgIHRocm93\ncyBJT0V4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiwKICAgICAgICAgICAgQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiB7\nCiAgICAgICAgc3VwZXIoMyk7CiAgICAgICAgTE9HLmluZm8oIlJ1bm5pbmcg\ndGVzdCBjYXNlIHVzaW5nIGxlZGdlciBtYW5hZ2VyIDogIgogICAgICAgICAg\nICAgICAgKyBsZWRnZXJNYW5hZ2VyRmFjdG9yeUNsYXNzKTsKICAgICAgICB0\naGlzLmRpZ2VzdFR5cGUgPSBEaWdlc3RUeXBlLkNSQzMyOwogICAgICAgIC8v\nIHNldCBsZWRnZXIgbWFuYWdlciBuYW1lCiAgICAgICAgYmFzZUNvbmYuc2V0\nTGVkZ2VyTWFuYWdlckZhY3RvcnlDbGFzc05hbWUobGVkZ2VyTWFuYWdlckZh\nY3RvcnlDbGFzcyk7CiAgICAgICAgYmFzZUNsaWVudENvbmYKICAgICAgICAg\nICAgICAgIC5zZXRMZWRnZXJNYW5hZ2VyRmFjdG9yeUNsYXNzTmFtZShsZWRn\nZXJNYW5hZ2VyRmFjdG9yeUNsYXNzKTsKICAgIH0KCiAgICBAQmVmb3JlCiAg\nICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgdXJMZWRnZXJNZ3IgPSBuZXcg\nWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcihiYXNlQ2xpZW50Q29u\nZiwgemtjKTsKICAgICAgICBzdGFydEF1ZGl0b3JFbGVjdG9ycygpOwogICAg\nICAgIHJuZyA9IG5ldyBSYW5kb20oU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCkpOyAvLyBJbml0aWFsaXplIHRoZSBSYW5kb20KICAgICAgICB1ckxlZGdl\nckxpc3QgPSBuZXcgSGFzaFNldDxMb25nPigpOwogICAgICAgIGxlZGdlckxp\nc3QgPSBuZXcgQXJyYXlMaXN0PExvbmc+KDIpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBzdG9wQXVkaXRvckVsZWN0b3JzKCk7CiAgICAgICAg\nc3VwZXIudGVhckRvd24oKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc3Rh\ncnRBdWRpdG9yRWxlY3RvcnMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBmb3IgKEJvb2tpZVNlcnZlciBic2VydmVyIDogYnMpIHsKICAgICAgICAg\nICAgU3RyaW5nIGFkZHIgPSBTdHJpbmdVdGlscy5hZGRyVG9TdHJpbmcoYnNl\ncnZlci5nZXRMb2NhbEFkZHJlc3MoKSk7CiAgICAgICAgICAgIEF1ZGl0b3JF\nbGVjdG9yIGF1ZGl0b3JFbGVjdG9yID0gbmV3IEF1ZGl0b3JFbGVjdG9yKGFk\nZHIsCiAgICAgICAgICAgICAgICAgICAgYmFzZUNvbmYsIHprYyk7CiAgICAg\nICAgICAgIGF1ZGl0b3JFbGVjdG9ycy5wdXQoYWRkciwgYXVkaXRvckVsZWN0\nb3IpOwogICAgICAgICAgICBhdWRpdG9yRWxlY3Rvci5zdGFydCgpOwogICAg\nICAgICAgICBMT0cuZGVidWcoIlN0YXJ0aW5nIEF1ZGl0b3IgRWxlY3RvciIp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc3RvcEF1ZGl0\nb3JFbGVjdG9ycygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZvciAo\nQXVkaXRvckVsZWN0b3IgYXVkaXRvckVsZWN0b3IgOiBhdWRpdG9yRWxlY3Rv\ncnMudmFsdWVzKCkpIHsKICAgICAgICAgICAgYXVkaXRvckVsZWN0b3Iuc2h1\ndGRvd24oKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJTdG9wcGluZyBBdWRp\ndG9yIEVsZWN0b3IhIik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogVGVzdCBwdWJsaXNoaW5nIG9mIHVuZGVyIHJlcGxpY2F0ZWQgbGVkZ2Vy\ncyBieSB0aGUgYXVkaXRvciBib29raWUKICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTaW1wbGVMZWRnZXIo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJIYW5kbGUgbGgx\nID0gY3JlYXRlQW5kQWRkRW50cmllc1RvTGVkZ2VyKCk7CiAgICAgICAgTG9u\nZyBsZWRnZXJJZCA9IGxoMS5nZXRJZCgpOwogICAgICAgIExPRy5kZWJ1Zygi\nQ3JlYXRlZCBsZWRnZXIgOiAiICsgbGVkZ2VySWQpOwogICAgICAgIGxlZGdl\nckxpc3QuYWRkKGxlZGdlcklkKTsKICAgICAgICBsaDEuY2xvc2UoKTsKCiAg\nICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggdW5kZXJSZXBsaWNhTGF0Y2gg\nPSByZWdpc3RlclVyTGVkZ2VyV2F0Y2hlcihsZWRnZXJMaXN0CiAgICAgICAg\nICAgICAgICAuc2l6ZSgpKTsKCiAgICAgICAgaW50IGJrU2h1dGRvd25JbmRl\neCA9IGJzLnNpemUoKSAtIDE7CiAgICAgICAgU3RyaW5nIHNodXRkb3duQm9v\na2llID0gc2h1dGRvd25Cb29raWUoYmtTaHV0ZG93bkluZGV4KTsKCiAgICAg\nICAgLy8gZ3JhY2UgcGVyaW9kIGZvciBwdWJsaXNoaW5nIHRoZSBiay1sZWRn\nZXIKICAgICAgICBMT0cuZGVidWcoIldhaXRpbmcgZm9yIGxlZGdlcnMgdG8g\nYmUgbWFya2VkIGFzIHVuZGVyIHJlcGxpY2F0ZWQiKTsKICAgICAgICB1bmRl\nclJlcGxpY2FMYXRjaC5hd2FpdCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAg\nICAgICBNYXA8TG9uZywgU3RyaW5nPiB1ckxlZGdlckRhdGEgPSBnZXRVckxl\nZGdlckRhdGEodXJMZWRnZXJMaXN0KTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nIk1pc3NlZCBpZGVudGlmeWluZyB1bmRlciByZXBsaWNhdGVkIGxlZGdlcnMi\nLCAxLAogICAgICAgICAgICAgICAgdXJMZWRnZXJMaXN0LnNpemUoKSk7Cgog\nICAgICAgIC8qCiAgICAgICAgICogU2FtcGxlIGRhdGEgZm9ybWF0IHByZXNl\nbnQgaW4gdGhlIHVuZGVyIHJlcGxpY2F0ZWQgbGVkZ2VyIHBhdGgKICAgICAg\nICAgKiAKICAgICAgICAgKiB7ND1yZXBsaWNhOiAiMTAuMTguODkuMTUzOjUw\nMDIifQogICAgICAgICAqLwogICAgICAgIGFzc2VydFRydWUoIkxlZGdlciBp\ncyBub3QgbWFya2VkIGFzIHVuZGVycmVwbGljYXRlZDoiICsgbGVkZ2VySWQs\nCiAgICAgICAgICAgICAgICB1ckxlZGdlckxpc3QuY29udGFpbnMobGVkZ2Vy\nSWQpKTsKICAgICAgICBTdHJpbmcgZGF0YSA9IHVyTGVkZ2VyRGF0YS5nZXQo\nbGVkZ2VySWQpOwogICAgICAgIGFzc2VydFRydWUoIkJvb2tpZSAiICsgc2h1\ndGRvd25Cb29raWUKICAgICAgICAgICAgICAgICsgImlzIG5vdCBsaXN0ZWQg\naW4gdGhlIGxlZGdlciBhcyBtaXNzaW5nIHJlcGxpY2EgOiIgKyBkYXRhLAog\nICAgICAgICAgICAgICAgZGF0YS5jb250YWlucyhzaHV0ZG93bkJvb2tpZSkp\nOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBvbmNlIHB1Ymxpc2hlZCB1\nbmRlciByZXBsaWNhdGVkIGxlZGdlciBzaG91bGQgZXhpc3RzIGV2ZW4gYWZ0\nZXIKICAgICAqIHJlc3RhcnRpbmcgcmVzcGVjdGl2ZSBib29raWUKICAgICAq\nLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRl\nc3RSZXN0YXJ0Qm9va2llKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nTGVkZ2VySGFuZGxlIGxoMSA9IGNyZWF0ZUFuZEFkZEVudHJpZXNUb0xlZGdl\ncigpOwogICAgICAgIGxlZGdlckxpc3QuYWRkKGxoMS5nZXRJZCgpKTsKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGgyID0gY3JlYXRlQW5kQWRkRW50cmllc1Rv\nTGVkZ2VyKCk7CiAgICAgICAgbGVkZ2VyTGlzdC5hZGQobGgyLmdldElkKCkp\nOwogICAgICAgIExPRy5kZWJ1ZygiQ3JlYXRlZCBmb2xsb3dpbmcgbGVkZ2Vy\ncyA6ICIgKyBsZWRnZXJMaXN0KTsKCiAgICAgICAgLy8gMiBpcyBhZGRlZCB0\nbyB0aGUgbGF0Y2gsIHNpbmNlIGFmdGVyIHRoZSBsZWRnZXIgcmVmb3JtYXRp\nb24sIGFnYWluCiAgICAgICAgLy8gdGhlIHJlZm9ybWVkIGJvb2tpZSBpcyBz\ndG9wcGVkLiBTbyBhdWRpdG9yIHdpbGwgbW9kaWZ5IHRoZSB6awogICAgICAg\nIC8vIHVuZGVycmVwbGljYXRlZCBtZXRhZGF0YQogICAgICAgIGludCBjb3Vu\ndCA9IGxlZGdlckxpc3Quc2l6ZSgpICsgMjsKICAgICAgICBmaW5hbCBDb3Vu\ndERvd25MYXRjaCB1bmRlclJlcGxpY2FMYXRjaCA9IHJlZ2lzdGVyVXJMZWRn\nZXJXYXRjaGVyKGNvdW50KTsKCiAgICAgICAgaW50IGJrU2h1dGRvd25JbmRl\neCA9IGJzLnNpemUoKSAtIDE7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlv\nbiBib29raWVDb25mMSA9IGJzQ29uZnMuZ2V0KGJrU2h1dGRvd25JbmRleCk7\nCiAgICAgICAgU3RyaW5nIHNodXRkb3duQm9va2llID0gc2h1dGRvd25Cb29r\naWUoYmtTaHV0ZG93bkluZGV4KTsKCiAgICAgICAgLy8gcmVzdGFydCB0aGUg\nZmFpbGVkIGJvb2tpZSBhbmQgc2ltdWxhdGUgcHJldmlvdXNseSBsaXN0ZWQg\nbGVkZ2VycyBhcmUKICAgICAgICAvLyByZXJlcGxpY2F0ZWQKICAgICAgICBi\ncy5hZGQoc3RhcnRCb29raWUoYm9va2llQ29uZjEpKTsKCiAgICAgICAgLy8g\nZ3JhY2UgcGVyaW9kIGZvciBwdWJsaXNoaW5nIHRoZSBiay1sZWRnZXIKICAg\nICAgICBMT0cuZGVidWcoIldhaXRpbmcgZm9yIGxlZGdlcnMgdG8gYmUgbWFy\na2VkIGFzIHVuZGVyIHJlcGxpY2F0ZWQiKTsKICAgICAgICB1bmRlclJlcGxp\nY2FMYXRjaC5hd2FpdCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICBN\nYXA8TG9uZywgU3RyaW5nPiB1ckxlZGdlckRhdGEgPSBnZXRVckxlZGdlckRh\ndGEodXJMZWRnZXJMaXN0KTsKCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJNaXNz\nZWQgaWRlbnRpZnlpbmcgdW5kZXIgcmVwbGljYXRlZCBsZWRnZXJzIiwgMiwK\nICAgICAgICAgICAgICAgIHVyTGVkZ2VyTGlzdC5zaXplKCkpOwoKICAgICAg\nICAvKgogICAgICAgICAqIFNhbXBsZSBkYXRhIGZvcm1hdCBwcmVzZW50IGlu\nIHRoZSB1bmRlciByZXBsaWNhdGVkIGxlZGdlciBwYXRoCiAgICAgICAgICog\nCiAgICAgICAgICogezQ9cmVwbGljYTogIjEwLjE4Ljg5LjE1Mzo1MDAyIiwg\nNT1yZXBsaWNhOiAiMTAuMTguODkuMTUzOjUwMDMifQogICAgICAgICAqLwog\nICAgICAgIGZvciAoTG9uZyBsZWRnZXJJZCA6IGxlZGdlckxpc3QpIHsKICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZSgiTGVkZ2VyIGlzIG5vdCBtYXJrZWQgYXMg\ndW5kZXJyZXBsaWNhdGVkOiIgKyBsZWRnZXJJZCwKICAgICAgICAgICAgICAg\nICAgICB1ckxlZGdlckxpc3QuY29udGFpbnMobGVkZ2VySWQpKTsKICAgICAg\nICAgICAgU3RyaW5nIGRhdGEgPSB1ckxlZGdlckRhdGEuZ2V0KGxlZGdlcklk\nKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiQm9va2llICIgKyBzaHV0ZG93\nbkJvb2tpZQogICAgICAgICAgICAgICAgICAgICsgIiBpcyBub3QgbGlzdGVk\nIGluIHRoZSBsZWRnZXIgYXMgbWlzc2luZyAiICsgZGF0YSwgZGF0YQogICAg\nICAgICAgICAgICAgICAgIC5jb250YWlucyhzaHV0ZG93bkJvb2tpZSkpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgcHVibGlzaGlu\nZyBvZiB1bmRlciByZXBsaWNhdGVkIGxlZGdlcnMgd2hlbiBtdWx0aXBsZSBi\nb29raWUgZmFpbHVyZXMKICAgICAqIG9uZSBhZnRlciBhbm90aGVyLgogICAg\nICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdE11bHRpcGxlQm9va2llRmFpbHVyZXMoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBMZWRnZXJIYW5kbGUgbGgxID0gY3JlYXRlQW5kQWRkRW50\ncmllc1RvTGVkZ2VyKCk7CiAgICAgICAgbGVkZ2VyTGlzdC5hZGQobGgxLmdl\ndElkKCkpOwogICAgICAgIExlZGdlckhhbmRsZSBsaDIgPSBjcmVhdGVBbmRB\nZGRFbnRyaWVzVG9MZWRnZXIoKTsKICAgICAgICBsZWRnZXJMaXN0LmFkZChs\naDIuZ2V0SWQoKSk7CiAgICAgICAgTE9HLmRlYnVnKCJDcmVhdGVkIGZvbGxv\nd2luZyBsZWRnZXJzIDogIiArIGxlZGdlckxpc3QpOwoKICAgICAgICAvLyBm\nYWlsaW5nIGZpcnN0IGJvb2tpZQogICAgICAgIHNodXRkb3duQm9va2llKGJz\nLnNpemUoKSAtIDEpOwogICAgICAgIC8vIHNpbXVsYXRlIHJlLXJlcGxpY2F0\naW9uCiAgICAgICAgZG9MZWRnZXJSZXJlcGxpY2F0aW9uKGxoMS5nZXRJZCgp\nLCBsaDIuZ2V0SWQoKSk7CgogICAgICAgIC8vIGZhaWxpbmcgYW5vdGhlciBi\nb29raWUKICAgICAgICBDb3VudERvd25MYXRjaCB1bmRlclJlcGxpY2FMYXRj\naCA9IHJlZ2lzdGVyVXJMZWRnZXJXYXRjaGVyKGxlZGdlckxpc3QKICAgICAg\nICAgICAgICAgIC5zaXplKCkpOwogICAgICAgIFN0cmluZyBzaHV0ZG93bkJv\nb2tpZSA9IHNodXRkb3duQm9va2llKGJzLnNpemUoKSAtIDEpOwoKICAgICAg\nICAvLyBncmFjZSBwZXJpb2QgZm9yIHB1Ymxpc2hpbmcgdGhlIGJrLWxlZGdl\ncgogICAgICAgIExPRy5kZWJ1ZygiV2FpdGluZyBmb3IgbGVkZ2VycyB0byBi\nZSBtYXJrZWQgYXMgdW5kZXIgcmVwbGljYXRlZCIpOwogICAgICAgIHVuZGVy\nUmVwbGljYUxhdGNoLmF3YWl0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAg\nICAgIE1hcDxMb25nLCBTdHJpbmc+IHVyTGVkZ2VyRGF0YSA9IGdldFVyTGVk\nZ2VyRGF0YSh1ckxlZGdlckxpc3QpOwoKICAgICAgICBhc3NlcnRFcXVhbHMo\nIk1pc3NlZCBpZGVudGlmeWluZyB1bmRlciByZXBsaWNhdGVkIGxlZGdlcnMi\nLCAyLAogICAgICAgICAgICAgICAgdXJMZWRnZXJMaXN0LnNpemUoKSk7Cgog\nICAgICAgIC8qCiAgICAgICAgICogU2FtcGxlIGRhdGEgZm9ybWF0IHByZXNl\nbnQgaW4gdGhlIHVuZGVyIHJlcGxpY2F0ZWQgbGVkZ2VyIHBhdGgKICAgICAg\nICAgKiB7ND1yZXBsaWNhOiAiMTAuMTguODkuMTUzOjUwMDIiLCA1PXJlcGxp\nY2E6ICIxMC4xOC44OS4xNTM6NTAwMyJ9CiAgICAgICAgICovCiAgICAgICAg\nZm9yIChMb25nIGxlZGdlcklkIDogbGVkZ2VyTGlzdCkgewogICAgICAgICAg\nICBhc3NlcnRUcnVlKCJMZWRnZXIgaXMgbm90IG1hcmtlZCBhcyB1bmRlcnJl\ncGxpY2F0ZWQ6IiArIGxlZGdlcklkLAogICAgICAgICAgICAgICAgICAgIHVy\nTGVkZ2VyTGlzdC5jb250YWlucyhsZWRnZXJJZCkpOwogICAgICAgICAgICBT\ndHJpbmcgZGF0YSA9IHVyTGVkZ2VyRGF0YS5nZXQobGVkZ2VySWQpOwogICAg\nICAgICAgICBhc3NlcnRUcnVlKCJCb29raWUgIiArIHNodXRkb3duQm9va2ll\nCiAgICAgICAgICAgICAgICAgICAgKyAiIGlzIG5vdCBsaXN0ZWQgaW4gdGhl\nIGxlZGdlciBhcyBtaXNzaW5nICIgKyBkYXRhLCBkYXRhCiAgICAgICAgICAg\nICAgICAgICAgLmNvbnRhaW5zKHNodXRkb3duQm9va2llKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQgPSAzMDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RUb2dnbGVMZWRnZXJSZXBsaWNhdGlvbigpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIExlZGdlckhhbmRsZSBsaDEgPSBjcmVhdGVB\nbmRBZGRFbnRyaWVzVG9MZWRnZXIoKTsKICAgICAgICBsZWRnZXJMaXN0LmFk\nZChsaDEuZ2V0SWQoKSk7CiAgICAgICAgTE9HLmRlYnVnKCJDcmVhdGVkIGZv\nbGxvd2luZyBsZWRnZXJzIDogIiArIGxlZGdlckxpc3QpOwoKICAgICAgICAv\nLyBmYWlsaW5nIGFub3RoZXIgYm9va2llCiAgICAgICAgQ291bnREb3duTGF0\nY2ggdXJSZXBsaWNhTGF0Y2ggPSByZWdpc3RlclVyTGVkZ2VyV2F0Y2hlcihs\nZWRnZXJMaXN0CiAgICAgICAgICAgICAgICAuc2l6ZSgpKTsKCiAgICAgICAg\nLy8gZGlzYWJsaW5nIGxlZGdlciByZXBsaWNhdGlvbgogICAgICAgIHVyTGVk\nZ2VyTWdyLmRpc2FibGVMZWRnZXJSZXBsaWNhdGlvbigpOwogICAgICAgIEFy\ncmF5TGlzdDxTdHJpbmc+IHNodXRkb3duQm9va2llTGlzdCA9IG5ldyBBcnJh\neUxpc3Q8U3RyaW5nPigpOwogICAgICAgIHNodXRkb3duQm9va2llTGlzdC5h\nZGQoc2h1dGRvd25Cb29raWUoYnMuc2l6ZSgpIC0gMSkpOwogICAgICAgIHNo\ndXRkb3duQm9va2llTGlzdC5hZGQoc2h1dGRvd25Cb29raWUoYnMuc2l6ZSgp\nIC0gMSkpOwoKICAgICAgICBhc3NlcnRGYWxzZSgiTGVkZ2VyIHJlcGxpY2F0\naW9uIGlzIG5vdCBkaXNhYmxlZCEiLCB1clJlcGxpY2FMYXRjaAogICAgICAg\nICAgICAgICAgLmF3YWl0KDUsIFRpbWVVbml0LlNFQ09ORFMpKTsKCiAgICAg\nICAgLy8gZW5hYmxpbmcgbGVkZ2VyIHJlcGxpY2F0aW9uCiAgICAgICAgdXJM\nZWRnZXJNZ3IuZW5hYmxlTGVkZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICBh\nc3NlcnRUcnVlKCJMZWRnZXIgcmVwbGljYXRpb24gaXMgbm90IGVuYWJsZWQh\nIiwgdXJSZXBsaWNhTGF0Y2guYXdhaXQoCiAgICAgICAgICAgICAgICA1LCBU\naW1lVW5pdC5TRUNPTkRTKSk7CiAgICB9CgogICAgQFRlc3QodGltZW91dCA9\nIDIwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdER1cGxpY2F0ZUVuRGlzYWJs\nZUF1dG9SZWNvdmVyeSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHVy\nTGVkZ2VyTWdyLmRpc2FibGVMZWRnZXJSZXBsaWNhdGlvbigpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHVyTGVkZ2VyTWdyLmRpc2FibGVMZWRnZXJS\nZXBsaWNhdGlvbigpOwogICAgICAgICAgICBmYWlsKCJNdXN0IHRocm93IGV4\nY2VwdGlvbiwgc2luY2UgQXV0b1JlY292ZXJ5IGlzIGFscmVhZHkgZGlzYWJs\nZWQiKTsKICAgICAgICB9IGNhdGNoIChVbmF2YWlsYWJsZUV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUoIkF1dG9SZWNvdmVyeSBpcyBu\nb3QgZGlzYWJsZWQgcHJldmlvdXNseSEiLAogICAgICAgICAgICAgICAgICAg\nIGUuZ2V0Q2F1c2UoKSBpbnN0YW5jZW9mIEtlZXBlckV4Y2VwdGlvbi5Ob2Rl\nRXhpc3RzRXhjZXB0aW9uKTsKICAgICAgICB9CiAgICAgICAgdXJMZWRnZXJN\nZ3IuZW5hYmxlTGVkZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICB1ckxlZGdlck1nci5lbmFibGVMZWRnZXJSZXBsaWNhdGlv\nbigpOwogICAgICAgICAgICBmYWlsKCJNdXN0IHRocm93IGV4Y2VwdGlvbiwg\nc2luY2UgQXV0b1JlY292ZXJ5IGlzIGFscmVhZHkgZW5hYmxlZCIpOwogICAg\nICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgiQXV0b1JlY292ZXJ5IGlzIG5vdCBlbmFibGVk\nIHByZXZpb3VzbHkhIiwKICAgICAgICAgICAgICAgICAgICBlLmdldENhdXNl\nKCkgaW5zdGFuY2VvZiBLZWVwZXJFeGNlcHRpb24uTm9Ob2RlRXhjZXB0aW9u\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBDb3VudERvd25MYXRj\naCByZWdpc3RlclVyTGVkZ2VyV2F0Y2hlcihpbnQgY291bnQpCiAgICAgICAg\nICAgIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0\naW9uIHsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCB1bmRlclJlcGxp\nY2FMYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaChjb3VudCk7CiAgICAgICAg\nZm9yIChMb25nIGxlZGdlcklkIDogbGVkZ2VyTGlzdCkgewogICAgICAgICAg\nICBXYXRjaGVyIHVyTGVkZ2VyV2F0Y2hlciA9IG5ldyBDaGlsZFdhdGNoZXIo\ndW5kZXJSZXBsaWNhTGF0Y2gpOwogICAgICAgICAgICBTdHJpbmcgem5vZGUg\nPSBaa0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyLmdldFVyTGVkZ2Vy\nWm5vZGUoVU5ERVJSRVBMSUNBVEVEX1BBVEgsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsZWRnZXJJZCk7CiAgICAgICAgICAgIHprYy5leGlz\ndHMoem5vZGUsIHVyTGVkZ2VyV2F0Y2hlcik7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB1bmRlclJlcGxpY2FMYXRjaDsKICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgZG9MZWRnZXJSZXJlcGxpY2F0aW9uKExvbmcuLi4gbGVkZ2VySWRz\nKQogICAgICAgICAgICB0aHJvd3MgVW5hdmFpbGFibGVFeGNlcHRpb24gewog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbGVkZ2VySWRzLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGxvbmcgbGlkID0gdXJMZWRnZXJNZ3IuZ2V0\nTGVkZ2VyVG9SZXJlcGxpY2F0ZSgpOwogICAgICAgICAgICBhc3NlcnRUcnVl\nKCJSZWNlaXZlZCB1bmV4cGVjdGVkIGxlZGdlcmlkIiwgQXJyYXlzLmFzTGlz\ndChsZWRnZXJJZHMpLmNvbnRhaW5zKGxpZCkpOwogICAgICAgICAgICB1ckxl\nZGdlck1nci5tYXJrTGVkZ2VyUmVwbGljYXRlZChsaWQpOwogICAgICAgICAg\nICB1ckxlZGdlck1nci5yZWxlYXNlVW5kZXJyZXBsaWNhdGVkTGVkZ2VyKGxp\nZCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIHNodXRk\nb3duQm9va2llKGludCBia1NodXRkb3duSW5kZXgpIHRocm93cyBJT0V4Y2Vw\ndGlvbiwKICAgICAgICAgICAgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAg\nICAgIEJvb2tpZVNlcnZlciBia1NlcnZlciA9IGJzLmdldChia1NodXRkb3du\nSW5kZXgpOwogICAgICAgIFN0cmluZyBib29raWVBZGRyID0gU3RyaW5nVXRp\nbHMuYWRkclRvU3RyaW5nKGJrU2VydmVyLmdldExvY2FsQWRkcmVzcygpKTsK\nICAgICAgICBMT0cuZGVidWcoIlNodXR0aW5nIGRvd24gYm9va2llOiIgKyBi\nb29raWVBZGRyKTsKICAgICAgICBraWxsQm9va2llKGJrU2h1dGRvd25JbmRl\neCk7CiAgICAgICAgYXVkaXRvckVsZWN0b3JzLmdldChib29raWVBZGRyKS5z\naHV0ZG93bigpOwogICAgICAgIGF1ZGl0b3JFbGVjdG9ycy5yZW1vdmUoYm9v\na2llQWRkcik7CiAgICAgICAgcmV0dXJuIGJvb2tpZUFkZHI7CiAgICB9Cgog\nICAgcHJpdmF0ZSBMZWRnZXJIYW5kbGUgY3JlYXRlQW5kQWRkRW50cmllc1Rv\nTGVkZ2VyKCkgdGhyb3dzIEJLRXhjZXB0aW9uLAogICAgICAgICAgICBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgaW50IG51bUVudHJpZXNUb1dy\naXRlID0gMTAwOwogICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAg\nIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlw\nZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgIExPRy5pbmZvKCJMZWRnZXIg\nSUQ6ICIgKyBsaC5nZXRJZCgpKTsKICAgICAgICBhZGRFbnRyeShudW1FbnRy\naWVzVG9Xcml0ZSwgbGgpOwogICAgICAgIHJldHVybiBsaDsKICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgYWRkRW50cnkoaW50IG51bUVudHJpZXNUb1dyaXRl\nLCBMZWRnZXJIYW5kbGUgbGgpCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAg\nICAgICBCeXRlQnVmZmVyIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0\nKTsKICAgICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KEludGVn\nZXIuTUFYX1ZBTFVFKSk7CiAgICAgICAgICAgIGVudHJ5LnBvc2l0aW9uKDAp\nOwogICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRyeS5hcnJheSgpKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBNYXA8TG9uZywgU3RyaW5nPiBn\nZXRVckxlZGdlckRhdGEoU2V0PExvbmc+IHVyTGVkZ2VyTGlzdCkKICAgICAg\nICAgICAgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgIE1hcDxMb25nLCBTdHJpbmc+IHVyTGVkZ2VyRGF0\nYSA9IG5ldyBIYXNoTWFwPExvbmcsIFN0cmluZz4oKTsKICAgICAgICBmb3Ig\nKExvbmcgbGVkZ2VySWQgOiB1ckxlZGdlckxpc3QpIHsKICAgICAgICAgICAg\nU3RyaW5nIHpub2RlID0gWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdl\nci5nZXRVckxlZGdlclpub2RlKFVOREVSUkVQTElDQVRFRF9QQVRILAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQpOwogICAgICAg\nICAgICBieXRlW10gZGF0YSA9IHprYy5nZXREYXRhKHpub2RlLCBmYWxzZSwg\nbnVsbCk7CiAgICAgICAgICAgIHVyTGVkZ2VyRGF0YS5wdXQobGVkZ2VySWQs\nIG5ldyBTdHJpbmcoZGF0YSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\ndXJMZWRnZXJEYXRhOwogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQ2hpbGRX\nYXRjaGVyIGltcGxlbWVudHMgV2F0Y2hlciB7CiAgICAgICAgcHJpdmF0ZSBm\naW5hbCBDb3VudERvd25MYXRjaCB1bmRlclJlcGxpY2FMYXRjaDsKCiAgICAg\nICAgcHVibGljIENoaWxkV2F0Y2hlcihDb3VudERvd25MYXRjaCB1bmRlclJl\ncGxpY2FMYXRjaCkgewogICAgICAgICAgICB0aGlzLnVuZGVyUmVwbGljYUxh\ndGNoID0gdW5kZXJSZXBsaWNhTGF0Y2g7CiAgICAgICAgfQoKICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRF\ndmVudCBldmVudCkgewogICAgICAgICAgICBMT0cuaW5mbygiUmVjZWl2ZWQg\nbm90aWZpY2F0aW9uIGZvciB0aGUgbGVkZ2VyIHBhdGggOiAiCiAgICAgICAg\nICAgICAgICAgICAgKyBldmVudC5nZXRQYXRoKCkpOwogICAgICAgICAgICBm\nb3IgKExvbmcgbGVkZ2VySWQgOiBsZWRnZXJMaXN0KSB7CiAgICAgICAgICAg\nICAgICBpZiAoZXZlbnQuZ2V0UGF0aCgpLmNvbnRhaW5zKGxlZGdlcklkICsg\nIiIpKSB7CiAgICAgICAgICAgICAgICAgICAgdXJMZWRnZXJMaXN0LmFkZChM\nb25nLnZhbHVlT2YobGVkZ2VySWQpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBMT0cuZGVidWcoIkNvdW50IGRvd24g\nYW5kIHdhaXRpbmcgZm9yIG5leHQgbm90aWZpY2F0aW9uIik7CiAgICAgICAg\nICAgIC8vIGNvdW50IGRvd24gYW5kIHdhaXRpbmcgZm9yIG5leHQgbm90aWZp\nY2F0aW9uCiAgICAgICAgICAgIHVuZGVyUmVwbGljYUxhdGNoLmNvdW50RG93\nbigpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

