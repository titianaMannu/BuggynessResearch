{"sha":"3e46c8ba72cd848462876026f5a9658e36f2736d","node_id":"MDQ6QmxvYjE1NzU5NTY6M2U0NmM4YmE3MmNkODQ4NDYyODc2MDI2ZjVhOTY1OGUzNmYyNzM2ZA==","size":10533,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3e46c8ba72cd848462876026f5a9658e36f2736d","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdC5Cb29rS2Vl\ncGVyQ2x1c3RlclRlc3RDYXNlOwoKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2\nYS5pby5GaWxlT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5GaWxlbmFt\nZUZpbHRlcjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBq\nYXZhLm5pby5CeXRlQnVmZmVyOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5ib29raWUuQm9va2llQWNjZXNzb3I7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIudXRpbC5TdHJpbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci56b29rZWVwZXIuWm9vS2VlcGVyV2F0Y2hlckJhc2U7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVw\nZXIuRGlnZXN0VHlwZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5tZXRhLkxlZGdlck1hbmFnZXJGYWN0b3J5OwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2VyVW5kZXJyZXBs\naWNhdGlvbk1hbmFnZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnV0aWwuWmtVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5i\nb29raWUuQm9va2llOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJv\nb2tpZS5MZWRnZXJDYWNoZUltcGw7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tl\nZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuanVuaXQuQmVmb3JlOwppbXBv\ncnQgb3JnLmp1bml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7Cmlt\ncG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRFcXVhbHM7Cgpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXJGYWN0b3J5OwoKLyoqCiAqIFRoaXMgdGVzdCB2ZXJpZmllcyB0aGF0IHRo\nZSBwZXJpb2QgY2hlY2sgb24gdGhlIGF1ZGl0b3IKICogd2lsbCBwaWNrIHVw\nIG9uIG1pc3NpbmcgZGF0YSBpbiB0aGUgY2xpZW50CiAqLwpwdWJsaWMgY2xh\nc3MgQXVkaXRvclBlcmlvZGljQ2hlY2tUZXN0IGV4dGVuZHMgQm9va0tlZXBl\nckNsdXN0ZXJUZXN0Q2FzZSB7CiAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBM\nb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeQogICAgICAgICAgICAuZ2V0TG9n\nZ2VyKEF1ZGl0b3JQZXJpb2RpY0NoZWNrVGVzdC5jbGFzcyk7CgogICAgcHJp\ndmF0ZSBIYXNoTWFwPFN0cmluZywgQXVkaXRvckVsZWN0b3I+IGF1ZGl0b3JF\nbGVjdG9ycyA9IG5ldyBIYXNoTWFwPFN0cmluZywgQXVkaXRvckVsZWN0b3I+\nKCk7CiAgICBwcml2YXRlIExpc3Q8Wm9vS2VlcGVyPiB6a0NsaWVudHMgPSBu\nZXcgTGlua2VkTGlzdDxab29LZWVwZXI+KCk7CgogICAgcHJpdmF0ZSBmaW5h\nbCBzdGF0aWMgaW50IENIRUNLX0lOVEVSVkFMID0gMTAwMDsgLy8gcnVuIGV2\nZXJ5IHNlY29uZAoKICAgIHB1YmxpYyBBdWRpdG9yUGVyaW9kaWNDaGVja1Rl\nc3QoKSB7CiAgICAgICAgc3VwZXIoMyk7CiAgICAgICAgYmFzZUNvbmYuc2V0\nUGFnZUxpbWl0KDEpOyAvLyB0byBtYWtlIGl0IGVhc3kgdG8gcHVzaCBsZWRn\nZXIgb3V0IG9mIGNhY2hlCiAgICB9CgogICAgQEJlZm9yZQogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIHN1cGVyLnNldFVwKCk7CgogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbnVtQm9va2llczsgaSsrKSB7CiAgICAgICAgICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9u\nKGJzQ29uZnMuZ2V0KGkpKTsKICAgICAgICAgICAgY29uZi5zZXRBdWRpdG9y\nUGVyaW9kaWNDaGVja0ludGVydmFsKENIRUNLX0lOVEVSVkFMKTsKCiAgICAg\nICAgICAgIFN0cmluZyBhZGRyID0gU3RyaW5nVXRpbHMuYWRkclRvU3RyaW5n\nKGJzLmdldChpKS5nZXRMb2NhbEFkZHJlc3MoKSk7CgogICAgICAgICAgICBa\nb29LZWVwZXJXYXRjaGVyQmFzZSB3ID0gbmV3IFpvb0tlZXBlcldhdGNoZXJC\nYXNlKDEwMDAwKTsKICAgICAgICAgICAgWm9vS2VlcGVyIHprID0gWmtVdGls\ncy5jcmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGllbnQoCiAgICAgICAgICAg\nICAgICAgICAgemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSwg\ndyk7CiAgICAgICAgICAgIHprQ2xpZW50cy5hZGQoemspOwoKICAgICAgICAg\nICAgQXVkaXRvckVsZWN0b3IgYXVkaXRvckVsZWN0b3IgPSBuZXcgQXVkaXRv\nckVsZWN0b3IoYWRkciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZiwgemspOwog\nICAgICAgICAgICBhdWRpdG9yRWxlY3RvcnMucHV0KGFkZHIsIGF1ZGl0b3JF\nbGVjdG9yKTsKICAgICAgICAgICAgYXVkaXRvckVsZWN0b3Iuc3RhcnQoKTsK\nICAgICAgICAgICAgTE9HLmRlYnVnKCJTdGFydGluZyBBdWRpdG9yIEVsZWN0\nb3IiKTsKICAgICAgICB9CiAgICB9CgogICAgQEFmdGVyCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgZm9yIChBdWRpdG9yRWxlY3RvciBlIDogYXVkaXRvckVs\nZWN0b3JzLnZhbHVlcygpKSB7CiAgICAgICAgICAgIGUuc2h1dGRvd24oKTsK\nICAgICAgICB9CiAgICAgICAgZm9yIChab29LZWVwZXIgemsgOiB6a0NsaWVu\ndHMpIHsKICAgICAgICAgICAgemsuY2xvc2UoKTsKICAgICAgICB9CiAgICAg\nICAgemtDbGllbnRzLmNsZWFyKCk7CiAgICAgICAgc3VwZXIudGVhckRvd24o\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIHRlc3QgdGhhdCB0aGUgcGVyaW9k\naWMgY2hlY2tpbmcgd2lsbCBkZXRlY3QgY29ycnVwdGlvbnMgaW4KICAgICAq\nIHRoZSBib29raWUgZW50cnkgbG9nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVv\ndXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RW50cnlMb2dDb3JydXB0\naW9uKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyTWFuYWdl\nckZhY3RvcnkgbUZhY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdM\nZWRnZXJNYW5hZ2VyRmFjdG9yeShic0NvbmZzLmdldCgwKSwgemtjKTsKICAg\nICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB1bmRlclJlcGxp\nY2F0aW9uTWFuYWdlciA9IG1GYWN0b3J5Lm5ld0xlZGdlclVuZGVycmVwbGlj\nYXRpb25NYW5hZ2VyKCk7CiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIuZGlzYWJsZUxlZGdlclJlcGxpY2F0aW9uKCk7CgogICAgICAgIExlZGdl\nckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoMywgMywgRGlnZXN0VHlw\nZS5DUkMzMiwgInBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgbG9uZyBs\nZWRnZXJJZCA9IGxoLmdldElkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCAxMDA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRyeSgidGVz\ndGRhdGEiLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAgICAgICBsaC5jbG9z\nZSgpOwoKICAgICAgICBCb29raWVBY2Nlc3Nvci5mb3JjZUZsdXNoKGJzLmdl\ndCgwKS5nZXRCb29raWUoKSk7CgoKICAgICAgICBGaWxlIGxlZGdlckRpciA9\nIGJzQ29uZnMuZ2V0KDApLmdldExlZGdlckRpcnMoKVswXTsKICAgICAgICBs\nZWRnZXJEaXIgPSBCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJE\naXIpOwogICAgICAgIC8vIGNvcnJ1cHQgb2YgZW50cnlMb2dzCiAgICAgICAg\nRmlsZVtdIGVudHJ5TG9ncyA9IGxlZGdlckRpci5saXN0RmlsZXMobmV3IEZp\nbGVuYW1lRmlsdGVyKCkgewogICAgICAgICAgICAgICAgcHVibGljIGJvb2xl\nYW4gYWNjZXB0KEZpbGUgZGlyLCBTdHJpbmcgbmFtZSkgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuYW1lLmVuZHNXaXRoKCIubG9nIik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIEJ5dGVCdWZm\nZXIganVuayA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMTAyNCoxMDI0KTsKICAg\nICAgICBmb3IgKEZpbGUgZiA6IGVudHJ5TG9ncykgewogICAgICAgICAgICBG\naWxlT3V0cHV0U3RyZWFtIG91dCA9IG5ldyBGaWxlT3V0cHV0U3RyZWFtKGYp\nOwogICAgICAgICAgICBvdXQuZ2V0Q2hhbm5lbCgpLndyaXRlKGp1bmspOwog\nICAgICAgICAgICBvdXQuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgcmVz\ndGFydEJvb2tpZXMoKTsgLy8gcmVzdGFydCB0byBjbGVhciByZWFkIGJ1ZmZl\ncnMKCiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIuZW5hYmxlTGVk\nZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICBsb25nIHVuZGVyUmVwbGljYXRl\nZExlZGdlciA9IC0xOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7\nIGkrKykgewogICAgICAgICAgICB1bmRlclJlcGxpY2F0ZWRMZWRnZXIgPSB1\nbmRlclJlcGxpY2F0aW9uTWFuYWdlci5wb2xsTGVkZ2VyVG9SZXJlcGxpY2F0\nZSgpOwogICAgICAgICAgICBpZiAodW5kZXJSZXBsaWNhdGVkTGVkZ2VyICE9\nIC0xKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBUaHJlYWQuc2xlZXAoQ0hFQ0tfSU5URVJWQUwpOwogICAg\nICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMoIkxlZGdlciBzaG91bGQgYmUg\ndW5kZXIgcmVwbGljYXRlZCIsIGxlZGdlcklkLCB1bmRlclJlcGxpY2F0ZWRM\nZWRnZXIpOwogICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmNsb3Nl\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiB0ZXN0IHRoYXQgdGhlIHBlcmlv\nZCBjaGVja2VyIHdpbGwgZGV0ZWN0IGNvcnJ1cHRpb25zIGluCiAgICAgKiB0\naGUgYm9va2llIGluZGV4IGZpbGVzCiAgICAgKi8KICAgIEBUZXN0KHRpbWVv\ndXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0SW5kZXhDb3JydXB0aW9u\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyTWFuYWdlckZh\nY3RvcnkgbUZhY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRn\nZXJNYW5hZ2VyRmFjdG9yeShic0NvbmZzLmdldCgwKSwgemtjKTsKICAgICAg\nICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB1bmRlclJlcGxpY2F0\naW9uTWFuYWdlciA9IG1GYWN0b3J5Lm5ld0xlZGdlclVuZGVycmVwbGljYXRp\nb25NYW5hZ2VyKCk7CgogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5j\ncmVhdGVMZWRnZXIoMywgMywgRGlnZXN0VHlwZS5DUkMzMiwgInBhc3N3ZCIu\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgbG9uZyBsZWRnZXJUb0NvcnJ1cHQgPSBs\naC5nZXRJZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBp\nKyspIHsKICAgICAgICAgICAgbGguYWRkRW50cnkoInRlc3RkYXRhIi5nZXRC\neXRlcygpKTsKICAgICAgICB9CiAgICAgICAgbGguY2xvc2UoKTsKCiAgICAg\nICAgLy8gcHVzaCBsZWRnZXJUb0NvcnJ1cHQgb3V0IG9mIHBhZ2UgY2FjaGUg\nKGJvb2tpZSBpcyBjb25maWd1cmVkIHRvIG9ubHkgdXNlIDEgcGFnZSkKICAg\nICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoMywgMywgRGlnZXN0VHlwZS5D\nUkMzMiwgInBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCAxMDA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRy\neSgidGVzdGRhdGEiLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAgICAgICBs\naC5jbG9zZSgpOwoKICAgICAgICBCb29raWVBY2Nlc3Nvci5mb3JjZUZsdXNo\nKGJzLmdldCgwKS5nZXRCb29raWUoKSk7CgogICAgICAgIEZpbGUgbGVkZ2Vy\nRGlyID0gYnNDb25mcy5nZXQoMCkuZ2V0TGVkZ2VyRGlycygpWzBdOwogICAg\nICAgIGxlZGdlckRpciA9IEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxl\nZGdlckRpcik7CgogICAgICAgIC8vIGNvcnJ1cHQgb2YgZW50cnlMb2dzCiAg\nICAgICAgRmlsZSBpbmRleCA9IG5ldyBGaWxlKGxlZGdlckRpciwgTGVkZ2Vy\nQ2FjaGVJbXBsLmdldExlZGdlck5hbWUobGVkZ2VyVG9Db3JydXB0KSk7CiAg\nICAgICAgTE9HLmluZm8oImZpbGUgdG8gY29ycnVwdHt9IiAsIGluZGV4KTsK\nICAgICAgICBCeXRlQnVmZmVyIGp1bmsgPSBCeXRlQnVmZmVyLmFsbG9jYXRl\nKDEwMjQqMTAyNCk7CiAgICAgICAgRmlsZU91dHB1dFN0cmVhbSBvdXQgPSBu\nZXcgRmlsZU91dHB1dFN0cmVhbShpbmRleCk7CiAgICAgICAgb3V0LmdldENo\nYW5uZWwoKS53cml0ZShqdW5rKTsKICAgICAgICBvdXQuY2xvc2UoKTsKCiAg\nICAgICAgbG9uZyB1bmRlclJlcGxpY2F0ZWRMZWRnZXIgPSAtMTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAg\ndW5kZXJSZXBsaWNhdGVkTGVkZ2VyID0gdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIucG9sbExlZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICAgICAgaWYg\nKHVuZGVyUmVwbGljYXRlZExlZGdlciAhPSAtMSkgewogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGhyZWFkLnNs\nZWVwKENIRUNLX0lOVEVSVkFMKTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0\nRXF1YWxzKCJMZWRnZXIgc2hvdWxkIGJlIHVuZGVyIHJlcGxpY2F0ZWQiLCBs\nZWRnZXJUb0NvcnJ1cHQsIHVuZGVyUmVwbGljYXRlZExlZGdlcik7CiAgICAg\nICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIuY2xvc2UoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgdGhhdCB0aGUgcGVyaW9kIGNoZWNrZXIgd2ls\nbCBub3QgcnVuIHdoZW4gYXV0byByZXBsaWNhdGlvbiBoYXMgYmVlbiBkaXNh\nYmxlZAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdFBlcmlvZGljQ2hlY2tXaGVuRGlzYWJsZWQoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJNYW5hZ2VyRmFjdG9yeSBt\nRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0b3J5Lm5ld0xlZGdlck1hbmFn\nZXJGYWN0b3J5KGJzQ29uZnMuZ2V0KDApLCB6a2MpOwogICAgICAgIGZpbmFs\nIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIHVuZGVyUmVwbGljYXRp\nb25NYW5hZ2VyID0gbUZhY3RvcnkubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlv\nbk1hbmFnZXIoKTsKICAgICAgICBmaW5hbCBpbnQgbnVtTGVkZ2VycyA9IDEw\nMDsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1MZWRnZXJzOyBp\nKyspIHsKICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0\nZUxlZGdlcigzLCAzLCBEaWdlc3RUeXBlLkNSQzMyLCAicGFzc3dkIi5nZXRC\neXRlcygpKTsKCiAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgMTAw\nOyBqKyspIHsKICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KCJ0ZXN0ZGF0\nYSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGgu\nY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1h\nbmFnZXIuZGlzYWJsZUxlZGdlclJlcGxpY2F0aW9uKCk7CgogICAgICAgIGZp\nbmFsIEF0b21pY0ludGVnZXIgbnVtUmVhZHMgPSBuZXcgQXRvbWljSW50ZWdl\ncigwKTsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBraWxs\nQm9va2llKDApOwoKICAgICAgICBCb29raWUgZGVhZEJvb2tpZSA9IG5ldyBC\nb29raWUoY29uZikgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgcHVibGljIEJ5dGVCdWZmZXIgcmVhZEVudHJ5KGxvbmcgbGVkZ2VySWQs\nIGxvbmcgZW50cnlJZCkKICAgICAgICAgICAgICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24sIE5vTGVkZ2VyRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nIC8vIHdlIHdhbnQgdG8gZGlzYWJsZSBkdXJpbmcgY2hlY2tpbmcKICAgICAg\nICAgICAgICAgIG51bVJlYWRzLmluY3JlbWVudEFuZEdldCgpOwogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJGYWtlIEkvTyBleGNl\ncHRpb24iKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgYnND\nb25mcy5hZGQoY29uZik7CiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2llKGNv\nbmYsIGRlYWRCb29raWUpKTsKCiAgICAgICAgVGhyZWFkLnNsZWVwKENIRUNL\nX0lOVEVSVkFMICogMik7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJOb3RoaW5n\nIHNob3VsZCBoYXZlIHRyaWVkIHRvIHJlYWQiLCAwLCBudW1SZWFkcy5nZXQo\nKSk7CiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIuZW5hYmxlTGVk\nZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICBUaHJlYWQuc2xlZXAoQ0hFQ0tf\nSU5URVJWQUwgKiAyKTsgLy8gZ2l2ZSBpdCB0aW1lIHRvIHJ1bgoKICAgICAg\nICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5kaXNhYmxlTGVkZ2VyUmVwbGlj\nYXRpb24oKTsKICAgICAgICAvLyBnaXZlIGl0IHRpbWUgdG8gc3RvcCwgZnJv\nbSB0aGlzIHBvaW50IG5vdGhpbmcgbmV3IHNob3VsZCBiZSBtYXJrZWQKICAg\nICAgICBUaHJlYWQuc2xlZXAoQ0hFQ0tfSU5URVJWQUwgKiAyKTsKCiAgICAg\nICAgaW50IG51bVVuZGVycmVwbGljYXRlZCA9IDA7CiAgICAgICAgbG9uZyB1\nbmRlclJlcGxpY2F0ZWRMZWRnZXIgPSAtMTsKICAgICAgICBkbyB7CiAgICAg\nICAgICAgIHVuZGVyUmVwbGljYXRlZExlZGdlciA9IHVuZGVyUmVwbGljYXRp\nb25NYW5hZ2VyLnBvbGxMZWRnZXJUb1JlcmVwbGljYXRlKCk7CiAgICAgICAg\nICAgIGlmICh1bmRlclJlcGxpY2F0ZWRMZWRnZXIgPT0gLTEpIHsKICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG51\nbVVuZGVycmVwbGljYXRlZCsrOwoKICAgICAgICAgICAgdW5kZXJSZXBsaWNh\ndGlvbk1hbmFnZXIubWFya0xlZGdlclJlcGxpY2F0ZWQodW5kZXJSZXBsaWNh\ndGVkTGVkZ2VyKTsKICAgICAgICB9IHdoaWxlICh1bmRlclJlcGxpY2F0ZWRM\nZWRnZXIgIT0gLTEpOwoKICAgICAgICBUaHJlYWQuc2xlZXAoQ0hFQ0tfSU5U\nRVJWQUwgKiAyKTsgLy8gZ2l2ZSBhIGNoYW5jZSB0byBydW4gYWdhaW4gKGl0\nIHNob3VsZG4ndCwgaXQncyBkaXNhYmxlZCkKCiAgICAgICAgLy8gZW5zdXJl\nIHRoYXQgbm90aGluZyBpcyBtYXJrZWQgYXMgdW5kZXJyZXBsaWNhdGVkCiAg\nICAgICAgdW5kZXJSZXBsaWNhdGVkTGVkZ2VyID0gdW5kZXJSZXBsaWNhdGlv\nbk1hbmFnZXIucG9sbExlZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICBh\nc3NlcnRFcXVhbHMoIlRoZXJlIHNob3VsZCBiZSBubyB1bmRlcnJlcGxpY2F0\nZWQgbGVkZ2VycyIsIC0xLCB1bmRlclJlcGxpY2F0ZWRMZWRnZXIpOwoKICAg\nICAgICBMT0cuaW5mbygie30gb2Yge30gbGVkZ2VycyB1bmRlcnJlcGxpY2F0\nZWQiLCBudW1VbmRlcnJlcGxpY2F0ZWQsIG51bVVuZGVycmVwbGljYXRlZCk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZSgiQWxsIHNob3VsZCBiZSB1bmRlcnJlcGxp\nY2F0ZWQiLAogICAgICAgICAgICAgICAgbnVtVW5kZXJyZXBsaWNhdGVkIDw9\nIG51bUxlZGdlcnMgJiYgbnVtVW5kZXJyZXBsaWNhdGVkID4gMCk7CiAgICB9\nCn0K\n","encoding":"base64"}

