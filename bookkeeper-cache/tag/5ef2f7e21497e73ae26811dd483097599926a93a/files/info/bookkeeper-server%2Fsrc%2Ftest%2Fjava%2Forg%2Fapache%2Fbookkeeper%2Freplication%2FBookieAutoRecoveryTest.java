{"sha":"c902b35b30c2de9050a47b978849875b9bff5123","node_id":"MDQ6QmxvYjE1NzU5NTY6YzkwMmIzNWIzMGMyZGU5MDUwYTQ3Yjk3ODg0OTg3NWI5YmZmNTEyMw==","size":17572,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c902b35b30c2de9050a47b978849875b9bff5123","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbjsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uZXQu\nSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuU29y\ndGVkTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3du\nTGF0Y2g7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5C\nS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZUFkYXB0ZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2VyTWFu\nYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0\nYS5MZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5tZXRhLlprTGVkZ2VyVW5kZXJyZXBsaWNhdGlv\nbk1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nQm9va2llU2VydmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJl\ncGxpY2F0aW9uLlJlcGxpY2F0aW9uRXhjZXB0aW9uLkNvbXBhdGliaWxpdHlF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGlj\nYXRpb24uUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdC5NdWx0aUxl\nZGdlck1hbmFnZXJUZXN0Q2FzZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLldhdGNoZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVy\nLkV2ZW50LkV2ZW50VHlwZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLmRhdGEuU3RhdDsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5\nOwoKLyoqCiAqIEludGVncmF0aW9uIHRlc3RzIHZlcmlmaWVzIHRoZSBjb21w\nbGV0ZSBmdW5jdGlvbmFsaXR5IG9mIHRoZQogKiBBdWRpdG9yLXJlcmVwbGlj\nYXRpb24gcHJvY2VzczogQXVkaXRvciB3aWxsIHB1Ymxpc2ggdGhlIGJvb2tp\nZSBmYWlsdXJlcywKICogY29uc2VxdWVudGx5IFJlcGxpY2F0aW9uV29ya2Vy\nIHdpbGwgZ2V0IHRoZSBub3RpZmljYXRpb25zIGFuZCBhY3Qgb24gaXQuCiAq\nLwpwdWJsaWMgY2xhc3MgQm9va2llQXV0b1JlY292ZXJ5VGVzdCBleHRlbmRz\nCiAgICAgICAgTXVsdGlMZWRnZXJNYW5hZ2VyVGVzdENhc2UgewogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkK\nICAgICAgICAgICAgLmdldExvZ2dlcihCb29raWVBdXRvUmVjb3ZlcnlUZXN0\nLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGJ5dGVbXSBQQVNT\nV0QgPSAiYWRtaW4iLmdldEJ5dGVzKCk7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBieXRlW10gZGF0YSA9ICJURVNUREFUQSIuZ2V0Qnl0ZXMoKTsKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBvcGVuTGVkZ2VyUmVyZXBs\naWNhdGlvbkdyYWNlUGVyaW9kID0gIjMwMDAiOyAvLyBtaWxsaXNlY29uZHMK\nCiAgICBwcml2YXRlIERpZ2VzdFR5cGUgZGlnZXN0VHlwZTsKICAgIHByaXZh\ndGUgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbUZhY3Rvcnk7CiAgICBwcml2YXRl\nIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIHVuZGVyUmVwbGljYXRp\nb25NYW5hZ2VyOwogICAgcHJpdmF0ZSBMZWRnZXJNYW5hZ2VyIGxlZGdlck1h\nbmFnZXI7CgogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgVU5ERVJSRVBMSUNB\nVEVEX1BBVEggPSBiYXNlQ2xpZW50Q29uZgogICAgICAgICAgICAuZ2V0WmtM\nZWRnZXJzUm9vdFBhdGgoKSArICIvdW5kZXJyZXBsaWNhdGlvbi9sZWRnZXJz\nIjsKCiAgICBwdWJsaWMgQm9va2llQXV0b1JlY292ZXJ5VGVzdChTdHJpbmcg\nbGVkZ2VyTWFuYWdlckZhY3RvcnkpIHRocm93cyBJT0V4Y2VwdGlvbiwgS2Vl\ncGVyRXhjZXB0aW9uLAogICAgICAgICAgICBJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiwgVW5hdmFpbGFibGVFeGNlcHRpb24sIENvbXBhdGliaWxpdHlFeGNlcHRp\nb24gewogICAgICAgIHN1cGVyKDMpOwogICAgICAgIExPRy5pbmZvKCJSdW5u\naW5nIHRlc3QgY2FzZSB1c2luZyBsZWRnZXIgbWFuYWdlciA6ICIKICAgICAg\nICAgICAgICAgICsgbGVkZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgICAgIC8v\nIHNldCBsZWRnZXIgbWFuYWdlciBuYW1lCiAgICAgICAgYmFzZUNvbmYuc2V0\nTGVkZ2VyTWFuYWdlckZhY3RvcnlDbGFzc05hbWUobGVkZ2VyTWFuYWdlckZh\nY3RvcnkpOwogICAgICAgIGJhc2VDb25mLnNldE9wZW5MZWRnZXJSZXJlcGxp\nY2F0aW9uR3JhY2VQZXJpb2Qob3BlbkxlZGdlclJlcmVwbGljYXRpb25HcmFj\nZVBlcmlvZCk7CiAgICAgICAgYmFzZUNsaWVudENvbmYuc2V0TGVkZ2VyTWFu\nYWdlckZhY3RvcnlDbGFzc05hbWUobGVkZ2VyTWFuYWdlckZhY3RvcnkpOwog\nICAgICAgIHRoaXMuZGlnZXN0VHlwZSA9IERpZ2VzdFR5cGUuTUFDOwogICAg\nICAgIHNldEF1dG9SZWNvdmVyeUVuYWJsZWQodHJ1ZSk7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgYmFzZUNv\nbmYuc2V0WmtTZXJ2ZXJzKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3Ry\naW5nKCkpOwogICAgICAgIC8vIGluaXRpYWxpemUgdXJSZXBsaWNhdGlvbk1h\nbmFnZXIKICAgICAgICBtRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0b3J5\nLm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGJhc2VDbGllbnRDb25mLAogICAg\nICAgICAgICAgICAgemtjKTsKICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFu\nYWdlciA9IG1GYWN0b3J5Lm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5h\nZ2VyKCk7CiAgICAgICAgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbmV3TGVkZ2Vy\nTWFuYWdlckZhY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeQogICAgICAg\nICAgICAgICAgLm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGJhc2VDbGllbnRD\nb25mLCB6a2MpOwogICAgICAgIGxlZGdlck1hbmFnZXIgPSBuZXdMZWRnZXJN\nYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2VyKCk7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIHN1cGVyLnRlYXJEb3duKCk7CiAgICAgICAg\naWYgKG51bGwgIT0gbUZhY3RvcnkpIHsKICAgICAgICAgICAgbUZhY3Rvcnku\ndW5pbml0aWFsaXplKCk7CiAgICAgICAgICAgIG1GYWN0b3J5ID0gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgaWYgKG51bGwgIT0gdW5kZXJSZXBsaWNhdGlv\nbk1hbmFnZXIpIHsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIuY2xvc2UoKTsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAobnVsbCAhPSBsZWRn\nZXJNYW5hZ2VyKSB7CiAgICAgICAgICAgIGxlZGdlck1hbmFnZXIuY2xvc2Uo\nKTsKICAgICAgICAgICAgbGVkZ2VyTWFuYWdlciA9IG51bGw7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB2ZXJpZmllcyBwdWJsaXNo\nIHVyTGVkZ2VyIGJ5IEF1ZGl0b3IgYW5kIHJlcGxpY2F0aW9uIHdvcmtlciBp\ncwogICAgICogcGlja2luZyB1cCB0aGUgZW50cmllcyBhbmQgZmluaXNoaW5n\nIHRoZSByZXJlcGxpY2F0aW9uIG9mIG9wZW4gbGVkZ2VyCiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQgPSA5MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RP\ncGVuTGVkZ2VycygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExpc3Q8\nTGVkZ2VySGFuZGxlPiBsaXN0T2ZMZWRnZXJIYW5kbGUgPSBjcmVhdGVMZWRn\nZXJzQW5kQWRkRW50cmllcygxLCA1KTsKICAgICAgICBMZWRnZXJIYW5kbGUg\nbGggPSBsaXN0T2ZMZWRnZXJIYW5kbGUuZ2V0KDApOwogICAgICAgIGludCBs\nZWRnZXJSZXBsaWNhSW5kZXggPSAwOwogICAgICAgIEluZXRTb2NrZXRBZGRy\nZXNzIHJlcGxpY2FUb0tpbGxBZGRyID0gTGVkZ2VySGFuZGxlQWRhcHRlcgog\nICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxoKS5nZXRFbnNl\nbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKCiAgICAgICAgZmluYWwgU3RyaW5n\nIHVyTGVkZ2VyWk5vZGUgPSBnZXRVckxlZGdlclpOb2RlKGxoKTsKICAgICAg\nICBsZWRnZXJSZXBsaWNhSW5kZXggPSBnZXRSZXBsaWNhSW5kZXhJbkxlZGdl\ncihsaCwgcmVwbGljYVRvS2lsbEFkZHIpOwoKICAgICAgICBDb3VudERvd25M\nYXRjaCBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBh\nc3NlcnROdWxsKCJVckxlZGdlciBhbHJlYWR5IGV4aXN0cyEiLAogICAgICAg\nICAgICAgICAgd2F0Y2hVckxlZGdlck5vZGUodXJMZWRnZXJaTm9kZSwgbGF0\nY2gpKTsKCiAgICAgICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llIDoiICsg\ncmVwbGljYVRvS2lsbEFkZHIpOwogICAgICAgIGtpbGxCb29raWUocmVwbGlj\nYVRvS2lsbEFkZHIpOwoKICAgICAgICAvLyB3YWl0aW5nIHRvIHB1Ymxpc2gg\ndXJMZWRnZXIgem5vZGUgYnkgQXVkaXRvcgogICAgICAgIGxhdGNoLmF3YWl0\nKCk7CiAgICAgICAgbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAg\nICAgICAgTE9HLmluZm8oIldhdGNoaW5nIG9uIHVyTGVkZ2VyUGF0aDoiICsg\ndXJMZWRnZXJaTm9kZQogICAgICAgICAgICAgICAgKyAiIHRvIGtub3cgdGhl\nIHN0YXR1cyBvZiByZXJlcGxpY2F0aW9uIHByb2Nlc3MiKTsKICAgICAgICBh\nc3NlcnROb3ROdWxsKCJVckxlZGdlciBkb2Vzbid0IGV4aXN0cyEiLAogICAg\nICAgICAgICAgICAgd2F0Y2hVckxlZGdlck5vZGUodXJMZWRnZXJaTm9kZSwg\nbGF0Y2gpKTsKCiAgICAgICAgLy8gc3RhcnRpbmcgdGhlIHJlcGxpY2F0aW9u\nIHNlcnZpY2UsIHNvIHRoYXQgaGUgd2lsbCBiZSBhYmxlIHRvIGFjdCBhcwog\nICAgICAgIC8vIHRhcmdldCBib29raWUKICAgICAgICBzdGFydE5ld0Jvb2tp\nZSgpOwogICAgICAgIGludCBuZXdCb29raWVJbmRleCA9IGJzLnNpemUoKSAt\nIDE7CiAgICAgICAgQm9va2llU2VydmVyIG5ld0Jvb2tpZVNlcnZlciA9IGJz\nLmdldChuZXdCb29raWVJbmRleCk7CgogICAgICAgIExPRy5kZWJ1ZygiV2Fp\ndGluZyB0byBmaW5pc2ggdGhlIHJlcGxpY2F0aW9uIG9mIGZhaWxlZCBib29r\naWUgOiAiCiAgICAgICAgICAgICAgICArIHJlcGxpY2FUb0tpbGxBZGRyKTsK\nICAgICAgICBsYXRjaC5hd2FpdCgpOwoKICAgICAgICAvLyBncmFjZSBwZXJp\nb2QgdG8gdXBkYXRlIHRoZSB1cmxlZGdlciBtZXRhZGF0YSBpbiB6b29rZWVw\nZXIKICAgICAgICBMT0cuaW5mbygiV2FpdGluZyB0byB1cGRhdGUgdGhlIHVy\nbGVkZ2VyIG1ldGFkYXRhIGluIHpvb2tlZXBlciIpOwoKICAgICAgICB2ZXJp\nZnlMZWRnZXJFbnNlbWJsZU1ldGFkYXRhQWZ0ZXJSZXBsaWNhdGlvbihuZXdC\nb29raWVTZXJ2ZXIsCiAgICAgICAgICAgICAgICBsaXN0T2ZMZWRnZXJIYW5k\nbGUuZ2V0KDApLCBsZWRnZXJSZXBsaWNhSW5kZXgpOwogICAgfQoKICAgIC8q\nKgogICAgICogVGVzdCB2ZXJpZmllcyBwdWJsaXNoIHVyTGVkZ2VyIGJ5IEF1\nZGl0b3IgYW5kIHJlcGxpY2F0aW9uIHdvcmtlciBpcwogICAgICogcGlja2lu\nZyB1cCB0aGUgZW50cmllcyBhbmQgZmluaXNoaW5nIHRoZSByZXJlcGxpY2F0\naW9uIG9mIGNsb3NlZCBsZWRnZXJzCiAgICAgKi8KICAgIEBUZXN0KHRpbWVv\ndXQgPSA5MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDbG9zZWRMZWRnZXJz\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxJbnRlZ2VyPiBs\naXN0T2ZSZXBsaWNhSW5kZXggPSBuZXcgQXJyYXlMaXN0PEludGVnZXI+KCk7\nCiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxpc3RPZkxlZGdlckhhbmRs\nZSA9IGNyZWF0ZUxlZGdlcnNBbmRBZGRFbnRyaWVzKDEsIDUpOwogICAgICAg\nIGNsb3NlTGVkZ2VycyhsaXN0T2ZMZWRnZXJIYW5kbGUpOwogICAgICAgIExl\nZGdlckhhbmRsZSBsaGFuZGxlID0gbGlzdE9mTGVkZ2VySGFuZGxlLmdldCgw\nKTsKICAgICAgICBpbnQgbGVkZ2VyUmVwbGljYUluZGV4ID0gMDsKICAgICAg\nICBJbmV0U29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsQWRkciA9IExlZGdl\nckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRh\nZGF0YShsaGFuZGxlKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsK\nCiAgICAgICAgQ291bnREb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3du\nTGF0Y2gobGlzdE9mTGVkZ2VySGFuZGxlLnNpemUoKSk7CiAgICAgICAgZm9y\nIChMZWRnZXJIYW5kbGUgbGggOiBsaXN0T2ZMZWRnZXJIYW5kbGUpIHsKICAg\nICAgICAgICAgbGVkZ2VyUmVwbGljYUluZGV4ID0gZ2V0UmVwbGljYUluZGV4\nSW5MZWRnZXIobGgsIHJlcGxpY2FUb0tpbGxBZGRyKTsKICAgICAgICAgICAg\nbGlzdE9mUmVwbGljYUluZGV4LmFkZChsZWRnZXJSZXBsaWNhSW5kZXgpOwog\nICAgICAgICAgICBhc3NlcnROdWxsKCJVckxlZGdlciBhbHJlYWR5IGV4aXN0\ncyEiLAogICAgICAgICAgICAgICAgICAgIHdhdGNoVXJMZWRnZXJOb2RlKGdl\ndFVyTGVkZ2VyWk5vZGUobGgpLCBsYXRjaCkpOwogICAgICAgIH0KCiAgICAg\nICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llIDoiICsgcmVwbGljYVRvS2ls\nbEFkZHIpOwogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbEFkZHIp\nOwoKICAgICAgICAvLyB3YWl0aW5nIHRvIHB1Ymxpc2ggdXJMZWRnZXIgem5v\nZGUgYnkgQXVkaXRvcgogICAgICAgIGxhdGNoLmF3YWl0KCk7CgogICAgICAg\nIC8vIEFnYWluIHdhdGNoaW5nIHRoZSB1ckxlZGdlciB6bm9kZSB0byBrbm93\nIHRoZSByZXBsaWNhdGlvbiBzdGF0dXMKICAgICAgICBsYXRjaCA9IG5ldyBD\nb3VudERvd25MYXRjaChsaXN0T2ZMZWRnZXJIYW5kbGUuc2l6ZSgpKTsKICAg\nICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6IGxpc3RPZkxlZGdlckhhbmRs\nZSkgewogICAgICAgICAgICBTdHJpbmcgdXJMZWRnZXJaTm9kZSA9IGdldFVy\nTGVkZ2VyWk5vZGUobGgpOwogICAgICAgICAgICBMT0cuaW5mbygiV2F0Y2hp\nbmcgb24gdXJMZWRnZXJQYXRoOiIgKyB1ckxlZGdlclpOb2RlCiAgICAgICAg\nICAgICAgICAgICAgKyAiIHRvIGtub3cgdGhlIHN0YXR1cyBvZiByZXJlcGxp\nY2F0aW9uIHByb2Nlc3MiKTsKICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbCgi\nVXJMZWRnZXIgZG9lc24ndCBleGlzdHMhIiwKICAgICAgICAgICAgICAgICAg\nICB3YXRjaFVyTGVkZ2VyTm9kZSh1ckxlZGdlclpOb2RlLCBsYXRjaCkpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gc3RhcnRpbmcgdGhlIHJlcGxpY2F0aW9u\nIHNlcnZpY2UsIHNvIHRoYXQgaGUgd2lsbCBiZSBhYmxlIHRvIGFjdCBhcwog\nICAgICAgIC8vIHRhcmdldCBib29raWUKICAgICAgICBzdGFydE5ld0Jvb2tp\nZSgpOwogICAgICAgIGludCBuZXdCb29raWVJbmRleCA9IGJzLnNpemUoKSAt\nIDE7CiAgICAgICAgQm9va2llU2VydmVyIG5ld0Jvb2tpZVNlcnZlciA9IGJz\nLmdldChuZXdCb29raWVJbmRleCk7CgogICAgICAgIExPRy5kZWJ1ZygiV2Fp\ndGluZyB0byBmaW5pc2ggdGhlIHJlcGxpY2F0aW9uIG9mIGZhaWxlZCBib29r\naWUgOiAiCiAgICAgICAgICAgICAgICArIHJlcGxpY2FUb0tpbGxBZGRyKTsK\nCiAgICAgICAgLy8gd2FpdGluZyB0byBmaW5pc2ggcmVwbGljYXRpb24KICAg\nICAgICBsYXRjaC5hd2FpdCgpOwoKICAgICAgICAvLyBncmFjZSBwZXJpb2Qg\ndG8gdXBkYXRlIHRoZSB1cmxlZGdlciBtZXRhZGF0YSBpbiB6b29rZWVwZXIK\nICAgICAgICBMT0cuaW5mbygiV2FpdGluZyB0byB1cGRhdGUgdGhlIHVybGVk\nZ2VyIG1ldGFkYXRhIGluIHpvb2tlZXBlciIpOwoKICAgICAgICBmb3IgKGlu\ndCBpbmRleCA9IDA7IGluZGV4IDwgbGlzdE9mTGVkZ2VySGFuZGxlLnNpemUo\nKTsgaW5kZXgrKykgewogICAgICAgICAgICB2ZXJpZnlMZWRnZXJFbnNlbWJs\nZU1ldGFkYXRhQWZ0ZXJSZXBsaWNhdGlvbihuZXdCb29raWVTZXJ2ZXIsCiAg\nICAgICAgICAgICAgICAgICAgbGlzdE9mTGVkZ2VySGFuZGxlLmdldChpbmRl\neCksCiAgICAgICAgICAgICAgICAgICAgbGlzdE9mUmVwbGljYUluZGV4Lmdl\ndChpbmRleCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRl\nc3Qgc3RvcHBpbmcgcmVwbGljYSBzZXJ2aWNlIHdoaWxlIHJlcGxpY2F0aW9u\nIGluIHByb2dyZXNzLiBDb25zaWRlcmluZwogICAgICogd2hlbiB0aGVyZSBp\ncyBhbiBleGNlcHRpb24gd2lsbCBzaHV0ZG93biBBdWRpdG9yIGFuZCBSVyBw\ncm9jZXNzZXMuIEFmdGVyCiAgICAgKiByZXN0YXJ0aW5nIHNob3VsZCBiZSBh\nYmxlIHRvIGZpbmlzaCB0aGUgcmUtcmVwbGljYXRpb24gYWN0aXZpdGllcwog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gOTAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0U3RvcFdoaWxlUmVwbGljYXRpb25JblByb2dyZXNzKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaW50IG51bWJlck9mTGVkZ2VycyA9\nIDI7CiAgICAgICAgTGlzdDxJbnRlZ2VyPiBsaXN0T2ZSZXBsaWNhSW5kZXgg\nPSBuZXcgQXJyYXlMaXN0PEludGVnZXI+KCk7CiAgICAgICAgTGlzdDxMZWRn\nZXJIYW5kbGU+IGxpc3RPZkxlZGdlckhhbmRsZSA9IGNyZWF0ZUxlZGdlcnNB\nbmRBZGRFbnRyaWVzKAogICAgICAgICAgICAgICAgbnVtYmVyT2ZMZWRnZXJz\nLCA1KTsKICAgICAgICBjbG9zZUxlZGdlcnMobGlzdE9mTGVkZ2VySGFuZGxl\nKTsKICAgICAgICBMZWRnZXJIYW5kbGUgaGFuZGxlID0gbGlzdE9mTGVkZ2Vy\nSGFuZGxlLmdldCgwKTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyByZXBs\naWNhVG9LaWxsQWRkciA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAg\nICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShoYW5kbGUpLmdldEVuc2VtYmxl\ncygpLmdldCgwTCkuZ2V0KDApOwogICAgICAgIExPRy5pbmZvKCJLaWxsaW5n\nIEJvb2tpZToiICsgcmVwbGljYVRvS2lsbEFkZHIpOwoKICAgICAgICAvLyBF\nYWNoIGxlZGdlciwgdGhlcmUgd2lsbCBiZSB0d28gZXZlbnRzIDogY3JlYXRl\nIHVyTGVkZ2VyIGFuZCBhZnRlcgogICAgICAgIC8vIHJlcmVwbGljYXRpb24g\nZGVsZXRlIHVyTGVkZ2VyCiAgICAgICAgQ291bnREb3duTGF0Y2ggbGF0Y2gg\nPSBuZXcgQ291bnREb3duTGF0Y2gobGlzdE9mTGVkZ2VySGFuZGxlLnNpemUo\nKSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBsaXN0T2ZMZWRnZXJI\nYW5kbGUuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgZmluYWwgU3RyaW5n\nIHVyTGVkZ2VyWk5vZGUgPSBnZXRVckxlZGdlclpOb2RlKGxpc3RPZkxlZGdl\nckhhbmRsZQogICAgICAgICAgICAgICAgICAgIC5nZXQoaSkpOwogICAgICAg\nICAgICBhc3NlcnROdWxsKCJVckxlZGdlciBhbHJlYWR5IGV4aXN0cyEiLAog\nICAgICAgICAgICAgICAgICAgIHdhdGNoVXJMZWRnZXJOb2RlKHVyTGVkZ2Vy\nWk5vZGUsIGxhdGNoKSk7CiAgICAgICAgICAgIGludCByZXBsaWNhSW5kZXhJ\nbkxlZGdlciA9IGdldFJlcGxpY2FJbmRleEluTGVkZ2VyKAogICAgICAgICAg\nICAgICAgICAgIGxpc3RPZkxlZGdlckhhbmRsZS5nZXQoaSksIHJlcGxpY2FU\nb0tpbGxBZGRyKTsKICAgICAgICAgICAgbGlzdE9mUmVwbGljYUluZGV4LmFk\nZChyZXBsaWNhSW5kZXhJbkxlZGdlcik7CiAgICAgICAgfQoKICAgICAgICBM\nT0cuaW5mbygiS2lsbGluZyBCb29raWUgOiIgKyByZXBsaWNhVG9LaWxsQWRk\ncik7CiAgICAgICAga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsQWRkcik7Cgog\nICAgICAgIC8vIHdhaXRpbmcgdG8gcHVibGlzaCB1ckxlZGdlciB6bm9kZSBi\neSBBdWRpdG9yCiAgICAgICAgbGF0Y2guYXdhaXQoKTsKCiAgICAgICAgLy8g\nQWdhaW4gd2F0Y2hpbmcgdGhlIHVyTGVkZ2VyIHpub2RlIHRvIGtub3cgdGhl\nIHJlcGxpY2F0aW9uIHN0YXR1cwogICAgICAgIGxhdGNoID0gbmV3IENvdW50\nRG93bkxhdGNoKGxpc3RPZkxlZGdlckhhbmRsZS5zaXplKCkpOwogICAgICAg\nIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGlzdE9mTGVkZ2VySGFuZGxlKSB7\nCiAgICAgICAgICAgIFN0cmluZyB1ckxlZGdlclpOb2RlID0gZ2V0VXJMZWRn\nZXJaTm9kZShsaCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJXYXRjaGluZyBv\nbiB1ckxlZGdlclBhdGg6IiArIHVyTGVkZ2VyWk5vZGUKICAgICAgICAgICAg\nICAgICAgICArICIgdG8ga25vdyB0aGUgc3RhdHVzIG9mIHJlcmVwbGljYXRp\nb24gcHJvY2VzcyIpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKCJVckxl\nZGdlciBkb2Vzbid0IGV4aXN0cyEiLAogICAgICAgICAgICAgICAgICAgIHdh\ndGNoVXJMZWRnZXJOb2RlKHVyTGVkZ2VyWk5vZGUsIGxhdGNoKSk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBzdGFydGluZyB0aGUgcmVwbGljYXRpb24gc2Vy\ndmljZSwgc28gdGhhdCBoZSB3aWxsIGJlIGFibGUgdG8gYWN0IGFzCiAgICAg\nICAgLy8gdGFyZ2V0IGJvb2tpZQogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7\nCiAgICAgICAgaW50IG5ld0Jvb2tpZUluZGV4ID0gYnMuc2l6ZSgpIC0gMTsK\nICAgICAgICBCb29raWVTZXJ2ZXIgbmV3Qm9va2llU2VydmVyID0gYnMuZ2V0\nKG5ld0Jvb2tpZUluZGV4KTsKCiAgICAgICAgTE9HLmRlYnVnKCJXYWl0aW5n\nIHRvIGZpbmlzaCB0aGUgcmVwbGljYXRpb24gb2YgZmFpbGVkIGJvb2tpZSA6\nICIKICAgICAgICAgICAgICAgICsgcmVwbGljYVRvS2lsbEFkZHIpOwogICAg\nICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGlmIChsYXRjaC5nZXRD\nb3VudCgpIDwgbnVtYmVyT2ZMZWRnZXJzIHx8IGxhdGNoLmdldENvdW50KCkg\nPD0gMCkgewogICAgICAgICAgICAgICAgc3RvcFJlcGxpY2F0aW9uU2Vydmlj\nZSgpOwogICAgICAgICAgICAgICAgTE9HLmluZm8oIkxhdGNoIENvdW50IGlz\nOiIgKyBsYXRjaC5nZXRDb3VudCgpKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGdyYWNlIHBlcmlvZCB0\nbyB0YWtlIGJyZWF0aAogICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7\nCiAgICAgICAgfQoKICAgICAgICBzdGFydFJlcGxpY2F0aW9uU2VydmljZSgp\nOwoKICAgICAgICBMT0cuaW5mbygiV2FpdGluZyB0byBmaW5pc2ggcmVyZXBs\naWNhdGlvbiBwcm9jZXNzZXMiKTsKICAgICAgICBsYXRjaC5hd2FpdCgpOwoK\nICAgICAgICAvLyBncmFjZSBwZXJpb2QgdG8gdXBkYXRlIHRoZSB1cmxlZGdl\nciBtZXRhZGF0YSBpbiB6b29rZWVwZXIKICAgICAgICBMT0cuaW5mbygiV2Fp\ndGluZyB0byB1cGRhdGUgdGhlIHVybGVkZ2VyIG1ldGFkYXRhIGluIHpvb2tl\nZXBlciIpOwoKICAgICAgICBmb3IgKGludCBpbmRleCA9IDA7IGluZGV4IDwg\nbGlzdE9mTGVkZ2VySGFuZGxlLnNpemUoKTsgaW5kZXgrKykgewogICAgICAg\nICAgICB2ZXJpZnlMZWRnZXJFbnNlbWJsZU1ldGFkYXRhQWZ0ZXJSZXBsaWNh\ndGlvbihuZXdCb29raWVTZXJ2ZXIsCiAgICAgICAgICAgICAgICAgICAgbGlz\ndE9mTGVkZ2VySGFuZGxlLmdldChpbmRleCksCiAgICAgICAgICAgICAgICAg\nICAgbGlzdE9mUmVwbGljYUluZGV4LmdldChpbmRleCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFZlcmlmeSB0aGUgcHVibGlzaGVkIHVy\nbGVkZ2VycyBvZiBkZWxldGVkIGxlZGdlcnModGhvc2UgbGVkZ2VycyB3aGVy\nZQogICAgICogZGVsZXRlZCBhZnRlciBwdWJsaXNoaW5nIGFzIHVybGVkZ2Vy\ncyBieSBBdWRpdG9yKSBzaG91bGQgYmUgY2xlYXJlZCBvZmYKICAgICAqIGJ5\nIHRoZSBuZXdseSBzZWxlY3RlZCByZXBsaWNhIGJvb2tpZQogICAgICovCiAg\nICBAVGVzdCh0aW1lb3V0ID0gMzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nTm9TdWNoTGVkZ2VyRXhpc3RzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxpc3RPZkxlZGdlckhhbmRsZSA9IGNy\nZWF0ZUxlZGdlcnNBbmRBZGRFbnRyaWVzKDIsIDUpOwogICAgICAgIENvdW50\nRG93bkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKGxpc3RPZkxl\nZGdlckhhbmRsZS5zaXplKCkpOwogICAgICAgIGZvciAoTGVkZ2VySGFuZGxl\nIGxoIDogbGlzdE9mTGVkZ2VySGFuZGxlKSB7CiAgICAgICAgICAgIGFzc2Vy\ndE51bGwoIlVyTGVkZ2VyIGFscmVhZHkgZXhpc3RzISIsCiAgICAgICAgICAg\nICAgICAgICAgd2F0Y2hVckxlZGdlck5vZGUoZ2V0VXJMZWRnZXJaTm9kZShs\naCksIGxhdGNoKSk7CiAgICAgICAgfQogICAgICAgIEluZXRTb2NrZXRBZGRy\nZXNzIHJlcGxpY2FUb0tpbGxBZGRyID0gTGVkZ2VySGFuZGxlQWRhcHRlcgog\nICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxpc3RPZkxlZGdl\nckhhbmRsZS5nZXQoMCkpLmdldEVuc2VtYmxlcygpCiAgICAgICAgICAgICAg\nICAuZ2V0KDBMKS5nZXQoMCk7CiAgICAgICAga2lsbEJvb2tpZShyZXBsaWNh\nVG9LaWxsQWRkcik7CiAgICAgICAgcmVwbGljYVRvS2lsbEFkZHIgPSBMZWRn\nZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0\nYWRhdGEobGlzdE9mTGVkZ2VySGFuZGxlLmdldCgwKSkuZ2V0RW5zZW1ibGVz\nKCkKICAgICAgICAgICAgICAgIC5nZXQoMEwpLmdldCgwKTsKICAgICAgICBr\naWxsQm9va2llKHJlcGxpY2FUb0tpbGxBZGRyKTsKICAgICAgICAvLyB3YWl0\naW5nIHRvIHB1Ymxpc2ggdXJMZWRnZXIgem5vZGUgYnkgQXVkaXRvcgogICAg\nICAgIGxhdGNoLmF3YWl0KCk7CgogICAgICAgIGxhdGNoID0gbmV3IENvdW50\nRG93bkxhdGNoKGxpc3RPZkxlZGdlckhhbmRsZS5zaXplKCkpOwogICAgICAg\nIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGlzdE9mTGVkZ2VySGFuZGxlKSB7\nCiAgICAgICAgICAgIGFzc2VydE5vdE51bGwoIlVyTGVkZ2VyIGRvZXNuJ3Qg\nZXhpc3RzISIsCiAgICAgICAgICAgICAgICAgICAgd2F0Y2hVckxlZGdlck5v\nZGUoZ2V0VXJMZWRnZXJaTm9kZShsaCksIGxhdGNoKSk7CiAgICAgICAgfQoK\nICAgICAgICAvLyBkZWxldGUgbGVkZ2VycwogICAgICAgIGZvciAoTGVkZ2Vy\nSGFuZGxlIGxoIDogbGlzdE9mTGVkZ2VySGFuZGxlKSB7CiAgICAgICAgICAg\nIGJrYy5kZWxldGVMZWRnZXIobGguZ2V0SWQoKSk7CiAgICAgICAgfQogICAg\nICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAgIC8vIHdhaXRpbmcgdG8g\nZGVsZXRlIHB1Ymxpc2hlZCB1cmxlZGdlcnMsIHNpbmNlIGl0IGRvZXNuJ3Qg\nZXhpc3RzCiAgICAgICAgbGF0Y2guYXdhaXQoKTsKCiAgICAgICAgZm9yIChM\nZWRnZXJIYW5kbGUgbGggOiBsaXN0T2ZMZWRnZXJIYW5kbGUpIHsKICAgICAg\nICAgICAgYXNzZXJ0TnVsbCgiVXJMZWRnZXIgc3RpbGwgZXhpc3RzIGFmdGVy\nIHJlcmVwbGljYXRpb24iLAogICAgICAgICAgICAgICAgICAgIHdhdGNoVXJM\nZWRnZXJOb2RlKGdldFVyTGVkZ2VyWk5vZGUobGgpLCBsYXRjaCkpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGludCBnZXRSZXBsaWNhSW5kZXhJ\nbkxlZGdlcihMZWRnZXJIYW5kbGUgbGgsCiAgICAgICAgICAgIEluZXRTb2Nr\nZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwpIHsKICAgICAgICBTb3J0ZWRNYXA8\nTG9uZywgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPj4gZW5zZW1ibGVz\nID0gTGVkZ2VySGFuZGxlQWRhcHRlcgogICAgICAgICAgICAgICAgLmdldExl\nZGdlck1ldGFkYXRhKGxoKS5nZXRFbnNlbWJsZXMoKTsKICAgICAgICBpbnQg\nbGVkZ2VyUmVwbGljYUluZGV4ID0gLTE7CiAgICAgICAgZm9yIChJbmV0U29j\na2V0QWRkcmVzcyBhZGRyIDogZW5zZW1ibGVzLmdldCgwTCkpIHsKICAgICAg\nICAgICAgKytsZWRnZXJSZXBsaWNhSW5kZXg7CiAgICAgICAgICAgIGlmIChh\nZGRyLmVxdWFscyhyZXBsaWNhVG9LaWxsKSkgewogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGxlZGdlclJlcGxpY2FJbmRleDsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQg\ndmVyaWZ5TGVkZ2VyRW5zZW1ibGVNZXRhZGF0YUFmdGVyUmVwbGljYXRpb24o\nCiAgICAgICAgICAgIEJvb2tpZVNlcnZlciBuZXdCb29raWVTZXJ2ZXIsIExl\nZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgaW50IGxlZGdlclJlcGxpY2FJ\nbmRleCkgdGhyb3dzIEJLRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiB7CiAgICAgICAgTGVkZ2VySGFuZGxlIG9wZW5MZWRnZXIgPSBia2MKICAg\nICAgICAgICAgICAgIC5vcGVuTGVkZ2VyKGxoLmdldElkKCksIGRpZ2VzdFR5\ncGUsIFBBU1NXRCk7CgogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGluZXRT\nb2NrZXRBZGRyZXNzID0gTGVkZ2VySGFuZGxlQWRhcHRlcgogICAgICAgICAg\nICAgICAgLmdldExlZGdlck1ldGFkYXRhKG9wZW5MZWRnZXIpLmdldEVuc2Vt\nYmxlcygpLmdldCgwTCkKICAgICAgICAgICAgICAgIC5nZXQobGVkZ2VyUmVw\nbGljYUluZGV4KTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlJlcmVwbGljYXRp\nb24gaGFzIGJlZW4gZmFpbGVkIGFuZCBsZWRnZXJSZXBsaWNhSW5kZXggOiIK\nICAgICAgICAgICAgICAgICsgbGVkZ2VyUmVwbGljYUluZGV4LCBuZXdCb29r\naWVTZXJ2ZXIuZ2V0TG9jYWxBZGRyZXNzKCksCiAgICAgICAgICAgICAgICBp\nbmV0U29ja2V0QWRkcmVzcyk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNs\nb3NlTGVkZ2VycyhMaXN0PExlZGdlckhhbmRsZT4gbGlzdE9mTGVkZ2VySGFu\nZGxlKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24s\nIEJLRXhjZXB0aW9uIHsKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6\nIGxpc3RPZkxlZGdlckhhbmRsZSkgewogICAgICAgICAgICBsaC5jbG9zZSgp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIExpc3Q8TGVkZ2VySGFu\nZGxlPiBjcmVhdGVMZWRnZXJzQW5kQWRkRW50cmllcyhpbnQgbnVtYmVyT2ZM\nZWRnZXJzLAogICAgICAgICAgICBpbnQgbnVtYmVyT2ZFbnRyaWVzKSB0aHJv\nd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAg\nICBMaXN0PExlZGdlckhhbmRsZT4gbGlzdE9mTGVkZ2VySGFuZGxlID0gbmV3\nIEFycmF5TGlzdDxMZWRnZXJIYW5kbGU+KAogICAgICAgICAgICAgICAgbnVt\nYmVyT2ZMZWRnZXJzKTsKICAgICAgICBmb3IgKGludCBpbmRleCA9IDA7IGlu\nZGV4IDwgbnVtYmVyT2ZMZWRnZXJzOyBpbmRleCsrKSB7CiAgICAgICAgICAg\nIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoMywgMywgZGln\nZXN0VHlwZSwgUEFTU1dEKTsKICAgICAgICAgICAgbGlzdE9mTGVkZ2VySGFu\nZGxlLmFkZChsaCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbnVtYmVyT2ZFbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxoLmFk\nZEVudHJ5KGRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBsaXN0T2ZMZWRnZXJIYW5kbGU7CiAgICB9CgogICAgcHJpdmF0\nZSBTdHJpbmcgZ2V0VXJMZWRnZXJaTm9kZShMZWRnZXJIYW5kbGUgbGgpIHsK\nICAgICAgICByZXR1cm4gWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdl\nci5nZXRVckxlZGdlclpub2RlKAogICAgICAgICAgICAgICAgVU5ERVJSRVBM\nSUNBVEVEX1BBVEgsIGxoLmdldElkKCkpOwogICAgfQoKICAgIHByaXZhdGUg\nU3RhdCB3YXRjaFVyTGVkZ2VyTm9kZShmaW5hbCBTdHJpbmcgem5vZGUsCiAg\nICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNoKSB0aHJvd3Mg\nS2VlcGVyRXhjZXB0aW9uLAogICAgICAgICAgICBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIHprYy5leGlzdHMoem5vZGUsIG5ldyBX\nYXRjaGVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAg\nICAgICAgICAgICAgIGlmIChldmVudC5nZXRUeXBlKCkgPT0gRXZlbnRUeXBl\nLk5vZGVEZWxldGVkKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8o\nIlJlY2lldmVkIExlZGdlciByZXJlcGxpY2F0aW9uIGNvbXBsZXRpb24gZXZl\nbnQgOiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgZXZlbnQuZ2V0\nVHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERvd24o\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChldmVu\ndC5nZXRUeXBlKCkgPT0gRXZlbnRUeXBlLk5vZGVDcmVhdGVkKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmluZm8oIlJlY2lldmVkIHVyTGVkZ2VyIHB1\nYmxpc2hpbmcgZXZlbnQgOiIKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgZXZlbnQuZ2V0VHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICBsYXRj\naC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0pOwogICAgfQp9Cg==\n","encoding":"base64"}

