{"sha":"df552ad024e1c8d9c7f2477c95b680fe83729ea2","node_id":"MDQ6QmxvYjE1NzU5NTY6ZGY1NTJhZDAyNGUxYzhkOWM3ZjI0NzdjOTViNjgwZmU4MzcyOWVhMg==","size":28965,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/df552ad024e1c8d9c7f2477c95b680fe83729ea2","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRp\nb247CgppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1\nYWxzOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RmFs\nc2U7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRUcnVl\nOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuZmFpbDsKCmltcG9y\ndCBqYXZhLm5pby5jaGFyc2V0LkNoYXJzZXQ7CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRv\ncjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNl\ndDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNhbGxhYmxlOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvclNlcnZpY2U7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5GdXR1cmU7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLlRpbWVvdXRFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5hdG9taWMuQXRvbWljQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdl\nclVuZGVycmVwbGljYXRpb25NYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLm1ldGEuWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5VbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQ7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNl\ncHRpb24uQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2VwdGlv\nbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci50ZXN0Llpvb0tlZXBlclV0aWw7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuWmtVdGlsczsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci56b29rZWVwZXIuWm9vS2VlcGVyV2F0Y2hl\nckJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdV\ndGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVu\ndDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyLkV2ZW50LkV2ZW50VHlwZTsKaW1w\nb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7\nCmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBj\nb20uZ29vZ2xlLnByb3RvYnVmLlRleHRGb3JtYXQ7CgovKioKICogVGVzdCB0\naGUgem9va2VlcGVyIGltcGxlbWVudGF0aW9uIG9mIHRoZSBsZWRnZXIgcmVw\nbGljYXRpb24gbWFuYWdlcgogKi8KcHVibGljIGNsYXNzIFRlc3RMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB7CiAgICBzdGF0aWMgZmluYWwgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlc3RMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlci5jbGFzcyk7CgogICAgWm9vS2VlcGVy\nVXRpbCB6a1V0aWwgPSBudWxsOwoKICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IG51bGw7CiAgICBFeGVjdXRvclNlcnZpY2UgZXhlY3V0b3IgPSBu\ndWxsOwogICAgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbG1mMSA9IG51bGw7CiAg\nICBMZWRnZXJNYW5hZ2VyRmFjdG9yeSBsbWYyID0gbnVsbDsKICAgIFpvb0tl\nZXBlciB6a2MxID0gbnVsbDsKICAgIFpvb0tlZXBlciB6a2MyID0gbnVsbDsK\nCiAgICBTdHJpbmcgYmFzZVBhdGg7CiAgICBTdHJpbmcgdXJMZWRnZXJQYXRo\nOwogICAgYm9vbGVhbiBpc0xlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQgPSB0\ncnVlOwoKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldHVwWm9vS2Vl\ncGVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgemtVdGlsID0gbmV3\nIFpvb0tlZXBlclV0aWwoKTsKICAgICAgICB6a1V0aWwuc3RhcnRTZXJ2ZXIo\nKTsKCiAgICAgICAgY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCku\nc2V0WmtTZXJ2ZXJzKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5n\nKCkpOwoKICAgICAgICBleGVjdXRvciA9IEV4ZWN1dG9ycy5uZXdDYWNoZWRU\naHJlYWRQb29sKCk7CgogICAgICAgIFpvb0tlZXBlcldhdGNoZXJCYXNlIHcg\nPSBuZXcgWm9vS2VlcGVyV2F0Y2hlckJhc2UoMTAwMDApOwogICAgICAgIHpr\nYzEgPSBaa1V0aWxzLmNyZWF0ZUNvbm5lY3RlZFpvb2tlZXBlckNsaWVudCgK\nICAgICAgICAgICAgICAgIHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3Ry\naW5nKCksIHcpOwogICAgICAgIHcgPSBuZXcgWm9vS2VlcGVyV2F0Y2hlckJh\nc2UoMTAwMDApOwogICAgICAgIHprYzIgPSBaa1V0aWxzLmNyZWF0ZUNvbm5l\nY3RlZFpvb2tlZXBlckNsaWVudCgKICAgICAgICAgICAgICAgIHprVXRpbC5n\nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHcpOwogICAgICAgIGxtZjEg\nPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9y\neShjb25mLCB6a2MxKTsKICAgICAgICBsbWYyID0gTGVkZ2VyTWFuYWdlckZh\nY3RvcnkubmV3TGVkZ2VyTWFuYWdlckZhY3RvcnkoY29uZiwgemtjMik7CiAg\nICAgICAgYmFzZVBhdGggPSBjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkg\nKyAnLycKICAgICAgICAgICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5V\nTkRFUl9SRVBMSUNBVElPTl9OT0RFOwogICAgICAgIHVyTGVkZ2VyUGF0aCA9\nIGJhc2VQYXRoCiAgICAgICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFu\ndHMuREVGQVVMVF9aS19MRURHRVJTX1JPT1RfUEFUSDsKICAgIH0KCiAgICBA\nQWZ0ZXIKICAgIHB1YmxpYyB2b2lkIHRlYXJkb3duWm9vS2VlcGVyKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHprVXRpbCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIHprVXRpbC5raWxsU2VydmVyKCk7CiAgICAgICAgICAg\nIHprVXRpbCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmIChleGVjdXRv\nciAhPSBudWxsKSB7CiAgICAgICAgICAgIGV4ZWN1dG9yID0gbnVsbDsKICAg\nICAgICB9CiAgICAgICAgaWYgKHprYzEgIT0gbnVsbCkgewogICAgICAgICAg\nICB6a2MxLmNsb3NlKCk7CiAgICAgICAgICAgIHprYzEgPSBudWxsOwogICAg\nICAgIH0KICAgICAgICBpZiAoemtjMiAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHprYzIuY2xvc2UoKTsKICAgICAgICAgICAgemtjMiA9IG51bGw7CiAgICAg\nICAgfQogICAgICAgIGlmIChsbWYxICE9IG51bGwpIHsKICAgICAgICAgICAg\nbG1mMS51bmluaXRpYWxpemUoKTsKICAgICAgICAgICAgbG1mMSA9IG51bGw7\nCiAgICAgICAgfQogICAgICAgIGlmIChsbWYyICE9IG51bGwpIHsKICAgICAg\nICAgICAgbG1mMi51bmluaXRpYWxpemUoKTsKICAgICAgICAgICAgbG1mMiA9\nIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgRnV0dXJlPExv\nbmc+IGdldExlZGdlclRvUmVwbGljYXRlKGZpbmFsIExlZGdlclVuZGVycmVw\nbGljYXRpb25NYW5hZ2VyIG0pIHsKICAgICAgICByZXR1cm4gZXhlY3V0b3Iu\nc3VibWl0KG5ldyBDYWxsYWJsZTxMb25nPigpIHsKICAgICAgICAgICAgICAg\nIHB1YmxpYyBMb25nIGNhbGwoKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG0uZ2V0TGVkZ2Vy\nVG9SZXJlcGxpY2F0ZSgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiRXJyb3IgZ2V0dGluZyBsZWRnZXIgaWQiLCBlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIC0xTDsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdCBiYXNpYyBpbnRlcmFjdGlvbnMgd2l0aCB0\naGUgbGVkZ2VyIHVuZGVycmVwbGljYXRpb24KICAgICAqIG1hbmFnZXIuCiAg\nICAgKiBNYXJrIHNvbWUgbGVkZ2VycyBhcyB1bmRlcnJlcGxpY2F0ZWQuCiAg\nICAgKiBFbnN1cmUgdGhhdCBnZXRMZWRnZXJUb1JlcGxpY2F0ZSB3aWxsIGJs\nb2NrIHVudGlsIGl0IGEgbGVkZ2VyCiAgICAgKiBiZWNvbWVzIGF2YWlsYWJs\nZS4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RCYXNpY0ludGVyYWN0aW9uKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgU2V0PExvbmc+IGxlZGdlcnMgPSBuZXcgSGFzaFNldDxM\nb25nPigpOwogICAgICAgIGxlZGdlcnMuYWRkKDB4ZGVhZGJlZWZMKTsKICAg\nICAgICBsZWRnZXJzLmFkZCgweGJlZWZjYWZlTCk7CiAgICAgICAgbGVkZ2Vy\ncy5hZGQoMHhmZmZmYmVlZkwpOwogICAgICAgIGxlZGdlcnMuYWRkKDB4ZmFj\nZWJlZWZMKTsKICAgICAgICBTdHJpbmcgbWlzc2luZ1JlcGxpY2EgPSAibG9j\nYWxob3N0OjMxODEiOwoKICAgICAgICBpbnQgY291bnQgPSAwOwogICAgICAg\nIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIG0gPSBsbWYxLm5ld0xl\nZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7CiAgICAgICAgSXRlcmF0\nb3I8TG9uZz4gaXRlciA9IGxlZGdlcnMuaXRlcmF0b3IoKTsKICAgICAgICB3\naGlsZSAoaXRlci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgbS5tYXJrTGVk\nZ2VyVW5kZXJyZXBsaWNhdGVkKGl0ZXIubmV4dCgpLCBtaXNzaW5nUmVwbGlj\nYSk7CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgfQoKICAgICAgICBM\naXN0PEZ1dHVyZTxMb25nPj4gZnV0dXJlcyA9IG5ldyBBcnJheUxpc3Q8RnV0\ndXJlPExvbmc+PigpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY291\nbnQ7IGkrKykgewogICAgICAgICAgICBmdXR1cmVzLmFkZChnZXRMZWRnZXJU\nb1JlcGxpY2F0ZShtKSk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKEZ1dHVy\nZTxMb25nPiBmIDogZnV0dXJlcykgewogICAgICAgICAgICBMb25nIGwgPSBm\nLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZShsZWRnZXJzLnJlbW92ZShsKSk7CiAgICAgICAgfQoKICAgICAgICBG\ndXR1cmU8TG9uZz4gZiA9IGdldExlZGdlclRvUmVwbGljYXRlKG0pOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGYuZ2V0KDUsIFRpbWVVbml0LlNFQ09O\nRFMpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byBm\naW5kIGEgbGVkZ2VyIHRvIHJlcGxpY2F0ZSIpOwogICAgICAgIH0gY2F0Y2gg\nKFRpbWVvdXRFeGNlcHRpb24gdGUpIHsKICAgICAgICAgICAgLy8gY29ycmVj\ndCBiZWhhdmlvdXIKICAgICAgICB9CiAgICAgICAgTG9uZyBuZXdsID0gMHhm\nZWZlZmVmZWZlZmVMOwogICAgICAgIG0ubWFya0xlZGdlclVuZGVycmVwbGlj\nYXRlZChuZXdsLCBtaXNzaW5nUmVwbGljYSk7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJTaG91bGQgaGF2ZSBnb3QgdGhlIG9uZSBqdXN0IGFkZGVkIiwgbmV3\nbCwgZi5nZXQoNSwgVGltZVVuaXQuU0VDT05EUykpOwogICAgfQoKICAgIC8q\nKgogICAgICogVGVzdCBsb2NraW5nIGZvciBsZWRnZXIgdW5yZXBsaWNhdGlv\nbiBtYW5hZ2VyLgogICAgICogSWYgdGhlcmUncyBvbmx5IG9uZSBsZWRnZXIg\nbWFya2VkIGZvciByZXJlcGxpY2F0aW9uLAogICAgICogYW5kIG9uZSBjbGll\nbnQgaGFzIGl0LCBpdCBzaG91bGQgYmUgbG9ja2VkOyBhbm90aGVyCiAgICAg\nKiBjbGllbnQgc2hvdWxkbid0IGJlIGFibGUgdG8gZ2V0IGl0LiBJZiB0aGUg\nZmlyc3QgY2xpZW50IGRpZXMKICAgICAqIGhvd2V2ZXIsIHRoZSBzZWNvbmQg\nY2xpZW50IHNob3VsZCBiZSBhYmxlIHRvIGdldCBpdC4KICAgICAqLwogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RMb2Nr\naW5nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1pc3Np\nbmdSZXBsaWNhID0gImxvY2FsaG9zdDozMTgxIjsKCiAgICAgICAgTGVkZ2Vy\nVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgbTEgPSBsbWYxLm5ld0xlZGdlclVu\nZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7CiAgICAgICAgTGVkZ2VyVW5kZXJy\nZXBsaWNhdGlvbk1hbmFnZXIgbTIgPSBsbWYyLm5ld0xlZGdlclVuZGVycmVw\nbGljYXRpb25NYW5hZ2VyKCk7CgogICAgICAgIExvbmcgbGVkZ2VyID0gMHhm\nZWFkZWVmZGFjTDsKICAgICAgICBtMS5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNh\ndGVkKGxlZGdlciwgbWlzc2luZ1JlcGxpY2EpOwogICAgICAgIEZ1dHVyZTxM\nb25nPiBmID0gZ2V0TGVkZ2VyVG9SZXBsaWNhdGUobTEpOwogICAgICAgIExv\nbmcgbCA9IGYuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgIGFz\nc2VydEVxdWFscygiU2hvdWxkIGJlIHRoZSBsZWRnZXIgSSBqdXN0IG1hcmtl\nZCIsIGxlZGdlciwgbCk7CgogICAgICAgIGYgPSBnZXRMZWRnZXJUb1JlcGxp\nY2F0ZShtMik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZi5nZXQoNSwg\nVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4n\ndCBiZSBhYmxlIHRvIGZpbmQgYSBsZWRnZXIgdG8gcmVwbGljYXRlIik7CiAg\nICAgICAgfSBjYXRjaCAoVGltZW91dEV4Y2VwdGlvbiB0ZSkgewogICAgICAg\nICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgICAgICB6\na2MxLmNsb3NlKCk7IC8vIHNob3VsZCBraWxsIHRoZSBsb2NrCiAgICAgICAg\nemtjMSA9IG51bGw7CgogICAgICAgIGwgPSBmLmdldCg1LCBUaW1lVW5pdC5T\nRUNPTkRTKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSB0aGUg\nbGVkZ2VyIEkgbWFya2VkIiwgbGVkZ2VyLCBsKTsKICAgIH0KCgogICAgLyoq\nCiAgICAgKiBUZXN0IHRoYXQgd2hlbiBhIGxlZGdlciBoYXMgYmVlbiBtYXJr\nZWQgYXMgcmVwbGljYXRlZCwgaXQKICAgICAqIHdpbGwgbm90IGJlIG9mZmVy\nZWQgdG8gYW50aGVyIGNsaWVudC4KICAgICAqIFRoaXMgdGVzdCBjaGVja2Vk\nIHRoYXQgYnkgbWFya2luZyB0d28gbGVkZ2VycywgYW5kIGFjcXVpcmluZwog\nICAgICogdGhlbSBvbiBhIHNpbmdsZSBjbGllbnQuIEl0IG1hcmtzIG9uZSBh\ncyByZXBsaWNhdGVkIGFuZCB0aGVuCiAgICAgKiB0aGUgY2xpZW50IGlzIGtp\nbGxlZC4gV2UgdGhlbiBjaGVjayB0aGF0IGFub3RoZXIgY2xpZW50IGNhbgog\nICAgICogYWNxdWlyZSBhIGxlZGdlciwgYW5kIHRoYXQgaXQncyBub3QgdGhl\nIG9uZSB0aGF0IHdhcyBwcmV2aW91c2x5CiAgICAgKiBtYXJrZWQgYXMgcmVw\nbGljYXRlZC4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RNYXJraW5nQXNSZXBsaWNhdGVkKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1pc3NpbmdSZXBsaWNhID0g\nImxvY2FsaG9zdDozMTgxIjsKCiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNh\ndGlvbk1hbmFnZXIgbTEgPSBsbWYxLm5ld0xlZGdlclVuZGVycmVwbGljYXRp\nb25NYW5hZ2VyKCk7CiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1h\nbmFnZXIgbTIgPSBsbWYyLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5h\nZ2VyKCk7CgogICAgICAgIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVlZmRhY0w7\nCiAgICAgICAgTG9uZyBsZWRnZXJCID0gMHhkZWZhZGViTDsKICAgICAgICBt\nMS5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxlZGdlckEsIG1pc3NpbmdS\nZXBsaWNhKTsKICAgICAgICBtMS5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVk\nKGxlZGdlckIsIG1pc3NpbmdSZXBsaWNhKTsKCiAgICAgICAgRnV0dXJlPExv\nbmc+IGZBID0gZ2V0TGVkZ2VyVG9SZXBsaWNhdGUobTEpOwogICAgICAgIEZ1\ndHVyZTxMb25nPiBmQiA9IGdldExlZGdlclRvUmVwbGljYXRlKG0xKTsKCiAg\nICAgICAgTG9uZyBsQSA9IGZBLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsK\nICAgICAgICBMb25nIGxCID0gZkIuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMp\nOwoKICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgYmUgdGhlIGxlZGdlcnMg\nSSBqdXN0IG1hcmtlZCIsCiAgICAgICAgICAgICAgICAgICAobEEuZXF1YWxz\nKGxlZGdlckEpICYmIGxCLmVxdWFscyhsZWRnZXJCKSkKICAgICAgICAgICAg\nICAgICAgIHx8IChsQS5lcXVhbHMobGVkZ2VyQikgJiYgbEIuZXF1YWxzKGxl\nZGdlckEpKSk7CgogICAgICAgIEZ1dHVyZTxMb25nPiBmID0gZ2V0TGVkZ2Vy\nVG9SZXBsaWNhdGUobTIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGYu\nZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgICAgICBmYWlsKCJT\naG91bGRuJ3QgYmUgYWJsZSB0byBmaW5kIGEgbGVkZ2VyIHRvIHJlcGxpY2F0\nZSIpOwogICAgICAgIH0gY2F0Y2ggKFRpbWVvdXRFeGNlcHRpb24gdGUpIHsK\nICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAg\nICAgICAgbTEubWFya0xlZGdlclJlcGxpY2F0ZWQobEEpOwogICAgICAgIHpr\nYzEuY2xvc2UoKTsgLy8gc2hvdWxkIGtpbGwgdGhlIGxvY2sKICAgICAgICB6\na2MxID0gbnVsbDsKCiAgICAgICAgTG9uZyBsID0gZi5nZXQoNSwgVGltZVVu\naXQuU0VDT05EUyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgYmUg\ndGhlIGxlZGdlciBJIG1hcmtlZCIsIGxCLCBsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRlc3QgcmVsZWFzaW5nIG9mIGEgbGVkZ2VyCiAgICAgKiBBIGxl\nZGdlciBpcyByZWxlYXNlZCB3aGVuIGEgY2xpZW50IGRlY2lkZXMgaXQgZG9l\ncyBub3Qgd2FudAogICAgICogdG8gcmVwbGljYXRlIGl0IChvciBjYW5ub3Qg\nYXQgdGhlIG1vbWVudCkuCiAgICAgKiBXaGVuIGEgY2xpZW50IHJlbGVhc2Vz\nIGEgcHJldmlvdXNseSBhY3F1aXJlZCBsZWRnZXIsIGFub3RoZXIKICAgICAq\nIGNsaWVudCBzaG91bGQgdGhlbiBiZSBhYmxlIHRvIGFjcXVpcmUgaXQuCiAg\nICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0UmVsZWFzZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN0\ncmluZyBtaXNzaW5nUmVwbGljYSA9ICJsb2NhbGhvc3Q6MzE4MSI7CgogICAg\nICAgIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIG0xID0gbG1mMS5u\nZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwogICAgICAgIExl\nZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIG0yID0gbG1mMi5uZXdMZWRn\nZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICBMb25nIGxl\nZGdlckEgPSAweGZlYWRlZWZkYWNMOwogICAgICAgIExvbmcgbGVkZ2VyQiA9\nIDB4ZGVmYWRlYkw7CiAgICAgICAgbTEubWFya0xlZGdlclVuZGVycmVwbGlj\nYXRlZChsZWRnZXJBLCBtaXNzaW5nUmVwbGljYSk7CiAgICAgICAgbTEubWFy\na0xlZGdlclVuZGVycmVwbGljYXRlZChsZWRnZXJCLCBtaXNzaW5nUmVwbGlj\nYSk7CgogICAgICAgIEZ1dHVyZTxMb25nPiBmQSA9IGdldExlZGdlclRvUmVw\nbGljYXRlKG0xKTsKICAgICAgICBGdXR1cmU8TG9uZz4gZkIgPSBnZXRMZWRn\nZXJUb1JlcGxpY2F0ZShtMSk7CgogICAgICAgIExvbmcgbEEgPSBmQS5nZXQo\nNSwgVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgTG9uZyBsQiA9IGZCLmdl\ndCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKCiAgICAgICAgYXNzZXJ0VHJ1ZSgi\nU2hvdWxkIGJlIHRoZSBsZWRnZXJzIEkganVzdCBtYXJrZWQiLAogICAgICAg\nICAgICAgICAgICAgKGxBLmVxdWFscyhsZWRnZXJBKSAmJiBsQi5lcXVhbHMo\nbGVkZ2VyQikpCiAgICAgICAgICAgICAgICAgICB8fCAobEEuZXF1YWxzKGxl\nZGdlckIpICYmIGxCLmVxdWFscyhsZWRnZXJBKSkpOwoKICAgICAgICBGdXR1\ncmU8TG9uZz4gZiA9IGdldExlZGdlclRvUmVwbGljYXRlKG0yKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBmLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRT\nKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gZmlu\nZCBhIGxlZGdlciB0byByZXBsaWNhdGUiKTsKICAgICAgICB9IGNhdGNoIChU\naW1lb3V0RXhjZXB0aW9uIHRlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3Qg\nYmVoYXZpb3VyCiAgICAgICAgfQogICAgICAgIG0xLm1hcmtMZWRnZXJSZXBs\naWNhdGVkKGxBKTsKICAgICAgICBtMS5yZWxlYXNlVW5kZXJyZXBsaWNhdGVk\nTGVkZ2VyKGxCKTsKCiAgICAgICAgTG9uZyBsID0gZi5nZXQoNSwgVGltZVVu\naXQuU0VDT05EUyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgYmUg\ndGhlIGxlZGdlciBJIG1hcmtlZCIsIGxCLCBsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRlc3QgdGhhdCB3aGVuIGEgZmFpbHVyZSBvY2N1cnMgb24gYSBs\nZWRnZXIsIHdoaWxlIHRoZSBsZWRnZXIKICAgICAqIGlzIGFscmVhZHkgYmVp\nbmcgcmVyZXBsaWNhdGVkLCB0aGUgbGVkZ2VyIHdpbGwgc3RpbGwgYmUgaW4g\ndGhlCiAgICAgKiB1bmRlciByZXBsaWNhdGVkIGxlZGdlciBsaXN0IHdoZW4g\nZmlyc3QgcmVyZXBsaWNhdGluZyBjbGllbnQgbWFya3MKICAgICAqIGl0IGFz\nIHJlcGxpY2F0ZWQuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0TWFueUZhaWx1cmVzKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1pc3NpbmdSZXBsaWNhMSA9ICJs\nb2NhbGhvc3Q6MzE4MSI7CiAgICAgICAgU3RyaW5nIG1pc3NpbmdSZXBsaWNh\nMiA9ICJsb2NhbGhvc3Q6MzE4MiI7CgogICAgICAgIExlZGdlclVuZGVycmVw\nbGljYXRpb25NYW5hZ2VyIG0xID0gbG1mMS5uZXdMZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICBMb25nIGxlZGdlckEgPSAweGZl\nYWRlZWZkYWNMOwogICAgICAgIG0xLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0\nZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2ExKTsKCiAgICAgICAgRnV0dXJl\nPExvbmc+IGZBID0gZ2V0TGVkZ2VyVG9SZXBsaWNhdGUobTEpOwogICAgICAg\nIExvbmcgbEEgPSBmQS5nZXQoNSwgVGltZVVuaXQuU0VDT05EUyk7CgogICAg\nICAgIG0xLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGVkZ2VyQSwgbWlz\nc2luZ1JlcGxpY2EyKTsKCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQg\nYmUgdGhlIGxlZGdlciBJIGp1c3QgbWFya2VkIiwKICAgICAgICAgICAgICAg\nICAgICAgbEEsIGxlZGdlckEpOwogICAgICAgIG0xLm1hcmtMZWRnZXJSZXBs\naWNhdGVkKGxBKTsKCiAgICAgICAgRnV0dXJlPExvbmc+IGYgPSBnZXRMZWRn\nZXJUb1JlcGxpY2F0ZShtMSk7CiAgICAgICAgbEEgPSBmLmdldCg1LCBUaW1l\nVW5pdC5TRUNPTkRTKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBi\nZSB0aGUgbGVkZ2VyIEkgaGFkIG1hcmtlZCBwcmV2aW91c2x5IiwKICAgICAg\nICAgICAgICAgICAgICAgbEEsIGxlZGdlckEpOwogICAgfQoKICAgIC8qKgog\nICAgICogVGVzdCB0aGF0IHdoZW4gYSBsZWRnZXIgaXMgbWFya2VkIGFzIHVu\nZGVycmVwbGljYXRlZCB3aXRoCiAgICAgKiB0aGUgc2FtZSBtaXNzaW5nIHJl\ncGxpY2EgdHdpY2UsIG9ubHkgbWFya2luZyBhcyByZXBsaWNhdGVkCiAgICAg\nKiB3aWxsIGJlIGVub3VnaCB0byByZW1vdmUgaXQgZnJvbSB0aGUgbGlzdC4K\nICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3QycmVwb3J0U2FtZSgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIFN0cmluZyBtaXNzaW5nUmVwbGljYTEgPSAibG9jYWxob3N0OjMxODEi\nOwoKICAgICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtMSA9\nIGxtZjEubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAg\nICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtMiA9IGxtZjIu\nbmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAg\nTG9uZyBsZWRnZXJBID0gMHhmZWFkZWVmZGFjTDsKICAgICAgICBtMS5tYXJr\nTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxlZGdlckEsIG1pc3NpbmdSZXBsaWNh\nMSk7CiAgICAgICAgbTIubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsZWRn\nZXJBLCBtaXNzaW5nUmVwbGljYTEpOwoKICAgICAgICAvLyB2ZXJpZnkgZHVw\nbGljYXRlIG1pc3NpbmcgcmVwbGljYQogICAgICAgIFVuZGVycmVwbGljYXRl\nZExlZGdlckZvcm1hdC5CdWlsZGVyIGJ1aWxkZXJBID0gVW5kZXJyZXBsaWNh\ndGVkTGVkZ2VyRm9ybWF0CiAgICAgICAgICAgICAgICAubmV3QnVpbGRlcigp\nOwogICAgICAgIFN0cmluZyB6bm9kZSA9IGdldFVyTGVkZ2VyWm5vZGUobGVk\nZ2VyQSk7CiAgICAgICAgYnl0ZVtdIGRhdGEgPSB6a2MxLmdldERhdGEoem5v\nZGUsIGZhbHNlLCBudWxsKTsKICAgICAgICBUZXh0Rm9ybWF0Lm1lcmdlKG5l\ndyBTdHJpbmcoZGF0YSwgQ2hhcnNldC5mb3JOYW1lKCJVVEYtOCIpKSwgYnVp\nbGRlckEpOwogICAgICAgIExpc3Q8U3RyaW5nPiByZXBsaWNhTGlzdCA9IGJ1\naWxkZXJBLmdldFJlcGxpY2FMaXN0KCk7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKCJQdWJsaXNoZWQgZHVwbGljYXRlIG1pc3NpbmcgcmVwbGljYSA6ICIgKyBy\nZXBsaWNhTGlzdCwgMSwKICAgICAgICAgICAgICAgIHJlcGxpY2FMaXN0LnNp\nemUoKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiUHVibGlzaGVkIGR1cGxpY2F0\nZSBtaXNzaW5nIHJlcGxpY2EgOiAiICsgcmVwbGljYUxpc3QsCiAgICAgICAg\nICAgICAgICByZXBsaWNhTGlzdC5jb250YWlucyhtaXNzaW5nUmVwbGljYTEp\nKTsKCiAgICAgICAgRnV0dXJlPExvbmc+IGZBID0gZ2V0TGVkZ2VyVG9SZXBs\naWNhdGUobTEpOwogICAgICAgIExvbmcgbEEgPSBmQS5nZXQoNSwgVGltZVVu\naXQuU0VDT05EUyk7CgogICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJl\nIHRoZSBsZWRnZXIgSSBqdXN0IG1hcmtlZCIsCiAgICAgICAgICAgICAgICAg\nICAgIGxBLCBsZWRnZXJBKTsKICAgICAgICBtMS5tYXJrTGVkZ2VyUmVwbGlj\nYXRlZChsQSk7CgogICAgICAgIEZ1dHVyZTxMb25nPiBmID0gZ2V0TGVkZ2Vy\nVG9SZXBsaWNhdGUobTIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGYu\nZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgICAgICBmYWlsKCJT\naG91bGRuJ3QgYmUgYWJsZSB0byBmaW5kIGEgbGVkZ2VyIHRvIHJlcGxpY2F0\nZSIpOwogICAgICAgIH0gY2F0Y2ggKFRpbWVvdXRFeGNlcHRpb24gdGUpIHsK\nICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgbXVsdGlwbGUgTGVkZ2Vy\nVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXJzIHNob3VsZCBiZSBhYmxlIHRvIHRh\na2UKICAgICAqIGxvY2sgYW5kIHJlbGVhc2UgZm9yIHNhbWUgbGVkZ2VyCiAg\nICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAzMDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RNdWx0aXBsZU1hbmFnZXJzU2hvdWxkQmVBYmxlVG9UYWtlQW5k\nUmVsZWFzZUxvY2soKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBTdHJpbmcgbWlzc2luZ1JlcGxpY2ExID0gImxvY2FsaG9zdDoz\nMTgxIjsKICAgICAgICBmaW5hbCBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFu\nYWdlciBtMSA9IGxtZjEKICAgICAgICAgICAgICAgIC5uZXdMZWRnZXJVbmRl\ncnJlcGxpY2F0aW9uTWFuYWdlcigpOwogICAgICAgIGZpbmFsIExlZGdlclVu\nZGVycmVwbGljYXRpb25NYW5hZ2VyIG0yID0gbG1mMgogICAgICAgICAgICAg\nICAgLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7CiAgICAg\nICAgTG9uZyBsZWRnZXJBID0gMHhmZWFkZWVmZGFjTDsKICAgICAgICBtMS5t\nYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxlZGdlckEsIG1pc3NpbmdSZXBs\naWNhMSk7CiAgICAgICAgZmluYWwgaW50IGl0ZXJhdGlvbkNvdW50ID0gMTAw\nOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNoMSA9IG5ldyBD\nb3VudERvd25MYXRjaChpdGVyYXRpb25Db3VudCk7CiAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggbGF0Y2gyID0gbmV3IENvdW50RG93bkxhdGNoKGl0\nZXJhdGlvbkNvdW50KTsKICAgICAgICBUaHJlYWQgdGhyZWFkMSA9IG5ldyBU\naHJlYWQoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICB0YWtlTGVkZ2Vy\nQW5kUmVsZWFzZShtMSwgbGF0Y2gxLCBpdGVyYXRpb25Db3VudCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBUaHJlYWQgdGhyZWFkMiA9\nIG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICB0YWtl\nTGVkZ2VyQW5kUmVsZWFzZShtMiwgbGF0Y2gyLCBpdGVyYXRpb25Db3VudCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIHRocmVhZDEuc3Rh\ncnQoKTsKICAgICAgICB0aHJlYWQyLnN0YXJ0KCk7CgogICAgICAgIC8vIHdh\naXQgdW50aWwgYXQgbGVhc3Qgb25lIHRocmVhZCBjb21wbGV0ZWQKICAgICAg\nICB3aGlsZSAoIWxhdGNoMS5hd2FpdCg1MCwgVGltZVVuaXQuTUlMTElTRUNP\nTkRTKQogICAgICAgICAgICAgICAgJiYgIWxhdGNoMi5hd2FpdCg1MCwgVGlt\nZVVuaXQuTUlMTElTRUNPTkRTKSkgewogICAgICAgICAgICBUaHJlYWQuc2xl\nZXAoNTApOwogICAgICAgIH0KCiAgICAgICAgbTEuY2xvc2UoKTsKICAgICAg\nICBtMi5jbG9zZSgpOwoKICAgICAgICAvLyBBZnRlciBjb21wbGV0aW5nICds\nb2NrIGFjcXVpcmUscmVsZWFzZScgam9iLCBpdCBzaG91bGQgbm90aWZ5IGJl\nbG93CiAgICAgICAgLy8gd2FpdAogICAgICAgIGxhdGNoMS5hd2FpdCgpOwog\nICAgICAgIGxhdGNoMi5hd2FpdCgpOwogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCB2ZXJpZmllcyBmYWlsdXJlcyBvZiBib29raWVzIHdoaWNoIGFyZSBy\nZXNlbWJsaW5nIGVhY2ggb3RoZXIuCiAgICAgKgogICAgICogQksgc2VydmVy\ncyBuYW1lZCBsaWtlKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqCiAgICAgKiAxLmNsdXN0ZXIuY29tLCAyLmNsdXN0ZXIu\nY29tLCAxMS5jbHVzdGVyLmNvbSwgMTIuY2x1c3Rlci5jb20KICAgICAqICoq\nKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqKioqKioKICAgICAqCiAgICAgKiBCS3NlcnZlciBJ\nUDpIT1NUIGxpa2UqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioKICAgICAqIGxvY2FsaG9zdDozMTgxLCBsb2NhbGhvc3Q6\nMzE4LCBsb2NhbGhvc3Q6MzE4MTIKICAgICAqICoqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RNYXJrU2ltaWxhck1pc3NpbmdSZXBsaWNhKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxTdHJpbmc+IG1pc3NpbmdS\nZXBsaWNhID0gbmV3IEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgbWlz\nc2luZ1JlcGxpY2EuYWRkKCJsb2NhbGhvc3Q6MzE4MSIpOwogICAgICAgIG1p\nc3NpbmdSZXBsaWNhLmFkZCgibG9jYWxob3N0OjMxOCIpOwogICAgICAgIG1p\nc3NpbmdSZXBsaWNhLmFkZCgibG9jYWxob3N0OjMxODEyIik7CiAgICAgICAg\nbWlzc2luZ1JlcGxpY2EuYWRkKCIxLmNsdXN0ZXIuY29tIik7CiAgICAgICAg\nbWlzc2luZ1JlcGxpY2EuYWRkKCIyLmNsdXN0ZXIuY29tIik7CiAgICAgICAg\nbWlzc2luZ1JlcGxpY2EuYWRkKCIxMS5jbHVzdGVyLmNvbSIpOwogICAgICAg\nIG1pc3NpbmdSZXBsaWNhLmFkZCgiMTIuY2x1c3Rlci5jb20iKTsKICAgICAg\nICB2ZXJpZnlNYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKG1pc3NpbmdSZXBs\naWNhKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgbXVsdGlwbGUgYm9v\na2llIGZhaWx1cmVzIGZvciBhIGxlZGdlciBhbmQgbWFya2VkIGFzIHVuZGVy\ncmVwbGljYXRlZAogICAgICogb25lIGFmdGVyIGFub3RoZXIuCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nTWFueUZhaWx1cmVzSW5BbkVuc2VtYmxlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgTGlzdDxTdHJpbmc+IG1pc3NpbmdSZXBsaWNhID0gbmV3IEFy\ncmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgbWlzc2luZ1JlcGxpY2EuYWRk\nKCJsb2NhbGhvc3Q6MzE4MSIpOwogICAgICAgIG1pc3NpbmdSZXBsaWNhLmFk\nZCgibG9jYWxob3N0OjMxODIiKTsKICAgICAgICB2ZXJpZnlNYXJrTGVkZ2Vy\nVW5kZXJyZXBsaWNhdGVkKG1pc3NpbmdSZXBsaWNhKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRlc3QgZGlzYWJsaW5nIHRoZSBsZWRnZXIgcmUtcmVwbGlj\nYXRpb24uIEFmdGVyIGRpc2FibGluZywgaXQgd2lsbCBub3QgYmUKICAgICAq\nIGFibGUgdG8gZ2V0TGVkZ2VyVG9SZXJlcGxpY2F0ZSgpLiBUaGlzIGNhbGxz\nIHdpbGwgZW50ZXIgaW50byBpbmZpbml0ZQogICAgICogd2FpdGluZyB1bnRp\nbCBlbmFibGluZyByZXJlcGxpY2F0aW9uIHByb2Nlc3MKICAgICAqLwogICAg\nQFRlc3QodGltZW91dCA9IDIwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdERp\nc2FibGVMZWRlZ2VyUmVwbGljYXRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBmaW5hbCBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBy\nZXBsaWNhTWdyID0gbG1mMQogICAgICAgICAgICAgICAgLm5ld0xlZGdlclVu\nZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7CgogICAgICAgIC8vIHNpbXVsYXRl\nIGZldyB1ckxlZGdlcnMgYmVmb3JlIGRpc2FibGluZwogICAgICAgIGZpbmFs\nIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVlZmRhY0w7CiAgICAgICAgZmluYWwg\nU3RyaW5nIG1pc3NpbmdSZXBsaWNhID0gImxvY2FsaG9zdDozMTgxIjsKCiAg\nICAgICAgLy8gZGlzYWJsaW5nIHJlcGxpY2F0aW9uCiAgICAgICAgcmVwbGlj\nYU1nci5kaXNhYmxlTGVkZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICBMT0cu\naW5mbygiRGlzYWJsZWQgTGVkZWdlciBSZXBsaWNhdGlvbiIpOwoKICAgICAg\nICB0cnkgewogICAgICAgICAgICByZXBsaWNhTWdyLm1hcmtMZWRnZXJVbmRl\ncnJlcGxpY2F0ZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2EpOwogICAgICAg\nIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgTE9HLmRlYnVnKCJVbmV4cGVjdGVkIGV4Y2VwdGlvbiB3aGlsZSBtYXJr\naW5nIHVyTGVkZ2VyIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlVuZXhwZWN0\nZWQgZXhjZXB0aW9uIHdoaWxlIG1hcmtpbmcgdXJMZWRnZXIiICsgZS5nZXRN\nZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgRnV0dXJlPExvbmc+IGZB\nID0gZ2V0TGVkZ2VyVG9SZXBsaWNhdGUocmVwbGljYU1ncik7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZkEuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMp\nOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byBmaW5k\nIGEgbGVkZ2VyIHRvIHJlcGxpY2F0ZSIpOwogICAgICAgIH0gY2F0Y2ggKFRp\nbWVvdXRFeGNlcHRpb24gdGUpIHsKICAgICAgICAgICAgLy8gZXhwZWN0ZWQg\nYmVoYXZpb3VyLCBhcyB0aGUgcmVwbGljYXRpb24gaXMgZGlzYWJsZWQKICAg\nICAgICAgICAgaXNMZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVkID0gZmFsc2U7\nCiAgICAgICAgfQoKICAgICAgICBhc3NlcnRUcnVlKCJMZWRnZXIgcmVwbGlj\nYXRpb24gaXMgbm90IGRpc2FibGVkISIsCiAgICAgICAgICAgICAgICAhaXNM\nZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVkKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgZW5hYmxpbmcgdGhlIGxlZGdlciByZS1yZXBsaWNhdGlvbi4g\nQWZ0ZXIgZW5hYmxlTGVkZWdlclJlcGxpY2F0aW9uLAogICAgICogc2hvdWxk\nIGNvbnRpbnVlIGdldExlZGdlclRvUmVyZXBsaWNhdGUoKSB0YXNrCiAgICAg\nKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAyMDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RFbmFibGVMZWRlZ2VyUmVwbGljYXRpb24oKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBpc0xlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQgPSB0\ncnVlOwogICAgICAgIGZpbmFsIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5h\nZ2VyIHJlcGxpY2FNZ3IgPSBsbWYxCiAgICAgICAgICAgICAgICAubmV3TGVk\nZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAgLy8gc2lt\ndWxhdGUgZmV3IHVyTGVkZ2VycyBiZWZvcmUgZGlzYWJsaW5nCiAgICAgICAg\nZmluYWwgTG9uZyBsZWRnZXJBID0gMHhmZWFkZWVmZGFjTDsKICAgICAgICBm\naW5hbCBTdHJpbmcgbWlzc2luZ1JlcGxpY2EgPSAibG9jYWxob3N0OjMxODEi\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlcGxpY2FNZ3IubWFya0xl\nZGdlclVuZGVycmVwbGljYXRlZChsZWRnZXJBLCBtaXNzaW5nUmVwbGljYSk7\nCiAgICAgICAgfSBjYXRjaCAoVW5hdmFpbGFibGVFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBMT0cuZGVidWcoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIHdo\naWxlIG1hcmtpbmcgdXJMZWRnZXIiLCBlKTsKICAgICAgICAgICAgZmFpbCgi\nVW5leHBlY3RlZCBleGNlcHRpb24gd2hpbGUgbWFya2luZyB1ckxlZGdlciIg\nKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBkaXNh\nYmxpbmcgcmVwbGljYXRpb24KICAgICAgICByZXBsaWNhTWdyLmRpc2FibGVM\nZWRnZXJSZXBsaWNhdGlvbigpOwogICAgICAgIExPRy5kZWJ1ZygiRGlzYWJs\nZWQgTGVkZWdlciBSZXBsaWNhdGlvbiIpOwoKICAgICAgICBTdHJpbmcgem5v\nZGVBID0gZ2V0VXJMZWRnZXJabm9kZShsZWRnZXJBKTsKICAgICAgICBmaW5h\nbCBDb3VudERvd25MYXRjaCB6bm9kZUxhdGNoID0gbmV3IENvdW50RG93bkxh\ndGNoKDIpOwogICAgICAgIFN0cmluZyB1cmxlZGdlckEgPSBTdHJpbmdVdGls\ncy5zdWJzdHJpbmdBZnRlckxhc3Qoem5vZGVBLCAiLyIpOwogICAgICAgIFN0\ncmluZyB1ckxvY2tMZWRnZXJBID0gYmFzZVBhdGggKyAiL2xvY2tzLyIgKyB1\ncmxlZGdlckE7CiAgICAgICAgemtjMS5leGlzdHModXJMb2NrTGVkZ2VyQSwg\nbmV3IFdhdGNoZXIoKXsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7\nCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZ2V0VHlwZSgpID09IEV2ZW50\nVHlwZS5Ob2RlQ3JlYXRlZCkgewogICAgICAgICAgICAgICAgICAgIHpub2Rl\nTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJSZWNpZXZlZCBub2RlIGNyZWF0aW9uIGV2ZW50IGZvciB0aGUgek5v\nZGVQYXRoOiIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgZXZlbnQu\nZ2V0UGF0aCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIAogICAgICAgICAgICB9fSk7CiAgICAgICAgLy8gZ2V0TGVkZ2VyVG9SZXJl\ncGxpY2F0ZSBpcyB3YWl0aW5nIHVudGlsIGVuYWJsZSByZXJlcGxpY2F0aW9u\nCiAgICAgICAgVGhyZWFkIHRocmVhZDEgPSBuZXcgVGhyZWFkKCkgewogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcnVu\nKCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBMb25nIGxBID0gcmVwbGljYU1nci5nZXRMZWRnZXJUb1JlcmVwbGljYXRl\nKCk7CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQg\nYmUgdGhlIGxlZGdlciBJIGp1c3QgbWFya2VkIiwgbEEsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJBKTsKICAgICAgICAgICAgICAgICAg\nICBpc0xlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQgPSBmYWxzZTsKICAgICAg\nICAgICAgICAgICAgICB6bm9kZUxhdGNoLmNvdW50RG93bigpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoVW5hdmFpbGFibGVFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiVW5leHBlY3RlZCBleGNl\ncHRpb24gd2hpbGUgbWFya2luZyB1ckxlZGdlciIsIGUpOwogICAgICAgICAg\nICAgICAgICAgIGlzTGVkZ2VyUmVwbGljYXRpb25EaXNhYmxlZCA9IGZhbHNl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsK\nICAgICAgICB0aHJlYWQxLnN0YXJ0KCk7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHpub2RlTGF0Y2guYXdhaXQoNSwgVGltZVVuaXQuU0VDT05EUyk7\nCiAgICAgICAgICAgIGFzc2VydFRydWUoIkxlZGdlciByZXBsaWNhdGlvbiBp\ncyBub3QgZGlzYWJsZWQhIiwKICAgICAgICAgICAgICAgICAgICBpc0xlZGdl\nclJlcGxpY2F0aW9uRGlzYWJsZWQpOwogICAgICAgICAgICBhc3NlcnRFcXVh\nbHMoIkZhaWxlZCB0byBkaXNhYmxlIGxlZGdlciByZXBsaWNhdGlvbiEiLCAy\nLCB6bm9kZUxhdGNoCiAgICAgICAgICAgICAgICAgICAgLmdldENvdW50KCkp\nOwoKICAgICAgICAgICAgcmVwbGljYU1nci5lbmFibGVMZWRnZXJSZXBsaWNh\ndGlvbigpOwogICAgICAgICAgICB6bm9kZUxhdGNoLmF3YWl0KDUsIFRpbWVV\nbml0LlNFQ09ORFMpOwogICAgICAgICAgICBMT0cuZGVidWcoIkVuYWJsZWQg\nTGVkZWdlciBSZXBsaWNhdGlvbiIpOwogICAgICAgICAgICBhc3NlcnRUcnVl\nKCJMZWRnZXIgcmVwbGljYXRpb24gaXMgbm90IGRpc2FibGVkISIsCiAgICAg\nICAgICAgICAgICAgICAgIWlzTGVkZ2VyUmVwbGljYXRpb25EaXNhYmxlZCk7\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiRmFpbGVkIHRvIGRpc2FibGUg\nbGVkZ2VyIHJlcGxpY2F0aW9uISIsIDAsIHpub2RlTGF0Y2gKICAgICAgICAg\nICAgICAgICAgICAuZ2V0Q291bnQoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdGhyZWFkMS5pbnRlcnJ1cHQoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgdGhlIGhpZXJhcmNoeSBn\nZXRzIGNsZWFuZWQgdXAgYXMgbGVkZ2VycwogICAgICogYXJlIG1hcmtlZCBh\ncyBmdWxseSByZXBsaWNhdGVkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9\nNjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0SGllcmFyY2h5Q2xlYW51cCgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZpbmFsIExlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyIHJlcGxpY2FNZ3IgPSBsbWYxCiAgICAgICAg\nICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwogICAg\nICAgIC8vIDQgbGVkZ2VycywgMiBpbiB0aGUgc2FtZSBoaWVyYXJjaHkKICAg\nICAgICBsb25nW10gbGVkZ2VycyA9IHsgMHgwMDAwMDAwMGRlYWRiZWVmTCwg\nMHgwMDAwMDAwMGRlYWRiZWVlTCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgMHgwMDAwMDAwMGJlZWZjYWZlTCwgMHgwMDAwMDAwMGNhZmVkMDBkTCB9\nOwoKICAgICAgICBmb3IgKGxvbmcgbCA6IGxlZGdlcnMpIHsKICAgICAgICAg\nICAgcmVwbGljYU1nci5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGwsICJs\nb2NhbGhvc3Q6MzE4MSIpOwogICAgICAgIH0KICAgICAgICAvLyBjYW4ndCBz\naW1wbHkgdGVzdCB0b3AgbGV2ZWwgYXMgd2UgYXJlIGxpbWl0ZWQgdG8gbGVk\nZ2VyCiAgICAgICAgLy8gaWRzIG5vIGxhcmdlciB0aGFuIGFuIGludAogICAg\nICAgIFN0cmluZyB0ZXN0UGF0aCA9IHVyTGVkZ2VyUGF0aCArICIvMDAwMC8w\nMDAwIjsKICAgICAgICBMaXN0PFN0cmluZz4gY2hpbGRyZW4gPSB6a2MxLmdl\ndENoaWxkcmVuKHRlc3RQYXRoLCBmYWxzZSk7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJXcm9uZyBudW1iZXIgb2YgaGllcmFyY2hpZXMiLCAzLCBjaGlsZHJl\nbi5zaXplKCkpOwoKICAgICAgICBpbnQgbWFya2VkID0gMDsKICAgICAgICB3\naGlsZSAobWFya2VkIDwgMykgewogICAgICAgICAgICBsb25nIGwgPSByZXBs\naWNhTWdyLmdldExlZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICAgICAg\naWYgKGwgIT0gbGVkZ2Vyc1swXSkgewogICAgICAgICAgICAgICAgcmVwbGlj\nYU1nci5tYXJrTGVkZ2VyUmVwbGljYXRlZChsKTsKICAgICAgICAgICAgICAg\nIG1hcmtlZCsrOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgcmVwbGljYU1nci5yZWxlYXNlVW5kZXJyZXBsaWNhdGVkTGVkZ2VyKGwp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuID0g\nemtjMS5nZXRDaGlsZHJlbih0ZXN0UGF0aCwgZmFsc2UpOwogICAgICAgIGFz\nc2VydEVxdWFscygiV3JvbmcgbnVtYmVyIG9mIGhpZXJhcmNoaWVzIiwgMSwg\nY2hpbGRyZW4uc2l6ZSgpKTsKCiAgICAgICAgbG9uZyBsID0gcmVwbGljYU1n\nci5nZXRMZWRnZXJUb1JlcmVwbGljYXRlKCk7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJHb3Qgd3JvbmcgbGVkZ2VyIiwgbGVkZ2Vyc1swXSwgbCk7CiAgICAg\nICAgcmVwbGljYU1nci5tYXJrTGVkZ2VyUmVwbGljYXRlZChsKTsKCiAgICAg\nICAgY2hpbGRyZW4gPSB6a2MxLmdldENoaWxkcmVuKHVyTGVkZ2VyUGF0aCwg\nZmFsc2UpOwogICAgICAgIGFzc2VydEVxdWFscygiQWxsIGhpZXJhcmNoaWVz\nIHNob3VsZCBiZSBjbGVhbmVkIHVwIiwgMCwgY2hpbGRyZW4uc2l6ZSgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBhcyB0aGUgaGllcmFy\nY2h5IGdldHMgY2xlYW5lZCB1cCwgaXQgZG9lc24ndCBpbnRlcmZlcmUKICAg\nICAqIHdpdGggdGhlIG1hcmtpbmcgb2Ygb3RoZXIgbGVkZ2VycyBhcyB1bmRl\ncnJlcGxpY2F0ZWQKICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDkwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdEhpZXJhcmNoeUNsZWFudXBJbnRlcmZl\ncmVuY2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBMZWRn\nZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciByZXBsaWNhTWdyMSA9IGxtZjEK\nICAgICAgICAgICAgLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2Vy\nKCk7CiAgICAgICAgZmluYWwgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFn\nZXIgcmVwbGljYU1ncjIgPSBsbWYyCiAgICAgICAgICAgIC5uZXdMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICBmaW5hbCBpbnQg\naXRlcmF0aW9ucyA9IDEwMDA7CiAgICAgICAgZmluYWwgQXRvbWljQm9vbGVh\nbiB0aHJlYWRGYWlsZWQgPSBuZXcgQXRvbWljQm9vbGVhbihmYWxzZSk7CiAg\nICAgICAgVGhyZWFkIG1hcmtVbmRlciA9IG5ldyBUaHJlYWQoKSB7CiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9uZyBsID0gMTsKICAgICAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGl0\nZXJhdGlvbnM7IGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmVwbGljYU1ncjEubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsLCAibG9j\nYWxob3N0OjMxODEiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwg\nKz0gMTAwMDA7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIm1hcmtVbmRlciBUaHJlYWQgZmFp\nbGVkIHdpdGggZXhjZXB0aW9uIiwgZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHRocmVhZEZhaWxlZC5zZXQodHJ1ZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgZmluYWwgQXRvbWlj\nSW50ZWdlciBwcm9jZXNzZWQgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAg\nICAgICBUaHJlYWQgbWFya1JlcGwgPSBuZXcgVGhyZWFkKCkgewogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb25nIGwgPSByZXBsaWNhTWdyMi5nZXRMZWRnZXJUb1Jl\ncmVwbGljYXRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBs\naWNhTWdyMi5tYXJrTGVkZ2VyUmVwbGljYXRlZChsKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHByb2Nlc3NlZC5pbmNyZW1lbnRBbmRHZXQoKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigibWFya1JlcGwgVGhyZWFkIGZhaWxlZCB3aXRoIGV4\nY2VwdGlvbiIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICB0aHJlYWRG\nYWlsZWQuc2V0KHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9OwogICAgICAgIG1hcmtSZXBsLnNldERhZW1vbih0cnVl\nKTsKICAgICAgICBtYXJrVW5kZXIuc2V0RGFlbW9uKHRydWUpOwoKICAgICAg\nICBtYXJrUmVwbC5zdGFydCgpOwogICAgICAgIG1hcmtVbmRlci5zdGFydCgp\nOwogICAgICAgIG1hcmtVbmRlci5qb2luKCk7CiAgICAgICAgYXNzZXJ0RmFs\nc2UoIlRocmVhZCBmYWlsZWQgdG8gY29tcGxldGUiLCB0aHJlYWRGYWlsZWQu\nZ2V0KCkpOwoKICAgICAgICBpbnQgbGFzdFByb2Nlc3NlZCA9IDA7CiAgICAg\nICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgbWFya1JlcGwuam9pbigx\nMDAwMCk7CiAgICAgICAgICAgIGlmICghbWFya1JlcGwuaXNBbGl2ZSgpKSB7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBhc3NlcnRGYWxzZSgibWFya1JlcGwgdGhyZWFkIG5vdCBwcm9ncmVz\nc2luZyIsIGxhc3RQcm9jZXNzZWQgPT0gcHJvY2Vzc2VkLmdldCgpKTsKICAg\nICAgICB9CiAgICAgICAgYXNzZXJ0RmFsc2UoIlRocmVhZCBmYWlsZWQgdG8g\nY29tcGxldGUiLCB0aHJlYWRGYWlsZWQuZ2V0KCkpOwoKICAgICAgICBMaXN0\nPFN0cmluZz4gY2hpbGRyZW4gPSB6a2MxLmdldENoaWxkcmVuKHVyTGVkZ2Vy\nUGF0aCwgZmFsc2UpOwogICAgICAgIGZvciAoU3RyaW5nIHMgOiBjaGlsZHJl\nbikgewogICAgICAgICAgICBMT0cuaW5mbygiczoge30iLCBzKTsKICAgICAg\nICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJBbGwgaGllcmFyY2hpZXMgc2hv\ndWxkIGJlIGNsZWFuZWQgdXAiLCAwLCBjaGlsZHJlbi5zaXplKCkpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCB2ZXJpZnlNYXJrTGVkZ2VyVW5kZXJyZXBs\naWNhdGVkKENvbGxlY3Rpb248U3RyaW5nPiBtaXNzaW5nUmVwbGljYSkKICAg\nICAgICAgICAgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRF\neGNlcHRpb24sCiAgICAgICAgICAgIENvbXBhdGliaWxpdHlFeGNlcHRpb24s\nIFVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAgICAgICBMb25nIGxlZGdlckEg\nPSAweGZlYWRlZWZkYWNMOwogICAgICAgIFN0cmluZyB6bm9kZUEgPSBnZXRV\nckxlZGdlclpub2RlKGxlZGdlckEpOwogICAgICAgIExlZGdlclVuZGVycmVw\nbGljYXRpb25NYW5hZ2VyIHJlcGxpY2FNZ3IgPSBsbWYxCiAgICAgICAgICAg\nICAgICAubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAg\nICAgICBmb3IgKFN0cmluZyByZXBsaWNhIDogbWlzc2luZ1JlcGxpY2EpIHsK\nICAgICAgICAgICAgcmVwbGljYU1nci5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNh\ndGVkKGxlZGdlckEsIHJlcGxpY2EpOwogICAgICAgIH0KCiAgICAgICAgU3Ry\naW5nIHVyTGVkZ2VyQSA9IGdldERhdGEoem5vZGVBKTsKICAgICAgICBVbmRl\ncnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQuQnVpbGRlciBidWlsZGVyQSA9IFVu\nZGVycmVwbGljYXRlZExlZGdlckZvcm1hdAogICAgICAgICAgICAgICAgLm5l\nd0J1aWxkZXIoKTsKICAgICAgICBmb3IgKFN0cmluZyByZXBsaWNhIDogbWlz\nc2luZ1JlcGxpY2EpIHsKICAgICAgICAgICAgYnVpbGRlckEuYWRkUmVwbGlj\nYShyZXBsaWNhKTsKICAgICAgICB9CiAgICAgICAgTGlzdDxTdHJpbmc+IHJl\ncGxpY2FMaXN0ID0gYnVpbGRlckEuZ2V0UmVwbGljYUxpc3QoKTsKCiAgICAg\nICAgZm9yIChTdHJpbmcgcmVwbGljYSA6IG1pc3NpbmdSZXBsaWNhKSB7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoIlVyTGVkZ2VyOiIgKyB1ckxlZGdlckEK\nICAgICAgICAgICAgICAgICAgICArICIgZG9lc24ndCBjb250YWluIGZhaWxl\nZCBib29raWUgOiIgKyByZXBsaWNhLCByZXBsaWNhTGlzdAogICAgICAgICAg\nICAgICAgICAgIC5jb250YWlucyhyZXBsaWNhKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgU3RyaW5nIGdldERhdGEoU3RyaW5nIHpub2RlKSB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYnl0ZVtdIGRhdGEgPSB6a2Mx\nLmdldERhdGEoem5vZGUsIGZhbHNlLCBudWxsKTsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTdHJpbmcoZGF0YSk7CiAgICAgICAgfSBjYXRjaCAoS2VlcGVy\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRp\nb24gd2hpbGUgcmVhZGluZyBkYXRhIGZyb20gem5vZGUgOiIgKyB6bm9kZSk7\nCiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSByZWFkaW5n\nIGRhdGEgZnJvbSB6bm9kZSA6IiArIHpub2RlKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuICIiOwoKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBnZXRV\nckxlZGdlclpub2RlKGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICByZXR1cm4g\nWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlci5nZXRVckxlZGdlclpu\nb2RlKHVyTGVkZ2VyUGF0aCwgbGVkZ2VySWQpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCB0YWtlTGVkZ2VyQW5kUmVsZWFzZShmaW5hbCBMZWRnZXJVbmRl\ncnJlcGxpY2F0aW9uTWFuYWdlciBtLAogICAgICAgICAgICBmaW5hbCBDb3Vu\ndERvd25MYXRjaCBsYXRjaCwgaW50IG51bWJlck9mSXRlcmF0aW9ucykgewog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtYmVyT2ZJdGVyYXRpb25z\nOyBpKyspIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxv\nbmcgbGVkZ2VyVG9SZXJlcGxpY2F0ZSA9IG0uZ2V0TGVkZ2VyVG9SZXJlcGxp\nY2F0ZSgpOwogICAgICAgICAgICAgICAgbS5yZWxlYXNlVW5kZXJyZXBsaWNh\ndGVkTGVkZ2VyKGxlZGdlclRvUmVyZXBsaWNhdGUpOwogICAgICAgICAgICB9\nIGNhdGNoIChVbmF2YWlsYWJsZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIlVuYXZhaWxhYmxlRXhjZXB0aW9uIHdoZW4gIgog\nICAgICAgICAgICAgICAgICAgICAgICArICJ0YWtpbmcgb3IgcmVsZWFzaW5n\nIGxvY2siLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXRjaC5j\nb3VudERvd24oKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

