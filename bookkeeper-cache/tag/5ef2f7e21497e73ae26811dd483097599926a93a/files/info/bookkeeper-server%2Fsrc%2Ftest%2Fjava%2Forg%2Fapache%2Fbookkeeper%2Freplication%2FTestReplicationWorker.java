{"sha":"a9010268816a3f202ce0f2c92fa35c899ae762b1","node_id":"MDQ6QmxvYjE1NzU5NTY6YTkwMTAyNjg4MTZhM2YyMDJjZTBmMmM5MmZhMzVjODk5YWU3NjJiMQ==","size":21053,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a9010268816a3f202ce0f2c92fa35c899ae762b1","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgCiAqIG9yIG1vcmUgY29udHJpYnV0b3Ig\nbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZSAKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24gCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUgCiAqIHRvIHlvdSB1bmRlciB0\naGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgCiAqICJMaWNl\nbnNlIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNv\nbXBsaWFuY2UgCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFp\nbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQgCiAqIAogKiAgIGh0dHA6Ly93\nd3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMCAKICogCiAqIFVu\nbGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8g\naW4gd3JpdGluZywgCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRo\nZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIAogKiAiQVMgSVMiIEJB\nU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkg\nCiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhl\nIExpY2Vuc2UgZm9yIHRoZSAKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJu\naW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9ucyAKICogdW5kZXIgdGhl\nIExpY2Vuc2UuIAogKiAKICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnJlcGxpY2F0aW9uOwoKaW1wb3J0IGphdmEubmV0LkluZXRBZGRyZXNz\nOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0\naW9uOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5N\nYXAuRW50cnk7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQ2xpZW50VXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuTGVkZ2VyRW50cnk7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlQWRhcHRlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRn\nZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5tZXRhLkxlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnRlc3QuTXVsdGlMZWRnZXJNYW5hZ2Vy\nVGVzdENhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5C\nb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnV0aWwuWmtVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci56b29rZWVwZXIuWm9vS2VlcGVyV2F0Y2hlckJhc2U7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUZXN0IHRoZSBSZXBsaWNhdGlv\nbldyb2tlciwgd2hlcmUgaXQgaGFzIHRvIHJlcGxpY2F0ZSB0aGUgZnJhZ21l\nbnRzIGZyb20KICogZmFpbGVkIEJvb2tpZXMgdG8gZ2l2ZW4gdGFyZ2V0IEJv\nb2tpZS4KICovCnB1YmxpYyBjbGFzcyBUZXN0UmVwbGljYXRpb25Xb3JrZXIg\nZXh0ZW5kcyBNdWx0aUxlZGdlck1hbmFnZXJUZXN0Q2FzZSB7CgogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgYnl0ZVtdIFRFU1RQQVNTV0QgPSAidGVzdHBh\nc3N3ZCIuZ2V0Qnl0ZXMoKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAgICAgICAgIC5nZXRMb2dn\nZXIoVGVzdFJlcGxpY2F0aW9uV29ya2VyLmNsYXNzKTsKICAgIHByaXZhdGUg\nU3RyaW5nIGJhc2VQYXRoID0gIiI7CiAgICBwcml2YXRlIExlZGdlck1hbmFn\nZXJGYWN0b3J5IG1GYWN0b3J5OwogICAgcHJpdmF0ZSBMZWRnZXJVbmRlcnJl\ncGxpY2F0aW9uTWFuYWdlciB1bmRlclJlcGxpY2F0aW9uTWFuYWdlcjsKICAg\nIHByaXZhdGUgc3RhdGljIGJ5dGVbXSBkYXRhID0gIlRlc3RSZXBsaWNhdGlv\nbldvcmtlciIuZ2V0Qnl0ZXMoKTsKCiAgICBwdWJsaWMgVGVzdFJlcGxpY2F0\naW9uV29ya2VyKFN0cmluZyBsZWRnZXJNYW5hZ2VyRmFjdG9yeSkgewogICAg\nICAgIHN1cGVyKDMpOwogICAgICAgIExPRy5pbmZvKCJSdW5uaW5nIHRlc3Qg\nY2FzZSB1c2luZyBsZWRnZXIgbWFuYWdlciA6ICIKICAgICAgICAgICAgICAg\nICsgbGVkZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgICAgIC8vIHNldCBsZWRn\nZXIgbWFuYWdlciBuYW1lCiAgICAgICAgYmFzZUNvbmYuc2V0TGVkZ2VyTWFu\nYWdlckZhY3RvcnlDbGFzc05hbWUobGVkZ2VyTWFuYWdlckZhY3RvcnkpOwog\nICAgICAgIGJhc2VDbGllbnRDb25mLnNldExlZGdlck1hbmFnZXJGYWN0b3J5\nQ2xhc3NOYW1lKGxlZGdlck1hbmFnZXJGYWN0b3J5KTsKICAgICAgICBiYXNl\nUGF0aCA9IGJhc2VDbGllbnRDb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkg\nKyAnLycKICAgICAgICAgICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5V\nTkRFUl9SRVBMSUNBVElPTl9OT0RFCiAgICAgICAgICAgICAgICArIEJvb2tL\nZWVwZXJDb25zdGFudHMuREVGQVVMVF9aS19MRURHRVJTX1JPT1RfUEFUSDsK\nICAgICAgICBiYXNlQ29uZi5zZXRSZXJlcGxpY2F0aW9uRW50cnlCYXRjaFNp\nemUoMyk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBz\nZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHN1cGVyLnNldFVw\nKCk7CiAgICAgICAgLy8gaW5pdGlhbGl6ZSB1clJlcGxpY2F0aW9uTWFuYWdl\ncgogICAgICAgIG1GYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3\nTGVkZ2VyTWFuYWdlckZhY3RvcnkoYmFzZUNsaWVudENvbmYsCiAgICAgICAg\nICAgICAgICB6a2MpOwogICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2Vy\nID0gbUZhY3RvcnkubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIo\nKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHRlYXJE\nb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIudGVhckRv\nd24oKTsKICAgICAgICBpZihudWxsICE9IG1GYWN0b3J5KXsKICAgICAgICAg\nICAgbUZhY3RvcnkudW5pbml0aWFsaXplKCk7CiAgICAgICAgICAgIG1GYWN0\nb3J5ID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYobnVsbCAhPSB1bmRl\nclJlcGxpY2F0aW9uTWFuYWdlcil7CiAgICAgICAgICAgIHVuZGVyUmVwbGlj\nYXRpb25NYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgICAgIHVuZGVyUmVwbGlj\nYXRpb25NYW5hZ2VyID0gbnVsbDsKICAgICAgICB9CiAgICB9CiAgICAKICAg\nIC8qKgogICAgICogVGVzdHMgdGhhdCByZXBsaWNhdGlvbiB3b3JrZXIgc2hv\ndWxkIHJlcGxpY2F0ZSB0aGUgZmFpbGVkIGJvb2tpZQogICAgICogZnJhZ21l\nbnRzIHRvIHRhcmdldCBib29raWUgZ2l2ZW4gdG8gdGhlIHdvcmtlci4KICAg\nICAqLwogICAgQFRlc3QodGltZW91dCA9IDMwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFJXU2hvdWxkUmVwbGljYXRlRnJhZ21lbnRzVG9UYXJnZXRCb29r\naWUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJIYW5kbGUg\nbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIEJvb2tLZWVwZXIuRGlnZXN0\nVHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgIFRFU1RQQVNTV0QpOwoKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAg\nICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwgPSBMZWRnZXJIYW5kbGVBZGFw\ndGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEobGgpLmdl\ndEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwoKICAgICAgICBMT0cuaW5m\nbygiS2lsbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxsKTsKICAgICAgICBr\naWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICBpbnQgc3RhcnRO\nZXdCb29raWUgPSBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRy\neShkYXRhKTsKICAgICAgICB9CgogICAgICAgIEluZXRTb2NrZXRBZGRyZXNz\nIG5ld0JrQWRkciA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRkcmVz\ncwogICAgICAgICAgICAgICAgLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRy\nZXNzKCksIHN0YXJ0TmV3Qm9va2llKTsKICAgICAgICBMT0cuaW5mbygiTmV3\nIEJvb2tpZSBhZGRyIDoiICsgbmV3QmtBZGRyKTsKCiAgICAgICAgUmVwbGlj\nYXRpb25Xb3JrZXIgcncgPSBuZXcgUmVwbGljYXRpb25Xb3JrZXIoemtjLCBi\nYXNlQ29uZiwgbmV3QmtBZGRyKTsKCiAgICAgICAgcncuc3RhcnQoKTsKICAg\nICAgICB0cnkgewoKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsaC5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgIHJlcGxpY2FUb0tpbGwudG9TdHJpbmcoKSk7Cgog\nICAgICAgICAgICB3aGlsZSAoUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdl\nckluVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxoCiAgICAgICAgICAgICAgICAg\nICAgLmdldElkKCksIGJhc2VQYXRoKSkgewogICAgICAgICAgICAgICAgVGhy\nZWFkLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGtp\nbGxBbGxCb29raWVzKGxoLCBuZXdCa0FkZHIpOwoKICAgICAgICAgICAgLy8g\nU2hvdWxkIGJlIGFibGUgdG8gcmVhZCB0aGUgZW50cmllcyBmcm9tIDAtOQog\nICAgICAgICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxoLCAwLCA5KTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBydy5zaHV0ZG93bigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3RzIHRoYXQg\ncmVwbGljYXRpb24gd29ya2VyIHNob3VsZCByZXRyeSBmb3IgcmVwbGljYXRp\nb24gdW50aWwgZW5vdWdoCiAgICAgKiBib29raWVzIGF2YWlsYWJsZSBmb3Ig\ncmVwbGljYXRpb24KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdFJXU2hvdWxkUmV0cnlVbnRpbFRoZXJl\nQXJlRW5vdWdoQmtzQXZhaWxhYmxlRm9yUmVwbGljYXRpb24oKQogICAgICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJIYW5kbGUg\nbGggPSBia2MuY3JlYXRlTGVkZ2VyKDEsIDEsIEJvb2tLZWVwZXIuRGlnZXN0\nVHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgIFRFU1RQQVNTV0QpOwoKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAg\nICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIGxoLmNs\nb3NlKCk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2ls\nbCA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5nZXRM\nZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQo\nMCk7CiAgICAgICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llIiwgcmVwbGlj\nYVRvS2lsbCk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBraWxsZWRC\nb29raWVDb25maWcgPSBraWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAg\nICAgICBpbnQgc3RhcnROZXdCb29raWUgPSBzdGFydE5ld0Jvb2tpZSgpOwog\nICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIG5ld0JrQWRkciA9IG5ldyBJbmV0\nU29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcwogICAgICAgICAgICAgICAgLmdl\ndExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3Qm9va2ll\nKTsKICAgICAgICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoiICsgbmV3\nQmtBZGRyKTsKCiAgICAgICAga2lsbEFsbEJvb2tpZXMobGgsIG5ld0JrQWRk\ncik7CiAgICAgICAgUmVwbGljYXRpb25Xb3JrZXIgcncgPSBuZXcgUmVwbGlj\nYXRpb25Xb3JrZXIoemtjLCBiYXNlQ29uZiwgbmV3QmtBZGRyKTsKCiAgICAg\nICAgcncuc3RhcnQoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB1bmRl\nclJlcGxpY2F0aW9uTWFuYWdlci5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVk\nKGxoLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgcmVwbGljYVRvS2ls\nbC50b1N0cmluZygpKTsKICAgICAgICAgICAgaW50IGNvdW50ZXIgPSAxMDA7\nCiAgICAgICAgICAgIHdoaWxlIChjb3VudGVyLS0gPiAwKSB7CiAgICAgICAg\nICAgICAgICBhc3NlcnRUcnVlKCJFeHBlY3RpbmcgdGhhdCByZXBsaWNhdGlv\nbiBzaG91bGQgbm90IGNvbXBsZXRlIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNh\ndGlvbih6a2MsIGxoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLmdldElkKCksIGJhc2VQYXRoKSk7CiAgICAgICAgICAgICAgICBUaHJlYWQu\nc2xlZXAoMTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXN0\nYXJ0IGtpbGxlZCBib29raWUKICAgICAgICAgICAgYnMuYWRkKHN0YXJ0Qm9v\na2llKGtpbGxlZEJvb2tpZUNvbmZpZykpOwogICAgICAgICAgICBic0NvbmZz\nLmFkZChraWxsZWRCb29raWVDb25maWcpOwogICAgICAgICAgICB3aGlsZSAo\nUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlv\nbih6a2MsIGxoCiAgICAgICAgICAgICAgICAgICAgLmdldElkKCksIGJhc2VQ\nYXRoKSkgewogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgLy8gU2hvdWxkIGJlIGFibGUgdG8g\ncmVhZCB0aGUgZW50cmllcyBmcm9tIDAtOQogICAgICAgICAgICB2ZXJpZnlS\nZWNvdmVyZWRMZWRnZXJzKGxoLCAwLCA5KTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBydy5zaHV0ZG93bigpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFRlc3RzIHRoYXQgcmVwbGljYXRpb24gd29ya2Vy\nMSBzaG91bGQgdGFrZSBvbmUgZnJhZ21lbnQgcmVwbGljYXRpb24gYW5kCiAg\nICAgKiBvdGhlciByZXBsaWNhdGlvbiB3b3JrZXIgYWxzbyBzaG91bGQgY29t\ncGV0ZSBmb3IgdGhlIHJlcGxpY2F0aW9uLgogICAgICovCiAgICBAVGVzdCh0\naW1lb3V0ID0gOTAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0MlJXc1Nob3Vs\nZENvbXBldGVGb3JSZXBsaWNhdGlvbk9mMkZyYWdtZW50c0FuZENvbXBsZXRl\nUmVwbGljYXRpb24oKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDIs\nIDIsIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAg\nICAgIFRFU1RQQVNTV0QpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIDEwOyBpKyspIHsKICAgICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7CiAg\nICAgICAgfQogICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgSW5ldFNvY2tl\ndEFkZHJlc3MgcmVwbGljYVRvS2lsbCA9IExlZGdlckhhbmRsZUFkYXB0ZXIK\nICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5z\nZW1ibGVzKCkuZ2V0KDBMKS5nZXQoMCk7CiAgICAgICAgTE9HLmluZm8oIktp\nbGxpbmcgQm9va2llIiwgcmVwbGljYVRvS2lsbCk7CiAgICAgICAgU2VydmVy\nQ29uZmlndXJhdGlvbiBraWxsZWRCb29raWVDb25maWcgPSBraWxsQm9va2ll\nKHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICBraWxsQWxsQm9va2llcyhsaCwg\nbnVsbCk7CiAgICAgICAgLy8gU3RhcnRlIFJXMQogICAgICAgIGludCBzdGFy\ndE5ld0Jvb2tpZTEgPSBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIG5ld0JrQWRkcjEgPSBuZXcgSW5ldFNvY2tldEFkZHJl\nc3MoSW5ldEFkZHJlc3MKICAgICAgICAgICAgICAgIC5nZXRMb2NhbEhvc3Qo\nKS5nZXRIb3N0QWRkcmVzcygpLCBzdGFydE5ld0Jvb2tpZTEpOwogICAgICAg\nIExPRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBuZXdCa0FkZHIxKTsK\nICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydzEgPSBuZXcgUmVwbGljYXRp\nb25Xb3JrZXIoemtjLCBiYXNlQ29uZiwgbmV3QmtBZGRyMSk7CgogICAgICAg\nIC8vIFN0YXJ0ZSBSVzIKICAgICAgICBpbnQgc3RhcnROZXdCb29raWUyID0g\nc3RhcnROZXdCb29raWUoKTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBu\nZXdCa0FkZHIyID0gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNz\nCiAgICAgICAgICAgICAgICAuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJl\nc3MoKSwgc3RhcnROZXdCb29raWUyKTsKICAgICAgICBMT0cuaW5mbygiTmV3\nIEJvb2tpZSBhZGRyIDoiICsgbmV3QmtBZGRyMik7CiAgICAgICAgWm9vS2Vl\ncGVyV2F0Y2hlckJhc2UgdyA9IG5ldyBab29LZWVwZXJXYXRjaGVyQmFzZSgx\nMDAwMCk7CiAgICAgICAgWm9vS2VlcGVyIHprYzEgPSBaa1V0aWxzLmNyZWF0\nZUNvbm5lY3RlZFpvb2tlZXBlckNsaWVudCgKICAgICAgICAgICAgICAgIHpr\nVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHcpOwogICAgICAg\nIFJlcGxpY2F0aW9uV29ya2VyIHJ3MiA9IG5ldyBSZXBsaWNhdGlvbldvcmtl\ncih6a2MxLCBiYXNlQ29uZiwKICAgICAgICAgICAgICAgIG5ld0JrQWRkcjIp\nOwogICAgICAgIHJ3MS5zdGFydCgpOwogICAgICAgIHJ3Mi5zdGFydCgpOwoK\nICAgICAgICB0cnkgewogICAgICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFu\nYWdlci5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxoLmdldElkKCksCiAg\nICAgICAgICAgICAgICAgICAgcmVwbGljYVRvS2lsbC50b1N0cmluZygpKTsK\nICAgICAgICAgICAgaW50IGNvdW50ZXIgPSAxMDsKICAgICAgICAgICAgd2hp\nbGUgKGNvdW50ZXItLSA+IDApIHsKICAgICAgICAgICAgICAgIGFzc2VydFRy\ndWUoIkV4cGVjdGluZyB0aGF0IHJlcGxpY2F0aW9uIHNob3VsZCBub3QgY29t\ncGxldGUiLAogICAgICAgICAgICAgICAgICAgICAgICBSZXBsaWNhdGlvblRl\nc3RVdGlsLmlzTGVkZ2VySW5VbmRlclJlcGxpY2F0aW9uKHprYywgbGgKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0SWQoKSwgYmFzZVBh\ndGgpKTsKICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDApOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIC8vIHJlc3RhcnQga2lsbGVkIGJvb2tp\nZQogICAgICAgICAgICBicy5hZGQoc3RhcnRCb29raWUoa2lsbGVkQm9va2ll\nQ29uZmlnKSk7CiAgICAgICAgICAgIGJzQ29uZnMuYWRkKGtpbGxlZEJvb2tp\nZUNvbmZpZyk7CiAgICAgICAgICAgIHdoaWxlIChSZXBsaWNhdGlvblRlc3RV\ndGlsLmlzTGVkZ2VySW5VbmRlclJlcGxpY2F0aW9uKHprYywgbGgKICAgICAg\nICAgICAgICAgICAgICAuZ2V0SWQoKSwgYmFzZVBhdGgpKSB7CiAgICAgICAg\nICAgICAgICBUaHJlYWQuc2xlZXAoMTAwKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICAvLyBTaG91bGQgYmUgYWJsZSB0byByZWFkIHRoZSBlbnRyaWVz\nIGZyb20gMC05CiAgICAgICAgICAgIHZlcmlmeVJlY292ZXJlZExlZGdlcnMo\nbGgsIDAsIDkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJ3\nMS5zaHV0ZG93bigpOwogICAgICAgICAgICBydzIuc2h1dGRvd24oKTsKICAg\nICAgICAgICAgemtjMS5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRlc3RzIHRoYXQgUmVwbGljYXRpb24gd29ya2VyIHNob3Vs\nZCBjbGVhbiB0aGUgbGVhZGdlciB1bmRlciByZXBsaWNhdGlvbgogICAgICog\nbm9kZSBvZiB0aGUgbGVkZ2VyIGFscmVhZHkgZGVsZXRlZAogICAgICovCiAg\nICBAVGVzdCh0aW1lb3V0ID0gMzAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RS\nV1Nob3VsZENsZWFuVGhlTGVkZ2VyRnJvbVVuZGVyUmVwbGljYXRpb25JZkxl\nZGdlckFscmVhZHlEZWxldGVkKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxl\nZGdlcigyLCAyLCBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsCiAgICAg\nICAgICAgICAgICBURVNUUEFTU1dEKTsKCiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRh\ndGEpOwogICAgICAgIH0KICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIElu\nZXRTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwgPSBMZWRnZXJIYW5kbGVB\nZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEobGgp\nLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwogICAgICAgIExPRy5p\nbmZvKCJLaWxsaW5nIEJvb2tpZSIsIHJlcGxpY2FUb0tpbGwpOwogICAgICAg\nIGtpbGxCb29raWUocmVwbGljYVRvS2lsbCk7CgogICAgICAgIGludCBzdGFy\ndE5ld0Jvb2tpZSA9IHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgSW5ldFNv\nY2tldEFkZHJlc3MgbmV3QmtBZGRyID0gbmV3IEluZXRTb2NrZXRBZGRyZXNz\nKEluZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAuZ2V0TG9jYWxIb3N0KCku\nZ2V0SG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29raWUpOwogICAgICAgIExP\nRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBuZXdCa0FkZHIpOwogICAg\nICAgIFJlcGxpY2F0aW9uV29ya2VyIHJ3ID0gbmV3IFJlcGxpY2F0aW9uV29y\na2VyKHprYywgYmFzZUNvbmYsIG5ld0JrQWRkcik7CiAgICAgICAgcncuc3Rh\ncnQoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmtjLmRlbGV0ZUxl\nZGdlcihsaC5nZXRJZCgpKTsgLy8gRGVsZXRpbmcgdGhlIGxlZGdlcgogICAg\nICAgICAgICAvLyBBbHNvIG1hcmsgbGVkZ2VyIGFzIGluIFVuZGVyUmVwbGlj\nYXRpb24KICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFy\na0xlZGdlclVuZGVycmVwbGljYXRlZChsaC5nZXRJZCgpLAogICAgICAgICAg\nICAgICAgICAgIHJlcGxpY2FUb0tpbGwudG9TdHJpbmcoKSk7CiAgICAgICAg\nICAgIHdoaWxlIChSZXBsaWNhdGlvblRlc3RVdGlsLmlzTGVkZ2VySW5VbmRl\nclJlcGxpY2F0aW9uKHprYywgbGgKICAgICAgICAgICAgICAgICAgICAuZ2V0\nSWQoKSwgYmFzZVBhdGgpKSB7CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xl\nZXAoMTAwKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHJ3LnNodXRkb3duKCk7CiAgICAgICAgfQoKICAgIH0KCiAg\nICBAVGVzdCh0aW1lb3V0ID0gNjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nTXVsdGlwbGVMZWRnZXJSZXBsaWNhdGlvbldpdGhSZXBsaWNhdGlvbldvcmtl\ncigpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8v\nIExlZGdlcjEKICAgICAgICBMZWRnZXJIYW5kbGUgbGgxID0gYmtjLmNyZWF0\nZUxlZGdlcigzLCAzLCBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsCiAg\nICAgICAgICAgICAgICBURVNUUEFTU1dEKTsKCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxoMS5hZGRFbnRy\neShkYXRhKTsKICAgICAgICB9CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3Mg\ncmVwbGljYVRvS2lsbEZyb21GaXJzdExlZGdlciA9IExlZGdlckhhbmRsZUFk\nYXB0ZXIKICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaDEp\nLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwoKICAgICAgICBMT0cu\naW5mbygiS2lsbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxsRnJvbUZpcnN0\nTGVkZ2VyKTsKCiAgICAgICAgLy8gTGVkZ2VyMgogICAgICAgIExlZGdlckhh\nbmRsZSBsaDIgPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIEJvb2tLZWVwZXIu\nRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgIFRFU1RQQVNTV0Qp\nOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAg\nICAgICAgICAgbGgyLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAg\nICBJbmV0U29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsRnJvbVNlY29uZExl\nZGdlciA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5n\nZXRMZWRnZXJNZXRhZGF0YShsaDIpLmdldEVuc2VtYmxlcygpLmdldCgwTCku\nZ2V0KDApOwoKICAgICAgICBMT0cuaW5mbygiS2lsbGluZyBCb29raWUiLCBy\nZXBsaWNhVG9LaWxsRnJvbVNlY29uZExlZGdlcik7CgogICAgICAgIC8vIEtp\nbGwgbGVkZ2VyMQogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbEZy\nb21GaXJzdExlZGdlcik7CiAgICAgICAgbGgxLmNsb3NlKCk7CiAgICAgICAg\nLy8gS2lsbCBsZWRnZXIyCiAgICAgICAga2lsbEJvb2tpZShyZXBsaWNhVG9L\naWxsRnJvbUZpcnN0TGVkZ2VyKTsKICAgICAgICBsaDIuY2xvc2UoKTsKCiAg\nICAgICAgaW50IHN0YXJ0TmV3Qm9va2llID0gc3RhcnROZXdCb29raWUoKTsK\nCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgbmV3QmtBZGRyID0gbmV3IElu\nZXRTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAu\nZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29r\naWUpOwogICAgICAgIExPRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBu\nZXdCa0FkZHIpOwoKICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydyA9IG5l\ndyBSZXBsaWNhdGlvbldvcmtlcih6a2MsIGJhc2VDb25mLCBuZXdCa0FkZHIp\nOwoKICAgICAgICBydy5zdGFydCgpOwogICAgICAgIHRyeSB7CgogICAgICAg\nICAgICAvLyBNYXJrIGxlZGdlcjEgYW5kIDIgYXMgdW5kZXJyZXBsaWNhdGVk\nCiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLm1hcmtMZWRn\nZXJVbmRlcnJlcGxpY2F0ZWQobGgxLmdldElkKCksCiAgICAgICAgICAgICAg\nICAgICAgcmVwbGljYVRvS2lsbEZyb21GaXJzdExlZGdlci50b1N0cmluZygp\nKTsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFya0xl\nZGdlclVuZGVycmVwbGljYXRlZChsaDIuZ2V0SWQoKSwKICAgICAgICAgICAg\nICAgICAgICByZXBsaWNhVG9LaWxsRnJvbVNlY29uZExlZGdlci50b1N0cmlu\nZygpKTsKCiAgICAgICAgICAgIHdoaWxlIChSZXBsaWNhdGlvblRlc3RVdGls\nLmlzTGVkZ2VySW5VbmRlclJlcGxpY2F0aW9uKHprYywgbGgxCiAgICAgICAg\nICAgICAgICAgICAgLmdldElkKCksIGJhc2VQYXRoKSkgewogICAgICAgICAg\nICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHdoaWxlIChSZXBsaWNhdGlvblRlc3RVdGlsLmlzTGVkZ2VySW5V\nbmRlclJlcGxpY2F0aW9uKHprYywgbGgyCiAgICAgICAgICAgICAgICAgICAg\nLmdldElkKCksIGJhc2VQYXRoKSkgewogICAgICAgICAgICAgICAgVGhyZWFk\nLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGtpbGxB\nbGxCb29raWVzKGxoMSwgbmV3QmtBZGRyKTsKCiAgICAgICAgICAgIC8vIFNo\nb3VsZCBiZSBhYmxlIHRvIHJlYWQgdGhlIGVudHJpZXMgZnJvbSAwLTkKICAg\nICAgICAgICAgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaDEsIDAsIDkpOwog\nICAgICAgICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxoMiwgMCwgOSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcncuc2h1dGRvd24o\nKTsKICAgICAgICB9CgogICAgfQogICAgCiAgICAvKioKICAgICAqIFRlc3Rz\nIHRoYXQgUmVwbGljYXRpb25Xb3JrZXIgc2hvdWxkIGZlbmNlIHRoZSBsZWRn\nZXIgYW5kIHJlbGVhc2UgbGVkZ2VyCiAgICAgKiBsb2NrIGFmdGVyIHRpbWVv\ndXQuIFRoZW4gcmVwbGljYXRpb24gc2hvdWxkIGhhcHBlbiBub3JtYWxseS4K\nICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdFJXU2hvdWxkUmVwbGljYXRlVGhlTGVkZ2Vyc0FmdGVyVGlt\nZW91dElmTGFzdEZyYWdtZW50SXNVUigpCiAgICAgICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVh\ndGVMZWRnZXIoMywgMywgQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMyLAog\nICAgICAgICAgICAgICAgVEVTVFBBU1NXRCk7CgogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRy\neShkYXRhKTsKICAgICAgICB9CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3Mg\ncmVwbGljYVRvS2lsbCA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAg\nICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5zZW1ibGVzKCku\nZ2V0KDBMKS5nZXQoMCk7CgogICAgICAgIExPRy5pbmZvKCJLaWxsaW5nIEJv\nb2tpZSIsIHJlcGxpY2FUb0tpbGwpOwogICAgICAgIGtpbGxCb29raWUocmVw\nbGljYVRvS2lsbCk7CgogICAgICAgIGludCBzdGFydE5ld0Jvb2tpZSA9IHN0\nYXJ0TmV3Qm9va2llKCk7CgogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIG5l\nd0JrQWRkciA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcwog\nICAgICAgICAgICAgICAgLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNz\nKCksIHN0YXJ0TmV3Qm9va2llKTsKICAgICAgICBMT0cuaW5mbygiTmV3IEJv\nb2tpZSBhZGRyIDoiICsgbmV3QmtBZGRyKTsKCiAgICAgICAgUmVwbGljYXRp\nb25Xb3JrZXIgcncgPSBuZXcgUmVwbGljYXRpb25Xb3JrZXIoemtjLCBiYXNl\nQ29uZiwgbmV3QmtBZGRyKTsKCiAgICAgICAgTGVkZ2VyTWFuYWdlckZhY3Rv\ncnkgbUZhY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeQogICAgICAgICAg\nICAgICAgLm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGJhc2VDbGllbnRDb25m\nLCB6a2MpOwogICAgICAgIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2Vy\nIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyID0gbUZhY3RvcnkKICAgICAgICAg\nICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwog\nICAgICAgIHJ3LnN0YXJ0KCk7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAg\nIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLm1hcmtMZWRnZXJVbmRlcnJlcGxp\nY2F0ZWQobGguZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICByZXBsaWNh\nVG9LaWxsLnRvU3RyaW5nKCkpOwogICAgICAgICAgICB3aGlsZSAoUmVwbGlj\nYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlvbih6a2Ms\nIGxoCiAgICAgICAgICAgICAgICAgICAgLmdldElkKCksIGJhc2VQYXRoKSkg\newogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAga2lsbEFsbEJvb2tpZXMobGgsIG5ld0JrQWRk\ncik7CiAgICAgICAgICAgIC8vIFNob3VsZCBiZSBhYmxlIHRvIHJlYWQgdGhl\nIGVudHJpZXMgZnJvbSAwLTkKICAgICAgICAgICAgdmVyaWZ5UmVjb3ZlcmVk\nTGVkZ2VycyhsaCwgMCwgOSk7CiAgICAgICAgICAgIGxoID0gYmtjLm9wZW5M\nZWRnZXJOb1JlY292ZXJ5KGxoLmdldElkKCksCiAgICAgICAgICAgICAgICAg\nICAgQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMyLCBURVNUUEFTU1dEKTsK\nICAgICAgICAgICAgYXNzZXJ0RmFsc2UoIkxlZGdlciBtdXN0IGhhdmUgYmVl\nbiBjbG9zZWQgYnkgUlciLCBDbGllbnRVdGlsCiAgICAgICAgICAgICAgICAg\nICAgLmlzTGVkZ2VyT3BlbihsaCkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHJ3LnNodXRkb3duKCk7CiAgICAgICAgICAgIHVuZGVyUmVw\nbGljYXRpb25NYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgfQoKICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3RzIHRoYXQgUmVwbGljYXRpb25Xb3JrZXIgc2hv\ndWxkIG5vdCBoYXZlIGlkZW50aWZpZWQgZm9yIHBvc3Rwb25pbmcKICAgICAq\nIHRoZSByZXBsaWNhdGlvbiBpZiBsZWRnZXIgaXMgaW4gb3BlbiBzdGF0ZSBh\nbmQgbGFzdEZyYWdtZW50IGlzIG5vdCBpbgogICAgICogdW5kZXJSZXBsaWNh\ndGlvbiBzdGF0ZS4gTm90ZSB0aGF0IFJXIHNob3VsZCBub3QgZmVuY2Ugc3Vj\naCBsZWRnZXJzLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gMzAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0UldTaG91bGRSZXBsaWNhdGVUaGVMZWRn\nZXJzQWZ0ZXJUaW1lb3V0SWZMYXN0RnJhZ21lbnRJc05vdFVSKCkKICAgICAg\nICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFuZGxl\nIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBCb29rS2VlcGVyLkRpZ2Vz\ndFR5cGUuQ1JDMzIsCiAgICAgICAgICAgICAgICBURVNUUEFTU1dEKTsKCiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAg\nICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAgICBJbmV0\nU29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsID0gTGVkZ2VySGFuZGxlQWRh\ncHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxoKS5n\nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKCiAgICAgICAgTE9HLmlu\nZm8oIktpbGxpbmcgQm9va2llIiwgcmVwbGljYVRvS2lsbCk7CiAgICAgICAg\na2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsKTsKCiAgICAgICAgaW50IHN0YXJ0\nTmV3Qm9va2llID0gc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAgLy8gUmVm\nb3JtIGVuc2VtYmxlLi4uTWFraW5nIHN1cmUgdGhhdCBsYXN0IGZyYWdtZW50\nIGlzIG5vdCBpbgogICAgICAgIC8vIHVuZGVyLXJlcGxpY2F0aW9uCiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAg\nIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgSW5ldFNv\nY2tldEFkZHJlc3MgbmV3QmtBZGRyID0gbmV3IEluZXRTb2NrZXRBZGRyZXNz\nKEluZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAuZ2V0TG9jYWxIb3N0KCku\nZ2V0SG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29raWUpOwogICAgICAgIExP\nRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBuZXdCa0FkZHIpOwoKICAg\nICAgICBSZXBsaWNhdGlvbldvcmtlciBydyA9IG5ldyBSZXBsaWNhdGlvbldv\ncmtlcih6a2MsIGJhc2VDb25mLCBuZXdCa0FkZHIpOwoKICAgICAgICBMZWRn\nZXJNYW5hZ2VyRmFjdG9yeSBtRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0\nb3J5CiAgICAgICAgICAgICAgICAubmV3TGVkZ2VyTWFuYWdlckZhY3Rvcnko\nYmFzZUNsaWVudENvbmYsIHprYyk7CiAgICAgICAgTGVkZ2VyVW5kZXJyZXBs\naWNhdGlvbk1hbmFnZXIgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIgPSBtRmFj\ndG9yeQogICAgICAgICAgICAgICAgLm5ld0xlZGdlclVuZGVycmVwbGljYXRp\nb25NYW5hZ2VyKCk7CgogICAgICAgIHJ3LnN0YXJ0KCk7CiAgICAgICAgdHJ5\nIHsKCiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLm1hcmtM\nZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGguZ2V0SWQoKSwKICAgICAgICAgICAg\nICAgICAgICByZXBsaWNhVG9LaWxsLnRvU3RyaW5nKCkpOwogICAgICAgICAg\nICB3aGlsZSAoUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJS\nZXBsaWNhdGlvbih6a2MsIGxoCiAgICAgICAgICAgICAgICAgICAgLmdldElk\nKCksIGJhc2VQYXRoKSkgewogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVw\nKDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGtpbGxBbGxCb29r\naWVzKGxoLCBuZXdCa0FkZHIpOwoKICAgICAgICAgICAgLy8gU2hvdWxkIGJl\nIGFibGUgdG8gcmVhZCB0aGUgZW50cmllcyBmcm9tIDAtOQogICAgICAgICAg\nICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxoLCAwLCA5KTsKICAgICAgICAg\nICAgbGggPSBia2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGguZ2V0SWQoKSwK\nICAgICAgICAgICAgICAgICAgICBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JD\nMzIsIFRFU1RQQVNTV0QpOwoKICAgICAgICAgICAgLy8gTGVkZ2VyIHNob3Vs\nZCBiZSBzdGlsbCBpbiBvcGVuIHN0YXRlCiAgICAgICAgICAgIGFzc2VydFRy\ndWUoIkxlZGdlciBtdXN0IGhhdmUgYmVlbiBjbG9zZWQgYnkgUlciLCBDbGll\nbnRVdGlsCiAgICAgICAgICAgICAgICAgICAgLmlzTGVkZ2VyT3BlbihsaCkp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJ3LnNodXRkb3du\nKCk7CiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmNsb3Nl\nKCk7CiAgICAgICAgfQoKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhh\ndCB0aGUgcmVwbGljYXRpb24gd29ya2VyIHdpbGwgc2h1dGRvd24gaWYgaXQg\nbG9zZSBpdHMgem9va2VlcGVyIHNlc3Npb24KICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD0zMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSV1pLU2Vzc2lv\nbkxvc3QoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBab29LZWVwZXJX\nYXRjaGVyQmFzZSB3ID0gbmV3IFpvb0tlZXBlcldhdGNoZXJCYXNlKDEwMDAw\nKTsKICAgICAgICBab29LZWVwZXIgemsgPSBaa1V0aWxzLmNyZWF0ZUNvbm5l\nY3RlZFpvb2tlZXBlckNsaWVudCgKICAgICAgICAgICAgICAgIHprVXRpbC5n\nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHcpOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydyA9IG5ldyBSZXBs\naWNhdGlvbldvcmtlcih6aywgYmFzZUNvbmYsIGdldEJvb2tpZSgwKSk7CiAg\nICAgICAgICAgIHJ3LnN0YXJ0KCk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHJ3Lmlz\nUnVubmluZygpKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAw\nMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiUmVw\nbGljYXRpb24gd29ya2VyIHNob3VsZCBiZSBydW5uaW5nIiwgcncuaXNSdW5u\naW5nKCkpOwogICAgICAgICAgICBzdG9wWktDbHVzdGVyKCk7CgogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmICghcncuaXNSdW5uaW5nKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBhc3NlcnRGYWxzZSgiUmVwbGljYXRpb24gd29ya2VyIHNob3VsZCBoYXZl\nIHNodXQgZG93biIsIHJ3LmlzUnVubmluZygpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICB6ay5jbG9zZSgpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQga2lsbEFsbEJvb2tpZXMoTGVkZ2VySGFuZGxl\nIGxoLCBJbmV0U29ja2V0QWRkcmVzcyBleGNsdWRlQkspCiAgICAgICAgICAg\nIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gS2ls\nbGluZyBhbGwgYm9va2llcyBleGNlcHQgbmV3bHkgcmVwbGljYXRlZCBib29r\naWUKICAgICAgICBTZXQ8RW50cnk8TG9uZywgQXJyYXlMaXN0PEluZXRTb2Nr\nZXRBZGRyZXNzPj4+IGVudHJ5U2V0ID0gTGVkZ2VySGFuZGxlQWRhcHRlcgog\nICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxoKS5nZXRFbnNl\nbWJsZXMoKS5lbnRyeVNldCgpOwogICAgICAgIGZvciAoRW50cnk8TG9uZywg\nQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPj4gZW50cnkgOiBlbnRyeVNl\ndCkgewogICAgICAgICAgICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+\nIGJvb2tpZXMgPSBlbnRyeS5nZXRWYWx1ZSgpOwogICAgICAgICAgICBmb3Ig\nKEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZSA6IGJvb2tpZXMpIHsKICAgICAg\nICAgICAgICAgIGlmIChib29raWUuZXF1YWxzKGV4Y2x1ZGVCSykpIHsKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGtpbGxCb29raWUoYm9va2llKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgdmVyaWZ5\nUmVjb3ZlcmVkTGVkZ2VycyhMZWRnZXJIYW5kbGUgbGgsIGxvbmcgc3RhcnRF\nbnRyeUlkLAogICAgICAgICAgICBsb25nIGVuZEVudHJ5SWQpIHRocm93cyBC\nS0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIExl\nZGdlckhhbmRsZSBsaHMgPSBia2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGgu\nZ2V0SWQoKSwKICAgICAgICAgICAgICAgIEJvb2tLZWVwZXIuRGlnZXN0VHlw\nZS5DUkMzMiwgVEVTVFBBU1NXRCk7CiAgICAgICAgRW51bWVyYXRpb248TGVk\nZ2VyRW50cnk+IGVudHJpZXMgPSBsaHMucmVhZEVudHJpZXMoc3RhcnRFbnRy\neUlkLAogICAgICAgICAgICAgICAgZW5kRW50cnlJZCk7CiAgICAgICAgYXNz\nZXJ0VHJ1ZSgiU2hvdWxkIGhhdmUgdGhlIGVsZW1lbnRzIiwgZW50cmllcy5o\nYXNNb3JlRWxlbWVudHMoKSk7CiAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFz\nTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgTGVkZ2VyRW50cnkgZW50\ncnkgPSBlbnRyaWVzLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgIGFzc2Vy\ndEVxdWFscygiVGVzdFJlcGxpY2F0aW9uV29ya2VyIiwgbmV3IFN0cmluZyhl\nbnRyeS5nZXRFbnRyeSgpKSk7CiAgICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

