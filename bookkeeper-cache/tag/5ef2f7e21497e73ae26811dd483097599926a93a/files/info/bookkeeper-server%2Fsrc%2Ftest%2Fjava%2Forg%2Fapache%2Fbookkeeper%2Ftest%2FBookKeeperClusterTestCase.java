{"sha":"deb97414b66ca03a1e4bea13dde2e85510777c05","node_id":"MDQ6QmxvYjE1NzU5NTY6ZGViOTc0MTRiNjZjYTAzYTFlNGJlYTEzZGRlMmU4NTUxMDc3N2MwNQ==","size":19282,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/deb97414b66ca03a1e4bea13dde2e85510777c05","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0\nLkluZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5NYXAuRW50cnk7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3Vu\ndERvd25MYXRjaDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdENhc2U7\nCgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWU7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQm9va0tlZXBlclRlc3RDbGllbnQ7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY29uZi5BYnN0cmFjdENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhc3Rv\ncmUuSW5NZW1vcnlNZXRhU3RvcmU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucHJvdG8uQm9va2llU2VydmVyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnJlcGxpY2F0aW9uLkF1dG9SZWNvdmVyeU1haW47CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRp\nb25FeGNlcHRpb24uQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4\nY2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuY29tbW9ucy5pby5GaWxlVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLnpv\nb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpv\nb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuanVuaXQuQWZ0ZXI7Cmlt\ncG9ydCBvcmcuanVuaXQuQmVmb3JlOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\ncjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIEEg\nY2xhc3MgcnVucyBzZXZlcmFsIGJvb2tpZSBzZXJ2ZXJzIGZvciB0ZXN0aW5n\nLgogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIEJvb2tLZWVwZXJDbHVzdGVy\nVGVzdENhc2UgZXh0ZW5kcyBUZXN0Q2FzZSB7CgogICAgc3RhdGljIGZpbmFs\nIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihCb29rS2Vl\ncGVyQ2x1c3RlclRlc3RDYXNlLmNsYXNzKTsKCiAgICAvLyBab29LZWVwZXIg\ncmVsYXRlZCB2YXJpYWJsZXMKICAgIHByb3RlY3RlZCBab29LZWVwZXJVdGls\nIHprVXRpbCA9IG5ldyBab29LZWVwZXJVdGlsKCk7CiAgICBwcm90ZWN0ZWQg\nWm9vS2VlcGVyIHprYzsKCiAgICAvLyBCb29rS2VlcGVyIHJlbGF0ZWQgdmFy\naWFibGVzCiAgICBwcm90ZWN0ZWQgTGlzdDxGaWxlPiB0bXBEaXJzID0gbmV3\nIExpbmtlZExpc3Q8RmlsZT4oKTsKICAgIHByb3RlY3RlZCBMaXN0PEJvb2tp\nZVNlcnZlcj4gYnMgPSBuZXcgTGlua2VkTGlzdDxCb29raWVTZXJ2ZXI+KCk7\nCiAgICBwcm90ZWN0ZWQgTGlzdDxTZXJ2ZXJDb25maWd1cmF0aW9uPiBic0Nv\nbmZzID0gbmV3IExpbmtlZExpc3Q8U2VydmVyQ29uZmlndXJhdGlvbj4oKTsK\nICAgIHByb3RlY3RlZCBpbnQgbnVtQm9va2llczsKICAgIHByb3RlY3RlZCBC\nb29rS2VlcGVyVGVzdENsaWVudCBia2M7CgogICAgcHJvdGVjdGVkIFNlcnZl\nckNvbmZpZ3VyYXRpb24gYmFzZUNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJh\ndGlvbigpOwogICAgcHJvdGVjdGVkIENsaWVudENvbmZpZ3VyYXRpb24gYmFz\nZUNsaWVudENvbmYgPSBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpOwoKICAg\nIHByaXZhdGUgTWFwPEJvb2tpZVNlcnZlciwgQXV0b1JlY292ZXJ5TWFpbj4g\nYXV0b1JlY292ZXJ5UHJvY2Vzc2VzID0gbmV3IEhhc2hNYXA8Qm9va2llU2Vy\ndmVyLCBBdXRvUmVjb3ZlcnlNYWluPigpOwoKICAgIHByaXZhdGUgYm9vbGVh\nbiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQ7CgogICAgcHVibGljIEJvb2tLZWVw\nZXJDbHVzdGVyVGVzdENhc2UoaW50IG51bUJvb2tpZXMpIHsKICAgICAgICB0\naGlzLm51bUJvb2tpZXMgPSBudW1Cb29raWVzOwogICAgfQoKICAgIEBCZWZv\ncmUKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiU2V0dGluZyB1cCB0\nZXN0IHt9IiwgZ2V0TmFtZSgpKTsKICAgICAgICBJbk1lbW9yeU1ldGFTdG9y\nZS5yZXNldCgpOwogICAgICAgIHNldE1ldGFzdG9yZUltcGxDbGFzcyhiYXNl\nQ29uZik7CiAgICAgICAgc2V0TWV0YXN0b3JlSW1wbENsYXNzKGJhc2VDbGll\nbnRDb25mKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gc3RhcnQg\nem9va2VlcGVyIHNlcnZpY2UKICAgICAgICAgICAgc3RhcnRaS0NsdXN0ZXIo\nKTsKICAgICAgICAgICAgLy8gc3RhcnQgYm9va2tlZXBlciBzZXJ2aWNlCiAg\nICAgICAgICAgIHN0YXJ0QktDbHVzdGVyKCk7CiAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBz\nZXR0aW5nIHVwIiwgZSk7CiAgICAgICAgICAgIHRocm93IGU7CiAgICAgICAg\nfQogICAgfQoKICAgIEBBZnRlcgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExP\nRy5pbmZvKCJUZWFyRG93biIpOwogICAgICAgIC8vIHN0b3AgYm9va2tlZXBl\nciBzZXJ2aWNlCiAgICAgICAgc3RvcEJLQ2x1c3RlcigpOwogICAgICAgIC8v\nIHN0b3Agem9va2VlcGVyIHNlcnZpY2UKICAgICAgICBzdG9wWktDbHVzdGVy\nKCk7CiAgICAgICAgTE9HLmluZm8oIlRlYXJpbmcgZG93biB0ZXN0IHt9Iiwg\nZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXJ0IHpvb2tl\nZXBlciBjbHVzdGVyCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24K\nICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgc3RhcnRaS0NsdXN0ZXIoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB6a1V0aWwuc3RhcnRTZXJ2ZXIo\nKTsKICAgICAgICB6a2MgPSB6a1V0aWwuZ2V0Wm9vS2VlcGVyQ2xpZW50KCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9wIHpvb2tlZXBlciBjbHVzdGVy\nCiAgICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc3RvcFpLQ2x1c3RlcigpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIHprVXRpbC5raWxsU2VydmVyKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTdGFydCBjbHVzdGVyLiBBbHNvLCBzdGFydHMgdGhlIGF1\ndG8gcmVjb3ZlcnkgcHJvY2VzcyBmb3IgZWFjaCBib29raWUsIGlmCiAgICAg\nKiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQgaXMgdHJ1ZS4KICAgICAqCiAgICAg\nKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9p\nZCBzdGFydEJLQ2x1c3RlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIGJhc2VDbGllbnRDb25mLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2Vl\ncGVyQ29ubmVjdFN0cmluZygpKTsKICAgICAgICBpZiAobnVtQm9va2llcyA+\nIDApIHsKICAgICAgICAgICAgYmtjID0gbmV3IEJvb2tLZWVwZXJUZXN0Q2xp\nZW50KGJhc2VDbGllbnRDb25mKTsKICAgICAgICB9CgogICAgICAgIC8vIENy\nZWF0ZSBCb29raWUgU2VydmVycyAoQjEsIEIyLCBCMykKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bUJvb2tpZXM7IGkrKykgewogICAgICAgICAg\nICBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFN0b3AgY2x1c3Rlci4gQWxzbywgc3RvcHMgYWxsIHRoZSBhdXRv\nIHJlY292ZXJ5IHByb2Nlc3NlcyBmb3IgdGhlIGJvb2tpZQogICAgICogY2x1\nc3RlciwgaWYgaXNBdXRvUmVjb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAgICAg\nKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgcHJvdGVj\ndGVkIHZvaWQgc3RvcEJLQ2x1c3RlcigpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIGlmIChia2MgIT0gbnVsbCkgewogICAgICAgICAgICBia2MuY2xv\nc2UoKTs7CiAgICAgICAgfQoKICAgICAgICBmb3IgKEJvb2tpZVNlcnZlciBz\nZXJ2ZXIgOiBicykgewogICAgICAgICAgICBzZXJ2ZXIuc2h1dGRvd24oKTsK\nICAgICAgICAgICAgQXV0b1JlY292ZXJ5TWFpbiBhdXRvUmVjb3ZlcnkgPSBh\ndXRvUmVjb3ZlcnlQcm9jZXNzZXMuZ2V0KHNlcnZlcik7CiAgICAgICAgICAg\nIGlmIChhdXRvUmVjb3ZlcnkgIT0gbnVsbCAmJiBpc0F1dG9SZWNvdmVyeUVu\nYWJsZWQoKSkgewogICAgICAgICAgICAgICAgYXV0b1JlY292ZXJ5LnNodXRk\nb3duKCk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlNodXRkb3duIGF1\ndG8gcmVjb3ZlcnkgZm9yIGJvb2tpZXNlcnZlcjoiCiAgICAgICAgICAgICAg\nICAgICAgICAgICsgc2VydmVyLmdldExvY2FsQWRkcmVzcygpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBicy5jbGVhcigpOwogICAgICAg\nIGZvciAoRmlsZSBmIDogdG1wRGlycykgewogICAgICAgICAgICBGaWxlVXRp\nbHMuZGVsZXRlRGlyZWN0b3J5KGYpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncm90ZWN0ZWQgU2VydmVyQ29uZmlndXJhdGlvbiBuZXdTZXJ2ZXJDb25maWd1\ncmF0aW9uKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIGYg\nPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAidGVzdCIpOwogICAg\nICAgIHRtcERpcnMuYWRkKGYpOwogICAgICAgIGYuZGVsZXRlKCk7CiAgICAg\nICAgZi5ta2RpcigpOwoKICAgICAgICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2Vy\nLm5leHRGcmVlUG9ydCgpOwogICAgICAgIHJldHVybiBuZXdTZXJ2ZXJDb25m\naWd1cmF0aW9uKHBvcnQsIHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3Ry\naW5nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZiwgbmV3IEZpbGVbXSB7IGYgfSk7CiAgICB9CgogICAgcHJvdGVjdGVkIFNl\ncnZlckNvbmZpZ3VyYXRpb24gbmV3U2VydmVyQ29uZmlndXJhdGlvbihpbnQg\ncG9ydCwgU3RyaW5nIHprU2VydmVycywgRmlsZSBqb3VybmFsRGlyLCBGaWxl\nW10gbGVkZ2VyRGlycykgewogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKGJhc2VDb25mKTsKICAg\nICAgICBjb25mLnNldEJvb2tpZVBvcnQocG9ydCk7CiAgICAgICAgY29uZi5z\nZXRaa1NlcnZlcnMoemtTZXJ2ZXJzKTsKICAgICAgICBjb25mLnNldEpvdXJu\nYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKTsKICAgICAgICBTdHJp\nbmdbXSBsZWRnZXJEaXJOYW1lcyA9IG5ldyBTdHJpbmdbbGVkZ2VyRGlycy5s\nZW5ndGhdOwogICAgICAgIGZvciAoaW50IGk9MDsgaTxsZWRnZXJEaXJzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxlZGdlckRpck5hbWVzW2ldID0g\nbGVkZ2VyRGlyc1tpXS5nZXRQYXRoKCk7CiAgICAgICAgfQogICAgICAgIGNv\nbmYuc2V0TGVkZ2VyRGlyTmFtZXMobGVkZ2VyRGlyTmFtZXMpOwogICAgICAg\nIHJldHVybiBjb25mOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGJvb2tp\nZSBhZGRyZXNzIGZvciBib29raWUgYXQgaW5kZXgKICAgICAqLwogICAgcHVi\nbGljIEluZXRTb2NrZXRBZGRyZXNzIGdldEJvb2tpZShpbnQgaW5kZXgpIHRo\ncm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gewogICAgICAgIGlmIChi\ncy5zaXplKCkgPD0gaW5kZXggfHwgaW5kZXggPCAwKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIkludmFsaWQg\naW5kZXgsIHRoZXJlIGFyZSBvbmx5ICIgKyBicy5zaXplKCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgYm9v\na2llcy4gQXNrZWQgZm9yICIgKyBpbmRleCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBicy5nZXQoaW5kZXgpLmdldExvY2FsQWRkcmVzcygpOwogICAg\nfQoKICAgIC8qKgogICAgICogS2lsbCBhIGJvb2tpZSBieSBpdHMgc29ja2V0\nIGFkZHJlc3MuIEFsc28sIHN0b3BzIHRoZSBhdXRvcmVjb3ZlcnkgcHJvY2Vz\ncwogICAgICogZm9yIHRoZSBjb3JyZXNwb25kaW5nIGJvb2tpZSBzZXJ2ZXIs\nIGlmIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBpcyB0cnVlLgogICAgICoKICAg\nICAqIEBwYXJhbSBhZGRyCiAgICAgKiAgICAgICAgICAgIFNvY2tldCBBZGRy\nZXNzCiAgICAgKiBAcmV0dXJuIHRoZSBjb25maWd1cmF0aW9uIG9mIGtpbGxl\nZCBib29raWUKICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24K\nICAgICAqLwogICAgcHVibGljIFNlcnZlckNvbmZpZ3VyYXRpb24ga2lsbEJv\nb2tpZShJbmV0U29ja2V0QWRkcmVzcyBhZGRyKSB0aHJvd3MgSW50ZXJydXB0\nZWRFeGNlcHRpb24gewogICAgICAgIEJvb2tpZVNlcnZlciB0b1JlbW92ZSA9\nIG51bGw7CiAgICAgICAgaW50IHRvUmVtb3ZlSW5kZXggPSAwOwogICAgICAg\nIGZvciAoQm9va2llU2VydmVyIHNlcnZlciA6IGJzKSB7CiAgICAgICAgICAg\nIGlmIChzZXJ2ZXIuZ2V0TG9jYWxBZGRyZXNzKCkuZXF1YWxzKGFkZHIpKSB7\nCiAgICAgICAgICAgICAgICBzZXJ2ZXIuc2h1dGRvd24oKTsKICAgICAgICAg\nICAgICAgIHRvUmVtb3ZlID0gc2VydmVyOwogICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgKyt0b1JlbW92ZUluZGV4\nOwogICAgICAgIH0KICAgICAgICBpZiAodG9SZW1vdmUgIT0gbnVsbCkgewog\nICAgICAgICAgICBzdG9wQXV0b1JlY292ZXJ5U2VydmljZSh0b1JlbW92ZSk7\nCiAgICAgICAgICAgIGJzLnJlbW92ZSh0b1JlbW92ZSk7CiAgICAgICAgICAg\nIHJldHVybiBic0NvbmZzLnJlbW92ZSh0b1JlbW92ZUluZGV4KTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBLaWxsIGEgYm9va2llIGJ5IGluZGV4LiBBbHNvLCBzdG9wcyB0aGUgcmVz\ncGVjdGl2ZSBhdXRvIHJlY292ZXJ5IHByb2Nlc3MKICAgICAqIGZvciB0aGlz\nIGJvb2tpZSwgaWYgaXNBdXRvUmVjb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAg\nICAgKgogICAgICogQHBhcmFtIGluZGV4CiAgICAgKiAgICAgICAgICAgIEJv\nb2tpZSBJbmRleAogICAgICogQHJldHVybiB0aGUgY29uZmlndXJhdGlvbiBv\nZiBraWxsZWQgYm9va2llCiAgICAgKiBAdGhyb3dzIEludGVycnVwdGVkRXhj\nZXB0aW9uCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAg\nIHB1YmxpYyBTZXJ2ZXJDb25maWd1cmF0aW9uIGtpbGxCb29raWUoaW50IGlu\nZGV4KSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIElPRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoaW5kZXggPj0gYnMuc2l6ZSgpKSB7CiAgICAgICAg\nICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiQm9va2llIGRvZXMgbm90IGV4\naXN0Iik7CiAgICAgICAgfQogICAgICAgIEJvb2tpZVNlcnZlciBzZXJ2ZXIg\nPSBicy5nZXQoaW5kZXgpOwogICAgICAgIHNlcnZlci5zaHV0ZG93bigpOwog\nICAgICAgIHN0b3BBdXRvUmVjb3ZlcnlTZXJ2aWNlKHNlcnZlcik7CiAgICAg\nICAgYnMucmVtb3ZlKHNlcnZlcik7CiAgICAgICAgcmV0dXJuIGJzQ29uZnMu\ncmVtb3ZlKGluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNsZWVwIGEg\nYm9va2llCiAgICAgKgogICAgICogQHBhcmFtIGFkZHIKICAgICAqICAgICAg\nICAgIFNvY2tldCBBZGRyZXNzCiAgICAgKiBAcGFyYW0gc2Vjb25kcwogICAg\nICogICAgICAgICAgU2xlZXAgc2Vjb25kcwogICAgICogQHJldHVybiBDb3Vu\ndCBEb3duIGxhdGNoIHdoaWNoIHdpbGwgYmUgY291bnRlZCBkb3duIHdoZW4g\nc2xlZXAgZmluaXNoZXMKICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwogICAg\ncHVibGljIENvdW50RG93bkxhdGNoIHNsZWVwQm9va2llKEluZXRTb2NrZXRB\nZGRyZXNzIGFkZHIsIGZpbmFsIGludCBzZWNvbmRzKQogICAgICAgICAgICB0\naHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAg\nICAgICBmb3IgKGZpbmFsIEJvb2tpZVNlcnZlciBib29raWUgOiBicykgewog\nICAgICAgICAgICBpZiAoYm9va2llLmdldExvY2FsQWRkcmVzcygpLmVxdWFs\ncyhhZGRyKSkgewogICAgICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0\nY2ggbCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICAgICAgICAg\nIFRocmVhZCBzbGVlcGVyID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9v\na2llLnN1c3BlbmRQcm9jZXNzaW5nKCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoc2Vjb25kcyoxMDAwKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29raWUucmVzdW1lUHJv\nY2Vzc2luZygpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkVycm9yIHN1c3BlbmRpbmcgYm9va2llIiwgZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAg\nICAgICAgc2xlZXBlci5zdGFydCgpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKCJCb29raWUgbm90IGZvdW5kIik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTbGVlcCBhIGJvb2tpZSB1bnRpbCBJIGNvdW50IGRvd24g\ndGhlIGxhdGNoCiAgICAgKgogICAgICogQHBhcmFtIGFkZHIKICAgICAqICAg\nICAgICAgIFNvY2tldCBBZGRyZXNzCiAgICAgKiBAcGFyYW0gbGF0Y2gKICAg\nICAqICAgICAgICAgIExhdGNoIHRvIHdhaXQgb24KICAgICAqIEB0aHJvd3Mg\nSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRp\nb24KICAgICAqLwogICAgcHVibGljIHZvaWQgc2xlZXBCb29raWUoSW5ldFNv\nY2tldEFkZHJlc3MgYWRkciwgZmluYWwgQ291bnREb3duTGF0Y2ggbCkKICAg\nICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgZm9yIChmaW5hbCBCb29raWVTZXJ2ZXIgYm9va2ll\nIDogYnMpIHsKICAgICAgICAgICAgaWYgKGJvb2tpZS5nZXRMb2NhbEFkZHJl\nc3MoKS5lcXVhbHMoYWRkcikpIHsKICAgICAgICAgICAgICAgIFRocmVhZCBz\nbGVlcGVyID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29raWUuc3VzcGVu\nZFByb2Nlc3NpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwu\nYXdhaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2tpZS5y\nZXN1bWVQcm9jZXNzaW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkVycm9yIHN1c3BlbmRpbmcgYm9va2llIiwgZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgc2xlZXBl\nci5zdGFydCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigi\nQm9va2llIG5vdCBmb3VuZCIpOwogICAgfQoKICAgIC8qKgogICAgICogUmVz\ndGFydCBib29raWUgc2VydmVycy4gQWxzbyByZXN0YXJ0cyBhbGwgdGhlIHJl\nc3BlY3RpdmUgYXV0byByZWNvdmVyeQogICAgICogcHJvY2VzcywgaWYgaXNB\ndXRvUmVjb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAgICAgKgogICAgICogQHRo\ncm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgogICAgICogQHRocm93cyBJT0V4\nY2VwdGlvbgogICAgICogQHRocm93cyBLZWVwZXJFeGNlcHRpb24KICAgICAq\nIEB0aHJvd3MgQm9va2llRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHJlc3RhcnRCb29raWVzKCkKICAgICAgICAgICAgdGhyb3dzIEludGVy\ncnVwdGVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9u\nLAogICAgICAgICAgICBCb29raWVFeGNlcHRpb24sIFVuYXZhaWxhYmxlRXhj\nZXB0aW9uLCBDb21wYXRpYmlsaXR5RXhjZXB0aW9uIHsKICAgICAgICByZXN0\nYXJ0Qm9va2llcyhudWxsKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlc3Rh\ncnQgYm9va2llIHNlcnZlcnMgdXNpbmcgbmV3IGNvbmZpZ3VyYXRpb24gc2V0\ndGluZ3MuIEFsc28gcmVzdGFydCB0aGUKICAgICAqIHJlc3BlY3RpdmUgYXV0\nbyByZWNvdmVyeSBwcm9jZXNzLCBpZiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQg\naXMgdHJ1ZS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmV3Q29uZgogICAgICog\nICAgICAgICAgICBOZXcgQ29uZmlndXJhdGlvbiBTZXR0aW5ncwogICAgICog\nQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgogICAgICogQHRocm93cyBJ\nT0V4Y2VwdGlvbgogICAgICogQHRocm93cyBLZWVwZXJFeGNlcHRpb24KICAg\nICAqIEB0aHJvd3MgQm9va2llRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHJlc3RhcnRCb29raWVzKFNlcnZlckNvbmZpZ3VyYXRpb24gbmV3\nQ29uZikKICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9u\nLCBJT0V4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uLAogICAgICAgICAgICBC\nb29raWVFeGNlcHRpb24sIFVuYXZhaWxhYmxlRXhjZXB0aW9uLCBDb21wYXRp\nYmlsaXR5RXhjZXB0aW9uIHsKICAgICAgICAvLyBzaHV0IGRvd24gYm9va2ll\nIHNlcnZlcgogICAgICAgIGZvciAoQm9va2llU2VydmVyIHNlcnZlciA6IGJz\nKSB7CiAgICAgICAgICAgIHNlcnZlci5zaHV0ZG93bigpOwogICAgICAgICAg\nICBzdG9wQXV0b1JlY292ZXJ5U2VydmljZShzZXJ2ZXIpOwogICAgICAgIH0K\nICAgICAgICBicy5jbGVhcigpOwogICAgICAgIFRocmVhZC5zbGVlcCgxMDAw\nKTsKICAgICAgICAvLyByZXN0YXJ0IHRoZW0gdG8gZW5zdXJlIHdlIGNhbid0\nCiAgICAgICAgaW50IGogPSAwOwogICAgICAgIGZvciAoU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mIDogYnNDb25mcykgewogICAgICAgICAgICBpZiAobnVs\nbCAhPSBuZXdDb25mKSB7CiAgICAgICAgICAgICAgICBjb25mLmxvYWRDb25m\nKG5ld0NvbmYpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJzLmFkZChz\ndGFydEJvb2tpZShjb25mKSk7CiAgICAgICAgICAgIGorKzsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHN0YXJ0\ndXAgYSBuZXcgYm9va2llIHNlcnZlciB3aXRoIHRoZSBpbmRpY2F0ZWQgcG9y\ndAogICAgICogbnVtYmVyLiBBbHNvLCBzdGFydHMgdGhlIGF1dG8gcmVjb3Zl\ncnkgcHJvY2VzcywgaWYgdGhlCiAgICAgKiBpc0F1dG9SZWNvdmVyeUVuYWJs\nZWQgaXMgc2V0IHRydWUuCiAgICAgKgogICAgICogQHBhcmFtIHBvcnQKICAg\nICAqICAgICAgICAgICAgUG9ydCB0byBzdGFydCB0aGUgbmV3IGJvb2tpZSBz\nZXJ2ZXIgb24KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwog\nICAgcHVibGljIGludCBzdGFydE5ld0Jvb2tpZSgpCiAgICAgICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEtlZXBl\nckV4Y2VwdGlvbiwKICAgICAgICAgICAgQm9va2llRXhjZXB0aW9uLCBVbmF2\nYWlsYWJsZUV4Y2VwdGlvbiwgQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiB7CiAg\nICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3U2VydmVyQ29u\nZmlndXJhdGlvbigpOwogICAgICAgIGJzQ29uZnMuYWRkKGNvbmYpOwogICAg\nICAgIGJzLmFkZChzdGFydEJvb2tpZShjb25mKSk7CgogICAgICAgIHJldHVy\nbiBjb25mLmdldEJvb2tpZVBvcnQoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEhlbHBlciBtZXRob2QgdG8gc3RhcnR1cCBhIGJvb2tpZSBzZXJ2ZXIgdXNp\nbmcgYSBjb25maWd1cmF0aW9uIG9iamVjdC4KICAgICAqIEFsc28sIHN0YXJ0\ncyB0aGUgYXV0byByZWNvdmVyeSBwcm9jZXNzIGlmIGlzQXV0b1JlY292ZXJ5\nRW5hYmxlZCBpcyB0cnVlLgogICAgICoKICAgICAqIEBwYXJhbSBjb25mCiAg\nICAgKiAgICAgICAgICAgIFNlcnZlciBDb25maWd1cmF0aW9uIE9iamVjdAog\nICAgICoKICAgICAqLwogICAgcHJvdGVjdGVkIEJvb2tpZVNlcnZlciBzdGFy\ndEJvb2tpZShTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEtl\nZXBlckV4Y2VwdGlvbiwKICAgICAgICAgICAgQm9va2llRXhjZXB0aW9uLCBV\nbmF2YWlsYWJsZUV4Y2VwdGlvbiwgQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiB7\nCiAgICAgICAgQm9va2llU2VydmVyIHNlcnZlciA9IG5ldyBCb29raWVTZXJ2\nZXIoY29uZik7CiAgICAgICAgc2VydmVyLnN0YXJ0KCk7CgogICAgICAgIGlu\ndCBwb3J0ID0gY29uZi5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgd2hpbGUo\nYmtjLmdldFprSGFuZGxlKCkuZXhpc3RzKCIvbGVkZ2Vycy9hdmFpbGFibGUv\nIiArIEluZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNz\nKCkgKyAiOiIgKyBwb3J0LCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAgICAg\nICBUaHJlYWQuc2xlZXAoNTAwKTsKICAgICAgICB9CgogICAgICAgIGJrYy5y\nZWFkQm9va2llc0Jsb2NraW5nKCk7CiAgICAgICAgTE9HLmluZm8oIk5ldyBi\nb29raWUgb24gcG9ydCAiICsgcG9ydCArICIgaGFzIGJlZW4gY3JlYXRlZC4i\nKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RhcnRBdXRvUmVjb3Zl\ncnkoc2VydmVyLCBjb25mKTsKICAgICAgICB9IGNhdGNoIChDb21wYXRpYmls\naXR5RXhjZXB0aW9uIGNlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXhj\nZXB0aW9uIHdoaWxlIHN0YXJ0aW5nIEF1dG9SZWNvdmVyeSEiLCBjZSk7CiAg\nICAgICAgfSBjYXRjaCAoVW5hdmFpbGFibGVFeGNlcHRpb24gdWUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gd2hpbGUgc3RhcnRpbmcg\nQXV0b1JlY292ZXJ5ISIsIHVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHNlcnZlcjsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXJ0IGEgYm9va2ll\nIHdpdGggdGhlIGdpdmVuIGJvb2tpZSBpbnN0YW5jZS4gQWxzbywgc3RhcnRz\nIHRoZSBhdXRvCiAgICAgKiByZWNvdmVyeSBmb3IgdGhpcyBib29raWUsIGlm\nIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBpcyB0cnVlLgogICAgICovCiAgICBw\ncm90ZWN0ZWQgQm9va2llU2VydmVyIHN0YXJ0Qm9va2llKFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiwgZmluYWwgQm9va2llIGIpCiAgICAgICAgICAgIHRo\ncm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEtlZXBl\nckV4Y2VwdGlvbiwKICAgICAgICAgICAgQm9va2llRXhjZXB0aW9uLCBVbmF2\nYWlsYWJsZUV4Y2VwdGlvbiwgQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiB7CiAg\nICAgICAgQm9va2llU2VydmVyIHNlcnZlciA9IG5ldyBCb29raWVTZXJ2ZXIo\nY29uZikgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHJv\ndGVjdGVkIEJvb2tpZSBuZXdCb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBj\nb25mKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYjsKICAgICAgICAgICAg\nfQogICAgICAgIH07CiAgICAgICAgc2VydmVyLnN0YXJ0KCk7CgogICAgICAg\nIGludCBwb3J0ID0gY29uZi5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgd2hp\nbGUoYmtjLmdldFprSGFuZGxlKCkuZXhpc3RzKCIvbGVkZ2Vycy9hdmFpbGFi\nbGUvIiArIEluZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRy\nZXNzKCkgKyAiOiIgKyBwb3J0LCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAg\nICAgICBUaHJlYWQuc2xlZXAoNTAwKTsKICAgICAgICB9CgogICAgICAgIGJr\nYy5yZWFkQm9va2llc0Jsb2NraW5nKCk7CiAgICAgICAgTE9HLmluZm8oIk5l\ndyBib29raWUgb24gcG9ydCAiICsgcG9ydCArICIgaGFzIGJlZW4gY3JlYXRl\nZC4iKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBzdGFydEF1dG9SZWNv\ndmVyeShzZXJ2ZXIsIGNvbmYpOwogICAgICAgIH0gY2F0Y2ggKENvbXBhdGli\naWxpdHlFeGNlcHRpb24gY2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJF\neGNlcHRpb24gd2hpbGUgc3RhcnRpbmcgQXV0b1JlY292ZXJ5ISIsIGNlKTsK\nICAgICAgICB9IGNhdGNoIChVbmF2YWlsYWJsZUV4Y2VwdGlvbiB1ZSkgewog\nICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSBzdGFydGlu\nZyBBdXRvUmVjb3ZlcnkhIiwgdWUpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gc2VydmVyOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1ldGFzdG9y\nZUltcGxDbGFzcyhBYnN0cmFjdENvbmZpZ3VyYXRpb24gY29uZikgewogICAg\nICAgIGNvbmYuc2V0TWV0YXN0b3JlSW1wbENsYXNzKEluTWVtb3J5TWV0YVN0\nb3JlLmNsYXNzLmdldE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBG\nbGFncyB1c2VkIHRvIGVuYWJsZS9kaXNhYmxlIHRoZSBhdXRvIHJlY292ZXJ5\nIHByb2Nlc3MuIElmIGl0IGlzIGVuYWJsZWQsCiAgICAgKiBzdGFydGluZyB0\naGUgYm9va2llIHNlcnZlciB3aWxsIHN0YXJ0cyB0aGUgYXV0byByZWNvdmVy\neSBwcm9jZXNzIGZvciB0aGF0CiAgICAgKiBib29raWUuIEFsc28sIHN0b3Bw\naW5nIGJvb2tpZSB3aWxsIHN0b3BzIHRoZSByZXNwZWN0aXZlIGF1dG8gcmVj\nb3ZlcnkKICAgICAqIHByb2Nlc3MuCiAgICAgKgogICAgICogQHBhcmFtIGlz\nQXV0b1JlY292ZXJ5RW5hYmxlZAogICAgICogICAgICAgICAgICBWYWx1ZSB0\ncnVlIHdpbGwgZW5hYmxlIHRoZSBhdXRvIHJlY292ZXJ5IHByb2Nlc3MuIFZh\nbHVlIGZhbHNlCiAgICAgKiAgICAgICAgICAgIHdpbGwgZGlzYWJsZSB0aGUg\nYXV0byByZWNvdmVyeSBwcm9jZXNzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHNldEF1dG9SZWNvdmVyeUVuYWJsZWQoYm9vbGVhbiBpc0F1dG9SZWNvdmVy\neUVuYWJsZWQpIHsKICAgICAgICB0aGlzLmlzQXV0b1JlY292ZXJ5RW5hYmxl\nZCA9IGlzQXV0b1JlY292ZXJ5RW5hYmxlZDsKICAgIH0KCiAgICAvKioKICAg\nICAqIEZsYWcgdXNlZCB0byBjaGVjayB3aGV0aGVyIGF1dG8gcmVjb3Zlcnkg\ncHJvY2VzcyBpcyBlbmFibGVkL2Rpc2FibGVkLiBCeQogICAgICogZGVmYXVs\ndCB0aGUgZmxhZyBpcyBmYWxzZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRy\ndWUsIGlmIHRoZSBhdXRvIHJlY292ZXJ5IGlzIGVuYWJsZWQuIE90aGVyd2lz\nZSByZXR1cm4gZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlz\nQXV0b1JlY292ZXJ5RW5hYmxlZCgpIHsKICAgICAgICByZXR1cm4gaXNBdXRv\nUmVjb3ZlcnlFbmFibGVkOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzdGFy\ndEF1dG9SZWNvdmVyeShCb29raWVTZXJ2ZXIgYnNlcnZlciwKICAgICAgICAg\nICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKSB0aHJvd3MgQ29tcGF0aWJp\nbGl0eUV4Y2VwdGlvbiwKICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uLCBJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgSU9FeGNlcHRpb24sCiAgICAgICAgICAg\nIFVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAgICAgICBpZiAoaXNBdXRvUmVj\nb3ZlcnlFbmFibGVkKCkpIHsKICAgICAgICAgICAgQXV0b1JlY292ZXJ5TWFp\nbiBhdXRvUmVjb3ZlcnlQcm9jZXNzID0gbmV3IEF1dG9SZWNvdmVyeU1haW4o\nY29uZik7CiAgICAgICAgICAgIGF1dG9SZWNvdmVyeVByb2Nlc3Muc3RhcnQo\nKTsKICAgICAgICAgICAgYXV0b1JlY292ZXJ5UHJvY2Vzc2VzLnB1dChic2Vy\ndmVyLCBhdXRvUmVjb3ZlcnlQcm9jZXNzKTsKICAgICAgICAgICAgTE9HLmRl\nYnVnKCJTdGFydGluZyBBdWRpdG9yIFJlY292ZXJ5IGZvciB0aGUgYm9va2ll\nOiIKICAgICAgICAgICAgICAgICAgICArIGJzZXJ2ZXIuZ2V0TG9jYWxBZGRy\nZXNzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc3Rv\ncEF1dG9SZWNvdmVyeVNlcnZpY2UoQm9va2llU2VydmVyIHRvUmVtb3ZlKSB7\nCiAgICAgICAgQXV0b1JlY292ZXJ5TWFpbiBhdXRvUmVjb3ZlcnlNYWluID0g\nYXV0b1JlY292ZXJ5UHJvY2Vzc2VzCiAgICAgICAgICAgICAgICAucmVtb3Zl\nKHRvUmVtb3ZlKTsKICAgICAgICBpZiAobnVsbCAhPSBhdXRvUmVjb3ZlcnlN\nYWluICYmIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCgpKSB7CiAgICAgICAgICAg\nIGF1dG9SZWNvdmVyeU1haW4uc2h1dGRvd24oKTsKICAgICAgICAgICAgTE9H\nLmRlYnVnKCJTaHV0ZG93biBhdXRvIHJlY292ZXJ5IGZvciBib29raWVzZXJ2\nZXI6IgogICAgICAgICAgICAgICAgICAgICsgdG9SZW1vdmUuZ2V0TG9jYWxB\nZGRyZXNzKCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdp\nbGwgc3RhcnRzIHRoZSBhdXRvIHJlY292ZXJ5IHByb2Nlc3MgZm9yIHRoZSBi\nb29raWUgc2VydmVycy4gT25lIGF1dG8KICAgICAqIHJlY292ZXJ5IHByb2Nl\nc3MgcGVyIGVhY2ggYm9va2llIHNlcnZlciwgaWYgaXNBdXRvUmVjb3ZlcnlF\nbmFibGVkIGlzCiAgICAgKiBlbmFibGVkLgogICAgICoKICAgICAqIEB0aHJv\nd3MgQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbgogICAgICogICAgICAgICAgICAg\nLSBDb21wYXRpYmlsaXR5IGVycm9yCiAgICAgKiBAdGhyb3dzIEtlZXBlckV4\nY2VwdGlvbgogICAgICogICAgICAgICAgICAgLSBaSyBleGNlcHRpb24KICAg\nICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqICAgICAg\nICAgICAgIC0gaW50ZXJydXB0ZWQgZXhjZXB0aW9uCiAgICAgKiBAdGhyb3dz\nIElPRXhjZXB0aW9uCiAgICAgKiAgICAgICAgICAgICAtIElPRXhjZXB0aW9u\nCiAgICAgKiBAdGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uCiAgICAgKiAg\nICAgICAgICAgICAtIHJlcGxpY2F0aW9uIHNlcnZpY2UgaGFzIGJlY29tZSB1\nbmF2YWlsYWJsZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzdGFydFJlcGxp\nY2F0aW9uU2VydmljZSgpIHRocm93cyBDb21wYXRpYmlsaXR5RXhjZXB0aW9u\nLAogICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhj\nZXB0aW9uLCBJT0V4Y2VwdGlvbiwKICAgICAgICAgICAgVW5hdmFpbGFibGVF\neGNlcHRpb24gewogICAgICAgIGludCBpbmRleCA9IC0xOwogICAgICAgIGZv\nciAoQm9va2llU2VydmVyIGJzZXJ2ZXIgOiBicykgewogICAgICAgICAgICBz\ndGFydEF1dG9SZWNvdmVyeShic2VydmVyLCBic0NvbmZzLmdldCgrK2luZGV4\nKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogV2lsbCBzdG9w\ncyBhbGwgdGhlIGF1dG8gcmVjb3ZlcnkgcHJvY2Vzc2VzIGZvciB0aGUgYm9v\na2llIGNsdXN0ZXIsIGlmCiAgICAgKiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQg\naXMgdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZvaWQgc3RvcFJlcGxpY2F0\naW9uU2VydmljZSgpIHsKICAgICAgICBpZihmYWxzZSA9PSBpc0F1dG9SZWNv\ndmVyeUVuYWJsZWQoKSl7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCiAgICAgICAgZm9yIChFbnRyeTxCb29raWVTZXJ2ZXIsIEF1dG9SZWNvdmVy\neU1haW4+IGF1dG9SZWNvdmVyeVByb2Nlc3MgOiBhdXRvUmVjb3ZlcnlQcm9j\nZXNzZXMKICAgICAgICAgICAgICAgIC5lbnRyeVNldCgpKSB7CiAgICAgICAg\nICAgIGF1dG9SZWNvdmVyeVByb2Nlc3MuZ2V0VmFsdWUoKS5zaHV0ZG93bigp\nOwogICAgICAgICAgICBMT0cuZGVidWcoIlNodXRkb3duIEF1ZGl0b3IgUmVj\nb3ZlcnkgZm9yIHRoZSBib29raWU6IgogICAgICAgICAgICAgICAgICAgICsg\nYXV0b1JlY292ZXJ5UHJvY2Vzcy5nZXRLZXkoKS5nZXRMb2NhbEFkZHJlc3Mo\nKSk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

