{"sha":"d3149eb1aa96f67153af36c43ad3d85dfaab34eb","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDMxNDllYjFhYTk2ZjY3MTUzYWYzNmM0M2FkM2Q4NWRmYWFiMzRlYg==","size":13739,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d3149eb1aa96f67153af36c43ad3d85dfaab34eb","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdDsKCi8qCiAqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBz\nb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4\ncHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAq\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQg\nbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAqLwoKaW1w\nb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5CeXRl\nQnVmZmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGph\ndmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5SYW5kb207\nCmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVw\nZXJUZXN0Q2xpZW50OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNs\naWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5E\naWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkJvb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5qdW5pdC5C\nZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKCi8qKgogKiBUaGlzIHRl\nc3QgdGVzdHMgcmVhZCBhbmQgd3JpdGUsIHN5bmNocm9ub3VzIGFuZCBhc3lu\nY2hyb25vdXMsIHN0cmluZ3MgYW5kCiAqIGludGVnZXJzIGZvciBhIEJvb2tL\nZWVwZXIgY2xpZW50LiBUaGUgdGVzdCBkZXBsb3ltZW50IHVzZXMgYSBab29L\nZWVwZXIgc2VydmVyCiAqIGFuZCB0aHJlZSBCb29rS2VlcGVycy4KICoKICov\nCgpwdWJsaWMgY2xhc3MgQm9va2llRmFpbHVyZVRlc3QgZXh0ZW5kcyBNdWx0\naUxlZGdlck1hbmFnZXJNdWx0aURpZ2VzdFRlc3RDYXNlCiAgICBpbXBsZW1l\nbnRzIEFkZENhbGxiYWNrLCBSZWFkQ2FsbGJhY2sgewoKICAgIC8vIERlcGVu\nZGluZyBvbiB0aGUgdGFzdGUsIHNlbGVjdCB0aGUgYW1vdW50IG9mIGxvZ2dp\nbmcKICAgIC8vIGJ5IGRlY29tbWVudGluZyBvbmUgb2YgdGhlIHR3byBsaW5l\ncyBiZWxvdwogICAgLy8gc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXIuZ2V0\nUm9vdExvZ2dlcigpOwogICAgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihCb29raWVGYWlsdXJlVGVzdC5jbGFzcyk7Cgog\nICAgYnl0ZVtdIGxlZGdlclBhc3N3b3JkID0gImFhYSIuZ2V0Qnl0ZXMoKTsK\nICAgIExlZGdlckhhbmRsZSBsaCwgbGgyOwogICAgbG9uZyBsZWRnZXJJZDsK\nCiAgICAvLyB0ZXN0IHJlbGF0ZWQgdmFyaWFibGVzCiAgICBpbnQgbnVtRW50\ncmllc1RvV3JpdGUgPSAyMDA7CiAgICBpbnQgbWF4SW50ID0gMjE0NzQ4MzY0\nNzsKICAgIFJhbmRvbSBybmc7IC8vIFJhbmRvbSBOdW1iZXIgR2VuZXJhdG9y\nCiAgICBBcnJheUxpc3Q8Ynl0ZVtdPiBlbnRyaWVzOyAvLyBnZW5lcmF0ZWQg\nZW50cmllcwogICAgQXJyYXlMaXN0PEludGVnZXI+IGVudHJpZXNTaXplOwog\nICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwoKICAgIGNsYXNzIFN5bmNPYmog\newogICAgICAgIGludCBjb3VudGVyOwogICAgICAgIGJvb2xlYW4gdmFsdWU7\nCiAgICAgICAgYm9vbGVhbiBmYWlsdXJlT2NjdXJyZWQ7CiAgICAgICAgRW51\nbWVyYXRpb248TGVkZ2VyRW50cnk+IGxzOwoKICAgICAgICBwdWJsaWMgU3lu\nY09iaigpIHsKICAgICAgICAgICAgY291bnRlciA9IDA7CiAgICAgICAgICAg\nIHZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIGZhaWx1cmVPY2N1cnJlZCA9\nIGZhbHNlOwogICAgICAgICAgICBscyA9IG51bGw7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBCb29raWVGYWlsdXJlVGVzdChTdHJpbmcgbGVkZ2Vy\nTWFuYWdlckZhY3RvcnksIERpZ2VzdFR5cGUgZGlnZXN0VHlwZSkgewogICAg\nICAgIHN1cGVyKDQpOwogICAgICAgIHRoaXMuZGlnZXN0VHlwZSA9IGRpZ2Vz\ndFR5cGU7CiAgICAgICAgLy8gc2V0IGxlZGdlciBtYW5hZ2VyCiAgICAgICAg\nYmFzZUNvbmYuc2V0TGVkZ2VyTWFuYWdlckZhY3RvcnlDbGFzc05hbWUobGVk\nZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgICAgIGJhc2VDbGllbnRDb25mLnNl\ndExlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKGxlZGdlck1hbmFnZXJG\nYWN0b3J5KTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3RzIHdyaXRlcyBh\nbmQgcmVhZHMgd2hlbiBhIGJvb2tpZSBmYWlscy4KICAgICAqCiAgICAgKiBA\ndGhyb3dzIHtAbGluayBJT0V4Y2VwdGlvbn0KICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RBc3luY0JLMSgp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgTE9HLmluZm8oIiMjIyMg\nQksxICMjIyMiKTsKICAgICAgICBhdXhUZXN0UmVhZFdyaXRlQXN5bmNTaW5n\nbGVDbGllbnQoYnMuZ2V0KDApKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEFzeW5jQksyKCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiIyMjIyBCSzIgIyMj\nIyIpOwogICAgICAgIGF1eFRlc3RSZWFkV3JpdGVBc3luY1NpbmdsZUNsaWVu\ndChicy5nZXQoMSkpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0QXN5bmNCSzMoKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIExPRy5pbmZvKCIjIyMjIEJLMyAjIyMjIik7CiAg\nICAgICAgYXV4VGVzdFJlYWRXcml0ZUFzeW5jU2luZ2xlQ2xpZW50KGJzLmdl\ndCgyKSk7CiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RBc3luY0JLNCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgTE9HLmluZm8oIiMjIyMgQks0ICMjIyMiKTsKICAgICAgICBh\ndXhUZXN0UmVhZFdyaXRlQXN5bmNTaW5nbGVDbGllbnQoYnMuZ2V0KDMpKTsK\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEJvb2tpZVJlY292ZXJ5KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy9TaHV0ZG93biBhbGwgYnV0IDEgYm9va2llCiAgICAgICAgYnMu\nZ2V0KDApLnNodXRkb3duKCk7CiAgICAgICAgYnMuZ2V0KDEpLnNodXRkb3du\nKCk7CiAgICAgICAgYnMuZ2V0KDIpLnNodXRkb3duKCk7CgogICAgICAgIGJ5\ndGVbXSBwYXNzd2QgPSAiYmxhaCIuZ2V0Qnl0ZXMoKTsKICAgICAgICBMZWRn\nZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDEsIDEsZGlnZXN0VHlw\nZSwgcGFzc3dkKTsKCiAgICAgICAgaW50IG51bUVudHJpZXMgPSAxMDA7CiAg\nICAgICAgZm9yIChpbnQgaT0wOyBpPCBudW1FbnRyaWVzOyBpKyspIHsKICAg\nICAgICAgICAgYnl0ZVtdIGRhdGEgPSAoIiIraSkuZ2V0Qnl0ZXMoKTsKICAg\nICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQoKICAgICAg\nICBicy5nZXQoMykuc2h1dGRvd24oKTsKICAgICAgICBCb29raWVTZXJ2ZXIg\nc2VydmVyID0gbmV3IEJvb2tpZVNlcnZlcihic0NvbmZzLmdldCgzKSk7CiAg\nICAgICAgc2VydmVyLnN0YXJ0KCk7CiAgICAgICAgYnMuc2V0KDMsIHNlcnZl\ncik7CgogICAgICAgIGFzc2VydEVxdWFscyhudW1FbnRyaWVzIC0gMSAsIGxo\nLmdldExhc3RBZGRDb25maXJtZWQoKSk7CiAgICAgICAgRW51bWVyYXRpb248\nTGVkZ2VyRW50cnk+IGVudHJpZXMgPSBsaC5yZWFkRW50cmllcygwLCBsaC5n\nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwoKICAgICAgICBpbnQgbnVtU2Nhbm5l\nZCA9IDA7CiAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFzTW9yZUVsZW1lbnRz\nKCkpIHsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCgiIitudW1TY2FubmVk\nKSwgbmV3IFN0cmluZyhlbnRyaWVzLm5leHRFbGVtZW50KCkuZ2V0RW50cnko\nKSkpOwogICAgICAgICAgICBudW1TY2FubmVkKys7CiAgICAgICAgfQogICAg\nICAgIGFzc2VydEVxdWFscyhudW1FbnRyaWVzLCBudW1TY2FubmVkKTsKICAg\nIH0KCiAgICB2b2lkIGF1eFRlc3RSZWFkV3JpdGVBc3luY1NpbmdsZUNsaWVu\ndChCb29raWVTZXJ2ZXIgYnMpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgU3luY09iaiBzeW5jID0gbmV3IFN5bmNPYmooKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAg\nbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDIsIGRpZ2VzdFR5cGUsIGxlZGdl\nclBhc3N3b3JkKTsKCiAgICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQo\nKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdl\ndElkKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVu\ndHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZm\nZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAg\nICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAg\nICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CgogICAgICAgICAgICAg\nICAgZW50cmllcy5hZGQoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgICAg\nICBlbnRyaWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAg\nICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShlbnRyeS5hcnJheSgpLCB0\naGlzLCBzeW5jKTsKCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5p\nbmZvKCJXcm90ZSAiICsgbnVtRW50cmllc1RvV3JpdGUgKyAiIGFuZCBub3cg\nZ29pbmcgdG8gZmFpbCBib29raWUuIik7CiAgICAgICAgICAgIC8vIEJvb2tp\nZSBmYWlsCiAgICAgICAgICAgIGJzLnNodXRkb3duKCk7CgogICAgICAgICAg\nICAvLyB3YWl0IGZvciBhbGwgZW50cmllcyB0byBiZSBhY2tub3dsZWRnZWQK\nICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAg\nICAgICB3aGlsZSAoc3luYy5jb3VudGVyIDwgbnVtRW50cmllc1RvV3JpdGUp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkVudHJpZXMgY291\nbnRlciA9ICIgKyBzeW5jLmNvdW50ZXIpOwogICAgICAgICAgICAgICAgICAg\nIHN5bmMud2FpdCgxMDAwMCk7CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0\nRmFsc2UoIkZhaWx1cmUgb2NjdXJyZWQgZHVyaW5nIHdyaXRlIiwgc3luYy5m\nYWlsdXJlT2NjdXJyZWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICBMT0cuZGVidWcoIioqKiBXUklURSBDT01QTEVU\nRSAqKioiKTsKICAgICAgICAgICAgLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAg\nICAgIGxoLmNsb3NlKCk7CgogICAgICAgICAgICAvLyAqKiogV1JJVElORyBQ\nQVJUIENPTVBMRVRFIC8vIFJFQUQgUEFSVCBCRUdJTlMgKioqCgogICAgICAg\nICAgICAvLyBvcGVuIGxlZGdlcgogICAgICAgICAgICBia2MuY2xvc2UoKTsK\nICAgICAgICAgICAgYmtjID0gbmV3IEJvb2tLZWVwZXJUZXN0Q2xpZW50KGJh\nc2VDbGllbnRDb25mKTsKICAgICAgICAgICAgbGggPSBia2Mub3BlbkxlZGdl\ncihsZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAg\nICAgICAgICBMT0cuZGVidWcoIk51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW46\nICIgKyAobGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpICsgMSkpOwogICAgICAg\nICAgICBhc3NlcnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVudHJpZXMg\nd3JpdHRlbiIsIGxoLmdldExhc3RBZGRDb25maXJtZWQoKSA9PSAobnVtRW50\ncmllc1RvV3JpdGUgLSAxKSk7CgogICAgICAgICAgICAvLyByZWFkIGVudHJp\nZXMKCiAgICAgICAgICAgIGxoLmFzeW5jUmVhZEVudHJpZXMoMCwgbnVtRW50\ncmllc1RvV3JpdGUgLSAxLCB0aGlzLCBzeW5jKTsKCiAgICAgICAgICAgIHN5\nbmNocm9uaXplZCAoc3luYykgewogICAgICAgICAgICAgICAgd2hpbGUgKHN5\nbmMudmFsdWUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgICBzeW5j\nLndhaXQoMTAwMDApOwogICAgICAgICAgICAgICAgICAgIGFzc2VydFRydWUo\nIkhhdmVuJ3QgcmVjZWl2ZWQgZW50cmllcyIsIHN5bmMudmFsdWUpOwogICAg\nICAgICAgICAgICAgICAgIGFzc2VydEZhbHNlKCJGYWlsdXJlIG9jY3VycmVk\nIGR1cmluZyByZWFkIiwgc3luYy5mYWlsdXJlT2NjdXJyZWQpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBMT0cuZGVi\ndWcoIioqKiBSRUFEIENPTVBMRVRFICoqKiIpOwoKICAgICAgICAgICAgLy8g\nYXQgdGhpcyBwb2ludCwgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGxzIGlz\nIGZpbGxlZCB3aXRoIHRoZSByZXR1cm5lZAogICAgICAgICAgICAvLyB2YWx1\nZXMKICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAgICB3aGlsZSAo\nc3luYy5scy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAg\nQnl0ZUJ1ZmZlciBvcmlnYmIgPSBCeXRlQnVmZmVyLndyYXAoZW50cmllcy5n\nZXQoaSkpOwogICAgICAgICAgICAgICAgSW50ZWdlciBvcmlnRW50cnkgPSBv\ncmlnYmIuZ2V0SW50KCk7CiAgICAgICAgICAgICAgICBieXRlW10gZW50cnkg\nPSBzeW5jLmxzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKTsKICAgICAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgcmVzdWx0ID0gQnl0ZUJ1ZmZlci53cmFwKGVu\ndHJ5KTsKCiAgICAgICAgICAgICAgICBJbnRlZ2VyIHJldHJFbnRyeSA9IHJl\nc3VsdC5nZXRJbnQoKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiUmV0\ncmlldmVkIGVudHJ5OiAiICsgaSk7CiAgICAgICAgICAgICAgICBhc3NlcnRU\ncnVlKCJDaGVja2luZyBlbnRyeSAiICsgaSArICIgZm9yIGVxdWFsaXR5Iiwg\nb3JpZ0VudHJ5LmVxdWFscyhyZXRyRW50cnkpKTsKICAgICAgICAgICAgICAg\nIGFzc2VydFRydWUoIkNoZWNraW5nIGVudHJ5ICIgKyBpICsgIiBmb3Igc2l6\nZSIsIGVudHJ5Lmxlbmd0aCA9PSBlbnRyaWVzU2l6ZS5nZXQoaSkuaW50VmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICBpKys7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIG51bWJlciBvZiByZWFk\nIGVudHJpZXMiLCBpID09IG51bUVudHJpZXNUb1dyaXRlKTsKCiAgICAgICAg\nICAgIExPRy5pbmZvKCJWZXJpZmllZCB0aGF0IGVudHJpZXMgYXJlIG9rLCBh\nbmQgbm93IGNsb3NpbmcgbGVkZ2VyIik7CiAgICAgICAgICAgIGxoLmNsb3Nl\nKCk7CiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJDYXVnaHQgS2VlcGVyRXhjZXB0aW9uIiwg\nZSk7CiAgICAgICAgICAgIGZhaWwoZS50b1N0cmluZygpKTsKICAgICAgICB9\nIGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiQ2F1Z2h0IEJLRXhjZXB0aW9uIiwgZSk7CiAgICAgICAgICAgIGZhaWwo\nZS50b1N0cmluZygpKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiQ2F1Z2h0IElu\ndGVycnVwdGVkRXhjZXB0aW9uIiwgZSk7CiAgICAgICAgICAgIGZhaWwoZS50\nb1N0cmluZygpKTsKICAgICAgICB9CgogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgYWRkQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5k\nbGUgbGgsIGxvbmcgZW50cnlJZCwgT2JqZWN0IGN0eCkgewogICAgICAgIFN5\nbmNPYmogeCA9IChTeW5jT2JqKSBjdHg7CiAgICAgICAgaWYgKHJjICE9IDAp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJGYWlsdXJlIGR1cmluZyBhZGQg\ne30ge30iLCBlbnRyeUlkLCByYyk7CiAgICAgICAgICAgIHguZmFpbHVyZU9j\nY3VycmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgc3luY2hyb25pemVk\nICh4KSB7CiAgICAgICAgICAgIHguY291bnRlcisrOwogICAgICAgICAgICB4\nLm5vdGlmeSgpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIHJlYWRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRs\nZSBsaCwgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNlcSwgT2JqZWN0IGN0\neCkgewogICAgICAgIFN5bmNPYmogeCA9IChTeW5jT2JqKSBjdHg7CiAgICAg\nICAgaWYgKHJjICE9IDApIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJGYWls\ndXJlIGR1cmluZyBhZGQge30iLCByYyk7CiAgICAgICAgICAgIHguZmFpbHVy\nZU9jY3VycmVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgc3luY2hyb25p\nemVkICh4KSB7CiAgICAgICAgICAgIHgudmFsdWUgPSB0cnVlOwogICAgICAg\nICAgICB4LmxzID0gc2VxOwogICAgICAgICAgICB4Lm5vdGlmeSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICBAQmVmb3JlCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nc3VwZXIuc2V0VXAoKTsKCiAgICAgICAgcm5nID0gbmV3IFJhbmRvbShTeXN0\nZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7IC8vIEluaXRpYWxpemUgdGhlIFJh\nbmRvbQogICAgICAgIC8vIE51bWJlciBHZW5lcmF0b3IKICAgICAgICBlbnRy\naWVzID0gbmV3IEFycmF5TGlzdDxieXRlW10+KCk7IC8vIGluaXRpYWxpemUg\ndGhlIGVudHJpZXMgbGlzdAogICAgICAgIGVudHJpZXNTaXplID0gbmV3IEFy\ncmF5TGlzdDxJbnRlZ2VyPigpOwoKICAgICAgICB6a2MuY2xvc2UoKTsKICAg\nIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdExlZGdlck5vUmVjb3ZlcnlPcGVuQWZ0ZXJCS0NyYXNoZWQoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAg\nICAgICBMZWRnZXJIYW5kbGUgYmVmb3JlbGggPSBia2MuY3JlYXRlTGVkZ2Vy\nKG51bUJvb2tpZXMsIG51bUJvb2tpZXMsIGRpZ2VzdFR5cGUsICIiLmdldEJ5\ndGVzKCkpOwoKICAgICAgICBpbnQgbnVtRW50cmllcyA9IDEwOwogICAgICAg\nIFN0cmluZyB0bXAgPSAiQm9va0tlZXBlciBpcyBjb29sISI7CiAgICAgICAg\nZm9yIChpbnQgaT0wOyBpPG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAg\nICBiZWZvcmVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBzaHV0ZG93biBmaXJzdCBib29raWUgc2VydmVyCiAg\nICAgICAga2lsbEJvb2tpZSgwKTsKCiAgICAgICAgLy8gdHJ5IHRvIG9wZW4g\nbGVkZ2VyIG5vIHJlY292ZXJ5CiAgICAgICAgTGVkZ2VySGFuZGxlIGFmdGVy\nbGggPSBia2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkoYmVmb3JlbGguZ2V0SWQo\nKSwgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIGFzc2Vy\ndEVxdWFscyhudW1FbnRyaWVzIC0gMiwgYWZ0ZXJsaC5nZXRMYXN0QWRkQ29u\nZmlybWVkKCkpOwoKICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAg\nIExlZGdlckhhbmRsZSBiZWZvcmVsaDIgPSBia2MuY3JlYXRlTGVkZ2VyKG51\nbUJvb2tpZXMsIDEsIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwoKICAg\nICAgICBmb3IgKGludCBpPTA7IGk8bnVtRW50cmllczsgaSsrKSB7CiAgICAg\nICAgICAgIGJlZm9yZWxoMi5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBzaHV0ZG93biBmaXJzdCBib29raWUgc2Vy\ndmVyCiAgICAgICAga2lsbEJvb2tpZSgwKTsKCiAgICAgICAgLy8gdHJ5IHRv\nIG9wZW4gbGVkZ2VyIG5vIHJlY292ZXJ5CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGJlZm9yZWxoMi5nZXRJ\nZCgpLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKICAgICAgICAgICAg\nZmFpbCgiU2hvdWxkIGhhdmUgdGhyb3duIGV4Y2VwdGlvbiIpOwogICAgICAg\nIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLUmVhZEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAg\nfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0TGVkZ2VyT3BlbkFmdGVyQktDcmFzaGVkKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgTGVkZ2Vy\nSGFuZGxlIGJlZm9yZWxoID0gYmtjLmNyZWF0ZUxlZGdlcihudW1Cb29raWVz\nLCBudW1Cb29raWVzLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKCiAg\nICAgICAgaW50IG51bUVudHJpZXMgPSAxMDsKICAgICAgICBTdHJpbmcgdG1w\nID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZvciAoaW50IGk9\nMDsgaTxudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgYmVmb3JlbGgu\nYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gc2h1dGRvd24gZmlyc3QgYm9va2llIHNlcnZlcgogICAgICAgIGtpbGxC\nb29raWUoMCk7CiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAg\nLy8gdHJ5IHRvIG9wZW4gbGVkZ2VyIG5vIHJlY292ZXJ5CiAgICAgICAgTGVk\nZ2VySGFuZGxlIGFmdGVybGggPSBia2Mub3BlbkxlZGdlcihiZWZvcmVsaC5n\nZXRJZCgpLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKCiAgICAgICAg\nYXNzZXJ0RXF1YWxzKGJlZm9yZWxoLmdldExhc3RBZGRQdXNoZWQoKSwgYWZ0\nZXJsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwoKICAgICAgICBMZWRnZXJI\nYW5kbGUgYmVmb3JlbGgyID0gYmtjLmNyZWF0ZUxlZGdlcihudW1Cb29raWVz\nLCAxLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKCiAgICAgICAgZm9y\nIChpbnQgaT0wOyBpPG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAgICBi\nZWZvcmVsaDIuYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gc2h1dGRvd24gZmlyc3QgYm9va2llIHNlcnZlcgogICAg\nICAgIGtpbGxCb29raWUoMCk7CgogICAgICAgIC8vIHRyeSB0byBvcGVuIGxl\nZGdlciBubyByZWNvdmVyeQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJr\nYy5vcGVuTGVkZ2VyKGJlZm9yZWxoMi5nZXRJZCgpLCBkaWdlc3RUeXBlLCAi\nIi5nZXRCeXRlcygpKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGhhdmUg\ndGhyb3duIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0\naW9uLkJLTGVkZ2VyUmVjb3ZlcnlFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFZlcmlmeSByZWFkIGxhc3QgY29uZmlybWVkIG9wLCBpdCBz\naG91bGRuJ3QgY2F1c2UgYW55IGRlYWRsb2NrIGFzIG5ldwogICAgICogYm9v\na2llIGNvbm5lY3Rpb24gaXMgYmVpbmcgZXN0YWJsaXNoZWQgYW5kIHJldHVy\nbmluZyB0aGUgY29ubmVjdGlvbgogICAgICogbm90aWZpY2F0aW9uIGluIHRo\nZSBzYW1lIGNhbGxlciB0aHJlYWQuIEl0IHdvdWxkIGJlIHNpbXVsYXRlZCBi\neSBkZWxheWluZwogICAgICogdGhlIGZ1dHVyZS5hZGRsaXN0ZW5lcigpIGlu\nIFBlckNoYW5uZWxCb29raWVDbGllbnQgYWZ0ZXIgdGhlIGNvbm5lY3Rpb24K\nICAgICAqIGVzdGFibGlzaG1lbnQuIE5vdyB0aGUgZnV0dXJlLmFkZGxpc3Rl\nbmVyKCkgd2lsbCBub3RpZnkgYmFjayBpbiB0aGUgc2FtZQogICAgICogdGhy\nZWFkIGFuZCBzaW11bHRhbmVvdXNseSBpbnZva2UgdGhlIHBlbmRpbmdPcC5v\ncGVyYXRpb25Db21wbGV0ZSgpIGV2ZW50LgogICAgICogCiAgICAgKiBCT09L\nS0VFUEVSLTMyNgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdFJlYWRMYXN0Q29uZmlybWVkT3AoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwogICAg\nICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgLy8gQ3JlYXRlIGEgbGVk\nZ2VyCiAgICAgICAgTGVkZ2VySGFuZGxlIGJlZm9yZWxoID0gYmtjLmNyZWF0\nZUxlZGdlcihudW1Cb29raWVzICsgMiwKICAgICAgICAgICAgICAgIG51bUJv\nb2tpZXMgKyAyLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKCiAgICAg\nICAgaW50IG51bUVudHJpZXMgPSAxMDsKICAgICAgICBTdHJpbmcgdG1wID0g\nIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIGJlZm9yZWxo\nLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICB9CgogICAgICAg\nIC8vIHNodXRkb3duIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBraWxs\nQm9va2llKDApOwogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAg\nIC8vIGNyZWF0ZSBuZXcgYm9va2llIGNsaWVudCwgYW5kIGZvcmNpbmcgdG8g\nZXN0YWJsaXNoIG5ldwogICAgICAgIC8vIFBlckNoYW5uZWxCb29raWVDbGll\nbnQgY29ubmVjdGlvbnMgZm9yIHJlY292ZXJ5IGZsb3dzLgogICAgICAgIEJv\nb2tLZWVwZXJUZXN0Q2xpZW50IGJrYzEgPSBuZXcgQm9va0tlZXBlclRlc3RD\nbGllbnQoYmFzZUNsaWVudENvbmYpOwogICAgICAgIC8vIHRyeSB0byBvcGVu\nIGxlZGdlciB3aXRoIHJlY292ZXJ5CiAgICAgICAgTGVkZ2VySGFuZGxlIGFm\ndGVybGggPSBia2MxLm9wZW5MZWRnZXIoYmVmb3JlbGguZ2V0SWQoKSwgZGln\nZXN0VHlwZSwgIiIKICAgICAgICAgICAgICAgIC5nZXRCeXRlcygpKTsKCiAg\nICAgICAgYXNzZXJ0RXF1YWxzKCJFbnRyaWVzIGdvdCBtaXNzZWQiLCBiZWZv\ncmVsaC5nZXRMYXN0QWRkUHVzaGVkKCksIGFmdGVybGgKICAgICAgICAgICAg\nICAgIC5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwogICAgICAgIGJrYzEuY2xv\nc2UoKTsKICAgIH0KfQo=\n","encoding":"base64"}

