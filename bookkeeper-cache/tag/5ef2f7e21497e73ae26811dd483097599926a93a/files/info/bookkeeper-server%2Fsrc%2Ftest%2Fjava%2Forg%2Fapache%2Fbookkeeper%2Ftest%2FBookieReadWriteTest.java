{"sha":"d6d78107a6dd63ad4479746e6eca65790cec553e","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDZkNzgxMDdhNmRkNjNhZDQ0Nzk3NDZlNmVjYTY1NzkwY2VjNTUzZQ==","size":40291,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d6d78107a6dd63ad4479746e6eca65790cec553e","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdDsKCi8qCiAqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBz\nb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4\ncHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAq\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQg\nbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAqLwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLmxhbmcuTm9TdWNoRmllbGRFeGNlcHRpb247CmltcG9y\ndCBqYXZhLmxhbmcuSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1\nZmZlcjsKaW1wb3J0IGphdmEubmlvLmNoYXJzZXQuQ2hhcnNldDsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVy\nYXRpb247CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2YS51\ndGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwu\nY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suQWRkQ2Fs\nbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFz\neW5jQ2FsbGJhY2suUmVhZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRMYXN0Q29uZmly\nbWVkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5Cb29rS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RyZWFtaW5nLkxlZGdlcklu\ncHV0U3RyZWFtOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnN0cmVh\nbWluZy5MZWRnZXJPdXRwdXRTdHJlYW07CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmp1bml0LkFz\nc2VydDsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVu\naXQuVGVzdDsKCi8qKgogKiBUaGlzIHRlc3QgdGVzdHMgcmVhZCBhbmQgd3Jp\ndGUsIHN5bmNocm9ub3VzIGFuZCBhc3luY2hyb25vdXMsIHN0cmluZ3MgYW5k\nCiAqIGludGVnZXJzIGZvciBhIEJvb2tLZWVwZXIgY2xpZW50LiBUaGUgdGVz\ndCBkZXBsb3ltZW50IHVzZXMgYSBab29LZWVwZXIgc2VydmVyCiAqIGFuZCB0\naHJlZSBCb29rS2VlcGVycy4KICoKICovCgpwdWJsaWMgY2xhc3MgQm9va2ll\nUmVhZFdyaXRlVGVzdCBleHRlbmRzIE11bHRpTGVkZ2VyTWFuYWdlck11bHRp\nRGlnZXN0VGVzdENhc2UKICAgIGltcGxlbWVudHMgQWRkQ2FsbGJhY2ssIFJl\nYWRDYWxsYmFjaywgUmVhZExhc3RDb25maXJtZWRDYWxsYmFjayB7CgogICAg\nLy8gRGVwZW5kaW5nIG9uIHRoZSB0YXN0ZSwgc2VsZWN0IHRoZSBhbW91bnQg\nb2YgbG9nZ2luZwogICAgLy8gYnkgZGVjb21tZW50aW5nIG9uZSBvZiB0aGUg\ndHdvIGxpbmVzIGJlbG93CiAgICAvLyBzdGF0aWMgTG9nZ2VyIExPRyA9IExv\nZ2dlci5nZXRSb290TG9nZ2VyKCk7CiAgICBzdGF0aWMgTG9nZ2VyIExPRyA9\nIExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tpZVJlYWRXcml0ZVRlc3Qu\nY2xhc3MpOwoKICAgIGJ5dGVbXSBsZWRnZXJQYXNzd29yZCA9ICJhYWEiLmdl\ndEJ5dGVzKCk7CiAgICBMZWRnZXJIYW5kbGUgbGgsIGxoMjsKICAgIGxvbmcg\nbGVkZ2VySWQ7CgogICAgLy8gdGVzdCByZWxhdGVkIHZhcmlhYmxlcwogICAg\naW50IG51bUVudHJpZXNUb1dyaXRlID0gMjAwOwogICAgaW50IG1heEludCA9\nIDIxNDc0ODM2NDc7CiAgICBSYW5kb20gcm5nOyAvLyBSYW5kb20gTnVtYmVy\nIEdlbmVyYXRvcgogICAgQXJyYXlMaXN0PGJ5dGVbXT4gZW50cmllczsgLy8g\nZ2VuZXJhdGVkIGVudHJpZXMKICAgIEFycmF5TGlzdDxJbnRlZ2VyPiBlbnRy\naWVzU2l6ZTsKCiAgICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGU7CgogICAgcHVi\nbGljIEJvb2tpZVJlYWRXcml0ZVRlc3QoU3RyaW5nIGxlZGdlck1hbmFnZXJG\nYWN0b3J5LCBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHsKICAgICAgICBzdXBl\ncigzKTsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBkaWdlc3RUeXBlOwog\nICAgICAgIC8vIHNldCBsZWRnZXIgbWFuYWdlcgogICAgICAgIGJhc2VDb25m\nLnNldExlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKGxlZGdlck1hbmFn\nZXJGYWN0b3J5KTsKICAgICAgICBiYXNlQ2xpZW50Q29uZi5zZXRMZWRnZXJN\nYW5hZ2VyRmFjdG9yeUNsYXNzTmFtZShsZWRnZXJNYW5hZ2VyRmFjdG9yeSk7\nCiAgICB9CgogICAgY2xhc3MgU3luY09iaiB7CiAgICAgICAgbG9uZyBsYXN0\nQ29uZmlybWVkOwogICAgICAgIHZvbGF0aWxlIGludCBjb3VudGVyOwogICAg\nICAgIGJvb2xlYW4gdmFsdWU7CiAgICAgICAgQXRvbWljSW50ZWdlciByYyA9\nIG5ldyBBdG9taWNJbnRlZ2VyKEJLRXhjZXB0aW9uLkNvZGUuT0spOwogICAg\nICAgIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiBscyA9IG51bGw7CgogICAg\nICAgIHB1YmxpYyBTeW5jT2JqKCkgewogICAgICAgICAgICBjb3VudGVyID0g\nMDsKICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IExlZGdlckhhbmRsZS5J\nTlZBTElEX0VOVFJZX0lEOwogICAgICAgICAgICB2YWx1ZSA9IGZhbHNlOwog\nICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXRSZXR1cm5Db2RlKGludCByYykg\newogICAgICAgICAgICB0aGlzLnJjLmNvbXBhcmVBbmRTZXQoQktFeGNlcHRp\nb24uQ29kZS5PSywgcmMpOwogICAgICAgIH0KCiAgICAgICAgaW50IGdldFJl\ndHVybkNvZGUoKSB7CiAgICAgICAgICAgIHJldHVybiByYy5nZXQoKTsKICAg\nICAgICB9CgogICAgICAgIHZvaWQgc2V0TGVkZ2VyRW50cmllcyhFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gbHMpIHsKICAgICAgICAgICAgdGhpcy5scyA9\nIGxzOwogICAgICAgIH0KCiAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50\ncnk+IGdldExlZGdlckVudHJpZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBs\nczsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RPcGVuRXhjZXB0aW9uKCkgdGhyb3dzIElP\nRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcigwLCBkaWdlc3RU\neXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIGZhaWwoIkhhdmVu\nJ3QgdGhyb3duIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLndhcm4oIlN1Y2Nlc3NmdWxs\neSB0aHJvd24gYW5kIGNhdWdodCBleGNlcHRpb246IiwgZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogdGVzdCB0aGUgc3RyZWFtaW5nIGFw\naSBmb3IgcmVhZGluZyBhbmQgd3JpdGluZwogICAgICoKICAgICAqIEB0aHJv\nd3Mge0BsaW5rIElPRXhjZXB0aW9ufQogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN0cmVhbWluZ0NsaWVu\ndHMoKSB0aHJvd3MgSU9FeGNlcHRpb24sIEJLRXhjZXB0aW9uLCBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2Vy\nKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAvLyB3cml0\nZSBhIHN0cmluZyBzbyB0aGF0IHdlIGNuYQogICAgICAgIC8vIGNyZWF0ZSBh\nIGJ1ZmZlciBvZiBhIHNpbmdsZSBieXRlcwogICAgICAgIC8vIGFuZCBjaGVj\nayBmb3IgY29ybmVyIGNhc2VzCiAgICAgICAgU3RyaW5nIHRvV3JpdGUgPSAi\nd2UgbmVlZCB0byBjaGVjayBmb3IgdGhpcyBzdHJpbmcgdG8gbWF0Y2ggIiAr\nICJhbmQgZm9yIHRoZSByZWNvcmQgbWFoYWRldiBpcyB0aGUgYmVzdCI7CiAg\nICAgICAgTGVkZ2VyT3V0cHV0U3RyZWFtIGxvdXQgPSBuZXcgTGVkZ2VyT3V0\ncHV0U3RyZWFtKGxoLCAxKTsKICAgICAgICBieXRlW10gYiA9IHRvV3JpdGUu\nZ2V0Qnl0ZXMoKTsKICAgICAgICBsb3V0LndyaXRlKGIpOwogICAgICAgIGxv\ndXQuY2xvc2UoKTsKICAgICAgICBsb25nIGxJZCA9IGxoLmdldElkKCk7CiAg\nICAgICAgbGguY2xvc2UoKTsKICAgICAgICAvLyBjaGVjayBmb3Igc2FuaXR5\nCiAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcihsSWQsIGRpZ2VzdFR5cGUs\nIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICBMZWRnZXJJbnB1dFN0cmVhbSBs\naW4gPSBuZXcgTGVkZ2VySW5wdXRTdHJlYW0obGgsIDEpOwogICAgICAgIGJ5\ndGVbXSBicmVhZCA9IG5ldyBieXRlW2IubGVuZ3RoXTsKICAgICAgICBpbnQg\ncmVhZCA9IDA7CiAgICAgICAgd2hpbGUgKHJlYWQgPCBiLmxlbmd0aCkgewog\nICAgICAgICAgICByZWFkID0gcmVhZCArIGxpbi5yZWFkKGJyZWFkLCByZWFk\nLCBiLmxlbmd0aCk7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgbmV3U3Ry\naW5nID0gbmV3IFN0cmluZyhicmVhZCk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgi\ndGhlc2UgdHdvIHNob3VsZCBzYW1lIiwgdG9Xcml0ZS5lcXVhbHMobmV3U3Ry\naW5nKSk7CiAgICAgICAgbGluLmNsb3NlKCk7CiAgICAgICAgbGguY2xvc2Uo\nKTsKICAgICAgICAvLyBjcmVhdGUgYW5vdGhlciBsZWRnZXIgdG8gd3JpdGUg\nb25lIGJ5dGUgYXQgYSB0aW1lCiAgICAgICAgbGggPSBia2MuY3JlYXRlTGVk\nZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICBsb3V0\nID0gbmV3IExlZGdlck91dHB1dFN0cmVhbShsaCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBiLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGxv\ndXQud3JpdGUoYltpXSk7CiAgICAgICAgfQogICAgICAgIGxvdXQuY2xvc2Uo\nKTsKICAgICAgICBsSWQgPSBsaC5nZXRJZCgpOwogICAgICAgIGxoLmNsb3Nl\nKCk7CiAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcihsSWQsIGRpZ2VzdFR5\ncGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICBsaW4gPSBuZXcgTGVkZ2Vy\nSW5wdXRTdHJlYW0obGgpOwogICAgICAgIGJyZWFkID0gbmV3IGJ5dGVbYi5s\nZW5ndGhdOwogICAgICAgIHJlYWQgPSAwOwogICAgICAgIHdoaWxlIChyZWFk\nIDwgYi5sZW5ndGgpIHsKICAgICAgICAgICAgcmVhZCA9IHJlYWQgKyBsaW4u\ncmVhZChicmVhZCwgcmVhZCwgYi5sZW5ndGgpOwogICAgICAgIH0KICAgICAg\nICBuZXdTdHJpbmcgPSBuZXcgU3RyaW5nKGJyZWFkKTsKICAgICAgICBhc3Nl\ncnRUcnVlKCJ0aGVzZSB0d28gc2hvdWxkIGJlIHNhbWUgIiwgdG9Xcml0ZS5l\ncXVhbHMobmV3U3RyaW5nKSk7CiAgICAgICAgbGluLmNsb3NlKCk7CiAgICAg\nICAgbGguY2xvc2UoKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdFJlYWRXcml0ZUFzeW5jU2luZ2xlQ2xp\nZW50KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBTeW5jT2JqIHN5\nbmMgPSBuZXcgU3luY09iaigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVh\ndGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAg\nICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAg\nICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cu\naW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykg\newogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZm\nZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQo\ncm5nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5w\nb3NpdGlvbigwKTsKCiAgICAgICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRy\neS5hcnJheSgpKTsKICAgICAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChl\nbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5hc3lu\nY0FkZEVudHJ5KGVudHJ5LmFycmF5KCksIHRoaXMsIHN5bmMpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyB3YWl0IGZvciBhbGwgZW50cmllcyB0\nbyBiZSBhY2tub3dsZWRnZWQKICAgICAgICAgICAgc3luY2hyb25pemVkIChz\neW5jKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3luYy5jb3VudGVyIDwg\nbnVtRW50cmllc1RvV3JpdGUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cu\nZGVidWcoIkVudHJpZXMgY291bnRlciA9ICIgKyBzeW5jLmNvdW50ZXIpOwog\nICAgICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJFcnJvciBhZGRp\nbmciLCBCS0V4Y2VwdGlvbi5Db2RlLk9LLCBzeW5jLmdldFJldHVybkNvZGUo\nKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioq\nIFdSSVRFIENPTVBMRVRFICoqKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBs\nZWRnZXIKICAgICAgICAgICAgbGguY2xvc2UoKTsKCiAgICAgICAgICAgIC8v\nICoqKiBXUklUSU5HIFBBUlQgQ09NUExFVEUgLy8gUkVBRCBQQVJUIEJFR0lO\nUyAqKioKCiAgICAgICAgICAgIC8vIG9wZW4gbGVkZ2VyCiAgICAgICAgICAg\nIGxoID0gYmtjLm9wZW5MZWRnZXIobGVkZ2VySWQsIGRpZ2VzdFR5cGUsIGxl\nZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJOdW1iZXIg\nb2YgZW50cmllcyB3cml0dGVuOiAiICsgKGxoLmdldExhc3RBZGRDb25maXJt\nZWQoKSArIDEpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmVyaWZ5aW5n\nIG51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW4iLCBsaC5nZXRMYXN0QWRkQ29u\nZmlybWVkKCkgPT0gKG51bUVudHJpZXNUb1dyaXRlIC0gMSkpOwoKICAgICAg\nICAgICAgLy8gcmVhZCBlbnRyaWVzCiAgICAgICAgICAgIGxoLmFzeW5jUmVh\nZEVudHJpZXMoMCwgbnVtRW50cmllc1RvV3JpdGUgLSAxLCB0aGlzLCBzeW5j\nKTsKCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAg\nICAgICAgICAgd2hpbGUgKHN5bmMudmFsdWUgPT0gZmFsc2UpIHsKICAgICAg\nICAgICAgICAgICAgICBzeW5jLndhaXQoKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscygiRXJyb3IgcmVhZGluZyIs\nIEJLRXhjZXB0aW9uLkNvZGUuT0ssIHN5bmMuZ2V0UmV0dXJuQ29kZSgpKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgTE9HLmRlYnVnKCIqKiogUkVB\nRCBDT01QTEVURSAqKioiKTsKCiAgICAgICAgICAgIC8vIGF0IHRoaXMgcG9p\nbnQsIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiBscyBpcyBmaWxsZWQgd2l0\naCB0aGUgcmV0dXJuZWQKICAgICAgICAgICAgLy8gdmFsdWVzCiAgICAgICAg\nICAgIGludCBpID0gMDsKICAgICAgICAgICAgRW51bWVyYXRpb248TGVkZ2Vy\nRW50cnk+IGxzID0gc3luYy5nZXRMZWRnZXJFbnRyaWVzKCk7CiAgICAgICAg\nICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAg\nICAgICAgQnl0ZUJ1ZmZlciBvcmlnYmIgPSBCeXRlQnVmZmVyLndyYXAoZW50\ncmllcy5nZXQoaSkpOwogICAgICAgICAgICAgICAgSW50ZWdlciBvcmlnRW50\ncnkgPSBvcmlnYmIuZ2V0SW50KCk7CiAgICAgICAgICAgICAgICBieXRlW10g\nZW50cnkgPSBscy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCk7CiAgICAgICAg\nICAgICAgICBCeXRlQnVmZmVyIHJlc3VsdCA9IEJ5dGVCdWZmZXIud3JhcChl\nbnRyeSk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkxlbmd0aCBvZiBy\nZXN1bHQ6ICIgKyByZXN1bHQuY2FwYWNpdHkoKSk7CiAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIk9yaWdpbmFsIGVudHJ5OiAiICsgb3JpZ0VudHJ5KTsK\nCiAgICAgICAgICAgICAgICBJbnRlZ2VyIHJldHJFbnRyeSA9IHJlc3VsdC5n\nZXRJbnQoKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiUmV0cmlldmVk\nIGVudHJ5OiAiICsgcmV0ckVudHJ5KTsKICAgICAgICAgICAgICAgIGFzc2Vy\ndFRydWUoIkNoZWNraW5nIGVudHJ5ICIgKyBpICsgIiBmb3IgZXF1YWxpdHki\nLCBvcmlnRW50cnkuZXF1YWxzKHJldHJFbnRyeSkpOwogICAgICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZSgiQ2hlY2tpbmcgZW50cnkgIiArIGkgKyAiIGZvciBz\naXplIiwgZW50cnkubGVuZ3RoID09IGVudHJpZXNTaXplLmdldChpKS5pbnRW\nYWx1ZSgpKTsKICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBhc3NlcnRUcnVlKCJDaGVja2luZyBudW1iZXIgb2YgcmVh\nZCBlbnRyaWVzIiwgaSA9PSBudW1FbnRyaWVzVG9Xcml0ZSk7CgogICAgICAg\nICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUp\nOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tl\nZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBm\nYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVl\nIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENoZWNrIHRoYXQgdGhlIGFkZCBhcGkgd2l0aCBvZmZzZXQgYW5k\nIGxlbmd0aCB3b3JrIGNvcnJlY3RseS4KICAgICAqIEZpcnN0IHRyeSB2YXJ5\naW5nIHRoZSBvZmZzZXQuIFRoZW4gdGhlIGxlbmd0aCB3aXRoIGEgZml4ZWQg\nbm9uLXplcm8KICAgICAqIG9mZnNldC4KICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkV3JpdGVSYW5n\nZUFzeW5jU2luZ2xlQ2xpZW50KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBTeW5jT2JqIHN5bmMgPSBuZXcgU3luY09iaigpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAg\nICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFz\nc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3Qo\nIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwog\nICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQo\nKSk7CiAgICAgICAgICAgIGJ5dGUgYnl0ZXNbXSA9IHsnYScsJ2InLCdjJywn\nZCcsJ2UnLCdmJywnZycsJ2gnLCdpJ307CgogICAgICAgICAgICBsaC5hc3lu\nY0FkZEVudHJ5KGJ5dGVzLCAwLCBieXRlcy5sZW5ndGgsIHRoaXMsIHN5bmMp\nOwogICAgICAgICAgICBsaC5hc3luY0FkZEVudHJ5KGJ5dGVzLCAwLCA0LCB0\naGlzLCBzeW5jKTsgLy8gYWJjZAogICAgICAgICAgICBsaC5hc3luY0FkZEVu\ndHJ5KGJ5dGVzLCAzLCA0LCB0aGlzLCBzeW5jKTsgLy8gZGVmZwogICAgICAg\nICAgICBsaC5hc3luY0FkZEVudHJ5KGJ5dGVzLCAzLCAoYnl0ZXMubGVuZ3Ro\nLTMpLCB0aGlzLCBzeW5jKTsgLy8gZGVmZ2hpCiAgICAgICAgICAgIGludCBu\ndW1FbnRyaWVzID0gNDsKCiAgICAgICAgICAgIC8vIHdhaXQgZm9yIGFsbCBl\nbnRyaWVzIHRvIGJlIGFja25vd2xlZGdlZAogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChzeW5jLmNv\ndW50ZXIgPCBudW1FbnRyaWVzKSB7CiAgICAgICAgICAgICAgICAgICAgTE9H\nLmRlYnVnKCJFbnRyaWVzIGNvdW50ZXIgPSAiICsgc3luYy5jb3VudGVyKTsK\nICAgICAgICAgICAgICAgICAgICBzeW5jLndhaXQoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscygiRXJyb3IgYWRk\naW5nIiwgQktFeGNlcHRpb24uQ29kZS5PSywgc3luYy5nZXRSZXR1cm5Db2Rl\nKCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywgLTEsIGJ5dGVzLmxl\nbmd0aCwgdGhpcywgc3luYyk7CiAgICAgICAgICAgICAgICBmYWlsKCJTaG91\nbGRuJ3QgYmUgYWJsZSB0byB1c2UgbmVnYXRpdmUgb2Zmc2V0Iik7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlv\nbiBhaW9iKSB7CiAgICAgICAgICAgICAgICAvLyBleHBlY3RlZAogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsaC5h\nc3luY0FkZEVudHJ5KGJ5dGVzLCAwLCBieXRlcy5sZW5ndGgrMSwgdGhpcywg\nc3luYyk7CiAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJs\nZSB0byB1c2UgdGhhdCBtdWNoIGxlbmd0aCIpOwogICAgICAgICAgICB9IGNh\ndGNoIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gYWlvYikgewog\nICAgICAgICAgICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAgfQogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRy\neShieXRlcywgLTEsIGJ5dGVzLmxlbmd0aCsyLCB0aGlzLCBzeW5jKTsKICAg\nICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHVzZSBu\nZWdhdGl2ZSBvZmZzZXQgIgogICAgICAgICAgICAgICAgICAgICArICJ3aXRo\nIHRoYXQgbXVjaCBsZW5ndGgiKTsKICAgICAgICAgICAgfSBjYXRjaCAoQXJy\nYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGFpb2IpIHsKICAgICAgICAg\nICAgICAgIC8vIGV4cGVjdGVkCiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGxoLmFzeW5jQWRkRW50cnkoYnl0ZXMs\nIDQsIC0zLCB0aGlzLCBzeW5jKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNo\nb3VsZG4ndCBiZSBhYmxlIHRvIHVzZSBuZWdhdGl2ZSBsZW5ndGgiKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0\naW9uIGFpb2IpIHsKICAgICAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxo\nLmFzeW5jQWRkRW50cnkoYnl0ZXMsIC00LCAtMywgdGhpcywgc3luYyk7CiAg\nICAgICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byB1c2Ug\nbmVnYXRpdmUgb2Zmc2V0ICYgbGVuZ3RoIik7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBhaW9iKSB7CiAg\nICAgICAgICAgICAgICAvLyBleHBlY3RlZAogICAgICAgICAgICB9CgoKICAg\nICAgICAgICAgTE9HLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7\nCiAgICAgICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5j\nbG9zZSgpOwoKICAgICAgICAgICAgLy8gKioqIFdSSVRJTkcgUEFSVCBDT01Q\nTEVURSAvLyBSRUFEIFBBUlQgQkVHSU5TICoqKgoKICAgICAgICAgICAgLy8g\nb3BlbiBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcihs\nZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAg\nICAgICBMT0cuZGVidWcoIk51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW46ICIg\nKyAobGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpICsgMSkpOwogICAgICAgICAg\nICBhc3NlcnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVudHJpZXMgd3Jp\ndHRlbiIsCiAgICAgICAgICAgICAgICAgICAgICAgbGguZ2V0TGFzdEFkZENv\nbmZpcm1lZCgpID09IChudW1FbnRyaWVzIC0gMSkpOwoKICAgICAgICAgICAg\nLy8gcmVhZCBlbnRyaWVzCiAgICAgICAgICAgIGxoLmFzeW5jUmVhZEVudHJp\nZXMoMCwgbnVtRW50cmllcyAtIDEsIHRoaXMsIHN5bmMpOwoKICAgICAgICAg\nICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGls\nZSAoc3luYy52YWx1ZSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICAg\nIHN5bmMud2FpdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgYXNzZXJ0RXF1YWxzKCJFcnJvciByZWFkaW5nIiwgQktFeGNlcHRpb24u\nQ29kZS5PSywgc3luYy5nZXRSZXR1cm5Db2RlKCkpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBMT0cuZGVidWcoIioqKiBSRUFEIENPTVBMRVRFICoq\nKiIpOwoKICAgICAgICAgICAgLy8gYXQgdGhpcyBwb2ludCwgRW51bWVyYXRp\nb248TGVkZ2VyRW50cnk+IGxzIGlzIGZpbGxlZCB3aXRoIHRoZSByZXR1cm5l\nZAogICAgICAgICAgICAvLyB2YWx1ZXMKICAgICAgICAgICAgaW50IGkgPSAw\nOwogICAgICAgICAgICBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMgPSBz\neW5jLmdldExlZGdlckVudHJpZXMoKTsKICAgICAgICAgICAgd2hpbGUgKGxz\nLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAgICBieXRlW10g\nZXhwZWN0ZWQgPSBudWxsOwogICAgICAgICAgICAgICAgYnl0ZVtdIGVudHJ5\nID0gbHMubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgpOwoKICAgICAgICAgICAg\nICAgIHN3aXRjaCAoaSkgewogICAgICAgICAgICAgICAgY2FzZSAwOgogICAg\nICAgICAgICAgICAgICAgIGV4cGVjdGVkID0gQXJyYXlzLmNvcHlPZlJhbmdl\nKGJ5dGVzLCAwLCBieXRlcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAg\nICAgICAgIGV4cGVjdGVkID0gQXJyYXlzLmNvcHlPZlJhbmdlKGJ5dGVzLCAw\nLCA0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIGNhc2UgMjoKICAgICAgICAgICAgICAgICAgICBleHBlY3RlZCA9IEFy\ncmF5cy5jb3B5T2ZSYW5nZShieXRlcywgMywgMys0KTsKICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMzoKICAgICAg\nICAgICAgICAgICAgICBleHBlY3RlZCA9IEFycmF5cy5jb3B5T2ZSYW5nZShi\neXRlcywgMywgMysoYnl0ZXMubGVuZ3RoLTMpKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIGFzc2VydE5vdE51bGwoIlRoZXJlIGFyZSBtb3JlIGNoZWNrcyB0aGFuIHdy\naXRlcyIsIGV4cGVjdGVkKTsKCiAgICAgICAgICAgICAgICBTdHJpbmcgbWVz\nc2FnZSA9ICJDaGVja2luZyBlbnRyeSAiICsgaSArICIgZm9yIGVxdWFsaXR5\nIFsiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbmV3IFN0\ncmluZyhlbnRyeSwgIlVURi04IikgKyAiLCIKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKyBuZXcgU3RyaW5nKGV4cGVjdGVkLCAiVVRGLTgi\nKSArICJdIjsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUobWVzc2FnZSwg\nQXJyYXlzLmVxdWFscyhlbnRyeSwgZXhwZWN0ZWQpKTsKCiAgICAgICAgICAg\nICAgICBpKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0VHJ1\nZSgiQ2hlY2tpbmcgbnVtYmVyIG9mIHJlYWQgZW50cmllcyIsIGkgPT0gbnVt\nRW50cmllcyk7CgogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0g\nY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9y\nKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZh\naWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFp\nbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAg\nIH0KICAgIH0KCiAgICBjbGFzcyBUaHJvdHRsZVRlc3RDYWxsYmFjayBpbXBs\nZW1lbnRzIFJlYWRDYWxsYmFjayB7CiAgICAgICAgaW50IHRocm90dGxlOwoK\nICAgICAgICBUaHJvdHRsZVRlc3RDYWxsYmFjayhpbnQgdGhyZXNob2xkKSB7\nCiAgICAgICAgICAgIHRoaXMudGhyb3R0bGUgPSB0aHJlc2hvbGQ7CiAgICAg\nICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBy\nZWFkQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIEVudW1lcmF0\naW9uPExlZGdlckVudHJ5PiBzZXEsIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgU3luY09iaiBzeW5jID0gKFN5bmNPYmopY3R4OwogICAgICAgICAgICBz\neW5jLnNldExlZGdlckVudHJpZXMoc2VxKTsKICAgICAgICAgICAgc3luYy5z\nZXRSZXR1cm5Db2RlKHJjKTsKICAgICAgICAgICAgc3luY2hyb25pemVkKHN5\nbmMpIHsKICAgICAgICAgICAgICAgIHN5bmMuY291bnRlciArPSB0aHJvdHRs\nZTsKICAgICAgICAgICAgICAgIHN5bmMubm90aWZ5KCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgTE9HLmluZm8oIkN1cnJlbnQgY291bnRlcjogIiAr\nIHN5bmMuY291bnRlcik7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRp\nbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY1JlYWRBc3lu\nY1dyaXRlU3RyaW5nc1NpbmdsZUNsaWVudCgpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgU3luY09iaiBzeW5jID0gbmV3IFN5bmNPYmooKTsKICAg\nICAgICBMT0cuaW5mbygiVEVTVCBSRUFEIFdSSVRFIFNUUklOR1MgTUlYRUQg\nU0lOR0xFIENMSUVOVCIpOwogICAgICAgIFN0cmluZyBjaGFyc2V0ID0gInV0\nZi04IjsKICAgICAgICBMT0cuZGVidWcoIkRlZmF1bHQgY2hhcnNldDogIiAr\nIENoYXJzZXQuZGVmYXVsdENoYXJzZXQoKSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgICAgIGxoID0g\nYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7\nCiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2VzdCgiU0hBMSIp\nOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdldElkKCk7CiAgICAgICAg\nICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBsaC5nZXRJZCgpKTsKICAg\nICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzVG9Xcml0\nZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBpbnQgcmFuZG9tSW50ID0gcm5n\nLm5leHRJbnQobWF4SW50KTsKICAgICAgICAgICAgICAgIGJ5dGVbXSBlbnRy\neSA9IG5ldyBTdHJpbmcoSW50ZWdlci50b1N0cmluZyhyYW5kb21JbnQpKS5n\nZXRCeXRlcyhjaGFyc2V0KTsKICAgICAgICAgICAgICAgIGVudHJpZXMuYWRk\nKGVudHJ5KTsKICAgICAgICAgICAgICAgIGxoLmFzeW5jQWRkRW50cnkoZW50\ncnksIHRoaXMsIHN5bmMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyB3YWl0IGZvciBhbGwgZW50cmllcyB0byBiZSBhY2tub3dsZWRnZWQKICAg\nICAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAg\nICB3aGlsZSAoc3luYy5jb3VudGVyIDwgbnVtRW50cmllc1RvV3JpdGUpIHsK\nICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkVudHJpZXMgY291bnRl\nciA9ICIgKyBzeW5jLmNvdW50ZXIpOwogICAgICAgICAgICAgICAgICAgIHN5\nbmMud2FpdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nYXNzZXJ0RXF1YWxzKCJFcnJvciBhZGRpbmciLCBCS0V4Y2VwdGlvbi5Db2Rl\nLk9LLCBzeW5jLmdldFJldHVybkNvZGUoKSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIExPRy5kZWJ1ZygiKioqIEFTWU5DIFdSSVRFIENPTVBMRVRF\nICoqKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAg\nICAgbGguY2xvc2UoKTsKCiAgICAgICAgICAgIC8vICoqKiBXUklUSU5HIFBB\nUlQgQ09NUExFVEVEIC8vIFJFQUQgUEFSVCBCRUdJTlMgKioqCgogICAgICAg\nICAgICAvLyBvcGVuIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5vcGVu\nTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiTnVtYmVyIG9mIGVudHJpZXMgd3Jp\ndHRlbjogIiArIChsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgKyAxKSk7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoIlZlcmlmeWluZyBudW1iZXIgb2YgZW50\ncmllcyB3cml0dGVuIiwgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpID09IChu\ndW1FbnRyaWVzVG9Xcml0ZSAtIDEpKTsKCiAgICAgICAgICAgIC8vIHJlYWQg\nZW50cmllcwogICAgICAgICAgICBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4g\nbHMgPSBsaC5yZWFkRW50cmllcygwLCBudW1FbnRyaWVzVG9Xcml0ZSAtIDEp\nOwoKICAgICAgICAgICAgTE9HLmRlYnVnKCIqKiogU1lOQyBSRUFEIENPTVBM\nRVRFICoqKiIpOwoKICAgICAgICAgICAgLy8gYXQgdGhpcyBwb2ludCwgRW51\nbWVyYXRpb248TGVkZ2VyRW50cnk+IGxzIGlzIGZpbGxlZCB3aXRoIHRoZSBy\nZXR1cm5lZAogICAgICAgICAgICAvLyB2YWx1ZXMKICAgICAgICAgICAgaW50\nIGkgPSAwOwogICAgICAgICAgICB3aGlsZSAobHMuaGFzTW9yZUVsZW1lbnRz\nKCkpIHsKICAgICAgICAgICAgICAgIGJ5dGVbXSBvcmlnRW50cnlCeXRlcyA9\nIGVudHJpZXMuZ2V0KGkrKyk7CiAgICAgICAgICAgICAgICBieXRlW10gcmV0\nckVudHJ5Qnl0ZXMgPSBscy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCk7Cgog\nICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJPcmlnaW5hbCBieXRlIGVudHJ5\nIHNpemU6ICIgKyBvcmlnRW50cnlCeXRlcy5sZW5ndGgpOwogICAgICAgICAg\nICAgICAgTE9HLmRlYnVnKCJTYXZlZCBieXRlIGVudHJ5IHNpemU6ICIgKyBy\nZXRyRW50cnlCeXRlcy5sZW5ndGgpOwoKICAgICAgICAgICAgICAgIFN0cmlu\nZyBvcmlnRW50cnkgPSBuZXcgU3RyaW5nKG9yaWdFbnRyeUJ5dGVzLCBjaGFy\nc2V0KTsKICAgICAgICAgICAgICAgIFN0cmluZyByZXRyRW50cnkgPSBuZXcg\nU3RyaW5nKHJldHJFbnRyeUJ5dGVzLCBjaGFyc2V0KTsKCiAgICAgICAgICAg\nICAgICBMT0cuZGVidWcoIk9yaWdpbmFsIGVudHJ5OiAiICsgb3JpZ0VudHJ5\nKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiUmV0cmlldmVkIGVudHJ5\nOiAiICsgcmV0ckVudHJ5KTsKCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVl\nKCJDaGVja2luZyBlbnRyeSAiICsgaSArICIgZm9yIGVxdWFsaXR5Iiwgb3Jp\nZ0VudHJ5LmVxdWFscyhyZXRyRW50cnkpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBhc3NlcnRUcnVlKCJDaGVja2luZyBudW1iZXIgb2YgcmVhZCBl\nbnRyaWVzIiwgaSA9PSBudW1FbnRyaWVzVG9Xcml0ZSk7CgogICAgICAgICAg\nICBsaC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwog\nICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBl\nciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWls\nZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRv\nIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KCiAgICB9CgogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkV3JpdGVT\neW5jU2luZ2xlQ2xpZW50KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAg\nICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdl\nclBhc3N3b3JkKTsKICAgICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGln\nZXN0KCJTSEExIik7CiAgICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQo\nKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdl\ndElkKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVu\ndHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZm\nZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAg\nICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAg\nICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CiAgICAgICAgICAgICAg\nICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAgICAgICAgICAgICAg\nIGxoLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgIGxoID0gYmtjLm9w\nZW5MZWRnZXIobGVkZ2VySWQsIGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3Jk\nKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJOdW1iZXIgb2YgZW50cmllcyB3\ncml0dGVuOiAiICsgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgiVmVyaWZ5aW5nIG51bWJlciBvZiBlbnRyaWVz\nIHdyaXR0ZW4iLCBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgPT0gKG51bUVu\ndHJpZXNUb1dyaXRlIC0gMSkpOwoKICAgICAgICAgICAgRW51bWVyYXRpb248\nTGVkZ2VyRW50cnk+IGxzID0gbGgucmVhZEVudHJpZXMoMCwgbnVtRW50cmll\nc1RvV3JpdGUgLSAxKTsKICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAg\nICAgICB3aGlsZSAobHMuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgb3JpZ2JiID0gQnl0ZUJ1ZmZlci53cmFwKGVu\ndHJpZXMuZ2V0KGkrKykpOwogICAgICAgICAgICAgICAgSW50ZWdlciBvcmln\nRW50cnkgPSBvcmlnYmIuZ2V0SW50KCk7CiAgICAgICAgICAgICAgICBCeXRl\nQnVmZmVyIHJlc3VsdCA9IEJ5dGVCdWZmZXIud3JhcChscy5uZXh0RWxlbWVu\ndCgpLmdldEVudHJ5KCkpOwogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJM\nZW5ndGggb2YgcmVzdWx0OiAiICsgcmVzdWx0LmNhcGFjaXR5KCkpOwogICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJPcmlnaW5hbCBlbnRyeTogIiArIG9y\naWdFbnRyeSk7CgogICAgICAgICAgICAgICAgSW50ZWdlciByZXRyRW50cnkg\nPSByZXN1bHQuZ2V0SW50KCk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIlJldHJpZXZlZCBlbnRyeTogIiArIHJldHJFbnRyeSk7CiAgICAgICAgICAg\nICAgICBhc3NlcnRUcnVlKCJDaGVja2luZyBlbnRyeSAiICsgaSArICIgZm9y\nIGVxdWFsaXR5Iiwgb3JpZ0VudHJ5LmVxdWFscyhyZXRyRW50cnkpKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0g\nY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9y\nKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZh\naWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFp\nbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAg\nIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdFJlYWRXcml0ZVplcm8oKSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdl\ncgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlw\nZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1l\nc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBs\naC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAi\nICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAgICAg\nbGguYWRkRW50cnkobmV3IGJ5dGVbMF0pOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvKgogICAgICAgICAgICAgKiBXcml0ZSBhIG5vbi16ZXJvIGVu\ndHJ5CiAgICAgICAgICAgICAqLwogICAgICAgICAgICBCeXRlQnVmZmVyIGVu\ndHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICAgICAgZW50\ncnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAgICAgICAgICBl\nbnRyeS5wb3NpdGlvbigwKTsKICAgICAgICAgICAgZW50cmllcy5hZGQoZW50\ncnkuYXJyYXkoKSk7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGVudHJ5LmFy\ncmF5KCkpOwoKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAg\nbGggPSBia2Mub3BlbkxlZGdlcihsZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVk\nZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICBMT0cuZGVidWcoIk51bWJlciBv\nZiBlbnRyaWVzIHdyaXR0ZW46ICIgKyBsaC5nZXRMYXN0QWRkQ29uZmlybWVk\nKCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVy\nIG9mIGVudHJpZXMgd3JpdHRlbiIsIGxoLmdldExhc3RBZGRDb25maXJtZWQo\nKSA9PSBudW1FbnRyaWVzVG9Xcml0ZSk7CgogICAgICAgICAgICBFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gbHMgPSBsaC5yZWFkRW50cmllcygwLCBudW1F\nbnRyaWVzVG9Xcml0ZSAtIDEpOwogICAgICAgICAgICBpbnQgaSA9IDA7CiAg\nICAgICAgICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAg\nICAgICAgICAgICAgQnl0ZUJ1ZmZlciByZXN1bHQgPSBCeXRlQnVmZmVyLndy\nYXAobHMubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgpKTsKICAgICAgICAgICAg\nICAgIExPRy5kZWJ1ZygiTGVuZ3RoIG9mIHJlc3VsdDogIiArIHJlc3VsdC5j\nYXBhY2l0eSgpKTsKCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJDaGVj\na2luZyBpZiBlbnRyeSAiICsgaSArICIgaGFzIHplcm8gYnl0ZXMiLCByZXN1\nbHQuY2FwYWNpdHkoKSA9PSAwKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBsaC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwog\nICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBl\nciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWls\nZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRv\nIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0\naW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE11bHRpTGVkZ2Vy\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2Mu\nY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICAgICAgbGgyID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBs\nZWRnZXJQYXNzd29yZCk7CgogICAgICAgICAgICBsb25nIGxlZGdlcklkID0g\nbGguZ2V0SWQoKTsKICAgICAgICAgICAgbG9uZyBsZWRnZXJJZDIgPSBsaDIu\nZ2V0SWQoKTsKCiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2Vz\ndCgiU0hBMSIpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEIDE6\nICIgKyBsaC5nZXRJZCgpICsgIiwgTGVkZ2VyIElEIDI6ICIgKyBsaDIuZ2V0\nSWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50\ncmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAgICAgbGguYWRkRW50\ncnkobmV3IGJ5dGVbMF0pOwogICAgICAgICAgICAgICAgbGgyLmFkZEVudHJ5\nKG5ldyBieXRlWzBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGgu\nY2xvc2UoKTsKICAgICAgICAgICAgbGgyLmNsb3NlKCk7CgogICAgICAgICAg\nICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBs\nZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIGxoMiA9IGJrYy5vcGVuTGVk\nZ2VyKGxlZGdlcklkMiwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwoK\nICAgICAgICAgICAgTE9HLmRlYnVnKCJOdW1iZXIgb2YgZW50cmllcyB3cml0\ndGVuOiAiICsgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpICsgIiwgIiArIGxo\nMi5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbiBsaCAo\nIiArIGxoLmdldExhc3RBZGRDb25maXJtZWQoKSArICIpIiwgbGgKICAgICAg\nICAgICAgICAgICAgICAgICAuZ2V0TGFzdEFkZENvbmZpcm1lZCgpID09IChu\ndW1FbnRyaWVzVG9Xcml0ZSAtIDEpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1\nZSgiVmVyaWZ5aW5nIG51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW4gbGgyICgi\nICsgbGgyLmdldExhc3RBZGRDb25maXJtZWQoKSArICIpIiwgbGgyCiAgICAg\nICAgICAgICAgICAgICAgICAgLmdldExhc3RBZGRDb25maXJtZWQoKSA9PSAo\nbnVtRW50cmllc1RvV3JpdGUgLSAxKSk7CgogICAgICAgICAgICBFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gbHMgPSBsaC5yZWFkRW50cmllcygwLCBudW1F\nbnRyaWVzVG9Xcml0ZSAtIDEpOwogICAgICAgICAgICBpbnQgaSA9IDA7CiAg\nICAgICAgICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAg\nICAgICAgICAgICAgQnl0ZUJ1ZmZlciByZXN1bHQgPSBCeXRlQnVmZmVyLndy\nYXAobHMubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgpKTsKICAgICAgICAgICAg\nICAgIExPRy5kZWJ1ZygiTGVuZ3RoIG9mIHJlc3VsdDogIiArIHJlc3VsdC5j\nYXBhY2l0eSgpKTsKCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJDaGVj\na2luZyBpZiBlbnRyeSAiICsgaSArICIgaGFzIHplcm8gYnl0ZXMiLCByZXN1\nbHQuY2FwYWNpdHkoKSA9PSAwKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBsaC5jbG9zZSgpOwogICAgICAgICAgICBscyA9IGxoMi5yZWFkRW50cmll\ncygwLCBudW1FbnRyaWVzVG9Xcml0ZSAtIDEpOwogICAgICAgICAgICBpID0g\nMDsKICAgICAgICAgICAgd2hpbGUgKGxzLmhhc01vcmVFbGVtZW50cygpKSB7\nCiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIHJlc3VsdCA9IEJ5dGVCdWZm\nZXIud3JhcChscy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCkpOwogICAgICAg\nICAgICAgICAgTE9HLmRlYnVnKCJMZW5ndGggb2YgcmVzdWx0OiAiICsgcmVz\ndWx0LmNhcGFjaXR5KCkpOwoKICAgICAgICAgICAgICAgIGFzc2VydFRydWUo\nIkNoZWNraW5nIGlmIGVudHJ5ICIgKyBpICsgIiBoYXMgemVybyBieXRlcyIs\nIHJlc3VsdC5jYXBhY2l0eSgpID09IDApOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGxoMi5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIs\nIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9v\na0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVz\ndCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQg\nZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAgICBA\nVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFJlYWRX\ncml0ZUFzeW5jTGVuZ3RoKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBTeW5jT2JqIHN5bmMgPSBuZXcgU3luY09iaigpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAgICBs\naCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dv\ncmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNI\nQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAg\nICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllc1Rv\nV3JpdGU7IGkrKykgewogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRy\neSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAgICAgICBl\nbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAg\nICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAgICAgICAgICAgICAgICBlbnRy\naWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAgICAgICAgICAgICAgIGVudHJp\nZXNTaXplLmFkZChlbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBsaC5hc3luY0FkZEVudHJ5KGVudHJ5LmFycmF5KCksIHRoaXMsIHN5\nbmMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YWl0IGZvciBh\nbGwgZW50cmllcyB0byBiZSBhY2tub3dsZWRnZWQKICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3lu\nYy5jb3VudGVyIDwgbnVtRW50cmllc1RvV3JpdGUpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIkVudHJpZXMgY291bnRlciA9ICIgKyBzeW5j\nLmNvdW50ZXIpOwogICAgICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxz\nKCJFcnJvciBhZGRpbmciLCBCS0V4Y2VwdGlvbi5Db2RlLk9LLCBzeW5jLmdl\ndFJldHVybkNvZGUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9u\nZyBsZW5ndGggPSBudW1FbnRyaWVzVG9Xcml0ZSAqIDQ7CiAgICAgICAgICAg\nIGFzc2VydFRydWUoIkxlZGdlciBsZW5ndGggYmVmb3JlIGNsb3Npbmc6ICIg\nKyBsaC5nZXRMZW5ndGgoKSwgbGguZ2V0TGVuZ3RoKCkgPT0gbGVuZ3RoKTsK\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFdSSVRFIENPTVBMRVRFICoq\nKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAgICAg\nbGguY2xvc2UoKTsKCiAgICAgICAgICAgIC8vICoqKiBXUklUSU5HIFBBUlQg\nQ09NUExFVEUgLy8gUkVBRCBQQVJUIEJFR0lOUyAqKioKCiAgICAgICAgICAg\nIC8vIG9wZW4gbGVkZ2VyCiAgICAgICAgICAgIGxoID0gYmtjLm9wZW5MZWRn\nZXIobGVkZ2VySWQsIGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZSgiTGVkZ2VyIGxlbmd0aCBhZnRlciBvcGVu\naW5nOiAiICsgbGguZ2V0TGVuZ3RoKCksIGxoLmdldExlbmd0aCgpID09IGxl\nbmd0aCk7CgoKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9IGNh\ndGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWls\nZWQgZHVlIHRvIEJvb2tLZWVwZXIgZXhjZXB0aW9uIik7CiAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwo\nIlRlc3QgZmFpbGVkIGR1ZSB0byBpbnRlcnJ1cHRpb24iKTsKICAgICAgICB9\nCiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RSZWFkRnJvbU9wZW5MZWRnZXIoKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxl\nZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0\nVHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5p\ndE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQg\nPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElE\nOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAg\nICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7\nCiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4\nSW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAg\nICAgICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAg\nICAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5hcnJheSgpLmxl\nbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRyeS5hcnJh\neSgpKTsKICAgICAgICAgICAgICAgIGlmKGkgPT0gbnVtRW50cmllc1RvV3Jp\ndGUvMikgewogICAgICAgICAgICAgICAgICAgIExlZGdlckhhbmRsZSBsaE9w\nZW4gPSBia2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2Vz\ndFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgICAgICAgICAv\nLyBubyByZWNvdmVyeSBvcGVuZWQgbGVkZ2VyICdzIGxhc3QgY29uZmlybWVk\nIGVudHJ5IGlkIGlzIGxlc3MgdGhhbiB3cml0dGVuCiAgICAgICAgICAgICAg\nICAgICAgLy8gYW5kIGl0IGp1c3QgY2FuIHJlYWQgdW50aWwgKGktMSkKICAg\nICAgICAgICAgICAgICAgICBpbnQgdG9SZWFkID0gaSAtIDE7CiAgICAgICAg\nICAgICAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHJlYWRFbnRy\neSA9IGxoT3Blbi5yZWFkRW50cmllcyh0b1JlYWQsIHRvUmVhZCk7CiAgICAg\nICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRW51bWVyYXRpb24gb2YgbGVk\nZ2VyIGVudHJpZXMgaGFzIG5vIGVsZW1lbnQiLCByZWFkRW50cnkuaGFzTW9y\nZUVsZW1lbnRzKCkgPT0gdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgTGVk\nZ2VyRW50cnkgZSA9IHJlYWRFbnRyeS5uZXh0RWxlbWVudCgpOwogICAgICAg\nICAgICAgICAgICAgIGFzc2VydEVxdWFscyh0b1JlYWQsIGUuZ2V0RW50cnlJ\nZCgpKTsKICAgICAgICAgICAgICAgICAgICBBc3NlcnQuYXNzZXJ0QXJyYXlF\ncXVhbHMoZW50cmllcy5nZXQodG9SZWFkKSwgZS5nZXRFbnRyeSgpKTsKICAg\nICAgICAgICAgICAgICAgICAvLyBzaG91bGQgbm90IHdyaXR0ZW4gdG8gYSBy\nZWFkIG9ubHkgbGVkZ2VyCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgbGhPcGVuLmFkZEVudHJ5KGVudHJ5LmFy\ncmF5KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGQg\naGF2ZSB0aHJvd24gYW4gZXhjZXB0aW9uIGhlcmUiKTsKICAgICAgICAgICAg\nICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0lsbGVnYWxPcEV4Y2Vw\ndGlvbiBia2lvZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlz\nIGlzIHRoZSBjb3JyZWN0IHJlc3BvbnNlCiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiVW5leHBlY3RlZCBleGNlcHRpb24iLCBleCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGZhaWwoIlVuZXhwZWN0ZWQgZXhjZXB0\naW9uIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIC8vIGNsb3NlIHJlYWQgb25seSBsZWRnZXIgc2hvdWxkIG5vdCBjaGFu\nZ2UgbWV0YWRhdGEKICAgICAgICAgICAgICAgICAgICBsaE9wZW4uY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgbG9uZyBsYXN0ID0gbGgucmVhZExhc3RDb25maXJtZWQoKTsKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgiTGFzdCBjb25maXJtZWQgYWRkOiAiICsgbGFz\ndCwgbGFzdCA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAyKSk7CgogICAgICAg\nICAgICBMT0cuZGVidWcoIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAg\nICAgICAgICAgLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3Nl\nKCk7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAqIEFzeW5jaHJvbm91\ncyBjYWxsIHRvIHJlYWQgbGFzdCBjb25maXJtZWQgZW50cnkKICAgICAgICAg\nICAgICovCiAgICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdl\nc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5p\nbml0TWVzc2FnZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJ\nZCA9IGxoLmdldElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIg\nSUQ6ICIgKyBsaC5nZXRJZCgpKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBudW1FbnRyaWVzVG9Xcml0ZTsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBCeXRlQnVmZmVyIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0\nKTsKICAgICAgICAgICAgICAgIGVudHJ5LnB1dEludChybmcubmV4dEludCht\nYXhJbnQpKTsKICAgICAgICAgICAgICAgIGVudHJ5LnBvc2l0aW9uKDApOwoK\nICAgICAgICAgICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwog\nICAgICAgICAgICAgICAgZW50cmllc1NpemUuYWRkKGVudHJ5LmFycmF5KCku\nbGVuZ3RoKTsKICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KGVudHJ5LmFy\ncmF5KCkpOwogICAgICAgICAgICB9CgoKICAgICAgICAgICAgU3luY09iaiBz\neW5jID0gbmV3IFN5bmNPYmooKTsKICAgICAgICAgICAgbGguYXN5bmNSZWFk\nTGFzdENvbmZpcm1lZCh0aGlzLCBzeW5jKTsKCiAgICAgICAgICAgIC8vIFdh\naXQgZm9yIGZvciBsYXN0IGNvbmZpcm1lZAogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChzeW5jLmxh\nc3RDb25maXJtZWQgPT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICBMT0cu\nZGVidWcoIkNvdW50ZXIgPSAiICsgc3luYy5sYXN0Q29uZmlybWVkKTsKICAg\nICAgICAgICAgICAgICAgICBzeW5jLndhaXQoKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscygiRXJyb3IgcmVhZGlu\nZyIsIEJLRXhjZXB0aW9uLkNvZGUuT0ssIHN5bmMuZ2V0UmV0dXJuQ29kZSgp\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTGFz\ndCBjb25maXJtZWQgYWRkOiAiICsgc3luYy5sYXN0Q29uZmlybWVkLCBzeW5j\nLmxhc3RDb25maXJtZWQgPT0gKG51bUVudHJpZXNUb1dyaXRlIC0gMikpOwoK\nICAgICAgICAgICAgTE9HLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioq\nIik7CiAgICAgICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBs\naC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAg\nICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBlciBl\neGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQi\nLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGlu\ndGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1l\nb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFJlYWRGcm9tT3Blbkxl\nZGdlck9wZW5PbmNlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgICAg\nIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNz\nd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2VzdCgi\nU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdldElkKCk7CiAg\nICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBsaC5nZXRJZCgp\nKTsKICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoT3BlbiA9IGJrYy5vcGVu\nTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2Vy\nUGFzc3dvcmQpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51\nbUVudHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAg\nICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwog\nICAgICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CgogICAgICAgICAg\nICAgICAgZW50cmllcy5hZGQoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAg\nICAgICBlbnRyaWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwog\nICAgICAgICAgICAgICAgbGguYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7CiAg\nICAgICAgICAgICAgICBpZiAoaSA9PSBudW1FbnRyaWVzVG9Xcml0ZSAvIDIp\nIHsKICAgICAgICAgICAgICAgICAgICAvLyBubyByZWNvdmVyeSBvcGVuZWQg\nbGVkZ2VyICdzIGxhc3QgY29uZmlybWVkIGVudHJ5IGlkIGlzCiAgICAgICAg\nICAgICAgICAgICAgLy8gbGVzcyB0aGFuIHdyaXR0ZW4KICAgICAgICAgICAg\nICAgICAgICAvLyBhbmQgaXQganVzdCBjYW4gcmVhZCB1bnRpbCAoaS0xKQog\nICAgICAgICAgICAgICAgICAgIGludCB0b1JlYWQgPSBpIC0gMTsKCiAgICAg\nICAgICAgICAgICAgICAgbG9uZyByZWFkTGFzdENvbmZpcm1lZCA9IGxoT3Bl\nbi5yZWFkTGFzdENvbmZpcm1lZCgpOwogICAgICAgICAgICAgICAgICAgIGFz\nc2VydFRydWUocmVhZExhc3RDb25maXJtZWQgIT0gMCk7CiAgICAgICAgICAg\nICAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHJlYWRFbnRyeSA9\nIGxoT3Blbi5yZWFkRW50cmllcyh0b1JlYWQsIHRvUmVhZCk7CiAgICAgICAg\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRW51bWVyYXRpb24gb2YgbGVkZ2Vy\nIGVudHJpZXMgaGFzIG5vIGVsZW1lbnQiLCByZWFkRW50cnkuaGFzTW9yZUVs\nZW1lbnRzKCkgPT0gdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgTGVkZ2Vy\nRW50cnkgZSA9IHJlYWRFbnRyeS5uZXh0RWxlbWVudCgpOwogICAgICAgICAg\nICAgICAgICAgIGFzc2VydEVxdWFscyh0b1JlYWQsIGUuZ2V0RW50cnlJZCgp\nKTsKICAgICAgICAgICAgICAgICAgICBBc3NlcnQuYXNzZXJ0QXJyYXlFcXVh\nbHMoZW50cmllcy5nZXQodG9SZWFkKSwgZS5nZXRFbnRyeSgpKTsKICAgICAg\nICAgICAgICAgICAgICAvLyBzaG91bGQgbm90IHdyaXR0ZW4gdG8gYSByZWFk\nIG9ubHkgbGVkZ2VyCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgbGhPcGVuLmFkZEVudHJ5KGVudHJ5LmFycmF5\nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGQgaGF2\nZSB0aHJvd24gYW4gZXhjZXB0aW9uIGhlcmUiKTsKICAgICAgICAgICAgICAg\nICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0lsbGVnYWxPcEV4Y2VwdGlv\nbiBia2lvZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGlz\nIHRoZSBjb3JyZWN0IHJlc3BvbnNlCiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiVW5leHBlY3RlZCBleGNlcHRpb24iLCBleCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZhaWwoIlVuZXhwZWN0ZWQgZXhjZXB0aW9u\nIik7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICBsb25nIGxhc3QgPSBsaC5yZWFk\nTGFzdENvbmZpcm1lZCgpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJMYXN0\nIGNvbmZpcm1lZCBhZGQ6ICIgKyBsYXN0LCBsYXN0ID09IChudW1FbnRyaWVz\nVG9Xcml0ZSAtIDIpKTsKCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFdS\nSVRFIENPTVBMRVRFICoqKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBsZWRn\nZXIKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgLy8gY2xv\nc2UgcmVhZCBvbmx5IGxlZGdlciBzaG91bGQgbm90IGNoYW5nZSBtZXRhZGF0\nYQogICAgICAgICAgICBsaE9wZW4uY2xvc2UoKTsKICAgICAgICB9IGNhdGNo\nIChCS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVz\ndCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQg\nZHVlIHRvIEJvb2tLZWVwZXIgZXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRj\naCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cu\nZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRl\nc3QgZmFpbGVkIGR1ZSB0byBpbnRlcnJ1cHRpb24iKTsKICAgICAgICB9CiAg\nICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RSZWFkRnJvbU9wZW5MZWRnZXJaZXJvQW5kT25lKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ3JlYXRl\nIGEgbGVkZ2VyCiAgICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihk\naWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJr\nYy5pbml0TWVzc2FnZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBsZWRn\nZXJJZCA9IGxoLmdldElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRn\nZXIgSUQ6ICIgKyBsaC5nZXRJZCgpKTsKICAgICAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoT3BlbiA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJ\nZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwoKICAgICAgICAgICAg\nLyoKICAgICAgICAgICAgICogV2UgaGF2ZW4ndCB3cml0dGVuIGFueXRoaW5n\nLCBzbyBpdCBzaG91bGQgYmUgZW1wdHkuCiAgICAgICAgICAgICAqLwogICAg\nICAgICAgICBMT0cuZGVidWcoIkNoZWNraW5nIHRoYXQgaXQgaXMgZW1wdHki\nKTsKICAgICAgICAgICAgbG9uZyByZWFkTGFzdENvbmZpcm1lZCA9IGxoT3Bl\nbi5yZWFkTGFzdENvbmZpcm1lZCgpOwogICAgICAgICAgICBhc3NlcnRUcnVl\nKCJMYXN0IGNvbmZpcm1lZCBoYXMgdGhlIHdyb25nIHZhbHVlIiwKICAgICAg\nICAgICAgICAgICAgICAgICByZWFkTGFzdENvbmZpcm1lZCA9PSBMZWRnZXJI\nYW5kbGUuSU5WQUxJRF9FTlRSWV9JRCk7CgogICAgICAgICAgICAvKgogICAg\nICAgICAgICAgKiBXcml0aW5nIG9uZSBlbnRyeS4KICAgICAgICAgICAgICov\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiR29pbmcgdG8gd3JpdGUgb25lIGVu\ndHJ5Iik7CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgZW50cnkgPSBCeXRlQnVm\nZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5n\nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAgIGVudHJ5LnBvc2l0aW9u\nKDApOwoKICAgICAgICAgICAgZW50cmllcy5hZGQoZW50cnkuYXJyYXkoKSk7\nCiAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5hcnJheSgpLmxl\nbmd0aCk7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkp\nOwoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICogVGhlIGhpbnQgc2hv\ndWxkIHN0aWxsIGluZGljYXRlIHRoYXQgdGhlcmUgaXMgbm8gY29uZmlybWVk\nCiAgICAgICAgICAgICAqIGFkZC4KICAgICAgICAgICAgICovCiAgICAgICAg\nICAgIExPRy5kZWJ1ZygiQ2hlY2tpbmcgdGhhdCBpdCBpcyBzdGlsbCBlbXB0\neSBldmVuIGFmdGVyIHdyaXRpbmcgb25lIGVudHJ5Iik7CiAgICAgICAgICAg\nIHJlYWRMYXN0Q29uZmlybWVkID0gbGhPcGVuLnJlYWRMYXN0Q29uZmlybWVk\nKCk7CiAgICAgICAgICAgIGFzc2VydFRydWUocmVhZExhc3RDb25maXJtZWQg\nPT0gTGVkZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQpOwoKICAgICAgICAg\nICAgLyoKICAgICAgICAgICAgICogQWRkaW5nIG9uZSBtb3JlLCBhbmQgdGhp\ncyB0aW1lIHdlIHNob3VsZCBleHBlY3QgdG8KICAgICAgICAgICAgICogc2Vl\nIG9uZSBlbnRyeS4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIGVudHJ5\nID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICAgICAgZW50cnku\ncHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAgICAgICAgICBlbnRy\neS5wb3NpdGlvbigwKTsKCiAgICAgICAgICAgIGVudHJpZXMuYWRkKGVudHJ5\nLmFycmF5KCkpOwogICAgICAgICAgICBlbnRyaWVzU2l6ZS5hZGQoZW50cnku\nYXJyYXkoKS5sZW5ndGgpOwogICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRy\neS5hcnJheSgpKTsKCiAgICAgICAgICAgIExPRy5pbmZvKCJDaGVja2luZyB0\naGF0IGl0IGhhcyBhbiBlbnRyeSIpOwogICAgICAgICAgICByZWFkTGFzdENv\nbmZpcm1lZCA9IGxoT3Blbi5yZWFkTGFzdENvbmZpcm1lZCgpOwogICAgICAg\nICAgICBhc3NlcnRUcnVlKHJlYWRMYXN0Q29uZmlybWVkID09IDBMKTsKCiAg\nICAgICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9z\nZSgpOwogICAgICAgICAgICAvLyBjbG9zZSByZWFkIG9ubHkgbGVkZ2VyIHNo\nb3VsZCBub3QgY2hhbmdlIG1ldGFkYXRhCiAgICAgICAgICAgIGxoT3Blbi5j\nbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAg\nICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNl\ncHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBl\nKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVy\ncnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCgogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RMYXN0Q29uZmlybWVkQWRk\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2Mu\nY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAg\nICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAg\nTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdldElkKCkpOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJpZXNUb1dyaXRlOyBp\nKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgZW50cnkgPSBCeXRl\nQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAgICAgICAgZW50cnkucHV0\nSW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAgICAgICAgICAgICAgZW50\ncnkucG9zaXRpb24oMCk7CgogICAgICAgICAgICAgICAgZW50cmllcy5hZGQo\nZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgICAgICBlbnRyaWVzU2l6ZS5h\nZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAgICAgICAgICAgICAgbGgu\nYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGxvbmcgbGFzdCA9IGxoLnJlYWRMYXN0Q29uZmlybWVkKCk7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoIkxhc3QgY29uZmlybWVkIGFkZDogIiAr\nIGxhc3QsIGxhc3QgPT0gKG51bUVudHJpZXNUb1dyaXRlIC0gMikpOwoKICAg\nICAgICAgICAgTE9HLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7\nCiAgICAgICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5j\nbG9zZSgpOwogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBBc3luY2hy\nb25vdXMgY2FsbCB0byByZWFkIGxhc3QgY29uZmlybWVkIGVudHJ5CiAgICAg\nICAgICAgICAqLwogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIo\nZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBi\na2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVk\nZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVk\nZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAg\nICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGUoNCk7CiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJ\nbnQobWF4SW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigw\nKTsKCiAgICAgICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgp\nKTsKICAgICAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5hcnJh\neSgpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRy\neS5hcnJheSgpKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIFN5bmNP\nYmogc3luYyA9IG5ldyBTeW5jT2JqKCk7CiAgICAgICAgICAgIGxoLmFzeW5j\nUmVhZExhc3RDb25maXJtZWQodGhpcywgc3luYyk7CgogICAgICAgICAgICAv\nLyBXYWl0IGZvciBmb3IgbGFzdCBjb25maXJtZWQKICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3lu\nYy5sYXN0Q29uZmlybWVkID09IExlZGdlckhhbmRsZS5JTlZBTElEX0VOVFJZ\nX0lEKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJDb3VudGVy\nID0gIiArIHN5bmMubGFzdENvbmZpcm1lZCk7CiAgICAgICAgICAgICAgICAg\nICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBhc3NlcnRFcXVhbHMoIkVycm9yIHJlYWRpbmciLCBCS0V4Y2VwdGlv\nbi5Db2RlLk9LLCBzeW5jLmdldFJldHVybkNvZGUoKSk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGFzc2VydFRydWUoIkxhc3QgY29uZmlybWVkIGFk\nZDogIiArIHN5bmMubGFzdENvbmZpcm1lZCwgc3luYy5sYXN0Q29uZmlybWVk\nID09IChudW1FbnRyaWVzVG9Xcml0ZSAtIDIpKTsKCiAgICAgICAgICAgIExP\nRy5kZWJ1ZygiKioqIFdSSVRFIENPTVBMRVRFICoqKiIpOwogICAgICAgICAg\nICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAg\nICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgi\nVGVzdCBmYWlsZWQgZHVlIHRvIEJvb2tLZWVwZXIgZXhjZXB0aW9uIik7CiAg\nICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAg\nICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBpbnRlcnJ1cHRpb24iKTsK\nICAgICAgICB9CiAgICB9CgoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgYWRkQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIGxvbmcg\nZW50cnlJZCwgT2JqZWN0IGN0eCkgewogICAgICAgIFN5bmNPYmogc3luYyA9\nIChTeW5jT2JqKSBjdHg7CiAgICAgICAgc3luYy5zZXRSZXR1cm5Db2RlKHJj\nKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAg\nc3luYy5jb3VudGVyKys7CiAgICAgICAgICAgIHN5bmMubm90aWZ5KCk7CiAg\nICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\ncmVhZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nU3luY09iaiBzeW5jID0gKFN5bmNPYmopIGN0eDsKICAgICAgICBzeW5jLnNl\ndExlZGdlckVudHJpZXMoc2VxKTsKICAgICAgICBzeW5jLnNldFJldHVybkNv\nZGUocmMpOwogICAgICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAg\nICAgICBzeW5jLnZhbHVlID0gdHJ1ZTsKICAgICAgICAgICAgc3luYy5ub3Rp\nZnkoKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCByZWFkTGFzdENvbmZpcm1lZENvbXBsZXRlKGludCByYywgbG9u\nZyBsYXN0Q29uZmlybWVkLCBPYmplY3QgY3R4KSB7CiAgICAgICAgU3luY09i\naiBzeW5jID0gKFN5bmNPYmopIGN0eDsKICAgICAgICBzeW5jLnNldFJldHVy\nbkNvZGUocmMpOwogICAgICAgIHN5bmNocm9uaXplZChzeW5jKSB7CiAgICAg\nICAgICAgIHN5bmMubGFzdENvbmZpcm1lZCA9IGxhc3RDb25maXJtZWQ7CiAg\nICAgICAgICAgIHN5bmMubm90aWZ5KCk7CiAgICAgICAgfQogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc2V0VXAo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5zZXRVcCgpOwog\nICAgICAgIHJuZyA9IG5ldyBSYW5kb20oU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCkpOyAvLyBJbml0aWFsaXplIHRoZSBSYW5kb20KICAgICAgICAvLyBO\ndW1iZXIgR2VuZXJhdG9yCiAgICAgICAgZW50cmllcyA9IG5ldyBBcnJheUxp\nc3Q8Ynl0ZVtdPigpOyAvLyBpbml0aWFsaXplIHRoZSBlbnRyaWVzIGxpc3QK\nICAgICAgICBlbnRyaWVzU2l6ZSA9IG5ldyBBcnJheUxpc3Q8SW50ZWdlcj4o\nKTsKICAgIH0KCiAgICAvKiBDbGVhbiB1cCBhIGRpcmVjdG9yeSByZWN1cnNp\ndmVseSAqLwogICAgcHJvdGVjdGVkIGJvb2xlYW4gY2xlYW5VcERpcihGaWxl\nIGRpcikgewogICAgICAgIGlmIChkaXIuaXNEaXJlY3RvcnkoKSkgewogICAg\nICAgICAgICBMT0cuaW5mbygiQ2xlYW5pbmcgdXAgIiArIGRpci5nZXROYW1l\nKCkpOwogICAgICAgICAgICBTdHJpbmdbXSBjaGlsZHJlbiA9IGRpci5saXN0\nKCk7CiAgICAgICAgICAgIGZvciAoU3RyaW5nIHN0cmluZyA6IGNoaWxkcmVu\nKSB7CiAgICAgICAgICAgICAgICBib29sZWFuIHN1Y2Nlc3MgPSBjbGVhblVw\nRGlyKG5ldyBGaWxlKGRpciwgc3RyaW5nKSk7CiAgICAgICAgICAgICAgICBp\nZiAoIXN1Y2Nlc3MpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIFRoZSBkaXJl\nY3RvcnkgaXMgbm93IGVtcHR5IHNvIGRlbGV0ZSBpdAogICAgICAgIHJldHVy\nbiBkaXIuZGVsZXRlKCk7CiAgICB9CgogICAgLyogVXNlciBmb3IgdGVzdGlu\nZyBwdXJwb3Nlcywgdm9pZCAqLwogICAgY2xhc3MgZW1wdHlXYXRjaGVyIGlt\ncGxlbWVudHMgV2F0Y2hlciB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAg\nICAgICB9CiAgICB9Cgp9Cg==\n","encoding":"base64"}

