{"sha":"ad2391a97dd875de58f37e7c06678a85efe893fc","node_id":"MDQ6QmxvYjE1NzU5NTY6YWQyMzkxYTk3ZGQ4NzVkZTU4ZjM3ZTdjMDY2NzhhODVlZmU4OTNmYw==","size":4054,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ad2391a97dd875de58f37e7c06678a85efe893fc","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBv\ncnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsK\naW1wb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0Lio7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsK\naW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQganVuaXQuZnJhbWV3\nb3JrLlRlc3RDYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkJvb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuQm9va2llOwoKcHVibGljIGNsYXNzIEJvb2tpZVpLRXhwaXJl\nVGVzdCBleHRlbmRzIEJvb2tLZWVwZXJDbHVzdGVyVGVzdENhc2UgewoKICAg\nIHB1YmxpYyBCb29raWVaS0V4cGlyZVRlc3QoKSB7CiAgICAgICAgc3VwZXIo\nMCk7CiAgICAgICAgLy8gNjAwMCBpcyBtaW5pbXVtIGR1ZSB0byBkZWZhdWx0\nIHRpY2sgdGltZQogICAgICAgIGJhc2VDb25mLnNldFprVGltZW91dCg2MDAw\nKTsKICAgICAgICBiYXNlQ2xpZW50Q29uZi5zZXRaa1RpbWVvdXQoNjAwMCk7\nCiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RCb29raWVTZXJ2ZXJaS0V4cGlyZUJlaGF2aW91cigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIEJvb2tpZVNlcnZlciBzZXJ2ZXIgPSBu\ndWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEZpbGUgZiA9IEZpbGUu\nY3JlYXRlVGVtcEZpbGUoImJvb2tpZXNlcnZlciIsICJ0ZXN0Iik7CiAgICAg\nICAgICAgIGYuZGVsZXRlKCk7CiAgICAgICAgICAgIGYubWtkaXIoKTsKCiAg\nICAgICAgICAgIEhhc2hTZXQ8VGhyZWFkPiB0aHJlYWRzZXQgPSBuZXcgSGFz\naFNldDxUaHJlYWQ+KCk7CiAgICAgICAgICAgIGludCB0aHJlYWRDb3VudCA9\nIFRocmVhZC5hY3RpdmVDb3VudCgpOwogICAgICAgICAgICBUaHJlYWQgdGhy\nZWFkc1tdID0gbmV3IFRocmVhZFt0aHJlYWRDb3VudCoyXTsKICAgICAgICAg\nICAgdGhyZWFkQ291bnQgPSBUaHJlYWQuZW51bWVyYXRlKHRocmVhZHMpOwog\nICAgICAgICAgICBmb3IoaW50IGkgPSAwOyBpIDwgdGhyZWFkQ291bnQ7IGkr\nKykgewogICAgICAgICAgICAgICAgaWYgKHRocmVhZHNbaV0uZ2V0TmFtZSgp\nLmluZGV4T2YoIlNlbmRUaHJlYWQiKSAhPSAtMSkgewogICAgICAgICAgICAg\nICAgICAgIHRocmVhZHNldC5hZGQodGhyZWFkc1tpXSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ld1NlcnZlckNvbmZpZ3VyYXRpb24oUG9ydE1h\nbmFnZXIubmV4dEZyZWVQb3J0KCksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgemtVdGls\nLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSwgZiwgbmV3IEZpbGVbXSB7\nIGYgfSk7CiAgICAgICAgICAgIHNlcnZlciA9IG5ldyBCb29raWVTZXJ2ZXIo\nY29uZik7CiAgICAgICAgICAgIHNlcnZlci5zdGFydCgpOwoKICAgICAgICAg\nICAgaW50IHNlY29uZHNUb1dhaXQgPSA1OwogICAgICAgICAgICB3aGlsZSAo\nIXNlcnZlci5pc1J1bm5pbmcoKSkgewogICAgICAgICAgICAgICAgVGhyZWFk\nLnNsZWVwKDEwMDApOwogICAgICAgICAgICAgICAgaWYgKHNlY29uZHNUb1dh\naXQtLSA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZmFpbCgiQm9va2ll\nIG5ldmVyIHN0YXJ0ZWQiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBUaHJlYWQgc2VuZHRocmVhZCA9IG51bGw7CiAg\nICAgICAgICAgIHRocmVhZENvdW50ID0gVGhyZWFkLmFjdGl2ZUNvdW50KCk7\nCiAgICAgICAgICAgIHRocmVhZHMgPSBuZXcgVGhyZWFkW3RocmVhZENvdW50\nKjJdOwogICAgICAgICAgICB0aHJlYWRDb3VudCA9IFRocmVhZC5lbnVtZXJh\ndGUodGhyZWFkcyk7CiAgICAgICAgICAgIGZvcihpbnQgaSA9IDA7IGkgPCB0\naHJlYWRDb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAodGhyZWFk\nc1tpXS5nZXROYW1lKCkuaW5kZXhPZigiU2VuZFRocmVhZCIpICE9IC0xCiAg\nICAgICAgICAgICAgICAgICAgICAgICYmICF0aHJlYWRzZXQuY29udGFpbnMo\ndGhyZWFkc1tpXSkpIHsKICAgICAgICAgICAgICAgICAgICBzZW5kdGhyZWFk\nID0gdGhyZWFkc1tpXTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhc3Nl\ncnROb3ROdWxsKCJTZW5kIHRocmVhZCBub3QgZm91bmQiLCBzZW5kdGhyZWFk\nKTsKCiAgICAgICAgICAgIHNlbmR0aHJlYWQuc3VzcGVuZCgpOwogICAgICAg\nICAgICBUaHJlYWQuc2xlZXAoMipjb25mLmdldFprVGltZW91dCgpKTsKICAg\nICAgICAgICAgc2VuZHRocmVhZC5yZXN1bWUoKTsKCiAgICAgICAgICAgIC8v\nIGFsbG93IHdhdGNoZXIgdGhyZWFkIHRvIHJ1bgogICAgICAgICAgICBzZWNv\nbmRzVG9XYWl0ID0gMjA7CiAgICAgICAgICAgIHdoaWxlIChzZXJ2ZXIuaXNC\nb29raWVSdW5uaW5nKCkKICAgICAgICAgICAgICAgICAgIHx8IHNlcnZlci5p\nc05pb1NlcnZlclJ1bm5pbmcoKQogICAgICAgICAgICAgICAgICAgfHwgc2Vy\ndmVyLmlzUnVubmluZygpKSB7CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xl\nZXAoMTAwMCk7CiAgICAgICAgICAgICAgICBpZiAoc2Vjb25kc1RvV2FpdC0t\nIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhc3NlcnRGYWxz\nZSgiQm9va2llIHNob3VsZCBoYXZlIHNodXRkb3duIG9uIGxvc2luZyB6ayBz\nZXNzaW9uIiwgc2VydmVyLmlzQm9va2llUnVubmluZygpKTsKICAgICAgICAg\nICAgYXNzZXJ0RmFsc2UoIk5pbyBTZXJ2ZXIgc2hvdWxkIGhhdmUgc2h1dGRv\nd24gb24gbG9zaW5nIHprIHNlc3Npb24iLCBzZXJ2ZXIuaXNOaW9TZXJ2ZXJS\ndW5uaW5nKCkpOwogICAgICAgICAgICBhc3NlcnRGYWxzZSgiQm9va2llIFNl\ncnZlciBzaG91bGQgaGF2ZSBzaHV0ZG93biBvbiBsb3Npbmcgemsgc2Vzc2lv\nbiIsIHNlcnZlci5pc1J1bm5pbmcoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgc2VydmVyLnNodXRkb3duKCk7CiAgICAgICAgfQogICAg\nfQp9Cg==\n","encoding":"base64"}

