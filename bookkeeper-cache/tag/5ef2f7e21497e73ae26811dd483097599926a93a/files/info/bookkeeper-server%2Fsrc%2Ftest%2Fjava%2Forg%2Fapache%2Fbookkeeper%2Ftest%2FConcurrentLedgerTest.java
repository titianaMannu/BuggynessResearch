{"sha":"1ddabe79cb1d97f245dd17348241843ab95af5d2","node_id":"MDQ6QmxvYjE1NzU5NTY6MWRkYWJlNzljYjFkOTdmMjQ1ZGQxNzM0ODI0MTg0M2FiOTVhZjVkMg==","size":6638,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1ddabe79cb1d97f245dd17348241843ab95af5d2","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5qdW5pdC5BZnRl\ncjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdENhc2U7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZh\nY3Rvcnk7CgovKioKICogVGVzdHMgd3JpdGluZyB0byBjb25jdXJyZW50IGxl\nZGdlcnMKICovCnB1YmxpYyBjbGFzcyBDb25jdXJyZW50TGVkZ2VyVGVzdCBl\neHRlbmRzIFRlc3RDYXNlIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQ29uY3VycmVudExlZGdlclRlc3QuY2xh\nc3MpOwoKICAgIEJvb2tpZSBib29raWU7CiAgICBGaWxlIHR4bkRpciwgbGVk\nZ2VyRGlyOwogICAgaW50IHJlY3ZUaW1lb3V0ID0gMTAwMDA7CiAgICBTZW1h\ncGhvcmUgdGhyb3R0bGU7CiAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwoKICAgIEBPdmVycmlkZQog\nICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgdHhuRGlyTmFtZSA9IFN5c3RlbS5n\nZXRQcm9wZXJ0eSgidHhuRGlyIik7CiAgICAgICAgaWYgKHR4bkRpck5hbWUg\nIT0gbnVsbCkgewogICAgICAgICAgICB0eG5EaXIgPSBuZXcgRmlsZSh0eG5E\naXJOYW1lKTsKICAgICAgICB9CiAgICAgICAgU3RyaW5nIGxlZGdlckRpck5h\nbWUgPSBTeXN0ZW0uZ2V0UHJvcGVydHkoImxlZGdlckRpciIpOwogICAgICAg\nIGlmIChsZWRnZXJEaXJOYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgbGVk\nZ2VyRGlyID0gbmV3IEZpbGUobGVkZ2VyRGlyTmFtZSk7CiAgICAgICAgfQog\nICAgICAgIEZpbGUgdG1wRmlsZSA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJv\nb2siLCAiLnR4biIsIHR4bkRpcik7CiAgICAgICAgdG1wRmlsZS5kZWxldGUo\nKTsKICAgICAgICB0eG5EaXIgPSBuZXcgRmlsZSh0bXBGaWxlLmdldFBhcmVu\ndCgpLCB0bXBGaWxlLmdldE5hbWUoKSsiLmRpciIpOwogICAgICAgIHR4bkRp\nci5ta2RpcnMoKTsKICAgICAgICB0bXBGaWxlID0gRmlsZS5jcmVhdGVUZW1w\nRmlsZSgiYm9vayIsICIubGVkZ2VyIiwgbGVkZ2VyRGlyKTsKICAgICAgICBs\nZWRnZXJEaXIgPSBuZXcgRmlsZSh0bXBGaWxlLmdldFBhcmVudCgpLCB0bXBG\naWxlLmdldE5hbWUoKSsiLmRpciIpOwogICAgICAgIGxlZGdlckRpci5ta2Rp\ncnMoKTsKCiAgICAgICAgY29uZi5zZXRCb29raWVQb3J0KDUwMDApOwogICAg\nICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKG51bGwpOwogICAgICAgIGNvbmYuc2V0\nSm91cm5hbERpck5hbWUodHhuRGlyLmdldFBhdGgoKSk7CiAgICAgICAgY29u\nZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIu\nZ2V0UGF0aCgpIH0pOwogICAgICAgIGJvb2tpZSA9IG5ldyBCb29raWUoY29u\nZik7CiAgICAgICAgYm9va2llLnN0YXJ0KCk7CiAgICB9CgogICAgc3RhdGlj\nIHZvaWQgcmVjdXJzaXZlRGVsZXRlKEZpbGUgZikgewogICAgICAgIGlmIChm\nLmlzRmlsZSgpKSB7CiAgICAgICAgICAgIGYuZGVsZXRlKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgZm9yKEZpbGUgaTogZi5saXN0RmlsZXMo\nKSkgewogICAgICAgICAgICAgICAgcmVjdXJzaXZlRGVsZXRlKGkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGYuZGVsZXRlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgQEFmdGVyCiAgICBwdWJsaWMgdm9p\nZCB0ZWFyRG93bigpIHsKICAgICAgICBib29raWUuc2h1dGRvd24oKTsKICAg\nICAgICByZWN1cnNpdmVEZWxldGUodHhuRGlyKTsKICAgICAgICByZWN1cnNp\ndmVEZWxldGUobGVkZ2VyRGlyKTsKICAgIH0KCiAgICBieXRlIHplcm9zW10g\nPSBuZXcgYnl0ZVsxNl07CgogICAgaW50IGl0ZXJhdGlvbnMgPSA1MTsKICAg\nIHsKICAgICAgICBTdHJpbmcgaXRlcmF0aW9uc1N0cmluZyA9IFN5c3RlbS5n\nZXRQcm9wZXJ0eSgiaXRlcmF0aW9ucyIpOwogICAgICAgIGlmIChpdGVyYXRp\nb25zU3RyaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0aW9ucyA9\nIEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9uc1N0cmluZyk7CiAgICAgICAg\nfQogICAgfQogICAgaW50IGl0ZXJhdGlvblN0ZXAgPSAyNTsKICAgIHsKICAg\nICAgICBTdHJpbmcgaXRlcmF0aW9uc1N0cmluZyA9IFN5c3RlbS5nZXRQcm9w\nZXJ0eSgiaXRlcmF0aW9uU3RlcCIpOwogICAgICAgIGlmIChpdGVyYXRpb25z\nU3RyaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0aW9uU3RlcCA9\nIEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9uc1N0cmluZyk7CiAgICAgICAg\nfQogICAgfQogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RDb25jdXJyZW50V3JpdGUoKSB0aHJvd3MgSU9FeGNlcHRpb24s\nIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAg\nICAgIGludCBzaXplID0gMTAyNDsKICAgICAgICBpbnQgdG90YWx3cml0ZXMg\nPSAxMjg7CiAgICAgICAgaWYgKFN5c3RlbS5nZXRQcm9wZXJ0eSgidG90YWx3\ncml0ZXMiKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHRvdGFsd3JpdGVzID0g\nSW50ZWdlci5wYXJzZUludChTeXN0ZW0uZ2V0UHJvcGVydHkoInRvdGFsd3Jp\ndGVzIikpOwogICAgICAgIH0KICAgICAgICBMT0cuaW5mbygiUnVubmluZyB1\ncCB0byAiICsgaXRlcmF0aW9ucyArICIgaXRlcmF0aW9ucyIpOwogICAgICAg\nIExPRy5pbmZvKCJUb3RhbCB3cml0ZXMgPSAiICsgdG90YWx3cml0ZXMpOwog\nICAgICAgIGludCBsZWRnZXJzOwogICAgICAgIGZvcihsZWRnZXJzID0gMTsg\nbGVkZ2VycyA8PSBpdGVyYXRpb25zOyBsZWRnZXJzICs9IGl0ZXJhdGlvblN0\nZXApIHsKICAgICAgICAgICAgbG9uZyBkdXJhdGlvbiA9IGRvV3JpdGVzKGxl\nZGdlcnMsIHNpemUsIHRvdGFsd3JpdGVzKTsKICAgICAgICAgICAgTE9HLmlu\nZm8odG90YWx3cml0ZXMgKyAiIG9uICIgKyBsZWRnZXJzICsgIiB0b29rICIg\nKyBkdXJhdGlvbiArICIgbXMiKTsKICAgICAgICB9CiAgICAgICAgTE9HLmlu\nZm8oImxlZGdlcnMgIiArIGxlZGdlcnMpOwogICAgICAgIGZvcihsZWRnZXJz\nID0gMTsgbGVkZ2VycyA8PSBpdGVyYXRpb25zOyBsZWRnZXJzICs9IGl0ZXJh\ndGlvblN0ZXApIHsKICAgICAgICAgICAgbG9uZyBkdXJhdGlvbiA9IGRvUmVh\nZHMobGVkZ2Vycywgc2l6ZSwgdG90YWx3cml0ZXMpOwogICAgICAgICAgICBM\nT0cuaW5mbyhsZWRnZXJzICsgIiByZWFkICIgKyBkdXJhdGlvbiArICIgbXMi\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBsb25nIGRvUmVhZHMo\naW50IGxlZGdlcnMsIGludCBzaXplLCBpbnQgdG90YWx3cml0ZXMpCiAgICAg\nICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRp\nb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBzdGFydCA9IFN5\nc3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgIGZvcihpbnQgaSA9\nIDE7IGkgPD0gdG90YWx3cml0ZXMvbGVkZ2VyczsgaSsrKSB7CiAgICAgICAg\nICAgIGZvcihpbnQgaiA9IDE7IGogPD0gbGVkZ2VyczsgaisrKSB7CiAgICAg\nICAgICAgICAgICBCeXRlQnVmZmVyIGVudHJ5ID0gYm9va2llLnJlYWRFbnRy\neShqLCBpKTsKICAgICAgICAgICAgICAgIC8vIHNraXAgdGhlIGxlZGdlciBp\nZCBhbmQgdGhlIGVudHJ5IGlkCiAgICAgICAgICAgICAgICBlbnRyeS5nZXRM\nb25nKCk7CiAgICAgICAgICAgICAgICBlbnRyeS5nZXRMb25nKCk7CiAgICAg\nICAgICAgICAgICBhc3NlcnRFcXVhbHMoaiArICJAIiArIGksIGorMiwgZW50\ncnkuZ2V0TG9uZygpKTsKICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscyhq\nICsgIkAiICsgaSwgaSszLCBlbnRyeS5nZXRMb25nKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIGxvbmcgZmluaXNoID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgcmV0dXJuIGZpbmlzaCAtIHN0\nYXJ0OwogICAgfQogICAgcHJpdmF0ZSBsb25nIGRvV3JpdGVzKGludCBsZWRn\nZXJzLCBpbnQgc2l6ZSwgaW50IHRvdGFsd3JpdGVzKQogICAgICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29r\naWVFeGNlcHRpb24gewogICAgICAgIHRocm90dGxlID0gbmV3IFNlbWFwaG9y\nZSgxMDAwMCk7CiAgICAgICAgV3JpdGVDYWxsYmFjayBjYiA9IG5ldyBXcml0\nZUNhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgcHVibGljIHZvaWQgd3JpdGVDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVk\nZ2VySWQsIGxvbmcgZW50cnlJZCwKICAgICAgICAgICAgSW5ldFNvY2tldEFk\nZHJlc3MgYWRkciwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgQXRv\nbWljSW50ZWdlciBjb3VudGVyID0gKEF0b21pY0ludGVnZXIpY3R4OwogICAg\nICAgICAgICAgICAgY291bnRlci5nZXRBbmRJbmNyZW1lbnQoKTsKICAgICAg\nICAgICAgICAgIHRocm90dGxlLnJlbGVhc2UoKTsKICAgICAgICAgICAgfQog\nICAgICAgIH07CiAgICAgICAgQXRvbWljSW50ZWdlciBjb3VudGVyID0gbmV3\nIEF0b21pY0ludGVnZXIoKTsKICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgZm9yKGludCBpID0gMTsg\naSA8PSB0b3RhbHdyaXRlcy9sZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAg\nZm9yKGludCBqID0gMTsgaiA8PSBsZWRnZXJzOyBqKyspIHsKICAgICAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgYnl0ZXMgPSBCeXRlQnVmZmVyLmFsbG9jYXRl\nKHNpemUpOwogICAgICAgICAgICAgICAgYnl0ZXMucHV0TG9uZyhqKTsKICAg\nICAgICAgICAgICAgIGJ5dGVzLnB1dExvbmcoaSk7CiAgICAgICAgICAgICAg\nICBieXRlcy5wdXRMb25nKGorMik7CiAgICAgICAgICAgICAgICBieXRlcy5w\ndXRMb25nKGkrMyk7CiAgICAgICAgICAgICAgICBieXRlcy5wdXQoKCJUaGlz\nIGlzIGxlZGdlciAiICsgaiArICIgZW50cnkgIiArIGkpLmdldEJ5dGVzKCkp\nOwogICAgICAgICAgICAgICAgYnl0ZXMucG9zaXRpb24oMCk7CiAgICAgICAg\nICAgICAgICBieXRlcy5saW1pdChieXRlcy5jYXBhY2l0eSgpKTsKICAgICAg\nICAgICAgICAgIHRocm90dGxlLmFjcXVpcmUoKTsKICAgICAgICAgICAgICAg\nIGJvb2tpZS5hZGRFbnRyeShieXRlcywgY2IsIGNvdW50ZXIsIHplcm9zKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsb25nIGZpbmlzaCA9\nIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgIHJldHVybiBm\naW5pc2ggLSBzdGFydDsKICAgIH0KfQo=\n","encoding":"base64"}

