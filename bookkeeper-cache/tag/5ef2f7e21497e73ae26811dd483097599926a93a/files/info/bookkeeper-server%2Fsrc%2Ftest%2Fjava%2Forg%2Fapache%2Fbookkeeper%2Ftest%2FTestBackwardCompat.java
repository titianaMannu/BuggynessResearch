{"sha":"0a5274ee76c3073b56ca3fc94e98d95fefacf9ea","node_id":"MDQ6QmxvYjE1NzU5NTY6MGE1Mjc0ZWU3NmMzMDczYjU2Y2EzZmM5NGU5OGQ5NWZlZmFjZjllYQ==","size":21342,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0a5274ee76c3073b56ca3fc94e98d95fefacf9ea","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKCmltcG9ydCBqYXZhLnV0aWwuRW51bWVyYXRp\nb247CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS5uZXQu\nSW5ldEFkZHJlc3M7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IG9yZy5qdW5pdC5U\nZXN0OwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5p\ndC5BZnRlcjsKaW1wb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0Lio7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuRmls\nZVN5c3RlbVVwZ3JhZGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkJvb2tLZWVwZXJBZG1pbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb247CgpwdWJsaWMgY2xh\nc3MgVGVzdEJhY2t3YXJkQ29tcGF0IHsKICAgIHN0YXRpYyBMb2dnZXIgTE9H\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVzdEJhY2t3YXJkQ29tcGF0\nLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0YXRpYyBab29LZWVwZXJVdGlsIHpr\nVXRpbCA9IG5ldyBab29LZWVwZXJVdGlsKCk7OwogICAgcHJpdmF0ZSBzdGF0\naWMgYnl0ZVtdIEVOVFJZX0RBVEEgPSAiVGhpc0lzQW5FbnRyeSIuZ2V0Qnl0\nZXMoKTsKCiAgICBzdGF0aWMgdm9pZCB3YWl0VXAoaW50IHBvcnQpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIHdoaWxlKHprVXRpbC5nZXRab29LZWVw\nZXJDbGllbnQoKS5leGlzdHMoCiAgICAgICAgICAgICAgICAgICAgICAiL2xl\nZGdlcnMvYXZhaWxhYmxlLyIgKyBJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3Qo\nKS5nZXRIb3N0QWRkcmVzcygpICsgIjoiICsgcG9ydCwKICAgICAgICAgICAg\nICAgICAgICAgIGZhbHNlKSA9PSBudWxsKSB7CiAgICAgICAgICAgIFRocmVh\nZC5zbGVlcCg1MDApOwogICAgICAgIH0KICAgIH0KICAgIEBCZWZvcmUKICAg\nIHB1YmxpYyB2b2lkIHN0YXJ0Wm9vS2VlcGVyU2VydmVyKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgemtVdGlsLnN0YXJ0U2VydmVyKCk7CiAgICB9\nCgogICAgQEFmdGVyCiAgICBwdWJsaWMgdm9pZCBzdG9wWm9vS2VlcGVyU2Vy\ndmVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgemtVdGlsLmtpbGxT\nZXJ2ZXIoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZlcnNpb24gNC4wLjAg\nY2xhc3NlcwogICAgICovCiAgICBzdGF0aWMgY2xhc3MgU2VydmVyNDAwIHsK\nICAgICAgICBvcmcuYXBhY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNvbmYu\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwogICAgICAgIG9yZy5hcGFjaGUu\nYmtfdjRfMF8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyIHNlcnZl\nciA9IG51bGw7CgogICAgICAgIFNlcnZlcjQwMChGaWxlIGpvdXJuYWxEaXIs\nIEZpbGUgbGVkZ2VyRGlyLCBpbnQgcG9ydCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGNvbmYgPSBuZXcgb3JnLmFwYWNoZS5ia192NF8wXzAu\nYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAg\nICAgICAgY29uZi5zZXRCb29raWVQb3J0KHBvcnQpOwogICAgICAgICAgICBj\nb25mLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0\ncmluZygpKTsKICAgICAgICAgICAgY29uZi5zZXRKb3VybmFsRGlyTmFtZShq\nb3VybmFsRGlyLmdldFBhdGgoKSk7CiAgICAgICAgICAgIGNvbmYuc2V0TGVk\nZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgo\nKSB9KTsKICAgICAgICB9CgogICAgICAgIHZvaWQgc3RhcnQoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgc2VydmVyID0gbmV3IG9yZy5hcGFj\naGUuYmtfdjRfMF8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyKGNv\nbmYpOwogICAgICAgICAgICBzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAgICAg\nd2FpdFVwKGNvbmYuZ2V0Qm9va2llUG9ydCgpKTsKICAgICAgICB9CgogICAg\nICAgIG9yZy5hcGFjaGUuYmtfdjRfMF8wLmJvb2trZWVwZXIuY29uZi5TZXJ2\nZXJDb25maWd1cmF0aW9uIGdldENvbmYoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBjb25mOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzdG9wKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChzZXJ2ZXIgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgc2VydmVyLnNodXRkb3duKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNsYXNzIExlZGdl\ncjQwMCB7CiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9va2tlZXBl\nci5jbGllbnQuQm9va0tlZXBlciBiazsKICAgICAgICBvcmcuYXBhY2hlLmJr\nX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGUgbGg7Cgog\nICAgICAgIHByaXZhdGUgTGVkZ2VyNDAwKG9yZy5hcGFjaGUuYmtfdjRfMF8w\nLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIgYmssCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9va2tlZXBl\nci5jbGllbnQuTGVkZ2VySGFuZGxlIGxoKSB7CiAgICAgICAgICAgIHRoaXMu\nYmsgPSBiazsKICAgICAgICAgICAgdGhpcy5saCA9IGxoOwogICAgICAgIH0K\nCiAgICAgICAgc3RhdGljIExlZGdlcjQwMCBuZXdMZWRnZXIoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8wXzAu\nYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlciBuZXdiawogICAgICAgICAg\nICAgICAgPSBuZXcgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9va2tlZXBlci5j\nbGllbnQuQm9va0tlZXBlcih6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0\ncmluZygpKTsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9v\na2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlIG5ld2xoCiAgICAgICAgICAg\nICAgICA9IG5ld2JrLmNyZWF0ZUxlZGdlcigxLCAxLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9v\na2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMyLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZvb2JhciIuZ2V0\nQnl0ZXMoKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGVkZ2VyNDAwKG5l\nd2JrLCBuZXdsaCk7CiAgICAgICAgfQoKICAgICAgICBzdGF0aWMgTGVkZ2Vy\nNDAwIG9wZW5MZWRnZXIobG9uZyBpZCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMF8wLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tLZWVwZXIgbmV3YmsKICAgICAgICAgICAgICAgID0gbmV3IG9y\nZy5hcGFjaGUuYmtfdjRfMF8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVw\nZXIoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMF8wLmJvb2trZWVwZXIuY2xpZW50\nLkxlZGdlckhhbmRsZSBuZXdsaAogICAgICAgICAgICAgICAgPSBuZXdiay5v\ncGVuTGVkZ2VyKGlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuYmtfdjRfMF8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tL\nZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAiZm9vYmFyIi5nZXRCeXRlcygpKTsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBMZWRnZXI0MDAobmV3YmssIG5ld2xoKTsKICAgICAgICB9\nCgogICAgICAgIGxvbmcgZ2V0SWQoKSB7CiAgICAgICAgICAgIHJldHVybiBs\naC5nZXRJZCgpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCB3cml0ZTEwMCgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBsaC5hZGRFbnRy\neShFTlRSWV9EQVRBKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgbG9uZyByZWFkQWxsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIGxvbmcgY291bnQgPSAwOwogICAgICAgICAgICBFbnVtZXJhdGlvbjxv\ncmcuYXBhY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJF\nbnRyeT4gZW50cmllcwogICAgICAgICAgICAgICAgPSBsaC5yZWFkRW50cmll\ncygwLCBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwogICAgICAgICAgICB3\naGlsZSAoZW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgiZW50cnkgZGF0YSBkb2Vzbid0IG1hdGNoIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXlzLmVxdWFscyhlbnRy\naWVzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKSwgRU5UUllfREFUQSkpOwog\nICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gY291bnQ7CiAgICAgICAgfQoKICAgICAgICB2b2lkIGNs\nb3NlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBpZiAobGggIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoYmsgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIGJrLmNsb3NlKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBWZXJzaW9uIDQuMS4wIGNsYXNzZXMKICAgICAqLwogICAg\nc3RhdGljIGNsYXNzIFNlcnZlcjQxMCB7CiAgICAgICAgb3JnLmFwYWNoZS5i\na192NF8xXzAuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZjsKICAgICAgICBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVy\nLnByb3RvLkJvb2tpZVNlcnZlciBzZXJ2ZXIgPSBudWxsOwoKICAgICAgICBT\nZXJ2ZXI0MTAoRmlsZSBqb3VybmFsRGlyLCBGaWxlIGxlZGdlckRpciwgaW50\nIHBvcnQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBjb25mID0g\nbmV3IG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY29uZi5TZXJ2\nZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGNvbmYuc2V0Qm9va2ll\nUG9ydChwb3J0KTsKICAgICAgICAgICAgY29uZi5zZXRaa1NlcnZlcnMoemtV\ndGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAgICAg\nIGNvbmYuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkp\nOwogICAgICAgICAgICBjb25mLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJp\nbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7CiAgICAgICAgfQoKICAg\nICAgICB2b2lkIHN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIHNlcnZlciA9IG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2Vl\ncGVyLnByb3RvLkJvb2tpZVNlcnZlcihjb25mKTsKICAgICAgICAgICAgc2Vy\ndmVyLnN0YXJ0KCk7CiAgICAgICAgICAgIHdhaXRVcChjb25mLmdldEJvb2tp\nZVBvcnQoKSk7CiAgICAgICAgfQoKICAgICAgICBvcmcuYXBhY2hlLmJrX3Y0\nXzFfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbiBnZXRD\nb25mKCkgewogICAgICAgICAgICByZXR1cm4gY29uZjsKICAgICAgICB9Cgog\nICAgICAgIHZvaWQgc3RvcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBpZiAoc2VydmVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHNl\ncnZlci5zaHV0ZG93bigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIHN0YXRpYyBjbGFzcyBMZWRnZXI0MTAgewogICAgICAgIG9yZy5h\ncGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIg\nYms7CiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlIGxoOwoKICAgICAgICBwcml2YXRlIExlZGdl\ncjQxMChvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5C\nb29rS2VlcGVyIGJrLAogICAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRs\nZSBsaCkgewogICAgICAgICAgICB0aGlzLmJrID0gYms7CiAgICAgICAgICAg\nIHRoaXMubGggPSBsaDsKICAgICAgICB9CgogICAgICAgIHN0YXRpYyBMZWRn\nZXI0MTAgbmV3TGVkZ2VyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJv\nb2tLZWVwZXIgbmV3YmsKICAgICAgICAgICAgICAgID0gbmV3IG9yZy5hcGFj\naGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIoemtV\ndGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAgICAg\nIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkxlZGdl\nckhhbmRsZSBuZXdsaAogICAgICAgICAgICAgICAgPSBuZXdiay5jcmVhdGVM\nZWRnZXIoMSwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tL\nZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICJmb29iYXIiLmdldEJ5dGVzKCkpOwogICAgICAgICAg\nICByZXR1cm4gbmV3IExlZGdlcjQxMChuZXdiaywgbmV3bGgpOwogICAgICAg\nIH0KCiAgICAgICAgc3RhdGljIExlZGdlcjQxMCBvcGVuTGVkZ2VyKGxvbmcg\naWQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBvcmcuYXBhY2hl\nLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyIG5ld2Jr\nCiAgICAgICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5i\nb29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyKHprVXRpbC5nZXRab29LZWVw\nZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAgICAgICBvcmcuYXBhY2hlLmJr\nX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGUgbmV3bGgK\nICAgICAgICAgICAgICAgID0gbmV3Ymsub3BlbkxlZGdlcihpZCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJrX3Y0XzFf\nMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JD\nMzIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZvb2JhciIu\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGVkZ2VyNDEw\nKG5ld2JrLCBuZXdsaCk7CiAgICAgICAgfQoKICAgICAgICBsb25nIGdldElk\nKCkgewogICAgICAgICAgICByZXR1cm4gbGguZ2V0SWQoKTsKICAgICAgICB9\nCgogICAgICAgIHZvaWQgd3JpdGUxMDAoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykgewog\nICAgICAgICAgICAgICAgbGguYWRkRW50cnkoRU5UUllfREFUQSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxvbmcgcmVhZEFsbCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIGNvdW50ID0gMDsK\nICAgICAgICAgICAgRW51bWVyYXRpb248b3JnLmFwYWNoZS5ia192NF8xXzAu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyRW50cnk+IGVudHJpZXMKICAgICAg\nICAgICAgICAgID0gbGgucmVhZEVudHJpZXMoMCwgbGguZ2V0TGFzdEFkZENv\nbmZpcm1lZCgpKTsKICAgICAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFzTW9y\nZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUoImVu\ndHJ5IGRhdGEgZG9lc24ndCBtYXRjaCIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgIEFycmF5cy5lcXVhbHMoZW50cmllcy5uZXh0RWxlbWVudCgpLmdl\ndEVudHJ5KCksIEVOVFJZX0RBVEEpKTsKICAgICAgICAgICAgICAgIGNvdW50\nKys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvdW50Owog\nICAgICAgIH0KCiAgICAgICAgdm9pZCBjbG9zZSgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGxo\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBsaC5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAgICAgaWYgKGJrICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICBiay5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3VycmVudCB2\nZXJpb24gY2xhc3NlcwogICAgICovCiAgICBzdGF0aWMgY2xhc3MgU2VydmVy\nQ3VycmVudCB7CiAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYu\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwogICAgICAgIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXIgc2VydmVyID0gbnVsbDsK\nCiAgICAgICAgU2VydmVyQ3VycmVudChGaWxlIGpvdXJuYWxEaXIsIEZpbGUg\nbGVkZ2VyRGlyLCBpbnQgcG9ydCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIGNvbmYgPSBuZXcgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYu\nU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBjb25mLnNldEJv\nb2tpZVBvcnQocG9ydCk7CiAgICAgICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJz\nKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAg\nICAgICBjb25mLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0\naCgpKTsKICAgICAgICAgICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcg\nU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwogICAgICAgIH0K\nCiAgICAgICAgdm9pZCBzdGFydCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBzZXJ2ZXIgPSBuZXcgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkJvb2tpZVNlcnZlcihjb25mKTsKICAgICAgICAgICAgc2VydmVyLnN0\nYXJ0KCk7CiAgICAgICAgICAgIHdhaXRVcChjb25mLmdldEJvb2tpZVBvcnQo\nKSk7CiAgICAgICAgfQoKICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uIGdldENvbmYoKSB7CiAgICAgICAg\nICAgIHJldHVybiBjb25mOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzdG9w\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChzZXJ2ZXIg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgc2VydmVyLnNodXRkb3duKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNs\nYXNzIExlZGdlckN1cnJlbnQgewogICAgICAgIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuQm9va0tlZXBlciBiazsKICAgICAgICBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZSBsaDsKCiAgICAgICAg\ncHJpdmF0ZSBMZWRnZXJDdXJyZW50KG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuQm9va0tlZXBlciBiaywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5k\nbGUgbGgpIHsKICAgICAgICAgICAgdGhpcy5iayA9IGJrOwogICAgICAgICAg\nICB0aGlzLmxoID0gbGg7CiAgICAgICAgfQoKICAgICAgICBzdGF0aWMgTGVk\nZ2VyQ3VycmVudCBuZXdMZWRnZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2Vl\ncGVyIG5ld2JrCiAgICAgICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIoemtVdGlsLmdldFpvb0tlZXBl\nckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlIG5ld2xoCiAgICAgICAgICAg\nICAgICA9IG5ld2JrLmNyZWF0ZUxlZGdlcigxLCAxLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZm9vYmFyIi5nZXRCeXRl\ncygpKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJDdXJyZW50KG5l\nd2JrLCBuZXdsaCk7CiAgICAgICAgfQoKICAgICAgICBzdGF0aWMgTGVkZ2Vy\nQ3VycmVudCBvcGVuTGVkZ2VyKGxvbmcgaWQpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJv\nb2tLZWVwZXIgbmV3YmsKICAgICAgICAgICAgICAgID0gbmV3IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlcih6a1V0aWwuZ2V0Wm9v\nS2VlcGVyQ29ubmVjdFN0cmluZygpKTsKICAgICAgICAgICAgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGUgbmV3bGgKICAgICAg\nICAgICAgICAgID0gbmV3Ymsub3BlbkxlZGdlcihpZCwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAiZm9vYmFyIi5nZXRCeXRlcygpKTsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJDdXJyZW50KG5ld2JrLCBuZXds\naCk7CiAgICAgICAgfQoKICAgICAgICBsb25nIGdldElkKCkgewogICAgICAg\nICAgICByZXR1cm4gbGguZ2V0SWQoKTsKICAgICAgICB9CgogICAgICAgIHZv\naWQgd3JpdGUxMDAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykgewogICAgICAgICAgICAg\nICAgbGguYWRkRW50cnkoRU5UUllfREFUQSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIGxvbmcgcmVhZEFsbCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICBsb25nIGNvdW50ID0gMDsKICAgICAgICAgICAg\nRW51bWVyYXRpb248b3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRn\nZXJFbnRyeT4gZW50cmllcwogICAgICAgICAgICAgICAgPSBsaC5yZWFkRW50\ncmllcygwLCBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwogICAgICAgICAg\nICB3aGlsZSAoZW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZSgiZW50cnkgZGF0YSBkb2Vzbid0IG1hdGNo\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXlzLmVxdWFscyhl\nbnRyaWVzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKSwgRU5UUllfREFUQSkp\nOwogICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gY291bnQ7CiAgICAgICAgfQoKICAgICAgICB2b2lk\nIGNsb3NlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBpZiAobGggIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoYmsgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGJrLmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoKICAgICAqIFRlc3Qgb2xkIGNvb2tpZSBhY2Nlc3NpbmcgdGhlIG5l\ndyB2ZXJzaW9uIGZvcm1hdHRlZCBjbHVzdGVyLgogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE9sZENvb2tp\nZUFjY2Vzc2luZ05ld0NsdXN0ZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJi\nb29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxEaXIuZGVsZXRl\nKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAgICAgIEZpbGUg\nbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxl\nZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBs\nZWRnZXJEaXIubWtkaXIoKTsKCiAgICAgICAgaW50IHBvcnQgPSBQb3J0TWFu\nYWdlci5uZXh0RnJlZVBvcnQoKTsKCiAgICAgICAgLy8gc3RhcnQgb2xkIHNl\ncnZlcgogICAgICAgIFNlcnZlcjQxMCBzNDEwID0gbmV3IFNlcnZlcjQxMChq\nb3VybmFsRGlyLCBsZWRnZXJEaXIsIHBvcnQpOwogICAgICAgIHM0MTAuc3Rh\ncnQoKTsKCiAgICAgICAgTGVkZ2VyNDEwIGw0MTAgPSBMZWRnZXI0MTAubmV3\nTGVkZ2VyKCk7CiAgICAgICAgbDQxMC53cml0ZTEwMCgpOwogICAgICAgIGw0\nMTAuZ2V0SWQoKTsKICAgICAgICBsNDEwLmNsb3NlKCk7CiAgICAgICAgczQx\nMC5zdG9wKCk7CgogICAgICAgIC8vIEZvcm1hdCB0aGUgbWV0YWRhdGEgdXNp\nbmcgY3VycmVudCB2ZXJzaW9uCiAgICAgICAgU2VydmVyQ3VycmVudCBjdXJy\nZW50U2VydmVyID0gbmV3IFNlcnZlckN1cnJlbnQoam91cm5hbERpciwgbGVk\nZ2VyRGlyLAogICAgICAgICAgICAgICAgcG9ydCk7CiAgICAgICAgQm9va0tl\nZXBlckFkbWluLmZvcm1hdChuZXcgQ2xpZW50Q29uZmlndXJhdGlvbihjdXJy\nZW50U2VydmVyLmNvbmYpLAogICAgICAgICAgICAgICAgZmFsc2UsIHRydWUp\nOwogICAgICAgIC8vIHN0YXJ0IHRoZSBjdXJyZW50IHZlcnNpb24gc2VydmVy\nIHdpdGggb2xkIHZlcnNpb24gY29va2llCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgY3VycmVudFNlcnZlci5zdGFydCgpOwogICAgICAgICAgICBmYWls\nKCJCb29raWUgc2hvdWxkIG5vdCBzdGFydCB3aXRoIG9sZCBjb29raWUiKTsK\nICAgICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBhc3NlcnRUcnVlKCJPbGQgQ29va2llIHNob3VsZCBub3QgYmUgYWJs\nZSB0byBhY2Nlc3MiLCBlCiAgICAgICAgICAgICAgICAgICAgLmdldE1lc3Nh\nZ2UoKS5jb250YWlucygiaW5zdGFuY2VJZCIpKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBjdXJyZW50U2VydmVyLnN0b3AoKTsKICAgICAg\nICB9CgogICAgICAgIC8vIEZvcm1hdCB0aGUgYm9va2llIGFsc28gYW5kIHJl\nc3RhcnQKICAgICAgICBhc3NlcnRUcnVlKCJGb3JtYXQgc2hvdWxkIGJlIHN1\nY2Nlc3MiLAogICAgICAgICAgICAgICAgQm9va2llLmZvcm1hdChjdXJyZW50\nU2VydmVyLmNvbmYsIGZhbHNlLCB0cnVlKSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgY3VycmVudFNlcnZlciA9IG51bGw7CiAgICAgICAgICAgIGN1\ncnJlbnRTZXJ2ZXIgPSBuZXcgU2VydmVyQ3VycmVudChqb3VybmFsRGlyLCBs\nZWRnZXJEaXIsIHBvcnQpOwogICAgICAgICAgICBjdXJyZW50U2VydmVyLnN0\nYXJ0KCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKG51\nbGwgIT0gY3VycmVudFNlcnZlcikgewogICAgICAgICAgICAgICAgY3VycmVu\ndFNlcnZlci5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUZXN0IGNvbXBhdGFiaWxpdHkgYmV0d2VlbiB2\nZXJzaW9uIDQuMC4wIGFuZCB0aGUgY3VycmVudCB2ZXJzaW9uLgogICAgICog\nSW5jb21wYXRhYmlsaXRpZXMgYXJlOgogICAgICogIC0gQ3VycmVudCBjbGll\nbnQgd2lsbCBub3QgYmUgYWJsZSB0byB0YWxrIHRvIDQuMC4wIHNlcnZlci4K\nICAgICAqICAtIDQuMC4wIGNsaWVudCB3aWxsIG5vdCBiZSBhYmxlIHRvIGZl\nbmNlIGxlZGdlcnMgb24gY3VycmVudCBzZXJ2ZXIuCiAgICAgKiAgLSBDdXJy\nZW50IHNlcnZlciB3b24ndCBzdGFydCB3aXRoIDQuMC4wIHNlcnZlciBkaXJl\nY3RvcmllcyB3aXRob3V0IHVwZ3JhZGUuCiAgICAgKi8KICAgIEBUZXN0KHRp\nbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q29tcGF0NDAwKCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0g\nRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAg\nICAgICBqb3VybmFsRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIu\nbWtkaXIoKTsKICAgICAgICBGaWxlIGxlZGdlckRpciA9IEZpbGUuY3JlYXRl\nVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsKICAgICAgICBsZWRnZXJE\naXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGlyKCk7CgogICAg\nICAgIGludCBwb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7CiAg\nICAgICAgLy8gc3RhcnQgc2VydmVyLCB1cGdyYWRlCiAgICAgICAgU2VydmVy\nNDAwIHM0MDAgPSBuZXcgU2VydmVyNDAwKGpvdXJuYWxEaXIsIGxlZGdlckRp\nciwgcG9ydCk7CiAgICAgICAgczQwMC5zdGFydCgpOwoKICAgICAgICBMZWRn\nZXI0MDAgbDQwMCA9IExlZGdlcjQwMC5uZXdMZWRnZXIoKTsKICAgICAgICBs\nNDAwLndyaXRlMTAwKCk7CiAgICAgICAgbG9uZyBvbGRMZWRnZXJJZCA9IGw0\nMDAuZ2V0SWQoKTsKICAgICAgICBsNDAwLmNsb3NlKCk7CgogICAgICAgIC8v\nIENoZWNrIHRoYXQgY3VycmVudCBjbGllbnQgaXNuJ3QgYWJsZSB0byB3cml0\nZSB0byBvbGQgc2VydmVyCiAgICAgICAgTGVkZ2VyQ3VycmVudCBsY3VyID0g\nTGVkZ2VyQ3VycmVudC5uZXdMZWRnZXIoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBsY3VyLndyaXRlMTAwKCk7CiAgICAgICAgICAgIGZhaWwoIkN1\ncnJlbnQgc2hvdWxkbid0IGJlIGFibGUgdG8gd3JpdGUgdG8gNC4wLjAgc2Vy\ndmVyIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICB9CiAgICAgICAgbGN1ci5jbG9zZSgpOwoKICAgICAgICBzNDAwLnN0b3Ao\nKTsKCiAgICAgICAgLy8gU3RhcnQgdGhlIGN1cnJlbnQgc2VydmVyLCB3aWxs\nIHJlcXVpcmUgYSBmaWxlc3lzdGVtIHVwZ3JhZGUKICAgICAgICBTZXJ2ZXJD\ndXJyZW50IHNjdXIgPSBuZXcgU2VydmVyQ3VycmVudChqb3VybmFsRGlyLCBs\nZWRnZXJEaXIsIHBvcnQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNj\ndXIuc3RhcnQoKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFi\nbGUgdG8gc3RhcnQgd2l0aG91dCBkaXJlY3RvcnkgdXBncmFkZSIpOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgfQogICAgICAg\nIEZpbGVTeXN0ZW1VcGdyYWRlLnVwZ3JhZGUoc2N1ci5nZXRDb25mKCkpOwoK\nICAgICAgICBzY3VyLnN0YXJ0KCk7CgogICAgICAgIC8vIGNoZWNrIHRoYXQg\nb2xkIGNsaWVudCBjYW4gcmVhZCBpdHMgb2xkIGxlZGdlcnMgb24gbmV3IHNl\ncnZlcgogICAgICAgIGw0MDAgPSBMZWRnZXI0MDAub3BlbkxlZGdlcihvbGRM\nZWRnZXJJZCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDEwMCwgbDQwMC5yZWFk\nQWxsKCkpOwogICAgICAgIGw0MDAuY2xvc2UoKTsKCiAgICAgICAgLy8gY2hl\nY2sgdGhhdCBvbGQgY2xpZW50IGNhbiBjcmVhdGUgbGVkZ2VycyBvbiBuZXcg\nc2VydmVyCiAgICAgICAgbDQwMCA9IExlZGdlcjQwMC5uZXdMZWRnZXIoKTsK\nICAgICAgICBsNDAwLndyaXRlMTAwKCk7CiAgICAgICAgbDQwMC5jbG9zZSgp\nOwoKICAgICAgICAvLyBjaGVjayB0aGF0IGN1cnJlbnQgY2xpZW50IGNhbiBy\nZWFkIG9sZCBsZWRnZXIKICAgICAgICBsY3VyID0gTGVkZ2VyQ3VycmVudC5v\ncGVuTGVkZ2VyKG9sZExlZGdlcklkKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nMTAwLCBsY3VyLnJlYWRBbGwoKSk7CiAgICAgICAgbGN1ci5jbG9zZSgpOwoK\nICAgICAgICAvLyBjaGVjayB0aGF0IG9sZCBjbGllbnQgY2FuIHJlYWQgY3Vy\ncmVudCBjbGllbnQncyBsZWRnZXJzCiAgICAgICAgbGN1ciA9IExlZGdlckN1\ncnJlbnQub3BlbkxlZGdlcihvbGRMZWRnZXJJZCk7CiAgICAgICAgYXNzZXJ0\nRXF1YWxzKDEwMCwgbGN1ci5yZWFkQWxsKCkpOwogICAgICAgIGxjdXIuY2xv\nc2UoKTsKCiAgICAgICAgLy8gY2hlY2sgdGhhdCBvbGQgY2xpZW50IGNhbiBu\nb3QgZmVuY2UgYSBjdXJyZW50IGNsaWVudAogICAgICAgIC8vIGR1ZSB0byBs\nYWNrIG9mIHBhc3N3b3JkCiAgICAgICAgbGN1ciA9IExlZGdlckN1cnJlbnQu\nbmV3TGVkZ2VyKCk7CiAgICAgICAgbGN1ci53cml0ZTEwMCgpOwogICAgICAg\nIGxvbmcgZmVuY2VMZWRnZXJJZCA9IGxjdXIuZ2V0SWQoKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBsNDAwID0gTGVkZ2VyNDAwLm9wZW5MZWRnZXIo\nZmVuY2VMZWRnZXJJZCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBi\nZSBhYmxlIHRvIG9wZW4gbGVkZ2VyIik7CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIK\nICAgICAgICB9CiAgICAgICAgbGN1ci53cml0ZTEwMCgpOwogICAgICAgIGxj\ndXIuY2xvc2UoKTsKCiAgICAgICAgbGN1ciA9IExlZGdlckN1cnJlbnQub3Bl\nbkxlZGdlcihmZW5jZUxlZGdlcklkKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nMjAwLCBsY3VyLnJlYWRBbGwoKSk7CiAgICAgICAgbGN1ci5jbG9zZSgpOwoK\nICAgICAgICBzY3VyLnN0b3AoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRl\nc3QgY29tcGF0YWJpbGl0eSBiZXR3ZWVuIHZlcnNpb24gNC4xLjAgYW5kIHRo\nZSBjdXJyZW50IHZlcnNpb24uCiAgICAgKiAgLSBBIDQuMS4wIGNsaWVudCBp\ncyBub3QgYWJsZSB0byBvcGVuIGEgbGVkZ2VyIGNyZWF0ZWQgYnkgdGhlIGN1\ncnJlbnQKICAgICAqICAgIHZlcnNpb24gZHVlIHRvIGEgY2hhbmdlIGluIHRo\nZSBsZWRnZXIgbWV0YWRhdGEgZm9ybWF0LgogICAgICogIC0gT3RoZXJ3aXNl\nLCB0aGV5IHNob3VsZCBiZSBjb21wYXRpYmxlLgogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdENvbXBhdDQx\nMCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5hbERp\nciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7\nCiAgICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3VybmFs\nRGlyLm1rZGlyKCk7CiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNy\nZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVk\nZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwoK\nICAgICAgICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgp\nOwogICAgICAgIC8vIHN0YXJ0IHNlcnZlciwgdXBncmFkZQogICAgICAgIFNl\ncnZlcjQxMCBzNDEwID0gbmV3IFNlcnZlcjQxMChqb3VybmFsRGlyLCBsZWRn\nZXJEaXIsIHBvcnQpOwogICAgICAgIHM0MTAuc3RhcnQoKTsKCiAgICAgICAg\nTGVkZ2VyNDEwIGw0MTAgPSBMZWRnZXI0MTAubmV3TGVkZ2VyKCk7CiAgICAg\nICAgbDQxMC53cml0ZTEwMCgpOwogICAgICAgIGxvbmcgb2xkTGVkZ2VySWQg\nPSBsNDEwLmdldElkKCk7CiAgICAgICAgbDQxMC5jbG9zZSgpOwoKICAgICAg\nICAvLyBDaGVjayB0aGF0IGN1cnJlbnQgY2xpZW50IGNhbiB0byB3cml0ZSB0\nbyBvbGQgc2VydmVyCiAgICAgICAgTGVkZ2VyQ3VycmVudCBsY3VyID0gTGVk\nZ2VyQ3VycmVudC5uZXdMZWRnZXIoKTsKICAgICAgICBsY3VyLndyaXRlMTAw\nKCk7CiAgICAgICAgbGN1ci5jbG9zZSgpOwoKICAgICAgICBzNDEwLnN0b3Ao\nKTsKCiAgICAgICAgLy8gU3RhcnQgdGhlIGN1cnJlbnQgc2VydmVyLCB3aWxs\nIG5vdCByZXF1aXJlIGEgZmlsZXN5c3RlbSB1cGdyYWRlCiAgICAgICAgU2Vy\ndmVyQ3VycmVudCBzY3VyID0gbmV3IFNlcnZlckN1cnJlbnQoam91cm5hbERp\nciwgbGVkZ2VyRGlyLCBwb3J0KTsKICAgICAgICBzY3VyLnN0YXJ0KCk7Cgog\nICAgICAgIC8vIGNoZWNrIHRoYXQgb2xkIGNsaWVudCBjYW4gcmVhZCBpdHMg\nb2xkIGxlZGdlcnMgb24gbmV3IHNlcnZlcgogICAgICAgIGw0MTAgPSBMZWRn\nZXI0MTAub3BlbkxlZGdlcihvbGRMZWRnZXJJZCk7CiAgICAgICAgYXNzZXJ0\nRXF1YWxzKDEwMCwgbDQxMC5yZWFkQWxsKCkpOwogICAgICAgIGw0MTAuY2xv\nc2UoKTsKCiAgICAgICAgLy8gY2hlY2sgdGhhdCBvbGQgY2xpZW50IGNhbiBj\ncmVhdGUgbGVkZ2VycyBvbiBuZXcgc2VydmVyCiAgICAgICAgbDQxMCA9IExl\nZGdlcjQxMC5uZXdMZWRnZXIoKTsKICAgICAgICBsNDEwLndyaXRlMTAwKCk7\nCiAgICAgICAgbDQxMC5jbG9zZSgpOwoKICAgICAgICAvLyBjaGVjayB0aGF0\nIGFuIG9sZCBjbGllbnQgY2FuIGZlbmNlIGFuIG9sZCBjbGllbnQKICAgICAg\nICBsNDEwID0gTGVkZ2VyNDEwLm5ld0xlZGdlcigpOwogICAgICAgIGw0MTAu\nd3JpdGUxMDAoKTsKCiAgICAgICAgTGVkZ2VyNDEwIGw0MTBmID0gTGVkZ2Vy\nNDEwLm9wZW5MZWRnZXIobDQxMC5nZXRJZCgpKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBsNDEwLndyaXRlMTAwKCk7CiAgICAgICAgICAgIGZhaWwo\nIlNob3VsZG4ndCBiZSBhYmxlIHRvIHdyaXRlIik7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhh\ndmlvdXIKICAgICAgICB9CiAgICAgICAgbDQxMGYuY2xvc2UoKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBsNDEwLmNsb3NlKCk7CiAgICAgICAgICAg\nIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIGNsb3NlIik7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVj\ndAogICAgICAgIH0KCiAgICAgICAgLy8gY2hlY2sgdGhhdCBhIG5ldyBjbGll\nbnQgY2FuIGZlbmNlIGFuIG9sZCBjbGllbnQKICAgICAgICAvLyBhbmQgdGhl\nIG9sZCBjbGllbnQgY2FuIGNvbnRpbnVlIHRvIHJlYWQgdGhhdCBsZWRnZXIK\nICAgICAgICBsNDEwID0gTGVkZ2VyNDEwLm5ld0xlZGdlcigpOwogICAgICAg\nIGw0MTAud3JpdGUxMDAoKTsKCiAgICAgICAgb2xkTGVkZ2VySWQgPSBsNDEw\nLmdldElkKCk7CiAgICAgICAgbGN1ciA9IExlZGdlckN1cnJlbnQub3Blbkxl\nZGdlcihvbGRMZWRnZXJJZCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nbDQxMC53cml0ZTEwMCgpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3Qg\nYmUgYWJsZSB0byB3cml0ZSIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAg\nICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGw0MTAuY2xvc2UoKTsK\nICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gY2xvc2Ui\nKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAvLyBjb3JyZWN0CiAgICAgICAgfQogICAgICAgIGxjdXIuY2xvc2UoKTsK\nCiAgICAgICAgbDQxMCA9IExlZGdlcjQxMC5vcGVuTGVkZ2VyKG9sZExlZGdl\ncklkKTsKCiAgICAgICAgYXNzZXJ0RXF1YWxzKDEwMCwgbDQxMC5yZWFkQWxs\nKCkpOwogICAgICAgIGw0MTAuY2xvc2UoKTsKCiAgICAgICAgLy8gY2hlY2sg\ndGhhdCBjdXJyZW50IGNsaWVudCBjYW4gcmVhZCBvbGQgbGVkZ2VyCiAgICAg\nICAgbGN1ciA9IExlZGdlckN1cnJlbnQub3BlbkxlZGdlcihvbGRMZWRnZXJJ\nZCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDEwMCwgbGN1ci5yZWFkQWxsKCkp\nOwogICAgICAgIGxjdXIuY2xvc2UoKTsKCiAgICAgICAgLy8gY2hlY2sgdGhh\ndCBvbGQgY2xpZW50IGNhbiByZWFkIGN1cnJlbnQgY2xpZW50J3MgbGVkZ2Vy\ncwogICAgICAgIGxjdXIgPSBMZWRnZXJDdXJyZW50Lm9wZW5MZWRnZXIob2xk\nTGVkZ2VySWQpOwogICAgICAgIGFzc2VydEVxdWFscygxMDAsIGxjdXIucmVh\nZEFsbCgpKTsKICAgICAgICBsY3VyLmNsb3NlKCk7CgogICAgICAgIC8vIGNo\nZWNrIHRoYXQgb2xkIGNsaWVudCBjYW4gbm90IGZlbmNlIGEgY3VycmVudCBj\nbGllbnQKICAgICAgICAvLyBzaW5jZSBpdCBjYW5ub3Qgb3BlbiBhIG5ldyBs\nZWRnZXIgZHVlIHRvIHRoZSBmb3JtYXQgY2hhbmdlcwogICAgICAgIGxjdXIg\nPSBMZWRnZXJDdXJyZW50Lm5ld0xlZGdlcigpOwogICAgICAgIGxjdXIud3Jp\ndGUxMDAoKTsKICAgICAgICBsb25nIGZlbmNlTGVkZ2VySWQgPSBsY3VyLmdl\ndElkKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbDQxMCA9IExlZGdl\ncjQxMC5vcGVuTGVkZ2VyKGZlbmNlTGVkZ2VySWQpOwogICAgICAgICAgICBm\nYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byBvcGVuIGxlZGdlciIpOwogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNv\ncnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgICAgIGxjdXIud3JpdGUx\nMDAoKTsKICAgICAgICBsY3VyLmNsb3NlKCk7CgogICAgICAgIHNjdXIuc3Rv\ncCgpOwogICAgfQp9\n","encoding":"base64"}

