{"sha":"b61e3c19bdc7f35dedd85cc47536a348f99f2408","node_id":"MDQ6QmxvYjE1NzU5NTY6YjYxZTNjMTliZGM3ZjM1ZGVkZDg1Y2M0NzUzNmEzNDhmOTlmMjQwOA==","size":5529,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b61e3c19bdc7f35dedd85cc47536a348f99f2408","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrOwoKaW1w\nb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5NYXRoVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5QdWJsaXNoZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYXBpLlN1YnNjcmli\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJr\nLkJlbmNobWFya1V0aWxzLkJlbmNobWFya0NhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuY2xpZW50LmJlbmNobWFyay5CZW5jaG1hcmtVdGls\ncy5UaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0b3I7CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s7CgpwdWJsaWMgY2xhc3Mg\nQmVuY2htYXJrUHVibGlzaGVyIGV4dGVuZHMgQmVuY2htYXJrV29ya2VyIHsK\nICAgIFB1Ymxpc2hlciBwdWJsaXNoZXI7CiAgICBTdWJzY3JpYmVyIHN1YnNj\ncmliZXI7CiAgICBpbnQgbXNnU2l6ZTsKICAgIGludCBuUGFyYWxsZWw7CiAg\nICBkb3VibGUgcmF0ZTsKCiAgICBwdWJsaWMgQmVuY2htYXJrUHVibGlzaGVy\nKGludCBudW1Ub3BpY3MsIGludCBudW1NZXNzYWdlcywgaW50IG51bVJlZ2lv\nbnMsIGludCBzdGFydFRvcGljTGFiZWwsIGludCBwYXJ0aXRpb25JbmRleCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bVBhcnRpdGlv\nbnMsIFB1Ymxpc2hlciBwdWJsaXNoZXIsIFN1YnNjcmliZXIgc3Vic2NyaWJl\nciwgaW50IG1zZ1NpemUsIGludCBuUGFyYWxsZWwsIGludCByYXRlKSB7CiAg\nICAgICAgc3VwZXIobnVtVG9waWNzLCBudW1NZXNzYWdlcywgbnVtUmVnaW9u\ncywgc3RhcnRUb3BpY0xhYmVsLCBwYXJ0aXRpb25JbmRleCwgbnVtUGFydGl0\naW9ucyk7CiAgICAgICAgdGhpcy5wdWJsaXNoZXIgPSBwdWJsaXNoZXI7CiAg\nICAgICAgdGhpcy5tc2dTaXplID0gbXNnU2l6ZTsKICAgICAgICB0aGlzLnN1\nYnNjcmliZXIgPSBzdWJzY3JpYmVyOwogICAgICAgIHRoaXMublBhcmFsbGVs\nID0gblBhcmFsbGVsOwoKICAgICAgICB0aGlzLnJhdGUgPSByYXRlIC8gKG51\nbVJlZ2lvbnMgKiBudW1QYXJ0aXRpb25zICsgMC4wKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB3YXJtdXAoaW50IG5XYXJtdXApIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNv\ncHlGcm9tVXRmOCgid2FybXVwIiArIHBhcnRpdGlvbkluZGV4KTsKICAgICAg\nICBCeXRlU3RyaW5nIHN1YklkID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nInN1YiIpOwogICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKHRvcGljLCBz\ndWJJZCwgQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSCk7CgogICAg\nICAgIHN1YnNjcmliZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3ViSWQsIG5l\ndyBNZXNzYWdlSGFuZGxlcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3Bp\nYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIE1lc3NhZ2UgbXNnLCBDYWxs\nYmFjazxWb2lkPiBjYWxsYmFjaywKICAgICAgICAgICAgT2JqZWN0IGNvbnRl\neHQpIHsKICAgICAgICAgICAgICAgIC8vIG5vb3AKICAgICAgICAgICAgICAg\nIGNhbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGNvbnRleHQsIG51bGwpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIHBpY2tpbmcg\nY29uc3RhbnRzIGFyYml0YXJpbHkgZm9yIHdhcm11cCBwaGFzZQogICAgICAg\nIFRocm91Z2hwdXRMYXRlbmN5QWdncmVnYXRvciBhZ2cgPSBuZXcgVGhyb3Vn\naHB1dExhdGVuY3lBZ2dyZWdhdG9yKCJhY2tlZCBwdWJzIiwgbldhcm11cCwg\nMTAwKTsKICAgICAgICBhZ2cuc3RhcnRQcm9ncmVzcygpOwoKICAgICAgICBN\nZXNzYWdlIG1zZyA9IGdldE1zZygxMDI0KTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IG5XYXJtdXA7IGkrKykgewogICAgICAgICAgICBwdWJsaXNo\nZXIuYXN5bmNQdWJsaXNoKHRvcGljLCBtc2csIG5ldyBCZW5jaG1hcmtDYWxs\nYmFjayhhZ2cpLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGlmIChhZ2cu\ndHBBZ2cucXVldWUudGFrZSgpID4gMCkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgUnVudGltZUV4Y2VwdGlvbigiV2FybXVwIHB1Ymxpc2hlcyBmYWlsZWQh\nIik7CiAgICAgICAgfQoKICAgIH0KCiAgICBwdWJsaWMgTWVzc2FnZSBnZXRN\nc2coaW50IHNpemUpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3\nIFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHNpemU7IGkrKykgewogICAgICAgICAgICBzYi5hcHBlbmQoJ2EnKTsKICAg\nICAgICB9CiAgICAgICAgZmluYWwgQnl0ZVN0cmluZyBib2R5ID0gQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0Zjgoc2IudG9TdHJpbmcoKSk7CiAgICAgICAgTWVz\nc2FnZSBtc2cgPSBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5KGJvZHkp\nLmJ1aWxkKCk7CiAgICAgICAgcmV0dXJuIG1zZzsKICAgIH0KCiAgICBwdWJs\naWMgVm9pZCBjYWxsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTWVz\nc2FnZSBtc2cgPSBnZXRNc2cobXNnU2l6ZSk7CgogICAgICAgIC8vIFNpbmds\nZSB3YXJtdXAgZm9yIGV2ZXJ5IHRvcGljCiAgICAgICAgaW50IG15UHVibGlz\naENvdW50ID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bVRv\ncGljczsgaSsrKSB7CiAgICAgICAgICAgIGlmICghSGVkd2lnQmVuY2htYXJr\nLmFtSVJlc3BvbnNpYmxlRm9yVG9waWMoc3RhcnRUb3BpY0xhYmVsICsgaSwg\ncGFydGl0aW9uSW5kZXgsIG51bVBhcnRpdGlvbnMpKSB7CiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBCeXRl\nU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoSGVkd2ln\nQmVuY2htYXJrLlRPUElDX1BSRUZJWCArIChzdGFydFRvcGljTGFiZWwgKyBp\nKSk7CiAgICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRvcGljLCBtc2cp\nOwogICAgICAgICAgICBteVB1Ymxpc2hDb3VudCsrOwogICAgICAgIH0KCiAg\nICAgICAgbG9uZyBzdGFydFRpbWUgPSBNYXRoVXRpbHMubm93KCk7CiAgICAg\nICAgaW50IG15UHVibGlzaExpbWl0ID0gbnVtTWVzc2FnZXMgLyBudW1SZWdp\nb25zIC8gbnVtUGFydGl0aW9ucyAtIG15UHVibGlzaENvdW50OwogICAgICAg\nIG15UHVibGlzaENvdW50ID0gMDsKICAgICAgICBUaHJvdWdocHV0TGF0ZW5j\neUFnZ3JlZ2F0b3IgYWdnID0gbmV3IFRocm91Z2hwdXRMYXRlbmN5QWdncmVn\nYXRvcigiYWNrZWQgcHVicyIsIG15UHVibGlzaExpbWl0LCBuUGFyYWxsZWwp\nOwogICAgICAgIGFnZy5zdGFydFByb2dyZXNzKCk7CgogICAgICAgIGludCB0\nb3BpY0xhYmVsID0gMDsKCiAgICAgICAgd2hpbGUgKG15UHVibGlzaENvdW50\nIDwgbXlQdWJsaXNoTGltaXQpIHsKICAgICAgICAgICAgaW50IHRvcGljTnVt\nID0gc3RhcnRUb3BpY0xhYmVsICsgdG9waWNMYWJlbDsKICAgICAgICAgICAg\ndG9waWNMYWJlbCA9ICh0b3BpY0xhYmVsICsgMSkgJSBudW1Ub3BpY3M7Cgog\nICAgICAgICAgICBpZiAoIUhlZHdpZ0JlbmNobWFyay5hbUlSZXNwb25zaWJs\nZUZvclRvcGljKHRvcGljTnVtLCBwYXJ0aXRpb25JbmRleCwgbnVtUGFydGl0\naW9ucykpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmlu\nZy5jb3B5RnJvbVV0ZjgoSGVkd2lnQmVuY2htYXJrLlRPUElDX1BSRUZJWCAr\nIHRvcGljTnVtKTsKCiAgICAgICAgICAgIGlmIChyYXRlID4gMCkgewogICAg\nICAgICAgICAgICAgbG9uZyBkZWxheSA9IHN0YXJ0VGltZSArIChsb25nKSAo\nMTAwMCAqIG15UHVibGlzaENvdW50IC8gcmF0ZSkgLSBNYXRoVXRpbHMubm93\nKCk7CiAgICAgICAgICAgICAgICBpZiAoZGVsYXkgPiAwKQogICAgICAgICAg\nICAgICAgICAgIFRocmVhZC5zbGVlcChkZWxheSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcHVibGlzaGVyLmFzeW5jUHVibGlzaCh0b3BpYywgbXNn\nLCBuZXcgQmVuY2htYXJrQ2FsbGJhY2soYWdnKSwgbnVsbCk7CiAgICAgICAg\nICAgIG15UHVibGlzaENvdW50Kys7CiAgICAgICAgfQoKICAgICAgICBTeXN0\nZW0ub3V0LnByaW50bG4oIkZpbmlzaGVkIHVuYWNrZWQgcHViczogdHB1dCA9\nICIgKyBCZW5jaG1hcmtVdGlscy5jYWxjVHAobXlQdWJsaXNoTGltaXQsIHN0\nYXJ0VGltZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIG9wcy9z\nIik7CiAgICAgICAgLy8gV2FpdCB0aWxsIHRoZSBiZW5jaG1hcmsgdGVzdCBo\nYXMgY29tcGxldGVkCiAgICAgICAgYWdnLnRwQWdnLnF1ZXVlLnRha2UoKTsK\nICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oYWdnLnN1bW1hcml6ZShzdGFy\ndFRpbWUpKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCn0K\n","encoding":"base64"}

