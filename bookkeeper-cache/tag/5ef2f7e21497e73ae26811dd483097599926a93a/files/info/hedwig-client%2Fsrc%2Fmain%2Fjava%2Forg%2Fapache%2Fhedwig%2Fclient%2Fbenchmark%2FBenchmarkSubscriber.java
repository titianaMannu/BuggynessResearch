{"sha":"9138861b19d574fda19827e8855b807f89d10df0","node_id":"MDQ6QmxvYjE1NzU5NTY6OTEzODg2MWIxOWQ1NzRmZGExOTgyN2U4ODU1YjgwN2Y4OWQxMGRmMA==","size":5954,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9138861b19d574fda19827e8855b807f89d10df0","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrOwoKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcDsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNhbGxhYmxlOwoKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7\nCgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuTWF0aFV0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5NZXNzYWdl\nSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGku\nU3Vic2NyaWJlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5i\nZW5jaG1hcmsuQmVuY2htYXJrVXRpbHMuQmVuY2htYXJrQ2FsbGJhY2s7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrLkJlbmNo\nbWFya1V0aWxzLlRocm91Z2hwdXRBZ2dyZWdhdG9yOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuY2xpZW50LmJlbmNobWFyay5CZW5jaG1hcmtVdGlscy5U\naHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0b3I7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlOwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUmVnaW9uU3BlY2lmaWNTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3Jl\nYXRlT3JBdHRhY2g7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNh\nbGxiYWNrOwoKcHVibGljIGNsYXNzIEJlbmNobWFya1N1YnNjcmliZXIgZXh0\nZW5kcyBCZW5jaG1hcmtXb3JrZXIgaW1wbGVtZW50cyBDYWxsYWJsZTxWb2lk\nPiB7CiAgICBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZh\nY3RvcnkuZ2V0TG9nZ2VyKEJlbmNobWFya1N1YnNjcmliZXIuY2xhc3MpOwog\nICAgU3Vic2NyaWJlciBzdWJzY3JpYmVyOwogICAgQnl0ZVN0cmluZyBzdWJJ\nZDsKCgogICAgcHVibGljIEJlbmNobWFya1N1YnNjcmliZXIoaW50IG51bVRv\ncGljcywgaW50IG51bU1lc3NhZ2VzLCBpbnQgbnVtUmVnaW9ucywKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzdGFydFRvcGljTGFiZWws\nIGludCBwYXJ0aXRpb25JbmRleCwgaW50IG51bVBhcnRpdGlvbnMsIFN1YnNj\ncmliZXIgc3Vic2NyaWJlciwgQnl0ZVN0cmluZyBzdWJJZCkgewogICAgICAg\nIHN1cGVyKG51bVRvcGljcywgbnVtTWVzc2FnZXMsIG51bVJlZ2lvbnMsIHN0\nYXJ0VG9waWNMYWJlbCwgcGFydGl0aW9uSW5kZXgsIG51bVBhcnRpdGlvbnMp\nOwogICAgICAgIHRoaXMuc3Vic2NyaWJlciA9IHN1YnNjcmliZXI7CiAgICAg\nICAgdGhpcy5zdWJJZCA9IHN1YklkOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdhcm11cChpbnQgbnVtV2FybXVwKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgIC8qCiAgICAgICAgICogbXVsdGlwbHlpbmcgdGhl\nIG51bWJlciBvZiBvcHMgYnkgbnVtUGFyaXRpb25zIGJlY2F1c2Ugd2UgZW5k\nIHVwCiAgICAgICAgICogc2tpcHBpbmcgbWFueSBiZWNhdXNlIG9mIHRoZSBw\nYXJ0aXRpb25pbmcgbG9naWMKICAgICAgICAgKi8KICAgICAgICBtdWx0aVN1\nYigid2FybXVwIiwgIndhcm11cCIsIDAsIG51bVdhcm11cCwgbnVtV2FybXVw\nICogbnVtUGFydGl0aW9ucyk7CiAgICB9CgogICAgcHVibGljIFZvaWQgY2Fs\nbCgpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBmaW5hbCBUaHJvdWdo\ncHV0QWdncmVnYXRvciBhZ2cgPSBuZXcgVGhyb3VnaHB1dEFnZ3JlZ2F0b3Io\nInJlY3ZzIiwgbnVtTWVzc2FnZXMpOwogICAgICAgIGFnZy5zdGFydFByb2dy\nZXNzKCk7CgogICAgICAgIGZpbmFsIE1hcDxTdHJpbmcsIExvbmc+IGxhc3RT\nZXFJZFNlZW5NYXAgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIExvbmc+KCk7Cgog\nICAgICAgIGZvciAoaW50IGkgPSBzdGFydFRvcGljTGFiZWw7IGkgPCBzdGFy\ndFRvcGljTGFiZWwgKyBudW1Ub3BpY3M7IGkrKykgewoKICAgICAgICAgICAg\naWYgKCFIZWR3aWdCZW5jaG1hcmsuYW1JUmVzcG9uc2libGVGb3JUb3BpYyhp\nLCBwYXJ0aXRpb25JbmRleCwgbnVtUGFydGl0aW9ucykpIHsKICAgICAgICAg\nICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBm\naW5hbCBTdHJpbmcgdG9waWMgPSBIZWR3aWdCZW5jaG1hcmsuVE9QSUNfUFJF\nRklYICsgaTsKCiAgICAgICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KHRvcGljKSwgc3ViSWQsIENyZWF0ZU9y\nQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpOwogICAgICAgICAgICBzdWJzY3Jp\nYmVyLnN0YXJ0RGVsaXZlcnkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgodG9w\naWMpLCBzdWJJZCwgbmV3IE1lc3NhZ2VIYW5kbGVyKCkgewoKICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\nZGVsaXZlcihCeXRlU3RyaW5nIHRoaXNUb3BpYywgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQsIE1lc3NhZ2UgbXNnLAogICAgICAgICAgICAgICAgQ2FsbGJh\nY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJHb3QgbWVzc2FnZSBmcm9tIHNy\nYy1yZWdpb246IHt9IHdpdGggc2VxLWlkOiB7fSIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIG1zZy5nZXRTcmNSZWdpb24oKSwgbXNnLmdldE1zZ0lkKCkp\nOwoKICAgICAgICAgICAgICAgICAgICBTdHJpbmcgbWFwS2V5ID0gdG9waWMg\nKyBtc2cuZ2V0U3JjUmVnaW9uKCkudG9TdHJpbmdVdGY4KCk7CiAgICAgICAg\nICAgICAgICAgICAgTG9uZyBsYXN0U2VxSWRTZWVuID0gbGFzdFNlcUlkU2Vl\nbk1hcC5nZXQobWFwS2V5KTsKICAgICAgICAgICAgICAgICAgICBpZiAobGFz\ndFNlcUlkU2VlbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGxhc3RTZXFJZFNlZW4gPSAobG9uZykgMDsKICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChnZXRTcmNTZXFJZChtc2cp\nIDw9IGxhc3RTZXFJZFNlZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbG9nZ2VyLmluZm8oIlJlZGVsaXZlcnkgb2YgbWVzc2FnZSwgc3JjLXJlZ2lv\nbjogIiArIG1zZy5nZXRTcmNSZWdpb24oKSArICJzZXEtaWQ6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBtc2cuZ2V0TXNnSWQo\nKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgYWdnLmRpbmcoZmFsc2UpOwogICAgICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9u\nRmluaXNoZWQoY29udGV4dCwgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBTeXN0ZW0ub3V0LnBy\naW50bG4oIkZpbmlzaGVkIHN1YnNjcmliaW5nIHRvIHRvcGljcyBhbmQgbm93\nIHdhaXRpbmcgZm9yIG1lc3NhZ2VzIHRvIGNvbWUgaW4uLi4iKTsKICAgICAg\nICAvLyBXYWl0IHRpbGwgdGhlIGJlbmNobWFyayB0ZXN0IGhhcyBjb21wbGV0\nZWQKICAgICAgICBhZ2cucXVldWUudGFrZSgpOwogICAgICAgIFN5c3RlbS5v\ndXQucHJpbnRsbihhZ2cuc3VtbWFyaXplKGFnZy5lYXJsaWVzdC5nZXQoKSkp\nOwogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIGxvbmcgZ2V0U3Jj\nU2VxSWQoTWVzc2FnZSBtc2cpIHsKICAgICAgICBpZiAobXNnLmdldE1zZ0lk\nKCkuZ2V0UmVtb3RlQ29tcG9uZW50c0NvdW50KCkgPT0gMCkgewogICAgICAg\nICAgICByZXR1cm4gbXNnLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21wb25lbnQo\nKTsKICAgICAgICB9CgogICAgICAgIGZvciAoUmVnaW9uU3BlY2lmaWNTZXFJ\nZCByc2VxSWQgOiBtc2cuZ2V0TXNnSWQoKS5nZXRSZW1vdGVDb21wb25lbnRz\nTGlzdCgpKSB7CiAgICAgICAgICAgIGlmIChyc2VxSWQuZ2V0UmVnaW9uKCku\nZXF1YWxzKG1zZy5nZXRTcmNSZWdpb24oKSkpCiAgICAgICAgICAgICAgICBy\nZXR1cm4gcnNlcUlkLmdldFNlcUlkKCk7CiAgICAgICAgfQoKICAgICAgICBy\nZXR1cm4gbXNnLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21wb25lbnQoKTsKICAg\nIH0KCiAgICB2b2lkIG11bHRpU3ViKFN0cmluZyBsYWJlbCwgU3RyaW5nIHRv\ncGljUHJlZml4LCBpbnQgc3RhcnQsIGZpbmFsIGludCBucGFyLCBmaW5hbCBp\nbnQgY291bnQpCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgbG9uZyBzdGFydFRpbWUgPSBNYXRoVXRpbHMubm93\nKCk7CiAgICAgICAgVGhyb3VnaHB1dExhdGVuY3lBZ2dyZWdhdG9yIGFnZyA9\nIG5ldyBUaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0b3IobGFiZWwsIGNvdW50\nIC8gbnVtUGFydGl0aW9ucywgbnBhcik7CiAgICAgICAgYWdnLnN0YXJ0UHJv\nZ3Jlc3MoKTsKCiAgICAgICAgaW50IGVuZCA9IHN0YXJ0ICsgY291bnQ7CiAg\nICAgICAgZm9yIChpbnQgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpIHsKICAg\nICAgICAgICAgaWYgKCFIZWR3aWdCZW5jaG1hcmsuYW1JUmVzcG9uc2libGVG\nb3JUb3BpYyhpLCBwYXJ0aXRpb25JbmRleCwgbnVtUGFydGl0aW9ucykpIHsK\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHN1YnNjcmliZXIuYXN5bmNTdWJzY3JpYmUoQnl0ZVN0cmluZy5j\nb3B5RnJvbVV0ZjgodG9waWNQcmVmaXggKyBpKSwgc3ViSWQsIENyZWF0ZU9y\nQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IEJlbmNobWFya0NhbGxiYWNrKGFnZyks\nIG51bGwpOwogICAgICAgIH0KICAgICAgICAvLyBXYWl0IHRpbGwgdGhlIGJl\nbmNobWFyayB0ZXN0IGhhcyBjb21wbGV0ZWQKICAgICAgICBhZ2cudHBBZ2cu\ncXVldWUudGFrZSgpOwogICAgICAgIGlmIChjb3VudCA+IDEpCiAgICAgICAg\nICAgIFN5c3RlbS5vdXQucHJpbnRsbihhZ2cuc3VtbWFyaXplKHN0YXJ0VGlt\nZSkpOwogICAgfQoKfQo=\n","encoding":"base64"}

