{"sha":"3efe22da20938a875dee575044d9c5e4e9d234b0","node_id":"MDQ6QmxvYjE1NzU5NTY6M2VmZTIyZGEyMDkzOGE4NzVkZWU1NzUwNDRkOWM1ZTRlOWQyMzRiMA==","size":7029,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3efe22da20938a875dee575044d9c5e4e9d234b0","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrOwoKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkxpbmtlZEJsb2NraW5nUXVldWU7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TZW1hcGhvcmU7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNMb25n\nOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ndXRpbC5NYXRoVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5leGNl\ncHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnV0aWwuQ2FsbGJhY2s7CgpwdWJsaWMgY2xhc3MgQmVuY2htYXJrVXRp\nbHMgewogICAgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihCZW5jaG1hcmtVdGlscy5jbGFzcyk7CgogICAg\ncHVibGljIHN0YXRpYyBkb3VibGUgY2FsY1RwKGZpbmFsIGludCBjb3VudCwg\nbG9uZyBzdGFydFRpbWUpIHsKICAgICAgICByZXR1cm4gMTAwMC4gKiBjb3Vu\ndCAvIChNYXRoVXRpbHMubm93KCkgLSBzdGFydFRpbWUpOwogICAgfQoKICAg\nIC8qKgogICAgICogU3RhdHMgYWdncmVnYXRvciBmb3IgY2FsbGJhY2sgKHJv\ndW5kLXRyaXApIG9wZXJhdGlvbnMuIE1lYXN1cmVzIGJvdGgKICAgICAqIHRo\ncm91Z2hwdXQgYW5kIGxhdGVuY3kuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgY2xhc3MgVGhyb3VnaHB1dExhdGVuY3lBZ2dyZWdhdG9yIHsKICAgICAg\nICBpbnQgbnVtQnVja2V0czsKICAgICAgICBmaW5hbCBUaHJvdWdocHV0QWdn\ncmVnYXRvciB0cEFnZzsKICAgICAgICBmaW5hbCBTZW1hcGhvcmUgb3V0c3Rh\nbmRpbmc7CiAgICAgICAgZmluYWwgQXRvbWljTG9uZyBzdW0gPSBuZXcgQXRv\nbWljTG9uZygpOwoKICAgICAgICBmaW5hbCBBdG9taWNMb25nW10gbGF0ZW5j\neUJ1Y2tldHM7CgogICAgICAgIC8vIGJ1Y2tldFtpXSBpcyBjb3VudCBvZiBu\ndW1iZXIgb2Ygb3BlcmF0aW9ucyB0aGF0IHRvb2sgPj0gaSBtcyBhbmQgPAog\nICAgICAgIC8vIChpKzEpIG1zLgoKICAgICAgICBwdWJsaWMgVGhyb3VnaHB1\ndExhdGVuY3lBZ2dyZWdhdG9yKFN0cmluZyBsYWJlbCwgaW50IGNvdW50LCBp\nbnQgbGltaXQpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIG51bUJ1Y2tldHMgPSBJbnRlZ2VyLmdldEludGVnZXIoIm51bUJ1\nY2tldHMiLCAxMDEpOwogICAgICAgICAgICBsYXRlbmN5QnVja2V0cyA9IG5l\ndyBBdG9taWNMb25nW251bUJ1Y2tldHNdOwogICAgICAgICAgICB0cEFnZyA9\nIG5ldyBUaHJvdWdocHV0QWdncmVnYXRvcihsYWJlbCwgY291bnQpOwogICAg\nICAgICAgICBvdXRzdGFuZGluZyA9IG5ldyBTZW1hcGhvcmUobGltaXQpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUJ1Y2tldHM7IGkr\nKykgewogICAgICAgICAgICAgICAgbGF0ZW5jeUJ1Y2tldHNbaV0gPSBuZXcg\nQXRvbWljTG9uZygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBzdGFydFByb2dyZXNzKCkgewogICAgICAgICAgICB0\ncEFnZy5zdGFydFByb2dyZXNzKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCByZXBvcnRMYXRlbmN5KGxvbmcgbGF0ZW5jeSkgewogICAgICAg\nICAgICBzdW0uYWRkQW5kR2V0KGxhdGVuY3kpOwoKICAgICAgICAgICAgaW50\nIGJ1Y2tldEluZGV4OwogICAgICAgICAgICBpZiAobGF0ZW5jeSA+PSBudW1C\ndWNrZXRzKSB7CiAgICAgICAgICAgICAgICBidWNrZXRJbmRleCA9IChpbnQp\nIG51bUJ1Y2tldHMgLSAxOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgYnVja2V0SW5kZXggPSAoaW50KSBsYXRlbmN5OwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGxhdGVuY3lCdWNrZXRzW2J1Y2tldEluZGV4\nXS5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICB9CgogICAgICAgIHByaXZh\ndGUgU3RyaW5nIGdldFBlcmNlbnRpbGUoZG91YmxlIHBlcmNlbnRpbGUpIHsK\nICAgICAgICAgICAgaW50IG51bUlubGllcnNOZWVkZWQgPSAoaW50KSAocGVy\nY2VudGlsZSAvIDEwMCAqIHRwQWdnLmNvdW50KTsKICAgICAgICAgICAgaW50\nIG51bUlubGllcnNGb3VuZCA9IDA7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbnVtQnVja2V0cyAtIDE7IGkrKykgewogICAgICAgICAgICAg\nICAgbnVtSW5saWVyc0ZvdW5kICs9IGxhdGVuY3lCdWNrZXRzW2ldLmludFZh\nbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAobnVtSW5saWVyc0ZvdW5kID4g\nbnVtSW5saWVyc05lZWRlZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBpICsgIiI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcmV0dXJuICIgPj0gIiArIChudW1CdWNrZXRzIC0gMSk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHN1bW1hcml6ZShsb25n\nIHN0YXJ0VGltZSkgewogICAgICAgICAgICBkb3VibGUgcGVyY2VudGlsZSA9\nIERvdWJsZS5wYXJzZURvdWJsZShTeXN0ZW0uZ2V0UHJvcGVydHkoInBlcmNl\nbnRpbGUiLCAiOTkuOSIpKTsKICAgICAgICAgICAgcmV0dXJuIHRwQWdnLnN1\nbW1hcml6ZShzdGFydFRpbWUpICsgIiwgYXZnIGxhdGVuY3kgPSAiICsgc3Vt\nLmdldCgpIC8gdHBBZ2cuY291bnQgKyAiLCAiICsgcGVyY2VudGlsZQogICAg\nICAgICAgICAgICAgICAgKyAiJWlsZSBsYXRlbmN5ID0gIiArIGdldFBlcmNl\nbnRpbGUocGVyY2VudGlsZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogU3RhdHMgYWdncmVnYXRvciBmb3Igbm9uLWNhbGxiYWNrIChzaW5n\nbGUtc2hvdCkgb3BlcmF0aW9ucy4gTWVhc3VyZXMganVzdAogICAgICogdGhy\nb3VnaHB1dC4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFzcyBUaHJv\ndWdocHV0QWdncmVnYXRvciB7CiAgICAgICAgZmluYWwgU3RyaW5nIGxhYmVs\nOwogICAgICAgIGZpbmFsIGludCBjb3VudDsKICAgICAgICBmaW5hbCBBdG9t\naWNJbnRlZ2VyIGRvbmUgPSBuZXcgQXRvbWljSW50ZWdlcigpOwogICAgICAg\nIGZpbmFsIEF0b21pY0xvbmcgZWFybGllc3QgPSBuZXcgQXRvbWljTG9uZygp\nOwogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgbnVtRmFpbGVkID0gbmV3\nIEF0b21pY0ludGVnZXIoKTsKICAgICAgICBmaW5hbCBUaHJlYWQgcHJvZ3Jl\nc3NUaHJlYWQ7CiAgICAgICAgZmluYWwgTGlua2VkQmxvY2tpbmdRdWV1ZTxJ\nbnRlZ2VyPiBxdWV1ZSA9IG5ldyBMaW5rZWRCbG9ja2luZ1F1ZXVlPEludGVn\nZXI+KCk7CgogICAgICAgIHB1YmxpYyBUaHJvdWdocHV0QWdncmVnYXRvcihm\naW5hbCBTdHJpbmcgbGFiZWwsIGZpbmFsIGludCBjb3VudCkgewogICAgICAg\nICAgICB0aGlzLmxhYmVsID0gbGFiZWw7CiAgICAgICAgICAgIHRoaXMuY291\nbnQgPSBjb3VudDsKICAgICAgICAgICAgaWYgKGNvdW50ID09IDApCiAgICAg\nICAgICAgICAgICBxdWV1ZS5hZGQoMCk7CiAgICAgICAgICAgIGlmIChCb29s\nZWFuLmdldEJvb2xlYW4oInByb2dyZXNzIikpIHsKICAgICAgICAgICAgICAg\nIHByb2dyZXNzVGhyZWFkID0gbmV3IFRocmVhZChuZXcgUnVubmFibGUoKSB7\nCiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChp\nbnQgZG9uZVNuYXAgPSAwLCBwcmV2ID0gMDsgZG9uZVNuYXAgPCBjb3VudDsg\ncHJldiA9IGRvbmVTbmFwLCBkb25lU25hcCA9IGRvbmUuZ2V0KCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9uZVNuYXAgPiBw\ncmV2KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN5\nc3RlbS5vdXQucHJpbnRsbihsYWJlbCArICIgcHJvZ3Jlc3M6ICIgKyBkb25l\nU25hcCArICIgb2YgIiArIGNvdW50KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBSdW50aW1lRXhjZXB0aW9uKGV4KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBy\nb2dyZXNzVGhyZWFkID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgc3RhcnRQcm9ncmVzcygpIHsKICAgICAg\nICAgICAgaWYgKHByb2dyZXNzVGhyZWFkICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHByb2dyZXNzVGhyZWFkLnN0YXJ0KCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGRpbmcoYm9vbGVhbiBm\nYWlsZWQpIHsKICAgICAgICAgICAgaW50IHNuYXBEb25lID0gZG9uZS5pbmNy\nZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgZWFybGllc3QuY29tcGFyZUFu\nZFNldCgwLCBNYXRoVXRpbHMubm93KCkpOwogICAgICAgICAgICBpZiAoZmFp\nbGVkKQogICAgICAgICAgICAgICAgbnVtRmFpbGVkLmluY3JlbWVudEFuZEdl\ndCgpOwogICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcobGFiZWwgKyAiICIgKyAo\nZmFpbGVkID8gImZhaWxlZCIgOiAic3VjY2VlZGVkIikgKyAiLCBkb25lIHNv\nIGZhciA9ICIgKyBzbmFwRG9uZSk7CiAgICAgICAgICAgIGlmIChzbmFwRG9u\nZSA9PSBjb3VudCkgewogICAgICAgICAgICAgICAgcXVldWUuYWRkKG51bUZh\naWxlZC5nZXQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdHJpbmcgc3VtbWFyaXplKGxvbmcgc3RhcnRUaW1lKSB7CiAg\nICAgICAgICAgIHJldHVybiAiRmluaXNoZWQgIiArIGxhYmVsICsgIjogY291\nbnQgPSAiICsgZG9uZS5nZXQoKSArICIsIHRwdXQgPSAiICsgY2FsY1RwKGNv\ndW50LCBzdGFydFRpbWUpCiAgICAgICAgICAgICAgICAgICArICIgb3BzL3Ms\nIG51bUZhaWxlZCA9ICIgKyBudW1GYWlsZWQ7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgQmVuY2htYXJrQ2FsbGJhY2sgaW1w\nbGVtZW50cyBDYWxsYmFjazxWb2lkPiB7CgogICAgICAgIGZpbmFsIFRocm91\nZ2hwdXRMYXRlbmN5QWdncmVnYXRvciBhZ2c7CiAgICAgICAgZmluYWwgbG9u\nZyBzdGFydFRpbWU7CgogICAgICAgIHB1YmxpYyBCZW5jaG1hcmtDYWxsYmFj\nayhUaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0b3IgYWdnKSB0aHJvd3MgSW50\nZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICB0aGlzLmFnZyA9IGFn\nZzsKICAgICAgICAgICAgYWdnLm91dHN0YW5kaW5nLmFjcXVpcmUoKTsKICAg\nICAgICAgICAgLy8gTXVzdCBzZXQgdGhlIHN0YXJ0IHRpbWUgKmFmdGVyKiB0\nYWtpbmcgYWNxdWlyaW5nIG9uIG91dHN0YW5kaW5nLgogICAgICAgICAgICBz\ndGFydFRpbWUgPSBNYXRoVXRpbHMubm93KCk7CiAgICAgICAgfQoKICAgICAg\nICBwcml2YXRlIHZvaWQgZmluaXNoKGJvb2xlYW4gZmFpbGVkKSB7CiAgICAg\nICAgICAgIGFnZy5yZXBvcnRMYXRlbmN5KE1hdGhVdGlscy5ub3coKSAtIHN0\nYXJ0VGltZSk7CiAgICAgICAgICAgIGFnZy50cEFnZy5kaW5nKGZhaWxlZCk7\nCiAgICAgICAgICAgIGFnZy5vdXRzdGFuZGluZy5yZWxlYXNlKCk7CiAgICAg\nICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBv\ncGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdE9mT3Bl\ncmF0aW9uKSB7CiAgICAgICAgICAgIGZpbmlzaChmYWxzZSk7CiAgICAgICAg\nfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2Vw\ndGlvbikgewogICAgICAgICAgICBmaW5pc2godHJ1ZSk7CiAgICAgICAgfQog\nICAgfTsKCn0K\n","encoding":"base64"}

