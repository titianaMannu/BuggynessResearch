{"sha":"1f78897da66a668e3b32ee0ceb3f13b54ee03976","node_id":"MDQ6QmxvYjE1NzU5NTY6MWY3ODg5N2RhNjZhNjY4ZTNiMzJlZTBjZWIzZjEzYjU0ZWUwMzk3Ng==","size":22904,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1f78897da66a668e3b32ee0ceb3f13b54ee03976","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHk7CgppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5jbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3JpYmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuY2xpZW50LmNvbmYuQ2xpZW50Q29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5kYXRhLlB1YlN1\nYkRhdGE7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuZGF0YS5U\nb3BpY1N1YnNjcmliZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGll\nbnQuZXhjZXB0aW9ucy5BbHJlYWR5U3RhcnREZWxpdmVyeUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5leGNlcHRpb25zLklu\ndmFsaWRTdWJzY3JpYmVySWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5jbGllbnQuaGFuZGxlcnMuUHViU3ViQ2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuaGFuZGxlcnMuU3Vic2NyaWJl\nUmVzcG9uc2VIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZmls\ndGVyLkNsaWVudE1lc3NhZ2VGaWx0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLkNsaWVu\ndEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb24uQ2xpZW50Tm90\nU3Vic2NyaWJlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLkNvdWxkTm90Q29ubmVjdEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMu\nUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZTsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9k\neTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1\nZXN0LkNyZWF0ZU9yQXR0YWNoOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9leHRlbnNpb25zLlN1YnNjcmlwdGlvblN0YXRlVXRpbHM7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcudXRpbC5TdWJzY3JpcHRpb25MaXN0ZW5lcjsKCi8q\nKgogKiBUaGlzIGlzIHRoZSBIZWR3aWcgTmV0dHkgc3BlY2lmaWMgaW1wbGVt\nZW50YXRpb24gb2YgdGhlIFN1YnNjcmliZXIgaW50ZXJmYWNlLgogKgogKi8K\ncHVibGljIGNsYXNzIEhlZHdpZ1N1YnNjcmliZXIgaW1wbGVtZW50cyBTdWJz\nY3JpYmVyIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0g\nTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSGVkd2lnU3Vic2NyaWJlci5jbGFz\ncyk7CgogICAgcHJvdGVjdGVkIGZpbmFsIENsaWVudENvbmZpZ3VyYXRpb24g\nY2ZnOwogICAgcHJvdGVjdGVkIGZpbmFsIEhDaGFubmVsTWFuYWdlciBjaGFu\nbmVsTWFuYWdlcjsKCiAgICBwdWJsaWMgSGVkd2lnU3Vic2NyaWJlcihIZWR3\naWdDbGllbnRJbXBsIGNsaWVudCkgewogICAgICAgIHRoaXMuY2ZnID0gY2xp\nZW50LmdldENvbmZpZ3VyYXRpb24oKTsKICAgICAgICB0aGlzLmNoYW5uZWxN\nYW5hZ2VyID0gY2xpZW50LmdldEhDaGFubmVsTWFuYWdlcigpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIGFkZFN1YnNjcmlwdGlvbkxpc3RlbmVyKFN1YnNj\ncmlwdGlvbkxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgY2hhbm5lbE1h\nbmFnZXIuZ2V0U3Vic2NyaXB0aW9uRXZlbnRFbWl0dGVyKCkKICAgICAgICAg\nICAgICAgICAgICAgIC5hZGRTdWJzY3JpcHRpb25MaXN0ZW5lcihsaXN0ZW5l\ncik7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVtb3ZlU3Vic2NyaXB0aW9u\nTGlzdGVuZXIoU3Vic2NyaXB0aW9uTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAg\nICAgICBjaGFubmVsTWFuYWdlci5nZXRTdWJzY3JpcHRpb25FdmVudEVtaXR0\nZXIoKQogICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZVN1YnNjcmlwdGlv\nbkxpc3RlbmVyKGxpc3RlbmVyKTsKICAgIH0KCiAgICAvLyBQcml2YXRlIG1l\ndGhvZCB0aGF0IGhvbGRzIHRoZSBjb21tb24gbG9naWMgZm9yIGRvaW5nIHN5\nbmNocm9ub3VzCiAgICAvLyBTdWJzY3JpYmUgb3IgVW5zdWJzY3JpYmUgcmVx\ndWVzdHMuIFRoaXMgaXMgZm9yIGNvZGUgcmV1c2Ugc2luY2UgdGhlc2UKICAg\nIC8vIHR3byBmbG93cyBhcmUgdmVyeSBzaW1pbGFyLiBUaGUgYXNzdW1wdGlv\nbiBpcyB0aGF0IHRoZSBpbnB1dAogICAgLy8gT3BlcmF0aW9uVHlwZSBpcyBl\naXRoZXIgU1VCU0NSSUJFIG9yIFVOU1VCU0NSSUJFLgogICAgcHJpdmF0ZSB2\nb2lkIHN1YlVuc3ViKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vi\nc2NyaWJlcklkLCBPcGVyYXRpb25UeXBlIG9wZXJhdGlvblR5cGUsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRp\nb25zKQogICAgICAgICAgICB0aHJvd3MgQ291bGROb3RDb25uZWN0RXhjZXB0\naW9uLCBDbGllbnRBbHJlYWR5U3Vic2NyaWJlZEV4Y2VwdGlvbiwKICAgICAg\nICBDbGllbnROb3RTdWJzY3JpYmVkRXhjZXB0aW9uLCBTZXJ2aWNlRG93bkV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgZGVidWdNc2cgPSBuZXcg\nU3RyaW5nQnVpbGRlcigpLmFwcGVuZCgiQ2FsbGluZyBhIHN5bmMgc3ViVW5z\ndWIgcmVxdWVzdCBmb3IgdG9waWM6ICIpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuYXBwZW5kKHRvcGljLnRvU3RyaW5nVXRmOCgp\nKS5hcHBlbmQoIiwgc3Vic2NyaWJlcklkOiAiKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChzdWJzY3JpYmVySWQudG9T\ndHJpbmdVdGY4KCkpLmFwcGVuZCgiLCBvcGVyYXRpb25UeXBlOiAiKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChvcGVy\nYXRpb25UeXBlKTsKICAgICAgICAgICAgaWYgKG51bGwgIT0gb3B0aW9ucykg\newogICAgICAgICAgICAgICAgZGVidWdNc2cuYXBwZW5kKCIsIGNyZWF0ZU9y\nQXR0YWNoOiAiKS5hcHBlbmQob3B0aW9ucy5nZXRDcmVhdGVPckF0dGFjaCgp\nKQogICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCIsIG1lc3NhZ2VC\nb3VuZDogIikuYXBwZW5kKG9wdGlvbnMuZ2V0TWVzc2FnZUJvdW5kKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhkZWJ1Z01z\nZy50b1N0cmluZygpKTsKICAgICAgICB9CiAgICAgICAgUHViU3ViRGF0YSBw\ndWJTdWJEYXRhID0gbmV3IFB1YlN1YkRhdGEodG9waWMsIG51bGwsIHN1YnNj\ncmliZXJJZCwgb3BlcmF0aW9uVHlwZSwgb3B0aW9ucywgbnVsbCwgbnVsbCk7\nCiAgICAgICAgc3luY2hyb25pemVkIChwdWJTdWJEYXRhKSB7CiAgICAgICAg\nICAgIFB1YlN1YkNhbGxiYWNrIHB1YlN1YkNhbGxiYWNrID0gbmV3IFB1YlN1\nYkNhbGxiYWNrKHB1YlN1YkRhdGEpOwogICAgICAgICAgICBhc3luY1N1YlVu\nc3ViKHRvcGljLCBzdWJzY3JpYmVySWQsIHB1YlN1YkNhbGxiYWNrLCBudWxs\nLCBvcGVyYXRpb25UeXBlLCBvcHRpb25zKTsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIHdoaWxlICghcHViU3ViRGF0YS5pc0RvbmUpCiAg\nICAgICAgICAgICAgICAgICAgcHViU3ViRGF0YS53YWl0KCk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBTZXJ2aWNlRG93bkV4Y2VwdGlvbigiSW50\nZXJydXB0ZWQgRXhjZXB0aW9uIHdoaWxlIHdhaXRpbmcgZm9yIGFzeW5jIHN1\nYlVuc3ViIGNhbGwiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBD\naGVjayBmcm9tIHRoZSBQdWJTdWJDYWxsYmFjayBpZiBpdCB3YXMgc3VjY2Vz\nc2Z1bCBvciBub3QuCiAgICAgICAgICAgIGlmICghcHViU3ViQ2FsbGJhY2su\nZ2V0SXNDYWxsU3VjY2Vzc2Z1bCgpKSB7CiAgICAgICAgICAgICAgICAvLyBT\nZWUgd2hhdCB0aGUgZXhjZXB0aW9uIHdhcyB0aGF0IHdhcyB0aHJvd24gd2hl\nbiB0aGUgb3BlcmF0aW9uCiAgICAgICAgICAgICAgICAvLyBmYWlsZWQuCiAg\nICAgICAgICAgICAgICBQdWJTdWJFeGNlcHRpb24gZmFpbHVyZUV4Y2VwdGlv\nbiA9IHB1YlN1YkNhbGxiYWNrLmdldEZhaWx1cmVFeGNlcHRpb24oKTsKICAg\nICAgICAgICAgICAgIGlmIChmYWlsdXJlRXhjZXB0aW9uID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIHNob3VsZCBub3QgaGFwcGVu\nIGFzIHRoZSBvcGVyYXRpb24gZmFpbGVkIGJ1dCBhIG51bGwKICAgICAgICAg\nICAgICAgICAgICAvLyBQdWJTdWJFeGNlcHRpb24gd2FzIHBhc3NlZC4gTG9n\nIGEgd2FybmluZyBtZXNzYWdlIGJ1dAogICAgICAgICAgICAgICAgICAgIC8v\nIHRocm93IGEgZ2VuZXJpYyBTZXJ2aWNlRG93bkV4Y2VwdGlvbi4KICAgICAg\nICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlN5bmMgU3ViVW5zdWIgb3Bl\ncmF0aW9uIGZhaWxlZCBidXQgbm8gUHViU3ViRXhjZXB0aW9uIHdhcyBwYXNz\nZWQhIik7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNlcnZpY2VE\nb3duRXhjZXB0aW9uKCJTZXJ2ZXIgYWNrIHJlc3BvbnNlIHRvIFN1YlVuc3Vi\nIHJlcXVlc3QgaXMgbm90IHN1Y2Nlc3NmdWwiKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIC8vIEZvciB0aGUgZXhwZWN0ZWQgZXhjZXB0\naW9ucyB0aGF0IGNvdWxkIG9jY3VyLCBqdXN0IHJldGhyb3cKICAgICAgICAg\nICAgICAgIC8vIHRoZW0uCiAgICAgICAgICAgICAgICBlbHNlIGlmIChmYWls\ndXJlRXhjZXB0aW9uIGluc3RhbmNlb2YgQ291bGROb3RDb25uZWN0RXhjZXB0\naW9uKQogICAgICAgICAgICAgICAgICAgIHRocm93IChDb3VsZE5vdENvbm5l\nY3RFeGNlcHRpb24pIGZhaWx1cmVFeGNlcHRpb247CiAgICAgICAgICAgICAg\nICBlbHNlIGlmIChmYWlsdXJlRXhjZXB0aW9uIGluc3RhbmNlb2YgQ2xpZW50\nQWxyZWFkeVN1YnNjcmliZWRFeGNlcHRpb24pCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgKENsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uKSBm\nYWlsdXJlRXhjZXB0aW9uOwogICAgICAgICAgICAgICAgZWxzZSBpZiAoZmFp\nbHVyZUV4Y2VwdGlvbiBpbnN0YW5jZW9mIENsaWVudE5vdFN1YnNjcmliZWRF\neGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgKENsaWVudE5v\ndFN1YnNjcmliZWRFeGNlcHRpb24pIGZhaWx1cmVFeGNlcHRpb247CiAgICAg\nICAgICAgICAgICBlbHNlIGlmIChmYWlsdXJlRXhjZXB0aW9uIGluc3RhbmNl\nb2YgU2VydmljZURvd25FeGNlcHRpb24pCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgKFNlcnZpY2VEb3duRXhjZXB0aW9uKSBmYWlsdXJlRXhjZXB0aW9u\nOwogICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nbG9nZ2VyLmVycm9yKCJVbmV4cGVjdGVkIFB1YlN1YkV4Y2VwdGlvbiB0aHJv\nd246ICIsIGZhaWx1cmVFeGNlcHRpb24pOwogICAgICAgICAgICAgICAgICAg\nIC8vIFRocm93IGEgZ2VuZXJpYyBTZXJ2aWNlRG93bkV4Y2VwdGlvbiBidXQg\nd3JhcCB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBvcmlnaW5hbCBQdWJT\ndWJFeGNlcHRpb24gd2l0aGluIGl0LgogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBTZXJ2aWNlRG93bkV4Y2VwdGlvbihmYWlsdXJlRXhjZXB0aW9u\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvLyBQcml2YXRlIG1ldGhvZCB0aGF0IGhvbGRzIHRoZSBj\nb21tb24gbG9naWMgZm9yIGRvaW5nIGFzeW5jaHJvbm91cwogICAgLy8gU3Vi\nc2NyaWJlIG9yIFVuc3Vic2NyaWJlIHJlcXVlc3RzLiBUaGlzIGlzIGZvciBj\nb2RlIHJldXNlIHNpbmNlIHRoZXNlIHR3bwogICAgLy8gZmxvd3MgYXJlIHZl\ncnkgc2ltaWxhci4gVGhlIGFzc3VtcHRpb24gaXMgdGhhdCB0aGUgaW5wdXQg\nT3BlcmF0aW9uVHlwZSBpcwogICAgLy8gZWl0aGVyIFNVQlNDUklCRSBvciBV\nTlNVQlNDUklCRS4KICAgIHByaXZhdGUgdm9pZCBhc3luY1N1YlVuc3ViKEJ5\ndGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2s8UmVzcG9uc2VC\nb2R5PiBjYWxsYmFjaywgT2JqZWN0IGNvbnRleHQsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBPcGVyYXRpb25UeXBlIG9wZXJhdGlvblR5cGUs\nIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0aW9ucykgewogICAgICAgIGlmIChs\nb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICBTdHJpbmdC\ndWlsZGVyIGRlYnVnTXNnID0gbmV3IFN0cmluZ0J1aWxkZXIoKS5hcHBlbmQo\nIkNhbGxpbmcgYSBhc3luYyBzdWJVbnN1YiByZXF1ZXN0IGZvciB0b3BpYzog\nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBl\nbmQodG9waWMudG9TdHJpbmdVdGY4KCkpLmFwcGVuZCgiLCBzdWJzY3JpYmVy\nSWQ6ICIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nYXBwZW5kKHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKSkuYXBwZW5kKCIs\nIG9wZXJhdGlvblR5cGU6ICIpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuYXBwZW5kKG9wZXJhdGlvblR5cGUpOwogICAgICAgICAg\nICBpZiAobnVsbCAhPSBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBkZWJ1\nZ01zZy5hcHBlbmQoIiwgY3JlYXRlT3JBdHRhY2g6ICIpLmFwcGVuZChvcHRp\nb25zLmdldENyZWF0ZU9yQXR0YWNoKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIC5hcHBlbmQoIiwgbWVzc2FnZUJvdW5kOiAiKS5hcHBlbmQob3B0aW9u\ncy5nZXRNZXNzYWdlQm91bmQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgbG9nZ2VyLmRlYnVnKGRlYnVnTXNnLnRvU3RyaW5nKCkpOwogICAgICAg\nIH0KICAgICAgICBpZiAoT3BlcmF0aW9uVHlwZS5TVUJTQ1JJQkUuZXF1YWxz\nKG9wZXJhdGlvblR5cGUpKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmdl\ndE1lc3NhZ2VCb3VuZCgpIDw9IDAgJiYKICAgICAgICAgICAgICAgIGNmZy5n\nZXRTdWJzY3JpcHRpb25NZXNzYWdlQm91bmQoKSA+IDApIHsKICAgICAgICAg\nICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMuQnVpbGRlciBzb0J1aWxkZXIg\nPQogICAgICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3\nQnVpbGRlcihvcHRpb25zKS5zZXRNZXNzYWdlQm91bmQoCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNmZy5nZXRTdWJzY3JpcHRpb25NZXNzYWdlQm91bmQo\nKSk7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gc29CdWlsZGVyLmJ1aWxk\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgUHViU3ViRGF0\nYSBwdWJTdWJEYXRhID0gbmV3IFB1YlN1YkRhdGEodG9waWMsIG51bGwsIHN1\nYnNjcmliZXJJZCwgb3BlcmF0aW9uVHlwZSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLCBjYWxsYmFj\naywgY29udGV4dCk7CiAgICAgICAgY2hhbm5lbE1hbmFnZXIuc3VibWl0T3Ao\ncHViU3ViRGF0YSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Vic2NyaWJl\nKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBD\ncmVhdGVPckF0dGFjaCBtb2RlKQogICAgICAgICAgICB0aHJvd3MgQ291bGRO\nb3RDb25uZWN0RXhjZXB0aW9uLCBDbGllbnRBbHJlYWR5U3Vic2NyaWJlZEV4\nY2VwdGlvbiwgU2VydmljZURvd25FeGNlcHRpb24sCiAgICAgICAgSW52YWxp\nZFN1YnNjcmliZXJJZEV4Y2VwdGlvbiB7CiAgICAgICAgU3Vic2NyaXB0aW9u\nT3B0aW9ucyBvcHRpb25zID0gU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWls\nZGVyKCkuc2V0Q3JlYXRlT3JBdHRhY2gobW9kZSkuYnVpbGQoKTsKICAgICAg\nICBzdWJzY3JpYmUodG9waWMsIHN1YnNjcmliZXJJZCwgb3B0aW9ucywgZmFs\nc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN1YnNjcmliZShCeXRlU3Ry\naW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgU3Vic2NyaXB0\naW9uT3B0aW9ucyBvcHRpb25zKQogICAgICAgICAgICB0aHJvd3MgQ291bGRO\nb3RDb25uZWN0RXhjZXB0aW9uLCBDbGllbnRBbHJlYWR5U3Vic2NyaWJlZEV4\nY2VwdGlvbiwgU2VydmljZURvd25FeGNlcHRpb24sCiAgICAgICAgIEludmFs\naWRTdWJzY3JpYmVySWRFeGNlcHRpb24gewogICAgICAgIHN1YnNjcmliZSh0\nb3BpYywgc3Vic2NyaWJlcklkLCBvcHRpb25zLCBmYWxzZSk7CiAgICB9Cgog\nICAgcHJvdGVjdGVkIHZvaWQgc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMs\nIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBTdWJzY3JpcHRpb25PcHRpb25z\nIG9wdGlvbnMsIGJvb2xlYW4gaXNIdWIpCiAgICAgICAgICAgIHRocm93cyBD\nb3VsZE5vdENvbm5lY3RFeGNlcHRpb24sIENsaWVudEFscmVhZHlTdWJzY3Jp\nYmVkRXhjZXB0aW9uLCBTZXJ2aWNlRG93bkV4Y2VwdGlvbiwKICAgICAgICBJ\nbnZhbGlkU3Vic2NyaWJlcklkRXhjZXB0aW9uIHsKICAgICAgICAvLyBWYWxp\nZGF0ZSB0aGF0IHRoZSBmb3JtYXQgb2YgdGhlIHN1YnNjcmliZXJJZCBpcyB2\nYWxpZCBlaXRoZXIgYXMgYQogICAgICAgIC8vIGxvY2FsIG9yIGh1YiBzdWJz\nY3JpYmVyLgogICAgICAgIGlmICghaXNWYWxpZFN1YnNjcmliZXJJZChzdWJz\nY3JpYmVySWQsIGlzSHViKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSW52\nYWxpZFN1YnNjcmliZXJJZEV4Y2VwdGlvbigiU3Vic2NyaWJlcklkIHBhc3Nl\nZCBpcyBub3QgdmFsaWQ6ICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4\nKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiLCBpc0h1YjogIiArIGlzSHViKTsKICAgICAgICB9CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgc3ViVW5zdWIodG9waWMsIHN1YnNj\ncmliZXJJZCwgT3BlcmF0aW9uVHlwZS5TVUJTQ1JJQkUsIG9wdGlvbnMpOwog\nICAgICAgIH0gY2F0Y2ggKENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlVuZXhwZWN0ZWQgRXhj\nZXB0aW9uIHRocm93bjogIiwgZSk7CiAgICAgICAgICAgIC8vIFRoaXMgZXhj\nZXB0aW9uIHNob3VsZCBuZXZlciBiZSB0aHJvd24gaGVyZS4gQnV0IGp1c3Qg\naW4gY2FzZSwKICAgICAgICAgICAgLy8gdGhyb3cgYSBnZW5lcmljIFNlcnZp\nY2VEb3duRXhjZXB0aW9uIGJ1dCB3cmFwIHRoZSBvcmlnaW5hbAogICAgICAg\nICAgICAvLyBFeGNlcHRpb24gd2l0aGluIGl0LgogICAgICAgICAgICB0aHJv\ndyBuZXcgU2VydmljZURvd25FeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGFzeW5jU3Vic2NyaWJlKEJ5dGVTdHJpbmcg\ndG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBDcmVhdGVPckF0dGFj\naCBtb2RlLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAg\nU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zID0gU3Vic2NyaXB0aW9uT3B0\naW9ucy5uZXdCdWlsZGVyKCkuc2V0Q3JlYXRlT3JBdHRhY2gobW9kZSkuYnVp\nbGQoKTsKICAgICAgICBhc3luY1N1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJl\ncklkLCBvcHRpb25zLCBjYWxsYmFjaywgY29udGV4dCwgZmFsc2UpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGFzeW5jU3Vic2NyaWJlKEJ5dGVTdHJpbmcg\ndG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBTdWJzY3JpcHRpb25P\ncHRpb25zIG9wdGlvbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGNvbnRleHQpIHsK\nICAgICAgICBhc3luY1N1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklkLCBv\ncHRpb25zLCBjYWxsYmFjaywgY29udGV4dCwgZmFsc2UpOwogICAgfQoKICAg\nIHByb3RlY3RlZCB2b2lkIGFzeW5jU3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9w\naWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25z\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2s8\nVm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjb250ZXh0LCBib29sZWFuIGlzSHVi\nKSB7CiAgICAgICAgLy8gVmFsaWRhdGUgdGhhdCB0aGUgZm9ybWF0IG9mIHRo\nZSBzdWJzY3JpYmVySWQgaXMgdmFsaWQgZWl0aGVyIGFzIGEKICAgICAgICAv\nLyBsb2NhbCBvciBodWIgc3Vic2NyaWJlci4KICAgICAgICBpZiAoIWlzVmFs\naWRTdWJzY3JpYmVySWQoc3Vic2NyaWJlcklkLCBpc0h1YikpIHsKICAgICAg\nICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKGNvbnRleHQsIG5ldyBT\nZXJ2aWNlRG93bkV4Y2VwdGlvbihuZXcgSW52YWxpZFN1YnNjcmliZXJJZEV4\nY2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAiU3Vic2NyaWJlcklkIHBhc3NlZCBpcyBub3QgdmFsaWQ6ICIgKyBz\ndWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkgKyAiLCBpc0h1YjogIiArIGlz\nSHViKSkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAg\nIGFzeW5jU3ViVW5zdWIodG9waWMsIHN1YnNjcmliZXJJZCwKICAgICAgICAg\nICAgICAgICAgICAgIG5ldyBWb2lkQ2FsbGJhY2tBZGFwdGVyPFJlc3BvbnNl\nQm9keT4oY2FsbGJhY2spLCBjb250ZXh0LAogICAgICAgICAgICAgICAgICAg\nICAgT3BlcmF0aW9uVHlwZS5TVUJTQ1JJQkUsIG9wdGlvbnMpOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHVuc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMs\nIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3MgQ291bGROb3RDb25u\nZWN0RXhjZXB0aW9uLAogICAgICAgIENsaWVudE5vdFN1YnNjcmliZWRFeGNl\ncHRpb24sIFNlcnZpY2VEb3duRXhjZXB0aW9uLCBJbnZhbGlkU3Vic2NyaWJl\ncklkRXhjZXB0aW9uIHsKICAgICAgICB1bnN1YnNjcmliZSh0b3BpYywgc3Vi\nc2NyaWJlcklkLCBmYWxzZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQg\ndW5zdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQsIGJvb2xlYW4gaXNIdWIpCiAgICAgICAgICAgIHRocm93cyBD\nb3VsZE5vdENvbm5lY3RFeGNlcHRpb24sIENsaWVudE5vdFN1YnNjcmliZWRF\neGNlcHRpb24sIFNlcnZpY2VEb3duRXhjZXB0aW9uLAogICAgICAgIEludmFs\naWRTdWJzY3JpYmVySWRFeGNlcHRpb24gewogICAgICAgIC8vIFZhbGlkYXRl\nIHRoYXQgdGhlIGZvcm1hdCBvZiB0aGUgc3Vic2NyaWJlcklkIGlzIHZhbGlk\nIGVpdGhlciBhcyBhCiAgICAgICAgLy8gbG9jYWwgb3IgaHViIHN1YnNjcmli\nZXIuCiAgICAgICAgaWYgKCFpc1ZhbGlkU3Vic2NyaWJlcklkKHN1YnNjcmli\nZXJJZCwgaXNIdWIpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlk\nU3Vic2NyaWJlcklkRXhjZXB0aW9uKCJTdWJzY3JpYmVySWQgcGFzc2VkIGlz\nIG5vdCB2YWxpZDogIiArIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArICIsIGlzSHViOiAiICsgaXNIdWIpOwogICAgICAgIH0KICAgICAg\nICAvLyBTeW5jaHJvbm91c2x5IGNsb3NlIHRoZSBzdWJzY3JpcHRpb24gb24g\ndGhlIGNsaWVudCBzaWRlLiBFdmVuCiAgICAgICAgLy8gaWYgdGhlIHVuc3Vi\nc2NyaWJlIHJlcXVlc3QgdG8gdGhlIHNlcnZlciBlcnJvcnMgb3V0LCB3ZSB3\nb24ndCBiZQogICAgICAgIC8vIGRlbGl2ZXJpbmcgbWVzc2FnZXMgZm9yIHRo\naXMgc3Vic2NyaXB0aW9uIHRvIHRoZSBjbGllbnQuIFRoZSBjbGllbnQKICAg\nICAgICAvLyBjYW4gbGF0ZXIgcmV0cnkgdGhlIHVuc3Vic2NyaWJlIHJlcXVl\nc3QgdG8gdGhlIHNlcnZlciBzbyB0aGV5IGFyZQogICAgICAgIC8vICJmdWxs\neSIgdW5zdWJzY3JpYmVkIGZyb20gdGhlIGdpdmVuIHRvcGljLgogICAgICAg\nIGNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJzY3JpYmVySWQpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHN1YlVuc3ViKHRvcGljLCBzdWJzY3Jp\nYmVySWQsIE9wZXJhdGlvblR5cGUuVU5TVUJTQ1JJQkUsIG51bGwpOwogICAg\nICAgIH0gY2F0Y2ggKENsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJVbmV4cGVjdGVkIEV4\nY2VwdGlvbiB0aHJvd246ICIsIGUpOwogICAgICAgICAgICAvLyBUaGlzIGV4\nY2VwdGlvbiBzaG91bGQgbmV2ZXIgYmUgdGhyb3duIGhlcmUuIEJ1dCBqdXN0\nIGluIGNhc2UsCiAgICAgICAgICAgIC8vIHRocm93IGEgZ2VuZXJpYyBTZXJ2\naWNlRG93bkV4Y2VwdGlvbiBidXQgd3JhcCB0aGUgb3JpZ2luYWwKICAgICAg\nICAgICAgLy8gRXhjZXB0aW9uIHdpdGhpbiBpdC4KICAgICAgICAgICAgdGhy\nb3cgbmV3IFNlcnZpY2VEb3duRXhjZXB0aW9uKGUpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhc3luY1Vuc3Vic2NyaWJlKGZpbmFsIEJ5\ndGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklk\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBDYWxs\nYmFjazxWb2lkPiBjYWxsYmFjaywgZmluYWwgT2JqZWN0IGNvbnRleHQpIHsK\nICAgICAgICBkb0FzeW5jVW5zdWJzY3JpYmUodG9waWMsIHN1YnNjcmliZXJJ\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFZvaWRDYWxsYmFj\na0FkYXB0ZXI8UmVzcG9uc2VCb2R5PihjYWxsYmFjayksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRleHQsIGZhbHNlKTsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBhc3luY1Vuc3Vic2NyaWJlKGZpbmFsIEJ5dGVTdHJp\nbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBDYWxsYmFj\nazxWb2lkPiBjYWxsYmFjaywgZmluYWwgT2JqZWN0IGNvbnRleHQsIGJvb2xl\nYW4gaXNIdWIpIHsKICAgICAgICBkb0FzeW5jVW5zdWJzY3JpYmUodG9waWMs\nIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nIFZvaWRDYWxsYmFja0FkYXB0ZXI8UmVzcG9uc2VCb2R5PihjYWxsYmFjayks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQsIGlzSHViKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgZG9Bc3luY1Vuc3Vic2NyaWJlKGZp\nbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2Ny\naWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbCBDYWxsYmFjazxSZXNwb25zZUJvZHk+IGNhbGxiYWNrLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBPYmplY3QgY29u\ndGV4dCwgYm9vbGVhbiBpc0h1YikgewogICAgICAgIC8vIFZhbGlkYXRlIHRo\nYXQgdGhlIGZvcm1hdCBvZiB0aGUgc3Vic2NyaWJlcklkIGlzIHZhbGlkIGVp\ndGhlciBhcyBhCiAgICAgICAgLy8gbG9jYWwgb3IgaHViIHN1YnNjcmliZXIu\nCiAgICAgICAgaWYgKCFpc1ZhbGlkU3Vic2NyaWJlcklkKHN1YnNjcmliZXJJ\nZCwgaXNIdWIpKSB7CiAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZh\naWxlZChjb250ZXh0LCBuZXcgU2VydmljZURvd25FeGNlcHRpb24obmV3IElu\ndmFsaWRTdWJzY3JpYmVySWRFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIlN1YnNjcmliZXJJZCBwYXNzZWQg\naXMgbm90IHZhbGlkOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgp\nICsgIiwgaXNIdWI6ICIgKyBpc0h1YikpKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KICAgICAgICAvLyBBc3luY2hyb25vdXNseSBjbG9zZSB0\naGUgc3Vic2NyaXB0aW9uLiBPbiB0aGUgY2FsbGJhY2sgdG8gdGhhdAogICAg\nICAgIC8vIG9wZXJhdGlvbiBvbmNlIGl0IGNvbXBsZXRlcywgcG9zdCB0aGUg\nYXN5bmMgdW5zdWJzY3JpYmUgcmVxdWVzdC4KICAgICAgICBkb0FzeW5jQ2xv\nc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YnNjcmliZXJJZCwgbmV3IENhbGxi\nYWNrPFJlc3BvbnNlQm9keT4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmpl\nY3QgY3R4LCBSZXNwb25zZUJvZHkgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAg\nICAgICAgICAgICAgIGFzeW5jU3ViVW5zdWIodG9waWMsIHN1YnNjcmliZXJJ\nZCwgY2FsbGJhY2ssIGNvbnRleHQsIE9wZXJhdGlvblR5cGUuVU5TVUJTQ1JJ\nQkUsIG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9i\namVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAg\nICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjb250ZXh0LCBl\neGNlcHRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfSwgbnVsbCk7CiAg\nICB9CgogICAgLy8gVGhpcyBpcyBhIGhlbHBlciBtZXRob2QgdG8gZGV0ZXJt\naW5lIGlmIGEgc3Vic2NyaWJlcklkIGlzIHZhbGlkIGFzIGVpdGhlcgogICAg\nLy8gYSBodWIgb3IgbG9jYWwgc3Vic2NyaWJlcgogICAgcHJpdmF0ZSBib29s\nZWFuIGlzVmFsaWRTdWJzY3JpYmVySWQoQnl0ZVN0cmluZyBzdWJzY3JpYmVy\nSWQsIGJvb2xlYW4gaXNIdWIpIHsKICAgICAgICBpZiAoKGlzSHViICYmICFT\ndWJzY3JpcHRpb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJzY3Jp\nYmVySWQpKQogICAgICAgICAgICAgICAgfHwgKCFpc0h1YiAmJiBTdWJzY3Jp\ncHRpb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJzY3JpYmVySWQp\nKSkKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIGVsc2UKICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nY29uc3VtZShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmli\nZXJJZCwgTWVzc2FnZVNlcUlkIG1lc3NhZ2VTZXFJZCkKICAgICAgICAgICAg\ndGhyb3dzIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24gewogICAgICAg\nIFRvcGljU3Vic2NyaWJlciB0b3BpY1N1YnNjcmliZXIgPSBuZXcgVG9waWNT\ndWJzY3JpYmVyKHRvcGljLCBzdWJzY3JpYmVySWQpOwogICAgICAgIGxvZ2dl\nci5kZWJ1ZygiQ2FsbGluZyBjb25zdW1lIGZvciB7fSwgbWVzc2FnZVNlcUlk\nOiB7fS4iLAogICAgICAgICAgICAgICAgICAgICB0b3BpY1N1YnNjcmliZXIs\nIG1lc3NhZ2VTZXFJZCk7CgogICAgICAgIFN1YnNjcmliZVJlc3BvbnNlSGFu\nZGxlciBzdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIgPQogICAgICAgICAgICBj\naGFubmVsTWFuYWdlci5nZXRTdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIodG9w\naWNTdWJzY3JpYmVyKTsKICAgICAgICAvLyBDaGVjayB0aGF0IHRoaXMgdG9w\naWMgc3Vic2NyaXB0aW9uIG9uIHRoZSBjbGllbnQgc2lkZSBleGlzdHMuCiAg\nICAgICAgaWYgKG51bGwgPT0gc3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyIHx8\nCiAgICAgICAgICAgICFzdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIuaGFzU3Vi\nc2NyaXB0aW9uKHRvcGljU3Vic2NyaWJlcikpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAiQ2Fubm90IHNlbmQgY29uc3VtZSBtZXNzYWdlIHNpbmNlIGNs\naWVudCBpcyBub3Qgc3Vic2NyaWJlZCB0byB0b3BpYzogIgogICAgICAgICAg\nICAgICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIHN1YnNjcmliZXJJ\nZDogIiArIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAg\nfQogICAgICAgIC8vIFNlbmQgdGhlIGNvbnN1bWUgbWVzc2FnZSB0byB0aGUg\nc2VydmVyIHVzaW5nIHRoZSBzYW1lIHN1YnNjcmliZQogICAgICAgIC8vIGNo\nYW5uZWwgdGhhdCB0aGUgdG9waWMgc3Vic2NyaXB0aW9uIHVzZXMuCiAgICAg\nICAgc3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyLmNvbnN1bWUodG9waWNTdWJz\nY3JpYmVyLCBtZXNzYWdlU2VxSWQpOwogICAgfQoKICAgIHB1YmxpYyBib29s\nZWFuIGhhc1N1YnNjcmlwdGlvbihCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3Ry\naW5nIHN1YnNjcmliZXJJZCkgdGhyb3dzIENvdWxkTm90Q29ubmVjdEV4Y2Vw\ndGlvbiwKICAgICAgICBTZXJ2aWNlRG93bkV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gVGhlIHN1YnNjcmlwdGlvbiB0eXBlIG9mIGluZm8gc2hvdWxkIGJlIHN0\nb3JlZCBvbiB0aGUgc2VydmVyIGVuZCwgbm90CiAgICAgICAgLy8gdGhlIGNs\naWVudCBzaWRlLiBFdmVudHVhbGx5LCB0aGUgc2VydmVyIHdpbGwgaGF2ZSB0\naGUgU3Vic2NyaXB0aW9uCiAgICAgICAgLy8gTWFuYWdlciBwYXJ0IHRoYXQg\ndGllcyBpbnRvIFpvb2tlZXBlciB0byBtYW5hZ2UgdGhpcyBpbmZvLgogICAg\nICAgIC8vIENvbW1lbnRpbmcgb3V0IHRoZXNlIHR5cGUgb2YgQVBJJ3MgcmVs\nYXRlZCB0byB0aGF0IGhlcmUgZm9yIG5vdyB1bnRpbAogICAgICAgIC8vIHRo\naXMgZGF0YSBpcyBhdmFpbGFibGUgb24gdGhlIHNlcnZlci4gV2lsbCBmaWd1\ncmUgb3V0IHdoYXQgdGhlCiAgICAgICAgLy8gY29ycmVjdCB3YXkgdG8gY29u\ndGFjdCB0aGUgc2VydmVyIHRvIGdldCB0aGlzIGluZm8gaXMgdGhlbi4KICAg\nICAgICAvLyBUaGUgY2xpZW50IHNpZGUganVzdCBoYXMgc29mdCBtZW1vcnkg\nc3RhdGUgZm9yIGNsaWVudCBzdWJzY3JpcHRpb24KICAgICAgICAvLyBpbmZv\ncm1hdGlvbi4KICAgICAgICBUb3BpY1N1YnNjcmliZXIgdG9waWNTdWJzY3Jp\nYmVyID0gbmV3IFRvcGljU3Vic2NyaWJlcih0b3BpYywgc3Vic2NyaWJlcklk\nKTsKICAgICAgICBTdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIgc3Vic2NyaWJl\nUmVzcG9uc2VIYW5kbGVyID0KICAgICAgICAgICAgY2hhbm5lbE1hbmFnZXIu\nZ2V0U3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyKHRvcGljU3Vic2NyaWJlcik7\nCiAgICAgICAgcmV0dXJuICEobnVsbCA9PSBzdWJzY3JpYmVSZXNwb25zZUhh\nbmRsZXIgfHwKICAgICAgICAgICAgICAgICAhc3Vic2NyaWJlUmVzcG9uc2VI\nYW5kbGVyLmhhc1N1YnNjcmlwdGlvbih0b3BpY1N1YnNjcmliZXIpKTsKICAg\nIH0KCiAgICBwdWJsaWMgTGlzdDxCeXRlU3RyaW5nPiBnZXRTdWJzY3JpcHRp\nb25MaXN0KEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3MgQ291bGRO\nb3RDb25uZWN0RXhjZXB0aW9uLAogICAgICAgIFNlcnZpY2VEb3duRXhjZXB0\naW9uIHsKICAgICAgICAvLyBTYW1lIGFzIHRoZSBwcmV2aW91cyBoYXNTdWJz\nY3JpcHRpb24gbWV0aG9kLCB0aGlzIGRhdGEgc2hvdWxkIHJlc2lkZQogICAg\nICAgIC8vIG9uIHRoZSBzZXJ2ZXIgZW5kLCBub3QgdGhlIGNsaWVudCBzaWRl\nLgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHN0YXJ0RGVsaXZlcnkoZmluYWwgQnl0ZVN0cmluZyB0b3BpYywgZmluYWwg\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIE1lc3NhZ2VIYW5kbGVyIG1lc3NhZ2VIYW5kbGVyKQogICAg\nICAgICAgICB0aHJvd3MgQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbiwg\nQWxyZWFkeVN0YXJ0RGVsaXZlcnlFeGNlcHRpb24gewogICAgICAgIFRvcGlj\nU3Vic2NyaWJlciB0b3BpY1N1YnNjcmliZXIgPSBuZXcgVG9waWNTdWJzY3Jp\nYmVyKHRvcGljLCBzdWJzY3JpYmVySWQpOwogICAgICAgIGxvZ2dlci5kZWJ1\nZygiU3RhcnRpbmcgZGVsaXZlcnkgZm9yIHt9LiIsIHRvcGljU3Vic2NyaWJl\ncik7CiAgICAgICAgY2hhbm5lbE1hbmFnZXIuc3RhcnREZWxpdmVyeSh0b3Bp\nY1N1YnNjcmliZXIsIG1lc3NhZ2VIYW5kbGVyKTsgCiAgICB9CgogICAgcHVi\nbGljIHZvaWQgc3RhcnREZWxpdmVyeVdpdGhGaWx0ZXIoZmluYWwgQnl0ZVN0\ncmluZyB0b3BpYywgZmluYWwgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdl\nSGFuZGxlciBtZXNzYWdlSGFuZGxlciwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIENsaWVudE1lc3NhZ2VGaWx0ZXIgbWVzc2Fn\nZUZpbHRlcikKICAgICAgICAgICAgdGhyb3dzIENsaWVudE5vdFN1YnNjcmli\nZWRFeGNlcHRpb24sIEFscmVhZHlTdGFydERlbGl2ZXJ5RXhjZXB0aW9uIHsK\nICAgICAgICBpZiAobnVsbCA9PSBtZXNzYWdlSGFuZGxlciB8fCBudWxsID09\nIG1lc3NhZ2VGaWx0ZXIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQ\nb2ludGVyRXhjZXB0aW9uKCJOdWxsIG1lc3NhZ2UgaGFuZGxlciBvciBtZXNz\nYWdlIGZpbHRlciBpcyAgICAgICBwcm92aWRlZC4iKTsKICAgICAgICB9CiAg\nICAgICAgVG9waWNTdWJzY3JpYmVyIHRvcGljU3Vic2NyaWJlciA9IG5ldyBU\nb3BpY1N1YnNjcmliZXIodG9waWMsIHN1YnNjcmliZXJJZCk7CiAgICAgICAg\nbWVzc2FnZUhhbmRsZXIgPSBuZXcgRmlsdGVyYWJsZU1lc3NhZ2VIYW5kbGVy\nKG1lc3NhZ2VIYW5kbGVyLCBtZXNzYWdlRmlsdGVyKTsKICAgICAgICBsb2dn\nZXIuZGVidWcoIlN0YXJ0aW5nIGRlbGl2ZXJ5IHdpdGggZmlsdGVyIGZvciB7\nfS4iLCB0b3BpY1N1YnNjcmliZXIpOwogICAgICAgIGNoYW5uZWxNYW5hZ2Vy\nLnN0YXJ0RGVsaXZlcnkodG9waWNTdWJzY3JpYmVyLCBtZXNzYWdlSGFuZGxl\ncik7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3RvcERlbGl2ZXJ5KGZpbmFs\nIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkKQogICAgdGhyb3dzIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24g\newogICAgICAgIFRvcGljU3Vic2NyaWJlciB0b3BpY1N1YnNjcmliZXIgPSBu\nZXcgVG9waWNTdWJzY3JpYmVyKHRvcGljLCBzdWJzY3JpYmVySWQpOwogICAg\nICAgIGxvZ2dlci5kZWJ1ZygiU3RvcHBpbmcgZGVsaXZlcnkgZm9yIHt9LiIs\nIHRvcGljU3Vic2NyaWJlcik7CiAgICAgICAgY2hhbm5lbE1hbmFnZXIuc3Rv\ncERlbGl2ZXJ5KHRvcGljU3Vic2NyaWJlcik7IAogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlU3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcgdG9waWMsIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3MgU2VydmljZURvd25FeGNl\ncHRpb24gewogICAgICAgIFB1YlN1YkRhdGEgcHViU3ViRGF0YSA9IG5ldyBQ\ndWJTdWJEYXRhKHRvcGljLCBudWxsLCBzdWJzY3JpYmVySWQsIG51bGwsIG51\nbGwsIG51bGwsIG51bGwpOwogICAgICAgIHN5bmNocm9uaXplZCAocHViU3Vi\nRGF0YSkgewogICAgICAgICAgICBQdWJTdWJDYWxsYmFjayBwdWJTdWJDYWxs\nYmFjayA9IG5ldyBQdWJTdWJDYWxsYmFjayhwdWJTdWJEYXRhKTsKICAgICAg\nICAgICAgZG9Bc3luY0Nsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJzY3Jp\nYmVySWQsIHB1YlN1YkNhbGxiYWNrLCBudWxsKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIHdoaWxlICghcHViU3ViRGF0YS5pc0RvbmUp\nCiAgICAgICAgICAgICAgICAgICAgcHViU3ViRGF0YS53YWl0KCk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTZXJ2aWNlRG93bkV4Y2VwdGlvbigi\nSW50ZXJydXB0ZWQgRXhjZXB0aW9uIHdoaWxlIHdhaXRpbmcgZm9yIGFzeW5j\nQ2xvc2VTdWJzY3JpcHRpb24gY2FsbCIpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIC8vIENoZWNrIGZyb20gdGhlIFB1YlN1YkNhbGxiYWNrIGlmIGl0\nIHdhcyBzdWNjZXNzZnVsIG9yIG5vdC4KICAgICAgICAgICAgaWYgKCFwdWJT\ndWJDYWxsYmFjay5nZXRJc0NhbGxTdWNjZXNzZnVsKCkpIHsKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBTZXJ2aWNlRG93bkV4Y2VwdGlvbigiRXhjZXB0\naW9uIHdoaWxlIHRyeWluZyB0byBjbG9zZSB0aGUgc3Vic2NyaXB0aW9uIGZv\nciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiLCBzdWJz\nY3JpYmVySWQ6ICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGFzeW5jQ2xvc2VTdWJzY3JpcHRpb24oZmluYWwgQnl0ZVN0cmluZyB0b3Bp\nYywgZmluYWwgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPFZv\naWQ+IGNhbGxiYWNrLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAg\nIGRvQXN5bmNDbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3Vic2NyaWJlcklk\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVm9pZENh\nbGxiYWNrQWRhcHRlcjxSZXNwb25zZUJvZHk+KGNhbGxiYWNrKSwgY29udGV4\ndCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGRvQXN5bmNDbG9zZVN1YnNj\ncmlwdGlvbihmaW5hbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBCeXRlU3Ry\naW5nIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZmluYWwgQ2FsbGJhY2s8UmVzcG9uc2VCb2R5PiBj\nYWxsYmFjaywgZmluYWwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBUb3Bp\nY1N1YnNjcmliZXIgdG9waWNTdWJzY3JpYmVyID0gbmV3IFRvcGljU3Vic2Ny\naWJlcih0b3BpYywgc3Vic2NyaWJlcklkKTsKICAgICAgICBsb2dnZXIuZGVi\ndWcoIlN0b3BwaW5nIGRlbGl2ZXJ5IGZvciB7fSBiZWZvcmUgY2xvc2luZyBz\ndWJzY3JpcHRpb24uIiwgdG9waWNTdWJzY3JpYmVyKTsKICAgICAgICAvLyBX\nZSBvbmx5IHN0b3AgZGVsaXZlcnkgaGVyZSBub3QgaW4gY2hhbm5lbCBtYW5h\nZ2VyCiAgICAgICAgLy8gQmVjYXVzZSBjaGFubmVsTWFuYWdlciNhc3luY0Ns\nb3NlU3Vic2NyaXB0aW9uIHdpbGwgY2FsbGVkCiAgICAgICAgLy8gd2hlbiBz\ndWJzY3JpcHRpb24gY2hhbm5lbCBkaXNjb25uZWN0ZWQgdG8gY2xlYXIgbG9j\nYWwgc3Vic2NyaXB0aW9uCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY2hh\nbm5lbE1hbmFnZXIuc3RvcERlbGl2ZXJ5KHRvcGljU3Vic2NyaWJlcik7IAog\nICAgICAgIH0gY2F0Y2ggKENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24g\nY25zZSkgewogICAgICAgICAgICAvLyBpdCBpcyBPSyB0byBpZ25vcmUgdGhl\nIGV4Y2VwdGlvbiB3aGVuIGNsb3Npbmcgc3Vic2NyaXB0aW9uCiAgICAgICAg\nfQogICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2xvc2luZyBzdWJzY3JpcHRpb24g\nYXN5bmNocm9ub3VzbHkgZm9yIHt9LiIsIHRvcGljU3Vic2NyaWJlcik7CiAg\nICAgICAgY2hhbm5lbE1hbmFnZXIuYXN5bmNDbG9zZVN1YnNjcmlwdGlvbih0\nb3BpY1N1YnNjcmliZXIsIGNhbGxiYWNrLCBjb250ZXh0KTsKICAgIH0KfQo=\n","encoding":"base64"}

