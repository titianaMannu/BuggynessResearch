{"sha":"fedbbf255d6038e64e925b6eb49857dc74ada38c","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmVkYmJmMjU1ZDYwMzhlNjRlOTI1YjZlYjQ5ODU3ZGM3NGFkYTM4Yw==","size":13898,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/fedbbf255d6038e64e925b6eb49857dc74ada38c","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHkuaW1wbDsKCmlt\ncG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJy\nZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1\ncnJlbnRNYXA7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmpib3NzLm5ldHR5\nLmNoYW5uZWwuQ2hhbm5lbDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFu\nbmVsLkNoYW5uZWxIYW5kbGVyQ29udGV4dDsKaW1wb3J0IG9yZy5qYm9zcy5u\nZXR0eS5jaGFubmVsLkNoYW5uZWxQaXBlbGluZUNvdmVyYWdlOwppbXBvcnQg\nb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbFN0YXRlRXZlbnQ7Cmlt\ncG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5FeGNlcHRpb25FdmVudDsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLk1lc3NhZ2VFdmVudDsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLlNpbXBsZUNoYW5uZWxI\nYW5kbGVyOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmhhbmRsZXIuc3NsLlNz\nbEhhbmRsZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmNv\nbmYuQ2xpZW50Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLmNsaWVudC5kYXRhLlB1YlN1YkRhdGE7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5jbGllbnQuZXhjZXB0aW9ucy5Ob1Jlc3BvbnNlSGFuZGxlckV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5uZXR0\neS5OZXRVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5o\nYW5kbGVycy5BYnN0cmFjdFJlc3BvbnNlSGFuZGxlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLmNsaWVudC5oYW5kbGVycy5TdWJzY3JpYmVSZXNwb25z\nZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25z\nLlB1YlN1YkV4Y2VwdGlvbi5VbmNlcnRhaW5TdGF0ZUV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0\naW9uLlVuZXhwZWN0ZWRDb25kaXRpb25FeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5PcGVyYXRp\nb25UeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2U7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHk7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdGF0dXNDb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25z\nZTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLlZhckFy\nZ3MudmE7CgpAQ2hhbm5lbFBpcGVsaW5lQ292ZXJhZ2UoImFsbCIpCnB1Ymxp\nYyBjbGFzcyBIQ2hhbm5lbEhhbmRsZXIgZXh0ZW5kcyBTaW1wbGVDaGFubmVs\nSGFuZGxlciB7CgogICAgcHJpdmF0ZSBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9\nIExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEhDaGFubmVsSGFuZGxlci5jbGFz\ncyk7CgogICAgLy8gQ29uY3VycmVudCBNYXAgdG8gc3RvcmUgZm9yIGVhY2gg\nYXN5bmMgUHViU3ViIHJlcXVlc3QsIHRoZSB0eG4gSUQKICAgIC8vIGFuZCB0\naGUgY29ycmVzcG9uZGluZyBQdWJTdWIgY2FsbCdzIGRhdGEgd2hpY2ggc3Rv\ncmVzIHRoZSBWb2lkQ2FsbGJhY2sgdG8KICAgIC8vIGludm9rZSB3aGVuIHdl\nIHJlY2VpdmUgYSBQdWJTdWIgYWNrIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZl\nci4KICAgIC8vIFRoaXMgaXMgc3BlY2lmaWMgdG8gdGhpcyBpbnN0YW5jZSBv\nZiB0aGUgSENoYW5uZWxIYW5kbGVyIHdoaWNoIGlzCiAgICAvLyB0aWVkIHRv\nIGEgc3BlY2lmaWMgbmV0dHkgQ2hhbm5lbCBQaXBlbGluZS4KICAgIHByaXZh\ndGUgZmluYWwgQ29uY3VycmVudE1hcDxMb25nLCBQdWJTdWJEYXRhPiB0eG4y\nUHViU3ViRGF0YSA9CiAgICAgICAgbmV3IENvbmN1cnJlbnRIYXNoTWFwPExv\nbmcsIFB1YlN1YkRhdGE+KCk7CgogICAgLy8gQm9vbGVhbiBpbmRpY2F0aW5n\nIGlmIHdlIGNsb3NlZCB0aGUgY2hhbm5lbCB0aGlzIEhDaGFubmVsSGFuZGxl\nciBpcwogICAgLy8gYXR0YWNoZWQgdG8gZXhwbGljaXRseSBvciBub3QuIElm\nIHNvLCB3ZSBkbyBub3QgbmVlZCB0byBkbyB0aGUKICAgIC8vIGNoYW5uZWwg\nZGlzY29ubmVjdGVkIGxvZ2ljIGhlcmUuCiAgICBwcml2YXRlIHZvbGF0aWxl\nIGJvb2xlYW4gY2hhbm5lbENsb3NlZEV4cGxpY2l0bHkgPSBmYWxzZTsKCiAg\nICBwcml2YXRlIGZpbmFsIEFic3RyYWN0SENoYW5uZWxNYW5hZ2VyIGNoYW5u\nZWxNYW5hZ2VyOwogICAgcHJpdmF0ZSBmaW5hbCBDbGllbnRDb25maWd1cmF0\naW9uIGNmZzsKCiAgICBwcml2YXRlIGZpbmFsIE1hcDxPcGVyYXRpb25UeXBl\nLCBBYnN0cmFjdFJlc3BvbnNlSGFuZGxlcj4gaGFuZGxlcnM7CiAgICBwcml2\nYXRlIGZpbmFsIFN1YnNjcmliZVJlc3BvbnNlSGFuZGxlciBzdWJIYW5kbGVy\nOwoKICAgIHB1YmxpYyBIQ2hhbm5lbEhhbmRsZXIoQ2xpZW50Q29uZmlndXJh\ndGlvbiBjZmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIEFic3RyYWN0\nSENoYW5uZWxNYW5hZ2VyIGNoYW5uZWxNYW5hZ2VyLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICBNYXA8T3BlcmF0aW9uVHlwZSwgQWJzdHJhY3RSZXNw\nb25zZUhhbmRsZXI+IGhhbmRsZXJzKSB7CiAgICAgICAgdGhpcy5jZmcgPSBj\nZmc7CiAgICAgICAgdGhpcy5jaGFubmVsTWFuYWdlciA9IGNoYW5uZWxNYW5h\nZ2VyOwogICAgICAgIHRoaXMuaGFuZGxlcnMgPSBoYW5kbGVyczsKICAgICAg\nICBzdWJIYW5kbGVyID0gKFN1YnNjcmliZVJlc3BvbnNlSGFuZGxlcikgaGFu\nZGxlcnMuZ2V0KE9wZXJhdGlvblR5cGUuU1VCU0NSSUJFKTsKICAgIH0KCiAg\nICBwdWJsaWMgU3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyIGdldFN1YnNjcmli\nZVJlc3BvbnNlSGFuZGxlcigpIHsKICAgICAgICByZXR1cm4gc3ViSGFuZGxl\ncjsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZW1vdmVUeG4obG9uZyB0eG5J\nZCkgewogICAgICAgIHR4bjJQdWJTdWJEYXRhLnJlbW92ZSh0eG5JZCk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgYWRkVHhuKGxvbmcgdHhuSWQsIFB1YlN1\nYkRhdGEgcHViU3ViRGF0YSkgewogICAgICAgIHR4bjJQdWJTdWJEYXRhLnB1\ndCh0eG5JZCwgcHViU3ViRGF0YSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgdm9pZCBtZXNzYWdlUmVjZWl2ZWQoQ2hhbm5lbEhhbmRsZXJD\nb250ZXh0IGN0eCwgTWVzc2FnZUV2ZW50IGUpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIC8vIElmIHRoZSBNZXNzYWdlIGlzIG5vdCBhIFB1YlN1YlJl\nc3BvbnNlLCBqdXN0IHNlbmQgaXQgdXBzdHJlYW0gYW5kIGxldAogICAgICAg\nIC8vIHNvbWV0aGluZyBlbHNlIGhhbmRsZSBpdC4KICAgICAgICBpZiAoIShl\nLmdldE1lc3NhZ2UoKSBpbnN0YW5jZW9mIFB1YlN1YlJlc3BvbnNlKSkgewog\nICAgICAgICAgICBjdHguc2VuZFVwc3RyZWFtKGUpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIFJldHJpZXZlIHRoZSBQdWJT\ndWJSZXNwb25zZSBmcm9tIHRoZSBNZXNzYWdlIHRoYXQgd2FzIHNlbnQgYnkg\ndGhlCiAgICAgICAgLy8gc2VydmVyLgogICAgICAgIFB1YlN1YlJlc3BvbnNl\nIHJlc3BvbnNlID0gKFB1YlN1YlJlc3BvbnNlKSBlLmdldE1lc3NhZ2UoKTsK\nICAgICAgICBsb2dnZXIuZGVidWcoIlJlc3BvbnNlIHJlY2VpdmVkIGZyb20g\naG9zdDoge30sIHJlc3BvbnNlOiB7fS4iLAogICAgICAgICAgICAgICAgICAg\nICB2YShOZXRVdGlscy5nZXRIb3N0RnJvbUNoYW5uZWwoY3R4LmdldENoYW5u\nZWwoKSksIHJlc3BvbnNlKSk7CgogICAgICAgIC8vIERldGVybWluZSBpZiB0\naGlzIFB1YlN1YlJlc3BvbnNlIGlzIGFuIGFjayByZXNwb25zZSBmb3IgYSBQ\ndWJTdWIKICAgICAgICAvLyBSZXF1ZXN0IG9yIGlmIGl0IGlzIGEgbWVzc2Fn\nZSBiZWluZyBwdXNoZWQgdG8gdGhlIGNsaWVudCBzdWJzY3JpYmVyLgogICAg\nICAgIGlmIChyZXNwb25zZS5oYXNNZXNzYWdlKCkpIHsKICAgICAgICAgICAg\nLy8gU3Vic2NyaWJlZCBtZXNzYWdlcyBiZWluZyBwdXNoZWQgdG8gdGhlIGNs\naWVudCBzbyBoYW5kbGUvY29uc3VtZQogICAgICAgICAgICAvLyBpdCBhbmQg\ncmV0dXJuLgogICAgICAgICAgICBpZiAobnVsbCA9PSBzdWJIYW5kbGVyKSB7\nCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlJlY2VpdmVkIG1lc3Nh\nZ2UgZnJvbSBhIG5vbi1zdWJzY3JpcHRpb24gY2hhbm5lbCA6IHt9IiwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSk7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzdWJIYW5kbGVyLmhhbmRs\nZVN1YnNjcmliZU1lc3NhZ2UocmVzcG9uc2UpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIC8vIFByb2Nl\nc3MgU3Vic2NyaXB0aW9uIEV2ZW50cwogICAgICAgIGlmIChyZXNwb25zZS5o\nYXNSZXNwb25zZUJvZHkoKSkgewogICAgICAgICAgICBSZXNwb25zZUJvZHkg\ncmVzcCA9IHJlc3BvbnNlLmdldFJlc3BvbnNlQm9keSgpOwogICAgICAgICAg\nICAvLyBBIHNwZWNpYWwgc3Vic2NyaXB0aW9uIGV2ZW50IGluZGljYXRlcyB0\naGUgc3RhdGUgb2YgYSBzdWJzY3JpYmVyCiAgICAgICAgICAgIGlmIChyZXNw\nLmhhc1N1YnNjcmlwdGlvbkV2ZW50KCkpIHsKICAgICAgICAgICAgICAgIGlm\nIChudWxsID09IHN1YkhhbmRsZXIpIHsKICAgICAgICAgICAgICAgICAgICBs\nb2dnZXIuZXJyb3IoIlJlY2VpdmVkIHN1YnNjcmlwdGlvbiBldmVudCBmcm9t\nIGEgbm9uLXN1YnNjcmlwdGlvbiBjaGFubmVsIDoge30iLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSk7IAogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRp\nb25FdmVudFJlc3BvbnNlIGV2ZW50UmVzcCA9IHJlc3AuZ2V0U3Vic2NyaXB0\naW9uRXZlbnQoKTsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWco\nIlJlY2VpdmVkIHN1YnNjcmlwdGlvbiBldmVudCB7fSBmb3IgKHRvcGljOnt9\nLCBzdWJzY3JpYmVyOnt9KS4iLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB2YShldmVudFJlc3AuZ2V0RXZlbnQoKSwgcmVzcG9uc2UuZ2V0\nVG9waWMoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmVzcG9uc2UuZ2V0U3Vic2NyaWJlcklkKCkpKTsKICAgICAgICAgICAgICAg\nICAgICBzdWJIYW5kbGVyLmhhbmRsZVN1YnNjcmlwdGlvbkV2ZW50KHJlc3Bv\nbnNlLmdldFRvcGljKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZS5nZXRTdWJzY3Jp\nYmVySWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGV2ZW50UmVzcC5nZXRFdmVudCgpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVzcG9uc2UgaXMgYW4g\nYWNrIHRvIGEgcHJpb3IgUHViU3ViUmVxdWVzdCBzbyBmaXJzdCByZXRyaWV2\nZSB0aGUKICAgICAgICAvLyBQdWJTdWIgZGF0YSBmb3IgdGhpcyB0eG4uCiAg\nICAgICAgUHViU3ViRGF0YSBwdWJTdWJEYXRhID0gdHhuMlB1YlN1YkRhdGEu\ncmVtb3ZlKHJlc3BvbnNlLmdldFR4bklkKCkpOwoKICAgICAgICAvLyBWYWxp\nZGF0ZSB0aGF0IHRoZSBQdWJTdWIgZGF0YSBmb3IgdGhpcyB0eG4gaXMgc3Rv\ncmVkLiBJZiBub3QsIGp1c3QKICAgICAgICAvLyBsb2cgYW4gZXJyb3IgbWVz\nc2FnZSBhbmQgcmV0dXJuIHNpbmNlIHdlIGRvbid0IGtub3cgaG93IHRvIGhh\nbmRsZQogICAgICAgIC8vIHRoaXMuCiAgICAgICAgaWYgKHB1YlN1YkRhdGEg\nPT0gbnVsbCkgewogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlB1YlN1YiBE\nYXRhIHdhcyBub3QgZm91bmQgZm9yIFB1YlN1YlJlc3BvbnNlOiB7fSIsIHJl\nc3BvbnNlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gU3RvcmUgdGhlIHRvcGljMkhvc3QgbWFwcGluZyBpZiB0aGlzIHdh\nc24ndCBhIHNlcnZlciByZWRpcmVjdC4gV2UnbGwKICAgICAgICAvLyBhc3N1\nbWUgdGhhdCBpZiB0aGUgc2VydmVyIHdhcyBhYmxlIHRvIGhhdmUgYW4gb3Bl\nbiBDaGFubmVsIGNvbm5lY3Rpb24KICAgICAgICAvLyB0byB0aGUgY2xpZW50\nLCBhbmQgcmVzcG9uZGVkIHdpdGggYW4gYWNrIG1lc3NhZ2Ugb3RoZXIgdGhh\nbiB0aGUKICAgICAgICAvLyBOT1RfUkVTUE9OU0lCTEVfRk9SX1RPUElDIG9u\nZSwgaXQgaXMgdGhlIGNvcnJlY3QgdG9waWMgbWFzdGVyLgogICAgICAgIGlm\nICghcmVzcG9uc2UuZ2V0U3RhdHVzQ29kZSgpLmVxdWFscyhTdGF0dXNDb2Rl\nLk5PVF9SRVNQT05TSUJMRV9GT1JfVE9QSUMpKSB7CiAgICAgICAgICAgIC8v\nIFJldHJpZXZlIHRoZSBzZXJ2ZXIgaG9zdCB0aGF0IHdlJ3ZlIGNvbm5lY3Rl\nZCB0byBhbmQgc3RvcmUgdGhlCiAgICAgICAgICAgIC8vIG1hcHBpbmcgZnJv\nbSB0aGUgdG9waWMgdG8gdGhpcyBob3N0LiBGb3IgYWxsIG90aGVyIG5vbi1y\nZWRpcmVjdGVkCiAgICAgICAgICAgIC8vIHNlcnZlciBzdGF0dXNlcywgd2Ug\nY29uc2lkZXIgdGhhdCBhcyBhIHN1Y2Nlc3NmdWwgY29ubmVjdGlvbiB0byB0\naGUKICAgICAgICAgICAgLy8gY29ycmVjdCB0b3BpYyBtYXN0ZXIuCiAgICAg\nICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGhvc3QgPSBOZXRVdGlscy5nZXRI\nb3N0RnJvbUNoYW5uZWwoY3R4LmdldENoYW5uZWwoKSk7CiAgICAgICAgICAg\nIGNoYW5uZWxNYW5hZ2VyLnN0b3JlVG9waWMySG9zdE1hcHBpbmcocHViU3Vi\nRGF0YS50b3BpYywgaG9zdCk7CiAgICAgICAgfQoKICAgICAgICAvLyBEZXBl\nbmRpbmcgb24gdGhlIG9wZXJhdGlvbiB0eXBlLCBjYWxsIHRoZSBhcHByb3By\naWF0ZSBoYW5kbGVyLgogICAgICAgIGxvZ2dlci5kZWJ1ZygiSGFuZGxpbmcg\nYSB7fSByZXNwb25zZToge30sIHB1YlN1YkRhdGE6IHt9LCBob3N0OiB7fS4i\nLAogICAgICAgICAgICAgICAgICAgICB2YShwdWJTdWJEYXRhLm9wZXJhdGlv\nblR5cGUsIHJlc3BvbnNlLCBwdWJTdWJEYXRhLCBjdHguZ2V0Q2hhbm5lbCgp\nKSk7CiAgICAgICAgQWJzdHJhY3RSZXNwb25zZUhhbmRsZXIgcmVzcEhhbmRs\nZXIgPSBoYW5kbGVycy5nZXQocHViU3ViRGF0YS5vcGVyYXRpb25UeXBlKTsK\nICAgICAgICBpZiAobnVsbCA9PSByZXNwSGFuZGxlcikgewogICAgICAgICAg\nICAvLyBUaGUgYWJvdmUgYXJlIHRoZSBvbmx5IGV4cGVjdGVkIFB1YlN1YlJl\nc3BvbnNlIG1lc3NhZ2VzIHJlY2VpdmVkCiAgICAgICAgICAgIC8vIGZyb20g\ndGhlIHNlcnZlciBmb3IgdGhlIHZhcmlvdXMgY2xpZW50IHNpZGUgcmVxdWVz\ndHMgbWFkZS4KICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJSZXNwb25zZSBy\nZWNlaXZlZCBmcm9tIHNlcnZlciBpcyBmb3IgYW4gdW5oYW5kbGVkIG9wZXJh\ndGlvbiB7fSwgdHhuSWQ6IHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICB2YShwdWJTdWJEYXRhLm9wZXJhdGlvblR5cGUsIHJlc3BvbnNlLmdldFR4\nbklkKCkpKTsKICAgICAgICAgICAgcHViU3ViRGF0YS5nZXRDYWxsYmFjaygp\nLm9wZXJhdGlvbkZhaWxlZChwdWJTdWJEYXRhLmNvbnRleHQsCiAgICAgICAg\nICAgICAgICBuZXcgVW5leHBlY3RlZENvbmRpdGlvbkV4Y2VwdGlvbigiQ2Fu\nJ3QgZmluZCByZXNwb25zZSBoYW5kbGVyIGZvciBvcGVyYXRpb24gIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyBwdWJTdWJEYXRhLm9wZXJhdGlvblR5cGUpKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KICAgICAgICByZXNwSGFuZGxlci5oYW5kbGVSZXNw\nb25zZShyZXNwb25zZSwgcHViU3ViRGF0YSwgY3R4LmdldENoYW5uZWwoKSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY2hlY2tUaW1lb3V0UmVxdWVzdHMo\nKSB7CiAgICAgICAgbG9uZyBjdXJUaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1l\nTWlsbGlzKCk7CiAgICAgICAgbG9uZyB0aW1lb3V0SW50ZXJ2YWwgPSBjZmcu\nZ2V0U2VydmVyQWNrUmVzcG9uc2VUaW1lb3V0KCk7CiAgICAgICAgZm9yIChQ\ndWJTdWJEYXRhIHB1YlN1YkRhdGEgOiB0eG4yUHViU3ViRGF0YS52YWx1ZXMo\nKSkgewogICAgICAgICAgICBjaGVja1RpbWVvdXRSZXF1ZXN0KHB1YlN1YkRh\ndGEsIGN1clRpbWUsIHRpbWVvdXRJbnRlcnZhbCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBjaGVja1RpbWVvdXRSZXF1ZXN0KFB1YlN1\nYkRhdGEgcHViU3ViRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGxvbmcgY3VyVGltZSwgbG9uZyB0aW1lb3V0SW50ZXJ2YWwp\nIHsKICAgICAgICBpZiAoY3VyVGltZSA+IHB1YlN1YkRhdGEucmVxdWVzdFdy\naXRlVGltZSArIHRpbWVvdXRJbnRlcnZhbCkgewogICAgICAgICAgICAvLyBD\ndXJyZW50IFB1YlN1YlJlcXVlc3QgaGFzIHRpbWVkIG91dCBzbyByZW1vdmUg\naXQgZnJvbSB0aGUKICAgICAgICAgICAgLy8gUmVzcG9uc2VIYW5kbGVyJ3Mg\nbWFwIGFuZCBpbnZva2UgdGhlIFZvaWRDYWxsYmFjaydzCiAgICAgICAgICAg\nIC8vIG9wZXJhdGlvbkZhaWxlZCBtZXRob2QuCiAgICAgICAgICAgIGxvZ2dl\nci5lcnJvcigiQ3VycmVudCBQdWJTdWJSZXF1ZXN0IGhhcyB0aW1lZCBvdXQg\nZm9yIHB1YlN1YkRhdGE6ICIgKyBwdWJTdWJEYXRhKTsKICAgICAgICAgICAg\ndHhuMlB1YlN1YkRhdGEucmVtb3ZlKHB1YlN1YkRhdGEudHhuSWQpOwogICAg\nICAgICAgICBwdWJTdWJEYXRhLmdldENhbGxiYWNrKCkub3BlcmF0aW9uRmFp\nbGVkKHB1YlN1YkRhdGEuY29udGV4dCwKICAgICAgICAgICAgICAgIG5ldyBV\nbmNlcnRhaW5TdGF0ZUV4Y2VwdGlvbigiU2VydmVyIGFjayByZXNwb25zZSBu\nZXZlciByZWNlaXZlZCBzbyBQdWJTdWJSZXF1ZXN0IGhhcyB0aW1lZCBvdXQh\nIikpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBMb2dpYyB0byBkZWFsIHdp\ndGggd2hhdCBoYXBwZW5zIHdoZW4gYSBDaGFubmVsIHRvIGEgc2VydmVyIGhv\nc3QgaXMKICAgIC8vIGRpc2Nvbm5lY3RlZC4KICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgY2hhbm5lbERpc2Nvbm5lY3RlZChDaGFubmVsSGFuZGxl\nckNvbnRleHQgY3R4LCBDaGFubmVsU3RhdGVFdmVudCBlKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBJZiB0aGlzIGNoYW5uZWwgd2FzIGNsb3Nl\nZCBleHBsaWNpdGx5IGJ5IHRoZSBjbGllbnQgY29kZSwKICAgICAgICAvLyB3\nZSBkbyBub3QgbmVlZCB0byBkbyBhbnkgb2YgdGhpcyBsb2dpYy4gVGhpcyBj\nb3VsZCBoYXBwZW4KICAgICAgICAvLyBmb3IgcmVkdW5kYW50IFB1Ymxpc2gg\nY2hhbm5lbHMgY3JlYXRlZCBvciByZWRpcmVjdGVkIHN1YnNjcmliZQogICAg\nICAgIC8vIGNoYW5uZWxzIHRoYXQgYXJlIG5vdCB1c2VkIGFueW1vcmUgb3Ig\nd2hlbiB3ZSBzaHV0ZG93biB0aGUKICAgICAgICAvLyBjbGllbnQgYW5kIG1h\nbnVhbGx5IGNsb3NlIGFsbCBvZiB0aGUgb3BlbiBjaGFubmVscy4KICAgICAg\nICAvLyBBbHNvIGRvbid0IGRvIGFueSBvZiB0aGUgZGlzY29ubmVjdCBsb2dp\nYyBpZiB0aGUgY2xpZW50IGhhcyBzdG9wcGVkLgogICAgICAgIGlmIChjaGFu\nbmVsQ2xvc2VkRXhwbGljaXRseSB8fCBjaGFubmVsTWFuYWdlci5pc0Nsb3Nl\nZCgpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIC8vIE1ha2Ugc3VyZSB0aGUgaG9zdCByZXRyaWV2ZWQgaXMgbm90IG51bGwg\nYXMgdGhlcmUgY291bGQgYmUgc29tZSB3ZWlyZAogICAgICAgIC8vIGNoYW5u\nZWwgZGlzY29ubmVjdCBldmVudHMgaGFwcGVuaW5nIGR1cmluZyBhIGNsaWVu\ndCBzaHV0ZG93bi4KICAgICAgICAvLyBJZiBpdCBpcywganVzdCByZXR1cm4g\nYXMgdGhlcmUgc2hvdWxkbid0IGJlIGFueXRoaW5nIHdlIG5lZWQgdG8gZG8u\nCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgaG9zdCA9IE5ldFV0aWxzLmdl\ndEhvc3RGcm9tQ2hhbm5lbChjdHguZ2V0Q2hhbm5lbCgpKTsKICAgICAgICBp\nZiAoaG9zdCA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIGxvZ2dlci5pbmZvKCJDaGFubmVsIHt9IHdhcyBkaXNj\nb25uZWN0ZWQgdG8gaG9zdCB7fS4iLAogICAgICAgICAgICAgICAgICAgIHZh\nKGN0eC5nZXRDaGFubmVsKCksIGhvc3QpKTsKCiAgICAgICAgLy8gSWYgdGhp\ncyBDaGFubmVsIHdhcyB1c2VkIGZvciBQdWJsaXNoIGFuZCBVbnN1YnNjcmli\nZSBmbG93cywganVzdAogICAgICAgIC8vIHJlbW92ZSBpdCBmcm9tIHRoZSBI\nZXdkaWdQdWJsaXNoZXIncyBob3N0MkNoYW5uZWwgbWFwLiBXZSB3aWxsCiAg\nICAgICAgLy8gcmUtZXN0YWJsaXNoIGEgQ2hhbm5lbCBjb25uZWN0aW9uIHRv\nIHRoYXQgc2VydmVyIHdoZW4gdGhlIG5leHQKICAgICAgICAvLyBwdWJsaXNo\nL3Vuc3Vic2NyaWJlIHJlcXVlc3QgdG8gYSB0b3BpYyB0aGF0IHRoZSBzZXJ2\nZXIgb3ducyBvY2N1cnMuCgogICAgICAgIC8vIE5vdyBkZXRlcm1pbmUgd2hh\ndCB0eXBlIG9mIG9wZXJhdGlvbiB0aGlzIGNoYW5uZWwgd2FzIHVzZWQgZm9y\nLgogICAgICAgIGlmIChudWxsID09IHN1YkhhbmRsZXIpIHsKICAgICAgICAg\nICAgY2hhbm5lbE1hbmFnZXIub25Ob25TdWJzY3JpcHRpb25DaGFubmVsRGlz\nY29ubmVjdGVkKGhvc3QsIGN0eC5nZXRDaGFubmVsKCkpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIGNoYW5uZWxNYW5hZ2VyLm9uU3Vic2NyaXB0\naW9uQ2hhbm5lbERpc2Nvbm5lY3RlZChob3N0LCBjdHguZ2V0Q2hhbm5lbCgp\nKTsKICAgICAgICB9CgogICAgICAgIC8vIEZpbmFsbHksIGFsbCBvZiB0aGUg\nUHViU3ViUmVxdWVzdHMgdGhhdCBhcmUgc3RpbGwgd2FpdGluZyBmb3IgYW4g\nYWNrCiAgICAgICAgLy8gcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyIG5lZWQg\ndG8gYmUgcmVtb3ZlZCBhbmQgdGltZWQgb3V0LiBJbnZva2UgdGhlCiAgICAg\nICAgLy8gb3BlcmF0aW9uRmFpbGVkIGNhbGxiYWNrcyBvbiBhbGwgb2YgdGhl\nbS4gVXNlIHRoZQogICAgICAgIC8vIFVuY2VydGFpblN0YXRlRXhjZXB0aW9u\nIHNpbmNlIHRoZSBzZXJ2ZXIgZGlkIHJlY2VpdmUgdGhlIHJlcXVlc3QgYnV0\nCiAgICAgICAgLy8gd2UncmUgbm90IHN1cmUgb2YgdGhlIHN0YXRlIG9mIHRo\nZSByZXF1ZXN0IHNpbmNlIHRoZSBhY2sgcmVzcG9uc2Ugd2FzCiAgICAgICAg\nLy8gbmV2ZXIgcmVjZWl2ZWQuCiAgICAgICAgZm9yIChQdWJTdWJEYXRhIHB1\nYlN1YkRhdGEgOiB0eG4yUHViU3ViRGF0YS52YWx1ZXMoKSkgewogICAgICAg\nICAgICBsb2dnZXIuZGVidWcoIkNoYW5uZWwgZGlzY29ubmVjdGVkIHNvIGlu\ndm9raW5nIHRoZSBvcGVyYXRpb25GYWlsZWQgY2FsbGJhY2sgZm9yIHB1YlN1\nYkRhdGE6IHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgIHB1YlN1YkRh\ndGEpOwogICAgICAgICAgICBwdWJTdWJEYXRhLmdldENhbGxiYWNrKCkub3Bl\ncmF0aW9uRmFpbGVkKHB1YlN1YkRhdGEuY29udGV4dCwgbmV3IFVuY2VydGFp\nblN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICJTZXJ2ZXIgYWNrIHJlc3BvbnNl\nIG5ldmVyIHJlY2VpdmVkIGJlZm9yZSBzZXJ2ZXIgY29ubmVjdGlvbiBkaXNj\nb25uZWN0ZWQhIikpOwogICAgICAgIH0KICAgICAgICB0eG4yUHViU3ViRGF0\nYS5jbGVhcigpOwogICAgfQoKICAgIC8vIExvZ2ljIHRvIGRlYWwgd2l0aCB3\naGF0IGhhcHBlbnMgd2hlbiBhIENoYW5uZWwgdG8gYSBzZXJ2ZXIgaG9zdCBp\ncwogICAgLy8gY29ubmVjdGVkLiBUaGlzIGlzIG5lZWRlZCBpZiB0aGUgY2xp\nZW50IGlzIHVzaW5nIGFuIFNTTCBwb3J0IHRvCiAgICAvLyBjb21tdW5pY2F0\nZSB3aXRoIHRoZSBzZXJ2ZXIuIElmIHNvLCB3ZSBuZWVkIHRvIGRvIHRoZSBT\nU0wgaGFuZHNoYWtlIGhlcmUKICAgIC8vIHdoZW4gdGhlIGNoYW5uZWwgaXMg\nZmlyc3QgY29ubmVjdGVkLgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCBjaGFubmVsQ29ubmVjdGVkKENoYW5uZWxIYW5kbGVyQ29udGV4dCBjdHgs\nIENoYW5uZWxTdGF0ZUV2ZW50IGUpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIC8vIE5vIG5lZWQgdG8gaW5pdGlhdGUgdGhlIFNTTCBoYW5kc2hha2Ug\naWYgd2UgYXJlIGNsb3NpbmcgdGhpcyBjaGFubmVsCiAgICAgICAgLy8gZXhw\nbGljaXRseSBvciB0aGUgY2xpZW50IGhhcyBiZWVuIHN0b3BwZWQuCiAgICAg\nICAgaWYgKGNmZy5pc1NTTEVuYWJsZWQoKSAmJiAhY2hhbm5lbENsb3NlZEV4\ncGxpY2l0bHkgJiYgIWNoYW5uZWxNYW5hZ2VyLmlzQ2xvc2VkKCkpIHsKICAg\nICAgICAgICAgbG9nZ2VyLmRlYnVnKCJJbml0aWF0aW5nIHRoZSBTU0wgaGFu\nZHNoYWtlIik7CiAgICAgICAgICAgIGN0eC5nZXRQaXBlbGluZSgpLmdldChT\nc2xIYW5kbGVyLmNsYXNzKS5oYW5kc2hha2UoZS5nZXRDaGFubmVsKCkpOwog\nICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lk\nIGV4Y2VwdGlvbkNhdWdodChDaGFubmVsSGFuZGxlckNvbnRleHQgY3R4LCBF\neGNlcHRpb25FdmVudCBlKSB7CiAgICAgICAgbG9nZ2VyLmVycm9yKCJFeGNl\ncHRpb24gY2F1Z2h0IG9uIGNsaWVudCBjaGFubmVsIiwgZS5nZXRDYXVzZSgp\nKTsKICAgICAgICBlLmdldENoYW5uZWwoKS5jbG9zZSgpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIGNsb3NlRXhwbGljaXRseSgpIHsKICAgICAgICAvLyBU\nT0RPOiBCT09LS0VFUEVSLTM1MCA6IEhhbmRsZSBjb25zdW1lIGJ1ZmZlcmlu\nZywgZXRjIGhlcmUgLSBpbiBhIGRpZmZlcmVudCBwYXRjaAogICAgICAgIGNo\nYW5uZWxDbG9zZWRFeHBsaWNpdGx5ID0gdHJ1ZTsKICAgIH0KfQo=\n","encoding":"base64"}

