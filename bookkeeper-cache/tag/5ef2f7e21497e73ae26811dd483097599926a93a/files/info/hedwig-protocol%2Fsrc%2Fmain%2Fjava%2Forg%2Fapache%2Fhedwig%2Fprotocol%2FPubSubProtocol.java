{"sha":"4bba8cc849c1e10354c7e022f94b23e6a2e88d4f","node_id":"MDQ6QmxvYjE1NzU5NTY6NGJiYThjYzg0OWMxZTEwMzU0YzdlMDIyZjk0YjIzZTZhMmU4OGQ0Zg==","size":669257,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4bba8cc849c1e10354c7e022f94b23e6a2e88d4f","content":"Ly8gR2VuZXJhdGVkIGJ5IHRoZSBwcm90b2NvbCBidWZmZXIgY29tcGlsZXIu\nICBETyBOT1QgRURJVCEKLy8gc291cmNlOiBzcmMvbWFpbi9wcm90b2J1Zi9Q\ndWJTdWJQcm90b2NvbC5wcm90bwoKcGFja2FnZSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbDsKCnB1YmxpYyBmaW5hbCBjbGFzcyBQdWJTdWJQcm90b2Nv\nbCB7CiAgcHJpdmF0ZSBQdWJTdWJQcm90b2NvbCgpIHt9CiAgcHVibGljIHN0\nYXRpYyB2b2lkIHJlZ2lzdGVyQWxsRXh0ZW5zaW9ucygKICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeSByZWdpc3RyeSkgewog\nIH0KICBwdWJsaWMgZW51bSBQcm90b2NvbFZlcnNpb24KICAgICAgaW1wbGVt\nZW50cyBjb20uZ29vZ2xlLnByb3RvYnVmLlByb3RvY29sTWVzc2FnZUVudW0g\newogICAgVkVSU0lPTl9PTkUoMCwgMSksCiAgICA7CiAgICAKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IFZFUlNJT05fT05FX1ZBTFVFID0gMTsKICAg\nIAogICAgCiAgICBwdWJsaWMgZmluYWwgaW50IGdldE51bWJlcigpIHsgcmV0\ndXJuIHZhbHVlOyB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgUHJvdG9jb2xW\nZXJzaW9uIHZhbHVlT2YoaW50IHZhbHVlKSB7CiAgICAgIHN3aXRjaCAodmFs\ndWUpIHsKICAgICAgICBjYXNlIDE6IHJldHVybiBWRVJTSU9OX09ORTsKICAg\nICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\nCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJu\nYWwuRW51bUxpdGVNYXA8UHJvdG9jb2xWZXJzaW9uPgogICAgICAgIGludGVy\nbmFsR2V0VmFsdWVNYXAoKSB7CiAgICAgIHJldHVybiBpbnRlcm5hbFZhbHVl\nTWFwOwogICAgfQogICAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxQcm90b2NvbFZlcnNpb24+CiAg\nICAgICAgaW50ZXJuYWxWYWx1ZU1hcCA9CiAgICAgICAgICBuZXcgY29tLmdv\nb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxQcm90b2NvbFZl\ncnNpb24+KCkgewogICAgICAgICAgICBwdWJsaWMgUHJvdG9jb2xWZXJzaW9u\nIGZpbmRWYWx1ZUJ5TnVtYmVyKGludCBudW1iZXIpIHsKICAgICAgICAgICAg\nICByZXR1cm4gUHJvdG9jb2xWZXJzaW9uLnZhbHVlT2YobnVtYmVyKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgfTsKICAgIAogICAgcHVibGljIGZpbmFs\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bVZhbHVlRGVz\nY3JpcHRvcgogICAgICAgIGdldFZhbHVlRGVzY3JpcHRvcigpIHsKICAgICAg\ncmV0dXJuIGdldERlc2NyaXB0b3IoKS5nZXRWYWx1ZXMoKS5nZXQoaW5kZXgp\nOwogICAgfQogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYu\nRGVzY3JpcHRvcnMuRW51bURlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlw\ndG9yRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90\nb2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcgogICAgICAgIGdldERl\nc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5nZXREZXNjcmlwdG9yKCkuZ2V0RW51\nbVR5cGVzKCkuZ2V0KDApOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBQcm90b2NvbFZlcnNpb25bXSBWQUxVRVMgPSB7CiAgICAgIFZF\nUlNJT05fT05FLCAKICAgIH07CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgUHJv\ndG9jb2xWZXJzaW9uIHZhbHVlT2YoCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yIGRlc2MpIHsK\nICAgICAgaWYgKGRlc2MuZ2V0VHlwZSgpICE9IGdldERlc2NyaXB0b3IoKSkg\newogICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50\nRXhjZXB0aW9uKAogICAgICAgICAgIkVudW1WYWx1ZURlc2NyaXB0b3IgaXMg\nbm90IGZvciB0aGlzIHR5cGUuIik7CiAgICAgIH0KICAgICAgcmV0dXJuIFZB\nTFVFU1tkZXNjLmdldEluZGV4KCldOwogICAgfQogICAgCiAgICBwcml2YXRl\nIGZpbmFsIGludCBpbmRleDsKICAgIHByaXZhdGUgZmluYWwgaW50IHZhbHVl\nOwogICAgCiAgICBwcml2YXRlIFByb3RvY29sVmVyc2lvbihpbnQgaW5kZXgs\nIGludCB2YWx1ZSkgewogICAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICAg\nIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90\nb2NfaW5zZXJ0aW9uX3BvaW50KGVudW1fc2NvcGU6SGVkd2lnLlByb3RvY29s\nVmVyc2lvbikKICB9CiAgCiAgcHVibGljIGVudW0gT3BlcmF0aW9uVHlwZQog\nICAgICBpbXBsZW1lbnRzIGNvbS5nb29nbGUucHJvdG9idWYuUHJvdG9jb2xN\nZXNzYWdlRW51bSB7CiAgICBQVUJMSVNIKDAsIDApLAogICAgU1VCU0NSSUJF\nKDEsIDEpLAogICAgQ09OU1VNRSgyLCAyKSwKICAgIFVOU1VCU0NSSUJFKDMs\nIDMpLAogICAgU1RBUlRfREVMSVZFUlkoNCwgNCksCiAgICBTVE9QX0RFTElW\nRVJZKDUsIDUpLAogICAgQ0xPU0VTVUJTQ1JJUFRJT04oNiwgNiksCiAgICA7\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFBVQkxJU0hfVkFM\nVUUgPSAwOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1VCU0NSSUJF\nX1ZBTFVFID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENPTlNV\nTUVfVkFMVUUgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVU5T\nVUJTQ1JJQkVfVkFMVUUgPSAzOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgU1RBUlRfREVMSVZFUllfVkFMVUUgPSA0OwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgU1RPUF9ERUxJVkVSWV9WQUxVRSA9IDU7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBDTE9TRVNVQlNDUklQVElPTl9WQUxVRSA9\nIDY7CiAgICAKICAgIAogICAgcHVibGljIGZpbmFsIGludCBnZXROdW1iZXIo\nKSB7IHJldHVybiB2YWx1ZTsgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIE9w\nZXJhdGlvblR5cGUgdmFsdWVPZihpbnQgdmFsdWUpIHsKICAgICAgc3dpdGNo\nICh2YWx1ZSkgewogICAgICAgIGNhc2UgMDogcmV0dXJuIFBVQkxJU0g7CiAg\nICAgICAgY2FzZSAxOiByZXR1cm4gU1VCU0NSSUJFOwogICAgICAgIGNhc2Ug\nMjogcmV0dXJuIENPTlNVTUU7CiAgICAgICAgY2FzZSAzOiByZXR1cm4gVU5T\nVUJTQ1JJQkU7CiAgICAgICAgY2FzZSA0OiByZXR1cm4gU1RBUlRfREVMSVZF\nUlk7CiAgICAgICAgY2FzZSA1OiByZXR1cm4gU1RPUF9ERUxJVkVSWTsKICAg\nICAgICBjYXNlIDY6IHJldHVybiBDTE9TRVNVQlNDUklQVElPTjsKICAgICAg\nICBkZWZhdWx0OiByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgCiAg\nICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwu\nRW51bUxpdGVNYXA8T3BlcmF0aW9uVHlwZT4KICAgICAgICBpbnRlcm5hbEdl\ndFZhbHVlTWFwKCkgewogICAgICByZXR1cm4gaW50ZXJuYWxWYWx1ZU1hcDsK\nICAgIH0KICAgIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYu\nSW50ZXJuYWwuRW51bUxpdGVNYXA8T3BlcmF0aW9uVHlwZT4KICAgICAgICBp\nbnRlcm5hbFZhbHVlTWFwID0KICAgICAgICAgIG5ldyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPE9wZXJhdGlvblR5cGU+KCkg\newogICAgICAgICAgICBwdWJsaWMgT3BlcmF0aW9uVHlwZSBmaW5kVmFsdWVC\neU51bWJlcihpbnQgbnVtYmVyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE9w\nZXJhdGlvblR5cGUudmFsdWVPZihudW1iZXIpOwogICAgICAgICAgICB9CiAg\nICAgICAgICB9OwogICAgCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5w\ncm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yCiAgICAg\nICAgZ2V0VmFsdWVEZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gZ2V0RGVz\nY3JpcHRvcigpLmdldFZhbHVlcygpLmdldChpbmRleCk7CiAgICB9CiAgICBw\ndWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5F\nbnVtRGVzY3JpcHRvcgogICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkg\newogICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkVudW1EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsK\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLmdldERlc2NyaXB0b3IoKS5nZXRFbnVtVHlwZXMoKS5nZXQo\nMSk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE9wZXJh\ndGlvblR5cGVbXSBWQUxVRVMgPSB7CiAgICAgIFBVQkxJU0gsIFNVQlNDUklC\nRSwgQ09OU1VNRSwgVU5TVUJTQ1JJQkUsIFNUQVJUX0RFTElWRVJZLCBTVE9Q\nX0RFTElWRVJZLCBDTE9TRVNVQlNDUklQVElPTiwgCiAgICB9OwogICAgCiAg\nICBwdWJsaWMgc3RhdGljIE9wZXJhdGlvblR5cGUgdmFsdWVPZigKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURl\nc2NyaXB0b3IgZGVzYykgewogICAgICBpZiAoZGVzYy5nZXRUeXBlKCkgIT0g\nZ2V0RGVzY3JpcHRvcigpKSB7CiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFu\nZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oCiAgICAgICAgICAiRW51bVZh\nbHVlRGVzY3JpcHRvciBpcyBub3QgZm9yIHRoaXMgdHlwZS4iKTsKICAgICAg\nfQogICAgICByZXR1cm4gVkFMVUVTW2Rlc2MuZ2V0SW5kZXgoKV07CiAgICB9\nCiAgICAKICAgIHByaXZhdGUgZmluYWwgaW50IGluZGV4OwogICAgcHJpdmF0\nZSBmaW5hbCBpbnQgdmFsdWU7CiAgICAKICAgIHByaXZhdGUgT3BlcmF0aW9u\nVHlwZShpbnQgaW5kZXgsIGludCB2YWx1ZSkgewogICAgICB0aGlzLmluZGV4\nID0gaW5kZXg7CiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KICAg\nIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGVudW1fc2NvcGU6\nSGVkd2lnLk9wZXJhdGlvblR5cGUpCiAgfQogIAogIHB1YmxpYyBlbnVtIFN1\nYnNjcmlwdGlvbkV2ZW50CiAgICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5w\ncm90b2J1Zi5Qcm90b2NvbE1lc3NhZ2VFbnVtIHsKICAgIFRPUElDX01PVkVE\nKDAsIDEpLAogICAgU1VCU0NSSVBUSU9OX0ZPUkNFRF9DTE9TRUQoMSwgMiks\nCiAgICA7CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRPUElD\nX01PVkVEX1ZBTFVFID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50\nIFNVQlNDUklQVElPTl9GT1JDRURfQ0xPU0VEX1ZBTFVFID0gMjsKICAgIAog\nICAgCiAgICBwdWJsaWMgZmluYWwgaW50IGdldE51bWJlcigpIHsgcmV0dXJu\nIHZhbHVlOyB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgU3Vic2NyaXB0aW9u\nRXZlbnQgdmFsdWVPZihpbnQgdmFsdWUpIHsKICAgICAgc3dpdGNoICh2YWx1\nZSkgewogICAgICAgIGNhc2UgMTogcmV0dXJuIFRPUElDX01PVkVEOwogICAg\nICAgIGNhc2UgMjogcmV0dXJuIFNVQlNDUklQVElPTl9GT1JDRURfQ0xPU0VE\nOwogICAgICAgIGRlZmF1bHQ6IHJldHVybiBudWxsOwogICAgICB9CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5J\nbnRlcm5hbC5FbnVtTGl0ZU1hcDxTdWJzY3JpcHRpb25FdmVudD4KICAgICAg\nICBpbnRlcm5hbEdldFZhbHVlTWFwKCkgewogICAgICByZXR1cm4gaW50ZXJu\nYWxWYWx1ZU1hcDsKICAgIH0KICAgIHByaXZhdGUgc3RhdGljIGNvbS5nb29n\nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8U3Vic2NyaXB0aW9u\nRXZlbnQ+CiAgICAgICAgaW50ZXJuYWxWYWx1ZU1hcCA9CiAgICAgICAgICBu\nZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxT\ndWJzY3JpcHRpb25FdmVudD4oKSB7CiAgICAgICAgICAgIHB1YmxpYyBTdWJz\nY3JpcHRpb25FdmVudCBmaW5kVmFsdWVCeU51bWJlcihpbnQgbnVtYmVyKSB7\nCiAgICAgICAgICAgICAgcmV0dXJuIFN1YnNjcmlwdGlvbkV2ZW50LnZhbHVl\nT2YobnVtYmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgIAog\nICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRv\ncnMuRW51bVZhbHVlRGVzY3JpcHRvcgogICAgICAgIGdldFZhbHVlRGVzY3Jp\ncHRvcigpIHsKICAgICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKS5nZXRWYWx1\nZXMoKS5nZXQoaW5kZXgpOwogICAgfQogICAgcHVibGljIGZpbmFsIGNvbS5n\nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bURlc2NyaXB0b3IKICAg\nICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGdl\ndERlc2NyaXB0b3IoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRv\ncgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5nZXREZXNj\ncmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDIpOwogICAgfQogICAgCiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdWJzY3JpcHRpb25FdmVudFtdIFZB\nTFVFUyA9IHsKICAgICAgVE9QSUNfTU9WRUQsIFNVQlNDUklQVElPTl9GT1JD\nRURfQ0xPU0VELCAKICAgIH07CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgU3Vi\nc2NyaXB0aW9uRXZlbnQgdmFsdWVPZigKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3IgZGVzYykg\newogICAgICBpZiAoZGVzYy5nZXRUeXBlKCkgIT0gZ2V0RGVzY3JpcHRvcigp\nKSB7CiAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24oCiAgICAgICAgICAiRW51bVZhbHVlRGVzY3JpcHRvciBp\ncyBub3QgZm9yIHRoaXMgdHlwZS4iKTsKICAgICAgfQogICAgICByZXR1cm4g\nVkFMVUVTW2Rlc2MuZ2V0SW5kZXgoKV07CiAgICB9CiAgICAKICAgIHByaXZh\ndGUgZmluYWwgaW50IGluZGV4OwogICAgcHJpdmF0ZSBmaW5hbCBpbnQgdmFs\ndWU7CiAgICAKICAgIHByaXZhdGUgU3Vic2NyaXB0aW9uRXZlbnQoaW50IGlu\nZGV4LCBpbnQgdmFsdWUpIHsKICAgICAgdGhpcy5pbmRleCA9IGluZGV4Owog\nICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9CiAgICAKICAgIC8vIEBA\ncHJvdG9jX2luc2VydGlvbl9wb2ludChlbnVtX3Njb3BlOkhlZHdpZy5TdWJz\nY3JpcHRpb25FdmVudCkKICB9CiAgCiAgcHVibGljIGVudW0gU3RhdHVzQ29k\nZQogICAgICBpbXBsZW1lbnRzIGNvbS5nb29nbGUucHJvdG9idWYuUHJvdG9j\nb2xNZXNzYWdlRW51bSB7CiAgICBTVUNDRVNTKDAsIDApLAogICAgTUFMRk9S\nTUVEX1JFUVVFU1QoMSwgNDAxKSwKICAgIE5PX1NVQ0hfVE9QSUMoMiwgNDAy\nKSwKICAgIENMSUVOVF9BTFJFQURZX1NVQlNDUklCRUQoMywgNDAzKSwKICAg\nIENMSUVOVF9OT1RfU1VCU0NSSUJFRCg0LCA0MDQpLAogICAgQ09VTERfTk9U\nX0NPTk5FQ1QoNSwgNDA1KSwKICAgIFRPUElDX0JVU1koNiwgNDA2KSwKICAg\nIFJFU1VCU0NSSUJFX0VYQ0VQVElPTig3LCA0MDcpLAogICAgTk9UX1JFU1BP\nTlNJQkxFX0ZPUl9UT1BJQyg4LCA1MDEpLAogICAgU0VSVklDRV9ET1dOKDks\nIDUwMiksCiAgICBVTkNFUlRBSU5fU1RBVEUoMTAsIDUwMyksCiAgICBJTlZB\nTElEX01FU1NBR0VfRklMVEVSKDExLCA1MDQpLAogICAgQkFEX1ZFUlNJT04o\nMTIsIDUyMCksCiAgICBOT19UT1BJQ19QRVJTSVNURU5DRV9JTkZPKDEzLCA1\nMjEpLAogICAgVE9QSUNfUEVSU0lTVEVOQ0VfSU5GT19FWElTVFMoMTQsIDUy\nMiksCiAgICBOT19TVUJTQ1JJUFRJT05fU1RBVEUoMTUsIDUyMyksCiAgICBT\nVUJTQ1JJUFRJT05fU1RBVEVfRVhJU1RTKDE2LCA1MjQpLAogICAgTk9fVE9Q\nSUNfT1dORVJfSU5GTygxNywgNTI1KSwKICAgIFRPUElDX09XTkVSX0lORk9f\nRVhJU1RTKDE4LCA1MjYpLAogICAgVU5FWFBFQ1RFRF9DT05ESVRJT04oMTks\nIDYwMCksCiAgICBDT01QT1NJVEUoMjAsIDcwMCksCiAgICA7CiAgICAKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNVQ0NFU1NfVkFMVUUgPSAwOwog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUFMRk9STUVEX1JFUVVFU1Rf\nVkFMVUUgPSA0MDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBOT19T\nVUNIX1RPUElDX1ZBTFVFID0gNDAyOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgQ0xJRU5UX0FMUkVBRFlfU1VCU0NSSUJFRF9WQUxVRSA9IDQwMzsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENMSUVOVF9OT1RfU1VCU0NS\nSUJFRF9WQUxVRSA9IDQwNDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50\nIENPVUxEX05PVF9DT05ORUNUX1ZBTFVFID0gNDA1OwogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgVE9QSUNfQlVTWV9WQUxVRSA9IDQwNjsKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IFJFU1VCU0NSSUJFX0VYQ0VQVElPTl9W\nQUxVRSA9IDQwNzsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE5PVF9S\nRVNQT05TSUJMRV9GT1JfVE9QSUNfVkFMVUUgPSA1MDE7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBTRVJWSUNFX0RPV05fVkFMVUUgPSA1MDI7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBVTkNFUlRBSU5fU1RBVEVfVkFM\nVUUgPSA1MDM7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBJTlZBTElE\nX01FU1NBR0VfRklMVEVSX1ZBTFVFID0gNTA0OwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgQkFEX1ZFUlNJT05fVkFMVUUgPSA1MjA7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBOT19UT1BJQ19QRVJTSVNURU5DRV9JTkZP\nX1ZBTFVFID0gNTIxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVE9Q\nSUNfUEVSU0lTVEVOQ0VfSU5GT19FWElTVFNfVkFMVUUgPSA1MjI7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBOT19TVUJTQ1JJUFRJT05fU1RBVEVf\nVkFMVUUgPSA1MjM7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVUJT\nQ1JJUFRJT05fU1RBVEVfRVhJU1RTX1ZBTFVFID0gNTI0OwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgTk9fVE9QSUNfT1dORVJfSU5GT19WQUxVRSA9\nIDUyNTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRPUElDX09XTkVS\nX0lORk9fRVhJU1RTX1ZBTFVFID0gNTI2OwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgVU5FWFBFQ1RFRF9DT05ESVRJT05fVkFMVUUgPSA2MDA7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDT01QT1NJVEVfVkFMVUUgPSA3\nMDA7CiAgICAKICAgIAogICAgcHVibGljIGZpbmFsIGludCBnZXROdW1iZXIo\nKSB7IHJldHVybiB2YWx1ZTsgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIFN0\nYXR1c0NvZGUgdmFsdWVPZihpbnQgdmFsdWUpIHsKICAgICAgc3dpdGNoICh2\nYWx1ZSkgewogICAgICAgIGNhc2UgMDogcmV0dXJuIFNVQ0NFU1M7CiAgICAg\nICAgY2FzZSA0MDE6IHJldHVybiBNQUxGT1JNRURfUkVRVUVTVDsKICAgICAg\nICBjYXNlIDQwMjogcmV0dXJuIE5PX1NVQ0hfVE9QSUM7CiAgICAgICAgY2Fz\nZSA0MDM6IHJldHVybiBDTElFTlRfQUxSRUFEWV9TVUJTQ1JJQkVEOwogICAg\nICAgIGNhc2UgNDA0OiByZXR1cm4gQ0xJRU5UX05PVF9TVUJTQ1JJQkVEOwog\nICAgICAgIGNhc2UgNDA1OiByZXR1cm4gQ09VTERfTk9UX0NPTk5FQ1Q7CiAg\nICAgICAgY2FzZSA0MDY6IHJldHVybiBUT1BJQ19CVVNZOwogICAgICAgIGNh\nc2UgNDA3OiByZXR1cm4gUkVTVUJTQ1JJQkVfRVhDRVBUSU9OOwogICAgICAg\nIGNhc2UgNTAxOiByZXR1cm4gTk9UX1JFU1BPTlNJQkxFX0ZPUl9UT1BJQzsK\nICAgICAgICBjYXNlIDUwMjogcmV0dXJuIFNFUlZJQ0VfRE9XTjsKICAgICAg\nICBjYXNlIDUwMzogcmV0dXJuIFVOQ0VSVEFJTl9TVEFURTsKICAgICAgICBj\nYXNlIDUwNDogcmV0dXJuIElOVkFMSURfTUVTU0FHRV9GSUxURVI7CiAgICAg\nICAgY2FzZSA1MjA6IHJldHVybiBCQURfVkVSU0lPTjsKICAgICAgICBjYXNl\nIDUyMTogcmV0dXJuIE5PX1RPUElDX1BFUlNJU1RFTkNFX0lORk87CiAgICAg\nICAgY2FzZSA1MjI6IHJldHVybiBUT1BJQ19QRVJTSVNURU5DRV9JTkZPX0VY\nSVNUUzsKICAgICAgICBjYXNlIDUyMzogcmV0dXJuIE5PX1NVQlNDUklQVElP\nTl9TVEFURTsKICAgICAgICBjYXNlIDUyNDogcmV0dXJuIFNVQlNDUklQVElP\nTl9TVEFURV9FWElTVFM7CiAgICAgICAgY2FzZSA1MjU6IHJldHVybiBOT19U\nT1BJQ19PV05FUl9JTkZPOwogICAgICAgIGNhc2UgNTI2OiByZXR1cm4gVE9Q\nSUNfT1dORVJfSU5GT19FWElTVFM7CiAgICAgICAgY2FzZSA2MDA6IHJldHVy\nbiBVTkVYUEVDVEVEX0NPTkRJVElPTjsKICAgICAgICBjYXNlIDcwMDogcmV0\ndXJuIENPTVBPU0lURTsKICAgICAgICBkZWZhdWx0OiByZXR1cm4gbnVsbDsK\nICAgICAgfQogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGNvbS5nb29n\nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8U3RhdHVzQ29kZT4K\nICAgICAgICBpbnRlcm5hbEdldFZhbHVlTWFwKCkgewogICAgICByZXR1cm4g\naW50ZXJuYWxWYWx1ZU1hcDsKICAgIH0KICAgIHByaXZhdGUgc3RhdGljIGNv\nbS5nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8U3RhdHVz\nQ29kZT4KICAgICAgICBpbnRlcm5hbFZhbHVlTWFwID0KICAgICAgICAgIG5l\ndyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPFN0\nYXR1c0NvZGU+KCkgewogICAgICAgICAgICBwdWJsaWMgU3RhdHVzQ29kZSBm\naW5kVmFsdWVCeU51bWJlcihpbnQgbnVtYmVyKSB7CiAgICAgICAgICAgICAg\ncmV0dXJuIFN0YXR1c0NvZGUudmFsdWVPZihudW1iZXIpOwogICAgICAgICAg\nICB9CiAgICAgICAgICB9OwogICAgCiAgICBwdWJsaWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9y\nCiAgICAgICAgZ2V0VmFsdWVEZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4g\nZ2V0RGVzY3JpcHRvcigpLmdldFZhbHVlcygpLmdldChpbmRleCk7CiAgICB9\nCiAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlw\ndG9ycy5FbnVtRGVzY3JpcHRvcgogICAgICAgIGdldERlc2NyaXB0b3JGb3JU\neXBlKCkgewogICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkVudW1EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRv\ncigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLmdldERlc2NyaXB0b3IoKS5nZXRFbnVtVHlwZXMo\nKS5nZXQoMyk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIFN0YXR1c0NvZGVbXSBWQUxVRVMgPSB7CiAgICAgIFNVQ0NFU1MsIE1BTEZP\nUk1FRF9SRVFVRVNULCBOT19TVUNIX1RPUElDLCBDTElFTlRfQUxSRUFEWV9T\nVUJTQ1JJQkVELCBDTElFTlRfTk9UX1NVQlNDUklCRUQsIENPVUxEX05PVF9D\nT05ORUNULCBUT1BJQ19CVVNZLCBSRVNVQlNDUklCRV9FWENFUFRJT04sIE5P\nVF9SRVNQT05TSUJMRV9GT1JfVE9QSUMsIFNFUlZJQ0VfRE9XTiwgVU5DRVJU\nQUlOX1NUQVRFLCBJTlZBTElEX01FU1NBR0VfRklMVEVSLCBCQURfVkVSU0lP\nTiwgTk9fVE9QSUNfUEVSU0lTVEVOQ0VfSU5GTywgVE9QSUNfUEVSU0lTVEVO\nQ0VfSU5GT19FWElTVFMsIE5PX1NVQlNDUklQVElPTl9TVEFURSwgU1VCU0NS\nSVBUSU9OX1NUQVRFX0VYSVNUUywgTk9fVE9QSUNfT1dORVJfSU5GTywgVE9Q\nSUNfT1dORVJfSU5GT19FWElTVFMsIFVORVhQRUNURURfQ09ORElUSU9OLCBD\nT01QT1NJVEUsIAogICAgfTsKICAgIAogICAgcHVibGljIHN0YXRpYyBTdGF0\ndXNDb2RlIHZhbHVlT2YoCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yIGRlc2MpIHsKICAgICAg\naWYgKGRlc2MuZ2V0VHlwZSgpICE9IGdldERlc2NyaXB0b3IoKSkgewogICAg\nICAgIHRocm93IG5ldyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0\naW9uKAogICAgICAgICAgIkVudW1WYWx1ZURlc2NyaXB0b3IgaXMgbm90IGZv\nciB0aGlzIHR5cGUuIik7CiAgICAgIH0KICAgICAgcmV0dXJuIFZBTFVFU1tk\nZXNjLmdldEluZGV4KCldOwogICAgfQogICAgCiAgICBwcml2YXRlIGZpbmFs\nIGludCBpbmRleDsKICAgIHByaXZhdGUgZmluYWwgaW50IHZhbHVlOwogICAg\nCiAgICBwcml2YXRlIFN0YXR1c0NvZGUoaW50IGluZGV4LCBpbnQgdmFsdWUp\nIHsKICAgICAgdGhpcy5pbmRleCA9IGluZGV4OwogICAgICB0aGlzLnZhbHVl\nID0gdmFsdWU7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlv\nbl9wb2ludChlbnVtX3Njb3BlOkhlZHdpZy5TdGF0dXNDb2RlKQogIH0KICAK\nICBwdWJsaWMgaW50ZXJmYWNlIE1hcE9yQnVpbGRlcgogICAgICBleHRlbmRz\nIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7CiAgICAK\nICAgIC8vIHJlcGVhdGVkIC5IZWR3aWcuTWFwLkVudHJ5IGVudHJpZXMgPSAx\nOwogICAgamF2YS51dGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5PiAKICAgICAgICBnZXRFbnRy\naWVzTGlzdCgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwLkVudHJ5IGdldEVudHJpZXMoaW50IGluZGV4KTsK\nICAgIGludCBnZXRFbnRyaWVzQ291bnQoKTsKICAgIGphdmEudXRpbC5MaXN0\nPD8gZXh0ZW5kcyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NYXAuRW50cnlPckJ1aWxkZXI+IAogICAgICAgIGdldEVudHJp\nZXNPckJ1aWxkZXJMaXN0KCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnlPckJ1aWxkZXIgZ2V0RW50\ncmllc09yQnVpbGRlcigKICAgICAgICBpbnQgaW5kZXgpOwogIH0KICBwdWJs\naWMgc3RhdGljIGZpbmFsIGNsYXNzIE1hcCBleHRlbmRzCiAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZQogICAgICBpbXBsZW1l\nbnRzIE1hcE9yQnVpbGRlciB7CiAgICAvLyBVc2UgTWFwLm5ld0J1aWxkZXIo\nKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIE1hcChCdWlsZGVyIGJ1aWxk\nZXIpIHsKICAgICAgc3VwZXIoYnVpbGRlcik7CiAgICB9CiAgICBwcml2YXRl\nIE1hcChib29sZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgTWFwIGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0\naWMgTWFwIGdldERlZmF1bHRJbnN0YW5jZSgpIHsKICAgICAgcmV0dXJuIGRl\nZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVibGljIE1hcCBnZXRE\nZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVs\ndEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgog\nICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX01hcF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBw\ncm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRB\nY2Nlc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19NYXBfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgfQogICAgCiAgICBw\ndWJsaWMgaW50ZXJmYWNlIEVudHJ5T3JCdWlsZGVyCiAgICAgICAgZXh0ZW5k\ncyBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgewogICAg\nICAKICAgICAgLy8gb3B0aW9uYWwgc3RyaW5nIGtleSA9IDE7CiAgICAgIGJv\nb2xlYW4gaGFzS2V5KCk7CiAgICAgIFN0cmluZyBnZXRLZXkoKTsKICAgICAg\nCiAgICAgIC8vIG9wdGlvbmFsIGJ5dGVzIHZhbHVlID0gMjsKICAgICAgYm9v\nbGVhbiBoYXNWYWx1ZSgpOwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZ2V0VmFsdWUoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY2xhc3MgRW50cnkgZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZQogICAgICAgIGltcGxlbWVudHMg\nRW50cnlPckJ1aWxkZXIgewogICAgICAvLyBVc2UgRW50cnkubmV3QnVpbGRl\ncigpIHRvIGNvbnN0cnVjdC4KICAgICAgcHJpdmF0ZSBFbnRyeShCdWlsZGVy\nIGJ1aWxkZXIpIHsKICAgICAgICBzdXBlcihidWlsZGVyKTsKICAgICAgfQog\nICAgICBwcml2YXRlIEVudHJ5KGJvb2xlYW4gbm9Jbml0KSB7fQogICAgICAK\nICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgRW50cnkgZGVmYXVsdEluc3Rh\nbmNlOwogICAgICBwdWJsaWMgc3RhdGljIEVudHJ5IGdldERlZmF1bHRJbnN0\nYW5jZSgpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgRW50cnkgZ2V0RGVmYXVsdEluc3Rh\nbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNl\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxf\nc3RhdGljX0hlZHdpZ19NYXBfRW50cnlfZGVzY3JpcHRvcjsKICAgICAgfQog\nICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAgIGlu\ndGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01hcF9FbnRyeV9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZp\nZWxkMF87CiAgICAgIC8vIG9wdGlvbmFsIHN0cmluZyBrZXkgPSAxOwogICAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBLRVlfRklFTERfTlVNQkVSID0g\nMTsKICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGtleV87CiAgICAg\nIHB1YmxpYyBib29sZWFuIGhhc0tleSgpIHsKICAgICAgICByZXR1cm4gKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAg\nIH0KICAgICAgcHVibGljIFN0cmluZyBnZXRLZXkoKSB7CiAgICAgICAgamF2\nYS5sYW5nLk9iamVjdCByZWYgPSBrZXlfOwogICAgICAgIGlmIChyZWYgaW5z\ndGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgIHJldHVybiAoU3RyaW5nKSBy\nZWY7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBicyA9IAogICAgICAgICAgICAgIChjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgICAgIFN0cmlu\nZyBzID0gYnMudG9TdHJpbmdVdGY4KCk7CiAgICAgICAgICBpZiAoY29tLmdv\nb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5pc1ZhbGlkVXRmOChicykpIHsKICAg\nICAgICAgICAga2V5XyA9IHM7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1\ncm4gczsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0S2V5Qnl0ZXMoKSB7CiAgICAg\nICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBrZXlfOwogICAgICAgIGlmIChy\nZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBiID0gCiAgICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgoU3RyaW5n\nKSByZWYpOwogICAgICAgICAga2V5XyA9IGI7CiAgICAgICAgICByZXR1cm4g\nYjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIChjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgICB9CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIGJ5dGVzIHZhbHVlID0gMjsK\nICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVkFMVUVfRklFTERfTlVN\nQkVSID0gMjsKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgdmFsdWVfOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNWYWx1\nZSgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMikgPT0gMHgwMDAwMDAwMik7CiAgICAgIH0KICAgICAgcHVibGljIGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRWYWx1ZSgpIHsKICAgICAg\nICByZXR1cm4gdmFsdWVfOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRl\nIHZvaWQgaW5pdEZpZWxkcygpIHsKICAgICAgICBrZXlfID0gIiI7CiAgICAg\nICAgdmFsdWVfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVN\nUFRZOwogICAgICB9CiAgICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5p\ndGlhbGl6ZWQgPSAtMTsKICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJ\nbml0aWFsaXplZCgpIHsKICAgICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBt\nZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgICAgaWYgKGlzSW5pdGlhbGl6\nZWQgIT0gLTEpIHJldHVybiBpc0luaXRpYWxpemVkID09IDE7CiAgICAgICAg\nCiAgICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsKICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIHZvaWQg\nd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nIG91dHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgZ2V0U2VyaWFsaXplZFNpemUo\nKTsKICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDEs\nIGdldEtleUJ5dGVzKCkpOwogICAgICAgIH0KICAgICAgICBpZiAoKChiaXRG\naWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAg\nICAgIG91dHB1dC53cml0ZUJ5dGVzKDIsIHZhbHVlXyk7CiAgICAgICAgfQog\nICAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFs\naXplZFNpemUgPSAtMTsKICAgICAgcHVibGljIGludCBnZXRTZXJpYWxpemVk\nU2l6ZSgpIHsKICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXpl\nZFNpemU7CiAgICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwog\nICAgICAKICAgICAgICBzaXplID0gMDsKICAgICAgICBpZiAoKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAg\nIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVh\nbQogICAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgxLCBnZXRLZXlCeXRl\ncygpKTsKICAgICAgICB9CiAgICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAgICBzaXplICs9\nIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAg\nICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMiwgdmFsdWVfKTsKICAgICAgICB9\nCiAgICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFs\naXplZFNpemUoKTsKICAgICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0g\nc2l6ZTsKICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgfQogICAgICAKICAg\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlE\nID0gMEw7CiAgICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgICAgcHJvdGVj\ndGVkIGphdmEubGFuZy5PYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICAg\nIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7CiAgICAg\nICAgcmV0dXJuIHN1cGVyLndyaXRlUmVwbGFjZSgpOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeSBwYXJzZUZyb20oCiAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAg\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgICAgfQog\nICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeSBwYXJzZUZyb20oCiAgICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGNvbS5nb29n\nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeSBwYXJz\nZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1\naWxkUGFyc2VkKCk7CiAgICAgIH0KICAgICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50\ncnkgcGFyc2VGcm9tKAogICAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2Vk\nKCk7CiAgICAgIH0KICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkgcGFyc2VG\ncm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nIH0KICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkgcGFyc2VGcm9tKAogICAg\nICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAu\nYnVpbGRQYXJzZWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5F\nbnRyeSBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBp\nbnB1dCkKICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAg\nICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewog\nICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQog\nICAgICB9CiAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5IHBhcnNlRGVsaW1p\ndGVkRnJvbSgKICAgICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQs\nCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lz\ndHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXdCdWlsZGVyKCk7CiAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxp\nbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAg\nfQogICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeSBwYXJzZUZyb20oCiAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5w\ndXQpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1\naWxkUGFyc2VkKCk7CiAgICAgIH0KICAgICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50\ncnkgcGFyc2VGcm9tKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgIC5idWlsZFBhcnNl\nZCgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgc3RhdGljIEJ1aWxk\nZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJl\ndHVybiBuZXdCdWlsZGVyKCk7IH0KICAgICAgcHVibGljIHN0YXRpYyBCdWls\nZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwLkVudHJ5IHByb3RvdHlwZSkgewogICAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4g\nbmV3QnVpbGRlcih0aGlzKTsgfQogICAgICAKICAgICAgQGphdmEubGFuZy5P\ndmVycmlkZQogICAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9y\nVHlwZSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIEJ1aWxk\nZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7CiAgICAgICAgcmV0\ndXJuIGJ1aWxkZXI7CiAgICAgIH0KICAgICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+CiAg\nICAgICAgIGltcGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5T3JCdWlsZGVyIHsKICAgICAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3Jp\ncHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkg\newogICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWFwX0Vu\ndHJ5X2Rlc2NyaXB0b3I7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHBy\nb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICAgIGludGVybmFsR2V0Rmll\nbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgICAgcmV0dXJuIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0\nYXRpY19IZWR3aWdfTWFwX0VudHJ5X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5F\nbnRyeS5uZXdCdWlsZGVyKCkKICAgICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7\nCiAgICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIHByaXZhdGUgQnVpbGRlcihC\ndWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgICAgc3VwZXIocGFyZW50\nKTsKICAgICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24o\nKTsKICAgICAgICB9CiAgICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VC\ndWlsZGVySW5pdGlhbGl6YXRpb24oKSB7CiAgICAgICAgICBpZiAoY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLmFsd2F5c1VzZUZpZWxk\nQnVpbGRlcnMpIHsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcHJp\ndmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAgICAgICByZXR1\ncm4gbmV3IEJ1aWxkZXIoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\ncHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAgICBzdXBlci5jbGVh\ncigpOwogICAgICAgICAga2V5XyA9ICIiOwogICAgICAgICAgYml0RmllbGQw\nXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgICAgdmFs\ndWVfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwog\nICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAw\nMDIpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAg\nIAogICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgICAg\ncmV0dXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShidWlsZFBhcnRpYWwoKSk7CiAg\nICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgICAgZ2V0\nRGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5\nLmdldERlc2NyaXB0b3IoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1hcC5FbnRyeSBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewog\nICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1hcC5FbnRyeS5nZXREZWZhdWx0SW5zdGFuY2UoKTsK\nICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeSBidWls\nZCgpIHsKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1hcC5FbnRyeSByZXN1bHQgPSBidWlsZFBhcnRpYWwo\nKTsKICAgICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewog\nICAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2Vw\ndGlvbihyZXN1bHQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50\ncnkgYnVpbGRQYXJzZWQoKQogICAgICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwLkVudHJ5IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAg\nICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAg\nICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAog\nICAgICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJF\neGNlcHRpb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1\nbHQ7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkg\nYnVpbGRQYXJ0aWFsKCkgewogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5IHJlc3VsdCA9IG5l\ndyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nYXAuRW50cnkodGhpcyk7CiAgICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBf\nID0gYml0RmllbGQwXzsKICAgICAgICAgIGludCB0b19iaXRGaWVsZDBfID0g\nMDsKICAgICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgICAgIHRvX2JpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc3Vs\ndC5rZXlfID0ga2V5XzsKICAgICAgICAgIGlmICgoKGZyb21fYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAgICAg\nIHRvX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICAgIH0KICAg\nICAgICAgIHJlc3VsdC52YWx1ZV8gPSB2YWx1ZV87CiAgICAgICAgICByZXN1\nbHQuYml0RmllbGQwXyA9IHRvX2JpdEZpZWxkMF87CiAgICAgICAgICBvbkJ1\naWx0KCk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAg\nICAgICAKICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdv\nb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgICBpZiAo\nb3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NYXAuRW50cnkpIHsKICAgICAgICAgICAgcmV0dXJu\nIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWFwLkVudHJ5KW90aGVyKTsKICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICAKICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5IG90\naGVyKSB7CiAgICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5LmdldERlZmF1\nbHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICAgIGlmIChvdGhl\nci5oYXNLZXkoKSkgewogICAgICAgICAgICBzZXRLZXkob3RoZXIuZ2V0S2V5\nKCkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG90aGVyLmhhc1ZhbHVl\nKCkpIHsKICAgICAgICAgICAgc2V0VmFsdWUob3RoZXIuZ2V0VmFsdWUoKSk7\nCiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxk\ncyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHB1YmxpYyBmaW5h\nbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgcHVibGljIEJ1aWxk\nZXIgbWVyZ2VGcm9tKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlv\nbiB7CiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVs\nZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAog\nICAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAg\nICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGludCB0YWcgPSBpbnB1\ndC5yZWFkVGFnKCk7CiAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAg\nICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtu\nb3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAg\nICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgIGlm\nICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lv\nblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0\nVW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAg\nICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY2FzZSAxMDog\newogICAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwog\nICAgICAgICAgICAgICAga2V5XyA9IGlucHV0LnJlYWRCeXRlcygpOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0g\nMHgwMDAwMDAwMjsKICAgICAgICAgICAgICAgIHZhbHVlXyA9IGlucHV0LnJl\nYWRCeXRlcygpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIAogICAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAgICAg\nCiAgICAgICAgLy8gb3B0aW9uYWwgc3RyaW5nIGtleSA9IDE7CiAgICAgICAg\ncHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGtleV8gPSAiIjsKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNLZXkoKSB7CiAgICAgICAgICByZXR1cm4gKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0S2V5KCkgewogICAgICAg\nICAgamF2YS5sYW5nLk9iamVjdCByZWYgPSBrZXlfOwogICAgICAgICAgaWYg\nKCEocmVmIGluc3RhbmNlb2YgU3RyaW5nKSkgewogICAgICAgICAgICBTdHJp\nbmcgcyA9ICgoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWYp\nLnRvU3RyaW5nVXRmOCgpOwogICAgICAgICAgICBrZXlfID0gczsKICAgICAg\nICAgICAgcmV0dXJuIHM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICByZXR1cm4gKFN0cmluZykgcmVmOwogICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRLZXkoU3RyaW5nIHZhbHVlKSB7\nCiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3\nIE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0g\nMHgwMDAwMDAwMTsKICAgICAgICAgIGtleV8gPSB2YWx1ZTsKICAgICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyS2V5KCkgewogICAgICAg\nICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwog\nICAgICAgICAga2V5XyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEtleSgp\nOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICB9CiAgICAgICAgdm9pZCBzZXRLZXkoY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgICBiaXRGaWVs\nZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgICBrZXlfID0gdmFsdWU7CiAg\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAg\nICAgLy8gb3B0aW9uYWwgYnl0ZXMgdmFsdWUgPSAyOwogICAgICAgIHByaXZh\ndGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlXyA9IGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNWYWx1ZSgpIHsKICAgICAgICAgIHJldHVybiAo\nKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKTsKICAg\nICAgICB9CiAgICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBnZXRWYWx1ZSgpIHsKICAgICAgICAgIHJldHVybiB2YWx1ZV87\nCiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFZhbHVlKGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewogICAgICAg\nICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9p\nbnRlckV4Y2VwdGlvbigpOwogIH0KICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAw\nMDI7CiAgICAgICAgICB2YWx1ZV8gPSB2YWx1ZTsKICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVmFsdWUoKSB7CiAgICAgICAgICBi\naXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAg\nICAgICB2YWx1ZV8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRWYWx1ZSgp\nOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gQEBwcm90b2NfaW5z\nZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLk1hcC5FbnRyeSkK\nICAgICAgfQogICAgICAKICAgICAgc3RhdGljIHsKICAgICAgICBkZWZhdWx0\nSW5zdGFuY2UgPSBuZXcgRW50cnkodHJ1ZSk7CiAgICAgICAgZGVmYXVsdElu\nc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgICAgfQogICAgICAKICAgICAgLy8g\nQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5N\nYXAuRW50cnkpCiAgICB9CiAgICAKICAgIC8vIHJlcGVhdGVkIC5IZWR3aWcu\nTWFwLkVudHJ5IGVudHJpZXMgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgRU5UUklFU19GSUVMRF9OVU1CRVIgPSAxOwogICAgcHJpdmF0ZSBq\nYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NYXAuRW50cnk+IGVudHJpZXNfOwogICAgcHVibGljIGph\ndmEudXRpbC5MaXN0PG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1hcC5FbnRyeT4gZ2V0RW50cmllc0xpc3QoKSB7CiAgICAg\nIHJldHVybiBlbnRyaWVzXzsKICAgIH0KICAgIHB1YmxpYyBqYXZhLnV0aWwu\nTGlzdDw/IGV4dGVuZHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwLkVudHJ5T3JCdWlsZGVyPiAKICAgICAgICBnZXRF\nbnRyaWVzT3JCdWlsZGVyTGlzdCgpIHsKICAgICAgcmV0dXJuIGVudHJpZXNf\nOwogICAgfQogICAgcHVibGljIGludCBnZXRFbnRyaWVzQ291bnQoKSB7CiAg\nICAgIHJldHVybiBlbnRyaWVzXy5zaXplKCk7CiAgICB9CiAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFw\nLkVudHJ5IGdldEVudHJpZXMoaW50IGluZGV4KSB7CiAgICAgIHJldHVybiBl\nbnRyaWVzXy5nZXQoaW5kZXgpOwogICAgfQogICAgcHVibGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeU9y\nQnVpbGRlciBnZXRFbnRyaWVzT3JCdWlsZGVyKAogICAgICAgIGludCBpbmRl\neCkgewogICAgICByZXR1cm4gZW50cmllc18uZ2V0KGluZGV4KTsKICAgIH0K\nICAgIAogICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIGVu\ndHJpZXNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwog\nICAgfQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9\nIC0xOwogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgp\nIHsKICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRp\nYWxpemVkOwogICAgICBpZiAoaXNJbml0aWFsaXplZCAhPSAtMSkgcmV0dXJu\nIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAgCiAgICAgIG1lbW9pemVkSXNJ\nbml0aWFsaXplZCA9IDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNl\ncmlhbGl6ZWRTaXplKCk7CiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZW50\ncmllc18uc2l6ZSgpOyBpKyspIHsKICAgICAgICBvdXRwdXQud3JpdGVNZXNz\nYWdlKDEsIGVudHJpZXNfLmdldChpKSk7CiAgICAgIH0KICAgICAgZ2V0VW5r\nbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAg\ncHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAg\ncHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNp\nemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAh\nPSAtMSkgcmV0dXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgZW50cmllc18uc2l6ZSgpOyBpKyspIHsK\nICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUoMSwgZW50\ncmllc18uZ2V0KGkpKTsKICAgICAgfQogICAgICBzaXplICs9IGdldFVua25v\nd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXpl\nZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAg\nICB9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFs\nVmVyc2lvblVJRCA9IDBMOwogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAg\ncHJvdGVjdGVkIGphdmEubGFuZy5PYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb24gewog\nICAgICByZXR1cm4gc3VwZXIud3JpdGVSZXBsYWNlKCk7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWFwIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAg\ncGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAu\nYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIHBhcnNl\nRnJvbShieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAgcGFyc2VGcm9tKAog\nICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWFwIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcCBwYXJzZUZyb20oCiAgICAgICAg\namF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcCBwYXJzZURlbGltaXRlZEZyb20o\namF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\nd0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRG\ncm9tKGlucHV0KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIHBhcnNlRGVsaW1pdGVk\nRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRl\ncigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5w\ndXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBidWls\nZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIHBh\ncnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShp\nbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFw\nIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsg\ncmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVy\nIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9\nCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAgcHJvdG90\neXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHBy\nb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIo\nKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZh\nLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxk\nZXJGb3JUeXBlKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWls\nZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1\ncm4gYnVpbGRlcjsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xh\nc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGlt\ncGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwT3JCdWlsZGVyIHsKICAgICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IK\nICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVy\nbmFsX3N0YXRpY19IZWR3aWdfTWFwX2Rlc2NyaXB0b3I7CiAgICAgIH0KICAg\nICAgCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRl\ncm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19NYXBfZmllbGRBY2Nlc3NvclRhYmxlOwog\nICAgICB9CiAgICAgIAogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLm5ld0J1\naWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7CiAgICAgICAgbWF5\nYmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAgICAg\nIAogICAgICBwcml2YXRlIEJ1aWxkZXIoQnVpbGRlclBhcmVudCBwYXJlbnQp\nIHsKICAgICAgICBzdXBlcihwYXJlbnQpOwogICAgICAgIG1heWJlRm9yY2VC\ndWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICBwcml2YXRl\nIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsKICAg\nICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsKICAgICAgICAgIGdldEVudHJp\nZXNGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJp\ndmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFyKCk7CiAgICAg\nICAgaWYgKGVudHJpZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBl\nbnRyaWVzXyA9IGphdmEudXRpbC5Db2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsK\nICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAw\nMDAxKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZW50cmllc0J1aWxk\nZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsK\nICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKGJ1aWxkUGFydGlh\nbCgpKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGNvbS5nb29nbGUu\ncHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgZ2V0\nRGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5nZXREZXNj\ncmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAgZ2V0RGVm\nYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLmdldERl\nZmF1bHRJbnN0YW5jZSgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFw\nIGJ1aWxkKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hcCByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsK\nICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAg\nICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJl\nc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAg\nIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIGJ1aWxkUGFyc2VkKCkKICAgICAg\nICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2Nv\nbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIHJlc3VsdCA9IGJ1aWxkUGFy\ndGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkg\newogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNl\ncHRpb24oCiAgICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcCBidWlsZFBhcnRp\nYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAodGhpcyk7CiAgICAgICAg\naW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87CiAgICAgICAgaWYg\nKGVudHJpZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAoKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAg\nICAgICAgICAgZW50cmllc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMudW5t\nb2RpZmlhYmxlTGlzdChlbnRyaWVzXyk7CiAgICAgICAgICAgIGJpdEZpZWxk\nMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICAgIH0K\nICAgICAgICAgIHJlc3VsdC5lbnRyaWVzXyA9IGVudHJpZXNfOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQuZW50cmllc18gPSBlbnRyaWVz\nQnVpbGRlcl8uYnVpbGQoKTsKICAgICAgICB9CiAgICAgICAgb25CdWlsdCgp\nOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVm\nLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2Vv\nZiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nYXApIHsKICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcClvdGhlcik7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhl\ncik7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAgb3RoZXIp\nIHsKICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLmdldERlZmF1bHRJbnN0YW5jZSgp\nKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAoZW50cmllc0J1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIGlmICghb3RoZXIuZW50cmllc18uaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgIGlmIChlbnRyaWVzXy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICBlbnRyaWVzXyA9IG90aGVyLmVudHJpZXNfOwogICAg\nICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAw\nMDAxKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBlbnN1\ncmVFbnRyaWVzSXNNdXRhYmxlKCk7CiAgICAgICAgICAgICAgZW50cmllc18u\nYWRkQWxsKG90aGVyLmVudHJpZXNfKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgaWYgKCFvdGhlci5lbnRyaWVzXy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgaWYgKGVudHJpZXNCdWlsZGVyXy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICBlbnRyaWVzQnVpbGRlcl8uZGlzcG9zZSgpOwogICAg\nICAgICAgICAgIGVudHJpZXNCdWlsZGVyXyA9IG51bGw7CiAgICAgICAgICAg\nICAgZW50cmllc18gPSBvdGhlci5lbnRyaWVzXzsKICAgICAgICAgICAgICBi\naXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAg\nICAgICAgICAgZW50cmllc0J1aWxkZXJfID0gCiAgICAgICAgICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNl\nRmllbGRCdWlsZGVycyA/CiAgICAgICAgICAgICAgICAgICBnZXRFbnRyaWVz\nRmllbGRCdWlsZGVyKCkgOiBudWxsOwogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgIGVudHJpZXNCdWlsZGVyXy5hZGRBbGxNZXNzYWdlcyhv\ndGhlci5lbnRyaWVzXyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIu\nZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0\naWFsaXplZCgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAg\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5l\nd0J1aWxkZXIoCiAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygp\nKTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9\nIGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAg\nICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnNldFVua25v\nd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgIGlmICghcGFyc2VV\nbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25SZWdpc3RyeSwg\ndGFnKSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRz\nKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBjYXNlIDEwOiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5LkJ1\naWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeS5uZXdCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5z\naW9uUmVnaXN0cnkpOwogICAgICAgICAgICAgIGFkZEVudHJpZXMoc3ViQnVp\nbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAg\nICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAgIAogICAg\nICAvLyByZXBlYXRlZCAuSGVkd2lnLk1hcC5FbnRyeSBlbnRyaWVzID0gMTsK\nICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnk+IGVudHJpZXNf\nID0KICAgICAgICBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7\nCiAgICAgIHByaXZhdGUgdm9pZCBlbnN1cmVFbnRyaWVzSXNNdXRhYmxlKCkg\newogICAgICAgIGlmICghKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIGVudHJpZXNfID0gbmV3IGphdmEu\ndXRpbC5BcnJheUxpc3Q8b3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwLkVudHJ5PihlbnRyaWVzXyk7CiAgICAgICAgICBi\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgIH0KICAgICAgfQog\nICAgICAKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlJlcGVh\ndGVkRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5LCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkuQnVp\nbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWFwLkVudHJ5T3JCdWlsZGVyPiBlbnRyaWVzQnVpbGRlcl87CiAgICAg\nIAogICAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5PiBnZXRFbnRy\naWVzTGlzdCgpIHsKICAgICAgICBpZiAoZW50cmllc0J1aWxkZXJfID09IG51\nbGwpIHsKICAgICAgICAgIHJldHVybiBqYXZhLnV0aWwuQ29sbGVjdGlvbnMu\ndW5tb2RpZmlhYmxlTGlzdChlbnRyaWVzXyk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIHJldHVybiBlbnRyaWVzQnVpbGRlcl8uZ2V0TWVzc2FnZUxp\nc3QoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHVibGljIGludCBnZXRF\nbnRyaWVzQ291bnQoKSB7CiAgICAgICAgaWYgKGVudHJpZXNCdWlsZGVyXyA9\nPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gZW50cmllc18uc2l6ZSgpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gZW50cmllc0J1aWxk\nZXJfLmdldENvdW50KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nYXAuRW50cnkgZ2V0RW50cmllcyhpbnQgaW5kZXgpIHsKICAgICAgICBpZiAo\nZW50cmllc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBl\nbnRyaWVzXy5nZXQoaW5kZXgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICByZXR1cm4gZW50cmllc0J1aWxkZXJfLmdldE1lc3NhZ2UoaW5kZXgpOwog\nICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRFbnRy\naWVzKAogICAgICAgICAgaW50IGluZGV4LCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkgdmFsdWUpIHsKICAg\nICAgICBpZiAoZW50cmllc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAg\nIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBO\ndWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgfQogICAgICAgICAg\nZW5zdXJlRW50cmllc0lzTXV0YWJsZSgpOwogICAgICAgICAgZW50cmllc18u\nc2V0KGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgZW50cmllc0J1aWxkZXJfLnNldE1l\nc3NhZ2UoaW5kZXgsIHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RW50cmll\ncygKICAgICAgICAgIGludCBpbmRleCwgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5LkJ1aWxkZXIgYnVpbGRl\nckZvclZhbHVlKSB7CiAgICAgICAgaWYgKGVudHJpZXNCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBlbnN1cmVFbnRyaWVzSXNNdXRhYmxlKCk7CiAg\nICAgICAgICBlbnRyaWVzXy5zZXQoaW5kZXgsIGJ1aWxkZXJGb3JWYWx1ZS5i\ndWlsZCgpKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICBlbnRyaWVzQnVpbGRlcl8uc2V0TWVzc2FnZShpbmRl\neCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBh\nZGRFbnRyaWVzKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1hcC5FbnRyeSB2YWx1ZSkgewogICAgICAgIGlmIChlbnRyaWVz\nQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZhbHVlID09IG51\nbGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0\naW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBlbnN1cmVFbnRyaWVzSXNN\ndXRhYmxlKCk7CiAgICAgICAgICBlbnRyaWVzXy5hZGQodmFsdWUpOwogICAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nIGVudHJpZXNCdWlsZGVyXy5hZGRNZXNzYWdlKHZhbHVlKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgYWRkRW50cmllcygKICAgICAgICAgIGludCBpbmRleCwgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5\nIHZhbHVlKSB7CiAgICAgICAgaWYgKGVudHJpZXNCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAg\nIH0KICAgICAgICAgIGVuc3VyZUVudHJpZXNJc011dGFibGUoKTsKICAgICAg\nICAgIGVudHJpZXNfLmFkZChpbmRleCwgdmFsdWUpOwogICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVudHJpZXNC\ndWlsZGVyXy5hZGRNZXNzYWdlKGluZGV4LCB2YWx1ZSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIGFkZEVudHJpZXMoCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkuQnVpbGRlciBidWls\nZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAoZW50cmllc0J1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIGVuc3VyZUVudHJpZXNJc011dGFibGUoKTsK\nICAgICAgICAgIGVudHJpZXNfLmFkZChidWlsZGVyRm9yVmFsdWUuYnVpbGQo\nKSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgZW50cmllc0J1aWxkZXJfLmFkZE1lc3NhZ2UoYnVpbGRlckZv\nclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRFbnRyaWVzKAog\nICAgICAgICAgaW50IGluZGV4LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkuQnVpbGRlciBidWlsZGVyRm9y\nVmFsdWUpIHsKICAgICAgICBpZiAoZW50cmllc0J1aWxkZXJfID09IG51bGwp\nIHsKICAgICAgICAgIGVuc3VyZUVudHJpZXNJc011dGFibGUoKTsKICAgICAg\nICAgIGVudHJpZXNfLmFkZChpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxk\nKCkpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIGVudHJpZXNCdWlsZGVyXy5hZGRNZXNzYWdlKGluZGV4LCBi\ndWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZEFs\nbEVudHJpZXMoCiAgICAgICAgICBqYXZhLmxhbmcuSXRlcmFibGU8PyBleHRl\nbmRzIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1hcC5FbnRyeT4gdmFsdWVzKSB7CiAgICAgICAgaWYgKGVudHJpZXNCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBlbnN1cmVFbnRyaWVzSXNNdXRh\nYmxlKCk7CiAgICAgICAgICBzdXBlci5hZGRBbGwodmFsdWVzLCBlbnRyaWVz\nXyk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgZW50cmllc0J1aWxkZXJfLmFkZEFsbE1lc3NhZ2VzKHZhbHVl\ncyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRW50cmllcygpIHsKICAgICAgICBp\nZiAoZW50cmllc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGVudHJp\nZXNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwogICAg\nICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEp\nOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgIGVudHJpZXNCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciByZW1vdmVFbnRyaWVzKGludCBpbmRleCkgewogICAgICAgIGlmIChlbnRy\naWVzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgZW5zdXJlRW50cmll\nc0lzTXV0YWJsZSgpOwogICAgICAgICAgZW50cmllc18ucmVtb3ZlKGluZGV4\nKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICBlbnRyaWVzQnVpbGRlcl8ucmVtb3ZlKGluZGV4KTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1h\ncC5FbnRyeS5CdWlsZGVyIGdldEVudHJpZXNCdWlsZGVyKAogICAgICAgICAg\naW50IGluZGV4KSB7CiAgICAgICAgcmV0dXJuIGdldEVudHJpZXNGaWVsZEJ1\naWxkZXIoKS5nZXRCdWlsZGVyKGluZGV4KTsKICAgICAgfQogICAgICBwdWJs\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWFwLkVudHJ5T3JCdWlsZGVyIGdldEVudHJpZXNPckJ1aWxkZXIoCiAgICAg\nICAgICBpbnQgaW5kZXgpIHsKICAgICAgICBpZiAoZW50cmllc0J1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBlbnRyaWVzXy5nZXQoaW5k\nZXgpOyAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBlbnRyaWVzQnVpbGRl\ncl8uZ2V0TWVzc2FnZU9yQnVpbGRlcihpbmRleCk7CiAgICAgICAgfQogICAg\nICB9CiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDw/IGV4dGVuZHMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVu\ndHJ5T3JCdWlsZGVyPiAKICAgICAgICAgICBnZXRFbnRyaWVzT3JCdWlsZGVy\nTGlzdCgpIHsKICAgICAgICBpZiAoZW50cmllc0J1aWxkZXJfICE9IG51bGwp\nIHsKICAgICAgICAgIHJldHVybiBlbnRyaWVzQnVpbGRlcl8uZ2V0TWVzc2Fn\nZU9yQnVpbGRlckxpc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\ncmV0dXJuIGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0\nKGVudHJpZXNfKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5F\nbnRyeS5CdWlsZGVyIGFkZEVudHJpZXNCdWlsZGVyKCkgewogICAgICAgIHJl\ndHVybiBnZXRFbnRyaWVzRmllbGRCdWlsZGVyKCkuYWRkQnVpbGRlcigKICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwLkVudHJ5LmdldERlZmF1bHRJbnN0YW5jZSgpKTsKICAgICAg\nfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwLkVudHJ5LkJ1aWxkZXIgYWRkRW50cmllc0J1aWxk\nZXIoCiAgICAgICAgICBpbnQgaW5kZXgpIHsKICAgICAgICByZXR1cm4gZ2V0\nRW50cmllc0ZpZWxkQnVpbGRlcigpLmFkZEJ1aWxkZXIoCiAgICAgICAgICAg\nIGluZGV4LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NYXAuRW50cnkuZ2V0RGVmYXVsdEluc3RhbmNlKCkpOwogICAgICB9\nCiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnkuQnVpbGRlcj4g\nCiAgICAgICAgICAgZ2V0RW50cmllc0J1aWxkZXJMaXN0KCkgewogICAgICAg\nIHJldHVybiBnZXRFbnRyaWVzRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlckxp\nc3QoKTsKICAgICAgfQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9i\ndWYuUmVwZWF0ZWRGaWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuRW50cnksIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5F\nbnRyeS5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NYXAuRW50cnlPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0\nRW50cmllc0ZpZWxkQnVpbGRlcigpIHsKICAgICAgICBpZiAoZW50cmllc0J1\naWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGVudHJpZXNCdWlsZGVyXyA9\nIG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlJlcGVhdGVkRmllbGRCdWlsZGVy\nPAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1hcC5FbnRyeSwgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5LkJ1aWxkZXIsIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5FbnRy\neU9yQnVpbGRlcj4oCiAgICAgICAgICAgICAgICAgIGVudHJpZXNfLAogICAg\nICAgICAgICAgICAgICAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAw\neDAwMDAwMDAxKSwKICAgICAgICAgICAgICAgICAgZ2V0UGFyZW50Rm9yQ2hp\nbGRyZW4oKSwKICAgICAgICAgICAgICAgICAgaXNDbGVhbigpKTsKICAgICAg\nICAgIGVudHJpZXNfID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGVudHJpZXNCdWlsZGVyXzsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBw\ncm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLk1h\ncCkKICAgIH0KICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3Rh\nbmNlID0gbmV3IE1hcCh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmlu\naXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0\naW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5NYXApCiAgfQogIAogIHB1\nYmxpYyBpbnRlcmZhY2UgTWVzc2FnZUhlYWRlck9yQnVpbGRlcgogICAgICBl\neHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7\nCiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWFwIHByb3BlcnRpZXMg\nPSAxOwogICAgYm9vbGVhbiBoYXNQcm9wZXJ0aWVzKCk7CiAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAgZ2V0UHJv\ncGVydGllcygpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwT3JCdWlsZGVyIGdldFByb3BlcnRpZXNPckJ1aWxk\nZXIoKTsKICAgIAogICAgLy8gb3B0aW9uYWwgc3RyaW5nIG1lc3NhZ2VUeXBl\nID0gMjsKICAgIGJvb2xlYW4gaGFzTWVzc2FnZVR5cGUoKTsKICAgIFN0cmlu\nZyBnZXRNZXNzYWdlVHlwZSgpOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGNsYXNzIE1lc3NhZ2VIZWFkZXIgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVtZW50cyBN\nZXNzYWdlSGVhZGVyT3JCdWlsZGVyIHsKICAgIC8vIFVzZSBNZXNzYWdlSGVh\nZGVyLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIE1l\nc3NhZ2VIZWFkZXIoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1\naWxkZXIpOwogICAgfQogICAgcHJpdmF0ZSBNZXNzYWdlSGVhZGVyKGJvb2xl\nYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBN\nZXNzYWdlSGVhZGVyIGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0\naWMgTWVzc2FnZUhlYWRlciBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAg\nIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBNZXNzYWdlSGVhZGVyIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7\nCiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsK\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZUhlYWRl\ncl9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JU\nYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkg\newogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNzYWdlSGVh\nZGVyX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0KICAgIAogICAgcHJpdmF0\nZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWFw\nIHByb3BlcnRpZXMgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nUFJPUEVSVElFU19GSUVMRF9OVU1CRVIgPSAxOwogICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAgcHJv\ncGVydGllc187CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNQcm9wZXJ0aWVzKCkg\newogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIGdldFByb3BlcnRpZXMo\nKSB7CiAgICAgIHJldHVybiBwcm9wZXJ0aWVzXzsKICAgIH0KICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nYXBPckJ1aWxkZXIgZ2V0UHJvcGVydGllc09yQnVpbGRlcigpIHsKICAgICAg\ncmV0dXJuIHByb3BlcnRpZXNfOwogICAgfQogICAgCiAgICAvLyBvcHRpb25h\nbCBzdHJpbmcgbWVzc2FnZVR5cGUgPSAyOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgTUVTU0FHRVRZUEVfRklFTERfTlVNQkVSID0gMjsKICAgIHBy\naXZhdGUgamF2YS5sYW5nLk9iamVjdCBtZXNzYWdlVHlwZV87CiAgICBwdWJs\naWMgYm9vbGVhbiBoYXNNZXNzYWdlVHlwZSgpIHsKICAgICAgcmV0dXJuICgo\nYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAg\nfQogICAgcHVibGljIFN0cmluZyBnZXRNZXNzYWdlVHlwZSgpIHsKICAgICAg\namF2YS5sYW5nLk9iamVjdCByZWYgPSBtZXNzYWdlVHlwZV87CiAgICAgIGlm\nIChyZWYgaW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICByZXR1cm4gKFN0\ncmluZykgcmVmOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBicyA9IAogICAgICAgICAgICAoY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7CiAgICAgICAgU3RyaW5n\nIHMgPSBicy50b1N0cmluZ1V0ZjgoKTsKICAgICAgICBpZiAoY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnRlcm5hbC5pc1ZhbGlkVXRmOChicykpIHsKICAgICAg\nICAgIG1lc3NhZ2VUeXBlXyA9IHM7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBzOwogICAgICB9CiAgICB9CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBnZXRNZXNzYWdlVHlwZUJ5dGVzKCkgewogICAg\nICBqYXZhLmxhbmcuT2JqZWN0IHJlZiA9IG1lc3NhZ2VUeXBlXzsKICAgICAg\naWYgKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBiID0gCiAgICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoKFN0cmlu\nZykgcmVmKTsKICAgICAgICBtZXNzYWdlVHlwZV8gPSBiOwogICAgICAgIHJl\ndHVybiBiOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAoY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWY7CiAgICAgIH0KICAgIH0K\nICAgIAogICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIHBy\nb3BlcnRpZXNfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWFwLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBtZXNz\nYWdlVHlwZV8gPSAiIjsKICAgIH0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXpl\nZElzSW5pdGlhbGl6ZWQgPSAtMTsKICAgIHB1YmxpYyBmaW5hbCBib29sZWFu\nIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9\nIG1lbW9pemVkSXNJbml0aWFsaXplZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6\nZWQgIT0gLTEpIHJldHVybiBpc0luaXRpYWxpemVkID09IDE7CiAgICAgIAog\nICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAg\nICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDEsIHByb3BlcnRpZXNfKTsKICAg\nICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0g\nMHgwMDAwMDAwMikpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBn\nZXRNZXNzYWdlVHlwZUJ5dGVzKCkpOwogICAgICB9CiAgICAgIGdldFVua25v\nd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1\nYmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXpl\nID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0g\nLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBp\nZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkp\nIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRP\ndXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUoMSwg\ncHJvcGVydGllc18pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAgIHNpemUg\nKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAg\nICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMiwgZ2V0TWVzc2FnZVR5cGVCeXRl\ncygpKTsKICAgICAgfQogICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMo\nKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNlcmlhbGl6\nZWRTaXplID0gc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJ\nRCA9IDBMOwogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVk\nIGphdmEubGFuZy5PYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICByZXR1\ncm4gc3VwZXIud3JpdGVSZXBsYWNlKCk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZUhlYWRlciBwYXJzZUZyb20oCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAgdGhyb3dz\nIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\nZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZUhlYWRlciBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlSGVhZGVyIHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlSGVhZGVyIHBhcnNlRnJvbSgKICAgICAgICBieXRlW10g\nZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIg\ncGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAg\nIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhlYWRlciBwYXJzZUZyb20oCiAg\nICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0\nLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIgcGFy\nc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWls\nZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVy\nLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkpIHsKICAgICAgICByZXR1cm4g\nYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAg\nIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VIZWFkZXIgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgIGphdmEu\naW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBC\ndWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWls\nZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0\ncnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsK\nICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyIHBhcnNlRnJvbSgK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0g\naW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhlYWRl\nciBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIAogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7\nIHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOyB9CiAgICBwdWJsaWMgQnVpbGRl\nciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsg\nfQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhl\nYWRlciBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1YmxpYyBCdWlsZGVy\nIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7IH0KICAg\nIAogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIEJ1aWxk\nZXIgbmV3QnVpbGRlckZvclR5cGUoCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7\nCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7\nCiAgICAgIHJldHVybiBidWlsZGVyOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVy\nPgogICAgICAgaW1wbGVtZW50cyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyT3JCdWlsZGVyIHsKICAg\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3Io\nKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2Fn\nZUhlYWRlcl9kZXNjcmlwdG9yOwogICAgICB9CiAgICAgIAogICAgICBwcm90\nZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFj\nY2Vzc29yVGFibGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19I\nZWR3aWdfTWVzc2FnZUhlYWRlcl9maWVsZEFjY2Vzc29yVGFibGU7CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVy\nLm5ld0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7CiAgICAg\nICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9\nCiAgICAgIAogICAgICBwcml2YXRlIEJ1aWxkZXIoQnVpbGRlclBhcmVudCBw\nYXJlbnQpIHsKICAgICAgICBzdXBlcihwYXJlbnQpOwogICAgICAgIG1heWJl\nRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICBw\ncml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigp\nIHsKICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRN\nZXNzYWdlLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsKICAgICAgICAgIGdl\ndFByb3BlcnRpZXNGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFy\nKCk7CiAgICAgICAgaWYgKHByb3BlcnRpZXNCdWlsZGVyXyA9PSBudWxsKSB7\nCiAgICAgICAgICBwcm9wZXJ0aWVzXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHJvcGVydGllc0J1aWxk\nZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAo\nYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBtZXNzYWdlVHlw\nZV8gPSAiIjsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+\nMHgwMDAwMDAwMik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJl\ndHVybiBjcmVhdGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9y\nRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhlYWRlci5nZXREZXNj\ncmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVh\nZGVyIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0\ndXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VIZWFkZXIuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyIGJ1aWxkKCkgewogICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VIZWFkZXIgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAgICAg\nICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0\naHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAg\nICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIgYnVpbGRQYXJzZWQoKQog\nICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyIHJl\nc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0Lmlz\nSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFs\naXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJlc3VsdCkuYXNJ\nbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VIZWFkZXIgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VI\nZWFkZXIgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIodGhpcyk7CiAgICAgICAg\naW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87CiAgICAgICAgaW50\nIHRvX2JpdEZpZWxkMF8gPSAwOwogICAgICAgIGlmICgoKGZyb21fYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAg\nICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgfQogICAg\nICAgIGlmIChwcm9wZXJ0aWVzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgcmVzdWx0LnByb3BlcnRpZXNfID0gcHJvcGVydGllc187CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdC5wcm9wZXJ0aWVzXyA9IHByb3Bl\ncnRpZXNCdWlsZGVyXy5idWlsZCgpOwogICAgICAgIH0KICAgICAgICBpZiAo\nKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAy\nKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwog\nICAgICAgIH0KICAgICAgICByZXN1bHQubWVzc2FnZVR5cGVfID0gbWVzc2Fn\nZVR5cGVfOwogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0Rmll\nbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VG\ncm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAg\nICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIpIHsKICAgICAg\nICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIpb3RoZXIpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIp\nOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhlYWRl\nciBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyLmdl\ndERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAo\nb3RoZXIuaGFzUHJvcGVydGllcygpKSB7CiAgICAgICAgICBtZXJnZVByb3Bl\ncnRpZXMob3RoZXIuZ2V0UHJvcGVydGllcygpKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKG90aGVyLmhhc01lc3NhZ2VUeXBlKCkpIHsKICAgICAgICAgIHNl\ndE1lc3NhZ2VUeXBlKG90aGVyLmdldE1lc3NhZ2VUeXBlKCkpOwogICAgICAg\nIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci5nZXRV\nbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIAogICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxp\nemVkKCkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVu\na25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVp\nbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwog\nICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0gaW5w\ndXQucmVhZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAg\nICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZp\nZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgIG9u\nQ2hhbmdlZCgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25v\nd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcp\nKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5r\nbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGNhc2UgMTA6IHsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuQnVpbGRlciBzdWJC\ndWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICBpZiAoaGFz\nUHJvcGVydGllcygpKSB7CiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1l\ncmdlRnJvbShnZXRQcm9wZXJ0aWVzKCkpOwogICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRl\nbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0UHJvcGVydGllcyhz\ndWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDE4OiB7CiAgICAg\nICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwogICAgICAgICAg\nICAgIG1lc3NhZ2VUeXBlXyA9IGlucHV0LnJlYWRCeXRlcygpOwogICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBiaXRGaWVs\nZDBfOwogICAgICAKICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5NYXAgcHJv\ncGVydGllcyA9IDE7CiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIHByb3BlcnRpZXNfID0gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLmdl\ndERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUu\ncHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuQnVp\nbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWFwT3JCdWlsZGVyPiBwcm9wZXJ0aWVzQnVpbGRlcl87CiAgICAgIHB1\nYmxpYyBib29sZWFuIGhhc1Byb3BlcnRpZXMoKSB7CiAgICAgICAgcmV0dXJu\nICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwog\nICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NYXAgZ2V0UHJvcGVydGllcygpIHsKICAgICAg\nICBpZiAocHJvcGVydGllc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAg\nIHJldHVybiBwcm9wZXJ0aWVzXzsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgcmV0dXJuIHByb3BlcnRpZXNCdWlsZGVyXy5nZXRNZXNzYWdlKCk7CiAg\nICAgICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFByb3Bl\ncnRpZXMob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWFwIHZhbHVlKSB7CiAgICAgICAgaWYgKHByb3BlcnRpZXNCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsK\nICAgICAgICAgIH0KICAgICAgICAgIHByb3BlcnRpZXNfID0gdmFsdWU7CiAg\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgcHJvcGVydGllc0J1aWxkZXJfLnNldE1lc3NhZ2UodmFsdWUpOwogICAg\nICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0UHJvcGVydGllcygKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5CdWlsZGVyIGJ1aWxkZXJGb3JW\nYWx1ZSkgewogICAgICAgIGlmIChwcm9wZXJ0aWVzQnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgcHJvcGVydGllc18gPSBidWlsZGVyRm9yVmFsdWUu\nYnVpbGQoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICBwcm9wZXJ0aWVzQnVpbGRlcl8uc2V0TWVzc2FnZShi\ndWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgfQogICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZVByb3BlcnRpZXMo\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFw\nIHZhbHVlKSB7CiAgICAgICAgaWYgKHByb3BlcnRpZXNCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSkgJiYKICAgICAgICAgICAgICBwcm9wZXJ0aWVz\nXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NYXAuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAgICAgICAgICAgcHJv\ncGVydGllc18gPQogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5uZXdCdWlsZGVyKHByb3BlcnRp\nZXNfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJvcGVydGllc18gPSB2YWx1ZTsK\nICAgICAgICAgIH0KICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICBwcm9wZXJ0aWVzQnVpbGRlcl8ubWVyZ2VGcm9t\nKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAw\nMDAwMDAxOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIGNsZWFyUHJvcGVydGllcygpIHsKICAgICAgICBpZiAo\ncHJvcGVydGllc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHByb3Bl\ncnRpZXNfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb3BlcnRp\nZXNCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5CdWlsZGVyIGdldFBy\nb3BlcnRpZXNCdWlsZGVyKCkgewogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAwMTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4g\nZ2V0UHJvcGVydGllc0ZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXIoKTsKICAg\nICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWFwT3JCdWlsZGVyIGdldFByb3BlcnRpZXNPckJ1\naWxkZXIoKSB7CiAgICAgICAgaWYgKHByb3BlcnRpZXNCdWlsZGVyXyAhPSBu\ndWxsKSB7CiAgICAgICAgICByZXR1cm4gcHJvcGVydGllc0J1aWxkZXJfLmdl\ndE1lc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgcmV0dXJuIHByb3BlcnRpZXNfOwogICAgICAgIH0KICAgICAgfQogICAg\nICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWls\nZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NYXAuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwT3JCdWlsZGVyPiAKICAgICAg\nICAgIGdldFByb3BlcnRpZXNGaWVsZEJ1aWxkZXIoKSB7CiAgICAgICAgaWYg\nKHByb3BlcnRpZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBwcm9w\nZXJ0aWVzQnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5n\nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuQnVpbGRlciwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwT3JC\ndWlsZGVyPigKICAgICAgICAgICAgICAgICAgcHJvcGVydGllc18sCiAgICAg\nICAgICAgICAgICAgIGdldFBhcmVudEZvckNoaWxkcmVuKCksCiAgICAgICAg\nICAgICAgICAgIGlzQ2xlYW4oKSk7CiAgICAgICAgICBwcm9wZXJ0aWVzXyA9\nIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwcm9wZXJ0aWVzQnVp\nbGRlcl87CiAgICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIHN0cmlu\nZyBtZXNzYWdlVHlwZSA9IDI7CiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9i\namVjdCBtZXNzYWdlVHlwZV8gPSAiIjsKICAgICAgcHVibGljIGJvb2xlYW4g\naGFzTWVzc2FnZVR5cGUoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAgICB9CiAgICAg\nIHB1YmxpYyBTdHJpbmcgZ2V0TWVzc2FnZVR5cGUoKSB7CiAgICAgICAgamF2\nYS5sYW5nLk9iamVjdCByZWYgPSBtZXNzYWdlVHlwZV87CiAgICAgICAgaWYg\nKCEocmVmIGluc3RhbmNlb2YgU3RyaW5nKSkgewogICAgICAgICAgU3RyaW5n\nIHMgPSAoKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmKS50\nb1N0cmluZ1V0ZjgoKTsKICAgICAgICAgIG1lc3NhZ2VUeXBlXyA9IHM7CiAg\nICAgICAgICByZXR1cm4gczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\ncmV0dXJuIChTdHJpbmcpIHJlZjsKICAgICAgICB9CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgc2V0TWVzc2FnZVR5cGUoU3RyaW5nIHZhbHVlKSB7\nCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBO\ndWxsUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDI7CiAgICAgICAgbWVzc2FnZVR5cGVfID0gdmFsdWU7CiAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNZXNzYWdlVHlwZSgpIHsKICAg\nICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7\nCiAgICAgICAgbWVzc2FnZVR5cGVfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCku\nZ2V0TWVzc2FnZVR5cGUoKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICB2b2lkIHNldE1lc3NhZ2VU\neXBlKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewog\nICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICBtZXNz\nYWdlVHlwZV8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1\naWxkZXJfc2NvcGU6SGVkd2lnLk1lc3NhZ2VIZWFkZXIpCiAgICB9CiAgICAK\nICAgIHN0YXRpYyB7CiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBNZXNz\nYWdlSGVhZGVyKHRydWUpOwogICAgICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZp\nZWxkcygpOwogICAgfQogICAgCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25f\ncG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLk1lc3NhZ2VIZWFkZXIpCiAgfQog\nIAogIHB1YmxpYyBpbnRlcmZhY2UgTWVzc2FnZU9yQnVpbGRlcgogICAgICBl\neHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7\nCiAgICAKICAgIC8vIHJlcXVpcmVkIGJ5dGVzIGJvZHkgPSAxOwogICAgYm9v\nbGVhbiBoYXNCb2R5KCk7CiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcgZ2V0Qm9keSgpOwogICAgCiAgICAvLyBvcHRpb25hbCBieXRlcyBz\ncmNSZWdpb24gPSAyOwogICAgYm9vbGVhbiBoYXNTcmNSZWdpb24oKTsKICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTcmNSZWdpb24o\nKTsKICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5NZXNzYWdlU2VxSWQg\nbXNnSWQgPSAzOwogICAgYm9vbGVhbiBoYXNNc2dJZCgpOwogICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkIGdldE1zZ0lkKCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXIgZ2V0TXNn\nSWRPckJ1aWxkZXIoKTsKICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5N\nZXNzYWdlSGVhZGVyIGhlYWRlciA9IDQ7CiAgICBib29sZWFuIGhhc0hlYWRl\ncigpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZUhlYWRlciBnZXRIZWFkZXIoKTsKICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFk\nZXJPckJ1aWxkZXIgZ2V0SGVhZGVyT3JCdWlsZGVyKCk7CiAgfQogIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgY2xhc3MgTWVzc2FnZSBleHRlbmRzCiAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZQogICAgICBpbXBs\nZW1lbnRzIE1lc3NhZ2VPckJ1aWxkZXIgewogICAgLy8gVXNlIE1lc3NhZ2Uu\nbmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgTWVzc2Fn\nZShCdWlsZGVyIGJ1aWxkZXIpIHsKICAgICAgc3VwZXIoYnVpbGRlcik7CiAg\nICB9CiAgICBwcml2YXRlIE1lc3NhZ2UoYm9vbGVhbiBub0luaXQpIHt9CiAg\nICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE1lc3NhZ2UgZGVmYXVsdElu\nc3RhbmNlOwogICAgcHVibGljIHN0YXRpYyBNZXNzYWdlIGdldERlZmF1bHRJ\nbnN0YW5jZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAg\nIH0KICAgIAogICAgcHVibGljIE1lc3NhZ2UgZ2V0RGVmYXVsdEluc3RhbmNl\nRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAg\nIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNj\ncmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19N\nZXNzYWdlX2Rlc2NyaXB0b3I7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nl\nc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFi\nbGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3Nh\nZ2VfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgfQogICAgCiAgICBwcml2YXRl\nIGludCBiaXRGaWVsZDBfOwogICAgLy8gcmVxdWlyZWQgYnl0ZXMgYm9keSA9\nIDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBCT0RZX0ZJRUxEX05V\nTUJFUiA9IDE7CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBib2R5XzsKICAgIHB1YmxpYyBib29sZWFuIGhhc0JvZHkoKSB7\nCiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAw\neDAwMDAwMDAxKTsKICAgIH0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9keSgpIHsKICAgICAgcmV0dXJuIGJvZHlf\nOwogICAgfQogICAgCiAgICAvLyBvcHRpb25hbCBieXRlcyBzcmNSZWdpb24g\nPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1JDUkVHSU9OX0ZJ\nRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBzcmNSZWdpb25fOwogICAgcHVibGljIGJvb2xlYW4g\naGFzU3JjUmVnaW9uKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMik7CiAgICB9CiAgICBwdWJsaWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFNyY1JlZ2lvbigp\nIHsKICAgICAgcmV0dXJuIHNyY1JlZ2lvbl87CiAgICB9CiAgICAKICAgIC8v\nIG9wdGlvbmFsIC5IZWR3aWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMzsKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1TR0lEX0ZJRUxEX05VTUJFUiA9\nIDM7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBtc2dJZF87CiAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNNc2dJZCgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpOwogICAgfQogICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZCBnZXRNc2dJZCgpIHsKICAgICAgcmV0dXJuIG1zZ0lk\nXzsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXIgZ2V0TXNn\nSWRPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiBtc2dJZF87CiAgICB9CiAg\nICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWVzc2FnZUhlYWRlciBoZWFk\nZXIgPSA0OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgSEVBREVSX0ZJ\nRUxEX05VTUJFUiA9IDQ7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIgaGVhZGVy\nXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc0hlYWRlcigpIHsKICAgICAgcmV0\ndXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgp\nOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIgZ2V0SGVhZGVyKCkgewog\nICAgICByZXR1cm4gaGVhZGVyXzsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVh\nZGVyT3JCdWlsZGVyIGdldEhlYWRlck9yQnVpbGRlcigpIHsKICAgICAgcmV0\ndXJuIGhlYWRlcl87CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0\nRmllbGRzKCkgewogICAgICBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9idWYu\nQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgc3JjUmVnaW9uXyA9IGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgbXNnSWRfID0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBoZWFkZXJf\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZUhlYWRlci5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgIH0KICAg\nIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsKICAg\nIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAg\nIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXplZDsK\nICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgIT0gLTEpIHJldHVybiBpc0luaXRp\nYWxpemVkID09IDE7CiAgICAgIAogICAgICBpZiAoIWhhc0JvZHkoKSkgewog\nICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChoYXNNc2dJZCgpKSB7CiAg\nICAgICAgaWYgKCFnZXRNc2dJZCgpLmlzSW5pdGlhbGl6ZWQoKSkgewogICAg\nICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMDsKICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbWVtb2l6ZWRJ\nc0luaXRpYWxpemVkID0gMTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAgICAgICAg\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0\nU2VyaWFsaXplZFNpemUoKTsKICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgb3V0cHV0Lndy\naXRlQnl0ZXMoMSwgYm9keV8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAg\nIG91dHB1dC53cml0ZUJ5dGVzKDIsIHNyY1JlZ2lvbl8pOwogICAgICB9CiAg\nICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAw\nMDA0KSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMywgbXNnSWRf\nKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nOCkgPT0gMHgwMDAwMDAwOCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVNZXNz\nYWdlKDQsIGhlYWRlcl8pOwogICAgICB9CiAgICAgIGdldFVua25vd25GaWVs\nZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\naW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBp\nbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXplID0gbWVt\nb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJl\ndHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBpZiAoKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAg\nICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDEsIGJvZHlfKTsK\nICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMikg\nPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRl\nQnl0ZXNTaXplKDIsIHNyY1JlZ2lvbl8pOwogICAgICB9CiAgICAgIGlmICgo\nKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAwMDA0KSkgewog\nICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1\ndFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSgzLCBtc2dJ\nZF8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDA4KSA9PSAweDAwMDAwMDA4KSkgewogICAgICAgIHNpemUgKz0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNv\nbXB1dGVNZXNzYWdlU2l6ZSg0LCBoZWFkZXJfKTsKICAgICAgfQogICAgICBz\naXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgp\nOwogICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAg\ncmV0dXJuIHNpemU7CiAgICB9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOwogICAgQGphdmEubGFu\nZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIGphdmEubGFuZy5PYmplY3Qgd3Jp\ndGVSZXBsYWNlKCkKICAgICAgICB0aHJvd3MgamF2YS5pby5PYmplY3RTdHJl\nYW1FeGNlcHRpb24gewogICAgICByZXR1cm4gc3VwZXIud3JpdGVSZXBsYWNl\nKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZy\nb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRh\ndGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxp\nZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZyb20oCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlIHBhcnNlRnJvbShieXRlW10gZGF0YSkK\nICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJv\ndG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlIHBhcnNlRnJvbSgKICAgICAgICBieXRlW10g\nZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcGFyc2VG\ncm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAg\nIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZyb20oCiAgICAgICAgamF2YS5p\nby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcGFyc2VEZWxpbWl0ZWRGcm9tKGph\ndmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdC\ndWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJv\nbShpbnB1dCkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNl\nZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAg\nICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcGFyc2VEZWxpbWl0\nZWRGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWls\nZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShp\nbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1\naWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZSBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQo\nKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1\naWxkZXIoKSB7IHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOyB9CiAgICBwdWJs\naWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1\naWxkZXIoKTsgfQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxk\nZXIob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZSBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1YmxpYyBCdWls\nZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7IH0K\nICAgIAogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIEJ1\naWxkZXIgbmV3QnVpbGRlckZvclR5cGUoCiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXJQYXJlbnQgcGFyZW50\nKSB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVu\ndCk7CiAgICAgIHJldHVybiBidWlsZGVyOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWls\nZGVyPgogICAgICAgaW1wbGVtZW50cyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlT3JCdWlsZGVyIHsKICAgICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2Ny\naXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7\nCiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZV9k\nZXNjcmlwdG9yOwogICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0ZWQgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFi\nbGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWVz\nc2FnZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICAgIH0KICAgICAgCiAgICAg\nIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLm5ld0J1aWxkZXIoKQogICAgICBw\ncml2YXRlIEJ1aWxkZXIoKSB7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJ\nbml0aWFsaXphdGlvbigpOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRl\nIEJ1aWxkZXIoQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgICBzdXBl\ncihwYXJlbnQpOwogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6\nYXRpb24oKTsKICAgICAgfQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3Jj\nZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsKICAgICAgICBpZiAoY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLmFsd2F5c1VzZUZpZWxk\nQnVpbGRlcnMpIHsKICAgICAgICAgIGdldE1zZ0lkRmllbGRCdWlsZGVyKCk7\nCiAgICAgICAgICBnZXRIZWFkZXJGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9\nCiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUo\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1\ncGVyLmNsZWFyKCk7CiAgICAgICAgYm9keV8gPSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICAgICAgYml0RmllbGQwXyA9IChi\naXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgIHNyY1JlZ2lvbl8g\nPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICAg\nICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOwog\nICAgICAgIGlmIChtc2dJZEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAg\nIG1zZ0lkXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgbXNnSWRCdWlsZGVyXy5jbGVhcigp\nOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8g\nJiB+MHgwMDAwMDAwNCk7CiAgICAgICAgaWYgKGhlYWRlckJ1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIGhlYWRlcl8gPSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyLmdldERl\nZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBo\nZWFkZXJCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwOCk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZy\nb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZS5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7\nCiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIGJ1aWxkKCkgewogICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYg\nKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBu\nZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAog\nICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2UgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhy\nb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVy\nRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIHJlc3VsdCA9IGJ1aWxkUGFydGlh\nbCgpOwogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewog\nICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRp\nb24oCiAgICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZm\nZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgYnVpbGRQYXJ0\naWFsKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2UgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UodGhpcyk7\nCiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87CiAg\nICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOwogICAgICAgIGlmICgoKGZy\nb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7\nCiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAg\nICAgfQogICAgICAgIHJlc3VsdC5ib2R5XyA9IGJvZHlfOwogICAgICAgIGlm\nICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAw\nMDIpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7\nCiAgICAgICAgfQogICAgICAgIHJlc3VsdC5zcmNSZWdpb25fID0gc3JjUmVn\naW9uXzsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAw\nMDA0KSA9PSAweDAwMDAwMDA0KSkgewogICAgICAgICAgdG9fYml0RmllbGQw\nXyB8PSAweDAwMDAwMDA0OwogICAgICAgIH0KICAgICAgICBpZiAobXNnSWRC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZXN1bHQubXNnSWRfID0g\nbXNnSWRfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQubXNn\nSWRfID0gbXNnSWRCdWlsZGVyXy5idWlsZCgpOwogICAgICAgIH0KICAgICAg\nICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAw\nMDAwMDA4KSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAw\nMDA4OwogICAgICAgIH0KICAgICAgICBpZiAoaGVhZGVyQnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgcmVzdWx0LmhlYWRlcl8gPSBoZWFkZXJfOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQuaGVhZGVyXyA9IGhl\nYWRlckJ1aWxkZXJfLmJ1aWxkKCk7CiAgICAgICAgfQogICAgICAgIHJlc3Vs\ndC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsKICAgICAgICBvbkJ1aWx0\nKCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9i\ndWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5j\nZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UpIHsKICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2Up\nb3RoZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdXBlci5tZXJn\nZUZyb20ob3RoZXIpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nfQogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZy\nb20ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdl\ndERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAo\nb3RoZXIuaGFzQm9keSgpKSB7CiAgICAgICAgICBzZXRCb2R5KG90aGVyLmdl\ndEJvZHkoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNTcmNS\nZWdpb24oKSkgewogICAgICAgICAgc2V0U3JjUmVnaW9uKG90aGVyLmdldFNy\nY1JlZ2lvbigpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc01z\nZ0lkKCkpIHsKICAgICAgICAgIG1lcmdlTXNnSWQob3RoZXIuZ2V0TXNnSWQo\nKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNIZWFkZXIoKSkg\newogICAgICAgICAgbWVyZ2VIZWFkZXIob3RoZXIuZ2V0SGVhZGVyKCkpOwog\nICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhl\nci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0lu\naXRpYWxpemVkKCkgewogICAgICAgIGlmICghaGFzQm9keSgpKSB7CiAgICAg\nICAgICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAg\nICAgaWYgKGhhc01zZ0lkKCkpIHsKICAgICAgICAgIGlmICghZ2V0TXNnSWQo\nKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgICAgCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1\naWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAg\nICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRy\ndWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAg\nICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAg\nICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVs\nZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsK\nICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1\nbmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAg\nICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxk\nKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxMDog\newogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAg\nICAgICAgICAgICBib2R5XyA9IGlucHV0LnJlYWRCeXRlcygpOwogICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2Ug\nMTg6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7\nCiAgICAgICAgICAgICAgc3JjUmVnaW9uXyA9IGlucHV0LnJlYWRCeXRlcygp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgMjY6IHsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRl\nciBzdWJCdWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIoKTsKICAgICAg\nICAgICAgICBpZiAoaGFzTXNnSWQoKSkgewogICAgICAgICAgICAgICAgc3Vi\nQnVpbGRlci5tZXJnZUZyb20oZ2V0TXNnSWQoKSk7CiAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIs\nIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRNc2dJZChz\ndWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDM0OiB7CiAgICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZUhlYWRlci5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nSGVhZGVyLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICBpZiAoaGFzSGVh\nZGVyKCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9t\nKGdldEhlYWRlcigpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\naW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0\ncnkpOwogICAgICAgICAgICAgIHNldEhlYWRlcihzdWJCdWlsZGVyLmJ1aWxk\nUGFydGlhbCgpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAg\ncHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgICAgCiAgICAgIC8vIHJlcXVp\ncmVkIGJ5dGVzIGJvZHkgPSAxOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBib2R5XyA9IGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFz\nQm9keSgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAgICAgcHVibGljIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRCb2R5KCkgewogICAg\nICAgIHJldHVybiBib2R5XzsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRCb2R5KGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1\nZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBu\nZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICB9CiAgYml0RmllbGQwXyB8\nPSAweDAwMDAwMDAxOwogICAgICAgIGJvZHlfID0gdmFsdWU7CiAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xlYXJCb2R5KCkgewogICAgICAgIGJpdEZp\nZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBi\nb2R5XyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEJvZHkoKTsKICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICAKICAgICAgLy8gb3B0aW9uYWwgYnl0ZXMgc3JjUmVnaW9uID0gMjsK\nICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nc3JjUmVnaW9uXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5F\nTVBUWTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzU3JjUmVnaW9uKCkgewog\nICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAw\neDAwMDAwMDAyKTsKICAgICAgfQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIGdldFNyY1JlZ2lvbigpIHsKICAgICAgICBy\nZXR1cm4gc3JjUmVnaW9uXzsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRTcmNSZWdpb24oY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRo\ncm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICBiaXRGaWVs\nZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgc3JjUmVnaW9uXyA9IHZhbHVl\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3JjUmVnaW9uKCkg\newogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAw\nMDAyKTsKICAgICAgICBzcmNSZWdpb25fID0gZ2V0RGVmYXVsdEluc3RhbmNl\nKCkuZ2V0U3JjUmVnaW9uKCk7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlv\nbmFsIC5IZWR3aWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMzsKICAgICAgcHJp\ndmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQgbXNnSWRfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJ\nbnN0YW5jZSgpOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYu\nU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkT3JCdWlsZGVyPiBtc2dJZEJ1aWxk\nZXJfOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNNc2dJZCgpIHsKICAgICAg\nICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAw\nMDAwNCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRNc2dJ\nZCgpIHsKICAgICAgICBpZiAobXNnSWRCdWlsZGVyXyA9PSBudWxsKSB7CiAg\nICAgICAgICByZXR1cm4gbXNnSWRfOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICByZXR1cm4gbXNnSWRCdWlsZGVyXy5nZXRNZXNzYWdlKCk7CiAgICAg\nICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1zZ0lkKG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZCB2YWx1ZSkgewogICAgICAgIGlmIChtc2dJZEJ1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAg\nICAgICAgfQogICAgICAgICAgbXNnSWRfID0gdmFsdWU7CiAgICAgICAgICBv\nbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbXNnSWRC\ndWlsZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAg\nYml0RmllbGQwXyB8PSAweDAwMDAwMDA0OwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1zZ0lkKAogICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAg\nICAgICAgaWYgKG1zZ0lkQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\nbXNnSWRfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgICBv\nbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbXNnSWRC\ndWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsK\nICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDA0Owog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlTXNnSWQob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHZhbHVlKSB7CiAgICAgICAgaWYg\nKG1zZ0lkQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKCgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpICYmCiAgICAg\nICAgICAgICAgbXNnSWRfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFu\nY2UoKSkgewogICAgICAgICAgICBtc2dJZF8gPQogICAgICAgICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZC5uZXdCdWlsZGVyKG1zZ0lkXykubWVyZ2VGcm9tKHZhbHVlKS5i\ndWlsZFBhcnRpYWwoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIG1zZ0lkXyA9IHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1zZ0lkQnVpbGRl\ncl8ubWVyZ2VGcm9tKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0Rmll\nbGQwXyB8PSAweDAwMDAwMDA0OwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTXNnSWQoKSB7CiAgICAg\nICAgaWYgKG1zZ0lkQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgbXNn\nSWRfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1z\nZ0lkQnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0Rmll\nbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDQpOwogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVp\nbGRlciBnZXRNc2dJZEJ1aWxkZXIoKSB7CiAgICAgICAgYml0RmllbGQwXyB8\nPSAweDAwMDAwMDA0OwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJl\ndHVybiBnZXRNc2dJZEZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXIoKTsKICAg\nICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkT3JCdWlsZGVyIGdldE1zZ0lk\nT3JCdWlsZGVyKCkgewogICAgICAgIGlmIChtc2dJZEJ1aWxkZXJfICE9IG51\nbGwpIHsKICAgICAgICAgIHJldHVybiBtc2dJZEJ1aWxkZXJfLmdldE1lc3Nh\nZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0\ndXJuIG1zZ0lkXzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBj\nb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxkZXIsIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9y\nQnVpbGRlcj4gCiAgICAgICAgICBnZXRNc2dJZEZpZWxkQnVpbGRlcigpIHsK\nICAgICAgICBpZiAobXNnSWRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAg\nICBtc2dJZEJ1aWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuU2lu\nZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlcj4oCiAgICAgICAg\nICAgICAgICAgIG1zZ0lkXywKICAgICAgICAgICAgICAgICAgZ2V0UGFyZW50\nRm9yQ2hpbGRyZW4oKSwKICAgICAgICAgICAgICAgICAgaXNDbGVhbigpKTsK\nICAgICAgICAgIG1zZ0lkXyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBtc2dJZEJ1aWxkZXJfOwogICAgICB9CiAgICAgIAogICAgICAvLyBv\ncHRpb25hbCAuSGVkd2lnLk1lc3NhZ2VIZWFkZXIgaGVhZGVyID0gNDsKICAg\nICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlSGVhZGVyIGhlYWRlcl8gPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyLmdl\ndERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUu\ncHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhl\nYWRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZUhlYWRlci5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyT3JCdWlsZGVy\nPiBoZWFkZXJCdWlsZGVyXzsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzSGVh\nZGVyKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDA4KSA9PSAweDAwMDAwMDA4KTsKICAgICAgfQogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZUhlYWRlciBnZXRIZWFkZXIoKSB7CiAgICAgICAgaWYgKGhlYWRlckJ1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBoZWFkZXJfOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gaGVhZGVyQnVpbGRlcl8u\nZ2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRIZWFkZXIob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhlYWRlciB2YWx1ZSkgewogICAgICAg\nIGlmIChoZWFkZXJCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAo\ndmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBv\naW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIGhlYWRl\ncl8gPSB2YWx1ZTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICBoZWFkZXJCdWlsZGVyXy5zZXRNZXNzYWdlKHZh\nbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDA4OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIHNldEhlYWRlcigKICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIuQnVp\nbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAoaGVhZGVyQnVp\nbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaGVhZGVyXyA9IGJ1aWxkZXJG\nb3JWYWx1ZS5idWlsZCgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIGhlYWRlckJ1aWxkZXJfLnNldE1lc3Nh\nZ2UoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAg\nICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VIZWFkZXIo\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZUhlYWRlciB2YWx1ZSkgewogICAgICAgIGlmIChoZWFkZXJCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCkgJiYKICAgICAgICAgICAgICBoZWFk\nZXJfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VIZWFkZXIuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAg\nICAgICAgICAgaGVhZGVyXyA9CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZUhlYWRlci5u\nZXdCdWlsZGVyKGhlYWRlcl8pLm1lcmdlRnJvbSh2YWx1ZSkuYnVpbGRQYXJ0\naWFsKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBoZWFkZXJf\nID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQoKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgaGVhZGVyQnVpbGRlcl8ubWVy\nZ2VGcm9tKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8\nPSAweDAwMDAwMDA4OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFySGVhZGVyKCkgewogICAgICAgIGlm\nIChoZWFkZXJCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBoZWFkZXJf\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZUhlYWRlci5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoZWFk\nZXJCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwOCk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIuQnVp\nbGRlciBnZXRIZWFkZXJCdWlsZGVyKCkgewogICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwODsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICBy\nZXR1cm4gZ2V0SGVhZGVyRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigpOwog\nICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyT3JCdWlsZGVyIGdldEhl\nYWRlck9yQnVpbGRlcigpIHsKICAgICAgICBpZiAoaGVhZGVyQnVpbGRlcl8g\nIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGhlYWRlckJ1aWxkZXJfLmdl\ndE1lc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgcmV0dXJuIGhlYWRlcl87CiAgICAgICAgfQogICAgICB9CiAgICAgIHBy\naXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8\nCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlSGVhZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlSGVhZGVyLkJ1aWxkZXIsIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VIZWFkZXJPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0SGVhZGVyRmllbGRC\ndWlsZGVyKCkgewogICAgICAgIGlmIChoZWFkZXJCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICBoZWFkZXJCdWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xl\nLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAgICAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlSGVhZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlSGVhZGVyLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXJPckJ1\naWxkZXI+KAogICAgICAgICAgICAgICAgICBoZWFkZXJfLAogICAgICAgICAg\nICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLAogICAgICAgICAgICAg\nICAgICBpc0NsZWFuKCkpOwogICAgICAgICAgaGVhZGVyXyA9IG51bGw7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBoZWFkZXJCdWlsZGVyXzsKICAgICAg\nfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1\naWxkZXJfc2NvcGU6SGVkd2lnLk1lc3NhZ2UpCiAgICB9CiAgICAKICAgIHN0\nYXRpYyB7CiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBNZXNzYWdlKHRy\ndWUpOwogICAgICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAg\nfQogICAgCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nf\nc2NvcGU6SGVkd2lnLk1lc3NhZ2UpCiAgfQogIAogIHB1YmxpYyBpbnRlcmZh\nY2UgUmVnaW9uU3BlY2lmaWNTZXFJZE9yQnVpbGRlcgogICAgICBleHRlbmRz\nIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7CiAgICAK\nICAgIC8vIHJlcXVpcmVkIGJ5dGVzIHJlZ2lvbiA9IDE7CiAgICBib29sZWFu\nIGhhc1JlZ2lvbigpOwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nIGdldFJlZ2lvbigpOwogICAgCiAgICAvLyByZXF1aXJlZCB1aW50NjQg\nc2VxSWQgPSAyOwogICAgYm9vbGVhbiBoYXNTZXFJZCgpOwogICAgbG9uZyBn\nZXRTZXFJZCgpOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFJl\nZ2lvblNwZWNpZmljU2VxSWQgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVtZW50cyBSZWdp\nb25TcGVjaWZpY1NlcUlkT3JCdWlsZGVyIHsKICAgIC8vIFVzZSBSZWdpb25T\ncGVjaWZpY1NlcUlkLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBw\ncml2YXRlIFJlZ2lvblNwZWNpZmljU2VxSWQoQnVpbGRlciBidWlsZGVyKSB7\nCiAgICAgIHN1cGVyKGJ1aWxkZXIpOwogICAgfQogICAgcHJpdmF0ZSBSZWdp\nb25TcGVjaWZpY1NlcUlkKGJvb2xlYW4gbm9Jbml0KSB7fQogICAgCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBSZWdpb25TcGVjaWZpY1NlcUlkIGRlZmF1\nbHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgUmVnaW9uU3BlY2lmaWNT\nZXFJZCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZh\ndWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBSZWdpb25TcGVj\naWZpY1NlcUlkIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAg\nIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAg\ncmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfUmVnaW9uU3BlY2lmaWNTZXFJ\nZF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JU\nYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkg\newogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19SZWdpb25TcGVj\naWZpY1NlcUlkX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0KICAgIAogICAg\ncHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIHJlcXVpcmVkIGJ5dGVz\nIHJlZ2lvbiA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSRUdJ\nT05fRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIHJlZ2lvbl87CiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNSZWdpb24oKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAw\neDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgIH0KICAgIHB1YmxpYyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0UmVnaW9uKCkgewog\nICAgICByZXR1cm4gcmVnaW9uXzsKICAgIH0KICAgIAogICAgLy8gcmVxdWly\nZWQgdWludDY0IHNlcUlkID0gMjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\naW50IFNFUUlEX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRlIGxvbmcg\nc2VxSWRfOwogICAgcHVibGljIGJvb2xlYW4gaGFzU2VxSWQoKSB7CiAgICAg\nIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAw\nMDAyKTsKICAgIH0KICAgIHB1YmxpYyBsb25nIGdldFNlcUlkKCkgewogICAg\nICByZXR1cm4gc2VxSWRfOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQg\naW5pdEZpZWxkcygpIHsKICAgICAgcmVnaW9uXyA9IGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgc2VxSWRfID0gMEw7CiAg\nICB9CiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0g\nLTE7CiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkg\newogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlh\nbGl6ZWQ7CiAgICAgIGlmIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4g\naXNJbml0aWFsaXplZCA9PSAxOwogICAgICAKICAgICAgaWYgKCFoYXNSZWdp\nb24oKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICghaGFzU2Vx\nSWQoKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIG1lbW9pemVkSXNJ\nbml0aWFsaXplZCA9IDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNl\ncmlhbGl6ZWRTaXplKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0\nZUJ5dGVzKDEsIHJlZ2lvbl8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAg\nIG91dHB1dC53cml0ZVVJbnQ2NCgyLCBzZXFJZF8pOwogICAgICB9CiAgICAg\nIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAt\nMTsKICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAg\nIGludCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYg\nKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAw\nOwogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgw\nMDAwMDAwMSkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNT\naXplKDEsIHJlZ2lvbl8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAgIHNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgLmNvbXB1dGVVSW50NjRTaXplKDIsIHNlcUlkXyk7CiAgICAg\nIH0KICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFs\naXplZFNpemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNp\nemU7CiAgICAgIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAg\nIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcu\nT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nT2JqZWN0U3RyZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndy\naXRlUmVwbGFjZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lv\nblNwZWNpZmljU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEp\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNw\nZWNpZmljU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEp\nCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAg\nIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBwYXJzZUZyb20oCiAg\nICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5S\nZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQp\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNw\nZWNpZmljU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRGVsaW1pdGVkRnJv\nbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0g\nbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRl\nZEZyb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0\nZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBi\ndWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJn\nZURlbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewog\nICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0g\nZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAg\nIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBwYXJzZUZyb20oCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlu\ncHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmlj\nU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVy\nKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1\naWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVy\nKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lv\nblNwZWNpZmljU2VxSWQgcHJvdG90eXBlKSB7CiAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9CiAgICBwdWJs\naWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBuZXdCdWlsZGVyKHRo\naXMpOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyUGFyZW50\nIHBhcmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRl\ncihwYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRlcjsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxk\nZXI8QnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJ\nZE9yQnVpbGRlciB7CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1JlZ2lvblNwZWNpZmljU2VxSWRfZGVzY3JpcHRvcjsKICAg\nICAgfQogICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAg\nICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1JlZ2lvblNwZWNpZmljU2Vx\nSWRfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgICB9CiAgICAgIAogICAgICAv\nLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZC5uZXdCdWlsZGVy\nKCkKICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgewogICAgICAgIG1heWJlRm9y\nY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICAKICAg\nICAgcHJpdmF0ZSBCdWlsZGVyKEJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAg\nICAgICAgc3VwZXIocGFyZW50KTsKICAgICAgICBtYXliZUZvcmNlQnVpbGRl\nckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgcHJpdmF0ZSB2b2lk\nIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7CiAgICAgICAg\naWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5hbHdh\neXNVc2VGaWVsZEJ1aWxkZXJzKSB7CiAgICAgICAgfQogICAgICB9CiAgICAg\nIHByaXZhdGUgc3RhdGljIEJ1aWxkZXIgY3JlYXRlKCkgewogICAgICAgIHJl\ndHVybiBuZXcgQnVpbGRlcigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwog\nICAgICAgIHJlZ2lvbl8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmcuRU1QVFk7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYg\nfjB4MDAwMDAwMDEpOwogICAgICAgIHNlcUlkXyA9IDBMOwogICAgICAgIGJp\ndEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdl\nRnJvbShidWlsZFBhcnRpYWwoKSk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQgZ2V0\nRGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9u\nU3BlY2lmaWNTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQgYnVpbGQoKSB7\nCiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCByZXN1bHQgPSBidWlsZFBhcnRp\nYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsK\nICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0\naW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7\nCiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJ\nZCBidWlsZFBhcnNlZCgpCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlJlZ2lvblNwZWNpZmljU2VxSWQgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAg\nICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4\nY2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0Owog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBi\ndWlsZFBhcnRpYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCByZXN1\nbHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCh0aGlzKTsKICAgICAgICBpbnQg\nZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsKICAgICAgICBpbnQgdG9f\nYml0RmllbGQwXyA9IDA7CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHRv\nX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICB9CiAgICAgICAg\ncmVzdWx0LnJlZ2lvbl8gPSByZWdpb25fOwogICAgICAgIGlmICgoKGZyb21f\nYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAg\nICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAg\nfQogICAgICAgIHJlc3VsdC5zZXFJZF8gPSBzZXFJZF87CiAgICAgICAgcmVz\ndWx0LmJpdEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVp\nbHQoKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90\nb2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3Rh\nbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCkgewogICAgICAgICAgcmV0dXJuIG1l\ncmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZClvdGhlcik7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2Vx\nSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAg\nIGlmIChvdGhlci5oYXNSZWdpb24oKSkgewogICAgICAgICAgc2V0UmVnaW9u\nKG90aGVyLmdldFJlZ2lvbigpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90\naGVyLmhhc1NlcUlkKCkpIHsKICAgICAgICAgIHNldFNlcUlkKG90aGVyLmdl\ndFNlcUlkKCkpOwogICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93\nbkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgZmluYWwg\nYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgIGlmICghaGFzUmVn\naW9uKCkpIHsKICAgICAgICAgIAogICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgICAgICBpZiAoIWhhc1NlcUlkKCkpIHsKICAgICAgICAg\nIAogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVp\nbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAgICAg\nIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAodHJ1\nZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAg\nICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAg\nICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxk\ncy5idWlsZCgpKTsKICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewog\nICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVu\na25vd25GaWVsZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAg\nICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQo\nKSk7CiAgICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDEwOiB7\nCiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAg\nICAgICAgICAgIHJlZ2lvbl8gPSBpbnB1dC5yZWFkQnl0ZXMoKTsKICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNl\nIDE2OiB7CiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAy\nOwogICAgICAgICAgICAgIHNlcUlkXyA9IGlucHV0LnJlYWRVSW50NjQoKTsK\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBpbnQg\nYml0RmllbGQwXzsKICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIGJ5dGVzIHJl\nZ2lvbiA9IDE7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nIHJlZ2lvbl8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcuRU1QVFk7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1JlZ2lvbigp\nIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkg\nPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAgICAgcHVibGljIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRSZWdpb24oKSB7CiAgICAgICAg\ncmV0dXJuIHJlZ2lvbl87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0UmVnaW9uKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1\nZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBu\nZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICB9CiAgYml0RmllbGQwXyB8\nPSAweDAwMDAwMDAxOwogICAgICAgIHJlZ2lvbl8gPSB2YWx1ZTsKICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlZ2lvbigpIHsKICAgICAgICBi\naXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAg\nICAgcmVnaW9uXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFJlZ2lvbigp\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIAogICAgICAvLyByZXF1aXJlZCB1aW50NjQgc2VxSWQg\nPSAyOwogICAgICBwcml2YXRlIGxvbmcgc2VxSWRfIDsKICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzU2VxSWQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAgICB9CiAg\nICAgIHB1YmxpYyBsb25nIGdldFNlcUlkKCkgewogICAgICAgIHJldHVybiBz\nZXFJZF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U2VxSWQo\nbG9uZyB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAw\nMjsKICAgICAgICBzZXFJZF8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBjbGVhclNlcUlkKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAo\nYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAgICAgICBzZXFJZF8gPSAw\nTDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3Bv\naW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlJlZ2lvblNwZWNpZmljU2VxSWQp\nCiAgICB9CiAgICAKICAgIHN0YXRpYyB7CiAgICAgIGRlZmF1bHRJbnN0YW5j\nZSA9IG5ldyBSZWdpb25TcGVjaWZpY1NlcUlkKHRydWUpOwogICAgICBkZWZh\ndWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAgICAvLyBA\nQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlJl\nZ2lvblNwZWNpZmljU2VxSWQpCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2Ug\nTWVzc2FnZVNlcUlkT3JCdWlsZGVyCiAgICAgIGV4dGVuZHMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsKICAgIAogICAgLy8gb3B0\naW9uYWwgdWludDY0IGxvY2FsQ29tcG9uZW50ID0gMTsKICAgIGJvb2xlYW4g\naGFzTG9jYWxDb21wb25lbnQoKTsKICAgIGxvbmcgZ2V0TG9jYWxDb21wb25l\nbnQoKTsKICAgIAogICAgLy8gcmVwZWF0ZWQgLkhlZHdpZy5SZWdpb25TcGVj\naWZpY1NlcUlkIHJlbW90ZUNvbXBvbmVudHMgPSAyOwogICAgamF2YS51dGls\nLkxpc3Q8b3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUmVnaW9uU3BlY2lmaWNTZXFJZD4gCiAgICAgICAgZ2V0UmVtb3RlQ29t\ncG9uZW50c0xpc3QoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQgZ2V0UmVtb3Rl\nQ29tcG9uZW50cyhpbnQgaW5kZXgpOwogICAgaW50IGdldFJlbW90ZUNvbXBv\nbmVudHNDb3VudCgpOwogICAgamF2YS51dGlsLkxpc3Q8PyBleHRlbmRzIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lv\nblNwZWNpZmljU2VxSWRPckJ1aWxkZXI+IAogICAgICAgIGdldFJlbW90ZUNv\nbXBvbmVudHNPckJ1aWxkZXJMaXN0KCk7CiAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nT3JCdWlsZGVyIGdldFJlbW90ZUNvbXBvbmVudHNPckJ1aWxkZXIoCiAgICAg\nICAgaW50IGluZGV4KTsKICB9CiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFz\ncyBNZXNzYWdlU2VxSWQgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVtZW50cyBNZXNzYWdl\nU2VxSWRPckJ1aWxkZXIgewogICAgLy8gVXNlIE1lc3NhZ2VTZXFJZC5uZXdC\ndWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJpdmF0ZSBNZXNzYWdlU2Vx\nSWQoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwog\nICAgfQogICAgcHJpdmF0ZSBNZXNzYWdlU2VxSWQoYm9vbGVhbiBub0luaXQp\nIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE1lc3NhZ2VTZXFJ\nZCBkZWZhdWx0SW5zdGFuY2U7CiAgICBwdWJsaWMgc3RhdGljIE1lc3NhZ2VT\nZXFJZCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZh\ndWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBNZXNzYWdlU2Vx\nSWQgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJu\nIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2Ny\naXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNzYWdlU2VxSWRfZGVzY3JpcHRvcjsK\nICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBp\nbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZVNlcUlkX2ZpZWxkQWNjZXNz\nb3JUYWJsZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQw\nXzsKICAgIC8vIG9wdGlvbmFsIHVpbnQ2NCBsb2NhbENvbXBvbmVudCA9IDE7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBMT0NBTENPTVBPTkVOVF9G\nSUVMRF9OVU1CRVIgPSAxOwogICAgcHJpdmF0ZSBsb25nIGxvY2FsQ29tcG9u\nZW50XzsKICAgIHB1YmxpYyBib29sZWFuIGhhc0xvY2FsQ29tcG9uZW50KCkg\newogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMgbG9uZyBnZXRMb2NhbENv\nbXBvbmVudCgpIHsKICAgICAgcmV0dXJuIGxvY2FsQ29tcG9uZW50XzsKICAg\nIH0KICAgIAogICAgLy8gcmVwZWF0ZWQgLkhlZHdpZy5SZWdpb25TcGVjaWZp\nY1NlcUlkIHJlbW90ZUNvbXBvbmVudHMgPSAyOwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgUkVNT1RFQ09NUE9ORU5UU19GSUVMRF9OVU1CRVIgPSAy\nOwogICAgcHJpdmF0ZSBqYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nPiByZW1vdGVDb21wb25lbnRzXzsKICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlz\ndDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5S\nZWdpb25TcGVjaWZpY1NlcUlkPiBnZXRSZW1vdGVDb21wb25lbnRzTGlzdCgp\nIHsKICAgICAgcmV0dXJuIHJlbW90ZUNvbXBvbmVudHNfOwogICAgfQogICAg\ncHVibGljIGphdmEudXRpbC5MaXN0PD8gZXh0ZW5kcyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkT3JCdWlsZGVyPiAKICAgICAgICBnZXRSZW1vdGVDb21wb25lbnRzT3JC\ndWlsZGVyTGlzdCgpIHsKICAgICAgcmV0dXJuIHJlbW90ZUNvbXBvbmVudHNf\nOwogICAgfQogICAgcHVibGljIGludCBnZXRSZW1vdGVDb21wb25lbnRzQ291\nbnQoKSB7CiAgICAgIHJldHVybiByZW1vdGVDb21wb25lbnRzXy5zaXplKCk7\nCiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBnZXRSZW1vdGVD\nb21wb25lbnRzKGludCBpbmRleCkgewogICAgICByZXR1cm4gcmVtb3RlQ29t\ncG9uZW50c18uZ2V0KGluZGV4KTsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVj\naWZpY1NlcUlkT3JCdWlsZGVyIGdldFJlbW90ZUNvbXBvbmVudHNPckJ1aWxk\nZXIoCiAgICAgICAgaW50IGluZGV4KSB7CiAgICAgIHJldHVybiByZW1vdGVD\nb21wb25lbnRzXy5nZXQoaW5kZXgpOwogICAgfQogICAgCiAgICBwcml2YXRl\nIHZvaWQgaW5pdEZpZWxkcygpIHsKICAgICAgbG9jYWxDb21wb25lbnRfID0g\nMEw7CiAgICAgIHJlbW90ZUNvbXBvbmVudHNfID0gamF2YS51dGlsLkNvbGxl\nY3Rpb25zLmVtcHR5TGlzdCgpOwogICAgfQogICAgcHJpdmF0ZSBieXRlIG1l\nbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOwogICAgcHVibGljIGZpbmFsIGJv\nb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgYnl0ZSBpc0luaXRpYWxp\nemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOwogICAgICBpZiAoaXNJbml0\naWFsaXplZCAhPSAtMSkgcmV0dXJuIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAg\nICAgCiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZ2V0UmVtb3RlQ29tcG9u\nZW50c0NvdW50KCk7IGkrKykgewogICAgICAgIGlmICghZ2V0UmVtb3RlQ29t\ncG9uZW50cyhpKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIG1lbW9p\nemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQogICAgICB9CiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXpl\nZCA9IDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6ZWRT\naXplKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9\nPSAweDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0ZVVJbnQ2NCgx\nLCBsb2NhbENvbXBvbmVudF8pOwogICAgICB9CiAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgcmVtb3RlQ29tcG9uZW50c18uc2l6ZSgpOyBpKyspIHsKICAg\nICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDIsIHJlbW90ZUNvbXBvbmVudHNf\nLmdldChpKSk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndy\naXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgbWVt\nb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBnZXRT\nZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNl\ncmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNp\nemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmICgoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIHNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgLmNvbXB1dGVVSW50NjRTaXplKDEsIGxvY2FsQ29tcG9uZW50\nXyk7CiAgICAgIH0KICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCByZW1vdGVD\nb21wb25lbnRzXy5zaXplKCk7IGkrKykgewogICAgICAgIHNpemUgKz0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAg\nLmNvbXB1dGVNZXNzYWdlU2l6ZSgyLCByZW1vdGVDb21wb25lbnRzXy5nZXQo\naSkpOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5rbm93bkZpZWxkcygp\nLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9pemVkU2VyaWFsaXpl\nZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsKICAgIH0KICAgIAog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlE\nID0gMEw7CiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQg\namF2YS5sYW5nLk9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAgICAgIHRocm93\ncyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBzdXBlci53cml0ZVJlcGxhY2UoKTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlU2VxSWQgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZCBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEs\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNl\nZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VG\ncm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAg\nIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHBhcnNlRnJvbSgKICAgICAgICBq\nYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHBhcnNlRGVsaW1p\ndGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWls\nZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURl\nbGltaXRlZEZyb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIu\nYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1\naWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdl\nRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBl\nbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VGcm9t\nKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVh\nbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVp\nbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRl\nckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1Ymxp\nYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBwcm90b3R5\ncGUpIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJv\ndG90eXBlKTsKICAgIH0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigp\nIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7IH0KICAgIAogICAgQGphdmEu\nbGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRl\nckZvclR5cGUoCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgIEJ1aWxk\nZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7CiAgICAgIHJldHVy\nbiBidWlsZGVyOwogICAgfQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFz\ncyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPgogICAgICAgaW1w\nbGVtZW50cyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXIgewogICAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVz\nY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNzYWdlU2VxSWRfZGVzY3Jp\ncHRvcjsKICAgICAgfQogICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29n\nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFi\nbGUKICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkg\newogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VT\nZXFJZF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICAgIH0KICAgICAgCiAgICAg\nIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRlcigpCiAg\nICAgIHByaXZhdGUgQnVpbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVp\nbGRlckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHBy\naXZhdGUgQnVpbGRlcihCdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAg\nIHN1cGVyKHBhcmVudCk7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0\naWFsaXphdGlvbigpOwogICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXli\nZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChj\nb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNl\nRmllbGRCdWlsZGVycykgewogICAgICAgICAgZ2V0UmVtb3RlQ29tcG9uZW50\nc0ZpZWxkQnVpbGRlcigpOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2\nYXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICByZXR1cm4g\nbmV3IEJ1aWxkZXIoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgY2xlYXIoKSB7CiAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAg\nICBsb2NhbENvbXBvbmVudF8gPSAwTDsKICAgICAgICBiaXRGaWVsZDBfID0g\nKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgaWYgKHJlbW90\nZUNvbXBvbmVudHNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZW1v\ndGVDb21wb25lbnRzXyA9IGphdmEudXRpbC5Db2xsZWN0aW9ucy5lbXB0eUxp\nc3QoKTsKICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDAyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVtb3Rl\nQ29tcG9uZW50c0J1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVp\nbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VG\ncm9tKGJ1aWxkUGFydGlhbCgpKTsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRv\ncgogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAgICAg\ncmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZC5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgZ2V0RGVmYXVsdEluc3RhbmNl\nRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1\nbHRJbnN0YW5jZSgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkIGJ1aWxkKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCByZXN1bHQgPSBi\ndWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxp\nemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNz\nYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkIGJ1aWxkUGFyc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAg\nICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAg\ndGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAg\nICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRp\nb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBidWlsZFBhcnRpYWwo\nKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQo\ndGhpcyk7CiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxk\nMF87CiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOwogICAgICAgIGlm\nICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAw\nMDEpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7\nCiAgICAgICAgfQogICAgICAgIHJlc3VsdC5sb2NhbENvbXBvbmVudF8gPSBs\nb2NhbENvbXBvbmVudF87CiAgICAgICAgaWYgKHJlbW90ZUNvbXBvbmVudHNC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICAgICAg\ncmVtb3RlQ29tcG9uZW50c18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMudW5t\nb2RpZmlhYmxlTGlzdChyZW1vdGVDb21wb25lbnRzXyk7CiAgICAgICAgICAg\nIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAg\nICAgICAgIH0KICAgICAgICAgIHJlc3VsdC5yZW1vdGVDb21wb25lbnRzXyA9\nIHJlbW90ZUNvbXBvbmVudHNfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICByZXN1bHQucmVtb3RlQ29tcG9uZW50c18gPSByZW1vdGVDb21wb25lbnRz\nQnVpbGRlcl8uYnVpbGQoKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LmJp\ndEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQoKTsK\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5N\nZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Yg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkKSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQpb3RoZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdXBl\nci5tZXJnZUZyb20ob3RoZXIpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBt\nZXJnZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVy\nID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRo\naXM7CiAgICAgICAgaWYgKG90aGVyLmhhc0xvY2FsQ29tcG9uZW50KCkpIHsK\nICAgICAgICAgIHNldExvY2FsQ29tcG9uZW50KG90aGVyLmdldExvY2FsQ29t\ncG9uZW50KCkpOwogICAgICAgIH0KICAgICAgICBpZiAocmVtb3RlQ29tcG9u\nZW50c0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGlmICghb3RoZXIu\ncmVtb3RlQ29tcG9uZW50c18uaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGlm\nIChyZW1vdGVDb21wb25lbnRzXy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nICByZW1vdGVDb21wb25lbnRzXyA9IG90aGVyLnJlbW90ZUNvbXBvbmVudHNf\nOwogICAgICAgICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDAyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICBlbnN1cmVSZW1vdGVDb21wb25lbnRzSXNNdXRhYmxlKCk7CiAgICAgICAg\nICAgICAgcmVtb3RlQ29tcG9uZW50c18uYWRkQWxsKG90aGVyLnJlbW90ZUNv\nbXBvbmVudHNfKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvbkNoYW5n\nZWQoKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAg\naWYgKCFvdGhlci5yZW1vdGVDb21wb25lbnRzXy5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgaWYgKHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgICByZW1vdGVDb21wb25lbnRzQnVpbGRlcl8u\nZGlzcG9zZSgpOwogICAgICAgICAgICAgIHJlbW90ZUNvbXBvbmVudHNCdWls\nZGVyXyA9IG51bGw7CiAgICAgICAgICAgICAgcmVtb3RlQ29tcG9uZW50c18g\nPSBvdGhlci5yZW1vdGVDb21wb25lbnRzXzsKICAgICAgICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAg\nICAgICAgcmVtb3RlQ29tcG9uZW50c0J1aWxkZXJfID0gCiAgICAgICAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3\nYXlzVXNlRmllbGRCdWlsZGVycyA/CiAgICAgICAgICAgICAgICAgICBnZXRS\nZW1vdGVDb21wb25lbnRzRmllbGRCdWlsZGVyKCkgOiBudWxsOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlbW90ZUNvbXBvbmVudHNC\ndWlsZGVyXy5hZGRBbGxNZXNzYWdlcyhvdGhlci5yZW1vdGVDb21wb25lbnRz\nXyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZp\nZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGdldFJlbW90ZUNvbXBvbmVu\ndHNDb3VudCgpOyBpKyspIHsKICAgICAgICAgIGlmICghZ2V0UmVtb3RlQ29t\ncG9uZW50cyhpKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgICAgCiAg\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZp\nZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAog\nICAgICAgICAgICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAg\nd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFk\nVGFnKCk7CiAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBj\nYXNlIDA6CiAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVu\na25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRl\nZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxk\nKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAg\nICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmll\nbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nY2FzZSA4OiB7CiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDAxOwogICAgICAgICAgICAgIGxvY2FsQ29tcG9uZW50XyA9IGlucHV0LnJl\nYWRVSW50NjQoKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBjYXNlIDE4OiB7CiAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3Bl\nY2lmaWNTZXFJZC5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVz\nc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAg\nICAgICAgYWRkUmVtb3RlQ29tcG9uZW50cyhzdWJCdWlsZGVyLmJ1aWxkUGFy\ndGlhbCgpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHJp\ndmF0ZSBpbnQgYml0RmllbGQwXzsKICAgICAgCiAgICAgIC8vIG9wdGlvbmFs\nIHVpbnQ2NCBsb2NhbENvbXBvbmVudCA9IDE7CiAgICAgIHByaXZhdGUgbG9u\nZyBsb2NhbENvbXBvbmVudF8gOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNM\nb2NhbENvbXBvbmVudCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAgICAg\ncHVibGljIGxvbmcgZ2V0TG9jYWxDb21wb25lbnQoKSB7CiAgICAgICAgcmV0\ndXJuIGxvY2FsQ29tcG9uZW50XzsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRMb2NhbENvbXBvbmVudChsb25nIHZhbHVlKSB7CiAgICAgICAg\nYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIGxvY2FsQ29tcG9u\nZW50XyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFy\nTG9jYWxDb21wb25lbnQoKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRG\naWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgIGxvY2FsQ29tcG9uZW50\nXyA9IDBMOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyByZXBlYXRlZCAuSGVkd2ln\nLlJlZ2lvblNwZWNpZmljU2VxSWQgcmVtb3RlQ29tcG9uZW50cyA9IDI7CiAg\nICAgIHByaXZhdGUgamF2YS51dGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZD4g\ncmVtb3RlQ29tcG9uZW50c18gPQogICAgICAgIGphdmEudXRpbC5Db2xsZWN0\naW9ucy5lbXB0eUxpc3QoKTsKICAgICAgcHJpdmF0ZSB2b2lkIGVuc3VyZVJl\nbW90ZUNvbXBvbmVudHNJc011dGFibGUoKSB7CiAgICAgICAgaWYgKCEoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAg\nICAgICAgcmVtb3RlQ29tcG9uZW50c18gPSBuZXcgamF2YS51dGlsLkFycmF5\nTGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5SZWdpb25TcGVjaWZpY1NlcUlkPihyZW1vdGVDb21wb25lbnRzXyk7CiAg\nICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgIH0K\nICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLlJlcGVhdGVkRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lm\naWNTZXFJZCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZC5CdWlsZGVyLCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZp\nY1NlcUlkT3JCdWlsZGVyPiByZW1vdGVDb21wb25lbnRzQnVpbGRlcl87CiAg\nICAgIAogICAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8b3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNT\nZXFJZD4gZ2V0UmVtb3RlQ29tcG9uZW50c0xpc3QoKSB7CiAgICAgICAgaWYg\nKHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAg\nICByZXR1cm4gamF2YS51dGlsLkNvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxp\nc3QocmVtb3RlQ29tcG9uZW50c18pOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICByZXR1cm4gcmVtb3RlQ29tcG9uZW50c0J1aWxkZXJfLmdldE1lc3Nh\nZ2VMaXN0KCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBpbnQg\nZ2V0UmVtb3RlQ29tcG9uZW50c0NvdW50KCkgewogICAgICAgIGlmIChyZW1v\ndGVDb21wb25lbnRzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgcmV0\ndXJuIHJlbW90ZUNvbXBvbmVudHNfLnNpemUoKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmV0dXJuIHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXy5n\nZXRDb3VudCgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9u\nU3BlY2lmaWNTZXFJZCBnZXRSZW1vdGVDb21wb25lbnRzKGludCBpbmRleCkg\newogICAgICAgIGlmIChyZW1vdGVDb21wb25lbnRzQnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgcmV0dXJuIHJlbW90ZUNvbXBvbmVudHNfLmdldChp\nbmRleCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiByZW1v\ndGVDb21wb25lbnRzQnVpbGRlcl8uZ2V0TWVzc2FnZShpbmRleCk7CiAgICAg\nICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlbW90ZUNv\nbXBvbmVudHMoCiAgICAgICAgICBpbnQgaW5kZXgsIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2Vx\nSWQgdmFsdWUpIHsKICAgICAgICBpZiAocmVtb3RlQ29tcG9uZW50c0J1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigp\nOwogICAgICAgICAgfQogICAgICAgICAgZW5zdXJlUmVtb3RlQ29tcG9uZW50\nc0lzTXV0YWJsZSgpOwogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c18uc2V0\nKGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c0J1aWxkZXJf\nLnNldE1lc3NhZ2UoaW5kZXgsIHZhbHVlKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0\nUmVtb3RlQ29tcG9uZW50cygKICAgICAgICAgIGludCBpbmRleCwgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3Bl\nY2lmaWNTZXFJZC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAg\nIGlmIChyZW1vdGVDb21wb25lbnRzQnVpbGRlcl8gPT0gbnVsbCkgewogICAg\nICAgICAgZW5zdXJlUmVtb3RlQ29tcG9uZW50c0lzTXV0YWJsZSgpOwogICAg\nICAgICAgcmVtb3RlQ29tcG9uZW50c18uc2V0KGluZGV4LCBidWlsZGVyRm9y\nVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c0J1aWxkZXJf\nLnNldE1lc3NhZ2UoaW5kZXgsIGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgYWRkUmVtb3RlQ29tcG9uZW50cyhvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZp\nY1NlcUlkIHZhbHVlKSB7CiAgICAgICAgaWYgKHJlbW90ZUNvbXBvbmVudHNC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVs\nbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRp\nb24oKTsKICAgICAgICAgIH0KICAgICAgICAgIGVuc3VyZVJlbW90ZUNvbXBv\nbmVudHNJc011dGFibGUoKTsKICAgICAgICAgIHJlbW90ZUNvbXBvbmVudHNf\nLmFkZCh2YWx1ZSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c0J1aWxkZXJfLmFk\nZE1lc3NhZ2UodmFsdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZW1vdGVDb21w\nb25lbnRzKAogICAgICAgICAgaW50IGluZGV4LCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nIHZhbHVlKSB7CiAgICAgICAgaWYgKHJlbW90ZUNvbXBvbmVudHNCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsK\nICAgICAgICAgIH0KICAgICAgICAgIGVuc3VyZVJlbW90ZUNvbXBvbmVudHNJ\nc011dGFibGUoKTsKICAgICAgICAgIHJlbW90ZUNvbXBvbmVudHNfLmFkZChp\nbmRleCwgdmFsdWUpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXy5h\nZGRNZXNzYWdlKGluZGV4LCB2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJl\nbW90ZUNvbXBvbmVudHMoCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLkJ1\naWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgaWYgKHJlbW90ZUNv\nbXBvbmVudHNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBlbnN1cmVS\nZW1vdGVDb21wb25lbnRzSXNNdXRhYmxlKCk7CiAgICAgICAgICByZW1vdGVD\nb21wb25lbnRzXy5hZGQoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nIHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXy5hZGRNZXNzYWdlKGJ1aWxkZXJG\nb3JWYWx1ZS5idWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgYWRkUmVtb3RlQ29t\ncG9uZW50cygKICAgICAgICAgIGludCBpbmRleCwgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJ\nZC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAgIGlmIChyZW1v\ndGVDb21wb25lbnRzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgZW5z\ndXJlUmVtb3RlQ29tcG9uZW50c0lzTXV0YWJsZSgpOwogICAgICAgICAgcmVt\nb3RlQ29tcG9uZW50c18uYWRkKGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVp\nbGQoKSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c0J1aWxkZXJfLmFkZE1lc3Nh\nZ2UoaW5kZXgsIGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgYWRkQWxsUmVtb3RlQ29tcG9uZW50cygKICAgICAgICAgIGphdmEu\nbGFuZy5JdGVyYWJsZTw/IGV4dGVuZHMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZD4gdmFs\ndWVzKSB7CiAgICAgICAgaWYgKHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXyA9\nPSBudWxsKSB7CiAgICAgICAgICBlbnN1cmVSZW1vdGVDb21wb25lbnRzSXNN\ndXRhYmxlKCk7CiAgICAgICAgICBzdXBlci5hZGRBbGwodmFsdWVzLCByZW1v\ndGVDb21wb25lbnRzXyk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c0J1aWxkZXJf\nLmFkZEFsbE1lc3NhZ2VzKHZhbHVlcyk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFy\nUmVtb3RlQ29tcG9uZW50cygpIHsKICAgICAgICBpZiAocmVtb3RlQ29tcG9u\nZW50c0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJlbW90ZUNvbXBv\nbmVudHNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwog\nICAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAw\nMDIpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXy5jbGVhcigpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBw\ndWJsaWMgQnVpbGRlciByZW1vdmVSZW1vdGVDb21wb25lbnRzKGludCBpbmRl\neCkgewogICAgICAgIGlmIChyZW1vdGVDb21wb25lbnRzQnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgZW5zdXJlUmVtb3RlQ29tcG9uZW50c0lzTXV0\nYWJsZSgpOwogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c18ucmVtb3ZlKGlu\nZGV4KTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICByZW1vdGVDb21wb25lbnRzQnVpbGRlcl8ucmVtb3ZlKGlu\nZGV4KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQuQnVpbGRlciBnZXRSZW1v\ndGVDb21wb25lbnRzQnVpbGRlcigKICAgICAgICAgIGludCBpbmRleCkgewog\nICAgICAgIHJldHVybiBnZXRSZW1vdGVDb21wb25lbnRzRmllbGRCdWlsZGVy\nKCkuZ2V0QnVpbGRlcihpbmRleCk7CiAgICAgIH0KICAgICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lv\nblNwZWNpZmljU2VxSWRPckJ1aWxkZXIgZ2V0UmVtb3RlQ29tcG9uZW50c09y\nQnVpbGRlcigKICAgICAgICAgIGludCBpbmRleCkgewogICAgICAgIGlmIChy\nZW1vdGVDb21wb25lbnRzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\ncmV0dXJuIHJlbW90ZUNvbXBvbmVudHNfLmdldChpbmRleCk7ICB9IGVsc2Ug\newogICAgICAgICAgcmV0dXJuIHJlbW90ZUNvbXBvbmVudHNCdWlsZGVyXy5n\nZXRNZXNzYWdlT3JCdWlsZGVyKGluZGV4KTsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgcHVibGljIGphdmEudXRpbC5MaXN0PD8gZXh0ZW5kcyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVj\naWZpY1NlcUlkT3JCdWlsZGVyPiAKICAgICAgICAgICBnZXRSZW1vdGVDb21w\nb25lbnRzT3JCdWlsZGVyTGlzdCgpIHsKICAgICAgICBpZiAocmVtb3RlQ29t\ncG9uZW50c0J1aWxkZXJfICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybiBy\nZW1vdGVDb21wb25lbnRzQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlckxp\nc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGphdmEu\ndXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJlbW90ZUNvbXBv\nbmVudHNfKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNw\nZWNpZmljU2VxSWQuQnVpbGRlciBhZGRSZW1vdGVDb21wb25lbnRzQnVpbGRl\ncigpIHsKICAgICAgICByZXR1cm4gZ2V0UmVtb3RlQ29tcG9uZW50c0ZpZWxk\nQnVpbGRlcigpLmFkZEJ1aWxkZXIoCiAgICAgICAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmlj\nU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpOwogICAgICB9CiAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5SZWdpb25TcGVjaWZpY1NlcUlkLkJ1aWxkZXIgYWRkUmVtb3RlQ29tcG9u\nZW50c0J1aWxkZXIoCiAgICAgICAgICBpbnQgaW5kZXgpIHsKICAgICAgICBy\nZXR1cm4gZ2V0UmVtb3RlQ29tcG9uZW50c0ZpZWxkQnVpbGRlcigpLmFkZEJ1\naWxkZXIoCiAgICAgICAgICAgIGluZGV4LCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLmdl\ndERlZmF1bHRJbnN0YW5jZSgpKTsKICAgICAgfQogICAgICBwdWJsaWMgamF2\nYS51dGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZC5CdWlsZGVyPiAKICAgICAg\nICAgICBnZXRSZW1vdGVDb21wb25lbnRzQnVpbGRlckxpc3QoKSB7CiAgICAg\nICAgcmV0dXJuIGdldFJlbW90ZUNvbXBvbmVudHNGaWVsZEJ1aWxkZXIoKS5n\nZXRCdWlsZGVyTGlzdCgpOwogICAgICB9CiAgICAgIHByaXZhdGUgY29tLmdv\nb2dsZS5wcm90b2J1Zi5SZXBlYXRlZEZpZWxkQnVpbGRlcjwKICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJl\nZ2lvblNwZWNpZmljU2VxSWQsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQuQnVpbGRlciwg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVn\naW9uU3BlY2lmaWNTZXFJZE9yQnVpbGRlcj4gCiAgICAgICAgICBnZXRSZW1v\ndGVDb21wb25lbnRzRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmIChyZW1v\ndGVDb21wb25lbnRzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgcmVt\nb3RlQ29tcG9uZW50c0J1aWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9i\ndWYuUmVwZWF0ZWRGaWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3Bl\nY2lmaWNTZXFJZCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZC5CdWlsZGVyLCBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVj\naWZpY1NlcUlkT3JCdWlsZGVyPigKICAgICAgICAgICAgICAgICAgcmVtb3Rl\nQ29tcG9uZW50c18sCiAgICAgICAgICAgICAgICAgICgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpLAogICAgICAgICAgICAgICAg\nICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLAogICAgICAgICAgICAgICAgICBp\nc0NsZWFuKCkpOwogICAgICAgICAgcmVtb3RlQ29tcG9uZW50c18gPSBudWxs\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVtb3RlQ29tcG9uZW50c0J1\naWxkZXJfOwogICAgICB9CiAgICAgIAogICAgICAvLyBAQHByb3RvY19pbnNl\ncnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3aWcuTWVzc2FnZVNlcUlk\nKQogICAgfQogICAgCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFu\nY2UgPSBuZXcgTWVzc2FnZVNlcUlkKHRydWUpOwogICAgICBkZWZhdWx0SW5z\ndGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAgICAvLyBAQHByb3Rv\nY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLk1lc3NhZ2VT\nZXFJZCkKICB9CiAgCiAgcHVibGljIGludGVyZmFjZSBQdWJTdWJSZXF1ZXN0\nT3JCdWlsZGVyCiAgICAgIGV4dGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5N\nZXNzYWdlT3JCdWlsZGVyIHsKICAgIAogICAgLy8gcmVxdWlyZWQgLkhlZHdp\nZy5Qcm90b2NvbFZlcnNpb24gcHJvdG9jb2xWZXJzaW9uID0gMTsKICAgIGJv\nb2xlYW4gaGFzUHJvdG9jb2xWZXJzaW9uKCk7CiAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24g\nZ2V0UHJvdG9jb2xWZXJzaW9uKCk7CiAgICAKICAgIC8vIHJlcXVpcmVkIC5I\nZWR3aWcuT3BlcmF0aW9uVHlwZSB0eXBlID0gMjsKICAgIGJvb2xlYW4gaGFz\nVHlwZSgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuT3BlcmF0aW9uVHlwZSBnZXRUeXBlKCk7CiAgICAKICAgIC8v\nIHJlcGVhdGVkIGJ5dGVzIHRyaWVkU2VydmVycyA9IDM7CiAgICBqYXZhLnV0\naWwuTGlzdDxjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc+IGdldFRy\naWVkU2VydmVyc0xpc3QoKTsKICAgIGludCBnZXRUcmllZFNlcnZlcnNDb3Vu\ndCgpOwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFRy\naWVkU2VydmVycyhpbnQgaW5kZXgpOwogICAgCiAgICAvLyByZXF1aXJlZCB1\naW50NjQgdHhuSWQgPSA0OwogICAgYm9vbGVhbiBoYXNUeG5JZCgpOwogICAg\nbG9uZyBnZXRUeG5JZCgpOwogICAgCiAgICAvLyBvcHRpb25hbCBib29sIHNo\nb3VsZENsYWltID0gNTsKICAgIGJvb2xlYW4gaGFzU2hvdWxkQ2xhaW0oKTsK\nICAgIGJvb2xlYW4gZ2V0U2hvdWxkQ2xhaW0oKTsKICAgIAogICAgLy8gcmVx\ndWlyZWQgYnl0ZXMgdG9waWMgPSA2OwogICAgYm9vbGVhbiBoYXNUb3BpYygp\nOwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFRvcGlj\nKCk7CiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuUHVibGlzaFJlcXVl\nc3QgcHVibGlzaFJlcXVlc3QgPSA1MjsKICAgIGJvb2xlYW4gaGFzUHVibGlz\naFJlcXVlc3QoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IGdldFB1Ymxpc2hSZXF1ZXN0\nKCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJsaXNoUmVxdWVzdE9yQnVpbGRlciBnZXRQdWJsaXNoUmVxdWVz\ndE9yQnVpbGRlcigpOwogICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1\nYnNjcmliZVJlcXVlc3Qgc3Vic2NyaWJlUmVxdWVzdCA9IDUzOwogICAgYm9v\nbGVhbiBoYXNTdWJzY3JpYmVSZXF1ZXN0KCk7CiAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nIGdldFN1YnNjcmliZVJlcXVlc3QoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3RPckJ1\naWxkZXIgZ2V0U3Vic2NyaWJlUmVxdWVzdE9yQnVpbGRlcigpOwogICAgCiAg\nICAvLyBvcHRpb25hbCAuSGVkd2lnLkNvbnN1bWVSZXF1ZXN0IGNvbnN1bWVS\nZXF1ZXN0ID0gNTQ7CiAgICBib29sZWFuIGhhc0NvbnN1bWVSZXF1ZXN0KCk7\nCiAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5Db25zdW1lUmVxdWVzdCBnZXRDb25zdW1lUmVxdWVzdCgpOwogICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3Vt\nZVJlcXVlc3RPckJ1aWxkZXIgZ2V0Q29uc3VtZVJlcXVlc3RPckJ1aWxkZXIo\nKTsKICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5VbnN1YnNjcmliZVJl\ncXVlc3QgdW5zdWJzY3JpYmVSZXF1ZXN0ID0gNTU7CiAgICBib29sZWFuIGhh\nc1Vuc3Vic2NyaWJlUmVxdWVzdCgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IGdl\ndFVuc3Vic2NyaWJlUmVxdWVzdCgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0T3JC\ndWlsZGVyIGdldFVuc3Vic2NyaWJlUmVxdWVzdE9yQnVpbGRlcigpOwogICAg\nCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN0b3BEZWxpdmVyeVJlcXVlc3Qg\nc3RvcERlbGl2ZXJ5UmVxdWVzdCA9IDU2OwogICAgYm9vbGVhbiBoYXNTdG9w\nRGVsaXZlcnlSZXF1ZXN0KCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IGdldFN0\nb3BEZWxpdmVyeVJlcXVlc3QoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3RPckJ1\naWxkZXIgZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdE9yQnVpbGRlcigpOwogICAg\nCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0ID0gNTc7CiAgICBib29sZWFuIGhhc1N0\nYXJ0RGVsaXZlcnlSZXF1ZXN0KCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBn\nZXRTdGFydERlbGl2ZXJ5UmVxdWVzdCgpOwogICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVl\nc3RPckJ1aWxkZXIgZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3RPckJ1aWxkZXIo\nKTsKICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5DbG9zZVN1YnNjcmlw\ndGlvblJlcXVlc3QgY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0ID0gNTg7CiAg\nICBib29sZWFuIGhhc0Nsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCgpOwogICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xv\nc2VTdWJzY3JpcHRpb25SZXF1ZXN0IGdldENsb3NlU3Vic2NyaXB0aW9uUmVx\ndWVzdCgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0T3JCdWlsZGVyIGdl\ndENsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdE9yQnVpbGRlcigpOwogIH0KICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFB1YlN1YlJlcXVlc3QgZXh0ZW5k\ncwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UK\nICAgICAgaW1wbGVtZW50cyBQdWJTdWJSZXF1ZXN0T3JCdWlsZGVyIHsKICAg\nIC8vIFVzZSBQdWJTdWJSZXF1ZXN0Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1\nY3QuCiAgICBwcml2YXRlIFB1YlN1YlJlcXVlc3QoQnVpbGRlciBidWlsZGVy\nKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwogICAgfQogICAgcHJpdmF0ZSBQ\ndWJTdWJSZXF1ZXN0KGJvb2xlYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBQdWJTdWJSZXF1ZXN0IGRlZmF1bHRJbnN0YW5j\nZTsKICAgIHB1YmxpYyBzdGF0aWMgUHViU3ViUmVxdWVzdCBnZXREZWZhdWx0\nSW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBQdWJTdWJSZXF1ZXN0IGdldERlZmF1bHRJ\nbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFu\nY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19I\nZWR3aWdfUHViU3ViUmVxdWVzdF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAg\nICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNz\nYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0Rmll\nbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19QdWJTdWJSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIHJl\ncXVpcmVkIC5IZWR3aWcuUHJvdG9jb2xWZXJzaW9uIHByb3RvY29sVmVyc2lv\nbiA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBQUk9UT0NPTFZF\nUlNJT05fRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJz\naW9uIHByb3RvY29sVmVyc2lvbl87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNQ\ncm90b2NvbFZlcnNpb24oKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgIH0KICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ncm90b2NvbFZlcnNpb24gZ2V0UHJvdG9jb2xWZXJzaW9uKCkgewogICAgICBy\nZXR1cm4gcHJvdG9jb2xWZXJzaW9uXzsKICAgIH0KICAgIAogICAgLy8gcmVx\ndWlyZWQgLkhlZHdpZy5PcGVyYXRpb25UeXBlIHR5cGUgPSAyOwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9GSUVMRF9OVU1CRVIgPSAyOwog\nICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5PcGVyYXRpb25UeXBlIHR5cGVfOwogICAgcHVibGljIGJvb2xl\nYW4gaGFzVHlwZSgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAgfQogICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk9wZXJh\ndGlvblR5cGUgZ2V0VHlwZSgpIHsKICAgICAgcmV0dXJuIHR5cGVfOwogICAg\nfQogICAgCiAgICAvLyByZXBlYXRlZCBieXRlcyB0cmllZFNlcnZlcnMgPSAz\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVFJJRURTRVJWRVJTX0ZJ\nRUxEX05VTUJFUiA9IDM7CiAgICBwcml2YXRlIGphdmEudXRpbC5MaXN0PGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZz4gdHJpZWRTZXJ2ZXJzXzsK\nICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmc+CiAgICAgICAgZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpIHsK\nICAgICAgcmV0dXJuIHRyaWVkU2VydmVyc187CiAgICB9CiAgICBwdWJsaWMg\naW50IGdldFRyaWVkU2VydmVyc0NvdW50KCkgewogICAgICByZXR1cm4gdHJp\nZWRTZXJ2ZXJzXy5zaXplKCk7CiAgICB9CiAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFRyaWVkU2VydmVycyhpbnQgaW5k\nZXgpIHsKICAgICAgcmV0dXJuIHRyaWVkU2VydmVyc18uZ2V0KGluZGV4KTsK\nICAgIH0KICAgIAogICAgLy8gcmVxdWlyZWQgdWludDY0IHR4bklkID0gNDsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFRYTklEX0ZJRUxEX05VTUJF\nUiA9IDQ7CiAgICBwcml2YXRlIGxvbmcgdHhuSWRfOwogICAgcHVibGljIGJv\nb2xlYW4gaGFzVHhuSWQoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDA0KSA9PSAweDAwMDAwMDA0KTsKICAgIH0KICAgIHB1Ymxp\nYyBsb25nIGdldFR4bklkKCkgewogICAgICByZXR1cm4gdHhuSWRfOwogICAg\nfQogICAgCiAgICAvLyBvcHRpb25hbCBib29sIHNob3VsZENsYWltID0gNTsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNIT1VMRENMQUlNX0ZJRUxE\nX05VTUJFUiA9IDU7CiAgICBwcml2YXRlIGJvb2xlYW4gc2hvdWxkQ2xhaW1f\nOwogICAgcHVibGljIGJvb2xlYW4gaGFzU2hvdWxkQ2xhaW0oKSB7CiAgICAg\nIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAwMDAw\nMDA4KTsKICAgIH0KICAgIHB1YmxpYyBib29sZWFuIGdldFNob3VsZENsYWlt\nKCkgewogICAgICByZXR1cm4gc2hvdWxkQ2xhaW1fOwogICAgfQogICAgCiAg\nICAvLyByZXF1aXJlZCBieXRlcyB0b3BpYyA9IDY7CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBUT1BJQ19GSUVMRF9OVU1CRVIgPSA2OwogICAgcHJp\ndmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdG9waWNfOwog\nICAgcHVibGljIGJvb2xlYW4gaGFzVG9waWMoKSB7CiAgICAgIHJldHVybiAo\nKGJpdEZpZWxkMF8gJiAweDAwMDAwMDEwKSA9PSAweDAwMDAwMDEwKTsKICAg\nIH0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nZ2V0VG9waWMoKSB7CiAgICAgIHJldHVybiB0b3BpY187CiAgICB9CiAgICAK\nICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuUHVibGlzaFJlcXVlc3QgcHVibGlz\naFJlcXVlc3QgPSA1MjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFBV\nQkxJU0hSRVFVRVNUX0ZJRUxEX05VTUJFUiA9IDUyOwogICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJs\naXNoUmVxdWVzdCBwdWJsaXNoUmVxdWVzdF87CiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNQdWJsaXNoUmVxdWVzdCgpIHsKICAgICAgcmV0dXJuICgoYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMjApID09IDB4MDAwMDAwMjApOwogICAgfQogICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlB1Ymxpc2hSZXF1ZXN0IGdldFB1Ymxpc2hSZXF1ZXN0KCkgewogICAg\nICByZXR1cm4gcHVibGlzaFJlcXVlc3RfOwogICAgfQogICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxp\nc2hSZXF1ZXN0T3JCdWlsZGVyIGdldFB1Ymxpc2hSZXF1ZXN0T3JCdWlsZGVy\nKCkgewogICAgICByZXR1cm4gcHVibGlzaFJlcXVlc3RfOwogICAgfQogICAg\nCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmliZVJlcXVlc3Qgc3Vi\nc2NyaWJlUmVxdWVzdCA9IDUzOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgU1VCU0NSSUJFUkVRVUVTVF9GSUVMRF9OVU1CRVIgPSA1MzsKICAgIHBy\naXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaWJlUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0XzsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc1N1YnNjcmliZVJlcXVlc3QoKSB7CiAgICAgIHJl\ndHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDQwKSA9PSAweDAwMDAwMDQw\nKTsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IGdldFN1YnNjcmli\nZVJlcXVlc3QoKSB7CiAgICAgIHJldHVybiBzdWJzY3JpYmVSZXF1ZXN0XzsK\nICAgIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0T3JCdWlsZGVyIGdldFN1\nYnNjcmliZVJlcXVlc3RPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiBzdWJz\nY3JpYmVSZXF1ZXN0XzsKICAgIH0KICAgIAogICAgLy8gb3B0aW9uYWwgLkhl\nZHdpZy5Db25zdW1lUmVxdWVzdCBjb25zdW1lUmVxdWVzdCA9IDU0OwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ09OU1VNRVJFUVVFU1RfRklFTERf\nTlVNQkVSID0gNTQ7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IGNvbnN1bWVS\nZXF1ZXN0XzsKICAgIHB1YmxpYyBib29sZWFuIGhhc0NvbnN1bWVSZXF1ZXN0\nKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDA4MCkg\nPT0gMHgwMDAwMDA4MCk7CiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3Qg\nZ2V0Q29uc3VtZVJlcXVlc3QoKSB7CiAgICAgIHJldHVybiBjb25zdW1lUmVx\ndWVzdF87CiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3RPckJ1aWxkZXIg\nZ2V0Q29uc3VtZVJlcXVlc3RPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiBj\nb25zdW1lUmVxdWVzdF87CiAgICB9CiAgICAKICAgIC8vIG9wdGlvbmFsIC5I\nZWR3aWcuVW5zdWJzY3JpYmVSZXF1ZXN0IHVuc3Vic2NyaWJlUmVxdWVzdCA9\nIDU1OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVU5TVUJTQ1JJQkVS\nRVFVRVNUX0ZJRUxEX05VTUJFUiA9IDU1OwogICAgcHJpdmF0ZSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmli\nZVJlcXVlc3QgdW5zdWJzY3JpYmVSZXF1ZXN0XzsKICAgIHB1YmxpYyBib29s\nZWFuIGhhc1Vuc3Vic2NyaWJlUmVxdWVzdCgpIHsKICAgICAgcmV0dXJuICgo\nYml0RmllbGQwXyAmIDB4MDAwMDAxMDApID09IDB4MDAwMDAxMDApOwogICAg\nfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBnZXRVbnN1YnNjcmliZVJl\ncXVlc3QoKSB7CiAgICAgIHJldHVybiB1bnN1YnNjcmliZVJlcXVlc3RfOwog\nICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdE9yQnVpbGRlciBnZXRV\nbnN1YnNjcmliZVJlcXVlc3RPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiB1\nbnN1YnNjcmliZVJlcXVlc3RfOwogICAgfQogICAgCiAgICAvLyBvcHRpb25h\nbCAuSGVkd2lnLlN0b3BEZWxpdmVyeVJlcXVlc3Qgc3RvcERlbGl2ZXJ5UmVx\ndWVzdCA9IDU2OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RPUERF\nTElWRVJZUkVRVUVTVF9GSUVMRF9OVU1CRVIgPSA1NjsKICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rv\ncERlbGl2ZXJ5UmVxdWVzdCBzdG9wRGVsaXZlcnlSZXF1ZXN0XzsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc1N0b3BEZWxpdmVyeVJlcXVlc3QoKSB7CiAgICAg\nIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMjAwKSA9PSAweDAwMDAw\nMjAwKTsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IGdldFN0\nb3BEZWxpdmVyeVJlcXVlc3QoKSB7CiAgICAgIHJldHVybiBzdG9wRGVsaXZl\ncnlSZXF1ZXN0XzsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0\nT3JCdWlsZGVyIGdldFN0b3BEZWxpdmVyeVJlcXVlc3RPckJ1aWxkZXIoKSB7\nCiAgICAgIHJldHVybiBzdG9wRGVsaXZlcnlSZXF1ZXN0XzsKICAgIH0KICAg\nIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5TdGFydERlbGl2ZXJ5UmVxdWVz\ndCBzdGFydERlbGl2ZXJ5UmVxdWVzdCA9IDU3OwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgU1RBUlRERUxJVkVSWVJFUVVFU1RfRklFTERfTlVNQkVS\nID0gNTc7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHN0YXJ0RGVs\naXZlcnlSZXF1ZXN0XzsKICAgIHB1YmxpYyBib29sZWFuIGhhc1N0YXJ0RGVs\naXZlcnlSZXF1ZXN0KCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDQwMCkgPT0gMHgwMDAwMDQwMCk7CiAgICB9CiAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rh\ncnREZWxpdmVyeVJlcXVlc3QgZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3QoKSB7\nCiAgICAgIHJldHVybiBzdGFydERlbGl2ZXJ5UmVxdWVzdF87CiAgICB9CiAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3RPckJ1aWxkZXIgZ2V0U3RhcnRE\nZWxpdmVyeVJlcXVlc3RPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiBzdGFy\ndERlbGl2ZXJ5UmVxdWVzdF87CiAgICB9CiAgICAKICAgIC8vIG9wdGlvbmFs\nIC5IZWR3aWcuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0IGNsb3NlU3Vic2Ny\naXB0aW9uUmVxdWVzdCA9IDU4OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgQ0xPU0VTVUJTQ1JJUFRJT05SRVFVRVNUX0ZJRUxEX05VTUJFUiA9IDU4\nOwogICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QgY2xvc2VTdWJz\nY3JpcHRpb25SZXF1ZXN0XzsKICAgIHB1YmxpYyBib29sZWFuIGhhc0Nsb3Nl\nU3Vic2NyaXB0aW9uUmVxdWVzdCgpIHsKICAgICAgcmV0dXJuICgoYml0Rmll\nbGQwXyAmIDB4MDAwMDA4MDApID09IDB4MDAwMDA4MDApOwogICAgfQogICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCBnZXRDbG9zZVN1YnNjcmlw\ndGlvblJlcXVlc3QoKSB7CiAgICAgIHJldHVybiBjbG9zZVN1YnNjcmlwdGlv\nblJlcXVlc3RfOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVx\ndWVzdE9yQnVpbGRlciBnZXRDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RPckJ1\naWxkZXIoKSB7CiAgICAgIHJldHVybiBjbG9zZVN1YnNjcmlwdGlvblJlcXVl\nc3RfOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgaW5pdEZpZWxkcygp\nIHsKICAgICAgcHJvdG9jb2xWZXJzaW9uXyA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbi5WRVJT\nSU9OX09ORTsKICAgICAgdHlwZV8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5PcGVyYXRpb25UeXBlLlBVQkxJU0g7CiAg\nICAgIHRyaWVkU2VydmVyc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1w\ndHlMaXN0KCk7OwogICAgICB0eG5JZF8gPSAwTDsKICAgICAgc2hvdWxkQ2xh\naW1fID0gZmFsc2U7CiAgICAgIHRvcGljXyA9IGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgcHVibGlzaFJlcXVlc3RfID0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVi\nbGlzaFJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIHN1YnNj\ncmliZVJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFu\nY2UoKTsKICAgICAgY29uc3VtZVJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIHVuc3Vic2NyaWJlUmVxdWVzdF8g\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5V\nbnN1YnNjcmliZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAg\nIHN0b3BEZWxpdmVyeVJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdC5nZXRE\nZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgc3RhcnREZWxpdmVyeVJlcXVlc3Rf\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RhcnREZWxpdmVyeVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICAgIGNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlv\nblJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICB9CiAgICBwcml2\nYXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7CiAgICBwdWJs\naWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBieXRl\nIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAgICAg\nIGlmIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4gaXNJbml0aWFsaXpl\nZCA9PSAxOwogICAgICAKICAgICAgaWYgKCFoYXNQcm90b2NvbFZlcnNpb24o\nKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICghaGFzVHlwZSgp\nKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMDsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCFoYXNUeG5JZCgp\nKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMDsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCFoYXNUb3BpYygp\nKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMDsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKGhhc1B1Ymxpc2hS\nZXF1ZXN0KCkpIHsKICAgICAgICBpZiAoIWdldFB1Ymxpc2hSZXF1ZXN0KCku\naXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICBtZW1vaXplZElzSW5pdGlh\nbGl6ZWQgPSAwOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nICAgICAgfQogICAgICBpZiAoaGFzU3Vic2NyaWJlUmVxdWVzdCgpKSB7CiAg\nICAgICAgaWYgKCFnZXRTdWJzY3JpYmVSZXF1ZXN0KCkuaXNJbml0aWFsaXpl\nZCgpKSB7CiAgICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAwOwog\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAg\nICBpZiAoaGFzQ29uc3VtZVJlcXVlc3QoKSkgewogICAgICAgIGlmICghZ2V0\nQ29uc3VtZVJlcXVlc3QoKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAg\nIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChoYXNVbnN1YnNj\ncmliZVJlcXVlc3QoKSkgewogICAgICAgIGlmICghZ2V0VW5zdWJzY3JpYmVS\nZXF1ZXN0KCkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICBtZW1vaXpl\nZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaGFzU3RvcERlbGl2ZXJ5UmVx\ndWVzdCgpKSB7CiAgICAgICAgaWYgKCFnZXRTdG9wRGVsaXZlcnlSZXF1ZXN0\nKCkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICBtZW1vaXplZElzSW5p\ndGlhbGl6ZWQgPSAwOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KICAgICAgfQogICAgICBpZiAoaGFzU3RhcnREZWxpdmVyeVJlcXVlc3Qo\nKSkgewogICAgICAgIGlmICghZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3QoKS5p\nc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIG1lbW9pemVkSXNJbml0aWFs\naXplZCA9IDA7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQog\nICAgICB9CiAgICAgIGlmIChoYXNDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3Qo\nKSkgewogICAgICAgIGlmICghZ2V0Q2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0\nKCkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICBtZW1vaXplZElzSW5p\ndGlhbGl6ZWQgPSAwOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KICAgICAgfQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwog\nICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQg\nd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nIG91dHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwog\nICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAw\nMDAwMSkpIHsKICAgICAgICBvdXRwdXQud3JpdGVFbnVtKDEsIHByb3RvY29s\nVmVyc2lvbl8uZ2V0TnVtYmVyKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAg\nICAgIG91dHB1dC53cml0ZUVudW0oMiwgdHlwZV8uZ2V0TnVtYmVyKCkpOwog\nICAgICB9CiAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdHJpZWRTZXJ2ZXJz\nXy5zaXplKCk7IGkrKykgewogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDMs\nIHRyaWVkU2VydmVyc18uZ2V0KGkpKTsKICAgICAgfQogICAgICBpZiAoKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCkpIHsKICAg\nICAgICBvdXRwdXQud3JpdGVVSW50NjQoNCwgdHhuSWRfKTsKICAgICAgfQog\nICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwOCkgPT0gMHgwMDAw\nMDAwOCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCb29sKDUsIHNob3VsZENs\nYWltXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAw\nMDAwMTApID09IDB4MDAwMDAwMTApKSB7CiAgICAgICAgb3V0cHV0LndyaXRl\nQnl0ZXMoNiwgdG9waWNfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAyMCkgPT0gMHgwMDAwMDAyMCkpIHsKICAgICAgICBv\ndXRwdXQud3JpdGVNZXNzYWdlKDUyLCBwdWJsaXNoUmVxdWVzdF8pOwogICAg\nICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDQwKSA9PSAw\neDAwMDAwMDQwKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNTMs\nIHN1YnNjcmliZVJlcXVlc3RfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRG\naWVsZDBfICYgMHgwMDAwMDA4MCkgPT0gMHgwMDAwMDA4MCkpIHsKICAgICAg\nICBvdXRwdXQud3JpdGVNZXNzYWdlKDU0LCBjb25zdW1lUmVxdWVzdF8pOwog\nICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMTAwKSA9\nPSAweDAwMDAwMTAwKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2Uo\nNTUsIHVuc3Vic2NyaWJlUmVxdWVzdF8pOwogICAgICB9CiAgICAgIGlmICgo\nKGJpdEZpZWxkMF8gJiAweDAwMDAwMjAwKSA9PSAweDAwMDAwMjAwKSkgewog\nICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNTYsIHN0b3BEZWxpdmVyeVJl\ncXVlc3RfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDQwMCkgPT0gMHgwMDAwMDQwMCkpIHsKICAgICAgICBvdXRwdXQud3Jp\ndGVNZXNzYWdlKDU3LCBzdGFydERlbGl2ZXJ5UmVxdWVzdF8pOwogICAgICB9\nCiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwODAwKSA9PSAweDAw\nMDAwODAwKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNTgsIGNs\nb3NlU3Vic2NyaXB0aW9uUmVxdWVzdF8pOwogICAgICB9CiAgICAgIGdldFVu\na25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAg\nIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBz\naXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUg\nIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAg\nICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAw\nMSkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlRW51bVNpemUoMSwg\ncHJvdG9jb2xWZXJzaW9uXy5nZXROdW1iZXIoKSk7CiAgICAgIH0KICAgICAg\naWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIp\nKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUVudW1TaXplKDIsIHR5\ncGVfLmdldE51bWJlcigpKTsKICAgICAgfQogICAgICB7CiAgICAgICAgaW50\nIGRhdGFTaXplID0gMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHRy\naWVkU2VydmVyc18uc2l6ZSgpOyBpKyspIHsKICAgICAgICAgIGRhdGFTaXpl\nICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAg\nICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemVOb1RhZyh0cmllZFNlcnZlcnNf\nLmdldChpKSk7CiAgICAgICAgfQogICAgICAgIHNpemUgKz0gZGF0YVNpemU7\nCiAgICAgICAgc2l6ZSArPSAxICogZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpLnNp\nemUoKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwNCkgPT0gMHgwMDAwMDAwNCkpIHsKICAgICAgICBzaXplICs9IGNvbS5n\nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5j\nb21wdXRlVUludDY0U2l6ZSg0LCB0eG5JZF8pOwogICAgICB9CiAgICAgIGlm\nICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAwMDAwMDA4KSkg\newogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVCb29sU2l6ZSg1LCBzaG91\nbGRDbGFpbV8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAw\neDAwMDAwMDEwKSA9PSAweDAwMDAwMDEwKSkgewogICAgICAgIHNpemUgKz0g\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAg\nICAgLmNvbXB1dGVCeXRlc1NpemUoNiwgdG9waWNfKTsKICAgICAgfQogICAg\nICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAyMCkgPT0gMHgwMDAwMDAy\nMCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUo\nNTIsIHB1Ymxpc2hSZXF1ZXN0Xyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwNDApID09IDB4MDAwMDAwNDApKSB7CiAgICAg\nICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3Ry\nZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDUzLCBzdWJzY3Jp\nYmVSZXF1ZXN0Xyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwODApID09IDB4MDAwMDAwODApKSB7CiAgICAgICAgc2l6ZSAr\nPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAg\nICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDU0LCBjb25zdW1lUmVxdWVzdF8p\nOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMTAw\nKSA9PSAweDAwMDAwMTAwKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1\ndGVNZXNzYWdlU2l6ZSg1NSwgdW5zdWJzY3JpYmVSZXF1ZXN0Xyk7CiAgICAg\nIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAyMDApID09IDB4\nMDAwMDAyMDApKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3Nh\nZ2VTaXplKDU2LCBzdG9wRGVsaXZlcnlSZXF1ZXN0Xyk7CiAgICAgIH0KICAg\nICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDA0MDApID09IDB4MDAwMDA0\nMDApKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXpl\nKDU3LCBzdGFydERlbGl2ZXJ5UmVxdWVzdF8pOwogICAgICB9CiAgICAgIGlm\nICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwODAwKSA9PSAweDAwMDAwODAwKSkg\newogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSg1OCwg\nY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0Xyk7CiAgICAgIH0KICAgICAgc2l6\nZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsK\nICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgIHJl\ndHVybiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAgIEBqYXZhLmxhbmcu\nT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcuT2JqZWN0IHdyaXRl\nUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uT2JqZWN0U3RyZWFt\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndyaXRlUmVwbGFjZSgp\nOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcGFy\nc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcGFyc2VGcm9tKAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlM\naXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQo\nKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdCBwYXJzZUZy\nb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdCBwYXJz\nZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52\nYWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0\nU3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5w\ndXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1\nYlJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJl\nYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJTdWJSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRl\ncigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5w\ndXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsK\nICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBhcnNlRGVsaW1p\ndGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlM\naXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVp\nbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20o\naW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBi\ndWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVi\nU3ViUmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAg\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUo\nKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7\nIHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVp\nbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcHJvdG90eXBlKSB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAg\nICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBu\nZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5C\ndWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRlcjsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBl\neHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRN\nZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3Vi\nUmVxdWVzdE9yQnVpbGRlciB7CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAg\nICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlcXVlc3RfZGVzY3JpcHRvcjsKICAg\nICAgfQogICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAg\nICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlcXVlc3RfZmll\nbGRBY2Nlc3NvclRhYmxlOwogICAgICB9CiAgICAgIAogICAgICAvLyBDb25z\ndHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHViU3ViUmVxdWVzdC5uZXdCdWlsZGVyKCkKICAgICAgcHJp\ndmF0ZSBCdWlsZGVyKCkgewogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5p\ndGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBC\ndWlsZGVyKEJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgICAgc3VwZXIo\ncGFyZW50KTsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCk7CiAgICAgIH0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VC\ndWlsZGVySW5pdGlhbGl6YXRpb24oKSB7CiAgICAgICAgaWYgKGNvbS5nb29n\nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5hbHdheXNVc2VGaWVsZEJ1\naWxkZXJzKSB7CiAgICAgICAgICBnZXRQdWJsaXNoUmVxdWVzdEZpZWxkQnVp\nbGRlcigpOwogICAgICAgICAgZ2V0U3Vic2NyaWJlUmVxdWVzdEZpZWxkQnVp\nbGRlcigpOwogICAgICAgICAgZ2V0Q29uc3VtZVJlcXVlc3RGaWVsZEJ1aWxk\nZXIoKTsKICAgICAgICAgIGdldFVuc3Vic2NyaWJlUmVxdWVzdEZpZWxkQnVp\nbGRlcigpOwogICAgICAgICAgZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdEZpZWxk\nQnVpbGRlcigpOwogICAgICAgICAgZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3RG\naWVsZEJ1aWxkZXIoKTsKICAgICAgICAgIGdldENsb3NlU3Vic2NyaXB0aW9u\nUmVxdWVzdEZpZWxkQnVpbGRlcigpOwogICAgICAgIH0KICAgICAgfQogICAg\nICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBy\nZXR1cm4gbmV3IEJ1aWxkZXIoKTsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAgc3VwZXIuY2xlYXIoKTsK\nICAgICAgICBwcm90b2NvbFZlcnNpb25fID0gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uLlZFUlNJ\nT05fT05FOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDAxKTsKICAgICAgICB0eXBlXyA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk9wZXJhdGlvblR5cGUuUFVCTElT\nSDsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAw\nMDAwMik7CiAgICAgICAgdHJpZWRTZXJ2ZXJzXyA9IGphdmEudXRpbC5Db2xs\nZWN0aW9ucy5lbXB0eUxpc3QoKTs7CiAgICAgICAgYml0RmllbGQwXyA9IChi\naXRGaWVsZDBfICYgfjB4MDAwMDAwMDQpOwogICAgICAgIHR4bklkXyA9IDBM\nOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAw\nMDA4KTsKICAgICAgICBzaG91bGRDbGFpbV8gPSBmYWxzZTsKICAgICAgICBi\naXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAxMCk7CiAgICAg\nICAgdG9waWNfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVN\nUFRZOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAw\nMDAwMDIwKTsKICAgICAgICBpZiAocHVibGlzaFJlcXVlc3RCdWlsZGVyXyA9\nPSBudWxsKSB7CiAgICAgICAgICBwdWJsaXNoUmVxdWVzdF8gPSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVx\ndWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgcHVibGlzaFJlcXVlc3RCdWlsZGVyXy5jbGVhcigpOwogICAg\nICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgw\nMDAwMDA0MCk7CiAgICAgICAgaWYgKHN1YnNjcmliZVJlcXVlc3RCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBzdWJzY3JpYmVSZXF1ZXN0XyA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmliZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWlsZGVyXy5jbGVh\ncigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxk\nMF8gJiB+MHgwMDAwMDA4MCk7CiAgICAgICAgaWYgKGNvbnN1bWVSZXF1ZXN0\nQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgY29uc3VtZVJlcXVlc3Rf\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nQ29uc3VtZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIGNvbnN1bWVSZXF1ZXN0QnVpbGRlcl8uY2xl\nYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVs\nZDBfICYgfjB4MDAwMDAxMDApOwogICAgICAgIGlmICh1bnN1YnNjcmliZVJl\ncXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICB1bnN1YnNjcmli\nZVJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5j\nZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB1bnN1YnNjcmliZVJl\ncXVlc3RCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDIwMCk7CiAgICAgICAg\naWYgKHN0b3BEZWxpdmVyeVJlcXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7CiAg\nICAgICAgICBzdG9wRGVsaXZlcnlSZXF1ZXN0XyA9IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVl\nc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgIHN0b3BEZWxpdmVyeVJlcXVlc3RCdWlsZGVyXy5jbGVhcigpOwog\nICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+\nMHgwMDAwMDQwMCk7CiAgICAgICAgaWYgKHN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgc3RhcnREZWxpdmVyeVJl\ncXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNl\nKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXJ0RGVsaXZlcnlS\nZXF1ZXN0QnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0\nRmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDA4MDApOwogICAgICAg\nIGlmIChjbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICBjbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RfID0gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VT\ndWJzY3JpcHRpb25SZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICBjbG9zZVN1YnNjcmlwdGlvblJlcXVl\nc3RCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMTAwMCk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVy\nIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZyb20o\nYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAg\nICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICByZXR1\ncm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHViU3ViUmVxdWVzdC5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZv\nclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QuZ2V0RGVmYXVs\ndEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJS\nZXF1ZXN0IGJ1aWxkKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcmVzdWx0ID0g\nYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFs\naXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVz\nc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJl\ncXVlc3QgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29n\nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsK\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJTdWJSZXF1ZXN0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwog\nICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAg\nICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAg\nICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgYnVpbGRQYXJ0\naWFsKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcmVzdWx0ID0gbmV3IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJl\ncXVlc3QodGhpcyk7CiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJp\ndEZpZWxkMF87CiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOwogICAg\nICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4\nMDAwMDAwMDEpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDE7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5wcm90b2NvbFZlcnNp\nb25fID0gcHJvdG9jb2xWZXJzaW9uXzsKICAgICAgICBpZiAoKChmcm9tX2Jp\ndEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAg\nICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwogICAgICAgIH0K\nICAgICAgICByZXN1bHQudHlwZV8gPSB0eXBlXzsKICAgICAgICBpZiAoKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCkpIHsKICAg\nICAgICAgIHRyaWVkU2VydmVyc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMu\ndW5tb2RpZmlhYmxlTGlzdCh0cmllZFNlcnZlcnNfKTsKICAgICAgICAgIGJp\ndEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA0KTsKICAgICAg\nICB9CiAgICAgICAgcmVzdWx0LnRyaWVkU2VydmVyc18gPSB0cmllZFNlcnZl\ncnNfOwogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDgpID09IDB4MDAwMDAwMDgpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDQ7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC50eG5J\nZF8gPSB0eG5JZF87CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYg\nMHgwMDAwMDAxMCkgPT0gMHgwMDAwMDAxMCkpIHsKICAgICAgICAgIHRvX2Jp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAgICB9CiAgICAgICAgcmVz\ndWx0LnNob3VsZENsYWltXyA9IHNob3VsZENsYWltXzsKICAgICAgICBpZiAo\nKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDIwKSA9PSAweDAwMDAwMDIw\nKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDEwOwog\nICAgICAgIH0KICAgICAgICByZXN1bHQudG9waWNfID0gdG9waWNfOwogICAg\nICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwNDApID09IDB4\nMDAwMDAwNDApKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMjA7CiAgICAgICAgfQogICAgICAgIGlmIChwdWJsaXNoUmVxdWVzdEJ1\naWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJlc3VsdC5wdWJsaXNoUmVx\ndWVzdF8gPSBwdWJsaXNoUmVxdWVzdF87CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgIHJlc3VsdC5wdWJsaXNoUmVxdWVzdF8gPSBwdWJsaXNoUmVxdWVz\ndEJ1aWxkZXJfLmJ1aWxkKCk7CiAgICAgICAgfQogICAgICAgIGlmICgoKGZy\nb21fYml0RmllbGQwXyAmIDB4MDAwMDAwODApID09IDB4MDAwMDAwODApKSB7\nCiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwNDA7CiAgICAg\nICAgfQogICAgICAgIGlmIChzdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgcmVzdWx0LnN1YnNjcmliZVJlcXVlc3RfID0g\nc3Vic2NyaWJlUmVxdWVzdF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nIHJlc3VsdC5zdWJzY3JpYmVSZXF1ZXN0XyA9IHN1YnNjcmliZVJlcXVlc3RC\ndWlsZGVyXy5idWlsZCgpOwogICAgICAgIH0KICAgICAgICBpZiAoKChmcm9t\nX2JpdEZpZWxkMF8gJiAweDAwMDAwMTAwKSA9PSAweDAwMDAwMTAwKSkgewog\nICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDgwOwogICAgICAg\nIH0KICAgICAgICBpZiAoY29uc3VtZVJlcXVlc3RCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICByZXN1bHQuY29uc3VtZVJlcXVlc3RfID0gY29uc3Vt\nZVJlcXVlc3RfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQu\nY29uc3VtZVJlcXVlc3RfID0gY29uc3VtZVJlcXVlc3RCdWlsZGVyXy5idWls\nZCgpOwogICAgICAgIH0KICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8g\nJiAweDAwMDAwMjAwKSA9PSAweDAwMDAwMjAwKSkgewogICAgICAgICAgdG9f\nYml0RmllbGQwXyB8PSAweDAwMDAwMTAwOwogICAgICAgIH0KICAgICAgICBp\nZiAodW5zdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAg\nICAgICAgcmVzdWx0LnVuc3Vic2NyaWJlUmVxdWVzdF8gPSB1bnN1YnNjcmli\nZVJlcXVlc3RfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQu\ndW5zdWJzY3JpYmVSZXF1ZXN0XyA9IHVuc3Vic2NyaWJlUmVxdWVzdEJ1aWxk\nZXJfLmJ1aWxkKCk7CiAgICAgICAgfQogICAgICAgIGlmICgoKGZyb21fYml0\nRmllbGQwXyAmIDB4MDAwMDA0MDApID09IDB4MDAwMDA0MDApKSB7CiAgICAg\nICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAyMDA7CiAgICAgICAgfQog\nICAgICAgIGlmIChzdG9wRGVsaXZlcnlSZXF1ZXN0QnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgcmVzdWx0LnN0b3BEZWxpdmVyeVJlcXVlc3RfID0g\nc3RvcERlbGl2ZXJ5UmVxdWVzdF87CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHJlc3VsdC5zdG9wRGVsaXZlcnlSZXF1ZXN0XyA9IHN0b3BEZWxpdmVy\neVJlcXVlc3RCdWlsZGVyXy5idWlsZCgpOwogICAgICAgIH0KICAgICAgICBp\nZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwODAwKSA9PSAweDAwMDAw\nODAwKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwNDAw\nOwogICAgICAgIH0KICAgICAgICBpZiAoc3RhcnREZWxpdmVyeVJlcXVlc3RC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZXN1bHQuc3RhcnREZWxp\ndmVyeVJlcXVlc3RfID0gc3RhcnREZWxpdmVyeVJlcXVlc3RfOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQuc3RhcnREZWxpdmVyeVJlcXVl\nc3RfID0gc3RhcnREZWxpdmVyeVJlcXVlc3RCdWlsZGVyXy5idWlsZCgpOwog\nICAgICAgIH0KICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAw\nMDAxMDAwKSA9PSAweDAwMDAxMDAwKSkgewogICAgICAgICAgdG9fYml0Rmll\nbGQwXyB8PSAweDAwMDAwODAwOwogICAgICAgIH0KICAgICAgICBpZiAoY2xv\nc2VTdWJzY3JpcHRpb25SZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAg\nICAgICAgcmVzdWx0LmNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdF8gPSBjbG9z\nZVN1YnNjcmlwdGlvblJlcXVlc3RfOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICByZXN1bHQuY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0XyA9IGNsb3Nl\nU3Vic2NyaXB0aW9uUmVxdWVzdEJ1aWxkZXJfLmJ1aWxkKCk7CiAgICAgICAg\nfQogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsK\nICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNv\nbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QpIHsKICAgICAgICAgIHJl\ndHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3Qpb3RoZXIpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdCBvdGhl\ncikgewogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0LmdldERlZmF1\nbHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIu\naGFzUHJvdG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICAgIHNldFByb3RvY29s\nVmVyc2lvbihvdGhlci5nZXRQcm90b2NvbFZlcnNpb24oKSk7CiAgICAgICAg\nfQogICAgICAgIGlmIChvdGhlci5oYXNUeXBlKCkpIHsKICAgICAgICAgIHNl\ndFR5cGUob3RoZXIuZ2V0VHlwZSgpKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKCFvdGhlci50cmllZFNlcnZlcnNfLmlzRW1wdHkoKSkgewogICAgICAgICAg\naWYgKHRyaWVkU2VydmVyc18uaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHRy\naWVkU2VydmVyc18gPSBvdGhlci50cmllZFNlcnZlcnNfOwogICAgICAgICAg\nICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwNCk7CiAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBlbnN1cmVUcmllZFNlcnZl\ncnNJc011dGFibGUoKTsKICAgICAgICAgICAgdHJpZWRTZXJ2ZXJzXy5hZGRB\nbGwob3RoZXIudHJpZWRTZXJ2ZXJzXyk7CiAgICAgICAgICB9CiAgICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhh\nc1R4bklkKCkpIHsKICAgICAgICAgIHNldFR4bklkKG90aGVyLmdldFR4bklk\nKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzU2hvdWxkQ2xh\naW0oKSkgewogICAgICAgICAgc2V0U2hvdWxkQ2xhaW0ob3RoZXIuZ2V0U2hv\ndWxkQ2xhaW0oKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNU\nb3BpYygpKSB7CiAgICAgICAgICBzZXRUb3BpYyhvdGhlci5nZXRUb3BpYygp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc1B1Ymxpc2hSZXF1\nZXN0KCkpIHsKICAgICAgICAgIG1lcmdlUHVibGlzaFJlcXVlc3Qob3RoZXIu\nZ2V0UHVibGlzaFJlcXVlc3QoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChv\ndGhlci5oYXNTdWJzY3JpYmVSZXF1ZXN0KCkpIHsKICAgICAgICAgIG1lcmdl\nU3Vic2NyaWJlUmVxdWVzdChvdGhlci5nZXRTdWJzY3JpYmVSZXF1ZXN0KCkp\nOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzQ29uc3VtZVJlcXVl\nc3QoKSkgewogICAgICAgICAgbWVyZ2VDb25zdW1lUmVxdWVzdChvdGhlci5n\nZXRDb25zdW1lUmVxdWVzdCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90\naGVyLmhhc1Vuc3Vic2NyaWJlUmVxdWVzdCgpKSB7CiAgICAgICAgICBtZXJn\nZVVuc3Vic2NyaWJlUmVxdWVzdChvdGhlci5nZXRVbnN1YnNjcmliZVJlcXVl\nc3QoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNTdG9wRGVs\naXZlcnlSZXF1ZXN0KCkpIHsKICAgICAgICAgIG1lcmdlU3RvcERlbGl2ZXJ5\nUmVxdWVzdChvdGhlci5nZXRTdG9wRGVsaXZlcnlSZXF1ZXN0KCkpOwogICAg\nICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzU3RhcnREZWxpdmVyeVJlcXVl\nc3QoKSkgewogICAgICAgICAgbWVyZ2VTdGFydERlbGl2ZXJ5UmVxdWVzdChv\ndGhlci5nZXRTdGFydERlbGl2ZXJ5UmVxdWVzdCgpKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKG90aGVyLmhhc0Nsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCgp\nKSB7CiAgICAgICAgICBtZXJnZUNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdChv\ndGhlci5nZXRDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QoKSk7CiAgICAgICAg\nfQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVu\na25vd25GaWVsZHMoKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6\nZWQoKSB7CiAgICAgICAgaWYgKCFoYXNQcm90b2NvbFZlcnNpb24oKSkgewog\nICAgICAgICAgCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQog\nICAgICAgIGlmICghaGFzVHlwZSgpKSB7CiAgICAgICAgICAKICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFoYXNUeG5J\nZCgpKSB7CiAgICAgICAgICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CiAgICAgICAgaWYgKCFoYXNUb3BpYygpKSB7CiAgICAgICAgICAK\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYg\nKGhhc1B1Ymxpc2hSZXF1ZXN0KCkpIHsKICAgICAgICAgIGlmICghZ2V0UHVi\nbGlzaFJlcXVlc3QoKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgICAg\nCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgaWYgKGhhc1N1YnNjcmliZVJlcXVlc3QoKSkgewogICAg\nICAgICAgaWYgKCFnZXRTdWJzY3JpYmVSZXF1ZXN0KCkuaXNJbml0aWFsaXpl\nZCgpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChoYXNDb25zdW1l\nUmVxdWVzdCgpKSB7CiAgICAgICAgICBpZiAoIWdldENvbnN1bWVSZXF1ZXN0\nKCkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgIAogICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIGlmIChoYXNVbnN1YnNjcmliZVJlcXVlc3QoKSkgewogICAgICAgICAgaWYg\nKCFnZXRVbnN1YnNjcmliZVJlcXVlc3QoKS5pc0luaXRpYWxpemVkKCkpIHsK\nICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGhhc1N0b3BEZWxpdmVyeVJl\ncXVlc3QoKSkgewogICAgICAgICAgaWYgKCFnZXRTdG9wRGVsaXZlcnlSZXF1\nZXN0KCkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgIAogICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGlmIChoYXNTdGFydERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAgICAg\nICBpZiAoIWdldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkuaXNJbml0aWFsaXpl\nZCgpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChoYXNDbG9zZVN1\nYnNjcmlwdGlvblJlcXVlc3QoKSkgewogICAgICAgICAgaWYgKCFnZXRDbG9z\nZVN1YnNjcmlwdGlvblJlcXVlc3QoKS5pc0luaXRpYWxpemVkKCkpIHsKICAg\nICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5u\nZXdCdWlsZGVyKAogICAgICAgICAgICB0aGlzLmdldFVua25vd25GaWVsZHMo\nKSk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGludCB0YWcg\nPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAgICAgICBzd2l0Y2ggKHRhZykgewog\nICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgdGhpcy5zZXRVbmtu\nb3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAoIXBhcnNl\nVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnks\nIHRhZykpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxk\ncyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgY2FzZSA4OiB7CiAgICAgICAgICAgICAgaW50IHJhd1Zh\nbHVlID0gaW5wdXQucmVhZEVudW0oKTsKICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZl\ncnNpb24gdmFsdWUgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24udmFsdWVPZihyYXdWYWx1ZSk7\nCiAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHVua25vd25GaWVsZHMubWVyZ2VWYXJpbnRGaWVsZCgxLCByYXdW\nYWx1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICAgICAgICAgIHBy\nb3RvY29sVmVyc2lvbl8gPSB2YWx1ZTsKICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2Fz\nZSAxNjogewogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlucHV0LnJl\nYWRFbnVtKCk7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZSB2YWx1ZSA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk9wZXJh\ndGlvblR5cGUudmFsdWVPZihyYXdWYWx1ZSk7CiAgICAgICAgICAgICAgaWYg\nKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHVua25vd25GaWVs\nZHMubWVyZ2VWYXJpbnRGaWVsZCgyLCByYXdWYWx1ZSk7CiAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAwMjsKICAgICAgICAgICAgICAgIHR5cGVfID0gdmFsdWU7CiAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGNhc2UgMjY6IHsKICAgICAgICAgICAgICBlbnN1cmVU\ncmllZFNlcnZlcnNJc011dGFibGUoKTsKICAgICAgICAgICAgICB0cmllZFNl\ncnZlcnNfLmFkZChpbnB1dC5yZWFkQnl0ZXMoKSk7CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAzMjogewog\nICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAg\nICAgICAgICB0eG5JZF8gPSBpbnB1dC5yZWFkVUludDY0KCk7CiAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA0\nMDogewogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAxMDsK\nICAgICAgICAgICAgICBzaG91bGRDbGFpbV8gPSBpbnB1dC5yZWFkQm9vbCgp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgNTA6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMjA7CiAgICAgICAgICAgICAgdG9waWNfID0gaW5wdXQucmVhZEJ5\ndGVzKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgY2FzZSA0MTg6IHsKICAgICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVz\ndC5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdC5uZXdCdWlsZGVy\nKCk7CiAgICAgICAgICAgICAgaWYgKGhhc1B1Ymxpc2hSZXF1ZXN0KCkpIHsK\nICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdldFB1Ymxp\nc2hSZXF1ZXN0KCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBp\nbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3Ry\neSk7CiAgICAgICAgICAgICAgc2V0UHVibGlzaFJlcXVlc3Qoc3ViQnVpbGRl\nci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgY2FzZSA0MjY6IHsKICAgICAgICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0LkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJl\ncXVlc3QubmV3QnVpbGRlcigpOwogICAgICAgICAgICAgIGlmIChoYXNTdWJz\nY3JpYmVSZXF1ZXN0KCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIu\nbWVyZ2VGcm9tKGdldFN1YnNjcmliZVJlcXVlc3QoKSk7CiAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxk\nZXIsIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRTdWJz\nY3JpYmVSZXF1ZXN0KHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNh\nc2UgNDM0OiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QuQnVpbGRlciBz\ndWJCdWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QubmV3QnVpbGRlcigpOwogICAgICAg\nICAgICAgIGlmIChoYXNDb25zdW1lUmVxdWVzdCgpKSB7CiAgICAgICAgICAg\nICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRDb25zdW1lUmVxdWVzdCgp\nKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaW5wdXQucmVhZE1l\nc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAgICAg\nICAgICAgIHNldENvbnN1bWVSZXF1ZXN0KHN1YkJ1aWxkZXIuYnVpbGRQYXJ0\naWFsKCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGNhc2UgNDQyOiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVS\nZXF1ZXN0LkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdC5u\nZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgaWYgKGhhc1Vuc3Vic2NyaWJl\nUmVxdWVzdCgpKSB7CiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdl\nRnJvbShnZXRVbnN1YnNjcmliZVJlcXVlc3QoKSk7CiAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIs\nIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRVbnN1YnNj\ncmliZVJlcXVlc3Qoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2Fz\nZSA0NTA6IHsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LkJ1aWxk\nZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigp\nOwogICAgICAgICAgICAgIGlmIChoYXNTdG9wRGVsaXZlcnlSZXF1ZXN0KCkp\nIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdldFN0\nb3BEZWxpdmVyeVJlcXVlc3QoKSk7CiAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVuc2lv\nblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRTdG9wRGVsaXZlcnlSZXF1\nZXN0KHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgNDU4OiB7\nCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QuQnVpbGRlciBzdWJC\ndWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigpOwogICAg\nICAgICAgICAgIGlmIChoYXNTdGFydERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAg\nICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRTdGFydERl\nbGl2ZXJ5UmVxdWVzdCgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgaW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVn\naXN0cnkpOwogICAgICAgICAgICAgIHNldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgNDY2OiB7CiAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0LkJ1aWxkZXIgc3Vi\nQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdC5uZXdCdWlsZGVyKCk7\nCiAgICAgICAgICAgICAgaWYgKGhhc0Nsb3NlU3Vic2NyaXB0aW9uUmVxdWVz\ndCgpKSB7CiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShn\nZXRDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QoKSk7CiAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIs\nIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRDbG9zZVN1\nYnNjcmlwdGlvblJlcXVlc3Qoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7\nCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50\nIGJpdEZpZWxkMF87CiAgICAgIAogICAgICAvLyByZXF1aXJlZCAuSGVkd2ln\nLlByb3RvY29sVmVyc2lvbiBwcm90b2NvbFZlcnNpb24gPSAxOwogICAgICBw\ncml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlByb3RvY29sVmVyc2lvbiBwcm90b2NvbFZlcnNpb25fID0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xW\nZXJzaW9uLlZFUlNJT05fT05FOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNQ\ncm90b2NvbFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwogICAgICB9CiAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5Qcm90b2NvbFZlcnNpb24gZ2V0UHJvdG9jb2xWZXJzaW9uKCkgewog\nICAgICAgIHJldHVybiBwcm90b2NvbFZlcnNpb25fOwogICAgICB9CiAgICAg\nIHB1YmxpYyBCdWlsZGVyIHNldFByb3RvY29sVmVyc2lvbihvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNp\nb24gdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAg\nICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAg\nICBwcm90b2NvbFZlcnNpb25fID0gdmFsdWU7CiAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGlj\nIEJ1aWxkZXIgY2xlYXJQcm90b2NvbFZlcnNpb24oKSB7CiAgICAgICAgYml0\nRmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAg\nIHByb3RvY29sVmVyc2lvbl8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24uVkVSU0lPTl9PTkU7\nCiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcuT3BlcmF0\naW9uVHlwZSB0eXBlID0gMjsKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5PcGVyYXRpb25UeXBlIHR5\ncGVfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuT3BlcmF0aW9uVHlwZS5QVUJMSVNIOwogICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNUeXBlKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAw\neDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKTsKICAgICAgfQogICAgICBwdWJs\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nT3BlcmF0aW9uVHlwZSBnZXRUeXBlKCkgewogICAgICAgIHJldHVybiB0eXBl\nXzsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRUeXBlKG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk9wZXJhdGlv\nblR5cGUgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewog\nICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAg\nICAgICB0eXBlXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIGNsZWFyVHlwZSgpIHsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxk\nMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAgdHlwZV8gPSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5PcGVyYXRpb25UeXBl\nLlBVQkxJU0g7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIHJlcGVhdGVkIGJ5dGVz\nIHRyaWVkU2VydmVycyA9IDM7CiAgICAgIHByaXZhdGUgamF2YS51dGlsLkxp\nc3Q8Y29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nPiB0cmllZFNlcnZl\ncnNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOzsKICAg\nICAgcHJpdmF0ZSB2b2lkIGVuc3VyZVRyaWVkU2VydmVyc0lzTXV0YWJsZSgp\nIHsKICAgICAgICBpZiAoISgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09\nIDB4MDAwMDAwMDQpKSB7CiAgICAgICAgICB0cmllZFNlcnZlcnNfID0gbmV3\nIGphdmEudXRpbC5BcnJheUxpc3Q8Y29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nPih0cmllZFNlcnZlcnNfKTsKICAgICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwNDsKICAgICAgICAgfQogICAgICB9CiAgICAgIHB1Ymxp\nYyBqYXZhLnV0aWwuTGlzdDxjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmc+CiAgICAgICAgICBnZXRUcmllZFNlcnZlcnNMaXN0KCkgewogICAgICAg\nIHJldHVybiBqYXZhLnV0aWwuQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlz\ndCh0cmllZFNlcnZlcnNfKTsKICAgICAgfQogICAgICBwdWJsaWMgaW50IGdl\ndFRyaWVkU2VydmVyc0NvdW50KCkgewogICAgICAgIHJldHVybiB0cmllZFNl\ncnZlcnNfLnNpemUoKTsKICAgICAgfQogICAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFRyaWVkU2VydmVycyhpbnQgaW5k\nZXgpIHsKICAgICAgICByZXR1cm4gdHJpZWRTZXJ2ZXJzXy5nZXQoaW5kZXgp\nOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFRyaWVkU2VydmVy\ncygKICAgICAgICAgIGludCBpbmRleCwgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwp\nIHsKICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogIH0K\nICBlbnN1cmVUcmllZFNlcnZlcnNJc011dGFibGUoKTsKICAgICAgICB0cmll\nZFNlcnZlcnNfLnNldChpbmRleCwgdmFsdWUpOwogICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGFkZFRyaWVkU2VydmVycyhjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVs\nbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAg\nfQogIGVuc3VyZVRyaWVkU2VydmVyc0lzTXV0YWJsZSgpOwogICAgICAgIHRy\naWVkU2VydmVyc18uYWRkKHZhbHVlKTsKICAgICAgICBvbkNoYW5nZWQoKTsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBhZGRBbGxUcmllZFNlcnZlcnMoCiAgICAgICAgICBqYXZhLmxhbmcu\nSXRlcmFibGU8PyBleHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZz4gdmFsdWVzKSB7CiAgICAgICAgZW5zdXJlVHJpZWRTZXJ2ZXJzSXNN\ndXRhYmxlKCk7CiAgICAgICAgc3VwZXIuYWRkQWxsKHZhbHVlcywgdHJpZWRT\nZXJ2ZXJzXyk7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJUcmll\nZFNlcnZlcnMoKSB7CiAgICAgICAgdHJpZWRTZXJ2ZXJzXyA9IGphdmEudXRp\nbC5Db2xsZWN0aW9ucy5lbXB0eUxpc3QoKTs7CiAgICAgICAgYml0RmllbGQw\nXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDQpOwogICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICAvLyByZXF1aXJlZCB1aW50NjQgdHhuSWQgPSA0OwogICAgICBwcml2\nYXRlIGxvbmcgdHhuSWRfIDsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzVHhu\nSWQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDgpID09IDB4MDAwMDAwMDgpOwogICAgICB9CiAgICAgIHB1YmxpYyBsb25n\nIGdldFR4bklkKCkgewogICAgICAgIHJldHVybiB0eG5JZF87CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgc2V0VHhuSWQobG9uZyB2YWx1ZSkgewog\nICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAgICB0eG5J\nZF8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclR4\nbklkKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDA4KTsKICAgICAgICB0eG5JZF8gPSAwTDsKICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAK\nICAgICAgLy8gb3B0aW9uYWwgYm9vbCBzaG91bGRDbGFpbSA9IDU7CiAgICAg\nIHByaXZhdGUgYm9vbGVhbiBzaG91bGRDbGFpbV8gOwogICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNTaG91bGRDbGFpbSgpIHsKICAgICAgICByZXR1cm4gKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAxMCkgPT0gMHgwMDAwMDAxMCk7CiAgICAg\nIH0KICAgICAgcHVibGljIGJvb2xlYW4gZ2V0U2hvdWxkQ2xhaW0oKSB7CiAg\nICAgICAgcmV0dXJuIHNob3VsZENsYWltXzsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRTaG91bGRDbGFpbShib29sZWFuIHZhbHVlKSB7CiAg\nICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDEwOwogICAgICAgIHNob3Vs\nZENsYWltXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nZWFyU2hvdWxkQ2xhaW0oKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRG\naWVsZDBfICYgfjB4MDAwMDAwMTApOwogICAgICAgIHNob3VsZENsYWltXyA9\nIGZhbHNlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyByZXF1aXJlZCBieXRlcyB0\nb3BpYyA9IDY7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nIHRvcGljXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZy5FTVBUWTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzVG9waWMoKSB7\nCiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMjApID09\nIDB4MDAwMDAwMjApOwogICAgICB9CiAgICAgIHB1YmxpYyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0VG9waWMoKSB7CiAgICAgICAgcmV0\ndXJuIHRvcGljXzsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRU\nb3BpYyhjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsK\nICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51\nbGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAyMDsKICAgICAgICB0b3BpY18gPSB2YWx1ZTsKICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBw\ndWJsaWMgQnVpbGRlciBjbGVhclRvcGljKCkgewogICAgICAgIGJpdEZpZWxk\nMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDIwKTsKICAgICAgICB0b3Bp\nY18gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRUb3BpYygpOwogICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlB1Ymxpc2hSZXF1ZXN0\nIHB1Ymxpc2hSZXF1ZXN0ID0gNTI7CiAgICAgIHByaXZhdGUgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVl\nc3QgcHVibGlzaFJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QuZ2V0RGVmYXVsdElu\nc3RhbmNlKCk7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5T\naW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlcXVlc3QuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3RPckJ1aWxkZXI+IHB1Ymxp\nc2hSZXF1ZXN0QnVpbGRlcl87CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1B1\nYmxpc2hSZXF1ZXN0KCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDQwKSA9PSAweDAwMDAwMDQwKTsKICAgICAgfQogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlcXVlc3QgZ2V0UHVibGlzaFJlcXVlc3QoKSB7CiAgICAg\nICAgaWYgKHB1Ymxpc2hSZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAg\nICAgICAgcmV0dXJuIHB1Ymxpc2hSZXF1ZXN0XzsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmV0dXJuIHB1Ymxpc2hSZXF1ZXN0QnVpbGRlcl8uZ2V0\nTWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRQdWJsaXNoUmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCB2YWx1ZSkgewog\nICAgICAgIGlmIChwdWJsaXNoUmVxdWVzdEJ1aWxkZXJfID09IG51bGwpIHsK\nICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgfQog\nICAgICAgICAgcHVibGlzaFJlcXVlc3RfID0gdmFsdWU7CiAgICAgICAgICBv\nbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHVibGlz\naFJlcXVlc3RCdWlsZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsKICAgICAgICB9\nCiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDQwOwogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFB1\nYmxpc2hSZXF1ZXN0KAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QuQnVpbGRlciBi\ndWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAocHVibGlzaFJlcXVlc3RC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBwdWJsaXNoUmVxdWVzdF8g\nPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwdWJsaXNoUmVxdWVz\ndEJ1aWxkZXJfLnNldE1lc3NhZ2UoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkp\nOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwNDA7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VQdWJsaXNoUmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCB2YWx1ZSkg\newogICAgICAgIGlmIChwdWJsaXNoUmVxdWVzdEJ1aWxkZXJfID09IG51bGwp\nIHsKICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDQwKSA9\nPSAweDAwMDAwMDQwKSAmJgogICAgICAgICAgICAgIHB1Ymxpc2hSZXF1ZXN0\nXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJsaXNoUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAg\nICAgICAgICBwdWJsaXNoUmVxdWVzdF8gPQogICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0Lm5ld0J1aWxkZXIocHVibGlzaFJlcXVlc3RfKS5tZXJnZUZyb20o\ndmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcHVibGlzaFJlcXVlc3RfID0gdmFsdWU7CiAgICAgICAgICB9\nCiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgcHVibGlzaFJlcXVlc3RCdWlsZGVyXy5tZXJnZUZyb20odmFsdWUp\nOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwNDA7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgY2xlYXJQdWJsaXNoUmVxdWVzdCgpIHsKICAgICAgICBpZiAocHVi\nbGlzaFJlcXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBwdWJs\naXNoUmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICBwdWJsaXNoUmVxdWVzdEJ1aWxkZXJfLmNsZWFyKCk7CiAgICAg\nICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAw\nMDAwMDQwKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlcXVlc3QuQnVpbGRlciBnZXRQdWJsaXNoUmVxdWVzdEJ1\naWxkZXIoKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDQwOwog\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiBnZXRQdWJsaXNo\nUmVxdWVzdEZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXIoKTsKICAgICAgfQog\nICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHVibGlzaFJlcXVlc3RPckJ1aWxkZXIgZ2V0UHVibGlzaFJl\ncXVlc3RPckJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKHB1Ymxpc2hSZXF1ZXN0\nQnVpbGRlcl8gIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHB1Ymxpc2hS\nZXF1ZXN0QnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gcHVibGlzaFJlcXVlc3RfOwog\nICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJv\ndG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVl\nc3QsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1Ymxpc2hSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0T3JCdWlsZGVy\nPiAKICAgICAgICAgIGdldFB1Ymxpc2hSZXF1ZXN0RmllbGRCdWlsZGVyKCkg\newogICAgICAgIGlmIChwdWJsaXNoUmVxdWVzdEJ1aWxkZXJfID09IG51bGwp\nIHsKICAgICAgICAgIHB1Ymxpc2hSZXF1ZXN0QnVpbGRlcl8gPSBuZXcgY29t\nLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlcXVlc3QsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0T3JCdWlsZGVyPigKICAgICAgICAgICAgICAgICAgcHVibGlzaFJl\ncXVlc3RfLAogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJl\nbigpLAogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAgICAgICAg\ncHVibGlzaFJlcXVlc3RfID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHB1Ymxpc2hSZXF1ZXN0QnVpbGRlcl87CiAgICAgIH0KICAgICAgCiAg\nICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2NyaWJlUmVxdWVzdCBzdWJz\nY3JpYmVSZXF1ZXN0ID0gNTM7CiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndCBzdWJzY3JpYmVSZXF1ZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuZ2V0RGVmYXVs\ndEluc3RhbmNlKCk7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1\nZi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3RPckJ1aWxk\nZXI+IHN1YnNjcmliZVJlcXVlc3RCdWlsZGVyXzsKICAgICAgcHVibGljIGJv\nb2xlYW4gaGFzU3Vic2NyaWJlUmVxdWVzdCgpIHsKICAgICAgICByZXR1cm4g\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDA4MCkgPT0gMHgwMDAwMDA4MCk7CiAg\nICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgZ2V0U3Vic2NyaWJl\nUmVxdWVzdCgpIHsKICAgICAgICBpZiAoc3Vic2NyaWJlUmVxdWVzdEJ1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBzdWJzY3JpYmVSZXF1\nZXN0XzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHN1YnNj\ncmliZVJlcXVlc3RCdWlsZGVyXy5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1YnNjcmliZVJlcXVl\nc3Qob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdCB2YWx1ZSkgewogICAgICAgIGlmIChzdWJzY3Jp\nYmVSZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZh\nbHVlID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2lu\ndGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBzdWJzY3Jp\nYmVSZXF1ZXN0XyA9IHZhbHVlOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWls\nZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0\nRmllbGQwXyB8PSAweDAwMDAwMDgwOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1YnNjcmliZVJlcXVl\nc3QoCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkJ1aWxkZXIgYnVpbGRlckZv\nclZhbHVlKSB7CiAgICAgICAgaWYgKHN1YnNjcmliZVJlcXVlc3RCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBzdWJzY3JpYmVSZXF1ZXN0XyA9IGJ1\naWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RC\ndWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsK\nICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDgwOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlU3Vic2NyaWJlUmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IHZhbHVl\nKSB7CiAgICAgICAgaWYgKHN1YnNjcmliZVJlcXVlc3RCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDA4\nMCkgPT0gMHgwMDAwMDA4MCkgJiYKICAgICAgICAgICAgICBzdWJzY3JpYmVS\nZXF1ZXN0XyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgp\nKSB7CiAgICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RfID0KICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpYmVSZXF1ZXN0Lm5ld0J1aWxkZXIoc3Vic2NyaWJlUmVxdWVz\ndF8pLm1lcmdlRnJvbSh2YWx1ZSkuYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBzdWJzY3JpYmVSZXF1ZXN0XyA9IHZh\nbHVlOwogICAgICAgICAgfQogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWlsZGVy\nXy5tZXJnZUZyb20odmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfIHw9IDB4MDAwMDAwODA7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVSZXF1ZXN0\nKCkgewogICAgICAgIGlmIChzdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgc3Vic2NyaWJlUmVxdWVzdF8gPSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1YnNjcmliZVJl\ncXVlc3RCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDA4MCk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVl\nc3QuQnVpbGRlciBnZXRTdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcigpIHsKICAg\nICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwODA7CiAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgcmV0dXJuIGdldFN1YnNjcmliZVJlcXVlc3RGaWVs\nZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgcHVibGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmliZVJlcXVlc3RPckJ1aWxkZXIgZ2V0U3Vic2NyaWJlUmVxdWVzdE9y\nQnVpbGRlcigpIHsKICAgICAgICBpZiAoc3Vic2NyaWJlUmVxdWVzdEJ1aWxk\nZXJfICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybiBzdWJzY3JpYmVSZXF1\nZXN0QnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlUmVxdWVzdF87CiAg\nICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90\nb2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1\nZXN0LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpYmVSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3RPckJ1\naWxkZXI+IAogICAgICAgICAgZ2V0U3Vic2NyaWJlUmVxdWVzdEZpZWxkQnVp\nbGRlcigpIHsKICAgICAgICBpZiAoc3Vic2NyaWJlUmVxdWVzdEJ1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWlsZGVy\nXyA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRl\ncjwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlcXVlc3RPckJ1aWxkZXI+KAogICAgICAgICAg\nICAgICAgICBzdWJzY3JpYmVSZXF1ZXN0XywKICAgICAgICAgICAgICAgICAg\nZ2V0UGFyZW50Rm9yQ2hpbGRyZW4oKSwKICAgICAgICAgICAgICAgICAgaXND\nbGVhbigpKTsKICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RfID0gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHN1YnNjcmliZVJlcXVlc3RCdWls\nZGVyXzsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgLkhlZHdp\nZy5Db25zdW1lUmVxdWVzdCBjb25zdW1lUmVxdWVzdCA9IDU0OwogICAgICBw\ncml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkNvbnN1bWVSZXF1ZXN0IGNvbnN1bWVSZXF1ZXN0XyA9IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1\nZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBwcml2YXRlIGNvbS5n\nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29u\nc3VtZVJlcXVlc3QsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0\nT3JCdWlsZGVyPiBjb25zdW1lUmVxdWVzdEJ1aWxkZXJfOwogICAgICBwdWJs\naWMgYm9vbGVhbiBoYXNDb25zdW1lUmVxdWVzdCgpIHsKICAgICAgICByZXR1\ncm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDEwMCkgPT0gMHgwMDAwMDEwMCk7\nCiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IGdldENvbnN1bWVS\nZXF1ZXN0KCkgewogICAgICAgIGlmIChjb25zdW1lUmVxdWVzdEJ1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBjb25zdW1lUmVxdWVzdF87\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBjb25zdW1lUmVx\ndWVzdEJ1aWxkZXJfLmdldE1lc3NhZ2UoKTsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q29uc3VtZVJlcXVlc3Qob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJl\ncXVlc3QgdmFsdWUpIHsKICAgICAgICBpZiAoY29uc3VtZVJlcXVlc3RCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkg\newogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24o\nKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN1bWVSZXF1ZXN0XyA9IHZh\nbHVlOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIGNvbnN1bWVSZXF1ZXN0QnVpbGRlcl8uc2V0TWVzc2FnZSh2\nYWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDEwMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRDb25zdW1lUmVxdWVzdCgKICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVS\nZXF1ZXN0LkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgaWYg\nKGNvbnN1bWVSZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\nY29uc3VtZVJlcXVlc3RfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxkKCk7CiAg\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgY29uc3VtZVJlcXVlc3RCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJG\nb3JWYWx1ZS5idWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQw\nXyB8PSAweDAwMDAwMTAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlQ29uc3VtZVJlcXVlc3Qob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3Vt\nZVJlcXVlc3QgdmFsdWUpIHsKICAgICAgICBpZiAoY29uc3VtZVJlcXVlc3RC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDEwMCkgPT0gMHgwMDAwMDEwMCkgJiYKICAgICAgICAgICAg\nICBjb25zdW1lUmVxdWVzdF8gIT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QuZ2V0RGVmYXVsdElu\nc3RhbmNlKCkpIHsKICAgICAgICAgICAgY29uc3VtZVJlcXVlc3RfID0KICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdC5uZXdCdWlsZGVyKGNvbnN1bWVSZXF1\nZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN1bWVSZXF1ZXN0XyA9IHZh\nbHVlOwogICAgICAgICAgfQogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN1bWVSZXF1ZXN0QnVpbGRlcl8u\nbWVyZ2VGcm9tKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQw\nXyB8PSAweDAwMDAwMTAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ29uc3VtZVJlcXVlc3QoKSB7\nCiAgICAgICAgaWYgKGNvbnN1bWVSZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkg\newogICAgICAgICAgY29uc3VtZVJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3VtZVJlcXVlc3RCdWlsZGVy\nXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJp\ndEZpZWxkMF8gJiB+MHgwMDAwMDEwMCk7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LkJ1aWxkZXIgZ2V0\nQ29uc3VtZVJlcXVlc3RCdWlsZGVyKCkgewogICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDEwMDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICBy\nZXR1cm4gZ2V0Q29uc3VtZVJlcXVlc3RGaWVsZEJ1aWxkZXIoKS5nZXRCdWls\nZGVyKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0T3JCdWls\nZGVyIGdldENvbnN1bWVSZXF1ZXN0T3JCdWlsZGVyKCkgewogICAgICAgIGlm\nIChjb25zdW1lUmVxdWVzdEJ1aWxkZXJfICE9IG51bGwpIHsKICAgICAgICAg\nIHJldHVybiBjb25zdW1lUmVxdWVzdEJ1aWxkZXJfLmdldE1lc3NhZ2VPckJ1\naWxkZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGNv\nbnN1bWVSZXF1ZXN0XzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0\nZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkNvbnN1bWVSZXF1ZXN0LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdC5CdWlsZGVyLCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1l\nUmVxdWVzdE9yQnVpbGRlcj4gCiAgICAgICAgICBnZXRDb25zdW1lUmVxdWVz\ndEZpZWxkQnVpbGRlcigpIHsKICAgICAgICBpZiAoY29uc3VtZVJlcXVlc3RC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBjb25zdW1lUmVxdWVzdEJ1\naWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRC\ndWlsZGVyPAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVz\ndC5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdE9yQnVpbGRlcj4oCiAgICAgICAgICAg\nICAgICAgIGNvbnN1bWVSZXF1ZXN0XywKICAgICAgICAgICAgICAgICAgZ2V0\nUGFyZW50Rm9yQ2hpbGRyZW4oKSwKICAgICAgICAgICAgICAgICAgaXNDbGVh\nbigpKTsKICAgICAgICAgIGNvbnN1bWVSZXF1ZXN0XyA9IG51bGw7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBjb25zdW1lUmVxdWVzdEJ1aWxkZXJfOwog\nICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlVuc3Vi\nc2NyaWJlUmVxdWVzdCB1bnN1YnNjcmliZVJlcXVlc3QgPSA1NTsKICAgICAg\ncHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgdW5zdWJzY3JpYmVSZXF1ZXN0XyA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVu\nc3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\ncHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRl\ncjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCwgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0\nLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdE9yQnVpbGRlcj4gdW5zdWJzY3Jp\nYmVSZXF1ZXN0QnVpbGRlcl87CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1Vu\nc3Vic2NyaWJlUmVxdWVzdCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDIwMCkgPT0gMHgwMDAwMDIwMCk7CiAgICAgIH0KICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBnZXRVbnN1YnNjcmliZVJlcXVl\nc3QoKSB7CiAgICAgICAgaWYgKHVuc3Vic2NyaWJlUmVxdWVzdEJ1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiB1bnN1YnNjcmliZVJlcXVl\nc3RfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gdW5zdWJz\nY3JpYmVSZXF1ZXN0QnVpbGRlcl8uZ2V0TWVzc2FnZSgpOwogICAgICAgIH0K\nICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRVbnN1YnNjcmliZVJl\ncXVlc3Qob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IHZhbHVlKSB7CiAgICAgICAgaWYgKHVu\nc3Vic2NyaWJlUmVxdWVzdEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAg\nIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBO\ndWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgfQogICAgICAgICAg\ndW5zdWJzY3JpYmVSZXF1ZXN0XyA9IHZhbHVlOwogICAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHVuc3Vic2NyaWJl\nUmVxdWVzdEJ1aWxkZXJfLnNldE1lc3NhZ2UodmFsdWUpOwogICAgICAgIH0K\nICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAyMDA7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0VW5z\ndWJzY3JpYmVSZXF1ZXN0KAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0LkJ1\naWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgaWYgKHVuc3Vic2Ny\naWJlUmVxdWVzdEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHVuc3Vi\nc2NyaWJlUmVxdWVzdF8gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAg\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICB1bnN1YnNjcmliZVJlcXVlc3RCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxk\nZXJGb3JWYWx1ZS5idWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgYml0Rmll\nbGQwXyB8PSAweDAwMDAwMjAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlVW5zdWJzY3JpYmVSZXF1\nZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlVuc3Vic2NyaWJlUmVxdWVzdCB2YWx1ZSkgewogICAgICAgIGlmICh1bnN1\nYnNjcmliZVJlcXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBp\nZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDIwMCkgPT0gMHgwMDAwMDIwMCkg\nJiYKICAgICAgICAgICAgICB1bnN1YnNjcmliZVJlcXVlc3RfICE9IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2Ny\naWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAgICAgICAg\nICB1bnN1YnNjcmliZVJlcXVlc3RfID0KICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmli\nZVJlcXVlc3QubmV3QnVpbGRlcih1bnN1YnNjcmliZVJlcXVlc3RfKS5tZXJn\nZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgdW5zdWJzY3JpYmVSZXF1ZXN0XyA9IHZhbHVlOwog\nICAgICAgICAgfQogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHVuc3Vic2NyaWJlUmVxdWVzdEJ1aWxkZXJfLm1l\ncmdlRnJvbSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDIwMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclVuc3Vic2NyaWJlUmVxdWVzdCgp\nIHsKICAgICAgICBpZiAodW5zdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgdW5zdWJzY3JpYmVSZXF1ZXN0XyA9IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2Ny\naWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgIG9u\nQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB1bnN1YnNj\ncmliZVJlcXVlc3RCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAg\nICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDIwMCk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2Ny\naWJlUmVxdWVzdC5CdWlsZGVyIGdldFVuc3Vic2NyaWJlUmVxdWVzdEJ1aWxk\nZXIoKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMjAwOwogICAg\nICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiBnZXRVbnN1YnNjcmli\nZVJlcXVlc3RGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKCk7CiAgICAgIH0K\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdE9yQnVpbGRlciBnZXRVbnN1\nYnNjcmliZVJlcXVlc3RPckJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKHVuc3Vi\nc2NyaWJlUmVxdWVzdEJ1aWxkZXJfICE9IG51bGwpIHsKICAgICAgICAgIHJl\ndHVybiB1bnN1YnNjcmliZVJlcXVlc3RCdWlsZGVyXy5nZXRNZXNzYWdlT3JC\ndWlsZGVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB1\nbnN1YnNjcmliZVJlcXVlc3RfOwogICAgICAgIH0KICAgICAgfQogICAgICBw\ncml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVy\nPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0LCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3Qu\nQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0T3JCdWlsZGVyPiAKICAgICAgICAg\nIGdldFVuc3Vic2NyaWJlUmVxdWVzdEZpZWxkQnVpbGRlcigpIHsKICAgICAg\nICBpZiAodW5zdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewog\nICAgICAgICAgdW5zdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcl8gPSBuZXcgY29t\nLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuVW5zdWJzY3JpYmVSZXF1ZXN0LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QuQnVpbGRl\nciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nVW5zdWJzY3JpYmVSZXF1ZXN0T3JCdWlsZGVyPigKICAgICAgICAgICAgICAg\nICAgdW5zdWJzY3JpYmVSZXF1ZXN0XywKICAgICAgICAgICAgICAgICAgZ2V0\nUGFyZW50Rm9yQ2hpbGRyZW4oKSwKICAgICAgICAgICAgICAgICAgaXNDbGVh\nbigpKTsKICAgICAgICAgIHVuc3Vic2NyaWJlUmVxdWVzdF8gPSBudWxsOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdW5zdWJzY3JpYmVSZXF1ZXN0QnVp\nbGRlcl87CiAgICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3\naWcuU3RvcERlbGl2ZXJ5UmVxdWVzdCBzdG9wRGVsaXZlcnlSZXF1ZXN0ID0g\nNTY7CiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBzdG9wRGVsaXZl\ncnlSZXF1ZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5n\nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LCBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9w\nRGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3RPckJ1\naWxkZXI+IHN0b3BEZWxpdmVyeVJlcXVlc3RCdWlsZGVyXzsKICAgICAgcHVi\nbGljIGJvb2xlYW4gaGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCgpIHsKICAgICAg\nICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDQwMCkgPT0gMHgwMDAw\nMDQwMCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3Qg\nZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdCgpIHsKICAgICAgICBpZiAoc3RvcERl\nbGl2ZXJ5UmVxdWVzdEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJl\ndHVybiBzdG9wRGVsaXZlcnlSZXF1ZXN0XzsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgcmV0dXJuIHN0b3BEZWxpdmVyeVJlcXVlc3RCdWlsZGVyXy5n\nZXRNZXNzYWdlKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBC\ndWlsZGVyIHNldFN0b3BEZWxpdmVyeVJlcXVlc3Qob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVz\ndCB2YWx1ZSkgewogICAgICAgIGlmIChzdG9wRGVsaXZlcnlSZXF1ZXN0QnVp\nbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9u\nKCk7CiAgICAgICAgICB9CiAgICAgICAgICBzdG9wRGVsaXZlcnlSZXF1ZXN0\nXyA9IHZhbHVlOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHN0b3BEZWxpdmVyeVJlcXVlc3RCdWlsZGVyXy5z\nZXRNZXNzYWdlKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQw\nXyB8PSAweDAwMDAwNDAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN0b3BEZWxpdmVyeVJlcXVlc3Qo\nCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIgYnVpbGRlckZv\nclZhbHVlKSB7CiAgICAgICAgaWYgKHN0b3BEZWxpdmVyeVJlcXVlc3RCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBzdG9wRGVsaXZlcnlSZXF1ZXN0\nXyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0b3BEZWxpdmVy\neVJlcXVlc3RCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5i\ndWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAw\nMDAwNDAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlU3RvcERlbGl2ZXJ5UmVxdWVzdChvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZl\ncnlSZXF1ZXN0IHZhbHVlKSB7CiAgICAgICAgaWYgKHN0b3BEZWxpdmVyeVJl\ncXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRG\naWVsZDBfICYgMHgwMDAwMDQwMCkgPT0gMHgwMDAwMDQwMCkgJiYKICAgICAg\nICAgICAgICBzdG9wRGVsaXZlcnlSZXF1ZXN0XyAhPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1\nZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAgICAgIHN0b3BE\nZWxpdmVyeVJlcXVlc3RfID0KICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1\nZXN0Lm5ld0J1aWxkZXIoc3RvcERlbGl2ZXJ5UmVxdWVzdF8pLm1lcmdlRnJv\nbSh2YWx1ZSkuYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBzdG9wRGVsaXZlcnlSZXF1ZXN0XyA9IHZhbHVlOwogICAg\nICAgICAgfQogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHN0b3BEZWxpdmVyeVJlcXVlc3RCdWlsZGVyXy5tZXJn\nZUZyb20odmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9\nIDB4MDAwMDA0MDA7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdG9wRGVsaXZlcnlSZXF1ZXN0KCkg\newogICAgICAgIGlmIChzdG9wRGVsaXZlcnlSZXF1ZXN0QnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgc3RvcERlbGl2ZXJ5UmVxdWVzdF8gPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVs\naXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0b3BE\nZWxpdmVyeVJlcXVlc3RCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAg\nICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDQwMCk7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BE\nZWxpdmVyeVJlcXVlc3QuQnVpbGRlciBnZXRTdG9wRGVsaXZlcnlSZXF1ZXN0\nQnVpbGRlcigpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDA0MDA7\nCiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIGdldFN0b3BE\nZWxpdmVyeVJlcXVlc3RGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKCk7CiAg\nICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3RPckJ1aWxkZXIg\nZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdE9yQnVpbGRlcigpIHsKICAgICAgICBp\nZiAoc3RvcERlbGl2ZXJ5UmVxdWVzdEJ1aWxkZXJfICE9IG51bGwpIHsKICAg\nICAgICAgIHJldHVybiBzdG9wRGVsaXZlcnlSZXF1ZXN0QnVpbGRlcl8uZ2V0\nTWVzc2FnZU9yQnVpbGRlcigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICByZXR1cm4gc3RvcERlbGl2ZXJ5UmVxdWVzdF87CiAgICAgICAgfQogICAg\nICB9CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVG\naWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVs\naXZlcnlSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3RPckJ1aWxk\nZXI+IAogICAgICAgICAgZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdEZpZWxkQnVp\nbGRlcigpIHsKICAgICAgICBpZiAoc3RvcERlbGl2ZXJ5UmVxdWVzdEJ1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIHN0b3BEZWxpdmVyeVJlcXVlc3RC\ndWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxk\nQnVpbGRlcjwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVs\naXZlcnlSZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3RPckJ1aWxk\nZXI+KAogICAgICAgICAgICAgICAgICBzdG9wRGVsaXZlcnlSZXF1ZXN0XywK\nICAgICAgICAgICAgICAgICAgZ2V0UGFyZW50Rm9yQ2hpbGRyZW4oKSwKICAg\nICAgICAgICAgICAgICAgaXNDbGVhbigpKTsKICAgICAgICAgIHN0b3BEZWxp\ndmVyeVJlcXVlc3RfID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHN0b3BEZWxpdmVyeVJlcXVlc3RCdWlsZGVyXzsKICAgICAgfQogICAgICAK\nICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5TdGFydERlbGl2ZXJ5UmVxdWVz\ndCBzdGFydERlbGl2ZXJ5UmVxdWVzdCA9IDU3OwogICAgICBwcml2YXRlIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0\nRGVsaXZlcnlSZXF1ZXN0IHN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyA9IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBwcml2\nYXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAog\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QsIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0T3JCdWlsZGVyPiBzdGFydERl\nbGl2ZXJ5UmVxdWVzdEJ1aWxkZXJfOwogICAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNTdGFydERlbGl2ZXJ5UmVxdWVzdCgpIHsKICAgICAgICByZXR1cm4gKChi\naXRGaWVsZDBfICYgMHgwMDAwMDgwMCkgPT0gMHgwMDAwMDgwMCk7CiAgICAg\nIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IGdldFN0YXJ0RGVs\naXZlcnlSZXF1ZXN0KCkgewogICAgICAgIGlmIChzdGFydERlbGl2ZXJ5UmVx\ndWVzdEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBzdGFy\ndERlbGl2ZXJ5UmVxdWVzdF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nIHJldHVybiBzdGFydERlbGl2ZXJ5UmVxdWVzdEJ1aWxkZXJfLmdldE1lc3Nh\nZ2UoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0U3RhcnREZWxpdmVyeVJlcXVlc3Qob3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgdmFs\ndWUpIHsKICAgICAgICBpZiAoc3RhcnREZWxpdmVyeVJlcXVlc3RCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsK\nICAgICAgICAgIH0KICAgICAgICAgIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyA9\nIHZhbHVlOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0QnVpbGRlcl8uc2V0\nTWVzc2FnZSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDgwMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdGFydERlbGl2ZXJ5UmVxdWVzdCgK\nICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIgYnVpbGRlckZv\nclZhbHVlKSB7CiAgICAgICAgaWYgKHN0YXJ0RGVsaXZlcnlSZXF1ZXN0QnVp\nbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgc3RhcnREZWxpdmVyeVJlcXVl\nc3RfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3RhcnREZWxp\ndmVyeVJlcXVlc3RCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1\nZS5idWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAw\neDAwMDAwODAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIHB1YmxpYyBCdWlsZGVyIG1lcmdlU3RhcnREZWxpdmVyeVJlcXVlc3Qob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnRE\nZWxpdmVyeVJlcXVlc3QgdmFsdWUpIHsKICAgICAgICBpZiAoc3RhcnREZWxp\ndmVyeVJlcXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAo\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDgwMCkgPT0gMHgwMDAwMDgwMCkgJiYK\nICAgICAgICAgICAgICBzdGFydERlbGl2ZXJ5UmVxdWVzdF8gIT0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxp\ndmVyeVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAgICAgICAg\nICAgc3RhcnREZWxpdmVyeVJlcXVlc3RfID0KICAgICAgICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERl\nbGl2ZXJ5UmVxdWVzdC5uZXdCdWlsZGVyKHN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nXykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyA9\nIHZhbHVlOwogICAgICAgICAgfQogICAgICAgICAgb25DaGFuZ2VkKCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nQnVpbGRlcl8ubWVyZ2VGcm9tKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAg\nYml0RmllbGQwXyB8PSAweDAwMDAwODAwOwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3RhcnREZWxp\ndmVyeVJlcXVlc3QoKSB7CiAgICAgICAgaWYgKHN0YXJ0RGVsaXZlcnlSZXF1\nZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgc3RhcnREZWxpdmVy\neVJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgc3RhcnREZWxpdmVyeVJlcXVlc3RCdWlsZGVyXy5jbGVh\ncigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxk\nMF8gJiB+MHgwMDAwMDgwMCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIgZ2V0\nU3RhcnREZWxpdmVyeVJlcXVlc3RCdWlsZGVyKCkgewogICAgICAgIGJpdEZp\nZWxkMF8gfD0gMHgwMDAwMDgwMDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICByZXR1cm4gZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3RGaWVsZEJ1aWxk\nZXIoKS5nZXRCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0T3JCdWlsZGVyIGdldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nT3JCdWlsZGVyKCkgewogICAgICAgIGlmIChzdGFydERlbGl2ZXJ5UmVxdWVz\ndEJ1aWxkZXJfICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybiBzdGFydERl\nbGl2ZXJ5UmVxdWVzdEJ1aWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXIoKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHN0YXJ0RGVsaXZl\ncnlSZXF1ZXN0XzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBj\nb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5CdWls\nZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdGFydERlbGl2ZXJ5UmVxdWVzdE9yQnVpbGRlcj4gCiAgICAgICAgICBn\nZXRTdGFydERlbGl2ZXJ5UmVxdWVzdEZpZWxkQnVpbGRlcigpIHsKICAgICAg\nICBpZiAoc3RhcnREZWxpdmVyeVJlcXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7\nCiAgICAgICAgICBzdGFydERlbGl2ZXJ5UmVxdWVzdEJ1aWxkZXJfID0gbmV3\nIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAg\nICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVz\ndC5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdE9yQnVpbGRlcj4oCiAgICAg\nICAgICAgICAgICAgIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0XywKICAgICAgICAg\nICAgICAgICAgZ2V0UGFyZW50Rm9yQ2hpbGRyZW4oKSwKICAgICAgICAgICAg\nICAgICAgaXNDbGVhbigpKTsKICAgICAgICAgIHN0YXJ0RGVsaXZlcnlSZXF1\nZXN0XyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdGFydERl\nbGl2ZXJ5UmVxdWVzdEJ1aWxkZXJfOwogICAgICB9CiAgICAgIAogICAgICAv\nLyBvcHRpb25hbCAuSGVkd2lnLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCBj\nbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QgPSA1ODsKICAgICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5DbG9z\nZVN1YnNjcmlwdGlvblJlcXVlc3QgY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0\nXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZp\nZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCwg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xv\nc2VTdWJzY3JpcHRpb25SZXF1ZXN0LkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9u\nUmVxdWVzdE9yQnVpbGRlcj4gY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0QnVp\nbGRlcl87CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc0Nsb3NlU3Vic2NyaXB0\naW9uUmVxdWVzdCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYg\nMHgwMDAwMTAwMCkgPT0gMHgwMDAwMTAwMCk7CiAgICAgIH0KICAgICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCBnZXRDbG9zZVN1YnNjcmlwdGlv\nblJlcXVlc3QoKSB7CiAgICAgICAgaWYgKGNsb3NlU3Vic2NyaXB0aW9uUmVx\ndWVzdEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBjbG9z\nZVN1YnNjcmlwdGlvblJlcXVlc3RfOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICByZXR1cm4gY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0QnVpbGRlcl8u\nZ2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3Qob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3Jp\ncHRpb25SZXF1ZXN0IHZhbHVlKSB7CiAgICAgICAgaWYgKGNsb3NlU3Vic2Ny\naXB0aW9uUmVxdWVzdEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGlm\nICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOdWxs\nUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgfQogICAgICAgICAgY2xv\nc2VTdWJzY3JpcHRpb25SZXF1ZXN0XyA9IHZhbHVlOwogICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNsb3NlU3Vi\nc2NyaXB0aW9uUmVxdWVzdEJ1aWxkZXJfLnNldE1lc3NhZ2UodmFsdWUpOwog\nICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDEwMDA7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxk\nZXIgc2V0Q2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0KAogICAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VT\ndWJzY3JpcHRpb25SZXF1ZXN0LkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7\nCiAgICAgICAgaWYgKGNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdEJ1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIGNsb3NlU3Vic2NyaXB0aW9uUmVxdWVz\ndF8gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjbG9zZVN1YnNj\ncmlwdGlvblJlcXVlc3RCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JW\nYWx1ZS5idWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8\nPSAweDAwMDAxMDAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlQ2xvc2VTdWJzY3JpcHRpb25SZXF1\nZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCB2YWx1ZSkgewogICAgICAgIGlm\nIChjbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RCdWlsZGVyXyA9PSBudWxsKSB7\nCiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMTAwMCkgPT0g\nMHgwMDAwMTAwMCkgJiYKICAgICAgICAgICAgICBjbG9zZVN1YnNjcmlwdGlv\nblJlcXVlc3RfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdC5nZXREZWZhdWx0\nSW5zdGFuY2UoKSkgewogICAgICAgICAgICBjbG9zZVN1YnNjcmlwdGlvblJl\ncXVlc3RfID0KICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3Qu\nbmV3QnVpbGRlcihjbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RfKS5tZXJnZUZy\nb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0XyA9IHZhbHVl\nOwogICAgICAgICAgfQogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIGNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdEJ1\naWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMTAwMDsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNsb3NlU3Vic2Ny\naXB0aW9uUmVxdWVzdCgpIHsKICAgICAgICBpZiAoY2xvc2VTdWJzY3JpcHRp\nb25SZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgY2xvc2VT\ndWJzY3JpcHRpb25SZXF1ZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdC5n\nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjbG9zZVN1YnNjcmlwdGlvblJl\ncXVlc3RCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMTAwMCk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0\naW9uUmVxdWVzdC5CdWlsZGVyIGdldENsb3NlU3Vic2NyaXB0aW9uUmVxdWVz\ndEJ1aWxkZXIoKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAxMDAw\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiBnZXRDbG9z\nZVN1YnNjcmlwdGlvblJlcXVlc3RGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVy\nKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVz\ndE9yQnVpbGRlciBnZXRDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RPckJ1aWxk\nZXIoKSB7CiAgICAgICAgaWYgKGNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdEJ1\naWxkZXJfICE9IG51bGwpIHsKICAgICAgICAgIHJldHVybiBjbG9zZVN1YnNj\ncmlwdGlvblJlcXVlc3RCdWlsZGVyXy5nZXRNZXNzYWdlT3JCdWlsZGVyKCk7\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBjbG9zZVN1YnNj\ncmlwdGlvblJlcXVlc3RfOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2\nYXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAog\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0LCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlv\nblJlcXVlc3QuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0T3JCdWls\nZGVyPiAKICAgICAgICAgIGdldENsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdEZp\nZWxkQnVpbGRlcigpIHsKICAgICAgICBpZiAoY2xvc2VTdWJzY3JpcHRpb25S\nZXF1ZXN0QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgY2xvc2VTdWJz\nY3JpcHRpb25SZXF1ZXN0QnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90\nb2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJz\nY3JpcHRpb25SZXF1ZXN0LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QuQnVpbGRl\nciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0T3JCdWlsZGVyPigKICAgICAgICAg\nICAgICAgICAgY2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0XywKICAgICAgICAg\nICAgICAgICAgZ2V0UGFyZW50Rm9yQ2hpbGRyZW4oKSwKICAgICAgICAgICAg\nICAgICAgaXNDbGVhbigpKTsKICAgICAgICAgIGNsb3NlU3Vic2NyaXB0aW9u\nUmVxdWVzdF8gPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2xv\nc2VTdWJzY3JpcHRpb25SZXF1ZXN0QnVpbGRlcl87CiAgICAgIH0KICAgICAg\nCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Nj\nb3BlOkhlZHdpZy5QdWJTdWJSZXF1ZXN0KQogICAgfQogICAgCiAgICBzdGF0\naWMgewogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgUHViU3ViUmVxdWVz\ndCh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsK\nICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNs\nYXNzX3Njb3BlOkhlZHdpZy5QdWJTdWJSZXF1ZXN0KQogIH0KICAKICBwdWJs\naWMgaW50ZXJmYWNlIFB1Ymxpc2hSZXF1ZXN0T3JCdWlsZGVyCiAgICAgIGV4\ndGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsK\nICAgIAogICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5NZXNzYWdlIG1zZyA9IDI7\nCiAgICBib29sZWFuIGhhc01zZygpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBnZXRNc2coKTsKICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VPckJ1aWxkZXIgZ2V0TXNnT3JCdWlsZGVyKCk7CiAgfQogIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgY2xhc3MgUHVibGlzaFJlcXVlc3QgZXh0ZW5kcwog\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAg\nICAgaW1wbGVtZW50cyBQdWJsaXNoUmVxdWVzdE9yQnVpbGRlciB7CiAgICAv\nLyBVc2UgUHVibGlzaFJlcXVlc3QubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVj\ndC4KICAgIHByaXZhdGUgUHVibGlzaFJlcXVlc3QoQnVpbGRlciBidWlsZGVy\nKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwogICAgfQogICAgcHJpdmF0ZSBQ\ndWJsaXNoUmVxdWVzdChib29sZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgUHVibGlzaFJlcXVlc3QgZGVmYXVsdEluc3Rh\nbmNlOwogICAgcHVibGljIHN0YXRpYyBQdWJsaXNoUmVxdWVzdCBnZXREZWZh\ndWx0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBQdWJsaXNoUmVxdWVzdCBnZXREZWZh\ndWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdElu\nc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICB9CiAg\nICAKICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRl\nZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxH\nZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJs\nZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAg\nIC8vIHJlcXVpcmVkIC5IZWR3aWcuTWVzc2FnZSBtc2cgPSAyOwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgTVNHX0ZJRUxEX05VTUJFUiA9IDI7CiAg\nICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2UgbXNnXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc01z\nZygpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEp\nID09IDB4MDAwMDAwMDEpOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgZ2V0TXNn\nKCkgewogICAgICByZXR1cm4gbXNnXzsKICAgIH0KICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nT3JCdWlsZGVyIGdldE1zZ09yQnVpbGRlcigpIHsKICAgICAgcmV0dXJuIG1z\nZ187CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkg\newogICAgICBtc2dfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAg\nIH0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAt\nMTsKICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7\nCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFs\naXplZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgIT0gLTEpIHJldHVybiBp\nc0luaXRpYWxpemVkID09IDE7CiAgICAgIAogICAgICBpZiAoIWhhc01zZygp\nKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMDsKICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKCFnZXRNc2coKS5p\nc0luaXRpYWxpemVkKCkpIHsKICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6\nZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBt\nZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBv\ndXRwdXQud3JpdGVNZXNzYWdlKDIsIG1zZ18pOwogICAgICB9CiAgICAgIGdl\ndFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsK\nICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGlu\ndCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNp\nemUgIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwog\nICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAw\nMDAwMSkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNp\nemUoMiwgbXNnXyk7CiAgICAgIH0KICAgICAgc2l6ZSArPSBnZXRVbmtub3du\nRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgbWVtb2l6ZWRT\nZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgIHJldHVybiBzaXplOwogICAg\nfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZl\ncnNpb25VSUQgPSAwTDsKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHBy\nb3RlY3RlZCBqYXZhLmxhbmcuT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAg\nICAgdGhyb3dzIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIHN1cGVyLndyaXRlUmVwbGFjZSgpOwogICAgfQogICAgCiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJsaXNoUmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRh\ndGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxp\nZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgcGFyc2VGcm9tKAogICAg\nICAgIGJ5dGVbXSBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2Nv\nbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVi\nbGlzaFJlcXVlc3QgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5w\ndXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3Qg\ncGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQs\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJs\naXNoUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0\ncmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlv\nbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAg\nICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewog\nICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0g\nZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAg\nIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9t\nKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7\nCiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwg\nZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIu\nYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVx\ndWVzdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZElucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMg\nc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlB1Ymxpc2hSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShp\nbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWls\nZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxk\nZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0K\nICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1\ncm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIg\nbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJsaXNoUmVxdWVzdCBwcm90b3R5cGUpIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0K\nICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1\naWxkZXIodGhpcyk7IH0KICAgIAogICAgQGphdmEubGFuZy5PdmVycmlkZQog\nICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxk\nZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\ndyBCdWlsZGVyKHBhcmVudCk7CiAgICAgIHJldHVybiBidWlsZGVyOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVu\nZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuQnVpbGRlcjxCdWlsZGVyPgogICAgICAgaW1wbGVtZW50cyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVx\ndWVzdE9yQnVpbGRlciB7CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29t\nLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAg\nICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICAg\nIH0KICAgICAgCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAg\nICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVzdF9maWVs\nZEFjY2Vzc29yVGFibGU7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIENvbnN0\ncnVjdCB1c2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJsaXNoUmVxdWVzdC5uZXdCdWlsZGVyKCkKICAgICAgcHJp\ndmF0ZSBCdWlsZGVyKCkgewogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5p\ndGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBC\ndWlsZGVyKEJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgICAgc3VwZXIo\ncGFyZW50KTsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCk7CiAgICAgIH0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VC\ndWlsZGVySW5pdGlhbGl6YXRpb24oKSB7CiAgICAgICAgaWYgKGNvbS5nb29n\nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5hbHdheXNVc2VGaWVsZEJ1\naWxkZXJzKSB7CiAgICAgICAgICBnZXRNc2dGaWVsZEJ1aWxkZXIoKTsKICAg\nICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBj\ncmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAg\nIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAg\nICAgIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgaWYgKG1zZ0J1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIG1zZ18gPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERlZmF1bHRJbnN0\nYW5jZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtc2dCdWlsZGVy\nXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJp\ndEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkg\newogICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0\naWFsKCkpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBn\nZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJl\ncXVlc3QuZ2V0RGVzY3JpcHRvcigpOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgp\nIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVz\ndCBidWlsZCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCByZXN1bHQgPSBidWls\nZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVk\nKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdl\nRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\nZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVl\nc3QgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJsaXNoUmVxdWVzdCByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAg\nICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAg\nIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAg\nICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAg\nIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCBidWlsZFBhcnRp\nYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgcmVzdWx0ID0gbmV3IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0KHRoaXMpOwogICAgICAgIGludCBmcm9tX2JpdEZpZWxkMF8gPSBi\naXRGaWVsZDBfOwogICAgICAgIGludCB0b19iaXRGaWVsZDBfID0gMDsKICAg\nICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAw\neDAwMDAwMDAxKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAw\nMDAwMDAxOwogICAgICAgIH0KICAgICAgICBpZiAobXNnQnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgcmVzdWx0Lm1zZ18gPSBtc2dfOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQubXNnXyA9IG1zZ0J1aWxkZXJf\nLmJ1aWxkKCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBf\nID0gdG9fYml0RmllbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAg\ncmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBv\ndGhlcikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1\nZXN0KSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVz\ndClvdGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1cGVyLm1l\ncmdlRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdl\nRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJsaXNoUmVxdWVzdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJsaXNoUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRo\naXM7CiAgICAgICAgaWYgKG90aGVyLmhhc01zZygpKSB7CiAgICAgICAgICBt\nZXJnZU1zZyhvdGhlci5nZXRNc2coKSk7CiAgICAgICAgfQogICAgICAgIHRo\naXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMo\nKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAg\nICAgaWYgKCFoYXNNc2coKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghZ2V0TXNnKCkuaXNJ\nbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAKICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1\ndCwKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9\nCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNl\ndC5uZXdCdWlsZGVyKAogICAgICAgICAgICB0aGlzLmdldFVua25vd25GaWVs\nZHMoKSk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGludCB0\nYWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAgICAgICBzd2l0Y2ggKHRhZykg\newogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgdGhpcy5zZXRV\nbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAoIXBh\ncnNlVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0\ncnksIHRhZykpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZp\nZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgY2FzZSAxODogewogICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2Uu\nQnVpbGRlciBzdWJCdWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgaWYgKGhhc01zZygpKSB7CiAgICAgICAgICAgICAgICBzdWJC\ndWlsZGVyLm1lcmdlRnJvbShnZXRNc2coKSk7CiAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4\ndGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRNc2coc3ViQnVp\nbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAg\nICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAgIAogICAg\nICAvLyByZXF1aXJlZCAuSGVkd2lnLk1lc3NhZ2UgbXNnID0gMjsKICAgICAg\ncHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlIG1zZ18gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgp\nOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmll\nbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSwgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5CdWlsZGVyLCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nT3JCdWlsZGVyPiBtc2dCdWlsZGVyXzsKICAgICAgcHVibGljIGJvb2xlYW4g\naGFzTXNnKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgICAgfQogICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZSBnZXRNc2coKSB7CiAgICAgICAgaWYgKG1zZ0J1aWxkZXJfID09IG51\nbGwpIHsKICAgICAgICAgIHJldHVybiBtc2dfOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICByZXR1cm4gbXNnQnVpbGRlcl8uZ2V0TWVzc2FnZSgpOwog\nICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNc2co\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZSB2YWx1ZSkgewogICAgICAgIGlmIChtc2dCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAg\nIH0KICAgICAgICAgIG1zZ18gPSB2YWx1ZTsKICAgICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtc2dCdWlsZGVyXy5z\nZXRNZXNzYWdlKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQw\nXyB8PSAweDAwMDAwMDAxOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1zZygKICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2Uu\nQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAobXNnQnVp\nbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgbXNnXyA9IGJ1aWxkZXJGb3JW\nYWx1ZS5idWlsZCgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIG1zZ0J1aWxkZXJfLnNldE1lc3NhZ2UoYnVp\nbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VNc2cob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSB2YWx1\nZSkgewogICAgICAgIGlmIChtc2dCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAg\nICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAw\nMDAwMSkgJiYKICAgICAgICAgICAgICBtc2dfICE9IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UuZ2V0RGVmYXVs\ndEluc3RhbmNlKCkpIHsKICAgICAgICAgICAgbXNnXyA9CiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZS5uZXdCdWlsZGVyKG1zZ18pLm1lcmdlRnJvbSh2YWx1ZSkuYnVp\nbGRQYXJ0aWFsKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBt\nc2dfID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbXNnQnVpbGRlcl8ubWVy\nZ2VGcm9tKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8\nPSAweDAwMDAwMDAxOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTXNnKCkgewogICAgICAgIGlmICht\nc2dCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBtc2dfID0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5n\nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtc2dCdWlsZGVyXy5jbGVhcigp\nOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8g\nJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2UuQnVpbGRlciBnZXRNc2dCdWlsZGVyKCkgewog\nICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICByZXR1cm4gZ2V0TXNnRmllbGRCdWlsZGVyKCku\nZ2V0QnVpbGRlcigpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlT3JCdWls\nZGVyIGdldE1zZ09yQnVpbGRlcigpIHsKICAgICAgICBpZiAobXNnQnVpbGRl\ncl8gIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIG1zZ0J1aWxkZXJfLmdl\ndE1lc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgcmV0dXJuIG1zZ187CiAgICAgICAgfQogICAgICB9CiAgICAgIHByaXZh\ndGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VPckJ1aWxkZXI+IAog\nICAgICAgICAgZ2V0TXNnRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmICht\nc2dCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBtc2dCdWlsZGVyXyA9\nIG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwK\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLkJ1aWxkZXIsIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VPckJ1aWxk\nZXI+KAogICAgICAgICAgICAgICAgICBtc2dfLAogICAgICAgICAgICAgICAg\nICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLAogICAgICAgICAgICAgICAgICBp\nc0NsZWFuKCkpOwogICAgICAgICAgbXNnXyA9IG51bGw7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBtc2dCdWlsZGVyXzsKICAgICAgfQogICAgICAKICAg\nICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6\nSGVkd2lnLlB1Ymxpc2hSZXF1ZXN0KQogICAgfQogICAgCiAgICBzdGF0aWMg\newogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgUHVibGlzaFJlcXVlc3Qo\ndHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAg\nICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFz\nc19zY29wZTpIZWR3aWcuUHVibGlzaFJlcXVlc3QpCiAgfQogIAogIHB1Ymxp\nYyBpbnRlcmZhY2UgU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXNPckJ1aWxkZXIK\nICAgICAgZXh0ZW5kcyBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1\naWxkZXIgewogICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLk1hcCBvcHRp\nb25zID0gMTsKICAgIGJvb2xlYW4gaGFzT3B0aW9ucygpOwogICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIGdldE9w\ndGlvbnMoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1hcE9yQnVpbGRlciBnZXRPcHRpb25zT3JCdWlsZGVyKCk7\nCiAgICAKICAgIC8vIG9wdGlvbmFsIHVpbnQzMiBtZXNzYWdlQm91bmQgPSAy\nOwogICAgYm9vbGVhbiBoYXNNZXNzYWdlQm91bmQoKTsKICAgIGludCBnZXRN\nZXNzYWdlQm91bmQoKTsKICAgIAogICAgLy8gb3B0aW9uYWwgc3RyaW5nIG1l\nc3NhZ2VGaWx0ZXIgPSAzOwogICAgYm9vbGVhbiBoYXNNZXNzYWdlRmlsdGVy\nKCk7CiAgICBTdHJpbmcgZ2V0TWVzc2FnZUZpbHRlcigpOwogICAgCiAgICAv\nLyBvcHRpb25hbCB1aW50MzIgbWVzc2FnZVdpbmRvd1NpemUgPSA0OwogICAg\nYm9vbGVhbiBoYXNNZXNzYWdlV2luZG93U2l6ZSgpOwogICAgaW50IGdldE1l\nc3NhZ2VXaW5kb3dTaXplKCk7CiAgfQogIHB1YmxpYyBzdGF0aWMgZmluYWwg\nY2xhc3MgU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgZXh0ZW5kcwogICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1w\nbGVtZW50cyBTdWJzY3JpcHRpb25QcmVmZXJlbmNlc09yQnVpbGRlciB7CiAg\nICAvLyBVc2UgU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMubmV3QnVpbGRlcigp\nIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgU3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXMoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIp\nOwogICAgfQogICAgcHJpdmF0ZSBTdWJzY3JpcHRpb25QcmVmZXJlbmNlcyhi\nb29sZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgZGVmYXVsdEluc3RhbmNlOwog\nICAgcHVibGljIHN0YXRpYyBTdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBnZXRE\nZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFu\nY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBTdWJzY3JpcHRpb25QcmVmZXJl\nbmNlcyBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1\ncm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVz\nY3JpcHRvcgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvblByZWZlcmVuY2Vz\nX2Rlc2NyaXB0b3I7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRh\nYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7\nCiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlv\nblByZWZlcmVuY2VzX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0KICAgIAog\nICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIG9wdGlvbmFsIC5I\nZWR3aWcuTWFwIG9wdGlvbnMgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgT1BUSU9OU19GSUVMRF9OVU1CRVIgPSAxOwogICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAg\nb3B0aW9uc187CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNPcHRpb25zKCkgewog\nICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgw\nMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIGdldE9wdGlvbnMoKSB7CiAg\nICAgIHJldHVybiBvcHRpb25zXzsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXBPckJ1aWxk\nZXIgZ2V0T3B0aW9uc09yQnVpbGRlcigpIHsKICAgICAgcmV0dXJuIG9wdGlv\nbnNfOwogICAgfQogICAgCiAgICAvLyBvcHRpb25hbCB1aW50MzIgbWVzc2Fn\nZUJvdW5kID0gMjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1FU1NB\nR0VCT1VORF9GSUVMRF9OVU1CRVIgPSAyOwogICAgcHJpdmF0ZSBpbnQgbWVz\nc2FnZUJvdW5kXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2VCb3Vu\nZCgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIp\nID09IDB4MDAwMDAwMDIpOwogICAgfQogICAgcHVibGljIGludCBnZXRNZXNz\nYWdlQm91bmQoKSB7CiAgICAgIHJldHVybiBtZXNzYWdlQm91bmRfOwogICAg\nfQogICAgCiAgICAvLyBvcHRpb25hbCBzdHJpbmcgbWVzc2FnZUZpbHRlciA9\nIDM7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdFRklMVEVS\nX0ZJRUxEX05VTUJFUiA9IDM7CiAgICBwcml2YXRlIGphdmEubGFuZy5PYmpl\nY3QgbWVzc2FnZUZpbHRlcl87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNNZXNz\nYWdlRmlsdGVyKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCk7CiAgICB9CiAgICBwdWJsaWMgU3Ry\naW5nIGdldE1lc3NhZ2VGaWx0ZXIoKSB7CiAgICAgIGphdmEubGFuZy5PYmpl\nY3QgcmVmID0gbWVzc2FnZUZpbHRlcl87CiAgICAgIGlmIChyZWYgaW5zdGFu\nY2VvZiBTdHJpbmcpIHsKICAgICAgICByZXR1cm4gKFN0cmluZykgcmVmOwog\nICAgICB9IGVsc2UgewogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBicyA9IAogICAgICAgICAgICAoY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nKSByZWY7CiAgICAgICAgU3RyaW5nIHMgPSBicy50b1N0\ncmluZ1V0ZjgoKTsKICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5J\nbnRlcm5hbC5pc1ZhbGlkVXRmOChicykpIHsKICAgICAgICAgIG1lc3NhZ2VG\naWx0ZXJfID0gczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICAg\nIH0KICAgIH0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGdldE1lc3NhZ2VGaWx0ZXJCeXRlcygpIHsKICAgICAgamF2YS5s\nYW5nLk9iamVjdCByZWYgPSBtZXNzYWdlRmlsdGVyXzsKICAgICAgaWYgKHJl\nZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBiID0gCiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoKFN0cmluZykgcmVm\nKTsKICAgICAgICBtZXNzYWdlRmlsdGVyXyA9IGI7CiAgICAgICAgcmV0dXJu\nIGI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgfQogICAgfQogICAg\nCiAgICAvLyBvcHRpb25hbCB1aW50MzIgbWVzc2FnZVdpbmRvd1NpemUgPSA0\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUVTU0FHRVdJTkRPV1NJ\nWkVfRklFTERfTlVNQkVSID0gNDsKICAgIHByaXZhdGUgaW50IG1lc3NhZ2VX\naW5kb3dTaXplXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2VXaW5k\nb3dTaXplKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwOCkgPT0gMHgwMDAwMDAwOCk7CiAgICB9CiAgICBwdWJsaWMgaW50IGdl\ndE1lc3NhZ2VXaW5kb3dTaXplKCkgewogICAgICByZXR1cm4gbWVzc2FnZVdp\nbmRvd1NpemVfOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgaW5pdEZp\nZWxkcygpIHsKICAgICAgb3B0aW9uc18gPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuZ2V0RGVmYXVsdEluc3RhbmNl\nKCk7CiAgICAgIG1lc3NhZ2VCb3VuZF8gPSAwOwogICAgICBtZXNzYWdlRmls\ndGVyXyA9ICIiOwogICAgICBtZXNzYWdlV2luZG93U2l6ZV8gPSAwOwogICAg\nfQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0x\nOwogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsK\nICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxp\nemVkOwogICAgICBpZiAoaXNJbml0aWFsaXplZCAhPSAtMSkgcmV0dXJuIGlz\nSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAgCiAgICAgIG1lbW9pemVkSXNJbml0\naWFsaXplZCA9IDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAg\nICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlh\nbGl6ZWRTaXplKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0ZU1l\nc3NhZ2UoMSwgb3B0aW9uc18pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAg\nIG91dHB1dC53cml0ZVVJbnQzMigyLCBtZXNzYWdlQm91bmRfKTsKICAgICAg\nfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgw\nMDAwMDAwNCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygzLCBnZXRN\nZXNzYWdlRmlsdGVyQnl0ZXMoKSk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpKSB7CiAgICAg\nICAgb3V0cHV0LndyaXRlVUludDMyKDQsIG1lc3NhZ2VXaW5kb3dTaXplXyk7\nCiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0\ncHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJp\nYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVk\nU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRT\naXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7CiAgICAK\nICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIHNpemUgKz0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAg\nLmNvbXB1dGVNZXNzYWdlU2l6ZSgxLCBvcHRpb25zXyk7CiAgICAgIH0KICAg\nICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAw\nMDIpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZVVJbnQzMlNpemUo\nMiwgbWVzc2FnZUJvdW5kXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpKSB7CiAgICAgICAg\nc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nCiAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgzLCBnZXRNZXNzYWdlRmls\ndGVyQnl0ZXMoKSk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpKSB7CiAgICAgICAgc2l6ZSAr\nPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAg\nICAgICAuY29tcHV0ZVVJbnQzMlNpemUoNCwgbWVzc2FnZVdpbmRvd1NpemVf\nKTsKICAgICAgfQogICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5n\nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNlcmlhbGl6ZWRT\naXplID0gc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9\nIDBMOwogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIGph\ndmEubGFuZy5PYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICB0aHJvd3Mg\namF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICByZXR1cm4g\nc3VwZXIud3JpdGVSZXBsYWNlKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgcGFyc2VGcm9tKAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAg\nIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1\nZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMg\nc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHBhcnNlRnJvbSgKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHBh\ncnNlRnJvbShieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWls\nZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25Q\ncmVmZXJlbmNlcyBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29n\nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNl\ncyBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBw\nYXJzZUZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblByZWZlcmVuY2VzIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRl\ncigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5w\ndXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsK\nICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBw\nYXJzZURlbGltaXRlZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVh\nbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRl\nciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxp\nbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAg\nICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2Ug\newogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHBhcnNlRnJvbSgKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5w\ndXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJl\nZmVyZW5jZXMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWls\nZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGlj\nIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWls\nZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVy\nKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzIHByb3RvdHlwZSkgewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAgfQog\nICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4gbmV3QnVp\nbGRlcih0aGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAg\nICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRl\nclBhcmVudCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nIEJ1aWxkZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5k\ncwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5CdWlsZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1lbnRzIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nblByZWZlcmVuY2VzT3JCdWlsZGVyIHsKICAgICAgcHVibGljIHN0YXRpYyBm\naW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXNf\nZGVzY3JpcHRvcjsKICAgICAgfQogICAgICAKICAgICAgcHJvdGVjdGVkIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vz\nc29yVGFibGUKICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRh\nYmxlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1\nYnNjcmlwdGlvblByZWZlcmVuY2VzX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nICAgfQogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nblByZWZlcmVuY2VzLm5ld0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxk\nZXIoKSB7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlv\nbigpOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIEJ1aWxkZXIoQnVp\nbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgICBzdXBlcihwYXJlbnQpOwog\nICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAg\nICAgfQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0\naWFsaXphdGlvbigpIHsKICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsK\nICAgICAgICAgIGdldE9wdGlvbnNGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9\nCiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUo\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1\ncGVyLmNsZWFyKCk7CiAgICAgICAgaWYgKG9wdGlvbnNCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBvcHRpb25zXyA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5nZXREZWZhdWx0SW5zdGFu\nY2UoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3B0aW9uc0J1aWxk\nZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAo\nYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBtZXNzYWdlQm91\nbmRfID0gMDsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+\nMHgwMDAwMDAwMik7CiAgICAgICAgbWVzc2FnZUZpbHRlcl8gPSAiIjsKICAg\nICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwNCk7\nCiAgICAgICAgbWVzc2FnZVdpbmRvd1NpemVfID0gMDsKICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwOCk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZy\nb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuZ2V0RGVzY3JpcHRvcigpOwog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5j\nZXMgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1\ncm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuZ2V0RGVmYXVsdEluc3RhbmNlKCk7\nCiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJl\nbmNlcyBidWlsZCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBy\nZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5p\nc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlh\nbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZh\ndGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgYnVpbGRQYXJzZWQoKQogICAgICAg\nICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNl\ncyByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3Vs\ndC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5p\ndGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICByZXN1bHQp\nLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBidWlsZFBhcnRpYWwoKSB7\nCiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgcmVzdWx0ID0gbmV3IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblByZWZlcmVuY2VzKHRoaXMpOwogICAgICAgIGludCBmcm9tX2Jp\ndEZpZWxkMF8gPSBiaXRGaWVsZDBfOwogICAgICAgIGludCB0b19iaXRGaWVs\nZDBfID0gMDsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgICAgdG9fYml0Rmll\nbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIH0KICAgICAgICBpZiAob3B0\naW9uc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJlc3VsdC5vcHRp\nb25zXyA9IG9wdGlvbnNfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBy\nZXN1bHQub3B0aW9uc18gPSBvcHRpb25zQnVpbGRlcl8uYnVpbGQoKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAw\nMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICAgIHRvX2JpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICB9CiAgICAgICAgcmVzdWx0Lm1l\nc3NhZ2VCb3VuZF8gPSBtZXNzYWdlQm91bmRfOwogICAgICAgIGlmICgoKGZy\nb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpKSB7\nCiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAgICAg\nICAgfQogICAgICAgIHJlc3VsdC5tZXNzYWdlRmlsdGVyXyA9IG1lc3NhZ2VG\naWx0ZXJfOwogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAw\nMDAwMDgpID09IDB4MDAwMDAwMDgpKSB7CiAgICAgICAgICB0b19iaXRGaWVs\nZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5t\nZXNzYWdlV2luZG93U2l6ZV8gPSBtZXNzYWdlV2luZG93U2l6ZV87CiAgICAg\nICAgcmVzdWx0LmJpdEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAg\nIG9uQnVpbHQoKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2ds\nZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVy\nIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMpIHsKICAgICAgICAg\nIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzKW90aGVy\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9t\nKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblByZWZlcmVuY2VzIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVy\nID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzLmdldERlZmF1bHRJbnN0YW5jZSgp\nKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIuaGFzT3B0aW9ucygp\nKSB7CiAgICAgICAgICBtZXJnZU9wdGlvbnMob3RoZXIuZ2V0T3B0aW9ucygp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc01lc3NhZ2VCb3Vu\nZCgpKSB7CiAgICAgICAgICBzZXRNZXNzYWdlQm91bmQob3RoZXIuZ2V0TWVz\nc2FnZUJvdW5kKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFz\nTWVzc2FnZUZpbHRlcigpKSB7CiAgICAgICAgICBzZXRNZXNzYWdlRmlsdGVy\nKG90aGVyLmdldE1lc3NhZ2VGaWx0ZXIoKSk7CiAgICAgICAgfQogICAgICAg\nIGlmIChvdGhlci5oYXNNZXNzYWdlV2luZG93U2l6ZSgpKSB7CiAgICAgICAg\nICBzZXRNZXNzYWdlV2luZG93U2l6ZShvdGhlci5nZXRNZXNzYWdlV2luZG93\nU2l6ZSgpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tZXJnZVVua25vd25G\naWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGZpbmFsIGJv\nb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9t\nKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3du\nRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93\nbkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAgICAgIHRoaXMuZ2V0VW5r\nbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAg\nICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAgIHN3aXRj\naCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0\naGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsK\nICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAg\nIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNp\nb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRV\nbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAg\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDEwOiB7CiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWFwLkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5uZXdCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgaWYgKGhhc09wdGlvbnMoKSkgewogICAgICAgICAgICAgICAg\nc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0T3B0aW9ucygpKTsKICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVp\nbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAgICAgICAgICAgIHNldE9w\ndGlvbnMoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxNjog\newogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAg\nICAgICAgICAgICBtZXNzYWdlQm91bmRfID0gaW5wdXQucmVhZFVJbnQzMigp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgMjY6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDQ7CiAgICAgICAgICAgICAgbWVzc2FnZUZpbHRlcl8gPSBpbnB1\ndC5yZWFkQnl0ZXMoKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBjYXNlIDMyOiB7CiAgICAgICAgICAgICAgYml0\nRmllbGQwXyB8PSAweDAwMDAwMDA4OwogICAgICAgICAgICAgIG1lc3NhZ2VX\naW5kb3dTaXplXyA9IGlucHV0LnJlYWRVSW50MzIoKTsKICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsK\nICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWFwIG9wdGlvbnMg\nPSAxOwogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hcCBvcHRpb25zXyA9IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5nZXREZWZhdWx0SW5z\ndGFuY2UoKTsKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNp\nbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcCwgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLkJ1aWxkZXIsIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcE9yQnVp\nbGRlcj4gb3B0aW9uc0J1aWxkZXJfOwogICAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNPcHRpb25zKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAw\neDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgICAgfQogICAgICBwdWJs\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWFwIGdldE9wdGlvbnMoKSB7CiAgICAgICAgaWYgKG9wdGlvbnNCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gb3B0aW9uc187CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBvcHRpb25zQnVpbGRlcl8u\nZ2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRPcHRpb25zKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hcCB2YWx1ZSkgewogICAgICAgIGlmIChvcHRp\nb25zQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZhbHVlID09\nIG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBvcHRpb25zXyA9IHZh\nbHVlOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIG9wdGlvbnNCdWlsZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsK\nICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIHNldE9wdGlvbnMoCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuQnVpbGRlciBidWlsZGVyRm9y\nVmFsdWUpIHsKICAgICAgICBpZiAob3B0aW9uc0J1aWxkZXJfID09IG51bGwp\nIHsKICAgICAgICAgIG9wdGlvbnNfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxk\nKCk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgb3B0aW9uc0J1aWxkZXJfLnNldE1lc3NhZ2UoYnVpbGRlckZv\nclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VPcHRpb25zKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcCB2YWx1ZSkgewog\nICAgICAgIGlmIChvcHRpb25zQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAw\nMDEpICYmCiAgICAgICAgICAgICAgb3B0aW9uc18gIT0gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLmdldERlZmF1bHRJ\nbnN0YW5jZSgpKSB7CiAgICAgICAgICAgIG9wdGlvbnNfID0KICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NYXAubmV3QnVpbGRlcihvcHRpb25zXykubWVyZ2VGcm9tKHZhbHVlKS5i\ndWlsZFBhcnRpYWwoKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIG9wdGlvbnNfID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3B0aW9uc0J1\naWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck9wdGlvbnMoKSB7\nCiAgICAgICAgaWYgKG9wdGlvbnNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAg\nICAgICBvcHRpb25zXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1hcC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBv\ncHRpb25zQnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0\nRmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuQnVpbGRlciBn\nZXRPcHRpb25zQnVpbGRlcigpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDE7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJu\nIGdldE9wdGlvbnNGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKCk7CiAgICAg\nIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1hcE9yQnVpbGRlciBnZXRPcHRpb25zT3JCdWlsZGVy\nKCkgewogICAgICAgIGlmIChvcHRpb25zQnVpbGRlcl8gIT0gbnVsbCkgewog\nICAgICAgICAgcmV0dXJuIG9wdGlvbnNCdWlsZGVyXy5nZXRNZXNzYWdlT3JC\ndWlsZGVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBv\ncHRpb25zXzsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBjb20u\nZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1h\ncCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWFwLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1hcE9yQnVpbGRlcj4gCiAgICAgICAgICBnZXRPcHRpb25z\nRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmIChvcHRpb25zQnVpbGRlcl8g\nPT0gbnVsbCkgewogICAgICAgICAgb3B0aW9uc0J1aWxkZXJfID0gbmV3IGNv\nbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1hcCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hcE9yQnVpbGRlcj4oCiAgICAgICAgICAgICAg\nICAgIG9wdGlvbnNfLAogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JD\naGlsZHJlbigpLAogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAg\nICAgICAgb3B0aW9uc18gPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gb3B0aW9uc0J1aWxkZXJfOwogICAgICB9CiAgICAgIAogICAgICAvLyBv\ncHRpb25hbCB1aW50MzIgbWVzc2FnZUJvdW5kID0gMjsKICAgICAgcHJpdmF0\nZSBpbnQgbWVzc2FnZUJvdW5kXyA7CiAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc01lc3NhZ2VCb3VuZCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMik7CiAgICAgIH0KICAgICAg\ncHVibGljIGludCBnZXRNZXNzYWdlQm91bmQoKSB7CiAgICAgICAgcmV0dXJu\nIG1lc3NhZ2VCb3VuZF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0TWVzc2FnZUJvdW5kKGludCB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICBtZXNzYWdlQm91bmRfID0gdmFs\ndWU7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNZXNzYWdlQm91\nbmQoKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4\nMDAwMDAwMDIpOwogICAgICAgIG1lc3NhZ2VCb3VuZF8gPSAwOwogICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIAogICAgICAvLyBvcHRpb25hbCBzdHJpbmcgbWVzc2FnZUZpbHRlciA9\nIDM7CiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBtZXNzYWdlRmls\ndGVyXyA9ICIiOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNNZXNzYWdlRmls\ndGVyKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDA0KSA9PSAweDAwMDAwMDA0KTsKICAgICAgfQogICAgICBwdWJsaWMgU3Ry\naW5nIGdldE1lc3NhZ2VGaWx0ZXIoKSB7CiAgICAgICAgamF2YS5sYW5nLk9i\namVjdCByZWYgPSBtZXNzYWdlRmlsdGVyXzsKICAgICAgICBpZiAoIShyZWYg\naW5zdGFuY2VvZiBTdHJpbmcpKSB7CiAgICAgICAgICBTdHJpbmcgcyA9ICgo\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWYpLnRvU3RyaW5n\nVXRmOCgpOwogICAgICAgICAgbWVzc2FnZUZpbHRlcl8gPSBzOwogICAgICAg\nICAgcmV0dXJuIHM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVy\nbiAoU3RyaW5nKSByZWY7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIHNldE1lc3NhZ2VGaWx0ZXIoU3RyaW5nIHZhbHVlKSB7CiAg\nICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxs\nUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDQ7CiAgICAgICAgbWVzc2FnZUZpbHRlcl8gPSB2YWx1ZTsKICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1lc3NhZ2VGaWx0ZXIoKSB7CiAg\nICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDQp\nOwogICAgICAgIG1lc3NhZ2VGaWx0ZXJfID0gZ2V0RGVmYXVsdEluc3RhbmNl\nKCkuZ2V0TWVzc2FnZUZpbHRlcigpOwogICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHZvaWQgc2V0TWVz\nc2FnZUZpbHRlcihjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFs\ndWUpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAgICAg\nICAgbWVzc2FnZUZpbHRlcl8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgdWludDMyIG1l\nc3NhZ2VXaW5kb3dTaXplID0gNDsKICAgICAgcHJpdmF0ZSBpbnQgbWVzc2Fn\nZVdpbmRvd1NpemVfIDsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzTWVzc2Fn\nZVdpbmRvd1NpemUoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpOwogICAgICB9CiAgICAgIHB1\nYmxpYyBpbnQgZ2V0TWVzc2FnZVdpbmRvd1NpemUoKSB7CiAgICAgICAgcmV0\ndXJuIG1lc3NhZ2VXaW5kb3dTaXplXzsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRNZXNzYWdlV2luZG93U2l6ZShpbnQgdmFsdWUpIHsKICAg\nICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgbWVzc2Fn\nZVdpbmRvd1NpemVfID0gdmFsdWU7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxk\nZXIgY2xlYXJNZXNzYWdlV2luZG93U2l6ZSgpIHsKICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwOCk7CiAgICAgICAgbWVz\nc2FnZVdpbmRvd1NpemVfID0gMDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBw\ncm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzKQogICAgfQogICAgCiAgICBzdGF0aWMg\newogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgU3Vic2NyaXB0aW9uUHJl\nZmVyZW5jZXModHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0Rmll\nbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9w\nb2ludChjbGFzc19zY29wZTpIZWR3aWcuU3Vic2NyaXB0aW9uUHJlZmVyZW5j\nZXMpCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2UgU3Vic2NyaWJlUmVxdWVz\ndE9yQnVpbGRlcgogICAgICBleHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYu\nTWVzc2FnZU9yQnVpbGRlciB7CiAgICAKICAgIC8vIHJlcXVpcmVkIGJ5dGVz\nIHN1YnNjcmliZXJJZCA9IDI7CiAgICBib29sZWFuIGhhc1N1YnNjcmliZXJJ\nZCgpOwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1\nYnNjcmliZXJJZCgpOwogICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1\nYnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2ggY3JlYXRlT3JBdHRhY2gg\nPSAzIFtkZWZhdWx0ID0gQ1JFQVRFX09SX0FUVEFDSF07CiAgICBib29sZWFu\nIGhhc0NyZWF0ZU9yQXR0YWNoKCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0\nZU9yQXR0YWNoIGdldENyZWF0ZU9yQXR0YWNoKCk7CiAgICAKICAgIC8vIG9w\ndGlvbmFsIGJvb2wgc3luY2hyb25vdXMgPSA0IFtkZWZhdWx0ID0gZmFsc2Vd\nOwogICAgYm9vbGVhbiBoYXNTeW5jaHJvbm91cygpOwogICAgYm9vbGVhbiBn\nZXRTeW5jaHJvbm91cygpOwogICAgCiAgICAvLyBvcHRpb25hbCB1aW50MzIg\nbWVzc2FnZUJvdW5kID0gNTsKICAgIGJvb2xlYW4gaGFzTWVzc2FnZUJvdW5k\nKCk7CiAgICBpbnQgZ2V0TWVzc2FnZUJvdW5kKCk7CiAgICAKICAgIC8vIG9w\ndGlvbmFsIC5IZWR3aWcuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgcHJlZmVy\nZW5jZXMgPSA2OwogICAgYm9vbGVhbiBoYXNQcmVmZXJlbmNlcygpOwogICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uUHJlZmVyZW5jZXMgZ2V0UHJlZmVyZW5jZXMoKTsKICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblByZWZlcmVuY2VzT3JCdWlsZGVyIGdldFByZWZlcmVuY2VzT3JC\ndWlsZGVyKCk7CiAgICAKICAgIC8vIG9wdGlvbmFsIGJvb2wgZm9yY2VBdHRh\nY2ggPSA3IFtkZWZhdWx0ID0gZmFsc2VdOwogICAgYm9vbGVhbiBoYXNGb3Jj\nZUF0dGFjaCgpOwogICAgYm9vbGVhbiBnZXRGb3JjZUF0dGFjaCgpOwogIH0K\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFN1YnNjcmliZVJlcXVlc3Qg\nZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UKICAgICAgaW1wbGVtZW50cyBTdWJzY3JpYmVSZXF1ZXN0T3JCdWls\nZGVyIHsKICAgIC8vIFVzZSBTdWJzY3JpYmVSZXF1ZXN0Lm5ld0J1aWxkZXIo\nKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIFN1YnNjcmliZVJlcXVlc3Qo\nQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwogICAg\nfQogICAgcHJpdmF0ZSBTdWJzY3JpYmVSZXF1ZXN0KGJvb2xlYW4gbm9Jbml0\nKSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdWJzY3JpYmVS\nZXF1ZXN0IGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgU3Vi\nc2NyaWJlUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJl\ndHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBT\ndWJzY3JpYmVSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7\nCiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsK\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaWJlUmVx\ndWVzdF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxl\nKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3Jp\nYmVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0KICAgIAogICAg\ncHVibGljIGVudW0gQ3JlYXRlT3JBdHRhY2gKICAgICAgICBpbXBsZW1lbnRz\nIGNvbS5nb29nbGUucHJvdG9idWYuUHJvdG9jb2xNZXNzYWdlRW51bSB7CiAg\nICAgIENSRUFURSgwLCAwKSwKICAgICAgQVRUQUNIKDEsIDEpLAogICAgICBD\nUkVBVEVfT1JfQVRUQUNIKDIsIDIpLAogICAgICA7CiAgICAgIAogICAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBDUkVBVEVfVkFMVUUgPSAwOwogICAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBBVFRBQ0hfVkFMVUUgPSAxOwog\nICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDUkVBVEVfT1JfQVRUQUNI\nX1ZBTFVFID0gMjsKICAgICAgCiAgICAgIAogICAgICBwdWJsaWMgZmluYWwg\naW50IGdldE51bWJlcigpIHsgcmV0dXJuIHZhbHVlOyB9CiAgICAgIAogICAg\nICBwdWJsaWMgc3RhdGljIENyZWF0ZU9yQXR0YWNoIHZhbHVlT2YoaW50IHZh\nbHVlKSB7CiAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgY2Fz\nZSAwOiByZXR1cm4gQ1JFQVRFOwogICAgICAgICAgY2FzZSAxOiByZXR1cm4g\nQVRUQUNIOwogICAgICAgICAgY2FzZSAyOiByZXR1cm4gQ1JFQVRFX09SX0FU\nVEFDSDsKICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiBudWxsOwogICAgICAg\nIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIHN0YXRpYyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPENyZWF0ZU9yQXR0\nYWNoPgogICAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgpIHsKICAgICAg\nICByZXR1cm4gaW50ZXJuYWxWYWx1ZU1hcDsKICAgICAgfQogICAgICBwcml2\nYXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1M\naXRlTWFwPENyZWF0ZU9yQXR0YWNoPgogICAgICAgICAgaW50ZXJuYWxWYWx1\nZU1hcCA9CiAgICAgICAgICAgIG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndGVybmFsLkVudW1MaXRlTWFwPENyZWF0ZU9yQXR0YWNoPigpIHsKICAgICAg\nICAgICAgICBwdWJsaWMgQ3JlYXRlT3JBdHRhY2ggZmluZFZhbHVlQnlOdW1i\nZXIoaW50IG51bWJlcikgewogICAgICAgICAgICAgICAgcmV0dXJuIENyZWF0\nZU9yQXR0YWNoLnZhbHVlT2YobnVtYmVyKTsKICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH07CiAgICAgIAogICAgICBwdWJsaWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9y\nCiAgICAgICAgICBnZXRWYWx1ZURlc2NyaXB0b3IoKSB7CiAgICAgICAgcmV0\ndXJuIGdldERlc2NyaXB0b3IoKS5nZXRWYWx1ZXMoKS5nZXQoaW5kZXgpOwog\nICAgICB9CiAgICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVm\nLkRlc2NyaXB0b3JzLkVudW1EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNj\ncmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gZ2V0RGVzY3JpcHRv\ncigpOwogICAgICB9CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcgogICAg\nICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVxdWVzdC5nZXREZXNjcmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDAp\nOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBD\ncmVhdGVPckF0dGFjaFtdIFZBTFVFUyA9IHsKICAgICAgICBDUkVBVEUsIEFU\nVEFDSCwgQ1JFQVRFX09SX0FUVEFDSCwgCiAgICAgIH07CiAgICAgIAogICAg\nICBwdWJsaWMgc3RhdGljIENyZWF0ZU9yQXR0YWNoIHZhbHVlT2YoCiAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1\nZURlc2NyaXB0b3IgZGVzYykgewogICAgICAgIGlmIChkZXNjLmdldFR5cGUo\nKSAhPSBnZXREZXNjcmlwdG9yKCkpIHsKICAgICAgICAgIHRocm93IG5ldyBq\nYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKAogICAgICAgICAg\nICAiRW51bVZhbHVlRGVzY3JpcHRvciBpcyBub3QgZm9yIHRoaXMgdHlwZS4i\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIFZBTFVFU1tkZXNjLmdldElu\nZGV4KCldOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGZpbmFsIGlu\ndCBpbmRleDsKICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgdmFsdWU7CiAgICAg\nIAogICAgICBwcml2YXRlIENyZWF0ZU9yQXR0YWNoKGludCBpbmRleCwgaW50\nIHZhbHVlKSB7CiAgICAgICAgdGhpcy5pbmRleCA9IGluZGV4OwogICAgICAg\nIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgfQogICAgICAKICAgICAgLy8g\nQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGVudW1fc2NvcGU6SGVkd2lnLlN1\nYnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2gpCiAgICB9CiAgICAKICAg\nIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAvLyByZXF1aXJlZCBieXRl\ncyBzdWJzY3JpYmVySWQgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgU1VCU0NSSUJFUklEX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRl\nIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBzdWJzY3JpYmVySWRf\nOwogICAgcHVibGljIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCkgewogICAg\nICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAw\nMDAwMSk7CiAgICB9CiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nIGdldFN1YnNjcmliZXJJZCgpIHsKICAgICAgcmV0dXJuIHN1\nYnNjcmliZXJJZF87CiAgICB9CiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3\naWcuU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaCBjcmVhdGVPckF0\ndGFjaCA9IDMgW2RlZmF1bHQgPSBDUkVBVEVfT1JfQVRUQUNIXTsKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IENSRUFURU9SQVRUQUNIX0ZJRUxEX05V\nTUJFUiA9IDM7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JB\ndHRhY2ggY3JlYXRlT3JBdHRhY2hfOwogICAgcHVibGljIGJvb2xlYW4gaGFz\nQ3JlYXRlT3JBdHRhY2goKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKTsKICAgIH0KICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoIGdldENyZWF0ZU9yQXR0\nYWNoKCkgewogICAgICByZXR1cm4gY3JlYXRlT3JBdHRhY2hfOwogICAgfQog\nICAgCiAgICAvLyBvcHRpb25hbCBib29sIHN5bmNocm9ub3VzID0gNCBbZGVm\nYXVsdCA9IGZhbHNlXTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNZ\nTkNIUk9OT1VTX0ZJRUxEX05VTUJFUiA9IDQ7CiAgICBwcml2YXRlIGJvb2xl\nYW4gc3luY2hyb25vdXNfOwogICAgcHVibGljIGJvb2xlYW4gaGFzU3luY2hy\nb25vdXMoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDA0KSA9PSAweDAwMDAwMDA0KTsKICAgIH0KICAgIHB1YmxpYyBib29sZWFu\nIGdldFN5bmNocm9ub3VzKCkgewogICAgICByZXR1cm4gc3luY2hyb25vdXNf\nOwogICAgfQogICAgCiAgICAvLyBvcHRpb25hbCB1aW50MzIgbWVzc2FnZUJv\ndW5kID0gNTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1FU1NBR0VC\nT1VORF9GSUVMRF9OVU1CRVIgPSA1OwogICAgcHJpdmF0ZSBpbnQgbWVzc2Fn\nZUJvdW5kXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2VCb3VuZCgp\nIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDgpID09\nIDB4MDAwMDAwMDgpOwogICAgfQogICAgcHVibGljIGludCBnZXRNZXNzYWdl\nQm91bmQoKSB7CiAgICAgIHJldHVybiBtZXNzYWdlQm91bmRfOwogICAgfQog\nICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmlwdGlvblByZWZl\ncmVuY2VzIHByZWZlcmVuY2VzID0gNjsKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgaW50IFBSRUZFUkVOQ0VTX0ZJRUxEX05VTUJFUiA9IDY7CiAgICBwcml2\nYXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHByZWZlcmVuY2VzXzsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc1ByZWZlcmVuY2VzKCkgewogICAgICByZXR1cm4g\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAxMCkgPT0gMHgwMDAwMDAxMCk7CiAg\nICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgZ2V0UHJlZmVy\nZW5jZXMoKSB7CiAgICAgIHJldHVybiBwcmVmZXJlbmNlc187CiAgICB9CiAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXNPckJ1aWxkZXIgZ2V0UHJl\nZmVyZW5jZXNPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiBwcmVmZXJlbmNl\nc187CiAgICB9CiAgICAKICAgIC8vIG9wdGlvbmFsIGJvb2wgZm9yY2VBdHRh\nY2ggPSA3IFtkZWZhdWx0ID0gZmFsc2VdOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgRk9SQ0VBVFRBQ0hfRklFTERfTlVNQkVSID0gNzsKICAgIHBy\naXZhdGUgYm9vbGVhbiBmb3JjZUF0dGFjaF87CiAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNGb3JjZUF0dGFjaCgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMjApID09IDB4MDAwMDAwMjApOwogICAgfQogICAgcHVi\nbGljIGJvb2xlYW4gZ2V0Rm9yY2VBdHRhY2goKSB7CiAgICAgIHJldHVybiBm\nb3JjZUF0dGFjaF87CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0\nRmllbGRzKCkgewogICAgICBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICBjcmVhdGVPckF0dGFj\naF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9B\nVFRBQ0g7CiAgICAgIHN5bmNocm9ub3VzXyA9IGZhbHNlOwogICAgICBtZXNz\nYWdlQm91bmRfID0gMDsKICAgICAgcHJlZmVyZW5jZXNfID0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nUHJlZmVyZW5jZXMuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIGZvcmNl\nQXR0YWNoXyA9IGZhbHNlOwogICAgfQogICAgcHJpdmF0ZSBieXRlIG1lbW9p\nemVkSXNJbml0aWFsaXplZCA9IC0xOwogICAgcHVibGljIGZpbmFsIGJvb2xl\nYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgYnl0ZSBpc0luaXRpYWxpemVk\nID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOwogICAgICBpZiAoaXNJbml0aWFs\naXplZCAhPSAtMSkgcmV0dXJuIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAg\nCiAgICAgIGlmICghaGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICBtZW1v\naXplZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgfQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3Jp\ndGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91\ndHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAg\nICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAw\nMSkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBzdWJzY3JpYmVy\nSWRfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBvdXRwdXQud3JpdGVF\nbnVtKDMsIGNyZWF0ZU9yQXR0YWNoXy5nZXROdW1iZXIoKSk7CiAgICAgIH0K\nICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAw\nMDAwMDQpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlQm9vbCg0LCBzeW5jaHJv\nbm91c18pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDA4KSA9PSAweDAwMDAwMDA4KSkgewogICAgICAgIG91dHB1dC53cml0\nZVVJbnQzMig1LCBtZXNzYWdlQm91bmRfKTsKICAgICAgfQogICAgICBpZiAo\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAxMCkgPT0gMHgwMDAwMDAxMCkpIHsK\nICAgICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDYsIHByZWZlcmVuY2VzXyk7\nCiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMjAp\nID09IDB4MDAwMDAwMjApKSB7CiAgICAgICAgb3V0cHV0LndyaXRlQm9vbCg3\nLCBmb3JjZUF0dGFjaF8pOwogICAgICB9CiAgICAgIGdldFVua25vd25GaWVs\nZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\naW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBp\nbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXplID0gbWVt\nb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJl\ndHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBpZiAoKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAg\nICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDIsIHN1YnNjcmli\nZXJJZF8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAgIHNpemUgKz0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAg\nLmNvbXB1dGVFbnVtU2l6ZSgzLCBjcmVhdGVPckF0dGFjaF8uZ2V0TnVtYmVy\nKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDA0KSA9PSAweDAwMDAwMDA0KSkgewogICAgICAgIHNpemUgKz0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNv\nbXB1dGVCb29sU2l6ZSg0LCBzeW5jaHJvbm91c18pOwogICAgICB9CiAgICAg\nIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAwMDAwMDA4\nKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVVSW50MzJTaXplKDUs\nIG1lc3NhZ2VCb3VuZF8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDEwKSA9PSAweDAwMDAwMDEwKSkgewogICAgICAgIHNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSg2LCBwcmVmZXJlbmNlc18p\nOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDIw\nKSA9PSAweDAwMDAwMDIwKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1\ndGVCb29sU2l6ZSg3LCBmb3JjZUF0dGFjaF8pOwogICAgICB9CiAgICAgIHNp\nemUgKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7\nCiAgICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICBy\nZXR1cm4gc2l6ZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5n\nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0\nZVJlcGxhY2UoKQogICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVh\nbUV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2Uo\nKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IHBhcnNl\nRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVl\nc3QgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEp\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmli\nZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBwYXJzZUZy\nb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQo\nKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBwYXJz\nZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxk\nZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIu\nbWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAgIHJldHVybiBi\ndWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaWJlUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oCiAgICAgICAgamF2\nYS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1\naWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdp\nc3RyeSkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgp\nOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFyc2VG\ncm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0\ncmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0\nKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\nYmVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVp\nbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1Ymxp\nYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVp\nbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRl\ncihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0IHByb3RvdHlwZSkgewogICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAgfQogICAgcHVi\nbGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4gbmV3QnVpbGRlcih0\naGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90\nZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlclBhcmVu\ndCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxk\nZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWls\nZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1lbnRzIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3RP\nckJ1aWxkZXIgewogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29n\nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAg\nZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19TdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICAgIH0K\nICAgICAgCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdl\nbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBp\nbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1\ncm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\naW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpYmVSZXF1ZXN0X2ZpZWxk\nQWNjZXNzb3JUYWJsZTsKICAgICAgfQogICAgICAKICAgICAgLy8gQ29uc3Ry\ndWN0IHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAgIHBy\naXZhdGUgQnVpbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlcklu\naXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUg\nQnVpbGRlcihCdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1cGVy\nKHBhcmVudCk7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXph\ndGlvbigpOwogICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNl\nQnVpbGRlckluaXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRC\ndWlsZGVycykgewogICAgICAgICAgZ2V0UHJlZmVyZW5jZXNGaWVsZEJ1aWxk\nZXIoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMg\nQnVpbGRlciBjcmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWlsZGVy\nKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFy\nKCkgewogICAgICAgIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgc3Vic2NyaWJl\ncklkXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsK\nICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAw\nMSk7CiAgICAgICAgY3JlYXRlT3JBdHRhY2hfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5D\ncmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIOwogICAgICAgIGJpdEZp\nZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAgICAgICBz\neW5jaHJvbm91c18gPSBmYWxzZTsKICAgICAgICBiaXRGaWVsZDBfID0gKGJp\ndEZpZWxkMF8gJiB+MHgwMDAwMDAwNCk7CiAgICAgICAgbWVzc2FnZUJvdW5k\nXyA9IDA7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4\nMDAwMDAwMDgpOwogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIHByZWZlcmVuY2VzXyA9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblBy\nZWZlcmVuY2VzLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICBwcmVmZXJlbmNlc0J1aWxkZXJfLmNsZWFyKCk7CiAg\nICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDEwKTsKICAgICAgICBmb3JjZUF0dGFjaF8gPSBmYWxzZTsKICAg\nICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAyMCk7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUo\nKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5E\nZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsK\nICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXREZXNjcmlwdG9yKCk7\nCiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IGdl\ndERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmliZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IGJ1aWxkKCkgewogICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmliZVJlcXVlc3QgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAg\nICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAg\nICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1\nbHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9\nCiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgYnVpbGRQYXJz\nZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52\nYWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXF1ZXN0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICgh\ncmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3\nVW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJl\nc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgYnVpbGRQYXJ0aWFsKCkgewog\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmliZVJlcXVlc3QgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVl\nc3QodGhpcyk7CiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZp\nZWxkMF87CiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOwogICAgICAg\nIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAw\nMDAwMDEpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAw\nMDE7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5zdWJzY3JpYmVySWRfID0g\nc3Vic2NyaWJlcklkXzsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8g\nJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAgICAgdG9f\nYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwogICAgICAgIH0KICAgICAgICBy\nZXN1bHQuY3JlYXRlT3JBdHRhY2hfID0gY3JlYXRlT3JBdHRhY2hfOwogICAg\nICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4\nMDAwMDAwMDQpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDQ7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5zeW5jaHJvbm91c18g\nPSBzeW5jaHJvbm91c187CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBf\nICYgMHgwMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCkpIHsKICAgICAgICAgIHRv\nX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAgICB9CiAgICAgICAg\ncmVzdWx0Lm1lc3NhZ2VCb3VuZF8gPSBtZXNzYWdlQm91bmRfOwogICAgICAg\nIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMTApID09IDB4MDAw\nMDAwMTApKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAw\nMTA7CiAgICAgICAgfQogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIHJlc3VsdC5wcmVmZXJlbmNlc18gPSBw\ncmVmZXJlbmNlc187CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3Vs\ndC5wcmVmZXJlbmNlc18gPSBwcmVmZXJlbmNlc0J1aWxkZXJfLmJ1aWxkKCk7\nCiAgICAgICAgfQogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4\nMDAwMDAwMjApID09IDB4MDAwMDAwMjApKSB7CiAgICAgICAgICB0b19iaXRG\naWVsZDBfIHw9IDB4MDAwMDAwMjA7CiAgICAgICAgfQogICAgICAgIHJlc3Vs\ndC5mb3JjZUF0dGFjaF8gPSBmb3JjZUF0dGFjaF87CiAgICAgICAgcmVzdWx0\nLmJpdEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQo\nKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1\nZi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNl\nb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdCkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJv\nbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdClvdGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IG90aGVyKSB7CiAg\nICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuZ2V0RGVmYXVsdElu\nc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlmIChvdGhlci5oYXNT\ndWJzY3JpYmVySWQoKSkgewogICAgICAgICAgc2V0U3Vic2NyaWJlcklkKG90\naGVyLmdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKG90aGVyLmhhc0NyZWF0ZU9yQXR0YWNoKCkpIHsKICAgICAgICAgIHNldENy\nZWF0ZU9yQXR0YWNoKG90aGVyLmdldENyZWF0ZU9yQXR0YWNoKCkpOwogICAg\nICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzU3luY2hyb25vdXMoKSkgewog\nICAgICAgICAgc2V0U3luY2hyb25vdXMob3RoZXIuZ2V0U3luY2hyb25vdXMo\nKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNNZXNzYWdlQm91\nbmQoKSkgewogICAgICAgICAgc2V0TWVzc2FnZUJvdW5kKG90aGVyLmdldE1l\nc3NhZ2VCb3VuZCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhh\nc1ByZWZlcmVuY2VzKCkpIHsKICAgICAgICAgIG1lcmdlUHJlZmVyZW5jZXMo\nb3RoZXIuZ2V0UHJlZmVyZW5jZXMoKSk7CiAgICAgICAgfQogICAgICAgIGlm\nIChvdGhlci5oYXNGb3JjZUF0dGFjaCgpKSB7CiAgICAgICAgICBzZXRGb3Jj\nZUF0dGFjaChvdGhlci5nZXRGb3JjZUF0dGFjaCgpKTsKICAgICAgICB9CiAg\nICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93\nbkZpZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgp\nIHsKICAgICAgICBpZiAoIWhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAg\nICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1\naWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAg\nICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRy\ndWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAg\nICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAg\nICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVs\nZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsK\nICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1\nbmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAg\nICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxk\nKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxODog\newogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAg\nICAgICAgICAgICBzdWJzY3JpYmVySWRfID0gaW5wdXQucmVhZEJ5dGVzKCk7\nCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgY2FzZSAyNDogewogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlu\ncHV0LnJlYWRFbnVtKCk7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5D\ncmVhdGVPckF0dGFjaCB2YWx1ZSA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JB\ndHRhY2gudmFsdWVPZihyYXdWYWx1ZSk7CiAgICAgICAgICAgICAgaWYgKHZh\nbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHVua25vd25GaWVsZHMu\nbWVyZ2VWYXJpbnRGaWVsZCgzLCByYXdWYWx1ZSk7CiAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMjsKICAgICAgICAgICAgICAgIGNyZWF0ZU9yQXR0YWNoXyA9IHZhbHVl\nOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBjYXNlIDMyOiB7CiAgICAgICAgICAgICAg\nYml0RmllbGQwXyB8PSAweDAwMDAwMDA0OwogICAgICAgICAgICAgIHN5bmNo\ncm9ub3VzXyA9IGlucHV0LnJlYWRCb29sKCk7CiAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA0MDogewogICAg\nICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAgICAg\nICAgICBtZXNzYWdlQm91bmRfID0gaW5wdXQucmVhZFVJbnQzMigpOwogICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNh\nc2UgNTA6IHsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5C\ndWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5uZXdC\ndWlsZGVyKCk7CiAgICAgICAgICAgICAgaWYgKGhhc1ByZWZlcmVuY2VzKCkp\nIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdldFBy\nZWZlcmVuY2VzKCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBp\nbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3Ry\neSk7CiAgICAgICAgICAgICAgc2V0UHJlZmVyZW5jZXMoc3ViQnVpbGRlci5i\ndWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgY2FzZSA1NjogewogICAgICAgICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAyMDsKICAgICAgICAgICAgICBmb3JjZUF0\ndGFjaF8gPSBpbnB1dC5yZWFkQm9vbCgpOwogICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9\nCiAgICAgIAogICAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOwogICAgICAK\nICAgICAgLy8gcmVxdWlyZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0gMjsKICAg\nICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Vi\nc2NyaWJlcklkXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5F\nTVBUWTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCkg\newogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9\nPSAweDAwMDAwMDAxKTsKICAgICAgfQogICAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1YnNjcmliZXJJZCgpIHsKICAg\nICAgICByZXR1cm4gc3Vic2NyaWJlcklkXzsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRTdWJzY3JpYmVySWQoY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51\nbGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwog\nIH0KICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgc3Vic2Ny\naWJlcklkXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nZWFyU3Vic2NyaWJlcklkKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0\nRmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBzdWJzY3JpYmVySWRf\nID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0U3Vic2NyaWJlcklkKCk7CiAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2NyaWJl\nUmVxdWVzdC5DcmVhdGVPckF0dGFjaCBjcmVhdGVPckF0dGFjaCA9IDMgW2Rl\nZmF1bHQgPSBDUkVBVEVfT1JfQVRUQUNIXTsKICAgICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\nYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoIGNyZWF0ZU9yQXR0YWNoXyA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSDsK\nICAgICAgcHVibGljIGJvb2xlYW4gaGFzQ3JlYXRlT3JBdHRhY2goKSB7CiAg\nICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4\nMDAwMDAwMDIpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nLkNyZWF0ZU9yQXR0YWNoIGdldENyZWF0ZU9yQXR0YWNoKCkgewogICAgICAg\nIHJldHVybiBjcmVhdGVPckF0dGFjaF87CiAgICAgIH0KICAgICAgcHVibGlj\nIEJ1aWxkZXIgc2V0Q3JlYXRlT3JBdHRhY2gob3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVh\ndGVPckF0dGFjaCB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxs\nKSB7CiAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24o\nKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAy\nOwogICAgICAgIGNyZWF0ZU9yQXR0YWNoXyA9IHZhbHVlOwogICAgICAgIG9u\nQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ3JlYXRlT3JBdHRhY2goKSB7CiAgICAg\nICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOwog\nICAgICAgIGNyZWF0ZU9yQXR0YWNoXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRl\nT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSDsKICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAg\nLy8gb3B0aW9uYWwgYm9vbCBzeW5jaHJvbm91cyA9IDQgW2RlZmF1bHQgPSBm\nYWxzZV07CiAgICAgIHByaXZhdGUgYm9vbGVhbiBzeW5jaHJvbm91c18gOwog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTeW5jaHJvbm91cygpIHsKICAgICAg\nICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAw\nMDAwNCk7CiAgICAgIH0KICAgICAgcHVibGljIGJvb2xlYW4gZ2V0U3luY2hy\nb25vdXMoKSB7CiAgICAgICAgcmV0dXJuIHN5bmNocm9ub3VzXzsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTeW5jaHJvbm91cyhib29sZWFu\nIHZhbHVlKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDA0Owog\nICAgICAgIHN5bmNocm9ub3VzXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyU3luY2hyb25vdXMoKSB7CiAgICAgICAgYml0Rmll\nbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDQpOwogICAgICAgIHN5\nbmNocm9ub3VzXyA9IGZhbHNlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBvcHRp\nb25hbCB1aW50MzIgbWVzc2FnZUJvdW5kID0gNTsKICAgICAgcHJpdmF0ZSBp\nbnQgbWVzc2FnZUJvdW5kXyA7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc01l\nc3NhZ2VCb3VuZCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCk7CiAgICAgIH0KICAgICAgcHVi\nbGljIGludCBnZXRNZXNzYWdlQm91bmQoKSB7CiAgICAgICAgcmV0dXJuIG1l\nc3NhZ2VCb3VuZF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0\nTWVzc2FnZUJvdW5kKGludCB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwODsKICAgICAgICBtZXNzYWdlQm91bmRfID0gdmFsdWU7\nCiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNZXNzYWdlQm91bmQo\nKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAw\nMDAwMDgpOwogICAgICAgIG1lc3NhZ2VCb3VuZF8gPSAwOwogICAgICAgIG9u\nQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmlwdGlvblByZWZl\ncmVuY2VzIHByZWZlcmVuY2VzID0gNjsKICAgICAgcHJpdmF0ZSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25QcmVmZXJlbmNlcyBwcmVmZXJlbmNlc18gPSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJl\nbmNlcy5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgcHJpdmF0ZSBjb20u\nZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5C\ndWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlc09yQnVpbGRlcj4gcHJlZmVy\nZW5jZXNCdWlsZGVyXzsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzUHJlZmVy\nZW5jZXMoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAw\nMDAwMTApID09IDB4MDAwMDAwMTApOwogICAgICB9CiAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25QcmVmZXJlbmNlcyBnZXRQcmVmZXJlbmNlcygpIHsKICAgICAg\nICBpZiAocHJlZmVyZW5jZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAg\nICByZXR1cm4gcHJlZmVyZW5jZXNfOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICByZXR1cm4gcHJlZmVyZW5jZXNCdWlsZGVyXy5nZXRNZXNzYWdlKCk7\nCiAgICAgICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFBy\nZWZlcmVuY2VzKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHZhbHVlKSB7CiAgICAg\nICAgaWYgKHByZWZlcmVuY2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAg\nICBwcmVmZXJlbmNlc18gPSB2YWx1ZTsKICAgICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwcmVmZXJlbmNlc0J1aWxk\nZXJfLnNldE1lc3NhZ2UodmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfIHw9IDB4MDAwMDAwMTA7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UHJlZmVyZW5jZXMoCiAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5CdWlsZGVyIGJ1aWxkZXJG\nb3JWYWx1ZSkgewogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIHByZWZlcmVuY2VzXyA9IGJ1aWxkZXJGb3JW\nYWx1ZS5idWlsZCgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIHByZWZlcmVuY2VzQnVpbGRlcl8uc2V0TWVz\nc2FnZShidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgfQogICAg\nICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAxMDsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZVByZWZl\ncmVuY2VzKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHZhbHVlKSB7CiAgICAgICAg\naWYgKHByZWZlcmVuY2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\naWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMTApID09IDB4MDAwMDAwMTAp\nICYmCiAgICAgICAgICAgICAgcHJlZmVyZW5jZXNfICE9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblBy\nZWZlcmVuY2VzLmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAgICAg\nIHByZWZlcmVuY2VzXyA9CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXMubmV3QnVpbGRlcihwcmVmZXJlbmNlc18pLm1lcmdlRnJvbSh2YWx1\nZSkuYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBwcmVmZXJlbmNlc18gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAg\nICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBw\ncmVmZXJlbmNlc0J1aWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7CiAgICAgICAg\nfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAxMDsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVh\nclByZWZlcmVuY2VzKCkgewogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIHByZWZlcmVuY2VzXyA9IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblByZWZlcmVuY2VzLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBy\nZWZlcmVuY2VzQnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAg\nYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMTApOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25QcmVmZXJlbmNlcy5CdWlsZGVyIGdldFByZWZlcmVuY2VzQnVpbGRlcigp\nIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMTA7CiAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIGdldFByZWZlcmVuY2VzRmll\nbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpcHRpb25QcmVmZXJlbmNlc09yQnVpbGRlciBnZXRQcmVmZXJlbmNl\nc09yQnVpbGRlcigpIHsKICAgICAgICBpZiAocHJlZmVyZW5jZXNCdWlsZGVy\nXyAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gcHJlZmVyZW5jZXNCdWls\nZGVyXy5nZXRNZXNzYWdlT3JCdWlsZGVyKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIHJldHVybiBwcmVmZXJlbmNlc187CiAgICAgICAgfQogICAg\nICB9CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVG\naWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcywg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uUHJlZmVyZW5jZXMuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXNPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0UHJlZmVyZW5jZXNGaWVs\nZEJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKHByZWZlcmVuY2VzQnVpbGRlcl8g\nPT0gbnVsbCkgewogICAgICAgICAgcHJlZmVyZW5jZXNCdWlsZGVyXyA9IG5l\ndyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcywgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJl\nZmVyZW5jZXMuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXNPckJ1aWxk\nZXI+KAogICAgICAgICAgICAgICAgICBwcmVmZXJlbmNlc18sCiAgICAgICAg\nICAgICAgICAgIGdldFBhcmVudEZvckNoaWxkcmVuKCksCiAgICAgICAgICAg\nICAgICAgIGlzQ2xlYW4oKSk7CiAgICAgICAgICBwcmVmZXJlbmNlc18gPSBu\ndWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJlZmVyZW5jZXNCdWls\nZGVyXzsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgYm9vbCBm\nb3JjZUF0dGFjaCA9IDcgW2RlZmF1bHQgPSBmYWxzZV07CiAgICAgIHByaXZh\ndGUgYm9vbGVhbiBmb3JjZUF0dGFjaF8gOwogICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNGb3JjZUF0dGFjaCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAyMCkgPT0gMHgwMDAwMDAyMCk7CiAgICAgIH0KICAg\nICAgcHVibGljIGJvb2xlYW4gZ2V0Rm9yY2VBdHRhY2goKSB7CiAgICAgICAg\ncmV0dXJuIGZvcmNlQXR0YWNoXzsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRGb3JjZUF0dGFjaChib29sZWFuIHZhbHVlKSB7CiAgICAgICAg\nYml0RmllbGQwXyB8PSAweDAwMDAwMDIwOwogICAgICAgIGZvcmNlQXR0YWNo\nXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRm9y\nY2VBdHRhY2goKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBf\nICYgfjB4MDAwMDAwMjApOwogICAgICAgIGZvcmNlQXR0YWNoXyA9IGZhbHNl\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIAogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9p\nbnQoYnVpbGRlcl9zY29wZTpIZWR3aWcuU3Vic2NyaWJlUmVxdWVzdCkKICAg\nIH0KICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0g\nbmV3IFN1YnNjcmliZVJlcXVlc3QodHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0\nYW5jZS5pbml0RmllbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9j\nX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuU3Vic2NyaWJl\nUmVxdWVzdCkKICB9CiAgCiAgcHVibGljIGludGVyZmFjZSBTdWJzY3JpcHRp\nb25PcHRpb25zT3JCdWlsZGVyCiAgICAgIGV4dGVuZHMgY29tLmdvb2dsZS5w\ncm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsKICAgIAogICAgLy8gb3B0aW9u\nYWwgYm9vbCBmb3JjZUF0dGFjaCA9IDEgW2RlZmF1bHQgPSBmYWxzZV07CiAg\nICBib29sZWFuIGhhc0ZvcmNlQXR0YWNoKCk7CiAgICBib29sZWFuIGdldEZv\ncmNlQXR0YWNoKCk7CiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vi\nc2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaCBjcmVhdGVPckF0dGFjaCA9\nIDIgW2RlZmF1bHQgPSBDUkVBVEVfT1JfQVRUQUNIXTsKICAgIGJvb2xlYW4g\naGFzQ3JlYXRlT3JBdHRhY2goKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRl\nT3JBdHRhY2ggZ2V0Q3JlYXRlT3JBdHRhY2goKTsKICAgIAogICAgLy8gb3B0\naW9uYWwgdWludDMyIG1lc3NhZ2VCb3VuZCA9IDMgW2RlZmF1bHQgPSAwXTsK\nICAgIGJvb2xlYW4gaGFzTWVzc2FnZUJvdW5kKCk7CiAgICBpbnQgZ2V0TWVz\nc2FnZUJvdW5kKCk7CiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWFw\nIG9wdGlvbnMgPSA0OwogICAgYm9vbGVhbiBoYXNPcHRpb25zKCk7CiAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAg\nZ2V0T3B0aW9ucygpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWFwT3JCdWlsZGVyIGdldE9wdGlvbnNPckJ1aWxk\nZXIoKTsKICAgIAogICAgLy8gb3B0aW9uYWwgc3RyaW5nIG1lc3NhZ2VGaWx0\nZXIgPSA1OwogICAgYm9vbGVhbiBoYXNNZXNzYWdlRmlsdGVyKCk7CiAgICBT\ndHJpbmcgZ2V0TWVzc2FnZUZpbHRlcigpOwogICAgCiAgICAvLyBvcHRpb25h\nbCB1aW50MzIgbWVzc2FnZVdpbmRvd1NpemUgPSA2OwogICAgYm9vbGVhbiBo\nYXNNZXNzYWdlV2luZG93U2l6ZSgpOwogICAgaW50IGdldE1lc3NhZ2VXaW5k\nb3dTaXplKCk7CiAgICAKICAgIC8vIG9wdGlvbmFsIGJvb2wgZW5hYmxlUmVz\ndWJzY3JpYmUgPSA3IFtkZWZhdWx0ID0gdHJ1ZV07CiAgICBib29sZWFuIGhh\nc0VuYWJsZVJlc3Vic2NyaWJlKCk7CiAgICBib29sZWFuIGdldEVuYWJsZVJl\nc3Vic2NyaWJlKCk7CiAgfQogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3Mg\nU3Vic2NyaXB0aW9uT3B0aW9ucyBleHRlbmRzCiAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZQogICAgICBpbXBsZW1lbnRzIFN1\nYnNjcmlwdGlvbk9wdGlvbnNPckJ1aWxkZXIgewogICAgLy8gVXNlIFN1YnNj\ncmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAg\nIHByaXZhdGUgU3Vic2NyaXB0aW9uT3B0aW9ucyhCdWlsZGVyIGJ1aWxkZXIp\nIHsKICAgICAgc3VwZXIoYnVpbGRlcik7CiAgICB9CiAgICBwcml2YXRlIFN1\nYnNjcmlwdGlvbk9wdGlvbnMoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFN1YnNjcmlwdGlvbk9wdGlvbnMgZGVm\nYXVsdEluc3RhbmNlOwogICAgcHVibGljIHN0YXRpYyBTdWJzY3JpcHRpb25P\ncHRpb25zIGdldERlZmF1bHRJbnN0YW5jZSgpIHsKICAgICAgcmV0dXJuIGRl\nZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVibGljIFN1YnNjcmlw\ndGlvbk9wdGlvbnMgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAg\nICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAg\nICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25PcHRp\nb25zX2Rlc2NyaXB0b3I7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3Nv\nclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUo\nKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlw\ndGlvbk9wdGlvbnNfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgfQogICAgCiAg\nICBwcml2YXRlIGludCBiaXRGaWVsZDBfOwogICAgLy8gb3B0aW9uYWwgYm9v\nbCBmb3JjZUF0dGFjaCA9IDEgW2RlZmF1bHQgPSBmYWxzZV07CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBGT1JDRUFUVEFDSF9GSUVMRF9OVU1CRVIg\nPSAxOwogICAgcHJpdmF0ZSBib29sZWFuIGZvcmNlQXR0YWNoXzsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc0ZvcmNlQXR0YWNoKCkgewogICAgICByZXR1cm4g\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAg\nICB9CiAgICBwdWJsaWMgYm9vbGVhbiBnZXRGb3JjZUF0dGFjaCgpIHsKICAg\nICAgcmV0dXJuIGZvcmNlQXR0YWNoXzsKICAgIH0KICAgIAogICAgLy8gb3B0\naW9uYWwgLkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNo\nIGNyZWF0ZU9yQXR0YWNoID0gMiBbZGVmYXVsdCA9IENSRUFURV9PUl9BVFRB\nQ0hdOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgQ1JFQVRFT1JBVFRB\nQ0hfRklFTERfTlVNQkVSID0gMjsKICAgIHByaXZhdGUgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndC5DcmVhdGVPckF0dGFjaCBjcmVhdGVPckF0dGFjaF87CiAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNDcmVhdGVPckF0dGFjaCgpIHsKICAgICAgcmV0dXJuICgo\nYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAg\nfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2ggZ2V0\nQ3JlYXRlT3JBdHRhY2goKSB7CiAgICAgIHJldHVybiBjcmVhdGVPckF0dGFj\naF87CiAgICB9CiAgICAKICAgIC8vIG9wdGlvbmFsIHVpbnQzMiBtZXNzYWdl\nQm91bmQgPSAzIFtkZWZhdWx0ID0gMF07CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBNRVNTQUdFQk9VTkRfRklFTERfTlVNQkVSID0gMzsKICAgIHBy\naXZhdGUgaW50IG1lc3NhZ2VCb3VuZF87CiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNNZXNzYWdlQm91bmQoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDA0KSA9PSAweDAwMDAwMDA0KTsKICAgIH0KICAgIHB1Ymxp\nYyBpbnQgZ2V0TWVzc2FnZUJvdW5kKCkgewogICAgICByZXR1cm4gbWVzc2Fn\nZUJvdW5kXzsKICAgIH0KICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5N\nYXAgb3B0aW9ucyA9IDQ7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBP\nUFRJT05TX0ZJRUxEX05VTUJFUiA9IDQ7CiAgICBwcml2YXRlIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcCBvcHRpb25z\nXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc09wdGlvbnMoKSB7CiAgICAgIHJl\ndHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAwMDAwMDA4\nKTsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NYXAgZ2V0T3B0aW9ucygpIHsKICAgICAgcmV0\ndXJuIG9wdGlvbnNfOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcE9yQnVpbGRlciBnZXRP\ncHRpb25zT3JCdWlsZGVyKCkgewogICAgICByZXR1cm4gb3B0aW9uc187CiAg\nICB9CiAgICAKICAgIC8vIG9wdGlvbmFsIHN0cmluZyBtZXNzYWdlRmlsdGVy\nID0gNTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IE1FU1NBR0VGSUxU\nRVJfRklFTERfTlVNQkVSID0gNTsKICAgIHByaXZhdGUgamF2YS5sYW5nLk9i\namVjdCBtZXNzYWdlRmlsdGVyXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc01l\nc3NhZ2VGaWx0ZXIoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAw\neDAwMDAwMDEwKSA9PSAweDAwMDAwMDEwKTsKICAgIH0KICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0TWVzc2FnZUZpbHRlcigpIHsKICAgICAgamF2YS5sYW5nLk9i\namVjdCByZWYgPSBtZXNzYWdlRmlsdGVyXzsKICAgICAgaWYgKHJlZiBpbnN0\nYW5jZW9mIFN0cmluZykgewogICAgICAgIHJldHVybiAoU3RyaW5nKSByZWY7\nCiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nIGJzID0gCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgICBTdHJpbmcgcyA9IGJzLnRv\nU3RyaW5nVXRmOCgpOwogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVm\nLkludGVybmFsLmlzVmFsaWRVdGY4KGJzKSkgewogICAgICAgICAgbWVzc2Fn\nZUZpbHRlcl8gPSBzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gczsKICAg\nICAgfQogICAgfQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZ2V0TWVzc2FnZUZpbHRlckJ5dGVzKCkgewogICAgICBqYXZh\nLmxhbmcuT2JqZWN0IHJlZiA9IG1lc3NhZ2VGaWx0ZXJfOwogICAgICBpZiAo\ncmVmIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIGIgPSAKICAgICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgoU3RyaW5nKSBy\nZWYpOwogICAgICAgIG1lc3NhZ2VGaWx0ZXJfID0gYjsKICAgICAgICByZXR1\ncm4gYjsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gKGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmOwogICAgICB9CiAgICB9CiAg\nICAKICAgIC8vIG9wdGlvbmFsIHVpbnQzMiBtZXNzYWdlV2luZG93U2l6ZSA9\nIDY7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdFV0lORE9X\nU0laRV9GSUVMRF9OVU1CRVIgPSA2OwogICAgcHJpdmF0ZSBpbnQgbWVzc2Fn\nZVdpbmRvd1NpemVfOwogICAgcHVibGljIGJvb2xlYW4gaGFzTWVzc2FnZVdp\nbmRvd1NpemUoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDIwKSA9PSAweDAwMDAwMDIwKTsKICAgIH0KICAgIHB1YmxpYyBpbnQg\nZ2V0TWVzc2FnZVdpbmRvd1NpemUoKSB7CiAgICAgIHJldHVybiBtZXNzYWdl\nV2luZG93U2l6ZV87CiAgICB9CiAgICAKICAgIC8vIG9wdGlvbmFsIGJvb2wg\nZW5hYmxlUmVzdWJzY3JpYmUgPSA3IFtkZWZhdWx0ID0gdHJ1ZV07CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBFTkFCTEVSRVNVQlNDUklCRV9GSUVM\nRF9OVU1CRVIgPSA3OwogICAgcHJpdmF0ZSBib29sZWFuIGVuYWJsZVJlc3Vi\nc2NyaWJlXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc0VuYWJsZVJlc3Vic2Ny\naWJlKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDA0\nMCkgPT0gMHgwMDAwMDA0MCk7CiAgICB9CiAgICBwdWJsaWMgYm9vbGVhbiBn\nZXRFbmFibGVSZXN1YnNjcmliZSgpIHsKICAgICAgcmV0dXJuIGVuYWJsZVJl\nc3Vic2NyaWJlXzsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2b2lkIGluaXRG\naWVsZHMoKSB7CiAgICAgIGZvcmNlQXR0YWNoXyA9IGZhbHNlOwogICAgICBj\ncmVhdGVPckF0dGFjaF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNo\nLkNSRUFURV9PUl9BVFRBQ0g7CiAgICAgIG1lc3NhZ2VCb3VuZF8gPSAwOwog\nICAgICBvcHRpb25zXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1hcC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nbWVzc2FnZUZpbHRlcl8gPSAiIjsKICAgICAgbWVzc2FnZVdpbmRvd1NpemVf\nID0gMDsKICAgICAgZW5hYmxlUmVzdWJzY3JpYmVfID0gdHJ1ZTsKICAgIH0K\nICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsK\nICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAg\nICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXpl\nZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgIT0gLTEpIHJldHVybiBpc0lu\naXRpYWxpemVkID09IDE7CiAgICAgIAogICAgICBtZW1vaXplZElzSW5pdGlh\nbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBnZXRTZXJpYWxp\nemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCb29s\nKDEsIGZvcmNlQXR0YWNoXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAg\nb3V0cHV0LndyaXRlRW51bSgyLCBjcmVhdGVPckF0dGFjaF8uZ2V0TnVtYmVy\nKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDA0KSA9PSAweDAwMDAwMDA0KSkgewogICAgICAgIG91dHB1dC53cml0ZVVJ\nbnQzMigzLCBtZXNzYWdlQm91bmRfKTsKICAgICAgfQogICAgICBpZiAoKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCkpIHsKICAg\nICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDQsIG9wdGlvbnNfKTsKICAgICAg\nfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAxMCkgPT0gMHgw\nMDAwMDAxMCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcyg1LCBnZXRN\nZXNzYWdlRmlsdGVyQnl0ZXMoKSk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwMjApID09IDB4MDAwMDAwMjApKSB7CiAgICAg\nICAgb3V0cHV0LndyaXRlVUludDMyKDYsIG1lc3NhZ2VXaW5kb3dTaXplXyk7\nCiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwNDAp\nID09IDB4MDAwMDAwNDApKSB7CiAgICAgICAgb3V0cHV0LndyaXRlQm9vbCg3\nLCBlbmFibGVSZXN1YnNjcmliZV8pOwogICAgICB9CiAgICAgIGdldFVua25v\nd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1\nYmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXpl\nID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0g\nLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBp\nZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkp\nIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRP\ndXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQm9vbFNpemUoMSwgZm9y\nY2VBdHRhY2hfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBzaXplICs9\nIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAg\nICAgIC5jb21wdXRlRW51bVNpemUoMiwgY3JlYXRlT3JBdHRhY2hfLmdldE51\nbWJlcigpKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCkpIHsKICAgICAgICBzaXplICs9IGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAg\nIC5jb21wdXRlVUludDMyU2l6ZSgzLCBtZXNzYWdlQm91bmRfKTsKICAgICAg\nfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwOCkgPT0gMHgw\nMDAwMDAwOCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlTWVzc2Fn\nZVNpemUoNCwgb3B0aW9uc18pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDEwKSA9PSAweDAwMDAwMDEwKSkgewogICAgICAg\nIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVh\nbQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoNSwgZ2V0TWVzc2FnZUZp\nbHRlckJ5dGVzKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDIwKSA9PSAweDAwMDAwMDIwKSkgewogICAgICAgIHNpemUg\nKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAg\nICAgICAgLmNvbXB1dGVVSW50MzJTaXplKDYsIG1lc3NhZ2VXaW5kb3dTaXpl\nXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nNDApID09IDB4MDAwMDAwNDApKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29t\ncHV0ZUJvb2xTaXplKDcsIGVuYWJsZVJlc3Vic2NyaWJlXyk7CiAgICAgIH0K\nICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXpl\nZFNpemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7\nCiAgICAgIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAgIEBq\nYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcuT2Jq\nZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uT2Jq\nZWN0U3RyZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndyaXRl\nUmVwbGFjZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvbk9wdGlvbnMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nbk9wdGlvbnMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uT3B0aW9ucyBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBwYXJzZUZyb20oCiAgICAg\nICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25PcHRpb25zIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nbk9wdGlvbnMgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJl\nYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIHBhcnNlRGVsaW1pdGVkRnJvbShq\nYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nQnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZy\nb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJz\nZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25z\nIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWls\nZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURl\nbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBwYXJzZUZyb20oCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0\nKQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlv\nbnMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkg\neyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxk\nZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7\nIH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvbk9wdGlvbnMgcHJvdG90eXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMg\nQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMp\nOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3Rl\nZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBh\ncmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihw\nYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRlcjsKICAgIH0KICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8\nQnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9uc09y\nQnVpbGRlciB7CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2ds\nZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBn\nZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX1N1YnNjcmlwdGlvbk9wdGlvbnNfZGVzY3JpcHRvcjsKICAgICAg\nfQogICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAg\nIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJl\ndHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvbk9wdGlvbnNf\nZmllbGRBY2Nlc3NvclRhYmxlOwogICAgICB9CiAgICAgIAogICAgICAvLyBD\nb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkK\nICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgewogICAgICAgIG1heWJlRm9yY2VC\ndWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICAKICAgICAg\ncHJpdmF0ZSBCdWlsZGVyKEJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAg\nICAgc3VwZXIocGFyZW50KTsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlcklu\naXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgcHJpdmF0ZSB2b2lkIG1h\neWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7CiAgICAgICAgaWYg\nKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5hbHdheXNV\nc2VGaWVsZEJ1aWxkZXJzKSB7CiAgICAgICAgICBnZXRPcHRpb25zRmllbGRC\ndWlsZGVyKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGUgc3Rh\ndGljIEJ1aWxkZXIgY3JlYXRlKCkgewogICAgICAgIHJldHVybiBuZXcgQnVp\nbGRlcigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBj\nbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIGZvcmNl\nQXR0YWNoXyA9IGZhbHNlOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0Rmll\nbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBjcmVhdGVPckF0dGFjaF8g\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRB\nQ0g7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAw\nMDAwMDIpOwogICAgICAgIG1lc3NhZ2VCb3VuZF8gPSAwOwogICAgICAgIGJp\ndEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA0KTsKICAgICAg\nICBpZiAob3B0aW9uc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIG9w\ndGlvbnNfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICBvcHRpb25zQnVpbGRlcl8uY2xlYXIoKTsKICAgICAg\nICB9CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAw\nMDAwMDgpOwogICAgICAgIG1lc3NhZ2VGaWx0ZXJfID0gIiI7CiAgICAgICAg\nYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMTApOwogICAg\nICAgIG1lc3NhZ2VXaW5kb3dTaXplXyA9IDA7CiAgICAgICAgYml0RmllbGQw\nXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMjApOwogICAgICAgIGVuYWJs\nZVJlc3Vic2NyaWJlXyA9IHRydWU7CiAgICAgICAgYml0RmllbGQwXyA9IChi\naXRGaWVsZDBfICYgfjB4MDAwMDAwNDApOwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgp\nIHsKICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKGJ1aWxkUGFy\ndGlhbCgpKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGNvbS5nb29n\nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAg\nZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvbk9wdGlvbnMuZ2V0RGVzY3JpcHRvcigpOwogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBnZXREZWZhdWx0SW5zdGFu\nY2VGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25z\nLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBidWlsZCgpIHsKICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25PcHRpb25zIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAg\nIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhy\nb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAg\nICAKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIGJ1aWxkUGFyc2Vk\nKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nT3B0aW9ucyByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAo\nIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5l\nd1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICBy\nZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIGJ1aWxkUGFydGlhbCgp\nIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIHJlc3VsdCA9IG5ldyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25PcHRpb25zKHRoaXMpOwogICAgICAgIGludCBmcm9tX2JpdEZpZWxk\nMF8gPSBiaXRGaWVsZDBfOwogICAgICAgIGludCB0b19iaXRGaWVsZDBfID0g\nMDsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAx\nKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8\nPSAweDAwMDAwMDAxOwogICAgICAgIH0KICAgICAgICByZXN1bHQuZm9yY2VB\ndHRhY2hfID0gZm9yY2VBdHRhY2hfOwogICAgICAgIGlmICgoKGZyb21fYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAg\nICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgfQog\nICAgICAgIHJlc3VsdC5jcmVhdGVPckF0dGFjaF8gPSBjcmVhdGVPckF0dGFj\naF87CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAw\nNCkgPT0gMHgwMDAwMDAwNCkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwNDsKICAgICAgICB9CiAgICAgICAgcmVzdWx0Lm1lc3Nh\nZ2VCb3VuZF8gPSBtZXNzYWdlQm91bmRfOwogICAgICAgIGlmICgoKGZyb21f\nYml0RmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpKSB7CiAg\nICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAg\nfQogICAgICAgIGlmIChvcHRpb25zQnVpbGRlcl8gPT0gbnVsbCkgewogICAg\nICAgICAgcmVzdWx0Lm9wdGlvbnNfID0gb3B0aW9uc187CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHJlc3VsdC5vcHRpb25zXyA9IG9wdGlvbnNCdWls\nZGVyXy5idWlsZCgpOwogICAgICAgIH0KICAgICAgICBpZiAoKChmcm9tX2Jp\ndEZpZWxkMF8gJiAweDAwMDAwMDEwKSA9PSAweDAwMDAwMDEwKSkgewogICAg\nICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDEwOwogICAgICAgIH0K\nICAgICAgICByZXN1bHQubWVzc2FnZUZpbHRlcl8gPSBtZXNzYWdlRmlsdGVy\nXzsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDIw\nKSA9PSAweDAwMDAwMDIwKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8\nPSAweDAwMDAwMDIwOwogICAgICAgIH0KICAgICAgICByZXN1bHQubWVzc2Fn\nZVdpbmRvd1NpemVfID0gbWVzc2FnZVdpbmRvd1NpemVfOwogICAgICAgIGlm\nICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwNDApID09IDB4MDAwMDAw\nNDApKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwNDA7\nCiAgICAgICAgfQogICAgICAgIHJlc3VsdC5lbmFibGVSZXN1YnNjcmliZV8g\nPSBlbmFibGVSZXN1YnNjcmliZV87CiAgICAgICAgcmVzdWx0LmJpdEZpZWxk\nMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQoKTsKICAgICAg\nICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdl\nIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uT3B0aW9ucykgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naXB0aW9uT3B0aW9ucylvdGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIG90aGVyKSB7CiAg\nICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMuZ2V0RGVmYXVs\ndEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlmIChvdGhlci5o\nYXNGb3JjZUF0dGFjaCgpKSB7CiAgICAgICAgICBzZXRGb3JjZUF0dGFjaChv\ndGhlci5nZXRGb3JjZUF0dGFjaCgpKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKG90aGVyLmhhc0NyZWF0ZU9yQXR0YWNoKCkpIHsKICAgICAgICAgIHNldENy\nZWF0ZU9yQXR0YWNoKG90aGVyLmdldENyZWF0ZU9yQXR0YWNoKCkpOwogICAg\nICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzTWVzc2FnZUJvdW5kKCkpIHsK\nICAgICAgICAgIHNldE1lc3NhZ2VCb3VuZChvdGhlci5nZXRNZXNzYWdlQm91\nbmQoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNPcHRpb25z\nKCkpIHsKICAgICAgICAgIG1lcmdlT3B0aW9ucyhvdGhlci5nZXRPcHRpb25z\nKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzTWVzc2FnZUZp\nbHRlcigpKSB7CiAgICAgICAgICBzZXRNZXNzYWdlRmlsdGVyKG90aGVyLmdl\ndE1lc3NhZ2VGaWx0ZXIoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhl\nci5oYXNNZXNzYWdlV2luZG93U2l6ZSgpKSB7CiAgICAgICAgICBzZXRNZXNz\nYWdlV2luZG93U2l6ZShvdGhlci5nZXRNZXNzYWdlV2luZG93U2l6ZSgpKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc0VuYWJsZVJlc3Vic2Ny\naWJlKCkpIHsKICAgICAgICAgIHNldEVuYWJsZVJlc3Vic2NyaWJlKG90aGVy\nLmdldEVuYWJsZVJlc3Vic2NyaWJlKCkpOwogICAgICAgIH0KICAgICAgICB0\naGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRz\nKCkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAg\nICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNl\ndC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAg\nICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHdoaWxl\nICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygp\nOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgY2FzZSAw\nOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3du\nRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICBkZWZhdWx0\nOiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZChpbnB1\ndCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAg\nICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5i\ndWlsZCgpKTsKICAgICAgICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2Ug\nODogewogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsK\nICAgICAgICAgICAgICBmb3JjZUF0dGFjaF8gPSBpbnB1dC5yZWFkQm9vbCgp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgMTY6IHsKICAgICAgICAgICAgICBpbnQgcmF3VmFsdWUgPSBp\nbnB1dC5yZWFkRW51bSgpOwogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Qu\nQ3JlYXRlT3JBdHRhY2ggdmFsdWUgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9y\nQXR0YWNoLnZhbHVlT2YocmF3VmFsdWUpOwogICAgICAgICAgICAgIGlmICh2\nYWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB1bmtub3duRmllbGRz\nLm1lcmdlVmFyaW50RmllbGQoMiwgcmF3VmFsdWUpOwogICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDI7CiAgICAgICAgICAgICAgICBjcmVhdGVPckF0dGFjaF8gPSB2YWx1\nZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgY2FzZSAyNDogewogICAgICAgICAgICAg\nIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwNDsKICAgICAgICAgICAgICBtZXNz\nYWdlQm91bmRfID0gaW5wdXQucmVhZFVJbnQzMigpOwogICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMzQ6IHsK\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NYXAuQnVpbGRlciBzdWJCdWlsZGVyID0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLm5ld0J1aWxk\nZXIoKTsKICAgICAgICAgICAgICBpZiAoaGFzT3B0aW9ucygpKSB7CiAgICAg\nICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRPcHRpb25zKCkp\nOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVz\nc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAg\nICAgICAgc2V0T3B0aW9ucyhzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsK\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBjYXNlIDQyOiB7CiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAw\nMDAwMDEwOwogICAgICAgICAgICAgIG1lc3NhZ2VGaWx0ZXJfID0gaW5wdXQu\ncmVhZEJ5dGVzKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgY2FzZSA0ODogewogICAgICAgICAgICAgIGJpdEZp\nZWxkMF8gfD0gMHgwMDAwMDAyMDsKICAgICAgICAgICAgICBtZXNzYWdlV2lu\nZG93U2l6ZV8gPSBpbnB1dC5yZWFkVUludDMyKCk7CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA1Njogewog\nICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDA0MDsKICAgICAg\nICAgICAgICBlbmFibGVSZXN1YnNjcmliZV8gPSBpbnB1dC5yZWFkQm9vbCgp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGlu\ndCBiaXRGaWVsZDBfOwogICAgICAKICAgICAgLy8gb3B0aW9uYWwgYm9vbCBm\nb3JjZUF0dGFjaCA9IDEgW2RlZmF1bHQgPSBmYWxzZV07CiAgICAgIHByaXZh\ndGUgYm9vbGVhbiBmb3JjZUF0dGFjaF8gOwogICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNGb3JjZUF0dGFjaCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAg\nICAgcHVibGljIGJvb2xlYW4gZ2V0Rm9yY2VBdHRhY2goKSB7CiAgICAgICAg\ncmV0dXJuIGZvcmNlQXR0YWNoXzsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRGb3JjZUF0dGFjaChib29sZWFuIHZhbHVlKSB7CiAgICAgICAg\nYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIGZvcmNlQXR0YWNo\nXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyRm9y\nY2VBdHRhY2goKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBf\nICYgfjB4MDAwMDAwMDEpOwogICAgICAgIGZvcmNlQXR0YWNoXyA9IGZhbHNl\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNj\ncmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2ggY3JlYXRlT3JBdHRhY2ggPSAy\nIFtkZWZhdWx0ID0gQ1JFQVRFX09SX0FUVEFDSF07CiAgICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaCBjcmVhdGVPckF0dGFjaF8g\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRB\nQ0g7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc0NyZWF0ZU9yQXR0YWNoKCkg\newogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9\nPSAweDAwMDAwMDAyKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVx\ndWVzdC5DcmVhdGVPckF0dGFjaCBnZXRDcmVhdGVPckF0dGFjaCgpIHsKICAg\nICAgICByZXR1cm4gY3JlYXRlT3JBdHRhY2hfOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIHNldENyZWF0ZU9yQXR0YWNoKG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Qu\nQ3JlYXRlT3JBdHRhY2ggdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0g\nbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0\naW9uKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMjsKICAgICAgICBjcmVhdGVPckF0dGFjaF8gPSB2YWx1ZTsKICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckNyZWF0ZU9yQXR0YWNoKCkgewog\nICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAy\nKTsKICAgICAgICBjcmVhdGVPckF0dGFjaF8gPSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNy\nZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0g7CiAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAg\nICAgIC8vIG9wdGlvbmFsIHVpbnQzMiBtZXNzYWdlQm91bmQgPSAzIFtkZWZh\ndWx0ID0gMF07CiAgICAgIHByaXZhdGUgaW50IG1lc3NhZ2VCb3VuZF8gOwog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNNZXNzYWdlQm91bmQoKSB7CiAgICAg\nICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAw\nMDAwMDQpOwogICAgICB9CiAgICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZUJv\ndW5kKCkgewogICAgICAgIHJldHVybiBtZXNzYWdlQm91bmRfOwogICAgICB9\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VCb3VuZChpbnQgdmFs\ndWUpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAgICAg\nICAgbWVzc2FnZUJvdW5kXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyTWVzc2FnZUJvdW5kKCkgewogICAgICAgIGJpdEZpZWxk\nMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA0KTsKICAgICAgICBtZXNz\nYWdlQm91bmRfID0gMDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwg\nLkhlZHdpZy5NYXAgb3B0aW9ucyA9IDQ7CiAgICAgIHByaXZhdGUgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIG9wdGlv\nbnNfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWFwLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBwcml2YXRlIGNv\nbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWFwLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NYXAuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWFwT3JCdWlsZGVyPiBvcHRpb25zQnVpbGRlcl87CiAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc09wdGlvbnMoKSB7CiAgICAgICAgcmV0\ndXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgp\nOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NYXAgZ2V0T3B0aW9ucygpIHsKICAgICAg\nICBpZiAob3B0aW9uc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJl\ndHVybiBvcHRpb25zXzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0\ndXJuIG9wdGlvbnNCdWlsZGVyXy5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE9wdGlvbnMob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwIHZhbHVl\nKSB7CiAgICAgICAgaWYgKG9wdGlvbnNCdWlsZGVyXyA9PSBudWxsKSB7CiAg\nICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAgIH0KICAg\nICAgICAgIG9wdGlvbnNfID0gdmFsdWU7CiAgICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3B0aW9uc0J1aWxkZXJf\nLnNldE1lc3NhZ2UodmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0T3B0aW9ucygKICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1h\ncC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAgIGlmIChvcHRp\nb25zQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgb3B0aW9uc18gPSBi\ndWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvcHRpb25zQnVpbGRlcl8u\nc2V0TWVzc2FnZShidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAg\nfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJn\nZU9wdGlvbnMob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFwIHZhbHVlKSB7CiAgICAgICAgaWYgKG9wdGlvbnNCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCkgJiYKICAgICAgICAgICAgICBvcHRp\nb25zXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NYXAuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAgICAgICAgICAg\nb3B0aW9uc18gPQogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5uZXdCdWlsZGVyKG9wdGlvbnNf\nKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgb3B0aW9uc18gPSB2YWx1ZTsKICAgICAg\nICAgIH0KICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICBvcHRpb25zQnVpbGRlcl8ubWVyZ2VGcm9tKHZhbHVlKTsK\nICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDA4Owog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsZWFyT3B0aW9ucygpIHsKICAgICAgICBpZiAob3B0aW9uc0J1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIG9wdGlvbnNfID0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLmdldERlZmF1\nbHRJbnN0YW5jZSgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIG9wdGlvbnNCdWlsZGVyXy5jbGVhcigpOwog\nICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+\nMHgwMDAwMDAwOCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1hcC5CdWlsZGVyIGdldE9wdGlvbnNCdWlsZGVyKCkgewogICAg\nICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwODsKICAgICAgICBvbkNoYW5n\nZWQoKTsKICAgICAgICByZXR1cm4gZ2V0T3B0aW9uc0ZpZWxkQnVpbGRlcigp\nLmdldEJ1aWxkZXIoKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwT3JCdWlsZGVy\nIGdldE9wdGlvbnNPckJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKG9wdGlvbnNC\ndWlsZGVyXyAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gb3B0aW9uc0J1\naWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmV0dXJuIG9wdGlvbnNfOwogICAgICAgIH0KICAgICAg\nfQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmll\nbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWFwLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuQnVpbGRlciwgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwT3JCdWlsZGVyPiAK\nICAgICAgICAgIGdldE9wdGlvbnNGaWVsZEJ1aWxkZXIoKSB7CiAgICAgICAg\naWYgKG9wdGlvbnNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBvcHRp\nb25zQnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVG\naWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwLCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYXAuQnVpbGRlciwgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFwT3JCdWls\nZGVyPigKICAgICAgICAgICAgICAgICAgb3B0aW9uc18sCiAgICAgICAgICAg\nICAgICAgIGdldFBhcmVudEZvckNoaWxkcmVuKCksCiAgICAgICAgICAgICAg\nICAgIGlzQ2xlYW4oKSk7CiAgICAgICAgICBvcHRpb25zXyA9IG51bGw7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBvcHRpb25zQnVpbGRlcl87CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIHN0cmluZyBtZXNzYWdlRmls\ndGVyID0gNTsKICAgICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IG1lc3Nh\nZ2VGaWx0ZXJfID0gIiI7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3Nh\nZ2VGaWx0ZXIoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMTApID09IDB4MDAwMDAwMTApOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBTdHJpbmcgZ2V0TWVzc2FnZUZpbHRlcigpIHsKICAgICAgICBqYXZhLmxh\nbmcuT2JqZWN0IHJlZiA9IG1lc3NhZ2VGaWx0ZXJfOwogICAgICAgIGlmICgh\nKHJlZiBpbnN0YW5jZW9mIFN0cmluZykpIHsKICAgICAgICAgIFN0cmluZyBz\nID0gKChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZikudG9T\ndHJpbmdVdGY4KCk7CiAgICAgICAgICBtZXNzYWdlRmlsdGVyXyA9IHM7CiAg\nICAgICAgICByZXR1cm4gczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\ncmV0dXJuIChTdHJpbmcpIHJlZjsKICAgICAgICB9CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgc2V0TWVzc2FnZUZpbHRlcihTdHJpbmcgdmFsdWUp\nIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3\nIE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0g\nMHgwMDAwMDAxMDsKICAgICAgICBtZXNzYWdlRmlsdGVyXyA9IHZhbHVlOwog\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWVzc2FnZUZpbHRlcigp\nIHsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAw\nMDAxMCk7CiAgICAgICAgbWVzc2FnZUZpbHRlcl8gPSBnZXREZWZhdWx0SW5z\ndGFuY2UoKS5nZXRNZXNzYWdlRmlsdGVyKCk7CiAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgdm9pZCBz\nZXRNZXNzYWdlRmlsdGVyKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAxMDsK\nICAgICAgICBtZXNzYWdlRmlsdGVyXyA9IHZhbHVlOwogICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCB1aW50\nMzIgbWVzc2FnZVdpbmRvd1NpemUgPSA2OwogICAgICBwcml2YXRlIGludCBt\nZXNzYWdlV2luZG93U2l6ZV8gOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNN\nZXNzYWdlV2luZG93U2l6ZSgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAyMCkgPT0gMHgwMDAwMDAyMCk7CiAgICAgIH0KICAg\nICAgcHVibGljIGludCBnZXRNZXNzYWdlV2luZG93U2l6ZSgpIHsKICAgICAg\nICByZXR1cm4gbWVzc2FnZVdpbmRvd1NpemVfOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VXaW5kb3dTaXplKGludCB2YWx1ZSkg\newogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAyMDsKICAgICAgICBt\nZXNzYWdlV2luZG93U2l6ZV8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBjbGVhck1lc3NhZ2VXaW5kb3dTaXplKCkgewogICAgICAgIGJp\ndEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDIwKTsKICAgICAg\nICBtZXNzYWdlV2luZG93U2l6ZV8gPSAwOwogICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAv\nLyBvcHRpb25hbCBib29sIGVuYWJsZVJlc3Vic2NyaWJlID0gNyBbZGVmYXVs\ndCA9IHRydWVdOwogICAgICBwcml2YXRlIGJvb2xlYW4gZW5hYmxlUmVzdWJz\nY3JpYmVfID0gdHJ1ZTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzRW5hYmxl\nUmVzdWJzY3JpYmUoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwNDApID09IDB4MDAwMDAwNDApOwogICAgICB9CiAgICAgIHB1\nYmxpYyBib29sZWFuIGdldEVuYWJsZVJlc3Vic2NyaWJlKCkgewogICAgICAg\nIHJldHVybiBlbmFibGVSZXN1YnNjcmliZV87CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgc2V0RW5hYmxlUmVzdWJzY3JpYmUoYm9vbGVhbiB2YWx1\nZSkgewogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDA0MDsKICAgICAg\nICBlbmFibGVSZXN1YnNjcmliZV8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5n\nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhckVuYWJsZVJlc3Vic2NyaWJlKCkgewogICAgICAg\nIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDQwKTsKICAg\nICAgICBlbmFibGVSZXN1YnNjcmliZV8gPSB0cnVlOwogICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29w\nZTpIZWR3aWcuU3Vic2NyaXB0aW9uT3B0aW9ucykKICAgIH0KICAgIAogICAg\nc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFN1YnNjcmlw\ndGlvbk9wdGlvbnModHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0\nRmllbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlv\nbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuU3Vic2NyaXB0aW9uT3B0aW9u\ncykKICB9CiAgCiAgcHVibGljIGludGVyZmFjZSBDb25zdW1lUmVxdWVzdE9y\nQnVpbGRlcgogICAgICBleHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYuTWVz\nc2FnZU9yQnVpbGRlciB7CiAgICAKICAgIC8vIHJlcXVpcmVkIGJ5dGVzIHN1\nYnNjcmliZXJJZCA9IDI7CiAgICBib29sZWFuIGhhc1N1YnNjcmliZXJJZCgp\nOwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1YnNj\ncmliZXJJZCgpOwogICAgCiAgICAvLyByZXF1aXJlZCAuSGVkd2lnLk1lc3Nh\nZ2VTZXFJZCBtc2dJZCA9IDM7CiAgICBib29sZWFuIGhhc01zZ0lkKCk7CiAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlU2VxSWQgZ2V0TXNnSWQoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRl\nciBnZXRNc2dJZE9yQnVpbGRlcigpOwogIH0KICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNsYXNzIENvbnN1bWVSZXF1ZXN0IGV4dGVuZHMKICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlCiAgICAgIGltcGxlbWVu\ndHMgQ29uc3VtZVJlcXVlc3RPckJ1aWxkZXIgewogICAgLy8gVXNlIENvbnN1\nbWVSZXF1ZXN0Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2\nYXRlIENvbnN1bWVSZXF1ZXN0KEJ1aWxkZXIgYnVpbGRlcikgewogICAgICBz\ndXBlcihidWlsZGVyKTsKICAgIH0KICAgIHByaXZhdGUgQ29uc3VtZVJlcXVl\nc3QoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIENvbnN1bWVSZXF1ZXN0IGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1\nYmxpYyBzdGF0aWMgQ29uc3VtZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNl\nKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgQ29uc3VtZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNl\nRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAg\nIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNj\ncmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19D\nb25zdW1lUmVxdWVzdF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90\nZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nl\nc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19Db25zdW1lUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAg\nICAKICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAvLyByZXF1aXJl\nZCBieXRlcyBzdWJzY3JpYmVySWQgPSAyOwogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgU1VCU0NSSUJFUklEX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBw\ncml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWRfOwogICAgcHVibGljIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCkg\newogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIGdldFN1YnNjcmliZXJJZCgpIHsKICAgICAgcmV0\ndXJuIHN1YnNjcmliZXJJZF87CiAgICB9CiAgICAKICAgIC8vIHJlcXVpcmVk\nIC5IZWR3aWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMzsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IE1TR0lEX0ZJRUxEX05VTUJFUiA9IDM7CiAgICBw\ncml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZCBtc2dJZF87CiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNNc2dJZCgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAw\nMDAwMDIpID09IDB4MDAwMDAwMDIpOwogICAgfQogICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VT\nZXFJZCBnZXRNc2dJZCgpIHsKICAgICAgcmV0dXJuIG1zZ0lkXzsKICAgIH0K\nICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXIgZ2V0TXNnSWRPckJ1aWxk\nZXIoKSB7CiAgICAgIHJldHVybiBtc2dJZF87CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICBzdWJzY3JpYmVySWRf\nID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAg\nICBtc2dJZF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICB9CiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0g\nLTE7CiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkg\newogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlh\nbGl6ZWQ7CiAgICAgIGlmIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4g\naXNJbml0aWFsaXplZCA9PSAxOwogICAgICAKICAgICAgaWYgKCFoYXNTdWJz\nY3JpYmVySWQoKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9\nIDA7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgh\naGFzTXNnSWQoKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9\nIDA7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgh\nZ2V0TXNnSWQoKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICBtZW1vaXpl\nZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgfQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVU\nbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1\ndCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9F\neGNlcHRpb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBp\nZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkp\nIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBzdWJzY3JpYmVySWRf\nKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBvdXRwdXQud3JpdGVNZXNz\nYWdlKDMsIG1zZ0lkXyk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxk\ncygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBp\nbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGlu\ndCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1v\naXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0\ndXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmICgoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAg\nICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0\ncmVhbQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMiwgc3Vic2NyaWJl\ncklkXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAw\nMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAgc2l6ZSArPSBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAu\nY29tcHV0ZU1lc3NhZ2VTaXplKDMsIG1zZ0lkXyk7CiAgICAgIH0KICAgICAg\nc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUo\nKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAg\nIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAgIEBqYXZhLmxh\nbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcuT2JqZWN0IHdy\naXRlUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uT2JqZWN0U3Ry\nZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndyaXRlUmVwbGFj\nZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0\nIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBwYXJzZUZy\nb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRh\ndGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdp\nc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0\nYSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBw\nYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29n\nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVl\nc3QgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgcGFyc2VGcm9tKGphdmEu\naW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuQ29uc3VtZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8u\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBwYXJzZURlbGltaXRlZEZy\nb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9\nIG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0\nZWRGcm9tKGlucHV0KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxk\nUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7\nCiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3Qg\ncGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJl\nYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxk\nZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVs\naW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAg\nICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNl\nIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQogICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IHBhcnNlRnJv\nbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJl\nYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBw\ndWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1\naWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxk\nZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJs\naWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBwcm90\nb3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\ncHJvdG90eXBlKTsKICAgIH0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRl\ncigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7IH0KICAgIAogICAgQGph\ndmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVp\nbGRlckZvclR5cGUoCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkJ1aWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgIEJ1\naWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVudCk7CiAgICAgIHJl\ndHVybiBidWlsZGVyOwogICAgfQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBj\nbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPgogICAgICAg\naW1wbGVtZW50cyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdE9yQnVpbGRlciB7CiAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAg\nICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0NvbnN1bWVSZXF1ZXN0\nX2Rlc2NyaXB0b3I7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3RlY3RlZCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nl\nc3NvclRhYmxlCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JU\nYWJsZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19D\nb25zdW1lUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICAgIH0KICAg\nICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdC5uZXdC\ndWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgewogICAgICAgIG1h\neWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAg\nICAKICAgICAgcHJpdmF0ZSBCdWlsZGVyKEJ1aWxkZXJQYXJlbnQgcGFyZW50\nKSB7CiAgICAgICAgc3VwZXIocGFyZW50KTsKICAgICAgICBtYXliZUZvcmNl\nQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgcHJpdmF0\nZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7CiAg\nICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7CiAgICAgICAgICBnZXRNc2dJ\nZEZpZWxkQnVpbGRlcigpOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2\nYXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICByZXR1cm4g\nbmV3IEJ1aWxkZXIoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgY2xlYXIoKSB7CiAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAg\nICBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nLkVNUFRZOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAm\nIH4weDAwMDAwMDAxKTsKICAgICAgICBpZiAobXNnSWRCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBtc2dJZF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVs\ndEluc3RhbmNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1zZ0lk\nQnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQw\nXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBj\nbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKGJ1\naWxkUGFydGlhbCgpKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNv\nbnN1bWVSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZv\nclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LmdldERlZmF1\nbHRJbnN0YW5jZSgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3Vt\nZVJlcXVlc3QgYnVpbGQoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgcmVzdWx0\nID0gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0\naWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVk\nTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1\nbWVSZXF1ZXN0IGJ1aWxkUGFyc2VkKCkKICAgICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgcmVzdWx0ID0gYnVpbGRQYXJ0aWFs\nKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAg\nICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlv\nbigKICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgYnVp\nbGRQYXJ0aWFsKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IHJlc3VsdCA9IG5l\ndyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nb25zdW1lUmVxdWVzdCh0aGlzKTsKICAgICAgICBpbnQgZnJvbV9iaXRGaWVs\nZDBfID0gYml0RmllbGQwXzsKICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9\nIDA7CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwMTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnN1YnNj\ncmliZXJJZF8gPSBzdWJzY3JpYmVySWRfOwogICAgICAgIGlmICgoKGZyb21f\nYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAg\nICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAg\nfQogICAgICAgIGlmIChtc2dJZEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAg\nICAgIHJlc3VsdC5tc2dJZF8gPSBtc2dJZF87CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIHJlc3VsdC5tc2dJZF8gPSBtc2dJZEJ1aWxkZXJfLmJ1aWxk\nKCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9f\nYml0RmllbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJu\nIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIg\nbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikg\newogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0KSB7\nCiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdClvdGhl\ncik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJv\nbShvdGhlcik7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25z\ndW1lUmVxdWVzdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1l\nUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAg\nICAgICAgaWYgKG90aGVyLmhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAg\nICBzZXRTdWJzY3JpYmVySWQob3RoZXIuZ2V0U3Vic2NyaWJlcklkKCkpOwog\nICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzTXNnSWQoKSkgewogICAg\nICAgICAgbWVyZ2VNc2dJZChvdGhlci5nZXRNc2dJZCgpKTsKICAgICAgICB9\nCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5r\nbm93bkZpZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXpl\nZCgpIHsKICAgICAgICBpZiAoIWhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAg\nICAgICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAg\nICAgaWYgKCFoYXNNc2dJZCgpKSB7CiAgICAgICAgICAKICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFnZXRNc2dJZCgp\nLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0g\naW5wdXQsCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVs\nZHMgPQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmll\nbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRVbmtub3du\nRmllbGRzKCkpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBp\nbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0\nYWcpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMu\nc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAg\nICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYg\nKCFwYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJl\nZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25v\nd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAg\nICAgIG9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAgICBi\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgICAgICAgc3Vic2Ny\naWJlcklkXyA9IGlucHV0LnJlYWRCeXRlcygpOwogICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMjY6IHsKICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRlciBzdWJCdWlsZGVyID0gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICBpZiAoaGFzTXNn\nSWQoKSkgewogICAgICAgICAgICAgICAgc3ViQnVpbGRlci5tZXJnZUZyb20o\nZ2V0TXNnSWQoKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlu\ncHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVuc2lvblJlZ2lzdHJ5\nKTsKICAgICAgICAgICAgICBzZXRNc2dJZChzdWJCdWlsZGVyLmJ1aWxkUGFy\ndGlhbCgpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHJp\ndmF0ZSBpbnQgYml0RmllbGQwXzsKICAgICAgCiAgICAgIC8vIHJlcXVpcmVk\nIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDI7CiAgICAgIHByaXZhdGUgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHN1YnNjcmliZXJJZF8gPSBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICAgIHB1Ymxp\nYyBib29sZWFuIGhhc1N1YnNjcmliZXJJZCgpIHsKICAgICAgICByZXR1cm4g\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAg\nICAgIH0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZyBnZXRTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgcmV0dXJuIHN1YnNj\ncmliZXJJZF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3Vi\nc2NyaWJlcklkKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1\nZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBu\nZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICB9CiAgYml0RmllbGQwXyB8\nPSAweDAwMDAwMDAxOwogICAgICAgIHN1YnNjcmliZXJJZF8gPSB2YWx1ZTsK\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN1YnNjcmliZXJJZCgp\nIHsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAw\nMDAwMSk7CiAgICAgICAgc3Vic2NyaWJlcklkXyA9IGdldERlZmF1bHRJbnN0\nYW5jZSgpLmdldFN1YnNjcmliZXJJZCgpOwogICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAv\nLyByZXF1aXJlZCAuSGVkd2lnLk1lc3NhZ2VTZXFJZCBtc2dJZCA9IDM7CiAg\nICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZVNlcUlkIG1zZ0lkXyA9IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXRE\nZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZVNlcUlkLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlcj4gbXNn\nSWRCdWlsZGVyXzsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzTXNnSWQoKSB7\nCiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09\nIDB4MDAwMDAwMDIpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQg\nZ2V0TXNnSWQoKSB7CiAgICAgICAgaWYgKG1zZ0lkQnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgcmV0dXJuIG1zZ0lkXzsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmV0dXJuIG1zZ0lkQnVpbGRlcl8uZ2V0TWVzc2FnZSgp\nOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRN\nc2dJZChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQgdmFsdWUpIHsKICAgICAgICBpZiAobXNnSWRCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkg\newogICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24o\nKTsKICAgICAgICAgIH0KICAgICAgICAgIG1zZ0lkXyA9IHZhbHVlOwogICAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nIG1zZ0lkQnVpbGRlcl8uc2V0TWVzc2FnZSh2YWx1ZSk7CiAgICAgICAgfQog\nICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNc2dJ\nZCgKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1\nZSkgewogICAgICAgIGlmIChtc2dJZEJ1aWxkZXJfID09IG51bGwpIHsKICAg\nICAgICAgIG1zZ0lkXyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nIG1zZ0lkQnVpbGRlcl8uc2V0TWVzc2FnZShidWlsZGVyRm9yVmFsdWUuYnVp\nbGQoKSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBtZXJnZU1zZ0lkKG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2YWx1ZSkgewogICAg\nICAgIGlmIChtc2dJZEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGlm\nICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSAm\nJgogICAgICAgICAgICAgIG1zZ0lkXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVs\ndEluc3RhbmNlKCkpIHsKICAgICAgICAgICAgbXNnSWRfID0KICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRlcihtc2dJZF8pLm1lcmdlRnJvbSh2\nYWx1ZSkuYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBtc2dJZF8gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtc2dJ\nZEJ1aWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAg\nIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1zZ0lkKCkg\newogICAgICAgIGlmIChtc2dJZEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAg\nICAgIG1zZ0lkXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsK\nICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICBtc2dJZEJ1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAg\nIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkLkJ1aWxkZXIgZ2V0TXNnSWRCdWlsZGVyKCkgewogICAgICAgIGJpdEZp\nZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICByZXR1cm4gZ2V0TXNnSWRGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVy\nKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlciBn\nZXRNc2dJZE9yQnVpbGRlcigpIHsKICAgICAgICBpZiAobXNnSWRCdWlsZGVy\nXyAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gbXNnSWRCdWlsZGVyXy5n\nZXRNZXNzYWdlT3JCdWlsZGVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHJldHVybiBtc2dJZF87CiAgICAgICAgfQogICAgICB9CiAgICAgIHBy\naXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8\nCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlU2VxSWQsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5CdWlsZGVyLCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWRPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0TXNnSWRGaWVsZEJ1aWxk\nZXIoKSB7CiAgICAgICAgaWYgKG1zZ0lkQnVpbGRlcl8gPT0gbnVsbCkgewog\nICAgICAgICAgbXNnSWRCdWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZC5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXI+KAog\nICAgICAgICAgICAgICAgICBtc2dJZF8sCiAgICAgICAgICAgICAgICAgIGdl\ndFBhcmVudEZvckNoaWxkcmVuKCksCiAgICAgICAgICAgICAgICAgIGlzQ2xl\nYW4oKSk7CiAgICAgICAgICBtc2dJZF8gPSBudWxsOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gbXNnSWRCdWlsZGVyXzsKICAgICAgfQogICAgICAKICAg\nICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6\nSGVkd2lnLkNvbnN1bWVSZXF1ZXN0KQogICAgfQogICAgCiAgICBzdGF0aWMg\newogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgQ29uc3VtZVJlcXVlc3Qo\ndHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAg\nICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFz\nc19zY29wZTpIZWR3aWcuQ29uc3VtZVJlcXVlc3QpCiAgfQogIAogIHB1Ymxp\nYyBpbnRlcmZhY2UgVW5zdWJzY3JpYmVSZXF1ZXN0T3JCdWlsZGVyCiAgICAg\nIGV4dGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVy\nIHsKICAgIAogICAgLy8gcmVxdWlyZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0g\nMjsKICAgIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCk7CiAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklkKCk7CiAg\nfQogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgVW5zdWJzY3JpYmVSZXF1\nZXN0IGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlCiAgICAgIGltcGxlbWVudHMgVW5zdWJzY3JpYmVSZXF1ZXN0\nT3JCdWlsZGVyIHsKICAgIC8vIFVzZSBVbnN1YnNjcmliZVJlcXVlc3QubmV3\nQnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgVW5zdWJzY3Jp\nYmVSZXF1ZXN0KEJ1aWxkZXIgYnVpbGRlcikgewogICAgICBzdXBlcihidWls\nZGVyKTsKICAgIH0KICAgIHByaXZhdGUgVW5zdWJzY3JpYmVSZXF1ZXN0KGJv\nb2xlYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBVbnN1YnNjcmliZVJlcXVlc3QgZGVmYXVsdEluc3RhbmNlOwogICAgcHVi\nbGljIHN0YXRpYyBVbnN1YnNjcmliZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3Rh\nbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQog\nICAgCiAgICBwdWJsaWMgVW5zdWJzY3JpYmVSZXF1ZXN0IGdldERlZmF1bHRJ\nbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFu\nY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19I\nZWR3aWdfVW5zdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICB9CiAg\nICAKICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRl\nZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxH\nZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1Vuc3Vic2NyaWJlUmVxdWVzdF9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87\nCiAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJzY3JpYmVySWQgPSAyOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1VCU0NSSUJFUklEX0ZJRUxEX05V\nTUJFUiA9IDI7CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBzdWJzY3JpYmVySWRfOwogICAgcHVibGljIGJvb2xlYW4gaGFz\nU3Vic2NyaWJlcklkKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1YnNjcmliZXJJ\nZCgpIHsKICAgICAgcmV0dXJuIHN1YnNjcmliZXJJZF87CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICBzdWJzY3Jp\nYmVySWRfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZ\nOwogICAgfQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXpl\nZCA9IC0xOwogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXpl\nZCgpIHsKICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0lu\naXRpYWxpemVkOwogICAgICBpZiAoaXNJbml0aWFsaXplZCAhPSAtMSkgcmV0\ndXJuIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAgCiAgICAgIGlmICghaGFz\nU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6\nZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBt\nZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBv\ndXRwdXQud3JpdGVCeXRlcygyLCBzdWJzY3JpYmVySWRfKTsKICAgICAgfQog\nICAgICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhvdXRwdXQpOwogICAg\nfQogICAgCiAgICBwcml2YXRlIGludCBtZW1vaXplZFNlcmlhbGl6ZWRTaXpl\nID0gLTE7CiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgewog\nICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7CiAgICAg\nIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKICAgIAogICAgICBzaXpl\nID0gMDsKICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09\nIDB4MDAwMDAwMDEpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUJ5\ndGVzU2l6ZSgyLCBzdWJzY3JpYmVySWRfKTsKICAgICAgfQogICAgICBzaXpl\nICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwog\nICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgcmV0\ndXJuIHNpemU7CiAgICB9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOwogICAgQGphdmEubGFuZy5P\ndmVycmlkZQogICAgcHJvdGVjdGVkIGphdmEubGFuZy5PYmplY3Qgd3JpdGVS\nZXBsYWNlKCkKICAgICAgICB0aHJvd3MgamF2YS5pby5PYmplY3RTdHJlYW1F\neGNlcHRpb24gewogICAgICByZXR1cm4gc3VwZXIud3JpdGVSZXBsYWNlKCk7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0\nIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgcGFy\nc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9u\nUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93\ncyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVS\nZXF1ZXN0IHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1\nYnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRh\nLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0\nIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBwYXJzZUZy\nb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJl\nUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVh\nbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAg\naWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJv\nbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigp\nOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBidWlsZGVy\nLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3Jp\nYmVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQs\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3Rh\ndGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3Jl\nYXRlKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBl\nKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGlj\nIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgcHJvdG90eXBl\nKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3Rv\ndHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7\nIHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZhLmxh\nbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJG\nb3JUeXBlKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWlsZGVy\nIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1cm4g\nYnVpbGRlcjsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3Mg\nQnVpbGRlciBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGltcGxl\nbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuVW5zdWJzY3JpYmVSZXF1ZXN0T3JCdWlsZGVyIHsKICAgICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3Jz\nLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAg\nICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfVW5zdWJzY3JpYmVSZXF1\nZXN0X2Rlc2NyaXB0b3I7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3RlY3Rl\nZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRB\nY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNz\nb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19VbnN1YnNjcmliZVJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOwogICAg\nICB9CiAgICAgIAogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVS\nZXF1ZXN0Lm5ld0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7\nCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwog\nICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIEJ1aWxkZXIoQnVpbGRlclBh\ncmVudCBwYXJlbnQpIHsKICAgICAgICBzdXBlcihwYXJlbnQpOwogICAgICAg\nIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQog\nICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXph\ndGlvbigpIHsKICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsKICAgICAg\nICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVh\ndGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAg\nIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgc3Vic2NyaWJlcklkXyA9IGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZy\nb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuVW5zdWJzY3JpYmVSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBnZXREZWZh\ndWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmli\nZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgYnVpbGQoKSB7CiAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nVW5zdWJzY3JpYmVSZXF1ZXN0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwog\nICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAg\nICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVz\ndWx0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAg\nfQogICAgICAKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgYnVpbGRQ\nYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNj\ncmliZVJlcXVlc3QgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAg\naWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJv\ndyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigKICAgICAgICAg\nICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IGJ1aWxkUGFydGlh\nbCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgcmVzdWx0ID0gbmV3IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vi\nc2NyaWJlUmVxdWVzdCh0aGlzKTsKICAgICAgICBpbnQgZnJvbV9iaXRGaWVs\nZDBfID0gYml0RmllbGQwXzsKICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9\nIDA7CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwMTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnN1YnNj\ncmliZXJJZF8gPSBzdWJzY3JpYmVySWRfOwogICAgICAgIHJlc3VsdC5iaXRG\naWVsZDBfID0gdG9fYml0RmllbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAg\nICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVz\nc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vi\nc2NyaWJlUmVxdWVzdCkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgo\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5z\ndWJzY3JpYmVSZXF1ZXN0KW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGlj\nIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBvdGhlcikgewog\nICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QuZ2V0RGVmYXVs\ndEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlmIChvdGhlci5o\nYXNTdWJzY3JpYmVySWQoKSkgewogICAgICAgICAgc2V0U3Vic2NyaWJlcklk\nKG90aGVyLmdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9CiAgICAgICAg\ndGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxk\ncygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAg\nICAgICBpZiAoIWhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAgICAKICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1l\ncmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJ\nbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIg\ndW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAgICB0aGlz\nLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsK\nICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAgICAg\nICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAg\nICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVp\nbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAg\nICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3du\nRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAgICAgIHRo\naXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwog\nICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxODogewogICAg\nICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICAg\nICAgICBzdWJzY3JpYmVySWRfID0gaW5wdXQucmVhZEJ5dGVzKCk7CiAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZp\nZWxkMF87CiAgICAgIAogICAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJzY3Jp\nYmVySWQgPSAyOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYu\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNT\ndWJzY3JpYmVySWQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwogICAgICB9CiAgICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2Ny\naWJlcklkKCkgewogICAgICAgIHJldHVybiBzdWJzY3JpYmVySWRfOwogICAg\nICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1YnNjcmliZXJJZChjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAgICBp\nZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2ludGVy\nRXhjZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsK\nICAgICAgICBzdWJzY3JpYmVySWRfID0gdmFsdWU7CiAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgYml0\nRmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAg\nIHN1YnNjcmliZXJJZF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRTdWJz\nY3JpYmVySWQoKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5z\nZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlVuc3Vic2NyaWJl\nUmVxdWVzdCkKICAgIH0KICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVs\ndEluc3RhbmNlID0gbmV3IFVuc3Vic2NyaWJlUmVxdWVzdCh0cnVlKTsKICAg\nICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgIH0KICAgIAog\nICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkhl\nZHdpZy5VbnN1YnNjcmliZVJlcXVlc3QpCiAgfQogIAogIHB1YmxpYyBpbnRl\ncmZhY2UgQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0T3JCdWlsZGVyCiAgICAg\nIGV4dGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVy\nIHsKICAgIAogICAgLy8gcmVxdWlyZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0g\nMjsKICAgIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCk7CiAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklkKCk7CiAg\nfQogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQ2xvc2VTdWJzY3JpcHRp\nb25SZXF1ZXN0IGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlCiAgICAgIGltcGxlbWVudHMgQ2xvc2VTdWJzY3Jp\ncHRpb25SZXF1ZXN0T3JCdWlsZGVyIHsKICAgIC8vIFVzZSBDbG9zZVN1YnNj\ncmlwdGlvblJlcXVlc3QubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAg\nIHByaXZhdGUgQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0KEJ1aWxkZXIgYnVp\nbGRlcikgewogICAgICBzdXBlcihidWlsZGVyKTsKICAgIH0KICAgIHByaXZh\ndGUgQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0KGJvb2xlYW4gbm9Jbml0KSB7\nfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDbG9zZVN1YnNjcmlw\ndGlvblJlcXVlc3QgZGVmYXVsdEluc3RhbmNlOwogICAgcHVibGljIHN0YXRp\nYyBDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNl\nKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0IGdldERlZmF1\nbHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5z\ndGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29t\nLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAg\nICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRp\nY19IZWR3aWdfQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0X2Rlc2NyaXB0b3I7\nCiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAg\naW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0Nsb3NlU3Vic2NyaXB0aW9uUmVxdWVz\ndF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\naW50IGJpdEZpZWxkMF87CiAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJzY3Jp\nYmVySWQgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1VCU0NS\nSUJFUklEX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRlIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBzdWJzY3JpYmVySWRfOwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCkgewogICAgICByZXR1cm4g\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAg\nICB9CiAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIGdldFN1YnNjcmliZXJJZCgpIHsKICAgICAgcmV0dXJuIHN1YnNjcmliZXJJ\nZF87CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkg\newogICAgICBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nLkVNUFRZOwogICAgfQogICAgcHJpdmF0ZSBieXRlIG1lbW9p\nemVkSXNJbml0aWFsaXplZCA9IC0xOwogICAgcHVibGljIGZpbmFsIGJvb2xl\nYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgYnl0ZSBpc0luaXRpYWxpemVk\nID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOwogICAgICBpZiAoaXNJbml0aWFs\naXplZCAhPSAtMSkgcmV0dXJuIGlzSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAg\nCiAgICAgIGlmICghaGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICBtZW1v\naXplZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgfQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAg\nICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3Jp\ndGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91\ndHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAg\nICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAw\nMSkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBzdWJzY3JpYmVy\nSWRfKTsKICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVU\nbyhvdXRwdXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBtZW1vaXpl\nZFNlcmlhbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdldFNlcmlh\nbGl6ZWRTaXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFs\naXplZFNpemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsK\nICAgIAogICAgICBzaXplID0gMDsKICAgICAgaWYgKCgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgc2l6ZSAr\nPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAg\nICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgyLCBzdWJzY3JpYmVySWRfKTsKICAg\nICAgfQogICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJp\nYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0g\nc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICAKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOwog\nICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIGphdmEubGFu\nZy5PYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5PYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICByZXR1cm4gc3VwZXIu\nd3JpdGVSZXBsYWNlKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xv\nc2VTdWJzY3JpcHRpb25SZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAgICB0aHJv\nd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJF\neGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0IHBhcnNl\nRnJvbShieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlv\nblJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0\nIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCBw\nYXJzZUZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNsb3Nl\nU3Vic2NyaXB0aW9uUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5p\nby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxk\nZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlu\ncHV0KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7\nCiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0K\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0\nIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWls\nZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURl\nbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0IHBhcnNlRnJvbSgK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0g\naW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3Jp\ncHRpb25SZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNl\nZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3\nQnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1\nYmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3\nQnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVp\nbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QgcHJvdG90eXBlKSB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAg\nICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBu\nZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5C\ndWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRlcjsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBl\neHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRN\nZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VT\ndWJzY3JpcHRpb25SZXF1ZXN0T3JCdWlsZGVyIHsKICAgICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRl\nc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgICAg\ncmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfQ2xvc2VTdWJzY3JpcHRpb25S\nZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3Rl\nY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmll\nbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNj\nZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RfZmllbGRBY2Nlc3NvclRh\nYmxlOwogICAgICB9CiAgICAgIAogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xv\nc2VTdWJzY3JpcHRpb25SZXF1ZXN0Lm5ld0J1aWxkZXIoKQogICAgICBwcml2\nYXRlIEJ1aWxkZXIoKSB7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0\naWFsaXphdGlvbigpOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIEJ1\naWxkZXIoQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgICBzdXBlcihw\nYXJlbnQpOwogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRp\nb24oKTsKICAgICAgfQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1\naWxkZXJJbml0aWFsaXphdGlvbigpIHsKICAgICAgICBpZiAoY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLmFsd2F5c1VzZUZpZWxkQnVp\nbGRlcnMpIHsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0\naWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWls\nZGVyKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgc3Vic2Ny\naWJlcklkXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBU\nWTsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAw\nMDAwMSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBj\ncmVhdGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlw\ndG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlw\nZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0Lmdl\ndERlc2NyaXB0b3IoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNsb3Nl\nU3Vic2NyaXB0aW9uUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBl\nKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QgYnVpbGQoKSB7CiAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VT\ndWJzY3JpcHRpb25SZXF1ZXN0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwog\nICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAg\nICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVz\ndWx0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAg\nfQogICAgICAKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3Qg\nYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nbG9zZVN1YnNjcmlwdGlvblJlcXVlc3QgcmVzdWx0ID0gYnVpbGRQYXJ0aWFs\nKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAg\nICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlv\nbigKICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25S\nZXF1ZXN0IGJ1aWxkUGFydGlhbCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlv\nblJlcXVlc3QgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCh0\naGlzKTsKICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQw\nXzsKICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9IDA7CiAgICAgICAgaWYg\nKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAw\nMSkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsK\nICAgICAgICB9CiAgICAgICAgcmVzdWx0LnN1YnNjcmliZXJJZF8gPSBzdWJz\nY3JpYmVySWRfOwogICAgICAgIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0\nRmllbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVy\nZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewog\nICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVx\ndWVzdCkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3Jp\ncHRpb25SZXF1ZXN0KW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCBvdGhlcikg\newogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3Qu\nZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlm\nIChvdGhlci5oYXNTdWJzY3JpYmVySWQoKSkgewogICAgICAgICAgc2V0U3Vi\nc2NyaWJlcklkKG90aGVyLmdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9\nCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5r\nbm93bkZpZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXpl\nZCgpIHsKICAgICAgICBpZiAoIWhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAg\nICAgICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0\nLkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAg\nICAgICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUg\nKHRydWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7\nCiAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6\nCiAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25G\naWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6\nIHsKICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0\nLCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAg\nICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1\naWxkKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAx\nODogewogICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsK\nICAgICAgICAgICAgICBzdWJzY3JpYmVySWRfID0gaW5wdXQucmVhZEJ5dGVz\nKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUg\naW50IGJpdEZpZWxkMF87CiAgICAgIAogICAgICAvLyByZXF1aXJlZCBieXRl\ncyBzdWJzY3JpYmVySWQgPSAyOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBzdWJzY3JpYmVySWRfID0gY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwogICAgICB9\nCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nZ2V0U3Vic2NyaWJlcklkKCkgewogICAgICAgIHJldHVybiBzdWJzY3JpYmVy\nSWRfOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1YnNjcmli\nZXJJZChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsK\nICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51\nbGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAwMTsKICAgICAgICBzdWJzY3JpYmVySWRfID0gdmFsdWU7CiAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVySWQoKSB7CiAg\nICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEp\nOwogICAgICAgIHN1YnNjcmliZXJJZF8gPSBnZXREZWZhdWx0SW5zdGFuY2Uo\nKS5nZXRTdWJzY3JpYmVySWQoKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBw\ncm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLkNs\nb3NlU3Vic2NyaXB0aW9uUmVxdWVzdCkKICAgIH0KICAgIAogICAgc3RhdGlj\nIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IENsb3NlU3Vic2NyaXB0\naW9uUmVxdWVzdCh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRG\naWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9u\nX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5DbG9zZVN1YnNjcmlwdGlvblJl\ncXVlc3QpCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2UgU3RvcERlbGl2ZXJ5\nUmVxdWVzdE9yQnVpbGRlcgogICAgICBleHRlbmRzIGNvbS5nb29nbGUucHJv\ndG9idWYuTWVzc2FnZU9yQnVpbGRlciB7CiAgICAKICAgIC8vIHJlcXVpcmVk\nIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDI7CiAgICBib29sZWFuIGhhc1N1YnNj\ncmliZXJJZCgpOwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIGdldFN1YnNjcmliZXJJZCgpOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGNsYXNzIFN0b3BEZWxpdmVyeVJlcXVlc3QgZXh0ZW5kcwogICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVt\nZW50cyBTdG9wRGVsaXZlcnlSZXF1ZXN0T3JCdWlsZGVyIHsKICAgIC8vIFVz\nZSBTdG9wRGVsaXZlcnlSZXF1ZXN0Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1\nY3QuCiAgICBwcml2YXRlIFN0b3BEZWxpdmVyeVJlcXVlc3QoQnVpbGRlciBi\ndWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwogICAgfQogICAgcHJp\ndmF0ZSBTdG9wRGVsaXZlcnlSZXF1ZXN0KGJvb2xlYW4gbm9Jbml0KSB7fQog\nICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdG9wRGVsaXZlcnlSZXF1\nZXN0IGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgU3RvcERl\nbGl2ZXJ5UmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJl\ndHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBT\ndG9wRGVsaXZlcnlSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUo\nKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigp\nIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2\nZXJ5UmVxdWVzdF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0\nZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3Nv\nclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19T\ndG9wRGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0K\nICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIHJlcXVp\ncmVkIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDI7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBTVUJTQ1JJQkVSSURfRklFTERfTlVNQkVSID0gMjsKICAg\nIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHN1YnNj\ncmliZXJJZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQo\nKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9\nPSAweDAwMDAwMDAxKTsKICAgIH0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklkKCkgewogICAgICBy\nZXR1cm4gc3Vic2NyaWJlcklkXzsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2\nb2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIHN1YnNjcmliZXJJZF8gPSBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICB9CiAgICBw\ncml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7CiAgICBw\ndWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBi\neXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAg\nICAgIGlmIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4gaXNJbml0aWFs\naXplZCA9PSAxOwogICAgICAKICAgICAgaWYgKCFoYXNTdWJzY3JpYmVySWQo\nKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIG1lbW9pemVkSXNJbml0\naWFsaXplZCA9IDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAg\nICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlh\nbGl6ZWRTaXplKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0ZUJ5\ndGVzKDIsIHN1YnNjcmliZXJJZF8pOwogICAgICB9CiAgICAgIGdldFVua25v\nd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1\nYmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXpl\nID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0g\nLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBp\nZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkp\nIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRP\ndXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDIsIHN1\nYnNjcmliZXJJZF8pOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5rbm93\nbkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9pemVk\nU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsKICAg\nIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxW\nZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBw\ncm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAg\nICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2UoKTsKICAgIH0KICAgIAog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkK\nICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJv\ndG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QgcGFy\nc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJl\ncXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAg\nIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZy\nb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAg\nICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVz\ndCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1\ndCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1\naWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAgIHJl\ndHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oCiAg\nICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlv\nbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAg\nICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0LCBleHRl\nbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWls\nZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxs\nOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJl\ncXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAg\nIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGlj\nIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRl\nKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkg\neyByZXR1cm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1\naWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHByb3RvdHlwZSkg\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5\ncGUpOwogICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyBy\nZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5n\nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9y\nVHlwZSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBi\ndWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1\naWxkZXI7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1\naWxkZXIgZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1l\nbnRzIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0b3BEZWxpdmVyeVJlcXVlc3RPckJ1aWxkZXIgewogICAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMu\nRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAg\nICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdG9wRGVsaXZlcnlSZXF1\nZXN0X2Rlc2NyaXB0b3I7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3RlY3Rl\nZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRB\nY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNz\nb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19TdG9wRGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nICAgfQogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVy\neVJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigp\nIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7\nCiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRlcihCdWlsZGVy\nUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVudCk7CiAgICAg\nICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9\nCiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxp\nemF0aW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdl\nbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycykgewogICAg\nICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNy\nZWF0ZSgpIHsKICAgICAgICByZXR1cm4gbmV3IEJ1aWxkZXIoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAg\nICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICBzdWJzY3JpYmVySWRfID0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICAgIGJp\ndEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdl\nRnJvbShidWlsZFBhcnRpYWwoKSk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QgZ2V0\nRGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERl\nbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QgYnVpbGQoKSB7\nCiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCByZXN1bHQgPSBidWlsZFBhcnRp\nYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsK\nICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0\naW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7\nCiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVz\ndCBidWlsZFBhcnNlZCgpCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0b3BEZWxpdmVyeVJlcXVlc3QgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAg\nICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4\nY2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0Owog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBi\ndWlsZFBhcnRpYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCByZXN1\nbHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCh0aGlzKTsKICAgICAgICBpbnQg\nZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsKICAgICAgICBpbnQgdG9f\nYml0RmllbGQwXyA9IDA7CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHRv\nX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICB9CiAgICAgICAg\ncmVzdWx0LnN1YnNjcmliZXJJZF8gPSBzdWJzY3JpYmVySWRfOwogICAgICAg\nIHJlc3VsdC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsKICAgICAgICBv\nbkJ1aWx0KCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUu\ncHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBp\nbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QpIHsKICAgICAgICAgIHJldHVy\nbiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3Qpb3RoZXIpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwog\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVx\ndWVzdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlS\nZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAg\nICAgICBpZiAob3RoZXIuaGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICAg\nIHNldFN1YnNjcmliZXJJZChvdGhlci5nZXRTdWJzY3JpYmVySWQoKSk7CiAg\nICAgICAgfQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVy\nLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5p\ndGlhbGl6ZWQoKSB7CiAgICAgICAgaWYgKCFoYXNTdWJzY3JpYmVySWQoKSkg\newogICAgICAgICAgCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25G\naWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigK\nICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAg\nIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVh\nZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAg\nY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1\nbmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgIG9uQ2hhbmdl\nZCgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICBk\nZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVs\nZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAg\nICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZp\nZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGNhc2UgMTg6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDE7CiAgICAgICAgICAgICAgc3Vic2NyaWJlcklkXyA9IGlucHV0LnJl\nYWRCeXRlcygpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBw\ncml2YXRlIGludCBiaXRGaWVsZDBfOwogICAgICAKICAgICAgLy8gcmVxdWly\nZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0gMjsKICAgICAgcHJpdmF0ZSBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkXyA9IGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgcHVi\nbGljIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCkgewogICAgICAgIHJldHVy\nbiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsK\nICAgICAgfQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGdldFN1YnNjcmliZXJJZCgpIHsKICAgICAgICByZXR1cm4gc3Vi\nc2NyaWJlcklkXzsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRT\ndWJzY3JpYmVySWQoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZh\nbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93\nIG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICBiaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgc3Vic2NyaWJlcklkXyA9IHZhbHVl\nOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3Vic2NyaWJlcklk\nKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAw\nMDAwMDAxKTsKICAgICAgICBzdWJzY3JpYmVySWRfID0gZ2V0RGVmYXVsdElu\nc3RhbmNlKCkuZ2V0U3Vic2NyaWJlcklkKCk7CiAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAg\nIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOkhl\nZHdpZy5TdG9wRGVsaXZlcnlSZXF1ZXN0KQogICAgfQogICAgCiAgICBzdGF0\naWMgewogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgU3RvcERlbGl2ZXJ5\nUmVxdWVzdCh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVs\nZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3Bv\naW50KGNsYXNzX3Njb3BlOkhlZHdpZy5TdG9wRGVsaXZlcnlSZXF1ZXN0KQog\nIH0KICAKICBwdWJsaWMgaW50ZXJmYWNlIFN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nT3JCdWlsZGVyCiAgICAgIGV4dGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5N\nZXNzYWdlT3JCdWlsZGVyIHsKICAgIAogICAgLy8gcmVxdWlyZWQgYnl0ZXMg\nc3Vic2NyaWJlcklkID0gMjsKICAgIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklk\nKCk7CiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vi\nc2NyaWJlcklkKCk7CiAgfQogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3Mg\nU3RhcnREZWxpdmVyeVJlcXVlc3QgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVtZW50cyBT\ndGFydERlbGl2ZXJ5UmVxdWVzdE9yQnVpbGRlciB7CiAgICAvLyBVc2UgU3Rh\ncnREZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4K\nICAgIHByaXZhdGUgU3RhcnREZWxpdmVyeVJlcXVlc3QoQnVpbGRlciBidWls\nZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwogICAgfQogICAgcHJpdmF0\nZSBTdGFydERlbGl2ZXJ5UmVxdWVzdChib29sZWFuIG5vSW5pdCkge30KICAg\nIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RhcnREZWxpdmVyeVJlcXVl\nc3QgZGVmYXVsdEluc3RhbmNlOwogICAgcHVibGljIHN0YXRpYyBTdGFydERl\nbGl2ZXJ5UmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJl\ndHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBT\ndGFydERlbGl2ZXJ5UmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBl\nKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYu\nRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgIGdldERlc2NyaXB0b3Io\nKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N0YXJ0RGVs\naXZlcnlSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICB9CiAgICAKICAgIHByb3Rl\nY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmll\nbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vz\nc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1N0YXJ0RGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIHJl\ncXVpcmVkIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDI7CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBTVUJTQ1JJQkVSSURfRklFTERfTlVNQkVSID0gMjsK\nICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHN1\nYnNjcmliZXJJZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVy\nSWQoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAx\nKSA9PSAweDAwMDAwMDAxKTsKICAgIH0KICAgIHB1YmxpYyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklkKCkgewogICAg\nICByZXR1cm4gc3Vic2NyaWJlcklkXzsKICAgIH0KICAgIAogICAgcHJpdmF0\nZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIHN1YnNjcmliZXJJZF8gPSBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICB9CiAg\nICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7CiAg\nICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAg\nICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7\nCiAgICAgIGlmIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4gaXNJbml0\naWFsaXplZCA9PSAxOwogICAgICAKICAgICAgaWYgKCFoYXNTdWJzY3JpYmVy\nSWQoKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIG1lbW9pemVkSXNJ\nbml0aWFsaXplZCA9IDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNl\ncmlhbGl6ZWRTaXplKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0\nZUJ5dGVzKDIsIHN1YnNjcmliZXJJZF8pOwogICAgICB9CiAgICAgIGdldFVu\na25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAg\nIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAg\nIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBz\naXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUg\nIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAg\nICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAw\nMSkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDIs\nIHN1YnNjcmliZXJJZF8pOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5r\nbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9p\nemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsK\nICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJp\nYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAg\nICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0ZVJlcGxhY2UoKQog\nICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2UoKTsKICAgIH0KICAg\nIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZy\nb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRh\ndGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxp\nZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgcGFyc2VGcm9t\nKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRh\nLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVl\nc3QgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEp\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBieXRlW10gZGF0YSwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdv\nb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24g\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHBhcnNl\nRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAu\nYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxp\ndmVyeVJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAg\nICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkpIHsK\nICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9\nIGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHBhcnNlRGVsaW1p\ndGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlM\naXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVp\nbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20o\naW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBi\ndWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rh\ncnREZWxpdmVyeVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZy\nb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIAogICAg\ncHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7IHJldHVybiBC\ndWlsZGVyLmNyZWF0ZSgpOyB9CiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWls\nZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQogICAgcHVi\nbGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVl\nc3QgcHJvdG90eXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0\nb0J1aWxkZXIoKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAK\nICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBCdWlsZGVy\nIG5ld0J1aWxkZXJGb3JUeXBlKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBhcmVudCkgewog\nICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOwog\nICAgICByZXR1cm4gYnVpbGRlcjsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4K\nICAgICAgIGltcGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3RPckJ1aWxkZXIg\newogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9i\ndWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3Jp\ncHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19T\ndGFydERlbGl2ZXJ5UmVxdWVzdF9kZXNjcmlwdG9yOwogICAgICB9CiAgICAg\nIAogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgICAgaW50ZXJu\nYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVy\nbmFsX3N0YXRpY19IZWR3aWdfU3RhcnREZWxpdmVyeVJlcXVlc3RfZmllbGRB\nY2Nlc3NvclRhYmxlOwogICAgICB9CiAgICAgIAogICAgICAvLyBDb25zdHJ1\nY3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAg\nIHByaXZhdGUgQnVpbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRl\nckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZh\ndGUgQnVpbGRlcihCdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1\ncGVyKHBhcmVudCk7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFs\naXphdGlvbigpOwogICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZv\ncmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmll\nbGRCdWlsZGVycykgewogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRl\nIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICByZXR1cm4gbmV3\nIEJ1aWxkZXIoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgY2xlYXIoKSB7CiAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICBz\ndWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nLkVNUFRZOwogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDAxKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0\ndXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShidWlsZFBhcnRpYWwoKSk7CiAgICAg\nIH0KICAgICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JG\nb3JUeXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5n\nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFy\ndERlbGl2ZXJ5UmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkg\newogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0\nSW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0IGJ1aWxkKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1\nZXN0IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICghcmVz\ndWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5p\nbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAg\ncHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBidWlsZFBhcnNlZCgpCiAgICAg\nICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0\nLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0\naWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJlc3VsdCku\nYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IGJ1aWxkUGFydGlhbCgpIHsKICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCByZXN1bHQgPSBuZXcgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVy\neVJlcXVlc3QodGhpcyk7CiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9\nIGJpdEZpZWxkMF87CiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOwog\nICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09\nIDB4MDAwMDAwMDEpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDE7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5zdWJzY3JpYmVy\nSWRfID0gc3Vic2NyaWJlcklkXzsKICAgICAgICByZXN1bHQuYml0RmllbGQw\nXyA9IHRvX2JpdEZpZWxkMF87CiAgICAgICAgb25CdWlsdCgpOwogICAgICAg\nIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ug\nb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2\nZXJ5UmVxdWVzdCkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnRE\nZWxpdmVyeVJlcXVlc3Qpb3RoZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3Qgb3RoZXIpIHsK\nICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QuZ2V0RGVm\nYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlmIChvdGhl\nci5oYXNTdWJzY3JpYmVySWQoKSkgewogICAgICAgICAgc2V0U3Vic2NyaWJl\ncklkKG90aGVyLmdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9CiAgICAg\nICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZp\nZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsK\nICAgICAgICBpZiAoIWhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAgICAK\nICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxk\nZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAgICB0\naGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRydWUp\nIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAg\nICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAgICAg\nICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMu\nYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAg\nICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1bmtu\nb3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAgICAg\nIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkp\nOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxODogewog\nICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAg\nICAgICAgICBzdWJzY3JpYmVySWRfID0gaW5wdXQucmVhZEJ5dGVzKCk7CiAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IGJp\ndEZpZWxkMF87CiAgICAgIAogICAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJz\nY3JpYmVySWQgPSAyOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwogICAgICB9CiAgICAg\nIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vi\nc2NyaWJlcklkKCkgewogICAgICAgIHJldHVybiBzdWJzY3JpYmVySWRfOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1YnNjcmliZXJJZChj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAg\nICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2lu\ndGVyRXhjZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAw\nMTsKICAgICAgICBzdWJzY3JpYmVySWRfID0gdmFsdWU7CiAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVySWQoKSB7CiAgICAgICAg\nYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAg\nICAgIHN1YnNjcmliZXJJZF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRT\ndWJzY3JpYmVySWQoKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBwcm90b2Nf\naW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0KQogICAgfQogICAgCiAgICBzdGF0aWMgewogICAgICBk\nZWZhdWx0SW5zdGFuY2UgPSBuZXcgU3RhcnREZWxpdmVyeVJlcXVlc3QodHJ1\nZSk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAgICB9\nCiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19z\nY29wZTpIZWR3aWcuU3RhcnREZWxpdmVyeVJlcXVlc3QpCiAgfQogIAogIHB1\nYmxpYyBpbnRlcmZhY2UgU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZU9yQnVp\nbGRlcgogICAgICBleHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2Fn\nZU9yQnVpbGRlciB7CiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vi\nc2NyaXB0aW9uRXZlbnQgZXZlbnQgPSAxOwogICAgYm9vbGVhbiBoYXNFdmVu\ndCgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uRXZlbnQgZ2V0RXZlbnQoKTsKICB9CiAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBjbGFzcyBTdWJzY3JpcHRpb25FdmVudFJlc3Bv\nbnNlIGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlCiAgICAgIGltcGxlbWVudHMgU3Vic2NyaXB0aW9uRXZlbnRS\nZXNwb25zZU9yQnVpbGRlciB7CiAgICAvLyBVc2UgU3Vic2NyaXB0aW9uRXZl\nbnRSZXNwb25zZS5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJp\ndmF0ZSBTdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlKEJ1aWxkZXIgYnVpbGRl\ncikgewogICAgICBzdXBlcihidWlsZGVyKTsKICAgIH0KICAgIHByaXZhdGUg\nU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZShib29sZWFuIG5vSW5pdCkge30K\nICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3Vic2NyaXB0aW9uRXZl\nbnRSZXNwb25zZSBkZWZhdWx0SW5zdGFuY2U7CiAgICBwdWJsaWMgc3RhdGlj\nIFN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNl\nKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZSBnZXREZWZh\ndWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdElu\nc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1N1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2VfZGVzY3JpcHRv\ncjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAg\nICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgcmV0\ndXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uRXZlbnRSZXNw\nb25zZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAgICAKICAgIHByaXZh\ndGUgaW50IGJpdEZpZWxkMF87CiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1\nYnNjcmlwdGlvbkV2ZW50IGV2ZW50ID0gMTsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IEVWRU5UX0ZJRUxEX05VTUJFUiA9IDE7CiAgICBwcml2YXRl\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvbkV2ZW50IGV2ZW50XzsKICAgIHB1YmxpYyBib29sZWFuIGhh\nc0V2ZW50KCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uRXZlbnQgZ2V0RXZlbnQoKSB7CiAgICAgIHJldHVybiBldmVudF87CiAg\nICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAg\nICBldmVudF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25FdmVudC5UT1BJQ19NT1ZFRDsKICAgIH0K\nICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsK\nICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAg\nICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXpl\nZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgIT0gLTEpIHJldHVybiBpc0lu\naXRpYWxpemVkID09IDE7CiAgICAgIAogICAgICBtZW1vaXplZElzSW5pdGlh\nbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAg\ncHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBnZXRTZXJpYWxp\nemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBvdXRwdXQud3JpdGVFbnVt\nKDEsIGV2ZW50Xy5nZXROdW1iZXIoKSk7CiAgICAgIH0KICAgICAgZ2V0VW5r\nbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAg\ncHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAg\ncHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNp\nemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAh\nPSAtMSkgcmV0dXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAg\nIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAx\nKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVFbnVtU2l6ZSgxLCBl\ndmVudF8uZ2V0TnVtYmVyKCkpOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0\nVW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1l\nbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6\nZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBz\nZXJpYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5nLk92ZXJyaWRl\nCiAgICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0ZVJlcGxhY2Uo\nKQogICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2UoKTsKICAgIH0K\nICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNl\nIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3Bv\nbnNlIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvbkV2ZW50UmVzcG9uc2UgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UgcGFyc2VGcm9t\nKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZSBwYXJzZUZyb20oamF2YS5p\nby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlIHBhcnNlRnJvbSgKICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQo\nKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNw\nb25zZSBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBp\nbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYg\nKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAg\nIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7\nCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZSBwYXJzZURlbGltaXRl\nZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxk\nZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlu\ncHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1cm4gYnVp\nbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJl\ndHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvbkV2ZW50UmVzcG9uc2UgcGFyc2VGcm9tKAogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNl\nIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsg\ncmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVy\nIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9\nCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25FdmVudFJlc3BvbnNlIHByb3RvdHlwZSkgewogICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAgfQogICAgcHVi\nbGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4gbmV3QnVpbGRlcih0\naGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90\nZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlclBhcmVu\ndCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxk\nZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWls\nZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1lbnRzIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50\nUmVzcG9uc2VPckJ1aWxkZXIgewogICAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgog\nICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlX2Rl\nc2NyaXB0b3I7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3RlY3RlZCBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3Nv\nclRhYmxlCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJs\nZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJz\nY3JpcHRpb25FdmVudFJlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nICAgfQogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nbkV2ZW50UmVzcG9uc2UubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVp\nbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRlcihC\ndWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVudCk7\nCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwog\nICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlcklu\naXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycykg\newogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIHN0YXRpYyBCdWls\nZGVyIGNyZWF0ZSgpIHsKICAgICAgICByZXR1cm4gbmV3IEJ1aWxkZXIoKTsK\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7\nCiAgICAgICAgc3VwZXIuY2xlYXIoKTsKICAgICAgICBldmVudF8gPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25FdmVudC5UT1BJQ19NT1ZFRDsKICAgICAgICBiaXRGaWVsZDBfID0g\nKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25l\nKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZyb20oYnVpbGRQ\nYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naXB0aW9uRXZlbnRSZXNwb25zZS5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlIGdl\ndERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvbkV2ZW50UmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3Bv\nbnNlIGJ1aWxkKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2Ug\ncmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQu\naXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRp\nYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwcml2\nYXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UgYnVpbGRQYXJzZWQoKQogICAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJl\nc3BvbnNlIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICgh\ncmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3\nVW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJl\nc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UgYnVpbGRQYXJ0\naWFsKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UgcmVzdWx0\nID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UodGhpcyk7CiAgICAgICAg\naW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87CiAgICAgICAgaW50\nIHRvX2JpdEZpZWxkMF8gPSAwOwogICAgICAgIGlmICgoKGZyb21fYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAg\nICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgfQogICAg\nICAgIHJlc3VsdC5ldmVudF8gPSBldmVudF87CiAgICAgICAgcmVzdWx0LmJp\ndEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQoKTsK\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5N\nZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Yg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uRXZlbnRSZXNwb25zZSkgewogICAgICAgICAgcmV0dXJuIG1l\ncmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZSlvdGhlcik7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7\nCiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25F\ndmVudFJlc3BvbnNlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvbkV2ZW50UmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJl\ndHVybiB0aGlzOwogICAgICAgIGlmIChvdGhlci5oYXNFdmVudCgpKSB7CiAg\nICAgICAgICBzZXRFdmVudChvdGhlci5nZXRFdmVudCgpKTsKICAgICAgICB9\nCiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5r\nbm93bkZpZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXpl\nZCgpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtu\nb3duRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxk\nZXIoCiAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAg\nICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0\nLnJlYWRUYWcoKTsKICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAg\nICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVs\nZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAg\nICAgZGVmYXVsdDogewogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3du\nRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkg\newogICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25v\nd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjYXNlIDg6IHsKICAgICAgICAgICAgICBpbnQgcmF3VmFsdWUgPSBp\nbnB1dC5yZWFkRW51bSgpOwogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50\nIHZhbHVlID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uRXZlbnQudmFsdWVPZihyYXdWYWx1ZSk7CiAg\nICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIHVua25vd25GaWVsZHMubWVyZ2VWYXJpbnRGaWVsZCgxLCByYXdWYWx1\nZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICAgICAgICAgIGV2ZW50\nXyA9IHZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nfQogICAgICAKICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgICAg\nCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2NyaXB0aW9uRXZlbnQg\nZXZlbnQgPSAxOwogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50IGV2ZW50\nXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvbkV2ZW50LlRPUElDX01PVkVEOwogICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNFdmVudCgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50IGdldEV2ZW50KCkgewogICAgICAg\nIHJldHVybiBldmVudF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0RXZlbnQob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uRXZlbnQgdmFsdWUpIHsKICAgICAgICBpZiAo\ndmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2lu\ndGVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8g\nfD0gMHgwMDAwMDAwMTsKICAgICAgICBldmVudF8gPSB2YWx1ZTsKICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckV2ZW50KCkgewogICAgICAgIGJp\ndEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAg\nICBldmVudF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25FdmVudC5UT1BJQ19NT1ZFRDsKICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxk\nZXJfc2NvcGU6SGVkd2lnLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UpCiAg\nICB9CiAgICAKICAgIHN0YXRpYyB7CiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9\nIG5ldyBTdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlKHRydWUpOwogICAgICBk\nZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAgICAv\nLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2ln\nLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UpCiAgfQogIAogIHB1YmxpYyBp\nbnRlcmZhY2UgUHViU3ViUmVzcG9uc2VPckJ1aWxkZXIKICAgICAgZXh0ZW5k\ncyBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgewogICAg\nCiAgICAvLyByZXF1aXJlZCAuSGVkd2lnLlByb3RvY29sVmVyc2lvbiBwcm90\nb2NvbFZlcnNpb24gPSAxOwogICAgYm9vbGVhbiBoYXNQcm90b2NvbFZlcnNp\nb24oKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlByb3RvY29sVmVyc2lvbiBnZXRQcm90b2NvbFZlcnNpb24oKTsK\nICAgIAogICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5TdGF0dXNDb2RlIHN0YXR1\nc0NvZGUgPSAyOwogICAgYm9vbGVhbiBoYXNTdGF0dXNDb2RlKCk7CiAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGF0\ndXNDb2RlIGdldFN0YXR1c0NvZGUoKTsKICAgIAogICAgLy8gcmVxdWlyZWQg\ndWludDY0IHR4bklkID0gMzsKICAgIGJvb2xlYW4gaGFzVHhuSWQoKTsKICAg\nIGxvbmcgZ2V0VHhuSWQoKTsKICAgIAogICAgLy8gb3B0aW9uYWwgc3RyaW5n\nIHN0YXR1c01zZyA9IDQ7CiAgICBib29sZWFuIGhhc1N0YXR1c01zZygpOwog\nICAgU3RyaW5nIGdldFN0YXR1c01zZygpOwogICAgCiAgICAvLyBvcHRpb25h\nbCAuSGVkd2lnLk1lc3NhZ2UgbWVzc2FnZSA9IDU7CiAgICBib29sZWFuIGhh\nc01lc3NhZ2UoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2UgZ2V0TWVzc2FnZSgpOwogICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZU9y\nQnVpbGRlciBnZXRNZXNzYWdlT3JCdWlsZGVyKCk7CiAgICAKICAgIC8vIG9w\ndGlvbmFsIGJ5dGVzIHRvcGljID0gNjsKICAgIGJvb2xlYW4gaGFzVG9waWMo\nKTsKICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRUb3Bp\nYygpOwogICAgCiAgICAvLyBvcHRpb25hbCBieXRlcyBzdWJzY3JpYmVySWQg\nPSA3OwogICAgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQoKTsKICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTdWJzY3JpYmVySWQoKTsK\nICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5SZXNwb25zZUJvZHkgcmVz\ncG9uc2VCb2R5ID0gODsKICAgIGJvb2xlYW4gaGFzUmVzcG9uc2VCb2R5KCk7\nCiAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5SZXNwb25zZUJvZHkgZ2V0UmVzcG9uc2VCb2R5KCk7CiAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJv\nZHlPckJ1aWxkZXIgZ2V0UmVzcG9uc2VCb2R5T3JCdWlsZGVyKCk7CiAgfQog\nIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgUHViU3ViUmVzcG9uc2UgZXh0\nZW5kcwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UKICAgICAgaW1wbGVtZW50cyBQdWJTdWJSZXNwb25zZU9yQnVpbGRlciB7\nCiAgICAvLyBVc2UgUHViU3ViUmVzcG9uc2UubmV3QnVpbGRlcigpIHRvIGNv\nbnN0cnVjdC4KICAgIHByaXZhdGUgUHViU3ViUmVzcG9uc2UoQnVpbGRlciBi\ndWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwogICAgfQogICAgcHJp\ndmF0ZSBQdWJTdWJSZXNwb25zZShib29sZWFuIG5vSW5pdCkge30KICAgIAog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgUHViU3ViUmVzcG9uc2UgZGVmYXVs\ndEluc3RhbmNlOwogICAgcHVibGljIHN0YXRpYyBQdWJTdWJSZXNwb25zZSBn\nZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5z\ndGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBQdWJTdWJSZXNwb25zZSBn\nZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVm\nYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRv\ncgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlc3BvbnNlX2Rlc2NyaXB0b3I7CiAg\nICB9CiAgICAKICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdl\nbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50\nZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlc3BvbnNlX2ZpZWxkQWNjZXNz\nb3JUYWJsZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQw\nXzsKICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcuUHJvdG9jb2xWZXJzaW9uIHBy\nb3RvY29sVmVyc2lvbiA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGlu\ndCBQUk9UT0NPTFZFUlNJT05fRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZh\ndGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHJvdG9jb2xWZXJzaW9uIHByb3RvY29sVmVyc2lvbl87CiAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNQcm90b2NvbFZlcnNpb24oKSB7CiAgICAgIHJldHVybiAo\nKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAg\nIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24gZ2V0UHJvdG9jb2xWZXJzaW9u\nKCkgewogICAgICByZXR1cm4gcHJvdG9jb2xWZXJzaW9uXzsKICAgIH0KICAg\nIAogICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5TdGF0dXNDb2RlIHN0YXR1c0Nv\nZGUgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTQ09E\nRV9GSUVMRF9OVU1CRVIgPSAyOwogICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGF0dXNDb2RlIHN0YXR1\nc0NvZGVfOwogICAgcHVibGljIGJvb2xlYW4gaGFzU3RhdHVzQ29kZSgpIHsK\nICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4\nMDAwMDAwMDIpOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXR1c0NvZGUgZ2V0U3RhdHVz\nQ29kZSgpIHsKICAgICAgcmV0dXJuIHN0YXR1c0NvZGVfOwogICAgfQogICAg\nCiAgICAvLyByZXF1aXJlZCB1aW50NjQgdHhuSWQgPSAzOwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgVFhOSURfRklFTERfTlVNQkVSID0gMzsKICAg\nIHByaXZhdGUgbG9uZyB0eG5JZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNU\neG5JZCgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDQpID09IDB4MDAwMDAwMDQpOwogICAgfQogICAgcHVibGljIGxvbmcgZ2V0\nVHhuSWQoKSB7CiAgICAgIHJldHVybiB0eG5JZF87CiAgICB9CiAgICAKICAg\nIC8vIG9wdGlvbmFsIHN0cmluZyBzdGF0dXNNc2cgPSA0OwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTTVNHX0ZJRUxEX05VTUJFUiA9IDQ7\nCiAgICBwcml2YXRlIGphdmEubGFuZy5PYmplY3Qgc3RhdHVzTXNnXzsKICAg\nIHB1YmxpYyBib29sZWFuIGhhc1N0YXR1c01zZygpIHsKICAgICAgcmV0dXJu\nICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDgpID09IDB4MDAwMDAwMDgpOwog\nICAgfQogICAgcHVibGljIFN0cmluZyBnZXRTdGF0dXNNc2coKSB7CiAgICAg\nIGphdmEubGFuZy5PYmplY3QgcmVmID0gc3RhdHVzTXNnXzsKICAgICAgaWYg\nKHJlZiBpbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIHJldHVybiAoU3Ry\naW5nKSByZWY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIGJzID0gCiAgICAgICAgICAgIChjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgICBTdHJpbmcg\ncyA9IGJzLnRvU3RyaW5nVXRmOCgpOwogICAgICAgIGlmIChjb20uZ29vZ2xl\nLnByb3RvYnVmLkludGVybmFsLmlzVmFsaWRVdGY4KGJzKSkgewogICAgICAg\nICAgc3RhdHVzTXNnXyA9IHM7CiAgICAgICAgfQogICAgICAgIHJldHVybiBz\nOwogICAgICB9CiAgICB9CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBnZXRTdGF0dXNNc2dCeXRlcygpIHsKICAgICAgamF2\nYS5sYW5nLk9iamVjdCByZWYgPSBzdGF0dXNNc2dfOwogICAgICBpZiAocmVm\nIGluc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIGIgPSAKICAgICAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgoU3RyaW5nKSByZWYp\nOwogICAgICAgIHN0YXR1c01zZ18gPSBiOwogICAgICAgIHJldHVybiBiOwog\nICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiAoY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nKSByZWY7CiAgICAgIH0KICAgIH0KICAgIAogICAg\nLy8gb3B0aW9uYWwgLkhlZHdpZy5NZXNzYWdlIG1lc3NhZ2UgPSA1OwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUVTU0FHRV9GSUVMRF9OVU1CRVIg\nPSA1OwogICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlIG1lc3NhZ2VfOwogICAgcHVibGljIGJv\nb2xlYW4gaGFzTWVzc2FnZSgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMTApID09IDB4MDAwMDAwMTApOwogICAgfQogICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgZ2V0TWVzc2FnZSgpIHsKICAgICAgcmV0dXJuIG1lc3NhZ2Vf\nOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VPckJ1aWxkZXIgZ2V0TWVzc2FnZU9y\nQnVpbGRlcigpIHsKICAgICAgcmV0dXJuIG1lc3NhZ2VfOwogICAgfQogICAg\nCiAgICAvLyBvcHRpb25hbCBieXRlcyB0b3BpYyA9IDY7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBUT1BJQ19GSUVMRF9OVU1CRVIgPSA2OwogICAg\ncHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdG9waWNf\nOwogICAgcHVibGljIGJvb2xlYW4gaGFzVG9waWMoKSB7CiAgICAgIHJldHVy\nbiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDIwKSA9PSAweDAwMDAwMDIwKTsK\nICAgIH0KICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmcgZ2V0VG9waWMoKSB7CiAgICAgIHJldHVybiB0b3BpY187CiAgICB9CiAg\nICAKICAgIC8vIG9wdGlvbmFsIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDc7CiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVUJTQ1JJQkVSSURfRklFTERf\nTlVNQkVSID0gNzsKICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nIHN1YnNjcmliZXJJZF87CiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNTdWJzY3JpYmVySWQoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDQwKSA9PSAweDAwMDAwMDQwKTsKICAgIH0KICAgIHB1Ymxp\nYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJl\ncklkKCkgewogICAgICByZXR1cm4gc3Vic2NyaWJlcklkXzsKICAgIH0KICAg\nIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5SZXNwb25zZUJvZHkgcmVzcG9u\nc2VCb2R5ID0gODsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFJFU1BP\nTlNFQk9EWV9GSUVMRF9OVU1CRVIgPSA4OwogICAgcHJpdmF0ZSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJv\nZHkgcmVzcG9uc2VCb2R5XzsKICAgIHB1YmxpYyBib29sZWFuIGhhc1Jlc3Bv\nbnNlQm9keSgpIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAw\nMDAwODApID09IDB4MDAwMDAwODApOwogICAgfQogICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNl\nQm9keSBnZXRSZXNwb25zZUJvZHkoKSB7CiAgICAgIHJldHVybiByZXNwb25z\nZUJvZHlfOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keU9yQnVpbGRlciBn\nZXRSZXNwb25zZUJvZHlPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiByZXNw\nb25zZUJvZHlfOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgaW5pdEZp\nZWxkcygpIHsKICAgICAgcHJvdG9jb2xWZXJzaW9uXyA9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lv\nbi5WRVJTSU9OX09ORTsKICAgICAgc3RhdHVzQ29kZV8gPSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGF0dXNDb2RlLlNV\nQ0NFU1M7CiAgICAgIHR4bklkXyA9IDBMOwogICAgICBzdGF0dXNNc2dfID0g\nIiI7CiAgICAgIG1lc3NhZ2VfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgdG9waWNfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nLkVNUFRZOwogICAgICBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICByZXNwb25zZUJvZHlf\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUmVzcG9uc2VCb2R5LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgfQogICAg\ncHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0xOwogICAg\ncHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAg\nYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxpemVkOwog\nICAgICBpZiAoaXNJbml0aWFsaXplZCAhPSAtMSkgcmV0dXJuIGlzSW5pdGlh\nbGl6ZWQgPT0gMTsKICAgICAgCiAgICAgIGlmICghaGFzUHJvdG9jb2xWZXJz\naW9uKCkpIHsKICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAwOwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoIWhhc1N0\nYXR1c0NvZGUoKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9\nIDA7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICgh\naGFzVHhuSWQoKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9\nIDA7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmICho\nYXNNZXNzYWdlKCkpIHsKICAgICAgICBpZiAoIWdldE1lc3NhZ2UoKS5pc0lu\naXRpYWxpemVkKCkpIHsKICAgICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXpl\nZCA9IDA7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAg\nICB9CiAgICAgIGlmIChoYXNSZXNwb25zZUJvZHkoKSkgewogICAgICAgIGlm\nICghZ2V0UmVzcG9uc2VCb2R5KCkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAg\nICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgICBtZW1vaXplZElz\nSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAg\nIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVm\nLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBnZXRT\nZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBvdXRwdXQud3Jp\ndGVFbnVtKDEsIHByb3RvY29sVmVyc2lvbl8uZ2V0TnVtYmVyKCkpOwogICAg\nICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAw\neDAwMDAwMDAyKSkgewogICAgICAgIG91dHB1dC53cml0ZUVudW0oMiwgc3Rh\ndHVzQ29kZV8uZ2V0TnVtYmVyKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAwMDA0KSkgewogICAg\nICAgIG91dHB1dC53cml0ZVVJbnQ2NCgzLCB0eG5JZF8pOwogICAgICB9CiAg\nICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAwMDAw\nMDA4KSkgewogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDQsIGdldFN0YXR1\nc01zZ0J5dGVzKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDEwKSA9PSAweDAwMDAwMDEwKSkgewogICAgICAgIG91dHB1\ndC53cml0ZU1lc3NhZ2UoNSwgbWVzc2FnZV8pOwogICAgICB9CiAgICAgIGlm\nICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDIwKSA9PSAweDAwMDAwMDIwKSkg\newogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDYsIHRvcGljXyk7CiAgICAg\nIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwNDApID09IDB4\nMDAwMDAwNDApKSB7CiAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoNywgc3Vi\nc2NyaWJlcklkXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAm\nIDB4MDAwMDAwODApID09IDB4MDAwMDAwODApKSB7CiAgICAgICAgb3V0cHV0\nLndyaXRlTWVzc2FnZSg4LCByZXNwb25zZUJvZHlfKTsKICAgICAgfQogICAg\nICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhvdXRwdXQpOwogICAgfQog\nICAgCiAgICBwcml2YXRlIGludCBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0g\nLTE7CiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgewogICAg\nICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7CiAgICAgIGlm\nIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKICAgIAogICAgICBzaXplID0g\nMDsKICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4\nMDAwMDAwMDEpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUVudW1T\naXplKDEsIHByb3RvY29sVmVyc2lvbl8uZ2V0TnVtYmVyKCkpOwogICAgICB9\nCiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAw\nMDAwMDAyKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVFbnVtU2l6\nZSgyLCBzdGF0dXNDb2RlXy5nZXROdW1iZXIoKSk7CiAgICAgIH0KICAgICAg\naWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQp\nKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZVVJbnQ2NFNpemUoMywg\ndHhuSWRfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwOCkgPT0gMHgwMDAwMDAwOCkpIHsKICAgICAgICBzaXplICs9IGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAg\nIC5jb21wdXRlQnl0ZXNTaXplKDQsIGdldFN0YXR1c01zZ0J5dGVzKCkpOwog\nICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDEwKSA9\nPSAweDAwMDAwMDEwKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVN\nZXNzYWdlU2l6ZSg1LCBtZXNzYWdlXyk7CiAgICAgIH0KICAgICAgaWYgKCgo\nYml0RmllbGQwXyAmIDB4MDAwMDAwMjApID09IDB4MDAwMDAwMjApKSB7CiAg\nICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0\nU3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSg2LCB0b3BpY18p\nOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDQw\nKSA9PSAweDAwMDAwMDQwKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1\ndGVCeXRlc1NpemUoNywgc3Vic2NyaWJlcklkXyk7CiAgICAgIH0KICAgICAg\naWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwODApID09IDB4MDAwMDAwODAp\nKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDgs\nIHJlc3BvbnNlQm9keV8pOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5r\nbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9p\nemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsK\nICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJp\nYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAg\nICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0ZVJlcGxhY2UoKQog\nICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2UoKTsKICAgIH0KICAg\nIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSBwYXJzZUZyb20oCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcGFyc2VGcm9tKGJ5dGVb\nXSBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIHBhcnNlRnJvbSgK\nICAgICAgICBieXRlW10gZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJv\ndG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1YlN1YlJlc3BvbnNlIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3Bv\nbnNlIHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlu\ncHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHViU3ViUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7\nCiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkp\nIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAg\nICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIHBhcnNlRGVsaW1pdGVk\nRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRl\ncigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5w\ndXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBidWls\nZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3Vi\nUmVzcG9uc2UgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJTdWJSZXNwb25zZSBwYXJzZUZyb20oCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAu\nYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBC\ndWlsZGVyIG5ld0J1aWxkZXIoKSB7IHJldHVybiBCdWlsZGVyLmNyZWF0ZSgp\nOyB9CiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsg\ncmV0dXJuIG5ld0J1aWxkZXIoKTsgfQogICAgcHVibGljIHN0YXRpYyBCdWls\nZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcHJvdG90eXBlKSB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAg\nICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBu\nZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJp\nZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5C\ndWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRlcjsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBl\neHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRN\nZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3Vi\nUmVzcG9uc2VPckJ1aWxkZXIgewogICAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgog\nICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19QdWJTdWJSZXNwb25zZV9kZXNjcmlwdG9yOwog\nICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90\nb2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAg\nICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAg\nICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfUHViU3ViUmVzcG9uc2Vf\nZmllbGRBY2Nlc3NvclRhYmxlOwogICAgICB9CiAgICAgIAogICAgICAvLyBD\nb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UubmV3QnVpbGRlcigpCiAgICAg\nIHByaXZhdGUgQnVpbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRl\nckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZh\ndGUgQnVpbGRlcihCdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1\ncGVyKHBhcmVudCk7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFs\naXphdGlvbigpOwogICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZv\ncmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmll\nbGRCdWlsZGVycykgewogICAgICAgICAgZ2V0TWVzc2FnZUZpZWxkQnVpbGRl\ncigpOwogICAgICAgICAgZ2V0UmVzcG9uc2VCb2R5RmllbGRCdWlsZGVyKCk7\nCiAgICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGUgc3RhdGljIEJ1aWxk\nZXIgY3JlYXRlKCkgewogICAgICAgIHJldHVybiBuZXcgQnVpbGRlcigpOwog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsK\nICAgICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIHByb3RvY29sVmVyc2lv\nbl8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5Qcm90b2NvbFZlcnNpb24uVkVSU0lPTl9PTkU7CiAgICAgICAgYml0Rmll\nbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgIHN0\nYXR1c0NvZGVfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3RhdHVzQ29kZS5TVUNDRVNTOwogICAgICAgIGJpdEZpZWxk\nMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAgICAgICB0eG5J\nZF8gPSAwTDsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+\nMHgwMDAwMDAwNCk7CiAgICAgICAgc3RhdHVzTXNnXyA9ICIiOwogICAgICAg\nIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA4KTsKICAg\nICAgICBpZiAobWVzc2FnZUJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAg\nIG1lc3NhZ2VfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgbWVzc2FnZUJ1aWxkZXJfLmNsZWFyKCk7\nCiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAm\nIH4weDAwMDAwMDEwKTsKICAgICAgICB0b3BpY18gPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICAgICAgYml0RmllbGQwXyA9\nIChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMjApOwogICAgICAgIHN1YnNjcmli\nZXJJZF8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7\nCiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAw\nNDApOwogICAgICAgIGlmIChyZXNwb25zZUJvZHlCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICByZXNwb25zZUJvZHlfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5LmdldERl\nZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBy\nZXNwb25zZUJvZHlCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAg\nICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDA4MCk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVhdGUoKS5t\nZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNj\ncmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAg\nICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UuZ2V0RGVzY3JpcHRvcigpOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgZ2V0RGVmYXVs\ndEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9u\nc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJTdWJSZXNwb25zZSBidWlsZCgpIHsKICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNw\nb25zZSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJl\nc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1Vu\naW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAg\nIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUHViU3ViUmVzcG9uc2UgYnVpbGRQYXJzZWQoKQogICAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSByZXN1bHQgPSBi\ndWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxp\nemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNz\nYWdlRXhjZXB0aW9uKAogICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJS\nZXNwb25zZSBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2Ug\ncmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1YlN1YlJlc3BvbnNlKHRoaXMpOwogICAgICAgIGludCBm\ncm9tX2JpdEZpZWxkMF8gPSBiaXRGaWVsZDBfOwogICAgICAgIGludCB0b19i\naXRGaWVsZDBfID0gMDsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8g\nJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgICAgdG9f\nYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIH0KICAgICAgICBy\nZXN1bHQucHJvdG9jb2xWZXJzaW9uXyA9IHByb3RvY29sVmVyc2lvbl87CiAg\nICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0g\nMHgwMDAwMDAwMikpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAwMjsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnN0YXR1c0NvZGVf\nID0gc3RhdHVzQ29kZV87CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBf\nICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAwMDAwNCkpIHsKICAgICAgICAgIHRv\nX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwNDsKICAgICAgICB9CiAgICAgICAg\ncmVzdWx0LnR4bklkXyA9IHR4bklkXzsKICAgICAgICBpZiAoKChmcm9tX2Jp\ndEZpZWxkMF8gJiAweDAwMDAwMDA4KSA9PSAweDAwMDAwMDA4KSkgewogICAg\nICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDA4OwogICAgICAgIH0K\nICAgICAgICByZXN1bHQuc3RhdHVzTXNnXyA9IHN0YXR1c01zZ187CiAgICAg\nICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAxMCkgPT0gMHgw\nMDAwMDAxMCkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAxMDsKICAgICAgICB9CiAgICAgICAgaWYgKG1lc3NhZ2VCdWlsZGVyXyA9\nPSBudWxsKSB7CiAgICAgICAgICByZXN1bHQubWVzc2FnZV8gPSBtZXNzYWdl\nXzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0Lm1lc3NhZ2Vf\nID0gbWVzc2FnZUJ1aWxkZXJfLmJ1aWxkKCk7CiAgICAgICAgfQogICAgICAg\nIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMjApID09IDB4MDAw\nMDAwMjApKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAw\nMjA7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC50b3BpY18gPSB0b3BpY187\nCiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDA0MCkg\nPT0gMHgwMDAwMDA0MCkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0g\nMHgwMDAwMDA0MDsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LnN1YnNjcmli\nZXJJZF8gPSBzdWJzY3JpYmVySWRfOwogICAgICAgIGlmICgoKGZyb21fYml0\nRmllbGQwXyAmIDB4MDAwMDAwODApID09IDB4MDAwMDAwODApKSB7CiAgICAg\nICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwODA7CiAgICAgICAgfQog\nICAgICAgIGlmIChyZXNwb25zZUJvZHlCdWlsZGVyXyA9PSBudWxsKSB7CiAg\nICAgICAgICByZXN1bHQucmVzcG9uc2VCb2R5XyA9IHJlc3BvbnNlQm9keV87\nCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdC5yZXNwb25zZUJv\nZHlfID0gcmVzcG9uc2VCb2R5QnVpbGRlcl8uYnVpbGQoKTsKICAgICAgICB9\nCiAgICAgICAgcmVzdWx0LmJpdEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwog\nICAgICAgIG9uQnVpbHQoKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29t\nLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYg\nKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UpIHsKICAgICAgICAgIHJl\ndHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlKW90aGVyKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIG90\naGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlLmdldERl\nZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3Ro\nZXIuaGFzUHJvdG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICAgIHNldFByb3Rv\nY29sVmVyc2lvbihvdGhlci5nZXRQcm90b2NvbFZlcnNpb24oKSk7CiAgICAg\nICAgfQogICAgICAgIGlmIChvdGhlci5oYXNTdGF0dXNDb2RlKCkpIHsKICAg\nICAgICAgIHNldFN0YXR1c0NvZGUob3RoZXIuZ2V0U3RhdHVzQ29kZSgpKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc1R4bklkKCkpIHsKICAg\nICAgICAgIHNldFR4bklkKG90aGVyLmdldFR4bklkKCkpOwogICAgICAgIH0K\nICAgICAgICBpZiAob3RoZXIuaGFzU3RhdHVzTXNnKCkpIHsKICAgICAgICAg\nIHNldFN0YXR1c01zZyhvdGhlci5nZXRTdGF0dXNNc2coKSk7CiAgICAgICAg\nfQogICAgICAgIGlmIChvdGhlci5oYXNNZXNzYWdlKCkpIHsKICAgICAgICAg\nIG1lcmdlTWVzc2FnZShvdGhlci5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0K\nICAgICAgICBpZiAob3RoZXIuaGFzVG9waWMoKSkgewogICAgICAgICAgc2V0\nVG9waWMob3RoZXIuZ2V0VG9waWMoKSk7CiAgICAgICAgfQogICAgICAgIGlm\nIChvdGhlci5oYXNTdWJzY3JpYmVySWQoKSkgewogICAgICAgICAgc2V0U3Vi\nc2NyaWJlcklkKG90aGVyLmdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKG90aGVyLmhhc1Jlc3BvbnNlQm9keSgpKSB7CiAgICAg\nICAgICBtZXJnZVJlc3BvbnNlQm9keShvdGhlci5nZXRSZXNwb25zZUJvZHko\nKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmllbGRz\nKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFu\nIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgaWYgKCFoYXNQcm90b2NvbFZl\ncnNpb24oKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgfQogICAgICAgIGlmICghaGFzU3RhdHVzQ29kZSgpKSB7CiAg\nICAgICAgICAKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAg\nICAgICAgaWYgKCFoYXNUeG5JZCgpKSB7CiAgICAgICAgICAKICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGhhc01lc3Nh\nZ2UoKSkgewogICAgICAgICAgaWYgKCFnZXRNZXNzYWdlKCkuaXNJbml0aWFs\naXplZCgpKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChoYXNSZXNw\nb25zZUJvZHkoKSkgewogICAgICAgICAgaWYgKCFnZXRSZXNwb25zZUJvZHko\nKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgICAgCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1\naWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAg\nICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRy\ndWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAg\nICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAg\nICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVs\nZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsK\nICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1\nbmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAg\nICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxk\nKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA4OiB7\nCiAgICAgICAgICAgICAgaW50IHJhd1ZhbHVlID0gaW5wdXQucmVhZEVudW0o\nKTsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24gdmFsdWUgPSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZl\ncnNpb24udmFsdWVPZihyYXdWYWx1ZSk7CiAgICAgICAgICAgICAgaWYgKHZh\nbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHVua25vd25GaWVsZHMu\nbWVyZ2VWYXJpbnRGaWVsZCgxLCByYXdWYWx1ZSk7CiAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMTsKICAgICAgICAgICAgICAgIHByb3RvY29sVmVyc2lvbl8gPSB2YWx1\nZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxNjogewogICAgICAgICAgICAg\nIGludCByYXdWYWx1ZSA9IGlucHV0LnJlYWRFbnVtKCk7CiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RhdHVzQ29kZSB2YWx1ZSA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0YXR1c0NvZGUudmFsdWVPZihyYXdWYWx1ZSk7\nCiAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHVua25vd25GaWVsZHMubWVyZ2VWYXJpbnRGaWVsZCgyLCByYXdW\nYWx1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICAgICAgICAgIHN0\nYXR1c0NvZGVfID0gdmFsdWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMjQ6\nIHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAg\nICAgICAgICAgICAgdHhuSWRfID0gaW5wdXQucmVhZFVJbnQ2NCgpOwogICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNh\nc2UgMzQ6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAw\nMDg7CiAgICAgICAgICAgICAgc3RhdHVzTXNnXyA9IGlucHV0LnJlYWRCeXRl\ncygpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGNhc2UgNDI6IHsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLkJ1aWxkZXIg\nc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2UubmV3QnVpbGRlcigpOwogICAgICAgICAgICAg\nIGlmIChoYXNNZXNzYWdlKCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxk\nZXIubWVyZ2VGcm9tKGdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4\ndGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRNZXNzYWdlKHN1\nYkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgNTA6IHsKICAgICAg\nICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMjA7CiAgICAgICAgICAg\nICAgdG9waWNfID0gaW5wdXQucmVhZEJ5dGVzKCk7CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA1ODogewog\nICAgICAgICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDA0MDsKICAgICAg\nICAgICAgICBzdWJzY3JpYmVySWRfID0gaW5wdXQucmVhZEJ5dGVzKCk7CiAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nY2FzZSA2NjogewogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keS5CdWlsZGVyIHN1\nYkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5SZXNwb25zZUJvZHkubmV3QnVpbGRlcigpOwogICAgICAgICAg\nICAgIGlmIChoYXNSZXNwb25zZUJvZHkoKSkgewogICAgICAgICAgICAgICAg\nc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0UmVzcG9uc2VCb2R5KCkpOwogICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShz\ndWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAg\nc2V0UmVzcG9uc2VCb2R5KHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwog\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBi\naXRGaWVsZDBfOwogICAgICAKICAgICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5Q\ncm90b2NvbFZlcnNpb24gcHJvdG9jb2xWZXJzaW9uID0gMTsKICAgICAgcHJp\ndmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5Qcm90b2NvbFZlcnNpb24gcHJvdG9jb2xWZXJzaW9uXyA9IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVy\nc2lvbi5WRVJTSU9OX09ORTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzUHJv\ndG9jb2xWZXJzaW9uKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgICAgfQogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHJvdG9jb2xWZXJzaW9uIGdldFByb3RvY29sVmVyc2lvbigpIHsKICAg\nICAgICByZXR1cm4gcHJvdG9jb2xWZXJzaW9uXzsKICAgICAgfQogICAgICBw\ndWJsaWMgQnVpbGRlciBzZXRQcm90b2NvbFZlcnNpb24ob3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9u\nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAg\nICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAg\nIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAg\ncHJvdG9jb2xWZXJzaW9uXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyUHJvdG9jb2xWZXJzaW9uKCkgewogICAgICAgIGJpdEZp\nZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBw\ncm90b2NvbFZlcnNpb25fID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uLlZFUlNJT05fT05FOwog\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIAogICAgICAvLyByZXF1aXJlZCAuSGVkd2lnLlN0YXR1c0Nv\nZGUgc3RhdHVzQ29kZSA9IDI7CiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhdHVzQ29kZSBzdGF0\ndXNDb2RlXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXR1c0NvZGUuU1VDQ0VTUzsKICAgICAgcHVibGljIGJvb2xl\nYW4gaGFzU3RhdHVzQ29kZSgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMik7CiAgICAgIH0KICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXR1c0NvZGUgZ2V0U3RhdHVzQ29kZSgpIHsKICAgICAgICBy\nZXR1cm4gc3RhdHVzQ29kZV87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxk\nZXIgc2V0U3RhdHVzQ29kZShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdGF0dXNDb2RlIHZhbHVlKSB7CiAgICAgICAgaWYg\nKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9p\nbnRlckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBf\nIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgc3RhdHVzQ29kZV8gPSB2YWx1ZTsK\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN0YXR1c0NvZGUoKSB7\nCiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAw\nMDIpOwogICAgICAgIHN0YXR1c0NvZGVfID0gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhdHVzQ29kZS5TVUNDRVNTOwog\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIAogICAgICAvLyByZXF1aXJlZCB1aW50NjQgdHhuSWQgPSAz\nOwogICAgICBwcml2YXRlIGxvbmcgdHhuSWRfIDsKICAgICAgcHVibGljIGJv\nb2xlYW4gaGFzVHhuSWQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpOwogICAgICB9CiAgICAg\nIHB1YmxpYyBsb25nIGdldFR4bklkKCkgewogICAgICAgIHJldHVybiB0eG5J\nZF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0VHhuSWQobG9u\nZyB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwNDsK\nICAgICAgICB0eG5JZF8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBjbGVhclR4bklkKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0\nRmllbGQwXyAmIH4weDAwMDAwMDA0KTsKICAgICAgICB0eG5JZF8gPSAwTDsK\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgc3RyaW5nIHN0YXR1c01z\nZyA9IDQ7CiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBzdGF0dXNN\nc2dfID0gIiI7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1N0YXR1c01zZygp\nIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwOCkg\nPT0gMHgwMDAwMDAwOCk7CiAgICAgIH0KICAgICAgcHVibGljIFN0cmluZyBn\nZXRTdGF0dXNNc2coKSB7CiAgICAgICAgamF2YS5sYW5nLk9iamVjdCByZWYg\nPSBzdGF0dXNNc2dfOwogICAgICAgIGlmICghKHJlZiBpbnN0YW5jZW9mIFN0\ncmluZykpIHsKICAgICAgICAgIFN0cmluZyBzID0gKChjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZikudG9TdHJpbmdVdGY4KCk7CiAgICAg\nICAgICBzdGF0dXNNc2dfID0gczsKICAgICAgICAgIHJldHVybiBzOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gKFN0cmluZykgcmVmOwog\nICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdGF0\ndXNNc2coU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51\nbGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwog\nIH0KICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDg7CiAgICAgICAgc3RhdHVz\nTXNnXyA9IHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFy\nU3RhdHVzTXNnKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQw\nXyAmIH4weDAwMDAwMDA4KTsKICAgICAgICBzdGF0dXNNc2dfID0gZ2V0RGVm\nYXVsdEluc3RhbmNlKCkuZ2V0U3RhdHVzTXNnKCk7CiAgICAgICAgb25DaGFu\nZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgdm9p\nZCBzZXRTdGF0dXNNc2coY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIHZhbHVlKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDA4Owog\nICAgICAgIHN0YXR1c01zZ18gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5N\nZXNzYWdlIG1lc3NhZ2UgPSA1OwogICAgICBwcml2YXRlIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgbWVzc2Fn\nZV8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBwcml2YXRl\nIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZSwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZS5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlT3JCdWlsZGVyPiBtZXNz\nYWdlQnVpbGRlcl87CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2Uo\nKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMTAp\nID09IDB4MDAwMDAwMTApOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIGdl\ndE1lc3NhZ2UoKSB7CiAgICAgICAgaWYgKG1lc3NhZ2VCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICByZXR1cm4gbWVzc2FnZV87CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgIHJldHVybiBtZXNzYWdlQnVpbGRlcl8uZ2V0TWVz\nc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRNZXNzYWdlKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2UgdmFsdWUpIHsKICAgICAgICBpZiAobWVzc2Fn\nZUJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGlmICh2YWx1ZSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2Vw\ndGlvbigpOwogICAgICAgICAgfQogICAgICAgICAgbWVzc2FnZV8gPSB2YWx1\nZTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICBtZXNzYWdlQnVpbGRlcl8uc2V0TWVzc2FnZSh2YWx1ZSk7CiAg\nICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAxMDsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRNZXNzYWdlKAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5CdWlsZGVyIGJ1aWxkZXJG\nb3JWYWx1ZSkgewogICAgICAgIGlmIChtZXNzYWdlQnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgbWVzc2FnZV8gPSBidWlsZGVyRm9yVmFsdWUuYnVp\nbGQoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICBtZXNzYWdlQnVpbGRlcl8uc2V0TWVzc2FnZShidWlsZGVy\nRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAxMDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZU1lc3NhZ2Uob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSB2YWx1\nZSkgewogICAgICAgIGlmIChtZXNzYWdlQnVpbGRlcl8gPT0gbnVsbCkgewog\nICAgICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMTApID09IDB4\nMDAwMDAwMTApICYmCiAgICAgICAgICAgICAgbWVzc2FnZV8gIT0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5n\nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAgICAgICAgICBtZXNzYWdlXyA9\nCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVyKG1lc3NhZ2VfKS5tZXJn\nZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgbWVzc2FnZV8gPSB2YWx1ZTsKICAgICAgICAgIH0K\nICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICBtZXNzYWdlQnVpbGRlcl8ubWVyZ2VGcm9tKHZhbHVlKTsKICAgICAg\nICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDEwOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nZWFyTWVzc2FnZSgpIHsKICAgICAgICBpZiAobWVzc2FnZUJ1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIG1lc3NhZ2VfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0\nSW5zdGFuY2UoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICBtZXNzYWdlQnVpbGRlcl8uY2xlYXIoKTsKICAg\nICAgICB9CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4\nMDAwMDAwMTApOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlLkJ1aWxkZXIgZ2V0TWVzc2FnZUJ1aWxkZXIoKSB7CiAg\nICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDEwOwogICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIHJldHVybiBnZXRNZXNzYWdlRmllbGRCdWlsZGVy\nKCkuZ2V0QnVpbGRlcigpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlT3JC\ndWlsZGVyIGdldE1lc3NhZ2VPckJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKG1l\nc3NhZ2VCdWlsZGVyXyAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gbWVz\nc2FnZUJ1aWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgcmV0dXJuIG1lc3NhZ2VfOwogICAgICAgIH0K\nICAgICAgfQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2lu\nZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSwgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5CdWlsZGVy\nLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlT3JCdWlsZGVyPiAKICAgICAgICAgIGdldE1lc3NhZ2VGaWVsZEJ1\naWxkZXIoKSB7CiAgICAgICAgaWYgKG1lc3NhZ2VCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICBtZXNzYWdlQnVpbGRlcl8gPSBuZXcgY29tLmdvb2ds\nZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZSwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZS5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlT3JCdWlsZGVyPigKICAgICAgICAg\nICAgICAgICAgbWVzc2FnZV8sCiAgICAgICAgICAgICAgICAgIGdldFBhcmVu\ndEZvckNoaWxkcmVuKCksCiAgICAgICAgICAgICAgICAgIGlzQ2xlYW4oKSk7\nCiAgICAgICAgICBtZXNzYWdlXyA9IG51bGw7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiBtZXNzYWdlQnVpbGRlcl87CiAgICAgIH0KICAgICAgCiAgICAg\nIC8vIG9wdGlvbmFsIGJ5dGVzIHRvcGljID0gNjsKICAgICAgcHJpdmF0ZSBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdG9waWNfID0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNUb3BpYygpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAyMCkgPT0gMHgwMDAwMDAyMCk7CiAgICAgIH0KICAg\nICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRU\nb3BpYygpIHsKICAgICAgICByZXR1cm4gdG9waWNfOwogICAgICB9CiAgICAg\nIHB1YmxpYyBCdWlsZGVyIHNldFRvcGljKGNvbS5nb29nbGUucHJvdG9idWYu\nQnl0ZVN0cmluZyB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxs\nKSB7CiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICB9\nCiAgYml0RmllbGQwXyB8PSAweDAwMDAwMDIwOwogICAgICAgIHRvcGljXyA9\nIHZhbHVlOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVG9waWMo\nKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAw\nMDAwMjApOwogICAgICAgIHRvcGljXyA9IGdldERlZmF1bHRJbnN0YW5jZSgp\nLmdldFRvcGljKCk7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIGJ5\ndGVzIHN1YnNjcmliZXJJZCA9IDc7CiAgICAgIHByaXZhdGUgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHN1YnNjcmliZXJJZF8gPSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1N1YnNjcmliZXJJZCgpIHsKICAgICAgICByZXR1cm4gKChi\naXRGaWVsZDBfICYgMHgwMDAwMDA0MCkgPT0gMHgwMDAwMDA0MCk7CiAgICAg\nIH0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBnZXRTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgcmV0dXJuIHN1YnNjcmli\nZXJJZF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3Vic2Ny\naWJlcklkKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkg\newogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcg\nTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICB9CiAgYml0RmllbGQwXyB8PSAw\neDAwMDAwMDQwOwogICAgICAgIHN1YnNjcmliZXJJZF8gPSB2YWx1ZTsKICAg\nICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN1YnNjcmliZXJJZCgpIHsK\nICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDA0\nMCk7CiAgICAgICAgc3Vic2NyaWJlcklkXyA9IGdldERlZmF1bHRJbnN0YW5j\nZSgpLmdldFN1YnNjcmliZXJJZCgpOwogICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBv\ncHRpb25hbCAuSGVkd2lnLlJlc3BvbnNlQm9keSByZXNwb25zZUJvZHkgPSA4\nOwogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlJlc3BvbnNlQm9keSByZXNwb25zZUJvZHlfID0gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9u\nc2VCb2R5LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBwcml2YXRlIGNv\nbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUmVzcG9uc2VCb2R5LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZXNwb25zZUJvZHkuQnVpbGRlciwgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5T3JC\ndWlsZGVyPiByZXNwb25zZUJvZHlCdWlsZGVyXzsKICAgICAgcHVibGljIGJv\nb2xlYW4gaGFzUmVzcG9uc2VCb2R5KCkgewogICAgICAgIHJldHVybiAoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDgwKSA9PSAweDAwMDAwMDgwKTsKICAgICAg\nfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5IGdldFJlc3BvbnNlQm9keSgpIHsK\nICAgICAgICBpZiAocmVzcG9uc2VCb2R5QnVpbGRlcl8gPT0gbnVsbCkgewog\nICAgICAgICAgcmV0dXJuIHJlc3BvbnNlQm9keV87CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHJldHVybiByZXNwb25zZUJvZHlCdWlsZGVyXy5nZXRN\nZXNzYWdlKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIHNldFJlc3BvbnNlQm9keShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkgdmFsdWUpIHsKICAgICAg\nICBpZiAocmVzcG9uc2VCb2R5QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAg\nICByZXNwb25zZUJvZHlfID0gdmFsdWU7CiAgICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzcG9uc2VCb2R5QnVp\nbGRlcl8uc2V0TWVzc2FnZSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMDA4MDsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZXNwb25zZUJvZHko\nCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5SZXNwb25zZUJvZHkuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUp\nIHsKICAgICAgICBpZiAocmVzcG9uc2VCb2R5QnVpbGRlcl8gPT0gbnVsbCkg\newogICAgICAgICAgcmVzcG9uc2VCb2R5XyA9IGJ1aWxkZXJGb3JWYWx1ZS5i\ndWlsZCgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHJlc3BvbnNlQm9keUJ1aWxkZXJfLnNldE1lc3NhZ2Uo\nYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBi\naXRGaWVsZDBfIHw9IDB4MDAwMDAwODA7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VSZXNwb25zZUJv\nZHkob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUmVzcG9uc2VCb2R5IHZhbHVlKSB7CiAgICAgICAgaWYgKHJlc3BvbnNlQm9k\neUJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGlmICgoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDgwKSA9PSAweDAwMDAwMDgwKSAmJgogICAgICAgICAg\nICAgIHJlc3BvbnNlQm9keV8gIT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5LmdldERlZmF1bHRJbnN0\nYW5jZSgpKSB7CiAgICAgICAgICAgIHJlc3BvbnNlQm9keV8gPQogICAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlJlc3BvbnNlQm9keS5uZXdCdWlsZGVyKHJlc3BvbnNlQm9keV8pLm1l\ncmdlRnJvbSh2YWx1ZSkuYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICByZXNwb25zZUJvZHlfID0gdmFsdWU7CiAgICAg\nICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmVzcG9uc2VCb2R5QnVpbGRlcl8ubWVyZ2VGcm9tKHZh\nbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDgwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyUmVzcG9uc2VCb2R5KCkgewogICAgICAgIGlmIChy\nZXNwb25zZUJvZHlCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZXNw\nb25zZUJvZHlfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUmVzcG9uc2VCb2R5LmdldERlZmF1bHRJbnN0YW5jZSgpOwog\nICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHJlc3BvbnNlQm9keUJ1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQog\nICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDgw\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVz\ncG9uc2VCb2R5LkJ1aWxkZXIgZ2V0UmVzcG9uc2VCb2R5QnVpbGRlcigpIHsK\nICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwODA7CiAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIGdldFJlc3BvbnNlQm9keUZpZWxk\nQnVpbGRlcigpLmdldEJ1aWxkZXIoKTsKICAgICAgfQogICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVz\ncG9uc2VCb2R5T3JCdWlsZGVyIGdldFJlc3BvbnNlQm9keU9yQnVpbGRlcigp\nIHsKICAgICAgICBpZiAocmVzcG9uc2VCb2R5QnVpbGRlcl8gIT0gbnVsbCkg\newogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlQm9keUJ1aWxkZXJfLmdldE1l\nc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\ncmV0dXJuIHJlc3BvbnNlQm9keV87CiAgICAgICAgfQogICAgICB9CiAgICAg\nIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxk\nZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZXNwb25zZUJvZHksIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keS5CdWlsZGVyLCBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNw\nb25zZUJvZHlPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0UmVzcG9uc2VCb2R5\nRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmIChyZXNwb25zZUJvZHlCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZXNwb25zZUJvZHlCdWlsZGVy\nXyA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRl\ncjwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHksIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keS5CdWlsZGVy\nLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5S\nZXNwb25zZUJvZHlPckJ1aWxkZXI+KAogICAgICAgICAgICAgICAgICByZXNw\nb25zZUJvZHlfLAogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGls\nZHJlbigpLAogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAgICAg\nICAgcmVzcG9uc2VCb2R5XyA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiByZXNwb25zZUJvZHlCdWlsZGVyXzsKICAgICAgfQogICAgICAKICAg\nICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6\nSGVkd2lnLlB1YlN1YlJlc3BvbnNlKQogICAgfQogICAgCiAgICBzdGF0aWMg\newogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgUHViU3ViUmVzcG9uc2Uo\ndHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAg\nICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFz\nc19zY29wZTpIZWR3aWcuUHViU3ViUmVzcG9uc2UpCiAgfQogIAogIHB1Ymxp\nYyBpbnRlcmZhY2UgUHVibGlzaFJlc3BvbnNlT3JCdWlsZGVyCiAgICAgIGV4\ndGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVyIHsK\nICAgIAogICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5NZXNzYWdlU2VxSWQgcHVi\nbGlzaGVkTXNnSWQgPSAxOwogICAgYm9vbGVhbiBoYXNQdWJsaXNoZWRNc2dJ\nZCgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkIGdldFB1Ymxpc2hlZE1zZ0lkKCk7CiAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlU2VxSWRPckJ1aWxkZXIgZ2V0UHVibGlzaGVkTXNnSWRPckJ1aWxkZXIo\nKTsKICB9CiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBQdWJsaXNoUmVz\ncG9uc2UgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVtZW50cyBQdWJsaXNoUmVzcG9uc2VP\nckJ1aWxkZXIgewogICAgLy8gVXNlIFB1Ymxpc2hSZXNwb25zZS5uZXdCdWls\nZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJpdmF0ZSBQdWJsaXNoUmVzcG9u\nc2UoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwog\nICAgfQogICAgcHJpdmF0ZSBQdWJsaXNoUmVzcG9uc2UoYm9vbGVhbiBub0lu\naXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFB1Ymxpc2hS\nZXNwb25zZSBkZWZhdWx0SW5zdGFuY2U7CiAgICBwdWJsaWMgc3RhdGljIFB1\nYmxpc2hSZXNwb25zZSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJl\ndHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBQ\ndWJsaXNoUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsK\nICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2Ny\naXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkgewog\nICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVzcG9u\nc2VfZGVzY3JpcHRvcjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29y\nVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgp\nIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfUHVibGlzaFJl\nc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0KICAgIAogICAgcHJp\ndmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcu\nTWVzc2FnZVNlcUlkIHB1Ymxpc2hlZE1zZ0lkID0gMTsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IFBVQkxJU0hFRE1TR0lEX0ZJRUxEX05VTUJFUiA9\nIDE7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBwdWJsaXNoZWRNc2dJZF87CiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNQdWJsaXNoZWRNc2dJZCgpIHsKICAgICAg\ncmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAw\nMDEpOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRQdWJsaXNoZWRN\nc2dJZCgpIHsKICAgICAgcmV0dXJuIHB1Ymxpc2hlZE1zZ0lkXzsKICAgIH0K\nICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXIgZ2V0UHVibGlzaGVkTXNn\nSWRPckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiBwdWJsaXNoZWRNc2dJZF87\nCiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewog\nICAgICBwdWJsaXNoZWRNc2dJZF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdElu\nc3RhbmNlKCk7CiAgICB9CiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0lu\naXRpYWxpemVkID0gLTE7CiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0lu\naXRpYWxpemVkKCkgewogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1v\naXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgIGlmIChpc0luaXRpYWxpemVkICE9\nIC0xKSByZXR1cm4gaXNJbml0aWFsaXplZCA9PSAxOwogICAgICAKICAgICAg\naWYgKCFoYXNQdWJsaXNoZWRNc2dJZCgpKSB7CiAgICAgICAgbWVtb2l6ZWRJ\nc0luaXRpYWxpemVkID0gMDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nIH0KICAgICAgaWYgKCFnZXRQdWJsaXNoZWRNc2dJZCgpLmlzSW5pdGlhbGl6\nZWQoKSkgewogICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIG1lbW9pemVkSXNJ\nbml0aWFsaXplZCA9IDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNl\ncmlhbGl6ZWRTaXplKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0\nZU1lc3NhZ2UoMSwgcHVibGlzaGVkTXNnSWRfKTsKICAgICAgfQogICAgICBn\nZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhvdXRwdXQpOwogICAgfQogICAg\nCiAgICBwcml2YXRlIGludCBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gLTE7\nCiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgewogICAgICBp\nbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7CiAgICAgIGlmIChz\naXplICE9IC0xKSByZXR1cm4gc2l6ZTsKICAgIAogICAgICBzaXplID0gMDsK\nICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAw\nMDAwMDEpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVm\nLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VT\naXplKDEsIHB1Ymxpc2hlZE1zZ0lkXyk7CiAgICAgIH0KICAgICAgc2l6ZSAr\nPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsKICAg\nICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgIHJldHVy\nbiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBs\nb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAgIEBqYXZhLmxhbmcuT3Zl\ncnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcuT2JqZWN0IHdyaXRlUmVw\nbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhj\nZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndyaXRlUmVwbGFjZSgpOwog\nICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBwYXJz\nZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52\nYWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAg\nIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlIHBhcnNlRnJvbSgK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdv\nb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24g\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBwYXJz\nZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNl\nIHBhcnNlRnJvbSgKICAgICAgICBieXRlW10gZGF0YSwKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBwYXJzZUZyb20oamF2YS5p\nby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJsaXNoUmVzcG9uc2UgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8u\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5QdWJsaXNoUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRG\ncm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1p\ndGVkRnJvbShpbnB1dCkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWls\nZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxs\nOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25z\nZSBwYXJzZURlbGltaXRlZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0\ncmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVu\nc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVp\nbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VE\nZWxpbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAg\nICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVs\nc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBwYXJzZUZyb20oCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQog\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBwYXJz\nZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0\nZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIAog\nICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7IHJldHVy\nbiBCdWlsZGVyLmNyZWF0ZSgpOyB9CiAgICBwdWJsaWMgQnVpbGRlciBuZXdC\ndWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQogICAg\ncHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNl\nIHByb3RvdHlwZSkgewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShwcm90b3R5cGUpOwogICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9C\ndWlsZGVyKCkgeyByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAg\nICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBu\nZXdCdWlsZGVyRm9yVHlwZSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAg\nICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50KTsKICAg\nICAgcmV0dXJuIGJ1aWxkZXI7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+CiAg\nICAgICBpbXBsZW1lbnRzIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZU9yQnVpbGRlciB7CiAgICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yKCkg\newogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hS\nZXNwb25zZV9kZXNjcmlwdG9yOwogICAgICB9CiAgICAgIAogICAgICBwcm90\nZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFj\nY2Vzc29yVGFibGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19I\nZWR3aWdfUHVibGlzaFJlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nICAgfQogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNw\nb25zZS5uZXdCdWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgewog\nICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAg\nICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBCdWlsZGVyKEJ1aWxkZXJQYXJl\nbnQgcGFyZW50KSB7CiAgICAgICAgc3VwZXIocGFyZW50KTsKICAgICAgICBt\nYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAg\nICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRp\nb24oKSB7CiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7CiAgICAgICAg\nICBnZXRQdWJsaXNoZWRNc2dJZEZpZWxkQnVpbGRlcigpOwogICAgICAgIH0K\nICAgICAgfQogICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgp\nIHsKICAgICAgICByZXR1cm4gbmV3IEJ1aWxkZXIoKTsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAgc3Vw\nZXIuY2xlYXIoKTsKICAgICAgICBpZiAocHVibGlzaGVkTXNnSWRCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBwdWJsaXNoZWRNc2dJZF8gPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgIHB1Ymxpc2hlZE1zZ0lkQnVpbGRlcl8uY2xlYXIoKTsKICAg\nICAgICB9CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4\nMDAwMDAwMDEpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1\ncm4gY3JlYXRlKCkubWVyZ2VGcm9tKGJ1aWxkUGFydGlhbCgpKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVz\nY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvckZv\nclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZS5nZXREZXNj\ncmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVz\ncG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlIGJ1aWxkKCkg\newogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlB1Ymxpc2hSZXNwb25zZSByZXN1bHQgPSBidWlsZFBhcnRpYWwo\nKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAg\nICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9u\nKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAg\nICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlIGJ1aWxk\nUGFyc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlc3BvbnNlIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlm\nICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cg\nbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAg\nIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBidWlsZFBhcnRpYWwoKSB7\nCiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUHVibGlzaFJlc3BvbnNlIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVzcG9u\nc2UodGhpcyk7CiAgICAgICAgaW50IGZyb21fYml0RmllbGQwXyA9IGJpdEZp\nZWxkMF87CiAgICAgICAgaW50IHRvX2JpdEZpZWxkMF8gPSAwOwogICAgICAg\nIGlmICgoKGZyb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAw\nMDAwMDEpKSB7CiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAw\nMDE7CiAgICAgICAgfQogICAgICAgIGlmIChwdWJsaXNoZWRNc2dJZEJ1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIHJlc3VsdC5wdWJsaXNoZWRNc2dJ\nZF8gPSBwdWJsaXNoZWRNc2dJZF87CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHJlc3VsdC5wdWJsaXNoZWRNc2dJZF8gPSBwdWJsaXNoZWRNc2dJZEJ1\naWxkZXJfLmJ1aWxkKCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5iaXRG\naWVsZDBfID0gdG9fYml0RmllbGQwXzsKICAgICAgICBvbkJ1aWx0KCk7CiAg\nICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVz\nc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxp\nc2hSZXNwb25zZSkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlc3BvbnNlKW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJsaXNoUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkp\nIHJldHVybiB0aGlzOwogICAgICAgIGlmIChvdGhlci5oYXNQdWJsaXNoZWRN\nc2dJZCgpKSB7CiAgICAgICAgICBtZXJnZVB1Ymxpc2hlZE1zZ0lkKG90aGVy\nLmdldFB1Ymxpc2hlZE1zZ0lkKCkpOwogICAgICAgIH0KICAgICAgICB0aGlz\nLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICAg\nIGlmICghaGFzUHVibGlzaGVkTXNnSWQoKSkgewogICAgICAgICAgCiAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICghZ2V0\nUHVibGlzaGVkTXNnSWQoKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAg\nIAogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVp\nbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAgICAg\nIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAodHJ1\nZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAg\nICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAg\nICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxk\ncy5idWlsZCgpKTsKICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewog\nICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVu\na25vd25GaWVsZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAg\nICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQo\nKSk7CiAgICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDEwOiB7\nCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxkZXIgc3ViQnVpbGRlciA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgaWYgKGhh\nc1B1Ymxpc2hlZE1zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxk\nZXIubWVyZ2VGcm9tKGdldFB1Ymxpc2hlZE1zZ0lkKCkpOwogICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWls\nZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0UHVi\nbGlzaGVkTXNnSWQoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZp\nZWxkMF87CiAgICAgIAogICAgICAvLyByZXF1aXJlZCAuSGVkd2lnLk1lc3Nh\nZ2VTZXFJZCBwdWJsaXNoZWRNc2dJZCA9IDE7CiAgICAgIHByaXZhdGUgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkIHB1Ymxpc2hlZE1zZ0lkXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0\nSW5zdGFuY2UoKTsKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVm\nLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlcj4gcHVibGlzaGVk\nTXNnSWRCdWlsZGVyXzsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzUHVibGlz\naGVkTXNnSWQoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlU2VxSWQgZ2V0UHVibGlzaGVkTXNnSWQoKSB7CiAgICAgICAgaWYg\nKHB1Ymxpc2hlZE1zZ0lkQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\ncmV0dXJuIHB1Ymxpc2hlZE1zZ0lkXzsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgcmV0dXJuIHB1Ymxpc2hlZE1zZ0lkQnVpbGRlcl8uZ2V0TWVzc2Fn\nZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBz\nZXRQdWJsaXNoZWRNc2dJZChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgdmFsdWUpIHsKICAgICAgICBp\nZiAocHVibGlzaGVkTXNnSWRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAg\nICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAgIH0KICAgICAgICAg\nIHB1Ymxpc2hlZE1zZ0lkXyA9IHZhbHVlOwogICAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHB1Ymxpc2hlZE1zZ0lk\nQnVpbGRlcl8uc2V0TWVzc2FnZSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAg\nIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRQdWJsaXNoZWRN\nc2dJZCgKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5CdWlsZGVyIGJ1aWxkZXJGb3JW\nYWx1ZSkgewogICAgICAgIGlmIChwdWJsaXNoZWRNc2dJZEJ1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIHB1Ymxpc2hlZE1zZ0lkXyA9IGJ1aWxkZXJG\nb3JWYWx1ZS5idWlsZCgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIHB1Ymxpc2hlZE1zZ0lkQnVpbGRlcl8u\nc2V0TWVzc2FnZShidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAg\nfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJn\nZVB1Ymxpc2hlZE1zZ0lkKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2YWx1ZSkgewogICAgICAgIGlm\nIChwdWJsaXNoZWRNc2dJZEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAg\nIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAx\nKSAmJgogICAgICAgICAgICAgIHB1Ymxpc2hlZE1zZ0lkXyAhPSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAgICAgICAgICAgcHVibGlz\naGVkTXNnSWRfID0KICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRl\ncihwdWJsaXNoZWRNc2dJZF8pLm1lcmdlRnJvbSh2YWx1ZSkuYnVpbGRQYXJ0\naWFsKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdWJsaXNo\nZWRNc2dJZF8gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwdWJsaXNoZWRN\nc2dJZEJ1aWxkZXJfLm1lcmdlRnJvbSh2YWx1ZSk7CiAgICAgICAgfQogICAg\nICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclB1Ymxp\nc2hlZE1zZ0lkKCkgewogICAgICAgIGlmIChwdWJsaXNoZWRNc2dJZEJ1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIHB1Ymxpc2hlZE1zZ0lkXyA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwdWJsaXNoZWRN\nc2dJZEJ1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZp\nZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1\naWxkZXIgZ2V0UHVibGlzaGVkTXNnSWRCdWlsZGVyKCkgewogICAgICAgIGJp\ndEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICBvbkNoYW5nZWQoKTsK\nICAgICAgICByZXR1cm4gZ2V0UHVibGlzaGVkTXNnSWRGaWVsZEJ1aWxkZXIo\nKS5nZXRCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZE9yQnVpbGRlciBnZXRQdWJsaXNoZWRNc2dJZE9yQnVpbGRlcigpIHsKICAg\nICAgICBpZiAocHVibGlzaGVkTXNnSWRCdWlsZGVyXyAhPSBudWxsKSB7CiAg\nICAgICAgICByZXR1cm4gcHVibGlzaGVkTXNnSWRCdWlsZGVyXy5nZXRNZXNz\nYWdlT3JCdWlsZGVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJl\ndHVybiBwdWJsaXNoZWRNc2dJZF87CiAgICAgICAgfQogICAgICB9CiAgICAg\nIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxk\nZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQsIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5CdWlsZGVyLCBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlU2VxSWRPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0UHVibGlzaGVkTXNn\nSWRGaWVsZEJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKHB1Ymxpc2hlZE1zZ0lk\nQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgcHVibGlzaGVkTXNnSWRC\ndWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxk\nQnVpbGRlcjwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQsIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5C\ndWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXI+KAogICAgICAgICAgICAgICAg\nICBwdWJsaXNoZWRNc2dJZF8sCiAgICAgICAgICAgICAgICAgIGdldFBhcmVu\ndEZvckNoaWxkcmVuKCksCiAgICAgICAgICAgICAgICAgIGlzQ2xlYW4oKSk7\nCiAgICAgICAgICBwdWJsaXNoZWRNc2dJZF8gPSBudWxsOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gcHVibGlzaGVkTXNnSWRCdWlsZGVyXzsKICAgICAg\nfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1\naWxkZXJfc2NvcGU6SGVkd2lnLlB1Ymxpc2hSZXNwb25zZSkKICAgIH0KICAg\nIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFB1\nYmxpc2hSZXNwb25zZSh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmlu\naXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0\naW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5QdWJsaXNoUmVzcG9uc2Up\nCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2UgU3Vic2NyaWJlUmVzcG9uc2VP\nckJ1aWxkZXIKICAgICAgZXh0ZW5kcyBjb20uZ29vZ2xlLnByb3RvYnVmLk1l\nc3NhZ2VPckJ1aWxkZXIgewogICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2ln\nLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHByZWZlcmVuY2VzID0gMjsKICAg\nIGJvb2xlYW4gaGFzUHJlZmVyZW5jZXMoKTsKICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZl\ncmVuY2VzIGdldFByZWZlcmVuY2VzKCk7CiAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJl\nbmNlc09yQnVpbGRlciBnZXRQcmVmZXJlbmNlc09yQnVpbGRlcigpOwogIH0K\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFN1YnNjcmliZVJlc3BvbnNl\nIGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRN\nZXNzYWdlCiAgICAgIGltcGxlbWVudHMgU3Vic2NyaWJlUmVzcG9uc2VPckJ1\naWxkZXIgewogICAgLy8gVXNlIFN1YnNjcmliZVJlc3BvbnNlLm5ld0J1aWxk\nZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIFN1YnNjcmliZVJlc3Bv\nbnNlKEJ1aWxkZXIgYnVpbGRlcikgewogICAgICBzdXBlcihidWlsZGVyKTsK\nICAgIH0KICAgIHByaXZhdGUgU3Vic2NyaWJlUmVzcG9uc2UoYm9vbGVhbiBu\nb0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN1YnNj\ncmliZVJlc3BvbnNlIGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0\naWMgU3Vic2NyaWJlUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewog\nICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBw\ndWJsaWMgU3Vic2NyaWJlUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9y\nVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0K\nICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlw\ndG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJz\nY3JpYmVSZXNwb25zZV9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90\nZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nl\nc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19TdWJzY3JpYmVSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9\nCiAgICAKICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAvLyBvcHRp\nb25hbCAuSGVkd2lnLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHByZWZlcmVu\nY2VzID0gMjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFBSRUZFUkVO\nQ0VTX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblBy\nZWZlcmVuY2VzIHByZWZlcmVuY2VzXzsKICAgIHB1YmxpYyBib29sZWFuIGhh\nc1ByZWZlcmVuY2VzKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICB9CiAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uUHJlZmVyZW5jZXMgZ2V0UHJlZmVyZW5jZXMoKSB7CiAgICAg\nIHJldHVybiBwcmVmZXJlbmNlc187CiAgICB9CiAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uUHJlZmVyZW5jZXNPckJ1aWxkZXIgZ2V0UHJlZmVyZW5jZXNPckJ1aWxk\nZXIoKSB7CiAgICAgIHJldHVybiBwcmVmZXJlbmNlc187CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICBwcmVmZXJl\nbmNlc18gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5nZXREZWZhdWx0SW5zdGFu\nY2UoKTsKICAgIH0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlh\nbGl6ZWQgPSAtMTsKICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlh\nbGl6ZWQoKSB7CiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVk\nSXNJbml0aWFsaXplZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgIT0gLTEp\nIHJldHVybiBpc0luaXRpYWxpemVkID09IDE7CiAgICAgIAogICAgICBtZW1v\naXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1ZTsKICAg\nIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBvdXRw\ndXQud3JpdGVNZXNzYWdlKDIsIHByZWZlcmVuY2VzXyk7CiAgICAgIH0KICAg\nICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0K\nICAgIAogICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9\nIC0xOwogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAg\nICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBp\nZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9\nIDA7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAw\neDAwMDAwMDAxKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90\nb2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNz\nYWdlU2l6ZSgyLCBwcmVmZXJlbmNlc18pOwogICAgICB9CiAgICAgIHNpemUg\nKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAg\nICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1\ncm4gc2l6ZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5nLk92\nZXJyaWRlCiAgICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0ZVJl\ncGxhY2UoKQogICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2UoKTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXNwb25zZSBw\nYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2UgcGFyc2VG\ncm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBk\nYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9u\nc2UgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEp\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmli\nZVJlc3BvbnNlIHBhcnNlRnJvbSgKICAgICAgICBieXRlW10gZGF0YSwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlIHBhcnNl\nRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlIHBhcnNlRnJvbSgKICAg\nICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2Ug\ncGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQp\nCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBC\ndWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWls\nZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkpIHsKICAgICAgICByZXR1\ncm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAg\nICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmliZVJlc3BvbnNlIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBp\nZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lv\nblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2Ug\ncGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJ\nbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXNwb25zZSBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5w\ndXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBCdWlsZGVy\nIG5ld0J1aWxkZXIoKSB7IHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOyB9CiAg\nICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJu\nIG5ld0J1aWxkZXIoKTsgfQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5l\nd0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaWJlUmVzcG9uc2UgcHJvdG90eXBlKSB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9\nCiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBuZXdC\ndWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWls\nZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBu\nZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1cm4gYnVpbGRlcjsKICAg\nIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRl\nbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNz\nYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGltcGxlbWVudHMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVzcG9uc2VPckJ1aWxkZXIgewogICAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgog\nICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpYmVSZXNwb25zZV9kZXNjcmlwdG9y\nOwogICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5w\ncm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQog\nICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAg\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaWJlUmVz\ncG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgICB9CiAgICAgIAogICAg\nICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2UubmV3QnVpbGRl\ncigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsKICAgICAgICBtYXliZUZv\ncmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgCiAg\nICAgIHByaXZhdGUgQnVpbGRlcihCdWlsZGVyUGFyZW50IHBhcmVudCkgewog\nICAgICAgIHN1cGVyKHBhcmVudCk7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxk\nZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAgICAgIHByaXZhdGUgdm9p\nZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCkgewogICAgICAg\nIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3\nYXlzVXNlRmllbGRCdWlsZGVycykgewogICAgICAgICAgZ2V0UHJlZmVyZW5j\nZXNGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJp\ndmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFyKCk7CiAgICAg\nICAgaWYgKHByZWZlcmVuY2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgcHJlZmVyZW5jZXNfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuZ2V0RGVm\nYXVsdEluc3RhbmNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBy\nZWZlcmVuY2VzQnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAg\nYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVy\nZ2VGcm9tKGJ1aWxkUGFydGlhbCgpKTsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3Jp\ncHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAg\nICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlLmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlIGdldERl\nZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmli\nZVJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2UgYnVpbGQoKSB7CiAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVzcG9uc2UgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAg\nICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAg\nICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1\nbHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9\nCiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlIGJ1aWxkUGFy\nc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVzcG9uc2UgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYg\nKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBu\nZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigKICAgICAgICAgICAg\ncmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2UgYnVpbGRQYXJ0aWFsKCkg\newogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlIHJlc3VsdCA9IG5ldyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXNwb25zZSh0aGlzKTsKICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0g\nYml0RmllbGQwXzsKICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9IDA7CiAg\nICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAwMTsKICAgICAgICB9CiAgICAgICAgaWYgKHByZWZlcmVuY2VzQnVp\nbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgcmVzdWx0LnByZWZlcmVuY2Vz\nXyA9IHByZWZlcmVuY2VzXzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\ncmVzdWx0LnByZWZlcmVuY2VzXyA9IHByZWZlcmVuY2VzQnVpbGRlcl8uYnVp\nbGQoKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LmJpdEZpZWxkMF8gPSB0\nb19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQoKTsKICAgICAgICByZXR1\ncm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRl\nciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVy\nKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9u\nc2UpIHsKICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3Bv\nbnNlKW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIu\nbWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVy\nZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmliZVJlc3BvbnNlIG90aGVyKSB7CiAgICAgICAgaWYgKG90\naGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmliZVJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSBy\nZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIuaGFzUHJlZmVyZW5jZXMo\nKSkgewogICAgICAgICAgbWVyZ2VQcmVmZXJlbmNlcyhvdGhlci5nZXRQcmVm\nZXJlbmNlcygpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tZXJnZVVua25v\nd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGZpbmFs\nIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VG\ncm9tKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtu\nb3duRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5r\nbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAgICAgIHRoaXMuZ2V0\nVW5rbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAg\nICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAgIHN3\naXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAg\nICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgp\nKTsKICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAg\nICAgIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVs\nZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRl\nbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgdGhpcy5z\nZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAg\nICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDE4OiB7CiAgICAgICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuQnVpbGRlciBzdWJCdWlsZGVy\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMubmV3QnVpbGRlcigpOwogICAgICAg\nICAgICAgIGlmIChoYXNQcmVmZXJlbmNlcygpKSB7CiAgICAgICAgICAgICAg\nICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRQcmVmZXJlbmNlcygpKTsKICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uo\nc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAgICAgICAgICAg\nIHNldFByZWZlcmVuY2VzKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwog\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBi\naXRGaWVsZDBfOwogICAgICAKICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5T\ndWJzY3JpcHRpb25QcmVmZXJlbmNlcyBwcmVmZXJlbmNlcyA9IDI7CiAgICAg\nIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgcHJlZmVyZW5jZXNfID0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uUHJlZmVyZW5jZXMuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1\naWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcywgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uUHJlZmVyZW5jZXMuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXNP\nckJ1aWxkZXI+IHByZWZlcmVuY2VzQnVpbGRlcl87CiAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1ByZWZlcmVuY2VzKCkgewogICAgICAgIHJldHVybiAoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgICAg\nfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgZ2V0UHJlZmVy\nZW5jZXMoKSB7CiAgICAgICAgaWYgKHByZWZlcmVuY2VzQnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgcmV0dXJuIHByZWZlcmVuY2VzXzsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHByZWZlcmVuY2VzQnVpbGRl\ncl8uZ2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRQcmVmZXJlbmNlcyhvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNl\ncyB2YWx1ZSkgewogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAg\nICAgICAgfQogICAgICAgICAgcHJlZmVyZW5jZXNfID0gdmFsdWU7CiAgICAg\nICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\ncHJlZmVyZW5jZXNCdWlsZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsKICAgICAg\nICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndFByZWZlcmVuY2VzKAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMu\nQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAocHJlZmVy\nZW5jZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBwcmVmZXJlbmNl\nc18gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwcmVmZXJlbmNl\nc0J1aWxkZXJfLnNldE1lc3NhZ2UoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkp\nOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VQcmVmZXJlbmNlcyhvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcyB2\nYWx1ZSkgewogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxkZXJfID09IG51\nbGwpIHsKICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAx\nKSA9PSAweDAwMDAwMDAxKSAmJgogICAgICAgICAgICAgIHByZWZlcmVuY2Vz\nXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5nZXREZWZhdWx0SW5zdGFuY2Uo\nKSkgewogICAgICAgICAgICBwcmVmZXJlbmNlc18gPQogICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzLm5ld0J1aWxkZXIocHJlZmVyZW5jZXNf\nKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgcHJlZmVyZW5jZXNfID0gdmFsdWU7CiAg\nICAgICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgcHJlZmVyZW5jZXNCdWlsZGVyXy5tZXJnZUZyb20o\ndmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgY2xlYXJQcmVmZXJlbmNlcygpIHsKICAgICAgICBpZiAo\ncHJlZmVyZW5jZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBwcmVm\nZXJlbmNlc18gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5nZXREZWZhdWx0SW5z\ndGFuY2UoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICBwcmVmZXJlbmNlc0J1aWxkZXJfLmNsZWFyKCk7CiAg\nICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4w\neDAwMDAwMDAxKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuQnVpbGRlciBnZXRQcmVm\nZXJlbmNlc0J1aWxkZXIoKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAw\nMDAwMDAxOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiBn\nZXRQcmVmZXJlbmNlc0ZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXIoKTsKICAg\nICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXNPckJ1aWxk\nZXIgZ2V0UHJlZmVyZW5jZXNPckJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKHBy\nZWZlcmVuY2VzQnVpbGRlcl8gIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJu\nIHByZWZlcmVuY2VzQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gcHJlZmVyZW5jZXNf\nOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIGNvbS5nb29nbGUu\ncHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uUHJlZmVyZW5jZXMsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzLkJ1aWxkZXIs\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzT3JCdWlsZGVyPiAKICAgICAgICAgIGdl\ndFByZWZlcmVuY2VzRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmIChwcmVm\nZXJlbmNlc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHByZWZlcmVu\nY2VzQnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVG\naWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5j\nZXMsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzLkJ1aWxkZXIsIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblBy\nZWZlcmVuY2VzT3JCdWlsZGVyPigKICAgICAgICAgICAgICAgICAgcHJlZmVy\nZW5jZXNfLAogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJl\nbigpLAogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAgICAgICAg\ncHJlZmVyZW5jZXNfID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIHByZWZlcmVuY2VzQnVpbGRlcl87CiAgICAgIH0KICAgICAgCiAgICAgIC8v\nIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOkhlZHdp\nZy5TdWJzY3JpYmVSZXNwb25zZSkKICAgIH0KICAgIAogICAgc3RhdGljIHsK\nICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFN1YnNjcmliZVJlc3BvbnNl\nKHRydWUpOwogICAgICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwog\nICAgfQogICAgCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xh\nc3Nfc2NvcGU6SGVkd2lnLlN1YnNjcmliZVJlc3BvbnNlKQogIH0KICAKICBw\ndWJsaWMgaW50ZXJmYWNlIFJlc3BvbnNlQm9keU9yQnVpbGRlcgogICAgICBl\neHRlbmRzIGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZU9yQnVpbGRlciB7\nCiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuUHVibGlzaFJlc3BvbnNl\nIHB1Ymxpc2hSZXNwb25zZSA9IDE7CiAgICBib29sZWFuIGhhc1B1Ymxpc2hS\nZXNwb25zZSgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlIGdldFB1Ymxpc2hSZXNwb25z\nZSgpOwogICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUHVibGlzaFJlc3BvbnNlT3JCdWlsZGVyIGdldFB1Ymxpc2hSZXNw\nb25zZU9yQnVpbGRlcigpOwogICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2ln\nLlN1YnNjcmliZVJlc3BvbnNlIHN1YnNjcmliZVJlc3BvbnNlID0gMjsKICAg\nIGJvb2xlYW4gaGFzU3Vic2NyaWJlUmVzcG9uc2UoKTsKICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJl\nc3BvbnNlIGdldFN1YnNjcmliZVJlc3BvbnNlKCk7CiAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXNw\nb25zZU9yQnVpbGRlciBnZXRTdWJzY3JpYmVSZXNwb25zZU9yQnVpbGRlcigp\nOwogICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmlwdGlvbkV2\nZW50UmVzcG9uc2Ugc3Vic2NyaXB0aW9uRXZlbnQgPSAzOwogICAgYm9vbGVh\nbiBoYXNTdWJzY3JpcHRpb25FdmVudCgpOwogICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRS\nZXNwb25zZSBnZXRTdWJzY3JpcHRpb25FdmVudCgpOwogICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nRXZlbnRSZXNwb25zZU9yQnVpbGRlciBnZXRTdWJzY3JpcHRpb25FdmVudE9y\nQnVpbGRlcigpOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFJl\nc3BvbnNlQm9keSBleHRlbmRzCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZQogICAgICBpbXBsZW1lbnRzIFJlc3BvbnNlQm9k\neU9yQnVpbGRlciB7CiAgICAvLyBVc2UgUmVzcG9uc2VCb2R5Lm5ld0J1aWxk\nZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIFJlc3BvbnNlQm9keShC\ndWlsZGVyIGJ1aWxkZXIpIHsKICAgICAgc3VwZXIoYnVpbGRlcik7CiAgICB9\nCiAgICBwcml2YXRlIFJlc3BvbnNlQm9keShib29sZWFuIG5vSW5pdCkge30K\nICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgUmVzcG9uc2VCb2R5IGRl\nZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgUmVzcG9uc2VCb2R5\nIGdldERlZmF1bHRJbnN0YW5jZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJ\nbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVibGljIFJlc3BvbnNlQm9keSBn\nZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVm\nYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRv\ncgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX1Jlc3BvbnNlQm9keV9kZXNjcmlwdG9yOwogICAg\nfQogICAgCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVy\nbmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19SZXNwb25zZUJvZHlfZmllbGRBY2Nlc3NvclRh\nYmxlOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOwog\nICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5QdWJsaXNoUmVzcG9uc2UgcHVibGlz\naFJlc3BvbnNlID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFBV\nQkxJU0hSRVNQT05TRV9GSUVMRF9OVU1CRVIgPSAxOwogICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJs\naXNoUmVzcG9uc2UgcHVibGlzaFJlc3BvbnNlXzsKICAgIHB1YmxpYyBib29s\nZWFuIGhhc1B1Ymxpc2hSZXNwb25zZSgpIHsKICAgICAgcmV0dXJuICgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpOwogICAgfQog\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlB1Ymxpc2hSZXNwb25zZSBnZXRQdWJsaXNoUmVzcG9uc2UoKSB7\nCiAgICAgIHJldHVybiBwdWJsaXNoUmVzcG9uc2VfOwogICAgfQogICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1Ymxpc2hSZXNwb25zZU9yQnVpbGRlciBnZXRQdWJsaXNoUmVzcG9uc2VP\nckJ1aWxkZXIoKSB7CiAgICAgIHJldHVybiBwdWJsaXNoUmVzcG9uc2VfOwog\nICAgfQogICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmliZVJl\nc3BvbnNlIHN1YnNjcmliZVJlc3BvbnNlID0gMjsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IFNVQlNDUklCRVJFU1BPTlNFX0ZJRUxEX05VTUJFUiA9\nIDI7CiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlIHN1YnNjcmliZVJlc3Bv\nbnNlXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZVJlc3BvbnNl\nKCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMikg\nPT0gMHgwMDAwMDAwMik7CiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9u\nc2UgZ2V0U3Vic2NyaWJlUmVzcG9uc2UoKSB7CiAgICAgIHJldHVybiBzdWJz\nY3JpYmVSZXNwb25zZV87CiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9u\nc2VPckJ1aWxkZXIgZ2V0U3Vic2NyaWJlUmVzcG9uc2VPckJ1aWxkZXIoKSB7\nCiAgICAgIHJldHVybiBzdWJzY3JpYmVSZXNwb25zZV87CiAgICB9CiAgICAK\nICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2NyaXB0aW9uRXZlbnRSZXNw\nb25zZSBzdWJzY3JpcHRpb25FdmVudCA9IDM7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBTVUJTQ1JJUFRJT05FVkVOVF9GSUVMRF9OVU1CRVIgPSAz\nOwogICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlIHN1YnNjcmlw\ndGlvbkV2ZW50XzsKICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmlwdGlv\nbkV2ZW50KCkgewogICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwNCkgPT0gMHgwMDAwMDAwNCk7CiAgICB9CiAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uRXZlbnRSZXNwb25zZSBnZXRTdWJzY3JpcHRpb25FdmVudCgpIHsKICAg\nICAgcmV0dXJuIHN1YnNjcmlwdGlvbkV2ZW50XzsKICAgIH0KICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpcHRpb25FdmVudFJlc3BvbnNlT3JCdWlsZGVyIGdldFN1YnNjcmlw\ndGlvbkV2ZW50T3JCdWlsZGVyKCkgewogICAgICByZXR1cm4gc3Vic2NyaXB0\naW9uRXZlbnRfOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgaW5pdEZp\nZWxkcygpIHsKICAgICAgcHVibGlzaFJlc3BvbnNlXyA9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25z\nZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgc3Vic2NyaWJlUmVzcG9u\nc2VfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaWJlUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICAgIHN1YnNjcmlwdGlvbkV2ZW50XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9u\nc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICB9CiAgICBwcml2YXRlIGJ5\ndGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7CiAgICBwdWJsaWMgZmlu\nYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBieXRlIGlzSW5p\ndGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgIGlmIChp\nc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4gaXNJbml0aWFsaXplZCA9PSAx\nOwogICAgICAKICAgICAgaWYgKGhhc1B1Ymxpc2hSZXNwb25zZSgpKSB7CiAg\nICAgICAgaWYgKCFnZXRQdWJsaXNoUmVzcG9uc2UoKS5pc0luaXRpYWxpemVk\nKCkpIHsKICAgICAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAg\nIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7CiAgICAgIHJldHVybiB0cnVl\nOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29n\nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIGlmICgoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAg\nIG91dHB1dC53cml0ZU1lc3NhZ2UoMSwgcHVibGlzaFJlc3BvbnNlXyk7CiAg\nICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09\nIDB4MDAwMDAwMDIpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSgy\nLCBzdWJzY3JpYmVSZXNwb25zZV8pOwogICAgICB9CiAgICAgIGlmICgoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAwMDA0KSkgewogICAg\nICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMywgc3Vic2NyaXB0aW9uRXZlbnRf\nKTsKICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhv\ndXRwdXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBtZW1vaXplZFNl\ncmlhbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6\nZWRTaXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXpl\nZFNpemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKICAg\nIAogICAgICBzaXplID0gMDsKICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgc2l6ZSArPSBj\nb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAg\nICAuY29tcHV0ZU1lc3NhZ2VTaXplKDEsIHB1Ymxpc2hSZXNwb25zZV8pOwog\nICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9\nPSAweDAwMDAwMDAyKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVN\nZXNzYWdlU2l6ZSgyLCBzdWJzY3JpYmVSZXNwb25zZV8pOwogICAgICB9CiAg\nICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAw\nMDA0KSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6\nZSgzLCBzdWJzY3JpcHRpb25FdmVudF8pOwogICAgICB9CiAgICAgIHNpemUg\nKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAg\nICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1\ncm4gc2l6ZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwg\nbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2YS5sYW5nLk92\nZXJyaWRlCiAgICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVjdCB3cml0ZVJl\ncGxhY2UoKQogICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVjdFN0cmVhbUV4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBzdXBlci53cml0ZVJlcGxhY2UoKTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkgcGFyc2VG\ncm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBk\nYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keSBwYXJzZUZyb20oCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkgcGFyc2VGcm9tKGJ5\ndGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keSBwYXJzZUZyb20o\nCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5SZXNwb25zZUJvZHkgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0g\naW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5\nIHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0\nLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVz\ncG9uc2VCb2R5IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAg\nICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBl\nbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZXNwb25zZUJvZHkgcGFyc2VEZWxpbWl0ZWRGcm9tKAog\nICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAg\nICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0\nZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVp\nbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkg\ncGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJ\nbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5S\nZXNwb25zZUJvZHkgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdC\ndWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVi\nbGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdC\ndWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWls\nZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlJlc3BvbnNlQm9keSBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1Ymxp\nYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhp\ncyk7IH0KICAgIAogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVj\ndGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXJQYXJlbnQg\ncGFyZW50KSB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVy\nKHBhcmVudCk7CiAgICAgIHJldHVybiBidWlsZGVyOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRl\ncjxCdWlsZGVyPgogICAgICAgaW1wbGVtZW50cyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHlPckJ1aWxk\nZXIgewogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJv\ndG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19SZXNwb25zZUJvZHlfZGVzY3JpcHRvcjsKICAgICAgfQogICAgICAKICAg\nICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAgIGludGVybmFsR2V0\nRmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1Jlc3BvbnNlQm9keV9maWVsZEFjY2Vzc29yVGFibGU7\nCiAgICAgIH0KICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25z\nZUJvZHkubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsK\nICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRlcihCdWlsZGVyUGFy\nZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVudCk7CiAgICAgICAg\nbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAg\nICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycykgewogICAgICAg\nICAgZ2V0UHVibGlzaFJlc3BvbnNlRmllbGRCdWlsZGVyKCk7CiAgICAgICAg\nICBnZXRTdWJzY3JpYmVSZXNwb25zZUZpZWxkQnVpbGRlcigpOwogICAgICAg\nICAgZ2V0U3Vic2NyaXB0aW9uRXZlbnRGaWVsZEJ1aWxkZXIoKTsKICAgICAg\nICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVh\ndGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAg\nIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgaWYgKHB1Ymxpc2hSZXNwb25zZUJ1\naWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHB1Ymxpc2hSZXNwb25zZV8g\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJsaXNoUmVzcG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIHB1Ymxpc2hSZXNwb25zZUJ1aWxkZXJfLmNs\nZWFyKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0Rmll\nbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBpZiAoc3Vic2NyaWJlUmVz\ncG9uc2VCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBzdWJzY3JpYmVS\nZXNwb25zZV8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpYmVSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3Vic2NyaWJlUmVzcG9u\nc2VCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAgaWYg\nKHN1YnNjcmlwdGlvbkV2ZW50QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgc3Vic2NyaXB0aW9uRXZlbnRfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25z\nZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgc3Vic2NyaXB0aW9uRXZlbnRCdWlsZGVyXy5jbGVhcigpOwogICAg\nICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgw\nMDAwMDAwNCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVy\nbiBjcmVhdGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9\nCiAgICAgIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9y\nVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5LmdldERlc2NyaXB0\nb3IoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keSBn\nZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNw\nb25zZUJvZHkuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZXNwb25zZUJvZHkgYnVpbGQoKSB7CiAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9u\nc2VCb2R5IHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICgh\ncmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3\nVW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAg\nICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5SZXNwb25zZUJvZHkgYnVpbGRQYXJzZWQoKQogICAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkgcmVzdWx0ID0gYnVp\nbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXpl\nZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2Fn\nZUV4Y2VwdGlvbigKICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VC\nb2R5IGJ1aWxkUGFydGlhbCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkgcmVzdWx0\nID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlJlc3BvbnNlQm9keSh0aGlzKTsKICAgICAgICBpbnQgZnJvbV9iaXRG\naWVsZDBfID0gYml0RmllbGQwXzsKICAgICAgICBpbnQgdG9fYml0RmllbGQw\nXyA9IDA7CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAw\nMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHRvX2JpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICB9CiAgICAgICAgaWYgKHB1Ymxp\nc2hSZXNwb25zZUJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJlc3Vs\ndC5wdWJsaXNoUmVzcG9uc2VfID0gcHVibGlzaFJlc3BvbnNlXzsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0LnB1Ymxpc2hSZXNwb25zZV8g\nPSBwdWJsaXNoUmVzcG9uc2VCdWlsZGVyXy5idWlsZCgpOwogICAgICAgIH0K\nICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9\nPSAweDAwMDAwMDAyKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAw\neDAwMDAwMDAyOwogICAgICAgIH0KICAgICAgICBpZiAoc3Vic2NyaWJlUmVz\ncG9uc2VCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZXN1bHQuc3Vi\nc2NyaWJlUmVzcG9uc2VfID0gc3Vic2NyaWJlUmVzcG9uc2VfOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQuc3Vic2NyaWJlUmVzcG9uc2Vf\nID0gc3Vic2NyaWJlUmVzcG9uc2VCdWlsZGVyXy5idWlsZCgpOwogICAgICAg\nIH0KICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDA0\nKSA9PSAweDAwMDAwMDA0KSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8\nPSAweDAwMDAwMDA0OwogICAgICAgIH0KICAgICAgICBpZiAoc3Vic2NyaXB0\naW9uRXZlbnRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZXN1bHQu\nc3Vic2NyaXB0aW9uRXZlbnRfID0gc3Vic2NyaXB0aW9uRXZlbnRfOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQuc3Vic2NyaXB0aW9uRXZl\nbnRfID0gc3Vic2NyaXB0aW9uRXZlbnRCdWlsZGVyXy5idWlsZCgpOwogICAg\nICAgIH0KICAgICAgICByZXN1bHQuYml0RmllbGQwXyA9IHRvX2JpdEZpZWxk\nMF87CiAgICAgICAgb25CdWlsdCgpOwogICAgICAgIHJldHVybiByZXN1bHQ7\nCiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJv\nbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAg\nICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkpIHsKICAgICAgICAg\nIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9keSlvdGhlcik7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkgb3Ro\nZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5LmdldERlZmF1\nbHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIu\naGFzUHVibGlzaFJlc3BvbnNlKCkpIHsKICAgICAgICAgIG1lcmdlUHVibGlz\naFJlc3BvbnNlKG90aGVyLmdldFB1Ymxpc2hSZXNwb25zZSgpKTsKICAgICAg\nICB9CiAgICAgICAgaWYgKG90aGVyLmhhc1N1YnNjcmliZVJlc3BvbnNlKCkp\nIHsKICAgICAgICAgIG1lcmdlU3Vic2NyaWJlUmVzcG9uc2Uob3RoZXIuZ2V0\nU3Vic2NyaWJlUmVzcG9uc2UoKSk7CiAgICAgICAgfQogICAgICAgIGlmIChv\ndGhlci5oYXNTdWJzY3JpcHRpb25FdmVudCgpKSB7CiAgICAgICAgICBtZXJn\nZVN1YnNjcmlwdGlvbkV2ZW50KG90aGVyLmdldFN1YnNjcmlwdGlvbkV2ZW50\nKCkpOwogICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxk\ncyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgZmluYWwgYm9vbGVh\nbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgIGlmIChoYXNQdWJsaXNoUmVz\ncG9uc2UoKSkgewogICAgICAgICAgaWYgKCFnZXRQdWJsaXNoUmVzcG9uc2Uo\nKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgICAgCiAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1\naWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAg\nICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRy\ndWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAg\nICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAg\nICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVs\nZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsK\nICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1\nbmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAg\nICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxk\nKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxMDog\newogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZS5CdWlsZGVyIHN1YkJ1aWxk\nZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJsaXNoUmVzcG9uc2UubmV3QnVpbGRlcigpOwogICAgICAgICAgICAg\nIGlmIChoYXNQdWJsaXNoUmVzcG9uc2UoKSkgewogICAgICAgICAgICAgICAg\nc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0UHVibGlzaFJlc3BvbnNlKCkpOwog\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2Fn\nZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAg\nICAgc2V0UHVibGlzaFJlc3BvbnNlKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFs\nKCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXNwb25z\nZS5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXNwb25zZS5uZXdCdWls\nZGVyKCk7CiAgICAgICAgICAgICAgaWYgKGhhc1N1YnNjcmliZVJlc3BvbnNl\nKCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdl\ndFN1YnNjcmliZVJlc3BvbnNlKCkpOwogICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNp\nb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0U3Vic2NyaWJlUmVzcG9u\nc2Uoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAyNjogewog\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UuQnVpbGRlciBz\ndWJCdWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZS5uZXdCdWlsZGVy\nKCk7CiAgICAgICAgICAgICAgaWYgKGhhc1N1YnNjcmlwdGlvbkV2ZW50KCkp\nIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdldFN1\nYnNjcmlwdGlvbkV2ZW50KCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25S\nZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0U3Vic2NyaXB0aW9uRXZlbnQo\nc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAg\nIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlB1Ymxpc2hSZXNwb25zZSBw\ndWJsaXNoUmVzcG9uc2UgPSAxOwogICAgICBwcml2YXRlIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25z\nZSBwdWJsaXNoUmVzcG9uc2VfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlLmdldERlZmF1bHRJ\nbnN0YW5jZSgpOwogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYu\nU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlLCBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJs\naXNoUmVzcG9uc2UuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlT3JCdWlsZGVyPiBw\ndWJsaXNoUmVzcG9uc2VCdWlsZGVyXzsKICAgICAgcHVibGljIGJvb2xlYW4g\naGFzUHVibGlzaFJlc3BvbnNlKCkgewogICAgICAgIHJldHVybiAoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgICAgfQog\nICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlIGdldFB1Ymxpc2hSZXNwb25zZSgp\nIHsKICAgICAgICBpZiAocHVibGlzaFJlc3BvbnNlQnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgcmV0dXJuIHB1Ymxpc2hSZXNwb25zZV87CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBwdWJsaXNoUmVzcG9uc2VC\ndWlsZGVyXy5nZXRNZXNzYWdlKCk7CiAgICAgICAgfQogICAgICB9CiAgICAg\nIHB1YmxpYyBCdWlsZGVyIHNldFB1Ymxpc2hSZXNwb25zZShvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVzcG9u\nc2UgdmFsdWUpIHsKICAgICAgICBpZiAocHVibGlzaFJlc3BvbnNlQnVpbGRl\ncl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7\nCiAgICAgICAgICB9CiAgICAgICAgICBwdWJsaXNoUmVzcG9uc2VfID0gdmFs\ndWU7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgcHVibGlzaFJlc3BvbnNlQnVpbGRlcl8uc2V0TWVzc2FnZSh2\nYWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwMTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRQdWJsaXNoUmVzcG9uc2UoCiAgICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNo\nUmVzcG9uc2UuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBp\nZiAocHVibGlzaFJlc3BvbnNlQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgcHVibGlzaFJlc3BvbnNlXyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgp\nOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgIHB1Ymxpc2hSZXNwb25zZUJ1aWxkZXJfLnNldE1lc3NhZ2UoYnVp\nbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VQdWJsaXNoUmVzcG9u\nc2Uob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHVibGlzaFJlc3BvbnNlIHZhbHVlKSB7CiAgICAgICAgaWYgKHB1Ymxpc2hS\nZXNwb25zZUJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGlmICgoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSAmJgogICAg\nICAgICAgICAgIHB1Ymxpc2hSZXNwb25zZV8gIT0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlLmdl\ndERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAgICAgIHB1Ymxpc2hSZXNw\nb25zZV8gPQogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZS5uZXdCdWlsZGVy\nKHB1Ymxpc2hSZXNwb25zZV8pLm1lcmdlRnJvbSh2YWx1ZSkuYnVpbGRQYXJ0\naWFsKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwdWJsaXNo\nUmVzcG9uc2VfID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHVibGlzaFJl\nc3BvbnNlQnVpbGRlcl8ubWVyZ2VGcm9tKHZhbHVlKTsKICAgICAgICB9CiAg\nICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyUHVi\nbGlzaFJlc3BvbnNlKCkgewogICAgICAgIGlmIChwdWJsaXNoUmVzcG9uc2VC\ndWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBwdWJsaXNoUmVzcG9uc2Vf\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHVibGlzaFJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHB1\nYmxpc2hSZXNwb25zZUJ1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAg\nICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlc3BvbnNlLkJ1aWxkZXIgZ2V0UHVibGlzaFJlc3BvbnNlQnVpbGRlcigp\nIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIGdldFB1Ymxpc2hSZXNwb25z\nZUZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXIoKTsKICAgICAgfQogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlc3BvbnNlT3JCdWlsZGVyIGdldFB1Ymxpc2hSZXNwb25z\nZU9yQnVpbGRlcigpIHsKICAgICAgICBpZiAocHVibGlzaFJlc3BvbnNlQnVp\nbGRlcl8gIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHB1Ymxpc2hSZXNw\nb25zZUJ1aWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgcmV0dXJuIHB1Ymxpc2hSZXNwb25zZV87CiAg\nICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90\nb2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVzcG9u\nc2UsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1Ymxpc2hSZXNwb25zZS5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVzcG9uc2VPckJ1aWxk\nZXI+IAogICAgICAgICAgZ2V0UHVibGlzaFJlc3BvbnNlRmllbGRCdWlsZGVy\nKCkgewogICAgICAgIGlmIChwdWJsaXNoUmVzcG9uc2VCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBwdWJsaXNoUmVzcG9uc2VCdWlsZGVyXyA9IG5l\ndyBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJsaXNoUmVzcG9uc2UsIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZS5CdWlsZGVy\nLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJsaXNoUmVzcG9uc2VPckJ1aWxkZXI+KAogICAgICAgICAgICAgICAgICBw\ndWJsaXNoUmVzcG9uc2VfLAogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRG\nb3JDaGlsZHJlbigpLAogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOwog\nICAgICAgICAgcHVibGlzaFJlc3BvbnNlXyA9IG51bGw7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBwdWJsaXNoUmVzcG9uc2VCdWlsZGVyXzsKICAgICAg\nfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5TdWJzY3JpYmVS\nZXNwb25zZSBzdWJzY3JpYmVSZXNwb25zZSA9IDI7CiAgICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaWJlUmVzcG9uc2Ugc3Vic2NyaWJlUmVzcG9uc2VfID0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVz\ncG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIHByaXZhdGUgY29t\nLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXNwb25zZSwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2UuQnVpbGRlciwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naWJlUmVzcG9uc2VPckJ1aWxkZXI+IHN1YnNjcmliZVJlc3BvbnNlQnVpbGRl\ncl87CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZVJlc3BvbnNl\nKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAy\nKSA9PSAweDAwMDAwMDAyKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVzcG9uc2UgZ2V0U3Vic2NyaWJlUmVzcG9uc2UoKSB7CiAgICAgICAgaWYg\nKHN1YnNjcmliZVJlc3BvbnNlQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgcmV0dXJuIHN1YnNjcmliZVJlc3BvbnNlXzsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmV0dXJuIHN1YnNjcmliZVJlc3BvbnNlQnVpbGRlcl8u\nZ2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRTdWJzY3JpYmVSZXNwb25zZShvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXNwb25zZSB2\nYWx1ZSkgewogICAgICAgIGlmIChzdWJzY3JpYmVSZXNwb25zZUJ1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwog\nICAgICAgICAgfQogICAgICAgICAgc3Vic2NyaWJlUmVzcG9uc2VfID0gdmFs\ndWU7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgc3Vic2NyaWJlUmVzcG9uc2VCdWlsZGVyXy5zZXRNZXNzYWdl\nKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAw\nMDAwMDAyOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIHNldFN1YnNjcmliZVJlc3BvbnNlKAogICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaWJlUmVzcG9uc2UuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAg\nICAgICBpZiAoc3Vic2NyaWJlUmVzcG9uc2VCdWlsZGVyXyA9PSBudWxsKSB7\nCiAgICAgICAgICBzdWJzY3JpYmVSZXNwb25zZV8gPSBidWlsZGVyRm9yVmFs\ndWUuYnVpbGQoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICBzdWJzY3JpYmVSZXNwb25zZUJ1aWxkZXJfLnNl\ndE1lc3NhZ2UoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0K\nICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VT\ndWJzY3JpYmVSZXNwb25zZShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXNwb25zZSB2YWx1ZSkgewogICAg\nICAgIGlmIChzdWJzY3JpYmVSZXNwb25zZUJ1aWxkZXJfID09IG51bGwpIHsK\nICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAw\neDAwMDAwMDAyKSAmJgogICAgICAgICAgICAgIHN1YnNjcmliZVJlc3BvbnNl\nXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpYmVSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewog\nICAgICAgICAgICBzdWJzY3JpYmVSZXNwb25zZV8gPQogICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmliZVJlc3BvbnNlLm5ld0J1aWxkZXIoc3Vic2NyaWJlUmVzcG9uc2Vf\nKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgc3Vic2NyaWJlUmVzcG9uc2VfID0gdmFs\ndWU7CiAgICAgICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgc3Vic2NyaWJlUmVzcG9uc2VCdWlsZGVy\nXy5tZXJnZUZyb20odmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVSZXNwb25z\nZSgpIHsKICAgICAgICBpZiAoc3Vic2NyaWJlUmVzcG9uc2VCdWlsZGVyXyA9\nPSBudWxsKSB7CiAgICAgICAgICBzdWJzY3JpYmVSZXNwb25zZV8gPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\nYmVSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgIG9u\nQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdWJzY3Jp\nYmVSZXNwb25zZUJ1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAg\nIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVzcG9uc2UuQnVpbGRlciBnZXRTdWJzY3JpYmVSZXNwb25zZUJ1aWxkZXIo\nKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwogICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiBnZXRTdWJzY3JpYmVSZXNw\nb25zZUZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXIoKTsKICAgICAgfQogICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaWJlUmVzcG9uc2VPckJ1aWxkZXIgZ2V0U3Vic2NyaWJl\nUmVzcG9uc2VPckJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKHN1YnNjcmliZVJl\nc3BvbnNlQnVpbGRlcl8gIT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHN1\nYnNjcmliZVJlc3BvbnNlQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gc3Vic2NyaWJl\nUmVzcG9uc2VfOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIGNv\nbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVzcG9uc2UsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3BvbnNlLkJ1aWxkZXIsIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmliZVJlc3BvbnNlT3JCdWlsZGVyPiAKICAgICAgICAgIGdldFN1YnNjcmli\nZVJlc3BvbnNlRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmIChzdWJzY3Jp\nYmVSZXNwb25zZUJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHN1YnNj\ncmliZVJlc3BvbnNlQnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1\nZi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVz\ncG9uc2UsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmliZVJlc3BvbnNlLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlc3BvbnNl\nT3JCdWlsZGVyPigKICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlUmVzcG9u\nc2VfLAogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigp\nLAogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAgICAgICAgc3Vi\nc2NyaWJlUmVzcG9uc2VfID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHN1YnNjcmliZVJlc3BvbnNlQnVpbGRlcl87CiAgICAgIH0KICAgICAg\nCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2NyaXB0aW9uRXZlbnRS\nZXNwb25zZSBzdWJzY3JpcHRpb25FdmVudCA9IDM7CiAgICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uRXZlbnRSZXNwb25zZSBzdWJzY3JpcHRpb25FdmVudF8gPSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25FdmVudFJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpOwog\nICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRC\ndWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZSwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naXB0aW9uRXZlbnRSZXNwb25zZS5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJl\nc3BvbnNlT3JCdWlsZGVyPiBzdWJzY3JpcHRpb25FdmVudEJ1aWxkZXJfOwog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpcHRpb25FdmVudCgpIHsK\nICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0g\nMHgwMDAwMDAwNCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2\nZW50UmVzcG9uc2UgZ2V0U3Vic2NyaXB0aW9uRXZlbnQoKSB7CiAgICAgICAg\naWYgKHN1YnNjcmlwdGlvbkV2ZW50QnVpbGRlcl8gPT0gbnVsbCkgewogICAg\nICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbkV2ZW50XzsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbkV2ZW50QnVpbGRl\ncl8uZ2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRTdWJzY3JpcHRpb25FdmVudChvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVu\ndFJlc3BvbnNlIHZhbHVlKSB7CiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbkV2\nZW50QnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZhbHVlID09\nIG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBzdWJzY3JpcHRpb25F\ndmVudF8gPSB2YWx1ZTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICBzdWJzY3JpcHRpb25FdmVudEJ1aWxkZXJf\nLnNldE1lc3NhZ2UodmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVs\nZDBfIHw9IDB4MDAwMDAwMDQ7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3Vic2NyaXB0aW9uRXZlbnQo\nCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlLkJ1aWxkZXIgYnVp\nbGRlckZvclZhbHVlKSB7CiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbkV2ZW50\nQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgc3Vic2NyaXB0aW9uRXZl\nbnRfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgICBvbkNo\nYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3Vic2NyaXB0\naW9uRXZlbnRCdWlsZGVyXy5zZXRNZXNzYWdlKGJ1aWxkZXJGb3JWYWx1ZS5i\ndWlsZCgpKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAw\nMDAwMDA0OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlU3Vic2NyaXB0aW9uRXZlbnQob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nRXZlbnRSZXNwb25zZSB2YWx1ZSkgewogICAgICAgIGlmIChzdWJzY3JpcHRp\nb25FdmVudEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGlmICgoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDA0KSA9PSAweDAwMDAwMDA0KSAmJgogICAg\nICAgICAgICAgIHN1YnNjcmlwdGlvbkV2ZW50XyAhPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVu\ndFJlc3BvbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAgICAg\nIHN1YnNjcmlwdGlvbkV2ZW50XyA9CiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nRXZlbnRSZXNwb25zZS5uZXdCdWlsZGVyKHN1YnNjcmlwdGlvbkV2ZW50Xyku\nbWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIHN1YnNjcmlwdGlvbkV2ZW50XyA9IHZhbHVl\nOwogICAgICAgICAgfQogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgIHN1YnNjcmlwdGlvbkV2ZW50QnVpbGRlcl8u\nbWVyZ2VGcm9tKHZhbHVlKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQw\nXyB8PSAweDAwMDAwMDA0OwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3Vic2NyaXB0aW9uRXZlbnQo\nKSB7CiAgICAgICAgaWYgKHN1YnNjcmlwdGlvbkV2ZW50QnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgc3Vic2NyaXB0aW9uRXZlbnRfID0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uRXZlbnRSZXNwb25zZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBz\ndWJzY3JpcHRpb25FdmVudEJ1aWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQog\nICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA0\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uRXZlbnRSZXNwb25zZS5CdWlsZGVyIGdldFN1YnNjcmlwdGlv\nbkV2ZW50QnVpbGRlcigpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDQ7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIGdl\ndFN1YnNjcmlwdGlvbkV2ZW50RmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigp\nOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNl\nT3JCdWlsZGVyIGdldFN1YnNjcmlwdGlvbkV2ZW50T3JCdWlsZGVyKCkgewog\nICAgICAgIGlmIChzdWJzY3JpcHRpb25FdmVudEJ1aWxkZXJfICE9IG51bGwp\nIHsKICAgICAgICAgIHJldHVybiBzdWJzY3JpcHRpb25FdmVudEJ1aWxkZXJf\nLmdldE1lc3NhZ2VPckJ1aWxkZXIoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbkV2ZW50XzsKICAgICAgICB9CiAg\nICAgIH0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmds\nZUZpZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9u\nc2UsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UuQnVpbGRlciwgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nRXZlbnRSZXNwb25zZU9yQnVpbGRlcj4gCiAgICAgICAgICBnZXRTdWJzY3Jp\ncHRpb25FdmVudEZpZWxkQnVpbGRlcigpIHsKICAgICAgICBpZiAoc3Vic2Ny\naXB0aW9uRXZlbnRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBzdWJz\nY3JpcHRpb25FdmVudEJ1aWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9i\ndWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nbkV2ZW50UmVzcG9uc2UsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UuQnVpbGRl\nciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZU9yQnVpbGRlcj4oCiAgICAgICAg\nICAgICAgICAgIHN1YnNjcmlwdGlvbkV2ZW50XywKICAgICAgICAgICAgICAg\nICAgZ2V0UGFyZW50Rm9yQ2hpbGRyZW4oKSwKICAgICAgICAgICAgICAgICAg\naXNDbGVhbigpKTsKICAgICAgICAgIHN1YnNjcmlwdGlvbkV2ZW50XyA9IG51\nbGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdWJzY3JpcHRpb25FdmVu\ndEJ1aWxkZXJfOwogICAgICB9CiAgICAgIAogICAgICAvLyBAQHByb3RvY19p\nbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3aWcuUmVzcG9uc2VC\nb2R5KQogICAgfQogICAgCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5z\ndGFuY2UgPSBuZXcgUmVzcG9uc2VCb2R5KHRydWUpOwogICAgICBkZWZhdWx0\nSW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAgICAvLyBAQHBy\nb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlJlc3Bv\nbnNlQm9keSkKICB9CiAgCiAgcHVibGljIGludGVyZmFjZSBTdWJzY3JpcHRp\nb25TdGF0ZU9yQnVpbGRlcgogICAgICBleHRlbmRzIGNvbS5nb29nbGUucHJv\ndG9idWYuTWVzc2FnZU9yQnVpbGRlciB7CiAgICAKICAgIC8vIHJlcXVpcmVk\nIC5IZWR3aWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMTsKICAgIGJvb2xlYW4g\naGFzTXNnSWQoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRNc2dJZCgpOwogICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkT3JCdWlsZGVyIGdldE1zZ0lkT3JCdWlsZGVyKCk7CiAgICAKICAg\nIC8vIG9wdGlvbmFsIHVpbnQzMiBtZXNzYWdlQm91bmQgPSAyOwogICAgYm9v\nbGVhbiBoYXNNZXNzYWdlQm91bmQoKTsKICAgIGludCBnZXRNZXNzYWdlQm91\nbmQoKTsKICB9CiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBTdWJzY3Jp\ncHRpb25TdGF0ZSBleHRlbmRzCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZQogICAgICBpbXBsZW1lbnRzIFN1YnNjcmlwdGlv\nblN0YXRlT3JCdWlsZGVyIHsKICAgIC8vIFVzZSBTdWJzY3JpcHRpb25TdGF0\nZS5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJpdmF0ZSBTdWJz\nY3JpcHRpb25TdGF0ZShCdWlsZGVyIGJ1aWxkZXIpIHsKICAgICAgc3VwZXIo\nYnVpbGRlcik7CiAgICB9CiAgICBwcml2YXRlIFN1YnNjcmlwdGlvblN0YXRl\nKGJvb2xlYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBTdWJzY3JpcHRpb25TdGF0ZSBkZWZhdWx0SW5zdGFuY2U7CiAgICBw\ndWJsaWMgc3RhdGljIFN1YnNjcmlwdGlvblN0YXRlIGdldERlZmF1bHRJbnN0\nYW5jZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0K\nICAgIAogICAgcHVibGljIFN1YnNjcmlwdGlvblN0YXRlIGdldERlZmF1bHRJ\nbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFu\nY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19I\nZWR3aWdfU3Vic2NyaXB0aW9uU3RhdGVfZGVzY3JpcHRvcjsKICAgIH0KICAg\nIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdl\ndEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0\nYXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uU3RhdGVfZmllbGRBY2Nlc3NvclRh\nYmxlOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBiaXRGaWVsZDBfOwog\nICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5NZXNzYWdlU2VxSWQgbXNnSWQgPSAx\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTVNHSURfRklFTERfTlVN\nQkVSID0gMTsKICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIG1zZ0lkXzsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc01zZ0lkKCkgewogICAgICByZXR1cm4gKChiaXRG\naWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICB9CiAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkIGdldE1zZ0lkKCkgewogICAgICByZXR1cm4g\nbXNnSWRfOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlciBn\nZXRNc2dJZE9yQnVpbGRlcigpIHsKICAgICAgcmV0dXJuIG1zZ0lkXzsKICAg\nIH0KICAgIAogICAgLy8gb3B0aW9uYWwgdWludDMyIG1lc3NhZ2VCb3VuZCA9\nIDI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdFQk9VTkRf\nRklFTERfTlVNQkVSID0gMjsKICAgIHByaXZhdGUgaW50IG1lc3NhZ2VCb3Vu\nZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNNZXNzYWdlQm91bmQoKSB7CiAg\nICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAw\nMDAwMDAyKTsKICAgIH0KICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZUJvdW5k\nKCkgewogICAgICByZXR1cm4gbWVzc2FnZUJvdW5kXzsKICAgIH0KICAgIAog\nICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIG1zZ0lkXyA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgbWVzc2Fn\nZUJvdW5kXyA9IDA7CiAgICB9CiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJ\nc0luaXRpYWxpemVkID0gLTE7CiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBp\nc0luaXRpYWxpemVkKCkgewogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBt\nZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgIGlmIChpc0luaXRpYWxpemVk\nICE9IC0xKSByZXR1cm4gaXNJbml0aWFsaXplZCA9PSAxOwogICAgICAKICAg\nICAgaWYgKCFoYXNNc2dJZCgpKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRp\nYWxpemVkID0gMDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAg\nICAgaWYgKCFnZXRNc2dJZCgpLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAg\nIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICB9CiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7\nCiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9p\nZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJl\nYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6ZWRTaXplKCk7\nCiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAw\nMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMSwgbXNn\nSWRfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAw\nMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBvdXRwdXQud3JpdGVV\nSW50MzIoMiwgbWVzc2FnZUJvdW5kXyk7CiAgICAgIH0KICAgICAgZ2V0VW5r\nbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAg\ncHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAg\ncHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNp\nemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAh\nPSAtMSkgcmV0dXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAg\nIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAx\nKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSgx\nLCBtc2dJZF8pOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAw\neDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAgIHNpemUgKz0g\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAg\nICAgLmNvbXB1dGVVSW50MzJTaXplKDIsIG1lc3NhZ2VCb3VuZF8pOwogICAg\nICB9CiAgICAgIHNpemUgKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlh\nbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBz\naXplOwogICAgICByZXR1cm4gc2l6ZTsKICAgIH0KICAgIAogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7CiAg\nICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgamF2YS5sYW5n\nLk9iamVjdCB3cml0ZVJlcGxhY2UoKQogICAgICAgIHRocm93cyBqYXZhLmlv\nLk9iamVjdFN0cmVhbUV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBzdXBlci53\ncml0ZVJlcGxhY2UoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25TdGF0ZSBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSku\nYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uU3RhdGUgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uU3RhdGUgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAg\nICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2Nv\nbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlIHBhcnNlRnJvbSgKICAgICAgICBi\neXRlW10gZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVu\nc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0\naHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZm\nZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAg\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblN0YXRlIHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0\nKQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRl\nIHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0\nLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uU3RhdGUgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7\nCiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkp\nIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAg\nICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlIHBhcnNlRGVsaW1p\ndGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlM\naXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVp\nbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20o\naW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBi\ndWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uU3RhdGUgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBwYXJzZUZyb20oCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlu\ncHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7IHJldHVybiBCdWlsZGVy\nLmNyZWF0ZSgpOyB9CiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9y\nVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQogICAgcHVibGljIHN0\nYXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgcHJvdG90\neXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHBy\nb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIo\nKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIEBqYXZh\nLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBCdWlsZGVyIG5ld0J1aWxk\nZXJGb3JUeXBlKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICBCdWls\nZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQpOwogICAgICByZXR1\ncm4gYnVpbGRlcjsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xh\nc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4KICAgICAgIGlt\ncGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uU3RhdGVPckJ1aWxkZXIgewogICAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRv\ncnMuRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAg\nICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25T\ndGF0ZV9kZXNjcmlwdG9yOwogICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0\nZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vz\nc29yVGFibGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3\naWdfU3Vic2NyaXB0aW9uU3RhdGVfZmllbGRBY2Nlc3NvclRhYmxlOwogICAg\nICB9CiAgICAgIAogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nU3RhdGUubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHsK\nICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRlcihCdWlsZGVyUGFy\nZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVudCk7CiAgICAgICAg\nbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAg\nICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycykgewogICAgICAg\nICAgZ2V0TXNnSWRGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFy\nKCk7CiAgICAgICAgaWYgKG1zZ0lkQnVpbGRlcl8gPT0gbnVsbCkgewogICAg\nICAgICAgbXNnSWRfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5jZSgp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtc2dJZEJ1aWxkZXJfLmNs\nZWFyKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0Rmll\nbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBtZXNzYWdlQm91bmRfID0g\nMDsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAw\nMDAwMik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBj\ncmVhdGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlw\ndG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlw\nZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUuZ2V0RGVzY3Jp\ncHRvcigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nU3RhdGUgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uU3RhdGUuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBidWls\nZCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSByZXN1bHQgPSBidWlsZFBh\ncnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkp\nIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhj\nZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1\nbHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3Rh\ndGUgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25TdGF0ZSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsK\nICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAg\nICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAog\nICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBidWls\nZFBhcnRpYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgcmVzdWx0ID0g\nbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvblN0YXRlKHRoaXMpOwogICAgICAgIGludCBmcm9tX2Jp\ndEZpZWxkMF8gPSBiaXRGaWVsZDBfOwogICAgICAgIGludCB0b19iaXRGaWVs\nZDBfID0gMDsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAw\nMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAgICAgICAgdG9fYml0Rmll\nbGQwXyB8PSAweDAwMDAwMDAxOwogICAgICAgIH0KICAgICAgICBpZiAobXNn\nSWRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByZXN1bHQubXNnSWRf\nID0gbXNnSWRfOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQu\nbXNnSWRfID0gbXNnSWRCdWlsZGVyXy5idWlsZCgpOwogICAgICAgIH0KICAg\nICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAw\neDAwMDAwMDAyKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAw\nMDAwMDAyOwogICAgICAgIH0KICAgICAgICByZXN1bHQubWVzc2FnZUJvdW5k\nXyA9IG1lc3NhZ2VCb3VuZF87CiAgICAgICAgcmVzdWx0LmJpdEZpZWxkMF8g\nPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQoKTsKICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVp\nbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90\naGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nU3RhdGUpIHsKICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nblN0YXRlKW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3Vw\nZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIg\nbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlIG90aGVyKSB7CiAgICAgICAgaWYg\nKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlLmdldERlZmF1bHRJbnN0YW5jZSgp\nKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIuaGFzTXNnSWQoKSkg\newogICAgICAgICAgbWVyZ2VNc2dJZChvdGhlci5nZXRNc2dJZCgpKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc01lc3NhZ2VCb3VuZCgpKSB7\nCiAgICAgICAgICBzZXRNZXNzYWdlQm91bmQob3RoZXIuZ2V0TWVzc2FnZUJv\ndW5kKCkpOwogICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZp\nZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgZmluYWwgYm9v\nbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgIGlmICghaGFzTXNnSWQo\nKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQogICAgICAgIGlmICghZ2V0TXNnSWQoKS5pc0luaXRpYWxpemVkKCkp\nIHsKICAgICAgICAgIAogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3du\nRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIo\nCiAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAg\nICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJl\nYWRUYWcoKTsKICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAg\nIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHMo\ndW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICBvbkNoYW5n\nZWQoKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nZGVmYXVsdDogewogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmll\nbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewog\nICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25G\naWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBjYXNlIDEwOiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxkZXIg\nc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCk7CiAgICAgICAg\nICAgICAgaWYgKGhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1\naWxkZXIubWVyZ2VGcm9tKGdldE1zZ0lkKCkpOwogICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBl\neHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0TXNnSWQoc3Vi\nQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxNjogewogICAgICAg\nICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICAgICAg\nICBtZXNzYWdlQm91bmRfID0gaW5wdXQucmVhZFVJbnQzMigpOwogICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBiaXRGaWVs\nZDBfOwogICAgICAKICAgICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5NZXNzYWdl\nU2VxSWQgbXNnSWQgPSAxOwogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBtc2dJ\nZF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIHBy\naXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8\nCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlU2VxSWQsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5CdWlsZGVyLCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWRPckJ1aWxkZXI+IG1zZ0lkQnVpbGRlcl87CiAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc01zZ0lkKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgICAgfQogICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkIGdldE1zZ0lkKCkgewogICAgICAgIGlmICht\nc2dJZEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHJldHVybiBtc2dJ\nZF87CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiBtc2dJZEJ1\naWxkZXJfLmdldE1lc3NhZ2UoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgc2V0TXNnSWQob3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHZhbHVlKSB7CiAg\nICAgICAgaWYgKG1zZ0lkQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\naWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51\nbGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBt\nc2dJZF8gPSB2YWx1ZTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICBtc2dJZEJ1aWxkZXJfLnNldE1lc3NhZ2Uo\ndmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgc2V0TXNnSWQoCiAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVp\nbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAobXNnSWRCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBtc2dJZF8gPSBidWlsZGVyRm9y\nVmFsdWUuYnVpbGQoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICBtc2dJZEJ1aWxkZXJfLnNldE1lc3NhZ2Uo\nYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBi\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VNc2dJZChvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQgdmFsdWUpIHsKICAgICAgICBpZiAobXNnSWRCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAw\nMSkgPT0gMHgwMDAwMDAwMSkgJiYKICAgICAgICAgICAgICBtc2dJZF8gIT0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAgICAg\nIG1zZ0lkXyA9CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIo\nbXNnSWRfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbXNnSWRfID0gdmFsdWU7CiAg\nICAgICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgbXNnSWRCdWlsZGVyXy5tZXJnZUZyb20odmFsdWUp\nOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgY2xlYXJNc2dJZCgpIHsKICAgICAgICBpZiAobXNnSWRCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBtc2dJZF8gPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgbXNnSWRCdWlsZGVyXy5jbGVhcigp\nOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8g\nJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZC5CdWlsZGVyIGdldE1zZ0lkQnVpbGRl\ncigpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIGdldE1zZ0lkRmllbGRC\ndWlsZGVyKCkuZ2V0QnVpbGRlcigpOwogICAgICB9CiAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlU2VxSWRPckJ1aWxkZXIgZ2V0TXNnSWRPckJ1aWxkZXIoKSB7CiAgICAg\nICAgaWYgKG1zZ0lkQnVpbGRlcl8gIT0gbnVsbCkgewogICAgICAgICAgcmV0\ndXJuIG1zZ0lkQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlcigpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gbXNnSWRfOwogICAgICAg\nIH0KICAgICAgfQogICAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYu\nU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkT3JCdWlsZGVyPiAKICAgICAgICAg\nIGdldE1zZ0lkRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmIChtc2dJZEJ1\naWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIG1zZ0lkQnVpbGRlcl8gPSBu\nZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZVNlcUlkLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRlciwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkT3JCdWlsZGVyPigKICAgICAgICAgICAgICAgICAgbXNnSWRfLAog\nICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLAogICAg\nICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAgICAgICAgbXNnSWRfID0g\nbnVsbDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1zZ0lkQnVpbGRlcl87\nCiAgICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIHVpbnQzMiBtZXNz\nYWdlQm91bmQgPSAyOwogICAgICBwcml2YXRlIGludCBtZXNzYWdlQm91bmRf\nIDsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzTWVzc2FnZUJvdW5kKCkgewog\nICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAw\neDAwMDAwMDAyKTsKICAgICAgfQogICAgICBwdWJsaWMgaW50IGdldE1lc3Nh\nZ2VCb3VuZCgpIHsKICAgICAgICByZXR1cm4gbWVzc2FnZUJvdW5kXzsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNZXNzYWdlQm91bmQoaW50\nIHZhbHVlKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwog\nICAgICAgIG1lc3NhZ2VCb3VuZF8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5n\nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhck1lc3NhZ2VCb3VuZCgpIHsKICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAg\nbWVzc2FnZUJvdW5kXyA9IDA7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIEBAcHJv\ndG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOkhlZHdpZy5TdWJz\nY3JpcHRpb25TdGF0ZSkKICAgIH0KICAgIAogICAgc3RhdGljIHsKICAgICAg\nZGVmYXVsdEluc3RhbmNlID0gbmV3IFN1YnNjcmlwdGlvblN0YXRlKHRydWUp\nOwogICAgICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQog\nICAgCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2Nv\ncGU6SGVkd2lnLlN1YnNjcmlwdGlvblN0YXRlKQogIH0KICAKICBwdWJsaWMg\naW50ZXJmYWNlIFN1YnNjcmlwdGlvbkRhdGFPckJ1aWxkZXIKICAgICAgZXh0\nZW5kcyBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VPckJ1aWxkZXIgewog\nICAgCiAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmlwdGlvblN0YXRl\nIHN0YXRlID0gMTsKICAgIGJvb2xlYW4gaGFzU3RhdGUoKTsKICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblN0YXRlIGdldFN0YXRlKCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZU9yQnVp\nbGRlciBnZXRTdGF0ZU9yQnVpbGRlcigpOwogICAgCiAgICAvLyBvcHRpb25h\nbCAuSGVkd2lnLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHByZWZlcmVuY2Vz\nID0gMjsKICAgIGJvb2xlYW4gaGFzUHJlZmVyZW5jZXMoKTsKICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblByZWZlcmVuY2VzIGdldFByZWZlcmVuY2VzKCk7CiAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25QcmVmZXJlbmNlc09yQnVpbGRlciBnZXRQcmVmZXJlbmNlc09yQnVpbGRl\ncigpOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFN1YnNjcmlw\ndGlvbkRhdGEgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdl\nbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVtZW50cyBTdWJzY3JpcHRpb25E\nYXRhT3JCdWlsZGVyIHsKICAgIC8vIFVzZSBTdWJzY3JpcHRpb25EYXRhLm5l\nd0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIFN1YnNjcmlw\ndGlvbkRhdGEoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxk\nZXIpOwogICAgfQogICAgcHJpdmF0ZSBTdWJzY3JpcHRpb25EYXRhKGJvb2xl\nYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndWJzY3JpcHRpb25EYXRhIGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBz\ndGF0aWMgU3Vic2NyaXB0aW9uRGF0YSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7\nCiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAg\nIHB1YmxpYyBTdWJzY3JpcHRpb25EYXRhIGdldERlZmF1bHRJbnN0YW5jZUZv\nclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90\nb2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3Jp\ncHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vi\nc2NyaXB0aW9uRGF0YV9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90\nZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nl\nc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19TdWJzY3JpcHRpb25EYXRhX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0K\nICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgIC8vIG9wdGlv\nbmFsIC5IZWR3aWcuU3Vic2NyaXB0aW9uU3RhdGUgc3RhdGUgPSAxOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RBVEVfRklFTERfTlVNQkVSID0g\nMTsKICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgc3RhdGVfOwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzU3RhdGUoKSB7CiAgICAgIHJldHVybiAoKGJpdEZp\nZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgIH0KICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBnZXRTdGF0ZSgpIHsKICAgICAgcmV0\ndXJuIHN0YXRlXzsKICAgIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZU9y\nQnVpbGRlciBnZXRTdGF0ZU9yQnVpbGRlcigpIHsKICAgICAgcmV0dXJuIHN0\nYXRlXzsKICAgIH0KICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5TdWJz\nY3JpcHRpb25QcmVmZXJlbmNlcyBwcmVmZXJlbmNlcyA9IDI7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBQUkVGRVJFTkNFU19GSUVMRF9OVU1CRVIg\nPSAyOwogICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBwcmVmZXJl\nbmNlc187CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNQcmVmZXJlbmNlcygpIHsK\nICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4\nMDAwMDAwMDIpOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVu\nY2VzIGdldFByZWZlcmVuY2VzKCkgewogICAgICByZXR1cm4gcHJlZmVyZW5j\nZXNfOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzT3JC\ndWlsZGVyIGdldFByZWZlcmVuY2VzT3JCdWlsZGVyKCkgewogICAgICByZXR1\ncm4gcHJlZmVyZW5jZXNfOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQg\naW5pdEZpZWxkcygpIHsKICAgICAgc3RhdGVfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUu\nZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIHByZWZlcmVuY2VzXyA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblByZWZlcmVuY2VzLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAg\nfQogICAgcHJpdmF0ZSBieXRlIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IC0x\nOwogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsK\nICAgICAgYnl0ZSBpc0luaXRpYWxpemVkID0gbWVtb2l6ZWRJc0luaXRpYWxp\nemVkOwogICAgICBpZiAoaXNJbml0aWFsaXplZCAhPSAtMSkgcmV0dXJuIGlz\nSW5pdGlhbGl6ZWQgPT0gMTsKICAgICAgCiAgICAgIGlmIChoYXNTdGF0ZSgp\nKSB7CiAgICAgICAgaWYgKCFnZXRTdGF0ZSgpLmlzSW5pdGlhbGl6ZWQoKSkg\newogICAgICAgICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMDsKICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbWVt\nb2l6ZWRJc0luaXRpYWxpemVkID0gMTsKICAgICAgcmV0dXJuIHRydWU7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAg\nICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgaWYgKCgoYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgb3V0\ncHV0LndyaXRlTWVzc2FnZSgxLCBzdGF0ZV8pOwogICAgICB9CiAgICAgIGlm\nICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkg\newogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMiwgcHJlZmVyZW5jZXNf\nKTsKICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhv\ndXRwdXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBtZW1vaXplZFNl\ncmlhbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6\nZWRTaXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXpl\nZFNpemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKICAg\nIAogICAgICBzaXplID0gMDsKICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgc2l6ZSArPSBj\nb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAg\nICAuY29tcHV0ZU1lc3NhZ2VTaXplKDEsIHN0YXRlXyk7CiAgICAgIH0KICAg\nICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAw\nMDIpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXpl\nKDIsIHByZWZlcmVuY2VzXyk7CiAgICAgIH0KICAgICAgc2l6ZSArPSBnZXRV\nbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgbWVt\nb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgIHJldHVybiBzaXpl\nOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNl\ncmlhbFZlcnNpb25VSUQgPSAwTDsKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCBqYXZhLmxhbmcuT2JqZWN0IHdyaXRlUmVwbGFjZSgp\nCiAgICAgICAgdGhyb3dzIGphdmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIHN1cGVyLndyaXRlUmVwbGFjZSgpOwogICAgfQog\nICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGEgcGFyc2VGcm9t\nKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRh\nKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGEgcGFyc2VGcm9tKAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhLAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRGF0YSBwYXJzZUZy\nb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJz\nZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRGF0YSBw\nYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25EYXRhIHBhcnNlRnJvbShqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvbkRhdGEgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8u\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25EYXRhIHBhcnNlRGVsaW1pdGVk\nRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVy\nID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGlt\naXRlZEZyb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVp\nbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25E\nYXRhIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0\nZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBi\ndWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJn\nZURlbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewog\nICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0g\nZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAg\nIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRGF0YSBwYXJzZUZyb20oCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0\nKQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGEg\ncGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJ\nbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgeyBy\nZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxkZXIg\nbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0K\nICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nbkRhdGEgcHJvdG90eXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRl\nciB0b0J1aWxkZXIoKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAg\nICAKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBCdWls\nZGVyIG5ld0J1aWxkZXJGb3JUeXBlKAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyUGFyZW50IHBhcmVudCkg\newogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcihwYXJlbnQp\nOwogICAgICByZXR1cm4gYnVpbGRlcjsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRl\ncj4KICAgICAgIGltcGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRGF0YU9yQnVpbGRlciB7\nCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlw\ndG9yKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1\nYnNjcmlwdGlvbkRhdGFfZGVzY3JpcHRvcjsKICAgICAgfQogICAgICAKICAg\nICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAgIGludGVybmFsR2V0\nRmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvbkRhdGFfZmllbGRBY2Nlc3NvclRh\nYmxlOwogICAgICB9CiAgICAgIAogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uRGF0YS5uZXdCdWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWls\nZGVyKCkgewogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRp\nb24oKTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBCdWlsZGVyKEJ1\naWxkZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgICAgc3VwZXIocGFyZW50KTsK\nICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAg\nICAgIH0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5p\ndGlhbGl6YXRpb24oKSB7CiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZS5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7\nCiAgICAgICAgICBnZXRTdGF0ZUZpZWxkQnVpbGRlcigpOwogICAgICAgICAg\nZ2V0UHJlZmVyZW5jZXNGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9CiAgICAg\nIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAg\nICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNs\nZWFyKCk7CiAgICAgICAgaWYgKHN0YXRlQnVpbGRlcl8gPT0gbnVsbCkgewog\nICAgICAgICAgc3RhdGVfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUuZ2V0RGVmYXVsdElu\nc3RhbmNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXRlQnVp\nbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyA9\nIChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgIGlmIChwcmVm\nZXJlbmNlc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHByZWZlcmVu\nY2VzXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzLmdldERlZmF1bHRJbnN0YW5j\nZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwcmVmZXJlbmNlc0J1\naWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8g\nPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xv\nbmUoKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShidWls\nZFBhcnRpYWwoKSk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAg\nICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25EYXRhLmdldERlc2NyaXB0b3IoKTsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGEgZ2V0RGVmYXVsdEluc3RhbmNl\nRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRGF0YS5nZXRE\nZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvbkRhdGEgYnVpbGQoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRGF0\nYSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3Vs\ndC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5p\ndGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHBy\naXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uRGF0YSBidWlsZFBhcnNlZCgpCiAgICAgICAgICB0\naHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZm\nZXJFeGNlcHRpb24gewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGEgcmVzdWx0ID0g\nYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFs\naXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVz\nc2FnZUV4Y2VwdGlvbigKICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naXB0aW9uRGF0YSBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nRGF0YSByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uRGF0YSh0aGlzKTsKICAgICAg\nICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsKICAgICAgICBp\nbnQgdG9fYml0RmllbGQwXyA9IDA7CiAgICAgICAgaWYgKCgoZnJvbV9iaXRG\naWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAg\nICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICB9CiAg\nICAgICAgaWYgKHN0YXRlQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\ncmVzdWx0LnN0YXRlXyA9IHN0YXRlXzsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgcmVzdWx0LnN0YXRlXyA9IHN0YXRlQnVpbGRlcl8uYnVpbGQoKTsK\nICAgICAgICB9CiAgICAgICAgaWYgKCgoZnJvbV9iaXRGaWVsZDBfICYgMHgw\nMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICAgIHRvX2JpdEZp\nZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICB9CiAgICAgICAgaWYgKHBy\nZWZlcmVuY2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgcmVzdWx0\nLnByZWZlcmVuY2VzXyA9IHByZWZlcmVuY2VzXzsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmVzdWx0LnByZWZlcmVuY2VzXyA9IHByZWZlcmVuY2Vz\nQnVpbGRlcl8uYnVpbGQoKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0LmJp\ndEZpZWxkMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQoKTsK\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5N\nZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Yg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uRGF0YSkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgo\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uRGF0YSlvdGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25EYXRhIG90aGVyKSB7CiAgICAg\nICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGEuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlmIChvdGhlci5oYXNTdGF0\nZSgpKSB7CiAgICAgICAgICBtZXJnZVN0YXRlKG90aGVyLmdldFN0YXRlKCkp\nOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzUHJlZmVyZW5jZXMo\nKSkgewogICAgICAgICAgbWVyZ2VQcmVmZXJlbmNlcyhvdGhlci5nZXRQcmVm\nZXJlbmNlcygpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tZXJnZVVua25v\nd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGZpbmFs\nIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICBpZiAoaGFzU3Rh\ndGUoKSkgewogICAgICAgICAgaWYgKCFnZXRTdGF0ZSgpLmlzSW5pdGlhbGl6\nZWQoKSkgewogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9t\nKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3du\nRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93\nbkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAgICAgIHRoaXMuZ2V0VW5r\nbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAg\nICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAgIHN3aXRj\naCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0\naGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsK\nICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAg\nIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNp\nb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRV\nbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAg\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDEwOiB7CiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uU3RhdGUuQnVpbGRlciBzdWJCdWlsZGVyID0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uU3RhdGUubmV3QnVpbGRlcigpOwogICAgICAgICAgICAgIGlmIChoYXNT\ndGF0ZSgpKSB7CiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJv\nbShnZXRTdGF0ZSgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\naW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0\ncnkpOwogICAgICAgICAgICAgIHNldFN0YXRlKHN1YkJ1aWxkZXIuYnVpbGRQ\nYXJ0aWFsKCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25QcmVmZXJlbmNlcy5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25Q\ncmVmZXJlbmNlcy5uZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgaWYgKGhh\nc1ByZWZlcmVuY2VzKCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIu\nbWVyZ2VGcm9tKGdldFByZWZlcmVuY2VzKCkpOwogICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBl\neHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0UHJlZmVyZW5j\nZXMoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAg\nICAgIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmlwdGlvblN0\nYXRlIHN0YXRlID0gMTsKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBz\ndGF0ZV8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25TdGF0ZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsK\nICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxk\nQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlLCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25T\ndGF0ZS5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZU9yQnVpbGRlcj4gc3RhdGVC\ndWlsZGVyXzsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzU3RhdGUoKSB7CiAg\nICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4\nMDAwMDAwMDEpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0\nZSBnZXRTdGF0ZSgpIHsKICAgICAgICBpZiAoc3RhdGVCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICByZXR1cm4gc3RhdGVfOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICByZXR1cm4gc3RhdGVCdWlsZGVyXy5nZXRNZXNzYWdl\nKCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndFN0YXRlKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvblN0YXRlIHZhbHVlKSB7CiAgICAgICAgaWYgKHN0\nYXRlQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZhbHVlID09\nIG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBzdGF0ZV8gPSB2YWx1\nZTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICBzdGF0ZUJ1aWxkZXJfLnNldE1lc3NhZ2UodmFsdWUpOwogICAg\nICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0U3RhdGUoCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZS5CdWlsZGVyIGJ1\naWxkZXJGb3JWYWx1ZSkgewogICAgICAgIGlmIChzdGF0ZUJ1aWxkZXJfID09\nIG51bGwpIHsKICAgICAgICAgIHN0YXRlXyA9IGJ1aWxkZXJGb3JWYWx1ZS5i\ndWlsZCgpOwogICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHN0YXRlQnVpbGRlcl8uc2V0TWVzc2FnZShidWlsZGVy\nRm9yVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZVN0YXRlKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0\nYXRlIHZhbHVlKSB7CiAgICAgICAgaWYgKHN0YXRlQnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEp\nID09IDB4MDAwMDAwMDEpICYmCiAgICAgICAgICAgICAgc3RhdGVfICE9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblN0YXRlLmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAg\nICAgIHN0YXRlXyA9CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUubmV3\nQnVpbGRlcihzdGF0ZV8pLm1lcmdlRnJvbSh2YWx1ZSkuYnVpbGRQYXJ0aWFs\nKCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGF0ZV8gPSB2\nYWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICBzdGF0ZUJ1aWxkZXJfLm1lcmdlRnJv\nbSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgw\nMDAwMDAwMTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBw\ndWJsaWMgQnVpbGRlciBjbGVhclN0YXRlKCkgewogICAgICAgIGlmIChzdGF0\nZUJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHN0YXRlXyA9IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblN0YXRlLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXRlQnVp\nbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyA9\nIChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZS5CdWls\nZGVyIGdldFN0YXRlQnVpbGRlcigpIHsKICAgICAgICBiaXRGaWVsZDBfIHw9\nIDB4MDAwMDAwMDE7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0\ndXJuIGdldFN0YXRlRmllbGRCdWlsZGVyKCkuZ2V0QnVpbGRlcigpOwogICAg\nICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZU9yQnVpbGRlciBnZXRT\ndGF0ZU9yQnVpbGRlcigpIHsKICAgICAgICBpZiAoc3RhdGVCdWlsZGVyXyAh\nPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gc3RhdGVCdWlsZGVyXy5nZXRN\nZXNzYWdlT3JCdWlsZGVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nIHJldHVybiBzdGF0ZV87CiAgICAgICAgfQogICAgICB9CiAgICAgIHByaXZh\ndGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVGaWVsZEJ1aWxkZXI8CiAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25TdGF0ZSwgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUuQnVpbGRl\nciwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uU3RhdGVPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0U3Rh\ndGVGaWVsZEJ1aWxkZXIoKSB7CiAgICAgICAgaWYgKHN0YXRlQnVpbGRlcl8g\nPT0gbnVsbCkgewogICAgICAgICAgc3RhdGVCdWlsZGVyXyA9IG5ldyBjb20u\nZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZpZWxkQnVpbGRlcjwKICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25TdGF0ZSwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUuQnVpbGRlciwg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uU3RhdGVPckJ1aWxkZXI+KAogICAgICAgICAgICAgICAgICBz\ndGF0ZV8sCiAgICAgICAgICAgICAgICAgIGdldFBhcmVudEZvckNoaWxkcmVu\nKCksCiAgICAgICAgICAgICAgICAgIGlzQ2xlYW4oKSk7CiAgICAgICAgICBz\ndGF0ZV8gPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc3RhdGVC\ndWlsZGVyXzsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgLkhl\nZHdpZy5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBwcmVmZXJlbmNlcyA9IDI7\nCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgcHJlZmVyZW5j\nZXNfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuZ2V0RGVmYXVsdEluc3RhbmNl\nKCk7CiAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5TaW5nbGVG\naWVsZEJ1aWxkZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcywg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uUHJlZmVyZW5jZXMuQnVpbGRlciwgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXNPckJ1aWxkZXI+IHByZWZlcmVuY2VzQnVpbGRlcl87CiAgICAgIHB1\nYmxpYyBib29sZWFuIGhhc1ByZWZlcmVuY2VzKCkgewogICAgICAgIHJldHVy\nbiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAwMDAyKTsK\nICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMgZ2V0\nUHJlZmVyZW5jZXMoKSB7CiAgICAgICAgaWYgKHByZWZlcmVuY2VzQnVpbGRl\ncl8gPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHByZWZlcmVuY2VzXzsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHByZWZlcmVuY2Vz\nQnVpbGRlcl8uZ2V0TWVzc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAg\nICBwdWJsaWMgQnVpbGRlciBzZXRQcmVmZXJlbmNlcyhvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVm\nZXJlbmNlcyB2YWx1ZSkgewogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxk\nZXJfID09IG51bGwpIHsKICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigp\nOwogICAgICAgICAgfQogICAgICAgICAgcHJlZmVyZW5jZXNfID0gdmFsdWU7\nCiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgcHJlZmVyZW5jZXNCdWlsZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsK\nICAgICAgICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIHNldFByZWZlcmVuY2VzKAogICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXMuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAo\ncHJlZmVyZW5jZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBwcmVm\nZXJlbmNlc18gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwcmVm\nZXJlbmNlc0J1aWxkZXJfLnNldE1lc3NhZ2UoYnVpbGRlckZvclZhbHVlLmJ1\naWxkKCkpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAw\nMDAwMDI7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgbWVyZ2VQcmVmZXJlbmNlcyhvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJl\nbmNlcyB2YWx1ZSkgewogICAgICAgIGlmIChwcmVmZXJlbmNlc0J1aWxkZXJf\nID09IG51bGwpIHsKICAgICAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAyKSA9PSAweDAwMDAwMDAyKSAmJgogICAgICAgICAgICAgIHByZWZl\ncmVuY2VzXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5nZXREZWZhdWx0SW5z\ndGFuY2UoKSkgewogICAgICAgICAgICBwcmVmZXJlbmNlc18gPQogICAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzLm5ld0J1aWxkZXIocHJlZmVy\nZW5jZXNfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcHJlZmVyZW5jZXNfID0gdmFs\ndWU7CiAgICAgICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcHJlZmVyZW5jZXNCdWlsZGVyXy5tZXJn\nZUZyb20odmFsdWUpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9\nIDB4MDAwMDAwMDI7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xlYXJQcmVmZXJlbmNlcygpIHsKICAgICAg\nICBpZiAocHJlZmVyZW5jZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAg\nICBwcmVmZXJlbmNlc18gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5nZXREZWZh\ndWx0SW5zdGFuY2UoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICBwcmVmZXJlbmNlc0J1aWxkZXJfLmNsZWFy\nKCk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxkMF8gPSAoYml0RmllbGQw\nXyAmIH4weDAwMDAwMDAyKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuQnVpbGRlciBn\nZXRQcmVmZXJlbmNlc0J1aWxkZXIoKSB7CiAgICAgICAgYml0RmllbGQwXyB8\nPSAweDAwMDAwMDAyOwogICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIHJl\ndHVybiBnZXRQcmVmZXJlbmNlc0ZpZWxkQnVpbGRlcigpLmdldEJ1aWxkZXIo\nKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXNP\nckJ1aWxkZXIgZ2V0UHJlZmVyZW5jZXNPckJ1aWxkZXIoKSB7CiAgICAgICAg\naWYgKHByZWZlcmVuY2VzQnVpbGRlcl8gIT0gbnVsbCkgewogICAgICAgICAg\ncmV0dXJuIHByZWZlcmVuY2VzQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRl\ncigpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gcHJlZmVy\nZW5jZXNfOwogICAgICAgIH0KICAgICAgfQogICAgICBwcml2YXRlIGNvbS5n\nb29nbGUucHJvdG9idWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uUHJlZmVyZW5jZXMsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzLkJ1\naWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzT3JCdWlsZGVyPiAKICAgICAg\nICAgIGdldFByZWZlcmVuY2VzRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlm\nIChwcmVmZXJlbmNlc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIHBy\nZWZlcmVuY2VzQnVpbGRlcl8gPSBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5T\naW5nbGVGaWVsZEJ1aWxkZXI8CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJl\nZmVyZW5jZXMsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzLkJ1aWxkZXIsIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblByZWZlcmVuY2VzT3JCdWlsZGVyPigKICAgICAgICAgICAgICAgICAg\ncHJlZmVyZW5jZXNfLAogICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JD\naGlsZHJlbigpLAogICAgICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAg\nICAgICAgcHJlZmVyZW5jZXNfID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHByZWZlcmVuY2VzQnVpbGRlcl87CiAgICAgIH0KICAgICAgCiAg\nICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3Bl\nOkhlZHdpZy5TdWJzY3JpcHRpb25EYXRhKQogICAgfQogICAgCiAgICBzdGF0\naWMgewogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgU3Vic2NyaXB0aW9u\nRGF0YSh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMo\nKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50\nKGNsYXNzX3Njb3BlOkhlZHdpZy5TdWJzY3JpcHRpb25EYXRhKQogIH0KICAK\nICBwdWJsaWMgaW50ZXJmYWNlIExlZGdlclJhbmdlT3JCdWlsZGVyCiAgICAg\nIGV4dGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVy\nIHsKICAgIAogICAgLy8gcmVxdWlyZWQgdWludDY0IGxlZGdlcklkID0gMTsK\nICAgIGJvb2xlYW4gaGFzTGVkZ2VySWQoKTsKICAgIGxvbmcgZ2V0TGVkZ2Vy\nSWQoKTsKICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5NZXNzYWdlU2Vx\nSWQgZW5kU2VxSWRJbmNsdWRlZCA9IDI7CiAgICBib29sZWFuIGhhc0VuZFNl\ncUlkSW5jbHVkZWQoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRFbmRTZXFJZEluY2x1\nZGVkKCk7CiAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlU2VxSWRPckJ1aWxkZXIgZ2V0RW5kU2VxSWRJbmNs\ndWRlZE9yQnVpbGRlcigpOwogICAgCiAgICAvLyBvcHRpb25hbCB1aW50NjQg\nc3RhcnRTZXFJZEluY2x1ZGVkID0gMzsKICAgIGJvb2xlYW4gaGFzU3RhcnRT\nZXFJZEluY2x1ZGVkKCk7CiAgICBsb25nIGdldFN0YXJ0U2VxSWRJbmNsdWRl\nZCgpOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIExlZGdlclJh\nbmdlIGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlCiAgICAgIGltcGxlbWVudHMgTGVkZ2VyUmFuZ2VPckJ1aWxk\nZXIgewogICAgLy8gVXNlIExlZGdlclJhbmdlLm5ld0J1aWxkZXIoKSB0byBj\nb25zdHJ1Y3QuCiAgICBwcml2YXRlIExlZGdlclJhbmdlKEJ1aWxkZXIgYnVp\nbGRlcikgewogICAgICBzdXBlcihidWlsZGVyKTsKICAgIH0KICAgIHByaXZh\ndGUgTGVkZ2VyUmFuZ2UoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHBy\naXZhdGUgc3RhdGljIGZpbmFsIExlZGdlclJhbmdlIGRlZmF1bHRJbnN0YW5j\nZTsKICAgIHB1YmxpYyBzdGF0aWMgTGVkZ2VyUmFuZ2UgZ2V0RGVmYXVsdElu\nc3RhbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAg\nfQogICAgCiAgICBwdWJsaWMgTGVkZ2VyUmFuZ2UgZ2V0RGVmYXVsdEluc3Rh\nbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXRE\nZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19MZWRnZXJSYW5nZV9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90\nZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nl\nc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19MZWRnZXJSYW5nZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAgICAvLyByZXF1aXJlZCB1\naW50NjQgbGVkZ2VySWQgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgTEVER0VSSURfRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgbG9u\nZyBsZWRnZXJJZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNMZWRnZXJJZCgp\nIHsKICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09\nIDB4MDAwMDAwMDEpOwogICAgfQogICAgcHVibGljIGxvbmcgZ2V0TGVkZ2Vy\nSWQoKSB7CiAgICAgIHJldHVybiBsZWRnZXJJZF87CiAgICB9CiAgICAKICAg\nIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWVzc2FnZVNlcUlkIGVuZFNlcUlkSW5j\nbHVkZWQgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5EU0VR\nSURJTkNMVURFRF9GSUVMRF9OVU1CRVIgPSAyOwogICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQgZW5kU2VxSWRJbmNsdWRlZF87CiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNFbmRTZXFJZEluY2x1ZGVkKCkgewogICAgICByZXR1cm4gKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMik7CiAgICB9CiAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkIGdldEVuZFNlcUlkSW5jbHVkZWQoKSB7CiAgICAg\nIHJldHVybiBlbmRTZXFJZEluY2x1ZGVkXzsKICAgIH0KICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlU2VxSWRPckJ1aWxkZXIgZ2V0RW5kU2VxSWRJbmNsdWRlZE9yQnVpbGRl\ncigpIHsKICAgICAgcmV0dXJuIGVuZFNlcUlkSW5jbHVkZWRfOwogICAgfQog\nICAgCiAgICAvLyBvcHRpb25hbCB1aW50NjQgc3RhcnRTZXFJZEluY2x1ZGVk\nID0gMzsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNUQVJUU0VRSURJ\nTkNMVURFRF9GSUVMRF9OVU1CRVIgPSAzOwogICAgcHJpdmF0ZSBsb25nIHN0\nYXJ0U2VxSWRJbmNsdWRlZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdGFy\ndFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8g\nJiAweDAwMDAwMDA0KSA9PSAweDAwMDAwMDA0KTsKICAgIH0KICAgIHB1Ymxp\nYyBsb25nIGdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpIHsKICAgICAgcmV0dXJu\nIHN0YXJ0U2VxSWRJbmNsdWRlZF87CiAgICB9CiAgICAKICAgIHByaXZhdGUg\ndm9pZCBpbml0RmllbGRzKCkgewogICAgICBsZWRnZXJJZF8gPSAwTDsKICAg\nICAgZW5kU2VxSWRJbmNsdWRlZF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdElu\nc3RhbmNlKCk7CiAgICAgIHN0YXJ0U2VxSWRJbmNsdWRlZF8gPSAwTDsKICAg\nIH0KICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAt\nMTsKICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7\nCiAgICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFs\naXplZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgIT0gLTEpIHJldHVybiBp\nc0luaXRpYWxpemVkID09IDE7CiAgICAgIAogICAgICBpZiAoIWhhc0xlZGdl\ncklkKCkpIHsKICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAwOwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoaGFzRW5k\nU2VxSWRJbmNsdWRlZCgpKSB7CiAgICAgICAgaWYgKCFnZXRFbmRTZXFJZElu\nY2x1ZGVkKCkuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICBtZW1vaXpl\nZElzSW5pdGlhbGl6ZWQgPSAwOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgICAgfQogICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQg\nPSAxOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGlj\nIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0\nU3RyZWFtIG91dHB1dCkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6\nZSgpOwogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0g\nMHgwMDAwMDAwMSkpIHsKICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQoMSwg\nbGVkZ2VySWRfKTsKICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYg\nMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBvdXRwdXQu\nd3JpdGVNZXNzYWdlKDIsIGVuZFNlcUlkSW5jbHVkZWRfKTsKICAgICAgfQog\nICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgwMDAw\nMDAwNCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQoMywgc3RhcnRT\nZXFJZEluY2x1ZGVkXyk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxk\ncygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBp\nbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGlu\ndCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1v\naXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0\ndXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmICgoKGJp\ndEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKSkgewogICAg\nICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0\ncmVhbQogICAgICAgICAgLmNvbXB1dGVVSW50NjRTaXplKDEsIGxlZGdlcklk\nXyk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29t\ncHV0ZU1lc3NhZ2VTaXplKDIsIGVuZFNlcUlkSW5jbHVkZWRfKTsKICAgICAg\nfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwNCkgPT0gMHgw\nMDAwMDAwNCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlVUludDY0\nU2l6ZSgzLCBzdGFydFNlcUlkSW5jbHVkZWRfKTsKICAgICAgfQogICAgICBz\naXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgp\nOwogICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAg\ncmV0dXJuIHNpemU7CiAgICB9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJRCA9IDBMOwogICAgQGphdmEubGFu\nZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIGphdmEubGFuZy5PYmplY3Qgd3Jp\ndGVSZXBsYWNlKCkKICAgICAgICB0aHJvd3MgamF2YS5pby5PYmplY3RTdHJl\nYW1FeGNlcHRpb24gewogICAgICByZXR1cm4gc3VwZXIud3JpdGVSZXBsYWNl\nKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgcGFy\nc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIHBhcnNlRnJvbSgKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIHBhcnNlRnJvbShi\neXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBwYXJzZUZyb20o\nCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5MZWRnZXJSYW5nZSBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBp\nbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWls\nZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBw\nYXJzZUZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBp\nZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAgICAg\nICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNl\nIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZSBwYXJzZURlbGltaXRlZEZyb20oCiAgICAg\nICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAg\naWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNp\nb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBh\ncnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxsOwog\nICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIHBhcnNl\nRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRT\ndHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1\ndCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2Vy\nUmFuZ2UgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVy\nKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1\naWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVy\nKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlIHByb3RvdHlwZSkgewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAgfQogICAgcHVibGljIEJ1aWxk\nZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsgfQog\nICAgCiAgICBAamF2YS5sYW5nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgQnVp\nbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlclBhcmVudCBwYXJlbnQp\nIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIocGFyZW50\nKTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxk\nZXI+CiAgICAgICBpbXBsZW1lbnRzIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlT3JCdWlsZGVyIHsKICAg\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3Io\nKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTGVkZ2Vy\nUmFuZ2VfZGVzY3JpcHRvcjsKICAgICAgfQogICAgICAKICAgICAgcHJvdGVj\ndGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVs\nZEFjY2Vzc29yVGFibGUKICAgICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nl\nc3NvclRhYmxlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVk\nd2lnX0xlZGdlclJhbmdlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgICAgfQog\nICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlLm5ld0J1\naWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7CiAgICAgICAgbWF5\nYmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwogICAgICB9CiAgICAg\nIAogICAgICBwcml2YXRlIEJ1aWxkZXIoQnVpbGRlclBhcmVudCBwYXJlbnQp\nIHsKICAgICAgICBzdXBlcihwYXJlbnQpOwogICAgICAgIG1heWJlRm9yY2VC\ndWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAgICBwcml2YXRl\nIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpIHsKICAg\nICAgICBpZiAoY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMpIHsKICAgICAgICAgIGdldEVuZFNl\ncUlkSW5jbHVkZWRGaWVsZEJ1aWxkZXIoKTsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAg\nICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIHN1cGVyLmNsZWFy\nKCk7CiAgICAgICAgbGVkZ2VySWRfID0gMEw7CiAgICAgICAgYml0RmllbGQw\nXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgIGlmIChl\nbmRTZXFJZEluY2x1ZGVkQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAg\nZW5kU2VxSWRJbmNsdWRlZF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVuZFNlcUlkSW5j\nbHVkZWRCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAgICBiaXRG\naWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAg\nc3RhcnRTZXFJZEluY2x1ZGVkXyA9IDBMOwogICAgICAgIGJpdEZpZWxkMF8g\nPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDA0KTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xv\nbmUoKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShidWls\nZFBhcnRpYWwoKSk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAg\nICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRn\nZXJSYW5nZS5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZSBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkg\newogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZS5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIGJ1aWxk\nKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgp\nOwogICAgICAgIGlmICghcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKSkgewogICAg\nICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24o\ncmVzdWx0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAg\nICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBidWlsZFBhcnNl\nZCgpCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZh\nbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdl\nIHJlc3VsdCA9IGJ1aWxkUGFydGlhbCgpOwogICAgICAgIGlmICghcmVzdWx0\nLmlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0\naWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJlc3VsdCku\nYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkxlZGdlclJhbmdlIGJ1aWxkUGFydGlhbCgpIHsKICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJS\nYW5nZSByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UodGhpcyk7CiAgICAgICAgaW50\nIGZyb21fYml0RmllbGQwXyA9IGJpdEZpZWxkMF87CiAgICAgICAgaW50IHRv\nX2JpdEZpZWxkMF8gPSAwOwogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQw\nXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAgICB0\nb19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgfQogICAgICAg\nIHJlc3VsdC5sZWRnZXJJZF8gPSBsZWRnZXJJZF87CiAgICAgICAgaWYgKCgo\nZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMikgPT0gMHgwMDAwMDAwMikp\nIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMjsKICAg\nICAgICB9CiAgICAgICAgaWYgKGVuZFNlcUlkSW5jbHVkZWRCdWlsZGVyXyA9\nPSBudWxsKSB7CiAgICAgICAgICByZXN1bHQuZW5kU2VxSWRJbmNsdWRlZF8g\nPSBlbmRTZXFJZEluY2x1ZGVkXzsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgcmVzdWx0LmVuZFNlcUlkSW5jbHVkZWRfID0gZW5kU2VxSWRJbmNsdWRl\nZEJ1aWxkZXJfLmJ1aWxkKCk7CiAgICAgICAgfQogICAgICAgIGlmICgoKGZy\nb21fYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpKSB7\nCiAgICAgICAgICB0b19iaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDQ7CiAgICAg\nICAgfQogICAgICAgIHJlc3VsdC5zdGFydFNlcUlkSW5jbHVkZWRfID0gc3Rh\ncnRTZXFJZEluY2x1ZGVkXzsKICAgICAgICByZXN1bHQuYml0RmllbGQwXyA9\nIHRvX2JpdEZpZWxkMF87CiAgICAgICAgb25CdWlsdCgpOwogICAgICAgIHJl\ndHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3Ro\nZXIpIHsKICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSkg\newogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Upb3RoZXIp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdXBlci5tZXJnZUZyb20o\nb3RoZXIpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2Vy\nUmFuZ2Ugb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Uu\nZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlm\nIChvdGhlci5oYXNMZWRnZXJJZCgpKSB7CiAgICAgICAgICBzZXRMZWRnZXJJ\nZChvdGhlci5nZXRMZWRnZXJJZCgpKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKG90aGVyLmhhc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAgICAgbWVy\nZ2VFbmRTZXFJZEluY2x1ZGVkKG90aGVyLmdldEVuZFNlcUlkSW5jbHVkZWQo\nKSk7CiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNTdGFydFNlcUlk\nSW5jbHVkZWQoKSkgewogICAgICAgICAgc2V0U3RhcnRTZXFJZEluY2x1ZGVk\nKG90aGVyLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpKTsKICAgICAgICB9CiAg\nICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93\nbkZpZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgp\nIHsKICAgICAgICBpZiAoIWhhc0xlZGdlcklkKCkpIHsKICAgICAgICAgIAog\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAo\naGFzRW5kU2VxSWRJbmNsdWRlZCgpKSB7CiAgICAgICAgICBpZiAoIWdldEVu\nZFNlcUlkSW5jbHVkZWQoKS5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAg\nICAgCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5r\nbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWls\nZGVyKAogICAgICAgICAgICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAg\nICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1\ndC5yZWFkVGFnKCk7CiAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAg\nICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmll\nbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93\nbkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykp\nIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtu\nb3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgY2FzZSA4OiB7CiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAw\neDAwMDAwMDAxOwogICAgICAgICAgICAgIGxlZGdlcklkXyA9IGlucHV0LnJl\nYWRVSW50NjQoKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBjYXNlIDE4OiB7CiAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkLkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVy\nKCk7CiAgICAgICAgICAgICAgaWYgKGhhc0VuZFNlcUlkSW5jbHVkZWQoKSkg\newogICAgICAgICAgICAgICAgc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0RW5k\nU2VxSWRJbmNsdWRlZCgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgaW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVn\naXN0cnkpOwogICAgICAgICAgICAgIHNldEVuZFNlcUlkSW5jbHVkZWQoc3Vi\nQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAyNDogewogICAgICAg\nICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwNDsKICAgICAgICAgICAg\nICBzdGFydFNlcUlkSW5jbHVkZWRfID0gaW5wdXQucmVhZFVJbnQ2NCgpOwog\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIGludCBi\naXRGaWVsZDBfOwogICAgICAKICAgICAgLy8gcmVxdWlyZWQgdWludDY0IGxl\nZGdlcklkID0gMTsKICAgICAgcHJpdmF0ZSBsb25nIGxlZGdlcklkXyA7CiAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc0xlZGdlcklkKCkgewogICAgICAgIHJl\ndHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAx\nKTsKICAgICAgfQogICAgICBwdWJsaWMgbG9uZyBnZXRMZWRnZXJJZCgpIHsK\nICAgICAgICByZXR1cm4gbGVkZ2VySWRfOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIHNldExlZGdlcklkKGxvbmcgdmFsdWUpIHsKICAgICAgICBi\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgbGVkZ2VySWRfID0g\ndmFsdWU7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJMZWRnZXJJ\nZCgpIHsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgw\nMDAwMDAwMSk7CiAgICAgICAgbGVkZ2VySWRfID0gMEw7CiAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\nCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWVzc2FnZVNlcUlkIGVuZFNl\ncUlkSW5jbHVkZWQgPSAyOwogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBlbmRT\nZXFJZEluY2x1ZGVkXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZp\nZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCwgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1\naWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlcj4gZW5kU2VxSWRJbmNsdWRlZEJ1\naWxkZXJfOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNFbmRTZXFJZEluY2x1\nZGVkKCkgewogICAgICAgIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAw\nMDAyKSA9PSAweDAwMDAwMDAyKTsKICAgICAgfQogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkIGdldEVuZFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgICAgaWYgKGVu\nZFNlcUlkSW5jbHVkZWRCdWlsZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICBy\nZXR1cm4gZW5kU2VxSWRJbmNsdWRlZF87CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgIHJldHVybiBlbmRTZXFJZEluY2x1ZGVkQnVpbGRlcl8uZ2V0TWVz\nc2FnZSgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRFbmRTZXFJZEluY2x1ZGVkKG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2YWx1ZSkgewogICAg\nICAgIGlmIChlbmRTZXFJZEluY2x1ZGVkQnVpbGRlcl8gPT0gbnVsbCkgewog\nICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICB9CiAg\nICAgICAgICBlbmRTZXFJZEluY2x1ZGVkXyA9IHZhbHVlOwogICAgICAgICAg\nb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGVuZFNl\ncUlkSW5jbHVkZWRCdWlsZGVyXy5zZXRNZXNzYWdlKHZhbHVlKTsKICAgICAg\nICB9CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndEVuZFNlcUlkSW5jbHVkZWQoCiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRl\nciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBpZiAoZW5kU2VxSWRJbmNs\ndWRlZEJ1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAgIGVuZFNlcUlkSW5j\nbHVkZWRfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgICBv\nbkNoYW5nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZW5kU2Vx\nSWRJbmNsdWRlZEJ1aWxkZXJfLnNldE1lc3NhZ2UoYnVpbGRlckZvclZhbHVl\nLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBiaXRGaWVsZDBfIHw9IDB4\nMDAwMDAwMDI7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgbWVyZ2VFbmRTZXFJZEluY2x1ZGVkKG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZCB2YWx1ZSkgewogICAgICAgIGlmIChlbmRTZXFJZEluY2x1ZGVkQnVpbGRl\ncl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKCgoYml0RmllbGQwXyAmIDB4\nMDAwMDAwMDIpID09IDB4MDAwMDAwMDIpICYmCiAgICAgICAgICAgICAgZW5k\nU2VxSWRJbmNsdWRlZF8gIT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5j\nZSgpKSB7CiAgICAgICAgICAgIGVuZFNlcUlkSW5jbHVkZWRfID0KICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRlcihlbmRTZXFJZEluY2x1ZGVk\nXykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGVuZFNlcUlkSW5jbHVkZWRfID0gdmFs\ndWU7CiAgICAgICAgICB9CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgZW5kU2VxSWRJbmNsdWRlZEJ1aWxkZXJf\nLm1lcmdlRnJvbSh2YWx1ZSk7CiAgICAgICAgfQogICAgICAgIGJpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAwMjsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckVuZFNlcUlkSW5jbHVkZWQo\nKSB7CiAgICAgICAgaWYgKGVuZFNlcUlkSW5jbHVkZWRCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBlbmRTZXFJZEluY2x1ZGVkXyA9IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgIG9uQ2hhbmdlZCgp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBlbmRTZXFJZEluY2x1ZGVk\nQnVpbGRlcl8uY2xlYXIoKTsKICAgICAgICB9CiAgICAgICAgYml0RmllbGQw\nXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRl\nciBnZXRFbmRTZXFJZEluY2x1ZGVkQnVpbGRlcigpIHsKICAgICAgICBiaXRG\naWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgb25DaGFuZ2VkKCk7CiAg\nICAgICAgcmV0dXJuIGdldEVuZFNlcUlkSW5jbHVkZWRGaWVsZEJ1aWxkZXIo\nKS5nZXRCdWlsZGVyKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZE9yQnVpbGRlciBnZXRFbmRTZXFJZEluY2x1ZGVkT3JCdWlsZGVyKCkgewog\nICAgICAgIGlmIChlbmRTZXFJZEluY2x1ZGVkQnVpbGRlcl8gIT0gbnVsbCkg\newogICAgICAgICAgcmV0dXJuIGVuZFNlcUlkSW5jbHVkZWRCdWlsZGVyXy5n\nZXRNZXNzYWdlT3JCdWlsZGVyKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHJldHVybiBlbmRTZXFJZEluY2x1ZGVkXzsKICAgICAgICB9CiAgICAg\nIH0KICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLlNpbmdsZUZp\nZWxkQnVpbGRlcjwKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCwgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1\naWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlcj4gCiAgICAgICAgICBnZXRFbmRT\nZXFJZEluY2x1ZGVkRmllbGRCdWlsZGVyKCkgewogICAgICAgIGlmIChlbmRT\nZXFJZEluY2x1ZGVkQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgZW5k\nU2VxSWRJbmNsdWRlZEJ1aWxkZXJfID0gbmV3IGNvbS5nb29nbGUucHJvdG9i\ndWYuU2luZ2xlRmllbGRCdWlsZGVyPAogICAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZVNlcUlkLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZE9yQnVpbGRlcj4oCiAg\nICAgICAgICAgICAgICAgIGVuZFNlcUlkSW5jbHVkZWRfLAogICAgICAgICAg\nICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLAogICAgICAgICAgICAg\nICAgICBpc0NsZWFuKCkpOwogICAgICAgICAgZW5kU2VxSWRJbmNsdWRlZF8g\nPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZW5kU2VxSWRJbmNs\ndWRlZEJ1aWxkZXJfOwogICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25h\nbCB1aW50NjQgc3RhcnRTZXFJZEluY2x1ZGVkID0gMzsKICAgICAgcHJpdmF0\nZSBsb25nIHN0YXJ0U2VxSWRJbmNsdWRlZF8gOwogICAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNTdGFydFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgICAgcmV0dXJu\nICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDQpID09IDB4MDAwMDAwMDQpOwog\nICAgICB9CiAgICAgIHB1YmxpYyBsb25nIGdldFN0YXJ0U2VxSWRJbmNsdWRl\nZCgpIHsKICAgICAgICByZXR1cm4gc3RhcnRTZXFJZEluY2x1ZGVkXzsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdGFydFNlcUlkSW5jbHVk\nZWQobG9uZyB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxkMF8gfD0gMHgwMDAw\nMDAwNDsKICAgICAgICBzdGFydFNlcUlkSW5jbHVkZWRfID0gdmFsdWU7CiAg\nICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdGFydFNlcUlkSW5jbHVk\nZWQoKSB7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4\nMDAwMDAwMDQpOwogICAgICAgIHN0YXJ0U2VxSWRJbmNsdWRlZF8gPSAwTDsK\nICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50\nKGJ1aWxkZXJfc2NvcGU6SGVkd2lnLkxlZGdlclJhbmdlKQogICAgfQogICAg\nCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgTGVk\nZ2VyUmFuZ2UodHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0Rmll\nbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9w\nb2ludChjbGFzc19zY29wZTpIZWR3aWcuTGVkZ2VyUmFuZ2UpCiAgfQogIAog\nIHB1YmxpYyBpbnRlcmZhY2UgTGVkZ2VyUmFuZ2VzT3JCdWlsZGVyCiAgICAg\nIGV4dGVuZHMgY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlT3JCdWlsZGVy\nIHsKICAgIAogICAgLy8gcmVwZWF0ZWQgLkhlZHdpZy5MZWRnZXJSYW5nZSBy\nYW5nZXMgPSAxOwogICAgamF2YS51dGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2U+IAogICAg\nICAgIGdldFJhbmdlc0xpc3QoKTsKICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIGdldFJhbmdlcyhp\nbnQgaW5kZXgpOwogICAgaW50IGdldFJhbmdlc0NvdW50KCk7CiAgICBqYXZh\nLnV0aWwuTGlzdDw/IGV4dGVuZHMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VPckJ1aWxkZXI+IAogICAg\nICAgIGdldFJhbmdlc09yQnVpbGRlckxpc3QoKTsKICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlT3JC\ndWlsZGVyIGdldFJhbmdlc09yQnVpbGRlcigKICAgICAgICBpbnQgaW5kZXgp\nOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIExlZGdlclJhbmdl\ncyBleHRlbmRzCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZQogICAgICBpbXBsZW1lbnRzIExlZGdlclJhbmdlc09yQnVpbGRl\nciB7CiAgICAvLyBVc2UgTGVkZ2VyUmFuZ2VzLm5ld0J1aWxkZXIoKSB0byBj\nb25zdHJ1Y3QuCiAgICBwcml2YXRlIExlZGdlclJhbmdlcyhCdWlsZGVyIGJ1\naWxkZXIpIHsKICAgICAgc3VwZXIoYnVpbGRlcik7CiAgICB9CiAgICBwcml2\nYXRlIExlZGdlclJhbmdlcyhib29sZWFuIG5vSW5pdCkge30KICAgIAogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTGVkZ2VyUmFuZ2VzIGRlZmF1bHRJbnN0\nYW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgTGVkZ2VyUmFuZ2VzIGdldERlZmF1\nbHRJbnN0YW5jZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsK\nICAgIH0KICAgIAogICAgcHVibGljIExlZGdlclJhbmdlcyBnZXREZWZhdWx0\nSW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3Rh\nbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5n\nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAg\nIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX0xlZGdlclJhbmdlc19kZXNjcmlwdG9yOwogICAgfQogICAgCiAg\nICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNz\nYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0Rmll\nbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19MZWRnZXJSYW5nZXNfZmllbGRBY2Nlc3NvclRhYmxlOwogICAg\nfQogICAgCiAgICAvLyByZXBlYXRlZCAuSGVkd2lnLkxlZGdlclJhbmdlIHJh\nbmdlcyA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBSQU5HRVNf\nRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgamF2YS51dGlsLkxpc3Q8\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2U+IHJhbmdlc187CiAgICBwdWJsaWMgamF2YS51dGlsLkxpc3Q8\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2U+IGdldFJhbmdlc0xpc3QoKSB7CiAgICAgIHJldHVybiByYW5n\nZXNfOwogICAgfQogICAgcHVibGljIGphdmEudXRpbC5MaXN0PD8gZXh0ZW5k\ncyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5M\nZWRnZXJSYW5nZU9yQnVpbGRlcj4gCiAgICAgICAgZ2V0UmFuZ2VzT3JCdWls\nZGVyTGlzdCgpIHsKICAgICAgcmV0dXJuIHJhbmdlc187CiAgICB9CiAgICBw\ndWJsaWMgaW50IGdldFJhbmdlc0NvdW50KCkgewogICAgICByZXR1cm4gcmFu\nZ2VzXy5zaXplKCk7CiAgICB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgZ2V0UmFu\nZ2VzKGludCBpbmRleCkgewogICAgICByZXR1cm4gcmFuZ2VzXy5nZXQoaW5k\nZXgpOwogICAgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlT3JCdWlsZGVyIGdldFJh\nbmdlc09yQnVpbGRlcigKICAgICAgICBpbnQgaW5kZXgpIHsKICAgICAgcmV0\ndXJuIHJhbmdlc18uZ2V0KGluZGV4KTsKICAgIH0KICAgIAogICAgcHJpdmF0\nZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIHJhbmdlc18gPSBqYXZhLnV0\naWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CiAgICB9CiAgICBwcml2YXRl\nIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7CiAgICBwdWJsaWMg\nZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBieXRlIGlz\nSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgIGlm\nIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4gaXNJbml0aWFsaXplZCA9\nPSAxOwogICAgICAKICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBnZXRSYW5n\nZXNDb3VudCgpOyBpKyspIHsKICAgICAgICBpZiAoIWdldFJhbmdlcyhpKS5p\nc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIG1lbW9pemVkSXNJbml0aWFs\naXplZCA9IDA7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQog\nICAgICB9CiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDE7CiAgICAg\nIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCB3cml0\nZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0\ncHV0KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgcmFuZ2VzXy5zaXplKCk7IGkrKykgewog\nICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMSwgcmFuZ2VzXy5nZXQoaSkp\nOwogICAgICB9CiAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91\ndHB1dCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2Vy\naWFsaXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXpl\nZFNpemUoKSB7CiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVk\nU2l6ZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwogICAg\nCiAgICAgIHNpemUgPSAwOwogICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJh\nbmdlc18uc2l6ZSgpOyBpKyspIHsKICAgICAgICBzaXplICs9IGNvbS5nb29n\nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21w\ndXRlTWVzc2FnZVNpemUoMSwgcmFuZ2VzXy5nZXQoaSkpOwogICAgICB9CiAg\nICAgIHNpemUgKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRT\naXplKCk7CiAgICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwog\nICAgICByZXR1cm4gc2l6ZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMEw7CiAgICBAamF2\nYS5sYW5nLk92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgamF2YS5sYW5nLk9iamVj\ndCB3cml0ZVJlcGxhY2UoKQogICAgICAgIHRocm93cyBqYXZhLmlvLk9iamVj\ndFN0cmVhbUV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBzdXBlci53cml0ZVJl\ncGxhY2UoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5n\nZXMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBwYXJzZUZy\nb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRh\ndGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdp\nc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0\nYSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgcGFy\nc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBw\nYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VGcm9tKGphdmEuaW8uSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShp\nbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2VzIHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTGVkZ2VyUmFuZ2VzIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRl\ncigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5w\ndXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsK\nICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VEZWxpbWl0\nZWRGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWls\nZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShp\nbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1\naWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRn\nZXJSYW5nZXMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVp\nbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsg\nfQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJl\ndHVybiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRl\nciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlcyBwcm90b3R5cGUpIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0K\nICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1\naWxkZXIodGhpcyk7IH0KICAgIAogICAgQGphdmEubGFuZy5PdmVycmlkZQog\nICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxk\nZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\ndyBCdWlsZGVyKHBhcmVudCk7CiAgICAgIHJldHVybiBidWlsZGVyOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVu\nZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuQnVpbGRlcjxCdWlsZGVyPgogICAgICAgaW1wbGVtZW50cyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5n\nZXNPckJ1aWxkZXIgewogICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5n\nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAg\nICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3Rh\ndGljX0hlZHdpZ19MZWRnZXJSYW5nZXNfZGVzY3JpcHRvcjsKICAgICAgfQog\nICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAgIGlu\ndGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0xlZGdlclJhbmdlc19maWVsZEFjY2Vz\nc29yVGFibGU7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1\nc2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5MZWRnZXJSYW5nZXMubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVp\nbGRlcigpIHsKICAgICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0\naW9uKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgQnVpbGRlcihC\ndWlsZGVyUGFyZW50IHBhcmVudCkgewogICAgICAgIHN1cGVyKHBhcmVudCk7\nCiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXphdGlvbigpOwog\nICAgICB9CiAgICAgIHByaXZhdGUgdm9pZCBtYXliZUZvcmNlQnVpbGRlcklu\naXRpYWxpemF0aW9uKCkgewogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycykg\newogICAgICAgICAgZ2V0UmFuZ2VzRmllbGRCdWlsZGVyKCk7CiAgICAgICAg\nfQogICAgICB9CiAgICAgIHByaXZhdGUgc3RhdGljIEJ1aWxkZXIgY3JlYXRl\nKCkgewogICAgICAgIHJldHVybiBuZXcgQnVpbGRlcigpOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAgICBz\ndXBlci5jbGVhcigpOwogICAgICAgIGlmIChyYW5nZXNCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICByYW5nZXNfID0gamF2YS51dGlsLkNvbGxlY3Rp\nb25zLmVtcHR5TGlzdCgpOwogICAgICAgICAgYml0RmllbGQwXyA9IChiaXRG\naWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICByYW5nZXNCdWlsZGVyXy5jbGVhcigpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdl\nRnJvbShidWlsZFBhcnRpYWwoKSk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZXMuZ2V0RGVzY3JpcHRvcigpOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzIGdldERlZmF1bHRJbnN0YW5j\nZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcy5nZXREZWZh\ndWx0SW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlcyBidWlsZCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgcmVzdWx0ID0g\nYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFs\naXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVz\nc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJh\nbmdlcyBidWlsZFBhcnNlZCgpCiAgICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkxlZGdlclJhbmdlcyByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAg\nICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAg\nIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAg\nICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAg\nIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgYnVpbGRQYXJ0aWFs\nKCkgewogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlcyByZXN1bHQgPSBuZXcgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Vz\nKHRoaXMpOwogICAgICAgIGludCBmcm9tX2JpdEZpZWxkMF8gPSBiaXRGaWVs\nZDBfOwogICAgICAgIGlmIChyYW5nZXNCdWlsZGVyXyA9PSBudWxsKSB7CiAg\nICAgICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgw\nMDAwMDAwMSkpIHsKICAgICAgICAgICAgcmFuZ2VzXyA9IGphdmEudXRpbC5D\nb2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJhbmdlc18pOwogICAgICAg\nICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7\nCiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQucmFuZ2VzXyA9IHJhbmdl\nc187CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3VsdC5yYW5nZXNf\nID0gcmFuZ2VzQnVpbGRlcl8uYnVpbGQoKTsKICAgICAgICB9CiAgICAgICAg\nb25CdWlsdCgpOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xl\nLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIg\naW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZXMpIHsKICAgICAgICAgIHJldHVybiBtZXJn\nZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkxlZGdlclJhbmdlcylvdGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgb3RoZXIpIHsKICAgICAg\nICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzLmdldERlZmF1bHRJbnN0YW5jZSgp\nKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAocmFuZ2VzQnVpbGRlcl8gPT0g\nbnVsbCkgewogICAgICAgICAgaWYgKCFvdGhlci5yYW5nZXNfLmlzRW1wdHko\nKSkgewogICAgICAgICAgICBpZiAocmFuZ2VzXy5pc0VtcHR5KCkpIHsKICAg\nICAgICAgICAgICByYW5nZXNfID0gb3RoZXIucmFuZ2VzXzsKICAgICAgICAg\nICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZW5zdXJlUmFu\nZ2VzSXNNdXRhYmxlKCk7CiAgICAgICAgICAgICAgcmFuZ2VzXy5hZGRBbGwo\nb3RoZXIucmFuZ2VzXyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIGlmICghb3RoZXIucmFuZ2VzXy5pc0VtcHR5KCkpIHsKICAgICAgICAg\nICAgaWYgKHJhbmdlc0J1aWxkZXJfLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgIHJhbmdlc0J1aWxkZXJfLmRpc3Bvc2UoKTsKICAgICAgICAgICAgICBy\nYW5nZXNCdWlsZGVyXyA9IG51bGw7CiAgICAgICAgICAgICAgcmFuZ2VzXyA9\nIG90aGVyLnJhbmdlc187CiAgICAgICAgICAgICAgYml0RmllbGQwXyA9IChi\naXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgICAgICAgIHJhbmdl\nc0J1aWxkZXJfID0gCiAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuYWx3YXlzVXNlRmllbGRCdWlsZGVycyA/\nCiAgICAgICAgICAgICAgICAgICBnZXRSYW5nZXNGaWVsZEJ1aWxkZXIoKSA6\nIG51bGw7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmFu\nZ2VzQnVpbGRlcl8uYWRkQWxsTWVzc2FnZXMob3RoZXIucmFuZ2VzXyk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgdGhp\ncy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygp\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGdldFJhbmdlc0NvdW50KCk7IGkrKykg\newogICAgICAgICAgaWYgKCFnZXRSYW5nZXMoaSkuaXNJbml0aWFsaXplZCgp\nKSB7CiAgICAgICAgICAgIAogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0g\naW5wdXQsCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVs\nZHMgPQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmll\nbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRVbmtub3du\nRmllbGRzKCkpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBp\nbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0\nYWcpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMu\nc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAg\nICAgICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYg\nKCFwYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJl\nZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25v\nd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAg\nICAgIG9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGNhc2UgMTA6IHsKICAgICAgICAgICAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRn\nZXJSYW5nZS5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZS5uZXdCdWls\nZGVyKCk7CiAgICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVp\nbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAgICAgICAgICAgIGFkZFJh\nbmdlcyhzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsK\nICAgICAgCiAgICAgIC8vIHJlcGVhdGVkIC5IZWR3aWcuTGVkZ2VyUmFuZ2Ug\ncmFuZ2VzID0gMTsKICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuTGlzdDxvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJS\nYW5nZT4gcmFuZ2VzXyA9CiAgICAgICAgamF2YS51dGlsLkNvbGxlY3Rpb25z\nLmVtcHR5TGlzdCgpOwogICAgICBwcml2YXRlIHZvaWQgZW5zdXJlUmFuZ2Vz\nSXNNdXRhYmxlKCkgewogICAgICAgIGlmICghKChiaXRGaWVsZDBfICYgMHgw\nMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICAgIHJhbmdlc18g\nPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZT4ocmFuZ2VzXyk7\nCiAgICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAg\nIH0KICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlJlcGVhdGVkRmllbGRCdWlsZGVyPAogICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFu\nZ2UsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkxlZGdlclJhbmdlLkJ1aWxkZXIsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlT3JCdWlsZGVyPiByYW5n\nZXNCdWlsZGVyXzsKICAgICAgCiAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlz\ndDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5M\nZWRnZXJSYW5nZT4gZ2V0UmFuZ2VzTGlzdCgpIHsKICAgICAgICBpZiAocmFu\nZ2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIGphdmEu\ndXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJhbmdlc18pOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gcmFuZ2VzQnVpbGRl\ncl8uZ2V0TWVzc2FnZUxpc3QoKTsKICAgICAgICB9CiAgICAgIH0KICAgICAg\ncHVibGljIGludCBnZXRSYW5nZXNDb3VudCgpIHsKICAgICAgICBpZiAocmFu\nZ2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgcmV0dXJuIHJhbmdl\nc18uc2l6ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4g\ncmFuZ2VzQnVpbGRlcl8uZ2V0Q291bnQoKTsKICAgICAgICB9CiAgICAgIH0K\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlIGdldFJhbmdlcyhpbnQgaW5kZXgpIHsK\nICAgICAgICBpZiAocmFuZ2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAg\nICAgcmV0dXJuIHJhbmdlc18uZ2V0KGluZGV4KTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgcmV0dXJuIHJhbmdlc0J1aWxkZXJfLmdldE1lc3NhZ2Uo\naW5kZXgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRSYW5nZXMoCiAgICAgICAgICBpbnQgaW5kZXgsIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIHZh\nbHVlKSB7CiAgICAgICAgaWYgKHJhbmdlc0J1aWxkZXJfID09IG51bGwpIHsK\nICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgfQog\nICAgICAgICAgZW5zdXJlUmFuZ2VzSXNNdXRhYmxlKCk7CiAgICAgICAgICBy\nYW5nZXNfLnNldChpbmRleCwgdmFsdWUpOwogICAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJhbmdlc0J1aWxkZXJf\nLnNldE1lc3NhZ2UoaW5kZXgsIHZhbHVlKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0\nUmFuZ2VzKAogICAgICAgICAgaW50IGluZGV4LCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZS5CdWlsZGVy\nIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAgIGlmIChyYW5nZXNCdWlsZGVy\nXyA9PSBudWxsKSB7CiAgICAgICAgICBlbnN1cmVSYW5nZXNJc011dGFibGUo\nKTsKICAgICAgICAgIHJhbmdlc18uc2V0KGluZGV4LCBidWlsZGVyRm9yVmFs\ndWUuYnVpbGQoKSk7CiAgICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgcmFuZ2VzQnVpbGRlcl8uc2V0TWVzc2FnZShp\nbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBhZGRSYW5nZXMob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgdmFsdWUpIHsKICAgICAgICBpZiAocmFu\nZ2VzQnVpbGRlcl8gPT0gbnVsbCkgewogICAgICAgICAgaWYgKHZhbHVlID09\nIG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgICB9CiAgICAgICAgICBlbnN1cmVSYW5nZXNJ\nc011dGFibGUoKTsKICAgICAgICAgIHJhbmdlc18uYWRkKHZhbHVlKTsKICAg\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICByYW5nZXNCdWlsZGVyXy5hZGRNZXNzYWdlKHZhbHVlKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgYWRkUmFuZ2VzKAogICAgICAgICAgaW50IGluZGV4LCBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5n\nZSB2YWx1ZSkgewogICAgICAgIGlmIChyYW5nZXNCdWlsZGVyXyA9PSBudWxs\nKSB7CiAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAg\nICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAg\nIH0KICAgICAgICAgIGVuc3VyZVJhbmdlc0lzTXV0YWJsZSgpOwogICAgICAg\nICAgcmFuZ2VzXy5hZGQoaW5kZXgsIHZhbHVlKTsKICAgICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5nZXNCdWls\nZGVyXy5hZGRNZXNzYWdlKGluZGV4LCB2YWx1ZSk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIGFkZFJhbmdlcygKICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlLkJ1aWxkZXIgYnVpbGRl\nckZvclZhbHVlKSB7CiAgICAgICAgaWYgKHJhbmdlc0J1aWxkZXJfID09IG51\nbGwpIHsKICAgICAgICAgIGVuc3VyZVJhbmdlc0lzTXV0YWJsZSgpOwogICAg\nICAgICAgcmFuZ2VzXy5hZGQoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkpOwog\nICAgICAgICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHJhbmdlc0J1aWxkZXJfLmFkZE1lc3NhZ2UoYnVpbGRlckZvclZhbHVl\nLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRSYW5nZXMoCiAgICAgICAg\nICBpbnQgaW5kZXgsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVl\nKSB7CiAgICAgICAgaWYgKHJhbmdlc0J1aWxkZXJfID09IG51bGwpIHsKICAg\nICAgICAgIGVuc3VyZVJhbmdlc0lzTXV0YWJsZSgpOwogICAgICAgICAgcmFu\nZ2VzXy5hZGQoaW5kZXgsIGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpKTsKICAg\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICByYW5nZXNCdWlsZGVyXy5hZGRNZXNzYWdlKGluZGV4LCBidWlsZGVyRm9y\nVmFsdWUuYnVpbGQoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZEFsbFJhbmdlcygK\nICAgICAgICAgIGphdmEubGFuZy5JdGVyYWJsZTw/IGV4dGVuZHMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFu\nZ2U+IHZhbHVlcykgewogICAgICAgIGlmIChyYW5nZXNCdWlsZGVyXyA9PSBu\ndWxsKSB7CiAgICAgICAgICBlbnN1cmVSYW5nZXNJc011dGFibGUoKTsKICAg\nICAgICAgIHN1cGVyLmFkZEFsbCh2YWx1ZXMsIHJhbmdlc18pOwogICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJh\nbmdlc0J1aWxkZXJfLmFkZEFsbE1lc3NhZ2VzKHZhbHVlcyk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyUmFuZ2VzKCkgewogICAgICAgIGlmIChyYW5nZXNCdWls\nZGVyXyA9PSBudWxsKSB7CiAgICAgICAgICByYW5nZXNfID0gamF2YS51dGls\nLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwogICAgICAgICAgYml0RmllbGQw\nXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDEpOwogICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJhbmdlc0J1\naWxkZXJfLmNsZWFyKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHJlbW92ZVJhbmdlcyhp\nbnQgaW5kZXgpIHsKICAgICAgICBpZiAocmFuZ2VzQnVpbGRlcl8gPT0gbnVs\nbCkgewogICAgICAgICAgZW5zdXJlUmFuZ2VzSXNNdXRhYmxlKCk7CiAgICAg\nICAgICByYW5nZXNfLnJlbW92ZShpbmRleCk7CiAgICAgICAgICBvbkNoYW5n\nZWQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmFuZ2VzQnVpbGRl\ncl8ucmVtb3ZlKGluZGV4KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlLkJ1aWxkZXIgZ2V0\nUmFuZ2VzQnVpbGRlcigKICAgICAgICAgIGludCBpbmRleCkgewogICAgICAg\nIHJldHVybiBnZXRSYW5nZXNGaWVsZEJ1aWxkZXIoKS5nZXRCdWlsZGVyKGlu\nZGV4KTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VPckJ1aWxkZXIg\nZ2V0UmFuZ2VzT3JCdWlsZGVyKAogICAgICAgICAgaW50IGluZGV4KSB7CiAg\nICAgICAgaWYgKHJhbmdlc0J1aWxkZXJfID09IG51bGwpIHsKICAgICAgICAg\nIHJldHVybiByYW5nZXNfLmdldChpbmRleCk7ICB9IGVsc2UgewogICAgICAg\nICAgcmV0dXJuIHJhbmdlc0J1aWxkZXJfLmdldE1lc3NhZ2VPckJ1aWxkZXIo\naW5kZXgpOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgamF2YS51\ndGlsLkxpc3Q8PyBleHRlbmRzIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlT3JCdWlsZGVyPiAKICAgICAg\nICAgICBnZXRSYW5nZXNPckJ1aWxkZXJMaXN0KCkgewogICAgICAgIGlmIChy\nYW5nZXNCdWlsZGVyXyAhPSBudWxsKSB7CiAgICAgICAgICByZXR1cm4gcmFu\nZ2VzQnVpbGRlcl8uZ2V0TWVzc2FnZU9yQnVpbGRlckxpc3QoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGphdmEudXRpbC5Db2xsZWN0\naW9ucy51bm1vZGlmaWFibGVMaXN0KHJhbmdlc18pOwogICAgICAgIH0KICAg\nICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UuQnVpbGRlciBhZGRSYW5nZXNC\ndWlsZGVyKCkgewogICAgICAgIHJldHVybiBnZXRSYW5nZXNGaWVsZEJ1aWxk\nZXIoKS5hZGRCdWlsZGVyKAogICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZS5nZXREZWZh\ndWx0SW5zdGFuY2UoKSk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdl\nLkJ1aWxkZXIgYWRkUmFuZ2VzQnVpbGRlcigKICAgICAgICAgIGludCBpbmRl\neCkgewogICAgICAgIHJldHVybiBnZXRSYW5nZXNGaWVsZEJ1aWxkZXIoKS5h\nZGRCdWlsZGVyKAogICAgICAgICAgICBpbmRleCwgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UuZ2V0RGVm\nYXVsdEluc3RhbmNlKCkpOwogICAgICB9CiAgICAgIHB1YmxpYyBqYXZhLnV0\naWwuTGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZS5CdWlsZGVyPiAKICAgICAgICAgICBnZXRSYW5n\nZXNCdWlsZGVyTGlzdCgpIHsKICAgICAgICByZXR1cm4gZ2V0UmFuZ2VzRmll\nbGRCdWlsZGVyKCkuZ2V0QnVpbGRlckxpc3QoKTsKICAgICAgfQogICAgICBw\ncml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuUmVwZWF0ZWRGaWVsZEJ1aWxk\nZXI8CiAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5MZWRnZXJSYW5nZSwgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UuQnVpbGRlciwgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2Vy\nUmFuZ2VPckJ1aWxkZXI+IAogICAgICAgICAgZ2V0UmFuZ2VzRmllbGRCdWls\nZGVyKCkgewogICAgICAgIGlmIChyYW5nZXNCdWlsZGVyXyA9PSBudWxsKSB7\nCiAgICAgICAgICByYW5nZXNCdWlsZGVyXyA9IG5ldyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlJlcGVhdGVkRmllbGRCdWlsZGVyPAogICAgICAgICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlLCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZS5CdWlsZGVyLCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZU9yQnVpbGRlcj4o\nCiAgICAgICAgICAgICAgICAgIHJhbmdlc18sCiAgICAgICAgICAgICAgICAg\nICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpLAog\nICAgICAgICAgICAgICAgICBnZXRQYXJlbnRGb3JDaGlsZHJlbigpLAogICAg\nICAgICAgICAgICAgICBpc0NsZWFuKCkpOwogICAgICAgICAgcmFuZ2VzXyA9\nIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiByYW5nZXNCdWlsZGVy\nXzsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9u\nX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLkxlZGdlclJhbmdlcykKICAg\nIH0KICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0g\nbmV3IExlZGdlclJhbmdlcyh0cnVlKTsKICAgICAgZGVmYXVsdEluc3RhbmNl\nLmluaXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5z\nZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5MZWRnZXJSYW5nZXMp\nCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2UgTWFuYWdlck1ldGFPckJ1aWxk\nZXIKICAgICAgZXh0ZW5kcyBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2VP\nckJ1aWxkZXIgewogICAgCiAgICAvLyByZXF1aXJlZCBzdHJpbmcgbWFuYWdl\nckltcGwgPSAyOwogICAgYm9vbGVhbiBoYXNNYW5hZ2VySW1wbCgpOwogICAg\nU3RyaW5nIGdldE1hbmFnZXJJbXBsKCk7CiAgICAKICAgIC8vIHJlcXVpcmVk\nIHVpbnQzMiBtYW5hZ2VyVmVyc2lvbiA9IDM7CiAgICBib29sZWFuIGhhc01h\nbmFnZXJWZXJzaW9uKCk7CiAgICBpbnQgZ2V0TWFuYWdlclZlcnNpb24oKTsK\nICB9CiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBNYW5hZ2VyTWV0YSBl\neHRlbmRzCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZQogICAgICBpbXBsZW1lbnRzIE1hbmFnZXJNZXRhT3JCdWlsZGVyIHsK\nICAgIC8vIFVzZSBNYW5hZ2VyTWV0YS5uZXdCdWlsZGVyKCkgdG8gY29uc3Ry\ndWN0LgogICAgcHJpdmF0ZSBNYW5hZ2VyTWV0YShCdWlsZGVyIGJ1aWxkZXIp\nIHsKICAgICAgc3VwZXIoYnVpbGRlcik7CiAgICB9CiAgICBwcml2YXRlIE1h\nbmFnZXJNZXRhKGJvb2xlYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBNYW5hZ2VyTWV0YSBkZWZhdWx0SW5zdGFuY2U7CiAg\nICBwdWJsaWMgc3RhdGljIE1hbmFnZXJNZXRhIGdldERlZmF1bHRJbnN0YW5j\nZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAg\nIAogICAgcHVibGljIE1hbmFnZXJNZXRhIGdldERlZmF1bHRJbnN0YW5jZUZv\nclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90\nb2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3Jp\ncHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWFu\nYWdlck1ldGFfZGVzY3JpcHRvcjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVk\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JU\nYWJsZSgpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWFu\nYWdlck1ldGFfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgfQogICAgCiAgICBw\ncml2YXRlIGludCBiaXRGaWVsZDBfOwogICAgLy8gcmVxdWlyZWQgc3RyaW5n\nIG1hbmFnZXJJbXBsID0gMjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50\nIE1BTkFHRVJJTVBMX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRlIGph\ndmEubGFuZy5PYmplY3QgbWFuYWdlckltcGxfOwogICAgcHVibGljIGJvb2xl\nYW4gaGFzTWFuYWdlckltcGwoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgIH0KICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0TWFuYWdlckltcGwoKSB7CiAgICAgIGphdmEubGFu\nZy5PYmplY3QgcmVmID0gbWFuYWdlckltcGxfOwogICAgICBpZiAocmVmIGlu\nc3RhbmNlb2YgU3RyaW5nKSB7CiAgICAgICAgcmV0dXJuIChTdHJpbmcpIHJl\nZjsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcgYnMgPSAKICAgICAgICAgICAgKGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZykgcmVmOwogICAgICAgIFN0cmluZyBzID0gYnMu\ndG9TdHJpbmdVdGY4KCk7CiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9i\ndWYuSW50ZXJuYWwuaXNWYWxpZFV0ZjgoYnMpKSB7CiAgICAgICAgICBtYW5h\nZ2VySW1wbF8gPSBzOwogICAgICAgIH0KICAgICAgICByZXR1cm4gczsKICAg\nICAgfQogICAgfQogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZ2V0TWFuYWdlckltcGxCeXRlcygpIHsKICAgICAgamF2YS5s\nYW5nLk9iamVjdCByZWYgPSBtYW5hZ2VySW1wbF87CiAgICAgIGlmIChyZWYg\naW5zdGFuY2VvZiBTdHJpbmcpIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgYiA9IAogICAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcuY29weUZyb21VdGY4KChTdHJpbmcpIHJlZik7\nCiAgICAgICAgbWFuYWdlckltcGxfID0gYjsKICAgICAgICByZXR1cm4gYjsK\nICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gKGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZykgcmVmOwogICAgICB9CiAgICB9CiAgICAKICAg\nIC8vIHJlcXVpcmVkIHVpbnQzMiBtYW5hZ2VyVmVyc2lvbiA9IDM7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBNQU5BR0VSVkVSU0lPTl9GSUVMRF9O\nVU1CRVIgPSAzOwogICAgcHJpdmF0ZSBpbnQgbWFuYWdlclZlcnNpb25fOwog\nICAgcHVibGljIGJvb2xlYW4gaGFzTWFuYWdlclZlcnNpb24oKSB7CiAgICAg\nIHJldHVybiAoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9PSAweDAwMDAw\nMDAyKTsKICAgIH0KICAgIHB1YmxpYyBpbnQgZ2V0TWFuYWdlclZlcnNpb24o\nKSB7CiAgICAgIHJldHVybiBtYW5hZ2VyVmVyc2lvbl87CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICBtYW5hZ2Vy\nSW1wbF8gPSAiIjsKICAgICAgbWFuYWdlclZlcnNpb25fID0gMDsKICAgIH0K\nICAgIHByaXZhdGUgYnl0ZSBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAtMTsK\nICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAg\nICAgIGJ5dGUgaXNJbml0aWFsaXplZCA9IG1lbW9pemVkSXNJbml0aWFsaXpl\nZDsKICAgICAgaWYgKGlzSW5pdGlhbGl6ZWQgIT0gLTEpIHJldHVybiBpc0lu\naXRpYWxpemVkID09IDE7CiAgICAgIAogICAgICBpZiAoIWhhc01hbmFnZXJJ\nbXBsKCkpIHsKICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAwOwog\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoIWhhc01h\nbmFnZXJWZXJzaW9uKCkpIHsKICAgICAgICBtZW1vaXplZElzSW5pdGlhbGl6\nZWQgPSAwOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBt\nZW1vaXplZElzSW5pdGlhbGl6ZWQgPSAxOwogICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoKChiaXRGaWVs\nZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsKICAgICAgICBv\ndXRwdXQud3JpdGVCeXRlcygyLCBnZXRNYW5hZ2VySW1wbEJ5dGVzKCkpOwog\nICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAyKSA9\nPSAweDAwMDAwMDAyKSkgewogICAgICAgIG91dHB1dC53cml0ZVVJbnQzMigz\nLCBtYW5hZ2VyVmVyc2lvbl8pOwogICAgICB9CiAgICAgIGdldFVua25vd25G\naWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHByaXZh\ndGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1Ymxp\nYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXplID0g\nbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0gLTEp\nIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBpZiAo\nKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkpIHsK\nICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDIsIGdldE1h\nbmFnZXJJbXBsQnl0ZXMoKSk7CiAgICAgIH0KICAgICAgaWYgKCgoYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAg\nc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nCiAgICAgICAgICAuY29tcHV0ZVVJbnQzMlNpemUoMywgbWFuYWdlclZlcnNp\nb25fKTsKICAgICAgfQogICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMo\nKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNlcmlhbGl6\nZWRTaXplID0gc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lvblVJ\nRCA9IDBMOwogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVk\nIGphdmEubGFuZy5PYmplY3Qgd3JpdGVSZXBsYWNlKCkKICAgICAgICB0aHJv\nd3MgamF2YS5pby5PYmplY3RTdHJlYW1FeGNlcHRpb24gewogICAgICByZXR1\ncm4gc3VwZXIud3JpdGVSZXBsYWNlKCk7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWFuYWdlck1ldGEgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hbmFn\nZXJNZXRhIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAg\nICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1h\nbmFnZXJNZXRhIHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAgICAgICB0aHJv\nd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJF\neGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nYW5hZ2VyTWV0YSBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29n\nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYW5hZ2VyTWV0YSBwYXJzZUZyb20o\namF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NYW5hZ2VyTWV0YSBwYXJzZUZyb20oCiAgICAgICAgamF2YS5p\nby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hbmFnZXJNZXRhIHBhcnNlRGVsaW1pdGVkRnJv\nbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0g\nbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRl\nZEZyb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYW5hZ2VyTWV0YSBwYXJz\nZURlbGltaXRlZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBp\nbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9\nIG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0\nZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICBy\nZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2Ugewog\nICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMg\nc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1hbmFnZXJNZXRhIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWFuYWdlck1ldGEgcGFyc2VGcm9tKAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0\naWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVh\ndGUoKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUo\nKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMg\nQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1hbmFnZXJNZXRhIHByb3RvdHlwZSkgewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwog\nICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4g\nbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAgICBAamF2YS5sYW5nLk92ZXJy\naWRlCiAgICBwcm90ZWN0ZWQgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgQnVpbGRlciBidWlsZGVy\nID0gbmV3IEJ1aWxkZXIocGFyZW50KTsKICAgICAgcmV0dXJuIGJ1aWxkZXI7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIg\nZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+CiAgICAgICBpbXBsZW1lbnRzIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hbmFn\nZXJNZXRhT3JCdWlsZGVyIHsKICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAg\nICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFs\nX3N0YXRpY19IZWR3aWdfTWFuYWdlck1ldGFfZGVzY3JpcHRvcjsKICAgICAg\nfQogICAgICAKICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICAg\nIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgIHJl\ndHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01hbmFnZXJNZXRhX2ZpZWxkQWNj\nZXNzb3JUYWJsZTsKICAgICAgfQogICAgICAKICAgICAgLy8gQ29uc3RydWN0\nIHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1hbmFnZXJNZXRhLm5ld0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1\naWxkZXIoKSB7CiAgICAgICAgbWF5YmVGb3JjZUJ1aWxkZXJJbml0aWFsaXph\ndGlvbigpOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIEJ1aWxkZXIo\nQnVpbGRlclBhcmVudCBwYXJlbnQpIHsKICAgICAgICBzdXBlcihwYXJlbnQp\nOwogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsK\nICAgICAgfQogICAgICBwcml2YXRlIHZvaWQgbWF5YmVGb3JjZUJ1aWxkZXJJ\nbml0aWFsaXphdGlvbigpIHsKICAgICAgICBpZiAoY29tLmdvb2dsZS5wcm90\nb2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLmFsd2F5c1VzZUZpZWxkQnVpbGRlcnMp\nIHsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVp\nbGRlciBjcmVhdGUoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBCdWlsZGVyKCk7\nCiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkg\newogICAgICAgIHN1cGVyLmNsZWFyKCk7CiAgICAgICAgbWFuYWdlckltcGxf\nID0gIiI7CiAgICAgICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4\nMDAwMDAwMDEpOwogICAgICAgIG1hbmFnZXJWZXJzaW9uXyA9IDA7CiAgICAg\nICAgYml0RmllbGQwXyA9IChiaXRGaWVsZDBfICYgfjB4MDAwMDAwMDIpOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKCku\nbWVyZ2VGcm9tKGJ1aWxkUGFydGlhbCgpKTsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVz\nY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7CiAg\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1hbmFnZXJNZXRhLmdldERlc2NyaXB0b3IoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1hbmFnZXJNZXRhIGdldERlZmF1bHRJbnN0\nYW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hbmFnZXJNZXRhLmdldERl\nZmF1bHRJbnN0YW5jZSgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFu\nYWdlck1ldGEgYnVpbGQoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWFuYWdlck1ldGEgcmVzdWx0ID0g\nYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgaWYgKCFyZXN1bHQuaXNJbml0aWFs\naXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVz\nc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hbmFnZXJN\nZXRhIGJ1aWxkUGFyc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWFuYWdlck1ldGEgcmVzdWx0ID0gYnVpbGRQYXJ0aWFsKCk7CiAgICAg\nICAgaWYgKCFyZXN1bHQuaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0\naHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigKICAgICAg\nICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9\nCiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWFuYWdlck1ldGEgYnVpbGRQYXJ0aWFsKCkg\newogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1hbmFnZXJNZXRhIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYW5hZ2VyTWV0YSh0aGlz\nKTsKICAgICAgICBpbnQgZnJvbV9iaXRGaWVsZDBfID0gYml0RmllbGQwXzsK\nICAgICAgICBpbnQgdG9fYml0RmllbGQwXyA9IDA7CiAgICAgICAgaWYgKCgo\nZnJvbV9iaXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSkp\nIHsKICAgICAgICAgIHRvX2JpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAg\nICAgICB9CiAgICAgICAgcmVzdWx0Lm1hbmFnZXJJbXBsXyA9IG1hbmFnZXJJ\nbXBsXzsKICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAw\nMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAgICAgdG9fYml0RmllbGQw\nXyB8PSAweDAwMDAwMDAyOwogICAgICAgIH0KICAgICAgICByZXN1bHQubWFu\nYWdlclZlcnNpb25fID0gbWFuYWdlclZlcnNpb25fOwogICAgICAgIHJlc3Vs\ndC5iaXRGaWVsZDBfID0gdG9fYml0RmllbGQwXzsKICAgICAgICBvbkJ1aWx0\nKCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9i\ndWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5j\nZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1hbmFnZXJNZXRhKSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYW5h\nZ2VyTWV0YSlvdGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1\ncGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NYW5hZ2VyTWV0YSBvdGhlcikgewogICAgICAgIGlmIChvdGhl\nciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NYW5hZ2VyTWV0YS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRo\naXM7CiAgICAgICAgaWYgKG90aGVyLmhhc01hbmFnZXJJbXBsKCkpIHsKICAg\nICAgICAgIHNldE1hbmFnZXJJbXBsKG90aGVyLmdldE1hbmFnZXJJbXBsKCkp\nOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzTWFuYWdlclZlcnNp\nb24oKSkgewogICAgICAgICAgc2V0TWFuYWdlclZlcnNpb24ob3RoZXIuZ2V0\nTWFuYWdlclZlcnNpb24oKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVy\nZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgaWYg\nKCFoYXNNYW5hZ2VySW1wbCgpKSB7CiAgICAgICAgICAKICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFoYXNNYW5hZ2Vy\nVmVyc2lvbigpKSB7CiAgICAgICAgICAKICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5u\nZXdCdWlsZGVyKAogICAgICAgICAgICB0aGlzLmdldFVua25vd25GaWVsZHMo\nKSk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGludCB0YWcg\nPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAgICAgICBzd2l0Y2ggKHRhZykgewog\nICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgdGhpcy5zZXRVbmtu\nb3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAg\nICAgb25DaGFuZ2VkKCk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAoIXBhcnNl\nVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnks\nIHRhZykpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxk\ncyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgb25D\naGFuZ2VkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgY2FzZSAxODogewogICAgICAgICAgICAgIGJpdEZpZWxk\nMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICAgICAgICBtYW5hZ2VySW1wbF8g\nPSBpbnB1dC5yZWFkQnl0ZXMoKTsKICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDI0OiB7CiAgICAgICAgICAg\nICAgYml0RmllbGQwXyB8PSAweDAwMDAwMDAyOwogICAgICAgICAgICAgIG1h\nbmFnZXJWZXJzaW9uXyA9IGlucHV0LnJlYWRVSW50MzIoKTsKICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQw\nXzsKICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIHN0cmluZyBtYW5hZ2VySW1w\nbCA9IDI7CiAgICAgIHByaXZhdGUgamF2YS5sYW5nLk9iamVjdCBtYW5hZ2Vy\nSW1wbF8gPSAiIjsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzTWFuYWdlcklt\ncGwoKSB7CiAgICAgICAgcmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAw\nMDEpID09IDB4MDAwMDAwMDEpOwogICAgICB9CiAgICAgIHB1YmxpYyBTdHJp\nbmcgZ2V0TWFuYWdlckltcGwoKSB7CiAgICAgICAgamF2YS5sYW5nLk9iamVj\ndCByZWYgPSBtYW5hZ2VySW1wbF87CiAgICAgICAgaWYgKCEocmVmIGluc3Rh\nbmNlb2YgU3RyaW5nKSkgewogICAgICAgICAgU3RyaW5nIHMgPSAoKGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZykgcmVmKS50b1N0cmluZ1V0Zjgo\nKTsKICAgICAgICAgIG1hbmFnZXJJbXBsXyA9IHM7CiAgICAgICAgICByZXR1\ncm4gczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIChTdHJp\nbmcpIHJlZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxk\nZXIgc2V0TWFuYWdlckltcGwoU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgaWYg\nKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4\nY2VwdGlvbigpOwogIH0KICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAg\nICAgICAgbWFuYWdlckltcGxfID0gdmFsdWU7CiAgICAgICAgb25DaGFuZ2Vk\nKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGlj\nIEJ1aWxkZXIgY2xlYXJNYW5hZ2VySW1wbCgpIHsKICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAgICAgICAgbWFu\nYWdlckltcGxfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0TWFuYWdlcklt\ncGwoKTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICB2b2lkIHNldE1hbmFnZXJJbXBsKGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewogICAgICAgIGJpdEZp\nZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAgICAgICBtYW5hZ2VySW1wbF8gPSB2\nYWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgfQogICAgICAKICAg\nICAgLy8gcmVxdWlyZWQgdWludDMyIG1hbmFnZXJWZXJzaW9uID0gMzsKICAg\nICAgcHJpdmF0ZSBpbnQgbWFuYWdlclZlcnNpb25fIDsKICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzTWFuYWdlclZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJu\nICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwog\nICAgICB9CiAgICAgIHB1YmxpYyBpbnQgZ2V0TWFuYWdlclZlcnNpb24oKSB7\nCiAgICAgICAgcmV0dXJuIG1hbmFnZXJWZXJzaW9uXzsKICAgICAgfQogICAg\nICBwdWJsaWMgQnVpbGRlciBzZXRNYW5hZ2VyVmVyc2lvbihpbnQgdmFsdWUp\nIHsKICAgICAgICBiaXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAg\nbWFuYWdlclZlcnNpb25fID0gdmFsdWU7CiAgICAgICAgb25DaGFuZ2VkKCk7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgY2xlYXJNYW5hZ2VyVmVyc2lvbigpIHsKICAgICAgICBiaXRGaWVs\nZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMik7CiAgICAgICAgbWFu\nYWdlclZlcnNpb25fID0gMDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBwcm90\nb2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLk1hbmFn\nZXJNZXRhKQogICAgfQogICAgCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0\nSW5zdGFuY2UgPSBuZXcgTWFuYWdlck1ldGEodHJ1ZSk7CiAgICAgIGRlZmF1\nbHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBA\ncHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuTWFu\nYWdlck1ldGEpCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2UgSHViSW5mb0Rh\ndGFPckJ1aWxkZXIKICAgICAgZXh0ZW5kcyBjb20uZ29vZ2xlLnByb3RvYnVm\nLk1lc3NhZ2VPckJ1aWxkZXIgewogICAgCiAgICAvLyByZXF1aXJlZCBzdHJp\nbmcgaG9zdG5hbWUgPSAyOwogICAgYm9vbGVhbiBoYXNIb3N0bmFtZSgpOwog\nICAgU3RyaW5nIGdldEhvc3RuYW1lKCk7CiAgICAKICAgIC8vIHJlcXVpcmVk\nIHVpbnQ2NCBjenhpZCA9IDM7CiAgICBib29sZWFuIGhhc0N6eGlkKCk7CiAg\nICBsb25nIGdldEN6eGlkKCk7CiAgfQogIHB1YmxpYyBzdGF0aWMgZmluYWwg\nY2xhc3MgSHViSW5mb0RhdGEgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UKICAgICAgaW1wbGVtZW50cyBIdWJJ\nbmZvRGF0YU9yQnVpbGRlciB7CiAgICAvLyBVc2UgSHViSW5mb0RhdGEubmV3\nQnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgSHViSW5mb0Rh\ndGEoQnVpbGRlciBidWlsZGVyKSB7CiAgICAgIHN1cGVyKGJ1aWxkZXIpOwog\nICAgfQogICAgcHJpdmF0ZSBIdWJJbmZvRGF0YShib29sZWFuIG5vSW5pdCkg\ne30KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgSHViSW5mb0RhdGEg\nZGVmYXVsdEluc3RhbmNlOwogICAgcHVibGljIHN0YXRpYyBIdWJJbmZvRGF0\nYSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0\nSW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBIdWJJbmZvRGF0YSBn\nZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVm\nYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRv\ncgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX0h1YkluZm9EYXRhX2Rlc2NyaXB0b3I7CiAgICB9\nCiAgICAKICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJu\nYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX0h1YkluZm9EYXRhX2ZpZWxkQWNjZXNzb3JUYWJs\nZTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAg\nIC8vIHJlcXVpcmVkIHN0cmluZyBob3N0bmFtZSA9IDI7CiAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBIT1NUTkFNRV9GSUVMRF9OVU1CRVIgPSAyOwog\nICAgcHJpdmF0ZSBqYXZhLmxhbmcuT2JqZWN0IGhvc3RuYW1lXzsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc0hvc3RuYW1lKCkgewogICAgICByZXR1cm4gKChi\naXRGaWVsZDBfICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICB9\nCiAgICBwdWJsaWMgU3RyaW5nIGdldEhvc3RuYW1lKCkgewogICAgICBqYXZh\nLmxhbmcuT2JqZWN0IHJlZiA9IGhvc3RuYW1lXzsKICAgICAgaWYgKHJlZiBp\nbnN0YW5jZW9mIFN0cmluZykgewogICAgICAgIHJldHVybiAoU3RyaW5nKSBy\nZWY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIGJzID0gCiAgICAgICAgICAgIChjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcpIHJlZjsKICAgICAgICBTdHJpbmcgcyA9IGJz\nLnRvU3RyaW5nVXRmOCgpOwogICAgICAgIGlmIChjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludGVybmFsLmlzVmFsaWRVdGY4KGJzKSkgewogICAgICAgICAgaG9z\ndG5hbWVfID0gczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHM7CiAgICAg\nIH0KICAgIH0KICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGdldEhvc3RuYW1lQnl0ZXMoKSB7CiAgICAgIGphdmEubGFuZy5P\nYmplY3QgcmVmID0gaG9zdG5hbWVfOwogICAgICBpZiAocmVmIGluc3RhbmNl\nb2YgU3RyaW5nKSB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGIgPSAKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgoU3RyaW5nKSByZWYpOwogICAgICAg\nIGhvc3RuYW1lXyA9IGI7CiAgICAgICAgcmV0dXJuIGI7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcpIHJlZjsKICAgICAgfQogICAgfQogICAgCiAgICAvLyByZXF1aXJl\nZCB1aW50NjQgY3p4aWQgPSAzOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgQ1pYSURfRklFTERfTlVNQkVSID0gMzsKICAgIHByaXZhdGUgbG9uZyBj\nenhpZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNDenhpZCgpIHsKICAgICAg\ncmV0dXJuICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAw\nMDIpOwogICAgfQogICAgcHVibGljIGxvbmcgZ2V0Q3p4aWQoKSB7CiAgICAg\nIHJldHVybiBjenhpZF87CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBp\nbml0RmllbGRzKCkgewogICAgICBob3N0bmFtZV8gPSAiIjsKICAgICAgY3p4\naWRfID0gMEw7CiAgICB9CiAgICBwcml2YXRlIGJ5dGUgbWVtb2l6ZWRJc0lu\naXRpYWxpemVkID0gLTE7CiAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0lu\naXRpYWxpemVkKCkgewogICAgICBieXRlIGlzSW5pdGlhbGl6ZWQgPSBtZW1v\naXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgIGlmIChpc0luaXRpYWxpemVkICE9\nIC0xKSByZXR1cm4gaXNJbml0aWFsaXplZCA9PSAxOwogICAgICAKICAgICAg\naWYgKCFoYXNIb3N0bmFtZSgpKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRp\nYWxpemVkID0gMDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAg\nICAgaWYgKCFoYXNDenhpZCgpKSB7CiAgICAgICAgbWVtb2l6ZWRJc0luaXRp\nYWxpemVkID0gMDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAg\nICAgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gMTsKICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgaWYgKCgoYml0\nRmllbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAg\nICAgb3V0cHV0LndyaXRlQnl0ZXMoMiwgZ2V0SG9zdG5hbWVCeXRlcygpKTsK\nICAgICAgfQogICAgICBpZiAoKChiaXRGaWVsZDBfICYgMHgwMDAwMDAwMikg\nPT0gMHgwMDAwMDAwMikpIHsKICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQo\nMywgY3p4aWRfKTsKICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCku\nd3JpdGVUbyhvdXRwdXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBt\nZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdl\ndFNlcmlhbGl6ZWRTaXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVk\nU2VyaWFsaXplZFNpemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4g\nc2l6ZTsKICAgIAogICAgICBzaXplID0gMDsKICAgICAgaWYgKCgoYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAg\nc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nCiAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgyLCBnZXRIb3N0bmFtZUJ5\ndGVzKCkpOwogICAgICB9CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAw\nMDAwMDAyKSA9PSAweDAwMDAwMDAyKSkgewogICAgICAgIHNpemUgKz0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAg\nLmNvbXB1dGVVSW50NjRTaXplKDMsIGN6eGlkXyk7CiAgICAgIH0KICAgICAg\nc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUo\nKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAg\nIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAwTDsKICAgIEBqYXZhLmxh\nbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZhLmxhbmcuT2JqZWN0IHdy\naXRlUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uT2JqZWN0U3Ry\nZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1cGVyLndyaXRlUmVwbGFj\nZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1YkluZm9EYXRhIHBh\ncnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5J\nbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZvRGF0YSBwYXJzZUZyb20oCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29n\nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZvRGF0YSBwYXJzZUZyb20o\nYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQo\nKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViSW5mb0RhdGEgcGFyc2VGcm9t\nKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuSHViSW5mb0RhdGEgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0g\naW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViSW5mb0RhdGEg\ncGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQs\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJ\nbmZvRGF0YSBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVh\nbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAg\naWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuSHViSW5mb0RhdGEgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAg\nICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAg\nIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5z\naW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZvRGF0YSBwYXJz\nZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0\nU3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5w\ndXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1Yklu\nZm9EYXRhIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRl\ncigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1YmxpYyBC\ndWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRl\ncigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJ\nbmZvRGF0YSBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1YmxpYyBCdWls\nZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7IH0K\nICAgIAogICAgQGphdmEubGFuZy5PdmVycmlkZQogICAgcHJvdGVjdGVkIEJ1\naWxkZXIgbmV3QnVpbGRlckZvclR5cGUoCiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXJQYXJlbnQgcGFyZW50\nKSB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKHBhcmVu\ndCk7CiAgICAgIHJldHVybiBidWlsZGVyOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWls\nZGVyPgogICAgICAgaW1wbGVtZW50cyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZvRGF0YU9yQnVpbGRlciB7CiAg\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9y\nKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0h1Yklu\nZm9EYXRhX2Rlc2NyaXB0b3I7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3Rl\nY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmll\nbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNj\nZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19IdWJJbmZvRGF0YV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICAgIH0K\nICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZvRGF0YS5uZXdC\ndWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkgewogICAgICAgIG1h\neWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKTsKICAgICAgfQogICAg\nICAKICAgICAgcHJpdmF0ZSBCdWlsZGVyKEJ1aWxkZXJQYXJlbnQgcGFyZW50\nKSB7CiAgICAgICAgc3VwZXIocGFyZW50KTsKICAgICAgICBtYXliZUZvcmNl\nQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAgICAgIH0KICAgICAgcHJpdmF0\nZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24oKSB7CiAg\nICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7CiAgICAgICAgfQogICAgICB9\nCiAgICAgIHByaXZhdGUgc3RhdGljIEJ1aWxkZXIgY3JlYXRlKCkgewogICAg\nICAgIHJldHVybiBuZXcgQnVpbGRlcigpOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAgICBzdXBlci5jbGVh\ncigpOwogICAgICAgIGhvc3RuYW1lXyA9ICIiOwogICAgICAgIGJpdEZpZWxk\nMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBjenhp\nZF8gPSAwTDsKICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+\nMHgwMDAwMDAwMik7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJl\ndHVybiBjcmVhdGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9y\nRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViSW5mb0RhdGEuZ2V0RGVzY3Jp\ncHRvcigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViSW5mb0RhdGEg\nZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHVi\nSW5mb0RhdGEuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5IdWJJbmZvRGF0YSBidWlsZCgpIHsKICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZv\nRGF0YSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJl\nc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1Vu\naW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAg\nIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuSHViSW5mb0RhdGEgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhy\nb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVy\nRXhjZXB0aW9uIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZvRGF0YSByZXN1bHQgPSBidWlsZFBh\ncnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkp\nIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhj\nZXB0aW9uKAogICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBy\nZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJJbmZvRGF0YSBi\ndWlsZFBhcnRpYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuSHViSW5mb0RhdGEgcmVzdWx0ID0gbmV3\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1\nYkluZm9EYXRhKHRoaXMpOwogICAgICAgIGludCBmcm9tX2JpdEZpZWxkMF8g\nPSBiaXRGaWVsZDBfOwogICAgICAgIGludCB0b19iaXRGaWVsZDBfID0gMDsK\nICAgICAgICBpZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9\nPSAweDAwMDAwMDAxKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAw\neDAwMDAwMDAxOwogICAgICAgIH0KICAgICAgICByZXN1bHQuaG9zdG5hbWVf\nID0gaG9zdG5hbWVfOwogICAgICAgIGlmICgoKGZyb21fYml0RmllbGQwXyAm\nIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpKSB7CiAgICAgICAgICB0b19i\naXRGaWVsZDBfIHw9IDB4MDAwMDAwMDI7CiAgICAgICAgfQogICAgICAgIHJl\nc3VsdC5jenhpZF8gPSBjenhpZF87CiAgICAgICAgcmVzdWx0LmJpdEZpZWxk\nMF8gPSB0b19iaXRGaWVsZDBfOwogICAgICAgIG9uQnVpbHQoKTsKICAgICAg\nICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdl\nIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViSW5mb0Rh\ndGEpIHsKICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1YkluZm9EYXRhKW90\naGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VG\ncm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9t\nKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1\nYkluZm9EYXRhIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1YkluZm9E\nYXRhLmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAg\nICBpZiAob3RoZXIuaGFzSG9zdG5hbWUoKSkgewogICAgICAgICAgc2V0SG9z\ndG5hbWUob3RoZXIuZ2V0SG9zdG5hbWUoKSk7CiAgICAgICAgfQogICAgICAg\nIGlmIChvdGhlci5oYXNDenhpZCgpKSB7CiAgICAgICAgICBzZXRDenhpZChv\ndGhlci5nZXRDenhpZCgpKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tZXJn\nZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGlj\nIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICBpZiAo\nIWhhc0hvc3RuYW1lKCkpIHsKICAgICAgICAgIAogICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIWhhc0N6eGlkKCkpIHsK\nICAgICAgICAgIAogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmll\nbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAg\nICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICB3\naGlsZSAodHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRU\nYWcoKTsKICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNh\nc2UgMDoKICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5r\nbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICBvbkNoYW5nZWQo\nKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgZGVm\nYXVsdDogewogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGQo\naW5wdXQsIHVua25vd25GaWVsZHMsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAg\nICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVs\nZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICBvbkNoYW5nZWQoKTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBj\nYXNlIDE4OiB7CiAgICAgICAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDAxOwogICAgICAgICAgICAgIGhvc3RuYW1lXyA9IGlucHV0LnJlYWRCeXRl\ncygpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGNhc2UgMjQ6IHsKICAgICAgICAgICAgICBiaXRGaWVsZDBfIHw9\nIDB4MDAwMDAwMDI7CiAgICAgICAgICAgICAgY3p4aWRfID0gaW5wdXQucmVh\nZFVJbnQ2NCgpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9\nCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICBw\ncml2YXRlIGludCBiaXRGaWVsZDBfOwogICAgICAKICAgICAgLy8gcmVxdWly\nZWQgc3RyaW5nIGhvc3RuYW1lID0gMjsKICAgICAgcHJpdmF0ZSBqYXZhLmxh\nbmcuT2JqZWN0IGhvc3RuYW1lXyA9ICIiOwogICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNIb3N0bmFtZSgpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAgICAg\ncHVibGljIFN0cmluZyBnZXRIb3N0bmFtZSgpIHsKICAgICAgICBqYXZhLmxh\nbmcuT2JqZWN0IHJlZiA9IGhvc3RuYW1lXzsKICAgICAgICBpZiAoIShyZWYg\naW5zdGFuY2VvZiBTdHJpbmcpKSB7CiAgICAgICAgICBTdHJpbmcgcyA9ICgo\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nKSByZWYpLnRvU3RyaW5n\nVXRmOCgpOwogICAgICAgICAgaG9zdG5hbWVfID0gczsKICAgICAgICAgIHJl\ndHVybiBzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4gKFN0\ncmluZykgcmVmOwogICAgICAgIH0KICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRIb3N0bmFtZShTdHJpbmcgdmFsdWUpIHsKICAgICAgICBpZiAo\ndmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgfQogIGJpdEZpZWxkMF8gfD0gMHgwMDAwMDAwMTsKICAg\nICAgICBob3N0bmFtZV8gPSB2YWx1ZTsKICAgICAgICBvbkNoYW5nZWQoKTsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBjbGVhckhvc3RuYW1lKCkgewogICAgICAgIGJpdEZpZWxkMF8gPSAo\nYml0RmllbGQwXyAmIH4weDAwMDAwMDAxKTsKICAgICAgICBob3N0bmFtZV8g\nPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRIb3N0bmFtZSgpOwogICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHZvaWQgc2V0SG9zdG5hbWUoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAweDAwMDAw\nMDAxOwogICAgICAgIGhvc3RuYW1lXyA9IHZhbHVlOwogICAgICAgIG9uQ2hh\nbmdlZCgpOwogICAgICB9CiAgICAgIAogICAgICAvLyByZXF1aXJlZCB1aW50\nNjQgY3p4aWQgPSAzOwogICAgICBwcml2YXRlIGxvbmcgY3p4aWRfIDsKICAg\nICAgcHVibGljIGJvb2xlYW4gaGFzQ3p4aWQoKSB7CiAgICAgICAgcmV0dXJu\nICgoYml0RmllbGQwXyAmIDB4MDAwMDAwMDIpID09IDB4MDAwMDAwMDIpOwog\nICAgICB9CiAgICAgIHB1YmxpYyBsb25nIGdldEN6eGlkKCkgewogICAgICAg\nIHJldHVybiBjenhpZF87CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0Q3p4aWQobG9uZyB2YWx1ZSkgewogICAgICAgIGJpdEZpZWxkMF8gfD0g\nMHgwMDAwMDAwMjsKICAgICAgICBjenhpZF8gPSB2YWx1ZTsKICAgICAgICBv\nbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICBwdWJsaWMgQnVpbGRlciBjbGVhckN6eGlkKCkgewogICAgICAgIGJpdEZp\nZWxkMF8gPSAoYml0RmllbGQwXyAmIH4weDAwMDAwMDAyKTsKICAgICAgICBj\nenhpZF8gPSAwTDsKICAgICAgICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5z\nZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLkh1YkluZm9EYXRh\nKQogICAgfQogICAgCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFu\nY2UgPSBuZXcgSHViSW5mb0RhdGEodHJ1ZSk7CiAgICAgIGRlZmF1bHRJbnN0\nYW5jZS5pbml0RmllbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9j\nX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuSHViSW5mb0Rh\ndGEpCiAgfQogIAogIHB1YmxpYyBpbnRlcmZhY2UgSHViTG9hZERhdGFPckJ1\naWxkZXIKICAgICAgZXh0ZW5kcyBjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3Nh\nZ2VPckJ1aWxkZXIgewogICAgCiAgICAvLyByZXF1aXJlZCB1aW50NjQgbnVt\nVG9waWNzID0gMjsKICAgIGJvb2xlYW4gaGFzTnVtVG9waWNzKCk7CiAgICBs\nb25nIGdldE51bVRvcGljcygpOwogIH0KICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGNsYXNzIEh1YkxvYWREYXRhIGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlCiAgICAgIGltcGxlbWVudHMgSHVi\nTG9hZERhdGFPckJ1aWxkZXIgewogICAgLy8gVXNlIEh1YkxvYWREYXRhLm5l\nd0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIEh1YkxvYWRE\nYXRhKEJ1aWxkZXIgYnVpbGRlcikgewogICAgICBzdXBlcihidWlsZGVyKTsK\nICAgIH0KICAgIHByaXZhdGUgSHViTG9hZERhdGEoYm9vbGVhbiBub0luaXQp\nIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIEh1YkxvYWREYXRh\nIGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgSHViTG9hZERh\ndGEgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVs\ndEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgSHViTG9hZERhdGEg\nZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRl\nZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBm\naW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19IdWJMb2FkRGF0YV9kZXNjcmlwdG9yOwogICAg\nfQogICAgCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVy\nbmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19IdWJMb2FkRGF0YV9maWVsZEFjY2Vzc29yVGFi\nbGU7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IGJpdEZpZWxkMF87CiAg\nICAvLyByZXF1aXJlZCB1aW50NjQgbnVtVG9waWNzID0gMjsKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IE5VTVRPUElDU19GSUVMRF9OVU1CRVIgPSAy\nOwogICAgcHJpdmF0ZSBsb25nIG51bVRvcGljc187CiAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNOdW1Ub3BpY3MoKSB7CiAgICAgIHJldHVybiAoKGJpdEZpZWxk\nMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAwMDAxKTsKICAgIH0KICAgIHB1\nYmxpYyBsb25nIGdldE51bVRvcGljcygpIHsKICAgICAgcmV0dXJuIG51bVRv\ncGljc187CiAgICB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRz\nKCkgewogICAgICBudW1Ub3BpY3NfID0gMEw7CiAgICB9CiAgICBwcml2YXRl\nIGJ5dGUgbWVtb2l6ZWRJc0luaXRpYWxpemVkID0gLTE7CiAgICBwdWJsaWMg\nZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBieXRlIGlz\nSW5pdGlhbGl6ZWQgPSBtZW1vaXplZElzSW5pdGlhbGl6ZWQ7CiAgICAgIGlm\nIChpc0luaXRpYWxpemVkICE9IC0xKSByZXR1cm4gaXNJbml0aWFsaXplZCA9\nPSAxOwogICAgICAKICAgICAgaWYgKCFoYXNOdW1Ub3BpY3MoKSkgewogICAg\nICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9IDA7CiAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICB9CiAgICAgIG1lbW9pemVkSXNJbml0aWFsaXplZCA9\nIDE7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwdWJsaWMg\ndm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6ZWRTaXpl\nKCk7CiAgICAgIGlmICgoKGJpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAw\neDAwMDAwMDAxKSkgewogICAgICAgIG91dHB1dC53cml0ZVVJbnQ2NCgyLCBu\ndW1Ub3BpY3NfKTsKICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCku\nd3JpdGVUbyhvdXRwdXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBt\nZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdl\ndFNlcmlhbGl6ZWRTaXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVk\nU2VyaWFsaXplZFNpemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4g\nc2l6ZTsKICAgIAogICAgICBzaXplID0gMDsKICAgICAgaWYgKCgoYml0Rmll\nbGQwXyAmIDB4MDAwMDAwMDEpID09IDB4MDAwMDAwMDEpKSB7CiAgICAgICAg\nc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nCiAgICAgICAgICAuY29tcHV0ZVVJbnQ2NFNpemUoMiwgbnVtVG9waWNzXyk7\nCiAgICAgIH0KICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0\nU2VyaWFsaXplZFNpemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6\nZSA9IHNpemU7CiAgICAgIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAw\nTDsKICAgIEBqYXZhLmxhbmcuT3ZlcnJpZGUKICAgIHByb3RlY3RlZCBqYXZh\nLmxhbmcuT2JqZWN0IHdyaXRlUmVwbGFjZSgpCiAgICAgICAgdGhyb3dzIGph\ndmEuaW8uT2JqZWN0U3RyZWFtRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIHN1\ncGVyLndyaXRlUmVwbGFjZSgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkh1YkxvYWREYXRhIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdv\nb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24g\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5i\ndWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJMb2FkRGF0\nYSBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAg\nIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJMb2Fk\nRGF0YSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0\nYSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViTG9h\nZERhdGEgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAg\nIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuSHViTG9hZERhdGEgcGFyc2VGcm9tKGphdmEu\naW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuSHViTG9hZERhdGEgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5w\ndXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5IdWJMb2FkRGF0YSBwYXJzZURlbGltaXRlZEZyb20oamF2\nYS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1\naWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9t\nKGlucHV0KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2Vk\nKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAg\nIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViTG9hZERhdGEgcGFyc2VEZWxp\nbWl0ZWRGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQs\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEu\naW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdC\ndWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJv\nbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJu\nIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAg\nICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5I\ndWJMb2FkRGF0YSBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkh1YkxvYWREYXRhIHBhcnNlRnJvbSgKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9F\neGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5i\ndWlsZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1\naWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7\nIH0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyBy\nZXR1cm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1aWxk\nZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5IdWJMb2FkRGF0YSBwcm90b3R5cGUpIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0K\nICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1\naWxkZXIodGhpcyk7IH0KICAgIAogICAgQGphdmEubGFuZy5PdmVycmlkZQog\nICAgcHJvdGVjdGVkIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxk\nZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\ndyBCdWlsZGVyKHBhcmVudCk7CiAgICAgIHJldHVybiBidWlsZGVyOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVu\nZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuQnVpbGRlcjxCdWlsZGVyPgogICAgICAgaW1wbGVtZW50cyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJMb2FkRGF0\nYU9yQnVpbGRlciB7CiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX0h1YkxvYWREYXRhX2Rlc2NyaXB0b3I7CiAgICAgIH0KICAg\nICAgCiAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgICBpbnRl\ncm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19IdWJMb2FkRGF0YV9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2lu\nZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5I\ndWJMb2FkRGF0YS5uZXdCdWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWlsZGVy\nKCkgewogICAgICAgIG1heWJlRm9yY2VCdWlsZGVySW5pdGlhbGl6YXRpb24o\nKTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBCdWlsZGVyKEJ1aWxk\nZXJQYXJlbnQgcGFyZW50KSB7CiAgICAgICAgc3VwZXIocGFyZW50KTsKICAg\nICAgICBtYXliZUZvcmNlQnVpbGRlckluaXRpYWxpemF0aW9uKCk7CiAgICAg\nIH0KICAgICAgcHJpdmF0ZSB2b2lkIG1heWJlRm9yY2VCdWlsZGVySW5pdGlh\nbGl6YXRpb24oKSB7CiAgICAgICAgaWYgKGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5hbHdheXNVc2VGaWVsZEJ1aWxkZXJzKSB7CiAg\nICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGUgc3RhdGljIEJ1aWxkZXIg\nY3JlYXRlKCkgewogICAgICAgIHJldHVybiBuZXcgQnVpbGRlcigpOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsKICAg\nICAgICBzdXBlci5jbGVhcigpOwogICAgICAgIG51bVRvcGljc18gPSAwTDsK\nICAgICAgICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAw\nMSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBjcmVh\ndGUoKS5tZXJnZUZyb20oYnVpbGRQYXJ0aWFsKCkpOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgp\nIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuSHViTG9hZERhdGEuZ2V0RGVzY3JpcHRvcigpOwog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViTG9hZERhdGEgZ2V0RGVmYXVs\ndEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViTG9hZERhdGEu\nZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5IdWJMb2FkRGF0YSBidWlsZCgpIHsKICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJMb2FkRGF0YSByZXN1\nbHQgPSBidWlsZFBhcnRpYWwoKTsKICAgICAgICBpZiAoIXJlc3VsdC5pc0lu\naXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6\nZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAg\nIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHVi\nTG9hZERhdGEgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5IdWJMb2FkRGF0YSByZXN1bHQgPSBidWlsZFBhcnRpYWwoKTsK\nICAgICAgICBpZiAoIXJlc3VsdC5pc0luaXRpYWxpemVkKCkpIHsKICAgICAg\nICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAog\nICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJMb2FkRGF0YSBidWlsZFBhcnRp\nYWwoKSB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuSHViTG9hZERhdGEgcmVzdWx0ID0gbmV3IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1YkxvYWREYXRh\nKHRoaXMpOwogICAgICAgIGludCBmcm9tX2JpdEZpZWxkMF8gPSBiaXRGaWVs\nZDBfOwogICAgICAgIGludCB0b19iaXRGaWVsZDBfID0gMDsKICAgICAgICBp\nZiAoKChmcm9tX2JpdEZpZWxkMF8gJiAweDAwMDAwMDAxKSA9PSAweDAwMDAw\nMDAxKSkgewogICAgICAgICAgdG9fYml0RmllbGQwXyB8PSAweDAwMDAwMDAx\nOwogICAgICAgIH0KICAgICAgICByZXN1bHQubnVtVG9waWNzXyA9IG51bVRv\ncGljc187CiAgICAgICAgcmVzdWx0LmJpdEZpZWxkMF8gPSB0b19iaXRGaWVs\nZDBfOwogICAgICAgIG9uQnVpbHQoKTsKICAgICAgICByZXR1cm4gcmVzdWx0\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZy\nb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAg\nICAgaWYgKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuSHViTG9hZERhdGEpIHsKICAgICAgICAg\nIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLkh1YkxvYWREYXRhKW90aGVyKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkh1YkxvYWREYXRhIG90aGVy\nKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkh1YkxvYWREYXRhLmdldERlZmF1bHRJ\nbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIuaGFz\nTnVtVG9waWNzKCkpIHsKICAgICAgICAgIHNldE51bVRvcGljcyhvdGhlci5n\nZXROdW1Ub3BpY3MoKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVyZ2VV\nbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBm\naW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgaWYgKCFo\nYXNOdW1Ub3BpY3MoKSkgewogICAgICAgICAgCiAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9\nCiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5w\ndXQsCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMg\nPQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRT\nZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmll\nbGRzKCkpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQg\ndGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0YWcp\nIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0\nVW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAg\nICAgICAgIG9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFw\nYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lz\ndHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25G\naWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAg\nIG9uQ2hhbmdlZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGNhc2UgMTY6IHsKICAgICAgICAgICAgICBiaXRG\naWVsZDBfIHw9IDB4MDAwMDAwMDE7CiAgICAgICAgICAgICAgbnVtVG9waWNz\nXyA9IGlucHV0LnJlYWRVSW50NjQoKTsKICAgICAgICAgICAgICBicmVhazsK\nICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQog\nICAgICAKICAgICAgcHJpdmF0ZSBpbnQgYml0RmllbGQwXzsKICAgICAgCiAg\nICAgIC8vIHJlcXVpcmVkIHVpbnQ2NCBudW1Ub3BpY3MgPSAyOwogICAgICBw\ncml2YXRlIGxvbmcgbnVtVG9waWNzXyA7CiAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc051bVRvcGljcygpIHsKICAgICAgICByZXR1cm4gKChiaXRGaWVsZDBf\nICYgMHgwMDAwMDAwMSkgPT0gMHgwMDAwMDAwMSk7CiAgICAgIH0KICAgICAg\ncHVibGljIGxvbmcgZ2V0TnVtVG9waWNzKCkgewogICAgICAgIHJldHVybiBu\ndW1Ub3BpY3NfOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE51\nbVRvcGljcyhsb25nIHZhbHVlKSB7CiAgICAgICAgYml0RmllbGQwXyB8PSAw\neDAwMDAwMDAxOwogICAgICAgIG51bVRvcGljc18gPSB2YWx1ZTsKICAgICAg\nICBvbkNoYW5nZWQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck51bVRvcGljcygpIHsKICAgICAg\nICBiaXRGaWVsZDBfID0gKGJpdEZpZWxkMF8gJiB+MHgwMDAwMDAwMSk7CiAg\nICAgICAgbnVtVG9waWNzXyA9IDBMOwogICAgICAgIG9uQ2hhbmdlZCgpOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBA\nQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3aWcu\nSHViTG9hZERhdGEpCiAgICB9CiAgICAKICAgIHN0YXRpYyB7CiAgICAgIGRl\nZmF1bHRJbnN0YW5jZSA9IG5ldyBIdWJMb2FkRGF0YSh0cnVlKTsKICAgICAg\nZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAg\nLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdp\nZy5IdWJMb2FkRGF0YSkKICB9CiAgCiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX01hcF9kZXNjcmlwdG9yOwogIHByaXZhdGUg\nc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19I\nZWR3aWdfTWFwX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0YXRp\nYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IK\nICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWFwX0VudHJ5X2Rlc2NyaXB0\nb3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19NYXBfRW50cnlfZmllbGRBY2Nlc3NvclRh\nYmxlOwogIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVz\nY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19NZXNzYWdlSGVhZGVyX2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMK\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVs\nZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19N\nZXNzYWdlSGVhZGVyX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0\nYXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZV9kZXNjcmlw\ndG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZV9maWVsZEFjY2Vzc29yVGFi\nbGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1JlZ2lvblNwZWNpZmljU2VxSWRfZGVzY3JpcHRvcjsKICBwcml2YXRlIHN0\nYXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICBpbnRlcm5hbF9zdGF0aWNfSGVk\nd2lnX1JlZ2lvblNwZWNpZmljU2VxSWRfZmllbGRBY2Nlc3NvclRhYmxlOwog\nIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRv\ncnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNz\nYWdlU2VxSWRfZGVzY3JpcHRvcjsKICBwcml2YXRlIHN0YXRpYwogICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZQogICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VT\nZXFJZF9maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29t\nLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlcXVlc3RfZGVzY3JpcHRv\ncjsKICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlcXVlc3RfZmllbGRBY2Nlc3Nv\nclRhYmxlOwogIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYu\nRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19QdWJsaXNoUmVxdWVzdF9kZXNjcmlwdG9yOwogIHByaXZhdGUgc3Rh\ndGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfUHVibGlzaFJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOwogIHByaXZh\ndGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVz\nY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRp\nb25QcmVmZXJlbmNlc19kZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRB\nY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vi\nc2NyaXB0aW9uUHJlZmVyZW5jZXNfZmllbGRBY2Nlc3NvclRhYmxlOwogIHBy\naXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMu\nRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3Jp\nYmVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vz\nc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3Jp\nYmVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0YXRp\nYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IK\nICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uT3B0aW9u\nc19kZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxl\nCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uT3B0\naW9uc19maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29t\nLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0NvbnN1bWVSZXF1ZXN0X2Rlc2NyaXB0\nb3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19Db25zdW1lUmVxdWVzdF9maWVsZEFjY2Vz\nc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX1Vuc3Vic2NyaWJlUmVxdWVzdF9kZXNjcmlwdG9yOwogIHByaXZh\ndGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRp\nY19IZWR3aWdfVW5zdWJzY3JpYmVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJs\nZTsKICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2Ny\naXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdf\nQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgcHJpdmF0\nZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RfZmllbGRBY2Nlc3Nv\nclRhYmxlOwogIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYu\nRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19TdG9wRGVsaXZlcnlSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgcHJpdmF0\nZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19TdG9wRGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJs\nZTsKICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2Ny\naXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdf\nU3RhcnREZWxpdmVyeVJlcXVlc3RfZGVzY3JpcHRvcjsKICBwcml2YXRlIHN0\nYXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICBpbnRlcm5hbF9zdGF0aWNfSGVk\nd2lnX1N0YXJ0RGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsK\nICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vi\nc2NyaXB0aW9uRXZlbnRSZXNwb25zZV9kZXNjcmlwdG9yOwogIHByaXZhdGUg\nc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19I\nZWR3aWdfU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZV9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVk\nd2lnX1B1YlN1YlJlc3BvbnNlX2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0\naWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5G\naWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19QdWJTdWJSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0\nZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNj\ncmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXNw\nb25zZV9kZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRh\nYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHVibGlzaFJlc3Bv\nbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0YXRpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaWJlUmVzcG9uc2VfZGVzY3Jp\ncHRvcjsKICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmliZVJlc3BvbnNlX2ZpZWxk\nQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0\nYXRpY19IZWR3aWdfUmVzcG9uc2VCb2R5X2Rlc2NyaXB0b3I7CiAgcHJpdmF0\nZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19SZXNwb25zZUJvZHlfZmllbGRBY2Nlc3NvclRhYmxlOwogIHBy\naXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMu\nRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3Jp\ncHRpb25TdGF0ZV9kZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nl\nc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2Ny\naXB0aW9uU3RhdGVfZmllbGRBY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3Rh\ndGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRv\ncgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25EYXRh\nX2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUK\nICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25EYXRh\nX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0YXRpYyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfTGVkZ2VyUmFuZ2VfZGVzY3JpcHRvcjsKICBw\ncml2YXRlIHN0YXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICBpbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX0xlZGdlclJhbmdlX2ZpZWxkQWNjZXNzb3JUYWJsZTsK\nICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTGVk\nZ2VyUmFuZ2VzX2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vz\nc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJS\nYW5nZXNfZmllbGRBY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3RhdGljIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\naW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NYW5hZ2VyTWV0YV9kZXNjcmlwdG9y\nOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdl\nbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfTWFuYWdlck1ldGFfZmllbGRBY2Nlc3NvclRh\nYmxlOwogIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVz\nY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19IdWJJbmZvRGF0YV9kZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRB\nY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfSHVi\nSW5mb0RhdGFfZmllbGRBY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3RhdGlj\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgog\nICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19IdWJMb2FkRGF0YV9kZXNjcmlw\ndG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfSHViTG9hZERhdGFfZmllbGRBY2Nlc3Nv\nclRhYmxlOwogIAogIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5GaWxlRGVzY3JpcHRvcgogICAgICBnZXREZXNjcmlw\ndG9yKCkgewogICAgcmV0dXJuIGRlc2NyaXB0b3I7CiAgfQogIHByaXZhdGUg\nc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURl\nc2NyaXB0b3IKICAgICAgZGVzY3JpcHRvcjsKICBzdGF0aWMgewogICAgamF2\nYS5sYW5nLlN0cmluZ1tdIGRlc2NyaXB0b3JEYXRhID0gewogICAgICAiXG4m\nc3JjL21haW4vcHJvdG9idWYvUHViU3ViUHJvdG9jb2wucHJvdG8iICsKICAg\nICAgIlwwMjJcMDA2SGVkd2lnXCJOXG5cMDAzTWFwXDAyMlwiXG5cMDA3ZW50\ncmllc1wwMzBcMDAxIFwwMDMoXDAxMzJcMDIxLkhlZHdpIiArCiAgICAgICJn\nLk1hcC5FbnRyeVwwMzIjXG5cMDA1RW50cnlcMDIyXDAxM1xuXDAwM2tleVww\nMzBcMDAxIFwwMDEoXHRcMDIyXHJcblwwMDV2YWwiICsKICAgICAgInVlXDAz\nMFwwMDIgXDAwMShcMDE0XCJFXG5cck1lc3NhZ2VIZWFkZXJcMDIyXDAzN1xu\nXG5wcm9wZXJ0aWVzXDAzMCIgKwogICAgICAiXDAwMSBcMDAxKFwwMTMyXDAx\nMy5IZWR3aWcuTWFwXDAyMlwwMjNcblwwMTNtZXNzYWdlVHlwZVwwMzBcMDAy\nIFwwMDEoXHRcIiIgKwogICAgICAidlxuXDAwN01lc3NhZ2VcMDIyXDAxNFxu\nXDAwNGJvZHlcMDMwXDAwMSBcMDAyKFwwMTRcMDIyXDAyMVxuXHRzcmNSZWdp\nb25cMDMwXDAwMiAiICsKICAgICAgIlwwMDEoXDAxNFwwMjIjXG5cMDA1bXNn\nSWRcMDMwXDAwMyBcMDAxKFwwMTMyXDAyNC5IZWR3aWcuTWVzc2FnZVNlcUlk\nIiArCiAgICAgICJcMDIyJVxuXDAwNmhlYWRlclwwMzBcMDA0IFwwMDEoXDAx\nMzJcMDI1LkhlZHdpZy5NZXNzYWdlSGVhZGVyXCIiICsKICAgICAgIjRcblww\nMjNSZWdpb25TcGVjaWZpY1NlcUlkXDAyMlwwMTZcblwwMDZyZWdpb25cMDMw\nXDAwMSBcMDAyKFwwMTRcMDIyXHIiICsKICAgICAgIlxuXDAwNXNlcUlkXDAz\nMFwwMDIgXDAwMihcMDA0XCJdXG5cMDE0TWVzc2FnZVNlcUlkXDAyMlwwMjZc\nblwwMTZsb2NhbENvIiwKICAgICAgIm1wb25lbnRcMDMwXDAwMSBcMDAxKFww\nMDRcMDIyNVxuXDAyMHJlbW90ZUNvbXBvbmVudHNcMDMwXDAwMiBcMDAzKFww\nMTMyIiArCiAgICAgICJcMDMzLkhlZHdpZy5SZWdpb25TcGVjaWZpY1NlcUlk\nXCJcMjY1XDAwNFxuXHJQdWJTdWJSIiArCiAgICAgICJlcXVlc3RcMDIyMFxu\nXDAxN3Byb3RvY29sVmVyc2lvblwwMzBcMDAxIFwwMDIoXDAxNjJcMDI3Lkhl\nZHdpZyIgKwogICAgICAiLlByb3RvY29sVmVyc2lvblwwMjIjXG5cMDA0dHlw\nZVwwMzBcMDAyIFwwMDIoXDAxNjJcMDI1LkhlZHdpZy4iICsKICAgICAgIk9w\nZXJhdGlvblR5cGVcMDIyXDAyNFxuXDAxNHRyaWVkU2VydmVyc1wwMzBcMDAz\nIFwwMDMoXDAxNFwwMjJcclxuXDAwNXQiICsKICAgICAgInhuSWRcMDMwXDAw\nNCBcMDAyKFwwMDRcMDIyXDAyM1xuXDAxM3Nob3VsZENsYWltXDAzMFwwMDUg\nXDAwMShcMDEwXDAyMlxyXG5cMDA1dG9waWMiICsKICAgICAgIlwwMzBcMDA2\nIFwwMDIoXDAxNFwwMjIuXG5cMDE2cHVibGlzaFJlcXVlc3RcMDMwNCBcMDAx\nKFwwMTMyXDAyNi5IZWR3aWcuIiArCiAgICAgICJQdWJsaXNoUmVxdWVzdFww\nMjIyXG5cMDIwc3Vic2NyaWJlUmVxdWVzdFwwMzA1IFwwMDEoXDAxMyIgKwog\nICAgICAiMlwwMzAuSGVkd2lnLlN1YnNjcmliZVJlcXVlc3RcMDIyLlxuXDAx\nNmNvbnN1bWVSZXEiICsKICAgICAgInVlc3RcMDMwNiBcMDAxKFwwMTMyXDAy\nNi5IZWR3aWcuQ29uc3VtZVJlcXVlc3RcMDIyNlxuXDAyMnVuIiwKICAgICAg\nInN1YnNjcmliZVJlcXVlc3RcMDMwNyBcMDAxKFwwMTMyXDAzMi5IZWR3aWcu\nVW5zdWJzY3IiICsKICAgICAgImliZVJlcXVlc3RcMDIyOFxuXDAyM3N0b3BE\nZWxpdmVyeVJlcXVlc3RcMDMwOCBcMDAxKFwwMTMyIiArCiAgICAgICJcMDMz\nLkhlZHdpZy5TdG9wRGVsaXZlcnlSZXF1ZXN0XDAyMjpcblwwMjRzdGFydERl\nbCIgKwogICAgICAiaXZlcnlSZXF1ZXN0XDAzMDkgXDAwMShcMDEzMlwwMzQu\nSGVkd2lnLlN0YXJ0RGVsaXZlciIgKwogICAgICAieVJlcXVlc3RcMDIyQlxu\nXDAzMGNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdFwwMzA6IFwwMDEiICsKICAg\nICAgIihcMDEzMiAuSGVkd2lnLkNsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdFwi\nLlxuXDAxNiIgKwogICAgICAiUHVibGlzaFJlcXVlc3RcMDIyXDAzNFxuXDAw\nM21zZ1wwMzBcMDAyIFwwMDIoXDAxMzJcMDE3LkhlZHdpZy5NZXMiICsKICAg\nICAgInNhZ2VcIlwxNzdcblwwMjdTdWJzY3JpcHRpb25QcmVmZXJlbmNlc1ww\nMjJcMDM0XG5cMDA3b3B0aW8iICsKICAgICAgIm5zXDAzMFwwMDEgXDAwMShc\nMDEzMlwwMTMuSGVkd2lnLk1hcFwwMjJcMDI0XG5cMDE0bWVzc2FnZUJvdW5k\nXDAzMFwwMDIgIiArCiAgICAgICJcMDAxKFxyXDAyMlwwMjVcblxybWVzc2Fn\nZUZpbHRlclwwMzBcMDAzIFwwMDEoXHRcMDIyXDAzMVxuXDAyMW1lc3NhZ2VX\naW4iLAogICAgICAiZG93U2l6ZVwwMzBcMDA0IFwwMDEoXHJcIlwyNzdcMDAy\nXG5cMDIwU3Vic2NyaWJlUmVxdWVzdFwwMjJcMDI0XG5cMDE0c3UiICsKICAg\nICAgImJzY3JpYmVySWRcMDMwXDAwMiBcMDAyKFwwMTRcMDIyUVxuXDAxNmNy\nZWF0ZU9yQXR0YWNoXDAzMFwwMDMgXDAwMShcMDE2IiArCiAgICAgICIyXCcu\nSGVkd2lnLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhYyIgKwogICAg\nICAiaDpcMDIwQ1JFQVRFX09SX0FUVEFDSFwwMjJcMDMyXG5cMDEzc3luY2hy\nb25vdXNcMDMwXDAwNCBcMDAxKFwwMTAiICsKICAgICAgIjpcMDA1ZmFsc2Vc\nMDIyXDAyNFxuXDAxNG1lc3NhZ2VCb3VuZFwwMzBcMDA1IFwwMDEoXHJcMDIy\nNFxuXDAxM3ByZWZlcmUiICsKICAgICAgIm5jZXNcMDMwXDAwNiBcMDAxKFww\nMTMyXDAzNy5IZWR3aWcuU3Vic2NyaXB0aW9uUHJlZmVyZW4iICsKICAgICAg\nImNlc1wwMjJcMDMyXG5cMDEzZm9yY2VBdHRhY2hcMDMwXDAwNyBcMDAxKFww\nMTA6XDAwNWZhbHNlXCI+XG5cMDE2Q3JlYXQiICsKICAgICAgImVPckF0dGFj\naFwwMjJcblxuXDAwNkNSRUFURVwwMjBcMDAwXDAyMlxuXG5cMDA2QVRUQUNI\nXDAyMFwwMDFcMDIyXDAyNFxuXDAyMENSRSIgKwogICAgICAiQVRFX09SX0FU\nVEFDSFwwMjBcMDAyXCJcMjE2XDAwMlxuXDAyM1N1YnNjcmlwdGlvbk9wdGlv\nbnNcMDIyIiArCiAgICAgICJcMDMyXG5cMDEzZm9yY2VBdHRhY2hcMDMwXDAw\nMSBcMDAxKFwwMTA6XDAwNWZhbHNlXDAyMlFcblwwMTZjcmVhdGVPckEiLAog\nICAgICAidHRhY2hcMDMwXDAwMiBcMDAxKFwwMTYyXCcuSGVkd2lnLlN1YnNj\ncmliZVJlcXVlc3QuQ3IiICsKICAgICAgImVhdGVPckF0dGFjaDpcMDIwQ1JF\nQVRFX09SX0FUVEFDSFwwMjJcMDI3XG5cMDE0bWVzc2FnIiArCiAgICAgICJl\nQm91bmRcMDMwXDAwMyBcMDAxKFxyOlwwMDEwXDAyMlwwMzRcblwwMDdvcHRp\nb25zXDAzMFwwMDQgXDAwMShcMDEzMlwwMTMuSGVkd2kiICsKICAgICAgImcu\nTWFwXDAyMlwwMjVcblxybWVzc2FnZUZpbHRlclwwMzBcMDA1IFwwMDEoXHRc\nMDIyXDAzMVxuXDAyMW1lc3NhZ2VXIiArCiAgICAgICJpbmRvd1NpemVcMDMw\nXDAwNiBcMDAxKFxyXDAyMlwwMzdcblwwMjFlbmFibGVSZXN1YnNjcmliZVww\nMzBcMDA3IFwwMDEiICsKICAgICAgIihcMDEwOlwwMDR0cnVlXCJLXG5cMDE2\nQ29uc3VtZVJlcXVlc3RcMDIyXDAyNFxuXDAxNHN1YnNjcmliZXIiICsKICAg\nICAgIklkXDAzMFwwMDIgXDAwMihcMDE0XDAyMiNcblwwMDVtc2dJZFwwMzBc\nMDAzIFwwMDIoXDAxMzJcMDI0LkhlZHdpZy5NZXNzYWdlIiArCiAgICAgICJT\nZXFJZFwiKlxuXDAyMlVuc3Vic2NyaWJlUmVxdWVzdFwwMjJcMDI0XG5cMDE0\nc3Vic2NyaWJlIiArCiAgICAgICJySWRcMDMwXDAwMiBcMDAyKFwwMTRcIjBc\nblwwMzBDbG9zZVN1YnNjcmlwdGlvblJlcXVlc3RcMDIyXDAyNFxuIiArCiAg\nICAgICJcMDE0c3Vic2NyaWJlcklkXDAzMFwwMDIgXDAwMihcMDE0XCIrXG5c\nMDIzU3RvcERlbGl2ZXJ5UmVxdWUiLAogICAgICAic3RcMDIyXDAyNFxuXDAx\nNHN1YnNjcmliZXJJZFwwMzBcMDAyIFwwMDIoXDAxNFwiLFxuXDAyNFN0YXJ0\nRGVsaXZlciIgKwogICAgICAieVJlcXVlc3RcMDIyXDAyNFxuXDAxNHN1YnNj\ncmliZXJJZFwwMzBcMDAyIFwwMDIoXDAxNFwiRVxuXDAzMVN1YnNjciIgKwog\nICAgICAiaXB0aW9uRXZlbnRSZXNwb25zZVwwMjIoXG5cMDA1ZXZlbnRcMDMw\nXDAwMSBcMDAxKFwwMTYyXDAzMS5IZWQiICsKICAgICAgIndpZy5TdWJzY3Jp\ncHRpb25FdmVudFwiXDM3N1wwMDFcblwwMTZQdWJTdWJSZXNwb25zZSIgKwog\nICAgICAiXDAyMjBcblwwMTdwcm90b2NvbFZlcnNpb25cMDMwXDAwMSBcMDAy\nKFwwMTYyXDAyNy5IZWR3aWcuUHJvdG8iICsKICAgICAgImNvbFZlcnNpb25c\nMDIyJlxuXG5zdGF0dXNDb2RlXDAzMFwwMDIgXDAwMihcMDE2MlwwMjIuSGVk\nd2lnLiIgKwogICAgICAiU3RhdHVzQ29kZVwwMjJcclxuXDAwNXR4bklkXDAz\nMFwwMDMgXDAwMihcMDA0XDAyMlwwMjFcblx0c3RhdHVzTXNnXDAzMFwwMDQi\nICsKICAgICAgIiBcMDAxKFx0XDAyMiBcblwwMDdtZXNzYWdlXDAzMFwwMDUg\nXDAwMShcMDEzMlwwMTcuSGVkd2lnLk1lc3NhZ2VcMDIyXHIiICsKICAgICAg\nIlxuXDAwNXRvcGljXDAzMFwwMDYgXDAwMShcMDE0XDAyMlwwMjRcblwwMTRz\ndWJzY3JpYmVySWRcMDMwXDAwNyBcMDAxKFwwMTRcMDIyKlxuXDAxNHIiICsK\nICAgICAgImVzcG9uc2VCb2R5XDAzMFwwMTAgXDAwMShcMDEzMlwwMjQuSGVk\nd2lnLlJlc3BvbnNlQm9keVwiIiwKICAgICAgIj9cblwwMTdQdWJsaXNoUmVz\ncG9uc2VcMDIyLFxuXDAxNnB1Ymxpc2hlZE1zZ0lkXDAzMFwwMDEgXDAwMiIg\nKwogICAgICAiKFwwMTMyXDAyNC5IZWR3aWcuTWVzc2FnZVNlcUlkXCJJXG5c\nMDIxU3Vic2NyaWJlUmVzIiArCiAgICAgICJwb25zZVwwMjI0XG5cMDEzcHJl\nZmVyZW5jZXNcMDMwXDAwMiBcMDAxKFwwMTMyXDAzNy5IZWR3aWcuU3VicyIg\nKwogICAgICAiY3JpcHRpb25QcmVmZXJlbmNlc1wiXDI2NFwwMDFcblwwMTRS\nZXNwb25zZUJvZHlcMDIyMFxuXDAxNyIgKwogICAgICAicHVibGlzaFJlc3Bv\nbnNlXDAzMFwwMDEgXDAwMShcMDEzMlwwMjcuSGVkd2lnLlB1Ymxpc2hSZSIg\nKwogICAgICAic3BvbnNlXDAyMjRcblwwMjFzdWJzY3JpYmVSZXNwb25zZVww\nMzBcMDAyIFwwMDEoXDAxMzJcMDMxLkhlZHciICsKICAgICAgImlnLlN1YnNj\ncmliZVJlc3BvbnNlXDAyMjxcblwwMjFzdWJzY3JpcHRpb25FdmVuIiArCiAg\nICAgICJ0XDAzMFwwMDMgXDAwMShcMDEzMiEuSGVkd2lnLlN1YnNjcmlwdGlv\nbkV2ZW50UmVzcG9uIiArCiAgICAgICJzZVwiTlxuXDAyMVN1YnNjcmlwdGlv\nblN0YXRlXDAyMiNcblwwMDVtc2dJZFwwMzBcMDAxIFwwMDIoXDAxMzJcMDI0\nIiArCiAgICAgICIuSGVkd2lnLk1lc3NhZ2VTZXFJZFwwMjJcMDI0XG5cMDE0\nbWVzc2FnZUJvdW5kXDAzMFwwMDIgXDAwMSIsCiAgICAgICIoXHJcInJcblww\nMjBTdWJzY3JpcHRpb25EYXRhXDAyMihcblwwMDVzdGF0ZVwwMzBcMDAxIFww\nMDEoXDAxMzJcMDMxLiIgKwogICAgICAiSGVkd2lnLlN1YnNjcmlwdGlvblN0\nYXRlXDAyMjRcblwwMTNwcmVmZXJlbmNlc1wwMzAiICsKICAgICAgIlwwMDIg\nXDAwMShcMDEzMlwwMzcuSGVkd2lnLlN1YnNjcmlwdGlvblByZWZlcmVuY2Vz\nXCJrIiArCiAgICAgICJcblwwMTNMZWRnZXJSYW5nZVwwMjJcMDIwXG5cMDEw\nbGVkZ2VySWRcMDMwXDAwMSBcMDAyKFwwMDRcMDIyLlxuXDAyMGVuZFNlIiAr\nCiAgICAgICJxSWRJbmNsdWRlZFwwMzBcMDAyIFwwMDEoXDAxMzJcMDI0Lkhl\nZHdpZy5NZXNzYWdlU2VxSWRcMDIyIiArCiAgICAgICJcMDMyXG5cMDIyc3Rh\ncnRTZXFJZEluY2x1ZGVkXDAzMFwwMDMgXDAwMShcMDA0XCIzXG5cMDE0TGVk\nZ2VyUmFuIiArCiAgICAgICJnZXNcMDIyI1xuXDAwNnJhbmdlc1wwMzBcMDAx\nIFwwMDMoXDAxMzJcMDIzLkhlZHdpZy5MZWRnZXJSYW5nZSIgKwogICAgICAi\nXCI6XG5cMDEzTWFuYWdlck1ldGFcMDIyXDAyM1xuXDAxM21hbmFnZXJJbXBs\nXDAzMFwwMDIgXDAwMihcdFwwMjJcMDI2XG5cMDE2IiArCiAgICAgICJtYW5h\nZ2VyVmVyc2lvblwwMzBcMDAzIFwwMDIoXHJcIi5cblwwMTNIdWJJbmZvRGF0\nYVwwMjJcMDIwXG5cMDEwaCIgKwogICAgICAib3N0bmFtZVwwMzBcMDAyIFww\nMDIoXHRcMDIyXHJcblwwMDVjenhpZFwwMzBcMDAzIFwwMDIoXDAwNFwiIFxu\nXDAxM0h1YkxvYWREIiwKICAgICAgImF0YVwwMjJcMDIxXG5cdG51bVRvcGlj\nc1wwMzBcMDAyIFwwMDIoXDAwNCpcIlxuXDAxN1Byb3RvY29sVmVyc2lvIiAr\nCiAgICAgICJuXDAyMlwwMTdcblwwMTNWRVJTSU9OX09ORVwwMjBcMDAxKlwy\nMDdcMDAxXG5cck9wZXJhdGlvblR5cGVcMDIyXDAxM1xuXDAwNyIgKwogICAg\nICAiUFVCTElTSFwwMjBcMDAwXDAyMlxyXG5cdFNVQlNDUklCRVwwMjBcMDAx\nXDAyMlwwMTNcblwwMDdDT05TVU1FXDAyMFwwMDJcMDIyXDAxN1xuIiArCiAg\nICAgICJcMDEzVU5TVUJTQ1JJQkVcMDIwXDAwM1wwMjJcMDIyXG5cMDE2U1RB\nUlRfREVMSVZFUllcMDIwXDAwNFwwMjJcMDIxXG5cclNUIiArCiAgICAgICJP\nUF9ERUxJVkVSWVwwMjBcMDA1XDAyMlwwMjVcblwwMjFDTE9TRVNVQlNDUklQ\nVElPTlwwMjBcMDA2KkRcblwwMjEiICsKICAgICAgIlN1YnNjcmlwdGlvbkV2\nZW50XDAyMlwwMTdcblwwMTNUT1BJQ19NT1ZFRFwwMjBcMDAxXDAyMlwwMzZc\nblwwMzJTVSIgKwogICAgICAiQlNDUklQVElPTl9GT1JDRURfQ0xPU0VEXDAy\nMFwwMDIqXDI0MVwwMDRcblxuU3RhdHVzQ29kIiArCiAgICAgICJlXDAyMlww\nMTNcblwwMDdTVUNDRVNTXDAyMFwwMDBcMDIyXDAyNlxuXDAyMU1BTEZPUk1F\nRF9SRVFVRVNUXDAyMFwyMjFcMDAzXDAyMlwwMjIiICsKICAgICAgIlxuXHJO\nT19TVUNIX1RPUElDXDAyMFwyMjJcMDAzXDAyMlwwMzZcblwwMzFDTElFTlRf\nQUxSRUFEWV9TVUIiICsKICAgICAgIlNDUklCRURcMDIwXDIyM1wwMDNcMDIy\nXDAzMlxuXDAyNUNMSUVOVF9OT1RfU1VCU0NSSUJFRFwwMjBcMjI0XDAwM1ww\nMjJcMDI2IiwKICAgICAgIlxuXDAyMUNPVUxEX05PVF9DT05ORUNUXDAyMFwy\nMjVcMDAzXDAyMlwwMTdcblxuVE9QSUNfQlVTWVwwMjBcMjI2XDAwM1wwMjIi\nICsKICAgICAgIlwwMzJcblwwMjVSRVNVQlNDUklCRV9FWENFUFRJT05cMDIw\nXDIyN1wwMDNcMDIyXDAzNlxuXDAzMU5PVF9SRVNQTyIgKwogICAgICAiTlNJ\nQkxFX0ZPUl9UT1BJQ1wwMjBcMzY1XDAwM1wwMjJcMDIxXG5cMDE0U0VSVklD\nRV9ET1dOXDAyMFwzNjZcMDAzXDAyMlwwMjQiICsKICAgICAgIlxuXDAxN1VO\nQ0VSVEFJTl9TVEFURVwwMjBcMzY3XDAwM1wwMjJcMDMzXG5cMDI2SU5WQUxJ\nRF9NRVNTQUdFXyIgKwogICAgICAiRklMVEVSXDAyMFwzNzBcMDAzXDAyMlww\nMjBcblwwMTNCQURfVkVSU0lPTlwwMjBcMjEwXDAwNFwwMjJcMDM2XG5cMDMx\nTk9fVE9QSUNfIiArCiAgICAgICJQRVJTSVNURU5DRV9JTkZPXDAyMFwyMTFc\nMDA0XDAyMlwiXG5cMDM1VE9QSUNfUEVSU0lTVEVOQ0UiICsKICAgICAgIl9J\nTkZPX0VYSVNUU1wwMjBcMjEyXDAwNFwwMjJcMDMyXG5cMDI1Tk9fU1VCU0NS\nSVBUSU9OX1NUQVRFIiArCiAgICAgICJcMDIwXDIxM1wwMDRcMDIyXDAzNlxu\nXDAzMVNVQlNDUklQVElPTl9TVEFURV9FWElTVFNcMDIwXDIxNFwwMDRcMDIy\nXDAzMFxuXDAyM04iICsKICAgICAgIk9fVE9QSUNfT1dORVJfSU5GT1wwMjBc\nMjE1XDAwNFwwMjJcMDM0XG5cMDI3VE9QSUNfT1dORVJfSU5GIiArCiAgICAg\nICJPX0VYSVNUU1wwMjBcMjE2XDAwNFwwMjJcMDMxXG5cMDI0VU5FWFBFQ1RF\nRF9DT05ESVRJT05cMDIwXDMzMFwwMDRcMDIyXDAxNiIsCiAgICAgICJcblx0\nQ09NUE9TSVRFXDAyMFwyNzRcMDA1QlwwMzZcblwwMzJvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90IiArCiAgICAgICJvY29sSFwwMDEiCiAgICB9OwogICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5GaWxlRGVzY3JpcHRvci5J\nbnRlcm5hbERlc2NyaXB0b3JBc3NpZ25lciBhc3NpZ25lciA9CiAgICAgIG5l\ndyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlw\ndG9yLkludGVybmFsRGVzY3JpcHRvckFzc2lnbmVyKCkgewogICAgICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5IGFz\nc2lnbkRlc2NyaXB0b3JzKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yIHJvb3QpIHsKICAgICAg\nICAgIGRlc2NyaXB0b3IgPSByb290OwogICAgICAgICAgaW50ZXJuYWxfc3Rh\ndGljX0hlZHdpZ19NYXBfZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdldERl\nc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMCk7CiAgICAgICAg\nICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01hcF9maWVsZEFjY2Vzc29yVGFi\nbGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAg\nICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01hcF9kZXNjcmlwdG9yLAogICAg\nICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiRW50cmllcyIs\nIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWFwLmNsYXNzLAogICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5CdWls\nZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdf\nTWFwX0VudHJ5X2Rlc2NyaXB0b3IgPQogICAgICAgICAgICBpbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX01hcF9kZXNjcmlwdG9yLmdldE5lc3RlZFR5cGVzKCku\nZ2V0KDApOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NYXBf\nRW50cnlfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vz\nc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19NYXBfRW50cnlfZGVzY3JpcHRvciwKICAgICAgICAgICAgICBuZXcgamF2\nYS5sYW5nLlN0cmluZ1tdIHsgIktleSIsICJWYWx1ZSIsIH0sCiAgICAgICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWFwLkVudHJ5LmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1hcC5FbnRyeS5CdWls\nZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdf\nTWVzc2FnZUhlYWRlcl9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgxKTsKICAgICAgICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZUhlYWRlcl9maWVsZEFj\nY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAg\nICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VIZWFk\nZXJfZGVzY3JpcHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0\ncmluZ1tdIHsgIlByb3BlcnRpZXMiLCAiTWVzc2FnZVR5cGUiLCB9LAogICAg\nICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VIZWFkZXIuY2xhc3MsCiAgICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZUhlYWRlci5CdWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0\nYXRpY19IZWR3aWdfTWVzc2FnZV9kZXNjcmlwdG9yID0KICAgICAgICAgICAg\nZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgyKTsKICAg\nICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZV9maWVsZEFj\nY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAg\nICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VfZGVz\nY3JpcHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1td\nIHsgIkJvZHkiLCAiU3JjUmVnaW9uIiwgIk1zZ0lkIiwgIkhlYWRlciIsIH0s\nCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZS5jbGFzcywKICAgICAgICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nLkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19SZWdpb25TcGVjaWZpY1NlcUlkX2Rlc2NyaXB0b3IgPQogICAgICAg\nICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDMp\nOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19SZWdpb25TcGVj\naWZpY1NlcUlkX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldwogICAgICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRB\nY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19I\nZWR3aWdfUmVnaW9uU3BlY2lmaWNTZXFJZF9kZXNjcmlwdG9yLAogICAgICAg\nICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiUmVnaW9uIiwgIlNl\ncUlkIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLmNsYXNz\nLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQuQnVpbGRlci5jbGFz\ncyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VT\nZXFJZF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigp\nLmdldE1lc3NhZ2VUeXBlcygpLmdldCg0KTsKICAgICAgICAgIGludGVybmFs\nX3N0YXRpY19IZWR3aWdfTWVzc2FnZVNlcUlkX2ZpZWxkQWNjZXNzb3JUYWJs\nZSA9IG5ldwogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZVNlcUlkX2Rlc2NyaXB0\nb3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJM\nb2NhbENvbXBvbmVudCIsICJSZW1vdGVDb21wb25lbnRzIiwgfSwKICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWQuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkLkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19QdWJTdWJSZXF1ZXN0X2Rlc2NyaXB0b3IgPQogICAgICAgICAg\nICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDUpOwog\nICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJTdWJSZXF1ZXN0\nX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldwogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRh\nYmxlKAogICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHVi\nU3ViUmVxdWVzdF9kZXNjcmlwdG9yLAogICAgICAgICAgICAgIG5ldyBqYXZh\nLmxhbmcuU3RyaW5nW10geyAiUHJvdG9jb2xWZXJzaW9uIiwgIlR5cGUiLCAi\nVHJpZWRTZXJ2ZXJzIiwgIlR4bklkIiwgIlNob3VsZENsYWltIiwgIlRvcGlj\nIiwgIlB1Ymxpc2hSZXF1ZXN0IiwgIlN1YnNjcmliZVJlcXVlc3QiLCAiQ29u\nc3VtZVJlcXVlc3QiLCAiVW5zdWJzY3JpYmVSZXF1ZXN0IiwgIlN0b3BEZWxp\ndmVyeVJlcXVlc3QiLCAiU3RhcnREZWxpdmVyeVJlcXVlc3QiLCAiQ2xvc2VT\ndWJzY3JpcHRpb25SZXF1ZXN0IiwgfSwKICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1\nZXN0LmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QuQnVpbGRlci5j\nbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxp\nc2hSZXF1ZXN0X2Rlc2NyaXB0b3IgPQogICAgICAgICAgICBnZXREZXNjcmlw\ndG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDYpOwogICAgICAgICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVzdF9maWVsZEFjY2Vz\nc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAg\nICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0\nX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJp\nbmdbXSB7ICJNc2ciLCB9LAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0LmNs\nYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0LkJ1aWxkZXIuY2xhc3Mp\nOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRp\nb25QcmVmZXJlbmNlc19kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg3KTsKICAgICAgICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uUHJlZmVyZW5j\nZXNfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29y\nVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19T\ndWJzY3JpcHRpb25QcmVmZXJlbmNlc19kZXNjcmlwdG9yLAogICAgICAgICAg\nICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiT3B0aW9ucyIsICJNZXNz\nYWdlQm91bmQiLCAiTWVzc2FnZUZpbHRlciIsICJNZXNzYWdlV2luZG93U2l6\nZSIsIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuY2xh\nc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMuQnVpbGRl\nci5jbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1\nYnNjcmliZVJlcXVlc3RfZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdldERl\nc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoOCk7CiAgICAgICAg\nICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmliZVJlcXVlc3RfZmll\nbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUo\nCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3Jp\nYmVSZXF1ZXN0X2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGphdmEu\nbGFuZy5TdHJpbmdbXSB7ICJTdWJzY3JpYmVySWQiLCAiQ3JlYXRlT3JBdHRh\nY2giLCAiU3luY2hyb25vdXMiLCAiTWVzc2FnZUJvdW5kIiwgIlByZWZlcmVu\nY2VzIiwgIkZvcmNlQXR0YWNoIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXF1ZXN0LmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQnVp\nbGRlci5jbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1N1YnNjcmlwdGlvbk9wdGlvbnNfZGVzY3JpcHRvciA9CiAgICAgICAgICAg\nIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoOSk7CiAg\nICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvbk9w\ndGlvbnNfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vz\nc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19TdWJzY3JpcHRpb25PcHRpb25zX2Rlc2NyaXB0b3IsCiAgICAgICAgICAg\nICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJGb3JjZUF0dGFjaCIsICJD\ncmVhdGVPckF0dGFjaCIsICJNZXNzYWdlQm91bmQiLCAiT3B0aW9ucyIsICJN\nZXNzYWdlRmlsdGVyIiwgIk1lc3NhZ2VXaW5kb3dTaXplIiwgIkVuYWJsZVJl\nc3Vic2NyaWJlIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25z\nLmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMuQnVpbGRl\nci5jbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0Nv\nbnN1bWVSZXF1ZXN0X2Rlc2NyaXB0b3IgPQogICAgICAgICAgICBnZXREZXNj\ncmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDEwKTsKICAgICAgICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfQ29uc3VtZVJlcXVlc3RfZmllbGRB\nY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAg\nICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19Db25zdW1lUmVx\ndWVzdF9kZXNjcmlwdG9yLAogICAgICAgICAgICAgIG5ldyBqYXZhLmxhbmcu\nU3RyaW5nW10geyAiU3Vic2NyaWJlcklkIiwgIk1zZ0lkIiwgfSwKICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5Db25zdW1lUmVxdWVzdC5jbGFzcywKICAgICAgICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1l\nUmVxdWVzdC5CdWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0\nYXRpY19IZWR3aWdfVW5zdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3IgPQog\nICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCku\nZ2V0KDExKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfVW5z\ndWJzY3JpYmVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldwogICAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAgIGludGVybmFsX3N0\nYXRpY19IZWR3aWdfVW5zdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3IsCiAg\nICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJTdWJzY3Jp\nYmVySWQiLCB9LAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdC5jbGFz\ncywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QuQnVpbGRlci5jbGFz\ncyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0Nsb3NlU3Vi\nc2NyaXB0aW9uUmVxdWVzdF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0\nRGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgxMik7CiAgICAg\nICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0Nsb3NlU3Vic2NyaXB0aW9u\nUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNj\nZXNzb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVk\nd2lnX0Nsb3NlU3Vic2NyaXB0aW9uUmVxdWVzdF9kZXNjcmlwdG9yLAogICAg\nICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiU3Vic2NyaWJl\ncklkIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5DbG9zZVN1YnNjcmlwdGlvblJlcXVlc3Qu\nY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ2xvc2VTdWJzY3JpcHRpb25SZXF1ZXN0LkJ1\naWxkZXIuY2xhc3MpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19TdG9wRGVsaXZlcnlSZXF1ZXN0X2Rlc2NyaXB0b3IgPQogICAgICAgICAg\nICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDEzKTsK\nICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2ZXJ5\nUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNj\nZXNzb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVk\nd2lnX1N0b3BEZWxpdmVyeVJlcXVlc3RfZGVzY3JpcHRvciwKICAgICAgICAg\nICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIlN1YnNjcmliZXJJZCIs\nIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdC5jbGFzcywKICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOwog\nICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdGFydERlbGl2ZXJ5\nUmVxdWVzdF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRv\ncigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgxNCk7CiAgICAgICAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX1N0YXJ0RGVsaXZlcnlSZXF1ZXN0X2ZpZWxk\nQWNjZXNzb3JUYWJsZSA9IG5ldwogICAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAog\nICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RhcnREZWxp\ndmVyeVJlcXVlc3RfZGVzY3JpcHRvciwKICAgICAgICAgICAgICBuZXcgamF2\nYS5sYW5nLlN0cmluZ1tdIHsgIlN1YnNjcmliZXJJZCIsIH0sCiAgICAgICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QuY2xhc3MsCiAgICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rh\ncnREZWxpdmVyeVJlcXVlc3QuQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvbkV2ZW50UmVzcG9u\nc2VfZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5n\nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTUpOwogICAgICAgICAgaW50ZXJuYWxf\nc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25FdmVudFJlc3BvbnNlX2ZpZWxk\nQWNjZXNzb3JUYWJsZSA9IG5ldwogICAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAog\nICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0\naW9uRXZlbnRSZXNwb25zZV9kZXNjcmlwdG9yLAogICAgICAgICAgICAgIG5l\ndyBqYXZhLmxhbmcuU3RyaW5nW10geyAiRXZlbnQiLCB9LAogICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2UuY2xhc3MsCiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uRXZlbnRSZXNwb25zZS5CdWlsZGVyLmNsYXNzKTsKICAg\nICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHViU3ViUmVzcG9uc2Vf\nZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRN\nZXNzYWdlVHlwZXMoKS5nZXQoMTYpOwogICAgICAgICAgaW50ZXJuYWxfc3Rh\ndGljX0hlZHdpZ19QdWJTdWJSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGUg\nPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlc3BvbnNlX2Rlc2NyaXB0\nb3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJQ\ncm90b2NvbFZlcnNpb24iLCAiU3RhdHVzQ29kZSIsICJUeG5JZCIsICJTdGF0\ndXNNc2ciLCAiTWVzc2FnZSIsICJUb3BpYyIsICJTdWJzY3JpYmVySWQiLCAi\nUmVzcG9uc2VCb2R5IiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZS5j\nbGFzcywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZS5CdWlsZGVyLmNsYXNz\nKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHVibGlzaFJl\nc3BvbnNlX2Rlc2NyaXB0b3IgPQogICAgICAgICAgICBnZXREZXNjcmlwdG9y\nKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDE3KTsKICAgICAgICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfUHVibGlzaFJlc3BvbnNlX2ZpZWxkQWNjZXNz\nb3JUYWJsZSA9IG5ldwogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAg\nICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHVibGlzaFJlc3BvbnNl\nX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJp\nbmdbXSB7ICJQdWJsaXNoZWRNc2dJZCIsIH0sCiAgICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlc3BvbnNlLmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZS5C\ndWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfU3Vic2NyaWJlUmVzcG9uc2VfZGVzY3JpcHRvciA9CiAgICAgICAgICAg\nIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTgpOwog\nICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpYmVSZXNw\nb25zZV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1N1YnNjcmliZVJlc3BvbnNlX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAg\nbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJQcmVmZXJlbmNlcyIsIH0sCiAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaWJlUmVzcG9uc2UuY2xhc3MsCiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1Jlc3BvbnNlQm9keV9kZXNjcmlwdG9y\nID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBl\ncygpLmdldCgxOSk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1Jlc3BvbnNlQm9keV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1Jlc3BvbnNlQm9keV9kZXNjcmlwdG9yLAogICAgICAgICAg\nICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiUHVibGlzaFJlc3BvbnNl\nIiwgIlN1YnNjcmliZVJlc3BvbnNlIiwgIlN1YnNjcmlwdGlvbkV2ZW50Iiwg\nfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5SZXNwb25zZUJvZHkuY2xhc3MsCiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUmVzcG9uc2VCb2R5LkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAgaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25TdGF0ZV9kZXNjcmlwdG9y\nID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBl\ncygpLmdldCgyMCk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1N1YnNjcmlwdGlvblN0YXRlX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldwog\nICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAgIGludGVybmFs\nX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uU3RhdGVfZGVzY3JpcHRvciwK\nICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIk1zZ0lk\nIiwgIk1lc3NhZ2VCb3VuZCIsIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nU3RhdGUuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUuQnVp\nbGRlci5jbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1N1YnNjcmlwdGlvbkRhdGFfZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdl\ndERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMjEpOwogICAg\nICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25EYXRh\nX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldwogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRh\nYmxlKAogICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vi\nc2NyaXB0aW9uRGF0YV9kZXNjcmlwdG9yLAogICAgICAgICAgICAgIG5ldyBq\nYXZhLmxhbmcuU3RyaW5nW10geyAiU3RhdGUiLCAiUHJlZmVyZW5jZXMiLCB9\nLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGEuY2xhc3MsCiAgICAgICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uRGF0YS5CdWlsZGVyLmNsYXNzKTsKICAgICAgICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfTGVkZ2VyUmFuZ2VfZGVzY3JpcHRv\nciA9CiAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlw\nZXMoKS5nZXQoMjIpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19MZWRnZXJSYW5nZV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZp\nZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX0xlZGdlclJhbmdlX2Rlc2NyaXB0b3IsCiAgICAgICAgICAg\nICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJMZWRnZXJJZCIsICJFbmRT\nZXFJZEluY2x1ZGVkIiwgIlN0YXJ0U2VxSWRJbmNsdWRlZCIsIH0sCiAgICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTGVkZ2VyUmFuZ2UuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFu\nZ2UuQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX0xlZGdlclJhbmdlc19kZXNjcmlwdG9yID0KICAgICAgICAgICAg\nZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgyMyk7CiAg\nICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0xlZGdlclJhbmdlc19m\naWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJs\nZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0xlZGdl\nclJhbmdlc19kZXNjcmlwdG9yLAogICAgICAgICAgICAgIG5ldyBqYXZhLmxh\nbmcuU3RyaW5nW10geyAiUmFuZ2VzIiwgfSwKICAgICAgICAgICAgICBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJS\nYW5nZXMuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzLkJ1aWxkZXIu\nY2xhc3MpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NYW5h\nZ2VyTWV0YV9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRv\ncigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgyNCk7CiAgICAgICAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX01hbmFnZXJNZXRhX2ZpZWxkQWNjZXNzb3JU\nYWJsZSA9IG5ldwogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdl\nbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAg\nICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWFuYWdlck1ldGFfZGVzY3Jp\ncHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsg\nIk1hbmFnZXJJbXBsIiwgIk1hbmFnZXJWZXJzaW9uIiwgfSwKICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NYW5hZ2VyTWV0YS5jbGFzcywKICAgICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NYW5hZ2VyTWV0YS5C\ndWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfSHViSW5mb0RhdGFfZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdldERl\nc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMjUpOwogICAgICAg\nICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19IdWJJbmZvRGF0YV9maWVsZEFj\nY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAg\nICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0h1YkluZm9EYXRh\nX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJp\nbmdbXSB7ICJIb3N0bmFtZSIsICJDenhpZCIsIH0sCiAgICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHVi\nSW5mb0RhdGEuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuSHViSW5mb0RhdGEuQnVpbGRl\nci5jbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0h1\nYkxvYWREYXRhX2Rlc2NyaXB0b3IgPQogICAgICAgICAgICBnZXREZXNjcmlw\ndG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDI2KTsKICAgICAgICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfSHViTG9hZERhdGFfZmllbGRBY2Nlc3Nv\nclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAg\nICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19IdWJMb2FkRGF0YV9kZXNj\ncmlwdG9yLAogICAgICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10g\neyAiTnVtVG9waWNzIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5IdWJMb2FkRGF0YS5jbGFz\ncywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5IdWJMb2FkRGF0YS5CdWlsZGVyLmNsYXNzKTsKICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfTsKICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3IK\nICAgICAgLmludGVybmFsQnVpbGRHZW5lcmF0ZWRGaWxlRnJvbShkZXNjcmlw\ndG9yRGF0YSwKICAgICAgICBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5GaWxlRGVzY3JpcHRvcltdIHsKICAgICAgICB9LCBhc3NpZ25l\ncik7CiAgfQogIAogIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChvdXRl\ncl9jbGFzc19zY29wZSkKfQo=\n","encoding":"base64"}

