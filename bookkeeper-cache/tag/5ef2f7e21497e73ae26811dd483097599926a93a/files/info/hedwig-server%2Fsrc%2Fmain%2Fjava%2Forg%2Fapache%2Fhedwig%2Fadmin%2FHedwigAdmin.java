{"sha":"3e78c6fa63be5836e5c63a18c22414b8293295aa","node_id":"MDQ6QmxvYjE1NzU5NTY6M2U3OGM2ZmE2M2JlNTgzNmU1YzYzYTE4YzIyNDE0YjgyOTMyOTVhYQ==","size":18823,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3e78c6fa63be5836e5c63a18c22414b8293295aa","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW47CgppbXBvcnQgamF2YS51\ndGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRv\ncjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1h\ncDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0\nY2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5C\nS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIudmVyc2lvbmluZy5WZXJzaW9uZWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkxlZGdlclJhbmdlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkRhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZl\nckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2\nZXIubWV0YS5NZXRhZGF0YU1hbmFnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuc2VydmVyLm1ldGEuRmFjdG9yeUxheW91dDsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5tZXRhLlN1YnNjcmlwdGlvbkRh\ndGFNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLm1l\ndGEuVG9waWNPd25lcnNoaXBNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuc2VydmVyLm1ldGEuVG9waWNQZXJzaXN0ZW5jZU1hbmFnZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuc3Vic2NyaXB0aW9ucy5J\nbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuc2VydmVyLnRvcGljcy5IdWJJbmZvOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuc2VydmVyLnRvcGljcy5IdWJMb2FkOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcudXRpbC5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnV0aWwuSGVkd2lnU29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5kYXRhLlN0YXQ7CgppbXBvcnQgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgY29tLmdvb2dsZS5wcm90b2J1Zi5J\nbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb247CgovKioKICogSGVkd2ln\nIEFkbWluCiAqLwpwdWJsaWMgY2xhc3MgSGVkd2lnQWRtaW4gewogICAgc3Rh\ndGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihIZWR3aWdBZG1pbi5jbGFzcyk7CgogICAgLy8gTk9URTogbm93IGl0IGlz\nIGZpeGVkIHBhc3N3ZCB1c2VkIGluIGhlZHdpZwogICAgc3RhdGljIGJ5dGVb\nXSBwYXNzd2QgPSAic2lsbHlzZWNyZXQiLmdldEJ5dGVzKCk7CgogICAgcHJv\ndGVjdGVkIGZpbmFsIFpvb0tlZXBlciB6azsKICAgIHByb3RlY3RlZCBmaW5h\nbCBCb29rS2VlcGVyIGJrOwogICAgcHJvdGVjdGVkIGZpbmFsIE1ldGFkYXRh\nTWFuYWdlckZhY3RvcnkgbW1GYWN0b3J5OwogICAgcHJvdGVjdGVkIGZpbmFs\nIFN1YnNjcmlwdGlvbkRhdGFNYW5hZ2VyIHNkbTsKICAgIHByb3RlY3RlZCBm\naW5hbCBUb3BpY093bmVyc2hpcE1hbmFnZXIgdG9tOwogICAgcHJvdGVjdGVk\nIGZpbmFsIFRvcGljUGVyc2lzdGVuY2VNYW5hZ2VyIHRwbTsKCiAgICAvLyBo\ndWIgY29uZmlndXJhdGlvbnMKICAgIHByb3RlY3RlZCBmaW5hbCBTZXJ2ZXJD\nb25maWd1cmF0aW9uIHNlcnZlckNvbmY7CiAgICAvLyBib29ra2VlcGVyIGNv\nbmZpZ3VyYXRpb25zCiAgICBwcm90ZWN0ZWQgZmluYWwgQ2xpZW50Q29uZmln\ndXJhdGlvbiBia0NsaWVudENvbmY7CgogICAgcHJvdGVjdGVkIGZpbmFsIENv\ndW50RG93bkxhdGNoIHprUmVhZHlMYXRjaCA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKCiAgICAvLyBFbXB0eSB3YXRjaGVyCiAgICBwcml2YXRlIGNsYXNz\nIE15V2F0Y2hlciBpbXBsZW1lbnRzIFdhdGNoZXIgewogICAgICAgIHB1Ymxp\nYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAg\nICAgIGlmIChFdmVudC5LZWVwZXJTdGF0ZS5TeW5jQ29ubmVjdGVkLmVxdWFs\ncyhldmVudC5nZXRTdGF0ZSgpKSkgewogICAgICAgICAgICAgICAgemtSZWFk\neUxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHN0YXRpYyBjbGFzcyBTeW5jT2JqPFQ+IHsKICAgICAgICBi\nb29sZWFuIGZpbmlzaGVkID0gZmFsc2U7CiAgICAgICAgYm9vbGVhbiBzdWNj\nZXNzID0gZmFsc2U7CiAgICAgICAgVCB2YWx1ZSA9IG51bGw7CiAgICAgICAg\nUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbiA9IG51bGw7CgogICAgICAgIHN5\nbmNocm9uaXplZCB2b2lkIHN1Y2Nlc3MoVCB2KSB7CiAgICAgICAgICAgIGZp\nbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgc3VjY2VzcyA9IHRydWU7CiAg\nICAgICAgICAgIHZhbHVlID0gdjsKICAgICAgICAgICAgbm90aWZ5KCk7CiAg\nICAgICAgfQoKICAgICAgICBzeW5jaHJvbml6ZWQgdm9pZCBmYWlsKFB1YlN1\nYkV4Y2VwdGlvbiBwc2UpIHsKICAgICAgICAgICAgZmluaXNoZWQgPSB0cnVl\nOwogICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgIGV4\nY2VwdGlvbiA9IHBzZTsKICAgICAgICAgICAgbm90aWZ5KCk7CiAgICAgICAg\nfQoKICAgICAgICBzeW5jaHJvbml6ZWQgdm9pZCBibG9jaygpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdoaWxlICghZmluaXNoZWQp\nIHsKICAgICAgICAgICAgICAgICAgICB3YWl0KCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGllKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN5bmNo\ncm9uaXplZCBib29sZWFuIGlzU3VjY2VzcygpIHsKICAgICAgICAgICAgcmV0\ndXJuIHN1Y2Nlc3M7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nU3RhdHMgb2YgYSBodWIKICAgICAqLwogICAgcHVibGljIHN0YXRpYyBjbGFz\ncyBIdWJTdGF0cyB7CiAgICAgICAgSHViSW5mbyBodWJJbmZvOwogICAgICAg\nIEh1YkxvYWQgaHViTG9hZDsKCiAgICAgICAgcHVibGljIEh1YlN0YXRzKEh1\nYkluZm8gaW5mbywgSHViTG9hZCBsb2FkKSB7CiAgICAgICAgICAgIHRoaXMu\naHViSW5mbyA9IGluZm87CiAgICAgICAgICAgIHRoaXMuaHViTG9hZCA9IGxv\nYWQ7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICBTdHJpbmdCdWls\nZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgc2Iu\nYXBwZW5kKCJpbmZvIDogWyIpLmFwcGVuZChodWJJbmZvLnRvU3RyaW5nKCku\ndHJpbSgpLnJlcGxhY2VBbGwoIlxuIiwgIiwgIikpCiAgICAgICAgICAgICAg\nLmFwcGVuZCgiXSwgbG9hZCA6IFsiKS5hcHBlbmQoaHViTG9hZC50b1N0cmlu\nZygpLnRyaW0oKS5yZXBsYWNlQWxsKCJcbiIsICIsICIpKQogICAgICAgICAg\nICAgIC5hcHBlbmQoIl0iKTsKICAgICAgICAgICAgcmV0dXJuIHNiLnRvU3Ry\naW5nKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSGVkd2ln\nIEFkbWluIENvbnN0cnVjdG9yCiAgICAgKgogICAgICogQHBhcmFtIGJrQ29u\nZgogICAgICogICAgICAgICAgQm9va0tlZXBlciBDbGllbnQgQ29uZmlndXJh\ndGlvbi4KICAgICAqIEBwYXJhbSBodWJDb25mCiAgICAgKiAgICAgICAgICBI\ndWIgU2VydmVyIENvbmZpZ3VyYXRpb24uCiAgICAgKiBAdGhyb3dzIEV4Y2Vw\ndGlvbgogICAgICovCiAgICBwdWJsaWMgSGVkd2lnQWRtaW4oQ2xpZW50Q29u\nZmlndXJhdGlvbiBia0NvbmYsIFNlcnZlckNvbmZpZ3VyYXRpb24gaHViQ29u\nZikgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5zZXJ2ZXJDb25m\nID0gaHViQ29uZjsKICAgICAgICB0aGlzLmJrQ2xpZW50Q29uZiA9IGJrQ29u\nZjsKCiAgICAgICAgLy8gY29ubmVjdCB0byB6b29rZWVwZXIKICAgICAgICB6\nayA9IG5ldyBab29LZWVwZXIoaHViQ29uZi5nZXRaa0hvc3QoKSwgaHViQ29u\nZi5nZXRaa1RpbWVvdXQoKSwgbmV3IE15V2F0Y2hlcigpKTsKICAgICAgICBM\nT0cuZGVidWcoIkNvbm5lY3RpbmcgdG8gem9va2VlcGVyIHt9LCB0aW1lb3V0\nID0ge30iLAogICAgICAgICAgICAgICAgaHViQ29uZi5nZXRaa0hvc3QoKSwg\naHViQ29uZi5nZXRaa1RpbWVvdXQoKSk7CiAgICAgICAgLy8gd2FpdCB1bnRp\nbCBjb25uZWN0aW9uIGlzIHJlYWR5CiAgICAgICAgaWYgKCF6a1JlYWR5TGF0\nY2guYXdhaXQoaHViQ29uZi5nZXRaa1RpbWVvdXQoKSAqIDIsIFRpbWVVbml0\nLk1JTExJU0VDT05EUykpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2Vw\ndGlvbigiQ291bnQgbm90IGVzdGFibGlzaCBjb25uZWN0aW9uIHdpdGggWm9v\nS2VlcGVyIGFmdGVyICIgKyBodWJDb25mLmdldFprVGltZW91dCgpICogMiAr\nICIgbXMuIik7CiAgICAgICAgfQoKICAgICAgICAvLyBjb25zdHJ1Y3QgdGhl\nIG1ldGFkYXRhIG1hbmFnZXIgZmFjdG9yeQogICAgICAgIG1tRmFjdG9yeSA9\nIE1ldGFkYXRhTWFuYWdlckZhY3RvcnkubmV3TWV0YWRhdGFNYW5hZ2VyRmFj\ndG9yeShodWJDb25mLCB6ayk7CiAgICAgICAgdHBtID0gbW1GYWN0b3J5Lm5l\nd1RvcGljUGVyc2lzdGVuY2VNYW5hZ2VyKCk7CiAgICAgICAgdG9tID0gbW1G\nYWN0b3J5Lm5ld1RvcGljT3duZXJzaGlwTWFuYWdlcigpOwogICAgICAgIHNk\nbSA9IG1tRmFjdG9yeS5uZXdTdWJzY3JpcHRpb25EYXRhTWFuYWdlcigpOwoK\nICAgICAgICAvLyBjb25uZWN0IHRvIGJvb2trZWVwZXIKICAgICAgICBiayA9\nIG5ldyBCb29rS2VlcGVyKGJrQ2xpZW50Q29uZiwgemspOwogICAgICAgIExP\nRy5kZWJ1ZygiQ29ubmVjdGluZyB0byBib29ra2VlcGVyIik7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDbG9zZSB0aGUgaGVkd2lnIGFkbWluLgogICAgICoK\nICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIGNsb3NlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdHBtLmNs\nb3NlKCk7CiAgICAgICAgdG9tLmNsb3NlKCk7CiAgICAgICAgc2RtLmNsb3Nl\nKCk7CiAgICAgICAgbW1GYWN0b3J5LnNodXRkb3duKCk7CiAgICAgICAgYmsu\nY2xvc2UoKTsKICAgICAgICB6ay5jbG9zZSgpOwogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHpvb2tlZXBlciBoYW5kbGUgdXNlZCBpbiBoZWR3aWcg\nYWRtaW4uCiAgICAgKgogICAgICogQHJldHVybiB6b29rZWVwZXIgaGFuZGxl\nCiAgICAgKi8KICAgIHB1YmxpYyBab29LZWVwZXIgZ2V0WmtIYW5kbGUoKSB7\nCiAgICAgICAgcmV0dXJuIHprOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIGJvb2trZWVwZXIgaGFuZGxlIHVzZWQgaW4gaGVkd2lnIGFkbWluLgog\nICAgICoKICAgICAqIEByZXR1cm4gYm9va2tlZXBlciBoYW5kbGUKICAgICAq\nLwogICAgcHVibGljIEJvb2tLZWVwZXIgZ2V0QmtIYW5kbGUoKSB7CiAgICAg\nICAgcmV0dXJuIGJrOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGh1\nYiBzZXJ2ZXIgY29uZmlndXJhdGlvbiB1c2VkIGluIGhlZHdpZyBhZG1pbgog\nICAgICoKICAgICAqIEByZXR1cm4gaHViIHNlcnZlciBjb25maWd1cmF0aW9u\nCiAgICAgKi8KICAgIHB1YmxpYyBTZXJ2ZXJDb25maWd1cmF0aW9uIGdldEh1\nYlNlcnZlckNvbmYoKSB7CiAgICAgICAgcmV0dXJuIHNlcnZlckNvbmY7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gbWV0YWRhdGEgbWFuYWdlciBm\nYWN0b3J5LgogICAgICoKICAgICAqIEByZXR1cm4gbWV0YWRhdGEgbWFuYWdl\nciBmYWN0b3J5IGluc3RhbmNlLgogICAgICovCiAgICBwdWJsaWMgTWV0YWRh\ndGFNYW5hZ2VyRmFjdG9yeSBnZXRNZXRhZGF0YU1hbmFnZXJGYWN0b3J5KCkg\newogICAgICAgIHJldHVybiBtbUZhY3Rvcnk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBSZXR1cm4gYm9va2VlcGVyIHBhc3N3ZCB1c2VkIGluIGhlZHdpZyBh\nZG1pbgogICAgICoKICAgICAqIEByZXR1cm4gYm9va2VlcGVyIHBhc3N3ZAog\nICAgICovCiAgICBwdWJsaWMgYnl0ZVtdIGdldEJrUGFzc3dkKCkgewogICAg\nICAgIHJldHVybiBBcnJheXMuY29weU9mKHBhc3N3ZCwgcGFzc3dkLmxlbmd0\naCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm4gZGlnZXN0IHR5cGUg\ndXNlZCBpbiBoZWR3aWcgYWRtaW4KICAgICAqCiAgICAgKiBAcmV0dXJuIGJv\nb2tlZXBlciBkaWdlc3QgdHlwZQogICAgICovCiAgICBwdWJsaWMgRGlnZXN0\nVHlwZSBnZXRCa0RpZ2VzdFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIERpZ2Vz\ndFR5cGUuQ1JDMzI7CiAgICB9CgogICAgLyoqCiAgICAgKiBEb3NlIHRvcGlj\nIGV4aXN0PwogICAgICoKICAgICAqIEBwYXJhbSB0b3BpYwogICAgICogICAg\nICAgICAgICBUb3BpYyBuYW1lCiAgICAgKiBAcmV0dXJuIHdoZXRoZXIgdG9w\naWMgZXhpc3RzIG9yIG5vdD8KICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGhhc1RvcGljKEJ5dGVTdHJpbmcg\ndG9waWMpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIGN1cnJlbnQg\ncGVyc2lzdGVuY2UgaW5mbyBpcyBib3VuZCB3aXRoIGEgdG9waWMsIHNvIGlm\nIHRoZXJlIGlzIHBlcnNpc3RlbmNlIGluZm8KICAgICAgICAvLyB0aGVyZSBp\ncyB0b3BpYy4KICAgICAgICBmaW5hbCBTeW5jT2JqPEJvb2xlYW4+IHN5bmNP\nYmogPSBuZXcgU3luY09iajxCb29sZWFuPigpOwogICAgICAgIHRwbS5yZWFk\nVG9waWNQZXJzaXN0ZW5jZUluZm8odG9waWMsIG5ldyBDYWxsYmFjazxWZXJz\naW9uZWQ8TGVkZ2VyUmFuZ2VzPj4oKSB7CiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChP\nYmplY3QgY3R4LCBWZXJzaW9uZWQ8TGVkZ2VyUmFuZ2VzPiByZXN1bHQpIHsK\nICAgICAgICAgICAgICAgIGlmIChudWxsID09IHJlc3VsdCkgewogICAgICAg\nICAgICAgICAgICAgIHN5bmNPYmouc3VjY2VzcyhmYWxzZSk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN5bmNPYmou\nc3VjY2Vzcyh0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZv\naWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlv\nbiBwc2UpIHsKICAgICAgICAgICAgICAgIHN5bmNPYmouZmFpbChwc2UpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSwgc3luY09iaik7CgogICAgICAgIHN5\nbmNPYmouYmxvY2soKTsKCiAgICAgICAgaWYgKCFzeW5jT2JqLmlzU3VjY2Vz\ncygpKSB7CiAgICAgICAgICAgIHRocm93IHN5bmNPYmouZXhjZXB0aW9uOwog\nICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN5bmNPYmoudmFsdWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZXQgYXZhaWxhYmxlIGh1YnMuCiAgICAgKgog\nICAgICogQHJldHVybiBhdmFpbGFibGUgaHVicyBhbmQgdGhlaXIgbG9hZHMK\nICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBN\nYXA8SGVkd2lnU29ja2V0QWRkcmVzcywgSHViU3RhdHM+IGdldEF2YWlsYWJs\nZUh1YnMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgemtI\ndWJzUGF0aCA9IHNlcnZlckNvbmYuZ2V0WmtIb3N0c1ByZWZpeChuZXcgU3Ry\naW5nQnVpbGRlcigpKS50b1N0cmluZygpOwogICAgICAgIE1hcDxIZWR3aWdT\nb2NrZXRBZGRyZXNzLCBIdWJTdGF0cz4gaHVicyA9CiAgICAgICAgICAgIG5l\ndyBIYXNoTWFwPEhlZHdpZ1NvY2tldEFkZHJlc3MsIEh1YlN0YXRzPigpOwog\nICAgICAgIExpc3Q8U3RyaW5nPiBob3N0cyA9IHprLmdldENoaWxkcmVuKHpr\nSHVic1BhdGgsIGZhbHNlKTsKICAgICAgICBmb3IgKFN0cmluZyBob3N0IDog\naG9zdHMpIHsKICAgICAgICAgICAgU3RyaW5nIHprSHViUGF0aCA9IHNlcnZl\nckNvbmYuZ2V0WmtIb3N0c1ByZWZpeChuZXcgU3RyaW5nQnVpbGRlcigpKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBl\nbmQoIi8iKS5hcHBlbmQoaG9zdCkudG9TdHJpbmcoKTsKICAgICAgICAgICAg\nSGVkd2lnU29ja2V0QWRkcmVzcyBhZGRyID0gbmV3IEhlZHdpZ1NvY2tldEFk\nZHJlc3MoaG9zdCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBTdGF0IHN0YXQgPSBuZXcgU3RhdCgpOwogICAgICAgICAgICAgICAgYnl0\nZVtdIGRhdGEgPSB6ay5nZXREYXRhKHprSHViUGF0aCwgZmFsc2UsIHN0YXQp\nOwogICAgICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgSHViTG9hZCBsb2FkID0gSHViTG9hZC5wYXJzZShuZXcg\nU3RyaW5nKGRhdGEpKTsKICAgICAgICAgICAgICAgIEh1YkluZm8gaW5mbyA9\nIG5ldyBIdWJJbmZvKGFkZHIsIHN0YXQuZ2V0Q3p4aWQoKSk7CiAgICAgICAg\nICAgICAgICBodWJzLnB1dChhZGRyLCBuZXcgSHViU3RhdHMoaW5mbywgbG9h\nZCkpOwogICAgICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgICAgIExPRy53YXJuKCJDb3VsZG4ndCByZWFkIGh1\nYiBkYXRhIGZyb20gWm9vS2VlcGVyIiwga2UpOwogICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAg\nICAgTE9HLndhcm4oIkludGVycnVwdGVkIGR1cmluZyByZWFkIiwgaWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBodWJzOwog\nICAgfQoKICAgIC8qKgogICAgICogR2V0IGxpc3Qgb2YgdG9waWNzCiAgICAg\nKgogICAgICogQHJldHVybiBsaXN0IG9mIHRvcGljcwogICAgICogQHRocm93\ncyBFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIEl0ZXJhdG9yPEJ5dGVT\ndHJpbmc+IGdldFRvcGljcygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBtbUZhY3RvcnkuZ2V0VG9waWNzKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIHRvcGljIG93bmVyIG9mIGEgdG9waWMKICAg\nICAqCiAgICAgKiBAcGFyYW0gdG9waWMKICAgICAqICAgICAgICAgICAgVG9w\naWMgbmFtZQogICAgICogQHJldHVybiB0aGUgYWRkcmVzcyBvZiB0aGUgb3du\nZXIgb2YgYSB0b3BpYwogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAq\nLwogICAgcHVibGljIEh1YkluZm8gZ2V0VG9waWNPd25lcihCeXRlU3RyaW5n\nIHRvcGljKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBTeW5j\nT2JqPEh1YkluZm8+IHN5bmNPYmogPSBuZXcgU3luY09iajxIdWJJbmZvPigp\nOwogICAgICAgIHRvbS5yZWFkT3duZXJJbmZvKHRvcGljLCBuZXcgQ2FsbGJh\nY2s8VmVyc2lvbmVkPEh1YkluZm8+PigpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVk\nKE9iamVjdCBjdHgsIFZlcnNpb25lZDxIdWJJbmZvPiByZXN1bHQpIHsKICAg\nICAgICAgICAgICAgIGlmIChudWxsID09IHJlc3VsdCkgewogICAgICAgICAg\nICAgICAgICAgIHN5bmNPYmouc3VjY2VzcyhudWxsKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3luY09iai5zdWNj\nZXNzKHJlc3VsdC5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1\nYkV4Y2VwdGlvbiBwc2UpIHsKICAgICAgICAgICAgICAgIHN5bmNPYmouZmFp\nbChwc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgc3luY09iaik7Cgog\nICAgICAgIHN5bmNPYmouYmxvY2soKTsKCiAgICAgICAgaWYgKCFzeW5jT2Jq\nLmlzU3VjY2VzcygpKSB7CiAgICAgICAgICAgIHRocm93IHN5bmNPYmouZXhj\nZXB0aW9uOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHN5bmNPYmoudmFs\ndWU7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgTGVkZ2VyUmFuZ2UgYnVp\nbGRMZWRnZXJSYW5nZShsb25nIGxlZGdlcklkLCBsb25nIHN0YXJ0T2ZMZWRn\nZXIsIE1lc3NhZ2VTZXFJZCBlbmRPZkxlZGdlcikgewogICAgICAgIExlZGdl\nclJhbmdlLkJ1aWxkZXIgYnVpbGRlciA9CiAgICAgICAgICAgIExlZGdlclJh\nbmdlLm5ld0J1aWxkZXIoKS5zZXRMZWRnZXJJZChsZWRnZXJJZCkuc2V0U3Rh\ncnRTZXFJZEluY2x1ZGVkKHN0YXJ0T2ZMZWRnZXIpCiAgICAgICAgICAgICAg\nICAgICAgICAgLnNldEVuZFNlcUlkSW5jbHVkZWQoZW5kT2ZMZWRnZXIpOwog\nICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkKCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZXR1cm4gdGhlIGxlZGdlciByYW5nZSBmb3JtaW5nIHRoZSB0\nb3BpYwogICAgICoKICAgICAqIEBwYXJhbSB0b3BpYwogICAgICogICAgICAg\nICAgVG9waWMgbmFtZQogICAgICogQHJldHVybiBsZWRnZXIgcmFuZ2VzIGZv\ncm1pbmcgdGhlIHRvcGljCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAg\nICovCiAgICBwdWJsaWMgTGlzdDxMZWRnZXJSYW5nZT4gZ2V0VG9waWNMZWRn\nZXJzKEJ5dGVTdHJpbmcgdG9waWMpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGZpbmFsIFN5bmNPYmo8TGVkZ2VyUmFuZ2VzPiBzeW5jT2JqID0gbmV3\nIFN5bmNPYmo8TGVkZ2VyUmFuZ2VzPigpOwogICAgICAgIHRwbS5yZWFkVG9w\naWNQZXJzaXN0ZW5jZUluZm8odG9waWMsIG5ldyBDYWxsYmFjazxWZXJzaW9u\nZWQ8TGVkZ2VyUmFuZ2VzPj4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmpl\nY3QgY3R4LCBWZXJzaW9uZWQ8TGVkZ2VyUmFuZ2VzPiByZXN1bHQpIHsKICAg\nICAgICAgICAgICAgIGlmIChudWxsID09IHJlc3VsdCkgewogICAgICAgICAg\nICAgICAgICAgIHN5bmNPYmouc3VjY2VzcyhudWxsKTsKICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgc3luY09iai5zdWNj\nZXNzKHJlc3VsdC5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1\nYkV4Y2VwdGlvbiBwc2UpIHsKICAgICAgICAgICAgICAgIHN5bmNPYmouZmFp\nbChwc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgc3luY09iaik7Cgog\nICAgICAgIHN5bmNPYmouYmxvY2soKTsKCiAgICAgICAgaWYgKCFzeW5jT2Jq\nLmlzU3VjY2VzcygpKSB7CiAgICAgICAgICAgIHRocm93IHN5bmNPYmouZXhj\nZXB0aW9uOwogICAgICAgIH0KCiAgICAgICAgTGVkZ2VyUmFuZ2VzIHJhbmdl\ncyA9IHN5bmNPYmoudmFsdWU7CiAgICAgICAgaWYgKG51bGwgPT0gcmFuZ2Vz\nKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAg\nICBMaXN0PExlZGdlclJhbmdlPiByZXN1bHRzID0gbmV3IEFycmF5TGlzdDxM\nZWRnZXJSYW5nZT4oKTsKICAgICAgICBMaXN0PExlZGdlclJhbmdlPiBscnMg\nPSByYW5nZXMuZ2V0UmFuZ2VzTGlzdCgpOwogICAgICAgIGxvbmcgc3RhcnRT\nZXFJZCA9IDFMOwogICAgICAgIGlmICghbHJzLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICBMZWRnZXJSYW5nZSByYW5nZSA9IGxycy5nZXQoMCk7CiAgICAg\nICAgICAgIGlmICghcmFuZ2UuaGFzU3RhcnRTZXFJZEluY2x1ZGVkKCkgJiYg\ncmFuZ2UuaGFzRW5kU2VxSWRJbmNsdWRlZCgpKSB7CiAgICAgICAgICAgICAg\nICBsb25nIGxlZGdlcklkID0gcmFuZ2UuZ2V0TGVkZ2VySWQoKTsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoID0gYmsub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIERp\nZ2VzdFR5cGUuQ1JDMzIsIHBhc3N3ZCk7CiAgICAgICAgICAgICAgICAgICAg\nbG9uZyBudW1FbnRyaWVzID0gbGgucmVhZExhc3RDb25maXJtZWQoKSArIDE7\nCiAgICAgICAgICAgICAgICAgICAgbG9uZyBlbmRPZkxlZGdlciA9IHJhbmdl\nLmdldEVuZFNlcUlkSW5jbHVkZWQoKS5nZXRMb2NhbENvbXBvbmVudCgpOwog\nICAgICAgICAgICAgICAgICAgIHN0YXJ0U2VxSWQgPSBlbmRPZkxlZGdlciAt\nIG51bUVudHJpZXMgKyAxOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoQktF\neGNlcHRpb24uQktOb1N1Y2hMZWRnZXJFeGlzdHNFeGNlcHRpb24gYmUpIHsK\nICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgaXQKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBJdGVyYXRv\ncjxMZWRnZXJSYW5nZT4gbHJJdGVyID0gbHJzLml0ZXJhdG9yKCk7CiAgICAg\nICAgd2hpbGUgKGxySXRlci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgTGVk\nZ2VyUmFuZ2UgcmFuZ2UgPSBsckl0ZXIubmV4dCgpOwogICAgICAgICAgICBp\nZiAocmFuZ2UuaGFzRW5kU2VxSWRJbmNsdWRlZCgpKSB7CiAgICAgICAgICAg\nICAgICBsb25nIGVuZE9mTGVkZ2VyID0gcmFuZ2UuZ2V0RW5kU2VxSWRJbmNs\ndWRlZCgpLmdldExvY2FsQ29tcG9uZW50KCk7CiAgICAgICAgICAgICAgICBp\nZiAocmFuZ2UuaGFzU3RhcnRTZXFJZEluY2x1ZGVkKCkpIHsKICAgICAgICAg\nICAgICAgICAgICBzdGFydFNlcUlkID0gcmFuZ2UuZ2V0U3RhcnRTZXFJZElu\nY2x1ZGVkKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHJhbmdlID0gYnVpbGRMZWRnZXJSYW5nZShyYW5nZS5nZXRM\nZWRnZXJJZCgpLCBzdGFydFNlcUlkLCByYW5nZS5nZXRFbmRTZXFJZEluY2x1\nZGVkKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVz\ndWx0cy5hZGQocmFuZ2UpOwogICAgICAgICAgICAgICAgaWYgKHN0YXJ0U2Vx\nSWQgPCBlbmRPZkxlZGdlciArIDEpIHsKICAgICAgICAgICAgICAgICAgICBz\ndGFydFNlcUlkID0gZW5kT2ZMZWRnZXIgKyAxOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKGxySXRlci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkxlZGdlciAi\nICsgcmFuZ2UuZ2V0TGVkZ2VySWQoKSArICIgZm9yIHRvcGljICIgKyB0b3Bp\nYy50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiBpcyBub3QgdGhlIGxhc3Qgb25lIGJ1dCBz\ndGlsbCBkb2VzIG5vdCBoYXZlIGFuIGVuZCBzZXEtaWQiKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKHJhbmdlLmhhc1N0YXJ0U2VxSWRJbmNs\ndWRlZCgpKSB7CiAgICAgICAgICAgICAgICBzdGFydFNlcUlkID0gcmFuZ2Uu\nZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrLm9wZW5MZWRnZXJOb1JlY292\nZXJ5KHJhbmdlLmdldExlZGdlcklkKCksIERpZ2VzdFR5cGUuQ1JDMzIsIHBh\nc3N3ZCk7CiAgICAgICAgICAgIGxvbmcgZW5kT2ZMZWRnZXIgPSBzdGFydFNl\ncUlkICsgbGgucmVhZExhc3RDb25maXJtZWQoKTsKICAgICAgICAgICAgTWVz\nc2FnZVNlcUlkIGVuZFNlcUlkID0gTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIo\nKS5zZXRMb2NhbENvbXBvbmVudChlbmRPZkxlZGdlcikuYnVpbGQoKTsKICAg\nICAgICAgICAgcmVzdWx0cy5hZGQoYnVpbGRMZWRnZXJSYW5nZShyYW5nZS5n\nZXRMZWRnZXJJZCgpLCBzdGFydFNlcUlkLCBlbmRTZXFJZCkpOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJldHVybiBzdWJzY3JpcHRpb25zIG9mIGEgdG9waWMKICAgICAqCiAg\nICAgKiBAcGFyYW0gdG9waWMKICAgICAqICAgICAgICAgIFRvcGljIG5hbWUK\nICAgICAqIEByZXR1cm4gc3Vic2NyaXB0aW9ucyBvZiBhIHRvcGljCiAgICAg\nKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgTWFwPEJ5\ndGVTdHJpbmcsIFN1YnNjcmlwdGlvbkRhdGE+IGdldFRvcGljU3Vic2NyaXB0\naW9ucyhCeXRlU3RyaW5nIHRvcGljKQogICAgICAgIHRocm93cyBFeGNlcHRp\nb24gewoKICAgICAgICBmaW5hbCBTeW5jT2JqPE1hcDxCeXRlU3RyaW5nLCBT\ndWJzY3JpcHRpb25EYXRhPj4gc3luY09iaiA9CiAgICAgICAgICAgIG5ldyBT\neW5jT2JqPE1hcDxCeXRlU3RyaW5nLCBTdWJzY3JpcHRpb25EYXRhPj4oKTsK\nICAgICAgICBzZG0ucmVhZFN1YnNjcmlwdGlvbnModG9waWMsIG5ldyBDYWxs\nYmFjazxNYXA8Qnl0ZVN0cmluZywgVmVyc2lvbmVkPFN1YnNjcmlwdGlvbkRh\ndGE+Pj4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBNYXA8\nQnl0ZVN0cmluZywgVmVyc2lvbmVkPFN1YnNjcmlwdGlvbkRhdGE+PiByZXN1\nbHQpIHsKICAgICAgICAgICAgICAgIC8vIEl0IHdhcyBqdXN0IHVzZWQgdG8g\nY29uc29sZSB0b29sIHRvIHByaW50IHNvbWUgaW5mb3JtYXRpb24sIHNvIGRv\nbid0IG5lZWQgdG8gcmV0dXJuIHZlcnNpb24gZm9yIGl0CiAgICAgICAgICAg\nICAgICAvLyBqdXN0IGtlZXAgdGhlIGdldFRvcGljU3Vic2NyaXB0aW9ucyBp\nbnRlcmZhY2UgYXMgYmVmb3JlCiAgICAgICAgICAgICAgICBNYXA8Qnl0ZVN0\ncmluZywgU3Vic2NyaXB0aW9uRGF0YT4gc3VicyA9IG5ldyBDb25jdXJyZW50\nSGFzaE1hcDxCeXRlU3RyaW5nLCBTdWJzY3JpcHRpb25EYXRhPigpOwogICAg\nICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8Qnl0ZVN0cmluZywgVmVyc2lv\nbmVkPFN1YnNjcmlwdGlvbkRhdGE+PiBzdWJFbnRyeSA6IHJlc3VsdC5lbnRy\neVNldCgpKSB7CiAgICAgICAgICAgICAgICAgICAgc3Vicy5wdXQoc3ViRW50\ncnkuZ2V0S2V5KCksIHN1YkVudHJ5LmdldFZhbHVlKCkuZ2V0VmFsdWUoKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzeW5jT2JqLnN1\nY2Nlc3Moc3Vicyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChP\nYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gcHNlKSB7CiAgICAgICAgICAg\nICAgICBzeW5jT2JqLmZhaWwocHNlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0sIHN5bmNPYmopOwoKICAgICAgICBzeW5jT2JqLmJsb2NrKCk7CgogICAg\nICAgIGlmICghc3luY09iai5pc1N1Y2Nlc3MoKSkgewogICAgICAgICAgICB0\naHJvdyBzeW5jT2JqLmV4Y2VwdGlvbjsKICAgICAgICB9CgogICAgICAgIHJl\ndHVybiBzeW5jT2JqLnZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogUmV0\ndXJuIHN1YnNjcmlwdGlvbiBzdGF0ZSBvZiBhIHN1YnNjcmliZXIgb2YgdG9w\naWMKICAgICAqCiAgICAgKiBAcGFyYW0gdG9waWMKICAgICAqICAgICAgICAg\nIFRvcGljIG5hbWUKICAgICAqIEBwYXJhbSBzdWJzY3JpYmVyCiAgICAgKiAg\nICAgICAgICBTdWJzY3JpYmVyIG5hbWUKICAgICAqIEByZXR1cm4gc3Vic2Ny\naXB0aW9uIHN0YXRlCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICov\nCiAgICBwdWJsaWMgU3Vic2NyaXB0aW9uRGF0YSBnZXRTdWJzY3JpcHRpb24o\nQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVyKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBTeW5jT2JqPFN1YnNjcmlw\ndGlvbkRhdGE+IHN5bmNPYmogPSBuZXcgU3luY09iajxTdWJzY3JpcHRpb25E\nYXRhPigpOwogICAgICAgIHNkbS5yZWFkU3Vic2NyaXB0aW9uRGF0YSh0b3Bp\nYywgc3Vic2NyaWJlciwgbmV3IENhbGxiYWNrPFZlcnNpb25lZDxTdWJzY3Jp\ncHRpb25EYXRhPj4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4\nLCBWZXJzaW9uZWQ8U3Vic2NyaXB0aW9uRGF0YT4gcmVzdWx0KSB7CiAgICAg\nICAgICAgICAgICBpZiAobnVsbCA9PSByZXN1bHQpIHsKICAgICAgICAgICAg\nICAgICAgICBzeW5jT2JqLnN1Y2Nlc3MobnVsbCk7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN5bmNPYmouc3VjY2Vz\ncyhyZXN1bHQuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJF\neGNlcHRpb24gcHNlKSB7CiAgICAgICAgICAgICAgICBzeW5jT2JqLmZhaWwo\ncHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHN5bmNPYmopOwoKICAg\nICAgICBzeW5jT2JqLmJsb2NrKCk7CgogICAgICAgIGlmICghc3luY09iai5p\nc1N1Y2Nlc3MoKSkgewogICAgICAgICAgICB0aHJvdyBzeW5jT2JqLmV4Y2Vw\ndGlvbjsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzeW5jT2JqLnZhbHVl\nOwogICAgfQoKICAgIC8qKgogICAgICogRm9ybWF0IG1ldGFkYXRhIGZvciBI\nZWR3aWcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGZvcm1hdCgpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIC8vIGZvcm1hdCBtZXRhZGF0YSBmaXJz\ndAogICAgICAgIG1tRmFjdG9yeS5mb3JtYXQoc2VydmVyQ29uZiwgemspOwog\nICAgICAgIExPRy5pbmZvKCJGb3JtYXR0ZWQgSGVkd2lnIG1ldGFkYXRhIHN1\nY2Nlc3NmdWxseS4iKTsKICAgICAgICAvLyByZW1vdmUgbWV0YWRhdGEgbGF5\nb3V0CiAgICAgICAgRmFjdG9yeUxheW91dC5kZWxldGVMYXlvdXQoemssIHNl\ncnZlckNvbmYpOwogICAgICAgIExPRy5pbmZvKCJSZW1vdmVkIG9sZCBmYWN0\nb3J5IGxheW91dC4iKTsKICAgICAgICAvLyBjcmVhdGUgbmV3IG1ldGFkYXRh\nIG1hbmFnZXIgZmFjdG9yeSBhbmQgd3JpdGUgbmV3IG1ldGFkYXRhIGxheW91\ndAogICAgICAgIE1ldGFkYXRhTWFuYWdlckZhY3RvcnkuY3JlYXRlTWV0YWRh\ndGFNYW5hZ2VyRmFjdG9yeShzZXJ2ZXJDb25mLCB6aywKICAgICAgICAgICAg\nc2VydmVyQ29uZi5nZXRNZXRhZGF0YU1hbmFnZXJGYWN0b3J5Q2xhc3MoKSk7\nCiAgICAgICAgTE9HLmluZm8oIkNyZWF0ZWQgbmV3IGZhY3RvcnkgbGF5b3V0\nLiIpOwogICAgfQp9Cg==\n","encoding":"base64"}

