{"sha":"0c0438fa9a9e22e284b09369a12558ccbcb70610","node_id":"MDQ6QmxvYjE1NzU5NTY6MGMwNDM4ZmE5YTllMjJlMjg0YjA5MzY5YTEyNTU4Y2NiY2I3MDYxMA==","size":36118,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0c0438fa9a9e22e284b09369a12558ccbcb70610","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW4uY29uc29sZTsKCmltcG9y\ndCBqbGluZS5Db25zb2xlUmVhZGVyOwppbXBvcnQgamxpbmUuSGlzdG9yeTsK\naW1wb3J0IGpsaW5lLlRlcm1pbmFsOwoKaW1wb3J0IGphdmEuaW8uQnVmZmVy\nZWRSZWFkZXI7CmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlv\nLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5JbnB1dFN0cmVhbVJlYWRl\ncjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGls\nLk1hcDsKaW1wb3J0IGphdmEudXRpbC5Ob1N1Y2hFbGVtZW50RXhjZXB0aW9u\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKCmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5NYXRoVXRpbHM7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY29uZmlndXJhdGlvbi5Db25maWd1cmF0\naW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW4u\nSGVkd2lnQWRtaW47CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQu\nYXBpLk1lc3NhZ2VIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\nY2xpZW50LmFwaS5QdWJsaXNoZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5jbGllbnQuYXBpLlN1YnNjcmliZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5jbGllbnQuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LkhlZHdpZ0NsaWVudDsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxl\nZGdlclJhbmdlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JB\ndHRhY2g7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25EYXRhOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9leHRlbnNpb25zLlN1YnNjcmlwdGlvblN0YXRl\nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9u\nLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5zZXJ2ZXIudG9waWNzLkh1YkluZm87CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ndXRpbC5IZWR3aWdTb2NrZXRBZGRyZXNzOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcudXRpbC5TdWJzY3JpcHRpb25MaXN0ZW5lcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLldhdGNoZXI7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\ncjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW4uY29uc29sZS5IZWR3aWdDb21tYW5k\ncy4qOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLmFkbWluLmNv\nbnNvbGUuSGVkd2lnQ29tbWFuZHMuQ09NTUFORC4qOwoKLyoqCiAqIENvbnNv\nbGUgQ2xpZW50IHRvIEhlZHdpZwogKi8KcHVibGljIGNsYXNzIEhlZHdpZ0Nv\nbnNvbGUgewogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9\nIExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEhlZHdpZ0NvbnNvbGUuY2xhc3Mp\nOwogICAgLy8gTk9URTogbm93IGl0IGlzIGZpeGVkIHBhc3N3ZCBpbiBib29r\na2VlcGVyCiAgICBzdGF0aWMgYnl0ZVtdIHBhc3N3ZCA9ICJzaWxseXNlY3Jl\ndCIuZ2V0Qnl0ZXMoKTsKCiAgICAvLyBoaXN0b3J5IGZpbGUgbmFtZQogICAg\nc3RhdGljIGZpbmFsIFN0cmluZyBIV19ISVNUT1JZX0ZJTEUgPSAiLmh3X2hp\nc3RvcnkiOwoKICAgIHN0YXRpYyBmaW5hbCBjaGFyW10gQ09OVElOVUVfT1Jf\nUVVJVCA9IG5ldyBjaGFyW10geyAnUScsICdxJywgJ1xuJyB9OwoKICAgIHBy\nb3RlY3RlZCBNeUNvbW1hbmRPcHRpb25zIGNsID0gbmV3IE15Q29tbWFuZE9w\ndGlvbnMoKTsKICAgIHByb3RlY3RlZCBIYXNoTWFwPEludGVnZXIsIFN0cmlu\nZz4gaGlzdG9yeSA9IG5ldyBMaW5rZWRIYXNoTWFwPEludGVnZXIsIFN0cmlu\nZz4oKTsKICAgIHByb3RlY3RlZCBpbnQgY29tbWFuZENvdW50ID0gMDsKICAg\nIHByb3RlY3RlZCBib29sZWFuIHByaW50V2F0Y2hlcyA9IHRydWU7CiAgICBw\ncm90ZWN0ZWQgTWFwPFN0cmluZywgTXlDb21tYW5kPiBteUNvbW1hbmRzOwoK\nICAgIHByb3RlY3RlZCBib29sZWFuIGluQ29uc29sZSA9IHRydWU7CiAgICBw\ncm90ZWN0ZWQgQ29uc29sZVJlYWRlciBjb25zb2xlID0gbnVsbDsKCiAgICBw\ncm90ZWN0ZWQgSGVkd2lnQWRtaW4gYWRtaW47CiAgICBwcm90ZWN0ZWQgSGVk\nd2lnQ2xpZW50IGh1YkNsaWVudDsKICAgIHByb3RlY3RlZCBQdWJsaXNoZXIg\ncHVibGlzaGVyOwogICAgcHJvdGVjdGVkIFN1YnNjcmliZXIgc3Vic2NyaWJl\ncjsKICAgIHByb3RlY3RlZCBDb25zb2xlTWVzc2FnZUhhbmRsZXIgY29uc29s\nZUhhbmRsZXIgPQogICAgICAgICAgICBuZXcgQ29uc29sZU1lc3NhZ2VIYW5k\nbGVyKCk7CiAgICBwcm90ZWN0ZWQgVGVybWluYWwgdGVybWluYWw7CgogICAg\ncHJvdGVjdGVkIFN0cmluZyBteVJlZ2lvbjsKCiAgICBpbnRlcmZhY2UgTXlD\nb21tYW5kIHsKICAgICAgICBib29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdz\nKSB0aHJvd3MgRXhjZXB0aW9uOwogICAgfQoKICAgIHN0YXRpYyBjbGFzcyBI\nZWxwQ21kIGltcGxlbWVudHMgTXlDb21tYW5kIHsKCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gcnVuQ21kKFN0cmluZ1tdIGFy\nZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBib29sZWFuIHBy\naW50VXNhZ2UgPSB0cnVlOwogICAgICAgICAgICBpZiAoYXJncy5sZW5ndGgg\nPj0gMikgewogICAgICAgICAgICAgICAgU3RyaW5nIGNvbW1hbmQgPSBhcmdz\nWzFdOwogICAgICAgICAgICAgICAgQ09NTUFORCBjID0gZ2V0SGVkd2lnQ29t\nbWFuZHMoKS5nZXQoY29tbWFuZCk7CiAgICAgICAgICAgICAgICBpZiAoYyAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgYy5wcmludFVzYWdlKCk7\nCiAgICAgICAgICAgICAgICAgICAgcHJpbnRVc2FnZSA9IGZhbHNlOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChw\ncmludFVzYWdlKSB7CiAgICAgICAgICAgICAgICB1c2FnZSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAg\nIH0KCiAgICBjbGFzcyBFeGl0Q21kIGltcGxlbWVudHMgTXlDb21tYW5kIHsK\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gcnVu\nQ21kKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBwcmludE1lc3NhZ2UoIlF1aXR0aW5nIC4uLiIpOwogICAgICAgICAg\nICBodWJDbGllbnQuY2xvc2UoKTsKICAgICAgICAgICAgYWRtaW4uY2xvc2Uo\nKTsKICAgICAgICAgICAgUnVudGltZS5nZXRSdW50aW1lKCkuZXhpdCgwKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgfQoKICAg\nIGNsYXNzIFJlZG9DbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3Ry\naW5nW10gYXJncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlm\nIChhcmdzLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaW50IGluZGV4Owog\nICAgICAgICAgICBpZiAoIiEiLmVxdWFscyhhcmdzWzFdKSkgewogICAgICAg\nICAgICAgICAgaW5kZXggPSBjb21tYW5kQ291bnQgLSAxOwogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgaW5kZXggPSBJbnRlZ2VyLmRl\nY29kZShhcmdzWzFdKTsKICAgICAgICAgICAgICAgIGlmIChjb21tYW5kQ291\nbnQgPD0gaW5kZXgpIHsKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJy\nLnByaW50bG4oIkNvbW1hbmQgaW5kZXggb3V0IG9mIHJhbmdlIik7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGNsLnBhcnNlQ29tbWFuZCho\naXN0b3J5LmdldChpbmRleCkpOwogICAgICAgICAgICBpZiAoY2wuZ2V0Q29t\nbWFuZCgpLmVxdWFscygicmVkbyIpKSB7CiAgICAgICAgICAgICAgICBTeXN0\nZW0uZXJyLnByaW50bG4oIk5vIHJlZG9pbmcgcmVkb3MiKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBoaXN0b3J5LnB1dChjb21tYW5kQ291bnQsIGhpc3RvcnkuZ2V0KGluZGV4\nKSk7CiAgICAgICAgICAgIHByb2Nlc3NDbWQoY2wpOwogICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICB9CgogICAgY2xh\nc3MgSGlzdG9yeUNtZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7CgogICAgICAg\nIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bkNtZChTdHJp\nbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgZm9y\nIChpbnQgaT1jb21tYW5kQ291bnQgLSAxMDsgaTw9Y29tbWFuZENvdW50OyAr\nK2kpIHsKICAgICAgICAgICAgICAgIGlmIChpIDwgMCkgewogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKGkgKyAiIC0gIiArIGhpc3Rv\ncnkuZ2V0KGkpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICB9CgogICAgY2xhc3MgU2V0\nQ21kIGltcGxlbWVudHMgTXlDb21tYW5kIHsKCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gcnVuQ21kKFN0cmluZ1tdIGFyZ3Mp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoYXJncy5sZW5n\ndGggPCAzIHx8ICEicHJpbnR3YXRjaGVzIi5lcXVhbHMoYXJnc1sxXSkpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSBl\nbHNlIGlmIChhcmdzLmxlbmd0aCA9PSAyKSB7CiAgICAgICAgICAgICAgICBT\neXN0ZW0ub3V0LnByaW50bG4oInByaW50d2F0Y2hlcyBpcyAiICsgKHByaW50\nV2F0Y2hlcyA/ICJvbiIgOiAib2ZmIikpOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgcHJpbnRXYXRjaGVzID0gYXJnc1syXS5lcXVh\nbHMoIm9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIGNsYXNzIFB1YkNt\nZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdzKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3Ro\nIDwgMykgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOChhcmdzWzFdKTsKCiAgICAgICAgICAgIFN0cmlu\nZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAg\nICBmb3IgKGludCBpPTI7IGk8YXJncy5sZW5ndGg7IGkrKykgewogICAgICAg\nICAgICAgICAgc2IuYXBwZW5kKGFyZ3NbaV0pOwogICAgICAgICAgICAgICAg\naWYgKGkgIT0gYXJncy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAg\nICAgc2IuYXBwZW5kKCcgJyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgQnl0ZVN0cmluZyBtc2dCb2R5ID0gQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0Zjgoc2IudG9TdHJpbmcoKSk7CiAgICAgICAgICAg\nIE1lc3NhZ2UgbXNnID0gTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keSht\nc2dCb2R5KS5idWlsZCgpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgcHVibGlzaGVyLnB1Ymxpc2godG9waWMsIG1zZyk7CiAgICAgICAg\nICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlBVQiBET05FIik7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICBTeXN0ZW0uZXJyLnByaW50bG4oIlBVQiBGQUlMRUQiKTsKICAgICAgICAg\nICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAg\nfQoKICAgIHN0YXRpYyBjbGFzcyBDb25zb2xlTWVzc2FnZUhhbmRsZXIgaW1w\nbGVtZW50cyBNZXNzYWdlSGFuZGxlciB7CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3BpYywg\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICBNZXNz\nYWdlIG1zZywgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjb250\nZXh0KSB7CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiUmVjZWl2\nZWQgbWVzc2FnZSBmcm9tIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSArIAogICAgICAgICAgICAgICAgICAgICIgZm9yIHN1YnNjcmliZXIgIiAr\nIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKSArICIgOiAiCiAgICAgICAg\nICAgICAgICAgICAgKyBtc2cuZ2V0Qm9keSgpLnRvU3RyaW5nVXRmOCgpKTsK\nICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4\ndCwgbnVsbCk7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIHN0YXRp\nYyBjbGFzcyBDb25zb2xlU3Vic2NyaXB0aW9uTGlzdGVuZXIgaW1wbGVtZW50\ncyBTdWJzY3JpcHRpb25MaXN0ZW5lciB7CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NFdmVudChCeXRlU3RyaW5nIHQs\nIEJ5dGVTdHJpbmcgcywgU3Vic2NyaXB0aW9uRXZlbnQgZXZlbnQpIHsKICAg\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJTdWJzY3JpcHRpb24gQ2hh\nbm5lbCBmb3IgKHRvcGljOiIgKyB0LnRvU3RyaW5nVXRmOCgpICsgIiwgc3Vi\nc2NyaWJlcjoiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBz\nLnRvU3RyaW5nVXRmOCgpICsgIikgcmVjZWl2ZWQgZXZlbnQgOiAiICsgZXZl\nbnQpOwogICAgICAgIH0KICAgIH0KCiAgICBjbGFzcyBTdWJDbWQgaW1wbGVt\nZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10gYXJncykgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIENyZWF0ZU9yQXR0YWNoIG1vZGU7CiAg\nICAgICAgICAgIGJvb2xlYW4gcmVjZWl2ZSA9IHRydWU7CiAgICAgICAgICAg\nIGlmIChhcmdzLmxlbmd0aCA8IDMpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9\nPSAzKSB7CiAgICAgICAgICAgICAgICBtb2RlID0gQ3JlYXRlT3JBdHRhY2gu\nQVRUQUNIOwogICAgICAgICAgICAgICAgcmVjZWl2ZSA9IHRydWU7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIG1vZGUgPSBDcmVhdGVPckF0dGFjaC52YWx1ZU9mKElu\ndGVnZXIucGFyc2VJbnQoYXJnc1szXSkpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBTeXN0\nZW0uZXJyLnByaW50bG4oIlVua25vdyBtb2RlIDogIiArIGFyZ3NbM10pOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA+PSA1KSB7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgcmVjZWl2ZSA9IEJvb2xlYW4ucGFyc2VCb29sZWFuKGFyZ3NbNF0p\nOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmUgPSBmYWxzZTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKG1vZGUgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJVbmtub3cgbW9kZSA6ICIg\nKyBhcmdzWzNdKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0\nZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJnc1sxXSk7CiAgICAgICAgICAgIEJ5\ndGVTdHJpbmcgc3ViSWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChhcmdz\nWzJdKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFN1YnNj\ncmlwdGlvbk9wdGlvbnMgb3B0aW9ucyA9CiAgICAgICAgICAgICAgICAgICAg\nU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkuc2V0Q3JlYXRlT3JB\ndHRhY2gobW9kZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLnNldEZvcmNlQXR0YWNoKGZhbHNlKS5idWlsZCgpOwogICAgICAg\nICAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1YklkLCBv\ncHRpb25zKTsKICAgICAgICAgICAgICAgIGlmIChyZWNlaXZlKSB7CiAgICAg\nICAgICAgICAgICAgICAgc3Vic2NyaWJlci5zdGFydERlbGl2ZXJ5KHRvcGlj\nLCBzdWJJZCwgY29uc29sZUhhbmRsZXIpOwogICAgICAgICAgICAgICAgICAg\nIFN5c3RlbS5vdXQucHJpbnRsbigiU1VCIERPTkUgQU5EIFJFQ0VJVkUiKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nU3lzdGVtLm91dC5wcmludGxuKCJTVUIgRE9ORSBCVVQgTk9UIFJFQ0VJVkUi\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRs\nbigiU1VCIEZBSUxFRCIpOwogICAgICAgICAgICAgICAgZS5wcmludFN0YWNr\nVHJhY2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgICAgICB9CiAgICB9CgogICAgY2xhc3MgVW5zdWJDbWQgaW1wbGVt\nZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10gYXJncykgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA8IDMpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgoYXJnc1sxXSk7CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgc3Vi\nSWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChhcmdzWzJdKTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuc3RvcERl\nbGl2ZXJ5KHRvcGljLCBzdWJJZCk7CiAgICAgICAgICAgICAgICBzdWJzY3Jp\nYmVyLnVuc3Vic2NyaWJlKHRvcGljLCBzdWJJZCk7CiAgICAgICAgICAgICAg\nICBTeXN0ZW0ub3V0LnByaW50bG4oIlVOU1VCIERPTkUiKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIFN5\nc3RlbS5lcnIucHJpbnRsbigiVU5TVUIgRkFJTEVEIik7CiAgICAgICAgICAg\nICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgIH0K\nCiAgICBjbGFzcyBSbXN1YkNtZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bkNt\nZChTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgaWYgKGFyZ3MubGVuZ3RoIDwgNykgewogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFN0cmluZyB0\nb3BpY1ByZWZpeCA9IGFyZ3NbMV07CiAgICAgICAgICAgIGludCBzdGFydFRv\ncGljID0gSW50ZWdlci5wYXJzZUludChhcmdzWzJdKTsKICAgICAgICAgICAg\naW50IGVuZFRvcGljID0gSW50ZWdlci5wYXJzZUludChhcmdzWzNdKTsKICAg\nICAgICAgICAgU3RyaW5nIHN1YlByZWZpeCA9IGFyZ3NbNF07CiAgICAgICAg\nICAgIGludCBzdGFydFN1YiA9IEludGVnZXIucGFyc2VJbnQoYXJnc1s1XSk7\nCiAgICAgICAgICAgIGludCBlbmRTdWIgPSBJbnRlZ2VyLnBhcnNlSW50KGFy\nZ3NbNl0pOwogICAgICAgICAgICBpZiAoc3RhcnRUb3BpYyA+IGVuZFRvcGlj\nIHx8IGVuZFN1YiA8IHN0YXJ0U3ViKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpbnQg\naT1zdGFydFRvcGljOyBpPD1lbmRUb3BpYzsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgodG9waWNQcmVmaXggKyBpKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaj1zdGFydFN1Yjsgajw9ZW5k\nU3ViOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0cmlu\nZyBzdWIgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChzdWJQcmVmaXggKyBq\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlci5zdWJzY3Jp\nYmUodG9waWMsIHN1YiwgQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFD\nSCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXIudW5zdWJz\nY3JpYmUodG9waWMsIHN1Yik7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiUk1TVUIgIiAr\nIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiBET05FIik7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nICAgIFN5c3RlbS5lcnIucHJpbnRsbigiUk1TVUIgIiArIHRvcGljLnRvU3Ry\naW5nVXRmOCgpICsgIiBGQUlMRUQiKTsKICAgICAgICAgICAgICAgICAgICBl\nLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAg\nICB9CiAgICAKICAgIGNsYXNzIENsb3NlU3Vic2NyaXB0aW9uQ21kIGltcGxl\nbWVudHMgTXlDb21tYW5kIHsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIGJvb2xlYW4gcnVuQ21kKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPCAzKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KGFyZ3NbMV0pOwogICAgICAgICAgICBCeXRlU3RyaW5nIHN1\nZElkID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJnc1syXSk7CiAgICAg\nICAgICAgIAogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3Vi\nc2NyaWJlci5zdG9wRGVsaXZlcnkodG9waWMsIHN1ZElkKTsKICAgICAgICAg\nICAgICAgIHN1YnNjcmliZXIuY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1\nZElkKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiQ0xPU0VTVUIgRkFJ\nTEVEIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQogICAgICAgIAogICAgfQogICAgCiAgICBjbGFzcyBDb25z\ndW1lVG9DbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10g\nYXJncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChhcmdz\nLmxlbmd0aCA8IDQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0g\nQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJnc1sxXSk7CiAgICAgICAgICAg\nIEJ5dGVTdHJpbmcgc3ViSWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChh\ncmdzWzJdKTsKICAgICAgICAgICAgbG9uZyBtc2dJZCA9IExvbmcucGFyc2VM\nb25nKGFyZ3NbM10pOwogICAgICAgICAgICBNZXNzYWdlU2VxSWQgY29uc3Vt\nZUlkID0gTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIoKS5zZXRMb2NhbENvbXBv\nbmVudChtc2dJZCkuYnVpbGQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIHN1YnNjcmliZXIuY29uc3VtZSh0b3BpYywgc3ViSWQsIGNv\nbnN1bWVJZCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkNPTlNVTUVU\nTyBGQUlMRUQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICB9CiAgICAKICAgIGNsYXNz\nIENvbnN1bWVDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5n\nW10gYXJncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChh\ncmdzLmxlbmd0aCA8IDQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsb25nIGxhc3RDb25zdW1l\nZElkID0gMDsKICAgICAgICAgICAgU3Vic2NyaXB0aW9uRGF0YSBzdWJEYXRh\nID0gYWRtaW4uZ2V0U3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcuY29weUZyb21V\ndGY4KGFyZ3NbMV0pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgoYXJnc1syXSkpOwogICAgICAgICAgICBpZiAobnVsbCA9PSBz\ndWJEYXRhKSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4o\nIkZhaWxlZCB0byByZWFkIHN1YnNjcmlwdGlvbiBmb3IgdG9waWM6ICIgKyBh\ncmdzWzFdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBz\ndWJzY3JpYmVyOiAiICsgYXJnc1syXSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXN0Q29uc3Vt\nZWRJZCA9IHN1YkRhdGEuZ2V0U3RhdGUoKS5nZXRNc2dJZCgpLmdldExvY2Fs\nQ29tcG9uZW50KCk7CiAgICAgICAgICAgIGxvbmcgbnVtTWVzc2FnZXNUb0Nv\nbnN1bWUgPSBMb25nLnBhcnNlTG9uZyhhcmdzWzNdKTsKICAgICAgICAgICAg\nbG9uZyBpZFRvQ29uc3VtZWQgPSBsYXN0Q29uc3VtZWRJZCArIG51bU1lc3Nh\nZ2VzVG9Db25zdW1lOwogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4o\nIlRyeSB0byBtb3ZlIHN1YnNjcmliZXIoIiArIGFyZ3NbMl0gKyAiKSBjb25z\ndW1lIHB0ciBvZiB0b3BpYygiICsgYXJnc1sxXQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgIikgZnJvbSAiICsgbGFzdENvbnN1bWVkSWQgKyAi\nIHRvICIgKyBpZFRvQ29uc3VtZWQpOwogICAgICAgICAgICBNZXNzYWdlU2Vx\nSWQgY29uc3VtZUlkID0gTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIoKS5zZXRM\nb2NhbENvbXBvbmVudChpZFRvQ29uc3VtZWQpLmJ1aWxkKCk7CiAgICAgICAg\nICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRm\nOChhcmdzWzFdKTsKICAgICAgICAgICAgQnl0ZVN0cmluZyBzdWJJZCA9IEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KGFyZ3NbMl0pOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgc3Vic2NyaWJlci5jb25zdW1lKHRvcGlj\nLCBzdWJJZCwgY29uc3VtZUlkKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRs\nbigiQ09OU1VNRSBGQUlMRUQiKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICB9CgogICAg\nY2xhc3MgUHViU3ViQ21kIGltcGxlbWVudHMgTXlDb21tYW5kIHsKCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gcnVuQ21kKFN0\ncmluZ1tdIGFyZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBp\nZiAoYXJncy5sZW5ndGggPCA1KSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmluYWwgbG9uZyBz\ndGFydFRpbWUgPSBNYXRoVXRpbHMubm93KCk7CgogICAgICAgICAgICBmaW5h\nbCBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nYXJnc1sxXSk7CiAgICAgICAgICAgIGZpbmFsIEJ5dGVTdHJpbmcgc3ViSWQg\nPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChhcmdzWzJdICsgIi0iICsgc3Rh\ncnRUaW1lKTsKICAgICAgICAgICAgaW50IHRpbWVvdXRTZWNzID0gNjA7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0aW1lb3V0U2VjcyA9\nIEludGVnZXIucGFyc2VJbnQoYXJnc1szXSk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBuZmUpIHsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdC\ndWlsZGVyKCk7CiAgICAgICAgICAgIGZvciAoaW50IGk9NDsgaTxhcmdzLmxl\nbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzYi5hcHBlbmQoYXJnc1tp\nXSk7CiAgICAgICAgICAgICAgICBpZiAoaSAhPSBhcmdzLmxlbmd0aCAtIDEp\nIHsKICAgICAgICAgICAgICAgICAgICBzYi5hcHBlbmQoJyAnKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBhcHBl\nbmQgYSB0aW1lc3RhbXAgdGFnCiAgICAgICAgICAgIEJ5dGVTdHJpbmcgbXNn\nQm9keSA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KHNiLnRvU3RyaW5nKCkg\nKyAiLSIgKyBzdGFydFRpbWUpOwogICAgICAgICAgICBmaW5hbCBNZXNzYWdl\nIG1zZyA9IE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkobXNnQm9keSku\nYnVpbGQoKTsKCiAgICAgICAgICAgIGJvb2xlYW4gc3Vic2NyaWJlZCA9IGZh\nbHNlOwogICAgICAgICAgICBib29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAg\nICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggaXNEb25lID0gbmV3IENv\ndW50RG93bkxhdGNoKDEpOwogICAgICAgICAgICBsb25nIGVsYXBzZWRUaW1l\nID0gMEw7CgogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlN0YXJ0\naW5nIFBVQlNVQiB0ZXN0IC4uLiIpOwogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgLy8gc3ViIHRoZSB0b3BpYwogICAgICAgICAgICAgICAg\nc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1YklkLCBDcmVhdGVPckF0\ndGFjaC5DUkVBVEVfT1JfQVRUQUNIKTsKICAgICAgICAgICAgICAgIHN1YnNj\ncmliZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJp\nbnRsbigiU3ViIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIs\nIHN1YnNjcmliZXIgaWQgIiArIHN1YklkLnRvU3RyaW5nVXRmOCgpKTsKCiAg\nICAgICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAvLyBwdWIgdG9waWMK\nICAgICAgICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRvcGljLCBtc2cp\nOwogICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJQdWIgdG9w\naWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiA6ICIgKyBtc2cuZ2V0\nQm9keSgpLnRvU3RyaW5nVXRmOCgpKTsKCiAgICAgICAgICAgICAgICAvLyBl\nbnN1cmUgc3Vic2NyaWJlciBmaXJzdCwgcHVibGlzaCBuZXh0LCB0aGVuIHdl\nIHN0YXJ0IGRlbGl2ZXJ5IHRvIHJlY2VpdmUgbWVzc2FnZQogICAgICAgICAg\nICAgICAgLy8gaWYgc3RhcnQgZGVsaXZlcnkgZmlyc3QgYmVmb3JlIHB1Ymxp\nc2gsIGlzRG9uZSBtYXkgbm90aWZ5IGJlZm9yZSB3YWl0CiAgICAgICAgICAg\nICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YklkLCBu\nZXcgTWVzc2FnZUhhbmRsZXIoKSB7CgogICAgICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGRlbGl2\nZXIoQnl0ZVN0cmluZyB0aGlzVG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSBtZXNz\nYWdlLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGNvbnRleHQp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNUb3BpYy5lcXVh\nbHModG9waWMpICYmIHN1YnNjcmliZXJJZC5lcXVhbHMoc3ViSWQpICYmCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBtc2cuZ2V0Qm9keSgpLmVxdWFs\ncyhtZXNzYWdlLmdldEJvZHkoKSkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiUmVjZWl2ZWQgbWVzc2FnZSA6\nICIgKyBtZXNzYWdlLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpc0RvbmUuY291bnREb3duKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4dCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0pOwoK\nICAgICAgICAgICAgICAgIC8vIHdhaXQgZm9yIHRoZSBtZXNzYWdlCiAgICAg\nICAgICAgICAgICBzdWNjZXNzID0gaXNEb25lLmF3YWl0KHRpbWVvdXRTZWNz\nLCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgICAgIGVsYXBzZWRU\naW1lID0gTWF0aFV0aWxzLm5vdygpIC0gc3RhcnRUaW1lOwogICAgICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBpZiAoc3Vic2NyaWJlZCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBzdWJzY3JpYmVyLnN0b3BEZWxpdmVyeSh0b3BpYywgc3ViSWQp\nOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLnVuc3Vic2Ny\naWJlKHRvcGljLCBzdWJJZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oIlBVQlNVQiBTVUNDRVNTLiBUSU1FOiAiICsgZWxhcHNl\nZFRpbWUgKyAiIE1TIik7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJQ\nVUJTVUIgRkFJTEVELiAiKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3M7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQogICAgCiAgICBj\nbGFzcyBSZWFkVG9waWNDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQo\nU3RyaW5nW10gYXJncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIGlmIChhcmdzLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWFkVG9waWMg\ncnQ7CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5n\nLmNvcHlGcm9tVXRmOChhcmdzWzFdKTsKICAgICAgICAgICAgaWYgKGFyZ3Mu\nbGVuZ3RoID09IDIpIHsKICAgICAgICAgICAgICAgIHJ0ID0gbmV3IFJlYWRU\nb3BpYyhhZG1pbiwgdG9waWMsIGluQ29uc29sZSk7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBydCA9IG5ldyBSZWFkVG9waWMoYWRt\naW4sIHRvcGljLCBMb25nLnBhcnNlTG9uZyhhcmdzWzJdKSwgaW5Db25zb2xl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBydC5yZWFkVG9waWMoKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIAog\nICAgfQoKICAgIGNsYXNzIFNob3dDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQg\newoKICAgICAgICBzdGF0aWMgZmluYWwgaW50IE1BWF9UT1BJQ1NfUEVSX1NI\nT1cgPSAxMDA7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBi\nb29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIFN0cmluZyBlcnJvck1zZyA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBpZiAoSGVkd2lnQ29tbWFuZHMuU0hPV19IVUJT\nLmVxdWFscyhhcmdzWzFdKSkgewogICAgICAgICAgICAgICAgICAgIGVycm9y\nTXNnID0gIlVuYWJsZSB0byBmZXRjaCB0aGUgbGlzdCBvZiBodWIgc2VydmVy\ncyI7CiAgICAgICAgICAgICAgICAgICAgc2hvd0h1YnMoKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoSGVkd2lnQ29tbWFuZHMuU0hPV19UT1BJQ1Mu\nZXF1YWxzKGFyZ3NbMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JN\nc2cgPSAiVW5hYmxlIHRvIGZldGNoIHRoZSBsaXN0IG9mIHRvcGljcyI7CiAg\nICAgICAgICAgICAgICAgICAgc2hvd1RvcGljcygpOwogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnBy\naW50bG4oIkVSUk9SOiBVbmtub3duIHNob3cgY29tbWFuZCAnIiArIGFyZ3Nb\nMV0gKyAiJyIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGVycm9yTXNn\nKSB7CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKGVy\ncm9yTXNnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGUu\ncHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9p\nZCBzaG93SHVicygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBN\nYXA8SGVkd2lnU29ja2V0QWRkcmVzcywgSGVkd2lnQWRtaW4uSHViU3RhdHM+\nIGh1YnMgPSBhZG1pbi5nZXRBdmFpbGFibGVIdWJzKCk7CiAgICAgICAgICAg\nIFN5c3RlbS5vdXQucHJpbnRsbigiQXZhaWxhYmxlIEh1YiBTZXJ2ZXJzOiIp\nOwogICAgICAgICAgICBmb3IgKE1hcC5FbnRyeTxIZWR3aWdTb2NrZXRBZGRy\nZXNzLCBIZWR3aWdBZG1pbi5IdWJTdGF0cz4gZW50cnkgOiBodWJzLmVudHJ5\nU2V0KCkpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigi\nXHQiICsgZW50cnkuZ2V0S2V5KCkgKyAiIDpcdCIgKyBlbnRyeS5nZXRWYWx1\nZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIHZvaWQgc2hvd1RvcGljcygpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBMaXN0PFN0cmluZz4gdG9waWNzID0gbmV3IEFycmF5TGlzdDxT\ndHJpbmc+KCk7CiAgICAgICAgICAgIEl0ZXJhdG9yPEJ5dGVTdHJpbmc+IGl0\nZXIgPSBhZG1pbi5nZXRUb3BpY3MoKTsKCiAgICAgICAgICAgIFN5c3RlbS5v\ndXQucHJpbnRsbigiVG9waWMgTGlzdDoiKTsKICAgICAgICAgICAgYm9vbGVh\nbiBzdG9wID0gZmFsc2U7CiAgICAgICAgICAgIHdoaWxlIChpdGVyLmhhc05l\neHQoKSkgewogICAgICAgICAgICAgICAgaWYgKHRvcGljcy5zaXplKCkgPj0g\nTUFYX1RPUElDU19QRVJfU0hPVykgewogICAgICAgICAgICAgICAgICAgIFN5\nc3RlbS5vdXQucHJpbnRsbih0b3BpY3MpOwogICAgICAgICAgICAgICAgICAg\nIHRvcGljcy5jbGVhcigpOwogICAgICAgICAgICAgICAgICAgIHN0b3AgPSAh\nY29udGludWVPclF1aXQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3Rv\ncCkgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBCeXRlU3RyaW5nIHQgPSBpdGVyLm5leHQoKTsKICAgICAgICAgICAgICAg\nIHRvcGljcy5hZGQodC50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKCFzdG9wKSB7CiAgICAgICAgICAgICAgICBTeXN0\nZW0ub3V0LnByaW50bG4odG9waWNzKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgCiAgICAgICAgCiAgICB9CgogICAgY2xhc3MgRGVzY3Jp\nYmVDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10gYXJn\ncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChhcmdzLmxl\nbmd0aCA8IDMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoSGVkd2lnQ29tbWFuZHMuREVT\nQ1JJQkVfVE9QSUMuZXF1YWxzKGFyZ3NbMV0pKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZGVzY3JpYmVUb3BpYyhhcmdzWzJdKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4g\nZGVzY3JpYmVUb3BpYyhTdHJpbmcgdG9waWMpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgICAgICBCeXRlU3RyaW5nIGJ0b3BpYyA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KHRvcGljKTsKICAgICAgICAgICAgSHViSW5mbyBvd25l\nciA9IGFkbWluLmdldFRvcGljT3duZXIoYnRvcGljKTsKICAgICAgICAgICAg\nTGlzdDxMZWRnZXJSYW5nZT4gcmFuZ2VzID0gYWRtaW4uZ2V0VG9waWNMZWRn\nZXJzKGJ0b3BpYyk7CiAgICAgICAgICAgIE1hcDxCeXRlU3RyaW5nLCBTdWJz\nY3JpcHRpb25EYXRhPiBzdGF0ZXMgPSBhZG1pbi5nZXRUb3BpY1N1YnNjcmlw\ndGlvbnMoYnRvcGljKTsKCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRs\nbigiPT09PT0gVG9waWMgSW5mb3JtYXRpb24gOiAiICsgdG9waWMgKyAiID09\nPT09Iik7CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigpOwogICAg\nICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIk93bmVyIDogIiArIChvd25l\nciA9PSBudWxsID8gIk5VTEwiIDoKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG93bmVyLnRvU3RyaW5nKCkudHJpbSgpLnJlcGxhY2VBbGwoIlxu\nIiwgIiwgIikpKTsKICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCk7\nCgogICAgICAgICAgICAvLyBwcmludCBsZWRnZXJzCiAgICAgICAgICAgIHBy\naW50VG9waWNMZWRnZXJzKHJhbmdlcyk7CiAgICAgICAgICAgIC8vIHByaW50\nIHN1YnNjcmlwdGlvbnMKICAgICAgICAgICAgcHJpbnRUb3BpY1N1YnNjcmlw\ndGlvbnMoc3RhdGVzKTsKCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHByaW50VG9waWNMZWRnZXJz\nKExpc3Q8TGVkZ2VyUmFuZ2U+IHJhbmdlcykgewogICAgICAgICAgICBTeXN0\nZW0ub3V0LnByaW50bG4oIj4+PiBQZXJzaXN0ZW5jZSBJbmZvIDw8PCIpOwog\nICAgICAgICAgICBpZiAobnVsbCA9PSByYW5nZXMpIHsKICAgICAgICAgICAg\nICAgIFN5c3RlbS5vdXQucHJpbnRsbigiTi9BIik7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJhbmdl\ncy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJp\nbnRsbigiTm8gTGVkZ2VyIHVzZWQuIik7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChMZWRnZXJSYW5n\nZSByYW5nZSA6IHJhbmdlcykgewogICAgICAgICAgICAgICAgU3lzdGVtLm91\ndC5wcmludGxuKCJMZWRnZXIgIiArIHJhbmdlLmdldExlZGdlcklkKCkgKyAi\nIFsgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgcmFu\nZ2UuZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCkgKyAiIH4gIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgcmFuZ2UuZ2V0RW5kU2VxSWRJ\nbmNsdWRlZCgpLmdldExvY2FsQ29tcG9uZW50KCkgKyAiIF0iKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oKTsKICAg\nICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBwcmludFRvcGljU3Vic2Ny\naXB0aW9ucyhNYXA8Qnl0ZVN0cmluZywgU3Vic2NyaXB0aW9uRGF0YT4gc3Rh\ndGVzKSB7CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiPj4+IFN1\nYnNjcmlwdGlvbiBJbmZvIDw8PCIpOwogICAgICAgICAgICBpZiAoMCA9PSBz\ndGF0ZXMuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnBy\naW50bG4oIk5vIHN1YnNjcmliZXIuIik7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8\nQnl0ZVN0cmluZywgU3Vic2NyaXB0aW9uRGF0YT4gZW50cnkgOiBzdGF0ZXMu\nZW50cnlTZXQoKSkgewogICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmlu\ndGxuKCJTdWJzY3JpYmVyICIgKyBlbnRyeS5nZXRLZXkoKS50b1N0cmluZ1V0\nZjgoKSArICIgOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgU3Vic2NyaXB0aW9uU3RhdGVVdGlscy50b1N0cmluZyhlbnRyeS5nZXRW\nYWx1ZSgpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgU3lzdGVtLm91\ndC5wcmludGxuKCk7CiAgICAgICAgfQoKICAgIH0KCiAgICBjbGFzcyBGb3Jt\nYXRDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10gYXJn\ncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGJvb2xlYW4gZm9y\nY2UgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID49IDIg\nJiYgIi1mb3JjZSIuZXF1YWxzKGFyZ3NbMV0pKSB7CiAgICAgICAgICAgICAg\nICBmb3JjZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYm9v\nbGVhbiBkb0Zvcm1hdCA9IHRydWU7CiAgICAgICAgICAgIFN5c3RlbS5vdXQu\ncHJpbnRsbigiWW91IGFzayB0byBmb3JtYXQgaGVkd2lnIG1ldGFkYXRhIHN0\nb3JlZCBpbiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGFk\nbWluLmdldE1ldGFkYXRhTWFuYWdlckZhY3RvcnkoKS5nZXRDbGFzcygpLmdl\ndE5hbWUoKSArICIuIik7CiAgICAgICAgICAgIGlmICghZm9yY2UpIHsKICAg\nICAgICAgICAgICAgIGRvRm9ybWF0ID0gY29udGludWVPclF1aXQoKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoZG9Gb3JtYXQpIHsKICAgICAg\nICAgICAgICAgIGFkbWluLmZvcm1hdCgpOwogICAgICAgICAgICAgICAgU3lz\ndGVtLm91dC5wcmludGxuKCJGb3JtYXR0ZWQgaGVkd2lnIG1ldGFkYXRhIHN1\nY2Nlc3NmdWxseS4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiR2l2ZW4gdXAgZm9ybWF0dGlu\nZyBoZWR3aWcgbWV0YWRhdGEuIik7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgIH0KCiAgICBwcm90ZWN0\nZWQgTWFwPFN0cmluZywgTXlDb21tYW5kPiBidWlsZE15Q29tbWFuZHMoKSB7\nCiAgICAgICAgTWFwPFN0cmluZywgTXlDb21tYW5kPiBjbWRzID0KICAgICAg\nICAgICAgICAgIG5ldyBIYXNoTWFwPFN0cmluZywgTXlDb21tYW5kPigpOwoK\nICAgICAgICBFeGl0Q21kIGV4aXRDbWQgPSBuZXcgRXhpdENtZCgpOwogICAg\nICAgIGNtZHMucHV0KEVYSVQsIGV4aXRDbWQpOwogICAgICAgIGNtZHMucHV0\nKFFVSVQsIGV4aXRDbWQpOwogICAgICAgIGNtZHMucHV0KEhFTFAsIG5ldyBI\nZWxwQ21kKCkpOwogICAgICAgIGNtZHMucHV0KEhJU1RPUlksIG5ldyBIaXN0\nb3J5Q21kKCkpOwogICAgICAgIGNtZHMucHV0KFJFRE8sIG5ldyBSZWRvQ21k\nKCkpOwogICAgICAgIGNtZHMucHV0KFNFVCwgbmV3IFNldENtZCgpKTsKICAg\nICAgICBjbWRzLnB1dChQVUIsIG5ldyBQdWJDbWQoKSk7CiAgICAgICAgY21k\ncy5wdXQoU1VCLCBuZXcgU3ViQ21kKCkpOwogICAgICAgIGNtZHMucHV0KFBV\nQlNVQiwgbmV3IFB1YlN1YkNtZCgpKTsKICAgICAgICBjbWRzLnB1dChDTE9T\nRVNVQiwgbmV3IENsb3NlU3Vic2NyaXB0aW9uQ21kKCkpOwogICAgICAgIGNt\nZHMucHV0KFVOU1VCLCBuZXcgVW5zdWJDbWQoKSk7CiAgICAgICAgY21kcy5w\ndXQoUk1TVUIsIG5ldyBSbXN1YkNtZCgpKTsKICAgICAgICBjbWRzLnB1dChD\nT05TVU1FLCBuZXcgQ29uc3VtZUNtZCgpKTsKICAgICAgICBjbWRzLnB1dChD\nT05TVU1FVE8sIG5ldyBDb25zdW1lVG9DbWQoKSk7CiAgICAgICAgY21kcy5w\ndXQoU0hPVywgbmV3IFNob3dDbWQoKSk7CiAgICAgICAgY21kcy5wdXQoREVT\nQ1JJQkUsIG5ldyBEZXNjcmliZUNtZCgpKTsKICAgICAgICBjbWRzLnB1dChS\nRUFEVE9QSUMsIG5ldyBSZWFkVG9waWNDbWQoKSk7CiAgICAgICAgY21kcy5w\ndXQoRk9STUFULCBuZXcgRm9ybWF0Q21kKCkpOwoKICAgICAgICByZXR1cm4g\nY21kczsKICAgIH0KCiAgICBzdGF0aWMgdm9pZCB1c2FnZSgpIHsKICAgICAg\nICBTeXN0ZW0uZXJyLnByaW50bG4oIkhlZHdpZ0NvbnNvbGUgW29wdGlvbnNd\nIFtjb21tYW5kXSBbYXJnc10iKTsKICAgICAgICBTeXN0ZW0uZXJyLnByaW50\nbG4oKTsKICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkF2YWlhYmxlIGNv\nbW1hbmRzOiIpOwogICAgICAgIGZvciAoU3RyaW5nIGNtZCA6IGdldEhlZHdp\nZ0NvbW1hbmRzKCkua2V5U2V0KCkpIHsKICAgICAgICAgICAgU3lzdGVtLmVy\nci5wcmludGxuKCJcdCIgKyBjbWQpOwogICAgICAgIH0KICAgICAgICBTeXN0\nZW0uZXJyLnByaW50bG4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEEgc3Rv\ncmFnZSBjbGFzcyBmb3IgYm90aCBjb21tYW5kIGxpbmUgb3B0aW9ucyBhbmQg\nc2hlbGwgY29tbWFuZHMuCiAgICAgKi8KICAgIHN0YXRpYyBwcml2YXRlIGNs\nYXNzIE15Q29tbWFuZE9wdGlvbnMgewoKICAgICAgICBwcml2YXRlIE1hcDxT\ndHJpbmcsU3RyaW5nPiBvcHRpb25zID0gbmV3IEhhc2hNYXA8U3RyaW5nLFN0\ncmluZz4oKTsKICAgICAgICBwcml2YXRlIExpc3Q8U3RyaW5nPiBjbWRBcmdz\nID0gbnVsbDsKICAgICAgICBwcml2YXRlIFN0cmluZyBjb21tYW5kID0gbnVs\nbDsKCiAgICAgICAgcHVibGljIE15Q29tbWFuZE9wdGlvbnMoKSB7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldE9wdGlvbihTdHJpbmcg\nb3B0KSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmdldChvcHQpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRDb21tYW5kKCAp\nIHsKICAgICAgICAgICAgcmV0dXJuIGNvbW1hbmQ7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nIGdldENtZEFyZ3VtZW50KCBpbnQgaW5kZXgg\nKSB7CiAgICAgICAgICAgIHJldHVybiBjbWRBcmdzLmdldChpbmRleCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldE51bUFyZ3VtZW50cygg\nKSB7CiAgICAgICAgICAgIHJldHVybiBjbWRBcmdzLnNpemUoKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRBcmdBcnJheSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIGNtZEFyZ3MudG9BcnJheShuZXcgU3RyaW5n\nWzBdKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFBhcnNl\ncyBhIGNvbW1hbmQgbGluZSB0aGF0IG1heSBjb250YWluIG9uZSBvciBtb3Jl\nIGZsYWdzCiAgICAgICAgICogYmVmb3JlIGFuIG9wdGlvbmFsIGNvbW1hbmQg\nc3RyaW5nCiAgICAgICAgICogQHBhcmFtIGFyZ3MgY29tbWFuZCBsaW5lIGFy\nZ3VtZW50cwogICAgICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwYXJzaW5nIHN1\nY2NlZWRlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBib29sZWFuIHBhcnNlT3B0aW9ucyhTdHJpbmdbXSBhcmdzKSB7\nCiAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBhcmdMaXN0ID0gQXJyYXlzLmFz\nTGlzdChhcmdzKTsKICAgICAgICAgICAgSXRlcmF0b3I8U3RyaW5nPiBpdCA9\nIGFyZ0xpc3QuaXRlcmF0b3IoKTsKCiAgICAgICAgICAgIHdoaWxlIChpdC5o\nYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBvcHQgPSBpdC5u\nZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoIW9wdC5zdGFydHNXaXRoKCIt\nIikpIHsKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gb3B0OwogICAg\nICAgICAgICAgICAgICAgIGNtZEFyZ3MgPSBuZXcgQXJyYXlMaXN0PFN0cmlu\nZz4oICk7CiAgICAgICAgICAgICAgICAgICAgY21kQXJncy5hZGQoIGNvbW1h\nbmQgKTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaXQuaGFzTmV4dCgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNtZEFyZ3MuYWRkKGl0Lm5l\neHQoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAg\nICBvcHRpb25zLnB1dChvcHQuc3Vic3RyaW5nKDEpLCBpdC5uZXh0KCkpOwog\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaEVsZW1lbnRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJy\nLnByaW50bG4oIkVycm9yOiBubyBhcmd1bWVudCBmb3VuZCBmb3Igb3B0aW9u\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIG9wdCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBCcmVha3MgYSBzdHJpbmcgaW50byBjb21tYW5kICsg\nYXJndW1lbnRzLgogICAgICAgICAqIEBwYXJhbSBjbWRzdHJpbmcgc3RyaW5n\nIG9mIGZvcm0gImNtZCBhcmcxIGFyZzIuLmV0YyIKICAgICAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgcGFyc2luZyBzdWNjZWVkZWQuCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gcGFyc2VDb21tYW5kKCBTdHJpbmcgY21k\nc3RyaW5nICkgewogICAgICAgICAgICBTdHJpbmdbXSBhcmdzID0gY21kc3Ry\naW5nLnNwbGl0KCIgIik7CiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA9\nPSAwKXsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBjb21tYW5kID0gYXJnc1swXTsKICAgICAgICAg\nICAgY21kQXJncyA9IEFycmF5cy5hc0xpc3QoYXJncyk7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGNs\nYXNzIE15V2F0Y2hlciBpbXBsZW1lbnRzIFdhdGNoZXIgewogICAgICAgIHB1\nYmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAg\nICAgICAgIGlmIChnZXRQcmludFdhdGNoZXMoKSkgewogICAgICAgICAgICAg\nICAgcHJpbnRNZXNzYWdlKCJXQVRDSEVSOjoiKTsKICAgICAgICAgICAgICAg\nIHByaW50TWVzc2FnZShldmVudC50b1N0cmluZygpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcmludE1lc3Nh\nZ2UoU3RyaW5nIG1zZykgewogICAgICAgIGlmIChpbkNvbnNvbGUpIHsKICAg\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJcbiIrbXNnKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWR3aWcgQ29uc29sZQogICAg\nICoKICAgICAqIEBwYXJhbSBhcmdzIGFyZ3VtZW50cwogICAgICogQHRocm93\ncyBJT0V4Y2VwdGlvbgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiAKICAgICAqLwogICAgcHVibGljIEhlZHdpZ0NvbnNvbGUoU3RyaW5n\nW10gYXJncykgdGhyb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgLy8gU2V0dXAgVGVybWluYWwKICAgICAgICB0ZXJt\naW5hbCA9IFRlcm1pbmFsLnNldHVwVGVybWluYWwoKTsKICAgICAgICBIZWR3\naWdDb21tYW5kcy5pbml0KCk7CiAgICAgICAgY2wucGFyc2VPcHRpb25zKGFy\nZ3MpOwoKICAgICAgICBpZiAoY2wuZ2V0Q29tbWFuZCgpID09IG51bGwpIHsK\nICAgICAgICAgICAgaW5Db25zb2xlID0gdHJ1ZTsKICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICBpbkNvbnNvbGUgPSBmYWxzZTsKICAgICAgICB9Cgog\nICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkNsaWVudENvbmZp\nZ3VyYXRpb24gYmtDbGllbnRDb25mID0KICAgICAgICAgICAgbmV3IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGh1YlNlcnZlckNvbmYgPSBu\nZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgIFN0cmluZyBzZXJ2\nZXJDZmdGaWxlID0gY2wuZ2V0T3B0aW9uKCJzZXJ2ZXItY2ZnIik7CiAgICAg\nICAgaWYgKHNlcnZlckNmZ0ZpbGUgIT0gbnVsbCkgewogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgaHViU2VydmVyQ29uZi5sb2FkQ29uZihu\nZXcgRmlsZShzZXJ2ZXJDZmdGaWxlKS50b1VSSSgpLnRvVVJMKCkpOwogICAg\nICAgICAgICB9IGNhdGNoIChDb25maWd1cmF0aW9uRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbihlKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nYmtDbGllbnRDb25mLmxvYWRDb25mKG5ldyBGaWxlKHNlcnZlckNmZ0ZpbGUp\nLnRvVVJJKCkudG9VUkwoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKENvbmZp\nZ3VyYXRpb25FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IElPRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBDbGllbnRDb25maWd1cmF0aW9uIGh1YkNsaWVudENmZyA9IG5l\ndyBDbGllbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgU3RyaW5nIGNsaWVu\ndENmZ0ZpbGUgPSBjbC5nZXRPcHRpb24oImNsaWVudC1jZmciKTsKICAgICAg\nICBpZiAoY2xpZW50Q2ZnRmlsZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBodWJDbGllbnRDZmcubG9hZENvbmYobmV3\nIEZpbGUoY2xpZW50Q2ZnRmlsZSkudG9VUkkoKS50b1VSTCgpKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoQ29uZmlndXJhdGlvbkV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByaW50TWVzc2FnZSgiQ29u\nbmVjdGluZyB0byB6b29rZWVwZXIvYm9va2tlZXBlciB1c2luZyBIZWR3aWdB\nZG1pbiIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGFkbWluID0gbmV3\nIEhlZHdpZ0FkbWluKGJrQ2xpZW50Q29uZiwgaHViU2VydmVyQ29uZik7CiAg\nICAgICAgICAgIGFkbWluLmdldFprSGFuZGxlKCkucmVnaXN0ZXIobmV3IE15\nV2F0Y2hlcigpKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZSk7CiAgICAgICAg\nfQogICAgICAgIAogICAgICAgIHByaW50TWVzc2FnZSgiQ29ubmVjdGluZyB0\nbyBkZWZhdWx0IGh1YiBzZXJ2ZXIgIiArIGh1YkNsaWVudENmZy5nZXREZWZh\ndWx0U2VydmVySG9zdCgpKTsKICAgICAgICBodWJDbGllbnQgPSBuZXcgSGVk\nd2lnQ2xpZW50KGh1YkNsaWVudENmZyk7CiAgICAgICAgcHVibGlzaGVyID0g\naHViQ2xpZW50LmdldFB1Ymxpc2hlcigpOwogICAgICAgIHN1YnNjcmliZXIg\nPSBodWJDbGllbnQuZ2V0U3Vic2NyaWJlcigpOwogICAgICAgIHN1YnNjcmli\nZXIuYWRkU3Vic2NyaXB0aW9uTGlzdGVuZXIobmV3IENvbnNvbGVTdWJzY3Jp\ncHRpb25MaXN0ZW5lcigpKTsKICAgICAgICAKICAgICAgICAvLyBvdGhlciBw\nYXJhbWV0ZXJzCiAgICAgICAgbXlSZWdpb24gPSBodWJTZXJ2ZXJDb25mLmdl\ndE15UmVnaW9uKCk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZ2V0UHJp\nbnRXYXRjaGVzKCkgewogICAgICAgIHJldHVybiBwcmludFdhdGNoZXM7CiAg\nICB9CgogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRQcm9tcHQoKSB7CiAgICAg\nICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAg\nICAgICAgc2IuYXBwZW5kKCJbaGVkd2lnOiAoIikuYXBwZW5kKG15UmVnaW9u\nKS5hcHBlbmQoIikgIikuYXBwZW5kKGNvbW1hbmRDb3VudCkuYXBwZW5kKCJd\nICIpOwogICAgICAgIHJldHVybiBzYi50b1N0cmluZygpOwogICAgfQoKICAg\nIHByb3RlY3RlZCBib29sZWFuIGNvbnRpbnVlT3JRdWl0KCkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlByZXNz\nIDxSZXR1cm4+IHRvIGNvbnRpbnVlLCBvciBRIHRvIGNhbmNlbCAuLi4iKTsK\nICAgICAgICBpbnQgY2g7CiAgICAgICAgaWYgKG51bGwgIT0gY29uc29sZSkg\newogICAgICAgICAgICBjaCA9IGNvbnNvbGUucmVhZENoYXJhY3RlcihDT05U\nSU5VRV9PUl9RVUlUKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBk\nbyB7CiAgICAgICAgICAgICAgICBjaCA9IHRlcm1pbmFsLnJlYWRDaGFyYWN0\nZXIoU3lzdGVtLmluKTsKICAgICAgICAgICAgfSB3aGlsZSAoY2ggIT0gJ3En\nICYmIGNoICE9ICdRJyAmJiBjaCAhPSAnXG4nKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKGNoID09ICdxJyB8fAogICAgICAgICAgICBjaCA9PSAnUScpIHsK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBhZGRUb0hp\nc3RvcnkoaW50IGksIFN0cmluZyBjbWQpIHsKICAgICAgICBoaXN0b3J5LnB1\ndChpLCBjbWQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGV4ZWN1dGVMaW5l\nKFN0cmluZyBsaW5lKSB7CiAgICAgICAgaWYgKCFsaW5lLmVxdWFscygiIikp\nIHsKICAgICAgICAgICAgY2wucGFyc2VDb21tYW5kKGxpbmUpOwogICAgICAg\nICAgICBhZGRUb0hpc3RvcnkoY29tbWFuZENvdW50LCBsaW5lKTsKICAgICAg\nICAgICAgcHJvY2Vzc0NtZChjbCk7CiAgICAgICAgICAgIGNvbW1hbmRDb3Vu\ndCsrOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiBw\ncm9jZXNzQ21kKE15Q29tbWFuZE9wdGlvbnMgY28pIHsKICAgICAgICBTdHJp\nbmdbXSBhcmdzID0gY28uZ2V0QXJnQXJyYXkoKTsKICAgICAgICBTdHJpbmcg\nY21kID0gY28uZ2V0Q29tbWFuZCgpOwogICAgICAgIGlmIChhcmdzLmxlbmd0\naCA8IDEpIHsKICAgICAgICAgICAgdXNhZ2UoKTsKICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIWdldEhlZHdpZ0Nv\nbW1hbmRzKCkuY29udGFpbnNLZXkoY21kKSkgewogICAgICAgICAgICB1c2Fn\nZSgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAg\nICAgICBMT0cuZGVidWcoIlByb2Nlc3Npbmcge30iLCBjbWQpOwoKICAgICAg\nICBNeUNvbW1hbmQgbXlDb21tYW5kID0gbXlDb21tYW5kcy5nZXQoY21kKTsK\nICAgICAgICBpZiAobXlDb21tYW5kID09IG51bGwpIHsKICAgICAgICAgICAg\nU3lzdGVtLmVyci5wcmludGxuKCJObyBDb21tYW5kIFByb2Nlc3NvciBmb3Vu\nZCBmb3IgY29tbWFuZCAiICsgY21kKTsKICAgICAgICAgICAgdXNhZ2UoKTsK\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAg\nbG9uZyBzdGFydFRpbWUgPSBNYXRoVXRpbHMubm93KCk7CiAgICAgICAgYm9v\nbGVhbiBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgc3VjY2VzcyA9IG15Q29tbWFuZC5ydW5DbWQoYXJncyk7CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZS5wcmludFN0\nYWNrVHJhY2UoKTsKICAgICAgICAgICAgc3VjY2VzcyA9IGZhbHNlOwogICAg\nICAgIH0KICAgICAgICBsb25nIGVsYXBzZWRUaW1lID0gTWF0aFV0aWxzLm5v\ndygpIC0gc3RhcnRUaW1lOwogICAgICAgIGlmIChpbkNvbnNvbGUpIHsKICAg\nICAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIFN5c3Rl\nbS5vdXQucHJpbnRsbigiRmluaXNoZWQgIiArICgoZG91YmxlKWVsYXBzZWRU\naW1lIC8gMTAwMCkgKyAiIHMuIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBDT01NQU5EIGMgPSBnZXRIZWR3aWdDb21tYW5kcygp\nLmdldChjbWQpOwogICAgICAgICAgICAgICAgaWYgKGMgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIGMucHJpbnRVc2FnZSgpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBzdWNjZXNzOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNo\nZWNrZWQiKQogICAgdm9pZCBydW4oKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGluQ29uc29sZSA9IHRydWU7CiAgICAgICAgbXlDb21tYW5kcyA9\nIGJ1aWxkTXlDb21tYW5kcygpOwogICAgICAgIGlmIChjbC5nZXRDb21tYW5k\nKCkgPT0gbnVsbCkgewogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4o\nIldlbGNvbWUgdG8gSGVkd2lnISIpOwogICAgICAgICAgICBTeXN0ZW0ub3V0\nLnByaW50bG4oIkpMaW5lIHN1cHBvcnQgaXMgZW5hYmxlZCIpOwoKICAgICAg\nICAgICAgY29uc29sZSA9IG5ldyBDb25zb2xlUmVhZGVyKCk7CiAgICAgICAg\nICAgIEpMaW5lSGVkd2lnQ29tcGxldG9yIGNvbXBsZXRvciA9IG5ldyBKTGlu\nZUhlZHdpZ0NvbXBsZXRvcihhZG1pbik7CiAgICAgICAgICAgIGNvbnNvbGUu\nYWRkQ29tcGxldG9yKGNvbXBsZXRvcik7CgogICAgICAgICAgICAvLyBsb2Fk\nIGhpc3RvcnkgZmlsZQogICAgICAgICAgICBIaXN0b3J5IGhpc3RvcnkgPSBu\nZXcgSGlzdG9yeSgpOwogICAgICAgICAgICBGaWxlIGZpbGUgPSBuZXcgRmls\nZShTeXN0ZW0uZ2V0UHJvcGVydHkoImh3Lmhpc3RvcnkiLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsZShTeXN0ZW0uZ2V0UHJv\ncGVydHkoInVzZXIuaG9tZSIpLCBIV19ISVNUT1JZX0ZJTEUpLnRvU3RyaW5n\nKCkpKTsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7\nCiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkhpc3RvcnkgZmlsZSBpcyAi\nICsgZmlsZS50b1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBoaXN0b3J5LnNldEhpc3RvcnlGaWxlKGZpbGUpOwogICAgICAgICAgICAv\nLyBzZXQgaGlzdG9yeSB0byBjb25zb2xlIHJlYWRlcgogICAgICAgICAgICBj\nb25zb2xlLnNldEhpc3RvcnkoaGlzdG9yeSk7CiAgICAgICAgICAgIC8vIGxv\nYWQgaGlzdG9yeSBmcm9tIGhpc3RvcnkgZmlsZQogICAgICAgICAgICBoaXN0\nb3J5Lm1vdmVUb0ZpcnN0RW50cnkoKTsKCiAgICAgICAgICAgIHdoaWxlICho\naXN0b3J5Lm5leHQoKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIGVudHJ5\nID0gaGlzdG9yeS5jdXJyZW50KCk7CiAgICAgICAgICAgICAgICBpZiAoIWVu\ndHJ5LmVxdWFscygiIikpIHsKICAgICAgICAgICAgICAgICAgICBhZGRUb0hp\nc3RvcnkoY29tbWFuZENvdW50LCBlbnRyeSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBjb21tYW5kQ291bnQrKzsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkpMaW5lIGhpc3Rv\ncnkgc3VwcG9ydCBpcyBlbmFibGVkIik7CgogICAgICAgICAgICBTdHJpbmcg\nbGluZTsKICAgICAgICAgICAgd2hpbGUgKChsaW5lID0gY29uc29sZS5yZWFk\nTGluZShnZXRQcm9tcHQoKSkpICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGV4ZWN1dGVMaW5lKGxpbmUpOwogICAgICAgICAgICAgICAgaGlzdG9yeS5h\nZGRUb0hpc3RvcnkobGluZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGluQ29uc29sZSA9IGZhbHNlOwogICAgICAgIHByb2Nlc3NDbWQo\nY2wpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG15Q29tbWFuZHMuZ2V0\nKEVYSVQpLnJ1bkNtZChuZXcgU3RyaW5nWzBdKTsKICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\nc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB0aHJvd3MgSU9FeGNl\ncHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBIZWR3aWdD\nb25zb2xlIGNvbnNvbGUgPSBuZXcgSGVkd2lnQ29uc29sZShhcmdzKTsKICAg\nICAgICBjb25zb2xlLnJ1bigpOwogICAgfQp9Cg==\n","encoding":"base64"}

