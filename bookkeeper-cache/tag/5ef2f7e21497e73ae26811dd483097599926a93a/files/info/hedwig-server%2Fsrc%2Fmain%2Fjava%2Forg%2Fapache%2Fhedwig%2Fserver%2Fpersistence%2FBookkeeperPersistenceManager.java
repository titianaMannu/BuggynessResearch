{"sha":"c8872b7593a862ab7bafe5a9ce6518587293157d","node_id":"MDQ6QmxvYjE1NzU5NTY6Yzg4NzJiNzU5M2E4NjJhYjdiYWZlNWE5Y2U2NTE4NTg3MjkzMTU3ZA==","size":56505,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c8872b7593a862ab7bafe5a9ce6518587293157d","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5F\nbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlRy\nZWVNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxl\nZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLmF0b21pYy5BdG9taWNCb29sZWFuOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5DbG9zZUNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxi\nYWNrLkRlbGV0ZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyRW50cnk7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RU\neXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcu\nVmVyc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9u\naW5nLlZlcnNpb25lZDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNl\ncHRpb24uU2VydmVyTm90UmVzcG9uc2libGVGb3JUb3BpY0V4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkxlZGdlclJhbmdlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvZXh0ZW5zaW9ucy5NZXNzYWdlSWRVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uVG9w\naWNPcFF1ZXVlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5j\nb21tb24uVW5leHBlY3RlZEVycm9yOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcuc2VydmVyLm1ldGEuTWV0YWRhdGFNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5tZXRhLlRvcGljUGVyc2lzdGVu\nY2VNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBl\ncnNpc3RlbmNlLlNjYW5DYWxsYmFjay5SZWFzb25Gb3JGaW5pc2g7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzLlRvcGljTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci50b3BpY3MuVG9w\naWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnV0aWwuQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy56b29rZWVwZXIuU2FmZUFzeW5CS0NhbGxiYWNrOwppbXBvcnQgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuVmFyQXJncy52YTsKCi8qKgogKiBU\naGlzIHBlcnNpc3RlbmNlIG1hbmFnZXIgdXNlcyB6b29rZWVwZXIgYW5kIGJv\nb2trZWVwZXIgdG8gc3RvcmUgbWVzc2FnZXMuCiAqCiAqIEluZm9ybWF0aW9u\nIGFib3V0IHRvcGljcyBhcmUgc3RvcmVkIGluIHpvb2tlZXBlciB3aXRoIGEg\nem5vZGUgbmFtZWQgYWZ0ZXIgdGhlCiAqIHRvcGljIHRoYXQgY29udGFpbnMg\nYW4gQVNDSUkgZW5jb2RlZCBsaXN0IHdpdGggcmVjb3JkcyBvZiB0aGUgZm9s\nbG93aW5nIGZvcm06CiAqCiAqIDxwcmU+CiAqIHN0YXJ0U2VxSWQoaW5jbHVk\nZWQpXHRsZWRnZXJJZFxuCiAqIDwvcHJlPgogKgogKi8KCnB1YmxpYyBjbGFz\ncyBCb29ra2VlcGVyUGVyc2lzdGVuY2VNYW5hZ2VyIGltcGxlbWVudHMgUGVy\nc2lzdGVuY2VNYW5hZ2VyV2l0aFJhbmdlU2NhbiwgVG9waWNPd25lcnNoaXBD\naGFuZ2VMaXN0ZW5lciB7CiAgICBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExv\nZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2trZWVwZXJQZXJzaXN0ZW5jZU1h\nbmFnZXIuY2xhc3MpOwogICAgc3RhdGljIGJ5dGVbXSBwYXNzd2QgPSAic2ls\nbHlzZWNyZXQiLmdldEJ5dGVzKCk7CiAgICBwcml2YXRlIEJvb2tLZWVwZXIg\nYms7CiAgICBwcml2YXRlIFRvcGljUGVyc2lzdGVuY2VNYW5hZ2VyIHRwTWFu\nYWdlcjsKICAgIHByaXZhdGUgU2VydmVyQ29uZmlndXJhdGlvbiBjZmc7CiAg\nICBwcml2YXRlIFRvcGljTWFuYWdlciB0bTsKCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBsb25nIFNUQVJUX1NFUV9JRCA9IDFMOwogICAgLy8gbWF4IG51\nbWJlciBvZiBlbnRyaWVzIGFsbG93ZWQgaW4gYSBsZWRnZXIKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGxvbmcgVU5MSU1JVEVEX0VOVFJJRVMgPSAwTDsK\nICAgIHByaXZhdGUgZmluYWwgbG9uZyBtYXhFbnRyaWVzUGVyTGVkZ2VyOwoK\nICAgIHN0YXRpYyBjbGFzcyBJbk1lbW9yeUxlZGdlclJhbmdlIHsKICAgICAg\nICBMZWRnZXJSYW5nZSByYW5nZTsKICAgICAgICBMZWRnZXJIYW5kbGUgaGFu\nZGxlOwoKICAgICAgICBwdWJsaWMgSW5NZW1vcnlMZWRnZXJSYW5nZShMZWRn\nZXJSYW5nZSByYW5nZSwgTGVkZ2VySGFuZGxlIGhhbmRsZSkgewogICAgICAg\nICAgICB0aGlzLnJhbmdlID0gcmFuZ2U7CiAgICAgICAgICAgIHRoaXMuaGFu\nZGxlID0gaGFuZGxlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEluTWVt\nb3J5TGVkZ2VyUmFuZ2UoTGVkZ2VyUmFuZ2UgcmFuZ2UpIHsKICAgICAgICAg\nICAgdGhpcyhyYW5nZSwgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgbG9uZyBnZXRTdGFydFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgICAgICAg\nIGFzc2VydCByYW5nZS5oYXNTdGFydFNlcUlkSW5jbHVkZWQoKTsKICAgICAg\nICAgICAgcmV0dXJuIHJhbmdlLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpOwog\nICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgY2xhc3MgVG9waWNJbmZvIHsK\nICAgICAgICAvKioKICAgICAgICAgKiBzdG9yZXMgdGhlIGxhc3QgbWVzc2Fn\nZS1zZXEtaWQgdmVjdG9yIHRoYXQgaGFzIGJlZW4gcHVzaGVkIHRvIEJLIGZv\ncgogICAgICAgICAqIHBlcnNpc3RlbmNlIChidXQgbm90IG5lY2Vzc2FyaWx5\nIGFja2VkIHlldCBieSBCSykKICAgICAgICAgKgogICAgICAgICAqLwogICAg\nICAgIE1lc3NhZ2VTZXFJZCBsYXN0U2VxSWRQdXNoZWQ7CgogICAgICAgIC8q\nKgogICAgICAgICAqIHN0b3JlcyB0aGUgbGFzdCBtZXNzYWdlLWlkIHRoYXQg\naGFzIGJlZW4gYWNrZWQgYnkgQksuIFRoaXMgbnVtYmVyIGlzCiAgICAgICAg\nICogYmFzaWNhbGx5IHVzZWQgZm9yIGxpbWl0aW5nIHNjYW5zIHRvIG5vdCBy\nZWFkIHBhc3Qgd2hhdCBoYXMgYmVlbgogICAgICAgICAqIHBlcnNpc3RlZCBi\neSBCSwogICAgICAgICAqLwogICAgICAgIGxvbmcgbGFzdEVudHJ5SWRBY2tl\nZEluQ3VycmVudExlZGdlciA9IC0xOyAvLyBiZWNhdXNlIEJLIGxlZGdlcnMg\nc3RhcnRzCiAgICAgICAgLy8gYXQgMAoKICAgICAgICAvKioKICAgICAgICAg\nKiBzdG9yZXMgYSBzb3J0ZWQgc3RydWN0dXJlIG9mIHRoZSBsZWRnZXJzIGZv\nciBhIHRvcGljLCBtYXBwaW5nIGZyb20KICAgICAgICAgKiB0aGUgZW5kU2Vx\nSWRJbmNsdWRlZCB0byB0aGUgbGVkZ2VyIGluZm8uIFRoaXMgc3RydWN0dXJl\nIGRvZXMgbm90CiAgICAgICAgICogaW5jbHVkZSB0aGUgY3VycmVudCBsZWRn\nZXIKICAgICAgICAgKi8KICAgICAgICBUcmVlTWFwPExvbmcsIEluTWVtb3J5\nTGVkZ2VyUmFuZ2U+IGxlZGdlclJhbmdlcyA9IG5ldyBUcmVlTWFwPExvbmcs\nIEluTWVtb3J5TGVkZ2VyUmFuZ2U+KCk7CiAgICAgICAgVmVyc2lvbiBsZWRn\nZXJSYW5nZXNWZXJzaW9uID0gVmVyc2lvbi5ORVc7CgogICAgICAgIC8qKgog\nICAgICAgICAqIFRoaXMgaXMgdGhlIGhhbmRsZSBvZiB0aGUgY3VycmVudCBs\nZWRnZXIgdGhhdCBpcyBiZWluZyB1c2VkIHRvIHdyaXRlCiAgICAgICAgICog\nbWVzc2FnZXMKICAgICAgICAgKi8KICAgICAgICBJbk1lbW9yeUxlZGdlclJh\nbmdlIGN1cnJlbnRMZWRnZXJSYW5nZTsKCiAgICAgICAgLyoqCiAgICAgICAg\nICogRmxhZyB0byByZWxlYXNlIHRvcGljIHdoZW4gZW5jb3VudGVyaW5nIHVu\ncmVjb3ZlcmFibGUgZXhjZXB0aW9ucwogICAgICAgICAqLwogICAgICAgIEF0\nb21pY0Jvb2xlYW4gZG9SZWxlYXNlID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFs\nc2UpOwoKICAgICAgICAvKioKICAgICAgICAgKiBGbGFnIGluZGljYXRzIHRo\nZSB0b3BpYyBpcyBjaGFuZ2luZyBsZWRnZXIKICAgICAgICAgKi8KICAgICAg\nICBBdG9taWNCb29sZWFuIGRvQ2hhbmdlTGVkZ2VyID0gbmV3IEF0b21pY0Jv\nb2xlYW4oZmFsc2UpOwogICAgICAgIC8qKgogICAgICAgICAqIExhc3Qgc2Vx\nIGlkIHRvIGNoYW5nZSBsZWRnZXIuCiAgICAgICAgICovCiAgICAgICAgbG9u\nZyBsYXN0U2VxSWRCZWZvcmVMZWRnZXJDaGFuZ2UgPSAtMTsKICAgICAgICAv\nKioKICAgICAgICAgKiBMaXN0IHRvIGJ1ZmZlciBhbGwgcGVyc2lzdCByZXF1\nZXN0cyBkdXJpbmcgY2hhbmdpbmcgbGVkZ2VyLgogICAgICAgICAqLwogICAg\nICAgIExpbmtlZExpc3Q8UGVyc2lzdFJlcXVlc3Q+IGRlZmVycmVkUmVxdWVz\ndHMgPSBudWxsOwoKICAgICAgICBmaW5hbCBzdGF0aWMgaW50IFVOTElNSVRF\nRCA9IDA7CiAgICAgICAgaW50IG1lc3NhZ2VCb3VuZCA9IFVOTElNSVRFRDsK\nICAgIH0KCiAgICBNYXA8Qnl0ZVN0cmluZywgVG9waWNJbmZvPiB0b3BpY0lu\nZm9zID0gbmV3IENvbmN1cnJlbnRIYXNoTWFwPEJ5dGVTdHJpbmcsIFRvcGlj\nSW5mbz4oKTsKCiAgICBUb3BpY09wUXVldWVyIHF1ZXVlcjsKCiAgICAvKioK\nICAgICAqIEluc3RhbnRpYXRlcyBhIEJvb2tLZWVwZXJQZXJzaXN0ZW5jZSBt\nYW5hZ2VyLgogICAgICoKICAgICAqIEBwYXJhbSBiawogICAgICogICAgICAg\nICAgICBhIHJlZmVyZW5jZSB0byBib29ra2VlcGVyIHRvIHVzZS4KICAgICAq\nIEBwYXJhbSBtZXRhTWFuYWdlckZhY3RvcnkKICAgICAqICAgICAgICAgICAg\nYSBtZXRhZGF0YSBtYW5hZ2VyIGZhY3RvcnkgaGFuZGxlIHRvIHVzZS4KICAg\nICAqIEBwYXJhbSB0bQogICAgICogICAgICAgICAgICBhIHJlZmVyZW5jZSB0\nbyB0b3BpYyBtYW5hZ2VyLgogICAgICogQHBhcmFtIGNmZwogICAgICogICAg\nICAgICAgICBTZXJ2ZXIgY29uZmlndXJhdGlvbiBvYmplY3QKICAgICAqIEBw\nYXJhbSBleGVjdXRvcgogICAgICogICAgICAgICAgICBBIGV4ZWN1dG9yCiAg\nICAgKi8KICAgIHB1YmxpYyBCb29ra2VlcGVyUGVyc2lzdGVuY2VNYW5hZ2Vy\nKEJvb2tLZWVwZXIgYmssIE1ldGFkYXRhTWFuYWdlckZhY3RvcnkgbWV0YU1h\nbmFnZXJGYWN0b3J5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgVG9waWNNYW5hZ2VyIHRtLCBTZXJ2ZXJDb25maWd1cmF0aW9u\nIGNmZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBleGVjdXRvcikgewogICAgICAg\nIHRoaXMuYmsgPSBiazsKICAgICAgICB0aGlzLnRwTWFuYWdlciA9IG1ldGFN\nYW5hZ2VyRmFjdG9yeS5uZXdUb3BpY1BlcnNpc3RlbmNlTWFuYWdlcigpOwog\nICAgICAgIHRoaXMuY2ZnID0gY2ZnOwogICAgICAgIHRoaXMudG0gPSB0bTsK\nICAgICAgICB0aGlzLm1heEVudHJpZXNQZXJMZWRnZXIgPSBjZmcuZ2V0TWF4\nRW50cmllc1BlckxlZGdlcigpOwogICAgICAgIHF1ZXVlciA9IG5ldyBUb3Bp\nY09wUXVldWVyKGV4ZWN1dG9yKTsKICAgICAgICB0bS5hZGRUb3BpY093bmVy\nc2hpcENoYW5nZUxpc3RlbmVyKHRoaXMpOwogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIExlZGdlclJhbmdlIGJ1aWxkTGVkZ2VyUmFuZ2UobG9uZyBsZWRn\nZXJJZCwgbG9uZyBzdGFydE9mTGVkZ2VyLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlU2VxSWQgZW5k\nT2ZMZWRnZXIpIHsKICAgICAgICBMZWRnZXJSYW5nZS5CdWlsZGVyIGJ1aWxk\nZXIgPQogICAgICAgICAgICBMZWRnZXJSYW5nZS5uZXdCdWlsZGVyKCkuc2V0\nTGVkZ2VySWQobGVkZ2VySWQpLnNldFN0YXJ0U2VxSWRJbmNsdWRlZChzdGFy\ndE9mTGVkZ2VyKQogICAgICAgICAgICAgICAgICAgICAgIC5zZXRFbmRTZXFJ\nZEluY2x1ZGVkKGVuZE9mTGVkZ2VyKTsKICAgICAgICByZXR1cm4gYnVpbGRl\nci5idWlsZCgpOwogICAgfQoKICAgIGNsYXNzIFJhbmdlU2Nhbk9wIGV4dGVu\nZHMgVG9waWNPcFF1ZXVlci5TeW5jaHJvbm91c09wIHsKICAgICAgICBSYW5n\nZVNjYW5SZXF1ZXN0IHJlcXVlc3Q7CiAgICAgICAgaW50IG51bU1lc3NhZ2Vz\nUmVhZCA9IDA7CiAgICAgICAgbG9uZyB0b3RhbFNpemVSZWFkID0gMDsKICAg\nICAgICBUb3BpY0luZm8gdG9waWNJbmZvOwogICAgICAgIGxvbmcgc3RhcnRT\nZXFJZFRvU2NhbjsKCiAgICAgICAgcHVibGljIFJhbmdlU2Nhbk9wKFJhbmdl\nU2NhblJlcXVlc3QgcmVxdWVzdCkgewogICAgICAgICAgICB0aGlzKHJlcXVl\nc3QsIC0xTCwgMCwgMEwpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFJh\nbmdlU2Nhbk9wKFJhbmdlU2NhblJlcXVlc3QgcmVxdWVzdCwgbG9uZyBzdGFy\ndFNlcUlkLCBpbnQgbnVtTWVzc2FnZXNSZWFkLCBsb25nIHRvdGFsU2l6ZVJl\nYWQpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVyKHJlcXVlc3QudG9waWMp\nOwogICAgICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0OwogICAgICAg\nICAgICB0aGlzLnN0YXJ0U2VxSWRUb1NjYW4gPSBzdGFydFNlcUlkOwogICAg\nICAgICAgICB0aGlzLm51bU1lc3NhZ2VzUmVhZCA9IG51bU1lc3NhZ2VzUmVh\nZDsKICAgICAgICAgICAgdGhpcy50b3RhbFNpemVSZWFkID0gdG90YWxTaXpl\nUmVhZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHBy\nb3RlY3RlZCB2b2lkIHJ1bkludGVybmFsKCkgewogICAgICAgICAgICB0b3Bp\nY0luZm8gPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAgICAgICBp\nZiAodG9waWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJlcXVl\nc3QuY2FsbGJhY2suc2NhbkZhaWxlZChyZXF1ZXN0LmN0eCwgbmV3IFB1YlN1\nYkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0\naW9uKCIiKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGlmIHN0YXJ0U2VxSWRUb1NjYW4gaXMgbGVz\ncyB0aGFuIHplcm8sIHdoaWNoIG1lYW5zIGl0IGlzIGFuIHVuZmluaXNoZWQg\nc2NhbiByZXF1ZXN0CiAgICAgICAgICAgIC8vIHdlIGNvbnRpbnVlIHRoZSBz\nY2FuIGZyb20gdGhlIHByb3ZpZGVkIHBvc2l0aW9uCiAgICAgICAgICAgIHN0\nYXJ0UmVhZGluZ0Zyb20oc3RhcnRTZXFJZFRvU2NhbiA8IDAgPyByZXF1ZXN0\nLnN0YXJ0U2VxSWQgOiBzdGFydFNlcUlkVG9TY2FuKTsKICAgICAgICB9Cgog\nICAgICAgIHByb3RlY3RlZCB2b2lkIHJlYWQoZmluYWwgSW5NZW1vcnlMZWRn\nZXJSYW5nZSBpbWxyLCBmaW5hbCBsb25nIHN0YXJ0U2VxSWQsIGZpbmFsIGxv\nbmcgZW5kU2VxSWQpIHsKICAgICAgICAgICAgLy8gVmVyaWZ5IHdoZXRoZXIg\nc3RhcnRTZXFJZCBmYWxscyBpbiBsZWRnZXIgcmFuZ2UuCiAgICAgICAgICAg\nIC8vIE9ubHkgdGhlIGxlZnQgZW5kcG9pbnQgb2YgcmFuZ2UgbmVlZHMgdG8g\nYmUgY2hlY2tlZC4KICAgICAgICAgICAgaWYgKGltbHIuZ2V0U3RhcnRTZXFJ\nZEluY2x1ZGVkKCkgPiBzdGFydFNlcUlkKSB7CiAgICAgICAgICAgICAgICBs\nb2dnZXIuZXJyb3IoCiAgICAgICAgICAgICAgICAgICAgICAgICJJbnZhbGlk\nIFJhbmdlU2NhbiByZWFkLCBzdGFydFNlcUlkIHt9IGRvZXNuJ3QgZmFsbCBp\nbiBsZWRnZXIgcmFuZ2UgW3t9IH4ge31dIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgdmEoc3RhcnRTZXFJZCwgaW1sci5nZXRTdGFydFNlcUlkSW5jbHVk\nZWQoKSwgaW1sci5yYW5nZS5oYXNFbmRTZXFJZEluY2x1ZGVkKCkgPyBpbWxy\nLnJhbmdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldEVu\nZFNlcUlkSW5jbHVkZWQoKS5nZXRMb2NhbENvbXBvbmVudCgpIDogIiIpKTsK\nICAgICAgICAgICAgICAgIHJlcXVlc3QuY2FsbGJhY2suc2NhbkZhaWxlZChy\nZXF1ZXN0LmN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5VbmV4cGVjdGVkQ29u\nZGl0aW9uRXhjZXB0aW9uKCJTY2FuIHJlcXVlc3QgaXMgb3V0IG9mIHJhbmdl\nIikpOwoKICAgICAgICAgICAgICAgIC8vIHRyeSByZWxlYXNlIHRvcGljIHRv\nIHJlc2V0IHRoZSBzdGF0ZQogICAgICAgICAgICAgICAgbG9zdFRvcGljKHRv\ncGljKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgaWYgKGltbHIuaGFuZGxlID09IG51bGwpIHsKCiAgICAg\nICAgICAgICAgICBiay5hc3luY09wZW5MZWRnZXIoaW1sci5yYW5nZS5nZXRM\nZWRnZXJJZCgpLCBEaWdlc3RUeXBlLkNSQzMyLCBwYXNzd2QsCiAgICAgICAg\nICAgICAgICBuZXcgU2FmZUFzeW5CS0NhbGxiYWNrLk9wZW5DYWxsYmFjaygp\nIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzYWZlT3BlbkNvbXBsZXRlKGludCByYywg\nTGVkZ2VySGFuZGxlIGxlZGdlckhhbmRsZSwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29k\nZS5PSykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaW1sci5oYW5k\nbGUgPSBsZWRnZXJIYW5kbGU7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZWFkKGltbHIsIHN0YXJ0U2VxSWQsIGVuZFNlcUlkKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbiBi\na2UgPSBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwogICAgICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIuZXJyb3IoIkNvdWxkIG5vdCBvcGVuIGxlZGdlcjog\nIiArIGltbHIucmFuZ2UuZ2V0TGVkZ2VySWQoKSArICIgZm9yIHRvcGljOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGlj\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFjay5z\nY2FuRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93\nbkV4Y2VwdGlvbihia2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0s\nIHJlcXVlc3QuY3R4KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gbGVkZ2VyIGhhbmRsZSBpcyBub3Qg\nbnVsbCwgd2UgY2FuIHJlYWQgZnJvbSBpdAogICAgICAgICAgICBsb25nIGNv\ncnJlY3RlZEVuZFNlcUlkID0gTWF0aC5taW4oc3RhcnRTZXFJZCArIHJlcXVl\nc3QubWVzc2FnZUxpbWl0IC0gbnVtTWVzc2FnZXNSZWFkIC0gMSwgZW5kU2Vx\nSWQpOwoKICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIklzc3VpbmcgYSBi\nayByZWFkIGZvciBsZWRnZXI6ICIgKyBpbWxyLmhhbmRsZS5nZXRJZCgpICsg\nIiBmcm9tIGVudHJ5LWlkOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyAoc3RhcnRTZXFJZCAtIGltbHIuZ2V0U3RhcnRTZXFJZEluY2x1ZGVk\nKCkpICsgIiB0byBlbnRyeS1pZDogIgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgKGNvcnJlY3RlZEVuZFNlcUlkIC0gaW1sci5nZXRTdGFydFNl\ncUlkSW5jbHVkZWQoKSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nbWxyLmhhbmRsZS5hc3luY1JlYWRFbnRyaWVzKHN0YXJ0U2VxSWQgLSBpbWxy\nLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpLCBjb3JyZWN0ZWRFbmRTZXFJZAog\nICAgICAgICAgICAtIGltbHIuZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCksIG5l\ndyBTYWZlQXN5bkJLQ2FsbGJhY2suUmVhZENhbGxiYWNrKCkgewoKICAgICAg\nICAgICAgICAgIGxvbmcgZXhwZWN0ZWRFbnRyeUlkID0gc3RhcnRTZXFJZCAt\nIGltbHIuZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCk7CgogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZl\nUmVhZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0sgfHwg\nIXNlcS5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gbWVhbnMgdGhhdCB0aGVyZSBpcyBu\nbyBlbnRyaWVzIHJlYWQsIHByb3ZpZGUgYSBtZWFuaW5nZnVsIGV4Y2VwdGlv\nbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlv\nbi5Db2RlLk5vU3VjaEVudHJ5RXhjZXB0aW9uOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIEJLRXhjZXB0aW9u\nIGJrZSA9IEJLRXhjZXB0aW9uLmNyZWF0ZShyYyk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5lcnJvcigiRXJyb3Igd2hpbGUgcmVhZGluZyBm\ncm9tIGxlZGdlcjogIiArIGltbHIucmFuZ2UuZ2V0TGVkZ2VySWQoKSArICIg\nZm9yIHRvcGljOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBia2UpOwogICAgICAgICAg\nICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNrLnNjYW5GYWlsZWQocmVx\ndWVzdC5jdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNl\ncHRpb24oYmtlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIExl\nZGdlckVudHJ5IGVudHJ5ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB3\naGlsZSAoc2VxLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGVudHJ5ID0gc2VxLm5leHRFbGVtZW50KCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIE1lc3NhZ2UgbWVzc2FnZTsKICAgICAgICAgICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG1lc3NhZ2UgPSBNZXNzYWdlLnBhcnNlRnJvbShlbnRyeS5nZXRFbnRyeUlu\ncHV0U3RyZWFtKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBTdHJpbmcgbXNnID0gIlVucmVhZGFibGUgbWVzc2FnZSBmb3VuZCBpbiBs\nZWRnZXI6ICIgKyBpbWxyLnJhbmdlLmdldExlZGdlcklkKCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgZm9yIHRvcGlj\nOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIuZXJyb3IobXNnLCBlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcXVlc3QuY2FsbGJhY2suc2NhbkZhaWxlZChj\ndHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uVW5leHBlY3RlZENvbmRpdGlvbkV4\nY2VwdGlvbihtc2cpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWFkIHJlc3BvbnNlIGZyb20g\nbGVkZ2VyOiB7fSBlbnRyeS1pZDoge30iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbGguZ2V0SWQoKSwgZW50cnkuZ2V0RW50cnlJ\nZCgpKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydCBleHBlY3Rl\nZEVudHJ5SWQgPT0gZW50cnkuZ2V0RW50cnlJZCgpIDogImV4cGVjdGVkRW50\ncnlJZCAoIiArIGV4cGVjdGVkRW50cnlJZAogICAgICAgICAgICAgICAgICAg\nICAgICArICIpICE9IGVudHJ5LmdldEVudHJ5SWQoKSAoIiArIGVudHJ5Lmdl\ndEVudHJ5SWQoKSArICIpIjsKICAgICAgICAgICAgICAgICAgICAgICAgYXNz\nZXJ0IChtZXNzYWdlLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21wb25lbnQoKSAt\nIGltbHIuZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCkpID09IGV4cGVjdGVkRW50\ncnlJZDsKCiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkRW50cnlJ\nZCsrOwogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNr\nLm1lc3NhZ2VTY2FubmVkKGN0eCwgbWVzc2FnZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIG51bU1lc3NhZ2VzUmVhZCsrOwogICAgICAgICAgICAgICAg\nICAgICAgICB0b3RhbFNpemVSZWFkICs9IG1lc3NhZ2UuZ2V0Qm9keSgpLnNp\nemUoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudW1NZXNzYWdl\nc1JlYWQgPj0gcmVxdWVzdC5tZXNzYWdlTGltaXQpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJlcXVlc3QuY2FsbGJhY2suc2NhbkZpbmlzaGVk\nKGN0eCwgUmVhc29uRm9yRmluaXNoLk5VTV9NRVNTQUdFU19MSU1JVF9FWENF\nRURFRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmICh0b3RhbFNpemVSZWFkID49IHJlcXVlc3Quc2l6ZUxpbWl0KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNr\nLnNjYW5GaW5pc2hlZChjdHgsIFJlYXNvbkZvckZpbmlzaC5TSVpFX0xJTUlU\nX0VYQ0VFREVEKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gY29udGludWUgc2Nhbm5p\nbmcgbWVzc2FnZXMKICAgICAgICAgICAgICAgICAgICBzY2FuTWVzc2FnZXMo\ncmVxdWVzdCwgaW1sci5nZXRTdGFydFNlcUlkSW5jbHVkZWQoKSArIGVudHJ5\nLmdldEVudHJ5SWQoKSArIDEsIG51bU1lc3NhZ2VzUmVhZCwgdG90YWxTaXpl\nUmVhZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHJlcXVl\nc3QuY3R4KTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIHN0\nYXJ0UmVhZGluZ0Zyb20obG9uZyBzdGFydFNlcUlkKSB7CgogICAgICAgICAg\nICBNYXAuRW50cnk8TG9uZywgSW5NZW1vcnlMZWRnZXJSYW5nZT4gZW50cnkg\nPSB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmNlaWxpbmdFbnRyeShzdGFydFNl\ncUlkKTsKCiAgICAgICAgICAgIGlmIChlbnRyeSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAvLyBOb25lIG9mIHRoZSBvbGQgbGVkZ2VycyBoYXZlIHRo\naXMgc2VxLWlkLCB3ZSBtdXN0IHVzZSB0aGUKICAgICAgICAgICAgICAgIC8v\nIGN1cnJlbnQgbGVkZ2VyCiAgICAgICAgICAgICAgICBsb25nIGVuZFNlcUlk\nID0gdG9waWNJbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5nZXRTdGFydFNlcUlk\nSW5jbHVkZWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\ndG9waWNJbmZvLmxhc3RFbnRyeUlkQWNrZWRJbkN1cnJlbnRMZWRnZXI7Cgog\nICAgICAgICAgICAgICAgaWYgKGVuZFNlcUlkIDwgc3RhcnRTZXFJZCkgewog\nICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuY2FsbGJhY2suc2NhbkZpbmlz\naGVkKHJlcXVlc3QuY3R4LCBSZWFzb25Gb3JGaW5pc2guTk9fTU9SRV9NRVNT\nQUdFUyk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIHJlYWQodG9waWNJbmZvLmN1cnJl\nbnRMZWRnZXJSYW5nZSwgc3RhcnRTZXFJZCwgZW5kU2VxSWQpOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVhZChlbnRyeS5nZXRW\nYWx1ZSgpLCBzdGFydFNlcUlkLCBlbnRyeS5nZXRWYWx1ZSgpLnJhbmdlLmdl\ndEVuZFNlcUlkSW5jbHVkZWQoKS5nZXRMb2NhbENvbXBvbmVudCgpKTsKICAg\nICAgICAgICAgfQoKICAgICAgICB9CgogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgc2Nhbk1lc3NhZ2VzKFJhbmdlU2NhblJlcXVlc3Qg\ncmVxdWVzdCkgewogICAgICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4ocmVx\ndWVzdC50b3BpYywgbmV3IFJhbmdlU2Nhbk9wKHJlcXVlc3QpKTsKICAgIH0K\nCiAgICBwcm90ZWN0ZWQgdm9pZCBzY2FuTWVzc2FnZXMoUmFuZ2VTY2FuUmVx\ndWVzdCByZXF1ZXN0LCBsb25nIHNjYW5TZXFJZCwgaW50IG51bU1zZ3NSZWFk\nLCBsb25nIHRvdGFsU2l6ZVJlYWQpIHsKICAgICAgICBxdWV1ZXIucHVzaEFu\nZE1heWJlUnVuKHJlcXVlc3QudG9waWMsIG5ldyBSYW5nZVNjYW5PcChyZXF1\nZXN0LCBzY2FuU2VxSWQsIG51bU1zZ3NSZWFkLCB0b3RhbFNpemVSZWFkKSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsaXZlcmVkVW50aWwoQnl0ZVN0\ncmluZyB0b3BpYywgTG9uZyBzZXFJZCkgewogICAgICAgIC8vIE5vdGhpbmcg\ndG8gZG8gaGVyZS4gdGhpcyBpcyBqdXN0IGEgaGludCB0aGF0IHdlIGNhbm5v\ndCB1c2UuCiAgICB9CgogICAgY2xhc3MgVXBkYXRlTGVkZ2VyT3AgZXh0ZW5k\ncyBUb3BpY09wUXVldWVyLkFzeW5jaHJvbm91c09wPFZvaWQ+IHsKICAgICAg\nICBwcml2YXRlIFNldDxMb25nPiBsZWRnZXJzRGVsZXRlZDsKCiAgICAgICAg\ncHVibGljIFVwZGF0ZUxlZGdlck9wKEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFs\nIENhbGxiYWNrPFZvaWQ+IGNiLCBmaW5hbCBPYmplY3QgY3R4LAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBTZXQ8TG9uZz4gbGVkZ2Vyc0RlbGV0\nZWQpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVyKHRvcGljLCBjYiwgY3R4\nKTsKICAgICAgICAgICAgdGhpcy5sZWRnZXJzRGVsZXRlZCA9IGxlZGdlcnNE\nZWxldGVkOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICBmaW5hbCBUb3BpY0lu\nZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwogICAgICAg\nICAgICBpZiAodG9waWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nIGxvZ2dlci5lcnJvcigiU2VydmVyIGlzIG5vdCByZXNwb25zaWJsZSBmb3Ig\ndG9waWMhIik7CiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQo\nY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxl\nRm9yVG9waWNFeGNlcHRpb24oIiIpKTsKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgfQogICAgICAgICAgICBMZWRnZXJSYW5nZXMuQnVp\nbGRlciBidWlsZGVyID0gTGVkZ2VyUmFuZ2VzLm5ld0J1aWxkZXIoKTsKICAg\nICAgICAgICAgZmluYWwgU2V0PExvbmc+IGtleXNUb1JlbW92ZSA9IG5ldyBI\nYXNoU2V0PExvbmc+KCk7CiAgICAgICAgICAgIGJvb2xlYW4gZm91bmRVbmNv\nbnN1bWVkTGVkZ2VyID0gZmFsc2U7CiAgICAgICAgICAgIGZvciAoTWFwLkVu\ndHJ5PExvbmcsIEluTWVtb3J5TGVkZ2VyUmFuZ2U+IGUgOiB0b3BpY0luZm8u\nbGVkZ2VyUmFuZ2VzLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgICAgIExl\nZGdlclJhbmdlIGxyID0gZS5nZXRWYWx1ZSgpLnJhbmdlOwogICAgICAgICAg\nICAgICAgbG9uZyBsZWRnZXJJZCA9IGxyLmdldExlZGdlcklkKCk7CiAgICAg\nICAgICAgICAgICBpZiAoIWZvdW5kVW5jb25zdW1lZExlZGdlciAmJiBsZWRn\nZXJzRGVsZXRlZC5jb250YWlucyhsZWRnZXJJZCkpIHsKICAgICAgICAgICAg\nICAgICAgICBrZXlzVG9SZW1vdmUuYWRkKGUuZ2V0S2V5KCkpOwogICAgICAg\nICAgICAgICAgICAgIGlmICghbHIuaGFzRW5kU2VxSWRJbmNsdWRlZCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBtc2cgPSAiU2hvdWxk\nIG5vdCByZW1vdmUgdW5jbG9zZWQgbGVkZ2VyICIgKyBsZWRnZXJJZCArICIg\nZm9yIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1zZyk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJT\ndWJFeGNlcHRpb24uVW5leHBlY3RlZENvbmRpdGlvbkV4Y2VwdGlvbihtc2cp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgZm91bmRVbmNvbnN1bWVkTGVkZ2VyID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgICAgICBidWlsZGVyLmFkZFJhbmdlcyhscik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnVpbGRl\nci5hZGRSYW5nZXModG9waWNJbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5yYW5n\nZSk7CgogICAgICAgICAgICBpZiAoIWtleXNUb1JlbW92ZS5pc0VtcHR5KCkp\nIHsKICAgICAgICAgICAgICAgIGZpbmFsIExlZGdlclJhbmdlcyBuZXdSYW5n\nZXMgPSBidWlsZGVyLmJ1aWxkKCk7CiAgICAgICAgICAgICAgICB0cE1hbmFn\nZXIud3JpdGVUb3BpY1BlcnNpc3RlbmNlSW5mbygKICAgICAgICAgICAgICAg\nIHRvcGljLCBuZXdSYW5nZXMsIHRvcGljSW5mby5sZWRnZXJSYW5nZXNWZXJz\naW9uLCBuZXcgQ2FsbGJhY2s8VmVyc2lvbj4oKSB7CiAgICAgICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0\neCwgVmVyc2lvbiBuZXdWZXJzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIEZpbmFsbHksIGFsbCBkb25lCiAgICAgICAgICAgICAgICAgICAg\nICAgIGZvciAoTG9uZyBrIDoga2V5c1RvUmVtb3ZlKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLnJlbW92\nZShrKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzVmVyc2lvbiA9IG5l\nd1ZlcnNpb247CiAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlv\nbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxl\nZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgs\nIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfSwgY3R4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgY2xhc3MgQ29uc3VtZVVu\ndGlsT3AgZXh0ZW5kcyBUb3BpY09wUXVldWVyLlN5bmNocm9ub3VzT3Agewog\nICAgICAgIHByaXZhdGUgZmluYWwgbG9uZyBzZXFJZDsKCiAgICAgICAgcHVi\nbGljIENvbnN1bWVVbnRpbE9wKEJ5dGVTdHJpbmcgdG9waWMsIGxvbmcgc2Vx\nSWQpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVyKHRvcGljKTsKICAgICAg\nICAgICAgdGhpcy5zZXFJZCA9IHNlcUlkOwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuSW50ZXJuYWwoKSB7\nCiAgICAgICAgICAgIFRvcGljSW5mbyB0b3BpY0luZm8gPSB0b3BpY0luZm9z\nLmdldCh0b3BpYyk7CiAgICAgICAgICAgIGlmICh0b3BpY0luZm8gPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJTZXJ2ZXIgaXMg\nbm90IHJlc3BvbnNpYmxlIGZvciB0b3BpYyEiKTsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmluYWwgTGlu\na2VkTGlzdDxMb25nPiBsZWRnZXJzVG9EZWxldGUgPSBuZXcgTGlua2VkTGlz\ndDxMb25nPigpOwogICAgICAgICAgICBmb3IgKExvbmcgZW5kU2VxSWRJbmNs\ndWRlZCA6IHRvcGljSW5mby5sZWRnZXJSYW5nZXMua2V5U2V0KCkpIHsKICAg\nICAgICAgICAgICAgIGlmIChlbmRTZXFJZEluY2x1ZGVkIDw9IHNlcUlkKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBsZWRnZXIncyBtZXNzYWdl\nIGVudHJpZXMgaGF2ZSBhbGwgYmVlbiBjb25zdW1lZCBhbHJlYWR5CiAgICAg\nICAgICAgICAgICAgICAgLy8gc28gaXQgaXMgc2FmZSB0byBkZWxldGUgaXQg\nZnJvbSBCb29rS2VlcGVyLgogICAgICAgICAgICAgICAgICAgIGxvbmcgbGVk\nZ2VySWQgPSB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmdldChlbmRTZXFJZElu\nY2x1ZGVkKS5yYW5nZS5nZXRMZWRnZXJJZCgpOwogICAgICAgICAgICAgICAg\nICAgIGxlZGdlcnNUb0RlbGV0ZS5hZGQobGVkZ2VySWQpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\nbm8gbGVkZ2VycyBuZWVkIHRvIGRlbGV0ZQogICAgICAgICAgICBpZiAobGVk\nZ2Vyc1RvRGVsZXRlLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBTZXQ8TG9uZz4gbGVk\nZ2Vyc0RlbGV0ZWQgPSBuZXcgSGFzaFNldDxMb25nPigpOwogICAgICAgICAg\nICBkZWxldGVMZWRnZXJzQW5kVXBkYXRlTGVkZ2Vyc1JhbmdlKHRvcGljLCBs\nZWRnZXJzVG9EZWxldGUsIGxlZGdlcnNEZWxldGVkKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIGRlbGV0ZUxlZGdlcnNBbmRVcGRhdGVM\nZWRnZXJzUmFuZ2UoZmluYWwgQnl0ZVN0cmluZyB0b3BpYywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZp\nbmFsIExpbmtlZExpc3Q8TG9uZz4gbGVkZ2Vyc1RvRGVsZXRlLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZmluYWwgU2V0PExvbmc+IGxlZGdlcnNEZWxldGVkKSB7CiAgICAgICAgaWYg\nKGxlZGdlcnNUb0RlbGV0ZS5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgQ2Fs\nbGJhY2s8Vm9pZD4gY2IgPSBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmpl\nY3QgY3R4LCBWb2lkIHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIC8v\nIGRvIG5vdGhpbmcsIG9wIGlzIGFzeW5jIHRvIHN0b3Agb3RoZXIgb3BzCiAg\nICAgICAgICAgICAgICAgICAgLy8gb2NjdXJyaW5nIG9uIHRoZSB0b3BpYyBk\ndXJpbmcgdGhlIHVwZGF0ZQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgs\nIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIkZhaWxlZCB0byB1cGRhdGUgbGVkZ2VyIHpu\nb2RlIGZvciB0b3BpYyB7fSBkZWxldGluZyBsZWRnZXJzIHt9IDoge30iLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YSh0b3BpYy50b1N0\ncmluZ1V0ZjgoKSwgbGVkZ2Vyc0RlbGV0ZWQsIGV4Y2VwdGlvbi5nZXRNZXNz\nYWdlKCkpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAg\nICAgICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IFVw\nZGF0ZUxlZGdlck9wKHRvcGljLCBjYiwgbnVsbCwgbGVkZ2Vyc0RlbGV0ZWQp\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZmlu\nYWwgTG9uZyBsZWRnZXIgPSBsZWRnZXJzVG9EZWxldGUucG9sbCgpOwogICAg\nICAgIGlmIChudWxsID09IGxlZGdlcikgewogICAgICAgICAgICBkZWxldGVM\nZWRnZXJzQW5kVXBkYXRlTGVkZ2Vyc1JhbmdlKHRvcGljLCBsZWRnZXJzVG9E\nZWxldGUsIGxlZGdlcnNEZWxldGVkKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgYmsuYXN5bmNEZWxldGVMZWRnZXIobGVkZ2Vy\nLCBuZXcgRGVsZXRlQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBkZWxldGVDb21wbGV0ZShpbnQg\ncmMsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgIGlmIChCS0V4Y2Vw\ndGlvbi5Db2RlLk5vU3VjaExlZGdlckV4aXN0c0V4Y2VwdGlvbiA9PSByYyB8\nfAogICAgICAgICAgICAgICAgICAgIEJLRXhjZXB0aW9uLkNvZGUuT0sgPT0g\ncmMpIHsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJzRGVsZXRlZC5hZGQo\nbGVkZ2VyKTsKICAgICAgICAgICAgICAgICAgICBkZWxldGVMZWRnZXJzQW5k\nVXBkYXRlTGVkZ2Vyc1JhbmdlKHRvcGljLCBsZWRnZXJzVG9EZWxldGUsIGxl\nZGdlcnNEZWxldGVkKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxv\nZ2dlci53YXJuKCJFeGNlcHRpb24gd2hpbGUgZGVsZXRpbmcgY29uc3VtZWQg\nbGVkZ2VyIHt9LCBzdG9wIGRlbGV0aW5nIG90aGVyIGxlZGdlcnMge30gIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgImFuZCB1cGRhdGUg\nbGVkZ2VyIHJhbmdlcyB3aXRoIGRlbGV0ZWQgbGVkZ2VycyB7fSA6IHt9IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YShsZWRnZXIsIGxl\nZGdlcnNUb0RlbGV0ZSwgbGVkZ2Vyc0RlbGV0ZWQsIEJLRXhjZXB0aW9uLmNy\nZWF0ZShyYykpKTsKICAgICAgICAgICAgICAgICAgICAvLyBXZSBzaG91bGQg\nbm90IGNvbnRpbnVlIHdoZW4gZmFpbGVkIHRvIGRlbGV0ZSBsZWRnZXIKICAg\nICAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBjYiA9IG5ldyBDYWxs\nYmFjazxWb2lkPigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCByZXN1\nbHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhp\nbmcsIG9wIGlzIGFzeW5jIHRvIHN0b3Agb3RoZXIgb3BzCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyBvY2N1cnJpbmcgb24gdGhlIHRvcGljIGR1\ncmluZyB0aGUgdXBkYXRlCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFp\nbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRmFp\nbGVkIHRvIHVwZGF0ZSBsZWRnZXIgem5vZGUgZm9yIHRvcGljIHt9IGRlbGV0\naW5nIGxlZGdlcnMge30gOiB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdmEodG9waWMsIGxlZGdlcnNEZWxldGVkLCBl\neGNlcHRpb24uZ2V0TWVzc2FnZSgpKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAg\nICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBVcGRhdGVM\nZWRnZXJPcCh0b3BpYywgY2IsIG51bGwsIGxlZGdlcnNEZWxldGVkKSk7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfSwgbnVsbCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY29uc3VtZWRVbnRpbChCeXRlU3RyaW5nIHRvcGljLCBMb25n\nIHNlcUlkKSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3Bp\nYywgbmV3IENvbnN1bWVVbnRpbE9wKHRvcGljLCBNYXRoLm1heChzZXFJZCwg\nZ2V0TWluU2VxSWRGb3JUb3BpYyh0b3BpYykpKSk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgY29uc3VtZVRvQm91bmQoQnl0ZVN0cmluZyB0b3BpYykgewog\nICAgICAgIFRvcGljSW5mbyB0b3BpY0luZm8gPSB0b3BpY0luZm9zLmdldCh0\nb3BpYyk7CgogICAgICAgIGlmICh0b3BpY0luZm8gPT0gbnVsbCB8fCB0b3Bp\nY0luZm8ubWVzc2FnZUJvdW5kID09IHRvcGljSW5mby5VTkxJTUlURUQpIHsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBxdWV1ZXIu\ncHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgQ29uc3VtZVVudGlsT3AodG9w\naWMsIGdldE1pblNlcUlkRm9yVG9waWModG9waWMpKSk7CiAgICB9CgogICAg\ncHVibGljIGxvbmcgZ2V0TWluU2VxSWRGb3JUb3BpYyhCeXRlU3RyaW5nIHRv\ncGljKSB7CiAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5m\nb3MuZ2V0KHRvcGljKTsKCiAgICAgICAgaWYgKHRvcGljSW5mbyA9PSBudWxs\nIHx8IHRvcGljSW5mby5tZXNzYWdlQm91bmQgPT0gdG9waWNJbmZvLlVOTElN\nSVRFRCkgewogICAgICAgICAgICByZXR1cm4gTG9uZy5NSU5fVkFMVUU7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuICh0b3BpY0luZm8u\nbGFzdFNlcUlkUHVzaGVkLmdldExvY2FsQ29tcG9uZW50KCkgLSB0b3BpY0lu\nZm8ubWVzc2FnZUJvdW5kKSArIDE7CiAgICAgICAgfQogICAgfQoKICAgIHB1\nYmxpYyBNZXNzYWdlU2VxSWQgZ2V0Q3VycmVudFNlcUlkRm9yVG9waWMoQnl0\nZVN0cmluZyB0b3BpYykgdGhyb3dzIFNlcnZlck5vdFJlc3BvbnNpYmxlRm9y\nVG9waWNFeGNlcHRpb24gewogICAgICAgIFRvcGljSW5mbyB0b3BpY0luZm8g\nPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAgIGlmICh0b3BpY0lu\nZm8gPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUHViU3ViRXhj\nZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9waWNFeGNlcHRpb24o\nIiIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRvcGljSW5mby5sYXN0\nU2VxSWRQdXNoZWQ7CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0U2VxSWRB\nZnRlclNraXBwaW5nKEJ5dGVTdHJpbmcgdG9waWMsIGxvbmcgc2VxSWQsIGlu\ndCBza2lwQW1vdW50KSB7CiAgICAgICAgcmV0dXJuIE1hdGgubWF4KHNlcUlk\nICsgc2tpcEFtb3VudCwgZ2V0TWluU2VxSWRGb3JUb3BpYyh0b3BpYykpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSB0b3BpYyBvbiBmYWlsdXJl\nCiAgICAgKgogICAgICogQHBhcmFtIHRvcGljCiAgICAgKiAgICAgICAgICBU\nb3BpYyBOYW1lCiAgICAgKiBAcGFyYW0gZQogICAgICogICAgICAgICAgRmFp\nbHVyZSBFeGNlcHRpb24KICAgICAqIEBwYXJhbSBjdHgKICAgICAqICAgICAg\nICAgIENhbGxiYWNrIGNvbnRleHQKICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgcmVsZWFzZVRvcGljSWZSZXF1ZXN0ZWQoZmluYWwgQnl0ZVN0cmluZyB0\nb3BpYywgRXhjZXB0aW9uIGUsIE9iamVjdCBjdHgpIHsKICAgICAgICBUb3Bp\nY0luZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwogICAg\nICAgIGlmICh0b3BpY0luZm8gPT0gbnVsbCkgewogICAgICAgICAgICBsb2dn\nZXIud2FybigiTm8gdG9waWMgZm91bmQgd2hlbiB0cnlpbmcgdG8gcmVsZWFz\nZSBvd25lcnNoaXAgb2YgdG9waWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgp\nCiAgICAgICAgICAgICAgICAgICAgICArICIgb24gZmFpbHVyZS4iKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBkbyByZWxl\nYXNlIG93bmVyIHNoaXAgb2YgdG9waWMKICAgICAgICBpZiAodG9waWNJbmZv\nLmRvUmVsZWFzZS5jb21wYXJlQW5kU2V0KGZhbHNlLCB0cnVlKSkgewogICAg\nICAgICAgICBsb2dnZXIuaW5mbygiUmVsZWFzZSB0b3BpYyAiICsgdG9waWMu\ndG9TdHJpbmdVdGY4KCkgKyAiIHdoZW4gYm9va2tlZXBlciBwZXJzaXN0ZW5j\nZSBtYW5hbmdlciBlbmNvdW50ZXJzIGZhaWx1cmUgOiIsCiAgICAgICAgICAg\nICAgICAgICAgICAgIGUpOwogICAgICAgICAgICB0bS5yZWxlYXNlVG9waWMo\ndG9waWMsIG5ldyBDYWxsYmFjazxWb2lkPigpIHsKICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0\naW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRp\nb24pIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkV4Y2Vw\ndGlvbiBmb3VuZCBvbiByZWxlYXNpbmcgdG9waWMgIiArIHRvcGljLnRvU3Ry\naW5nVXRmOCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIg\nd2hlbiBlbmNvdW50ZXJpbmcgZXhjZXB0aW9uIGZyb20gYm9va2tlZXBlcjoi\nLCBleGNlcHRpb24pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdE9mT3BlcmF0\naW9uKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oInN1Y2Nl\nc3NmdWxseSByZWxlYXNpbmcgdG9waWMge30gd2hlbiBlbmNvdW50ZXJpbmci\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBleGNlcHRpb24g\nZnJvbSBib29ra2VlcGVyIiwgdG9waWMudG9TdHJpbmdVdGY4KCkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICB9\nCiAgICAgICAgLy8gaWYgcmVsZWFzZSBoYXBwZW5zIHdoZW4gdGhlIHRvcGlj\nIGlzIGNoYW5naW5nIGxlZGdlcgogICAgICAgIC8vIHdlIG5lZWQgdG8gZmFp\nbCBhbGwgcXVldWVkIHBlcnNpc3QgcmVxdWVzdHMKICAgICAgICBpZiAodG9w\naWNJbmZvLmRvQ2hhbmdlTGVkZ2VyLmdldCgpKSB7CiAgICAgICAgICAgIGZv\nciAoUGVyc2lzdFJlcXVlc3QgcHIgOiB0b3BpY0luZm8uZGVmZXJyZWRSZXF1\nZXN0cykgewogICAgICAgICAgICAgICAgcHIuZ2V0Q2FsbGJhY2soKS5vcGVy\nYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VE\nb3duRXhjZXB0aW9uKGUpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0\nb3BpY0luZm8uZGVmZXJyZWRSZXF1ZXN0cy5jbGVhcigpOwogICAgICAgICAg\nICB0b3BpY0luZm8ubGFzdFNlcUlkQmVmb3JlTGVkZ2VyQ2hhbmdlID0gLTE7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBjbGFzcyBQZXJzaXN0T3Ag\nZXh0ZW5kcyBUb3BpY09wUXVldWVyLlN5bmNocm9ub3VzT3AgewogICAgICAg\nIFBlcnNpc3RSZXF1ZXN0IHJlcXVlc3Q7CgogICAgICAgIHB1YmxpYyBQZXJz\naXN0T3AoUGVyc2lzdFJlcXVlc3QgcmVxdWVzdCkgewogICAgICAgICAgICBx\ndWV1ZXIuc3VwZXIocmVxdWVzdC50b3BpYyk7CiAgICAgICAgICAgIHRoaXMu\ncmVxdWVzdCA9IHJlcXVlc3Q7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW5JbnRlcm5hbCgpIHsKICAgICAg\nICAgICAgZG9QZXJzaXN0TWVzc2FnZShyZXF1ZXN0KTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBQZXJzaXN0IGEgbWVzc2FnZSBieSBleGVj\ndXRpbmcgYSBwZXJzaXN0IHJlcXVlc3QuCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGRvUGVyc2lzdE1lc3NhZ2UoZmluYWwgUGVyc2lzdFJlcXVlc3Qg\ncmVxdWVzdCkgewogICAgICAgIGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMgPSBy\nZXF1ZXN0LnRvcGljOwogICAgICAgIGZpbmFsIFRvcGljSW5mbyB0b3BpY0lu\nZm8gPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAgIGlmICh0b3Bp\nY0luZm8gPT0gbnVsbCkgewogICAgICAgICAgICByZXF1ZXN0LmdldENhbGxi\nYWNrKCkub3BlcmF0aW9uRmFpbGVkKHJlcXVlc3QuY3R4LAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHViU3Vi\nRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9waWNFeGNlcHRp\nb24oIiIpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgaWYgKHRvcGljSW5mby5kb1JlbGVhc2UuZ2V0KCkpIHsKICAgICAgICAg\nICAgcmVxdWVzdC5nZXRDYWxsYmFjaygpLm9wZXJhdGlvbkZhaWxlZChyZXF1\nZXN0LmN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICJUaGUgb3duZXJzaGlwIG9mIHRoZSB0\nb3BpYyBpcyByZWxlYXNpbmcgZHVlIHRvIHVucmVjb3ZlcmFibGUgaXNzdWUu\nIikpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAv\nLyBpZiB0aGUgdG9waWMgaXMgY2hhbmdpbmcgbGVkZ2VyLCBxdWV1ZSBmb2xs\nb3dpbmcgcGVyc2lzdCByZXF1ZXN0cyB1bnRpbCBsZWRnZXIgaXMgY2hhbmdl\nZAogICAgICAgIGlmICh0b3BpY0luZm8uZG9DaGFuZ2VMZWRnZXIuZ2V0KCkp\nIHsKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlRvcGljIHt9IGlzIGNoYW5n\naW5nIGxlZGdlciwgc28gcXVldWUgcGVyc2lzdCByZXF1ZXN0IGZvciBtZXNz\nYWdlLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHRvcGljLnRvU3RyaW5n\nVXRmOCgpKTsKICAgICAgICAgICAgdG9waWNJbmZvLmRlZmVycmVkUmVxdWVz\ndHMuYWRkKHJlcXVlc3QpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICBmaW5hbCBsb25nIGxvY2FsU2VxSWQgPSB0b3BpY0luZm8u\nbGFzdFNlcUlkUHVzaGVkLmdldExvY2FsQ29tcG9uZW50KCkgKyAxOwogICAg\nICAgIE1lc3NhZ2VTZXFJZC5CdWlsZGVyIGJ1aWxkZXIgPSBNZXNzYWdlU2Vx\nSWQubmV3QnVpbGRlcigpOwogICAgICAgIGlmIChyZXF1ZXN0Lm1lc3NhZ2Uu\naGFzTXNnSWQoKSkgewogICAgICAgICAgICBNZXNzYWdlSWRVdGlscy50YWtl\nUmVnaW9uTWF4aW11bShidWlsZGVyLCB0b3BpY0luZm8ubGFzdFNlcUlkUHVz\naGVkLCByZXF1ZXN0Lm1lc3NhZ2UuZ2V0TXNnSWQoKSk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgYnVpbGRlci5hZGRBbGxSZW1vdGVDb21wb25l\nbnRzKHRvcGljSW5mby5sYXN0U2VxSWRQdXNoZWQuZ2V0UmVtb3RlQ29tcG9u\nZW50c0xpc3QoKSk7CiAgICAgICAgfQogICAgICAgIGJ1aWxkZXIuc2V0TG9j\nYWxDb21wb25lbnQobG9jYWxTZXFJZCk7CgogICAgICAgIC8vIGNoZWNrIHdo\nZXRoZXIgcmVhY2ggdGhlIHRocmVzaG9sZCBvZiBhIGxlZGdlciwgaWYgaXQg\nZG9lcywKICAgICAgICAvLyBvcGVuIGEgbGVkZ2VyIHRvIHdyaXRlCiAgICAg\nICAgbG9uZyBlbnRyaWVzSW5UaGlzTGVkZ2VyID0gbG9jYWxTZXFJZCAtIHRv\ncGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuZ2V0U3RhcnRTZXFJZEluY2x1\nZGVkKCkgKyAxOwogICAgICAgIGlmIChVTkxJTUlURURfRU5UUklFUyAhPSBt\nYXhFbnRyaWVzUGVyTGVkZ2VyICYmCiAgICAgICAgICAgIGVudHJpZXNJblRo\naXNMZWRnZXIgPj0gbWF4RW50cmllc1BlckxlZGdlcikgewogICAgICAgICAg\nICBpZiAodG9waWNJbmZvLmRvQ2hhbmdlTGVkZ2VyLmNvbXBhcmVBbmRTZXQo\nZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgICAgICAvLyBmb3Igb3JkZXIg\nZ3VhcmFudGVlcywgd2Ugc2hvdWxkIHdhaXQgdW50aWwgYWxsIHRoZSBhZGRp\nbmcgb3BlcmF0aW9ucyBmb3IgY3VycmVudCBsZWRnZXIKICAgICAgICAgICAg\nICAgIC8vIGFyZSBzdWNjZWVkLiBzbyB3ZSBqdXN0IG1hcmsgaXQgYXMgbGFz\ndFNlcUlkQmVmb3JlTGVkZ2VyQ2hhbmdlCiAgICAgICAgICAgICAgICAvLyB3\naGVuIHRoZSBsYXN0U2VxSWRCZWZvcmVMZWRnZXJDaGFuZ2UgYWNrZWQsIHdl\nIGRvIGNoYW5naW5nIHRoZSBsZWRnZXIKICAgICAgICAgICAgICAgIGlmIChu\ndWxsID09IHRvcGljSW5mby5kZWZlcnJlZFJlcXVlc3RzKSB7CiAgICAgICAg\nICAgICAgICAgICAgdG9waWNJbmZvLmRlZmVycmVkUmVxdWVzdHMgPSBuZXcg\nTGlua2VkTGlzdDxQZXJzaXN0UmVxdWVzdD4oKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHRvcGljSW5mby5sYXN0U2VxSWRCZWZvcmVM\nZWRnZXJDaGFuZ2UgPSBsb2NhbFNlcUlkOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICB0b3BpY0luZm8ubGFzdFNlcUlkUHVzaGVkID0gYnVp\nbGRlci5idWlsZCgpOwogICAgICAgIE1lc3NhZ2UgbXNnVG9TZXJpYWxpemUg\nPSBNZXNzYWdlLm5ld0J1aWxkZXIocmVxdWVzdC5tZXNzYWdlKS5zZXRNc2dJ\nZCh0b3BpY0luZm8ubGFzdFNlcUlkUHVzaGVkKS5idWlsZCgpOwoKICAgICAg\nICBmaW5hbCBNZXNzYWdlU2VxSWQgcmVzcG9uc2VTZXFJZCA9IG1zZ1RvU2Vy\naWFsaXplLmdldE1zZ0lkKCk7CiAgICAgICAgdG9waWNJbmZvLmN1cnJlbnRM\nZWRnZXJSYW5nZS5oYW5kbGUuYXN5bmNBZGRFbnRyeShtc2dUb1NlcmlhbGl6\nZS50b0J5dGVBcnJheSgpLAogICAgICAgIG5ldyBTYWZlQXN5bkJLQ2FsbGJh\nY2suQWRkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEF0b21pY0Jvb2xlYW4g\ncHJvY2Vzc2VkID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZUFk\nZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVudHJ5\nSWQsIE9iamVjdCBjdHgpIHsKCiAgICAgICAgICAgICAgICAvLyBhdm9pZCBk\nb3VibGUgY2FsbGJhY2sgYnkgbWlzdGFrZSwgc2luY2Ugd2UgbWF5IGRvIGNo\nYW5nZSBsZWRnZXIgaW4gdGhpcyBjYWxsYmFjay4KICAgICAgICAgICAgICAg\nIGlmICghcHJvY2Vzc2VkLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUu\nT0spIHsKICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbiBia2UgPSBC\nS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwogICAgICAgICAgICAgICAgICAgIGxv\nZ2dlci5lcnJvcigiRXJyb3Igd2hpbGUgcGVyc2lzdGluZyBlbnRyeSB0byBs\nZWRnZXI6ICIgKyBsaC5nZXRJZCgpICsgIiBmb3IgdG9waWM6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmluZ1V0\nZjgoKSwgYmtlKTsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmdldENh\nbGxiYWNrKCkub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2Vw\ndGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihia2UpKTsKCiAgICAgICAgICAg\nICAgICAgICAgLy8gVG8gcHJlc2VydmUgb3JkZXJpbmcgZ3VhcmFudGVlcywg\nd2UKICAgICAgICAgICAgICAgICAgICAvLyBzaG91bGQgZ2l2ZSB1cCB0aGUg\ndG9waWMgYW5kIG5vdCBsZXQKICAgICAgICAgICAgICAgICAgICAvLyBvdGhl\nciBvcGVyYXRpb25zIHRocm91Z2gKICAgICAgICAgICAgICAgICAgICByZWxl\nYXNlVG9waWNJZlJlcXVlc3RlZChyZXF1ZXN0LnRvcGljLCBia2UsIGN0eCk7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIGlmIChlbnRyeUlkICsgdG9waWNJbmZvLmN1\ncnJlbnRMZWRnZXJSYW5nZS5nZXRTdGFydFNlcUlkSW5jbHVkZWQoKSAhPSBs\nb2NhbFNlcUlkKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIG1zZyA9\nICJFeHBlY3RlZCBCSyB0byBhc3NpZ24gZW50cnktaWQ6ICIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyAobG9jYWxTZXFJZCAtIHRvcGlj\nSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuZ2V0U3RhcnRTZXFJZEluY2x1ZGVk\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBidXQg\naXQgaW5zdGVhZCBhc3NpZ25lZCBlbnRyeS1pZDogIiArIGVudHJ5SWQgKyAi\nIHRvcGljOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\ndG9waWMudG9TdHJpbmdVdGY4KCkgKyAibGVkZ2VyOiAiICsgbGguZ2V0SWQo\nKTsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IobXNnKTsKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVW5leHBlY3RlZEVycm9yKG1z\nZyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdG9waWNJ\nbmZvLmxhc3RFbnRyeUlkQWNrZWRJbkN1cnJlbnRMZWRnZXIgPSBlbnRyeUlk\nOwogICAgICAgICAgICAgICAgcmVxdWVzdC5nZXRDYWxsYmFjaygpLm9wZXJh\ndGlvbkZpbmlzaGVkKGN0eCwgcmVzcG9uc2VTZXFJZCk7CiAgICAgICAgICAg\nICAgICAvLyBpZiB0aGlzIGFja2VkIGVudHJ5IGlzIHRoZSBsYXN0IGVudHJ5\nIG9mIGN1cnJlbnQgbGVkZ2VyCiAgICAgICAgICAgICAgICAvLyB3ZSBjYW4g\nYWRkIGEgQ2hhbmdlTGVkZ2VyT3AgdG8gZXhlY3V0ZSB0byBjaGFuZ2UgbGVk\nZ2VyCiAgICAgICAgICAgICAgICBpZiAodG9waWNJbmZvLmRvQ2hhbmdlTGVk\nZ2VyLmdldCgpICYmCiAgICAgICAgICAgICAgICAgICAgZW50cnlJZCArIHRv\ncGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuZ2V0U3RhcnRTZXFJZEluY2x1\nZGVkKCkgPT0gdG9waWNJbmZvLmxhc3RTZXFJZEJlZm9yZUxlZGdlckNoYW5n\nZSkgewogICAgICAgICAgICAgICAgICAgIC8vIGNoYW5nZSBsZWRnZXIKICAg\nICAgICAgICAgICAgICAgICBjaGFuZ2VMZWRnZXIodG9waWMsIG5ldyBDYWxs\nYmFjazxWb2lkPigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0\naW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJy\nb3IoIkZhaWxlZCB0byBjaGFuZ2UgbGVkZ2VyIGZvciB0b3BpYyAiICsgdG9w\naWMudG9TdHJpbmdVdGY4KCksIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAvLyBjaGFuZ2UgbGVkZ2VyIGZhaWxlZCwgd2Ugc2hv\ndWxkIGdpdmUgdXAgdG9waWMKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJlbGVhc2VUb3BpY0lmUmVxdWVzdGVkKHJlcXVlc3QudG9waWMsIGV4Y2Vw\ndGlvbiwgY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0\neCwgVm9pZCByZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdG9waWNJbmZvLmRvQ2hhbmdlTGVkZ2VyLnNldChmYWxz\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BpY0luZm8ubGFz\ndFNlcUlkQmVmb3JlTGVkZ2VyQ2hhbmdlID0gLTE7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAvLyB0aGUgbGVkZ2VyIGlzIGNoYW5nZWQsIHBlcnNp\nc3QgcXVldWVkIHJlcXVlc3RzCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyBpZiB0aGUgbnVtYmVyIG9mIHF1ZXVlZCBwZXJzaXN0IHJlcXVlc3Rz\nIGlzIG1vcmUgdGhhbiBtYXhFbnRyaWVzUGVyTGVkZ2VyCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyB3ZSBqdXN0IHBlcnNpc3QgbWF4RW50cmll\nc1BlckxlZGdlciByZXF1ZXN0cywgb3RoZXIgcmVxdWVzdHMgYXJlIHN0aWxs\nIHF1ZXVlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdW50aWwg\nbmV4dCBsZWRnZXIgY2hhbmdlZC4KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGludCBudW1SZXF1ZXN0cyA9IDA7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB3aGlsZSAoIXRvcGljSW5mby5kZWZlcnJlZFJlcXVlc3RzLmlz\nRW1wdHkoKSAmJgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG51bVJlcXVlc3RzIDwgbWF4RW50cmllc1BlckxlZGdlcikgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIFBlcnNpc3RSZXF1ZXN0IHByID0g\ndG9waWNJbmZvLmRlZmVycmVkUmVxdWVzdHMucmVtb3ZlRmlyc3QoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb1BlcnNpc3RNZXNzYWdl\nKHByKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArK251bVJl\ncXVlc3RzOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJGaW5pc2hlZCBw\nZXJzaXN0aW5nIHt9IHF1ZXVlZCByZXF1ZXN0cywgYnV0IHRoZXJlIGFyZSBz\ndGlsbCB7fSByZXF1ZXN0cyBpbiBxdWV1ZS4iLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG51bVJlcXVlc3RzLCB0b3BpY0lu\nZm8uZGVmZXJyZWRSZXF1ZXN0cy5zaXplKCkpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgY3R4KTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sIHJlcXVlc3Qu\nY3R4KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwZXJzaXN0TWVzc2FnZShQ\nZXJzaXN0UmVxdWVzdCByZXF1ZXN0KSB7CiAgICAgICAgcXVldWVyLnB1c2hB\nbmRNYXliZVJ1bihyZXF1ZXN0LnRvcGljLCBuZXcgUGVyc2lzdE9wKHJlcXVl\nc3QpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzY2FuU2luZ2xlTWVzc2Fn\nZShTY2FuUmVxdWVzdCByZXF1ZXN0KSB7CiAgICAgICAgdGhyb3cgbmV3IFJ1\nbnRpbWVFeGNlcHRpb24oIk5vdCBpbXBsZW1lbnRlZCIpOwogICAgfQoKICAg\nIHN0YXRpYyBTYWZlQXN5bkJLQ2FsbGJhY2suQ2xvc2VDYWxsYmFjayBub09w\nQ2xvc2VDYWxsYmFjayA9IG5ldyBTYWZlQXN5bkJLQ2FsbGJhY2suQ2xvc2VD\nYWxsYmFjaygpIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMg\ndm9pZCBzYWZlQ2xvc2VDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBs\nZWRnZXJIYW5kbGUsIE9iamVjdCBjdHgpIHsKICAgICAgICB9OwogICAgfTsK\nCiAgICBjbGFzcyBBY3F1aXJlT3AgZXh0ZW5kcyBUb3BpY09wUXVldWVyLkFz\neW5jaHJvbm91c09wPFZvaWQ+IHsKICAgICAgICBwdWJsaWMgQWNxdWlyZU9w\nKEJ5dGVTdHJpbmcgdG9waWMsIENhbGxiYWNrPFZvaWQ+IGNiLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0b3BpYywgY2IsIGN0\neCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIGlmICh0b3BpY0luZm9zLmNv\nbnRhaW5zS2V5KHRvcGljKSkgewogICAgICAgICAgICAgICAgLy8gQWxyZWFk\neSBhY3F1aXJlZCwgZG8gbm90aGluZwogICAgICAgICAgICAgICAgY2Iub3Bl\ncmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcmVhZCBwZXJz\naXN0ZW5jZSBpbmZvCiAgICAgICAgICAgIHRwTWFuYWdlci5yZWFkVG9waWNQ\nZXJzaXN0ZW5jZUluZm8odG9waWMsIG5ldyBDYWxsYmFjazxWZXJzaW9uZWQ8\nTGVkZ2VyUmFuZ2VzPj4oKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVk\nKE9iamVjdCBjdHgsIFZlcnNpb25lZDxMZWRnZXJSYW5nZXM+IHJhbmdlcykg\newogICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IHJhbmdlcykgewog\nICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9waWNMZWRnZXJSYW5n\nZXMocmFuZ2VzLmdldFZhbHVlKCksIHJhbmdlcy5nZXRWZXJzaW9uKCkpOwog\nICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHByb2Nlc3NUb3BpY0xlZGdlclJhbmdlcyhMZWRnZXJSYW5nZXMu\nZ2V0RGVmYXVsdEluc3RhbmNlKCksIFZlcnNpb24uTkVXKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0\naW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVk\nKGN0eCwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSwgY3R4KTsKICAgICAgICB9CgogICAgICAgIHZvaWQgcHJvY2Vzc1Rv\ncGljTGVkZ2VyUmFuZ2VzKGZpbmFsIExlZGdlclJhbmdlcyByYW5nZXMsIGZp\nbmFsIFZlcnNpb24gdmVyc2lvbikgewogICAgICAgICAgICBmaW5hbCBMaXN0\nPExlZGdlclJhbmdlPiByYW5nZXNMaXN0ID0gcmFuZ2VzLmdldFJhbmdlc0xp\nc3QoKTsKICAgICAgICAgICAgaWYgKCFyYW5nZXNMaXN0LmlzRW1wdHkoKSkg\newogICAgICAgICAgICAgICAgTGVkZ2VyUmFuZ2UgcmFuZ2UgPSByYW5nZXNM\naXN0LmdldCgwKTsKICAgICAgICAgICAgICAgIGlmIChyYW5nZS5oYXNTdGFy\ndFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIHdl\nIGFscmVhZHkgaGF2ZSBzdGFydCBzZXEgaWQKICAgICAgICAgICAgICAgICAg\nICBwcm9jZXNzVG9waWNMZWRnZXJSYW5nZXMocmFuZ2VzTGlzdCwgdmVyc2lv\nbiwgcmFuZ2UuZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCkpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGdldFN0YXJ0U2VxSWRUb1Byb2Nlc3NUb3BpY0xlZGdlclJhbmdl\ncyhyYW5nZXNMaXN0LCB2ZXJzaW9uKTsKICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBwcm9jZXNzIHRvcGlj\nIGxlZGdlciByYW5nZXMgZGlyZWN0bHkKICAgICAgICAgICAgcHJvY2Vzc1Rv\ncGljTGVkZ2VyUmFuZ2VzKHJhbmdlc0xpc3QsIHZlcnNpb24sIFNUQVJUX1NF\nUV9JRCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBQcm9j\nZXNzIG9sZCB2ZXJzaW9uIGxlZGdlciByYW5nZXMgdG8gZmV0Y2ggc3RhcnQg\nc2VxIGlkLgogICAgICAgICAqLwogICAgICAgIHZvaWQgZ2V0U3RhcnRTZXFJ\nZFRvUHJvY2Vzc1RvcGljTGVkZ2VyUmFuZ2VzKAogICAgICAgICAgICBmaW5h\nbCBMaXN0PExlZGdlclJhbmdlPiByYW5nZXNMaXN0LCBmaW5hbCBWZXJzaW9u\nIHZlcnNpb24pIHsKCiAgICAgICAgICAgIGZpbmFsIExlZGdlclJhbmdlIHJh\nbmdlID0gcmFuZ2VzTGlzdC5nZXQoMCk7CgogICAgICAgICAgICBpZiAoIXJh\nbmdlLmhhc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAgICAgICAgICAg\nLy8gcHJvY2VzcyB0b3BpYyBsZWRnZXIgcmFuZ2VzIGRpcmVjdGx5CiAgICAg\nICAgICAgICAgICBwcm9jZXNzVG9waWNMZWRnZXJSYW5nZXMocmFuZ2VzTGlz\ndCwgdmVyc2lvbiwgU1RBUlRfU0VRX0lEKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZmluYWwgbG9uZyBs\nZWRnZXJJZCA9IHJhbmdlLmdldExlZGdlcklkKCk7CiAgICAgICAgICAgIC8v\nIG9wZW4gdGhlIGZpcnN0IGxlZGdlciB0byBjb21wdXRlIHJpZ2h0IHN0YXJ0\nIHNlcSBpZAogICAgICAgICAgICBiay5hc3luY09wZW5MZWRnZXIobGVkZ2Vy\nSWQsIERpZ2VzdFR5cGUuQ1JDMzIsIHBhc3N3ZCwKICAgICAgICAgICAgbmV3\nIFNhZmVBc3luQktDYWxsYmFjay5PcGVuQ2FsbGJhY2soKSB7CgogICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzYWZlT3BlbkNvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxlZGdl\nckhhbmRsZSwgT2JqZWN0IGN0eCkgewoKICAgICAgICAgICAgICAgICAgICBp\nZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hMZWRnZXJFeGlzdHNF\neGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJvY2Vz\ncyBuZXh0IGxlZGdlciAKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vz\nc1RvcGljTGVkZ2VyUmFuZ2VzKHJhbmdlc0xpc3QsIHZlcnNpb24sIFNUQVJU\nX1NFUV9JRCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJjICE9IEJLRXhjZXB0aW9u\nLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgQktFeGNlcHRp\nb24gYmtlID0gQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDb3VsZCBub3Qgb3BlbiBsZWRn\nZXIge30gdG8gZ2V0IHN0YXJ0IHNlcSBpZCB3aGlsZSBhY3F1aXJpbmcgdG9w\naWMge30gOiB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB2YShsZWRnZXJJZCwgdG9waWMudG9TdHJpbmdVdGY4KCksIGJrZSkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQo\nY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9u\nKGJrZSkpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmaW5hbCBs\nb25nIG51bUVudHJpZXNJbkxhc3RMZWRnZXIgPSBsZWRnZXJIYW5kbGUuZ2V0\nTGFzdEFkZENvbmZpcm1lZCgpICsgMTsKCiAgICAgICAgICAgICAgICAgICAg\nLy8gdGhlIGxlZGdlciBpcyBjbG9zZWQgYmVmb3JlLCBjYWxsaW5nIGNsb3Nl\nIGlzIGp1c3QgYSBub3Agb3BlcmF0aW9uLgogICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckhhbmRsZS5j\nbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVw\ndGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIHRoZSBleGNlcHRpb24gd291bGQgbmV2ZXIgYmUgdGhyb3duIGZvciBhIHJl\nYWQgb25seSBsZWRnZXIgaGFuZGxlLgogICAgICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEJLRXhjZXB0aW9uIGJrZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAvLyB0aGUgZXhjZXB0aW9uIHdvdWxkIG5ldmVyIGJlIHRocm93biBm\nb3IgYSByZWFkIG9ubHkgbGVkZ2VyIGhhbmRsZS4KICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChudW1FbnRyaWVzSW5M\nYXN0TGVkZ2VyIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgU3Ry\naW5nIG1zZyA9ICJObyBlbnRyaWVzIGZvdW5kIGluIGEgaGF2ZS1lbmQtc2Vx\nLWlkIGxlZGdlciAiICsgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiB3aGVuIGFjcXVpcmluZyB0b3BpYyAiICsg\ndG9waWMudG9TdHJpbmdVdGY4KCkgKyAiLiI7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGxvZ2dlci5lcnJvcihtc2cpOwogICAgICAgICAgICAgICAgICAg\nICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0\naW9uLlVuZXhwZWN0ZWRDb25kaXRpb25FeGNlcHRpb24obXNnKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgbG9uZyBlbmRPZkxlZGdlciA9IHJh\nbmdlLmdldEVuZFNlcUlkSW5jbHVkZWQoKS5nZXRMb2NhbENvbXBvbmVudCgp\nOwogICAgICAgICAgICAgICAgICAgIGxvbmcgc3RhcnRPZkxlZGdlciA9IGVu\nZE9mTGVkZ2VyIC0gbnVtRW50cmllc0luTGFzdExlZGdlciArIDE7CgogICAg\nICAgICAgICAgICAgICAgIHByb2Nlc3NUb3BpY0xlZGdlclJhbmdlcyhyYW5n\nZXNMaXN0LCB2ZXJzaW9uLCBzdGFydE9mTGVkZ2VyKTsKICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgfQoKICAgICAg\nICB2b2lkIHByb2Nlc3NUb3BpY0xlZGdlclJhbmdlcyhmaW5hbCBMaXN0PExl\nZGdlclJhbmdlPiByYW5nZXNMaXN0LCBmaW5hbCBWZXJzaW9uIHZlcnNpb24s\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9uZyBz\ndGFydE9mTGVkZ2VyKSB7CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJQcm9j\nZXNzIHt9IGxlZGdlcnMgZm9yIHRvcGljIHt9IHN0YXJ0aW5nIGZyb20gc2Vx\nIGlkIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHZhKHJhbmdlc0xp\nc3Quc2l6ZSgpLCB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgc3RhcnRPZkxlZGdl\ncikpOwoKICAgICAgICAgICAgSXRlcmF0b3I8TGVkZ2VyUmFuZ2U+IGxySXRl\ncmF0b3IgPSByYW5nZXNMaXN0Lml0ZXJhdG9yKCk7CgogICAgICAgICAgICBU\nb3BpY0luZm8gdG9waWNJbmZvID0gbmV3IFRvcGljSW5mbygpOwogICAgICAg\nICAgICB3aGlsZSAobHJJdGVyYXRvci5oYXNOZXh0KCkpIHsKICAgICAgICAg\nICAgICAgIExlZGdlclJhbmdlIHJhbmdlID0gbHJJdGVyYXRvci5uZXh0KCk7\nCgogICAgICAgICAgICAgICAgaWYgKHJhbmdlLmhhc0VuZFNlcUlkSW5jbHVk\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgbWVhbnMgaXQg\nd2FzIGEgdmFsaWQgYW5kIGNvbXBsZXRlbHkgY2xvc2VkIGxlZGdlcgogICAg\nICAgICAgICAgICAgICAgIGxvbmcgZW5kT2ZMZWRnZXIgPSByYW5nZS5nZXRF\nbmRTZXFJZEluY2x1ZGVkKCkuZ2V0TG9jYWxDb21wb25lbnQoKTsKICAgICAg\nICAgICAgICAgICAgICBpZiAocmFuZ2UuaGFzU3RhcnRTZXFJZEluY2x1ZGVk\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRPZkxlZGdlciA9\nIHJhbmdlLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpOwogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdl\nID0gYnVpbGRMZWRnZXJSYW5nZShyYW5nZS5nZXRMZWRnZXJJZCgpLCBzdGFy\ndE9mTGVkZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmFuZ2UuZ2V0RW5kU2VxSWRJbmNsdWRlZCgpKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgdG9w\naWNJbmZvLmxlZGdlclJhbmdlcy5wdXQoZW5kT2ZMZWRnZXIsIG5ldyBJbk1l\nbW9yeUxlZGdlclJhbmdlKHJhbmdlKSk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHN0YXJ0T2ZMZWRnZXIgPCBlbmRPZkxlZGdlciArIDEpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgc3RhcnRPZkxlZGdlciA9IGVuZE9mTGVkZ2Vy\nICsgMTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgLy8gSWYgaXQgZG9lc24ndCBoYXZlIGEgdmFsaWQgZW5kLCBpdCBtdXN0\nIGJlIHRoZSBsYXN0IGxlZGdlcgogICAgICAgICAgICAgICAgaWYgKGxySXRl\ncmF0b3IuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5n\nIG1zZyA9ICJMZWRnZXItaWQ6ICIgKyByYW5nZS5nZXRMZWRnZXJJZCgpICsg\nIiBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArICIgaXMgbm90IHRoZSBsYXN0\nIG9uZSBidXQgc3RpbGwgZG9lcyBub3QgaGF2ZSBhbiBlbmQgc2VxLWlkIjsK\nICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IobXNnKTsKICAgICAg\nICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlVuZXhwZWN0ZWRDb25kaXRpb25FeGNlcHRpb24obXNn\nKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIGlmIChyYW5nZS5oYXNTdGFydFNlcUlk\nSW5jbHVkZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHN0YXJ0T2ZMZWRn\nZXIgPSByYW5nZS5nZXRTdGFydFNlcUlkSW5jbHVkZWQoKTsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUaGUgbGFzdCBsZWRnZXIg\nZG9lcyBub3QgaGF2ZSBhIHZhbGlkIHNlcS1pZCwgbGV0cyB0cnkgdG8KICAg\nICAgICAgICAgICAgIC8vIGZpbmQgaXQgb3V0CiAgICAgICAgICAgICAgICBy\nZWNvdmVyTGFzdFRvcGljTGVkZ2VyQW5kT3Blbk5ld09uZShyYW5nZS5nZXRM\nZWRnZXJJZCgpLCBzdGFydE9mTGVkZ2VyLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiwgdG9w\naWNJbmZvKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gQWxsIGxlZGdlcnMgd2VyZSBmb3VuZCBwcm9w\nZXJseSBjbG9zZWQsIGp1c3Qgc3RhcnQgYSBuZXcgb25lCiAgICAgICAgICAg\nIG9wZW5OZXdUb3BpY0xlZGdlcih0b3BpYywgdmVyc2lvbiwgdG9waWNJbmZv\nLCBzdGFydE9mTGVkZ2VyLCBmYWxzZSwgY2IsIGN0eCk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBSZWNvdmVycyB0aGUgbGFzdCBsZWRn\nZXIsIG9wZW5zIGEgbmV3IG9uZSwgYW5kIHBlcnNpc3RzIHRoZSBuZXcKICAg\nICAgICAgKiBpbmZvcm1hdGlvbiB0byBaSwogICAgICAgICAqCiAgICAgICAg\nICogQHBhcmFtIGxlZGdlcklkCiAgICAgICAgICogICAgICAgICAgICBMZWRn\nZXIgdG8gYmUgcmVjb3ZlcmVkCiAgICAgICAgICogQHBhcmFtIGV4cGVjdGVk\nU3RhcnRTZXFJZCAKICAgICAgICAgKiAgICAgICAgICAgIFN0YXJ0IHNlcSBp\nZCBvZiB0aGUgbGVkZ2VyIHRvIHJlY292ZXIKICAgICAgICAgKiBAcGFyYW0g\nZXhwZWN0ZWRWZXJzaW9uT2ZMZWRnZXJOb2RlCiAgICAgICAgICogICAgICAg\nICAgICBFeHBlY3RlZCB2ZXJzaW9uIHRvIHVwZGF0ZSBsZWRnZXJzIHJhbmdl\nCiAgICAgICAgICogQHBhcmFtIHRvcGljSW5mbwogICAgICAgICAqICAgICAg\nICAgICAgVG9waWMgaW5mbwogICAgICAgICAqLwogICAgICAgIHByaXZhdGUg\ndm9pZCByZWNvdmVyTGFzdFRvcGljTGVkZ2VyQW5kT3Blbk5ld09uZShmaW5h\nbCBsb25nIGxlZGdlcklkLCBmaW5hbCBsb25nIGV4cGVjdGVkU3RhcnRTZXFJ\nZCwKICAgICAgICAgICAgICAgIGZpbmFsIFZlcnNpb24gZXhwZWN0ZWRWZXJz\naW9uT2ZMZWRnZXJOb2RlLCBmaW5hbCBUb3BpY0luZm8gdG9waWNJbmZvKSB7\nCgogICAgICAgICAgICBiay5hc3luY09wZW5MZWRnZXIobGVkZ2VySWQsIERp\nZ2VzdFR5cGUuQ1JDMzIsIHBhc3N3ZCwgbmV3IFNhZmVBc3luQktDYWxsYmFj\nay5PcGVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVPcGVuQ29tcGxldGUo\naW50IHJjLCBMZWRnZXJIYW5kbGUgbGVkZ2VySGFuZGxlLCBPYmplY3QgY3R4\nKSB7CgogICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlv\nbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJLRXhjZXB0\naW9uIGJrZSA9IEJLRXhjZXB0aW9uLmNyZWF0ZShyYyk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiV2hpbGUgYWNxdWlyaW5nIHRv\ncGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgIiwgY291bGQgbm90IG9wZW4gdW5y\nZWNvdmVyZWQgbGVkZ2VyOiAiICsgbGVkZ2VySWQsIGJrZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQ\ndWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIGZpbmFsIGxvbmcgbnVtRW50\ncmllc0luTGFzdExlZGdlciA9IGxlZGdlckhhbmRsZS5nZXRMYXN0QWRkQ29u\nZmlybWVkKCkgKyAxOwoKICAgICAgICAgICAgICAgICAgICBpZiAobnVtRW50\ncmllc0luTGFzdExlZGdlciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHRoaXMgd2FzIGFuIGVtcHR5IGxlZGdlciB0aGF0IHNvbWVvbmUg\nY3JlYXRlZCBidXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY291bGRu\nJ3Qgd3JpdGUgdG8sIHNvIGp1c3QgaWdub3JlIGl0CiAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5pbmZvKCJQcnVuaW5nIGVtcHR5IGxlZGdlcjog\nIiArIGxlZGdlcklkICsgIiBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlTGVkZ2Vy\nKGxlZGdlckhhbmRsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5O\nZXdUb3BpY0xlZGdlcih0b3BpYywgZXhwZWN0ZWRWZXJzaW9uT2ZMZWRnZXJO\nb2RlLCB0b3BpY0luZm8sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBleHBlY3RlZFN0YXJ0U2VxSWQsIGZhbHNlLCBjYiwg\nY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gd2UgaGF2\nZSB0byByZWFkIHRoZSBsYXN0IGVudHJ5IG9mIHRoZSBsZWRnZXIgdG8gZmlu\nZAogICAgICAgICAgICAgICAgICAgIC8vIG91dCB0aGUgbGFzdCBzZXEtaWQK\nCiAgICAgICAgICAgICAgICAgICAgbGVkZ2VySGFuZGxlLmFzeW5jUmVhZEVu\ndHJpZXMobnVtRW50cmllc0luTGFzdExlZGdlciAtIDEsIG51bUVudHJpZXNJ\nbkxhc3RMZWRnZXIgLSAxLAogICAgICAgICAgICAgICAgICAgIG5ldyBTYWZl\nQXN5bkJLQ2FsbGJhY2suUmVhZENhbGxiYWNrKCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2FmZVJlYWRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhh\nbmRsZSBsaCwgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNlcSwKICAgICAg\nICAgICAgICAgICAgICAgICAgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0sg\nfHwgIXNlcS5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk9L\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1l\nYW5zIHRoYXQgdGhlcmUgaXMgbm8gZW50cmllcyByZWFkLCBwcm92aWRlIGEg\nbWVhbmluZ2Z1bCBleGNlcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk5vU3VjaEVudHJ5\nRXhjZXB0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygi\nUmVjZWl2ZWQgZXJyb3IgY29kZSB7fSIsIHJjKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbiBia2UgPSBCS0V4Y2VwdGlv\nbi5jcmVhdGUocmMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZ2dlci5lcnJvcigiV2hpbGUgcmVjb3ZlcmluZyBsZWRnZXI6ICIgKyBs\nZWRnZXJJZCArICIgZm9yIHRvcGljOiAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4\nKCkgKyAiLCBjb3VsZCBub3QgcmVhZCBsYXN0IGVudHJ5IiwgYmtlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWls\nZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0\naW9uKGJrZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBNZXNzYWdlIGxhc3RNZXNzYWdlOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsYXN0TWVzc2FnZSA9IE1lc3NhZ2UucGFyc2VG\ncm9tKHNlcS5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBTdHJpbmcgbXNnID0gIldoaWxlIHJlY292ZXJpbmcgbGVkZ2VyOiAi\nICsgbGVkZ2VySWQgKyAiIGZvciB0b3BpYzogIgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3RyaW5n\nVXRmOCgpICsgIiwgY291bGQgbm90IGRlc2VyaWFsaXplIGxhc3QgbWVzc2Fn\nZSI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVy\ncm9yKG1zZywgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5V\nbmV4cGVjdGVkQ29uZGl0aW9uRXhjZXB0aW9uKG1zZykpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nb25nIGVuZE9mTGVkZ2VyICA9IGxhc3RNZXNzYWdlLmdldE1zZ0lkKCkuZ2V0\nTG9jYWxDb21wb25lbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxvbmcgc3RhcnRPZkxlZGdlciA9IGVuZE9mTGVkZ2VyIC0gbnVtRW50cmll\nc0luTGFzdExlZGdlciArIDE7CgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKHN0YXJ0T2ZMZWRnZXIgIT0gZXhwZWN0ZWRTdGFydFNlcUlkKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2FwIHdvdWxk\nIGJlIGludHJvZHVjZWQgYnkgb2xkIHZlcnNpb24gd2hlbiBnYyBjb25zdW1l\nZCBsZWRnZXJzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3Ry\naW5nIG1zZyA9ICJFeHBlY3RlZCBzdGFydCBzZXEgaWQgb2YgcmVjb3ZlcmVk\nIGxlZGdlciAiICsgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiIHRvIGJlICIgKyBleHBlY3RlZFN0\nYXJ0U2VxSWQgKyAiIGJ1dCBpdCB3YXMgIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIHN0YXJ0T2ZMZWRnZXIgKyAi\nLiI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndh\ncm4obXNnKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJSYW5nZSBsciA9IGJ1aWxk\nTGVkZ2VyUmFuZ2UobGVkZ2VySWQsIHN0YXJ0T2ZMZWRnZXIsIGxhc3RNZXNz\nYWdlLmdldE1zZ0lkKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndG9waWNJbmZvLmxlZGdlclJhbmdlcy5wdXQoZW5kT2ZMZWRnZXIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBJbk1lbW9yeUxl\nZGdlclJhbmdlKGxyLCBsaCkpOwoKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZ2dlci5pbmZvKCJSZWNvdmVyZWQgdW5jbG9zZWQgbGVkZ2VyOiB7\nfSBmb3IgdG9waWM6IHt9IHdpdGgge30gZW50cmllcyBzdGFydGluZyBmcm9t\nIHNlcSBpZCB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB2YShsZWRnZXJJZCwgdG9waWMudG9TdHJpbmdVdGY4KCksIG51\nbUVudHJpZXNJbkxhc3RMZWRnZXIsIHN0YXJ0T2ZMZWRnZXIpKTsKCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBvcGVuTmV3VG9waWNMZWRnZXIodG9w\naWMsIGV4cGVjdGVkVmVyc2lvbk9mTGVkZ2VyTm9kZSwgdG9waWNJbmZvLCBl\nbmRPZkxlZGdlciArIDEsIGZhbHNlLCBjYiwgY3R4KTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIGN0eCk7Cgog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwgY3R4KTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVuIE5ldyBMZWRnZXIgdG8g\nd3JpdGUgZm9yIGEgdG9waWMuCiAgICAgKgogICAgICogQHBhcmFtIHRvcGlj\nCiAgICAgKiAgICAgICAgICBUb3BpYyBOYW1lCiAgICAgKiBAcGFyYW0gZXhw\nZWN0ZWRWZXJzaW9uT2ZMZWRnZXJzTm9kZQogICAgICogICAgICAgICAgRXhw\nZWN0ZWQgVmVyc2lvbiB0byBVcGRhdGUgTGVkZ2VycyBOb2RlLgogICAgICog\nQHBhcmFtIHRvcGljSW5mbwogICAgICogICAgICAgICAgVG9waWMgSW5mb3Jt\nYXRpb24KICAgICAqIEBwYXJhbSBzdGFydFNlcUlkCiAgICAgKiAgICAgICAg\nICBTdGFydCBvZiBzZXF1ZW5jZSBpZCBmb3IgbmV3IGxlZGdlcgogICAgICog\nQHBhcmFtIGNoYW5nZUxlZGdlcgogICAgICogICAgICAgICAgV2hldGhlciBp\ncyBpdCBjYWxsZWQgd2hlbiBjaGFuZ2luZyBsZWRnZXIKICAgICAqIEBwYXJh\nbSBjYgogICAgICogICAgICAgICAgQ2FsbGJhY2sgdG8gdHJpZ2dlciBhZnRl\nciBvcGVuaW5nIG5ldyBsZWRnZXIuCiAgICAgKiBAcGFyYW0gY3R4CiAgICAg\nKiAgICAgICAgICBDYWxsYmFjayBjb250ZXh0LgogICAgICovCiAgICB2b2lk\nIG9wZW5OZXdUb3BpY0xlZGdlcihmaW5hbCBCeXRlU3RyaW5nIHRvcGljLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgVmVyc2lvbiBleHBl\nY3RlZFZlcnNpb25PZkxlZGdlcnNOb2RlLCBmaW5hbCBUb3BpY0luZm8gdG9w\naWNJbmZvLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgbG9u\nZyBzdGFydFNlcUlkLCBmaW5hbCBib29sZWFuIGNoYW5nZUxlZGdlciwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPFZvaWQ+\nIGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgYmsuYXN5bmNDcmVh\ndGVMZWRnZXIoY2ZnLmdldEJrRW5zZW1ibGVTaXplKCksIGNmZy5nZXRCa1dy\naXRlUXVvcnVtU2l6ZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNmZy5nZXRCa0Fja1F1b3J1bVNpemUoKSwgRGlnZXN0VHlwZS5DUkMzMiwg\ncGFzc3dkLAogICAgICAgIG5ldyBTYWZlQXN5bkJLQ2FsbGJhY2suQ3JlYXRl\nQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEF0b21pY0Jvb2xlYW4gcHJvY2Vz\nc2VkID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwoKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVDcmVhdGVD\nb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBsaCwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICAgICAgaWYgKCFwcm9jZXNzZWQuY29tcGFyZUFuZFNl\ndChmYWxzZSwgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJjICE9\nIEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICBC\nS0V4Y2VwdGlvbiBia2UgPSBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwogICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ291bGQgbm90IGNyZWF0\nZSBuZXcgbGVkZ2VyIHdoaWxlIGFjcXVpcmluZyB0b3BpYzogIgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpLCBia2UpOwogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZh\naWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNl\ncHRpb24oYmtlKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIGNvbXB1dGUgbGFz\ndCBzZXEgaWQKICAgICAgICAgICAgICAgIGlmICghY2hhbmdlTGVkZ2VyKSB7\nCiAgICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLmxhc3RTZXFJZFB1c2hl\nZCA9IHRvcGljSW5mby5sZWRnZXJSYW5nZXMuaXNFbXB0eSgpID8gTWVzc2Fn\nZVNlcUlkLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuc2V0TG9jYWxDb21wb25lbnQoc3Rh\ncnRTZXFJZCAtIDEpLmJ1aWxkKCkgOiB0b3BpY0luZm8ubGVkZ2VyUmFuZ2Vz\nLmxhc3RFbnRyeSgpLmdldFZhbHVlKCkucmFuZ2UKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldEVuZFNlcUlk\nSW5jbHVkZWQoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICBMZWRnZXJSYW5nZSBsYXN0UmFuZ2UgPSBMZWRnZXJSYW5nZS5uZXdCdWls\nZGVyKCkuc2V0TGVkZ2VySWQobGguZ2V0SWQoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRTdGFydFNlcUlkSW5jbHVk\nZWQoc3RhcnRTZXFJZCkuYnVpbGQoKTsKICAgICAgICAgICAgICAgIHRvcGlj\nSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UgPSBuZXcgSW5NZW1vcnlMZWRnZXJS\nYW5nZShsYXN0UmFuZ2UsIGxoKTsKICAgICAgICAgICAgICAgIHRvcGljSW5m\nby5sYXN0RW50cnlJZEFja2VkSW5DdXJyZW50TGVkZ2VyID0gLTE7CgogICAg\nICAgICAgICAgICAgLy8gUGVyc2lzdCB0aGUgZmFjdCB0aGF0IHdlIHN0YXJ0\nZWQgdGhpcyBuZXcKICAgICAgICAgICAgICAgIC8vIGxlZGdlciB0byBaSwoK\nICAgICAgICAgICAgICAgIExlZGdlclJhbmdlcy5CdWlsZGVyIGJ1aWxkZXIg\nPSBMZWRnZXJSYW5nZXMubmV3QnVpbGRlcigpOwogICAgICAgICAgICAgICAg\nZm9yIChJbk1lbW9yeUxlZGdlclJhbmdlIGltbHIgOiB0b3BpY0luZm8ubGVk\nZ2VyUmFuZ2VzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgYnVp\nbGRlci5hZGRSYW5nZXMoaW1sci5yYW5nZSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBidWlsZGVyLmFkZFJhbmdlcyhsYXN0UmFuZ2Up\nOwoKICAgICAgICAgICAgICAgIHRwTWFuYWdlci53cml0ZVRvcGljUGVyc2lz\ndGVuY2VJbmZvKAogICAgICAgICAgICAgICAgdG9waWMsIGJ1aWxkZXIuYnVp\nbGQoKSwgZXhwZWN0ZWRWZXJzaW9uT2ZMZWRnZXJzTm9kZSwgbmV3IENhbGxi\nYWNrPFZlcnNpb24+KCkgewogICAgICAgICAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZp\nbmlzaGVkKE9iamVjdCBjdHgsIFZlcnNpb24gbmV3VmVyc2lvbikgewogICAg\nICAgICAgICAgICAgICAgICAgICAvLyBGaW5hbGx5LCBhbGwgZG9uZQogICAg\nICAgICAgICAgICAgICAgICAgICB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzVmVy\nc2lvbiA9IG5ld1ZlcnNpb247CiAgICAgICAgICAgICAgICAgICAgICAgIHRv\ncGljSW5mb3MucHV0KHRvcGljLCB0b3BpY0luZm8pOwogICAgICAgICAgICAg\nICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRp\nb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlv\nbikgewogICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWls\nZWQoY3R4LCBleGNlcHRpb24pOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICB9LCBjdHgpOwogICAgfQoKICAgIC8q\nKgogICAgICogYWNxdWlyZSBvd25lcnNoaXAgb2YgYSB0b3BpYywgZG9pbmcg\nd2hhdGV2ZXIgaXMgbmVlZGVkIHRvIGJlIGFibGUgdG8KICAgICAqIHBlcmZv\ncm0gcmVhZHMgYW5kIHdyaXRlcyBvbiB0aGF0IHRvcGljIGZyb20gaGVyZSBv\nbgogICAgICoKICAgICAqIEBwYXJhbSB0b3BpYwogICAgICogQHBhcmFtIGNh\nbGxiYWNrCiAgICAgKiBAcGFyYW0gY3R4CiAgICAgKi8KICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgYWNxdWlyZWRUb3BpYyhCeXRlU3RyaW5nIHRv\ncGljLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewog\nICAgICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBBY3F1\naXJlT3AodG9waWMsIGNhbGxiYWNrLCBjdHgpKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIENoYW5nZSBsZWRnZXIgdG8gd3JpdGUgZm9yIGEgdG9waWMuCiAg\nICAgKi8KICAgIGNsYXNzIENoYW5nZUxlZGdlck9wIGV4dGVuZHMgVG9waWNP\ncFF1ZXVlci5Bc3luY2hyb25vdXNPcDxWb2lkPiB7CgogICAgICAgIHB1Ymxp\nYyBDaGFuZ2VMZWRnZXJPcChCeXRlU3RyaW5nIHRvcGljLCBDYWxsYmFjazxW\nb2lkPiBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBxdWV1ZXIuc3Vw\nZXIodG9waWMsIGNiLCBjdHgpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICBU\nb3BpY0luZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwog\nICAgICAgICAgICBpZiAobnVsbCA9PSB0b3BpY0luZm8pIHsKICAgICAgICAg\nICAgICAgIGxvZ2dlci5lcnJvcigiV2VpcmVkISBodWIgc2VydmVyIGRvZXNu\nJ3Qgb3duIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICArICIgd2hlbiBjaGFuZ2luZyBsZWRnZXIg\ndG8gd3JpdGUuIik7CiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWls\nZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNp\nYmxlRm9yVG9waWNFeGNlcHRpb24oIiIpKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjbG9zZUxhc3RUb3Bp\nY0xlZGdlckFuZE9wZW5OZXdPbmUodG9waWNJbmZvKTsKICAgICAgICB9Cgog\nICAgICAgIHByaXZhdGUgdm9pZCBjbG9zZUxhc3RUb3BpY0xlZGdlckFuZE9w\nZW5OZXdPbmUoZmluYWwgVG9waWNJbmZvIHRvcGljSW5mbykgewogICAgICAg\nICAgICBmaW5hbCBsb25nIGxlZGdlcklkID0gdG9waWNJbmZvLmN1cnJlbnRM\nZWRnZXJSYW5nZS5oYW5kbGUuZ2V0SWQoKTsKICAgICAgICAgICAgdG9waWNJ\nbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5oYW5kbGUuYXN5bmNDbG9zZShuZXcg\nQ2xvc2VDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEF0b21pY0Jvb2xl\nYW4gcHJvY2Vzc2VkID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMg\ndm9pZCBjbG9zZUNvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBP\nYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwcm9jZXNz\nZWQuY29tcGFyZUFuZFNldChmYWxzZSwgdHJ1ZSkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBpZiAoQktFeGNlcHRpb24uQ29kZS5PSyAhPSBy\nYykgewogICAgICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbiBia2Ug\nPSBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwogICAgICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIkNvdWxkIG5vdCBjbG9zZSBsZWRnZXIgIiAr\nIGxlZGdlcklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiIHdoaWxlIGNoYW5naW5nIGxlZGdlciBvZiB0b3BpYyAiICsgdG9waWMu\ndG9TdHJpbmdVdGY4KCksIGJrZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24u\nU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgbG9uZyBlbmRTZXFJZCA9IHRvcGljSW5mby5sYXN0U2Vx\nSWRQdXNoZWQuZ2V0TG9jYWxDb21wb25lbnQoKTsKICAgICAgICAgICAgICAg\nICAgICAvLyB1cGRhdGUgbGFzdCByYW5nZQogICAgICAgICAgICAgICAgICAg\nIExlZGdlclJhbmdlIGxhc3RSYW5nZSA9CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJ1aWxkTGVkZ2VyUmFuZ2UobGVkZ2VySWQsIHRvcGljSW5mby5jdXJy\nZW50TGVkZ2VyUmFuZ2UuZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCksCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9waWNJbmZv\nLmxhc3RTZXFJZFB1c2hlZCk7CgogICAgICAgICAgICAgICAgICAgIHRvcGlj\nSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UucmFuZ2UgPSBsYXN0UmFuZ2U7CiAg\nICAgICAgICAgICAgICAgICAgLy8gcHV0IGN1cnJlbnQgbGVkZ2VyIHRvIGxl\nZGdlciByYW5nZXMKICAgICAgICAgICAgICAgICAgICB0b3BpY0luZm8ubGVk\nZ2VyUmFuZ2VzLnB1dChlbmRTZXFJZCwgdG9waWNJbmZvLmN1cnJlbnRMZWRn\nZXJSYW5nZSk7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkNs\nb3NlZCB3cml0dGVuIGxlZGdlciAiICsgbGVkZ2VySWQgKyAiIGZvciB0b3Bp\nYyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9T\ndHJpbmdVdGY4KCkgKyAiIHRvIGNoYW5nZSBsZWRnZXIuIik7CiAgICAgICAg\nICAgICAgICAgICAgb3Blbk5ld1RvcGljTGVkZ2VyKHRvcGljLCB0b3BpY0lu\nZm8ubGVkZ2VyUmFuZ2VzVmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLCBlbmRTZXFJZCArIDEsIHRy\ndWUsIGNiLCBjdHgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nLCBjdHgpOwogICAgICAgIH0KCiAgICB9CgogICAgLyoqCiAgICAgKiBDaGFu\nZ2UgbGVkZ2VyIHRvIHdyaXRlIGZvciBhIHRvcGljLgogICAgICoKICAgICAq\nIEBwYXJhbSB0b3BpYwogICAgICogICAgICAgICAgVG9waWMgTmFtZQogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjaGFuZ2VMZWRnZXIoQnl0ZVN0cmlu\nZyB0b3BpYywgQ2FsbGJhY2s8Vm9pZD4gY2IsIE9iamVjdCBjdHgpIHsKICAg\nICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgQ2hhbmdl\nTGVkZ2VyT3AodG9waWMsIGNiLCBjdHgpKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBjbG9zZUxlZGdlcihMZWRnZXJIYW5kbGUgbGgpIHsKICAgICAgICAv\nLyB0cnkgewogICAgICAgIC8vIGxoLmFzeW5jQ2xvc2Uobm9PcENsb3NlQ2Fs\nbGJhY2ssIG51bGwpOwogICAgICAgIC8vIH0gY2F0Y2ggKEludGVycnVwdGVk\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAvLyBsb2dnZXIuZXJyb3IoZSk7CiAg\nICAgICAgLy8gVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsK\nICAgICAgICAvLyB9CiAgICB9CgogICAgY2xhc3MgUmVsZWFzZU9wIGV4dGVu\nZHMgVG9waWNPcFF1ZXVlci5TeW5jaHJvbm91c09wIHsKCiAgICAgICAgcHVi\nbGljIFJlbGVhc2VPcChCeXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAgICAg\nIHF1ZXVlci5zdXBlcih0b3BpYyk7CiAgICAgICAgfQoKICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW5JbnRlcm5hbCgpIHsKICAg\nICAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5mb3MucmVt\nb3ZlKHRvcGljKTsKCiAgICAgICAgICAgIGlmICh0b3BpY0luZm8gPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBmb3IgKEluTWVtb3J5TGVkZ2VyUmFuZ2UgaW1sciA6IHRv\ncGljSW5mby5sZWRnZXJSYW5nZXMudmFsdWVzKCkpIHsKICAgICAgICAgICAg\nICAgIGlmIChpbWxyLmhhbmRsZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgY2xvc2VMZWRnZXIoaW1sci5oYW5kbGUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodG9waWNJbmZv\nLmN1cnJlbnRMZWRnZXJSYW5nZSAhPSBudWxsICYmIHRvcGljSW5mby5jdXJy\nZW50TGVkZ2VyUmFuZ2UuaGFuZGxlICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgIGNsb3NlTGVkZ2VyKHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2Uu\naGFuZGxlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFJlbGVhc2UgYW55IHJlc291cmNlcyBmb3IgdGhlIHRvcGlj\nIHRoYXQgbWlnaHQgYmUgY3VycmVudGx5IGhlbGQuIFRoZXJlCiAgICAgKiB3\nb250IGJlIGFueSBzdWJzZXF1ZW50IHJlYWRzIG9yIHdyaXRlcyBvbiB0aGF0\nIHRvcGljIGNvbWluZwogICAgICoKICAgICAqIEBwYXJhbSB0b3BpYwogICAg\nICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGxvc3RUb3BpYyhC\neXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRNYXli\nZVJ1bih0b3BpYywgbmV3IFJlbGVhc2VPcCh0b3BpYykpOwogICAgfQoKICAg\nIGNsYXNzIFNldE1lc3NhZ2VCb3VuZE9wIGV4dGVuZHMgVG9waWNPcFF1ZXVl\nci5TeW5jaHJvbm91c09wIHsKICAgICAgICBmaW5hbCBpbnQgYm91bmQ7Cgog\nICAgICAgIHB1YmxpYyBTZXRNZXNzYWdlQm91bmRPcChCeXRlU3RyaW5nIHRv\ncGljLCBpbnQgYm91bmQpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVyKHRv\ncGljKTsKICAgICAgICAgICAgdGhpcy5ib3VuZCA9IGJvdW5kOwogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVu\nSW50ZXJuYWwoKSB7CiAgICAgICAgICAgIFRvcGljSW5mbyB0b3BpY0luZm8g\nPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CiAgICAgICAgICAgIGlmICh0b3Bp\nY0luZm8gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdG9waWNJbmZvLm1l\nc3NhZ2VCb3VuZCA9IGJvdW5kOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1lc3NhZ2VCb3VuZChCeXRlU3Ry\naW5nIHRvcGljLCBJbnRlZ2VyIGJvdW5kKSB7CiAgICAgICAgcXVldWVyLnB1\nc2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IFNldE1lc3NhZ2VCb3VuZE9wKHRv\ncGljLCBib3VuZCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsZWFyTWVz\nc2FnZUJvdW5kKEJ5dGVTdHJpbmcgdG9waWMpIHsKICAgICAgICBxdWV1ZXIu\ncHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgU2V0TWVzc2FnZUJvdW5kT3Ao\ndG9waWMsIFRvcGljSW5mby5VTkxJTUlURUQpKTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyB2b2lkIHN0b3AoKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgdHBNYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgfSBjYXRj\naCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJu\nKCJFeGNlcHRpb24gY2xvc2luZyB0b3BpYyBwZXJzaXN0ZW5jZSBtYW5hZ2Vy\nIDogIiwgaW9lKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

