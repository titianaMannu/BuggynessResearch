{"sha":"d269fe82a84937700dc9b0905ab48cdd753c181e","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDI2OWZlODJhODQ5Mzc3MDBkYzliMDkwNWFiNDhjZGQ3NTNjMTgxZQ==","size":37762,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d269fe82a84937700dc9b0905ab48cdd753c181e","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuc3Vic2NyaXB0aW9uczsK\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLk1hcDsKaW1wb3J0IGphdmEudXRpbC5NYXAuRW50cnk7CmltcG9ydCBqYXZh\nLnV0aWwuVGltZXI7CmltcG9ydCBqYXZhLnV0aWwuVGltZXJUYXNrOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5MaW5rZWRCbG9ja2luZ1F1ZXVl\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0\nb3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWlj\nLkF0b21pY0ludGVnZXI7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb25lZDsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdDsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvbkRhdGE7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNl\nczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50OwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9leHRlbnNpb25zLk1lc3NhZ2VJ\nZFV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9leHRlbnNp\nb25zLlN1YnNjcmlwdGlvblN0YXRlVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlRvcGljT3BR\ndWV1ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuZGVsaXZl\ncnkuRGVsaXZlcnlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\nc2VydmVyLnBlcnNpc3RlbmNlLlBlcnNpc3RlbmNlTWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci50b3BpY3MuVG9waWNNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnRvcGljcy5Ub3Bp\nY093bmVyc2hpcENoYW5nZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcudXRpbC5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnV0aWwuQ2FsbGJhY2tVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnV0aWwuQ29uY3VycmVuY3lVdGlsczsKCnB1YmxpYyBhYnN0cmFjdCBjbGFz\ncyBBYnN0cmFjdFN1YnNjcmlwdGlvbk1hbmFnZXIgaW1wbGVtZW50cyBTdWJz\nY3JpcHRpb25NYW5hZ2VyLCBUb3BpY093bmVyc2hpcENoYW5nZUxpc3RlbmVy\nIHsKCiAgICBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3Rvcnku\nZ2V0TG9nZ2VyKEFic3RyYWN0U3Vic2NyaXB0aW9uTWFuYWdlci5jbGFzcyk7\nCgogICAgcHJvdGVjdGVkIGZpbmFsIFNlcnZlckNvbmZpZ3VyYXRpb24gY2Zn\nOwogICAgcHJvdGVjdGVkIGZpbmFsIENvbmN1cnJlbnRIYXNoTWFwPEJ5dGVT\ndHJpbmcsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0\nYXRlPj4gdG9wMnN1YjJzZXEgPQogICAgICBuZXcgQ29uY3VycmVudEhhc2hN\nYXA8Qnl0ZVN0cmluZywgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2Ny\naXB0aW9uU3RhdGU+PigpOwogICAgcHJvdGVjdGVkIGZpbmFsIFRvcGljT3BR\ndWV1ZXIgcXVldWVyOwogICAgcHJpdmF0ZSBmaW5hbCBBcnJheUxpc3Q8U3Vi\nc2NyaXB0aW9uRXZlbnRMaXN0ZW5lcj4gbGlzdGVuZXJzID0gbmV3IEFycmF5\nTGlzdDxTdWJzY3JpcHRpb25FdmVudExpc3RlbmVyPigpOwoKICAgIC8vIEhh\nbmRsZSB0byB0aGUgRGVsaXZlcnlNYW5hZ2VyIGZvciB0aGUgc2VydmVyIHNv\nIHdlIGNhbiBzdG9wIHNlcnZpbmcgc3Vic2NyaWJlcnMKICAgIC8vIHdoZW4g\nbG9zaW5nIHRvcGljcwogICAgcHJpdmF0ZSBmaW5hbCBEZWxpdmVyeU1hbmFn\nZXIgZG07CiAgICAvLyBIYW5kbGUgdG8gdGhlIFBlcnNpc3RlbmNlTWFuYWdl\nciBmb3IgdGhlIHNlcnZlciBzbyB3ZSBjYW4gcGFzcyBhbG9uZyB0aGUKICAg\nIC8vIG1lc3NhZ2UgY29uc3VtZSBwb2ludGVycyBmb3IgZWFjaCB0b3BpYy4K\nICAgIHByaXZhdGUgZmluYWwgUGVyc2lzdGVuY2VNYW5hZ2VyIHBtOwogICAg\nLy8gVGltZXIgZm9yIHJ1bm5pbmcgYSByZWN1cnJpbmcgdGhyZWFkIHRhc2sg\ndG8gZ2V0IHRoZSBtaW5pbXVtIG1lc3NhZ2UKICAgIC8vIHNlcXVlbmNlIElE\nIGZvciBlYWNoIHRvcGljIHRoYXQgYWxsIHN1YnNjcmliZXJzIGZvciBpdCBo\nYXZlIGNvbnN1bWVkCiAgICAvLyBhbHJlYWR5LiBXaXRoIHRoYXQgaW5mb3Jt\nYXRpb24sIHdlIGNhbiBjYWxsIHRoZSBQZXJzaXN0ZW5jZU1hbmFnZXIgdG8K\nICAgIC8vIHVwZGF0ZSBpdCBvbiB0aGUgbWVzc2FnZXMgdGhhdCBhcmUgc2Fm\nZSB0byBiZSBnYXJiYWdlIGNvbGxlY3RlZC4KICAgIHByaXZhdGUgZmluYWwg\nVGltZXIgdGltZXIgPSBuZXcgVGltZXIodHJ1ZSk7CiAgICAvLyBJbiBtZW1v\ncnkgbWFwcGluZyBvZiB0b3BpY3MgdG8gdGhlIG1pbmltdW0gY29uc3VtZWQg\nbWVzc2FnZSBzZXF1ZW5jZSBJRAogICAgLy8gZm9yIGFsbCBzdWJzY3JpYmVy\ncyB0byB0aGUgdG9waWMuCiAgICBwcml2YXRlIGZpbmFsIENvbmN1cnJlbnRI\nYXNoTWFwPEJ5dGVTdHJpbmcsIExvbmc+IHRvcGljMk1pbkNvbnN1bWVkTWVz\nc2FnZXNNYXAgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8Qnl0ZVN0cmluZywg\nTG9uZz4oKTsKCiAgICBwcm90ZWN0ZWQgZmluYWwgQ2FsbGJhY2s8Vm9pZD4g\nbm9vcENhbGxiYWNrID0gbmV3IE5vb3BDYWxsYmFjazxWb2lkPigpOwoKICAg\nIHN0YXRpYyBjbGFzcyBOb29wQ2FsbGJhY2s8VD4gaW1wbGVtZW50cyBDYWxs\nYmFjazxUPiB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlv\nbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgbG9nZ2VyLndhcm4oIkV4Y2Vw\ndGlvbiBmb3VuZCBpbiBBYnN0cmFjdFN1YnNjcmlwdGlvbk1hbmFnZXIgOiAi\nLCBleGNlcHRpb24pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVCByZXN1bHRPZk9wZXJh\ndGlvbikgewogICAgICAgIH07CiAgICB9CgogICAgcHVibGljIEFic3RyYWN0\nU3Vic2NyaXB0aW9uTWFuYWdlcihTZXJ2ZXJDb25maWd1cmF0aW9uIGNmZywg\nVG9waWNNYW5hZ2VyIHRtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBQZXJzaXN0ZW5jZU1hbmFnZXIgcG0sIERlbGl2ZXJ5TWFu\nYWdlciBkbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxlcikgewogICAg\nICAgIHRoaXMuY2ZnID0gY2ZnOwogICAgICAgIHF1ZXVlciA9IG5ldyBUb3Bp\nY09wUXVldWVyKHNjaGVkdWxlcik7CiAgICAgICAgdG0uYWRkVG9waWNPd25l\ncnNoaXBDaGFuZ2VMaXN0ZW5lcih0aGlzKTsKICAgICAgICB0aGlzLnBtID0g\ncG07CiAgICAgICAgdGhpcy5kbSA9IGRtOwogICAgICAgIC8vIFNjaGVkdWxl\nIHRoZSByZWN1cnJpbmcgTWVzc2FnZXNDb25zdW1lZFRhc2sgb25seSBpZiBh\nCiAgICAgICAgLy8gUGVyc2lzdGVuY2VNYW5hZ2VyIGlzIHBhc3NlZC4KICAg\nICAgICBpZiAocG0gIT0gbnVsbCkgewogICAgICAgICAgICB0aW1lci5zY2hl\nZHVsZShuZXcgTWVzc2FnZXNDb25zdW1lZFRhc2soKSwgMCwgY2ZnLmdldE1l\nc3NhZ2VzQ29uc3VtZWRUaHJlYWRSdW5JbnRlcnZhbCgpKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGlzIHRoZSBUaW1lciBUYXNr\nIGZvciBmaW5kaW5nIG91dCBmb3IgZWFjaCB0b3BpYywgd2hhdCB0aGUgbWlu\naW11bQogICAgICogY29uc3VtZWQgbWVzc2FnZSBieSB0aGUgc3Vic2NyaWJl\ncnMgYXJlLiBUaGlzIGluZm9ybWF0aW9uIGlzIHVzZWQgdG8gcGFzcwogICAg\nICogYWxvbmcgdG8gdGhlIHNlcnZlcidzIFBlcnNpc3RlbmNlTWFuYWdlciBz\nbyBpdCBjYW4gZ2FyYmFnZSBjb2xsZWN0IG9sZGVyCiAgICAgKiB0b3BpYyBt\nZXNzYWdlcyB0aGF0IGFyZSBubyBsb25nZXIgbmVlZGVkIGJ5IHRoZSBzdWJz\nY3JpYmVycy4KICAgICAqLwogICAgY2xhc3MgTWVzc2FnZXNDb25zdW1lZFRh\nc2sgZXh0ZW5kcyBUaW1lclRhc2sgewogICAgICAgIC8qKgogICAgICAgICAq\nIEltcGxlbWVudCB0aGUgVGltZXJUYXNrJ3MgYWJzdHJhY3QgcnVuIG1ldGhv\nZC4KICAgICAgICAgKi8KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIC8vIFdlIGFyZSBsb29waW5n\nIHRocm91Z2ggcmVsYXRpdmVseSBzbWFsbCBpbiBtZW1vcnkgZGF0YSBzdHJ1\nY3R1cmVzCiAgICAgICAgICAgIC8vIHNvIGl0IHNob3VsZCBiZSBzYWZlIHRv\nIHJ1biB0aGlzIGZhaXJseSBvZnRlbi4KICAgICAgICAgICAgZm9yIChCeXRl\nU3RyaW5nIHRvcGljIDogdG9wMnN1YjJzZXEua2V5U2V0KCkpIHsKICAgICAg\nICAgICAgICAgIGZpbmFsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNj\ncmlwdGlvblN0YXRlPiB0b3BpY1N1YnNjcmlwdGlvbnMgPSB0b3Ayc3ViMnNl\ncS5nZXQodG9waWMpOwogICAgICAgICAgICAgICAgaWYgKHRvcGljU3Vic2Ny\naXB0aW9ucyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbG9uZyBt\naW5Db25zdW1lZE1lc3NhZ2UgPSBMb25nLk1BWF9WQUxVRTsKICAgICAgICAg\nICAgICAgIGJvb2xlYW4gaGFzQm91bmQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBzdWJzY3JpYmVycyBvbiB0aGUgY3Vy\ncmVudCB0b3BpYyB0byBmaW5kIHRoZQogICAgICAgICAgICAgICAgLy8gbWlu\naW11bSBwZXJzaXN0ZWQgbWVzc2FnZSBpZC4gVGhlIHJlYXNvbiBub3QgdXNp\nbmcgaW4tbWVtb3J5CiAgICAgICAgICAgICAgICAvLyBjb25zdW1lZCBtZXNz\nYWdlIGlkIGlzIExlZGdlclJhbmdzIGFuZCBJbk1lbW9yeVN1YnNjcmlwdGlv\nblN0YXRlCiAgICAgICAgICAgICAgICAvLyBtYXkgYmUgaW5jb25zaXN0ZW50\nIGluIGNhc2Ugb2YgYSBzZXJ2ZXIgY3Jhc2guCiAgICAgICAgICAgICAgICBm\nb3IgKEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGUgY3VyU3Vic2NyaXB0aW9u\nIDogdG9waWNTdWJzY3JpcHRpb25zLnZhbHVlcygpKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGN1clN1YnNjcmlwdGlvbi5nZXRMYXN0UGVyc2lzdGVk\nU2VxSWQoKSA8IG1pbkNvbnN1bWVkTWVzc2FnZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBtaW5Db25zdW1lZE1lc3NhZ2UgPSBjdXJTdWJzY3JpcHRp\nb24uZ2V0TGFzdFBlcnNpc3RlZFNlcUlkKCk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGhhc0JvdW5kID0gaGFzQm91bmQg\nJiYgY3VyU3Vic2NyaXB0aW9uLmdldFN1YnNjcmlwdGlvblByZWZlcmVuY2Vz\nKCkuaGFzTWVzc2FnZUJvdW5kKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBib29sZWFuIGNhbGxQZXJzaXN0ZW5jZU1hbmFnZXIgPSB0\ncnVlOwogICAgICAgICAgICAgICAgLy8gQ2FsbCB0aGUgUGVyc2lzdGVuY2VN\nYW5hZ2VyIGlmIG5vYm9keSBzdWJzY3JpYmVzIHRvIHRoZSB0b3BpYwogICAg\nICAgICAgICAgICAgLy8geWV0LCBvciB0aGUgY29uc3VtZSBwb2ludGVyIGhh\ncyBtb3ZlZCBhaGVhZCBzaW5jZSB0aGUgbGFzdAogICAgICAgICAgICAgICAg\nLy8gdGltZSwgb3IgaWYgdGhpcyBpcyB0aGUgaW5pdGlhbCBzdWJzY3JpcHRp\nb24uCiAgICAgICAgICAgICAgICBMb25nIG1pbkNvbnN1bWVkRnJvbU1hcCA9\nIHRvcGljMk1pbkNvbnN1bWVkTWVzc2FnZXNNYXAuZ2V0KHRvcGljKTsKICAg\nICAgICAgICAgICAgIGlmICh0b3BpY1N1YnNjcmlwdGlvbnMuaXNFbXB0eSgp\nCiAgICAgICAgICAgICAgICAgICAgfHwgKG1pbkNvbnN1bWVkRnJvbU1hcCAh\nPSBudWxsICYmIG1pbkNvbnN1bWVkRnJvbU1hcCA8IG1pbkNvbnN1bWVkTWVz\nc2FnZSkKICAgICAgICAgICAgICAgICAgICB8fCAobWluQ29uc3VtZWRGcm9t\nTWFwID09IG51bGwgJiYgbWluQ29uc3VtZWRNZXNzYWdlICE9IDApKSB7CiAg\nICAgICAgICAgICAgICAgICAgdG9waWMyTWluQ29uc3VtZWRNZXNzYWdlc01h\ncC5wdXQodG9waWMsIG1pbkNvbnN1bWVkTWVzc2FnZSk7CiAgICAgICAgICAg\nICAgICAgICAgcG0uY29uc3VtZWRVbnRpbCh0b3BpYywgbWluQ29uc3VtZWRN\nZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzQm91bmQp\nIHsKICAgICAgICAgICAgICAgICAgICBwbS5jb25zdW1lVG9Cb3VuZCh0b3Bp\nYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBjbGFzcyBBY3F1aXJlT3AgZXh0ZW5kcyBU\nb3BpY09wUXVldWVyLkFzeW5jaHJvbm91c09wPFZvaWQ+IHsKICAgICAgICBw\ndWJsaWMgQWNxdWlyZU9wKEJ5dGVTdHJpbmcgdG9waWMsIENhbGxiYWNrPFZv\naWQ+IGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVl\nci5zdXBlcih0b3BpYywgY2FsbGJhY2ssIGN0eCk7CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAg\nICAgICAgICAgIGlmICh0b3Ayc3ViMnNlcS5jb250YWluc0tleSh0b3BpYykp\nIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwg\nbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHJlYWRTdWJzY3JpcHRpb25zKHRvcGljLCBuZXcgQ2Fs\nbGJhY2s8TWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3Rh\ndGU+PigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgs\nIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAg\nICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBleGNlcHRpb24pOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoZmlu\nYWwgT2JqZWN0IGN0eCwKICAgICAgICAgICAgICAgIGZpbmFsIE1hcDxCeXRl\nU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlPiByZXN1bHRPZk9w\nZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIC8vIFdlJ3ZlIGp1c3Qg\naW5oZXJpdGVkIGEgYnVuY2ggb2Ygc3Vic2NyaWJlciBmb3IgdGhpcwogICAg\nICAgICAgICAgICAgICAgIC8vIHRvcGljLCBzb21lIG9mIHdoaWNoIG1heSBi\nZSBsb2NhbC4gSWYgdGhleSBhcmUsIHRoZW4gd2UKICAgICAgICAgICAgICAg\nICAgICAvLyBuZWVkIHRvICgxKSBub3RpZnkgbGlzdGVuZXJzIG9mIHRoaXMg\nYW5kICgyKSByZWNvcmQgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gbnVt\nYmVyIGZvciBib29ra2VlcGluZyBzbyB0aGF0IGZ1dHVyZQogICAgICAgICAg\nICAgICAgICAgIC8vIHN1YnNjcmliZXMvdW5zdWJzY3JpYmVzIGNhbiBlZmZp\nY2llbnRseSBub3RpZnkgbGlzdGVuZXJzLgoKICAgICAgICAgICAgICAgICAg\nICAvLyBUaGUgZmluYWwgImNvbW1pdCIgKGFuZCAiYWJvcnQiKSBvcGVyYXRp\nb25zLgogICAgICAgICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPFZvaWQ+\nIGNiMiA9IG5ldyBDYWxsYmFjazxWb2lkPigpIHsKCiAgICAgICAgICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3Vi\nRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmVycm9yKCJTdWJzY3JpcHRpb24gbWFuYWdlciBmYWls\nZWQgdG8gYWNxdWlyZWQgdG9waWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4\nY2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVy\nYXRpb25GYWlsZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlz\naGVkKE9iamVjdCBjdHgsIFZvaWQgdm9pZE9iaikgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdG9wMnN1YjJzZXEucHV0KHRvcGljLCByZXN1bHRP\nZk9wZXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuaW5mbygiU3Vic2NyaXB0aW9uIG1hbmFnZXIgc3VjY2Vzc2Z1bGx5IGFj\ncXVpcmVkIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQo\nY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAvLyBOb3Rp\nZnkgbGlzdGVuZXJzIGlmIG5lY2Vzc2FyeS4KICAgICAgICAgICAgICAgICAg\nICBpZiAoaGFzTG9jYWxTdWJzY3JpcHRpb25zKHJlc3VsdE9mT3BlcmF0aW9u\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBub3RpZnlGaXJzdExvY2Fs\nU3Vic2NyaWJlKHRvcGljLCBmYWxzZSwgY2IyLCBjdHgpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNi\nMi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlTWVzc2FnZUJv\ndW5kKHRvcGljKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0s\nIGN0eCk7CgogICAgICAgIH0KCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIG5v\ndGlmeUZpcnN0TG9jYWxTdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywgYm9v\nbGVhbiBzeW5jaHJvbm91cywgZmluYWwgQ2FsbGJhY2s8Vm9pZD4gY2IsIGZp\nbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBDYWxsYmFjazxWb2lkPiBtY2Ig\nPSBDYWxsYmFja1V0aWxzLm11bHRpQ2FsbGJhY2sobGlzdGVuZXJzLnNpemUo\nKSwgY2IsIGN0eCk7CiAgICAgICAgZm9yIChTdWJzY3JpcHRpb25FdmVudExp\nc3RlbmVyIGxpc3RlbmVyIDogbGlzdGVuZXJzKSB7CiAgICAgICAgICAgIGxp\nc3RlbmVyLm9uRmlyc3RMb2NhbFN1YnNjcmliZSh0b3BpYywgc3luY2hyb25v\ndXMsIG1jYik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmln\ndXJlIG91dCB3aG8gaXMgc3Vic2NyaWJlZC4gRG8gbm90aGluZyBpZiBhbHJl\nYWR5IGFjcXVpcmVkLiBJZiB0aGVyZSdzCiAgICAgKiBhbiBlcnJvciByZWFk\naW5nIHRoZSBzdWJzY3JpYmVycycgc2VxdWVuY2UgSURzLCB0aGVuIHRoZSB0\nb3BpYyBpcyBub3QKICAgICAqIGFjcXVpcmVkLgogICAgICoKICAgICAqIEBw\nYXJhbSB0b3BpYwogICAgICogQHBhcmFtIGNhbGxiYWNrCiAgICAgKiBAcGFy\nYW0gY3R4CiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\nYWNxdWlyZWRUb3BpYyhmaW5hbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBD\nYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAg\nIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBBY3F1aXJlT3Ao\ndG9waWMsIGNhbGxiYWNrLCBjdHgpKTsKICAgIH0KCiAgICBjbGFzcyBSZWxl\nYXNlT3AgZXh0ZW5kcyBUb3BpY09wUXVldWVyLkFzeW5jaHJvbm91c09wPFZv\naWQ+IHsKCiAgICAgICAgcHVibGljIFJlbGVhc2VPcChmaW5hbCBCeXRlU3Ry\naW5nIHRvcGljLCBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYiwgT2JqZWN0IGN0\neCkgewogICAgICAgICAgICBxdWV1ZXIuc3VwZXIodG9waWMsIGNiLCBjdHgp\nOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgcnVuKCkgewogICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBmaW5h\nbENiID0gbmV3IENhbGxiYWNrPFZvaWQ+KCkgewogICAgICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRp\nb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdE9mT3BlcmF0aW9u\nKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkZpbmlzaGVk\nIHVwZGF0ZSBzdWJzY3JpcHRpb24gc3RhdGVzIHdoZW4gbG9zdGluZyB0b3Bp\nYyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9T\ndHJpbmdVdGY4KCkpOwogICAgICAgICAgICAgICAgICAgIGZpbmlzaCgpOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9i\namVjdCBjdHgsCiAgICAgICAgICAgICAgICAgICAgICAgIFB1YlN1YkV4Y2Vw\ndGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIu\nd2FybigiRXJyb3Igd2hlbiByZWxlYXNpbmcgdG9waWMgOiAiICsgdG9waWMu\ndG9TdHJpbmdVdGY4KCksIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICAg\nICAgZmluaXNoKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgcHJpdmF0ZSB2b2lkIGZpbmlzaCgpIHsKICAgICAgICAgICAgICAgICAg\nICAvLyB0ZWxsIGRlbGl2ZXJ5IG1hbmFnZXIgdG8gc3RvcCBkZWxpdmVyeSBm\nb3Igc3Vic2NyaXB0aW9ucyBvZiB0aGlzIHRvcGljCiAgICAgICAgICAgICAg\nICAgICAgZmluYWwgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0\naW9uU3RhdGU+IHRvcGljU3Vic2NyaXB0aW9ucyA9IHRvcDJzdWIyc2VxLnJl\nbW92ZSh0b3BpYyk7CiAgICAgICAgICAgICAgICAgICAgLy8gbm8gc3Vic2Ny\naXB0aW9ucyBub3csIGl0IG1heSBiZSByZW1vdmVkIGJ5IG90aGVyIHJlbGVh\nc2Ugb3BzCiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdG9waWNT\ndWJzY3JpcHRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAo\nQnl0ZVN0cmluZyBzdWJJZCA6IHRvcGljU3Vic2NyaXB0aW9ucy5rZXlTZXQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5p\nc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmRlYnVnKCJTdG9wIHNlcnZpbmcgc3Vic2NyaWJlciAo\nIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiwgIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBzdWJJZC50b1N0cmlu\nZ1V0ZjgoKSArICIpIHdoZW4gbG9zaW5nIHRvcGljIik7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAobnVsbCAhPSBkbSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGRtLnN0b3BTZXJ2aW5nU3Vic2NyaWJlcih0b3BpYywgc3ViSWQs\nIFN1YnNjcmlwdGlvbkV2ZW50LlRPUElDX01PVkVELAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBu\nb29wQ2FsbGJhY2ssIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1\nZ0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIu\nZGVidWcoIlN0b3Agc2VydmluZyB0b3BpYyAiICsgdG9waWMudG9TdHJpbmdV\ndGY4KCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAvLyBTaW5jZSB3ZSBkZWNyZW1lbnQgbG9jYWwgY291bnQgd2hlbiBz\nb21lIG9mIHJlbW90ZSBzdWJzY3JpcHRpb25zIGZhaWxlZCwKICAgICAgICAg\nICAgICAgICAgICAvLyB3aGlsZSB3ZSBkb24ndCB1bnN1YnNjcmliZSB0aG9z\nZSBzdWNjZWVkIHN1YnNjcmlwdGlvbnMuIHNvIHdlIGNhbid0IGRlcGVuZHMK\nICAgICAgICAgICAgICAgICAgICAvLyBvbiBsb2NhbCBjb3VudCwganVzdCB0\ncnkgdG8gbm90aWZ5IHVuc3Vic2NyaWJlLgogICAgICAgICAgICAgICAgICAg\nIG5vdGlmeUxhc3RMb2NhbFVuc3Vic2NyaWJlKHRvcGljKTsKICAgICAgICAg\nICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBp\nZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAg\nIGxvZ2dlci5kZWJ1ZygiVHJ5IHRvIHVwZGF0ZSBzdWJzY3JpcHRpb24gc3Rh\ndGVzIHdoZW4gbG9zaW5nIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXBkYXRlU3Vic2NyaXB0\naW9uU3RhdGVzKHRvcGljLCBmaW5hbENiLCBjdHgpOwogICAgICAgIH0KICAg\nIH0KCiAgICB2b2lkIHVwZGF0ZVN1YnNjcmlwdGlvblN0YXRlcyhCeXRlU3Ry\naW5nIHRvcGljLCBDYWxsYmFjazxWb2lkPiBmaW5hbENiLCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgLy8gVHJ5IHRvIHVwZGF0ZSBzdWJzY3JpcHRpb24gc3Rh\ndGVzIG9mIGEgc3BlY2lmaWVkIHRvcGljCiAgICAgICAgTWFwPEJ5dGVTdHJp\nbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHN0YXRlcyA9IHRvcDJz\ndWIyc2VxLmdldCh0b3BpYyk7CiAgICAgICAgaWYgKG51bGwgPT0gc3RhdGVz\nKSB7CiAgICAgICAgICAgIGZpbmFsQ2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4\nLCBudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBDYWxsYmFj\nazxWb2lkPiBtY2IgPSBDYWxsYmFja1V0aWxzLm11bHRpQ2FsbGJhY2soc3Rh\ndGVzLnNpemUoKSwgZmluYWxDYiwgY3R4KTsKICAgICAgICAgICAgZm9yIChF\nbnRyeTxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlPiBl\nbnRyeSA6IHN0YXRlcy5lbnRyeVNldCgpKSB7CiAgICAgICAgICAgICAgICBJ\nbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlIG1lbVN0YXRlID0gZW50cnkuZ2V0\nVmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChtZW1TdGF0ZS5zZXRMYXN0\nQ29uc3VtZVNlcUlkSW1tZWRpYXRlbHkoKSkgewogICAgICAgICAgICAgICAg\nICAgIHVwZGF0ZVN1YnNjcmlwdGlvblN0YXRlKHRvcGljLCBlbnRyeS5nZXRL\nZXkoKSwgbWVtU3RhdGUsIG1jYiwgY3R4KTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWNiLm9wZXJhdGlvbkZpbmlz\naGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhl\nIGxvY2FsIG1hcHBpbmcuCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgbG9zdFRvcGljKEJ5dGVTdHJpbmcgdG9waWMpIHsKICAgICAg\nICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgUmVsZWFzZU9w\nKHRvcGljLCBub29wQ2FsbGJhY2ssIG51bGwpKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgbm90aWZ5TGFzdExvY2FsVW5zdWJzY3JpYmUoQnl0ZVN0cmlu\nZyB0b3BpYykgewogICAgICAgIGZvciAoU3Vic2NyaXB0aW9uRXZlbnRMaXN0\nZW5lciBsaXN0ZW5lciA6IGxpc3RlbmVycykKICAgICAgICAgICAgbGlzdGVu\nZXIub25MYXN0TG9jYWxVbnN1YnNjcmliZSh0b3BpYyk7CiAgICB9CgogICAg\ncHJvdGVjdGVkIGFic3RyYWN0IHZvaWQgcmVhZFN1YnNjcmlwdGlvbnMoZmlu\nYWwgQnl0ZVN0cmluZyB0b3BpYywKICAgICAgICAgICAgZmluYWwgQ2FsbGJh\nY2s8TWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+\nPiBjYiwgZmluYWwgT2JqZWN0IGN0eCk7CiAgICAKICAgIHByb3RlY3RlZCBh\nYnN0cmFjdCB2b2lkIHJlYWRTdWJzY3JpcHRpb25EYXRhKGZpbmFsIEJ5dGVT\ndHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCAK\nICAgICAgICAgICAgZmluYWwgQ2FsbGJhY2s8SW5NZW1vcnlTdWJzY3JpcHRp\nb25TdGF0ZT4gY2IsIE9iamVjdCBjdHgpOwogICAgCiAgICBwcml2YXRlIGNs\nYXNzIFN1YnNjcmliZU9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hy\nb25vdXNPcDxTdWJzY3JpcHRpb25EYXRhPiB7CiAgICAgICAgU3Vic2NyaWJl\nUmVxdWVzdCBzdWJSZXF1ZXN0OwogICAgICAgIE1lc3NhZ2VTZXFJZCBjb25z\ndW1lU2VxSWQ7CgogICAgICAgIHB1YmxpYyBTdWJzY3JpYmVPcChCeXRlU3Ry\naW5nIHRvcGljLCBTdWJzY3JpYmVSZXF1ZXN0IHN1YlJlcXVlc3QsIE1lc3Nh\nZ2VTZXFJZCBjb25zdW1lU2VxSWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgIENhbGxiYWNrPFN1YnNjcmlwdGlvbkRhdGE+IGNhbGxiYWNrLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0b3BpYywgY2Fs\nbGJhY2ssIGN0eCk7CiAgICAgICAgICAgIHRoaXMuc3ViUmVxdWVzdCA9IHN1\nYlJlcXVlc3Q7CiAgICAgICAgICAgIHRoaXMuY29uc3VtZVNlcUlkID0gY29u\nc3VtZVNlcUlkOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIHZvaWQgcnVuKCkgewoKICAgICAgICAgICAgZmluYWwgTWFw\nPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHRvcGlj\nU3Vic2NyaXB0aW9ucyA9IHRvcDJzdWIyc2VxLmdldCh0b3BpYyk7CiAgICAg\nICAgICAgIGlmICh0b3BpY1N1YnNjcmlwdGlvbnMgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1\nYkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0\naW9uKCIiKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklk\nID0gc3ViUmVxdWVzdC5nZXRTdWJzY3JpYmVySWQoKTsKICAgICAgICAgICAg\nZmluYWwgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSBzdWJzY3JpcHRpb25T\ndGF0ZSA9IHRvcGljU3Vic2NyaXB0aW9ucy5nZXQoc3Vic2NyaWJlcklkKTsK\nICAgICAgICAgICAgQ3JlYXRlT3JBdHRhY2ggY3JlYXRlT3JBdHRhY2ggPSBz\ndWJSZXF1ZXN0LmdldENyZWF0ZU9yQXR0YWNoKCk7CgogICAgICAgICAgICBp\nZiAoc3Vic2NyaXB0aW9uU3RhdGUgIT0gbnVsbCkgewoKICAgICAgICAgICAg\nICAgIGlmIChjcmVhdGVPckF0dGFjaC5lcXVhbHMoQ3JlYXRlT3JBdHRhY2gu\nQ1JFQVRFKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBtc2cgPSAi\nVG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgc3Vic2NyaWJl\ncklkOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgIiByZXF1ZXN0ZWQgY3JlYXRp\nbmcgYSBzdWJzY3JpcHRpb24gYnV0IGl0IGlzIGFscmVhZHkgc3Vic2NyaWJl\nZCB3aXRoIHN0YXRlOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgU3Vic2NyaXB0aW9uU3RhdGVVdGlscy50b1N0cmluZyhzdWJzY3Jp\ncHRpb25TdGF0ZS5nZXRTdWJzY3JpcHRpb25TdGF0ZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIuZXJyb3IobXNnKTsKICAgICAgICAgICAgICAg\nICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0\naW9uLkNsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uKG1zZykpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICAvLyBTdWJzY3JpcHRpb24gZXhpc3RlZCBiZWZv\ncmUsIGNoZWNrIHdoZXRoZXIgbmV3IHByZWZlcmVuY2VzIHByb3ZpZGVkCiAg\nICAgICAgICAgICAgICAvLyBpZiBuZXcgcHJlZmVyZW5jZXMgcHJvdmlkZWQs\nIG1lcmdlZCB0aGUgc3Vic2NyaXB0aW9uIGRhdGEgYW5kIHVwZGF0ZWQgdGhl\nbQogICAgICAgICAgICAgICAgLy8gVE9ETzogbmVlZHMgQUNMIG1lY2hhbmlz\nbSB3aGVuIGNoYW5naW5nIHByZWZlcmVuY2VzCiAgICAgICAgICAgICAgICBp\nZiAoc3ViUmVxdWVzdC5oYXNQcmVmZXJlbmNlcygpICYmCiAgICAgICAgICAg\nICAgICAgICAgc3Vic2NyaXB0aW9uU3RhdGUudXBkYXRlUHJlZmVyZW5jZXMo\nc3ViUmVxdWVzdC5nZXRQcmVmZXJlbmNlcygpKSkgewogICAgICAgICAgICAg\nICAgICAgIHVwZGF0ZVN1YnNjcmlwdGlvblByZWZlcmVuY2VzKHRvcGljLCBz\ndWJzY3JpYmVySWQsIHN1YnNjcmlwdGlvblN0YXRlLCBuZXcgQ2FsbGJhY2s8\nVm9pZD4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25G\nYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFp\nbGVkKGN0eCwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVk\nKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dl\nci5kZWJ1ZygiVG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIg\nc3Vic2NyaWJlcklkOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgIiBhdHRhY2hpbmcgdG8gc3Vic2NyaXB0aW9uIHdpdGggc3RhdGU6ICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyBTdWJzY3JpcHRpb25TdGF0ZVV0aWxzLnRvU3RyaW5nKHN1YnNjcmlwdGlv\nblN0YXRlLmdldFN1YnNjcmlwdGlvblN0YXRlKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiwgd2l0aCBwcmVm\nZXJlbmNlczogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIFN1YnNjcmlwdGlvblN0YXRlVXRpbHMudG9TdHJpbmco\nc3Vic2NyaXB0aW9uU3RhdGUuZ2V0U3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMo\nKSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIG1lc3NhZ2UgYm91bmQgaWYg\nbmVjZXNzYXJ5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVN\nZXNzYWdlQm91bmQodG9waWMpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBzdWJzY3JpcHRpb25TdGF0\nZS50b1N1YnNjcmlwdGlvbkRhdGEoKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAvLyBvdGhlcndpc2UganVzdCBhdHRhY2gKICAgICAgICAgICAg\nICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiVG9waWM6ICIgKyB0b3BpYy50b1N0\ncmluZ1V0ZjgoKSArICIgc3Vic2NyaWJlcklkOiAiICsgc3Vic2NyaWJlcklk\nLnRvU3RyaW5nVXRmOCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgIiBhdHRhY2hpbmcgdG8gc3Vic2NyaXB0aW9uIHdpdGggc3RhdGU6\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBTdWJzY3Jp\ncHRpb25TdGF0ZVV0aWxzLnRvU3RyaW5nKHN1YnNjcmlwdGlvblN0YXRlLmdl\ndFN1YnNjcmlwdGlvblN0YXRlKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgIiwgd2l0aCBwcmVmZXJlbmNlczogIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIFN1YnNjcmlwdGlvblN0YXRlVXRp\nbHMudG9TdHJpbmcoc3Vic2NyaXB0aW9uU3RhdGUuZ2V0U3Vic2NyaXB0aW9u\nUHJlZmVyZW5jZXMoKSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgc3Vic2NyaXB0aW9u\nU3RhdGUudG9TdWJzY3JpcHRpb25EYXRhKCkpOwogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3ZSBkb24n\ndCBoYXZlIGEgbWFwcGluZyBmb3IgdGhpcyBzdWJzY3JpYmVyCiAgICAgICAg\nICAgIGlmIChjcmVhdGVPckF0dGFjaC5lcXVhbHMoQ3JlYXRlT3JBdHRhY2gu\nQVRUQUNIKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIG1zZyA9ICJUb3Bp\nYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiBzdWJzY3JpYmVySWQ6\nICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICArICIgcmVxdWVzdGVkIGF0dGFjaGluZyB0byBh\nbiBleGlzdGluZyBzdWJzY3JpcHRpb24gYnV0IGl0IGlzIG5vdCBzdWJzY3Jp\nYmVkIjsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihtc2cpOwogICAg\nICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1\nYkV4Y2VwdGlvbi5DbGllbnROb3RTdWJzY3JpYmVkRXhjZXB0aW9uKG1zZykp\nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBub3cgdGhlIGhhcmQgY2FzZSwgdGhpcyBpcyBhIGJyYW5k\nIG5ldyBzdWJzY3JpcHRpb24sIG11c3QgcmVjb3JkCiAgICAgICAgICAgIFN1\nYnNjcmlwdGlvblN0YXRlLkJ1aWxkZXIgc3RhdGVCdWlsZGVyID0gU3Vic2Ny\naXB0aW9uU3RhdGUubmV3QnVpbGRlcigpLnNldE1zZ0lkKGNvbnN1bWVTZXFJ\nZCk7CgogICAgICAgICAgICBTdWJzY3JpcHRpb25QcmVmZXJlbmNlcy5CdWls\nZGVyIHByZWZlcmVuY2VzQnVpbGRlcjsKICAgICAgICAgICAgaWYgKHN1YlJl\ncXVlc3QuaGFzUHJlZmVyZW5jZXMoKSkgewogICAgICAgICAgICAgICAgcHJl\nZmVyZW5jZXNCdWlsZGVyID0gU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMubmV3\nQnVpbGRlcihzdWJSZXF1ZXN0LmdldFByZWZlcmVuY2VzKCkpOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcHJlZmVyZW5jZXNCdWls\nZGVyID0gU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMubmV3QnVpbGRlcigpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBiYWNrd2FyZCBjb21wYWJp\nbGl0eQogICAgICAgICAgICBpZiAoc3ViUmVxdWVzdC5oYXNNZXNzYWdlQm91\nbmQoKSkgewogICAgICAgICAgICAgICAgcHJlZmVyZW5jZXNCdWlsZGVyID0g\ncHJlZmVyZW5jZXNCdWlsZGVyLnNldE1lc3NhZ2VCb3VuZChzdWJSZXF1ZXN0\nLmdldE1lc3NhZ2VCb3VuZCgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgU3Vic2NyaXB0aW9uRGF0YS5CdWlsZGVyIHN1YkRhdGFCdWlsZGVyID0K\nICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbkRhdGEubmV3QnVpbGRlcigp\nLnNldFN0YXRlKHN0YXRlQnVpbGRlcikuc2V0UHJlZmVyZW5jZXMocHJlZmVy\nZW5jZXNCdWlsZGVyKTsKICAgICAgICAgICAgZmluYWwgU3Vic2NyaXB0aW9u\nRGF0YSBzdWJEYXRhID0gc3ViRGF0YUJ1aWxkZXIuYnVpbGQoKTsKCiAgICAg\nICAgICAgIGNyZWF0ZVN1YnNjcmlwdGlvbkRhdGEodG9waWMsIHN1YnNjcmli\nZXJJZCwgc3ViRGF0YSwgbmV3IENhbGxiYWNrPFZlcnNpb24+KCkgewogICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMg\ndm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0\naW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJh\ndGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBmaW5h\nbCBWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICAgICAgICAgICAgICBDYWxs\nYmFjazxWb2lkPiBjYjIgPSBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoZmluYWwgT2Jq\nZWN0IGN0eCwgZmluYWwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJzdWJz\nY3JpcHRpb24gZm9yIHN1YnNjcmliZXIgIiArIHN1YnNjcmliZXJJZC50b1N0\ncmluZ1V0ZjgoKSArICIgdG8gdG9waWMgIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkg\nKyAiIGZhaWxlZCBkdWUgdG8gZmFpbGVkIGxpc3RlbmVyIGNhbGxiYWNrIiwg\nZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNo\nb3VsZCByZW1vdmUgc3Vic2NyaXB0aW9uIHdoZW4gc3luY2hyb25pemVkIGNy\nb3NzLXJlZ2lvbiBzdWJzY3JpcHRpb24gZmFpbGVkCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBkZWxldGVTdWJzY3JpcHRpb25EYXRhKHRvcGljLCBz\ndWJzY3JpYmVySWQsIHZlcnNpb24sIG5ldyBDYWxsYmFjazxWb2lkPigpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GaW5pc2hlZChPYmplY3QgY29udGV4dCwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIFZvaWQgcmVzdWx0T2ZPcGVyYXRp\nb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlu\naXNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkZhaWxlZChPYmplY3QgY29udGV4dCwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIFB1YlN1YkV4Y2VwdGlvbiBleCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3Io\nIlJlbW92ZSBzdWJzY3JpcHRpb24gZm9yIHN1YnNjcmliZXIgIiArIHN1YnNj\ncmliZXJJZC50b1N0cmluZ1V0ZjgoKSArICIgdG8gdG9waWMgIgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0\nb3BpYy50b1N0cmluZ1V0ZjgoKSArICIgZmFpbGVkIDogIiwgZXgpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5pc2goKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcHJpdmF0ZSB2b2lkIGZpbmlzaCgpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9u\nRmFpbGVkKGN0eCwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LCBj\ndHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9p\nZCByZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdG9waWNTdWJzY3JpcHRpb25zLnB1dChzdWJzY3JpYmVySWQsIG5l\ndyBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlKHN1YkRhdGEsIHZlcnNpb24p\nKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVNZXNzYWdl\nQm91bmQodG9waWMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNi\nLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgc3ViRGF0YSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAg\nICAgICAgICAgICAgICAgLy8gaWYgdGhpcyB3aWxsIGJlIHRoZSBmaXJzdCBs\nb2NhbCBzdWJzY3JpcHRpb24sIG5vdGlmeUZpcnN0TG9jYWxTdWJzY3JpYmUK\nICAgICAgICAgICAgICAgICAgICBpZiAoIVN1YnNjcmlwdGlvblN0YXRlVXRp\nbHMuaXNIdWJTdWJzY3JpYmVyKHN1YlJlcXVlc3QuZ2V0U3Vic2NyaWJlcklk\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICYmICFoYXNMb2NhbFN1YnNj\ncmlwdGlvbnModG9waWNTdWJzY3JpcHRpb25zKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbm90aWZ5Rmlyc3RMb2NhbFN1YnNjcmliZSh0b3BpYywgc3Vi\nUmVxdWVzdC5nZXRTeW5jaHJvbm91cygpLCBjYjIsIGN0eCk7CiAgICAgICAg\nICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICBjYjIu\nb3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgdGhlIGdpdmVuIHN1YnNjcmli\nZXJJZC10by1zdWJzY3JpYmVyU3RhdGUgbWFwIGNvbnRhaW5zIGEgbG9jYWwg\nc3Vic2NyaXB0aW9uOgogICAgICogdGhlIHZhc3QgbWFqb3JpdHkgb2Ygc3Vi\nc2NyaXB0aW9ucyBhcmUgbG9jYWwsIHNvIHdlIHdpbGwgcXVpY2tseSBlbmNv\ndW50ZXIgb25lIGlmIGl0IGV4aXN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBoYXNMb2NhbFN1YnNjcmlwdGlvbnMoTWFwPEJ5dGVT\ndHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHRvcGljU3Vic2Ny\naXB0aW9ucykgewogICAgICBmb3IgKEJ5dGVTdHJpbmcgc3ViSWQgOiB0b3Bp\nY1N1YnNjcmlwdGlvbnMua2V5U2V0KCkpCiAgICAgICAgaWYgKCFTdWJzY3Jp\ncHRpb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJJZCkpCiAgICAg\nICAgICByZXR1cm4gdHJ1ZTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoK\nICAgIHB1YmxpYyB2b2lkIHVwZGF0ZU1lc3NhZ2VCb3VuZChCeXRlU3RyaW5n\nIHRvcGljKSB7CiAgICAgICAgZmluYWwgTWFwPEJ5dGVTdHJpbmcsIEluTWVt\nb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHRvcGljU3Vic2NyaXB0aW9ucyA9IHRv\ncDJzdWIyc2VxLmdldCh0b3BpYyk7CiAgICAgICAgaWYgKHRvcGljU3Vic2Ny\naXB0aW9ucyA9PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CiAgICAgICAgaW50IG1heEJvdW5kID0gSW50ZWdlci5NSU5fVkFMVUU7\nCiAgICAgICAgZm9yIChNYXAuRW50cnk8Qnl0ZVN0cmluZywgSW5NZW1vcnlT\ndWJzY3JpcHRpb25TdGF0ZT4gZSA6IHRvcGljU3Vic2NyaXB0aW9ucy5lbnRy\neVNldCgpKSB7CiAgICAgICAgICAgIGlmICghZS5nZXRWYWx1ZSgpLmdldFN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzKCkuaGFzTWVzc2FnZUJvdW5kKCkpIHsK\nICAgICAgICAgICAgICAgIG1heEJvdW5kID0gSW50ZWdlci5NSU5fVkFMVUU7\nCiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIG1heEJvdW5kID0gTWF0aC5tYXgobWF4Qm91bmQs\nIGUuZ2V0VmFsdWUoKS5nZXRTdWJzY3JpcHRpb25QcmVmZXJlbmNlcygpLmdl\ndE1lc3NhZ2VCb3VuZCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAobWF4Qm91bmQgPT0gSW50ZWdlci5NSU5fVkFMVUUpIHsKICAg\nICAgICAgICAgcG0uY2xlYXJNZXNzYWdlQm91bmQodG9waWMpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHBtLnNldE1lc3NhZ2VCb3VuZCh0b3Bp\nYywgbWF4Qm91bmQpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIHNlcnZlU3Vic2NyaWJlUmVxdWVzdChCeXRlU3Ry\naW5nIHRvcGljLCBTdWJzY3JpYmVSZXF1ZXN0IHN1YlJlcXVlc3QsIE1lc3Nh\nZ2VTZXFJZCBjb25zdW1lU2VxSWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQ2FsbGJhY2s8U3Vic2NyaXB0aW9uRGF0YT4gY2Fs\nbGJhY2ssIE9iamVjdCBjdHgpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1h\neWJlUnVuKHRvcGljLCBuZXcgU3Vic2NyaWJlT3AodG9waWMsIHN1YlJlcXVl\nc3QsIGNvbnN1bWVTZXFJZCwgY2FsbGJhY2ssIGN0eCkpOwogICAgfQoKICAg\nIHByaXZhdGUgY2xhc3MgQ29uc3VtZU9wIGV4dGVuZHMgVG9waWNPcFF1ZXVl\nci5Bc3luY2hyb25vdXNPcDxWb2lkPiB7CiAgICAgICAgQnl0ZVN0cmluZyBz\ndWJzY3JpYmVySWQ7CiAgICAgICAgTWVzc2FnZVNlcUlkIGNvbnN1bWVTZXFJ\nZDsKCiAgICAgICAgcHVibGljIENvbnN1bWVPcChCeXRlU3RyaW5nIHRvcGlj\nLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgTWVzc2FnZVNlcUlkIGNvbnN1\nbWVTZXFJZCwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssCiAgICAgICAgICAg\nICAgICAgICAgICAgICBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVl\nci5zdXBlcih0b3BpYywgY2FsbGJhY2ssIGN0eCk7CiAgICAgICAgICAgIHRo\naXMuc3Vic2NyaWJlcklkID0gc3Vic2NyaWJlcklkOwogICAgICAgICAgICB0\naGlzLmNvbnN1bWVTZXFJZCA9IGNvbnN1bWVTZXFJZDsKICAgICAgICB9Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0\naW9uU3RhdGU+IHRvcGljU3VicyA9IHRvcDJzdWIyc2VxLmdldCh0b3BpYyk7\nCiAgICAgICAgICAgIGlmICh0b3BpY1N1YnMgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgZmluYWwgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSBzdWJTdGF0ZSA9\nIHRvcGljU3Vicy5nZXQoc3Vic2NyaWJlcklkKTsKICAgICAgICAgICAgaWYg\nKHN1YlN0YXRlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJh\ndGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdWJTdGF0ZS5z\nZXRMYXN0Q29uc3VtZVNlcUlkKGNvbnN1bWVTZXFJZCwgY2ZnLmdldENvbnN1\nbWVJbnRlcnZhbCgpKSkgewogICAgICAgICAgICAgICAgdXBkYXRlU3Vic2Ny\naXB0aW9uU3RhdGUodG9waWMsIHN1YnNjcmliZXJJZCwgc3ViU3RhdGUsIG5l\ndyBDYWxsYmFjazxWb2lkPigpIHsKICAgICAgICAgICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRp\nb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdE9mT3BlcmF0aW9u\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YlN0YXRlLnNldExhc3RQ\nZXJzaXN0ZWRTZXFJZChjb25zdW1lU2VxSWQuZ2V0TG9jYWxDb21wb25lbnQo\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlz\naGVkKGN0eCwgcmVzdWx0T2ZPcGVyYXRpb24pOwogICAgICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVj\ndCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0\naW9uKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nLCBjdHgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\naWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmRlYnVnKCJPbmx5IGFkdmFuY2VkIGNvbnN1bWUgcG9p\nbnRlciBpbiBtZW1vcnksIHdpbGwgcGVyc2lzdCBsYXRlciwgdG9waWM6ICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0\ncmluZ1V0ZjgoKSArICIgc3Vic2NyaWJlcklkOiAiICsgc3Vic2NyaWJlcklk\nLnRvU3RyaW5nVXRmOCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgIiBwZXJzaXN0ZW50U3RhdGU6ICIgKyBTdWJzY3JpcHRpb25TdGF0\nZVV0aWxzLnRvU3RyaW5nKHN1YlN0YXRlLmdldFN1YnNjcmlwdGlvblN0YXRl\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBpbi1t\nZW1vcnkgY29uc3VtZS1pZDogIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArIE1lc3NhZ2VJZFV0aWxzLm1zZ0lkVG9SZWFkYWJsZVN0cmlu\nZyhzdWJTdGF0ZS5nZXRMYXN0Q29uc3VtZVNlcUlkKCkpKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVk\nKGN0eCwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gdGVs\nbCBkZWxpdmVyeSBtYW5hZ2UgYWJvdXQgdGhlIGNvbnN1bWUgZXZlbnQKICAg\nICAgICAgICAgaWYgKG51bGwgIT0gZG0pIHsKICAgICAgICAgICAgICAgIGRt\nLm1lc3NhZ2VDb25zdW1lZCh0b3BpYywgc3Vic2NyaWJlcklkLCBjb25zdW1l\nU2VxSWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0Q29uc3VtZVNlcUlkRm9yU3Vi\nc2NyaWJlcihCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmli\nZXJJZCwgTWVzc2FnZVNlcUlkIGNvbnN1bWVTZXFJZCwKICAgICAgICAgICAg\nQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjdHgpIHsKICAgICAg\nICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgQ29uc3VtZU9w\nKHRvcGljLCBzdWJzY3JpYmVySWQsIGNvbnN1bWVTZXFJZCwgY2FsbGJhY2ss\nIGN0eCkpOwogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQ2xvc2VTdWJzY3Jp\ncHRpb25PcCBleHRlbmRzIFRvcGljT3BRdWV1ZXIuQXN5bmNocm9ub3VzT3A8\nVm9pZD4gewoKICAgICAgICBwdWJsaWMgQ2xvc2VTdWJzY3JpcHRpb25PcChC\neXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lk\nPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBxdWV1ZXIu\nc3VwZXIodG9waWMsIGNhbGxiYWNrLCBjdHgpOwogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAg\nICAgICAgICAvLyBUT0RPOiBCT09LS0VFUEVSLTQxMjogd2UgbWlnaHQgbmVl\nZCB0byBtb3ZlIHRoZSBsb2FkZWQgc3Vic2NyaXB0aW9uCiAgICAgICAgICAg\nIC8vICAgICAgICAgICAgICAgICAgICAgICB0byByZWNsYWltIG1lbW9yeQog\nICAgICAgICAgICAvLyBCdXQgZm9yIG5vdyB3ZSBkbyBub3RoaW5nCiAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAg\nICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY2xv\nc2VTdWJzY3JpcHRpb24oQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBz\ndWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewogICAg\nICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBDbG9zZVN1\nYnNjcmlwdGlvbk9wKHRvcGljLCBzdWJzY3JpYmVySWQsIGNhbGxiYWNrLCBj\ndHgpKTsKICAgIH0KCiAgICBwcml2YXRlIGNsYXNzIFVuc3Vic2NyaWJlT3Ag\nZXh0ZW5kcyBUb3BpY09wUXVldWVyLkFzeW5jaHJvbm91c09wPFZvaWQ+IHsK\nICAgICAgICBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZDsKCiAgICAgICAgcHVi\nbGljIFVuc3Vic2NyaWJlT3AoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmlu\nZyBzdWJzY3JpYmVySWQsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0b3BpYywgY2Fs\nbGJhY2ssIGN0eCk7CiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlcklkID0g\nc3Vic2NyaWJlcklkOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICBmaW5hbCBN\nYXA8Qnl0ZVN0cmluZywgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZT4gdG9w\naWNTdWJzY3JpcHRpb25zID0gdG9wMnN1YjJzZXEuZ2V0KHRvcGljKTsKICAg\nICAgICAgICAgaWYgKHRvcGljU3Vic2NyaXB0aW9ucyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9waWNFeGNl\ncHRpb24oIiIpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKCF0b3BpY1N1YnNjcmlwdGlvbnMuY29u\ndGFpbnNLZXkoc3Vic2NyaWJlcklkKSkgewogICAgICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5DbGll\nbnROb3RTdWJzY3JpYmVkRXhjZXB0aW9uKCIiKSk7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAg\nICAgIGRlbGV0ZVN1YnNjcmlwdGlvbkRhdGEodG9waWMsIHN1YnNjcmliZXJJ\nZCwgdG9waWNTdWJzY3JpcHRpb25zLmdldChzdWJzY3JpYmVySWQpLmdldFZl\ncnNpb24oKSwKICAgICAgICAgICAgICAgICAgICBuZXcgQ2FsbGJhY2s8Vm9p\nZD4oKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQ\ndWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0aW9uKTsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVj\ndCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAg\nICAgICAgICB0b3BpY1N1YnNjcmlwdGlvbnMucmVtb3ZlKHN1YnNjcmliZXJJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgLy8gTm90aWZ5IGxpc3RlbmVycyBp\nZiBuZWNlc3NhcnkuCiAgICAgICAgICAgICAgICAgICAgaWYgKCFTdWJzY3Jp\ncHRpb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJzY3JpYmVySWQp\nCiAgICAgICAgICAgICAgICAgICAgICAgICYmICFoYXNMb2NhbFN1YnNjcmlw\ndGlvbnModG9waWNTdWJzY3JpcHRpb25zKSkKICAgICAgICAgICAgICAgICAg\nICAgICAgbm90aWZ5TGFzdExvY2FsVW5zdWJzY3JpYmUodG9waWMpOwoKICAg\nICAgICAgICAgICAgICAgICB1cGRhdGVNZXNzYWdlQm91bmQodG9waWMpOwog\nICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwg\nbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGN0eCk7\nCgogICAgICAgIH0KCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCB1bnN1YnNjcmliZShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5n\nIHN1YnNjcmliZXJJZCwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVj\ndCBjdHgpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGlj\nLCBuZXcgVW5zdWJzY3JpYmVPcCh0b3BpYywgc3Vic2NyaWJlcklkLCBjYWxs\nYmFjaywgY3R4KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3QgdGhyZWFk\nLXNhZmUuCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\nYWRkTGlzdGVuZXIoU3Vic2NyaXB0aW9uRXZlbnRMaXN0ZW5lciBsaXN0ZW5l\ncikgewogICAgICAgIGxpc3RlbmVycy5hZGQobGlzdGVuZXIpOwogICAgfQoK\nICAgIC8qKgogICAgICogTWV0aG9kIHRvIHN0b3AgdGhpcyBjbGFzcyBncmFj\nZWZ1bGx5IGluY2x1ZGluZyByZWxlYXNpbmcgYW55IHJlc291cmNlcwogICAg\nICogdXNlZCBhbmQgc3RvcHBpbmcgYWxsIHRocmVhZHMgc3Bhd25lZC4KICAg\nICAqLwogICAgcHVibGljIHZvaWQgc3RvcCgpIHsKICAgICAgICB0aW1lci5j\nYW5jZWwoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmaW5hbCBMaW5r\nZWRCbG9ja2luZ1F1ZXVlPEJvb2xlYW4+IHF1ZXVlID0gbmV3IExpbmtlZEJs\nb2NraW5nUXVldWU8Qm9vbGVhbj4oKTsKICAgICAgICAgICAgLy8gdXBkYXRl\nIGRpcnR5IHN1YnNjcmlwdGlvbnMKICAgICAgICAgICAgZm9yIChCeXRlU3Ry\naW5nIHRvcGljIDogdG9wMnN1YjJzZXEua2V5U2V0KCkpIHsKICAgICAgICAg\nICAgICAgIENhbGxiYWNrPFZvaWQ+IGZpbmFsQ2IgPSBuZXcgQ2FsbGJhY2s8\nVm9pZD4oKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQo\nT2JqZWN0IGN0eCwgVm9pZCByZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAg\nICAgICAgICAgICAgICAgICBDb25jdXJyZW5jeVV0aWxzLnB1dChxdWV1ZSwg\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAg\nICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW5jeVV0aWxzLnB1dChxdWV1\nZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH07CiAgICAgICAgICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb25TdGF0\nZXModG9waWMsIGZpbmFsQ2IsIG51bGwpOwogICAgICAgICAgICAgICAgcXVl\ndWUudGFrZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoSW50\nZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgbG9nZ2VyLndh\ncm4oIkVycm9yIGR1cmluZyB1cGRhdGluZyBzdWJzY3JpcHRpb24gc3RhdGVz\nIDogIiwgaWUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQg\ndXBkYXRlU3Vic2NyaXB0aW9uU3RhdGUoZmluYWwgQnl0ZVN0cmluZyB0b3Bp\nYywgZmluYWwgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgSW5NZW1vcnlT\ndWJzY3JpcHRpb25TdGF0ZSBzdGF0ZSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYWxs\nYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgIFN1YnNjcmlwdGlvbkRhdGEg\nc3ViRGF0YTsKICAgICAgICBDYWxsYmFjazxWZXJzaW9uPiBjYiA9IG5ldyBD\nYWxsYmFjazxWZXJzaW9uPigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVj\ndCBjdHgsIFZlcnNpb24gdmVyc2lvbikgewogICAgICAgICAgICAgICAgc3Rh\ndGUuc2V0VmVyc2lvbih2ZXJzaW9uKTsKICAgICAgICAgICAgICAgIGNhbGxi\nYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRp\nb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoZXhjZXB0aW9u\nIGluc3RhbmNlb2YgUHViU3ViRXhjZXB0aW9uLkJhZFZlcnNpb25FeGNlcHRp\nb24pIHsKICAgICAgICAgICAgICAgICAgICByZWFkU3Vic2NyaXB0aW9uRGF0\nYSh0b3BpYywgc3Vic2NyaWJlcklkLCBuZXcgQ2FsbGJhY2s8SW5NZW1vcnlT\ndWJzY3JpcHRpb25TdGF0ZT4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGUg\ncmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHN0YXRlLnNldFZlcnNpb24ocmVzdWx0T2ZPcGVyYXRpb24uZ2V0VmVy\nc2lvbigpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN1\nYnNjcmlwdGlvblN0YXRlKHRvcGljLCBzdWJzY3JpYmVySWQsIHN0YXRlLCBj\nYWxsYmFjaywgY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBj\ndHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHViU3ViRXhj\nZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0aW9uKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0sIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAg\nICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7\nCiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGlmIChpc1BhcnRp\nYWxVcGRhdGVTdXBwb3J0ZWQoKSkgewogICAgICAgICAgICBzdWJEYXRhID0g\nU3Vic2NyaXB0aW9uRGF0YS5uZXdCdWlsZGVyKCkuc2V0U3RhdGUoc3RhdGUu\nZ2V0U3Vic2NyaXB0aW9uU3RhdGUoKSkuYnVpbGQoKTsKICAgICAgICAgICAg\ndXBkYXRlU3Vic2NyaXB0aW9uRGF0YSh0b3BpYywgc3Vic2NyaWJlcklkLCBz\ndWJEYXRhLCBzdGF0ZS5nZXRWZXJzaW9uKCksIGNiLCBjdHgpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHN1YkRhdGEgPSBzdGF0ZS50b1N1YnNj\ncmlwdGlvbkRhdGEoKTsKICAgICAgICAgICAgcmVwbGFjZVN1YnNjcmlwdGlv\nbkRhdGEodG9waWMsIHN1YnNjcmliZXJJZCwgc3ViRGF0YSwgc3RhdGUuZ2V0\nVmVyc2lvbigpLCBjYiwgY3R4KTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIHVwZGF0ZVN1YnNjcmlwdGlvblByZWZlcmVuY2VzKGZpbmFs\nIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZpbmFsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGUgc3RhdGUs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZmluYWwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjdHgp\nIHsKICAgICAgICBTdWJzY3JpcHRpb25EYXRhIHN1YkRhdGE7CiAgICAgICAg\nQ2FsbGJhY2s8VmVyc2lvbj4gY2IgPSBuZXcgQ2FsbGJhY2s8VmVyc2lvbj4o\nKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWZXJzaW9uIHZl\ncnNpb24pIHsKICAgICAgICAgICAgICAgIHN0YXRlLnNldFZlcnNpb24odmVy\nc2lvbik7CiAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5p\nc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWls\nZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewog\nICAgICAgICAgICAgICAgaWYgKGV4Y2VwdGlvbiBpbnN0YW5jZW9mIFB1YlN1\nYkV4Y2VwdGlvbi5CYWRWZXJzaW9uRXhjZXB0aW9uKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmVhZFN1YnNjcmlwdGlvbkRhdGEodG9waWMsIHN1YnNjcmli\nZXJJZCwgbmV3IENhbGxiYWNrPEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+\nKCkgewogICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNo\nZWQoT2JqZWN0IGN0eCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlIHJlc3VsdE9mT3BlcmF0aW9u\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5zZXRWZXJz\naW9uKHJlc3VsdE9mT3BlcmF0aW9uLmdldFZlcnNpb24oKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb25QcmVmZXJl\nbmNlcyh0b3BpYywgc3Vic2NyaWJlcklkLCBzdGF0ZSwgY2FsbGJhY2ssIGN0\neCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIFB1YlN1YkV4Y2VwdGlvbiBleGNl\ncHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNr\nLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBjdHgpOwog\nICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgIH0gCiAgICAgICAgICAgICAgICBjYWxsYmFj\nay5vcGVyYXRpb25GYWlsZWQoY3R4LCBleGNlcHRpb24pOwogICAgICAgICAg\nICB9CiAgICAgICAgfTsKICAgICAgICBpZiAoaXNQYXJ0aWFsVXBkYXRlU3Vw\ncG9ydGVkKCkpIHsKICAgICAgICAgICAgc3ViRGF0YSA9IFN1YnNjcmlwdGlv\nbkRhdGEubmV3QnVpbGRlcigpLnNldFByZWZlcmVuY2VzKHN0YXRlLmdldFN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzKCkpLmJ1aWxkKCk7CiAgICAgICAgICAg\nIHVwZGF0ZVN1YnNjcmlwdGlvbkRhdGEodG9waWMsIHN1YnNjcmliZXJJZCwg\nc3ViRGF0YSwgc3RhdGUuZ2V0VmVyc2lvbigpLCBjYiwgY3R4KTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICBzdWJEYXRhID0gc3RhdGUudG9TdWJz\nY3JpcHRpb25EYXRhKCk7CiAgICAgICAgICAgIHJlcGxhY2VTdWJzY3JpcHRp\nb25EYXRhKHRvcGljLCBzdWJzY3JpYmVySWQsIHN1YkRhdGEsIHN0YXRlLmdl\ndFZlcnNpb24oKSwgY2IsIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBib29sZWFuIGlzUGFydGlhbFVwZGF0ZVN1cHBv\ncnRlZCgpOwoKICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIGNyZWF0ZVN1\nYnNjcmlwdGlvbkRhdGEoZmluYWwgQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0\ncmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgIFN1YnNjcmlwdGlvbkRh\ndGEgZGF0YSwgQ2FsbGJhY2s8VmVyc2lvbj4gY2FsbGJhY2ssIE9iamVjdCBj\ndHgpOwoKICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIHVwZGF0ZVN1YnNj\ncmlwdGlvbkRhdGEoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQsIFN1YnNjcmlwdGlvbkRhdGEgZGF0YSwKICAgICAgICAgICAg\nVmVyc2lvbiB2ZXJzaW9uLCBDYWxsYmFjazxWZXJzaW9uPiBjYWxsYmFjaywg\nT2JqZWN0IGN0eCk7CgogICAgcHJvdGVjdGVkIGFic3RyYWN0IHZvaWQgcmVw\nbGFjZVN1YnNjcmlwdGlvbkRhdGEoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0\ncmluZyBzdWJzY3JpYmVySWQsIFN1YnNjcmlwdGlvbkRhdGEgZGF0YSwKICAg\nICAgICAgICAgVmVyc2lvbiB2ZXJzaW9uLCBDYWxsYmFjazxWZXJzaW9uPiBj\nYWxsYmFjaywgT2JqZWN0IGN0eCk7CgogICAgcHJvdGVjdGVkIGFic3RyYWN0\nIHZvaWQgZGVsZXRlU3Vic2NyaXB0aW9uRGF0YShCeXRlU3RyaW5nIHRvcGlj\nLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgVmVyc2lvbiB2ZXJzaW9uLCBD\nYWxsYmFjazxWb2lkPiBjYWxsYmFjaywKICAgICAgICAgICAgT2JqZWN0IGN0\neCk7Cgp9Cg==\n","encoding":"base64"}

