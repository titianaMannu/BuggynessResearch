{"sha":"dbec795db46d7574b3866658a0e90f40acf91d81","node_id":"MDQ6QmxvYjE1NzU5NTY6ZGJlYzc5NWRiNDZkNzU3NGIzODY2NjU4YTBlOTBmNDBhY2Y5MWQ4MQ==","size":16228,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/dbec795db46d7574b3866658a0e90f40acf91d81","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnRvcGljczsK\nCmltcG9ydCBqYXZhLm5ldC5Vbmtub3duSG9zdEV4Y2VwdGlvbjsKaW1wb3J0\nIGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5TeW5jaHJvbm91c1F1ZXVlOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudmVyc2lvbmluZy5WZXJzaW9uZWQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24u\nU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnNlcnZlci5tZXRhLk1ldGFkYXRhTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIubWV0YS5Ub3BpY093bmVyc2hpcE1h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNr\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5Db25jdXJyZW5jeVV0\naWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5FaXRoZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJl\nc3M7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7Cgpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZzsKLyoqCiAqIFRvcGljT3duZXJzaGlwTWFuYWdlciBiYXNlZCB0b3Bp\nYyBtYW5hZ2VyCiAqLwpwdWJsaWMgY2xhc3MgTU1Ub3BpY01hbmFnZXIgZXh0\nZW5kcyBBYnN0cmFjdFRvcGljTWFuYWdlciBpbXBsZW1lbnRzIFRvcGljTWFu\nYWdlciB7CgogICAgc3RhdGljIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0\nb3J5LmdldExvZ2dlcihNTVRvcGljTWFuYWdlci5jbGFzcyk7CgogICAgLy8g\ndG9waWMgb3duZXJzaGlwIG1hbmFnZXIKICAgIHByaXZhdGUgZmluYWwgVG9w\naWNPd25lcnNoaXBNYW5hZ2VyIG1tOwogICAgLy8gaHViIHNlcnZlciBtYW5h\nZ2VyCiAgICBwcml2YXRlIGZpbmFsIEh1YlNlcnZlck1hbmFnZXIgaHViTWFu\nYWdlcjsKCiAgICBwcml2YXRlIGZpbmFsIEh1YkluZm8gbXlIdWJJbmZvOwog\nICAgcHJpdmF0ZSBmaW5hbCBIdWJMb2FkIG15SHViTG9hZDsKCiAgICAvLyBC\nb29sZWFuIGZsYWcgaW5kaWNhdGluZyBpZiB3ZSBzaG91bGQgc3VzcGVuZCBh\nY3Rpdml0eS4gSWYgdGhpcyBpcyB0cnVlLAogICAgLy8gYWxsIG9mIHRoZSBP\ncHMgcHV0IGludG8gdGhlIHF1ZXVlciB3aWxsIGZhaWwgYXV0b21hdGljYWxs\neS4KICAgIHByb3RlY3RlZCB2b2xhdGlsZSBib29sZWFuIGlzU3VzcGVuZGVk\nID0gZmFsc2U7CgogICAgcHVibGljIE1NVG9waWNNYW5hZ2VyKFNlcnZlckNv\nbmZpZ3VyYXRpb24gY2ZnLCBab29LZWVwZXIgemssIAogICAgICAgICAgICAg\nICAgICAgICAgICAgIE1ldGFkYXRhTWFuYWdlckZhY3RvcnkgbW1GYWN0b3J5\nLAogICAgICAgICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlZEV4ZWN1dG9y\nU2VydmljZSBzY2hlZHVsZXIpCiAgICAgICAgICAgIHRocm93cyBVbmtub3du\nSG9zdEV4Y2VwdGlvbiwgUHViU3ViRXhjZXB0aW9uIHsKICAgICAgICBzdXBl\ncihjZmcsIHNjaGVkdWxlcik7CiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0b3Bp\nYyBvd25lcnNoaXAgbWFuYWdlcgogICAgICAgIHRoaXMubW0gPSBtbUZhY3Rv\ncnkubmV3VG9waWNPd25lcnNoaXBNYW5hZ2VyKCk7CiAgICAgICAgdGhpcy5o\ndWJNYW5hZ2VyID0gbmV3IFprSHViU2VydmVyTWFuYWdlcihjZmcsIHprLCBh\nZGRyKTsKCiAgICAgICAgZmluYWwgU3luY2hyb25vdXNRdWV1ZTxFaXRoZXI8\nSHViSW5mbywgUHViU3ViRXhjZXB0aW9uPj4gcXVldWUgPQogICAgICAgICAg\nICBuZXcgU3luY2hyb25vdXNRdWV1ZTxFaXRoZXI8SHViSW5mbywgUHViU3Vi\nRXhjZXB0aW9uPj4oKTsKCiAgICAgICAgbXlIdWJMb2FkID0gbmV3IEh1Ykxv\nYWQodG9waWNzLnNpemUoKSk7CiAgICAgICAgdGhpcy5odWJNYW5hZ2VyLnJl\nZ2lzdGVyTGlzdGVuZXIobmV3IEh1YlNlcnZlck1hbmFnZXIuTWFuYWdlckxp\nc3RlbmVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgb25TdXNwZW5kKCkgewogICAgICAgICAgICAgICAgaXNT\ndXNwZW5kZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvblJlc3VtZSgpIHsK\nICAgICAgICAgICAgICAgIGlzU3VzcGVuZGVkID0gZmFsc2U7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIG9uU2h1dGRvd24oKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBo\ndWIgc2VydmVyIG1hbmFnZXIgY2FuJ3Qgd29yaywgd2UgaGFkIHRvIHF1aXQK\nICAgICAgICAgICAgICAgIFJ1bnRpbWUuZ2V0UnVudGltZSgpLmV4aXQoMSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLmh1Yk1h\nbmFnZXIucmVnaXN0ZXJTZWxmKG15SHViTG9hZCwgbmV3IENhbGxiYWNrPEh1\nYkluZm8+KCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoZmluYWwgT2JqZWN0IGN0\neCwgZmluYWwgSHViSW5mbyByZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAg\nICAgICAgICAgbG9nZ2VyLmluZm8oIlN1Y2Nlc3NmdWxseSByZWdpc3RlcmVk\nIGh1YiB7fSB3aXRoIHpvb2tlZXBlciIsIHJlc3VsdE9mT3BlcmF0aW9uKTsK\nICAgICAgICAgICAgICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KHF1ZXVlLCBF\naXRoZXIub2YocmVzdWx0T2ZPcGVyYXRpb24sIChQdWJTdWJFeGNlcHRpb24p\nIG51bGwpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVj\ndCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAg\nICAgICAgIGxvZ2dlci5lcnJvcigiRmFpbGVkIHRvIHJlZ2lzdGVyIGh1YiB3\naXRoIHpvb2tlZXBlciIsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICBD\nb25jdXJyZW5jeVV0aWxzLnB1dChxdWV1ZSwgRWl0aGVyLm9mKChIdWJJbmZv\nKW51bGwsIGV4Y2VwdGlvbikpOwogICAgICAgICAgICB9CiAgICAgICAgfSwg\nbnVsbCk7CiAgICAgICAgRWl0aGVyPEh1YkluZm8sIFB1YlN1YkV4Y2VwdGlv\nbj4gcmVzdWx0ID0gQ29uY3VycmVuY3lVdGlscy50YWtlKHF1ZXVlKTsKICAg\nICAgICBQdWJTdWJFeGNlcHRpb24gcHNlID0gcmVzdWx0LnJpZ2h0KCk7CiAg\nICAgICAgaWYgKHBzZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IHBz\nZTsKICAgICAgICB9CiAgICAgICAgbXlIdWJJbmZvID0gcmVzdWx0LmxlZnQo\nKTsKICAgICAgICBsb2dnZXIuaW5mbygiU3RhcnQgbWV0YWRhdGEgbWFuYWdl\nciBiYXNlZCB0b3BpYyBtYW5hZ2VyIHdpdGggaHViIGlkIDogIiArIG15SHVi\nSW5mbyk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9p\nZCByZWFsR2V0T3duZXIoZmluYWwgQnl0ZVN0cmluZyB0b3BpYywgZmluYWwg\nYm9vbGVhbiBzaG91bGRDbGFpbSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmaW5hbCBDYWxsYmFjazxIZWR3aWdTb2NrZXRBZGRyZXNzPiBj\nYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIC8vIElmIG9wZXJhdGlv\nbnMgYXJlIHN1c3BlbmRlZCBkdWUgdG8gYSBaSyBjbGllbnQgZGlzY29ubmVj\ndCwganVzdCBlcnJvcgogICAgICAgIC8vIG91dCB0aGlzIGNhbGwgYW5kIHJl\ndHVybi4KICAgICAgICBpZiAoaXNTdXNwZW5kZWQpIHsKICAgICAgICAgICAg\nY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5T\nZXJ2aWNlRG93bkV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIk1NVG9waWNNYW5hZ2VyIHNlcnZpY2UgaXMgdGVtcG9y\nYXJpbHkgc3VzcGVuZGVkISIpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKHRvcGljcy5jb250YWlucyh0b3BpYykpIHsK\nICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBhZGRyKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgbmV3IE1N\nR2V0T3duZXJPcCh0b3BpYywgY2IsIGN0eCkucmVhZCgpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWV0YWRhdGFNYW5hZ2VyIGRvIHRvcGljIGxlZGdlciBl\nbGVjdGlvbiB1c2luZyB2ZXJzaW9uZWQgd3JpdGVzLgogICAgICovCiAgICBj\nbGFzcyBNTUdldE93bmVyT3AgewogICAgICAgIEJ5dGVTdHJpbmcgdG9waWM7\nCiAgICAgICAgQ2FsbGJhY2s8SGVkd2lnU29ja2V0QWRkcmVzcz4gY2I7CiAg\nICAgICAgT2JqZWN0IGN0eDsKCiAgICAgICAgcHVibGljIE1NR2V0T3duZXJP\ncChCeXRlU3RyaW5nIHRvcGljLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgQ2FsbGJhY2s8SGVkd2lnU29ja2V0QWRkcmVzcz4gY2IsIE9iamVjdCBj\ndHgpIHsKICAgICAgICAgICAgdGhpcy50b3BpYyA9IHRvcGljOwogICAgICAg\nICAgICB0aGlzLmNiID0gY2I7CiAgICAgICAgICAgIHRoaXMuY3R4ID0gY3R4\nOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgcmVhZCgpIHsK\nICAgICAgICAgICAgbW0ucmVhZE93bmVySW5mbyh0b3BpYywgbmV3IENhbGxi\nYWNrPFZlcnNpb25lZDxIdWJJbmZvPj4oKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkZpbmlzaGVkKGZpbmFsIE9iamVjdCBjdHgsIGZpbmFsIFZlcnNpb25lZDxI\ndWJJbmZvPiBvd25lcikgewogICAgICAgICAgICAgICAgICAgIGlmIChudWxs\nID09IG93bmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5p\nbmZvKCJ7fSA6IE5vIG93bmVyIGZvdW5kIGZvciB0b3BpYyB7fSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7\nIGFkZHIsIHRvcGljLnRvU3RyaW5nVXRmOCgpIH0pOwogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBubyBkYXRhIGZvdW5kCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNob29zZShWZXJzaW9uLk5FVyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgZmluYWwgVmVyc2lvbiBvd25lclZlcnNpb24gPSBvd25l\nci5nZXRWZXJzaW9uKCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwg\nPT0gb3duZXIuZ2V0VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuaW5mbygie30gOiBJbnZhbGlkIG93bmVyIGZvdW5kIGZvciB0\nb3BpYyB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXSB7IGFkZHIsIHRvcGljLnRvU3RyaW5nVXRmOCgpIH0p\nOwogICAgICAgICAgICAgICAgICAgICAgICBjaG9vc2Uob3duZXJWZXJzaW9u\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBmaW5hbCBIdWJJbmZv\nIGh1YiA9IG93bmVyLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAg\nbG9nZ2VyLmluZm8oInt9IDogUmVhZCBvd25lciBvZiB0b3BpYyB7fSA6IHt9\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW10geyBhZGRyLCB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgaHViIH0pOwoKICAg\nICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygie30sIHt9IiwgbmV3IE9i\namVjdFtdIHsgaHViLCBteUh1YkluZm8gfSk7CgogICAgICAgICAgICAgICAg\nICAgIGlmIChodWIuZ2V0QWRkcmVzcygpLmVxdWFscyhhZGRyKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobXlIdWJJbmZvLmdldFp4aWQoKSA9\nPSBodWIuZ2V0WnhpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjbGFpbVRvcGljKGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjaG9vc2Uob3duZXJWZXJzaW9u\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oInt9IDogQ2hlY2sgd2hl\ndGhlciBvd25lciB7fSBmb3IgdG9waWMge30gaXMgc3RpbGwgYWxpdmUuIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W10g\neyBhZGRyLCBodWIsIHRvcGljLnRvU3RyaW5nVXRmOCgpIH0pOwogICAgICAg\nICAgICAgICAgICAgIGh1Yk1hbmFnZXIuaXNIdWJBbGl2ZShodWIsIG5ldyBD\nYWxsYmFjazxCb29sZWFuPigpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIEJvb2xlYW4gaXNBbGl2\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQWxpdmUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRp\nb25GaW5pc2hlZChjdHgsIGh1Yi5nZXRBZGRyZXNzKCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjaG9vc2Uob3duZXJWZXJzaW9uKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9i\namVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBwc2UpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIHBzZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9LCBjdHgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0\naW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRp\nb24pIHsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQo\nY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9u\nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ291\nbGQgbm90IHJlYWQgb3duZXJzaGlwIGZvciB0b3BpYyAiICsgdG9waWMudG9T\ndHJpbmdVdGY4KCkgKyAiIDogIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIGV4Y2VwdGlvbi5nZXRNZXNzYWdlKCkpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGNsYWltKGZpbmFsIFZlcnNpb24gcHJl\ndk93bmVyVmVyc2lvbikgewogICAgICAgICAgICBsb2dnZXIuaW5mbygie30g\nOiBjbGFpbWluZyB0b3BpYyB7fSAncyBvd25lciB0byBiZSB7fSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGFkZHIsIHRvcGlj\nLnRvU3RyaW5nVXRmOCgpLCBteUh1YkluZm8gfSk7CiAgICAgICAgICAgIG1t\nLndyaXRlT3duZXJJbmZvKHRvcGljLCBteUh1YkluZm8sIHByZXZPd25lclZl\ncnNpb24sIG5ldyBDYWxsYmFjazxWZXJzaW9uPigpIHsKICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVmVyc2lvbiBuZXdWZXJzaW9u\nKSB7CiAgICAgICAgICAgICAgICAgICAgY2xhaW1Ub3BpYyhjdHgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0\nIGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAg\nICAgICAgICAgIGlmIChleGNlcHRpb24gaW5zdGFuY2VvZiBQdWJTdWJFeGNl\ncHRpb24uTm9Ub3BpY093bmVySW5mb0V4Y2VwdGlvbiB8fAogICAgICAgICAg\nICAgICAgICAgICAgICBleGNlcHRpb24gaW5zdGFuY2VvZiBQdWJTdWJFeGNl\ncHRpb24uQmFkVmVyc2lvbkV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBzb21lIG9uZSBoYXMgdXBkYXRlZCB0aGUgb3duZXIKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oInt9IDogU29tZSBv\nbmUgaGFzIGNsYWltZWQgdG9waWMge30gJ3Mgb3duZXIuIFRyeSB0byByZWFk\nIHRoZSBvd25lciBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W10geyBhZGRyLCB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxl\nZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRp\nb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJF\neGNlcHRpb24gd2hlbiB3cml0aW5nIG93bmVyIGluZm8gdG8gY2xhaW0gb3du\nZXJzaGlwIG9mIHRvcGljICIKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgOiAiICsg\nZXhjZXB0aW9uLmdldE1lc3NhZ2UoKSkpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9LCBjdHgpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIHZvaWQgY2xhaW1Ub3BpYyhPYmplY3QgY3R4KSB7CiAgICAgICAgICAg\nIGxvZ2dlci5pbmZvKCJ7fSA6IGNsYWltZWQgdG9waWMge30gJ3Mgb3duZXIg\ndG8gYmUge30iLAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0\nW10geyBhZGRyLCB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgbXlIdWJJbmZvIH0p\nOwogICAgICAgICAgICBub3RpZnlMaXN0ZW5lcnNBbmRBZGRUb093bmVkVG9w\naWNzKHRvcGljLCBjYiwgY3R4KTsKICAgICAgICAgICAgaHViTWFuYWdlci51\ncGxvYWRTZWxmTG9hZERhdGEobXlIdWJMb2FkLnNldE51bVRvcGljcyh0b3Bp\nY3Muc2l6ZSgpKSk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBj\naG9vc2UoZmluYWwgVmVyc2lvbiBwcmV2T3duZXJWZXJzaW9uKSB7CiAgICAg\nICAgICAgIGh1Yk1hbmFnZXIuY2hvb3NlTGVhc3RMb2FkZWRIdWIobmV3IENh\nbGxiYWNrPEh1YkluZm8+KCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hl\nZChPYmplY3QgY3R4LCBIdWJJbmZvIG93bmVyKSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmluZm8oInt9IDogTGVhc3QgbG9hZGVkIG93bmVyIHt9\nIGlzIGNob3NlbiBmb3IgdG9waWMge30iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGFkZHIsIG93bmVyLCB0b3Bp\nYy50b1N0cmluZ1V0ZjgoKSB9KTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nb3duZXIuZ2V0QWRkcmVzcygpLmVxdWFscyhhZGRyKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBjbGFpbShwcmV2T3duZXJWZXJzaW9uKTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBzZXRPd25lcihvd25lciwgcHJldk93bmVyVmVyc2lvbik7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIHBzZSkg\newogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRmFpbGVkIHRv\nIGNob29zZSBsZWFzdCBsb2FkZWQgaHViIHNlcnZlciBmb3IgdG9waWMgIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSArICIgOiAiLCBwc2UpOwogICAgICAgICAgICAgICAgICAgIGNi\nLm9wZXJhdGlvbkZhaWxlZChjdHgsIHBzZSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHZvaWQgc2V0T3duZXIoZmluYWwgSHViSW5mbyBvd25lckh1YkluZm8s\nIGZpbmFsIFZlcnNpb24gcHJldk93bmVyVmVyc2lvbikgewogICAgICAgICAg\nICBsb2dnZXIuaW5mbygie30gOiBzZXR0aW5nIHRvcGljIHt9ICdzIG93bmVy\nIHRvIGJlIHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVj\ndFtdIHsgYWRkciwgdG9waWMudG9TdHJpbmdVdGY4KCksIG93bmVySHViSW5m\nbyB9KTsKICAgICAgICAgICAgbW0ud3JpdGVPd25lckluZm8odG9waWMsIG93\nbmVySHViSW5mbywgcHJldk93bmVyVmVyc2lvbiwgbmV3IENhbGxiYWNrPFZl\ncnNpb24+KCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3Qg\nY3R4LCBWZXJzaW9uIG5ld1ZlcnNpb24pIHsKICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuaW5mbygie30gOiBTZXQgdG9waWMge30gJ3Mgb3duZXIgdG8g\nYmUge30iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBP\nYmplY3RbXSB7IGFkZHIsIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBvd25lckh1\nYkluZm8gfSk7CiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmlu\naXNoZWQoY3R4LCBvd25lckh1YkluZm8uZ2V0QWRkcmVzcygpKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBj\ndHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoZXhjZXB0aW9uIGluc3RhbmNlb2YgUHViU3ViRXhjZXB0\naW9uLk5vVG9waWNPd25lckluZm9FeGNlcHRpb24gfHwKICAgICAgICAgICAg\nICAgICAgICAgICAgZXhjZXB0aW9uIGluc3RhbmNlb2YgUHViU3ViRXhjZXB0\naW9uLkJhZFZlcnNpb25FeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gc29tZSBvbmUgaGFzIHVwZGF0ZWQgdGhlIG93bmVyCiAgICAg\nICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJ7fSA6IFNvbWUgb25l\nIGhhcyBzZXQgdG9waWMge30gJ3Mgb3duZXIuIFRyeSB0byByZWFkIHRoZSBv\nd25lciBhZ2Fpbi4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W10geyBhZGRyLCB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZCgpOwogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgs\nIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJFeGNlcHRp\nb24gd2hlbiB3cml0aW5nIG93bmVyIGluZm8gdG8gY2xhaW0gb3duZXJzaGlw\nIG9mIHRvcGljICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgOiAiICsgZXhjZXB0\naW9uLmdldE1lc3NhZ2UoKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9LCBjdHgpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHByb3RlY3RlZCB2b2lkIHBvc3RSZWxlYXNlQ2xlYW51cChmaW5hbCBC\neXRlU3RyaW5nIHRvcGljLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNiLCBmaW5hbCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgbW0ucmVhZE93bmVySW5mbyh0b3BpYywgbmV3\nIENhbGxiYWNrPFZlcnNpb25lZDxIdWJJbmZvPj4oKSB7CiAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25G\naW5pc2hlZChPYmplY3QgY3R4LCBWZXJzaW9uZWQ8SHViSW5mbz4gb3duZXIp\nIHsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IG93bmVyKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gTm9kZSBoYXMgc29tZWhvdyBkaXNhcHBlYXJl\nZCBmcm9tIHVuZGVyIHVzLCBsaXZlIHdpdGggaXQKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIud2FybigiTm8gb3duZXIgaW5mbyBmb3VuZCB3aGVuIGNs\nZWFuaW5nIHVwIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSk7CiAg\nICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAvLyBubyB2YWxpZCBodWIgaW5mbyBm\nb3VuZCwganVzdCByZXR1cm4KICAgICAgICAgICAgICAgIGlmIChudWxsID09\nIG93bmVyLmdldFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIud2FybigiTm8gdmFsaWQgb3duZXIgaW5mbyBmb3VuZCB3aGVuIGNsZWFu\naW5nIHVwIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSk7CiAgICAg\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxs\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIG93bmVy\nQWRkciA9IG93bmVyLmdldFZhbHVlKCkuZ2V0QWRkcmVzcygpOwogICAgICAg\nICAgICAgICAgaWYgKCFvd25lckFkZHIuZXF1YWxzKGFkZHIpKSB7CiAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oIldhbnRlZCB0byBjbGVhbiB1\ncCBzZWxmIG93bmVyIGluZm8gZm9yIHRvcGljICIgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBi\ndXQgb3duZXIgIiArIG93bmVyICsgIiBmb3VuZCwgbGVhdmluZyB1bnRvdWNo\nZWQiKTsKICAgICAgICAgICAgICAgICAgICAvLyBOb3Qgb3VyIG5vZGUsIHNv\nbWVvbmUgZWxzZSdzLCBsZWF2ZSBpdCBhbG9uZQogICAgICAgICAgICAgICAg\nICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIG1tLmRlbGV0ZU93bmVySW5mbyh0b3BpYywgb3duZXIuZ2V0\nVmVyc2lvbigpLCBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCByZXN1\nbHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmlu\naXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1\nYkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGV4Y2VwdGlvbiBpbnN0YW5jZW9mIFB1YlN1YkV4Y2VwdGlvbi5O\nb1RvcGljT3duZXJJbmZvRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIud2FybigiV2FudGVkIHRvIGNsZWFuIHVwIHNl\nbGYgb3duZXIgaW5mbyBmb3IgdG9waWMgIiArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nIGJ1dCBpdCBoYXMgYmVlbiByZW1vdmVkLiIpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZXJyb3IoIkV4Y2VwdGlvbiB3aGVuIGRlbGV0aW5nIHNlbGYtb3duZXJz\naGlwIG1ldGFkYXRhIGZvciB0b3BpYyAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiA6\nICIsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9w\nZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2Vydmlj\nZURvd25FeGNlcHRpb24oZXhjZXB0aW9uKSk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\nb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBl\neGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRXhj\nZXB0aW9uIHdoZW4gY2xlYW5pbmcgdXAgb3duZXIgaW5mbyBvZiB0b3BpYyAi\nICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIDogIiwgZXhjZXB0aW9uKTsK\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQ\ndWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oZXhjZXB0aW9u\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBjdHgpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc3RvcCgpIHsKICAgICAgICAv\nLyB3ZSBqdXN0IHVucmVnaXN0ZXIgaXQgd2l0aCB6b29rZWVwZXIgdG8gbWFr\nZSBpdCB1bmF2YWlsYWJsZSBmcm9tIGh1YiBzZXJ2ZXJzIGxpc3QKICAgICAg\nICB0cnkgewogICAgICAgICAgICBodWJNYW5hZ2VyLnVucmVnaXN0ZXJTZWxm\nKCk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIkVycm9yIHVucmVnaXN0ZXJpbmcgaHViIHNl\ncnZlciAiICsgbXlIdWJJbmZvICsgIiA6ICIsIGUpOwogICAgICAgIH0KICAg\nICAgICBzdXBlci5zdG9wKCk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

