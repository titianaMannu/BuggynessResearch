{"sha":"4182c7e3a967368deb64d9b88e6d37495da100fd","node_id":"MDQ6QmxvYjE1NzU5NTY6NDE4MmM3ZTNhOTY3MzY4ZGViNjRkOWI4OGU2ZDM3NDk1ZGExMDBmZA==","size":13297,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4182c7e3a967368deb64d9b88e6d37495da100fd","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsK\naW1wb3J0IGphdmEudXRpbC5SYW5kb207CgppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5IZWR3aWdTb2NrZXRBZGRy\nZXNzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuem9va2VlcGVyLlNhZmVB\nc3luY1pLQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy56b29r\nZWVwZXIuU2FmZUFzeW5jWktDYWxsYmFjay5TdGF0Q2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy56b29rZWVwZXIuWmtVdGlsczsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb24uQ29kZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5ab29EZWZzLklkczsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLmRhdGEuU3RhdDsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQg\nb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogWm9vS2VlcGVyIGJh\nc2VkIGh1YiBzZXJ2ZXIgbWFuYWdlci4KICovCmNsYXNzIFprSHViU2VydmVy\nTWFuYWdlciBpbXBsZW1lbnRzIEh1YlNlcnZlck1hbmFnZXIgewoKICAgIHN0\nYXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIo\nWmtIdWJTZXJ2ZXJNYW5hZ2VyLmNsYXNzKTsKCiAgICBmaW5hbCBSYW5kb20g\ncmFuZCA9IG5ldyBSYW5kb20oKTsKCiAgICBwcml2YXRlIGZpbmFsIFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZjsKICAgIHByaXZhdGUgZmluYWwgWm9vS2Vl\ncGVyIHprOwogICAgcHJpdmF0ZSBmaW5hbCBIZWR3aWdTb2NrZXRBZGRyZXNz\nIGFkZHI7CiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBlcGhlbWVyYWxOb2Rl\nUGF0aDsKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIGh1Yk5vZGVzUGF0aDsK\nCiAgICAvLyBodWIgaW5mbyBzdHJ1Y3R1cmUgcmVwcmVzZW50IGl0c2VsZgog\nICAgcHJvdGVjdGVkIEh1YkluZm8gbXlIdWJJbmZvOwogICAgcHJvdGVjdGVk\nIHZvbGF0aWxlIGJvb2xlYW4gaXNTdXNwZW5kZWQgPSBmYWxzZTsKICAgIHBy\nb3RlY3RlZCBNYW5hZ2VyTGlzdGVuZXIgbGlzdGVuZXIgPSBudWxsOwoKICAg\nIC8vIHVwbG9hZCBodWIgc2VydmVyIGxvYWQgdG8gem9va2VlcGVyCiAgICBT\ndGF0Q2FsbGJhY2sgbG9hZFJlcG9ydGluZ1N0YXRDYWxsYmFjayA9IG5ldyBT\ndGF0Q2FsbGJhY2soKSB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIHZvaWQgc2FmZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0\naCwgT2JqZWN0IGN0eCwgU3RhdCBzdGF0KSB7CiAgICAgICAgICAgIGlmIChy\nYyAhPSBLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAg\nICAgICAgICAgICAgICBsb2dnZXIud2FybigiRmFpbGVkIHRvIHVwZGF0ZSBs\nb2FkIGluZm9ybWF0aW9uIG9mIGh1YiB7fSBpbiB6ayIsIG15SHViSW5mbyk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIC8qKgogICAg\nICogV2F0Y2hlciB0byBtb25pdG9yIGF2YWlsYWJsZSBodWIgc2VydmVyIGxp\nc3QuCiAgICAgKi8KICAgIGNsYXNzIFprSHVic1dhdGNoZXIgaW1wbGVtZW50\ncyBXYXRjaGVyIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMg\ndm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBldmVudCkgewogICAgICAgICAg\nICBpZiAoZXZlbnQuZ2V0VHlwZSgpLmVxdWFscyhXYXRjaGVyLkV2ZW50LkV2\nZW50VHlwZS5Ob25lKSkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50Lmdl\ndFN0YXRlKCkuZXF1YWxzKAogICAgICAgICAgICAgICAgICAgICAgICBXYXRj\naGVyLkV2ZW50LktlZXBlclN0YXRlLkRpc2Nvbm5lY3RlZCkpIHsKICAgICAg\nICAgICAgICAgICAgICBsb2dnZXIud2FybigiWksgY2xpZW50IGhhcyBiZWVu\nIGRpc2Nvbm5lY3RlZCB0byB0aGUgWksgc2VydmVyISIpOwogICAgICAgICAg\nICAgICAgICAgIGlzU3VzcGVuZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICBpZiAobnVsbCAhPSBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAg\nICAgICAgICBsaXN0ZW5lci5vblN1c3BlbmQoKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFN0\nYXRlKCkuZXF1YWxzKAogICAgICAgICAgICAgICAgICAgICAgICBXYXRjaGVy\nLkV2ZW50LktlZXBlclN0YXRlLlN5bmNDb25uZWN0ZWQpKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGlzU3VzcGVuZGVkKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5pbmZvKCJaSyBjbGllbnQgaGFzIGJlZW4gcmVj\nb25uZWN0ZWQgdG8gdGhlIFpLIHNlcnZlciEiKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgaXNTdXNwZW5kZWQgPSBmYWxz\nZTsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBsaXN0ZW5lcikg\newogICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lci5vblJlc3VtZSgp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAoZXZlbnQuZ2V0U3RhdGUoKS5l\ncXVhbHMoV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZS5FeHBpcmVkKSkgewog\nICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJaSyBjbGllbnQgY29ubmVj\ndGlvbiB0byB0aGUgWksgc2VydmVyIGhhcyBleHBpcmVkLiEiKTsKICAgICAg\nICAgICAgICAgIGlmIChudWxsICE9IGxpc3RlbmVyKSB7CiAgICAgICAgICAg\nICAgICAgICAgbGlzdGVuZXIub25TaHV0ZG93bigpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBaa0h1YlNlcnZlck1hbmFnZXIoU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBab29LZWVwZXIgemss\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlZHdpZ1NvY2tldEFk\nZHJlc3MgYWRkcikgewogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAg\nICAgdGhpcy56ayA9IHprOwogICAgICAgIHRoaXMuYWRkciA9IGFkZHI7Cgog\nICAgICAgIC8vIHpub2RlIHBhdGggdG8gc3RvcmUgYWxsIGF2YWlsYWJsZSBo\ndWIgc2VydmVycwogICAgICAgIHRoaXMuaHViTm9kZXNQYXRoID0gdGhpcy5j\nb25mLmdldFprSG9zdHNQcmVmaXgobmV3IFN0cmluZ0J1aWxkZXIoKSkudG9T\ndHJpbmcoKTsKICAgICAgICAvLyB0aGUgbm9kZSdzIGVwaGVtZXJhbCBub2Rl\nIHBhdGgKICAgICAgICB0aGlzLmVwaGVtZXJhbE5vZGVQYXRoID0gZ2V0SHVi\nWmtOb2RlUGF0aChhZGRyKTsKICAgICAgICAvLyByZWdpc3RlciBhdmFpbGFi\nbGUgaHViIHNlcnZlcnMgbGlzdCB3YXRjaGVyCiAgICAgICAgemsucmVnaXN0\nZXIobmV3IFprSHVic1dhdGNoZXIoKSk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgdm9pZCByZWdpc3Rlckxpc3RlbmVyKE1hbmFnZXJMaXN0\nZW5lciBsaXN0ZW5lcikgewogICAgICAgIHRoaXMubGlzdGVuZXIgPSBsaXN0\nZW5lcjsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgem5vZGUgcGF0\naCBpZGVudGlmeWluZyBhIGh1YiBzZXJ2ZXIuCiAgICAgKgogICAgICogQHBh\ncmFtIG5vZGUKICAgICAqICAgICAgICAgIEh1YiBTZXJ2ZXIgQWRkcmVzcwog\nICAgICogQHJldHVybiB6bm9kZSBwYXRoIGlkZW50aWZ5aW5nIHRoZSBodWIg\nc2VydmVyLgogICAgICovCiAgICBwcml2YXRlIFN0cmluZyBnZXRIdWJaa05v\nZGVQYXRoKEhlZHdpZ1NvY2tldEFkZHJlc3Mgbm9kZSkgewogICAgICAgIFN0\ncmluZyBub2RlUGF0aCA9IHRoaXMuY29uZi5nZXRaa0hvc3RzUHJlZml4KG5l\ndyBTdHJpbmdCdWlsZGVyKCkpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nLmFwcGVuZCgiLyIpLmFwcGVuZChub2RlKS50b1N0cmluZygpOwogICAgICAg\nIHJldHVybiBub2RlUGF0aDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIHJlZ2lzdGVyU2VsZihmaW5hbCBIdWJMb2FkIHNlbGZEYXRh\nLCBmaW5hbCBDYWxsYmFjazxIdWJJbmZvPiBjYWxsYmFjaywgT2JqZWN0IGN0\neCkgewogICAgICAgIGJ5dGVbXSBsb2FkRGF0YUJ5dGVzID0gc2VsZkRhdGEu\ndG9TdHJpbmcoKS5nZXRCeXRlcygpOwogICAgICAgIFprVXRpbHMuY3JlYXRl\nRnVsbFBhdGhPcHRpbWlzdGljKHprLCBlcGhlbWVyYWxOb2RlUGF0aCwgbG9h\nZERhdGFCeXRlcywgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDcmVhdGVNb2RlLkVQSEVN\nRVJBTCwgbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suU3RyaW5nQ2FsbGJhY2so\nKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBP\nYmplY3QgY3R4LCBTdHJpbmcgbmFtZSkgewogICAgICAgICAgICAgICAgaWYg\nKHJjID09IENvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAg\nICAgIC8vIG5vdyB3ZSBhcmUgaGVyZQogICAgICAgICAgICAgICAgICAgIHpr\nLmV4aXN0cyhlcGhlbWVyYWxOb2RlUGF0aCwgZmFsc2UsIG5ldyBTYWZlQXN5\nbmNaS0NhbGxiYWNrLlN0YXRDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBh\ndGgsIE9iamVjdCBjdHgsIFN0YXQgc3RhdCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHJjID09IENvZGUuT0suaW50VmFsdWUoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15SHViSW5mbyA9IG5l\ndyBIdWJJbmZvKGFkZHIsIHN0YXQuZ2V0Q3p4aWQoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNo\nZWQoY3R4LCBteUh1YkluZm8pOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJh\nY2sub3BlcmF0aW9uRmFpbGVkKGN0eCwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93\nbkV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICJJIGNhbid0IHN0YXRlIG15IGh1YiBub2RlIGFmdGVyIEkgY3Jl\nYXRlZCBpdCA6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgZXBoZW1lcmFsTm9kZVBhdGgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyYyAh\nPSBDb2RlLk5PREVFWElTVFMuaW50VmFsdWUoKSkgewogICAgICAgICAgICAg\nICAgICAgIEtlZXBlckV4Y2VwdGlvbiBrZSA9IFprVXRpbHMgLmxvZ0Vycm9y\nQW5kQ3JlYXRlWktFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAiQ291bGQgbm90IGNyZWF0ZSBlcGhlbWVyYWwgbm9kZSB0byByZWdp\nc3RlciBodWIiLCBlcGhlbWVyYWxOb2RlUGF0aCwgcmMpOwogICAgICAgICAg\nICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQ\ndWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oa2UpKTsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkZvdW5kIHN0YWxlIGVwaGVt\nZXJhbCBub2RlIHdoaWxlIHJlZ2lzdGVyaW5nIGh1YiB3aXRoIFpLLCBkZWxl\ndGluZyBpdCIpOwoKICAgICAgICAgICAgICAgIC8vIE5vZGUgZXhpc3RzLCBs\nZXRzIHRyeSB0byBkZWxldGUgaXQgYW5kIHJldHJ5CiAgICAgICAgICAgICAg\nICB6ay5kZWxldGUoZXBoZW1lcmFsTm9kZVBhdGgsIC0xLCBuZXcgU2FmZUFz\neW5jWktDYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgc2FmZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2Jq\nZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0g\nQ29kZS5PSy5pbnRWYWx1ZSgpIHx8IHJjID09IENvZGUuTk9OT0RFLmludFZh\nbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVy\nU2VsZihzZWxmRGF0YSwgY2FsbGJhY2ssIGN0eCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIGtl\nID0gWmtVdGlscy5sb2dFcnJvckFuZENyZWF0ZVpLRXhjZXB0aW9uKAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3QgZGVsZXRl\nIHN0YWxlIGVwaGVtZXJhbCBub2RlIHRvIHJlZ2lzdGVyIGh1YiIsIGVwaGVt\nZXJhbE5vZGVQYXRoLCByYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNh\nbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRp\nb24uU2VydmljZURvd25FeGNlcHRpb24oa2UpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBj\ndHgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdW5y\nZWdpc3RlclNlbGYoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHprLmRlbGV0ZShlcGhlbWVyYWxOb2RlUGF0aCwg\nLTEpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGUpOwogICAg\nICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIHRocm93IG5ldyBJT0V4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdXBsb2FkU2VsZkxvYWRE\nYXRhKEh1YkxvYWQgc2VsZkxvYWQpIHsKICAgICAgICBsb2dnZXIuZGVidWco\nIlJlcG9ydGluZyBodWIgbG9hZCBvZiB7fSA6IHt9IiwgbXlIdWJJbmZvLCBz\nZWxmTG9hZCk7CiAgICAgICAgYnl0ZVtdIGxvYWREYXRhQnl0ZXMgPSBzZWxm\nTG9hZC50b1N0cmluZygpLmdldEJ5dGVzKCk7CiAgICAgICAgemsuc2V0RGF0\nYShlcGhlbWVyYWxOb2RlUGF0aCwgbG9hZERhdGFCeXRlcywgLTEsCiAgICAg\nICAgICAgICAgICAgICBsb2FkUmVwb3J0aW5nU3RhdENhbGxiYWNrLCBudWxs\nKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGlzSHVi\nQWxpdmUoZmluYWwgSHViSW5mbyBodWIsIGZpbmFsIENhbGxiYWNrPEJvb2xl\nYW4+IGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgemsuZXhpc3Rz\nKGdldEh1YlprTm9kZVBhdGgoaHViLmdldEFkZHJlc3MoKSksIGZhbHNlLCBu\nZXcgU2FmZUFzeW5jWktDYWxsYmFjay5TdGF0Q2FsbGJhY2soKSB7CiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZl\nUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4\nLCBTdGF0IHN0YXQpIHsKICAgICAgICAgICAgICAgIGlmIChyYyA9PSBDb2Rl\nLk5PTk9ERS5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgY2Fs\nbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBmYWxzZSk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKHJjID09IENvZGUuT0suaW50VmFsdWUoKSkg\newogICAgICAgICAgICAgICAgICAgIGlmIChodWIuZ2V0WnhpZCgpID09IHN0\nYXQuZ2V0Q3p4aWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYWxs\nYmFjay5vcGVyYXRpb25GaW5pc2hlZChjdHgsIHRydWUpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNh\nbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgZmFsc2UpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKGN0eCwg\nbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0byBjaGVjayB3aGV0aGVy\nIGh1YiBzZXJ2ZXIgIiArIGh1YiArICIgaXMgYWxpdmUhIikpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwgY3R4KTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGNob29zZUxlYXN0\nTG9hZGVkSHViKGZpbmFsIENhbGxiYWNrPEh1YkluZm8+IGNhbGxiYWNrLCBP\nYmplY3QgY3R4KSB7CiAgICAgICAgLy8gR2V0IHRoZSBsaXN0IG9mIGV4aXN0\naW5nIGhvc3RzCiAgICAgICAgemsuZ2V0Q2hpbGRyZW4oaHViTm9kZXNQYXRo\nLCBmYWxzZSwgbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suQ2hpbGRyZW5DYWxs\nYmFjaygpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBh\ndGgsIE9iamVjdCBjdHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBjaGlsZHJlbikgewogICAgICAg\nICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFsdWUoKSkgewogICAg\nICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBlID0gWmtVdGlscy5s\nb2dFcnJvckFuZENyZWF0ZVpLRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAiQ291bGQgbm90IGdldCBsaXN0IG9mIGF2YWlsYWJsZSBodWJz\nIiwgcGF0aCwgcmMpOwogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9w\nZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2Vydmlj\nZURvd25FeGNlcHRpb24oZSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNob29zZUxl\nYXN0TG9hZGVkTm9kZShjaGlsZHJlbiwgY2FsbGJhY2ssIGN0eCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9LCBjdHgpOwogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBjaG9vc2VMZWFzdExvYWRlZE5vZGUoZmluYWwgTGlzdDxTdHJpbmc+\nIGNoaWxkcmVuLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmaW5hbCBDYWxsYmFjazxIdWJJbmZvPiBjYWxsYmFjaywgT2JqZWN0\nIGN0eCkgewogICAgICAgIFNhZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxi\nYWNrIGRhdGFDYWxsYmFjayA9IG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLkRh\ndGFDYWxsYmFjaygpIHsKICAgICAgICAgICAgaW50IG51bVJlc3BvbnNlcyA9\nIDA7CiAgICAgICAgICAgIEh1YkxvYWQgbWluTG9hZCA9IEh1YkxvYWQuTUFY\nX0xPQUQ7CiAgICAgICAgICAgIFN0cmluZyBsZWFzdExvYWRlZCA9IG51bGw7\nCiAgICAgICAgICAgIGxvbmcgbGVhc3RMb2FkZWRDenhpZCA9IDA7CgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgc2Fm\nZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0\neCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nYnl0ZVtdIGRhdGEsIFN0YXQgc3RhdCkgewogICAgICAgICAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJj\nID09IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk9LLmludFZhbHVlKCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEh1YkxvYWQgbG9hZCA9IEh1YkxvYWQucGFyc2UobmV3IFN0\ncmluZyhkYXRhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZGVidWcoIkZvdW5kIHNlcnZlciB7fSB3aXRoIGxvYWQ6IHt9IiwgY3R4\nLCBsb2FkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBjb21w\nYXJlUmVzID0gbG9hZC5jb21wYXJlVG8obWluTG9hZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoY29tcGFyZVJlcyA8IDAgfHwgKGNvbXBh\ncmVSZXMgPT0gMCAmJiByYW5kLm5leHRCb29sZWFuKCkpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbWluTG9hZCA9IGxvYWQ7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc3RMb2FkZWQgPSAoU3Ry\naW5nKSBjdHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVh\nc3RMb2FkZWRDenhpZCA9IHN0YXQuZ2V0Q3p4aWQoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSHViTG9hZC5JbnZhbGlkSHViTG9hZEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybigiQ29ycnVw\ndGVkIGxvYWQgaW5mb3JtYXRpb24gZnJvbSBodWIgOiAiICsgY3R4KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvbWUgY29ycnVwdGVkIGRh\ndGEsIHdlJ2xsIGp1c3QgaWdub3JlIHRoaXMgaHViCiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgbnVtUmVzcG9uc2VzKys7CgogICAgICAgICAgICAgICAgICAg\nIGlmIChudW1SZXNwb25zZXMgPT0gY2hpbGRyZW4uc2l6ZSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChsZWFzdExvYWRlZCA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRp\nb25GYWlsZWQoY3R4LCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKCJO\nbyBodWIgYXZhaWxhYmxlIikpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIG93bmVyID0gbmV3IEhlZHdpZ1Nv\nY2tldEFkZHJlc3MobGVhc3RMb2FkZWQpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBuZXcg\nSHViSW5mbyhvd25lciwgbGVhc3RMb2FkZWRDenhpZCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVk\nKGN0eCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKCJMZWFzdCBsb2Fk\nZWQgaHViIHNlcnZlciAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBs\nZWFzdExvYWRlZCArICIgaXMgaW52YWxpZC4iKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBmb3Ig\nKFN0cmluZyBjaGlsZCA6IGNoaWxkcmVuKSB7CiAgICAgICAgICAgIHprLmdl\ndERhdGEoY29uZi5nZXRaa0hvc3RzUHJlZml4KG5ldyBTdHJpbmdCdWlsZGVy\nKCkpLmFwcGVuZCgiLyIpLmFwcGVuZChjaGlsZCkudG9TdHJpbmcoKSwgZmFs\nc2UsCiAgICAgICAgICAgICAgICAgICAgICAgZGF0YUNhbGxiYWNrLCBjaGls\nZCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

