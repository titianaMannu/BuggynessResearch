{"sha":"128a1aaa13b378b939b9f80344f61968db8ee7b3","node_id":"MDQ6QmxvYjE1NzU5NTY6MTI4YTFhYWExM2IzNzhiOTM5YjlmODAzNDRmNjE5NjhkYjhlZTdiMw==","size":14673,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/128a1aaa13b378b939b9f80344f61968db8ee7b3","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIGphdmEubmV0LlVua25vd25Ib3N0RXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNj\naGVkdWxlZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LlN5bmNocm9ub3VzUXVldWU7CgppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuQ3JlYXRlTW9kZTsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Db2RlOwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5kYXRhLlN0YXQ7CgppbXBvcnQgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhj\nZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcudXRpbC5Db25jdXJyZW5jeVV0aWxzOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5FaXRoZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3M7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy56b29rZWVwZXIuU2FmZUFzeW5jWktDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBlci5aa1V0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuem9va2VlcGVyLlNhZmVBc3lu\nY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuem9va2VlcGVyLlNhZmVBc3luY1pLQ2FsbGJhY2suU3RhdENhbGxi\nYWNrOwoKLyoqCiAqIFRvcGljcyBhcmUgb3BlcmF0ZWQgb24gaW4gcGFyYWxs\nZWwgYXMgdGhleSBhcmUgaW5kZXBlbmRlbnQuCiAqCiAqLwpwdWJsaWMgY2xh\nc3MgWmtUb3BpY01hbmFnZXIgZXh0ZW5kcyBBYnN0cmFjdFRvcGljTWFuYWdl\nciBpbXBsZW1lbnRzIFRvcGljTWFuYWdlciB7CgogICAgc3RhdGljIExvZ2dl\nciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihaa1RvcGljTWFu\nYWdlci5jbGFzcyk7CgogICAgLyoqCiAgICAgKiBQZXJzaXN0ZW50IHN0b3Jh\nZ2UgZm9yIHRvcGljIG1ldGFkYXRhLgogICAgICovCiAgICBwcml2YXRlIFpv\nb0tlZXBlciB6azsKCiAgICAvLyBodWIgc2VydmVyIG1hbmFnZXIKICAgIHBy\naXZhdGUgZmluYWwgSHViU2VydmVyTWFuYWdlciBodWJNYW5hZ2VyOwoKICAg\nIHByaXZhdGUgZmluYWwgSHViSW5mbyBteUh1YkluZm87CiAgICBwcml2YXRl\nIGZpbmFsIEh1YkxvYWQgbXlIdWJMb2FkOwoKICAgIC8vIEJvb2xlYW4gZmxh\nZyBpbmRpY2F0aW5nIGlmIHdlIHNob3VsZCBzdXNwZW5kIGFjdGl2aXR5LiBJ\nZiB0aGlzIGlzIHRydWUsCiAgICAvLyBhbGwgb2YgdGhlIE9wcyBwdXQgaW50\nbyB0aGUgcXVldWVyIHdpbGwgZmFpbCBhdXRvbWF0aWNhbGx5LgogICAgcHJv\ndGVjdGVkIHZvbGF0aWxlIGJvb2xlYW4gaXNTdXNwZW5kZWQgPSBmYWxzZTsK\nCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyB0b3BpYyBtYW5hZ2VyLiBQ\nYXNzIGluIGFuIGFjdGl2ZSBab29LZWVwZXIgY2xpZW50IG9iamVjdC4KICAg\nICAqCiAgICAgKiBAcGFyYW0gemsKICAgICAqLwogICAgcHVibGljIFprVG9w\naWNNYW5hZ2VyKGZpbmFsIFpvb0tlZXBlciB6aywgZmluYWwgU2VydmVyQ29u\nZmlndXJhdGlvbiBjZmcsIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBzY2hl\nZHVsZXIpCiAgICAgICAgICAgIHRocm93cyBVbmtub3duSG9zdEV4Y2VwdGlv\nbiwgUHViU3ViRXhjZXB0aW9uIHsKCiAgICAgICAgc3VwZXIoY2ZnLCBzY2hl\nZHVsZXIpOwogICAgICAgIHRoaXMuemsgPSB6azsKICAgICAgICB0aGlzLmh1\nYk1hbmFnZXIgPSBuZXcgWmtIdWJTZXJ2ZXJNYW5hZ2VyKGNmZywgemssIGFk\nZHIpOwoKICAgICAgICBteUh1YkxvYWQgPSBuZXcgSHViTG9hZCh0b3BpY3Mu\nc2l6ZSgpKTsKICAgICAgICB0aGlzLmh1Yk1hbmFnZXIucmVnaXN0ZXJMaXN0\nZW5lcihuZXcgSHViU2VydmVyTWFuYWdlci5NYW5hZ2VyTGlzdGVuZXIoKSB7\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBvblN1c3BlbmQoKSB7CiAgICAgICAgICAgICAgICBpc1N1c3BlbmRlZCA9\nIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9uUmVzdW1lKCkgewogICAgICAgICAg\nICAgICAgaXNTdXNwZW5kZWQgPSBmYWxzZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb25T\naHV0ZG93bigpIHsKICAgICAgICAgICAgICAgIC8vIGlmIGh1YiBzZXJ2ZXIg\nbWFuYWdlciBjYW4ndCB3b3JrLCB3ZSBoYWQgdG8gcXVpdAogICAgICAgICAg\nICAgICAgUnVudGltZS5nZXRSdW50aW1lKCkuZXhpdCgxKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0pOwoKICAgICAgICBmaW5hbCBTeW5jaHJvbm91c1F1\nZXVlPEVpdGhlcjxIdWJJbmZvLCBQdWJTdWJFeGNlcHRpb24+PiBxdWV1ZSA9\nCiAgICAgICAgICAgIG5ldyBTeW5jaHJvbm91c1F1ZXVlPEVpdGhlcjxIdWJJ\nbmZvLCBQdWJTdWJFeGNlcHRpb24+PigpOwogICAgICAgIHRoaXMuaHViTWFu\nYWdlci5yZWdpc3RlclNlbGYobXlIdWJMb2FkLCBuZXcgQ2FsbGJhY2s8SHVi\nSW5mbz4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChmaW5hbCBPYmplY3QgY3R4\nLCBmaW5hbCBIdWJJbmZvIHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAgICAgICAg\nICAgICAgICBsb2dnZXIuaW5mbygiU3VjY2Vzc2Z1bGx5IHJlZ2lzdGVyZWQg\naHViIHt9IHdpdGggem9va2VlcGVyIiwgcmVzdWx0T2ZPcGVyYXRpb24pOwog\nICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQocXVldWUsIEVp\ndGhlci5vZihyZXN1bHRPZk9wZXJhdGlvbiwgKFB1YlN1YkV4Y2VwdGlvbikg\nbnVsbCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0\nIGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAg\nICAgICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gcmVnaXN0ZXIgaHViIHdp\ndGggem9va2VlcGVyIiwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgIENv\nbmN1cnJlbmN5VXRpbHMucHV0KHF1ZXVlLCBFaXRoZXIub2YoKEh1YkluZm8p\nbnVsbCwgZXhjZXB0aW9uKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBu\ndWxsKTsKCiAgICAgICAgRWl0aGVyPEh1YkluZm8sIFB1YlN1YkV4Y2VwdGlv\nbj4gcmVzdWx0ID0gQ29uY3VycmVuY3lVdGlscy50YWtlKHF1ZXVlKTsKICAg\nICAgICBQdWJTdWJFeGNlcHRpb24gcHNlID0gcmVzdWx0LnJpZ2h0KCk7CiAg\nICAgICAgaWYgKHBzZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IHBz\nZTsKICAgICAgICB9CiAgICAgICAgbXlIdWJJbmZvID0gcmVzdWx0LmxlZnQo\nKTsKICAgIH0KCiAgICBTdHJpbmcgaHViUGF0aChCeXRlU3RyaW5nIHRvcGlj\nKSB7CiAgICAgICAgcmV0dXJuIGNmZy5nZXRaa1RvcGljUGF0aChuZXcgU3Ry\naW5nQnVpbGRlcigpLCB0b3BpYykuYXBwZW5kKCIvaHViIikudG9TdHJpbmco\nKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIHJl\nYWxHZXRPd25lcihmaW5hbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBib29s\nZWFuIHNob3VsZENsYWltLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZpbmFsIENhbGxiYWNrPEhlZHdpZ1NvY2tldEFkZHJlc3M+IGNiLCBm\naW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgLy8gSWYgb3BlcmF0aW9ucyBh\ncmUgc3VzcGVuZGVkIGR1ZSB0byBhIFpLIGNsaWVudCBkaXNjb25uZWN0LCBq\ndXN0IGVycm9yCiAgICAgICAgLy8gb3V0IHRoaXMgY2FsbCBhbmQgcmV0dXJu\nLgogICAgICAgIGlmIChpc1N1c3BlbmRlZCkgewogICAgICAgICAgICBjYi5v\ncGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZp\nY2VEb3duRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICJaS1RvcGljTWFuYWdlciBzZXJ2aWNlIGlzIHRlbXBvcmFyaWx5\nIHN1c3BlbmRlZCEiKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIGlmICh0b3BpY3MuY29udGFpbnModG9waWMpKSB7CiAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgYWRkcik7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIG5ldyBaa0dldE93\nbmVyT3AodG9waWMsIHNob3VsZENsYWltLCBjYiwgY3R4KS5yZWFkKCk7CiAg\nICB9CgogICAgLy8gUmVjdXJzaXZlbHkgY2FsbCBlYWNoIG90aGVyLgogICAg\nY2xhc3MgWmtHZXRPd25lck9wIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGlj\nOwogICAgICAgIGJvb2xlYW4gc2hvdWxkQ2xhaW07CiAgICAgICAgQ2FsbGJh\nY2s8SGVkd2lnU29ja2V0QWRkcmVzcz4gY2I7CiAgICAgICAgT2JqZWN0IGN0\neDsKICAgICAgICBTdHJpbmcgaHViUGF0aDsKCiAgICAgICAgcHVibGljIFpr\nR2V0T3duZXJPcChCeXRlU3RyaW5nIHRvcGljLCBib29sZWFuIHNob3VsZENs\nYWltLCBDYWxsYmFjazxIZWR3aWdTb2NrZXRBZGRyZXNzPiBjYiwgT2JqZWN0\nIGN0eCkgewogICAgICAgICAgICB0aGlzLnRvcGljID0gdG9waWM7CiAgICAg\nICAgICAgIHRoaXMuc2hvdWxkQ2xhaW0gPSBzaG91bGRDbGFpbTsKICAgICAg\nICAgICAgdGhpcy5jYiA9IGNiOwogICAgICAgICAgICB0aGlzLmN0eCA9IGN0\neDsKICAgICAgICAgICAgaHViUGF0aCA9IGh1YlBhdGgodG9waWMpOwoKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNob29zZSgpIHsKICAgICAg\nICAgICAgaHViTWFuYWdlci5jaG9vc2VMZWFzdExvYWRlZEh1YihuZXcgQ2Fs\nbGJhY2s8SHViSW5mbz4oKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVk\nKE9iamVjdCBjdHgsIEh1YkluZm8gb3duZXIpIHsKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuaW5mbygie30gOiBMZWFzdCBsb2FkZWQgb3duZXIge30g\naXMgY2hvc2VuIGZvciB0b3BpYyB7fSIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgYWRkciwgb3duZXIsIHRvcGlj\nLnRvU3RyaW5nVXRmOCgpIH0pOwogICAgICAgICAgICAgICAgICAgIGlmIChv\nd25lci5nZXRBZGRyZXNzKCkuZXF1YWxzKGFkZHIpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNsYWltKCk7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmlu\naXNoZWQoWmtHZXRPd25lck9wLnRoaXMuY3R4LCBvd25lci5nZXRBZGRyZXNz\nKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4\nY2VwdGlvbiBwc2UpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJy\nb3IoIkZhaWxlZCB0byBjaG9vc2UgbGVhc3QgbG9hZGVkIGh1YiBzZXJ2ZXIg\nZm9yIHRvcGljICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\ndG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIDogIiwgcHNlKTsKICAgICAgICAg\nICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBwc2UpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGNsYWltT3JDaG9vc2UoKSB7CiAgICAg\nICAgICAgIGlmIChzaG91bGRDbGFpbSkKICAgICAgICAgICAgICAgIGNsYWlt\nKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGNob29zZSgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVhZCgpIHsKICAg\nICAgICAgICAgemsuZ2V0RGF0YShodWJQYXRoLCBmYWxzZSwgbmV3IFNhZmVB\nc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrKCkgewogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZl\nUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4\nLCBieXRlW10gZGF0YSwgU3RhdCBzdGF0KSB7CgogICAgICAgICAgICAgICAg\nICAgIGlmIChyYyA9PSBDb2RlLk5PTk9ERS5pbnRWYWx1ZSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNsYWltT3JDaG9vc2UoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFs\ndWUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRp\nb24gZSA9IFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigi\nQ291bGQgbm90IHJlYWQgb3duZXJzaGlwIGZvciB0b3BpYzogIgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMu\ndG9TdHJpbmdVdGY4KCksIHBhdGgsIHJjKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2Vw\ndGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxseSBkaWQgYSByZWFkCiAg\nICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAg\nICAgSHViSW5mbyBvd25lckh1YkluZm8gPSBIdWJJbmZvLnBhcnNlKG5ldyBT\ndHJpbmcoZGF0YSkpOwogICAgICAgICAgICAgICAgICAgICAgICBIZWR3aWdT\nb2NrZXRBZGRyZXNzIG93bmVyID0gb3duZXJIdWJJbmZvLmdldEFkZHJlc3Mo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvd25lci5lcXVhbHMo\nYWRkcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2dn\nZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5kZWJ1ZygidG9waWM6ICIgKyB0b3BpYy50b1N0\ncmluZ1V0ZjgoKSArICIgYmVsb25ncyB0byBzb21lb25lIGVsc2U6ICIgKyBv\nd25lcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgs\nIG93bmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuaW5mbygiRGlzY292ZXJlZCBzdGFsZSBzZWxmLW5vZGUg\nZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiLCB3aWxs\nIGRlbGV0ZSBpdCIpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEh1\nYkluZm8uSW52YWxpZEh1YkluZm9FeGNlcHRpb24gaWhpZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiRGlzY292ZXJlZCBpbnZh\nbGlkIGh1YiBpbmZvIGZvciB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpICsgIiwgd2lsbCBkZWxldGUgaXQgOiAiLCBpaGllKTsKICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIHdlIG11c3Qg\naGF2ZSBwcmV2aW91c2x5IGZhaWxlZCBhbmQgbGVmdCBhCiAgICAgICAgICAg\nICAgICAgICAgLy8gcmVzaWR1YWwgZXBoZW1lcmFsIG5vZGUgaGVyZSwgc28g\nd2UgbXVzdAogICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBpdCAoY2xl\nYW4gaXQgdXApIGFuZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgLy8gcmUt\nY3JlYXRlL3JlLWFjcXVpcmUgdGhlIHRvcGljLgogICAgICAgICAgICAgICAg\nICAgIHprLmRlbGV0ZShodWJQYXRoLCBzdGF0LmdldFZlcnNpb24oKSwgbmV3\nIFZvaWRDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBy\nb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKENvZGUuT0suaW50\nVmFsdWUoKSA9PSByYyB8fCBDb2RlLk5PTk9ERS5pbnRWYWx1ZSgpID09IHJj\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhaW1PckNo\nb29zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRp\nb24gZSA9IFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAiQ291bGQgbm90IGRlbGV0ZSBzZWxmIG5vZGUgZm9yIHRv\ncGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCksIHBhdGgsIHJjKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWls\nZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0\naW9uKGUpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIGN0\neCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGN0eCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbGFpbSgpIHsKICAgICAg\nICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgICAgICBsb2dnZXIuZGVidWcoImNsYWltaW5nIHRvcGljOiAiICsgdG9w\naWMudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBaa1V0aWxzLmNyZWF0ZUZ1bGxQYXRoT3B0aW1pc3RpYyh6aywgaHViUGF0\naCwgbXlIdWJJbmZvLnRvU3RyaW5nKCkuZ2V0Qnl0ZXMoKSwgSWRzLk9QRU5f\nQUNMX1VOU0FGRSwKICAgICAgICAgICAgQ3JlYXRlTW9kZS5FUEhFTUVSQUws\nIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLlN0cmluZ0NhbGxiYWNrKCkgewoK\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2FmZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0\naCwgT2JqZWN0IGN0eCwgU3RyaW5nIG5hbWUpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAocmMgPT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJj\nbGFpbWVkIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIG5vdGlmeUxpc3RlbmVyc0FuZEFkZFRvT3duZWRUb3BpY3ModG9waWMsIGNi\nLCBjdHgpOwogICAgICAgICAgICAgICAgICAgICAgICBodWJNYW5hZ2VyLnVw\nbG9hZFNlbGZMb2FkRGF0YShteUh1YkxvYWQuc2V0TnVtVG9waWNzKHRvcGlj\ncy5zaXplKCkpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJj\nID09IENvZGUuTk9ERUVYSVNUUy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJlYWQoKTsKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24g\nZSA9IFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIkZhaWxlZCB0byBjcmVhdGUgZXBoZW1lcmFsIG5vZGUgdG8gY2xhaW0gb3du\nZXJzaGlwIG9mIHRvcGljOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCks\nIHBhdGgsIHJjKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0\naW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93\nbkV4Y2VwdGlvbihlKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9LCBjdHgpOwogICAgICAgIH0KCiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBwb3N0UmVs\nZWFzZUNsZWFudXAoZmluYWwgQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgQ2Fs\nbGJhY2s8Vm9pZD4gY2IsIE9iamVjdCBjdHgpIHsKCiAgICAgICAgemsuZ2V0\nRGF0YShodWJQYXRoKHRvcGljKSwgZmFsc2UsIG5ldyBTYWZlQXN5bmNaS0Nh\nbGxiYWNrLkRhdGFDYWxsYmFjaygpIHsKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGlu\ndCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsIGJ5dGVbXSBkYXRhLCBT\ndGF0IHN0YXQpIHsKICAgICAgICAgICAgICAgIGlmIChyYyA9PSBDb2RlLk5P\nTk9ERS5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTm9k\nZSBoYXMgc29tZWhvdyBkaXNhcHBlYXJlZCBmcm9tIHVuZGVyIHVzLCBsaXZl\nIHdpdGggaXQKICAgICAgICAgICAgICAgICAgICAvLyBzaW5jZSBpdHMgYSB0\ncmFuc2llbnQgbm9kZQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJu\nKCJXaGlsZSBkZWxldGluZyBzZWxmLW5vZGUgZm9yIHRvcGljOiAiICsgdG9w\naWMudG9TdHJpbmdVdGY4KCkgKyAiLCBub2RlIG5vdCBmb3VuZCIpOwogICAg\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIGlmIChyYyAhPSBDb2RlLk9LLmludFZh\nbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24g\nZSA9IFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRmFp\nbGVkIHRvIGRlbGV0ZSBzZWxmLW93bmVyc2hpcCBub2RlIGZvciB0b3BpYzog\nIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBwYXRoLCByYyk7CiAgICAgICAg\nICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1\nYkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIFN0cmluZyBodWJJbmZvU3RyID0gbmV3IFN0cmluZyhkYXRh\nKTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nSHViSW5mbyBvd25lckh1YkluZm8gPSBIdWJJbmZvLnBhcnNlKGh1YkluZm9T\ndHIpOwogICAgICAgICAgICAgICAgICAgIEhlZHdpZ1NvY2tldEFkZHJlc3Mg\nb3duZXIgPSBvd25lckh1YkluZm8uZ2V0QWRkcmVzcygpOwogICAgICAgICAg\nICAgICAgICAgIGlmICghb3duZXIuZXF1YWxzKGFkZHIpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJXYW50ZWQgdG8gZGVsZXRl\nIHNlbGYtbm9kZSBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSArICIgYnV0IG5vZGUgZm9yICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyBvd25lciArICIgZm91bmQsIGxlYXZpbmcgdW50b3Vj\naGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdCBvdXIgbm9k\nZSwgc29tZW9uZSBlbHNlJ3MsIGxlYXZlIGl0IGFsb25lCiAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChIdWJJbmZvLklu\ndmFsaWRIdWJJbmZvRXhjZXB0aW9uIGloaWUpIHsKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuaW5mbygiSW52YWxpZCBodWIgaW5mbyAiICsgaHViSW5m\nb1N0ciArICIgZm91bmQgd2hlbiByZWxlYXNlIHRvcGljICIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSAr\nICIuIExlYXZpbmcgdW50b3VjaGVkIHVudGlsIG5leHQgYWNxdWlyZSBhY3Rp\nb24uIik7CiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNo\nZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgemsuZGVsZXRlKHBh\ndGgsIHN0YXQuZ2V0VmVyc2lvbigpLCBuZXcgU2FmZUFzeW5jWktDYWxsYmFj\nay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVByb2Nl\nc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5PSy5pbnRW\nYWx1ZSgpICYmIHJjICE9IENvZGUuTk9OT0RFLmludFZhbHVlKCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBlID0g\nWmtVdGlscwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigiRmFp\nbGVkIHRvIGRlbGV0ZSBzZWxmLW93bmVyc2hpcCBub2RlIGZvciB0b3BpYzog\nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCksIHBhdGgsIHJj\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZh\naWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNl\ncHRpb24oZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIGN0eCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9LCBjdHgpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgc3RvcCgpIHsKICAgICAgICAvLyB3ZSBq\ndXN0IHVucmVnaXN0ZXIgaXQgd2l0aCB6b29rZWVwZXIgdG8gbWFrZSBpdCB1\nbmF2YWlsYWJsZSBmcm9tIGh1YiBzZXJ2ZXJzIGxpc3QKICAgICAgICB0cnkg\newogICAgICAgICAgICBodWJNYW5hZ2VyLnVucmVnaXN0ZXJTZWxmKCk7CiAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICBs\nb2dnZXIuZXJyb3IoIkVycm9yIHVucmVnaXN0ZXJpbmcgaHViIHNlcnZlciA6\nIiwgZSk7CiAgICAgICAgfQogICAgICAgIHN1cGVyLnN0b3AoKTsKICAgIH0K\nCn0K\n","encoding":"base64"}

