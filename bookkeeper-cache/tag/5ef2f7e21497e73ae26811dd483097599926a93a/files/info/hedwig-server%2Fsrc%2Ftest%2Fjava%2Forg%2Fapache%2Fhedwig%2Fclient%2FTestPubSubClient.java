{"sha":"062e431f79bbc562c86f91d3f793ca71eb7375e7","node_id":"MDQ6QmxvYjE1NzU5NTY6MDYyZTQzMWY3OWJiYzU2MmM4NmY5MWQzZjc5M2NhNzFlYjczNzVlNw==","size":29968,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/062e431f79bbc562c86f91d3f793ca71eb7375e7","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQ7CgppbXBvcnQgamF2YS51\ndGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TeW5jaHJvbm91c1F1ZXVlOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKCmlt\ncG9ydCBvcmcuanVuaXQuQWZ0ZXI7CmltcG9ydCBvcmcuanVuaXQuQmVmb3Jl\nOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBvcmcuanVuaXQucnVu\nbmVyLlJ1bldpdGg7CmltcG9ydCBvcmcuanVuaXQucnVubmVycy5QYXJhbWV0\nZXJpemVkOwppbXBvcnQgb3JnLmp1bml0LnJ1bm5lcnMuUGFyYW1ldGVyaXpl\nZC5QYXJhbWV0ZXJzOwoKaW1wb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZzsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGku\nTWVzc2FnZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGll\nbnQuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuY2xpZW50LkhlZHdpZ0NsaWVudDsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmNsaWVudC5hcGkuUHVibGlzaGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3JpYmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2Vw\ndGlvbi5DbGllbnROb3RTdWJzY3JpYmVkRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2g7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25FdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnM7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuUHViU3ViU2VydmVyU3RhbmRBbG9u\nZVRlc3RCYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5DYWxs\nYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ29uY3VycmVu\nY3lVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuU3Vic2Ny\naXB0aW9uTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGls\nLkhlZHdpZ1NvY2tldEFkZHJlc3M7CgpAUnVuV2l0aChQYXJhbWV0ZXJpemVk\nLmNsYXNzKQpwdWJsaWMgY2xhc3MgVGVzdFB1YlN1YkNsaWVudCBleHRlbmRz\nIFB1YlN1YlNlcnZlclN0YW5kQWxvbmVUZXN0QmFzZSB7CgogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgaW50IFJFVEVOVElPTl9TRUNTX1ZBTFVFID0gMTA7\nCgogICAgLy8gQ2xpZW50IHNpZGUgdmFyaWFibGVzCiAgICBwcm90ZWN0ZWQg\nSGVkd2lnQ2xpZW50IGNsaWVudDsKICAgIHByb3RlY3RlZCBQdWJsaXNoZXIg\ncHVibGlzaGVyOwogICAgcHJvdGVjdGVkIFN1YnNjcmliZXIgc3Vic2NyaWJl\ncjsKCiAgICBwcm90ZWN0ZWQgY2xhc3MgUmV0ZW50aW9uU2VydmVyQ29uZmln\ndXJhdGlvbiBleHRlbmRzIFN0YW5kQWxvbmVTZXJ2ZXJDb25maWd1cmF0aW9u\nIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBp\nc1N0YW5kYWxvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBn\nZXRSZXRlbnRpb25TZWNzKCkgewogICAgICAgICAgICByZXR1cm4gUkVURU5U\nSU9OX1NFQ1NfVkFMVUU7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFN5bmNo\ncm9ub3VzUXVldWVzIHRvIHZlcmlmeSBhc3luYyBjYWxscwogICAgcHJpdmF0\nZSBmaW5hbCBTeW5jaHJvbm91c1F1ZXVlPEJvb2xlYW4+IHF1ZXVlID0gbmV3\nIFN5bmNocm9ub3VzUXVldWU8Qm9vbGVhbj4oKTsKICAgIHByaXZhdGUgZmlu\nYWwgU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPiBjb25zdW1lUXVldWUgPSBu\nZXcgU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPigpOwogICAgcHJpdmF0ZSBm\naW5hbCBTeW5jaHJvbm91c1F1ZXVlPFN1YnNjcmlwdGlvbkV2ZW50PiBldmVu\ndFF1ZXVlID0KICAgICAgICBuZXcgU3luY2hyb25vdXNRdWV1ZTxTdWJzY3Jp\ncHRpb25FdmVudD4oKTsKCiAgICBjbGFzcyBUZXN0U3Vic2NyaXB0aW9uTGlz\ndGVuZXIgaW1wbGVtZW50cyBTdWJzY3JpcHRpb25MaXN0ZW5lciB7CiAgICAg\nICAgU3luY2hyb25vdXNRdWV1ZTxTdWJzY3JpcHRpb25FdmVudD4gZXZlbnRR\ndWV1ZTsKICAgICAgICBwdWJsaWMgVGVzdFN1YnNjcmlwdGlvbkxpc3RlbmVy\nKCkgewogICAgICAgICAgICB0aGlzLmV2ZW50UXVldWUgPSBUZXN0UHViU3Vi\nQ2xpZW50LnRoaXMuZXZlbnRRdWV1ZTsKICAgICAgICB9CiAgICAgICAgcHVi\nbGljIFRlc3RTdWJzY3JpcHRpb25MaXN0ZW5lcihTeW5jaHJvbm91c1F1ZXVl\nPFN1YnNjcmlwdGlvbkV2ZW50PiBxdWV1ZSkgewogICAgICAgICAgICB0aGlz\nLmV2ZW50UXVldWUgPSBxdWV1ZTsKICAgICAgICB9CiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc0V2ZW50KGZpbmFsIEJ5\ndGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklk\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBTdWJz\nY3JpcHRpb25FdmVudCBldmVudCkgewogICAgICAgICAgICBuZXcgVGhyZWFk\nKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRXZlbnQge30gcmVjZWl2ZWQgZm9y\nIHN1YnNjcmlwdGlvbih0b3BpYzp7fSwgc3Vic2NyaWJlcjp7fSkiLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W10geyBl\ndmVudCwgdG9waWMudG9TdHJpbmdVdGY4KCksIHN1YnNjcmliZXJJZC50b1N0\ncmluZ1V0ZjgoKSB9KTsKICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW5j\neVV0aWxzLnB1dChUZXN0U3Vic2NyaXB0aW9uTGlzdGVuZXIudGhpcy5ldmVu\ndFF1ZXVlLCBldmVudCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0pLnN0YXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFRlc3QgaW1w\nbGVtZW50YXRpb24gb2YgQ2FsbGJhY2sgZm9yIGFzeW5jIGNsaWVudCBhY3Rp\nb25zLgogICAgY2xhc3MgVGVzdENhbGxiYWNrIGltcGxlbWVudHMgQ2FsbGJh\nY2s8Vm9pZD4gewoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMg\ndm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3Vs\ndE9mT3BlcmF0aW9uKSB7CiAgICAgICAgICAgIG5ldyBUaHJlYWQobmV3IFJ1\nbm5hYmxlKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQogICAgICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIuZGVidWcoIk9wZXJhdGlvbiBmaW5pc2hlZCEi\nKTsKICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW5jeVV0aWxzLnB1dChx\ndWV1ZSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0p\nLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgZmlu\nYWwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICBu\nZXcgVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiT3BlcmF0aW9uIGZh\naWxlZCEiLCBleGNlcHRpb24pOwogICAgICAgICAgICAgICAgICAgIENvbmN1\ncnJlbmN5VXRpbHMucHV0KHF1ZXVlLCBmYWxzZSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0pLnN0YXJ0KCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8vIFRlc3QgaW1wbGVtZW50YXRpb24gb2Ygc3Vic2NyaWJlcidzIG1l\nc3NhZ2UgaGFuZGxlci4KICAgIGNsYXNzIFRlc3RNZXNzYWdlSGFuZGxlciBp\nbXBsZW1lbnRzIE1lc3NhZ2VIYW5kbGVyIHsKCiAgICAgICAgcHJpdmF0ZSBm\naW5hbCBTeW5jaHJvbm91c1F1ZXVlPEJvb2xlYW4+IGNvbnN1bWVRdWV1ZTsK\nCiAgICAgICAgcHVibGljIFRlc3RNZXNzYWdlSGFuZGxlcigpIHsKICAgICAg\nICAgICAgdGhpcy5jb25zdW1lUXVldWUgPSBUZXN0UHViU3ViQ2xpZW50LnRo\naXMuY29uc3VtZVF1ZXVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFRl\nc3RNZXNzYWdlSGFuZGxlcihTeW5jaHJvbm91c1F1ZXVlPEJvb2xlYW4+IGNv\nbnN1bWVRdWV1ZSkgewogICAgICAgICAgICB0aGlzLmNvbnN1bWVRdWV1ZSA9\nIGNvbnN1bWVRdWV1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWQsIE1lc3NhZ2UgbXNnLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdCBjb250ZXh0KSB7\nCiAgICAgICAgICAgIG5ldyBUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMg\ndm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5p\nc0RlYnVnRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZGVidWcoIkNvbnN1bWUgb3BlcmF0aW9uIGZpbmlzaGVkIHN1Y2Nlc3Nm\ndWxseSEiKTsKICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW5jeVV0aWxz\nLnB1dChUZXN0TWVzc2FnZUhhbmRsZXIudGhpcy5jb25zdW1lUXVldWUsIHRy\ndWUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5zdGFydCgp\nOwogICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjb250\nZXh0LCBudWxsKTsKICAgICAgICB9CiAgICB9CgogICAgQFBhcmFtZXRlcnMK\nICAgIHB1YmxpYyBzdGF0aWMgQ29sbGVjdGlvbjxPYmplY3RbXT4gY29uZmln\ncygpIHsKICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdChuZXcgT2JqZWN0\nW11bXSB7IHsgdHJ1ZSB9LCB7IGZhbHNlIH0gfSk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaXNTdWJzY3JpcHRpb25DaGFubmVsU2hhcmluZ0Vu\nYWJsZWQ7CgogICAgcHVibGljIFRlc3RQdWJTdWJDbGllbnQoYm9vbGVhbiBp\nc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZCkgewogICAgICAg\nIHRoaXMuaXNTdWJzY3JpcHRpb25DaGFubmVsU2hhcmluZ0VuYWJsZWQgPSBp\nc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZDsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldFVw\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc2V0VXAoKTsK\nICAgICAgICBjbGllbnQgPSBuZXcgSGVkd2lnQ2xpZW50KG5ldyBDbGllbnRD\nb25maWd1cmF0aW9uKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIEhlZHdpZ1NvY2tldEFkZHJlc3MgZ2V0RGVmYXVsdFNl\ncnZlckhlZHdpZ1NvY2tldEFkZHJlc3MoKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gZ2V0RGVmYXVsdEhlZHdpZ0FkZHJlc3MoKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGlzU3Vic2NyaXB0aW9uQ2hhbm5lbFNoYXJpbmdFbmFibGVkKCkg\newogICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RQdWJTdWJDbGllbnQudGhp\ncy5pc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZDsKICAgICAg\nICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHB1Ymxpc2hlciA9IGNsaWVu\ndC5nZXRQdWJsaXNoZXIoKTsKICAgICAgICBzdWJzY3JpYmVyID0gY2xpZW50\nLmdldFN1YnNjcmliZXIoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIEBB\nZnRlcgogICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBjbGllbnQuY2xvc2UoKTsKICAgICAgICBzdXBlci50\nZWFyRG93bigpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0U3luY1B1Ymxpc2goKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBib29sZWFuIHB1Ymxpc2hTdWNjZXNzID0gdHJ1ZTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBwdWJsaXNoZXIucHVibGlzaChC\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlTeW5jVG9waWMiKSwgTWVzc2Fn\nZS5uZXdCdWlsZGVyKCkuc2V0Qm9keSgKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJIZWxsbyBT\neW5jIFdvcmxkISIpKS5idWlsZCgpKTsKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBwdWJsaXNoU3VjY2VzcyA9IGZhbHNl\nOwogICAgICAgIH0KICAgICAgICBhc3NlcnRUcnVlKHB1Ymxpc2hTdWNjZXNz\nKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdFN5bmNQdWJsaXNoV2l0aFJlc3BvbnNlKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJp\nbmcuY29weUZyb21VdGY4KCJ0ZXN0U3luY1B1Ymxpc2hXaXRoUmVzcG9uc2Ui\nKTsKICAgICAgICBCeXRlU3RyaW5nIHN1YmlkID0gQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgoIm15c3ViaWQiKTsKCiAgICAgICAgZmluYWwgU3RyaW5nIHBy\nZWZpeCA9ICJTeW5jTWVzc2FnZS0iOwogICAgICAgIGZpbmFsIGludCBudW1N\nZXNzYWdlcyA9IDMwOwoKICAgICAgICBmaW5hbCBNYXA8U3RyaW5nLCBNZXNz\nYWdlU2VxSWQ+IHB1Ymxpc2hlZE1zZ3MgPQogICAgICAgICAgICBuZXcgSGFz\naE1hcDxTdHJpbmcsIE1lc3NhZ2VTZXFJZD4oKTsKCiAgICAgICAgZmluYWwg\nQXRvbWljSW50ZWdlciBudW1SZWNlaXZlZCA9IG5ldyBBdG9taWNJbnRlZ2Vy\nKDApOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHJlY2VpdmVMYXRj\naCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBmaW5hbCBNYXA8\nU3RyaW5nLCBNZXNzYWdlU2VxSWQ+IHJlY2VpdmVkTXNncyA9CiAgICAgICAg\nICAgIG5ldyBIYXNoTWFwPFN0cmluZywgTWVzc2FnZVNlcUlkPigpOwoKICAg\nICAgICBzdWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIENyZWF0\nZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpOwogICAgICAgIHN1YnNjcmli\nZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3ViaWQsIG5ldyBNZXNzYWdlSGFu\nZGxlcigpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lk\nIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIE1lc3NhZ2UgbXNnLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBzdHIg\nPSBtc2cuZ2V0Qm9keSgpLnRvU3RyaW5nVXRmOCgpOwogICAgICAgICAgICAg\nICAgcmVjZWl2ZWRNc2dzLnB1dChzdHIsIG1zZy5nZXRNc2dJZCgpKTsgCiAg\nICAgICAgICAgICAgICBpZiAobnVtTWVzc2FnZXMgPT0gbnVtUmVjZWl2ZWQu\naW5jcmVtZW50QW5kR2V0KCkpIHsKICAgICAgICAgICAgICAgICAgICByZWNl\naXZlTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjb250ZXh0\nLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBm\nb3IgKGludCBpPTA7IGk8bnVtTWVzc2FnZXM7IGkrKykgewogICAgICAgICAg\nICBTdHJpbmcgc3RyID0gcHJlZml4ICsgaTsKICAgICAgICAgICAgQnl0ZVN0\ncmluZyBkYXRhID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgoc3RyKTsKICAg\nICAgICAgICAgTWVzc2FnZSBtc2cgPSBNZXNzYWdlLm5ld0J1aWxkZXIoKS5z\nZXRCb2R5KGRhdGEpLmJ1aWxkKCk7CiAgICAgICAgICAgIFB1Ymxpc2hSZXNw\nb25zZSByZXNwb25zZSA9IHB1Ymxpc2hlci5wdWJsaXNoKHRvcGljLCBtc2cp\nOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKHJlc3BvbnNlKTsKICAgICAg\nICAgICAgcHVibGlzaGVkTXNncy5wdXQoc3RyLCByZXNwb25zZS5nZXRQdWJs\naXNoZWRNc2dJZCgpKTsKICAgICAgICB9CgogICAgICAgIGFzc2VydFRydWUo\nIlRpbWVkIG91dCB3YWl0aW5nIG9uIGNhbGxiYWNrIGZvciBtZXNzYWdlcy4i\nLAogICAgICAgICAgICAgICAgICAgcmVjZWl2ZUxhdGNoLmF3YWl0KDMwLCBU\naW1lVW5pdC5TRUNPTkRTKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91\nbGQgYmUgZXhwZWN0ZWQgIiArIG51bU1lc3NhZ2VzICsgIiBtZXNzYWdlcy4i\nLAogICAgICAgICAgICAgICAgICAgICBudW1NZXNzYWdlcywgbnVtUmVjZWl2\nZWQuZ2V0KCkpOwogICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIGV4\ncGVjdGVkICIgKyBudW1NZXNzYWdlcyArICIgbWVzc2FnZXMgaW4gbWFwLiIs\nCiAgICAgICAgICAgICAgICAgICAgIG51bU1lc3NhZ2VzLCByZWNlaXZlZE1z\nZ3Muc2l6ZSgpKTsKCiAgICAgICAgZm9yIChpbnQgaT0wOyBpPG51bU1lc3Nh\nZ2VzOyBpKyspIHsKICAgICAgICAgICAgZmluYWwgU3RyaW5nIHN0ciA9IHBy\nZWZpeCArIGk7CiAgICAgICAgICAgIE1lc3NhZ2VTZXFJZCBwdWJJZCA9IHB1\nYmxpc2hlZE1zZ3MuZ2V0KHN0cik7CiAgICAgICAgICAgIE1lc3NhZ2VTZXFJ\nZCByZXZJZCA9IHJlY2VpdmVkTXNncy5nZXQoc3RyKTsKICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZSgiRG9lc24ndCByZWNlaXZlIHNhbWUgbWVzc2FnZSBzZXEg\naWQgZm9yICIgKyBzdHIsCiAgICAgICAgICAgICAgICAgICAgICAgcHViSWQu\nZXF1YWxzKHJldklkKSk7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRp\nbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0QXN5bmNQdWJsaXNo\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgcHVibGlzaGVyLmFzeW5j\nUHVibGlzaChCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlBc3luY1RvcGlj\nIiksIE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgoIkhlbGxvIEFzeW5jIFdvcmxkISIpKS5idWlsZCgpLCBuZXcgVGVzdENh\nbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRydWUocXVldWUudGFr\nZSgpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdEFzeW5jUHVibGlzaFdpdGhSZXNwb25zZSgpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRl\nU3RyaW5nLmNvcHlGcm9tVXRmOCgidGVzdEFzeW5jUHVibGlzaFdpdGhSZXNw\nb25zZSIpOwogICAgICAgIEJ5dGVTdHJpbmcgc3ViaWQgPSBCeXRlU3RyaW5n\nLmNvcHlGcm9tVXRmOCgibXlzdWJpZCIpOwoKICAgICAgICBmaW5hbCBTdHJp\nbmcgcHJlZml4ID0gIkFzeW5jTWVzc2FnZS0iOwogICAgICAgIGZpbmFsIGlu\ndCBudW1NZXNzYWdlcyA9IDMwOwoKICAgICAgICBmaW5hbCBBdG9taWNJbnRl\nZ2VyIG51bVB1Ymxpc2hlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKDApOwogICAg\nICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHB1Ymxpc2hMYXRjaCA9IG5ldyBD\nb3VudERvd25MYXRjaCgxKTsKICAgICAgICBmaW5hbCBNYXA8U3RyaW5nLCBN\nZXNzYWdlU2VxSWQ+IHB1Ymxpc2hlZE1zZ3MgPQogICAgICAgICAgICBuZXcg\nSGFzaE1hcDxTdHJpbmcsIE1lc3NhZ2VTZXFJZD4oKTsKCiAgICAgICAgZmlu\nYWwgQXRvbWljSW50ZWdlciBudW1SZWNlaXZlZCA9IG5ldyBBdG9taWNJbnRl\nZ2VyKDApOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHJlY2VpdmVM\nYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBmaW5hbCBN\nYXA8U3RyaW5nLCBNZXNzYWdlU2VxSWQ+IHJlY2VpdmVkTXNncyA9CiAgICAg\nICAgICAgIG5ldyBIYXNoTWFwPFN0cmluZywgTWVzc2FnZVNlcUlkPigpOwoK\nICAgICAgICBzdWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIENy\nZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpOwogICAgICAgIHN1YnNj\ncmliZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3ViaWQsIG5ldyBNZXNzYWdl\nSGFuZGxlcigpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2\nb2lkIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIE1lc3NhZ2UgbXNnLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFj\naywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBz\ndHIgPSBtc2cuZ2V0Qm9keSgpLnRvU3RyaW5nVXRmOCgpOwogICAgICAgICAg\nICAgICAgcmVjZWl2ZWRNc2dzLnB1dChzdHIsIG1zZy5nZXRNc2dJZCgpKTsg\nCiAgICAgICAgICAgICAgICBpZiAobnVtTWVzc2FnZXMgPT0gbnVtUmVjZWl2\nZWQuaW5jcmVtZW50QW5kR2V0KCkpIHsKICAgICAgICAgICAgICAgICAgICBy\nZWNlaXZlTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjb250\nZXh0LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAg\nICBmb3IgKGludCBpPTA7IGk8bnVtTWVzc2FnZXM7IGkrKykgewogICAgICAg\nICAgICBmaW5hbCBTdHJpbmcgc3RyID0gcHJlZml4ICsgaTsKICAgICAgICAg\nICAgQnl0ZVN0cmluZyBkYXRhID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nc3RyKTsKICAgICAgICAgICAgTWVzc2FnZSBtc2cgPSBNZXNzYWdlLm5ld0J1\naWxkZXIoKS5zZXRCb2R5KGRhdGEpLmJ1aWxkKCk7CiAgICAgICAgICAgIHB1\nYmxpc2hlci5hc3luY1B1Ymxpc2hXaXRoUmVzcG9uc2UodG9waWMsIG1zZywg\nbmV3IENhbGxiYWNrPFB1Ymxpc2hSZXNwb25zZT4oKSB7CiAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9w\nZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFB1Ymxpc2hSZXNwb25zZSBy\nZXNwb25zZSkgewogICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hlZE1zZ3Mu\ncHV0KHN0ciwgcmVzcG9uc2UuZ2V0UHVibGlzaGVkTXNnSWQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKG51bU1lc3NhZ2VzID09IG51bVB1Ymxpc2hl\nZC5pbmNyZW1lbnRBbmRHZXQoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBwdWJsaXNoTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWls\nZWQoT2JqZWN0IGN0eCwgZmluYWwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlv\nbikgewogICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hMYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbnVsbCk7\nCiAgICAgICAgfQogICAgICAgIGFzc2VydFRydWUoIlRpbWVkIG91dCB3YWl0\naW5nIG9uIGNhbGxiYWNrIGZvciBwdWJsaXNoIHJlcXVlc3RzLiIsCiAgICAg\nICAgICAgICAgICAgICBwdWJsaXNoTGF0Y2guYXdhaXQoMTAsIFRpbWVVbml0\nLlNFQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBl\neHBlY3RlZCAiICsgbnVtTWVzc2FnZXMgKyAiIHB1Ymxpc2hlcy4iLAogICAg\nICAgICAgICAgICAgICAgICBudW1NZXNzYWdlcywgbnVtUHVibGlzaGVkLmdl\ndCgpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBleHBlY3Rl\nZCAiICsgbnVtTWVzc2FnZXMgKyAiIHB1Ymxpc2hlIHJlc3BvbnNlcy4iLAog\nICAgICAgICAgICAgICAgICAgICBudW1NZXNzYWdlcywgcHVibGlzaGVkTXNn\ncy5zaXplKCkpOwoKICAgICAgICBhc3NlcnRUcnVlKCJUaW1lZCBvdXQgd2Fp\ndGluZyBvbiBjYWxsYmFjayBmb3IgbWVzc2FnZXMuIiwKICAgICAgICAgICAg\nICAgICAgIHJlY2VpdmVMYXRjaC5hd2FpdCgzMCwgVGltZVVuaXQuU0VDT05E\nUykpOwogICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIGV4cGVjdGVk\nICIgKyBudW1NZXNzYWdlcyArICIgbWVzc2FnZXMuIiwKICAgICAgICAgICAg\nICAgICAgICAgbnVtTWVzc2FnZXMsIG51bVJlY2VpdmVkLmdldCgpKTsKICAg\nICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBleHBlY3RlZCAiICsgbnVt\nTWVzc2FnZXMgKyAiIG1lc3NhZ2VzIGluIG1hcC4iLAogICAgICAgICAgICAg\nICAgICAgICBudW1NZXNzYWdlcywgcmVjZWl2ZWRNc2dzLnNpemUoKSk7Cgog\nICAgICAgIGZvciAoaW50IGk9MDsgaTxudW1NZXNzYWdlczsgaSsrKSB7CiAg\nICAgICAgICAgIGZpbmFsIFN0cmluZyBzdHIgPSBwcmVmaXggKyBpOwogICAg\nICAgICAgICBNZXNzYWdlU2VxSWQgcHViSWQgPSBwdWJsaXNoZWRNc2dzLmdl\ndChzdHIpOwogICAgICAgICAgICBNZXNzYWdlU2VxSWQgcmV2SWQgPSByZWNl\naXZlZE1zZ3MuZ2V0KHN0cik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIkRv\nZXNuJ3QgcmVjZWl2ZSBzYW1lIG1lc3NhZ2Ugc2VxIGlkIGZvciAiICsgc3Ry\nLAogICAgICAgICAgICAgICAgICAgICAgIHB1YklkLmVxdWFscyhyZXZJZCkp\nOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdE11bHRpcGxlQXN5bmNQdWJsaXNoKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYzEgPSBC\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlGaXJzdFRvcGljIik7CiAgICAg\nICAgQnl0ZVN0cmluZyB0b3BpYzIgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRm\nOCgibXlOZXdUb3BpYyIpOwoKICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJs\naXNoKHRvcGljMSwgTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShCeXRl\nU3RyaW5nLmNvcHlGcm9tVXRmOCgiSGVsbG8gV29ybGQhIikpLmJ1aWxkKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVGVzdENhbGxi\nYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRydWUocXVldWUudGFrZSgp\nKTsKICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJsaXNoKHRvcGljMiwgTWVz\nc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOCgiSGVsbG8gb24gbmV3IHRvcGljISIpKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLmJ1aWxkKCksIG5ldyBUZXN0Q2FsbGJhY2soKSwg\nbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAg\nICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMxLCBNZXNzYWdlLm5l\nd0J1aWxkZXIoKS5zZXRCb2R5KAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJIZWxsbyBBZ2Fp\nbiBvbiBvbGQgdG9waWMhIikpLmJ1aWxkKCksIG5ldyBUZXN0Q2FsbGJhY2so\nKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwog\nICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0U3luY1N1YnNjcmliZSgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGJvb2xlYW4gc3Vic2NyaWJlU3VjY2VzcyA9IHRydWU7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUoQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0ZjgoIm15U3luY1N1YnNjcmliZVRvcGljIiksIEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KCIxIiksIENyZWF0ZU9yQXR0YWNoLkNS\nRUFURV9PUl9BVFRBQ0gpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHN1YnNjcmliZVN1Y2Nlc3MgPSBmYWxzZTsKICAg\nICAgICB9CiAgICAgICAgYXNzZXJ0VHJ1ZShzdWJzY3JpYmVTdWNjZXNzKTsK\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEFzeW5jU3Vic2NyaWJlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgc3Vic2NyaWJlci5hc3luY1N1YnNjcmliZShCeXRlU3RyaW5nLmNv\ncHlGcm9tVXRmOCgibXlBc3luY1N1YnNjcmliZVRvcGljIiksIEJ5dGVTdHJp\nbmcuY29weUZyb21VdGY4KCIxIiksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNILCBu\nZXcgVGVzdENhbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRydWUo\ncXVldWUudGFrZSgpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdFN0YXJ0RGVsaXZlcnlBZnRlckNsb3Nl\nU3ViKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0\nb3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJ0ZXN0U3RhcnREZWxp\ndmVyeUFmdGVyQ2xvc2VTdWIiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1Ymlk\nID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15c3ViaWQiKTsKICAgICAg\nICBzdWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIENyZWF0ZU9y\nQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpOwoKICAgICAgICAvLyBTdGFydCBk\nZWxpdmVyeSBmb3IgdGhlIHN1YnNjcmliZXIKICAgICAgICBzdWJzY3JpYmVy\nLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YmlkLCBuZXcgVGVzdE1lc3NhZ2VI\nYW5kbGVyKCkpOwoKICAgICAgICAvLyBOb3cgcHVibGlzaCBzb21lIG1lc3Nh\nZ2VzIGZvciB0aGUgdG9waWMgdG8gYmUgY29uc3VtZWQgYnkgdGhlCiAgICAg\nICAgLy8gc3Vic2NyaWJlci4KICAgICAgICBwdWJsaXNoZXIucHVibGlzaCh0\nb3BpYywgTWVzc2FnZS5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAuc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9tVXRm\nOCgiTWVzc2FnZSAjMSIpKS5idWlsZCgpKTsKICAgICAgICBhc3NlcnRUcnVl\nKGNvbnN1bWVRdWV1ZS50YWtlKCkpOwoKICAgICAgICAvLyBDbG9zZSBzdWJz\nY3JpYmVyIGZvciB0aGUgc3Vic2NyaWJlcgogICAgICAgIHN1YnNjcmliZXIu\nY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YmlkKTsKCiAgICAgICAgLy8g\nc3Vic2NyaWJlIGFnYWluCiAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUo\ndG9waWMsIHN1YmlkLCBDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNI\nKTsKICAgICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1\nYmlkLCBuZXcgVGVzdE1lc3NhZ2VIYW5kbGVyKCkpOwoKICAgICAgICBwdWJs\naXNoZXIucHVibGlzaCh0b3BpYywgTWVzc2FnZS5uZXdCdWlsZGVyKCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0Qm9keShCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOCgiTWVzc2FnZSAjMiIpKS5idWlsZCgpKTsKICAg\nICAgICBhc3NlcnRUcnVlKGNvbnN1bWVRdWV1ZS50YWtlKCkpOwogICAgfQoK\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nU3Vic2NyaWJlQW5kQ29uc3VtZSgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRm\nOCgibXlDb25zdW1lVG9waWMiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1YnNj\ncmliZXJJZCA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCIxIik7CiAgICAg\nICAgc3Vic2NyaWJlci5hc3luY1N1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJl\ncklkLCBDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNILCBuZXcgVGVz\ndENhbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRydWUocXVldWUu\ndGFrZSgpKTsKCiAgICAgICAgLy8gU3RhcnQgZGVsaXZlcnkgZm9yIHRoZSBz\ndWJzY3JpYmVyCiAgICAgICAgc3Vic2NyaWJlci5zdGFydERlbGl2ZXJ5KHRv\ncGljLCBzdWJzY3JpYmVySWQsIG5ldyBUZXN0TWVzc2FnZUhhbmRsZXIoKSk7\nCgogICAgICAgIC8vIE5vdyBwdWJsaXNoIHNvbWUgbWVzc2FnZXMgZm9yIHRo\nZSB0b3BpYyB0byBiZSBjb25zdW1lZCBieSB0aGUKICAgICAgICAvLyBzdWJz\nY3JpYmVyLgogICAgICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMs\nIE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgoIk1lc3NhZ2UgIzEiKSkuYnVpbGQoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBUZXN0Q2FsbGJhY2soKSwgbnVsbCk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIGFz\nc2VydFRydWUoY29uc3VtZVF1ZXVlLnRha2UoKSk7CiAgICAgICAgcHVibGlz\naGVyLmFzeW5jUHVibGlzaCh0b3BpYywgTWVzc2FnZS5uZXdCdWlsZGVyKCku\nc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiTWVzc2FnZSAjMiIp\nKS5idWlsZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nIFRlc3RDYWxsYmFjaygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVlKHF1\nZXVlLnRha2UoKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUu\ndGFrZSgpKTsKICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJsaXNoKHRvcGlj\nLCBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5KEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJNZXNzYWdlICMzIikpLmJ1aWxkKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBuZXcgVGVzdENhbGxiYWNrKCksIG51bGwp\nOwogICAgICAgIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBh\nc3NlcnRUcnVlKGNvbnN1bWVRdWV1ZS50YWtlKCkpOwogICAgICAgIHB1Ymxp\nc2hlci5hc3luY1B1Ymxpc2godG9waWMsIE1lc3NhZ2UubmV3QnVpbGRlcigp\nLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIk1lc3NhZ2UgIzQi\nKSkuYnVpbGQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBUZXN0Q2FsbGJhY2soKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShx\ndWV1ZS50YWtlKCkpOwogICAgICAgIGFzc2VydFRydWUoY29uc3VtZVF1ZXVl\nLnRha2UoKSk7CiAgICAgICAgcHVibGlzaGVyLmFzeW5jUHVibGlzaCh0b3Bp\nYywgTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShCeXRlU3RyaW5nLmNv\ncHlGcm9tVXRmOCgiTWVzc2FnZSAjNSIpKS5idWlsZCgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbmV3IFRlc3RDYWxsYmFjaygpLCBudWxs\nKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAg\nYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgpKTsKICAgIH0KCiAgICBA\nVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEFzeW5j\nU3Vic2NyaWJlQW5kVW5zdWJzY3JpYmUoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJv\nbVV0ZjgoIm15QXN5bmNVbnN1YlRvcGljIik7CiAgICAgICAgQnl0ZVN0cmlu\nZyBzdWJzY3JpYmVySWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiMSIp\nOwogICAgICAgIHN1YnNjcmliZXIuYXN5bmNTdWJzY3JpYmUodG9waWMsIHN1\nYnNjcmliZXJJZCwgQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSCwg\nbmV3IFRlc3RDYWxsYmFjaygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVl\nKHF1ZXVlLnRha2UoKSk7CiAgICAgICAgc3Vic2NyaWJlci5hc3luY1Vuc3Vi\nc2NyaWJlKHRvcGljLCBzdWJzY3JpYmVySWQsIG5ldyBUZXN0Q2FsbGJhY2so\nKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwog\nICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0U3luY1Vuc3Vic2NyaWJlV2l0aG91dFN1YnNjcmlwdGlvbigpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIGJvb2xlYW4gdW5zdWJzY3JpYmVT\ndWNjZXNzID0gZmFsc2U7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3Vi\nc2NyaWJlci51bnN1YnNjcmliZShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgi\nbXlTeW5jVW5zdWJUb3BpYyIpLCBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgi\nMSIpKTsKICAgICAgICB9IGNhdGNoIChDbGllbnROb3RTdWJzY3JpYmVkRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgdW5zdWJzY3JpYmVTdWNjZXNzID0g\ndHJ1ZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsKICAgICAg\nICAgICAgdW5zdWJzY3JpYmVTdWNjZXNzID0gZmFsc2U7CiAgICAgICAgfQog\nICAgICAgIGFzc2VydFRydWUodW5zdWJzY3JpYmVTdWNjZXNzKTsKICAgIH0K\nCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndEFzeW5jU3Vic2NyaWJlQW5kQ2xvc2VTdWJzY3JpcHRpb24oKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0ZjgoIm15QXN5bmNTdWJBbmRDbG9zZVN1YlRvcGlj\nIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQgPSBCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOCgiMSIpOwogICAgICAgIHN1YnNjcmliZXIuYXN5\nbmNTdWJzY3JpYmUodG9waWMsIHN1YnNjcmliZXJJZCwgQ3JlYXRlT3JBdHRh\nY2guQ1JFQVRFX09SX0FUVEFDSCwgbmV3IFRlc3RDYWxsYmFjaygpLCBudWxs\nKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAg\nc3Vic2NyaWJlci5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3Vic2NyaWJl\ncklkKTsKICAgICAgICBhc3NlcnRUcnVlKHRydWUpOwogICAgfQoKICAgIEBU\nZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3ViQ2xv\nc2VzdWJBbmRQdWJsaXNoKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJt\neVN1YkNsb3Nlc3ViQW5kUHVibGlzaCIpOwogICAgICAgIEJ5dGVTdHJpbmcg\nc3ViaWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlzdWIiKTsKICAg\nICAgICAvLyB0byBwb3B1bGF0ZSBzdGFydFNlcnZpbmcvc3RvcFNlcnZpbmcg\nc2VxdWV1ZW5jZQogICAgICAgIGZvciAoaW50IGk9MDsgaTw1OyBpKyspIHsK\nICAgICAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1Ymlk\nLCBDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIKTsKICAgICAgICAg\nICAgc3Vic2NyaWJlci5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQp\nOwogICAgICAgIH0KICAgICAgICBzdWJzY3JpYmVyLnN1YnNjcmliZSh0b3Bp\nYywgc3ViaWQsIENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpOwog\nICAgICAgIHN1YnNjcmliZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3ViaWQs\nIG5ldyBUZXN0TWVzc2FnZUhhbmRsZXIoKSk7CiAgICAgICAgZm9yIChpbnQg\naT0wOyBpPDM7IGkrKykgewogICAgICAgICAgICBwdWJsaXNoZXIuYXN5bmNQ\ndWJsaXNoKHRvcGljLAogICAgICAgICAgICAgICAgTWVzc2FnZS5uZXdCdWls\nZGVyKCkuc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiTWVzc2Fn\nZSAjIiArIGkpKS5idWlsZCgpLAogICAgICAgICAgICAgICAgbmV3IFRlc3RD\nYWxsYmFjaygpLCBudWxsKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1\nZS50YWtlKCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKGNvbnN1bWVRdWV1\nZS50YWtlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN5bmNTdWJzY3JpYmVXaXRo\nTGlzdGVuZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3Ry\naW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15U3luY1N1\nYnNjcmliZVdpdGhMaXN0ZW5lciIpOwogICAgICAgIEJ5dGVTdHJpbmcgc3Vi\nc2NyaWJlcklkID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15c3ViIik7\nCiAgICAgICAgc3Vic2NyaWJlci5hZGRTdWJzY3JpcHRpb25MaXN0ZW5lcihu\nZXcgVGVzdFN1YnNjcmlwdGlvbkxpc3RlbmVyKCkpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0aW9ucyA9CiAg\nICAgICAgICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1aWxkZXIo\nKQogICAgICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKENyZWF0ZU9y\nQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpCiAgICAgICAgICAgICAgICAuc2V0\nRW5hYmxlUmVzdWJzY3JpYmUoZmFsc2UpLmJ1aWxkKCk7CiAgICAgICAgICAg\nIHN1YnNjcmliZXIuc3Vic2NyaWJlKHRvcGljLCBzdWJzY3JpYmVySWQsIG9w\ndGlvbnMpOwogICAgICAgIH0gY2F0Y2ggKFB1YlN1YkV4Y2VwdGlvbi5TZXJ2\naWNlRG93bkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGZhaWwoIlNob3Vs\nZCBub3QgcmVhY2ggaGVyZSEiKTsKICAgICAgICB9CiAgICAgICAgc3Vic2Ny\naWJlci5zdGFydERlbGl2ZXJ5KHRvcGljLCBzdWJzY3JpYmVySWQsIG5ldyBU\nZXN0TWVzc2FnZUhhbmRsZXIoKSk7CiAgICAgICAgdGVhckRvd25IdWJTZXJ2\nZXIoKTsKICAgICAgICBhc3NlcnRFcXVhbHMoU3Vic2NyaXB0aW9uRXZlbnQu\nVE9QSUNfTU9WRUQsIGV2ZW50UXVldWUudGFrZSgpKTsKICAgIH0KCiAgICBA\nVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEFzeW5j\nU3Vic2NyaWJlV2l0aExpc3RlbmVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21V\ndGY4KCJteUFzeW5jU3Vic2NyaWJlV2l0aExpc3RlbmVyIik7CiAgICAgICAg\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOCgibXlzdWIiKTsKICAgICAgICBzdWJzY3JpYmVyLmFkZFN1YnNjcmlw\ndGlvbkxpc3RlbmVyKG5ldyBUZXN0U3Vic2NyaXB0aW9uTGlzdGVuZXIoKSk7\nCiAgICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zID0KICAgICAg\nICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkKICAgICAg\nICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKENyZWF0ZU9yQXR0YWNoLkNSRUFU\nRV9PUl9BVFRBQ0gpCiAgICAgICAgICAgIC5zZXRFbmFibGVSZXN1YnNjcmli\nZShmYWxzZSkuYnVpbGQoKTsKICAgICAgICBzdWJzY3JpYmVyLmFzeW5jU3Vi\nc2NyaWJlKHRvcGljLCBzdWJzY3JpYmVySWQsIG9wdGlvbnMsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVGVzdENhbGxiYWNrKCks\nIG51bGwpOwogICAgICAgIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAg\nICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YnNjcmli\nZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcigpKTsKICAgICAgICB0ZWFy\nRG93bkh1YlNlcnZlcigpOwogICAgICAgIGFzc2VydEVxdWFscyhTdWJzY3Jp\ncHRpb25FdmVudC5UT1BJQ19NT1ZFRCwgZXZlbnRRdWV1ZS50YWtlKCkpOwog\nICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0U3luY1N1YnNjcmliZUZvcmNlQXR0YWNoKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJteVN5bmNTdWJzY3JpYmVGb3JjZUF0dGFjaCIpOwog\nICAgICAgIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkID0gQnl0ZVN0cmluZy5j\nb3B5RnJvbVV0ZjgoIm15c3ViIik7CiAgICAgICAgc3Vic2NyaWJlci5hZGRT\ndWJzY3JpcHRpb25MaXN0ZW5lcihuZXcgVGVzdFN1YnNjcmlwdGlvbkxpc3Rl\nbmVyKCkpOwogICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0aW9ucyA9\nCiAgICAgICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgIC5zZXRDcmVhdGVPckF0dGFjaChDcmVhdGVPckF0dGFj\naC5DUkVBVEVfT1JfQVRUQUNIKQogICAgICAgICAgICAuc2V0Rm9yY2VBdHRh\nY2godHJ1ZSkuc2V0RW5hYmxlUmVzdWJzY3JpYmUoZmFsc2UpLmJ1aWxkKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3Vic2NyaWJlci5zdWJzY3Jp\nYmUodG9waWMsIHN1YnNjcmliZXJJZCwgb3B0aW9ucyk7CiAgICAgICAgfSBj\nYXRjaCAoUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlISIp\nOwogICAgICAgIH0KICAgICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnko\ndG9waWMsIHN1YnNjcmliZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcigp\nKTsKCiAgICAgICAgLy8gbmV3IGEgY2xpZW50CiAgICAgICAgSGVkd2lnQ2xp\nZW50IGNsaWVudDIgPSBuZXcgSGVkd2lnQ2xpZW50KG5ldyBDbGllbnRDb25m\naWd1cmF0aW9uKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICBwdWJsaWMgSGVkd2lnU29ja2V0QWRkcmVzcyBnZXREZWZh\ndWx0U2VydmVySGVkd2lnU29ja2V0QWRkcmVzcygpIHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZ2V0RGVmYXVsdEhlZHdpZ0FkZHJlc3MoKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgU3Vic2Ny\naWJlciBzdWJzY3JpYmVyMiA9IGNsaWVudDIuZ2V0U3Vic2NyaWJlcigpOwog\nICAgICAgIFB1Ymxpc2hlciBwdWJsaXNoZXIyID0gY2xpZW50Mi5nZXRQdWJs\naXNoZXIoKTsKICAgICAgICBTeW5jaHJvbm91c1F1ZXVlPFN1YnNjcmlwdGlv\nbkV2ZW50PiBldmVudFF1ZXVlMiA9CiAgICAgICAgICAgIG5ldyBTeW5jaHJv\nbm91c1F1ZXVlPFN1YnNjcmlwdGlvbkV2ZW50PigpOwogICAgICAgIHN1YnNj\ncmliZXIyLmFkZFN1YnNjcmlwdGlvbkxpc3RlbmVyKG5ldyBUZXN0U3Vic2Ny\naXB0aW9uTGlzdGVuZXIoZXZlbnRRdWV1ZTIpKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBzdWJzY3JpYmVyMi5zdWJzY3JpYmUodG9waWMsIHN1YnNj\ncmliZXJJZCwgb3B0aW9ucyk7CiAgICAgICAgfSBjYXRjaCAoUHViU3ViRXhj\nZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nZmFpbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlISIpOwogICAgICAgIH0KCiAg\nICAgICAgU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPiBjb25zdW1lUXVldWUy\nID0gbmV3IFN5bmNocm9ub3VzUXVldWU8Qm9vbGVhbj4oKTsKICAgICAgICBz\ndWJzY3JpYmVyMi5zdGFydERlbGl2ZXJ5KHRvcGljLCBzdWJzY3JpYmVySWQs\nIG5ldyBUZXN0TWVzc2FnZUhhbmRsZXIoY29uc3VtZVF1ZXVlMikpOwoKICAg\nICAgICBhc3NlcnRFcXVhbHMoU3Vic2NyaXB0aW9uRXZlbnQuU1VCU0NSSVBU\nSU9OX0ZPUkNFRF9DTE9TRUQsIGV2ZW50UXVldWUudGFrZSgpKTsKICAgICAg\nICBhc3NlcnRUcnVlKGV2ZW50UXVldWUyLmlzRW1wdHkoKSk7CgogICAgICAg\nIC8vIE5vdyBwdWJsaXNoIHNvbWUgbWVzc2FnZXMgZm9yIHRoZSB0b3BpYyB0\nbyBiZSBjb25zdW1lZCBieSB0aGUKICAgICAgICAvLyBzdWJzY3JpYmVyLgog\nICAgICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMsIE1lc3NhZ2Uu\nbmV3QnVpbGRlcigpLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nIk1lc3NhZ2UgIzEiKSkuYnVpbGQoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG5ldyBUZXN0Q2FsbGJhY2soKSwgbnVsbCk7CiAgICAgICAg\nYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIGFzc2VydFRydWUo\nY29uc3VtZVF1ZXVlMi50YWtlKCkpOwogICAgICAgIGFzc2VydFRydWUoY29u\nc3VtZVF1ZXVlLmlzRW1wdHkoKSk7CgogICAgICAgIHB1Ymxpc2hlcjIuYXN5\nbmNQdWJsaXNoKHRvcGljLCBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5\nKEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJNZXNzYWdlICMyIikpLmJ1aWxk\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVGVzdENh\nbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRydWUocXVldWUudGFr\nZSgpKTsKICAgICAgICBhc3NlcnRUcnVlKGNvbnN1bWVRdWV1ZTIudGFrZSgp\nKTsKICAgICAgICBhc3NlcnRUcnVlKGNvbnN1bWVRdWV1ZS5pc0VtcHR5KCkp\nOwoKICAgICAgICBjbGllbnQyLmNsb3NlKCk7CiAgICB9CgogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTeW5jU3Vic2Ny\naWJlV2l0aExpc3RlbmVyV2hlblJlbGVhc2luZ1RvcGljKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgY2xpZW50LmNsb3NlKCk7CgogICAgICAgIHRl\nYXJEb3duSHViU2VydmVyKCk7CiAgICAgICAgc3RhcnRIdWJTZXJ2ZXIobmV3\nIFJldGVudGlvblNlcnZlckNvbmZpZ3VyYXRpb24oKSk7CiAgICAgICAgY2xp\nZW50ID0gbmV3IEhlZHdpZ0NsaWVudChuZXcgQ2xpZW50Q29uZmlndXJhdGlv\nbigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyBIZWR3aWdTb2NrZXRBZGRyZXNzIGdldERlZmF1bHRTZXJ2ZXJIZWR3aWdT\nb2NrZXRBZGRyZXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldERl\nZmF1bHRIZWR3aWdBZGRyZXNzKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1N1\nYnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZCgpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBUZXN0UHViU3ViQ2xpZW50LnRoaXMuaXNTdWJzY3Jp\ncHRpb25DaGFubmVsU2hhcmluZ0VuYWJsZWQ7CiAgICAgICAgICAgIH0KICAg\nICAgICB9KTsKICAgICAgICBwdWJsaXNoZXIgPSBjbGllbnQuZ2V0UHVibGlz\naGVyKCk7CiAgICAgICAgc3Vic2NyaWJlciA9IGNsaWVudC5nZXRTdWJzY3Jp\nYmVyKCk7CgogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5n\nLmNvcHlGcm9tVXRmOCgibXlTeW5jU3Vic2NyaWJlV2l0aExpc3RlbmVyV2hl\nblJlbGVhc2luZ1RvcGljIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlzdWIiKTsKICAg\nICAgICBzdWJzY3JpYmVyLmFkZFN1YnNjcmlwdGlvbkxpc3RlbmVyKG5ldyBU\nZXN0U3Vic2NyaXB0aW9uTGlzdGVuZXIoKSk7CiAgICAgICAgU3Vic2NyaXB0\naW9uT3B0aW9ucyBvcHRpb25zID0KICAgICAgICAgICAgU3Vic2NyaXB0aW9u\nT3B0aW9ucy5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgLnNldENyZWF0ZU9y\nQXR0YWNoKENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpCiAgICAg\nICAgICAgIC5zZXRGb3JjZUF0dGFjaChmYWxzZSkuc2V0RW5hYmxlUmVzdWJz\nY3JpYmUoZmFsc2UpLmJ1aWxkKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1YnNjcmliZXJJZCwg\nb3B0aW9ucyk7CiAgICAgICAgfSBjYXRjaCAoUHViU3ViRXhjZXB0aW9uLlNl\ncnZpY2VEb3duRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZmFpbCgiU2hv\ndWxkIG5vdCByZWFjaCBoZXJlISIpOwogICAgICAgIH0KICAgICAgICBzdWJz\nY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YnNjcmliZXJJZCwgbmV3\nIFRlc3RNZXNzYWdlSGFuZGxlcigpKTsKCiAgICAgICAgcHVibGlzaGVyLmFz\neW5jUHVibGlzaCh0b3BpYywgTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9k\neShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiTWVzc2FnZSAjMSIpKS5idWls\nZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFRlc3RD\nYWxsYmFjaygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRh\na2UoKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgp\nKTsKCiAgICAgICAgVGhyZWFkLnNsZWVwKFJFVEVOVElPTl9TRUNTX1ZBTFVF\nICogMik7CiAgICAgICAgYXNzZXJ0RXF1YWxzKFN1YnNjcmlwdGlvbkV2ZW50\nLlRPUElDX01PVkVELCBldmVudFF1ZXVlLnRha2UoKSk7CiAgICB9CgogICAg\nQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RDbG9zZVN1YnNjcmliZUR1cmlu\nZ1Jlc3Vic2NyaWJlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgY2xp\nZW50LmNsb3NlKCk7CgogICAgICAgIGZpbmFsIGxvbmcgcmVjb25uZWN0V2Fp\ndFRpbWUgPSAyMDAwTDsKICAgICAgICBjbGllbnQgPSBuZXcgSGVkd2lnQ2xp\nZW50KG5ldyBDbGllbnRDb25maWd1cmF0aW9uKCkgewogICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIEhlZHdpZ1NvY2tldEFkZHJl\nc3MgZ2V0RGVmYXVsdFNlcnZlckhlZHdpZ1NvY2tldEFkZHJlc3MoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0RGVmYXVsdEhlZHdpZ0FkZHJlc3Mo\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzU3Vic2NyaXB0aW9uQ2hhbm5lbFNo\nYXJpbmdFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RQ\ndWJTdWJDbGllbnQudGhpcy5pc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5n\nRW5hYmxlZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyBsb25nIGdldFN1YnNjcmliZVJlY29ubmVj\ndFJldHJ5V2FpdFRpbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVj\nb25uZWN0V2FpdFRpbWU7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAg\nICAgICAgcHVibGlzaGVyID0gY2xpZW50LmdldFB1Ymxpc2hlcigpOwogICAg\nICAgIHN1YnNjcmliZXIgPSBjbGllbnQuZ2V0U3Vic2NyaWJlcigpOwoKICAg\nICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgoInRlc3RDbG9zZVN1YnNjcmliZUR1cmluZ1Jlc3Vic2NyaWJlIik7CiAg\nICAgICAgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQgPSBCeXRlU3RyaW5nLmNv\ncHlGcm9tVXRmOCgibXlzdWIiKTsKICAgICAgICBzdWJzY3JpYmVyLmFkZFN1\nYnNjcmlwdGlvbkxpc3RlbmVyKG5ldyBUZXN0U3Vic2NyaXB0aW9uTGlzdGVu\nZXIoKSk7CiAgICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zID0K\nICAgICAgICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkK\nICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKENyZWF0ZU9yQXR0YWNo\nLkNSRUFURV9PUl9BVFRBQ0gpCiAgICAgICAgICAgIC5zZXRGb3JjZUF0dGFj\naChmYWxzZSkuc2V0RW5hYmxlUmVzdWJzY3JpYmUodHJ1ZSkuYnVpbGQoKTsK\nICAgICAgICBzdWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJl\ncklkLCBvcHRpb25zKTsKICAgICAgICBsb2dnZXIuaW5mbygiU3Vic2NyaWJl\nZCB0b3BpYyB7fSwgc3Vic2NyaWJlciB7fS4iLCB0b3BpYy50b1N0cmluZ1V0\nZjgoKSwKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVySWQudG9TdHJp\nbmdVdGY4KCkpOwogICAgICAgIHN1YnNjcmliZXIuc3RhcnREZWxpdmVyeSh0\nb3BpYywgc3Vic2NyaWJlcklkLCBuZXcgVGVzdE1lc3NhZ2VIYW5kbGVyKCkp\nOwoKICAgICAgICAvLyB0ZWFyIGRvd24gdGhlIGh1YiBzZXJ2ZXIgdG8gbGV0\nIHN1YnNjcmliZSBlbnRlcgogICAgICAgIHRlYXJEb3duSHViU2VydmVyKCk7\nCiAgICAgICAgbG9nZ2VyLmluZm8oIlRlYXIgZG93biB0aGUgaHViIHNlcnZl\nciIpOwoKICAgICAgICAvLyB3YWl0IGZvciBjbGllbnQgZW50ZXIgdG8gcmVz\ndWJzY3JpYmUgbG9naWMKICAgICAgICBUaHJlYWQuc2xlZXAocmVjb25uZWN0\nV2FpdFRpbWUgLyAyKTsKCiAgICAgICAgLy8gY2xvc2Ugc3ViCiAgICAgICAg\nc3Vic2NyaWJlci5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3Vic2NyaWJl\ncklkKTsKCiAgICAgICAgLy8gc3RhcnQgdGhlIGh1YiBzZXJ2ZXIgYWdhaW4K\nICAgICAgICBzdGFydEh1YlNlcnZlcihjb25mKTsKCiAgICAgICAgLy8gcHVi\nbGlzaCBhIG5ldyBtZXNzYWdlCiAgICAgICAgcHVibGlzaGVyLmFzeW5jUHVi\nbGlzaCh0b3BpYywgTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShCeXRl\nU3RyaW5nLmNvcHlGcm9tVXRmOCgiTWVzc2FnZSAjMSIpKS5idWlsZCgpLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFRlc3RDYWxsYmFj\naygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7\nCgogICAgICAgIC8vIHdhaXQgZm9yIGFub3RoZXIgcmVjb25uZWN0IHRpbWUg\ncGVyaW9kCiAgICAgICAgYXNzZXJ0TnVsbCgiU2hvdWxkIG5vdCByZWNlaXZl\nIGFueSBtZXNzYWdlcyBzaW5jZSB0aGUgc3Vic2NyaXB0aW9uIGhhcyBhbHJl\nYWR5IGJlZW4gY2xvc2VkLiIsCiAgICAgICAgICAgICAgICAgICBjb25zdW1l\nUXVldWUucG9sbChyZWNvbm5lY3RXYWl0VGltZSArIHJlY29ubmVjdFdhaXRU\naW1lIC8gMiwgVGltZVVuaXQuTUlMTElTRUNPTkRTKSk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

