{"sha":"7e395e944ca4b6d0c97f799cd070e2b4afab4b1e","node_id":"MDQ6QmxvYjE1NzU5NTY6N2UzOTVlOTQ0Y2E0YjZkMGM5N2Y3OTljZDA3MGUyYjRhZmFiNGIxZQ==","size":18184,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7e395e944ca4b6d0c97f799cd070e2b4afab4b1e","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLm1ldGE7Cgpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKCmltcG9ydCBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmc7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnZlcnNpb25pbmcuVmVyc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci52ZXJzaW9uaW5nLlZlcnNpb25lZDsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLlN0dWJDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Vz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTGVkZ2VyUmFuZ2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25EYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGU7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzLkh1YkluZm87CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcudXRpbC5FaXRoZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3M7CgppbXBvcnQgb3Jn\nLmp1bml0LlRlc3Q7CmltcG9ydCBvcmcuanVuaXQuQXNzZXJ0OwoKcHVibGlj\nIGNsYXNzIFRlc3RNZXRhZGF0YU1hbmFnZXIgZXh0ZW5kcyBNZXRhZGF0YU1h\nbmFnZXJGYWN0b3J5VGVzdENhc2UgewoKICAgIHB1YmxpYyBUZXN0TWV0YWRh\ndGFNYW5hZ2VyKFN0cmluZyBtZXRhZGF0YU1hbmFnZXJGYWN0b3J5Q2xzKSB7\nCiAgICAgICAgc3VwZXIobWV0YWRhdGFNYW5hZ2VyRmFjdG9yeUNscyk7CiAg\nICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RPd25lckluZm8oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBU\nb3BpY093bmVyc2hpcE1hbmFnZXIgdG9NYW5hZ2VyID0gbWV0YWRhdGFNYW5h\nZ2VyRmFjdG9yeS5uZXdUb3BpY093bmVyc2hpcE1hbmFnZXIoKTsKCiAgICAg\nICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4\nKCJ0ZXN0T3duZXJJbmZvIik7CiAgICAgICAgU3R1YkNhbGxiYWNrPFZlcnNp\nb25lZDxIdWJJbmZvPj4gcmVhZENhbGxiYWNrID0gbmV3IFN0dWJDYWxsYmFj\nazxWZXJzaW9uZWQ8SHViSW5mbz4+KCk7CiAgICAgICAgU3R1YkNhbGxiYWNr\nPFZlcnNpb24+IHdyaXRlQ2FsbGJhY2sgPSBuZXcgU3R1YkNhbGxiYWNrPFZl\ncnNpb24+KCk7CiAgICAgICAgU3R1YkNhbGxiYWNrPFZvaWQ+IGRlbGV0ZUNh\nbGxiYWNrID0gbmV3IFN0dWJDYWxsYmFjazxWb2lkPigpOwoKICAgICAgICBF\naXRoZXI8VmVyc2lvbiwgUHViU3ViRXhjZXB0aW9uPiByZXM7CiAgICAgICAg\nSHViSW5mbyBvd25lciA9IG5ldyBIdWJJbmZvKG5ldyBIZWR3aWdTb2NrZXRB\nZGRyZXNzKCIxMjcuMC4wLjEiLCA4MDA4KSwgOTk5KTsKCiAgICAgICAgLy8g\nV3JpdGUgbm9uLWV4aXN0ZWQgb3duZXIgaW5mbwogICAgICAgIHRvTWFuYWdl\nci53cml0ZU93bmVySW5mbyh0b3BpYywgb3duZXIsIFZlcnNpb24uTkVXLCB3\ncml0ZUNhbGxiYWNrLCBudWxsKTsKICAgICAgICByZXMgPSB3cml0ZUNhbGxi\nYWNrLnF1ZXVlLnRha2UoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxz\nKG51bGwsIHJlcy5yaWdodCgpKTsKICAgICAgICBWZXJzaW9uIHYxID0gcmVz\nLmxlZnQoKTsKCiAgICAgICAgLy8gcmVhZCBvd25lciBpbmZvCiAgICAgICAg\ndG9NYW5hZ2VyLnJlYWRPd25lckluZm8odG9waWMsIHJlYWRDYWxsYmFjaywg\nbnVsbCk7CiAgICAgICAgVmVyc2lvbmVkPEh1YkluZm8+IGh1YkluZm8gPSBy\nZWFkQ2FsbGJhY2sucXVldWUudGFrZSgpLmxlZnQoKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RXF1YWxzKFZlcnNpb24uT2NjdXJyZWQuQ09OQ1VSUkVOVExZ\nLCB2MS5jb21wYXJlKGh1YkluZm8uZ2V0VmVyc2lvbigpKSk7CiAgICAgICAg\nQXNzZXJ0LmFzc2VydEVxdWFscyhvd25lciwgaHViSW5mby5nZXRWYWx1ZSgp\nKTsKCiAgICAgICAgSHViSW5mbyBuZXdPd25lciA9IG5ldyBIdWJJbmZvKG5l\ndyBIZWR3aWdTb2NrZXRBZGRyZXNzKCIxMjcuMC4wLjEiLCA4MDA4KSwgMTAw\nMCk7CgogICAgICAgIC8vIHdyaXRlIGV4c2l0ZWQgb3duZXIgaW5mbyB3aXRo\nIG51bGwgdmVyc2lvbgogICAgICAgIHRvTWFuYWdlci53cml0ZU93bmVySW5m\nbyh0b3BpYywgbmV3T3duZXIsIFZlcnNpb24uTkVXLCB3cml0ZUNhbGxiYWNr\nLCBudWxsKTsKICAgICAgICByZXMgPSB3cml0ZUNhbGxiYWNrLnF1ZXVlLnRh\na2UoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0Tm90TnVsbChyZXMucmlnaHQo\nKSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUocmVzLnJpZ2h0KCkgaW5z\ndGFuY2VvZiBQdWJTdWJFeGNlcHRpb24uVG9waWNPd25lckluZm9FeGlzdHNF\neGNlcHRpb24pOwoKICAgICAgICAvLyB3cml0ZSBleGlzdGVkIG93bmVyIGlu\nZm8gd2l0aCByaWdodCB2ZXJzaW9uCiAgICAgICAgdG9NYW5hZ2VyLndyaXRl\nT3duZXJJbmZvKHRvcGljLCBuZXdPd25lciwgdjEsIHdyaXRlQ2FsbGJhY2ss\nIG51bGwpOwogICAgICAgIHJlcyA9IHdyaXRlQ2FsbGJhY2sucXVldWUudGFr\nZSgpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMobnVsbCwgcmVzLnJp\nZ2h0KCkpOwogICAgICAgIFZlcnNpb24gdjIgPSByZXMubGVmdCgpOwogICAg\nICAgIEFzc2VydC5hc3NlcnRFcXVhbHMoVmVyc2lvbi5PY2N1cnJlZC5BRlRF\nUiwgdjIuY29tcGFyZSh2MSkpOwoKICAgICAgICAvLyByZWFkIG93bmVyIGlu\nZm8KICAgICAgICB0b01hbmFnZXIucmVhZE93bmVySW5mbyh0b3BpYywgcmVh\nZENhbGxiYWNrLCBudWxsKTsKICAgICAgICBodWJJbmZvID0gcmVhZENhbGxi\nYWNrLnF1ZXVlLnRha2UoKS5sZWZ0KCk7CiAgICAgICAgQXNzZXJ0LmFzc2Vy\ndEVxdWFscyhWZXJzaW9uLk9jY3VycmVkLkNPTkNVUlJFTlRMWSwgdjIuY29t\ncGFyZShodWJJbmZvLmdldFZlcnNpb24oKSkpOwogICAgICAgIEFzc2VydC5h\nc3NlcnRFcXVhbHMobmV3T3duZXIsIGh1YkluZm8uZ2V0VmFsdWUoKSk7Cgog\nICAgICAgIEh1YkluZm8gbmV3T3duZXIyID0gbmV3IEh1YkluZm8obmV3IEhl\nZHdpZ1NvY2tldEFkZHJlc3MoIjEyNy4wLjAuMSIsIDgwMDgpLCAxMDAxKTsK\nCiAgICAgICAgLy8gd3JpdGUgZXhpc3RlZCBvd25lciBpbmZvIHdpdGggYmFk\nIHZlcnNpb24KICAgICAgICB0b01hbmFnZXIud3JpdGVPd25lckluZm8odG9w\naWMsIG5ld093bmVyMiwgdjEsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHdyaXRlQ2FsbGJhY2ssIG51bGwpOwogICAgICAgIHJlcyA9IHdy\naXRlQ2FsbGJhY2sucXVldWUudGFrZSgpOwogICAgICAgIEFzc2VydC5hc3Nl\ncnROb3ROdWxsKHJlcy5yaWdodCgpKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0\nVHJ1ZShyZXMucmlnaHQoKSBpbnN0YW5jZW9mIFB1YlN1YkV4Y2VwdGlvbi5C\nYWRWZXJzaW9uRXhjZXB0aW9uKTsKCiAgICAgICAgLy8gcmVhZCBvd25lciBp\nbmZvCiAgICAgICAgdG9NYW5hZ2VyLnJlYWRPd25lckluZm8odG9waWMsIHJl\nYWRDYWxsYmFjaywgbnVsbCk7CiAgICAgICAgaHViSW5mbyA9IHJlYWRDYWxs\nYmFjay5xdWV1ZS50YWtlKCkubGVmdCgpOwogICAgICAgIEFzc2VydC5hc3Nl\ncnRFcXVhbHMoVmVyc2lvbi5PY2N1cnJlZC5DT05DVVJSRU5UTFksIHYyLmNv\nbXBhcmUoaHViSW5mby5nZXRWZXJzaW9uKCkpKTsKICAgICAgICBBc3NlcnQu\nYXNzZXJ0RXF1YWxzKG5ld093bmVyLCBodWJJbmZvLmdldFZhbHVlKCkpOwoK\nICAgICAgICAvLyBkZWxldGUgZXhpc3RlZCBvd25lciBpbmZvIHdpdGggYmFk\nIHZlcnNpb24KICAgICAgICB0b01hbmFnZXIuZGVsZXRlT3duZXJJbmZvKHRv\ncGljLCB2MSwgZGVsZXRlQ2FsbGJhY2ssIG51bGwpOwogICAgICAgIEFzc2Vy\ndC5hc3NlcnRUcnVlKGRlbGV0ZUNhbGxiYWNrLnF1ZXVlLnRha2UoKS5yaWdo\ndCgpIGluc3RhbmNlb2YKICAgICAgICAgICAgICAgICAgICAgICAgICBQdWJT\ndWJFeGNlcHRpb24uQmFkVmVyc2lvbkV4Y2VwdGlvbik7CgogICAgICAgIC8v\nIHJlYWQgb3duZXIgaW5mbwogICAgICAgIHRvTWFuYWdlci5yZWFkT3duZXJJ\nbmZvKHRvcGljLCByZWFkQ2FsbGJhY2ssIG51bGwpOwogICAgICAgIGh1Yklu\nZm8gPSByZWFkQ2FsbGJhY2sucXVldWUudGFrZSgpLmxlZnQoKTsKICAgICAg\nICBBc3NlcnQuYXNzZXJ0RXF1YWxzKFZlcnNpb24uT2NjdXJyZWQuQ09OQ1VS\nUkVOVExZLCB2Mi5jb21wYXJlKGh1YkluZm8uZ2V0VmVyc2lvbigpKSk7Cgog\nICAgICAgIC8vIGRlbGV0ZSBleGlzdGVkIG93bmVyIGluZm8gd2l0aCByaWdo\ndCB2ZXJzaW9uCiAgICAgICAgdG9NYW5hZ2VyLmRlbGV0ZU93bmVySW5mbyh0\nb3BpYywgdjIsIGRlbGV0ZUNhbGxiYWNrLCBudWxsKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RXF1YWxzKG51bGwsIGRlbGV0ZUNhbGxiYWNrLnF1ZXVlLnRh\na2UoKS5yaWdodCgpKTsKCiAgICAgICAgLy8gRW1wdHkgb3duZXIgaW5mbwog\nICAgICAgIHRvTWFuYWdlci5yZWFkT3duZXJJbmZvKHRvcGljLCByZWFkQ2Fs\nbGJhY2ssIG51bGwpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMobnVs\nbCwgcmVhZENhbGxiYWNrLnF1ZXVlLnRha2UoKS5sZWZ0KCkpOwoKICAgICAg\nICAvLyBkZWxldGUgbm9uLWV4aXN0ZWQgb3duZXIgaW5mbwogICAgICAgIHRv\nTWFuYWdlci5kZWxldGVPd25lckluZm8odG9waWMsIFZlcnNpb24uQU5ZLCBk\nZWxldGVDYWxsYmFjaywgbnVsbCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydFRy\ndWUoZGVsZXRlQ2FsbGJhY2sucXVldWUudGFrZSgpLnJpZ2h0KCkgaW5zdGFu\nY2VvZgogICAgICAgICAgICAgICAgICAgICAgICAgIFB1YlN1YkV4Y2VwdGlv\nbi5Ob1RvcGljT3duZXJJbmZvRXhjZXB0aW9uKTsKCiAgICAgICAgdG9NYW5h\nZ2VyLmNsb3NlKCk7CiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RQZXJzaXN0ZW5jZUluZm8oKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBUb3BpY1BlcnNpc3RlbmNlTWFuYWdlciB0\ncE1hbmFnZXIgPSBtZXRhZGF0YU1hbmFnZXJGYWN0b3J5Lm5ld1RvcGljUGVy\nc2lzdGVuY2VNYW5hZ2VyKCk7CgogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMg\nPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgidGVzdFBlcnNpc3RlbmNlSW5m\nbyIpOwogICAgICAgIFN0dWJDYWxsYmFjazxWZXJzaW9uZWQ8TGVkZ2VyUmFu\nZ2VzPj4gcmVhZENhbGxiYWNrID0gbmV3IFN0dWJDYWxsYmFjazxWZXJzaW9u\nZWQ8TGVkZ2VyUmFuZ2VzPj4oKTsKICAgICAgICBTdHViQ2FsbGJhY2s8VmVy\nc2lvbj4gd3JpdGVDYWxsYmFjayA9IG5ldyBTdHViQ2FsbGJhY2s8VmVyc2lv\nbj4oKTsKICAgICAgICBTdHViQ2FsbGJhY2s8Vm9pZD4gZGVsZXRlQ2FsbGJh\nY2sgPSBuZXcgU3R1YkNhbGxiYWNrPFZvaWQ+KCk7CgogICAgICAgIC8vIFdy\naXRlIG5vbi1leGlzdGVkIHBlcnNpc3RlbmNlIGluZm8KICAgICAgICB0cE1h\nbmFnZXIud3JpdGVUb3BpY1BlcnNpc3RlbmNlSW5mbyh0b3BpYywgTGVkZ2Vy\nUmFuZ2VzLmdldERlZmF1bHRJbnN0YW5jZSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZlcnNpb24uTkVXLCB3cml0\nZUNhbGxiYWNrLCBudWxsKTsKICAgICAgICBFaXRoZXI8VmVyc2lvbiwgUHVi\nU3ViRXhjZXB0aW9uPiByZXMgPSB3cml0ZUNhbGxiYWNrLnF1ZXVlLnRha2Uo\nKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG51bGwsIHJlcy5yaWdo\ndCgpKTsKICAgICAgICBWZXJzaW9uIHYxID0gcmVzLmxlZnQoKTsKCiAgICAg\nICAgLy8gcmVhZCBwZXJzaXN0ZW5jZSBpbmZvCiAgICAgICAgdHBNYW5hZ2Vy\nLnJlYWRUb3BpY1BlcnNpc3RlbmNlSW5mbyh0b3BpYywgcmVhZENhbGxiYWNr\nLCBudWxsKTsKICAgICAgICBWZXJzaW9uZWQ8TGVkZ2VyUmFuZ2VzPiByYW5n\nZXMgPSByZWFkQ2FsbGJhY2sucXVldWUudGFrZSgpLmxlZnQoKTsKICAgICAg\nICBBc3NlcnQuYXNzZXJ0RXF1YWxzKFZlcnNpb24uT2NjdXJyZWQuQ09OQ1VS\nUkVOVExZLCB2MS5jb21wYXJlKHJhbmdlcy5nZXRWZXJzaW9uKCkpKTsKICAg\nICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKExlZGdlclJhbmdlcy5nZXREZWZh\ndWx0SW5zdGFuY2UoKSwgcmFuZ2VzLmdldFZhbHVlKCkpOwoKICAgICAgICBM\nZWRnZXJSYW5nZSBsYXN0UmFuZ2UgPSBMZWRnZXJSYW5nZS5uZXdCdWlsZGVy\nKCkuc2V0TGVkZ2VySWQoMSkuYnVpbGQoKTsKICAgICAgICBMZWRnZXJSYW5n\nZXMuQnVpbGRlciBidWlsZGVyID0gTGVkZ2VyUmFuZ2VzLm5ld0J1aWxkZXIo\nKTsKICAgICAgICBidWlsZGVyLmFkZFJhbmdlcyhsYXN0UmFuZ2UpOwogICAg\nICAgIExlZGdlclJhbmdlcyBuZXdSYW5nZXMgPSBidWlsZGVyLmJ1aWxkKCk7\nCgogICAgICAgIC8vIHdyaXRlIGV4aXN0ZWQgcGVyc2lzdGVuY2UgaW5mbyB3\naXRoIG51bGwgdmVyc2lvbgogICAgICAgIHRwTWFuYWdlci53cml0ZVRvcGlj\nUGVyc2lzdGVuY2VJbmZvKHRvcGljLCBuZXdSYW5nZXMsIFZlcnNpb24uTkVX\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHdyaXRlQ2FsbGJhY2ssIG51bGwpOwogICAgICAgIHJlcyA9IHdyaXRlQ2Fs\nbGJhY2sucXVldWUudGFrZSgpOwogICAgICAgIEFzc2VydC5hc3NlcnROb3RO\ndWxsKHJlcy5yaWdodCgpKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZShy\nZXMucmlnaHQoKSBpbnN0YW5jZW9mIFB1YlN1YkV4Y2VwdGlvbi5Ub3BpY1Bl\ncnNpc3RlbmNlSW5mb0V4aXN0c0V4Y2VwdGlvbik7CgogICAgICAgIC8vIHdy\naXRlIGV4aXN0ZWQgcGVyc2lzdGVuY2UgaW5mbyB3aXRoIHJpZ2h0IHZlcnNp\nb24KICAgICAgICB0cE1hbmFnZXIud3JpdGVUb3BpY1BlcnNpc3RlbmNlSW5m\nbyh0b3BpYywgbmV3UmFuZ2VzLCB2MSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUNhbGxiYWNrLCBudWxsKTsK\nICAgICAgICByZXMgPSB3cml0ZUNhbGxiYWNrLnF1ZXVlLnRha2UoKTsKICAg\nICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG51bGwsIHJlcy5yaWdodCgpKTsK\nICAgICAgICBWZXJzaW9uIHYyID0gcmVzLmxlZnQoKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RXF1YWxzKFZlcnNpb24uT2NjdXJyZWQuQUZURVIsIHYyLmNv\nbXBhcmUodjEpKTsKCiAgICAgICAgLy8gcmVhZCBwZXJzaXN0ZW5jZSBpbmZv\nCiAgICAgICAgdHBNYW5hZ2VyLnJlYWRUb3BpY1BlcnNpc3RlbmNlSW5mbyh0\nb3BpYywgcmVhZENhbGxiYWNrLCBudWxsKTsKICAgICAgICByYW5nZXMgPSBy\nZWFkQ2FsbGJhY2sucXVldWUudGFrZSgpLmxlZnQoKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RXF1YWxzKFZlcnNpb24uT2NjdXJyZWQuQ09OQ1VSUkVOVExZ\nLCB2Mi5jb21wYXJlKHJhbmdlcy5nZXRWZXJzaW9uKCkpKTsKICAgICAgICBB\nc3NlcnQuYXNzZXJ0RXF1YWxzKG5ld1JhbmdlcywgcmFuZ2VzLmdldFZhbHVl\nKCkpOwoKICAgICAgICBsYXN0UmFuZ2UgPSBMZWRnZXJSYW5nZS5uZXdCdWls\nZGVyKCkuc2V0TGVkZ2VySWQoMikuYnVpbGQoKTsKICAgICAgICBidWlsZGVy\nID0gTGVkZ2VyUmFuZ2VzLm5ld0J1aWxkZXIoKTsKICAgICAgICBidWlsZGVy\nLmFkZFJhbmdlcyhsYXN0UmFuZ2UpOwogICAgICAgIExlZGdlclJhbmdlcyBu\nZXdSYW5nZXMyID0gYnVpbGRlci5idWlsZCgpOwoKICAgICAgICAvLyB3cml0\nZSBleGlzdGVkIHBlcnNpc3RlbmNlIGluZm8gd2l0aCBiYWQgdmVyc2lvbgog\nICAgICAgIHRwTWFuYWdlci53cml0ZVRvcGljUGVyc2lzdGVuY2VJbmZvKHRv\ncGljLCBuZXdSYW5nZXMyLCB2MSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB3cml0ZUNhbGxiYWNrLCBudWxsKTsKICAg\nICAgICByZXMgPSB3cml0ZUNhbGxiYWNrLnF1ZXVlLnRha2UoKTsKICAgICAg\nICBBc3NlcnQuYXNzZXJ0Tm90TnVsbChyZXMucmlnaHQoKSk7CiAgICAgICAg\nQXNzZXJ0LmFzc2VydFRydWUocmVzLnJpZ2h0KCkgaW5zdGFuY2VvZiBQdWJT\ndWJFeGNlcHRpb24uQmFkVmVyc2lvbkV4Y2VwdGlvbik7CgogICAgICAgIC8v\nIHJlYWQgcGVyc2lzdGVuY2UgaW5mbwogICAgICAgIHRwTWFuYWdlci5yZWFk\nVG9waWNQZXJzaXN0ZW5jZUluZm8odG9waWMsIHJlYWRDYWxsYmFjaywgbnVs\nbCk7CiAgICAgICAgcmFuZ2VzID0gcmVhZENhbGxiYWNrLnF1ZXVlLnRha2Uo\nKS5sZWZ0KCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyhWZXJzaW9u\nLk9jY3VycmVkLkNPTkNVUlJFTlRMWSwgdjIuY29tcGFyZShyYW5nZXMuZ2V0\nVmVyc2lvbigpKSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyhuZXdS\nYW5nZXMsIHJhbmdlcy5nZXRWYWx1ZSgpKTsKCiAgICAgICAgLy8gZGVsZXRl\nIHdpdGggYmFkIHZlcnNpb24KICAgICAgICB0cE1hbmFnZXIuZGVsZXRlVG9w\naWNQZXJzaXN0ZW5jZUluZm8odG9waWMsIHYxLCBkZWxldGVDYWxsYmFjaywg\nbnVsbCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUoZGVsZXRlQ2FsbGJh\nY2sucXVldWUudGFrZSgpLnJpZ2h0KCkgaW5zdGFuY2VvZgogICAgICAgICAg\nICAgICAgICAgICAgICAgIFB1YlN1YkV4Y2VwdGlvbi5CYWRWZXJzaW9uRXhj\nZXB0aW9uKTsKCiAgICAgICAgLy8gcmVhZCBwZXJzaXN0ZW5jZSBpbmZvCiAg\nICAgICAgdHBNYW5hZ2VyLnJlYWRUb3BpY1BlcnNpc3RlbmNlSW5mbyh0b3Bp\nYywgcmVhZENhbGxiYWNrLCBudWxsKTsKICAgICAgICByYW5nZXMgPSByZWFk\nQ2FsbGJhY2sucXVldWUudGFrZSgpLmxlZnQoKTsKICAgICAgICBBc3NlcnQu\nYXNzZXJ0RXF1YWxzKFZlcnNpb24uT2NjdXJyZWQuQ09OQ1VSUkVOVExZLCB2\nMi5jb21wYXJlKHJhbmdlcy5nZXRWZXJzaW9uKCkpKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RXF1YWxzKG5ld1JhbmdlcywgcmFuZ2VzLmdldFZhbHVlKCkp\nOwoKICAgICAgICAvLyBkZWxldGUgZXhpc3RlZCBwZXJzaXN0ZW5jZSBpbmZv\nIHdpdGggcmlnaHQgdmVyc2lvbgogICAgICAgIHRwTWFuYWdlci5kZWxldGVU\nb3BpY1BlcnNpc3RlbmNlSW5mbyh0b3BpYywgdjIsIGRlbGV0ZUNhbGxiYWNr\nLCBudWxsKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG51bGwsIGRl\nbGV0ZUNhbGxiYWNrLnF1ZXVlLnRha2UoKS5yaWdodCgpKTsKCiAgICAgICAg\nLy8gcmVhZCBlbXB0eSBwZXJzaXN0ZW5jZSBpbmZvCiAgICAgICAgdHBNYW5h\nZ2VyLnJlYWRUb3BpY1BlcnNpc3RlbmNlSW5mbyh0b3BpYywgcmVhZENhbGxi\nYWNrLCBudWxsKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG51bGws\nIHJlYWRDYWxsYmFjay5xdWV1ZS50YWtlKCkubGVmdCgpKTsKCiAgICAgICAg\nLy8gZGVsZXRlIG5vbi1leGlzdGVkIHBlcnNpc3RlbmNlIGluZm8KICAgICAg\nICB0cE1hbmFnZXIuZGVsZXRlVG9waWNQZXJzaXN0ZW5jZUluZm8odG9waWMs\nIFZlcnNpb24uQU5ZLCBkZWxldGVDYWxsYmFjaywgbnVsbCk7CiAgICAgICAg\nQXNzZXJ0LmFzc2VydFRydWUoZGVsZXRlQ2FsbGJhY2sucXVldWUudGFrZSgp\nLnJpZ2h0KCkgaW5zdGFuY2VvZgogICAgICAgICAgICAgICAgICAgICAgICAg\nIFB1YlN1YkV4Y2VwdGlvbi5Ob1RvcGljUGVyc2lzdGVuY2VJbmZvRXhjZXB0\naW9uKTsKCiAgICAgICAgdHBNYW5hZ2VyLmNsb3NlKCk7CiAgICB9CgogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTdWJz\nY3JpcHRpb25EYXRhKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3Vi\nc2NyaXB0aW9uRGF0YU1hbmFnZXIgc3ViTWFuYWdlciA9IG1ldGFkYXRhTWFu\nYWdlckZhY3RvcnkubmV3U3Vic2NyaXB0aW9uRGF0YU1hbmFnZXIoKTsKCiAg\nICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21V\ndGY4KCJ0ZXN0U3Vic2NyaXB0aW9uRGF0YSIpOwogICAgICAgIEJ5dGVTdHJp\nbmcgc3ViaWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlzdWIiKTsK\nCiAgICAgICAgZmluYWwgU3R1YkNhbGxiYWNrPFZlcnNpb24+IGNhbGxiYWNr\nID0gbmV3IFN0dWJDYWxsYmFjazxWZXJzaW9uPigpOwogICAgICAgIFN0dWJD\nYWxsYmFjazxWZXJzaW9uZWQ8U3Vic2NyaXB0aW9uRGF0YT4+IHJlYWRDYWxs\nYmFjayA9IG5ldyBTdHViQ2FsbGJhY2s8VmVyc2lvbmVkPFN1YnNjcmlwdGlv\nbkRhdGE+PigpOwogICAgICAgIFN0dWJDYWxsYmFjazxNYXA8Qnl0ZVN0cmlu\nZywgVmVyc2lvbmVkPFN1YnNjcmlwdGlvbkRhdGE+Pj4gc3Vic0NhbGxiYWNr\nCiAgICAgICAgICAgID0gbmV3IFN0dWJDYWxsYmFjazxNYXA8Qnl0ZVN0cmlu\nZywgVmVyc2lvbmVkPFN1YnNjcmlwdGlvbkRhdGE+Pj4oKTsKCiAgICAgICAg\nc3ViTWFuYWdlci5yZWFkU3Vic2NyaXB0aW9uRGF0YSh0b3BpYywgc3ViaWQs\nIHJlYWRDYWxsYmFjaywgbnVsbCk7CiAgICAgICAgRWl0aGVyPFZlcnNpb25l\nZDxTdWJzY3JpcHRpb25EYXRhPiwgUHViU3ViRXhjZXB0aW9uPiByZWFkUmVz\nID0gcmVhZENhbGxiYWNrLnF1ZXVlLnRha2UoKTsKICAgICAgICBBc3NlcnQu\nYXNzZXJ0RXF1YWxzKCJGb3VuZCBpbmNvbnNpc3RlbnQgc3Vic2NyaXB0aW9u\nIHN0YXRlIiwgbnVsbCwgcmVhZFJlcy5sZWZ0KCkpOwogICAgICAgIEFzc2Vy\ndC5hc3NlcnRFcXVhbHMoIlNob3VsZCBub3QgZmFpbCB3aXRoIFB1YlN1YkV4\nY2VwdGlvbiIsIG51bGwsIHJlYWRSZXMucmlnaHQoKSk7CgogICAgICAgIC8v\nIHJlYWQgbm9uLWV4aXN0ZWQgc3Vic2NyaXB0aW9uIHN0YXRlCiAgICAgICAg\nc3ViTWFuYWdlci5yZWFkU3Vic2NyaXB0aW9ucyh0b3BpYywgc3Vic0NhbGxi\nYWNrLCBudWxsKTsKICAgICAgICBFaXRoZXI8TWFwPEJ5dGVTdHJpbmcsIFZl\ncnNpb25lZDxTdWJzY3JpcHRpb25EYXRhPj4sIFB1YlN1YkV4Y2VwdGlvbj4g\ncmVzID0gc3Vic0NhbGxiYWNrLnF1ZXVlLnRha2UoKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RXF1YWxzKCJGb3VuZCBtb3JlIHRoYW4gMCBzdWJzY3JpYmVy\ncyIsIDAsIHJlcy5sZWZ0KCkuc2l6ZSgpKTsKICAgICAgICBBc3NlcnQuYXNz\nZXJ0RXF1YWxzKCJTaG91bGQgbm90IGZhaWwgd2l0aCBQdWJTdWJFeGNlcHRp\nb24iLCBudWxsLCByZXMucmlnaHQoKSk7CgogICAgICAgIC8vIHVwZGF0ZSBu\nb24tZXhpc3RlZCBzdWJzY3JpcHRpb24gc3RhdGUKICAgICAgICBpZiAoc3Vi\nTWFuYWdlci5pc1BhcnRpYWxVcGRhdGVTdXBwb3J0ZWQoKSkgewogICAgICAg\nICAgICBzdWJNYW5hZ2VyLnVwZGF0ZVN1YnNjcmlwdGlvbkRhdGEodG9waWMs\nIHN1YmlkLCAKICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25EYXRh\nLmdldERlZmF1bHRJbnN0YW5jZSgpLCBWZXJzaW9uLkFOWSwgY2FsbGJhY2ss\nIG51bGwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1Yk1hbmFn\nZXIucmVwbGFjZVN1YnNjcmlwdGlvbkRhdGEodG9waWMsIHN1YmlkLCAKICAg\nICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25EYXRhLmdldERlZmF1bHRJ\nbnN0YW5jZSgpLCBWZXJzaW9uLkFOWSwgY2FsbGJhY2ssIG51bGwpOwogICAg\nICAgIH0KICAgICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZSgiU2hvdWxkIGZhaWwg\ndG8gdXBkYXRlIGEgbm9uLWV4aXN0ZWQgc3Vic2NyaWJlciB3aXRoIFB1YlN1\nYkV4Y2VwdGlvbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJh\nY2sucXVldWUudGFrZSgpLnJpZ2h0KCkgaW5zdGFuY2VvZiBQdWJTdWJFeGNl\ncHRpb24uTm9TdWJzY3JpcHRpb25TdGF0ZUV4Y2VwdGlvbik7CgogICAgICAg\nIENhbGxiYWNrPFZvaWQ+IHZvaWRDYWxsYmFjayA9IG5ldyBDYWxsYmFjazxW\nb2lkPigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQg\ncmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNr\nLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24g\nZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRp\nb25GYWlsZWQoY3R4LCBleGNlcHRpb24pOwogICAgICAgICAgICB9CiAgICAg\nICAgfTsgCiAgICAgICAgCiAgICAgICAgLy8gZGVsZXRlIG5vbi1leGlzdGVk\nIHN1YnNjcmlwdGlvbiBzdGF0ZQogICAgICAgIHN1Yk1hbmFnZXIuZGVsZXRl\nU3Vic2NyaXB0aW9uRGF0YSh0b3BpYywgc3ViaWQsIFZlcnNpb24uQU5ZLCB2\nb2lkQ2FsbGJhY2ssIG51bGwpOwogICAgICAgIEFzc2VydC5hc3NlcnRUcnVl\nKCJTaG91bGQgZmFpbCB0byBkZWxldGUgYSBub24tZXhpc3RlZCBzdWJzY3Jp\nYmVyIHdpdGggUHViU3ViRXhjZXB0aW9uIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICBjYWxsYmFjay5xdWV1ZS50YWtlKCkucmlnaHQoKSBpbnN0YW5j\nZW9mIFB1YlN1YkV4Y2VwdGlvbi5Ob1N1YnNjcmlwdGlvblN0YXRlRXhjZXB0\naW9uKTsKCiAgICAgICAgbG9uZyBzZXFJZCA9IDEwOwogICAgICAgIE1lc3Nh\nZ2VTZXFJZC5CdWlsZGVyIGJ1aWxkZXIgPSBNZXNzYWdlU2VxSWQubmV3QnVp\nbGRlcigpOwogICAgICAgIGJ1aWxkZXIuc2V0TG9jYWxDb21wb25lbnQoc2Vx\nSWQpOwogICAgICAgIE1lc3NhZ2VTZXFJZCBtc2dJZCA9IGJ1aWxkZXIuYnVp\nbGQoKTsKCiAgICAgICAgU3Vic2NyaXB0aW9uU3RhdGUuQnVpbGRlciBzdGF0\nZUJ1aWxkZXIgPSBTdWJzY3JpcHRpb25TdGF0ZS5uZXdCdWlsZGVyKFN1YnNj\ncmlwdGlvblN0YXRlLmdldERlZmF1bHRJbnN0YW5jZSgpKS5zZXRNc2dJZCht\nc2dJZCk7CiAgICAgICAgU3Vic2NyaXB0aW9uRGF0YSBkYXRhID0gU3Vic2Ny\naXB0aW9uRGF0YS5uZXdCdWlsZGVyKCkuc2V0U3RhdGUoc3RhdGVCdWlsZGVy\nKS5idWlsZCgpOwoKICAgICAgICAvLyBjcmVhdGUgYSBzdWJzY3JpcHRpb24g\nc3RhdGUKICAgICAgICBzdWJNYW5hZ2VyLmNyZWF0ZVN1YnNjcmlwdGlvbkRh\ndGEodG9waWMsIHN1YmlkLCBkYXRhLCBjYWxsYmFjaywgbnVsbCk7CiAgICAg\nICAgRWl0aGVyPFZlcnNpb24sIFB1YlN1YkV4Y2VwdGlvbj4gY2JSZXN1bHQg\nPSBjYWxsYmFjay5xdWV1ZS50YWtlKCk7CiAgICAgICAgVmVyc2lvbiB2MSA9\nIGNiUmVzdWx0LmxlZnQoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxz\nKCJTaG91bGQgbm90IGZhaWwgd2l0aCBQdWJTdWJFeGNlcHRpb24iLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgY2JSZXN1bHQucmlnaHQo\nKSk7CgogICAgICAgIC8vIHJlYWQgc3Vic2NyaXB0aW9ucwogICAgICAgIHN1\nYk1hbmFnZXIucmVhZFN1YnNjcmlwdGlvbnModG9waWMsIHN1YnNDYWxsYmFj\naywgbnVsbCk7CiAgICAgICAgcmVzID0gc3Vic0NhbGxiYWNrLnF1ZXVlLnRh\na2UoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKCJTaG91bGQgZmlu\nZCBqdXN0IDEgc3Vic2NyaWJlciIsIDEsIHJlcy5sZWZ0KCkuc2l6ZSgpKTsK\nICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKCJTaG91bGQgbm90IGZhaWwg\nd2l0aCBQdWJTdWJFeGNlcHRpb24iLCBudWxsLCByZXMucmlnaHQoKSk7CiAg\nICAgICAgVmVyc2lvbmVkPFN1YnNjcmlwdGlvbkRhdGE+IHZlcnNpb25lZFN1\nYkRhdGEgPSByZXMubGVmdCgpLmdldChzdWJpZCk7CiAgICAgICAgQXNzZXJ0\nLmFzc2VydEVxdWFscyhWZXJzaW9uLk9jY3VycmVkLkNPTkNVUlJFTlRMWSwg\ndjEuY29tcGFyZSh2ZXJzaW9uZWRTdWJEYXRhLmdldFZlcnNpb24oKSkpOwog\nICAgICAgIFN1YnNjcmlwdGlvbkRhdGEgaW1zcyA9IHZlcnNpb25lZFN1YkRh\ndGEuZ2V0VmFsdWUoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKCJG\nb3VuZCBpbmNvbnNpc3RlbnQgc3Vic2NyaXB0aW9uIHN0YXRlIiwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGRhdGEsIGltc3MpOwogICAgICAgIEFz\nc2VydC5hc3NlcnRFcXVhbHMoIkZvdW5kIGluY29uc2lzdGVudCBsYXN0IGNv\nbnN1bWVkIHNlcSBpZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBz\nZXFJZCwgaW1zcy5nZXRTdGF0ZSgpLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21w\nb25lbnQoKSk7CgogICAgICAgIC8vIG1vdmUgY29uc3VtZSBzZXEgaWQKICAg\nICAgICBzZXFJZCA9IDk5OwogICAgICAgIGJ1aWxkZXIgPSBNZXNzYWdlU2Vx\nSWQubmV3QnVpbGRlcigpOwogICAgICAgIGJ1aWxkZXIuc2V0TG9jYWxDb21w\nb25lbnQoc2VxSWQpOwogICAgICAgIG1zZ0lkID0gYnVpbGRlci5idWlsZCgp\nOwoKICAgICAgICBzdGF0ZUJ1aWxkZXIgPSBTdWJzY3JpcHRpb25TdGF0ZS5u\nZXdCdWlsZGVyKGRhdGEuZ2V0U3RhdGUoKSkuc2V0TXNnSWQobXNnSWQpOwog\nICAgICAgIGRhdGEgPSBTdWJzY3JpcHRpb25EYXRhLm5ld0J1aWxkZXIoKS5z\nZXRTdGF0ZShzdGF0ZUJ1aWxkZXIpLmJ1aWxkKCk7CiAgICAgICAgCiAgICAg\nICAgLy8gdXBkYXRlIHN1YnNjcmlwdGlvbiBzdGF0ZQogICAgICAgIGlmIChz\ndWJNYW5hZ2VyLmlzUGFydGlhbFVwZGF0ZVN1cHBvcnRlZCgpKSB7CiAgICAg\nICAgICAgIHN1Yk1hbmFnZXIudXBkYXRlU3Vic2NyaXB0aW9uRGF0YSh0b3Bp\nYywgc3ViaWQsIGRhdGEsIHZlcnNpb25lZFN1YkRhdGEuZ2V0VmVyc2lvbigp\nLCBjYWxsYmFjaywgbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgc3ViTWFuYWdlci5yZXBsYWNlU3Vic2NyaXB0aW9uRGF0YSh0b3BpYywg\nc3ViaWQsIGRhdGEsIHZlcnNpb25lZFN1YkRhdGEuZ2V0VmVyc2lvbigpLCBj\nYWxsYmFjaywgbnVsbCk7CiAgICAgICAgfQogICAgICAgIGNiUmVzdWx0ID0g\nY2FsbGJhY2sucXVldWUudGFrZSgpOwogICAgICAgIEFzc2VydC5hc3NlcnRF\ncXVhbHMoIkZhaWwgdG8gdXBkYXRlIGEgc3Vic2NyaXB0aW9uIHN0YXRlIiwg\nbnVsbCwgY2JSZXN1bHQucmlnaHQoKSk7CiAgICAgICAgVmVyc2lvbiB2MiA9\nIGNiUmVzdWx0LmxlZnQoKTsKICAgICAgICAvLyByZWFkIHN1YnNjcmlwdGlv\nbiBzdGF0ZQogICAgICAgIHN1Yk1hbmFnZXIucmVhZFN1YnNjcmlwdGlvbkRh\ndGEodG9waWMsIHN1YmlkLCByZWFkQ2FsbGJhY2ssIG51bGwpOwogICAgICAg\nIEFzc2VydC5hc3NlcnRFcXVhbHMoIkZvdW5kIGluY29uc2lzdGVudCBzdWJz\nY3JpcHRpb24gc3RhdGUiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZGF0YSwgcmVhZENhbGxiYWNrLnF1ZXVlLnRha2UoKS5sZWZ0KCkuZ2V0VmFs\ndWUoKSk7CiAgICAgICAgCiAgICAgICAgLy8gcmVhZCBzdWJzY3JpcHRpb25z\nIGFnYWluCiAgICAgICAgc3ViTWFuYWdlci5yZWFkU3Vic2NyaXB0aW9ucyh0\nb3BpYywgc3Vic0NhbGxiYWNrLCBudWxsKTsKICAgICAgICByZXMgPSBzdWJz\nQ2FsbGJhY2sucXVldWUudGFrZSgpOwogICAgICAgIEFzc2VydC5hc3NlcnRF\ncXVhbHMoIlNob3VsZCBmaW5kIGp1c3QgMSBzdWJzY3JpYmVyIiwgMSwgcmVz\nLmxlZnQoKS5zaXplKCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMo\nIlNob3VsZCBub3QgZmFpbCB3aXRoIFB1YlN1YkV4Y2VwdGlvbiIsIG51bGws\nIHJlcy5yaWdodCgpKTsKICAgICAgICB2ZXJzaW9uZWRTdWJEYXRhID0gcmVz\nLmxlZnQoKS5nZXQoc3ViaWQpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVh\nbHMoVmVyc2lvbi5PY2N1cnJlZC5DT05DVVJSRU5UTFksIHYyLmNvbXBhcmUo\ndmVyc2lvbmVkU3ViRGF0YS5nZXRWZXJzaW9uKCkpKTsKICAgICAgICBpbXNz\nID0gcmVzLmxlZnQoKS5nZXQoc3ViaWQpLmdldFZhbHVlKCk7CiAgICAgICAg\nQXNzZXJ0LmFzc2VydEVxdWFscygiRm91bmQgaW5jb25zaXN0ZW50IHN1YnNj\ncmlwdGlvbiBzdGF0ZSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBk\nYXRhLCBpbXNzKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKCJGb3Vu\nZCBpbmNvbnNpc3RlbnQgbGFzdCBjb25zdW1lZCBzZXEgaWQiLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgc2VxSWQsIGltc3MuZ2V0U3RhdGUoKS5n\nZXRNc2dJZCgpLmdldExvY2FsQ29tcG9uZW50KCkpOwoKICAgICAgICAvLyB1\ncGRhdGUgb3IgcmVwbGFjZSBzdWJzY3JpcHRpb24gZGF0YSB3aXRoIGJhZCB2\nZXJzaW9uCiAgICAgICAgaWYgKHN1Yk1hbmFnZXIuaXNQYXJ0aWFsVXBkYXRl\nU3VwcG9ydGVkKCkpIHsKICAgICAgICAgICAgc3ViTWFuYWdlci51cGRhdGVT\ndWJzY3JpcHRpb25EYXRhKHRvcGljLCBzdWJpZCwgZGF0YSwgdjEsIGNhbGxi\nYWNrLCBudWxsKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdWJN\nYW5hZ2VyLnJlcGxhY2VTdWJzY3JpcHRpb25EYXRhKHRvcGljLCBzdWJpZCwg\nZGF0YSwgdjEsIGNhbGxiYWNrLCBudWxsKTsKICAgICAgICB9CiAgICAgICAg\nQXNzZXJ0LmFzc2VydFRydWUoY2FsbGJhY2sucXVldWUudGFrZSgpLnJpZ2h0\nKCkgaW5zdGFuY2VvZiBQdWJTdWJFeGNlcHRpb24uQmFkVmVyc2lvbkV4Y2Vw\ndGlvbik7CiAgICAgICAgCiAgICAgICAgLy8gZGVsZXRlIHdpdGggYmFkIHZl\ncnNpb24KICAgICAgICBzdWJNYW5hZ2VyLmRlbGV0ZVN1YnNjcmlwdGlvbkRh\ndGEodG9waWMsIHN1YmlkLCB2MSwgdm9pZENhbGxiYWNrLCBudWxsKTsKICAg\nICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZShjYWxsYmFjay5xdWV1ZS50YWtlKCku\ncmlnaHQoKSBpbnN0YW5jZW9mIFB1YlN1YkV4Y2VwdGlvbi5CYWRWZXJzaW9u\nRXhjZXB0aW9uKTsKICAgICAgICBzdWJNYW5hZ2VyLmRlbGV0ZVN1YnNjcmlw\ndGlvbkRhdGEodG9waWMsIHN1YmlkLCByZXMubGVmdCgpLmdldChzdWJpZCku\nZ2V0VmVyc2lvbigpLCB2b2lkQ2FsbGJhY2ssIG51bGwpOwogICAgICAgIEFz\nc2VydC5hc3NlcnRFcXVhbHMoIkZhaWwgdG8gZGVsZXRlIGFuIGV4aXN0ZWQg\nc3Vic2NyaWJlciIsIG51bGwsIGNhbGxiYWNrLnF1ZXVlLnRha2UoKS5yaWdo\ndCgpKTsKCiAgICAgICAgLy8gcmVhZCBzdWJzY3JpcHRpb24gc3RhdGVzIGFn\nYWluCiAgICAgICAgc3ViTWFuYWdlci5yZWFkU3Vic2NyaXB0aW9ucyh0b3Bp\nYywgc3Vic0NhbGxiYWNrLCBudWxsKTsKICAgICAgICByZXMgPSBzdWJzQ2Fs\nbGJhY2sucXVldWUudGFrZSgpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVh\nbHMoIkZvdW5kIG1vcmUgdGhhbiAwIHN1YnNjcmliZXJzIiwgMCwgcmVzLmxl\nZnQoKS5zaXplKCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMoIlNo\nb3VsZCBub3QgZmFpbCB3aXRoIFB1YlN1YkV4Y2VwdGlvbiIsIG51bGwsIHJl\ncy5yaWdodCgpKTsKCiAgICAgICAgc3ViTWFuYWdlci5jbG9zZSgpOwogICAg\nfQp9Cg==\n","encoding":"base64"}

