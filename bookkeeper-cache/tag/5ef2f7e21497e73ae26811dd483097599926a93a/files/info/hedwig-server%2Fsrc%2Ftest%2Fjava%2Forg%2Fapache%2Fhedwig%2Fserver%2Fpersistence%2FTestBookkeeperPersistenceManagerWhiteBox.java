{"sha":"1b30f5af718ae29469e89d8db2cddeec9dc740f6","node_id":"MDQ6QmxvYjE1NzU5NTY6MWIzMGY1YWY3MThhZTI5NDY5ZTg5ZDhkYjJjZGRlZWM5ZGM3NDBmNg==","size":15378,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1b30f5af718ae29469e89d8db2cddeec9dc740f6","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9t\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JzOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0b3JTZXJ2\naWNlOwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0Q2FzZTsKCmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsK\naW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVz\ndDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuRWl0aGVyOwoKaW1w\nb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLkhlbHBlck1ldGhvZHM7CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5TdHViQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2U7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZl\nckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2\nZXIubWV0YS5NZXRhZGF0YU1hbmFnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuc2VydmVyLnRvcGljcy5Ub3BpY01hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzLlRyaXZpYWxPd25B\nbGxUb3BpY01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGls\nLkNvbmN1cnJlbmN5VXRpbHM7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKcHVibGljIGNsYXNz\nIFRlc3RCb29ra2VlcGVyUGVyc2lzdGVuY2VNYW5hZ2VyV2hpdGVCb3ggZXh0\nZW5kcyBUZXN0Q2FzZSB7CgogICAgcHJvdGVjdGVkIHN0YXRpYyBMb2dnZXIg\nbG9nZ2VyID0KICAgICAgICBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZXN0\nQm9va2tlZXBlclBlcnNpc3RlbmNlTWFuYWdlcldoaXRlQm94LmNsYXNzKTsK\nCiAgICBCb29rS2VlcGVyVGVzdEJhc2UgYmt0YjsKICAgIHByaXZhdGUgZmlu\nYWwgaW50IG51bUJvb2tpZXMgPSAzOwogICAgQm9va2tlZXBlclBlcnNpc3Rl\nbmNlTWFuYWdlciBia3BtOwogICAgTWV0YWRhdGFNYW5hZ2VyRmFjdG9yeSBt\nbTsKICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjsKICAgIFNjaGVkdWxl\nZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXI7CiAgICBUb3BpY01hbmFnZXIg\ndG07CiAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJv\nbVV0ZjgoInRvcGljMCIpOwoKICAgIEBPdmVycmlkZQogICAgQEJlZm9yZQog\nICAgcHJvdGVjdGVkIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBzdXBlci5zZXRVcCgpOwogICAgICAgIGJrdGIgPSBuZXcgQm9v\na0tlZXBlclRlc3RCYXNlKG51bUJvb2tpZXMpOwogICAgICAgIGJrdGIuc2V0\nVXAoKTsKCiAgICAgICAgY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9u\nKCk7CiAgICAgICAgc2NoZWR1bGVyID0gRXhlY3V0b3JzLm5ld1NjaGVkdWxl\nZFRocmVhZFBvb2woMSk7CiAgICAgICAgdG0gPSBuZXcgVHJpdmlhbE93bkFs\nbFRvcGljTWFuYWdlcihjb25mLCBzY2hlZHVsZXIpOwoKICAgICAgICBtbSA9\nIE1ldGFkYXRhTWFuYWdlckZhY3RvcnkubmV3TWV0YWRhdGFNYW5hZ2VyRmFj\ndG9yeShjb25mLCBia3RiLmdldFpvb0tlZXBlckNsaWVudCgpKTsKCiAgICAg\nICAgYmtwbSA9IG5ldyBCb29ra2VlcGVyUGVyc2lzdGVuY2VNYW5hZ2VyKGJr\ndGIuYmssIG1tLCB0bSwgY29uZiwgc2NoZWR1bGVyKTsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIEBBZnRlcgogICAgcHJvdGVjdGVkIHZvaWQgdGVhckRv\nd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBtbS5zaHV0ZG93bigp\nOwogICAgICAgIGJrdGIudGVhckRvd24oKTsKICAgICAgICBzdXBlci50ZWFy\nRG93bigpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0RW1wdHlEaXJ0eUxlZGdlcigpIHRocm93cyBFeGNl\ncHRpb24gewoKICAgICAgICBTdHViQ2FsbGJhY2s8Vm9pZD4gc3R1YkNhbGxi\nYWNrID0gbmV3IFN0dWJDYWxsYmFjazxWb2lkPigpOwogICAgICAgIGJrcG0u\nYWNxdWlyZWRUb3BpYyh0b3BpYywgc3R1YkNhbGxiYWNrLCBudWxsKTsKICAg\nICAgICBhc3NlcnROdWxsKENvbmN1cnJlbmN5VXRpbHMudGFrZShzdHViQ2Fs\nbGJhY2sucXVldWUpLnJpZ2h0KCkpOwogICAgICAgIC8vIG5vdyBhYmFuZG9u\nLCBhbmQgdHJ5IGFub3RoZXIgdGltZSwgdGhlIHByZXYgbGVkZ2VyIHNob3Vs\nZCBiZSBkaXJ0eQoKICAgICAgICBia3BtID0gbmV3IEJvb2trZWVwZXJQZXJz\naXN0ZW5jZU1hbmFnZXIobmV3IEJvb2tLZWVwZXIoYmt0Yi5nZXRaa0hvc3RQ\nb3J0KCkpLCBtbSwgdG0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbmYsIHNjaGVkdWxlcik7CiAgICAgICAg\nYmtwbS5hY3F1aXJlZFRvcGljKHRvcGljLCBzdHViQ2FsbGJhY2ssIG51bGwp\nOwogICAgICAgIGFzc2VydE51bGwoQ29uY3VycmVuY3lVdGlscy50YWtlKHN0\ndWJDYWxsYmFjay5xdWV1ZSkucmlnaHQoKSk7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKDAsIGJrcG0udG9waWNJbmZvcy5nZXQodG9waWMpLmxlZGdlclJhbmdl\ncy5zaXplKCkpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0Tm9uRW1wdHlEaXJ0eUxlZGdlcigpIHRocm93\ncyBFeGNlcHRpb24gewoKICAgICAgICBSYW5kb20gciA9IG5ldyBSYW5kb20o\nKTsKICAgICAgICBpbnQgTlVNX01FU1NBR0VTX1RPX1RFU1QgPSAxMDA7CiAg\nICAgICAgaW50IFNJWkVfT0ZfTUVTU0FHRVNfVE9fVEVTVCA9IDEwMDsKICAg\nICAgICBpbnQgaW5kZXggPSAwOwogICAgICAgIGludCBudW1QcmV2TGVkZ2Vy\ncyA9IDA7CiAgICAgICAgTGlzdDxNZXNzYWdlPiBtZXNzYWdlcyA9IEhlbHBl\nck1ldGhvZHMuZ2V0UmFuZG9tUHVibGlzaGVkTWVzc2FnZXMoTlVNX01FU1NB\nR0VTX1RPX1RFU1QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIFNJWkVfT0ZfTUVTU0FHRVNfVE9fVEVTVCk7CgogICAgICAgIHdoaWxlIChp\nbmRleCA8IG1lc3NhZ2VzLnNpemUoKSkgewoKICAgICAgICAgICAgU3R1YkNh\nbGxiYWNrPFZvaWQ+IHN0dWJDYWxsYmFjayA9IG5ldyBTdHViQ2FsbGJhY2s8\nVm9pZD4oKTsKICAgICAgICAgICAgYmtwbS5hY3F1aXJlZFRvcGljKHRvcGlj\nLCBzdHViQ2FsbGJhY2ssIG51bGwpOwogICAgICAgICAgICBhc3NlcnROdWxs\nKENvbmN1cnJlbmN5VXRpbHMudGFrZShzdHViQ2FsbGJhY2sucXVldWUpLnJp\nZ2h0KCkpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMobnVtUHJldkxlZGdl\ncnMsIGJrcG0udG9waWNJbmZvcy5nZXQodG9waWMpLmxlZGdlclJhbmdlcy5z\naXplKCkpOwoKICAgICAgICAgICAgU3R1YkNhbGxiYWNrPFB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZD4gcGVyc2lzdENhbGxiYWNrID0gbmV3IFN0dWJD\nYWxsYmFjazxQdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ+KCk7CiAgICAg\nICAgICAgIGJrcG0ucGVyc2lzdE1lc3NhZ2UobmV3IFBlcnNpc3RSZXF1ZXN0\nKHRvcGljLCBtZXNzYWdlcy5nZXQoaW5kZXgpLCBwZXJzaXN0Q2FsbGJhY2ss\nIG51bGwpKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGluZGV4ICsgMSwg\nQ29uY3VycmVuY3lVdGlscy50YWtlKHBlcnNpc3RDYWxsYmFjay5xdWV1ZSku\nbGVmdCgpLmdldExvY2FsQ29tcG9uZW50KCkpOwoKICAgICAgICAgICAgaW5k\nZXgrKzsKICAgICAgICAgICAgLy8gb25jZSBpbiBldmVyeSAxMCB0aW1lcywg\nZ2l2ZSB1cCBsZWRnZXIKICAgICAgICAgICAgaWYgKHIubmV4dEludCgxMCkg\nPT0gOSkgewogICAgICAgICAgICAgICAgLy8gc2hvdWxkIG5vdCByZWxlYXNl\nIHRvcGljIHdoZW4gdGhlIG1lc3NhZ2UgaXMgbGFzdCBtZXNzYWdlCiAgICAg\nICAgICAgICAgICAvLyBvdGhlcndpc2Ugd2hlbiB3ZSBjYWxsIHNjYW4sIGJv\nb2trZWVwZXIgcGVyc2lzdGVuY2UgbWFuYWdlciBkb2Vzbid0IG93biB0aGUg\ndG9waWMKICAgICAgICAgICAgICAgIGlmIChpbmRleCA8IG1lc3NhZ2VzLnNp\nemUoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIE1ha2UgdGhlIGJrcG0g\nbG9zZSBpdHMgbWVtb3J5CiAgICAgICAgICAgICAgICAgICAgYmtwbS50b3Bp\nY0luZm9zLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgbnVtUHJldkxl\nZGdlcnMrKzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgLy8gTGV0cyBzY2FuIG5vdwogICAgICAgIFN0dWJT\nY2FuQ2FsbGJhY2sgc2NhbkNhbGxiYWNrID0gbmV3IFN0dWJTY2FuQ2FsbGJh\nY2soKTsKICAgICAgICBia3BtLnNjYW5NZXNzYWdlcyhuZXcgUmFuZ2VTY2Fu\nUmVxdWVzdCh0b3BpYywgMSwgTlVNX01FU1NBR0VTX1RPX1RFU1QsIExvbmcu\nTUFYX1ZBTFVFLCBzY2FuQ2FsbGJhY2ssIG51bGwpKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG1lc3NhZ2VzLnNpemUoKTsgaSsrKSB7CiAgICAg\nICAgICAgIE1lc3NhZ2Ugc2Nhbm5lZE1lc3NhZ2UgPSBDb25jdXJyZW5jeVV0\naWxzLnRha2Uoc2NhbkNhbGxiYWNrLnF1ZXVlKS5sZWZ0KCk7CiAgICAgICAg\nICAgIGFzc2VydFRydWUobWVzc2FnZXMuZ2V0KGkpLmdldEJvZHkoKS5lcXVh\nbHMoc2Nhbm5lZE1lc3NhZ2UuZ2V0Qm9keSgpKSk7CiAgICAgICAgICAgIGFz\nc2VydEVxdWFscyhpICsgMSwgc2Nhbm5lZE1lc3NhZ2UuZ2V0TXNnSWQoKS5n\nZXRMb2NhbENvbXBvbmVudCgpKTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0\nVHJ1ZShTdHViU2NhbkNhbGxiYWNrLkVORF9NRVNTQUdFID09IENvbmN1cnJl\nbmN5VXRpbHMudGFrZShzY2FuQ2FsbGJhY2sucXVldWUpLmxlZnQoKSk7Cgog\nICAgfQoKICAgIHN0YXRpYyBmaW5hbCBsb25nIG1heEVudHJpZXNQZXJMZWRn\nZXIgPSAxMDsKCiAgICBjbGFzcyBDaGFuZ2VMZWRnZXJTZXJ2ZXJDb25maWd1\ncmF0aW9uIGV4dGVuZHMgU2VydmVyQ29uZmlndXJhdGlvbiB7CiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGxvbmcgZ2V0TWF4RW50cmllc1Bl\nckxlZGdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIG1heEVudHJpZXNQZXJM\nZWRnZXI7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY0NoYW5nZUxlZGdlcnMoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgTlVNX01FU1NBR0VTX1RP\nX1RFU1QgPSAxMDE7CiAgICAgICAgaW50IFNJWkVfT0ZfTUVTU0FHRVNfVE9f\nVEVTVCA9IDEwMDsKICAgICAgICBpbnQgaW5kZXggPSAwOwogICAgICAgIExp\nc3Q8TWVzc2FnZT4gbWVzc2FnZXMgPSBIZWxwZXJNZXRob2RzLmdldFJhbmRv\nbVB1Ymxpc2hlZE1lc3NhZ2VzKE5VTV9NRVNTQUdFU19UT19URVNULAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTSVpFX09GX01FU1NBR0VT\nX1RPX1RFU1QpOwoKICAgICAgICBia3BtID0gbmV3IEJvb2trZWVwZXJQZXJz\naXN0ZW5jZU1hbmFnZXIoYmt0Yi5iaywgbW0sIHRtLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgQ2hhbmdl\nTGVkZ2VyU2VydmVyQ29uZmlndXJhdGlvbigpLCBzY2hlZHVsZXIpOwoKICAg\nICAgICAvLyBhY3F1aXJlIHRoZSB0b3BpYwogICAgICAgIFN0dWJDYWxsYmFj\nazxWb2lkPiBzdHViQ2FsbGJhY2sgPSBuZXcgU3R1YkNhbGxiYWNrPFZvaWQ+\nKCk7CiAgICAgICAgYmtwbS5hY3F1aXJlZFRvcGljKHRvcGljLCBzdHViQ2Fs\nbGJhY2ssIG51bGwpOwogICAgICAgIGFzc2VydE51bGwoQ29uY3VycmVuY3lV\ndGlscy50YWtlKHN0dWJDYWxsYmFjay5xdWV1ZSkucmlnaHQoKSk7CiAgICAg\nICAgYXNzZXJ0RXF1YWxzKDAsIGJrcG0udG9waWNJbmZvcy5nZXQodG9waWMp\nLmxlZGdlclJhbmdlcy5zaXplKCkpOwoKICAgICAgICB3aGlsZSAoaW5kZXgg\nPCBtZXNzYWdlcy5zaXplKCkpIHsKICAgICAgICAgICAgbG9nZ2VyLmRlYnVn\nKCJQZXJzaXN0IG1lc3NhZ2Uge30iLCAoaW5kZXggKyAxKSk7CiAgICAgICAg\nICAgIFN0dWJDYWxsYmFjazxNZXNzYWdlU2VxSWQ+IHBlcnNpc3RDYWxsYmFj\nayA9IG5ldyBTdHViQ2FsbGJhY2s8TWVzc2FnZVNlcUlkPigpOwogICAgICAg\nICAgICBia3BtLnBlcnNpc3RNZXNzYWdlKG5ldyBQZXJzaXN0UmVxdWVzdCh0\nb3BpYywgbWVzc2FnZXMuZ2V0KGluZGV4KSwgcGVyc2lzdENhbGxiYWNrLCBu\ndWxsKSk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyhpbmRleCArIDEsIENv\nbmN1cnJlbmN5VXRpbHMudGFrZShwZXJzaXN0Q2FsbGJhY2sucXVldWUpLmxl\nZnQoKS5nZXRMb2NhbENvbXBvbmVudCgpKTsKCiAgICAgICAgICAgIGluZGV4\nKys7CiAgICAgICAgICAgIGlmIChpbmRleCAlIG1heEVudHJpZXNQZXJMZWRn\nZXIgPT0gMSkgewogICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGluZGV4\nIC8gbWF4RW50cmllc1BlckxlZGdlciwgYmtwbS50b3BpY0luZm9zLmdldCh0\nb3BpYykubGVkZ2VyUmFuZ2VzLnNpemUoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKE5VTV9NRVNTQUdFU19UT19U\nRVNUIC8gbWF4RW50cmllc1BlckxlZGdlciwgYmtwbS50b3BpY0luZm9zLmdl\ndCh0b3BpYykubGVkZ2VyUmFuZ2VzLnNpemUoKSk7CgogICAgICAgIC8vIExl\ndHMgc2NhbiBub3cKICAgICAgICBTdHViU2NhbkNhbGxiYWNrIHNjYW5DYWxs\nYmFjayA9IG5ldyBTdHViU2NhbkNhbGxiYWNrKCk7CiAgICAgICAgYmtwbS5z\nY2FuTWVzc2FnZXMobmV3IFJhbmdlU2NhblJlcXVlc3QodG9waWMsIDEsIE5V\nTV9NRVNTQUdFU19UT19URVNULCBMb25nLk1BWF9WQUxVRSwgc2NhbkNhbGxi\nYWNrLCBudWxsKSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBtZXNz\nYWdlcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICBNZXNzYWdlIHNjYW5u\nZWRNZXNzYWdlID0gQ29uY3VycmVuY3lVdGlscy50YWtlKHNjYW5DYWxsYmFj\nay5xdWV1ZSkubGVmdCgpOwogICAgICAgICAgICBhc3NlcnRUcnVlKG1lc3Nh\nZ2VzLmdldChpKS5nZXRCb2R5KCkuZXF1YWxzKHNjYW5uZWRNZXNzYWdlLmdl\ndEJvZHkoKSkpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoaSArIDEsIHNj\nYW5uZWRNZXNzYWdlLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21wb25lbnQoKSk7\nCiAgICAgICAgfQogICAgICAgIGFzc2VydFRydWUoU3R1YlNjYW5DYWxsYmFj\nay5FTkRfTUVTU0FHRSA9PSBDb25jdXJyZW5jeVV0aWxzLnRha2Uoc2NhbkNh\nbGxiYWNrLnF1ZXVlKS5sZWZ0KCkpOwoKICAgICAgICAvLyBNYWtlIHRoZSBi\na3BtIGxvc2UgaXRzIG1lbW9yeQogICAgICAgIGJrcG0udG9waWNJbmZvcy5j\nbGVhcigpOwoKICAgICAgICAvLyBhY3F1aXJlIHRoZSB0b3BpYyBhZ2Fpbgog\nICAgICAgIHN0dWJDYWxsYmFjayA9IG5ldyBTdHViQ2FsbGJhY2s8Vm9pZD4o\nKTsKICAgICAgICBia3BtLmFjcXVpcmVkVG9waWModG9waWMsIHN0dWJDYWxs\nYmFjaywgbnVsbCk7CiAgICAgICAgYXNzZXJ0TnVsbChDb25jdXJyZW5jeVV0\naWxzLnRha2Uoc3R1YkNhbGxiYWNrLnF1ZXVlKS5yaWdodCgpKTsKICAgICAg\nICBhc3NlcnRFcXVhbHMoTlVNX01FU1NBR0VTX1RPX1RFU1QgLyBtYXhFbnRy\naWVzUGVyTGVkZ2VyICsgMSwgYmtwbS50b3BpY0luZm9zLmdldCh0b3BpYyku\nbGVkZ2VyUmFuZ2VzLnNpemUoKSk7CiAgICB9CgogICAgY2xhc3MgT3JkZXJD\naGVja2luZ0NhbGxiYWNrIGV4dGVuZHMgU3R1YkNhbGxiYWNrPE1lc3NhZ2VT\nZXFJZD4gewogICAgICAgIGxvbmcgY3VyTXNnSWQ7CiAgICAgICAgaW50IG51\nbU1lc3NhZ2VzOwogICAgICAgIGludCBudW1Qcm9jZXNzZWQ7CiAgICAgICAg\naW50IG51bVN1Y2Nlc3M7CiAgICAgICAgaW50IG51bUZhaWxlZDsKCiAgICAg\nICAgT3JkZXJDaGVja2luZ0NhbGxiYWNrKGxvbmcgc3RhcnRNc2dJZCwgaW50\nIG51bU1lc3NhZ2VzKSB7CiAgICAgICAgICAgIHRoaXMuY3VyTXNnSWQgPSBz\ndGFydE1zZ0lkOwogICAgICAgICAgICB0aGlzLm51bU1lc3NhZ2VzID0gbnVt\nTWVzc2FnZXM7CiAgICAgICAgICAgIG51bVByb2Nlc3NlZCA9IG51bVN1Y2Nl\nc3MgPSBudW1GYWlsZWQgPSAwOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVj\ndCBjdHgsIGZpbmFsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAg\nICArK251bUZhaWxlZDsKICAgICAgICAgICAgICAgICsrbnVtUHJvY2Vzc2Vk\nOwogICAgICAgICAgICAgICAgaWYgKG51bVByb2Nlc3NlZCA9PSBudW1NZXNz\nYWdlcykgewogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXFJZC5CdWls\nZGVyIHNlcUlkQnVpbGRlciA9CiAgICAgICAgICAgICAgICAgICAgICAgIE1l\nc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCkuc2V0TG9jYWxDb21wb25lbnQoY3Vy\nTXNnSWQpOwogICAgICAgICAgICAgICAgICAgIHN1cGVyLm9wZXJhdGlvbkZp\nbmlzaGVkKGN0eCwgc2VxSWRCdWlsZGVyLmJ1aWxkKCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChP\nYmplY3QgY3R4LCBmaW5hbCBNZXNzYWdlU2VxSWQgc2VxSWQpIHsKICAgICAg\nICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAgICAgICAgIGxv\nbmcgbXNnSWQgPSBzZXFJZC5nZXRMb2NhbENvbXBvbmVudCgpOwogICAgICAg\nICAgICAgICAgaWYgKG1zZ0lkID09IGN1ck1zZ0lkKSB7CiAgICAgICAgICAg\nICAgICAgICAgKytjdXJNc2dJZDsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICsrbnVtU3VjY2VzczsKICAgICAgICAgICAgICAgICsrbnVt\nUHJvY2Vzc2VkOwogICAgICAgICAgICAgICAgaWYgKG51bVByb2Nlc3NlZCA9\nPSBudW1NZXNzYWdlcykgewogICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VT\nZXFJZC5CdWlsZGVyIHNlcUlkQnVpbGRlciA9CiAgICAgICAgICAgICAgICAg\nICAgICAgIE1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCkuc2V0TG9jYWxDb21w\nb25lbnQoY3VyTXNnSWQpOwogICAgICAgICAgICAgICAgICAgIHN1cGVyLm9w\nZXJhdGlvbkZpbmlzaGVkKGN0eCwgc2VxSWRCdWlsZGVyLmJ1aWxkKCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0QXN5bmNDaGFuZ2VMZWRnZXJzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgaW50IE5VTV9NRVNTQUdFU19UT19URVNUID0gMTAxOwogICAgICAg\nIGludCBTSVpFX09GX01FU1NBR0VTX1RPX1RFU1QgPSAxMDA7CiAgICAgICAg\nTGlzdDxNZXNzYWdlPiBtZXNzYWdlcyA9IEhlbHBlck1ldGhvZHMuZ2V0UmFu\nZG9tUHVibGlzaGVkTWVzc2FnZXMoTlVNX01FU1NBR0VTX1RPX1RFU1QsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNJWkVfT0ZfTUVTU0FH\nRVNfVE9fVEVTVCk7CgogICAgICAgIGJrcG0gPSBuZXcgQm9va2tlZXBlclBl\ncnNpc3RlbmNlTWFuYWdlcihia3RiLmJrLCBtbSwgdG0sCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDaGFu\nZ2VMZWRnZXJTZXJ2ZXJDb25maWd1cmF0aW9uKCksIHNjaGVkdWxlcik7Cgog\nICAgICAgIC8vIGFjcXVpcmUgdGhlIHRvcGljCiAgICAgICAgU3R1YkNhbGxi\nYWNrPFZvaWQ+IHN0dWJDYWxsYmFjayA9IG5ldyBTdHViQ2FsbGJhY2s8Vm9p\nZD4oKTsKICAgICAgICBia3BtLmFjcXVpcmVkVG9waWModG9waWMsIHN0dWJD\nYWxsYmFjaywgbnVsbCk7CiAgICAgICAgYXNzZXJ0TnVsbChDb25jdXJyZW5j\neVV0aWxzLnRha2Uoc3R1YkNhbGxiYWNrLnF1ZXVlKS5yaWdodCgpKTsKICAg\nICAgICBhc3NlcnRFcXVhbHMoMCwgYmtwbS50b3BpY0luZm9zLmdldCh0b3Bp\nYykubGVkZ2VyUmFuZ2VzLnNpemUoKSk7CgogICAgICAgIE9yZGVyQ2hlY2tp\nbmdDYWxsYmFjayBwZXJzaXN0Q2FsbGJhY2sgPQogICAgICAgICAgICBuZXcg\nT3JkZXJDaGVja2luZ0NhbGxiYWNrKDEsIE5VTV9NRVNTQUdFU19UT19URVNU\nKTsKICAgICAgICBmb3IgKE1lc3NhZ2UgbWVzc2FnZSA6IG1lc3NhZ2VzKSB7\nCiAgICAgICAgICAgIGJrcG0ucGVyc2lzdE1lc3NhZ2UobmV3IFBlcnNpc3RS\nZXF1ZXN0KHRvcGljLCBtZXNzYWdlLCBwZXJzaXN0Q2FsbGJhY2ssIG51bGwp\nKTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKE5VTV9NRVNTQUdF\nU19UT19URVNUICsgMSwKICAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVu\nY3lVdGlscy50YWtlKHBlcnNpc3RDYWxsYmFjay5xdWV1ZSkubGVmdCgpLmdl\ndExvY2FsQ29tcG9uZW50KCkpOwogICAgICAgIGFzc2VydEVxdWFscyhOVU1f\nTUVTU0FHRVNfVE9fVEVTVCwgcGVyc2lzdENhbGxiYWNrLm51bVN1Y2Nlc3Mp\nOwogICAgICAgIGFzc2VydEVxdWFscygwLCBwZXJzaXN0Q2FsbGJhY2subnVt\nRmFpbGVkKTsKICAgICAgICBhc3NlcnRFcXVhbHMoTlVNX01FU1NBR0VTX1RP\nX1RFU1QgLyBtYXhFbnRyaWVzUGVyTGVkZ2VyLAogICAgICAgICAgICAgICAg\nICAgICBia3BtLnRvcGljSW5mb3MuZ2V0KHRvcGljKS5sZWRnZXJSYW5nZXMu\nc2l6ZSgpKTsKCiAgICAgICAgLy8gZW5zdXJlIHRoZSBia3BtIGhhcyB0aGUg\ndG9waWMgYmVmb3JlIHNjYW5uaW5nCiAgICAgICAgc3R1YkNhbGxiYWNrID0g\nbmV3IFN0dWJDYWxsYmFjazxWb2lkPigpOwogICAgICAgIGJrcG0uYWNxdWly\nZWRUb3BpYyh0b3BpYywgc3R1YkNhbGxiYWNrLCBudWxsKTsKCiAgICAgICAg\nLy8gTGV0cyBzY2FuIG5vdwogICAgICAgIFN0dWJTY2FuQ2FsbGJhY2sgc2Nh\nbkNhbGxiYWNrID0gbmV3IFN0dWJTY2FuQ2FsbGJhY2soKTsKICAgICAgICBi\na3BtLnNjYW5NZXNzYWdlcyhuZXcgUmFuZ2VTY2FuUmVxdWVzdCh0b3BpYywg\nMSwgTlVNX01FU1NBR0VTX1RPX1RFU1QsIExvbmcuTUFYX1ZBTFVFLCBzY2Fu\nQ2FsbGJhY2ssIG51bGwpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG1lc3NhZ2VzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIEVpdGhlcjxN\nZXNzYWdlLEV4Y2VwdGlvbj4gZSA9IENvbmN1cnJlbmN5VXRpbHMudGFrZShz\nY2FuQ2FsbGJhY2sucXVldWUpOwogICAgICAgICAgICBNZXNzYWdlIHNjYW5u\nZWRNZXNzYWdlID0gZS5sZWZ0KCk7CiAgICAgICAgICAgIGlmIChzY2FubmVk\nTWVzc2FnZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBlLnJp\nZ2h0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzc2VydFRydWUo\nbWVzc2FnZXMuZ2V0KGkpLmdldEJvZHkoKS5lcXVhbHMoc2Nhbm5lZE1lc3Nh\nZ2UuZ2V0Qm9keSgpKSk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscyhpICsg\nMSwgc2Nhbm5lZE1lc3NhZ2UuZ2V0TXNnSWQoKS5nZXRMb2NhbENvbXBvbmVu\ndCgpKTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0VHJ1ZShTdHViU2NhbkNh\nbGxiYWNrLkVORF9NRVNTQUdFID09IENvbmN1cnJlbmN5VXRpbHMudGFrZShz\nY2FuQ2FsbGJhY2sucXVldWUpLmxlZnQoKSk7CgogICAgICAgIC8vIE1ha2Ug\ndGhlIGJrcG0gbG9zZSBpdHMgbWVtb3J5CiAgICAgICAgYmtwbS50b3BpY0lu\nZm9zLmNsZWFyKCk7CgogICAgICAgIC8vIGFjcXVpcmUgdGhlIHRvcGljIGFn\nYWluCiAgICAgICAgc3R1YkNhbGxiYWNrID0gbmV3IFN0dWJDYWxsYmFjazxW\nb2lkPigpOwogICAgICAgIGJrcG0uYWNxdWlyZWRUb3BpYyh0b3BpYywgc3R1\nYkNhbGxiYWNrLCBudWxsKTsKICAgICAgICBhc3NlcnROdWxsKENvbmN1cnJl\nbmN5VXRpbHMudGFrZShzdHViQ2FsbGJhY2sucXVldWUpLnJpZ2h0KCkpOwog\nICAgICAgIGFzc2VydEVxdWFscyhOVU1fTUVTU0FHRVNfVE9fVEVTVCAvIG1h\neEVudHJpZXNQZXJMZWRnZXIgKyAxLAogICAgICAgICAgICAgICAgICAgICBi\na3BtLnRvcGljSW5mb3MuZ2V0KHRvcGljKS5sZWRnZXJSYW5nZXMuc2l6ZSgp\nKTsKICAgIH0KCiAgICBjbGFzcyBDaGFuZ2VMZWRnZXJDYWxsYmFjayBleHRl\nbmRzIE9yZGVyQ2hlY2tpbmdDYWxsYmFjayB7CiAgICAgICAgYm9vbGVhbiB0\nZWFyRG93biA9IGZhbHNlOwogICAgICAgIENoYW5nZUxlZGdlckNhbGxiYWNr\nKGxvbmcgc3RhcnRNc2dJZCwgaW50IG51bU1lc3NhZ2VzKSB7CiAgICAgICAg\nICAgIHN1cGVyKHN0YXJ0TXNnSWQsIG51bU1lc3NhZ2VzKTsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIGZpbmFsIE1lc3NhZ2VTZXFJZCBt\nc2dJZCkgewogICAgICAgICAgICBzdXBlci5vcGVyYXRpb25GaW5pc2hlZChj\ndHgsIG1zZ0lkKTsKICAgICAgICAgICAgLy8gc2h1dGRvd24gYm9va2llIHNl\ncnZlciB3aGVuIGNoYW5naW5nIGxlZGdlcgogICAgICAgICAgICAvLyBzbyBm\nb2xsb3dpbmcgcmVxdWVzdHMgc2hvdWxkIGZhaWwKICAgICAgICAgICAgaWYg\nKG1zZ0lkLmdldExvY2FsQ29tcG9uZW50KCkgPj0gbWF4RW50cmllc1Blckxl\nZGdlciAmJiAhdGVhckRvd24pIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgYmt0Yi50ZWFyRG93bk9uZUJvb2tpZVNlcnZl\ncigpOwogICAgICAgICAgICAgICAgICAgIGJrdGIudGVhckRvd25PbmVCb29r\naWVTZXJ2ZXIoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJGYWls\nZWQgdG8gdGVhciBkb3duIGJvb2tpZSBzZXJ2ZXIuIik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB0ZWFyRG93biA9IHRydWU7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQFRlc3QodGltZW91dD02\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDaGFuZ2VMZWRnZXJGYWlsdXJl\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaW50IE5VTV9NRVNTQUdF\nU19UT19URVNUID0gMTAxOwogICAgICAgIGludCBTSVpFX09GX01FU1NBR0VT\nX1RPX1RFU1QgPSAxMDA7CiAgICAgICAgTGlzdDxNZXNzYWdlPiBtZXNzYWdl\ncyA9IEhlbHBlck1ldGhvZHMuZ2V0UmFuZG9tUHVibGlzaGVkTWVzc2FnZXMo\nTlVNX01FU1NBR0VTX1RPX1RFU1QsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIFNJWkVfT0ZfTUVTU0FHRVNfVE9fVEVTVCk7CgogICAgICAg\nIGJrcG0gPSBuZXcgQm9va2tlZXBlclBlcnNpc3RlbmNlTWFuYWdlcihia3Ri\nLmJrLCBtbSwgdG0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG5ldyBDaGFuZ2VMZWRnZXJTZXJ2ZXJDb25maWd1\ncmF0aW9uKCksIHNjaGVkdWxlcik7CgogICAgICAgIC8vIGFjcXVpcmUgdGhl\nIHRvcGljCiAgICAgICAgU3R1YkNhbGxiYWNrPFZvaWQ+IHN0dWJDYWxsYmFj\nayA9IG5ldyBTdHViQ2FsbGJhY2s8Vm9pZD4oKTsKICAgICAgICBia3BtLmFj\ncXVpcmVkVG9waWModG9waWMsIHN0dWJDYWxsYmFjaywgbnVsbCk7CiAgICAg\nICAgYXNzZXJ0TnVsbChDb25jdXJyZW5jeVV0aWxzLnRha2Uoc3R1YkNhbGxi\nYWNrLnF1ZXVlKS5yaWdodCgpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoMCwg\nYmtwbS50b3BpY0luZm9zLmdldCh0b3BpYykubGVkZ2VyUmFuZ2VzLnNpemUo\nKSk7CgogICAgICAgIENoYW5nZUxlZGdlckNhbGxiYWNrIHBlcnNpc3RDYWxs\nYmFjayA9CiAgICAgICAgICAgIG5ldyBDaGFuZ2VMZWRnZXJDYWxsYmFjaygx\nLCBOVU1fTUVTU0FHRVNfVE9fVEVTVCk7CiAgICAgICAgZm9yIChNZXNzYWdl\nIG1lc3NhZ2UgOiBtZXNzYWdlcykgewogICAgICAgICAgICBia3BtLnBlcnNp\nc3RNZXNzYWdlKG5ldyBQZXJzaXN0UmVxdWVzdCh0b3BpYywgbWVzc2FnZSwg\ncGVyc2lzdENhbGxiYWNrLCBudWxsKSk7CiAgICAgICAgfQogICAgICAgIGFz\nc2VydEVxdWFscyhtYXhFbnRyaWVzUGVyTGVkZ2VyICsgMSwKICAgICAgICAg\nICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy50YWtlKHBlcnNpc3RDYWxs\nYmFjay5xdWV1ZSkubGVmdCgpLmdldExvY2FsQ29tcG9uZW50KCkpOwogICAg\nICAgIGFzc2VydEVxdWFscyhtYXhFbnRyaWVzUGVyTGVkZ2VyLCBwZXJzaXN0\nQ2FsbGJhY2subnVtU3VjY2Vzcyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKE5V\nTV9NRVNTQUdFU19UT19URVNUIC0gbWF4RW50cmllc1BlckxlZGdlciwgcGVy\nc2lzdENhbGxiYWNrLm51bUZhaWxlZCk7CiAgICB9Cn0K\n","encoding":"base64"}

