{"sha":"10378060e345785b1fb37f5a763602c1d97ce132","node_id":"MDQ6QmxvYjE1NzU5NTY6MTAzNzgwNjBlMzQ1Nzg1YjFmYjM3ZjVhNzYzNjAyYzFkOTdjZTEzMg==","size":12443,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/10378060e345785b1fb37f5a763602c1d97ce132","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuKjsKCmltcG9ydCBqYXZh\nLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbDsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1w\nb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsK\nCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5NYXRoVXRpbHM7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5IZWxwZXJNZXRob2RzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuU3R1YkNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuU3R1YlNjYW5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2U7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNvbmN1\ncnJlbmN5VXRpbHM7CgpwdWJsaWMgY2xhc3MgVGVzdFJlYWRBaGVhZENhY2hl\nV2hpdGVCb3ggewogICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJ0ZXN0VG9waWMiKTsKICAgIGZpbmFsIHN0YXRpYyBp\nbnQgTlVNX01FU1NBR0VTID0gMTA7CiAgICBmaW5hbCBzdGF0aWMgaW50IE1T\nR19TSVpFID0gNTA7CiAgICBMaXN0PE1lc3NhZ2U+IG1lc3NhZ2VzID0gSGVs\ncGVyTWV0aG9kcy5nZXRSYW5kb21QdWJsaXNoZWRNZXNzYWdlcyhOVU1fTUVT\nU0FHRVMsIE1TR19TSVpFKTsKICAgIFN0dWJQZXJzaXN0ZW5jZU1hbmFnZXIg\nc3R1YlBlcnNpc3RlbmNlTWFuYWdlcjsKICAgIFJlYWRBaGVhZENhY2hlIGNh\nY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXI7CiAgICBNeVNlcnZlckNvbmZp\nZ3VyYXRpb24gbXlDb25mID0gbmV3IE15U2VydmVyQ29uZmlndXJhdGlvbigp\nOwoKICAgIGNsYXNzIE15UmVhZEFoZWFkQ2FjaGUgZXh0ZW5kcyBSZWFkQWhl\nYWRDYWNoZSB7CiAgICAgICAgcHVibGljIE15UmVhZEFoZWFkQ2FjaGUoUGVy\nc2lzdGVuY2VNYW5hZ2VyV2l0aFJhbmdlU2NhbiBwZXJzaXN0ZW5jZU1hbmdl\nciwgU2VydmVyQ29uZmlndXJhdGlvbiBjZmcpIHsKICAgICAgICAgICAgc3Vw\nZXIocGVyc2lzdGVuY2VNYW5nZXIsIGNmZyk7CiAgICAgICAgfQoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBlbnF1ZXVlV2l0\naG91dEZhaWx1cmVCeVRvcGljKEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIENh\nY2hlUmVxdWVzdCBvYmopIHsKICAgICAgICAgICAgLy8gbWFrZSBpdCBwZXJm\nb3JtIGluIHRoZSBzYW1lIHRocmVhZAogICAgICAgICAgICBvYmoucGVyZm9y\nbVJlcXVlc3QoKTsKICAgICAgICB9CgogICAgfQoKICAgIGNsYXNzIE15U2Vy\ndmVyQ29uZmlndXJhdGlvbiBleHRlbmRzIFNlcnZlckNvbmZpZ3VyYXRpb24g\newoKICAgICAgICAvLyBOb3RlIHRoZXNlIGFyZSBzZXQgdXAsIHNvIHRoYXQg\ndGhlIHNpemUgbGltaXQgd2lsbCBiZSByZWFjaGVkIGJlZm9yZQogICAgICAg\nIC8vIHRoZSBjb3VudCBsaW1pdAogICAgICAgIGludCByZWFkQWhlYWRDb3Vu\ndCA9IE5VTV9NRVNTQUdFUyAvIDI7CiAgICAgICAgbG9uZyByZWFkQWhlYWRT\naXplID0gKGxvbmcpIChNU0dfU0laRSAqIDIuNSk7CiAgICAgICAgbG9uZyBt\nYXhDYWNoZVNpemUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgICAgICBsb25n\nIGNhY2hlRW50cnlUVEwgPSAwTDsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIGludCBnZXRSZWFkQWhlYWRDb3VudCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIHJlYWRBaGVhZENvdW50OwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGxvbmcgZ2V0UmVhZEFoZWFkU2l6\nZUJ5dGVzKCkgewogICAgICAgICAgICByZXR1cm4gcmVhZEFoZWFkU2l6ZTsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBs\nb25nIGdldE1heGltdW1DYWNoZVNpemUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBtYXhDYWNoZVNpemU7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwdWJsaWMgbG9uZyBnZXRDYWNoZUVudHJ5VFRMKCkgewogICAg\nICAgICAgICByZXR1cm4gY2FjaGVFbnRyeVRUTDsKICAgICAgICB9CgogICAg\nfQoKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgc3R1YlBlcnNpc3RlbmNlTWFuYWdlciA9\nIG5ldyBTdHViUGVyc2lzdGVuY2VNYW5hZ2VyKCk7CiAgICAgICAgY2FjaGVC\nYXNlZFBlcnNpc3RlbmNlTWFuYWdlciA9IG5ldyBNeVJlYWRBaGVhZENhY2hl\nKHN0dWJQZXJzaXN0ZW5jZU1hbmFnZXIsIG15Q29uZikuc3RhcnQoKTsKICAg\nIH0KCiAgICBAQWZ0ZXIKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CgogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0UGVyc2lzdE1lc3NhZ2UoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHViQ2FsbGJhY2s8UHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkPiBjYWxsYmFjayA9IG5ldyBTdHViQ2FsbGJh\nY2s8UHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkPigpOwogICAgICAgIFBl\ncnNpc3RSZXF1ZXN0IHJlcXVlc3QgPSBuZXcgUGVyc2lzdFJlcXVlc3QodG9w\naWMsIG1lc3NhZ2VzLmdldCgwKSwgY2FsbGJhY2ssIG51bGwpOwoKICAgICAg\nICBzdHViUGVyc2lzdGVuY2VNYW5hZ2VyLmZhaWx1cmUgPSB0cnVlOwogICAg\nICAgIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIucGVyc2lzdE1lc3Nh\nZ2UocmVxdWVzdCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChDb25jdXJyZW5j\neVV0aWxzLnRha2UoY2FsbGJhY2sucXVldWUpLnJpZ2h0KCkpOwoKICAgICAg\nICBDYWNoZUtleSBrZXkgPSBuZXcgQ2FjaGVLZXkodG9waWMsIGNhY2hlQmFz\nZWRQZXJzaXN0ZW5jZU1hbmFnZXIuZ2V0Q3VycmVudFNlcUlkRm9yVG9waWMo\ndG9waWMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5n\nZXRMb2NhbENvbXBvbmVudCgpKTsKICAgICAgICBhc3NlcnRGYWxzZShjYWNo\nZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlLmNvbnRhaW5zS2V5KGtl\neSkpOwoKICAgICAgICBzdHViUGVyc2lzdGVuY2VNYW5hZ2VyLmZhaWx1cmUg\nPSBmYWxzZTsKICAgICAgICBwZXJzaXN0TWVzc2FnZShtZXNzYWdlcy5nZXQo\nMCkpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBwZXJzaXN0TWVzc2FnZShN\nZXNzYWdlIG1zZykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3R1YkNh\nbGxiYWNrPFB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZD4gY2FsbGJhY2sg\nPSBuZXcgU3R1YkNhbGxiYWNrPFB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZD4oKTsKICAgICAgICBQZXJzaXN0UmVxdWVzdCByZXF1ZXN0ID0gbmV3IFBl\ncnNpc3RSZXF1ZXN0KHRvcGljLCBtc2csIGNhbGxiYWNrLCBudWxsKTsKICAg\nICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLnBlcnNpc3RNZXNz\nYWdlKHJlcXVlc3QpOwogICAgICAgIGFzc2VydE5vdE51bGwoQ29uY3VycmVu\nY3lVdGlscy50YWtlKGNhbGxiYWNrLnF1ZXVlKS5sZWZ0KCkpOwogICAgICAg\nIENhY2hlS2V5IGtleSA9IG5ldyBDYWNoZUtleSh0b3BpYywgY2FjaGVCYXNl\nZFBlcnNpc3RlbmNlTWFuYWdlci5nZXRDdXJyZW50U2VxSWRGb3JUb3BpYyh0\nb3BpYykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdl\ndExvY2FsQ29tcG9uZW50KCkpOwogICAgICAgIENhY2hlVmFsdWUgY2FjaGVW\nYWx1ZSA9IGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGUuZ2V0\nKGtleSk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbChjYWNoZVZhbHVlKTsKICAg\nICAgICBhc3NlcnRGYWxzZShjYWNoZVZhbHVlLmlzU3R1YigpKTsKICAgICAg\nICBhc3NlcnRUcnVlKEhlbHBlck1ldGhvZHMuYXJlRXF1YWwoY2FjaGVWYWx1\nZS5nZXRNZXNzYWdlKCksIG1zZykpOwoKICAgIH0KCiAgICBAVGVzdCh0aW1l\nb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFNjYW5TaW5nbGVNZXNz\nYWdlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3R1YlNjYW5DYWxs\nYmFjayBjYWxsYmFjayA9IG5ldyBTdHViU2NhbkNhbGxiYWNrKCk7CiAgICAg\nICAgU2NhblJlcXVlc3QgcmVxdWVzdCA9IG5ldyBTY2FuUmVxdWVzdCh0b3Bp\nYywgMSwgY2FsbGJhY2ssIG51bGwpOwogICAgICAgIHN0dWJQZXJzaXN0ZW5j\nZU1hbmFnZXIuZmFpbHVyZSA9IHRydWU7CgogICAgICAgIGNhY2hlQmFzZWRQ\nZXJzaXN0ZW5jZU1hbmFnZXIuc2NhblNpbmdsZU1lc3NhZ2UocmVxdWVzdCk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZShjYWxsYmFjay5pc0ZhaWxlZCgpKTsKICAg\nICAgICBhc3NlcnRUcnVlKDAgPT0gY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFu\nYWdlci5jYWNoZS5zaXplKCkpOwoKICAgICAgICBzdHViUGVyc2lzdGVuY2VN\nYW5hZ2VyLmZhaWx1cmUgPSBmYWxzZTsKICAgICAgICBjYWNoZUJhc2VkUGVy\nc2lzdGVuY2VNYW5hZ2VyLnNjYW5TaW5nbGVNZXNzYWdlKHJlcXVlc3QpOwog\nICAgICAgIGFzc2VydFRydWUobXlDb25mLnJlYWRBaGVhZENvdW50ID09IGNh\nY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGUuc2l6ZSgpKTsKCiAg\nICAgICAgcGVyc2lzdE1lc3NhZ2UobWVzc2FnZXMuZ2V0KDApKTsKICAgICAg\nICBhc3NlcnRUcnVlKGNhbGxiYWNrLmlzU3VjY2VzcygpKTsKCiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RE\nZWxpdmVyZWRVbnRpbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZv\nciAoTWVzc2FnZSBtIDogbWVzc2FnZXMpIHsKICAgICAgICAgICAgcGVyc2lz\ndE1lc3NhZ2UobSk7CiAgICAgICAgfQogICAgICAgIGFzc2VydEVxdWFscygo\nbG9uZykgTlVNX01FU1NBR0VTICogTVNHX1NJWkUsIGNhY2hlQmFzZWRQZXJz\naXN0ZW5jZU1hbmFnZXIucHJlc2VudENhY2hlU2l6ZS5nZXQoKSk7CiAgICAg\nICAgbG9uZyBtaWRkbGUgPSBtZXNzYWdlcy5zaXplKCkgLyAyOwogICAgICAg\nIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuZGVsaXZlcmVkVW50aWwo\ndG9waWMsIG1pZGRsZSk7CgogICAgICAgIGFzc2VydEVxdWFscyhtZXNzYWdl\ncy5zaXplKCkgLSBtaWRkbGUsIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFn\nZXIuY2FjaGUuc2l6ZSgpKTsKCiAgICAgICAgbG9uZyBtaWRkbGUyID0gbWlk\nZGxlIC0gMTsKICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2Vy\nLmRlbGl2ZXJlZFVudGlsKHRvcGljLCBtaWRkbGUyKTsKICAgICAgICAvLyBz\naG91bGQgaGF2ZSBubyBlZmZlY3QKICAgICAgICBhc3NlcnRFcXVhbHMobWVz\nc2FnZXMuc2l6ZSgpIC0gbWlkZGxlLCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VN\nYW5hZ2VyLmNhY2hlLnNpemUoKSk7CgogICAgICAgIC8vIGRlbGl2ZXJlZCBh\nbGwgbWVzc2FnZXMKICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5h\nZ2VyLmRlbGl2ZXJlZFVudGlsKHRvcGljLCAobG9uZykgbWVzc2FnZXMuc2l6\nZSgpKTsKICAgICAgICAvLyBzaG91bGQgaGF2ZSBubyBlZmZlY3QKICAgICAg\nICBhc3NlcnRUcnVlKGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2Fj\naGUuaXNFbXB0eSgpKTsKICAgICAgICBhc3NlcnRUcnVlKGNhY2hlQmFzZWRQ\nZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGVTZWdtZW50LmdldCgpCiAgICAgICAg\nICAgICAgICAgICAudGltZUluZGV4T2ZBZGRpdGlvbi5pc0VtcHR5KCkpOwog\nICAgICAgIGFzc2VydFRydWUoY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdl\nci5vcmRlcmVkSW5kZXhPblNlcUlkLmlzRW1wdHkoKSk7CiAgICAgICAgYXNz\nZXJ0VHJ1ZSgwID09IGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIucHJl\nc2VudENhY2hlU2l6ZS5nZXQoKSk7CgogICAgfQoKICAgIEBUZXN0KHRpbWVv\ndXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RG9SZWFkQWhlYWQoKSB7\nCiAgICAgICAgU3R1YlNjYW5DYWxsYmFjayBjYWxsYmFjayA9IG5ldyBTdHVi\nU2NhbkNhbGxiYWNrKCk7CiAgICAgICAgU2NhblJlcXVlc3QgcmVxdWVzdCA9\nIG5ldyBTY2FuUmVxdWVzdCh0b3BpYywgMSwgY2FsbGJhY2ssIG51bGwpOwog\nICAgICAgIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuZG9SZWFkQWhl\nYWQocmVxdWVzdCk7CgogICAgICAgIGFzc2VydEVxdWFscyhteUNvbmYucmVh\nZEFoZWFkQ291bnQsIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2Fj\naGUuc2l6ZSgpKTsKCiAgICAgICAgcmVxdWVzdCA9IG5ldyBTY2FuUmVxdWVz\ndCh0b3BpYywgbXlDb25mLnJlYWRBaGVhZENvdW50IC8gMiAtIDEsIGNhbGxi\nYWNrLCBudWxsKTsKICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5h\nZ2VyLmRvUmVhZEFoZWFkKHJlcXVlc3QpOwogICAgICAgIGFzc2VydEVxdWFs\ncyhteUNvbmYucmVhZEFoZWFkQ291bnQsIGNhY2hlQmFzZWRQZXJzaXN0ZW5j\nZU1hbmFnZXIuY2FjaGUuc2l6ZSgpKTsKCiAgICAgICAgcmVxdWVzdCA9IG5l\ndyBTY2FuUmVxdWVzdCh0b3BpYywgbXlDb25mLnJlYWRBaGVhZENvdW50IC8g\nMiArIDIsIGNhbGxiYWNrLCBudWxsKTsKICAgICAgICBjYWNoZUJhc2VkUGVy\nc2lzdGVuY2VNYW5hZ2VyLmRvUmVhZEFoZWFkKHJlcXVlc3QpOwogICAgICAg\nIGFzc2VydEVxdWFscygoaW50KSAoMS41ICogbXlDb25mLnJlYWRBaGVhZENv\ndW50KSwgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5jYWNoZS5zaXpl\nKCkpOwoKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdFJlYWRBaGVhZFNpemVMaW1pdCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIGZvciAoTWVzc2FnZSBtIDogbWVzc2FnZXMpIHsK\nICAgICAgICAgICAgcGVyc2lzdE1lc3NhZ2UobSk7CiAgICAgICAgfQogICAg\nICAgIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGUuY2xlYXIo\nKTsKICAgICAgICBTdHViU2NhbkNhbGxiYWNrIGNhbGxiYWNrID0gbmV3IFN0\ndWJTY2FuQ2FsbGJhY2soKTsKICAgICAgICBTY2FuUmVxdWVzdCByZXF1ZXN0\nID0gbmV3IFNjYW5SZXF1ZXN0KHRvcGljLCAxLCBjYWxsYmFjaywgbnVsbCk7\nCiAgICAgICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5zY2FuU2lu\nZ2xlTWVzc2FnZShyZXF1ZXN0KTsKCiAgICAgICAgYXNzZXJ0VHJ1ZShjYWxs\nYmFjay5pc1N1Y2Nlc3MoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKChpbnQp\nIE1hdGguY2VpbChteUNvbmYucmVhZEFoZWFkU2l6ZSAvIChNU0dfU0laRSAr\nIDAuMCkpLCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlCiAg\nICAgICAgICAgICAgICAgICAgIC5zaXplKCkpOwoKICAgIH0KCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdERvUmVhZEFo\nZWFkU3RhcnRpbmdGcm9tKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\ncGVyc2lzdE1lc3NhZ2UobWVzc2FnZXMuZ2V0KDApKTsKICAgICAgICBpbnQg\ncmVhZEFoZWFkQ291bnQgPSA1OwogICAgICAgIGludCBzdGFydCA9IDE7CiAg\nICAgICAgUmFuZ2VTY2FuUmVxdWVzdCByZWFkQWhlYWRSZXF1ZXN0ID0gY2Fj\naGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5kb1JlYWRBaGVhZFN0YXJ0aW5n\nRnJvbSh0b3BpYywgc3RhcnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcmVhZEFoZWFkQ291bnQpOwogICAgICAgIGFz\nc2VydE51bGwocmVhZEFoZWFkUmVxdWVzdCk7CgogICAgICAgIFN0dWJTY2Fu\nQ2FsbGJhY2sgY2FsbGJhY2sgPSBuZXcgU3R1YlNjYW5DYWxsYmFjaygpOwog\nICAgICAgIGludCBlbmQgPSAxMDA7CiAgICAgICAgU2NhblJlcXVlc3QgcmVx\ndWVzdCA9IG5ldyBTY2FuUmVxdWVzdCh0b3BpYywgZW5kLCBjYWxsYmFjaywg\nbnVsbCk7CiAgICAgICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5k\nb1JlYWRBaGVhZChyZXF1ZXN0KTsKCiAgICAgICAgaW50IHBvcyA9IDk4Owog\nICAgICAgIHJlYWRBaGVhZFJlcXVlc3QgPSBjYWNoZUJhc2VkUGVyc2lzdGVu\nY2VNYW5hZ2VyLmRvUmVhZEFoZWFkU3RhcnRpbmdGcm9tKHRvcGljLCBwb3Ms\nIHJlYWRBaGVhZENvdW50KTsKICAgICAgICBhc3NlcnRFcXVhbHMocmVhZEFo\nZWFkUmVxdWVzdC5tZXNzYWdlTGltaXQsIGVuZCAtIHBvcyk7CgogICAgICAg\nIGVuZCA9IDIwMDsKICAgICAgICByZXF1ZXN0ID0gbmV3IFNjYW5SZXF1ZXN0\nKHRvcGljLCBlbmQsIGNhbGxiYWNrLCBudWxsKTsKICAgICAgICBjYWNoZUJh\nc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmRvUmVhZEFoZWFkKHJlcXVlc3QpOwoK\nICAgICAgICAvLyB0b28gZmFyIGJhY2sKICAgICAgICBwb3MgPSAxNTA7CiAg\nICAgICAgcmVhZEFoZWFkUmVxdWVzdCA9IGNhY2hlQmFzZWRQZXJzaXN0ZW5j\nZU1hbmFnZXIuZG9SZWFkQWhlYWRTdGFydGluZ0Zyb20odG9waWMsIHBvcywg\ncmVhZEFoZWFkQ291bnQpOwogICAgICAgIGFzc2VydEVxdWFscyhyZWFkQWhl\nYWRSZXF1ZXN0Lm1lc3NhZ2VMaW1pdCwgcmVhZEFoZWFkQ291bnQpOwogICAg\nfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0QWRkTWVzc2FnZVRvQ2FjaGUoKSB7CiAgICAgICAgQ2FjaGVLZXkga2V5\nID0gbmV3IENhY2hlS2V5KHRvcGljLCAxKTsKICAgICAgICBjYWNoZUJhc2Vk\nUGVyc2lzdGVuY2VNYW5hZ2VyLmFkZE1lc3NhZ2VUb0NhY2hlKGtleSwgbWVz\nc2FnZXMuZ2V0KDApLCBNYXRoVXRpbHMubm93KCkpOwogICAgICAgIGFzc2Vy\ndEVxdWFscygxLCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hl\nLnNpemUoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKE1TR19TSVpFLCBjYWNo\nZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLnByZXNlbnRDYWNoZVNpemUuZ2V0\nKCkpOwogICAgICAgIGFzc2VydEVxdWFscygxLCBjYWNoZUJhc2VkUGVyc2lz\ndGVuY2VNYW5hZ2VyLm9yZGVyZWRJbmRleE9uU2VxSWQuZ2V0KHRvcGljKS5z\naXplKCkpOwogICAgICAgIGFzc2VydFRydWUoY2FjaGVCYXNlZFBlcnNpc3Rl\nbmNlTWFuYWdlci5vcmRlcmVkSW5kZXhPblNlcUlkLmdldCh0b3BpYykuY29u\ndGFpbnMoMUwpKTsKCiAgICAgICAgQ2FjaGVWYWx1ZSB2YWx1ZSA9IGNhY2hl\nQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGUuZ2V0KGtleSk7CiAgICAg\nICAgYXNzZXJ0VHJ1ZShjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNh\nY2hlU2VnbWVudC5nZXQoKQogICAgICAgICAgICAgICAgICAgLnRpbWVJbmRl\neE9mQWRkaXRpb24uZ2V0KHZhbHVlLnRpbWVPZkFkZGl0aW9uKS5jb250YWlu\ncyhrZXkpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAg\ncHVibGljIHZvaWQgdGVzdFJlbW92ZU1lc3NhZ2VGcm9tQ2FjaGUoKSB7CiAg\nICAgICAgQ2FjaGVLZXkga2V5ID0gbmV3IENhY2hlS2V5KHRvcGljLCAxKTsK\nICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmFkZE1lc3Nh\nZ2VUb0NhY2hlKGtleSwgbWVzc2FnZXMuZ2V0KDApLCBNYXRoVXRpbHMubm93\nKCkpOwogICAgICAgIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIucmVt\nb3ZlTWVzc2FnZUZyb21DYWNoZShrZXksIG5ldyBFeGNlcHRpb24oKSwgdHJ1\nZSwgdHJ1ZSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShjYWNoZUJhc2VkUGVyc2lz\ndGVuY2VNYW5hZ2VyLmNhY2hlLmlzRW1wdHkoKSk7CiAgICAgICAgYXNzZXJ0\nVHJ1ZShjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLm9yZGVyZWRJbmRl\neE9uU2VxSWQuaXNFbXB0eSgpKTsKICAgICAgICBhc3NlcnRUcnVlKGNhY2hl\nQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGVTZWdtZW50LmdldCgpCiAg\nICAgICAgICAgICAgICAgICAudGltZUluZGV4T2ZBZGRpdGlvbi5pc0VtcHR5\nKCkpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0Q29sbGVjdE9sZENhY2hlRW50cmllcygpIHsKICAgICAg\nICBpbnQgaSA9IDE7CiAgICAgICAgZm9yIChNZXNzYWdlIG0gOiBtZXNzYWdl\ncykgewogICAgICAgICAgICBDYWNoZUtleSBrZXkgPSBuZXcgQ2FjaGVLZXko\ndG9waWMsIGkpOwogICAgICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VN\nYW5hZ2VyLmFkZE1lc3NhZ2VUb0NhY2hlKGtleSwgbSwgaSk7CiAgICAgICAg\nICAgIGkrKzsKICAgICAgICB9CgogICAgICAgIGludCBuID0gMjsKICAgICAg\nICBteUNvbmYubWF4Q2FjaGVTaXplID0gbiAqIE1TR19TSVpFICogbXlDb25m\nLmdldE51bVJlYWRBaGVhZENhY2hlVGhyZWFkcygpOwogICAgICAgIGNhY2hl\nQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIucmVsb2FkQ29uZihteUNvbmYpOwog\nICAgICAgIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY29sbGVjdE9s\nZE9yRXhwaXJlZENhY2hlRW50cmllcygKICAgICAgICAgICAgICAgIGNhY2hl\nQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGVTZWdtZW50LmdldCgpKTsK\nICAgICAgICBhc3NlcnRFcXVhbHMobiwgY2FjaGVCYXNlZFBlcnNpc3RlbmNl\nTWFuYWdlci5jYWNoZS5zaXplKCkpOwogICAgICAgIGFzc2VydEVxdWFscyhu\nLCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlU2VnbWVudC5n\nZXQoKQogICAgICAgICAgICAgICAgICAgICAudGltZUluZGV4T2ZBZGRpdGlv\nbi5zaXplKCkpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0Q29sbGVjdEV4cGlyZWRDYWNoZUVudHJpZXMo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgaSA9IDE7CiAgICAg\nICAgaW50IG4gPSAyOwogICAgICAgIGxvbmcgdHRsID0gNTAwMEw7CiAgICAg\nICAgbXlDb25mLmNhY2hlRW50cnlUVEwgPSB0dGw7CiAgICAgICAgbG9uZyBj\ndXJUaW1lID0gTWF0aFV0aWxzLm5vdygpOwogICAgICAgIGNhY2hlQmFzZWRQ\nZXJzaXN0ZW5jZU1hbmFnZXIucmVsb2FkQ29uZihteUNvbmYpOwogICAgICAg\nIGZvciAoTWVzc2FnZSBtIDogbWVzc2FnZXMpIHsKICAgICAgICAgICAgQ2Fj\naGVLZXkga2V5ID0gbmV3IENhY2hlS2V5KHRvcGljLCBpKTsKICAgICAgICAg\nICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5hZGRNZXNzYWdlVG9D\nYWNoZShrZXksIG0sIGN1clRpbWUrKyk7CiAgICAgICAgICAgIGlmIChpID09\nIE5VTV9NRVNTQUdFUyAtIG4pIHsKICAgICAgICAgICAgICAgIFRocmVhZC5z\nbGVlcCgyICogdHRsKTsKICAgICAgICAgICAgICAgIGN1clRpbWUgKz0gMiAq\nIHR0bDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpKys7CiAgICAgICAg\nfQoKICAgICAgICBhc3NlcnRFcXVhbHMobiwgY2FjaGVCYXNlZFBlcnNpc3Rl\nbmNlTWFuYWdlci5jYWNoZS5zaXplKCkpOwogICAgICAgIGFzc2VydEVxdWFs\ncyhuLCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlU2VnbWVu\ndC5nZXQoKQogICAgICAgICAgICAgICAgICAgICAudGltZUluZGV4T2ZBZGRp\ndGlvbi5zaXplKCkpOwogICAgfQoKfQo=\n","encoding":"base64"}

