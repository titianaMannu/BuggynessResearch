{"sha":"575e5cab1de7732b977bb939558b48d967bd909b","node_id":"MDQ6QmxvYjE1NzU5NTY6NTc1ZTVjYWIxZGU3NzMyYjk3N2JiOTM5NTU4YjQ4ZDk2N2JkOTA5Yg==","size":11951,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/575e5cab1de7732b977bb939558b48d967bd909b","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LlNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZTsKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlN5bmNocm9ub3VzUXVldWU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmp1bml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkFzc2Vy\ndDsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMu\nUHViU3ViRXhjZXB0aW9uLkNvbXBvc2l0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNvbmN1cnJlbmN5VXRp\nbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkVpdGhlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuSGVkd2lnU29ja2V0QWRkcmVz\nczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuUGFpcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBlci5ab29LZWVwZXJUZXN0QmFz\nZTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCnB1YmxpYyBjbGFzcyBUZXN0WmtUb3BpY01hbmFn\nZXIgZXh0ZW5kcyBab29LZWVwZXJUZXN0QmFzZSB7CgogICAgc3RhdGljIExv\nZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZXN0WmtUb3Bp\nY01hbmFnZXIuY2xhc3MpOwoKICAgIHByb3RlY3RlZCBaa1RvcGljTWFuYWdl\nciB0bTsKCiAgICBwcm90ZWN0ZWQgY2xhc3MgQ2FsbGJhY2tRdWV1ZTxUPiBp\nbXBsZW1lbnRzIENhbGxiYWNrPFQ+IHsKICAgICAgICBTeW5jaHJvbm91c1F1\nZXVlPEVpdGhlcjxULCBFeGNlcHRpb24+PiBxID0gbmV3IFN5bmNocm9ub3Vz\nUXVldWU8RWl0aGVyPFQsIEV4Y2VwdGlvbj4+KCk7CgogICAgICAgIHB1Ymxp\nYyBTeW5jaHJvbm91c1F1ZXVlPEVpdGhlcjxULCBFeGNlcHRpb24+PiBnZXRR\ndWV1ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHE7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgRWl0aGVyPFQsIEV4Y2VwdGlvbj4gdGFrZSgpIHRocm93\ncyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBx\nLnRha2UoKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAg\nIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBmaW5h\nbCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiZ290IGV4Y2VwdGlvbjogIiArIGV4Y2VwdGlvbik7CiAgICAg\nICAgICAgIG5ldyBUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBy\ndW4oKSB7CiAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5w\ndXQocSwgRWl0aGVyLm9mKChUKSBudWxsLCAoRXhjZXB0aW9uKSBleGNlcHRp\nb24pKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuc3RhcnQo\nKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIGZpbmFsIFQg\ncmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgbmV3IFRocmVhZChu\nZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\nICAgICAgICBDb25jdXJyZW5jeVV0aWxzLnB1dChxLCBFaXRoZXIub2YocmVz\ndWx0T2ZPcGVyYXRpb24sIChFeGNlcHRpb24pIG51bGwpKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSkuc3RhcnQoKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJvdGVjdGVkIENhbGxiYWNrUXVldWU8SGVkd2lnU29ja2V0\nQWRkcmVzcz4gYWRkckNicSA9IG5ldyBDYWxsYmFja1F1ZXVlPEhlZHdpZ1Nv\nY2tldEFkZHJlc3M+KCk7CiAgICBwcm90ZWN0ZWQgQ2FsbGJhY2tRdWV1ZTxC\neXRlU3RyaW5nPiBic0NicSA9IG5ldyBDYWxsYmFja1F1ZXVlPEJ5dGVTdHJp\nbmc+KCk7CiAgICBwcm90ZWN0ZWQgQ2FsbGJhY2tRdWV1ZTxWb2lkPiB2b2lk\nQ2JxID0gbmV3IENhbGxiYWNrUXVldWU8Vm9pZD4oKTsKCiAgICBwcm90ZWN0\nZWQgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4\nKCJ0b3BpYyIpOwogICAgcHJvdGVjdGVkIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY2ZnOwogICAgcHJvdGVjdGVkIEhlZHdpZ1NvY2tldEFkZHJlc3MgbWU7CiAg\nICBwcm90ZWN0ZWQgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxl\ncjsKCiAgICBAT3ZlcnJpZGUKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lk\nIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc2V0\nVXAoKTsKICAgICAgICBjZmcgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigp\nOwogICAgICAgIG1lID0gY2ZnLmdldFNlcnZlckFkZHIoKTsKICAgICAgICBz\nY2hlZHVsZXIgPSBFeGVjdXRvcnMubmV3U2luZ2xlVGhyZWFkU2NoZWR1bGVk\nRXhlY3V0b3IoKTsKICAgICAgICB0bSA9IG5ldyBaa1RvcGljTWFuYWdlcih6\naywgY2ZnLCBzY2hlZHVsZXIpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\nQEFmdGVyCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIHRtLnN0b3AoKTsKICAgICAgICBzdXBlci50ZWFy\nRG93bigpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0R2V0T3duZXJTaW5nbGUoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICB0bS5nZXRPd25lcih0b3BpYywgZmFsc2UsIGFkZHJD\nYnEsIG51bGwpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMobWUsIGNo\nZWNrKGFkZHJDYnEudGFrZSgpKSk7CiAgICB9CgogICAgcHJvdGVjdGVkIEJ5\ndGVTdHJpbmcgbWtUb3BpYyhpbnQgaSkgewogICAgICAgIHJldHVybiBCeXRl\nU3RyaW5nLmNvcHlGcm9tVXRmOCh0b3BpYy50b1N0cmluZ1V0ZjgoKSArIGkp\nOwogICAgfQoKICAgIHByb3RlY3RlZCA8VD4gVCBjaGVjayhFaXRoZXI8VCwg\nRXhjZXB0aW9uPiBleCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKGV4LmxlZnQoKSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBleC5yaWdo\ndCgpOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIGV4LmxlZnQo\nKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEN1c3RvbVNlcnZl\nckNvbmZpZ3VyYXRpb24gZXh0ZW5kcyBTZXJ2ZXJDb25maWd1cmF0aW9uIHsK\nICAgICAgICBpbnQgcG9ydDsKCiAgICAgICAgcHVibGljIEN1c3RvbVNlcnZl\nckNvbmZpZ3VyYXRpb24oaW50IHBvcnQpIHsKICAgICAgICAgICAgdGhpcy5w\nb3J0ID0gcG9ydDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBpbnQgZ2V0U2VydmVyUG9ydCgpIHsKICAgICAgICAgICAg\ncmV0dXJuIHBvcnQ7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVv\ndXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0T3duZXJNdWx0aSgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY2ZnMSA9IG5ldyBDdXN0b21TZXJ2ZXJDb25maWd1cmF0aW9uKGNmZy5n\nZXRTZXJ2ZXJQb3J0KCkgKyAxKSwgY2ZnMiA9IG5ldyBDdXN0b21TZXJ2ZXJD\nb25maWd1cmF0aW9uKAogICAgICAgICAgICBjZmcuZ2V0U2VydmVyUG9ydCgp\nICsgMik7CiAgICAgICAgLy8gVE9ETyBjaGFuZ2UgY2ZnMSBjZmcyIHBhcmFt\ncwogICAgICAgIFprVG9waWNNYW5hZ2VyIHRtMSA9IG5ldyBaa1RvcGljTWFu\nYWdlcih6aywgY2ZnMSwgc2NoZWR1bGVyKSwKICAgICAgICAgICAgICAgICAg\nICAgICB0bTIgPSBuZXcgWmtUb3BpY01hbmFnZXIoemssIGNmZzIsIHNjaGVk\ndWxlcik7CgogICAgICAgIHRtLmdldE93bmVyKHRvcGljLCBmYWxzZSwgYWRk\nckNicSwgbnVsbCk7CiAgICAgICAgSGVkd2lnU29ja2V0QWRkcmVzcyBvd25l\nciA9IGNoZWNrKGFkZHJDYnEudGFrZSgpKTsKCiAgICAgICAgLy8gSWYgd2Ug\nd2VyZSB0b2xkIHRvIGhhdmUgYW5vdGhlciBwZXJzb24gY2xhaW0gdGhlIHRv\ncGljLCBtYWtlIHRoZW0KICAgICAgICAvLyBjbGFpbSB0aGUgdG9waWMuCiAg\nICAgICAgaWYgKG93bmVyLmdldFBvcnQoKSA9PSBjZmcxLmdldFNlcnZlclBv\ncnQoKSkKICAgICAgICAgICAgdG0xLmdldE93bmVyKHRvcGljLCB0cnVlLCBh\nZGRyQ2JxLCBudWxsKTsKICAgICAgICBlbHNlIGlmIChvd25lci5nZXRQb3J0\nKCkgPT0gY2ZnMi5nZXRTZXJ2ZXJQb3J0KCkpCiAgICAgICAgICAgIHRtMi5n\nZXRPd25lcih0b3BpYywgdHJ1ZSwgYWRkckNicSwgbnVsbCk7CiAgICAgICAg\naWYgKG93bmVyLmdldFBvcnQoKSAhPSBjZmcuZ2V0U2VydmVyUG9ydCgpKQog\nICAgICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG93bmVyLCBjaGVjayhh\nZGRyQ2JxLnRha2UoKSkpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIDEwMDsgKytpKSB7CiAgICAgICAgICAgIHRtLmdldE93bmVyKHRvcGljLCBm\nYWxzZSwgYWRkckNicSwgbnVsbCk7CiAgICAgICAgICAgIEFzc2VydC5hc3Nl\ncnRFcXVhbHMob3duZXIsIGNoZWNrKGFkZHJDYnEudGFrZSgpKSk7CgogICAg\nICAgICAgICB0bTEuZ2V0T3duZXIodG9waWMsIGZhbHNlLCBhZGRyQ2JxLCBu\ndWxsKTsKICAgICAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyhvd25lciwg\nY2hlY2soYWRkckNicS50YWtlKCkpKTsKCiAgICAgICAgICAgIHRtMi5nZXRP\nd25lcih0b3BpYywgZmFsc2UsIGFkZHJDYnEsIG51bGwpOwogICAgICAgICAg\nICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG93bmVyLCBjaGVjayhhZGRyQ2JxLnRh\na2UoKSkpOwogICAgICAgIH0KCiAgICAgICAgLy8gR2l2ZSB1cyAxMDAgY2hh\nbmNlcyB0byBjaG9vc2UgYW5vdGhlciBvd25lciBpZiBub3Qgc2hvdWxkQ2xh\naW0uCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7ICsraSkgewog\nICAgICAgICAgICBpZiAoIW93bmVyLmVxdWFscyhtZSkpCiAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgdG0uZ2V0T3duZXIobWtUb3BpYyhp\nKSwgZmFsc2UsIGFkZHJDYnEsIG51bGwpOwogICAgICAgICAgICBvd25lciA9\nIGNoZWNrKGFkZHJDYnEudGFrZSgpKTsKICAgICAgICAgICAgaWYgKGkgPT0g\nOTkpCiAgICAgICAgICAgICAgICBBc3NlcnQuZmFpbCgiTmV2ZXIgY2hvc2Ug\nYW5vdGhlciBvd25lciIpOwogICAgICAgIH0KCiAgICAgICAgLy8gTWFrZSBz\ndXJlIHdlIGFsd2F5cyBjaG9vc2Ugb3Vyc2VsdmVzIGlmIHNob3VsZENsYWlt\nLgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyArK2kpIHsKICAg\nICAgICAgICAgdG0uZ2V0T3duZXIobWtUb3BpYygxMDApLCB0cnVlLCBhZGRy\nQ2JxLCBudWxsKTsKICAgICAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyht\nZSwgY2hlY2soYWRkckNicS50YWtlKCkpKTsKICAgICAgICB9CgogICAgICAg\nIHRtMS5zdG9wKCk7CiAgICAgICAgdG0yLnN0b3AoKTsKICAgIH0KCiAgICBA\nVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdExvYWRC\nYWxhbmNpbmcoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB0bS5nZXRP\nd25lcih0b3BpYywgZmFsc2UsIGFkZHJDYnEsIG51bGwpOwoKICAgICAgICBB\nc3NlcnQuYXNzZXJ0RXF1YWxzKG1lLCBjaGVjayhhZGRyQ2JxLnRha2UoKSkp\nOwoKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNmZzEgPSBuZXcgQ3Vz\ndG9tU2VydmVyQ29uZmlndXJhdGlvbihjZmcuZ2V0U2VydmVyUG9ydCgpICsg\nMSk7CiAgICAgICAgVG9waWNNYW5hZ2VyIHRtMSA9IG5ldyBaa1RvcGljTWFu\nYWdlcih6aywgY2ZnMSwgc2NoZWR1bGVyKTsKCiAgICAgICAgQnl0ZVN0cmlu\nZyB0b3BpYzEgPSBta1RvcGljKDEpOwogICAgICAgIHRtLmdldE93bmVyKHRv\ncGljMSwgZmFsc2UsIGFkZHJDYnEsIG51bGwpOwogICAgICAgIEFzc2VydC5h\nc3NlcnRFcXVhbHMoY2ZnMS5nZXRTZXJ2ZXJBZGRyKCksIGNoZWNrKGFkZHJD\nYnEudGFrZSgpKSk7CgogICAgICAgIHRtMS5zdG9wKCk7CiAgICB9CgogICAg\nY2xhc3MgU3R1Yk93bmVyc2hpcENoYW5nZUxpc3RlbmVyIGltcGxlbWVudHMg\nVG9waWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lciB7CiAgICAgICAgYm9vbGVh\nbiBmYWlsdXJlOwogICAgICAgIFN5bmNocm9ub3VzUXVldWU8UGFpcjxCeXRl\nU3RyaW5nLCBCb29sZWFuPj4gYnNRdWV1ZTsKCiAgICAgICAgcHVibGljIFN0\ndWJPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lcihTeW5jaHJvbm91c1F1ZXVlPFBh\naXI8Qnl0ZVN0cmluZywgQm9vbGVhbj4+IGJzUXVldWUpIHsKICAgICAgICAg\nICAgdGhpcy5ic1F1ZXVlID0gYnNRdWV1ZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIHNldEZhaWx1cmUoYm9vbGVhbiBmYWlsdXJlKSB7CiAg\nICAgICAgICAgIHRoaXMuZmFpbHVyZSA9IGZhaWx1cmU7CiAgICAgICAgfQoK\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBsb3N0VG9w\naWMoZmluYWwgQnl0ZVN0cmluZyB0b3BpYykgewogICAgICAgICAgICBuZXcg\nVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAg\nICAgICAgICAgICAgICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KGJzUXVldWUs\nIFBhaXIub2YodG9waWMsIGZhbHNlKSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0pLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBhY3F1aXJlZFRvcGljKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMs\nIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBmaW5hbCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgICAgIG5ldyBUaHJlYWQobmV3IFJ1bm5hYmxlKCkg\newogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgQ29uY3Vy\ncmVuY3lVdGlscy5wdXQoYnNRdWV1ZSwgUGFpci5vZih0b3BpYywgdHJ1ZSkp\nOwogICAgICAgICAgICAgICAgICAgIGlmIChmYWlsdXJlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgs\nIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oIkFz\na2VkIHRvIGZhaWwiKSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmlu\naXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnN0YXJ0KCk7CiAgICAgICAg\nfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0T3duZXJzaGlwQ2hhbmdlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgU3luY2hyb25vdXNRdWV1ZTxQYWlyPEJ5dGVTdHJpbmcsIEJv\nb2xlYW4+PiBic1F1ZXVlID0gbmV3IFN5bmNocm9ub3VzUXVldWU8UGFpcjxC\neXRlU3RyaW5nLCBCb29sZWFuPj4oKTsKCiAgICAgICAgU3R1Yk93bmVyc2hp\ncENoYW5nZUxpc3RlbmVyIGxpc3RlbmVyID0gbmV3IFN0dWJPd25lcnNoaXBD\naGFuZ2VMaXN0ZW5lcihic1F1ZXVlKTsKCiAgICAgICAgdG0uYWRkVG9waWNP\nd25lcnNoaXBDaGFuZ2VMaXN0ZW5lcihsaXN0ZW5lcik7CgogICAgICAgIC8v\nIHJlZ3VsYXIgYWNxdWlyZQogICAgICAgIHRtLmdldE93bmVyKHRvcGljLCB0\ncnVlLCBhZGRyQ2JxLCBudWxsKTsKICAgICAgICBQYWlyPEJ5dGVTdHJpbmcs\nIEJvb2xlYW4+IHBhaXIgPSBic1F1ZXVlLnRha2UoKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RXF1YWxzKHRvcGljLCBwYWlyLmZpcnN0KCkpOwogICAgICAg\nIEFzc2VydC5hc3NlcnRUcnVlKHBhaXIuc2Vjb25kKCkpOwogICAgICAgIEFz\nc2VydC5hc3NlcnRFcXVhbHMobWUsIGNoZWNrKGFkZHJDYnEudGFrZSgpKSk7\nCiAgICAgICAgYXNzZXJ0T3duZXJzaGlwTm9kZUV4aXN0cygpOwoKICAgICAg\nICAvLyB0b3BpYyB0aGF0IEkgYWxyZWFkeSBvd24KICAgICAgICB0bS5nZXRP\nd25lcih0b3BpYywgdHJ1ZSwgYWRkckNicSwgbnVsbCk7CiAgICAgICAgQXNz\nZXJ0LmFzc2VydEVxdWFscyhtZSwgY2hlY2soYWRkckNicS50YWtlKCkpKTsK\nICAgICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZShic1F1ZXVlLmlzRW1wdHkoKSk7\nCiAgICAgICAgYXNzZXJ0T3duZXJzaGlwTm9kZUV4aXN0cygpOwoKICAgICAg\nICAvLyByZWd1bGFyIHJlbGVhc2UKICAgICAgICB0bS5yZWxlYXNlVG9waWMo\ndG9waWMsIGNiLCBudWxsKTsKICAgICAgICBwYWlyID0gYnNRdWV1ZS50YWtl\nKCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyh0b3BpYywgcGFpci5m\naXJzdCgpKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RmFsc2UocGFpci5zZWNv\nbmQoKSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUocXVldWUudGFrZSgp\nKTsKICAgICAgICBhc3NlcnRPd25lcnNoaXBOb2RlRG9lc250RXhpc3QoKTsK\nCiAgICAgICAgLy8gcmVsZWFzaW5nIHRvcGljIHRoYXQgSSBkb24ndCBvd24K\nICAgICAgICB0bS5yZWxlYXNlVG9waWMobWtUb3BpYygwKSwgY2IsIG51bGwp\nOwogICAgICAgIEFzc2VydC5hc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAg\nICAgICAgQXNzZXJ0LmFzc2VydFRydWUoYnNRdWV1ZS5pc0VtcHR5KCkpOwoK\nICAgICAgICAvLyBzZXQgbGlzdGVuZXIgdG8gcmV0dXJuIGVycm9yCiAgICAg\nICAgbGlzdGVuZXIuc2V0RmFpbHVyZSh0cnVlKTsKCiAgICAgICAgdG0uZ2V0\nT3duZXIodG9waWMsIHRydWUsIGFkZHJDYnEsIG51bGwpOwogICAgICAgIHBh\naXIgPSBic1F1ZXVlLnRha2UoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1\nYWxzKHRvcGljLCBwYWlyLmZpcnN0KCkpOwogICAgICAgIEFzc2VydC5hc3Nl\ncnRUcnVlKHBhaXIuc2Vjb25kKCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRF\ncXVhbHMoUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uLmNs\nYXNzLCAoKENvbXBvc2l0ZUV4Y2VwdGlvbikgYWRkckNicS50YWtlKCkucmln\naHQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXRFeGNlcHRp\nb25zKCkuaXRlcmF0b3IoKS5uZXh0KCkuZ2V0Q2xhc3MoKSk7CiAgICAgICAg\nQXNzZXJ0LmFzc2VydEZhbHNlKHRtLnRvcGljcy5jb250YWlucyh0b3BpYykp\nOwogICAgICAgIFRocmVhZC5zbGVlcCgxMDApOwogICAgICAgIGFzc2VydE93\nbmVyc2hpcE5vZGVEb2VzbnRFeGlzdCgpOwoKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBhc3NlcnRPd25lcnNoaXBOb2RlRXhpc3RzKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgYnl0ZVtdIGRhdGEgPSB6ay5nZXREYXRhKHRtLmh1\nYlBhdGgodG9waWMpLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgQXNzZXJ0LmFz\nc2VydEVxdWFscyhIdWJJbmZvLnBhcnNlKG5ldyBTdHJpbmcoZGF0YSkpLmdl\ndEFkZHJlc3MoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRtLmFk\nZHIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydE93bmVyc2hpcE5v\nZGVEb2VzbnRFeGlzdCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIHprLmdldERhdGEodG0uaHViUGF0aCh0b3BpYyks\nIGZhbHNlLCBudWxsKTsKICAgICAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUo\nZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMoZS5jb2RlKCksIEtl\nZXBlckV4Y2VwdGlvbi5Db2RlLk5PTk9ERSk7CiAgICAgICAgfQogICAgfQoK\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nWktDbGllbnREaXNjb25uZWN0ZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBGaXJzdCBhc3NlcnQgb3duZXJzaGlwIG9mIHRoZSB0b3BpYwog\nICAgICAgIHRtLmdldE93bmVyKHRvcGljLCB0cnVlLCBhZGRyQ2JxLCBudWxs\nKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG1lLCBjaGVjayhhZGRy\nQ2JxLnRha2UoKSkpOwoKICAgICAgICAvLyBTdXNwZW5kIHRoZSBaS1RvcGlj\nTWFuYWdlciBhbmQgbWFrZSBzdXJlIGNhbGxzIHRvIGdldE93bmVyIGVycm9y\nIG91dAogICAgICAgIHRtLmlzU3VzcGVuZGVkID0gdHJ1ZTsKICAgICAgICB0\nbS5nZXRPd25lcih0b3BpYywgdHJ1ZSwgYWRkckNicSwgbnVsbCk7CiAgICAg\nICAgQXNzZXJ0LmFzc2VydEVxdWFscyhQdWJTdWJFeGNlcHRpb24uU2Vydmlj\nZURvd25FeGNlcHRpb24uY2xhc3MsIGFkZHJDYnEudGFrZSgpLnJpZ2h0KCku\nZ2V0Q2xhc3MoKSk7CiAgICAgICAgLy8gUmVsZWFzZSB0aGUgdG9waWMuIFRo\naXMgc2hvdWxkIG5vdCBlcnJvciBvdXQgZXZlbiBpZiBzdXNwZW5kZWQuCiAg\nICAgICAgdG0ucmVsZWFzZVRvcGljKHRvcGljLCBjYiwgbnVsbCk7CiAgICAg\nICAgQXNzZXJ0LmFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBh\nc3NlcnRPd25lcnNoaXBOb2RlRG9lc250RXhpc3QoKTsKCiAgICAgICAgLy8g\nUmVzdGFydCB0aGUgWktUb3BpY01hbmFnZXIgYW5kIG1ha2Ugc3VyZSBjYWxs\ncyB0byBnZXRPd25lciBhcmUgb2theQogICAgICAgIHRtLmlzU3VzcGVuZGVk\nID0gZmFsc2U7CiAgICAgICAgdG0uZ2V0T3duZXIodG9waWMsIHRydWUsIGFk\nZHJDYnEsIG51bGwpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMobWUs\nIGNoZWNrKGFkZHJDYnEudGFrZSgpKSk7CiAgICAgICAgYXNzZXJ0T3duZXJz\naGlwTm9kZUV4aXN0cygpOwogICAgfQoKfQo=\n","encoding":"base64"}

