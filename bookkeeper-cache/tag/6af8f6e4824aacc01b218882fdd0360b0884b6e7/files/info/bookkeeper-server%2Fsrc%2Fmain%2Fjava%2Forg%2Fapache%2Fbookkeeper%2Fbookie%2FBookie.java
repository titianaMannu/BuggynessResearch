{"sha":"15b15591adec2a9c32ff63553bd673043b288610","node_id":"MDQ6QmxvYjE1NzU5NTY6MTViMTU1OTFhZGVjMmE5YzMyZmY2MzU1M2JkNjczMDQzYjI4ODYxMA==","size":48148,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/15b15591adec2a9c32ff63553bd673043b288610","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZv\ndW5kRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEuaW8uRmlsZW5hbWVGaWx0ZXI7CmltcG9ydCBqYXZhLm5ldC5J\nbmV0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNz\nOwppbXBvcnQgamF2YS5uZXQuVW5rbm93bkhvc3RFeGNlcHRpb247CmltcG9y\ndCBqYXZhLm5pby5CeXRlQnVmZmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGph\ndmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5G\ndXR1cmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNCb29s\nZWFuOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdl\nck1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5M\nZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmJvb2tpZS5HYXJiYWdlQ29sbGVjdG9yVGhyZWFkLlNh\nZmVFbnRyeUFkZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJv\nb2tpZS5Kb3VybmFsLkpvdXJuYWxTY2FubmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmJvb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5MZWRnZXJE\naXJzTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9v\na2llLkxlZGdlckRpcnNNYW5hZ2VyLk5vV3JpdGFibGVMZWRnZXJEaXJFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2\nZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmpteC5CS01CZWFuSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5qbXguQktNQmVhblJlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0\nZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5Cb29rS2VlcGVy\nQ29uc3RhbnRzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwu\nSU9VdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLk1h\ndGhVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlpr\nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TdHJp\nbmdVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci56b29rZWVw\nZXIuWm9vS2VlcGVyV2F0Y2hlckJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMuaW8uRmlsZVV0aWxzOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuQ3JlYXRlTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Ob2RlRXhpc3RzRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLlpvb0RlZnMuSWRzOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlci5FdmVudC5FdmVudFR5cGU7CgppbXBvcnQgY29t\nLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJsZUZvclRlc3Rpbmc7\nCgovKioKICogSW1wbGVtZW50cyBhIGJvb2tpZS4KICoKICovCgpwdWJsaWMg\nY2xhc3MgQm9va2llIGV4dGVuZHMgVGhyZWFkIHsKCiAgICBzdGF0aWMgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tpZS5jbGFz\ncyk7CgogICAgZmluYWwgRmlsZSBqb3VybmFsRGlyZWN0b3J5OwogICAgZmlu\nYWwgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwoKICAgIGZpbmFsIFN5bmNU\naHJlYWQgc3luY1RocmVhZDsKICAgIGZpbmFsIExlZGdlck1hbmFnZXJGYWN0\nb3J5IGxlZGdlck1hbmFnZXJGYWN0b3J5OwogICAgZmluYWwgTGVkZ2VyTWFu\nYWdlciBsZWRnZXJNYW5hZ2VyOwogICAgZmluYWwgTGVkZ2VyU3RvcmFnZSBs\nZWRnZXJTdG9yYWdlOwogICAgZmluYWwgSm91cm5hbCBqb3VybmFsOwoKICAg\nIGZpbmFsIEhhbmRsZUZhY3RvcnkgaGFuZGxlczsKCiAgICBzdGF0aWMgZmlu\nYWwgbG9uZyBNRVRBRU5UUllfSURfTEVER0VSX0tFWSA9IC0weDEwMDA7CiAg\nICBzdGF0aWMgZmluYWwgbG9uZyBNRVRBRU5UUllfSURfRkVOQ0VfS0VZICA9\nIC0weDIwMDA7CgogICAgLy8gWksgcmVnaXN0cmF0aW9uIHBhdGggZm9yIHRo\naXMgYm9va2llCiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBib29raWVSZWdp\nc3RyYXRpb25QYXRoOwoKICAgIHByaXZhdGUgTGVkZ2VyRGlyc01hbmFnZXIg\nbGVkZ2VyRGlyc01hbmFnZXI7CgogICAgLy8gWm9vS2VlcGVyIGNsaWVudCBp\nbnN0YW5jZSBmb3IgdGhlIEJvb2tpZQogICAgWm9vS2VlcGVyIHprOwoKICAg\nIC8vIFJ1bm5pbmcgZmxhZwogICAgcHJpdmF0ZSB2b2xhdGlsZSBib29sZWFu\nIHJ1bm5pbmcgPSBmYWxzZTsKICAgIC8vIEZsYWcgaWRlbnRpZnkgd2hldGhl\nciBpdCBpcyBpbiBzaHV0dGluZyBkb3duIHByb2dyZXNzCiAgICBwcml2YXRl\nIHZvbGF0aWxlIGJvb2xlYW4gc2h1dHRpbmdkb3duID0gZmFsc2U7CgogICAg\ncHJpdmF0ZSBpbnQgZXhpdENvZGUgPSBFeGl0Q29kZS5PSzsKCiAgICAvLyBq\nbXggcmVsYXRlZCBiZWFucwogICAgQm9va2llQmVhbiBqbXhCb29raWVCZWFu\nOwogICAgQktNQmVhbkluZm8gam14TGVkZ2VyU3RvcmFnZUJlYW47CgogICAg\nTWFwPExvbmcsIGJ5dGVbXT4gbWFzdGVyS2V5Q2FjaGUgPSBDb2xsZWN0aW9u\ncy5zeW5jaHJvbml6ZWRNYXAobmV3IEhhc2hNYXA8TG9uZywgYnl0ZVtdPigp\nKTsKCiAgICBmaW5hbCBwcml2YXRlIFN0cmluZyB6a0Jvb2tpZVJlZ1BhdGg7\nCgogICAgZmluYWwgcHJpdmF0ZSBBdG9taWNCb29sZWFuIHJlYWRPbmx5ID0g\nbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwoKICAgIHB1YmxpYyBzdGF0aWMg\nY2xhc3MgTm9MZWRnZXJFeGNlcHRpb24gZXh0ZW5kcyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJz\naW9uVUlEID0gMUw7CiAgICAgICAgcHJpdmF0ZSBsb25nIGxlZGdlcklkOwog\nICAgICAgIHB1YmxpYyBOb0xlZGdlckV4Y2VwdGlvbihsb25nIGxlZGdlcklk\nKSB7CiAgICAgICAgICAgIHN1cGVyKCJMZWRnZXIgIiArIGxlZGdlcklkICsg\nIiBub3QgZm91bmQiKTsKICAgICAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxl\nZGdlcklkOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgbG9uZyBnZXRMZWRn\nZXJJZCgpIHsKICAgICAgICAgICAgcmV0dXJuIGxlZGdlcklkOwogICAgICAg\nIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTm9FbnRyeUV4Y2Vw\ndGlvbiBleHRlbmRzIElPRXhjZXB0aW9uIHsKICAgICAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAxTDsKICAgICAg\nICBwcml2YXRlIGxvbmcgbGVkZ2VySWQ7CiAgICAgICAgcHJpdmF0ZSBsb25n\nIGVudHJ5SWQ7CiAgICAgICAgcHVibGljIE5vRW50cnlFeGNlcHRpb24obG9u\nZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgICAgIHRoaXMo\nIkVudHJ5ICIgKyBlbnRyeUlkICsgIiBub3QgZm91bmQgaW4gIiArIGxlZGdl\ncklkLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgTm9FbnRyeUV4Y2VwdGlvbihTdHJpbmcgbXNnLCBsb25nIGxlZGdl\ncklkLCBsb25nIGVudHJ5SWQpIHsKICAgICAgICAgICAgc3VwZXIobXNnKTsK\nICAgICAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAgICAg\nICAgICB0aGlzLmVudHJ5SWQgPSBlbnRyeUlkOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIGxvbmcgZ2V0TGVkZ2VyKCkgewogICAgICAgICAgICByZXR1\ncm4gbGVkZ2VySWQ7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBsb25nIGdl\ndEVudHJ5KCkgewogICAgICAgICAgICByZXR1cm4gZW50cnlJZDsKICAgICAg\nICB9CiAgICB9CgogICAgLy8gV3JpdGUgQ2FsbGJhY2sgZG8gbm90aGluZwog\nICAgc3RhdGljIGNsYXNzIE5vcFdyaXRlQ2FsbGJhY2sgaW1wbGVtZW50cyBX\ncml0ZUNhbGxiYWNrIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCB3cml0ZUNvbXBsZXRlKGludCByYywgbG9uZyBsZWRnZXJJZCwg\nbG9uZyBlbnRyeUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiRmluaXNoZWQgd3JpdGluZyBlbnRyeSB7fSBA\nIGxlZGdlciB7fSBmb3Ige30gOiB7fSIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgbmV3IE9iamVjdFtdIHsgZW50cnlJZCwgbGVkZ2VySWQsIGFkZHIs\nIHJjIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZp\nbmFsIHN0YXRpYyBGdXR1cmU8Qm9vbGVhbj4gU1VDQ0VTU19GVVRVUkUgPSBu\nZXcgRnV0dXJlPEJvb2xlYW4+KCkgewogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbChib29sZWFuIG1heUludGVycnVw\ndElmUnVubmluZykgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgQm9vbGVhbiBnZXQoKSB7IHJldHVybiB0cnVl\nOyB9CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIEJvb2xlYW4g\nZ2V0KGxvbmcgdGltZW91dCwgVGltZVVuaXQgdW5pdCkgeyByZXR1cm4gdHJ1\nZTsgfQogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFu\nIGlzQ2FuY2VsbGVkKCkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0RvbmUoKSB7CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH07CgogICAgc3Rh\ndGljIGNsYXNzIENvdW50RG93bkxhdGNoRnV0dXJlPFQ+IGltcGxlbWVudHMg\nRnV0dXJlPFQ+IHsKCiAgICAgICAgVCB2YWx1ZSA9IG51bGw7CiAgICAgICAg\ndm9sYXRpbGUgYm9vbGVhbiBkb25lID0gZmFsc2U7CiAgICAgICAgQ291bnRE\nb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbChi\nb29sZWFuIG1heUludGVycnVwdElmUnVubmluZykgeyByZXR1cm4gZmFsc2U7\nIH0KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgVCBnZXQoKSB0\naHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICBsYXRj\naC5hd2FpdCgpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAg\nfQogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBUIGdldChsb25n\nIHRpbWVvdXQsIFRpbWVVbml0IHVuaXQpIHRocm93cyBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIGxhdGNoLmF3YWl0KHRpbWVvdXQsIHVu\naXQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0NhbmNl\nbGxlZCgpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBib29sZWFuIGlzRG9uZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuIGRvbmU7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHNldERvbmUo\nVCB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAg\nICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICBsYXRjaC5jb3Vu\ndERvd24oKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNsYXNzIEZ1\ndHVyZVdyaXRlQ2FsbGJhY2sgaW1wbGVtZW50cyBXcml0ZUNhbGxiYWNrIHsK\nCiAgICAgICAgQ291bnREb3duTGF0Y2hGdXR1cmU8Qm9vbGVhbj4gcmVzdWx0\nID0KICAgICAgICAgICAgbmV3IENvdW50RG93bkxhdGNoRnV0dXJlPEJvb2xl\nYW4+KCk7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIHdyaXRlQ29tcGxldGUoaW50IHJjLCBsb25nIGxlZGdlcklkLCBsb25nIGVu\ndHJ5SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmV0\nU29ja2V0QWRkcmVzcyBhZGRyLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAg\nIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nTE9HLmRlYnVnKCJGaW5pc2hlZCB3cml0aW5nIGVudHJ5IHt9IEAgbGVkZ2Vy\nIHt9IGZvciB7fSA6IHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICBu\nZXcgT2JqZWN0W10geyBlbnRyeUlkLCBsZWRnZXJJZCwgYWRkciwgcmMgfSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVzdWx0LnNldERvbmUoMCA9\nPSByYyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgRnV0dXJlPEJvb2xl\nYW4+IGdldFJlc3VsdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5jVGhyZWFkIGlz\nIGEgYmFja2dyb3VuZCB0aHJlYWQgd2hpY2ggZmx1c2hlcyBsZWRnZXIgaW5k\nZXggcGFnZXMgcGVyaW9kaWNhbGx5LgogICAgICogQWxzbyBpdCB0YWtlcyBy\nZXNwb25zaWJpbGl0eSBvZiBnYXJiYWdlIGNvbGxlY3Rpbmcgam91cm5hbCBm\naWxlcy4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIEJlZm9yZSBmbHVzaGlu\nZywgU3luY1RocmVhZCBmaXJzdCByZWNvcmRzIGEgbG9nIG1hcmtlciB7am91\ncm5hbElkLCBqb3VybmFsUG9zfSBpbiBtZW1vcnksCiAgICAgKiB3aGljaCBp\nbmRpY2F0ZXMgZW50cmllcyBiZWZvcmUgdGhpcyBsb2cgbWFya2VyIHdvdWxk\nIGJlIHBlcnNpc3RlZCB0byBsZWRnZXIgZmlsZXMuCiAgICAgKiBUaGVuIHN5\nbmMgdGhyZWFkIGJlZ2lucyBmbHVzaGluZyBsZWRnZXIgaW5kZXggcGFnZXMg\ndG8gbGVkZ2VyIGluZGV4IGZpbGVzLCBmbHVzaCBlbnRyeQogICAgICogbG9n\nZ2VyIHRvIGVuc3VyZSBhbGwgZW50cmllcyBwZXJzaXN0ZWQgdG8gZW50cnkg\nbG9nZ2VycyBmb3IgZnV0dXJlIHJlYWRzLgogICAgICogPC9wPgogICAgICog\nPHA+CiAgICAgKiBBZnRlciBhbGwgZGF0YSBoYXMgYmVlbiBwZXJzaXN0ZWQg\ndG8gbGVkZ2VyIGluZGV4IGZpbGVzIGFuZCBlbnRyeSBsb2dnZXJzLCBpdCBp\ncyBzYWZlCiAgICAgKiB0byBwZXJzaXN0IHRoZSBsb2cgbWFya2VyIHRvIGRp\nc2suIElmIGJvb2tpZSBmYWlsZWQgYWZ0ZXIgcGVyc2lzdCBsb2cgbWFyaywK\nICAgICAqIGJvb2tpZSBpcyBhYmxlIHRvIHJlbGF5IGpvdXJuYWwgZW50cmll\ncyBzdGFydGVkIGZyb20gbGFzdCBsb2cgbWFyayB3aXRob3V0IGxvc2luZwog\nICAgICogYW55IGVudHJpZXMuCiAgICAgKiA8L3A+CiAgICAgKiA8cD4KICAg\nICAqIFRob3NlIGpvdXJuYWwgZmlsZXMgd2hvc2UgaWQgYXJlIGxlc3MgdGhh\nbiB0aGUgbG9nIGlkIGluIGxhc3QgbG9nIG1hcmssIGNvdWxkIGJlCiAgICAg\nKiByZW1vdmVkIHNhZmVseSBhZnRlciBwZXJzaXN0aW5nIGxhc3QgbG9nIG1h\ncmsuIFdlIHByb3ZpZGUgYSBzZXR0aW5nIHRvIGxldCB1c2VyIGtlZXBpbmcK\nICAgICAqIG51bWJlciBvZiBvbGQgam91cm5hbCBmaWxlcyB3aGljaCBtYXkg\nYmUgdXNlZCBmb3IgbWFudWFsIHJlY292ZXJ5IGluIGNyaXRpY2FsIGRpc2Fz\ndGVyLgogICAgICogPC9wPgogICAgICovCiAgICBjbGFzcyBTeW5jVGhyZWFk\nIGV4dGVuZHMgVGhyZWFkIHsKICAgICAgICB2b2xhdGlsZSBib29sZWFuIHJ1\nbm5pbmcgPSB0cnVlOwogICAgICAgIC8vIGZsYWcgdG8gZW5zdXJlIHN5bmMg\ndGhyZWFkIHdpbGwgbm90IGJlIGludGVycnVwdGVkIGR1cmluZyBmbHVzaAog\nICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gZmx1c2hpbmcgPSBuZXcgQXRv\nbWljQm9vbGVhbihmYWxzZSk7CiAgICAgICAgLy8gbWFrZSBmbHVzaCBpbnRl\ncnZhbCBhcyBhIHBhcmFtZXRlcgogICAgICAgIGZpbmFsIGludCBmbHVzaElu\ndGVydmFsOwogICAgICAgIHB1YmxpYyBTeW5jVGhyZWFkKFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZikgewogICAgICAgICAgICBzdXBlcigiU3luY1RocmVh\nZCIpOwogICAgICAgICAgICBmbHVzaEludGVydmFsID0gY29uZi5nZXRGbHVz\naEludGVydmFsKCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiRmx1c2ggSW50\nZXJ2YWwgOiB7fSIsIGZsdXNoSW50ZXJ2YWwpOwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBPYmplY3Qgc3VzcGVuc2lvbkxvY2sgPSBuZXcgT2JqZWN0\nKCk7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIHN1c3BlbmRlZCA9IGZhbHNl\nOwoKICAgICAgICAvKioKICAgICAgICAgKiBTdXNwZW5kIHN5bmMgdGhyZWFk\nLiAoZm9yIHRlc3RpbmcpCiAgICAgICAgICovCiAgICAgICAgQFZpc2libGVG\nb3JUZXN0aW5nCiAgICAgICAgcHVibGljIHZvaWQgc3VzcGVuZFN5bmMoKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZChzdXNwZW5zaW9uTG9jaykgewog\nICAgICAgICAgICAgICAgc3VzcGVuZGVkID0gdHJ1ZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVzdW1lIHN5\nbmMgdGhyZWFkLiAoZm9yIHRlc3RpbmcpCiAgICAgICAgICovCiAgICAgICAg\nQFZpc2libGVGb3JUZXN0aW5nCiAgICAgICAgcHVibGljIHZvaWQgcmVzdW1l\nU3luYygpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkKHN1c3BlbnNpb25M\nb2NrKSB7CiAgICAgICAgICAgICAgICBzdXNwZW5kZWQgPSBmYWxzZTsKICAg\nICAgICAgICAgICAgIHN1c3BlbnNpb25Mb2NrLm5vdGlmeSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICB3aGlsZSAocnVubmluZykgewogICAgICAgICAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdChmbHVz\naEludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgh\nbGVkZ2VyU3RvcmFnZS5pc0ZsdXNoUmVxdWlyZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVw\ndCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChzdXNwZW5zaW9u\nTG9jaykgewogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3VzcGVu\nZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdXNwZW5zaW9u\nTG9jay53YWl0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IHRv\nIG1hcmsgZmx1c2hpbmcgZmxhZyB0byBtYWtlIHN1cmUgaXQgd291bGQgbm90\nIGJlIGludGVycnVwdGVkCiAgICAgICAgICAgICAgICAgICAgLy8gYnkgc2h1\ndGRvd24gZHVyaW5nIGZsdXNoaW5nLiBvdGhlcndpc2UgaXQgd2lsbCByZWNl\naXZlCiAgICAgICAgICAgICAgICAgICAgLy8gQ2xvc2VkQnlJbnRlcnJ1cHRF\neGNlcHRpb24gd2hpY2ggbWF5IGNhdXNlIGluZGV4IGZpbGUgJiBlbnRyeSBs\nb2dnZXIKICAgICAgICAgICAgICAgICAgICAvLyBjbG9zZWQgYW5kIGNvcnJ1\ncHRlZC4KICAgICAgICAgICAgICAgICAgICBpZiAoIWZsdXNoaW5nLmNvbXBh\ncmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHNldCBmbHVzaGluZyBmbGFnIGZhaWxlZCwgbWVhbnMgZmx1c2hp\nbmcgaXMgdHJ1ZSBub3cKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW5k\naWNhdGVzIGFub3RoZXIgdGhyZWFkIHdhbnRzIHRvIGludGVycnVwdCBzeW5j\nIHRocmVhZCB0byBleGl0CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\nLy8gam91cm5hbCBtYXJrIGxvZwogICAgICAgICAgICAgICAgICAgIGpvdXJu\nYWwubWFya0xvZygpOwoKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGZs\ndXNoRmFpbGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyU3RvcmFnZS5mbHVzaCgp\nOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vV3JpdGFibGVMZWRn\nZXJEaXJFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBm\nbHVzaEZhaWxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgIGZs\ndXNoaW5nLnNldChmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRy\nYW5zaXRpb25Ub1JlYWRPbmx5TW9kZSgpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gZmx1c2hpbmcgTGVkZ2VyIiwg\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGZsdXNoRmFpbGVkID0gdHJ1\nZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAg\nIC8vIGlmIGZsdXNoIGZhaWxlZCwgd2Ugc2hvdWxkIG5vdCByb2xsIGxhc3Qg\nbWFyaywgb3RoZXJ3aXNlIHdlIHdvdWxkCiAgICAgICAgICAgICAgICAgICAg\nLy8gaGF2ZSBzb21lIGxlZGdlcnMgYXJlIG5vdCBmbHVzaGVkIGFuZCB0aGVp\nciBqb3VybmFsIGVudHJpZXMgd2VyZSBsb3N0CiAgICAgICAgICAgICAgICAg\nICAgaWYgKCFmbHVzaEZhaWxlZCkgewogICAgICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbC5y\nb2xsTG9nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFs\nLmdjSm91cm5hbHMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmbHVzaGluZy5zZXQoZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvblRvUmVhZE9ubHlN\nb2RlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIGZsdXNo\naW5nIGZsYWcKICAgICAgICAgICAgICAgICAgICBmbHVzaGluZy5zZXQoZmFs\nc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChU\naHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNl\ncHRpb24gaW4gU3luY1RocmVhZCIsIHQpOwogICAgICAgICAgICAgICAgZmx1\nc2hpbmcuc2V0KGZhbHNlKTsKICAgICAgICAgICAgICAgIHRyaWdnZXJCb29r\naWVTaHV0ZG93bihFeGl0Q29kZS5CT09LSUVfRVhDRVBUSU9OKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2h1dGRvd24gc3luYyB0\naHJlYWQKICAgICAgICB2b2lkIHNodXRkb3duKCkgdGhyb3dzIEludGVycnVw\ndGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgcnVubmluZyA9IGZhbHNlOwog\nICAgICAgICAgICBpZiAoZmx1c2hpbmcuY29tcGFyZUFuZFNldChmYWxzZSwg\ndHJ1ZSkpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHNldHRpbmcgZmx1c2hp\nbmcgZmxhZyBzdWNjZWVkLCBtZWFucyBzeW5jVGhyZWFkIGlzIG5vdCBmbHVz\naGluZyBub3cKICAgICAgICAgICAgICAgIC8vIGl0IGlzIHNhZmUgdG8gaW50\nZXJydXB0IGl0c2VsZiBub3cgCiAgICAgICAgICAgICAgICB0aGlzLmludGVy\ncnVwdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuam9pbigp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgY2hl\nY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoRmlsZSBkaXIpIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKCFkaXIuZXhpc3RzKCkpIHsKICAgICAgICAg\nICAgRmlsZSBwYXJlbnQgPSBkaXIuZ2V0UGFyZW50RmlsZSgpOwogICAgICAg\nICAgICBGaWxlIHByZVYzdmVyc2lvbkZpbGUgPSBuZXcgRmlsZShkaXIuZ2V0\nUGFyZW50KCksCiAgICAgICAgICAgICAgICAgICAgQm9va0tlZXBlckNvbnN0\nYW50cy5WRVJTSU9OX0ZJTEVOQU1FKTsKCiAgICAgICAgICAgIGZpbmFsIEF0\nb21pY0Jvb2xlYW4gb2xkRGF0YUV4aXN0cyA9IG5ldyBBdG9taWNCb29sZWFu\nKGZhbHNlKTsKICAgICAgICAgICAgcGFyZW50Lmxpc3QobmV3IEZpbGVuYW1l\nRmlsdGVyKCkgewogICAgICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFu\nIGFjY2VwdChGaWxlIGRpciwgU3RyaW5nIG5hbWUpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKG5hbWUuZW5kc1dpdGgoIi50eG4iKSB8fCBuYW1l\nLmVuZHNXaXRoKCIuaWR4IikgfHwgbmFtZS5lbmRzV2l0aCgiLmxvZyIpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGREYXRhRXhpc3RzLnNl\ndCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYgKHByZVYz\ndmVyc2lvbkZpbGUuZXhpc3RzKCkgfHwgb2xkRGF0YUV4aXN0cy5nZXQoKSkg\newogICAgICAgICAgICAgICAgU3RyaW5nIGVyciA9ICJEaXJlY3RvcnkgbGF5\nb3V0IHZlcnNpb24gaXMgbGVzcyB0aGFuIDMsIHVwZ3JhZGUgbmVlZGVkIjsK\nICAgICAgICAgICAgICAgIExPRy5lcnJvcihlcnIpOwogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGVycik7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKCFkaXIubWtkaXJzKCkpIHsKICAgICAgICAgICAg\nICAgIFN0cmluZyBlcnIgPSAiVW5hYmxlIHRvIGNyZWF0ZSBkaXJlY3Rvcnkg\nIiArIGRpcjsKICAgICAgICAgICAgICAgIExPRy5lcnJvcihlcnIpOwogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGVycik7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVj\nayB0aGF0IHRoZSBlbnZpcm9ubWVudCBmb3IgdGhlIGJvb2tpZSBpcyBjb3Jy\nZWN0LgogICAgICogVGhpcyBtZWFucyB0aGF0IHRoZSBjb25maWd1cmF0aW9u\nIGhhcyBzdGF5ZWQgdGhlIHNhbWUgYXMgdGhlCiAgICAgKiBmaXJzdCBydW4g\nYW5kIHRoZSBmaWxlc3lzdGVtIHN0cnVjdHVyZSBpcyB1cCB0byBkYXRlLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgY2hlY2tFbnZpcm9ubWVudChab29L\nZWVwZXIgemspIHRocm93cyBCb29raWVFeGNlcHRpb24sIElPRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoemsgPT0gbnVsbCkgeyAvLyBleGlzdHMgb25seSBm\nb3IgdGVzdGluZywganVzdCBtYWtlIHN1cmUgZGlyZWN0b3JpZXMgYXJlIGNv\ncnJlY3QKICAgICAgICAgICAgY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoam91\ncm5hbERpcmVjdG9yeSk7CiAgICAgICAgICAgIGZvciAoRmlsZSBkaXIgOiBs\nZWRnZXJEaXJzTWFuYWdlci5nZXRBbGxMZWRnZXJEaXJzKCkpIHsKICAgICAg\nICAgICAgICAgICAgICBjaGVja0RpcmVjdG9yeVN0cnVjdHVyZShkaXIpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5nIGluc3RhbmNlSWQgPSBn\nZXRJbnN0YW5jZUlkKHprKTsKICAgICAgICAgICAgYm9vbGVhbiBuZXdFbnYg\nPSBmYWxzZTsKICAgICAgICAgICAgQ29va2llIG1hc3RlckNvb2tpZSA9IENv\nb2tpZS5nZW5lcmF0ZUNvb2tpZShjb25mKTsKICAgICAgICAgICAgaWYgKG51\nbGwgIT0gaW5zdGFuY2VJZCkgewogICAgICAgICAgICAgICAgbWFzdGVyQ29v\na2llLnNldEluc3RhbmNlSWQoaW5zdGFuY2VJZCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIENvb2tpZSB6a0Nv\nb2tpZSA9IENvb2tpZS5yZWFkRnJvbVpvb0tlZXBlcih6aywgY29uZik7CiAg\nICAgICAgICAgICAgICBtYXN0ZXJDb29raWUudmVyaWZ5KHprQ29va2llKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vTm9kZUV4\nY2VwdGlvbiBubmUpIHsKICAgICAgICAgICAgICAgIG5ld0VudiA9IHRydWU7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTGlzdDxGaWxlPiBtaXNzZWRD\nb29raWVEaXJzID0gbmV3IEFycmF5TGlzdDxGaWxlPigpOwogICAgICAgICAg\nICBjaGVja0RpcmVjdG9yeVN0cnVjdHVyZShqb3VybmFsRGlyZWN0b3J5KTsK\nCiAgICAgICAgICAgIC8vIHRyeSB0byByZWFkIGNvb2tpZSBmcm9tIGpvdXJu\nYWwgZGlyZWN0b3J5CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBDb29raWUgam91cm5hbENvb2tpZSA9IENvb2tpZS5yZWFkRnJvbURpcmVj\ndG9yeShqb3VybmFsRGlyZWN0b3J5KTsKICAgICAgICAgICAgICAgIGpvdXJu\nYWxDb29raWUudmVyaWZ5KG1hc3RlckNvb2tpZSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBmbmYpIHsKICAgICAgICAg\nICAgICAgIG1pc3NlZENvb2tpZURpcnMuYWRkKGpvdXJuYWxEaXJlY3Rvcnkp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoRmlsZSBkaXIgOiBs\nZWRnZXJEaXJzTWFuYWdlci5nZXRBbGxMZWRnZXJEaXJzKCkpIHsKICAgICAg\nICAgICAgICAgIGNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKGRpcik7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIENvb2tpZSBj\nID0gQ29va2llLnJlYWRGcm9tRGlyZWN0b3J5KGRpcik7CiAgICAgICAgICAg\nICAgICAgICAgYy52ZXJpZnkobWFzdGVyQ29va2llKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEZpbGVOb3RGb3VuZEV4Y2VwdGlvbiBmbmYpIHsKICAg\nICAgICAgICAgICAgICAgICBtaXNzZWRDb29raWVEaXJzLmFkZChkaXIpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBp\nZiAoIW5ld0VudiAmJiBtaXNzZWRDb29raWVEaXJzLnNpemUoKSA+IDApewog\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJDb29raWUgZXhpc3RzIGluIHpv\nb2tlZXBlciwgYnV0IG5vdCBpbiBhbGwgbG9jYWwgZGlyZWN0b3JpZXMuICIK\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiIERpcmVjdG9yaWVzIG1pc3Np\nbmcgY29va2llIGZpbGUgYXJlICIgKyBtaXNzZWRDb29raWVEaXJzKTsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uSW52YWxp\nZENvb2tpZUV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChuZXdFbnYpIHsKICAgICAgICAgICAgICAgIGlmIChtaXNzZWRDb29r\naWVEaXJzLnNpemUoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBMT0cu\nZGVidWcoIkRpcmVjdG9yaWVzIG1pc3NpbmcgY29va2llIGZpbGUgYXJlIHt9\nIiwgbWlzc2VkQ29va2llRGlycyk7CiAgICAgICAgICAgICAgICAgICAgbWFz\ndGVyQ29va2llLndyaXRlVG9EaXJlY3Rvcnkoam91cm5hbERpcmVjdG9yeSk7\nCiAgICAgICAgICAgICAgICAgICAgZm9yIChGaWxlIGRpciA6IGxlZGdlckRp\ncnNNYW5hZ2VyLmdldEFsbExlZGdlckRpcnMoKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBtYXN0ZXJDb29raWUud3JpdGVUb0RpcmVjdG9yeShkaXIp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIG1hc3RlckNvb2tpZS53cml0ZVRvWm9vS2VlcGVyKHpr\nLCBjb25mKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEtlZXBl\nckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxk\nbid0IGFjY2VzcyBjb29raWUgaW4gem9va2VlcGVyIiwga2UpOwogICAgICAg\nICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9uLkludmFsaWRDb29raWVF\neGNlcHRpb24oa2UpOwogICAgICAgIH0gY2F0Y2ggKFVua25vd25Ib3N0RXhj\nZXB0aW9uIHVoZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkbid0\nIGNoZWNrIGNvb2tpZXMsIG5ldHdvcmtpbmcgaXMgYnJva2VuIiwgdWhlKTsK\nICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlk\nQ29va2llRXhjZXB0aW9uKHVoZSk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNl\ncHRpb24gaW9lKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgYWNj\nZXNzaW5nIGNvb2tpZSBvbiBkaXNrcyIsIGlvZSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlv\nbihpb2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGllKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGhyZWFkIGludGVycnVw\ndGVkIHdoaWxlIGNoZWNraW5nIGNvb2tpZXMsIGV4aXRpbmciLCBpZSk7CiAg\nICAgICAgICAgIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uSW52YWxpZENv\nb2tpZUV4Y2VwdGlvbihpZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUmV0dXJuIHRoZSBjb25maWd1cmVkIGFkZHJlc3Mgb2YgdGhlIGJv\nb2tpZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBJbmV0U29ja2V0QWRk\ncmVzcyBnZXRCb29raWVBZGRyZXNzKFNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZikKICAgICAgICAgICAgdGhyb3dzIFVua25vd25Ib3N0RXhjZXB0aW9uIHsK\nICAgICAgICByZXR1cm4gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRBZGRy\nZXNzLmdldExvY2FsSG9zdCgpCiAgICAgICAgICAgICAgICAuZ2V0SG9zdEFk\nZHJlc3MoKSwgY29uZi5nZXRCb29raWVQb3J0KCkpOwogICAgfQoKICAgIHBy\naXZhdGUgU3RyaW5nIGdldEluc3RhbmNlSWQoWm9vS2VlcGVyIHprKSB0aHJv\nd3MgS2VlcGVyRXhjZXB0aW9uLAogICAgICAgICAgICBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIGluc3RhbmNlSWQgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJ5dGVbXSBkYXRhID0gemsuZ2V0\nRGF0YShjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkgKyAiLyIKICAgICAg\nICAgICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFudHMuSU5TVEFOQ0VJ\nRCwgZmFsc2UsIG51bGwpOwogICAgICAgICAgICBpbnN0YW5jZUlkID0gbmV3\nIFN0cmluZyhkYXRhKTsKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRp\nb24uTm9Ob2RlRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLndhcm4o\nIklOU1RBTkNFSUQgbm90IGV4aXN0cyBpbiB6b29rZWVwZXIuIE5vdCBjb25z\naWRlcmluZyBpdCBmb3IgZGF0YSB2ZXJpZmljYXRpb24iKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGluc3RhbmNlSWQ7CiAgICB9CgogICAgcHVibGlj\nIExlZGdlckRpcnNNYW5hZ2VyIGdldExlZGdlckRpcnNNYW5hZ2VyKCkgewog\nICAgICAgIHJldHVybiBsZWRnZXJEaXJzTWFuYWdlcjsKICAgIH0KCiAgICBw\ndWJsaWMgc3RhdGljIEZpbGUgZ2V0Q3VycmVudERpcmVjdG9yeShGaWxlIGRp\ncikgewogICAgICAgIHJldHVybiBuZXcgRmlsZShkaXIsIEJvb2tLZWVwZXJD\nb25zdGFudHMuQ1VSUkVOVF9ESVIpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0\naWMgRmlsZVtdIGdldEN1cnJlbnREaXJlY3RvcmllcyhGaWxlW10gZGlycykg\newogICAgICAgIEZpbGVbXSBjdXJyZW50RGlycyA9IG5ldyBGaWxlW2RpcnMu\nbGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGRpcnMubGVu\nZ3RoOyBpKyspIHsKICAgICAgICAgICAgY3VycmVudERpcnNbaV0gPSBnZXRD\ndXJyZW50RGlyZWN0b3J5KGRpcnNbaV0pOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gY3VycmVudERpcnM7CiAgICB9CgoKICAgIHB1YmxpYyBCb29raWUo\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIoIkJvb2tp\nZS0iICsgY29uZi5nZXRCb29raWVQb3J0KCkpOwogICAgICAgIHRoaXMuYm9v\na2llUmVnaXN0cmF0aW9uUGF0aCA9IGNvbmYuZ2V0WmtBdmFpbGFibGVCb29r\naWVzUGF0aCgpICsgIi8iOwogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAg\nICAgICAgdGhpcy5qb3VybmFsRGlyZWN0b3J5ID0gZ2V0Q3VycmVudERpcmVj\ndG9yeShjb25mLmdldEpvdXJuYWxEaXIoKSk7CiAgICAgICAgdGhpcy5sZWRn\nZXJEaXJzTWFuYWdlciA9IG5ldyBMZWRnZXJEaXJzTWFuYWdlcihjb25mKTsK\nICAgICAgICAvLyBpbnN0YW50aWF0ZSB6b29rZWVwZXIgY2xpZW50IHRvIGlu\naXRpYWxpemUgbGVkZ2VyIG1hbmFnZXIKICAgICAgICB0aGlzLnprID0gaW5z\ndGFudGlhdGVab29rZWVwZXJDbGllbnQoY29uZik7CiAgICAgICAgY2hlY2tF\nbnZpcm9ubWVudCh0aGlzLnprKTsKICAgICAgICBsZWRnZXJNYW5hZ2VyRmFj\ndG9yeSA9IExlZGdlck1hbmFnZXJGYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXJG\nYWN0b3J5KGNvbmYsIHRoaXMuemspOwogICAgICAgIExPRy5pbmZvKCJpbnN0\nYW50aWF0ZSBsZWRnZXIgbWFuYWdlciB7fSIsIGxlZGdlck1hbmFnZXJGYWN0\nb3J5LmdldENsYXNzKCkuZ2V0TmFtZSgpKTsKICAgICAgICBsZWRnZXJNYW5h\nZ2VyID0gbGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2VyTWFuYWdlcigp\nOwogICAgICAgIHN5bmNUaHJlYWQgPSBuZXcgU3luY1RocmVhZChjb25mKTsK\nICAgICAgICBsZWRnZXJTdG9yYWdlID0gbmV3IEludGVybGVhdmVkTGVkZ2Vy\nU3RvcmFnZShjb25mLCBsZWRnZXJNYW5hZ2VyLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckRp\ncnNNYW5hZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBCb29raWVTYWZlRW50cnlBZGRlcigp\nKTsKICAgICAgICBoYW5kbGVzID0gbmV3IEhhbmRsZUZhY3RvcnlJbXBsKGxl\nZGdlclN0b3JhZ2UpOwogICAgICAgIC8vIGluc3RhbnRpYXRlIHRoZSBqb3Vy\nbmFsCiAgICAgICAgam91cm5hbCA9IG5ldyBKb3VybmFsKGNvbmYsIGxlZGdl\nckRpcnNNYW5hZ2VyKTsKCiAgICAgICAgLy8gWksgZXBoZW1lcmFsIG5vZGUg\nZm9yIHRoaXMgQm9va2llLgogICAgICAgIHprQm9va2llUmVnUGF0aCA9IHRo\naXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aCArIGdldE15SWQoKTsKICAgIH0K\nCiAgICBwcml2YXRlIFN0cmluZyBnZXRNeUlkKCkgdGhyb3dzIFVua25vd25I\nb3N0RXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gSW5ldEFkZHJlc3MuZ2V0\nTG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSArICI6IgogICAgICAgICAg\nICAgICAgKyBjb25mLmdldEJvb2tpZVBvcnQoKTsKICAgIH0KCiAgICB2b2lk\nIHJlYWRKb3VybmFsKCkgdGhyb3dzIElPRXhjZXB0aW9uLCBCb29raWVFeGNl\ncHRpb24gewogICAgICAgIGpvdXJuYWwucmVwbGF5KG5ldyBKb3VybmFsU2Nh\nbm5lcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHByb2Nlc3MoaW50IGpvdXJuYWxWZXJzaW9uLCBsb25nIG9m\nZnNldCwgQnl0ZUJ1ZmZlciByZWNCdWZmKSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgICAgICAgICAgbG9uZyBsZWRnZXJJZCA9IHJlY0J1ZmYuZ2V0\nTG9uZygpOwogICAgICAgICAgICAgICAgbG9uZyBlbnRyeUlkID0gcmVjQnVm\nZi5nZXRMb25nKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIExPRy5kZWJ1ZygiUmVwbGF5IGpvdXJuYWwgLSBsZWRnZXIg\naWQgOiB7fSwgZW50cnkgaWQgOiB7fS4iLCBsZWRnZXJJZCwgZW50cnlJZCk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5SWQgPT0gTUVUQUVOVFJZ\nX0lEX0xFREdFUl9LRVkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGpvdXJuYWxWZXJzaW9uID49IDMpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGludCBtYXN0ZXJLZXlMZW4gPSByZWNCdWZmLmdldEludCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIG1hc3RlcktleSA9\nIG5ldyBieXRlW21hc3RlcktleUxlbl07CgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgcmVjQnVmZi5nZXQobWFzdGVyS2V5KTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG1hc3RlcktleUNhY2hlLnB1dChsZWRnZXJJZCwg\nbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbigiSW52YWxpZCBqb3VybmFsLiBDb250YWlucyBqb3VybmFsS2V5ICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGJ1dCBs\nYXlvdXQgdmVyc2lvbiAoIiArIGpvdXJuYWxWZXJzaW9uCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgIikgaXMgdG9vIG9sZCB0byBo\nb2xkIHRoaXMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoZW50cnlJZCA9PSBNRVRBRU5UUllf\nSURfRkVOQ0VfS0VZKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChq\nb3VybmFsVmVyc2lvbiA+PSA0KSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBieXRlW10ga2V5ID0gbWFzdGVyS2V5Q2FjaGUuZ2V0KGxlZGdlcklk\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChrZXkgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IGxl\nZGdlclN0b3JhZ2UucmVhZE1hc3RlcktleShsZWRnZXJJZCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMZWRnZXJEZXNjcmlwdG9yIGhhbmRsZSA9IGhhbmRsZXMuZ2V0SGFu\nZGxlKGxlZGdlcklkLCBrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaGFuZGxlLnNldEZlbmNlZCgpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IElPRXhjZXB0aW9uKCJJbnZhbGlkIGpvdXJuYWwuIENvbnRhaW5zIGZl\nbmNlS2V5ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiIGJ1dCBsYXlvdXQgdmVyc2lvbiAoIiArIGpvdXJuYWxWZXJzaW9uCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIikgaXMgdG9v\nIG9sZCB0byBob2xkIHRoaXMiKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGJ5dGVbXSBrZXkgPSBtYXN0ZXJLZXlDYWNoZS5nZXQobGVk\nZ2VySWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGtleSA9IGxlZGdl\nclN0b3JhZ2UucmVhZE1hc3RlcktleShsZWRnZXJJZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgTGVkZ2Vy\nRGVzY3JpcHRvciBoYW5kbGUgPSBoYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJ\nZCwga2V5KTsKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlY0J1ZmYucmV3\naW5kKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZS5hZGRFbnRy\neShyZWNCdWZmKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChOb0xlZGdlckV4Y2VwdGlvbiBuc2xlKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJTa2lwIHJlcGxheWluZyBlbnRy\naWVzIG9mIGxlZGdlciB7fSBzaW5jZSBpdCB3YXMgZGVsZXRlZC4iLCBsZWRn\nZXJJZCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRp\nb24gYmUpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oYmUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSk7CiAgICB9CgogICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lk\nIHN0YXJ0KCkgewogICAgICAgIHNldERhZW1vbih0cnVlKTsKICAgICAgICBM\nT0cuZGVidWcoIkknbSBzdGFydGluZyBhIGJvb2tpZSB3aXRoIGpvdXJuYWwg\nZGlyZWN0b3J5IHt9Iiwgam91cm5hbERpcmVjdG9yeS5nZXROYW1lKCkpOwog\nICAgICAgIC8vIHJlcGxheSBqb3VybmFscwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHJlYWRKb3VybmFsKCk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNl\ncHRpb24gaW9lKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9u\nIHdoaWxlIHJlcGxheWluZyBqb3VybmFscywgc2h1dHRpbmcgZG93biIsIGlv\nZSk7CiAgICAgICAgICAgIHNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9FWENF\nUFRJT04pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBjYXRjaCAo\nQm9va2llRXhjZXB0aW9uIGJlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nRXhjZXB0aW9uIHdoaWxlIHJlcGxheWluZyBqb3VybmFscywgc2h1dHRpbmcg\nZG93biIsIGJlKTsKICAgICAgICAgICAgc2h1dGRvd24oRXhpdENvZGUuQk9P\nS0lFX0VYQ0VQVElPTik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCiAgICAgICAgLy8gc3RhcnQgYm9va2llIHRocmVhZAogICAgICAgIHN1cGVy\nLnN0YXJ0KCk7CgogICAgICAgIGxlZGdlckRpcnNNYW5hZ2VyLmFkZExlZGdl\nckRpcnNMaXN0ZW5lcihnZXRMZWRnZXJEaXJzTGlzdGVuZXIoKSk7CiAgICAg\nICAgLy9TdGFydCBEaXNrQ2hlY2tlciB0aHJlYWQKICAgICAgICBsZWRnZXJE\naXJzTWFuYWdlci5zdGFydCgpOwoKICAgICAgICBsZWRnZXJTdG9yYWdlLnN0\nYXJ0KCk7CgogICAgICAgIHN5bmNUaHJlYWQuc3RhcnQoKTsKICAgICAgICAv\nLyBzZXQgcnVubmluZyBoZXJlLgogICAgICAgIC8vIHNpbmNlIGJvb2tpZSBz\nZXJ2ZXIgdXNlIHJ1bm5pbmcgYXMgYSBmbGFnIHRvIHRlbGwgYm9va2llIHNl\ncnZlciB3aGV0aGVyIGl0IGlzIGFsaXZlCiAgICAgICAgLy8gaWYgc2V0dGlu\nZyBpdCBpbiBib29raWUgdGhyZWFkLCB0aGUgd2F0Y2hlciBtaWdodCBydW4g\nYmVmb3JlIGJvb2tpZSB0aHJlYWQuCiAgICAgICAgcnVubmluZyA9IHRydWU7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVnaXN0ZXJCb29raWUoY29u\nZik7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBMT0cuZXJyb3IoIkNvdWxkbid0IHJlZ2lzdGVyIGJvb2tpZSB3aXRo\nIHpvb2tlZXBlciwgc2h1dHRpbmcgZG93biIsIGUpOwogICAgICAgICAgICBz\naHV0ZG93bihFeGl0Q29kZS5aS19SRUdfRkFJTCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qCiAgICAgKiBHZXQgdGhlIERpc2tGYWlsdXJlIGxpc3RlbmVy\nIGZvciB0aGUgYm9va2llCiAgICAgKi8KICAgIHByaXZhdGUgTGVkZ2VyRGly\nc0xpc3RlbmVyIGdldExlZGdlckRpcnNMaXN0ZW5lcigpIHsKCiAgICAgICAg\ncmV0dXJuIG5ldyBMZWRnZXJEaXJzTGlzdGVuZXIoKSB7CgogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgZGlza0Z1bGwo\nRmlsZSBkaXNrKSB7CiAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIG5lZWRz\nIHRvIGJlIGhhbmRsZWQgaGVyZS4KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGRpc2tGYWls\nZWQoRmlsZSBkaXNrKSB7CiAgICAgICAgICAgICAgICAvLyBTaHV0ZG93biB0\naGUgYm9va2llIG9uIGRpc2sgZmFpbHVyZS4KICAgICAgICAgICAgICAgIHRy\naWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29kZS5CT09LSUVfRVhDRVBUSU9O\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIGFsbERpc2tzRnVsbCgpIHsKICAgICAgICAg\nICAgICAgIC8vIFRyYW5zaXRpb24gdG8gcmVhZE9ubHkgbW9kZSBvbiBhbGwg\nZGlza3MgZnVsbAogICAgICAgICAgICAgICAgdHJhbnNpdGlvblRvUmVhZE9u\nbHlNb2RlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBmYXRhbEVycm9yKCkgewogICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJGYXRhbCBlcnJvciByZXBvcnRlZCBi\neSBsZWRnZXJEaXJzTWFuYWdlciIpOwogICAgICAgICAgICAgICAgdHJpZ2dl\nckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9FWENFUFRJT04pOwog\nICAgICAgICAgICB9CiAgICAgICAgfTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJlZ2lzdGVyIGpteCB3aXRoIHBhcmVudAogICAgICoKICAgICAqIEBwYXJh\nbSBwYXJlbnQgcGFyZW50IGJrIG1iZWFuIGluZm8KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgcmVnaXN0ZXJKTVgoQktNQmVhbkluZm8gcGFyZW50KSB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgam14Qm9va2llQmVhbiA9IG5ldyBC\nb29raWVCZWFuKHRoaXMpOwogICAgICAgICAgICBCS01CZWFuUmVnaXN0cnku\nZ2V0SW5zdGFuY2UoKS5yZWdpc3RlcihqbXhCb29raWVCZWFuLCBwYXJlbnQp\nOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGpteExlZGdl\nclN0b3JhZ2VCZWFuID0gdGhpcy5sZWRnZXJTdG9yYWdlLmdldEpNWEJlYW4o\nKTsKICAgICAgICAgICAgICAgIEJLTUJlYW5SZWdpc3RyeS5nZXRJbnN0YW5j\nZSgpLnJlZ2lzdGVyKGpteExlZGdlclN0b3JhZ2VCZWFuLCBqbXhCb29raWVC\nZWFuKTsKICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIExPRy53YXJuKCJGYWlsZWQgdG8gcmVnaXN0ZXIgd2l0\naCBKTVggZm9yIGxlZGdlciBjYWNoZSIsIGUpOwogICAgICAgICAgICAgICAg\nam14TGVkZ2VyU3RvcmFnZUJlYW4gPSBudWxsOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLndhcm4oIkZhaWxlZCB0byByZWdpc3RlciB3aXRoIEpNWCIsIGUpOwogICAg\nICAgICAgICBqbXhCb29raWVCZWFuID0gbnVsbDsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBVbnJlZ2lzdGVyIGpteAogICAgICovCiAgICBw\ndWJsaWMgdm9pZCB1bnJlZ2lzdGVySk1YKCkgewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGlmIChqbXhMZWRnZXJTdG9yYWdlQmVhbiAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBCS01CZWFuUmVnaXN0cnkuZ2V0SW5zdGFuY2Uo\nKS51bnJlZ2lzdGVyKGpteExlZGdlclN0b3JhZ2VCZWFuKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIExPRy53YXJuKCJGYWlsZWQgdG8gdW5yZWdpc3RlciB3aXRoIEpNWCIs\nIGUpOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nam14Qm9va2llQmVhbiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBCS01C\nZWFuUmVnaXN0cnkuZ2V0SW5zdGFuY2UoKS51bnJlZ2lzdGVyKGpteEJvb2tp\nZUJlYW4pOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgTE9HLndhcm4oIkZhaWxlZCB0byB1bnJl\nZ2lzdGVyIHdpdGggSk1YIiwgZSk7CiAgICAgICAgfQogICAgICAgIGpteEJv\nb2tpZUJlYW4gPSBudWxsOwogICAgICAgIGpteExlZGdlclN0b3JhZ2VCZWFu\nID0gbnVsbDsKICAgIH0KCgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZSB0\naGUgWm9vS2VlcGVyIGNsaWVudCBmb3IgdGhlIEJvb2tpZS4KICAgICAqLwog\nICAgcHJpdmF0ZSBab29LZWVwZXIgaW5zdGFudGlhdGVab29rZWVwZXJDbGll\nbnQoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBLZWVwZXJF\neGNlcHRpb24gewogICAgICAgIGlmIChjb25mLmdldFprU2VydmVycygpID09\nIG51bGwpIHsKICAgICAgICAgICAgTE9HLndhcm4oIk5vIFpLIHNlcnZlcnMg\ncGFzc2VkIHRvIEJvb2tpZSBjb25zdHJ1Y3RvciBzbyBCb29rS2VlcGVyIGNs\naWVudHMgd29uJ3Qga25vdyBhYm91dCB0aGlzIHNlcnZlciEiKTsKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIC8vIENyZWF0\nZSB0aGUgWm9vS2VlcGVyIGNsaWVudCBpbnN0YW5jZQogICAgICAgIHJldHVy\nbiBuZXdab29rZWVwZXIoY29uZi5nZXRaa1NlcnZlcnMoKSwgY29uZi5nZXRa\na1RpbWVvdXQoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWdpc3RlciBh\ncyBhbiBhdmFpbGFibGUgYm9va2llCiAgICAgKi8KICAgIHByb3RlY3RlZCB2\nb2lkIHJlZ2lzdGVyQm9va2llKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZikg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobnVsbCA9PSB6aykg\newogICAgICAgICAgICAvLyB6b29rZWVwZXIgaW5zdGFuY2UgaXMgbnVsbCwg\nbWVhbnMgbm90IHJlZ2lzdGVyIGl0c2VsZiB0byB6awogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBaSyBlcGhlbWVyYWwgbm9k\nZSBmb3IgdGhpcyBCb29raWUuCiAgICAgICAgU3RyaW5nIHprQm9va2llUmVn\nUGF0aCA9IHRoaXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aAogICAgICAgICAg\nICArIFN0cmluZ1V0aWxzLmFkZHJUb1N0cmluZyhnZXRCb29raWVBZGRyZXNz\nKGNvbmYpKTsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBwcmV2Tm9k\nZUxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIHRyeXsK\nICAgICAgICAgICAgV2F0Y2hlciB6a1ByZXZSZWdOb2Rld2F0Y2hlciA9IG5l\ndyBXYXRjaGVyKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBl\ndmVudCkgewogICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBwcmV2\nIHpub2RlIGRlbGV0aW9uLiBDb25uZWN0aW9uIGV4cGlyYXRpb24gaXMKICAg\nICAgICAgICAgICAgICAgICAvLyBub3QgaGFuZGxpbmcsIHNpbmNlIGJvb2tp\nZSBoYXMgbG9naWMgdG8gc2h1dGRvd24uCiAgICAgICAgICAgICAgICAgICAg\naWYgKEV2ZW50VHlwZS5Ob2RlRGVsZXRlZCA9PSBldmVudC5nZXRUeXBlKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJldk5vZGVMYXRjaC5jb3Vu\ndERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChudWxsICE9IHpr\nLmV4aXN0cyh6a0Jvb2tpZVJlZ1BhdGgsIHprUHJldlJlZ05vZGV3YXRjaGVy\nKSkgewogICAgICAgICAgICAgICAgTE9HLmluZm8oIlByZXZpb3VzIGJvb2tp\nZSByZWdpc3RyYXRpb24gem5vZGU6ICIKICAgICAgICAgICAgICAgICAgICAg\nICAgKyB6a0Jvb2tpZVJlZ1BhdGgKICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiIGV4aXN0cywgc28gd2FpdGluZyB6ayBzZXNzaW9udGltZW91dDogIgog\nICAgICAgICAgICAgICAgICAgICAgICArIGNvbmYuZ2V0WmtUaW1lb3V0KCkg\nKyAibXMgZm9yIHpub2RlIGRlbGV0aW9uIik7CiAgICAgICAgICAgICAgICAv\nLyB3YWl0aW5nIGZvciB0aGUgcHJldmlvdXMgYm9va2llIHJlZyB6bm9kZSBk\nZWxldGlvbgogICAgICAgICAgICAgICAgaWYgKCFwcmV2Tm9kZUxhdGNoLmF3\nYWl0KGNvbmYuZ2V0WmtUaW1lb3V0KCksCiAgICAgICAgICAgICAgICAgICAg\nICAgIFRpbWVVbml0Lk1JTExJU0VDT05EUykpIHsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgS2VlcGVyRXhjZXB0aW9uLk5vZGVFeGlzdHNFeGNl\ncHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6a0Jvb2tpZVJl\nZ1BhdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICAvLyBDcmVhdGUgdGhlIFpLIGVwaGVtZXJhbCBub2RlIGZvciB0\naGlzIEJvb2tpZS4KICAgICAgICAgICAgemsuY3JlYXRlKHprQm9va2llUmVn\nUGF0aCwgbmV3IGJ5dGVbMF0sIElkcy5PUEVOX0FDTF9VTlNBRkUsCiAgICAg\nICAgICAgICAgICAgICAgQ3JlYXRlTW9kZS5FUEhFTUVSQUwpOwogICAgICAg\nIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIlpLIGV4Y2VwdGlvbiByZWdpc3RlcmluZyBlcGhlbWVyYWwg\nWm5vZGUgZm9yIEJvb2tpZSEiLAogICAgICAgICAgICAgICAgICAgIGtlKTsK\nICAgICAgICAgICAgLy8gVGhyb3cgYW4gSU9FeGNlcHRpb24gYmFjayB1cC4g\nVGhpcyB3aWxsIGNhdXNlIHRoZSBCb29raWUKICAgICAgICAgICAgLy8gY29u\nc3RydWN0b3IgdG8gZXJyb3Igb3V0LiBBbHRlcm5hdGl2ZWx5LCB3ZSBjb3Vs\nZCBkbyBhIFN5c3RlbQogICAgICAgICAgICAvLyBleGl0IGhlcmUgYXMgdGhp\ncyBpcyBhIGZhdGFsIGVycm9yLgogICAgICAgICAgICB0aHJvdyBuZXcgSU9F\neGNlcHRpb24oa2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhj\nZXB0aW9uIGllKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiWksgZXhjZXB0\naW9uIHJlZ2lzdGVyaW5nIGVwaGVtZXJhbCBabm9kZSBmb3IgQm9va2llISIs\nCiAgICAgICAgICAgICAgICAgICAgaWUpOwogICAgICAgICAgICAvLyBUaHJv\ndyBhbiBJT0V4Y2VwdGlvbiBiYWNrIHVwLiBUaGlzIHdpbGwgY2F1c2UgdGhl\nIEJvb2tpZQogICAgICAgICAgICAvLyBjb25zdHJ1Y3RvciB0byBlcnJvciBv\ndXQuIEFsdGVybmF0aXZlbHksIHdlIGNvdWxkIGRvIGEgU3lzdGVtCiAgICAg\nICAgICAgIC8vIGV4aXQgaGVyZSBhcyB0aGlzIGlzIGEgZmF0YWwgZXJyb3Iu\nCiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbihpZSk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qCiAgICAgKiBUcmFuc2l0aW9uIHRoZSBib29r\naWUgdG8gcmVhZE9ubHkgbW9kZQogICAgICovCiAgICBAVmlzaWJsZUZvclRl\nc3RpbmcKICAgIHB1YmxpYyB2b2lkIHRyYW5zaXRpb25Ub1JlYWRPbmx5TW9k\nZSgpIHsKICAgICAgICBpZiAoIXJlYWRPbmx5LmNvbXBhcmVBbmRTZXQoZmFs\nc2UsIHRydWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAg\nICAgICAgaWYgKCFjb25mLmlzUmVhZE9ubHlNb2RlRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgIExPRy53YXJuKCJSZWFkT25seSBtb2RlIGlzIG5vdCBlbmFi\nbGVkLiAiCiAgICAgICAgICAgICAgICAgICAgKyAiQ2FuIGJlIGVuYWJsZWQg\nYnkgY29uZmlndXJpbmcgIgogICAgICAgICAgICAgICAgICAgICsgIidyZWFk\nT25seU1vZGVFbmFibGVkPXRydWUnIGluIGNvbmZpZ3VyYXRpb24uIgogICAg\nICAgICAgICAgICAgICAgICsgIlNodXR0aW5nIGRvd24gYm9va2llIik7CiAg\nICAgICAgICAgIHRyaWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29kZS5CT09L\nSUVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nICAgICAgICBMT0cuaW5mbygiVHJhbnNpdGlvbmluZyBCb29raWUgdG8gUmVh\nZE9ubHkgbW9kZSwiCiAgICAgICAgICAgICAgICArICIgYW5kIHdpbGwgc2Vy\ndmUgb25seSByZWFkIHJlcXVlc3RzIGZyb20gY2xpZW50cyEiKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAobnVsbCA9PSB6ay5leGlzdHModGhp\ncy5ib29raWVSZWdpc3RyYXRpb25QYXRoCiAgICAgICAgICAgICAgICAgICAg\nKyBCb29rS2VlcGVyQ29uc3RhbnRzLlJFQURPTkxZLCBmYWxzZSkpIHsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgemsuY3Jl\nYXRlKHRoaXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlJFQURPTkxZ\nLCBuZXcgYnl0ZVswXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIElk\ncy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1vZGUuUEVSU0lTVEVOVCk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChOb2RlRXhpc3RzRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIG5vZGUgaXMganVzdCBu\nb3cgY3JlYXRlZCBieSBzb21lb25lLgogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIC8vIENyZWF0ZSB0aGUgcmVhZG9ubHkg\nbm9kZQogICAgICAgICAgICB6ay5jcmVhdGUodGhpcy5ib29raWVSZWdpc3Ry\nYXRpb25QYXRoCiAgICAgICAgICAgICAgICAgICAgKyBCb29rS2VlcGVyQ29u\nc3RhbnRzLlJFQURPTkxZICsgIi8iICsgZ2V0TXlJZCgpLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBieXRlWzBdLCBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBD\ncmVhdGVNb2RlLkVQSEVNRVJBTCk7CiAgICAgICAgICAgIC8vIENsZWFyIHRo\nZSBjdXJyZW50IHJlZ2lzdGVyZWQgbm9kZQogICAgICAgICAgICB6ay5kZWxl\ndGUoemtCb29raWVSZWdQYXRoLCAtMSk7CiAgICAgICAgfSBjYXRjaCAoSU9F\neGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGlu\nIHRyYW5zaXRpb24gdG8gUmVhZE9ubHkgTW9kZS4iCiAgICAgICAgICAgICAg\nICAgICAgKyAiIFNodXR0aW5nIGRvd24iLCBlKTsKICAgICAgICAgICAgdHJp\nZ2dlckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9FWENFUFRJT04p\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBjYXRjaCAoS2VlcGVy\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBp\nbiB0cmFuc2l0aW9uIHRvIFJlYWRPbmx5IE1vZGUuIgogICAgICAgICAgICAg\nICAgICAgICsgIiBTaHV0dGluZyBkb3duIiwgZSk7CiAgICAgICAgICAgIHRy\naWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29kZS5CT09LSUVfRVhDRVBUSU9O\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgVGhyZWFkLmN1cnJl\nbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgTE9HLndhcm4o\nIkludGVycnVwdGVkIEV4Y2VwdGlvbiB3aGlsZSB0cmFuc2l0aW9uaW5nIHRv\nIFJlYWRPbmx5IE1vZGUuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CiAgICB9CgogICAgLyoKICAgICAqIENoZWNrIHdoZXRoZXIgQm9va2ll\nIGlzIHdyaXRhYmxlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzUmVh\nZE9ubHkoKSB7CiAgICAgICAgcmV0dXJuIHJlYWRPbmx5LmdldCgpOwogICAg\nfQoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHpvb2tlZXBlciBjbGll\nbnQgdG8gemsgY2x1c3Rlci4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIEJv\nb2tpZSBTZXJ2ZXIganVzdCB1c2VkIHprIGNsaWVudCB3aGVuIHN5bmNpbmcg\nbGVkZ2VycyBmb3IgZ2FyYmFnZSBjb2xsZWN0aW9uLgogICAgICogU28gd2hl\nbiB6ayBjbGllbnQgaXMgZXhwaXJlZCwgaXQgbWVhbnMgdGhpcyBib29raWUg\nc2VydmVyIGlzIG5vdCBhdmFpbGFibGUgaW4KICAgICAqIGJvb2tpZSBzZXJ2\nZXIgbGlzdC4gVGhlIGJvb2tpZSBjbGllbnQgd2lsbCBiZSBub3RpZmllZCBm\nb3IgaXRzIGV4cGlyYXRpb24uIE5vCiAgICAgKiBtb3JlIGJvb2tpZSByZXF1\nZXN0IHdpbGwgYmUgc2VudCB0byB0aGlzIHNlcnZlci4gU28gaXQncyBiZXR0\nZXIgdG8gZXhpdCB3aGVuIHprCiAgICAgKiBleHBpcmVkLgogICAgICogPC9w\nPgogICAgICogPHA+CiAgICAgKiBTaW5jZSB0aGVyZSBhcmUgbG90cyBvZiBi\nayBvcGVyYXRpb25zIGNhY2hlZCBpbiBxdWV1ZSwgc28gd2Ugd2FpdCBmb3Ig\nYWxsIHRoZSBvcGVyYXRpb25zCiAgICAgKiBhcmUgcHJvY2Vzc2VkIGFuZCBx\ndWl0LiBJdCBpcyBkb25lIGJ5IGNhbGxpbmcgPGI+c2h1dGRvd248L2I+Lgog\nICAgICogPC9wPgogICAgICoKICAgICAqIEBwYXJhbSB6a1NlcnZlcnMgdGhl\nIHF1b3J1bSBsaXN0IG9mIHprIHNlcnZlcnMKICAgICAqIEBwYXJhbSBzZXNz\naW9uVGltZW91dCBzZXNzaW9uIHRpbWVvdXQgb2YgemsgY29ubmVjdGlvbgog\nICAgICoKICAgICAqIEByZXR1cm4gemsgY2xpZW50IGluc3RhbmNlCiAgICAg\nKi8KICAgIHByaXZhdGUgWm9vS2VlcGVyIG5ld1pvb2tlZXBlcihmaW5hbCBT\ndHJpbmcgemtTZXJ2ZXJzLAogICAgICAgICAgICBmaW5hbCBpbnQgc2Vzc2lv\nblRpbWVvdXQpIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24sCiAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAg\nWm9vS2VlcGVyV2F0Y2hlckJhc2UgdyA9IG5ldyBab29LZWVwZXJXYXRjaGVy\nQmFzZShjb25mLmdldFprVGltZW91dCgpKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRF\ndmVudCBldmVudCkgewogICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGV4\ncGlyZWQgY29ubmVjdGlvbi4KICAgICAgICAgICAgICAgIGlmIChldmVudC5n\nZXRTdGF0ZSgpLmVxdWFscyhXYXRjaGVyLkV2ZW50LktlZXBlclN0YXRlLkV4\ncGlyZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJaSyBj\nbGllbnQgY29ubmVjdGlvbiB0byB0aGUgWksgc2VydmVyIGhhcyBleHBpcmVk\nISIpOwogICAgICAgICAgICAgICAgICAgIHNodXRkb3duKEV4aXRDb2RlLlpL\nX0VYUElSRUQpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICBzdXBlci5wcm9jZXNzKGV2ZW50KTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgcmV0dXJu\nIFprVXRpbHMuY3JlYXRlQ29ubmVjdGVkWm9va2VlcGVyQ2xpZW50KHprU2Vy\ndmVycywgdyk7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNSdW5uaW5n\nKCkgewogICAgICAgIHJldHVybiBydW5uaW5nOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgIC8vIGJvb2tp\nZSB0aHJlYWQgd2FpdCBmb3Igam91cm5hbCB0aHJlYWQKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBzdGFydCBqb3VybmFsCiAgICAgICAgICAgIGpv\ndXJuYWwuc3RhcnQoKTsKICAgICAgICAgICAgLy8gd2FpdCB1bnRpbCBqb3Vy\nbmFsIHF1aXRzCiAgICAgICAgICAgIGpvdXJuYWwuam9pbigpOwogICAgICAg\nIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAg\nfQogICAgICAgIC8vIGlmIHRoZSBqb3VybmFsIHRocmVhZCBxdWl0cyBkdWUg\ndG8gc2h1dHRpbmcgZG93biwgaXQgaXMgb2sKICAgICAgICBpZiAoIXNodXR0\naW5nZG93bikgewogICAgICAgICAgICAvLyBzb21lIGVycm9yIGZvdW5kIGlu\nIGpvdXJuYWwgdGhyZWFkIGFuZCBpdCBxdWl0cwogICAgICAgICAgICAvLyBm\nb2xsb3dpbmcgYWRkIG9wZXJhdGlvbnMgdG8gaXQgd291bGQgaGFuZyB1bml0\nIGNsaWVudCB0aW1lb3V0CiAgICAgICAgICAgIC8vIHNvIHdlIHNob3VsZCBs\nZXQgYm9va2llIHNlcnZlciBleGlzdHMKICAgICAgICAgICAgTE9HLmVycm9y\nKCJKb3VybmFsIG1hbmFnZXIgcXVpdHMgdW5leHBlY3RlZGx5LiIpOwogICAg\nICAgICAgICB0cmlnZ2VyQm9va2llU2h1dGRvd24oRXhpdENvZGUuQk9PS0lF\nX0VYQ0VQVElPTik7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFRyaWdnZXJp\nbmcgdGhlIEJvb2tpZSBzaHV0ZG93biBpbiBpdHMgb3duIHRocmVhZCwKICAg\nIC8vIGJlY2F1c2Ugc2h1dGRvd24gY2FuIGJlIGNhbGxlZCBmcm9tIHN5bmMg\ndGhyZWFkIHdoaWNoIHdvdWxkIGJlCiAgICAvLyBpbnRlcnJ1cHRlZCBieSBz\naHV0ZG93biBjYWxsLgogICAgdm9pZCB0cmlnZ2VyQm9va2llU2h1dGRvd24o\nZmluYWwgaW50IGV4aXRDb2RlKSB7CiAgICAgICAgVGhyZWFkIHNodXRkb3du\nVGhyZWFkID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgcHVibGljIHZv\naWQgcnVuKCkgewogICAgICAgICAgICAgICAgQm9va2llLnRoaXMuc2h1dGRv\nd24oZXhpdENvZGUpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAg\nICBzaHV0ZG93blRocmVhZC5zdGFydCgpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHNodXRkb3duVGhyZWFkLmpvaW4oKTsKICAgICAgICB9IGNhdGNo\nIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIFRocmVh\nZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIExP\nRy5kZWJ1ZygiSW50ZXJydXB0ZWRFeGNlcHRpb24gd2hpbGUgd2FpdGluZyBm\nb3Igc2h1dGRvd24uIE5vdCBhIHByb2JsZW0hISIpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLyBwcm92aWRlZCBhIHB1YmxpYyBzaHV0ZG93biBtZXRob2Qg\nZm9yIG90aGVyIGNhbGxlcgogICAgLy8gdG8gc2h1dCBkb3duIGJvb2tpZSBn\ncmFjZWZ1bGx5CiAgICBwdWJsaWMgaW50IHNodXRkb3duKCkgewogICAgICAg\nIHJldHVybiBzaHV0ZG93bihFeGl0Q29kZS5PSyk7CiAgICB9CgogICAgLy8g\naW50ZXJuYWwgc2h1dGRvd24gbWV0aG9kIHRvIGxldCBzaHV0ZG93biBib29r\naWUgZ3JhY2VmdWxseQogICAgLy8gd2hlbiBlbmNvdW50ZXJpbmcgZXhjZXB0\naW9uCiAgICBzeW5jaHJvbml6ZWQgaW50IHNodXRkb3duKGludCBleGl0Q29k\nZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChydW5uaW5nKSB7\nIC8vIGF2b2lkIHNodXRkb3duIHR3aWNlCiAgICAgICAgICAgICAgICAvLyB0\naGUgZXhpdENvZGUgb25seSBzZXQgd2hlbiBmaXJzdCBzaHV0ZG93biB1c3Vh\nbGx5IGR1ZSB0byBleGNlcHRpb24gZm91bmQKICAgICAgICAgICAgICAgIHRo\naXMuZXhpdENvZGUgPSBleGl0Q29kZTsKICAgICAgICAgICAgICAgIC8vIG1h\ncmsgYm9va2llIGFzIGluIHNodXR0aW5nIGRvd24gcHJvZ3Jlc3MKICAgICAg\nICAgICAgICAgIHNodXR0aW5nZG93biA9IHRydWU7CgogICAgICAgICAgICAg\nICAgLy8gU2h1dGRvd24gdGhlIFpLIGNsaWVudAogICAgICAgICAgICAgICAg\naWYoemsgIT0gbnVsbCkgemsuY2xvc2UoKTsKCiAgICAgICAgICAgICAgICAv\nL1NodXRkb3duIGRpc2sgY2hlY2tlcgogICAgICAgICAgICAgICAgbGVkZ2Vy\nRGlyc01hbmFnZXIuc2h1dGRvd24oKTsKCiAgICAgICAgICAgICAgICAvLyBT\naHV0ZG93biBqb3VybmFsCiAgICAgICAgICAgICAgICBqb3VybmFsLnNodXRk\nb3duKCk7CiAgICAgICAgICAgICAgICB0aGlzLmpvaW4oKTsKICAgICAgICAg\nICAgICAgIHN5bmNUaHJlYWQuc2h1dGRvd24oKTsKCiAgICAgICAgICAgICAg\nICAvLyBTaHV0ZG93biB0aGUgRW50cnlMb2dnZXIgd2hpY2ggaGFzIHRoZSBH\nYXJiYWdlQ29sbGVjdG9yIFRocmVhZCBydW5uaW5nCiAgICAgICAgICAgICAg\nICBsZWRnZXJTdG9yYWdlLnNodXRkb3duKCk7CgogICAgICAgICAgICAgICAg\nLy8gY2xvc2UgTGVkZ2VyIE1hbmFnZXIKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgbGVkZ2VyTWFuYWdlci5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgICAgIGxlZGdlck1hbmFnZXJGYWN0b3J5LnVuaW5p\ndGlhbGl6ZSgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRp\nb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkZhaWxl\nZCB0byBjbG9zZSBhY3RpdmUgbGVkZ2VyIG1hbmFnZXIgOiAiLCBpZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBzZXR0aW5nIHJ1\nbm5pbmcgdG8gZmFsc2UgaGVyZSwgc28gd2F0Y2ggdGhyZWFkIGluIGJvb2tp\nZSBzZXJ2ZXIga25vdyBpdCBvbmx5IGFmdGVyIGJvb2tpZSBzaHV0IGRvd24K\nICAgICAgICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7\nCiAgICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJydXB0ZWQgZHVyaW5nIHNo\ndXR0aW5nIGRvd24gYm9va2llIDogIiwgaWUpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gdGhpcy5leGl0Q29kZTsKICAgIH0KCiAgICAvKiogCiAgICAg\nKiBSZXRyaWV2ZSB0aGUgbGVkZ2VyIGRlc2NyaXB0b3IgZm9yIHRoZSBsZWRn\nZXIgd2hpY2ggZW50cnkgc2hvdWxkIGJlIGFkZGVkIHRvLgogICAgICogVGhl\nIExlZGdlckRlc2NyaXB0b3IgcmV0dXJuZWQgZnJvbSB0aGlzIG1ldGhvZCBz\naG91bGQgYmUgZXZlbnR1YWxseSBmcmVlZCB3aXRoIAogICAgICogI3B1dEhh\nbmRsZSgpLgogICAgICoKICAgICAqIEB0aHJvd3MgQm9va2llRXhjZXB0aW9u\nIGlmIG1hc3RlcktleSBkb2VzIG5vdCBtYXRjaCB0aGUgbWFzdGVyIGtleSBv\nZiB0aGUgbGVkZ2VyCiAgICAgKi8KICAgIHByaXZhdGUgTGVkZ2VyRGVzY3Jp\ncHRvciBnZXRMZWRnZXJGb3JFbnRyeShCeXRlQnVmZmVyIGVudHJ5LCBieXRl\nW10gbWFzdGVyS2V5KSAKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIGxvbmcgbGVkZ2VySWQgPSBl\nbnRyeS5nZXRMb25nKCk7CiAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBsID0g\naGFuZGxlcy5nZXRIYW5kbGUobGVkZ2VySWQsIG1hc3RlcktleSk7CiAgICAg\nICAgaWYgKCFtYXN0ZXJLZXlDYWNoZS5jb250YWluc0tleShsZWRnZXJJZCkp\nIHsKICAgICAgICAgICAgLy8gbmV3IGhhbmRsZSwgd2Ugc2hvdWxkIGFkZCB0\naGUga2V5IHRvIGpvdXJuYWwgZW5zdXJlIHdlIGNhbiByZWJ1aWxkCiAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDgg\nKyA4ICsgNCArIG1hc3RlcktleS5sZW5ndGgpOwogICAgICAgICAgICBiYi5w\ndXRMb25nKGxlZGdlcklkKTsKICAgICAgICAgICAgYmIucHV0TG9uZyhNRVRB\nRU5UUllfSURfTEVER0VSX0tFWSk7CiAgICAgICAgICAgIGJiLnB1dEludCht\nYXN0ZXJLZXkubGVuZ3RoKTsKICAgICAgICAgICAgYmIucHV0KG1hc3Rlcktl\neSk7CiAgICAgICAgICAgIGJiLmZsaXAoKTsKCiAgICAgICAgICAgIGpvdXJu\nYWwubG9nQWRkRW50cnkoYmIsIG5ldyBOb3BXcml0ZUNhbGxiYWNrKCksIG51\nbGwpOwogICAgICAgICAgICBtYXN0ZXJLZXlDYWNoZS5wdXQobGVkZ2VySWQs\nIG1hc3RlcktleSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBsOwogICAg\nfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZEVudHJ5QnlMZWRnZXJJZChsb25n\nIGxlZGdlcklkLCBCeXRlQnVmZmVyIGVudHJ5KQogICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAgICBieXRlW10g\na2V5ID0gbGVkZ2VyU3RvcmFnZS5yZWFkTWFzdGVyS2V5KGxlZGdlcklkKTsK\nICAgICAgICBMZWRnZXJEZXNjcmlwdG9yIGhhbmRsZSA9IGhhbmRsZXMuZ2V0\nSGFuZGxlKGxlZGdlcklkLCBrZXkpOwogICAgICAgIGhhbmRsZS5hZGRFbnRy\neShlbnRyeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgYW4gZW50cnkg\ndG8gYSBsZWRnZXIgYXMgc3BlY2lmaWVkIGJ5IGhhbmRsZS4gCiAgICAgKi8K\nICAgIHByaXZhdGUgdm9pZCBhZGRFbnRyeUludGVybmFsKExlZGdlckRlc2Ny\naXB0b3IgaGFuZGxlLCBCeXRlQnVmZmVyIGVudHJ5LCBXcml0ZUNhbGxiYWNr\nIGNiLCBPYmplY3QgY3R4KQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBsZWRnZXJJZCA9\nIGhhbmRsZS5nZXRMZWRnZXJJZCgpOwogICAgICAgIGVudHJ5LnJld2luZCgp\nOwogICAgICAgIGxvbmcgZW50cnlJZCA9IGhhbmRsZS5hZGRFbnRyeShlbnRy\neSk7CgogICAgICAgIGVudHJ5LnJld2luZCgpOwogICAgICAgIExPRy50cmFj\nZSgiQWRkaW5nIHt9QHt9IiwgZW50cnlJZCwgbGVkZ2VySWQpOwogICAgICAg\nIGpvdXJuYWwubG9nQWRkRW50cnkoZW50cnksIGNiLCBjdHgpOwogICAgfQoK\nICAgIC8qKgogICAgICogQWRkIGVudHJ5IHRvIGEgbGVkZ2VyLCBldmVuIGlm\nIHRoZSBsZWRnZXIgaGFzIHByZXZpb3VzIGJlZW4gZmVuY2VkLiBUaGlzIHNo\nb3VsZCBvbmx5CiAgICAgKiBoYXBwZW4gaW4gYm9va2llIHJlY292ZXJ5IG9y\nIGxlZGdlciByZWNvdmVyeSBjYXNlcywgd2hlcmUgZW50cmllcyBhcmUgYmVp\nbmcgcmVwbGljYXRlcyAKICAgICAqIHNvIHRoYXQgdGhleSBleGlzdCBvbiBh\nIHF1b3J1bSBvZiBib29raWVzLiBUaGUgY29ycmVzcG9uZGluZyBjbGllbnQg\nc2lkZSBjYWxsIGZvciB0aGlzCiAgICAgKiBpcyBub3QgZXhwb3NlZCB0byB1\nc2Vycy4KICAgICAqLwogICAgcHVibGljIHZvaWQgcmVjb3ZlcnlBZGRFbnRy\neShCeXRlQnVmZmVyIGVudHJ5LCBXcml0ZUNhbGxiYWNrIGNiLCBPYmplY3Qg\nY3R4LCBieXRlW10gbWFzdGVyS2V5KSAKICAgICAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gZ2V0TGVkZ2Vy\nRm9yRW50cnkoZW50cnksIG1hc3RlcktleSk7CiAgICAgICAgICAgIHN5bmNo\ncm9uaXplZCAoaGFuZGxlKSB7CiAgICAgICAgICAgICAgICBhZGRFbnRyeUlu\ndGVybmFsKGhhbmRsZSwgZW50cnksIGNiLCBjdHgpOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBjYXRjaCAoTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIHRyYW5zaXRpb25Ub1JlYWRPbmx5TW9kZSgp\nOwogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZSk7CiAgICAg\nICAgfQogICAgfQogICAgCiAgICAvKiogCiAgICAgKiBBZGQgZW50cnkgdG8g\nYSBsZWRnZXIuCiAgICAgKiBAdGhyb3dzIEJvb2tpZUV4Y2VwdGlvbi5MZWRn\nZXJGZW5jZWRFeGNlcHRpb24gaWYgdGhlIGxlZGdlciBpcyBmZW5jZWQKICAg\nICAqLwogICAgcHVibGljIHZvaWQgYWRkRW50cnkoQnl0ZUJ1ZmZlciBlbnRy\neSwgV3JpdGVDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCwgYnl0ZVtdIG1hc3Rl\ncktleSkKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBCb29raWVF\neGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExlZGdlckRl\nc2NyaXB0b3IgaGFuZGxlID0gZ2V0TGVkZ2VyRm9yRW50cnkoZW50cnksIG1h\nc3RlcktleSk7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoaGFuZGxlKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlLmlzRmVuY2VkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBCb29raWVFeGNlcHRpb24KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC5jcmVhdGUoQm9va2llRXhjZXB0aW9u\nLkNvZGUuTGVkZ2VyRmVuY2VkRXhjZXB0aW9uKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGFkZEVudHJ5SW50ZXJuYWwoaGFuZGxlLCBl\nbnRyeSwgY2IsIGN0eCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNo\nIChOb1dyaXRhYmxlTGVkZ2VyRGlyRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgdHJhbnNpdGlvblRvUmVhZE9ubHlNb2RlKCk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBJT0V4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGZW5jZXMgYSBsZWRnZXIuIEZyb20gdGhpcyBwb2ludCBv\nbiwgY2xpZW50cyB3aWxsIGJlIHVuYWJsZSB0bwogICAgICogd3JpdGUgdG8g\ndGhpcyBsZWRnZXIuIE9ubHkgcmVjb3ZlcnlBZGRFbnRyeSB3aWxsIGJlCiAg\nICAgKiBhYmxlIHRvIGFkZCBlbnRyaWVzIHRvIHRoZSBsZWRnZXIuCiAgICAg\nKiBUaGlzIG1ldGhvZCBpcyBpZGVtcG90ZW50LiBPbmNlIGEgbGVkZ2VyIGlz\nIGZlbmNlZCwgaXQgY2FuCiAgICAgKiBuZXZlciBiZSB1bmZlbmNlZC4gRmVu\nY2luZyBhIGZlbmNlZCBsZWRnZXIgaGFzIG5vIGVmZmVjdC4KICAgICAqLwog\nICAgcHVibGljIEZ1dHVyZTxCb29sZWFuPiBmZW5jZUxlZGdlcihsb25nIGxl\nZGdlcklkLCBieXRlW10gbWFzdGVyS2V5KSB0aHJvd3MgSU9FeGNlcHRpb24s\nIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBo\nYW5kbGUgPSBoYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJZCwgbWFzdGVyS2V5\nKTsKICAgICAgICBib29sZWFuIHN1Y2Nlc3M7CiAgICAgICAgc3luY2hyb25p\nemVkIChoYW5kbGUpIHsKICAgICAgICAgICAgc3VjY2VzcyA9IGhhbmRsZS5z\nZXRGZW5jZWQoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHN1Y2Nlc3MpIHsK\nICAgICAgICAgICAgLy8gZmVuY2VkIGZpcnN0IHRpbWUsIHdlIHNob3VsZCBh\nZGQgdGhlIGtleSB0byBqb3VybmFsIGVuc3VyZSB3ZSBjYW4gcmVidWlsZAog\nICAgICAgICAgICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci5hbGxvY2F0\nZSg4ICsgOCk7CiAgICAgICAgICAgIGJiLnB1dExvbmcobGVkZ2VySWQpOwog\nICAgICAgICAgICBiYi5wdXRMb25nKE1FVEFFTlRSWV9JRF9GRU5DRV9LRVkp\nOwogICAgICAgICAgICBiYi5mbGlwKCk7CgogICAgICAgICAgICBGdXR1cmVX\ncml0ZUNhbGxiYWNrIGZ3YyA9IG5ldyBGdXR1cmVXcml0ZUNhbGxiYWNrKCk7\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygicmVjb3JkIGZlbmNlZCBzdGF0ZSBm\nb3IgbGVkZ2VyIHt9IGluIGpvdXJuYWwuIiwgbGVkZ2VySWQpOwogICAgICAg\nICAgICBqb3VybmFsLmxvZ0FkZEVudHJ5KGJiLCBmd2MsIG51bGwpOwogICAg\nICAgICAgICByZXR1cm4gZndjLmdldFJlc3VsdCgpOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIC8vIGFscmVhZHkgZmVuY2VkCiAgICAgICAgICAg\nIHJldHVybiBTVUNDRVNTX0ZVVFVSRTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIEJ5dGVCdWZmZXIgcmVhZEVudHJ5KGxvbmcgbGVkZ2VySWQsIGxv\nbmcgZW50cnlJZCkKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBO\nb0xlZGdlckV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBo\nYW5kbGUgPSBoYW5kbGVzLmdldFJlYWRPbmx5SGFuZGxlKGxlZGdlcklkKTsK\nICAgICAgICBMT0cudHJhY2UoIlJlYWRpbmcge31Ae30iLCBlbnRyeUlkLCBs\nZWRnZXJJZCk7CiAgICAgICAgcmV0dXJuIGhhbmRsZS5yZWFkRW50cnkoZW50\ncnlJZCk7CiAgICB9CgogICAgLy8gVGhlIHJlc3Qgb2YgdGhlIGNvZGUgaXMg\ndGVzdCBzdHVmZgogICAgc3RhdGljIGNsYXNzIENvdW50ZXJDYWxsYmFjayBp\nbXBsZW1lbnRzIFdyaXRlQ2FsbGJhY2sgewogICAgICAgIGludCBjb3VudDsK\nCiAgICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHdyaXRlQ29tcGxl\ndGUoaW50IHJjLCBsb25nIGwsIGxvbmcgZSwgSW5ldFNvY2tldEFkZHJlc3Mg\nYWRkciwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBjb3VudC0tOwogICAg\nICAgICAgICBpZiAoY291bnQgPT0gMCkgewogICAgICAgICAgICAgICAgbm90\naWZ5QWxsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN5\nbmNocm9uaXplZCBwdWJsaWMgdm9pZCBpbmNDb3VudCgpIHsKICAgICAgICAg\nICAgY291bnQrKzsKICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCBw\ndWJsaWMgdm9pZCB3YWl0WmVybygpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIHdoaWxlIChjb3VudCA+IDApIHsKICAgICAg\nICAgICAgICAgIHdhaXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEZvcm1hdCB0aGUgYm9va2llIHNlcnZlciBk\nYXRhCiAgICAgKiAKICAgICAqIEBwYXJhbSBjb25mCiAgICAgKiAgICAgICAg\nICAgIFNlcnZlckNvbmZpZ3VyYXRpb24KICAgICAqIEBwYXJhbSBpc0ludGVy\nYWN0aXZlCiAgICAgKiAgICAgICAgICAgIFdoZXRoZXIgZm9ybWF0IHNob3Vs\nZCBhc2sgcHJvbXB0IGZvciBjb25maXJtYXRpb24gaWYgb2xkIGRhdGEKICAg\nICAqICAgICAgICAgICAgZXhpc3RzIG9yIG5vdC4KICAgICAqIEBwYXJhbSBm\nb3JjZQogICAgICogICAgICAgICAgICBJZiBub24gaW50ZXJhY3RpdmUgYW5k\nIGZvcmNlIGlzIHRydWUsIHRoZW4gb2xkIGRhdGEgd2lsbCBiZQogICAgICog\nICAgICAgICAgICByZW1vdmVkIHdpdGhvdXQgY29uZmlybSBwcm9tcHQuCiAg\nICAgKiBAcmV0dXJuIFJldHVybnMgdHJ1ZSBpZiB0aGUgZm9ybWF0IGlzIHN1\nY2Nlc3MgZWxzZSByZXR1cm5zIGZhbHNlCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgYm9vbGVhbiBmb3JtYXQoU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nLAogICAgICAgICAgICBib29sZWFuIGlzSW50ZXJhY3RpdmUsIGJvb2xlYW4g\nZm9yY2UpIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBjb25mLmdldEpv\ndXJuYWxEaXIoKTsKICAgICAgICBpZiAoam91cm5hbERpci5leGlzdHMoKSAm\nJiBqb3VybmFsRGlyLmlzRGlyZWN0b3J5KCkKICAgICAgICAgICAgICAgICYm\nIGpvdXJuYWxEaXIubGlzdCgpLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBib29sZWFuIGNvbmZpcm0gPSBmYWxz\nZTsKICAgICAgICAgICAgICAgIGlmICghaXNJbnRlcmFjdGl2ZSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIElmIG5vbiBpbnRlcmFjdGl2ZSBhbmQgZm9y\nY2UgaXMgc2V0LCB0aGVuIGRlbGV0ZSBvbGQKICAgICAgICAgICAgICAgICAg\nICAvLyBkYXRhLgogICAgICAgICAgICAgICAgICAgIGlmIChmb3JjZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBjb25maXJtID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25m\naXJtID0gSU9VdGlscwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNv\nbmZpcm1Qcm9tcHQoIkFyZSB5b3Ugc3VyZSB0byBmb3JtYXQgQm9va2llIGRh\ndGEuLj8iKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBp\nZiAoIWNvbmZpcm0pIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkJvb2tpZSBmb3JtYXQgYWJvcnRlZCEhIik7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkVycm9yIGR1cmluZyBib29raWUgZm9ybWF0IiwgZSk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgaWYgKCFjbGVhbkRpcihqb3VybmFsRGlyKSkgewog\nICAgICAgICAgICBMT0cuZXJyb3IoIkZvcm1hdHRpbmcgam91cm5hbCBkaXJl\nY3RvcnkgZmFpbGVkIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICB9CgogICAgICAgIEZpbGVbXSBsZWRnZXJEaXJzID0gY29uZi5nZXRM\nZWRnZXJEaXJzKCk7CiAgICAgICAgZm9yIChGaWxlIGRpciA6IGxlZGdlckRp\ncnMpIHsKICAgICAgICAgICAgaWYgKCFjbGVhbkRpcihkaXIpKSB7CiAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIkZvcm1hdHRpbmcgbGVkZ2VyIGRpcmVj\ndG9yeSAiICsgZGlyICsgIiBmYWlsZWQiKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBM\nT0cuaW5mbygiQm9va2llIGZvcm1hdCBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5\nIik7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJpdmF0ZSBz\ndGF0aWMgYm9vbGVhbiBjbGVhbkRpcihGaWxlIGRpcikgewogICAgICAgIGlm\nIChkaXIuZXhpc3RzKCkpIHsKICAgICAgICAgICAgZm9yIChGaWxlIGNoaWxk\nIDogZGlyLmxpc3RGaWxlcygpKSB7CiAgICAgICAgICAgICAgICBib29sZWFu\nIGRlbGV0ZSA9IEZpbGVVdGlscy5kZWxldGVRdWlldGx5KGNoaWxkKTsKICAg\nICAgICAgICAgICAgIGlmICghZGVsZXRlKSB7CiAgICAgICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJOb3QgYWJsZSB0byBkZWxldGUgIiArIGNoaWxkKTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCFkaXIu\nbWtkaXJzKCkpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJOb3QgYWJsZSB0\nbyBjcmVhdGUgdGhlIGRpcmVjdG9yeSAiICsgZGlyKTsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KCiAgICBwcml2YXRlIGNsYXNzIEJvb2tpZVNhZmVFbnRyeUFkZGVy\nIGltcGxlbWVudHMgU2FmZUVudHJ5QWRkZXIgewogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHNhZmVBZGRFbnRyeShmaW5hbCBsb25n\nIGxlZGdlcklkLCBmaW5hbCBCeXRlQnVmZmVyIGJ1ZmZlciwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgR2VuZXJpY0NhbGxiYWNr\nPFZvaWQ+IGNiKSB7CiAgICAgICAgICAgIGpvdXJuYWwubG9nQWRkRW50cnko\nYnVmZmVyLCBuZXcgV3JpdGVDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCB3cml0ZUNvbXBsZXRlKGludCByYywgbG9uZyBsZWRnZXJJZDIsIGxvbmcg\nZW50cnlJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIE9iamVjdCBjdHgp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IEJvb2tpZUV4\nY2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBMT0cuZXJyb3IoIkVycm9yIHJld3JpdGluZyB0byBqb3VybmFsIChsZWRn\nZXIge30sIGVudHJ5IHt9KSIsIGxlZGdlcklkMiwgZW50cnlJZCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25Db21wbGV0ZShy\nYywgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEVu\ndHJ5QnlMZWRnZXJJZChsZWRnZXJJZCwgYnVmZmVyKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKHJjLCBudWxs\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRp\nb24gaW9lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkVycm9yIGFkZGluZyB0byBsZWRnZXIgc3RvcmFnZSAobGVkZ2VyICIg\nKyBsZWRnZXJJZDIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArICIsIGVudHJ5ICIgKyBlbnRyeUlkICsgIikiLCBpb2UpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gY291bGRuJ3QgYWRkIHRvIGxl\nZGdlciBzdG9yYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5v\ncGVyYXRpb25Db21wbGV0ZShCb29raWVFeGNlcHRpb24uQ29kZS5JbGxlZ2Fs\nT3BFeGNlcHRpb24sIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChCb29raWVFeGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIkJvb2tpZSBlcnJvciBhZGRpbmcg\ndG8gbGVkZ2VyIHN0b3JhZ2UgKGxlZGdlciAiICsgbGVkZ2VySWQyCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBlbnRyeSAi\nICsgZW50cnlJZCArICIpIiwgYmtlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIGNvdWxkbid0IGFkZCB0byBsZWRnZXIgc3RvcmFnZQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUo\nYmtlLmdldENvZGUoKSwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBu\ndWxsKTsKICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEBwYXJhbSBh\ncmdzCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dz\nIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIAogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29raWVF\neGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAgQm9va2llIGIg\nPSBuZXcgQm9va2llKG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkpOwogICAg\nICAgIGIuc3RhcnQoKTsKICAgICAgICBDb3VudGVyQ2FsbGJhY2sgY2IgPSBu\nZXcgQ291bnRlckNhbGxiYWNrKCk7CiAgICAgICAgbG9uZyBzdGFydCA9IE1h\ndGhVdGlscy5ub3coKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEw\nMDAwMDsgaSsrKSB7CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYnVmZiA9IEJ5\ndGVCdWZmZXIuYWxsb2NhdGUoMTAyNCk7CiAgICAgICAgICAgIGJ1ZmYucHV0\nTG9uZygxKTsKICAgICAgICAgICAgYnVmZi5wdXRMb25nKGkpOwogICAgICAg\nICAgICBidWZmLmxpbWl0KDEwMjQpOwogICAgICAgICAgICBidWZmLnBvc2l0\naW9uKDApOwogICAgICAgICAgICBjYi5pbmNDb3VudCgpOwogICAgICAgICAg\nICBiLmFkZEVudHJ5KGJ1ZmYsIGNiLCBudWxsLCBuZXcgYnl0ZVswXSk7CiAg\nICAgICAgfQogICAgICAgIGNiLndhaXRaZXJvKCk7CiAgICAgICAgbG9uZyBl\nbmQgPSBNYXRoVXRpbHMubm93KCk7CiAgICAgICAgU3lzdGVtLm91dC5wcmlu\ndGxuKCJUb29rICIgKyAoZW5kLXN0YXJ0KSArICJtcyIpOwogICAgfQp9Cg==\n","encoding":"base64"}

