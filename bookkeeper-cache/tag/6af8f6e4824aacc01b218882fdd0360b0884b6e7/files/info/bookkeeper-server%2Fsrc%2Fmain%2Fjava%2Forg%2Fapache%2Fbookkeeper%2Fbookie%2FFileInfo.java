{"sha":"7cdd59170e98cf0850767dbc4e75435b7608789d","node_id":"MDQ6QmxvYjE1NzU5NTY6N2NkZDU5MTcwZTk4Y2YwODUwNzY3ZGJjNGU3NTQzNWI3NjA4Nzg5ZA==","size":11748,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7cdd59170e98cf0850767dbc4e75435b7608789d","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5CdWZmZXJVbmRl\ncmZsb3dFeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxl\nQ2hhbm5lbDsKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLmFubm90YXRpb25z\nLlZpc2libGVGb3JUZXN0aW5nOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUaGlz\nIGlzIHRoZSBmaWxlIGhhbmRsZSBmb3IgYSBsZWRnZXIncyBpbmRleCBmaWxl\nIHRoYXQgbWFwcyBlbnRyeSBpZHMgdG8gbG9jYXRpb24uCiAqIEl0IGlzIHVz\nZWQgYnkgTGVkZ2VyQ2FjaGUuCiAqCiAqIDxwPgogKiBMZWRnZXIgaW5kZXgg\nZmlsZSBpcyBtYWRlIG9mIGEgaGVhZGVyIGFuZCBzZXZlcmFsIGZpeGVkLWxl\nbmd0aCBpbmRleCBwYWdlcywgd2hpY2ggcmVjb3JkcyB0aGUgb2Zmc2V0cyBv\nZiBkYXRhIHN0b3JlZCBpbiBlbnRyeSBsb2dnZXJzCiAqIDxwcmU+Jmx0O2hl\nYWRlciZndDsmbHQ7aW5kZXggcGFnZXMmZ3Q7PC9wcmU+CiAqIDxiPkhlYWRl\ncjwvYj4gaXMgZm9ybWF0ZWQgYXMgYmVsb3c6CiAqIDxwcmU+Jmx0O21hZ2lj\nIGJ5dGVzJmd0OyZsdDtsZW4gb2YgbWFzdGVyIGtleSZndDsmbHQ7bWFzdGVy\nIGtleSZndDs8L3ByZT4KICogPHVsPgogKiA8bGk+bWFnaWMgYnl0ZXM6IDQg\nYnl0ZXMsICdCS0xFJywgdmVyc2lvbjogNCBieXRlcwogKiA8bGk+bGVuIG9m\nIG1hc3RlciBrZXk6IGluZGljYXRlcyBsZW5ndGggb2YgbWFzdGVyIGtleS4g\nLTEgbWVhbnMgbm8gbWFzdGVyIGtleSBzdG9yZWQgaW4gaGVhZGVyLgogKiA8\nbGk+bWFzdGVyIGtleTogbWFzdGVyIGtleQogKiA8bGk+c3RhdGU6IGJpdCBt\nYXAgdG8gaW5kaWNhdGUgdGhlIHN0YXRlLCAzMiBiaXRzLgogKiA8L3VsPgog\nKiA8Yj5JbmRleCBwYWdlPC9iPiBpcyBhIGZpeGVkLWxlbmd0aCBwYWdlLCB3\naGljaCBjb250YWlucyBzZXJ2ZXJhbCBlbnRyaWVzIHdoaWNoIHBvaW50IHRv\nIHRoZSBvZmZzZXRzIG9mIGRhdGEgc3RvcmVkIGluIGVudHJ5IGxvZ2dlcnMu\nCiAqIDwvcD4KICovCmNsYXNzIEZpbGVJbmZvIHsKICAgIHN0YXRpYyBMb2dn\nZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoRmlsZUluZm8uY2xh\nc3MpOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQgTk9fTUFTVEVSX0tFWSA9IC0x\nOwogICAgc3RhdGljIGZpbmFsIGludCBTVEFURV9GRU5DRURfQklUID0gMHgx\nOwoKICAgIHByaXZhdGUgRmlsZUNoYW5uZWwgZmM7CiAgICBwcml2YXRlIEZp\nbGUgbGY7CiAgICBieXRlW10gbWFzdGVyS2V5OwoKICAgIC8qKgogICAgICog\nVGhlIGZpbmdlcnByaW50IG9mIGEgbGVkZ2VyIGluZGV4IGZpbGUKICAgICAq\nLwogICAgc3RhdGljIGZpbmFsIHB1YmxpYyBpbnQgc2lnbmF0dXJlID0gQnl0\nZUJ1ZmZlci53cmFwKCJCS0xFIi5nZXRCeXRlcygpKS5nZXRJbnQoKTsKICAg\nIHN0YXRpYyBmaW5hbCBwdWJsaWMgaW50IGhlYWRlclZlcnNpb24gPSAwOwoK\nICAgIHN0YXRpYyBmaW5hbCBsb25nIFNUQVJUX09GX0RBVEEgPSAxMDI0Owog\nICAgcHJpdmF0ZSBsb25nIHNpemU7CiAgICBwcml2YXRlIGludCB1c2VDb3Vu\ndDsKICAgIHByaXZhdGUgYm9vbGVhbiBpc0Nsb3NlZDsKICAgIHByaXZhdGUg\nbG9uZyBzaXplU2luY2VMYXN0d3JpdGU7CgogICAgLy8gYml0IG1hcCBmb3Ig\nc3RhdGVzIG9mIHRoZSBsZWRnZXIuCiAgICBwcml2YXRlIGludCBzdGF0ZUJp\ndHM7CiAgICBwcml2YXRlIGJvb2xlYW4gbmVlZEZsdXNoSGVhZGVyID0gZmFs\nc2U7CgogICAgLy8gZmlsZSBhY2Nlc3MgbW9kZQogICAgcHJvdGVjdGVkIFN0\ncmluZyBtb2RlOwoKICAgIHB1YmxpYyBGaWxlSW5mbyhGaWxlIGxmLCBieXRl\nW10gbWFzdGVyS2V5KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRo\naXMubGYgPSBsZjsKCiAgICAgICAgdGhpcy5tYXN0ZXJLZXkgPSBtYXN0ZXJL\nZXk7CiAgICAgICAgbW9kZSA9ICJydyI7CiAgICB9CgogICAgcHVibGljIEZp\nbGUgZ2V0TGYoKSB7CiAgICAgICAgcmV0dXJuIGxmOwogICAgfQoKICAgIHB1\nYmxpYyBsb25nIGdldFNpemVTaW5jZUxhc3R3cml0ZSgpIHsKICAgICAgICBy\nZXR1cm4gc2l6ZVNpbmNlTGFzdHdyaXRlOwogICAgfQoKICAgIHN5bmNocm9u\naXplZCBwdWJsaWMgdm9pZCByZWFkSGVhZGVyKCkgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICBpZiAobGYuZXhpc3RzKCkpIHsKICAgICAgICAgICAg\naWYgKGZjICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgZmMgPSBuZXcgUmFuZG9tQWNjZXNz\nRmlsZShsZiwgbW9kZSkuZ2V0Q2hhbm5lbCgpOwogICAgICAgICAgICBzaXpl\nID0gZmMuc2l6ZSgpOwogICAgICAgICAgICBzaXplU2luY2VMYXN0d3JpdGUg\nPSBzaXplOwoKICAgICAgICAgICAgLy8gYXZvaWQgaGFuZyBvbiByZWFkaW5n\nIHBhcnRpYWwgaW5kZXgKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5\ndGVCdWZmZXIuYWxsb2NhdGUoKGludCkoTWF0aC5taW4oc2l6ZSwgU1RBUlRf\nT0ZfREFUQSkpKTsKICAgICAgICAgICAgd2hpbGUoYmIuaGFzUmVtYWluaW5n\nKCkpIHsKICAgICAgICAgICAgICAgIGZjLnJlYWQoYmIpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGJiLmZsaXAoKTsKICAgICAgICAgICAgaWYgKGJi\nLmdldEludCgpICE9IHNpZ25hdHVyZSkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJNaXNzaW5nIGxlZGdlciBzaWduYXR1cmUi\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbnQgdmVyc2lvbiA9IGJi\nLmdldEludCgpOwogICAgICAgICAgICBpZiAodmVyc2lvbiAhPSBoZWFkZXJW\nZXJzaW9uKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRp\nb24oIkluY29tcGF0aWJsZSBsZWRnZXIgdmVyc2lvbiAiICsgdmVyc2lvbik7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW50IGxlbmd0aCA9IGJiLmdl\ndEludCgpOwogICAgICAgICAgICBpZiAobGVuZ3RoIDwgMCkgewogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJMZW5ndGggIiArIGxl\nbmd0aCArICIgaXMgaW52YWxpZCIpOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKGxlbmd0aCA+IGJiLnJlbWFpbmluZygpKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgQnVmZmVyVW5kZXJmbG93RXhjZXB0aW9uKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgbWFzdGVyS2V5ID0gbmV3IGJ5dGVbbGVuZ3Ro\nXTsKICAgICAgICAgICAgYmIuZ2V0KG1hc3RlcktleSk7CiAgICAgICAgICAg\nIHN0YXRlQml0cyA9IGJiLmdldEludCgpOwogICAgICAgICAgICBuZWVkRmx1\nc2hIZWFkZXIgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkxlZGdlciBpbmRleCBmaWxlIGRv\nZXMgbm90IGV4aXN0Iik7CiAgICAgICAgfQogICAgfQoKICAgIHN5bmNocm9u\naXplZCBwcml2YXRlIHZvaWQgY2hlY2tPcGVuKGJvb2xlYW4gY3JlYXRlKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChmYyAhPSBudWxsKSB7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYm9vbGVh\nbiBleGlzdHMgPSBsZi5leGlzdHMoKTsKICAgICAgICBpZiAobWFzdGVyS2V5\nID09IG51bGwgJiYgIWV4aXN0cykgewogICAgICAgICAgICB0aHJvdyBuZXcg\nSU9FeGNlcHRpb24obGYgKyAiIG5vdCBmb3VuZCIpOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKCFleGlzdHMpIHsgCiAgICAgICAgICAgIGlmIChjcmVhdGUp\nIHsKICAgICAgICAgICAgICAgIC8vIGRlbGF5ZWQgdGhlIGNyZWF0aW9uIG9m\nIHBhcmVudHMgZGlyZWN0b3JpZXMKICAgICAgICAgICAgICAgIGNoZWNrUGFy\nZW50cyhsZik7CiAgICAgICAgICAgICAgICBmYyA9IG5ldyBSYW5kb21BY2Nl\nc3NGaWxlKGxmLCBtb2RlKS5nZXRDaGFubmVsKCk7CiAgICAgICAgICAgICAg\nICBzaXplID0gZmMuc2l6ZSgpOwogICAgICAgICAgICAgICAgaWYgKHNpemUg\nPT0gMCkgewogICAgICAgICAgICAgICAgICAgIHdyaXRlSGVhZGVyKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmVhZEhlYWRl\ncigpOwogICAgICAgICAgICB9IGNhdGNoIChCdWZmZXJVbmRlcmZsb3dFeGNl\ncHRpb24gYnVmKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRXhjZXB0\naW9uIHdoZW4gcmVhZGluZyBoZWFkZXIgb2Yge30gOiB7fSIsIGxmLCBidWYp\nOwogICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gbWFzdGVyS2V5KSB7CiAg\nICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkF0dGVtcHRpbmcgdG8gd3Jp\ndGUgaGVhZGVyIG9mIHt9IGFnYWluLiIsIGxmKTsKICAgICAgICAgICAgICAg\nICAgICB3cml0ZUhlYWRlcigpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkVy\ncm9yIHJlYWRpbmcgaGVhZGVyICIgKyBsZik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIHdyaXRlSGVhZGVyKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgoaW50KVNU\nQVJUX09GX0RBVEEpOwogICAgICAgIGJiLnB1dEludChzaWduYXR1cmUpOwog\nICAgICAgIGJiLnB1dEludChoZWFkZXJWZXJzaW9uKTsKICAgICAgICBiYi5w\ndXRJbnQobWFzdGVyS2V5Lmxlbmd0aCk7CiAgICAgICAgYmIucHV0KG1hc3Rl\ncktleSk7CiAgICAgICAgYmIucHV0SW50KHN0YXRlQml0cyk7CiAgICAgICAg\nYmIucmV3aW5kKCk7CiAgICAgICAgZmMucG9zaXRpb24oMCk7CiAgICAgICAg\nZmMud3JpdGUoYmIpOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\nYm9vbGVhbiBpc0ZlbmNlZCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgY2hlY2tPcGVuKGZhbHNlKTsKICAgICAgICByZXR1cm4gKHN0YXRlQml0\ncyAmIFNUQVRFX0ZFTkNFRF9CSVQpID09IFNUQVRFX0ZFTkNFRF9CSVQ7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgc2V0IGZlbmNl\nIHN1Y2NlZWQsIG90aGVyd2lzZSBmYWxzZSB3aGVuCiAgICAgKiBpdCBhbHJl\nYWR5IGZlbmNlZCBvciBmYWlsZWQgdG8gc2V0IGZlbmNlZC4KICAgICAqLwog\nICAgc3luY2hyb25pemVkIHB1YmxpYyBib29sZWFuIHNldEZlbmNlZCgpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tPcGVuKGZhbHNlKTsK\nICAgICAgICBMT0cuZGVidWcoIlRyeSB0byBzZXQgZmVuY2VkIHN0YXRlIGlu\nIGZpbGUgaW5mbyB7fSA6IHN0YXRlIGJpdHMge30uIiwgbGYsIHN0YXRlQml0\ncyk7CiAgICAgICAgaWYgKChzdGF0ZUJpdHMgJiBTVEFURV9GRU5DRURfQklU\nKSAhPSBTVEFURV9GRU5DRURfQklUKSB7CiAgICAgICAgICAgIC8vIG5vdCBm\nZW5jZWQgeWV0CiAgICAgICAgICAgIHN0YXRlQml0cyB8PSBTVEFURV9GRU5D\nRURfQklUOwogICAgICAgICAgICBuZWVkRmx1c2hIZWFkZXIgPSB0cnVlOwog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8v\nIGZsdXNoIHRoZSBoZWFkZXIgd2hlbiBoZWFkZXIgaXMgY2hhbmdlZAogICAg\nc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIGZsdXNoSGVhZGVyKCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobmVlZEZsdXNoSGVhZGVyKSB7\nCiAgICAgICAgICAgIGNoZWNrT3Blbih0cnVlKTsKICAgICAgICAgICAgd3Jp\ndGVIZWFkZXIoKTsKICAgICAgICAgICAgbmVlZEZsdXNoSGVhZGVyID0gZmFs\nc2U7CiAgICAgICAgfQogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\nbG9uZyBzaXplKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBjaGVj\na09wZW4oZmFsc2UpOwogICAgICAgIGxvbmcgcmMgPSBzaXplLVNUQVJUX09G\nX0RBVEE7CiAgICAgICAgaWYgKHJjIDwgMCkgewogICAgICAgICAgICByYyA9\nIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiByYzsKICAgIH0KCiAgICBz\neW5jaHJvbml6ZWQgcHVibGljIGludCByZWFkKEJ5dGVCdWZmZXIgYmIsIGxv\nbmcgcG9zaXRpb24pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHJlYWRBYnNvbHV0ZShiYiwgcG9zaXRpb24gKyBTVEFSVF9PRl9EQVRB\nKTsKICAgIH0KCiAgICBwcml2YXRlIGludCByZWFkQWJzb2x1dGUoQnl0ZUJ1\nZmZlciBiYiwgbG9uZyBzdGFydCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBjaGVja09wZW4oZmFsc2UpOwogICAgICAgIGludCB0b3RhbCA9IDA7\nCiAgICAgICAgd2hpbGUoYmIucmVtYWluaW5nKCkgPiAwKSB7CiAgICAgICAg\nICAgIGludCByYyA9IGZjLnJlYWQoYmIsIHN0YXJ0KTsKICAgICAgICAgICAg\naWYgKHJjIDw9IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbigiU2hvcnQgcmVhZCIpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHRvdGFsICs9IHJjOwogICAgICAgICAgICAvLyBzaG91bGQgbW92ZSBy\nZWFkIHBvc2l0aW9uCiAgICAgICAgICAgIHN0YXJ0ICs9IHJjOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gdG90YWw7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDbG9zZSBhIGZpbGUgaW5mbwogICAgICoKICAgICAqIEBwYXJhbSBmb3Jj\nZQogICAgICogICAgICAgICAgaWYgc2V0IHRvIHRydWUsIHRoZSBpbmRleCBp\ncyBmb3JjZWQgdG8gY3JlYXRlIGJlZm9yZSBjbG9zZWQsCiAgICAgKiAgICAg\nICAgICBpZiBzZXQgdG8gZmFsc2UsIHRoZSBpbmRleCBpcyBub3QgZm9yY2Vk\nIHRvIGNyZWF0ZS4KICAgICAqLwogICAgc3luY2hyb25pemVkIHB1YmxpYyB2\nb2lkIGNsb3NlKGJvb2xlYW4gZm9yY2UpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIGNoZWNrT3Blbihm\nb3JjZSk7CiAgICAgICAgaWYgKHVzZUNvdW50ID09IDAgJiYgZmMgIT0gbnVs\nbCkgewogICAgICAgICAgICBmYy5jbG9zZSgpOwogICAgICAgIH0KICAgIH0K\nCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIGxvbmcgd3JpdGUoQnl0ZUJ1ZmZl\ncltdIGJ1ZmZzLCBsb25nIHBvc2l0aW9uKSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIGNoZWNrT3Blbih0cnVlKTsKICAgICAgICBsb25nIHRvdGFs\nID0gMDsKICAgICAgICB0cnkgewogICAgICAgICAgICBmYy5wb3NpdGlvbihw\nb3NpdGlvbitTVEFSVF9PRl9EQVRBKTsKICAgICAgICAgICAgd2hpbGUoYnVm\nZnNbYnVmZnMubGVuZ3RoLTFdLnJlbWFpbmluZygpID4gMCkgewogICAgICAg\nICAgICAgICAgbG9uZyByYyA9IGZjLndyaXRlKGJ1ZmZzKTsKICAgICAgICAg\nICAgICAgIGlmIChyYyA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJTaG9ydCB3cml0ZSIpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgdG90YWwgKz0gcmM7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBmYy5mb3Jj\nZSh0cnVlKTsKICAgICAgICAgICAgbG9uZyBuZXdzaXplID0gcG9zaXRpb24r\nU1RBUlRfT0ZfREFUQSt0b3RhbDsKICAgICAgICAgICAgaWYgKG5ld3NpemUg\nPiBzaXplKSB7CiAgICAgICAgICAgICAgICBzaXplID0gbmV3c2l6ZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzaXplU2luY2VMYXN0d3Jp\ndGUgPSBmYy5zaXplKCk7CiAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgfQoK\nICAgIC8qKgogICAgICogQ29waWVzIGN1cnJlbnQgZmlsZSBjb250ZW50cyB1\ncHRvIHNwZWNpZmllZCBzaXplIHRvIHRoZSB0YXJnZXQgZmlsZSBhbmQKICAg\nICAqIGRlbGV0ZXMgdGhlIGN1cnJlbnQgZmlsZS4gSWYgc2l6ZSBub3Qga25v\nd24gdGhlbiBwYXNzIHNpemUgYXMKICAgICAqIExvbmcuTUFYX1ZBTFVFIHRv\nIGNvcHkgY29tcGxldGUgZmlsZS4KICAgICAqLwogICAgcHVibGljIHN5bmNo\ncm9uaXplZCB2b2lkIG1vdmVUb05ld0xvY2F0aW9uKEZpbGUgbmV3RmlsZSwg\nbG9uZyBzaXplKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoZWNr\nT3BlbihmYWxzZSk7CiAgICAgICAgaWYgKHNpemUgPiBmYy5zaXplKCkpIHsK\nICAgICAgICAgICAgc2l6ZSA9IGZjLnNpemUoKTsKICAgICAgICB9CiAgICAg\nICAgRmlsZSBybG9jRmlsZSA9IG5ldyBGaWxlKG5ld0ZpbGUuZ2V0UGFyZW50\nRmlsZSgpLCBuZXdGaWxlLmdldE5hbWUoKSArIExlZGdlckNhY2hlSW1wbC5S\nTE9DKTsKICAgICAgICBpZiAoIXJsb2NGaWxlLmV4aXN0cygpKSB7CiAgICAg\nICAgICAgIGNoZWNrUGFyZW50cyhybG9jRmlsZSk7CiAgICAgICAgICAgIGlm\nICghcmxvY0ZpbGUuY3JlYXRlTmV3RmlsZSgpKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNyZWF0aW5nIG5ldyBjYWNoZSBp\nbmRleCBmaWxlICIgKyBybG9jRmlsZSArICIgZmFpbGVkICIpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIGNvcHkgY29udGVudHMgZnJv\nbSBvbGQuaWR4IHRvIG5ldy5pZHgucmxvYwogICAgICAgIEZpbGVDaGFubmVs\nIG5ld0ZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUocmxvY0ZpbGUsICJydyIp\nLmdldENoYW5uZWwoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBsb25n\nIHdyaXR0ZW4gPSAwOwogICAgICAgICAgICB3aGlsZSAod3JpdHRlbiA8IHNp\nemUpIHsKICAgICAgICAgICAgICAgIGxvbmcgY291bnQgPSBmYy50cmFuc2Zl\nclRvKHdyaXR0ZW4sIHNpemUsIG5ld0ZjKTsKICAgICAgICAgICAgICAgIGlm\nIChjb3VudCA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKCJDb3B5aW5nIHRvIG5ldyBsb2NhdGlvbiAiICsgcmxv\nY0ZpbGUgKyAiIGZhaWxlZCIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgd3JpdHRlbiArPSBjb3VudDsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAod3JpdHRlbiA8PSAwICYmIHNpemUgPiAwKSB7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNvcHlpbmcgdG8g\nbmV3IGxvY2F0aW9uICIgKyBybG9jRmlsZSArICIgZmFpbGVkIik7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBuZXdG\nYy5mb3JjZSh0cnVlKTsKICAgICAgICAgICAgbmV3RmMuY2xvc2UoKTsKICAg\nICAgICB9CiAgICAgICAgLy8gZGVsZXRlIG9sZC5pZHgKICAgICAgICBmYy5j\nbG9zZSgpOwogICAgICAgIGlmICghZGVsZXRlKCkpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJGYWlsZWQgdG8gZGVsZXRlIHRoZSBwcmV2aW91cyBpbmRl\neCBmaWxlICIgKyBsZik7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbigiRmFpbGVkIHRvIGRlbGV0ZSB0aGUgcHJldmlvdXMgaW5kZXggZmls\nZSAiICsgbGYpOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVuYW1lIG5ldy5p\nZHgucmxvYyB0byBuZXcuaWR4CiAgICAgICAgaWYgKCFybG9jRmlsZS5yZW5h\nbWVUbyhuZXdGaWxlKSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkZhaWxl\nZCB0byByZW5hbWUgIiArIHJsb2NGaWxlICsgIiB0byAiICsgbmV3RmlsZSk7\nCiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRmFpbGVkIHRv\nIHJlbmFtZSAiICsgcmxvY0ZpbGUgKyAiIHRvICIgKyBuZXdGaWxlKTsKICAg\nICAgICB9CiAgICAgICAgZmMgPSBuZXcgUmFuZG9tQWNjZXNzRmlsZShuZXdG\naWxlLCBtb2RlKS5nZXRDaGFubmVsKCk7CiAgICAgICAgbGYgPSBuZXdGaWxl\nOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMgYnl0ZVtdIGdldE1h\nc3RlcktleSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tP\ncGVuKGZhbHNlKTsKICAgICAgICByZXR1cm4gbWFzdGVyS2V5OwogICAgfQoK\nICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9pZCB1c2UoKSB7CiAgICAgICAg\ndXNlQ291bnQrKzsKICAgIH0KCiAgICBAVmlzaWJsZUZvclRlc3RpbmcKICAg\nIHN5bmNocm9uaXplZCBpbnQgZ2V0VXNlQ291bnQoKSB7CiAgICAgICAgcmV0\ndXJuIHVzZUNvdW50OwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\ndm9pZCByZWxlYXNlKCkgewogICAgICAgIHVzZUNvdW50LS07CiAgICAgICAg\naWYgKGlzQ2xvc2VkICYmIHVzZUNvdW50ID09IDAgJiYgZmMgIT0gbnVsbCkg\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmMuY2xvc2Uo\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBjbG9zaW5nIGZpbGUgY2hh\nbm5lbCIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBib29sZWFuIGRlbGV0ZSgpIHsKICAgICAgICByZXR1cm4gbGYu\nZGVsZXRlKCk7CiAgICB9CgogICAgc3RhdGljIGZpbmFsIHByaXZhdGUgdm9p\nZCBjaGVja1BhcmVudHMoRmlsZSBmKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIEZpbGUgcGFyZW50ID0gZi5nZXRQYXJlbnRGaWxlKCk7CiAgICAg\nICAgaWYgKHBhcmVudC5leGlzdHMoKSkgewogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQogICAgICAgIGlmIChwYXJlbnQubWtkaXJzKCkgPT0gZmFs\nc2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJDb3Vu\nbGRuJ3QgbWtkaXJzIGZvciAiICsgcGFyZW50KTsKICAgICAgICB9CiAgICB9\nCn0K\n","encoding":"base64"}

