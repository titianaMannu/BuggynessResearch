{"sha":"8606a66853d267361e9e423c79595189cb344e96","node_id":"MDQ6QmxvYjE1NzU5NTY6ODYwNmE2Njg1M2QyNjczNjFlOWU0MjNjNzk1OTUxODljYjM0NGU5Ng==","size":33690,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8606a66853d267361e9e423c79595189cb344e96","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwpp\nbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLk1hcC5FbnRy\neTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNC\nb29sZWFuOwoKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLmFubm90YXRpb25z\nLlZpc2libGVGb3JUZXN0aW5nOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLlNuYXBzaG90TWFwOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmJvb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5MZWRnZXJEaXJzTGlz\ndGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkxl\nZGdlckRpcnNNYW5hZ2VyLk5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25m\naWd1cmF0aW9uOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIEltcGxlbWVudGF0aW9u\nIG9mIExlZGdlckNhY2hlIGludGVyZmFjZS4KICogVGhpcyBjbGFzcyBzZXJ2\nZXMgdHdvIHB1cnBvc2VzLgogKi8KcHVibGljIGNsYXNzIExlZGdlckNhY2hl\nSW1wbCBpbXBsZW1lbnRzIExlZGdlckNhY2hlIHsKICAgIHByaXZhdGUgZmlu\nYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihMZWRnZXJEZXNjcmlwdG9yLmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBJRFggPSAiLmlkeCI7CiAgICBzdGF0aWMgZmluYWwg\nU3RyaW5nIFJMT0MgPSAiLnJsb2MiOwoKICAgIHByaXZhdGUgTGVkZ2VyRGly\nc01hbmFnZXIgbGVkZ2VyRGlyc01hbmFnZXI7CiAgICBmaW5hbCBwcml2YXRl\nIEF0b21pY0Jvb2xlYW4gc2hvdWxkUmVsb2NhdGVJbmRleEZpbGUgPSBuZXcg\nQXRvbWljQm9vbGVhbihmYWxzZSk7CgogICAgcHVibGljIExlZGdlckNhY2hl\nSW1wbChTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYsIFNuYXBzaG90TWFwPExv\nbmcsIEJvb2xlYW4+IGFjdGl2ZUxlZGdlcnMsCiAgICAgICAgICAgIExlZGdl\nckRpcnNNYW5hZ2VyIGxlZGdlckRpcnNNYW5hZ2VyKQogICAgICAgICAgICB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRoaXMubGVkZ2VyRGlyc01h\nbmFnZXIgPSBsZWRnZXJEaXJzTWFuYWdlcjsKICAgICAgICB0aGlzLm9wZW5G\naWxlTGltaXQgPSBjb25mLmdldE9wZW5GaWxlTGltaXQoKTsKICAgICAgICB0\naGlzLnBhZ2VTaXplID0gY29uZi5nZXRQYWdlU2l6ZSgpOwogICAgICAgIHRo\naXMuZW50cmllc1BlclBhZ2UgPSBwYWdlU2l6ZSAvIDg7CgogICAgICAgIGlm\nIChjb25mLmdldFBhZ2VMaW1pdCgpIDw9IDApIHsKICAgICAgICAgICAgLy8g\nYWxsb2NhdGUgaGFsZiBvZiB0aGUgbWVtb3J5IHRvIHRoZSBwYWdlIGNhY2hl\nCiAgICAgICAgICAgIHRoaXMucGFnZUxpbWl0ID0gKGludCkoKFJ1bnRpbWUu\nZ2V0UnVudGltZSgpLm1heE1lbW9yeSgpIC8gMykgLyB0aGlzLnBhZ2VTaXpl\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLnBhZ2VMaW1p\ndCA9IGNvbmYuZ2V0UGFnZUxpbWl0KCk7CiAgICAgICAgfQogICAgICAgIExP\nRy5pbmZvKCJtYXhNZW1vcnkgPSAiICsgUnVudGltZS5nZXRSdW50aW1lKCku\nbWF4TWVtb3J5KCkpOwogICAgICAgIExPRy5pbmZvKCJvcGVuRmlsZUxpbWl0\nIGlzICIgKyBvcGVuRmlsZUxpbWl0ICsgIiwgcGFnZVNpemUgaXMgIiArIHBh\nZ2VTaXplICsgIiwgcGFnZUxpbWl0IGlzICIgKyBwYWdlTGltaXQpOwogICAg\nICAgIHRoaXMuYWN0aXZlTGVkZ2VycyA9IGFjdGl2ZUxlZGdlcnM7CiAgICAg\nICAgLy8gUmV0cmlldmUgYWxsIG9mIHRoZSBhY3RpdmUgbGVkZ2Vycy4KICAg\nICAgICBnZXRBY3RpdmVMZWRnZXJzKCk7CiAgICAgICAgbGVkZ2VyRGlyc01h\nbmFnZXIuYWRkTGVkZ2VyRGlyc0xpc3RlbmVyKGdldExlZGdlckRpcnNMaXN0\nZW5lcigpKTsKICAgIH0KICAgIC8qKgogICAgICogdGhlIGxpc3Qgb2YgcG90\nZW50aWFsbHkgY2xlYW4gbGVkZ2VycwogICAgICovCiAgICBMaW5rZWRMaXN0\nPExvbmc+IGNsZWFuTGVkZ2VycyA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7\nCgogICAgLyoqCiAgICAgKiB0aGUgbGlzdCBvZiBwb3RlbnRpYWxseSBkaXJ0\neSBsZWRnZXJzCiAgICAgKi8KICAgIExpbmtlZExpc3Q8TG9uZz4gZGlydHlM\nZWRnZXJzID0gbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsKCiAgICBIYXNoTWFw\nPExvbmcsIEZpbGVJbmZvPiBmaWxlSW5mb0NhY2hlID0gbmV3IEhhc2hNYXA8\nTG9uZywgRmlsZUluZm8+KCk7CgogICAgTGlua2VkTGlzdDxMb25nPiBvcGVu\nTGVkZ2VycyA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7CgogICAgLy8gTWFu\nYWdlIGFsbCBhY3RpdmUgbGVkZ2VycyBpbiBMZWRnZXJNYW5hZ2VyCiAgICAv\nLyBzbyBMZWRnZXJNYW5hZ2VyIGhhcyBrbm93bGVkZ2UgdG8gZ2FyYmFnZSBj\nb2xsZWN0IGluYWN0aXZlL2RlbGV0ZWQgbGVkZ2VycwogICAgZmluYWwgU25h\ncHNob3RNYXA8TG9uZywgQm9vbGVhbj4gYWN0aXZlTGVkZ2VyczsKCiAgICBm\naW5hbCBpbnQgb3BlbkZpbGVMaW1pdDsKICAgIGZpbmFsIGludCBwYWdlU2l6\nZTsKICAgIGZpbmFsIGludCBwYWdlTGltaXQ7CiAgICBmaW5hbCBpbnQgZW50\ncmllc1BlclBhZ2U7CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHBhZ2Ugc2l6\nZSB1c2VkIGluIGxlZGdlciBjYWNoZQogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFBhZ2VTaXplKCkgewogICAgICAgIHJldHVybiBwYWdlU2l6ZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4gZW50cmllcyBwZXIgcGFnZSB1\nc2VkIGluIGxlZGdlciBjYWNoZQogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndEVudHJpZXNQZXJQYWdlKCkgewogICAgICAgIHJldHVybiBlbnRyaWVzUGVy\nUGFnZTsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4gcGFnZSBsaW1p\ndGF0aW9uIGluIGxlZGdlciBjYWNoZQogICAgICovCiAgICBwdWJsaWMgaW50\nIGdldFBhZ2VMaW1pdCgpIHsKICAgICAgICByZXR1cm4gcGFnZUxpbWl0Owog\nICAgfQoKICAgIC8vIFRoZSBudW1iZXIgb2YgcGFnZXMgdGhhdCBoYXZlIGFj\ndHVhbGx5IGJlZW4gdXNlZAogICAgcHJpdmF0ZSBpbnQgcGFnZUNvdW50ID0g\nMDsKICAgIEhhc2hNYXA8TG9uZywgSGFzaE1hcDxMb25nLExlZGdlckVudHJ5\nUGFnZT4+IHBhZ2VzID0gbmV3IEhhc2hNYXA8TG9uZywgSGFzaE1hcDxMb25n\nLExlZGdlckVudHJ5UGFnZT4+KCk7CgogICAgLyoqCiAgICAgKiBAcmV0dXJu\nIG51bWJlciBvZiBwYWdlIHVzZWQgaW4gbGVkZ2VyIGNhY2hlCiAgICAgKi8K\nICAgIHB1YmxpYyBpbnQgZ2V0TnVtVXNlZFBhZ2VzKCkgewogICAgICAgIHJl\ndHVybiBwYWdlQ291bnQ7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHB1dElu\ndG9UYWJsZShIYXNoTWFwPExvbmcsIEhhc2hNYXA8TG9uZyxMZWRnZXJFbnRy\neVBhZ2U+PiB0YWJsZSwgTGVkZ2VyRW50cnlQYWdlIGxlcCkgewogICAgICAg\nIEhhc2hNYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdlPiBtYXAgPSB0YWJsZS5n\nZXQobGVwLmdldExlZGdlcigpKTsKICAgICAgICBpZiAobWFwID09IG51bGwp\nIHsKICAgICAgICAgICAgbWFwID0gbmV3IEhhc2hNYXA8TG9uZywgTGVkZ2Vy\nRW50cnlQYWdlPigpOwogICAgICAgICAgICB0YWJsZS5wdXQobGVwLmdldExl\nZGdlcigpLCBtYXApOwogICAgICAgIH0KICAgICAgICBtYXAucHV0KGxlcC5n\nZXRGaXJzdEVudHJ5KCksIGxlcCk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgTGVkZ2VyRW50cnlQYWdlIGdldEZyb21UYWJsZShIYXNoTWFwPExvbmcs\nIEhhc2hNYXA8TG9uZyxMZWRnZXJFbnRyeVBhZ2U+PiB0YWJsZSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9u\nZyBsZWRnZXIsIExvbmcgZmlyc3RFbnRyeSkgewogICAgICAgIEhhc2hNYXA8\nTG9uZywgTGVkZ2VyRW50cnlQYWdlPiBtYXAgPSB0YWJsZS5nZXQobGVkZ2Vy\nKTsKICAgICAgICBpZiAobWFwICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0\ndXJuIG1hcC5nZXQoZmlyc3RFbnRyeSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBudWxsOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwcm90ZWN0ZWQg\nTGVkZ2VyRW50cnlQYWdlIGdldExlZGdlckVudHJ5UGFnZShMb25nIGxlZGdl\nciwgTG9uZyBmaXJzdEVudHJ5LCBib29sZWFuIG9ubHlEaXJ0eSkgewogICAg\nICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRGcm9tVGFibGUocGFnZXMs\nIGxlZGdlciwgZmlyc3RFbnRyeSk7CiAgICAgICAgaWYgKGxlcCA9PSBudWxs\nKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KCiAgICAg\nICAgbGVwLnVzZVBhZ2UoKTsKCiAgICAgICAgaWYgKG9ubHlEaXJ0eSAmJiBs\nZXAuaXNDbGVhbigpKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBsZXA7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKiAKICAgICAqIEdyYWIgbGVkZ2VyIGVudHJ5IHBh\nZ2Ugd2hvc2UgZmlyc3QgZW50cnkgaXMgPGNvZGU+cGFnZUVudHJ5PC9jb2Rl\nPi4KICAgICAqCiAgICAgKiBJZiB0aGUgcGFnZSBkb2Vzbid0IGV4aXN0ZWQg\nYmVmb3JlLCB3ZSBhbGxvY2F0ZSBhIG1lbW9yeSBwYWdlLgogICAgICogT3Ro\nZXJ3aXNlLCB3ZSBncmFiIGEgY2xlYW4gcGFnZSBhbmQgcmVhZCBpdCBmcm9t\nIGRpc2suCiAgICAgKgogICAgICogQHBhcmFtIGxlZGdlcgogICAgICogICAg\nICAgICAgTGVkZ2VyIElkCiAgICAgKiBAcGFyYW0gcGFnZUVudHJ5CiAgICAg\nKiAgICAgICAgICBTdGFydCBlbnRyeSBvZiB0aGlzIGVudHJ5IHBhZ2UuCiAg\nICAgKi8KICAgIHByaXZhdGUgTGVkZ2VyRW50cnlQYWdlIGdyYWJMZWRnZXJF\nbnRyeVBhZ2UobG9uZyBsZWRnZXIsIGxvbmcgcGFnZUVudHJ5KSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBn\ncmFiQ2xlYW5QYWdlKGxlZGdlciwgcGFnZUVudHJ5KTsKICAgICAgICB0cnkg\newogICAgICAgICAgICAvLyBzaG91bGQgdXBkYXRlIHBhZ2UgYmVmb3JlIHdl\nIHB1dCBpdCBpbnRvIHRhYmxlCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3\nZSB3b3VsZCBwdXQgYW4gZW1wdHkgcGFnZSBpbiBpdAogICAgICAgICAgICB1\ncGRhdGVQYWdlKGxlcCk7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCh0aGlz\nKSB7CiAgICAgICAgICAgICAgICBwdXRJbnRvVGFibGUocGFnZXMsIGxlcCk7\nCiAgICAgICAgICAgIH0gICAKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBpZSkgewogICAgICAgICAgICAvLyBpZiB3ZSBncmFiIGEgY2xlYW4gcGFn\nZSwgYnV0IGZhaWxlZCB0byB1cGRhdGUgdGhlIHBhZ2UKICAgICAgICAgICAg\nLy8gd2UgYXJlIGV4aGF1c3RpbmcgdGhlIGNvdW50IG9mIGxlZGdlciBlbnRy\neSBwYWdlcy4KICAgICAgICAgICAgLy8gc2luY2UgdGhpcyBwYWdlIHdpbGwg\nYmUgbmV2ZXIgdXNlZCwgc28gd2UgbmVlZCB0byBkZWNyZW1lbnQKICAgICAg\nICAgICAgLy8gcGFnZSBjb3VudCBvZiBsZWRnZXIgY2FjaGUuCiAgICAgICAg\nICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIC0tcGFnZUNvdW50OwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRocm93IGllOyAKICAgICAgICB9ICAg\nCiAgICAgICAgcmV0dXJuIGxlcDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIHB1dEVudHJ5T2Zmc2V0KGxvbmcgbGVkZ2VyLCBsb25n\nIGVudHJ5LCBsb25nIG9mZnNldCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBpbnQgb2Zmc2V0SW5QYWdlID0gKGludCkgKGVudHJ5ICUgZW50cmll\nc1BlclBhZ2UpOwogICAgICAgIC8vIGZpbmQgdGhlIGlkIG9mIHRoZSBmaXJz\ndCBlbnRyeSBvZiB0aGUgcGFnZSB0aGF0IGhhcyB0aGUgZW50cnkKICAgICAg\nICAvLyB3ZSBhcmUgbG9va2luZyBmb3IKICAgICAgICBsb25nIHBhZ2VFbnRy\neSA9IGVudHJ5LW9mZnNldEluUGFnZTsKICAgICAgICBMZWRnZXJFbnRyeVBh\nZ2UgbGVwID0gZ2V0TGVkZ2VyRW50cnlQYWdlKGxlZGdlciwgcGFnZUVudHJ5\nLCBmYWxzZSk7CiAgICAgICAgaWYgKGxlcCA9PSBudWxsKSB7CiAgICAgICAg\nICAgIGxlcCA9IGdyYWJMZWRnZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50\ncnkpOyAKICAgICAgICB9CiAgICAgICAgaWYgKGxlcCAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGxlcC5zZXRPZmZzZXQob2Zmc2V0LCBvZmZzZXRJblBhZ2Uq\nOCk7CiAgICAgICAgICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIGxvbmcgZ2V0RW50cnlPZmZzZXQobG9uZyBsZWRnZXIsIGxvbmcg\nZW50cnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaW50IG9mZnNl\ndEluUGFnZSA9IChpbnQpIChlbnRyeSVlbnRyaWVzUGVyUGFnZSk7CiAgICAg\nICAgLy8gZmluZCB0aGUgaWQgb2YgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBw\nYWdlIHRoYXQgaGFzIHRoZSBlbnRyeQogICAgICAgIC8vIHdlIGFyZSBsb29r\naW5nIGZvcgogICAgICAgIGxvbmcgcGFnZUVudHJ5ID0gZW50cnktb2Zmc2V0\nSW5QYWdlOwogICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRMZWRn\nZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50cnksIGZhbHNlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAobGVwID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGxlcCA9IGdyYWJMZWRnZXJFbnRyeVBhZ2UobGVkZ2VyLCBw\nYWdlRW50cnkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBs\nZXAuZ2V0T2Zmc2V0KG9mZnNldEluUGFnZSo4KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBpZiAobGVwICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBTdHJpbmcgZ2V0TGVkZ2VyTmFtZShsb25nIGxlZGdl\ncklkKSB7CiAgICAgICAgaW50IHBhcmVudCA9IChpbnQpIChsZWRnZXJJZCAm\nIDB4ZmYpOwogICAgICAgIGludCBncmFuZFBhcmVudCA9IChpbnQpICgobGVk\nZ2VySWQgJiAweGZmMDApID4+IDgpOwogICAgICAgIFN0cmluZ0J1aWxkZXIg\nc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLmFwcGVuZChJ\nbnRlZ2VyLnRvSGV4U3RyaW5nKGdyYW5kUGFyZW50KSk7CiAgICAgICAgc2Iu\nYXBwZW5kKCcvJyk7CiAgICAgICAgc2IuYXBwZW5kKEludGVnZXIudG9IZXhT\ndHJpbmcocGFyZW50KSk7CiAgICAgICAgc2IuYXBwZW5kKCcvJyk7CiAgICAg\nICAgc2IuYXBwZW5kKExvbmcudG9IZXhTdHJpbmcobGVkZ2VySWQpKTsKICAg\nICAgICBzYi5hcHBlbmQoSURYKTsKICAgICAgICByZXR1cm4gc2IudG9TdHJp\nbmcoKTsKICAgIH0KCiAgICBGaWxlSW5mbyBnZXRGaWxlSW5mbyhMb25nIGxl\nZGdlciwgYnl0ZSBtYXN0ZXJLZXlbXSkgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBzeW5jaHJvbml6ZWQoZmlsZUluZm9DYWNoZSkgewogICAgICAg\nICAgICBGaWxlSW5mbyBmaSA9IGZpbGVJbmZvQ2FjaGUuZ2V0KGxlZGdlcik7\nCiAgICAgICAgICAgIGlmIChmaSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBGaWxlIGxmID0gZmluZEluZGV4RmlsZShsZWRnZXIpOwogICAgICAgICAg\nICAgICAgaWYgKGxmID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAobWFzdGVyS2V5ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEJvb2tpZS5Ob0xlZGdlckV4Y2VwdGlvbihsZWRnZXIp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBs\nZiA9IGdldE5ld0xlZGdlckluZGV4RmlsZShsZWRnZXIsIG51bGwpOwogICAg\nICAgICAgICAgICAgICAgIC8vIEEgbmV3IGxlZGdlciBpbmRleCBmaWxlIGhh\ncyBiZWVuIGNyZWF0ZWQgZm9yIHRoaXMgQm9va2llLgogICAgICAgICAgICAg\nICAgICAgIC8vIEFkZCB0aGlzIG5ldyBsZWRnZXIgdG8gdGhlIHNldCBvZiBh\nY3RpdmUgbGVkZ2Vycy4KICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIk5ldyBsZWRnZXIgaW5kZXggZmlsZSBjcmVhdGVkIGZvciBsZWRnZXJJZDog\ne30iLCBsZWRnZXIpOwogICAgICAgICAgICAgICAgICAgIGFjdGl2ZUxlZGdl\ncnMucHV0KGxlZGdlciwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBldmljdEZpbGVJbmZvSWZOZWNlc3NhcnkoKTsKICAgICAg\nICAgICAgICAgIGZpID0gbmV3IEZpbGVJbmZvKGxmLCBtYXN0ZXJLZXkpOwog\nICAgICAgICAgICAgICAgaWYgKGxlZGdlckRpcnNNYW5hZ2VyLmlzRGlyRnVs\nbChnZXRMZWRnZXJEaXJGb3JMZWRnZXIoZmkpKSkgewogICAgICAgICAgICAg\nICAgICAgIG1vdmVMZWRnZXJJbmRleEZpbGUobGVkZ2VyLCBmaSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmaWxlSW5mb0NhY2hlLnB1\ndChsZWRnZXIsIGZpKTsKICAgICAgICAgICAgICAgIG9wZW5MZWRnZXJzLmFk\nZChsZWRnZXIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaS51c2UoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gZmk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogR2V0IGEgbmV3IGluZGV4IGZpbGUgZm9yIGxlZGdl\nciBleGNsdWRpbmcgZGlyZWN0b3J5IDxjb2RlPmV4Y2x1ZGVkRGlyPC9jb2Rl\nPi4KICAgICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VyCiAgICAgKiAgICAgICAg\nICBMZWRnZXIgaWQuCiAgICAgKiBAcGFyYW0gZXhjbHVkZWREaXIKICAgICAq\nICAgICAgICAgIFRoZSBsZWRnZXIgZGlyZWN0b3J5IHRvIGV4Y2x1ZGUuCiAg\nICAgKiBAcmV0dXJuIG5ldyBpbmRleCBmaWxlIG9iamVjdC4KICAgICAqIEB0\naHJvd3MgTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlvbiBpZiB0aGVyZSBp\ncyBubyB3cml0YWJsZSBkaXIgYXZhaWxhYmxlLgogICAgICovCiAgICBwcml2\nYXRlIEZpbGUgZ2V0TmV3TGVkZ2VySW5kZXhGaWxlKExvbmcgbGVkZ2VyLCBG\naWxlIGV4Y2x1ZGVkRGlyKQogICAgdGhyb3dzIE5vV3JpdGFibGVMZWRnZXJE\naXJFeGNlcHRpb24gewogICAgICAgIEZpbGUgZGlyID0gbGVkZ2VyRGlyc01h\nbmFnZXIucGlja1JhbmRvbVdyaXRhYmxlRGlyKGV4Y2x1ZGVkRGlyKTsKICAg\nICAgICBTdHJpbmcgbGVkZ2VyTmFtZSA9IGdldExlZGdlck5hbWUobGVkZ2Vy\nKTsKICAgICAgICByZXR1cm4gbmV3IEZpbGUoZGlyLCBsZWRnZXJOYW1lKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgdXBkYXRlUGFnZShMZWRnZXJFbnRy\neVBhZ2UgbGVwKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICgh\nbGVwLmlzQ2xlYW4oKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oIlRyeWluZyB0byB1cGRhdGUgYSBkaXJ0eSBwYWdlIik7CiAgICAg\nICAgfQogICAgICAgIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBmaSA9IGdldEZpbGVJbmZvKGxlcC5nZXRMZWRnZXIo\nKSwgbnVsbCk7CiAgICAgICAgICAgIGxvbmcgcG9zID0gbGVwLmdldEZpcnN0\nRW50cnkoKSo4OwogICAgICAgICAgICBpZiAocG9zID49IGZpLnNpemUoKSkg\newogICAgICAgICAgICAgICAgbGVwLnplcm9QYWdlKCk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsZXAucmVhZFBhZ2UoZmkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\naWYgKGZpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2Uo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIExlZGdlckRpcnNMaXN0ZW5lciBnZXRMZWRnZXJEaXJzTGlzdGVuZXIoKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJEaXJzTGlzdGVuZXIoKSB7CiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBk\naXNrRnVsbChGaWxlIGRpc2spIHsKICAgICAgICAgICAgICAgIC8vIElmIHRo\nZSBjdXJyZW50IGVudHJ5IGxvZyBkaXNrIGlzIGZ1bGwsIHRoZW4gY3JlYXRl\nIG5ldyBlbnRyeQogICAgICAgICAgICAgICAgLy8gbG9nLgogICAgICAgICAg\nICAgICAgc2hvdWxkUmVsb2NhdGVJbmRleEZpbGUuc2V0KHRydWUpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgZGlza0ZhaWxlZChGaWxlIGRpc2spIHsKICAgICAgICAg\nICAgICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxlIGhlcmUuIFdpbGwgYmUgaGFu\nZGxlZCBpbiBCb29raWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFsbERpc2tzRnVsbCgp\nIHsKICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxlIGhlcmUu\nIFdpbGwgYmUgaGFuZGxlZCBpbiBCb29raWUKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGZh\ndGFsRXJyb3IoKSB7CiAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIHRvIGhh\nbmRsZSBoZXJlLiBXaWxsIGJlIGhhbmRsZWQgaW4gQm9va2llCiAgICAgICAg\nICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgZmx1c2hMZWRnZXIoYm9vbGVhbiBkb0FsbCkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBzeW5jaHJvbml6ZWQoZGlydHlMZWRnZXJz\nKSB7CiAgICAgICAgICAgIGlmIChkaXJ0eUxlZGdlcnMuaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAg\nICAgICAgICAgICAgIGZvcihMb25nIGw6IHBhZ2VzLmtleVNldCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLnRyYWNlKCJB\nZGRpbmcge30gdG8gZGlydHkgcGFnZXMiLCBMb25nLnRvSGV4U3RyaW5nKGwp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICBkaXJ0eUxlZGdlcnMuYWRkKGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nICAgICBpZiAoZGlydHlMZWRnZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nc2hvdWxkUmVsb2NhdGVJbmRleEZpbGUuZ2V0KCkpIHsKICAgICAgICAgICAg\nICAgIC8vIGlmIHNvbWUgbmV3IGRpciBkZXRlY3RlZCBhcyBmdWxsLCB0aGVu\nIG1vdmUgYWxsIGNvcnJlc3BvbmRpbmcKICAgICAgICAgICAgICAgIC8vIG9w\nZW4gaW5kZXggZmlsZXMgdG8gbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAg\nICBmb3IgKExvbmcgbCA6IGRpcnR5TGVkZ2VycykgewogICAgICAgICAgICAg\nICAgICAgIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBmaSA9IGdldEZpbGVJ\nbmZvKGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBGaWxlIGN1\ncnJlbnREaXIgPSBnZXRMZWRnZXJEaXJGb3JMZWRnZXIoZmkpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAobGVkZ2VyRGlyc01hbmFnZXIuaXNEaXJG\ndWxsKGN1cnJlbnREaXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBtb3ZlTGVkZ2VySW5kZXhGaWxlKGwsIGZpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGZpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzaG91bGRSZWxvY2F0ZUlu\nZGV4RmlsZS5zZXQoZmFsc2UpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICB3aGlsZSghZGlydHlMZWRnZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAg\nICAgICAgTG9uZyBsID0gZGlydHlMZWRnZXJzLnJlbW92ZUZpcnN0KCk7Cgog\nICAgICAgICAgICAgICAgZmx1c2hMZWRnZXIobCk7CgogICAgICAgICAgICAg\nICAgaWYgKCFkb0FsbCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gWWllbGQuIGlm\nIHdlIGFyZSBkb2luZyBhbGwgdGhlIGxlZGdlcnMgd2UgZG9uJ3Qgd2FudCB0\nbyBibG9jayBvdGhlciBmbHVzaGVzIHRoYXQKICAgICAgICAgICAgICAgIC8v\nIG5lZWQgdG8gaGFwcGVuCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIGRpcnR5TGVkZ2Vycy53YWl0KDEpOwogICAgICAgICAg\nICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIGp1c3QgcGFzcyBpdCBvbgogICAgICAgICAg\nICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxlZGdlciBkaXJlY3Rvcnkg\ndGhhdCB0aGUgbGVkZ2VyIGluZGV4IGJlbG9uZ3MgdG8uCiAgICAgKgogICAg\nICogQHBhcmFtIGZpIEZpbGUgaW5mbyBvZiBhIGxlZGdlcgogICAgICogQHJl\ndHVybiBsZWRnZXIgZGlyZWN0b3J5IHRoYXQgdGhlIGxlZGdlciBiZWxvbmdz\nIHRvLgogICAgICovCiAgICBwcml2YXRlIEZpbGUgZ2V0TGVkZ2VyRGlyRm9y\nTGVkZ2VyKEZpbGVJbmZvIGZpKSB7CiAgICAgICAgcmV0dXJuIGZpLmdldExm\nKCkuZ2V0UGFyZW50RmlsZSgpLmdldFBhcmVudEZpbGUoKS5nZXRQYXJlbnRG\naWxlKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIG1vdmVMZWRnZXJJbmRl\neEZpbGUoTG9uZyBsLCBGaWxlSW5mbyBmaSkgdGhyb3dzIE5vV3JpdGFibGVM\nZWRnZXJEaXJFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxl\nIG5ld0xlZGdlckluZGV4RmlsZSA9IGdldE5ld0xlZGdlckluZGV4RmlsZShs\nLCBnZXRMZWRnZXJEaXJGb3JMZWRnZXIoZmkpKTsKICAgICAgICBmaS5tb3Zl\nVG9OZXdMb2NhdGlvbihuZXdMZWRnZXJJbmRleEZpbGUsIGZpLmdldFNpemVT\naW5jZUxhc3R3cml0ZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIEZsdXNo\nIGEgc3BlY2lmaWVkIGxlZGdlcgogICAgICoKICAgICAqIEBwYXJhbSBsCiAg\nICAgKiAgICAgICAgICBMZWRnZXIgSWQKICAgICAqIEB0aHJvd3MgSU9FeGNl\ncHRpb24KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGZsdXNoTGVkZ2VyKGxv\nbmcgbCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBMaW5rZWRMaXN0\nPExvbmc+IGZpcnN0RW50cnlMaXN0OwogICAgICAgIHN5bmNocm9uaXplZCh0\naGlzKSB7CiAgICAgICAgICAgIEhhc2hNYXA8TG9uZywgTGVkZ2VyRW50cnlQ\nYWdlPiBwYWdlTWFwID0gcGFnZXMuZ2V0KGwpOwogICAgICAgICAgICBpZiAo\ncGFnZU1hcCA9PSBudWxsIHx8IHBhZ2VNYXAuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIGZpID0gZ2V0RmlsZUluZm8o\nbCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgZmkuZmx1c2hIZWFkZXIo\nKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKG51bGwgIT0gZmkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgZmkucmVsZWFzZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBmaXJzdEVudHJ5TGlzdCA9IG5ldyBMaW5rZWRM\naXN0PExvbmc+KCk7CiAgICAgICAgICAgIGZvcihNYXAuRW50cnk8TG9uZywg\nTGVkZ2VyRW50cnlQYWdlPiBlbnRyeTogcGFnZU1hcC5lbnRyeVNldCgpKSB7\nCiAgICAgICAgICAgICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gZW50cnku\nZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChsZXAuaXNDbGVhbigp\nKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLnRyYWNlKCJQYWdlIGlzIGNs\nZWFuIHt9IiwgbGVwKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpcnN0RW50cnlM\naXN0LmFkZChsZXAuZ2V0Rmlyc3RFbnRyeSgpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgaWYgKGZpcnN0RW50cnlMaXN0LnNpemUoKSA9\nPSAwKSB7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiTm90aGluZyB0byBmbHVz\naCBmb3IgbGVkZ2VyIHt9LiIsIGwpOwogICAgICAgICAgICAvLyBub3RoaW5n\nIHRvIGRvCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIC8vIE5vdyBmbHVzaCBhbGwgdGhlIHBhZ2VzIG9mIGEgbGVkZ2VyCiAgICAg\nICAgTGlzdDxMZWRnZXJFbnRyeVBhZ2U+IGVudHJpZXMgPSBuZXcgQXJyYXlM\naXN0PExlZGdlckVudHJ5UGFnZT4oZmlyc3RFbnRyeUxpc3Quc2l6ZSgpKTsK\nICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgZm9yKExvbmcgZmlyc3RFbnRyeTogZmlyc3RFbnRyeUxpc3Qp\nIHsKICAgICAgICAgICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRM\nZWRnZXJFbnRyeVBhZ2UobCwgZmlyc3RFbnRyeSwgdHJ1ZSk7CiAgICAgICAg\nICAgICAgICBpZiAobGVwICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICBlbnRyaWVzLmFkZChsZXApOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIENvbGxlY3Rpb25zLnNvcnQoZW50cmllcywg\nbmV3IENvbXBhcmF0b3I8TGVkZ2VyRW50cnlQYWdlPigpIHsKICAgICAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJs\naWMgaW50IGNvbXBhcmUoTGVkZ2VyRW50cnlQYWdlIG8xLCBMZWRnZXJFbnRy\neVBhZ2UgbzIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKGludCko\nbzEuZ2V0Rmlyc3RFbnRyeSgpLW8yLmdldEZpcnN0RW50cnkoKSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAg\nICAgICAgICBBcnJheUxpc3Q8SW50ZWdlcj4gdmVyc2lvbnMgPSBuZXcgQXJy\nYXlMaXN0PEludGVnZXI+KGVudHJpZXMuc2l6ZSgpKTsKICAgICAgICAgICAg\nZmkgPSBnZXRGaWxlSW5mbyhsLCBudWxsKTsKICAgICAgICAgICAgLy8gZmx1\nc2ggdGhlIGhlYWRlciBpZiBuZWNlc3NhcnkKICAgICAgICAgICAgZmkuZmx1\nc2hIZWFkZXIoKTsKICAgICAgICAgICAgaW50IHN0YXJ0ID0gMDsKICAgICAg\nICAgICAgbG9uZyBsYXN0T2Zmc2V0ID0gLTE7CiAgICAgICAgICAgIGZvcihp\nbnQgaSA9IDA7IGkgPCBlbnRyaWVzLnNpemUoKTsgaSsrKSB7CiAgICAgICAg\nICAgICAgICB2ZXJzaW9ucy5hZGQoaSwgZW50cmllcy5nZXQoaSkuZ2V0VmVy\nc2lvbigpKTsKICAgICAgICAgICAgICAgIGlmIChsYXN0T2Zmc2V0ICE9IC0x\nICYmIChlbnRyaWVzLmdldChpKS5nZXRGaXJzdEVudHJ5KCkgLSBsYXN0T2Zm\nc2V0KSAhPSBlbnRyaWVzUGVyUGFnZSkgewogICAgICAgICAgICAgICAgICAg\nIC8vIHNlbmQgdXAgYSBzZXF1ZW50aWFsIGxpc3QKICAgICAgICAgICAgICAg\nICAgICBpbnQgY291bnQgPSBpIC0gc3RhcnQ7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLndhcm4oIkNvdW50IGNhbm5vdCBwb3NzaWJseSBiZSB6ZXJvISIpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB3cml0\nZUJ1ZmZlcnMobCwgZW50cmllcywgZmksIHN0YXJ0LCBjb3VudCk7CiAgICAg\nICAgICAgICAgICAgICAgc3RhcnQgPSBpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgbGFzdE9mZnNldCA9IGVudHJpZXMuZ2V0KGkpLmdl\ndEZpcnN0RW50cnkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAo\nZW50cmllcy5zaXplKCktc3RhcnQgPT0gMCAmJiBlbnRyaWVzLnNpemUoKSAh\nPSAwKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiTm90aGluZyB0byB3\ncml0ZSwgYnV0IHRoZXJlIHdlcmUgZW50cmllcyEiKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICB3cml0ZUJ1ZmZlcnMobCwgZW50cmllcywgZmksIHN0\nYXJ0LCBlbnRyaWVzLnNpemUoKS1zdGFydCk7CiAgICAgICAgICAgIHN5bmNo\ncm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAgICAgICBmb3IoaW50IGkgPSAw\nOyBpIDwgZW50cmllcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAg\nICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBlbnRyaWVzLmdldChpKTsKICAg\nICAgICAgICAgICAgICAgICBsZXAuc2V0Q2xlYW4odmVyc2lvbnMuZ2V0KGkp\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGZvcihMZWRnZXJFbnRyeVBhZ2UgbGVw\nOiBlbnRyaWVzKSB7CiAgICAgICAgICAgICAgICBsZXAucmVsZWFzZVBhZ2Uo\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmkgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgZmkucmVsZWFzZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCB3cml0ZUJ1ZmZl\ncnMoTG9uZyBsZWRnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExpc3Q8TGVkZ2VyRW50cnlQYWdlPiBlbnRyaWVzLCBGaWxlSW5mbyBmaSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IHN0YXJ0LCBpbnQg\nY291bnQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKExPRy5p\nc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIExPRy50cmFjZSgiV3Jp\ndGluZyB7fSBidWZmZXJzIG9mIHt9IiwgY291bnQsIExvbmcudG9IZXhTdHJp\nbmcobGVkZ2VyKSk7CiAgICAgICAgfQogICAgICAgIGlmIChjb3VudCA9PSAw\nKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgQnl0\nZUJ1ZmZlciBidWZmc1tdID0gbmV3IEJ5dGVCdWZmZXJbY291bnRdOwogICAg\nICAgIGZvcihpbnQgaiA9IDA7IGogPCBjb3VudDsgaisrKSB7CiAgICAgICAg\nICAgIGJ1ZmZzW2pdID0gZW50cmllcy5nZXQoc3RhcnQraikuZ2V0UGFnZVRv\nV3JpdGUoKTsKICAgICAgICAgICAgaWYgKGVudHJpZXMuZ2V0KHN0YXJ0K2op\nLmdldExlZGdlcigpICE9IGxlZGdlcikgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJXcml0aW5nIHRvICIgKyBsZWRnZXIgKyAi\nIGJ1dCBwYWdlIGJlbG9uZ3MgdG8gIgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgZW50cmllcy5nZXQoc3RhcnQraikuZ2V0TGVk\nZ2VyKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxvbmcg\ndG90YWxXcml0dGVuID0gMDsKICAgICAgICB3aGlsZShidWZmc1tidWZmcy5s\nZW5ndGgtMV0ucmVtYWluaW5nKCkgPiAwKSB7CiAgICAgICAgICAgIGxvbmcg\ncmMgPSBmaS53cml0ZShidWZmcywgZW50cmllcy5nZXQoc3RhcnQrMCkuZ2V0\nRmlyc3RFbnRyeSgpKjgpOwogICAgICAgICAgICBpZiAocmMgPD0gMCkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJTaG9ydCB3\ncml0ZSB0byBsZWRnZXIgIiArIGxlZGdlciArICIgcmMgPSAiICsgcmMpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHRvdGFsV3JpdHRlbiArPSByYzsK\nICAgICAgICB9CiAgICAgICAgaWYgKHRvdGFsV3JpdHRlbiAhPSAobG9uZylj\nb3VudCAqIChsb25nKXBhZ2VTaXplKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbigiU2hvcnQgd3JpdGUgdG8gbGVkZ2VyICIgKyBsZWRn\nZXIgKyAiIHdyb3RlICIgKyB0b3RhbFdyaXR0ZW4KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICsgIiBleHBlY3RlZCAiICsgY291bnQgKiBw\nYWdlU2l6ZSk7CiAgICAgICAgfQogICAgfQogICAgcHJpdmF0ZSBMZWRnZXJF\nbnRyeVBhZ2UgZ3JhYkNsZWFuUGFnZShsb25nIGxlZGdlciwgbG9uZyBlbnRy\neSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZW50cnkgJSBl\nbnRyaWVzUGVyUGFnZSAhPSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oZW50cnkgKyAiIGlzIG5vdCBhIG11\nbHRpcGxlIG9mICIgKyBlbnRyaWVzUGVyUGFnZSk7CiAgICAgICAgfQogICAg\nICAgIG91dGVyTG9vcDoKICAgICAgICB3aGlsZSh0cnVlKSB7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAgICAgICBpZiAo\ncGFnZUNvdW50ICA8IHBhZ2VMaW1pdCkgewogICAgICAgICAgICAgICAgICAg\nIC8vIGxldCdzIHNlZSBpZiB3ZSBjYW4gYWxsb2NhdGUgc29tZXRoaW5nCiAg\nICAgICAgICAgICAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IG5ldyBM\nZWRnZXJFbnRyeVBhZ2UocGFnZVNpemUsIGVudHJpZXNQZXJQYWdlKTsKICAg\nICAgICAgICAgICAgICAgICBsZXAuc2V0TGVkZ2VyKGxlZGdlcik7CiAgICAg\nICAgICAgICAgICAgICAgbGVwLnNldEZpcnN0RW50cnkoZW50cnkpOwoKICAg\nICAgICAgICAgICAgICAgICAvLyBub3RlLCB0aGlzIHdpbGwgbm90IGJsb2Nr\nIHNpbmNlIGl0IGlzIGEgbmV3IHBhZ2UKICAgICAgICAgICAgICAgICAgICBs\nZXAudXNlUGFnZSgpOwogICAgICAgICAgICAgICAgICAgIHBhZ2VDb3VudCsr\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBsZXA7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZChjbGVhbkxlZGdlcnMpIHsKICAgICAgICAgICAgICAgIGlmIChjbGVhbkxl\nZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgZmx1c2hM\nZWRnZXIoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCh0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihMb25nIGw6\nIHBhZ2VzLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjbGVhbkxlZGdlcnMuYWRkKGwpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBpZiBsZWRnZXJzIGRlbGV0ZWQgYmV0d2VlbiBjaGVj\na2luZyBwYWdlQ291bnQgYW5kIHB1dHRpbmcKICAgICAgICAgICAgICAgICAg\nICAvLyBsZWRnZXJzIGludG8gY2xlYW5MZWRnZXJzIGxpc3QsIHRoZSBjbGVh\nbkxlZGdlcnMgbGlzdCB3b3VsZCBiZSBlbXB0eS4KICAgICAgICAgICAgICAg\nICAgICAvLyBzbyBnaXZlIGl0IGEgY2hhbmNlIHRvIGdvIGJhY2sgdG8gY2hl\nY2sgcGFnZUNvdW50IGFnYWluIGJlY2F1c2UKICAgICAgICAgICAgICAgICAg\nICAvLyBkZWxldGVMZWRnZXIgd291bGQgZGVjcmVtZW50IHBhZ2VDb3VudCB0\nbyByZXR1cm4gdGhlIG51bWJlciBvZiBwYWdlcwogICAgICAgICAgICAgICAg\nICAgIC8vIG9jY3VwaWVkIGJ5IGRlbGV0ZWQgbGVkZ2Vycy4KICAgICAgICAg\nICAgICAgICAgICBpZiAoY2xlYW5MZWRnZXJzLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZSBvdXRlckxvb3A7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIExvbmcgY2xl\nYW5MZWRnZXIgPSBjbGVhbkxlZGdlcnMuZ2V0Rmlyc3QoKTsKICAgICAgICAg\nICAgICAgICAgICBNYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdlPiBtYXAgPSBw\nYWdlcy5nZXQoY2xlYW5MZWRnZXIpOwogICAgICAgICAgICAgICAgICAgIHdo\naWxlIChtYXAgPT0gbnVsbCB8fCBtYXAuaXNFbXB0eSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNsZWFuTGVkZ2Vycy5yZW1vdmVGaXJzdCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xlYW5MZWRnZXJzLmlzRW1w\ndHkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUg\nb3V0ZXJMb29wOyAKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICBjbGVhbkxlZGdlciA9IGNsZWFuTGVkZ2Vycy5n\nZXRGaXJzdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBtYXAgPSBwYWdl\ncy5nZXQoY2xlYW5MZWRnZXIpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBJdGVyYXRvcjxNYXAuRW50cnk8TG9uZywgTGVk\nZ2VyRW50cnlQYWdlPj4gaXQgPSBtYXAuZW50cnlTZXQoKS5pdGVyYXRvcigp\nOwogICAgICAgICAgICAgICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBp\ndC5uZXh0KCkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICB3aGls\nZSgobGVwLmluVXNlKCkgfHwgIWxlcC5pc0NsZWFuKCkpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmICghaXQuaGFzTmV4dCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvLyBubyBjbGVhbiBwYWdlIGZvdW5kIGlu\nIHRoaXMgbGVkZ2VyCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVh\nbkxlZGdlcnMucmVtb3ZlRmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlIG91dGVyTG9vcDsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsZXAgPSBpdC5uZXh0\nKCkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgaXQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKG1hcC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFnZXMucmVtb3ZlKGxlcC5nZXRMZWRnZXIoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxlcC51c2VQYWdlKCk7CiAg\nICAgICAgICAgICAgICAgICAgbGVwLnplcm9QYWdlKCk7CiAgICAgICAgICAg\nICAgICAgICAgbGVwLnNldExlZGdlcihsZWRnZXIpOwogICAgICAgICAgICAg\nICAgICAgIGxlcC5zZXRGaXJzdEVudHJ5KGVudHJ5KTsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbGVwOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIGxvbmcgZ2V0TGFzdEVudHJ5KGxvbmcgbGVkZ2VySWQpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBsYXN0RW50cnkgPSAwOwogICAg\nICAgIC8vIEZpbmQgdGhlIGxhc3QgZW50cnkgaW4gdGhlIGNhY2hlCiAgICAg\nICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAgICAgTWFwPExvbmcs\nIExlZGdlckVudHJ5UGFnZT4gbWFwID0gcGFnZXMuZ2V0KGxlZGdlcklkKTsK\nICAgICAgICAgICAgaWYgKG1hcCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBmb3IoTGVkZ2VyRW50cnlQYWdlIGxlcDogbWFwLnZhbHVlcygpKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGxlcC5nZXRGaXJzdEVudHJ5KCkgKyBl\nbnRyaWVzUGVyUGFnZSA8IGxhc3RFbnRyeSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgbGVwLnVzZVBhZ2UoKTsKICAgICAgICAgICAgICAg\nICAgICBsb25nIGhpZ2hlc3QgPSBsZXAuZ2V0TGFzdEVudHJ5KCk7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGhpZ2hlc3QgPiBsYXN0RW50cnkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgbGFzdEVudHJ5ID0gaGlnaGVzdDsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGVwLnJl\nbGVhc2VQYWdlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBmaSA9IGdldEZpbGVJbmZvKGxlZGdlcklk\nLCBudWxsKTsKICAgICAgICAgICAgbG9uZyBzaXplID0gZmkuc2l6ZSgpOwog\nICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGZpbGUgc2l6ZSBpcyBhbGln\nbmVkIHdpdGggaW5kZXggZW50cnkgc2l6ZQogICAgICAgICAgICAvLyBvdGhl\ncndpc2Ugd2UgbWF5IHJlYWQgaW5jb3JyZXQgZGF0YQogICAgICAgICAgICBp\nZiAoMCAhPSBzaXplICUgOCkgewogICAgICAgICAgICAgICAgTE9HLndhcm4o\nIkluZGV4IGZpbGUgb2YgbGVkZ2VyIHt9IGlzIG5vdCBhbGlnbmVkIHdpdGgg\naW5kZXggZW50cnkgc2l6ZS4iLCBsZWRnZXJJZCk7CiAgICAgICAgICAgICAg\nICBzaXplID0gc2l6ZSAtIHNpemUgJSA4OwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIC8vIHdlIG1heSBub3QgaGF2ZSB0aGUgbGFzdCBlbnRyeSBpbiB0\naGUgY2FjaGUKICAgICAgICAgICAgaWYgKHNpemUgPiBsYXN0RW50cnkqOCkg\newogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVCdWZmZXIu\nYWxsb2NhdGUoZ2V0UGFnZVNpemUoKSk7CiAgICAgICAgICAgICAgICBsb25n\nIHBvc2l0aW9uID0gc2l6ZSAtIGdldFBhZ2VTaXplKCk7CiAgICAgICAgICAg\nICAgICBpZiAocG9zaXRpb24gPCAwKSB7CiAgICAgICAgICAgICAgICAgICAg\ncG9zaXRpb24gPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgZmkucmVhZChiYiwgcG9zaXRpb24pOwogICAgICAgICAgICAgICAgYmIu\nZmxpcCgpOwogICAgICAgICAgICAgICAgbG9uZyBzdGFydGluZ0VudHJ5SWQg\nPSBwb3NpdGlvbi84OwogICAgICAgICAgICAgICAgZm9yKGludCBpID0gZ2V0\nRW50cmllc1BlclBhZ2UoKS0xOyBpID49IDA7IGktLSkgewogICAgICAgICAg\nICAgICAgICAgIGlmIChiYi5nZXRMb25nKGkqOCkgIT0gMCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAobGFzdEVudHJ5IDwgc3RhcnRpbmdFbnRy\neUlkK2kpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RFbnRy\neSA9IHN0YXJ0aW5nRW50cnlJZCtpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChmaSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBsYXN0RW50cnk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGxvb2sgd2l0aGlu\nIHRoZSBsZWRnZXIgZGlyZWN0b3JpZXMgZm9yIHRoZSBsZWRnZXIgaW5kZXgK\nICAgICAqIGZpbGVzLiBUaGF0IHdpbGwgY29tcHJpc2UgdGhlIHNldCBvZiBh\nY3RpdmUgbGVkZ2VycyB0aGlzIHBhcnRpY3VsYXIKICAgICAqIEJvb2tpZVNl\ncnZlciBrbm93cyBhYm91dCB0aGF0IGhhdmUgbm90IHlldCBiZWVuIGRlbGV0\nZWQgYnkgdGhlIEJvb2tLZWVwZXIKICAgICAqIENsaWVudC4gVGhpcyBpcyBj\nYWxsZWQgb25seSBvbmNlIGR1cmluZyBpbml0aWFsaXphdGlvbi4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIGdldEFjdGl2ZUxlZGdlcnMoKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIC8vIExlZGdlciBpbmRleCBmaWxlcyBh\ncmUgc3RvcmVkIGluIGEgZmlsZSBoaWVyYXJjaHkgd2l0aCBhIHBhcmVudCBh\nbmQKICAgICAgICAvLyBncmFuZFBhcmVudCBkaXJlY3RvcnkuIFdlJ2xsIGhh\ndmUgdG8gZ28gdHdvIGxldmVscyBkZWVwIGludG8gdGhlc2UKICAgICAgICAv\nLyBkaXJlY3RvcmllcyB0byBmaW5kIHRoZSBpbmRleCBmaWxlcy4KICAgICAg\nICBmb3IgKEZpbGUgbGVkZ2VyRGlyZWN0b3J5IDogbGVkZ2VyRGlyc01hbmFn\nZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAgICAgICAgIGZvciAoRmls\nZSBncmFuZFBhcmVudCA6IGxlZGdlckRpcmVjdG9yeS5saXN0RmlsZXMoKSkg\newogICAgICAgICAgICAgICAgaWYgKGdyYW5kUGFyZW50LmlzRGlyZWN0b3J5\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKEZpbGUgcGFyZW50IDog\nZ3JhbmRQYXJlbnQubGlzdEZpbGVzKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHBhcmVudC5pc0RpcmVjdG9yeSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmb3IgKEZpbGUgaW5kZXggOiBwYXJlbnQubGlz\ndEZpbGVzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoIWluZGV4LmlzRmlsZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB8fCAoIWluZGV4LmdldE5hbWUoKS5lbmRzV2l0aChJ\nRFgpICYmICFpbmRleC5nZXROYW1lKCkuZW5kc1dpdGgoUkxPQykpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gV2UndmUgZm91bmQgYSBsZWRnZXIg\naW5kZXggZmlsZS4gVGhlIGZpbGUKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAvLyBuYW1lIGlzIHRoZSBIZXhTdHJpbmcgcmVwcmVzZW50YXRp\nb24gb2YgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nbGVkZ2VySWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3Ry\naW5nIGxlZGdlcklkSW5IZXggPSBpbmRleC5nZXROYW1lKCkucmVwbGFjZShS\nTE9DLCAiIikucmVwbGFjZShJRFgsICIiKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoaW5kZXguZ2V0TmFtZSgpLmVuZHNXaXRoKFJM\nT0MpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChmaW5kSW5kZXhGaWxlKExvbmcucGFyc2VMb25nKGxlZGdlcklkSW5IZXgp\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoIWluZGV4LmRlbGV0ZSgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkRlbGV0\naW5nIHRoZSBybG9jIGZpbGUgIiArIGluZGV4ICsgIiBmYWlsZWQiKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmlsZSBk\nZXN0ID0gbmV3IEZpbGUoaW5kZXguZ2V0UGFyZW50RmlsZSgpLCBsZWRnZXJJ\nZEluSGV4ICsgSURYKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICghaW5kZXgucmVuYW1lVG8oZGVzdCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSU9FeGNlcHRpb24oIlJlbmFtaW5nIHJsb2MgZmlsZSAiICsgaW5kZXgK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIiB0byBpbmRleCBmaWxlIGhhcyBmYWlsZWQiKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBhY3RpdmVMZWRnZXJzLnB1dChMb25nLnBhcnNlTG9uZyhsZWRnZXJJ\nZEluSGV4LCAxNiksIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgaXMgY2Fs\nbGVkIHdoZW5ldmVyIGEgbGVkZ2VyIGlzIGRlbGV0ZWQgYnkgdGhlIEJvb2tL\nZWVwZXIgQ2xpZW50CiAgICAgKiBhbmQgd2Ugd2FudCB0byByZW1vdmUgYWxs\nIHJlbGV2YW50IGRhdGEgZm9yIGl0IHN0b3JlZCBpbiB0aGUgTGVkZ2VyQ2Fj\naGUuCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgZGVs\nZXRlTGVkZ2VyKGxvbmcgbGVkZ2VySWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgTE9HLmRlYnVnKCJEZWxldGluZyBsZWRnZXJJZDoge30iLCBs\nZWRnZXJJZCk7CgogICAgICAgIC8vIHJlbW92ZSBwYWdlcyBmaXJzdCB0byBh\ndm9pZCBwYWdlIGZsdXNoZWQgd2hlbiBkZWxldGluZyBmaWxlIGluZm8KICAg\nICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICBNYXA8TG9u\nZywgTGVkZ2VyRW50cnlQYWdlPiBscGFnZXMgPSBwYWdlcy5yZW1vdmUobGVk\nZ2VySWQpOwogICAgICAgICAgICBpZiAobnVsbCAhPSBscGFnZXMpIHsKICAg\nICAgICAgICAgICAgIHBhZ2VDb3VudCAtPSBscGFnZXMuc2l6ZSgpOwogICAg\nICAgICAgICAgICAgaWYgKHBhZ2VDb3VudCA8IDApIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIlBhZ2UgY291bnQgb2YgbGVkZ2VyIGNhY2hl\nIGhhcyBiZWVuIGRlY3JlbWVudGVkIHRvIGJlIGxlc3MgdGhhbiB6ZXJvLiIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIC8vIERlbGV0ZSB0aGUgbGVkZ2VyJ3MgaW5kZXggZmlsZSBhbmQg\nY2xvc2UgdGhlIEZpbGVJbmZvCiAgICAgICAgRmlsZUluZm8gZmkgPSBudWxs\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpID0gZ2V0RmlsZUluZm8o\nbGVkZ2VySWQsIG51bGwpOwogICAgICAgICAgICBmaS5jbG9zZShmYWxzZSk7\nCiAgICAgICAgICAgIGZpLmRlbGV0ZSgpOwogICAgICAgIH0gZmluYWxseSB7\nCiAgICAgICAgICAgIC8vIHNob3VsZCByZWxlYXNlIHVzZSBjb3VudAogICAg\nICAgICAgICAvLyBvdGhlcndpc2UgdGhlIGZpbGUgY2hhbm5lbCB3b3VsZCBu\nb3QgYmUgY2xvc2VkLgogICAgICAgICAgICBpZiAobnVsbCAhPSBmaSkgewog\nICAgICAgICAgICAgICAgZmkucmVsZWFzZSgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICAvLyBSZW1vdmUgaXQgZnJvbSB0aGUgYWN0aXZl\nIGxlZGdlciBtYW5hZ2VyCiAgICAgICAgYWN0aXZlTGVkZ2Vycy5yZW1vdmUo\nbGVkZ2VySWQpOwoKICAgICAgICAvLyBOb3cgcmVtb3ZlIGl0IGZyb20gYWxs\nIHRoZSBvdGhlciBsaXN0cyBhbmQgbWFwcy4KICAgICAgICAvLyBUaGVzZSBk\nYXRhIHN0cnVjdHVyZXMgbmVlZCB0byBiZSBzeW5jaHJvbml6ZWQgZmlyc3Qg\nYmVmb3JlIHJlbW92aW5nIGVudHJpZXMuCiAgICAgICAgc3luY2hyb25pemVk\nKGZpbGVJbmZvQ2FjaGUpIHsKICAgICAgICAgICAgZmlsZUluZm9DYWNoZS5y\nZW1vdmUobGVkZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6\nZWQoY2xlYW5MZWRnZXJzKSB7CiAgICAgICAgICAgIGNsZWFuTGVkZ2Vycy5y\nZW1vdmUobGVkZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6\nZWQoZGlydHlMZWRnZXJzKSB7CiAgICAgICAgICAgIGRpcnR5TGVkZ2Vycy5y\nZW1vdmUobGVkZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6\nZWQob3BlbkxlZGdlcnMpIHsKICAgICAgICAgICAgb3BlbkxlZGdlcnMucmVt\nb3ZlKGxlZGdlcklkKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBG\naWxlIGZpbmRJbmRleEZpbGUobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbGVkZ2VyTmFtZSA9IGdldExlZGdl\nck5hbWUobGVkZ2VySWQpOwogICAgICAgIGZvciAoRmlsZSBkIDogbGVkZ2Vy\nRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAgICAgICAg\nIEZpbGUgbGYgPSBuZXcgRmlsZShkLCBsZWRnZXJOYW1lKTsKICAgICAgICAg\nICAgaWYgKGxmLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nbGY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYnl0ZVtdIHJl\nYWRNYXN0ZXJLZXkobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9u\nLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHN5bmNocm9uaXplZChmaWxl\nSW5mb0NhY2hlKSB7CiAgICAgICAgICAgIEZpbGVJbmZvIGZpID0gZmlsZUlu\nZm9DYWNoZS5nZXQobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAoZmkgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgRmlsZSBsZiA9IGZpbmRJbmRleEZp\nbGUobGVkZ2VySWQpOwogICAgICAgICAgICAgICAgaWYgKGxmID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llLk5vTGVk\nZ2VyRXhjZXB0aW9uKGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGV2aWN0RmlsZUluZm9JZk5lY2Vzc2FyeSgpOyAgICAg\nICAgCiAgICAgICAgICAgICAgICBmaSA9IG5ldyBGaWxlSW5mbyhsZiwgbnVs\nbCk7CiAgICAgICAgICAgICAgICBieXRlW10ga2V5ID0gZmkuZ2V0TWFzdGVy\nS2V5KCk7CiAgICAgICAgICAgICAgICBmaWxlSW5mb0NhY2hlLnB1dChsZWRn\nZXJJZCwgZmkpOwogICAgICAgICAgICAgICAgb3BlbkxlZGdlcnMuYWRkKGxl\nZGdlcklkKTsKICAgICAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZpLmdldE1hc3RlcktleSgpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvLyBldmljdCBmaWxlIGluZm8gaWYgbmVj\nZXNzYXJ5CiAgICBwcml2YXRlIHZvaWQgZXZpY3RGaWxlSW5mb0lmTmVjZXNz\nYXJ5KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBzeW5jaHJvbml6\nZWQgKGZpbGVJbmZvQ2FjaGUpIHsKICAgICAgICAgICAgaWYgKG9wZW5MZWRn\nZXJzLnNpemUoKSA+IG9wZW5GaWxlTGltaXQpIHsKICAgICAgICAgICAgICAg\nIGxvbmcgbGVkZ2VyVG9SZW1vdmUgPSBvcGVuTGVkZ2Vycy5yZW1vdmVGaXJz\ndCgpOwogICAgICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciB7fSBpcyBl\ndmljdGVkIGZyb20gZmlsZSBpbmZvIGNhY2hlLiIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICBsZWRnZXJUb1JlbW92ZSk7CiAgICAgICAgICAgICAgICBm\naWxlSW5mb0NhY2hlLnJlbW92ZShsZWRnZXJUb1JlbW92ZSkuY2xvc2UodHJ1\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgYm9vbGVhbiBzZXRGZW5jZWQobG9uZyBsZWRnZXJJ\nZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlSW5mbyBmaSA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmkgPSBnZXRGaWxl\nSW5mbyhsZWRnZXJJZCwgbnVsbCk7CiAgICAgICAgICAgIGlmIChudWxsICE9\nIGZpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmkuc2V0RmVuY2VkKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChudWxsICE9IGZpKSB7\nCiAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0ZlbmNlZChsb25nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBmaSA9IGdldEZpbGVJbmZvKGxlZGdlcklkLCBudWxs\nKTsKICAgICAgICAgICAgaWYgKG51bGwgIT0gZmkpIHsKICAgICAgICAgICAg\nICAgIHJldHVybiBmaS5pc0ZlbmNlZCgpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICBpZiAobnVsbCAhPSBmaSkgewogICAgICAgICAgICAgICAgZmku\ncmVsZWFzZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0TWFzdGVyS2V5KGxvbmcg\nbGVkZ2VySWQsIGJ5dGVbXSBtYXN0ZXJLZXkpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgRmlsZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGZpID0gZ2V0RmlsZUluZm8obGVkZ2VySWQsIG1hc3Rl\ncktleSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKG51\nbGwgIT0gZmkpIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBib29sZWFuIGxlZGdlckV4aXN0cyhsb25nIGxlZGdlcklkKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHN5bmNocm9uaXplZChmaWxl\nSW5mb0NhY2hlKSB7CiAgICAgICAgICAgIEZpbGVJbmZvIGZpID0gZmlsZUlu\nZm9DYWNoZS5nZXQobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAoZmkgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgRmlsZSBsZiA9IGZpbmRJbmRleEZp\nbGUobGVkZ2VySWQpOwogICAgICAgICAgICAgICAgaWYgKGxmID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTGVk\nZ2VyQ2FjaGVCZWFuIGdldEpNWEJlYW4oKSB7CiAgICAgICAgcmV0dXJuIG5l\ndyBMZWRnZXJDYWNoZUJlYW4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgU3RyaW5nIGdldE5hbWUoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gIkxlZGdlckNhY2hlIjsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzSGlkZGVuKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIGludCBnZXRQYWdlQ291bnQoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gTGVkZ2VyQ2FjaGVJbXBsLnRoaXMuZ2V0TnVtVXNlZFBh\nZ2VzKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgaW50IGdldFBhZ2VTaXplKCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIExlZGdlckNhY2hlSW1wbC50aGlzLmdldFBhZ2VT\naXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgaW50IGdldE9wZW5GaWxlTGltaXQoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gb3BlbkZpbGVMaW1pdDsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyBpbnQgZ2V0UGFnZUxpbWl0KCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIExlZGdlckNhY2hlSW1wbC50aGlzLmdldFBhZ2VMaW1pdCgpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIGludCBnZXROdW1DbGVhbkxlZGdlcnMoKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gY2xlYW5MZWRnZXJzLnNpemUoKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBpbnQg\nZ2V0TnVtRGlydHlMZWRnZXJzKCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIGRpcnR5TGVkZ2Vycy5zaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgaW50IGdldE51bU9w\nZW5MZWRnZXJzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9wZW5MZWRn\nZXJzLnNpemUoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgc3luY2hyb25pemVkIChmaWxlSW5mb0Nh\nY2hlKSB7CiAgICAgICAgICAgIGZvciAoRW50cnk8TG9uZywgRmlsZUluZm8+\nIGZpbGVJbmZvIDogZmlsZUluZm9DYWNoZS5lbnRyeVNldCgpKSB7CiAgICAg\nICAgICAgICAgICBGaWxlSW5mbyB2YWx1ZSA9IGZpbGVJbmZvLmdldFZhbHVl\nKCk7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgICAgIHZhbHVlLmNsb3NlKHRydWUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpbGVJbmZvQ2Fj\naGUuY2xlYXIoKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

