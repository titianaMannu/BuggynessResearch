{"sha":"cb3bb26a2cfff6a681e3ce2784761422e5e16ed0","node_id":"MDQ6QmxvYjE1NzU5NTY6Y2IzYmIyNmEyY2ZmZjZhNjgxZTNjZTI3ODQ3NjE0MjJlNWUxNmVkMA==","size":38417,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/cb3bb26a2cfff6a681e3ce2784761422e5e16ed0","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5CdWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8u\nQnVmZmVyZWRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLklucHV0U3RyZWFtUmVh\nZGVyOwppbXBvcnQgamF2YS5pby5PdXRwdXRTdHJlYW1Xcml0ZXI7CmltcG9y\ndCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLkZpbGVJbnB1dFN0cmVh\nbTsKaW1wb3J0IGphdmEuaW8uRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5pby5GaWxlT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5J\nT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsK\naW1wb3J0IGphdmEubmV0LkluZXRBZGRyZXNzOwppbXBvcnQgamF2YS5uZXQu\nSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLm5pby5CeXRlQnVmZmVy\nOwppbXBvcnQgamF2YS5uaW8uY2hhbm5lbHMuRmlsZUNoYW5uZWw7CmltcG9y\ndCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxl\nY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZh\nLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuTGlua2VkQmxvY2tpbmdRdWV1ZTsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNCb29s\nZWFuOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdl\nck1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5M\nZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJu\nYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nWm9vRGVmcy5JZHM7CgovKioKICogSW1wbGVtZW50cyBhIGJvb2tpZS4KICoK\nICovCgpwdWJsaWMgY2xhc3MgQm9va2llIGV4dGVuZHMgVGhyZWFkIHsKICAg\nIEhhc2hNYXA8TG9uZywgTGVkZ2VyRGVzY3JpcHRvcj4gbGVkZ2VycyA9IG5l\ndyBIYXNoTWFwPExvbmcsIExlZGdlckRlc2NyaXB0b3I+KCk7CiAgICBzdGF0\naWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tp\nZS5jbGFzcyk7CiAgICBmaW5hbCBzdGF0aWMgbG9uZyBNQiA9IDEwMjQgKiAx\nMDI0TDsKICAgIC8vIG1heCBqb3VybmFsIGZpbGUgc2l6ZQogICAgZmluYWwg\nbG9uZyBtYXhKb3VybmFsU2l6ZTsKICAgIC8vIG51bWJlciBqb3VybmFsIGZp\nbGVzIGtlcHQgYmVmb3JlIG1hcmtlZCBqb3VybmFsCiAgICBmaW5hbCBpbnQg\nbWF4QmFja3VwSm91cm5hbHM7CgogICAgZmluYWwgRmlsZSBqb3VybmFsRGly\nZWN0b3J5OwoKICAgIGZpbmFsIEZpbGUgbGVkZ2VyRGlyZWN0b3JpZXNbXTsK\nCiAgICBmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CgogICAgZmlu\nYWwgU3luY1RocmVhZCBzeW5jVGhyZWFkOwogICAgZmluYWwgTGVkZ2VyTWFu\nYWdlciBsZWRnZXJNYW5hZ2VyOwoKICAgIC8qKgogICAgICogQ3VycmVudCBk\naXJlY3RvcnkgbGF5b3V0IHZlcnNpb24uIEluY3JlbWVudCB0aGlzIAogICAg\nICogd2hlbiB5b3UgbWFrZSBhIGNoYW5nZSB0byB0aGUgZm9ybWF0IG9mIGFu\neSBvZiB0aGUgZmlsZXMgaW4gCiAgICAgKiB0aGlzIGRpcmVjdG9yeSBvciB0\nbyB0aGUgZ2VuZXJhbCBsYXlvdXQgb2YgdGhlIGRpcmVjdG9yeS4KICAgICAq\nLwogICAgc3RhdGljIGZpbmFsIGludCBDVVJSRU5UX0RJUkVDVE9SWV9MQVlP\nVVRfVkVSU0lPTiA9IDE7CiAgICBzdGF0aWMgZmluYWwgU3RyaW5nIFZFUlNJ\nT05fRklMRU5BTUUgPSAiVkVSU0lPTiI7CiAgICAKICAgIC8vIFpLIHJlZ2lz\ndHJhdGlvbiBwYXRoIGZvciB0aGlzIGJvb2tpZQogICAgc3RhdGljIGZpbmFs\nIFN0cmluZyBCT09LSUVfUkVHSVNUUkFUSU9OX1BBVEggPSAiL2xlZGdlcnMv\nYXZhaWxhYmxlLyI7CgogICAgLy8gWm9vS2VlcGVyIGNsaWVudCBpbnN0YW5j\nZSBmb3IgdGhlIEJvb2tpZQogICAgWm9vS2VlcGVyIHprOwogICAgcHJpdmF0\nZSB2b2xhdGlsZSBib29sZWFuIGlzWmtFeHBpcmVkID0gdHJ1ZTsKCiAgICAv\nLyBSdW5uaW5nIGZsYWcKICAgIHByaXZhdGUgdm9sYXRpbGUgYm9vbGVhbiBy\ndW5uaW5nID0gZmFsc2U7CgogICAgcHVibGljIHN0YXRpYyBjbGFzcyBOb0xl\nZGdlckV4Y2VwdGlvbiBleHRlbmRzIElPRXhjZXB0aW9uIHsKICAgICAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAx\nTDsKICAgICAgICBwcml2YXRlIGxvbmcgbGVkZ2VySWQ7CiAgICAgICAgcHVi\nbGljIE5vTGVkZ2VyRXhjZXB0aW9uKGxvbmcgbGVkZ2VySWQpIHsKICAgICAg\nICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAgICAgIH0KICAg\nICAgICBwdWJsaWMgbG9uZyBnZXRMZWRnZXJJZCgpIHsKICAgICAgICAgICAg\ncmV0dXJuIGxlZGdlcklkOwogICAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgY2xhc3MgTm9FbnRyeUV4Y2VwdGlvbiBleHRlbmRzIElPRXhjZXB0\naW9uIHsKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIHNlcmlh\nbFZlcnNpb25VSUQgPSAxTDsKICAgICAgICBwcml2YXRlIGxvbmcgbGVkZ2Vy\nSWQ7CiAgICAgICAgcHJpdmF0ZSBsb25nIGVudHJ5SWQ7CiAgICAgICAgcHVi\nbGljIE5vRW50cnlFeGNlcHRpb24obG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRy\neUlkKSB7CiAgICAgICAgICAgIHN1cGVyKCJFbnRyeSAiICsgZW50cnlJZCAr\nICIgbm90IGZvdW5kIGluICIgKyBsZWRnZXJJZCk7CiAgICAgICAgICAgIHRo\naXMubGVkZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5lbnRy\neUlkID0gZW50cnlJZDsKICAgICAgICB9CiAgICAgICAgcHVibGljIGxvbmcg\nZ2V0TGVkZ2VyKCkgewogICAgICAgICAgICByZXR1cm4gbGVkZ2VySWQ7CiAg\nICAgICAgfQogICAgICAgIHB1YmxpYyBsb25nIGdldEVudHJ5KCkgewogICAg\nICAgICAgICByZXR1cm4gZW50cnlJZDsKICAgICAgICB9CiAgICB9CgogICAg\nRW50cnlMb2dnZXIgZW50cnlMb2dnZXI7CiAgICBMZWRnZXJDYWNoZSBsZWRn\nZXJDYWNoZTsKICAgIC8qKgogICAgICogU3luY1RocmVhZCBpcyBhIGJhY2tn\ncm91bmQgdGhyZWFkIHdoaWNoIGZsdXNoZXMgbGVkZ2VyIGluZGV4IHBhZ2Vz\nIHBlcmlvZGljYWxseS4KICAgICAqIEFsc28gaXQgdGFrZXMgcmVzcG9uc2li\naWxpdHkgb2YgZ2FyYmFnZSBjb2xsZWN0aW5nIGpvdXJuYWwgZmlsZXMuCiAg\nICAgKgogICAgICogPHA+CiAgICAgKiBCZWZvcmUgZmx1c2hpbmcsIFN5bmNU\naHJlYWQgZmlyc3QgcmVjb3JkcyBhIGxvZyBtYXJrZXIge2pvdXJuYWxJZCwg\nam91cm5hbFBvc30gaW4gbWVtb3J5LAogICAgICogd2hpY2ggaW5kaWNhdGVz\nIGVudHJpZXMgYmVmb3JlIHRoaXMgbG9nIG1hcmtlciB3b3VsZCBiZSBwZXJz\naXN0ZWQgdG8gbGVkZ2VyIGZpbGVzLgogICAgICogVGhlbiBzeW5jIHRocmVh\nZCBiZWdpbnMgZmx1c2hpbmcgbGVkZ2VyIGluZGV4IHBhZ2VzIHRvIGxlZGdl\nciBpbmRleCBmaWxlcywgZmx1c2ggZW50cnkKICAgICAqIGxvZ2dlciB0byBl\nbnN1cmUgYWxsIGVudHJpZXMgcGVyc2lzdGVkIHRvIGVudHJ5IGxvZ2dlcnMg\nZm9yIGZ1dHVyZSByZWFkcy4KICAgICAqIDwvcD4KICAgICAqIDxwPgogICAg\nICogQWZ0ZXIgYWxsIGRhdGEgaGFzIGJlZW4gcGVyc2lzdGVkIHRvIGxlZGdl\nciBpbmRleCBmaWxlcyBhbmQgZW50cnkgbG9nZ2VycywgaXQgaXMgc2FmZQog\nICAgICogdG8gcGVyc2lzdCB0aGUgbG9nIG1hcmtlciB0byBkaXNrLiBJZiBi\nb29raWUgZmFpbGVkIGFmdGVyIHBlcnNpc3QgbG9nIG1hcmssCiAgICAgKiBi\nb29raWUgaXMgYWJsZSB0byByZWxheSBqb3VybmFsIGVudHJpZXMgc3RhcnRl\nZCBmcm9tIGxhc3QgbG9nIG1hcmsgd2l0aG91dCBsb3NpbmcKICAgICAqIGFu\neSBlbnRyaWVzLgogICAgICogPC9wPgogICAgICogPHA+CiAgICAgKiBUaG9z\nZSBqb3VybmFsIGZpbGVzIHdob3NlIGlkIGFyZSBsZXNzIHRoYW4gdGhlIGxv\nZyBpZCBpbiBsYXN0IGxvZyBtYXJrLCBjb3VsZCBiZQogICAgICogcmVtb3Zl\nZCBzYWZlbHkgYWZ0ZXIgcGVyc2lzdGluZyBsYXN0IGxvZyBtYXJrLiBXZSBw\ncm92aWRlIGEgc2V0dGluZyB0byBsZXQgdXNlciBrZWVwaW5nCiAgICAgKiBu\ndW1iZXIgb2Ygb2xkIGpvdXJuYWwgZmlsZXMgd2hpY2ggbWF5IGJlIHVzZWQg\nZm9yIG1hbnVhbCByZWNvdmVyeSBpbiBjcml0aWNhbCBkaXNhc3Rlci4KICAg\nICAqIDwvcD4KICAgICAqLwogICAgY2xhc3MgU3luY1RocmVhZCBleHRlbmRz\nIFRocmVhZCB7CiAgICAgICAgdm9sYXRpbGUgYm9vbGVhbiBydW5uaW5nID0g\ndHJ1ZTsKICAgICAgICAvLyBmbGFnIHRvIGVuc3VyZSBzeW5jIHRocmVhZCB3\naWxsIG5vdCBiZSBpbnRlcnJ1cHRlZCBkdXJpbmcgZmx1c2gKICAgICAgICBm\naW5hbCBBdG9taWNCb29sZWFuIGZsdXNoaW5nID0gbmV3IEF0b21pY0Jvb2xl\nYW4oZmFsc2UpOwogICAgICAgIC8vIG1ha2UgZmx1c2ggaW50ZXJ2YWwgYXMg\nYSBwYXJhbWV0ZXIKICAgICAgICBmaW5hbCBpbnQgZmx1c2hJbnRlcnZhbDsK\nICAgICAgICBwdWJsaWMgU3luY1RocmVhZChTZXJ2ZXJDb25maWd1cmF0aW9u\nIGNvbmYpIHsKICAgICAgICAgICAgc3VwZXIoIlN5bmNUaHJlYWQiKTsKICAg\nICAgICAgICAgZmx1c2hJbnRlcnZhbCA9IGNvbmYuZ2V0Rmx1c2hJbnRlcnZh\nbCgpOwogICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRmx1c2ggSW50ZXJ2YWwgOiAi\nICsgZmx1c2hJbnRlcnZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgICAgICB3aGlsZShydW5uaW5nKSB7CiAgICAgICAgICAgICAgICBz\neW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHdhaXQoZmx1c2hJbnRlcnZhbCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW50cnlMb2dnZXIudGVz\ndEFuZENsZWFyU29tZXRoaW5nV3JpdHRlbigpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVk\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFk\nLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHRyeSB0byBtYXJr\nIGZsdXNoaW5nIGZsYWcgdG8gbWFrZSBzdXJlIGl0IHdvdWxkIG5vdCBiZSBp\nbnRlcnJ1cHRlZAogICAgICAgICAgICAgICAgLy8gYnkgc2h1dGRvd24gZHVy\naW5nIGZsdXNoaW5nLiBvdGhlcndpc2UgaXQgd2lsbCByZWNlaXZlCiAgICAg\nICAgICAgICAgICAvLyBDbG9zZWRCeUludGVycnVwdEV4Y2VwdGlvbiB3aGlj\naCBtYXkgY2F1c2UgaW5kZXggZmlsZSAmIGVudHJ5IGxvZ2dlcgogICAgICAg\nICAgICAgICAgLy8gY2xvc2VkIGFuZCBjb3JydXB0ZWQuCiAgICAgICAgICAg\nICAgICBpZiAoIWZsdXNoaW5nLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUp\nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGZsdXNoaW5nIGZsYWcg\nZmFpbGVkLCBtZWFucyBmbHVzaGluZyBpcyB0cnVlIG5vdwogICAgICAgICAg\nICAgICAgICAgIC8vIGluZGljYXRlcyBhbm90aGVyIHRocmVhZCB3YW50cyB0\nbyBpbnRlcnJ1cHQgc3luYyB0aHJlYWQgdG8gZXhpdAogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIGxhc3RMb2dNYXJrLm1hcmtMb2coKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuZmx1c2hMZWRn\nZXIodHJ1ZSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRp\nb24gZmx1c2hpbmcgTGVkZ2VyIiwgZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGVudHJ5\nTG9nZ2VyLmZsdXNoKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJF\neGNlcHRpb24gZmx1c2hpbmcgZW50cnkgbG9nZ2VyIiwgZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBsYXN0TG9nTWFyay5yb2xsTG9n\nKCk7CgogICAgICAgICAgICAgICAgLy8gbGlzdCB0aGUgam91cm5hbHMgdGhh\ndCBoYXZlIGJlZW4gbWFya2VkCiAgICAgICAgICAgICAgICBMaXN0PExvbmc+\nIGxvZ3MgPSBsaXN0Sm91cm5hbElkcyhqb3VybmFsRGlyZWN0b3J5LCBuZXcg\nSm91cm5hbElkRmlsdGVyKCkgewogICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2Vw\ndChsb25nIGpvdXJuYWxJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoam91cm5hbElkIDwgbGFzdExvZ01hcmsubGFzdE1hcmsudHhuTG9nSWQp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfSk7CgogICAgICAgICAgICAgICAgLy8ga2VlcCBNQVhfQkFDS1VQX0pP\nVVJOQUxTIGpvdXJuYWwgZmlsZXMgYmVmb3JlIG1hcmtlZCBqb3VybmFsCiAg\nICAgICAgICAgICAgICBpZiAobG9ncy5zaXplKCkgPj0gbWF4QmFja3VwSm91\ncm5hbHMpIHsKICAgICAgICAgICAgICAgICAgICBpbnQgbWF4SWR4ID0gbG9n\ncy5zaXplKCkgLSBtYXhCYWNrdXBKb3VybmFsczsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBpPTA7IGk8bWF4SWR4OyBpKyspIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgbG9uZyBpZCA9IGxvZ3MuZ2V0KGkpOwogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGpvdXJuYWwgaWQg\naXMgc21hbGxlciB0aGFuIG1hcmtlZCBqb3VybmFsIGlkCiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChpZCA8IGxhc3RMb2dNYXJrLmxhc3RNYXJrLnR4\nbkxvZ0lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGaWxlIGpv\ndXJuYWxGaWxlID0gbmV3IEZpbGUoam91cm5hbERpcmVjdG9yeSwgTG9uZy50\nb0hleFN0cmluZyhpZCkgKyAiLnR4biIpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgam91cm5hbEZpbGUuZGVsZXRlKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cuaW5mbygiZ2FyYmFnZSBjb2xsZWN0ZWQgam91\ncm5hbCAiICsgam91cm5hbEZpbGUuZ2V0TmFtZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBjbGVhciBmbHVzaGluZyBm\nbGFnCiAgICAgICAgICAgICAgICBmbHVzaGluZy5zZXQoZmFsc2UpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBzaHV0ZG93biBzeW5j\nIHRocmVhZAogICAgICAgIHZvaWQgc2h1dGRvd24oKSB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICBydW5uaW5nID0gZmFsc2U7\nCiAgICAgICAgICAgIGlmIChmbHVzaGluZy5jb21wYXJlQW5kU2V0KGZhbHNl\nLCB0cnVlKSkgewogICAgICAgICAgICAgICAgLy8gaWYgc2V0dGluZyBmbHVz\naGluZyBmbGFnIHN1Y2NlZWQsIG1lYW5zIHN5bmNUaHJlYWQgaXMgbm90IGZs\ndXNoaW5nIG5vdwogICAgICAgICAgICAgICAgLy8gaXQgaXMgc2FmZSB0byBp\nbnRlcnJ1cHQgaXRzZWxmIG5vdyAKICAgICAgICAgICAgICAgIHRoaXMuaW50\nZXJydXB0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5qb2lu\nKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBCb29raWUoU2VydmVy\nQ29uZmlndXJhdGlvbiBjb25mKSAKICAgICAgICAgICAgdGhyb3dzIElPRXhj\nZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nIHsKICAgICAgICB0aGlzLmNvbmYgPSBjb25mOwogICAgICAgIHRoaXMuam91\ncm5hbERpcmVjdG9yeSA9IGNvbmYuZ2V0Sm91cm5hbERpcigpOwogICAgICAg\nIHRoaXMubGVkZ2VyRGlyZWN0b3JpZXMgPSBjb25mLmdldExlZGdlckRpcnMo\nKTsKICAgICAgICB0aGlzLm1heEpvdXJuYWxTaXplID0gY29uZi5nZXRNYXhK\nb3VybmFsU2l6ZSgpICogTUI7CiAgICAgICAgdGhpcy5tYXhCYWNrdXBKb3Vy\nbmFscyA9IGNvbmYuZ2V0TWF4QmFja3VwSm91cm5hbHMoKTsKCiAgICAgICAg\nLy8gY2hlY2sgZGlyZWN0b3J5IGxheW91dHMKICAgICAgICBjaGVja0RpcmVj\ndG9yeUxheW91dFZlcnNpb24oam91cm5hbERpcmVjdG9yeSk7CiAgICAgICAg\nZm9yIChGaWxlIGRpciA6IGxlZGdlckRpcmVjdG9yaWVzKSB7CiAgICAgICAg\nICAgIGNoZWNrRGlyZWN0b3J5TGF5b3V0VmVyc2lvbihkaXIpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gaW5zdGFudGlhdGUgem9va2VlcGVyIGNsaWVudCB0\nbyBpbml0aWFsaXplIGxlZGdlciBtYW5hZ2VyCiAgICAgICAgWm9vS2VlcGVy\nIG5ld1prID0gaW5zdGFudGlhdGVab29rZWVwZXJDbGllbnQoY29uZi5nZXRa\na1NlcnZlcnMoKSk7CiAgICAgICAgbGVkZ2VyTWFuYWdlciA9IExlZGdlck1h\nbmFnZXJGYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXIoY29uZiwgbmV3WmspOwoK\nICAgICAgICBzeW5jVGhyZWFkID0gbmV3IFN5bmNUaHJlYWQoY29uZik7CiAg\nICAgICAgZW50cnlMb2dnZXIgPSBuZXcgRW50cnlMb2dnZXIoY29uZiwgdGhp\ncyk7CiAgICAgICAgbGVkZ2VyQ2FjaGUgPSBuZXcgTGVkZ2VyQ2FjaGUoY29u\nZiwgbGVkZ2VyTWFuYWdlcik7CgogICAgICAgIGxhc3RMb2dNYXJrLnJlYWRM\nb2coKTsKICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAg\nICAgICAgICAgTE9HLmRlYnVnKCJMYXN0IExvZyBNYXJrIDogIiArIGxhc3RM\nb2dNYXJrKTsKICAgICAgICB9CiAgICAgICAgZmluYWwgbG9uZyBtYXJrZWRM\nb2dJZCA9IGxhc3RMb2dNYXJrLnR4bkxvZ0lkOwogICAgICAgIExpc3Q8TG9u\nZz4gbG9ncyA9IGxpc3RKb3VybmFsSWRzKGpvdXJuYWxEaXJlY3RvcnksIG5l\ndyBKb3VybmFsSWRGaWx0ZXIoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBhY2NlcHQobG9uZyBqb3VybmFs\nSWQpIHsKICAgICAgICAgICAgICAgIGlmIChqb3VybmFsSWQgPCBtYXJrZWRM\nb2dJZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgLy8gbGFzdCBsb2cg\nbWFyayBtYXkgYmUgbWlzc2VkIGR1ZSB0byBubyBzeW5jIHVwIGJlZm9yZQog\nICAgICAgIC8vIHZhbGlkYXRlIGZpbHRlcmVkIGxvZyBpZHMgb25seSB3aGVu\nIHdlIGhhdmUgbWFya2VkTG9nSWQKICAgICAgICBpZiAobWFya2VkTG9nSWQg\nPiAwKSB7CiAgICAgICAgICAgIGlmIChsb2dzLnNpemUoKSA9PSAwIHx8IGxv\nZ3MuZ2V0KDApICE9IG1hcmtlZExvZ0lkKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSU9FeGNlcHRpb24oIlJlY292ZXJ5IGxvZyAiICsgbWFya2Vk\nTG9nSWQgKyAiIGlzIG1pc3NpbmciKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAg\nICAgICAgTE9HLmRlYnVnKCJUcnkgdG8gcmVsYXkgam91cm5hbCBsb2dzIDog\nIiArIGxvZ3MpOwogICAgICAgIH0KICAgICAgICAvLyBUT0RPOiBXaGVuIHJl\nYWRpbmcgaW4gdGhlIGpvdXJuYWwgbG9ncyB0aGF0IG5lZWQgdG8gYmUgc3lu\nY2VkLCB3ZQogICAgICAgIC8vIHNob3VsZCB1c2UgQnVmZmVyZWRDaGFubmVs\ncyBpbnN0ZWFkIHRvIG1pbmltaXplIHRoZSBhbW91bnQgb2YKICAgICAgICAv\nLyBzeXN0ZW0gY2FsbHMgZG9uZS4KICAgICAgICBCeXRlQnVmZmVyIGxlbkJ1\nZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgIEJ5dGVCdWZm\nZXIgcmVjQnVmZiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNjQqMTAyNCk7CiAg\nICAgICAgZm9yKExvbmcgaWQ6IGxvZ3MpIHsKICAgICAgICAgICAgRmlsZUNo\nYW5uZWwgcmVjTG9nIDsKICAgICAgICAgICAgaWYoaWQgPT0gbWFya2VkTG9n\nSWQpIHsKICAgICAgICAgICAgICBsb25nIG1hcmtlZExvZ1Bvc2l0aW9uID0g\nbGFzdExvZ01hcmsudHhuTG9nUG9zaXRpb247CiAgICAgICAgICAgICAgcmVj\nTG9nID0gb3BlbkNoYW5uZWwoaWQsIG1hcmtlZExvZ1Bvc2l0aW9uKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZWNMb2cgPSBvcGVu\nQ2hhbm5lbChpZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdoaWxl\nKHRydWUpIHsKICAgICAgICAgICAgICAgIGxlbkJ1ZmYuY2xlYXIoKTsKICAg\nICAgICAgICAgICAgIGZ1bGxSZWFkKHJlY0xvZywgbGVuQnVmZik7CiAgICAg\nICAgICAgICAgICBpZiAobGVuQnVmZi5yZW1haW5pbmcoKSAhPSAwKSB7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBsZW5CdWZmLmZsaXAoKTsKICAgICAgICAgICAgICAg\nIGludCBsZW4gPSBsZW5CdWZmLmdldEludCgpOwogICAgICAgICAgICAgICAg\naWYgKGxlbiA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZWNCdWZmLmNsZWFy\nKCk7CiAgICAgICAgICAgICAgICBpZiAocmVjQnVmZi5yZW1haW5pbmcoKSA8\nIGxlbikgewogICAgICAgICAgICAgICAgICAgIHJlY0J1ZmYgPSBCeXRlQnVm\nZmVyLmFsbG9jYXRlKGxlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICByZWNCdWZmLmxpbWl0KGxlbik7CiAgICAgICAgICAgICAgICBp\nZiAoZnVsbFJlYWQocmVjTG9nLCByZWNCdWZmKSAhPSBsZW4pIHsKICAgICAg\nICAgICAgICAgICAgICAvLyBUaGlzIHNlZW1zIHNjYXJ5LCBidXQgaXQganVz\ndCBtZWFucyB0aGF0IHRoaXMgaXMgd2hlcmUgd2UKICAgICAgICAgICAgICAg\nICAgICAvLyBsZWZ0IG9mZiB3cml0aW5nCiAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZWNC\ndWZmLmZsaXAoKTsKICAgICAgICAgICAgICAgIGxvbmcgbGVkZ2VySWQgPSBy\nZWNCdWZmLmdldExvbmcoKTsKICAgICAgICAgICAgICAgIGlmIChMT0cuaXNE\nZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiUmVsYXkgam91cm5hbCAtIGxlZGdlciBpZCA6ICIgKyBsZWRnZXJJZCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBMZWRnZXJEZXNj\ncmlwdG9yIGhhbmRsZSA9IGdldEhhbmRsZShsZWRnZXJJZCwgZmFsc2UpOwog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICByZWNC\ndWZmLnJld2luZCgpOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZS5hZGRF\nbnRyeShyZWNCdWZmKTsKICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgICAgICAgICAgcHV0SGFuZGxlKGhhbmRsZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgLy8g\ncGFzcyB6b29rZWVwZXIgaW5zdGFuY2UgaGVyZQogICAgICAgIC8vIHNpbmNl\nIEdhcmJhZ2VDb2xsZWN0b3IgdGhyZWFkIHNob3VsZCBvbmx5IHN0YXJ0IGFm\ndGVyIGpvdXJuYWwKICAgICAgICAvLyBmaW5pc2hlZCByZXBsYXkKICAgICAg\nICB0aGlzLnprID0gbmV3Wms7CiAgICAgICAgLy8gbWFrZSB0aGUgYm9va2ll\nIGF2YWlsYWJsZQogICAgICAgIHJlZ2lzdGVyQm9va2llKGNvbmYuZ2V0Qm9v\na2llUG9ydCgpKTsKICAgICAgICBzZXREYWVtb24odHJ1ZSk7CiAgICAgICAg\nTE9HLmRlYnVnKCJJJ20gc3RhcnRpbmcgYSBib29raWUgd2l0aCBqb3VybmFs\nIGRpcmVjdG9yeSAiICsgam91cm5hbERpcmVjdG9yeS5nZXROYW1lKCkpOwog\nICAgICAgIHN0YXJ0KCk7CiAgICAgICAgc3luY1RocmVhZC5zdGFydCgpOwog\nICAgICAgIC8vIHNldCBydW5uaW5nIGhlcmUuCiAgICAgICAgLy8gc2luY2Ug\nYm9va2llIHNlcnZlciB1c2UgcnVubmluZyBhcyBhIGZsYWcgdG8gdGVsbCBi\nb29raWUgc2VydmVyIHdoZXRoZXIgaXQgaXMgYWxpdmUKICAgICAgICAvLyBp\nZiBzZXR0aW5nIGl0IGluIGJvb2tpZSB0aHJlYWQsIHRoZSB3YXRjaGVyIG1p\nZ2h0IHJ1biBiZWZvcmUgYm9va2llIHRocmVhZC4KICAgICAgICBydW5uaW5n\nID0gdHJ1ZTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGludGVyZmFjZSBK\nb3VybmFsSWRGaWx0ZXIgewogICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2Vw\ndChsb25nIGpvdXJuYWxJZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBMaXN0\nIGFsbCBqb3VybmFsIGlkcyBieSBhIHNwZWNpZmllZCBqb3VybmFsIGlkIGZp\nbGVyCiAgICAgKgogICAgICogQHBhcmFtIGpvdXJuYWxEaXIgam91cm5hbCBk\naXIKICAgICAqIEBwYXJhbSBmaWx0ZXIgam91cm5hbCBpZCBmaWx0ZXIKICAg\nICAqIEByZXR1cm4gbGlzdCBvZiBmaWx0ZXJlZCBpZHMKICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBMaXN0PExvbmc+IGxpc3RKb3VybmFsSWRzKEZpbGUg\nam91cm5hbERpciwgSm91cm5hbElkRmlsdGVyIGZpbHRlcikgewogICAgICAg\nIEZpbGUgbG9nRmlsZXNbXSA9IGpvdXJuYWxEaXIubGlzdEZpbGVzKCk7CiAg\nICAgICAgTGlzdDxMb25nPiBsb2dzID0gbmV3IEFycmF5TGlzdDxMb25nPigp\nOwogICAgICAgIGZvcihGaWxlIGY6IGxvZ0ZpbGVzKSB7CiAgICAgICAgICAg\nIFN0cmluZyBuYW1lID0gZi5nZXROYW1lKCk7CiAgICAgICAgICAgIGlmICgh\nbmFtZS5lbmRzV2l0aCgiLnR4biIpKSB7CiAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBTdHJpbmcgaWRTdHJp\nbmcgPSBuYW1lLnNwbGl0KCJcXC4iKVswXTsKICAgICAgICAgICAgbG9uZyBp\nZCA9IExvbmcucGFyc2VMb25nKGlkU3RyaW5nLCAxNik7CiAgICAgICAgICAg\nIGlmIChmaWx0ZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGZp\nbHRlci5hY2NlcHQoaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9ncy5h\nZGQoaWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgbG9ncy5hZGQoaWQpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIENvbGxlY3Rpb25zLnNvcnQobG9ncyk7CiAg\nICAgICAgcmV0dXJuIGxvZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBJbnN0\nYW50aWF0ZSB0aGUgWm9vS2VlcGVyIGNsaWVudCBmb3IgdGhlIEJvb2tpZS4K\nICAgICAqLwogICAgcHJpdmF0ZSBab29LZWVwZXIgaW5zdGFudGlhdGVab29r\nZWVwZXJDbGllbnQoU3RyaW5nIHprU2VydmVycykgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoemtTZXJ2ZXJzID09IG51bGwpIHsKICAgICAg\nICAgICAgTE9HLndhcm4oIk5vIFpLIHNlcnZlcnMgcGFzc2VkIHRvIEJvb2tp\nZSBjb25zdHJ1Y3RvciBzbyBCb29rS2VlcGVyIGNsaWVudHMgd29uJ3Qga25v\ndyBhYm91dCB0aGlzIHNlcnZlciEiKTsKICAgICAgICAgICAgaXNaa0V4cGly\nZWQgPSBmYWxzZTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQogICAgICAgIGludCB6a1RpbWVvdXQgPSBjb25mLmdldFprVGltZW91dCgp\nOwogICAgICAgIC8vIENyZWF0ZSB0aGUgWm9vS2VlcGVyIGNsaWVudCBpbnN0\nYW5jZQogICAgICAgIHJldHVybiBuZXdab29rZWVwZXIoemtTZXJ2ZXJzLCB6\na1RpbWVvdXQpOwogICAgfQoKICAgIC8qKgogICAgICogUmVnaXN0ZXIgYXMg\nYW4gYXZhaWxhYmxlIGJvb2tpZQogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ncmVnaXN0ZXJCb29raWUoaW50IHBvcnQpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKG51bGwgPT0gemspIHsKICAgICAgICAgICAgLy8gem9v\na2VlcGVyIGluc3RhbmNlIGlzIG51bGwsIG1lYW5zIG5vdCByZWdpc3RlciBp\ndHNlbGYgdG8gemsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAg\nICAgICAvLyBDcmVhdGUgdGhlIFpLIGVwaGVtZXJhbCBub2RlIGZvciB0aGlz\nIEJvb2tpZS4KICAgICAgICB0cnkgewogICAgICAgICAgICB6ay5jcmVhdGUo\nQk9PS0lFX1JFR0lTVFJBVElPTl9QQVRIICsgSW5ldEFkZHJlc3MuZ2V0TG9j\nYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSArICI6IiArIHBvcnQsIG5ldyBi\neXRlWzBdLAogICAgICAgICAgICAgICAgICAgICAgSWRzLk9QRU5fQUNMX1VO\nU0FGRSwgQ3JlYXRlTW9kZS5FUEhFTUVSQUwpOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiWksgZXhj\nZXB0aW9uIHJlZ2lzdGVyaW5nIGVwaGVtZXJhbCBabm9kZSBmb3IgQm9va2ll\nISIsIGUpOwogICAgICAgICAgICAvLyBUaHJvdyBhbiBJT0V4Y2VwdGlvbiBi\nYWNrIHVwLiBUaGlzIHdpbGwgY2F1c2UgdGhlIEJvb2tpZQogICAgICAgICAg\nICAvLyBjb25zdHJ1Y3RvciB0byBlcnJvciBvdXQuIEFsdGVybmF0aXZlbHks\nIHdlIGNvdWxkIGRvIGEgU3lzdGVtCiAgICAgICAgICAgIC8vIGV4aXQgaGVy\nZSBhcyB0aGlzIGlzIGEgZmF0YWwgZXJyb3IuCiAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDcmVhdGUgYSBuZXcgem9va2VlcGVyIGNsaWVudCB0byB6ayBj\nbHVzdGVyLgogICAgICoKICAgICAqIDxwPgogICAgICogQm9va2llIFNlcnZl\nciBqdXN0IHVzZWQgemsgY2xpZW50IHdoZW4gc3luY2luZyBsZWRnZXJzIGZv\nciBnYXJiYWdlIGNvbGxlY3Rpb24uCiAgICAgKiBTbyB3aGVuIHprIGNsaWVu\ndCBpcyBleHBpcmVkLCBpdCBtZWFucyB0aGlzIGJvb2tpZSBzZXJ2ZXIgaXMg\nbm90IGF2YWlsYWJsZSBpbgogICAgICogYm9va2llIHNlcnZlciBsaXN0LiBU\naGUgYm9va2llIGNsaWVudCB3aWxsIGJlIG5vdGlmaWVkIGZvciBpdHMgZXhw\naXJhdGlvbi4gTm8KICAgICAqIG1vcmUgYm9va2llIHJlcXVlc3Qgd2lsbCBi\nZSBzZW50IHRvIHRoaXMgc2VydmVyLiBTbyBpdCdzIGJldHRlciB0byBleGl0\nIHdoZW4gemsKICAgICAqIGV4cGlyZWQuCiAgICAgKiA8L3A+CiAgICAgKiA8\ncD4KICAgICAqIFNpbmNlIHRoZXJlIGFyZSBsb3RzIG9mIGJrIG9wZXJhdGlv\nbnMgY2FjaGVkIGluIHF1ZXVlLCBzbyB3ZSB3YWl0IGZvciBhbGwgdGhlIG9w\nZXJhdGlvbnMKICAgICAqIGFyZSBwcm9jZXNzZWQgYW5kIHF1aXQuIEl0IGlz\nIGRvbmUgYnkgY2FsbGluZyA8Yj5zaHV0ZG93bjwvYj4uCiAgICAgKiA8L3A+\nCiAgICAgKgogICAgICogQHBhcmFtIHprU2VydmVycyB0aGUgcXVvcnVtIGxp\nc3Qgb2Ygemsgc2VydmVycwogICAgICogQHBhcmFtIHNlc3Npb25UaW1lb3V0\nIHNlc3Npb24gdGltZW91dCBvZiB6ayBjb25uZWN0aW9uCiAgICAgKgogICAg\nICogQHJldHVybiB6ayBjbGllbnQgaW5zdGFuY2UKICAgICAqLwogICAgcHJp\ndmF0ZSBab29LZWVwZXIgbmV3Wm9va2VlcGVyKGZpbmFsIFN0cmluZyB6a1Nl\ncnZlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlu\nYWwgaW50IHNlc3Npb25UaW1lb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIFpvb0tlZXBlciBuZXdaayA9IG5ldyBab29LZWVwZXIoemtTZXJ2\nZXJzLCBzZXNzaW9uVGltZW91dCwKICAgICAgICBuZXcgV2F0Y2hlcigpIHsK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAg\nICAvLyBoYW5kbGUgc2Vzc2lvbiBkaXNjb25uZWN0cyBhbmQgZXhwaXJlcwog\nICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKQogICAgICAgICAg\nICAgICAgLmVxdWFscyhXYXRjaGVyLkV2ZW50LkV2ZW50VHlwZS5Ob25lKSkg\newogICAgICAgICAgICAgICAgICAgIGlmIChldmVudC5nZXRTdGF0ZSgpLmVx\ndWFscygKICAgICAgICAgICAgICAgICAgICBXYXRjaGVyLkV2ZW50LktlZXBl\nclN0YXRlLkRpc2Nvbm5lY3RlZCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLndhcm4oIlpLIGNsaWVudCBoYXMgYmVlbiBkaXNjb25uZWN0ZWQg\ndG8gdGhlIFpLIHNlcnZlciEiKTsKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgaWYgKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKAogICAgICAgICAgICAg\nICAgICAgIFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3Rl\nZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlpLIGNs\naWVudCBoYXMgYmVlbiByZWNvbm5lY3RlZCB0byB0aGUgWksgc2VydmVyISIp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIC8vIENoZWNrIGZvciBleHBpcmVkIGNvbm5lY3Rpb24u\nCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZ2V0U3RhdGUoKS5lcXVhbHMo\nCiAgICAgICAgICAgICAgICBXYXRjaGVyLkV2ZW50LktlZXBlclN0YXRlLkV4\ncGlyZWQpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJaSyBj\nbGllbnQgY29ubmVjdGlvbiB0byB0aGUgWksgc2VydmVyIGhhcyBleHBpcmVk\nISIpOwogICAgICAgICAgICAgICAgICAgIGlzWmtFeHBpcmVkID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICBzaHV0ZG93bigpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIFN5c3RlbS5leGl0KC0xKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsK\nICAgICAgICBpc1prRXhwaXJlZCA9IGZhbHNlOwogICAgICAgIHJldHVybiBu\nZXdaazsKICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoZSBsYXlvdXQg\ndmVyc2lvbiBvZiBhIGRpcmVjdG9yeS4gSWYgaXQgaXMgb3V0c2lkZSBvZiB0\naGUgCiAgICAgKiByYW5nZSB3aGljaCB0aGlzIHZlcnNpb24gb2YgdGhlIHNv\nZnR3YXJlIGNhbiBoYW5kbGUsIHRocm93IGFuCiAgICAgKiBleGNlcHRpb24u\nCiAgICAgKgogICAgICogQHBhcmFtIGRpciBEaXJlY3RvcnkgdG8gY2hlY2sK\nICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24gaWYgbGF5b3V0IHZlcnNpb24g\naWYgaXMgb3V0c2lkZSB1c2FibGUgcmFuZ2UKICAgICAqICAgICAgICAgICAg\nICAgb3IgaWYgdGhlcmUgaXMgYSBwcm9ibGVtIHJlYWRpbmcgdGhlIHZlcnNp\nb24gZmlsZQogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2hlY2tEaXJlY3Rv\ncnlMYXlvdXRWZXJzaW9uKEZpbGUgZGlyKSAKICAgICAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWRpci5pc0RpcmVjdG9yeSgp\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRGlyZWN0\nb3J5KCIrZGlyKyIpIGlzbid0IGEgZGlyZWN0b3J5Iik7CiAgICAgICAgfQog\nICAgICAgIEZpbGUgdmVyc2lvbkZpbGUgPSBuZXcgRmlsZShkaXIsIFZFUlNJ\nT05fRklMRU5BTUUpOwogICAgICAgIAogICAgICAgIEZpbGVJbnB1dFN0cmVh\nbSBmaXM7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmlzID0gbmV3IEZp\nbGVJbnB1dFN0cmVhbSh2ZXJzaW9uRmlsZSk7CiAgICAgICAgfSBjYXRjaCAo\nRmlsZU5vdEZvdW5kRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLyogCiAg\nICAgICAgICAgICAqIElmIHRoZSB2ZXJzaW9uIGZpbGUgaXMgbm90IGZvdW5k\nLCB0aGlzIG11c3QKICAgICAgICAgICAgICogZWl0aGVyIGJlIHRoZSBmaXJz\ndCB0aW1lIHdlJ3ZlIHVzZWQgdGhpcyBkaXJlY3RvcnksCiAgICAgICAgICAg\nICAqIG9yIGl0IG11c3QgZGF0ZSBmcm9tIGJlZm9yZSBsYXlvdXQgdmVyc2lv\nbnMgd2VyZSBpbnRyb2R1Y2VkLgogICAgICAgICAgICAgKiBJbiBib3RoIGNh\nc2VzLCB3ZSBqdXN0IGNyZWF0ZSB0aGUgdmVyc2lvbiBmaWxlCiAgICAgICAg\nICAgICAqLwogICAgICAgICAgICBMT0cuaW5mbygiTm8gdmVyc2lvbiBmaWxl\nIGZvdW5kLCBjcmVhdGluZyIpOwogICAgICAgICAgICBjcmVhdGVEaXJlY3Rv\ncnlMYXlvdXRWZXJzaW9uRmlsZShkaXIpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQogICAgICAgIAogICAgICAgIEJ1ZmZlcmVkUmVhZGVyIGJy\nID0gbmV3IEJ1ZmZlcmVkUmVhZGVyKG5ldyBJbnB1dFN0cmVhbVJlYWRlcihm\naXMpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBTdHJpbmcgbGF5b3V0\nVmVyc2lvblN0ciA9IGJyLnJlYWRMaW5lKCk7CiAgICAgICAgICAgIGludCBs\nYXlvdXRWZXJzaW9uID0gSW50ZWdlci5wYXJzZUludChsYXlvdXRWZXJzaW9u\nU3RyKTsKICAgICAgICAgICAgaWYgKGxheW91dFZlcnNpb24gIT0gQ1VSUkVO\nVF9ESVJFQ1RPUllfTEFZT1VUX1ZFUlNJT04pIHsKICAgICAgICAgICAgICAg\nIFN0cmluZyBlcnJtc2cgPSAiRGlyZWN0b3J5IGhhcyBhbiBpbnZhbGlkIHZl\ncnNpb24sIGV4cGVjdGVkICIgCiAgICAgICAgICAgICAgICAgICAgKyBDVVJS\nRU5UX0RJUkVDVE9SWV9MQVlPVVRfVkVSU0lPTiArICIsIGZvdW5kICIgKyBs\nYXlvdXRWZXJzaW9uOwogICAgICAgICAgICAgICAgTE9HLmVycm9yKGVycm1z\nZyk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZXJy\nbXNnKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2goTnVtYmVyRm9y\nbWF0RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKCJWZXJzaW9uIGZpbGUgaGFzIGludmFsaWQgY29udGVudCIsIGUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBmaXMuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIkVy\ncm9yIGNsb3NpbmcgdmVyc2lvbiBmaWxlIiwgZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ3JlYXRlIHRo\nZSBkaXJlY3RvcnkgbGF5b3V0IHZlcnNpb24gZmlsZSB3aXRoIHRoZSBjdXJy\nZW50CiAgICAgKiBkaXJlY3RvcnkgbGF5b3V0IHZlcnNpb24KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIGNyZWF0ZURpcmVjdG9yeUxheW91dFZlcnNpb25G\naWxlKEZpbGUgZGlyKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIEZp\nbGUgdmVyc2lvbkZpbGUgPSBuZXcgRmlsZShkaXIsIFZFUlNJT05fRklMRU5B\nTUUpOwoKICAgICAgICBGaWxlT3V0cHV0U3RyZWFtIGZvcyA9IG5ldyBGaWxl\nT3V0cHV0U3RyZWFtKHZlcnNpb25GaWxlKTsKICAgICAgICBCdWZmZXJlZFdy\naXRlciBidyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYncg\nPSBuZXcgQnVmZmVyZWRXcml0ZXIobmV3IE91dHB1dFN0cmVhbVdyaXRlcihm\nb3MpKTsKICAgICAgICAgICAgYncud3JpdGUoU3RyaW5nLnZhbHVlT2YoQ1VS\nUkVOVF9ESVJFQ1RPUllfTEFZT1VUX1ZFUlNJT04pKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBpZiAoYncgIT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgYncuY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBmb3MuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBz\ndGF0aWMgaW50IGZ1bGxSZWFkKEZpbGVDaGFubmVsIGZjLCBCeXRlQnVmZmVy\nIGJiKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGludCB0b3RhbCA9\nIDA7CiAgICAgICAgd2hpbGUoYmIucmVtYWluaW5nKCkgPiAwKSB7CiAgICAg\nICAgICAgIGludCByYyA9IGZjLnJlYWQoYmIpOwogICAgICAgICAgICBpZiAo\ncmMgPD0gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRvdGFsOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRvdGFsICs9IHJjOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gdG90YWw7CiAgICB9CiAgICBwcml2YXRlIHZvaWQg\ncHV0SGFuZGxlKExlZGdlckRlc2NyaXB0b3IgaGFuZGxlKSB7CiAgICAgICAg\nc3luY2hyb25pemVkIChsZWRnZXJzKSB7CiAgICAgICAgICAgIGhhbmRsZS5k\nZWNSZWYoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBMZWRnZXJE\nZXNjcmlwdG9yIGdldEhhbmRsZShsb25nIGxlZGdlcklkLCBib29sZWFuIHJl\nYWRvbmx5LCBieXRlW10gbWFzdGVyS2V5KSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gbnVsbDsKICAg\nICAgICBzeW5jaHJvbml6ZWQgKGxlZGdlcnMpIHsKICAgICAgICAgICAgaGFu\nZGxlID0gbGVkZ2Vycy5nZXQobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAo\naGFuZGxlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIEZpbGVJbmZvIGZp\nID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgLy8gZ2V0IGZpbGUgaW5mbyB3aWxsIHRocm93IE5vTGVkZ2VyRXhj\nZXB0aW9uCiAgICAgICAgICAgICAgICAgICAgZmkgPSBsZWRnZXJDYWNoZS5n\nZXRGaWxlSW5mbyhsZWRnZXJJZCwgIXJlYWRvbmx5KTsKCiAgICAgICAgICAg\nICAgICAgICAgLy8gaWYgYW4gZXhpc3RlZCBsZWRnZXIgaW5kZXggZmlsZSwg\nd2UgY2FuIGdldCBpdHMgbWFzdGVyIGtleQogICAgICAgICAgICAgICAgICAg\nIC8vIGlmIGFuIG5ldyBjcmVhdGVkIGxlZGdlciBpbmRleCBmaWxlLCB3ZSB3\naWxsIGdldCBhIG51bGwgbWFzdGVyIGtleQogICAgICAgICAgICAgICAgICAg\nIGJ5dGVbXSBleGlzdGluZ01hc3RlcktleSA9IGZpLnJlYWRNYXN0ZXJLZXko\nKTsKICAgICAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIG1hc3RlcktleVRv\nU2V0ID0gQnl0ZUJ1ZmZlci53cmFwKG1hc3RlcktleSk7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGV4aXN0aW5nTWFzdGVyS2V5ID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gbm8gbWFzdGVyIGtleSBzZXQgYmVm\nb3JlCiAgICAgICAgICAgICAgICAgICAgICAgIGZpLndyaXRlTWFzdGVyS2V5\nKG1hc3RlcktleSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICgh\nbWFzdGVyS2V5VG9TZXQuZXF1YWxzKEJ5dGVCdWZmZXIud3JhcChleGlzdGlu\nZ01hc3RlcktleSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbigiV3JvbmcgbWFzdGVyIGtleSBmb3IgbGVkZ2Vy\nICIgKyBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGhhbmRsZSA9IGNyZWF0ZUhhbmRsZShsZWRnZXJJZCwg\ncmVhZG9ubHkpOwogICAgICAgICAgICAgICAgICAgIGxlZGdlcnMucHV0KGxl\nZGdlcklkLCBoYW5kbGUpOwogICAgICAgICAgICAgICAgICAgIGhhbmRsZS5z\nZXRNYXN0ZXJLZXkobWFzdGVyS2V5VG9TZXQpOwogICAgICAgICAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBpZiAoZmkgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGhhbmRsZS5pbmNSZWYoKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGhhbmRsZTsKICAgIH0KCiAgICBwcml2YXRlIExl\nZGdlckRlc2NyaXB0b3IgZ2V0SGFuZGxlKGxvbmcgbGVkZ2VySWQsIGJvb2xl\nYW4gcmVhZG9ubHkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgTGVk\nZ2VyRGVzY3JpcHRvciBoYW5kbGUgPSBudWxsOwogICAgICAgIHN5bmNocm9u\naXplZCAobGVkZ2VycykgewogICAgICAgICAgICBoYW5kbGUgPSBsZWRnZXJz\nLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChoYW5kbGUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgRmlsZUluZm8gZmkgPSBudWxsOwogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBnZXQg\nZmlsZSBpbmZvIHdpbGwgdGhyb3cgTm9MZWRnZXJFeGNlcHRpb24KICAgICAg\nICAgICAgICAgICAgICBmaSA9IGxlZGdlckNhY2hlLmdldEZpbGVJbmZvKGxl\nZGdlcklkLCAhcmVhZG9ubHkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBp\nZiBhbiBleGlzdGVkIGxlZGdlciBpbmRleCBmaWxlLCB3ZSBjYW4gZ2V0IGl0\ncyBtYXN0ZXIga2V5CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgYW4gbmV3\nIGNyZWF0ZWQgbGVkZ2VyIGluZGV4IGZpbGUsIHdlIHdpbGwgZ2V0IGEgbnVs\nbCBtYXN0ZXIga2V5CiAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGV4aXN0\naW5nTWFzdGVyS2V5ID0gZmkucmVhZE1hc3RlcktleSgpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChleGlzdGluZ01hc3RlcktleSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigi\nV2VpcmQhIE5vIG1hc3RlciBrZXkgZm91bmQgaW4gbGVkZ2VyICIgKyBsZWRn\nZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nICAgICBoYW5kbGUgPSBjcmVhdGVIYW5kbGUobGVkZ2VySWQsIHJlYWRvbmx5\nKTsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJzLnB1dChsZWRnZXJJZCwg\naGFuZGxlKTsKICAgICAgICAgICAgICAgICAgICBoYW5kbGUuc2V0TWFzdGVy\nS2V5KEJ5dGVCdWZmZXIud3JhcChleGlzdGluZ01hc3RlcktleSkpOwogICAg\nICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoZmkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBmaS5y\nZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGhhbmRsZS5pbmNSZWYo\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhhbmRsZTsKICAgIH0KCgog\nICAgcHJpdmF0ZSBMZWRnZXJEZXNjcmlwdG9yIGNyZWF0ZUhhbmRsZShsb25n\nIGxlZGdlcklkLCBib29sZWFuIHJlYWRPbmx5KSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBuZXcgTGVkZ2VyRGVzY3JpcHRvcihsZWRn\nZXJJZCwgZW50cnlMb2dnZXIsIGxlZGdlckNhY2hlKTsKICAgIH0KCiAgICBz\ndGF0aWMgY2xhc3MgUXVldWVFbnRyeSB7CiAgICAgICAgUXVldWVFbnRyeShC\neXRlQnVmZmVyIGVudHJ5LCBsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQs\nCiAgICAgICAgICAgICAgICAgICBXcml0ZUNhbGxiYWNrIGNiLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgICAgIHRoaXMuZW50cnkgPSBlbnRyeS5kdXBsaWNh\ndGUoKTsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAgICAgICAgICB0\naGlzLmN0eCA9IGN0eDsKICAgICAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxl\nZGdlcklkOwogICAgICAgICAgICB0aGlzLmVudHJ5SWQgPSBlbnRyeUlkOwog\nICAgICAgIH0KCiAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeTsKCiAgICAgICAg\nbG9uZyBsZWRnZXJJZDsKCiAgICAgICAgbG9uZyBlbnRyeUlkOwoKICAgICAg\nICBXcml0ZUNhbGxiYWNrIGNiOwoKICAgICAgICBPYmplY3QgY3R4OwogICAg\nfQoKICAgIExpbmtlZEJsb2NraW5nUXVldWU8UXVldWVFbnRyeT4gcXVldWUg\nPSBuZXcgTGlua2VkQmxvY2tpbmdRdWV1ZTxRdWV1ZUVudHJ5PigpOwoKICAg\nIHB1YmxpYyBmaW5hbCBzdGF0aWMgbG9uZyBwcmVBbGxvY1NpemUgPSA0KjEw\nMjQqMTAyNDsKCiAgICBwdWJsaWMgZmluYWwgc3RhdGljIEJ5dGVCdWZmZXIg\nemVyb3MgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDUxMik7CgogICAgY2xhc3Mg\nTGFzdExvZ01hcmsgewogICAgICAgIGxvbmcgdHhuTG9nSWQ7CiAgICAgICAg\nbG9uZyB0eG5Mb2dQb3NpdGlvbjsKICAgICAgICBMYXN0TG9nTWFyayBsYXN0\nTWFyazsKICAgICAgICBMYXN0TG9nTWFyayhsb25nIGxvZ0lkLCBsb25nIGxv\nZ1Bvc2l0aW9uKSB7CiAgICAgICAgICAgIHRoaXMudHhuTG9nSWQgPSBsb2dJ\nZDsKICAgICAgICAgICAgdGhpcy50eG5Mb2dQb3NpdGlvbiA9IGxvZ1Bvc2l0\naW9uOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6ZWQgdm9pZCBzZXRM\nYXN0TG9nTWFyayhsb25nIGxvZ0lkLCBsb25nIGxvZ1Bvc2l0aW9uKSB7CiAg\nICAgICAgICAgIHR4bkxvZ0lkID0gbG9nSWQ7CiAgICAgICAgICAgIHR4bkxv\nZ1Bvc2l0aW9uID0gbG9nUG9zaXRpb247CiAgICAgICAgfQogICAgICAgIHN5\nbmNocm9uaXplZCB2b2lkIG1hcmtMb2coKSB7CiAgICAgICAgICAgIGxhc3RN\nYXJrID0gbmV3IExhc3RMb2dNYXJrKHR4bkxvZ0lkLCB0eG5Mb2dQb3NpdGlv\nbik7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZCB2b2lkIHJvbGxM\nb2coKSB7CiAgICAgICAgICAgIGJ5dGUgYnVmZltdID0gbmV3IGJ5dGVbMTZd\nOwogICAgICAgICAgICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci53cmFw\nKGJ1ZmYpOwogICAgICAgICAgICAvLyB3ZSBzaG91bGQgcmVjb3JkIDxsb2dJ\nZCwgbG9nUG9zaXRpb24+IG1hcmtlZCBpbiBtYXJrTG9nCiAgICAgICAgICAg\nIC8vIHdoaWNoIGlzIHNhZmUgc2luY2UgcmVjb3JkcyBiZWZvcmUgbGFzdE1h\ncmsgaGF2ZSBiZWVuCiAgICAgICAgICAgIC8vIHBlcnNpc3RlZCB0byBkaXNr\nIChib3RoIGluZGV4ICYgZW50cnkgbG9nZ2VyKQogICAgICAgICAgICBiYi5w\ndXRMb25nKGxhc3RNYXJrLnR4bkxvZ0lkKTsKICAgICAgICAgICAgYmIucHV0\nTG9uZyhsYXN0TWFyay50eG5Mb2dQb3NpdGlvbik7CiAgICAgICAgICAgIGlm\nIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgTE9H\nLmRlYnVnKCJSb2xsTG9nIHRvIHBlcnNpc3QgbGFzdCBtYXJrZWQgbG9nIDog\nIiArIGxhc3RNYXJrKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3Io\nRmlsZSBkaXI6IGxlZGdlckRpcmVjdG9yaWVzKSB7CiAgICAgICAgICAgICAg\nICBGaWxlIGZpbGUgPSBuZXcgRmlsZShkaXIsICJsYXN0TWFyayIpOwogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBGaWxlT3V0\ncHV0U3RyZWFtIGZvcyA9IG5ldyBGaWxlT3V0cHV0U3RyZWFtKGZpbGUpOwog\nICAgICAgICAgICAgICAgICAgIGZvcy53cml0ZShidWZmKTsKICAgICAgICAg\nICAgICAgICAgICBmb3MuZ2V0Q2hhbm5lbCgpLmZvcmNlKHRydWUpOwogICAg\nICAgICAgICAgICAgICAgIGZvcy5jbG9zZSgpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiUHJvYmxlbXMgd3JpdGluZyB0byAiICsgZmlsZSwgZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFJlYWQgbGFzdCBtYXJrIGZyb20gbGFz\ndE1hcmsgZmlsZS4KICAgICAgICAgKiBUaGUgbGFzdCBtYXJrIHNob3VsZCBm\naXJzdCBiZSBtYXggam91cm5hbCBsb2cgaWQsCiAgICAgICAgICogYW5kIHRo\nZW4gbWF4IGxvZyBwb3NpdGlvbiBpbiBtYXggam91cm5hbCBsb2cuCiAgICAg\nICAgICovCiAgICAgICAgc3luY2hyb25pemVkIHZvaWQgcmVhZExvZygpIHsK\nICAgICAgICAgICAgYnl0ZSBidWZmW10gPSBuZXcgYnl0ZVsxNl07CiAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLndyYXAoYnVmZik7\nCiAgICAgICAgICAgIGZvcihGaWxlIGRpcjogbGVkZ2VyRGlyZWN0b3JpZXMp\nIHsKICAgICAgICAgICAgICAgIEZpbGUgZmlsZSA9IG5ldyBGaWxlKGRpciwg\nImxhc3RNYXJrIik7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgIEZpbGVJbnB1dFN0cmVhbSBmaXMgPSBuZXcgRmlsZUlucHV0\nU3RyZWFtKGZpbGUpOwogICAgICAgICAgICAgICAgICAgIGZpcy5yZWFkKGJ1\nZmYpOwogICAgICAgICAgICAgICAgICAgIGZpcy5jbG9zZSgpOwogICAgICAg\nICAgICAgICAgICAgIGJiLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAg\nbG9uZyBpID0gYmIuZ2V0TG9uZygpOwogICAgICAgICAgICAgICAgICAgIGxv\nbmcgcCA9IGJiLmdldExvbmcoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\naSA+IHR4bkxvZ0lkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR4bkxv\nZ0lkID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYocCA+IHR4bkxv\nZ1Bvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdHhuTG9n\nUG9zaXRpb24gPSBwOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9F\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigi\nUHJvYmxlbXMgcmVhZGluZyBmcm9tICIgKyBmaWxlICsgIiAodGhpcyBpcyBv\na2F5IGlmIGl0IGlzIHRoZSBmaXJzdCB0aW1lIHN0YXJ0aW5nIHRoaXMgYm9v\na2llIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJpbmcg\ndG9TdHJpbmcoKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBu\nZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAgICAKICAgICAgICAgICAg\nc2IuYXBwZW5kKCJMYXN0TWFyazogbG9nSWQgLSAiKS5hcHBlbmQodHhuTG9n\nSWQpCiAgICAgICAgICAgICAgLmFwcGVuZCgiICwgcG9zaXRpb24gLSAiKS5h\ncHBlbmQodHhuTG9nUG9zaXRpb24pOwogICAgICAgICAgICAKICAgICAgICAg\nICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgTGFzdExvZ01hcmsgbGFzdExvZ01hcmsgPSBuZXcgTGFzdExv\nZ01hcmsoMCwgMCk7CgogICAgTGFzdExvZ01hcmsgZ2V0TGFzdExvZ01hcmso\nKSB7CiAgICAgICAgcmV0dXJuIGxhc3RMb2dNYXJrOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzUnVubmluZygpIHsKICAgICAgICByZXR1cm4gcnVu\nbmluZzsKICAgIH0KCiAgICAvKioKICAgICAqIEEgdGhyZWFkIHVzZWQgZm9y\nIHBlcnNpc3Rpbmcgam91cm5hbCBlbnRyaWVzIHRvIGpvdXJuYWwgZmlsZXMu\nCiAgICAgKiAKICAgICAqIDxwPgogICAgICogQmVzaWRlcyBwZXJzaXN0aW5n\nIGpvdXJuYWwgZW50cmllcywgaXQgYWxzbyB0YWtlcyByZXNwb25zaWJpbGl0\neSBvZgogICAgICogcm9sbGluZyBqb3VybmFsIGZpbGVzIHdoZW4gYSBqb3Vy\nbmFsIGZpbGUgcmVhY2hlcyBqb3VybmFsIGZpbGUgc2l6ZQogICAgICogbGlt\naXRhdGlvbi4KICAgICAqIDwvcD4KICAgICAqIDxwPgogICAgICogRHVyaW5n\nIGpvdXJuYWwgcm9sbGluZywgaXQgZmlyc3QgY2xvc2VzIHRoZSB3cml0aW5n\nIGpvdXJuYWwsIGdlbmVyYXRlcwogICAgICogbmV3IGpvdXJuYWwgZmlsZSB1\nc2luZyBjdXJyZW50IHRpbWVzdGFtcCwgYW5kIGNvbnRpbnVlIHBlcnNpc3Rl\nbmNlIGxvZ2ljLgogICAgICogVGhvc2Ugam91cm5hbHMgd2lsbCBiZSBnYXJi\nYWdlIGNvbGxlY3RlZCBpbiBTeW5jVGhyZWFkLgogICAgICogPC9wPgogICAg\nICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICBMaW5rZWRMaXN0PFF1ZXVlRW50cnk+IHRvRmx1c2ggPSBuZXcgTGlu\na2VkTGlzdDxRdWV1ZUVudHJ5PigpOwogICAgICAgIEJ5dGVCdWZmZXIgbGVu\nQnVmZiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgbG9uZyBsb2dJZCA9IDA7CiAgICAgICAgICAgIEZpbGVD\naGFubmVsIGxvZ0ZpbGUgPSBudWxsOwogICAgICAgICAgICBCdWZmZXJlZENo\nYW5uZWwgYmMgPSBudWxsOwogICAgICAgICAgICBsb25nIG5leHRQcmVhbGxv\nYyA9IDA7CiAgICAgICAgICAgIGxvbmcgbGFzdEZsdXNoUG9zaXRpb24gPSAw\nOwoKICAgICAgICAgICAgUXVldWVFbnRyeSBxZSA9IG51bGw7CiAgICAgICAg\nICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAvLyBuZXcgam91\ncm5hbCBmaWxlIHRvIHdyaXRlCiAgICAgICAgICAgICAgICBpZiAobnVsbCA9\nPSBsb2dGaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nSWQgPSBTeXN0\nZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgICAgICBs\nb2dGaWxlID0gb3BlbkNoYW5uZWwobG9nSWQpOwogICAgICAgICAgICAgICAg\nICAgIGJjID0gbmV3IEJ1ZmZlcmVkQ2hhbm5lbChsb2dGaWxlLCA2NTUzNik7\nCiAgICAgICAgICAgICAgICAgICAgemVyb3MuY2xlYXIoKTsKICAgICAgICAg\nICAgICAgICAgICBuZXh0UHJlYWxsb2MgPSBwcmVBbGxvY1NpemU7CiAgICAg\nICAgICAgICAgICAgICAgbGFzdEZsdXNoUG9zaXRpb24gPSAwOwogICAgICAg\nICAgICAgICAgICAgIGxvZ0ZpbGUud3JpdGUoemVyb3MsIG5leHRQcmVhbGxv\nYyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHFl\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAodG9GbHVzaC5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcWUgPSBxdWV1\nZS50YWtlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgcWUgPSBxdWV1ZS5wb2xsKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChxZSA9PSBudWxsIHx8IGJjLnBvc2l0aW9u\nKCkgPiBsYXN0Rmx1c2hQb3NpdGlvbiArIDUxMioxMDI0KSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvL2xvZ0ZpbGUuZm9yY2UoZmFsc2UpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYmMuZmx1c2godHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Rmx1c2hQb3NpdGlvbiA9\nIGJjLnBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nYXN0TG9nTWFyay5zZXRMYXN0TG9nTWFyayhsb2dJZCwgbGFzdEZsdXNoUG9z\naXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChRdWV1\nZUVudHJ5IGUgOiB0b0ZsdXNoKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZS5jYi53cml0ZUNvbXBsZXRlKDAsIGUubGVkZ2VySWQsIGUu\nZW50cnlJZCwgbnVsbCwgZS5jdHgpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9GbHVzaC5j\nbGVhcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNr\nIHdoZXRoZXIgam91cm5hbCBmaWxlIGlzIG92ZXIgZmlsZSBsaW1pdAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJjLnBvc2l0aW9uKCkgPiBt\nYXhKb3VybmFsU2l6ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZ0ZpbGUuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsb2dGaWxlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBp\nZiAoaXNaa0V4cGlyZWQpIHsKICAgICAgICAgICAgICAgICAgICBMT0cud2Fy\nbigiRXhpdGluZy4uLiB6ayBjbGllbnQgaGFzIGV4cGlyZWQuIik7CiAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBpZiAocWUgPT0gbnVsbCkgeyAvLyBubyBtb3JlIHF1ZXVl\nIGVudHJ5CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBsZW5CdWZmLmNsZWFyKCk7CiAg\nICAgICAgICAgICAgICBsZW5CdWZmLnB1dEludChxZS5lbnRyeS5yZW1haW5p\nbmcoKSk7CiAgICAgICAgICAgICAgICBsZW5CdWZmLmZsaXAoKTsKICAgICAg\nICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyB3ZSBzaG91bGQgYmUg\nZG9pbmcgdGhlIGZvbGxvd2luZywgYnV0IHRoZW4gd2UgcnVuIG91dCBvZgog\nICAgICAgICAgICAgICAgLy8gZGlyZWN0IGJ5dGUgYnVmZmVycwogICAgICAg\nICAgICAgICAgLy8gbG9nRmlsZS53cml0ZShuZXcgQnl0ZUJ1ZmZlcltdIHsg\nbGVuQnVmZiwgcWUuZW50cnkgfSk7CiAgICAgICAgICAgICAgICBiYy53cml0\nZShsZW5CdWZmKTsKICAgICAgICAgICAgICAgIGJjLndyaXRlKHFlLmVudHJ5\nKTsKICAgICAgICAgICAgICAgIGlmIChiYy5wb3NpdGlvbigpID4gbmV4dFBy\nZWFsbG9jKSB7CiAgICAgICAgICAgICAgICAgICAgbmV4dFByZWFsbG9jID0g\nKGxvZ0ZpbGUuc2l6ZSgpIC8gcHJlQWxsb2NTaXplICsgMSkgKiBwcmVBbGxv\nY1NpemU7CiAgICAgICAgICAgICAgICAgICAgemVyb3MuY2xlYXIoKTsKICAg\nICAgICAgICAgICAgICAgICBsb2dGaWxlLndyaXRlKHplcm9zLCBuZXh0UHJl\nYWxsb2MpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdG9G\nbHVzaC5hZGQocWUpOwogICAgICAgICAgICAgICAgcWUgPSBudWxsOwogICAg\nICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJCb29raWUgdGhyZWFkIGV4aXRpbmciLCBl\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBGaWxlQ2hhbm5lbCBv\ncGVuQ2hhbm5lbChsb25nIGxvZ0lkKSB0aHJvd3MgRmlsZU5vdEZvdW5kRXhj\nZXB0aW9uIHsKICAgICAgICByZXR1cm4gb3BlbkNoYW5uZWwobG9nSWQsIDAp\nOwogICAgfQoKICAgIHByaXZhdGUgRmlsZUNoYW5uZWwgb3BlbkNoYW5uZWwo\nbG9uZyBsb2dJZCwgbG9uZyBwb3NpdGlvbikgdGhyb3dzIEZpbGVOb3RGb3Vu\nZEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZUNoYW5uZWwgbG9nRmlsZSA9IG5l\ndyBSYW5kb21BY2Nlc3NGaWxlKG5ldyBGaWxlKGpvdXJuYWxEaXJlY3Rvcnks\nCiAgICAgICAgICAgICAgICBMb25nLnRvSGV4U3RyaW5nKGxvZ0lkKSArICIu\ndHhuIiksCiAgICAgICAgICAgICAgICAicnciKS5nZXRDaGFubmVsKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgbG9nRmlsZS5wb3NpdGlvbihwb3Np\ndGlvbik7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIkJvb2tpZSBqb3VybmFsIGZpbGUgY2FuIHNl\nZWsgdG8gcG9zaXRpb24gOiIsIGUpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbG9nRmlsZTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hyb25pemVkIHZv\naWQgc2h1dGRvd24oKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewog\nICAgICAgIGlmICghcnVubmluZykgeyAvLyBhdm9pZCBzaHV0ZG93biB0d2lj\nZQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIC8vIFNo\ndXRkb3duIHRoZSBaSyBjbGllbnQKICAgICAgICBpZih6ayAhPSBudWxsKSB6\nay5jbG9zZSgpOwogICAgICAgIHRoaXMuaW50ZXJydXB0KCk7CiAgICAgICAg\ndGhpcy5qb2luKCk7CiAgICAgICAgc3luY1RocmVhZC5zaHV0ZG93bigpOyAK\nICAgICAgICBmb3IoTGVkZ2VyRGVzY3JpcHRvciBkOiBsZWRnZXJzLnZhbHVl\ncygpKSB7CiAgICAgICAgICAgIGQuY2xvc2UoKTsKICAgICAgICB9CiAgICAg\nICAgLy8gU2h1dGRvd24gdGhlIEVudHJ5TG9nZ2VyIHdoaWNoIGhhcyB0aGUg\nR2FyYmFnZUNvbGxlY3RvciBUaHJlYWQgcnVubmluZwogICAgICAgIGVudHJ5\nTG9nZ2VyLnNodXRkb3duKCk7CiAgICAgICAgLy8gY2xvc2UgTGVkZ2VyIE1h\nbmFnZXIKICAgICAgICBsZWRnZXJNYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAg\nLy8gc2V0dGluZyBydW5uaW5nIHRvIGZhbHNlIGhlcmUsIHNvIHdhdGNoIHRo\ncmVhZCBpbiBib29raWUgc2VydmVyIGtub3cgaXQgb25seSBhZnRlciBib29r\naWUgc2h1dCBkb3duCiAgICAgICAgcnVubmluZyA9IGZhbHNlOwogICAgfQoK\nICAgIC8qKiAKICAgICAqIFJldHJpZXZlIHRoZSBsZWRnZXIgZGVzY3JpcHRv\nciBmb3IgdGhlIGxlZGdlciB3aGljaCBlbnRyeSBzaG91bGQgYmUgYWRkZWQg\ndG8uCiAgICAgKiBUaGUgTGVkZ2VyRGVzY3JpcHRvciByZXR1cm5lZCBmcm9t\nIHRoaXMgbWV0aG9kIHNob3VsZCBiZSBldmVudHVhbGx5IGZyZWVkIHdpdGgg\nCiAgICAgKiAjcHV0SGFuZGxlKCkuCiAgICAgKgogICAgICogQHRocm93cyBC\nb29raWVFeGNlcHRpb24gaWYgbWFzdGVyS2V5IGRvZXMgbm90IG1hdGNoIHRo\nZSBtYXN0ZXIga2V5IG9mIHRoZSBsZWRnZXIKICAgICAqLwogICAgcHJpdmF0\nZSBMZWRnZXJEZXNjcmlwdG9yIGdldExlZGdlckZvckVudHJ5KEJ5dGVCdWZm\nZXIgZW50cnksIGJ5dGVbXSBtYXN0ZXJLZXkpIAogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9u\nZyBsZWRnZXJJZCA9IGVudHJ5LmdldExvbmcoKTsKICAgICAgICBMZWRnZXJE\nZXNjcmlwdG9yIGhhbmRsZSA9IGdldEhhbmRsZShsZWRnZXJJZCwgZmFsc2Us\nIG1hc3RlcktleSk7CgogICAgICAgIGlmKCFoYW5kbGUuY21wTWFzdGVyS2V5\nKEJ5dGVCdWZmZXIud3JhcChtYXN0ZXJLZXkpKSkgewogICAgICAgICAgICBw\ndXRIYW5kbGUoaGFuZGxlKTsKICAgICAgICAgICAgdGhyb3cgQm9va2llRXhj\nZXB0aW9uLmNyZWF0ZShCb29raWVFeGNlcHRpb24uQ29kZS5VbmF1dGhvcml6\nZWRBY2Nlc3NFeGNlcHRpb24pOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\naGFuZGxlOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGVudHJ5IHRv\nIGEgbGVkZ2VyIGFzIHNwZWNpZmllZCBieSBoYW5kbGUuIAogICAgICovCiAg\nICBwcml2YXRlIHZvaWQgYWRkRW50cnlJbnRlcm5hbChMZWRnZXJEZXNjcmlw\ndG9yIGhhbmRsZSwgQnl0ZUJ1ZmZlciBlbnRyeSwgV3JpdGVDYWxsYmFjayBj\nYiwgT2JqZWN0IGN0eCkKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIGxvbmcgbGVkZ2VySWQgPSBo\nYW5kbGUuZ2V0TGVkZ2VySWQoKTsKICAgICAgICBlbnRyeS5yZXdpbmQoKTsK\nICAgICAgICBsb25nIGVudHJ5SWQgPSBoYW5kbGUuYWRkRW50cnkoZW50cnkp\nOwoKICAgICAgICBlbnRyeS5yZXdpbmQoKTsKICAgICAgICBpZiAoTE9HLmlz\nVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgTE9HLnRyYWNlKCJBZGRp\nbmcgIiArIGVudHJ5SWQgKyAiQCIgKyBsZWRnZXJJZCk7CiAgICAgICAgfQog\nICAgICAgIHF1ZXVlLmFkZChuZXcgUXVldWVFbnRyeShlbnRyeSwgbGVkZ2Vy\nSWQsIGVudHJ5SWQsIGNiLCBjdHgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFkZCBlbnRyeSB0byBhIGxlZGdlciwgZXZlbiBpZiB0aGUgbGVkZ2VyIGhh\ncyBwcmV2aW91cyBiZWVuIGZlbmNlZC4gVGhpcyBzaG91bGQgb25seQogICAg\nICogaGFwcGVuIGluIGJvb2tpZSByZWNvdmVyeSBvciBsZWRnZXIgcmVjb3Zl\ncnkgY2FzZXMsIHdoZXJlIGVudHJpZXMgYXJlIGJlaW5nIHJlcGxpY2F0ZXMg\nCiAgICAgKiBzbyB0aGF0IHRoZXkgZXhpc3Qgb24gYSBxdW9ydW0gb2YgYm9v\na2llcy4gVGhlIGNvcnJlc3BvbmRpbmcgY2xpZW50IHNpZGUgY2FsbCBmb3Ig\ndGhpcwogICAgICogaXMgbm90IGV4cG9zZWQgdG8gdXNlcnMuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHJlY292ZXJ5QWRkRW50cnkoQnl0ZUJ1ZmZlciBl\nbnRyeSwgV3JpdGVDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCwgYnl0ZVtdIG1h\nc3RlcktleSkgCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9v\na2llRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJEZXNjcmlwdG9yIGhhbmRs\nZSA9IGdldExlZGdlckZvckVudHJ5KGVudHJ5LCBtYXN0ZXJLZXkpOwogICAg\nICAgIHN5bmNocm9uaXplZCAoaGFuZGxlKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBhZGRFbnRyeUludGVybmFsKGhhbmRsZSwgZW50\ncnksIGNiLCBjdHgpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAgICAgcHV0SGFuZGxlKGhhbmRsZSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CiAgICAKICAgIC8qKiAKICAgICAqIEFkZCBlbnRyeSB0\nbyBhIGxlZGdlci4KICAgICAqIEB0aHJvd3MgQm9va2llRXhjZXB0aW9uLkxl\nZGdlckZlbmNlZEV4Y2VwdGlvbiBpZiB0aGUgbGVkZ2VyIGlzIGZlbmNlZAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGRFbnRyeShCeXRlQnVmZmVyIGVu\ndHJ5LCBXcml0ZUNhbGxiYWNrIGNiLCBPYmplY3QgY3R4LCBieXRlW10gbWFz\ndGVyS2V5KQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEJvb2tp\nZUV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUg\nPSBnZXRMZWRnZXJGb3JFbnRyeShlbnRyeSwgbWFzdGVyS2V5KTsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKGhhbmRsZSkgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgaWYgKGhhbmRsZS5pc0ZlbmNlZCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgQm9va2llRXhjZXB0aW9uLmNyZWF0ZShC\nb29raWVFeGNlcHRpb24uQ29kZS5MZWRnZXJGZW5jZWRFeGNlcHRpb24pOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAg\nICAgICBhZGRFbnRyeUludGVybmFsKGhhbmRsZSwgZW50cnksIGNiLCBjdHgp\nOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgcHV0\nSGFuZGxlKGhhbmRsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGZW5jZXMgYSBsZWRnZXIuIEZyb20gdGhpcyBw\nb2ludCBvbiwgY2xpZW50cyB3aWxsIGJlIHVuYWJsZSB0byAKICAgICAqIHdy\naXRlIHRvIHRoaXMgbGVkZ2VyLiBPbmx5IHJlY292ZXJ5QWRkRW50cnkgd2ls\nbCBiZQogICAgICogYWJsZSB0byBhZGQgZW50cmllcyB0byB0aGUgbGVkZ2Vy\nLgogICAgICogVGhpcyBtZXRob2QgaXMgaWRlbXBvdGVudC4gT25jZSBhIGxl\nZGdlciBpcyBmZW5jZWQsIGl0IGNhbgogICAgICogbmV2ZXIgYmUgdW5mZW5j\nZWQuIEZlbmNpbmcgYSBmZW5jZWQgbGVkZ2VyIGhhcyBubyBlZmZlY3QuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGZlbmNlTGVkZ2VyKGxvbmcgbGVkZ2Vy\nSWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyRGVzY3Jp\ncHRvciBoYW5kbGUgPSBnZXRIYW5kbGUobGVkZ2VySWQsIHRydWUpOwogICAg\nICAgIHN5bmNocm9uaXplZCAoaGFuZGxlKSB7CiAgICAgICAgICAgIGhhbmRs\nZS5zZXRGZW5jZWQoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEJ5\ndGVCdWZmZXIgcmVhZEVudHJ5KGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJ\nZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJEZXNjcmlw\ndG9yIGhhbmRsZSA9IGdldEhhbmRsZShsZWRnZXJJZCwgdHJ1ZSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgaWYgKExPRy5pc1RyYWNlRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgICAgICBMT0cudHJhY2UoIlJlYWRpbmcgIiArIGVu\ndHJ5SWQgKyAiQCIgKyBsZWRnZXJJZCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuIGhhbmRsZS5yZWFkRW50cnkoZW50cnlJZCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcHV0SGFuZGxlKGhhbmRsZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8vIFRoZSByZXN0IG9mIHRoZSBjb2Rl\nIGlzIHRlc3Qgc3R1ZmYKICAgIHN0YXRpYyBjbGFzcyBDb3VudGVyQ2FsbGJh\nY2sgaW1wbGVtZW50cyBXcml0ZUNhbGxiYWNrIHsKICAgICAgICBpbnQgY291\nbnQ7CgogICAgICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9pZCB3cml0ZUNv\nbXBsZXRlKGludCByYywgbG9uZyBsLCBsb25nIGUsIEluZXRTb2NrZXRBZGRy\nZXNzIGFkZHIsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgY291bnQtLTsK\nICAgICAgICAgICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAg\nIG5vdGlmeUFsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQgaW5jQ291bnQoKSB7CiAgICAg\nICAgICAgIGNvdW50Kys7CiAgICAgICAgfQoKICAgICAgICBzeW5jaHJvbml6\nZWQgcHVibGljIHZvaWQgd2FpdFplcm8oKSB0aHJvd3MgSW50ZXJydXB0ZWRF\neGNlcHRpb24gewogICAgICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CiAg\nICAgICAgICAgICAgICB3YWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0gYXJncwogICAgICogQHRo\ncm93cyBJT0V4Y2VwdGlvbgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihT\ndHJpbmdbXSBhcmdzKSAKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uLCBLZWVw\nZXJFeGNlcHRpb24gewogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShu\nZXcgU2VydmVyQ29uZmlndXJhdGlvbigpKTsKICAgICAgICBDb3VudGVyQ2Fs\nbGJhY2sgY2IgPSBuZXcgQ291bnRlckNhbGxiYWNrKCk7CiAgICAgICAgbG9u\nZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwMDAwOyBpKyspIHsKICAgICAgICAg\nICAgQnl0ZUJ1ZmZlciBidWZmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgxMDI0\nKTsKICAgICAgICAgICAgYnVmZi5wdXRMb25nKDEpOwogICAgICAgICAgICBi\ndWZmLnB1dExvbmcoaSk7CiAgICAgICAgICAgIGJ1ZmYubGltaXQoMTAyNCk7\nCiAgICAgICAgICAgIGJ1ZmYucG9zaXRpb24oMCk7CiAgICAgICAgICAgIGNi\nLmluY0NvdW50KCk7CiAgICAgICAgICAgIGIuYWRkRW50cnkoYnVmZiwgY2Is\nIG51bGwsIG5ldyBieXRlWzBdKTsKICAgICAgICB9CiAgICAgICAgY2Iud2Fp\ndFplcm8oKTsKICAgICAgICBsb25nIGVuZCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiVG9vayAi\nICsgKGVuZC1zdGFydCkgKyAibXMiKTsKICAgIH0KfQo=\n","encoding":"base64"}

