{"sha":"e2260fde800a6416e87019a336fd21bb64433d9f","node_id":"MDQ6QmxvYjE1NzU5NTY6ZTIyNjBmZGU4MDBhNjQxNmU4NzAxOWEzMzZmZDIxYmI2NDQzM2Q5Zg==","size":6445,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/e2260fde800a6416e87019a336fd21bb64433d9f","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmlvLkJ5\ndGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxlQ2hhbm5l\nbDsKCi8qKgogKiBQcm92aWRlcyBhIGJ1ZmZlcmluZyBsYXllciBpbiBmcm9u\ndCBvZiBhIEZpbGVDaGFubmVsLgogKi8KcHVibGljIGNsYXNzIEJ1ZmZlcmVk\nQ2hhbm5lbAp7CiAgICBCeXRlQnVmZmVyIHdyaXRlQnVmZmVyOwogICAgQnl0\nZUJ1ZmZlciByZWFkQnVmZmVyOwogICAgcHJpdmF0ZSBGaWxlQ2hhbm5lbCBi\nYzsKICAgIGxvbmcgcG9zaXRpb247CiAgICBpbnQgY2FwYWNpdHk7CiAgICBs\nb25nIHJlYWRCdWZmZXJTdGFydFBvc2l0aW9uOwogICAgbG9uZyB3cml0ZUJ1\nZmZlclN0YXJ0UG9zaXRpb247CiAgICAvLyBtYWtlIGNvbnN0cnVjdG9yIHRv\nIGJlIHB1YmxpYyBmb3IgdW5pdCB0ZXN0CiAgICBwdWJsaWMgQnVmZmVyZWRD\naGFubmVsKEZpbGVDaGFubmVsIGJjLCBpbnQgY2FwYWNpdHkpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5iYyA9IGJjOwogICAgICAgIHRo\naXMuY2FwYWNpdHkgPSBjYXBhY2l0eTsKICAgICAgICBwb3NpdGlvbiA9IGJj\nLnBvc2l0aW9uKCk7CiAgICAgICAgd3JpdGVCdWZmZXJTdGFydFBvc2l0aW9u\nID0gcG9zaXRpb247CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIGZp\nbGUgY2hhbm5lbAogICAgICovCiAgICBGaWxlQ2hhbm5lbCBnZXRGaWxlQ2hh\nbm5lbCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5iYzsKICAgIH0KCiAgICAv\nKiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGJjLmNsb3NlKCk7CiAgICAgICAgfQogICAgKi8KLy8g\nICAgcHVibGljIGJvb2xlYW4gaXNPcGVuKCkgewovLyAgICAgICAgcmV0dXJu\nIGJjLmlzT3BlbigpOwovLyAgICB9CgogICAgc3luY2hyb25pemVkIHB1Ymxp\nYyBpbnQgd3JpdGUoQnl0ZUJ1ZmZlciBzcmMpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgaW50IGNvcGllZCA9IDA7CiAgICAgICAgaWYgKHdyaXRl\nQnVmZmVyID09IG51bGwpIHsKICAgICAgICAgICAgd3JpdGVCdWZmZXIgPSBC\neXRlQnVmZmVyLmFsbG9jYXRlRGlyZWN0KGNhcGFjaXR5KTsKICAgICAgICB9\nCiAgICAgICAgd2hpbGUoc3JjLnJlbWFpbmluZygpID4gMCkgewogICAgICAg\nICAgICBpbnQgdHJ1bmNhdGVkID0gMDsKICAgICAgICAgICAgaWYgKHdyaXRl\nQnVmZmVyLnJlbWFpbmluZygpIDwgc3JjLnJlbWFpbmluZygpKSB7CiAgICAg\nICAgICAgICAgICB0cnVuY2F0ZWQgPSBzcmMucmVtYWluaW5nKCkgLSB3cml0\nZUJ1ZmZlci5yZW1haW5pbmcoKTsKICAgICAgICAgICAgICAgIHNyYy5saW1p\ndChzcmMubGltaXQoKS10cnVuY2F0ZWQpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGNvcGllZCArPSBzcmMucmVtYWluaW5nKCk7CiAgICAgICAgICAg\nIHdyaXRlQnVmZmVyLnB1dChzcmMpOwogICAgICAgICAgICBzcmMubGltaXQo\nc3JjLmxpbWl0KCkrdHJ1bmNhdGVkKTsKICAgICAgICAgICAgaWYgKHdyaXRl\nQnVmZmVyLnJlbWFpbmluZygpID09IDApIHsKICAgICAgICAgICAgICAgIHdy\naXRlQnVmZmVyLmZsaXAoKTsKICAgICAgICAgICAgICAgIGJjLndyaXRlKHdy\naXRlQnVmZmVyKTsKICAgICAgICAgICAgICAgIHdyaXRlQnVmZmVyLmNsZWFy\nKCk7CiAgICAgICAgICAgICAgICB3cml0ZUJ1ZmZlclN0YXJ0UG9zaXRpb24g\nPSBiYy5wb3NpdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIHBvc2l0aW9uICs9IGNvcGllZDsKICAgICAgICByZXR1cm4gY29waWVk\nOwogICAgfQoKICAgIHB1YmxpYyBsb25nIHBvc2l0aW9uKCkgewogICAgICAg\nIHJldHVybiBwb3NpdGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIFJldHJp\nZXZlIHRoZSBjdXJyZW50IHNpemUgb2YgdGhlIHVuZGVybHlpbmcgRmlsZUNo\nYW5uZWwKICAgICAqCiAgICAgKiBAcmV0dXJuIEZpbGVDaGFubmVsIHNpemUg\nbWVhc3VyZWQgaW4gYnl0ZXMKICAgICAqCiAgICAgKiBAdGhyb3dzIElPRXhj\nZXB0aW9uIGlmIHNvbWUgSS9PIGVycm9yIG9jY3VycyByZWFkaW5nIHRoZSBG\naWxlQ2hhbm5lbAogICAgICovCiAgICBwdWJsaWMgbG9uZyBzaXplKCkgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gYmMuc2l6ZSgpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGZsdXNoKGJvb2xlYW4gc3luYykgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykg\newogICAgICAgICAgICBpZiAod3JpdGVCdWZmZXIgPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHdyaXRlQnVmZmVyLmZsaXAoKTsKICAgICAgICAgICAgYmMud3JpdGUod3Jp\ndGVCdWZmZXIpOwogICAgICAgICAgICB3cml0ZUJ1ZmZlci5jbGVhcigpOwog\nICAgICAgICAgICB3cml0ZUJ1ZmZlclN0YXJ0UG9zaXRpb24gPSBiYy5wb3Np\ndGlvbigpOwogICAgICAgIH0KICAgICAgICBpZiAoc3luYykgewogICAgICAg\nICAgICBiYy5mb3JjZShmYWxzZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\ncHVibGljIENoYW5uZWwgZ2V0SW50ZXJuYWxDaGFubmVsKCkgewogICAgICAg\nIHJldHVybiBiYzsKICAgIH0qLwogICAgc3luY2hyb25pemVkIHB1YmxpYyBp\nbnQgcmVhZChCeXRlQnVmZmVyIGJ1ZmYsIGxvbmcgcG9zKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGlmIChyZWFkQnVmZmVyID09IG51bGwpIHsK\nICAgICAgICAgICAgcmVhZEJ1ZmZlciA9IEJ5dGVCdWZmZXIuYWxsb2NhdGVE\naXJlY3QoY2FwYWNpdHkpOwogICAgICAgICAgICByZWFkQnVmZmVyU3RhcnRQ\nb3NpdGlvbiA9IExvbmcuTUlOX1ZBTFVFOwogICAgICAgIH0KICAgICAgICBs\nb25nIHByZXZQb3MgPSBwb3M7CiAgICAgICAgd2hpbGUoYnVmZi5yZW1haW5p\nbmcoKSA+IDApIHsKICAgICAgICAgICAgLy8gY2hlY2sgaWYgaXQgaXMgaW4g\ndGhlIHdyaXRlIGJ1ZmZlcgogICAgICAgICAgICBpZiAod3JpdGVCdWZmZXIg\nIT0gbnVsbCAmJiB3cml0ZUJ1ZmZlclN0YXJ0UG9zaXRpb24gPD0gcG9zKSB7\nCiAgICAgICAgICAgICAgICBsb25nIHBvc2l0aW9uSW5CdWZmZXIgPSBwb3Mg\nLSB3cml0ZUJ1ZmZlclN0YXJ0UG9zaXRpb247CiAgICAgICAgICAgICAgICBs\nb25nIGJ5dGVzVG9Db3B5ID0gd3JpdGVCdWZmZXIucG9zaXRpb24oKS1wb3Np\ndGlvbkluQnVmZmVyOwogICAgICAgICAgICAgICAgaWYgKGJ5dGVzVG9Db3B5\nID4gYnVmZi5yZW1haW5pbmcoKSkgewogICAgICAgICAgICAgICAgICAgIGJ5\ndGVzVG9Db3B5ID0gYnVmZi5yZW1haW5pbmcoKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGlmIChieXRlc1RvQ29weSA9PSAwKSB7CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJSZWFk\nIHBhc3QgRU9GIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBCeXRlQnVmZmVyIHNyYyA9IHdyaXRlQnVmZmVyLmR1cGxpY2F0ZSgpOwog\nICAgICAgICAgICAgICAgc3JjLnBvc2l0aW9uKChpbnQpIHBvc2l0aW9uSW5C\ndWZmZXIpOwogICAgICAgICAgICAgICAgc3JjLmxpbWl0KChpbnQpIChwb3Np\ndGlvbkluQnVmZmVyK2J5dGVzVG9Db3B5KSk7CiAgICAgICAgICAgICAgICBi\ndWZmLnB1dChzcmMpOwogICAgICAgICAgICAgICAgcG9zKz0gYnl0ZXNUb0Nv\ncHk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAod3JpdGVCdWZmZXIgPT0gbnVs\nbCAmJiB3cml0ZUJ1ZmZlclN0YXJ0UG9zaXRpb24gPD0gcG9zKSB7CiAgICAg\nICAgICAgICAgICAvLyBoZXJlIHdlIHJlYWNoIHRoZSBlbmQKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgLy8gZmlyc3QgY2hlY2sg\naWYgdGhlcmUgaXMgYW55dGhpbmcgd2UgY2FuIGdyYWIgZnJvbSB0aGUgcmVh\nZEJ1ZmZlcgogICAgICAgICAgICB9IGVsc2UgaWYgKHJlYWRCdWZmZXJTdGFy\ndFBvc2l0aW9uIDw9IHBvcyAmJiBwb3MgPCByZWFkQnVmZmVyU3RhcnRQb3Np\ndGlvbityZWFkQnVmZmVyLmNhcGFjaXR5KCkpIHsKICAgICAgICAgICAgICAg\nIGxvbmcgcG9zaXRpb25JbkJ1ZmZlciA9IHBvcyAtIHJlYWRCdWZmZXJTdGFy\ndFBvc2l0aW9uOwogICAgICAgICAgICAgICAgbG9uZyBieXRlc1RvQ29weSA9\nIHJlYWRCdWZmZXIuY2FwYWNpdHkoKS1wb3NpdGlvbkluQnVmZmVyOwogICAg\nICAgICAgICAgICAgaWYgKGJ5dGVzVG9Db3B5ID4gYnVmZi5yZW1haW5pbmco\nKSkgewogICAgICAgICAgICAgICAgICAgIGJ5dGVzVG9Db3B5ID0gYnVmZi5y\nZW1haW5pbmcoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIEJ5dGVCdWZmZXIgc3JjID0gcmVhZEJ1ZmZlci5kdXBsaWNhdGUoKTsKICAg\nICAgICAgICAgICAgIHNyYy5wb3NpdGlvbigoaW50KSBwb3NpdGlvbkluQnVm\nZmVyKTsKICAgICAgICAgICAgICAgIHNyYy5saW1pdCgoaW50KSAocG9zaXRp\nb25JbkJ1ZmZlcitieXRlc1RvQ29weSkpOwogICAgICAgICAgICAgICAgYnVm\nZi5wdXQoc3JjKTsKICAgICAgICAgICAgICAgIHBvcyArPSBieXRlc1RvQ29w\neTsKICAgICAgICAgICAgICAgIC8vIGxldCdzIHJlYWQgaXQKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlYWRCdWZmZXJTdGFydFBv\nc2l0aW9uID0gcG9zOwogICAgICAgICAgICAgICAgcmVhZEJ1ZmZlci5jbGVh\ncigpOwogICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoYXQgd2UgZG9u\nJ3Qgb3ZlcmxhcCB3aXRoIHRoZSB3cml0ZSBidWZmZXIKICAgICAgICAgICAg\nICAgIGlmIChyZWFkQnVmZmVyU3RhcnRQb3NpdGlvbiArIHJlYWRCdWZmZXIu\nY2FwYWNpdHkoKSA+PSB3cml0ZUJ1ZmZlclN0YXJ0UG9zaXRpb24pIHsKICAg\nICAgICAgICAgICAgICAgICByZWFkQnVmZmVyU3RhcnRQb3NpdGlvbiA9IHdy\naXRlQnVmZmVyU3RhcnRQb3NpdGlvbiAtIHJlYWRCdWZmZXIuY2FwYWNpdHko\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAocmVhZEJ1ZmZlclN0YXJ0UG9z\naXRpb24gPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRCdWZm\nZXIucHV0KExlZGdlckVudHJ5UGFnZS56ZXJvUGFnZSwgMCwgKGludCktcmVh\nZEJ1ZmZlclN0YXJ0UG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdoaWxlKHJlYWRC\ndWZmZXIucmVtYWluaW5nKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGJjLnJlYWQocmVhZEJ1ZmZlciwgcmVhZEJ1ZmZlclN0YXJ0UG9zaXRp\nb24rcmVhZEJ1ZmZlci5wb3NpdGlvbigpKSA8PSAwKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiU2hvcnQgcmVh\nZCIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIHJlYWRCdWZmZXIucHV0KExlZGdlckVudHJ5UGFn\nZS56ZXJvUGFnZSwgMCwgcmVhZEJ1ZmZlci5yZW1haW5pbmcoKSk7CiAgICAg\nICAgICAgICAgICByZWFkQnVmZmVyLmNsZWFyKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIChpbnQpKHBvcyAtIHByZXZQb3Mp\nOwogICAgfQp9Cg==\n","encoding":"base64"}

