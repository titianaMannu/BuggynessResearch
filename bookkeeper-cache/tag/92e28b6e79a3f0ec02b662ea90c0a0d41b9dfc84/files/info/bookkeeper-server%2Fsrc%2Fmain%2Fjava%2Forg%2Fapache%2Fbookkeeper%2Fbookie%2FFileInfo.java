{"sha":"fa713c8018c82cbb37ee3459f5c7de451ec6d560","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmE3MTNjODAxOGM4MmNiYjM3ZWUzNDU5ZjVjN2RlNDUxZWM2ZDU2MA==","size":6333,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/fa713c8018c82cbb37ee3459f5c7de451ec6d560","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5G\naWxlQ2hhbm5lbDsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQg\nb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogVGhpcyBpcyB0aGUg\nZmlsZSBoYW5kbGUgZm9yIGEgbGVkZ2VyJ3MgaW5kZXggZmlsZSB0aGF0IG1h\ncHMgZW50cnkgaWRzIHRvIGxvY2F0aW9uLgogKiBJdCBpcyB1c2VkIGJ5IExl\nZGdlckNhY2hlLgogKgogKiA8cD4KICogTGVkZ2VyIGluZGV4IGZpbGUgaXMg\nbWFkZSBvZiBhIGhlYWRlciBhbmQgc2V2ZXJhbCBmaXhlZC1sZW5ndGggaW5k\nZXggcGFnZXMsIHdoaWNoIHJlY29yZHMgdGhlIG9mZnNldHMgb2YgZGF0YSBz\ndG9yZWQgaW4gZW50cnkgbG9nZ2VycwogKiA8cHJlPiZsdDtoZWFkZXImZ3Q7\nJmx0O2luZGV4IHBhZ2VzJmd0OzwvcHJlPgogKiA8Yj5IZWFkZXI8L2I+IGlz\nIGZvcm1hdGVkIGFzIGJlbG93OgogKiA8cHJlPiZsdDttYWdpYyBieXRlcyZn\ndDsmbHQ7bGVuIG9mIG1hc3RlciBrZXkmZ3Q7Jmx0O21hc3RlciBrZXkmZ3Q7\nPC9wcmU+CiAqIDx1bD4KICogPGxpPm1hZ2ljIGJ5dGVzOiA4IGJ5dGVzLCAn\nQktMRVwwXDBcMFwwJwogKiA8bGk+bGVuIG9mIG1hc3RlciBrZXk6IGluZGlj\nYXRlcyBsZW5ndGggb2YgbWFzdGVyIGtleS4gLTEgbWVhbnMgbm8gbWFzdGVy\nIGtleSBzdG9yZWQgaW4gaGVhZGVyLgogKiA8bGk+bWFzdGVyIGtleTogbWFz\ndGVyIGtleQogKiA8L3VsPgogKiA8Yj5JbmRleCBwYWdlPC9iPiBpcyBhIGZp\neGVkLWxlbmd0aCBwYWdlLCB3aGljaCBjb250YWlucyBzZXJ2ZXJhbCBlbnRy\naWVzIHdoaWNoIHBvaW50IHRvIHRoZSBvZmZzZXRzIG9mIGRhdGEgc3RvcmVk\nIGluIGVudHJ5IGxvZ2dlcnMuCiAqIDwvcD4KICovCmNsYXNzIEZpbGVJbmZv\nIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRM\nb2dnZXIoRmlsZUluZm8uY2xhc3MpOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQg\nTk9fTUFTVEVSX0tFWSA9IC0xOwoKICAgIHByaXZhdGUgRmlsZUNoYW5uZWwg\nZmM7CiAgICBwcml2YXRlIGZpbmFsIEZpbGUgbGY7CiAgICAvKioKICAgICAq\nIFRoZSBmaW5nZXJwcmludCBvZiBhIGxlZGdlciBpbmRleCBmaWxlCiAgICAg\nKi8KICAgIHByaXZhdGUgYnl0ZSBoZWFkZXJbXSA9ICJCS0xFXDBcMFwwXDAi\nLmdldEJ5dGVzKCk7CiAgICBzdGF0aWMgZmluYWwgbG9uZyBTVEFSVF9PRl9E\nQVRBID0gMTAyNDsKICAgIHByaXZhdGUgbG9uZyBzaXplOwogICAgcHJpdmF0\nZSBpbnQgdXNlQ291bnQ7CiAgICBwcml2YXRlIGJvb2xlYW4gaXNDbG9zZWQ7\nCiAgICBwdWJsaWMgRmlsZUluZm8oRmlsZSBsZikgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICB0aGlzLmxmID0gbGY7CiAgICAgICAgZmMgPSBuZXcg\nUmFuZG9tQWNjZXNzRmlsZShsZiwgInJ3cyIpLmdldENoYW5uZWwoKTsKICAg\nICAgICBzaXplID0gZmMuc2l6ZSgpOwogICAgICAgIGlmIChzaXplID09IDAp\nIHsKICAgICAgICAgICAgZmMud3JpdGUoQnl0ZUJ1ZmZlci53cmFwKGhlYWRl\ncikpOwogICAgICAgICAgICAvLyB3cml0ZSBOT19NQVNURVJfS0VZLCB3aGlj\naCBtZWFucyB0aGVyZSBpcyBubyBtYXN0ZXIga2V5CiAgICAgICAgICAgIEJ5\ndGVCdWZmZXIgYnVmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAg\nICAgICAgYnVmLnB1dEludChOT19NQVNURVJfS0VZKTsKICAgICAgICAgICAg\nYnVmLmZsaXAoKTsKICAgICAgICAgICAgZmMud3JpdGUoYnVmKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBXcml0ZSBtYXN0ZXIga2V5IHRv\nIGluZGV4IGZpbGUgaGVhZGVyCiAgICAgKgogICAgICogQHBhcmFtIG1hc3Rl\ncktleSBtYXN0ZXIga2V5IHRvIHN0b3JlCiAgICAgKiBAcmV0dXJuIHZvaWQK\nICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwogICAgc3luY2hy\nb25pemVkIHB1YmxpYyB2b2lkIHdyaXRlTWFzdGVyS2V5KGJ5dGVbXSBtYXN0\nZXJLZXkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgLy8gd3JpdGUg\nbWFzdGVyIGtleQogICAgICAgIGlmIChtYXN0ZXJLZXkgPT0gbnVsbCB8fAog\nICAgICAgICAgICBtYXN0ZXJLZXkubGVuZ3RoICsgNCArIGhlYWRlci5sZW5n\ndGggPiBTVEFSVF9PRl9EQVRBKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbigibWFzdGVyIGtleSBpcyBtb3JlIHRoYW4gIiArIChTVEFS\nVF9PRl9EQVRBIC0gNCAtIGhlYWRlci5sZW5ndGgpKTsKICAgICAgICB9Cgog\nICAgICAgIGludCBsZW4gPSBtYXN0ZXJLZXkubGVuZ3RoOwogICAgICAgIEJ5\ndGVCdWZmZXIgbGVuQnVmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAg\nICAgICBsZW5CdWYucHV0SW50KGxlbik7CiAgICAgICAgbGVuQnVmLmZsaXAo\nKTsKICAgICAgICBmYy5wb3NpdGlvbihoZWFkZXIubGVuZ3RoKTsKICAgICAg\nICBmYy53cml0ZShsZW5CdWYpOwogICAgICAgIGZjLndyaXRlKEJ5dGVCdWZm\nZXIud3JhcChtYXN0ZXJLZXkpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJl\nYWQgbWFzdGVyIGtleQogICAgICoKICAgICAqIEByZXR1cm4gbWFzdGVyIGtl\neS4gbnVsbCBtZWFucyBubyBtYXN0ZXIga2V5IHN0b3JlZCBpbiBpbmRleCBo\nZWFkZXIKICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwogICAg\nc3luY2hyb25pemVkIHB1YmxpYyBieXRlW10gcmVhZE1hc3RlcktleSgpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZUJ1ZmZlciBsZW5CdWYg\nPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgIGludCB0b3RhbCA9\nIHJlYWRBYnNvbHV0ZShsZW5CdWYsIGhlYWRlci5sZW5ndGgpOwogICAgICAg\nIGlmICh0b3RhbCAhPSA0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbigiU2hvcnQgcmVhZCBkdXJpbmcgcmVhZGluZyBtYXN0ZXIga2V5\nIGxlbmd0aCIpOwogICAgICAgIH0KICAgICAgICBsZW5CdWYucmV3aW5kKCk7\nCiAgICAgICAgaW50IGxlbiA9IGxlbkJ1Zi5nZXRJbnQoKTsKICAgICAgICBp\nZiAobGVuID09IE5PX01BU1RFUl9LRVkpIHsKICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgfQoKICAgICAgICBieXRlW10gbWFzdGVyS2V5ID0g\nbmV3IGJ5dGVbbGVuXTsKICAgICAgICB0b3RhbCA9IHJlYWRBYnNvbHV0ZShC\neXRlQnVmZmVyLndyYXAobWFzdGVyS2V5KSwgaGVhZGVyLmxlbmd0aCArIDQp\nOwogICAgICAgIGlmICh0b3RhbCAhPSBsZW4pIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJTaG9ydCByZWFkIGR1cmluZyByZWFkaW5n\nIG1hc3RlciBrZXkiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG1hc3Rl\ncktleTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIGxvbmcgc2l6\nZSgpIHsKICAgICAgICBsb25nIHJjID0gc2l6ZS1TVEFSVF9PRl9EQVRBOwog\nICAgICAgIGlmIChyYyA8IDApIHsKICAgICAgICAgICAgcmMgPSAwOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gcmM7CiAgICB9CgogICAgc3luY2hyb25p\nemVkIHB1YmxpYyBpbnQgcmVhZChCeXRlQnVmZmVyIGJiLCBsb25nIHBvc2l0\naW9uKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHJldHVybiByZWFk\nQWJzb2x1dGUoYmIsIHBvc2l0aW9uICsgU1RBUlRfT0ZfREFUQSk7CiAgICB9\nCgogICAgcHJpdmF0ZSBpbnQgcmVhZEFic29sdXRlKEJ5dGVCdWZmZXIgYmIs\nIGxvbmcgc3RhcnQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaW50\nIHRvdGFsID0gMDsKICAgICAgICB3aGlsZShiYi5yZW1haW5pbmcoKSA+IDAp\nIHsKICAgICAgICAgICAgaW50IHJjID0gZmMucmVhZChiYiwgc3RhcnQpOwog\nICAgICAgICAgICBpZiAocmMgPD0gMCkgewogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElPRXhjZXB0aW9uKCJTaG9ydCByZWFkIik7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgdG90YWwgKz0gcmM7CiAgICAgICAgICAgIC8vIHNo\nb3VsZCBtb3ZlIHJlYWQgcG9zaXRpb24KICAgICAgICAgICAgc3RhcnQgKz0g\ncmM7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b3RhbDsKICAgIH0KCiAg\nICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICBp\nZiAodXNlQ291bnQgPT0gMCkgewogICAgICAgICAgICBmYy5jbG9zZSgpOwog\nICAgICAgIH0KICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIGxvbmcg\nd3JpdGUoQnl0ZUJ1ZmZlcltdIGJ1ZmZzLCBsb25nIHBvc2l0aW9uKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGxvbmcgdG90YWwgPSAwOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGZjLnBvc2l0aW9uKHBvc2l0aW9uK1NU\nQVJUX09GX0RBVEEpOwogICAgICAgICAgICB3aGlsZShidWZmc1tidWZmcy5s\nZW5ndGgtMV0ucmVtYWluaW5nKCkgPiAwKSB7CiAgICAgICAgICAgICAgICBs\nb25nIHJjID0gZmMud3JpdGUoYnVmZnMpOwogICAgICAgICAgICAgICAgaWYg\nKHJjIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9F\neGNlcHRpb24oIlNob3J0IHdyaXRlIik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB0b3RhbCArPSByYzsKICAgICAgICAgICAgfQogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGxvbmcgbmV3c2l6ZSA9IHBv\nc2l0aW9uK1NUQVJUX09GX0RBVEErdG90YWw7CiAgICAgICAgICAgIGlmIChu\nZXdzaXplID4gc2l6ZSkgewogICAgICAgICAgICAgICAgc2l6ZSA9IG5ld3Np\nemU7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRv\ndGFsOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9pZCB1c2Uo\nKSB7CiAgICAgICAgdXNlQ291bnQrKzsKICAgIH0KCiAgICBzeW5jaHJvbml6\nZWQgcHVibGljIHZvaWQgcmVsZWFzZSgpIHsKICAgICAgICB1c2VDb3VudC0t\nOwogICAgICAgIGlmIChpc0Nsb3NlZCAmJiB1c2VDb3VudCA9PSAwKSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmYy5jbG9zZSgpOwog\nICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGNsb3NpbmcgZmlsZSBjaGFubmVs\nIiwgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBHZXR0ZXIgdG8gYSBoYW5kbGUgb24gdGhlIGFjdHVhbCBsZWRn\nZXIgaW5kZXggZmlsZS4KICAgICAqIFRoaXMgaXMgdXNlZCB3aGVuIHdlIGFy\nZSBkZWxldGluZyBhIGxlZGdlciBhbmQgd2FudCB0byBwaHlzaWNhbGx5IHJl\nbW92ZSB0aGUgaW5kZXggZmlsZS4KICAgICAqLwogICAgRmlsZSBnZXRGaWxl\nKCkgewogICAgICAgIHJldHVybiBsZjsKICAgIH0KCn0K\n","encoding":"base64"}

