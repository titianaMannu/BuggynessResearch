{"sha":"d2f959b1eb0eb8a61e79f2f136c9cb552f852757","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDJmOTU5YjFlYjBlYjhhNjFlNzlmMmYxMzZjOWNiNTUyZjg1Mjc1Nw==","size":21224,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d2f959b1eb0eb8a61e79f2f136c9cb552f852757","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwpp\nbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlJhbmRvbTsK\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5h\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVy\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUaGlzIGNsYXNz\nIG1hcHMgYSBsZWRnZXIgZW50cnkgbnVtYmVyIGludG8gYSBsb2NhdGlvbiAo\nZW50cnlsb2dpZCwgb2Zmc2V0KSBpbgogKiBhbiBlbnRyeSBsb2cgZmlsZS4g\nSXQgZG9lcyB1c2VyIGxldmVsIGNhY2hpbmcgdG8gbW9yZSBlZmZpY2llbnRs\neSBtYW5hZ2UgZGlzawogKiBoZWFkIHNjaGVkdWxpbmcuCiAqLwpwdWJsaWMg\nY2xhc3MgTGVkZ2VyQ2FjaGUgewogICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMg\nTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKExlZGdlckRl\nc2NyaXB0b3IuY2xhc3MpOwoKICAgIGZpbmFsIEZpbGUgbGVkZ2VyRGlyZWN0\nb3JpZXNbXTsKCiAgICBwdWJsaWMgTGVkZ2VyQ2FjaGUoU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mLCBMZWRnZXJNYW5hZ2VyIGFsbSkgewogICAgICAgIHRo\naXMubGVkZ2VyRGlyZWN0b3JpZXMgPSBjb25mLmdldExlZGdlckRpcnMoKTsK\nICAgICAgICB0aGlzLm9wZW5GaWxlTGltaXQgPSBjb25mLmdldE9wZW5GaWxl\nTGltaXQoKTsKICAgICAgICB0aGlzLnBhZ2VTaXplID0gY29uZi5nZXRQYWdl\nU2l6ZSgpOwogICAgICAgIHRoaXMuZW50cmllc1BlclBhZ2UgPSBwYWdlU2l6\nZSAvIDg7CiAgICAgICAgCiAgICAgICAgaWYgKGNvbmYuZ2V0UGFnZUxpbWl0\nKCkgPD0gMCkgewogICAgICAgICAgICAvLyBhbGxvY2F0ZSBoYWxmIG9mIHRo\nZSBtZW1vcnkgdG8gdGhlIHBhZ2UgY2FjaGUKICAgICAgICAgICAgdGhpcy5w\nYWdlTGltaXQgPSAoaW50KSgoUnVudGltZS5nZXRSdW50aW1lKCkubWF4TWVt\nb3J5KCkgLyAzKSAvIHRoaXMucGFnZVNpemUpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIHRoaXMucGFnZUxpbWl0ID0gY29uZi5nZXRQYWdlTGlt\naXQoKTsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oIm1heE1lbW9yeSA9\nICIgKyBSdW50aW1lLmdldFJ1bnRpbWUoKS5tYXhNZW1vcnkoKSk7CiAgICAg\nICAgTE9HLmluZm8oIm9wZW5GaWxlTGltaXQgaXMgIiArIG9wZW5GaWxlTGlt\naXQgKyAiLCBwYWdlU2l6ZSBpcyAiICsgcGFnZVNpemUgKyAiLCBwYWdlTGlt\naXQgaXMgIiArIHBhZ2VMaW1pdCk7CiAgICAgICAgYWN0aXZlTGVkZ2VyTWFu\nYWdlciA9IGFsbTsKICAgICAgICAvLyBSZXRyaWV2ZSBhbGwgb2YgdGhlIGFj\ndGl2ZSBsZWRnZXJzLgogICAgICAgIGdldEFjdGl2ZUxlZGdlcnMoKTsKICAg\nIH0KICAgIC8qKgogICAgICogdGhlIGxpc3Qgb2YgcG90ZW50aWFsbHkgY2xl\nYW4gbGVkZ2VycwogICAgICovCiAgICBMaW5rZWRMaXN0PExvbmc+IGNsZWFu\nTGVkZ2VycyA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7CgogICAgLyoqCiAg\nICAgKiB0aGUgbGlzdCBvZiBwb3RlbnRpYWxseSBkaXJ0eSBsZWRnZXJzCiAg\nICAgKi8KICAgIExpbmtlZExpc3Q8TG9uZz4gZGlydHlMZWRnZXJzID0gbmV3\nIExpbmtlZExpc3Q8TG9uZz4oKTsKCiAgICBIYXNoTWFwPExvbmcsIEZpbGVJ\nbmZvPiBmaWxlSW5mb0NhY2hlID0gbmV3IEhhc2hNYXA8TG9uZywgRmlsZUlu\nZm8+KCk7CgogICAgTGlua2VkTGlzdDxMb25nPiBvcGVuTGVkZ2VycyA9IG5l\ndyBMaW5rZWRMaXN0PExvbmc+KCk7CgogICAgLy8gTWFuYWdlIGFsbCBhY3Rp\ndmUgbGVkZ2VycyBpbiBMZWRnZXJNYW5hZ2VyCiAgICAvLyBzbyBMZWRnZXJN\nYW5hZ2VyIGhhcyBrbm93bGVkZ2UgdG8gZ2FyYmFnZSBjb2xsZWN0IGluYWN0\naXZlL2RlbGV0ZWQgbGVkZ2VycwogICAgZmluYWwgTGVkZ2VyTWFuYWdlciBh\nY3RpdmVMZWRnZXJNYW5hZ2VyOwoKICAgIGZpbmFsIGludCBvcGVuRmlsZUxp\nbWl0OwogICAgZmluYWwgaW50IHBhZ2VTaXplOwogICAgZmluYWwgaW50IHBh\nZ2VMaW1pdDsKICAgIGZpbmFsIGludCBlbnRyaWVzUGVyUGFnZTsKCiAgICAv\nKioKICAgICAqIEByZXR1cm4gcGFnZSBzaXplIHVzZWQgaW4gbGVkZ2VyIGNh\nY2hlCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0UGFnZVNpemUoKSB7CiAg\nICAgICAgcmV0dXJuIHBhZ2VTaXplOwogICAgfQoKICAgIC8qKgogICAgICog\nQHJldHVybiBlbnRyaWVzIHBlciBwYWdlIHVzZWQgaW4gbGVkZ2VyIGNhY2hl\nCiAgICAgKi8KICAgIHB1YmxpYyBpbnQgZ2V0RW50cmllc1BlclBhZ2UoKSB7\nCiAgICAgICAgcmV0dXJuIGVudHJpZXNQZXJQYWdlOwogICAgfQoKICAgIC8v\nIFRoZSBudW1iZXIgb2YgcGFnZXMgdGhhdCBoYXZlIGFjdHVhbGx5IGJlZW4g\ndXNlZAogICAgcHJpdmF0ZSBpbnQgcGFnZUNvdW50ID0gMDsKICAgIEhhc2hN\nYXA8TG9uZywgSGFzaE1hcDxMb25nLExlZGdlckVudHJ5UGFnZT4+IHBhZ2Vz\nID0gbmV3IEhhc2hNYXA8TG9uZywgSGFzaE1hcDxMb25nLExlZGdlckVudHJ5\nUGFnZT4+KCk7CgogICAgcHJpdmF0ZSB2b2lkIHB1dEludG9UYWJsZShIYXNo\nTWFwPExvbmcsIEhhc2hNYXA8TG9uZyxMZWRnZXJFbnRyeVBhZ2U+PiB0YWJs\nZSwgTGVkZ2VyRW50cnlQYWdlIGxlcCkgewogICAgICAgIEhhc2hNYXA8TG9u\nZywgTGVkZ2VyRW50cnlQYWdlPiBtYXAgPSB0YWJsZS5nZXQobGVwLmdldExl\nZGdlcigpKTsKICAgICAgICBpZiAobWFwID09IG51bGwpIHsKICAgICAgICAg\nICAgbWFwID0gbmV3IEhhc2hNYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdlPigp\nOwogICAgICAgICAgICB0YWJsZS5wdXQobGVwLmdldExlZGdlcigpLCBtYXAp\nOwogICAgICAgIH0KICAgICAgICBtYXAucHV0KGxlcC5nZXRGaXJzdEVudHJ5\nKCksIGxlcCk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgTGVkZ2VyRW50\ncnlQYWdlIGdldEZyb21UYWJsZShIYXNoTWFwPExvbmcsIEhhc2hNYXA8TG9u\nZyxMZWRnZXJFbnRyeVBhZ2U+PiB0YWJsZSwgTG9uZyBsZWRnZXIsIExvbmcg\nZmlyc3RFbnRyeSkgewogICAgICAgIEhhc2hNYXA8TG9uZywgTGVkZ2VyRW50\ncnlQYWdlPiBtYXAgPSB0YWJsZS5nZXQobGVkZ2VyKTsKICAgICAgICBpZiAo\nbWFwICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIG1hcC5nZXQoZmly\nc3RFbnRyeSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAg\nfQoKICAgIHN5bmNocm9uaXplZCBwcml2YXRlIExlZGdlckVudHJ5UGFnZSBn\nZXRMZWRnZXJFbnRyeVBhZ2UoTG9uZyBsZWRnZXIsIExvbmcgZmlyc3RFbnRy\neSwgYm9vbGVhbiBvbmx5RGlydHkpIHsKICAgICAgICBMZWRnZXJFbnRyeVBh\nZ2UgbGVwID0gZ2V0RnJvbVRhYmxlKHBhZ2VzLCBsZWRnZXIsIGZpcnN0RW50\ncnkpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChvbmx5RGlydHkg\nJiYgbGVwLmlzQ2xlYW4oKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGxlcDsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAobGVwICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGxlcC51c2VQYWdlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgcHV0RW50cnlP\nZmZzZXQobG9uZyBsZWRnZXIsIGxvbmcgZW50cnksIGxvbmcgb2Zmc2V0KSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGludCBvZmZzZXRJblBhZ2Ug\nPSAoaW50KSAoZW50cnkgJSBlbnRyaWVzUGVyUGFnZSk7CiAgICAgICAgLy8g\nZmluZCB0aGUgaWQgb2YgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBwYWdlIHRo\nYXQgaGFzIHRoZSBlbnRyeQogICAgICAgIC8vIHdlIGFyZSBsb29raW5nIGZv\ncgogICAgICAgIGxvbmcgcGFnZUVudHJ5ID0gZW50cnktb2Zmc2V0SW5QYWdl\nOwogICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRMZWRnZXJFbnRy\neVBhZ2UobGVkZ2VyLCBwYWdlRW50cnksIGZhbHNlKTsKICAgICAgICBpZiAo\nbGVwID09IG51bGwpIHsKICAgICAgICAgICAgLy8gZmluZCBhIGZyZWUgcGFn\nZQogICAgICAgICAgICBsZXAgPSBncmFiQ2xlYW5QYWdlKGxlZGdlciwgcGFn\nZUVudHJ5KTsKICAgICAgICAgICAgdXBkYXRlUGFnZShsZXApOwogICAgICAg\nICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgcHV0\nSW50b1RhYmxlKHBhZ2VzLCBsZXApOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGlmIChsZXAgIT0gbnVsbCkgewogICAgICAgICAgICBsZXAu\nc2V0T2Zmc2V0KG9mZnNldCwgb2Zmc2V0SW5QYWdlKjgpOwogICAgICAgICAg\nICBsZXAucmVsZWFzZVBhZ2UoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgbG9uZyBnZXRFbnRyeU9mZnNldChs\nb25nIGxlZGdlciwgbG9uZyBlbnRyeSkgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBpbnQgb2Zmc2V0SW5QYWdlID0gKGludCkgKGVudHJ5JWVudHJp\nZXNQZXJQYWdlKTsKICAgICAgICAvLyBmaW5kIHRoZSBpZCBvZiB0aGUgZmly\nc3QgZW50cnkgb2YgdGhlIHBhZ2UgdGhhdCBoYXMgdGhlIGVudHJ5CiAgICAg\nICAgLy8gd2UgYXJlIGxvb2tpbmcgZm9yCiAgICAgICAgbG9uZyBwYWdlRW50\ncnkgPSBlbnRyeS1vZmZzZXRJblBhZ2U7CiAgICAgICAgTGVkZ2VyRW50cnlQ\nYWdlIGxlcCA9IGdldExlZGdlckVudHJ5UGFnZShsZWRnZXIsIHBhZ2VFbnRy\neSwgZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChsZXAg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgbGVwID0gZ3JhYkNsZWFuUGFn\nZShsZWRnZXIsIHBhZ2VFbnRyeSk7CiAgICAgICAgICAgICAgICBzeW5jaHJv\nbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgICAgIHB1dEludG9UYWJs\nZShwYWdlcywgbGVwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHVwZGF0ZVBhZ2UobGVwKTsKCiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIGxlcC5nZXRPZmZzZXQob2Zmc2V0SW5QYWdlKjgpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChsZXAgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgbGVwLnJlbGVhc2VQYWdlKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGZpbmFsIHByaXZh\ndGUgU3RyaW5nIGdldExlZGdlck5hbWUobG9uZyBsZWRnZXJJZCkgewogICAg\nICAgIGludCBwYXJlbnQgPSAoaW50KSAobGVkZ2VySWQgJiAweGZmKTsKICAg\nICAgICBpbnQgZ3JhbmRQYXJlbnQgPSAoaW50KSAoKGxlZGdlcklkICYgMHhm\nZjAwKSA+PiA4KTsKICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0\ncmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5hcHBlbmQoSW50ZWdlci50b0hl\neFN0cmluZyhncmFuZFBhcmVudCkpOwogICAgICAgIHNiLmFwcGVuZCgnLycp\nOwogICAgICAgIHNiLmFwcGVuZChJbnRlZ2VyLnRvSGV4U3RyaW5nKHBhcmVu\ndCkpOwogICAgICAgIHNiLmFwcGVuZCgnLycpOwogICAgICAgIHNiLmFwcGVu\nZChMb25nLnRvSGV4U3RyaW5nKGxlZGdlcklkKSk7CiAgICAgICAgc2IuYXBw\nZW5kKCIuaWR4Iik7CiAgICAgICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAg\nICB9CgogICAgc3RhdGljIGZpbmFsIHByaXZhdGUgdm9pZCBjaGVja1BhcmVu\ndHMoRmlsZSBmKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIEZpbGUg\ncGFyZW50ID0gZi5nZXRQYXJlbnRGaWxlKCk7CiAgICAgICAgaWYgKHBhcmVu\ndC5leGlzdHMoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQog\nICAgICAgIGlmIChwYXJlbnQubWtkaXJzKCkgPT0gZmFsc2UpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJDb3VubGRuJ3QgbWtkaXJz\nIGZvciAiICsgcGFyZW50KTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGlj\nIGZpbmFsIHByaXZhdGUgUmFuZG9tIHJhbmQgPSBuZXcgUmFuZG9tKCk7Cgog\nICAgc3RhdGljIGZpbmFsIHByaXZhdGUgRmlsZSBwaWNrRGlycyhGaWxlIGRp\ncnNbXSkgewogICAgICAgIHJldHVybiBkaXJzW3JhbmQubmV4dEludChkaXJz\nLmxlbmd0aCldOwogICAgfQoKICAgIEZpbGVJbmZvIGdldEZpbGVJbmZvKExv\nbmcgbGVkZ2VyLCBib29sZWFuIGNyZWF0ZSkgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICBzeW5jaHJvbml6ZWQoZmlsZUluZm9DYWNoZSkgewogICAg\nICAgICAgICBGaWxlSW5mbyBmaSA9IGZpbGVJbmZvQ2FjaGUuZ2V0KGxlZGdl\ncik7CiAgICAgICAgICAgIGlmIChmaSA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgbGVkZ2VyTmFtZSA9IGdldExlZGdlck5hbWUobGVkZ2Vy\nKTsKICAgICAgICAgICAgICAgIEZpbGUgbGYgPSBudWxsOwogICAgICAgICAg\nICAgICAgZm9yKEZpbGUgZDogbGVkZ2VyRGlyZWN0b3JpZXMpIHsKICAgICAg\nICAgICAgICAgICAgICBsZiA9IG5ldyBGaWxlKGQsIGxlZGdlck5hbWUpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChsZi5leGlzdHMoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgbGYgPSBudWxsOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgaWYgKGxmID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAoIWNyZWF0ZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgQm9va2llLk5vTGVkZ2VyRXhjZXB0aW9uKGxl\nZGdlcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIEZpbGUgZGlyID0gcGlja0RpcnMobGVkZ2VyRGlyZWN0b3JpZXMpOwog\nICAgICAgICAgICAgICAgICAgIGxmID0gbmV3IEZpbGUoZGlyLCBsZWRnZXJO\nYW1lKTsKICAgICAgICAgICAgICAgICAgICBjaGVja1BhcmVudHMobGYpOwog\nICAgICAgICAgICAgICAgICAgIC8vIEEgbmV3IGxlZGdlciBpbmRleCBmaWxl\nIGhhcyBiZWVuIGNyZWF0ZWQgZm9yIHRoaXMgQm9va2llLgogICAgICAgICAg\nICAgICAgICAgIC8vIEFkZCB0aGlzIG5ldyBsZWRnZXIgdG8gdGhlIHNldCBv\nZiBhY3RpdmUgbGVkZ2Vycy4KICAgICAgICAgICAgICAgICAgICBpZiAoTE9H\nLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLmRlYnVnKCJOZXcgbGVkZ2VyIGluZGV4IGZpbGUgY3JlYXRlZCBmb3Ig\nbGVkZ2VySWQ6ICIgKyBsZWRnZXIpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICBhY3RpdmVMZWRnZXJNYW5hZ2VyLmFkZEFj\ndGl2ZUxlZGdlcihsZWRnZXIsIHRydWUpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgaWYgKG9wZW5MZWRnZXJzLnNpemUoKSA+IG9wZW5G\naWxlTGltaXQpIHsKICAgICAgICAgICAgICAgICAgICBmaWxlSW5mb0NhY2hl\nLnJlbW92ZShvcGVuTGVkZ2Vycy5yZW1vdmVGaXJzdCgpKS5jbG9zZSgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZmkgPSBuZXcgRmls\nZUluZm8obGYpOwogICAgICAgICAgICAgICAgZmlsZUluZm9DYWNoZS5wdXQo\nbGVkZ2VyLCBmaSk7CiAgICAgICAgICAgICAgICBvcGVuTGVkZ2Vycy5hZGQo\nbGVkZ2VyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmkgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgZmkudXNlKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcmV0dXJuIGZpOwogICAgICAgIH0KICAgIH0KICAg\nIHByaXZhdGUgdm9pZCB1cGRhdGVQYWdlKExlZGdlckVudHJ5UGFnZSBsZXAp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFsZXAuaXNDbGVh\nbigpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiVHJ5\naW5nIHRvIHVwZGF0ZSBhIGRpcnR5IHBhZ2UiKTsKICAgICAgICB9CiAgICAg\nICAgRmlsZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZpID0gZ2V0RmlsZUluZm8obGVwLmdldExlZGdlcigpLCB0cnVlKTsK\nICAgICAgICAgICAgbG9uZyBwb3MgPSBsZXAuZ2V0Rmlyc3RFbnRyeSgpKjg7\nCiAgICAgICAgICAgIGlmIChwb3MgPj0gZmkuc2l6ZSgpKSB7CiAgICAgICAg\nICAgICAgICBsZXAuemVyb1BhZ2UoKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIGxlcC5yZWFkUGFnZShmaSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoZmkgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgZmkucmVsZWFzZSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgZmx1c2hMZWRnZXIo\nYm9vbGVhbiBkb0FsbCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBz\neW5jaHJvbml6ZWQoZGlydHlMZWRnZXJzKSB7CiAgICAgICAgICAgIGlmIChk\naXJ0eUxlZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBzeW5j\naHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgICAgIGZvcihMb25n\nIGw6IHBhZ2VzLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLnRyYWNlKCJBZGRpbmcgIiArIExvbmcudG9IZXhT\ndHJpbmcobCkgKyAiIHRvIGRpcnR5IHBhZ2VzIik7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZGlydHlMZWRn\nZXJzLmFkZChsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGRpcnR5TGVk\nZ2Vycy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSghZGlydHlMZWRnZXJzLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgTG9uZyBsID0gZGlydHlMZWRn\nZXJzLnJlbW92ZUZpcnN0KCk7CiAgICAgICAgICAgICAgICBMaW5rZWRMaXN0\nPExvbmc+IGZpcnN0RW50cnlMaXN0OwogICAgICAgICAgICAgICAgc3luY2hy\nb25pemVkKHRoaXMpIHsKICAgICAgICAgICAgICAgICAgICBIYXNoTWFwPExv\nbmcsIExlZGdlckVudHJ5UGFnZT4gcGFnZU1hcCA9IHBhZ2VzLmdldChsKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAocGFnZU1hcCA9PSBudWxsIHx8IHBh\nZ2VNYXAuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNv\nbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBmaXJzdEVudHJ5TGlzdCA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7\nCiAgICAgICAgICAgICAgICAgICAgZm9yKE1hcC5FbnRyeTxMb25nLCBMZWRn\nZXJFbnRyeVBhZ2U+IGVudHJ5OiBwYWdlTWFwLmVudHJ5U2V0KCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGVu\ndHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChs\nZXAuaXNDbGVhbigpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cudHJhY2UoIlBhZ2UgaXMgY2xlYW4gIiArIGxl\ncCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBmaXJzdEVudHJ5TGlz\ndC5hZGQobGVwLmdldEZpcnN0RW50cnkoKSk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gTm93\nIGZsdXNoIGFsbCB0aGUgcGFnZXMgb2YgYSBsZWRnZXIKICAgICAgICAgICAg\nICAgIExpc3Q8TGVkZ2VyRW50cnlQYWdlPiBlbnRyaWVzID0gbmV3IEFycmF5\nTGlzdDxMZWRnZXJFbnRyeVBhZ2U+KGZpcnN0RW50cnlMaXN0LnNpemUoKSk7\nCiAgICAgICAgICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGZvcihMb25nIGZp\ncnN0RW50cnk6IGZpcnN0RW50cnlMaXN0KSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRMZWRnZXJFbnRyeVBh\nZ2UobCwgZmlyc3RFbnRyeSwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChsZXAgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZW50cmllcy5hZGQobGVwKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBDb2xsZWN0aW9ucy5zb3J0KGVudHJpZXMsIG5ldyBDb21wYXJhdG9yPExl\nZGdlckVudHJ5UGFnZT4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgaW50IGNv\nbXBhcmUoTGVkZ2VyRW50cnlQYWdlIG8xLCBMZWRnZXJFbnRyeVBhZ2UgbzIp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoaW50KShv\nMS5nZXRGaXJzdEVudHJ5KCktbzIuZ2V0Rmlyc3RFbnRyeSgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwog\nICAgICAgICAgICAgICAgICAgIEFycmF5TGlzdDxJbnRlZ2VyPiB2ZXJzaW9u\ncyA9IG5ldyBBcnJheUxpc3Q8SW50ZWdlcj4oZW50cmllcy5zaXplKCkpOwog\nICAgICAgICAgICAgICAgICAgIGZpID0gZ2V0RmlsZUluZm8obCwgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgaW50IHN0YXJ0ID0gMDsKICAgICAgICAg\nICAgICAgICAgICBsb25nIGxhc3RPZmZzZXQgPSAtMTsKICAgICAgICAgICAg\nICAgICAgICBmb3IoaW50IGkgPSAwOyBpIDwgZW50cmllcy5zaXplKCk7IGkr\nKykgewogICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9ucy5hZGQoaSwg\nZW50cmllcy5nZXQoaSkuZ2V0VmVyc2lvbigpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKGxhc3RPZmZzZXQgIT0gLTEgJiYgKGVudHJpZXMuZ2V0\nKGkpLmdldEZpcnN0RW50cnkoKSAtIGxhc3RPZmZzZXQpICE9IGVudHJpZXNQ\nZXJQYWdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZW5k\nIHVwIGEgc2VxdWVudGlhbCBsaXN0CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpbnQgY291bnQgPSBpIC0gc3RhcnQ7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoY291bnQgPT0gMCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiQ291bnQgY2Fu\nbm90IHBvc3NpYmx5IGJlIHplcm8hIik7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUJ1\nZmZlcnMobCwgZW50cmllcywgZmksIHN0YXJ0LCBjb3VudCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzdGFydCA9IGk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE9mZnNl\ndCA9IGVudHJpZXMuZ2V0KGkpLmdldEZpcnN0RW50cnkoKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJpZXMu\nc2l6ZSgpLXN0YXJ0ID09IDAgJiYgZW50cmllcy5zaXplKCkgIT0gMCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIk5v\ndGhpbmcgdG8gd3JpdGUsIGJ1dCB0aGVyZSB3ZXJlIGVudHJpZXMhIik7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHdyaXRl\nQnVmZmVycyhsLCBlbnRyaWVzLCBmaSwgc3RhcnQsIGVudHJpZXMuc2l6ZSgp\nLXN0YXJ0KTsKICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQodGhp\ncykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IoaW50IGkgPSAwOyBp\nIDwgZW50cmllcy5zaXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGVudHJpZXMuZ2V0KGkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVwLnNldENsZWFuKHZl\ncnNpb25zLmdldChpKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgICAgIGZvcihMZWRnZXJFbnRyeVBhZ2UgbGVw\nOiBlbnRyaWVzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlcC5yZWxl\nYXNlUGFnZSgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBpZiAoZmkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBmaS5yZWxlYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFkb0FsbCkgewog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgLy8gWWVpbGQuIGlmIHdlIGFyZSBkb2luZyBhbGwg\ndGhlIGxlZGdlcnMgd2UgZG9uJ3Qgd2FudCB0byBibG9jayBvdGhlciBmbHVz\naGVzIHRoYXQKICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gaGFwcGVuCiAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGRpcnR5\nTGVkZ2Vycy53YWl0KDEpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50\nZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIC8v\nIGp1c3QgcGFzcyBpdCBvbgogICAgICAgICAgICAgICAgICAgIFRocmVhZC5j\ndXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIHdyaXRlQnVmZmVycyhMb25nIGxlZGdlciwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgTGlzdDxMZWRnZXJFbnRyeVBhZ2U+IGVudHJpZXMs\nIEZpbGVJbmZvIGZpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nbnQgc3RhcnQsIGludCBjb3VudCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nTE9HLnRyYWNlKCJXcml0aW5nICIgKyBjb3VudCArICIgYnVmZmVycyBvZiAi\nICsgTG9uZy50b0hleFN0cmluZyhsZWRnZXIpKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgLy9TeXN0ZW0ub3V0\nLnByaW50bG4oIkNvdW50IGlzIHplcm8hIik7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CiAgICAgICAgQnl0ZUJ1ZmZlciBidWZmc1tdID0gbmV3\nIEJ5dGVCdWZmZXJbY291bnRdOwogICAgICAgIGZvcihpbnQgaiA9IDA7IGog\nPCBjb3VudDsgaisrKSB7CiAgICAgICAgICAgIGJ1ZmZzW2pdID0gZW50cmll\ncy5nZXQoc3RhcnQraikuZ2V0UGFnZVRvV3JpdGUoKTsKICAgICAgICAgICAg\naWYgKGVudHJpZXMuZ2V0KHN0YXJ0K2opLmdldExlZGdlcigpICE9IGxlZGdl\ncikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJX\ncml0aW5nIHRvICIgKyBsZWRnZXIgKyAiIGJ1dCBwYWdlIGJlbG9uZ3MgdG8g\nIiArIGVudHJpZXMuZ2V0KHN0YXJ0K2opLmdldExlZGdlcigpKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBsb25nIHRvdGFsV3JpdHRlbiA9\nIDA7CiAgICAgICAgd2hpbGUoYnVmZnNbYnVmZnMubGVuZ3RoLTFdLnJlbWFp\nbmluZygpID4gMCkgewogICAgICAgICAgICBsb25nIHJjID0gZmkud3JpdGUo\nYnVmZnMsIGVudHJpZXMuZ2V0KHN0YXJ0KzApLmdldEZpcnN0RW50cnkoKSo4\nKTsKICAgICAgICAgICAgaWYgKHJjIDw9IDApIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiU2hvcnQgd3JpdGUgdG8gbGVkZ2Vy\nICIgKyBsZWRnZXIgKyAiIHJjID0gIiArIHJjKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAvL1N5c3RlbS5vdXQucHJpbnRsbigiV3JvdGUgIiArIHJj\nICsgIiB0byAiICsgbGVkZ2VyKTsKICAgICAgICAgICAgdG90YWxXcml0dGVu\nICs9IHJjOwogICAgICAgIH0KICAgICAgICBpZiAodG90YWxXcml0dGVuICE9\nIGNvdW50ICogcGFnZVNpemUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElP\nRXhjZXB0aW9uKCJTaG9ydCB3cml0ZSB0byBsZWRnZXIgIiArIGxlZGdlciAr\nICIgd3JvdGUgIiArIHRvdGFsV3JpdHRlbiArICIgZXhwZWN0ZWQgIiArIGNv\ndW50ICogcGFnZVNpemUpOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUg\nTGVkZ2VyRW50cnlQYWdlIGdyYWJDbGVhblBhZ2UobG9uZyBsZWRnZXIsIGxv\nbmcgZW50cnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGVu\ndHJ5ICUgZW50cmllc1BlclBhZ2UgIT0gMCkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGVudHJ5ICsgIiBpcyBu\nb3QgYSBtdWx0aXBsZSBvZiAiICsgZW50cmllc1BlclBhZ2UpOwogICAgICAg\nIH0KICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICBp\nZiAocGFnZUNvdW50ICA8IHBhZ2VMaW1pdCkgewogICAgICAgICAgICAgICAg\nLy8gbGV0J3Mgc2VlIGlmIHdlIGNhbiBhbGxvY2F0ZSBzb21ldGhpbmcKICAg\nICAgICAgICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBuZXcgTGVkZ2Vy\nRW50cnlQYWdlKHBhZ2VTaXplLCBlbnRyaWVzUGVyUGFnZSk7CiAgICAgICAg\nICAgICAgICBsZXAuc2V0TGVkZ2VyKGxlZGdlcik7CiAgICAgICAgICAgICAg\nICBsZXAuc2V0Rmlyc3RFbnRyeShlbnRyeSk7CiAgICAgICAgICAgICAgICAv\nLyBub3RlLCB0aGlzIHdpbGwgbm90IGJsb2NrIHNpbmNlIGl0IGlzIGEgbmV3\nIHBhZ2UKICAgICAgICAgICAgICAgIGxlcC51c2VQYWdlKCk7CiAgICAgICAg\nICAgICAgICBwYWdlQ291bnQrKzsKICAgICAgICAgICAgICAgIHJldHVybiBs\nZXA7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG91dGVyTG9v\ncDoKICAgICAgICB3aGlsZSh0cnVlKSB7CiAgICAgICAgICAgIHN5bmNocm9u\naXplZChjbGVhbkxlZGdlcnMpIHsKICAgICAgICAgICAgICAgIGlmIChjbGVh\nbkxlZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgZmx1\nc2hMZWRnZXIoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIHN5bmNocm9u\naXplZCh0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcihMb25n\nIGw6IHBhZ2VzLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBjbGVhbkxlZGdlcnMuYWRkKGwpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAg\nICAgICAgICAgICAgICBMb25nIGNsZWFuTGVkZ2VyID0gY2xlYW5MZWRnZXJz\nLmdldEZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgTWFwPExvbmcsIExl\nZGdlckVudHJ5UGFnZT4gbWFwID0gcGFnZXMuZ2V0KGNsZWFuTGVkZ2VyKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAobWFwID09IG51bGwgfHwgbWFwLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjbGVhbkxlZGdl\ncnMucmVtb3ZlRmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIEl0ZXJhdG9yPE1hcC5FbnRyeTxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+\nPiBpdCA9IG1hcC5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgICAg\nICAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGl0Lm5leHQoKS5nZXRW\nYWx1ZSgpOwogICAgICAgICAgICAgICAgICAgIHdoaWxlKChsZXAuaW5Vc2Uo\nKSB8fCAhbGVwLmlzQ2xlYW4oKSkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKCFpdC5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbnRpbnVlIG91dGVyTG9vcDsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBsZXAgPSBpdC5uZXh0\nKCkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgaXQucmVtb3ZlKCk7CiAgICAgICAgICAgICAgICAgICAg\naWYgKG1hcC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncGFnZXMucmVtb3ZlKGxlcC5nZXRMZWRnZXIoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxlcC51c2VQYWdlKCk7CiAg\nICAgICAgICAgICAgICAgICAgbGVwLnplcm9QYWdlKCk7CiAgICAgICAgICAg\nICAgICAgICAgbGVwLnNldExlZGdlcihsZWRnZXIpOwogICAgICAgICAgICAg\nICAgICAgIGxlcC5zZXRGaXJzdEVudHJ5KGVudHJ5KTsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gbGVwOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBsb25nIGdldExh\nc3RFbnRyeShsb25nIGxlZGdlcklkKSB7CiAgICAgICAgbG9uZyBsYXN0RW50\ncnkgPSAwOwogICAgICAgIC8vIEZpbmQgdGhlIGxhc3QgZW50cnkgaW4gdGhl\nIGNhY2hlCiAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAg\nICAgTWFwPExvbmcsIExlZGdlckVudHJ5UGFnZT4gbWFwID0gcGFnZXMuZ2V0\nKGxlZGdlcklkKTsKICAgICAgICAgICAgaWYgKG1hcCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBmb3IoTGVkZ2VyRW50cnlQYWdlIGxlcDogbWFwLnZh\nbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxlcC5nZXRGaXJz\ndEVudHJ5KCkgKyBlbnRyaWVzUGVyUGFnZSA8IGxhc3RFbnRyeSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgbGVwLnVzZVBhZ2UoKTsKICAg\nICAgICAgICAgICAgICAgICBsb25nIGhpZ2hlc3QgPSBsZXAuZ2V0TGFzdEVu\ndHJ5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGhpZ2hlc3QgPiBsYXN0\nRW50cnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdEVudHJ5ID0g\naGlnaGVzdDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgbGVwLnJlbGVhc2VQYWdlKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBsYXN0RW50\ncnk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCB3aWxsIGxv\nb2sgd2l0aGluIHRoZSBsZWRnZXIgZGlyZWN0b3JpZXMgZm9yIHRoZSBsZWRn\nZXIgaW5kZXgKICAgICAqIGZpbGVzLiBUaGF0IHdpbGwgY29tcHJpc2UgdGhl\nIHNldCBvZiBhY3RpdmUgbGVkZ2VycyB0aGlzIHBhcnRpY3VsYXIKICAgICAq\nIEJvb2tpZVNlcnZlciBrbm93cyBhYm91dCB0aGF0IGhhdmUgbm90IHlldCBi\nZWVuIGRlbGV0ZWQgYnkgdGhlIEJvb2tLZWVwZXIKICAgICAqIENsaWVudC4g\nVGhpcyBpcyBjYWxsZWQgb25seSBvbmNlIGR1cmluZyBpbml0aWFsaXphdGlv\nbi4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGdldEFjdGl2ZUxlZGdlcnMo\nKSB7CiAgICAgICAgLy8gTGVkZ2VyIGluZGV4IGZpbGVzIGFyZSBzdG9yZWQg\naW4gYSBmaWxlIGhpZXJhcmNoeSB3aXRoIGEgcGFyZW50IGFuZAogICAgICAg\nIC8vIGdyYW5kUGFyZW50IGRpcmVjdG9yeS4gV2UnbGwgaGF2ZSB0byBnbyB0\nd28gbGV2ZWxzIGRlZXAgaW50byB0aGVzZQogICAgICAgIC8vIGRpcmVjdG9y\naWVzIHRvIGZpbmQgdGhlIGluZGV4IGZpbGVzLgogICAgICAgIGZvciAoRmls\nZSBsZWRnZXJEaXJlY3RvcnkgOiBsZWRnZXJEaXJlY3RvcmllcykgewogICAg\nICAgICAgICBmb3IgKEZpbGUgZ3JhbmRQYXJlbnQgOiBsZWRnZXJEaXJlY3Rv\ncnkubGlzdEZpbGVzKCkpIHsKICAgICAgICAgICAgICAgIGlmIChncmFuZFBh\ncmVudC5pc0RpcmVjdG9yeSgpKSB7CiAgICAgICAgICAgICAgICAgICAgZm9y\nIChGaWxlIHBhcmVudCA6IGdyYW5kUGFyZW50Lmxpc3RGaWxlcygpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJlbnQuaXNEaXJlY3Rvcnko\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChGaWxlIGlu\nZGV4IDogcGFyZW50Lmxpc3RGaWxlcygpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKCFpbmRleC5pc0ZpbGUoKSB8fCAhaW5kZXgu\nZ2V0TmFtZSgpLmVuZHNXaXRoKCIuaWR4IikpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIFdlJ3ZlIGZvdW5kIGEgbGVkZ2VyIGluZGV4IGZpbGUuIFRo\nZSBmaWxlIG5hbWUgaXMgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gSGV4U3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBsZWRn\nZXJJZC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcg\nbGVkZ2VySWRJbkhleCA9IGluZGV4LmdldE5hbWUoKS5zdWJzdHJpbmcoMCwg\naW5kZXguZ2V0TmFtZSgpLmxlbmd0aCgpIC0gNCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYWN0aXZlTGVkZ2VyTWFuYWdlci5hZGRBY3Rp\ndmVMZWRnZXIoTG9uZy5wYXJzZUxvbmcobGVkZ2VySWRJbkhleCwgMTYpLCB0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aGVuZXZlciBh\nIGxlZGdlciBpcyBkZWxldGVkIGJ5IHRoZSBCb29rS2VlcGVyIENsaWVudAog\nICAgICogYW5kIHdlIHdhbnQgdG8gcmVtb3ZlIGFsbCByZWxldmFudCBkYXRh\nIGZvciBpdCBzdG9yZWQgaW4gdGhlIExlZGdlckNhY2hlLgogICAgICovCiAg\nICB2b2lkIGRlbGV0ZUxlZGdlcihsb25nIGxlZGdlcklkKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkK\nICAgICAgICAgICAgTE9HLmRlYnVnKCJEZWxldGluZyBsZWRnZXJJZDogIiAr\nIGxlZGdlcklkKTsKICAgICAgICAvLyBEZWxldGUgdGhlIGxlZGdlcidzIGlu\nZGV4IGZpbGUgYW5kIGNsb3NlIHRoZSBGaWxlSW5mbwogICAgICAgIEZpbGVJ\nbmZvIGZpID0gZ2V0RmlsZUluZm8obGVkZ2VySWQsIGZhbHNlKTsKICAgICAg\nICBmaS5nZXRGaWxlKCkuZGVsZXRlKCk7CiAgICAgICAgZmkuY2xvc2UoKTsK\nCiAgICAgICAgLy8gUmVtb3ZlIGl0IGZyb20gdGhlIGFjdGl2ZSBsZWRnZXIg\nbWFuYWdlcgogICAgICAgIGFjdGl2ZUxlZGdlck1hbmFnZXIucmVtb3ZlQWN0\naXZlTGVkZ2VyKGxlZGdlcklkKTsKCiAgICAgICAgLy8gTm93IHJlbW92ZSBp\ndCBmcm9tIGFsbCB0aGUgb3RoZXIgbGlzdHMgYW5kIG1hcHMuCiAgICAgICAg\nLy8gVGhlc2UgZGF0YSBzdHJ1Y3R1cmVzIG5lZWQgdG8gYmUgc3luY2hyb25p\nemVkIGZpcnN0IGJlZm9yZSByZW1vdmluZyBlbnRyaWVzLgogICAgICAgIHN5\nbmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAgIHBhZ2VzLnJlbW92ZShs\nZWRnZXJJZCk7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXplZChmaWxl\nSW5mb0NhY2hlKSB7CiAgICAgICAgICAgIGZpbGVJbmZvQ2FjaGUucmVtb3Zl\nKGxlZGdlcklkKTsKICAgICAgICB9CiAgICAgICAgc3luY2hyb25pemVkKGNs\nZWFuTGVkZ2VycykgewogICAgICAgICAgICBjbGVhbkxlZGdlcnMucmVtb3Zl\nKGxlZGdlcklkKTsKICAgICAgICB9CiAgICAgICAgc3luY2hyb25pemVkKGRp\ncnR5TGVkZ2VycykgewogICAgICAgICAgICBkaXJ0eUxlZGdlcnMucmVtb3Zl\nKGxlZGdlcklkKTsKICAgICAgICB9CiAgICAgICAgc3luY2hyb25pemVkKG9w\nZW5MZWRnZXJzKSB7CiAgICAgICAgICAgIG9wZW5MZWRnZXJzLnJlbW92ZShs\nZWRnZXJJZCk7CiAgICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

