{"sha":"728d729911171bc8554c600e231fa48c2e8627bc","node_id":"MDQ6QmxvYjE1NzU5NTY6NzI4ZDcyOTkxMTE3MWJjODU1NGM2MDBlMjMxZmE0OGMyZTg2MjdiYw==","size":4561,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/728d729911171bc8554c600e231fa48c2e8627bc","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmlvLkJ5\ndGVCdWZmZXI7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKCgovKioKICogSW1wbGVtZW50cyBh\nIGxlZGdlciBpbnNpZGUgYSBib29raWUuIEluIHBhcnRpY3VsYXIsIGl0IGlt\ncGxlbWVudHMgb3BlcmF0aW9ucwogKiB0byB3cml0ZSBlbnRyaWVzIHRvIGEg\nbGVkZ2VyIGFuZCByZWFkIGVudHJpZXMgZnJvbSBhIGxlZGdlci4KICoKICov\nCnB1YmxpYyBjbGFzcyBMZWRnZXJEZXNjcmlwdG9yIHsKICAgIGZpbmFsIHN0\nYXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTGVk\nZ2VyRGVzY3JpcHRvci5jbGFzcyk7CiAgICBMZWRnZXJDYWNoZSBsZWRnZXJD\nYWNoZTsKICAgIExlZGdlckRlc2NyaXB0b3IobG9uZyBsZWRnZXJJZCwgRW50\ncnlMb2dnZXIgZW50cnlMb2dnZXIsIExlZGdlckNhY2hlIGxlZGdlckNhY2hl\nKSB7CiAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAgICAg\nIHRoaXMuZW50cnlMb2dnZXIgPSBlbnRyeUxvZ2dlcjsKICAgICAgICB0aGlz\nLmxlZGdlckNhY2hlID0gbGVkZ2VyQ2FjaGU7CiAgICB9CgogICAgcHJpdmF0\nZSBCeXRlQnVmZmVyIG1hc3RlcktleSA9IG51bGw7CiAgICB2b2xhdGlsZSBw\ncml2YXRlIGJvb2xlYW4gZmVuY2VkID0gZmFsc2U7CgogICAgdm9pZCBzZXRN\nYXN0ZXJLZXkoQnl0ZUJ1ZmZlciBtYXN0ZXJLZXkpIHsKICAgICAgICB0aGlz\nLm1hc3RlcktleSA9IG1hc3RlcktleTsKICAgIH0KCiAgICBib29sZWFuIGNt\ncE1hc3RlcktleShCeXRlQnVmZmVyIG1hc3RlcktleSkgewogICAgICAgIHJl\ndHVybiB0aGlzLm1hc3RlcktleS5lcXVhbHMobWFzdGVyS2V5KTsKICAgIH0K\nCiAgICBwcml2YXRlIGxvbmcgbGVkZ2VySWQ7CiAgICBwdWJsaWMgbG9uZyBn\nZXRMZWRnZXJJZCgpIHsKICAgICAgICByZXR1cm4gbGVkZ2VySWQ7CiAgICB9\nCgogICAgRW50cnlMb2dnZXIgZW50cnlMb2dnZXI7CiAgICBwcml2YXRlIGlu\ndCByZWZDbnQ7CiAgICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQgaW5jUmVm\nKCkgewogICAgICAgIHJlZkNudCsrOwogICAgfQogICAgc3luY2hyb25pemVk\nIHB1YmxpYyB2b2lkIGRlY1JlZigpIHsKICAgICAgICByZWZDbnQtLTsKICAg\nIH0KICAgIHN5bmNocm9uaXplZCBwdWJsaWMgaW50IGdldFJlZkNudCgpIHsK\nICAgICAgICByZXR1cm4gcmVmQ250OwogICAgfQogICAgCiAgICB2b2lkIHNl\ndEZlbmNlZCgpIHsKICAgICAgICBmZW5jZWQgPSB0cnVlOwogICAgfQogICAg\nCiAgICBib29sZWFuIGlzRmVuY2VkKCkgewogICAgICAgIHJldHVybiBmZW5j\nZWQ7CiAgICB9CgogICAgbG9uZyBhZGRFbnRyeShCeXRlQnVmZmVyIGVudHJ5\nKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGxvbmcgbGVkZ2VySWQg\nPSBlbnRyeS5nZXRMb25nKCk7CgogICAgICAgIGlmIChsZWRnZXJJZCAhPSB0\naGlzLmxlZGdlcklkKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbigiRW50cnkgZm9yIGxlZGdlciAiICsgbGVkZ2VySWQgKyAiIHdhcyBz\nZW50IHRvICIgKyB0aGlzLmxlZGdlcklkKTsKICAgICAgICB9CiAgICAgICAg\nbG9uZyBlbnRyeUlkID0gZW50cnkuZ2V0TG9uZygpOwogICAgICAgIGVudHJ5\nLnJld2luZCgpOwoKICAgICAgICAvKgogICAgICAgICAqIExvZyB0aGUgZW50\ncnkKICAgICAgICAgKi8KICAgICAgICBsb25nIHBvcyA9IGVudHJ5TG9nZ2Vy\nLmFkZEVudHJ5KGxlZGdlcklkLCBlbnRyeSk7CgoKICAgICAgICAvKgogICAg\nICAgICAqIFNldCBvZmZzZXQgb2YgZW50cnkgaWQgdG8gYmUgdGhlIGN1cnJl\nbnQgbGVkZ2VyIHBvc2l0aW9uCiAgICAgICAgICovCiAgICAgICAgbGVkZ2Vy\nQ2FjaGUucHV0RW50cnlPZmZzZXQobGVkZ2VySWQsIGVudHJ5SWQsIHBvcyk7\nCiAgICAgICAgcmV0dXJuIGVudHJ5SWQ7CiAgICB9CiAgICBCeXRlQnVmZmVy\nIHJlYWRFbnRyeShsb25nIGVudHJ5SWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgbG9uZyBvZmZzZXQ7CiAgICAgICAgLyoKICAgICAgICAgKiBJ\nZiBlbnRyeUlkIGlzIC0xLCB0aGVuIHJldHVybiB0aGUgbGFzdCB3cml0dGVu\nLgogICAgICAgICAqLwogICAgICAgIGlmIChlbnRyeUlkID09IC0xKSB7CiAg\nICAgICAgICAgIGxvbmcgbGFzdEVudHJ5ID0gbGVkZ2VyQ2FjaGUuZ2V0TGFz\ndEVudHJ5KGxlZGdlcklkKTsKICAgICAgICAgICAgRmlsZUluZm8gZmkgPSBu\ndWxsOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmkgPSBs\nZWRnZXJDYWNoZS5nZXRGaWxlSW5mbyhsZWRnZXJJZCwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgbG9uZyBzaXplID0gZmkuc2l6ZSgpOwogICAgICAgICAg\nICAgICAgLy8gd2UgbWF5IG5vdCBoYXZlIHRoZSBsYXN0IGVudHJ5IGluIHRo\nZSBjYWNoZQogICAgICAgICAgICAgICAgaWYgKHNpemUgPiBsYXN0RW50cnkq\nOCkgewogICAgICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRl\nQnVmZmVyLmFsbG9jYXRlKGxlZGdlckNhY2hlLmdldFBhZ2VTaXplKCkpOwog\nICAgICAgICAgICAgICAgICAgIGxvbmcgcG9zaXRpb24gPSBzaXplIC0gbGVk\nZ2VyQ2FjaGUuZ2V0UGFnZVNpemUoKTsKICAgICAgICAgICAgICAgICAgICBp\nZiAocG9zaXRpb24gPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHBv\nc2l0aW9uID0gMDsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgZmkucmVhZChiYiwgcG9zaXRpb24pOwogICAgICAgICAgICAg\nICAgICAgIGJiLmZsaXAoKTsKICAgICAgICAgICAgICAgICAgICBsb25nIHN0\nYXJ0aW5nRW50cnlJZCA9IHBvc2l0aW9uLzg7CiAgICAgICAgICAgICAgICAg\nICAgZm9yKGludCBpID0gbGVkZ2VyQ2FjaGUuZ2V0RW50cmllc1BlclBhZ2Uo\nKS0xOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoYmIuZ2V0TG9uZyhpKjgpICE9IDApIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChsYXN0RW50cnkgPCBzdGFydGluZ0VudHJ5SWQraSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RFbnRyeSA9\nIHN0YXJ0aW5nRW50cnlJZCtpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICBpZiAoZmkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgIGZpLnJlbGVhc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICBlbnRyeUlkID0gbGFzdEVudHJ5OwogICAgICAg\nIH0KCiAgICAgICAgb2Zmc2V0ID0gbGVkZ2VyQ2FjaGUuZ2V0RW50cnlPZmZz\nZXQobGVkZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIGlmIChvZmZzZXQgPT0g\nMCkgewogICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llLk5vRW50cnlFeGNl\ncHRpb24obGVkZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gQnl0ZUJ1ZmZlci53cmFwKGVudHJ5TG9nZ2VyLnJlYWRFbnRyeShs\nZWRnZXJJZCwgZW50cnlJZCwgb2Zmc2V0KSk7CiAgICB9CiAgICB2b2lkIGNs\nb3NlKCkgewogICAgfQp9Cg==\n","encoding":"base64"}

