{"sha":"294684a1b7cb40ea0a4819d56c0555c1fe4fea22","node_id":"MDQ6QmxvYjE1NzU5NTY6Mjk0Njg0YTFiN2NiNDBlYTBhNDgxOWQ1NmMwNTU1YzFmZTRmZWEyMg==","size":4745,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/294684a1b7cb40ea0a4819d56c0555c1fe4fea22","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmlvLkJ5\ndGVCdWZmZXI7CgovKioKICogVGhpcyBpcyBhIHBhZ2UgaW4gdGhlIExlZGdl\nckNhY2hlLiBJdCBob2xkcyB0aGUgbG9jYXRpb25zCiAqIChlbnRyeWxvZ2Zp\nbGUsIG9mZnNldCkgZm9yIGVudHJ5IGlkcy4KICovCnB1YmxpYyBjbGFzcyBM\nZWRnZXJFbnRyeVBhZ2UgewogICAgcHJpdmF0ZSBmaW5hbCBpbnQgcGFnZVNp\nemU7CiAgICBwcml2YXRlIGZpbmFsIGludCBlbnRyaWVzUGVyUGFnZTsKICAg\nIHByaXZhdGUgbG9uZyBsZWRnZXIgPSAtMTsKICAgIHByaXZhdGUgbG9uZyBm\naXJzdEVudHJ5ID0gLTE7CiAgICBwcml2YXRlIGZpbmFsIEJ5dGVCdWZmZXIg\ncGFnZTsKICAgIHByaXZhdGUgYm9vbGVhbiBjbGVhbiA9IHRydWU7CiAgICBw\ncml2YXRlIGJvb2xlYW4gcGlubmVkID0gZmFsc2U7CiAgICBwcml2YXRlIGlu\ndCB1c2VDb3VudDsKICAgIHByaXZhdGUgaW50IHZlcnNpb247CgogICAgcHVi\nbGljIExlZGdlckVudHJ5UGFnZShpbnQgcGFnZVNpemUsIGludCBlbnRyaWVz\nUGVyUGFnZSkgewogICAgICAgIHRoaXMucGFnZVNpemUgPSBwYWdlU2l6ZTsK\nICAgICAgICB0aGlzLmVudHJpZXNQZXJQYWdlID0gZW50cmllc1BlclBhZ2U7\nCiAgICAgICAgcGFnZSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGVEaXJlY3QocGFn\nZVNpemUpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3\nIFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5hcHBlbmQoZ2V0TGVkZ2Vy\nKCkpOwogICAgICAgIHNiLmFwcGVuZCgnQCcpOwogICAgICAgIHNiLmFwcGVu\nZChnZXRGaXJzdEVudHJ5KCkpOwogICAgICAgIHNiLmFwcGVuZChjbGVhbiA/\nICIgY2xlYW4gIiA6ICIgZGlydHkgIik7CiAgICAgICAgc2IuYXBwZW5kKHVz\nZUNvdW50KTsKICAgICAgICByZXR1cm4gc2IudG9TdHJpbmcoKTsKICAgIH0K\nICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9pZCB1c2VQYWdlKCkgewogICAg\nICAgIHVzZUNvdW50Kys7CiAgICB9CiAgICBzeW5jaHJvbml6ZWQgcHVibGlj\nIHZvaWQgcGluKCkgewogICAgICAgIHBpbm5lZCA9IHRydWU7CiAgICB9CiAg\nICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQgdW5waW4oKSB7CiAgICAgICAg\ncGlubmVkID0gZmFsc2U7CiAgICB9CiAgICBzeW5jaHJvbml6ZWQgcHVibGlj\nIGJvb2xlYW4gaXNQaW5uZWQoKSB7CiAgICAgICAgcmV0dXJuIHBpbm5lZDsK\nICAgIH0KICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9pZCByZWxlYXNlUGFn\nZSgpIHsKICAgICAgICB1c2VDb3VudC0tOwogICAgICAgIGlmICh1c2VDb3Vu\ndCA8IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4\nY2VwdGlvbigiVXNlIGNvdW50IGhhcyBnb25lIGJlbG93IDAiKTsKICAgICAg\nICB9CiAgICB9CiAgICBzeW5jaHJvbml6ZWQgcHJpdmF0ZSB2b2lkIGNoZWNr\nUGFnZSgpIHsKICAgICAgICBpZiAodXNlQ291bnQgPD0gMCkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJQYWdlIG5v\ndCBtYXJrZWQgaW4gdXNlIik7CiAgICAgICAgfQogICAgfQogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG90aGVyKSB7\nCiAgICAgICAgTGVkZ2VyRW50cnlQYWdlIG90aGVyTEVQID0gKExlZGdlckVu\ndHJ5UGFnZSkgb3RoZXI7CiAgICAgICAgcmV0dXJuIG90aGVyTEVQLmdldExl\nZGdlcigpID09IGdldExlZGdlcigpICYmIG90aGVyTEVQLmdldEZpcnN0RW50\ncnkoKSA9PSBnZXRGaXJzdEVudHJ5KCk7CiAgICB9CiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgcmV0dXJuIChp\nbnQpZ2V0TGVkZ2VyKCkgXiAoaW50KShnZXRGaXJzdEVudHJ5KCkpOwogICAg\nfQogICAgdm9pZCBzZXRDbGVhbihpbnQgdmVyc2lvbk9mQ2xlYW5pbmcpIHsK\nICAgICAgICB0aGlzLmNsZWFuID0gKHZlcnNpb25PZkNsZWFuaW5nID09IHZl\ncnNpb24pOwogICAgfQogICAgYm9vbGVhbiBpc0NsZWFuKCkgewogICAgICAg\nIHJldHVybiBjbGVhbjsKICAgIH0KICAgIHB1YmxpYyB2b2lkIHNldE9mZnNl\ndChsb25nIG9mZnNldCwgaW50IHBvc2l0aW9uKSB7CiAgICAgICAgY2hlY2tQ\nYWdlKCk7CiAgICAgICAgdmVyc2lvbisrOwogICAgICAgIHRoaXMuY2xlYW4g\nPSBmYWxzZTsKICAgICAgICBwYWdlLnB1dExvbmcocG9zaXRpb24sIG9mZnNl\ndCk7CiAgICB9CiAgICBwdWJsaWMgbG9uZyBnZXRPZmZzZXQoaW50IHBvc2l0\naW9uKSB7CiAgICAgICAgY2hlY2tQYWdlKCk7CiAgICAgICAgcmV0dXJuIHBh\nZ2UuZ2V0TG9uZyhwb3NpdGlvbik7CiAgICB9CiAgICBzdGF0aWMgZmluYWwg\nYnl0ZSB6ZXJvUGFnZVtdID0gbmV3IGJ5dGVbNjQqMTAyNF07CiAgICBwdWJs\naWMgdm9pZCB6ZXJvUGFnZSgpIHsKICAgICAgICBjaGVja1BhZ2UoKTsKICAg\nICAgICBwYWdlLmNsZWFyKCk7CiAgICAgICAgcGFnZS5wdXQoemVyb1BhZ2Us\nIDAsIHBhZ2UucmVtYWluaW5nKCkpOwogICAgICAgIGNsZWFuID0gdHJ1ZTsK\nICAgIH0KICAgIHB1YmxpYyB2b2lkIHJlYWRQYWdlKEZpbGVJbmZvIGZpKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoZWNrUGFnZSgpOwogICAg\nICAgIHBhZ2UuY2xlYXIoKTsKICAgICAgICB3aGlsZShwYWdlLnJlbWFpbmlu\nZygpICE9IDApIHsKICAgICAgICAgICAgaWYgKGZpLnJlYWQocGFnZSwgZ2V0\nRmlyc3RFbnRyeSgpKjgpIDw9IDApIHsKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbigiU2hvcnQgcGFnZSByZWFkIG9mIGxlZGdlciAi\nICsgZ2V0TGVkZ2VyKCkgKyAiIHRyaWVkIHRvIGdldCAiICsgcGFnZS5jYXBh\nY2l0eSgpICsgIiBmcm9tIHBvc2l0aW9uICIgKyBnZXRGaXJzdEVudHJ5KCkq\nOCArICIgc3RpbGwgbmVlZCAiICsgcGFnZS5yZW1haW5pbmcoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2xlYW4gPSB0cnVlOwogICAg\nfQogICAgcHVibGljIEJ5dGVCdWZmZXIgZ2V0UGFnZVRvV3JpdGUoKSB7CiAg\nICAgICAgY2hlY2tQYWdlKCk7CiAgICAgICAgcGFnZS5jbGVhcigpOwogICAg\nICAgIHJldHVybiBwYWdlOwogICAgfQogICAgdm9pZCBzZXRMZWRnZXIobG9u\nZyBsZWRnZXIpIHsKICAgICAgICB0aGlzLmxlZGdlciA9IGxlZGdlcjsKICAg\nIH0KICAgIGxvbmcgZ2V0TGVkZ2VyKCkgewogICAgICAgIHJldHVybiBsZWRn\nZXI7CiAgICB9CiAgICBpbnQgZ2V0VmVyc2lvbigpIHsKICAgICAgICByZXR1\ncm4gdmVyc2lvbjsKICAgIH0KICAgIHZvaWQgc2V0Rmlyc3RFbnRyeShsb25n\nIGZpcnN0RW50cnkpIHsKICAgICAgICBpZiAoZmlyc3RFbnRyeSAlIGVudHJp\nZXNQZXJQYWdlICE9IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbihmaXJzdEVudHJ5ICsgIiBpcyBub3QgYSBt\ndWx0aXBsZSBvZiAiICsgZW50cmllc1BlclBhZ2UpOwogICAgICAgIH0KICAg\nICAgICB0aGlzLmZpcnN0RW50cnkgPSBmaXJzdEVudHJ5OwogICAgfQogICAg\nbG9uZyBnZXRGaXJzdEVudHJ5KCkgewogICAgICAgIHJldHVybiBmaXJzdEVu\ndHJ5OwogICAgfQogICAgcHVibGljIGJvb2xlYW4gaW5Vc2UoKSB7CiAgICAg\nICAgcmV0dXJuIHVzZUNvdW50ID4gMDsKICAgIH0KICAgIHB1YmxpYyBsb25n\nIGdldExhc3RFbnRyeSgpIHsKICAgICAgICBmb3IoaW50IGkgPSBlbnRyaWVz\nUGVyUGFnZSAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgIGlmIChn\nZXRPZmZzZXQoaSo4KSA+IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBp\nICsgZmlyc3RFbnRyeTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gMDsKICAgIH0KfQo=\n","encoding":"base64"}

