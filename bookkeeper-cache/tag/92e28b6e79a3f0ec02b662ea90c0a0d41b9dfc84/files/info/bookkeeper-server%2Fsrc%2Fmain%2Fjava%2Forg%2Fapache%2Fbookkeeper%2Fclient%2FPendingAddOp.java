{"sha":"7aad7512cd54ab8573553d02827b31bf18cd2bee","node_id":"MDQ6QmxvYjE1NzU5NTY6N2FhZDc1MTJjZDU0YWI4NTczNTUzZDAyODI3YjMxYmYxOGNkMmJlZQ==","size":5866,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7aad7512cd54ab8573553d02827b31bf18cd2bee","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNv\nZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhw\ncmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBz\ncGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq\nIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmltcG9ydCBq\nYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVy\nSW50ZXJuYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVQcm90b2NvbDsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1\nZmZlcjsKCi8qKgogKiBUaGlzIHJlcHJlc2VudHMgYSBwZW5kaW5nIGFkZCBv\ncGVyYXRpb24uIFdoZW4gaXQgaGFzIGdvdCBzdWNjZXNzIGZyb20gYWxsCiAq\nIGJvb2tpZXMsIGl0IHNlZXMgaWYgaXRzIGF0IHRoZSBoZWFkIG9mIHRoZSBw\nZW5kaW5nIGFkZHMgcXVldWUsIGFuZCBpZiB5ZXMsCiAqIHNlbmRzIGFjayBi\nYWNrIHRvIHRoZSBhcHBsaWNhdGlvbi4gSWYgYSBib29raWUgZmFpbHMsIGEg\ncmVwbGFjZW1lbnQgaXMgbWFkZQogKiBhbmQgcGxhY2VkIGF0IHRoZSBzYW1l\nIHBvc2l0aW9uIGluIHRoZSBlbnNlbWJsZS4gVGhlIHBlbmRpbmcgYWRkcyBh\ncmUgdGhlbgogKiByZXJlcGxpY2F0ZWQuCiAqCiAqCiAqLwpjbGFzcyBQZW5k\naW5nQWRkT3AgaW1wbGVtZW50cyBXcml0ZUNhbGxiYWNrIHsKICAgIGZpbmFs\nIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIo\nUGVuZGluZ0FkZE9wLmNsYXNzKTsKCiAgICBDaGFubmVsQnVmZmVyIHRvU2Vu\nZDsKICAgIEFkZENhbGxiYWNrIGNiOwogICAgT2JqZWN0IGN0eDsKICAgIGxv\nbmcgZW50cnlJZDsKICAgIGJvb2xlYW5bXSBzdWNjZXNzZXNTb0ZhcjsKICAg\nIGludCBudW1SZXNwb25zZXNQZW5kaW5nOwogICAgTGVkZ2VySGFuZGxlIGxo\nOwogICAgYm9vbGVhbiBpc1JlY292ZXJ5QWRkID0gZmFsc2U7CgogICAgUGVu\nZGluZ0FkZE9wKExlZGdlckhhbmRsZSBsaCwgQWRkQ2FsbGJhY2sgY2IsIE9i\namVjdCBjdHgpIHsKICAgICAgICB0aGlzLmxoID0gbGg7CiAgICAgICAgdGhp\ncy5jYiA9IGNiOwogICAgICAgIHRoaXMuY3R4ID0gY3R4OwogICAgICAgIHRo\naXMuZW50cnlJZCA9IC0xOwogICAgICAgIAogICAgICAgIHN1Y2Nlc3Nlc1Nv\nRmFyID0gbmV3IGJvb2xlYW5bbGgubWV0YWRhdGEucXVvcnVtU2l6ZV07CiAg\nICAgICAgbnVtUmVzcG9uc2VzUGVuZGluZyA9IHN1Y2Nlc3Nlc1NvRmFyLmxl\nbmd0aDsKICAgIH0KCiAgICAvKiogCiAgICAgKiBFbmFibGUgdGhlIHJlY292\nZXJ5IGFkZCBmbGFnIGZvciB0aGlzIG9wZXJhdGlvbi4KICAgICAqIEBzZWUg\nTGVkZ2VySGFuZGxlI2FzeW5jUmVjb3ZlcnlBZGRFbnRyeQogICAgICovCiAg\nICBQZW5kaW5nQWRkT3AgZW5hYmxlUmVjb3ZlcnlBZGQoKSB7CiAgICAgICAg\naXNSZWNvdmVyeUFkZCA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICB9CgogICAgdm9pZCBzZXRFbnRyeUlkKGxvbmcgZW50cnlJZCkgewogICAg\nICAgIHRoaXMuZW50cnlJZCA9IGVudHJ5SWQ7CiAgICB9CgogICAgdm9pZCBz\nZW5kV3JpdGVSZXF1ZXN0KGludCBib29raWVJbmRleCwgaW50IGFycmF5SW5k\nZXgpIHsKICAgICAgICBpbnQgZmxhZ3MgPSBpc1JlY292ZXJ5QWRkID8gQm9v\na2llUHJvdG9jb2wuRkxBR19SRUNPVkVSWV9BREQgOiBCb29raWVQcm90b2Nv\nbC5GTEFHX05PTkU7CgogICAgICAgIGxoLmJrLmJvb2tpZUNsaWVudC5hZGRF\nbnRyeShsaC5tZXRhZGF0YS5jdXJyZW50RW5zZW1ibGUuZ2V0KGJvb2tpZUlu\nZGV4KSwgbGgubGVkZ2VySWQsIGxoLmxlZGdlcktleSwgZW50cnlJZCwgdG9T\nZW5kLAogICAgICAgICAgICAgICAgdGhpcywgYXJyYXlJbmRleCwgZmxhZ3Mp\nOwogICAgfQoKICAgIHZvaWQgdW5zZXRTdWNjZXNzQW5kU2VuZFdyaXRlUmVx\ndWVzdChpbnQgYm9va2llSW5kZXgpIHsKICAgICAgICBpZiAodG9TZW5kID09\nIG51bGwpIHsKICAgICAgICAgICAgLy8gdGhpcyBhZGRPcCBoYXNuJ3QgeWV0\nIGhhZCBpdHMgbWFjIGNvbXB1dGVkLiBXaGVuIHRoZSBtYWMgaXMKICAgICAg\nICAgICAgLy8gY29tcHV0ZWQsIGl0cyB3cml0ZSByZXF1ZXN0cyB3aWxsIGJl\nIHNlbnQsIHNvIG5vIG5lZWQgdG8gc2VuZCBpdAogICAgICAgICAgICAvLyBu\nb3cKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaW50\nIHJlcGxpY2FJbmRleCA9IGxoLmRpc3RyaWJ1dGlvblNjaGVkdWxlLmdldFJl\ncGxpY2FJbmRleChlbnRyeUlkLCBib29raWVJbmRleCk7CiAgICAgICAgaWYg\nKHJlcGxpY2FJbmRleCA8IDApIHsKICAgICAgICAgICAgaWYgKExPRy5pc0Rl\nYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkxl\nYXZpbmcgdW5jaGFuZ2VkLCBsZWRnZXI6ICIgKyBsaC5sZWRnZXJJZCArICIg\nZW50cnk6ICIgKyBlbnRyeUlkICsgIiBib29raWUgaW5kZXg6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICArIGJvb2tpZUluZGV4KTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBp\nZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRl\nYnVnKCJVbnNldHRpbmcgc3VjY2VzcyBmb3IgbGVkZ2VyOiAiICsgbGgubGVk\nZ2VySWQgKyAiIGVudHJ5OiAiICsgZW50cnlJZCArICIgYm9va2llIGluZGV4\nOiAiCiAgICAgICAgICAgICAgICAgICAgICArIGJvb2tpZUluZGV4KTsKICAg\nICAgICB9CgogICAgICAgIC8vIGlmIHdlIGhhZCBhbHJlYWR5IGhlYXJkIGEg\nc3VjY2VzcyBmcm9tIHRoaXMgYXJyYXkgaW5kZXgsIG5lZWQgdG8KICAgICAg\nICAvLyBpbmNyZW1lbnQgb3VyIG51bWJlciBvZiByZXNwb25zZXMgdGhhdCBh\ncmUgcGVuZGluZywgc2luY2Ugd2UgYXJlCiAgICAgICAgLy8gZ29pbmcgdG8g\ndW5zZXQgdGhpcyBzdWNjZXNzCiAgICAgICAgaWYgKHN1Y2Nlc3Nlc1NvRmFy\nW3JlcGxpY2FJbmRleF0pIHsKICAgICAgICAgICAgc3VjY2Vzc2VzU29GYXJb\ncmVwbGljYUluZGV4XSA9IGZhbHNlOwogICAgICAgICAgICBudW1SZXNwb25z\nZXNQZW5kaW5nKys7CiAgICAgICAgfQoKICAgICAgICBzZW5kV3JpdGVSZXF1\nZXN0KGJvb2tpZUluZGV4LCByZXBsaWNhSW5kZXgpOwogICAgfQoKICAgIHZv\naWQgaW5pdGlhdGUoQ2hhbm5lbEJ1ZmZlciB0b1NlbmQpIHsKICAgICAgICB0\naGlzLnRvU2VuZCA9IHRvU2VuZDsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IHN1Y2Nlc3Nlc1NvRmFyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAg\nIGludCBib29raWVJbmRleCA9IGxoLmRpc3RyaWJ1dGlvblNjaGVkdWxlLmdl\ndEJvb2tpZUluZGV4KGVudHJ5SWQsIGkpOwogICAgICAgICAgICBzZW5kV3Jp\ndGVSZXF1ZXN0KGJvb2tpZUluZGV4LCBpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCB3cml0ZUNvbXBsZXRlKGlu\ndCByYywgbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLCBJbmV0U29ja2V0\nQWRkcmVzcyBhZGRyLCBPYmplY3QgY3R4KSB7CgogICAgICAgIEludGVnZXIg\ncmVwbGljYUluZGV4ID0gKEludGVnZXIpIGN0eDsKICAgICAgICBpbnQgYm9v\na2llSW5kZXggPSBsaC5kaXN0cmlidXRpb25TY2hlZHVsZS5nZXRCb29raWVJ\nbmRleChlbnRyeUlkLCByZXBsaWNhSW5kZXgpOwoKICAgICAgICBpZiAoIWxo\nLm1ldGFkYXRhLmN1cnJlbnRFbnNlbWJsZS5nZXQoYm9va2llSW5kZXgpLmVx\ndWFscyhhZGRyKSkgewogICAgICAgICAgICAvLyBlbnNlbWJsZSBoYXMgYWxy\nZWFkeSBjaGFuZ2VkLCBmYWlsdXJlIG9mIHRoaXMgYWRkciBpcyBpbW1hdGVy\naWFsCiAgICAgICAgICAgIExPRy53YXJuKCJXcml0ZSBkaWQgbm90IHN1Y2Nl\nZWQ6ICIgKyBsZWRnZXJJZCArICIsICIgKyBlbnRyeUlkICsgIi4gQnV0IHdl\nIGhhdmUgYWxyZWFkeSBmaXhlZCBpdC4iKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KCiAgICAgICAgc3dpdGNoIChyYykgewogICAgICAgIGNh\nc2UgQktFeGNlcHRpb24uQ29kZS5PSzoKICAgICAgICAgICAgLy8gY29udGlu\ndWUKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBCS0V4Y2VwdGlv\nbi5Db2RlLkxlZGdlckZlbmNlZEV4Y2VwdGlvbjoKICAgICAgICAgICAgTE9H\nLndhcm4oIkZlbmNpbmcgZXhjZXB0aW9uIG9uIHdyaXRlOiAiICsgbGVkZ2Vy\nSWQgKyAiLCAiICsgZW50cnlJZCk7CiAgICAgICAgICAgIGxoLmhhbmRsZVVu\ncmVjb3ZlcmFibGVFcnJvckR1cmluZ0FkZChyYyk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBMT0cud2Fybigi\nV3JpdGUgZGlkIG5vdCBzdWNjZWVkOiAiICsgbGVkZ2VySWQgKyAiLCAiICsg\nZW50cnlJZCk7CiAgICAgICAgICAgIGxoLmhhbmRsZUJvb2tpZUZhaWx1cmUo\nYWRkciwgYm9va2llSW5kZXgpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKCiAgICAgICAgaWYgKCFzdWNjZXNzZXNTb0ZhcltyZXBsaWNhSW5k\nZXhdKSB7CiAgICAgICAgICAgIHN1Y2Nlc3Nlc1NvRmFyW3JlcGxpY2FJbmRl\neF0gPSB0cnVlOwogICAgICAgICAgICBudW1SZXNwb25zZXNQZW5kaW5nLS07\nCgogICAgICAgICAgICAvLyBkbyBzb21lIHF1aWNrIGNoZWNrcyB0byBzZWUg\naWYgc29tZSBhZGRzIG1heSBoYXZlIGZpbmlzaGVkLiBBbGwKICAgICAgICAg\nICAgLy8gdGhpcyB3aWxsIGJlIGNoZWNrZWQgdW5kZXIgbG9ja3MgYWdhaW4K\nICAgICAgICAgICAgaWYgKG51bVJlc3BvbnNlc1BlbmRpbmcgPT0gMCAmJiBs\naC5wZW5kaW5nQWRkT3BzLnBlZWsoKSA9PSB0aGlzKSB7CiAgICAgICAgICAg\nICAgICBsaC5zZW5kQWRkU3VjY2Vzc0NhbGxiYWNrcygpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgc3VibWl0Q2FsbGJhY2so\nZmluYWwgaW50IHJjKSB7CiAgICAgICAgY2IuYWRkQ29tcGxldGUocmMsIGxo\nLCBlbnRyeUlkLCBjdHgpOwogICAgICAgIGxoLm9wQ291bnRlclNlbS5yZWxl\nYXNlKCk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

