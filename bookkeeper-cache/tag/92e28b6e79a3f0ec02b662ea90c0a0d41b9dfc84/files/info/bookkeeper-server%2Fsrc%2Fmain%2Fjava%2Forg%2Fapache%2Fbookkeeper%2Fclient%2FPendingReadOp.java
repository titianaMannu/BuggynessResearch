{"sha":"29070ebd807f4970378a8e8585f4b993d61ab080","node_id":"MDQ6QmxvYjE1NzU5NTY6MjkwNzBlYmQ4MDdmNDk3MDM3OGE4ZTg1ODVmNGI5OTNkNjFhYjA4MA==","size":6148,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/29070ebd807f4970378a8e8585f4b993d61ab080","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZh\nLm5pby5CeXRlQnVmZmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5RGVxdWU7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkVudW1lcmF0aW9uOwppbXBvcnQgamF2YS51dGlsLk5vU3VjaEVsZW1lbnRF\neGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuUXVldWU7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suUmVhZENh\nbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5C\nS0V4Y2VwdGlvbi5CS0RpZ2VzdE1hdGNoRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVByb3RvY29sOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRl\ncm5hbENhbGxiYWNrcy5SZWFkRW50cnlDYWxsYmFjazsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcjsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcklu\ncHV0U3RyZWFtOwoKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CgovKioK\nICogU2VxdWVuY2Ugb2YgZW50cmllcyBvZiBhIGxlZGdlciB0aGF0IHJlcHJl\nc2VudHMgYSBwZW5kaW5nIHJlYWQgb3BlcmF0aW9uLgogKiBXaGVuIGFsbCB0\naGUgZGF0YSByZWFkIGhhcyBjb21lIGJhY2ssIHRoZSBhcHBsaWNhdGlvbiBj\nYWxsYmFjayBpcyBjYWxsZWQuCiAqIFRoaXMgY2xhc3MgY291bGQgYmUgaW1w\ncm92ZWQgYmVjYXVzZSB3ZSBjb3VsZCBzdGFydCBwdXNoaW5nIGRhdGEgdG8g\ndGhlCiAqIGFwcGxpY2F0aW9uIGFzIHNvb24gYXMgaXQgYXJyaXZlcyByYXRo\nZXIgdGhhbiB3YWl0aW5nIGZvciB0aGUgd2hvbGUgdGhpbmcuCiAqCiAqLwoK\nY2xhc3MgUGVuZGluZ1JlYWRPcCBpbXBsZW1lbnRzIEVudW1lcmF0aW9uPExl\nZGdlckVudHJ5PiwgUmVhZEVudHJ5Q2FsbGJhY2sgewogICAgTG9nZ2VyIExP\nRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFBlbmRpbmdSZWFkT3AuY2xh\nc3MpOwoKICAgIFF1ZXVlPExlZGdlckVudHJ5PiBzZXE7CiAgICBSZWFkQ2Fs\nbGJhY2sgY2I7CiAgICBPYmplY3QgY3R4OwogICAgTGVkZ2VySGFuZGxlIGxo\nOwogICAgbG9uZyBudW1QZW5kaW5nUmVhZHM7CiAgICBsb25nIHN0YXJ0RW50\ncnlJZDsKICAgIGxvbmcgZW5kRW50cnlJZDsKCiAgICBQZW5kaW5nUmVhZE9w\nKExlZGdlckhhbmRsZSBsaCwgbG9uZyBzdGFydEVudHJ5SWQsIGxvbmcgZW5k\nRW50cnlJZCwgUmVhZENhbGxiYWNrIGNiLCBPYmplY3QgY3R4KSB7CgogICAg\nICAgIHNlcSA9IG5ldyBBcnJheURlcXVlPExlZGdlckVudHJ5PigoaW50KSAo\nZW5kRW50cnlJZCAtIHN0YXJ0RW50cnlJZCkpOwogICAgICAgIHRoaXMuY2Ig\nPSBjYjsKICAgICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICB0aGlzLmxo\nID0gbGg7CiAgICAgICAgdGhpcy5zdGFydEVudHJ5SWQgPSBzdGFydEVudHJ5\nSWQ7CiAgICAgICAgdGhpcy5lbmRFbnRyeUlkID0gZW5kRW50cnlJZDsKICAg\nICAgICBudW1QZW5kaW5nUmVhZHMgPSBlbmRFbnRyeUlkIC0gc3RhcnRFbnRy\neUlkICsgMTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbml0aWF0ZSgpIHRo\ncm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBuZXh0\nRW5zZW1ibGVDaGFuZ2UgPSBzdGFydEVudHJ5SWQsIGkgPSBzdGFydEVudHJ5\nSWQ7CgogICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gZW5z\nZW1ibGUgPSBudWxsOwogICAgICAgIGRvIHsKCiAgICAgICAgICAgIGlmKExP\nRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVi\ndWcoIkFjcXVpcmluZyBsb2NrOiAiICsgaSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGxoLm9wQ291bnRlclNlbS5hY3F1aXJlKCk7CgogICAgICAg\nICAgICBpZiAoaSA9PSBuZXh0RW5zZW1ibGVDaGFuZ2UpIHsKICAgICAgICAg\nICAgICAgIGVuc2VtYmxlID0gbGgubWV0YWRhdGEuZ2V0RW5zZW1ibGUoaSk7\nCiAgICAgICAgICAgICAgICBuZXh0RW5zZW1ibGVDaGFuZ2UgPSBsaC5tZXRh\nZGF0YS5nZXROZXh0RW5zZW1ibGVDaGFuZ2UoaSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgTGVkZ2VyRW50cnkgZW50cnkgPSBuZXcgTGVkZ2VyRW50\ncnkobGgubGVkZ2VySWQsIGkpOwogICAgICAgICAgICBzZXEuYWRkKGVudHJ5\nKTsKICAgICAgICAgICAgaSsrOwogICAgICAgICAgICBzZW5kUmVhZChlbnNl\nbWJsZSwgZW50cnksIEJLRXhjZXB0aW9uLkNvZGUuUmVhZEV4Y2VwdGlvbik7\nCgogICAgICAgIH0gd2hpbGUgKGkgPD0gZW5kRW50cnlJZCk7CiAgICB9Cgog\nICAgdm9pZCBzZW5kUmVhZChBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+\nIGVuc2VtYmxlLCBMZWRnZXJFbnRyeSBlbnRyeSwgaW50IGxhc3RFcnJvckNv\nZGUpIHsKICAgICAgICBpZiAoZW50cnkubmV4dFJlcGxpY2FJbmRleFRvUmVh\nZEZyb20gPj0gbGgubWV0YWRhdGEucXVvcnVtU2l6ZSkgewogICAgICAgICAg\nICAvLyB3ZSBhcmUgZG9uZSwgdGhlIHJlYWQgaGFzIGZhaWxlZCBmcm9tIGFs\nbCByZXBsaWNhcywganVzdCBmYWlsIHRoZQogICAgICAgICAgICAvLyByZWFk\nCiAgICAgICAgICAgIHN1Ym1pdENhbGxiYWNrKGxhc3RFcnJvckNvZGUpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpbnQgYm9v\na2llSW5kZXggPSBsaC5kaXN0cmlidXRpb25TY2hlZHVsZS5nZXRCb29raWVJ\nbmRleChlbnRyeS5lbnRyeUlkLCBlbnRyeS5uZXh0UmVwbGljYUluZGV4VG9S\nZWFkRnJvbSk7CiAgICAgICAgZW50cnkubmV4dFJlcGxpY2FJbmRleFRvUmVh\nZEZyb20rKzsKICAgICAgICBsaC5iay5ib29raWVDbGllbnQucmVhZEVudHJ5\nKGVuc2VtYmxlLmdldChib29raWVJbmRleCksIGxoLmxlZGdlcklkLCBlbnRy\neS5lbnRyeUlkLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRoaXMsIGVudHJ5LCBCb29raWVQcm90b2NvbC5GTEFHX05PTkUpOwog\nICAgfQoKICAgIHZvaWQgbG9nRXJyb3JBbmRSZWF0dGVtcHRSZWFkKExlZGdl\nckVudHJ5IGVudHJ5LCBTdHJpbmcgZXJyTXNnLCBpbnQgcmMpIHsKICAgICAg\nICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGVuc2VtYmxlID0gbGgu\nbWV0YWRhdGEuZ2V0RW5zZW1ibGUoZW50cnkuZW50cnlJZCk7CiAgICAgICAg\naW50IGJvb2tlSW5kZXggPSBsaC5kaXN0cmlidXRpb25TY2hlZHVsZS5nZXRC\nb29raWVJbmRleChlbnRyeS5lbnRyeUlkLCBlbnRyeS5uZXh0UmVwbGljYUlu\nZGV4VG9SZWFkRnJvbSAtIDEpOwogICAgICAgIExPRy5lcnJvcihlcnJNc2cg\nKyAiIHdoaWxlIHJlYWRpbmcgZW50cnk6ICIgKyBlbnRyeS5lbnRyeUlkICsg\nIiBsZWRnZXJJZDogIiArIGxoLmxlZGdlcklkICsgIiBmcm9tIGJvb2tpZTog\nIgogICAgICAgICAgICAgICAgICArIGVuc2VtYmxlLmdldChib29rZUluZGV4\nKSk7CiAgICAgICAgc2VuZFJlYWQoZW5zZW1ibGUsIGVudHJ5LCByYyk7CiAg\nICAgICAgcmV0dXJuOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgcmVhZEVudHJ5Q29tcGxldGUoaW50IHJjLCBsb25nIGxlZGdlcklk\nLCBmaW5hbCBsb25nIGVudHJ5SWQsIGZpbmFsIENoYW5uZWxCdWZmZXIgYnVm\nZmVyLCBPYmplY3QgY3R4KSB7CiAgICAgICAgZmluYWwgTGVkZ2VyRW50cnkg\nZW50cnkgPSAoTGVkZ2VyRW50cnkpIGN0eDsKCiAgICAgICAgaWYgKHJjICE9\nIEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgbG9nRXJyb3JB\nbmRSZWF0dGVtcHRSZWFkKGVudHJ5LCAiRXJyb3I6ICIgKyBCS0V4Y2VwdGlv\nbi5nZXRNZXNzYWdlKHJjKSwgcmMpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICBDaGFubmVsQnVmZmVySW5wdXRTdHJlYW0gaXM7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaXMgPSBsaC5tYWNNYW5hZ2Vy\nLnZlcmlmeURpZ2VzdEFuZFJldHVybkRhdGEoZW50cnlJZCwgYnVmZmVyKTsK\nICAgICAgICB9IGNhdGNoIChCS0RpZ2VzdE1hdGNoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgbG9nRXJyb3JBbmRSZWF0dGVtcHRSZWFkKGVudHJ5LCAi\nTWFjIG1pc21hdGNoIiwgQktFeGNlcHRpb24uQ29kZS5EaWdlc3RNYXRjaEV4\nY2VwdGlvbik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIGVudHJ5LmVudHJ5RGF0YVN0cmVhbSA9IGlzOwoKICAgICAgICAvKgog\nICAgICAgICAqIFRoZSBsZW5ndGggaXMgYSBsb25nIGFuZCBpdCBpcyB0aGUg\nbGFzdCBmaWVsZCBvZiB0aGUgbWV0YWRhdGEgb2YgYW4gZW50cnkuCiAgICAg\nICAgICogQ29uc2VxdWVudGx5LCB3ZSBoYXZlIHRvIHN1YnRyYWN0IDggZnJv\nbSBNRVRBREFUQV9MRU5HVEggdG8gZ2V0IHRoZSBsZW5ndGguCiAgICAgICAg\nICovCiAgICAgICAgZW50cnkubGVuZ3RoID0gYnVmZmVyLmdldExvbmcoRGln\nZXN0TWFuYWdlci5NRVRBREFUQV9MRU5HVEggLSA4KTsKCiAgICAgICAgbnVt\nUGVuZGluZ1JlYWRzLS07CiAgICAgICAgaWYgKG51bVBlbmRpbmdSZWFkcyA9\nPSAwKSB7CiAgICAgICAgICAgIHN1Ym1pdENhbGxiYWNrKEJLRXhjZXB0aW9u\nLkNvZGUuT0spOwogICAgICAgIH0KCiAgICAgICAgaWYoTE9HLmlzRGVidWdF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRlYnVnKCJSZWxlYXNpbmcg\nbG9jazogIiArIGVudHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgbGgub3BD\nb3VudGVyU2VtLnJlbGVhc2UoKTsKCiAgICAgICAgaWYobnVtUGVuZGluZ1Jl\nYWRzIDwgMCkKICAgICAgICAgICAgTE9HLmVycm9yKCJSZWFkIHRvbyBtYW55\nIHZhbHVlcyIpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzdWJtaXRDYWxs\nYmFjayhpbnQgY29kZSkgewogICAgICAgIGNiLnJlYWRDb21wbGV0ZShjb2Rl\nLCBsaCwgUGVuZGluZ1JlYWRPcC50aGlzLCBQZW5kaW5nUmVhZE9wLnRoaXMu\nY3R4KTsKICAgIH0KICAgIHB1YmxpYyBib29sZWFuIGhhc01vcmVFbGVtZW50\ncygpIHsKICAgICAgICByZXR1cm4gIXNlcS5pc0VtcHR5KCk7CiAgICB9Cgog\nICAgcHVibGljIExlZGdlckVudHJ5IG5leHRFbGVtZW50KCkgdGhyb3dzIE5v\nU3VjaEVsZW1lbnRFeGNlcHRpb24gewogICAgICAgIHJldHVybiBzZXEucmVt\nb3ZlKCk7CiAgICB9CgogICAgcHVibGljIGludCBzaXplKCkgewogICAgICAg\nIHJldHVybiBzZXEuc2l6ZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

