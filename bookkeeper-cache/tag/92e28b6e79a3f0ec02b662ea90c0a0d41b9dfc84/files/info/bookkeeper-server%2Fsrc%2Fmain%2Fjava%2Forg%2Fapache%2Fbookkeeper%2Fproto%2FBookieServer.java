{"sha":"beab5e842dcfbd2702cee23641cda03d45844dd8","node_id":"MDQ6QmxvYjE1NzU5NTY6YmVhYjVlODQyZGNmYmQyNzAyY2VlMjM2NDFjZGEwM2Q0NTg0NGRkOA==","size":14928,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/beab5e842dcfbd2702cee23641cda03d45844dd8","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG87CgovKgogKgog\nKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24g\nKEFTRikgdW5kZXIgb25lCiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5z\nZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQogKiBkaXN0cmli\ndXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlv\nbgogKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0Yg\nbGljZW5zZXMgdGhpcyBmaWxlCiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hl\nIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUKICogIkxpY2Vuc2UiKTsgeW91\nIG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZQog\nKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9m\nIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3Jn\nL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBi\neSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywKICog\nc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlz\ndHJpYnV0ZWQgb24gYW4KICogIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJS\nQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZCiAqIEtJTkQsIGVpdGhlciBl\neHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZQog\nKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nIGxpbWl0YXRpb25zCiAqIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKi8KCmlt\ncG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5uZXQuSW5ldEFkZHJlc3M7CmltcG9ydCBqYXZhLm5l\ndC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0Lk1hbGZvcm1l\nZFVSTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0LlVua25vd25Ib3N0RXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKCmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CgppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWU7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nTklPU2VydmVyRmFjdG9yeS5DbnhuOwppbXBvcnQgc3RhdGljIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29raWVQcm90b2NvbC5QYWNrZXRIZWFk\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29uZmlndXJhdGlvbi5D\nb25maWd1cmF0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmNsaS5CYXNpY1BhcnNlcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9u\ncy5jbGkuT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGku\nQ29tbWFuZExpbmU7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhl\nbHBGb3JtYXR0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLlBh\ncnNlRXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBJbXBsZW1lbnRz\nIHRoZSBzZXJ2ZXItc2lkZSBwYXJ0IG9mIHRoZSBCb29rS2VlcGVyIHByb3Rv\nY29sLgogKgogKi8KcHVibGljIGNsYXNzIEJvb2tpZVNlcnZlciBpbXBsZW1l\nbnRzIE5JT1NlcnZlckZhY3RvcnkuUGFja2V0UHJvY2Vzc29yLCBCb29ra2Vl\ncGVySW50ZXJuYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjayB7CiAgICBmaW5h\nbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICBOSU9TZXJ2ZXJGYWN0\nb3J5IG5pb1NlcnZlckZhY3Rvcnk7CiAgICBwcml2YXRlIHZvbGF0aWxlIGJv\nb2xlYW4gcnVubmluZyA9IGZhbHNlOwogICAgQm9va2llIGJvb2tpZTsKICAg\nIERlYXRoV2F0Y2hlciBkZWF0aFdhdGNoZXI7CiAgICBzdGF0aWMgTG9nZ2Vy\nIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tpZVNlcnZlci5j\nbGFzcyk7CgogICAgcHVibGljIEJvb2tpZVNlcnZlcihTZXJ2ZXJDb25maWd1\ncmF0aW9uIGNvbmYpIAogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24s\nIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAg\nICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAgICAgdGhpcy5ib29raWUgPSBu\nZXcgQm9va2llKGNvbmYpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBuaW9TZXJ2ZXJGYWN0\nb3J5ID0gbmV3IE5JT1NlcnZlckZhY3RvcnkoY29uZiwgdGhpcyk7CiAgICAg\nICAgcnVubmluZyA9IHRydWU7CiAgICAgICAgZGVhdGhXYXRjaGVyID0gbmV3\nIERlYXRoV2F0Y2hlcihjb25mKTsKICAgICAgICBkZWF0aFdhdGNoZXIuc3Rh\ncnQoKTsKICAgIH0KCiAgICBwdWJsaWMgSW5ldFNvY2tldEFkZHJlc3MgZ2V0\nTG9jYWxBZGRyZXNzKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MuZ2V0TG9j\nYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgY29uZi5nZXRCb29raWVQb3J0\nKCkpOwogICAgICAgIH0gY2F0Y2ggKFVua25vd25Ib3N0RXhjZXB0aW9uIHVo\nZSkgewogICAgICAgICAgICByZXR1cm4gbmlvU2VydmVyRmFjdG9yeS5nZXRM\nb2NhbEFkZHJlc3MoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHN5\nbmNocm9uaXplZCB2b2lkIHNodXRkb3duKCkgdGhyb3dzIEludGVycnVwdGVk\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXJ1bm5pbmcpIHsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBuaW9TZXJ2ZXJGYWN0b3J5\nLnNodXRkb3duKCk7CiAgICAgICAgYm9va2llLnNodXRkb3duKCk7CiAgICAg\nICAgcnVubmluZyA9IGZhbHNlOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFu\nIGlzUnVubmluZygpIHsKICAgICAgICByZXR1cm4gYm9va2llLmlzUnVubmlu\nZygpICYmIG5pb1NlcnZlckZhY3RvcnkuaXNSdW5uaW5nKCkgJiYgcnVubmlu\nZzsKICAgIH0KCiAgICAvKioKICAgICAqIFdoZXRoZXIgYm9va2llIGlzIHJ1\nbm5pbmc/CiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlmIGJvb2tpZSBp\ncyBydW5uaW5nLCBvdGhlcndpc2UgcmV0dXJuIGZhbHNlCiAgICAgKi8KICAg\nIHB1YmxpYyBib29sZWFuIGlzQm9va2llUnVubmluZygpIHsKICAgICAgICBy\nZXR1cm4gYm9va2llLmlzUnVubmluZygpOwogICAgfQoKICAgIC8qKgogICAg\nICogV2hldGhlciBuaW8gc2VydmVyIGlzIHJ1bm5pbmc/CiAgICAgKgogICAg\nICogQHJldHVybiB0cnVlIGlmIG5pbyBzZXJ2ZXIgaXMgcnVubmluZywgb3Ro\nZXJ3aXNlIHJldHVybiBmYWxzZQogICAgICovCiAgICBwdWJsaWMgYm9vbGVh\nbiBpc05pb1NlcnZlclJ1bm5pbmcoKSB7CiAgICAgICAgcmV0dXJuIG5pb1Nl\ncnZlckZhY3RvcnkuaXNSdW5uaW5nKCk7CiAgICB9CgogICAgcHVibGljIHZv\naWQgam9pbigpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAg\nICAgbmlvU2VydmVyRmFjdG9yeS5qb2luKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBIHRocmVhZCB0byB3YXRjaCB3aGV0aGVyIGJvb2tpZSAmIG5pb3Nl\ncnZlciBpcyBzdGlsbCBhbGl2ZQogICAgICovCiAgICBjbGFzcyBEZWF0aFdh\ndGNoZXIgZXh0ZW5kcyBUaHJlYWQgewoKICAgICAgICBmaW5hbCBpbnQgd2F0\nY2hJbnRlcnZhbDsKCiAgICAgICAgRGVhdGhXYXRjaGVyKFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZikgewogICAgICAgICAgICB3YXRjaEludGVydmFsID0g\nY29uZi5nZXREZWF0aFdhdGNoSW50ZXJ2YWwoKTsKICAgICAgICB9CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICAgICAgd2hpbGUodHJ1ZSkgewogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAod2F0Y2hJbnRlcnZh\nbCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICghaXNCb29r\naWVSdW5uaW5nKCkgfHwgIWlzTmlvU2VydmVyUnVubmluZygpKSB7CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBTeXN0ZW0uZXhpdCgtMSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBmaW5hbCBP\ncHRpb25zIGJrT3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICBzdGF0aWMgewog\nICAgICAgIGJrT3B0cy5hZGRPcHRpb24oImMiLCAiY29uZiIsIHRydWUsICJD\nb25maWd1cmF0aW9uIGZvciBCb29raWUgU2VydmVyIik7CiAgICAgICAgYmtP\ncHRzLmFkZE9wdGlvbigiaCIsICJoZWxwIiwgZmFsc2UsICJQcmludCBoZWxw\nIG1lc3NhZ2UiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFByaW50IHVzYWdl\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIHZvaWQgcHJpbnRVc2FnZSgp\nIHsKICAgICAgICBIZWxwRm9ybWF0dGVyIGhmID0gbmV3IEhlbHBGb3JtYXR0\nZXIoKTsKICAgICAgICBoZi5wcmludEhlbHAoIkJvb2tpZVNlcnZlciBbb3B0\naW9uc11cblx0b3JcbiIKICAgICAgICAgICAgICAgICAgICsgIkJvb2tpZVNl\ncnZlciA8Ym9va2llX3BvcnQ+IDx6a19zZXJ2ZXJzPiA8am91cm5hbF9kaXI+\nIDxsZWRnZXJfZGlyIFtsZWRnZXJfZGlyXT4iLCBia09wdHMpOwogICAgfQoK\nICAgIHByaXZhdGUgc3RhdGljIHZvaWQgbG9hZENvbmZGaWxlKFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZiwgU3RyaW5nIGNvbmZGaWxlKQogICAgICAgIHRo\ncm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gewogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGNvbmYubG9hZENvbmYobmV3IEZpbGUoY29uZkZpbGUp\nLnRvVVJJKCkudG9VUkwoKSk7CiAgICAgICAgfSBjYXRjaCAoTWFsZm9ybWVk\nVVJMRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJDb3Vs\nZCBub3Qgb3BlbiBjb25maWd1cmF0aW9uIGZpbGU6ICIgKyBjb25mRmlsZSwg\nZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24oKTsKICAgICAgICB9IGNhdGNoIChDb25maWd1cmF0aW9uRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJNYWxmb3JtZWQgY29u\nZmlndXJhdGlvbiBmaWxlOiAiICsgY29uZkZpbGUsIGUpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgICAgIExPRy5pbmZvKCJVc2luZyBjb25maWd1cmF0aW9uIGZp\nbGUgIiArIGNvbmZGaWxlKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBT\nZXJ2ZXJDb25maWd1cmF0aW9uIHBhcnNlQXJncyhTdHJpbmdbXSBhcmdzKQog\nICAgICAgIHRocm93cyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24gewogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIEJhc2ljUGFyc2VyIHBhcnNlciA9IG5l\ndyBCYXNpY1BhcnNlcigpOwogICAgICAgICAgICBDb21tYW5kTGluZSBjbWRM\naW5lID0gcGFyc2VyLnBhcnNlKGJrT3B0cywgYXJncyk7CgogICAgICAgICAg\nICBpZiAoY21kTGluZS5oYXNPcHRpb24oJ2gnKSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNv\nbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBT\ndHJpbmdbXSBsZWZ0QXJncyA9IGNtZExpbmUuZ2V0QXJncygpOwoKICAgICAg\nICAgICAgaWYgKGNtZExpbmUuaGFzT3B0aW9uKCdjJykpIHsKICAgICAgICAg\nICAgICAgIGlmIChudWxsICE9IGxlZnRBcmdzICYmIGxlZnRBcmdzLmxlbmd0\naCA+IDApIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBTdHJpbmcgY29uZkZpbGUgPSBjbWRMaW5lLmdldE9wdGlv\nblZhbHVlKCJjIik7CiAgICAgICAgICAgICAgICBsb2FkQ29uZkZpbGUoY29u\nZiwgY29uZkZpbGUpOwogICAgICAgICAgICAgICAgcmV0dXJuIGNvbmY7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChsZWZ0QXJncy5sZW5ndGgg\nPCA0KSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3Vt\nZW50RXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIGNvbW1hbmQgbGluZSBhcmd1bWVudHMgb3ZlcndyaXRlIHNldHRpbmdzIGlu\nIGNvbmZpZ3VyYXRpb24gZmlsZQogICAgICAgICAgICBjb25mLnNldEJvb2tp\nZVBvcnQoSW50ZWdlci5wYXJzZUludChsZWZ0QXJnc1swXSkpOwogICAgICAg\nICAgICBjb25mLnNldFprU2VydmVycyhsZWZ0QXJnc1sxXSk7CiAgICAgICAg\nICAgIGNvbmYuc2V0Sm91cm5hbERpck5hbWUobGVmdEFyZ3NbMl0pOwogICAg\nICAgICAgICBTdHJpbmdbXSBsZWRnZXJEaXJOYW1lcyA9IG5ldyBTdHJpbmdb\nbGVmdEFyZ3MubGVuZ3RoIC0gM107CiAgICAgICAgICAgIFN5c3RlbS5hcnJh\neWNvcHkobGVmdEFyZ3MsIDMsIGxlZGdlckRpck5hbWVzLCAwLCBsZWRnZXJE\naXJOYW1lcy5sZW5ndGgpOwogICAgICAgICAgICBjb25mLnNldExlZGdlckRp\nck5hbWVzKGxlZGdlckRpck5hbWVzKTsKCiAgICAgICAgICAgIHJldHVybiBj\nb25mOwogICAgICAgIH0gY2F0Y2ggKFBhcnNlRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBwYXJzaW5nIGNvbW1hbmQgbGlu\nZSBhcmd1bWVudHMgOiAiLCBlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEls\nbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBAcGFyYW0gYXJncwogICAgICogQHRocm93cyBJT0V4\nY2VwdGlvbgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBh\ncmdzKSAKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBLZWVwZXJF\neGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGNvbmYgPSBwYXJzZUFyZ3MoYXJncyk7CiAgICAgICAgfSBj\nYXRjaCAoSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIGlhZSkgewogICAgICAg\nICAgICBMT0cuZXJyb3IoIkVycm9yIHBhcnNpbmcgY29tbWFuZCBsaW5lIGFy\nZ3VtZW50cyA6ICIsIGlhZSk7CiAgICAgICAgICAgIFN5c3RlbS5lcnIucHJp\nbnRsbihpYWUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgcHJpbnRVc2Fn\nZSgpOwogICAgICAgICAgICB0aHJvdyBpYWU7CiAgICAgICAgfQoKICAgICAg\nICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAg\nICAgICBTdHJpbmdbXSBsZWRnZXJEaXJOYW1lcyA9IGNvbmYuZ2V0TGVkZ2Vy\nRGlyTmFtZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxlZGdl\nckRpck5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpICE9\nIDApIHsKICAgICAgICAgICAgICAgIHNiLmFwcGVuZCgnLCcpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHNiLmFwcGVuZChsZWRnZXJEaXJOYW1lc1tp\nXSk7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgaGVsbG8gPSBTdHJpbmcu\nZm9ybWF0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAiSGVsbG8sIEkn\nbSB5b3VyIGJvb2tpZSwgbGlzdGVuaW5nIG9uIHBvcnQgJTEkcy4gWktTZXJ2\nZXJzIGFyZSBvbiAlMiRzLiBKb3VybmFscyBhcmUgaW4gJTMkcy4gTGVkZ2Vy\ncyBhcmUgc3RvcmVkIGluICU0JHMuIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY29uZi5nZXRCb29raWVQb3J0KCksIGNvbmYuZ2V0WmtTZXJ2ZXJz\nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmYuZ2V0Sm91cm5h\nbERpck5hbWUoKSwgc2IpOwogICAgICAgIExPRy5pbmZvKGhlbGxvKTsKICAg\nICAgICBmaW5hbCBCb29raWVTZXJ2ZXIgYnMgPSBuZXcgQm9va2llU2VydmVy\nKGNvbmYpOwogICAgICAgIGJzLnN0YXJ0KCk7CiAgICAgICAgUnVudGltZS5n\nZXRSdW50aW1lKCkuYWRkU2h1dGRvd25Ib29rKG5ldyBUaHJlYWQoKSB7CiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBy\ndW4oKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgIGJzLnNodXRkb3duKCk7CiAgICAgICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIlNodXQgZG93biBib29raWUgc2VydmVyIHN1Y2Nlc3NmdWxseSIpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24g\naWUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiRXhjZXB0aW9u\nIHdoZW4gc2h1dHRpbmcgZG93biBib29raWUgc2VydmVyIDogIiwgaWUpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAg\nICAgICAgTE9HLmluZm8oIlJlZ2lzdGVyIHNodXRkb3duIGhvb2sgc3VjY2Vz\nc2Z1bGx5Iik7CiAgICAgICAgYnMuam9pbigpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHByb2Nlc3NQYWNrZXQoQnl0ZUJ1ZmZlciBwYWNrZXQsIENueG4g\nc3JjKSB7CiAgICAgICAgUGFja2V0SGVhZGVyIGggPSBQYWNrZXRIZWFkZXIu\nZnJvbUludChwYWNrZXQuZ2V0SW50KCkpOwoKICAgICAgICAvLyBwYWNrZXQg\nZm9ybWF0IGlzIGRpZmZlcmVudCBiZXR3ZWVuIEFEREVOVFJZIGFuZCBSRUFE\nRU5UUlkKICAgICAgICBsb25nIGxlZGdlcklkID0gLTE7CiAgICAgICAgbG9u\nZyBlbnRyeUlkID0gLTE7CiAgICAgICAgYnl0ZVtdIG1hc3RlcktleSA9IG51\nbGw7CiAgICAgICAgc3dpdGNoIChoLmdldE9wQ29kZSgpKSB7CiAgICAgICAg\nY2FzZSBCb29raWVQcm90b2NvbC5BRERFTlRSWToKICAgICAgICAgICAgLy8g\nZmlyc3QgcmVhZCBtYXN0ZXIga2V5CiAgICAgICAgICAgIG1hc3RlcktleSA9\nIG5ldyBieXRlWzIwXTsKICAgICAgICAgICAgcGFja2V0LmdldChtYXN0ZXJL\nZXksIDAsIDIwKTsKICAgICAgICAgICAgLy8gISEgZmFsbCB0aHJ1IHRvIHJl\nYWQgbGVkZ2VyIGlkIGFuZCBlbnRyeSBpZAogICAgICAgIGNhc2UgQm9va2ll\nUHJvdG9jb2wuUkVBREVOVFJZOgogICAgICAgICAgICBCeXRlQnVmZmVyIGJi\nID0gcGFja2V0LmR1cGxpY2F0ZSgpOwogICAgICAgICAgICBsZWRnZXJJZCA9\nIGJiLmdldExvbmcoKTsKICAgICAgICAgICAgZW50cnlJZCA9IGJiLmdldExv\nbmcoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBp\nZiAoaC5nZXRWZXJzaW9uKCkgPCBCb29raWVQcm90b2NvbC5MT1dFU1RfQ09N\nUEFUX1BST1RPQ09MX1ZFUlNJT04KICAgICAgICAgICAgfHwgaC5nZXRWZXJz\naW9uKCkgPiBCb29raWVQcm90b2NvbC5DVVJSRU5UX1BST1RPQ09MX1ZFUlNJ\nT04pIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJbnZhbGlkIHByb3RvY29s\nIHZlcnNpb24sIGV4cGVjdGVkIHNvbWV0aGluZyBiZXR3ZWVuICIKICAgICAg\nICAgICAgICAgICAgICAgICsgQm9va2llUHJvdG9jb2wuTE9XRVNUX0NPTVBB\nVF9QUk9UT0NPTF9WRVJTSU9OIAogICAgICAgICAgICAgICAgICAgICAgKyAi\nICYgIiArIEJvb2tpZVByb3RvY29sLkNVUlJFTlRfUFJPVE9DT0xfVkVSU0lP\nTgogICAgICAgICAgICAgICAgICAgICsgIi4gZ290ICIgKyBoLmdldFZlcnNp\nb24oKSk7CiAgICAgICAgICAgIHNyYy5zZW5kUmVzcG9uc2UoYnVpbGRSZXNw\nb25zZShCb29raWVQcm90b2NvbC5FQkFEVkVSU0lPTiwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoLmdldFZlcnNpb24o\nKSwgaC5nZXRPcENvZGUoKSwgbGVkZ2VySWQsIGVudHJ5SWQpKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBzaG9ydCBmbGFncyA9\nIGguZ2V0RmxhZ3MoKTsKICAgICAgICBzd2l0Y2ggKGguZ2V0T3BDb2RlKCkp\nIHsKICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkFEREVOVFJZOgogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gTE9HLmRlYnVnKCJN\nYXN0ZXIga2V5OiAiICsgbmV3IFN0cmluZyhtYXN0ZXJLZXkpKTsKICAgICAg\nICAgICAgICAgIGlmICgoZmxhZ3MgJiBCb29raWVQcm90b2NvbC5GTEFHX1JF\nQ09WRVJZX0FERCkgPT0gQm9va2llUHJvdG9jb2wuRkxBR19SRUNPVkVSWV9B\nREQpIHsKICAgICAgICAgICAgICAgICAgICBib29raWUucmVjb3ZlcnlBZGRF\nbnRyeShwYWNrZXQuc2xpY2UoKSwgdGhpcywgc3JjLCBtYXN0ZXJLZXkpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBi\nb29raWUuYWRkRW50cnkocGFja2V0LnNsaWNlKCksIHRoaXMsIHNyYywgbWFz\ndGVyS2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRj\naCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJFcnJvciB3cml0aW5nICIgKyBlbnRyeUlkICsgIkAiICsgbGVkZ2VySWQs\nIGUpOwogICAgICAgICAgICAgICAgc3JjLnNlbmRSZXNwb25zZShidWlsZFJl\nc3BvbnNlKEJvb2tpZVByb3RvY29sLkVJTywgaC5nZXRWZXJzaW9uKCksIGgu\nZ2V0T3BDb2RlKCksIGxlZGdlcklkLCBlbnRyeUlkKSk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5MZWRnZXJGZW5jZWRFeGNlcHRp\nb24gbGZlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkF0dGVtcHQg\ndG8gd3JpdGUgdG8gZmVuY2VkIGxlZGdlciIsIGxmZSk7CiAgICAgICAgICAg\nICAgICBzcmMuc2VuZFJlc3BvbnNlKGJ1aWxkUmVzcG9uc2UoQm9va2llUHJv\ndG9jb2wuRUZFTkNFRCwgaC5nZXRWZXJzaW9uKCksIGguZ2V0T3BDb2RlKCks\nIGxlZGdlcklkLCBlbnRyeUlkKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJv\nb2tpZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIlVuYXV0aG9yaXplZCBhY2Nlc3MgdG8gbGVkZ2VyICIgKyBsZWRnZXJJZCwg\nZSk7CiAgICAgICAgICAgICAgICBzcmMuc2VuZFJlc3BvbnNlKGJ1aWxkUmVz\ncG9uc2UoQm9va2llUHJvdG9jb2wuRVVBLCBoLmdldFZlcnNpb24oKSwgaC5n\nZXRPcENvZGUoKSwgbGVkZ2VySWQsIGVudHJ5SWQpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEJvb2tpZVByb3Rv\nY29sLlJFQURFTlRSWToKICAgICAgICAgICAgQnl0ZUJ1ZmZlcltdIHJzcCA9\nIG5ldyBCeXRlQnVmZmVyWzJdOwogICAgICAgICAgICBMT0cuZGVidWcoIlJl\nY2VpdmVkIG5ldyByZWFkIHJlcXVlc3Q6ICIgKyBsZWRnZXJJZCArICIsICIg\nKyBlbnRyeUlkKTsKICAgICAgICAgICAgaW50IGVycm9yQ29kZSA9IEJvb2tp\nZVByb3RvY29sLkVJTzsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGlmICgoZmxhZ3MgJiBCb29raWVQcm90b2NvbC5GTEFHX0RPX0ZFTkNJ\nTkcpID09IEJvb2tpZVByb3RvY29sLkZMQUdfRE9fRkVOQ0lORykgewogICAg\nICAgICAgICAgICAgICAgIExPRy53YXJuKCJMZWRnZXIgIiArIGxlZGdlcklk\nICsgIiBmZW5jZWQgYnkgIiArIHNyYy5nZXRQZWVyTmFtZSgpKTsKICAgICAg\nICAgICAgICAgICAgICBib29raWUuZmVuY2VMZWRnZXIobGVkZ2VySWQpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcnNwWzFdID0gYm9v\na2llLnJlYWRFbnRyeShsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgICAg\nICAgICBMT0cuZGVidWcoIiMjIyMjIFJlYWQgZW50cnkgIyMjIyMgIiArIHJz\ncFsxXS5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgICAgICBlcnJvckNvZGUg\nPSBCb29raWVQcm90b2NvbC5FT0s7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJv\nb2tpZS5Ob0xlZGdlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBp\nZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBMT0cuZXJyb3IoIkVycm9yIHJlYWRpbmcgIiArIGVudHJ5SWQgKyAiQCIg\nKyBsZWRnZXJJZCwgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBlcnJvckNvZGUgPSBCb29raWVQcm90b2NvbC5FTk9MRURHRVI7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgcmVhZGlu\nZyAiICsgZW50cnlJZCArICJAIiArIGxlZGdlcklkLCBlKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIGVycm9yQ29kZSA9IEJvb2tpZVBy\nb3RvY29sLkVOT0VOVFJZOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAoTE9HLmlzVHJhY2VFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9y\nIHJlYWRpbmcgIiArIGVudHJ5SWQgKyAiQCIgKyBsZWRnZXJJZCwgZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlcnJvckNvZGUgPSBC\nb29raWVQcm90b2NvbC5FSU87CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncnNwWzBdID0gYnVpbGRSZXNwb25zZShlcnJvckNvZGUsIGguZ2V0VmVyc2lv\nbigpLCBoLmdldE9wQ29kZSgpLCBsZWRnZXJJZCwgZW50cnlJZCk7CgogICAg\nICAgICAgICBpZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgICAgIExPRy50cmFjZSgiUmVhZCBlbnRyeSByYyA9ICIgKyBlcnJvckNv\nZGUgKyAiIGZvciAiICsgZW50cnlJZCArICJAIiArIGxlZGdlcklkKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBpZiAocnNwWzFdID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIC8vIFdlIGhhdmVuJ3QgZmlsbGVkIGluIGVudHJ5\nIGRhdGEsIHNvIHdlIGhhdmUgdG8gc2VuZCBiYWNrCiAgICAgICAgICAgICAg\nICAvLyB0aGUgbGVkZ2VyIGFuZCBlbnRyeSBpZHMgaGVyZQogICAgICAgICAg\nICAgICAgcnNwWzFdID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgxNik7CiAgICAg\nICAgICAgICAgICByc3BbMV0ucHV0TG9uZyhsZWRnZXJJZCk7CiAgICAgICAg\nICAgICAgICByc3BbMV0ucHV0TG9uZyhlbnRyeUlkKTsKICAgICAgICAgICAg\nICAgIHJzcFsxXS5mbGlwKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nTE9HLmRlYnVnKCJTZW5kaW5nIHJlc3BvbnNlIGZvcjogIiArIGVudHJ5SWQg\nKyAiLCAiICsgbmV3IFN0cmluZyhyc3BbMV0uYXJyYXkoKSkpOwogICAgICAg\nICAgICBzcmMuc2VuZFJlc3BvbnNlKHJzcCk7CiAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgIGRlZmF1bHQ6IAogICAgICAgICAgICBzcmMuc2VuZFJlc3Bv\nbnNlKGJ1aWxkUmVzcG9uc2UoQm9va2llUHJvdG9jb2wuRUJBRFJFUSwgaC5n\nZXRWZXJzaW9uKCksIGguZ2V0T3BDb2RlKCksIGxlZGdlcklkLCBlbnRyeUlk\nKSk7CiAgICAgICAgfQogICAgfQogICAgCiAgICBwcml2YXRlIEJ5dGVCdWZm\nZXIgYnVpbGRSZXNwb25zZShpbnQgZXJyb3JDb2RlLCBieXRlIHZlcnNpb24s\nIGJ5dGUgb3BDb2RlLCBsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQpIHsK\nICAgICAgICBCeXRlQnVmZmVyIHJzcCA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUo\nMjQpOwogICAgICAgIHJzcC5wdXRJbnQobmV3IFBhY2tldEhlYWRlcih2ZXJz\naW9uLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BD\nb2RlLCAoc2hvcnQpMCkudG9JbnQoKSk7CiAgICAgICAgcnNwLnB1dEludChl\ncnJvckNvZGUpOwogICAgICAgIHJzcC5wdXRMb25nKGxlZGdlcklkKTsKICAg\nICAgICByc3AucHV0TG9uZyhlbnRyeUlkKTsKCiAgICAgICAgcnNwLmZsaXAo\nKTsKICAgICAgICByZXR1cm4gcnNwOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHdyaXRlQ29tcGxldGUoaW50IHJjLCBsb25nIGxlZGdlcklkLCBsb25nIGVu\ndHJ5SWQsIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBDbnhuIHNyYyA9IChDbnhuKSBjdHg7CiAgICAgICAgQnl0ZUJ1\nZmZlciBiYiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMjQpOwogICAgICAgIGJi\nLnB1dEludChuZXcgUGFja2V0SGVhZGVyKEJvb2tpZVByb3RvY29sLkNVUlJF\nTlRfUFJPVE9DT0xfVkVSU0lPTiwgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQm9va2llUHJvdG9jb2wuQURERU5UUlksIChzaG9ydCkw\nKS50b0ludCgpKTsKICAgICAgICBiYi5wdXRJbnQocmMpOwogICAgICAgIGJi\nLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgIGJiLnB1dExvbmcoZW50cnlJ\nZCk7CiAgICAgICAgYmIuZmxpcCgpOwogICAgICAgIGlmIChMT0cuaXNUcmFj\nZUVuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cudHJhY2UoIkFkZCBlbnRy\neSByYyA9ICIgKyByYyArICIgZm9yICIgKyBlbnRyeUlkICsgIkAiICsgbGVk\nZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzcmMuc2VuZFJlc3BvbnNlKG5l\ndyBCeXRlQnVmZmVyW10geyBiYiB9KTsKICAgIH0KCn0K\n","encoding":"base64"}

