{"sha":"2fa79bbcf2e272fdccab18d7525f42062d9440e2","node_id":"MDQ6QmxvYjE1NzU5NTY6MmZhNzliYmNmMmUyNzJmZGNjYWIxOGQ3NTI1ZjQyMDYyZDk0NDBlMg==","size":23545,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2fa79bbcf2e272fdccab18d7525f42062d9440e2","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG87CgovKioKICog\nTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChB\nU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2Ug\nYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJpYnV0\nZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24K\nICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxp\nY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBM\naWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlvdSBt\nYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UKICog\nd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0\naGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3Jn\nL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBi\neSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29m\ndHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlz\ndHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJS\nQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHBy\nZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNw\nZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICog\nbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEudXRpbC5BcnJheURlcXVlOwppbXBvcnQg\namF2YS51dGlsLlF1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljTG9uZzsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNh\nbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5SZWFkRW50cnlDYWxsYmFjazsK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9v\na2llUHJvdG9jb2wuUGFja2V0SGVhZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnV0aWwuT3JkZXJlZFNhZmVFeGVjdXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlNhZmVSdW5uYWJsZTsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5ib290c3RyYXAuQ2xpZW50\nQm9vdHN0cmFwOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmJ1ZmZlci5DaGFu\nbmVsQnVmZmVyOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmJ1ZmZlci5DaGFu\nbmVsQnVmZmVyczsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNo\nYW5uZWw7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVs\nRmFjdG9yeTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5u\nZWxGdXR1cmU7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFu\nbmVsRnV0dXJlTGlzdGVuZXI7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hh\nbm5lbC5DaGFubmVsSGFuZGxlckNvbnRleHQ7CmltcG9ydCBvcmcuamJvc3Mu\nbmV0dHkuY2hhbm5lbC5DaGFubmVsUGlwZWxpbmU7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsUGlwZWxpbmVDb3ZlcmFnZTsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxQaXBlbGluZUZh\nY3Rvcnk7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVs\nU3RhdGVFdmVudDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNo\nYW5uZWxzOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuRXhjZXB0\naW9uRXZlbnQ7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5NZXNz\nYWdlRXZlbnQ7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5TaW1w\nbGVDaGFubmVsSGFuZGxlcjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFu\nbmVsLnNvY2tldC5DbGllbnRTb2NrZXRDaGFubmVsRmFjdG9yeTsKaW1wb3J0\nIG9yZy5qYm9zcy5uZXR0eS5oYW5kbGVyLmNvZGVjLmZyYW1lLkNvcnJ1cHRl\nZEZyYW1lRXhjZXB0aW9uOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmhhbmRs\nZXIuY29kZWMuZnJhbWUuTGVuZ3RoRmllbGRCYXNlZEZyYW1lRGVjb2RlcjsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5oYW5kbGVyLmNvZGVjLmZyYW1lLlRv\nb0xvbmdGcmFtZUV4Y2VwdGlvbjsKCi8qKgogKiBUaGlzIGNsYXNzIG1hbmFn\nZXMgYWxsIGRldGFpbHMgb2YgY29ubmVjdGlvbiB0byBhIHBhcnRpY3VsYXIg\nYm9va2llLiBJdCBhbHNvCiAqIGhhcyByZWNvbm5lY3QgbG9naWMgaWYgYSBj\nb25uZWN0aW9uIHRvIGEgYm9va2llIGZhaWxzLgogKgogKi8KCkBDaGFubmVs\nUGlwZWxpbmVDb3ZlcmFnZSgib25lIikKcHVibGljIGNsYXNzIFBlckNoYW5u\nZWxCb29raWVDbGllbnQgZXh0ZW5kcyBTaW1wbGVDaGFubmVsSGFuZGxlciBp\nbXBsZW1lbnRzIENoYW5uZWxQaXBlbGluZUZhY3RvcnkgewoKICAgIHN0YXRp\nYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIo\nUGVyQ2hhbm5lbEJvb2tpZUNsaWVudC5jbGFzcyk7CgogICAgc3RhdGljIGZp\nbmFsIGxvbmcgbWF4TWVtb3J5ID0gUnVudGltZS5nZXRSdW50aW1lKCkubWF4\nTWVtb3J5KCkgLyA1OwogICAgcHVibGljIHN0YXRpYyBpbnQgTUFYX0ZSQU1F\nX0xFTkdUSCA9IDIgKiAxMDI0ICogMTAyNDsgLy8gMk0KCiAgICBJbmV0U29j\na2V0QWRkcmVzcyBhZGRyOwogICAgU2VtYXBob3JlIG9wQ291bnRlclNlbSA9\nIG5ldyBTZW1hcGhvcmUoMjAwMCk7CiAgICBBdG9taWNMb25nIHRvdGFsQnl0\nZXNPdXRzdGFuZGluZzsKICAgIENsaWVudFNvY2tldENoYW5uZWxGYWN0b3J5\nIGNoYW5uZWxGYWN0b3J5OwogICAgT3JkZXJlZFNhZmVFeGVjdXRvciBleGVj\ndXRvcjsKCiAgICBDb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBB\nZGRDb21wbGV0aW9uPiBhZGRDb21wbGV0aW9ucyA9IG5ldyBDb25jdXJyZW50\nSGFzaE1hcDxDb21wbGV0aW9uS2V5LCBBZGRDb21wbGV0aW9uPigpOwogICAg\nQ29uY3VycmVudEhhc2hNYXA8Q29tcGxldGlvbktleSwgUmVhZENvbXBsZXRp\nb24+IHJlYWRDb21wbGV0aW9ucyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxD\nb21wbGV0aW9uS2V5LCBSZWFkQ29tcGxldGlvbj4oKTsKCiAgICAvKioKICAg\nICAqIFRoZSBmb2xsb3dpbmcgbWVtYmVyIHZhcmlhYmxlcyBkbyBub3QgbmVl\nZCB0byBiZSBjb25jdXJyZW50LCBvciB2b2xhdGlsZQogICAgICogYmVjYXVz\nZSB0aGV5IGFyZSBhbHdheXMgdXBkYXRlZCB1bmRlciBhIGxvY2sKICAgICAq\nLwogICAgUXVldWU8R2VuZXJpY0NhbGxiYWNrPFZvaWQ+PiBwZW5kaW5nT3Bz\nID0gbmV3IEFycmF5RGVxdWU8R2VuZXJpY0NhbGxiYWNrPFZvaWQ+PigpOwog\nICAgQ2hhbm5lbCBjaGFubmVsID0gbnVsbDsKCiAgICBwcml2YXRlIGVudW0g\nQ29ubmVjdGlvblN0YXRlIHsKICAgICAgICBESVNDT05ORUNURUQsIENPTk5F\nQ1RJTkcsIENPTk5FQ1RFRAogICAgICAgICAgICB9OwoKICAgIHByaXZhdGUg\nQ29ubmVjdGlvblN0YXRlIHN0YXRlOwogICAgcHJpdmF0ZSBmaW5hbCBDbGll\nbnRDb25maWd1cmF0aW9uIGNvbmY7CgogICAgcHVibGljIFBlckNoYW5uZWxC\nb29raWVDbGllbnQoT3JkZXJlZFNhZmVFeGVjdXRvciBleGVjdXRvciwgQ2xp\nZW50U29ja2V0Q2hhbm5lbEZhY3RvcnkgY2hhbm5lbEZhY3RvcnksCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmV0U29ja2V0QWRkcmVz\ncyBhZGRyLCBBdG9taWNMb25nIHRvdGFsQnl0ZXNPdXRzdGFuZGluZykgewog\nICAgICAgIHRoaXMobmV3IENsaWVudENvbmZpZ3VyYXRpb24oKSwgZXhlY3V0\nb3IsIGNoYW5uZWxGYWN0b3J5LCBhZGRyLCB0b3RhbEJ5dGVzT3V0c3RhbmRp\nbmcpOwogICAgfQogICAgICAgICAgICAKICAgIHB1YmxpYyBQZXJDaGFubmVs\nQm9va2llQ2xpZW50KENsaWVudENvbmZpZ3VyYXRpb24gY29uZiwgT3JkZXJl\nZFNhZmVFeGVjdXRvciBleGVjdXRvciwgQ2xpZW50U29ja2V0Q2hhbm5lbEZh\nY3RvcnkgY2hhbm5lbEZhY3RvcnksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBBdG9taWNMb25n\nIHRvdGFsQnl0ZXNPdXRzdGFuZGluZykgewogICAgICAgIHRoaXMuY29uZiA9\nIGNvbmY7CiAgICAgICAgdGhpcy5hZGRyID0gYWRkcjsKICAgICAgICB0aGlz\nLmV4ZWN1dG9yID0gZXhlY3V0b3I7CiAgICAgICAgdGhpcy50b3RhbEJ5dGVz\nT3V0c3RhbmRpbmcgPSB0b3RhbEJ5dGVzT3V0c3RhbmRpbmc7CiAgICAgICAg\ndGhpcy5jaGFubmVsRmFjdG9yeSA9IGNoYW5uZWxGYWN0b3J5OwogICAgICAg\nIHRoaXMuc3RhdGUgPSBDb25uZWN0aW9uU3RhdGUuRElTQ09OTkVDVEVEOwog\nICAgfQoKICAgIHN5bmNocm9uaXplZCBwcml2YXRlIHZvaWQgY29ubmVjdCgp\nIHsKICAgICAgICBpZiAoc3RhdGUgPT0gQ29ubmVjdGlvblN0YXRlLkNPTk5F\nQ1RJTkcpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0gCiAgICAg\nICAgLy8gU3RhcnQgdGhlIGNvbm5lY3Rpb24gYXR0ZW1wdCB0byB0aGUgaW5w\ndXQgc2VydmVyIGhvc3QuCiAgICAgICAgc3RhdGUgPSBDb25uZWN0aW9uU3Rh\ndGUuQ09OTkVDVElORzsKCiAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxl\nZCgpKQogICAgICAgICAgICBMT0cuZGVidWcoIkNvbm5lY3RpbmcgdG8gYm9v\na2llOiAiICsgYWRkcik7CgogICAgICAgIC8vIFNldCB1cCB0aGUgQ2xpZW50\nQm9vdFN0cmFwIHNvIHdlIGNhbiBjcmVhdGUgYSBuZXcgQ2hhbm5lbCBjb25u\nZWN0aW9uCiAgICAgICAgLy8gdG8gdGhlIGJvb2tpZS4KICAgICAgICBDbGll\nbnRCb290c3RyYXAgYm9vdHN0cmFwID0gbmV3IENsaWVudEJvb3RzdHJhcChj\naGFubmVsRmFjdG9yeSk7CiAgICAgICAgYm9vdHN0cmFwLnNldFBpcGVsaW5l\nRmFjdG9yeSh0aGlzKTsKICAgICAgICBib290c3RyYXAuc2V0T3B0aW9uKCJ0\nY3BOb0RlbGF5IiwgY29uZi5nZXRDbGllbnRUY3BOb0RlbGF5KCkpOwogICAg\nICAgIGJvb3RzdHJhcC5zZXRPcHRpb24oImtlZXBBbGl2ZSIsIHRydWUpOwoK\nICAgICAgICBDaGFubmVsRnV0dXJlIGZ1dHVyZSA9IGJvb3RzdHJhcC5jb25u\nZWN0KGFkZHIpOwoKICAgICAgICBmdXR1cmUuYWRkTGlzdGVuZXIobmV3IENo\nYW5uZWxGdXR1cmVMaXN0ZW5lcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKENo\nYW5uZWxGdXR1cmUgZnV0dXJlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIGludCByYzsKICAgICAgICAgICAgICAgIFF1ZXVlPEdlbmVy\naWNDYWxsYmFjazxWb2lkPj4gb2xkUGVuZGluZ09wczsKCiAgICAgICAgICAg\nICAgICBzeW5jaHJvbml6ZWQgKFBlckNoYW5uZWxCb29raWVDbGllbnQudGhp\ncykgewoKICAgICAgICAgICAgICAgICAgICBpZiAoZnV0dXJlLmlzU3VjY2Vz\ncygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJTdWNj\nZXNzZnVsbHkgY29ubmVjdGVkIHRvIGJvb2tpZTogIiArIGFkZHIpOwogICAg\nICAgICAgICAgICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5uZWwgPSBmdXR1cmUuZ2V0\nQ2hhbm5lbCgpOwogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IENv\nbm5lY3Rpb25TdGF0ZS5DT05ORUNURUQ7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJD\nb3VsZCBub3QgY29ubmVjdCB0byBib29raWU6ICIgKyBhZGRyKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2RlLkJvb2tp\nZUhhbmRsZU5vdEF2YWlsYWJsZUV4Y2VwdGlvbjsKICAgICAgICAgICAgICAg\nICAgICAgICAgY2hhbm5lbCA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkRJU0NPTk5FQ1RFRDsKICAg\nICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIFBlckNo\nYW5uZWxCb29raWVDbGllbnQudGhpcy5jaGFubmVsID0gY2hhbm5lbDsKCiAg\nICAgICAgICAgICAgICAgICAgLy8gdHJpY2sgdG8gbm90IGRvIG9wZXJhdGlv\nbnMgdW5kZXIgdGhlIGxvY2ssIHRha2UgdGhlIGxpc3QKICAgICAgICAgICAg\nICAgICAgICAvLyBvZiBwZW5kaW5nIG9wcyBhbmQgYXNzaWduIGl0IHRvIGEg\nbmV3IHZhcmlhYmxlLCB3aGlsZQogICAgICAgICAgICAgICAgICAgIC8vIGVt\ncHR5aW5nIHRoZSBwZW5kaW5nIG9wcyBieSBqdXN0IGFzc2lnbmluZyBpdCB0\nbyBhIG5ldwogICAgICAgICAgICAgICAgICAgIC8vIGxpc3QKICAgICAgICAg\nICAgICAgICAgICBvbGRQZW5kaW5nT3BzID0gcGVuZGluZ09wczsKICAgICAg\nICAgICAgICAgICAgICBwZW5kaW5nT3BzID0gbmV3IEFycmF5RGVxdWU8R2Vu\nZXJpY0NhbGxiYWNrPFZvaWQ+PigpOwogICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgIGZvciAoR2VuZXJpY0NhbGxiYWNrPFZvaWQ+IHBlbmRp\nbmdPcCA6IG9sZFBlbmRpbmdPcHMpIHsKICAgICAgICAgICAgICAgICAgICBw\nZW5kaW5nT3Aub3BlcmF0aW9uQ29tcGxldGUocmMsIG51bGwpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cgog\nICAgdm9pZCBjb25uZWN0SWZOZWVkZWRBbmREb09wKEdlbmVyaWNDYWxsYmFj\nazxWb2lkPiBvcCkgewogICAgICAgIGJvb2xlYW4gZG9PcE5vdzsKCiAgICAg\nICAgLy8gY29tbW9uIGNhc2Ugd2l0aG91dCBsb2NrIGZpcnN0CiAgICAgICAg\naWYgKGNoYW5uZWwgIT0gbnVsbCAmJiBzdGF0ZSA9PSBDb25uZWN0aW9uU3Rh\ndGUuQ09OTkVDVEVEKSB7CiAgICAgICAgICAgIGRvT3BOb3cgPSB0cnVlOwog\nICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgICAgIC8vIGNoZWNrIGFnYWluIHVuZGVyIGxv\nY2sKICAgICAgICAgICAgICAgIGlmIChjaGFubmVsICE9IG51bGwgJiYgc3Rh\ndGUgPT0gQ29ubmVjdGlvblN0YXRlLkNPTk5FQ1RFRCkgewogICAgICAgICAg\nICAgICAgICAgIGRvT3BOb3cgPSB0cnVlOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKCiAgICAgICAgICAgICAgICAgICAgLy8gaWYgcmVhY2hlZCBoZXJl\nLCBjaGFubmVsIGlzIGVpdGhlciBudWxsIChmaXJzdCBjb25uZWN0aW9uCiAg\nICAgICAgICAgICAgICAgICAgLy8gYXR0ZW1wdCksCiAgICAgICAgICAgICAg\nICAgICAgLy8gb3IgdGhlIGNoYW5uZWwgaXMgZGlzY29ubmVjdGVkCiAgICAg\nICAgICAgICAgICAgICAgZG9PcE5vdyA9IGZhbHNlOwoKICAgICAgICAgICAg\nICAgICAgICAvLyBjb25uZWN0aW9uIGF0dGVtcHQgaXMgc3RpbGwgaW4gcHJv\nZ3Jlc3MsIHF1ZXVlIHVwIHRoaXMKICAgICAgICAgICAgICAgICAgICAvLyBv\ncC4gT3Agd2lsbCBiZSBleGVjdXRlZCB3aGVuIGNvbm5lY3Rpb24gYXR0ZW1w\ndCBlaXRoZXIKICAgICAgICAgICAgICAgICAgICAvLyBmYWlscwogICAgICAg\nICAgICAgICAgICAgIC8vIG9yCiAgICAgICAgICAgICAgICAgICAgLy8gc3Vj\nY2VlZHMKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nT3BzLmFkZChvcCk7\nCgogICAgICAgICAgICAgICAgICAgIGNvbm5lY3QoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGRv\nT3BOb3cpIHsKICAgICAgICAgICAgb3Aub3BlcmF0aW9uQ29tcGxldGUoQktF\neGNlcHRpb24uQ29kZS5PSywgbnVsbCk7CiAgICAgICAgfQoKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgb25s\neSBhZnRlciBjb25uZWN0aW9uIGhhcyBiZWVuIGNoZWNrZWQgZm9yCiAgICAg\nKiB7QGxpbmsgI2Nvbm5lY3RJZk5lZWRlZEFuZERvT3AoR2VuZXJpY0NhbGxi\nYWNrKX0KICAgICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAqIEBw\nYXJhbSBtYXN0ZXJLZXkKICAgICAqIEBwYXJhbSBlbnRyeUlkCiAgICAgKiBA\ncGFyYW0gbGFzdENvbmZpcm1lZAogICAgICogQHBhcmFtIG1hY0NvZGUKICAg\nICAqIEBwYXJhbSBkYXRhCiAgICAgKiBAcGFyYW0gY2IKICAgICAqIEBwYXJh\nbSBjdHgKICAgICAqLwogICAgdm9pZCBhZGRFbnRyeShmaW5hbCBsb25nIGxl\nZGdlcklkLCBieXRlW10gbWFzdGVyS2V5LCBmaW5hbCBsb25nIGVudHJ5SWQs\nIENoYW5uZWxCdWZmZXIgdG9TZW5kLCBXcml0ZUNhbGxiYWNrIGNiLAogICAg\nICAgICAgICAgICAgICBPYmplY3QgY3R4LCBmaW5hbCBpbnQgb3B0aW9ucykg\newogICAgICAgIGZpbmFsIGludCBlbnRyeVNpemUgPSB0b1NlbmQucmVhZGFi\nbGVCeXRlcygpOwoKICAgICAgICAvLyBpZiAodG90YWxCeXRlc091dHN0YW5k\naW5nLmdldCgpID4gbWF4TWVtb3J5KSB7CiAgICAgICAgLy8gLy8gVE9ETzog\naG93IHRvIHRocm90dGxlLCB0aHJvdyBhbiBleGNlcHRpb24sIG9yIGNhbGwg\ndGhlIGNhbGxiYWNrPwogICAgICAgIC8vIC8vIE1heWJlIHRoaXMgc2hvdWxk\nIGJlIGRvbmUgYXQgdGhlIGxheWVyIGFib3ZlPwogICAgICAgIC8vIH0KCiAg\nICAgICAgZmluYWwgQ29tcGxldGlvbktleSBjb21wbGV0aW9uS2V5ID0gbmV3\nIENvbXBsZXRpb25LZXkobGVkZ2VySWQsIGVudHJ5SWQpOwoKICAgICAgICBh\nZGRDb21wbGV0aW9ucy5wdXQoY29tcGxldGlvbktleSwgbmV3IEFkZENvbXBs\nZXRpb24oY2IsIGVudHJ5U2l6ZSwgY3R4KSk7CgogICAgICAgIGludCB0b3Rh\nbEhlYWRlclNpemUgPSA0IC8vIGZvciB0aGUgbGVuZ3RoIG9mIHRoZSBwYWNr\nZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyA0IC8vIGZvciB0\naGUgdHlwZSBvZiByZXF1ZXN0CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgbWFzdGVyS2V5Lmxlbmd0aDsgLy8gZm9yIHRoZSBtYXN0ZXIga2V5\nCgogICAgICAgIENoYW5uZWxCdWZmZXIgaGVhZGVyID0gY2hhbm5lbC5nZXRD\nb25maWcoKS5nZXRCdWZmZXJGYWN0b3J5KCkuZ2V0QnVmZmVyKHRvdGFsSGVh\nZGVyU2l6ZSk7CiAgICAgICAgaGVhZGVyLndyaXRlSW50KHRvdGFsSGVhZGVy\nU2l6ZSAtIDQgKyBlbnRyeVNpemUpOwogICAgICAgIGhlYWRlci53cml0ZUlu\ndChuZXcgUGFja2V0SGVhZGVyKEJvb2tpZVByb3RvY29sLkNVUlJFTlRfUFJP\nVE9DT0xfVkVSU0lPTiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQm9va2llUHJvdG9jb2wuQURERU5UUlksIChzaG9ydClv\ncHRpb25zKS50b0ludCgpKTsKICAgICAgICBoZWFkZXIud3JpdGVCeXRlcyht\nYXN0ZXJLZXkpOwoKICAgICAgICBDaGFubmVsQnVmZmVyIHdyYXBwZWRCdWZm\nZXIgPSBDaGFubmVsQnVmZmVycy53cmFwcGVkQnVmZmVyKGhlYWRlciwgdG9T\nZW5kKTsKCiAgICAgICAgQ2hhbm5lbEZ1dHVyZSBmdXR1cmUgPSBjaGFubmVs\nLndyaXRlKHdyYXBwZWRCdWZmZXIpOwogICAgICAgIGZ1dHVyZS5hZGRMaXN0\nZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyKCkgewogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9u\nQ29tcGxldGUoQ2hhbm5lbEZ1dHVyZSBmdXR1cmUpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgaWYgKGZ1dHVyZS5pc1N1Y2Nlc3MoKSkg\newogICAgICAgICAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlN1Y2Nl\nc3NmdWxseSB3cm90ZSByZXF1ZXN0IGZvciBhZGRpbmcgZW50cnk6ICIgKyBl\nbnRyeUlkICsgIiBsZWRnZXItaWQ6ICIgKyBsZWRnZXJJZAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGJvb2tpZTogIiArIGNoYW5u\nZWwuZ2V0UmVtb3RlQWRkcmVzcygpICsgIiBlbnRyeSBsZW5ndGg6ICIgKyBl\nbnRyeVNpemUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAvLyB0b3RhbEJ5dGVzT3V0c3RhbmRpbmcuYWRkQW5kR2V0KGVu\ndHJ5U2l6ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIGVycm9yT3V0QWRkS2V5KGNvbXBsZXRpb25LZXkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRFbnRyeShmaW5hbCBsb25nIGxlZGdl\ncklkLCBmaW5hbCBsb25nIGVudHJ5SWQsIFJlYWRFbnRyeUNhbGxiYWNrIGNi\nLCBPYmplY3QgY3R4LCBmaW5hbCBpbnQgb3B0aW9ucykgewogICAgICAgIGZp\nbmFsIENvbXBsZXRpb25LZXkga2V5ID0gbmV3IENvbXBsZXRpb25LZXkobGVk\nZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIHJlYWRDb21wbGV0aW9ucy5wdXQo\na2V5LCBuZXcgUmVhZENvbXBsZXRpb24oY2IsIGN0eCkpOwoKICAgICAgICBp\nbnQgdG90YWxIZWFkZXJTaXplID0gNCAvLyBmb3IgdGhlIGxlbmd0aCBvZiB0\naGUgcGFja2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgNCAv\nLyBmb3IgcmVxdWVzdCB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgOCAvLyBmb3IgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyA4OyAvLyBmb3IgZW50cnlJZAoKICAgICAgICBDaGFubmVs\nQnVmZmVyIHRtcEVudHJ5ID0gY2hhbm5lbC5nZXRDb25maWcoKS5nZXRCdWZm\nZXJGYWN0b3J5KCkuZ2V0QnVmZmVyKHRvdGFsSGVhZGVyU2l6ZSk7CiAgICAg\nICAgdG1wRW50cnkud3JpdGVJbnQodG90YWxIZWFkZXJTaXplIC0gNCk7Cgog\nICAgICAgIHRtcEVudHJ5LndyaXRlSW50KG5ldyBQYWNrZXRIZWFkZXIoQm9v\na2llUHJvdG9jb2wuQ1VSUkVOVF9QUk9UT0NPTF9WRVJTSU9OLCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvb2tpZVBy\nb3RvY29sLlJFQURFTlRSWSwgKHNob3J0KW9wdGlvbnMpLnRvSW50KCkpOwog\nICAgICAgIHRtcEVudHJ5LndyaXRlTG9uZyhsZWRnZXJJZCk7CiAgICAgICAg\ndG1wRW50cnkud3JpdGVMb25nKGVudHJ5SWQpOwoKICAgICAgICBDaGFubmVs\nRnV0dXJlIGZ1dHVyZSA9IGNoYW5uZWwud3JpdGUodG1wRW50cnkpOwogICAg\nICAgIGZ1dHVyZS5hZGRMaXN0ZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3Rl\nbmVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoQ2hhbm5lbEZ1dHVyZSBmdXR1\ncmUpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKGZ1\ndHVyZS5pc1N1Y2Nlc3MoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChM\nT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIlN1Y2Nlc3NmdWxseSB3cm90ZSByZXF1ZXN0IGZvciBy\nZWFkaW5nIGVudHJ5OiAiICsgZW50cnlJZCArICIgbGVkZ2VyLWlkOiAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGxlZGdlcklkICsg\nIiBib29raWU6ICIgKyBjaGFubmVsLmdldFJlbW90ZUFkZHJlc3MoKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICBlcnJvck91dFJlYWRLZXkoa2V5KTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICBpZiAoY2hh\nbm5lbCAhPSBudWxsKSB7CiAgICAgICAgICAgIGNoYW5uZWwuY2xvc2UoKS5h\nd2FpdFVuaW50ZXJydXB0aWJseSgpOwogICAgICAgIH0KICAgIH0KCiAgICB2\nb2lkIGVycm9yT3V0UmVhZEtleShmaW5hbCBDb21wbGV0aW9uS2V5IGtleSkg\newogICAgICAgIGV4ZWN1dG9yLnN1Ym1pdE9yZGVyZWQoa2V5LmxlZGdlcklk\nLCBuZXcgU2FmZVJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigpIHsKCiAgICAgICAg\nICAgICAgICBSZWFkQ29tcGxldGlvbiByZWFkQ29tcGxldGlvbiA9IHJlYWRD\nb21wbGV0aW9ucy5yZW1vdmUoa2V5KTsKCiAgICAgICAgICAgICAgICBpZiAo\ncmVhZENvbXBsZXRpb24gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiQ291bGQgbm90IHdyaXRlICByZXF1ZXN0IGZvciByZWFk\naW5nIGVudHJ5OiAiICsga2V5LmVudHJ5SWQgKyAiIGxlZGdlci1pZDogIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGtleS5sZWRnZXJJZCAr\nICIgYm9va2llOiAiICsgY2hhbm5lbC5nZXRSZW1vdGVBZGRyZXNzKCkpOwoK\nICAgICAgICAgICAgICAgICAgICByZWFkQ29tcGxldGlvbi5jYi5yZWFkRW50\ncnlDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2\nYWlsYWJsZUV4Y2VwdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkubGVkZ2VySWQsIGtl\neS5lbnRyeUlkLCBudWxsLCByZWFkQ29tcGxldGlvbi5jdHgpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0pOwogICAgfQoK\nICAgIHZvaWQgZXJyb3JPdXRBZGRLZXkoZmluYWwgQ29tcGxldGlvbktleSBr\nZXkpIHsKICAgICAgICBleGVjdXRvci5zdWJtaXRPcmRlcmVkKGtleS5sZWRn\nZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVSdW4oKSB7CgogICAg\nICAgICAgICAgICAgQWRkQ29tcGxldGlvbiBhZGRDb21wbGV0aW9uID0gYWRk\nQ29tcGxldGlvbnMucmVtb3ZlKGtleSk7CgogICAgICAgICAgICAgICAgaWYg\nKGFkZENvbXBsZXRpb24gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIFN0cmluZyBiQWRkcmVzcyA9ICJudWxsIjsKICAgICAgICAgICAgICAgICAg\nICBpZihjaGFubmVsICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGJBZGRyZXNzID0gY2hhbm5lbC5nZXRSZW1vdGVBZGRyZXNzKCkudG9TdHJp\nbmcoKTsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5v\ndCB3cml0ZSByZXF1ZXN0IGZvciBhZGRpbmcgZW50cnk6ICIgKyBrZXkuZW50\ncnlJZCArICIgbGVkZ2VyLWlkOiAiCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsga2V5LmxlZGdlcklkICsgIiBib29raWU6ICIgKyBiQWRkcmVz\ncyk7CgogICAgICAgICAgICAgICAgICAgIGFkZENvbXBsZXRpb24uY2Iud3Jp\ndGVDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2\nYWlsYWJsZUV4Y2VwdGlvbiwga2V5LmxlZGdlcklkLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkuZW50\ncnlJZCwgYWRkciwgYWRkQ29tcGxldGlvbi5jdHgpOwogICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiSW52b2tlZCBjYWxsYmFjayBtZXRob2Q6ICIg\nKyBrZXkuZW50cnlJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgfSk7CgogICAgfQoKICAgIC8qKgogICAgICogRXJyb3Jz\nIG91dCBwZW5kaW5nIGVudHJpZXMuIFdlIGNhbGwgdGhpcyBtZXRob2QgZnJv\nbSBvbmUgdGhyZWFkIHRvIGF2b2lkCiAgICAgKiBjb25jdXJyZW50IGV4ZWN1\ndGlvbnMgdG8gUXVvcnVtT3BNb25pdG9yIChpbXBsZW1lbnRzIGNhbGxiYWNr\ncykuIEl0IHNlZW1zCiAgICAgKiBzaW1wbGVyIHRvIGNhbGwgaXQgZnJvbSBC\nb29raWVIYW5kbGUgaW5zdGVhZCBvZiBjYWxsaW5nIGRpcmVjdGx5IGZyb20K\nICAgICAqIGhlcmUuCiAgICAgKi8KCiAgICB2b2lkIGVycm9yT3V0T3V0c3Rh\nbmRpbmdFbnRyaWVzKCkgewoKICAgICAgICAvLyBETyBOT1QgcmV3cml0ZSB0\naGVzZSB1c2luZyBNYXAuRW50cnkgaXRlcmF0aW9ucy4gV2Ugd2FudCB0byBp\ndGVyYXRlCiAgICAgICAgLy8gb24ga2V5cyBhbmQgc2VlIGlmIHdlIGFyZSBz\ndWNjZXNzZnVsbHkgYWJsZSB0byByZW1vdmUgdGhlIGtleSBmcm9tCiAgICAg\nICAgLy8gdGhlIG1hcC4gQmVjYXVzZSB0aGUgYWRkIGFuZCB0aGUgcmVhZCBt\nZXRob2RzIGFsc28gZG8gdGhlIHNhbWUgdGhpbmcKICAgICAgICAvLyBpbiBj\nYXNlIHRoZXkgZ2V0IGEgd3JpdGUgZmFpbHVyZSBvbiB0aGUgc29ja2V0LiBU\naGUgb25lIHdobwogICAgICAgIC8vIHN1Y2Nlc3NmdWxseSByZW1vdmVzIHRo\nZSBrZXkgZnJvbSB0aGUgbWFwIGlzIHRoZSBvbmUgcmVzcG9uc2libGUgZm9y\nCiAgICAgICAgLy8gY2FsbGluZyB0aGUgYXBwbGljYXRpb24gY2FsbGJhY2su\nCgogICAgICAgIGZvciAoQ29tcGxldGlvbktleSBrZXkgOiBhZGRDb21wbGV0\naW9ucy5rZXlTZXQoKSkgewogICAgICAgICAgICBlcnJvck91dEFkZEtleShr\nZXkpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChDb21wbGV0aW9uS2V5IGtl\neSA6IHJlYWRDb21wbGV0aW9ucy5rZXlTZXQoKSkgewogICAgICAgICAgICBl\ncnJvck91dFJlYWRLZXkoa2V5KTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJbiB0aGUgbmV0dHkgcGlwZWxpbmUsIHdlIG5lZWQgdG8gc3Bs\naXQgcGFja2V0cyBiYXNlZCBvbiBsZW5ndGgsIHNvIHdlCiAgICAgKiB1c2Ug\ndGhlIHtAbGluayBMZW5ndGhGaWVsZEJhc2VkRnJhbWVEZWNvZGVyfS4gT3Ro\nZXIgdGhhbiB0aGF0IGFsbCBhY3Rpb25zCiAgICAgKiBhcmUgY2FycmllZCBv\ndXQgaW4gdGhpcyBjbGFzcywgZS5nLiwgbWFraW5nIHNlbnNlIG9mIHJlY2Vp\ndmVkIG1lc3NhZ2VzLAogICAgICogcHJlcGVuZGluZyB0aGUgbGVuZ3RoIHRv\nIG91dGdvaW5nIHBhY2tldHMgZXRjLgogICAgICovCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyBDaGFubmVsUGlwZWxpbmUgZ2V0UGlwZWxpbmUoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBDaGFubmVsUGlwZWxpbmUgcGlwZWxp\nbmUgPSBDaGFubmVscy5waXBlbGluZSgpOwogICAgICAgIHBpcGVsaW5lLmFk\nZExhc3QoImxlbmd0aGJhc2VkZnJhbWVkZWNvZGVyIiwgbmV3IExlbmd0aEZp\nZWxkQmFzZWRGcmFtZURlY29kZXIoTUFYX0ZSQU1FX0xFTkdUSCwgMCwgNCwg\nMCwgNCkpOwogICAgICAgIHBpcGVsaW5lLmFkZExhc3QoIm1haW5oYW5kbGVy\nIiwgdGhpcyk7CiAgICAgICAgcmV0dXJuIHBpcGVsaW5lOwogICAgfQoKICAg\nIC8qKgogICAgICogSWYgb3VyIGNoYW5uZWwgaGFzIGRpc2Nvbm5lY3RlZCwg\nd2UganVzdCBlcnJvciBvdXQgdGhlIHBlbmRpbmcgZW50cmllcwogICAgICov\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGNoYW5uZWxEaXNjb25u\nZWN0ZWQoQ2hhbm5lbEhhbmRsZXJDb250ZXh0IGN0eCwgQ2hhbm5lbFN0YXRl\nRXZlbnQgZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTE9HLmluZm8o\nIkRpc2Nvbm5lY3RlZCBmcm9tIGJvb2tpZTogIiArIGFkZHIpOwogICAgICAg\nIGVycm9yT3V0T3V0c3RhbmRpbmdFbnRyaWVzKCk7CiAgICAgICAgY2hhbm5l\nbC5jbG9zZSgpOwoKICAgICAgICBzdGF0ZSA9IENvbm5lY3Rpb25TdGF0ZS5E\nSVNDT05ORUNURUQ7CgogICAgICAgIC8vIHdlIGRvbid0IHdhbnQgdG8gcmVj\nb25uZWN0IHJpZ2h0IGF3YXkuIElmIHNvbWVvbmUgc2VuZHMgYSByZXF1ZXN0\nIHRvCiAgICAgICAgLy8gdGhpcyBhZGRyZXNzLCB3ZSB3aWxsIHJlY29ubmVj\ndC4KICAgIH0KCiAgICAvKioKICAgICAqIENhbGxlZCBieSBuZXR0eSB3aGVu\nIGFuIGV4Y2VwdGlvbiBoYXBwZW5zIGluIG9uZSBvZiB0aGUgbmV0dHkgdGhy\nZWFkcwogICAgICogKG1vc3RseSBkdWUgdG8gd2hhdCB3ZSBkbyBpbiB0aGUg\nbmV0dHkgdGhyZWFkcykKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCBleGNlcHRpb25DYXVnaHQoQ2hhbm5lbEhhbmRsZXJDb250ZXh0\nIGN0eCwgRXhjZXB0aW9uRXZlbnQgZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgVGhyb3dhYmxlIHQgPSBlLmdldENhdXNlKCk7CiAgICAgICAgaWYg\nKHQgaW5zdGFuY2VvZiBDb3JydXB0ZWRGcmFtZUV4Y2VwdGlvbiB8fCB0IGlu\nc3RhbmNlb2YgVG9vTG9uZ0ZyYW1lRXhjZXB0aW9uKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiQ29ycnVwdGVkIGZyYW0gcmVjZWl2ZWQgZnJvbSBib29r\naWU6ICIKICAgICAgICAgICAgICAgICAgICAgICsgZS5nZXRDaGFubmVsKCku\nZ2V0UmVtb3RlQWRkcmVzcygpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICBpZiAodCBpbnN0YW5jZW9mIElPRXhjZXB0aW9uKSB7\nCiAgICAgICAgICAgIC8vIHRoZXNlIGFyZSB0aHJvd24gd2hlbiBhIGJvb2tp\nZSBmYWlscywgbG9nZ2luZyB0aGVtIGp1c3QgcG9sbHV0ZXMKICAgICAgICAg\nICAgLy8gdGhlIGxvZ3MgKHRoZSBmYWlsdXJlIGlzIGxvZ2dlZCBmcm9tIHRo\nZSBsaXN0ZW5lcnMgb24gdGhlIHdyaXRlCiAgICAgICAgICAgIC8vIG9wZXJh\ndGlvbiksIHNvIEknbGwganVzdCBpZ25vcmUgaXQgaGVyZS4KICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTE9HLmVycm9yKCJVbmV4\ncGVjdGVkIGV4Y2VwdGlvbiBjYXVnaHQgYnkgYm9va2llIGNsaWVudCBjaGFu\nbmVsIGhhbmRsZXIiLCB0KTsKICAgICAgICAvLyBTaW5jZSB3ZSBhcmUgYSBs\naWJyYXJ5LCBjYW50IHRlcm1pbmF0ZSBBcHAgaGVyZSwgY2FuIHdlPwogICAg\nfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IG5ldHR5IHdoZW4gYSBtZXNz\nYWdlIGlzIHJlY2VpdmVkIG9uIGEgY2hhbm5lbAogICAgICovCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyB2b2lkIG1lc3NhZ2VSZWNlaXZlZChDaGFubmVs\nSGFuZGxlckNvbnRleHQgY3R4LCBNZXNzYWdlRXZlbnQgZSkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgaWYgKCEoZS5nZXRNZXNzYWdlKCkgaW5zdGFu\nY2VvZiBDaGFubmVsQnVmZmVyKSkgewogICAgICAgICAgICBjdHguc2VuZFVw\nc3RyZWFtKGUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBmaW5hbCBDaGFubmVsQnVmZmVyIGJ1ZmZlciA9IChDaGFubmVsQnVm\nZmVyKSBlLmdldE1lc3NhZ2UoKTsKICAgICAgICBmaW5hbCBpbnQgdHlwZSwg\ncmM7CiAgICAgICAgZmluYWwgbG9uZyBsZWRnZXJJZCwgZW50cnlJZDsKICAg\nICAgICBmaW5hbCBQYWNrZXRIZWFkZXIgaGVhZGVyOwoKICAgICAgICB0cnkg\newogICAgICAgICAgICBoZWFkZXIgPSBQYWNrZXRIZWFkZXIuZnJvbUludChi\ndWZmZXIucmVhZEludCgpKTsKICAgICAgICAgICAgcmMgPSBidWZmZXIucmVh\nZEludCgpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGJ1ZmZlci5yZWFkTG9u\nZygpOwogICAgICAgICAgICBlbnRyeUlkID0gYnVmZmVyLnJlYWRMb25nKCk7\nCiAgICAgICAgfSBjYXRjaCAoSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBl\neCkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlVucGFyc2VhYmxlIHJlc3Bv\nbnNlIGZyb20gYm9va2llOiAiICsgYWRkciwgZXgpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBleGVjdXRvci5zdWJtaXRPcmRl\ncmVkKGxlZGdlcklkLCBuZXcgU2FmZVJ1bm5hYmxlKCkgewogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigp\nIHsKICAgICAgICAgICAgICAgIHN3aXRjaCAoaGVhZGVyLmdldE9wQ29kZSgp\nKSB7CiAgICAgICAgICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkFEREVO\nVFJZOgogICAgICAgICAgICAgICAgICAgIGhhbmRsZUFkZFJlc3BvbnNlKGxl\nZGdlcklkLCBlbnRyeUlkLCByYyk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLlJFQURF\nTlRSWToKICAgICAgICAgICAgICAgICAgICBoYW5kbGVSZWFkUmVzcG9uc2Uo\nbGVkZ2VySWQsIGVudHJ5SWQsIHJjLCBidWZmZXIpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIlVuZXhwZWN0ZWQgcmVzcG9uc2Us\nIHR5cGU6ICIgKyBoZWFkZXIuZ2V0T3BDb2RlKCkgCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiByZWNlaXZlZCBmcm9tIGJvb2tpZTogIiAr\nIGFkZHIgKyAiICwgaWdub3JpbmciKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIHZvaWQgaGFuZGxl\nQWRkUmVzcG9uc2UobG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLCBpbnQg\ncmMpIHsKICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAg\nICAgICAgICAgTE9HLmRlYnVnKCJHb3QgcmVzcG9uc2UgZm9yIGFkZCByZXF1\nZXN0IGZyb20gYm9va2llOiAiICsgYWRkciArICIgZm9yIGxlZGdlcjogIiAr\nIGxlZGdlcklkICsgIiBlbnRyeTogIgogICAgICAgICAgICAgICAgICAgICAg\nKyBlbnRyeUlkICsgIiByYzogIiArIHJjKTsKICAgICAgICB9CgogICAgICAg\nIC8vIGNvbnZlcnQgdG8gQktFeGNlcHRpb24gY29kZSBiZWNhdXNlIHRoYXRz\nIHdoYXQgdGhlIHVwcHBlcgogICAgICAgIC8vIGxheWVycyBleHBlY3QuIFRo\naXMgaXMgVUdMWSwgdGhlcmUgc2hvdWxkIGp1c3QgYmUgb25lIHNldCBvZgog\nICAgICAgIC8vIGVycm9yIGNvZGVzLgogICAgICAgIHN3aXRjaCAocmMpIHsK\nICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkVPSzoKICAgICAgICAgICAg\ncmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgICAgICBicmVhazsK\nICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkVCQURWRVJTSU9OOgogICAg\nICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuUHJvdG9jb2xWZXJzaW9u\nRXhjZXB0aW9uOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEJv\nb2tpZVByb3RvY29sLkVGRU5DRUQ6CiAgICAgICAgICAgIHJjID0gQktFeGNl\ncHRpb24uQ29kZS5MZWRnZXJGZW5jZWRFeGNlcHRpb247CiAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6IAogICAgICAgICAgICBMT0cuZXJy\nb3IoIkFkZCBmb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQgKyAiLCBlbnRyeTog\nIiArIGVudHJ5SWQgKyAiIGZhaWxlZCBvbiBib29raWU6ICIgKyBhZGRyCiAg\nICAgICAgICAgICAgICAgICAgICArICIgd2l0aCBjb2RlOiAiICsgcmMpOwog\nICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuV3JpdGVFeGNlcHRp\nb247CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAgICAgICAgQWRk\nQ29tcGxldGlvbiBhYzsKICAgICAgICBhYyA9IGFkZENvbXBsZXRpb25zLnJl\nbW92ZShuZXcgQ29tcGxldGlvbktleShsZWRnZXJJZCwgZW50cnlJZCkpOwog\nICAgICAgIGlmIChhYyA9PSBudWxsKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiVW5leHBlY3RlZCBhZGQgcmVzcG9uc2UgcmVjZWl2ZWQgZnJvbSBib29r\naWU6ICIgKyBhZGRyICsgIiBmb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQKICAg\nICAgICAgICAgICAgICAgICAgICsgIiwgZW50cnk6ICIgKyBlbnRyeUlkICsg\nIiAsIGlnbm9yaW5nIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIC8vIHRvdGFsQnl0ZXNPdXRzdGFuZGluZy5hZGRBbmRHZXQo\nLWFjLnNpemUpOwoKICAgICAgICBhYy5jYi53cml0ZUNvbXBsZXRlKHJjLCBs\nZWRnZXJJZCwgZW50cnlJZCwgYWRkciwgYWMuY3R4KTsKCiAgICB9CgogICAg\ndm9pZCBoYW5kbGVSZWFkUmVzcG9uc2UobG9uZyBsZWRnZXJJZCwgbG9uZyBl\nbnRyeUlkLCBpbnQgcmMsIENoYW5uZWxCdWZmZXIgYnVmZmVyKSB7CiAgICAg\nICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIExP\nRy5kZWJ1ZygiR290IHJlc3BvbnNlIGZvciByZWFkIHJlcXVlc3QgZnJvbSBi\nb29raWU6ICIgKyBhZGRyICsgIiBmb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQg\nKyAiIGVudHJ5OiAiCiAgICAgICAgICAgICAgICAgICAgICArIGVudHJ5SWQg\nKyAiIHJjOiAiICsgcmMgKyAiZW50cnkgbGVuZ3RoOiAiICsgYnVmZmVyLnJl\nYWRhYmxlQnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBjb252ZXJ0\nIHRvIEJLRXhjZXB0aW9uIGNvZGUgYmVjYXVzZSB0aGF0cyB3aGF0IHRoZSB1\ncHBwZXIKICAgICAgICAvLyBsYXllcnMgZXhwZWN0LiBUaGlzIGlzIFVHTFks\nIHRoZXJlIHNob3VsZCBqdXN0IGJlIG9uZSBzZXQgb2YKICAgICAgICAvLyBl\ncnJvciBjb2Rlcy4KICAgICAgICBpZiAocmMgPT0gQm9va2llUHJvdG9jb2wu\nRU9LKSB7CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5PSzsK\nICAgICAgICB9IGVsc2UgaWYgKHJjID09IEJvb2tpZVByb3RvY29sLkVOT0VO\nVFJZIHx8IHJjID09IEJvb2tpZVByb3RvY29sLkVOT0xFREdFUikgewogICAg\nICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNoRW50cnlFeGNl\ncHRpb247CiAgICAgICAgfSBlbHNlIGlmIChyYyA9PSBCb29raWVQcm90b2Nv\nbC5FQkFEVkVSU0lPTikgewogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9u\nLkNvZGUuUHJvdG9jb2xWZXJzaW9uRXhjZXB0aW9uOwogICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiUmVhZCBmb3IgbGVkZ2VyOiAi\nICsgbGVkZ2VySWQgKyAiLCBlbnRyeTogIiArIGVudHJ5SWQgKyAiIGZhaWxl\nZCBvbiBib29raWU6ICIgKyBhZGRyCiAgICAgICAgICAgICAgICAgICAgICAr\nICIgd2l0aCBjb2RlOiAiICsgcmMpOwogICAgICAgICAgICByYyA9IEJLRXhj\nZXB0aW9uLkNvZGUuUmVhZEV4Y2VwdGlvbjsKICAgICAgICB9CgogICAgICAg\nIENvbXBsZXRpb25LZXkga2V5ID0gbmV3IENvbXBsZXRpb25LZXkobGVkZ2Vy\nSWQsIGVudHJ5SWQpOwogICAgICAgIFJlYWRDb21wbGV0aW9uIHJlYWRDb21w\nbGV0aW9uID0gcmVhZENvbXBsZXRpb25zLnJlbW92ZShrZXkpOwoKICAgICAg\nICBpZiAocmVhZENvbXBsZXRpb24gPT0gbnVsbCkgewogICAgICAgICAgICAv\nKgogICAgICAgICAgICAgKiBUaGlzIGlzIGEgc3BlY2lhbCBjYXNlLiBXaGVu\nIHJlY292ZXJpbmcgYSBsZWRnZXIsIGEgY2xpZW50CiAgICAgICAgICAgICAq\nIHN1Ym1pdHMgYSByZWFkIHJlcXVlc3Qgd2l0aCBpZCAtMSwgYW5kIHJlY2Vp\ndmVzIGEgcmVzcG9uc2Ugd2l0aCBhCiAgICAgICAgICAgICAqIGRpZmZlcmVu\ndCBlbnRyeSBpZC4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIHJlYWRD\nb21wbGV0aW9uID0gcmVhZENvbXBsZXRpb25zLnJlbW92ZShuZXcgQ29tcGxl\ndGlvbktleShsZWRnZXJJZCwgLTEpKTsKICAgICAgICB9CgogICAgICAgIGlm\nIChyZWFkQ29tcGxldGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgIExPRy5l\ncnJvcigiVW5leHBlY3RlZCByZWFkIHJlc3BvbnNlIHJlY2VpdmVkIGZyb20g\nYm9va2llOiAiICsgYWRkciArICIgZm9yIGxlZGdlcjogIiArIGxlZGdlcklk\nCiAgICAgICAgICAgICAgICAgICAgICArICIsIGVudHJ5OiAiICsgZW50cnlJ\nZCArICIgLCBpZ25vcmluZyIpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICByZWFkQ29tcGxldGlvbi5jYi5yZWFkRW50cnlDb21w\nbGV0ZShyYywgbGVkZ2VySWQsIGVudHJ5SWQsIGJ1ZmZlci5zbGljZSgpLCBy\nZWFkQ29tcGxldGlvbi5jdHgpOwogICAgfQoKICAgIC8qKgogICAgICogQm9p\nbGVyLXBsYXRlIHdyYXBwZXIgY2xhc3NlcyBmb2xsb3cKICAgICAqCiAgICAg\nKi8KICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmcKICAgIHN0YXRpYyBjbGFz\ncyBSZWFkQ29tcGxldGlvbiB7CiAgICAgICAgZmluYWwgUmVhZEVudHJ5Q2Fs\nbGJhY2sgY2I7CiAgICAgICAgZmluYWwgT2JqZWN0IGN0eDsKCiAgICAgICAg\ncHVibGljIFJlYWRDb21wbGV0aW9uKFJlYWRFbnRyeUNhbGxiYWNrIGNiLCBP\nYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHRoaXMuY2IgPSBjYjsKICAgICAg\nICAgICAgdGhpcy5jdHggPSBjdHg7CiAgICAgICAgfQogICAgfQoKICAgIC8v\nIHZpc2libGUgZm9yIHRlc3RpbmcKICAgIHN0YXRpYyBjbGFzcyBBZGRDb21w\nbGV0aW9uIHsKICAgICAgICBmaW5hbCBXcml0ZUNhbGxiYWNrIGNiOwogICAg\nICAgIC8vZmluYWwgbG9uZyBzaXplOwogICAgICAgIGZpbmFsIE9iamVjdCBj\ndHg7CgogICAgICAgIHB1YmxpYyBBZGRDb21wbGV0aW9uKFdyaXRlQ2FsbGJh\nY2sgY2IsIGxvbmcgc2l6ZSwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICB0\naGlzLmNiID0gY2I7CiAgICAgICAgICAgIC8vdGhpcy5zaXplID0gc2l6ZTsK\nICAgICAgICAgICAgdGhpcy5jdHggPSBjdHg7CiAgICAgICAgfQogICAgfQog\nICAgCiAgICAvLyB2aXNhYmxlIGZvciB0ZXN0aW5nCiAgICBzdGF0aWMgY2xh\nc3MgQ29tcGxldGlvbktleSB7CiAgICAgICAgbG9uZyBsZWRnZXJJZDsKICAg\nICAgICBsb25nIGVudHJ5SWQ7CgogICAgICAgIENvbXBsZXRpb25LZXkobG9u\nZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgICAgIHRoaXMu\nbGVkZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5lbnRyeUlk\nID0gZW50cnlJZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3Qgb2JqKSB7CiAgICAg\nICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIENvbXBsZXRpb25LZXkpIHx8\nIG9iaiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ29tcGxldGlvbktleSB0aGF0\nID0gKENvbXBsZXRpb25LZXkpIG9iajsKICAgICAgICAgICAgcmV0dXJuIHRo\naXMubGVkZ2VySWQgPT0gdGhhdC5sZWRnZXJJZCAmJiB0aGlzLmVudHJ5SWQg\nPT0gdGhhdC5lbnRyeUlkOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAg\ncmV0dXJuICgoaW50KSBsZWRnZXJJZCA8PCAxNikgXiAoKGludCkgZW50cnlJ\nZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5n\nKCkgewogICAgICAgICAgICByZXR1cm4gU3RyaW5nLmZvcm1hdCgiTGVkZ2Vy\nRW50cnkoJWQsICVkKSIsIGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAgICB9\nCiAgICB9Cgp9Cg==\n","encoding":"base64"}

