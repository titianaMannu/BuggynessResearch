{"sha":"8a9f6c295b20e5b4377e4a605ca79e9c8b3eba6d","node_id":"MDQ6QmxvYjE1NzU5NTY6OGE5ZjZjMjk1YjIwZTViNDM3N2U0YTYwNWNhNzllOWM4YjNlYmE2ZA==","size":5828,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8a9f6c295b20e5b4377e4a605ca79e9c8b3eba6d","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnN0cmVhbWluZzsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5J\nbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9y\ndCBqYXZhLnV0aWwuRW51bWVyYXRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyRW50cnk7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKCnB1YmxpYyBjbGFzcyBMZWRnZXJJbnB1dFN0cmVhbSBleHRlbmRz\nIElucHV0U3RyZWFtIHsKICAgIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5\nLmdldExvZ2dlcihMZWRnZXJJbnB1dFN0cmVhbS5jbGFzcyk7CiAgICBwcml2\nYXRlIExlZGdlckhhbmRsZSBsaDsKICAgIHByaXZhdGUgQnl0ZUJ1ZmZlciBi\neXRlYnVmZjsKICAgIGJ5dGVbXSBiYnl0ZXM7CiAgICBsb25nIGxhc3RFbnRy\neSA9IDA7CiAgICBpbnQgaW5jcmVtZW50ID0gNTA7CiAgICBpbnQgZGVmYXVs\ndFNpemUgPSAxMDI0ICogMTAyNDsgLy8gMU1CIGRlZmF1bHQgc2l6ZQogICAg\nRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGxlZGdlclNlcSA9IG51bGw7Cgog\nICAgLyoqCiAgICAgKiBjb25zdHJ1Y3QgYSBvdXRwdXRzdHJlYW0gZnJvbSBh\nIGxlZGdlciBoYW5kbGUKICAgICAqCiAgICAgKiBAcGFyYW0gbGgKICAgICAq\nICAgICAgICAgICAgbGVkZ2VyIGhhbmRsZQogICAgICogQHRocm93cyB7QGxp\nbmsgQktFeGNlcHRpb259LCB7QGxpbmsgSW50ZXJydXB0ZWRFeGNlcHRpb259\nCiAgICAgKi8KICAgIHB1YmxpYyBMZWRnZXJJbnB1dFN0cmVhbShMZWRnZXJI\nYW5kbGUgbGgpIHRocm93cyBCS0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgIHRoaXMubGggPSBsaDsKICAgICAgICBiYnl0ZXMg\nPSBuZXcgYnl0ZVtkZWZhdWx0U2l6ZV07CiAgICAgICAgdGhpcy5ieXRlYnVm\nZiA9IEJ5dGVCdWZmZXIud3JhcChiYnl0ZXMpOwogICAgICAgIHRoaXMuYnl0\nZWJ1ZmYucG9zaXRpb24odGhpcy5ieXRlYnVmZi5saW1pdCgpKTsKICAgICAg\nICBsYXN0RW50cnkgPSBNYXRoLm1pbihsaC5nZXRMYXN0QWRkQ29uZmlybWVk\nKCksIGluY3JlbWVudCk7CiAgICAgICAgbGVkZ2VyU2VxID0gbGgucmVhZEVu\ndHJpZXMoMCwgbGFzdEVudHJ5KTsKICAgIH0KCiAgICAvKioKICAgICAqIGNv\nbnN0cnVjdCBhIG91dHB1dHN0cmVhbSBmcm9tIGEgbGVkZ2VyIGhhbmRsZQog\nICAgICoKICAgICAqIEBwYXJhbSBsaAogICAgICogICAgICAgICAgICB0aGUg\nbGVkZ2VyIGhhbmRsZQogICAgICogQHBhcmFtIHNpemUKICAgICAqICAgICAg\nICAgICAgdGhlIHNpemUgb2YgdGhlIGJ1ZmZlcgogICAgICogQHRocm93cyB7\nQGxpbmsgQktFeGNlcHRpb259LCB7QGxpbmsgSW50ZXJydXB0ZWRFeGNlcHRp\nb259CiAgICAgKi8KICAgIHB1YmxpYyBMZWRnZXJJbnB1dFN0cmVhbShMZWRn\nZXJIYW5kbGUgbGgsIGludCBzaXplKSB0aHJvd3MgQktFeGNlcHRpb24sIElu\ndGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICB0aGlzLmxoID0gbGg7CiAg\nICAgICAgYmJ5dGVzID0gbmV3IGJ5dGVbc2l6ZV07CiAgICAgICAgdGhpcy5i\neXRlYnVmZiA9IEJ5dGVCdWZmZXIud3JhcChiYnl0ZXMpOwogICAgICAgIHRo\naXMuYnl0ZWJ1ZmYucG9zaXRpb24odGhpcy5ieXRlYnVmZi5saW1pdCgpKTsK\nICAgICAgICBsYXN0RW50cnkgPSBNYXRoLm1pbihsaC5nZXRMYXN0QWRkQ29u\nZmlybWVkKCksIGluY3JlbWVudCk7CiAgICAgICAgbGVkZ2VyU2VxID0gbGgu\ncmVhZEVudHJpZXMoMCwgbGFzdEVudHJ5KTsKICAgIH0KCiAgICAvKioKICAg\nICAqIE1ldGhvZCBjbG9zZSBjdXJyZW50bHkgZG9lc24ndCBkbyBhbnl0aGlu\nZy4gVGhlIGFwcGxpY2F0aW9uCiAgICAgKiBpcyBzdXBwb3NlZCB0byBvcGVu\nIGFuZCBjbG9zZSB0aGUgbGVkZ2VyIGhhbmRsZSBiYWNraW5nIHVwCiAgICAg\nKiBhIHN0cmVhbSAoe0BsaW5rIExlZGdlckhhbmRsZX0pLgogICAgICovCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAg\nIC8vIGRvIG5vdGhpbmcKICAgICAgICAvLyBsZXQgdGhlIGFwcGxpY2F0aW9u\nCiAgICAgICAgLy8gY2xvc2UgdGhlIGxlZGdlcgogICAgfQoKICAgIC8qKgog\nICAgICogcmVmaWxsIHRoZSBidWZmZXIsIHdlIG5lZWQgdG8gcmVhZCBtb3Jl\nIGJ5dGVzCiAgICAgKgogICAgICogQHJldHVybiBpZiB3ZSBjYW4gcmVmaWxs\nIG9yIG5vdAogICAgICovCiAgICBwcml2YXRlIHN5bmNocm9uaXplZCBib29s\nZWFuIHJlZmlsbCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgYnl0\nZWJ1ZmYuY2xlYXIoKTsKICAgICAgICBpZiAoIWxlZGdlclNlcS5oYXNNb3Jl\nRWxlbWVudHMoKSAmJiBsYXN0RW50cnkgPj0gbGguZ2V0TGFzdEFkZENvbmZp\ncm1lZCgpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9\nCiAgICAgICAgaWYgKCFsZWRnZXJTZXEuaGFzTW9yZUVsZW1lbnRzKCkpIHsK\nICAgICAgICAgICAgLy8gZG8gcmVmaWxsCiAgICAgICAgICAgIGxvbmcgbGFz\ndCA9IE1hdGgubWluKGxhc3RFbnRyeSArIGluY3JlbWVudCwgbGguZ2V0TGFz\ndEFkZENvbmZpcm1lZCgpKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGxlZGdlclNlcSA9IGxoLnJlYWRFbnRyaWVzKGxhc3RFbnRyeSAr\nIDEsIGxhc3QpOwogICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBi\naykgewogICAgICAgICAgICAgICAgSU9FeGNlcHRpb24gaWUgPSBuZXcgSU9F\neGNlcHRpb24oYmsuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgIGll\nLmluaXRDYXVzZShiayk7CiAgICAgICAgICAgICAgICB0aHJvdyBpZTsKICAg\nICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsK\nICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJy\ndXB0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFzdEVudHJ5ID0g\nbGFzdDsKICAgICAgICB9CiAgICAgICAgTGVkZ2VyRW50cnkgbGUgPSBsZWRn\nZXJTZXEubmV4dEVsZW1lbnQoKTsKICAgICAgICBiYnl0ZXMgPSBsZS5nZXRF\nbnRyeSgpOwogICAgICAgIGJ5dGVidWZmID0gQnl0ZUJ1ZmZlci53cmFwKGJi\neXRlcyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGludCByZWFkKCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBib29sZWFuIHRvcmVhZCA9IHRydWU7\nCiAgICAgICAgaWYgKGJ5dGVidWZmLnJlbWFpbmluZygpID09IDApIHsKICAg\nICAgICAgICAgLy8gdGhlaXIgYXJlIG5vIHJlbWFpbmluZyBieXRlcwogICAg\nICAgICAgICB0b3JlYWQgPSByZWZpbGwoKTsKICAgICAgICB9CiAgICAgICAg\naWYgKHRvcmVhZCkgewogICAgICAgICAgICBpbnQgcmV0ID0gMHhGRiAmIGJ5\ndGVidWZmLmdldCgpOwogICAgICAgICAgICByZXR1cm4gcmV0OwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gLTE7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgc3luY2hyb25pemVkIGludCByZWFkKGJ5dGVbXSBiKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIC8vIGJlIHNtYXJ0IC4uLiBqdXN0\nIGNvcHkgdGhlIGJ5dGVzCiAgICAgICAgLy8gb25jZSBhbmQgcmV0dXJuIHRo\nZSBzaXplCiAgICAgICAgLy8gdXNlciB3aWxsIGNhbGwgaXQgYWdhaW4KICAg\nICAgICBib29sZWFuIHRvcmVhZCA9IHRydWU7CiAgICAgICAgaWYgKGJ5dGVi\ndWZmLnJlbWFpbmluZygpID09IDApIHsKICAgICAgICAgICAgdG9yZWFkID0g\ncmVmaWxsKCk7CiAgICAgICAgfQogICAgICAgIGlmICh0b3JlYWQpIHsKICAg\nICAgICAgICAgaW50IGJjb3BpZWQgPSBieXRlYnVmZi5yZW1haW5pbmcoKTsK\nICAgICAgICAgICAgaW50IHRvY29weSA9IE1hdGgubWluKGJjb3BpZWQsIGIu\nbGVuZ3RoKTsKICAgICAgICAgICAgLy8gY2Fubm90IHVzZWQgZ2V0cyBiZWNh\ndXNlIG9mCiAgICAgICAgICAgIC8vIHRoZSB1bmRlcmZsb3cvb3ZlcmZsb3cg\nZXhjZXB0aW9ucwogICAgICAgICAgICBTeXN0ZW0uYXJyYXljb3B5KGJieXRl\ncywgYnl0ZWJ1ZmYucG9zaXRpb24oKSwgYiwgMCwgdG9jb3B5KTsKICAgICAg\nICAgICAgYnl0ZWJ1ZmYucG9zaXRpb24oYnl0ZWJ1ZmYucG9zaXRpb24oKSAr\nIHRvY29weSk7CiAgICAgICAgICAgIHJldHVybiB0b2NvcHk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiAtMTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBzeW5jaHJvbml6ZWQgaW50IHJlYWQoYnl0ZVtdIGIsIGludCBv\nZmYsIGludCBsZW4pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nYWdhaW4gZG9udCBuZWVkIG90IGZ1bGx5CiAgICAgICAgLy8gZmlsbCBiLCBq\ndXN0IHJldHVybgogICAgICAgIC8vIHdoYXQgd2UgaGF2ZSBhbmQgbGV0IHRo\nZSBhcHBsaWNhdGlvbiBjYWxsIHJlYWQKICAgICAgICAvLyBhZ2FpbgogICAg\nICAgIGJvb2xlYW4gdG9yZWFkID0gdHJ1ZTsKICAgICAgICBpZiAoYnl0ZWJ1\nZmYucmVtYWluaW5nKCkgPT0gMCkgewogICAgICAgICAgICB0b3JlYWQgPSBy\nZWZpbGwoKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRvcmVhZCkgewogICAg\nICAgICAgICBpbnQgYmNvcGllZCA9IGJ5dGVidWZmLnJlbWFpbmluZygpOwog\nICAgICAgICAgICBpbnQgdG9jb3B5ID0gTWF0aC5taW4oYmNvcGllZCwgbGVu\nKTsKICAgICAgICAgICAgU3lzdGVtLmFycmF5Y29weShiYnl0ZXMsIGJ5dGVi\ndWZmLnBvc2l0aW9uKCksIGIsIG9mZiwgdG9jb3B5KTsKICAgICAgICAgICAg\nYnl0ZWJ1ZmYucG9zaXRpb24oYnl0ZWJ1ZmYucG9zaXRpb24oKSArIHRvY29w\neSk7CiAgICAgICAgICAgIHJldHVybiB0b2NvcHk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiAtMTsKICAgIH0KfQo=\n","encoding":"base64"}

