{"sha":"18e36c96f49c042cbf218b8a61f2b1371b18908c","node_id":"MDQ6QmxvYjE1NzU5NTY6MThlMzZjOTZmNDljMDQyY2JmMjE4YjhhNjFmMmIxMzcxYjE4OTA4Yw==","size":7603,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/18e36c96f49c042cbf218b8a61f2b1371b18908c","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdDsKCi8qCiAqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBz\nb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4\ncHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAq\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQg\nbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAqLwppbXBv\ncnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0aW9u\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2llOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWUuSm91cm5hbElkRmls\ndGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRn\nZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNs\naWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyOwoKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\nCmltcG9ydCBvcmcuanVuaXQuQXNzZXJ0OwppbXBvcnQgb3JnLmp1bml0LkFm\ndGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5p\ndC5UZXN0OwoKLyoqCiAqIFRoaXMgY2xhc3MgdGVzdHMgdGhhdCBib29raWUg\ncm9sbGluZyBqb3VybmFscwogKi8KcHVibGljIGNsYXNzIEJvb2tpZUpvdXJu\nYWxSb2xsaW5nVGVzdCBleHRlbmRzIEJhc2VUZXN0Q2FzZSB7CiAgICBzdGF0\naWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tp\nZUpvdXJuYWxSb2xsaW5nVGVzdC5jbGFzcyk7CgogICAgRGlnZXN0VHlwZSBk\naWdlc3RUeXBlOwoKICAgIHB1YmxpYyBCb29raWVKb3VybmFsUm9sbGluZ1Rl\nc3QoRGlnZXN0VHlwZSBkaWdlc3RUeXBlKSB7CiAgICAgICAgc3VwZXIoMyk7\nCiAgICAgICAgdGhpcy5kaWdlc3RUeXBlID0gZGlnZXN0VHlwZTsKICAgIH0K\nCiAgICBAQmVmb3JlCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNl\ndFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gU2V0IHVwIHRo\nZSBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMgbmVlZGVkLgogICAgICAgIGJh\nc2VDb25mLnNldE1heEpvdXJuYWxTaXplKDEpOwogICAgICAgIGJhc2VDb25m\nLnNldE1heEJhY2t1cEpvdXJuYWxzKDEpOwogICAgICAgIHN1cGVyLnNldFVw\nKCk7CiAgICB9CgogICAgQEFmdGVyCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nc3VwZXIudGVhckRvd24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbW1v\nbiBtZXRob2QgdG8gY3JlYXRlIGxlZGdlcnMgYW5kIHdyaXRlIGVudHJpZXMg\ndG8gdGhlbS4KICAgICAqLwogICAgcHJpdmF0ZSBMZWRnZXJIYW5kbGVbXSB3\ncml0ZUxlZGdlckVudHJpZXMoaW50IG51bUxlZGdlcnMsIGludCBtc2dTaXpl\nLCBpbnQgbnVtTXNncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAgICAgTGVkZ2VySGFuZGxlW10gbGhz\nID0gbmV3IExlZGdlckhhbmRsZVtudW1MZWRnZXJzXTsKICAgICAgICBsb25n\nW10gbGVkZ2VySWRzID0gbmV3IGxvbmdbbnVtTGVkZ2Vyc107CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBudW1MZWRnZXJzOyBpKyspIHsKICAgICAg\nICAgICAgbGhzW2ldID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCAi\nIi5nZXRCeXRlcygpKTsKICAgICAgICAgICAgbGVkZ2VySWRzW2ldID0gbGhz\nW2ldLmdldElkKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBDcmVhdGUgYSBk\ndW1teSBtZXNzYWdlIHN0cmluZyB0byB3cml0ZSBhcyBsZWRnZXIgZW50cmll\ncwogICAgICAgIFN0cmluZ0J1aWxkZXIgbXNnU0IgPSBuZXcgU3RyaW5nQnVp\nbGRlcigpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbXNnU2l6ZTsg\naSsrKSB7CiAgICAgICAgICAgIG1zZ1NCLmFwcGVuZCgiYSIpOwogICAgICAg\nIH0KICAgICAgICBTdHJpbmcgbXNnID0gbXNnU0IudG9TdHJpbmcoKTsKCiAg\nICAgICAgLy8gV3JpdGUgYWxsIG9mIHRoZSBlbnRyaWVzIGZvciBhbGwgb2Yg\ndGhlIGxlZGdlcnMKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bU1z\nZ3M7IGkrKykgewogICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IG51\nbUxlZGdlcnM7IGorKykgewogICAgICAgICAgICAgICAgU3RyaW5nQnVpbGRl\nciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICBz\nYi5hcHBlbmQobGVkZ2VySWRzW2pdKS5hcHBlbmQoJy0nKS5hcHBlbmQoaSku\nYXBwZW5kKCctJykKICAgICAgICAgICAgICAgICAgLmFwcGVuZChtc2cpOwog\nICAgICAgICAgICAgICAgbGhzW2pdLmFkZEVudHJ5KHNiLnRvU3RyaW5nKCku\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIC8vIFJldHVybiB0aGUgbGVkZ2VyIGhhbmRsZXMgdG8gdGhlIGluc2VydGVk\nIGxlZGdlcnMgYW5kIGVudHJpZXMKICAgICAgICByZXR1cm4gbGhzOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCB2YWxpZExlZGdlckVudHJpZXMobG9uZ1td\nIGxlZGdlcklkcywgaW50IG1zZ1NpemUsIGludCBudW1Nc2dzKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAvLyBPcGVuIHRoZSBsZWRnZXJzCiAgICAg\nICAgTGVkZ2VySGFuZGxlW10gbGhzID0gbmV3IExlZGdlckhhbmRsZVtsZWRn\nZXJJZHMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGxo\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBsaHNbaV0gPSBia2Mub3Bl\nbkxlZGdlcihsZWRnZXJJZHNbaV0sIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVz\nKCkpOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nQnVpbGRlciBtc2dTQiA9\nIG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBtc2dTaXplOyBpKyspIHsKICAgICAgICAgICAgbXNnU0IuYXBwZW5k\nKCJhIik7CiAgICAgICAgfQogICAgICAgIFN0cmluZyBtc2cgPSBtc2dTQi50\nb1N0cmluZygpOwoKICAgICAgICBpbnQgbnVtVG9SZWFkID0gMTA7CiAgICAg\nICAgLy8gcmVhZCBhbGwgb2YgdGhlIGVudHJpZXMgZm9yIGFsbCB0aGUgbGVk\nZ2VycwogICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgbGhzLmxlbmd0aDsg\naisrKSB7CiAgICAgICAgICAgIGludCBzdGFydCA9IDA7CiAgICAgICAgICAg\nIGludCByZWFkID0gTWF0aC5taW4obnVtVG9SZWFkLCBudW1Nc2dzIC0gc3Rh\ncnQpOwogICAgICAgICAgICBpbnQgZW5kID0gc3RhcnQgKyByZWFkIC0gMTsK\nICAgICAgICAgICAgaW50IGVudHJ5SWQgPSAwOwogICAgICAgICAgICBpZiAo\nTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIExPRy5k\nZWJ1ZygiVmFsaWRhdGluZyBFbnRyaWVzIG9mIExlZGdlciAiICsgbGVkZ2Vy\nSWRzW2pdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoc3Rh\ncnQgPCBudW1Nc2dzKSB7CiAgICAgICAgICAgICAgICBFbnVtZXJhdGlvbjxM\nZWRnZXJFbnRyeT4gc2VxID0gbGhzW2pdLnJlYWRFbnRyaWVzKHN0YXJ0LCBl\nbmQpOwogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRW51bWVyYXRpb24g\nb2YgbGVkZ2VyIGVudHJpZXMgaGFzIG5vIGVsZW1lbnQiLCBzZXEuaGFzTW9y\nZUVsZW1lbnRzKCkgPT0gdHJ1ZSk7CiAgICAgICAgICAgICAgICB3aGlsZSAo\nc2VxLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAgICAgICAg\nTGVkZ2VyRW50cnkgZSA9IHNlcS5uZXh0RWxlbWVudCgpOwogICAgICAgICAg\nICAgICAgICAgIGFzc2VydEVxdWFscyhlbnRyeUlkLCBlLmdldEVudHJ5SWQo\nKSk7CgogICAgICAgICAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBu\nZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAgICAgICAgICAgIHNiLmFw\ncGVuZChsZWRnZXJJZHNbal0pLmFwcGVuZCgnLScpLmFwcGVuZChlbnRyeUlk\nKS5hcHBlbmQoJy0nKQogICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCht\nc2cpOwogICAgICAgICAgICAgICAgICAgIEFzc2VydC5hc3NlcnRBcnJheUVx\ndWFscyhzYi50b1N0cmluZygpLmdldEJ5dGVzKCksIGUuZ2V0RW50cnkoKSk7\nCiAgICAgICAgICAgICAgICAgICAgZW50cnlJZCsrOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGVudHJ5SWQgLSAx\nLCBlbmQpOwogICAgICAgICAgICAgICAgc3RhcnQgPSBlbmQgKyAxOwogICAg\nICAgICAgICAgICAgcmVhZCA9IE1hdGgubWluKG51bVRvUmVhZCwgbnVtTXNn\ncyAtIHN0YXJ0KTsKICAgICAgICAgICAgICAgIGVuZCA9IHN0YXJ0ICsgcmVh\nZCAtIDE7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGlzIHRlc3Qgd3JpdGVzIGVub3VnaCBsZWRnZXIgZW50cmll\ncyB0byByb2xsIG92ZXIgdGhlIGpvdXJuYWxzCiAgICAgKgogICAgICogSXQg\nd2lsbCB0aGVuIGtlZXAgb25seSAxIGpvdXJuYWwgZmlsZSBiZWZvcmUgbGFz\ndCBtYXJrZWQgam91cm5hbAogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0\naW9uCiAgICAgKi8KICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0Sm91\ncm5hbFJvbGxpbmcoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRlYnVn\nKCJUZXN0aW5nIEpvdXJuYWwgUm9sbGluZyIpOwogICAgICAgIH0KICAgICAg\nICAvLyBXcml0ZSBlbm91Z2ggbGVkZ2VyIGVudHJpZXMgc28gdGhhdCB3ZSBy\nb2xsIG92ZXIgam91cm5hbHMKICAgICAgICBMZWRnZXJIYW5kbGVbXSBsaHMg\nPSB3cml0ZUxlZGdlckVudHJpZXMoNCwgMTAyNCwgMTAyNCk7CiAgICAgICAg\nbG9uZ1tdIGxlZGdlcklkcyA9IG5ldyBsb25nW2xocy5sZW5ndGhdOwogICAg\nICAgIGZvciAoaW50IGk9MDsgaTxsaHMubGVuZ3RoOyBpKyspIHsKICAgICAg\nICAgICAgbGVkZ2VySWRzW2ldID0gbGhzW2ldLmdldElkKCk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBTbGVlcCBmb3IgYSB3aGlsZSB0byBlbnN1cmUgZGF0\nYSBhcmUgZmx1c2hlZAogICAgICAgIFRocmVhZC5zbGVlcCgyMDAwKTsKCiAg\nICAgICAgLy8gdmVyaWZ5IHRoYXQgd2Ugb25seSBrZWVwIGF0IG1vc3Qgam91\ncm5hbCBmaWxlcyAKICAgICAgICBmb3IgKEZpbGUgam91cm5hbERpciA6IHRt\ncERpcnMpIHsKICAgICAgICAgICAgTGlzdDxMb25nPiBsb2dzID0gQm9va2ll\nLmxpc3RKb3VybmFsSWRzKGpvdXJuYWxEaXIsIG5ldyBKb3VybmFsSWRGaWx0\nZXIoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChsb25nIGpvdXJuYWxJZCkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShs\nb2dzLnNpemUoKSA8PSAyKTsKICAgICAgICB9CgogICAgICAgIC8vIHJlc3Rh\ncnQgYm9va2llcyAKICAgICAgICAvLyBlbnN1cmUgYWZ0ZXIgcmVzdGFydCB3\nZSBjYW4gcmVhZCB0aGUgZW50cmllcyBzaW5jZSBqb3VybmFscyByb2xscwog\nICAgICAgIHJlc3RhcnRCb29raWVzKCk7CiAgICAgICAgdmFsaWRMZWRnZXJF\nbnRyaWVzKGxlZGdlcklkcywgMTAyNCwgMTAyNCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGlzIHRlc3Qgd3JpdGVzIGVub3VnaCBsZWRnZXIgZW50cmll\ncyB0byByb2xsIG92ZXIgdGhlIGpvdXJuYWxzCiAgICAgKiB3aXRob3V0IHN5\nbmMgdXAKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICov\nCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEpvdXJuYWxSb2xsaW5n\nV2l0aG91dFN5bmN1cCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGlm\nIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cuZGVi\ndWcoIlRlc3RpbmcgSm91cm5hbCBSb2xsaW5nIHdpdGhvdXQgc3luYyB1cCIp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gc2V0IGZsdXNoIGludGVydmFsIHRv\nIGEgbGFyZ2UgdmFsdWUKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIG5l\nd0NvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgIG5l\nd0NvbmYuc2V0Rmx1c2hJbnRlcnZhbCg5OTk5OTk5OTkpOwogICAgICAgIC8v\nIHJlc3RhcnQgYm9va2llcwogICAgICAgIHJlc3RhcnRCb29raWVzKG5ld0Nv\nbmYpOwoKICAgICAgICAvLyBXcml0ZSBlbm91Z2ggbGVkZ2VyIGVudHJpZXMg\nc28gdGhhdCB3ZSByb2xsIG92ZXIgam91cm5hbHMKICAgICAgICBMZWRnZXJI\nYW5kbGVbXSBsaHMgPSB3cml0ZUxlZGdlckVudHJpZXMoNCwgMTAyNCwgMTAy\nNCk7CiAgICAgICAgbG9uZ1tdIGxlZGdlcklkcyA9IG5ldyBsb25nW2xocy5s\nZW5ndGhdOwogICAgICAgIGZvciAoaW50IGk9MDsgaTxsaHMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgbGVkZ2VySWRzW2ldID0gbGhzW2ldLmdldElk\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBsZWRnZXIgaW5kZXhlcyBhcmUg\nbm90IGZsdXNoZWQKICAgICAgICAvLyBhbmQgYWZ0ZXIgYm9va2llcyByZXN0\nYXJ0ZWQsIGpvdXJuYWxzIHdpbGwgYmUgcmVsYXllZAogICAgICAgIC8vIGVu\nc3VyZSB0aGF0IHdlIGNhbiBzdGlsbCByZWFkIHRoZSBlbnRyaWVzCiAgICAg\nICAgcmVzdGFydEJvb2tpZXMobmV3Q29uZik7CiAgICAgICAgdmFsaWRMZWRn\nZXJFbnRyaWVzKGxlZGdlcklkcywgMTAyNCwgMTAyNCk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

