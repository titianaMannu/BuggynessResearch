{"sha":"205343979c76b9ac87c150c062b5582607cdaaf9","node_id":"MDQ6QmxvYjE1NzU5NTY6MjA1MzQzOTc5Yzc2YjlhYzg3YzE1MGMwNjJiNTU4MjYwN2NkYWFmOQ==","size":39254,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/205343979c76b9ac87c150c062b5582607cdaaf9","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdDsKCi8qCiAqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBz\nb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4\ncHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAq\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQg\nbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAqLwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLmxhbmcuTm9TdWNoRmllbGRFeGNlcHRpb247CmltcG9y\ndCBqYXZhLmxhbmcuSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1\nZmZlcjsKaW1wb3J0IGphdmEubmlvLmNoYXJzZXQuQ2hhcnNldDsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVy\nYXRpb247CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2YS51\ndGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5TZW1hcGhvcmU7CgoKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmND\nYWxsYmFjay5SZWFkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suUmVhZExhc3RDb25maXJtZWRD\nYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tLZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkxlZGdlckVudHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdHJlYW1pbmcuTGVkZ2VySW5wdXRT\ndHJlYW07CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RyZWFtaW5n\nLkxlZGdlck91dHB1dFN0cmVhbTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcuanVuaXQuQXNzZXJ0\nOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5pdC5U\nZXN0OwoKLyoqCiAqIFRoaXMgdGVzdCB0ZXN0cyByZWFkIGFuZCB3cml0ZSwg\nc3luY2hyb25vdXMgYW5kIGFzeW5jaHJvbm91cywgc3RyaW5ncyBhbmQKICog\naW50ZWdlcnMgZm9yIGEgQm9va0tlZXBlciBjbGllbnQuIFRoZSB0ZXN0IGRl\ncGxveW1lbnQgdXNlcyBhIFpvb0tlZXBlciBzZXJ2ZXIKICogYW5kIHRocmVl\nIEJvb2tLZWVwZXJzLgogKgogKi8KCnB1YmxpYyBjbGFzcyBCb29raWVSZWFk\nV3JpdGVUZXN0IGV4dGVuZHMgQmFzZVRlc3RDYXNlCiAgICBpbXBsZW1lbnRz\nIEFkZENhbGxiYWNrLCBSZWFkQ2FsbGJhY2ssIFJlYWRMYXN0Q29uZmlybWVk\nQ2FsbGJhY2sgewoKICAgIC8vIERlcGVuZGluZyBvbiB0aGUgdGFzdGUsIHNl\nbGVjdCB0aGUgYW1vdW50IG9mIGxvZ2dpbmcKICAgIC8vIGJ5IGRlY29tbWVu\ndGluZyBvbmUgb2YgdGhlIHR3byBsaW5lcyBiZWxvdwogICAgLy8gc3RhdGlj\nIExvZ2dlciBMT0cgPSBMb2dnZXIuZ2V0Um9vdExvZ2dlcigpOwogICAgc3Rh\ndGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihCb29r\naWVSZWFkV3JpdGVUZXN0LmNsYXNzKTsKCiAgICBieXRlW10gbGVkZ2VyUGFz\nc3dvcmQgPSAiYWFhIi5nZXRCeXRlcygpOwogICAgTGVkZ2VySGFuZGxlIGxo\nLCBsaDI7CiAgICBsb25nIGxlZGdlcklkOwogICAgRW51bWVyYXRpb248TGVk\nZ2VyRW50cnk+IGxzOwoKICAgIC8vIHRlc3QgcmVsYXRlZCB2YXJpYWJsZXMK\nICAgIGludCBudW1FbnRyaWVzVG9Xcml0ZSA9IDIwMDsKICAgIGludCBtYXhJ\nbnQgPSAyMTQ3NDgzNjQ3OwogICAgUmFuZG9tIHJuZzsgLy8gUmFuZG9tIE51\nbWJlciBHZW5lcmF0b3IKICAgIEFycmF5TGlzdDxieXRlW10+IGVudHJpZXM7\nIC8vIGdlbmVyYXRlZCBlbnRyaWVzCiAgICBBcnJheUxpc3Q8SW50ZWdlcj4g\nZW50cmllc1NpemU7CgogICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwoKICAg\nIHB1YmxpYyBCb29raWVSZWFkV3JpdGVUZXN0KERpZ2VzdFR5cGUgZGlnZXN0\nVHlwZSkgewogICAgICAgIHN1cGVyKDMpOwogICAgICAgIHRoaXMuZGlnZXN0\nVHlwZSA9IGRpZ2VzdFR5cGU7CiAgICB9CiAgICAvLyBTeW5jaHJvbml6YXRp\nb24KICAgIFN5bmNPYmogc3luYzsKICAgIFNldDxPYmplY3Q+IHN5bmNPYmpz\nOwoKICAgIGNsYXNzIFN5bmNPYmogewogICAgICAgIGxvbmcgbGFzdENvbmZp\ncm1lZDsKICAgICAgICB2b2xhdGlsZSBpbnQgY291bnRlcjsKICAgICAgICBi\nb29sZWFuIHZhbHVlOwoKICAgICAgICBwdWJsaWMgU3luY09iaigpIHsKICAg\nICAgICAgICAgY291bnRlciA9IDA7CiAgICAgICAgICAgIGxhc3RDb25maXJt\nZWQgPSAtMTsKICAgICAgICAgICAgdmFsdWUgPSBmYWxzZTsKICAgICAgICB9\nCiAgICB9CgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RPcGVuRXhj\nZXB0aW9uKCkgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSU9FeGNlcHRpb24s\nIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKDAsIGRpZ2VzdFR5cGUsIGxlZGdl\nclBhc3N3b3JkKTsKICAgICAgICAgICAgZmFpbCgiSGF2ZW4ndCB0aHJvd24g\nZXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkg\newogICAgICAgICAgICBMT0cud2FybigiU3VjY2Vzc2Z1bGx5IHRocm93biBh\nbmQgY2F1Z2h0IGV4Y2VwdGlvbjoiLCBlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiB0ZXN0IHRoZSBzdHJlYW1pbmcgYXBpIGZvciByZWFk\naW5nIGFuZCB3cml0aW5nCiAgICAgKgogICAgICogQHRocm93cyB7QGxpbmsg\nSU9FeGNlcHRpb259LCB7QGxpbmsgS2VlcGVyRXhjZXB0aW9ufQogICAgICov\nCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFN0cmVhbWluZ0NsaWVu\ndHMoKSB0aHJvd3MgSU9FeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiwgQktF\neGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBsaCA9\nIGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQp\nOwogICAgICAgIC8vIHdyaXRlIGEgc3RyaW5nIHNvIHRoYXQgd2UgY25hCiAg\nICAgICAgLy8gY3JlYXRlIGEgYnVmZmVyIG9mIGEgc2luZ2xlIGJ5dGVzCiAg\nICAgICAgLy8gYW5kIGNoZWNrIGZvciBjb3JuZXIgY2FzZXMKICAgICAgICBT\ndHJpbmcgdG9Xcml0ZSA9ICJ3ZSBuZWVkIHRvIGNoZWNrIGZvciB0aGlzIHN0\ncmluZyB0byBtYXRjaCAiICsgImFuZCBmb3IgdGhlIHJlY29yZCBtYWhhZGV2\nIGlzIHRoZSBiZXN0IjsKICAgICAgICBMZWRnZXJPdXRwdXRTdHJlYW0gbG91\ndCA9IG5ldyBMZWRnZXJPdXRwdXRTdHJlYW0obGgsIDEpOwogICAgICAgIGJ5\ndGVbXSBiID0gdG9Xcml0ZS5nZXRCeXRlcygpOwogICAgICAgIGxvdXQud3Jp\ndGUoYik7CiAgICAgICAgbG91dC5jbG9zZSgpOwogICAgICAgIGxvbmcgbElk\nID0gbGguZ2V0SWQoKTsKICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIC8v\nIGNoZWNrIGZvciBzYW5pdHkKICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2Vy\nKGxJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgIExl\nZGdlcklucHV0U3RyZWFtIGxpbiA9IG5ldyBMZWRnZXJJbnB1dFN0cmVhbShs\naCwgMSk7CiAgICAgICAgYnl0ZVtdIGJyZWFkID0gbmV3IGJ5dGVbYi5sZW5n\ndGhdOwogICAgICAgIGludCByZWFkID0gMDsKICAgICAgICB3aGlsZSAocmVh\nZCA8IGIubGVuZ3RoKSB7CiAgICAgICAgICAgIHJlYWQgPSByZWFkICsgbGlu\nLnJlYWQoYnJlYWQsIHJlYWQsIGIubGVuZ3RoKTsKICAgICAgICB9CgogICAg\nICAgIFN0cmluZyBuZXdTdHJpbmcgPSBuZXcgU3RyaW5nKGJyZWFkKTsKICAg\nICAgICBhc3NlcnRUcnVlKCJ0aGVzZSB0d28gc2hvdWxkIHNhbWUiLCB0b1dy\naXRlLmVxdWFscyhuZXdTdHJpbmcpKTsKICAgICAgICBsaW4uY2xvc2UoKTsK\nICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIC8vIGNyZWF0ZSBhbm90aGVy\nIGxlZGdlciB0byB3cml0ZSBvbmUgYnl0ZSBhdCBhIHRpbWUKICAgICAgICBs\naCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dv\ncmQpOwogICAgICAgIGxvdXQgPSBuZXcgTGVkZ2VyT3V0cHV0U3RyZWFtKGxo\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGIubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgbG91dC53cml0ZShiW2ldKTsKICAgICAgICB9CiAg\nICAgICAgbG91dC5jbG9zZSgpOwogICAgICAgIGxJZCA9IGxoLmdldElkKCk7\nCiAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICBsaCA9IGJrYy5vcGVuTGVk\nZ2VyKGxJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAg\nIGxpbiA9IG5ldyBMZWRnZXJJbnB1dFN0cmVhbShsaCk7CiAgICAgICAgYnJl\nYWQgPSBuZXcgYnl0ZVtiLmxlbmd0aF07CiAgICAgICAgcmVhZCA9IDA7CiAg\nICAgICAgd2hpbGUgKHJlYWQgPCBiLmxlbmd0aCkgewogICAgICAgICAgICBy\nZWFkID0gcmVhZCArIGxpbi5yZWFkKGJyZWFkLCByZWFkLCBiLmxlbmd0aCk7\nCiAgICAgICAgfQogICAgICAgIG5ld1N0cmluZyA9IG5ldyBTdHJpbmcoYnJl\nYWQpOwogICAgICAgIGFzc2VydFRydWUoInRoZXNlIHR3byBzaG91bGQgYmUg\nc2FtZSAiLCB0b1dyaXRlLmVxdWFscyhuZXdTdHJpbmcpKTsKICAgICAgICBs\naW4uY2xvc2UoKTsKICAgICAgICBsaC5jbG9zZSgpOwogICAgfQoKICAgIEBU\nZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVhZFdyaXRlQXN5bmNTaW5nbGVD\nbGllbnQoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAgICBsaCA9\nIGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQp\nOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEi\nKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAg\nICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3Jp\ndGU7IGkrKykgewogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9\nIEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAgICAgICBlbnRy\neS5wdXRJbnQocm5nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAgICAg\nICBlbnRyeS5wb3NpdGlvbigwKTsKCiAgICAgICAgICAgICAgICBlbnRyaWVz\nLmFkZChlbnRyeS5hcnJheSgpKTsKICAgICAgICAgICAgICAgIGVudHJpZXNT\naXplLmFkZChlbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAgICAgICAgICAgICAg\nICBsaC5hc3luY0FkZEVudHJ5KGVudHJ5LmFycmF5KCksIHRoaXMsIHN5bmMp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YWl0IGZvciBhbGwg\nZW50cmllcyB0byBiZSBhY2tub3dsZWRnZWQKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3luYy5j\nb3VudGVyIDwgbnVtRW50cmllc1RvV3JpdGUpIHsKICAgICAgICAgICAgICAg\nICAgICBMT0cuZGVidWcoIkVudHJpZXMgY291bnRlciA9ICIgKyBzeW5jLmNv\ndW50ZXIpOwogICAgICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBMT0cu\nZGVidWcoIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAgICAgICAgICAg\nLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CgogICAg\nICAgICAgICAvLyAqKiogV1JJVElORyBQQVJUIENPTVBMRVRFIC8vIFJFQUQg\nUEFSVCBCRUdJTlMgKioqCgogICAgICAgICAgICAvLyBvcGVuIGxlZGdlcgog\nICAgICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdl\nc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIExPRy5kZWJ1\nZygiTnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbjogIiArIChsaC5nZXRMYXN0\nQWRkQ29uZmlybWVkKCkgKyAxKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUo\nIlZlcmlmeWluZyBudW1iZXIgb2YgZW50cmllcyB3cml0dGVuIiwgbGguZ2V0\nTGFzdEFkZENvbmZpcm1lZCgpID09IChudW1FbnRyaWVzVG9Xcml0ZSAtIDEp\nKTsKCiAgICAgICAgICAgIC8vIHJlYWQgZW50cmllcwogICAgICAgICAgICBs\naC5hc3luY1JlYWRFbnRyaWVzKDAsIG51bUVudHJpZXNUb1dyaXRlIC0gMSwg\ndGhpcywgKE9iamVjdCkgc3luYyk7CgogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChzeW5jLnZhbHVl\nID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgc3luYy53YWl0KCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIExPRy5kZWJ1ZygiKioqIFJFQUQgQ09NUExFVEUgKioqIik7CgogICAgICAg\nICAgICAvLyBhdCB0aGlzIHBvaW50LCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRy\neT4gbHMgaXMgZmlsbGVkIHdpdGggdGhlIHJldHVybmVkCiAgICAgICAgICAg\nIC8vIHZhbHVlcwogICAgICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAg\nIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAg\nICAgQnl0ZUJ1ZmZlciBvcmlnYmIgPSBCeXRlQnVmZmVyLndyYXAoZW50cmll\ncy5nZXQoaSkpOwogICAgICAgICAgICAgICAgSW50ZWdlciBvcmlnRW50cnkg\nPSBvcmlnYmIuZ2V0SW50KCk7CiAgICAgICAgICAgICAgICBieXRlW10gZW50\ncnkgPSBscy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCk7CiAgICAgICAgICAg\nICAgICBCeXRlQnVmZmVyIHJlc3VsdCA9IEJ5dGVCdWZmZXIud3JhcChlbnRy\neSk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkxlbmd0aCBvZiByZXN1\nbHQ6ICIgKyByZXN1bHQuY2FwYWNpdHkoKSk7CiAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoIk9yaWdpbmFsIGVudHJ5OiAiICsgb3JpZ0VudHJ5KTsKCiAg\nICAgICAgICAgICAgICBJbnRlZ2VyIHJldHJFbnRyeSA9IHJlc3VsdC5nZXRJ\nbnQoKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiUmV0cmlldmVkIGVu\ndHJ5OiAiICsgcmV0ckVudHJ5KTsKICAgICAgICAgICAgICAgIGFzc2VydFRy\ndWUoIkNoZWNraW5nIGVudHJ5ICIgKyBpICsgIiBmb3IgZXF1YWxpdHkiLCBv\ncmlnRW50cnkuZXF1YWxzKHJldHJFbnRyeSkpOwogICAgICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZSgiQ2hlY2tpbmcgZW50cnkgIiArIGkgKyAiIGZvciBzaXpl\nIiwgZW50cnkubGVuZ3RoID09IGVudHJpZXNTaXplLmdldChpKS5pbnRWYWx1\nZSgpKTsKICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBhc3NlcnRUcnVlKCJDaGVja2luZyBudW1iZXIgb2YgcmVhZCBl\nbnRyaWVzIiwgaSA9PSBudW1FbnRyaWVzVG9Xcml0ZSk7CgogICAgICAgICAg\nICBsaC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwog\nICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBl\nciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWls\nZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRv\nIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENoZWNrIHRoYXQgdGhlIGFkZCBhcGkgd2l0aCBvZmZzZXQgYW5kIGxl\nbmd0aCB3b3JrIGNvcnJlY3RseS4KICAgICAqIEZpcnN0IHRyeSB2YXJ5aW5n\nIHRoZSBvZmZzZXQuIFRoZW4gdGhlIGxlbmd0aCB3aXRoIGEgZml4ZWQgbm9u\nLXplcm8KICAgICAqIG9mZnNldC4KICAgICAqLwogICAgQFRlc3QKICAgIHB1\nYmxpYyB2b2lkIHRlc3RSZWFkV3JpdGVSYW5nZUFzeW5jU2luZ2xlQ2xpZW50\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2Mu\nY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAg\nICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAg\nTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdldElkKCkpOwogICAgICAg\nICAgICBieXRlIGJ5dGVzW10gPSB7J2EnLCdiJywnYycsJ2QnLCdlJywnZics\nJ2cnLCdoJywnaSd9OwoKICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShi\neXRlcywgMCwgYnl0ZXMubGVuZ3RoLCB0aGlzLCBzeW5jKTsKICAgICAgICAg\nICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywgMCwgNCwgdGhpcywgc3luYyk7\nIC8vIGFiY2QKICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywg\nMywgNCwgdGhpcywgc3luYyk7IC8vIGRlZmcKICAgICAgICAgICAgbGguYXN5\nbmNBZGRFbnRyeShieXRlcywgMywgKGJ5dGVzLmxlbmd0aC0zKSwgdGhpcywg\nc3luYyk7IC8vIGRlZmdoaQogICAgICAgICAgICBpbnQgbnVtRW50cmllcyA9\nIDQ7CgogICAgICAgICAgICAvLyB3YWl0IGZvciBhbGwgZW50cmllcyB0byBi\nZSBhY2tub3dsZWRnZWQKICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5j\nKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3luYy5jb3VudGVyIDwgbnVt\nRW50cmllcykgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRW50\ncmllcyBjb3VudGVyID0gIiArIHN5bmMuY291bnRlcik7CiAgICAgICAgICAg\nICAgICAgICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBs\naC5hc3luY0FkZEVudHJ5KGJ5dGVzLCAtMSwgYnl0ZXMubGVuZ3RoLCB0aGlz\nLCBzeW5jKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBh\nYmxlIHRvIHVzZSBuZWdhdGl2ZSBvZmZzZXQiKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGFpb2IpIHsK\nICAgICAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxoLmFzeW5jQWRkRW50\ncnkoYnl0ZXMsIDAsIGJ5dGVzLmxlbmd0aCsxLCB0aGlzLCBzeW5jKTsKICAg\nICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHVzZSB0\naGF0IG11Y2ggbGVuZ3RoIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKEFycmF5\nSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBhaW9iKSB7CiAgICAgICAgICAg\nICAgICAvLyBleHBlY3RlZAogICAgICAgICAgICB9CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBsaC5hc3luY0FkZEVudHJ5KGJ5dGVzLCAt\nMSwgYnl0ZXMubGVuZ3RoKzIsIHRoaXMsIHN5bmMpOwogICAgICAgICAgICAg\nICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gdXNlIG5lZ2F0aXZlIG9m\nZnNldCAiCiAgICAgICAgICAgICAgICAgICAgICsgIndpdGggdGhhdCBtdWNo\nIGxlbmd0aCIpOwogICAgICAgICAgICB9IGNhdGNoIChBcnJheUluZGV4T3V0\nT2ZCb3VuZHNFeGNlcHRpb24gYWlvYikgewogICAgICAgICAgICAgICAgLy8g\nZXhwZWN0ZWQKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywgNCwgLTMsIHRo\naXMsIHN5bmMpOwogICAgICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJl\nIGFibGUgdG8gdXNlIG5lZ2F0aXZlIGxlbmd0aCIpOwogICAgICAgICAgICB9\nIGNhdGNoIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gYWlvYikg\newogICAgICAgICAgICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAgfQog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGguYXN5bmNBZGRF\nbnRyeShieXRlcywgLTQsIC0zLCB0aGlzLCBzeW5jKTsKICAgICAgICAgICAg\nICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHVzZSBuZWdhdGl2ZSBv\nZmZzZXQgJiBsZW5ndGgiKTsKICAgICAgICAgICAgfSBjYXRjaCAoQXJyYXlJ\nbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGFpb2IpIHsKICAgICAgICAgICAg\nICAgIC8vIGV4cGVjdGVkCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICBM\nT0cuZGVidWcoIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAgICAgICAg\nICAgLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3NlKCk7Cgog\nICAgICAgICAgICAvLyAqKiogV1JJVElORyBQQVJUIENPTVBMRVRFIC8vIFJF\nQUQgUEFSVCBCRUdJTlMgKioqCgogICAgICAgICAgICAvLyBvcGVuIGxlZGdl\ncgogICAgICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBk\naWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIExPRy5k\nZWJ1ZygiTnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbjogIiArIChsaC5nZXRM\nYXN0QWRkQ29uZmlybWVkKCkgKyAxKSk7CiAgICAgICAgICAgIGFzc2VydFRy\ndWUoIlZlcmlmeWluZyBudW1iZXIgb2YgZW50cmllcyB3cml0dGVuIiwKICAg\nICAgICAgICAgICAgICAgICAgICBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkg\nPT0gKG51bUVudHJpZXMgLSAxKSk7CgogICAgICAgICAgICAvLyByZWFkIGVu\ndHJpZXMKICAgICAgICAgICAgbGguYXN5bmNSZWFkRW50cmllcygwLCBudW1F\nbnRyaWVzIC0gMSwgdGhpcywgKE9iamVjdCkgc3luYyk7CgogICAgICAgICAg\nICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAgIHdoaWxl\nIChzeW5jLnZhbHVlID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgICAg\nc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFJFQUQgQ09NUExFVEUgKioq\nIik7CgogICAgICAgICAgICAvLyBhdCB0aGlzIHBvaW50LCBFbnVtZXJhdGlv\nbjxMZWRnZXJFbnRyeT4gbHMgaXMgZmlsbGVkIHdpdGggdGhlIHJldHVybmVk\nCiAgICAgICAgICAgIC8vIHZhbHVlcwogICAgICAgICAgICBpbnQgaSA9IDA7\nCiAgICAgICAgICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewog\nICAgICAgICAgICAgICAgYnl0ZVtdIGV4cGVjdGVkID0gbnVsbDsKICAgICAg\nICAgICAgICAgIGJ5dGVbXSBlbnRyeSA9IGxzLm5leHRFbGVtZW50KCkuZ2V0\nRW50cnkoKTsKCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGkpIHsKICAgICAg\nICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICBleHBlY3Rl\nZCA9IEFycmF5cy5jb3B5T2ZSYW5nZShieXRlcywgMCwgYnl0ZXMubGVuZ3Ro\nKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIGNhc2UgMToKICAgICAgICAgICAgICAgICAgICBleHBlY3RlZCA9IEFycmF5\ncy5jb3B5T2ZSYW5nZShieXRlcywgMCwgNCk7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAg\nICAgICAgICAgZXhwZWN0ZWQgPSBBcnJheXMuY29weU9mUmFuZ2UoYnl0ZXMs\nIDMsIDMrNCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQg\nPSBBcnJheXMuY29weU9mUmFuZ2UoYnl0ZXMsIDMsIDMrKGJ5dGVzLmxlbmd0\naC0zKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBhc3NlcnROb3ROdWxsKCJUaGVyZSBh\ncmUgbW9yZSBjaGVja3MgdGhhbiB3cml0ZXMiLCBleHBlY3RlZCk7CgogICAg\nICAgICAgICAgICAgU3RyaW5nIG1lc3NhZ2UgPSAiQ2hlY2tpbmcgZW50cnkg\nIiArIGkgKyAiIGZvciBlcXVhbGl0eSBbIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIG5ldyBTdHJpbmcoZW50cnksICJVVEYtOCIpICsg\nIiwiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbmV3IFN0\ncmluZyhleHBlY3RlZCwgIlVURi04IikgKyAiXSI7CiAgICAgICAgICAgICAg\nICBhc3NlcnRUcnVlKG1lc3NhZ2UsIEFycmF5cy5lcXVhbHMoZW50cnksIGV4\ncGVjdGVkKSk7CgogICAgICAgICAgICAgICAgaSsrOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIG51bWJlciBvZiBy\nZWFkIGVudHJpZXMiLCBpID09IG51bUVudHJpZXMpOwoKICAgICAgICAgICAg\nbGguY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAg\nICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIEJvb2tLZWVwZXIg\nZXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVk\nIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBp\nbnRlcnJ1cHRpb24iKTsKICAgICAgICB9CiAgICB9CgogICAgY2xhc3MgVGhy\nb3R0bGVUZXN0Q2FsbGJhY2sgaW1wbGVtZW50cyBSZWFkQ2FsbGJhY2sgewog\nICAgICAgIGludCB0aHJvdHRsZTsKCiAgICAgICAgVGhyb3R0bGVUZXN0Q2Fs\nbGJhY2soaW50IHRocmVzaG9sZCkgewogICAgICAgICAgICB0aGlzLnRocm90\ndGxlID0gdGhyZXNob2xkOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgcmVhZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBFbnVt\nZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3QgY3R4KSB7CiAgICAg\nICAgICAgIGlmKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAg\nICAgICAgICAgIGZhaWwoIlJldHVybiBjb2RlIGlzIG5vdCBPSzogIiArIHJj\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbHMgPSBzZXE7CiAgICAg\nICAgICAgIHN5bmNocm9uaXplZChzeW5jKSB7CiAgICAgICAgICAgICAgICBz\neW5jLmNvdW50ZXIgKz0gdGhyb3R0bGU7CiAgICAgICAgICAgICAgICBzeW5j\nLm5vdGlmeSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExPRy5pbmZv\nKCJDdXJyZW50IGNvdW50ZXI6ICIgKyBzeW5jLmNvdW50ZXIpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIE1ldGhvZCBmb3Igb2J0YWluaW5n\nIHRoZSBhdmFpbGFibGUgcGVybWl0cyBvZiBhIGxlZGdlciBoYW5kbGUKICAg\nICAqIHVzaW5nIHJlZmxlY3Rpb24gdG8gYXZvaWQgYWRkaW5nIGEgbmV3IHB1\nYmxpYyBtZXRob2QgdG8gdGhlCiAgICAgKiBjbGFzcy4KICAgICAqCiAgICAg\nKiBAcGFyYW0gbGgKICAgICAqIEByZXR1cm4KICAgICAqLwogICAgQFN1cHBy\nZXNzV2FybmluZ3MoInVuY2hlY2tlZCIpCiAgICBpbnQgZ2V0QXZhaWxhYmxl\nUGVybWl0cyhMZWRnZXJIYW5kbGUgbGgpIHRocm93cwogICAgICAgIE5vU3Vj\naEZpZWxkRXhjZXB0aW9uLCBJbGxlZ2FsQWNjZXNzRXhjZXB0aW9uCiAgICB7\nCiAgICAgICAgRmllbGQgZmllbGQgPSBMZWRnZXJIYW5kbGUuY2xhc3MuZ2V0\nRGVjbGFyZWRGaWVsZCgib3BDb3VudGVyU2VtIik7CiAgICAgICAgZmllbGQu\nc2V0QWNjZXNzaWJsZSh0cnVlKTsKICAgICAgICByZXR1cm4gKChTZW1hcGhv\ncmUpZmllbGQuZ2V0KGxoKSkuYXZhaWxhYmxlUGVybWl0cygpOwogICAgfQoK\nICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVhZFdyaXRlQXN5bmNT\naW5nbGVDbGllbnRUaHJvdHRsZSgpIHRocm93cwogICAgICAgIElPRXhjZXB0\naW9uLCBOb1N1Y2hGaWVsZEV4Y2VwdGlvbiwgSWxsZWdhbEFjY2Vzc0V4Y2Vw\ndGlvbiB7CiAgICAgICAgdHJ5IHsKCiAgICAgICAgICAgIEludGVnZXIgdGhy\nb3R0bGUgPSAxMDA7CiAgICAgICAgICAgIFRocm90dGxlVGVzdENhbGxiYWNr\nIHRjYiA9IG5ldyBUaHJvdHRsZVRlc3RDYWxsYmFjayh0aHJvdHRsZSk7CiAg\nICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAgICBia2Mu\nZ2V0Q29uZigpLnNldFRocm90dGxlVmFsdWUodGhyb3R0bGUpOwogICAgICAg\nICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2Vy\nUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdl\nc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgp\nOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0\nSWQoKSk7CgogICAgICAgICAgICBudW1FbnRyaWVzVG9Xcml0ZSA9IDgwMDA7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgKG51bUVudHJpZXNU\nb1dyaXRlIC0gMjAwMCk7IGkrKykgewogICAgICAgICAgICAgICAgQnl0ZUJ1\nZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAg\nICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4SW50KSk7CiAg\nICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAgICAgICAgICAg\nICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAgICAgICAgICAg\nICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAg\nICAgICAgICAgICAgICBsaC5hc3luY0FkZEVudHJ5KGVudHJ5LmFycmF5KCks\nIHRoaXMsIHN5bmMpOwogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAg\nICAgICAqIENoZWNrIHRoYXQgdGhlIGRpZmZlcmVuY2UgaXMgbm8gbGFyZ2Vy\nIHRoYW4gdGhlIHRocm90dGxpbmcgdGhyZXNob2xkCiAgICAgICAgICAgICAg\nICAgKi8KICAgICAgICAgICAgICAgIGludCB0ZXN0VmFsdWUgPSBnZXRBdmFp\nbGFibGVQZXJtaXRzKGxoKTsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUo\nIkRpZmZlcmVuY2UgaXMgaW5jb3JyZWN0IDogIiArIGkgKyAiLCAiICsgc3lu\nYy5jb3VudGVyICsgIiwgIiArIHRlc3RWYWx1ZSwgdGVzdFZhbHVlIDw9IHRo\ncm90dGxlKTsKICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgMjAwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBCeXRl\nQnVmZmVyIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAg\nICAgICAgICAgIGVudHJ5LnB1dEludChybmcubmV4dEludChtYXhJbnQpKTsK\nICAgICAgICAgICAgICAgIGVudHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAg\nICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAg\nICAgICAgZW50cmllc1NpemUuYWRkKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIGxoLmFzeW5jQWRkRW50cnkoZW50cnkuYXJyYXko\nKSwgdGhpcywgc3luYyk7CgogICAgICAgICAgICAgICAgLyoKICAgICAgICAg\nICAgICAgICAqIENoZWNrIHRoYXQgdGhlIGRpZmZlcmVuY2UgaXMgbm8gbGFy\nZ2VyIHRoYW4gdGhlIHRocm90dGxpbmcgdGhyZXNob2xkCiAgICAgICAgICAg\nICAgICAgKi8KICAgICAgICAgICAgICAgIGludCB0ZXN0VmFsdWUgPSBnZXRB\ndmFpbGFibGVQZXJtaXRzKGxoKTsKICAgICAgICAgICAgICAgIGFzc2VydFRy\ndWUoIkRpZmZlcmVuY2UgaXMgaW5jb3JyZWN0IDogIiArIGkgKyAiLCAiICsg\nc3luYy5jb3VudGVyICsgIiwgIiArIHRlc3RWYWx1ZSwgdGVzdFZhbHVlIDw9\nIHRocm90dGxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gd2Fp\ndCBmb3IgYWxsIGVudHJpZXMgdG8gYmUgYWNrbm93bGVkZ2VkCiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAgICAgICAgICAgd2hp\nbGUgKHN5bmMuY291bnRlciA8IG51bUVudHJpZXNUb1dyaXRlKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJFbnRyaWVzIGNvdW50ZXIgPSAi\nICsgc3luYy5jb3VudGVyKTsKICAgICAgICAgICAgICAgICAgICBzeW5jLndh\naXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgTE9HLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7CiAg\nICAgICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9z\nZSgpOwoKICAgICAgICAgICAgLy8gKioqIFdSSVRJTkcgUEFSVCBDT01QTEVU\nRSAvLyBSRUFEIFBBUlQgQkVHSU5TICoqKgoKICAgICAgICAgICAgLy8gb3Bl\nbiBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcihsZWRn\nZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAg\nICBMT0cuZGVidWcoIk51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW46ICIgKyAo\nbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpICsgMSkpOwogICAgICAgICAgICBh\nc3NlcnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVudHJpZXMgd3JpdHRl\nbiIsIGxoLmdldExhc3RBZGRDb25maXJtZWQoKSA9PSAobnVtRW50cmllc1Rv\nV3JpdGUgLSAxKSk7CgogICAgICAgICAgICAvLyByZWFkIGVudHJpZXMKICAg\nICAgICAgICAgc3luYy5jb3VudGVyID0gMDsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzVG9Xcml0ZTsgaSs9dGhyb3R0bGUp\nIHsKICAgICAgICAgICAgICAgIGxoLmFzeW5jUmVhZEVudHJpZXMoaSwgaSAr\nIHRocm90dGxlIC0gMSwgdGNiLCAoT2JqZWN0KSBzeW5jKTsKICAgICAgICAg\nICAgICAgIGludCB0ZXN0VmFsdWUgPSBnZXRBdmFpbGFibGVQZXJtaXRzKGxo\nKTsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIkRpZmZlcmVuY2UgaXMg\naW5jb3JyZWN0IDogIiArIGkgKyAiLCAiICsgc3luYy5jb3VudGVyICsgIiwg\nIiArIHRlc3RWYWx1ZSwgdGVzdFZhbHVlIDw9IHRocm90dGxlKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAg\nICAgICAgICAgICAgICB3aGlsZSAoc3luYy5jb3VudGVyIDwgbnVtRW50cmll\nc1RvV3JpdGUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiRW50\ncmllcyBjb3VudGVyID0gIiArIHN5bmMuY291bnRlcik7CiAgICAgICAgICAg\nICAgICAgICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFJFQUQgQ09N\nUExFVEUgKioqIik7CgogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAg\nIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVy\ncm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0\nIGZhaWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAgICAg\nICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAg\nZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAg\nICAgIH0KICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFN5\nbmNSZWFkQXN5bmNXcml0ZVN0cmluZ3NTaW5nbGVDbGllbnQoKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIExPRy5pbmZvKCJURVNUIFJFQUQgV1JJ\nVEUgU1RSSU5HUyBNSVhFRCBTSU5HTEUgQ0xJRU5UIik7CiAgICAgICAgU3Ry\naW5nIGNoYXJzZXQgPSAidXRmLTgiOwogICAgICAgIExPRy5kZWJ1ZygiRGVm\nYXVsdCBjaGFyc2V0OiAiICsgQ2hhcnNldC5kZWZhdWx0Q2hhcnNldCgpKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIK\nICAgICAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUs\nIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgLy8gYmtjLmluaXRNZXNz\nYWdlRGlnZXN0KCJTSEExIik7CiAgICAgICAgICAgIGxlZGdlcklkID0gbGgu\nZ2V0SWQoKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiAr\nIGxoLmdldElkKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG51bUVudHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIGlu\ndCByYW5kb21JbnQgPSBybmcubmV4dEludChtYXhJbnQpOwogICAgICAgICAg\nICAgICAgYnl0ZVtdIGVudHJ5ID0gbmV3IFN0cmluZyhJbnRlZ2VyLnRvU3Ry\naW5nKHJhbmRvbUludCkpLmdldEJ5dGVzKGNoYXJzZXQpOwogICAgICAgICAg\nICAgICAgZW50cmllcy5hZGQoZW50cnkpOwogICAgICAgICAgICAgICAgbGgu\nYXN5bmNBZGRFbnRyeShlbnRyeSwgdGhpcywgc3luYyk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHdhaXQgZm9yIGFsbCBlbnRyaWVzIHRvIGJl\nIGFja25vd2xlZGdlZAogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMp\nIHsKICAgICAgICAgICAgICAgIHdoaWxlIChzeW5jLmNvdW50ZXIgPCBudW1F\nbnRyaWVzVG9Xcml0ZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiRW50cmllcyBjb3VudGVyID0gIiArIHN5bmMuY291bnRlcik7CiAgICAg\nICAgICAgICAgICAgICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIEFT\nWU5DIFdSSVRFIENPTVBMRVRFICoqKiIpOwogICAgICAgICAgICAvLyBjbG9z\nZSBsZWRnZXIKICAgICAgICAgICAgbGguY2xvc2UoKTsKCiAgICAgICAgICAg\nIC8vICoqKiBXUklUSU5HIFBBUlQgQ09NUExFVEVEIC8vIFJFQUQgUEFSVCBC\nRUdJTlMgKioqCgogICAgICAgICAgICAvLyBvcGVuIGxlZGdlcgogICAgICAg\nICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBl\nLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiTnVt\nYmVyIG9mIGVudHJpZXMgd3JpdHRlbjogIiArIChsaC5nZXRMYXN0QWRkQ29u\nZmlybWVkKCkgKyAxKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZlcmlm\neWluZyBudW1iZXIgb2YgZW50cmllcyB3cml0dGVuIiwgbGguZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpID09IChudW1FbnRyaWVzVG9Xcml0ZSAtIDEpKTsKCiAg\nICAgICAgICAgIC8vIHJlYWQgZW50cmllcwogICAgICAgICAgICBscyA9IGxo\nLnJlYWRFbnRyaWVzKDAsIG51bUVudHJpZXNUb1dyaXRlIC0gMSk7CgogICAg\nICAgICAgICBMT0cuZGVidWcoIioqKiBTWU5DIFJFQUQgQ09NUExFVEUgKioq\nIik7CgogICAgICAgICAgICAvLyBhdCB0aGlzIHBvaW50LCBFbnVtZXJhdGlv\nbjxMZWRnZXJFbnRyeT4gbHMgaXMgZmlsbGVkIHdpdGggdGhlIHJldHVybmVk\nCiAgICAgICAgICAgIC8vIHZhbHVlcwogICAgICAgICAgICBpbnQgaSA9IDA7\nCiAgICAgICAgICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewog\nICAgICAgICAgICAgICAgYnl0ZVtdIG9yaWdFbnRyeUJ5dGVzID0gZW50cmll\ncy5nZXQoaSsrKTsKICAgICAgICAgICAgICAgIGJ5dGVbXSByZXRyRW50cnlC\neXRlcyA9IGxzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKTsKCiAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIk9yaWdpbmFsIGJ5dGUgZW50cnkgc2l6ZTog\nIiArIG9yaWdFbnRyeUJ5dGVzLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoIlNhdmVkIGJ5dGUgZW50cnkgc2l6ZTogIiArIHJldHJFbnRy\neUJ5dGVzLmxlbmd0aCk7CgogICAgICAgICAgICAgICAgU3RyaW5nIG9yaWdF\nbnRyeSA9IG5ldyBTdHJpbmcob3JpZ0VudHJ5Qnl0ZXMsIGNoYXJzZXQpOwog\nICAgICAgICAgICAgICAgU3RyaW5nIHJldHJFbnRyeSA9IG5ldyBTdHJpbmco\ncmV0ckVudHJ5Qnl0ZXMsIGNoYXJzZXQpOwoKICAgICAgICAgICAgICAgIExP\nRy5kZWJ1ZygiT3JpZ2luYWwgZW50cnk6ICIgKyBvcmlnRW50cnkpOwogICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJSZXRyaWV2ZWQgZW50cnk6ICIgKyBy\nZXRyRW50cnkpOwoKICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNr\naW5nIGVudHJ5ICIgKyBpICsgIiBmb3IgZXF1YWxpdHkiLCBvcmlnRW50cnku\nZXF1YWxzKHJldHJFbnRyeSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGFzc2VydFRydWUoIkNoZWNraW5nIG51bWJlciBvZiByZWFkIGVudHJpZXMi\nLCBpID09IG51bUVudHJpZXNUb1dyaXRlKTsKCiAgICAgICAgICAgIGxoLmNs\nb3NlKCk7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAg\nICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2Vw\ndGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUp\nOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJy\ndXB0aW9uIik7CiAgICAgICAgfQoKICAgIH0KCiAgICBAVGVzdAogICAgcHVi\nbGljIHZvaWQgdGVzdFJlYWRXcml0ZVN5bmNTaW5nbGVDbGllbnQoKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8v\nIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVM\nZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAg\nICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAg\nICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5m\nbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewog\nICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIu\nYWxsb2NhdGUoNCk7CiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5n\nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3Np\ndGlvbigwKTsKICAgICAgICAgICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFy\ncmF5KCkpOwogICAgICAgICAgICAgICAgbGguYWRkRW50cnkoZW50cnkuYXJy\nYXkoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGguY2xvc2UoKTsK\nICAgICAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcihsZWRnZXJJZCwgZGln\nZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICBMT0cuZGVi\ndWcoIk51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW46ICIgKyBsaC5nZXRMYXN0\nQWRkQ29uZmlybWVkKCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWZXJp\nZnlpbmcgbnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbiIsIGxoLmdldExhc3RB\nZGRDb25maXJtZWQoKSA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAxKSk7Cgog\nICAgICAgICAgICBscyA9IGxoLnJlYWRFbnRyaWVzKDAsIG51bUVudHJpZXNU\nb1dyaXRlIC0gMSk7CiAgICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAg\nICAgd2hpbGUgKGxzLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAg\nICAgICBCeXRlQnVmZmVyIG9yaWdiYiA9IEJ5dGVCdWZmZXIud3JhcChlbnRy\naWVzLmdldChpKyspKTsKICAgICAgICAgICAgICAgIEludGVnZXIgb3JpZ0Vu\ndHJ5ID0gb3JpZ2JiLmdldEludCgpOwogICAgICAgICAgICAgICAgQnl0ZUJ1\nZmZlciByZXN1bHQgPSBCeXRlQnVmZmVyLndyYXAobHMubmV4dEVsZW1lbnQo\nKS5nZXRFbnRyeSgpKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiTGVu\nZ3RoIG9mIHJlc3VsdDogIiArIHJlc3VsdC5jYXBhY2l0eSgpKTsKICAgICAg\nICAgICAgICAgIExPRy5kZWJ1ZygiT3JpZ2luYWwgZW50cnk6ICIgKyBvcmln\nRW50cnkpOwoKICAgICAgICAgICAgICAgIEludGVnZXIgcmV0ckVudHJ5ID0g\ncmVzdWx0LmdldEludCgpOwogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJS\nZXRyaWV2ZWQgZW50cnk6ICIgKyByZXRyRW50cnkpOwogICAgICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZSgiQ2hlY2tpbmcgZW50cnkgIiArIGkgKyAiIGZvciBl\ncXVhbGl0eSIsIG9yaWdFbnRyeS5lcXVhbHMocmV0ckVudHJ5KSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9IGNh\ndGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWls\nZWQgZHVlIHRvIEJvb2tLZWVwZXIgZXhjZXB0aW9uIik7CiAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwo\nIlRlc3QgZmFpbGVkIGR1ZSB0byBpbnRlcnJ1cHRpb24iKTsKICAgICAgICB9\nCiAgICB9CgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkV3Jp\ndGVaZXJvKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAgbGgg\nPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3Jk\nKTsKICAgICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEEx\nIik7CiAgICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAg\nICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdldElkKCkpOwog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJpZXNUb1dy\naXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KG5ldyBi\neXRlWzBdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLyoKICAgICAg\nICAgICAgICogV3JpdGUgYSBub24temVybyBlbnRyeQogICAgICAgICAgICAg\nKi8KICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIu\nYWxsb2NhdGUoNCk7CiAgICAgICAgICAgIGVudHJ5LnB1dEludChybmcubmV4\ndEludChtYXhJbnQpKTsKICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7\nCiAgICAgICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAg\nICAgICAgICBsaC5hZGRFbnRyeShlbnRyeS5hcnJheSgpKTsKCiAgICAgICAg\nICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgIGxoID0gYmtjLm9wZW5MZWRn\nZXIobGVkZ2VySWQsIGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICAgICAgTE9HLmRlYnVnKCJOdW1iZXIgb2YgZW50cmllcyB3cml0dGVu\nOiAiICsgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZSgiVmVyaWZ5aW5nIG51bWJlciBvZiBlbnRyaWVzIHdyaXR0\nZW4iLCBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgPT0gbnVtRW50cmllc1Rv\nV3JpdGUpOwoKICAgICAgICAgICAgbHMgPSBsaC5yZWFkRW50cmllcygwLCBu\ndW1FbnRyaWVzVG9Xcml0ZSAtIDEpOwogICAgICAgICAgICBpbnQgaSA9IDA7\nCiAgICAgICAgICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewog\nICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciByZXN1bHQgPSBCeXRlQnVmZmVy\nLndyYXAobHMubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgpKTsKICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiTGVuZ3RoIG9mIHJlc3VsdDogIiArIHJlc3Vs\ndC5jYXBhY2l0eSgpKTsKCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJD\naGVja2luZyBpZiBlbnRyeSAiICsgaSArICIgaGFzIHplcm8gYnl0ZXMiLCBy\nZXN1bHQuY2FwYWNpdHkoKSA9PSAwKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUp\nOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tl\nZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBm\nYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVl\nIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVz\ndAogICAgcHVibGljIHZvaWQgdGVzdE11bHRpTGVkZ2VyKCkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDcmVh\ndGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2Vy\nKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgbGgy\nID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29y\nZCk7CgogICAgICAgICAgICBsb25nIGxlZGdlcklkID0gbGguZ2V0SWQoKTsK\nICAgICAgICAgICAgbG9uZyBsZWRnZXJJZDIgPSBsaDIuZ2V0SWQoKTsKCiAg\nICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2VzdCgiU0hBMSIpOwog\nICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEIDE6ICIgKyBsaC5nZXRJ\nZCgpICsgIiwgTGVkZ2VyIElEIDI6ICIgKyBsaDIuZ2V0SWQoKSk7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7\nIGkrKykgewogICAgICAgICAgICAgICAgbGguYWRkRW50cnkobmV3IGJ5dGVb\nMF0pOwogICAgICAgICAgICAgICAgbGgyLmFkZEVudHJ5KG5ldyBieXRlWzBd\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAg\nICAgICAgICAgbGgyLmNsb3NlKCk7CgogICAgICAgICAgICBsaCA9IGJrYy5v\ncGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29y\nZCk7CiAgICAgICAgICAgIGxoMiA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklk\nMiwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwoKICAgICAgICAgICAg\nTE9HLmRlYnVnKCJOdW1iZXIgb2YgZW50cmllcyB3cml0dGVuOiAiICsgbGgu\nZ2V0TGFzdEFkZENvbmZpcm1lZCgpICsgIiwgIiArIGxoMi5nZXRMYXN0QWRk\nQ29uZmlybWVkKCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWZXJpZnlp\nbmcgbnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbiBsaCAoIiArIGxoLmdldExh\nc3RBZGRDb25maXJtZWQoKSArICIpIiwgbGgKICAgICAgICAgICAgICAgICAg\nICAgICAuZ2V0TGFzdEFkZENvbmZpcm1lZCgpID09IChudW1FbnRyaWVzVG9X\ncml0ZSAtIDEpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmVyaWZ5aW5n\nIG51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW4gbGgyICgiICsgbGgyLmdldExh\nc3RBZGRDb25maXJtZWQoKSArICIpIiwgbGgyCiAgICAgICAgICAgICAgICAg\nICAgICAgLmdldExhc3RBZGRDb25maXJtZWQoKSA9PSAobnVtRW50cmllc1Rv\nV3JpdGUgLSAxKSk7CgogICAgICAgICAgICBscyA9IGxoLnJlYWRFbnRyaWVz\nKDAsIG51bUVudHJpZXNUb1dyaXRlIC0gMSk7CiAgICAgICAgICAgIGludCBp\nID0gMDsKICAgICAgICAgICAgd2hpbGUgKGxzLmhhc01vcmVFbGVtZW50cygp\nKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIHJlc3VsdCA9IEJ5dGVC\ndWZmZXIud3JhcChscy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCkpOwogICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJMZW5ndGggb2YgcmVzdWx0OiAiICsg\ncmVzdWx0LmNhcGFjaXR5KCkpOwoKICAgICAgICAgICAgICAgIGFzc2VydFRy\ndWUoIkNoZWNraW5nIGlmIGVudHJ5ICIgKyBpICsgIiBoYXMgemVybyBieXRl\ncyIsIHJlc3VsdC5jYXBhY2l0eSgpID09IDApOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgIGxzID0gbGgyLnJl\nYWRFbnRyaWVzKDAsIG51bUVudHJpZXNUb1dyaXRlIC0gMSk7CiAgICAgICAg\nICAgIGkgPSAwOwogICAgICAgICAgICB3aGlsZSAobHMuaGFzTW9yZUVsZW1l\nbnRzKCkpIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgcmVzdWx0ID0g\nQnl0ZUJ1ZmZlci53cmFwKGxzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKSk7\nCiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkxlbmd0aCBvZiByZXN1bHQ6\nICIgKyByZXN1bHQuY2FwYWNpdHkoKSk7CgogICAgICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZSgiQ2hlY2tpbmcgaWYgZW50cnkgIiArIGkgKyAiIGhhcyB6ZXJv\nIGJ5dGVzIiwgcmVzdWx0LmNhcGFjaXR5KCkgPT0gMCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgbGgyLmNsb3NlKCk7CiAgICAgICAgfSBjYXRjaCAo\nQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3Qg\nZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1\nZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVy\ncm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0\nIGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAgfQogICAg\nfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVhZFdyaXRlQXN5\nbmNMZW5ndGgoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAgICBs\naCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dv\ncmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNI\nQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAg\nICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllc1Rv\nV3JpdGU7IGkrKykgewogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRy\neSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAgICAgICBl\nbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAg\nICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAgICAgICAgICAgICAgICBlbnRy\naWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAgICAgICAgICAgICAgIGVudHJp\nZXNTaXplLmFkZChlbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAgICAgICAgICAg\nICAgICBsaC5hc3luY0FkZEVudHJ5KGVudHJ5LmFycmF5KCksIHRoaXMsIHN5\nbmMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YWl0IGZvciBh\nbGwgZW50cmllcyB0byBiZSBhY2tub3dsZWRnZWQKICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3lu\nYy5jb3VudGVyIDwgbnVtRW50cmllc1RvV3JpdGUpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIkVudHJpZXMgY291bnRlciA9ICIgKyBzeW5j\nLmNvdW50ZXIpOwogICAgICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGxv\nbmcgbGVuZ3RoID0gbnVtRW50cmllc1RvV3JpdGUgKiA0OwogICAgICAgICAg\nICBhc3NlcnRUcnVlKCJMZWRnZXIgbGVuZ3RoIGJlZm9yZSBjbG9zaW5nOiAi\nICsgbGguZ2V0TGVuZ3RoKCksIGxoLmdldExlbmd0aCgpID09IGxlbmd0aCk7\nCgogICAgICAgICAgICBMT0cuZGVidWcoIioqKiBXUklURSBDT01QTEVURSAq\nKioiKTsKICAgICAgICAgICAgLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAg\nIGxoLmNsb3NlKCk7CgogICAgICAgICAgICAvLyAqKiogV1JJVElORyBQQVJU\nIENPTVBMRVRFIC8vIFJFQUQgUEFSVCBCRUdJTlMgKioqCgogICAgICAgICAg\nICAvLyBvcGVuIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5vcGVuTGVk\nZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoIkxlZGdlciBsZW5ndGggYWZ0ZXIgb3Bl\nbmluZzogIiArIGxoLmdldExlbmd0aCgpLCBsaC5nZXRMZW5ndGgoKSA9PSBs\nZW5ndGgpOwoKCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfSBj\nYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFp\nbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWls\nKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAg\nfQogICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0U2h1dGRv\nd24oKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGludCBudW1MZWRnZXJzID0gMTAwMDA7CiAgICAgICAgICAgIGlu\ndCB0aHJvdHRsZSA9ICgoKERvdWJsZSkgTWF0aC5tYXgoMS4wLCAoKGRvdWJs\nZSkgMTAwMDAvbnVtTGVkZ2VycykpKS5pbnRWYWx1ZSgpKTsKICAgICAgICAg\nICAgYmtjLmdldENvbmYoKS5zZXRUaHJvdHRsZVZhbHVlKHRocm90dGxlKTsK\nICAgICAgICAgICAgTGVkZ2VySGFuZGxlW10gbGhBcnJheSA9IG5ldyBMZWRn\nZXJIYW5kbGVbbnVtTGVkZ2Vyc107CiAgICAgICAgICAgIGZvcihpbnQgaSA9\nIDA7IGkgPCBudW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxo\nQXJyYXlbaV0gPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDIsIEJvb2tLZWVwZXIu\nRGlnZXN0VHlwZS5DUkMzMiwgbmV3IGJ5dGVbXSB7J2EnLCAnYid9KTsKICAg\nICAgICAgICAgICAgIExPRy5kZWJ1ZygiTGVkZ2VyIGhhbmRsZTogIiArIGxo\nQXJyYXlbaV0uZ2V0SWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nTE9HLmluZm8oIkRvbmUgY3JlYXRpbmcgbGVkZ2Vycy4iKTsKICAgICAgICAg\nICAgUmFuZG9tIHIgPSBuZXcgUmFuZG9tKCk7CgogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bUVudHJpZXNUb1dyaXRlOyBpKyspIHsKICAg\nICAgICAgICAgICAgIEJ5dGVCdWZmZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFs\nbG9jYXRlKDQpOwogICAgICAgICAgICAgICAgZW50cnkucHV0SW50KHJuZy5u\nZXh0SW50KG1heEludCkpOwogICAgICAgICAgICAgICAgZW50cnkucG9zaXRp\nb24oMCk7CgogICAgICAgICAgICAgICAgZW50cmllcy5hZGQoZW50cnkuYXJy\nYXkoKSk7CiAgICAgICAgICAgICAgICBlbnRyaWVzU2l6ZS5hZGQoZW50cnku\nYXJyYXkoKS5sZW5ndGgpOwoKICAgICAgICAgICAgICAgIGludCBuZXh0TGgg\nPSByLm5leHRJbnQobnVtTGVkZ2Vycyk7CiAgICAgICAgICAgICAgICBsaEFy\ncmF5W25leHRMaF0uYXN5bmNBZGRFbnRyeShlbnRyeS5hcnJheSgpLCB0aGlz\nLCBzeW5jKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gd2FpdCBm\nb3IgYWxsIGVudHJpZXMgdG8gYmUgYWNrbm93bGVkZ2VkCiAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAgICAgICAgICAgd2hpbGUg\nKHN5bmMuY291bnRlciA8IG51bUVudHJpZXNUb1dyaXRlKSB7CiAgICAgICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJFbnRyaWVzIGNvdW50ZXIgPSAiICsg\nc3luYy5jb3VudGVyKTsKICAgICAgICAgICAgICAgICAgICBzeW5jLndhaXQo\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgTE9HLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAg\nICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBmb3IoaW50IGkg\nPSAwOyBpIDwgbGhBcnJheS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAg\nICAgbGhBcnJheVtpXS5jbG9zZSgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJy\nb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3Qg\nZmFpbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAg\nIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBm\nYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAg\nICAgfQogICAgfQogICAgCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVz\ndFJlYWRGcm9tT3BlbkxlZGdlcigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAg\nICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBs\nZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2Fn\nZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdl\ndElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBs\naC5nZXRJZCgpKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBu\ndW1FbnRyaWVzVG9Xcml0ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBCeXRl\nQnVmZmVyIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAg\nICAgICAgICAgIGVudHJ5LnB1dEludChybmcubmV4dEludChtYXhJbnQpKTsK\nICAgICAgICAgICAgICAgIGVudHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAg\nICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAg\nICAgICAgZW50cmllc1NpemUuYWRkKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwog\nICAgICAgICAgICAgICAgaWYoaSA9PSBudW1FbnRyaWVzVG9Xcml0ZS8yKSB7\nCiAgICAgICAgICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoT3BlbiA9IGJr\nYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJZCwgZGlnZXN0VHlwZSwg\nbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAgICAgICAgIC8vIG5vIHJl\nY292ZXJ5IG9wZW5lZCBsZWRnZXIgJ3MgbGFzdCBjb25maXJtZWQgZW50cnkg\naWQgaXMgbGVzcyB0aGFuIHdyaXR0ZW4KICAgICAgICAgICAgICAgICAgICAv\nLyBhbmQgaXQganVzdCBjYW4gcmVhZCB1bnRpbCAoaS0xKQogICAgICAgICAg\nICAgICAgICAgIGludCB0b1JlYWQgPSBpIC0gMTsKICAgICAgICAgICAgICAg\nICAgICBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gcmVhZEVudHJ5ID0gbGhP\ncGVuLnJlYWRFbnRyaWVzKHRvUmVhZCwgdG9SZWFkKTsKICAgICAgICAgICAg\nICAgICAgICBhc3NlcnRUcnVlKCJFbnVtZXJhdGlvbiBvZiBsZWRnZXIgZW50\ncmllcyBoYXMgbm8gZWxlbWVudCIsIHJlYWRFbnRyeS5oYXNNb3JlRWxlbWVu\ndHMoKSA9PSB0cnVlKTsKICAgICAgICAgICAgICAgICAgICBMZWRnZXJFbnRy\neSBlID0gcmVhZEVudHJ5Lm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgICAg\nICAgICAgYXNzZXJ0RXF1YWxzKHRvUmVhZCwgZS5nZXRFbnRyeUlkKCkpOwog\nICAgICAgICAgICAgICAgICAgIEFzc2VydC5hc3NlcnRBcnJheUVxdWFscyhl\nbnRyaWVzLmdldCh0b1JlYWQpLCBlLmdldEVudHJ5KCkpOwogICAgICAgICAg\nICAgICAgICAgIC8vIHNob3VsZCBub3Qgd3JpdHRlbiB0byBhIHJlYWQgb25s\neSBsZWRnZXIKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgICAgICAgICBsaE9wZW4uYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZCBoYXZlIHRo\ncm93biBhbiBleGNlcHRpb24gaGVyZSIpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLSWxsZWdhbE9wRXhjZXB0aW9uIGJr\naW9lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhl\nIGNvcnJlY3QgcmVzcG9uc2UKICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJVbmV4cGVjdGVkIGV4Y2VwdGlvbiIsIGV4KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZmFpbCgiVW5leHBlY3RlZCBleGNlcHRpb24iKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g\nY2xvc2UgcmVhZCBvbmx5IGxlZGdlciBzaG91bGQgbm90IGNoYW5nZSBtZXRh\nZGF0YQogICAgICAgICAgICAgICAgICAgIGxoT3Blbi5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsb25n\nIGxhc3QgPSBsaC5yZWFkTGFzdENvbmZpcm1lZCgpOwogICAgICAgICAgICBh\nc3NlcnRUcnVlKCJMYXN0IGNvbmZpcm1lZCBhZGQ6ICIgKyBsYXN0LCBsYXN0\nID09IChudW1FbnRyaWVzVG9Xcml0ZSAtIDIpKTsKCiAgICAgICAgICAgIExP\nRy5kZWJ1ZygiKioqIFdSSVRFIENPTVBMRVRFICoqKiIpOwogICAgICAgICAg\nICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAg\nICAgICAgICAgLyoKICAgICAgICAgICAgICogQXN5bmNocm9ub3VzIGNhbGwg\ndG8gcmVhZCBsYXN0IGNvbmZpcm1lZCBlbnRyeQogICAgICAgICAgICAgKi8K\nICAgICAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUs\nIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgLy8gYmtjLmluaXRNZXNz\nYWdlRGlnZXN0KCJTSEExIik7CiAgICAgICAgICAgIGxlZGdlcklkID0gbGgu\nZ2V0SWQoKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiAr\nIGxoLmdldElkKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIG51bUVudHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIEJ5\ndGVCdWZmZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAg\nICAgICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkp\nOwogICAgICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CgogICAgICAg\nICAgICAgICAgZW50cmllcy5hZGQoZW50cnkuYXJyYXkoKSk7CiAgICAgICAg\nICAgICAgICBlbnRyaWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgp\nOwogICAgICAgICAgICAgICAgbGguYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7\nCiAgICAgICAgICAgIH0KCgogICAgICAgICAgICBTeW5jT2JqIHN5bmMgPSBu\nZXcgU3luY09iaigpOwogICAgICAgICAgICBsaC5hc3luY1JlYWRMYXN0Q29u\nZmlybWVkKHRoaXMsIHN5bmMpOwoKICAgICAgICAgICAgLy8gV2FpdCBmb3Ig\nZm9yIGxhc3QgY29uZmlybWVkCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\nc3luYykgewogICAgICAgICAgICAgICAgd2hpbGUgKHN5bmMubGFzdENvbmZp\ncm1lZCA9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1Zygi\nQ291bnRlciA9ICIgKyBzeW5jLmxhc3RDb25maXJtZWQpOwogICAgICAgICAg\nICAgICAgICAgIHN5bmMud2FpdCgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBhc3NlcnRUcnVlKCJMYXN0IGNvbmZp\ncm1lZCBhZGQ6ICIgKyBzeW5jLmxhc3RDb25maXJtZWQsIHN5bmMubGFzdENv\nbmZpcm1lZCA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAyKSk7CgogICAgICAg\nICAgICBMT0cuZGVidWcoIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAg\nICAgICAgICAgLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3Nl\nKCk7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAg\nIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlv\nbiIpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwog\nICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0\naW9uIik7CiAgICAgICAgfQogICAgfQoKCiAgICBAVGVzdAogICAgcHVibGlj\nIHZvaWQgdGVzdExhc3RDb25maXJtZWRBZGQoKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxl\nZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0\nVHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5p\ndE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQg\nPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElE\nOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAg\nICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7\nCiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4\nSW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAg\nICAgICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAg\nICAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5hcnJheSgpLmxl\nbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRyeS5hcnJh\neSgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9uZyBsYXN0ID0g\nbGgucmVhZExhc3RDb25maXJtZWQoKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1\nZSgiTGFzdCBjb25maXJtZWQgYWRkOiAiICsgbGFzdCwgbGFzdCA9PSAobnVt\nRW50cmllc1RvV3JpdGUgLSAyKSk7CgogICAgICAgICAgICBMT0cuZGVidWco\nIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAgICAgICAgICAgLy8gY2xv\nc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAg\nIC8qCiAgICAgICAgICAgICAqIEFzeW5jaHJvbm91cyBjYWxsIHRvIHJlYWQg\nbGFzdCBjb25maXJtZWQgZW50cnkKICAgICAgICAgICAgICovCiAgICAgICAg\nICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQ\nYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2Vz\ndCgiU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdldElkKCk7\nCiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBsaC5nZXRJ\nZCgpKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRy\naWVzVG9Xcml0ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVy\nIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICAgICAg\nICAgIGVudHJ5LnB1dEludChybmcubmV4dEludChtYXhJbnQpKTsKICAgICAg\nICAgICAgICAgIGVudHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAgICAgICAg\nIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICAgICAg\nZW50cmllc1NpemUuYWRkKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsKICAgICAg\nICAgICAgICAgIGxoLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwogICAgICAg\nICAgICB9CgoKICAgICAgICAgICAgU3luY09iaiBzeW5jID0gbmV3IFN5bmNP\nYmooKTsKICAgICAgICAgICAgbGguYXN5bmNSZWFkTGFzdENvbmZpcm1lZCh0\naGlzLCBzeW5jKTsKCiAgICAgICAgICAgIC8vIFdhaXQgZm9yIGZvciBsYXN0\nIGNvbmZpcm1lZAogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsK\nICAgICAgICAgICAgICAgIHdoaWxlIChzeW5jLmxhc3RDb25maXJtZWQgPT0g\nLTEpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkNvdW50ZXIg\nPSAiICsgc3luYy5sYXN0Q29uZmlybWVkKTsKICAgICAgICAgICAgICAgICAg\nICBzeW5jLndhaXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTGFzdCBjb25maXJtZWQgYWRk\nOiAiICsgc3luYy5sYXN0Q29uZmlybWVkLCBzeW5jLmxhc3RDb25maXJtZWQg\nPT0gKG51bUVudHJpZXNUb1dyaXRlIC0gMikpOwoKICAgICAgICAgICAgTE9H\nLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAgICAgICAg\nIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAg\nICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJU\nZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAg\nICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAg\nICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwog\nICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIHZvaWQgYWRkQ29tcGxldGUo\naW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIGxvbmcgZW50cnlJZCwgT2JqZWN0\nIGN0eCkgewogICAgICAgIGlmKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0sp\nIGZhaWwoIlJldHVybiBjb2RlIGlzIG5vdCBPSzogIiArIHJjKTsKCiAgICAg\nICAgU3luY09iaiB4ID0gKFN5bmNPYmopIGN0eDsKCiAgICAgICAgc3luY2hy\nb25pemVkICh4KSB7CiAgICAgICAgICAgIHguY291bnRlcisrOwogICAgICAg\nICAgICB4Lm5vdGlmeSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByZWFkQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIEVu\ndW1lcmF0aW9uPExlZGdlckVudHJ5PiBzZXEsIE9iamVjdCBjdHgpIHsKICAg\nICAgICBpZihyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSBmYWlsKCJSZXR1\ncm4gY29kZSBpcyBub3QgT0s6ICIgKyByYyk7CgogICAgICAgIGxzID0gc2Vx\nOwoKICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAg\nc3luYy52YWx1ZSA9IHRydWU7CiAgICAgICAgICAgIHN5bmMubm90aWZ5KCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRMYXN0Q29u\nZmlybWVkQ29tcGxldGUoaW50IHJjLCBsb25nIGxhc3RDb25maXJtZWQsIE9i\namVjdCBjdHgpIHsKICAgICAgICBTeW5jT2JqIHN5bmMgPSAoU3luY09iaikg\nY3R4OwoKICAgICAgICBzeW5jaHJvbml6ZWQoc3luYykgewogICAgICAgICAg\nICBzeW5jLmxhc3RDb25maXJtZWQgPSBsYXN0Q29uZmlybWVkOwogICAgICAg\nICAgICBzeW5jLm5vdGlmeSgpOwogICAgICAgIH0KICAgIH0KCiAgICBAQmVm\nb3JlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgcm5nID0gbmV3IFJh\nbmRvbShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7IC8vIEluaXRpYWxp\nemUgdGhlIFJhbmRvbQogICAgICAgIC8vIE51bWJlciBHZW5lcmF0b3IKICAg\nICAgICBlbnRyaWVzID0gbmV3IEFycmF5TGlzdDxieXRlW10+KCk7IC8vIGlu\naXRpYWxpemUgdGhlIGVudHJpZXMgbGlzdAogICAgICAgIGVudHJpZXNTaXpl\nID0gbmV3IEFycmF5TGlzdDxJbnRlZ2VyPigpOwogICAgICAgIHN5bmMgPSBu\nZXcgU3luY09iaigpOyAvLyBpbml0aWFsaXplIHRoZSBzeW5jaHJvbml6YXRp\nb24gZGF0YSBzdHJ1Y3R1cmUKCiAgICB9CgogICAgLyogQ2xlYW4gdXAgYSBk\naXJlY3RvcnkgcmVjdXJzaXZlbHkgKi8KICAgIHByb3RlY3RlZCBib29sZWFu\nIGNsZWFuVXBEaXIoRmlsZSBkaXIpIHsKICAgICAgICBpZiAoZGlyLmlzRGly\nZWN0b3J5KCkpIHsKICAgICAgICAgICAgTE9HLmluZm8oIkNsZWFuaW5nIHVw\nICIgKyBkaXIuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgU3RyaW5nW10gY2hp\nbGRyZW4gPSBkaXIubGlzdCgpOwogICAgICAgICAgICBmb3IgKFN0cmluZyBz\ndHJpbmcgOiBjaGlsZHJlbikgewogICAgICAgICAgICAgICAgYm9vbGVhbiBz\ndWNjZXNzID0gY2xlYW5VcERpcihuZXcgRmlsZShkaXIsIHN0cmluZykpOwog\nICAgICAgICAgICAgICAgaWYgKCFzdWNjZXNzKQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICAvLyBUaGUgZGlyZWN0b3J5IGlzIG5vdyBlbXB0eSBzbyBkZWxldGUg\naXQKICAgICAgICByZXR1cm4gZGlyLmRlbGV0ZSgpOwogICAgfQoKICAgIC8q\nIFVzZXIgZm9yIHRlc3RpbmcgcHVycG9zZXMsIHZvaWQgKi8KICAgIGNsYXNz\nIGVtcHR5V2F0Y2hlciBpbXBsZW1lbnRzIFdhdGNoZXIgewogICAgICAgIHB1\nYmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAg\nICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

