{"sha":"2bca4c9fce181fc4ad29b5a2e6a9d255c3fe28b4","node_id":"MDQ6QmxvYjE1NzU5NTY6MmJjYTRjOWZjZTE4MWZjNGFkMjliNWEyZTZhOWQyNTVjM2ZlMjhiNA==","size":6726,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2bca4c9fce181fc4ad29b5a2e6a9d255c3fe28b4","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5qdW5pdC5BZnRl\ncjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdENhc2U7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZh\nY3Rvcnk7CgovKioKICogVGVzdHMgd3JpdGluZyB0byBjb25jdXJyZW50IGxl\nZGdlcnMKICovCnB1YmxpYyBjbGFzcyBDb25jdXJyZW50TGVkZ2VyVGVzdCBl\neHRlbmRzIFRlc3RDYXNlIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQ29uY3VycmVudExlZGdlclRlc3QuY2xh\nc3MpOwoKICAgIEJvb2tpZSBib29raWU7CiAgICBGaWxlIHR4bkRpciwgbGVk\nZ2VyRGlyOwogICAgaW50IHJlY3ZUaW1lb3V0ID0gMTAwMDA7CiAgICBTZW1h\ncGhvcmUgdGhyb3R0bGU7CiAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwoKICAgIEBPdmVycmlkZQog\nICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgdHhuRGlyTmFtZSA9IFN5c3RlbS5n\nZXRQcm9wZXJ0eSgidHhuRGlyIik7CiAgICAgICAgaWYgKHR4bkRpck5hbWUg\nIT0gbnVsbCkgewogICAgICAgICAgICB0eG5EaXIgPSBuZXcgRmlsZSh0eG5E\naXJOYW1lKTsKICAgICAgICB9CiAgICAgICAgU3RyaW5nIGxlZGdlckRpck5h\nbWUgPSBTeXN0ZW0uZ2V0UHJvcGVydHkoImxlZGdlckRpciIpOwogICAgICAg\nIGlmIChsZWRnZXJEaXJOYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgbGVk\nZ2VyRGlyID0gbmV3IEZpbGUobGVkZ2VyRGlyTmFtZSk7CiAgICAgICAgfQog\nICAgICAgIEZpbGUgdG1wRmlsZSA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJv\nb2siLCAiLnR4biIsIHR4bkRpcik7CiAgICAgICAgdG1wRmlsZS5kZWxldGUo\nKTsKICAgICAgICB0eG5EaXIgPSBuZXcgRmlsZSh0bXBGaWxlLmdldFBhcmVu\ndCgpLCB0bXBGaWxlLmdldE5hbWUoKSsiLmRpciIpOwogICAgICAgIHR4bkRp\nci5ta2RpcnMoKTsKICAgICAgICB0bXBGaWxlID0gRmlsZS5jcmVhdGVUZW1w\nRmlsZSgiYm9vayIsICIubGVkZ2VyIiwgbGVkZ2VyRGlyKTsKICAgICAgICBs\nZWRnZXJEaXIgPSBuZXcgRmlsZSh0bXBGaWxlLmdldFBhcmVudCgpLCB0bXBG\naWxlLmdldE5hbWUoKSsiLmRpciIpOwogICAgICAgIGxlZGdlckRpci5ta2Rp\ncnMoKTsKCiAgICAgICAgY29uZi5zZXRCb29raWVQb3J0KDUwMDApOwogICAg\nICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKG51bGwpOwogICAgICAgIGNvbmYuc2V0\nSm91cm5hbERpck5hbWUodHhuRGlyLmdldFBhdGgoKSk7CiAgICAgICAgY29u\nZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIu\nZ2V0UGF0aCgpIH0pOwogICAgICAgIGJvb2tpZSA9IG5ldyBCb29raWUoY29u\nZik7CiAgICB9CgogICAgc3RhdGljIHZvaWQgcmVjdXJzaXZlRGVsZXRlKEZp\nbGUgZikgewogICAgICAgIGlmIChmLmlzRmlsZSgpKSB7CiAgICAgICAgICAg\nIGYuZGVsZXRlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9y\nKEZpbGUgaTogZi5saXN0RmlsZXMoKSkgewogICAgICAgICAgICAgICAgcmVj\ndXJzaXZlRGVsZXRlKGkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGYu\nZGVsZXRlKCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\nQEFmdGVyCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBib29raWUuc2h1dGRvd24oKTsKICAgICAgICAg\nICAgcmVjdXJzaXZlRGVsZXRlKHR4bkRpcik7CiAgICAgICAgICAgIHJlY3Vy\nc2l2ZURlbGV0ZShsZWRnZXJEaXIpOwogICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJF\ncnJvciB0ZWFyaW5nIGRvd24iLCBlKTsKICAgICAgICB9CiAgICB9CgogICAg\nYnl0ZSB6ZXJvc1tdID0gbmV3IGJ5dGVbMTZdOwoKICAgIGludCBpdGVyYXRp\nb25zID0gNTE7CiAgICB7CiAgICAgICAgU3RyaW5nIGl0ZXJhdGlvbnNTdHJp\nbmcgPSBTeXN0ZW0uZ2V0UHJvcGVydHkoIml0ZXJhdGlvbnMiKTsKICAgICAg\nICBpZiAoaXRlcmF0aW9uc1N0cmluZyAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGl0ZXJhdGlvbnMgPSBJbnRlZ2VyLnBhcnNlSW50KGl0ZXJhdGlvbnNTdHJp\nbmcpOwogICAgICAgIH0KICAgIH0KICAgIGludCBpdGVyYXRpb25TdGVwID0g\nMjU7CiAgICB7CiAgICAgICAgU3RyaW5nIGl0ZXJhdGlvbnNTdHJpbmcgPSBT\neXN0ZW0uZ2V0UHJvcGVydHkoIml0ZXJhdGlvblN0ZXAiKTsKICAgICAgICBp\nZiAoaXRlcmF0aW9uc1N0cmluZyAhPSBudWxsKSB7CiAgICAgICAgICAgIGl0\nZXJhdGlvblN0ZXAgPSBJbnRlZ2VyLnBhcnNlSW50KGl0ZXJhdGlvbnNTdHJp\nbmcpOwogICAgICAgIH0KICAgIH0KICAgIEBUZXN0CiAgICBwdWJsaWMgdm9p\nZCB0ZXN0Q29uY3VycmVudFdyaXRlKCkgdGhyb3dzIElPRXhjZXB0aW9uLCBJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAg\nICBpbnQgc2l6ZSA9IDEwMjQ7CiAgICAgICAgaW50IHRvdGFsd3JpdGVzID0g\nMTI4OwogICAgICAgIGlmIChTeXN0ZW0uZ2V0UHJvcGVydHkoInRvdGFsd3Jp\ndGVzIikgIT0gbnVsbCkgewogICAgICAgICAgICB0b3RhbHdyaXRlcyA9IElu\ndGVnZXIucGFyc2VJbnQoU3lzdGVtLmdldFByb3BlcnR5KCJ0b3RhbHdyaXRl\ncyIpKTsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oIlJ1bm5pbmcgdXAg\ndG8gIiArIGl0ZXJhdGlvbnMgKyAiIGl0ZXJhdGlvbnMiKTsKICAgICAgICBM\nT0cuaW5mbygiVG90YWwgd3JpdGVzID0gIiArIHRvdGFsd3JpdGVzKTsKICAg\nICAgICBpbnQgbGVkZ2VyczsKICAgICAgICBmb3IobGVkZ2VycyA9IDE7IGxl\nZGdlcnMgPD0gaXRlcmF0aW9uczsgbGVkZ2VycyArPSBpdGVyYXRpb25TdGVw\nKSB7CiAgICAgICAgICAgIGxvbmcgZHVyYXRpb24gPSBkb1dyaXRlcyhsZWRn\nZXJzLCBzaXplLCB0b3RhbHdyaXRlcyk7CiAgICAgICAgICAgIExPRy5pbmZv\nKHRvdGFsd3JpdGVzICsgIiBvbiAiICsgbGVkZ2VycyArICIgdG9vayAiICsg\nZHVyYXRpb24gKyAiIG1zIik7CiAgICAgICAgfQogICAgICAgIExPRy5pbmZv\nKCJsZWRnZXJzICIgKyBsZWRnZXJzKTsKICAgICAgICBmb3IobGVkZ2VycyA9\nIDE7IGxlZGdlcnMgPD0gaXRlcmF0aW9uczsgbGVkZ2VycyArPSBpdGVyYXRp\nb25TdGVwKSB7CiAgICAgICAgICAgIGxvbmcgZHVyYXRpb24gPSBkb1JlYWRz\nKGxlZGdlcnMsIHNpemUsIHRvdGFsd3JpdGVzKTsKICAgICAgICAgICAgTE9H\nLmluZm8obGVkZ2VycyArICIgcmVhZCAiICsgZHVyYXRpb24gKyAiIG1zIik7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgbG9uZyBkb1JlYWRzKGlu\ndCBsZWRnZXJzLCBpbnQgc2l6ZSwgaW50IHRvdGFsd3JpdGVzKQogICAgICAg\nICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIGxvbmcgc3RhcnQgPSBTeXN0\nZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICBmb3IoaW50IGkgPSAx\nOyBpIDw9IHRvdGFsd3JpdGVzL2xlZGdlcnM7IGkrKykgewogICAgICAgICAg\nICBmb3IoaW50IGogPSAxOyBqIDw9IGxlZGdlcnM7IGorKykgewogICAgICAg\nICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IGJvb2tpZS5yZWFkRW50cnko\naiwgaSk7CiAgICAgICAgICAgICAgICAvLyBza2lwIHRoZSBsZWRnZXIgaWQg\nYW5kIHRoZSBlbnRyeSBpZAogICAgICAgICAgICAgICAgZW50cnkuZ2V0TG9u\nZygpOwogICAgICAgICAgICAgICAgZW50cnkuZ2V0TG9uZygpOwogICAgICAg\nICAgICAgICAgYXNzZXJ0RXF1YWxzKGogKyAiQCIgKyBpLCBqKzIsIGVudHJ5\nLmdldExvbmcoKSk7CiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoaiAr\nICJAIiArIGksIGkrMywgZW50cnkuZ2V0TG9uZygpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBsb25nIGZpbmlzaCA9IFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpOwogICAgICAgIHJldHVybiBmaW5pc2ggLSBzdGFy\ndDsKICAgIH0KICAgIHByaXZhdGUgbG9uZyBkb1dyaXRlcyhpbnQgbGVkZ2Vy\ncywgaW50IHNpemUsIGludCB0b3RhbHdyaXRlcykKICAgICAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQm9va2ll\nRXhjZXB0aW9uIHsKICAgICAgICB0aHJvdHRsZSA9IG5ldyBTZW1hcGhvcmUo\nMTAwMDApOwogICAgICAgIFdyaXRlQ2FsbGJhY2sgY2IgPSBuZXcgV3JpdGVD\nYWxsYmFjaygpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHdyaXRlQ29tcGxldGUoaW50IHJjLCBsb25nIGxlZGdl\ncklkLCBsb25nIGVudHJ5SWQsCiAgICAgICAgICAgIEluZXRTb2NrZXRBZGRy\nZXNzIGFkZHIsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgIEF0b21p\nY0ludGVnZXIgY291bnRlciA9IChBdG9taWNJbnRlZ2VyKWN0eDsKICAgICAg\nICAgICAgICAgIGNvdW50ZXIuZ2V0QW5kSW5jcmVtZW50KCk7CiAgICAgICAg\nICAgICAgICB0aHJvdHRsZS5yZWxlYXNlKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9OwogICAgICAgIEF0b21pY0ludGVnZXIgY291bnRlciA9IG5ldyBB\ndG9taWNJbnRlZ2VyKCk7CiAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5j\ndXJyZW50VGltZU1pbGxpcygpOwogICAgICAgIGZvcihpbnQgaSA9IDE7IGkg\nPD0gdG90YWx3cml0ZXMvbGVkZ2VyczsgaSsrKSB7CiAgICAgICAgICAgIGZv\ncihpbnQgaiA9IDE7IGogPD0gbGVkZ2VyczsgaisrKSB7CiAgICAgICAgICAg\nICAgICBCeXRlQnVmZmVyIGJ5dGVzID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZShz\naXplKTsKICAgICAgICAgICAgICAgIGJ5dGVzLnB1dExvbmcoaik7CiAgICAg\nICAgICAgICAgICBieXRlcy5wdXRMb25nKGkpOwogICAgICAgICAgICAgICAg\nYnl0ZXMucHV0TG9uZyhqKzIpOwogICAgICAgICAgICAgICAgYnl0ZXMucHV0\nTG9uZyhpKzMpOwogICAgICAgICAgICAgICAgYnl0ZXMucHV0KCgiVGhpcyBp\ncyBsZWRnZXIgIiArIGogKyAiIGVudHJ5ICIgKyBpKS5nZXRCeXRlcygpKTsK\nICAgICAgICAgICAgICAgIGJ5dGVzLnBvc2l0aW9uKDApOwogICAgICAgICAg\nICAgICAgYnl0ZXMubGltaXQoYnl0ZXMuY2FwYWNpdHkoKSk7CiAgICAgICAg\nICAgICAgICB0aHJvdHRsZS5hY3F1aXJlKCk7CiAgICAgICAgICAgICAgICBi\nb29raWUuYWRkRW50cnkoYnl0ZXMsIGNiLCBjb3VudGVyLCB6ZXJvcyk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbG9uZyBmaW5pc2ggPSBT\neXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICByZXR1cm4gZmlu\naXNoIC0gc3RhcnQ7CiAgICB9Cn0K\n","encoding":"base64"}

