{"sha":"77a09d03d05d288c418675ddbf89d2b39358bcdf","node_id":"MDQ6QmxvYjE1NzU5NTY6NzdhMDlkMDNkMDVkMjg4YzQxODY3NWRkYmY4OWQyYjM5MzU4YmNkZg==","size":6689,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/77a09d03d05d288c418675ddbf89d2b39358bcdf","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrOwoKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkxpbmtlZEJsb2NraW5nUXVldWU7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TZW1hcGhvcmU7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNMb25n\nOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5leGNl\ncHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnV0aWwuQ2FsbGJhY2s7CgpwdWJsaWMgY2xhc3MgQmVuY2htYXJrVXRp\nbHMgewogICAgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihCZW5jaG1hcmtVdGlscy5jbGFzcyk7CgogICAg\ncHVibGljIHN0YXRpYyBkb3VibGUgY2FsY1RwKGZpbmFsIGludCBjb3VudCwg\nbG9uZyBzdGFydFRpbWUpIHsKICAgICAgICByZXR1cm4gMTAwMC4gKiBjb3Vu\ndCAvIChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0VGltZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdGF0cyBhZ2dyZWdhdG9yIGZvciBj\nYWxsYmFjayAocm91bmQtdHJpcCkgb3BlcmF0aW9ucy4gTWVhc3VyZXMgYm90\naAogICAgICogdGhyb3VnaHB1dCBhbmQgbGF0ZW5jeS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBjbGFzcyBUaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0\nb3IgewogICAgICAgIGludCBudW1CdWNrZXRzOwogICAgICAgIGZpbmFsIFRo\ncm91Z2hwdXRBZ2dyZWdhdG9yIHRwQWdnOwogICAgICAgIGZpbmFsIFNlbWFw\naG9yZSBvdXRzdGFuZGluZzsKICAgICAgICBmaW5hbCBBdG9taWNMb25nIHN1\nbSA9IG5ldyBBdG9taWNMb25nKCk7CgogICAgICAgIGZpbmFsIEF0b21pY0xv\nbmdbXSBsYXRlbmN5QnVja2V0czsKCiAgICAgICAgLy8gYnVja2V0W2ldIGlz\nIGNvdW50IG9mIG51bWJlciBvZiBvcGVyYXRpb25zIHRoYXQgdG9vayA+PSBp\nIG1zIGFuZCA8CiAgICAgICAgLy8gKGkrMSkgbXMuCgogICAgICAgIHB1Ymxp\nYyBUaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0b3IoU3RyaW5nIGxhYmVsLCBp\nbnQgY291bnQsIGludCBsaW1pdCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0\naW9uIHsKICAgICAgICAgICAgbnVtQnVja2V0cyA9IEludGVnZXIuZ2V0SW50\nZWdlcigibnVtQnVja2V0cyIsIDEwMSk7CiAgICAgICAgICAgIGxhdGVuY3lC\ndWNrZXRzID0gbmV3IEF0b21pY0xvbmdbbnVtQnVja2V0c107CiAgICAgICAg\nICAgIHRwQWdnID0gbmV3IFRocm91Z2hwdXRBZ2dyZWdhdG9yKGxhYmVsLCBj\nb3VudCk7CiAgICAgICAgICAgIG91dHN0YW5kaW5nID0gbmV3IFNlbWFwaG9y\nZShsaW1pdCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVt\nQnVja2V0czsgaSsrKSB7CiAgICAgICAgICAgICAgICBsYXRlbmN5QnVja2V0\nc1tpXSA9IG5ldyBBdG9taWNMb25nKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlcG9ydExhdGVuY3kobG9uZyBs\nYXRlbmN5KSB7CiAgICAgICAgICAgIHN1bS5hZGRBbmRHZXQobGF0ZW5jeSk7\nCgogICAgICAgICAgICBpbnQgYnVja2V0SW5kZXg7CiAgICAgICAgICAgIGlm\nIChsYXRlbmN5ID49IG51bUJ1Y2tldHMpIHsKICAgICAgICAgICAgICAgIGJ1\nY2tldEluZGV4ID0gKGludCkgbnVtQnVja2V0cyAtIDE7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBidWNrZXRJbmRleCA9IChpbnQp\nIGxhdGVuY3k7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGF0ZW5jeUJ1\nY2tldHNbYnVja2V0SW5kZXhdLmluY3JlbWVudEFuZEdldCgpOwogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSBTdHJpbmcgZ2V0UGVyY2VudGlsZShkb3Vi\nbGUgcGVyY2VudGlsZSkgewogICAgICAgICAgICBpbnQgbnVtSW5saWVyc05l\nZWRlZCA9IChpbnQpIChwZXJjZW50aWxlIC8gMTAwICogdHBBZ2cuY291bnQp\nOwogICAgICAgICAgICBpbnQgbnVtSW5saWVyc0ZvdW5kID0gMDsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1CdWNrZXRzIC0gMTsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBudW1JbmxpZXJzRm91bmQgKz0gbGF0ZW5j\neUJ1Y2tldHNbaV0uaW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChu\ndW1JbmxpZXJzRm91bmQgPiBudW1JbmxpZXJzTmVlZGVkKSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGkgKyAiIjsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiA+PSAiICsgKG51\nbUJ1Y2tldHMgLSAxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJp\nbmcgc3VtbWFyaXplKGxvbmcgc3RhcnRUaW1lKSB7CiAgICAgICAgICAgIGRv\ndWJsZSBwZXJjZW50aWxlID0gRG91YmxlLnBhcnNlRG91YmxlKFN5c3RlbS5n\nZXRQcm9wZXJ0eSgicGVyY2VudGlsZSIsICI5OS45IikpOwogICAgICAgICAg\nICByZXR1cm4gdHBBZ2cuc3VtbWFyaXplKHN0YXJ0VGltZSkgKyAiLCBhdmcg\nbGF0ZW5jeSA9ICIgKyBzdW0uZ2V0KCkgLyB0cEFnZy5jb3VudCArICIsICIg\nKyBwZXJjZW50aWxlCiAgICAgICAgICAgICAgICAgICArICIlaWxlIGxhdGVu\nY3kgPSAiICsgZ2V0UGVyY2VudGlsZShwZXJjZW50aWxlKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdGF0cyBhZ2dyZWdhdG9yIGZvciBu\nb24tY2FsbGJhY2sgKHNpbmdsZS1zaG90KSBvcGVyYXRpb25zLiBNZWFzdXJl\ncyBqdXN0CiAgICAgKiB0aHJvdWdocHV0LgogICAgICovCiAgICBwdWJsaWMg\nc3RhdGljIGNsYXNzIFRocm91Z2hwdXRBZ2dyZWdhdG9yIHsKICAgICAgICBm\naW5hbCBTdHJpbmcgbGFiZWw7CiAgICAgICAgZmluYWwgaW50IGNvdW50Owog\nICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgZG9uZSA9IG5ldyBBdG9taWNJ\nbnRlZ2VyKCk7CiAgICAgICAgZmluYWwgQXRvbWljTG9uZyBlYXJsaWVzdCA9\nIG5ldyBBdG9taWNMb25nKCk7CiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdl\nciBudW1GYWlsZWQgPSBuZXcgQXRvbWljSW50ZWdlcigpOwogICAgICAgIGZp\nbmFsIExpbmtlZEJsb2NraW5nUXVldWU8SW50ZWdlcj4gcXVldWUgPSBuZXcg\nTGlua2VkQmxvY2tpbmdRdWV1ZTxJbnRlZ2VyPigpOwoKICAgICAgICBwdWJs\naWMgVGhyb3VnaHB1dEFnZ3JlZ2F0b3IoZmluYWwgU3RyaW5nIGxhYmVsLCBm\naW5hbCBpbnQgY291bnQpIHsKICAgICAgICAgICAgdGhpcy5sYWJlbCA9IGxh\nYmVsOwogICAgICAgICAgICB0aGlzLmNvdW50ID0gY291bnQ7CiAgICAgICAg\nICAgIGlmIChjb3VudCA9PSAwKQogICAgICAgICAgICAgICAgcXVldWUuYWRk\nKDApOwogICAgICAgICAgICBpZiAoQm9vbGVhbi5nZXRCb29sZWFuKCJwcm9n\ncmVzcyIpKSB7CiAgICAgICAgICAgICAgICBuZXcgVGhyZWFkKG5ldyBSdW5u\nYWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBmb3IgKGludCBkb25lU25hcCA9IDAsIHByZXYgPSAwOyBkb25lU25hcCA8\nIGNvdW50OyBwcmV2ID0gZG9uZVNuYXAsIGRvbmVTbmFwID0gZG9uZS5nZXQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkb25l\nU25hcCA+IHByZXYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgU3lzdGVtLm91dC5wcmludGxuKGxhYmVsICsgIiBwcm9ncmVzczog\nIiArIGRvbmVTbmFwICsgIiBvZiAiICsgY291bnQpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBleCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZXgpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfSkuc3RhcnQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgZGluZyhib29sZWFuIGZhaWxlZCkgewogICAg\nICAgICAgICBpbnQgc25hcERvbmUgPSBkb25lLmluY3JlbWVudEFuZEdldCgp\nOwogICAgICAgICAgICBlYXJsaWVzdC5jb21wYXJlQW5kU2V0KDAsIFN5c3Rl\nbS5jdXJyZW50VGltZU1pbGxpcygpKTsKICAgICAgICAgICAgaWYgKGZhaWxl\nZCkKICAgICAgICAgICAgICAgIG51bUZhaWxlZC5pbmNyZW1lbnRBbmRHZXQo\nKTsKICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGxhYmVsICsgIiAiICsgKGZh\naWxlZCA/ICJmYWlsZWQiIDogInN1Y2NlZWRlZCIpICsgIiwgZG9uZSBzbyBm\nYXIgPSAiICsgc25hcERvbmUpOwogICAgICAgICAgICBpZiAoc25hcERvbmUg\nPT0gY291bnQpIHsKICAgICAgICAgICAgICAgIHF1ZXVlLmFkZChudW1GYWls\nZWQuZ2V0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgU3RyaW5nIHN1bW1hcml6ZShsb25nIHN0YXJ0VGltZSkgewogICAg\nICAgICAgICByZXR1cm4gIkZpbmlzaGVkICIgKyBsYWJlbCArICI6IGNvdW50\nID0gIiArIGRvbmUuZ2V0KCkgKyAiLCB0cHV0ID0gIiArIGNhbGNUcChjb3Vu\ndCwgc3RhcnRUaW1lKQogICAgICAgICAgICAgICAgICAgKyAiIG9wcy9zLCBu\ndW1GYWlsZWQgPSAiICsgbnVtRmFpbGVkOwogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgc3RhdGljIGNsYXNzIEJlbmNobWFya0NhbGxiYWNrIGltcGxl\nbWVudHMgQ2FsbGJhY2s8Vm9pZD4gewoKICAgICAgICBmaW5hbCBUaHJvdWdo\ncHV0TGF0ZW5jeUFnZ3JlZ2F0b3IgYWdnOwogICAgICAgIGZpbmFsIGxvbmcg\nc3RhcnRUaW1lOwoKICAgICAgICBwdWJsaWMgQmVuY2htYXJrQ2FsbGJhY2so\nVGhyb3VnaHB1dExhdGVuY3lBZ2dyZWdhdG9yIGFnZykgdGhyb3dzIEludGVy\ncnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgdGhpcy5hZ2cgPSBhZ2c7\nCiAgICAgICAgICAgIGFnZy5vdXRzdGFuZGluZy5hY3F1aXJlKCk7CiAgICAg\nICAgICAgIC8vIE11c3Qgc2V0IHRoZSBzdGFydCB0aW1lICphZnRlciogdGFr\naW5nIGFjcXVpcmluZyBvbiBvdXRzdGFuZGluZy4KICAgICAgICAgICAgc3Rh\ncnRUaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIHZvaWQgZmluaXNoKGJvb2xlYW4gZmFpbGVk\nKSB7CiAgICAgICAgICAgIGFnZy5yZXBvcnRMYXRlbmN5KFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpIC0gc3RhcnRUaW1lKTsKICAgICAgICAgICAgYWdn\nLnRwQWdnLmRpbmcoZmFpbGVkKTsKICAgICAgICAgICAgYWdnLm91dHN0YW5k\naW5nLnJlbGVhc2UoKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBj\ndHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgZmlu\naXNoKGZhbHNlKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQ\ndWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgIGZpbmlz\naCh0cnVlKTsKICAgICAgICB9CiAgICB9OwoKfQo=\n","encoding":"base64"}

