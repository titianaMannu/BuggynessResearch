{"sha":"f46868babc285d9c600b1dfa24eed5d9b2b13f63","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjQ2ODY4YmFiYzI4NWQ5YzYwMGIxZGZhMjRlZWQ1ZDliMmIxM2Y2Mw==","size":279439,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f46868babc285d9c600b1dfa24eed5d9b2b13f63","content":"Ly8gR2VuZXJhdGVkIGJ5IHRoZSBwcm90b2NvbCBidWZmZXIgY29tcGlsZXIu\nICBETyBOT1QgRURJVCEKLy8gc291cmNlOiBzcmMvbWFpbi9wcm90b2J1Zi9Q\ndWJTdWJQcm90b2NvbC5wcm90bwoKcGFja2FnZSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbDsKCnB1YmxpYyBmaW5hbCBjbGFzcyBQdWJTdWJQcm90b2Nv\nbCB7CiAgICBwcml2YXRlIFB1YlN1YlByb3RvY29sKCkge30KICAgIHB1Ymxp\nYyBzdGF0aWMgdm9pZCByZWdpc3RlckFsbEV4dGVuc2lvbnMoCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeSByZWdpc3Ry\neSkgewogICAgfQogICAgcHVibGljIGVudW0gUHJvdG9jb2xWZXJzaW9uCiAg\nICBpbXBsZW1lbnRzIGNvbS5nb29nbGUucHJvdG9idWYuUHJvdG9jb2xNZXNz\nYWdlRW51bSB7CiAgICAgICAgVkVSU0lPTl9PTkUoMCwgMSksCiAgICAgICAg\nOwoKCiAgICAgICAgcHVibGljIGZpbmFsIGludCBnZXROdW1iZXIoKSB7CiAg\nICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBzdGF0aWMgUHJvdG9jb2xWZXJzaW9uIHZhbHVlT2YoaW50IHZhbHVl\nKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAgICAgICAgICAg\nY2FzZSAxOgogICAgICAgICAgICAgICAgcmV0dXJuIFZFUlNJT05fT05FOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBz\ndGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1h\ncDxQcm90b2NvbFZlcnNpb24+CiAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1h\ncCgpIHsKICAgICAgICAgICAgcmV0dXJuIGludGVybmFsVmFsdWVNYXA7CiAg\nICAgICAgfQogICAgICAgIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJv\ndG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8UHJvdG9jb2xWZXJzaW9uPgog\nICAgICAgIGludGVybmFsVmFsdWVNYXAgPQogICAgICAgIG5ldyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPFByb3RvY29sVmVy\nc2lvbj4oKSB7CiAgICAgICAgICAgIHB1YmxpYyBQcm90b2NvbFZlcnNpb24g\nZmluZFZhbHVlQnlOdW1iZXIoaW50IG51bWJlcikgewogICAgICAgICAgICAg\nICAgcmV0dXJuIFByb3RvY29sVmVyc2lvbi52YWx1ZU9mKG51bWJlcikKICAg\nICAgICAgICAgICAgICAgICAgICA7CiAgICAgICAgICAgIH0KICAgICAgICB9\nOwoKICAgICAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yCiAgICAgICAgZ2V0VmFs\ndWVEZXNjcmlwdG9yKCkgewogICAgICAgICAgICByZXR1cm4gZ2V0RGVzY3Jp\ncHRvcigpLmdldFZhbHVlcygpLmdldChpbmRleCk7CiAgICAgICAgfQogICAg\nICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkVudW1EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5\ncGUoKSB7CiAgICAgICAgICAgIHJldHVybiBnZXREZXNjcmlwdG9yKCk7CiAg\nICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2ds\nZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcgogICAgICAg\nIGdldERlc2NyaXB0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5nZXREZXNjcmlw\ndG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDApOwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgUHJvdG9jb2xWZXJzaW9uW10gVkFM\nVUVTID0gewogICAgICAgICAgICBWRVJTSU9OX09ORSwKICAgICAgICB9Owog\nICAgICAgIHB1YmxpYyBzdGF0aWMgUHJvdG9jb2xWZXJzaW9uIHZhbHVlT2Yo\nCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMu\nRW51bVZhbHVlRGVzY3JpcHRvciBkZXNjKSB7CiAgICAgICAgICAgIGlmIChk\nZXNjLmdldFR5cGUoKSAhPSBnZXREZXNjcmlwdG9yKCkpIHsKICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICJFbnVtVmFsdWVEZXNjcmlw\ndG9yIGlzIG5vdCBmb3IgdGhpcyB0eXBlLiIpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBWQUxVRVNbZGVzYy5nZXRJbmRleCgpXTsKICAg\nICAgICB9CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgaW5kZXg7CiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBpbnQgdmFsdWU7CiAgICAgICAgcHJpdmF0ZSBQ\ncm90b2NvbFZlcnNpb24oaW50IGluZGV4LCBpbnQgdmFsdWUpIHsKICAgICAg\nICAgICAgdGhpcy5pbmRleCA9IGluZGV4OwogICAgICAgICAgICB0aGlzLnZh\nbHVlID0gdmFsdWU7CiAgICAgICAgfQoKICAgICAgICBzdGF0aWMgewogICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5nZXREZXNjcmlwdG9yKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBA\nQHByb3RvY19pbnNlcnRpb25fcG9pbnQoZW51bV9zY29wZTpIZWR3aWcuUHJv\ndG9jb2xWZXJzaW9uKQogICAgfQoKICAgIHB1YmxpYyBlbnVtIE9wZXJhdGlv\nblR5cGUKICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5wcm90b2J1Zi5Qcm90\nb2NvbE1lc3NhZ2VFbnVtIHsKICAgICAgICBQVUJMSVNIKDAsIDApLAogICAg\nICAgIFNVQlNDUklCRSgxLCAxKSwKICAgICAgICBDT05TVU1FKDIsIDIpLAog\nICAgICAgIFVOU1VCU0NSSUJFKDMsIDMpLAogICAgICAgIFNUQVJUX0RFTElW\nRVJZKDQsIDQpLAogICAgICAgIFNUT1BfREVMSVZFUlkoNSwgNSksCiAgICAg\nICAgOwoKCiAgICAgICAgcHVibGljIGZpbmFsIGludCBnZXROdW1iZXIoKSB7\nCiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBzdGF0aWMgT3BlcmF0aW9uVHlwZSB2YWx1ZU9mKGludCB2YWx1\nZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICAg\nIGNhc2UgMDoKICAgICAgICAgICAgICAgIHJldHVybiBQVUJMSVNIOwogICAg\nICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICByZXR1cm4gU1VCU0NS\nSUJFOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICByZXR1\ncm4gQ09OU1VNRTsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAg\nICAgcmV0dXJuIFVOU1VCU0NSSUJFOwogICAgICAgICAgICBjYXNlIDQ6CiAg\nICAgICAgICAgICAgICByZXR1cm4gU1RBUlRfREVMSVZFUlk7CiAgICAgICAg\nICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIHJldHVybiBTVE9QX0RFTElW\nRVJZOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVt\nTGl0ZU1hcDxPcGVyYXRpb25UeXBlPgogICAgICAgIGludGVybmFsR2V0VmFs\ndWVNYXAoKSB7CiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbFZhbHVlTWFw\nOwogICAgICAgIH0KICAgICAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPE9wZXJhdGlvblR5cGU+\nCiAgICAgICAgaW50ZXJuYWxWYWx1ZU1hcCA9CiAgICAgICAgbmV3IGNvbS5n\nb29nbGUucHJvdG9idWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8T3BlcmF0aW9u\nVHlwZT4oKSB7CiAgICAgICAgICAgIHB1YmxpYyBPcGVyYXRpb25UeXBlIGZp\nbmRWYWx1ZUJ5TnVtYmVyKGludCBudW1iZXIpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiBPcGVyYXRpb25UeXBlLnZhbHVlT2YobnVtYmVyKQogICAgICAg\nICAgICAgICAgICAgICAgIDsKICAgICAgICAgICAgfQogICAgICAgIH07Cgog\nICAgICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2Ny\naXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3IKICAgICAgICBnZXRWYWx1ZURl\nc2NyaXB0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBnZXREZXNjcmlwdG9y\nKCkuZ2V0VmFsdWVzKCkuZ2V0KGluZGV4KTsKICAgICAgICB9CiAgICAgICAg\ncHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMu\nRW51bURlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKTsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1EZXNjcmlwdG9yCiAgICAgICAgZ2V0\nRGVzY3JpcHRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmdldERlc2NyaXB0b3Io\nKS5nZXRFbnVtVHlwZXMoKS5nZXQoMSk7CiAgICAgICAgfQoKICAgICAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBPcGVyYXRpb25UeXBlW10gVkFMVUVTID0g\newogICAgICAgICAgICBQVUJMSVNILCBTVUJTQ1JJQkUsIENPTlNVTUUsIFVO\nU1VCU0NSSUJFLCBTVEFSVF9ERUxJVkVSWSwgU1RPUF9ERUxJVkVSWSwKICAg\nICAgICB9OwogICAgICAgIHB1YmxpYyBzdGF0aWMgT3BlcmF0aW9uVHlwZSB2\nYWx1ZU9mKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2Ny\naXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3IgZGVzYykgewogICAgICAgICAg\nICBpZiAoZGVzYy5nZXRUeXBlKCkgIT0gZ2V0RGVzY3JpcHRvcigpKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAiRW51bVZhbHVl\nRGVzY3JpcHRvciBpcyBub3QgZm9yIHRoaXMgdHlwZS4iKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gVkFMVUVTW2Rlc2MuZ2V0SW5kZXgo\nKV07CiAgICAgICAgfQogICAgICAgIHByaXZhdGUgZmluYWwgaW50IGluZGV4\nOwogICAgICAgIHByaXZhdGUgZmluYWwgaW50IHZhbHVlOwogICAgICAgIHBy\naXZhdGUgT3BlcmF0aW9uVHlwZShpbnQgaW5kZXgsIGludCB2YWx1ZSkgewog\nICAgICAgICAgICB0aGlzLmluZGV4ID0gaW5kZXg7CiAgICAgICAgICAgIHRo\naXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICB9CgogICAgICAgIHN0YXRpYyB7\nCiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLmdldERlc2NyaXB0b3IoKTsKICAgICAgICB9CgogICAgICAg\nIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChlbnVtX3Njb3BlOkhlZHdp\nZy5PcGVyYXRpb25UeXBlKQogICAgfQoKICAgIHB1YmxpYyBlbnVtIFN0YXR1\nc0NvZGUKICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5wcm90b2J1Zi5Qcm90\nb2NvbE1lc3NhZ2VFbnVtIHsKICAgICAgICBTVUNDRVNTKDAsIDApLAogICAg\nICAgIE1BTEZPUk1FRF9SRVFVRVNUKDEsIDQwMSksCiAgICAgICAgTk9fU1VD\nSF9UT1BJQygyLCA0MDIpLAogICAgICAgIENMSUVOVF9BTFJFQURZX1NVQlND\nUklCRUQoMywgNDAzKSwKICAgICAgICBDTElFTlRfTk9UX1NVQlNDUklCRUQo\nNCwgNDA0KSwKICAgICAgICBDT1VMRF9OT1RfQ09OTkVDVCg1LCA0MDUpLAog\nICAgICAgIFRPUElDX0JVU1koNiwgNDA2KSwKICAgICAgICBOT1RfUkVTUE9O\nU0lCTEVfRk9SX1RPUElDKDcsIDUwMSksCiAgICAgICAgU0VSVklDRV9ET1dO\nKDgsIDUwMiksCiAgICAgICAgVU5DRVJUQUlOX1NUQVRFKDksIDUwMyksCiAg\nICAgICAgVU5FWFBFQ1RFRF9DT05ESVRJT04oMTAsIDYwMCksCiAgICAgICAg\nQ09NUE9TSVRFKDExLCA3MDApLAogICAgICAgIDsKCgogICAgICAgIHB1Ymxp\nYyBmaW5hbCBpbnQgZ2V0TnVtYmVyKCkgewogICAgICAgICAgICByZXR1cm4g\ndmFsdWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIFN0YXR1\nc0NvZGUgdmFsdWVPZihpbnQgdmFsdWUpIHsKICAgICAgICAgICAgc3dpdGNo\nICh2YWx1ZSkgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAg\nICByZXR1cm4gU1VDQ0VTUzsKICAgICAgICAgICAgY2FzZSA0MDE6CiAgICAg\nICAgICAgICAgICByZXR1cm4gTUFMRk9STUVEX1JFUVVFU1Q7CiAgICAgICAg\nICAgIGNhc2UgNDAyOgogICAgICAgICAgICAgICAgcmV0dXJuIE5PX1NVQ0hf\nVE9QSUM7CiAgICAgICAgICAgIGNhc2UgNDAzOgogICAgICAgICAgICAgICAg\ncmV0dXJuIENMSUVOVF9BTFJFQURZX1NVQlNDUklCRUQ7CiAgICAgICAgICAg\nIGNhc2UgNDA0OgogICAgICAgICAgICAgICAgcmV0dXJuIENMSUVOVF9OT1Rf\nU1VCU0NSSUJFRDsKICAgICAgICAgICAgY2FzZSA0MDU6CiAgICAgICAgICAg\nICAgICByZXR1cm4gQ09VTERfTk9UX0NPTk5FQ1Q7CiAgICAgICAgICAgIGNh\nc2UgNDA2OgogICAgICAgICAgICAgICAgcmV0dXJuIFRPUElDX0JVU1k7CiAg\nICAgICAgICAgIGNhc2UgNTAxOgogICAgICAgICAgICAgICAgcmV0dXJuIE5P\nVF9SRVNQT05TSUJMRV9GT1JfVE9QSUM7CiAgICAgICAgICAgIGNhc2UgNTAy\nOgogICAgICAgICAgICAgICAgcmV0dXJuIFNFUlZJQ0VfRE9XTjsKICAgICAg\nICAgICAgY2FzZSA1MDM6CiAgICAgICAgICAgICAgICByZXR1cm4gVU5DRVJU\nQUlOX1NUQVRFOwogICAgICAgICAgICBjYXNlIDYwMDoKICAgICAgICAgICAg\nICAgIHJldHVybiBVTkVYUEVDVEVEX0NPTkRJVElPTjsKICAgICAgICAgICAg\nY2FzZSA3MDA6CiAgICAgICAgICAgICAgICByZXR1cm4gQ09NUE9TSVRFOwog\nICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIG51\nbGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyBz\ndGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1h\ncDxTdGF0dXNDb2RlPgogICAgICAgIGludGVybmFsR2V0VmFsdWVNYXAoKSB7\nCiAgICAgICAgICAgIHJldHVybiBpbnRlcm5hbFZhbHVlTWFwOwogICAgICAg\nIH0KICAgICAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludGVybmFsLkVudW1MaXRlTWFwPFN0YXR1c0NvZGU+CiAgICAgICAgaW50\nZXJuYWxWYWx1ZU1hcCA9CiAgICAgICAgbmV3IGNvbS5nb29nbGUucHJvdG9i\ndWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8U3RhdHVzQ29kZT4oKSB7CiAgICAg\nICAgICAgIHB1YmxpYyBTdGF0dXNDb2RlIGZpbmRWYWx1ZUJ5TnVtYmVyKGlu\ndCBudW1iZXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBTdGF0dXNDb2Rl\nLnZhbHVlT2YobnVtYmVyKQogICAgICAgICAgICAgICAgICAgICAgIDsKICAg\nICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIHB1YmxpYyBmaW5hbCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURlc2Ny\naXB0b3IKICAgICAgICBnZXRWYWx1ZURlc2NyaXB0b3IoKSB7CiAgICAgICAg\nICAgIHJldHVybiBnZXREZXNjcmlwdG9yKCkuZ2V0VmFsdWVzKCkuZ2V0KGlu\nZGV4KTsKICAgICAgICB9CiAgICAgICAgcHVibGljIGZpbmFsIGNvbS5nb29n\nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bURlc2NyaXB0b3IKICAgICAg\nICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIGdldERlc2NyaXB0b3IoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVu\ndW1EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAg\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLmdldERlc2NyaXB0b3IoKS5nZXRFbnVtVHlwZXMoKS5nZXQo\nMik7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBT\ndGF0dXNDb2RlW10gVkFMVUVTID0gewogICAgICAgICAgICBTVUNDRVNTLCBN\nQUxGT1JNRURfUkVRVUVTVCwgTk9fU1VDSF9UT1BJQywgQ0xJRU5UX0FMUkVB\nRFlfU1VCU0NSSUJFRCwgQ0xJRU5UX05PVF9TVUJTQ1JJQkVELCBDT1VMRF9O\nT1RfQ09OTkVDVCwgVE9QSUNfQlVTWSwgTk9UX1JFU1BPTlNJQkxFX0ZPUl9U\nT1BJQywgU0VSVklDRV9ET1dOLCBVTkNFUlRBSU5fU1RBVEUsIFVORVhQRUNU\nRURfQ09ORElUSU9OLCBDT01QT1NJVEUsCiAgICAgICAgfTsKICAgICAgICBw\ndWJsaWMgc3RhdGljIFN0YXR1c0NvZGUgdmFsdWVPZigKICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNj\ncmlwdG9yIGRlc2MpIHsKICAgICAgICAgICAgaWYgKGRlc2MuZ2V0VHlwZSgp\nICE9IGdldERlc2NyaXB0b3IoKSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oCiAgICAg\nICAgICAgICAgICAgICAgIkVudW1WYWx1ZURlc2NyaXB0b3IgaXMgbm90IGZv\nciB0aGlzIHR5cGUuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIFZBTFVFU1tkZXNjLmdldEluZGV4KCldOwogICAgICAgIH0KICAgICAg\nICBwcml2YXRlIGZpbmFsIGludCBpbmRleDsKICAgICAgICBwcml2YXRlIGZp\nbmFsIGludCB2YWx1ZTsKICAgICAgICBwcml2YXRlIFN0YXR1c0NvZGUoaW50\nIGluZGV4LCBpbnQgdmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5pbmRleCA9\nIGluZGV4OwogICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICAg\nICAgfQoKICAgICAgICBzdGF0aWMgewogICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5nZXREZXNjcmlwdG9y\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25f\ncG9pbnQoZW51bV9zY29wZTpIZWR3aWcuU3RhdHVzQ29kZSkKICAgIH0KCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIE1lc3NhZ2UgZXh0ZW5kcwog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7\nCiAgICAgICAgLy8gVXNlIE1lc3NhZ2UubmV3QnVpbGRlcigpIHRvIGNvbnN0\ncnVjdC4KICAgICAgICBwcml2YXRlIE1lc3NhZ2UoKSB7CiAgICAgICAgICAg\nIGluaXRGaWVsZHMoKTsKICAgICAgICB9CiAgICAgICAgcHJpdmF0ZSBNZXNz\nYWdlKGJvb2xlYW4gbm9Jbml0KSB7fQoKICAgICAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBNZXNzYWdlIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICBwdWJs\naWMgc3RhdGljIE1lc3NhZ2UgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAg\nICAgICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE1lc3NhZ2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlw\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2ds\nZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0\nRGVzY3JpcHRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRp\nY19IZWR3aWdfTWVzc2FnZV9kZXNjcmlwdG9yOwogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZp\nZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFs\nX3N0YXRpY19IZWR3aWdfTWVzc2FnZV9maWVsZEFjY2Vzc29yVGFibGU7CiAg\nICAgICAgfQoKICAgICAgICAvLyByZXF1aXJlZCBieXRlcyBib2R5ID0gMTsK\nICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBCT0RZX0ZJRUxEX05V\nTUJFUiA9IDE7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGhhc0JvZHk7CiAg\nICAgICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nYm9keV8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzQm9keSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGhhc0JvZHk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0Qm9keSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIGJvZHlfOwogICAgICAgIH0KCiAgICAgICAgLy8g\nb3B0aW9uYWwgYnl0ZXMgc3JjUmVnaW9uID0gMjsKICAgICAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBTUkNSRUdJT05fRklFTERfTlVNQkVSID0gMjsK\nICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFzU3JjUmVnaW9uOwogICAgICAg\nIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHNyY1Jl\nZ2lvbl8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzU3JjUmVnaW9uKCkgewogICAg\nICAgICAgICByZXR1cm4gaGFzU3JjUmVnaW9uOwogICAgICAgIH0KICAgICAg\nICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFNy\nY1JlZ2lvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHNyY1JlZ2lvbl87CiAg\nICAgICAgfQoKICAgICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLk1lc3NhZ2VT\nZXFJZCBtc2dJZCA9IDM7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgTVNHSURfRklFTERfTlVNQkVSID0gMzsKICAgICAgICBwcml2YXRlIGJv\nb2xlYW4gaGFzTXNnSWQ7CiAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgbXNn\nSWRfOwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc01zZ0lkKCkgewogICAg\nICAgICAgICByZXR1cm4gaGFzTXNnSWQ7CiAgICAgICAgfQogICAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQgZ2V0TXNnSWQoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBtc2dJZF87CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgaW5p\ndEZpZWxkcygpIHsKICAgICAgICAgICAgbXNnSWRfID0gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdl\ndERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMg\nZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgICAgICBp\nZiAoIWhhc0JvZHkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKGhh\nc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIGlmICghZ2V0TXNnSWQoKS5p\nc0luaXRpYWxpemVkKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIGdldFNlcmlhbGl6ZWRT\naXplKCk7CiAgICAgICAgICAgIGlmIChoYXNCb2R5KCkpIHsKICAgICAgICAg\nICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDEsIGdldEJvZHkoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1NyY1JlZ2lvbigpKSB7CiAg\nICAgICAgICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBnZXRTcmNSZWdp\nb24oKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc01zZ0lk\nKCkpIHsKICAgICAgICAgICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMywg\nZ2V0TXNnSWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0VW5r\nbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgICAgICB9CgogICAg\nICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsK\nICAgICAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgewogICAg\nICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7CiAg\nICAgICAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKCiAgICAg\nICAgICAgIHNpemUgPSAwOwogICAgICAgICAgICBpZiAoaGFzQm9keSgpKSB7\nCiAgICAgICAgICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAgLmNv\nbXB1dGVCeXRlc1NpemUoMSwgZ2V0Qm9keSgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZiAoaGFzU3JjUmVnaW9uKCkpIHsKICAgICAgICAgICAg\nICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0\ncmVhbQogICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6\nZSgyLCBnZXRTcmNSZWdpb24oKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKGhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIHNpemUgKz0g\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAg\nICAgICAgICAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDMsIGdldE1z\nZ0lkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNpemUgKz0gZ2V0\nVW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgICAg\nICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICAgICAg\nICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZSBwYXJzZUZyb20oCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgICAgICAgICAgdGhyb3dz\nIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlIHBhcnNlRnJvbSgKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\nZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAu\nYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlIHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAgICAgICAgICAgICAg\nIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1\nZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZyb20oCiAgICAgICAg\nICAgIGJ5dGVbXSBkYXRhLAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAg\nICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZyb20o\namF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAgICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7\nCiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZy\nb20oCiAgICAgICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIHBhcnNlRGVsaW1pdGVk\nRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgICAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICBC\ndWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgICAgICAgIGlm\nIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2UgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgICAgICBqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigp\nOwogICAgICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20o\naW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJz\nZUZyb20oCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJ\nbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAg\nfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZyb20oCiAgICAg\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBp\nbnB1dCwKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5l\nd0J1aWxkZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBCdWlsZGVyLmNyZWF0\nZSgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWls\nZGVyRm9yVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5l\nd0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZSBwcm90b3R5cGUpIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgICAgICB9\nCiAgICAgICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgewogICAgICAg\nICAgICByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRz\nCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgICAgICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlIHJlc3VsdDsKCiAgICAgICAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlLm5ld0J1aWxkZXIoKQogICAgICAgICAgICBwcml2YXRlIEJ1aWxkZXIo\nKSB7fQoKICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVh\ndGUoKSB7CiAgICAgICAgICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcg\nQnVpbGRlcigpOwogICAgICAgICAgICAgICAgYnVpbGRlci5yZXN1bHQgPSBu\nZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIGludGVy\nbmFsR2V0UmVzdWx0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIg\nY2xlYXIoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiQ2Fubm90IGNh\nbGwgY2xlYXIoKSBhZnRlciBidWlsZCgpLiIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UoKTsKICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiBjcmVhdGUoKS5tZXJnZUZyb20ocmVzdWx0KTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYu\nRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgICBnZXREZXNjcmlw\ndG9yRm9yVHlwZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdl\ndERlc2NyaXB0b3IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0lu\naXRpYWxpemVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5p\nc0luaXRpYWxpemVkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgYnVpbGQoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0\nICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9u\nKHJlc3VsdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZSBidWlsZFBhcnNlZCgpCiAgICAgICAgICAgICAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmICghaXNJ\nbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nVW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2UgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgICAgICAg\nICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgICAgICAgICAgImJ1aWxkKCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQg\nb24gdGhpcyBCdWlsZGVyLiIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZSByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAgICAgICAg\nICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0\ndXJuTWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3Ro\nZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2UpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlKW90aGVyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VG\ncm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciA9\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAg\nICAgICAgICAgICAgIGlmIChvdGhlci5oYXNCb2R5KCkpIHsKICAgICAgICAg\nICAgICAgICAgICBzZXRCb2R5KG90aGVyLmdldEJvZHkoKSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3RoZXIuaGFzU3JjUmVn\naW9uKCkpIHsKICAgICAgICAgICAgICAgICAgICBzZXRTcmNSZWdpb24ob3Ro\nZXIuZ2V0U3JjUmVnaW9uKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgaWYgKG90aGVyLmhhc01zZ0lkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBtZXJnZU1zZ0lkKG90aGVyLmdldE1zZ0lkKCkpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5tZXJnZVVua25vd25G\naWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAg\nICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lz\ndHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVy\nIHVua25vd25GaWVsZHMgPQogICAgICAgICAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAg\nICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsK\nICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAg\nICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAgICAg\nICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgICAgIGNh\nc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3du\nRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJzZVVu\na25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25S\nZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSAxMDogewogICAgICAgICAgICAgICAgICAgICAgICBzZXRC\nb2R5KGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0\nU3JjUmVnaW9uKGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGNhc2UgMjY6IHsKICAgICAgICAgICAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZVNlcUlkLkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5u\nZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYXNN\nc2dJZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJCdWls\nZGVyLm1lcmdlRnJvbShnZXRNc2dJZCgpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVz\nc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHNldE1zZ0lkKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0\naWFsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8gcmVx\ndWlyZWQgYnl0ZXMgYm9keSA9IDE7CiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGhhc0JvZHkoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0\nLmhhc0JvZHkoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldEJvZHkoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldEJvZHkoKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRCb2R5KGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewogICAgICAg\nICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNCb2R5ID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5ib2R5XyA9IHZhbHVlOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJCb2R5KCkgewogICAgICAg\nICAgICAgICAgcmVzdWx0Lmhhc0JvZHkgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgIHJlc3VsdC5ib2R5XyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldEJv\nZHkoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBvcHRpb25hbCBieXRlcyBzcmNSZWdpb24g\nPSAyOwogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTcmNSZWdpb24o\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1NyY1JlZ2lv\nbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3JjUmVnaW9uKCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTcmNSZWdpb24oKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRTcmNS\nZWdpb24oY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7\nCiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhh\nc1NyY1JlZ2lvbiA9IHRydWU7CiAgICAgICAgICAgICAgICByZXN1bHQuc3Jj\nUmVnaW9uXyA9IHZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xl\nYXJTcmNSZWdpb24oKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzU3Jj\nUmVnaW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXN1bHQuc3JjUmVn\naW9uXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFNyY1JlZ2lvbigpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWVzc2FnZVNlcUlkIG1z\nZ0lkID0gMzsKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzTXNnSWQo\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc01zZ0lkKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBn\nZXRNc2dJZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuZ2V0\nTXNnSWQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRNc2dJZChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgdmFsdWUpIHsKICAgICAgICAgICAg\nICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzTXNnSWQgPSB0cnVl\nOwogICAgICAgICAgICAgICAgcmVzdWx0Lm1zZ0lkXyA9IHZhbHVlOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TXNnSWQob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxk\nZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXN1bHQu\naGFzTXNnSWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzdWx0Lm1zZ0lk\nXyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGlj\nIEJ1aWxkZXIgbWVyZ2VNc2dJZChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgdmFsdWUpIHsKICAgICAg\nICAgICAgICAgIGlmIChyZXN1bHQuaGFzTXNnSWQoKSAmJgogICAgICAgICAg\nICAgICAgICAgICAgICByZXN1bHQubXNnSWRfICE9IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXRE\nZWZhdWx0SW5zdGFuY2UoKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3Vs\ndC5tc2dJZF8gPQogICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQu\nbmV3QnVpbGRlcihyZXN1bHQubXNnSWRfKS5tZXJnZUZyb20odmFsdWUpLmJ1\naWxkUGFydGlhbCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICByZXN1bHQubXNnSWRfID0gdmFsdWU7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzTXNnSWQgPSB0\ncnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNc2dJZCgpIHsK\nICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNNc2dJZCA9IGZhbHNlOwogICAg\nICAgICAgICAgICAgcmVzdWx0Lm1zZ0lkXyA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZh\ndWx0SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRp\nb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3aWcuTWVzc2FnZSkKICAgICAg\nICB9CgogICAgICAgIHN0YXRpYyB7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0\nYW5jZSA9IG5ldyBNZXNzYWdlKHRydWUpOwogICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbEZv\ncmNlSW5pdCgpOwogICAgICAgICAgICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZp\nZWxkcygpOwogICAgICAgIH0KCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0\naW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5NZXNzYWdlKQogICAgfQoK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgUmVnaW9uU3BlY2lmaWNT\nZXFJZCBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlIHsKICAgICAgICAvLyBVc2UgUmVnaW9uU3BlY2lmaWNT\nZXFJZC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgICAgIHByaXZh\ndGUgUmVnaW9uU3BlY2lmaWNTZXFJZCgpIHsKICAgICAgICAgICAgaW5pdEZp\nZWxkcygpOwogICAgICAgIH0KICAgICAgICBwcml2YXRlIFJlZ2lvblNwZWNp\nZmljU2VxSWQoYm9vbGVhbiBub0luaXQpIHt9CgogICAgICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIFJlZ2lvblNwZWNpZmljU2VxSWQgZGVmYXVsdEluc3Rh\nbmNlOwogICAgICAgIHB1YmxpYyBzdGF0aWMgUmVnaW9uU3BlY2lmaWNTZXFJ\nZCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBk\nZWZhdWx0SW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUmVn\naW9uU3BlY2lmaWNTZXFJZCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkg\newogICAgICAgICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNj\ncmlwdG9yKCkgewogICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19SZWdpb25TcGVjaWZpY1NlcUlkX2Rlc2NyaXB0b3I7CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVy\nbmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgICAgICByZXR1\ncm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\naW50ZXJuYWxfc3RhdGljX0hlZHdpZ19SZWdpb25TcGVjaWZpY1NlcUlkX2Zp\nZWxkQWNjZXNzb3JUYWJsZTsKICAgICAgICB9CgogICAgICAgIC8vIHJlcXVp\ncmVkIGJ5dGVzIHJlZ2lvbiA9IDE7CiAgICAgICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgUkVHSU9OX0ZJRUxEX05VTUJFUiA9IDE7CiAgICAgICAgcHJp\ndmF0ZSBib29sZWFuIGhhc1JlZ2lvbjsKICAgICAgICBwcml2YXRlIGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyByZWdpb25fID0gY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1JlZ2lvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc1Jl\nZ2lvbjsKICAgICAgICB9CiAgICAgICAgcHVibGljIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBnZXRSZWdpb24oKSB7CiAgICAgICAgICAgIHJl\ndHVybiByZWdpb25fOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVxdWlyZWQg\ndWludDY0IHNlcUlkID0gMjsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBTRVFJRF9GSUVMRF9OVU1CRVIgPSAyOwogICAgICAgIHByaXZhdGUg\nYm9vbGVhbiBoYXNTZXFJZDsKICAgICAgICBwcml2YXRlIGxvbmcgc2VxSWRf\nID0gMEw7CiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzU2VxSWQoKSB7CiAg\nICAgICAgICAgIHJldHVybiBoYXNTZXFJZDsKICAgICAgICB9CiAgICAgICAg\ncHVibGljIGxvbmcgZ2V0U2VxSWQoKSB7CiAgICAgICAgICAgIHJldHVybiBz\nZXFJZF87CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgaW5pdEZp\nZWxkcygpIHsKICAgICAgICB9CiAgICAgICAgcHVibGljIGZpbmFsIGJvb2xl\nYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICAgICAgaWYgKCFoYXNSZWdp\nb24pIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKCFoYXNTZXFJZCkg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgICAgICAgIGlmIChoYXNSZWdp\nb24oKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoMSwg\nZ2V0UmVnaW9uKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICho\nYXNTZXFJZCgpKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3JpdGVVSW50\nNjQoMiwgZ2V0U2VxSWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgICAgICB9\nCgogICAgICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUg\nPSAtMTsKICAgICAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkg\newogICAgICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNp\nemU7CiAgICAgICAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsK\nCiAgICAgICAgICAgIHNpemUgPSAwOwogICAgICAgICAgICBpZiAoaGFzUmVn\naW9uKCkpIHsKICAgICAgICAgICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgICAgICAgICAg\nICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgxLCBnZXRSZWdpb24oKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1NlcUlkKCkpIHsKICAgICAg\nICAgICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbQogICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZVVJ\nbnQ2NFNpemUoMiwgZ2V0U2VxSWQoKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXpl\nZFNpemUoKTsKICAgICAgICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9\nIHNpemU7CiAgICAgICAgICAgIHJldHVybiBzaXplOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRnJv\nbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAg\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWls\nZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lv\nblNwZWNpZmljU2VxSWQgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRh\nLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAgIC5idWls\nZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lv\nblNwZWNpZmljU2VxSWQgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAg\nICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAg\nICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nIHBhcnNlRnJvbSgKICAgICAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAg\nICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRnJvbShqYXZhLmlvLklucHV0\nU3RyZWFtIGlucHV0KQogICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAg\nICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRnJv\nbSgKICAgICAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgICAg\nIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQgcGFy\nc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAg\nICAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0\nKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJz\nZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBwYXJzZURlbGltaXRlZEZy\nb20oCiAgICAgICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICBCdWlsZGVy\nIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgICAgICAgIGlmIChidWls\nZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0\ncnkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBh\ncnNlZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRnJvbSgKICAg\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRnJvbSgKICAg\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFt\nIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVu\nc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAg\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2Vk\nKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIg\nbmV3QnVpbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIEJ1aWxkZXIuY3Jl\nYXRlKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1\naWxkZXJGb3JUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIg\nbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHByb3RvdHlwZSkgewogICAg\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5\ncGUpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxk\nZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBC\ndWlsZGVyIGV4dGVuZHMKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4gewogICAgICAg\nICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQgcmVzdWx0OwoKICAgICAg\nICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQubmV3\nQnVpbGRlcigpCiAgICAgICAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9Cgog\nICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsK\nICAgICAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVy\nKCk7CiAgICAgICAgICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25T\ncGVjaWZpY1NlcUlkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRl\ncjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJvdGVjdGVkIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNw\nZWNpZmljU2VxSWQgaW50ZXJuYWxHZXRSZXN1bHQoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAgICAgICAgICAgIGlm\nIChyZXN1bHQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgICJDYW5ub3QgY2FsbCBjbGVhcigpIGFmdGVyIGJ1aWxkKCkuIik7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQgPSBu\nZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUmVnaW9uU3BlY2lmaWNTZXFJZCgpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsb25lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZSgp\nLm1lcmdlRnJvbShyZXN1bHQpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNj\ncmlwdG9yCiAgICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQuZ2V0RGVz\nY3JpcHRvcigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVn\naW9uU3BlY2lmaWNTZXFJZCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkg\newogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBidWls\nZCgpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCAmJiAh\naXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBidWlsZFBh\ncnRpYWwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdp\nb25TcGVjaWZpY1NlcUlkIGJ1aWxkUGFyc2VkKCkKICAgICAgICAgICAgICAg\nICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKCFpc0lu\naXRpYWxpemVkKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdV\nbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAg\nICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0\ndXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBidWlsZFBhcnRpYWwoKSB7CiAg\nICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAog\nICAgICAgICAgICAgICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBi\nZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHJldHVybk1l\nID0gcmVzdWx0OwogICAgICAgICAgICAgICAgcmVzdWx0ID0gbnVsbDsKICAg\nICAgICAgICAgICAgIHJldHVybiByZXR1cm5NZTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29n\nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgICAgICAgICAg\naWYgKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCkgewogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmlj\nU2VxSWQpb3RoZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAgICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJn\nZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBvdGhlcikgewogICAgICAgICAgICAg\nICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQuZ2V0RGVmYXVsdElu\nc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgaWYgKG90\naGVyLmhhc1JlZ2lvbigpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0UmVn\naW9uKG90aGVyLmdldFJlZ2lvbigpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGlmIChvdGhlci5oYXNTZXFJZCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgc2V0U2VxSWQob3RoZXIuZ2V0U2VxSWQoKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm1lcmdlVW5rbm93\nbkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxk\nZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkp\nOwogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAg\nICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAg\nICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICAgICAg\nY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25v\nd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAg\nZGVmYXVsdDogewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcnNl\nVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lv\nblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBjYXNlIDEwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNl\ndFJlZ2lvbihpbnB1dC5yZWFkQnl0ZXMoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBjYXNlIDE2OiB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNldFNlcUlkKGlucHV0LnJlYWRVSW50NjQoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCgogICAgICAgICAgICAvLyByZXF1aXJlZCBieXRlcyByZWdpb24gPSAx\nOwogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNSZWdpb24oKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1JlZ2lvbigpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgZ2V0UmVnaW9uKCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIHJlc3VsdC5nZXRSZWdpb24oKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZWdpb24oY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBp\nZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1JlZ2lvbiA9IHRydWU7CiAg\nICAgICAgICAgICAgICByZXN1bHQucmVnaW9uXyA9IHZhbHVlOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSZWdpb24oKSB7CiAgICAgICAgICAg\nICAgICByZXN1bHQuaGFzUmVnaW9uID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICByZXN1bHQucmVnaW9uXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFJl\nZ2lvbigpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIHJlcXVpcmVkIHVpbnQ2NCBzZXFJZCA9\nIDI7CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1NlcUlkKCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNTZXFJZCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBsb25nIGdldFNlcUlkKCkg\newogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTZXFJZCgpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFNl\ncUlkKGxvbmcgdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNT\nZXFJZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXN1bHQuc2VxSWRfID0g\ndmFsdWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclNlcUlkKCkg\newogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1NlcUlkID0gZmFsc2U7CiAg\nICAgICAgICAgICAgICByZXN1bHQuc2VxSWRfID0gMEw7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVk\nd2lnLlJlZ2lvblNwZWNpZmljU2VxSWQpCiAgICAgICAgfQoKICAgICAgICBz\ndGF0aWMgewogICAgICAgICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgUmVn\naW9uU3BlY2lmaWNTZXFJZCh0cnVlKTsKICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxGb3Jj\nZUluaXQoKTsKICAgICAgICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVs\nZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlv\nbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuUmVnaW9uU3BlY2lmaWNTZXFJ\nZCkKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIE1lc3Nh\nZ2VTZXFJZCBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlIHsKICAgICAgICAvLyBVc2UgTWVzc2FnZVNlcUlk\nLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICAgICAgcHJpdmF0ZSBN\nZXNzYWdlU2VxSWQoKSB7CiAgICAgICAgICAgIGluaXRGaWVsZHMoKTsKICAg\nICAgICB9CiAgICAgICAgcHJpdmF0ZSBNZXNzYWdlU2VxSWQoYm9vbGVhbiBu\nb0luaXQpIHt9CgogICAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIE1lc3Nh\nZ2VTZXFJZCBkZWZhdWx0SW5zdGFuY2U7CiAgICAgICAgcHVibGljIHN0YXRp\nYyBNZXNzYWdlU2VxSWQgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICAg\nICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIE1lc3NhZ2VTZXFJZCBnZXREZWZhdWx0SW5zdGFuY2VGb3JU\neXBlKCkgewogICAgICAgICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29v\nZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBn\nZXREZXNjcmlwdG9yKCkgewogICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3Rh\ndGljX0hlZHdpZ19NZXNzYWdlU2VxSWRfZGVzY3JpcHRvcjsKICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJu\nYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VTZXFJZF9maWVsZEFjY2Vz\nc29yVGFibGU7CiAgICAgICAgfQoKICAgICAgICAvLyBvcHRpb25hbCB1aW50\nNjQgbG9jYWxDb21wb25lbnQgPSAxOwogICAgICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IExPQ0FMQ09NUE9ORU5UX0ZJRUxEX05VTUJFUiA9IDE7CiAg\nICAgICAgcHJpdmF0ZSBib29sZWFuIGhhc0xvY2FsQ29tcG9uZW50OwogICAg\nICAgIHByaXZhdGUgbG9uZyBsb2NhbENvbXBvbmVudF8gPSAwTDsKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNMb2NhbENvbXBvbmVudCgpIHsKICAgICAg\nICAgICAgcmV0dXJuIGhhc0xvY2FsQ29tcG9uZW50OwogICAgICAgIH0KICAg\nICAgICBwdWJsaWMgbG9uZyBnZXRMb2NhbENvbXBvbmVudCgpIHsKICAgICAg\nICAgICAgcmV0dXJuIGxvY2FsQ29tcG9uZW50XzsKICAgICAgICB9CgogICAg\nICAgIC8vIHJlcGVhdGVkIC5IZWR3aWcuUmVnaW9uU3BlY2lmaWNTZXFJZCBy\nZW1vdGVDb21wb25lbnRzID0gMjsKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBSRU1PVEVDT01QT05FTlRTX0ZJRUxEX05VTUJFUiA9IDI7CiAg\nICAgICAgcHJpdmF0ZSBqYXZhLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nPiByZW1vdGVDb21wb25lbnRzXyA9CiAgICAgICAgICAgIGphdmEudXRpbC5D\nb2xsZWN0aW9ucy5lbXB0eUxpc3QoKTsKICAgICAgICBwdWJsaWMgamF2YS51\ndGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZD4gZ2V0UmVtb3RlQ29tcG9uZW50\nc0xpc3QoKSB7CiAgICAgICAgICAgIHJldHVybiByZW1vdGVDb21wb25lbnRz\nXzsKICAgICAgICB9CiAgICAgICAgcHVibGljIGludCBnZXRSZW1vdGVDb21w\nb25lbnRzQ291bnQoKSB7CiAgICAgICAgICAgIHJldHVybiByZW1vdGVDb21w\nb25lbnRzXy5zaXplKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25T\ncGVjaWZpY1NlcUlkIGdldFJlbW90ZUNvbXBvbmVudHMoaW50IGluZGV4KSB7\nCiAgICAgICAgICAgIHJldHVybiByZW1vdGVDb21wb25lbnRzXy5nZXQoaW5k\nZXgpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVs\nZHMoKSB7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFu\nIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgIGZvciAob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lm\naWNTZXFJZCBlbGVtZW50IDogZ2V0UmVtb3RlQ29tcG9uZW50c0xpc3QoKSkg\newogICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50LmlzSW5pdGlhbGl6ZWQo\nKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgd3Jp\ndGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91\ndHB1dCkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAg\nICAgICAgaWYgKGhhc0xvY2FsQ29tcG9uZW50KCkpIHsKICAgICAgICAgICAg\nICAgIG91dHB1dC53cml0ZVVJbnQ2NCgxLCBnZXRMb2NhbENvbXBvbmVudCgp\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmlj\nU2VxSWQgZWxlbWVudCA6IGdldFJlbW90ZUNvbXBvbmVudHNMaXN0KCkpIHsK\nICAgICAgICAgICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMiwgZWxlbWVu\ndCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0VW5rbm93bkZpZWxk\ncygpLndyaXRlVG8ob3V0cHV0KTsKICAgICAgICB9CgogICAgICAgIHByaXZh\ndGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgICAgICBw\ndWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgewogICAgICAgICAgICBp\nbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7CiAgICAgICAgICAg\nIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKCiAgICAgICAgICAgIHNp\nemUgPSAwOwogICAgICAgICAgICBpZiAoaGFzTG9jYWxDb21wb25lbnQoKSkg\newogICAgICAgICAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVm\nLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAgICAgICAgICAgICAgIC5j\nb21wdXRlVUludDY0U2l6ZSgxLCBnZXRMb2NhbENvbXBvbmVudCgpKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBmb3IgKG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQg\nZWxlbWVudCA6IGdldFJlbW90ZUNvbXBvbmVudHNMaXN0KCkpIHsKICAgICAg\nICAgICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbQogICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZU1l\nc3NhZ2VTaXplKDIsIGVsZW1lbnQpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHNpemUgKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRT\naXplKCk7CiAgICAgICAgICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBz\naXplOwogICAgICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHBhcnNlRnJvbSgKICAgICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZh\nbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBw\nYXJzZUZyb20oCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBkYXRhLAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHBhcnNlRnJv\nbShieXRlW10gZGF0YSkKICAgICAgICAgICAgICAgIHRocm93cyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEpLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkIHBhcnNlRnJvbSgKICAgICAgICAgICAgYnl0ZVtd\nIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAg\nICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VGcm9tKGphdmEu\naW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBwYXJzZUZy\nb20oCiAgICAgICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VEZWxp\nbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAg\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgICAg\nICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICAg\nICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\nd0J1aWxkZXIoKTsKICAgICAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxp\nbWl0ZWRGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZCBwYXJzZUZyb20oCiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkIHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAg\nICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsKICAgICAgICAgICAg\ncmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7CiAgICAgICAgfQogICAgICAgIHB1\nYmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgewogICAgICAgICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpOwogICAgICAgIH0KICAgICAgICBwdWJs\naWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcHJvdG90\neXBlKSB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKHByb3RvdHlwZSk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWls\nZGVyIHRvQnVpbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIodGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVy\nPiB7CiAgICAgICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHJlc3VsdDsKCiAg\nICAgICAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQubmV3QnVp\nbGRlcigpCiAgICAgICAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CgogICAg\nICAgICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAg\nICAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7\nCiAgICAgICAgICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQoKTsKICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIGludGVy\nbmFsR2V0UmVzdWx0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3Vs\ndDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIg\nY2xlYXIoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiQ2Fubm90IGNh\nbGwgY2xlYXIoKSBhZnRlciBidWlsZCgpLiIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShyZXN1bHQpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90\nb2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICAgIGdldERl\nc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZC5nZXREZXNjcmlwdG9yKCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgZ2V0RGVmYXVsdEluc3RhbmNlRm9y\nVHlwZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIGJ1aWxkKCkgewog\nICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsICYmICFpc0luaXRp\nYWxpemVkKCkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXdVbmlu\naXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcml2YXRlIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZCBidWlsZFBhcnNlZCgpCiAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgIGlmICghaXNJbml0aWFsaXplZCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1l\nc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3Vs\ndCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBidWlsZFBhcnRp\nYWwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VT\nZXFJZCBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVz\ndWx0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAg\nICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1\naWxkZXIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBp\nZiAocmVzdWx0LnJlbW90ZUNvbXBvbmVudHNfICE9IGphdmEudXRpbC5Db2xs\nZWN0aW9ucy5FTVBUWV9MSVNUKSB7CiAgICAgICAgICAgICAgICAgICAgcmVz\ndWx0LnJlbW90ZUNvbXBvbmVudHNfID0KICAgICAgICAgICAgICAgICAgICAg\nICAgamF2YS51dGlsLkNvbGxlY3Rpb25zLnVubW9kaWZpYWJsZUxpc3QocmVz\ndWx0LnJlbW90ZUNvbXBvbmVudHNfKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZCByZXR1cm5NZSA9IHJlc3VsdDsKICAg\nICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gcmV0dXJuTWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1l\nc3NhZ2Ugb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciBpbnN0\nYW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZClvdGhlcik7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN1cGVyLm1lcmdlRnJv\nbShvdGhlcik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgb3RoZXIpIHsKICAg\nICAgICAgICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVs\ndEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgaWYg\nKG90aGVyLmhhc0xvY2FsQ29tcG9uZW50KCkpIHsKICAgICAgICAgICAgICAg\nICAgICBzZXRMb2NhbENvbXBvbmVudChvdGhlci5nZXRMb2NhbENvbXBvbmVu\ndCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgh\nb3RoZXIucmVtb3RlQ29tcG9uZW50c18uaXNFbXB0eSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKHJlc3VsdC5yZW1vdGVDb21wb25lbnRzXy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbW90\nZUNvbXBvbmVudHNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8b3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3Bl\nY2lmaWNTZXFJZD4oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgcmVzdWx0LnJlbW90ZUNvbXBvbmVudHNfLmFkZEFsbChv\ndGhlci5yZW1vdGVDb21wb25lbnRzXyk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci5n\nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbSgKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxk\ncyA9CiAgICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5V\nbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgICAg\nICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnQgdGFn\nID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgICAgICAgICAgIHN3aXRj\naCAodGFnKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAg\nICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93\nbkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlu\ncHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25v\nd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlIDg6\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0TG9jYWxDb21wb25lbnQo\naW5wdXQucmVhZFVJbnQ2NCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3Bl\nY2lmaWNTZXFJZC5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaW5w\ndXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBhZGRSZW1vdGVDb21wb25lbnRz\nKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAgICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgoKICAgICAgICAgICAgLy8gb3B0aW9uYWwgdWludDY0IGxvY2FsQ29tcG9u\nZW50ID0gMTsKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzTG9jYWxD\nb21wb25lbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhh\nc0xvY2FsQ29tcG9uZW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncHVibGljIGxvbmcgZ2V0TG9jYWxDb21wb25lbnQoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gcmVzdWx0LmdldExvY2FsQ29tcG9uZW50KCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TG9jYWxD\nb21wb25lbnQobG9uZyB2YWx1ZSkgewogICAgICAgICAgICAgICAgcmVzdWx0\nLmhhc0xvY2FsQ29tcG9uZW50ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJl\nc3VsdC5sb2NhbENvbXBvbmVudF8gPSB2YWx1ZTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyTG9jYWxDb21wb25lbnQoKSB7CiAgICAgICAgICAg\nICAgICByZXN1bHQuaGFzTG9jYWxDb21wb25lbnQgPSBmYWxzZTsKICAgICAg\nICAgICAgICAgIHJlc3VsdC5sb2NhbENvbXBvbmVudF8gPSAwTDsKICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyByZXBlYXRlZCAuSGVkd2lnLlJlZ2lvblNwZWNpZmljU2VxSWQg\ncmVtb3RlQ29tcG9uZW50cyA9IDI7CiAgICAgICAgICAgIHB1YmxpYyBqYXZh\nLnV0aWwuTGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkPiBnZXRSZW1vdGVDb21wb25l\nbnRzTGlzdCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBqYXZhLnV0aWwu\nQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChyZXN1bHQucmVtb3RlQ29t\ncG9uZW50c18pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBp\nbnQgZ2V0UmVtb3RlQ29tcG9uZW50c0NvdW50KCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHJlc3VsdC5nZXRSZW1vdGVDb21wb25lbnRzQ291bnQoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNT\nZXFJZCBnZXRSZW1vdGVDb21wb25lbnRzKGludCBpbmRleCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRSZW1vdGVDb21wb25lbnRzKGlu\nZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRSZW1vdGVDb21wb25lbnRzKGludCBpbmRleCwgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNT\nZXFJZCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50\nZXJFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHJlc3VsdC5yZW1vdGVDb21wb25lbnRzXy5zZXQoaW5kZXgsIHZhbHVl\nKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJlbW90ZUNvbXBvbmVu\ndHMoaW50IGluZGV4LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLkJ1aWxkZXIgYnVpbGRl\nckZvclZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucmVtb3RlQ29t\ncG9uZW50c18uc2V0KGluZGV4LCBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKSk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBhZGRSZW1vdGVDb21wb25lbnRz\nKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJl\nZ2lvblNwZWNpZmljU2VxSWQgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlm\nICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJlbW90ZUNvbXBvbmVudHNf\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZW1v\ndGVDb21wb25lbnRzXyA9IG5ldyBqYXZhLnV0aWwuQXJyYXlMaXN0PG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNw\nZWNpZmljU2VxSWQ+KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXN1bHQucmVtb3RlQ29tcG9uZW50c18uYWRkKHZhbHVlKTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlbW90ZUNvbXBvbmVudHMob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9u\nU3BlY2lmaWNTZXFJZC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAg\nICAgICAgICAgICAgaWYgKHJlc3VsdC5yZW1vdGVDb21wb25lbnRzXy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVtb3RlQ29t\ncG9uZW50c18gPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdDxvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZp\nY1NlcUlkPigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\ncmVzdWx0LnJlbW90ZUNvbXBvbmVudHNfLmFkZChidWlsZGVyRm9yVmFsdWUu\nYnVpbGQoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBhZGRBbGxSZW1v\ndGVDb21wb25lbnRzKAogICAgICAgICAgICAgICAgamF2YS5sYW5nLkl0ZXJh\nYmxlPD8gZXh0ZW5kcyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkPiB2YWx1ZXMpIHsKICAg\nICAgICAgICAgICAgIGlmIChyZXN1bHQucmVtb3RlQ29tcG9uZW50c18uaXNF\nbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbW90ZUNv\nbXBvbmVudHNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8b3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lm\naWNTZXFJZD4oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHN1cGVyLmFkZEFsbCh2YWx1ZXMsIHJlc3VsdC5yZW1vdGVDb21wb25lbnRz\nXyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclJlbW90ZUNvbXBv\nbmVudHMoKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucmVtb3RlQ29tcG9u\nZW50c18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJf\nc2NvcGU6SGVkd2lnLk1lc3NhZ2VTZXFJZCkKICAgICAgICB9CgogICAgICAg\nIHN0YXRpYyB7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBN\nZXNzYWdlU2VxSWQodHJ1ZSk7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9yY2VJbml0\nKCk7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9p\nbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLk1lc3NhZ2VTZXFJZCkKICAgIH0KCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFB1YlN1YlJlcXVlc3QgZXh0\nZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZSB7CiAgICAgICAgLy8gVXNlIFB1YlN1YlJlcXVlc3QubmV3QnVpbGRl\ncigpIHRvIGNvbnN0cnVjdC4KICAgICAgICBwcml2YXRlIFB1YlN1YlJlcXVl\nc3QoKSB7CiAgICAgICAgICAgIGluaXRGaWVsZHMoKTsKICAgICAgICB9CiAg\nICAgICAgcHJpdmF0ZSBQdWJTdWJSZXF1ZXN0KGJvb2xlYW4gbm9Jbml0KSB7\nfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBQdWJTdWJSZXF1ZXN0\nIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICBwdWJsaWMgc3RhdGljIFB1YlN1\nYlJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICAgICAgICBy\nZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIFB1YlN1YlJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5w\ncm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19I\nZWR3aWdfUHViU3ViUmVxdWVzdF9kZXNjcmlwdG9yOwogICAgICAgIH0KCiAg\nICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdl\ndEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVy\nbmFsX3N0YXRpY19IZWR3aWdfUHViU3ViUmVxdWVzdF9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgICAgICAgfQoKICAgICAgICAvLyByZXF1aXJlZCAuSGVkd2ln\nLlByb3RvY29sVmVyc2lvbiBwcm90b2NvbFZlcnNpb24gPSAxOwogICAgICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFBST1RPQ09MVkVSU0lPTl9GSUVM\nRF9OVU1CRVIgPSAxOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBoYXNQcm90\nb2NvbFZlcnNpb247CiAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24gcHJv\ndG9jb2xWZXJzaW9uXzsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNQcm90\nb2NvbFZlcnNpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNQcm90b2Nv\nbFZlcnNpb247CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNp\nb24gZ2V0UHJvdG9jb2xWZXJzaW9uKCkgewogICAgICAgICAgICByZXR1cm4g\ncHJvdG9jb2xWZXJzaW9uXzsKICAgICAgICB9CgogICAgICAgIC8vIHJlcXVp\ncmVkIC5IZWR3aWcuT3BlcmF0aW9uVHlwZSB0eXBlID0gMjsKICAgICAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBUWVBFX0ZJRUxEX05VTUJFUiA9IDI7\nCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGhhc1R5cGU7CiAgICAgICAgcHJp\ndmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5PcGVyYXRpb25UeXBlIHR5cGVfOwogICAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc1R5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNUeXBlOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZSBnZXRUeXBlKCkgewog\nICAgICAgICAgICByZXR1cm4gdHlwZV87CiAgICAgICAgfQoKICAgICAgICAv\nLyByZXBlYXRlZCBieXRlcyB0cmllZFNlcnZlcnMgPSAzOwogICAgICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IFRSSUVEU0VSVkVSU19GSUVMRF9OVU1C\nRVIgPSAzOwogICAgICAgIHByaXZhdGUgamF2YS51dGlsLkxpc3Q8Y29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nPiB0cmllZFNlcnZlcnNfID0KICAg\nICAgICAgICAgamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwog\nICAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmc+IGdldFRyaWVkU2VydmVyc0xpc3QoKSB7CiAgICAg\nICAgICAgIHJldHVybiB0cmllZFNlcnZlcnNfOwogICAgICAgIH0KICAgICAg\nICBwdWJsaWMgaW50IGdldFRyaWVkU2VydmVyc0NvdW50KCkgewogICAgICAg\nICAgICByZXR1cm4gdHJpZWRTZXJ2ZXJzXy5zaXplKCk7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nZ2V0VHJpZWRTZXJ2ZXJzKGludCBpbmRleCkgewogICAgICAgICAgICByZXR1\ncm4gdHJpZWRTZXJ2ZXJzXy5nZXQoaW5kZXgpOwogICAgICAgIH0KCiAgICAg\nICAgLy8gcmVxdWlyZWQgdWludDY0IHR4bklkID0gNDsKICAgICAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBUWE5JRF9GSUVMRF9OVU1CRVIgPSA0Owog\nICAgICAgIHByaXZhdGUgYm9vbGVhbiBoYXNUeG5JZDsKICAgICAgICBwcml2\nYXRlIGxvbmcgdHhuSWRfID0gMEw7CiAgICAgICAgcHVibGljIGJvb2xlYW4g\naGFzVHhuSWQoKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNUeG5JZDsKICAg\nICAgICB9CiAgICAgICAgcHVibGljIGxvbmcgZ2V0VHhuSWQoKSB7CiAgICAg\nICAgICAgIHJldHVybiB0eG5JZF87CiAgICAgICAgfQoKICAgICAgICAvLyBv\ncHRpb25hbCBib29sIHNob3VsZENsYWltID0gNTsKICAgICAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBTSE9VTERDTEFJTV9GSUVMRF9OVU1CRVIgPSA1\nOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBoYXNTaG91bGRDbGFpbTsKICAg\nICAgICBwcml2YXRlIGJvb2xlYW4gc2hvdWxkQ2xhaW1fID0gZmFsc2U7CiAg\nICAgICAgcHVibGljIGJvb2xlYW4gaGFzU2hvdWxkQ2xhaW0oKSB7CiAgICAg\nICAgICAgIHJldHVybiBoYXNTaG91bGRDbGFpbTsKICAgICAgICB9CiAgICAg\nICAgcHVibGljIGJvb2xlYW4gZ2V0U2hvdWxkQ2xhaW0oKSB7CiAgICAgICAg\nICAgIHJldHVybiBzaG91bGRDbGFpbV87CiAgICAgICAgfQoKICAgICAgICAv\nLyByZXF1aXJlZCBieXRlcyB0b3BpYyA9IDY7CiAgICAgICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgVE9QSUNfRklFTERfTlVNQkVSID0gNjsKICAgICAg\nICBwcml2YXRlIGJvb2xlYW4gaGFzVG9waWM7CiAgICAgICAgcHJpdmF0ZSBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdG9waWNfID0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICAgIHB1Ymxp\nYyBib29sZWFuIGhhc1RvcGljKCkgewogICAgICAgICAgICByZXR1cm4gaGFz\nVG9waWM7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0VG9waWMoKSB7CiAgICAgICAgICAgIHJl\ndHVybiB0b3BpY187CiAgICAgICAgfQoKICAgICAgICAvLyBvcHRpb25hbCAu\nSGVkd2lnLlB1Ymxpc2hSZXF1ZXN0IHB1Ymxpc2hSZXF1ZXN0ID0gNTI7CiAg\nICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgUFVCTElTSFJFUVVFU1Rf\nRklFTERfTlVNQkVSID0gNTI7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGhh\nc1B1Ymxpc2hSZXF1ZXN0OwogICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3Qg\ncHVibGlzaFJlcXVlc3RfOwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1B1\nYmxpc2hSZXF1ZXN0KCkgewogICAgICAgICAgICByZXR1cm4gaGFzUHVibGlz\naFJlcXVlc3Q7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVz\ndCBnZXRQdWJsaXNoUmVxdWVzdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHB1\nYmxpc2hSZXF1ZXN0XzsKICAgICAgICB9CgogICAgICAgIC8vIG9wdGlvbmFs\nIC5IZWR3aWcuU3Vic2NyaWJlUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0ID0g\nNTM7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1VCU0NSSUJF\nUkVRVUVTVF9GSUVMRF9OVU1CRVIgPSA1MzsKICAgICAgICBwcml2YXRlIGJv\nb2xlYW4gaGFzU3Vic2NyaWJlUmVxdWVzdDsKICAgICAgICBwcml2YXRlIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmliZVJlcXVlc3Qgc3Vic2NyaWJlUmVxdWVzdF87CiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzU3Vic2NyaWJlUmVxdWVzdCgpIHsKICAgICAgICAgICAg\ncmV0dXJuIGhhc1N1YnNjcmliZVJlcXVlc3Q7CiAgICAgICAgfQogICAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpYmVSZXF1ZXN0IGdldFN1YnNjcmliZVJlcXVlc3QoKSB7\nCiAgICAgICAgICAgIHJldHVybiBzdWJzY3JpYmVSZXF1ZXN0XzsKICAgICAg\nICB9CgogICAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuQ29uc3VtZVJlcXVl\nc3QgY29uc3VtZVJlcXVlc3QgPSA1NDsKICAgICAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBDT05TVU1FUkVRVUVTVF9GSUVMRF9OVU1CRVIgPSA1NDsK\nICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFzQ29uc3VtZVJlcXVlc3Q7CiAg\nICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBjb25zdW1lUmVxdWVzdF87CiAg\nICAgICAgcHVibGljIGJvb2xlYW4gaGFzQ29uc3VtZVJlcXVlc3QoKSB7CiAg\nICAgICAgICAgIHJldHVybiBoYXNDb25zdW1lUmVxdWVzdDsKICAgICAgICB9\nCiAgICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IGdldENvbnN1bWVSZXF1ZXN0\nKCkgewogICAgICAgICAgICByZXR1cm4gY29uc3VtZVJlcXVlc3RfOwogICAg\nICAgIH0KCiAgICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5VbnN1YnNjcmli\nZVJlcXVlc3QgdW5zdWJzY3JpYmVSZXF1ZXN0ID0gNTU7CiAgICAgICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgVU5TVUJTQ1JJQkVSRVFVRVNUX0ZJRUxE\nX05VTUJFUiA9IDU1OwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBoYXNVbnN1\nYnNjcmliZVJlcXVlc3Q7CiAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVl\nc3QgdW5zdWJzY3JpYmVSZXF1ZXN0XzsKICAgICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNVbnN1YnNjcmliZVJlcXVlc3QoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBoYXNVbnN1YnNjcmliZVJlcXVlc3Q7CiAgICAgICAgfQogICAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5VbnN1YnNjcmliZVJlcXVlc3QgZ2V0VW5zdWJzY3JpYmVSZXF1ZXN0KCkg\newogICAgICAgICAgICByZXR1cm4gdW5zdWJzY3JpYmVSZXF1ZXN0XzsKICAg\nICAgICB9CgogICAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3RvcERlbGl2\nZXJ5UmVxdWVzdCBzdG9wRGVsaXZlcnlSZXF1ZXN0ID0gNTY7CiAgICAgICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RPUERFTElWRVJZUkVRVUVTVF9G\nSUVMRF9OVU1CRVIgPSA1NjsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFz\nU3RvcERlbGl2ZXJ5UmVxdWVzdDsKICAgICAgICBwcml2YXRlIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVy\neVJlcXVlc3Qgc3RvcERlbGl2ZXJ5UmVxdWVzdF87CiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGhhc1N0b3BEZWxpdmVyeVJlcXVlc3Q7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IGdldFN0b3BEZWxpdmVy\neVJlcXVlc3QoKSB7CiAgICAgICAgICAgIHJldHVybiBzdG9wRGVsaXZlcnlS\nZXF1ZXN0XzsKICAgICAgICB9CgogICAgICAgIC8vIG9wdGlvbmFsIC5IZWR3\naWcuU3RhcnREZWxpdmVyeVJlcXVlc3Qgc3RhcnREZWxpdmVyeVJlcXVlc3Qg\nPSA1NzsKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVEFSVERF\nTElWRVJZUkVRVUVTVF9GSUVMRF9OVU1CRVIgPSA1NzsKICAgICAgICBwcml2\nYXRlIGJvb2xlYW4gaGFzU3RhcnREZWxpdmVyeVJlcXVlc3Q7CiAgICAgICAg\ncHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBzdGFydERlbGl2ZXJ5UmVxdWVz\ndF87CiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzU3RhcnREZWxpdmVyeVJl\ncXVlc3QoKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNTdGFydERlbGl2ZXJ5\nUmVxdWVzdDsKICAgICAgICB9CiAgICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlS\nZXF1ZXN0IGdldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkgewogICAgICAgICAg\nICByZXR1cm4gc3RhcnREZWxpdmVyeVJlcXVlc3RfOwogICAgICAgIH0KCiAg\nICAgICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAgICAgICAg\nIHByb3RvY29sVmVyc2lvbl8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24uVkVSU0lPTl9PTkU7\nCiAgICAgICAgICAgIHR5cGVfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZS5QVUJMSVNIOwogICAg\nICAgICAgICBwdWJsaXNoUmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdC5nZXREZWZh\ndWx0SW5zdGFuY2UoKTsKICAgICAgICAgICAgc3Vic2NyaWJlUmVxdWVzdF8g\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAg\nICAgICBjb25zdW1lUmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdC5nZXREZWZhdWx0\nSW5zdGFuY2UoKTsKICAgICAgICAgICAgdW5zdWJzY3JpYmVSZXF1ZXN0XyA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVu\nc3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nICAgICAgc3RvcERlbGl2ZXJ5UmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0\nLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgICAgICBzdGFydERlbGl2\nZXJ5UmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5z\ndGFuY2UoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIGZpbmFsIGJvb2xl\nYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICAgICAgaWYgKCFoYXNQcm90\nb2NvbFZlcnNpb24pIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKCFo\nYXNUeXBlKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghaGFzVHhu\nSWQpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKCFoYXNUb3BpYykg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoaGFzUHVibGlzaFJlcXVl\nc3QoKSkgewogICAgICAgICAgICAgICAgaWYgKCFnZXRQdWJsaXNoUmVxdWVz\ndCgpLmlzSW5pdGlhbGl6ZWQoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGlmIChoYXNTdWJzY3JpYmVSZXF1ZXN0KCkpIHsK\nICAgICAgICAgICAgICAgIGlmICghZ2V0U3Vic2NyaWJlUmVxdWVzdCgpLmlz\nSW5pdGlhbGl6ZWQoKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmIChoYXNDb25zdW1lUmVxdWVzdCgpKSB7CiAgICAgICAg\nICAgICAgICBpZiAoIWdldENvbnN1bWVSZXF1ZXN0KCkuaXNJbml0aWFsaXpl\nZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYgKGhhc1Vuc3Vic2NyaWJlUmVxdWVzdCgpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoIWdldFVuc3Vic2NyaWJlUmVxdWVzdCgpLmlzSW5pdGlhbGl6ZWQo\nKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChoYXNTdG9wRGVsaXZlcnlSZXF1ZXN0KCkpIHsKICAgICAgICAgICAgICAg\nIGlmICghZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdCgpLmlzSW5pdGlhbGl6ZWQo\nKSkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChoYXNTdGFydERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoIWdldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkuaXNJbml0aWFsaXpl\nZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCB3\ncml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0g\nb3V0cHV0KQogICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICAgICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAg\nICAgICAgICBpZiAoaGFzUHJvdG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICAg\nICAgICAgIG91dHB1dC53cml0ZUVudW0oMSwgZ2V0UHJvdG9jb2xWZXJzaW9u\nKCkuZ2V0TnVtYmVyKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nIChoYXNUeXBlKCkpIHsKICAgICAgICAgICAgICAgIG91dHB1dC53cml0ZUVu\ndW0oMiwgZ2V0VHlwZSgpLmdldE51bWJlcigpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBmb3IgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBlbGVtZW50IDogZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpKSB7CiAgICAgICAg\nICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygzLCBlbGVtZW50KTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoaGFzVHhuSWQoKSkgewogICAgICAg\nICAgICAgICAgb3V0cHV0LndyaXRlVUludDY0KDQsIGdldFR4bklkKCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoYXNTaG91bGRDbGFpbSgp\nKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3JpdGVCb29sKDUsIGdldFNo\nb3VsZENsYWltKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICho\nYXNUb3BpYygpKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3JpdGVCeXRl\ncyg2LCBnZXRUb3BpYygpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoaGFzUHVibGlzaFJlcXVlc3QoKSkgewogICAgICAgICAgICAgICAgb3V0\ncHV0LndyaXRlTWVzc2FnZSg1MiwgZ2V0UHVibGlzaFJlcXVlc3QoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1N1YnNjcmliZVJlcXVl\nc3QoKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSg1\nMywgZ2V0U3Vic2NyaWJlUmVxdWVzdCgpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoaGFzQ29uc3VtZVJlcXVlc3QoKSkgewogICAgICAgICAg\nICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSg1NCwgZ2V0Q29uc3VtZVJlcXVl\nc3QoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1Vuc3Vi\nc2NyaWJlUmVxdWVzdCgpKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3Jp\ndGVNZXNzYWdlKDU1LCBnZXRVbnN1YnNjcmliZVJlcXVlc3QoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1N0b3BEZWxpdmVyeVJlcXVl\nc3QoKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSg1\nNiwgZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdCgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZiAoaGFzU3RhcnREZWxpdmVyeVJlcXVlc3QoKSkgewog\nICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSg1NywgZ2V0U3Rh\ncnREZWxpdmVyeVJlcXVlc3QoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgICAg\nICB9CgogICAgICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNp\nemUgPSAtMTsKICAgICAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXpl\nKCkgewogICAgICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXpl\nZFNpemU7CiAgICAgICAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6\nZTsKCiAgICAgICAgICAgIHNpemUgPSAwOwogICAgICAgICAgICBpZiAoaGFz\nUHJvdG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICAgICAgICAgIHNpemUgKz0g\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAg\nICAgICAgICAgICAgICAgICAuY29tcHV0ZUVudW1TaXplKDEsIGdldFByb3Rv\nY29sVmVyc2lvbigpLmdldE51bWJlcigpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAoaGFzVHlwZSgpKSB7CiAgICAgICAgICAgICAgICBzaXpl\nICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAg\nICAgICAgICAgICAgICAgICAgICAgLmNvbXB1dGVFbnVtU2l6ZSgyLCBnZXRU\neXBlKCkuZ2V0TnVtYmVyKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHsKICAgICAgICAgICAgICAgIGludCBkYXRhU2l6ZSA9IDA7CiAgICAgICAg\nICAgICAgICBmb3IgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBl\nbGVtZW50IDogZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgZGF0YVNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZE91dHB1dFN0cmVhbQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC5jb21wdXRlQnl0ZXNTaXplTm9UYWcoZWxlbWVudCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBzaXplICs9IGRhdGFTaXplOwogICAg\nICAgICAgICAgICAgc2l6ZSArPSAxICogZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgp\nLnNpemUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGFzVHhu\nSWQoKSkgewogICAgICAgICAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAgICAgICAgICAg\nICAgIC5jb21wdXRlVUludDY0U2l6ZSg0LCBnZXRUeG5JZCgpKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoaGFzU2hvdWxkQ2xhaW0oKSkgewog\nICAgICAgICAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAgICAgICAgICAgICAgIC5jb21w\ndXRlQm9vbFNpemUoNSwgZ2V0U2hvdWxkQ2xhaW0oKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKGhhc1RvcGljKCkpIHsKICAgICAgICAgICAg\nICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0\ncmVhbQogICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6\nZSg2LCBnZXRUb3BpYygpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoaGFzUHVibGlzaFJlcXVlc3QoKSkgewogICAgICAgICAgICAgICAgc2l6\nZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAg\nICAgICAgICAgICAgICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUoNTIs\nIGdldFB1Ymxpc2hSZXF1ZXN0KCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChoYXNTdWJzY3JpYmVSZXF1ZXN0KCkpIHsKICAgICAgICAgICAg\nICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0\ncmVhbQogICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VT\naXplKDUzLCBnZXRTdWJzY3JpYmVSZXF1ZXN0KCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmIChoYXNDb25zdW1lUmVxdWVzdCgpKSB7CiAgICAg\nICAgICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRP\ndXRwdXRTdHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAgLmNvbXB1dGVN\nZXNzYWdlU2l6ZSg1NCwgZ2V0Q29uc3VtZVJlcXVlc3QoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKGhhc1Vuc3Vic2NyaWJlUmVxdWVzdCgp\nKSB7CiAgICAgICAgICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAg\nLmNvbXB1dGVNZXNzYWdlU2l6ZSg1NSwgZ2V0VW5zdWJzY3JpYmVSZXF1ZXN0\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChoYXNTdG9wRGVs\naXZlcnlSZXF1ZXN0KCkpIHsKICAgICAgICAgICAgICAgIHNpemUgKz0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAg\nICAgICAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXplKDU2LCBnZXRTdG9w\nRGVsaXZlcnlSZXF1ZXN0KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChoYXNTdGFydERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAgICAgICAg\nICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAgLmNvbXB1dGVNZXNzYWdl\nU2l6ZSg1NywgZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3QoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCku\nZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgICAgICAgbWVtb2l6ZWRTZXJp\nYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgICAgICAgIHJldHVybiBzaXplOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBh\ncnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRh\nKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1YlN1YlJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRh\nLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAgIC5idWls\nZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1\nYlJlcXVlc3QgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgICAgICAg\nICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9\nCiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBhcnNlRnJvbSgK\nICAgICAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1\nZXN0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAg\nICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCku\nYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJTdWJSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgamF2YS5pby5J\nbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlu\ncHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAgIC5i\ndWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1\nYlN1YlJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\nd0J1aWxkZXIoKTsKICAgICAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxp\nbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1\naWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdCBwYXJzZURl\nbGltaXRlZEZyb20oCiAgICAgICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0g\naW5wdXQsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAg\nICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgICAgICAg\nIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5z\naW9uUmVnaXN0cnkpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRl\nci5idWlsZFBhcnNlZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBhcnNlRnJvbSgK\nICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3Ry\nZWFtIGlucHV0KQogICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9F\neGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAg\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlu\ncHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3\nQnVpbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIEJ1aWxkZXIuY3JlYXRl\nKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxk\nZXJGb3JUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3\nQnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJTdWJSZXF1ZXN0IHByb3RvdHlwZSkgewogICAgICAgICAgICBy\nZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7CiAg\nICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4\ndGVuZHMKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4gewogICAgICAgICAgICBwcml2\nYXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1YlN1YlJlcXVlc3QgcmVzdWx0OwoKICAgICAgICAgICAgLy8gQ29uc3Ry\ndWN0IHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlB1YlN1YlJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAgICAgICAg\nIHByaXZhdGUgQnVpbGRlcigpIHt9CgogICAgICAgICAgICBwcml2YXRlIHN0\nYXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICAgICAgICAgIEJ1aWxk\nZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICBi\ndWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0KCk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gYnVpbGRlcjsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHJvdGVjdGVkIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1YlN1YlJlcXVlc3QgaW50ZXJuYWxHZXRSZXN1bHQoKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAg\nICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAg\nICAgICAgICAgICAgICAgICAgICJDYW5ub3QgY2FsbCBjbGVhcigpIGFmdGVy\nIGJ1aWxkKCkuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdCgpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNy\nZWF0ZSgpLm1lcmdlRnJvbShyZXN1bHQpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBl\nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QuZ2V0RGVz\nY3JpcHRvcigpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVi\nU3ViUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHViU3ViUmVxdWVzdCBidWlsZCgpIHsKICAgICAgICAgICAg\nICAgIGlmIChyZXN1bHQgIT0gbnVsbCAmJiAhaXNJbml0aWFsaXplZCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1l\nc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IGJ1aWxkUGFy\nc2VkKCkKICAgICAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgaWYgKCFpc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdCBidWls\nZFBhcnRpYWwoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0\nYXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiYnVpbGQo\nKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0\nLnRyaWVkU2VydmVyc18gIT0gamF2YS51dGlsLkNvbGxlY3Rpb25zLkVNUFRZ\nX0xJU1QpIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQudHJpZWRTZXJ2\nZXJzXyA9CiAgICAgICAgICAgICAgICAgICAgICAgIGphdmEudXRpbC5Db2xs\nZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJlc3VsdC50cmllZFNlcnZlcnNf\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVl\nc3QgcmV0dXJuTWUgPSByZXN1bHQ7CiAgICAgICAgICAgICAgICByZXN1bHQg\nPSBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybk1lOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZy\nb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAg\nICAgICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0KSB7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVx\ndWVzdClvdGhlcik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdl\nRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJTdWJSZXF1ZXN0IG90aGVyKSB7CiAgICAgICAgICAgICAgICBpZiAo\nb3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUHViU3ViUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0\ndXJuIHRoaXM7CiAgICAgICAgICAgICAgICBpZiAob3RoZXIuaGFzUHJvdG9j\nb2xWZXJzaW9uKCkpIHsKICAgICAgICAgICAgICAgICAgICBzZXRQcm90b2Nv\nbFZlcnNpb24ob3RoZXIuZ2V0UHJvdG9jb2xWZXJzaW9uKCkpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG90aGVyLmhhc1R5cGUo\nKSkgewogICAgICAgICAgICAgICAgICAgIHNldFR5cGUob3RoZXIuZ2V0VHlw\nZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICgh\nb3RoZXIudHJpZWRTZXJ2ZXJzXy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAocmVzdWx0LnRyaWVkU2VydmVyc18uaXNFbXB0eSgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC50cmllZFNlcnZlcnNf\nID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8Y29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nPigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICByZXN1bHQudHJpZWRTZXJ2ZXJzXy5hZGRBbGwob3Ro\nZXIudHJpZWRTZXJ2ZXJzXyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBpZiAob3RoZXIuaGFzVHhuSWQoKSkgewogICAgICAgICAgICAg\nICAgICAgIHNldFR4bklkKG90aGVyLmdldFR4bklkKCkpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG90aGVyLmhhc1Nob3VsZENs\nYWltKCkpIHsKICAgICAgICAgICAgICAgICAgICBzZXRTaG91bGRDbGFpbShv\ndGhlci5nZXRTaG91bGRDbGFpbSgpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGlmIChvdGhlci5oYXNUb3BpYygpKSB7CiAgICAgICAg\nICAgICAgICAgICAgc2V0VG9waWMob3RoZXIuZ2V0VG9waWMoKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3RoZXIuaGFzUHVi\nbGlzaFJlcXVlc3QoKSkgewogICAgICAgICAgICAgICAgICAgIG1lcmdlUHVi\nbGlzaFJlcXVlc3Qob3RoZXIuZ2V0UHVibGlzaFJlcXVlc3QoKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3RoZXIuaGFzU3Vi\nc2NyaWJlUmVxdWVzdCgpKSB7CiAgICAgICAgICAgICAgICAgICAgbWVyZ2VT\ndWJzY3JpYmVSZXF1ZXN0KG90aGVyLmdldFN1YnNjcmliZVJlcXVlc3QoKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3RoZXIu\naGFzQ29uc3VtZVJlcXVlc3QoKSkgewogICAgICAgICAgICAgICAgICAgIG1l\ncmdlQ29uc3VtZVJlcXVlc3Qob3RoZXIuZ2V0Q29uc3VtZVJlcXVlc3QoKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAob3RoZXIu\naGFzVW5zdWJzY3JpYmVSZXF1ZXN0KCkpIHsKICAgICAgICAgICAgICAgICAg\nICBtZXJnZVVuc3Vic2NyaWJlUmVxdWVzdChvdGhlci5nZXRVbnN1YnNjcmli\nZVJlcXVlc3QoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBpZiAob3RoZXIuaGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgbWVyZ2VTdG9wRGVsaXZlcnlSZXF1ZXN0KG90aGVy\nLmdldFN0b3BEZWxpdmVyeVJlcXVlc3QoKSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBpZiAob3RoZXIuaGFzU3RhcnREZWxpdmVyeVJl\ncXVlc3QoKSkgewogICAgICAgICAgICAgICAgICAgIG1lcmdlU3RhcnREZWxp\ndmVyeVJlcXVlc3Qob3RoZXIuZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3QoKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm1lcmdl\nVW5rbm93bkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1\ndCwKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0\nLkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRl\ncigKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmll\nbGRzKCkpOwogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAg\nICAgICAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAg\nICAgICAgICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAg\nICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNl\ndFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAg\nICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4\ndGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5i\ndWlsZCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBjYXNlIDg6IHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaW50IHJhd1ZhbHVlID0gaW5wdXQucmVhZEVudW0oKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uIHZhbHVlID0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJz\naW9uLnZhbHVlT2YocmF3VmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdW5rbm93bkZpZWxkcy5tZXJnZVZhcmludEZpZWxkKDEsIHJhd1Zh\nbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHNldFByb3RvY29sVmVyc2lvbih2YWx1\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIGNhc2UgMTY6IHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaW50IHJhd1ZhbHVlID0gaW5wdXQucmVhZEVudW0oKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZSB2YWx1ZSA9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk9wZXJhdGlvblR5cGUu\ndmFsdWVPZihyYXdWYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB1bmtub3duRmllbGRzLm1lcmdlVmFyaW50RmllbGQoMiwgcmF3VmFsdWUp\nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0VHlwZSh2YWx1ZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNh\nc2UgMjY6IHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkVHJpZWRTZXJ2\nZXJzKGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGNhc2UgMzI6IHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0\nVHhuSWQoaW5wdXQucmVhZFVJbnQ2NCgpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIGNhc2UgNDA6IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0U2hvdWxkQ2xhaW0oaW5wdXQucmVhZEJvb2woKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBjYXNlIDUwOiB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHNldFRvcGljKGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGNhc2UgNDE4OiB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlB1Ymxpc2hSZXF1ZXN0LkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxp\nc2hSZXF1ZXN0Lm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGhhc1B1Ymxpc2hSZXF1ZXN0KCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdldFB1Ymxpc2hS\nZXF1ZXN0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIs\nIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0UHVibGlzaFJlcXVlc3Qoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlIDQyNjogewogICAg\nICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkJ1aWxkZXIgc3Vi\nQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlcXVlc3QubmV3QnVpbGRlcigpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoaGFzU3Vic2NyaWJlUmVxdWVzdCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdl\nRnJvbShnZXRTdWJzY3JpYmVSZXF1ZXN0KCkpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnJlYWRN\nZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0U3Vic2NyaWJlUmVxdWVzdChzdWJCdWls\nZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGNhc2UgNDM0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVS\nZXF1ZXN0LkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0Lm5ld0J1\naWxkZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc0NvbnN1\nbWVSZXF1ZXN0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1\nYkJ1aWxkZXIubWVyZ2VGcm9tKGdldENvbnN1bWVSZXF1ZXN0KCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVuc2lvblJlZ2lz\ndHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0Q29uc3VtZVJlcXVl\nc3Qoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBjYXNlIDQ0MjogewogICAgICAgICAgICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5VbnN1YnNjcmliZVJlcXVlc3QuQnVpbGRlciBzdWJCdWlsZGVyID0gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJz\nY3JpYmVSZXF1ZXN0Lm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGhhc1Vuc3Vic2NyaWJlUmVxdWVzdCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRV\nbnN1YnNjcmliZVJlcXVlc3QoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uo\nc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAgICAgICAgICAg\nICAgICAgICAgICBzZXRVbnN1YnNjcmliZVJlcXVlc3Qoc3ViQnVpbGRlci5i\ndWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBj\nYXNlIDQ1MDogewogICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlS\nZXF1ZXN0LkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3Qu\nbmV3QnVpbGRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFz\nU3RvcERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRTdG9wRGVsaXZlcnlS\nZXF1ZXN0KCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIs\nIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2V0U3RvcERlbGl2ZXJ5UmVxdWVzdChzdWJCdWlsZGVyLmJ1aWxkUGFydGlh\nbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgNDU4OiB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LkJ1\naWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0Lm5ld0J1aWxk\nZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhc1N0YXJ0RGVs\naXZlcnlSZXF1ZXN0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVu\nc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0U3Rh\ncnREZWxpdmVyeVJlcXVlc3Qoc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyByZXF1aXJlZCAu\nSGVkd2lnLlByb3RvY29sVmVyc2lvbiBwcm90b2NvbFZlcnNpb24gPSAxOwog\nICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNQcm90b2NvbFZlcnNpb24o\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1Byb3RvY29s\nVmVyc2lvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90\nb2NvbFZlcnNpb24gZ2V0UHJvdG9jb2xWZXJzaW9uKCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIHJlc3VsdC5nZXRQcm90b2NvbFZlcnNpb24oKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRQcm90\nb2NvbFZlcnNpb24ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uIHZhbHVlKSB7CiAgICAgICAgICAg\nICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1Byb3RvY29sVmVy\nc2lvbiA9IHRydWU7CiAgICAgICAgICAgICAgICByZXN1bHQucHJvdG9jb2xW\nZXJzaW9uXyA9IHZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xl\nYXJQcm90b2NvbFZlcnNpb24oKSB7CiAgICAgICAgICAgICAgICByZXN1bHQu\naGFzUHJvdG9jb2xWZXJzaW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICBy\nZXN1bHQucHJvdG9jb2xWZXJzaW9uXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbi5WRVJTSU9O\nX09ORTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyByZXF1aXJlZCAuSGVkd2lnLk9wZXJhdGlv\nblR5cGUgdHlwZSA9IDI7CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc1R5cGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1R5\ncGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9u\nVHlwZSBnZXRUeXBlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3Vs\ndC5nZXRUeXBlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGlj\nIEJ1aWxkZXIgc2V0VHlwZShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5PcGVyYXRpb25UeXBlIHZhbHVlKSB7CiAgICAgICAg\nICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1R5cGUgPSB0\ncnVlOwogICAgICAgICAgICAgICAgcmVzdWx0LnR5cGVfID0gdmFsdWU7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclR5cGUoKSB7CiAgICAgICAg\nICAgICAgICByZXN1bHQuaGFzVHlwZSA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgcmVzdWx0LnR5cGVfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZS5QVUJMSVNIOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIHJlcGVhdGVkIGJ5dGVzIHRyaWVkU2VydmVycyA9IDM7CiAgICAg\nICAgICAgIHB1YmxpYyBqYXZhLnV0aWwuTGlzdDxjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmc+IGdldFRyaWVkU2VydmVyc0xpc3QoKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gamF2YS51dGlsLkNvbGxlY3Rpb25zLnVubW9k\naWZpYWJsZUxpc3QocmVzdWx0LnRyaWVkU2VydmVyc18pOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0VHJpZWRTZXJ2ZXJzQ291\nbnQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldFRyaWVk\nU2VydmVyc0NvdW50KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVi\nbGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRUcmllZFNl\ncnZlcnMoaW50IGluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVz\ndWx0LmdldFRyaWVkU2VydmVycyhpbmRleCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0VHJpZWRTZXJ2ZXJzKGludCBp\nbmRleCwgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7\nCiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0LnRy\naWVkU2VydmVyc18uc2V0KGluZGV4LCB2YWx1ZSk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJs\naWMgQnVpbGRlciBhZGRUcmllZFNlcnZlcnMoY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFs\ndWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBO\ndWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgaWYgKHJlc3VsdC50cmllZFNlcnZlcnNfLmlzRW1wdHko\nKSkgewogICAgICAgICAgICAgICAgICAgIHJlc3VsdC50cmllZFNlcnZlcnNf\nID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8Y29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nPigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgcmVzdWx0LnRyaWVkU2VydmVyc18uYWRkKHZhbHVlKTsKICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHB1YmxpYyBCdWlsZGVyIGFkZEFsbFRyaWVkU2VydmVycygKICAgICAg\nICAgICAgICAgIGphdmEubGFuZy5JdGVyYWJsZTw/IGV4dGVuZHMgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nPiB2YWx1ZXMpIHsKICAgICAgICAg\nICAgICAgIGlmIChyZXN1bHQudHJpZWRTZXJ2ZXJzXy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICAgICAgICByZXN1bHQudHJpZWRTZXJ2ZXJzXyA9IG5l\ndyBqYXZhLnV0aWwuQXJyYXlMaXN0PGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZz4oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHN1cGVyLmFkZEFsbCh2YWx1ZXMsIHJlc3VsdC50cmllZFNlcnZlcnNfKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVHJpZWRTZXJ2ZXJzKCkg\newogICAgICAgICAgICAgICAgcmVzdWx0LnRyaWVkU2VydmVyc18gPSBqYXZh\nLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0KCk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8g\ncmVxdWlyZWQgdWludDY0IHR4bklkID0gNDsKICAgICAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzVHhuSWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmVzdWx0Lmhhc1R4bklkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncHVibGljIGxvbmcgZ2V0VHhuSWQoKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gcmVzdWx0LmdldFR4bklkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcHVibGljIEJ1aWxkZXIgc2V0VHhuSWQobG9uZyB2YWx1ZSkgewogICAg\nICAgICAgICAgICAgcmVzdWx0Lmhhc1R4bklkID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIHJlc3VsdC50eG5JZF8gPSB2YWx1ZTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyVHhuSWQoKSB7CiAgICAgICAgICAgICAgICByZXN1\nbHQuaGFzVHhuSWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJlc3VsdC50\neG5JZF8gPSAwTDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBvcHRpb25hbCBib29sIHNob3Vs\nZENsYWltID0gNTsKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzU2hv\ndWxkQ2xhaW0oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhh\nc1Nob3VsZENsYWltKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVi\nbGljIGJvb2xlYW4gZ2V0U2hvdWxkQ2xhaW0oKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gcmVzdWx0LmdldFNob3VsZENsYWltKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U2hvdWxkQ2xhaW0o\nYm9vbGVhbiB2YWx1ZSkgewogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1No\nb3VsZENsYWltID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5zaG91\nbGRDbGFpbV8gPSB2YWx1ZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nZWFyU2hvdWxkQ2xhaW0oKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuaGFz\nU2hvdWxkQ2xhaW0gPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5z\naG91bGRDbGFpbV8gPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByZXF1aXJlZCBi\neXRlcyB0b3BpYyA9IDY7CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc1RvcGljKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNU\nb3BpYygpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0VG9waWMoKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldFRvcGljKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0VG9waWMoY29t\nLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAg\nICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1RvcGljID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC50b3BpY18gPSB2YWx1ZTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVG9waWMoKSB7CiAgICAg\nICAgICAgICAgICByZXN1bHQuaGFzVG9waWMgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgIHJlc3VsdC50b3BpY18gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5n\nZXRUb3BpYygpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuUHVi\nbGlzaFJlcXVlc3QgcHVibGlzaFJlcXVlc3QgPSA1MjsKICAgICAgICAgICAg\ncHVibGljIGJvb2xlYW4gaGFzUHVibGlzaFJlcXVlc3QoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1B1Ymxpc2hSZXF1ZXN0KCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IGdl\ndFB1Ymxpc2hSZXF1ZXN0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJl\nc3VsdC5nZXRQdWJsaXNoUmVxdWVzdCgpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFB1Ymxpc2hSZXF1ZXN0KG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0IHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9p\nbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgcmVzdWx0Lmhhc1B1Ymxpc2hSZXF1ZXN0ID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgIHJlc3VsdC5wdWJsaXNoUmVxdWVzdF8gPSB2YWx1ZTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFB1Ymxpc2hSZXF1ZXN0KG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0LkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgICAg\nICAgICByZXN1bHQuaGFzUHVibGlzaFJlcXVlc3QgPSB0cnVlOwogICAgICAg\nICAgICAgICAgcmVzdWx0LnB1Ymxpc2hSZXF1ZXN0XyA9IGJ1aWxkZXJGb3JW\nYWx1ZS5idWlsZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VQ\ndWJsaXNoUmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCB2YWx1ZSkgewogICAgICAgICAg\nICAgICAgaWYgKHJlc3VsdC5oYXNQdWJsaXNoUmVxdWVzdCgpICYmCiAgICAg\nICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdWJsaXNoUmVxdWVzdF8gIT0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVi\nbGlzaFJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAgICAgICAg\nICAgICAgICAgICByZXN1bHQucHVibGlzaFJlcXVlc3RfID0KICAgICAgICAg\nICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QubmV3QnVpbGRlcihyZXN1bHQu\ncHVibGlzaFJlcXVlc3RfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlh\nbCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICByZXN1bHQucHVibGlzaFJlcXVlc3RfID0gdmFsdWU7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzUHVibGlzaFJl\ncXVlc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJQ\ndWJsaXNoUmVxdWVzdCgpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNQ\ndWJsaXNoUmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmVzdWx0\nLnB1Ymxpc2hSZXF1ZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0LmdldERlZmF1bHRJbnN0\nYW5jZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2Ny\naWJlUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0ID0gNTM7CiAgICAgICAgICAg\nIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZVJlcXVlc3QoKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1N1YnNjcmliZVJlcXVlc3Qo\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVx\ndWVzdCBnZXRTdWJzY3JpYmVSZXF1ZXN0KCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIHJlc3VsdC5nZXRTdWJzY3JpYmVSZXF1ZXN0KCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3Vic2NyaWJl\nUmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpYmVSZXF1ZXN0IHZhbHVlKSB7CiAgICAgICAgICAgICAg\nICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1N1YnNjcmliZVJlcXVl\nc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzdWx0LnN1YnNjcmliZVJl\ncXVlc3RfID0gdmFsdWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRT\ndWJzY3JpYmVSZXF1ZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQnVpbGRlciBidWlsZGVy\nRm9yVmFsdWUpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNTdWJzY3Jp\nYmVSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5zdWJz\nY3JpYmVSZXF1ZXN0XyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VTdWJzY3JpYmVSZXF1ZXN0KG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmliZVJlcXVlc3QgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1\nbHQuaGFzU3Vic2NyaWJlUmVxdWVzdCgpICYmCiAgICAgICAgICAgICAgICAg\nICAgICAgIHJlc3VsdC5zdWJzY3JpYmVSZXF1ZXN0XyAhPSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1\nZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgcmVzdWx0LnN1YnNjcmliZVJlcXVlc3RfID0KICAgICAgICAgICAgICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5uZXdCdWlsZGVyKHJlc3VsdC5zdWJz\nY3JpYmVSZXF1ZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwo\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgcmVzdWx0LnN1YnNjcmliZVJlcXVlc3RfID0gdmFsdWU7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzU3Vic2NyaWJl\nUmVxdWVzdCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVh\nclN1YnNjcmliZVJlcXVlc3QoKSB7CiAgICAgICAgICAgICAgICByZXN1bHQu\naGFzU3Vic2NyaWJlUmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAg\ncmVzdWx0LnN1YnNjcmliZVJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXRE\nZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBvcHRpb25hbCAuSGVk\nd2lnLkNvbnN1bWVSZXF1ZXN0IGNvbnN1bWVSZXF1ZXN0ID0gNTQ7CiAgICAg\nICAgICAgIHB1YmxpYyBib29sZWFuIGhhc0NvbnN1bWVSZXF1ZXN0KCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNDb25zdW1lUmVxdWVz\ndCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVx\ndWVzdCBnZXRDb25zdW1lUmVxdWVzdCgpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiByZXN1bHQuZ2V0Q29uc3VtZVJlcXVlc3QoKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRDb25zdW1lUmVxdWVz\ndChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nb25zdW1lUmVxdWVzdCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHZh\nbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHJlc3VsdC5oYXNDb25zdW1lUmVxdWVzdCA9IHRydWU7\nCiAgICAgICAgICAgICAgICByZXN1bHQuY29uc3VtZVJlcXVlc3RfID0gdmFs\ndWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRDb25zdW1lUmVxdWVz\ndChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nb25zdW1lUmVxdWVzdC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAg\nICAgICAgICAgICAgcmVzdWx0Lmhhc0NvbnN1bWVSZXF1ZXN0ID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgIHJlc3VsdC5jb25zdW1lUmVxdWVzdF8gPSBidWls\nZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlQ29uc3VtZVJlcXVlc3Qob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgdmFsdWUpIHsKICAg\nICAgICAgICAgICAgIGlmIChyZXN1bHQuaGFzQ29uc3VtZVJlcXVlc3QoKSAm\nJgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuY29uc3VtZVJlcXVl\nc3RfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkNvbnN1bWVSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmVzdWx0LmNvbnN1bWVSZXF1ZXN0XyA9CiAg\nICAgICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0Lm5ld0J1aWxkZXIo\ncmVzdWx0LmNvbnN1bWVSZXF1ZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWls\nZFBhcnRpYWwoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgcmVzdWx0LmNvbnN1bWVSZXF1ZXN0XyA9IHZhbHVlOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc0Nv\nbnN1bWVSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiB0\naGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVy\nIGNsZWFyQ29uc3VtZVJlcXVlc3QoKSB7CiAgICAgICAgICAgICAgICByZXN1\nbHQuaGFzQ29uc3VtZVJlcXVlc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAg\nIHJlc3VsdC5jb25zdW1lUmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdC5nZXREZWZh\ndWx0SW5zdGFuY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBvcHRpb25hbCAuSGVkd2ln\nLlVuc3Vic2NyaWJlUmVxdWVzdCB1bnN1YnNjcmliZVJlcXVlc3QgPSA1NTsK\nICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzVW5zdWJzY3JpYmVSZXF1\nZXN0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNVbnN1\nYnNjcmliZVJlcXVlc3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IGdldFVuc3Vic2NyaWJlUmVxdWVzdCgp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuZ2V0VW5zdWJzY3Jp\nYmVSZXF1ZXN0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGlj\nIEJ1aWxkZXIgc2V0VW5zdWJzY3JpYmVSZXF1ZXN0KG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVz\ndCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJF\neGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHJlc3VsdC5oYXNVbnN1YnNjcmliZVJlcXVlc3QgPSB0cnVlOwogICAgICAg\nICAgICAgICAgcmVzdWx0LnVuc3Vic2NyaWJlUmVxdWVzdF8gPSB2YWx1ZTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFVuc3Vic2NyaWJlUmVxdWVz\ndChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5V\nbnN1YnNjcmliZVJlcXVlc3QuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsK\nICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNVbnN1YnNjcmliZVJlcXVlc3Qg\nPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzdWx0LnVuc3Vic2NyaWJlUmVx\ndWVzdF8gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlVW5zdWJzY3JpYmVSZXF1ZXN0KG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJl\nUmVxdWVzdCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5o\nYXNVbnN1YnNjcmliZVJlcXVlc3QoKSAmJgogICAgICAgICAgICAgICAgICAg\nICAgICByZXN1bHQudW5zdWJzY3JpYmVSZXF1ZXN0XyAhPSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJl\ncXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAgICAgICAgICAgICAg\nICAgICByZXN1bHQudW5zdWJzY3JpYmVSZXF1ZXN0XyA9CiAgICAgICAgICAg\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdC5uZXdCdWlsZGVyKHJlc3Vs\ndC51bnN1YnNjcmliZVJlcXVlc3RfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxk\nUGFydGlhbCgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICByZXN1bHQudW5zdWJzY3JpYmVSZXF1ZXN0XyA9IHZhbHVl\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhh\nc1Vuc3Vic2NyaWJlUmVxdWVzdCA9IHRydWU7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMg\nQnVpbGRlciBjbGVhclVuc3Vic2NyaWJlUmVxdWVzdCgpIHsKICAgICAgICAg\nICAgICAgIHJlc3VsdC5oYXNVbnN1YnNjcmliZVJlcXVlc3QgPSBmYWxzZTsK\nICAgICAgICAgICAgICAgIHJlc3VsdC51bnN1YnNjcmliZVJlcXVlc3RfID0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5z\ndWJzY3JpYmVSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3RvcERlbGl2ZXJ5UmVxdWVzdCBz\ndG9wRGVsaXZlcnlSZXF1ZXN0ID0gNTY7CiAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1N0b3BEZWxpdmVyeVJlcXVlc3QoKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gcmVzdWx0Lmhhc1N0b3BEZWxpdmVyeVJlcXVlc3QoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVx\ndWVzdCBnZXRTdG9wRGVsaXZlcnlSZXF1ZXN0KCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHJlc3VsdC5nZXRTdG9wRGVsaXZlcnlSZXF1ZXN0KCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3Rv\ncERlbGl2ZXJ5UmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHZhbHVlKSB7CiAg\nICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1N0\nb3BEZWxpdmVyeVJlcXVlc3QgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVz\ndWx0LnN0b3BEZWxpdmVyeVJlcXVlc3RfID0gdmFsdWU7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBw\ndWJsaWMgQnVpbGRlciBzZXRTdG9wRGVsaXZlcnlSZXF1ZXN0KG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVy\neVJlcXVlc3QuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICAg\nICAgICAgIHJlc3VsdC5oYXNTdG9wRGVsaXZlcnlSZXF1ZXN0ID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgIHJlc3VsdC5zdG9wRGVsaXZlcnlSZXF1ZXN0XyA9\nIGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VTdG9wRGVsaXZlcnlSZXF1ZXN0KG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVl\nc3QgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGFzU3Rv\ncERlbGl2ZXJ5UmVxdWVzdCgpICYmCiAgICAgICAgICAgICAgICAgICAgICAg\nIHJlc3VsdC5zdG9wRGVsaXZlcnlSZXF1ZXN0XyAhPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1\nZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgcmVzdWx0LnN0b3BEZWxpdmVyeVJlcXVlc3RfID0KICAgICAgICAgICAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdC5uZXdCdWlsZGVyKHJlc3Vs\ndC5zdG9wRGVsaXZlcnlSZXF1ZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWls\nZFBhcnRpYWwoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICAgICAgcmVzdWx0LnN0b3BEZWxpdmVyeVJlcXVlc3RfID0gdmFs\ndWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQu\naGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCA9IHRydWU7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhclN0b3BEZWxpdmVyeVJlcXVlc3QoKSB7CiAgICAg\nICAgICAgICAgICByZXN1bHQuaGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCA9IGZh\nbHNlOwogICAgICAgICAgICAgICAgcmVzdWx0LnN0b3BEZWxpdmVyeVJlcXVl\nc3RfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN0YXJ0RGVsaXZlcnlS\nZXF1ZXN0IHN0YXJ0RGVsaXZlcnlSZXF1ZXN0ID0gNTc7CiAgICAgICAgICAg\nIHB1YmxpYyBib29sZWFuIGhhc1N0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNTdGFydERlbGl2ZXJ5\nUmVxdWVzdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFy\ndERlbGl2ZXJ5UmVxdWVzdCBnZXRTdGFydERlbGl2ZXJ5UmVxdWVzdCgpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuZ2V0U3RhcnREZWxpdmVy\neVJlcXVlc3QoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRTdGFydERlbGl2ZXJ5UmVxdWVzdChvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVx\ndWVzdCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50\nZXJFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIHJlc3VsdC5oYXNTdGFydERlbGl2ZXJ5UmVxdWVzdCA9IHRydWU7CiAg\nICAgICAgICAgICAgICByZXN1bHQuc3RhcnREZWxpdmVyeVJlcXVlc3RfID0g\ndmFsdWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdGFydERlbGl2\nZXJ5UmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5CdWlsZGVyIGJ1aWxkZXJG\nb3JWYWx1ZSkgewogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1N0YXJ0RGVs\naXZlcnlSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5z\ndGFydERlbGl2ZXJ5UmVxdWVzdF8gPSBidWlsZGVyRm9yVmFsdWUuYnVpbGQo\nKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlU3RhcnREZWxpdmVy\neVJlcXVlc3Qob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgdmFsdWUpIHsKICAgICAgICAg\nICAgICAgIGlmIChyZXN1bHQuaGFzU3RhcnREZWxpdmVyeVJlcXVlc3QoKSAm\nJgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3RhcnREZWxpdmVy\neVJlcXVlc3RfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0\nYW5jZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnN0YXJ0RGVs\naXZlcnlSZXF1ZXN0XyA9CiAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0Lm5ld0J1aWxkZXIocmVzdWx0LnN0YXJ0RGVsaXZlcnlS\nZXF1ZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmVz\ndWx0LnN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyA9IHZhbHVlOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1N0YXJ0RGVsaXZl\ncnlSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nZWFyU3RhcnREZWxpdmVyeVJlcXVlc3QoKSB7CiAgICAgICAgICAgICAgICBy\nZXN1bHQuaGFzU3RhcnREZWxpdmVyeVJlcXVlc3QgPSBmYWxzZTsKICAgICAg\nICAgICAgICAgIHJlc3VsdC5zdGFydERlbGl2ZXJ5UmVxdWVzdF8gPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERl\nbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpI\nZWR3aWcuUHViU3ViUmVxdWVzdCkKICAgICAgICB9CgogICAgICAgIHN0YXRp\nYyB7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBQdWJTdWJS\nZXF1ZXN0KHRydWUpOwogICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbEZvcmNlSW5pdCgpOwog\nICAgICAgICAgICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNs\nYXNzX3Njb3BlOkhlZHdpZy5QdWJTdWJSZXF1ZXN0KQogICAgfQoKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgUHVibGlzaFJlcXVlc3QgZXh0ZW5k\ncwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZSB7CiAgICAgICAgLy8gVXNlIFB1Ymxpc2hSZXF1ZXN0Lm5ld0J1aWxkZXIo\nKSB0byBjb25zdHJ1Y3QuCiAgICAgICAgcHJpdmF0ZSBQdWJsaXNoUmVxdWVz\ndCgpIHsKICAgICAgICAgICAgaW5pdEZpZWxkcygpOwogICAgICAgIH0KICAg\nICAgICBwcml2YXRlIFB1Ymxpc2hSZXF1ZXN0KGJvb2xlYW4gbm9Jbml0KSB7\nfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBQdWJsaXNoUmVxdWVz\ndCBkZWZhdWx0SW5zdGFuY2U7CiAgICAgICAgcHVibGljIHN0YXRpYyBQdWJs\naXNoUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgICAgICAg\nIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgUHVibGlzaFJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlw\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2ds\nZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0\nRGVzY3JpcHRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRp\nY19IZWR3aWdfUHVibGlzaFJlcXVlc3RfZGVzY3JpcHRvcjsKICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJu\nYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0X2ZpZWxkQWNj\nZXNzb3JUYWJsZTsKICAgICAgICB9CgogICAgICAgIC8vIHJlcXVpcmVkIC5I\nZWR3aWcuTWVzc2FnZSBtc2cgPSAyOwogICAgICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IE1TR19GSUVMRF9OVU1CRVIgPSAyOwogICAgICAgIHByaXZh\ndGUgYm9vbGVhbiBoYXNNc2c7CiAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIG1zZ187\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzTXNnKCkgewogICAgICAgICAg\nICByZXR1cm4gaGFzTXNnOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZSBnZXRNc2coKSB7CiAgICAgICAgICAgIHJldHVybiBtc2dfOwogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAg\nICAgICAgIG1zZ18gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxp\nemVkKCkgewogICAgICAgICAgICBpZiAoIWhhc01zZykgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICBpZiAoIWdldE1zZygpLmlzSW5pdGlhbGl6ZWQoKSkg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgICAgICAgIGlmIChoYXNNc2co\nKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSgyLCBn\nZXRNc2coKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2V0VW5rbm93\nbkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgICAgICB9CgogICAgICAg\nIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAg\nICAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkgewogICAgICAg\nICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7CiAgICAg\nICAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKCiAgICAgICAg\nICAgIHNpemUgPSAwOwogICAgICAgICAgICBpZiAoaGFzTXNnKCkpIHsKICAg\nICAgICAgICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZE91dHB1dFN0cmVhbQogICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0\nZU1lc3NhZ2VTaXplKDIsIGdldE1zZygpKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJpYWxp\nemVkU2l6ZSgpOwogICAgICAgICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXpl\nID0gc2l6ZTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IHBhcnNlRnJvbSgK\nICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRh\ndGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBh\ncnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQo\nKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVz\ndCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJv\nd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJF\neGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAg\nICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCBw\nYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAg\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxk\nUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJl\nYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1\naWxkZXIoKTsKICAgICAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0\nZWRGcm9tKGlucHV0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxk\nZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgcGFyc2VEZWxp\nbWl0ZWRGcm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlu\ncHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICAgICAgICBp\nZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lv\nblJlZ2lzdHJ5KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIu\nYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgcGFyc2VGcm9tKAog\nICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJl\nYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAg\nICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlu\ncHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3\nQnVpbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIEJ1aWxkZXIuY3JlYXRl\nKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxk\nZXJGb3JUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3\nQnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJsaXNoUmVxdWVzdCBwcm90b3R5cGUpIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAg\nICAgICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgewog\nICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBl\neHRlbmRzCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgICAgICAgcHJp\ndmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJsaXNoUmVxdWVzdCByZXN1bHQ7CgogICAgICAgICAgICAvLyBDb25z\ndHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAgICAg\nICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CgogICAgICAgICAgICBwcml2YXRl\nIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICAgICAgICAgIEJ1\naWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7CiAgICAgICAgICAgICAg\nICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCBpbnRlcm5hbEdldFJlc3Vs\ndCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewog\nICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgICAgICAgICAgICAgIkNhbm5vdCBjYWxsIGNsZWFyKCkg\nYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShyZXN1bHQpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICAgIGdldERlc2NyaXB0b3JG\nb3JUeXBlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0\nLmdldERlc2NyaXB0b3IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlB1Ymxpc2hSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUo\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QuZ2V0RGVm\nYXVsdEluc3RhbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgYnVpbGQoKSB7CiAg\nICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlh\nbGl6ZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5p\ndGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVl\nc3QgYnVpbGRQYXJzZWQoKQogICAgICAgICAgICAgICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkg\newogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRN\nZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1\nbHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0\naWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNo\nUmVxdWVzdCBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgICAgICAgICBpZiAo\ncmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAg\nICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlz\nIEJ1aWxkZXIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJsaXNoUmVxdWVzdCByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAgICAgICAg\nICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0\ndXJuTWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3Ro\nZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxp\nc2hSZXF1ZXN0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lcmdl\nRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlcXVlc3Qpb3RoZXIpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3Ro\nZXIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3Qgb3RoZXIpIHsKICAgICAg\nICAgICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdC5nZXREZWZhdWx0\nSW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICBpZiAo\nb3RoZXIuaGFzTXNnKCkpIHsKICAgICAgICAgICAgICAgICAgICBtZXJnZU1z\nZyhvdGhlci5nZXRNc2coKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci5nZXRVbmtu\nb3duRmllbGRzKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdl\nRnJvbSgKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAg\nICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3du\nRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgICAgICAgICAgICAg\ndGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgICAgICAgd2hp\nbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnQgdGFnID0gaW5w\ndXQucmVhZFRhZygpOwogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAodGFn\nKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAg\nICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxk\ncy5idWlsZCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1\nbmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVs\nZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OiB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UuQnVpbGRlciBzdWJCdWlsZGVy\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZS5uZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChoYXNNc2coKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0TXNnKCkpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnJl\nYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgc2V0TXNnKHN1YkJ1aWxkZXIuYnVpbGRQ\nYXJ0aWFsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8g\ncmVxdWlyZWQgLkhlZHdpZy5NZXNzYWdlIG1zZyA9IDI7CiAgICAgICAgICAg\nIHB1YmxpYyBib29sZWFuIGhhc01zZygpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiByZXN1bHQuaGFzTXNnKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2UgZ2V0TXNnKCkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIHJlc3VsdC5nZXRNc2coKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBwdWJsaWMgQnVpbGRlciBzZXRNc2cob3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSB2YWx1ZSkgewogICAgICAg\nICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNNc2cgPSB0\ncnVlOwogICAgICAgICAgICAgICAgcmVzdWx0Lm1zZ18gPSB2YWx1ZTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1zZyhvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLkJ1aWxkZXIgYnVp\nbGRlckZvclZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzTXNn\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5tc2dfID0gYnVpbGRl\nckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBt\nZXJnZU1zZyhvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAocmVz\ndWx0Lmhhc01zZygpICYmCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3Vs\ndC5tc2dfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAgICAg\nICAgICAgICAgICAgICByZXN1bHQubXNnXyA9CiAgICAgICAgICAgICAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2UubmV3QnVpbGRlcihyZXN1bHQubXNnXykubWVyZ2VGcm9t\nKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm1zZ18gPSB2YWx1ZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNN\nc2cgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNc2co\nKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzTXNnID0gZmFsc2U7CiAg\nICAgICAgICAgICAgICByZXN1bHQubXNnXyA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UuZ2V0RGVmYXVsdElu\nc3RhbmNlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3Bv\naW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlB1Ymxpc2hSZXF1ZXN0KQogICAg\nICAgIH0KCiAgICAgICAgc3RhdGljIHsKICAgICAgICAgICAgZGVmYXVsdElu\nc3RhbmNlID0gbmV3IFB1Ymxpc2hSZXF1ZXN0KHRydWUpOwogICAgICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbEZvcmNlSW5pdCgpOwogICAgICAgICAgICBkZWZhdWx0SW5zdGFu\nY2UuaW5pdEZpZWxkcygpOwogICAgICAgIH0KCiAgICAgICAgLy8gQEBwcm90\nb2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5QdWJsaXNo\nUmVxdWVzdCkKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNz\nIFN1YnNjcmliZVJlcXVlc3QgZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAgICAgLy8gVXNlIFN1\nYnNjcmliZVJlcXVlc3QubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAg\nICAgICBwcml2YXRlIFN1YnNjcmliZVJlcXVlc3QoKSB7CiAgICAgICAgICAg\nIGluaXRGaWVsZHMoKTsKICAgICAgICB9CiAgICAgICAgcHJpdmF0ZSBTdWJz\nY3JpYmVSZXF1ZXN0KGJvb2xlYW4gbm9Jbml0KSB7fQoKICAgICAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBTdWJzY3JpYmVSZXF1ZXN0IGRlZmF1bHRJbnN0\nYW5jZTsKICAgICAgICBwdWJsaWMgc3RhdGljIFN1YnNjcmliZVJlcXVlc3Qg\nZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gZGVm\nYXVsdEluc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIFN1YnNj\ncmliZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRv\ncigpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdf\nU3Vic2NyaWJlUmVxdWVzdF9kZXNjcmlwdG9yOwogICAgICAgIH0KCiAgICAg\nICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZp\nZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFs\nX3N0YXRpY19IZWR3aWdfU3Vic2NyaWJlUmVxdWVzdF9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZW51bSBDcmVhdGVP\nckF0dGFjaAogICAgICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5wcm90b2J1\nZi5Qcm90b2NvbE1lc3NhZ2VFbnVtIHsKICAgICAgICAgICAgQ1JFQVRFKDAs\nIDApLAogICAgICAgICAgICBBVFRBQ0goMSwgMSksCiAgICAgICAgICAgIENS\nRUFURV9PUl9BVFRBQ0goMiwgMiksCiAgICAgICAgICAgIDsKCgogICAgICAg\nICAgICBwdWJsaWMgZmluYWwgaW50IGdldE51bWJlcigpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIHN0YXRpYyBDcmVhdGVPckF0dGFjaCB2YWx1ZU9mKGludCB2\nYWx1ZSkgewogICAgICAgICAgICAgICAgc3dpdGNoICh2YWx1ZSkgewogICAg\nICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBDUkVBVEU7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIEFUVEFDSDsKICAgICAgICAgICAgICAgIGNhc2Ug\nMjoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gQ1JFQVRFX09SX0FUVEFD\nSDsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxDcmVhdGVPckF0dGFjaD4KICAg\nICAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgpIHsKICAgICAgICAgICAg\nICAgIHJldHVybiBpbnRlcm5hbFZhbHVlTWFwOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYu\nSW50ZXJuYWwuRW51bUxpdGVNYXA8Q3JlYXRlT3JBdHRhY2g+CiAgICAgICAg\nICAgIGludGVybmFsVmFsdWVNYXAgPQogICAgICAgICAgICBuZXcgY29tLmdv\nb2dsZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxDcmVhdGVPckF0\ndGFjaD4oKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgQ3JlYXRlT3JBdHRh\nY2ggZmluZFZhbHVlQnlOdW1iZXIoaW50IG51bWJlcikgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBDcmVhdGVPckF0dGFjaC52YWx1ZU9mKG51bWJl\ncikKICAgICAgICAgICAgICAgICAgICAgICAgICAgOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcHVibGljIGZpbmFs\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bVZhbHVlRGVz\nY3JpcHRvcgogICAgICAgICAgICBnZXRWYWx1ZURlc2NyaXB0b3IoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpLmdldFZhbHVl\ncygpLmdldChpbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVi\nbGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51\nbURlc2NyaXB0b3IKICAgICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUo\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRv\ncgogICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuZ2V0RGVzY3JpcHRvcigpLmdldEVu\ndW1UeXBlcygpLmdldCgwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgQ3JlYXRlT3JBdHRhY2hbXSBWQUxVRVMg\nPSB7CiAgICAgICAgICAgICAgICBDUkVBVEUsIEFUVEFDSCwgQ1JFQVRFX09S\nX0FUVEFDSCwKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcHVibGljIHN0\nYXRpYyBDcmVhdGVPckF0dGFjaCB2YWx1ZU9mKAogICAgICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNj\ncmlwdG9yIGRlc2MpIHsKICAgICAgICAgICAgICAgIGlmIChkZXNjLmdldFR5\ncGUoKSAhPSBnZXREZXNjcmlwdG9yKCkpIHsKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbigKICAgICAgICAgICAgICAgICAgICAgICAgIkVudW1WYWx1ZURlc2NyaXB0\nb3IgaXMgbm90IGZvciB0aGlzIHR5cGUuIik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICByZXR1cm4gVkFMVUVTW2Rlc2MuZ2V0SW5kZXgo\nKV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHJpdmF0ZSBmaW5hbCBp\nbnQgaW5kZXg7CiAgICAgICAgICAgIHByaXZhdGUgZmluYWwgaW50IHZhbHVl\nOwogICAgICAgICAgICBwcml2YXRlIENyZWF0ZU9yQXR0YWNoKGludCBpbmRl\neCwgaW50IHZhbHVlKSB7CiAgICAgICAgICAgICAgICB0aGlzLmluZGV4ID0g\naW5kZXg7CiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHN0YXRpYyB7CiAgICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5nZXREZXNjcmlwdG9yKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChlbnVtX3Njb3BlOkhlZHdp\nZy5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoKQogICAgICAgIH0K\nCiAgICAgICAgLy8gcmVxdWlyZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0gMjsK\nICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVUJTQ1JJQkVSSURf\nRklFTERfTlVNQkVSID0gMjsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFz\nU3Vic2NyaWJlcklkOwogICAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIHN1YnNjcmliZXJJZF8gPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICAgICAgcHVibGljIGJvb2xl\nYW4gaGFzU3Vic2NyaWJlcklkKCkgewogICAgICAgICAgICByZXR1cm4gaGFz\nU3Vic2NyaWJlcklkOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1YnNjcmliZXJJZCgpIHsK\nICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmliZXJJZF87CiAgICAgICAgfQoK\nICAgICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmliZVJlcXVlc3Qu\nQ3JlYXRlT3JBdHRhY2ggY3JlYXRlT3JBdHRhY2ggPSAzIFtkZWZhdWx0ID0g\nQ1JFQVRFX09SX0FUVEFDSF07CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgQ1JFQVRFT1JBVFRBQ0hfRklFTERfTlVNQkVSID0gMzsKICAgICAg\nICBwcml2YXRlIGJvb2xlYW4gaGFzQ3JlYXRlT3JBdHRhY2g7CiAgICAgICAg\ncHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoIGNyZWF0ZU9y\nQXR0YWNoXzsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNDcmVhdGVPckF0\ndGFjaCgpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc0NyZWF0ZU9yQXR0YWNo\nOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVh\ndGVPckF0dGFjaCBnZXRDcmVhdGVPckF0dGFjaCgpIHsKICAgICAgICAgICAg\ncmV0dXJuIGNyZWF0ZU9yQXR0YWNoXzsKICAgICAgICB9CgogICAgICAgIC8v\nIG9wdGlvbmFsIGJvb2wgc3luY2hyb25vdXMgPSA0IFtkZWZhdWx0ID0gZmFs\nc2VdOwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNZTkNIUk9O\nT1VTX0ZJRUxEX05VTUJFUiA9IDQ7CiAgICAgICAgcHJpdmF0ZSBib29sZWFu\nIGhhc1N5bmNocm9ub3VzOwogICAgICAgIHByaXZhdGUgYm9vbGVhbiBzeW5j\naHJvbm91c18gPSBmYWxzZTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNT\neW5jaHJvbm91cygpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc1N5bmNocm9u\nb3VzOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgYm9vbGVhbiBnZXRTeW5j\naHJvbm91cygpIHsKICAgICAgICAgICAgcmV0dXJuIHN5bmNocm9ub3VzXzsK\nICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkg\newogICAgICAgICAgICBjcmVhdGVPckF0dGFjaF8gPSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nLkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0g7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7\nCiAgICAgICAgICAgIGlmICghaGFzU3Vic2NyaWJlcklkKSByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAgICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgZ2V0U2VyaWFs\naXplZFNpemUoKTsKICAgICAgICAgICAgaWYgKGhhc1N1YnNjcmliZXJJZCgp\nKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBnZXRT\ndWJzY3JpYmVySWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGhhc0NyZWF0ZU9yQXR0YWNoKCkpIHsKICAgICAgICAgICAgICAgIG91dHB1\ndC53cml0ZUVudW0oMywgZ2V0Q3JlYXRlT3JBdHRhY2goKS5nZXROdW1iZXIo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1N5bmNocm9u\nb3VzKCkpIHsKICAgICAgICAgICAgICAgIG91dHB1dC53cml0ZUJvb2woNCwg\nZ2V0U3luY2hyb25vdXMoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgICAgICB9\nCgogICAgICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUg\nPSAtMTsKICAgICAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXplKCkg\newogICAgICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNp\nemU7CiAgICAgICAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsK\nCiAgICAgICAgICAgIHNpemUgPSAwOwogICAgICAgICAgICBpZiAoaGFzU3Vi\nc2NyaWJlcklkKCkpIHsKICAgICAgICAgICAgICAgIHNpemUgKz0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgICAg\nICAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgyLCBnZXRTdWJzY3JpYmVy\nSWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc0NyZWF0\nZU9yQXR0YWNoKCkpIHsKICAgICAgICAgICAgICAgIHNpemUgKz0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgICAg\nICAgICAgICAgICAuY29tcHV0ZUVudW1TaXplKDMsIGdldENyZWF0ZU9yQXR0\nYWNoKCkuZ2V0TnVtYmVyKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChoYXNTeW5jaHJvbm91cygpKSB7CiAgICAgICAgICAgICAgICBzaXpl\nICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAg\nICAgICAgICAgICAgICAgICAgICAgLmNvbXB1dGVCb29sU2l6ZSg0LCBnZXRT\neW5jaHJvbm91cygpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaXpl\nICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwog\nICAgICAgICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAg\nICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAg\nICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAg\nICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBw\nYXJzZUZyb20oCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBkYXRhLAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBwYXJz\nZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29t\nLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRp\nb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAg\nICBieXRlW10gZGF0YSwKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZh\nbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFy\nc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBh\ncnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmli\nZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naWJlUmVxdWVzdCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1dFN0\ncmVhbSBpbnB1dCkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nQnVpbGRlcigpOwogICAgICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGlt\naXRlZEZyb20oaW5wdXQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYnVp\nbGRlci5idWlsZFBhcnNlZCgpOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IHBhcnNl\nRGVsaW1pdGVkRnJvbSgKICAgICAgICAgICAgamF2YS5pby5JbnB1dFN0cmVh\nbSBpbnB1dCwKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgICAg\nICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0LCBleHRl\nbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBidWls\nZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFyc2VG\ncm9tKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9t\nKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRT\ndHJlYW0gaW5wdXQsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgQnVp\nbGRlciBuZXdCdWlsZGVyKCkgewogICAgICAgICAgICByZXR1cm4gQnVpbGRl\nci5jcmVhdGUoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIg\nbmV3QnVpbGRlckZvclR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgQnVp\nbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcHJvdG90eXBlKSB7CiAg\nICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3Rv\ndHlwZSk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVp\nbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNz\nIEJ1aWxkZXIgZXh0ZW5kcwogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPiB7CiAgICAg\nICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdCByZXN1bHQ7CgogICAgICAg\nICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5uZXdCdWls\nZGVyKCkKICAgICAgICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkge30KCiAgICAg\nICAgICAgIHByaXZhdGUgc3RhdGljIEJ1aWxkZXIgY3JlYXRlKCkgewogICAg\nICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIoKTsK\nICAgICAgICAgICAgICAgIGJ1aWxkZXIucmVzdWx0ID0gbmV3IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJl\ncXVlc3QoKTsKICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndCBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiByZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyKCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgIkNh\nbm5vdCBjYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKHJl\nc3VsdCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAg\nICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXREZXNjcmlwdG9yKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IGdl\ndERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaXNJbml0\naWFsaXplZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuaXNJ\nbml0aWFsaXplZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0IGJ1aWxkKCkgewogICAgICAgICAgICAgICAgaWYg\nKHJlc3VsdCAhPSBudWxsICYmICFpc0luaXRpYWxpemVkKCkpIHsKICAgICAg\nICAgICAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4\nY2VwdGlvbihyZXN1bHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgYnVpbGRQYXJzZWQo\nKQogICAgICAgICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9u\nKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IGJ1aWxk\nUGFydGlhbCgpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICJidWlsZCgp\nIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkIG9uIHRoaXMgQnVpbGRlci4iKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVl\nc3QgcmV0dXJuTWUgPSByZXN1bHQ7CiAgICAgICAgICAgICAgICByZXN1bHQg\nPSBudWxsOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybk1lOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZy\nb20oY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAg\nICAgICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naWJlUmVxdWVzdClvdGhlcik7CiAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IG90aGVyKSB7CiAgICAgICAgICAg\nICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5z\ndGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICBpZiAob3Ro\nZXIuaGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICAgICAgICAgICAgICBz\nZXRTdWJzY3JpYmVySWQob3RoZXIuZ2V0U3Vic2NyaWJlcklkKCkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG90aGVyLmhhc0Ny\nZWF0ZU9yQXR0YWNoKCkpIHsKICAgICAgICAgICAgICAgICAgICBzZXRDcmVh\ndGVPckF0dGFjaChvdGhlci5nZXRDcmVhdGVPckF0dGFjaCgpKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvdGhlci5oYXNTeW5j\naHJvbm91cygpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0U3luY2hyb25v\ndXMob3RoZXIuZ2V0U3luY2hyb25vdXMoKSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhl\nci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbSgKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZp\nZWxkcyA9CiAgICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAg\nICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBpbnQg\ndGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgICAgICAgICAgIHN3\naXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgogICAg\nICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5r\nbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZpZWxk\nKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0\nYWcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVu\na25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNl\nIDE4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFN1YnNjcmliZXJJ\nZChpbnB1dC5yZWFkQnl0ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBjYXNlIDI0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCBy\nYXdWYWx1ZSA9IGlucHV0LnJlYWRFbnVtKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2ggdmFsdWUgPSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLnZhbHVlT2YocmF3VmFsdWUp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5rbm93bkZpZWxkcy5t\nZXJnZVZhcmludEZpZWxkKDMsIHJhd1ZhbHVlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHNldENyZWF0ZU9yQXR0YWNoKHZhbHVlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2FzZSAzMjog\newogICAgICAgICAgICAgICAgICAgICAgICBzZXRTeW5jaHJvbm91cyhpbnB1\ndC5yZWFkQm9vbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAg\nIC8vIHJlcXVpcmVkIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDI7CiAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZXJJZCgpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiByZXN1bHQuaGFzU3Vic2NyaWJlcklkKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBnZXRTdWJzY3JpYmVySWQoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gcmVzdWx0LmdldFN1YnNjcmliZXJJZCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1YnNj\ncmliZXJJZChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUp\nIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQu\naGFzU3Vic2NyaWJlcklkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3Vs\ndC5zdWJzY3JpYmVySWRfID0gdmFsdWU7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVp\nbGRlciBjbGVhclN1YnNjcmliZXJJZCgpIHsKICAgICAgICAgICAgICAgIHJl\nc3VsdC5oYXNTdWJzY3JpYmVySWQgPSBmYWxzZTsKICAgICAgICAgICAgICAg\nIHJlc3VsdC5zdWJzY3JpYmVySWRfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCku\nZ2V0U3Vic2NyaWJlcklkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gb3B0aW9uYWwgLkhl\nZHdpZy5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoIGNyZWF0ZU9y\nQXR0YWNoID0gMyBbZGVmYXVsdCA9IENSRUFURV9PUl9BVFRBQ0hdOwogICAg\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNDcmVhdGVPckF0dGFjaCgpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuaGFzQ3JlYXRlT3JBdHRh\nY2goKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVxdWVzdC5DcmVhdGVPckF0dGFjaCBnZXRDcmVhdGVPckF0dGFjaCgpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuZ2V0Q3JlYXRlT3JBdHRh\nY2goKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRDcmVhdGVPckF0dGFjaChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0\nYWNoIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRl\nckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgcmVzdWx0Lmhhc0NyZWF0ZU9yQXR0YWNoID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIHJlc3VsdC5jcmVhdGVPckF0dGFjaF8gPSB2YWx1ZTsKICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ3JlYXRlT3JBdHRhY2goKSB7CiAg\nICAgICAgICAgICAgICByZXN1bHQuaGFzQ3JlYXRlT3JBdHRhY2ggPSBmYWxz\nZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5jcmVhdGVPckF0dGFjaF8gPSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0g7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gb3B0aW9uYWwgYm9vbCBzeW5jaHJvbm91cyA9IDQg\nW2RlZmF1bHQgPSBmYWxzZV07CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc1N5bmNocm9ub3VzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJl\nc3VsdC5oYXNTeW5jaHJvbm91cygpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGdldFN5bmNocm9ub3VzKCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTeW5jaHJvbm91cygpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN5bmNo\ncm9ub3VzKGJvb2xlYW4gdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJlc3Vs\ndC5oYXNTeW5jaHJvbm91cyA9IHRydWU7CiAgICAgICAgICAgICAgICByZXN1\nbHQuc3luY2hyb25vdXNfID0gdmFsdWU7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVp\nbGRlciBjbGVhclN5bmNocm9ub3VzKCkgewogICAgICAgICAgICAgICAgcmVz\ndWx0Lmhhc1N5bmNocm9ub3VzID0gZmFsc2U7CiAgICAgICAgICAgICAgICBy\nZXN1bHQuc3luY2hyb25vdXNfID0gZmFsc2U7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQEBw\ncm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlN1\nYnNjcmliZVJlcXVlc3QpCiAgICAgICAgfQoKICAgICAgICBzdGF0aWMgewog\nICAgICAgICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgU3Vic2NyaWJlUmVx\ndWVzdCh0cnVlKTsKICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxGb3JjZUluaXQoKTsKICAg\nICAgICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgICAg\nICB9CgogICAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFz\nc19zY29wZTpIZWR3aWcuU3Vic2NyaWJlUmVxdWVzdCkKICAgIH0KCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIENvbnN1bWVSZXF1ZXN0IGV4dGVu\nZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UgewogICAgICAgIC8vIFVzZSBDb25zdW1lUmVxdWVzdC5uZXdCdWlsZGVy\nKCkgdG8gY29uc3RydWN0LgogICAgICAgIHByaXZhdGUgQ29uc3VtZVJlcXVl\nc3QoKSB7CiAgICAgICAgICAgIGluaXRGaWVsZHMoKTsKICAgICAgICB9CiAg\nICAgICAgcHJpdmF0ZSBDb25zdW1lUmVxdWVzdChib29sZWFuIG5vSW5pdCkg\ne30KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgQ29uc3VtZVJlcXVl\nc3QgZGVmYXVsdEluc3RhbmNlOwogICAgICAgIHB1YmxpYyBzdGF0aWMgQ29u\nc3VtZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAgICAgICAg\nICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIENvbnN1bWVSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5\ncGUoKSB7CiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29n\nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgIGdl\ndERlc2NyaXB0b3IoKSB7CiAgICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX0NvbnN1bWVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVy\nbmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgICAgICByZXR1\ncm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\naW50ZXJuYWxfc3RhdGljX0hlZHdpZ19Db25zdW1lUmVxdWVzdF9maWVsZEFj\nY2Vzc29yVGFibGU7CiAgICAgICAgfQoKICAgICAgICAvLyByZXF1aXJlZCBi\neXRlcyBzdWJzY3JpYmVySWQgPSAyOwogICAgICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IFNVQlNDUklCRVJJRF9GSUVMRF9OVU1CRVIgPSAyOwogICAg\nICAgIHByaXZhdGUgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQ7CiAgICAgICAg\ncHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Vic2Ny\naWJlcklkXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBU\nWTsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQoKSB7\nCiAgICAgICAgICAgIHJldHVybiBoYXNTdWJzY3JpYmVySWQ7CiAgICAgICAg\nfQogICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmcgZ2V0U3Vic2NyaWJlcklkKCkgewogICAgICAgICAgICByZXR1cm4gc3Vi\nc2NyaWJlcklkXzsKICAgICAgICB9CgogICAgICAgIC8vIHJlcXVpcmVkIC5I\nZWR3aWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMzsKICAgICAgICBwdWJsaWMg\nc3RhdGljIGZpbmFsIGludCBNU0dJRF9GSUVMRF9OVU1CRVIgPSAzOwogICAg\nICAgIHByaXZhdGUgYm9vbGVhbiBoYXNNc2dJZDsKICAgICAgICBwcml2YXRl\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZCBtc2dJZF87CiAgICAgICAgcHVibGljIGJvb2xlYW4gaGFz\nTXNnSWQoKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNNc2dJZDsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRNc2dJZCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIG1zZ0lkXzsKICAgICAgICB9CgogICAgICAgIHBy\naXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICAgICAgICBtc2dJZF8g\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7\nCiAgICAgICAgICAgIGlmICghaGFzU3Vic2NyaWJlcklkKSByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIGlmICghaGFzTXNnSWQpIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgaWYgKCFnZXRNc2dJZCgpLmlzSW5pdGlhbGl6ZWQoKSkg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgICAgICAgIGlmIChoYXNTdWJz\nY3JpYmVySWQoKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlQnl0\nZXMoMiwgZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChoYXNNc2dJZCgpKSB7CiAgICAgICAgICAgICAgICBvdXRw\ndXQud3JpdGVNZXNzYWdlKDMsIGdldE1zZ0lkKCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1\ndCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGludCBtZW1vaXplZFNl\ncmlhbGl6ZWRTaXplID0gLTE7CiAgICAgICAgcHVibGljIGludCBnZXRTZXJp\nYWxpemVkU2l6ZSgpIHsKICAgICAgICAgICAgaW50IHNpemUgPSBtZW1vaXpl\nZFNlcmlhbGl6ZWRTaXplOwogICAgICAgICAgICBpZiAoc2l6ZSAhPSAtMSkg\ncmV0dXJuIHNpemU7CgogICAgICAgICAgICBzaXplID0gMDsKICAgICAgICAg\nICAgaWYgKGhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAgICAgICAgICBz\naXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0K\nICAgICAgICAgICAgICAgICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMiwg\nZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChoYXNNc2dJZCgpKSB7CiAgICAgICAgICAgICAgICBzaXplICs9IGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAg\nICAgICAgICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSgzLCBnZXRNc2dJ\nZCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaXplICs9IGdldFVu\na25vd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICAgICAg\nICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgICAgICAg\ncmV0dXJuIHNpemU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNv\nbnN1bWVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAgICAgICAgICB0\naHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZm\nZXJFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAg\nICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IHBhcnNlRnJvbSgKICAg\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEs\nCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRh\ndGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBh\ncnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVS\nZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgYnl0ZVtdIGRhdGEsCiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhy\nb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVy\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdCBwYXJzZUZyb20oamF2YS5pby5JbnB1\ndFN0cmVhbSBpbnB1dCkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgcGFyc2VGcm9tKAog\nICAgICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgcGFyc2VEZWxpbWl0\nZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgICAgICAg\naWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nQ29uc3VtZVJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nQnVpbGRlcigpOwogICAgICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGlt\naXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29u\nc3VtZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBh\ncnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVS\nZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsKICAgICAgICAg\nICAgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7CiAgICAgICAgfQogICAgICAg\nIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgewogICAgICAg\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpOwogICAgICAgIH0KICAgICAgICBw\ndWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBw\ncm90b3R5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20ocHJvdG90eXBlKTsKICAgICAgICB9CiAgICAgICAgcHVibGlj\nIEJ1aWxkZXIgdG9CdWlsZGVyKCkgewogICAgICAgICAgICByZXR1cm4gbmV3\nQnVpbGRlcih0aGlzKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1\naWxkZXI+IHsKICAgICAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCByZXN1\nbHQ7CgogICAgICAgICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVl\nc3QubmV3QnVpbGRlcigpCiAgICAgICAgICAgIHByaXZhdGUgQnVpbGRlcigp\nIHt9CgogICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0\nZSgpIHsKICAgICAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBC\ndWlsZGVyKCk7CiAgICAgICAgICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5l\ndyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nb25zdW1lUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxk\nZXI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1l\nUmVxdWVzdCBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgICAgICAgICAgaWYgKHJl\nc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAg\nICAgIkNhbm5vdCBjYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25z\ndW1lUmVxdWVzdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25l\nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdlRnJv\nbShyZXN1bHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAg\nICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IGdl\ndERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuQ29uc3VtZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGlzSW5pdGlh\nbGl6ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmlzSW5p\ndGlhbGl6ZWQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29u\nc3VtZVJlcXVlc3QgYnVpbGQoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVz\ndWx0ICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0\naW9uKHJlc3VsdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgYnVpbGRQYXJzZWQoKQogICAg\nICAgICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAg\nICAgICAgICAgICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBidWlsZFBhcnRpYWwo\nKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxy\nZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCByZXR1cm5N\nZSA9IHJlc3VsdDsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuTWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29v\nZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICAgICAgICAg\nIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0KSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3Qpb3Ro\nZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3Vt\nZVJlcXVlc3Qgb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciA9\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5D\nb25zdW1lUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRo\naXM7CiAgICAgICAgICAgICAgICBpZiAob3RoZXIuaGFzU3Vic2NyaWJlcklk\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBzZXRTdWJzY3JpYmVySWQob3Ro\nZXIuZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgaWYgKG90aGVyLmhhc01zZ0lkKCkpIHsKICAgICAgICAg\nICAgICAgICAgICBtZXJnZU1zZ0lkKG90aGVyLmdldE1zZ0lkKCkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5tZXJnZVVua25v\nd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWls\nZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAg\nICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygp\nKTsKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAg\nICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAg\nICAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAgICAgICAg\nIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtu\nb3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgICAg\nIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXJz\nZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNp\nb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQo\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgY2FzZSAxODogewogICAgICAgICAgICAgICAgICAgICAgICBz\nZXRTdWJzY3JpYmVySWQoaW5wdXQucmVhZEJ5dGVzKCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgY2FzZSAyNjogewogICAgICAgICAgICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRlciBzdWJCdWlsZGVyID0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1\nYkJ1aWxkZXIubWVyZ2VGcm9tKGdldE1zZ0lkKCkpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LnJl\nYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgc2V0TXNnSWQoc3ViQnVpbGRlci5idWls\nZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICAv\nLyByZXF1aXJlZCBieXRlcyBzdWJzY3JpYmVySWQgPSAyOwogICAgICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1N1YnNjcmliZXJJZCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklkKCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTdWJzY3JpYmVySWQoKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdWJzY3Jp\nYmVySWQoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7\nCiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhh\nc1N1YnNjcmliZXJJZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXN1bHQu\nc3Vic2NyaWJlcklkXyA9IHZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxk\nZXIgY2xlYXJTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgICAgICAgICByZXN1\nbHQuaGFzU3Vic2NyaWJlcklkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBy\nZXN1bHQuc3Vic2NyaWJlcklkXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdl\ndFN1YnNjcmliZXJJZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHJlcXVpcmVkIC5IZWR3\naWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMzsKICAgICAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzTXNnSWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmVzdWx0Lmhhc01zZ0lkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZCBnZXRNc2dJZCgpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiByZXN1bHQuZ2V0TXNnSWQoKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRNc2dJZChvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgdmFs\ndWUpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0\naW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1\nbHQuaGFzTXNnSWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzdWx0Lm1z\nZ0lkXyA9IHZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TXNn\nSWQob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZVNlcUlkLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAg\nICAgICAgICAgICByZXN1bHQuaGFzTXNnSWQgPSB0cnVlOwogICAgICAgICAg\nICAgICAgcmVzdWx0Lm1zZ0lkXyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VNc2dJZChvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGFzTXNn\nSWQoKSAmJgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubXNnSWRf\nICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAgICAg\nICAgICAgICAgICAgIHJlc3VsdC5tc2dJZF8gPQogICAgICAgICAgICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRlcihyZXN1bHQubXNnSWRfKS5t\nZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQubXNnSWRf\nID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXN1bHQuaGFzTXNnSWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxk\nZXIgY2xlYXJNc2dJZCgpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNN\nc2dJZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmVzdWx0Lm1zZ0lkXyA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3\naWcuQ29uc3VtZVJlcXVlc3QpCiAgICAgICAgfQoKICAgICAgICBzdGF0aWMg\newogICAgICAgICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgQ29uc3VtZVJl\ncXVlc3QodHJ1ZSk7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9yY2VJbml0KCk7CiAg\nICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xh\nc3Nfc2NvcGU6SGVkd2lnLkNvbnN1bWVSZXF1ZXN0KQogICAgfQoKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgVW5zdWJzY3JpYmVSZXF1ZXN0IGV4\ndGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UgewogICAgICAgIC8vIFVzZSBVbnN1YnNjcmliZVJlcXVlc3QubmV3\nQnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgICAgICBwcml2YXRlIFVuc3Vi\nc2NyaWJlUmVxdWVzdCgpIHsKICAgICAgICAgICAgaW5pdEZpZWxkcygpOwog\nICAgICAgIH0KICAgICAgICBwcml2YXRlIFVuc3Vic2NyaWJlUmVxdWVzdChi\nb29sZWFuIG5vSW5pdCkge30KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgVW5zdWJzY3JpYmVSZXF1ZXN0IGRlZmF1bHRJbnN0YW5jZTsKICAgICAg\nICBwdWJsaWMgc3RhdGljIFVuc3Vic2NyaWJlUmVxdWVzdCBnZXREZWZhdWx0\nSW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFu\nY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgVW5zdWJzY3JpYmVSZXF1\nZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgICAg\nIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3Jp\ncHRvcnMuRGVzY3JpcHRvcgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAg\nICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1Vuc3Vic2Ny\naWJlUmVxdWVzdF9kZXNjcmlwdG9yOwogICAgICAgIH0KCiAgICAgICAgcHJv\ndGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5G\naWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNj\nZXNzb3JUYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRp\nY19IZWR3aWdfVW5zdWJzY3JpYmVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJs\nZTsKICAgICAgICB9CgogICAgICAgIC8vIHJlcXVpcmVkIGJ5dGVzIHN1YnNj\ncmliZXJJZCA9IDI7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nU1VCU0NSSUJFUklEX0ZJRUxEX05VTUJFUiA9IDI7CiAgICAgICAgcHJpdmF0\nZSBib29sZWFuIGhhc1N1YnNjcmliZXJJZDsKICAgICAgICBwcml2YXRlIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBzdWJzY3JpYmVySWRfID0g\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICAg\nIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZXJJZCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGhhc1N1YnNjcmliZXJJZDsKICAgICAgICB9CiAgICAgICAg\ncHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTdWJz\nY3JpYmVySWQoKSB7CiAgICAgICAgICAgIHJldHVybiBzdWJzY3JpYmVySWRf\nOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMo\nKSB7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlz\nSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgIGlmICghaGFzU3Vic2NyaWJl\ncklkKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAg\nICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgICAgICAgaWYgKGhh\nc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3Jp\ndGVCeXRlcygyLCBnZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0\nKTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2Vy\naWFsaXplZFNpemUgPSAtMTsKICAgICAgICBwdWJsaWMgaW50IGdldFNlcmlh\nbGl6ZWRTaXplKCkgewogICAgICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVk\nU2VyaWFsaXplZFNpemU7CiAgICAgICAgICAgIGlmIChzaXplICE9IC0xKSBy\nZXR1cm4gc2l6ZTsKCiAgICAgICAgICAgIHNpemUgPSAwOwogICAgICAgICAg\nICBpZiAoaGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICAgICAgICAgIHNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgyLCBn\nZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUo\nKTsKICAgICAgICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7\nCiAgICAgICAgICAgIHJldHVybiBzaXplOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSkK\nICAgICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2Vk\nKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVS\nZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQo\nKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJl\ncXVlc3QgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgICAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAg\nICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9t\nKAogICAgICAgICAgICBieXRlW10gZGF0YSwKICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAgIC5idWlsZFBh\ncnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2Ny\naWJlUmVxdWVzdCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1\ndCkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\naW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAg\nICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBwYXJzZURlbGltaXRlZEZy\nb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAgICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnVp\nbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICAgICAgICBpZiAo\nYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1\nYnNjcmliZVJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nQnVpbGRlcigpOwogICAgICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGlt\naXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5z\ndWJzY3JpYmVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQogICAgICAg\nICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAg\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVp\nbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1\nYnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgewog\nICAgICAgICAgICByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsKICAgICAgICB9\nCiAgICAgICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7\nCiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCk7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2Ny\naWJlUmVxdWVzdCBwcm90b3R5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgICAgICB9CiAg\nICAgICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgewogICAgICAgICAg\nICByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgICAgICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNj\ncmliZVJlcXVlc3QgcmVzdWx0OwoKICAgICAgICAgICAgLy8gQ29uc3RydWN0\nIHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlVuc3Vic2NyaWJlUmVxdWVzdC5uZXdCdWlsZGVyKCkKICAgICAgICAg\nICAgcHJpdmF0ZSBCdWlsZGVyKCkge30KCiAgICAgICAgICAgIHByaXZhdGUg\nc3RhdGljIEJ1aWxkZXIgY3JlYXRlKCkgewogICAgICAgICAgICAgICAgQnVp\nbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIoKTsKICAgICAgICAgICAgICAg\nIGJ1aWxkZXIucmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCgpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgaW50ZXJuYWxH\nZXRSZXN1bHQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Owog\nICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVh\ncigpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNl\ncHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICJDYW5ub3QgY2FsbCBj\nbGVhcigpIGFmdGVyIGJ1aWxkKCkuIik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0KCk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgICAgZ2V0\nRGVzY3JpcHRvckZvclR5cGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5z\ndWJzY3JpYmVSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBnZXREZWZh\ndWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVu\nc3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFs\naXplZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuaXNJbml0\naWFsaXplZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1\nYnNjcmliZVJlcXVlc3QgYnVpbGQoKSB7CiAgICAgICAgICAgICAgICBpZiAo\ncmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhj\nZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IGJ1aWxkUGFyc2Vk\nKCkKICAgICAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgaWYgKCFpc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlv\nbigKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQ\ncm90b2NvbEJ1ZmZlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IGJ1\naWxkUGFydGlhbCgpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2Fs\nU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICJidWls\nZCgpIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkIG9uIHRoaXMgQnVpbGRlci4i\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJl\nUmVxdWVzdCByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAgICAgICAgICAgIHJl\nc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuTWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIG1l\ncmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsK\nICAgICAgICAgICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJl\nUmVxdWVzdCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBtZXJnZUZy\nb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlVuc3Vic2NyaWJlUmVxdWVzdClvdGhlcik7CiAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShv\ndGhlcik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3Qgb3RoZXIpIHsK\nICAgICAgICAgICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3Qu\nZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgICAg\nICAgICAgaWYgKG90aGVyLmhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgc2V0U3Vic2NyaWJlcklkKG90aGVyLmdldFN1YnNjcmli\nZXJJZCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRo\naXMubWVyZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMo\nKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAg\nICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3du\nRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgICAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5u\nZXdCdWlsZGVyKAogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFVu\na25vd25GaWVsZHMoKSk7CiAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkg\newogICAgICAgICAgICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFn\nKCk7CiAgICAgICAgICAgICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAg\nICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAg\nIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVs\nZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3du\nRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGNhc2UgMTg6IHsKICAgICAgICAgICAg\nICAgICAgICAgICAgc2V0U3Vic2NyaWJlcklkKGlucHV0LnJlYWRCeXRlcygp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHJlcXVpcmVk\nIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDI7CiAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1N1YnNjcmliZXJJZCgpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiByZXN1bHQuaGFzU3Vic2NyaWJlcklkKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZyBnZXRTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gcmVzdWx0LmdldFN1YnNjcmliZXJJZCgpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1YnNjcmliZXJJZChjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAgICAg\nICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzU3Vic2NyaWJl\ncklkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5zdWJzY3JpYmVy\nSWRfID0gdmFsdWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN1\nYnNjcmliZXJJZCgpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNTdWJz\nY3JpYmVySWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5zdWJz\nY3JpYmVySWRfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0U3Vic2NyaWJl\ncklkKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50\nKGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlVuc3Vic2NyaWJlUmVxdWVzdCkKICAg\nICAgICB9CgogICAgICAgIHN0YXRpYyB7CiAgICAgICAgICAgIGRlZmF1bHRJ\nbnN0YW5jZSA9IG5ldyBVbnN1YnNjcmliZVJlcXVlc3QodHJ1ZSk7CiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLmludGVybmFsRm9yY2VJbml0KCk7CiAgICAgICAgICAgIGRlZmF1bHRJ\nbnN0YW5jZS5pbml0RmllbGRzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBA\nQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlVu\nc3Vic2NyaWJlUmVxdWVzdCkKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNsYXNzIFN0b3BEZWxpdmVyeVJlcXVlc3QgZXh0ZW5kcwogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAg\nICAgLy8gVXNlIFN0b3BEZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigpIHRv\nIGNvbnN0cnVjdC4KICAgICAgICBwcml2YXRlIFN0b3BEZWxpdmVyeVJlcXVl\nc3QoKSB7CiAgICAgICAgICAgIGluaXRGaWVsZHMoKTsKICAgICAgICB9CiAg\nICAgICAgcHJpdmF0ZSBTdG9wRGVsaXZlcnlSZXF1ZXN0KGJvb2xlYW4gbm9J\nbml0KSB7fQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdG9wRGVs\naXZlcnlSZXF1ZXN0IGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICBwdWJsaWMg\nc3RhdGljIFN0b3BEZWxpdmVyeVJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNl\nKCkgewogICAgICAgICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIFN0b3BEZWxpdmVyeVJlcXVlc3QgZ2V0\nRGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5E\nZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICAg\nICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2ZXJ5UmVx\ndWVzdF9kZXNjcmlwdG9yOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVk\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JU\nYWJsZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3\naWdfU3RvcERlbGl2ZXJ5UmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7CiAg\nICAgICAgfQoKICAgICAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJzY3JpYmVy\nSWQgPSAyOwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNVQlND\nUklCRVJJRF9GSUVMRF9OVU1CRVIgPSAyOwogICAgICAgIHByaXZhdGUgYm9v\nbGVhbiBoYXNTdWJzY3JpYmVySWQ7CiAgICAgICAgcHJpdmF0ZSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkXyA9IGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBoYXNTdWJzY3JpYmVySWQ7CiAgICAgICAgfQogICAgICAgIHB1Ymxp\nYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJl\ncklkKCkgewogICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlcklkXzsKICAg\nICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewog\nICAgICAgIH0KICAgICAgICBwdWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRp\nYWxpemVkKCkgewogICAgICAgICAgICBpZiAoIWhhc1N1YnNjcmliZXJJZCkg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgICAgICAgIGlmIChoYXNTdWJz\nY3JpYmVySWQoKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlQnl0\nZXMoMiwgZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIGludCBtZW1vaXplZFNlcmlhbGl6\nZWRTaXplID0gLTE7CiAgICAgICAgcHVibGljIGludCBnZXRTZXJpYWxpemVk\nU2l6ZSgpIHsKICAgICAgICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlh\nbGl6ZWRTaXplOwogICAgICAgICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJu\nIHNpemU7CgogICAgICAgICAgICBzaXplID0gMDsKICAgICAgICAgICAgaWYg\nKGhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAgICAgICAgICBzaXplICs9\nIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAg\nICAgICAgICAgICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUoMiwgZ2V0U3Vi\nc2NyaWJlcklkKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNpemUg\nKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAg\nICAgICAgICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAg\nICAgICAgICByZXR1cm4gc2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAg\nICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxp\nZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsK\nICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1\nZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1\nZXN0IHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAgICAgICAgICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCku\nbWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAg\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20o\nCiAgICAgICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2\nZXJ5UmVxdWVzdCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1\ndCkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\naW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAg\nICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\nICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRGVsaW1pdGVk\nRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgICAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICBC\ndWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgICAgICAgIGlm\nIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCkpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0\nb3BEZWxpdmVyeVJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAg\nICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0g\nbmV3QnVpbGRlcigpOwogICAgICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURl\nbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQp\nLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIo\nKSB7CiAgICAgICAgICAgIHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlw\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKTsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIo\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rv\ncERlbGl2ZXJ5UmVxdWVzdCBwcm90b3R5cGUpIHsKICAgICAgICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgewogICAg\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRl\nbmRzCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgICAgICAgcHJpdmF0\nZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndG9wRGVsaXZlcnlSZXF1ZXN0IHJlc3VsdDsKCiAgICAgICAgICAgIC8vIENv\nbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0Lm5ld0J1aWxkZXIoKQog\nICAgICAgICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7fQoKICAgICAgICAgICAg\ncHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUoKSB7CiAgICAgICAgICAg\nICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcigpOwogICAgICAg\nICAgICAgICAgYnVpbGRlci5yZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVz\ndCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0\nIGludGVybmFsR2V0UmVzdWx0KCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIHJlc3VsdDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIEJ1\naWxkZXIgY2xlYXIoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdh\nbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiQ2Fu\nbm90IGNhbGwgY2xlYXIoKSBhZnRlciBidWlsZCgpLiIpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVy\neVJlcXVlc3QoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZyb20o\ncmVzdWx0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICAgICAg\nICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJl\ncXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0\nYW5jZSgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIHJlc3VsdC5pc0luaXRpYWxpemVkKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QgYnVpbGQoKSB7CiAgICAg\nICAgICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlh\nbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVx\ndWVzdCBidWlsZFBhcnNlZCgpCiAgICAgICAgICAgICAgICAgICAgdGhyb3dz\nIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmICghaXNJbml0aWFsaXplZCgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXpl\nZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgIHJl\nc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBidWlsZFBh\ncnRpYWwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BE\nZWxpdmVyeVJlcXVlc3QgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgICAgICAg\nICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgICAgICAgICAgImJ1aWxkKCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQg\nb24gdGhpcyBCdWlsZGVyLiIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCByZXR1cm5NZSA9IHJlc3VsdDsK\nICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAg\nICByZXR1cm4gcmV0dXJuTWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVm\nLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciBp\nbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0KW90aGVy\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxp\ndmVyeVJlcXVlc3Qgb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhl\nciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSBy\nZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgIGlmIChvdGhlci5oYXNTdWJz\nY3JpYmVySWQoKSkgewogICAgICAgICAgICAgICAgICAgIHNldFN1YnNjcmli\nZXJJZChvdGhlci5nZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhv\ndGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93\nbkZpZWxkcyA9CiAgICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAg\nICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBp\nbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgICAgICAgICAg\nIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgog\nICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHMo\ndW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDog\newogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZp\nZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5\nLCB0YWcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNl\ndFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBj\nYXNlIDE4OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldFN1YnNjcmli\nZXJJZChpbnB1dC5yZWFkQnl0ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCgog\nICAgICAgICAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJzY3JpYmVySWQgPSAy\nOwogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQo\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1N1YnNjcmli\nZXJJZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklkKCkg\newogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTdWJzY3JpYmVy\nSWQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRl\nciBzZXRTdWJzY3JpYmVySWQoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRl\nckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgcmVzdWx0Lmhhc1N1YnNjcmliZXJJZCA9IHRydWU7CiAgICAgICAgICAg\nICAgICByZXN1bHQuc3Vic2NyaWJlcklkXyA9IHZhbHVlOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVySWQoKSB7CiAgICAgICAg\nICAgICAgICByZXN1bHQuaGFzU3Vic2NyaWJlcklkID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICByZXN1bHQuc3Vic2NyaWJlcklkXyA9IGdldERlZmF1bHRJ\nbnN0YW5jZSgpLmdldFN1YnNjcmliZXJJZCgpOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEBA\ncHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOkhlZHdpZy5T\ndG9wRGVsaXZlcnlSZXF1ZXN0KQogICAgICAgIH0KCiAgICAgICAgc3RhdGlj\nIHsKICAgICAgICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFN0b3BEZWxp\ndmVyeVJlcXVlc3QodHJ1ZSk7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9yY2VJbml0\nKCk7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9p\nbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlN0b3BEZWxpdmVyeVJlcXVlc3QpCiAg\nICB9CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBTdGFydERlbGl2\nZXJ5UmVxdWVzdCBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlIHsKICAgICAgICAvLyBVc2UgU3RhcnREZWxp\ndmVyeVJlcXVlc3QubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgICAg\nICBwcml2YXRlIFN0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkgewogICAgICAgICAg\nICBpbml0RmllbGRzKCk7CiAgICAgICAgfQogICAgICAgIHByaXZhdGUgU3Rh\ncnREZWxpdmVyeVJlcXVlc3QoYm9vbGVhbiBub0luaXQpIHt9CgogICAgICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0YXJ0RGVsaXZlcnlSZXF1ZXN0IGRl\nZmF1bHRJbnN0YW5jZTsKICAgICAgICBwdWJsaWMgc3RhdGljIFN0YXJ0RGVs\naXZlcnlSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBTdGFydERlbGl2ZXJ5UmVxdWVzdCBnZXREZWZhdWx0SW5zdGFu\nY2VGb3JUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gZGVmYXVsdEluc3Rh\nbmNlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAg\nICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19TdGFydERlbGl2ZXJ5UmVxdWVzdF9kZXNjcmlw\ndG9yOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUK\nICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3RhcnREZWxp\ndmVyeVJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgICAgIH0KCiAg\nICAgICAgLy8gcmVxdWlyZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0gMjsKICAg\nICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVUJTQ1JJQkVSSURfRklF\nTERfTlVNQkVSID0gMjsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFzU3Vi\nc2NyaWJlcklkOwogICAgICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIHN1YnNjcmliZXJJZF8gPSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICAgICAgcHVibGljIGJvb2xlYW4g\naGFzU3Vic2NyaWJlcklkKCkgewogICAgICAgICAgICByZXR1cm4gaGFzU3Vi\nc2NyaWJlcklkOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1YnNjcmliZXJJZCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIHN1YnNjcmliZXJJZF87CiAgICAgICAgfQoKICAg\nICAgICBwcml2YXRlIHZvaWQgaW5pdEZpZWxkcygpIHsKICAgICAgICB9CiAg\nICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsK\nICAgICAgICAgICAgaWYgKCFoYXNTdWJzY3JpYmVySWQpIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICBnZXRTZXJpYWxp\nemVkU2l6ZSgpOwogICAgICAgICAgICBpZiAoaGFzU3Vic2NyaWJlcklkKCkp\nIHsKICAgICAgICAgICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDIsIGdldFN1\nYnNjcmliZXJJZCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBnZXRV\nbmtub3duRmllbGRzKCkud3JpdGVUbyhvdXRwdXQpOwogICAgICAgIH0KCiAg\nICAgICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0x\nOwogICAgICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAg\nICAgICAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsK\nICAgICAgICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwoKICAg\nICAgICAgICAgc2l6ZSA9IDA7CiAgICAgICAgICAgIGlmIChoYXNTdWJzY3Jp\nYmVySWQoKSkgewogICAgICAgICAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAgICAgICAg\nICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDIsIGdldFN1YnNjcmliZXJJZCgp\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaXplICs9IGdldFVua25v\nd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICAgICAgICBt\nZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgICAgICAgcmV0\ndXJuIHNpemU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0\nRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAgICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHBhcnNl\nRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0\nZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9\nCiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBwYXJz\nZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29t\nLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRp\nb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAg\nICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVx\ndWVzdCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQp\nLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RhcnREZWxpdmVyeVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAgICBq\nYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAg\nICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9t\nKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIEJ1aWxk\nZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgaWYgKGJ1\naWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnRE\nZWxpdmVyeVJlcXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nQnVpbGRlcigpOwogICAgICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGlt\naXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rh\ncnREZWxpdmVyeVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAg\nICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5i\ndWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0\nYXJ0RGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigp\nIHsKICAgICAgICAgICAgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBl\nKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpOwogICAgICAg\nIH0KICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFy\ndERlbGl2ZXJ5UmVxdWVzdCBwcm90b3R5cGUpIHsKICAgICAgICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgICAg\nICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgewogICAg\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRl\nbmRzCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgICAgICAgcHJpdmF0\nZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndGFydERlbGl2ZXJ5UmVxdWVzdCByZXN1bHQ7CgogICAgICAgICAgICAvLyBD\nb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CgogICAgICAgICAg\nICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICAg\nICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVx\ndWVzdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVx\ndWVzdCBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3Vs\ndCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEls\nbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nIkNhbm5vdCBjYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERl\nbGl2ZXJ5UmVxdWVzdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nb25lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdl\nRnJvbShyZXN1bHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LmdldERlc2NyaXB0\nb3IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QuZ2V0RGVm\nYXVsdEluc3RhbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgYnVpbGQo\nKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlz\nSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\nd1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0\naWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnRE\nZWxpdmVyeVJlcXVlc3QgYnVpbGRQYXJzZWQoKQogICAgICAgICAgICAgICAg\nICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2Nv\nbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzSW5p\ndGlhbGl6ZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1Vu\naW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1\ncm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBidWlsZFBhcnRpYWwoKSB7CiAg\nICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAog\nICAgICAgICAgICAgICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBi\nZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCByZXR1cm5N\nZSA9IHJlc3VsdDsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuTWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29v\nZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICAgICAgICAg\nIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0KSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVy\neVJlcXVlc3Qpb3RoZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBt\nZXJnZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3Qgb3RoZXIpIHsKICAgICAgICAg\nICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5nZXREZWZh\ndWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICBp\nZiAob3RoZXIuaGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBzZXRTdWJzY3JpYmVySWQob3RoZXIuZ2V0U3Vic2NyaWJlcklkKCkp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5tZXJn\nZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5w\ndXQsCiAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVu\nc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAg\nICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNl\ndC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxk\nZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZp\nZWxkcygpKTsKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAg\nICAgICAgICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAg\nICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICAg\nICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5z\nZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAg\nICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKCFwYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBl\neHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMu\nYnVpbGQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgY2FzZSAxODogewogICAgICAgICAgICAgICAgICAg\nICAgICBzZXRTdWJzY3JpYmVySWQoaW5wdXQucmVhZEJ5dGVzKCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgoKICAgICAgICAgICAgLy8gcmVxdWlyZWQgYnl0ZXMg\nc3Vic2NyaWJlcklkID0gMjsKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4g\naGFzU3Vic2NyaWJlcklkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJl\nc3VsdC5oYXNTdWJzY3JpYmVySWQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdl\ndFN1YnNjcmliZXJJZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1\nbHQuZ2V0U3Vic2NyaWJlcklkKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcHVibGljIEJ1aWxkZXIgc2V0U3Vic2NyaWJlcklkKGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewogICAgICAgICAgICAgICAg\naWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNTdWJzY3JpYmVySWQgPSB0\ncnVlOwogICAgICAgICAgICAgICAgcmVzdWx0LnN1YnNjcmliZXJJZF8gPSB2\nYWx1ZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3Vic2NyaWJl\ncklkKCkgewogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1N1YnNjcmliZXJJ\nZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmVzdWx0LnN1YnNjcmliZXJJ\nZF8gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRTdWJzY3JpYmVySWQoKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRl\ncl9zY29wZTpIZWR3aWcuU3RhcnREZWxpdmVyeVJlcXVlc3QpCiAgICAgICAg\nfQoKICAgICAgICBzdGF0aWMgewogICAgICAgICAgICBkZWZhdWx0SW5zdGFu\nY2UgPSBuZXcgU3RhcnREZWxpdmVyeVJlcXVlc3QodHJ1ZSk7CiAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLmludGVybmFsRm9yY2VJbml0KCk7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0\nYW5jZS5pbml0RmllbGRzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBAQHBy\nb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlN0YXJ0\nRGVsaXZlcnlSZXF1ZXN0KQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgZmlu\nYWwgY2xhc3MgUHViU3ViUmVzcG9uc2UgZXh0ZW5kcwogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAgICAgLy8g\nVXNlIFB1YlN1YlJlc3BvbnNlLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3Qu\nCiAgICAgICAgcHJpdmF0ZSBQdWJTdWJSZXNwb25zZSgpIHsKICAgICAgICAg\nICAgaW5pdEZpZWxkcygpOwogICAgICAgIH0KICAgICAgICBwcml2YXRlIFB1\nYlN1YlJlc3BvbnNlKGJvb2xlYW4gbm9Jbml0KSB7fQoKICAgICAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBQdWJTdWJSZXNwb25zZSBkZWZhdWx0SW5zdGFu\nY2U7CiAgICAgICAgcHVibGljIHN0YXRpYyBQdWJTdWJSZXNwb25zZSBnZXRE\nZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0\nSW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgUHViU3ViUmVz\ncG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICAg\nICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsK\nICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfUHViU3Vi\nUmVzcG9uc2VfZGVzY3JpcHRvcjsKICAgICAgICB9CgogICAgICAgIHByb3Rl\nY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmll\nbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vz\nc29yVGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX1B1YlN1YlJlc3BvbnNlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nICAgICB9CgogICAgICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcuUHJvdG9jb2xW\nZXJzaW9uIHByb3RvY29sVmVyc2lvbiA9IDE7CiAgICAgICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgUFJPVE9DT0xWRVJTSU9OX0ZJRUxEX05VTUJFUiA9\nIDE7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGhhc1Byb3RvY29sVmVyc2lv\nbjsKICAgICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbiBwcm90b2NvbFZlcnNp\nb25fOwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1Byb3RvY29sVmVyc2lv\nbigpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc1Byb3RvY29sVmVyc2lvbjsK\nICAgICAgICB9CiAgICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbiBnZXRQcm90\nb2NvbFZlcnNpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBwcm90b2NvbFZl\ncnNpb25fOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVxdWlyZWQgLkhlZHdp\nZy5TdGF0dXNDb2RlIHN0YXR1c0NvZGUgPSAyOwogICAgICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IFNUQVRVU0NPREVfRklFTERfTlVNQkVSID0gMjsK\nICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFzU3RhdHVzQ29kZTsKICAgICAg\nICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXR1c0NvZGUgc3RhdHVzQ29kZV87CiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzU3RhdHVzQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJu\nIGhhc1N0YXR1c0NvZGU7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGF0dXND\nb2RlIGdldFN0YXR1c0NvZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBzdGF0\ndXNDb2RlXzsKICAgICAgICB9CgogICAgICAgIC8vIHJlcXVpcmVkIHVpbnQ2\nNCB0eG5JZCA9IDM7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nVFhOSURfRklFTERfTlVNQkVSID0gMzsKICAgICAgICBwcml2YXRlIGJvb2xl\nYW4gaGFzVHhuSWQ7CiAgICAgICAgcHJpdmF0ZSBsb25nIHR4bklkXyA9IDBM\nOwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1R4bklkKCkgewogICAgICAg\nICAgICByZXR1cm4gaGFzVHhuSWQ7CiAgICAgICAgfQogICAgICAgIHB1Ymxp\nYyBsb25nIGdldFR4bklkKCkgewogICAgICAgICAgICByZXR1cm4gdHhuSWRf\nOwogICAgICAgIH0KCiAgICAgICAgLy8gb3B0aW9uYWwgc3RyaW5nIHN0YXR1\nc01zZyA9IDQ7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RB\nVFVTTVNHX0ZJRUxEX05VTUJFUiA9IDQ7CiAgICAgICAgcHJpdmF0ZSBib29s\nZWFuIGhhc1N0YXR1c01zZzsKICAgICAgICBwcml2YXRlIGphdmEubGFuZy5T\ndHJpbmcgc3RhdHVzTXNnXyA9ICIiOwogICAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc1N0YXR1c01zZygpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc1N0YXR1\nc01zZzsKICAgICAgICB9CiAgICAgICAgcHVibGljIGphdmEubGFuZy5TdHJp\nbmcgZ2V0U3RhdHVzTXNnKCkgewogICAgICAgICAgICByZXR1cm4gc3RhdHVz\nTXNnXzsKICAgICAgICB9CgogICAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcu\nTWVzc2FnZSBtZXNzYWdlID0gNTsKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGludCBNRVNTQUdFX0ZJRUxEX05VTUJFUiA9IDU7CiAgICAgICAgcHJp\ndmF0ZSBib29sZWFuIGhhc01lc3NhZ2U7CiAgICAgICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nIG1lc3NhZ2VfOwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2Uo\nKSB7CiAgICAgICAgICAgIHJldHVybiBoYXNNZXNzYWdlOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZSBnZXRNZXNzYWdlKCkgewogICAgICAgICAg\nICByZXR1cm4gbWVzc2FnZV87CiAgICAgICAgfQoKICAgICAgICAvLyBvcHRp\nb25hbCBieXRlcyB0b3BpYyA9IDY7CiAgICAgICAgcHVibGljIHN0YXRpYyBm\naW5hbCBpbnQgVE9QSUNfRklFTERfTlVNQkVSID0gNjsKICAgICAgICBwcml2\nYXRlIGJvb2xlYW4gaGFzVG9waWM7CiAgICAgICAgcHJpdmF0ZSBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdG9waWNfID0gY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgICAgIHB1YmxpYyBib29s\nZWFuIGhhc1RvcGljKCkgewogICAgICAgICAgICByZXR1cm4gaGFzVG9waWM7\nCiAgICAgICAgfQogICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcgZ2V0VG9waWMoKSB7CiAgICAgICAgICAgIHJldHVybiB0\nb3BpY187CiAgICAgICAgfQoKICAgICAgICAvLyBvcHRpb25hbCBieXRlcyBz\ndWJzY3JpYmVySWQgPSA3OwogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\naW50IFNVQlNDUklCRVJJRF9GSUVMRF9OVU1CRVIgPSA3OwogICAgICAgIHBy\naXZhdGUgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQ7CiAgICAgICAgcHJpdmF0\nZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Vic2NyaWJlcklk\nXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQoKSB7CiAgICAg\nICAgICAgIHJldHVybiBoYXNTdWJzY3JpYmVySWQ7CiAgICAgICAgfQogICAg\nICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0\nU3Vic2NyaWJlcklkKCkgewogICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJl\ncklkXzsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUgdm9pZCBpbml0Rmll\nbGRzKCkgewogICAgICAgICAgICBwcm90b2NvbFZlcnNpb25fID0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xW\nZXJzaW9uLlZFUlNJT05fT05FOwogICAgICAgICAgICBzdGF0dXNDb2RlXyA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0\nYXR1c0NvZGUuU1VDQ0VTUzsKICAgICAgICAgICAgbWVzc2FnZV8gPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIH0KICAgICAgICBwdWJs\naWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgICAg\nICBpZiAoIWhhc1Byb3RvY29sVmVyc2lvbikgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICBpZiAoIWhhc1N0YXR1c0NvZGUpIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgaWYgKCFoYXNUeG5JZCkgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICBpZiAoaGFzTWVzc2FnZSgpKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIWdldE1lc3NhZ2UoKS5pc0luaXRpYWxpemVkKCkpIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5w\ncm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgICAgICAgIGlmIChoYXNQcm90\nb2NvbFZlcnNpb24oKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRl\nRW51bSgxLCBnZXRQcm90b2NvbFZlcnNpb24oKS5nZXROdW1iZXIoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1N0YXR1c0NvZGUoKSkg\newogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlRW51bSgyLCBnZXRTdGF0\ndXNDb2RlKCkuZ2V0TnVtYmVyKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChoYXNUeG5JZCgpKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQu\nd3JpdGVVSW50NjQoMywgZ2V0VHhuSWQoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgaWYgKGhhc1N0YXR1c01zZygpKSB7CiAgICAgICAgICAgICAg\nICBvdXRwdXQud3JpdGVTdHJpbmcoNCwgZ2V0U3RhdHVzTXNnKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChoYXNNZXNzYWdlKCkpIHsKICAg\nICAgICAgICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNSwgZ2V0TWVzc2Fn\nZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGFzVG9waWMo\nKSkgewogICAgICAgICAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoNiwgZ2V0\nVG9waWMoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhhc1N1\nYnNjcmliZXJJZCgpKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3JpdGVC\neXRlcyg3LCBnZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsK\nICAgICAgICB9CgogICAgICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFs\naXplZFNpemUgPSAtMTsKICAgICAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6\nZWRTaXplKCkgewogICAgICAgICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2Vy\naWFsaXplZFNpemU7CiAgICAgICAgICAgIGlmIChzaXplICE9IC0xKSByZXR1\ncm4gc2l6ZTsKCiAgICAgICAgICAgIHNpemUgPSAwOwogICAgICAgICAgICBp\nZiAoaGFzUHJvdG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICAgICAgICAgIHNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZUVudW1TaXplKDEsIGdl\ndFByb3RvY29sVmVyc2lvbigpLmdldE51bWJlcigpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoaGFzU3RhdHVzQ29kZSgpKSB7CiAgICAgICAg\nICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAgLmNvbXB1dGVFbnVt\nU2l6ZSgyLCBnZXRTdGF0dXNDb2RlKCkuZ2V0TnVtYmVyKCkpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmIChoYXNUeG5JZCgpKSB7CiAgICAgICAg\nICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAgLmNvbXB1dGVVSW50\nNjRTaXplKDMsIGdldFR4bklkKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGlmIChoYXNTdGF0dXNNc2coKSkgewogICAgICAgICAgICAgICAgc2l6\nZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAg\nICAgICAgICAgICAgICAgICAgICAgIC5jb21wdXRlU3RyaW5nU2l6ZSg0LCBn\nZXRTdGF0dXNNc2coKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGhhc01lc3NhZ2UoKSkgewogICAgICAgICAgICAgICAgc2l6ZSArPSBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAg\nICAgICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUoNSwgZ2V0TWVzc2Fn\nZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGFzVG9waWMo\nKSkgewogICAgICAgICAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAgICAgICAgICAgICAg\nIC5jb21wdXRlQnl0ZXNTaXplKDYsIGdldFRvcGljKCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGlmIChoYXNTdWJzY3JpYmVySWQoKSkgewogICAg\nICAgICAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nT3V0cHV0U3RyZWFtCiAgICAgICAgICAgICAgICAgICAgICAgIC5jb21wdXRl\nQnl0ZXNTaXplKDcsIGdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRT\nZXJpYWxpemVkU2l6ZSgpOwogICAgICAgICAgICBtZW1vaXplZFNlcmlhbGl6\nZWRTaXplID0gc2l6ZTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIHBhcnNl\nRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5i\ndWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1\nYlN1YlJlc3BvbnNlIHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJS\nZXNwb25zZSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIHBhcnNlRnJvbSgK\nICAgICAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJz\nZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNw\nb25zZSBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQp\nLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHViU3ViUmVzcG9uc2UgcGFyc2VGcm9tKAogICAgICAgICAgICBqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\naW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAg\nLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHViU3ViUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9\nIG5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VE\nZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcGFy\nc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICAg\nICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1\naWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcGFyc2VG\ncm9tKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIHBhcnNlRnJvbSgK\nICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxk\nZXIgbmV3QnVpbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIEJ1aWxkZXIu\nY3JlYXRlKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVyIG5l\nd0J1aWxkZXJGb3JUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIEJ1aWxk\nZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSBwcm90b3R5cGUpIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBl\nKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVy\nKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVp\nbGRlciBleHRlbmRzCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgICAg\nICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJTdWJSZXNwb25zZSByZXN1bHQ7CgogICAgICAgICAgICAv\nLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UubmV3QnVpbGRlcigpCiAg\nICAgICAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CgogICAgICAgICAgICBw\ncml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICAgICAg\nICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7CiAgICAgICAg\nICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSBpbnRlcm5hbEdl\ndFJlc3VsdCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFy\nKCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgIkNhbm5vdCBjYWxsIGNs\nZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSgpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShyZXN1bHQpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICAgIGdldERlc2Ny\naXB0b3JGb3JUeXBlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJl\nc3BvbnNlLmdldERlc2NyaXB0b3IoKTsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIGdldERlZmF1bHRJbnN0YW5jZUZv\nclR5cGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2Uu\nZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgYnVpbGQo\nKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlz\nSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5l\nd1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0\naWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3Vi\nUmVzcG9uc2UgYnVpbGRQYXJzZWQoKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzSW5pdGlhbGl6\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlh\nbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAg\nICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVp\nbGRQYXJ0aWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJTdWJSZXNwb25zZSBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgICAgICAg\nICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAg\nICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBv\nbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJTdWJSZXNwb25zZSByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAg\nICAgICAgICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXR1\ncm4gcmV0dXJuTWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3Nh\nZ2Ugb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciBpbnN0YW5j\nZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1YlN1YlJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHViU3ViUmVzcG9uc2Upb3RoZXIpOwogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdXBlci5tZXJnZUZy\nb20ob3RoZXIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBw\ndWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2Ugb3RoZXIpIHsK\nICAgICAgICAgICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZS5nZXRE\nZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAg\nICBpZiAob3RoZXIuaGFzUHJvdG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICAg\nICAgICAgICAgICBzZXRQcm90b2NvbFZlcnNpb24ob3RoZXIuZ2V0UHJvdG9j\nb2xWZXJzaW9uKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgaWYgKG90aGVyLmhhc1N0YXR1c0NvZGUoKSkgewogICAgICAgICAgICAg\nICAgICAgIHNldFN0YXR1c0NvZGUob3RoZXIuZ2V0U3RhdHVzQ29kZSgpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvdGhlci5o\nYXNUeG5JZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgc2V0VHhuSWQob3Ro\nZXIuZ2V0VHhuSWQoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBpZiAob3RoZXIuaGFzU3RhdHVzTXNnKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBzZXRTdGF0dXNNc2cob3RoZXIuZ2V0U3RhdHVzTXNnKCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG90aGVyLmhh\nc01lc3NhZ2UoKSkgewogICAgICAgICAgICAgICAgICAgIG1lcmdlTWVzc2Fn\nZShvdGhlci5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgaWYgKG90aGVyLmhhc1RvcGljKCkpIHsKICAgICAgICAg\nICAgICAgICAgICBzZXRUb3BpYyhvdGhlci5nZXRUb3BpYygpKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChvdGhlci5oYXNTdWJz\nY3JpYmVySWQoKSkgewogICAgICAgICAgICAgICAgICAgIHNldFN1YnNjcmli\nZXJJZChvdGhlci5nZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhv\ndGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxkZXIgdW5rbm93\nbkZpZWxkcyA9CiAgICAgICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAg\nICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBp\nbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgICAgICAgICAg\nIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOgog\nICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHMo\ndW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDog\newogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93bkZp\nZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5\nLCB0YWcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNl\ndFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBj\nYXNlIDg6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJhd1ZhbHVl\nID0gaW5wdXQucmVhZEVudW0oKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJv\ndG9jb2xWZXJzaW9uIHZhbHVlID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uLnZhbHVlT2YocmF3\nVmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5rbm93bkZp\nZWxkcy5tZXJnZVZhcmludEZpZWxkKDEsIHJhd1ZhbHVlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHNldFByb3RvY29sVmVyc2lvbih2YWx1ZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNh\nc2UgMTY6IHsKICAgICAgICAgICAgICAgICAgICAgICAgaW50IHJhd1ZhbHVl\nID0gaW5wdXQucmVhZEVudW0oKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rh\ndHVzQ29kZSB2YWx1ZSA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0YXR1c0NvZGUudmFsdWVPZihyYXdWYWx1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB1bmtub3duRmllbGRzLm1lcmdl\nVmFyaW50RmllbGQoMiwgcmF3VmFsdWUpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0\nU3RhdHVzQ29kZSh2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgMjQ6IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgc2V0VHhuSWQoaW5wdXQucmVhZFVJbnQ2NCgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzQ6IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgc2V0U3RhdHVzTXNnKGlucHV0LnJlYWRT\ndHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYXNlIDQy\nOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UuQnVpbGRlciBzdWJC\ndWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChoYXNNZXNzYWdlKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHN1YkJ1aWxkZXIubWVyZ2VGcm9tKGdldE1lc3NhZ2UoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9u\nUmVnaXN0cnkpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXRNZXNzYWdl\nKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAgICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgY2FzZSA1MDogewogICAgICAgICAgICAgICAgICAgICAg\nICBzZXRUb3BpYyhpbnB1dC5yZWFkQnl0ZXMoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBjYXNlIDU4OiB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHNldFN1YnNjcmliZXJJZChpbnB1dC5yZWFkQnl0ZXMoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCgogICAgICAgICAgICAvLyByZXF1aXJlZCAuSGVkd2ln\nLlByb3RvY29sVmVyc2lvbiBwcm90b2NvbFZlcnNpb24gPSAxOwogICAgICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNQcm90b2NvbFZlcnNpb24oKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1Byb3RvY29sVmVyc2lv\nbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZl\ncnNpb24gZ2V0UHJvdG9jb2xWZXJzaW9uKCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIHJlc3VsdC5nZXRQcm90b2NvbFZlcnNpb24oKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRQcm90b2NvbFZl\ncnNpb24ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHJvdG9jb2xWZXJzaW9uIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBp\nZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1Byb3RvY29sVmVyc2lvbiA9\nIHRydWU7CiAgICAgICAgICAgICAgICByZXN1bHQucHJvdG9jb2xWZXJzaW9u\nXyA9IHZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJQcm90\nb2NvbFZlcnNpb24oKSB7CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzUHJv\ndG9jb2xWZXJzaW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXN1bHQu\ncHJvdG9jb2xWZXJzaW9uXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbi5WRVJTSU9OX09ORTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyByZXF1aXJlZCAuSGVkd2lnLlN0YXR1c0NvZGUgc3Rh\ndHVzQ29kZSA9IDI7CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1N0\nYXR1c0NvZGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0Lmhh\nc1N0YXR1c0NvZGUoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJs\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RhdHVzQ29kZSBnZXRTdGF0dXNDb2RlKCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIHJlc3VsdC5nZXRTdGF0dXNDb2RlKCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U3RhdHVzQ29kZShvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGF0dXND\nb2RlIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRl\nckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgcmVzdWx0Lmhhc1N0YXR1c0NvZGUgPSB0cnVlOwogICAgICAgICAgICAg\nICAgcmVzdWx0LnN0YXR1c0NvZGVfID0gdmFsdWU7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhclN0YXR1c0NvZGUoKSB7CiAgICAgICAgICAgICAg\nICByZXN1bHQuaGFzU3RhdHVzQ29kZSA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgcmVzdWx0LnN0YXR1c0NvZGVfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhdHVzQ29kZS5TVUNDRVNTOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIHJlcXVpcmVkIHVpbnQ2NCB0eG5JZCA9IDM7CiAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGhhc1R4bklkKCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHJlc3VsdC5oYXNUeG5JZCgpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHB1YmxpYyBsb25nIGdldFR4bklkKCkgewogICAgICAgICAg\nICAgICAgcmV0dXJuIHJlc3VsdC5nZXRUeG5JZCgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFR4bklkKGxvbmcgdmFs\ndWUpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNUeG5JZCA9IHRydWU7\nCiAgICAgICAgICAgICAgICByZXN1bHQudHhuSWRfID0gdmFsdWU7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclR4bklkKCkgewogICAgICAgICAg\nICAgICAgcmVzdWx0Lmhhc1R4bklkID0gZmFsc2U7CiAgICAgICAgICAgICAg\nICByZXN1bHQudHhuSWRfID0gMEw7CiAgICAgICAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gb3B0aW9uYWwg\nc3RyaW5nIHN0YXR1c01zZyA9IDQ7CiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGhhc1N0YXR1c01zZygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBy\nZXN1bHQuaGFzU3RhdHVzTXNnKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcHVibGljIGphdmEubGFuZy5TdHJpbmcgZ2V0U3RhdHVzTXNnKCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTdGF0dXNNc2coKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRT\ndGF0dXNNc2coamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgewogICAgICAgICAg\nICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNTdGF0dXNNc2cg\nPSB0cnVlOwogICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1c01zZ18gPSB2\nYWx1ZTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3RhdHVzTXNn\nKCkgewogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc1N0YXR1c01zZyA9IGZh\nbHNlOwogICAgICAgICAgICAgICAgcmVzdWx0LnN0YXR1c01zZ18gPSBnZXRE\nZWZhdWx0SW5zdGFuY2UoKS5nZXRTdGF0dXNNc2coKTsKICAgICAgICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBvcHRpb25hbCAuSGVkd2lnLk1lc3NhZ2UgbWVzc2FnZSA9IDU7CiAgICAg\nICAgICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2UoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc01lc3NhZ2UoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBnZXRNZXNzYWdlKCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRNZXNzYWdlKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TWVz\nc2FnZShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFsdWUg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBOdWxs\nUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgcmVzdWx0Lmhhc01lc3NhZ2UgPSB0cnVlOwogICAgICAgICAg\nICAgICAgcmVzdWx0Lm1lc3NhZ2VfID0gdmFsdWU7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJs\naWMgQnVpbGRlciBzZXRNZXNzYWdlKG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UuQnVpbGRlciBidWlsZGVyRm9y\nVmFsdWUpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNNZXNzYWdlID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIHJlc3VsdC5tZXNzYWdlXyA9IGJ1aWxk\nZXJGb3JWYWx1ZS5idWlsZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIg\nbWVyZ2VNZXNzYWdlKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2UgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlm\nIChyZXN1bHQuaGFzTWVzc2FnZSgpICYmCiAgICAgICAgICAgICAgICAgICAg\nICAgIHJlc3VsdC5tZXNzYWdlXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERlZmF1bHRJbnN0YW5j\nZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm1lc3NhZ2VfID0K\nICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVyKHJlc3Vs\ndC5tZXNzYWdlXykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\ncmVzdWx0Lm1lc3NhZ2VfID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXN1bHQuaGFzTWVzc2FnZSA9IHRydWU7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1lc3NhZ2UoKSB7CiAgICAgICAg\nICAgICAgICByZXN1bHQuaGFzTWVzc2FnZSA9IGZhbHNlOwogICAgICAgICAg\nICAgICAgcmVzdWx0Lm1lc3NhZ2VfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFu\nY2UoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBvcHRpb25hbCBieXRlcyB0b3BpYyA9IDY7\nCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1RvcGljKCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNUb3BpYygpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcgZ2V0VG9waWMoKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gcmVzdWx0LmdldFRvcGljKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcHVibGljIEJ1aWxkZXIgc2V0VG9waWMoY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAgICAgICAgICBpZiAodmFs\ndWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBO\ndWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgcmVzdWx0Lmhhc1RvcGljID0gdHJ1ZTsKICAgICAgICAg\nICAgICAgIHJlc3VsdC50b3BpY18gPSB2YWx1ZTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyVG9waWMoKSB7CiAgICAgICAgICAgICAgICByZXN1\nbHQuaGFzVG9waWMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJlc3VsdC50\nb3BpY18gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRUb3BpYygpOwogICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIC8vIG9wdGlvbmFsIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDc7CiAg\nICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZXJJZCgpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQuaGFzU3Vic2NyaWJlcklk\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTdWJzY3JpYmVySWQoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldFN1YnNjcmliZXJJZCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndFN1YnNjcmliZXJJZChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\ndmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXN1bHQuaGFzU3Vic2NyaWJlcklkID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nIHJlc3VsdC5zdWJzY3JpYmVySWRfID0gdmFsdWU7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhclN1YnNjcmliZXJJZCgpIHsKICAgICAgICAgICAg\nICAgIHJlc3VsdC5oYXNTdWJzY3JpYmVySWQgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgIHJlc3VsdC5zdWJzY3JpYmVySWRfID0gZ2V0RGVmYXVsdEluc3Rh\nbmNlKCkuZ2V0U3Vic2NyaWJlcklkKCk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQEBwcm90\nb2NfaW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlB1YlN1\nYlJlc3BvbnNlKQogICAgICAgIH0KCiAgICAgICAgc3RhdGljIHsKICAgICAg\nICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFB1YlN1YlJlc3BvbnNlKHRy\ndWUpOwogICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5pbnRlcm5hbEZvcmNlSW5pdCgpOwogICAgICAgICAg\nICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3Bl\nOkhlZHdpZy5QdWJTdWJSZXNwb25zZSkKICAgIH0KCiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGNsYXNzIFN1YnNjcmlwdGlvblN0YXRlIGV4dGVuZHMKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Ugewog\nICAgICAgIC8vIFVzZSBTdWJzY3JpcHRpb25TdGF0ZS5uZXdCdWlsZGVyKCkg\ndG8gY29uc3RydWN0LgogICAgICAgIHByaXZhdGUgU3Vic2NyaXB0aW9uU3Rh\ndGUoKSB7CiAgICAgICAgICAgIGluaXRGaWVsZHMoKTsKICAgICAgICB9CiAg\nICAgICAgcHJpdmF0ZSBTdWJzY3JpcHRpb25TdGF0ZShib29sZWFuIG5vSW5p\ndCkge30KCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3Vic2NyaXB0\naW9uU3RhdGUgZGVmYXVsdEluc3RhbmNlOwogICAgICAgIHB1YmxpYyBzdGF0\naWMgU3Vic2NyaXB0aW9uU3RhdGUgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewog\nICAgICAgICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIFN1YnNjcmlwdGlvblN0YXRlIGdldERlZmF1bHRJ\nbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0\nSW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRv\ncgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5p\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvblN0YXRlX2Rlc2Ny\naXB0b3I7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJs\nZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewog\nICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3Jp\ncHRpb25TdGF0ZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICAgICAgfQoKICAg\nICAgICAvLyByZXF1aXJlZCAuSGVkd2lnLk1lc3NhZ2VTZXFJZCBtc2dJZCA9\nIDE7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTVNHSURfRklF\nTERfTlVNQkVSID0gMTsKICAgICAgICBwcml2YXRlIGJvb2xlYW4gaGFzTXNn\nSWQ7CiAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgbXNnSWRfOwogICAgICAg\nIHB1YmxpYyBib29sZWFuIGhhc01zZ0lkKCkgewogICAgICAgICAgICByZXR1\ncm4gaGFzTXNnSWQ7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQgZ2V0TXNnSWQoKSB7CiAgICAgICAgICAgIHJldHVybiBtc2dJZF87CiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgaW5pdEZpZWxkcygpIHsK\nICAgICAgICAgICAgbXNnSWRfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0\nYW5jZSgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgZmluYWwgYm9vbGVh\nbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgICAgICBpZiAoIWhhc01zZ0lk\nKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghZ2V0TXNnSWQoKS5p\nc0luaXRpYWxpemVkKCkpIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCB3cml0\nZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0\ncHV0KQogICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICAgICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICAg\nICAgICBpZiAoaGFzTXNnSWQoKSkgewogICAgICAgICAgICAgICAgb3V0cHV0\nLndyaXRlTWVzc2FnZSgxLCBnZXRNc2dJZCgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhvdXRwdXQp\nOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJp\nYWxpemVkU2l6ZSA9IC0xOwogICAgICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFs\naXplZFNpemUoKSB7CiAgICAgICAgICAgIGludCBzaXplID0gbWVtb2l6ZWRT\nZXJpYWxpemVkU2l6ZTsKICAgICAgICAgICAgaWYgKHNpemUgIT0gLTEpIHJl\ndHVybiBzaXplOwoKICAgICAgICAgICAgc2l6ZSA9IDA7CiAgICAgICAgICAg\nIGlmIChoYXNNc2dJZCgpKSB7CiAgICAgICAgICAgICAgICBzaXplICs9IGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAg\nICAgICAgICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSgxLCBnZXRNc2dJ\nZCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaXplICs9IGdldFVu\na25vd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICAgICAg\nICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgICAgICAg\ncmV0dXJuIHNpemU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvblN0YXRlIHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAgICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlIHBhcnNlRnJv\nbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5n\nIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9CiAg\nICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBwYXJzZUZyb20o\nYnl0ZVtdIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewog\nICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRh\nKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvblN0YXRlIHBhcnNlRnJvbSgKICAgICAgICAgICAgYnl0\nZVtdIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0\nZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9\nCiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBwYXJzZUZy\nb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAgICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2Vk\nKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nU3RhdGUgcGFyc2VGcm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uU3RhdGUgcGFyc2VEZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJl\nYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1\naWxkZXIoKTsKICAgICAgICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0\nZWRGcm9tKGlucHV0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxk\nZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgcGFyc2VE\nZWxpbWl0ZWRGcm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFt\nIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVu\nc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAg\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICAgICAg\nICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQsIGV4dGVu\nc2lvblJlZ2lzdHJ5KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxk\nZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgcGFyc2VG\ncm9tKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlIHBhcnNlRnJv\nbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3RhdGljIEJ1\naWxkZXIgbmV3QnVpbGRlcigpIHsKICAgICAgICAgICAgcmV0dXJuIEJ1aWxk\nZXIuY3JlYXRlKCk7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBCdWlsZGVy\nIG5ld0J1aWxkZXJGb3JUeXBlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3\nQnVpbGRlcigpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIEJ1\naWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBwcm90b3R5cGUpIHsK\nICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJv\ndG90eXBlKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIgdG9C\ndWlsZGVyKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcih0aGlz\nKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xh\nc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAg\nICAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSByZXN1bHQ7CgogICAg\nICAgICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUubmV3\nQnVpbGRlcigpCiAgICAgICAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9Cgog\nICAgICAgICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsK\nICAgICAgICAgICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVy\nKCk7CiAgICAgICAgICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25TdGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25TdGF0ZSBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1\nYmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgICAgICAgICAgaWYgKHJl\nc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAg\nICAgIkNhbm5vdCBjYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25TdGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNs\nb25lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdl\nRnJvbShyZXN1bHQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlLmdldERlc2NyaXB0b3Io\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlv\nblN0YXRlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgYnVpbGQoKSB7CiAgICAgICAg\nICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQo\nKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6\nZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUg\nYnVpbGRQYXJzZWQoKQogICAgICAgICAgICAgICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNz\nYWdlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQp\nLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFs\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25TdGF0ZSBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgICAgICAgICBpZiAo\ncmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAg\nICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlz\nIEJ1aWxkZXIuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpcHRpb25TdGF0ZSByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAgICAg\nICAgICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmV0dXJuTWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ug\nb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9m\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvblN0YXRlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUpb3RoZXIpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdXBlci5tZXJn\nZUZyb20ob3RoZXIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgb3Ro\nZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25T\ndGF0ZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgICAgICBpZiAob3RoZXIuaGFzTXNnSWQoKSkgewogICAgICAgICAg\nICAgICAgICAgIG1lcmdlTXNnSWQob3RoZXIuZ2V0TXNnSWQoKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLm1lcmdlVW5rbm93\nbkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxk\nZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkp\nOwogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAg\nICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAg\nICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgICAgICAgICAg\nY2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFVua25v\nd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgICAgICAg\nZGVmYXVsdDogewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXBhcnNl\nVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lv\nblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBjYXNlIDEwOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZC5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQubmV3QnVp\nbGRlcigpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFzTXNnSWQo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViQnVpbGRlci5t\nZXJnZUZyb20oZ2V0TXNnSWQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uo\nc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAgICAgICAgICAg\nICAgICAgICAgICBzZXRNc2dJZChzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHJlcXVpcmVk\nIC5IZWR3aWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMTsKICAgICAgICAgICAg\ncHVibGljIGJvb2xlYW4gaGFzTXNnSWQoKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gcmVzdWx0Lmhhc01zZ0lkKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRNc2dJZCgpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiByZXN1bHQuZ2V0TXNnSWQoKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBzZXRNc2dJZChvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVy\nRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXN1bHQuaGFzTXNnSWQgPSB0cnVlOwogICAgICAgICAgICAgICAgcmVz\ndWx0Lm1zZ0lkXyA9IHZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIg\nc2V0TXNnSWQob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7\nCiAgICAgICAgICAgICAgICByZXN1bHQuaGFzTXNnSWQgPSB0cnVlOwogICAg\nICAgICAgICAgICAgcmVzdWx0Lm1zZ0lkXyA9IGJ1aWxkZXJGb3JWYWx1ZS5i\ndWlsZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VNc2dJZChv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlU2VxSWQgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQu\naGFzTXNnSWQoKSAmJgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQu\nbXNnSWRfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewog\nICAgICAgICAgICAgICAgICAgIHJlc3VsdC5tc2dJZF8gPQogICAgICAgICAg\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRlcihyZXN1bHQubXNn\nSWRfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXN1bHQu\nbXNnSWRfID0gdmFsdWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICByZXN1bHQuaGFzTXNnSWQgPSB0cnVlOwogICAgICAgICAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGlj\nIEJ1aWxkZXIgY2xlYXJNc2dJZCgpIHsKICAgICAgICAgICAgICAgIHJlc3Vs\ndC5oYXNNc2dJZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmVzdWx0Lm1z\nZ0lkXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29w\nZTpIZWR3aWcuU3Vic2NyaXB0aW9uU3RhdGUpCiAgICAgICAgfQoKICAgICAg\nICBzdGF0aWMgewogICAgICAgICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcg\nU3Vic2NyaXB0aW9uU3RhdGUodHJ1ZSk7CiAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9y\nY2VJbml0KCk7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0Rmll\nbGRzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRp\nb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlN1YnNjcmlwdGlvblN0YXRl\nKQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgTGVkZ2Vy\nUmFuZ2UgZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZSB7CiAgICAgICAgLy8gVXNlIExlZGdlclJhbmdlLm5l\nd0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICAgICAgcHJpdmF0ZSBMZWRn\nZXJSYW5nZSgpIHsKICAgICAgICAgICAgaW5pdEZpZWxkcygpOwogICAgICAg\nIH0KICAgICAgICBwcml2YXRlIExlZGdlclJhbmdlKGJvb2xlYW4gbm9Jbml0\nKSB7fQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMZWRnZXJSYW5n\nZSBkZWZhdWx0SW5zdGFuY2U7CiAgICAgICAgcHVibGljIHN0YXRpYyBMZWRn\nZXJSYW5nZSBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgTGVkZ2VyUmFuZ2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90\nb2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3Jp\ncHRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3\naWdfTGVkZ2VyUmFuZ2VfZGVzY3JpcHRvcjsKICAgICAgICB9CgogICAgICAg\nIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVs\nZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgICAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX0xlZGdlclJhbmdlX2ZpZWxkQWNjZXNzb3JUYWJsZTsK\nICAgICAgICB9CgogICAgICAgIC8vIHJlcXVpcmVkIHVpbnQ2NCBsZWRnZXJJ\nZCA9IDE7CiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTEVER0VS\nSURfRklFTERfTlVNQkVSID0gMTsKICAgICAgICBwcml2YXRlIGJvb2xlYW4g\naGFzTGVkZ2VySWQ7CiAgICAgICAgcHJpdmF0ZSBsb25nIGxlZGdlcklkXyA9\nIDBMOwogICAgICAgIHB1YmxpYyBib29sZWFuIGhhc0xlZGdlcklkKCkgewog\nICAgICAgICAgICByZXR1cm4gaGFzTGVkZ2VySWQ7CiAgICAgICAgfQogICAg\nICAgIHB1YmxpYyBsb25nIGdldExlZGdlcklkKCkgewogICAgICAgICAgICBy\nZXR1cm4gbGVkZ2VySWRfOwogICAgICAgIH0KCiAgICAgICAgLy8gb3B0aW9u\nYWwgLkhlZHdpZy5NZXNzYWdlU2VxSWQgZW5kU2VxSWRJbmNsdWRlZCA9IDI7\nCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgRU5EU0VRSURJTkNM\nVURFRF9GSUVMRF9OVU1CRVIgPSAyOwogICAgICAgIHByaXZhdGUgYm9vbGVh\nbiBoYXNFbmRTZXFJZEluY2x1ZGVkOwogICAgICAgIHByaXZhdGUgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkIGVuZFNlcUlkSW5jbHVkZWRfOwogICAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc0VuZFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgICAgICAgIHJldHVybiBo\nYXNFbmRTZXFJZEluY2x1ZGVkOwogICAgICAgIH0KICAgICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkIGdldEVuZFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgICAgICAg\nIHJldHVybiBlbmRTZXFJZEluY2x1ZGVkXzsKICAgICAgICB9CgogICAgICAg\nIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICAgICAgICBlbmRT\nZXFJZEluY2x1ZGVkXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2Uo\nKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJ\nbml0aWFsaXplZCgpIHsKICAgICAgICAgICAgaWYgKCFoYXNMZWRnZXJJZCkg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAoaGFzRW5kU2VxSWRJbmNs\ndWRlZCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoIWdldEVuZFNlcUlkSW5j\nbHVkZWQoKS5pc0luaXRpYWxpemVkKCkpIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIGdldFNl\ncmlhbGl6ZWRTaXplKCk7CiAgICAgICAgICAgIGlmIChoYXNMZWRnZXJJZCgp\nKSB7CiAgICAgICAgICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQoMSwgZ2V0\nTGVkZ2VySWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGhh\nc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAgICAgICAgICAgb3V0cHV0\nLndyaXRlTWVzc2FnZSgyLCBnZXRFbmRTZXFJZEluY2x1ZGVkKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0\nZVRvKG91dHB1dCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGludCBt\nZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gLTE7CiAgICAgICAgcHVibGljIGlu\ndCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgICAgICAgaW50IHNpemUg\nPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICAgICAgICBpZiAoc2l6\nZSAhPSAtMSkgcmV0dXJuIHNpemU7CgogICAgICAgICAgICBzaXplID0gMDsK\nICAgICAgICAgICAgaWYgKGhhc0xlZGdlcklkKCkpIHsKICAgICAgICAgICAg\nICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0\ncmVhbQogICAgICAgICAgICAgICAgICAgICAgICAuY29tcHV0ZVVJbnQ2NFNp\nemUoMSwgZ2V0TGVkZ2VySWQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKGhhc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAgICAgICAg\nICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3Ry\nZWFtCiAgICAgICAgICAgICAgICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNp\nemUoMiwgZ2V0RW5kU2VxSWRJbmNsdWRlZCgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJp\nYWxpemVkU2l6ZSgpOwogICAgICAgICAgICBtZW1vaXplZFNlcmlhbGl6ZWRT\naXplID0gc2l6ZTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIHBhcnNlRnJvbSgK\nICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRh\ndGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBh\ncnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJh\nbmdlIHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYu\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBwYXJz\nZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29t\nLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRp\nb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkxlZGdlclJhbmdlIHBhcnNlRnJvbSgKICAgICAgICAgICAgYnl0\nZVtdIGRhdGEsCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0\nZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgICAgICB9\nCiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBwYXJzZUZyb20oamF2\nYS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICAgICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAg\nICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgcGFyc2VG\ncm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lz\ndHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgcGFyc2VEZWxp\nbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAg\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgICAg\nICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTGVkZ2VyUmFuZ2UgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nQnVpbGRlcigpOwogICAgICAgICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGlt\naXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2UgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNl\nZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdl\nIHBhcnNlRnJvbSgKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsKICAgICAgICAgICAgcmV0\ndXJuIEJ1aWxkZXIuY3JlYXRlKCk7CiAgICAgICAgfQogICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgewogICAgICAgICAgICBy\nZXR1cm4gbmV3QnVpbGRlcigpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMg\nc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBwcm90b3R5cGUp\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\ncHJvdG90eXBlKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIEJ1aWxkZXIg\ndG9CdWlsZGVyKCkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcih0\naGlzKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsK\nICAgICAgICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSByZXN1bHQ7CgogICAgICAg\nICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CgogICAgICAgICAg\nICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICAg\nICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBpbnRlcm5hbEdldFJl\nc3VsdCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkg\newogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlv\nbigKICAgICAgICAgICAgICAgICAgICAgICAgIkNhbm5vdCBjYWxsIGNsZWFy\nKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShyZXN1bHQpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgICAgIGdldERlc2NyaXB0b3JG\nb3JUeXBlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlLmdl\ndERlc2NyaXB0b3IoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkxlZGdlclJhbmdlIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgYnVpbGQoKSB7CiAgICAgICAgICAgICAg\nICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkgewog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNz\nYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgYnVpbGRQYXJzZWQo\nKQogICAgICAgICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9u\nKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQpLmFzSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBidWlsZFBhcnRp\nYWwoKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiYnVpbGQoKSBoYXMg\nYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSByZXR1cm5N\nZSA9IHJlc3VsdDsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IG51bGw7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmV0dXJuTWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29v\nZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICAgICAgICAg\nIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Upb3RoZXIpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBz\ndXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Ug\nb3RoZXIpIHsKICAgICAgICAgICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5n\nZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgICAgICBpZiAob3RoZXIuaGFzTGVkZ2VySWQoKSkgewogICAgICAgICAg\nICAgICAgICAgIHNldExlZGdlcklkKG90aGVyLmdldExlZGdlcklkKCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG90aGVyLmhh\nc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAgICAgICAgICAgICAgIG1l\ncmdlRW5kU2VxSWRJbmNsdWRlZChvdGhlci5nZXRFbmRTZXFJZEluY2x1ZGVk\nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5t\nZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0g\naW5wdXQsCiAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAg\nICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVs\nZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1\naWxkZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93\nbkZpZWxkcygpKTsKICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAg\nICAgICAgICAgICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsK\nICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAg\nICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgdGhp\ncy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKCFwYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVs\nZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgY2FzZSA4OiB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHNldExlZGdlcklkKGlucHV0LnJlYWRVSW50NjQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICBjYXNlIDE4OiB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZC5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlU2VxSWQubmV3QnVpbGRlcigpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoaGFzRW5kU2VxSWRJbmNsdWRlZCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRFbmRTZXFJ\nZEluY2x1ZGVkKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1aWxk\nZXIsIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgc2V0RW5kU2VxSWRJbmNsdWRlZChzdWJCdWlsZGVyLmJ1aWxkUGFydGlh\nbCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHJlcXVp\ncmVkIHVpbnQ2NCBsZWRnZXJJZCA9IDE7CiAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc0xlZGdlcklkKCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIHJlc3VsdC5oYXNMZWRnZXJJZCgpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHB1YmxpYyBsb25nIGdldExlZGdlcklkKCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIHJlc3VsdC5nZXRMZWRnZXJJZCgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldExlZGdlcklkKGxvbmcg\ndmFsdWUpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5oYXNMZWRnZXJJZCA9\nIHRydWU7CiAgICAgICAgICAgICAgICByZXN1bHQubGVkZ2VySWRfID0gdmFs\ndWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckxlZGdlcklkKCkg\newogICAgICAgICAgICAgICAgcmVzdWx0Lmhhc0xlZGdlcklkID0gZmFsc2U7\nCiAgICAgICAgICAgICAgICByZXN1bHQubGVkZ2VySWRfID0gMEw7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5NZXNzYWdlU2VxSWQgZW5kU2Vx\nSWRJbmNsdWRlZCA9IDI7CiAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc0VuZFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\ncmVzdWx0Lmhhc0VuZFNlcUlkSW5jbHVkZWQoKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIGdldEVuZFNlcUlkSW5jbHVk\nZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LmdldEVuZFNl\ncUlkSW5jbHVkZWQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJs\naWMgQnVpbGRlciBzZXRFbmRTZXFJZEluY2x1ZGVkKG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2YWx1\nZSkgewogICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRp\nb24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3Vs\ndC5oYXNFbmRTZXFJZEluY2x1ZGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nIHJlc3VsdC5lbmRTZXFJZEluY2x1ZGVkXyA9IHZhbHVlOwogICAgICAgICAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncHVibGljIEJ1aWxkZXIgc2V0RW5kU2VxSWRJbmNsdWRlZChvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQu\nQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICAgICAgICAgIHJl\nc3VsdC5oYXNFbmRTZXFJZEluY2x1ZGVkID0gdHJ1ZTsKICAgICAgICAgICAg\nICAgIHJlc3VsdC5lbmRTZXFJZEluY2x1ZGVkXyA9IGJ1aWxkZXJGb3JWYWx1\nZS5idWlsZCgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VFbmRT\nZXFJZEluY2x1ZGVkKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2YWx1ZSkgewogICAgICAgICAgICAg\nICAgaWYgKHJlc3VsdC5oYXNFbmRTZXFJZEluY2x1ZGVkKCkgJiYKICAgICAg\nICAgICAgICAgICAgICAgICAgcmVzdWx0LmVuZFNlcUlkSW5jbHVkZWRfICE9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAgICAgICAg\nICAgICAgICAgIHJlc3VsdC5lbmRTZXFJZEluY2x1ZGVkXyA9CiAgICAgICAg\nICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKHJlc3VsdC5l\nbmRTZXFJZEluY2x1ZGVkXykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRp\nYWwoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgcmVzdWx0LmVuZFNlcUlkSW5jbHVkZWRfID0gdmFsdWU7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXN1bHQuaGFzRW5kU2Vx\nSWRJbmNsdWRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgICAgICAgfQogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBj\nbGVhckVuZFNlcUlkSW5jbHVkZWQoKSB7CiAgICAgICAgICAgICAgICByZXN1\nbHQuaGFzRW5kU2VxSWRJbmNsdWRlZCA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgcmVzdWx0LmVuZFNlcUlkSW5jbHVkZWRfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdldERl\nZmF1bHRJbnN0YW5jZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEBAcHJvdG9jX2luc2Vy\ndGlvbl9wb2ludChidWlsZGVyX3Njb3BlOkhlZHdpZy5MZWRnZXJSYW5nZSkK\nICAgICAgICB9CgogICAgICAgIHN0YXRpYyB7CiAgICAgICAgICAgIGRlZmF1\nbHRJbnN0YW5jZSA9IG5ldyBMZWRnZXJSYW5nZSh0cnVlKTsKICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\naW50ZXJuYWxGb3JjZUluaXQoKTsKICAgICAgICAgICAgZGVmYXVsdEluc3Rh\nbmNlLmluaXRGaWVsZHMoKTsKICAgICAgICB9CgogICAgICAgIC8vIEBAcHJv\ndG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuTGVkZ2Vy\nUmFuZ2UpCiAgICB9CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBM\nZWRnZXJSYW5nZXMgZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAgICAgLy8gVXNlIExlZGdlclJh\nbmdlcy5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgICAgIHByaXZh\ndGUgTGVkZ2VyUmFuZ2VzKCkgewogICAgICAgICAgICBpbml0RmllbGRzKCk7\nCiAgICAgICAgfQogICAgICAgIHByaXZhdGUgTGVkZ2VyUmFuZ2VzKGJvb2xl\nYW4gbm9Jbml0KSB7fQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nZWRnZXJSYW5nZXMgZGVmYXVsdEluc3RhbmNlOwogICAgICAgIHB1YmxpYyBz\ndGF0aWMgTGVkZ2VyUmFuZ2VzIGdldERlZmF1bHRJbnN0YW5jZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyBMZWRnZXJSYW5nZXMgZ2V0RGVmYXVsdEluc3RhbmNl\nRm9yVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5j\nZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29t\nLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAg\nICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFs\nX3N0YXRpY19IZWR3aWdfTGVkZ2VyUmFuZ2VzX2Rlc2NyaXB0b3I7CiAgICAg\nICAgfQoKICAgICAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGlu\ndGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICAgICAgICBy\nZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZXNfZmllbGRB\nY2Nlc3NvclRhYmxlOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVwZWF0ZWQg\nLkhlZHdpZy5MZWRnZXJSYW5nZSByYW5nZXMgPSAxOwogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgaW50IFJBTkdFU19GSUVMRF9OVU1CRVIgPSAxOwog\nICAgICAgIHByaXZhdGUgamF2YS51dGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2U+IHJhbmdl\nc18gPQogICAgICAgICAgICBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlM\naXN0KCk7CiAgICAgICAgcHVibGljIGphdmEudXRpbC5MaXN0PG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdl\nPiBnZXRSYW5nZXNMaXN0KCkgewogICAgICAgICAgICByZXR1cm4gcmFuZ2Vz\nXzsKICAgICAgICB9CiAgICAgICAgcHVibGljIGludCBnZXRSYW5nZXNDb3Vu\ndCgpIHsKICAgICAgICAgICAgcmV0dXJuIHJhbmdlc18uc2l6ZSgpOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgZ2V0UmFuZ2VzKGludCBp\nbmRleCkgewogICAgICAgICAgICByZXR1cm4gcmFuZ2VzXy5nZXQoaW5kZXgp\nOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMo\nKSB7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBmaW5hbCBib29sZWFuIGlz\nSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgICAgIGZvciAob3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgZWxl\nbWVudCA6IGdldFJhbmdlc0xpc3QoKSkgewogICAgICAgICAgICAgICAgaWYg\nKCFlbGVtZW50LmlzSW5pdGlhbGl6ZWQoKSkgcmV0dXJuIGZhbHNlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAgICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAgZ2V0\nU2VyaWFsaXplZFNpemUoKTsKICAgICAgICAgICAgZm9yIChvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBl\nbGVtZW50IDogZ2V0UmFuZ2VzTGlzdCgpKSB7CiAgICAgICAgICAgICAgICBv\ndXRwdXQud3JpdGVNZXNzYWdlKDEsIGVsZW1lbnQpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1\ndCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIGludCBtZW1vaXplZFNl\ncmlhbGl6ZWRTaXplID0gLTE7CiAgICAgICAgcHVibGljIGludCBnZXRTZXJp\nYWxpemVkU2l6ZSgpIHsKICAgICAgICAgICAgaW50IHNpemUgPSBtZW1vaXpl\nZFNlcmlhbGl6ZWRTaXplOwogICAgICAgICAgICBpZiAoc2l6ZSAhPSAtMSkg\ncmV0dXJuIHNpemU7CgogICAgICAgICAgICBzaXplID0gMDsKICAgICAgICAg\nICAgZm9yIChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZSBlbGVtZW50IDogZ2V0UmFuZ2VzTGlzdCgpKSB7\nCiAgICAgICAgICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgICAgICAgICAgICAgICAgLmNv\nbXB1dGVNZXNzYWdlU2l6ZSgxLCBlbGVtZW50KTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJp\nYWxpemVkU2l6ZSgpOwogICAgICAgICAgICBtZW1vaXplZFNlcmlhbGl6ZWRT\naXplID0gc2l6ZTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBwYXJzZUZyb20o\nCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBk\nYXRhKQogICAgICAgICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJS\nYW5nZXMgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgp\nOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBw\nYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlcyBwYXJzZUZyb20oCiAgICAgICAgICAg\nIGJ5dGVbXSBkYXRhLAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzIHBhcnNlRnJv\nbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgICAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQo\nKTsKICAgICAgICB9CiAgICAgICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMg\ncGFyc2VGcm9tKAogICAgICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlu\ncHV0LAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lv\nblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7\nCiAgICAgICAgfQogICAgICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzIHBh\ncnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQog\nICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAg\nICAgICAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1\ndCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlcyBwYXJzZURlbGltaXRlZEZyb20oCiAg\nICAgICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICBCdWlsZGVyIGJ1aWxk\nZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgICAgICAgIGlmIChidWlsZGVyLm1l\ncmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlci5idWlsZFBhcnNlZCgp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VGcm9tKAogICAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAg\nICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5i\ndWlsZFBhcnNlZCgpOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxl\nZGdlclJhbmdlcyBwYXJzZUZyb20oCiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7CiAgICAg\nICAgICAgIHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOwogICAgICAgIH0KICAg\nICAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsKICAg\nICAgICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKTsKICAgICAgICB9CiAgICAg\nICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Vz\nIHByb3RvdHlwZSkgewogICAgICAgICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAgICAgIH0KICAgICAgICBwdWJs\naWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8\nQnVpbGRlcj4gewogICAgICAgICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyByZXN1\nbHQ7CgogICAgICAgICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Vz\nLm5ld0J1aWxkZXIoKQogICAgICAgICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7\nfQoKICAgICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUo\nKSB7CiAgICAgICAgICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVp\nbGRlcigpOwogICAgICAgICAgICAgICAgYnVpbGRlci5yZXN1bHQgPSBuZXcg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2VzKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYnVpbGRlcjsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJvdGVjdGVkIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdl\ncyBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiByZXN1bHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyKCkgewogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgIkNh\nbm5vdCBjYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5n\nZXMoKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBjcmVhdGUoKS5tZXJnZUZyb20ocmVzdWx0\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGNvbS5nb29n\nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAg\nICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICAgICAgICAgIHJl\ndHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5MZWRnZXJSYW5nZXMuZ2V0RGVzY3JpcHRvcigpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzIGdldERlZmF1bHRJbnN0\nYW5jZUZvclR5cGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFu\nZ2VzLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5pc0luaXRpYWxpemVkKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBidWls\nZCgpIHsKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCAmJiAh\naXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBidWlsZFBh\ncnRpYWwoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRn\nZXJSYW5nZXMgYnVpbGRQYXJzZWQoKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBpZiAoIWlzSW5pdGlhbGl6\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlh\nbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAg\nICByZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gYnVp\nbGRQYXJ0aWFsKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5M\nZWRnZXJSYW5nZXMgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgICAgICAgICAg\naWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAg\nICAgICAgICAgImJ1aWxkKCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQgb24g\ndGhpcyBCdWlsZGVyLiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKHJlc3VsdC5yYW5nZXNfICE9IGphdmEudXRpbC5Db2xsZWN0\naW9ucy5FTVBUWV9MSVNUKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0\nLnJhbmdlc18gPQogICAgICAgICAgICAgICAgICAgICAgICBqYXZhLnV0aWwu\nQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChyZXN1bHQucmFuZ2VzXyk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMg\ncmV0dXJuTWUgPSByZXN1bHQ7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBu\ndWxsOwogICAgICAgICAgICAgICAgcmV0dXJuIHJldHVybk1lOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20o\nY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAg\nICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMpIHsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMp\nb3RoZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBzdXBlci5tZXJnZUZyb20ob3RoZXIpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20o\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2VzIG90aGVyKSB7CiAgICAgICAgICAgICAgICBpZiAob3RoZXIg\nPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTGVkZ2VyUmFuZ2VzLmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhp\nczsKICAgICAgICAgICAgICAgIGlmICghb3RoZXIucmFuZ2VzXy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJhbmdlc18u\naXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5y\nYW5nZXNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8b3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2U+KCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJl\nc3VsdC5yYW5nZXNfLmFkZEFsbChvdGhlci5yYW5nZXNfKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMubWVyZ2VVbmtub3duRmll\nbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAg\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICAgICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1\nbmtub3duRmllbGRzID0KICAgICAgICAgICAgICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAg\nICAgICAgICAgICAgICAgICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAg\nICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAg\nICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAgICAgICAgICAg\nICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgICAgICAgICBjYXNl\nIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZp\nZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICAgICAgICBkZWZh\ndWx0OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGFyc2VVbmtu\nb3duRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVn\naXN0cnksIHRhZykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRo\naXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGNhc2UgMTA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFu\nZ2UuQnVpbGRlciBzdWJCdWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UubmV3QnVpbGRlcigp\nOwogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShz\ndWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGFkZFJhbmdlcyhzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIC8vIHJlcGVhdGVk\nIC5IZWR3aWcuTGVkZ2VyUmFuZ2UgcmFuZ2VzID0gMTsKICAgICAgICAgICAg\ncHVibGljIGphdmEudXRpbC5MaXN0PG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlPiBnZXRSYW5nZXNMaXN0\nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGphdmEudXRpbC5Db2xsZWN0\naW9ucy51bm1vZGlmaWFibGVMaXN0KHJlc3VsdC5yYW5nZXNfKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBwdWJsaWMgaW50IGdldFJhbmdlc0NvdW50\nKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRSYW5nZXND\nb3VudCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJS\nYW5nZSBnZXRSYW5nZXMoaW50IGluZGV4KSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gcmVzdWx0LmdldFJhbmdlcyhpbmRleCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmFuZ2VzKGludCBpbmRl\neCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTGVkZ2VyUmFuZ2UgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1\nZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IE51\nbGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICByZXN1bHQucmFuZ2VzXy5zZXQoaW5kZXgsIHZhbHVlKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFJhbmdlcyhpbnQgaW5kZXgs\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxl\nZGdlclJhbmdlLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAg\nICAgICAgICByZXN1bHQucmFuZ2VzXy5zZXQoaW5kZXgsIGJ1aWxkZXJGb3JW\nYWx1ZS5idWlsZCgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJh\nbmdlcyhvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5MZWRnZXJSYW5nZSB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHZh\nbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIGlmIChyZXN1bHQucmFuZ2VzXy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICAgICAgICByZXN1bHQucmFuZ2VzXyA9IG5ldyBqYXZh\nLnV0aWwuQXJyYXlMaXN0PG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLkxlZGdlclJhbmdlPigpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmVzdWx0LnJhbmdlc18uYWRkKHZhbHVlKTsK\nICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJhbmdlcyhvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZS5C\ndWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAgICAgICAgICAgaWYg\nKHJlc3VsdC5yYW5nZXNfLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAg\nICAgIHJlc3VsdC5yYW5nZXNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2U+KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXN1bHQucmFuZ2VzXy5hZGQoYnVpbGRlckZvclZhbHVlLmJ1aWxkKCkp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcHVibGljIEJ1aWxkZXIgYWRkQWxsUmFuZ2VzKAogICAg\nICAgICAgICAgICAgamF2YS5sYW5nLkl0ZXJhYmxlPD8gZXh0ZW5kcyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJS\nYW5nZT4gdmFsdWVzKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnJh\nbmdlc18uaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0\nLnJhbmdlc18gPSBuZXcgamF2YS51dGlsLkFycmF5TGlzdDxvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZT4o\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN1cGVyLmFk\nZEFsbCh2YWx1ZXMsIHJlc3VsdC5yYW5nZXNfKTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyUmFuZ2VzKCkgewogICAgICAgICAgICAgICAgcmVz\ndWx0LnJhbmdlc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlMaXN0\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1\naWxkZXJfc2NvcGU6SGVkd2lnLkxlZGdlclJhbmdlcykKICAgICAgICB9Cgog\nICAgICAgIHN0YXRpYyB7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZSA9\nIG5ldyBMZWRnZXJSYW5nZXModHJ1ZSk7CiAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9y\nY2VJbml0KCk7CiAgICAgICAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0Rmll\nbGRzKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBAQHByb3RvY19pbnNlcnRp\nb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLkxlZGdlclJhbmdlcykKICAg\nIH0KCiAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfTWVzc2FnZV9kZXNjcmlwdG9yOwogICAgcHJpdmF0ZSBzdGF0aWMKICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2Fn\nZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICBwcml2YXRlIHN0YXRpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfUmVnaW9uU3BlY2lmaWNTZXFJZF9kZXNj\ncmlwdG9yOwogICAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfUmVnaW9uU3BlY2lmaWNTZXFJZF9m\naWVsZEFjY2Vzc29yVGFibGU7CiAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZVNlcUlkX2Rlc2NyaXB0b3I7CiAg\nICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgaW50ZXJuYWxf\nc3RhdGljX0hlZHdpZ19NZXNzYWdlU2VxSWRfZmllbGRBY2Nlc3NvclRhYmxl\nOwogICAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1B1YlN1YlJlcXVlc3RfZGVzY3JpcHRvcjsKICAgIHByaXZhdGUgc3RhdGlj\nCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmll\nbGRBY2Nlc3NvclRhYmxlCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1\nYlN1YlJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgcHJpdmF0ZSBz\ndGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlw\ndG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0\nX2Rlc2NyaXB0b3I7CiAgICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJs\nZQogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVzdF9m\naWVsZEFjY2Vzc29yVGFibGU7CiAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaWJlUmVxdWVzdF9kZXNjcmlwdG9y\nOwogICAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaWJlUmVxdWVzdF9maWVsZEFjY2Vz\nc29yVGFibGU7CiAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRp\nY19IZWR3aWdfQ29uc3VtZVJlcXVlc3RfZGVzY3JpcHRvcjsKICAgIHByaXZh\ndGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICBpbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX0NvbnN1bWVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAg\nIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRv\ncnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19VbnN1\nYnNjcmliZVJlcXVlc3RfZGVzY3JpcHRvcjsKICAgIHByaXZhdGUgc3RhdGlj\nCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmll\nbGRBY2Nlc3NvclRhYmxlCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1Vu\nc3Vic2NyaWJlUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICBwcml2\nYXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRl\nc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2\nZXJ5UmVxdWVzdF9kZXNjcmlwdG9yOwogICAgcHJpdmF0ZSBzdGF0aWMKICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERl\nbGl2ZXJ5UmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICBwcml2YXRl\nIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2Ny\naXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RhcnREZWxpdmVy\neVJlcXVlc3RfZGVzY3JpcHRvcjsKICAgIHByaXZhdGUgc3RhdGljCiAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nl\nc3NvclRhYmxlCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N0YXJ0RGVs\naXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIHByaXZhdGUg\nc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3Jp\ncHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJTdWJSZXNwb25z\nZV9kZXNjcmlwdG9yOwogICAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFi\nbGUKICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHViU3ViUmVzcG9uc2Vf\nZmllbGRBY2Nlc3NvclRhYmxlOwogICAgcHJpdmF0ZSBzdGF0aWMgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvblN0YXRlX2Rlc2NyaXB0\nb3I7CiAgICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25TdGF0ZV9maWVsZEFj\nY2Vzc29yVGFibGU7CiAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0\nYXRpY19IZWR3aWdfTGVkZ2VyUmFuZ2VfZGVzY3JpcHRvcjsKICAgIHByaXZh\ndGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICBpbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX0xlZGdlclJhbmdlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIHBy\naXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMu\nRGVzY3JpcHRvcgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJS\nYW5nZXNfZGVzY3JpcHRvcjsKICAgIHByaXZhdGUgc3RhdGljCiAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3Nv\nclRhYmxlCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0xlZGdlclJhbmdl\nc19maWVsZEFjY2Vzc29yVGFibGU7CgogICAgcHVibGljIHN0YXRpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yCiAg\nICBnZXREZXNjcmlwdG9yKCkgewogICAgICAgIHJldHVybiBkZXNjcmlwdG9y\nOwogICAgfQogICAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5GaWxlRGVzY3JpcHRvcgogICAgZGVzY3JpcHRvcjsK\nICAgIHN0YXRpYyB7CiAgICAgICAgamF2YS5sYW5nLlN0cmluZ1tdIGRlc2Ny\naXB0b3JEYXRhID0gewogICAgICAgICAgICAiXG4mc3JjL21haW4vcHJvdG9i\ndWYvUHViU3ViUHJvdG9jb2wucHJvdG8iICsKICAgICAgICAgICAgIlwwMjJc\nMDA2SGVkd2lnXCJPXG5cMDA3TWVzc2FnZVwwMjJcMDE0XG5cMDA0Ym9keVww\nMzBcMDAxIFwwMDIoXDAxNFwwMjJcMDIxXG5cdHNyYyIgKwogICAgICAgICAg\nICAiUmVnaW9uXDAzMFwwMDIgXDAwMShcMDE0XDAyMiNcblwwMDVtc2dJZFww\nMzBcMDAzIFwwMDEoXDAxMzJcMDI0LkhlZHdpZy5NZXMiICsKICAgICAgICAg\nICAgInNhZ2VTZXFJZFwiNFxuXDAyM1JlZ2lvblNwZWNpZmljU2VxSWRcMDIy\nXDAxNlxuXDAwNnJlZ2kiICsKICAgICAgICAgICAgIm9uXDAzMFwwMDEgXDAw\nMihcMDE0XDAyMlxyXG5cMDA1c2VxSWRcMDMwXDAwMiBcMDAyKFwwMDRcIl1c\nblwwMTRNZXNzYWdlU2VxSWRcMDIyIiArCiAgICAgICAgICAgICJcMDI2XG5c\nMDE2bG9jYWxDb21wb25lbnRcMDMwXDAwMSBcMDAxKFwwMDRcMDIyNVxuXDAy\nMHJlbW90ZUNvbXBvbmUiICsKICAgICAgICAgICAgIm50c1wwMzBcMDAyIFww\nMDMoXDAxMzJcMDMzLkhlZHdpZy5SZWdpb25TcGVjaWZpY1NlcUlkXCJcMzYx\nIiArCiAgICAgICAgICAgICJcMDAzXG5cclB1YlN1YlJlcXVlc3RcMDIyMFxu\nXDAxN3Byb3RvY29sVmVyc2lvblwwMzBcMDAxIFwwMDIoIiArCiAgICAgICAg\nICAgICJcMDE2MlwwMjcuSGVkd2lnLlByb3RvY29sVmVyc2lvblwwMjIjXG5c\nMDA0dHlwZVwwMzBcMDAyIFwwMDIoXDAxNiIgKwogICAgICAgICAgICAiMlww\nMjUuSGVkd2lnLk9wZXJhdGlvblR5cGVcMDIyXDAyNFxuXDAxNHRyaWVkU2Vy\ndmVyc1wwMzAiLAogICAgICAgICAgICAiXDAwMyBcMDAzKFwwMTRcMDIyXHJc\nblwwMDV0eG5JZFwwMzBcMDA0IFwwMDIoXDAwNFwwMjJcMDIzXG5cMDEzc2hv\ndWxkQ2xhaW1cMDMwXDAwNSBcMDAxKCIgKwogICAgICAgICAgICAiXDAxMFww\nMjJcclxuXDAwNXRvcGljXDAzMFwwMDYgXDAwMihcMDE0XDAyMi5cblwwMTZw\ndWJsaXNoUmVxdWVzdFwwMzA0IFwwMDEoXDAxMyIgKwogICAgICAgICAgICAi\nMlwwMjYuSGVkd2lnLlB1Ymxpc2hSZXF1ZXN0XDAyMjJcblwwMjBzdWJzY3Jp\nYmVSZXEiICsKICAgICAgICAgICAgInVlc3RcMDMwNSBcMDAxKFwwMTMyXDAz\nMC5IZWR3aWcuU3Vic2NyaWJlUmVxdWVzdFwwMjIuXG5cMDE2IiArCiAgICAg\nICAgICAgICJjb25zdW1lUmVxdWVzdFwwMzA2IFwwMDEoXDAxMzJcMDI2Lkhl\nZHdpZy5Db25zdW1lUmVxIiArCiAgICAgICAgICAgICJ1ZXN0XDAyMjZcblww\nMjJ1bnN1YnNjcmliZVJlcXVlc3RcMDMwNyBcMDAxKFwwMTMyXDAzMi5IZWR3\naSIgKwogICAgICAgICAgICAiZy5VbnN1YnNjcmliZVJlcXVlc3RcMDIyOFxu\nXDAyM3N0b3BEZWxpdmVyeVJlcXUiICsKICAgICAgICAgICAgImVzdFwwMzA4\nIFwwMDEoXDAxMzJcMDMzLkhlZHdpZy5TdG9wRGVsaXZlcnlSZXF1ZXN0XDAy\nMjoiICsKICAgICAgICAgICAgIlxuXDAyNHN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nXDAzMDkgXDAwMShcMDEzMlwwMzQuSGVkd2lnLlN0IiArCiAgICAgICAgICAg\nICJhcnREZWxpdmVyeVJlcXVlc3RcIi5cblwwMTZQdWJsaXNoUmVxdWVzdFww\nMjJcMDM0XG5cMDAzIiwKICAgICAgICAgICAgIm1zZ1wwMzBcMDAyIFwwMDIo\nXDAxMzJcMDE3LkhlZHdpZy5NZXNzYWdlXCJcMzI3XDAwMVxuXDAyMFN1YnNj\ncmliZSIgKwogICAgICAgICAgICAiUmVxdWVzdFwwMjJcMDI0XG5cMDE0c3Vi\nc2NyaWJlcklkXDAzMFwwMDIgXDAwMihcMDE0XDAyMlFcblwwMTZjcmVhdGVP\nIiArCiAgICAgICAgICAgICJyQXR0YWNoXDAzMFwwMDMgXDAwMShcMDE2Mlwn\nLkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0LiIgKwogICAgICAgICAgICAiQ3Jl\nYXRlT3JBdHRhY2g6XDAyMENSRUFURV9PUl9BVFRBQ0hcMDIyXDAzMlxuXDAx\nM3N5bmMiICsKICAgICAgICAgICAgImhyb25vdXNcMDMwXDAwNCBcMDAxKFww\nMTA6XDAwNWZhbHNlXCI+XG5cMDE2Q3JlYXRlT3JBdHRhY2hcMDIyXG4iICsK\nICAgICAgICAgICAgIlxuXDAwNkNSRUFURVwwMjBcMDAwXDAyMlxuXG5cMDA2\nQVRUQUNIXDAyMFwwMDFcMDIyXDAyNFxuXDAyMENSRUFURV9PUl9BVFRBIiAr\nCiAgICAgICAgICAgICJDSFwwMjBcMDAyXCJLXG5cMDE2Q29uc3VtZVJlcXVl\nc3RcMDIyXDAyNFxuXDAxNHN1YnNjcmliZXJJZFwwMzBcMDAyIiArCiAgICAg\nICAgICAgICIgXDAwMihcMDE0XDAyMiNcblwwMDVtc2dJZFwwMzBcMDAzIFww\nMDIoXDAxMzJcMDI0LkhlZHdpZy5NZXNzYWdlU2VxSSIgKwogICAgICAgICAg\nICAiZFwiKlxuXDAyMlVuc3Vic2NyaWJlUmVxdWVzdFwwMjJcMDI0XG5cMDE0\nc3Vic2NyaWJlcklkXDAzMCIgKwogICAgICAgICAgICAiXDAwMiBcMDAyKFww\nMTRcIitcblwwMjNTdG9wRGVsaXZlcnlSZXF1ZXN0XDAyMlwwMjRcblwwMTRz\ndWJzY3JpYiIsCiAgICAgICAgICAgICJlcklkXDAzMFwwMDIgXDAwMihcMDE0\nXCIsXG5cMDI0U3RhcnREZWxpdmVyeVJlcXVlc3RcMDIyXDAyNFxuXDAxNHN1\nIiArCiAgICAgICAgICAgICJic2NyaWJlcklkXDAzMFwwMDIgXDAwMihcMDE0\nXCJcMzIzXDAwMVxuXDAxNlB1YlN1YlJlc3BvbnNlXDAyMjBcblwwMTdwIiAr\nCiAgICAgICAgICAgICJyb3RvY29sVmVyc2lvblwwMzBcMDAxIFwwMDIoXDAx\nNjJcMDI3LkhlZHdpZy5Qcm90b2NvbFZlIiArCiAgICAgICAgICAgICJyc2lv\nblwwMjImXG5cbnN0YXR1c0NvZGVcMDMwXDAwMiBcMDAyKFwwMTYyXDAyMi5I\nZWR3aWcuU3RhdHUiICsKICAgICAgICAgICAgInNDb2RlXDAyMlxyXG5cMDA1\ndHhuSWRcMDMwXDAwMyBcMDAyKFwwMDRcMDIyXDAyMVxuXHRzdGF0dXNNc2dc\nMDMwXDAwNCBcMDAxKFx0XDAyMiIgKwogICAgICAgICAgICAiIFxuXDAwN21l\nc3NhZ2VcMDMwXDAwNSBcMDAxKFwwMTMyXDAxNy5IZWR3aWcuTWVzc2FnZVww\nMjJcclxuXDAwNXRvcCIgKwogICAgICAgICAgICAiaWNcMDMwXDAwNiBcMDAx\nKFwwMTRcMDIyXDAyNFxuXDAxNHN1YnNjcmliZXJJZFwwMzBcMDA3IFwwMDEo\nXDAxNFwiOFxuXDAyMVN1YnNjciIgKwogICAgICAgICAgICAiaXB0aW9uU3Rh\ndGVcMDIyI1xuXDAwNW1zZ0lkXDAzMFwwMDEgXDAwMihcMDEzMlwwMjQuSGVk\nd2lnLk1lc3MiICsKICAgICAgICAgICAgImFnZVNlcUlkXCJPXG5cMDEzTGVk\nZ2VyUmFuZ2VcMDIyXDAyMFxuXDAxMGxlZGdlcklkXDAzMFwwMDEgXDAwMigi\nICsKICAgICAgICAgICAgIlwwMDRcMDIyLlxuXDAyMGVuZFNlcUlkSW5jbHVk\nZWRcMDMwXDAwMiBcMDAxKFwwMTMyXDAyNC5IZWR3aWcuTWVzIiwKICAgICAg\nICAgICAgInNhZ2VTZXFJZFwiM1xuXDAxNExlZGdlclJhbmdlc1wwMjIjXG5c\nMDA2cmFuZ2VzXDAzMFwwMDEgXDAwMygiICsKICAgICAgICAgICAgIlwwMTMy\nXDAyMy5IZWR3aWcuTGVkZ2VyUmFuZ2UqXCJcblwwMTdQcm90b2NvbFZlcnNp\nbyIgKwogICAgICAgICAgICAiblwwMjJcMDE3XG5cMDEzVkVSU0lPTl9PTkVc\nMDIwXDAwMSpwXG5cck9wZXJhdGlvblR5cGVcMDIyXDAxM1xuXDAwN1AiICsK\nICAgICAgICAgICAgIlVCTElTSFwwMjBcMDAwXDAyMlxyXG5cdFNVQlNDUklC\nRVwwMjBcMDAxXDAyMlwwMTNcblwwMDdDT05TVU1FXDAyMFwwMDJcMDIyXDAx\nN1xuXDAxMyIgKwogICAgICAgICAgICAiVU5TVUJTQ1JJQkVcMDIwXDAwM1ww\nMjJcMDIyXG5cMDE2U1RBUlRfREVMSVZFUllcMDIwXDAwNFwwMjJcMDIxXG5c\nclNUTyIgKwogICAgICAgICAgICAiUF9ERUxJVkVSWVwwMjBcMDA1KlwyMzZc\nMDAyXG5cblN0YXR1c0NvZGVcMDIyXDAxM1xuXDAwN1NVQ0NFU1NcMDIwXDAw\nMCIgKwogICAgICAgICAgICAiXDAyMlwwMjZcblwwMjFNQUxGT1JNRURfUkVR\nVUVTVFwwMjBcMjIxXDAwM1wwMjJcMDIyXG5cck5PX1NVQ0hfVE9QSSIgKwog\nICAgICAgICAgICAiQ1wwMjBcMjIyXDAwM1wwMjJcMDM2XG5cMDMxQ0xJRU5U\nX0FMUkVBRFlfU1VCU0NSSUJFRFwwMjBcMjIzXDAwM1wwMjJcMDMyXG5cMDI1\nIiArCiAgICAgICAgICAgICJDTElFTlRfTk9UX1NVQlNDUklCRURcMDIwXDIy\nNFwwMDNcMDIyXDAyNlxuXDAyMUNPVUxEX05PVF9DTyIgKwogICAgICAgICAg\nICAiTk5FQ1RcMDIwXDIyNVwwMDNcMDIyXDAxN1xuXG5UT1BJQ19CVVNZXDAy\nMFwyMjZcMDAzXDAyMlwwMzZcblwwMzFOT1RfUkVTUE9OUyIsCiAgICAgICAg\nICAgICJJQkxFX0ZPUl9UT1BJQ1wwMjBcMzY1XDAwM1wwMjJcMDIxXG5cMDE0\nU0VSVklDRV9ET1dOXDAyMFwzNjZcMDAzXDAyMlwwMjRcblwwMTciICsKICAg\nICAgICAgICAgIlVOQ0VSVEFJTl9TVEFURVwwMjBcMzY3XDAwM1wwMjJcMDMx\nXG5cMDI0VU5FWFBFQ1RFRF9DT05ESVRJIiArCiAgICAgICAgICAgICJPTlww\nMjBcMzMwXDAwNFwwMjJcMDE2XG5cdENPTVBPU0lURVwwMjBcMjc0XDAwNUJc\nMDM2XG5cMDMyb3JnLmFwYWNoZS5oZWR3IiArCiAgICAgICAgICAgICJpZy5w\ncm90b2NvbEhcMDAxIgogICAgICAgIH07CiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5EZXNjcmlwdG9ycy5GaWxlRGVzY3JpcHRvci5JbnRlcm5hbERl\nc2NyaXB0b3JBc3NpZ25lciBhc3NpZ25lciA9CiAgICAgICAgbmV3IGNvbS5n\nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3IuSW50\nZXJuYWxEZXNjcmlwdG9yQXNzaWduZXIoKSB7CiAgICAgICAgICAgIHB1Ymxp\nYyBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5IGFzc2ln\nbkRlc2NyaXB0b3JzKAogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yIHJvb3QpIHsKICAgICAgICAg\nICAgICAgIGRlc2NyaXB0b3IgPSByb290OwogICAgICAgICAgICAgICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNzYWdlX2Rlc2NyaXB0b3IgPQogICAg\nICAgICAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlw\nZXMoKS5nZXQoMCk7CiAgICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX01lc3NhZ2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAg\nICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAgICAgICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZV9kZXNjcmlwdG9yLAogICAg\nICAgICAgICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiQm9k\neSIsICJTcmNSZWdpb24iLCAiTXNnSWQiLCB9LAogICAgICAgICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5CdWls\nZGVyLmNsYXNzKTsKICAgICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19I\nZWR3aWdfUmVnaW9uU3BlY2lmaWNTZXFJZF9kZXNjcmlwdG9yID0KICAgICAg\nICAgICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVz\nKCkuZ2V0KDEpOwogICAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19SZWdpb25TcGVjaWZpY1NlcUlkX2ZpZWxkQWNjZXNzb3JUYWJsZSA9\nIG5ldwogICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAg\nICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1JlZ2lvblNwZWNpZmlj\nU2VxSWRfZGVzY3JpcHRvciwKICAgICAgICAgICAgICAgICAgICBuZXcgamF2\nYS5sYW5nLlN0cmluZ1tdIHsgIlJlZ2lvbiIsICJTZXFJZCIsIH0sCiAgICAg\nICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZC5jbGFzcywKICAgICAg\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLkJ1aWxkZXIuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNz\nYWdlU2VxSWRfZGVzY3JpcHRvciA9CiAgICAgICAgICAgICAgICAgICAgZ2V0\nRGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCgyKTsKICAgICAg\nICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWVzc2FnZVNlcUlk\nX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldwogICAgICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZSgKICAgICAgICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX01lc3NhZ2VTZXFJZF9kZXNjcmlwdG9yLAogICAgICAgICAgICAg\nICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiTG9jYWxDb21wb25l\nbnQiLCAiUmVtb3RlQ29tcG9uZW50cyIsIH0sCiAgICAgICAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZVNlcUlkLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VT\nZXFJZC5CdWlsZGVyLmNsYXNzKTsKICAgICAgICAgICAgICAgIGludGVybmFs\nX3N0YXRpY19IZWR3aWdfUHViU3ViUmVxdWVzdF9kZXNjcmlwdG9yID0KICAg\nICAgICAgICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5\ncGVzKCkuZ2V0KDMpOwogICAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGlj\nX0hlZHdpZ19QdWJTdWJSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5l\ndwogICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAgICAg\nICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlcXVlc3RfZGVz\nY3JpcHRvciwKICAgICAgICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0\ncmluZ1tdIHsgIlByb3RvY29sVmVyc2lvbiIsICJUeXBlIiwgIlRyaWVkU2Vy\ndmVycyIsICJUeG5JZCIsICJTaG91bGRDbGFpbSIsICJUb3BpYyIsICJQdWJs\naXNoUmVxdWVzdCIsICJTdWJzY3JpYmVSZXF1ZXN0IiwgIkNvbnN1bWVSZXF1\nZXN0IiwgIlVuc3Vic2NyaWJlUmVxdWVzdCIsICJTdG9wRGVsaXZlcnlSZXF1\nZXN0IiwgIlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IiwgfSwKICAgICAgICAgICAg\nICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5QdWJTdWJSZXF1ZXN0LmNsYXNzLAogICAgICAgICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1\nYlN1YlJlcXVlc3QuQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICAgICAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0X2Rlc2NyaXB0\nb3IgPQogICAgICAgICAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRN\nZXNzYWdlVHlwZXMoKS5nZXQoNCk7CiAgICAgICAgICAgICAgICBpbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JU\nYWJsZSA9IG5ldwogICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAg\nICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1Ymxpc2hS\nZXF1ZXN0X2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgICAgICAgbmV3IGph\ndmEubGFuZy5TdHJpbmdbXSB7ICJNc2ciLCB9LAogICAgICAgICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1Ymxpc2hSZXF1ZXN0LmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxp\nc2hSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAgICAgICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0\nb3IgPQogICAgICAgICAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRN\nZXNzYWdlVHlwZXMoKS5nZXQoNSk7CiAgICAgICAgICAgICAgICBpbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmliZVJlcXVlc3RfZmllbGRBY2Nlc3Nv\nclRhYmxlID0gbmV3CiAgICAgICAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAg\nICAgICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2Ny\naWJlUmVxdWVzdF9kZXNjcmlwdG9yLAogICAgICAgICAgICAgICAgICAgIG5l\ndyBqYXZhLmxhbmcuU3RyaW5nW10geyAiU3Vic2NyaWJlcklkIiwgIkNyZWF0\nZU9yQXR0YWNoIiwgIlN5bmNocm9ub3VzIiwgfSwKICAgICAgICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpYmVSZXF1ZXN0LmNsYXNzLAogICAgICAgICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmliZVJlcXVlc3QuQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICAgICAg\nICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0NvbnN1bWVSZXF1ZXN0X2Rlc2Ny\naXB0b3IgPQogICAgICAgICAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5n\nZXRNZXNzYWdlVHlwZXMoKS5nZXQoNik7CiAgICAgICAgICAgICAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX0NvbnN1bWVSZXF1ZXN0X2ZpZWxkQWNjZXNz\nb3JUYWJsZSA9IG5ldwogICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAg\nICAgICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0NvbnN1\nbWVSZXF1ZXN0X2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgICAgICAgbmV3\nIGphdmEubGFuZy5TdHJpbmdbXSB7ICJTdWJzY3JpYmVySWQiLCAiTXNnSWQi\nLCB9LAogICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LmNsYXNzLAog\nICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LkJ1aWxkZXIuY2xhc3Mp\nOwogICAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19VbnN1\nYnNjcmliZVJlcXVlc3RfZGVzY3JpcHRvciA9CiAgICAgICAgICAgICAgICAg\nICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg3KTsK\nICAgICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfVW5zdWJz\nY3JpYmVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5ldwogICAgICAg\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAgICAgICAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX1Vuc3Vic2NyaWJlUmVxdWVzdF9kZXNjcmlw\ndG9yLAogICAgICAgICAgICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5n\nW10geyAiU3Vic2NyaWJlcklkIiwgfSwKICAgICAgICAgICAgICAgICAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1\nYnNjcmliZVJlcXVlc3QuY2xhc3MsCiAgICAgICAgICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJz\nY3JpYmVSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAgICAgICAg\naW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdG9wRGVsaXZlcnlSZXF1ZXN0X2Rl\nc2NyaXB0b3IgPQogICAgICAgICAgICAgICAgICAgIGdldERlc2NyaXB0b3Io\nKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoOCk7CiAgICAgICAgICAgICAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N0b3BEZWxpdmVyeVJlcXVlc3RfZmll\nbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRh\nYmxlKAogICAgICAgICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfU3RvcERlbGl2ZXJ5UmVxdWVzdF9kZXNjcmlwdG9yLAogICAgICAgICAg\nICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiU3Vic2NyaWJl\ncklkIiwgfSwKICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0\nLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3Qu\nQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1N0YXJ0RGVsaXZlcnlSZXF1ZXN0X2Rlc2NyaXB0b3IgPQog\nICAgICAgICAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdl\nVHlwZXMoKS5nZXQoOSk7CiAgICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1N0YXJ0RGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JU\nYWJsZSA9IG5ldwogICAgICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAg\nICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N0YXJ0RGVs\naXZlcnlSZXF1ZXN0X2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgICAgICAg\nbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJTdWJzY3JpYmVySWQiLCB9LAog\nICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LmNsYXNzLAog\nICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIu\nY2xhc3MpOwogICAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19QdWJTdWJSZXNwb25zZV9kZXNjcmlwdG9yID0KICAgICAgICAgICAgICAg\nICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDEw\nKTsKICAgICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHVi\nU3ViUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAgICAgICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfUHViU3ViUmVzcG9uc2VfZGVzY3JpcHRvciwK\nICAgICAgICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsg\nIlByb3RvY29sVmVyc2lvbiIsICJTdGF0dXNDb2RlIiwgIlR4bklkIiwgIlN0\nYXR1c01zZyIsICJNZXNzYWdlIiwgIlRvcGljIiwgIlN1YnNjcmliZXJJZCIs\nIH0sCiAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UuY2xhc3MsCiAg\nICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UuQnVpbGRlci5jbGFzcyk7\nCiAgICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNj\ncmlwdGlvblN0YXRlX2Rlc2NyaXB0b3IgPQogICAgICAgICAgICAgICAgICAg\nIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTEpOwog\nICAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3Jp\ncHRpb25TdGF0ZV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAg\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5G\naWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAgICAgICAgaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25TdGF0ZV9kZXNjcmlwdG9y\nLAogICAgICAgICAgICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10g\neyAiTXNnSWQiLCB9LAogICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0\nYXRlLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRl\nLkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAgICAgICAgaW50ZXJuYWxfc3Rh\ndGljX0hlZHdpZ19MZWRnZXJSYW5nZV9kZXNjcmlwdG9yID0KICAgICAgICAg\nICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCku\nZ2V0KDEyKTsKICAgICAgICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfTGVkZ2VyUmFuZ2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAg\nICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAgICAgICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfTGVkZ2VyUmFuZ2VfZGVzY3JpcHRvciwK\nICAgICAgICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsg\nIkxlZGdlcklkIiwgIkVuZFNlcUlkSW5jbHVkZWQiLCB9LAogICAgICAgICAg\nICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkxlZGdlclJhbmdlLmNsYXNzLAogICAgICAgICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxl\nZGdlclJhbmdlLkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAgICAgICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZXNfZGVzY3JpcHRvciA9\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1lc3Nh\nZ2VUeXBlcygpLmdldCgxMyk7CiAgICAgICAgICAgICAgICBpbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX0xlZGdlclJhbmdlc19maWVsZEFjY2Vzc29yVGFibGUg\nPSBuZXcKICAgICAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAg\nICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZXNf\nZGVzY3JpcHRvciwKICAgICAgICAgICAgICAgICAgICBuZXcgamF2YS5sYW5n\nLlN0cmluZ1tdIHsgIlJhbmdlcyIsIH0sCiAgICAgICAgICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2VzLmNsYXNzLAogICAgICAgICAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdl\ncy5CdWlsZGVyLmNsYXNzKTsKICAgICAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yCiAgICAgICAg\nLmludGVybmFsQnVpbGRHZW5lcmF0ZWRGaWxlRnJvbShkZXNjcmlwdG9yRGF0\nYSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlw\ndG9yW10gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfSwgYXNzaWduZXIpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBpbnRlcm5hbEZvcmNlSW5pdCgpIHt9CgogICAgLy8gQEBwcm90b2NfaW5z\nZXJ0aW9uX3BvaW50KG91dGVyX2NsYXNzX3Njb3BlKQp9Cg==\n","encoding":"base64"}

