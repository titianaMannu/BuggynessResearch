{"sha":"9ceec26e1cdda6b5c876d8f05e37ef52031f5a4f","node_id":"MDQ6QmxvYjE1NzU5NTY6OWNlZWMyNmUxY2RkYTZiNWM4NzZkOGYwNWUzN2VmNTIwMzFmNWE0Zg==","size":5343,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9ceec26e1cdda6b5c876d8f05e37ef52031f5a4f","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2V4dGVuc2lvbnM7CgppbXBv\ncnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsK\naW1wb3J0IGphdmEudXRpbC5NYXA7CgppbXBvcnQgY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLlVuZXhwZWN0\nZWRDb25kaXRpb25FeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5S\nZWdpb25TcGVjaWZpY1NlcUlkOwoKcHVibGljIGNsYXNzIE1lc3NhZ2VJZFV0\naWxzIHsKCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBtc2dJZFRvUmVhZGFi\nbGVTdHJpbmcoTWVzc2FnZVNlcUlkIHNlcUlkKSB7CiAgICAgICAgU3RyaW5n\nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgc2Iu\nYXBwZW5kKCJsb2NhbDoiKTsKICAgICAgICBzYi5hcHBlbmQoc2VxSWQuZ2V0\nTG9jYWxDb21wb25lbnQoKSk7CgogICAgICAgIFN0cmluZyBzZXBhcmF0b3Ig\nPSAiOyI7CiAgICAgICAgZm9yIChSZWdpb25TcGVjaWZpY1NlcUlkIHJlZ2lv\nbklkIDogc2VxSWQuZ2V0UmVtb3RlQ29tcG9uZW50c0xpc3QoKSkgewogICAg\nICAgICAgICBzYi5hcHBlbmQoc2VwYXJhdG9yKTsKICAgICAgICAgICAgc2Iu\nYXBwZW5kKHJlZ2lvbklkLmdldFJlZ2lvbigpLnRvU3RyaW5nVXRmOCgpKTsK\nICAgICAgICAgICAgc2IuYXBwZW5kKCc6Jyk7CiAgICAgICAgICAgIHNiLmFw\ncGVuZChyZWdpb25JZC5nZXRTZXFJZCgpKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHVibGljIHN0YXRp\nYyBNYXA8Qnl0ZVN0cmluZywgUmVnaW9uU3BlY2lmaWNTZXFJZD4gaW5NYXBG\nb3JtKE1lc3NhZ2VTZXFJZCBtc2kpIHsKICAgICAgICBNYXA8Qnl0ZVN0cmlu\nZywgUmVnaW9uU3BlY2lmaWNTZXFJZD4gbWFwID0gbmV3IEhhc2hNYXA8Qnl0\nZVN0cmluZywgUmVnaW9uU3BlY2lmaWNTZXFJZD4oKTsKCiAgICAgICAgZm9y\nIChSZWdpb25TcGVjaWZpY1NlcUlkIGxtc2lkIDogbXNpLmdldFJlbW90ZUNv\nbXBvbmVudHNMaXN0KCkpIHsKICAgICAgICAgICAgbWFwLnB1dChsbXNpZC5n\nZXRSZWdpb24oKSwgbG1zaWQpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJu\nIG1hcDsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gYXJlRXF1\nYWwoTWVzc2FnZVNlcUlkIG0xLCBNZXNzYWdlU2VxSWQgbTIpIHsKCiAgICAg\nICAgaWYgKG0xLmdldExvY2FsQ29tcG9uZW50KCkgIT0gbTIuZ2V0TG9jYWxD\nb21wb25lbnQoKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQoKICAgICAgICBpZiAobTEuZ2V0UmVtb3RlQ29tcG9uZW50c0NvdW50\nKCkgIT0gbTIuZ2V0UmVtb3RlQ29tcG9uZW50c0NvdW50KCkpIHsKICAgICAg\nICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgTWFwPEJ5\ndGVTdHJpbmcsIFJlZ2lvblNwZWNpZmljU2VxSWQ+IG0ybWFwID0gaW5NYXBG\nb3JtKG0yKTsKCiAgICAgICAgZm9yIChSZWdpb25TcGVjaWZpY1NlcUlkIGxt\nc2lkMSA6IG0xLmdldFJlbW90ZUNvbXBvbmVudHNMaXN0KCkpIHsKICAgICAg\nICAgICAgUmVnaW9uU3BlY2lmaWNTZXFJZCBsbXNpZDIgPSBtMm1hcC5nZXQo\nbG1zaWQxLmdldFJlZ2lvbigpKTsKICAgICAgICAgICAgaWYgKGxtc2lkMiA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKGxtc2lkMS5nZXRTZXFJZCgpICE9\nIGxtc2lkMi5nZXRTZXFJZCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVy\nbiB0cnVlOwoKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIE1lc3NhZ2UgbWVy\nZ2VMb2NhbFNlcUlkKE1lc3NhZ2UuQnVpbGRlciBtZXNzYWdlQnVpbGRlciwg\nbG9uZyBsb2NhbFNlcUlkKSB7CiAgICAgICAgTWVzc2FnZVNlcUlkLkJ1aWxk\nZXIgbXNpZEJ1aWxkZXIgPSBNZXNzYWdlU2VxSWQubmV3QnVpbGRlcihtZXNz\nYWdlQnVpbGRlci5nZXRNc2dJZCgpKTsKICAgICAgICBtc2lkQnVpbGRlci5z\nZXRMb2NhbENvbXBvbmVudChsb2NhbFNlcUlkKTsKICAgICAgICBtZXNzYWdl\nQnVpbGRlci5zZXRNc2dJZChtc2lkQnVpbGRlcik7CiAgICAgICAgcmV0dXJu\nIG1lc3NhZ2VCdWlsZGVyLmJ1aWxkKCk7CiAgICB9CgogICAgcHVibGljIHN0\nYXRpYyBNZXNzYWdlIG1lcmdlTG9jYWxTZXFJZChNZXNzYWdlIG9yZ2luYWxN\nZXNzYWdlLCBsb25nIGxvY2FsU2VxSWQpIHsKICAgICAgICByZXR1cm4gbWVy\nZ2VMb2NhbFNlcUlkKE1lc3NhZ2UubmV3QnVpbGRlcihvcmdpbmFsTWVzc2Fn\nZSksIGxvY2FsU2VxSWQpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFy\nZXMgdHdvIHNlcSBudW1iZXJzIHJlcHJlc2VudGVkIGFzIGxpc3RzIG9mIGxv\nbmdzLgogICAgICoKICAgICAqIEBwYXJhbSBsMQogICAgICogQHBhcmFtIGwy\nCiAgICAgKiBAcmV0dXJuIDEgaWYgdGhlIGwxIGlzIGdyZWF0ZXIsIDAgaWYg\ndGhleSBhcmUgZXF1YWwsIC0xIGlmIGwyIGlzIGdyZWF0ZXIKICAgICAqIEB0\naHJvd3MgVW5leHBlY3RlZENvbmRpdGlvbkV4Y2VwdGlvbgogICAgICogICAg\nICAgICAgICAgSWYgdGhlIGxpc3RzIGFyZSBvZiB1bmVxdWFsIGxlbmd0aAog\nICAgICovCiAgICBwdWJsaWMgc3RhdGljIGludCBjb21wYXJlKExpc3Q8TG9u\nZz4gbDEsIExpc3Q8TG9uZz4gbDIpIHRocm93cyBVbmV4cGVjdGVkQ29uZGl0\naW9uRXhjZXB0aW9uIHsKICAgICAgICBpZiAobDEuc2l6ZSgpICE9IGwyLnNp\nemUoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5leHBlY3RlZENvbmRp\ndGlvbkV4Y2VwdGlvbigiU2VxLWlkcyBiZWluZyBjb21wYXJlZCBoYXZlIGRp\nZmZlcmVudCBzaXplczogIiArIGwxLnNpemUoKQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgYW5kICIg\nKyBsMi5zaXplKCkpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBsMS5zaXplKCk7IGkrKykgewogICAgICAgICAgICBsb25nIHYx\nID0gbDEuZ2V0KGkpOwogICAgICAgICAgICBsb25nIHYyID0gbDIuZ2V0KGkp\nOwoKICAgICAgICAgICAgaWYgKHYxID09IHYyKSB7CiAgICAgICAgICAgICAg\nICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJu\nIHYxID4gdjIgPyAxIDogLTE7CiAgICAgICAgfQoKICAgICAgICAvLyBBbGwg\nY29tcG9uZW50cyBlcXVhbAogICAgICAgIHJldHVybiAwOwogICAgfQoKICAg\nIC8qKgogICAgICogUmV0dXJucyB0aGUgZWxlbWVudC13aXNlIHZlY3RvciBt\nYXhpbXVtIG9mIHRoZSB0d28gdmVjdG9ycyBpZDEgYW5kIGlkMiwKICAgICAq\nIGlmIHdlIGltYWdpbmUgdGhlbSB0byBiZSBzcGFyc2UgcmVwcmVzZW50YXRp\nb25zIG9mIHZlY3RvcnMuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCB0YWtlUmVnaW9uTWF4aW11bShNZXNzYWdlU2VxSWQuQnVpbGRlciBuZXdJ\nZEJ1aWxkZXIsIE1lc3NhZ2VTZXFJZCBpZDEsIE1lc3NhZ2VTZXFJZCBpZDIp\nIHsKICAgICAgICBNYXA8Qnl0ZVN0cmluZywgUmVnaW9uU3BlY2lmaWNTZXFJ\nZD4gaWQyTWFwID0gTWVzc2FnZUlkVXRpbHMuaW5NYXBGb3JtKGlkMik7Cgog\nICAgICAgIGZvciAoUmVnaW9uU3BlY2lmaWNTZXFJZCBycnNpZDEgOiBpZDEu\nZ2V0UmVtb3RlQ29tcG9uZW50c0xpc3QoKSkgewogICAgICAgICAgICBCeXRl\nU3RyaW5nIHJlZ2lvbiA9IHJyc2lkMS5nZXRSZWdpb24oKTsKCiAgICAgICAg\nICAgIFJlZ2lvblNwZWNpZmljU2VxSWQgcnNzaWQyID0gaWQyTWFwLmdldChy\nZWdpb24pOwoKICAgICAgICAgICAgaWYgKHJzc2lkMiA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBuZXdJZEJ1aWxkZXIuYWRkUmVtb3RlQ29tcG9uZW50\ncyhycnNpZDEpOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIG5ld0lkQnVpbGRlci5hZGRSZW1vdGVDb21w\nb25lbnRzKChycnNpZDEuZ2V0U2VxSWQoKSA+IHJzc2lkMi5nZXRTZXFJZCgp\nKSA/IHJyc2lkMSA6IHJzc2lkMik7CgogICAgICAgICAgICAvLyByZW1vdmUg\nZnJvbSBtYXAKICAgICAgICAgICAgaWQyTWFwLnJlbW92ZShyZWdpb24pOwog\nICAgICAgIH0KCiAgICAgICAgLy8gbm93IHRha2UgdGhlIHJlbWFpbmluZyBj\nb21wb25lbnRzIGluIHRoZSBtYXAgYW5kIGFkZCB0aGVtCiAgICAgICAgZm9y\nIChSZWdpb25TcGVjaWZpY1NlcUlkIHJzc2lkMiA6IGlkMk1hcC52YWx1ZXMo\nKSkgewogICAgICAgICAgICBuZXdJZEJ1aWxkZXIuYWRkUmVtb3RlQ29tcG9u\nZW50cyhyc3NpZDIpOwogICAgICAgIH0KCiAgICB9Cn0K\n","encoding":"base64"}

