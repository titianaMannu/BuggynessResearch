{"sha":"b76023cd0a9794df5c37209aff80fc3780c69c94","node_id":"MDQ6QmxvYjE1NzU5NTY6Yjc2MDIzY2QwYTk3OTRkZjVjMzcyMDlhZmY4MGZjMzc4MGM2OWM5NA==","size":32167,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b76023cd0a9794df5c37209aff80fc3780c69c94","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5F\nbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFwOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0b3JT\nZXJ2aWNlOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tLZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkxlZGdlckVudHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29EZWZzOwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uLkNvZGU7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5kYXRhLlN0YXQ7CgppbXBvcnQgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3Vi\nRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9waWNFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlczsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2V4dGVuc2lvbnMuTWVzc2FnZUlkVXRpbHM7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3Vy\nYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9u\nLlRvcGljT3BRdWV1ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2\nZXIuY29tbW9uLlVuZXhwZWN0ZWRFcnJvcjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnNlcnZlci5wZXJzaXN0ZW5jZS5TY2FuQ2FsbGJhY2suUmVhc29u\nRm9yRmluaXNoOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnRv\ncGljcy5Ub3BpY01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5z\nZXJ2ZXIudG9waWNzLlRvcGljT3duZXJzaGlwQ2hhbmdlTGlzdGVuZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuem9va2VlcGVyLlNhZmVBc3luQktDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBlci5TYWZlQXN5\nbmNaS0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuem9va2Vl\ncGVyLlprVXRpbHM7CgovKioKICogVGhpcyBwZXJzaXN0ZW5jZSBtYW5hZ2Vy\nIHVzZXMgem9va2VlcGVyIGFuZCBib29ra2VlcGVyIHRvIHN0b3JlIG1lc3Nh\nZ2VzLgogKgogKiBJbmZvcm1hdGlvbiBhYm91dCB0b3BpY3MgYXJlIHN0b3Jl\nZCBpbiB6b29rZWVwZXIgd2l0aCBhIHpub2RlIG5hbWVkIGFmdGVyIHRoZQog\nKiB0b3BpYyB0aGF0IGNvbnRhaW5zIGFuIEFTQ0lJIGVuY29kZWQgbGlzdCB3\naXRoIHJlY29yZHMgb2YgdGhlIGZvbGxvd2luZyBmb3JtOgogKgogKiA8cHJl\nPgogKiBzdGFydFNlcUlkKGluY2x1ZGVkKVx0bGVkZ2VySWRcbgogKiA8L3By\nZT4KICoKICovCgpwdWJsaWMgY2xhc3MgQm9va2tlZXBlclBlcnNpc3RlbmNl\nTWFuYWdlciBpbXBsZW1lbnRzIFBlcnNpc3RlbmNlTWFuYWdlcldpdGhSYW5n\nZVNjYW4sIFRvcGljT3duZXJzaGlwQ2hhbmdlTGlzdGVuZXIgewogICAgc3Rh\ndGljIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihC\nb29ra2VlcGVyUGVyc2lzdGVuY2VNYW5hZ2VyLmNsYXNzKTsKICAgIHN0YXRp\nYyBieXRlW10gcGFzc3dkID0gInNpbGx5c2VjcmV0Ii5nZXRCeXRlcygpOwog\nICAgcHJpdmF0ZSBCb29rS2VlcGVyIGJrOwogICAgcHJpdmF0ZSBab29LZWVw\nZXIgems7CiAgICBwcml2YXRlIFNlcnZlckNvbmZpZ3VyYXRpb24gY2ZnOwoK\nICAgIHN0YXRpYyBjbGFzcyBJbk1lbW9yeUxlZGdlclJhbmdlIHsKICAgICAg\nICBMZWRnZXJSYW5nZSByYW5nZTsKICAgICAgICBsb25nIHN0YXJ0U2VxSWRJ\nbmNsdWRlZDsgLy8gaW5jbHVkZWQsIGZvciB0aGUgdmVyeSBmaXJzdCBsZWRn\nZXIsIHRoaXMKICAgICAgICAvLyB2YWx1ZSBpcyAxCiAgICAgICAgTGVkZ2Vy\nSGFuZGxlIGhhbmRsZTsKCiAgICAgICAgcHVibGljIEluTWVtb3J5TGVkZ2Vy\nUmFuZ2UoTGVkZ2VyUmFuZ2UgcmFuZ2UsIGxvbmcgc3RhcnRTZXFJZCwgTGVk\nZ2VySGFuZGxlIGhhbmRsZSkgewogICAgICAgICAgICB0aGlzLnJhbmdlID0g\ncmFuZ2U7CiAgICAgICAgICAgIHRoaXMuc3RhcnRTZXFJZEluY2x1ZGVkID0g\nc3RhcnRTZXFJZDsKICAgICAgICAgICAgdGhpcy5oYW5kbGUgPSBoYW5kbGU7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgSW5NZW1vcnlMZWRnZXJSYW5n\nZShMZWRnZXJSYW5nZSByYW5nZSwgbG9uZyBzdGFydFNlcUlkKSB7CiAgICAg\nICAgICAgIHRoaXMocmFuZ2UsIHN0YXJ0U2VxSWQsIG51bGwpOwogICAgICAg\nIH0KCiAgICB9CgogICAgc3RhdGljIGNsYXNzIFRvcGljSW5mbyB7CiAgICAg\nICAgLyoqCiAgICAgICAgICogc3RvcmVzIHRoZSBsYXN0IG1lc3NhZ2Utc2Vx\nLWlkIHZlY3RvciB0aGF0IGhhcyBiZWVuIHB1c2hlZCB0byBCSyBmb3IKICAg\nICAgICAgKiBwZXJzaXN0ZW5jZSAoYnV0IG5vdCBuZWNlc3NhcmlseSBhY2tl\nZCB5ZXQgYnkgQkspCiAgICAgICAgICoKICAgICAgICAgKi8KICAgICAgICBN\nZXNzYWdlU2VxSWQgbGFzdFNlcUlkUHVzaGVkOwoKICAgICAgICAvKioKICAg\nICAgICAgKiBzdG9yZXMgdGhlIGxhc3QgbWVzc2FnZS1pZCB0aGF0IGhhcyBi\nZWVuIGFja2VkIGJ5IEJLLiBUaGlzIG51bWJlciBpcwogICAgICAgICAqIGJh\nc2ljYWxseSB1c2VkIGZvciBsaW1pdGluZyBzY2FucyB0byBub3QgcmVhZCBw\nYXN0IHdoYXQgaGFzIGJlZW4KICAgICAgICAgKiBwZXJzaXN0ZWQgYnkgQksK\nICAgICAgICAgKi8KICAgICAgICBsb25nIGxhc3RFbnRyeUlkQWNrZWRJbkN1\ncnJlbnRMZWRnZXIgPSAtMTsgLy8gYmVjYXVzZSBCSyBsZWRnZXJzIHN0YXJ0\ncwogICAgICAgIC8vIGF0IDAKCiAgICAgICAgLyoqCiAgICAgICAgICogc3Rv\ncmVzIGEgc29ydGVkIHN0cnVjdHVyZSBvZiB0aGUgbGVkZ2VycyBmb3IgYSB0\nb3BpYywgbWFwcGluZyBmcm9tCiAgICAgICAgICogdGhlIGVuZFNlcUlkSW5j\nbHVkZWQgdG8gdGhlIGxlZGdlciBpbmZvLiBUaGlzIHN0cnVjdHVyZSBkb2Vz\nIG5vdAogICAgICAgICAqIGluY2x1ZGUgdGhlIGN1cnJlbnQgbGVkZ2VyCiAg\nICAgICAgICovCiAgICAgICAgVHJlZU1hcDxMb25nLCBJbk1lbW9yeUxlZGdl\nclJhbmdlPiBsZWRnZXJSYW5nZXMgPSBuZXcgVHJlZU1hcDxMb25nLCBJbk1l\nbW9yeUxlZGdlclJhbmdlPigpOwoKICAgICAgICAvKioKICAgICAgICAgKiBU\naGlzIGlzIHRoZSBoYW5kbGUgb2YgdGhlIGN1cnJlbnQgbGVkZ2VyIHRoYXQg\naXMgYmVpbmcgdXNlZCB0byB3cml0ZQogICAgICAgICAqIG1lc3NhZ2VzCiAg\nICAgICAgICovCiAgICAgICAgSW5NZW1vcnlMZWRnZXJSYW5nZSBjdXJyZW50\nTGVkZ2VyUmFuZ2U7CgogICAgfQoKICAgIE1hcDxCeXRlU3RyaW5nLCBUb3Bp\nY0luZm8+IHRvcGljSW5mb3MgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8Qnl0\nZVN0cmluZywgVG9waWNJbmZvPigpOwoKICAgIFRvcGljT3BRdWV1ZXIgcXVl\ndWVyOwoKICAgIC8qKgogICAgICogSW5zdGFudGlhdGVzIGEgQm9va0tlZXBl\nclBlcnNpc3RlbmNlIG1hbmFnZXIuCiAgICAgKgogICAgICogQHBhcmFtIGJr\nCiAgICAgKiAgICAgICAgICAgIGEgcmVmZXJlbmNlIHRvIGJvb2trZWVwZXIg\ndG8gdXNlLgogICAgICogQHBhcmFtIHprCiAgICAgKiAgICAgICAgICAgIGEg\nem9va2VlcGVyIGhhbmRsZSB0byB1c2UuCiAgICAgKiBAcGFyYW0gemtQcmVm\naXgKICAgICAqICAgICAgICAgICAgdGhlIHpvb2tlZXBlciBzdWJ0cmVlIHRo\nYXQgc3RvcmVzIHRoZSB0b3BpYyB0byBsZWRnZXIKICAgICAqICAgICAgICAg\nICAgaW5mb3JtYXRpb24uIGlmIHRoaXMgcHJlZml4IGRvZXMgbm90IGV4aXN0\nLCBpdCB3aWxsIGJlCiAgICAgKiAgICAgICAgICAgIGNyZWF0ZWQuCiAgICAg\nKi8KICAgIHB1YmxpYyBCb29ra2VlcGVyUGVyc2lzdGVuY2VNYW5hZ2VyKEJv\nb2tLZWVwZXIgYmssIFpvb0tlZXBlciB6aywgVG9waWNNYW5hZ2VyIHRtLCBT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNmZywKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBl\neGVjdXRvcikgewogICAgICAgIHRoaXMuYmsgPSBiazsKICAgICAgICB0aGlz\nLnprID0gems7CiAgICAgICAgdGhpcy5jZmcgPSBjZmc7CiAgICAgICAgcXVl\ndWVyID0gbmV3IFRvcGljT3BRdWV1ZXIoZXhlY3V0b3IpOwogICAgICAgIHRt\nLmFkZFRvcGljT3duZXJzaGlwQ2hhbmdlTGlzdGVuZXIodGhpcyk7CiAgICB9\nCgogICAgY2xhc3MgUmFuZ2VTY2FuT3AgZXh0ZW5kcyBUb3BpY09wUXVldWVy\nLlN5bmNocm9ub3VzT3AgewogICAgICAgIFJhbmdlU2NhblJlcXVlc3QgcmVx\ndWVzdDsKICAgICAgICBpbnQgbnVtTWVzc2FnZXNSZWFkID0gMDsKICAgICAg\nICBsb25nIHRvdGFsU2l6ZVJlYWQgPSAwOwogICAgICAgIFRvcGljSW5mbyB0\nb3BpY0luZm87CgogICAgICAgIHB1YmxpYyBSYW5nZVNjYW5PcChSYW5nZVNj\nYW5SZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVy\nKHJlcXVlc3QudG9waWMpOwogICAgICAgICAgICB0aGlzLnJlcXVlc3QgPSBy\nZXF1ZXN0OwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHJvdGVjdGVkIHZvaWQgcnVuSW50ZXJuYWwoKSB7CiAgICAgICAgICAgIHRv\ncGljSW5mbyA9IHRvcGljSW5mb3MuZ2V0KHRvcGljKTsKCiAgICAgICAgICAg\nIGlmICh0b3BpY0luZm8gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmVx\ndWVzdC5jYWxsYmFjay5zY2FuRmFpbGVkKHJlcXVlc3QuY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9waWNFeGNl\ncHRpb24oIiIpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgc3RhcnRSZWFkaW5nRnJvbShyZXF1ZXN0LnN0\nYXJ0U2VxSWQpOwoKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lk\nIHJlYWQoZmluYWwgSW5NZW1vcnlMZWRnZXJSYW5nZSBpbWxyLCBmaW5hbCBs\nb25nIHN0YXJ0U2VxSWQsIGZpbmFsIGxvbmcgZW5kU2VxSWQpIHsKCiAgICAg\nICAgICAgIGlmIChpbWxyLmhhbmRsZSA9PSBudWxsKSB7CgogICAgICAgICAg\nICAgICAgYmsuYXN5bmNPcGVuTGVkZ2VyKGltbHIucmFuZ2UuZ2V0TGVkZ2Vy\nSWQoKSwgRGlnZXN0VHlwZS5DUkMzMiwgcGFzc3dkLAogICAgICAgICAgICAg\nICAgbmV3IFNhZmVBc3luQktDYWxsYmFjay5PcGVuQ2FsbGJhY2soKSB7CiAg\nICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgc2FmZU9wZW5Db21wbGV0ZShpbnQgcmMsIExlZGdl\nckhhbmRsZSBsZWRnZXJIYW5kbGUsIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0sp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltbHIuaGFuZGxlID0g\nbGVkZ2VySGFuZGxlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVh\nZChpbWxyLCBzdGFydFNlcUlkLCBlbmRTZXFJZCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgQktFeGNlcHRpb24gYmtlID0g\nQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgbG9nZ2VyLmVycm9yKCJDb3VsZCBub3Qgb3BlbiBsZWRnZXI6ICIgKyBp\nbWxyLnJhbmdlLmdldExlZGdlcklkKCkgKyAiIGZvciB0b3BpYzogIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYyk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3QuY2FsbGJhY2suc2NhbkZh\naWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNl\ncHRpb24oYmtlKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCByZXF1\nZXN0LmN0eCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGxlZGdlciBoYW5kbGUgaXMgbm90IG51bGws\nIHdlIGNhbiByZWFkIGZyb20gaXQKICAgICAgICAgICAgbG9uZyBjb3JyZWN0\nZWRFbmRTZXFJZCA9IE1hdGgubWluKHN0YXJ0U2VxSWQgKyByZXF1ZXN0Lm1l\nc3NhZ2VMaW1pdCAtIG51bU1lc3NhZ2VzUmVhZCAtIDEsIGVuZFNlcUlkKTsK\nCiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewog\nICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJJc3N1aW5nIGEgYmsgcmVh\nZCBmb3IgbGVkZ2VyOiAiICsgaW1sci5oYW5kbGUuZ2V0SWQoKSArICIgZnJv\nbSBlbnRyeS1pZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nKHN0YXJ0U2VxSWQgLSBpbWxyLnN0YXJ0U2VxSWRJbmNsdWRlZCkgKyAiIHRv\nIGVudHJ5LWlkOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAo\nY29ycmVjdGVkRW5kU2VxSWQgLSBpbWxyLnN0YXJ0U2VxSWRJbmNsdWRlZCkp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpbWxyLmhhbmRsZS5hc3lu\nY1JlYWRFbnRyaWVzKHN0YXJ0U2VxSWQgLSBpbWxyLnN0YXJ0U2VxSWRJbmNs\ndWRlZCwgY29ycmVjdGVkRW5kU2VxSWQKICAgICAgICAgICAgLSBpbWxyLnN0\nYXJ0U2VxSWRJbmNsdWRlZCwgbmV3IFNhZmVBc3luQktDYWxsYmFjay5SZWFk\nQ2FsbGJhY2soKSB7CgogICAgICAgICAgICAgICAgbG9uZyBleHBlY3RlZEVu\ndHJ5SWQgPSBzdGFydFNlcUlkIC0gaW1sci5zdGFydFNlcUlkSW5jbHVkZWQ7\nCgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzYWZlUmVhZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFu\nZGxlIGxoLCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0\naW9uLkNvZGUuT0sgfHwgIXNlcS5oYXNNb3JlRWxlbWVudHMoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbiBia2UgPSBCS0V4Y2Vw\ndGlvbi5jcmVhdGUocmMpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZXJyb3IoIkVycm9yIHdoaWxlIHJlYWRpbmcgZnJvbSBsZWRnZXI6ICIg\nKyBpbWxyLnJhbmdlLmdldExlZGdlcklkKCkgKyAiIGZvciB0b3BpYzogIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50\nb1N0cmluZ1V0ZjgoKSwgYmtlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmVxdWVzdC5jYWxsYmFjay5zY2FuRmFpbGVkKHJlcXVlc3QuY3R4LCBuZXcg\nUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGJrZSkpOwog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBMZWRnZXJFbnRyeSBlbnRy\neSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHNlcS5oYXNN\nb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBlbnRy\neSA9IHNlcS5uZXh0RWxlbWVudCgpOwogICAgICAgICAgICAgICAgICAgICAg\nICBNZXNzYWdlIG1lc3NhZ2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gTWVz\nc2FnZS5wYXJzZUZyb20oZW50cnkuZ2V0RW50cnlJbnB1dFN0cmVhbSgpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIG1zZyA9\nICJVbnJlYWRhYmxlIG1lc3NhZ2UgZm91bmQgaW4gbGVkZ2VyOiAiICsgaW1s\nci5yYW5nZS5nZXRMZWRnZXJJZCgpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiIGZvciB0b3BpYzogIiArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKG1zZywgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXF1ZXN0LmNhbGxiYWNrLnNjYW5GYWlsZWQoY3R4LCBuZXcgUHViU3Vi\nRXhjZXB0aW9uLlVuZXhwZWN0ZWRDb25kaXRpb25FeGNlcHRpb24obXNnKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZWFkIHJlc3BvbnNlIGZyb20g\nbGVkZ2VyOiAiICsgbGguZ2V0SWQoKSArICIgZW50cnktaWQ6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGVudHJ5Lmdl\ndEVudHJ5SWQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICAgICAgICAgIGFzc2VydCBleHBlY3RlZEVudHJ5SWQgPT0g\nZW50cnkuZ2V0RW50cnlJZCgpIDogImV4cGVjdGVkRW50cnlJZCAoIiArIGV4\ncGVjdGVkRW50cnlJZAogICAgICAgICAgICAgICAgICAgICAgICArICIpICE9\nIGVudHJ5LmdldEVudHJ5SWQoKSAoIiArIGVudHJ5LmdldEVudHJ5SWQoKSAr\nICIpIjsKICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0IChtZXNzYWdl\nLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21wb25lbnQoKSAtIGltbHIuc3RhcnRT\nZXFJZEluY2x1ZGVkKSA9PSBleHBlY3RlZEVudHJ5SWQ7CgogICAgICAgICAg\nICAgICAgICAgICAgICBleHBlY3RlZEVudHJ5SWQrKzsKICAgICAgICAgICAg\nICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFjay5tZXNzYWdlU2Nhbm5lZChj\ndHgsIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgICAgICAgICBudW1NZXNz\nYWdlc1JlYWQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxTaXpl\nUmVhZCArPSBtZXNzYWdlLmdldEJvZHkoKS5zaXplKCk7CgogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAobnVtTWVzc2FnZXNSZWFkID49IHJlcXVlc3Qu\nbWVzc2FnZUxpbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXF1ZXN0LmNhbGxiYWNrLnNjYW5GaW5pc2hlZChjdHgsIFJlYXNvbkZvckZp\nbmlzaC5OVU1fTUVTU0FHRVNfTElNSVRfRVhDRUVERUQpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxTaXpl\nUmVhZCA+PSByZXF1ZXN0LnNpemVMaW1pdCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFjay5zY2FuRmluaXNoZWQoY3R4\nLCBSZWFzb25Gb3JGaW5pc2guU0laRV9MSU1JVF9FWENFRURFRCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgICAgIHN0YXJ0UmVhZGluZ0Zyb20oaW1sci5zdGFydFNlcUlkSW5j\nbHVkZWQgKyBlbnRyeS5nZXRFbnRyeUlkKCkgKyAxKTsKCiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0sIHJlcXVlc3QuY3R4KTsKICAgICAgICB9\nCgogICAgICAgIHByb3RlY3RlZCB2b2lkIHN0YXJ0UmVhZGluZ0Zyb20obG9u\nZyBzdGFydFNlcUlkKSB7CgogICAgICAgICAgICBNYXAuRW50cnk8TG9uZywg\nSW5NZW1vcnlMZWRnZXJSYW5nZT4gZW50cnkgPSB0b3BpY0luZm8ubGVkZ2Vy\nUmFuZ2VzLmNlaWxpbmdFbnRyeShzdGFydFNlcUlkKTsKCiAgICAgICAgICAg\nIGlmIChlbnRyeSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBOb25l\nIG9mIHRoZSBvbGQgbGVkZ2VycyBoYXZlIHRoaXMgc2VxLWlkLCB3ZSBtdXN0\nIHVzZSB0aGUKICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgbGVkZ2VyCiAg\nICAgICAgICAgICAgICBsb25nIGVuZFNlcUlkID0gdG9waWNJbmZvLmN1cnJl\nbnRMZWRnZXJSYW5nZS5zdGFydFNlcUlkSW5jbHVkZWQKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIHRvcGljSW5mby5sYXN0RW50cnlJZEFj\na2VkSW5DdXJyZW50TGVkZ2VyOwoKICAgICAgICAgICAgICAgIGlmIChlbmRT\nZXFJZCA8IHN0YXJ0U2VxSWQpIHsKICAgICAgICAgICAgICAgICAgICByZXF1\nZXN0LmNhbGxiYWNrLnNjYW5GaW5pc2hlZChyZXF1ZXN0LmN0eCwgUmVhc29u\nRm9yRmluaXNoLk5PX01PUkVfTUVTU0FHRVMpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICByZWFkKHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UsIHN0YXJ0U2Vx\nSWQsIGVuZFNlcUlkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIHJlYWQoZW50cnkuZ2V0VmFsdWUoKSwgc3RhcnRTZXFJZCwgZW50\ncnkuZ2V0VmFsdWUoKS5yYW5nZS5nZXRFbmRTZXFJZEluY2x1ZGVkKCkuZ2V0\nTG9jYWxDb21wb25lbnQoKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNjYW5NZXNz\nYWdlcyhSYW5nZVNjYW5SZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICBxdWV1\nZXIucHVzaEFuZE1heWJlUnVuKHJlcXVlc3QudG9waWMsIG5ldyBSYW5nZVNj\nYW5PcChyZXF1ZXN0KSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsaXZl\ncmVkVW50aWwoQnl0ZVN0cmluZyB0b3BpYywgTG9uZyBzZXFJZCkgewogICAg\nICAgIC8vIE5vdGhpbmcgdG8gZG8gaGVyZS4gdGhpcyBpcyBqdXN0IGEgaGlu\ndCB0aGF0IHdlIGNhbm5vdCB1c2UuCiAgICB9CgogICAgcHVibGljIHZvaWQg\nY29uc3VtZWRVbnRpbChCeXRlU3RyaW5nIHRvcGljLCBMb25nIHNlcUlkKSB7\nCiAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5mb3MuZ2V0\nKHRvcGljKTsKICAgICAgICBpZiAodG9waWNJbmZvID09IG51bGwpIHsKICAg\nICAgICAgICAgbG9nZ2VyLmVycm9yKCJTZXJ2ZXIgaXMgbm90IHJlc3BvbnNp\nYmxlIGZvciB0b3BpYyEiKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KICAgICAgICBmb3IgKExvbmcgZW5kU2VxSWRJbmNsdWRlZCA6IHRvcGlj\nSW5mby5sZWRnZXJSYW5nZXMua2V5U2V0KCkpIHsKICAgICAgICAgICAgaWYg\nKGVuZFNlcUlkSW5jbHVkZWQgPD0gc2VxSWQpIHsKICAgICAgICAgICAgICAg\nIC8vIFRoaXMgbGVkZ2VyJ3MgbWVzc2FnZSBlbnRyaWVzIGhhdmUgYWxsIGJl\nZW4gY29uc3VtZWQgYWxyZWFkeQogICAgICAgICAgICAgICAgLy8gc28gaXQg\naXMgc2FmZSB0byBkZWxldGUgaXQgZnJvbSBCb29rS2VlcGVyLgogICAgICAg\nICAgICAgICAgbG9uZyBsZWRnZXJJZCA9IHRvcGljSW5mby5sZWRnZXJSYW5n\nZXMuZ2V0KGVuZFNlcUlkSW5jbHVkZWQpLnJhbmdlLmdldExlZGdlcklkKCk7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGJr\nLmRlbGV0ZUxlZGdlcihsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIC8vIEZv\nciBub3csIGp1c3QgbG9nIGFuIGV4Y2VwdGlvbiBlcnJvciBtZXNzYWdlLiBJ\nbiB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBmdXR1cmUsIHdlIGNhbiBo\nYXZlIG1vcmUgY29tcGxpY2F0ZWQgcmV0cnkgbG9naWMgdG8KICAgICAgICAg\nICAgICAgICAgICAvLyBkZWxldGUgYSBjb25zdW1lZCBsZWRnZXIuIFRoZSBu\nZXh0IHRpbWUgdGhlIGxlZGdlcgogICAgICAgICAgICAgICAgICAgIC8vIGdh\ncmJhZ2UgY29sbGVjdGlvbiBqb2IgcnVucywgd2UnbGwgb25jZSBhZ2FpbiB0\ncnkgdG8KICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgdGhpcyBsZWRn\nZXIuCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJFeGNlcHRp\nb24gd2hpbGUgZGVsZXRpbmcgY29uc3VtZWQgbGVkZ2VySWQ6ICIgKyBsZWRn\nZXJJZCwgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZQogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBNZXNzYWdlU2VxSWQgZ2V0Q3VycmVudFNlcUlkRm9yVG9waWMo\nQnl0ZVN0cmluZyB0b3BpYykgdGhyb3dzIFNlcnZlck5vdFJlc3BvbnNpYmxl\nRm9yVG9waWNFeGNlcHRpb24gewogICAgICAgIFRvcGljSW5mbyB0b3BpY0lu\nZm8gPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAgIGlmICh0b3Bp\nY0luZm8gPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBuZXcgUHViU3Vi\nRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9waWNFeGNlcHRp\nb24oIiIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRvcGljSW5mby5s\nYXN0U2VxSWRQdXNoZWQ7CiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0U2Vx\nSWRBZnRlclNraXBwaW5nKEJ5dGVTdHJpbmcgdG9waWMsIGxvbmcgc2VxSWQs\nIGludCBza2lwQW1vdW50KSB7CiAgICAgICAgcmV0dXJuIHNlcUlkICsgc2tp\ncEFtb3VudDsKICAgIH0KCiAgICBwdWJsaWMgY2xhc3MgUGVyc2lzdE9wIGV4\ndGVuZHMgVG9waWNPcFF1ZXVlci5TeW5jaHJvbm91c09wIHsKICAgICAgICBQ\nZXJzaXN0UmVxdWVzdCByZXF1ZXN0OwoKICAgICAgICBwdWJsaWMgUGVyc2lz\ndE9wKFBlcnNpc3RSZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICAgICAgcXVl\ndWVyLnN1cGVyKHJlcXVlc3QudG9waWMpOwogICAgICAgICAgICB0aGlzLnJl\ncXVlc3QgPSByZXF1ZXN0OwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgcnVuSW50ZXJuYWwoKSB7CiAgICAgICAg\nICAgIGZpbmFsIFRvcGljSW5mbyB0b3BpY0luZm8gPSB0b3BpY0luZm9zLmdl\ndCh0b3BpYyk7CgogICAgICAgICAgICBpZiAodG9waWNJbmZvID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIHJlcXVlc3QuY2FsbGJhY2sub3BlcmF0aW9u\nRmFpbGVkKHJlcXVlc3QuY3R4LAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFB1YlN1YkV4Y2VwdGlvbi5T\nZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9uKCIiKSk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGZpbmFsIGxvbmcgbG9jYWxTZXFJZCA9IHRvcGljSW5mby5sYXN0U2Vx\nSWRQdXNoZWQuZ2V0TG9jYWxDb21wb25lbnQoKSArIDE7CiAgICAgICAgICAg\nIE1lc3NhZ2VTZXFJZC5CdWlsZGVyIGJ1aWxkZXIgPSBNZXNzYWdlU2VxSWQu\nbmV3QnVpbGRlcigpOwogICAgICAgICAgICBpZiAocmVxdWVzdC5tZXNzYWdl\nLmhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIE1lc3NhZ2VJZFV0aWxz\nLnRha2VSZWdpb25NYXhpbXVtKGJ1aWxkZXIsIHRvcGljSW5mby5sYXN0U2Vx\nSWRQdXNoZWQsIHJlcXVlc3QubWVzc2FnZS5nZXRNc2dJZCgpKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJ1aWxkZXIuYWRkQWxs\nUmVtb3RlQ29tcG9uZW50cyh0b3BpY0luZm8ubGFzdFNlcUlkUHVzaGVkLmdl\ndFJlbW90ZUNvbXBvbmVudHNMaXN0KCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGJ1aWxkZXIuc2V0TG9jYWxDb21wb25lbnQobG9jYWxTZXFJZCk7\nCgogICAgICAgICAgICB0b3BpY0luZm8ubGFzdFNlcUlkUHVzaGVkID0gYnVp\nbGRlci5idWlsZCgpOwogICAgICAgICAgICBNZXNzYWdlIG1zZ1RvU2VyaWFs\naXplID0gTWVzc2FnZS5uZXdCdWlsZGVyKHJlcXVlc3QubWVzc2FnZSkuc2V0\nTXNnSWQodG9waWNJbmZvLmxhc3RTZXFJZFB1c2hlZCkuYnVpbGQoKTsKCiAg\nICAgICAgICAgIHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuaGFuZGxl\nLmFzeW5jQWRkRW50cnkobXNnVG9TZXJpYWxpemUudG9CeXRlQXJyYXkoKSwK\nICAgICAgICAgICAgbmV3IFNhZmVBc3luQktDYWxsYmFjay5BZGRDYWxsYmFj\naygpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgc2FmZUFkZENvbXBsZXRlKGludCByYywgTGVkZ2Vy\nSGFuZGxlIGxoLCBsb25nIGVudHJ5SWQsIE9iamVjdCBjdHgpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAocmMgIT0gQktFeGNlcHRpb24uQ29kZS5PSykg\newogICAgICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbiBia2UgPSBC\nS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwogICAgICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIHBlcnNpc3RpbmcgZW50cnkg\ndG8gbGVkZ2VyOiAiICsgbGguZ2V0SWQoKSArICIgZm9yIHRvcGljOiAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpLCBia2UpOwoKICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gVG8gcHJlc2VydmUgb3JkZXJpbmcgZ3VhcmFudGVlcywgd2UKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gc2hvdWxkIGdpdmUgdXAgdGhlIHRvcGlj\nIGFuZCBub3QgbGV0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG90aGVy\nIG9wZXJhdGlvbnMgdGhyb3VnaAogICAgICAgICAgICAgICAgICAgICAgICBy\nZXF1ZXN0LmNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJT\ndWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChlbnRyeUlkICsgdG9waWNJ\nbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5zdGFydFNlcUlkSW5jbHVkZWQgIT0g\nbG9jYWxTZXFJZCkgewogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcg\nbXNnID0gIkV4cGVjdGVkIEJLIHRvIGFzc2lnbiBlbnRyeS1pZDogIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAobG9jYWxTZXFJ\nZCAtIHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2Uuc3RhcnRTZXFJZElu\nY2x1ZGVkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiIGJ1dCBpdCBpbnN0ZWFkIGFzc2lnbmVkIGVudHJ5LWlkOiAiICsgZW50\ncnlJZCArICIgdG9waWM6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAibGVkZ2VyOiAi\nICsgbGguZ2V0SWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2Vy\nLmVycm9yKG1zZyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBVbmV4cGVjdGVkRXJyb3IobXNnKTsKICAgICAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgICAgIHRvcGljSW5mby5sYXN0RW50cnlJZEFj\na2VkSW5DdXJyZW50TGVkZ2VyID0gZW50cnlJZDsKICAgICAgICAgICAgICAg\nICAgICByZXF1ZXN0LmNhbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwg\nbG9jYWxTZXFJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0s\nIHJlcXVlc3QuY3R4KTsKCiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHBlcnNpc3RNZXNzYWdlKFBlcnNpc3RSZXF1ZXN0IHJlcXVlc3QpIHsK\nICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHJlcXVlc3QudG9waWMs\nIG5ldyBQZXJzaXN0T3AocmVxdWVzdCkpOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHNjYW5TaW5nbGVNZXNzYWdlKFNjYW5SZXF1ZXN0IHJlcXVlc3QpIHsK\nICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbigiTm90IGltcGxl\nbWVudGVkIik7CiAgICB9CgogICAgc3RhdGljIFNhZmVBc3luQktDYWxsYmFj\nay5DbG9zZUNhbGxiYWNrIG5vT3BDbG9zZUNhbGxiYWNrID0gbmV3IFNhZmVB\nc3luQktDYWxsYmFjay5DbG9zZUNhbGxiYWNrKCkgewogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHNhZmVDbG9zZUNvbXBsZXRlKGlu\ndCByYywgTGVkZ2VySGFuZGxlIGxlZGdlckhhbmRsZSwgT2JqZWN0IGN0eCkg\newogICAgICAgIH07CiAgICB9OwoKICAgIFN0cmluZyBsZWRnZXJzUGF0aChC\neXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAgcmV0dXJuIGNmZy5nZXRaa1Rv\ncGljUGF0aChuZXcgU3RyaW5nQnVpbGRlcigpLCB0b3BpYykuYXBwZW5kKCIv\nbGVkZ2VycyIpLnRvU3RyaW5nKCk7CiAgICB9CgogICAgY2xhc3MgQWNxdWly\nZU9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hyb25vdXNPcDxWb2lk\nPiB7CiAgICAgICAgcHVibGljIEFjcXVpcmVPcChCeXRlU3RyaW5nIHRvcGlj\nLCBDYWxsYmFjazxWb2lkPiBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgICAg\nICBxdWV1ZXIuc3VwZXIodG9waWMsIGNiLCBjdHgpOwogICAgICAgIH0KCiAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgICAgICBpZiAodG9waWNJbmZvcy5jb250YWluc0tleSh0b3BpYykp\nIHsKICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgYWNxdWlyZWQsIGRvIG5v\ndGhpbmcKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0\neCwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgLy8gcmVhZCB0b3BpYyBsZWRnZXJzIG5vZGUgZGF0\nYQogICAgICAgICAgICBmaW5hbCBTdHJpbmcgek5vZGVQYXRoID0gbGVkZ2Vy\nc1BhdGgodG9waWMpOwoKICAgICAgICAgICAgemsuZ2V0RGF0YSh6Tm9kZVBh\ndGgsIGZhbHNlLCBuZXcgU2FmZUFzeW5jWktDYWxsYmFjay5EYXRhQ2FsbGJh\nY2soKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3Ry\naW5nIHBhdGgsIE9iamVjdCBjdHgsIGJ5dGVbXSBkYXRhLCBTdGF0IHN0YXQp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQ29kZS5PSy5pbnRW\nYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NUb3Bp\nY0xlZGdlcnNOb2RlRGF0YShkYXRhLCBzdGF0LmdldFZlcnNpb24oKSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBDb2RlLk5P\nTk9ERS5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGNyZWF0ZSBpdAogICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBieXRl\nW10gaW5pdGlhbERhdGEgPSBMZWRnZXJSYW5nZXMuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCkudG9CeXRlQXJyYXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nWmtVdGlscy5jcmVhdGVGdWxsUGF0aE9wdGltaXN0aWMoemssIHpOb2RlUGF0\naCwgaW5pdGlhbERhdGEsIFpvb0RlZnMuSWRzLk9QRU5fQUNMX1VOU0FGRSwK\nICAgICAgICAgICAgICAgICAgICAgICAgQ3JlYXRlTW9kZS5QRVJTSVNURU5U\nLCBuZXcgU2FmZUFzeW5jWktDYWxsYmFjay5TdHJpbmdDYWxsYmFjaygpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVByb2Nlc3NS\nZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgU3RyaW5n\nIG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\ncmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBrZSA9IFprVXRp\nbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICJDb3VsZCBub3QgY3JlYXRlIGxlZGdlcnMgbm9kZSBmb3IgdG9waWM6\nICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBh\ndGgsIHJjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5T\nZXJ2aWNlRG93bkV4Y2VwdGlvbihrZSkpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGluaXRpYWwgdmVyc2lvbiBpcyB2ZXJzaW9uIDEKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvLyAoZ3Vlc3NpbmcpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1RvcGljTGVkZ2Vyc05vZGVE\nYXRhKGluaXRpYWxEYXRhLCAwKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSwgY3R4KTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHNvbWUgb3Ro\nZXIgZXJyb3IKICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24g\na2UgPSBaa1V0aWxzLmxvZ0Vycm9yQW5kQ3JlYXRlWktFeGNlcHRpb24oIkNv\ndWxkIG5vdCByZWFkIGxlZGdlcnMgbm9kZSBmb3IgdG9waWM6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAgICAgICAgICAg\nY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5T\nZXJ2aWNlRG93bkV4Y2VwdGlvbihrZSkpOwoKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICB9CgogICAgICAgIHZvaWQg\ncHJvY2Vzc1RvcGljTGVkZ2Vyc05vZGVEYXRhKGJ5dGVbXSBkYXRhLCBpbnQg\ndmVyc2lvbikgewoKICAgICAgICAgICAgZmluYWwgTGVkZ2VyUmFuZ2VzIHJh\nbmdlczsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJhbmdl\ncyA9IExlZGdlclJhbmdlcy5wYXJzZUZyb20oZGF0YSk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICBTdHJpbmcgbXNnID0gIkxlZGdlciByYW5nZXMg\nZm9yIHRvcGljOiIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgY291bGQg\nbm90IGJlIGRlc2VyaWFsaXplZCI7CiAgICAgICAgICAgICAgICBsb2dnZXIu\nZXJyb3IobXNnLCBlKTsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZh\naWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uVW5leHBlY3RlZENvbmRp\ndGlvbkV4Y2VwdGlvbihtc2cpKTsKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgSXRlcmF0b3I8TGVkZ2VyUmFu\nZ2U+IGxySXRlcmF0b3IgPSByYW5nZXMuZ2V0UmFuZ2VzTGlzdCgpLml0ZXJh\ndG9yKCk7CiAgICAgICAgICAgIFRvcGljSW5mbyB0b3BpY0luZm8gPSBuZXcg\nVG9waWNJbmZvKCk7CgogICAgICAgICAgICBsb25nIHN0YXJ0T2ZMZWRnZXIg\nPSAxOwoKICAgICAgICAgICAgd2hpbGUgKGxySXRlcmF0b3IuaGFzTmV4dCgp\nKSB7CiAgICAgICAgICAgICAgICBMZWRnZXJSYW5nZSByYW5nZSA9IGxySXRl\ncmF0b3IubmV4dCgpOwoKICAgICAgICAgICAgICAgIGlmIChyYW5nZS5oYXNF\nbmRTZXFJZEluY2x1ZGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0\naGlzIG1lYW5zIGl0IHdhcyBhIHZhbGlkIGFuZCBjb21wbGV0ZWx5IGNsb3Nl\nZCBsZWRnZXIKICAgICAgICAgICAgICAgICAgICBsb25nIGVuZE9mTGVkZ2Vy\nID0gcmFuZ2UuZ2V0RW5kU2VxSWRJbmNsdWRlZCgpLmdldExvY2FsQ29tcG9u\nZW50KCk7CiAgICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLmxlZGdlclJh\nbmdlcy5wdXQoZW5kT2ZMZWRnZXIsIG5ldyBJbk1lbW9yeUxlZGdlclJhbmdl\nKHJhbmdlLCBzdGFydE9mTGVkZ2VyKSk7CiAgICAgICAgICAgICAgICAgICAg\nc3RhcnRPZkxlZGdlciA9IGVuZE9mTGVkZ2VyICsgMTsKICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAvLyBJZiBpdCBkb2Vzbid0IGhhdmUgYSB2YWxpZCBlbmQsIGl0\nIG11c3QgYmUgdGhlIGxhc3QgbGVkZ2VyCiAgICAgICAgICAgICAgICBpZiAo\nbHJJdGVyYXRvci5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICBT\ndHJpbmcgbXNnID0gIkxlZGdlci1pZDogIiArIHJhbmdlLmdldExlZGdlcklk\nKCkgKyAiIGZvciB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBpcyBub3QgdGhl\nIGxhc3Qgb25lIGJ1dCBzdGlsbCBkb2VzIG5vdCBoYXZlIGFuIGVuZCBzZXEt\naWQiOwogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihtc2cpOwog\nICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5l\ndyBQdWJTdWJFeGNlcHRpb24uVW5leHBlY3RlZENvbmRpdGlvbkV4Y2VwdGlv\nbihtc2cpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gVGhlIGxhc3QgbGVkZ2Vy\nIGRvZXMgbm90IGhhdmUgYSB2YWxpZCBzZXEtaWQsIGxldHMgdHJ5IHRvCiAg\nICAgICAgICAgICAgICAvLyBmaW5kIGl0IG91dAogICAgICAgICAgICAgICAg\ncmVjb3Zlckxhc3RUb3BpY0xlZGdlckFuZE9wZW5OZXdPbmUocmFuZ2UuZ2V0\nTGVkZ2VySWQoKSwgdmVyc2lvbiwgdG9waWNJbmZvKTsKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gQWxs\nIGxlZGdlcnMgd2VyZSBmb3VuZCBwcm9wZXJseSBjbG9zZWQsIGp1c3Qgc3Rh\ncnQgYSBuZXcgb25lCiAgICAgICAgICAgIG9wZW5OZXdUb3BpY0xlZGdlcih2\nZXJzaW9uLCB0b3BpY0luZm8pOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogUmVjb3ZlcnMgdGhlIGxhc3QgbGVkZ2VyLCBvcGVucyBhIG5l\ndyBvbmUsIGFuZCBwZXJzaXN0cyB0aGUgbmV3CiAgICAgICAgICogaW5mb3Jt\nYXRpb24gdG8gWksKICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBsZWRn\nZXJJZAogICAgICAgICAqICAgICAgICAgICAgTGVkZ2VyIHRvIGJlIHJlY292\nZXJlZAogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCByZWNvdmVy\nTGFzdFRvcGljTGVkZ2VyQW5kT3Blbk5ld09uZShmaW5hbCBsb25nIGxlZGdl\ncklkLCBmaW5hbCBpbnQgZXhwZWN0ZWRWZXJzaW9uT2ZMZWRnZXJOb2RlLAog\nICAgICAgICAgICAgICAgZmluYWwgVG9waWNJbmZvIHRvcGljSW5mbykgewoK\nICAgICAgICAgICAgYmsuYXN5bmNPcGVuTGVkZ2VyKGxlZGdlcklkLCBEaWdl\nc3RUeXBlLkNSQzMyLCBwYXNzd2QsIG5ldyBTYWZlQXN5bkJLQ2FsbGJhY2su\nT3BlbkNhbGxiYWNrKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlT3BlbkNvbXBsZXRlKGlu\ndCByYywgTGVkZ2VySGFuZGxlIGxlZGdlckhhbmRsZSwgT2JqZWN0IGN0eCkg\newoKICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0gQktFeGNlcHRpb24u\nQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlv\nbiBia2UgPSBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwogICAgICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIuZXJyb3IoIldoaWxlIGFjcXVpcmluZyB0b3Bp\nYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArICIsIGNvdWxkIG5vdCBvcGVuIHVucmVj\nb3ZlcmVkIGxlZGdlcjogIiArIGxlZGdlcklkLCBia2UpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGJrZSkpOwogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgICAgICBmaW5hbCBsb25nIG51bUVudHJp\nZXNJbkxhc3RMZWRnZXIgPSBsZWRnZXJIYW5kbGUuZ2V0TGFzdEFkZENvbmZp\ncm1lZCgpICsgMTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKG51bUVudHJp\nZXNJbkxhc3RMZWRnZXIgPD0gMCkgewogICAgICAgICAgICAgICAgICAgICAg\nICAvLyB0aGlzIHdhcyBhbiBlbXB0eSBsZWRnZXIgdGhhdCBzb21lb25lIGNy\nZWF0ZWQgYnV0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvdWxkbid0\nIHdyaXRlIHRvLCBzbyBqdXN0IGlnbm9yZSBpdAogICAgICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIuaW5mbygiUHJ1bmluZyBlbXB0eSBsZWRnZXI6ICIg\nKyBsZWRnZXJJZCArICIgZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdV\ndGY4KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUxlZGdlcihs\nZWRnZXJIYW5kbGUpOwogICAgICAgICAgICAgICAgICAgICAgICBvcGVuTmV3\nVG9waWNMZWRnZXIoZXhwZWN0ZWRWZXJzaW9uT2ZMZWRnZXJOb2RlLCB0b3Bp\nY0luZm8pOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAvLyB3ZSBo\nYXZlIHRvIHJlYWQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGxlZGdlciB0byBm\naW5kCiAgICAgICAgICAgICAgICAgICAgLy8gb3V0IHRoZSBsYXN0IHNlcS1p\nZAoKICAgICAgICAgICAgICAgICAgICBsZWRnZXJIYW5kbGUuYXN5bmNSZWFk\nRW50cmllcyhudW1FbnRyaWVzSW5MYXN0TGVkZ2VyIC0gMSwgbnVtRW50cmll\nc0luTGFzdExlZGdlciAtIDEsCiAgICAgICAgICAgICAgICAgICAgbmV3IFNh\nZmVBc3luQktDYWxsYmFjay5SZWFkQ2FsbGJhY2soKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzYWZlUmVhZENvbXBsZXRlKGludCByYywgTGVkZ2Vy\nSGFuZGxlIGxoLCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLAogICAg\nICAgICAgICAgICAgICAgICAgICBPYmplY3QgY3R4KSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAocmMgIT0gQktFeGNlcHRpb24uQ29kZS5P\nSyB8fCAhc2VxLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgQktFeGNlcHRpb24gYmtlID0gQktFeGNlcHRp\nb24uY3JlYXRlKHJjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuZXJyb3IoIldoaWxlIHJlY292ZXJpbmcgbGVkZ2VyOiAiICsg\nbGVkZ2VySWQgKyAiIGZvciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpICsgIiwgY291bGQgbm90IHJlYWQgbGFzdCBlbnRyeSIsIGJrZSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFp\nbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2Vw\ndGlvbihia2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSBsYXN0TWVzc2FnZTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbGFzdE1lc3NhZ2UgPSBNZXNzYWdlLnBhcnNl\nRnJvbShzZXEubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludmFsaWRQcm90b2NvbEJ1\nZmZlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nIG1zZyA9ICJXaGlsZSByZWNvdmVyaW5nIGxlZGdlcjog\nIiArIGxlZGdlcklkICsgIiBmb3IgdG9waWM6ICIKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSArICIsIGNvdWxkIG5vdCBkZXNlcmlhbGl6ZSBsYXN0IG1lc3Nh\nZ2UiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5l\ncnJvcihtc2csIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24u\nVW5leHBlY3RlZENvbmRpdGlvbkV4Y2VwdGlvbihtc2cpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbG9uZyBwcmV2TGVkZ2VyRW5kID0gdG9waWNJbmZvLmxlZGdlclJhbmdlcy5p\nc0VtcHR5KCkgPyAwIDogdG9waWNJbmZvLmxlZGdlclJhbmdlcwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmxh\nc3RLZXkoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZGdlclJh\nbmdlIGxyID0gTGVkZ2VyUmFuZ2UubmV3QnVpbGRlcigpLnNldExlZGdlcklk\nKGxlZGdlcklkKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuc2V0RW5kU2VxSWRJbmNsdWRlZChsYXN0TWVzc2FnZS5n\nZXRNc2dJZCgpKS5idWlsZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdG9waWNJbmZvLmxlZGdlclJhbmdlcy5wdXQobHIuZ2V0RW5kU2VxSWRJ\nbmNsdWRlZCgpLmdldExvY2FsQ29tcG9uZW50KCksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcg\nSW5NZW1vcnlMZWRnZXJSYW5nZShsciwgcHJldkxlZGdlckVuZCArIDEsIGxo\nKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8o\nIlJlY292ZXJlZCB1bmNsb3NlZCBsZWRnZXI6ICIgKyBsZWRnZXJJZCArICIg\nZm9yIHRvcGljOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiB3aXRoICIgKyBu\ndW1FbnRyaWVzSW5MYXN0TGVkZ2VyICsgIiBlbnRyaWVzIik7CgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgb3Blbk5ld1RvcGljTGVkZ2VyKGV4cGVj\ndGVkVmVyc2lvbk9mTGVkZ2VyTm9kZSwgdG9waWNJbmZvKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIGN0eCk7\nCgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfSwgY3R4KTsKICAg\nICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqCiAgICAgICAgICogQHBh\ncmFtIHJlcXVpcmVkVmVyc2lvbk9mTGVkZ2Vyc05vZGUKICAgICAgICAgKiAg\nICAgICAgICAgIFRoZSB2ZXJzaW9uIG9mIHRoZSBsZWRnZXJzIG5vZGUgd2hl\nbiB3ZSByZWFkIGl0LCBzaG91bGQgYmUKICAgICAgICAgKiAgICAgICAgICAg\nIHRoZSBzYW1lIHdoZW4gd2UgdHJ5IHRvIHdyaXRlCiAgICAgICAgICovCiAg\nICAgICAgcHJpdmF0ZSB2b2lkIG9wZW5OZXdUb3BpY0xlZGdlcihmaW5hbCBp\nbnQgZXhwZWN0ZWRWZXJzaW9uT2ZMZWRnZXJzTm9kZSwgZmluYWwgVG9waWNJ\nbmZvIHRvcGljSW5mbykgewogICAgICAgICAgICBiay5hc3luY0NyZWF0ZUxl\nZGdlcihjZmcuZ2V0QmtFbnNlbWJsZVNpemUoKSwgY2ZnLmdldEJrUXVvcnVt\nU2l6ZSgpLCBEaWdlc3RUeXBlLkNSQzMyLCBwYXNzd2QsCiAgICAgICAgICAg\nIG5ldyBTYWZlQXN5bkJLQ2FsbGJhY2suQ3JlYXRlQ2FsbGJhY2soKSB7CiAg\nICAgICAgICAgICAgICBib29sZWFuIHByb2Nlc3NlZCA9IGZhbHNlOwoKICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgc2FmZUNyZWF0ZUNvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxl\nIGxoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHBy\nb2Nlc3NlZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgcHJvY2Vzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5D\nb2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJLRXhjZXB0aW9u\nIGJrZSA9IEJLRXhjZXB0aW9uLmNyZWF0ZShyYyk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ291bGQgbm90IGNyZWF0ZSBuZXcg\nbGVkZ2VyIHdoaWxlIGFjcXVpcmluZyB0b3BpYzogIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSwgYmtlKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9u\nRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4\nY2VwdGlvbihia2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\ndG9waWNJbmZvLmxhc3RTZXFJZFB1c2hlZCA9IHRvcGljSW5mby5sZWRnZXJS\nYW5nZXMuaXNFbXB0eSgpID8gTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIoKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAuc2V0TG9jYWxDb21wb25lbnQoMCkuYnVpbGQoKSA6IHRvcGljSW5mby5s\nZWRnZXJSYW5nZXMubGFzdEVudHJ5KCkuZ2V0VmFsdWUoKS5yYW5nZQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nZ2V0RW5kU2VxSWRJbmNsdWRlZCgpOwoKICAgICAgICAgICAgICAgICAgICBM\nZWRnZXJSYW5nZSBsYXN0UmFuZ2UgPSBMZWRnZXJSYW5nZS5uZXdCdWlsZGVy\nKCkuc2V0TGVkZ2VySWQobGguZ2V0SWQoKSkuYnVpbGQoKTsKICAgICAgICAg\nICAgICAgICAgICB0b3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlID0gbmV3\nIEluTWVtb3J5TGVkZ2VyUmFuZ2UobGFzdFJhbmdlLCB0b3BpY0luZm8ubGFz\ndFNlcUlkUHVzaGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0\nTG9jYWxDb21wb25lbnQoKSArIDEsIGxoKTsKCiAgICAgICAgICAgICAgICAg\nICAgLy8gUGVyc2lzdCB0aGUgZmFjdCB0aGF0IHdlIHN0YXJ0ZWQgdGhpcyBu\nZXcKICAgICAgICAgICAgICAgICAgICAvLyBsZWRnZXIgdG8gWksKCiAgICAg\nICAgICAgICAgICAgICAgTGVkZ2VyUmFuZ2VzLkJ1aWxkZXIgYnVpbGRlciA9\nIExlZGdlclJhbmdlcy5uZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAgICAg\nICAgZm9yIChJbk1lbW9yeUxlZGdlclJhbmdlIGltbHIgOiB0b3BpY0luZm8u\nbGVkZ2VyUmFuZ2VzLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJ1aWxkZXIuYWRkUmFuZ2VzKGltbHIucmFuZ2UpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBidWlsZGVyLmFkZFJh\nbmdlcyhsYXN0UmFuZ2UpOwoKICAgICAgICAgICAgICAgICAgICB3cml0ZVRv\ncGljTGVkZ2Vyc05vZGUodG9waWMsIGJ1aWxkZXIuYnVpbGQoKS50b0J5dGVB\ncnJheSgpLCBleHBlY3RlZFZlcnNpb25PZkxlZGdlcnNOb2RlLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BpY0luZm8p\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICB9CgogICAgICAgIHZv\naWQgd3JpdGVUb3BpY0xlZGdlcnNOb2RlKGZpbmFsIEJ5dGVTdHJpbmcgdG9w\naWMsIGJ5dGVbXSBkYXRhLCBpbnQgZXhwZWN0ZWRWZXJzaW9uLCBmaW5hbCBU\nb3BpY0luZm8gdG9waWNJbmZvKSB7CiAgICAgICAgICAgIGZpbmFsIFN0cmlu\nZyB6Tm9kZVBhdGggPSBsZWRnZXJzUGF0aCh0b3BpYyk7CgogICAgICAgICAg\nICB6ay5zZXREYXRhKHpOb2RlUGF0aCwgZGF0YSwgZXhwZWN0ZWRWZXJzaW9u\nLCBuZXcgU2FmZUFzeW5jWktDYWxsYmFjay5TdGF0Q2FsbGJhY2soKSB7CiAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgs\nIE9iamVjdCBjdHgsIFN0YXQgc3RhdCkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChyYyAhPSBLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBr\nZSA9IFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICJDb3VsZCBub3Qgd3JpdGUgbGVkZ2VycyBub2RlIGZvciB0b3BpYzogIiAr\nIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJT\ndWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oa2UpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gRmluYWxseSwgYWxsIGRvbmUK\nICAgICAgICAgICAgICAgICAgICB0b3BpY0luZm9zLnB1dCh0b3BpYywgdG9w\naWNJbmZvKTsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5p\nc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9LCBjdHgpOwoKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBh\nY3F1aXJlIG93bmVyc2hpcCBvZiBhIHRvcGljLCBkb2luZyB3aGF0ZXZlciBp\ncyBuZWVkZWQgdG8gYmUgYWJsZSB0bwogICAgICogcGVyZm9ybSByZWFkcyBh\nbmQgd3JpdGVzIG9uIHRoYXQgdG9waWMgZnJvbSBoZXJlIG9uCiAgICAgKgog\nICAgICogQHBhcmFtIHRvcGljCiAgICAgKiBAcGFyYW0gY2FsbGJhY2sKICAg\nICAqIEBwYXJhbSBjdHgKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCBhY3F1aXJlZFRvcGljKEJ5dGVTdHJpbmcgdG9waWMsIENhbGxi\nYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgcXVl\ndWVyLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IEFjcXVpcmVPcCh0b3Bp\nYywgY2FsbGJhY2ssIGN0eCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNs\nb3NlTGVkZ2VyKExlZGdlckhhbmRsZSBsaCkgewogICAgICAgIC8vIHRyeSB7\nCiAgICAgICAgLy8gbGguYXN5bmNDbG9zZShub09wQ2xvc2VDYWxsYmFjaywg\nbnVsbCk7CiAgICAgICAgLy8gfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRp\nb24gZSkgewogICAgICAgIC8vIGxvZ2dlci5lcnJvcihlKTsKICAgICAgICAv\nLyBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAg\nIC8vIH0KICAgIH0KCiAgICBjbGFzcyBSZWxlYXNlT3AgZXh0ZW5kcyBUb3Bp\nY09wUXVldWVyLlN5bmNocm9ub3VzT3AgewoKICAgICAgICBwdWJsaWMgUmVs\nZWFzZU9wKEJ5dGVTdHJpbmcgdG9waWMpIHsKICAgICAgICAgICAgcXVldWVy\nLnN1cGVyKHRvcGljKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bkludGVybmFsKCkgewogICAgICAgICAg\nICBUb3BpY0luZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5yZW1vdmUodG9w\naWMpOwoKICAgICAgICAgICAgaWYgKHRvcGljSW5mbyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGZvciAoSW5NZW1vcnlMZWRnZXJSYW5nZSBpbWxyIDogdG9waWNJbmZv\nLmxlZGdlclJhbmdlcy52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgaWYg\nKGltbHIuaGFuZGxlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBj\nbG9zZUxlZGdlcihpbWxyLmhhbmRsZSk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh0b3BpY0luZm8uY3VycmVu\ndExlZGdlclJhbmdlICE9IG51bGwgJiYgdG9waWNJbmZvLmN1cnJlbnRMZWRn\nZXJSYW5nZS5oYW5kbGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgY2xv\nc2VMZWRnZXIodG9waWNJbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5oYW5kbGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogUmVsZWFzZSBhbnkgcmVzb3VyY2VzIGZvciB0aGUgdG9waWMgdGhhdCBt\naWdodCBiZSBjdXJyZW50bHkgaGVsZC4gVGhlcmUKICAgICAqIHdvbnQgYmUg\nYW55IHN1YnNlcXVlbnQgcmVhZHMgb3Igd3JpdGVzIG9uIHRoYXQgdG9waWMg\nY29taW5nCiAgICAgKgogICAgICogQHBhcmFtIHRvcGljCiAgICAgKi8KICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgbG9zdFRvcGljKEJ5dGVTdHJp\nbmcgdG9waWMpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRv\ncGljLCBuZXcgUmVsZWFzZU9wKHRvcGljKSk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

