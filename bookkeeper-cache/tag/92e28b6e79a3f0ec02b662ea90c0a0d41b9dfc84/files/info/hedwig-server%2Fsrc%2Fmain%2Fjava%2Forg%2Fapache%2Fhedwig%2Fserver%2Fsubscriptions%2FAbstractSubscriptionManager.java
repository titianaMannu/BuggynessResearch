{"sha":"831488c25d3df2945152567259051512ad27dd68","node_id":"MDQ6QmxvYjE1NzU5NTY6ODMxNDg4YzI1ZDNkZjI5NDUxNTI1NjcyNTkwNTE1MTJhZDI3ZGQ2OA==","size":20804,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/831488c25d3df2945152567259051512ad27dd68","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuc3Vic2NyaXB0aW9uczsK\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLk1hcDsKaW1wb3J0IGphdmEudXRpbC5UaW1lcjsKaW1wb3J0IGphdmEudXRp\nbC5UaW1lclRhc2s7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25j\ndXJyZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNj\naGVkdWxlZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmlt\ncG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Q7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpcHRpb25TdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRl\nT3JBdHRhY2g7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2V4dGVu\nc2lvbnMuTWVzc2FnZUlkVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2V4dGVuc2lvbnMuU3Vic2NyaXB0aW9uU3RhdGVVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5j\nb21tb24uVG9waWNPcFF1ZXVlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnNlcnZlci5wZXJzaXN0ZW5jZS5QZXJzaXN0ZW5jZU1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzLlRvcGljTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci50b3BpY3MuVG9w\naWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnV0aWwuQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy51dGlsLkNhbGxiYWNrVXRpbHM7CgpwdWJsaWMgYWJzdHJhY3QgY2xhc3Mg\nQWJzdHJhY3RTdWJzY3JpcHRpb25NYW5hZ2VyIGltcGxlbWVudHMgU3Vic2Ny\naXB0aW9uTWFuYWdlciwgVG9waWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lciB7\nCgogICAgU2VydmVyQ29uZmlndXJhdGlvbiBjZmc7CiAgICBDb25jdXJyZW50\nSGFzaE1hcDxCeXRlU3RyaW5nLCBNYXA8Qnl0ZVN0cmluZywgSW5NZW1vcnlT\ndWJzY3JpcHRpb25TdGF0ZT4+IHRvcDJzdWIyc2VxID0gbmV3IENvbmN1cnJl\nbnRIYXNoTWFwPEJ5dGVTdHJpbmcsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9y\neVN1YnNjcmlwdGlvblN0YXRlPj4oKTsKICAgIHN0YXRpYyBMb2dnZXIgbG9n\nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQWJzdHJhY3RTdWJzY3Jp\ncHRpb25NYW5hZ2VyLmNsYXNzKTsKCiAgICBUb3BpY09wUXVldWVyIHF1ZXVl\ncjsKICAgIHByaXZhdGUgZmluYWwgQXJyYXlMaXN0PFN1YnNjcmlwdGlvbkV2\nZW50TGlzdGVuZXI+IGxpc3RlbmVycyA9IG5ldyBBcnJheUxpc3Q8U3Vic2Ny\naXB0aW9uRXZlbnRMaXN0ZW5lcj4oKTsKICAgIHByaXZhdGUgZmluYWwgQ29u\nY3VycmVudEhhc2hNYXA8Qnl0ZVN0cmluZywgQXRvbWljSW50ZWdlcj4gdG9w\naWMyTG9jYWxDb3VudHMgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8Qnl0ZVN0\ncmluZywgQXRvbWljSW50ZWdlcj4oKTsKCiAgICAvLyBIYW5kbGUgdG8gdGhl\nIFBlcnNpc3RlbmNlTWFuYWdlciBmb3IgdGhlIHNlcnZlciBzbyB3ZSBjYW4g\ncGFzcyBhbG9uZyB0aGUKICAgIC8vIG1lc3NhZ2UgY29uc3VtZSBwb2ludGVy\ncyBmb3IgZWFjaCB0b3BpYy4KICAgIHByaXZhdGUgZmluYWwgUGVyc2lzdGVu\nY2VNYW5hZ2VyIHBtOwogICAgLy8gVGltZXIgZm9yIHJ1bm5pbmcgYSByZWN1\ncnJpbmcgdGhyZWFkIHRhc2sgdG8gZ2V0IHRoZSBtaW5pbXVtIG1lc3NhZ2UK\nICAgIC8vIHNlcXVlbmNlIElEIGZvciBlYWNoIHRvcGljIHRoYXQgYWxsIHN1\nYnNjcmliZXJzIGZvciBpdCBoYXZlIGNvbnN1bWVkCiAgICAvLyBhbHJlYWR5\nLiBXaXRoIHRoYXQgaW5mb3JtYXRpb24sIHdlIGNhbiBjYWxsIHRoZSBQZXJz\naXN0ZW5jZU1hbmFnZXIgdG8KICAgIC8vIHVwZGF0ZSBpdCBvbiB0aGUgbWVz\nc2FnZXMgdGhhdCBhcmUgc2FmZSB0byBiZSBnYXJiYWdlIGNvbGxlY3RlZC4K\nICAgIHByaXZhdGUgZmluYWwgVGltZXIgdGltZXIgPSBuZXcgVGltZXIodHJ1\nZSk7CiAgICAvLyBJbiBtZW1vcnkgbWFwcGluZyBvZiB0b3BpY3MgdG8gdGhl\nIG1pbmltdW0gY29uc3VtZWQgbWVzc2FnZSBzZXF1ZW5jZSBJRAogICAgLy8g\nZm9yIGFsbCBzdWJzY3JpYmVycyB0byB0aGUgdG9waWMuCiAgICBwcml2YXRl\nIGZpbmFsIENvbmN1cnJlbnRIYXNoTWFwPEJ5dGVTdHJpbmcsIExvbmc+IHRv\ncGljMk1pbkNvbnN1bWVkTWVzc2FnZXNNYXAgPSBuZXcgQ29uY3VycmVudEhh\nc2hNYXA8Qnl0ZVN0cmluZywgTG9uZz4oKTsKCiAgICBwdWJsaWMgQWJzdHJh\nY3RTdWJzY3JpcHRpb25NYW5hZ2VyKFNlcnZlckNvbmZpZ3VyYXRpb24gY2Zn\nLCBUb3BpY01hbmFnZXIgdG0sIFBlcnNpc3RlbmNlTWFuYWdlciBwbSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2NoZWR1bGVk\nRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxlcikgewogICAgICAgIHRoaXMuY2Zn\nID0gY2ZnOwogICAgICAgIHF1ZXVlciA9IG5ldyBUb3BpY09wUXVldWVyKHNj\naGVkdWxlcik7CiAgICAgICAgdG0uYWRkVG9waWNPd25lcnNoaXBDaGFuZ2VM\naXN0ZW5lcih0aGlzKTsKICAgICAgICB0aGlzLnBtID0gcG07CiAgICAgICAg\nLy8gU2NoZWR1bGUgdGhlIHJlY3VycmluZyBNZXNzYWdlc0NvbnN1bWVkVGFz\nayBvbmx5IGlmIGEKICAgICAgICAvLyBQZXJzaXN0ZW5jZU1hbmFnZXIgaXMg\ncGFzc2VkLgogICAgICAgIGlmIChwbSAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHRpbWVyLnNjaGVkdWxlKG5ldyBNZXNzYWdlc0NvbnN1bWVkVGFzaygpLCAw\nLCBjZmcuZ2V0TWVzc2FnZXNDb25zdW1lZFRocmVhZFJ1bkludGVydmFsKCkp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgaXMgdGhl\nIFRpbWVyIFRhc2sgZm9yIGZpbmRpbmcgb3V0IGZvciBlYWNoIHRvcGljLCB3\naGF0IHRoZSBtaW5pbXVtCiAgICAgKiBjb25zdW1lZCBtZXNzYWdlIGJ5IHRo\nZSBzdWJzY3JpYmVycyBhcmUuIFRoaXMgaW5mb3JtYXRpb24gaXMgdXNlZCB0\nbyBwYXNzCiAgICAgKiBhbG9uZyB0byB0aGUgc2VydmVyJ3MgUGVyc2lzdGVu\nY2VNYW5hZ2VyIHNvIGl0IGNhbiBnYXJiYWdlIGNvbGxlY3Qgb2xkZXIKICAg\nICAqIHRvcGljIG1lc3NhZ2VzIHRoYXQgYXJlIG5vIGxvbmdlciBuZWVkZWQg\nYnkgdGhlIHN1YnNjcmliZXJzLgogICAgICovCiAgICBjbGFzcyBNZXNzYWdl\nc0NvbnN1bWVkVGFzayBleHRlbmRzIFRpbWVyVGFzayB7CiAgICAgICAgLyoq\nCiAgICAgICAgICogSW1wbGVtZW50IHRoZSBUaW1lclRhc2sncyBhYnN0cmFj\ndCBydW4gbWV0aG9kLgogICAgICAgICAqLwogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgLy8gV2Ug\nYXJlIGxvb3BpbmcgdGhyb3VnaCByZWxhdGl2ZWx5IHNtYWxsIGluIG1lbW9y\neSBkYXRhIHN0cnVjdHVyZXMKICAgICAgICAgICAgLy8gc28gaXQgc2hvdWxk\nIGJlIHNhZmUgdG8gcnVuIHRoaXMgZmFpcmx5IG9mdGVuLgogICAgICAgICAg\nICBmb3IgKEJ5dGVTdHJpbmcgdG9waWMgOiB0b3Ayc3ViMnNlcS5rZXlTZXQo\nKSkgewogICAgICAgICAgICAgICAgZmluYWwgTWFwPEJ5dGVTdHJpbmcsIElu\nTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHRvcGljU3Vic2NyaXB0aW9ucyA9\nIHRvcDJzdWIyc2VxLmdldCh0b3BpYyk7CiAgICAgICAgICAgICAgICBsb25n\nIG1pbkNvbnN1bWVkTWVzc2FnZSA9IExvbmcuTUFYX1ZBTFVFOwogICAgICAg\nICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBzdWJzY3JpYmVycyB0byB0\naGUgY3VycmVudCB0b3BpYyB0byBmaW5kIHRoZQogICAgICAgICAgICAgICAg\nLy8gbWluaW11bSBjb25zdW1lZCBtZXNzYWdlIGlkLiBUaGUgY29uc3VtZSBw\nb2ludGVycyBhcmUKICAgICAgICAgICAgICAgIC8vIHBlcnNpc3RlZCBsYXpp\nbHkgc28gd2UnbGwgdXNlIHRoZSBzdGFsZSBpbi1tZW1vcnkgdmFsdWUKICAg\nICAgICAgICAgICAgIC8vIGluc3RlYWQuIFRoaXMga2VlcHMgdGhpbmdzIGNv\nbnNpc3RlbnQgaW4gY2FzZSBvZiBhIHNlcnZlcgogICAgICAgICAgICAgICAg\nLy8gY3Jhc2guCiAgICAgICAgICAgICAgICBmb3IgKEluTWVtb3J5U3Vic2Ny\naXB0aW9uU3RhdGUgY3VyU3Vic2NyaXB0aW9uIDogdG9waWNTdWJzY3JpcHRp\nb25zLnZhbHVlcygpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGN1clN1\nYnNjcmlwdGlvbi5nZXRTdWJzY3JpcHRpb25TdGF0ZSgpLmdldE1zZ0lkKCku\nZ2V0TG9jYWxDb21wb25lbnQoKSA8IG1pbkNvbnN1bWVkTWVzc2FnZSkKICAg\nICAgICAgICAgICAgICAgICAgICAgbWluQ29uc3VtZWRNZXNzYWdlID0gY3Vy\nU3Vic2NyaXB0aW9uLmdldFN1YnNjcmlwdGlvblN0YXRlKCkuZ2V0TXNnSWQo\nKS5nZXRMb2NhbENvbXBvbmVudCgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgYm9vbGVhbiBjYWxsUGVyc2lzdGVuY2VNYW5hZ2VyID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIC8vIERvbid0IGNhbGwgdGhlIFBlcnNp\nc3RlbmNlTWFuYWdlciBpZiBub2JvZHkgaXMgc3Vic2NyaWJlZCB0bwogICAg\nICAgICAgICAgICAgLy8gdGhlIHRvcGljIHlldCwgb3IgdGhlIGNvbnN1bWUg\ncG9pbnRlciBoYXMgbm90IGNoYW5nZWQgc2luY2UKICAgICAgICAgICAgICAg\nIC8vIHRoZSBsYXN0IHRpbWUsIG9yIGlmIHRoaXMgaXMgdGhlIGluaXRpYWwg\nc3Vic2NyaXB0aW9uLgogICAgICAgICAgICAgICAgaWYgKHRvcGljU3Vic2Ny\naXB0aW9ucy5pc0VtcHR5KCkKICAgICAgICAgICAgICAgICAgICAgICAgfHwg\nKHRvcGljMk1pbkNvbnN1bWVkTWVzc2FnZXNNYXAuY29udGFpbnNLZXkodG9w\naWMpICYmIHRvcGljMk1pbkNvbnN1bWVkTWVzc2FnZXNNYXAuZ2V0KHRvcGlj\nKSA9PSBtaW5Db25zdW1lZE1lc3NhZ2UpCiAgICAgICAgICAgICAgICAgICAg\nICAgIHx8IG1pbkNvbnN1bWVkTWVzc2FnZSA9PSAwKSB7CiAgICAgICAgICAg\nICAgICAgICAgY2FsbFBlcnNpc3RlbmNlTWFuYWdlciA9IGZhbHNlOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gUGFzcyB0aGUgbmV3\nIGNvbnN1bWUgcG9pbnRlcnMgdG8gdGhlIFBlcnNpc3RlbmNlTWFuYWdlci4K\nICAgICAgICAgICAgICAgIGlmIChjYWxsUGVyc2lzdGVuY2VNYW5hZ2VyKSB7\nCiAgICAgICAgICAgICAgICAgICAgdG9waWMyTWluQ29uc3VtZWRNZXNzYWdl\nc01hcC5wdXQodG9waWMsIG1pbkNvbnN1bWVkTWVzc2FnZSk7CiAgICAgICAg\nICAgICAgICAgICAgcG0uY29uc3VtZWRVbnRpbCh0b3BpYywgbWluQ29uc3Vt\nZWRNZXNzYWdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGNsYXNzIEFjcXVpcmVPcCBl\neHRlbmRzIFRvcGljT3BRdWV1ZXIuQXN5bmNocm9ub3VzT3A8Vm9pZD4gewog\nICAgICAgIHB1YmxpYyBBY3F1aXJlT3AoQnl0ZVN0cmluZyB0b3BpYywgQ2Fs\nbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgcXVldWVyLnN1cGVyKHRvcGljLCBjYWxsYmFjaywgY3R4KTsKICAgICAg\nICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1\nbigpIHsKICAgICAgICAgICAgaWYgKHRvcDJzdWIyc2VxLmNvbnRhaW5zS2V5\nKHRvcGljKSkgewogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNo\nZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVh\nZFN1YnNjcmlwdGlvbnModG9waWMsIG5ldyBDYWxsYmFjazxNYXA8Qnl0ZVN0\ncmluZywgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZT4+KCkgewogICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9u\nIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlv\nbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChmaW5hbCBPYmplY3QgY3R4LAog\nICAgICAgICAgICAgICAgZmluYWwgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5\nU3Vic2NyaXB0aW9uU3RhdGU+IHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gV2UndmUganVzdCBpbmhlcml0ZWQgYSBidW5j\naCBvZiBzdWJzY3JpYmVyIGZvciB0aGlzCiAgICAgICAgICAgICAgICAgICAg\nLy8gdG9waWMsIHNvbWUgb2Ygd2hpY2ggbWF5IGJlIGxvY2FsLiBJZiB0aGV5\nIGFyZSwgdGhlbiB3ZQogICAgICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8g\nKDEpIG5vdGlmeSBsaXN0ZW5lcnMgb2YgdGhpcyBhbmQgKDIpIHJlY29yZCB0\naGUKICAgICAgICAgICAgICAgICAgICAvLyBudW1iZXIgZm9yIGJvb2trZWVw\naW5nIHNvIHRoYXQgZnV0dXJlCiAgICAgICAgICAgICAgICAgICAgLy8gc3Vi\nc2NyaWJlcy91bnN1YnNjcmliZXMgY2FuIGVmZmljaWVudGx5IG5vdGlmeSBs\naXN0ZW5lcnMuCgogICAgICAgICAgICAgICAgICAgIC8vIENvdW50IHRoZSBu\ndW1iZXIgb2YgbG9jYWwgc3Vic2NyaWJlcnMgd2UganVzdCBpbmhlcml0ZWQu\nCiAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBsb29wIGlzIE9LIHNpbmNl\nIHRoZSBudW1iZXIgb2Ygc3Vic2NyaWJlcnMgcGVyIHRvcGljCiAgICAgICAg\nICAgICAgICAgICAgLy8gaXMgZXhwZWN0ZWQgdG8gYmUgc21hbGwuCiAgICAg\nICAgICAgICAgICAgICAgaW50IGxvY2FsQ291bnQgPSAwOwogICAgICAgICAg\nICAgICAgICAgIGZvciAoQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQgOiByZXN1\nbHRPZk9wZXJhdGlvbi5rZXlTZXQoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKCFTdWJzY3JpcHRpb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJl\ncihzdWJzY3JpYmVySWQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbG9jYWxDb3VudCsrOwogICAgICAgICAgICAgICAgICAgIHRvcGljMkxvY2Fs\nQ291bnRzLnB1dCh0b3BpYywgbmV3IEF0b21pY0ludGVnZXIobG9jYWxDb3Vu\ndCkpOwoKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZmluYWwgImNvbW1p\ndCIgKGFuZCAiYWJvcnQiKSBvcGVyYXRpb25zLgogICAgICAgICAgICAgICAg\nICAgIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNiMiA9IG5ldyBDYWxsYmFjazxW\nb2lkPigpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25G\nYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJT\ndWJzY3JpcHRpb24gbWFuYWdlciBmYWlsZWQgdG8gYWNxdWlyZWQgdG9waWMg\nIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdGlvbik7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBudWxs\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQg\ndm9pZE9iaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9wMnN1\nYjJzZXEucHV0KHRvcGljLCByZXN1bHRPZk9wZXJhdGlvbik7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiU3Vic2NyaXB0aW9u\nIG1hbmFnZXIgc3VjY2Vzc2Z1bGx5IGFjcXVpcmVkIHRvcGljOiAiICsgdG9w\naWMudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICB9OwoKICAg\nICAgICAgICAgICAgICAgICAvLyBOb3RpZnkgbGlzdGVuZXJzIGlmIG5lY2Vz\nc2FyeS4KICAgICAgICAgICAgICAgICAgICBpZiAobG9jYWxDb3VudCA+IDAp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5U3Vic2NyaWJlKHRv\ncGljLCBmYWxzZSwgY2IyLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNiMi5vcGVyYXRpb25G\naW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0sIGN0eCk7CgogICAgICAg\nIH0KCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIG5vdGlmeVN1YnNjcmliZShC\neXRlU3RyaW5nIHRvcGljLCBib29sZWFuIHN5bmNocm9ub3VzLCBmaW5hbCBD\nYWxsYmFjazxWb2lkPiBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAg\nIENhbGxiYWNrPFZvaWQ+IG1jYiA9IENhbGxiYWNrVXRpbHMubXVsdGlDYWxs\nYmFjayhsaXN0ZW5lcnMuc2l6ZSgpLCBjYiwgY3R4KTsKICAgICAgICBmb3Ig\nKFN1YnNjcmlwdGlvbkV2ZW50TGlzdGVuZXIgbGlzdGVuZXIgOiBsaXN0ZW5l\ncnMpIHsKICAgICAgICAgICAgbGlzdGVuZXIub25GaXJzdExvY2FsU3Vic2Ny\naWJlKHRvcGljLCBzeW5jaHJvbm91cywgbWNiKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGaWd1cmUgb3V0IHdobyBpcyBzdWJzY3JpYmVk\nLiBEbyBub3RoaW5nIGlmIGFscmVhZHkgYWNxdWlyZWQuIElmIHRoZXJlJ3MK\nICAgICAqIGFuIGVycm9yIHJlYWRpbmcgdGhlIHN1YnNjcmliZXJzJyBzZXF1\nZW5jZSBJRHMsIHRoZW4gdGhlIHRvcGljIGlzIG5vdAogICAgICogYWNxdWly\nZWQuCiAgICAgKgogICAgICogQHBhcmFtIHRvcGljCiAgICAgKiBAcGFyYW0g\nY2FsbGJhY2sKICAgICAqIEBwYXJhbSBjdHgKICAgICAqLwogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBhY3F1aXJlZFRvcGljKGZpbmFsIEJ5dGVT\ndHJpbmcgdG9waWMsIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBP\nYmplY3QgY3R4KSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0\nb3BpYywgbmV3IEFjcXVpcmVPcCh0b3BpYywgY2FsbGJhY2ssIGN0eCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlIHRoZSBsb2NhbCBtYXBwaW5n\nLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGxvc3RU\nb3BpYyhCeXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAgdG9wMnN1YjJzZXEu\ncmVtb3ZlKHRvcGljKTsKICAgICAgICBBdG9taWNJbnRlZ2VyIGNvdW50ID0g\ndG9waWMyTG9jYWxDb3VudHMucmVtb3ZlKHRvcGljKTsKICAgICAgICAvLyBO\nb3RpZnkgbGlzdGVuZXJzIGlmIG5lY2Vzc2FyeS4KICAgICAgICBpZiAobnVs\nbCAhPSBjb3VudCAmJiBjb3VudC5nZXQoKSA+IDApCiAgICAgICAgICAgIG5v\ndGlmeVVuc3ViY3JpYmUodG9waWMpOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBub3RpZnlVbnN1YmNyaWJlKEJ5dGVTdHJpbmcgdG9waWMpIHsKICAgICAg\nICBmb3IgKFN1YnNjcmlwdGlvbkV2ZW50TGlzdGVuZXIgbGlzdGVuZXIgOiBs\naXN0ZW5lcnMpCiAgICAgICAgICAgIGxpc3RlbmVyLm9uTGFzdExvY2FsVW5z\ndWJzY3JpYmUodG9waWMpOwogICAgfQoKICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCB2b2lkIHJlYWRTdWJzY3JpcHRpb25zKGZpbmFsIEJ5dGVTdHJpbmcgdG9w\naWMsCiAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPE1hcDxCeXRlU3RyaW5n\nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlPj4gY2IsIGZpbmFsIE9iamVj\ndCBjdHgpOwoKICAgIHByaXZhdGUgY2xhc3MgU3Vic2NyaWJlT3AgZXh0ZW5k\ncyBUb3BpY09wUXVldWVyLkFzeW5jaHJvbm91c09wPE1lc3NhZ2VTZXFJZD4g\newogICAgICAgIFN1YnNjcmliZVJlcXVlc3Qgc3ViUmVxdWVzdDsKICAgICAg\nICBNZXNzYWdlU2VxSWQgY29uc3VtZVNlcUlkOwoKICAgICAgICBwdWJsaWMg\nU3Vic2NyaWJlT3AoQnl0ZVN0cmluZyB0b3BpYywgU3Vic2NyaWJlUmVxdWVz\ndCBzdWJSZXF1ZXN0LCBNZXNzYWdlU2VxSWQgY29uc3VtZVNlcUlkLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFjazxNZXNzYWdlU2VxSWQ+\nIGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVlci5z\ndXBlcih0b3BpYywgY2FsbGJhY2ssIGN0eCk7CiAgICAgICAgICAgIHRoaXMu\nc3ViUmVxdWVzdCA9IHN1YlJlcXVlc3Q7CiAgICAgICAgICAgIHRoaXMuY29u\nc3VtZVNlcUlkID0gY29uc3VtZVNlcUlkOwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewoKICAgICAg\nICAgICAgZmluYWwgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0\naW9uU3RhdGU+IHRvcGljU3Vic2NyaXB0aW9ucyA9IHRvcDJzdWIyc2VxLmdl\ndCh0b3BpYyk7CiAgICAgICAgICAgIGlmICh0b3BpY1N1YnNjcmlwdGlvbnMg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVk\nKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJs\nZUZvclRvcGljRXhjZXB0aW9uKCIiKSk7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZpbmFsIEJ5dGVTdHJp\nbmcgc3Vic2NyaWJlcklkID0gc3ViUmVxdWVzdC5nZXRTdWJzY3JpYmVySWQo\nKTsKICAgICAgICAgICAgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSBzdWJz\nY3JpcHRpb25TdGF0ZSA9IHRvcGljU3Vic2NyaXB0aW9ucy5nZXQoc3Vic2Ny\naWJlcklkKTsKICAgICAgICAgICAgQ3JlYXRlT3JBdHRhY2ggY3JlYXRlT3JB\ndHRhY2ggPSBzdWJSZXF1ZXN0LmdldENyZWF0ZU9yQXR0YWNoKCk7CgogICAg\nICAgICAgICBpZiAoc3Vic2NyaXB0aW9uU3RhdGUgIT0gbnVsbCkgewoKICAg\nICAgICAgICAgICAgIGlmIChjcmVhdGVPckF0dGFjaC5lcXVhbHMoQ3JlYXRl\nT3JBdHRhY2guQ1JFQVRFKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmlu\nZyBtc2cgPSAiVG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIg\nc3Vic2NyaWJlcklkOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiByZXF1ZXN0\nZWQgY3JlYXRpbmcgYSBzdWJzY3JpcHRpb24gYnV0IGl0IGlzIGFscmVhZHkg\nc3Vic2NyaWJlZCB3aXRoIHN0YXRlOiAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgU3Vic2NyaXB0aW9uU3RhdGVVdGlscy50b1N0cmlu\nZyhzdWJzY3JpcHRpb25TdGF0ZS5nZXRTdWJzY3JpcHRpb25TdGF0ZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcobXNnKTsKICAgICAg\nICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLkNsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9u\nKG1zZykpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UganVzdCBh\ndHRhY2gKICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiVG9w\naWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgc3Vic2NyaWJlcklk\nOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgIiBhdHRhY2hpbmcgdG8gc3Vic2Ny\naXB0aW9uIHdpdGggc3RhdGU6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyBTdWJzY3JpcHRpb25TdGF0ZVV0aWxzLnRvU3RyaW5nKHN1\nYnNjcmlwdGlvblN0YXRlLmdldFN1YnNjcmlwdGlvblN0YXRlKCkpKTsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25G\naW5pc2hlZChjdHgsIHN1YnNjcmlwdGlvblN0YXRlLmdldExhc3RDb25zdW1l\nU2VxSWQoKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIHdlIGRvbid0IGhhdmUgYSBtYXBwaW5nIGZv\nciB0aGlzIHN1YnNjcmliZXIKICAgICAgICAgICAgaWYgKGNyZWF0ZU9yQXR0\nYWNoLmVxdWFscyhDcmVhdGVPckF0dGFjaC5BVFRBQ0gpKSB7CiAgICAgICAg\nICAgICAgICBTdHJpbmcgbXNnID0gIlRvcGljOiAiICsgdG9waWMudG9TdHJp\nbmdVdGY4KCkgKyAiIHN1YnNjcmliZXJJZDogIiArIHN1YnNjcmliZXJJZC50\nb1N0cmluZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nIiByZXF1ZXN0ZWQgYXR0YWNoaW5nIHRvIGFuIGV4aXN0aW5nIHN1YnNjcmlw\ndGlvbiBidXQgaXQgaXMgbm90IHN1YnNjcmliZWQiOwogICAgICAgICAgICAg\nICAgbG9nZ2VyLmRlYnVnKG1zZyk7CiAgICAgICAgICAgICAgICBjYi5vcGVy\nYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLkNsaWVudE5v\ndFN1YnNjcmliZWRFeGNlcHRpb24obXNnKSk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdyB0aGUg\naGFyZCBjYXNlLCB0aGlzIGlzIGEgYnJhbmQgbmV3IHN1YnNjcmlwdGlvbiwg\nbXVzdCByZWNvcmQKICAgICAgICAgICAgZmluYWwgU3Vic2NyaXB0aW9uU3Rh\ndGUgbmV3U3RhdGUgPSBTdWJzY3JpcHRpb25TdGF0ZS5uZXdCdWlsZGVyKCku\nc2V0TXNnSWQoY29uc3VtZVNlcUlkKS5idWlsZCgpOwogICAgICAgICAgICBj\ncmVhdGVTdWJzY3JpcHRpb25TdGF0ZSh0b3BpYywgc3Vic2NyaWJlcklkLCBu\nZXdTdGF0ZSwgbmV3IENhbGxiYWNrPFZvaWQ+KCkgewogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2Vw\ndGlvbikgewogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxl\nZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdE9m\nT3BlcmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2s8Vm9p\nZD4gY2IyID0gbmV3IENhbGxiYWNrPFZvaWQ+KCkgewoKICAgICAgICAgICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJT\ndWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIuZXJyb3IoInN1YnNjcmlwdGlvbiBmb3Igc3Vic2Ny\naWJlciAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpICsgIiB0byB0\nb3BpYyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgZmFpbGVkIGR1ZSB0byBm\nYWlsZWQgbGlzdGVuZXIgY2FsbGJhY2siLCBleGNlcHRpb24pOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwg\nZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBj\ndHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHRvcGljU3Vic2NyaXB0aW9ucy5wdXQoc3Vic2NyaWJl\ncklkLCBuZXcgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZShuZXdTdGF0ZSkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmlu\naXNoZWQoY3R4LCBjb25zdW1lU2VxSWQpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAg\nICAgICAgIGlmICghU3Vic2NyaXB0aW9uU3RhdGVVdGlscy5pc0h1YlN1YnNj\ncmliZXIoc3ViUmVxdWVzdC5nZXRTdWJzY3JpYmVySWQoKSkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICYmIHRvcGljMkxvY2FsQ291bnRzLmdldCh0\nb3BpYykuaW5jcmVtZW50QW5kR2V0KCkgPT0gMSkKICAgICAgICAgICAgICAg\nICAgICAgICAgbm90aWZ5U3Vic2NyaWJlKHRvcGljLCBzdWJSZXF1ZXN0Lmdl\ndFN5bmNocm9ub3VzKCksIGNiMiwgY3R4KTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgIGNiMi5vcGVyYXRpb25G\naW5pc2hlZChjdHgsIHJlc3VsdE9mT3BlcmF0aW9uKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICB9CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXJ2ZVN1YnNjcmliZVJl\ncXVlc3QoQnl0ZVN0cmluZyB0b3BpYywgU3Vic2NyaWJlUmVxdWVzdCBzdWJS\nZXF1ZXN0LCBNZXNzYWdlU2VxSWQgY29uc3VtZVNlcUlkLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNrPE1lc3NhZ2VT\nZXFJZD4gY2FsbGJhY2ssIE9iamVjdCBjdHgpIHsKICAgICAgICBxdWV1ZXIu\ncHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgU3Vic2NyaWJlT3AodG9waWMs\nIHN1YlJlcXVlc3QsIGNvbnN1bWVTZXFJZCwgY2FsbGJhY2ssIGN0eCkpOwog\nICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQ29uc3VtZU9wIGV4dGVuZHMgVG9w\naWNPcFF1ZXVlci5Bc3luY2hyb25vdXNPcDxWb2lkPiB7CiAgICAgICAgQnl0\nZVN0cmluZyBzdWJzY3JpYmVySWQ7CiAgICAgICAgTWVzc2FnZVNlcUlkIGNv\nbnN1bWVTZXFJZDsKCiAgICAgICAgcHVibGljIENvbnN1bWVPcChCeXRlU3Ry\naW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgTWVzc2FnZVNl\ncUlkIGNvbnN1bWVTZXFJZCwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssCiAg\nICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QgY3R4KSB7CiAgICAgICAg\nICAgIHF1ZXVlci5zdXBlcih0b3BpYywgY2FsbGJhY2ssIGN0eCk7CiAgICAg\nICAgICAgIHRoaXMuc3Vic2NyaWJlcklkID0gc3Vic2NyaWJlcklkOwogICAg\nICAgICAgICB0aGlzLmNvbnN1bWVTZXFJZCA9IGNvbnN1bWVTZXFJZDsKICAg\nICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIHJ1bigpIHsKICAgICAgICAgICAgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5\nU3Vic2NyaXB0aW9uU3RhdGU+IHRvcGljU3VicyA9IHRvcDJzdWIyc2VxLmdl\ndCh0b3BpYyk7CiAgICAgICAgICAgIGlmICh0b3BpY1N1YnMgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBu\ndWxsKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSBzdWJTdGF0\nZSA9IHRvcGljU3Vicy5nZXQoc3Vic2NyaWJlcklkKTsKICAgICAgICAgICAg\naWYgKHN1YlN0YXRlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGNiLm9w\nZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdWJTdGF0\nZS5zZXRMYXN0Q29uc3VtZVNlcUlkKGNvbnN1bWVTZXFJZCwgY2ZnLmdldENv\nbnN1bWVJbnRlcnZhbCgpKSkgewogICAgICAgICAgICAgICAgdXBkYXRlU3Vi\nc2NyaXB0aW9uU3RhdGUodG9waWMsIHN1YnNjcmliZXJJZCwgc3ViU3RhdGUu\nZ2V0U3Vic2NyaXB0aW9uU3RhdGUoKSwgY2IsIGN0eCk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWco\nIk9ubHkgYWR2YW5jZWQgY29uc3VtZSBwb2ludGVyIGluIG1lbW9yeSwgd2ls\nbCBwZXJzaXN0IGxhdGVyLCB0b3BpYzogIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiBzdWJz\nY3JpYmVySWQ6ICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHBlcnNpc3RlbnRT\ndGF0ZTogIiArIFN1YnNjcmlwdGlvblN0YXRlVXRpbHMudG9TdHJpbmcoc3Vi\nU3RhdGUuZ2V0U3Vic2NyaXB0aW9uU3RhdGUoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiIGluLW1lbW9yeSBjb25zdW1lLWlkOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgTWVzc2FnZUlk\nVXRpbHMubXNnSWRUb1JlYWRhYmxlU3RyaW5nKHN1YlN0YXRlLmdldExhc3RD\nb25zdW1lU2VxSWQoKSkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAg\nICAgICAgfQoKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBzZXRDb25zdW1lU2VxSWRGb3JTdWJzY3JpYmVyKEJ5dGVT\ndHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBNZXNzYWdl\nU2VxSWQgY29uc3VtZVNlcUlkLAogICAgICAgICAgICBDYWxsYmFjazxWb2lk\nPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgIHF1ZXVlci5wdXNo\nQW5kTWF5YmVSdW4odG9waWMsIG5ldyBDb25zdW1lT3AodG9waWMsIHN1YnNj\ncmliZXJJZCwgY29uc3VtZVNlcUlkLCBjYWxsYmFjaywgY3R4KSk7CiAgICB9\nCgogICAgcHJpdmF0ZSBjbGFzcyBVbnN1YnNjcmliZU9wIGV4dGVuZHMgVG9w\naWNPcFF1ZXVlci5Bc3luY2hyb25vdXNPcDxWb2lkPiB7CiAgICAgICAgQnl0\nZVN0cmluZyBzdWJzY3JpYmVySWQ7CgogICAgICAgIHB1YmxpYyBVbnN1YnNj\ncmliZU9wKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewog\nICAgICAgICAgICBxdWV1ZXIuc3VwZXIodG9waWMsIGNhbGxiYWNrLCBjdHgp\nOwogICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJJZCA9IHN1YnNjcmliZXJJ\nZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgZmluYWwgTWFwPEJ5dGVTdHJp\nbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHRvcGljU3Vic2NyaXB0\naW9ucyA9IHRvcDJzdWIyc2VxLmdldCh0b3BpYyk7CiAgICAgICAgICAgIGlm\nICh0b3BpY1N1YnNjcmlwdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlv\nbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9uKCIiKSk7\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIGlmICghdG9waWNTdWJzY3JpcHRpb25zLmNvbnRhaW5zS2V5KHN1\nYnNjcmliZXJJZCkpIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZh\naWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uQ2xpZW50Tm90U3Vic2Ny\naWJlZEV4Y2VwdGlvbigiIikpOwogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBkZWxldGVTdWJzY3JpcHRpb25T\ndGF0ZSh0b3BpYywgc3Vic2NyaWJlcklkLCBuZXcgQ2FsbGJhY2s8Vm9pZD4o\nKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJT\ndWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAg\nY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0aW9uKTsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBj\ndHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgICAg\nICAgICB0b3BpY1N1YnNjcmlwdGlvbnMucmVtb3ZlKHN1YnNjcmliZXJJZCk7\nCiAgICAgICAgICAgICAgICAgICAgLy8gTm90aWZ5IGxpc3RlbmVycyBpZiBu\nZWNlc3NhcnkuCiAgICAgICAgICAgICAgICAgICAgaWYgKCFTdWJzY3JpcHRp\nb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJzY3JpYmVySWQpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAmJiB0b3BpYzJMb2NhbENvdW50\ncy5nZXQodG9waWMpLmRlY3JlbWVudEFuZEdldCgpID09IDApCiAgICAgICAg\nICAgICAgICAgICAgICAgIG5vdGlmeVVuc3ViY3JpYmUodG9waWMpOwogICAg\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVs\nbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGN0eCk7Cgog\nICAgICAgIH0KCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCB1bnN1YnNjcmliZShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1\nYnNjcmliZXJJZCwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBj\ndHgpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBu\nZXcgVW5zdWJzY3JpYmVPcCh0b3BpYywgc3Vic2NyaWJlcklkLCBjYWxsYmFj\naywgY3R4KSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3QgdGhyZWFkLXNh\nZmUuCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgYWRk\nTGlzdGVuZXIoU3Vic2NyaXB0aW9uRXZlbnRMaXN0ZW5lciBsaXN0ZW5lcikg\newogICAgICAgIGxpc3RlbmVycy5hZGQobGlzdGVuZXIpOwogICAgfQoKICAg\nIC8qKgogICAgICogTWV0aG9kIHRvIHN0b3AgdGhpcyBjbGFzcyBncmFjZWZ1\nbGx5IGluY2x1ZGluZyByZWxlYXNpbmcgYW55IHJlc291cmNlcwogICAgICog\ndXNlZCBhbmQgc3RvcHBpbmcgYWxsIHRocmVhZHMgc3Bhd25lZC4KICAgICAq\nLwogICAgcHVibGljIHZvaWQgc3RvcCgpIHsKICAgICAgICB0aW1lci5jYW5j\nZWwoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCBjcmVh\ndGVTdWJzY3JpcHRpb25TdGF0ZShmaW5hbCBCeXRlU3RyaW5nIHRvcGljLCBC\neXRlU3RyaW5nIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgU3Vic2NyaXB0\naW9uU3RhdGUgc3RhdGUsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmpl\nY3QgY3R4KTsKCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCB1cGRhdGVT\ndWJzY3JpcHRpb25TdGF0ZShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5n\nIHN1YnNjcmliZXJJZCwgU3Vic2NyaXB0aW9uU3RhdGUgc3RhdGUsCiAgICAg\nICAgICAgIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY3R4KTsK\nCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCBkZWxldGVTdWJzY3JpcHRp\nb25TdGF0ZShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmli\nZXJJZCwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssCiAgICAgICAgICAgIE9i\namVjdCBjdHgpOwoKfQo=\n","encoding":"base64"}

