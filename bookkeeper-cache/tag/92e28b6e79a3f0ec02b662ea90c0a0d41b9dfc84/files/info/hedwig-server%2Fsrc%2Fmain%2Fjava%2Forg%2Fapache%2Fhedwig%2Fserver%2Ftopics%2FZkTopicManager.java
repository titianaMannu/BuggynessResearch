{"sha":"b1bd9a448ee0d64ac40f5d7d2e155bbac5ca87eb","node_id":"MDQ6QmxvYjE1NzU5NTY6YjFiZDlhNDQ4ZWUwZDY0YWM0MGY1ZDdkMmUxNTViYmFjNWNhODdlYg==","size":18957,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b1bd9a448ee0d64ac40f5d7d2e155bbac5ca87eb","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIGphdmEubmV0LlVua25vd25Ib3N0RXhjZXB0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU3luY2hyb25vdXNRdWV1ZTsK\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5DcmVh\ndGVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2\nZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Db2RlOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5kYXRhLlN0YXQ7CgppbXBvcnQgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5Db25jdXJyZW5jeVV0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5FaXRoZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3M7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy56b29rZWVwZXIuU2FmZUFzeW5j\nWktDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBl\nci5aa1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuem9va2VlcGVy\nLlNhZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuem9va2VlcGVyLlNhZmVBc3luY1pLQ2FsbGJhY2su\nU3RhdENhbGxiYWNrOwoKLyoqCiAqIFRvcGljcyBhcmUgb3BlcmF0ZWQgb24g\naW4gcGFyYWxsZWwgYXMgdGhleSBhcmUgaW5kZXBlbmRlbnQuCiAqCiAqLwpw\ndWJsaWMgY2xhc3MgWmtUb3BpY01hbmFnZXIgZXh0ZW5kcyBBYnN0cmFjdFRv\ncGljTWFuYWdlciBpbXBsZW1lbnRzIFRvcGljTWFuYWdlciB7CgogICAgc3Rh\ndGljIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlciha\na1RvcGljTWFuYWdlci5jbGFzcyk7CiAgICBSYW5kb20gcmFuZCA9IG5ldyBS\nYW5kb20oKTsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgc3RvcmFnZSBm\nb3IgdG9waWMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgWm9vS2Vl\ncGVyIHprOwogICAgU3RyaW5nIGVwaGVtZXJhbE5vZGVQYXRoOwoKICAgIFN0\nYXRDYWxsYmFjayBsb2FkUmVwb3J0aW5nU3RhdENhbGxiYWNrID0gbmV3IFN0\nYXRDYWxsYmFjaygpIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRo\nLCBPYmplY3QgY3R4LCBTdGF0IHN0YXQpIHsKICAgICAgICAgICAgaWYgKHJj\nICE9IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk9LLmludFZhbHVlKCkpIHsKICAg\nICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJGYWlsZWQgdG8gdXBkYXRlIGxv\nYWQgaW5mb3JtYXRpb24gaW4gemsiKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH07CgogICAgLy8gQm9vbGVhbiBmbGFnIGluZGljYXRpbmcgaWYg\nd2Ugc2hvdWxkIHN1c3BlbmQgYWN0aXZpdHkuIElmIHRoaXMgaXMgdHJ1ZSwK\nICAgIC8vIGFsbCBvZiB0aGUgT3BzIHB1dCBpbnRvIHRoZSBxdWV1ZXIgd2ls\nbCBmYWlsIGF1dG9tYXRpY2FsbHkuCiAgICBwcm90ZWN0ZWQgdm9sYXRpbGUg\nYm9vbGVhbiBpc1N1c3BlbmRlZCA9IGZhbHNlOwoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgbmV3IHRvcGljIG1hbmFnZXIuIFBhc3MgaW4gYW4gYWN0aXZl\nIFpvb0tlZXBlciBjbGllbnQgb2JqZWN0LgogICAgICoKICAgICAqIEBwYXJh\nbSB6awogICAgICovCiAgICBwdWJsaWMgWmtUb3BpY01hbmFnZXIoZmluYWwg\nWm9vS2VlcGVyIHprLCBmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNmZywg\nU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxlcikKICAgICAgICAg\nICAgdGhyb3dzIFVua25vd25Ib3N0RXhjZXB0aW9uLCBQdWJTdWJFeGNlcHRp\nb24gewoKICAgICAgICBzdXBlcihjZmcsIHNjaGVkdWxlcik7CiAgICAgICAg\ndGhpcy56ayA9IHprOwogICAgICAgIHRoaXMuZXBoZW1lcmFsTm9kZVBhdGgg\nPSBjZmcuZ2V0WmtIb3N0c1ByZWZpeChuZXcgU3RyaW5nQnVpbGRlcigpKS5h\ncHBlbmQoIi8iKS5hcHBlbmQoYWRkcikudG9TdHJpbmcoKTsKCiAgICAgICAg\nemsucmVnaXN0ZXIobmV3IFdhdGNoZXIoKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRF\ndmVudCBldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFR5\ncGUoKS5lcXVhbHMoV2F0Y2hlci5FdmVudC5FdmVudFR5cGUuTm9uZSkpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZ2V0U3RhdGUoKS5lcXVh\nbHMoV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZS5EaXNjb25uZWN0ZWQpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJaSyBjbGll\nbnQgaGFzIGJlZW4gZGlzY29ubmVjdGVkIHRvIHRoZSBaSyBzZXJ2ZXIhIik7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VzcGVuZGVkID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFN0YXRl\nKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5l\nY3RlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3VzcGVu\nZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5m\nbygiWksgY2xpZW50IGhhcyBiZWVuIHJlY29ubmVjdGVkIHRvIHRoZSBaSyBz\nZXJ2ZXIhIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgaXNTdXNwZW5kZWQgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAvLyBDaGVjayBmb3IgZXhwaXJlZCBjb25uZWN0aW9uLgogICAgICAgICAg\nICAgICAgaWYgKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZl\nbnQuS2VlcGVyU3RhdGUuRXhwaXJlZCkpIHsKICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuZXJyb3IoIlpLIGNsaWVudCBjb25uZWN0aW9uIHRvIHRoZSBa\nSyBzZXJ2ZXIgaGFzIGV4cGlyZWQhIik7CiAgICAgICAgICAgICAgICAgICAg\nU3lzdGVtLmV4aXQoMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9KTsKICAgICAgICBmaW5hbCBTeW5jaHJvbm91c1F1ZXVl\nPEVpdGhlcjxWb2lkLCBQdWJTdWJFeGNlcHRpb24+PiBxdWV1ZSA9IG5ldyBT\neW5jaHJvbm91c1F1ZXVlPEVpdGhlcjxWb2lkLCBQdWJTdWJFeGNlcHRpb24+\nPigpOwoKICAgICAgICByZWdpc3RlcldpdGhab29rZWVwZXIobmV3IENhbGxi\nYWNrPFZvaWQ+KCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1\nYlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIGxv\nZ2dlci5lcnJvcigiRmFpbGVkIHRvIHJlZ2lzdGVyIGh1YiB3aXRoIHpvb2tl\nZXBlciIsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICBDb25jdXJyZW5j\neVV0aWxzLnB1dChxdWV1ZSwgRWl0aGVyLm9mKChWb2lkKSBudWxsLCBleGNl\ncHRpb24pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9i\namVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAg\nICAgICAgIGxvZ2dlci5pbmZvKCJTdWNjZXNzZnVsbHkgcmVnaXN0ZXJlZCBo\ndWIgd2l0aCB6b29rZWVwZXIiKTsKICAgICAgICAgICAgICAgIENvbmN1cnJl\nbmN5VXRpbHMucHV0KHF1ZXVlLCBFaXRoZXIub2YocmVzdWx0T2ZPcGVyYXRp\nb24sIChQdWJTdWJFeGNlcHRpb24pIG51bGwpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0sIG51bGwpOwoKICAgICAgICBQdWJTdWJFeGNlcHRpb24gcHNl\nID0gQ29uY3VycmVuY3lVdGlscy50YWtlKHF1ZXVlKS5yaWdodCgpOwoKICAg\nICAgICBpZiAocHNlICE9IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cgcHNl\nOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIHJlZ2lzdGVyV2l0aFpvb2tl\nZXBlcihmaW5hbCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0\neCkgewoKICAgICAgICBaa1V0aWxzLmNyZWF0ZUZ1bGxQYXRoT3B0aW1pc3Rp\nYyh6aywgZXBoZW1lcmFsTm9kZVBhdGgsIGdldEN1cnJlbnRMb2FkRGF0YSgp\nLCBJZHMuT1BFTl9BQ0xfVU5TQUZFLAogICAgICAgIENyZWF0ZU1vZGUuRVBI\nRU1FUkFMLCBuZXcgU2FmZUFzeW5jWktDYWxsYmFjay5TdHJpbmdDYWxsYmFj\naygpIHsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJs\naWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRo\nLCBPYmplY3QgY3R4LCBTdHJpbmcgbmFtZSkgewogICAgICAgICAgICAgICAg\naWYgKHJjID09IENvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAg\nICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgaWYgKHJjICE9IENvZGUuTk9ERUVYSVNUUy5p\nbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgS2VlcGVyRXhjZXB0\naW9uIGtlID0gWmtVdGlscy5sb2dFcnJvckFuZENyZWF0ZVpLRXhjZXB0aW9u\nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAiQ291bGQgbm90IGNyZWF0ZSBlcGhlbWVyYWwgbm9kZSB0byByZWdpc3Rl\nciBodWIiLCBlcGhlbWVyYWxOb2RlUGF0aCwgcmMpOwogICAgICAgICAgICAg\nICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJT\ndWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oa2UpKTsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkZvdW5kIHN0YWxlIGVwaGVtZXJh\nbCBub2RlIHdoaWxlIHJlZ2lzdGVyaW5nIGh1YiB3aXRoIFpLLCBkZWxldGlu\nZyBpdCIpOwoKICAgICAgICAgICAgICAgIC8vIE5vZGUgZXhpc3RzLCBsZXRz\nIHRyeSB0byBkZWxldGUgaXQgYW5kIHJldHJ5CiAgICAgICAgICAgICAgICB6\nay5kZWxldGUoZXBoZW1lcmFsTm9kZVBhdGgsIC0xLCBuZXcgU2FmZUFzeW5j\nWktDYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\nc2FmZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0\nIGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQ29k\nZS5PSy5pbnRWYWx1ZSgpIHx8IHJjID09IENvZGUuTk9OT0RFLmludFZhbHVl\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lzdGVyV2l0\naFpvb2tlZXBlcihjYWxsYmFjaywgY3R4KTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24ga2UgPSBa\na1V0aWxzLmxvZ0Vycm9yQW5kQ3JlYXRlWktFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ291\nbGQgbm90IGRlbGV0ZSBzdGFsZSBlcGhlbWVyYWwgbm9kZSB0byByZWdpc3Rl\nciBodWIiLCBlcGhlbWVyYWxOb2RlUGF0aCwgcmMpOwogICAgICAgICAgICAg\nICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcg\nUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGtlKSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSwgY3R4KTsKCiAgICAgICAgICAg\nIH0KICAgICAgICB9LCBudWxsKTsKICAgIH0KCiAgICBTdHJpbmcgaHViUGF0\naChCeXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAgcmV0dXJuIGNmZy5nZXRa\na1RvcGljUGF0aChuZXcgU3RyaW5nQnVpbGRlcigpLCB0b3BpYykuYXBwZW5k\nKCIvaHViIikudG9TdHJpbmcoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHByb3RlY3RlZCB2b2lkIHJlYWxHZXRPd25lcihmaW5hbCBCeXRlU3RyaW5n\nIHRvcGljLCBmaW5hbCBib29sZWFuIHNob3VsZENsYWltLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPEhlZHdpZ1Nv\nY2tldEFkZHJlc3M+IGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nLy8gSWYgb3BlcmF0aW9ucyBhcmUgc3VzcGVuZGVkIGR1ZSB0byBhIFpLIGNs\naWVudCBkaXNjb25uZWN0LCBqdXN0IGVycm9yCiAgICAgICAgLy8gb3V0IHRo\naXMgY2FsbCBhbmQgcmV0dXJuLgogICAgICAgIGlmIChpc1N1c3BlbmRlZCkg\newogICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICJaS1RvcGljTWFuYWdlciBzZXJ2\naWNlIGlzIHRlbXBvcmFyaWx5IHN1c3BlbmRlZCEiKSk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh0b3BpY3MuY29udGFp\nbnModG9waWMpKSB7CiAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVk\nKGN0eCwgYWRkcik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIG5ldyBaa0dldE93bmVyT3AodG9waWMsIHNob3VsZENsYWltLCBj\nYiwgY3R4KS5yZWFkKCk7CiAgICB9CgogICAgLy8gUmVjdXJzaXZlbHkgY2Fs\nbCBlYWNoIG90aGVyLgogICAgY2xhc3MgWmtHZXRPd25lck9wIHsKICAgICAg\nICBCeXRlU3RyaW5nIHRvcGljOwogICAgICAgIGJvb2xlYW4gc2hvdWxkQ2xh\naW07CiAgICAgICAgQ2FsbGJhY2s8SGVkd2lnU29ja2V0QWRkcmVzcz4gY2I7\nCiAgICAgICAgT2JqZWN0IGN0eDsKICAgICAgICBTdHJpbmcgaHViUGF0aDsK\nCiAgICAgICAgcHVibGljIFprR2V0T3duZXJPcChCeXRlU3RyaW5nIHRvcGlj\nLCBib29sZWFuIHNob3VsZENsYWltLCBDYWxsYmFjazxIZWR3aWdTb2NrZXRB\nZGRyZXNzPiBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICB0aGlzLnRv\ncGljID0gdG9waWM7CiAgICAgICAgICAgIHRoaXMuc2hvdWxkQ2xhaW0gPSBz\naG91bGRDbGFpbTsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAgICAg\nICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICAgICAgaHViUGF0aCA9IGh1\nYlBhdGgodG9waWMpOwoKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lk\nIGNob29zZSgpIHsKICAgICAgICAgICAgLy8gR2V0IHRoZSBsaXN0IG9mIGV4\naXN0aW5nIGhvc3RzCiAgICAgICAgICAgIFN0cmluZyByZWdpc3RlcmVkSG9z\ndHNQYXRoID0gY2ZnLmdldFprSG9zdHNQcmVmaXgobmV3IFN0cmluZ0J1aWxk\nZXIoKSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgemsuZ2V0Q2hpbGRyZW4o\ncmVnaXN0ZXJlZEhvc3RzUGF0aCwgZmFsc2UsIG5ldyBTYWZlQXN5bmNaS0Nh\nbGxiYWNrLkNoaWxkcmVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9j\nZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsIExp\nc3Q8U3RyaW5nPiBjaGlsZHJlbikgewogICAgICAgICAgICAgICAgICAgIGlm\nIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIGUgPSBaa1V0aWxzLmxvZ0Vycm9y\nQW5kQ3JlYXRlWktFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3QgZ2V0IGxpc3Qg\nb2YgYXZhaWxhYmxlIGh1YnMiLCBwYXRoLCByYyk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJF\neGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oZSkpOwogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGNob29zZUxlYXN0TG9hZGVkTm9kZShjaGls\nZHJlbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2hvb3NlTGVhc3RM\nb2FkZWROb2RlKGZpbmFsIExpc3Q8U3RyaW5nPiBjaGlsZHJlbikgewogICAg\nICAgICAgICBEYXRhQ2FsbGJhY2sgZGF0YUNhbGxiYWNrID0gbmV3IERhdGFD\nYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIGludCBudW1SZXNwb25zZXMg\nPSAwOwogICAgICAgICAgICAgICAgaW50IG1pbkxvYWQgPSBJbnRlZ2VyLk1B\nWF9WQUxVRTsKICAgICAgICAgICAgICAgIFN0cmluZyBsZWFzdExvYWRlZCA9\nIG51bGw7CgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0\ncmluZyBwYXRoLCBPYmplY3QgY3R4LCBieXRlW10gZGF0YSwgU3RhdCBzdGF0\nKSB7CiAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBLZWVwZXJFeGNl\ncHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGludCBsb2FkID0gSW50ZWdlci5wYXJzZUludChuZXcgU3RyaW5nKGRh\ndGEpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9n\nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJGb3VuZCBzZXJ2ZXI6ICIg\nKyBjdHggKyAiIHdpdGggbG9hZDogIiArIGxvYWQpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBpZiAobG9hZCA8IG1pbkxvYWQgIHx8IChsb2FkID09IG1pbkxv\nYWQgJiYgcmFuZC5uZXh0Qm9vbGVhbigpKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBtaW5Mb2FkID0gbG9hZDsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVhc3RMb2FkZWQgPSAoU3Ry\naW5nKSBjdHg7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9y\nbWF0RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIud2FybigiQ29ycnVwdGVkIGxvYWQgaW5mb3JtYXRpb24g\nZnJvbSBodWI6IiArIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gc29tZSBjb3JydXB0ZWQgZGF0YSwgd2UnbGwganVzdCBpZ25v\ncmUgdGhpcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGh1\nYgogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIG51bVJlc3Bv\nbnNlcysrOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bVJlc3Bv\nbnNlcyA9PSBjaGlsZHJlbi5zaXplKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChsZWFzdExvYWRlZCA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKFpr\nR2V0T3duZXJPcC50aGlzLmN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2\naWNlRG93bkV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICJObyBodWIgYXZhaWxhYmxl\nIikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIEhlZHdpZ1NvY2tldEFkZHJlc3Mgb3duZXIgPSBuZXcg\nSGVkd2lnU29ja2V0QWRkcmVzcyhsZWFzdExvYWRlZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAob3duZXIuZXF1YWxzKGFkZHIpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhaW0oKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoWmtHZXRP\nd25lck9wLnRoaXMuY3R4LCBvd25lcik7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nOwoKICAgICAgICAgICAgZm9yIChTdHJpbmcgY2hpbGQgOiBjaGlsZHJlbikg\newogICAgICAgICAgICAgICAgemsuZ2V0RGF0YShjZmcuZ2V0WmtIb3N0c1By\nZWZpeChuZXcgU3RyaW5nQnVpbGRlcigpKS5hcHBlbmQoIi8iKS5hcHBlbmQo\nY2hpbGQpLnRvU3RyaW5nKCksIGZhbHNlLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICBkYXRhQ2FsbGJhY2ssIGNoaWxkKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xhaW1PckNob29zZSgp\nIHsKICAgICAgICAgICAgaWYgKHNob3VsZENsYWltKQogICAgICAgICAgICAg\nICAgY2xhaW0oKTsKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAg\nY2hvb3NlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByZWFk\nKCkgewogICAgICAgICAgICB6ay5nZXREYXRhKGh1YlBhdGgsIGZhbHNlLCBu\nZXcgU2FmZUFzeW5jWktDYWxsYmFjay5EYXRhQ2FsbGJhY2soKSB7CiAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9i\namVjdCBjdHgsIGJ5dGVbXSBkYXRhLCBTdGF0IHN0YXQpIHsKCiAgICAgICAg\nICAgICAgICAgICAgaWYgKHJjID09IENvZGUuTk9OT0RFLmludFZhbHVlKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2xhaW1PckNob29zZSgpOwog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5P\nSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEtlZXBl\nckV4Y2VwdGlvbiBlID0gWmtVdGlscy5sb2dFcnJvckFuZENyZWF0ZVpLRXhj\nZXB0aW9uKCJDb3VsZCBub3QgcmVhZCBvd25lcnNoaXAgZm9yIHRvcGljOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgcGF0aCwgcmMpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGUpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gc3VjY2Vzc2Z1bGx5IGRpZCBh\nIHJlYWQKICAgICAgICAgICAgICAgICAgICBIZWR3aWdTb2NrZXRBZGRyZXNz\nIG93bmVyID0gbmV3IEhlZHdpZ1NvY2tldEFkZHJlc3MobmV3IFN0cmluZyhk\nYXRhKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFvd25lci5lcXVhbHMo\nYWRkcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5p\nc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuZGVidWcoInRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4\nKCkgKyAiIGJlbG9uZ3MgdG8gc29tZW9uZSBlbHNlOiAiICsgb3duZXIpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgb3duZXIpOwogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiRGlzY292ZXJl\nZCBzdGFsZSBzZWxmLW5vZGUgZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJp\nbmdVdGY4KCkgKyAiLCB3aWxsIGRlbGV0ZSBpdCIpOwoKICAgICAgICAgICAg\nICAgICAgICAvLyB3ZSBtdXN0IGhhdmUgcHJldmlvdXNseSBmYWlsZWQgYW5k\nIGxlZnQgYQogICAgICAgICAgICAgICAgICAgIC8vIHJlc2lkdWFsIGVwaGVt\nZXJhbCBub2RlIGhlcmUsIHNvIHdlIG11c3QKICAgICAgICAgICAgICAgICAg\nICAvLyBkZWxldGUgaXQgKGNsZWFuIGl0IHVwKSBhbmQgdGhlbgogICAgICAg\nICAgICAgICAgICAgIC8vIHJlLWNyZWF0ZS9yZS1hY3F1aXJlIHRoZSB0b3Bp\nYy4KICAgICAgICAgICAgICAgICAgICB6ay5kZWxldGUoaHViUGF0aCwgc3Rh\ndC5nZXRWZXJzaW9uKCksIG5ldyBWb2lkQ2FsbGJhY2soKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5n\nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChDb2RlLk9LLmludFZhbHVlKCkgPT0gcmMgfHwgQ29kZS5OT05P\nREUuaW50VmFsdWUoKSA9PSByYykgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNsYWltT3JDaG9vc2UoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgS2VlcGVyRXhjZXB0aW9uIGUgPSBaa1V0aWxzLmxvZ0Vycm9yQW5k\nQ3JlYXRlWktFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNvdWxkIG5vdCBkZWxl\ndGUgc2VsZiBub2RlIGZvciB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlv\nbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9LCBjdHgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgY2xhaW0oKSB7CiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0Vu\nYWJsZWQoKSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjbGFp\nbWluZyB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgWmtVdGlscy5jcmVhdGVGdWxsUGF0aE9w\ndGltaXN0aWMoemssIGh1YlBhdGgsIGFkZHIudG9TdHJpbmcoKS5nZXRCeXRl\ncygpLCBJZHMuT1BFTl9BQ0xfVU5TQUZFLAogICAgICAgICAgICBDcmVhdGVN\nb2RlLkVQSEVNRVJBTCwgbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suU3RyaW5n\nQ2FsbGJhY2soKSB7CgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQg\ncmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBTdHJpbmcgbmFtZSkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBDb2RlLk9LLmludFZhbHVl\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0Rl\nYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nb2dnZXIuZGVidWcoImNsYWltZWQgdG9waWM6ICIgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgbm90aWZ5TGlzdGVuZXJzQW5kQWRkVG9Pd25lZFRv\ncGljcyh0b3BpYywgY2IsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHVwZGF0ZUxvYWRJbmZvcm1hdGlvbigpOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSBpZiAocmMgPT0gQ29kZS5OT0RFRVhJU1RTLmludFZhbHVlKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZCgpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEtl\nZXBlckV4Y2VwdGlvbiBlID0gWmtVdGlscy5sb2dFcnJvckFuZENyZWF0ZVpL\nRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAiRmFpbGVkIHRvIGNyZWF0ZSBlcGhlbWVyYWwgbm9k\nZSB0byBjbGFpbSBvd25lcnNoaXAgb2YgdG9waWM6ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50\nb1N0cmluZ1V0ZjgoKSwgcGF0aCwgcmMpOwogICAgICAgICAgICAgICAgICAg\nICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0\naW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGUpKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGN0eCk7\nCiAgICAgICAgfQoKICAgIH0KCiAgICBieXRlW10gZ2V0Q3VycmVudExvYWRE\nYXRhKCkgewogICAgICAgIC8vIEZvciBub3csIHVzaW5nIHRoZSBudW1iZXIg\nb2YgdG9waWNzIGFzIGFuIGluZGljYXRvciBvZiBsb2FkCiAgICAgICAgLy8g\naW5mb3JtYXRpb24KICAgICAgICByZXR1cm4gKHRvcGljcy5zaXplKCkgKyAi\nIikuZ2V0Qnl0ZXMoKTsKICAgIH0KCiAgICB2b2lkIHVwZGF0ZUxvYWRJbmZv\ncm1hdGlvbigpIHsKICAgICAgICBieXRlW10gY3VycmVudExvYWQgPSBnZXRD\ndXJyZW50TG9hZERhdGEoKTsKICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZXBvcnRp\nbmcgbG9hZCBvZiAiICsgbmV3IFN0cmluZyhjdXJyZW50TG9hZCkpOwogICAg\nICAgIH0KICAgICAgICB6ay5zZXREYXRhKGVwaGVtZXJhbE5vZGVQYXRoLCBj\ndXJyZW50TG9hZCwgLTEsIGxvYWRSZXBvcnRpbmdTdGF0Q2FsbGJhY2ssIG51\nbGwpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZvaWQg\ncG9zdFJlbGVhc2VDbGVhbnVwKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZp\nbmFsIENhbGxiYWNrPFZvaWQ+IGNiLCBPYmplY3QgY3R4KSB7CgogICAgICAg\nIHprLmdldERhdGEoaHViUGF0aCh0b3BpYyksIGZhbHNlLCBuZXcgU2FmZUFz\neW5jWktDYWxsYmFjay5EYXRhQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jl\nc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBieXRlW10g\nZGF0YSwgU3RhdCBzdGF0KSB7CiAgICAgICAgICAgICAgICBpZiAocmMgPT0g\nQ29kZS5OT05PREUuaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAg\nIC8vIE5vZGUgaGFzIHNvbWVob3cgZGlzYXBwZWFyZWQgZnJvbSB1bmRlciB1\ncywgbGl2ZSB3aXRoIGl0CiAgICAgICAgICAgICAgICAgICAgLy8gc2luY2Ug\naXRzIGEgdHJhbnNpZW50IG5vZGUKICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIud2FybigiV2hpbGUgZGVsZXRpbmcgc2VsZi1ub2RlIGZvciB0b3BpYzog\nIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiwgbm9kZSBub3QgZm91bmQi\nKTsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChj\ndHgsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5P\nSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgS2VlcGVyRXhj\nZXB0aW9uIGUgPSBaa1V0aWxzLmxvZ0Vycm9yQW5kQ3JlYXRlWktFeGNlcHRp\nb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIkZhaWxlZCB0byBkZWxldGUgc2VsZi1vd25lcnNoaXAgbm9kZSBmb3Ig\ndG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgcGF0aCwgcmMpOwog\nICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5l\ndyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oZSkpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIG93bmVyID0g\nbmV3IEhlZHdpZ1NvY2tldEFkZHJlc3MobmV3IFN0cmluZyhkYXRhKSk7CiAg\nICAgICAgICAgICAgICBpZiAoIW93bmVyLmVxdWFscyhhZGRyKSkgewogICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJXYW50ZWQgdG8gZGVsZXRl\nIHNlbGYtbm9kZSBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSArICIgYnV0IG5vZGUgZm9yICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArIG93bmVyICsgIiBmb3VuZCwgbGVhdmluZyB1bnRvdWNoZWQi\nKTsKICAgICAgICAgICAgICAgICAgICAvLyBOb3Qgb3VyIG5vZGUsIHNvbWVv\nbmUgZWxzZSdzLCBsZWF2ZSBpdCBhbG9uZQogICAgICAgICAgICAgICAgICAg\nIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIHprLmRlbGV0ZShwYXRoLCBzdGF0LmdldFZlcnNpb24oKSwgbmV3\nIFNhZmVBc3luY1pLQ2FsbGJhY2suVm9pZENhbGxiYWNrKCkgewogICAgICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBh\ndGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHJjICE9IENvZGUuT0suaW50VmFsdWUoKSAmJiByYyAhPSBDb2RlLk5PTk9E\nRS5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBL\nZWVwZXJFeGNlcHRpb24gZSA9IFprVXRpbHMKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmxvZ0Vycm9yQW5kQ3Jl\nYXRlWktFeGNlcHRpb24oIkZhaWxlZCB0byBkZWxldGUgc2VsZi1vd25lcnNo\naXAgbm9kZSBmb3IgdG9waWM6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3Ry\naW5nVXRmOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0\naW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGUpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNo\nZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9LCBjdHgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgY3R4\nKTsKICAgIH0KCn0K\n","encoding":"base64"}

