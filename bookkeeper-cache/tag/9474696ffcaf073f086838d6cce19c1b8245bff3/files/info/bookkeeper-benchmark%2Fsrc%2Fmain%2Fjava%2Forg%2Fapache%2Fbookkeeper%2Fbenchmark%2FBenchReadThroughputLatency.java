{"sha":"d5baaa400fa42feda40d91e3cff8de8b987eb0da","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDViYWFhNDAwZmE0MmZlZGE0MGQ5MWUzY2ZmOGRlOGI5ODdlYjBkYQ==","size":11554,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d5baaa400fa42feda40d91e3cff8de8b987eb0da","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0\naGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25z\nIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICov\nCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKCmlt\ncG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlci5FdmVudDsKCmltcG9ydCBqYXZhLnV0aWwuRW51\nbWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5yZWdleC5QYXR0ZXJuOwppbXBvcnQgamF2YS51dGlsLnJlZ2V4Lk1hdGNo\nZXI7CgppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0\nY2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWlj\nSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBG\nb3JtYXR0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9wdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuT3B0aW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmU7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkNvbW1hbmRMaW5lUGFyc2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Qb3NpeFBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuUGFyc2VFeGNlcHRpb247Cgpp\nbXBvcnQgc3RhdGljIGNvbS5nb29nbGUuY29tbW9uLmJhc2UuQ2hhcnNldHMu\nVVRGXzg7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXJGYWN0b3J5OwoKcHVibGljIGNsYXNzIEJlbmNoUmVhZFRo\ncm91Z2hwdXRMYXRlbmN5IHsKICAgIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9H\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQmVuY2hSZWFkVGhyb3VnaHB1\ndExhdGVuY3kuY2xhc3MpOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFBh\ndHRlcm4gTEVER0VSX1BBVFRFUk4gPSBQYXR0ZXJuLmNvbXBpbGUoIkwoWzAt\nOV0rKSQiKTsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDb21wYXJhdG9y\nPFN0cmluZz4gWktfTEVER0VSX0NPTVBBUkUgPSBuZXcgQ29tcGFyYXRvcjxT\ndHJpbmc+KCkgewogICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShTdHJpbmcg\nbzEsIFN0cmluZyBvMikgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgTWF0Y2hlciBtMSA9IExFREdFUl9QQVRURVJOLm1hdGNoZXIobzEp\nOwogICAgICAgICAgICAgICAgTWF0Y2hlciBtMiA9IExFREdFUl9QQVRURVJO\nLm1hdGNoZXIobzIpOwogICAgICAgICAgICAgICAgaWYgKG0xLmZpbmQoKSAm\nJiBtMi5maW5kKCkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gSW50\nZWdlci52YWx1ZU9mKG0xLmdyb3VwKDEpKQogICAgICAgICAgICAgICAgICAg\nICAgICAtIEludGVnZXIudmFsdWVPZihtMi5ncm91cCgxKSk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBv\nMS5jb21wYXJlVG8obzIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIG8xLmNvbXBhcmVUbyhvMik7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9OwoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgcmVhZExlZGdlcihD\nbGllbnRDb25maWd1cmF0aW9uIGNvbmYsIGxvbmcgbGVkZ2VySWQsIGJ5dGVb\nXSBwYXNzd2QpIHsKICAgICAgICBMT0cuaW5mbygiUmVhZGluZyBsZWRnZXIg\ne30iLCBsZWRnZXJJZCk7CiAgICAgICAgQm9va0tlZXBlciBiayA9IG51bGw7\nCiAgICAgICAgbG9uZyB0aW1lID0gMDsKICAgICAgICBsb25nIGVudHJpZXNS\nZWFkID0gMDsKICAgICAgICBsb25nIGxhc3RSZWFkID0gMDsKICAgICAgICBp\nbnQgbm9jaGFuZ2UgPSAwOwoKICAgICAgICBsb25nIGFic29sdXRlTGltaXQg\nPSA1MDAwMDAwOwogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYmsgPSBuZXcgQm9va0tlZXBlcihj\nb25mKTsKICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAg\nICAgIGxoID0gYmsub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIEJv\nb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwgCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3N3ZCk7CiAgICAgICAg\nICAgICAgICBsb25nIGxhc3RDb25maXJtZWQgPSBNYXRoLm1pbihsaC5nZXRM\nYXN0QWRkQ29uZmlybWVkKCksIGFic29sdXRlTGltaXQpOwogICAgICAgICAg\nICAgICAgaWYgKGxhc3RDb25maXJtZWQgPT0gbGFzdFJlYWQpIHsKICAgICAg\nICAgICAgICAgICAgICBub2NoYW5nZSsrOwogICAgICAgICAgICAgICAgICAg\nIGlmIChub2NoYW5nZSA9PSAxMCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgbm9jaGFuZ2UgPSAwOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgbG9uZyBzdGFydHRpbWUgPSBTeXN0ZW0ubmFub1RpbWUoKTsKCiAg\nICAgICAgICAgICAgICB3aGlsZSAobGFzdFJlYWQgPCBsYXN0Q29uZmlybWVk\nKSB7CiAgICAgICAgICAgICAgICAgICAgbG9uZyBuZXh0TGltaXQgPSBsYXN0\nUmVhZCArIDEwMDAwMDsKICAgICAgICAgICAgICAgICAgICBsb25nIHJlYWRU\nbyA9IE1hdGgubWluKG5leHRMaW1pdCwgbGFzdENvbmZpcm1lZCk7CiAgICAg\nICAgICAgICAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGVudHJp\nZXMgPSBsaC5yZWFkRW50cmllcyhsYXN0UmVhZCsxLCByZWFkVG8pOwogICAg\nICAgICAgICAgICAgICAgIGxhc3RSZWFkID0gcmVhZFRvOwogICAgICAgICAg\nICAgICAgICAgIHdoaWxlIChlbnRyaWVzLmhhc01vcmVFbGVtZW50cygpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIExlZGdlckVudHJ5IGUgPSBlbnRy\naWVzLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVu\ndHJpZXNSZWFkKys7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZW50\ncmllc1JlYWQgJSAxMDAwMCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgTE9HLmluZm8oInt9IGVudHJpZXMgcmVhZCIsIGVudHJpZXNS\nZWFkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxv\nbmcgZW5kdGltZSA9IFN5c3RlbS5uYW5vVGltZSgpOwogICAgICAgICAgICAg\nICAgdGltZSArPSBlbmR0aW1lIC0gc3RhcnR0aW1lOwoKICAgICAgICAgICAg\nICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBsaCA9IG51bGw7CiAg\nICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkg\newogICAgICAgICAgICAvLyBpZ25vcmUKICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSApIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24g\naW4gcmVhZGVyIiwgZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgTE9HLmluZm8oIlJlYWQge30gaW4ge31tcyIsIGVudHJpZXNSZWFkLCB0\naW1lLzEwMDAvMTAwMCk7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgaWYgKGxoICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBs\naC5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\naWYgKGJrICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBiay5jbG9z\nZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNl\ncHRpb24gY2xvc2luZyBzdHVmZiIsIGUpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgdXNhZ2UoT3B0\naW9ucyBvcHRpb25zKSB7CiAgICAgICAgSGVscEZvcm1hdHRlciBmb3JtYXR0\nZXIgPSBuZXcgSGVscEZvcm1hdHRlcigpOwogICAgICAgIGZvcm1hdHRlci5w\ncmludEhlbHAoIkJlbmNoUmVhZFRocm91Z2hwdXRMYXRlbmN5IDxvcHRpb25z\nPiIsIG9wdGlvbnMpOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJk\nZXByZWNhdGlvbiIpCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJp\nbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBPcHRpb25z\nIG9wdGlvbnMgPSBuZXcgT3B0aW9ucygpOwogICAgICAgIG9wdGlvbnMuYWRk\nT3B0aW9uKCJsZWRnZXIiLCB0cnVlLCAiTGVkZ2VyIHRvIHJlYWQuIElmIGVt\ncHR5LCByZWFkIGFsbCBsZWRnZXJzIHdoaWNoIGNvbWUgYXZhaWxhYmxlLiAi\nIAogICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBDYW5ub3QgYmUgdXNl\nZCB3aXRoIC1saXN0ZW4iKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigi\nbGlzdGVuIiwgdHJ1ZSwgIkxpc3RlbiBmb3IgY3JlYXRpb24gb2YgPGFyZz4g\nbGVkZ2VycywgYW5kIHJlYWQgZWFjaCBvbmUgZnVsbHkiKTsKICAgICAgICBv\ncHRpb25zLmFkZE9wdGlvbigicGFzc3dvcmQiLCB0cnVlLCAiUGFzc3dvcmQg\ndXNlZCB0byBhY2Nlc3MgbGVkZ2VycyAoZGVmYXVsdCAnYmVuY2hQYXNzd2Qn\nKSIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJ6b29rZWVwZXIiLCB0\ncnVlLCAiWm9va2VlcGVyIGVuc2VtYmxlLCBkZWZhdWx0IFwibG9jYWxob3N0\nOjIxODFcIiIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJzb2NrZXR0\naW1lb3V0IiwgdHJ1ZSwgIlNvY2tldCB0aW1lb3V0IGZvciBib29ra2VlcGVy\nIGNsaWVudC4gSW4gc2Vjb25kcy4gRGVmYXVsdCA1Iik7CiAgICAgICAgb3B0\naW9ucy5hZGRPcHRpb24oImhlbHAiLCBmYWxzZSwgIlRoaXMgbWVzc2FnZSIp\nOwoKICAgICAgICBDb21tYW5kTGluZVBhcnNlciBwYXJzZXIgPSBuZXcgUG9z\naXhQYXJzZXIoKTsKICAgICAgICBDb21tYW5kTGluZSBjbWQgPSBwYXJzZXIu\ncGFyc2Uob3B0aW9ucywgYXJncyk7CgogICAgICAgIGlmIChjbWQuaGFzT3B0\naW9uKCJoZWxwIikpIHsKICAgICAgICAgICAgdXNhZ2Uob3B0aW9ucyk7CiAg\nICAgICAgICAgIFN5c3RlbS5leGl0KC0xKTsKICAgICAgICB9CgogICAgICAg\nIGZpbmFsIFN0cmluZyBzZXJ2ZXJzID0gY21kLmdldE9wdGlvblZhbHVlKCJ6\nb29rZWVwZXIiLCAibG9jYWxob3N0OjIxODEiKTsKICAgICAgICBmaW5hbCBi\neXRlW10gcGFzc3dkID0gY21kLmdldE9wdGlvblZhbHVlKCJwYXNzd29yZCIs\nICJiZW5jaFBhc3N3ZCIpLmdldEJ5dGVzKFVURl84KTsKICAgICAgICBmaW5h\nbCBpbnQgc29ja1RpbWVvdXQgPSBJbnRlZ2VyLnZhbHVlT2YoY21kLmdldE9w\ndGlvblZhbHVlKCJzb2NrZXR0aW1lb3V0IiwgIjUiKSk7CiAgICAgICAgaWYg\nKGNtZC5oYXNPcHRpb24oImxlZGdlciIpICYmIGNtZC5oYXNPcHRpb24oImxp\nc3RlbiIpKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiQ2Fubm90IHVzZWQg\nLWxlZGdlciBhbmQgLWxpc3RlbiB0b2dldGhlciIpOwogICAgICAgICAgICB1\nc2FnZShvcHRpb25zKTsKICAgICAgICAgICAgU3lzdGVtLmV4aXQoLTEpOwog\nICAgICAgIH0KCiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBsZWRnZXIg\nPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAgICAgICBmaW5hbCBBdG9taWNJ\nbnRlZ2VyIG51bUxlZGdlcnMgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAg\nICAgICBpZiAoY21kLmhhc09wdGlvbigibGVkZ2VyIikpIHsKICAgICAgICAg\nICAgbGVkZ2VyLnNldChJbnRlZ2VyLnZhbHVlT2YoY21kLmdldE9wdGlvblZh\nbHVlKCJsZWRnZXIiKSkpOwogICAgICAgIH0gZWxzZSBpZiAoY21kLmhhc09w\ndGlvbigibGlzdGVuIikpIHsKICAgICAgICAgICAgbnVtTGVkZ2Vycy5zZXQo\nSW50ZWdlci52YWx1ZU9mKGNtZC5nZXRPcHRpb25WYWx1ZSgibGlzdGVuIikp\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBMT0cuZXJyb3IoIllv\ndSBtdXN0IHVzZSAtbGVkZ2VyIG9yIC1saXN0ZW4iKTsKICAgICAgICAgICAg\ndXNhZ2Uob3B0aW9ucyk7CiAgICAgICAgICAgIFN5c3RlbS5leGl0KC0xKTsK\nICAgICAgICB9CgogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHNodXRk\nb3duTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgZmlu\nYWwgQ291bnREb3duTGF0Y2ggY29ubmVjdGVkTGF0Y2ggPSBuZXcgQ291bnRE\nb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgU3RyaW5nIG5vZGVwYXRoID0g\nU3RyaW5nLmZvcm1hdCgiL2xlZGdlcnMvTCUwMTBkIiwgbGVkZ2VyLmdldCgp\nKTsKCiAgICAgICAgZmluYWwgQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mID0g\nbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBjb25mLnNldFJl\nYWRUaW1lb3V0KHNvY2tUaW1lb3V0KS5zZXRaa1NlcnZlcnMoc2VydmVycyk7\nCgoKICAgICAgICBmaW5hbCBab29LZWVwZXIgemsgPSBuZXcgWm9vS2VlcGVy\nKHNlcnZlcnMsIDMwMDAsIG5ldyBXYXRjaGVyKCkgewogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZ2V0U3RhdGUoKSA9PSBF\ndmVudC5LZWVwZXJTdGF0ZS5TeW5jQ29ubmVjdGVkCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAmJiBldmVudC5nZXRUeXBlKCkgPT0gRXZlbnQuRXZl\nbnRUeXBlLk5vbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVj\ndGVkTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB0cnkg\newogICAgICAgICAgICB6ay5yZWdpc3RlcihuZXcgV2F0Y2hlcigpIHsKICAg\nICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRF\ndmVudCBldmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFN0YXRl\nKCkgPT0gRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZCAKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBldmVudC5nZXRUeXBlKCkg\nPT0gRXZlbnQuRXZlbnRUeXBlLk5vbmUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjb25uZWN0ZWRMYXRjaC5jb3VudERvd24oKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZ2V0\nVHlwZSgpID09IEV2ZW50LkV2ZW50VHlwZS5Ob2RlQ3JlYXRlZAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBldmVudC5nZXRQ\nYXRoKCkuZXF1YWxzKG5vZGVwYXRoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJlYWRMZWRnZXIoY29uZiwgbGVkZ2VyLmdldCgpLCBw\nYXNzd2QpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNodXRk\nb3duTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFR5cGUoKSA9PSBFdmVudC5FdmVu\ndFR5cGUuTm9kZUNoaWxkcmVuQ2hhbmdlZCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChudW1MZWRnZXJzLmdldCgpIDwgMCkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBjaGlsZHJlbiA9IHpr\nLmdldENoaWxkcmVuKCIvbGVkZ2VycyIsIHRydWUpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBsZWRnZXJzID0gbmV3\nIEFycmF5TGlzdDxTdHJpbmc+KCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZm9yIChTdHJpbmcgY2hpbGQgOiBjaGlsZHJlbikgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTEVER0VSX1BB\nVFRFUk4ubWF0Y2hlcihjaGlsZCkuZmluZCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJzLmFkZChjaGlsZCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQ29sbGVjdGlvbnMuc29ydChsZWRnZXJzLCBaS19M\nRURHRVJfQ09NUEFSRSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgU3RyaW5nIGxhc3QgPSBsZWRnZXJzLmdldChsZWRnZXJzLnNpemUoKSAt\nIDEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIE1h\ndGNoZXIgbSA9IExFREdFUl9QQVRURVJOLm1hdGNoZXIobGFzdCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG0uZmluZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBsZWRnZXJz\nTGVmdCA9IG51bUxlZGdlcnMuZGVjcmVtZW50QW5kR2V0KCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZCB0ID0gbmV3IFRo\ncmVhZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRMZWRnZXIoY29u\nZiwgTG9uZy52YWx1ZU9mKG0uZ3JvdXAoMSkpLCBwYXNzd2QpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc3RhcnQoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxlZGdlcnNMZWZ0\nIDw9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHNodXRkb3duTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIkNhbnQgZmlsZSBsZWRnZXIgaWQgaW4g\ne30iLCBsYXN0KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJVbmtub3duIGV2\nZW50IHt9IiwgZXZlbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJF\neGNlcHRpb24gaW4gd2F0Y2hlciIsIGUpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfSk7CiAgICAgICAgICAgIGNvbm5lY3RlZExhdGNoLmF3YWl0KCk7CiAgICAg\nICAgICAgIGlmIChsZWRnZXIuZ2V0KCkgIT0gMCkgewogICAgICAgICAgICAg\nICAgaWYgKHprLmV4aXN0cyhub2RlcGF0aCwgdHJ1ZSkgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIHJlYWRMZWRnZXIoY29uZiwgbGVkZ2VyLmdl\ndCgpLCBwYXNzd2QpOwogICAgICAgICAgICAgICAgICAgIHNodXRkb3duTGF0\nY2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIExPRy5pbmZvKCJXYXRjaGluZyBmb3IgY3JlYXRp\nb24gb2YiICsgbm9kZXBhdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgemsuZ2V0Q2hpbGRyZW4o\nIi9sZWRnZXJzIiwgdHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nc2h1dGRvd25MYXRjaC5hd2FpdCgpOwogICAgICAgICAgICBMT0cuaW5mbygi\nU2h1dHRpbmcgZG93biIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIHprLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

