{"sha":"4a21792f54d99045547b0bc8b582f21659b4520a","node_id":"MDQ6QmxvYjE1NzU5NTY6NGEyMTc5MmY1NGQ5OTA0NTU0N2IwYmM4YjU4MmYyMTY1OWI0NTIwYQ==","size":17497,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4a21792f54d99045547b0bc8b582f21659b4520a","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0\naGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25z\nIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICov\nCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsKCmlt\ncG9ydCBqYXZhLmlvLkJ1ZmZlcmVkT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2\nYS5pby5GaWxlT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JT0V4Y2Vw\ndGlvbjsKaW1wb3J0IGphdmEuaW8uT3V0cHV0U3RyZWFtOwppbXBvcnQgamF2\nYS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwu\nUmFuZG9tOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3du\nTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TZW1hcGhvcmU7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNMb25nOwppbXBv\ncnQgamF2YS51dGlsLlRpbWVyOwppbXBvcnQgamF2YS51dGlsLlRpbWVyVGFz\nazsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5C\nb29rS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkFzeW5jQ2FsbGJhY2suQWRkQ2FsbGJhY2s7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Db21tYW5kTGluZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmVQYXJzZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBGb3JtYXR0ZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9wdGlvbnM7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLlBhcnNlRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Qb3NpeFBhcnNlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuWm9vRGVmczsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpv\nb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXIu\nRXZlbnQuRXZlbnRUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZTsKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9y\ndCBzdGF0aWMgY29tLmdvb2dsZS5jb21tb24uYmFzZS5DaGFyc2V0cy5VVEZf\nODsKCnB1YmxpYyBjbGFzcyBCZW5jaFRocm91Z2hwdXRMYXRlbmN5IGltcGxl\nbWVudHMgQWRkQ2FsbGJhY2ssIFJ1bm5hYmxlIHsKICAgIHN0YXRpYyBmaW5h\nbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQmVuY2hU\naHJvdWdocHV0TGF0ZW5jeS5jbGFzcyk7CgogICAgQm9va0tlZXBlciBiazsK\nICAgIExlZGdlckhhbmRsZSBsaFtdOwogICAgQXRvbWljTG9uZyBjb3VudGVy\nOwoKICAgIFNlbWFwaG9yZSBzZW07CiAgICBpbnQgbnVtYmVyT2ZMZWRnZXJz\nID0gMTsKICAgIGZpbmFsIGludCBzZW5kTGltaXQ7CiAgICBmaW5hbCBsb25n\nIGxhdGVuY2llc1tdOwoKICAgIHN0YXRpYyBjbGFzcyBDb250ZXh0IHsKICAg\nICAgICBsb25nIGxvY2FsU3RhcnRUaW1lOwogICAgICAgIGxvbmcgaWQ7Cgog\nICAgICAgIENvbnRleHQobG9uZyBpZCwgbG9uZyB0aW1lKXsKICAgICAgICAg\nICAgdGhpcy5pZCA9IGlkOwogICAgICAgICAgICB0aGlzLmxvY2FsU3RhcnRU\naW1lID0gdGltZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIEJlbmNo\nVGhyb3VnaHB1dExhdGVuY3koaW50IGVuc2VtYmxlLCBpbnQgd3JpdGVRdW9y\ndW1TaXplLCBpbnQgYWNrUXVvcnVtU2l6ZSwgYnl0ZVtdIHBhc3N3ZCwKICAg\nICAgICAgICAgaW50IG51bWJlck9mTGVkZ2VycywgaW50IHNlbmRMaW1pdCwg\nQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAgICB0aHJvd3Mg\nS2VlcGVyRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgIHRoaXMuc2VtID0gbmV3IFNlbWFwaG9yZShjb25m\nLmdldFRocm90dGxlVmFsdWUoKSk7CiAgICAgICAgYmsgPSBuZXcgQm9va0tl\nZXBlcihjb25mKTsKICAgICAgICB0aGlzLmNvdW50ZXIgPSBuZXcgQXRvbWlj\nTG9uZygwKTsKICAgICAgICB0aGlzLm51bWJlck9mTGVkZ2VycyA9IG51bWJl\nck9mTGVkZ2VyczsKICAgICAgICB0aGlzLnNlbmRMaW1pdCA9IHNlbmRMaW1p\ndDsKICAgICAgICB0aGlzLmxhdGVuY2llcyA9IG5ldyBsb25nW3NlbmRMaW1p\ndF07CiAgICAgICAgdHJ5ewogICAgICAgICAgICBsaCA9IG5ldyBMZWRnZXJI\nYW5kbGVbdGhpcy5udW1iZXJPZkxlZGdlcnNdOwoKICAgICAgICAgICAgZm9y\nKGludCBpID0gMDsgaSA8IHRoaXMubnVtYmVyT2ZMZWRnZXJzOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGxoW2ldID0gYmsuY3JlYXRlTGVkZ2VyKGVuc2Vt\nYmxlLCB3cml0ZVF1b3J1bVNpemUsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBhY2tRdW9ydW1TaXplLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9va0tlZXBlci5EaWdlc3RU\neXBlLkNSQzMyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgcGFzc3dkKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiTGVk\nZ2VyIEhhbmRsZTogIiArIGxoW2ldLmdldElkKCkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBS\nYW5kb20gcmFuZCA9IG5ldyBSYW5kb20oKTsKICAgIHB1YmxpYyB2b2lkIGNs\nb3NlKCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlv\nbiB7CiAgICAgICAgZm9yKGludCBpID0gMDsgaSA8IG51bWJlck9mTGVkZ2Vy\nczsgaSsrKSB7CiAgICAgICAgICAgIGxoW2ldLmNsb3NlKCk7CiAgICAgICAg\nfQogICAgICAgIGJrLmNsb3NlKCk7CiAgICB9CgogICAgbG9uZyBwcmV2aW91\ncyA9IDA7CiAgICBieXRlIGJ5dGVzW107CgogICAgdm9pZCBzZXRFbnRyeURh\ndGEoYnl0ZSBkYXRhW10pIHsKICAgICAgICBieXRlcyA9IGRhdGE7CiAgICB9\nCgogICAgaW50IGxhc3RMZWRnZXIgPSAwOwogICAgcHJpdmF0ZSBpbnQgZ2V0\nUmFuZG9tTGVkZ2VyKCkgewogICAgICAgICByZXR1cm4gcmFuZC5uZXh0SW50\nKG51bWJlck9mTGVkZ2Vycyk7CiAgICB9CgogICAgaW50IGxhdGVuY3lJbmRl\neCA9IC0xOwogICAgQXRvbWljTG9uZyBjb21wbGV0ZWRSZXF1ZXN0cyA9IG5l\ndyBBdG9taWNMb25nKDApOwoKICAgIGxvbmcgZHVyYXRpb24gPSAtMTsKICAg\nIHN5bmNocm9uaXplZCBwdWJsaWMgbG9uZyBnZXREdXJhdGlvbigpIHsKICAg\nICAgICByZXR1cm4gZHVyYXRpb247CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgIExPRy5pbmZvKCJSdW5uaW5nLi4uIik7CiAgICAg\nICAgbG9uZyBzdGFydCA9IHByZXZpb3VzID0gU3lzdGVtLmN1cnJlbnRUaW1l\nTWlsbGlzKCk7CgogICAgICAgIGludCBzZW50ID0gMDsKCiAgICAgICAgVGhy\nZWFkIHJlcG9ydGVyID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSh0cnVlKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygibXM6IHt9IHJl\ncToge30iLCBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSwgY29tcGxldGVk\nUmVxdWVzdHMuZ2V0QW5kU2V0KDApKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVk\nRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5p\nbmZvKCJDYXVnaHQgaW50ZXJydXB0ZWQgZXhjZXB0aW9uLCBnb2luZyBhd2F5\nIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9OwogICAgICAgIHJlcG9ydGVyLnN0YXJ0KCk7CiAgICAg\nICAgbG9uZyBiZWZvcmVTZW5kID0gU3lzdGVtLm5hbm9UaW1lKCk7CgogICAg\nICAgIHdoaWxlKCFUaHJlYWQuY3VycmVudFRocmVhZCgpLmlzSW50ZXJydXB0\nZWQoKSAmJiBzZW50IDwgc2VuZExpbWl0KSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBzZW0uYWNxdWlyZSgpOwogICAgICAgICAgICAg\nICAgaWYgKHNlbnQgPT0gMTAwMDApIHsKICAgICAgICAgICAgICAgICAgICBs\nb25nIGFmdGVyU2VuZCA9IFN5c3RlbS5uYW5vVGltZSgpOwogICAgICAgICAg\nICAgICAgICAgIGxvbmcgdGltZSA9IGFmdGVyU2VuZCAtIGJlZm9yZVNlbmQ7\nCiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlRpbWUgdG8gc2VuZCBm\naXJzdCBiYXRjaDoge31zIHt9bnMgIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0aW1lLzEwMDAvMTAwMC8xMDAwLCB0aW1lKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGZpbmFsIGludCBpbmRleCA9IGdldFJhbmRvbUxl\nZGdlcigpOwogICAgICAgICAgICBMZWRnZXJIYW5kbGUgaCA9IGxoW2luZGV4\nXTsKICAgICAgICAgICAgaWYgKGggPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJIYW5kbGUgIiArIGluZGV4ICsgIiBpcyBudWxsISIp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbG9uZyBu\nYW5vVGltZSA9IFN5c3RlbS5uYW5vVGltZSgpOwogICAgICAgICAgICAgICAg\nbGhbaW5kZXhdLmFzeW5jQWRkRW50cnkoYnl0ZXMsIHRoaXMsIG5ldyBDb250\nZXh0KHNlbnQsIG5hbm9UaW1lKSk7CiAgICAgICAgICAgICAgICBjb3VudGVy\nLmluY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHNlbnQrKzsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oIlNlbnQ6ICIg\nICsgc2VudCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaW50IGkgPSAw\nOwogICAgICAgICAgICB3aGlsZSh0aGlzLmNvdW50ZXIuZ2V0KCkgPiAwKSB7\nCiAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAg\nICAgICAgICBpKys7CiAgICAgICAgICAgICAgICBpZiAoaSA+IDMwKSB7CiAg\nICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoKEludGVycnVwdGVkRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJbnRlcnJ1cHRlZCB3\naGlsZSB3YWl0aW5nIiwgZSk7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9u\naXplZCh0aGlzKSB7CiAgICAgICAgICAgIGR1cmF0aW9uID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydDsKICAgICAgICB9CiAgICAgICAg\ndGhyb3VnaHB1dCA9IHNlbnQqMTAwMC9nZXREdXJhdGlvbigpOwoKICAgICAg\nICByZXBvcnRlci5pbnRlcnJ1cHQoKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICByZXBvcnRlci5qb2luKCk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgLy8gaWdub3JlCiAg\nICAgICAgfQogICAgICAgIExPRy5pbmZvKCJGaW5pc2hlZCBwcm9jZXNzaW5n\nIGluIG1zOiAiICsgZ2V0RHVyYXRpb24oKSArICIgdHAgPSAiICsgdGhyb3Vn\naHB1dCk7CiAgICB9CgogICAgbG9uZyB0aHJvdWdocHV0ID0gLTE7CiAgICBw\ndWJsaWMgbG9uZyBnZXRUaHJvdWdocHV0KCkgewogICAgICAgIHJldHVybiB0\naHJvdWdocHV0OwogICAgfQoKICAgIGxvbmcgdGhyZXNob2xkID0gMjAwMDA7\nCiAgICBsb25nIHJ1bm5pbmdBdmVyYWdlQ291bnRlciA9IDA7CiAgICBsb25n\nIHRvdGFsVGltZSA9IDA7CiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lk\nIGFkZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVu\ndHJ5SWQsIE9iamVjdCBjdHgpIHsKICAgICAgICBDb250ZXh0IGNvbnRleHQg\nPSAoQ29udGV4dCkgY3R4OwoKICAgICAgICAvLyB3ZSBuZWVkIHRvIHVzZSB0\naGUgaWQgcGFzc2VkIGluIHRoZSBjb250ZXh0IGluIHRoZSBjYXNlIG9mCiAg\nICAgICAgLy8gbXVsdGlwbGUgbGVkZ2VycywgYW5kIGl0IHdvcmtzIGV2ZW4g\nd2l0aCBvbmUgbGVkZ2VyCiAgICAgICAgZW50cnlJZCA9IGNvbnRleHQuaWQ7\nCiAgICAgICAgbG9uZyBuZXdUaW1lID0gU3lzdGVtLm5hbm9UaW1lKCkgLSBj\nb250ZXh0LmxvY2FsU3RhcnRUaW1lOwoKICAgICAgICBzZW0ucmVsZWFzZSgp\nOwogICAgICAgIGNvdW50ZXIuZGVjcmVtZW50QW5kR2V0KCk7CgogICAgICAg\nIGlmIChyYyA9PSAwKSB7CiAgICAgICAgICAgIGxhdGVuY2llc1soaW50KWVu\ndHJ5SWRdID0gbmV3VGltZTsKICAgICAgICAgICAgY29tcGxldGVkUmVxdWVz\ndHMuaW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAgfQogICAgfQoKICAgIEBT\ndXBwcmVzc1dhcm5pbmdzKCJkZXByZWNhdGlvbiIpCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKQogICAgICAgICAgICB0aHJv\nd3MgS2VlcGVyRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRF\neGNlcHRpb24sIFBhcnNlRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAg\nICAgT3B0aW9ucyBvcHRpb25zID0gbmV3IE9wdGlvbnMoKTsKICAgICAgICBv\ncHRpb25zLmFkZE9wdGlvbigidGltZSIsIHRydWUsICJSdW5uaW5nIHRpbWUg\nKHNlY29uZHMpLCBkZWZhdWx0IDYwIik7CiAgICAgICAgb3B0aW9ucy5hZGRP\ncHRpb24oImVudHJ5c2l6ZSIsIHRydWUsICJFbnRyeSBzaXplIChieXRlcyks\nIGRlZmF1bHQgMTAyNCIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJl\nbnNlbWJsZSIsIHRydWUsICJFbnNlbWJsZSBzaXplLCBkZWZhdWx0IDMiKTsK\nICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigicXVvcnVtIiwgdHJ1ZSwgIlF1\nb3J1bSBzaXplLCBkZWZhdWx0IDIiKTsKICAgICAgICBvcHRpb25zLmFkZE9w\ndGlvbigiYWNrUXVvcnVtIiwgdHJ1ZSwgIkFjayBxdW9ydW0gc2l6ZSwgZGVm\nYXVsdCBpcyBzYW1lIGFzIHF1b3J1bSIpOwogICAgICAgIG9wdGlvbnMuYWRk\nT3B0aW9uKCJ0aHJvdHRsZSIsIHRydWUsICJNYXggb3V0c3RhbmRpbmcgcmVx\ndWVzdHMsIGRlZmF1bHQgMTAwMDAiKTsKICAgICAgICBvcHRpb25zLmFkZE9w\ndGlvbigibGVkZ2VycyIsIHRydWUsICJOdW1iZXIgb2YgbGVkZ2VycywgZGVm\nYXVsdCAxIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oInpvb2tlZXBl\nciIsIHRydWUsICJab29rZWVwZXIgZW5zZW1ibGUsIGRlZmF1bHQgXCJsb2Nh\nbGhvc3Q6MjE4MVwiIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oInBh\nc3N3b3JkIiwgdHJ1ZSwgIlBhc3N3b3JkIHVzZWQgdG8gY3JlYXRlIGxlZGdl\ncnMgKGRlZmF1bHQgJ2JlbmNoUGFzc3dkJykiKTsKICAgICAgICBvcHRpb25z\nLmFkZE9wdGlvbigiY29vcmRub2RlIiwgdHJ1ZSwgIkNvb3JkaW5hdGlvbiB6\nbm9kZSBmb3IgbXVsdGkgY2xpZW50IGJlbmNobWFya3MgKG9wdGlvbmFsKSIp\nOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJ0aW1lb3V0IiwgdHJ1ZSwg\nIk51bWJlciBvZiBzZWNvbmRzIGFmdGVyIHdoaWNoIHRvIGdpdmUgdXAiKTsK\nICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigic29ja2V0dGltZW91dCIsIHRy\ndWUsICJTb2NrZXQgdGltZW91dCBmb3IgYm9va2tlZXBlciBjbGllbnQuIElu\nIHNlY29uZHMuIERlZmF1bHQgNSIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0\naW9uKCJza2lwd2FybXVwIiwgZmFsc2UsICJTa2lwIHdhcm0gdXAsIGRlZmF1\nbHQgZmFsc2UiKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigic2VuZGxp\nbWl0IiwgdHJ1ZSwgIk1heCBudW1iZXIgb2YgZW50cmllcyB0byBzZW5kLiBE\nZWZhdWx0IDIwMDAwMDAwIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24o\nImxhdGVuY3lGaWxlIiwgdHJ1ZSwgIkZpbGUgdG8gZHVtcCBsYXRlbmNpZXMu\nIERlZmF1bHQgaXMgbGF0ZW5jeUR1bXAuZGF0Iik7CiAgICAgICAgb3B0aW9u\ncy5hZGRPcHRpb24oImhlbHAiLCBmYWxzZSwgIlRoaXMgbWVzc2FnZSIpOwoK\nICAgICAgICBDb21tYW5kTGluZVBhcnNlciBwYXJzZXIgPSBuZXcgUG9zaXhQ\nYXJzZXIoKTsKICAgICAgICBDb21tYW5kTGluZSBjbWQgPSBwYXJzZXIucGFy\nc2Uob3B0aW9ucywgYXJncyk7CgogICAgICAgIGlmIChjbWQuaGFzT3B0aW9u\nKCJoZWxwIikpIHsKICAgICAgICAgICAgSGVscEZvcm1hdHRlciBmb3JtYXR0\nZXIgPSBuZXcgSGVscEZvcm1hdHRlcigpOwogICAgICAgICAgICBmb3JtYXR0\nZXIucHJpbnRIZWxwKCJCZW5jaFRocm91Z2hwdXRMYXRlbmN5IDxvcHRpb25z\nPiIsIG9wdGlvbnMpOwogICAgICAgICAgICBTeXN0ZW0uZXhpdCgtMSk7CiAg\nICAgICAgfQoKICAgICAgICBsb25nIHJ1bm5pbmdUaW1lID0gTG9uZy52YWx1\nZU9mKGNtZC5nZXRPcHRpb25WYWx1ZSgidGltZSIsICI2MCIpKTsKICAgICAg\nICBTdHJpbmcgc2VydmVycyA9IGNtZC5nZXRPcHRpb25WYWx1ZSgiem9va2Vl\ncGVyIiwgImxvY2FsaG9zdDoyMTgxIik7CiAgICAgICAgaW50IGVudHJ5c2l6\nZSA9IEludGVnZXIudmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoImVudHJ5\nc2l6ZSIsICIxMDI0IikpOwoKICAgICAgICBpbnQgbGVkZ2VycyA9IEludGVn\nZXIudmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoImxlZGdlcnMiLCAiMSIp\nKTsKICAgICAgICBpbnQgZW5zZW1ibGUgPSBJbnRlZ2VyLnZhbHVlT2YoY21k\nLmdldE9wdGlvblZhbHVlKCJlbnNlbWJsZSIsICIzIikpOwogICAgICAgIGlu\ndCBxdW9ydW0gPSBJbnRlZ2VyLnZhbHVlT2YoY21kLmdldE9wdGlvblZhbHVl\nKCJxdW9ydW0iLCAiMiIpKTsKICAgICAgICBpbnQgYWNrUXVvcnVtID0gcXVv\ncnVtOwogICAgICAgIGlmIChjbWQuaGFzT3B0aW9uKCJhY2tRdW9ydW0iKSkg\newogICAgICAgICAgICBhY2tRdW9ydW0gPSBJbnRlZ2VyLnZhbHVlT2YoY21k\nLmdldE9wdGlvblZhbHVlKCJhY2tRdW9ydW0iKSk7CiAgICAgICAgfQogICAg\nICAgIGludCB0aHJvdHRsZSA9IEludGVnZXIudmFsdWVPZihjbWQuZ2V0T3B0\naW9uVmFsdWUoInRocm90dGxlIiwgIjEwMDAwIikpOwogICAgICAgIGludCBz\nZW5kTGltaXQgPSBJbnRlZ2VyLnZhbHVlT2YoY21kLmdldE9wdGlvblZhbHVl\nKCJzZW5kbGltaXQiLCAiMjAwMDAwMDAiKSk7CgogICAgICAgIGZpbmFsIGlu\ndCBzb2NrVGltZW91dCA9IEludGVnZXIudmFsdWVPZihjbWQuZ2V0T3B0aW9u\nVmFsdWUoInNvY2tldHRpbWVvdXQiLCAiNSIpKTsKCiAgICAgICAgU3RyaW5n\nIGNvb3JkaW5hdGlvblpub2RlID0gY21kLmdldE9wdGlvblZhbHVlKCJjb29y\nZG5vZGUiKTsKICAgICAgICBmaW5hbCBieXRlW10gcGFzc3dkID0gY21kLmdl\ndE9wdGlvblZhbHVlKCJwYXNzd29yZCIsICJiZW5jaFBhc3N3ZCIpLmdldEJ5\ndGVzKFVURl84KTsKCiAgICAgICAgU3RyaW5nIGxhdGVuY3lGaWxlID0gY21k\nLmdldE9wdGlvblZhbHVlKCJsYXRlbmN5RmlsZSIsICJsYXRlbmN5RHVtcC5k\nYXQiKTsKCiAgICAgICAgVGltZXIgdGltZW91dGVyID0gbmV3IFRpbWVyKCk7\nCiAgICAgICAgaWYgKGNtZC5oYXNPcHRpb24oInRpbWVvdXQiKSkgewogICAg\nICAgICAgICBmaW5hbCBsb25nIHRpbWVvdXQgPSBMb25nLnZhbHVlT2YoY21k\nLmdldE9wdGlvblZhbHVlKCJ0aW1lb3V0IiwgIjM2MCIpKSAqIDEwMDA7Cgog\nICAgICAgICAgICB0aW1lb3V0ZXIuc2NoZWR1bGUobmV3IFRpbWVyVGFzaygp\nIHsKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiVGlt\naW5nIG91dCBiZW5jaG1hcmsgYWZ0ZXIgIiArIHRpbWVvdXQgKyAibXMiKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmV4aXQoLTEpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRpbWVvdXQp\nOwogICAgICAgIH0KCiAgICAgICAgTE9HLndhcm4oIihQYXJhbWV0ZXJzIHJl\nY2VpdmVkKSBydW5uaW5nIHRpbWU6ICIgKyBydW5uaW5nVGltZSArCiAgICAg\nICAgICAgICAgICAiLCBlbnRyeSBzaXplOiAiICsgZW50cnlzaXplICsgIiwg\nZW5zZW1ibGUgc2l6ZTogIiArIGVuc2VtYmxlICsKICAgICAgICAgICAgICAg\nICIsIHF1b3J1bSBzaXplOiAiICsgcXVvcnVtICsKICAgICAgICAgICAgICAg\nICIsIHRocm90dGxlOiAiICsgdGhyb3R0bGUgKwogICAgICAgICAgICAgICAg\nIiwgbnVtYmVyIG9mIGxlZGdlcnM6ICIgKyBsZWRnZXJzICsKICAgICAgICAg\nICAgICAgICIsIHprIHNlcnZlcnM6ICIgKyBzZXJ2ZXJzICsKICAgICAgICAg\nICAgICAgICIsIGxhdGVuY3kgZmlsZTogIiArIGxhdGVuY3lGaWxlKTsKCiAg\nICAgICAgbG9uZyB0b3RhbFRpbWUgPSBydW5uaW5nVGltZSoxMDAwOwoKICAg\nICAgICAvLyBEbyBhIHdhcm11cCBydW4KICAgICAgICBUaHJlYWQgdGhyZWFk\nOwoKICAgICAgICBieXRlIGRhdGFbXSA9IG5ldyBieXRlW2VudHJ5c2l6ZV07\nCiAgICAgICAgQXJyYXlzLmZpbGwoZGF0YSwgKGJ5dGUpJ3gnKTsKCiAgICAg\nICAgQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mID0gbmV3IENsaWVudENvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICBjb25mLnNldFRocm90dGxlVmFsdWUodGhy\nb3R0bGUpLnNldFJlYWRUaW1lb3V0KHNvY2tUaW1lb3V0KS5zZXRaa1NlcnZl\ncnMoc2VydmVycyk7CgogICAgICAgIGlmICghY21kLmhhc09wdGlvbigic2tp\ncHdhcm11cCIpKSB7CiAgICAgICAgICAgIGxvbmcgdGhyb3VnaHB1dDsKICAg\nICAgICAgICAgTE9HLmluZm8oIlN0YXJ0aW5nIHdhcm11cCIpOwoKICAgICAg\nICAgICAgdGhyb3VnaHB1dCA9IHdhcm1VcChkYXRhLCBsZWRnZXJzLCBlbnNl\nbWJsZSwgcXVvcnVtLCBwYXNzd2QsIGNvbmYpOwogICAgICAgICAgICBMT0cu\naW5mbygiV2FybXVwIHRwOiAiICsgdGhyb3VnaHB1dCk7CiAgICAgICAgICAg\nIExPRy5pbmZvKCJXYXJtdXAgcGhhc2UgZmluaXNoZWQiKTsKICAgICAgICB9\nCgoKICAgICAgICAvLyBOb3cgZG8gdGhlIGJlbmNobWFyawogICAgICAgIEJl\nbmNoVGhyb3VnaHB1dExhdGVuY3kgYmVuY2ggPSBuZXcgQmVuY2hUaHJvdWdo\ncHV0TGF0ZW5jeShlbnNlbWJsZSwgcXVvcnVtLCBhY2tRdW9ydW0sCiAgICAg\nICAgICAgICAgICBwYXNzd2QsIGxlZGdlcnMsIHNlbmRMaW1pdCwgY29uZik7\nCiAgICAgICAgYmVuY2guc2V0RW50cnlEYXRhKGRhdGEpOwogICAgICAgIHRo\ncmVhZCA9IG5ldyBUaHJlYWQoYmVuY2gpOwogICAgICAgIFpvb0tlZXBlciB6\nayA9IG51bGw7CgogICAgICAgIGlmIChjb29yZGluYXRpb25abm9kZSAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGNvbm5l\nY3RMYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICAgICAg\nemsgPSBuZXcgWm9vS2VlcGVyKHNlcnZlcnMsIDE1MDAwLCBuZXcgV2F0Y2hl\ncigpIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBl\ndmVudCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZ2V0\nU3RhdGUoKSA9PSBLZWVwZXJTdGF0ZS5TeW5jQ29ubmVjdGVkKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjb25uZWN0TGF0Y2guY291bnREb3du\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9fSk7CiAgICAgICAgICAgIGlmICghY29ubmVjdExhdGNoLmF3YWl0\nKDEwLCBUaW1lVW5pdC5TRUNPTkRTKSkgewogICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJDb3VsZG4ndCBjb25uZWN0IHRvIHpvb2tlZXBlciBhdCAiICsg\nc2VydmVycyk7CiAgICAgICAgICAgICAgICB6ay5jbG9zZSgpOwogICAgICAg\nICAgICAgICAgU3lzdGVtLmV4aXQoLTEpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBDb3Vu\ndERvd25MYXRjaCgxKTsKICAgICAgICAgICAgTE9HLmluZm8oIldhaXRpbmcg\nZm9yICIgKyBjb29yZGluYXRpb25abm9kZSk7CiAgICAgICAgICAgIGlmICh6\nay5leGlzdHMoY29vcmRpbmF0aW9uWm5vZGUsIG5ldyBXYXRjaGVyKCkgewog\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBldmVudCkgewogICAgICAg\nICAgICAgICAgICAgIGlmIChldmVudC5nZXRUeXBlKCkgPT0gRXZlbnRUeXBl\nLk5vZGVDcmVhdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhdGNo\nLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH19KSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBsYXRjaC5j\nb3VudERvd24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsYXRjaC5h\nd2FpdCgpOwogICAgICAgICAgICBMT0cuaW5mbygiQ29vcmRpbmF0aW9uIHpu\nb2RlIGNyZWF0ZWQiKTsKICAgICAgICB9CiAgICAgICAgdGhyZWFkLnN0YXJ0\nKCk7CiAgICAgICAgVGhyZWFkLnNsZWVwKHRvdGFsVGltZSk7CiAgICAgICAg\ndGhyZWFkLmludGVycnVwdCgpOwogICAgICAgIHRocmVhZC5qb2luKCk7Cgog\nICAgICAgIExPRy5pbmZvKCJDYWxjdWxhdGluZyBwZXJjZW50aWxlcyIpOwoK\nICAgICAgICBpbnQgbnVtbGF0ID0gMDsKICAgICAgICBmb3IoaW50IGkgPSAw\nOyBpIDwgYmVuY2gubGF0ZW5jaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAg\nICAgIGlmIChiZW5jaC5sYXRlbmNpZXNbaV0gPiAwKSB7CiAgICAgICAgICAg\nICAgICBudW1sYXQrKzsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICBpbnQgbnVtY29tcGxldGlvbnMgPSBudW1sYXQ7CiAgICAgICAgbnVtbGF0\nID0gTWF0aC5taW4oYmVuY2guc2VuZExpbWl0LCBudW1sYXQpOwogICAgICAg\nIGxvbmdbXSBsYXRlbmN5ID0gbmV3IGxvbmdbbnVtbGF0XTsKICAgICAgICBp\nbnQgaiA9MDsKICAgICAgICBmb3IoaW50IGkgPSAwOyBpIDwgYmVuY2gubGF0\nZW5jaWVzLmxlbmd0aCAmJiBqIDwgbnVtbGF0OyBpKyspIHsKICAgICAgICAg\nICAgaWYgKGJlbmNoLmxhdGVuY2llc1tpXSA+IDApIHsKICAgICAgICAgICAg\nICAgIGxhdGVuY3lbaisrXSA9IGJlbmNoLmxhdGVuY2llc1tpXTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICBBcnJheXMuc29ydChsYXRlbmN5\nKTsKCiAgICAgICAgbG9uZyB0cCA9IChsb25nKSgoZG91YmxlKShudW1jb21w\nbGV0aW9ucyoxMDAwLjApLyhkb3VibGUpYmVuY2guZ2V0RHVyYXRpb24oKSk7\nCgogICAgICAgIExPRy5pbmZvKG51bWNvbXBsZXRpb25zICsgIiBjb21wbGV0\naW9ucyBpbiAiICsgYmVuY2guZ2V0RHVyYXRpb24oKSArICIgbWlsbGlzZWNv\nbmRzOiAiICsgdHAgKyAiIG9wcy9zZWMiKTsKCiAgICAgICAgaWYgKHprICE9\nIG51bGwpIHsKICAgICAgICAgICAgemsuY3JlYXRlKGNvb3JkaW5hdGlvblpu\nb2RlICsgIi93b3JrZXItIiwKICAgICAgICAgICAgICAgICAgICAgICgidHAg\nIiArIHRwICsgIiBkdXJhdGlvbiAiICsgYmVuY2guZ2V0RHVyYXRpb24oKSku\nZ2V0Qnl0ZXMoVVRGXzgpLAogICAgICAgICAgICAgICAgICAgICAgWm9vRGVm\ncy5JZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlRf\nU0VRVUVOVElBTCk7CiAgICAgICAgICAgIHprLmNsb3NlKCk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBkdW1wIHRoZSBsYXRlbmNpZXMgZm9yIGxhdGVyIGRl\nYnVnZ2luZyAoaXQgd2lsbCBiZSBzb3J0ZWQgYnkgZW50cnlpZCkKICAgICAg\nICBPdXRwdXRTdHJlYW0gZm9zID0gbmV3IEJ1ZmZlcmVkT3V0cHV0U3RyZWFt\nKG5ldyBGaWxlT3V0cHV0U3RyZWFtKGxhdGVuY3lGaWxlKSk7CgogICAgICAg\nIGZvcihMb25nIGw6IGxhdGVuY3kpIHsKICAgICAgICAgICAgZm9zLndyaXRl\nKChMb25nLnRvU3RyaW5nKGwpKyJcdCIrKGwvMTAwMDAwMCkrICJtc1xuIiku\nZ2V0Qnl0ZXMoVVRGXzgpKTsKICAgICAgICB9CiAgICAgICAgZm9zLmZsdXNo\nKCk7CiAgICAgICAgZm9zLmNsb3NlKCk7CgogICAgICAgIC8vIG5vdyBnZXQg\ndGhlIGxhdGVuY2llcwogICAgICAgIExPRy5pbmZvKCI5OXRoIHBlcmNlbnRp\nbGUgbGF0ZW5jeToge30iLCBwZXJjZW50aWxlKGxhdGVuY3ksIDk5KSk7CiAg\nICAgICAgTE9HLmluZm8oIjk1dGggcGVyY2VudGlsZSBsYXRlbmN5OiB7fSIs\nIHBlcmNlbnRpbGUobGF0ZW5jeSwgOTUpKTsKCiAgICAgICAgYmVuY2guY2xv\nc2UoKTsKICAgICAgICB0aW1lb3V0ZXIuY2FuY2VsKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZG91YmxlIHBlcmNlbnRpbGUobG9uZ1tdIGxhdGVu\nY3ksIGludCBwZXJjZW50aWxlKSB7CiAgICAgICAgaW50IHNpemUgPSBsYXRl\nbmN5Lmxlbmd0aDsKICAgICAgICBpbnQgc2FtcGxlU2l6ZSA9IChzaXplICog\ncGVyY2VudGlsZSkgLyAxMDA7CiAgICAgICAgbG9uZyB0b3RhbCA9IDA7CiAg\nICAgICAgaW50IGNvdW50ID0gMDsKICAgICAgICBmb3IoaW50IGkgPSAwOyBp\nIDwgc2FtcGxlU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHRvdGFsICs9IGxh\ndGVuY3lbaV07CiAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiAoKGRvdWJsZSl0b3RhbC8oZG91YmxlKWNvdW50KS8xMDAw\nMDAwLjA7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgbG9uZyB3YXJtVXAo\nYnl0ZVtdIGRhdGEsIGludCBsZWRnZXJzLCBpbnQgZW5zZW1ibGUsIGludCBx\nU2l6ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBw\nYXNzd2QsIENsaWVudENvbmZpZ3VyYXRpb24gY29uZikKICAgICAgICAgICAg\ndGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSU9FeGNlcHRpb24sIEludGVycnVw\ndGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgQ291\nbnREb3duTGF0Y2ggY29ubmVjdExhdGNoID0gbmV3IENvdW50RG93bkxhdGNo\nKDEpOwogICAgICAgIGZpbmFsIGludCBib29raWVzOwogICAgICAgIFN0cmlu\nZyBib29raWVSZWdpc3RyYXRpb25QYXRoID0gY29uZi5nZXRaa0F2YWlsYWJs\nZUJvb2tpZXNQYXRoKCk7CiAgICAgICAgWm9vS2VlcGVyIHprID0gbnVsbDsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBmaW5hbCBTdHJpbmcgc2VydmVy\ncyA9IGNvbmYuZ2V0WmtTZXJ2ZXJzKCk7CiAgICAgICAgICAgIHprID0gbmV3\nIFpvb0tlZXBlcihzZXJ2ZXJzLCAxNTAwMCwgbmV3IFdhdGNoZXIoKSB7CiAg\nICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFN0YXRlKCkg\nPT0gS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY29ubmVjdExhdGNoLmNvdW50RG93bigpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfX0p\nOwogICAgICAgICAgICBpZiAoIWNvbm5lY3RMYXRjaC5hd2FpdCgxMCwgVGlt\nZVVuaXQuU0VDT05EUykpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigi\nQ291bGRuJ3QgY29ubmVjdCB0byB6b29rZWVwZXIgYXQgIiArIHNlcnZlcnMp\nOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJDb3Vs\nZG4ndCBjb25uZWN0IHRvIHpvb2tlZXBlciAiICsgc2VydmVycyk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgYm9va2llcyA9IHprLmdldENoaWxkcmVu\nKGJvb2tpZVJlZ2lzdHJhdGlvblBhdGgsIGZhbHNlKS5zaXplKCk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHprICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIHprLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIEJlbmNoVGhyb3VnaHB1dExhdGVuY3kgd2FybXVw\nID0gbmV3IEJlbmNoVGhyb3VnaHB1dExhdGVuY3koYm9va2llcywgYm9va2ll\ncywgYm9va2llcywgcGFzc3dkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VycywgMTAwMDAsIGNvbmYpOwogICAgICAgIHdhcm11cC5zZXRFbnRyeURh\ndGEoZGF0YSk7CiAgICAgICAgVGhyZWFkIHRocmVhZCA9IG5ldyBUaHJlYWQo\nd2FybXVwKTsKICAgICAgICB0aHJlYWQuc3RhcnQoKTsKICAgICAgICB0aHJl\nYWQuam9pbigpOwogICAgICAgIHdhcm11cC5jbG9zZSgpOwogICAgICAgIHJl\ndHVybiB3YXJtdXAuZ2V0VGhyb3VnaHB1dCgpOwogICAgfQp9Cg==\n","encoding":"base64"}

