{"sha":"b64151c565e4f249dfc3642b002fc3d46b01c935","node_id":"MDQ6QmxvYjE1NzU5NTY6YjY0MTUxYzU2NWU0ZjI0OWRmYzM2NDJiMDAyZmMzZDQ2YjAxYzkzNQ==","size":14647,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b64151c565e4f249dfc3642b002fc3d46b01c935","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsK\nCmltcG9ydCBqYXZhLmlvLkZpbGVPdXRwdXRTdHJlYW07CmltcG9ydCBqYXZh\nLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlJhbmRv\nbTsKaW1wb3J0IGphdmEudXRpbC5UaW1lcjsKaW1wb3J0IGphdmEudXRpbC5U\naW1lclRhc2s7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5DYWxsYWJs\nZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dGlvbkV4Y2Vw\ndGlvbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yU2Vy\ndmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkZ1dHVyZTsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0xvbmc7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxi\nYWNrLkFkZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Db21tYW5kTGluZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmVQYXJzZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBGb3JtYXR0ZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9wdGlvbnM7CmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMuY2xpLlBhcnNlRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Qb3NpeFBhcnNlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGFkb29wLmNvbmYuQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGFkb29wLmZzLkZTRGF0YU91dHB1dFN0cmVhbTsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGFkb29wLmZzLkZpbGVTeXN0ZW07CmltcG9ydCBvcmcu\nYXBhY2hlLmhhZG9vcC5mcy5QYXRoOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\ncjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IHN0\nYXRpYyBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLkNoYXJzZXRzLlVURl84OwoK\nLyoqCiAqIFRoaXMgaXMgYSBzaW1wbGUgdGVzdCBwcm9ncmFtIHRvIGNvbXBh\ncmUgdGhlIHBlcmZvcm1hbmNlIG9mIHdyaXRpbmcgdG8KICogQm9va0tlZXBl\nciBhbmQgdG8gdGhlIGxvY2FsIGZpbGUgc3lzdGVtLgogKgogKi8KCnB1Ymxp\nYyBjbGFzcyBUZXN0Q2xpZW50IHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZXN0Q2xp\nZW50LmNsYXNzKTsKCiAgICAvKioKICAgICAqIEZpcnN0IHNheXMgaWYgZW50\ncmllcyBzaG91bGQgYmUgd3JpdHRlbiB0byBCb29rS2VlcGVyICgwKSBvciB0\nbyB0aGUgbG9jYWwKICAgICAqIGRpc2sgKDEpLiBTZWNvbmQgcGFyYW1ldGVy\nIGlzIGFuIGludGVnZXIgZGVmaW5pbmcgdGhlIGxlbmd0aCBvZiBhIGxlZGdl\nciBlbnRyeS4KICAgICAqIFRoaXJkIHBhcmFtZXRlciBpcyB0aGUgbnVtYmVy\nIG9mIHdyaXRlcy4KICAgICAqCiAgICAgKiBAcGFyYW0gYXJncwogICAgICov\nCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB0\naHJvd3MgUGFyc2VFeGNlcHRpb24gewogICAgICAgIE9wdGlvbnMgb3B0aW9u\ncyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24o\nImxlbmd0aCIsIHRydWUsICJMZW5ndGggb2YgcGFja2V0cyBiZWluZyB3cml0\ndGVuLiBEZWZhdWx0IDEwMjQiKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlv\nbigidGFyZ2V0IiwgdHJ1ZSwgIlRhcmdldCBtZWRpdW0gdG8gd3JpdGUgdG8u\nIE9wdGlvbnMgYXJlIGJrLCBmcyAmIGhkZnMuIERlZmF1bHQgZnMiKTsKICAg\nICAgICBvcHRpb25zLmFkZE9wdGlvbigicnVuZm9yIiwgdHJ1ZSwgIk51bWJl\nciBvZiBzZWNvbmRzIHRvIHJ1biBmb3IuIERlZmF1bHQgNjAiKTsKICAgICAg\nICBvcHRpb25zLmFkZE9wdGlvbigicGF0aCIsIHRydWUsICJQYXRoIHRvIHdy\naXRlIHRvLiBmcyAmIGhkZnMgb25seS4gRGVmYXVsdCAvZm9vYmFyIik7CiAg\nICAgICAgb3B0aW9ucy5hZGRPcHRpb24oInprc2VydmVycyIsIHRydWUsICJa\nb29LZWVwZXIgc2VydmVycywgY29tbWEgc2VwYXJhdGVkLiBiayBvbmx5LiBE\nZWZhdWx0IGxvY2FsaG9zdDoyMTgxLiIpOwogICAgICAgIG9wdGlvbnMuYWRk\nT3B0aW9uKCJia2Vuc2VtYmxlIiwgdHJ1ZSwgIkJvb2tLZWVwZXIgbGVkZ2Vy\nIGVuc2VtYmxlIHNpemUuIGJrIG9ubHkuIERlZmF1bHQgMyIpOwogICAgICAg\nIG9wdGlvbnMuYWRkT3B0aW9uKCJia3F1b3J1bSIsIHRydWUsICJCb29rS2Vl\ncGVyIGxlZGdlciBxdW9ydW0gc2l6ZS4gYmsgb25seS4gRGVmYXVsdCAyIik7\nCiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oImJrdGhyb3R0bGUiLCB0cnVl\nLCAiQm9va0tlZXBlciB0aHJvdHRsZSBzaXplLiBiayBvbmx5LiBEZWZhdWx0\nIDEwMDAwIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oInN5bmMiLCBm\nYWxzZSwgIlVzZSBzeW5jaHJvbm91cyB3cml0ZXMgd2l0aCBCb29rS2VlcGVy\nLiBiayBvbmx5LiIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJudW1j\nb25jdXJyZW50IiwgdHJ1ZSwgIk51bWJlciBvZiBjb25jdXJyZW50bHkgY2xp\nZW50cy4gRGVmYXVsdCAxIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24o\nInRpbWVvdXQiLCB0cnVlLCAiTnVtYmVyIG9mIHNlY29uZHMgYWZ0ZXIgd2hp\nY2ggdG8gZ2l2ZSB1cCIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJo\nZWxwIiwgZmFsc2UsICJUaGlzIG1lc3NhZ2UiKTsKCiAgICAgICAgQ29tbWFu\nZExpbmVQYXJzZXIgcGFyc2VyID0gbmV3IFBvc2l4UGFyc2VyKCk7CiAgICAg\nICAgQ29tbWFuZExpbmUgY21kID0gcGFyc2VyLnBhcnNlKG9wdGlvbnMsIGFy\nZ3MpOwoKICAgICAgICBpZiAoY21kLmhhc09wdGlvbigiaGVscCIpKSB7CiAg\nICAgICAgICAgIEhlbHBGb3JtYXR0ZXIgZm9ybWF0dGVyID0gbmV3IEhlbHBG\nb3JtYXR0ZXIoKTsKICAgICAgICAgICAgZm9ybWF0dGVyLnByaW50SGVscCgi\nVGVzdENsaWVudCA8b3B0aW9ucz4iLCBvcHRpb25zKTsKICAgICAgICAgICAg\nU3lzdGVtLmV4aXQoLTEpOwogICAgICAgIH0KCiAgICAgICAgaW50IGxlbmd0\naCA9IEludGVnZXIudmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoImxlbmd0\naCIsICIxMDI0IikpOwogICAgICAgIFN0cmluZyB0YXJnZXQgPSBjbWQuZ2V0\nT3B0aW9uVmFsdWUoInRhcmdldCIsICJmcyIpOwogICAgICAgIGxvbmcgcnVu\nZm9yID0gTG9uZy52YWx1ZU9mKGNtZC5nZXRPcHRpb25WYWx1ZSgicnVuZm9y\nIiwgIjYwIikpICogMTAwMDsKCiAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9\nIG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgd2hpbGUobGVuZ3RoLS0g\nPiAwKSB7CiAgICAgICAgICAgIHNiLmFwcGVuZCgnYScpOwogICAgICAgIH0K\nCiAgICAgICAgVGltZXIgdGltZW91dGVyID0gbmV3IFRpbWVyKCk7CiAgICAg\nICAgaWYgKGNtZC5oYXNPcHRpb24oInRpbWVvdXQiKSkgewogICAgICAgICAg\nICBmaW5hbCBsb25nIHRpbWVvdXQgPSBMb25nLnZhbHVlT2YoY21kLmdldE9w\ndGlvblZhbHVlKCJ0aW1lb3V0IiwgIjM2MCIpKSAqIDEwMDA7CgogICAgICAg\nICAgICB0aW1lb3V0ZXIuc2NoZWR1bGUobmV3IFRpbWVyVGFzaygpIHsKICAg\nICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiVGltaW5nIG91\ndCBiZW5jaG1hcmsgYWZ0ZXIgIiArIHRpbWVvdXQgKyAibXMiKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgU3lzdGVtLmV4aXQoLTEpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIHRpbWVvdXQpOwogICAg\nICAgIH0KCiAgICAgICAgQm9va0tlZXBlciBia2MgPSBudWxsOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGludCBudW1GaWxlcyA9IEludGVnZXIudmFs\ndWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoIm51bWNvbmN1cnJlbnQiLCAiMSIp\nKTsKICAgICAgICAgICAgaW50IG51bVRocmVhZHMgPSBNYXRoLm1pbihudW1G\naWxlcywgMTAwMCk7CiAgICAgICAgICAgIGJ5dGVbXSBkYXRhID0gc2IudG9T\ndHJpbmcoKS5nZXRCeXRlcyhVVEZfOCk7CiAgICAgICAgICAgIGxvbmcgcnVu\naWQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAg\nTGlzdDxDYWxsYWJsZTxMb25nPj4gY2xpZW50cyA9IG5ldyBBcnJheUxpc3Q8\nQ2FsbGFibGU8TG9uZz4+KCk7CgogICAgICAgICAgICBpZiAodGFyZ2V0LmVx\ndWFscygiYmsiKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIHprc2VydmVy\ncyA9IGNtZC5nZXRPcHRpb25WYWx1ZSgiemtzZXJ2ZXJzIiwgImxvY2FsaG9z\ndDoyMTgxIik7CiAgICAgICAgICAgICAgICBpbnQgYmtlbnNlbWJsZSA9IElu\ndGVnZXIudmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoImJrZW5zZW1ibGUi\nLCAiMyIpKTsKICAgICAgICAgICAgICAgIGludCBia3F1b3J1bSA9IEludGVn\nZXIudmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoImJrcXVvcnVtIiwgIjIi\nKSk7CiAgICAgICAgICAgICAgICBpbnQgYmt0aHJvdHRsZSA9IEludGVnZXIu\ndmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoImJrdGhyb3R0bGUiLCAiMTAw\nMDAiKSk7CgogICAgICAgICAgICAgICAgQ2xpZW50Q29uZmlndXJhdGlvbiBj\nb25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAg\nICAgIGNvbmYuc2V0VGhyb3R0bGVWYWx1ZShia3Rocm90dGxlKTsKICAgICAg\nICAgICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKHprc2VydmVycyk7CgogICAg\nICAgICAgICAgICAgYmtjID0gbmV3IEJvb2tLZWVwZXIoY29uZik7CiAgICAg\nICAgICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gaGFuZGxlcyA9IG5ldyBB\ncnJheUxpc3Q8TGVkZ2VySGFuZGxlPigpOwogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBudW1GaWxlczsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgaGFuZGxlcy5hZGQoYmtjLmNyZWF0ZUxlZGdlcihia2Vuc2Vt\nYmxlLCBia3F1b3J1bSwgRGlnZXN0VHlwZS5DUkMzMiwgbmV3IGJ5dGVbXSB7\nJ2EnLCAnYid9KSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IG51bUZpbGVzOyBpKyspIHsKICAgICAg\nICAgICAgICAgICAgICBjbGllbnRzLmFkZChuZXcgQktDbGllbnQoaGFuZGxl\ncywgZGF0YSwgcnVuZm9yLCBjbWQuaGFzT3B0aW9uKCJzeW5jIikpKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQu\nZXF1YWxzKCJoZGZzIikpIHsKICAgICAgICAgICAgICAgIEZpbGVTeXN0ZW0g\nZnMgPSBGaWxlU3lzdGVtLmdldChuZXcgQ29uZmlndXJhdGlvbigpKTsKICAg\nICAgICAgICAgICAgIExPRy5pbmZvKCJEZWZhdWx0IHJlcGxpY2F0aW9uIGZv\nciBIREZTOiB7fSIsIGZzLmdldERlZmF1bHRSZXBsaWNhdGlvbigpKTsKCiAg\nICAgICAgICAgICAgICBMaXN0PEZTRGF0YU91dHB1dFN0cmVhbT4gc3RyZWFt\ncyA9IG5ldyBBcnJheUxpc3Q8RlNEYXRhT3V0cHV0U3RyZWFtPigpOwogICAg\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1GaWxlczsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHBhdGggPSBjbWQuZ2V0\nT3B0aW9uVmFsdWUoInBhdGgiLCAiL2Zvb2JhciIpOwogICAgICAgICAgICAg\nICAgICAgIHN0cmVhbXMuYWRkKGZzLmNyZWF0ZShuZXcgUGF0aChwYXRoICsg\ncnVuaWQgKyAiXyIgKyBpKSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtVGhyZWFkczsgaSsr\nKSB7CiAgICAgICAgICAgICAgICAgICAgY2xpZW50cy5hZGQobmV3IEhERlND\nbGllbnQoc3RyZWFtcywgZGF0YSwgcnVuZm9yKSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFyZ2V0LmVxdWFscygiZnMi\nKSkgewogICAgICAgICAgICAgICAgTGlzdDxGaWxlT3V0cHV0U3RyZWFtPiBz\ndHJlYW1zID0gbmV3IEFycmF5TGlzdDxGaWxlT3V0cHV0U3RyZWFtPigpOwog\nICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1GaWxlczsg\naSsrKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHBhdGggPSBjbWQu\nZ2V0T3B0aW9uVmFsdWUoInBhdGgiLCAiL2Zvb2JhciAiICsgaSk7CiAgICAg\nICAgICAgICAgICAgICAgc3RyZWFtcy5hZGQobmV3IEZpbGVPdXRwdXRTdHJl\nYW0ocGF0aCArIHJ1bmlkICsgIl8iICsgaSkpOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtVGhy\nZWFkczsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY2xpZW50cy5hZGQo\nbmV3IEZpbGVDbGllbnQoc3RyZWFtcywgZGF0YSwgcnVuZm9yKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIlVua25vd24gb3B0aW9uOiAiICsgdGFyZ2V0KTsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24oIlVua25vd24gdGFyZ2V0ICIgKyB0YXJnZXQpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBFeGVjdXRvclNlcnZpY2UgZXhlY3V0b3IgPSBF\neGVjdXRvcnMubmV3Rml4ZWRUaHJlYWRQb29sKG51bVRocmVhZHMpOwogICAg\nICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCk7CgogICAgICAgICAgICBMaXN0PEZ1dHVyZTxMb25nPj4gcmVzdWx0cyA9\nIGV4ZWN1dG9yLmludm9rZUFsbChjbGllbnRzLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAx\nMCwgVGltZVVuaXQuTUlOVVRFUyk7CiAgICAgICAgICAgIGxvbmcgZW5kID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgIGxvbmcg\nY291bnQgPSAwOwogICAgICAgICAgICBmb3IgKEZ1dHVyZTxMb25nPiByIDog\ncmVzdWx0cykgewogICAgICAgICAgICAgICAgaWYgKCFyLmlzRG9uZSgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkpvYiBkaWRuJ3QgY29t\ncGxldGUiKTsKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXhpdCgyKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvbmcgYyA9IHIu\nZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoYyA9PSAwKSB7CiAgICAgICAg\nICAgICAgICAgICAgTE9HLndhcm4oIlRhc2sgZGlkbid0IGNvbXBsZXRlIik7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb3VudCArPSBj\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxvbmcgdGltZSA9IGVuZC1z\ndGFydDsKICAgICAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIHByb2Nlc3Np\nbmcgd3JpdGVzIChtcyk6IHt9IFRQVDoge30gb3AvcyIsCiAgICAgICAgICAg\nICAgICAgICAgIHRpbWUsIGNvdW50LygoZG91YmxlKXRpbWUvMTAwMCkpOwog\nICAgICAgICAgICBleGVjdXRvci5zaHV0ZG93bigpOwogICAgICAgIH0gY2F0\nY2ggKEV4ZWN1dGlvbkV4Y2VwdGlvbiBlZSkgewogICAgICAgICAgICBMT0cu\nZXJyb3IoIkV4Y2VwdGlvbiBpbiB3b3JrZXIiLCBlZSk7CiAgICAgICAgfSAg\nY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICBMT0cu\nZXJyb3IoIkVycm9yIGFjY2Vzc2luZyB6b29rZWVwZXIiLCBrZSk7CiAgICAg\nICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cu\nZXJyb3IoIkVycm9yIGFjY2Vzc2luZyBib29ra2VlcGVyIiwgZSk7CiAgICAg\nICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiSS9PIGV4Y2VwdGlvbiBkdXJpbmcgYmVuY2htYXJrIiwgaW9l\nKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkg\newogICAgICAgICAgICBMT0cuZXJyb3IoIkJlbmNobWFyayBpbnRlcnJ1cHRl\nZCIsIGllKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAo\nYmtjICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgYmtjLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkVycm9yIGNsb3NpbmcgYm9va2tlZXBlciBjbGllbnQiLCBi\na2UpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNl\ncHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiSW50\nZXJydXB0ZWQgY2xvc2luZyBib29ra2VlcGVyIGNsaWVudCIsIGllKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICB0aW1lb3V0ZXIuY2FuY2VsKCk7CiAgICB9CgogICAgc3RhdGljIGNsYXNz\nIEhERlNDbGllbnQgaW1wbGVtZW50cyBDYWxsYWJsZTxMb25nPiB7CiAgICAg\nICAgZmluYWwgTGlzdDxGU0RhdGFPdXRwdXRTdHJlYW0+IHN0cmVhbXM7CiAg\nICAgICAgZmluYWwgYnl0ZVtdIGRhdGE7CiAgICAgICAgZmluYWwgbG9uZyB0\naW1lOwogICAgICAgIGZpbmFsIFJhbmRvbSByOwoKICAgICAgICBIREZTQ2xp\nZW50KExpc3Q8RlNEYXRhT3V0cHV0U3RyZWFtPiBzdHJlYW1zLCBieXRlW10g\nZGF0YSwgbG9uZyB0aW1lKSB7CiAgICAgICAgICAgIHRoaXMuc3RyZWFtcyA9\nIHN0cmVhbXM7CiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAg\nICAgICAgIHRoaXMudGltZSA9IHRpbWU7CiAgICAgICAgICAgIHRoaXMuciA9\nIG5ldyBSYW5kb20oU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhpcykpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIExvbmcgY2FsbCgpIHsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxvbmcgY291bnQgPSAwOwog\nICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgICAgICAgICAgbG9uZyBzdG9wYXQgPSBzdGFy\ndCArIHRpbWU7CiAgICAgICAgICAgICAgICB3aGlsZShTeXN0ZW0uY3VycmVu\ndFRpbWVNaWxsaXMoKSA8IHN0b3BhdCkgewogICAgICAgICAgICAgICAgICAg\nIEZTRGF0YU91dHB1dFN0cmVhbSBzdHJlYW0gPSBzdHJlYW1zLmdldChyLm5l\neHRJbnQoc3RyZWFtcy5zaXplKCkpKTsKICAgICAgICAgICAgICAgICAgICBz\neW5jaHJvbml6ZWQoc3RyZWFtKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHN0cmVhbS53cml0ZShkYXRhKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nc3RyZWFtLmZsdXNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVh\nbS5oZmx1c2goKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICBsb25nIHRpbWUgPSAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCkgLSBzdGFydCk7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiV29ya2Vy\nIGZpbmlzaGVkIHByb2Nlc3Npbmcgd3JpdGVzIChtcyk6IHt9IFRQVDoge30g\nb3AvcyIsCiAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLCBjb3VudC8o\nKGRvdWJsZSl0aW1lLzEwMDApKTsKICAgICAgICAgICAgICAgIHJldHVybiBj\nb3VudDsKICAgICAgICAgICAgfSBjYXRjaChJT0V4Y2VwdGlvbiBpb2UpIHsK\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIHdvcmtl\nciB0aHJlYWQiLCBpb2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIDBMOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBjbGFz\ncyBGaWxlQ2xpZW50IGltcGxlbWVudHMgQ2FsbGFibGU8TG9uZz4gewogICAg\nICAgIGZpbmFsIExpc3Q8RmlsZU91dHB1dFN0cmVhbT4gc3RyZWFtczsKICAg\nICAgICBmaW5hbCBieXRlW10gZGF0YTsKICAgICAgICBmaW5hbCBsb25nIHRp\nbWU7CiAgICAgICAgZmluYWwgUmFuZG9tIHI7CgogICAgICAgIEZpbGVDbGll\nbnQoTGlzdDxGaWxlT3V0cHV0U3RyZWFtPiBzdHJlYW1zLCBieXRlW10gZGF0\nYSwgbG9uZyB0aW1lKSB7CiAgICAgICAgICAgIHRoaXMuc3RyZWFtcyA9IHN0\ncmVhbXM7CiAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAg\nICAgIHRoaXMudGltZSA9IHRpbWU7CiAgICAgICAgICAgIHRoaXMuciA9IG5l\ndyBSYW5kb20oU3lzdGVtLmlkZW50aXR5SGFzaENvZGUodGhpcykpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIExvbmcgY2FsbCgpIHsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxvbmcgY291bnQgPSAwOwogICAg\nICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1p\nbGxpcygpOwoKICAgICAgICAgICAgICAgIGxvbmcgc3RvcGF0ID0gc3RhcnQg\nKyB0aW1lOwogICAgICAgICAgICAgICAgd2hpbGUoU3lzdGVtLmN1cnJlbnRU\naW1lTWlsbGlzKCkgPCBzdG9wYXQpIHsKICAgICAgICAgICAgICAgICAgICBG\naWxlT3V0cHV0U3RyZWFtIHN0cmVhbSA9IHN0cmVhbXMuZ2V0KHIubmV4dElu\ndChzdHJlYW1zLnNpemUoKSkpOwogICAgICAgICAgICAgICAgICAgIHN5bmNo\ncm9uaXplZChzdHJlYW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3Ry\nZWFtLndyaXRlKGRhdGEpOwogICAgICAgICAgICAgICAgICAgICAgICBzdHJl\nYW0uZmx1c2goKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmdl\ndENoYW5uZWwoKS5mb3JjZShmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgbG9uZyB0aW1lID0gKFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpIC0gc3RhcnQpOwogICAgICAgICAgICAgICAgTE9H\nLmluZm8oIldvcmtlciBmaW5pc2hlZCBwcm9jZXNzaW5nIHdyaXRlcyAobXMp\nOiB7fSBUUFQ6IHt9IG9wL3MiLCB0aW1lLCBjb3VudC8oKGRvdWJsZSl0aW1l\nLzEwMDApKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAg\nICAgICAgfSBjYXRjaChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIHdvcmtlciB0aHJlYWQiLCBp\nb2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIDBMOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBjbGFzcyBCS0NsaWVudCBp\nbXBsZW1lbnRzIENhbGxhYmxlPExvbmc+LCBBZGRDYWxsYmFjayB7CiAgICAg\nICAgZmluYWwgTGlzdDxMZWRnZXJIYW5kbGU+IGhhbmRsZXM7CiAgICAgICAg\nZmluYWwgYnl0ZVtdIGRhdGE7CiAgICAgICAgZmluYWwgbG9uZyB0aW1lOwog\nICAgICAgIGZpbmFsIFJhbmRvbSByOwogICAgICAgIGZpbmFsIGJvb2xlYW4g\nc3luYzsKICAgICAgICBmaW5hbCBBdG9taWNMb25nIHN1Y2Nlc3MgPSBuZXcg\nQXRvbWljTG9uZygwKTsKICAgICAgICBmaW5hbCBBdG9taWNMb25nIG91dHN0\nYW5kaW5nID0gbmV3IEF0b21pY0xvbmcoMCk7CgogICAgICAgIEJLQ2xpZW50\nKExpc3Q8TGVkZ2VySGFuZGxlPiBoYW5kbGVzLCBieXRlW10gZGF0YSwgbG9u\nZyB0aW1lLCBib29sZWFuIHN5bmMpIHsKICAgICAgICAgICAgdGhpcy5oYW5k\nbGVzID0gaGFuZGxlczsKICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsK\nICAgICAgICAgICAgdGhpcy50aW1lID0gdGltZTsKICAgICAgICAgICAgdGhp\ncy5yID0gbmV3IFJhbmRvbShTeXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0aGlz\nKSk7CiAgICAgICAgICAgIHRoaXMuc3luYyA9IHN5bmM7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgTG9uZyBjYWxsKCkgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwoKICAgICAgICAgICAgICAgIGxvbmcgc3RvcGF0ID0g\nc3RhcnQgKyB0aW1lOwogICAgICAgICAgICAgICAgd2hpbGUoU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCkgPCBzdG9wYXQpIHsKICAgICAgICAgICAgICAg\nICAgICBMZWRnZXJIYW5kbGUgbGggPSBoYW5kbGVzLmdldChyLm5leHRJbnQo\naGFuZGxlcy5zaXplKCkpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoc3lu\nYykgewogICAgICAgICAgICAgICAgICAgICAgICBsaC5hZGRFbnRyeShkYXRh\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzcy5pbmNyZW1lbnRB\nbmRHZXQoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBsaC5hc3luY0FkZEVudHJ5KGRhdGEsIHRoaXMs\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBvdXRzdGFuZGluZy5p\nbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaW50IHRpY2tzID0gMTA7\nIC8vIGRvbid0IHdhaXQgZm9yIG1vcmUgdGhhbiAxMCBzZWNvbmRzCiAgICAg\nICAgICAgICAgICB3aGlsZSAob3V0c3RhbmRpbmcuZ2V0KCkgPiAwICYmIHRp\nY2tzLS0gPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVw\nKDEwKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsb25n\nIHRpbWUgPSAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydCk7\nCiAgICAgICAgICAgICAgICBMT0cuaW5mbygiV29ya2VyIGZpbmlzaGVkIHBy\nb2Nlc3Npbmcgd3JpdGVzIChtcyk6IHt9IFRQVDoge30gb3AvcyIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICB0aW1lLCBzdWNjZXNzLmdldCgpLygoZG91\nYmxlKXRpbWUvMTAwMCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nl\nc3MuZ2V0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIHdv\ncmtlciB0aHJlYWQiLCBlKTsKICAgICAgICAgICAgICAgIHJldHVybiAwTDsK\nICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUp\nIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIHdv\ncmtlciB0aHJlYWQiLCBpZSk7CiAgICAgICAgICAgICAgICByZXR1cm4gMEw7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIGFkZENvbXBsZXRlKGludCByYywgTGVkZ2Vy\nSGFuZGxlIGxoLCBsb25nIGVudHJ5SWQsIE9iamVjdCBjdHgpIHsKICAgICAg\nICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAg\nICAgICAgICAgIHN1Y2Nlc3MuaW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgb3V0c3RhbmRpbmcuZGVjcmVtZW50QW5kR2V0\nKCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

