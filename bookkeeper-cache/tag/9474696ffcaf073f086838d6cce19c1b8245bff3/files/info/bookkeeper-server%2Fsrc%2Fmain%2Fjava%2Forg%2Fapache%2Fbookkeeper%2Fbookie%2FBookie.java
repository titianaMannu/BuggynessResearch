{"sha":"54a3c9fbfaf9f372b569ef50c7f5533b107133d8","node_id":"MDQ6QmxvYjE1NzU5NTY6NTRhM2M5ZmJmYWY5ZjM3MmI1NjllZjUwYzdmNTUzM2IxMDcxMzNkOA==","size":50394,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/54a3c9fbfaf9f372b569ef50c7f5533b107133d8","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IHN0YXRpYyBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLkNoYXJzZXRz\nLlVURl84OwoKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8u\nRmlsZU5vdEZvdW5kRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5GaWxlbmFt\nZUZpbHRlcjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBq\nYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0LlVu\na25vd25Ib3N0RXhjZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZl\ncjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJl\nbnRIYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3Vy\ncmVudE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93\nbkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuRnV0dXJlOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5UaW1lb3V0RXhjZXB0aW9uOwppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0Jvb2xlYW47Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Kb3VybmFsLkpv\ndXJuYWxTY2FubmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJv\nb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5MZWRnZXJEaXJzTGlzdGVuZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkxlZGdlckRpcnNN\nYW5hZ2VyLk5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmpteC5CS01CZWFuSW5m\nbzsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5qbXguQktNQmVhblJl\nZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVk\nZ2VyTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRh\nLkxlZGdlck1hbmFnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLm5ldC5Cb29raWVTb2NrZXRBZGRyZXNzOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLm5ldC5ETlM7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLldy\naXRlQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3Rh\ndHMuQ291bnRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0\ncy5HYXVnZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5O\ndWxsU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nc3RhdHMuU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnV0aWwuSU9VdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci51dGlsLk1hdGhVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci51dGlsLlprVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIudmVyc2lvbmluZy5WZXJzaW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lvbmVkOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnpvb2tlZXBlci5ab29LZWVwZXJXYXRjaGVy\nQmFzZTsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5pby5GaWxlVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5DcmVhdGVNb2RlOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uLk5vZGVF\neGlzdHNFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5X\nYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRj\naGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVu\ndC5FdmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29E\nZWZzLklkczsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLmRhdGEuU3RhdDsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2Vy\nRmFjdG9yeTsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi5hbm5vdGF0aW9u\ncy5WaXNpYmxlRm9yVGVzdGluZzsKCmltcG9ydCBzdGF0aWMgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29rS2VlcGVyU2VydmVyU3RhdHMuTERf\nTEVER0VSX1NDT1BFOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5ib29raWUuQm9va0tlZXBlclNlcnZlclN0YXRzLkxEX0lOREVYX1ND\nT1BFOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29r\naWUuQm9va0tlZXBlclNlcnZlclN0YXRzLlJFQURfQllURVM7CmltcG9ydCBz\ndGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29rS2VlcGVy\nU2VydmVyU3RhdHMuU0VSVkVSX1NUQVRVUzsKaW1wb3J0IHN0YXRpYyBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tLZWVwZXJTZXJ2ZXJTdGF0\ncy5XUklURV9CWVRFUzsKCi8qKgogKiBJbXBsZW1lbnRzIGEgYm9va2llLgog\nKgogKi8KcHVibGljIGNsYXNzIEJvb2tpZSBleHRlbmRzIEJvb2tpZUNyaXRp\nY2FsVGhyZWFkIHsKCiAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBMb2dnZXIg\nTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va2llLmNsYXNzKTsK\nCiAgICBmaW5hbCBGaWxlIGpvdXJuYWxEaXJlY3Rvcnk7CiAgICBmaW5hbCBT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CgogICAgZmluYWwgU3luY1RocmVh\nZCBzeW5jVGhyZWFkOwogICAgZmluYWwgTGVkZ2VyTWFuYWdlckZhY3Rvcnkg\nbGVkZ2VyTWFuYWdlckZhY3Rvcnk7CiAgICBmaW5hbCBMZWRnZXJNYW5hZ2Vy\nIGxlZGdlck1hbmFnZXI7CiAgICBmaW5hbCBMZWRnZXJTdG9yYWdlIGxlZGdl\nclN0b3JhZ2U7CiAgICBmaW5hbCBKb3VybmFsIGpvdXJuYWw7CgogICAgZmlu\nYWwgSGFuZGxlRmFjdG9yeSBoYW5kbGVzOwoKICAgIHN0YXRpYyBmaW5hbCBs\nb25nIE1FVEFFTlRSWV9JRF9MRURHRVJfS0VZID0gLTB4MTAwMDsKICAgIHN0\nYXRpYyBmaW5hbCBsb25nIE1FVEFFTlRSWV9JRF9GRU5DRV9LRVkgID0gLTB4\nMjAwMDsKCiAgICAvLyBaSyByZWdpc3RyYXRpb24gcGF0aCBmb3IgdGhpcyBi\nb29raWUKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIGJvb2tpZVJlZ2lzdHJh\ndGlvblBhdGg7CgogICAgcHJpdmF0ZSBmaW5hbCBMZWRnZXJEaXJzTWFuYWdl\nciBsZWRnZXJEaXJzTWFuYWdlcjsKICAgIHByaXZhdGUgTGVkZ2VyRGlyc01h\nbmFnZXIgaW5kZXhEaXJzTWFuYWdlcjsKCiAgICAvLyBab29LZWVwZXIgY2xp\nZW50IGluc3RhbmNlIGZvciB0aGUgQm9va2llCiAgICBab29LZWVwZXIgems7\nCgogICAgLy8gUnVubmluZyBmbGFnCiAgICBwcml2YXRlIHZvbGF0aWxlIGJv\nb2xlYW4gcnVubmluZyA9IGZhbHNlOwogICAgLy8gRmxhZyBpZGVudGlmeSB3\naGV0aGVyIGl0IGlzIGluIHNodXR0aW5nIGRvd24gcHJvZ3Jlc3MKICAgIHBy\naXZhdGUgdm9sYXRpbGUgYm9vbGVhbiBzaHV0dGluZ2Rvd24gPSBmYWxzZTsK\nCiAgICBwcml2YXRlIGludCBleGl0Q29kZSA9IEV4aXRDb2RlLk9LOwoKICAg\nIC8vIGpteCByZWxhdGVkIGJlYW5zCiAgICBCb29raWVCZWFuIGpteEJvb2tp\nZUJlYW47CiAgICBCS01CZWFuSW5mbyBqbXhMZWRnZXJTdG9yYWdlQmVhbjsK\nCiAgICBmaW5hbCBDb25jdXJyZW50TWFwPExvbmcsIGJ5dGVbXT4gbWFzdGVy\nS2V5Q2FjaGUgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8TG9uZywgYnl0ZVtd\nPigpOwoKICAgIGZpbmFsIHByaXZhdGUgU3RyaW5nIHprQm9va2llUmVnUGF0\naDsKICAgIGZpbmFsIHByaXZhdGUgU3RyaW5nIHprQm9va2llUmVhZE9ubHlQ\nYXRoOwoKICAgIGZpbmFsIHByaXZhdGUgQXRvbWljQm9vbGVhbiByZWFkT25s\neSA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKCiAgICAvLyBFeHBvc2Ug\nU3RhdHMKICAgIHByaXZhdGUgZmluYWwgQ291bnRlciB3cml0ZUJ5dGVzOwog\nICAgcHJpdmF0ZSBmaW5hbCBDb3VudGVyIHJlYWRCeXRlczsKCiAgICBwdWJs\naWMgc3RhdGljIGNsYXNzIE5vTGVkZ2VyRXhjZXB0aW9uIGV4dGVuZHMgSU9F\neGNlcHRpb24gewogICAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcg\nc2VyaWFsVmVyc2lvblVJRCA9IDFMOwogICAgICAgIHByaXZhdGUgZmluYWwg\nbG9uZyBsZWRnZXJJZDsKICAgICAgICBwdWJsaWMgTm9MZWRnZXJFeGNlcHRp\nb24obG9uZyBsZWRnZXJJZCkgewogICAgICAgICAgICBzdXBlcigiTGVkZ2Vy\nICIgKyBsZWRnZXJJZCArICIgbm90IGZvdW5kIik7CiAgICAgICAgICAgIHRo\naXMubGVkZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICB9CiAgICAgICAgcHVi\nbGljIGxvbmcgZ2V0TGVkZ2VySWQoKSB7CiAgICAgICAgICAgIHJldHVybiBs\nZWRnZXJJZDsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGNs\nYXNzIE5vRW50cnlFeGNlcHRpb24gZXh0ZW5kcyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9u\nVUlEID0gMUw7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBsb25nIGxlZGdlcklk\nOwogICAgICAgIHByaXZhdGUgZmluYWwgbG9uZyBlbnRyeUlkOwogICAgICAg\nIHB1YmxpYyBOb0VudHJ5RXhjZXB0aW9uKGxvbmcgbGVkZ2VySWQsIGxvbmcg\nZW50cnlJZCkgewogICAgICAgICAgICB0aGlzKCJFbnRyeSAiICsgZW50cnlJ\nZCArICIgbm90IGZvdW5kIGluICIgKyBsZWRnZXJJZCwgbGVkZ2VySWQsIGVu\ndHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIE5vRW50cnlFeGNl\ncHRpb24oU3RyaW5nIG1zZywgbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlk\nKSB7CiAgICAgICAgICAgIHN1cGVyKG1zZyk7CiAgICAgICAgICAgIHRoaXMu\nbGVkZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5lbnRyeUlk\nID0gZW50cnlJZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBsb25nIGdl\ndExlZGdlcigpIHsKICAgICAgICAgICAgcmV0dXJuIGxlZGdlcklkOwogICAg\nICAgIH0KICAgICAgICBwdWJsaWMgbG9uZyBnZXRFbnRyeSgpIHsKICAgICAg\nICAgICAgcmV0dXJuIGVudHJ5SWQ7CiAgICAgICAgfQogICAgfQoKICAgIC8v\nIFdyaXRlIENhbGxiYWNrIGRvIG5vdGhpbmcKICAgIHN0YXRpYyBjbGFzcyBO\nb3BXcml0ZUNhbGxiYWNrIGltcGxlbWVudHMgV3JpdGVDYWxsYmFjayB7CiAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgd3JpdGVDb21w\nbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJvb2tpZVNvY2tldEFk\nZHJlc3MgYWRkciwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBpZiAoTE9H\nLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiRmluaXNoZWQgd3JpdGluZyBlbnRyeSB7fSBAIGxlZGdlciB7fSBmb3Ig\ne30gOiB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVj\ndFtdIHsgZW50cnlJZCwgbGVkZ2VySWQsIGFkZHIsIHJjIH0pOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGZpbmFsIHN0YXRpYyBGdXR1\ncmU8Qm9vbGVhbj4gU1VDQ0VTU19GVVRVUkUgPSBuZXcgRnV0dXJlPEJvb2xl\nYW4+KCkgewogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29s\nZWFuIGNhbmNlbChib29sZWFuIG1heUludGVycnVwdElmUnVubmluZykgeyBy\nZXR1cm4gZmFsc2U7IH0KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgQm9vbGVhbiBnZXQoKSB7IHJldHVybiB0cnVlOyB9CiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIEJvb2xlYW4gZ2V0KGxvbmcgdGltZW91\ndCwgVGltZVVuaXQgdW5pdCkgeyByZXR1cm4gdHJ1ZTsgfQogICAgICAgIEBP\ndmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGlzQ2FuY2VsbGVkKCkg\neyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBpc0RvbmUoKSB7CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KICAgIH07CgogICAgc3RhdGljIGNsYXNzIENvdW50\nRG93bkxhdGNoRnV0dXJlPFQ+IGltcGxlbWVudHMgRnV0dXJlPFQ+IHsKCiAg\nICAgICAgVCB2YWx1ZSA9IG51bGw7CiAgICAgICAgdm9sYXRpbGUgYm9vbGVh\nbiBkb25lID0gZmFsc2U7CiAgICAgICAgQ291bnREb3duTGF0Y2ggbGF0Y2gg\nPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBib29sZWFuIGNhbmNlbChib29sZWFuIG1heUludGVy\ncnVwdElmUnVubmluZykgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgVCBnZXQoKSB0aHJvd3MgSW50ZXJydXB0\nZWRFeGNlcHRpb24gewogICAgICAgICAgICBsYXRjaC5hd2FpdCgpOwogICAg\nICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyBUIGdldChsb25nIHRpbWVvdXQsIFRpbWVV\nbml0IHVuaXQpCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiwgVGltZW91dEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmICghbGF0\nY2guYXdhaXQodGltZW91dCwgdW5pdCkpIHsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBUaW1lb3V0RXhjZXB0aW9uKCJUaW1lZCBvdXQgd2FpdGluZyBm\nb3IgbGF0Y2giKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4g\ndmFsdWU7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBpc0NhbmNlbGxlZCgpIHsgcmV0dXJuIGZhbHNlOyB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nRG9uZSgpIHsKICAgICAgICAgICAgcmV0dXJuIGRvbmU7CiAgICAgICAgfQoK\nICAgICAgICB2b2lkIHNldERvbmUoVCB2YWx1ZSkgewogICAgICAgICAgICB0\naGlzLnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgIGRvbmUgPSB0cnVlOwog\nICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICB9CiAgICB9\nCgogICAgc3RhdGljIGNsYXNzIEZ1dHVyZVdyaXRlQ2FsbGJhY2sgaW1wbGVt\nZW50cyBXcml0ZUNhbGxiYWNrIHsKCiAgICAgICAgQ291bnREb3duTGF0Y2hG\ndXR1cmU8Qm9vbGVhbj4gcmVzdWx0ID0KICAgICAgICAgICAgbmV3IENvdW50\nRG93bkxhdGNoRnV0dXJlPEJvb2xlYW4+KCk7CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlQ29tcGxldGUoaW50IHJjLCBs\nb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIGFkZHIsIE9i\namVjdCBjdHgpIHsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxl\nZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkZpbmlzaGVkIHdy\naXRpbmcgZW50cnkge30gQCBsZWRnZXIge30gZm9yIHt9IDoge30iLAogICAg\nICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGVudHJ5SWQs\nIGxlZGdlcklkLCBhZGRyLCByYyB9KTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXN1bHQuc2V0RG9uZSgwID09IHJjKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBGdXR1cmU8Qm9vbGVhbj4gZ2V0UmVzdWx0KCkgewogICAg\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KICAgIH0KCiAgICBw\ndWJsaWMgc3RhdGljIHZvaWQgY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoRmls\nZSBkaXIpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFkaXIu\nZXhpc3RzKCkpIHsKICAgICAgICAgICAgRmlsZSBwYXJlbnQgPSBkaXIuZ2V0\nUGFyZW50RmlsZSgpOwogICAgICAgICAgICBGaWxlIHByZVYzdmVyc2lvbkZp\nbGUgPSBuZXcgRmlsZShkaXIuZ2V0UGFyZW50KCksCiAgICAgICAgICAgICAg\nICAgICAgQm9va0tlZXBlckNvbnN0YW50cy5WRVJTSU9OX0ZJTEVOQU1FKTsK\nCiAgICAgICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gb2xkRGF0YUV4aXN0\ncyA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICAgICAgcGFy\nZW50Lmxpc3QobmV3IEZpbGVuYW1lRmlsdGVyKCkgewogICAgICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGFjY2VwdChGaWxlIGRpciwgU3RyaW5nIG5hbWUpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKG5hbWUuZW5kc1dpdGgoIi50eG4iKSB8\nfCBuYW1lLmVuZHNXaXRoKCIuaWR4IikgfHwgbmFtZS5lbmRzV2l0aCgiLmxv\nZyIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGREYXRhRXhp\nc3RzLnNldCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgaWYg\nKHByZVYzdmVyc2lvbkZpbGUuZXhpc3RzKCkgfHwgb2xkRGF0YUV4aXN0cy5n\nZXQoKSkgewogICAgICAgICAgICAgICAgU3RyaW5nIGVyciA9ICJEaXJlY3Rv\ncnkgbGF5b3V0IHZlcnNpb24gaXMgbGVzcyB0aGFuIDMsIHVwZ3JhZGUgbmVl\nZGVkIjsKICAgICAgICAgICAgICAgIExPRy5lcnJvcihlcnIpOwogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGVycik7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKCFkaXIubWtkaXJzKCkpIHsKICAgICAg\nICAgICAgICAgIFN0cmluZyBlcnIgPSAiVW5hYmxlIHRvIGNyZWF0ZSBkaXJl\nY3RvcnkgIiArIGRpcjsKICAgICAgICAgICAgICAgIExPRy5lcnJvcihlcnIp\nOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGVycik7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDaGVjayB0aGF0IHRoZSBlbnZpcm9ubWVudCBmb3IgdGhlIGJvb2tpZSBp\ncyBjb3JyZWN0LgogICAgICogVGhpcyBtZWFucyB0aGF0IHRoZSBjb25maWd1\ncmF0aW9uIGhhcyBzdGF5ZWQgdGhlIHNhbWUgYXMgdGhlCiAgICAgKiBmaXJz\ndCBydW4gYW5kIHRoZSBmaWxlc3lzdGVtIHN0cnVjdHVyZSBpcyB1cCB0byBk\nYXRlLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgY2hlY2tFbnZpcm9ubWVu\ndChab29LZWVwZXIgemspIHRocm93cyBCb29raWVFeGNlcHRpb24sIElPRXhj\nZXB0aW9uIHsKICAgICAgICBMaXN0PEZpbGU+IGFsbExlZGdlckRpcnMgPSBu\nZXcgQXJyYXlMaXN0PEZpbGU+KGxlZGdlckRpcnNNYW5hZ2VyLmdldEFsbExl\nZGdlckRpcnMoKS5zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIGluZGV4RGlyc01hbmFnZXIu\nZ2V0QWxsTGVkZ2VyRGlycygpLnNpemUoKSk7CiAgICAgICAgYWxsTGVkZ2Vy\nRGlycy5hZGRBbGwobGVkZ2VyRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGly\ncygpKTsKICAgICAgICBpZiAoaW5kZXhEaXJzTWFuYWdlciAhPSBsZWRnZXJE\naXJzTWFuYWdlcikgewogICAgICAgICAgICBhbGxMZWRnZXJEaXJzLmFkZEFs\nbChpbmRleERpcnNNYW5hZ2VyLmdldEFsbExlZGdlckRpcnMoKSk7CiAgICAg\nICAgfQogICAgICAgIGlmICh6ayA9PSBudWxsKSB7IC8vIGV4aXN0cyBvbmx5\nIGZvciB0ZXN0aW5nLCBqdXN0IG1ha2Ugc3VyZSBkaXJlY3RvcmllcyBhcmUg\nY29ycmVjdAogICAgICAgICAgICBjaGVja0RpcmVjdG9yeVN0cnVjdHVyZShq\nb3VybmFsRGlyZWN0b3J5KTsKICAgICAgICAgICAgZm9yIChGaWxlIGRpciA6\nIGFsbExlZGdlckRpcnMpIHsKICAgICAgICAgICAgICAgICAgICBjaGVja0Rp\ncmVjdG9yeVN0cnVjdHVyZShkaXIpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYm9vbGVhbiBuZXdFbnYgPSBmYWxzZTsKICAgICAgICAgICAgTGlzdDxG\naWxlPiBtaXNzZWRDb29raWVEaXJzID0gbmV3IEFycmF5TGlzdDxGaWxlPigp\nOwogICAgICAgICAgICBDb29raWUgam91cm5hbENvb2tpZSA9IG51bGw7CiAg\nICAgICAgICAgIC8vIHRyeSB0byByZWFkIGNvb2tpZSBmcm9tIGpvdXJuYWwg\nZGlyZWN0b3J5LgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nam91cm5hbENvb2tpZSA9IENvb2tpZS5yZWFkRnJvbURpcmVjdG9yeShqb3Vy\nbmFsRGlyZWN0b3J5KTsKICAgICAgICAgICAgICAgIGlmIChqb3VybmFsQ29v\na2llLmlzQm9va2llSG9zdENyZWF0ZWRGcm9tSXAoKSkgewogICAgICAgICAg\nICAgICAgICAgIGNvbmYuc2V0VXNlSG9zdE5hbWVBc0Jvb2tpZUlEKGZhbHNl\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgY29uZi5zZXRVc2VIb3N0TmFtZUFzQm9va2llSUQodHJ1ZSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEZpbGVOb3RGb3Vu\nZEV4Y2VwdGlvbiBmbmYpIHsKICAgICAgICAgICAgICAgIG5ld0VudiA9IHRy\ndWU7CiAgICAgICAgICAgICAgICBtaXNzZWRDb29raWVEaXJzLmFkZChqb3Vy\nbmFsRGlyZWN0b3J5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBTdHJp\nbmcgaW5zdGFuY2VJZCA9IGdldEluc3RhbmNlSWQoemspOwogICAgICAgICAg\nICBDb29raWUuQnVpbGRlciBidWlsZGVyID0gQ29va2llLmdlbmVyYXRlQ29v\na2llKGNvbmYpOwogICAgICAgICAgICBpZiAobnVsbCAhPSBpbnN0YW5jZUlk\nKSB7CiAgICAgICAgICAgICAgICBidWlsZGVyLnNldEluc3RhbmNlSWQoaW5z\ndGFuY2VJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQ29va2llIG1h\nc3RlckNvb2tpZSA9IGJ1aWxkZXIuYnVpbGQoKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIFZlcnNpb25lZDxDb29raWU+IHprQ29va2ll\nID0gQ29va2llLnJlYWRGcm9tWm9vS2VlcGVyKHprLCBjb25mKTsKICAgICAg\nICAgICAgICAgIG1hc3RlckNvb2tpZS52ZXJpZnkoemtDb29raWUuZ2V0VmFs\ndWUoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5O\nb05vZGVFeGNlcHRpb24gbm5lKSB7CiAgICAgICAgICAgICAgICAvLyBjYW4g\nb2NjdXIgaW4gY2FzZXM6CiAgICAgICAgICAgICAgICAvLyAxKSBuZXcgZW52\naXJvbm1lbnQgb3IKICAgICAgICAgICAgICAgIC8vIDIpIGRvbmUgb25seSBt\nZXRhZGF0YSBmb3JtYXQgYW5kIHN0YXJ0ZWQgYm9va2llIHNlcnZlci4KICAg\nICAgICAgICAgfQogICAgICAgICAgICBjaGVja0RpcmVjdG9yeVN0cnVjdHVy\nZShqb3VybmFsRGlyZWN0b3J5KTsKCiAgICAgICAgICAgIGlmKCFuZXdFbnYp\newogICAgICAgICAgICAgICAgam91cm5hbENvb2tpZS52ZXJpZnkobWFzdGVy\nQ29va2llKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKEZpbGUg\nZGlyIDogYWxsTGVkZ2VyRGlycykgewogICAgICAgICAgICAgICAgY2hlY2tE\naXJlY3RvcnlTdHJ1Y3R1cmUoZGlyKTsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgQ29va2llIGMgPSBDb29raWUucmVhZEZy\nb21EaXJlY3RvcnkoZGlyKTsKICAgICAgICAgICAgICAgICAgICBjLnZlcmlm\neShtYXN0ZXJDb29raWUpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRmls\nZU5vdEZvdW5kRXhjZXB0aW9uIGZuZikgewogICAgICAgICAgICAgICAgICAg\nIG1pc3NlZENvb2tpZURpcnMuYWRkKGRpcik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghbmV3RW52ICYmIG1p\nc3NlZENvb2tpZURpcnMuc2l6ZSgpID4gMCl7CiAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkNvb2tpZSBleGlzdHMgaW4gem9va2VlcGVyLCBidXQgbm90\nIGluIGFsbCBsb2NhbCBkaXJlY3Rvcmllcy4gIgogICAgICAgICAgICAgICAg\nICAgICAgICArICIgRGlyZWN0b3JpZXMgbWlzc2luZyBjb29raWUgZmlsZSBh\ncmUgIiArIG1pc3NlZENvb2tpZURpcnMpOwogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5ld0Vudikgewog\nICAgICAgICAgICAgICAgaWYgKG1pc3NlZENvb2tpZURpcnMuc2l6ZSgpID4g\nMCkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRGlyZWN0b3Jp\nZXMgbWlzc2luZyBjb29raWUgZmlsZSBhcmUge30iLCBtaXNzZWRDb29raWVE\naXJzKTsKICAgICAgICAgICAgICAgICAgICBtYXN0ZXJDb29raWUud3JpdGVU\nb0RpcmVjdG9yeShqb3VybmFsRGlyZWN0b3J5KTsKICAgICAgICAgICAgICAg\nICAgICBmb3IgKEZpbGUgZGlyIDogYWxsTGVkZ2VyRGlycykgewogICAgICAg\nICAgICAgICAgICAgICAgICBtYXN0ZXJDb29raWUud3JpdGVUb0RpcmVjdG9y\neShkaXIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIG1hc3RlckNvb2tpZS53cml0ZVRvWm9vS2Vl\ncGVyKHprLCBjb25mLCBWZXJzaW9uLk5FVyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgTE9HLmVycm9yKCJDb3VsZG4ndCBhY2Nlc3MgY29va2llIGluIHpvb2tl\nZXBlciIsIGtlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2Vw\ndGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uKGtlKTsKICAgICAgICB9IGNh\ndGNoIChVbmtub3duSG9zdEV4Y2VwdGlvbiB1aGUpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJDb3VsZG4ndCBjaGVjayBjb29raWVzLCBuZXR3b3JraW5n\nIGlzIGJyb2tlbiIsIHVoZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBCb29r\naWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlvbih1aGUpOwogICAg\nICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIkVycm9yIGFjY2Vzc2luZyBjb29raWUgb24gZGlza3MiLCBp\nb2UpOwogICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9uLklu\ndmFsaWRDb29raWVFeGNlcHRpb24oaW9lKTsKICAgICAgICB9IGNhdGNoIChJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICBMT0cuZXJy\nb3IoIlRocmVhZCBpbnRlcnJ1cHRlZCB3aGlsZSBjaGVja2luZyBjb29raWVz\nLCBleGl0aW5nIiwgaWUpOwogICAgICAgICAgICB0aHJvdyBuZXcgQm9va2ll\nRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNlcHRpb24oaWUpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJldHVybiB0aGUgY29uZmlndXJl\nZCBhZGRyZXNzIG9mIHRoZSBib29raWUuCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgQm9va2llU29ja2V0QWRkcmVzcyBnZXRCb29raWVBZGRyZXNzKFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZikKICAgICAgICAgICAgdGhyb3dzIFVu\na25vd25Ib3N0RXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgaWZhY2UgPSBj\nb25mLmdldExpc3RlbmluZ0ludGVyZmFjZSgpOwogICAgICAgIGlmIChpZmFj\nZSA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmYWNlID0gImRlZmF1bHQiOwog\nICAgICAgIH0KICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBpbmV0QWRkciA9\nIG5ldyBJbmV0U29ja2V0QWRkcmVzcyhETlMuZ2V0RGVmYXVsdEhvc3QoaWZh\nY2UpLCBjb25mLmdldEJvb2tpZVBvcnQoKSk7CiAgICAgICAgU3RyaW5nIGhv\nc3RBZGRyZXNzID0gaW5ldEFkZHIuZ2V0QWRkcmVzcygpLmdldEhvc3RBZGRy\nZXNzKCk7CiAgICAgICAgaWYgKGNvbmYuZ2V0VXNlSG9zdE5hbWVBc0Jvb2tp\nZUlEKCkpIHsKICAgICAgICAgICAgaG9zdEFkZHJlc3MgPSBpbmV0QWRkci5n\nZXRBZGRyZXNzKCkuZ2V0Q2Fub25pY2FsSG9zdE5hbWUoKTsKICAgICAgICB9\nCiAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBhZGRyID0KICAgICAgICAg\nICAgICAgIG5ldyBCb29raWVTb2NrZXRBZGRyZXNzKGhvc3RBZGRyZXNzLCBj\nb25mLmdldEJvb2tpZVBvcnQoKSk7CiAgICAgICAgaWYgKGFkZHIuZ2V0U29j\na2V0QWRkcmVzcygpLmdldEFkZHJlc3MoKS5pc0xvb3BiYWNrQWRkcmVzcygp\nCiAgICAgICAgICAgICYmICFjb25mLmdldEFsbG93TG9vcGJhY2soKSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgVW5rbm93bkhvc3RFeGNlcHRpb24oIlRy\neWluZyB0byBsaXN0ZW4gb24gbG9vcGJhY2sgYWRkcmVzcywgIgogICAgICAg\nICAgICAgICAgICAgICsgYWRkciArICIgYnV0IHRoaXMgaXMgZm9yYmlkZGVu\nIGJ5IGRlZmF1bHQgIgogICAgICAgICAgICAgICAgICAgICsgIihzZWUgU2Vy\ndmVyQ29uZmlndXJhdGlvbiNnZXRBbGxvd0xvb3BiYWNrKCkpIik7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBhZGRyOwogICAgfQoKICAgIHByaXZhdGUg\nU3RyaW5nIGdldEluc3RhbmNlSWQoWm9vS2VlcGVyIHprKSB0aHJvd3MgS2Vl\ncGVyRXhjZXB0aW9uLAogICAgICAgICAgICBJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiB7CiAgICAgICAgU3RyaW5nIGluc3RhbmNlSWQgPSBudWxsOwogICAgICAg\nIGlmICh6ay5leGlzdHMoY29uZi5nZXRaa0xlZGdlcnNSb290UGF0aCgpLCBu\ndWxsKSA9PSBudWxsKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiQm9va0tl\nZXBlciBtZXRhZGF0YSBkb2Vzbid0IGV4aXN0IGluIHpvb2tlZXBlci4gIgog\nICAgICAgICAgICAgICAgICAgICAgKyAiSGFzIHRoZSBjbHVzdGVyIGJlZW4g\naW5pdGlhbGl6ZWQ/ICIKICAgICAgICAgICAgICAgICAgICAgICsgIlRyeSBy\ndW5uaW5nIGJpbi9ib29ra2VlcGVyIHNoZWxsIG1ldGFmb3JtYXQiKTsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNl\ncHRpb24oIkJvb2tLZWVwZXIgbWV0YWRhdGEiKTsKICAgICAgICB9CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYnl0ZVtdIGRhdGEgPSB6ay5nZXREYXRh\nKGNvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICIvIgogICAgICAgICAg\nICAgICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5JTlNUQU5DRUlELCBm\nYWxzZSwgbnVsbCk7CiAgICAgICAgICAgIGluc3RhbmNlSWQgPSBuZXcgU3Ry\naW5nKGRhdGEsIFVURl84KTsKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNl\ncHRpb24uTm9Ob2RlRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmlu\nZm8oIklOU1RBTkNFSUQgbm90IGV4aXN0cyBpbiB6b29rZWVwZXIuIE5vdCBj\nb25zaWRlcmluZyBpdCBmb3IgZGF0YSB2ZXJpZmljYXRpb24iKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGluc3RhbmNlSWQ7CiAgICB9CgogICAgcHVi\nbGljIExlZGdlckRpcnNNYW5hZ2VyIGdldExlZGdlckRpcnNNYW5hZ2VyKCkg\newogICAgICAgIHJldHVybiBsZWRnZXJEaXJzTWFuYWdlcjsKICAgIH0KCiAg\nICBMZWRnZXJEaXJzTWFuYWdlciBnZXRJbmRleERpcnNNYW5hZ2VyKCkgewog\nICAgICAgIHJldHVybiBpbmRleERpcnNNYW5hZ2VyOwogICAgfQoKICAgIHB1\nYmxpYyBzdGF0aWMgRmlsZSBnZXRDdXJyZW50RGlyZWN0b3J5KEZpbGUgZGly\nKSB7CiAgICAgICAgcmV0dXJuIG5ldyBGaWxlKGRpciwgQm9va0tlZXBlckNv\nbnN0YW50cy5DVVJSRU5UX0RJUik7CiAgICB9CgogICAgcHVibGljIHN0YXRp\nYyBGaWxlW10gZ2V0Q3VycmVudERpcmVjdG9yaWVzKEZpbGVbXSBkaXJzKSB7\nCiAgICAgICAgRmlsZVtdIGN1cnJlbnREaXJzID0gbmV3IEZpbGVbZGlycy5s\nZW5ndGhdOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGlycy5sZW5n\ndGg7IGkrKykgewogICAgICAgICAgICBjdXJyZW50RGlyc1tpXSA9IGdldEN1\ncnJlbnREaXJlY3RvcnkoZGlyc1tpXSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBjdXJyZW50RGlyczsKICAgIH0KCiAgICBwdWJsaWMgQm9va2llKFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZikKICAgICAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0\naW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHRoaXMoY29uZiwgTnVs\nbFN0YXRzTG9nZ2VyLklOU1RBTkNFKTsKICAgIH0KCiAgICBwdWJsaWMgQm9v\na2llKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiwgU3RhdHNMb2dnZXIgc3Rh\ndHNMb2dnZXIpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgS2Vl\ncGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQm9va2llRXhj\nZXB0aW9uIHsKICAgICAgICBzdXBlcigiQm9va2llLSIgKyBjb25mLmdldEJv\nb2tpZVBvcnQoKSk7CiAgICAgICAgdGhpcy5ib29raWVSZWdpc3RyYXRpb25Q\nYXRoID0gY29uZi5nZXRaa0F2YWlsYWJsZUJvb2tpZXNQYXRoKCkgKyAiLyI7\nCiAgICAgICAgdGhpcy5jb25mID0gY29uZjsKICAgICAgICB0aGlzLmpvdXJu\nYWxEaXJlY3RvcnkgPSBnZXRDdXJyZW50RGlyZWN0b3J5KGNvbmYuZ2V0Sm91\ncm5hbERpcigpKTsKICAgICAgICB0aGlzLmxlZGdlckRpcnNNYW5hZ2VyID0g\nbmV3IExlZGdlckRpcnNNYW5hZ2VyKGNvbmYsIGNvbmYuZ2V0TGVkZ2VyRGly\ncygpLAogICAgICAgICAgICAgICAgc3RhdHNMb2dnZXIuc2NvcGUoTERfTEVE\nR0VSX1NDT1BFKSk7CiAgICAgICAgRmlsZVtdIGlkeERpcnMgPSBjb25mLmdl\ndEluZGV4RGlycygpOwogICAgICAgIGlmIChudWxsID09IGlkeERpcnMpIHsK\nICAgICAgICAgICAgdGhpcy5pbmRleERpcnNNYW5hZ2VyID0gdGhpcy5sZWRn\nZXJEaXJzTWFuYWdlcjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0\naGlzLmluZGV4RGlyc01hbmFnZXIgPSBuZXcgTGVkZ2VyRGlyc01hbmFnZXIo\nY29uZiwgaWR4RGlycywKICAgICAgICAgICAgICAgICAgICBzdGF0c0xvZ2dl\nci5zY29wZShMRF9JTkRFWF9TQ09QRSkpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gaW5zdGFudGlhdGUgem9va2VlcGVyIGNsaWVudCB0byBpbml0aWFsaXpl\nIGxlZGdlciBtYW5hZ2VyCiAgICAgICAgdGhpcy56ayA9IGluc3RhbnRpYXRl\nWm9va2VlcGVyQ2xpZW50KGNvbmYpOwogICAgICAgIGNoZWNrRW52aXJvbm1l\nbnQodGhpcy56ayk7CiAgICAgICAgbGVkZ2VyTWFuYWdlckZhY3RvcnkgPSBM\nZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeShj\nb25mLCB0aGlzLnprKTsKICAgICAgICBMT0cuaW5mbygiaW5zdGFudGlhdGUg\nbGVkZ2VyIG1hbmFnZXIge30iLCBsZWRnZXJNYW5hZ2VyRmFjdG9yeS5nZXRD\nbGFzcygpLmdldE5hbWUoKSk7CiAgICAgICAgbGVkZ2VyTWFuYWdlciA9IGxl\nZGdlck1hbmFnZXJGYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXIoKTsKCiAgICAg\nICAgLy8gSW5pdGlhbGlzZSBsZWRnZXJEaXJNYW5hZ2VyLiBUaGlzIHdvdWxk\nIGxvb2sgdGhyb3VnaCBhbGwgdGhlCiAgICAgICAgLy8gY29uZmlndXJlZCBk\naXJlY3Rvcmllcy4gV2hlbiBkaXNrIGVycm9ycyBvciBhbGwgdGhlIGxlZGdl\ncgogICAgICAgIC8vIGRpcmVjdG9yaWVzIGFyZSBmdWxsLCB3b3VsZCB0aHJv\nd3MgZXhjZXB0aW9uIGFuZCBmYWlsIGJvb2tpZSBzdGFydHVwLgogICAgICAg\nIHRoaXMubGVkZ2VyRGlyc01hbmFnZXIuaW5pdCgpOwogICAgICAgIC8vIGlu\nc3RhbnRpYXRlIHRoZSBqb3VybmFsCiAgICAgICAgam91cm5hbCA9IG5ldyBK\nb3VybmFsKGNvbmYsIGxlZGdlckRpcnNNYW5hZ2VyKTsKICAgICAgICAvLyBD\naGVjayB0aGUgdHlwZSBvZiBzdG9yYWdlLgogICAgICAgIGlmIChjb25mLmdl\ndFNvcnRlZExlZGdlclN0b3JhZ2VFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nbGVkZ2VyU3RvcmFnZSA9IG5ldyBTb3J0ZWRMZWRnZXJTdG9yYWdlKGNvbmYs\nIGxlZGdlck1hbmFnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJEaXJzTWFuYWdlciwgaW5k\nZXhEaXJzTWFuYWdlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWwsIHN0YXRzTG9nZ2VyKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBsZWRnZXJTdG9yYWdlID0g\nbmV3IEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZShjb25mLCBsZWRnZXJNYW5h\nZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJEaXJzTWFuYWdlciwgaW5kZXhEaXJz\nTWFuYWdlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgam91cm5hbCwgc3RhdHNMb2dnZXIpOwog\nICAgICAgIH0KICAgICAgICBzeW5jVGhyZWFkID0gbmV3IFN5bmNUaHJlYWQo\nY29uZiwgZ2V0TGVkZ2VyRGlyc0xpc3RlbmVyKCksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGxlZGdlclN0b3JhZ2UsIGpvdXJuYWwp\nOwoKICAgICAgICBoYW5kbGVzID0gbmV3IEhhbmRsZUZhY3RvcnlJbXBsKGxl\nZGdlclN0b3JhZ2UpOwoKICAgICAgICAvLyBaSyBlcGhlbWVyYWwgbm9kZSBm\nb3IgdGhpcyBCb29raWUuCiAgICAgICAgU3RyaW5nIG15SUQgPSBnZXRNeUlk\nKCk7CiAgICAgICAgemtCb29raWVSZWdQYXRoID0gdGhpcy5ib29raWVSZWdp\nc3RyYXRpb25QYXRoICsgbXlJRDsKICAgICAgICB6a0Jvb2tpZVJlYWRPbmx5\nUGF0aCA9IHRoaXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aCArIEJvb2tLZWVw\nZXJDb25zdGFudHMuUkVBRE9OTFkgKyAiLyIgKyBteUlEOwoKICAgICAgICAv\nLyBFeHBvc2UgU3RhdHMKICAgICAgICB3cml0ZUJ5dGVzID0gc3RhdHNMb2dn\nZXIuZ2V0Q291bnRlcihXUklURV9CWVRFUyk7CiAgICAgICAgcmVhZEJ5dGVz\nID0gc3RhdHNMb2dnZXIuZ2V0Q291bnRlcihSRUFEX0JZVEVTKTsKICAgICAg\nICAvLyAxIDogdXAsIDAgOiByZWFkb25seQogICAgICAgIHN0YXRzTG9nZ2Vy\nLnJlZ2lzdGVyR2F1Z2UoU0VSVkVSX1NUQVRVUywgbmV3IEdhdWdlPE51bWJl\ncj4oKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJs\naWMgTnVtYmVyIGdldERlZmF1bHRWYWx1ZSgpIHsKICAgICAgICAgICAgICAg\nIHJldHVybiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgcHVibGljIE51bWJlciBnZXRTYW1wbGUoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gcmVhZE9ubHkuZ2V0KCkgPyAwIDogMTsK\nICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIHByaXZhdGUg\nU3RyaW5nIGdldE15SWQoKSB0aHJvd3MgVW5rbm93bkhvc3RFeGNlcHRpb24g\newogICAgICAgIHJldHVybiBCb29raWUuZ2V0Qm9va2llQWRkcmVzcyhjb25m\nKS50b1N0cmluZygpOwogICAgfQoKICAgIHZvaWQgcmVhZEpvdXJuYWwoKSB0\naHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAg\nam91cm5hbC5yZXBsYXkobmV3IEpvdXJuYWxTY2FubmVyKCkgewogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vz\ncyhpbnQgam91cm5hbFZlcnNpb24sIGxvbmcgb2Zmc2V0LCBCeXRlQnVmZmVy\nIHJlY0J1ZmYpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICBsb25nIGxlZGdlcklkID0gcmVjQnVmZi5nZXRMb25nKCk7CiAgICAgICAg\nICAgICAgICBsb25nIGVudHJ5SWQgPSByZWNCdWZmLmdldExvbmcoKTsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJSZXBsYXkgam91cm5hbCAtIGxlZGdlciBpZCA6IHt9LCBlbnRyeSBp\nZCA6IHt9LiIsIGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoZW50cnlJZCA9PSBNRVRBRU5UUllfSURfTEVER0VSX0tFWSkg\newogICAgICAgICAgICAgICAgICAgICAgICBpZiAoam91cm5hbFZlcnNpb24g\nPj0gSm91cm5hbENoYW5uZWwuVjMpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGludCBtYXN0ZXJLZXlMZW4gPSByZWNCdWZmLmdldEludCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIG1hc3RlcktleSA9\nIG5ldyBieXRlW21hc3RlcktleUxlbl07CgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgcmVjQnVmZi5nZXQobWFzdGVyS2V5KTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG1hc3RlcktleUNhY2hlLnB1dChsZWRnZXJJZCwg\nbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbigiSW52YWxpZCBqb3VybmFsLiBDb250YWlucyBqb3VybmFsS2V5ICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGJ1dCBs\nYXlvdXQgdmVyc2lvbiAoIiArIGpvdXJuYWxWZXJzaW9uCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgIikgaXMgdG9vIG9sZCB0byBo\nb2xkIHRoaXMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoZW50cnlJZCA9PSBNRVRBRU5UUllf\nSURfRkVOQ0VfS0VZKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChq\nb3VybmFsVmVyc2lvbiA+PSBKb3VybmFsQ2hhbm5lbC5WNCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIGtleSA9IG1hc3RlcktleUNh\nY2hlLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoa2V5ID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBrZXkgPSBsZWRnZXJTdG9yYWdlLnJlYWRNYXN0ZXJLZXkobGVk\nZ2VySWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUg\nPSBoYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJZCwga2V5KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGhhbmRsZS5zZXRGZW5jZWQoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiSW52YWxpZCBqb3Vy\nbmFsLiBDb250YWlucyBmZW5jZUtleSAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiBidXQgbGF5b3V0IHZlcnNpb24gKCIgKyBq\nb3VybmFsVmVyc2lvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArICIpIGlzIHRvbyBvbGQgdG8gaG9sZCB0aGlzIik7CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICBieXRlW10ga2V5ID0gbWFzdGVy\nS2V5Q2FjaGUuZ2V0KGxlZGdlcklkKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGtleSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBrZXkgPSBsZWRnZXJTdG9yYWdlLnJlYWRNYXN0ZXJLZXkobGVkZ2Vy\nSWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gaGFuZGxlcy5n\nZXRIYW5kbGUobGVkZ2VySWQsIGtleSk7CgogICAgICAgICAgICAgICAgICAg\nICAgICByZWNCdWZmLnJld2luZCgpOwogICAgICAgICAgICAgICAgICAgICAg\nICBoYW5kbGUuYWRkRW50cnkocmVjQnVmZik7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoTm9MZWRnZXJFeGNlcHRp\nb24gbnNsZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiU2tp\ncCByZXBsYXlpbmcgZW50cmllcyBvZiBsZWRnZXIge30gc2luY2UgaXQgd2Fz\nIGRlbGV0ZWQuIiwgbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoQm9va2llRXhjZXB0aW9uIGJlKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IElPRXhjZXB0aW9uKGJlKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHN0YXJ0KCkgewogICAg\nICAgIHNldERhZW1vbih0cnVlKTsKICAgICAgICBMT0cuZGVidWcoIkknbSBz\ndGFydGluZyBhIGJvb2tpZSB3aXRoIGpvdXJuYWwgZGlyZWN0b3J5IHt9Iiwg\nam91cm5hbERpcmVjdG9yeS5nZXROYW1lKCkpOwogICAgICAgIC8vU3RhcnQg\nRGlza0NoZWNrZXIgdGhyZWFkCiAgICAgICAgbGVkZ2VyRGlyc01hbmFnZXIu\nc3RhcnQoKTsKICAgICAgICBpZiAoaW5kZXhEaXJzTWFuYWdlciAhPSBsZWRn\nZXJEaXJzTWFuYWdlcikgewogICAgICAgICAgICBpbmRleERpcnNNYW5hZ2Vy\nLnN0YXJ0KCk7CiAgICAgICAgfQogICAgICAgIC8vIHJlcGxheSBqb3VybmFs\ncwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlYWRKb3VybmFsKCk7CiAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHJlcGxheWluZyBqb3VybmFs\ncywgc2h1dHRpbmcgZG93biIsIGlvZSk7CiAgICAgICAgICAgIHNodXRkb3du\nKEV4aXRDb2RlLkJPT0tJRV9FWENFUFRJT04pOwogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfSBjYXRjaCAoQm9va2llRXhjZXB0aW9uIGJlKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHJlcGxheWlu\nZyBqb3VybmFscywgc2h1dHRpbmcgZG93biIsIGJlKTsKICAgICAgICAgICAg\nc2h1dGRvd24oRXhpdENvZGUuQk9PS0lFX0VYQ0VQVElPTik7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oIkZpbmlz\naGVkIHJlYWRpbmcgam91cm5hbCwgc3RhcnRpbmcgYm9va2llIik7CiAgICAg\nICAgLy8gc3RhcnQgYm9va2llIHRocmVhZAogICAgICAgIHN1cGVyLnN0YXJ0\nKCk7CgogICAgICAgIC8vIEFmdGVyIHN1Y2Nlc3NmdWwgYm9va2llIHN0YXJ0\ndXAsIHJlZ2lzdGVyIGxpc3RlbmVyIGZvciBkaXNrCiAgICAgICAgLy8gZXJy\nb3IvZnVsbCBub3RpZmljYXRpb25zLgogICAgICAgIGxlZGdlckRpcnNNYW5h\nZ2VyLmFkZExlZGdlckRpcnNMaXN0ZW5lcihnZXRMZWRnZXJEaXJzTGlzdGVu\nZXIoKSk7CiAgICAgICAgaWYgKGluZGV4RGlyc01hbmFnZXIgIT0gbGVkZ2Vy\nRGlyc01hbmFnZXIpIHsKICAgICAgICAgICAgaW5kZXhEaXJzTWFuYWdlci5h\nZGRMZWRnZXJEaXJzTGlzdGVuZXIoZ2V0TGVkZ2VyRGlyc0xpc3RlbmVyKCkp\nOwogICAgICAgIH0KCiAgICAgICAgbGVkZ2VyU3RvcmFnZS5zdGFydCgpOwoK\nICAgICAgICBzeW5jVGhyZWFkLnN0YXJ0KCk7CiAgICAgICAgLy8gc2V0IHJ1\nbm5pbmcgaGVyZS4KICAgICAgICAvLyBzaW5jZSBib29raWUgc2VydmVyIHVz\nZSBydW5uaW5nIGFzIGEgZmxhZyB0byB0ZWxsIGJvb2tpZSBzZXJ2ZXIgd2hl\ndGhlciBpdCBpcyBhbGl2ZQogICAgICAgIC8vIGlmIHNldHRpbmcgaXQgaW4g\nYm9va2llIHRocmVhZCwgdGhlIHdhdGNoZXIgbWlnaHQgcnVuIGJlZm9yZSBi\nb29raWUgdGhyZWFkLgogICAgICAgIHJ1bm5pbmcgPSB0cnVlOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIHJlZ2lzdGVyQm9va2llKGNvbmYpOwogICAg\nICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJDb3VsZG4ndCByZWdpc3RlciBib29raWUgd2l0aCB6b29rZWVw\nZXIsIHNodXR0aW5nIGRvd24iLCBlKTsKICAgICAgICAgICAgc2h1dGRvd24o\nRXhpdENvZGUuWktfUkVHX0ZBSUwpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKgogICAgICogR2V0IHRoZSBEaXNrRmFpbHVyZSBsaXN0ZW5lciBmb3IgdGhl\nIGJvb2tpZQogICAgICovCiAgICBwcml2YXRlIExlZGdlckRpcnNMaXN0ZW5l\nciBnZXRMZWRnZXJEaXJzTGlzdGVuZXIoKSB7CgogICAgICAgIHJldHVybiBu\nZXcgTGVkZ2VyRGlyc0xpc3RlbmVyKCkgewoKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGRpc2tGdWxsKEZpbGUgZGlz\naykgewogICAgICAgICAgICAgICAgLy8gTm90aGluZyBuZWVkcyB0byBiZSBo\nYW5kbGVkIGhlcmUuCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBkaXNrQWxtb3N0RnVsbChG\naWxlIGRpc2spIHsKICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgbmVlZHMg\ndG8gYmUgaGFuZGxlZCBoZXJlLgogICAgICAgICAgICB9CgogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgZGlza0ZhaWxl\nZChGaWxlIGRpc2spIHsKICAgICAgICAgICAgICAgIC8vIFNodXRkb3duIHRo\nZSBib29raWUgb24gZGlzayBmYWlsdXJlLgogICAgICAgICAgICAgICAgdHJp\nZ2dlckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9FWENFUFRJT04p\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgYWxsRGlza3NGdWxsKCkgewogICAgICAgICAg\nICAgICAgLy8gVHJhbnNpdGlvbiB0byByZWFkT25seSBtb2RlIG9uIGFsbCBk\naXNrcyBmdWxsCiAgICAgICAgICAgICAgICB0cmFuc2l0aW9uVG9SZWFkT25s\neU1vZGUoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGZhdGFsRXJyb3IoKSB7CiAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIkZhdGFsIGVycm9yIHJlcG9ydGVkIGJ5\nIGxlZGdlckRpcnNNYW5hZ2VyIik7CiAgICAgICAgICAgICAgICB0cmlnZ2Vy\nQm9va2llU2h1dGRvd24oRXhpdENvZGUuQk9PS0lFX0VYQ0VQVElPTik7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBkaXNrV3JpdGFibGUoRmlsZSBkaXNrKSB7CiAgICAg\nICAgICAgICAgICAvLyBUcmFuc2l0aW9uIHRvIHdyaXRhYmxlIG1vZGUgd2hl\nbiBhIGRpc2sgYmVjb21lcyB3cml0YWJsZSBhZ2Fpbi4KICAgICAgICAgICAg\nICAgIHRyYW5zaXRpb25Ub1dyaXRhYmxlTW9kZSgpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZv\naWQgZGlza0p1c3RXcml0YWJsZShGaWxlIGRpc2spIHsKICAgICAgICAgICAg\nICAgIC8vIFRyYW5zaXRpb24gdG8gd3JpdGFibGUgbW9kZSB3aGVuIGEgZGlz\nayBiZWNvbWVzIHdyaXRhYmxlIGFnYWluLgogICAgICAgICAgICAgICAgdHJh\nbnNpdGlvblRvV3JpdGFibGVNb2RlKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9OwogICAgfQoKICAgIC8qKgogICAgICogUmVnaXN0ZXIgam14IHdpdGgg\ncGFyZW50CiAgICAgKgogICAgICogQHBhcmFtIHBhcmVudCBwYXJlbnQgYmsg\nbWJlYW4gaW5mbwogICAgICovCiAgICBwdWJsaWMgdm9pZCByZWdpc3RlckpN\nWChCS01CZWFuSW5mbyBwYXJlbnQpIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBqbXhCb29raWVCZWFuID0gbmV3IEJvb2tpZUJlYW4odGhpcyk7CiAg\nICAgICAgICAgIEJLTUJlYW5SZWdpc3RyeS5nZXRJbnN0YW5jZSgpLnJlZ2lz\ndGVyKGpteEJvb2tpZUJlYW4sIHBhcmVudCk7CgogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgam14TGVkZ2VyU3RvcmFnZUJlYW4gPSB0aGlz\nLmxlZGdlclN0b3JhZ2UuZ2V0Sk1YQmVhbigpOwogICAgICAgICAgICAgICAg\nQktNQmVhblJlZ2lzdHJ5LmdldEluc3RhbmNlKCkucmVnaXN0ZXIoam14TGVk\nZ2VyU3RvcmFnZUJlYW4sIGpteEJvb2tpZUJlYW4pOwogICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLndh\ncm4oIkZhaWxlZCB0byByZWdpc3RlciB3aXRoIEpNWCBmb3IgbGVkZ2VyIGNh\nY2hlIiwgZSk7CiAgICAgICAgICAgICAgICBqbXhMZWRnZXJTdG9yYWdlQmVh\nbiA9IG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBMT0cud2FybigiRmFpbGVkIHRvIHJl\nZ2lzdGVyIHdpdGggSk1YIiwgZSk7CiAgICAgICAgICAgIGpteEJvb2tpZUJl\nYW4gPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFVu\ncmVnaXN0ZXIgam14CiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHVucmVnaXN0\nZXJKTVgoKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKGpteExl\nZGdlclN0b3JhZ2VCZWFuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEJL\nTUJlYW5SZWdpc3RyeS5nZXRJbnN0YW5jZSgpLnVucmVnaXN0ZXIoam14TGVk\nZ2VyU3RvcmFnZUJlYW4pOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLndhcm4oIkZhaWxl\nZCB0byB1bnJlZ2lzdGVyIHdpdGggSk1YIiwgZSk7CiAgICAgICAgfQogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChqbXhCb29raWVCZWFuICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIEJLTUJlYW5SZWdpc3RyeS5nZXRJbnN0\nYW5jZSgpLnVucmVnaXN0ZXIoam14Qm9va2llQmVhbik7CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBMT0cud2FybigiRmFpbGVkIHRvIHVucmVnaXN0ZXIgd2l0aCBKTVgiLCBl\nKTsKICAgICAgICB9CiAgICAgICAgam14Qm9va2llQmVhbiA9IG51bGw7CiAg\nICAgICAgam14TGVkZ2VyU3RvcmFnZUJlYW4gPSBudWxsOwogICAgfQoKCiAg\nICAvKioKICAgICAqIEluc3RhbnRpYXRlIHRoZSBab29LZWVwZXIgY2xpZW50\nIGZvciB0aGUgQm9va2llLgogICAgICovCiAgICBwcml2YXRlIFpvb0tlZXBl\nciBpbnN0YW50aWF0ZVpvb2tlZXBlckNsaWVudChTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50\nZXJydXB0ZWRFeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGNvbmYuZ2V0WmtTZXJ2ZXJzKCkgPT0gbnVsbCkgewogICAgICAgICAg\nICBMT0cud2FybigiTm8gWksgc2VydmVycyBwYXNzZWQgdG8gQm9va2llIGNv\nbnN0cnVjdG9yIHNvIEJvb2tLZWVwZXIgY2xpZW50cyB3b24ndCBrbm93IGFi\nb3V0IHRoaXMgc2VydmVyISIpOwogICAgICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBab29LZWVwZXIgY2xp\nZW50IGluc3RhbmNlCiAgICAgICAgcmV0dXJuIG5ld1pvb2tlZXBlcihjb25m\nLmdldFprU2VydmVycygpLCBjb25mLmdldFprVGltZW91dCgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENoZWNrIGV4aXN0ZW5jZSBvZiA8aT5yZWdQYXRo\nPC9pPiBhbmQgd2FpdCBpdCBleHBpcmVkIGlmIHBvc3NpYmxlCiAgICAgKgog\nICAgICogQHBhcmFtIHJlZ1BhdGgKICAgICAqICAgICAgICAgIHJlZyBub2Rl\nIHBhdGguCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgcmVnUGF0aCBleGlzdHMs\nIG90aGVyd2lzZSByZXR1cm4gZmFsc2UKICAgICAqIEB0aHJvd3MgSU9FeGNl\ncHRpb24gaWYgY2FuJ3QgY3JlYXRlIHJlZyBwYXRoCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBib29sZWFuIGNoZWNrUmVnTm9kZUFuZFdhaXRFeHBpcmVkKFN0\ncmluZyByZWdQYXRoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGZp\nbmFsIENvdW50RG93bkxhdGNoIHByZXZOb2RlTGF0Y2ggPSBuZXcgQ291bnRE\nb3duTGF0Y2goMSk7CiAgICAgICAgV2F0Y2hlciB6a1ByZXZSZWdOb2Rld2F0\nY2hlciA9IG5ldyBXYXRjaGVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQg\nZXZlbnQpIHsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGZvciBwcmV2IHpu\nb2RlIGRlbGV0aW9uLiBDb25uZWN0aW9uIGV4cGlyYXRpb24gaXMKICAgICAg\nICAgICAgICAgIC8vIG5vdCBoYW5kbGluZywgc2luY2UgYm9va2llIGhhcyBs\nb2dpYyB0byBzaHV0ZG93bi4KICAgICAgICAgICAgICAgIGlmIChFdmVudFR5\ncGUuTm9kZURlbGV0ZWQgPT0gZXZlbnQuZ2V0VHlwZSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgcHJldk5vZGVMYXRjaC5jb3VudERvd24oKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgU3RhdCBzdGF0ID0gemsuZXhpc3RzKHJlZ1Bh\ndGgsIHprUHJldlJlZ05vZGV3YXRjaGVyKTsKICAgICAgICAgICAgaWYgKG51\nbGwgIT0gc3RhdCkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlIGVwaGVt\nZXJhbCBvd25lciBpc24ndCBjdXJyZW50IHpvb2tlZXBlciBjbGllbnQKICAg\nICAgICAgICAgICAgIC8vIHdhaXQgZm9yIGl0IHRvIGJlIGV4cGlyZWQuCiAg\nICAgICAgICAgICAgICBpZiAoc3RhdC5nZXRFcGhlbWVyYWxPd25lcigpICE9\nIHprLmdldFNlc3Npb25JZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9H\nLmluZm8oIlByZXZpb3VzIGJvb2tpZSByZWdpc3RyYXRpb24gem5vZGU6IHt9\nIGV4aXN0cywgc28gd2FpdGluZyB6ayBzZXNzaW9udGltZW91dDoiCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArICIge30gbXMgZm9yIHpub2RlIGRl\nbGV0aW9uIiwgcmVnUGF0aCwgY29uZi5nZXRaa1RpbWVvdXQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgLy8gd2FpdGluZyBmb3IgdGhlIHByZXZpb3VzIGJv\nb2tpZSByZWcgem5vZGUgZGVsZXRpb24KICAgICAgICAgICAgICAgICAgICBp\nZiAoIXByZXZOb2RlTGF0Y2guYXdhaXQoY29uZi5nZXRaa1RpbWVvdXQoKSwg\nVGltZVVuaXQuTUlMTElTRUNPTkRTKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgTm9kZUV4aXN0c0V4Y2VwdGlvbihyZWdQYXRoKTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChLZWVwZXJF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJaSyBleGNl\ncHRpb24gY2hlY2tpbmcgYW5kIHdhaXQgZXBoZW1lcmFsIHpub2RlIHt9IGV4\ncGlyZWQgOiAiLCByZWdQYXRoLCBrZSk7CiAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbigiWksgZXhjZXB0aW9uIGNoZWNraW5nIGFuZCB3YWl0\nIGVwaGVtZXJhbCB6bm9kZSAiCiAgICAgICAgICAgICAgICAgICAgKyByZWdQ\nYXRoICsgIiBleHBpcmVkIiwga2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nSW50ZXJydXB0ZWQgY2hlY2tpbmcgYW5kIHdhaXQgZXBoZW1lcmFsIHpub2Rl\nIHt9IGV4cGlyZWQgOiAiLCByZWdQYXRoLCBpZSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBJT0V4Y2VwdGlvbigiSW50ZXJydXB0ZWQgY2hlY2tpbmcgYW5k\nIHdhaXQgZXBoZW1lcmFsIHpub2RlICIKICAgICAgICAgICAgICAgICAgICAr\nIHJlZ1BhdGggKyAiIGV4cGlyZWQiLCBpZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogUmVnaXN0ZXIgYXMgYW4gYXZhaWxhYmxlIGJvb2tp\nZQogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCByZWdpc3RlckJvb2tpZShT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKG51bGwgPT0gemspIHsKICAgICAgICAgICAgLy8gem9v\na2VlcGVyIGluc3RhbmNlIGlzIG51bGwsIG1lYW5zIG5vdCByZWdpc3RlciBp\ndHNlbGYgdG8gemsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAg\nICAgICAgLy8gWksgZXBoZW1lcmFsIG5vZGUgZm9yIHRoaXMgQm9va2llLgog\nICAgICAgIHRyeXsKICAgICAgICAgICAgaWYgKCFjaGVja1JlZ05vZGVBbmRX\nYWl0RXhwaXJlZCh6a0Jvb2tpZVJlZ1BhdGgpKSB7CiAgICAgICAgICAgICAg\nICAvLyBDcmVhdGUgdGhlIFpLIGVwaGVtZXJhbCBub2RlIGZvciB0aGlzIEJv\nb2tpZS4KICAgICAgICAgICAgICAgIHprLmNyZWF0ZSh6a0Jvb2tpZVJlZ1Bh\ndGgsIG5ldyBieXRlWzBdLCBJZHMuT1BFTl9BQ0xfVU5TQUZFLAogICAgICAg\nICAgICAgICAgICAgICAgICBDcmVhdGVNb2RlLkVQSEVNRVJBTCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24ga2Up\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJaSyBleGNlcHRpb24gcmVnaXN0\nZXJpbmcgZXBoZW1lcmFsIFpub2RlIGZvciBCb29raWUhIiwga2UpOwogICAg\nICAgICAgICAvLyBUaHJvdyBhbiBJT0V4Y2VwdGlvbiBiYWNrIHVwLiBUaGlz\nIHdpbGwgY2F1c2UgdGhlIEJvb2tpZQogICAgICAgICAgICAvLyBjb25zdHJ1\nY3RvciB0byBlcnJvciBvdXQuIEFsdGVybmF0aXZlbHksIHdlIGNvdWxkIGRv\nIGEgU3lzdGVtCiAgICAgICAgICAgIC8vIGV4aXQgaGVyZSBhcyB0aGlzIGlz\nIGEgZmF0YWwgZXJyb3IuCiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbihrZSk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRp\nb24gaWUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJaSyBleGNlcHRpb24g\ncmVnaXN0ZXJpbmcgZXBoZW1lcmFsIFpub2RlIGZvciBCb29raWUhIiwKICAg\nICAgICAgICAgICAgICAgICBpZSk7CiAgICAgICAgICAgIC8vIFRocm93IGFu\nIElPRXhjZXB0aW9uIGJhY2sgdXAuIFRoaXMgd2lsbCBjYXVzZSB0aGUgQm9v\na2llCiAgICAgICAgICAgIC8vIGNvbnN0cnVjdG9yIHRvIGVycm9yIG91dC4g\nQWx0ZXJuYXRpdmVseSwgd2UgY291bGQgZG8gYSBTeXN0ZW0KICAgICAgICAg\nICAgLy8gZXhpdCBoZXJlIGFzIHRoaXMgaXMgYSBmYXRhbCBlcnJvci4KICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGllKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUcmFuc2l0aW9uIHRoZSBib29raWUg\nZnJvbSByZWFkT25seSBtb2RlIHRvIHdyaXRhYmxlCiAgICAgKi8KICAgIEBW\naXNpYmxlRm9yVGVzdGluZwogICAgcHVibGljIHZvaWQgdHJhbnNpdGlvblRv\nV3JpdGFibGVNb2RlKCkgewogICAgICAgIGlmICghcmVhZE9ubHkuY29tcGFy\nZUFuZFNldCh0cnVlLCBmYWxzZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KICAgICAgICBMT0cuaW5mbygiVHJhbnNpdGlvbmluZyBCb29r\naWUgdG8gV3JpdGFibGUgbW9kZSBhbmQgd2lsbCBzZXJ2ZSByZWFkL3dyaXRl\nIHJlcXVlc3RzLiIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRoaXMu\ncmVnaXN0ZXJCb29raWUoY29uZik7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBMT0cud2FybigiRXJyb3IgaW4gdHJh\nbnNpdGlvbmluZyBiYWNrIHRvIHdyaXRhYmxlIG1vZGUgOiAiLCBlKTsKICAg\nICAgICAgICAgdHJhbnNpdGlvblRvUmVhZE9ubHlNb2RlKCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gY2xlYXIgdGhlIHJl\nYWRvbmx5IHN0YXRlCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgemsuZGVs\nZXRlKHprQm9va2llUmVhZE9ubHlQYXRoLCAtMSk7CiAgICAgICAgfSBjYXRj\naCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBUaHJl\nYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICBM\nT0cud2FybigiSW50ZXJydXB0ZWQgY2xlYXJpbmcgcmVhZG9ubHkgc3RhdGUg\nd2hpbGUgdHJhbnNpdGlvbmluZyB0byB3cml0YWJsZSBtb2RlIDogIiwgZSk7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGNhdGNoIChLZWVwZXJF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBpZiB3ZSBmYWlsZWQgd2hl\nbiBkZWxldGluZyB0aGUgcmVhZG9ubHkgZmxhZyBpbiB6b29rZWVwZXIsIGl0\nIGlzIE9LIHNpbmNlIGNsaWVudCB3b3VsZAogICAgICAgICAgICAvLyBhbHJl\nYWR5IHNlZSB0aGUgYm9va2llIGluIHdyaXRhYmxlIGxpc3QuIHNvIGp1c3Qg\nbG9nIHRoZSBleGNlcHRpb24KICAgICAgICAgICAgTE9HLndhcm4oIkZhaWxl\nZCB0byBkZWxldGUgYm9va2llIHJlYWRvbmx5IHN0YXRlIGluIHpvb2tlZXBl\nciA6ICIsIGUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogVHJhbnNpdGlvbiB0aGUgYm9va2llIHRvIHJl\nYWRPbmx5IG1vZGUKICAgICAqLwogICAgQFZpc2libGVGb3JUZXN0aW5nCiAg\nICBwdWJsaWMgdm9pZCB0cmFuc2l0aW9uVG9SZWFkT25seU1vZGUoKSB7CiAg\nICAgICAgaWYgKHNodXR0aW5nZG93bikgewogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlYWRPbmx5LmNvbXBhcmVBbmRT\nZXQoZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CiAgICAgICAgaWYgKCFjb25mLmlzUmVhZE9ubHlNb2RlRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJSZWFkT25seSBtb2RlIGlzIG5v\ndCBlbmFibGVkLiAiCiAgICAgICAgICAgICAgICAgICAgKyAiQ2FuIGJlIGVu\nYWJsZWQgYnkgY29uZmlndXJpbmcgIgogICAgICAgICAgICAgICAgICAgICsg\nIidyZWFkT25seU1vZGVFbmFibGVkPXRydWUnIGluIGNvbmZpZ3VyYXRpb24u\nIgogICAgICAgICAgICAgICAgICAgICsgIlNodXR0aW5nIGRvd24gYm9va2ll\nIik7CiAgICAgICAgICAgIHRyaWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29k\nZS5CT09LSUVfRVhDRVBUSU9OKTsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICBMT0cuaW5mbygiVHJhbnNpdGlvbmluZyBCb29raWUg\ndG8gUmVhZE9ubHkgbW9kZSwiCiAgICAgICAgICAgICAgICArICIgYW5kIHdp\nbGwgc2VydmUgb25seSByZWFkIHJlcXVlc3RzIGZyb20gY2xpZW50cyEiKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAobnVsbCA9PSB6ay5leGlz\ndHModGhpcy5ib29raWVSZWdpc3RyYXRpb25QYXRoCiAgICAgICAgICAgICAg\nICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlJFQURPTkxZLCBmYWxzZSkp\nIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nemsuY3JlYXRlKHRoaXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlJF\nQURPTkxZLCBuZXcgYnl0ZVswXSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1vZGUuUEVSU0lTVEVO\nVCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChOb2RlRXhpc3RzRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIG5vZGUgaXMg\nanVzdCBub3cgY3JlYXRlZCBieSBzb21lb25lLgogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghY2hlY2tSZWdOb2Rl\nQW5kV2FpdEV4cGlyZWQoemtCb29raWVSZWFkT25seVBhdGgpKSB7CiAgICAg\nICAgICAgICAgICAvLyBDcmVhdGUgdGhlIHJlYWRvbmx5IG5vZGUKICAgICAg\nICAgICAgICAgIHprLmNyZWF0ZSh6a0Jvb2tpZVJlYWRPbmx5UGF0aCwKICAg\nICAgICAgICAgICAgICAgICAgICAgbmV3IGJ5dGVbMF0sIElkcy5PUEVOX0FD\nTF9VTlNBRkUsIENyZWF0ZU1vZGUuRVBIRU1FUkFMKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gQ2xlYXIg\ndGhlIGN1cnJlbnQgcmVnaXN0ZXJlZCBub2RlCiAgICAgICAgICAgICAgICB6\nay5kZWxldGUoemtCb29raWVSZWdQYXRoLCAtMSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNlcHRpb24gbm5lKSB7\nCiAgICAgICAgICAgICAgICBMT0cud2FybigiTm8gd3JpdGFibGUgYm9va2ll\nIHJlZ2lzdGVyZWQgbm9kZSB7fSB3aGVuIHRyYW5zaXRpb25pbmcgdG8gcmVh\nZG9ubHkiLAogICAgICAgICAgICAgICAgICAgICAgICB6a0Jvb2tpZVJlZ1Bh\ndGgsIG5uZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChJT0V4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgaW4g\ndHJhbnNpdGlvbiB0byBSZWFkT25seSBNb2RlLiIKICAgICAgICAgICAgICAg\nICAgICArICIgU2h1dHRpbmcgZG93biIsIGUpOwogICAgICAgICAgICB0cmln\nZ2VyQm9va2llU2h1dGRvd24oRXhpdENvZGUuQk9PS0lFX0VYQ0VQVElPTik7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9IGNhdGNoIChLZWVwZXJF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGlu\nIHRyYW5zaXRpb24gdG8gUmVhZE9ubHkgTW9kZS4iCiAgICAgICAgICAgICAg\nICAgICAgKyAiIFNodXR0aW5nIGRvd24iLCBlKTsKICAgICAgICAgICAgdHJp\nZ2dlckJvb2tpZVNodXRkb3duKEV4aXRDb2RlLkJPT0tJRV9FWENFUFRJT04p\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBUaHJlYWQuY3VycmVu\ndFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICBMT0cud2Fybigi\nSW50ZXJydXB0ZWQgRXhjZXB0aW9uIHdoaWxlIHRyYW5zaXRpb25pbmcgdG8g\nUmVhZE9ubHkgTW9kZS4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKgogICAgICogQ2hlY2sgd2hldGhlciBCb29raWUg\naXMgd3JpdGFibGUKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNSZWFk\nT25seSgpIHsKICAgICAgICByZXR1cm4gcmVhZE9ubHkuZ2V0KCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGUgYSBuZXcgem9va2VlcGVyIGNsaWVu\ndCB0byB6ayBjbHVzdGVyLgogICAgICoKICAgICAqIDxwPgogICAgICogQm9v\na2llIFNlcnZlciBqdXN0IHVzZWQgemsgY2xpZW50IHdoZW4gc3luY2luZyBs\nZWRnZXJzIGZvciBnYXJiYWdlIGNvbGxlY3Rpb24uCiAgICAgKiBTbyB3aGVu\nIHprIGNsaWVudCBpcyBleHBpcmVkLCBpdCBtZWFucyB0aGlzIGJvb2tpZSBz\nZXJ2ZXIgaXMgbm90IGF2YWlsYWJsZSBpbgogICAgICogYm9va2llIHNlcnZl\nciBsaXN0LiBUaGUgYm9va2llIGNsaWVudCB3aWxsIGJlIG5vdGlmaWVkIGZv\nciBpdHMgZXhwaXJhdGlvbi4gTm8KICAgICAqIG1vcmUgYm9va2llIHJlcXVl\nc3Qgd2lsbCBiZSBzZW50IHRvIHRoaXMgc2VydmVyLiBTbyBpdCdzIGJldHRl\nciB0byBleGl0IHdoZW4gemsKICAgICAqIGV4cGlyZWQuCiAgICAgKiA8L3A+\nCiAgICAgKiA8cD4KICAgICAqIFNpbmNlIHRoZXJlIGFyZSBsb3RzIG9mIGJr\nIG9wZXJhdGlvbnMgY2FjaGVkIGluIHF1ZXVlLCBzbyB3ZSB3YWl0IGZvciBh\nbGwgdGhlIG9wZXJhdGlvbnMKICAgICAqIGFyZSBwcm9jZXNzZWQgYW5kIHF1\naXQuIEl0IGlzIGRvbmUgYnkgY2FsbGluZyA8Yj5zaHV0ZG93bjwvYj4uCiAg\nICAgKiA8L3A+CiAgICAgKgogICAgICogQHBhcmFtIHprU2VydmVycyB0aGUg\ncXVvcnVtIGxpc3Qgb2Ygemsgc2VydmVycwogICAgICogQHBhcmFtIHNlc3Np\nb25UaW1lb3V0IHNlc3Npb24gdGltZW91dCBvZiB6ayBjb25uZWN0aW9uCiAg\nICAgKgogICAgICogQHJldHVybiB6ayBjbGllbnQgaW5zdGFuY2UKICAgICAq\nLwogICAgcHJpdmF0ZSBab29LZWVwZXIgbmV3Wm9va2VlcGVyKGZpbmFsIFN0\ncmluZyB6a1NlcnZlcnMsCiAgICAgICAgICAgIGZpbmFsIGludCBzZXNzaW9u\nVGltZW91dCkgdGhyb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiwKICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIHsKICAgICAgICBa\nb29LZWVwZXJXYXRjaGVyQmFzZSB3ID0gbmV3IFpvb0tlZXBlcldhdGNoZXJC\nYXNlKGNvbmYuZ2V0WmtUaW1lb3V0KCkpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2\nZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgZXhw\naXJlZCBjb25uZWN0aW9uLgogICAgICAgICAgICAgICAgaWYgKGV2ZW50Lmdl\ndFN0YXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuRXhw\naXJlZCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlpLIGNs\naWVudCBjb25uZWN0aW9uIHRvIHRoZSBaSyBzZXJ2ZXIgaGFzIGV4cGlyZWQh\nIik7CiAgICAgICAgICAgICAgICAgICAgc2h1dGRvd24oRXhpdENvZGUuWktf\nRVhQSVJFRCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHN1cGVyLnByb2Nlc3MoZXZlbnQpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICByZXR1cm4g\nWmtVdGlscy5jcmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGllbnQoemtTZXJ2\nZXJzLCB3KTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1J1bm5pbmco\nKSB7CiAgICAgICAgcmV0dXJuIHJ1bm5pbmc7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgLy8gYm9va2ll\nIHRocmVhZCB3YWl0IGZvciBqb3VybmFsIHRocmVhZAogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIC8vIHN0YXJ0IGpvdXJuYWwKICAgICAgICAgICAgam91\ncm5hbC5zdGFydCgpOwogICAgICAgICAgICAvLyB3YWl0IHVudGlsIGpvdXJu\nYWwgcXVpdHMKICAgICAgICAgICAgam91cm5hbC5qb2luKCk7CiAgICAgICAg\nfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICB9\nCiAgICAgICAgLy8gaWYgdGhlIGpvdXJuYWwgdGhyZWFkIHF1aXRzIGR1ZSB0\nbyBzaHV0dGluZyBkb3duLCBpdCBpcyBvawogICAgICAgIGlmICghc2h1dHRp\nbmdkb3duKSB7CiAgICAgICAgICAgIC8vIHNvbWUgZXJyb3IgZm91bmQgaW4g\nam91cm5hbCB0aHJlYWQgYW5kIGl0IHF1aXRzCiAgICAgICAgICAgIC8vIGZv\nbGxvd2luZyBhZGQgb3BlcmF0aW9ucyB0byBpdCB3b3VsZCBoYW5nIHVuaXQg\nY2xpZW50IHRpbWVvdXQKICAgICAgICAgICAgLy8gc28gd2Ugc2hvdWxkIGxl\ndCBib29raWUgc2VydmVyIGV4aXN0cwogICAgICAgICAgICBMT0cuZXJyb3Io\nIkpvdXJuYWwgbWFuYWdlciBxdWl0cyB1bmV4cGVjdGVkbHkuIik7CiAgICAg\nICAgICAgIHRyaWdnZXJCb29raWVTaHV0ZG93bihFeGl0Q29kZS5CT09LSUVf\nRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gVHJpZ2dlcmlu\nZyB0aGUgQm9va2llIHNodXRkb3duIGluIGl0cyBvd24gdGhyZWFkLAogICAg\nLy8gYmVjYXVzZSBzaHV0ZG93biBjYW4gYmUgY2FsbGVkIGZyb20gc3luYyB0\naHJlYWQgd2hpY2ggd291bGQgYmUKICAgIC8vIGludGVycnVwdGVkIGJ5IHNo\ndXRkb3duIGNhbGwuCiAgICBBdG9taWNCb29sZWFuIHNodXRkb3duVHJpZ2dl\ncmVkID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAgdm9pZCB0cmln\nZ2VyQm9va2llU2h1dGRvd24oZmluYWwgaW50IGV4aXRDb2RlKSB7CiAgICAg\nICAgaWYgKCFzaHV0ZG93blRyaWdnZXJlZC5jb21wYXJlQW5kU2V0KGZhbHNl\nLCB0cnVlKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAg\nICAgIExPRy5pbmZvKCJUcmlnZ2VyaW5nIHNodXRkb3duIG9mIEJvb2tpZS17\nfSB3aXRoIGV4aXRDb2RlIHt9IiwKICAgICAgICAgICAgICAgICBjb25mLmdl\ndEJvb2tpZVBvcnQoKSwgZXhpdENvZGUpOwogICAgICAgIEJvb2tpZVRocmVh\nZCB0aCA9IG5ldyBCb29raWVUaHJlYWQoIkJvb2tpZVNodXRkb3duVHJpZ2dl\nciIpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgIEJvb2tpZS50aGlzLnNo\ndXRkb3duKGV4aXRDb2RlKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAg\nICAgICAgdGguc3RhcnQoKTsKICAgIH0KCiAgICAvLyBwcm92aWRlZCBhIHB1\nYmxpYyBzaHV0ZG93biBtZXRob2QgZm9yIG90aGVyIGNhbGxlcgogICAgLy8g\ndG8gc2h1dCBkb3duIGJvb2tpZSBncmFjZWZ1bGx5CiAgICBwdWJsaWMgaW50\nIHNodXRkb3duKCkgewogICAgICAgIHJldHVybiBzaHV0ZG93bihFeGl0Q29k\nZS5PSyk7CiAgICB9CgogICAgLy8gaW50ZXJuYWwgc2h1dGRvd24gbWV0aG9k\nIHRvIGxldCBzaHV0ZG93biBib29raWUgZ3JhY2VmdWxseQogICAgLy8gd2hl\nbiBlbmNvdW50ZXJpbmcgZXhjZXB0aW9uCiAgICBzeW5jaHJvbml6ZWQgaW50\nIHNodXRkb3duKGludCBleGl0Q29kZSkgewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmIChydW5uaW5nKSB7IC8vIGF2b2lkIHNodXRkb3duIHR3aWNl\nCiAgICAgICAgICAgICAgICAvLyB0aGUgZXhpdENvZGUgb25seSBzZXQgd2hl\nbiBmaXJzdCBzaHV0ZG93biB1c3VhbGx5IGR1ZSB0byBleGNlcHRpb24gZm91\nbmQKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJTaHV0dGluZyBkb3duIEJv\nb2tpZS17fSB3aXRoIGV4aXRDb2RlIHt9IiwKICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbmYuZ2V0Qm9va2llUG9ydCgpLCBleGl0Q29kZSk7CiAgICAg\nICAgICAgICAgICBpZiAodGhpcy5leGl0Q29kZSA9PSBFeGl0Q29kZS5PSykg\newogICAgICAgICAgICAgICAgICAgIHRoaXMuZXhpdENvZGUgPSBleGl0Q29k\nZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIG1hcmsg\nYm9va2llIGFzIGluIHNodXR0aW5nIGRvd24gcHJvZ3Jlc3MKICAgICAgICAg\nICAgICAgIHNodXR0aW5nZG93biA9IHRydWU7CgogICAgICAgICAgICAgICAg\nLy8gU2h1dGRvd24gam91cm5hbAogICAgICAgICAgICAgICAgam91cm5hbC5z\naHV0ZG93bigpOwogICAgICAgICAgICAgICAgdGhpcy5qb2luKCk7CiAgICAg\nICAgICAgICAgICBzeW5jVGhyZWFkLnNodXRkb3duKCk7CgogICAgICAgICAg\nICAgICAgLy8gU2h1dGRvd24gdGhlIEVudHJ5TG9nZ2VyIHdoaWNoIGhhcyB0\naGUgR2FyYmFnZUNvbGxlY3RvciBUaHJlYWQgcnVubmluZwogICAgICAgICAg\nICAgICAgbGVkZ2VyU3RvcmFnZS5zaHV0ZG93bigpOwoKICAgICAgICAgICAg\nICAgIC8vIGNsb3NlIExlZGdlciBNYW5hZ2VyCiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGxlZGdlck1hbmFnZXIuY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJNYW5hZ2VyRmFjdG9yeS51\nbmluaXRpYWxpemUoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhj\nZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJG\nYWlsZWQgdG8gY2xvc2UgYWN0aXZlIGxlZGdlciBtYW5hZ2VyIDogIiwgaWUp\nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vU2h1dGRv\nd24gZGlzayBjaGVja2VyCiAgICAgICAgICAgICAgICBsZWRnZXJEaXJzTWFu\nYWdlci5zaHV0ZG93bigpOwogICAgICAgICAgICAgICAgaWYgKGluZGV4RGly\nc01hbmFnZXIgIT0gbGVkZ2VyRGlyc01hbmFnZXIpIHsKICAgICAgICAgICAg\nICAgICAgICBpbmRleERpcnNNYW5hZ2VyLnNodXRkb3duKCk7CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gU2h1dGRvd24gdGhlIFpL\nIGNsaWVudAogICAgICAgICAgICAgICAgaWYoemsgIT0gbnVsbCkgemsuY2xv\nc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEludGVycnVw\ndGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiSW50\nZXJydXB0ZWQgZHVyaW5nIHNodXR0aW5nIGRvd24gYm9va2llIDogIiwgaWUp\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIC8vIHNldHRpbmcg\ncnVubmluZyB0byBmYWxzZSBoZXJlLCBzbyB3YXRjaCB0aHJlYWQKICAgICAg\nICAgICAgLy8gaW4gYm9va2llIHNlcnZlciBrbm93IGl0IG9ubHkgYWZ0ZXIg\nYm9va2llIHNodXQgZG93bgogICAgICAgICAgICBydW5uaW5nID0gZmFsc2U7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmV4aXRDb2RlOwogICAg\nfQoKICAgIC8qKgogICAgICogUmV0cmlldmUgdGhlIGxlZGdlciBkZXNjcmlw\ndG9yIGZvciB0aGUgbGVkZ2VyIHdoaWNoIGVudHJ5IHNob3VsZCBiZSBhZGRl\nZCB0by4KICAgICAqIFRoZSBMZWRnZXJEZXNjcmlwdG9yIHJldHVybmVkIGZy\nb20gdGhpcyBtZXRob2Qgc2hvdWxkIGJlIGV2ZW50dWFsbHkgZnJlZWQgd2l0\naAogICAgICogI3B1dEhhbmRsZSgpLgogICAgICoKICAgICAqIEB0aHJvd3Mg\nQm9va2llRXhjZXB0aW9uIGlmIG1hc3RlcktleSBkb2VzIG5vdCBtYXRjaCB0\naGUgbWFzdGVyIGtleSBvZiB0aGUgbGVkZ2VyCiAgICAgKi8KICAgIHByaXZh\ndGUgTGVkZ2VyRGVzY3JpcHRvciBnZXRMZWRnZXJGb3JFbnRyeShCeXRlQnVm\nZmVyIGVudHJ5LCBieXRlW10gbWFzdGVyS2V5KQogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9u\nZyBsZWRnZXJJZCA9IGVudHJ5LmdldExvbmcoKTsKICAgICAgICBMZWRnZXJE\nZXNjcmlwdG9yIGwgPSBoYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJZCwgbWFz\ndGVyS2V5KTsKICAgICAgICBpZiAoIW1hc3RlcktleUNhY2hlLmNvbnRhaW5z\nS2V5KGxlZGdlcklkKSkgewogICAgICAgICAgICAvLyBuZXcgaGFuZGxlLCB3\nZSBzaG91bGQgYWRkIHRoZSBrZXkgdG8gam91cm5hbCBlbnN1cmUgd2UgY2Fu\nIHJlYnVpbGQKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVCdWZm\nZXIuYWxsb2NhdGUoOCArIDggKyA0ICsgbWFzdGVyS2V5Lmxlbmd0aCk7CiAg\nICAgICAgICAgIGJiLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgICAgICBi\nYi5wdXRMb25nKE1FVEFFTlRSWV9JRF9MRURHRVJfS0VZKTsKICAgICAgICAg\nICAgYmIucHV0SW50KG1hc3RlcktleS5sZW5ndGgpOwogICAgICAgICAgICBi\nYi5wdXQobWFzdGVyS2V5KTsKICAgICAgICAgICAgYmIuZmxpcCgpOwoKICAg\nICAgICAgICAgaWYgKG51bGwgPT0gbWFzdGVyS2V5Q2FjaGUucHV0SWZBYnNl\nbnQobGVkZ2VySWQsIG1hc3RlcktleSkpIHsKICAgICAgICAgICAgICAgIGpv\ndXJuYWwubG9nQWRkRW50cnkoYmIsIG5ldyBOb3BXcml0ZUNhbGxiYWNrKCks\nIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBsOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGFuIGVudHJ5IHRvIGEg\nbGVkZ2VyIGFzIHNwZWNpZmllZCBieSBoYW5kbGUuCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBhZGRFbnRyeUludGVybmFsKExlZGdlckRlc2NyaXB0b3Ig\naGFuZGxlLCBCeXRlQnVmZmVyIGVudHJ5LCBXcml0ZUNhbGxiYWNrIGNiLCBP\nYmplY3QgY3R4KQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEJv\nb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBsZWRnZXJJZCA9IGhhbmRs\nZS5nZXRMZWRnZXJJZCgpOwogICAgICAgIGVudHJ5LnJld2luZCgpOwogICAg\nICAgIGxvbmcgZW50cnlJZCA9IGhhbmRsZS5hZGRFbnRyeShlbnRyeSk7Cgog\nICAgICAgIGVudHJ5LnJld2luZCgpOwogICAgICAgIHdyaXRlQnl0ZXMuYWRk\nKGVudHJ5LnJlbWFpbmluZygpKTsKCiAgICAgICAgTE9HLnRyYWNlKCJBZGRp\nbmcge31Ae30iLCBlbnRyeUlkLCBsZWRnZXJJZCk7CiAgICAgICAgam91cm5h\nbC5sb2dBZGRFbnRyeShlbnRyeSwgY2IsIGN0eCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBBZGQgZW50cnkgdG8gYSBsZWRnZXIsIGV2ZW4gaWYgdGhlIGxl\nZGdlciBoYXMgcHJldmlvdXMgYmVlbiBmZW5jZWQuIFRoaXMgc2hvdWxkIG9u\nbHkKICAgICAqIGhhcHBlbiBpbiBib29raWUgcmVjb3Zlcnkgb3IgbGVkZ2Vy\nIHJlY292ZXJ5IGNhc2VzLCB3aGVyZSBlbnRyaWVzIGFyZSBiZWluZyByZXBs\naWNhdGVzCiAgICAgKiBzbyB0aGF0IHRoZXkgZXhpc3Qgb24gYSBxdW9ydW0g\nb2YgYm9va2llcy4gVGhlIGNvcnJlc3BvbmRpbmcgY2xpZW50IHNpZGUgY2Fs\nbCBmb3IgdGhpcwogICAgICogaXMgbm90IGV4cG9zZWQgdG8gdXNlcnMuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlY292ZXJ5QWRkRW50cnkoQnl0ZUJ1\nZmZlciBlbnRyeSwgV3JpdGVDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCwgYnl0\nZVtdIG1hc3RlcktleSkKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gZ2V0TGVkZ2VyRm9yRW50cnko\nZW50cnksIG1hc3RlcktleSk7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\naGFuZGxlKSB7CiAgICAgICAgICAgICAgICBhZGRFbnRyeUludGVybmFsKGhh\nbmRsZSwgZW50cnksIGNiLCBjdHgpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBjYXRjaCAoTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIHRyYW5zaXRpb25Ub1JlYWRPbmx5TW9kZSgpOwogICAgICAg\nICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQWRkIGVudHJ5IHRvIGEgbGVkZ2VyLgogICAg\nICogQHRocm93cyBCb29raWVFeGNlcHRpb24uTGVkZ2VyRmVuY2VkRXhjZXB0\naW9uIGlmIHRoZSBsZWRnZXIgaXMgZmVuY2VkCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGFkZEVudHJ5KEJ5dGVCdWZmZXIgZW50cnksIFdyaXRlQ2FsbGJh\nY2sgY2IsIE9iamVjdCBjdHgsIGJ5dGVbXSBtYXN0ZXJLZXkpCiAgICAgICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBMZWRnZXJEZXNjcmlwdG9yIGhhbmRs\nZSA9IGdldExlZGdlckZvckVudHJ5KGVudHJ5LCBtYXN0ZXJLZXkpOwogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQgKGhhbmRsZSkgewogICAgICAgICAgICAg\nICAgaWYgKGhhbmRsZS5pc0ZlbmNlZCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgQm9va2llRXhjZXB0aW9uCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAuY3JlYXRlKEJvb2tpZUV4Y2VwdGlvbi5Db2RlLkxlZGdlckZl\nbmNlZEV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBhZGRFbnRyeUludGVybmFsKGhhbmRsZSwgZW50cnksIGNiLCBjdHgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoTm9Xcml0YWJsZUxl\nZGdlckRpckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHRyYW5zaXRpb25U\nb1JlYWRPbmx5TW9kZSgpOwogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogRmVu\nY2VzIGEgbGVkZ2VyLiBGcm9tIHRoaXMgcG9pbnQgb24sIGNsaWVudHMgd2ls\nbCBiZSB1bmFibGUgdG8KICAgICAqIHdyaXRlIHRvIHRoaXMgbGVkZ2VyLiBP\nbmx5IHJlY292ZXJ5QWRkRW50cnkgd2lsbCBiZQogICAgICogYWJsZSB0byBh\nZGQgZW50cmllcyB0byB0aGUgbGVkZ2VyLgogICAgICogVGhpcyBtZXRob2Qg\naXMgaWRlbXBvdGVudC4gT25jZSBhIGxlZGdlciBpcyBmZW5jZWQsIGl0IGNh\nbgogICAgICogbmV2ZXIgYmUgdW5mZW5jZWQuIEZlbmNpbmcgYSBmZW5jZWQg\nbGVkZ2VyIGhhcyBubyBlZmZlY3QuCiAgICAgKi8KICAgIHB1YmxpYyBGdXR1\ncmU8Qm9vbGVhbj4gZmVuY2VMZWRnZXIobG9uZyBsZWRnZXJJZCwgYnl0ZVtd\nIG1hc3RlcktleSkgdGhyb3dzIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRp\nb24gewogICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gaGFuZGxl\ncy5nZXRIYW5kbGUobGVkZ2VySWQsIG1hc3RlcktleSk7CiAgICAgICAgYm9v\nbGVhbiBzdWNjZXNzOwogICAgICAgIHN5bmNocm9uaXplZCAoaGFuZGxlKSB7\nCiAgICAgICAgICAgIHN1Y2Nlc3MgPSBoYW5kbGUuc2V0RmVuY2VkKCk7CiAg\nICAgICAgfQogICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgIC8v\nIGZlbmNlZCBmaXJzdCB0aW1lLCB3ZSBzaG91bGQgYWRkIHRoZSBrZXkgdG8g\nam91cm5hbCBlbnN1cmUgd2UgY2FuIHJlYnVpbGQKICAgICAgICAgICAgQnl0\nZUJ1ZmZlciBiYiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoOCArIDgpOwogICAg\nICAgICAgICBiYi5wdXRMb25nKGxlZGdlcklkKTsKICAgICAgICAgICAgYmIu\ncHV0TG9uZyhNRVRBRU5UUllfSURfRkVOQ0VfS0VZKTsKICAgICAgICAgICAg\nYmIuZmxpcCgpOwoKICAgICAgICAgICAgRnV0dXJlV3JpdGVDYWxsYmFjayBm\nd2MgPSBuZXcgRnV0dXJlV3JpdGVDYWxsYmFjaygpOwogICAgICAgICAgICBM\nT0cuZGVidWcoInJlY29yZCBmZW5jZWQgc3RhdGUgZm9yIGxlZGdlciB7fSBp\nbiBqb3VybmFsLiIsIGxlZGdlcklkKTsKICAgICAgICAgICAgam91cm5hbC5s\nb2dBZGRFbnRyeShiYiwgZndjLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJu\nIGZ3Yy5nZXRSZXN1bHQoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAvLyBhbHJlYWR5IGZlbmNlZAogICAgICAgICAgICByZXR1cm4gU1VDQ0VT\nU19GVVRVUkU7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBCeXRlQnVm\nZmVyIHJlYWRFbnRyeShsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQpCiAg\nICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgTm9MZWRnZXJFeGNlcHRp\nb24gewogICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gaGFuZGxl\ncy5nZXRSZWFkT25seUhhbmRsZShsZWRnZXJJZCk7CiAgICAgICAgTE9HLnRy\nYWNlKCJSZWFkaW5nIHt9QHt9IiwgZW50cnlJZCwgbGVkZ2VySWQpOwogICAg\nICAgIEJ5dGVCdWZmZXIgZW50cnkgPSBoYW5kbGUucmVhZEVudHJ5KGVudHJ5\nSWQpOwogICAgICAgIHJlYWRCeXRlcy5hZGQoZW50cnkucmVtYWluaW5nKCkp\nOwogICAgICAgIHJldHVybiBlbnRyeTsKICAgIH0KCiAgICAvLyBUaGUgcmVz\ndCBvZiB0aGUgY29kZSBpcyB0ZXN0IHN0dWZmCiAgICBzdGF0aWMgY2xhc3Mg\nQ291bnRlckNhbGxiYWNrIGltcGxlbWVudHMgV3JpdGVDYWxsYmFjayB7CiAg\nICAgICAgaW50IGNvdW50OwoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBz\neW5jaHJvbml6ZWQgcHVibGljIHZvaWQgd3JpdGVDb21wbGV0ZShpbnQgcmMs\nIGxvbmcgbCwgbG9uZyBlLCBCb29raWVTb2NrZXRBZGRyZXNzIGFkZHIsIE9i\namVjdCBjdHgpIHsKICAgICAgICAgICAgY291bnQtLTsKICAgICAgICAgICAg\naWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgICAgIG5vdGlmeUFsbCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBzeW5jaHJvbml6\nZWQgcHVibGljIHZvaWQgaW5jQ291bnQoKSB7CiAgICAgICAgICAgIGNvdW50\nKys7CiAgICAgICAgfQoKICAgICAgICBzeW5jaHJvbml6ZWQgcHVibGljIHZv\naWQgd2FpdFplcm8oKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewog\nICAgICAgICAgICB3aGlsZSAoY291bnQgPiAwKSB7CiAgICAgICAgICAgICAg\nICB3YWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBGb3JtYXQgdGhlIGJvb2tpZSBzZXJ2ZXIgZGF0YQogICAg\nICoKICAgICAqIEBwYXJhbSBjb25mCiAgICAgKiAgICAgICAgICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24KICAgICAqIEBwYXJhbSBpc0ludGVyYWN0aXZlCiAg\nICAgKiAgICAgICAgICAgIFdoZXRoZXIgZm9ybWF0IHNob3VsZCBhc2sgcHJv\nbXB0IGZvciBjb25maXJtYXRpb24gaWYgb2xkIGRhdGEKICAgICAqICAgICAg\nICAgICAgZXhpc3RzIG9yIG5vdC4KICAgICAqIEBwYXJhbSBmb3JjZQogICAg\nICogICAgICAgICAgICBJZiBub24gaW50ZXJhY3RpdmUgYW5kIGZvcmNlIGlz\nIHRydWUsIHRoZW4gb2xkIGRhdGEgd2lsbCBiZQogICAgICogICAgICAgICAg\nICByZW1vdmVkIHdpdGhvdXQgY29uZmlybSBwcm9tcHQuCiAgICAgKiBAcmV0\ndXJuIFJldHVybnMgdHJ1ZSBpZiB0aGUgZm9ybWF0IGlzIHN1Y2Nlc3MgZWxz\nZSByZXR1cm5zIGZhbHNlCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYm9v\nbGVhbiBmb3JtYXQoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAg\nICAgICBib29sZWFuIGlzSW50ZXJhY3RpdmUsIGJvb2xlYW4gZm9yY2UpIHsK\nICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBjb25mLmdldEpvdXJuYWxEaXIo\nKTsKICAgICAgICBpZiAoam91cm5hbERpci5leGlzdHMoKSAmJiBqb3VybmFs\nRGlyLmlzRGlyZWN0b3J5KCkKICAgICAgICAgICAgICAgICYmIGpvdXJuYWxE\naXIubGlzdCgpLmxlbmd0aCAhPSAwKSB7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBib29sZWFuIGNvbmZpcm0gPSBmYWxzZTsKICAgICAg\nICAgICAgICAgIGlmICghaXNJbnRlcmFjdGl2ZSkgewogICAgICAgICAgICAg\nICAgICAgIC8vIElmIG5vbiBpbnRlcmFjdGl2ZSBhbmQgZm9yY2UgaXMgc2V0\nLCB0aGVuIGRlbGV0ZSBvbGQKICAgICAgICAgICAgICAgICAgICAvLyBkYXRh\nLgogICAgICAgICAgICAgICAgICAgIGlmIChmb3JjZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBjb25maXJtID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjb25maXJt\nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjb25maXJtID0gSU9V\ndGlscwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNvbmZpcm1Qcm9t\ncHQoIkFyZSB5b3Ugc3VyZSB0byBmb3JtYXQgQm9va2llIGRhdGEuLj8iKTsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWNvbmZp\ncm0pIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkJvb2tpZSBm\nb3JtYXQgYWJvcnRlZCEhIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkVycm9yIGR1cmluZyBib29raWUgZm9ybWF0IiwgZSk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgaWYgKCFjbGVhbkRpcihqb3VybmFsRGlyKSkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIkZvcm1hdHRpbmcgam91cm5hbCBkaXJlY3RvcnkgZmFp\nbGVkIik7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9Cgog\nICAgICAgIEZpbGVbXSBsZWRnZXJEaXJzID0gY29uZi5nZXRMZWRnZXJEaXJz\nKCk7CiAgICAgICAgZm9yIChGaWxlIGRpciA6IGxlZGdlckRpcnMpIHsKICAg\nICAgICAgICAgaWYgKCFjbGVhbkRpcihkaXIpKSB7CiAgICAgICAgICAgICAg\nICBMT0cuZXJyb3IoIkZvcm1hdHRpbmcgbGVkZ2VyIGRpcmVjdG9yeSAiICsg\nZGlyICsgIiBmYWlsZWQiKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gQ2xlYW4g\ndXAgaW5kZXggZGlyZWN0b3JpZXMgaWYgdGhleSBhcmUgc2VwYXJhdGUgZnJv\nbSB0aGUgbGVkZ2VyIGRpcnMKICAgICAgICBGaWxlW10gaW5kZXhEaXJzID0g\nY29uZi5nZXRJbmRleERpcnMoKTsKICAgICAgICBpZiAobnVsbCAhPSBpbmRl\neERpcnMpIHsKICAgICAgICAgICAgZm9yIChGaWxlIGRpciA6IGluZGV4RGly\ncykgewogICAgICAgICAgICAgICAgaWYgKCFjbGVhbkRpcihkaXIpKSB7CiAg\nICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJGb3JtYXR0aW5nIGxlZGdl\nciBkaXJlY3RvcnkgIiArIGRpciArICIgZmFpbGVkIik7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBMT0cuaW5mbygiQm9va2ll\nIGZvcm1hdCBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBj\nbGVhbkRpcihGaWxlIGRpcikgewogICAgICAgIGlmIChkaXIuZXhpc3RzKCkp\nIHsKICAgICAgICAgICAgZm9yIChGaWxlIGNoaWxkIDogZGlyLmxpc3RGaWxl\ncygpKSB7CiAgICAgICAgICAgICAgICBib29sZWFuIGRlbGV0ZSA9IEZpbGVV\ndGlscy5kZWxldGVRdWlldGx5KGNoaWxkKTsKICAgICAgICAgICAgICAgIGlm\nICghZGVsZXRlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJO\nb3QgYWJsZSB0byBkZWxldGUgIiArIGNoaWxkKTsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgaWYgKCFkaXIubWtkaXJzKCkpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJOb3QgYWJsZSB0byBjcmVhdGUgdGhlIGRp\ncmVjdG9yeSAiICsgZGlyKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIEBwYXJhbSBhcmdzCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9u\nCiAgICAgKiBAdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKi8K\nICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpCiAg\nICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24sIEJvb2tpZUV4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uIHsKICAg\nICAgICBCb29raWUgYiA9IG5ldyBCb29raWUobmV3IFNlcnZlckNvbmZpZ3Vy\nYXRpb24oKSk7CiAgICAgICAgYi5zdGFydCgpOwogICAgICAgIENvdW50ZXJD\nYWxsYmFjayBjYiA9IG5ldyBDb3VudGVyQ2FsbGJhY2soKTsKICAgICAgICBs\nb25nIHN0YXJ0ID0gTWF0aFV0aWxzLm5vdygpOwogICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgMTAwMDAwOyBpKyspIHsKICAgICAgICAgICAgQnl0ZUJ1\nZmZlciBidWZmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgxMDI0KTsKICAgICAg\nICAgICAgYnVmZi5wdXRMb25nKDEpOwogICAgICAgICAgICBidWZmLnB1dExv\nbmcoaSk7CiAgICAgICAgICAgIGJ1ZmYubGltaXQoMTAyNCk7CiAgICAgICAg\nICAgIGJ1ZmYucG9zaXRpb24oMCk7CiAgICAgICAgICAgIGNiLmluY0NvdW50\nKCk7CiAgICAgICAgICAgIGIuYWRkRW50cnkoYnVmZiwgY2IsIG51bGwsIG5l\ndyBieXRlWzBdKTsKICAgICAgICB9CiAgICAgICAgY2Iud2FpdFplcm8oKTsK\nICAgICAgICBsb25nIGVuZCA9IE1hdGhVdGlscy5ub3coKTsKICAgICAgICBT\neXN0ZW0ub3V0LnByaW50bG4oIlRvb2sgIiArIChlbmQtc3RhcnQpICsgIm1z\nIik7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIGV4aXQgY29kZSAt\nIGNhdXNlIG9mIGZhaWx1cmUKICAgICAqCiAgICAgKiBAcmV0dXJuIHtAbGlu\nayBFeGl0Q29kZX0KICAgICAqLwogICAgcHVibGljIGludCBnZXRFeGl0Q29k\nZSgpIHsKICAgICAgICByZXR1cm4gZXhpdENvZGU7CiAgICB9Cn0K\n","encoding":"base64"}

