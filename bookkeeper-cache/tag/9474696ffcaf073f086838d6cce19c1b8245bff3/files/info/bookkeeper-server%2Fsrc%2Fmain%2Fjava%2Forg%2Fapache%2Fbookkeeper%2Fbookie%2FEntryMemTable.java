{"sha":"9fbe866fc0404985601e487f1ecdcbfdfa9261f0","node_id":"MDQ6QmxvYjE1NzU5NTY6OWZiZTg2NmZjMDQwNDk4NTYwMWU0ODdmMWVjZGNiZmRmYTkyNjFmMA==","size":15170,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9fbe866fc0404985601e487f1ecdcbfdfa9261f0","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cu\nYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3Mg\ncmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdy\naXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNl\nbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJ\nVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2Ug\nZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lv\nbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8K\nCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZTsKCmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZS5Ob0xlZGdl\nckV4Y2VwdGlvbjsKCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNMb25nOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQubG9ja3MuUmVlbnRyYW50UmVhZFdyaXRlTG9jazsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRTa2lwTGlzdE1hcDsK\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RhdHMuQ291bnRlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5PcFN0YXRzTG9n\nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnN0YXRzLlN0YXRz\nTG9nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuTWF0\naFV0aWxzOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5ib29raWUuQ2hlY2twb2ludFNvdXJjZS5DaGVja3BvaW50OwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJh\ndGlvbjsKCmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJv\nb2tpZS5Cb29rS2VlcGVyU2VydmVyU3RhdHMuU0tJUF9MSVNUX0ZMVVNIX0JZ\nVEVTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29r\naWUuQm9va0tlZXBlclNlcnZlclN0YXRzLlNLSVBfTElTVF9HRVRfRU5UUlk7\nCmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5C\nb29rS2VlcGVyU2VydmVyU3RhdHMuU0tJUF9MSVNUX1BVVF9FTlRSWTsKaW1w\nb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tL\nZWVwZXJTZXJ2ZXJTdGF0cy5TS0lQX0xJU1RfU05BUFNIT1Q7CmltcG9ydCBz\ndGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29rS2VlcGVy\nU2VydmVyU3RhdHMuU0tJUF9MSVNUX1RIUk9UVExJTkc7CgovKioKICogVGhl\nIEVudHJ5TWVtVGFibGUgaG9sZHMgaW4tbWVtb3J5IHJlcHJlc2VudGF0aW9u\nIHRvIHRoZSBlbnRyaWVzIG5vdC15ZXQgZmx1c2hlZC4KICogV2hlbiBhc2tl\nZCB0byBmbHVzaCwgY3VycmVudCBFbnRyeVNraXBMaXN0IGlzIG1vdmVkIHRv\nIHNuYXBzaG90IGFuZCBpcyBjbGVhcmVkLgogKiBXZSBjb250aW51ZSB0byBz\nZXJ2ZSBlZGl0cyBvdXQgb2YgbmV3IEVudHJ5U2tpcExpc3QgYW5kIGJhY2tp\nbmcgc25hcHNob3QgdW50aWwKICogZmx1c2hlciByZXBvcnRzIGluIHRoYXQg\ndGhlIGZsdXNoIHN1Y2NlZWRlZC4gQXQgdGhhdCBwb2ludCB3ZSBsZXQgdGhl\nIHNuYXBzaG90IGdvLgogKi8KcHVibGljIGNsYXNzIEVudHJ5TWVtVGFibGUg\newogICAgcHJpdmF0ZSBzdGF0aWMgTG9nZ2VyIExvZ2dlciA9IExvZ2dlckZh\nY3RvcnkuZ2V0TG9nZ2VyKEpvdXJuYWwuY2xhc3MpOwoKICAgIC8qKgogICAg\nICogRW50cnkgc2tpcCBsaXN0CiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBF\nbnRyeVNraXBMaXN0IGV4dGVuZHMgQ29uY3VycmVudFNraXBMaXN0TWFwPEVu\ndHJ5S2V5LCBFbnRyeUtleVZhbHVlPiB7CiAgICAgICAgZmluYWwgQ2hlY2tw\nb2ludCBjcDsKICAgICAgICBzdGF0aWMgZmluYWwgRW50cnlTa2lwTGlzdCBF\nTVBUWV9WQUxVRSA9IG5ldyBFbnRyeVNraXBMaXN0KENoZWNrcG9pbnQuTUFY\nKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBpc0VtcHR5KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICBFbnRyeVNr\naXBMaXN0KGZpbmFsIENoZWNrcG9pbnQgY3ApIHsKICAgICAgICAgICAgc3Vw\nZXIoRW50cnlLZXkuQ09NUEFSQVRPUik7CiAgICAgICAgICAgIHRoaXMuY3Ag\nPSBjcDsKICAgICAgICB9CgogICAgICAgIGludCBjb21wYXJlVG8oZmluYWwg\nQ2hlY2twb2ludCBjcCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5jcC5j\nb21wYXJlVG8oY3ApOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIEVudHJ5S2V5VmFsdWUgcHV0KEVudHJ5S2V5IGssIEVu\ndHJ5S2V5VmFsdWUgdikgewogICAgICAgICAgICByZXR1cm4gcHV0SWZBYnNl\nbnQoaywgdik7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgRW50cnlLZXlWYWx1ZSBwdXRJZkFic2VudChFbnRyeUtleSBr\nLCBFbnRyeUtleVZhbHVlIHYpIHsKICAgICAgICAgICAgYXNzZXJ0IGsuZXF1\nYWxzKHYpOwogICAgICAgICAgICByZXR1cm4gc3VwZXIucHV0SWZBYnNlbnQo\ndiwgdik7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAgICAg\ncmV0dXJuIHRoaXMgPT0gbzsKICAgICAgICB9CiAgICB9CgogICAgdm9sYXRp\nbGUgRW50cnlTa2lwTGlzdCBrdm1hcDsKCiAgICAvLyBTbmFwc2hvdCBvZiBF\nbnRyeU1lbVRhYmxlLiAgTWFkZSBmb3IgZmx1c2hlci4KICAgIHZvbGF0aWxl\nIEVudHJ5U2tpcExpc3Qgc25hcHNob3Q7CgogICAgZmluYWwgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mOwogICAgZmluYWwgQ2hlY2twb2ludFNvdXJjZSBj\naGVja3BvaW50U291cmNlOwoKICAgIGZpbmFsIFJlZW50cmFudFJlYWRXcml0\nZUxvY2sgbG9jayA9IG5ldyBSZWVudHJhbnRSZWFkV3JpdGVMb2NrKCk7Cgog\nICAgLy8gVXNlZCB0byB0cmFjayBvd24gZGF0YSBzaXplCiAgICBmaW5hbCBB\ndG9taWNMb25nIHNpemU7CgogICAgZmluYWwgbG9uZyBza2lwTGlzdFNpemVM\naW1pdDsKCiAgICBTa2lwTGlzdEFyZW5hIGFsbG9jYXRvcjsKCiAgICBwcml2\nYXRlIEVudHJ5U2tpcExpc3QgbmV3U2tpcExpc3QoKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBFbnRyeVNraXBMaXN0KGNoZWNrcG9pbnRTb3VyY2UubmV3Q2hl\nY2twb2ludCgpKTsKICAgIH0KCiAgICAvLyBTdGF0cwogICAgcHJpdmF0ZSBm\naW5hbCBPcFN0YXRzTG9nZ2VyIHNuYXBzaG90U3RhdHM7CiAgICBwcml2YXRl\nIGZpbmFsIE9wU3RhdHNMb2dnZXIgcHV0RW50cnlTdGF0czsKICAgIHByaXZh\ndGUgZmluYWwgT3BTdGF0c0xvZ2dlciBnZXRFbnRyeVN0YXRzOwogICAgcHJp\ndmF0ZSBmaW5hbCBDb3VudGVyIGZsdXNoQnl0ZXNDb3VudGVyOwogICAgcHJp\ndmF0ZSBmaW5hbCBDb3VudGVyIHRocm90dGxpbmdDb3VudGVyOwoKICAgIC8q\nKgogICAgKiBDb25zdHJ1Y3Rvci4KICAgICogQHBhcmFtIGNvbmYgU2VydmVy\nIGNvbmZpZ3VyYXRpb24KICAgICovCiAgICBwdWJsaWMgRW50cnlNZW1UYWJs\nZShmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYsIGZpbmFsIENoZWNr\ncG9pbnRTb3VyY2Ugc291cmNlLAogICAgICAgICAgICAgICAgICAgICAgICAg\nZmluYWwgU3RhdHNMb2dnZXIgc3RhdHNMb2dnZXIpIHsKICAgICAgICB0aGlz\nLmNoZWNrcG9pbnRTb3VyY2UgPSBzb3VyY2U7CiAgICAgICAgdGhpcy5rdm1h\ncCA9IG5ld1NraXBMaXN0KCk7CiAgICAgICAgdGhpcy5zbmFwc2hvdCA9IEVu\ndHJ5U2tpcExpc3QuRU1QVFlfVkFMVUU7CiAgICAgICAgdGhpcy5jb25mID0g\nY29uZjsKICAgICAgICB0aGlzLnNpemUgPSBuZXcgQXRvbWljTG9uZygwKTsK\nICAgICAgICB0aGlzLmFsbG9jYXRvciA9IG5ldyBTa2lwTGlzdEFyZW5hKGNv\nbmYpOwogICAgICAgIC8vIHNraXAgbGlzdCBzaXplIGxpbWl0CiAgICAgICAg\ndGhpcy5za2lwTGlzdFNpemVMaW1pdCA9IGNvbmYuZ2V0U2tpcExpc3RTaXpl\nTGltaXQoKTsKCiAgICAgICAgLy8gU3RhdHMKICAgICAgICB0aGlzLnNuYXBz\naG90U3RhdHMgPSBzdGF0c0xvZ2dlci5nZXRPcFN0YXRzTG9nZ2VyKFNLSVBf\nTElTVF9TTkFQU0hPVCk7CiAgICAgICAgdGhpcy5wdXRFbnRyeVN0YXRzID0g\nc3RhdHNMb2dnZXIuZ2V0T3BTdGF0c0xvZ2dlcihTS0lQX0xJU1RfUFVUX0VO\nVFJZKTsKICAgICAgICB0aGlzLmdldEVudHJ5U3RhdHMgPSBzdGF0c0xvZ2dl\nci5nZXRPcFN0YXRzTG9nZ2VyKFNLSVBfTElTVF9HRVRfRU5UUlkpOwogICAg\nICAgIHRoaXMuZmx1c2hCeXRlc0NvdW50ZXIgPSBzdGF0c0xvZ2dlci5nZXRD\nb3VudGVyKFNLSVBfTElTVF9GTFVTSF9CWVRFUyk7CiAgICAgICAgdGhpcy50\naHJvdHRsaW5nQ291bnRlciA9IHN0YXRzTG9nZ2VyLmdldENvdW50ZXIoU0tJ\nUF9MSVNUX1RIUk9UVExJTkcpOwogICAgfQoKICAgIHZvaWQgZHVtcCgpIHsK\nICAgICAgICBmb3IgKEVudHJ5S2V5IGtleTogdGhpcy5rdm1hcC5rZXlTZXQo\nKSkgewogICAgICAgICAgICBMb2dnZXIuaW5mbyhrZXkudG9TdHJpbmcoKSk7\nCiAgICAgICAgfQogICAgICAgIGZvciAoRW50cnlLZXkga2V5OiB0aGlzLnNu\nYXBzaG90LmtleVNldCgpKSB7CiAgICAgICAgICAgIExvZ2dlci5pbmZvKGtl\neS50b1N0cmluZygpKTsKICAgICAgICB9CiAgICB9CgogICAgQ2hlY2twb2lu\ndCBzbmFwc2hvdCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0\ndXJuIHNuYXBzaG90KENoZWNrcG9pbnQuTUFYKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNuYXBzaG90IGN1cnJlbnQgRW50cnlNZW1UYWJsZS4gaWYgZ2l2\nZW4gPGk+b2xkQ3A8L2k+IGlzIG9sZGVyIHRoYW4gY3VycmVudCBjaGVja3Bv\naW50LAogICAgICogd2UgZG9uJ3QgZG8gYW55IHNuYXBzaG90LiBJZiBzbmFw\nc2hvdCBoYXBwZW5lZCwgd2UgcmV0dXJuIHRoZSBjaGVja3BvaW50IG9mIHRo\nZSBzbmFwc2hvdC4KICAgICAqCiAgICAgKiBAcGFyYW0gb2xkQ3AKICAgICAq\nICAgICAgICAgIGNoZWNrcG9pbnQKICAgICAqIEByZXR1cm4gY2hlY2twb2lu\ndCBvZiB0aGUgc25hcHNob3QsIG51bGwgbWVhbnMgbm8gc25hcHNob3QKICAg\nICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwogICAgQ2hlY2twb2lu\ndCBzbmFwc2hvdChDaGVja3BvaW50IG9sZENwKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIENoZWNrcG9pbnQgY3AgPSBudWxsOwogICAgICAgIC8v\nIE5vLW9wIGlmIHNuYXBzaG90IGN1cnJlbnRseSBoYXMgZW50cmllcwogICAg\nICAgIGlmICh0aGlzLnNuYXBzaG90LmlzRW1wdHkoKSAmJgogICAgICAgICAg\nICAgICAgdGhpcy5rdm1hcC5jb21wYXJlVG8ob2xkQ3ApIDwgMCkgewogICAg\nICAgICAgICBmaW5hbCBsb25nIHN0YXJ0VGltZU5hbm9zID0gTWF0aFV0aWxz\nLm5vd0luTmFubygpOwogICAgICAgICAgICB0aGlzLmxvY2sud3JpdGVMb2Nr\nKCkubG9jaygpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\naWYgKHRoaXMuc25hcHNob3QuaXNFbXB0eSgpICYmICF0aGlzLmt2bWFwLmlz\nRW1wdHkoKQogICAgICAgICAgICAgICAgICAgICAgICAmJiB0aGlzLmt2bWFw\nLmNvbXBhcmVUbyhvbGRDcCkgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAg\ndGhpcy5zbmFwc2hvdCA9IHRoaXMua3ZtYXA7CiAgICAgICAgICAgICAgICAg\nICAgdGhpcy5rdm1hcCA9IG5ld1NraXBMaXN0KCk7CiAgICAgICAgICAgICAg\nICAgICAgLy8gZ2V0IHRoZSBjaGVja3BvaW50IG9mIHRoZSBtZW10YWJsZS4K\nICAgICAgICAgICAgICAgICAgICBjcCA9IHRoaXMua3ZtYXAuY3A7CiAgICAg\nICAgICAgICAgICAgICAgLy8gUmVzZXQgaGVhcCB0byBub3QgaW5jbHVkZSBh\nbnkga2V5cwogICAgICAgICAgICAgICAgICAgIHRoaXMuc2l6ZS5zZXQoMCk7\nCiAgICAgICAgICAgICAgICAgICAgLy8gUmVzZXQgYWxsb2NhdG9yIHNvIHdl\nIGdldCBhIGZyZXNoIGJ1ZmZlciBmb3IgdGhlIG5ldyBFbnRyeU1lbVRhYmxl\nCiAgICAgICAgICAgICAgICAgICAgdGhpcy5hbGxvY2F0b3IgPSBuZXcgU2tp\ncExpc3RBcmVuYShjb25mKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgIHRoaXMubG9jay53cml0\nZUxvY2soKS51bmxvY2soKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKG51bGwgIT0gY3ApIHsKICAgICAgICAgICAgICAgIHNuYXBzaG90U3Rh\ndHMucmVnaXN0ZXJTdWNjZXNzZnVsRXZlbnQoTWF0aFV0aWxzLmVsYXBzZWRN\nU2VjKHN0YXJ0VGltZU5hbm9zKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBzbmFwc2hvdFN0YXRzLnJlZ2lzdGVyRmFpbGVkRXZl\nbnQoTWF0aFV0aWxzLmVsYXBzZWRNU2VjKHN0YXJ0VGltZU5hbm9zKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNwOwogICAg\nfQoKICAgIC8qKgogICAgICogRmx1c2ggc25hcHNob3QgYW5kIGNsZWFyIGl0\nLgogICAgICovCiAgICBsb25nIGZsdXNoKGZpbmFsIFNraXBMaXN0Rmx1c2hl\nciBmbHVzaGVyKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBmbHVzaFNuYXBzaG90KGZsdXNoZXIsIENoZWNrcG9pbnQuTUFYKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEZsdXNoIG1lbXRhYmxlIHVudGlsIGNoZWNr\ncG9pbnQuCiAgICAgKgogICAgICogQHBhcmFtIGNoZWNrcG9pbnQKICAgICAq\nICAgICAgICAgIGFsbCBkYXRhIGJlZm9yZSB0aGlzIGNoZWNrcG9pbnQgbmVl\nZCB0byBiZSBmbHVzaGVkLgogICAgICovCiAgICBwdWJsaWMgbG9uZyBmbHVz\naChTa2lwTGlzdEZsdXNoZXIgZmx1c2hlciwgQ2hlY2twb2ludCBjaGVja3Bv\naW50KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGxvbmcgc2l6ZSA9\nIGZsdXNoU25hcHNob3QoZmx1c2hlciwgY2hlY2twb2ludCk7CiAgICAgICAg\naWYgKG51bGwgIT0gc25hcHNob3QoY2hlY2twb2ludCkpIHsKICAgICAgICAg\nICAgc2l6ZSArPSBmbHVzaFNuYXBzaG90KGZsdXNoZXIsIGNoZWNrcG9pbnQp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2l6ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIEZsdXNoIHNuYXBzaG90IGFuZCBjbGVhciBpdCBpZmYgaXRz\nIGRhdGEgaXMgYmVmb3JlIGNoZWNrcG9pbnQuCiAgICAgKiBPbmx5IHRoaXMg\nZnVuY3Rpb24gY2hhbmdlIG5vbi1lbXB0eSB0aGlzLnNuYXBzaG90LgogICAg\nICovCiAgICBwcml2YXRlIGxvbmcgZmx1c2hTbmFwc2hvdChmaW5hbCBTa2lw\nTGlzdEZsdXNoZXIgZmx1c2hlciwgQ2hlY2twb2ludCBjaGVja3BvaW50KSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGxvbmcgc2l6ZSA9IDA7CiAg\nICAgICAgaWYgKHRoaXMuc25hcHNob3QuY29tcGFyZVRvKGNoZWNrcG9pbnQp\nIDwgMCkgewogICAgICAgICAgICBsb25nIGxlZGdlciwgbGVkZ2VyR0MgPSAt\nMTsKICAgICAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAg\nICAgICAgICBFbnRyeVNraXBMaXN0IGtleVZhbHVlcyA9IHRoaXMuc25hcHNo\nb3Q7CiAgICAgICAgICAgICAgICBpZiAoa2V5VmFsdWVzLmNvbXBhcmVUbyhj\naGVja3BvaW50KSA8IDApIHsKICAgICAgICAgICAgICAgICAgICBmb3IgKEVu\ndHJ5S2V5IGtleSA6IGtleVZhbHVlcy5rZXlTZXQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBFbnRyeUtleVZhbHVlIGt2ID0gKEVudHJ5S2V5VmFs\ndWUpa2V5OwogICAgICAgICAgICAgICAgICAgICAgICBzaXplICs9IGt2Lmdl\ndExlbmd0aCgpOwogICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXIgPSBr\ndi5nZXRMZWRnZXJJZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbGVkZ2VyR0MgIT0gbGVkZ2VyKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZs\ndXNoZXIucHJvY2VzcyhsZWRnZXIsIGt2LmdldEVudHJ5SWQoKSwga3YuZ2V0\nVmFsdWVBc0J5dGVCdWZmZXIoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9IGNhdGNoIChOb0xlZGdlckV4Y2VwdGlvbiBleGNlcHRpb24pIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJHQyA9IGxl\nZGdlcjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBmbHVzaEJ5dGVzQ291bnRlci5hZGQoc2l6ZSk7CiAg\nICAgICAgICAgICAgICAgICAgY2xlYXJTbmFwc2hvdChrZXlWYWx1ZXMpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICByZXR1cm4gc2l6ZTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBw\nYXNzZWQgc25hcHNob3Qgd2FzIHN1Y2Nlc3NmdWxseSBwZXJzaXN0ZWQ7IGl0\nIGNhbiBiZSBsZXQgZ28uCiAgICAgKiBAcGFyYW0ga2V5VmFsdWVzIFRoZSBz\nbmFwc2hvdCB0byBjbGVhbiBvdXQuCiAgICAgKiBAc2VlIHtAbGluayAjc25h\ncHNob3QoKX0KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGNsZWFyU25hcHNo\nb3QoZmluYWwgRW50cnlTa2lwTGlzdCBrZXlWYWx1ZXMpIHsKICAgICAgICAv\nLyBDYWxsZXIgbWFrZXMgc3VyZSB0aGF0IGtleVZhbHVlcyBub3QgZW1wdHkK\nICAgICAgICBhc3NlcnQgIWtleVZhbHVlcy5pc0VtcHR5KCk7CiAgICAgICAg\ndGhpcy5sb2NrLndyaXRlTG9jaygpLmxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICAvLyBjcmVhdGUgYSBuZXcgc25hcHNob3QgYW5kIGxldCB0\naGUgb2xkIG9uZSBnby4KICAgICAgICAgICAgYXNzZXJ0IHRoaXMuc25hcHNo\nb3QgPT0ga2V5VmFsdWVzOwogICAgICAgICAgICB0aGlzLnNuYXBzaG90ID0g\nRW50cnlTa2lwTGlzdC5FTVBUWV9WQUxVRTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICB0aGlzLmxvY2sud3JpdGVMb2NrKCkudW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGhyb3R0bGluZyB3\ncml0ZXIgdy8gMSBtcyBkZWxheQogICAgICovCiAgICBwcml2YXRlIHZvaWQg\ndGhyb3R0bGVXcml0ZXJzKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIFRocmVhZC5zbGVlcCgxKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhy\nZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgfQogICAgICAgIHRocm90dGxp\nbmdDb3VudGVyLmluYygpOwogICAgfQoKICAgIC8qKgogICAgKiBXcml0ZSBh\nbiB1cGRhdGUKICAgICogQHBhcmFtIGVudHJ5CiAgICAqIEByZXR1cm4gYXBw\ncm94aW1hdGUgc2l6ZSBvZiB0aGUgcGFzc2VkIGtleSBhbmQgdmFsdWUuCiAg\nICAqLwogICAgcHVibGljIGxvbmcgYWRkRW50cnkobG9uZyBsZWRnZXJJZCwg\nbG9uZyBlbnRyeUlkLCBmaW5hbCBCeXRlQnVmZmVyIGVudHJ5LCBmaW5hbCBD\nYWNoZUNhbGxiYWNrIGNiKQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGxvbmcgc2l6ZSA9IDA7CiAgICAgICAgbG9uZyBzdGFy\ndFRpbWVOYW5vcyA9IE1hdGhVdGlscy5ub3dJbk5hbm8oKTsKICAgICAgICBi\nb29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAoaXNTaXplTGltaXRSZWFjaGVkKCkpIHsKICAgICAgICAgICAg\nICAgIENoZWNrcG9pbnQgY3AgPSBzbmFwc2hvdCgpOwogICAgICAgICAgICAg\nICAgaWYgKG51bGwgIT0gY3ApIHsKICAgICAgICAgICAgICAgICAgICBjYi5v\nblNpemVMaW1pdFJlYWNoZWQoKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgICAgICAgICAgdGhyb3R0bGVXcml0ZXJzKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMu\nbG9jay5yZWFkTG9jaygpLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIEVudHJ5S2V5VmFsdWUgdG9BZGQgPSBjbG9uZVdpdGhB\nbGxvY2F0b3IobGVkZ2VySWQsIGVudHJ5SWQsIGVudHJ5KTsKICAgICAgICAg\nICAgICAgIHNpemUgPSBpbnRlcm5hbEFkZCh0b0FkZCk7CiAgICAgICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0aGlzLmxvY2sucmVhZExv\nY2soKS51bmxvY2soKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWNj\nZXNzID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIHNpemU7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKHN1Y2Nlc3MpIHsKICAgICAg\nICAgICAgICAgIHB1dEVudHJ5U3RhdHMucmVnaXN0ZXJTdWNjZXNzZnVsRXZl\nbnQoTWF0aFV0aWxzLmVsYXBzZWRNU2VjKHN0YXJ0VGltZU5hbm9zKSk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBwdXRFbnRyeVN0\nYXRzLnJlZ2lzdGVyRmFpbGVkRXZlbnQoTWF0aFV0aWxzLmVsYXBzZWRNU2Vj\nKHN0YXJ0VGltZU5hbm9zKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAqIEludGVybmFsIHZlcnNpb24gb2YgYWRkKCkg\ndGhhdCBkb2Vzbid0IGNsb25lIEtWcyB3aXRoIHRoZQogICAgKiBhbGxvY2F0\nb3IsIGFuZCBkb2Vzbid0IHRha2UgdGhlIGxvY2suCiAgICAqCiAgICAqIENh\nbGxlcnMgc2hvdWxkIGVuc3VyZSB0aGV5IGFscmVhZHkgaGF2ZSB0aGUgcmVh\nZCBsb2NrIHRha2VuCiAgICAqLwogICAgcHJpdmF0ZSBsb25nIGludGVybmFs\nQWRkKGZpbmFsIEVudHJ5S2V5VmFsdWUgdG9BZGQpIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgbG9uZyBzaXplQ2hhbmdlID0gMDsKICAgICAgICBp\nZiAoa3ZtYXAucHV0SWZBYnNlbnQodG9BZGQsIHRvQWRkKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIHNpemVDaGFuZ2UgPSB0b0FkZC5nZXRMZW5ndGgoKTsK\nICAgICAgICAgICAgc2l6ZS5hZGRBbmRHZXQoc2l6ZUNoYW5nZSk7CiAgICAg\nICAgfQogICAgICAgIHJldHVybiBzaXplQ2hhbmdlOwogICAgfQoKICAgIHBy\naXZhdGUgRW50cnlLZXlWYWx1ZSBuZXdFbnRyeShsb25nIGxlZGdlcklkLCBs\nb25nIGVudHJ5SWQsIGZpbmFsIEJ5dGVCdWZmZXIgZW50cnkpIHsKICAgICAg\nICBieXRlW10gYnVmOwogICAgICAgIGludCBvZmZzZXQgPSAwOwogICAgICAg\nIGludCBsZW5ndGggPSBlbnRyeS5yZW1haW5pbmcoKTsKCiAgICAgICAgaWYg\nKGVudHJ5Lmhhc0FycmF5KCkpIHsKICAgICAgICAgICAgYnVmID0gZW50cnku\nYXJyYXkoKTsKICAgICAgICAgICAgb2Zmc2V0ID0gZW50cnkuYXJyYXlPZmZz\nZXQoKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGJ1\nZiA9IG5ldyBieXRlW2xlbmd0aF07CiAgICAgICAgICAgIGVudHJ5LmdldChi\ndWYpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEVudHJ5S2V5VmFs\ndWUobGVkZ2VySWQsIGVudHJ5SWQsIGJ1Ziwgb2Zmc2V0LCBsZW5ndGgpOwog\nICAgfQoKICAgIHByaXZhdGUgRW50cnlLZXlWYWx1ZSBjbG9uZVdpdGhBbGxv\nY2F0b3IobG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLCBmaW5hbCBCeXRl\nQnVmZmVyIGVudHJ5KSB7CiAgICAgICAgaW50IGxlbiA9IGVudHJ5LnJlbWFp\nbmluZygpOwogICAgICAgIFNraXBMaXN0QXJlbmEuTWVtb3J5U2xpY2UgYWxs\nb2MgPSBhbGxvY2F0b3IuYWxsb2NhdGVCeXRlcyhsZW4pOwogICAgICAgIGlm\nIChhbGxvYyA9PSBudWxsKSB7CiAgICAgICAgICAgIC8vIFRoZSBhbGxvY2F0\naW9uIHdhcyB0b28gbGFyZ2UsIGFsbG9jYXRvciBkZWNpZGVkCiAgICAgICAg\nICAgIC8vIG5vdCB0byBkbyBhbnl0aGluZyB3aXRoIGl0LgogICAgICAgICAg\nICByZXR1cm4gbmV3RW50cnkobGVkZ2VySWQsIGVudHJ5SWQsIGVudHJ5KTsK\nICAgICAgICB9CgogICAgICAgIGFzc2VydCBhbGxvYy5nZXREYXRhKCkgIT0g\nbnVsbDsKICAgICAgICBlbnRyeS5nZXQoYWxsb2MuZ2V0RGF0YSgpLCBhbGxv\nYy5nZXRPZmZzZXQoKSwgbGVuKTsKICAgICAgICByZXR1cm4gbmV3IEVudHJ5\nS2V5VmFsdWUobGVkZ2VySWQsIGVudHJ5SWQsIGFsbG9jLmdldERhdGEoKSwg\nYWxsb2MuZ2V0T2Zmc2V0KCksIGxlbik7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGaW5kIHRoZSBlbnRyeSB3aXRoIGdpdmVuIGtleQogICAgICogQHBhcmFt\nIGxlZGdlcklkCiAgICAgKiBAcGFyYW0gZW50cnlJZAogICAgICogQHJldHVy\nbiB0aGUgZW50cnkga3Ygb3IgbnVsbCBpZiBub25lIGZvdW5kLgogICAgICov\nCiAgICBwdWJsaWMgRW50cnlLZXlWYWx1ZSBnZXRFbnRyeShsb25nIGxlZGdl\ncklkLCBsb25nIGVudHJ5SWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgRW50cnlLZXkga2V5ID0gbmV3IEVudHJ5S2V5KGxlZGdlcklkLCBlbnRy\neUlkKTsKICAgICAgICBFbnRyeUtleVZhbHVlIHZhbHVlID0gbnVsbDsKICAg\nICAgICBsb25nIHN0YXJ0VGltZU5hbm9zID0gTWF0aFV0aWxzLm5vd0luTmFu\nbygpOwogICAgICAgIGJvb2xlYW4gc3VjY2VzcyA9IGZhbHNlOwogICAgICAg\nIHRoaXMubG9jay5yZWFkTG9jaygpLmxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICB2YWx1ZSA9IHRoaXMua3ZtYXAuZ2V0KGtleSk7CiAgICAg\nICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB2\nYWx1ZSA9IHRoaXMuc25hcHNob3QuZ2V0KGtleSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc3VjY2VzcyA9IHRydWU7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgdGhpcy5sb2NrLnJlYWRMb2NrKCkudW5sb2NrKCk7\nCiAgICAgICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBn\nZXRFbnRyeVN0YXRzLnJlZ2lzdGVyU3VjY2Vzc2Z1bEV2ZW50KE1hdGhVdGls\ncy5lbGFwc2VkTVNlYyhzdGFydFRpbWVOYW5vcykpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgZ2V0RW50cnlTdGF0cy5yZWdpc3Rl\nckZhaWxlZEV2ZW50KE1hdGhVdGlscy5lbGFwc2VkTVNlYyhzdGFydFRpbWVO\nYW5vcykpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gdmFsdWU7CiAgICB9CgogICAgLyoqCiAgICAgKiBGaW5kIHRoZSBsYXN0\nIGVudHJ5IHdpdGggdGhlIGdpdmVuIGxlZGdlciBrZXkKICAgICAqIEBwYXJh\nbSBsZWRnZXJJZAogICAgICogQHJldHVybiB0aGUgZW50cnkga3Ygb3IgbnVs\nbCBpZiBub25lIGZvdW5kLgogICAgICovCiAgICBwdWJsaWMgRW50cnlLZXlW\nYWx1ZSBnZXRMYXN0RW50cnkobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICBFbnRyeUtleSByZXN1bHQgPSBudWxsOwogICAg\nICAgIEVudHJ5S2V5IGtleSA9IG5ldyBFbnRyeUtleShsZWRnZXJJZCwgTG9u\nZy5NQVhfVkFMVUUpOwogICAgICAgIGxvbmcgc3RhcnRUaW1lTmFub3MgPSBN\nYXRoVXRpbHMubm93SW5OYW5vKCk7CiAgICAgICAgYm9vbGVhbiBzdWNjZXNz\nID0gZmFsc2U7CiAgICAgICAgdGhpcy5sb2NrLnJlYWRMb2NrKCkubG9jaygp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMua3Zt\nYXAuZmxvb3JLZXkoa2V5KTsKICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBu\ndWxsIHx8IHJlc3VsdC5nZXRMZWRnZXJJZCgpICE9IGxlZGdlcklkKSB7CiAg\nICAgICAgICAgICAgICByZXN1bHQgPSB0aGlzLnNuYXBzaG90LmZsb29yS2V5\nKGtleSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3VjY2VzcyA9IHRy\ndWU7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdGhpcy5sb2Nr\nLnJlYWRMb2NrKCkudW5sb2NrKCk7CiAgICAgICAgICAgIGlmIChzdWNjZXNz\nKSB7CiAgICAgICAgICAgICAgICBnZXRFbnRyeVN0YXRzLnJlZ2lzdGVyU3Vj\nY2Vzc2Z1bEV2ZW50KE1hdGhVdGlscy5lbGFwc2VkTVNlYyhzdGFydFRpbWVO\nYW5vcykpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nZ2V0RW50cnlTdGF0cy5yZWdpc3RlckZhaWxlZEV2ZW50KE1hdGhVdGlscy5l\nbGFwc2VkTVNlYyhzdGFydFRpbWVOYW5vcykpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQoKICAgICAgICBpZiAocmVzdWx0ID09IG51bGwgfHwgcmVzdWx0\nLmdldExlZGdlcklkKCkgIT0gbGVkZ2VySWQpIHsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIHJldHVybiAoRW50cnlLZXlW\nYWx1ZSlyZXN1bHQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0\naGUgZW50aXJlIGhlYXAgdXNhZ2UgZm9yIHRoaXMgRW50cnlNZW1UYWJsZSBl\neGNlZWRzIGxpbWl0CiAgICAgKi8KICAgIGJvb2xlYW4gaXNTaXplTGltaXRS\nZWFjaGVkKCkgewogICAgICAgIHJldHVybiBzaXplLmdldCgpID49IHNraXBM\naXN0U2l6ZUxpbWl0OwogICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgaWYg\ndGhlcmUgaXMgZGF0YSBpbiB0aGUgbWVtLXRhYmxlCiAgICAgKiBAcmV0dXJu\nCiAgICAgKi8KICAgIGJvb2xlYW4gaXNFbXB0eSgpIHsKICAgICAgICByZXR1\ncm4gc2l6ZS5nZXQoKSA9PSAwICYmIHNuYXBzaG90LmlzRW1wdHkoKTsKICAg\nIH0KfQo=\n","encoding":"base64"}

