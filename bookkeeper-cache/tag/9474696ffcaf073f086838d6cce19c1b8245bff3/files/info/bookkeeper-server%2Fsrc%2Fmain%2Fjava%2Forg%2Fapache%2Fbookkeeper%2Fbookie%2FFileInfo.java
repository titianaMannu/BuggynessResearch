{"sha":"f96627b1f2d35ba56012ed26710468e2ee037f0e","node_id":"MDQ6QmxvYjE1NzU5NTY6Zjk2NjI3YjFmMmQzNWJhNTYwMTJlZDI2NzEwNDY4ZTJlZTAzN2YwZQ==","size":12329,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f96627b1f2d35ba56012ed26710468e2ee037f0e","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgc3RhdGljIGNvbS5nb29nbGUuY29tbW9uLmJhc2UuQ2hhcnNldHMu\nVVRGXzg7CgppbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5J\nT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsK\naW1wb3J0IGphdmEubmlvLkJ1ZmZlclVuZGVyZmxvd0V4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFu\nbmVscy5GaWxlQ2hhbm5lbDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBj\nb20uZ29vZ2xlLmNvbW1vbi5hbm5vdGF0aW9ucy5WaXNpYmxlRm9yVGVzdGlu\nZzsKCi8qKgogKiBUaGlzIGlzIHRoZSBmaWxlIGhhbmRsZSBmb3IgYSBsZWRn\nZXIncyBpbmRleCBmaWxlIHRoYXQgbWFwcyBlbnRyeSBpZHMgdG8gbG9jYXRp\nb24uCiAqIEl0IGlzIHVzZWQgYnkgTGVkZ2VyQ2FjaGUuCiAqCiAqIDxwPgog\nKiBMZWRnZXIgaW5kZXggZmlsZSBpcyBtYWRlIG9mIGEgaGVhZGVyIGFuZCBz\nZXZlcmFsIGZpeGVkLWxlbmd0aCBpbmRleCBwYWdlcywgd2hpY2ggcmVjb3Jk\ncyB0aGUgb2Zmc2V0cyBvZiBkYXRhIHN0b3JlZCBpbiBlbnRyeSBsb2dnZXJz\nCiAqIDxwcmU+Jmx0O2hlYWRlciZndDsmbHQ7aW5kZXggcGFnZXMmZ3Q7PC9w\ncmU+CiAqIDxiPkhlYWRlcjwvYj4gaXMgZm9ybWF0ZWQgYXMgYmVsb3c6CiAq\nIDxwcmU+Jmx0O21hZ2ljIGJ5dGVzJmd0OyZsdDtsZW4gb2YgbWFzdGVyIGtl\neSZndDsmbHQ7bWFzdGVyIGtleSZndDs8L3ByZT4KICogPHVsPgogKiA8bGk+\nbWFnaWMgYnl0ZXM6IDQgYnl0ZXMsICdCS0xFJywgdmVyc2lvbjogNCBieXRl\ncwogKiA8bGk+bGVuIG9mIG1hc3RlciBrZXk6IGluZGljYXRlcyBsZW5ndGgg\nb2YgbWFzdGVyIGtleS4gLTEgbWVhbnMgbm8gbWFzdGVyIGtleSBzdG9yZWQg\naW4gaGVhZGVyLgogKiA8bGk+bWFzdGVyIGtleTogbWFzdGVyIGtleQogKiA8\nbGk+c3RhdGU6IGJpdCBtYXAgdG8gaW5kaWNhdGUgdGhlIHN0YXRlLCAzMiBi\naXRzLgogKiA8L3VsPgogKiA8Yj5JbmRleCBwYWdlPC9iPiBpcyBhIGZpeGVk\nLWxlbmd0aCBwYWdlLCB3aGljaCBjb250YWlucyBzZXJ2ZXJhbCBlbnRyaWVz\nIHdoaWNoIHBvaW50IHRvIHRoZSBvZmZzZXRzIG9mIGRhdGEgc3RvcmVkIGlu\nIGVudHJ5IGxvZ2dlcnMuCiAqIDwvcD4KICovCmNsYXNzIEZpbGVJbmZvIHsK\nICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihGaWxlSW5mby5jbGFzcyk7CgogICAgc3RhdGlj\nIGZpbmFsIGludCBOT19NQVNURVJfS0VZID0gLTE7CiAgICBzdGF0aWMgZmlu\nYWwgaW50IFNUQVRFX0ZFTkNFRF9CSVQgPSAweDE7CgogICAgcHJpdmF0ZSBG\naWxlQ2hhbm5lbCBmYzsKICAgIHByaXZhdGUgRmlsZSBsZjsKICAgIGJ5dGVb\nXSBtYXN0ZXJLZXk7CgogICAgLyoqCiAgICAgKiBUaGUgZmluZ2VycHJpbnQg\nb2YgYSBsZWRnZXIgaW5kZXggZmlsZQogICAgICovCiAgICBzdGF0aWMgZmlu\nYWwgcHVibGljIGludCBzaWduYXR1cmUgPSBCeXRlQnVmZmVyLndyYXAoIkJL\nTEUiLmdldEJ5dGVzKFVURl84KSkuZ2V0SW50KCk7CiAgICBzdGF0aWMgZmlu\nYWwgcHVibGljIGludCBoZWFkZXJWZXJzaW9uID0gMDsKCiAgICBzdGF0aWMg\nZmluYWwgbG9uZyBTVEFSVF9PRl9EQVRBID0gMTAyNDsKICAgIHByaXZhdGUg\nbG9uZyBzaXplOwogICAgcHJpdmF0ZSBBdG9taWNJbnRlZ2VyIHVzZUNvdW50\nID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICBwcml2YXRlIGJvb2xlYW4g\naXNDbG9zZWQ7CiAgICBwcml2YXRlIGxvbmcgc2l6ZVNpbmNlTGFzdHdyaXRl\nOwoKICAgIC8vIGJpdCBtYXAgZm9yIHN0YXRlcyBvZiB0aGUgbGVkZ2VyLgog\nICAgcHJpdmF0ZSBpbnQgc3RhdGVCaXRzOwogICAgcHJpdmF0ZSBib29sZWFu\nIG5lZWRGbHVzaEhlYWRlciA9IGZhbHNlOwoKICAgIC8vIGZpbGUgYWNjZXNz\nIG1vZGUKICAgIHByb3RlY3RlZCBTdHJpbmcgbW9kZTsKCiAgICBwdWJsaWMg\nRmlsZUluZm8oRmlsZSBsZiwgYnl0ZVtdIG1hc3RlcktleSkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICB0aGlzLmxmID0gbGY7CgogICAgICAgIHRo\naXMubWFzdGVyS2V5ID0gbWFzdGVyS2V5OwogICAgICAgIG1vZGUgPSAicnci\nOwogICAgfQoKICAgIHB1YmxpYyBGaWxlIGdldExmKCkgewogICAgICAgIHJl\ndHVybiBsZjsKICAgIH0KCiAgICBwdWJsaWMgbG9uZyBnZXRTaXplU2luY2VM\nYXN0d3JpdGUoKSB7CiAgICAgICAgcmV0dXJuIHNpemVTaW5jZUxhc3R3cml0\nZTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQgcmVhZEhl\nYWRlcigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxmLmV4\naXN0cygpKSB7CiAgICAgICAgICAgIGlmIChmYyAhPSBudWxsKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUobGYsIG1vZGUpLmdldENoYW5u\nZWwoKTsKICAgICAgICAgICAgc2l6ZSA9IGZjLnNpemUoKTsKICAgICAgICAg\nICAgc2l6ZVNpbmNlTGFzdHdyaXRlID0gc2l6ZTsKCiAgICAgICAgICAgIC8v\nIGF2b2lkIGhhbmcgb24gcmVhZGluZyBwYXJ0aWFsIGluZGV4CiAgICAgICAg\nICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKChpbnQp\nKE1hdGgubWluKHNpemUsIFNUQVJUX09GX0RBVEEpKSk7CiAgICAgICAgICAg\nIHdoaWxlKGJiLmhhc1JlbWFpbmluZygpKSB7CiAgICAgICAgICAgICAgICBm\nYy5yZWFkKGJiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBiYi5mbGlw\nKCk7CiAgICAgICAgICAgIGlmIChiYi5nZXRJbnQoKSAhPSBzaWduYXR1cmUp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiTWlz\nc2luZyBsZWRnZXIgc2lnbmF0dXJlIik7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaW50IHZlcnNpb24gPSBiYi5nZXRJbnQoKTsKICAgICAgICAgICAg\naWYgKHZlcnNpb24gIT0gaGVhZGVyVmVyc2lvbikgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJJbmNvbXBhdGlibGUgbGVkZ2Vy\nIHZlcnNpb24gIiArIHZlcnNpb24pOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGludCBsZW5ndGggPSBiYi5nZXRJbnQoKTsKICAgICAgICAgICAgaWYg\nKGxlbmd0aCA8IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbigiTGVuZ3RoICIgKyBsZW5ndGggKyAiIGlzIGludmFsaWQiKTsK\nICAgICAgICAgICAgfSBlbHNlIGlmIChsZW5ndGggPiBiYi5yZW1haW5pbmco\nKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJ1ZmZlclVuZGVyZmxv\nd0V4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hc3Rl\ncktleSA9IG5ldyBieXRlW2xlbmd0aF07CiAgICAgICAgICAgIGJiLmdldCht\nYXN0ZXJLZXkpOwogICAgICAgICAgICBzdGF0ZUJpdHMgPSBiYi5nZXRJbnQo\nKTsKICAgICAgICAgICAgbmVlZEZsdXNoSGVhZGVyID0gZmFsc2U7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9u\nKCJMZWRnZXIgaW5kZXggZmlsZSBkb2VzIG5vdCBleGlzdCIpOwogICAgICAg\nIH0KICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHJpdmF0ZSB2b2lkIGNoZWNr\nT3Blbihib29sZWFuIGNyZWF0ZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoZmMgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQogICAgICAgIGJvb2xlYW4gZXhpc3RzID0gbGYuZXhpc3RzKCk7\nCiAgICAgICAgaWYgKG1hc3RlcktleSA9PSBudWxsICYmICFleGlzdHMpIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGxmICsgIiBub3Qg\nZm91bmQiKTsKICAgICAgICB9CgogICAgICAgIGlmICghZXhpc3RzKSB7CiAg\nICAgICAgICAgIGlmIChjcmVhdGUpIHsKICAgICAgICAgICAgICAgIC8vIGRl\nbGF5ZWQgdGhlIGNyZWF0aW9uIG9mIHBhcmVudHMgZGlyZWN0b3JpZXMKICAg\nICAgICAgICAgICAgIGNoZWNrUGFyZW50cyhsZik7CiAgICAgICAgICAgICAg\nICBmYyA9IG5ldyBSYW5kb21BY2Nlc3NGaWxlKGxmLCBtb2RlKS5nZXRDaGFu\nbmVsKCk7CiAgICAgICAgICAgICAgICBzaXplID0gZmMuc2l6ZSgpOwogICAg\nICAgICAgICAgICAgaWYgKHNpemUgPT0gMCkgewogICAgICAgICAgICAgICAg\nICAgIHdyaXRlSGVhZGVyKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgcmVhZEhlYWRlcigpOwogICAgICAgICAgICB9IGNhdGNo\nIChCdWZmZXJVbmRlcmZsb3dFeGNlcHRpb24gYnVmKSB7CiAgICAgICAgICAg\nICAgICBMT0cud2FybigiRXhjZXB0aW9uIHdoZW4gcmVhZGluZyBoZWFkZXIg\nb2Yge30gOiB7fSIsIGxmLCBidWYpOwogICAgICAgICAgICAgICAgaWYgKG51\nbGwgIT0gbWFzdGVyS2V5KSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLndh\ncm4oIkF0dGVtcHRpbmcgdG8gd3JpdGUgaGVhZGVyIG9mIHt9IGFnYWluLiIs\nIGxmKTsKICAgICAgICAgICAgICAgICAgICB3cml0ZUhlYWRlcigpOwogICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgSU9FeGNlcHRpb24oIkVycm9yIHJlYWRpbmcgaGVhZGVyICIgKyBs\nZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlSGVhZGVyKCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1\nZmZlci5hbGxvY2F0ZSgoaW50KVNUQVJUX09GX0RBVEEpOwogICAgICAgIGJi\nLnB1dEludChzaWduYXR1cmUpOwogICAgICAgIGJiLnB1dEludChoZWFkZXJW\nZXJzaW9uKTsKICAgICAgICBiYi5wdXRJbnQobWFzdGVyS2V5Lmxlbmd0aCk7\nCiAgICAgICAgYmIucHV0KG1hc3RlcktleSk7CiAgICAgICAgYmIucHV0SW50\nKHN0YXRlQml0cyk7CiAgICAgICAgYmIucmV3aW5kKCk7CiAgICAgICAgZmMu\ncG9zaXRpb24oMCk7CiAgICAgICAgZmMud3JpdGUoYmIpOwogICAgfQoKICAg\nIHN5bmNocm9uaXplZCBwdWJsaWMgYm9vbGVhbiBpc0ZlbmNlZCgpIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tPcGVuKGZhbHNlKTsKICAg\nICAgICByZXR1cm4gKHN0YXRlQml0cyAmIFNUQVRFX0ZFTkNFRF9CSVQpID09\nIFNUQVRFX0ZFTkNFRF9CSVQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgc2V0IGZlbmNlIHN1Y2NlZWQsIG90aGVyd2lzZSBmYWxz\nZSB3aGVuCiAgICAgKiBpdCBhbHJlYWR5IGZlbmNlZCBvciBmYWlsZWQgdG8g\nc2V0IGZlbmNlZC4KICAgICAqLwogICAgc3luY2hyb25pemVkIHB1YmxpYyBi\nb29sZWFuIHNldEZlbmNlZCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgY2hlY2tPcGVuKGZhbHNlKTsKICAgICAgICBMT0cuZGVidWcoIlRyeSB0\nbyBzZXQgZmVuY2VkIHN0YXRlIGluIGZpbGUgaW5mbyB7fSA6IHN0YXRlIGJp\ndHMge30uIiwgbGYsIHN0YXRlQml0cyk7CiAgICAgICAgaWYgKChzdGF0ZUJp\ndHMgJiBTVEFURV9GRU5DRURfQklUKSAhPSBTVEFURV9GRU5DRURfQklUKSB7\nCiAgICAgICAgICAgIC8vIG5vdCBmZW5jZWQgeWV0CiAgICAgICAgICAgIHN0\nYXRlQml0cyB8PSBTVEFURV9GRU5DRURfQklUOwogICAgICAgICAgICBuZWVk\nRmx1c2hIZWFkZXIgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQogICAgfQoKICAgIC8vIGZsdXNoIHRoZSBoZWFkZXIgd2hlbiBo\nZWFkZXIgaXMgY2hhbmdlZAogICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lk\nIGZsdXNoSGVhZGVyKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAobmVlZEZsdXNoSGVhZGVyKSB7CiAgICAgICAgICAgIGNoZWNrT3Blbih0\ncnVlKTsKICAgICAgICAgICAgd3JpdGVIZWFkZXIoKTsKICAgICAgICAgICAg\nbmVlZEZsdXNoSGVhZGVyID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAg\nIHN5bmNocm9uaXplZCBwdWJsaWMgbG9uZyBzaXplKCkgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICBjaGVja09wZW4oZmFsc2UpOwogICAgICAgIGxv\nbmcgcmMgPSBzaXplLVNUQVJUX09GX0RBVEE7CiAgICAgICAgaWYgKHJjIDwg\nMCkgewogICAgICAgICAgICByYyA9IDA7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiByYzsKICAgIH0KCiAgICBwdWJsaWMgaW50IHJlYWQoQnl0ZUJ1ZmZl\nciBiYiwgbG9uZyBwb3NpdGlvbikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gcmVhZEFic29sdXRlKGJiLCBwb3NpdGlvbiArIFNUQVJU\nX09GX0RBVEEpOwogICAgfQoKICAgIHByaXZhdGUgaW50IHJlYWRBYnNvbHV0\nZShCeXRlQnVmZmVyIGJiLCBsb25nIHN0YXJ0KSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGNoZWNrT3BlbihmYWxzZSk7CiAgICAgICAgc3luY2hy\nb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChmYyA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgICAgICBpbnQgdG90YWwgPSAwOwogICAgICAgIGludCByYyA9\nIDA7CiAgICAgICAgd2hpbGUoYmIucmVtYWluaW5nKCkgPiAwKSB7CiAgICAg\nICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAg\ncmMgPSBmYy5yZWFkKGJiLCBzdGFydCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKHJjIDw9IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbigiU2hvcnQgcmVhZCIpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHRvdGFsICs9IHJjOwogICAgICAgICAgICAvLyBzaG91bGQg\nbW92ZSByZWFkIHBvc2l0aW9uCiAgICAgICAgICAgIHN0YXJ0ICs9IHJjOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gdG90YWw7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDbG9zZSBhIGZpbGUgaW5mbwogICAgICoKICAgICAqIEBwYXJh\nbSBmb3JjZQogICAgICogICAgICAgICAgaWYgc2V0IHRvIHRydWUsIHRoZSBp\nbmRleCBpcyBmb3JjZWQgdG8gY3JlYXRlIGJlZm9yZSBjbG9zZWQsCiAgICAg\nKiAgICAgICAgICBpZiBzZXQgdG8gZmFsc2UsIHRoZSBpbmRleCBpcyBub3Qg\nZm9yY2VkIHRvIGNyZWF0ZS4KICAgICAqLwogICAgc3luY2hyb25pemVkIHB1\nYmxpYyB2b2lkIGNsb3NlKGJvb2xlYW4gZm9yY2UpIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgaXNDbG9zZWQgPSB0cnVlOwogICAgICAgIGNoZWNr\nT3Blbihmb3JjZSk7CiAgICAgICAgaWYgKHVzZUNvdW50LmdldCgpID09IDAg\nJiYgZmMgIT0gbnVsbCkgewogICAgICAgICAgICBmYy5jbG9zZSgpOwogICAg\nICAgIH0KICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIGxvbmcgd3Jp\ndGUoQnl0ZUJ1ZmZlcltdIGJ1ZmZzLCBsb25nIHBvc2l0aW9uKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIGNoZWNrT3Blbih0cnVlKTsKICAgICAg\nICBsb25nIHRvdGFsID0gMDsKICAgICAgICB0cnkgewogICAgICAgICAgICBm\nYy5wb3NpdGlvbihwb3NpdGlvbitTVEFSVF9PRl9EQVRBKTsKICAgICAgICAg\nICAgd2hpbGUoYnVmZnNbYnVmZnMubGVuZ3RoLTFdLnJlbWFpbmluZygpID4g\nMCkgewogICAgICAgICAgICAgICAgbG9uZyByYyA9IGZjLndyaXRlKGJ1ZmZz\nKTsKICAgICAgICAgICAgICAgIGlmIChyYyA8PSAwKSB7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJTaG9ydCB3cml0ZSIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdG90YWwgKz0g\ncmM7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBmYy5mb3JjZSh0cnVlKTsKICAgICAgICAgICAgbG9uZyBuZXdzaXpl\nID0gcG9zaXRpb24rU1RBUlRfT0ZfREFUQSt0b3RhbDsKICAgICAgICAgICAg\naWYgKG5ld3NpemUgPiBzaXplKSB7CiAgICAgICAgICAgICAgICBzaXplID0g\nbmV3c2l6ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBzaXpl\nU2luY2VMYXN0d3JpdGUgPSBmYy5zaXplKCk7CiAgICAgICAgcmV0dXJuIHRv\ndGFsOwogICAgfQoKICAgIC8qKgogICAgICogQ29waWVzIGN1cnJlbnQgZmls\nZSBjb250ZW50cyB1cHRvIHNwZWNpZmllZCBzaXplIHRvIHRoZSB0YXJnZXQg\nZmlsZSBhbmQKICAgICAqIGRlbGV0ZXMgdGhlIGN1cnJlbnQgZmlsZS4gSWYg\nc2l6ZSBub3Qga25vd24gdGhlbiBwYXNzIHNpemUgYXMKICAgICAqIExvbmcu\nTUFYX1ZBTFVFIHRvIGNvcHkgY29tcGxldGUgZmlsZS4KICAgICAqLwogICAg\ncHVibGljIHN5bmNocm9uaXplZCB2b2lkIG1vdmVUb05ld0xvY2F0aW9uKEZp\nbGUgbmV3RmlsZSwgbG9uZyBzaXplKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGNoZWNrT3BlbihmYWxzZSk7CiAgICAgICAgLy8gSWYgdGhlIGNo\nYW5uZWwgaXMgbnVsbCwgb3Igc2FtZSBmaWxlIHBhdGgsIGp1c3QgcmV0dXJu\nLgogICAgICAgIGlmIChudWxsID09IGZjIHx8IGlzU2FtZUZpbGUobmV3Rmls\nZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBp\nZiAoc2l6ZSA+IGZjLnNpemUoKSkgewogICAgICAgICAgICBzaXplID0gZmMu\nc2l6ZSgpOwogICAgICAgIH0KICAgICAgICBGaWxlIHJsb2NGaWxlID0gbmV3\nIEZpbGUobmV3RmlsZS5nZXRQYXJlbnRGaWxlKCksIG5ld0ZpbGUuZ2V0TmFt\nZSgpICsgSW5kZXhQZXJzaXN0ZW5jZU1nci5STE9DKTsKICAgICAgICBpZiAo\nIXJsb2NGaWxlLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGNoZWNrUGFyZW50\ncyhybG9jRmlsZSk7CiAgICAgICAgICAgIGlmICghcmxvY0ZpbGUuY3JlYXRl\nTmV3RmlsZSgpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oIkNyZWF0aW5nIG5ldyBjYWNoZSBpbmRleCBmaWxlICIgKyBybG9j\nRmlsZSArICIgZmFpbGVkICIpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIC8vIGNvcHkgY29udGVudHMgZnJvbSBvbGQuaWR4IHRvIG5ldy5p\nZHgucmxvYwogICAgICAgIEZpbGVDaGFubmVsIG5ld0ZjID0gbmV3IFJhbmRv\nbUFjY2Vzc0ZpbGUocmxvY0ZpbGUsICJydyIpLmdldENoYW5uZWwoKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBsb25nIHdyaXR0ZW4gPSAwOwogICAg\nICAgICAgICB3aGlsZSAod3JpdHRlbiA8IHNpemUpIHsKICAgICAgICAgICAg\nICAgIGxvbmcgY291bnQgPSBmYy50cmFuc2ZlclRvKHdyaXR0ZW4sIHNpemUs\nIG5ld0ZjKTsKICAgICAgICAgICAgICAgIGlmIChjb3VudCA8PSAwKSB7CiAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJDb3B5\naW5nIHRvIG5ldyBsb2NhdGlvbiAiICsgcmxvY0ZpbGUgKyAiIGZhaWxlZCIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd3JpdHRlbiAr\nPSBjb3VudDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAod3JpdHRl\nbiA8PSAwICYmIHNpemUgPiAwKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSU9FeGNlcHRpb24oIkNvcHlpbmcgdG8gbmV3IGxvY2F0aW9uICIgKyBy\nbG9jRmlsZSArICIgZmFpbGVkIik7CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBuZXdGYy5mb3JjZSh0cnVlKTsKICAg\nICAgICAgICAgbmV3RmMuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgLy8g\nZGVsZXRlIG9sZC5pZHgKICAgICAgICBmYy5jbG9zZSgpOwogICAgICAgIGlm\nICghZGVsZXRlKCkpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJGYWlsZWQg\ndG8gZGVsZXRlIHRoZSBwcmV2aW91cyBpbmRleCBmaWxlICIgKyBsZik7CiAg\nICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRmFpbGVkIHRvIGRl\nbGV0ZSB0aGUgcHJldmlvdXMgaW5kZXggZmlsZSAiICsgbGYpOwogICAgICAg\nIH0KCiAgICAgICAgLy8gcmVuYW1lIG5ldy5pZHgucmxvYyB0byBuZXcuaWR4\nCiAgICAgICAgaWYgKCFybG9jRmlsZS5yZW5hbWVUbyhuZXdGaWxlKSkgewog\nICAgICAgICAgICBMT0cuZXJyb3IoIkZhaWxlZCB0byByZW5hbWUgIiArIHJs\nb2NGaWxlICsgIiB0byAiICsgbmV3RmlsZSk7CiAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbigiRmFpbGVkIHRvIHJlbmFtZSAiICsgcmxvY0Zp\nbGUgKyAiIHRvICIgKyBuZXdGaWxlKTsKICAgICAgICB9CiAgICAgICAgZmMg\nPSBuZXcgUmFuZG9tQWNjZXNzRmlsZShuZXdGaWxlLCBtb2RlKS5nZXRDaGFu\nbmVsKCk7CiAgICAgICAgbGYgPSBuZXdGaWxlOwogICAgfQoKICAgIHN5bmNo\ncm9uaXplZCBwdWJsaWMgYnl0ZVtdIGdldE1hc3RlcktleSgpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tPcGVuKGZhbHNlKTsKICAgICAg\nICByZXR1cm4gbWFzdGVyS2V5OwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVz\nZSgpIHsKICAgICAgICB1c2VDb3VudC5pbmNyZW1lbnRBbmRHZXQoKTsKICAg\nIH0KCiAgICBAVmlzaWJsZUZvclRlc3RpbmcKICAgIGludCBnZXRVc2VDb3Vu\ndCgpIHsKICAgICAgICByZXR1cm4gdXNlQ291bnQuZ2V0KCk7CiAgICB9Cgog\nICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHJlbGVhc2UoKSB7CiAgICAg\nICAgaW50IGNvdW50ID0gdXNlQ291bnQuZGVjcmVtZW50QW5kR2V0KCk7CiAg\nICAgICAgaWYgKGlzQ2xvc2VkICYmIChjb3VudCA9PSAwKSAmJiBmYyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBmYy5j\nbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGNsb3NpbmcgZmls\nZSBjaGFubmVsIiwgZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gZGVsZXRlKCkgewogICAgICAgIHJldHVy\nbiBsZi5kZWxldGUoKTsKICAgIH0KCiAgICBzdGF0aWMgZmluYWwgcHJpdmF0\nZSB2b2lkIGNoZWNrUGFyZW50cyhGaWxlIGYpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgRmlsZSBwYXJlbnQgPSBmLmdldFBhcmVudEZpbGUoKTsK\nICAgICAgICBpZiAocGFyZW50LmV4aXN0cygpKSB7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcmVudC5ta2RpcnMoKSA9\nPSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24o\nIkNvdW5sZG4ndCBta2RpcnMgZm9yICIgKyBwYXJlbnQpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1NhbWVGaWxlKEZpbGUgZikg\newogICAgICAgIHJldHVybiB0aGlzLmxmLmVxdWFscyhmKTsKICAgIH0KfQo=\n","encoding":"base64"}

