{"sha":"f6ec59c9bfcee8fd3e9365d0ad58fd79e9e52fa2","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjZlYzU5YzliZmNlZThmZDNlOTM2NWQwYWQ1OGZkNzllOWU1MmZhMg==","size":15630,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f6ec59c9bfcee8fd3e9365d0ad58fd79e9e52fa2","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLkJvb2tLZWVwZXJD\nb25zdGFudHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5I\nYXJkTGluazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9u\naW5nLlZlcnNpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudmVy\nc2lvbmluZy5WZXJzaW9uZWQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25z\nLmlvLkZpbGVVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGku\nQmFzaWNQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9w\ndGlvbnM7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkNvbW1hbmRM\naW5lOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5IZWxwRm9ybWF0\ndGVyOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9y\ndCBqYXZhLmlvLkZpbGVuYW1lRmlsdGVyOwppbXBvcnQgamF2YS5pby5JT0V4\nY2VwdGlvbjsKCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERv\nd25MYXRjaDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0\nOwoKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5TY2FubmVyOwppbXBvcnQg\namF2YS51dGlsLk5vU3VjaEVsZW1lbnRFeGNlcHRpb247CgppbXBvcnQgamF2\nYS5uZXQuTWFsZm9ybWVkVVJMRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5jb25maWd1cmF0aW9uLkNvbmZpZ3VyYXRp\nb25FeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9v\nS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKCmlt\ncG9ydCBzdGF0aWMgY29tLmdvb2dsZS5jb21tb24uYmFzZS5DaGFyc2V0cy5V\nVEZfODsKCi8qKgogKiBBcHBsaWNhdGlvbiBmb3IgdXBncmFkaW5nIHRoZSBi\nb29ra2VlcGVyIGZpbGVzeXN0ZW0KICogYmV0d2VlbiB2ZXJzaW9ucwogKi8K\ncHVibGljIGNsYXNzIEZpbGVTeXN0ZW1VcGdyYWRlIHsKICAgIHByaXZhdGUg\nZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihGaWxlU3lzdGVtVXBncmFkZS5jbGFzcyk7CgogICAgc3RhdGljIEZp\nbGVuYW1lRmlsdGVyIEJPT0tJRV9GSUxFU19GSUxURVIgPSBuZXcgRmlsZW5h\nbWVGaWx0ZXIoKSB7CiAgICAgICAgICAgIHByaXZhdGUgYm9vbGVhbiBjb250\nYWluc0luZGV4RmlsZXMoRmlsZSBkaXIsIFN0cmluZyBuYW1lKSB7CiAgICAg\nICAgICAgICAgICBpZiAobmFtZS5lbmRzV2l0aCgiLmlkeCIpKSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBM\nb25nLnBhcnNlTG9uZyhuYW1lLCAxNik7CiAgICAgICAgICAgICAgICAgICAg\nRmlsZSBkID0gbmV3IEZpbGUoZGlyLCBuYW1lKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAoZC5pc0RpcmVjdG9yeSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIFN0cmluZ1tdIGZpbGVzID0gZC5saXN0KCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGZvciAoU3RyaW5nIGYgOiBmaWxlcykgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5zSW5kZXhGaWxlcyhk\nLCBmKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0aW9uIG5m\nZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gYWNjZXB0\nKEZpbGUgZGlyLCBTdHJpbmcgbmFtZSkgewogICAgICAgICAgICAgICAgaWYg\nKG5hbWUuZW5kc1dpdGgoIi50eG4iKSB8fCBuYW1lLmVuZHNXaXRoKCIubG9n\nIikKICAgICAgICAgICAgICAgICAgICB8fCBuYW1lLmVxdWFscygibGFzdElk\nIikgfHwgbmFtZS5lcXVhbHMoImxhc3RNYXJrIikpIHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGlmIChjb250YWluc0luZGV4RmlsZXMoZGlyLCBuYW1lKSkg\newogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9CiAgICAgICAgfTsKCiAgICBwcml2YXRlIHN0YXRpYyBMaXN0PEZp\nbGU+IGdldEFsbERpcmVjdG9yaWVzKFNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZikgewogICAgICAgIExpc3Q8RmlsZT4gZGlycyA9IG5ldyBBcnJheUxpc3Q8\nRmlsZT4oKTsKICAgICAgICBkaXJzLmFkZChjb25mLmdldEpvdXJuYWxEaXIo\nKSk7CiAgICAgICAgZm9yIChGaWxlIGQ6IGNvbmYuZ2V0TGVkZ2VyRGlycygp\nKSB7CiAgICAgICAgICAgIGRpcnMuYWRkKGQpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gZGlyczsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBpbnQg\nZGV0ZWN0UHJldmlvdXNWZXJzaW9uKEZpbGUgZGlyZWN0b3J5KSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIFN0cmluZ1tdIGZpbGVzID0gZGlyZWN0\nb3J5Lmxpc3QoQk9PS0lFX0ZJTEVTX0ZJTFRFUik7CiAgICAgICAgRmlsZSB2\nMnZlcnNpb25GaWxlID0gbmV3IEZpbGUoZGlyZWN0b3J5LAogICAgICAgICAg\nICAgICAgQm9va0tlZXBlckNvbnN0YW50cy5WRVJTSU9OX0ZJTEVOQU1FKTsK\nICAgICAgICBpZiAoZmlsZXMubGVuZ3RoID09IDAgJiYgIXYydmVyc2lvbkZp\nbGUuZXhpc3RzKCkpIHsgLy8gbm8gb2xkIGRhdGEsIHNvIHdlJ3JlIG9rCiAg\nICAgICAgICAgIHJldHVybiBDb29raWUuQ1VSUkVOVF9DT09LSUVfTEFZT1VU\nX1ZFUlNJT047CiAgICAgICAgfQoKICAgICAgICBpZiAoIXYydmVyc2lvbkZp\nbGUuZXhpc3RzKCkpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAg\nfQogICAgICAgIFNjYW5uZXIgcyA9IG5ldyBTY2FubmVyKHYydmVyc2lvbkZp\nbGUsIFVURl84Lm5hbWUoKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncmV0dXJuIHMubmV4dEludCgpOwogICAgICAgIH0gY2F0Y2ggKE5vU3VjaEVs\nZW1lbnRFeGNlcHRpb24gbnNlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nQ291bGRuJ3QgcGFyc2UgdmVyc2lvbiBmaWxlICIgKyB2MnZlcnNpb25GaWxl\nICwgbnNlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJD\nb3VsZG4ndCBwYXJzZSB2ZXJzaW9uIGZpbGUiLCBuc2UpOwogICAgICAgIH0g\nY2F0Y2ggKElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBpc2UpIHsKICAgICAgICAg\nICAgTE9HLmVycm9yKCJFcnJvciByZWFkaW5nIGZpbGUgIiArIHYydmVyc2lv\nbkZpbGUsIGlzZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbigiRXJyb3IgcmVhZGluZyB2ZXJzaW9uIGZpbGUiLCBpc2UpOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHMuY2xvc2UoKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgWm9vS2VlcGVyIG5ld1pvb2tl\nZXBlcihmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAg\nICAgIHRocm93cyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbiB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0\nY2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgICAg\nIFpvb0tlZXBlciB6ayA9IG5ldyBab29LZWVwZXIoY29uZi5nZXRaa1NlcnZl\ncnMoKSwgY29uZi5nZXRaa1RpbWVvdXQoKSwKICAgICAgICAgICAgICAgICAg\nICBuZXcgV2F0Y2hlcigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBy\nb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBoYW5kbGUgc2Vzc2lvbiBkaXNjb25uZWN0cyBhbmQg\nZXhwaXJlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50\nLmdldFN0YXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUu\nU3luY0Nvbm5lY3RlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoIWxhdGNoLmF3YWl0KGNv\nbmYuZ2V0WmtUaW1lb3V0KCkqMiwgVGltZVVuaXQuTUlMTElTRUNPTkRTKSkg\newogICAgICAgICAgICAgICAgemsuY2xvc2UoKTsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbigi\nQ291bGRuJ3QgY29ubmVjdCB0byB6b29rZWVwZXIiKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gems7CiAgICAgICAgfSBjYXRjaCAoSW50\nZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGllKTsKICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGlvZSk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZvaWQgbGlu\na0luZGV4RGlyZWN0b3JpZXMoRmlsZSBzcmNQYXRoLCBGaWxlIHRhcmdldFBh\ndGgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nW10gZmls\nZXMgPSBzcmNQYXRoLmxpc3QoKTsKCiAgICAgICAgZm9yIChTdHJpbmcgZiA6\nIGZpbGVzKSB7CiAgICAgICAgICAgIGlmIChmLmVuZHNXaXRoKCIuaWR4Iikp\nIHsgLy8gdGhpcyBpcyBhbiBpbmRleCBkaXIsIGNyZWF0ZSB0aGUgbGlua3MK\nICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0UGF0aC5ta2RpcnMoKSkgewog\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiQ291\nbGQgbm90IGNyZWF0ZSB0YXJnZXQgcGF0aCBbIit0YXJnZXRQYXRoKyJdIik7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBIYXJkTGluay5j\ncmVhdGVIYXJkTGlua011bHQoc3JjUGF0aCwgZmlsZXMsIHRhcmdldFBhdGgp\nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIEZpbGUgbmV3U3JjUGF0aCA9IG5ldyBGaWxlKHNyY1BhdGgsIGYp\nOwogICAgICAgICAgICBpZiAobmV3U3JjUGF0aC5pc0RpcmVjdG9yeSgpKSB7\nCiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIExv\nbmcucGFyc2VMb25nKGYsIDE2KTsKICAgICAgICAgICAgICAgICAgICBsaW5r\nSW5kZXhEaXJlY3RvcmllcyhuZXdTcmNQYXRoLCBuZXcgRmlsZSh0YXJnZXRQ\nYXRoLCBmKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChOdW1iZXJGb3Jt\nYXRFeGNlcHRpb24gbmZlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZmls\nZW5hbWUgZG9lcyBub3QgcGFyc2UgdG8gYSBoZXggTG9uZywgc28KICAgICAg\nICAgICAgICAgICAgICAvLyBpdCB3aWxsIG5vdCBjb250YWluIGlkeCBmaWxl\ncy4gSWdub3JpbmcKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgdXBncmFk\nZShTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAgICAgIHRocm93\ncyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbiwgSW50ZXJydXB0\nZWRFeGNlcHRpb24gewogICAgICAgIExPRy5pbmZvKCJVcGdyYWRpbmcuLi4i\nKTsKCiAgICAgICAgWm9vS2VlcGVyIHprID0gbmV3Wm9va2VlcGVyKGNvbmYp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE1hcDxGaWxlLEZpbGU+IGRl\nZmVycmVkTW92ZXMgPSBuZXcgSGFzaE1hcDxGaWxlLCBGaWxlPigpOwogICAg\nICAgICAgICBDb29raWUuQnVpbGRlciBjb29raWVCdWlsZGVyID0gQ29va2ll\nLmdlbmVyYXRlQ29va2llKGNvbmYpOwogICAgICAgICAgICBDb29raWUgYyA9\nIGNvb2tpZUJ1aWxkZXIuYnVpbGQoKTsKICAgICAgICAgICAgZm9yIChGaWxl\nIGQgOiBnZXRBbGxEaXJlY3Rvcmllcyhjb25mKSkgewogICAgICAgICAgICAg\nICAgTE9HLmluZm8oIlVwZ3JhZGluZyB7fSIsIGQpOwogICAgICAgICAgICAg\nICAgaW50IHZlcnNpb24gPSBkZXRlY3RQcmV2aW91c1ZlcnNpb24oZCk7CiAg\nICAgICAgICAgICAgICBpZiAodmVyc2lvbiA9PSBDb29raWUuQ1VSUkVOVF9D\nT09LSUVfTEFZT1VUX1ZFUlNJT04pIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiRGlyZWN0b3J5IGlzIGN1cnJlbnQsIG5vIG5lZWQgdG8gdXBn\ncmFkZSIpOwogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBGaWxlIGN1ckRpciA9IG5ldyBGaWxlKGQsIEJvb2tLZWVwZXJD\nb25zdGFudHMuQ1VSUkVOVF9ESVIpOwogICAgICAgICAgICAgICAgICAgIEZp\nbGUgdG1wRGlyID0gbmV3IEZpbGUoZCwgInVwZ3JhZGVUbXAuIiArIFN5c3Rl\nbS5uYW5vVGltZSgpKTsKICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZE1v\ndmVzLnB1dChjdXJEaXIsIHRtcERpcik7CiAgICAgICAgICAgICAgICAgICAg\naWYgKCF0bXBEaXIubWtkaXJzKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9u\nKCJDb3VsZCBub3QgY3JlYXRlIHRlbXBvcmFyeSBkaXJlY3RvcnkgIiArIHRt\ncERpcik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGMud3JpdGVUb0RpcmVjdG9yeSh0bXBEaXIpOwoKICAgICAgICAgICAg\nICAgICAgICBTdHJpbmdbXSBmaWxlcyA9IGQubGlzdChuZXcgRmlsZW5hbWVG\naWx0ZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBhY2NlcHQoRmlsZSBkaXIsIFN0cmluZyBuYW1lKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEJPT0tJRV9GSUxF\nU19GSUxURVIuYWNjZXB0KGRpciwgbmFtZSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgJiYgIShuZXcgRmlsZShkaXIsIG5hbWUpLmlz\nRGlyZWN0b3J5KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAg\nICBIYXJkTGluay5jcmVhdGVIYXJkTGlua011bHQoZCwgZmlsZXMsIHRtcERp\ncik7CgogICAgICAgICAgICAgICAgICAgIGxpbmtJbmRleERpcmVjdG9yaWVz\nKGQsIHRtcERpcik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2Vw\ndGlvbiBpb2UpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVy\ncm9yIHVwZ3JhZGluZyB7fSIsIGQpOwogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbihpb2Up\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBmb3IgKE1hcC5FbnRyeTxGaWxlLEZpbGU+IGUgOiBkZWZlcnJlZE1vdmVz\nLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgRmlsZVV0aWxzLm1vdmVEaXJlY3RvcnkoZS5nZXRWYWx1\nZSgpLCBlLmdldEtleSgpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElP\nRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBl\ncnIgPSBTdHJpbmcuZm9ybWF0KCJFcnJvciBtb3ZpbmcgdXBncmFkZWQgZGly\nZWN0b3JpZXMgaW50byBwbGFjZSAlcyAtPiAlcyAiLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuZ2V0VmFsdWUo\nKSwgZS5nZXRLZXkoKSk7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKGVyciwgaW9lKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQm9v\na2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24oaW9lKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGRlZmVy\ncmVkTW92ZXMuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBjLndyaXRlVG9ab29LZWVwZXIoemssIGNvbmYsIFZlcnNpb24uTkVX\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7\nCiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHdyaXRpbmcgY29v\na2llIHRvIHpvb2tlZXBlciIpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGtlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVF\neGNlcHRpb24oaW9lKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICB6ay5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBMT0cuaW5mbygiRG9u\nZSIpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBmaW5hbGl6ZVVw\nZ3JhZGUoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAgICB0\naHJvd3MgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24sIEludGVy\ncnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiRmluYWxpemlu\nZyB1cGdyYWRlLi4uIik7CiAgICAgICAgLy8gdmVyaWZ5IHRoYXQgdXBncmFk\nZSBpcyBjb3JyZWN0CiAgICAgICAgZm9yIChGaWxlIGQgOiBnZXRBbGxEaXJl\nY3Rvcmllcyhjb25mKSkgewogICAgICAgICAgICBMT0cuaW5mbygiRmluYWxp\nemluZyB7fSIsIGQpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgaW50IHZlcnNpb24gPSBkZXRlY3RQcmV2aW91c1ZlcnNpb24oZCk7CiAg\nICAgICAgICAgICAgICBpZiAodmVyc2lvbiA8IDMpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAodmVyc2lvbiA9PSAyKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIEZpbGUgdjJ2ZXJzaW9uRmlsZSA9IG5ldyBGaWxlKGQsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9va0tlZXBlckNvbnN0YW50\ncy5WRVJTSU9OX0ZJTEVOQU1FKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKCF2MnZlcnNpb25GaWxlLmRlbGV0ZSgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cud2FybigiQ291bGQgbm90IGRlbGV0ZSBvbGQg\ndmVyc2lvbiBmaWxlIHt9IiwgdjJ2ZXJzaW9uRmlsZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgRmlsZVtdIGZpbGVzID0gZC5saXN0RmlsZXMoQk9PS0lF\nX0ZJTEVTX0ZJTFRFUik7CiAgICAgICAgICAgICAgICAgICAgZm9yIChGaWxl\nIGYgOiBmaWxlcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5p\nc0RpcmVjdG9yeSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBG\naWxlVXRpbHMuZGVsZXRlRGlyZWN0b3J5KGYpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9IGVsc2V7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoIWYuZGVsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMT0cud2FybigiQ291bGQgbm90IGRlbGV0ZSB7fSIsIGYpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAg\nICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgZmluYWxpemluZyB7fSIs\nIGQpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlv\nbi5VcGdyYWRlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgLy8gbm9vcCBhdCB0aGUgbW9tZW50CiAgICAgICAgTE9H\nLmluZm8oIkRvbmUiKTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIHZvaWQg\ncm9sbGJhY2soU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAg\nICB0aHJvd3MgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24sIElu\ndGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygiUm9sbGlu\nZyBiYWNrIHVwZ3JhZGUuLi4iKTsKICAgICAgICBab29LZWVwZXIgemsgPSBu\nZXdab29rZWVwZXIoY29uZik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nZm9yIChGaWxlIGQgOiBnZXRBbGxEaXJlY3Rvcmllcyhjb25mKSkgewogICAg\nICAgICAgICAgICAgTE9HLmluZm8oIlJvbGxpbmcgYmFjayB7fSIsIGQpOwog\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAvLyBl\nbnN1cmUgdGhlcmUgaXMgYSBwcmV2aW91cyB2ZXJzaW9uIGJlZm9yZSByb2xs\nYmFjawogICAgICAgICAgICAgICAgICAgIGludCB2ZXJzaW9uID0gZGV0ZWN0\nUHJldmlvdXNWZXJzaW9uKGQpOwoKICAgICAgICAgICAgICAgICAgICBpZiAo\ndmVyc2lvbiA8PSBDb29raWUuQ1VSUkVOVF9DT09LSUVfTEFZT1VUX1ZFUlNJ\nT04pIHsKICAgICAgICAgICAgICAgICAgICAgICAgRmlsZSBjdXJEaXIgPSBu\nZXcgRmlsZShkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJv\nb2tLZWVwZXJDb25zdGFudHMuQ1VSUkVOVF9ESVIpOwogICAgICAgICAgICAg\nICAgICAgICAgICBGaWxlVXRpbHMuZGVsZXRlRGlyZWN0b3J5KGN1ckRpcik7\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDYW5u\nb3Qgcm9sbGJhY2sgYXMgcHJldmlvdXMgZGF0YSBkb2VzIG5vdCBleGlzdCIp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiRXJyb3Igcm9sbGluZyBiYWNrIHt9IiwgZCk7CiAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRl\nRXhjZXB0aW9uKGlvZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFZlcnNpb25l\nZDxDb29raWU+IGNvb2tpZSA9IENvb2tpZS5yZWFkRnJvbVpvb0tlZXBlcih6\naywgY29uZik7CiAgICAgICAgICAgICAgICBjb29raWUuZ2V0VmFsdWUoKS5k\nZWxldGVGcm9tWm9vS2VlcGVyKHprLCBjb25mLCBjb29raWUuZ2V0VmVyc2lv\nbigpKTsKICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGRlbGV0aW5n\nIGNvb2tpZSBmcm9tIFpvb0tlZXBlciIpOwogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGtlKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIkkvTyBFcnJvciBkZWxldGluZyBjb29r\naWUgZnJvbSBab29LZWVwZXIiKTsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbihpb2UpOwogICAg\nICAgICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgemsu\nY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oIkRvbmUiKTsK\nICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHByaW50SGVscChPcHRp\nb25zIG9wdHMpIHsKICAgICAgICBIZWxwRm9ybWF0dGVyIGhmID0gbmV3IEhl\nbHBGb3JtYXR0ZXIoKTsKICAgICAgICBoZi5wcmludEhlbHAoIkZpbGVTeXN0\nZW1VcGdyYWRlIFtvcHRpb25zXSIsIG9wdHMpOwogICAgfQoKICAgIHB1Ymxp\nYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIG9yZy5hcGFjaGUubG9nNGouTG9nZ2VyIHJvb3Qg\nPSBvcmcuYXBhY2hlLmxvZzRqLkxvZ2dlci5nZXRSb290TG9nZ2VyKCk7CiAg\nICAgICAgcm9vdC5hZGRBcHBlbmRlcihuZXcgb3JnLmFwYWNoZS5sb2c0ai5D\nb25zb2xlQXBwZW5kZXIoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG5ldyBvcmcuYXBhY2hlLmxvZzRqLlBhdHRlcm5MYXlvdXQoIiUtNXAg\nWyV0XTogJW0lbiIpKSk7CiAgICAgICAgcm9vdC5zZXRMZXZlbChvcmcuYXBh\nY2hlLmxvZzRqLkxldmVsLkVSUk9SKTsKICAgICAgICBvcmcuYXBhY2hlLmxv\nZzRqLkxvZ2dlci5nZXRMb2dnZXIoRmlsZVN5c3RlbVVwZ3JhZGUuY2xhc3Mp\nLnNldExldmVsKAogICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5sb2c0ai5M\nZXZlbC5JTkZPKTsKCiAgICAgICAgZmluYWwgT3B0aW9ucyBvcHRzID0gbmV3\nIE9wdGlvbnMoKTsKICAgICAgICBvcHRzLmFkZE9wdGlvbigiYyIsICJjb25m\nIiwgdHJ1ZSwgIkNvbmZpZ3VyYXRpb24gZm9yIEJvb2tpZSIpOwogICAgICAg\nIG9wdHMuYWRkT3B0aW9uKCJ1IiwgInVwZ3JhZGUiLCBmYWxzZSwgIlVwZ3Jh\nZGUgYm9va2llIGRpcmVjdG9yaWVzIik7CiAgICAgICAgb3B0cy5hZGRPcHRp\nb24oImYiLCAiZmluYWxpemUiLCBmYWxzZSwgIkZpbmFsaXplIHVwZ3JhZGUi\nKTsKICAgICAgICBvcHRzLmFkZE9wdGlvbigiciIsICJyb2xsYmFjayIsIGZh\nbHNlLCAiUm9sbGJhY2sgdXBncmFkZSIpOwogICAgICAgIG9wdHMuYWRkT3B0\naW9uKCJoIiwgImhlbHAiLCBmYWxzZSwgIlByaW50IGhlbHAgbWVzc2FnZSIp\nOwoKICAgICAgICBCYXNpY1BhcnNlciBwYXJzZXIgPSBuZXcgQmFzaWNQYXJz\nZXIoKTsKICAgICAgICBDb21tYW5kTGluZSBjbWRMaW5lID0gcGFyc2VyLnBh\ncnNlKG9wdHMsIGFyZ3MpOwogICAgICAgIGlmIChjbWRMaW5lLmhhc09wdGlv\nbigiaCIpKSB7CiAgICAgICAgICAgIHByaW50SGVscChvcHRzKTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFjbWRMaW5l\nLmhhc09wdGlvbigiYyIpKSB7CiAgICAgICAgICAgIFN0cmluZyBlcnIgPSAi\nQ2Fubm90IHVwZ3JhZGUgd2l0aG91dCBjb25maWd1cmF0aW9uIjsKICAgICAg\nICAgICAgTE9HLmVycm9yKGVycik7CiAgICAgICAgICAgIHByaW50SGVscChv\ncHRzKTsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbihlcnIpOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGNvbmZG\naWxlID0gY21kTGluZS5nZXRPcHRpb25WYWx1ZSgiYyIpOwogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uZi5sb2FkQ29u\nZihuZXcgRmlsZShjb25mRmlsZSkudG9VUkkoKS50b1VSTCgpKTsKICAgICAg\nICB9IGNhdGNoIChNYWxmb3JtZWRVUkxFeGNlcHRpb24gbXVlKSB7CiAgICAg\nICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IG9wZW4gY29uZmlndXJhdGlv\nbiBmaWxlICIgKyBjb25mRmlsZSwgbXVlKTsKICAgICAgICAgICAgdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAgIH0gY2F0\nY2ggKENvbmZpZ3VyYXRpb25FeGNlcHRpb24gY2UpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJJbnZhbGlkIGNvbmZpZ3VyYXRpb24gZmlsZSAiICsgY29u\nZkZpbGUsIGNlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbigpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNtZExp\nbmUuaGFzT3B0aW9uKCJ1IikpIHsKICAgICAgICAgICAgdXBncmFkZShjb25m\nKTsKICAgICAgICB9IGVsc2UgaWYgKGNtZExpbmUuaGFzT3B0aW9uKCJyIikp\nIHsKICAgICAgICAgICAgcm9sbGJhY2soY29uZik7CiAgICAgICAgfSBlbHNl\nIGlmIChjbWRMaW5lLmhhc09wdGlvbigiZiIpKSB7CiAgICAgICAgICAgIGZp\nbmFsaXplVXBncmFkZShjb25mKTsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBTdHJpbmcgZXJyID0gIk11c3Qgc3BlY2lmeSAtdXBncmFkZSwgLWZp\nbmFsaXplIG9yIC1yb2xsYmFjayI7CiAgICAgICAgICAgIExPRy5lcnJvcihl\ncnIpOwogICAgICAgICAgICBwcmludEhlbHAob3B0cyk7CiAgICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oZXJyKTsKICAg\nICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

