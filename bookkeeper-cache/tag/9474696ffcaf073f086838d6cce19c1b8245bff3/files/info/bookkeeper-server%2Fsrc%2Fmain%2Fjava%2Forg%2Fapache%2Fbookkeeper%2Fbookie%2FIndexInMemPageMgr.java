{"sha":"454a38335c8fb3ddaca268ece564c6ae171fef1f","node_id":"MDQ6QmxvYjE1NzU5NTY6NDU0YTM4MzM1YzhmYjNkZGFjYTI2OGVjZTU2NGM2YWUxNzFmZWYxZg==","size":20712,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/454a38335c8fb3ddaca268ece564c6ae171fef1f","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5H\nYXVnZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5TdGF0\nc0xvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0\naW9uOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoTWFwOwppbXBvcnQgamF2YS51\ndGlsLkxpbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50TGlua2VkUXVldWU7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50TWFwOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudFNraXBMaXN0\nU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21p\nY0ludGVnZXI7CgppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuQm9va0tlZXBlclNlcnZlclN0YXRzLk5VTV9JTkRFWF9QQUdF\nUzsKCmNsYXNzIEluZGV4SW5NZW1QYWdlTWdyIHsKICAgIHByaXZhdGUgZmlu\nYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihJbmRleEluTWVtUGFnZU1nci5jbGFzcyk7CiAgICBwcml2YXRlIGZpbmFs\nIHN0YXRpYyBDb25jdXJyZW50SGFzaE1hcDxMb25nLCBMZWRnZXJFbnRyeVBh\nZ2U+IEVNUFRZX1BBR0VfTUFQCiAgICAgICAgPSBuZXcgQ29uY3VycmVudEhh\nc2hNYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdlPigpOwoKICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIEluTWVtUGFnZUNvbGxlY3Rpb24gaW1wbGVtZW50cyBM\nRVBTdGF0ZUNoYW5nZUNhbGxiYWNrIHsKCiAgICAgICAgQ29uY3VycmVudE1h\ncDxMb25nLCBDb25jdXJyZW50TWFwPExvbmcsTGVkZ2VyRW50cnlQYWdlPj4g\ncGFnZXM7CgogICAgICAgIE1hcDxFbnRyeUtleSwgTGVkZ2VyRW50cnlQYWdl\nPiBscnVDbGVhblBhZ2VNYXA7CgogICAgICAgIHB1YmxpYyBJbk1lbVBhZ2VD\nb2xsZWN0aW9uKCkgewogICAgICAgICAgICBwYWdlcyA9IG5ldyBDb25jdXJy\nZW50SGFzaE1hcDxMb25nLCBDb25jdXJyZW50TWFwPExvbmcsTGVkZ2VyRW50\ncnlQYWdlPj4oKTsKICAgICAgICAgICAgbHJ1Q2xlYW5QYWdlTWFwID0KICAg\nICAgICAgICAgICAgIENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1hcChuZXcg\nTGlua2VkSGFzaE1hcDxFbnRyeUtleSwgTGVkZ2VyRW50cnlQYWdlPigxNiwg\nMC43NWYsIHRydWUpKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAg\nICAqIFJldHJpZXZlIHRoZSBMZWRnZXJFbnRyeVBhZ2UgY29ycmVzcG9uZGlu\nZyB0byB0aGUgbGVkZ2VyIGFuZCBmaXJzdEVudHJ5CiAgICAgICAgICoKICAg\nICAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAgICAgKiAgICAgICAgICBM\nZWRnZXIgaWQKICAgICAgICAgKiBAcGFyYW0gZmlyc3RFbnRyeQogICAgICAg\nICAqICAgICAgICAgIElkIG9mIHRoZSBmaXJzdCBlbnRyeSBpbiB0aGUgcGFn\nZQogICAgICAgICAqIEByZXR1cm5zIExlZGdlckVudHJ5UGFnZSBpZiBwcmVz\nZW50CiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBMZWRnZXJFbnRyeVBh\nZ2UgZ2V0UGFnZShsb25nIGxlZGdlcklkLCBsb25nIGZpcnN0RW50cnkpIHsK\nICAgICAgICAgICAgQ29uY3VycmVudE1hcDxMb25nLCBMZWRnZXJFbnRyeVBh\nZ2U+IG1hcCA9IHBhZ2VzLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgIGlm\nIChudWxsICE9IG1hcCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG1hcC5n\nZXQoZmlyc3RFbnRyeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBB\nZGQgYSBMZWRnZXJFbnRyeVBhZ2UgdG8gdGhlIHBhZ2UgbWFwCiAgICAgICAg\nICoKICAgICAgICAgKiBAcGFyYW0gbGVwCiAgICAgICAgICogICAgICAgICAg\nTGVkZ2VyIEVudHJ5IFBhZ2Ugb2JqZWN0CiAgICAgICAgICovCiAgICAgICAg\ncHJpdmF0ZSBMZWRnZXJFbnRyeVBhZ2UgcHV0UGFnZShMZWRnZXJFbnRyeVBh\nZ2UgbGVwKSB7CiAgICAgICAgICAgIC8vIERvIGEgZ2V0IGhlcmUgdG8gYXZv\naWQgdG9vIG1hbnkgbmV3IENvbmN1cnJlbnRIYXNoTWFwcygpIGFzIHB1dElu\ndG9UYWJsZSBpcyBjYWxsZWQgZnJlcXVlbnRseS4KICAgICAgICAgICAgQ29u\nY3VycmVudE1hcDxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+IG1hcCA9IHBhZ2Vz\nLmdldChsZXAuZ2V0TGVkZ2VyKCkpOwogICAgICAgICAgICBpZiAobnVsbCA9\nPSBtYXApIHsKICAgICAgICAgICAgICAgIENvbmN1cnJlbnRNYXA8TG9uZywg\nTGVkZ2VyRW50cnlQYWdlPiBtYXBUb1B1dCA9IG5ldyBDb25jdXJyZW50SGFz\naE1hcDxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+KCk7CiAgICAgICAgICAgICAg\nICBtYXAgPSBwYWdlcy5wdXRJZkFic2VudChsZXAuZ2V0TGVkZ2VyKCksIG1h\ncFRvUHV0KTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IG1hcCkgewog\nICAgICAgICAgICAgICAgICAgIG1hcCA9IG1hcFRvUHV0OwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIExlZGdlckVudHJ5\nUGFnZSBvbGRQYWdlID0gbWFwLnB1dElmQWJzZW50KGxlcC5nZXRGaXJzdEVu\ndHJ5KCksIGxlcCk7CiAgICAgICAgICAgIGlmIChudWxsID09IG9sZFBhZ2Up\nIHsKICAgICAgICAgICAgICAgIG9sZFBhZ2UgPSBsZXA7CiAgICAgICAgICAg\nICAgICAvLyBBbHNvIGluY2x1ZGUgdGhpcyBpbiB0aGUgY2xlYW4gcGFnZSBt\nYXAgaWYgaXQgcXVhbGlmaWVzLgogICAgICAgICAgICAgICAgLy8gTm90ZTog\nVGhpcyBpcyBkb25lIGZvciBzeW1tZXRyeSBhbmQgY29ycmVjdG5lc3MsIGhv\nd2V2ZXIgaXQgc2hvdWxkIG5ldmVyCiAgICAgICAgICAgICAgICAvLyBnZXQg\nZXhlcmNpc2VkIHNpbmNlIHdlIHNob3VsZG4ndCBhdHRlbXB0IGEgcHV0IHdp\ndGhvdXQgdGhlIHBhZ2UgYmVpbmcgaW4gdXNlCiAgICAgICAgICAgICAgICBh\nZGRUb0NsZWFuUGFnZXNMaXN0KGxlcCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuIG9sZFBhZ2U7CiAgICAgICAgfQoKICAgICAgICAvKioK\nICAgICAgICAgKiBUcmF2ZXJzZSB0aGUgcGFnZXMgZm9yIGEgZ2l2ZW4gbGVk\nZ2VyIGluIG1lbW9yeSBhbmQgZmluZCB0aGUgaGlnaGVzdAogICAgICAgICAq\nIGVudHJ5IGFtb25nc3QgdGhlc2UgcGFnZXMKICAgICAgICAgKgogICAgICAg\nICAqIEBwYXJhbSBsZWRnZXJJZAogICAgICAgICAqICAgICAgICAgIExlZGdl\nciBpZAogICAgICAgICAqIEByZXR1cm5zIGxhc3QgZW50cnkgaW4gdGhlIGlu\nIG1lbW9yeSBwYWdlcwogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgbG9u\nZyBnZXRMYXN0RW50cnlJbk1lbShsb25nIGxlZGdlcklkKSB7CiAgICAgICAg\nICAgIGxvbmcgbGFzdEVudHJ5ID0gMDsKICAgICAgICAgICAgLy8gRmluZCB0\naGUgbGFzdCBlbnRyeSBpbiB0aGUgY2FjaGUKICAgICAgICAgICAgQ29uY3Vy\ncmVudE1hcDxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+IG1hcCA9IHBhZ2VzLmdl\ndChsZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChtYXAgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgZm9yKExlZGdlckVudHJ5UGFnZSBsZXA6IG1hcC52\nYWx1ZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChsZXAuZ2V0TWF4\nUG9zc2libGVFbnRyeSgpIDwgbGFzdEVudHJ5KSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICBsZXAudXNlUGFnZSgpOwogICAgICAgICAgICAg\nICAgICAgIGxvbmcgaGlnaGVzdCA9IGxlcC5nZXRMYXN0RW50cnkoKTsKICAg\nICAgICAgICAgICAgICAgICBpZiAoaGlnaGVzdCA+IGxhc3RFbnRyeSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBsYXN0RW50cnkgPSBoaWdoZXN0Owog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsZXAu\ncmVsZWFzZVBhZ2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gbGFzdEVudHJ5OwogICAgICAgIH0KCiAg\nICAgICAgLyoqCiAgICAgICAgICogUmVtb3ZlcyBsZWRnZXIgZW50cnkgcGFn\nZXMgZm9yIGEgZ2l2ZW4gbGVkZ2VyCiAgICAgICAgICoKICAgICAgICAgKiBA\ncGFyYW0gbGVkZ2VySWQKICAgICAgICAgKiAgICAgICAgICBMZWRnZXIgaWQK\nICAgICAgICAgKiBAcmV0dXJucyBudW1iZXIgb2YgcGFnZXMgcmVtb3ZlZAog\nICAgICAgICAqLwogICAgICAgIHByaXZhdGUgaW50IHJlbW92ZUVudHJpZXNG\nb3JBTGVkZ2VyKGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICAgICAgLy8gcmVt\nb3ZlIHBhZ2VzIGZpcnN0IHRvIGF2b2lkIHBhZ2UgZmx1c2hlZCB3aGVuIGRl\nbGV0aW5nIGZpbGUgaW5mbwogICAgICAgICAgICBDb25jdXJyZW50TWFwPExv\nbmcsIExlZGdlckVudHJ5UGFnZT4gbFBhZ2VzID0gcGFnZXMucmVtb3ZlKGxl\nZGdlcklkKTsKICAgICAgICAgICAgaWYgKG51bGwgIT0gbFBhZ2VzKSB7CiAg\nICAgICAgICAgICAgICBmb3IgKGxvbmcgZW50cnlJZDogbFBhZ2VzLmtleVNl\ndCgpKSB7CiAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkKGxydUNs\nZWFuUGFnZU1hcCkgewogICAgICAgICAgICAgICAgICAgICAgICBscnVDbGVh\nblBhZ2VNYXAucmVtb3ZlKG5ldyBFbnRyeUtleShsZWRnZXJJZCwgZW50cnlJ\nZCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIHJldHVybiBsUGFnZXMuc2l6ZSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KCiAgICAg\nICAgLyoqCiAgICAgICAgICogR2V0cyB0aGUgbGlzdCBvZiBwYWdlcyBpbiBt\nZW1vcnkgdGhhdCBoYXZlIGJlZW4gY2hhbmdlZCBhbmQgaGVuY2UgbmVlZCB0\nbwogICAgICAgICAqIGJlIHdyaXR0ZW4gYXMgYSBwYXJ0IG9mIHRoZSBmbHVz\naCBvcGVyYXRpb24gdGhhdCBpcyBiZWluZyBpc3N1ZWQKICAgICAgICAgKgog\nICAgICAgICAqIEBwYXJhbSBsZWRnZXJJZAogICAgICAgICAqICAgICAgICAg\nIExlZGdlciBpZAogICAgICAgICAqIEByZXR1cm5zIGxhc3QgZW50cnkgaW4g\ndGhlIGluIG1lbW9yeSBwYWdlcy4KICAgICAgICAgKi8KICAgICAgICBwcml2\nYXRlIExpbmtlZExpc3Q8TG9uZz4gZ2V0Rmlyc3RFbnRyeUxpc3RUb0JlRmx1\nc2hlZChsb25nIGxlZGdlcklkKSB7CiAgICAgICAgICAgIENvbmN1cnJlbnRN\nYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdlPiBwYWdlTWFwID0gcGFnZXMuZ2V0\nKGxlZGdlcklkKTsKICAgICAgICAgICAgaWYgKHBhZ2VNYXAgPT0gbnVsbCB8\nfCBwYWdlTWFwLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExpbmtlZExpc3Q8\nTG9uZz4gZmlyc3RFbnRyeUxpc3QgPSBuZXcgTGlua2VkTGlzdDxMb25nPigp\nOwogICAgICAgICAgICBmb3IoQ29uY3VycmVudE1hcC5FbnRyeTxMb25nLCBM\nZWRnZXJFbnRyeVBhZ2U+IGVudHJ5OiBwYWdlTWFwLmVudHJ5U2V0KCkpIHsK\nICAgICAgICAgICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBlbnRyeS5n\nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgaWYgKGxlcC5pc0NsZWFuKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxlcC5pblVzZSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGFkZFRvQ2xlYW5QYWdlc0xpc3QobGVw\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\naWYgKExPRy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExPRy50cmFjZSgiUGFnZSBpcyBjbGVhbiAiICsgbGVwKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIGZpcnN0RW50cnlMaXN0LmFkZChsZXAuZ2V0\nRmlyc3RFbnRyeSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gZmlyc3RFbnRyeUxpc3Q7CiAgICAgICAg\nfQoKICAgICAgICAvKioKICAgICAgICAgKiBBZGQgdGhlIExlZGdlckVudHJ5\nUGFnZSB0byB0aGUgY2xlYW4gcGFnZSBMUlUgbWFwCiAgICAgICAgICoKICAg\nICAgICAgKiBAcGFyYW0gbGVwCiAgICAgICAgICogICAgICAgICAgTGVkZ2Vy\nIEVudHJ5IFBhZ2Ugb2JqZWN0CiAgICAgICAgICovCiAgICAgICAgcHJpdmF0\nZSB2b2lkIGFkZFRvQ2xlYW5QYWdlc0xpc3QoTGVkZ2VyRW50cnlQYWdlIGxl\ncCkgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQobHJ1Q2xlYW5QYWdlTWFw\nKSB7CiAgICAgICAgICAgICAgICBpZiAobGVwLmlzQ2xlYW4oKSAmJiAhbGVw\nLmluVXNlKCkpIHsKICAgICAgICAgICAgICAgICAgICBscnVDbGVhblBhZ2VN\nYXAucHV0KGxlcC5nZXRFbnRyeUtleSgpLCBsZXApOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBSZW1vdmUgdGhlIExlZGdlckVudHJ5UGFnZSBmcm9tIHRoZSBj\nbGVhbiBwYWdlIExSVSBtYXAKICAgICAgICAgKgogICAgICAgICAqIEBwYXJh\nbSBsZXAKICAgICAgICAgKiAgICAgICAgICBMZWRnZXIgRW50cnkgUGFnZSBv\nYmplY3QKICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIHZvaWQgcmVtb3Zl\nRnJvbUNsZWFuUGFnZUxpc3QoTGVkZ2VyRW50cnlQYWdlIGxlcCkgewogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQobHJ1Q2xlYW5QYWdlTWFwKSB7CiAgICAg\nICAgICAgICAgICBpZiAoIWxlcC5pc0NsZWFuKCkgfHwgbGVwLmluVXNlKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBscnVDbGVhblBhZ2VNYXAucmVtb3Zl\nKGxlcC5nZXRFbnRyeUtleSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogR2V0\nIHRoZSBzZXQgb2YgYWN0aXZlIGxlZGdlcnMKICAgICAgICAgKgogICAgICAg\nICAqLwogICAgICAgIFNldDxMb25nPiBnZXRBY3RpdmVMZWRnZXJzKCkgewog\nICAgICAgICAgICByZXR1cm4gcGFnZXMua2V5U2V0KCk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiBHZXQgYSBjbGVhbiBwYWdlIGFuZCBw\ncm92aXNpb24gaXQgZm9yIHRoZSBzcGVjaWZpZWQgbGVkZ2VyIGFuZCBmaXJz\ndEVudHJ5IHdpdGhpbgogICAgICAgICAqIHRoZSBsZWRnZXIKICAgICAgICAg\nKgogICAgICAgICAqIEBwYXJhbSBsZWRnZXJJZAogICAgICAgICAqICAgICAg\nICAgIExlZGdlciBpZAogICAgICAgICAqIEBwYXJhbSBmaXJzdEVudHJ5CiAg\nICAgICAgICogICAgICAgICAgSWQgb2YgdGhlIGZpcnN0IGVudHJ5IGluIHRo\nZSBwYWdlCiAgICAgICAgICogQHJldHVybnMgTGVkZ2VyRW50cnlQYWdlIGlm\nIHByZXNlbnQKICAgICAgICAgKi8KICAgICAgICBMZWRnZXJFbnRyeVBhZ2Ug\nZ3JhYkNsZWFuUGFnZShsb25nIGxlZGdlcklkLCBsb25nIGZpcnN0RW50cnkp\nIHsKICAgICAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IG51bGw7CiAg\nICAgICAgICAgIHdoaWxlIChscnVDbGVhblBhZ2VNYXAuc2l6ZSgpID4gMCkg\newogICAgICAgICAgICAgICAgbGVwID0gbnVsbDsKICAgICAgICAgICAgICAg\nIHN5bmNocm9uaXplZChscnVDbGVhblBhZ2VNYXApIHsKICAgICAgICAgICAg\nICAgICAgICBJdGVyYXRvcjxNYXAuRW50cnk8RW50cnlLZXksTGVkZ2VyRW50\ncnlQYWdlPj4gaXRlcmF0b3IgPSBscnVDbGVhblBhZ2VNYXAuZW50cnlTZXQo\nKS5pdGVyYXRvcigpOwoKICAgICAgICAgICAgICAgICAgICBNYXAuRW50cnk8\nRW50cnlLZXksTGVkZ2VyRW50cnlQYWdlPiBlbnRyeSA9IG51bGw7CiAgICAg\nICAgICAgICAgICAgICAgd2hpbGUgKGl0ZXJhdG9yLmhhc05leHQoKSkKICAg\nICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIGVu\ndHJ5ID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpdGVyYXRvci5yZW1vdmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGVudHJ5LmdldFZhbHVlKCkuaXNDbGVhbigpICYmCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIWVudHJ5LmdldFZhbHVlKCkuaW5Vc2Uo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVwID0gZW50cnku\nZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSBsZXApIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJEaWQgbm90IGZp\nbmQgZWxpZ2libGUgcGFnZSBpbiB0aGUgZmlyc3QgcGFzcyIpOwogICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8g\nV2UgZm91bmQgYSBjYW5kaWRhdGUgcGFnZSwgbGV0cyBzZWUgaWYgd2UgY2Fu\nIHJlY2xhaW0gaXQgYmVmb3JlIGl0cyByZS11c2VkCiAgICAgICAgICAgICAg\nICBDb25jdXJyZW50TWFwPExvbmcsIExlZGdlckVudHJ5UGFnZT4gcGFnZU1h\ncCA9IHBhZ2VzLmdldChsZXAuZ2V0TGVkZ2VyKCkpOwogICAgICAgICAgICAg\nICAgLy8gUmVtb3ZlIGZyb20gbWFwIG9ubHkgaWYgbm90aGluZyBoYXMgY2hh\nbmdlZCBzaW5jZSB3ZSBjaGVja2VkIHRoaXMgbGVwLgogICAgICAgICAgICAg\nICAgLy8gSXRzIHBvc3NpYmxlIGZvciB0aGUgbGVkZ2VyIHRvIGhhdmUgYmVl\nbiBkZWxldGVkIG9yIHRoZSBwYWdlIHRvIGhhdmUgYWxyZWFkeQogICAgICAg\nICAgICAgICAgLy8gYmVlbiByZWNsYWltZWQuIFRoZSBwYWdlIG1hcCBpcyB0\naGUgZGVmaW5pdGl2ZSBzb3VyY2Ugb2YgaW5mb3JtYXRpb24sIGlmIGFueXRo\naW5nCiAgICAgICAgICAgICAgICAvLyBoYXMgY2hhbmdlZCB3ZSBzaG91bGQg\nbGVhdmUgdGhpcyBwYWdlIGFsb25nIGFuZCBjb250aW51ZSBpdGVyYXRpbmcg\ndG8gZmluZAogICAgICAgICAgICAgICAgLy8gYW5vdGhlciBzdWl0YWJsZSBw\nYWdlLgogICAgICAgICAgICAgICAgaWYgKChudWxsICE9IHBhZ2VNYXApICYm\nIChwYWdlTWFwLnJlbW92ZShsZXAuZ2V0Rmlyc3RFbnRyeSgpLCBsZXApKSkg\newogICAgICAgICAgICAgICAgICAgIGlmICghbGVwLmlzQ2xlYW4oKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBTb21lb25lIHdyb3RlIHRvIHRo\naXMgcGFnZSB3aGlsZSB3ZSB3ZXJlIHJlY2xhaW1pbmcgaXQuCiAgICAgICAg\nICAgICAgICAgICAgICAgIHBhZ2VNYXAucHV0KGxlcC5nZXRGaXJzdEVudHJ5\nKCksIGxlcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlcCA9IG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gRG8gc29tZSBib29ra2VlcGluZyBvbiB0aGUgcGFnZSB0\nYWJsZQogICAgICAgICAgICAgICAgICAgICAgICBwYWdlcy5yZW1vdmUobGVw\nLmdldExlZGdlcigpLCBFTVBUWV9QQUdFX01BUCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIC8vIFdlIGNhbiBub3cgc2FmZWx5IHJlc2V0IHRoaXMgbGVw\nIGFuZCByZXR1cm4gaXQuCiAgICAgICAgICAgICAgICAgICAgICAgIGxlcC51\nc2VQYWdlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlcC56ZXJvUGFn\nZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBsZXAuc2V0TGVkZ2VyQW5k\nRmlyc3RFbnRyeShsZWRnZXJJZCwgZmlyc3RFbnRyeSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBsZXA7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICBsZXAgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBsZXA7CiAgICAgICAgfQoKICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvblNldEluVXNlKExlZGdl\nckVudHJ5UGFnZSBsZXApIHsKICAgICAgICAgICAgcmVtb3ZlRnJvbUNsZWFu\nUGFnZUxpc3QobGVwKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIG9uUmVzZXRJblVzZShMZWRnZXJFbnRyeVBh\nZ2UgbGVwKSB7CiAgICAgICAgICAgIGFkZFRvQ2xlYW5QYWdlc0xpc3QobGVw\nKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIG9uU2V0Q2xlYW4oTGVkZ2VyRW50cnlQYWdlIGxlcCkgewogICAg\nICAgICAgICBhZGRUb0NsZWFuUGFnZXNMaXN0KGxlcCk7CiAgICAgICAgfQoK\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvblNldERp\ncnR5KExlZGdlckVudHJ5UGFnZSBsZXApIHsKICAgICAgICAgICAgcmVtb3Zl\nRnJvbUNsZWFuUGFnZUxpc3QobGVwKTsKICAgICAgICB9CiAgICB9CgogICAg\nZmluYWwgaW50IHBhZ2VTaXplOwogICAgZmluYWwgaW50IGVudHJpZXNQZXJQ\nYWdlOwogICAgZmluYWwgaW50IHBhZ2VMaW1pdDsKICAgIGZpbmFsIEluTWVt\nUGFnZUNvbGxlY3Rpb24gcGFnZU1hcEFuZExpc3Q7CgogICAgLy8gVGhlIG51\nbWJlciBvZiBwYWdlcyB0aGF0IGhhdmUgYWN0dWFsbHkgYmVlbiB1c2VkCiAg\nICBwcml2YXRlIGZpbmFsIEF0b21pY0ludGVnZXIgcGFnZUNvdW50ID0gbmV3\nIEF0b21pY0ludGVnZXIoMCk7CgogICAgLy8gVGhlIHBlcnNpc3RlbmNlIG1h\nbmFnZXIgdGhhdCB0aGlzIHBhZ2UgbWFuYWdlciB1c2VzIHRvCiAgICAvLyBm\nbHVzaCBhbmQgcmVhZCBwYWdlcwogICAgcHJpdmF0ZSBmaW5hbCBJbmRleFBl\ncnNpc3RlbmNlTWdyIGluZGV4UGVyc2lzdGVuY2VNYW5hZ2VyOwoKICAgIC8q\nKgogICAgICogdGhlIGxpc3Qgb2YgcG90ZW50aWFsbHkgZGlydHkgbGVkZ2Vy\ncwogICAgICovCiAgICBwcml2YXRlIGZpbmFsIENvbmN1cnJlbnRMaW5rZWRR\ndWV1ZTxMb25nPiBsZWRnZXJzVG9GbHVzaCA9IG5ldyBDb25jdXJyZW50TGlu\na2VkUXVldWU8TG9uZz4oKTsKICAgIHByaXZhdGUgZmluYWwgQ29uY3VycmVu\ndFNraXBMaXN0U2V0PExvbmc+IGxlZGdlcnNGbHVzaGluZyA9IG5ldyBDb25j\ndXJyZW50U2tpcExpc3RTZXQ8TG9uZz4oKTsKCiAgICBwdWJsaWMgSW5kZXhJ\nbk1lbVBhZ2VNZ3IoaW50IHBhZ2VTaXplLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGludCBlbnRyaWVzUGVyUGFnZSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgSW5kZXhQZXJzaXN0ZW5jZU1nciBp\nbmRleFBlcnNpc3RlbmNlTWFuYWdlciwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBTdGF0c0xvZ2dlciBzdGF0c0xvZ2dlcikgewogICAgICAgIHRo\naXMucGFnZVNpemUgPSBwYWdlU2l6ZTsKICAgICAgICB0aGlzLmVudHJpZXNQ\nZXJQYWdlID0gZW50cmllc1BlclBhZ2U7CiAgICAgICAgdGhpcy5pbmRleFBl\ncnNpc3RlbmNlTWFuYWdlciA9IGluZGV4UGVyc2lzdGVuY2VNYW5hZ2VyOwog\nICAgICAgIHRoaXMucGFnZU1hcEFuZExpc3QgPSBuZXcgSW5NZW1QYWdlQ29s\nbGVjdGlvbigpOwoKICAgICAgICBpZiAoY29uZi5nZXRQYWdlTGltaXQoKSA8\nPSAwKSB7CiAgICAgICAgICAgIC8vIGFsbG9jYXRlIGhhbGYgb2YgdGhlIG1l\nbW9yeSB0byB0aGUgcGFnZSBjYWNoZQogICAgICAgICAgICB0aGlzLnBhZ2VM\naW1pdCA9IChpbnQpICgoUnVudGltZS5nZXRSdW50aW1lKCkubWF4TWVtb3J5\nKCkgLyAzKSAvIHRoaXMucGFnZVNpemUpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIHRoaXMucGFnZUxpbWl0ID0gY29uZi5nZXRQYWdlTGltaXQo\nKTsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oIm1heE1lbW9yeSA9IHt9\nLCBwYWdlU2l6ZSA9IHt9LCBwYWdlTGltaXQgPSB7fSIsIG5ldyBPYmplY3Rb\nXSB7IFJ1bnRpbWUuZ2V0UnVudGltZSgpLm1heE1lbW9yeSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICBwYWdlU2l6ZSwgcGFnZUxpbWl0IH0pOwogICAg\nICAgIC8vIEV4cG9zZSBTdGF0cwogICAgICAgIHN0YXRzTG9nZ2VyLnJlZ2lz\ndGVyR2F1Z2UoTlVNX0lOREVYX1BBR0VTLCBuZXcgR2F1Z2U8TnVtYmVyPigp\nIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBO\ndW1iZXIgZ2V0RGVmYXVsdFZhbHVlKCkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgTnVtYmVyIGdldFNhbXBsZSgpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBnZXROdW1Vc2VkUGFnZXMoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogQHJldHVy\nbiBwYWdlIHNpemUgdXNlZCBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwogICAg\ncHVibGljIGludCBnZXRQYWdlU2l6ZSgpIHsKICAgICAgICByZXR1cm4gcGFn\nZVNpemU7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIGVudHJpZXMg\ncGVyIHBhZ2UgdXNlZCBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwogICAgcHVi\nbGljIGludCBnZXRFbnRyaWVzUGVyUGFnZSgpIHsKICAgICAgICByZXR1cm4g\nZW50cmllc1BlclBhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJu\nIHBhZ2UgbGltaXRhdGlvbiBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwogICAg\ncHVibGljIGludCBnZXRQYWdlTGltaXQoKSB7CiAgICAgICAgcmV0dXJuIHBh\nZ2VMaW1pdDsKICAgIH0KCiAgICAvKioKICAgICAqIEByZXR1cm4gbnVtYmVy\nIG9mIHBhZ2UgdXNlZCBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwogICAgcHVi\nbGljIGludCBnZXROdW1Vc2VkUGFnZXMoKSB7CiAgICAgICAgcmV0dXJuIHBh\nZ2VDb3VudC5nZXQoKTsKICAgIH0KCiAgICBMZWRnZXJFbnRyeVBhZ2UgZ2V0\nTGVkZ2VyRW50cnlQYWdlKExvbmcgbGVkZ2VyLCBMb25nIGZpcnN0RW50cnks\nIGJvb2xlYW4gb25seURpcnR5KSB7CiAgICAgICAgTGVkZ2VyRW50cnlQYWdl\nIGxlcCA9IHBhZ2VNYXBBbmRMaXN0LmdldFBhZ2UobGVkZ2VyLCBmaXJzdEVu\ndHJ5KTsKICAgICAgICBpZiAob25seURpcnR5ICYmIG51bGwgIT0gbGVwICYm\nIGxlcC5pc0NsZWFuKCkpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgfQogICAgICAgIGlmIChudWxsICE9IGxlcCkgewogICAgICAgICAg\nICBsZXAudXNlUGFnZSgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbGVw\nOwogICAgfQoKICAgIC8qKgogICAgICogR3JhYiBsZWRnZXIgZW50cnkgcGFn\nZSB3aG9zZSBmaXJzdCBlbnRyeSBpcyA8Y29kZT5wYWdlRW50cnk8L2NvZGU+\nLgogICAgICoKICAgICAqIElmIHRoZSBwYWdlIGRvZXNuJ3QgZXhpc3RlZCBi\nZWZvcmUsIHdlIGFsbG9jYXRlIGEgbWVtb3J5IHBhZ2UuCiAgICAgKiBPdGhl\ncndpc2UsIHdlIGdyYWIgYSBjbGVhbiBwYWdlIGFuZCByZWFkIGl0IGZyb20g\nZGlzay4KICAgICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VyCiAgICAgKiAgICAg\nICAgICBMZWRnZXIgSWQKICAgICAqIEBwYXJhbSBwYWdlRW50cnkKICAgICAq\nICAgICAgICAgIFN0YXJ0IGVudHJ5IG9mIHRoaXMgZW50cnkgcGFnZS4KICAg\nICAqLwogICAgcHJpdmF0ZSBMZWRnZXJFbnRyeVBhZ2UgZ3JhYkxlZGdlckVu\ndHJ5UGFnZShsb25nIGxlZGdlciwgbG9uZyBwYWdlRW50cnkpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGdy\nYWJDbGVhblBhZ2UobGVkZ2VyLCBwYWdlRW50cnkpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIC8vIHNob3VsZCBnZXQgdGhlIHVwIHRvIGRhdGUgcGFn\nZSBmcm9tIHRoZSBwZXJzaXN0ZW5jZSBtYW5hZ2VyCiAgICAgICAgICAgIC8v\nIGJlZm9yZSB3ZSBwdXQgaXQgaW50byB0YWJsZSBvdGhlcndpc2Ugd2Ugd291\nbGQgcHV0CiAgICAgICAgICAgIC8vIGFuIGVtcHR5IHBhZ2UgaW4gaXQKICAg\nICAgICAgICAgaW5kZXhQZXJzaXN0ZW5jZU1hbmFnZXIudXBkYXRlUGFnZShs\nZXApOwogICAgICAgICAgICBMZWRnZXJFbnRyeVBhZ2Ugb2xkTGVwOwogICAg\nICAgICAgICBpZiAobGVwICE9IChvbGRMZXAgPSBwYWdlTWFwQW5kTGlzdC5w\ndXRQYWdlKGxlcCkpKSB7CiAgICAgICAgICAgICAgICBsZXAucmVsZWFzZVBh\nZ2UoKTsKICAgICAgICAgICAgICAgIC8vIERlY3JlbWVudCB0aGUgcGFnZSBj\nb3VudCBiZWNhdXNlIHdlIGNvdWxkbid0IHB1dCB0aGlzIGxlcCBpbiB0aGUg\ncGFnZSBjYWNoZS4KICAgICAgICAgICAgICAgIHBhZ2VDb3VudC5kZWNyZW1l\nbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAgIC8vIEluY3JlbWVudCB0aGUg\ndXNlIGNvdW50IG9mIHRoZSBvbGQgbGVwIGJlY2F1c2UgdGhpcyBpcyB1bmV4\ncGVjdGVkCiAgICAgICAgICAgICAgICBvbGRMZXAudXNlUGFnZSgpOwogICAg\nICAgICAgICAgICAgbGVwID0gb2xkTGVwOwogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgLy8g\naWYgd2UgZ3JhYiBhIGNsZWFuIHBhZ2UsIGJ1dCBmYWlsZWQgdG8gdXBkYXRl\nIHRoZSBwYWdlCiAgICAgICAgICAgIC8vIHdlIGFyZSBleGhhdXN0aW5nIHRo\nZSBjb3VudCBvZiBsZWRnZXIgZW50cnkgcGFnZXMuCiAgICAgICAgICAgIC8v\nIHNpbmNlIHRoaXMgcGFnZSB3aWxsIGJlIG5ldmVyIHVzZWQsIHNvIHdlIG5l\nZWQgdG8gZGVjcmVtZW50CiAgICAgICAgICAgIC8vIHBhZ2UgY291bnQgb2Yg\nbGVkZ2VyIGNhY2hlLgogICAgICAgICAgICBsZXAucmVsZWFzZVBhZ2UoKTsK\nICAgICAgICAgICAgcGFnZUNvdW50LmRlY3JlbWVudEFuZEdldCgpOwogICAg\nICAgICAgICB0aHJvdyBpZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxl\ncDsKICAgIH0KCiAgICB2b2lkIHJlbW92ZVBhZ2VzRm9yTGVkZ2VyKGxvbmcg\nbGVkZ2VySWQpIHsKICAgICAgICBpbnQgcmVtb3ZlZFBhZ2VDb3VudCA9IHBh\nZ2VNYXBBbmRMaXN0LnJlbW92ZUVudHJpZXNGb3JBTGVkZ2VyKGxlZGdlcklk\nKTsKICAgICAgICBpZiAocGFnZUNvdW50LmFkZEFuZEdldCgtcmVtb3ZlZFBh\nZ2VDb3VudCkgPCAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1l\nRXhjZXB0aW9uKCJQYWdlIGNvdW50IG9mIGxlZGdlciBjYWNoZSBoYXMgYmVl\nbiBkZWNyZW1lbnRlZCB0byBiZSBsZXNzIHRoYW4gemVyby4iKTsKICAgICAg\nICB9CiAgICAgICAgbGVkZ2Vyc1RvRmx1c2gucmVtb3ZlKGxlZGdlcklkKTsK\nICAgIH0KCiAgICBsb25nIGdldExhc3RFbnRyeUluTWVtKGxvbmcgbGVkZ2Vy\nSWQpIHsKICAgICAgICByZXR1cm4gcGFnZU1hcEFuZExpc3QuZ2V0TGFzdEVu\ndHJ5SW5NZW0obGVkZ2VySWQpOwogICAgfQoKICAgIHByaXZhdGUgTGVkZ2Vy\nRW50cnlQYWdlIGdyYWJDbGVhblBhZ2UobG9uZyBsZWRnZXIsIGxvbmcgZW50\ncnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGVudHJ5ICUg\nZW50cmllc1BlclBhZ2UgIT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGVudHJ5ICsgIiBpcyBub3QgYSBt\ndWx0aXBsZSBvZiAiICsgZW50cmllc1BlclBhZ2UpOwogICAgICAgIH0KCiAg\nICAgICAgd2hpbGUodHJ1ZSkgewogICAgICAgICAgICBib29sZWFuIGNhbkFs\nbG9jYXRlID0gZmFsc2U7CiAgICAgICAgICAgIGlmIChwYWdlQ291bnQuaW5j\ncmVtZW50QW5kR2V0KCkgPD0gcGFnZUxpbWl0KSB7CiAgICAgICAgICAgICAg\nICBjYW5BbGxvY2F0ZSA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBwYWdlQ291bnQuZGVjcmVtZW50QW5kR2V0KCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChjYW5BbGxvY2F0ZSkgewog\nICAgICAgICAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IG5ldyBMZWRn\nZXJFbnRyeVBhZ2UocGFnZVNpemUsIGVudHJpZXNQZXJQYWdlLCBwYWdlTWFw\nQW5kTGlzdCk7CiAgICAgICAgICAgICAgICBsZXAuc2V0TGVkZ2VyQW5kRmly\nc3RFbnRyeShsZWRnZXIsIGVudHJ5KTsKICAgICAgICAgICAgICAgIGxlcC51\nc2VQYWdlKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbGVwOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gcGFn\nZU1hcEFuZExpc3QuZ3JhYkNsZWFuUGFnZShsZWRnZXIsIGVudHJ5KTsKICAg\nICAgICAgICAgaWYgKG51bGwgIT0gbGVwKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbGVwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExPRy5pbmZv\nKCJDb3VsZCBub3QgZ3JhYiBhIGNsZWFuIHBhZ2UgZm9yIGxlZGdlciB7fSwg\nZW50cnkge30sIGZvcmNlIGZsdXNoaW5nIGRpcnR5IGxlZGdlcnMuIiwKICAg\nICAgICAgICAgICAgICAgICBsZWRnZXIsIGVudHJ5KTsKICAgICAgICAgICAg\nZmx1c2hPbmVPck1vcmVMZWRnZXJzKGZhbHNlKTsKICAgICAgICB9CiAgICB9\nCgogICAgdm9pZCBmbHVzaE9uZU9yTW9yZUxlZGdlcnMoYm9vbGVhbiBkb0Fs\nbCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAobGVkZ2Vyc1Rv\nRmx1c2guaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIGxlZGdlcnNUb0ZsdXNo\nLmFkZEFsbChwYWdlTWFwQW5kTGlzdC5nZXRBY3RpdmVMZWRnZXJzKCkpOwog\nICAgICAgIH0KICAgICAgICBMb25nIHBvdGVudGlhbGx5RGlydHlMZWRnZXI7\nCiAgICAgICAgd2hpbGUgKG51bGwgIT0gKHBvdGVudGlhbGx5RGlydHlMZWRn\nZXIgPSBsZWRnZXJzVG9GbHVzaC5wb2xsKCkpKSB7CiAgICAgICAgICAgIGlm\nICghbGVkZ2Vyc0ZsdXNoaW5nLmFkZChwb3RlbnRpYWxseURpcnR5TGVkZ2Vy\nKSkgewogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGZsdXNoU3BlY2lm\naWNMZWRnZXIocG90ZW50aWFsbHlEaXJ0eUxlZGdlcik7CiAgICAgICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBsZWRnZXJzRmx1c2hpbmcu\ncmVtb3ZlKHBvdGVudGlhbGx5RGlydHlMZWRnZXIpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmICghZG9BbGwpIHsKICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogRmx1c2ggYSBzcGVjaWZpZWQgbGVkZ2VyCiAgICAgKgogICAgICog\nQHBhcmFtIGxlZGdlcgogICAgICogICAgICAgICAgTGVkZ2VyIElkCiAgICAg\nKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgdm9p\nZCBmbHVzaFNwZWNpZmljTGVkZ2VyKGxvbmcgbGVkZ2VyKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIExpbmtlZExpc3Q8TG9uZz4gZmlyc3RFbnRy\neUxpc3QgPSBwYWdlTWFwQW5kTGlzdC5nZXRGaXJzdEVudHJ5TGlzdFRvQmVG\nbHVzaGVkKGxlZGdlcik7CgogICAgICAgIC8vIGZsdXNoIGxlZGdlciBpbmRl\neCBmaWxlIGhlYWRlciBpZiBuZWNlc3NhcnkKICAgICAgICBpbmRleFBlcnNp\nc3RlbmNlTWFuYWdlci5mbHVzaExlZGdlckhlYWRlcihsZWRnZXIpOwoKICAg\nICAgICBpZiAobnVsbCA9PSBmaXJzdEVudHJ5TGlzdCB8fCBmaXJzdEVudHJ5\nTGlzdC5zaXplKCkgPT0gMCkgewogICAgICAgICAgICBMT0cuZGVidWcoIk5v\ndGhpbmcgdG8gZmx1c2ggZm9yIGxlZGdlciB7fS4iLCBsZWRnZXIpOwogICAg\nICAgICAgICAvLyBub3RoaW5nIHRvIGRvCiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIC8vIE5vdyBmbHVzaCBhbGwgdGhlIHBhZ2Vz\nIG9mIGEgbGVkZ2VyCiAgICAgICAgTGlzdDxMZWRnZXJFbnRyeVBhZ2U+IGVu\ndHJpZXMgPSBuZXcgQXJyYXlMaXN0PExlZGdlckVudHJ5UGFnZT4oZmlyc3RF\nbnRyeUxpc3Quc2l6ZSgpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBm\nb3IoTG9uZyBmaXJzdEVudHJ5OiBmaXJzdEVudHJ5TGlzdCkgewogICAgICAg\nICAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGdldExlZGdlckVudHJ5\nUGFnZShsZWRnZXIsIGZpcnN0RW50cnksIHRydWUpOwogICAgICAgICAgICAg\nICAgaWYgKGxlcCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZW50\ncmllcy5hZGQobGVwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICBpbmRleFBlcnNpc3RlbmNlTWFuYWdlci5mbHVzaExl\nZGdlckVudHJpZXMobGVkZ2VyLCBlbnRyaWVzKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBmb3IoTGVkZ2VyRW50cnlQYWdlIGxlcDogZW50\ncmllcykgewogICAgICAgICAgICAgICAgbGVwLnJlbGVhc2VQYWdlKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgdm9pZCBwdXRFbnRy\neU9mZnNldChsb25nIGxlZGdlciwgbG9uZyBlbnRyeSwgbG9uZyBvZmZzZXQp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaW50IG9mZnNldEluUGFn\nZSA9IChpbnQpIChlbnRyeSAlIGVudHJpZXNQZXJQYWdlKTsKICAgICAgICAv\nLyBmaW5kIHRoZSBpZCBvZiB0aGUgZmlyc3QgZW50cnkgb2YgdGhlIHBhZ2Ug\ndGhhdCBoYXMgdGhlIGVudHJ5CiAgICAgICAgLy8gd2UgYXJlIGxvb2tpbmcg\nZm9yCiAgICAgICAgbG9uZyBwYWdlRW50cnkgPSBlbnRyeSAtIG9mZnNldElu\nUGFnZTsKICAgICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gZ2V0TGVkZ2Vy\nRW50cnlQYWdlKGxlZGdlciwgcGFnZUVudHJ5LCBmYWxzZSk7CiAgICAgICAg\naWYgKGxlcCA9PSBudWxsKSB7CiAgICAgICAgICAgIGxlcCA9IGdyYWJMZWRn\nZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50cnkpOwogICAgICAgIH0KICAg\nICAgICBhc3NlcnQgbGVwICE9IG51bGw7CiAgICAgICAgbGVwLnNldE9mZnNl\ndChvZmZzZXQsIG9mZnNldEluUGFnZSAqIExlZGdlckVudHJ5UGFnZS5nZXRJ\nbmRleEVudHJ5U2l6ZSgpKTsKICAgICAgICBsZXAucmVsZWFzZVBhZ2UoKTsK\nICAgIH0KCiAgICBsb25nIGdldEVudHJ5T2Zmc2V0KGxvbmcgbGVkZ2VyLCBs\nb25nIGVudHJ5KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGludCBv\nZmZzZXRJblBhZ2UgPSAoaW50KSAoZW50cnkgJSBlbnRyaWVzUGVyUGFnZSk7\nCiAgICAgICAgLy8gZmluZCB0aGUgaWQgb2YgdGhlIGZpcnN0IGVudHJ5IG9m\nIHRoZSBwYWdlIHRoYXQgaGFzIHRoZSBlbnRyeQogICAgICAgIC8vIHdlIGFy\nZSBsb29raW5nIGZvcgogICAgICAgIGxvbmcgcGFnZUVudHJ5ID0gZW50cnkg\nLSBvZmZzZXRJblBhZ2U7CiAgICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9\nIGdldExlZGdlckVudHJ5UGFnZShsZWRnZXIsIHBhZ2VFbnRyeSwgZmFsc2Up\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChsZXAgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgbGVwID0gZ3JhYkxlZGdlckVudHJ5UGFnZShs\nZWRnZXIsIHBhZ2VFbnRyeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIGxlcC5nZXRPZmZzZXQob2Zmc2V0SW5QYWdlICogTGVkZ2VyRW50\ncnlQYWdlLmdldEluZGV4RW50cnlTaXplKCkpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGlmIChsZXAgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgbGVwLnJlbGVhc2VQYWdlKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9Cn0K\n","encoding":"base64"}

