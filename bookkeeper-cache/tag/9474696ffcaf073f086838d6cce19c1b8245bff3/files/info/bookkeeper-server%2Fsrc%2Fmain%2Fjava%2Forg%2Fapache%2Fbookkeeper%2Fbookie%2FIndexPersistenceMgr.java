{"sha":"60b409951cef808ec8718fba4984c6042615f07f","node_id":"MDQ6QmxvYjE1NzU5NTY6NjBiNDA5OTUxY2VmODA4ZWM4NzE4ZmJhNDk4NGM2MDQyNjE1ZjA3Zg==","size":22016,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/60b409951cef808ec8718fba4984c6042615f07f","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsK\naW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGls\nLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwLkVudHJ5OwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50TWFwOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuTGVkZ2VyRGlyc01hbmFnZXIu\nTGVkZ2VyRGlyc0xpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmJvb2tpZS5MZWRnZXJEaXJzTWFuYWdlci5Ob1dyaXRhYmxlTGVkZ2Vy\nRGlyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNv\nbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5zdGF0cy5Db3VudGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnN0YXRzLkdhdWdlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnN0YXRzLlN0YXRzTG9nZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnV0aWwuU25hcHNob3RNYXA7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQg\nY29tLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJsZUZvclRlc3Rp\nbmc7CgppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29r\naWUuQm9va0tlZXBlclNlcnZlclN0YXRzLkxFREdFUl9DQUNIRV9OVU1fRVZJ\nQ1RFRF9MRURHRVJTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5ib29raWUuQm9va0tlZXBlclNlcnZlclN0YXRzLk5VTV9PUEVOX0xF\nREdFUlM7CgpwdWJsaWMgY2xhc3MgSW5kZXhQZXJzaXN0ZW5jZU1nciB7CiAg\nICBwcml2YXRlIGZpbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFj\ndG9yeS5nZXRMb2dnZXIoSW5kZXhQZXJzaXN0ZW5jZU1nci5jbGFzcyk7Cgog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIElEWCA9ICIuaWR4IjsK\nICAgIHN0YXRpYyBmaW5hbCBTdHJpbmcgUkxPQyA9ICIucmxvYyI7CgogICAg\nQFZpc2libGVGb3JUZXN0aW5nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0\ncmluZyBnZXRMZWRnZXJOYW1lKGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICBp\nbnQgcGFyZW50ID0gKGludCkgKGxlZGdlcklkICYgMHhmZik7CiAgICAgICAg\naW50IGdyYW5kUGFyZW50ID0gKGludCkgKChsZWRnZXJJZCAmIDB4ZmYwMCkg\nPj4gOCk7CiAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdC\ndWlsZGVyKCk7CiAgICAgICAgc2IuYXBwZW5kKEludGVnZXIudG9IZXhTdHJp\nbmcoZ3JhbmRQYXJlbnQpKTsKICAgICAgICBzYi5hcHBlbmQoJy8nKTsKICAg\nICAgICBzYi5hcHBlbmQoSW50ZWdlci50b0hleFN0cmluZyhwYXJlbnQpKTsK\nICAgICAgICBzYi5hcHBlbmQoJy8nKTsKICAgICAgICBzYi5hcHBlbmQoTG9u\nZy50b0hleFN0cmluZyhsZWRnZXJJZCkpOwogICAgICAgIHNiLmFwcGVuZChJ\nRFgpOwogICAgICAgIHJldHVybiBzYi50b1N0cmluZygpOwogICAgfQoKICAg\nIGZpbmFsIENvbmN1cnJlbnRNYXA8TG9uZywgRmlsZUluZm8+IGZpbGVJbmZv\nQ2FjaGUgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8TG9uZywgRmlsZUluZm8+\nKCk7CiAgICBmaW5hbCBpbnQgb3BlbkZpbGVMaW1pdDsKICAgIGZpbmFsIGlu\ndCBwYWdlU2l6ZTsKICAgIGZpbmFsIGludCBlbnRyaWVzUGVyUGFnZTsKCiAg\nICAvLyBNYW5hZ2UgYWxsIGFjdGl2ZSBsZWRnZXJzIGluIExlZGdlck1hbmFn\nZXIKICAgIC8vIHNvIExlZGdlck1hbmFnZXIgaGFzIGtub3dsZWRnZSB0byBn\nYXJiYWdlIGNvbGxlY3QgaW5hY3RpdmUvZGVsZXRlZCBsZWRnZXJzCiAgICBm\naW5hbCBTbmFwc2hvdE1hcDxMb25nLCBCb29sZWFuPiBhY3RpdmVMZWRnZXJz\nOwogICAgcHJpdmF0ZSBMZWRnZXJEaXJzTWFuYWdlciBsZWRnZXJEaXJzTWFu\nYWdlcjsKICAgIGZpbmFsIExpbmtlZExpc3Q8TG9uZz4gb3BlbkxlZGdlcnMg\nPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwoKICAgIC8vIFN0YXRzCiAgICBw\ncml2YXRlIGZpbmFsIENvdW50ZXIgZXZpY3RlZExlZGdlcnNDb3VudGVyOwoK\nICAgIHB1YmxpYyBJbmRleFBlcnNpc3RlbmNlTWdyKGludCBwYWdlU2l6ZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBlbnRyaWVzUGVy\nUGFnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIFNuYXBzaG90TWFwPExvbmcsIEJvb2xlYW4+IGFjdGl2ZUxlZGdlcnMs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJEaXJzTWFu\nYWdlciBsZWRnZXJEaXJzTWFuYWdlciwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIFN0YXRzTG9nZ2VyIHN0YXRzTG9nZ2VyKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHRoaXMub3BlbkZpbGVMaW1pdCA9IGNvbmYu\nZ2V0T3BlbkZpbGVMaW1pdCgpOwogICAgICAgIHRoaXMuYWN0aXZlTGVkZ2Vy\ncyA9IGFjdGl2ZUxlZGdlcnM7CiAgICAgICAgdGhpcy5sZWRnZXJEaXJzTWFu\nYWdlciA9IGxlZGdlckRpcnNNYW5hZ2VyOwogICAgICAgIHRoaXMucGFnZVNp\nemUgPSBwYWdlU2l6ZTsKICAgICAgICB0aGlzLmVudHJpZXNQZXJQYWdlID0g\nZW50cmllc1BlclBhZ2U7CiAgICAgICAgTE9HLmluZm8oIm9wZW5GaWxlTGlt\naXQgPSB7fSIsIG9wZW5GaWxlTGltaXQpOwogICAgICAgIC8vIFJldHJpZXZl\nIGFsbCBvZiB0aGUgYWN0aXZlIGxlZGdlcnMuCiAgICAgICAgZ2V0QWN0aXZl\nTGVkZ2VycygpOwogICAgICAgIGxlZGdlckRpcnNNYW5hZ2VyLmFkZExlZGdl\nckRpcnNMaXN0ZW5lcihnZXRMZWRnZXJEaXJzTGlzdGVuZXIoKSk7CgogICAg\nICAgIC8vIEV4cG9zZSBTdGF0cwogICAgICAgIGV2aWN0ZWRMZWRnZXJzQ291\nbnRlciA9IHN0YXRzTG9nZ2VyLmdldENvdW50ZXIoTEVER0VSX0NBQ0hFX05V\nTV9FVklDVEVEX0xFREdFUlMpOwogICAgICAgIHN0YXRzTG9nZ2VyLnJlZ2lz\ndGVyR2F1Z2UoTlVNX09QRU5fTEVER0VSUywgbmV3IEdhdWdlPEludGVnZXI+\nKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGlj\nIEludGVnZXIgZ2V0RGVmYXVsdFZhbHVlKCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgSW50ZWdlciBnZXRTYW1wbGUoKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZ2V0TnVtT3BlbkxlZGdlcnMoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIEZpbGVJbmZvIGdl\ndEZpbGVJbmZvKExvbmcgbGVkZ2VyLCBieXRlIG1hc3RlcktleVtdKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIEZpbGVJbmZvIGZpID0gZmlsZUlu\nZm9DYWNoZS5nZXQobGVkZ2VyKTsKICAgICAgICBpZiAobnVsbCA9PSBmaSkg\newogICAgICAgICAgICBib29sZWFuIGNyZWF0ZWROZXdGaWxlID0gZmFsc2U7\nCiAgICAgICAgICAgIEZpbGUgbGYgPSBudWxsOwogICAgICAgICAgICBzeW5j\naHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgICAgIC8vIENoZWNrIGlm\nIHRoZSBpbmRleCBmaWxlIGV4aXN0cyBvbiBkaXNrLgogICAgICAgICAgICAg\nICAgbGYgPSBmaW5kSW5kZXhGaWxlKGxlZGdlcik7CiAgICAgICAgICAgICAg\nICBpZiAobnVsbCA9PSBsZikgewogICAgICAgICAgICAgICAgICAgIGlmIChu\ndWxsID09IG1hc3RlcktleSkgewogICAgICAgICAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgQm9va2llLk5vTGVkZ2VyRXhjZXB0aW9uKGxlZGdlcik7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIFdl\nIGRvbid0IGhhdmUgYSBsZWRnZXIgaW5kZXggZmlsZSBvbiBkaXNrLCBzbyBj\ncmVhdGUgaXQuCiAgICAgICAgICAgICAgICAgICAgbGYgPSBnZXROZXdMZWRn\nZXJJbmRleEZpbGUobGVkZ2VyLCBudWxsKTsKICAgICAgICAgICAgICAgICAg\nICBjcmVhdGVkTmV3RmlsZSA9IHRydWU7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgZmkgPSBwdXRGaWxlSW5mbyhsZWRn\nZXIsIG1hc3RlcktleSwgbGYsIGNyZWF0ZWROZXdGaWxlKTsKICAgICAgICB9\nCgogICAgICAgIGFzc2VydCBudWxsICE9IGZpOwogICAgICAgIGZpLnVzZSgp\nOwogICAgICAgIHJldHVybiBmaTsKICAgIH0KCiAgICBwcml2YXRlIEZpbGVJ\nbmZvIHB1dEZpbGVJbmZvKExvbmcgbGVkZ2VyLCBieXRlIG1hc3RlcktleVtd\nLCBGaWxlIGxmLCBib29sZWFuIGNyZWF0ZWROZXdGaWxlKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIEZpbGVJbmZvIGZpID0gbmV3IEZpbGVJbmZv\nKGxmLCBtYXN0ZXJLZXkpOwogICAgICAgIEZpbGVJbmZvIG9sZEZpID0gZmls\nZUluZm9DYWNoZS5wdXRJZkFic2VudChsZWRnZXIsIGZpKTsKICAgICAgICBp\nZiAobnVsbCAhPSBvbGRGaSkgewogICAgICAgICAgICAvLyBTb21lIG90aGVy\nIHRocmVhZCB3b24gdGhlIHJhY2UuIFdlIHNob3VsZCBkZWxldGUgb3VyIGZp\nbGUgaWYgd2UgY3JlYXRlZAogICAgICAgICAgICAvLyBhIG5ldyBvbmUgYW5k\nIHRoZSBwYXRocyBhcmUgZGlmZmVyZW50LgogICAgICAgICAgICBpZiAoY3Jl\nYXRlZE5ld0ZpbGUgJiYgIW9sZEZpLmlzU2FtZUZpbGUobGYpKSB7CiAgICAg\nICAgICAgICAgICBmaS5kZWxldGUoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBmaSA9IG9sZEZpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIGlmIChjcmVhdGVkTmV3RmlsZSkgewogICAgICAgICAgICAgICAgLy8gRWxz\nZSwgd2Ugd29uIGFuZCB0aGUgYWN0aXZlIGxlZGdlciBtYW5hZ2VyIHNob3Vs\nZCBrbm93IGFib3V0IHRoaXMuCiAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIk5ldyBsZWRnZXIgaW5kZXggZmlsZSBjcmVhdGVkIGZvciBsZWRnZXJJZDog\ne30iLCBsZWRnZXIpOwogICAgICAgICAgICAgICAgYWN0aXZlTGVkZ2Vycy5w\ndXQobGVkZ2VyLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBFdmljdCBjYWNoZWQgaXRlbXMgZnJvbSB0aGUgZmlsZSBpbmZvIGNhY2hl\nIGlmIG5lY2Vzc2FyeQogICAgICAgICAgICBldmljdEZpbGVJbmZvSWZOZWNl\nc3NhcnkoKTsKICAgICAgICAgICAgc3luY2hyb25pemVkIChvcGVuTGVkZ2Vy\ncykgewogICAgICAgICAgICAgICAgb3BlbkxlZGdlcnMub2ZmZXIobGVkZ2Vy\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gZmk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBuZXcgaW5kZXggZmlsZSBm\nb3IgbGVkZ2VyIGV4Y2x1ZGluZyBkaXJlY3RvcnkgPGNvZGU+ZXhjbHVkZWRE\naXI8L2NvZGU+LgogICAgICoKICAgICAqIEBwYXJhbSBsZWRnZXIKICAgICAq\nICAgICAgICAgIExlZGdlciBpZC4KICAgICAqIEBwYXJhbSBleGNsdWRlZERp\ncgogICAgICogICAgICAgICAgVGhlIGxlZGdlciBkaXJlY3RvcnkgdG8gZXhj\nbHVkZS4KICAgICAqIEByZXR1cm4gbmV3IGluZGV4IGZpbGUgb2JqZWN0Lgog\nICAgICogQHRocm93cyBOb1dyaXRhYmxlTGVkZ2VyRGlyRXhjZXB0aW9uIGlm\nIHRoZXJlIGlzIG5vIHdyaXRhYmxlIGRpciBhdmFpbGFibGUuCiAgICAgKi8K\nICAgIHByaXZhdGUgRmlsZSBnZXROZXdMZWRnZXJJbmRleEZpbGUoTG9uZyBs\nZWRnZXIsIEZpbGUgZXhjbHVkZWREaXIpCiAgICAgICAgICAgICAgICAgICAg\ndGhyb3dzIE5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb24gewogICAgICAg\nIEZpbGUgZGlyID0gbGVkZ2VyRGlyc01hbmFnZXIucGlja1JhbmRvbVdyaXRh\nYmxlRGlyKGV4Y2x1ZGVkRGlyKTsKICAgICAgICBTdHJpbmcgbGVkZ2VyTmFt\nZSA9IGdldExlZGdlck5hbWUobGVkZ2VyKTsKICAgICAgICByZXR1cm4gbmV3\nIEZpbGUoZGlyLCBsZWRnZXJOYW1lKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRoaXMgbWV0aG9kIHdpbGwgbG9vayB3aXRoaW4gdGhlIGxlZGdlciBkaXJl\nY3RvcmllcyBmb3IgdGhlIGxlZGdlciBpbmRleAogICAgICogZmlsZXMuIFRo\nYXQgd2lsbCBjb21wcmlzZSB0aGUgc2V0IG9mIGFjdGl2ZSBsZWRnZXJzIHRo\naXMgcGFydGljdWxhcgogICAgICogQm9va2llU2VydmVyIGtub3dzIGFib3V0\nIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gZGVsZXRlZCBieSB0aGUgQm9va0tl\nZXBlcgogICAgICogQ2xpZW50LiBUaGlzIGlzIGNhbGxlZCBvbmx5IG9uY2Ug\nZHVyaW5nIGluaXRpYWxpemF0aW9uLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgZ2V0QWN0aXZlTGVkZ2VycygpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gTGVkZ2VyIGluZGV4IGZpbGVzIGFyZSBzdG9yZWQgaW4gYSBm\naWxlIGhpZXJhcmNoeSB3aXRoIGEgcGFyZW50IGFuZAogICAgICAgIC8vIGdy\nYW5kUGFyZW50IGRpcmVjdG9yeS4gV2UnbGwgaGF2ZSB0byBnbyB0d28gbGV2\nZWxzIGRlZXAgaW50byB0aGVzZQogICAgICAgIC8vIGRpcmVjdG9yaWVzIHRv\nIGZpbmQgdGhlIGluZGV4IGZpbGVzLgogICAgICAgIGZvciAoRmlsZSBsZWRn\nZXJEaXJlY3RvcnkgOiBsZWRnZXJEaXJzTWFuYWdlci5nZXRBbGxMZWRnZXJE\naXJzKCkpIHsKICAgICAgICAgICAgZm9yIChGaWxlIGdyYW5kUGFyZW50IDog\nbGVkZ2VyRGlyZWN0b3J5Lmxpc3RGaWxlcygpKSB7CiAgICAgICAgICAgICAg\nICBpZiAoZ3JhbmRQYXJlbnQuaXNEaXJlY3RvcnkoKSkgewogICAgICAgICAg\nICAgICAgICAgIGZvciAoRmlsZSBwYXJlbnQgOiBncmFuZFBhcmVudC5saXN0\nRmlsZXMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyZW50\nLmlzRGlyZWN0b3J5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZvciAoRmlsZSBpbmRleCA6IHBhcmVudC5saXN0RmlsZXMoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5kZXguaXNGaWxl\nKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8\nICghaW5kZXguZ2V0TmFtZSgpLmVuZHNXaXRoKElEWCkgJiYgIWluZGV4Lmdl\ndE5hbWUoKS5lbmRzV2l0aChSTE9DKSkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBXZSd2ZSBmb3VuZCBhIGxlZGdlciBpbmRleCBmaWxlLiBUaGUg\nZmlsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hbWUg\naXMgdGhlIEhleFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsZWRnZXJJZC4KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgbGVkZ2VySWRJbkhl\neCA9IGluZGV4LmdldE5hbWUoKS5yZXBsYWNlKFJMT0MsICIiKS5yZXBsYWNl\nKElEWCwgIiIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChpbmRleC5nZXROYW1lKCkuZW5kc1dpdGgoUkxPQykpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmRJbmRleEZpbGUo\nTG9uZy5wYXJzZUxvbmcobGVkZ2VySWRJbkhleCkpICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaW5k\nZXguZGVsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cud2FybigiRGVsZXRpbmcgdGhlIHJsb2MgZmls\nZSAiICsgaW5kZXggKyAiIGZhaWxlZCIpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBGaWxlIGRlc3QgPSBuZXcgRmlsZShp\nbmRleC5nZXRQYXJlbnRGaWxlKCksIGxlZGdlcklkSW5IZXggKyBJRFgpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFp\nbmRleC5yZW5hbWVUbyhkZXN0KSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigi\nUmVuYW1pbmcgcmxvYyBmaWxlICIgKyBpbmRleAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHRvIGlu\nZGV4IGZpbGUgaGFzIGZhaWxlZCIpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZUxlZGdl\ncnMucHV0KExvbmcucGFyc2VMb25nKGxlZGdlcklkSW5IZXgsIDE2KSwgdHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBs\nZWRnZXIgaXMgZGVsZXRlZCBieSB0aGUgQm9va0tlZXBlciBDbGllbnQKICAg\nICAqIGFuZCB3ZSB3YW50IHRvIHJlbW92ZSBhbGwgcmVsZXZhbnQgZGF0YSBm\nb3IgaXQgc3RvcmVkIGluIHRoZSBMZWRnZXJDYWNoZS4KICAgICAqLwogICAg\ndm9pZCByZW1vdmVMZWRnZXIobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBEZWxldGUgdGhlIGxlZGdlcidzIGluZGV4\nIGZpbGUgYW5kIGNsb3NlIHRoZSBGaWxlSW5mbwogICAgICAgIEZpbGVJbmZv\nIGZpID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBmaSA9IGdl\ndEZpbGVJbmZvKGxlZGdlcklkLCBudWxsKTsKICAgICAgICAgICAgZmkuY2xv\nc2UoZmFsc2UpOwogICAgICAgICAgICBmaS5kZWxldGUoKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAvLyBzaG91bGQgcmVsZWFzZSB1c2Ug\nY291bnQKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHRoZSBmaWxlIGNoYW5u\nZWwgd291bGQgbm90IGJlIGNsb3NlZC4KICAgICAgICAgICAgaWYgKG51bGwg\nIT0gZmkpIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gUmVtb3ZlIGl0IGZyb20g\ndGhlIGFjdGl2ZSBsZWRnZXIgbWFuYWdlcgogICAgICAgIGFjdGl2ZUxlZGdl\ncnMucmVtb3ZlKGxlZGdlcklkKTsKCiAgICAgICAgLy8gTm93IHJlbW92ZSBp\ndCBmcm9tIGFsbCB0aGUgb3RoZXIgbGlzdHMgYW5kIG1hcHMuCiAgICAgICAg\nZmlsZUluZm9DYWNoZS5yZW1vdmUobGVkZ2VySWQpOwogICAgICAgIHN5bmNo\ncm9uaXplZCAob3BlbkxlZGdlcnMpIHsKICAgICAgICAgICAgb3BlbkxlZGdl\ncnMucmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSBGaWxlIGZpbmRJbmRleEZpbGUobG9uZyBsZWRnZXJJZCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbGVkZ2VyTmFtZSA9IGdl\ndExlZGdlck5hbWUobGVkZ2VySWQpOwogICAgICAgIGZvciAoRmlsZSBkIDog\nbGVkZ2VyRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAg\nICAgICAgIEZpbGUgbGYgPSBuZXcgRmlsZShkLCBsZWRnZXJOYW1lKTsKICAg\nICAgICAgICAgaWYgKGxmLmV4aXN0cygpKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gbGY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICB9CgogICAgYm9vbGVhbiBsZWRnZXJFeGlzdHMobG9u\nZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxl\nSW5mbyBmaSA9IGZpbGVJbmZvQ2FjaGUuZ2V0KGxlZGdlcklkKTsKICAgICAg\nICBpZiAoZmkgPT0gbnVsbCkgewogICAgICAgICAgICBGaWxlIGxmID0gZmlu\nZEluZGV4RmlsZShsZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChsZiA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9Cgog\nICAgaW50IGdldE51bU9wZW5MZWRnZXJzKCkgewogICAgICAgIHJldHVybiBv\ncGVuTGVkZ2Vycy5zaXplKCk7CiAgICB9CgogICAgLy8gZXZpY3QgZmlsZSBp\nbmZvIGlmIG5lY2Vzc2FyeQogICAgcHJpdmF0ZSB2b2lkIGV2aWN0RmlsZUlu\nZm9JZk5lY2Vzc2FyeSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKG9wZW5MZWRnZXJzLnNpemUoKSA+IG9wZW5GaWxlTGltaXQpIHsKICAg\nICAgICAgICAgTG9uZyBsZWRnZXJUb1JlbW92ZTsKICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChvcGVuTGVkZ2VycykgewogICAgICAgICAgICAgICAgbGVk\nZ2VyVG9SZW1vdmUgPSBvcGVuTGVkZ2Vycy5wb2xsKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaWYgKG51bGwgPT0gbGVkZ2VyVG9SZW1vdmUpIHsK\nICAgICAgICAgICAgICAgIC8vIFNob3VsZCBub3QgcmVhY2ggaGVyZS4gV2Ug\ncHJvYmFibHkgY2xlYXJlZCB0aGlzIHdoaWxlIHRoZSB0aHJlYWQKICAgICAg\nICAgICAgICAgIC8vIHdhcyBleGVjdXRpbmcuCiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXZpY3RlZExlZGdl\ncnNDb3VudGVyLmluYygpOwogICAgICAgICAgICBGaWxlSW5mbyBmaSA9IGZp\nbGVJbmZvQ2FjaGUucmVtb3ZlKGxlZGdlclRvUmVtb3ZlKTsKICAgICAgICAg\nICAgaWYgKG51bGwgPT0gZmkpIHsKICAgICAgICAgICAgICAgIC8vIFNlZW1z\nIGxpa2Ugc29tZW9uZSBlbHNlIGFscmVhZHkgY2xvc2VkIHRoZSBmaWxlLgog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGZpLmNsb3NlKHRydWUpOwogICAgICAgICB9CiAgICB9CgogICAgdm9p\nZCBjbG9zZSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChF\nbnRyeTxMb25nLCBGaWxlSW5mbz4gZmlsZUluZm8gOiBmaWxlSW5mb0NhY2hl\nLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgRmlsZUluZm8gdmFsdWUgPSBm\naWxlSW5mby5nZXRWYWx1ZSgpOwogICAgICAgICAgICBpZiAodmFsdWUgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgdmFsdWUuY2xvc2UodHJ1ZSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZmlsZUluZm9DYWNoZS5j\nbGVhcigpOwogICAgfQoKICAgIGJ5dGVbXSByZWFkTWFzdGVyS2V5KGxvbmcg\nbGVkZ2VySWQpIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9u\nIHsKICAgICAgICBGaWxlSW5mbyBmaSA9IGZpbGVJbmZvQ2FjaGUuZ2V0KGxl\nZGdlcklkKTsKICAgICAgICBpZiAoZmkgPT0gbnVsbCkgewogICAgICAgICAg\nICBGaWxlIGxmID0gZmluZEluZGV4RmlsZShsZWRnZXJJZCk7CiAgICAgICAg\nICAgIGlmIChsZiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQm9va2llLk5vTGVkZ2VyRXhjZXB0aW9uKGxlZGdlcklkKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBmaSA9IHB1dEZpbGVJbmZvKGxlZGdlcklk\nLCBudWxsLCBsZiwgZmFsc2UpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nZmkuZ2V0TWFzdGVyS2V5KCk7CiAgICB9CgogICAgdm9pZCBzZXRNYXN0ZXJL\nZXkobG9uZyBsZWRnZXJJZCwgYnl0ZVtdIG1hc3RlcktleSkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZmkgPSBnZXRGaWxlSW5mbyhsZWRnZXJJ\nZCwgbWFzdGVyS2V5KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAobnVsbCAhPSBmaSkgewogICAgICAgICAgICAgICAgZmkucmVsZWFz\nZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGJvb2xl\nYW4gc2V0RmVuY2VkKGxvbmcgbGVkZ2VySWQpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgRmlsZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGZpID0gZ2V0RmlsZUluZm8obGVkZ2VySWQsIG51bGwp\nOwogICAgICAgICAgICByZXR1cm4gZmkuc2V0RmVuY2VkKCk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKG51bGwgIT0gZmkpIHsKICAg\nICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KICAgIH0KCiAgICBib29sZWFuIGlzRmVuY2VkKGxvbmcgbGVkZ2Vy\nSWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZUluZm8gZmkg\nPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpID0gZ2V0Rmls\nZUluZm8obGVkZ2VySWQsIG51bGwpOwogICAgICAgICAgICByZXR1cm4gZmku\naXNGZW5jZWQoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBp\nZiAobnVsbCAhPSBmaSkgewogICAgICAgICAgICAgICAgZmkucmVsZWFzZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGludCBnZXRP\ncGVuRmlsZUxpbWl0KCkgewogICAgICAgIHJldHVybiBvcGVuRmlsZUxpbWl0\nOwogICAgfQoKICAgIHByaXZhdGUgTGVkZ2VyRGlyc0xpc3RlbmVyIGdldExl\nZGdlckRpcnNMaXN0ZW5lcigpIHsKICAgICAgICByZXR1cm4gbmV3IExlZGdl\nckRpcnNMaXN0ZW5lcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIGRpc2tGdWxsKEZpbGUgZGlzaykgewogICAg\nICAgICAgICAgICAgLy8gTm90aGluZyB0byBoYW5kbGUgaGVyZS4gV2lsbCBi\nZSBoYW5kbGVkIGluIEJvb2tpZQogICAgICAgICAgICB9CgogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgZGlza0FsbW9z\ndEZ1bGwoRmlsZSBkaXNrKSB7CiAgICAgICAgICAgICAgICAvLyBOb3RoaW5n\nIHRvIGhhbmRsZSBoZXJlLiBXaWxsIGJlIGhhbmRsZWQgaW4gQm9va2llCiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBkaXNrRmFpbGVkKEZpbGUgZGlzaykgewogICAgICAg\nICAgICAgICAgLy8gTm90aGluZyB0byBoYW5kbGUgaGVyZS4gV2lsbCBiZSBo\nYW5kbGVkIGluIEJvb2tpZQogICAgICAgICAgICB9CgogICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgYWxsRGlza3NGdWxs\nKCkgewogICAgICAgICAgICAgICAgLy8gTm90aGluZyB0byBoYW5kbGUgaGVy\nZS4gV2lsbCBiZSBoYW5kbGVkIGluIEJvb2tpZQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\nZmF0YWxFcnJvcigpIHsKICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgdG8g\naGFuZGxlIGhlcmUuIFdpbGwgYmUgaGFuZGxlZCBpbiBCb29raWUKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIGRpc2tXcml0YWJsZShGaWxlIGRpc2spIHsKICAgICAgICAg\nICAgICAgIC8vIE5vdGhpbmcgdG8gaGFuZGxlIGhlcmUuIFdpbGwgYmUgaGFu\nZGxlZCBpbiBCb29raWUKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGRpc2tKdXN0V3JpdGFi\nbGUoRmlsZSBkaXNrKSB7CiAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIHRv\nIGhhbmRsZSBoZXJlLiBXaWxsIGJlIGhhbmRsZWQgaW4gQm9va2llCiAgICAg\nICAgICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBy\nZWxvY2F0ZUluZGV4RmlsZUFuZEZsdXNoSGVhZGVyKGxvbmcgbGVkZ2VyLCBG\naWxlSW5mbyBmaSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxl\nIGN1cnJlbnREaXIgPSBnZXRMZWRnZXJEaXJGb3JMZWRnZXIoZmkpOwogICAg\nICAgIGlmIChsZWRnZXJEaXJzTWFuYWdlci5pc0RpckZ1bGwoY3VycmVudERp\ncikpIHsKICAgICAgICAgICAgbW92ZUxlZGdlckluZGV4RmlsZShsZWRnZXIs\nIGZpKTsKICAgICAgICB9CiAgICAgICAgZmkuZmx1c2hIZWFkZXIoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgbGVkZ2VyIGRpcmVjdG9yeSB0\naGF0IHRoZSBsZWRnZXIgaW5kZXggYmVsb25ncyB0by4KICAgICAqCiAgICAg\nKiBAcGFyYW0gZmkgRmlsZSBpbmZvIG9mIGEgbGVkZ2VyCiAgICAgKiBAcmV0\ndXJuIGxlZGdlciBkaXJlY3RvcnkgdGhhdCB0aGUgbGVkZ2VyIGJlbG9uZ3Mg\ndG8uCiAgICAgKi8KICAgIHByaXZhdGUgRmlsZSBnZXRMZWRnZXJEaXJGb3JM\nZWRnZXIoRmlsZUluZm8gZmkpIHsKICAgICAgICByZXR1cm4gZmkuZ2V0TGYo\nKS5nZXRQYXJlbnRGaWxlKCkuZ2V0UGFyZW50RmlsZSgpLmdldFBhcmVudEZp\nbGUoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgbW92ZUxlZGdlckluZGV4\nRmlsZShMb25nIGwsIEZpbGVJbmZvIGZpKSB0aHJvd3MgTm9Xcml0YWJsZUxl\nZGdlckRpckV4Y2VwdGlvbiwgSU9FeGNlcHRpb24gewogICAgICAgIEZpbGUg\nbmV3TGVkZ2VySW5kZXhGaWxlID0gZ2V0TmV3TGVkZ2VySW5kZXhGaWxlKGws\nIGdldExlZGdlckRpckZvckxlZGdlcihmaSkpOwogICAgICAgIGZpLm1vdmVU\nb05ld0xvY2F0aW9uKG5ld0xlZGdlckluZGV4RmlsZSwgZmkuZ2V0U2l6ZVNp\nbmNlTGFzdHdyaXRlKCkpOwogICAgfQoKICAgIHZvaWQgZmx1c2hMZWRnZXJI\nZWFkZXIobG9uZyBsZWRnZXIpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgRmlsZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZpID0gZ2V0RmlsZUluZm8obGVkZ2VyLCBudWxsKTsKICAgICAgICAg\nICAgcmVsb2NhdGVJbmRleEZpbGVBbmRGbHVzaEhlYWRlcihsZWRnZXIsIGZp\nKTsKICAgICAgICB9IGNhdGNoIChCb29raWUuTm9MZWRnZXJFeGNlcHRpb24g\nbmxlKSB7CiAgICAgICAgICAgIC8vIGxlZGdlciBoYXMgYmVlbiBkZWxldGVk\nCiAgICAgICAgICAgIExPRy5pbmZvKCJObyBsZWRnZXIge30gZm91bmQgd2hl\nbiBmbHVzaGluZyBoZWFkZXIuIiwgbGVkZ2VyKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChudWxs\nICE9IGZpKSB7CiAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgdm9pZCBmbHVzaExlZGdl\nckVudHJpZXMobG9uZyBsLCBMaXN0PExlZGdlckVudHJ5UGFnZT4gZW50cmll\ncykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlSW5mbyBmaSA9\nIG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQ29sbGVjdGlvbnMu\nc29ydChlbnRyaWVzLCBuZXcgQ29tcGFyYXRvcjxMZWRnZXJFbnRyeVBhZ2U+\nKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICBwdWJsaWMgaW50IGNvbXBhcmUoTGVkZ2VyRW50cnlQYWdlIG8xLCBMZWRn\nZXJFbnRyeVBhZ2UgbzIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nKGludCkgKG8xLmdldEZpcnN0RW50cnkoKSAtIG8yLmdldEZpcnN0RW50cnko\nKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAg\nICAgICBpbnRbXSB2ZXJzaW9ucyA9IG5ldyBpbnRbZW50cmllcy5zaXplKCld\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZmkgPSBnZXRG\naWxlSW5mbyhsLCBudWxsKTsKICAgICAgICAgICAgfSBjYXRjaCAoQm9va2ll\nLk5vTGVkZ2VyRXhjZXB0aW9uIG5sZSkgewogICAgICAgICAgICAgICAgLy8g\nbGVkZ2VyIGhhcyBiZWVuIGRlbGV0ZWQKICAgICAgICAgICAgICAgIExPRy5p\nbmZvKCJObyBsZWRnZXIge30gZm91bmQgd2hlbiBmbHVzaGluZyBlbnRyaWVz\nLiIsIGwpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBmbHVzaCB0aGUgaGVhZGVyIGlmIG5lY2Vzc2Fy\neQogICAgICAgICAgICByZWxvY2F0ZUluZGV4RmlsZUFuZEZsdXNoSGVhZGVy\nKGwsIGZpKTsKICAgICAgICAgICAgaW50IHN0YXJ0ID0gMDsKICAgICAgICAg\nICAgbG9uZyBsYXN0T2Zmc2V0ID0gLTE7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgZW50cmllcy5zaXplKCk7IGkrKykgewogICAgICAgICAg\nICAgICAgdmVyc2lvbnNbaV0gPSBlbnRyaWVzLmdldChpKS5nZXRWZXJzaW9u\nKCk7CiAgICAgICAgICAgICAgICBpZiAobGFzdE9mZnNldCAhPSAtMSAmJiAo\nZW50cmllcy5nZXQoaSkuZ2V0Rmlyc3RFbnRyeSgpIC0gbGFzdE9mZnNldCkg\nIT0gZW50cmllc1BlclBhZ2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBz\nZW5kIHVwIGEgc2VxdWVudGlhbCBsaXN0CiAgICAgICAgICAgICAgICAgICAg\naW50IGNvdW50ID0gaSAtIHN0YXJ0OwogICAgICAgICAgICAgICAgICAgIGlm\nIChjb3VudCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy53\nYXJuKCJDb3VudCBjYW5ub3QgcG9zc2libHkgYmUgemVybyEiKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgd3JpdGVCdWZm\nZXJzKGwsIGVudHJpZXMsIGZpLCBzdGFydCwgY291bnQpOwogICAgICAgICAg\nICAgICAgICAgIHN0YXJ0ID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIGxhc3RPZmZzZXQgPSBlbnRyaWVzLmdldChpKS5nZXRGaXJz\ndEVudHJ5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGVudHJp\nZXMuc2l6ZSgpIC0gc3RhcnQgPT0gMCAmJiBlbnRyaWVzLnNpemUoKSAhPSAw\nKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiTm90aGluZyB0byB3cml0\nZSwgYnV0IHRoZXJlIHdlcmUgZW50cmllcyEiKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICB3cml0ZUJ1ZmZlcnMobCwgZW50cmllcywgZmksIHN0YXJ0\nLCBlbnRyaWVzLnNpemUoKSAtIHN0YXJ0KTsKICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBlbnRyaWVzLnNpemUoKTsgaSsrKSB7CiAgICAgICAg\nICAgICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gZW50cmllcy5nZXQoaSk7\nCiAgICAgICAgICAgICAgICBsZXAuc2V0Q2xlYW4odmVyc2lvbnNbaV0pOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJGbHVzaGVkIGxl\nZGdlciB7fSB3aXRoIHt9IHBhZ2VzLiIsIGwsIGVudHJpZXMuc2l6ZSgpKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChmaSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaS5yZWxlYXNl\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSB2b2lkIHdyaXRlQnVmZmVycyhMb25nIGxlZGdlciwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgTGlzdDxMZWRnZXJFbnRyeVBhZ2U+IGVudHJp\nZXMsIEZpbGVJbmZvIGZpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpbnQgc3RhcnQsIGludCBjb3VudCkgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAg\nICAgTE9HLnRyYWNlKCJXcml0aW5nIHt9IGJ1ZmZlcnMgb2Yge30iLCBjb3Vu\ndCwgTG9uZy50b0hleFN0cmluZyhsZWRnZXIpKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKGNvdW50ID09IDApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICBCeXRlQnVmZmVyIGJ1ZmZzW10gPSBuZXcgQnl0ZUJ1\nZmZlcltjb3VudF07CiAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBjb3Vu\ndDsgaisrKSB7CiAgICAgICAgICAgIGJ1ZmZzW2pdID0gZW50cmllcy5nZXQo\nc3RhcnQgKyBqKS5nZXRQYWdlVG9Xcml0ZSgpOwogICAgICAgICAgICBpZiAo\nZW50cmllcy5nZXQoc3RhcnQgKyBqKS5nZXRMZWRnZXIoKSAhPSBsZWRnZXIp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiV3Jp\ndGluZyB0byAiICsgbGVkZ2VyICsgIiBidXQgcGFnZSBiZWxvbmdzIHRvICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGVudHJpZXMuZ2V0\nKHN0YXJ0ICsgaikuZ2V0TGVkZ2VyKCkpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGxvbmcgdG90YWxXcml0dGVuID0gMDsKICAgICAgICB3\naGlsZSAoYnVmZnNbYnVmZnMubGVuZ3RoIC0gMV0ucmVtYWluaW5nKCkgPiAw\nKSB7CiAgICAgICAgICAgIGxvbmcgcmMgPSBmaS53cml0ZShidWZmcywgZW50\ncmllcy5nZXQoc3RhcnQgKyAwKS5nZXRGaXJzdEVudHJ5UG9zaXRpb24oKSk7\nCiAgICAgICAgICAgIGlmIChyYyA8PSAwKSB7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSU9FeGNlcHRpb24oIlNob3J0IHdyaXRlIHRvIGxlZGdlciAi\nICsgbGVkZ2VyICsgIiByYyA9ICIgKyByYyk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgdG90YWxXcml0dGVuICs9IHJjOwogICAgICAgIH0KICAgICAg\nICBpZiAodG90YWxXcml0dGVuICE9IChsb25nKSBjb3VudCAqIChsb25nKSBw\nYWdlU2l6ZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24o\nIlNob3J0IHdyaXRlIHRvIGxlZGdlciAiICsgbGVkZ2VyICsgIiB3cm90ZSAi\nICsgdG90YWxXcml0dGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nICIgZXhwZWN0ZWQgIiArIGNvdW50ICogcGFnZVNpemUpOwogICAgICAgIH0K\nICAgIH0KCiAgICB2b2lkIHVwZGF0ZVBhZ2UoTGVkZ2VyRW50cnlQYWdlIGxl\ncCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWxlcC5pc0Ns\nZWFuKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJU\ncnlpbmcgdG8gdXBkYXRlIGEgZGlydHkgcGFnZSIpOwogICAgICAgIH0KICAg\nICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZmkgPSBnZXRGaWxlSW5mbyhsZXAuZ2V0TGVkZ2VyKCksIG51bGwp\nOwogICAgICAgICAgICBsb25nIHBvcyA9IGxlcC5nZXRGaXJzdEVudHJ5UG9z\naXRpb24oKTsKICAgICAgICAgICAgaWYgKHBvcyA+PSBmaS5zaXplKCkpIHsK\nICAgICAgICAgICAgICAgIGxlcC56ZXJvUGFnZSgpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgbGVwLnJlYWRQYWdlKGZpKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlm\nIChmaSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBmaS5yZWxlYXNlKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgbG9uZyBnZXRQ\nZXJzaXN0RW50cnlCZXlvbmRJbk1lbShsb25nIGxlZGdlcklkLCBsb25nIGxh\nc3RFbnRyeUluTWVtKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIEZp\nbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICBsb25nIGxhc3RFbnRyeSA9IGxh\nc3RFbnRyeUluTWVtOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpID0g\nZ2V0RmlsZUluZm8obGVkZ2VySWQsIG51bGwpOwogICAgICAgICAgICBsb25n\nIHNpemUgPSBmaS5zaXplKCk7CiAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0\naGUgZmlsZSBzaXplIGlzIGFsaWduZWQgd2l0aCBpbmRleCBlbnRyeSBzaXpl\nCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZSBtYXkgcmVhZCBpbmNvcnJl\ndCBkYXRhCiAgICAgICAgICAgIGlmICgwICE9IHNpemUgJSBMZWRnZXJFbnRy\neVBhZ2UuZ2V0SW5kZXhFbnRyeVNpemUoKSkgewogICAgICAgICAgICAgICAg\nTE9HLndhcm4oIkluZGV4IGZpbGUgb2YgbGVkZ2VyIHt9IGlzIG5vdCBhbGln\nbmVkIHdpdGggaW5kZXggZW50cnkgc2l6ZS4iLCBsZWRnZXJJZCk7CiAgICAg\nICAgICAgICAgICBzaXplID0gc2l6ZSAtIHNpemUgJSBMZWRnZXJFbnRyeVBh\nZ2UuZ2V0SW5kZXhFbnRyeVNpemUoKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICAvLyB3ZSBtYXkgbm90IGhhdmUgdGhlIGxhc3QgZW50cnkgaW4gdGhl\nIGNhY2hlCiAgICAgICAgICAgIGlmIChzaXplID4gbGFzdEVudHJ5ICogTGVk\nZ2VyRW50cnlQYWdlLmdldEluZGV4RW50cnlTaXplKCkpIHsKICAgICAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKHBh\nZ2VTaXplKTsKICAgICAgICAgICAgICAgIGxvbmcgcG9zaXRpb24gPSBzaXpl\nIC0gcGFnZVNpemU7CiAgICAgICAgICAgICAgICBpZiAocG9zaXRpb24gPCAw\nKSB7CiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb24gPSAwOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgZmkucmVhZChiYiwgcG9zaXRp\nb24pOwogICAgICAgICAgICAgICAgYmIuZmxpcCgpOwogICAgICAgICAgICAg\nICAgbG9uZyBzdGFydGluZ0VudHJ5SWQgPSBwb3NpdGlvbiAvIExlZGdlckVu\ndHJ5UGFnZS5nZXRJbmRleEVudHJ5U2l6ZSgpOwogICAgICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IGVudHJpZXNQZXJQYWdlIC0gMTsgaSA+PSAwOyBpLS0p\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoYmIuZ2V0TG9uZyhpICogTGVk\nZ2VyRW50cnlQYWdlLmdldEluZGV4RW50cnlTaXplKCkpICE9IDApIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RFbnRyeSA8IHN0YXJ0aW5n\nRW50cnlJZCArIGkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxh\nc3RFbnRyeSA9IHN0YXJ0aW5nRW50cnlJZCArIGk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGZp\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGFzdEVudHJ5\nOwogICAgfQoKfQo=\n","encoding":"base64"}

