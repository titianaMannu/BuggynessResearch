{"sha":"1a69692207b6b1a65a8590a99fa8596febd3e81c","node_id":"MDQ6QmxvYjE1NzU5NTY6MWE2OTY5MjIwN2I2YjFhNjVhODU5MGE5OWZhODU5NmZlYmQzZTgxYw==","size":12656,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1a69692207b6b1a65a8590a99fa8596febd3e81c","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5DaGVja3BvaW50U291cmNlLkNoZWNr\ncG9pbnQ7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkVu\ndHJ5TG9nZ2VyLkVudHJ5TG9nTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuYm9va2llLkxlZGdlckRpcnNNYW5hZ2VyLkxlZGdlckRp\ncnNMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuam14LkJLTUJlYW5JbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5Cb29raWVQcm90b2NvbDsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5zdGF0cy5OdWxsU3RhdHNMb2dnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RhdHMuT3BTdGF0c0xvZ2dlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5TdGF0c0xvZ2dl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLk1hdGhVdGls\nczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlNuYXBzaG90\nTWFwOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuYm9va2llLkJvb2tLZWVwZXJTZXJ2ZXJTdGF0cy5TVE9SQUdF\nX0dFVF9FTlRSWTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuYm9va2llLkJvb2tLZWVwZXJTZXJ2ZXJTdGF0cy5TVE9SQUdFX0dFVF9P\nRkZTRVQ7CgovKioKICogSW50ZXJsZWF2ZSBsZWRnZXIgc3RvcmFnZQogKiBU\naGlzIGxlZGdlciBzdG9yYWdlIGltcGxlbWVudGF0aW9uIHN0b3JlcyBhbGwg\nZW50cmllcyBpbiBhIHNpbmdsZQogKiBmaWxlIGFuZCBtYWludGFpbnMgYW4g\naW5kZXggZmlsZSBmb3IgZWFjaCBsZWRnZXIuCiAqLwpjbGFzcyBJbnRlcmxl\nYXZlZExlZGdlclN0b3JhZ2UgaW1wbGVtZW50cyBMZWRnZXJTdG9yYWdlLCBF\nbnRyeUxvZ0xpc3RlbmVyIHsKICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExv\nZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihJbnRlcmxlYXZl\nZExlZGdlclN0b3JhZ2UuY2xhc3MpOwoKICAgIC8vIEhvbGQgdGhlIGxhc3Qg\nY2hlY2twb2ludAogICAgcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBDaGVja3Bv\naW50SG9sZGVyIHsKICAgICAgICBDaGVja3BvaW50IGxhc3RDaGVja3BvaW50\nID0gQ2hlY2twb2ludC5NQVg7CgogICAgICAgIHByb3RlY3RlZCBzeW5jaHJv\nbml6ZWQgdm9pZCBzZXROZXh0Q2hlY2twb2ludChDaGVja3BvaW50IGNwKSB7\nCiAgICAgICAgICAgIGlmIChDaGVja3BvaW50Lk1BWC5lcXVhbHMobGFzdENo\nZWNrcG9pbnQpIHx8IGxhc3RDaGVja3BvaW50LmNvbXBhcmVUbyhjcCkgPCAw\nKSB7CiAgICAgICAgICAgICAgICBsYXN0Q2hlY2twb2ludCA9IGNwOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgc3luY2hy\nb25pemVkIHZvaWQgY2xlYXJMYXN0Q2hlY2twb2ludChDaGVja3BvaW50IGRv\nbmUpIHsKICAgICAgICAgICAgaWYgKDAgPT0gbGFzdENoZWNrcG9pbnQuY29t\ncGFyZVRvKGRvbmUpKSB7CiAgICAgICAgICAgICAgICBsYXN0Q2hlY2twb2lu\ndCA9IENoZWNrcG9pbnQuTUFYOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgc3luY2hyb25pemVkIENoZWNrcG9pbnQgZ2V0\nTGFzdENoZWNrcG9pbnQoKSB7CiAgICAgICAgICAgIHJldHVybiBsYXN0Q2hl\nY2twb2ludDsKICAgICAgICB9CiAgICB9CgogICAgRW50cnlMb2dnZXIgZW50\ncnlMb2dnZXI7CiAgICBMZWRnZXJDYWNoZSBsZWRnZXJDYWNoZTsKICAgIHBy\naXZhdGUgZmluYWwgQ2hlY2twb2ludFNvdXJjZSBjaGVja3BvaW50U291cmNl\nOwogICAgcHJvdGVjdGVkIGZpbmFsIENoZWNrcG9pbnRIb2xkZXIgY2hlY2tw\nb2ludEhvbGRlciA9IG5ldyBDaGVja3BvaW50SG9sZGVyKCk7CgogICAgLy8g\nQSBzb3J0ZWQgbWFwIHRvIHN0b3JlZCBhbGwgYWN0aXZlIGxlZGdlciBpZHMK\nICAgIHByb3RlY3RlZCBmaW5hbCBTbmFwc2hvdE1hcDxMb25nLCBCb29sZWFu\nPiBhY3RpdmVMZWRnZXJzOwoKICAgIC8vIFRoaXMgaXMgdGhlIHRocmVhZCB0\naGF0IGdhcmJhZ2UgY29sbGVjdHMgdGhlIGVudHJ5IGxvZ3MgdGhhdCBkbyBu\nb3QKICAgIC8vIGNvbnRhaW4gYW55IGFjdGl2ZSBsZWRnZXJzIGluIHRoZW07\nIGFuZCBjb21wYWN0cyB0aGUgZW50cnkgbG9ncyB0aGF0CiAgICAvLyBoYXMg\nbG93ZXIgcmVtYWluaW5nIHBlcmNlbnRhZ2UgdG8gcmVjbGFpbSBkaXNrIHNw\nYWNlLgogICAgZmluYWwgR2FyYmFnZUNvbGxlY3RvclRocmVhZCBnY1RocmVh\nZDsKCiAgICAvLyB0aGlzIGluZGljYXRlcyB0aGF0IGEgd3JpdGUgaGFzIGhh\ncHBlbmVkIHNpbmNlIHRoZSBsYXN0IGZsdXNoCiAgICBwcml2YXRlIHZvbGF0\naWxlIGJvb2xlYW4gc29tZXRoaW5nV3JpdHRlbiA9IGZhbHNlOwoKICAgIC8v\nIEV4cG9zZSBTdGF0cwogICAgcHJpdmF0ZSBmaW5hbCBPcFN0YXRzTG9nZ2Vy\nIGdldE9mZnNldFN0YXRzOwogICAgcHJpdmF0ZSBmaW5hbCBPcFN0YXRzTG9n\nZ2VyIGdldEVudHJ5U3RhdHM7CgogICAgSW50ZXJsZWF2ZWRMZWRnZXJTdG9y\nYWdlKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiwgTGVkZ2VyTWFuYWdlciBs\nZWRnZXJNYW5hZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIExl\nZGdlckRpcnNNYW5hZ2VyIGxlZGdlckRpcnNNYW5hZ2VyLCBDaGVja3BvaW50\nU291cmNlIGNoZWNrcG9pbnRTb3VyY2UpCiAgICAgICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgdGhpcyhjb25mLCBsZWRnZXJNYW5hZ2Vy\nLCBsZWRnZXJEaXJzTWFuYWdlciwgbGVkZ2VyRGlyc01hbmFnZXIsIGNoZWNr\ncG9pbnRTb3VyY2UsIE51bGxTdGF0c0xvZ2dlci5JTlNUQU5DRSk7CiAgICB9\nCgogICAgSW50ZXJsZWF2ZWRMZWRnZXJTdG9yYWdlKFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZiwgTGVkZ2VyTWFuYWdlciBsZWRnZXJNYW5hZ2VyLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIExlZGdlckRpcnNNYW5hZ2VyIGxl\nZGdlckRpcnNNYW5hZ2VyLCBMZWRnZXJEaXJzTWFuYWdlciBpbmRleERpcnNN\nYW5hZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIENoZWNrcG9p\nbnRTb3VyY2UgY2hlY2twb2ludFNvdXJjZSwgU3RhdHNMb2dnZXIgc3RhdHNM\nb2dnZXIpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgYWN0aXZlTGVkZ2VycyA9IG5ldyBTbmFwc2hvdE1hcDxMb25nLCBCb29s\nZWFuPigpOwogICAgICAgIHRoaXMuY2hlY2twb2ludFNvdXJjZSA9IGNoZWNr\ncG9pbnRTb3VyY2U7CiAgICAgICAgZW50cnlMb2dnZXIgPSBuZXcgRW50cnlM\nb2dnZXIoY29uZiwgbGVkZ2VyRGlyc01hbmFnZXIsIHRoaXMpOwogICAgICAg\nIGxlZGdlckNhY2hlID0gbmV3IExlZGdlckNhY2hlSW1wbChjb25mLCBhY3Rp\ndmVMZWRnZXJzLAogICAgICAgICAgICAgICAgbnVsbCA9PSBpbmRleERpcnNN\nYW5hZ2VyID8gbGVkZ2VyRGlyc01hbmFnZXIgOiBpbmRleERpcnNNYW5hZ2Vy\nLCBzdGF0c0xvZ2dlcik7CiAgICAgICAgZ2NUaHJlYWQgPSBuZXcgR2FyYmFn\nZUNvbGxlY3RvclRocmVhZChjb25mLCBsZWRnZXJDYWNoZSwgZW50cnlMb2dn\nZXIsCiAgICAgICAgICAgICAgICBhY3RpdmVMZWRnZXJzLCBsZWRnZXJNYW5h\nZ2VyKTsKICAgICAgICBsZWRnZXJEaXJzTWFuYWdlci5hZGRMZWRnZXJEaXJz\nTGlzdGVuZXIoZ2V0TGVkZ2VyRGlyc0xpc3RlbmVyKCkpOwogICAgICAgIC8v\nIEV4cG9zZSBTdGF0cwogICAgICAgIGdldE9mZnNldFN0YXRzID0gc3RhdHNM\nb2dnZXIuZ2V0T3BTdGF0c0xvZ2dlcihTVE9SQUdFX0dFVF9PRkZTRVQpOwog\nICAgICAgIGdldEVudHJ5U3RhdHMgPSBzdGF0c0xvZ2dlci5nZXRPcFN0YXRz\nTG9nZ2VyKFNUT1JBR0VfR0VUX0VOVFJZKTsKICAgIH0KCiAgICBwcml2YXRl\nIExlZGdlckRpcnNMaXN0ZW5lciBnZXRMZWRnZXJEaXJzTGlzdGVuZXIoKSB7\nCiAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJEaXJzTGlzdGVuZXIoKSB7CiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBk\naXNrRmFpbGVkKEZpbGUgZGlzaykgewogICAgICAgICAgICAgICAgLy8gZG8g\nbm90aGluZy4KICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGRpc2tBbG1vc3RGdWxsKEZpbGUg\nZGlzaykgewogICAgICAgICAgICAgICAgZ2NUaHJlYWQuZW5hYmxlRm9yY2VH\nQygpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgZGlza0Z1bGwoRmlsZSBkaXNrKSB7CiAg\nICAgICAgICAgICAgICBnY1RocmVhZC5lbmFibGVGb3JjZUdDKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBhbGxEaXNrc0Z1bGwoKSB7CiAgICAgICAgICAgICAgICBn\nY1RocmVhZC5lbmFibGVGb3JjZUdDKCk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBmYXRh\nbEVycm9yKCkgewogICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZy4KICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIGRpc2tXcml0YWJsZShGaWxlIGRpc2spIHsKICAgICAg\nICAgICAgICAgIC8vIHdlIGhhdmUgZW5vdWdoIHNwYWNlIG5vdywgZGlzYWJs\nZSBmb3JjZSBnYy4KICAgICAgICAgICAgICAgIGdjVGhyZWFkLmRpc2FibGVG\nb3JjZUdDKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBkaXNrSnVzdFdyaXRhYmxlKEZp\nbGUgZGlzaykgewogICAgICAgICAgICAgICAgLy8gaWYgYSBkaXNrIGlzIGp1\nc3Qgd3JpdGFibGUsIHdlIHN0aWxsIG5lZWQgZm9yY2UgZ2MuCiAgICAgICAg\nICAgICAgICBnY1RocmVhZC5lbmFibGVGb3JjZUdDKCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgc3RhcnQoKSB7CiAgICAgICAgZ2NUaHJlYWQuc3RhcnQoKTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNodXRkb3duKCkg\ndGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAvLyBzaHV0\nIGRvd24gZ2MgdGhyZWFkLCB3aGljaCBkZXBlbmRzIG9uIHpvb2tlZXBlciBj\nbGllbnQKICAgICAgICAvLyBhbHNvIGNvbXBhY3Rpb24gd2lsbCB3cml0ZSBl\nbnRyaWVzIGFnYWluIHRvIGVudHJ5IGxvZyBmaWxlCiAgICAgICAgTE9HLmlu\nZm8oIlNodXR0aW5nIGRvd24gSW50ZXJsZWF2ZWRMZWRnZXJTdG9yYWdlIik7\nCiAgICAgICAgZ2NUaHJlYWQuc2h1dGRvd24oKTsKICAgICAgICBlbnRyeUxv\nZ2dlci5zaHV0ZG93bigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxl\nZGdlckNhY2hlLmNsb3NlKCk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHdoaWxlIGNs\nb3NpbmcgdGhlIGxlZGdlciBjYWNoZSIsIGUpOwogICAgICAgIH0KICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBib29sZWFuIHNldEZlbmNlZChs\nb25nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHJl\ndHVybiBsZWRnZXJDYWNoZS5zZXRGZW5jZWQobGVkZ2VySWQpOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xlYW4gaXNGZW5jZWQobG9u\nZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gbGVkZ2VyQ2FjaGUuaXNGZW5jZWQobGVkZ2VySWQpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0TWFzdGVyS2V5KGxvbmcg\nbGVkZ2VySWQsIGJ5dGVbXSBtYXN0ZXJLZXkpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgbGVkZ2VyQ2FjaGUuc2V0TWFzdGVyS2V5KGxlZGdlcklk\nLCBtYXN0ZXJLZXkpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIGJ5dGVbXSByZWFkTWFzdGVyS2V5KGxvbmcgbGVkZ2VySWQpIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\nbGVkZ2VyQ2FjaGUucmVhZE1hc3RlcktleShsZWRnZXJJZCk7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYm9vbGVhbiBsZWRnZXJFeGlzdHMo\nbG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBy\nZXR1cm4gbGVkZ2VyQ2FjaGUubGVkZ2VyRXhpc3RzKGxlZGdlcklkKTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHN5bmNocm9uaXplZCBwdWJsaWMgbG9u\nZyBhZGRFbnRyeShCeXRlQnVmZmVyIGVudHJ5KSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGxvbmcgbGVkZ2VySWQgPSBlbnRyeS5nZXRMb25nKCk7\nCiAgICAgICAgbG9uZyBlbnRyeUlkID0gZW50cnkuZ2V0TG9uZygpOwogICAg\nICAgIGVudHJ5LnJld2luZCgpOwoKICAgICAgICBwcm9jZXNzRW50cnkobGVk\nZ2VySWQsIGVudHJ5SWQsIGVudHJ5KTsKCiAgICAgICAgcmV0dXJuIGVudHJ5\nSWQ7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgQnl0ZUJ1ZmZl\nciBnZXRFbnRyeShsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQpIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBvZmZzZXQ7CiAgICAgICAg\nLyoKICAgICAgICAgKiBJZiBlbnRyeUlkIGlzIEJvb2tpZVByb3RvY29sLkxB\nU1RfQUREX0NPTkZJUk1FRCwgdGhlbiByZXR1cm4gdGhlIGxhc3Qgd3JpdHRl\nbi4KICAgICAgICAgKi8KICAgICAgICBpZiAoZW50cnlJZCA9PSBCb29raWVQ\ncm90b2NvbC5MQVNUX0FERF9DT05GSVJNRUQpIHsKICAgICAgICAgICAgZW50\ncnlJZCA9IGxlZGdlckNhY2hlLmdldExhc3RFbnRyeShsZWRnZXJJZCk7CiAg\nICAgICAgfQoKICAgICAgICAvLyBHZXQgT2Zmc2V0CiAgICAgICAgbG9uZyBz\ndGFydFRpbWVOYW5vcyA9IE1hdGhVdGlscy5ub3dJbk5hbm8oKTsKICAgICAg\nICBib29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBvZmZzZXQgPSBsZWRnZXJDYWNoZS5nZXRFbnRyeU9mZnNldChs\nZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgICAgIGlmIChvZmZzZXQgPT0g\nMCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZS5Ob0VudHJ5\nRXhjZXB0aW9uKGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzdWNjZXNzID0gdHJ1ZTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgICAgICAg\nZ2V0T2Zmc2V0U3RhdHMucmVnaXN0ZXJTdWNjZXNzZnVsRXZlbnQoTWF0aFV0\naWxzLmVsYXBzZWRNU2VjKHN0YXJ0VGltZU5hbm9zKSk7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBnZXRPZmZzZXRTdGF0cy5yZWdp\nc3RlckZhaWxlZEV2ZW50KE1hdGhVdGlscy5lbGFwc2VkTVNlYyhzdGFydFRp\nbWVOYW5vcykpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIC8v\nIEdldCBFbnRyeQogICAgICAgIHN0YXJ0VGltZU5hbm9zID0gTWF0aFV0aWxz\nLm5vd0luTmFubygpOwogICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBieXRlW10gcmV0Qnl0ZXMgPSBlbnRyeUxv\nZ2dlci5yZWFkRW50cnkobGVkZ2VySWQsIGVudHJ5SWQsIG9mZnNldCk7CiAg\nICAgICAgICAgIHN1Y2Nlc3MgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4g\nQnl0ZUJ1ZmZlci53cmFwKHJldEJ5dGVzKTsKICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgICAgICAg\nZ2V0RW50cnlTdGF0cy5yZWdpc3RlclN1Y2Nlc3NmdWxFdmVudChNYXRoVXRp\nbHMuZWxhcHNlZE1TZWMoc3RhcnRUaW1lTmFub3MpKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGdldEVudHJ5U3RhdHMucmVnaXN0\nZXJGYWlsZWRFdmVudChNYXRoVXRpbHMuZWxhcHNlZE1TZWMoc3RhcnRUaW1l\nTmFub3MpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZmx1c2hPckNoZWNrcG9pbnQoYm9vbGVhbiBpc0NoZWNr\ncG9pbnRGbHVzaCkKICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nCiAgICAgICAgYm9vbGVhbiBmbHVzaEZhaWxlZCA9IGZhbHNlOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2VyKHRy\ndWUpOwogICAgICAgIH0gY2F0Y2ggKExlZGdlckRpcnNNYW5hZ2VyLk5vV3Jp\ndGFibGVMZWRnZXJEaXJFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJv\ndyBlOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBmbHVzaGluZyBMZWRnZXIg\nY2FjaGUiLCBpb2UpOwogICAgICAgICAgICBmbHVzaEZhaWxlZCA9IHRydWU7\nCiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBpZiBp\ndCBpcyBqdXN0IGEgY2hlY2twb2ludCBmbHVzaCwgd2UganVzdCBmbHVzaCBy\nb3RhdGVkIGVudHJ5IGxvZyBmaWxlcwogICAgICAgICAgICAvLyBpbiBlbnRy\neSBsb2dnZXIuCiAgICAgICAgICAgIGlmIChpc0NoZWNrcG9pbnRGbHVzaCkg\newogICAgICAgICAgICAgICAgZW50cnlMb2dnZXIuY2hlY2twb2ludCgpOwog\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZW50cnlMb2dn\nZXIuZmx1c2goKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKExl\nZGdlckRpcnNNYW5hZ2VyLk5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0gY2F0Y2ggKElP\nRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2Vw\ndGlvbiBmbHVzaGluZyBMZWRnZXIiLCBpb2UpOwogICAgICAgICAgICBmbHVz\naEZhaWxlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChmbHVzaEZh\naWxlZCkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkZs\ndXNoaW5nIHRvIHN0b3JhZ2UgZmFpbGVkLCBjaGVjayBsb2dzIik7CiAgICAg\nICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENoZWNrcG9p\nbnQgY2hlY2twb2ludChDaGVja3BvaW50IGNoZWNrcG9pbnQpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgQ2hlY2twb2ludCBsYXN0Q2hlY2twb2lu\ndCA9IGNoZWNrcG9pbnRIb2xkZXIuZ2V0TGFzdENoZWNrcG9pbnQoKTsKICAg\nICAgICAvLyBpZiBjaGVja3BvaW50IGlzIGxlc3MgdGhhbiBsYXN0IGNoZWNr\ncG9pbnQsIHdlIGRvbid0IG5lZWQgdG8gZG8gY2hlY2twb2ludCBhZ2Fpbi4K\nICAgICAgICBpZiAobGFzdENoZWNrcG9pbnQuY29tcGFyZVRvKGNoZWNrcG9p\nbnQpID4gMCkgewogICAgICAgICAgICByZXR1cm4gbGFzdENoZWNrcG9pbnQ7\nCiAgICAgICAgfQogICAgICAgIC8vIHdlIGRvbid0IG5lZWQgdG8gY2hlY2sg\nc29tZXRoaW5nd3JpdHRlbiBzaW5jZSBjaGVja3BvaW50CiAgICAgICAgLy8g\naXMgc2NoZWR1bGVkIHdoZW4gcm90YXRlIGFuIGVudHJ5IGxvZ2dlciBmaWxl\nLiBhbmQgd2UgY291bGQKICAgICAgICAvLyBub3Qgc2V0IHNvbWV0aGluZ1dy\naXR0ZW4gdG8gZmFsc2UgYWZ0ZXIgY2hlY2twb2ludCwgc2luY2UKICAgICAg\nICAvLyBjdXJyZW50IGVudHJ5IGxvZ2dlciBmaWxlIGlzbid0IGZsdXNoZWQg\neWV0LgogICAgICAgIGZsdXNoT3JDaGVja3BvaW50KHRydWUpOwogICAgICAg\nIC8vIGFmdGVyIHRoZSBsZWRnZXIgc3RvcmFnZSBmaW5pc2hlZCBjaGVja3Bv\naW50aW5nLCB0cnkgdG8gY2xlYXIgdGhlIGRvbmUgY2hlY2twb2ludAoKICAg\nICAgICBjaGVja3BvaW50SG9sZGVyLmNsZWFyTGFzdENoZWNrcG9pbnQobGFz\ndENoZWNrcG9pbnQpOwogICAgICAgIHJldHVybiBsYXN0Q2hlY2twb2ludDsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\ndm9pZCBmbHVzaCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKCFzb21ldGhpbmdXcml0dGVuKSB7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CiAgICAgICAgc29tZXRoaW5nV3JpdHRlbiA9IGZhbHNlOwogICAg\nICAgIGZsdXNoT3JDaGVja3BvaW50KGZhbHNlKTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyBCS01CZWFuSW5mbyBnZXRKTVhCZWFuKCkgewog\nICAgICAgIHJldHVybiBsZWRnZXJDYWNoZS5nZXRKTVhCZWFuKCk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIHZvaWQgcHJvY2Vzc0VudHJ5KGxvbmcgbGVkZ2Vy\nSWQsIGxvbmcgZW50cnlJZCwgQnl0ZUJ1ZmZlciBlbnRyeSkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBwcm9jZXNzRW50cnkobGVkZ2VySWQsIGVu\ndHJ5SWQsIGVudHJ5LCB0cnVlKTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQg\ncHJvdGVjdGVkIHZvaWQgcHJvY2Vzc0VudHJ5KGxvbmcgbGVkZ2VySWQsIGxv\nbmcgZW50cnlJZCwgQnl0ZUJ1ZmZlciBlbnRyeSwgYm9vbGVhbiByb2xsTG9n\nKQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIC8q\nCiAgICAgICAgICogVG91Y2ggZGlydHkgZmxhZwogICAgICAgICAqLwogICAg\nICAgIHNvbWV0aGluZ1dyaXR0ZW4gPSB0cnVlOwoKICAgICAgICAvKgogICAg\nICAgICAqIExvZyB0aGUgZW50cnkKICAgICAgICAgKi8KICAgICAgICBsb25n\nIHBvcyA9IGVudHJ5TG9nZ2VyLmFkZEVudHJ5KGxlZGdlcklkLCBlbnRyeSwg\ncm9sbExvZyk7CgogICAgICAgIC8qCiAgICAgICAgICogU2V0IG9mZnNldCBv\nZiBlbnRyeSBpZCB0byBiZSB0aGUgY3VycmVudCBsZWRnZXIgcG9zaXRpb24K\nICAgICAgICAgKi8KICAgICAgICBsZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNl\ndChsZWRnZXJJZCwgZW50cnlJZCwgcG9zKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIG9uUm90YXRlRW50cnlMb2coKSB7CiAgICAg\nICAgLy8gZm9yIGludGVybGVhdmVkIGxlZGdlciBzdG9yYWdlLCB3ZSByZXF1\nZXN0IGEgY2hlY2twb2ludCB3aGVuIHJvdGF0aW5nIGEgZW50cnkgbG9nIGZp\nbGUuCiAgICAgICAgLy8gdGhlIGNoZWNrcG9pbnQgcmVwcmVzZW50IHRoZSBw\nb2ludCB0aGF0IGFsbCB0aGUgZW50cmllcyBhZGRlZCBiZWZvcmUgdGhpcyBw\nb2ludCBhcmUgYWxyZWFkeQogICAgICAgIC8vIGluIGxlZGdlciBzdG9yYWdl\nIGFuZCByZWFkeSB0byBiZSBzeW5jZWQgdG8gZGlzay4KICAgICAgICAvLyBU\nT0RPOiB3ZSBjb3VsZCBjb25zaWRlciByZW1vdmUgY2hlY2twb2ludFNvdXJj\nZSBhbmQgY2hlY2twb2ludFNvdWNlI25ld0NoZWNrcG9pbnQKICAgICAgICAv\nLyBsYXRlciBpZiB3ZSBwcm92aWRlIGtpbmQgb2YgTFNOIChMb2cvSm91cm5h\nbCBTcXVldWVuY2UgTnVtYmVyKQogICAgICAgIC8vIG1lY2hhbmlzbSB3aGVu\nIGFkZGluZyBlbnRyeS4KICAgICAgICBjaGVja3BvaW50SG9sZGVyLnNldE5l\neHRDaGVja3BvaW50KGNoZWNrcG9pbnRTb3VyY2UubmV3Q2hlY2twb2ludCgp\nKTsKICAgIH0KfQo=\n","encoding":"base64"}

