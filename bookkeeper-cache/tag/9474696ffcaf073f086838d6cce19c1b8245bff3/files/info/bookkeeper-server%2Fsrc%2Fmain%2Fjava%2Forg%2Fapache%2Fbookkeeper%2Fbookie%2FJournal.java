{"sha":"ad48386ca666eb7fbde98f469ad0edd5801e6935","node_id":"MDQ6QmxvYjE1NzU5NTY6YWQ0ODM4NmNhNjY2ZWI3ZmJkZTk4ZjQ2OWFkMGVkZDU4MDFlNjkzNQ==","size":39358,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ad48386ca666eb7fbde98f469ad0edd5801e6935","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uRmlsZUlucHV0\nU3RyZWFtOwppbXBvcnQgamF2YS5pby5GaWxlT3V0cHV0U3RyZWFtOwppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVC\ndWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2\nYS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkV4ZWN1dG9yczsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LkxpbmtlZEJsb2NraW5nUXVldWU7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi5i\nYXNlLlN0b3B3YXRjaDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5i\nb29raWUuTGVkZ2VyRGlyc01hbmFnZXIuTm9Xcml0YWJsZUxlZGdlckRpckV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNl\ncnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLldyaXRlQ2Fs\nbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RhdHMuQ291\nbnRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5OdWxs\nU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3Rh\ndHMuT3BTdGF0c0xvZ2dlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5zdGF0cy5TdGF0c0xvZ2dlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLkRhZW1vblRocmVhZEZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIudXRpbC5JT1V0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnV0aWwuTWF0aFV0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnV0aWwuWmVyb0J1ZmZlcjsKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmlt\ncG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29r\nS2VlcGVyU2VydmVyU3RhdHMuKjsKCi8qKgogKiBQcm92aWRlIGpvdXJuYWwg\ncmVsYXRlZCBtYW5hZ2VtZW50LgogKi8KY2xhc3MgSm91cm5hbCBleHRlbmRz\nIEJvb2tpZUNyaXRpY2FsVGhyZWFkIGltcGxlbWVudHMgQ2hlY2twb2ludFNv\ndXJjZSB7CgogICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgTG9nZ2VyIExPRyA9\nIExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEpvdXJuYWwuY2xhc3MpOwoKICAg\nIC8qKgogICAgICogRmlsdGVyIHRvIHBpY2t1cCBqb3VybmFscwogICAgICov\nCiAgICBwcml2YXRlIHN0YXRpYyBpbnRlcmZhY2UgSm91cm5hbElkRmlsdGVy\nIHsKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhY2NlcHQobG9uZyBqb3VybmFs\nSWQpOwogICAgfQoKICAgIC8qKgogICAgICogTGlzdCBhbGwgam91cm5hbCBp\nZHMgYnkgYSBzcGVjaWZpZWQgam91cm5hbCBpZCBmaWxlcgogICAgICoKICAg\nICAqIEBwYXJhbSBqb3VybmFsRGlyIGpvdXJuYWwgZGlyCiAgICAgKiBAcGFy\nYW0gZmlsdGVyIGpvdXJuYWwgaWQgZmlsdGVyCiAgICAgKiBAcmV0dXJuIGxp\nc3Qgb2YgZmlsdGVyZWQgaWRzCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGlj\nIExpc3Q8TG9uZz4gbGlzdEpvdXJuYWxJZHMoRmlsZSBqb3VybmFsRGlyLCBK\nb3VybmFsSWRGaWx0ZXIgZmlsdGVyKSB7CiAgICAgICAgRmlsZSBsb2dGaWxl\nc1tdID0gam91cm5hbERpci5saXN0RmlsZXMoKTsKICAgICAgICBMaXN0PExv\nbmc+IGxvZ3MgPSBuZXcgQXJyYXlMaXN0PExvbmc+KCk7CiAgICAgICAgZm9y\nKEZpbGUgZjogbG9nRmlsZXMpIHsKICAgICAgICAgICAgU3RyaW5nIG5hbWUg\nPSBmLmdldE5hbWUoKTsKICAgICAgICAgICAgaWYgKCFuYW1lLmVuZHNXaXRo\nKCIudHhuIikpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIFN0cmluZyBpZFN0cmluZyA9IG5hbWUuc3Bs\naXQoIlxcLiIpWzBdOwogICAgICAgICAgICBsb25nIGlkID0gTG9uZy5wYXJz\nZUxvbmcoaWRTdHJpbmcsIDE2KTsKICAgICAgICAgICAgaWYgKGZpbHRlciAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyLmFjY2VwdChp\nZCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2dzLmFkZChpZCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBsb2dzLmFkZChpZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgQ29sbGVjdGlvbnMuc29ydChsb2dzKTsKICAgICAgICByZXR1cm4g\nbG9nczsKICAgIH0KCiAgICAvKioKICAgICAqIEEgd3JhcHBlciBvdmVyIGxv\nZyBtYXJrIHRvIHByb3ZpZGUgYSBjaGVja3BvaW50IGZvciB1c2VycyBvZiBq\nb3VybmFsCiAgICAgKiB0byBkbyBjaGVja3BvaW50aW5nLgogICAgICovCiAg\nICBwcml2YXRlIHN0YXRpYyBjbGFzcyBMb2dNYXJrQ2hlY2twb2ludCBpbXBs\nZW1lbnRzIENoZWNrcG9pbnQgewogICAgICAgIGZpbmFsIExhc3RMb2dNYXJr\nIG1hcms7CgogICAgICAgIHB1YmxpYyBMb2dNYXJrQ2hlY2twb2ludChMYXN0\nTG9nTWFyayBjaGVja3BvaW50KSB7CiAgICAgICAgICAgIHRoaXMubWFyayA9\nIGNoZWNrcG9pbnQ7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgaW50IGNvbXBhcmVUbyhDaGVja3BvaW50IG8pIHsKICAg\nICAgICAgICAgaWYgKG8gPT0gQ2hlY2twb2ludC5NQVgpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiAtMTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvID09\nIENoZWNrcG9pbnQuTUlOKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbWFyay5nZXRDdXJN\nYXJrKCkuY29tcGFyZSgoKExvZ01hcmtDaGVja3BvaW50KW8pLm1hcmsuZ2V0\nQ3VyTWFyaygpKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhPYmplY3QgbykgewogICAgICAg\nICAgICBpZiAoIShvIGluc3RhbmNlb2YgTG9nTWFya0NoZWNrcG9pbnQpKSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIDAgPT0gY29tcGFyZVRvKChMb2dNYXJrQ2hl\nY2twb2ludClvKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBtYXJrLmhhc2hDb2RlKCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAg\nICAgICByZXR1cm4gbWFyay50b1N0cmluZygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIExhc3QgTG9nIE1hcmsKICAgICAqLwogICAgY2xh\nc3MgTGFzdExvZ01hcmsgewogICAgICAgIHByaXZhdGUgZmluYWwgTG9nTWFy\nayBjdXJNYXJrOwoKICAgICAgICBMYXN0TG9nTWFyayhsb25nIGxvZ0lkLCBs\nb25nIGxvZ1Bvc2l0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3VyTWFyayA9\nIG5ldyBMb2dNYXJrKGxvZ0lkLCBsb2dQb3NpdGlvbik7CiAgICAgICAgfQoK\nICAgICAgICB2b2lkIHNldEN1ckxvZ01hcmsobG9uZyBsb2dJZCwgbG9uZyBs\nb2dQb3NpdGlvbikgewogICAgICAgICAgICBjdXJNYXJrLnNldExvZ01hcmso\nbG9nSWQsIGxvZ1Bvc2l0aW9uKTsKICAgICAgICB9CgogICAgICAgIExhc3RM\nb2dNYXJrIG1hcmtMb2coKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGFz\ndExvZ01hcmsoY3VyTWFyay5nZXRMb2dGaWxlSWQoKSwgY3VyTWFyay5nZXRM\nb2dGaWxlT2Zmc2V0KCkpOwogICAgICAgIH0KCiAgICAgICAgTG9nTWFyayBn\nZXRDdXJNYXJrKCkgewogICAgICAgICAgICByZXR1cm4gY3VyTWFyazsKICAg\nICAgICB9CgogICAgICAgIHZvaWQgcm9sbExvZyhMYXN0TG9nTWFyayBsYXN0\nTWFyaykgdGhyb3dzIE5vV3JpdGFibGVMZWRnZXJEaXJFeGNlcHRpb24gewog\nICAgICAgICAgICBieXRlIGJ1ZmZbXSA9IG5ldyBieXRlWzE2XTsKICAgICAg\nICAgICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVCdWZmZXIud3JhcChidWZmKTsK\nICAgICAgICAgICAgLy8gd2Ugc2hvdWxkIHJlY29yZCA8bG9nSWQsIGxvZ1Bv\nc2l0aW9uPiBtYXJrZWQgaW4gbWFya0xvZwogICAgICAgICAgICAvLyB3aGlj\naCBpcyBzYWZlIHNpbmNlIHJlY29yZHMgYmVmb3JlIGxhc3RNYXJrIGhhdmUg\nYmVlbgogICAgICAgICAgICAvLyBwZXJzaXN0ZWQgdG8gZGlzayAoYm90aCBp\nbmRleCAmIGVudHJ5IGxvZ2dlcikKICAgICAgICAgICAgbGFzdE1hcmsuZ2V0\nQ3VyTWFyaygpLndyaXRlTG9nTWFyayhiYik7CiAgICAgICAgICAgIExPRy5k\nZWJ1ZygiUm9sbExvZyB0byBwZXJzaXN0IGxhc3QgbWFya2VkIGxvZyA6IHt9\nIiwgbGFzdE1hcmsuZ2V0Q3VyTWFyaygpKTsKICAgICAgICAgICAgTGlzdDxG\naWxlPiB3cml0YWJsZUxlZGdlckRpcnMgPSBsZWRnZXJEaXJzTWFuYWdlcgog\nICAgICAgICAgICAgICAgICAgIC5nZXRXcml0YWJsZUxlZGdlckRpcnMoKTsK\nICAgICAgICAgICAgZm9yIChGaWxlIGRpciA6IHdyaXRhYmxlTGVkZ2VyRGly\ncykgewogICAgICAgICAgICAgICAgRmlsZSBmaWxlID0gbmV3IEZpbGUoZGly\nLCAibGFzdE1hcmsiKTsKICAgICAgICAgICAgICAgIEZpbGVPdXRwdXRTdHJl\nYW0gZm9zID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgZm9zID0gbmV3IEZpbGVPdXRwdXRTdHJlYW0oZmlsZSk7\nCiAgICAgICAgICAgICAgICAgICAgZm9zLndyaXRlKGJ1ZmYpOwogICAgICAg\nICAgICAgICAgICAgIGZvcy5nZXRDaGFubmVsKCkuZm9yY2UodHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgZm9zLmNsb3NlKCk7CiAgICAgICAgICAgICAg\nICAgICAgZm9zID0gbnVsbDsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElP\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIlByb2JsZW1zIHdyaXRpbmcgdG8gIiArIGZpbGUsIGUpOwogICAgICAgICAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiBz\ndHJlYW0gYWxyZWFkeSBjbG9zZWQgaW4gdHJ5IGJsb2NrIHN1Y2Nlc3NmdWxs\neSwKICAgICAgICAgICAgICAgICAgICAvLyBzdHJlYW0gbWlnaHQgaGF2ZSBu\ndWxsaWZpZWQsIGluIHN1Y2ggY2FzZSBiZWxvdwogICAgICAgICAgICAgICAg\nICAgIC8vIGNhbGwgd2lsbCBzaW1wbHkgcmV0dXJucwogICAgICAgICAgICAg\nICAgICAgIElPVXRpbHMuY2xvc2UoTE9HLCBmb3MpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKiBSZWFkIGxhc3QgbWFyayBmcm9tIGxhc3RNYXJrIGZpbGUuCiAg\nICAgICAgICogVGhlIGxhc3QgbWFyayBzaG91bGQgZmlyc3QgYmUgbWF4IGpv\ndXJuYWwgbG9nIGlkLAogICAgICAgICAqIGFuZCB0aGVuIG1heCBsb2cgcG9z\naXRpb24gaW4gbWF4IGpvdXJuYWwgbG9nLgogICAgICAgICAqLwogICAgICAg\nIHZvaWQgcmVhZExvZygpIHsKICAgICAgICAgICAgYnl0ZSBidWZmW10gPSBu\nZXcgYnl0ZVsxNl07CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRl\nQnVmZmVyLndyYXAoYnVmZik7CiAgICAgICAgICAgIExvZ01hcmsgbWFyayA9\nIG5ldyBMb2dNYXJrKCk7CiAgICAgICAgICAgIGZvcihGaWxlIGRpcjogbGVk\nZ2VyRGlyc01hbmFnZXIuZ2V0QWxsTGVkZ2VyRGlycygpKSB7CiAgICAgICAg\nICAgICAgICBGaWxlIGZpbGUgPSBuZXcgRmlsZShkaXIsICJsYXN0TWFyayIp\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBG\naWxlSW5wdXRTdHJlYW0gZmlzID0gbmV3IEZpbGVJbnB1dFN0cmVhbShmaWxl\nKTsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICBpbnQgYnl0ZXNSZWFkID0gZmlzLnJlYWQoYnVmZik7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChieXRlc1JlYWQgIT0gMTYpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbigiQ291bGRuJ3QgcmVhZCBlbm91Z2ggYnl0ZXMgZnJvbSBsYXN0TWFyay4i\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiIFdhbnRlZCAiICsgMTYgKyAiLCBnb3QgIiArIGJ5dGVzUmVh\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICBmaXMu\nY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgYmIuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBtYXJrLnJl\nYWRMb2dNYXJrKGJiKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY3VyTWFy\nay5jb21wYXJlKG1hcmspIDwgMCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBjdXJNYXJrLnNldExvZ01hcmsobWFyay5nZXRMb2dGaWxlSWQoKSwgbWFy\nay5nZXRMb2dGaWxlT2Zmc2V0KCkpOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlByb2JsZW1zIHJlYWRpbmcg\nZnJvbSAiICsgZmlsZSArICIgKHRoaXMgaXMgb2theSBpZiBpdCBpcyB0aGUg\nZmlyc3QgdGltZSBzdGFydGluZyB0aGlzIGJvb2tpZSIpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAg\nICAgICAgICByZXR1cm4gY3VyTWFyay50b1N0cmluZygpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEZpbHRlciB0byByZXR1cm4gbGlzdCBv\nZiBqb3VybmFscyBmb3Igcm9sbGluZwogICAgICovCiAgICBwcml2YXRlIHN0\nYXRpYyBjbGFzcyBKb3VybmFsUm9sbGluZ0ZpbHRlciBpbXBsZW1lbnRzIEpv\ndXJuYWxJZEZpbHRlciB7CgogICAgICAgIGZpbmFsIExhc3RMb2dNYXJrIGxh\nc3RNYXJrOwoKICAgICAgICBKb3VybmFsUm9sbGluZ0ZpbHRlcihMYXN0TG9n\nTWFyayBsYXN0TWFyaykgewogICAgICAgICAgICB0aGlzLmxhc3RNYXJrID0g\nbGFzdE1hcms7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBhY2NlcHQobG9uZyBqb3VybmFsSWQpIHsKICAg\nICAgICAgICAgaWYgKGpvdXJuYWxJZCA8IGxhc3RNYXJrLmdldEN1ck1hcmso\nKS5nZXRMb2dGaWxlSWQoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTY2FubmVyIHVzZWQgdG8gc2NhbiBhIGpvdXJuYWwKICAg\nICAqLwogICAgcHVibGljIHN0YXRpYyBpbnRlcmZhY2UgSm91cm5hbFNjYW5u\nZXIgewogICAgICAgIC8qKgogICAgICAgICAqIFByb2Nlc3MgYSBqb3VybmFs\nIGVudHJ5LgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGpvdXJuYWxW\nZXJzaW9uCiAgICAgICAgICogICAgICAgICAgSm91cm5hbCBWZXJzaW9uCiAg\nICAgICAgICogQHBhcmFtIG9mZnNldAogICAgICAgICAqICAgICAgICAgIEZp\nbGUgb2Zmc2V0IG9mIHRoZSBqb3VybmFsIGVudHJ5CiAgICAgICAgICogQHBh\ncmFtIGVudHJ5CiAgICAgICAgICogICAgICAgICAgSm91cm5hbCBFbnRyeQog\nICAgICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKGludCBqb3VybmFsVmVyc2lvbiwg\nbG9uZyBvZmZzZXQsIEJ5dGVCdWZmZXIgZW50cnkpIHRocm93cyBJT0V4Y2Vw\ndGlvbjsKICAgIH0KCiAgICAvKioKICAgICAqIEpvdXJuYWwgRW50cnkgdG8g\nUmVjb3JkCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFF1ZXVl\nRW50cnkgewogICAgICAgIEJ5dGVCdWZmZXIgZW50cnk7CiAgICAgICAgbG9u\nZyBsZWRnZXJJZDsKICAgICAgICBsb25nIGVudHJ5SWQ7CiAgICAgICAgV3Jp\ndGVDYWxsYmFjayBjYjsKICAgICAgICBPYmplY3QgY3R4OwogICAgICAgIGxv\nbmcgZW5xdWV1ZVRpbWU7CgogICAgICAgIFF1ZXVlRW50cnkoQnl0ZUJ1ZmZl\nciBlbnRyeSwgbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLAogICAgICAg\nICAgICAgICAgICAgV3JpdGVDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCwgbG9u\nZyBlbnF1ZXVlVGltZSkgewogICAgICAgICAgICB0aGlzLmVudHJ5ID0gZW50\ncnkuZHVwbGljYXRlKCk7CiAgICAgICAgICAgIHRoaXMuY2IgPSBjYjsKICAg\nICAgICAgICAgdGhpcy5jdHggPSBjdHg7CiAgICAgICAgICAgIHRoaXMubGVk\nZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5lbnRyeUlkID0g\nZW50cnlJZDsKICAgICAgICAgICAgdGhpcy5lbnF1ZXVlVGltZSA9IGVucXVl\ndWVUaW1lOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2FsbGJh\nY2soKSB7CiAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJBY2tub3dsZWRnZSBMZWRn\nZXI6IHt9LCBFbnRyeToge30iLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgY2Iud3JpdGVDb21wbGV0ZSgwLCBsZWRn\nZXJJZCwgZW50cnlJZCwgbnVsbCwgY3R4KTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSBjbGFzcyBGb3JjZVdyaXRlUmVxdWVzdCBpbXBsZW1lbnRz\nIFJ1bm5hYmxlIHsKICAgICAgICBwcml2YXRlIGZpbmFsIEpvdXJuYWxDaGFu\nbmVsIGxvZ0ZpbGU7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBMaW5rZWRMaXN0\nPFF1ZXVlRW50cnk+IGZvcmNlV3JpdGVXYWl0ZXJzOwogICAgICAgIHByaXZh\ndGUgYm9vbGVhbiBzaG91bGRDbG9zZTsKICAgICAgICBwcml2YXRlIGZpbmFs\nIGJvb2xlYW4gaXNNYXJrZXI7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBsb25n\nIGxhc3RGbHVzaGVkUG9zaXRpb247CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBs\nb25nIGxvZ0lkOwoKICAgICAgICBwcml2YXRlIEZvcmNlV3JpdGVSZXF1ZXN0\nKEpvdXJuYWxDaGFubmVsIGxvZ0ZpbGUsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9uZyBsb2dJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICBs\nb25nIGxhc3RGbHVzaGVkUG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgTGlua2VkTGlzdDxRdWV1ZUVudHJ5PiBmb3JjZVdyaXRlV2FpdGVy\ncywKICAgICAgICAgICAgICAgICAgICAgICAgICBib29sZWFuIHNob3VsZENs\nb3NlLAogICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2xlYW4gaXNNYXJr\nZXIpIHsKICAgICAgICAgICAgdGhpcy5mb3JjZVdyaXRlV2FpdGVycyA9IGZv\ncmNlV3JpdGVXYWl0ZXJzOwogICAgICAgICAgICB0aGlzLmxvZ0ZpbGUgPSBs\nb2dGaWxlOwogICAgICAgICAgICB0aGlzLmxvZ0lkID0gbG9nSWQ7CiAgICAg\nICAgICAgIHRoaXMubGFzdEZsdXNoZWRQb3NpdGlvbiA9IGxhc3RGbHVzaGVk\nUG9zaXRpb247CiAgICAgICAgICAgIHRoaXMuc2hvdWxkQ2xvc2UgPSBzaG91\nbGRDbG9zZTsKICAgICAgICAgICAgdGhpcy5pc01hcmtlciA9IGlzTWFya2Vy\nOwogICAgICAgICAgICBmb3JjZVdyaXRlUXVldWVTaXplLmluYygpOwogICAg\nICAgIH0KCiAgICAgICAgcHVibGljIGludCBwcm9jZXNzKGJvb2xlYW4gc2hv\ndWxkRm9yY2VXcml0ZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgZm9yY2VXcml0ZVF1ZXVlU2l6ZS5kZWMoKTsKICAgICAgICAgICAgaWYg\nKGlzTWFya2VyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlm\nIChzaG91bGRGb3JjZVdyaXRlKSB7CiAgICAgICAgICAgICAgICAgICAgdGhp\ncy5sb2dGaWxlLmZvcmNlV3JpdGUoZmFsc2UpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgbGFzdExvZ01hcmsuc2V0Q3VyTG9nTWFyayh0\naGlzLmxvZ0lkLCB0aGlzLmxhc3RGbHVzaGVkUG9zaXRpb24pOwoKICAgICAg\nICAgICAgICAgIC8vIE5vdGlmeSB0aGUgd2FpdGVycyB0aGF0IHRoZSBmb3Jj\nZSB3cml0ZSBzdWNjZWVkZWQKICAgICAgICAgICAgICAgIGNiVGhyZWFkUG9v\nbC5zdWJtaXQodGhpcyk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMu\nZm9yY2VXcml0ZVdhaXRlcnMuc2l6ZSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGZpbmFsbHkgewogICAgICAgICAgICAgICAgY2xvc2VGaWxlSWZO\nZWNlc3NhcnkoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAg\nICAgICBmb3IgKFF1ZXVlRW50cnkgZSA6IHRoaXMuZm9yY2VXcml0ZVdhaXRl\ncnMpIHsKICAgICAgICAgICAgICAgIGpvdXJuYWxBZGRFbnRyeVN0YXRzLnJl\nZ2lzdGVyU3VjY2Vzc2Z1bEV2ZW50KE1hdGhVdGlscy5lbGFwc2VkTVNlYyhl\nLmVucXVldWVUaW1lKSk7CiAgICAgICAgICAgICAgICBlLmNhbGxiYWNrKCk7\nICAgIC8vIFByb2Nlc3MgY2JzIGlubGluZQogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZUZpbGVJZk5lY2Vzc2Fy\neSgpIHsKICAgICAgICAgICAgLy8gQ2xvc2UgaWYgc2hvdWxkQ2xvc2UgaXMg\nc2V0CiAgICAgICAgICAgIGlmIChzaG91bGRDbG9zZSkgewogICAgICAgICAg\nICAgICAgLy8gV2Ugc2hvdWxkIGd1YXJkIGFnYWluc3QgZXhjZXB0aW9ucyBz\nbyBpdHMKICAgICAgICAgICAgICAgIC8vIHNhZmUgdG8gY2FsbCBpbiBjYXRj\naCBibG9ja3MKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgbG9nRmlsZS5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgIC8v\nIENhbGwgY2xvc2Ugb25seSBvbmNlCiAgICAgICAgICAgICAgICAgICAgc2hv\ndWxkQ2xvc2UgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkkvTyBleGNlcHRpb24gd2hpbGUgY2xvc2lu\nZyBmaWxlIiwgaW9lKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEZvcmNlV3JpdGVU\naHJlYWQgaXMgYSBiYWNrZ3JvdW5kIHRocmVhZCB3aGljaCBtYWtlcyB0aGUg\nam91cm5hbCBkdXJhYmxlIHBlcmlvZGljYWxseQogICAgICoKICAgICAqLwog\nICAgcHJpdmF0ZSBjbGFzcyBGb3JjZVdyaXRlVGhyZWFkIGV4dGVuZHMgQm9v\na2llQ3JpdGljYWxUaHJlYWQgewogICAgICAgIHZvbGF0aWxlIGJvb2xlYW4g\ncnVubmluZyA9IHRydWU7CiAgICAgICAgLy8gVGhpcyBob2xkcyB0aGUgcXVl\ndWUgZW50cmllcyB0aGF0IHNob3VsZCBiZSBub3RpZmllZCBhZnRlciBhCiAg\nICAgICAgLy8gc3VjY2Vzc2Z1bCBmb3JjZSB3cml0ZQogICAgICAgIFRocmVh\nZCB0aHJlYWRUb05vdGlmeU9uRXg7CiAgICAgICAgLy8gc2hvdWxkIHdlIGdy\nb3VwIGZvcmNlIHdyaXRlcwogICAgICAgIHByaXZhdGUgZmluYWwgYm9vbGVh\nbiBlbmFibGVHcm91cEZvcmNlV3JpdGVzOwogICAgICAgIC8vIG1ha2UgZmx1\nc2ggaW50ZXJ2YWwgYXMgYSBwYXJhbWV0ZXIKICAgICAgICBwdWJsaWMgRm9y\nY2VXcml0ZVRocmVhZChUaHJlYWQgdGhyZWFkVG9Ob3RpZnlPbkV4LCBib29s\nZWFuIGVuYWJsZUdyb3VwRm9yY2VXcml0ZXMpIHsKICAgICAgICAgICAgc3Vw\nZXIoIkZvcmNlV3JpdGVUaHJlYWQiKTsKICAgICAgICAgICAgdGhpcy50aHJl\nYWRUb05vdGlmeU9uRXggPSB0aHJlYWRUb05vdGlmeU9uRXg7CiAgICAgICAg\nICAgIHRoaXMuZW5hYmxlR3JvdXBGb3JjZVdyaXRlcyA9IGVuYWJsZUdyb3Vw\nRm9yY2VXcml0ZXM7CiAgICAgICAgfQogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgTE9HLmluZm8o\nIkZvcmNlV3JpdGUgVGhyZWFkIHN0YXJ0ZWQiKTsKICAgICAgICAgICAgYm9v\nbGVhbiBzaG91bGRGb3JjZVdyaXRlID0gdHJ1ZTsKICAgICAgICAgICAgaW50\nIG51bVJlcUluTGFzdEZvcmNlV3JpdGUgPSAwOwogICAgICAgICAgICB3aGls\nZShydW5uaW5nKSB7CiAgICAgICAgICAgICAgICBGb3JjZVdyaXRlUmVxdWVz\ndCByZXEgPSBudWxsOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICByZXEgPSBmb3JjZVdyaXRlUmVxdWVzdHMudGFrZSgpOwoK\nICAgICAgICAgICAgICAgICAgICAvLyBGb3JjZSB3cml0ZSB0aGUgZmlsZSBh\nbmQgdGhlbiBub3RpZnkgdGhlIHdyaXRlIGNvbXBsZXRpb25zCiAgICAgICAg\nICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcS5p\nc01hcmtlcikgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hvdWxk\nRm9yY2VXcml0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g\naWYgd2UgYXJlIGdvaW5nIHRvIGZvcmNlIHdyaXRlLCBhbnkgcmVxdWVzdCB0\naGF0IGlzIGFscmVhZHkgaW4gdGhlCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBxdWV1ZSB3aWxsIGJlbmVmaXQgZnJvbSB0aGlzIGZvcmNlIHdy\naXRlIC0gcG9zdCBhIG1hcmtlciBwcmlvciB0byBpc3N1aW5nCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZmx1c2ggc28gdW50aWwgdGhp\ncyBtYXJrZXIgaXMgZW5jb3VudGVyZWQgd2UgY2FuIHNraXAgdGhlIGZvcmNl\nIHdyaXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZW5hYmxl\nR3JvdXBGb3JjZVdyaXRlcykgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZvcmNlV3JpdGVSZXF1ZXN0cy5wdXQobmV3IEZvcmNlV3JpdGVS\nZXF1ZXN0KHJlcS5sb2dGaWxlLCAwLCAwLCBudWxsLCBmYWxzZSwgdHJ1ZSkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIElmIHdlIGFyZSBhYm91dCB0byBpc3N1ZSBh\nIHdyaXRlLCByZWNvcmQgdGhlIG51bWJlciBvZiByZXF1ZXN0cyBpbgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGxhc3QgZm9yY2Ugd3Jp\ndGUgYW5kIHRoZW4gcmVzZXQgdGhlIGNvdW50ZXIgc28gd2UgY2FuIGFjY3Vt\ndWxhdGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlcXVlc3Rz\nIGluIHRoZSB3cml0ZSB3ZSBhcmUgYWJvdXQgdG8gaXNzdWUKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChudW1SZXFJbkxhc3RGb3JjZVdyaXRl\nID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmNl\nV3JpdGVHcm91cGluZ0NvdW50U3RhdHMucmVnaXN0ZXJTdWNjZXNzZnVsRXZl\nbnQobnVtUmVxSW5MYXN0Rm9yY2VXcml0ZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbnVtUmVxSW5MYXN0Rm9yY2VXcml0ZSA9IDA7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbnVtUmVxSW5MYXN0\nRm9yY2VXcml0ZSArPSByZXEucHJvY2VzcyhzaG91bGRGb3JjZVdyaXRlKTsK\nICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlm\nIChlbmFibGVHcm91cEZvcmNlV3JpdGVzICYmCiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIGlmIGl0cyBhIG1hcmtlciB3ZSBzaG91bGQgc3dpdGNoIGJh\nY2sgdG8gZmx1c2hpbmcKICAgICAgICAgICAgICAgICAgICAgICAgIXJlcS5p\nc01hcmtlciAmJgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGlu\nZGljYXRlcyB0aGF0IHRoaXMgaXMgdGhlIGxhc3QgcmVxdWVzdCBpbiBhIGdp\ndmVuIGZpbGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gc3Vic2Vx\ndWVudCByZXF1ZXN0cyB3aWxsIGdvIHRvIGEgZGlmZmVyZW50IGZpbGUgc28g\nd2Ugc2hvdWxkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZsdXNoIG9u\nIHRoZSBuZXh0IHJlcXVlc3QKICAgICAgICAgICAgICAgICAgICAgICAgIXJl\ncS5zaG91bGRDbG9zZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzaG91\nbGRGb3JjZVdyaXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICBzaG91bGRGb3JjZVdyaXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBp\nb2UpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkkvTyBleGNl\ncHRpb24gaW4gRm9yY2VXcml0ZSB0aHJlYWQiLCBpb2UpOwogICAgICAgICAg\nICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkZvcmNlV3JpdGUgdGhyZWFkIGludGVycnVw\ndGVkIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgaXMgaWRl\nbXBvdGVudAogICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IHJlcSkg\newogICAgICAgICAgICAgICAgICAgICAgICByZXEuY2xvc2VGaWxlSWZOZWNl\nc3NhcnkoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgcnVubmluZyA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIC8vIFJlZ2FyZGxlc3Mgb2Ygd2hhdCBj\nYXVzZWQgdXMgdG8gZXhpdCwgd2Ugc2hvdWxkIG5vdGlmeSB0aGUKICAgICAg\nICAgICAgLy8gdGhlIHBhcmVudCB0aHJlYWQgYXMgaXQgc2hvdWxkIGVpdGhl\nciBleGl0IG9yIGJlIGluIHRoZSBwcm9jZXNzCiAgICAgICAgICAgIC8vIG9m\nIGV4aXRpbmcgZWxzZSB3ZSB3aWxsIGhhdmUgd3JpdGUgcmVxdWVzdHMgaGFu\nZwogICAgICAgICAgICB0aHJlYWRUb05vdGlmeU9uRXguaW50ZXJydXB0KCk7\nCiAgICAgICAgfQogICAgICAgIC8vIHNodXRkb3duIHN5bmMgdGhyZWFkCiAg\nICAgICAgdm9pZCBzaHV0ZG93bigpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTsKICAgICAgICAg\nICAgdGhpcy5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgdGhpcy5qb2luKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIGZpbmFsIHN0YXRpYyBpbnQgUEFERElO\nR19NQVNLID0gLTB4MTAwOwoKICAgIHN0YXRpYyB2b2lkIHdyaXRlUGFkZGlu\nZ0J5dGVzKEpvdXJuYWxDaGFubmVsIGpjLCBCeXRlQnVmZmVyIHBhZGRpbmdC\ndWZmZXIsIGludCBqb3VybmFsQWxpZ25TaXplKQogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGludCBieXRlc1RvQWxpZ24gPSAo\naW50KSAoamMuYmMucG9zaXRpb24oKSAlIGpvdXJuYWxBbGlnblNpemUpOwog\nICAgICAgIGlmICgwICE9IGJ5dGVzVG9BbGlnbikgewogICAgICAgICAgICBp\nbnQgcGFkZGluZ0J5dGVzID0gam91cm5hbEFsaWduU2l6ZSAtIGJ5dGVzVG9B\nbGlnbjsKICAgICAgICAgICAgaWYgKHBhZGRpbmdCeXRlcyA8IDgpIHsKICAg\nICAgICAgICAgICAgIHBhZGRpbmdCeXRlcyA9IGpvdXJuYWxBbGlnblNpemUg\nLSAoOCAtIHBhZGRpbmdCeXRlcyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBwYWRkaW5nQnl0ZXMgLT0gODsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBwYWRkaW5nQnVmZmVyLmNsZWFyKCk7CiAgICAgICAg\nICAgIC8vIHBhZGRpbmcgbWFzawogICAgICAgICAgICBwYWRkaW5nQnVmZmVy\nLnB1dEludChQQURESU5HX01BU0spOwogICAgICAgICAgICAvLyBwYWRkaW5n\nIGxlbgogICAgICAgICAgICBwYWRkaW5nQnVmZmVyLnB1dEludChwYWRkaW5n\nQnl0ZXMpOwogICAgICAgICAgICAvLyBwYWRkaW5nIGJ5dGVzCiAgICAgICAg\nICAgIHBhZGRpbmdCdWZmZXIucG9zaXRpb24oOCArIHBhZGRpbmdCeXRlcyk7\nCgogICAgICAgICAgICBwYWRkaW5nQnVmZmVyLmZsaXAoKTsKICAgICAgICAg\nICAgamMucHJlQWxsb2NJZk5lZWRlZChwYWRkaW5nQnVmZmVyLmxpbWl0KCkp\nOwogICAgICAgICAgICAvLyB3cml0ZSBwYWRkaW5nIGJ5dGVzCiAgICAgICAg\nICAgIGpjLmJjLndyaXRlKHBhZGRpbmdCdWZmZXIpOwogICAgICAgIH0KICAg\nIH0KCiAgICBmaW5hbCBzdGF0aWMgbG9uZyBNQiA9IDEwMjQgKiAxMDI0TDsK\nICAgIGZpbmFsIHN0YXRpYyBpbnQgS0IgPSAxMDI0OwogICAgLy8gbWF4IGpv\ndXJuYWwgZmlsZSBzaXplCiAgICBmaW5hbCBsb25nIG1heEpvdXJuYWxTaXpl\nOwogICAgLy8gcHJlLWFsbG9jYXRpb24gc2l6ZSBmb3IgdGhlIGpvdXJuYWwg\nZmlsZXMKICAgIGZpbmFsIGxvbmcgam91cm5hbFByZUFsbG9jU2l6ZTsKICAg\nIC8vIHdyaXRlIGJ1ZmZlciBzaXplIGZvciB0aGUgam91cm5hbCBmaWxlcwog\nICAgZmluYWwgaW50IGpvdXJuYWxXcml0ZUJ1ZmZlclNpemU7CiAgICAvLyBu\ndW1iZXIgam91cm5hbCBmaWxlcyBrZXB0IGJlZm9yZSBtYXJrZWQgam91cm5h\nbAogICAgZmluYWwgaW50IG1heEJhY2t1cEpvdXJuYWxzOwoKICAgIGZpbmFs\nIEZpbGUgam91cm5hbERpcmVjdG9yeTsKICAgIGZpbmFsIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZjsKICAgIGZpbmFsIEZvcmNlV3JpdGVUaHJlYWQgZm9y\nY2VXcml0ZVRocmVhZDsKICAgIC8vIFRpbWUgYWZ0ZXIgd2hpY2ggd2Ugd2ls\nbCBzdG9wIGdyb3VwaW5nIGFuZCBpc3N1ZSB0aGUgZmx1c2gKICAgIHByaXZh\ndGUgZmluYWwgbG9uZyBtYXhHcm91cFdhaXRJbk1TZWM7CiAgICAvLyBUaHJl\nc2hvbGQgYWZ0ZXIgd2hpY2ggd2UgZmx1c2ggYW55IGJ1ZmZlcmVkIGpvdXJu\nYWwgZW50cmllcwogICAgcHJpdmF0ZSBmaW5hbCBsb25nIGJ1ZmZlcmVkRW50\ncmllc1RocmVzaG9sZDsKICAgIC8vIFRocmVzaG9sZCBhZnRlciB3aGljaCB3\nZSBmbHVzaCBhbnkgYnVmZmVyZWQgam91cm5hbCB3cml0ZXMKICAgIHByaXZh\ndGUgZmluYWwgbG9uZyBidWZmZXJlZFdyaXRlc1RocmVzaG9sZDsKICAgIC8v\nIHNob3VsZCB3ZSBmbHVzaCBpZiB0aGUgcXVldWUgaXMgZW1wdHkKICAgIHBy\naXZhdGUgZmluYWwgYm9vbGVhbiBmbHVzaFdoZW5RdWV1ZUVtcHR5OwogICAg\nLy8gc2hvdWxkIHdlIGhpbnQgdGhlIGZpbGVzeXN0ZW0gdG8gcmVtb3ZlIHBh\nZ2VzIGZyb20gY2FjaGUgYWZ0ZXIgZm9yY2Ugd3JpdGUKICAgIHByaXZhdGUg\nZmluYWwgYm9vbGVhbiByZW1vdmVQYWdlc0Zyb21DYWNoZTsKCiAgICBwcml2\nYXRlIGZpbmFsIExhc3RMb2dNYXJrIGxhc3RMb2dNYXJrID0gbmV3IExhc3RM\nb2dNYXJrKDAsIDApOwoKICAgIC8qKgogICAgICogVGhlIHRocmVhZCBwb29s\nIHVzZWQgdG8gaGFuZGxlIGNhbGxiYWNrLgogICAgICovCiAgICBwcml2YXRl\nIGZpbmFsIEV4ZWN1dG9yU2VydmljZSBjYlRocmVhZFBvb2w7CgogICAgLy8g\nam91cm5hbCBlbnRyeSBxdWV1ZSB0byBjb21taXQKICAgIGZpbmFsIExpbmtl\nZEJsb2NraW5nUXVldWU8UXVldWVFbnRyeT4gcXVldWUgPSBuZXcgTGlua2Vk\nQmxvY2tpbmdRdWV1ZTxRdWV1ZUVudHJ5PigpOwogICAgZmluYWwgTGlua2Vk\nQmxvY2tpbmdRdWV1ZTxGb3JjZVdyaXRlUmVxdWVzdD4gZm9yY2VXcml0ZVJl\ncXVlc3RzID0gbmV3IExpbmtlZEJsb2NraW5nUXVldWU8Rm9yY2VXcml0ZVJl\ncXVlc3Q+KCk7CgogICAgdm9sYXRpbGUgYm9vbGVhbiBydW5uaW5nID0gdHJ1\nZTsKICAgIHByaXZhdGUgZmluYWwgTGVkZ2VyRGlyc01hbmFnZXIgbGVkZ2Vy\nRGlyc01hbmFnZXI7CgogICAgLy8gRXhwb3NlIFN0YXRzCiAgICBwcml2YXRl\nIGZpbmFsIE9wU3RhdHNMb2dnZXIgam91cm5hbEFkZEVudHJ5U3RhdHM7CiAg\nICBwcml2YXRlIGZpbmFsIE9wU3RhdHNMb2dnZXIgam91cm5hbENyZWF0aW9u\nU3RhdHM7CiAgICBwcml2YXRlIGZpbmFsIE9wU3RhdHNMb2dnZXIgam91cm5h\nbEZsdXNoU3RhdHM7CiAgICBwcml2YXRlIGZpbmFsIE9wU3RhdHNMb2dnZXIg\nZm9yY2VXcml0ZUdyb3VwaW5nQ291bnRTdGF0czsKICAgIHByaXZhdGUgZmlu\nYWwgT3BTdGF0c0xvZ2dlciBmb3JjZVdyaXRlQmF0Y2hFbnRyaWVzU3RhdHM7\nCiAgICBwcml2YXRlIGZpbmFsIE9wU3RhdHNMb2dnZXIgZm9yY2VXcml0ZUJh\ndGNoQnl0ZXNTdGF0czsKICAgIHByaXZhdGUgZmluYWwgQ291bnRlciBqb3Vy\nbmFsUXVldWVTaXplOwogICAgcHJpdmF0ZSBmaW5hbCBDb3VudGVyIGZvcmNl\nV3JpdGVRdWV1ZVNpemU7CiAgICBwcml2YXRlIGZpbmFsIENvdW50ZXIgZmx1\nc2hNYXhXYWl0Q291bnRlcjsKICAgIHByaXZhdGUgZmluYWwgQ291bnRlciBm\nbHVzaE1heE91dHN0YW5kaW5nQnl0ZXNDb3VudGVyOwogICAgcHJpdmF0ZSBm\naW5hbCBDb3VudGVyIGZsdXNoRW1wdHlRdWV1ZUNvdW50ZXI7CiAgICBwcml2\nYXRlIGZpbmFsIENvdW50ZXIgam91cm5hbFdyaXRlQnl0ZXM7CgogICAgcHVi\nbGljIEpvdXJuYWwoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mLCBMZWRnZXJE\naXJzTWFuYWdlciBsZWRnZXJEaXJzTWFuYWdlcikgewogICAgICAgIHRoaXMo\nY29uZiwgbGVkZ2VyRGlyc01hbmFnZXIsIE51bGxTdGF0c0xvZ2dlci5JTlNU\nQU5DRSk7CiAgICB9CgogICAgcHVibGljIEpvdXJuYWwoU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mLCBMZWRnZXJEaXJzTWFuYWdlciBsZWRnZXJEaXJzTWFu\nYWdlciwgU3RhdHNMb2dnZXIgc3RhdHNMb2dnZXIpIHsKICAgICAgICBzdXBl\ncigiQm9va2llSm91cm5hbC0iICsgY29uZi5nZXRCb29raWVQb3J0KCkpOwog\nICAgICAgIHRoaXMubGVkZ2VyRGlyc01hbmFnZXIgPSBsZWRnZXJEaXJzTWFu\nYWdlcjsKICAgICAgICB0aGlzLmNvbmYgPSBjb25mOwogICAgICAgIHRoaXMu\nam91cm5hbERpcmVjdG9yeSA9IEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5\nKGNvbmYuZ2V0Sm91cm5hbERpcigpKTsKICAgICAgICB0aGlzLm1heEpvdXJu\nYWxTaXplID0gY29uZi5nZXRNYXhKb3VybmFsU2l6ZU1CKCkgKiBNQjsKICAg\nICAgICB0aGlzLmpvdXJuYWxQcmVBbGxvY1NpemUgPSBjb25mLmdldEpvdXJu\nYWxQcmVBbGxvY1NpemVNQigpICogTUI7CiAgICAgICAgdGhpcy5qb3VybmFs\nV3JpdGVCdWZmZXJTaXplID0gY29uZi5nZXRKb3VybmFsV3JpdGVCdWZmZXJT\naXplS0IoKSAqIEtCOwogICAgICAgIHRoaXMubWF4QmFja3VwSm91cm5hbHMg\nPSBjb25mLmdldE1heEJhY2t1cEpvdXJuYWxzKCk7CiAgICAgICAgdGhpcy5m\nb3JjZVdyaXRlVGhyZWFkID0gbmV3IEZvcmNlV3JpdGVUaHJlYWQodGhpcywg\nY29uZi5nZXRKb3VybmFsQWRhcHRpdmVHcm91cFdyaXRlcygpKTsKICAgICAg\nICB0aGlzLm1heEdyb3VwV2FpdEluTVNlYyA9IGNvbmYuZ2V0Sm91cm5hbE1h\neEdyb3VwV2FpdE1TZWMoKTsKICAgICAgICB0aGlzLmJ1ZmZlcmVkV3JpdGVz\nVGhyZXNob2xkID0gY29uZi5nZXRKb3VybmFsQnVmZmVyZWRXcml0ZXNUaHJl\nc2hvbGQoKTsKICAgICAgICB0aGlzLmJ1ZmZlcmVkRW50cmllc1RocmVzaG9s\nZCA9IGNvbmYuZ2V0Sm91cm5hbEJ1ZmZlcmVkRW50cmllc1RocmVzaG9sZCgp\nOwogICAgICAgIHRoaXMuY2JUaHJlYWRQb29sID0gRXhlY3V0b3JzLm5ld0Zp\neGVkVGhyZWFkUG9vbChjb25mLmdldE51bUpvdXJuYWxDYWxsYmFja1RocmVh\nZHMoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IERhZW1vblRocmVhZEZhY3RvcnkoKSk7\nCgogICAgICAgIC8vIFVubGVzcyB0aGVyZSBpcyBhIGNhcCBvbiB0aGUgbWF4\nIHdhaXQgKHdoaWNoIHJlcXVpcmVzIGdyb3VwIGZvcmNlIHdyaXRlcykKICAg\nICAgICAvLyB3ZSBjYW5ub3Qgc2tpcCBmbHVzaGluZyBmb3IgcXVldWUgZW1w\ndHkKICAgICAgICB0aGlzLmZsdXNoV2hlblF1ZXVlRW1wdHkgPSBtYXhHcm91\ncFdhaXRJbk1TZWMgPD0gMCB8fCBjb25mLmdldEpvdXJuYWxGbHVzaFdoZW5R\ndWV1ZUVtcHR5KCk7CgogICAgICAgIHRoaXMucmVtb3ZlUGFnZXNGcm9tQ2Fj\naGUgPSBjb25mLmdldEpvdXJuYWxSZW1vdmVQYWdlc0Zyb21DYWNoZSgpOwog\nICAgICAgIC8vIHJlYWQgbGFzdCBsb2cgbWFyawogICAgICAgIGxhc3RMb2dN\nYXJrLnJlYWRMb2coKTsKICAgICAgICBMT0cuZGVidWcoIkxhc3QgTG9nIE1h\ncmsgOiB7fSIsIGxhc3RMb2dNYXJrLmdldEN1ck1hcmsoKSk7CgogICAgICAg\nIC8vIEV4cG9zZSBTdGF0cwogICAgICAgIGpvdXJuYWxBZGRFbnRyeVN0YXRz\nID0gc3RhdHNMb2dnZXIuZ2V0T3BTdGF0c0xvZ2dlcihKT1VSTkFMX0FERF9F\nTlRSWSk7CiAgICAgICAgam91cm5hbENyZWF0aW9uU3RhdHMgPSBzdGF0c0xv\nZ2dlci5nZXRPcFN0YXRzTG9nZ2VyKEpPVVJOQUxfQ1JFQVRJT05fTEFURU5D\nWSk7CiAgICAgICAgam91cm5hbEZsdXNoU3RhdHMgPSBzdGF0c0xvZ2dlci5n\nZXRPcFN0YXRzTG9nZ2VyKEpPVVJOQUxfRkxVU0hfTEFURU5DWSk7CiAgICAg\nICAgZm9yY2VXcml0ZUdyb3VwaW5nQ291bnRTdGF0cyA9IHN0YXRzTG9nZ2Vy\nLmdldE9wU3RhdHNMb2dnZXIoSk9VUk5BTF9GT1JDRV9XUklURV9HUk9VUElO\nR19DT1VOVCk7CiAgICAgICAgZm9yY2VXcml0ZUJhdGNoRW50cmllc1N0YXRz\nID0gc3RhdHNMb2dnZXIuZ2V0T3BTdGF0c0xvZ2dlcihKT1VSTkFMX0ZPUkNF\nX1dSSVRFX0JBVENIX0VOVFJJRVMpOwogICAgICAgIGZvcmNlV3JpdGVCYXRj\naEJ5dGVzU3RhdHMgPSBzdGF0c0xvZ2dlci5nZXRPcFN0YXRzTG9nZ2VyKEpP\nVVJOQUxfRk9SQ0VfV1JJVEVfQkFUQ0hfQllURVMpOwogICAgICAgIGpvdXJu\nYWxRdWV1ZVNpemUgPSBzdGF0c0xvZ2dlci5nZXRDb3VudGVyKEpPVVJOQUxf\nUVVFVUVfU0laRSk7CiAgICAgICAgZm9yY2VXcml0ZVF1ZXVlU2l6ZSA9IHN0\nYXRzTG9nZ2VyLmdldENvdW50ZXIoSk9VUk5BTF9GT1JDRV9XUklURV9RVUVV\nRV9TSVpFKTsKICAgICAgICBmbHVzaE1heFdhaXRDb3VudGVyID0gc3RhdHNM\nb2dnZXIuZ2V0Q291bnRlcihKT1VSTkFMX05VTV9GTFVTSF9NQVhfV0FJVCk7\nCiAgICAgICAgZmx1c2hNYXhPdXRzdGFuZGluZ0J5dGVzQ291bnRlciA9IHN0\nYXRzTG9nZ2VyLmdldENvdW50ZXIoSk9VUk5BTF9OVU1fRkxVU0hfTUFYX09V\nVFNUQU5ESU5HX0JZVEVTKTsKICAgICAgICBmbHVzaEVtcHR5UXVldWVDb3Vu\ndGVyID0gc3RhdHNMb2dnZXIuZ2V0Q291bnRlcihKT1VSTkFMX05VTV9GTFVT\nSF9FTVBUWV9RVUVVRSk7CiAgICAgICAgam91cm5hbFdyaXRlQnl0ZXMgPSBz\ndGF0c0xvZ2dlci5nZXRDb3VudGVyKEpPVVJOQUxfV1JJVEVfQllURVMpOwog\nICAgfQoKICAgIExhc3RMb2dNYXJrIGdldExhc3RMb2dNYXJrKCkgewogICAg\nICAgIHJldHVybiBsYXN0TG9nTWFyazsKICAgIH0KCiAgICAvKioKICAgICAq\nIEFwcGxpY2F0aW9uIHRyaWVkIHRvIHNjaGVkdWxlIGEgY2hlY2twb2ludC4g\nQWZ0ZXIgYWxsIHRoZSB0eG5zIGFkZGVkCiAgICAgKiBiZWZvcmUgY2hlY2tw\nb2ludCBhcmUgcGVyc2lzdGVkLCBhIDxpPmNoZWNrcG9pbnQ8L2k+IHdpbGwg\nYmUgcmV0dXJuZWQKICAgICAqIHRvIGFwcGxpY2F0aW9uLiBBcHBsaWNhdGlv\nbiBjb3VsZCB1c2UgPGk+Y2hlY2twb2ludDwvaT4gdG8gZG8gaXRzIGxvZ2lj\nLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBDaGVja3BvaW50\nIG5ld0NoZWNrcG9pbnQoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBMb2dNYXJr\nQ2hlY2twb2ludChsYXN0TG9nTWFyay5tYXJrTG9nKCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGVsbGluZyBqb3VybmFsIGEgY2hlY2twb2ludCBpcyBm\naW5pc2hlZC4KICAgICAqCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAg\nICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY2hlY2twb2lu\ndENvbXBsZXRlKENoZWNrcG9pbnQgY2hlY2twb2ludCwgYm9vbGVhbiBjb21w\nYWN0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICghKGNoZWNr\ncG9pbnQgaW5zdGFuY2VvZiBMb2dNYXJrQ2hlY2twb2ludCkpIHsKICAgICAg\nICAgICAgcmV0dXJuOyAvLyB3ZSBkaWRuJ3QgY3JlYXRlIHRoaXMgY2hlY2tw\nb2ludCwgc28gZG9udCBkbyBhbnl0aGluZyB3aXRoIGl0CiAgICAgICAgfQog\nICAgICAgIExvZ01hcmtDaGVja3BvaW50IGxtY2hlY2twb2ludCA9IChMb2dN\nYXJrQ2hlY2twb2ludCljaGVja3BvaW50OwogICAgICAgIExhc3RMb2dNYXJr\nIG1hcmsgPSBsbWNoZWNrcG9pbnQubWFyazsKCiAgICAgICAgbWFyay5yb2xs\nTG9nKG1hcmspOwogICAgICAgIGlmIChjb21wYWN0KSB7CiAgICAgICAgICAg\nIC8vIGxpc3QgdGhlIGpvdXJuYWxzIHRoYXQgaGF2ZSBiZWVuIG1hcmtlZAog\nICAgICAgICAgICBMaXN0PExvbmc+IGxvZ3MgPSBsaXN0Sm91cm5hbElkcyhq\nb3VybmFsRGlyZWN0b3J5LCBuZXcgSm91cm5hbFJvbGxpbmdGaWx0ZXIobWFy\naykpOwogICAgICAgICAgICAvLyBrZWVwIE1BWF9CQUNLVVBfSk9VUk5BTFMg\nam91cm5hbCBmaWxlcyBiZWZvcmUgbWFya2VkIGpvdXJuYWwKICAgICAgICAg\nICAgaWYgKGxvZ3Muc2l6ZSgpID49IG1heEJhY2t1cEpvdXJuYWxzKSB7CiAg\nICAgICAgICAgICAgICBpbnQgbWF4SWR4ID0gbG9ncy5zaXplKCkgLSBtYXhC\nYWNrdXBKb3VybmFsczsKICAgICAgICAgICAgICAgIGZvciAoaW50IGk9MDsg\naTxtYXhJZHg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGxvbmcgaWQg\nPSBsb2dzLmdldChpKTsKICAgICAgICAgICAgICAgICAgICAvLyBtYWtlIHN1\ncmUgdGhlIGpvdXJuYWwgaWQgaXMgc21hbGxlciB0aGFuIG1hcmtlZCBqb3Vy\nbmFsIGlkCiAgICAgICAgICAgICAgICAgICAgaWYgKGlkIDwgbWFyay5nZXRD\ndXJNYXJrKCkuZ2V0TG9nRmlsZUlkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgRmlsZSBqb3VybmFsRmlsZSA9IG5ldyBGaWxlKGpvdXJuYWxEaXJl\nY3RvcnksIExvbmcudG9IZXhTdHJpbmcoaWQpICsgIi50eG4iKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKCFqb3VybmFsRmlsZS5kZWxldGUoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkNvdWxk\nIG5vdCBkZWxldGUgb2xkIGpvdXJuYWwgZmlsZSB7fSIsIGpvdXJuYWxGaWxl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICBMT0cuaW5mbygiZ2FyYmFnZSBjb2xsZWN0ZWQgam91cm5hbCAi\nICsgam91cm5hbEZpbGUuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTY2FuIHRoZSBqb3VybmFsCiAgICAg\nKgogICAgICogQHBhcmFtIGpvdXJuYWxJZAogICAgICogICAgICAgICAgSm91\ncm5hbCBMb2cgSWQKICAgICAqIEBwYXJhbSBqb3VybmFsUG9zCiAgICAgKiAg\nICAgICAgICBPZmZzZXQgdG8gc3RhcnQgc2Nhbm5pbmcKICAgICAqIEBwYXJh\nbSBzY2FubmVyCiAgICAgKiAgICAgICAgICBTY2FubmVyIHRvIGhhbmRsZSBl\nbnRyaWVzCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHNjYW5Kb3VybmFsKGxvbmcgam91cm5hbElkLCBsb25n\nIGpvdXJuYWxQb3MsIEpvdXJuYWxTY2FubmVyIHNjYW5uZXIpCiAgICAgICAg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBKb3VybmFsQ2hhbm5lbCBy\nZWNMb2c7CiAgICAgICAgaWYgKGpvdXJuYWxQb3MgPD0gMCkgewogICAgICAg\nICAgICByZWNMb2cgPSBuZXcgSm91cm5hbENoYW5uZWwoam91cm5hbERpcmVj\ndG9yeSwgam91cm5hbElkLCBqb3VybmFsUHJlQWxsb2NTaXplLCBqb3VybmFs\nV3JpdGVCdWZmZXJTaXplKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICByZWNMb2cgPSBuZXcgSm91cm5hbENoYW5uZWwoam91cm5hbERpcmVjdG9y\neSwgam91cm5hbElkLCBqb3VybmFsUHJlQWxsb2NTaXplLCBqb3VybmFsV3Jp\ndGVCdWZmZXJTaXplLCBqb3VybmFsUG9zKTsKICAgICAgICB9CiAgICAgICAg\naW50IGpvdXJuYWxWZXJzaW9uID0gcmVjTG9nLmdldEZvcm1hdFZlcnNpb24o\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCeXRlQnVmZmVyIGxlbkJ1\nZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAgICBCeXRl\nQnVmZmVyIHJlY0J1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDY0KjEwMjQp\nOwogICAgICAgICAgICB3aGlsZSh0cnVlKSB7CiAgICAgICAgICAgICAgICAv\nLyBlbnRyeSBzdGFydCBvZmZzZXQKICAgICAgICAgICAgICAgIGxvbmcgb2Zm\nc2V0ID0gcmVjTG9nLmZjLnBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgICAv\nLyBzdGFydCByZWFkaW5nIGVudHJ5CiAgICAgICAgICAgICAgICBsZW5CdWZm\nLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBmdWxsUmVhZChyZWNMb2csIGxl\nbkJ1ZmYpOwogICAgICAgICAgICAgICAgaWYgKGxlbkJ1ZmYucmVtYWluaW5n\nKCkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgbGVuQnVmZi5mbGlwKCk7CiAg\nICAgICAgICAgICAgICBpbnQgbGVuID0gbGVuQnVmZi5nZXRJbnQoKTsKICAg\nICAgICAgICAgICAgIGlmIChsZW4gPT0gMCkgewogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nYm9vbGVhbiBpc1BhZGRpbmdSZWNvcmQgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgIGlmIChsZW4gPT0gUEFERElOR19NQVNLKSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGpvdXJuYWxWZXJzaW9uID49IEpvdXJuYWxDaGFubmVsLlY1\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNraXAgcGFkZGluZyBi\neXRlcwogICAgICAgICAgICAgICAgICAgICAgICBsZW5CdWZmLmNsZWFyKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bGxSZWFkKHJlY0xvZywgbGVu\nQnVmZik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZW5CdWZmLnJl\nbWFpbmluZygpICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwogICAgICAgICAgICAgICAg\nICAgICAgICBsZW4gPSBsZW5CdWZmLmdldEludCgpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAobGVuID09IDApIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUGFkZGluZ1JlY29yZCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJJbnZhbGlkIHJl\nY29yZCBmb3VuZCB3aXRoIG5lZ2F0aXZlIGxlbmd0aCA6ICIgKyBsZW4pOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIHJlY0J1ZmYuY2xlYXIoKTsKICAgICAgICAgICAgICAgIGlm\nIChyZWNCdWZmLnJlbWFpbmluZygpIDwgbGVuKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmVjQnVmZiA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUobGVuKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlY0J1ZmYubGltaXQo\nbGVuKTsKICAgICAgICAgICAgICAgIGlmIChmdWxsUmVhZChyZWNMb2csIHJl\nY0J1ZmYpICE9IGxlbikgewogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMg\nc2VlbXMgc2NhcnksIGJ1dCBpdCBqdXN0IG1lYW5zIHRoYXQgdGhpcyBpcyB3\naGVyZSB3ZQogICAgICAgICAgICAgICAgICAgIC8vIGxlZnQgb2ZmIHdyaXRp\nbmcKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHJlY0J1ZmYuZmxpcCgpOwogICAgICAgICAg\nICAgICAgaWYgKCFpc1BhZGRpbmdSZWNvcmQpIHsKICAgICAgICAgICAgICAg\nICAgICBzY2FubmVyLnByb2Nlc3Moam91cm5hbFZlcnNpb24sIG9mZnNldCwg\ncmVjQnVmZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICByZWNMb2cuY2xvc2UoKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYXkgam91cm5h\nbCBmaWxlcwogICAgICoKICAgICAqIEBwYXJhbSBzY2FubmVyCiAgICAgKiAg\nICAgICAgICBTY2FubmVyIHRvIHByb2Nlc3MgcmVwbGF5ZWQgZW50cmllcy4K\nICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgcmVwbGF5KEpvdXJuYWxTY2FubmVyIHNjYW5uZXIpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgTG9nTWFyayBtYXJrZWRMb2cg\nPSBsYXN0TG9nTWFyay5nZXRDdXJNYXJrKCk7CiAgICAgICAgTGlzdDxMb25n\nPiBsb2dzID0gbGlzdEpvdXJuYWxJZHMoam91cm5hbERpcmVjdG9yeSwgbmV3\nIEpvdXJuYWxJZEZpbHRlcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChsb25nIGpvdXJuYWxJ\nZCkgewogICAgICAgICAgICAgICAgaWYgKGpvdXJuYWxJZCA8IG1hcmtlZExv\nZy5nZXRMb2dGaWxlSWQoKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAg\nLy8gbGFzdCBsb2cgbWFyayBtYXkgYmUgbWlzc2VkIGR1ZSB0byBubyBzeW5j\nIHVwIGJlZm9yZQogICAgICAgIC8vIHZhbGlkYXRlIGZpbHRlcmVkIGxvZyBp\nZHMgb25seSB3aGVuIHdlIGhhdmUgbWFya2VkTG9nSWQKICAgICAgICBpZiAo\nbWFya2VkTG9nLmdldExvZ0ZpbGVJZCgpID4gMCkgewogICAgICAgICAgICBp\nZiAobG9ncy5zaXplKCkgPT0gMCB8fCBsb2dzLmdldCgwKSAhPSBtYXJrZWRM\nb2cuZ2V0TG9nRmlsZUlkKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJT0V4Y2VwdGlvbigiUmVjb3ZlcnkgbG9nICIgKyBtYXJrZWRMb2cuZ2V0\nTG9nRmlsZUlkKCkgKyAiIGlzIG1pc3NpbmciKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBMT0cuZGVidWcoIlRyeSB0byByZWxheSBqb3Vy\nbmFsIGxvZ3MgOiB7fSIsIGxvZ3MpOwogICAgICAgIC8vIFRPRE86IFdoZW4g\ncmVhZGluZyBpbiB0aGUgam91cm5hbCBsb2dzIHRoYXQgbmVlZCB0byBiZSBz\neW5jZWQsIHdlCiAgICAgICAgLy8gc2hvdWxkIHVzZSBCdWZmZXJlZENoYW5u\nZWxzIGluc3RlYWQgdG8gbWluaW1pemUgdGhlIGFtb3VudCBvZgogICAgICAg\nIC8vIHN5c3RlbSBjYWxscyBkb25lLgogICAgICAgIGZvcihMb25nIGlkOiBs\nb2dzKSB7CiAgICAgICAgICAgIGxvbmcgbG9nUG9zaXRpb24gPSAwTDsKICAg\nICAgICAgICAgaWYoaWQgPT0gbWFya2VkTG9nLmdldExvZ0ZpbGVJZCgpKSB7\nCiAgICAgICAgICAgICAgICBsb2dQb3NpdGlvbiA9IG1hcmtlZExvZy5nZXRM\nb2dGaWxlT2Zmc2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTE9H\nLmluZm8oIlJlcGxheWluZyBqb3VybmFsIHt9IGZyb20gcG9zaXRpb24ge30i\nLCBpZCwgbG9nUG9zaXRpb24pOwogICAgICAgICAgICBzY2FuSm91cm5hbChp\nZCwgbG9nUG9zaXRpb24sIHNjYW5uZXIpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIHJlY29yZCBhbiBhZGQgZW50cnkgb3BlcmF0aW9uIGlu\nIGpvdXJuYWwKICAgICAqLwogICAgcHVibGljIHZvaWQgbG9nQWRkRW50cnko\nQnl0ZUJ1ZmZlciBlbnRyeSwgV3JpdGVDYWxsYmFjayBjYiwgT2JqZWN0IGN0\neCkgewogICAgICAgIGxvbmcgbGVkZ2VySWQgPSBlbnRyeS5nZXRMb25nKCk7\nCiAgICAgICAgbG9uZyBlbnRyeUlkID0gZW50cnkuZ2V0TG9uZygpOwogICAg\nICAgIGVudHJ5LnJld2luZCgpOwogICAgICAgIGpvdXJuYWxRdWV1ZVNpemUu\naW5jKCk7CiAgICAgICAgcXVldWUuYWRkKG5ldyBRdWV1ZUVudHJ5KGVudHJ5\nLCBsZWRnZXJJZCwgZW50cnlJZCwgY2IsIGN0eCwgTWF0aFV0aWxzLm5vd0lu\nTmFubygpKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxlbmd0\naCBvZiBqb3VybmFsIGVudHJpZXMgcXVldWUuCiAgICAgKgogICAgICogQHJl\ndHVybiBsZW5ndGggb2Ygam91cm5hbCBlbnRyeSBxdWV1ZS4KICAgICAqLwog\nICAgcHVibGljIGludCBnZXRKb3VybmFsUXVldWVMZW5ndGgoKSB7CiAgICAg\nICAgcmV0dXJuIHF1ZXVlLnNpemUoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEEgdGhyZWFkIHVzZWQgZm9yIHBlcnNpc3Rpbmcgam91cm5hbCBlbnRyaWVz\nIHRvIGpvdXJuYWwgZmlsZXMuCiAgICAgKgogICAgICogPHA+CiAgICAgKiBC\nZXNpZGVzIHBlcnNpc3Rpbmcgam91cm5hbCBlbnRyaWVzLCBpdCBhbHNvIHRh\na2VzIHJlc3BvbnNpYmlsaXR5IG9mCiAgICAgKiByb2xsaW5nIGpvdXJuYWwg\nZmlsZXMgd2hlbiBhIGpvdXJuYWwgZmlsZSByZWFjaGVzIGpvdXJuYWwgZmls\nZSBzaXplCiAgICAgKiBsaW1pdGF0aW9uLgogICAgICogPC9wPgogICAgICog\nPHA+CiAgICAgKiBEdXJpbmcgam91cm5hbCByb2xsaW5nLCBpdCBmaXJzdCBj\nbG9zZXMgdGhlIHdyaXRpbmcgam91cm5hbCwgZ2VuZXJhdGVzCiAgICAgKiBu\nZXcgam91cm5hbCBmaWxlIHVzaW5nIGN1cnJlbnQgdGltZXN0YW1wLCBhbmQg\nY29udGludWUgcGVyc2lzdGVuY2UgbG9naWMuCiAgICAgKiBUaG9zZSBqb3Vy\nbmFscyB3aWxsIGJlIGdhcmJhZ2UgY29sbGVjdGVkIGluIFN5bmNUaHJlYWQu\nCiAgICAgKiA8L3A+CiAgICAgKiBAc2VlIG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuU3luY1RocmVhZAogICAgICovCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICBMaW5rZWRMaXN0PFF1ZXVl\nRW50cnk+IHRvRmx1c2ggPSBuZXcgTGlua2VkTGlzdDxRdWV1ZUVudHJ5Pigp\nOwogICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoNCk7CiAgICAgICAgQnl0ZUJ1ZmZlciBwYWRkaW5nQnVmZiA9IEJ5\ndGVCdWZmZXIuYWxsb2NhdGUoMiAqIGNvbmYuZ2V0Sm91cm5hbEFsaWdubWVu\ndFNpemUoKSk7CiAgICAgICAgWmVyb0J1ZmZlci5wdXQocGFkZGluZ0J1ZmYp\nOwogICAgICAgIEpvdXJuYWxDaGFubmVsIGxvZ0ZpbGUgPSBudWxsOwogICAg\nICAgIGZvcmNlV3JpdGVUaHJlYWQuc3RhcnQoKTsKICAgICAgICBTdG9wd2F0\nY2ggam91cm5hbENyZWF0aW9uV2F0Y2hlciA9IG5ldyBTdG9wd2F0Y2goKTsK\nICAgICAgICBTdG9wd2F0Y2ggam91cm5hbEZsdXNoV2F0Y2hlciA9IG5ldyBT\ndG9wd2F0Y2goKTsKICAgICAgICBsb25nIGJhdGNoU2l6ZSA9IDA7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgTGlzdDxMb25nPiBqb3VybmFsSWRzID0g\nbGlzdEpvdXJuYWxJZHMoam91cm5hbERpcmVjdG9yeSwgbnVsbCk7CiAgICAg\nICAgICAgIC8vIFNob3VsZCBub3QgdXNlIE1hdGhVdGlscy5ub3coKSwgd2hp\nY2ggdXNlIFN5c3RlbS5uYW5vVGltZSgpIGFuZAogICAgICAgICAgICAvLyBj\nb3VsZCBvbmx5IGJlIHVzZWQgdG8gbWVhc3VyZSBlbGFwc2VkIHRpbWUuCiAg\nICAgICAgICAgIC8vIGh0dHA6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzEu\nNS4wL2RvY3MvYXBpL2phdmEvbGFuZy9TeXN0ZW0uaHRtbCNuYW5vVGltZSUy\nOCUyOQogICAgICAgICAgICBsb25nIGxvZ0lkID0gam91cm5hbElkcy5pc0Vt\ncHR5KCkgPyBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSA6IGpvdXJuYWxJ\nZHMuZ2V0KGpvdXJuYWxJZHMuc2l6ZSgpIC0gMSk7CiAgICAgICAgICAgIEJ1\nZmZlcmVkQ2hhbm5lbCBiYyA9IG51bGw7CiAgICAgICAgICAgIGxvbmcgbGFz\ndEZsdXNoUG9zaXRpb24gPSAwOwogICAgICAgICAgICBib29sZWFuIGdyb3Vw\nV2hlblRpbWVvdXQgPSBmYWxzZTsKCiAgICAgICAgICAgIFF1ZXVlRW50cnkg\ncWUgPSBudWxsOwogICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAg\nICAgICAgICAgLy8gbmV3IGpvdXJuYWwgZmlsZSB0byB3cml0ZQogICAgICAg\nICAgICAgICAgaWYgKG51bGwgPT0gbG9nRmlsZSkgewogICAgICAgICAgICAg\nICAgICAgIGxvZ0lkID0gbG9nSWQgKyAxOwoKICAgICAgICAgICAgICAgICAg\nICBqb3VybmFsQ3JlYXRpb25XYXRjaGVyLnJlc2V0KCkuc3RhcnQoKTsKICAg\nICAgICAgICAgICAgICAgICBsb2dGaWxlID0gbmV3IEpvdXJuYWxDaGFubmVs\nKGpvdXJuYWxEaXJlY3RvcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsb2dJZCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGpvdXJuYWxQcmVBbGxvY1NpemUsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb3VybmFsV3JpdGVC\ndWZmZXJTaXplLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY29uZi5nZXRKb3VybmFsQWxpZ25tZW50U2l6ZSgpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVtb3ZlUGFnZXNG\ncm9tQ2FjaGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBjb25mLmdldEpvdXJuYWxGb3JtYXRWZXJzaW9uVG9Xcml0ZSgpKTsK\nICAgICAgICAgICAgICAgICAgICBqb3VybmFsQ3JlYXRpb25TdGF0cy5yZWdp\nc3RlclN1Y2Nlc3NmdWxFdmVudCgKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGpvdXJuYWxDcmVhdGlvbldhdGNoZXIuc3RvcCgpLmVsYXBzZWRUaW1l\nKFRpbWVVbml0Lk1JTExJU0VDT05EUykpOwoKICAgICAgICAgICAgICAgICAg\nICBiYyA9IGxvZ0ZpbGUuZ2V0QnVmZmVyZWRDaGFubmVsKCk7CgogICAgICAg\nICAgICAgICAgICAgIGxhc3RGbHVzaFBvc2l0aW9uID0gYmMucG9zaXRpb24o\nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocWUg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmICh0b0ZsdXNoLmlz\nRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBxZSA9IHF1ZXVl\nLnRha2UoKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBsb25nIHBvbGxXYWl0VGltZSA9IG1heEdyb3Vw\nV2FpdEluTVNlYyAtIE1hdGhVdGlscy5lbGFwc2VkTVNlYyh0b0ZsdXNoLmdl\ndEZpcnN0KCkuZW5xdWV1ZVRpbWUpOwogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoZmx1c2hXaGVuUXVldWVFbXB0eSB8fCBwb2xsV2FpdFRpbWUgPCAw\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb2xsV2FpdFRpbWUg\nPSAwOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIHFlID0gcXVldWUucG9sbChwb2xsV2FpdFRpbWUsIFRpbWVV\nbml0Lk1JTExJU0VDT05EUyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJv\nb2xlYW4gc2hvdWxkRmx1c2ggPSBmYWxzZTsKICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gV2Ugc2hvdWxkIGlzc3VlIGEgZm9yY2VXcml0ZSBpZiBhbnkg\nb2YgdGhlIHRocmVlIGNvbmRpdGlvbnMgYmVsb3cgaG9sZHMgZ29vZAogICAg\nICAgICAgICAgICAgICAgICAgICAvLyAxLiBJZiB0aGUgb2xkZXN0IHBlbmRp\nbmcgZW50cnkgaGFzIGJlZW4gcGVuZGluZyBmb3IgbG9uZ2VyIHRoYW4gdGhl\nIG1heCB3YWl0IHRpbWUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1h\neEdyb3VwV2FpdEluTVNlYyA+IDAgJiYgIWdyb3VwV2hlblRpbWVvdXQgJiYg\nKE1hdGhVdGlscy5lbGFwc2VkTVNlYyh0b0ZsdXNoLmdldEZpcnN0KCkuZW5x\ndWV1ZVRpbWUpID4gbWF4R3JvdXBXYWl0SW5NU2VjKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZ3JvdXBXaGVuVGltZW91dCA9IHRydWU7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobWF4R3JvdXBXYWl0\nSW5NU2VjID4gMCAmJiBncm91cFdoZW5UaW1lb3V0ICYmIHFlICE9IG51bGwg\nJiYgTWF0aFV0aWxzLmVsYXBzZWRNU2VjKHFlLmVucXVldWVUaW1lKSA8IG1h\neEdyb3VwV2FpdEluTVNlYykgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gd2hlbiBncm91cCB0aW1lb3V0LCBpdCB3b3VsZCBiZSBiZXR0ZXIg\ndG8gbG9vayBmb3J3YXJkLCBhcyB0aGVyZSBtaWdodCBiZSBsb3RzIG9mIGVu\ndHJpZXMgYWxyZWFkeSB0aW1lb3V0CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBkdWUgdG8gYSBwcmV2aW91cyBzbG93IHdyaXRlICh3cml0aW5n\nIHRvIGZpbGVzeXN0ZW0gd2hpY2ggaW1wYWN0ZWQgYnkgZm9yY2Ugd3JpdGUp\nLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gR3JvdXAgdGhvc2Ug\nZW50cmllcyBpbiB0aGUgcXVldWUKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGEpIGFscmVhZHkgdGltZW91dAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gYikgbGltaXQgdGhlIG51bWJlciBvZiBlbnRyaWVzIHRv\nIGdyb3VwCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBncm91cFdoZW5U\naW1lb3V0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBz\naG91bGRGbHVzaCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBmbHVzaE1heFdhaXRDb3VudGVyLmluYygpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKHFlICE9IG51bGwgJiYKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAoKGJ1ZmZlcmVkRW50cmllc1RocmVzaG9s\nZCA+IDAgJiYgdG9GbHVzaC5zaXplKCkgPiBidWZmZXJlZEVudHJpZXNUaHJl\nc2hvbGQpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChi\nYy5wb3NpdGlvbigpID4gbGFzdEZsdXNoUG9zaXRpb24gKyBidWZmZXJlZFdy\naXRlc1RocmVzaG9sZCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyAyLiBJZiB3ZSBoYXZlIGJ1ZmZlcmVkIG1vcmUgdGhhbiB0aGUgYnVm\nZldyaXRlVGhyZXNob2xkIG9yIGJ1ZmZlcmVkRW50cmllc1RocmVzaG9sZAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkRmx1c2ggPSB0cnVl\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmx1c2hNYXhPdXRzdGFu\nZGluZ0J5dGVzQ291bnRlci5pbmMoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIGlmIChxZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBXZSBzaG91bGQgZ2V0IGhlcmUgb25seSBpZiB3ZSBm\nbHVzaFdoZW5RdWV1ZUVtcHR5IGlzIHRydWUgZWxzZSB3ZSB3b3VsZCB3YWl0\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBmb3IgdGltZW91dCB0\naGF0IHdvdWxkIHB1dCBpcyBwYXN0IHRoZSBtYXhXYWl0IHRocmVzaG9sZAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gMy4gSWYgdGhlIHF1ZXVl\nIGlzIGVtcHR5IGkuZS4gbm8gYmVuZWZpdCBvZiBncm91cGluZy4gVGhpcyBo\nYXBwZW5zIHdoZW4gd2UgaGF2ZSBvbmUKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIHB1Ymxpc2ggYXQgYSB0aW1lIC0gY29tbW9uIGNhc2UgaW4g\ndGVzdHMuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG91bGRGbHVz\naCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbHVzaEVt\ncHR5UXVldWVDb3VudGVyLmluYygpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgICAgICAvLyB0b0ZsdXNoIGlzIG5v\nbiBudWxsIGFuZCBub3QgZW1wdHkgc28gc2hvdWxkIGJlIHNhZmUgdG8gYWNj\nZXNzIGdldEZpcnN0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzaG91\nbGRGbHVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNv\nbmYuZ2V0Sm91cm5hbEZvcm1hdFZlcnNpb25Ub1dyaXRlKCkgPj0gSm91cm5h\nbENoYW5uZWwuVjUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB3cml0ZVBhZGRpbmdCeXRlcyhsb2dGaWxlLCBwYWRkaW5nQnVmZiwgY29u\nZi5nZXRKb3VybmFsQWxpZ25tZW50U2l6ZSgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpv\ndXJuYWxGbHVzaFdhdGNoZXIucmVzZXQoKS5zdGFydCgpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYmMuZmx1c2goZmFsc2UpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbGFzdEZsdXNoUG9zaXRpb24gPSBiYy5wb3Np\ndGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgam91cm5hbEZs\ndXNoU3RhdHMucmVnaXN0ZXJTdWNjZXNzZnVsRXZlbnQoCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGpvdXJuYWxGbHVzaFdhdGNoZXIu\nc3RvcCgpLmVsYXBzZWRUaW1lKFRpbWVVbml0Lk1JTExJU0VDT05EUykpOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyYWNlIHRoZSBsaWZl\ndGltZSBvZiBlbnRyaWVzIHRocm91Z2ggcGVyc2lzdGVuY2UKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoUXVldWVF\nbnRyeSBlIDogdG9GbHVzaCkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBMT0cuZGVidWcoIldyaXR0ZW4gYW5kIHF1ZXVpbmcgZm9y\nIGZsdXNoIExlZGdlcjoiICsgZS5sZWRnZXJJZCArICIgRW50cnk6IiArIGUu\nZW50cnlJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZvcmNlV3JpdGVCYXRjaEVudHJpZXNTdGF0cy5yZWdp\nc3RlclN1Y2Nlc3NmdWxFdmVudCh0b0ZsdXNoLnNpemUoKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBmb3JjZVdyaXRlQmF0Y2hCeXRlc1N0YXRz\nLnJlZ2lzdGVyU3VjY2Vzc2Z1bEV2ZW50KGJhdGNoU2l6ZSk7CgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZm9yY2VXcml0ZVJlcXVlc3RzLnB1dChu\nZXcgRm9yY2VXcml0ZVJlcXVlc3QobG9nRmlsZSwgbG9nSWQsIGxhc3RGbHVz\naFBvc2l0aW9uLCB0b0ZsdXNoLCAobGFzdEZsdXNoUG9zaXRpb24gPiBtYXhK\nb3VybmFsU2l6ZSksIGZhbHNlKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB0b0ZsdXNoID0gbmV3IExpbmtlZExpc3Q8UXVldWVFbnRyeT4oKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhdGNoU2l6ZSA9IDBMOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciBq\nb3VybmFsIGZpbGUgaXMgb3ZlciBmaWxlIGxpbWl0CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoYmMucG9zaXRpb24oKSA+IG1heEpvdXJuYWxT\naXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nRmls\nZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFydW5uaW5nKSB7\nCiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIkpvdXJuYWwgTWFuYWdl\nciBpcyBhc2tlZCB0byBzaHV0IGRvd24sIHF1aXQuIik7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgaWYgKHFlID09IG51bGwpIHsgLy8gbm8gbW9yZSBxdWV1ZSBlbnRy\neQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIGpvdXJuYWxXcml0ZUJ5dGVzLmFkZChx\nZS5lbnRyeS5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgICAgICBqb3VybmFs\nUXVldWVTaXplLmRlYygpOwoKICAgICAgICAgICAgICAgIGJhdGNoU2l6ZSAr\nPSAoNCArIHFlLmVudHJ5LnJlbWFpbmluZygpKTsKCiAgICAgICAgICAgICAg\nICBsZW5CdWZmLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBsZW5CdWZmLnB1\ndEludChxZS5lbnRyeS5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgICAgICBs\nZW5CdWZmLmZsaXAoKTsKCiAgICAgICAgICAgICAgICAvLyBwcmVBbGxvYyBi\nYXNlZCBvbiBzaXplCiAgICAgICAgICAgICAgICBsb2dGaWxlLnByZUFsbG9j\nSWZOZWVkZWQoNCArIHFlLmVudHJ5LnJlbWFpbmluZygpKTsKCiAgICAgICAg\nICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gd2Ugc2hvdWxkIGJlIGRv\naW5nIHRoZSBmb2xsb3dpbmcsIGJ1dCB0aGVuIHdlIHJ1biBvdXQgb2YKICAg\nICAgICAgICAgICAgIC8vIGRpcmVjdCBieXRlIGJ1ZmZlcnMKICAgICAgICAg\nICAgICAgIC8vIGxvZ0ZpbGUud3JpdGUobmV3IEJ5dGVCdWZmZXJbXSB7IGxl\nbkJ1ZmYsIHFlLmVudHJ5IH0pOwogICAgICAgICAgICAgICAgYmMud3JpdGUo\nbGVuQnVmZik7CiAgICAgICAgICAgICAgICBiYy53cml0ZShxZS5lbnRyeSk7\nCgogICAgICAgICAgICAgICAgdG9GbHVzaC5hZGQocWUpOwogICAgICAgICAg\nICAgICAgcWUgPSBudWxsOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxv\nZ0ZpbGUuY2xvc2UoKTsKICAgICAgICAgICAgbG9nRmlsZSA9IG51bGw7CiAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiSS9PIGV4Y2VwdGlvbiBpbiBKb3VybmFsIHRocmVhZCEi\nLCBpb2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGllKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJKb3VybmFsIGV4aXRzIHdo\nZW4gc2h1dHRpbmcgZG93biIsIGllKTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAvLyBUaGVyZSBjb3VsZCBiZSBwYWNrZXRzIHF1ZXVlZCBm\nb3IgZm9yY2VXcml0ZSBvbiB0aGlzIGxvZ0ZpbGUKICAgICAgICAgICAgLy8g\nVGhhdCBpcyBmaW5lIGFzIHRoaXMgZXhjZXB0aW9uIGlzIGdvaW5nIHRvIGFu\neXdheSB0YWtlIGRvd24gdGhlCiAgICAgICAgICAgIC8vIHRoZSBib29raWUu\nIElmIHdlIGV4ZWN1dGUgdGhpcyBhcyBhIHBhcnQgb2YgZ3JhY2VmdWwgc2h1\ndGRvd24sCiAgICAgICAgICAgIC8vIGNsb3NlIHdpbGwgZmx1c2ggdGhlIGZp\nbGUgc3lzdGVtIGNhY2hlIG1ha2luZyBhbnkgcHJldmlvdXMKICAgICAgICAg\nICAgLy8gY2FjaGVkIHdyaXRlcyBkdXJhYmxlIHNvIHRoaXMgaXMgZmluZSBh\ncyB3ZWxsLgogICAgICAgICAgICBJT1V0aWxzLmNsb3NlKExPRywgbG9nRmls\nZSk7CiAgICAgICAgfQogICAgICAgIExPRy5pbmZvKCJKb3VybmFsIGV4aXRl\nZCBsb29wISIpOwogICAgfQoKICAgIC8qKgogICAgICogU2h1dHMgZG93biB0\naGUgam91cm5hbC4KICAgICAqLwogICAgcHVibGljIHN5bmNocm9uaXplZCB2\nb2lkIHNodXRkb3duKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlm\nICghcnVubmluZykgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIExPRy5pbmZvKCJTaHV0dGluZyBkb3duIEpv\ndXJuYWwiKTsKICAgICAgICAgICAgZm9yY2VXcml0ZVRocmVhZC5zaHV0ZG93\nbigpOwogICAgICAgICAgICBjYlRocmVhZFBvb2wuc2h1dGRvd24oKTsKICAg\nICAgICAgICAgaWYgKCFjYlRocmVhZFBvb2wuYXdhaXRUZXJtaW5hdGlvbig1\nLCBUaW1lVW5pdC5TRUNPTkRTKSkgewogICAgICAgICAgICAgICAgTE9HLndh\ncm4oIkNvdWxkbid0IHNodXRkb3duIGpvdXJuYWwgY2FsbGJhY2sgdGhyZWFk\nIGdyYWNlZnVsbHkuIEZvcmNpbmciKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjYlRocmVhZFBvb2wuc2h1dGRvd25Ob3coKTsKCiAgICAgICAgICAg\nIHJ1bm5pbmcgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5pbnRlcnJ1cHQo\nKTsKICAgICAgICAgICAgdGhpcy5qb2luKCk7CiAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgTE9HLndh\ncm4oIkludGVycnVwdGVkIGR1cmluZyBzaHV0dGluZyBkb3duIGpvdXJuYWwg\nOiAiLCBpZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIGludCBmdWxsUmVhZChKb3VybmFsQ2hhbm5lbCBmYywgQnl0ZUJ1ZmZlciBi\nYikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpbnQgdG90YWwgPSAw\nOwogICAgICAgIHdoaWxlKGJiLnJlbWFpbmluZygpID4gMCkgewogICAgICAg\nICAgICBpbnQgcmMgPSBmYy5yZWFkKGJiKTsKICAgICAgICAgICAgaWYgKHJj\nIDw9IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiB0b3RhbDsKICAgICAg\nICAgICAgfQogICAgICAgICAgICB0b3RhbCArPSByYzsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRvdGFsOwogICAgfQp9Cg==\n","encoding":"base64"}

