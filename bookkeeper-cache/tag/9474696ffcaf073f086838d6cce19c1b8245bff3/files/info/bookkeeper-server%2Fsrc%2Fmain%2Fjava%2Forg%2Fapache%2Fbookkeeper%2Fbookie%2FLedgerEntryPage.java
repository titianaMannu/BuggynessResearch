{"sha":"2d6f80d7c162c7f47c923065107c61ebebfc342b","node_id":"MDQ6QmxvYjE1NzU5NTY6MmQ2ZjgwZDdjMTYyYzdmNDdjOTIzMDY1MTA3YzYxZWJlYmZjMzQyYg==","size":6553,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2d6f80d7c162c7f47c923065107c61ebebfc342b","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVByb3Rv\nY29sOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuWmVyb0J1\nZmZlcjsKCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS5uaW8uQnl0ZUJ1ZmZlcjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKLyoqCiAqIFRoaXMgaXMgYSBwYWdl\nIGluIHRoZSBMZWRnZXJDYWNoZS4gSXQgaG9sZHMgdGhlIGxvY2F0aW9ucwog\nKiAoZW50cnlsb2dmaWxlLCBvZmZzZXQpIGZvciBlbnRyeSBpZHMuCiAqLwpw\ndWJsaWMgY2xhc3MgTGVkZ2VyRW50cnlQYWdlIHsKICAgIHByaXZhdGUgZmlu\nYWwgc3RhdGljIGludCBpbmRleEVudHJ5U2l6ZSA9IDg7CiAgICBwcml2YXRl\nIGZpbmFsIGludCBwYWdlU2l6ZTsKICAgIHByaXZhdGUgZmluYWwgaW50IGVu\ndHJpZXNQZXJQYWdlOwogICAgdm9sYXRpbGUgcHJpdmF0ZSBFbnRyeUtleSBl\nbnRyeUtleSA9IG5ldyBFbnRyeUtleSgtMSwgQm9va2llUHJvdG9jb2wuSU5W\nQUxJRF9FTlRSWV9JRCk7CiAgICBwcml2YXRlIGZpbmFsIEJ5dGVCdWZmZXIg\ncGFnZTsKICAgIHZvbGF0aWxlIHByaXZhdGUgYm9vbGVhbiBjbGVhbiA9IHRy\ndWU7CiAgICBwcml2YXRlIGZpbmFsIEF0b21pY0ludGVnZXIgdXNlQ291bnQg\nPSBuZXcgQXRvbWljSW50ZWdlcigpOwogICAgcHJpdmF0ZSBmaW5hbCBBdG9t\naWNJbnRlZ2VyIHZlcnNpb24gPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAg\nIHZvbGF0aWxlIHByaXZhdGUgaW50IGxhc3QgPSAtMTsgLy8gTGFzdCB1cGRh\ndGUgcG9zaXRpb24KICAgIHByaXZhdGUgZmluYWwgTEVQU3RhdGVDaGFuZ2VD\nYWxsYmFjayBjYWxsYmFjazsKCiAgICBwdWJsaWMgc3RhdGljIGludCBnZXRJ\nbmRleEVudHJ5U2l6ZSgpIHsKICAgICAgICByZXR1cm4gaW5kZXhFbnRyeVNp\nemU7CiAgICB9CgogICAgcHVibGljIExlZGdlckVudHJ5UGFnZShpbnQgcGFn\nZVNpemUsIGludCBlbnRyaWVzUGVyUGFnZSkgewogICAgICAgIHRoaXMocGFn\nZVNpemUsIGVudHJpZXNQZXJQYWdlLCBudWxsKTsKICAgIH0KCiAgICBwdWJs\naWMgTGVkZ2VyRW50cnlQYWdlKGludCBwYWdlU2l6ZSwgaW50IGVudHJpZXNQ\nZXJQYWdlLCBMRVBTdGF0ZUNoYW5nZUNhbGxiYWNrIGNhbGxiYWNrKSB7CiAg\nICAgICAgdGhpcy5wYWdlU2l6ZSA9IHBhZ2VTaXplOwogICAgICAgIHRoaXMu\nZW50cmllc1BlclBhZ2UgPSBlbnRyaWVzUGVyUGFnZTsKICAgICAgICBwYWdl\nID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZURpcmVjdChwYWdlU2l6ZSk7CiAgICAg\nICAgdGhpcy5jYWxsYmFjayA9IGNhbGxiYWNrOwogICAgICAgIGlmIChudWxs\nICE9IHRoaXMuY2FsbGJhY2spIHsKICAgICAgICAgICAgY2FsbGJhY2sub25S\nZXNldEluVXNlKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgU3Ry\naW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAg\nc2IuYXBwZW5kKGdldExlZGdlcigpKTsKICAgICAgICBzYi5hcHBlbmQoJ0An\nKTsKICAgICAgICBzYi5hcHBlbmQoZ2V0Rmlyc3RFbnRyeSgpKTsKICAgICAg\nICBzYi5hcHBlbmQoY2xlYW4gPyAiIGNsZWFuICIgOiAiIGRpcnR5ICIpOwog\nICAgICAgIHNiLmFwcGVuZCh1c2VDb3VudC5nZXQoKSk7CiAgICAgICAgcmV0\ndXJuIHNiLnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdXNl\nUGFnZSgpIHsKICAgICAgICBpbnQgb2xkVmFsID0gdXNlQ291bnQuZ2V0QW5k\nSW5jcmVtZW50KCk7CiAgICAgICAgaWYgKCgwID09IG9sZFZhbCkgJiYgKG51\nbGwgIT0gY2FsbGJhY2spKSB7CiAgICAgICAgICAgIGNhbGxiYWNrLm9uU2V0\nSW5Vc2UodGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlbGVhc2VQYWdlKCkgewogICAgICAgIGludCBuZXdVc2VDb3VudCA9IHVz\nZUNvdW50LmRlY3JlbWVudEFuZEdldCgpOwogICAgICAgIGlmIChuZXdVc2VD\nb3VudCA8IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0\nZUV4Y2VwdGlvbigiVXNlIGNvdW50IGhhcyBnb25lIGJlbG93IDAiKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKChudWxsICE9IGNhbGxiYWNrKSAmJiAobmV3\nVXNlQ291bnQgPT0gMCkpIHsKICAgICAgICAgICAgY2FsbGJhY2sub25SZXNl\ndEluVXNlKHRoaXMpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgY2hlY2tQYWdlKCkgewogICAgICAgIGlmICh1c2VDb3VudC5nZXQoKSA8\nPSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNl\ncHRpb24oIlBhZ2Ugbm90IG1hcmtlZCBpbiB1c2UiKTsKICAgICAgICB9CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMo\nT2JqZWN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2Yg\nTGVkZ2VyRW50cnlQYWdlKSB7CiAgICAgICAgICAgIExlZGdlckVudHJ5UGFn\nZSBvdGhlckxFUCA9IChMZWRnZXJFbnRyeVBhZ2UpIG90aGVyOwogICAgICAg\nICAgICByZXR1cm4gb3RoZXJMRVAuZ2V0TGVkZ2VyKCkgPT0gZ2V0TGVkZ2Vy\nKCkgJiYgb3RoZXJMRVAuZ2V0Rmlyc3RFbnRyeSgpID09IGdldEZpcnN0RW50\ncnkoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIGludCBoYXNoQ29kZSgpIHsKICAgICAgICByZXR1cm4gKGludClnZXRMZWRn\nZXIoKSBeIChpbnQpKGdldEZpcnN0RW50cnkoKSk7CiAgICB9CgogICAgdm9p\nZCBzZXRDbGVhbihpbnQgdmVyc2lvbk9mQ2xlYW5pbmcpIHsKICAgICAgICB0\naGlzLmNsZWFuID0gKHZlcnNpb25PZkNsZWFuaW5nID09IHZlcnNpb24uZ2V0\nKCkpOwoKICAgICAgICBpZiAoKG51bGwgIT0gY2FsbGJhY2spICYmIGNsZWFu\nKSB7CiAgICAgICAgICAgIGNhbGxiYWNrLm9uU2V0Q2xlYW4odGhpcyk7CiAg\nICAgICAgfQogICAgfQoKICAgIGJvb2xlYW4gaXNDbGVhbigpIHsKICAgICAg\nICByZXR1cm4gY2xlYW47CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0T2Zm\nc2V0KGxvbmcgb2Zmc2V0LCBpbnQgcG9zaXRpb24pIHsKICAgICAgICBjaGVj\na1BhZ2UoKTsKICAgICAgICBwYWdlLnB1dExvbmcocG9zaXRpb24sIG9mZnNl\ndCk7CiAgICAgICAgdmVyc2lvbi5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAg\nICBpZiAobGFzdCA8IHBvc2l0aW9uL2dldEluZGV4RW50cnlTaXplKCkpIHsK\nICAgICAgICAgICAgbGFzdCA9IHBvc2l0aW9uL2dldEluZGV4RW50cnlTaXpl\nKCk7CiAgICAgICAgfQogICAgICAgIHRoaXMuY2xlYW4gPSBmYWxzZTsKCiAg\nICAgICAgaWYgKG51bGwgIT0gY2FsbGJhY2spIHsKICAgICAgICAgICAgY2Fs\nbGJhY2sub25TZXREaXJ0eSh0aGlzKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIGxvbmcgZ2V0T2Zmc2V0KGludCBwb3NpdGlvbikgewogICAgICAg\nIGNoZWNrUGFnZSgpOwogICAgICAgIHJldHVybiBwYWdlLmdldExvbmcocG9z\naXRpb24pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHplcm9QYWdlKCkgewog\nICAgICAgIGNoZWNrUGFnZSgpOwogICAgICAgIHBhZ2UuY2xlYXIoKTsKICAg\nICAgICBaZXJvQnVmZmVyLnB1dChwYWdlKTsKICAgICAgICBsYXN0ID0gLTE7\nCiAgICAgICAgY2xlYW4gPSB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlYWRQYWdlKEZpbGVJbmZvIGZpKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGNoZWNrUGFnZSgpOwogICAgICAgIHBhZ2UuY2xlYXIoKTsKICAg\nICAgICB3aGlsZShwYWdlLnJlbWFpbmluZygpICE9IDApIHsKICAgICAgICAg\nICAgaWYgKGZpLnJlYWQocGFnZSwgZ2V0Rmlyc3RFbnRyeVBvc2l0aW9uKCkp\nIDw9IDApIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbigiU2hvcnQgcGFnZSByZWFkIG9mIGxlZGdlciAiICsgZ2V0TGVkZ2VyKCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgdHJpZWQgdG8g\nZ2V0ICIgKyBwYWdlLmNhcGFjaXR5KCkgKyAiIGZyb20gcG9zaXRpb24gIiAr\nIGdldEZpcnN0RW50cnlQb3NpdGlvbigpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyAiIHN0aWxsIG5lZWQgIiArIHBhZ2UucmVtYWluaW5n\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxhc3QgPSBn\nZXRMYXN0RW50cnlJbmRleCgpOwogICAgICAgIGNsZWFuID0gdHJ1ZTsKICAg\nIH0KCiAgICBwdWJsaWMgQnl0ZUJ1ZmZlciBnZXRQYWdlVG9Xcml0ZSgpIHsK\nICAgICAgICBjaGVja1BhZ2UoKTsKICAgICAgICBwYWdlLmNsZWFyKCk7CiAg\nICAgICAgcmV0dXJuIHBhZ2U7CiAgICB9CgogICAgbG9uZyBnZXRMZWRnZXIo\nKSB7CiAgICAgICAgcmV0dXJuIGVudHJ5S2V5LmdldExlZGdlcklkKCk7CiAg\nICB9CgogICAgaW50IGdldFZlcnNpb24oKSB7CiAgICAgICAgcmV0dXJuIHZl\ncnNpb24uZ2V0KCk7CiAgICB9CgogICAgcHVibGljIEVudHJ5S2V5IGdldEVu\ndHJ5S2V5KCkgewogICAgICAgIHJldHVybiBlbnRyeUtleTsKICAgIH0KCiAg\nICB2b2lkIHNldExlZGdlckFuZEZpcnN0RW50cnkobG9uZyBsZWRnZXJJZCwg\nbG9uZyBmaXJzdEVudHJ5KSB7CiAgICAgICAgaWYgKGZpcnN0RW50cnkgJSBl\nbnRyaWVzUGVyUGFnZSAhPSAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oZmlyc3RFbnRyeSArICIgaXMgbm90\nIGEgbXVsdGlwbGUgb2YgIiArIGVudHJpZXNQZXJQYWdlKTsKICAgICAgICB9\nCiAgICAgICAgdGhpcy5lbnRyeUtleSA9IG5ldyBFbnRyeUtleShsZWRnZXJJ\nZCwgZmlyc3RFbnRyeSk7CiAgICB9CiAgICBsb25nIGdldEZpcnN0RW50cnko\nKSB7CiAgICAgICAgcmV0dXJuIGVudHJ5S2V5LmdldEVudHJ5SWQoKTsKICAg\nIH0KCiAgICBsb25nIGdldE1heFBvc3NpYmxlRW50cnkoKSB7CiAgICAgICAg\ncmV0dXJuIGVudHJ5S2V5LmdldEVudHJ5SWQoKSArIGVudHJpZXNQZXJQYWdl\nOwogICAgfQoKICAgIGxvbmcgZ2V0Rmlyc3RFbnRyeVBvc2l0aW9uKCkgewog\nICAgICAgIHJldHVybiBlbnRyeUtleS5nZXRFbnRyeUlkKCkgKiBpbmRleEVu\ndHJ5U2l6ZTsKICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpblVzZSgpIHsK\nICAgICAgICByZXR1cm4gdXNlQ291bnQuZ2V0KCkgPiAwOwogICAgfQoKICAg\nIHByaXZhdGUgaW50IGdldExhc3RFbnRyeUluZGV4KCkgewogICAgICAgIGZv\ncihpbnQgaSA9IGVudHJpZXNQZXJQYWdlIC0gMTsgaSA+PSAwOyBpLS0pIHsK\nICAgICAgICAgICAgaWYgKGdldE9mZnNldChpKmdldEluZGV4RW50cnlTaXpl\nKCkpID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIC0xOwogICAgfQoKICAg\nIHB1YmxpYyBsb25nIGdldExhc3RFbnRyeSgpIHsKICAgICAgICBpZiAobGFz\ndCA+PSAwKSB7CiAgICAgICAgICAgIHJldHVybiBsYXN0ICsgZW50cnlLZXku\nZ2V0RW50cnlJZCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlu\ndCBpbmRleCA9IGdldExhc3RFbnRyeUluZGV4KCk7CiAgICAgICAgICAgIHJl\ndHVybiBpbmRleCA+PSAwID8gKGluZGV4ICsgZW50cnlLZXkuZ2V0RW50cnlJ\nZCgpKSA6IDA7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

