{"sha":"c3ec897f9bb7840a4f57235c737bb88b44339ab9","node_id":"MDQ6QmxvYjE1NzU5NTY6YzNlYzg5N2Y5YmI3ODQwYTRmNTcyMzVjNzM3YmI4OGI0NDMzOWFiOQ==","size":7861,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c3ec897f9bb7840a4f57235c737bb88b44339ab9","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0ludGVn\nZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWlj\nUmVmZXJlbmNlOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb247CgovKioKICogU2tpcExpc3QgYWxsb2Nh\ndGlvbiBidWZmZXIgdG8gcmVkdWNlIG1lbW9yeSBmcmFnbWVudC4KICogQWRh\ncHRlZCBmcm9tIEhCYXNlIHByb2plY3QuCiAqIDxwPgogKiBUaGUgU2tpcExp\nc3RBcmVuYSBpcyBiYXNpY2FsbHkgYSBidW1wLXRoZS1wb2ludGVyIGFsbG9j\nYXRvciB0aGF0IGFsbG9jYXRlcwogKiBiaWcgKGRlZmF1bHQgMk1CKSBieXRl\nW10gY2h1bmtzIGZyb20gYW5kIHRoZW4gaGFuZGxlcyBpdCBvdXQgdG8gdGhy\nZWFkcyB0aGF0CiAqIHJlcXVlc3Qgc2xpY2VzIGludG8gdGhlIGFycmF5Lgog\nKiA8cD4KICogVGhlIHB1cnBvc2Ugb2YgdGhpcyBjbGFzcyBpcyB0byBjb21i\nYXQgaGVhcCBmcmFnbWVudGF0aW9uIGluIHRoZQogKiBib29raWUuIEJ5IGVu\nc3VyaW5nIHRoYXQgYWxsIEtleVZhbHVlcyBpbiBhIGdpdmVuIFNraXBMaXN0\nIHJlZmVyCiAqIG9ubHkgdG8gbGFyZ2UgY2h1bmtzIG9mIGNvbnRpZ3VvdXMg\nbWVtb3J5LCB3ZSBlbnN1cmUgdGhhdCBsYXJnZSBibG9ja3MKICogZ2V0IGZy\nZWVkIHVwIHdoZW4gdGhlIFNraXBMaXN0IGlzIGZsdXNoZWQuCiAqIDxwPgog\nKiBXaXRob3V0IHRoZSBBcmVuYSwgdGhlIGJ5dGUgYXJyYXkgYWxsb2NhdGVk\nIGR1cmluZyBpbnNlcnRpb24gZW5kIHVwCiAqIGludGVybGVhdmVkIHRocm91\nZ2hvdXQgdGhlIGhlYXAsIGFuZCB0aGUgb2xkIGdlbmVyYXRpb24gZ2V0cyBw\ncm9ncmVzc2l2ZWx5CiAqIG1vcmUgZnJhZ21lbnRlZCB1bnRpbCBhIHN0b3At\ndGhlLXdvcmxkIGNvbXBhY3RpbmcgY29sbGVjdGlvbiBvY2N1cnMuCiAqIDxw\nPgogKi8KcHVibGljIGNsYXNzIFNraXBMaXN0QXJlbmEgewogICAgcHJpdmF0\nZSBBdG9taWNSZWZlcmVuY2U8Q2h1bms+IGN1ckNodW5rID0gbmV3IEF0b21p\nY1JlZmVyZW5jZTxDaHVuaz4oKTsKCiAgICBmaW5hbCBpbnQgY2h1bmtTaXpl\nOwoKICAgIGZpbmFsIGludCBtYXhBbGxvYzsKCiAgICBwdWJsaWMgU2tpcExp\nc3RBcmVuYShTZXJ2ZXJDb25maWd1cmF0aW9uIGNmZykgewogICAgICAgIGNo\ndW5rU2l6ZSA9IGNmZy5nZXRTa2lwTGlzdEFyZW5hQ2h1bmtTaXplKCk7CiAg\nICAgICAgbWF4QWxsb2MgPSBjZmcuZ2V0U2tpcExpc3RBcmVuYU1heEFsbG9j\nU2l6ZSgpOwogICAgICAgIGFzc2VydCBtYXhBbGxvYyA8PSBjaHVua1NpemU7\nCiAgICB9CgogICAgLyoqCiAgICAqIEFsbG9jYXRlIGEgc2xpY2Ugb2YgdGhl\nIGdpdmVuIGxlbmd0aC4KICAgICoKICAgICogSWYgdGhlIHNpemUgaXMgbGFy\nZ2VyIHRoYW4gdGhlIG1heGltdW0gc2l6ZSBzcGVjaWZpZWQgZm9yIHRoaXMK\nICAgICogYWxsb2NhdG9yLCByZXR1cm5zIG51bGwuCiAgICAqLwogICAgcHVi\nbGljIE1lbW9yeVNsaWNlIGFsbG9jYXRlQnl0ZXMoaW50IHNpemUpIHsKICAg\nICAgICBhc3NlcnQgc2l6ZSA+PSAwOwoKICAgICAgICAvLyBDYWxsZXJzIHNo\nb3VsZCBzYXRpc2Z5IGxhcmdlIGFsbG9jYXRpb25zIGRpcmVjdGx5IGZyb20g\nSlZNIHNpbmNlIHRoZXkKICAgICAgICAvLyBkb24ndCBjYXVzZSBmcmFnbWVu\ndGF0aW9uIGFzIGJhZGx5LgogICAgICAgIGlmIChzaXplID4gbWF4QWxsb2Mp\nIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQoKICAgICAg\nICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBDaHVuayBjID0gZ2V0Q3Vy\ncmVudENodW5rKCk7CgogICAgICAgICAgICAvLyBUcnkgdG8gYWxsb2NhdGUg\nZnJvbSB0aGlzIGNodW5rCiAgICAgICAgICAgIGludCBhbGxvY09mZnNldCA9\nIGMuYWxsb2Moc2l6ZSk7CiAgICAgICAgICAgIGlmIChhbGxvY09mZnNldCAh\nPSAtMSkgewogICAgICAgICAgICAgICAgLy8gV2Ugc3VjY2VlZGVkIC0gdGhp\ncyBpcyB0aGUgY29tbW9uIGNhc2UgLSBzbWFsbCBhbGxvYwogICAgICAgICAg\nICAgICAgLy8gZnJvbSBhIGJpZyBidWZmZXIKICAgICAgICAgICAgICAgIHJl\ndHVybiBuZXcgTWVtb3J5U2xpY2UoYy5kYXRhLCBhbGxvY09mZnNldCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdCBlbm91Z2ggc3BhY2Uh\nCiAgICAgICAgICAgIC8vIHRyeSB0byByZXRpcmUgdGhpcyBjaHVuawogICAg\nICAgICAgICByZXRpcmVDdXJyZW50Q2h1bmsoYyk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgKiBUcnkgdG8gcmV0aXJlIHRoZSBjdXJyZW50IGNo\ndW5rIGlmIGl0IGlzIHN0aWxsIHRoZXJlLgogICAgKi8KICAgIHByaXZhdGUg\ndm9pZCByZXRpcmVDdXJyZW50Q2h1bmsoQ2h1bmsgYykgewogICAgICAgIGN1\nckNodW5rLmNvbXBhcmVBbmRTZXQoYywgbnVsbCk7CiAgICAgICAgLy8gSWYg\ndGhlIENBUyBmYWlscywgdGhhdCBtZWFucyB0aGF0IHNvbWVvbmUgZWxzZSBh\nbHJlYWR5CiAgICAgICAgLy8gcmV0aXJlZCB0aGUgY2h1bmsgZm9yIHVzLgog\nICAgfQoKICAgIC8qKgogICAgKiBHZXQgdGhlIGN1cnJlbnQgY2h1bmssIG9y\nLCBpZiB0aGVyZSBpcyBubyBjdXJyZW50IGNodW5rLAogICAgKiBhbGxvY2F0\nZSBhIG5ldyBvbmUgZnJvbSB0aGUgSlZNLgogICAgKi8KICAgIHByaXZhdGUg\nQ2h1bmsgZ2V0Q3VycmVudENodW5rKCkgewogICAgICAgIHdoaWxlICh0cnVl\nKSB7CiAgICAgICAgICAgIC8vIFRyeSB0byBnZXQgdGhlIGNodW5rCiAgICAg\nICAgICAgIENodW5rIGMgPSBjdXJDaHVuay5nZXQoKTsKICAgICAgICAgICAg\naWYgKGMgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGM7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIE5vIGN1cnJlbnQgY2h1bmss\nIHNvIHdlIHdhbnQgdG8gYWxsb2NhdGUgb25lLiBXZSByYWNlCiAgICAgICAg\nICAgIC8vIGFnYWluc3Qgb3RoZXIgYWxsb2NhdG9ycyB0byBDQVMgaW4gYW4g\ndW5pbml0aWFsaXplZCBjaHVuawogICAgICAgICAgICAvLyAod2hpY2ggaXMg\nY2hlYXAgdG8gYWxsb2NhdGUpCiAgICAgICAgICAgIGMgPSBuZXcgQ2h1bmso\nY2h1bmtTaXplKTsKICAgICAgICAgICAgaWYgKGN1ckNodW5rLmNvbXBhcmVB\nbmRTZXQobnVsbCwgYykpIHsKICAgICAgICAgICAgICAgIGMuaW5pdCgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIGM7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgLy8gbG9zdCByYWNlCiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgKiBBIGNodW5rIG9mIG1lbW9yeSBvdXQgb2Ygd2hpY2ggYWxsb2NhdGlv\nbnMgYXJlIHNsaWNlZC4KICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFz\ncyBDaHVuayB7CiAgICAgICAgLyoqIEFjdHVhbCB1bmRlcmx5aW5nIGRhdGEg\nKi8KICAgICAgICBwcml2YXRlIGJ5dGVbXSBkYXRhOwoKICAgICAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgVU5JTklUSUFMSVpFRCA9IC0xOwogICAg\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBPT00gPSAtMjsKICAgICAg\nICAvKioKICAgICAgICAgKiBPZmZzZXQgZm9yIHRoZSBuZXh0IGFsbG9jYXRp\nb24sIG9yIHRoZSBzZW50aW5lbCB2YWx1ZSAtMQogICAgICAgICAqIHdoaWNo\nIGltcGxpZXMgdGhhdCB0aGUgY2h1bmsgaXMgc3RpbGwgdW5pbml0aWFsaXpl\nZC4KICAgICAgICAgKiAqLwogICAgICAgIHByaXZhdGUgQXRvbWljSW50ZWdl\nciBuZXh0RnJlZU9mZnNldCA9IG5ldyBBdG9taWNJbnRlZ2VyKFVOSU5JVElB\nTElaRUQpOwoKICAgICAgICAvKiogVG90YWwgbnVtYmVyIG9mIGFsbG9jYXRp\nb25zIHNhdGlzZmllZCBmcm9tIHRoaXMgYnVmZmVyICovCiAgICAgICAgcHJp\ndmF0ZSBBdG9taWNJbnRlZ2VyIGFsbG9jQ291bnQgPSBuZXcgQXRvbWljSW50\nZWdlcigpOwoKICAgICAgICAvKiogU2l6ZSBvZiBjaHVuayBpbiBieXRlcyAq\nLwogICAgICAgIHByaXZhdGUgZmluYWwgaW50IHNpemU7CgogICAgICAgIC8q\nKgogICAgICAgICAqIENyZWF0ZSBhbiB1bmluaXRpYWxpemVkIGNodW5rLiBO\nb3RlIHRoYXQgbWVtb3J5IGlzIG5vdCBhbGxvY2F0ZWQgeWV0LCBzbwogICAg\nICAgICAqIHRoaXMgaXMgY2hlYXAuCiAgICAgICAgICogQHBhcmFtIHNpemUg\naW4gYnl0ZXMKICAgICAgICAgKi8KICAgICAgICBwcml2YXRlIENodW5rKGlu\ndCBzaXplKSB7CiAgICAgICAgICAgIHRoaXMuc2l6ZSA9IHNpemU7CiAgICAg\nICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBBY3R1YWxseSBjbGFpbSB0\naGUgbWVtb3J5IGZvciB0aGlzIGNodW5rLiBUaGlzIHNob3VsZCBvbmx5IGJl\nIGNhbGxlZCBmcm9tCiAgICAgICAgICogdGhlIHRocmVhZCB0aGF0IGNvbnN0\ncnVjdGVkIHRoZSBjaHVuay4gSXQgaXMgdGhyZWFkLXNhZmUgYWdhaW5zdCBv\ndGhlcgogICAgICAgICAqIHRocmVhZHMgY2FsbGluZyBhbGxvYygpLCB3aG8g\nd2lsbCBibG9jayB1bnRpbCB0aGUgYWxsb2NhdGlvbiBpcyBjb21wbGV0ZS4K\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgdm9pZCBpbml0KCkgewogICAg\nICAgICAgICBhc3NlcnQgbmV4dEZyZWVPZmZzZXQuZ2V0KCkgPT0gVU5JTklU\nSUFMSVpFRDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGRh\ndGEgPSBuZXcgYnl0ZVtzaXplXTsKICAgICAgICAgICAgfSBjYXRjaCAoT3V0\nT2ZNZW1vcnlFcnJvciBlKSB7CiAgICAgICAgICAgICAgICBib29sZWFuIGZh\naWxJbml0ID0gbmV4dEZyZWVPZmZzZXQuY29tcGFyZUFuZFNldChVTklOSVRJ\nQUxJWkVELCBPT00pOwogICAgICAgICAgICAgICAgYXNzZXJ0IGZhaWxJbml0\nOyAvLyBzaG91bGQgYmUgdHJ1ZS4KICAgICAgICAgICAgICAgIHRocm93IGU7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gTWFyayB0aGF0IGl0J3Mg\ncmVhZHkgZm9yIHVzZQogICAgICAgICAgICBib29sZWFuIG9rSW5pdCA9IG5l\neHRGcmVlT2Zmc2V0LmNvbXBhcmVBbmRTZXQoVU5JTklUSUFMSVpFRCwgMCk7\nCiAgICAgICAgICAgIGFzc2VydCBva0luaXQ7ICAgIC8vIHNpbmdsZS10aHJl\nYWRlZCBjYWxsCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBU\ncnkgdG8gYWxsb2NhdGUgPGNvZGU+c2l6ZTwvY29kZT4gYnl0ZXMgZnJvbSB0\naGUgY2h1bmsuCiAgICAgICAgICogQHJldHVybiB0aGUgb2Zmc2V0IG9mIHRo\nZSBzdWNjZXNzZnVsIGFsbG9jYXRpb24sIG9yIC0xIHRvIGluZGljYXRlIG5v\ndC1lbm91Z2gtc3BhY2UKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgaW50\nIGFsbG9jKGludCBzaXplKSB7CiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7\nCiAgICAgICAgICAgICAgICBpbnQgb2xkT2Zmc2V0ID0gbmV4dEZyZWVPZmZz\nZXQuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAob2xkT2Zmc2V0ID09IFVO\nSU5JVElBTElaRUQpIHsKICAgICAgICAgICAgICAgICAgICAvLyBPdGhlciB0\naHJlYWQgYWxsb2NhdGluZyBpdCByaWdodCBub3cKICAgICAgICAgICAgICAg\nICAgICBUaHJlYWQueWllbGQoKTsKICAgICAgICAgICAgICAgICAgICBjb250\naW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChv\nbGRPZmZzZXQgPT0gT09NKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIC0xOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChv\nbGRPZmZzZXQgKyBzaXplID4gZGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gLTE7IC8vIGFsbG9jIGRvZXNuJ3QgZml0CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gVHJ5IHRvIGF0b21p\nY2FsbHkgY2xhaW0gdGhpcyBjaHVuawogICAgICAgICAgICAgICAgaWYgKG5l\neHRGcmVlT2Zmc2V0LmNvbXBhcmVBbmRTZXQob2xkT2Zmc2V0LCBvbGRPZmZz\nZXQgKyBzaXplKSkgewogICAgICAgICAgICAgICAgICAgIC8vIHdlIGdvdCB0\naGUgYWxsb2MKICAgICAgICAgICAgICAgICAgICBhbGxvY0NvdW50LmluY3Jl\nbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBvbGRP\nZmZzZXQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBs\nb3N0IHJhY2UKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgcmV0dXJuICJDaHVua0AiICsgU3lzdGVtLmlkZW50aXR5SGFz\naENvZGUodGhpcykgKwogICAgICAgICAgICAgICAgIjogdXNlZCgiICsgYWxs\nb2NDb3VudC5nZXQoKSArICIpLCBmcmVlKCIgKwogICAgICAgICAgICAgICAg\nKGRhdGEubGVuZ3RoIC0gbmV4dEZyZWVPZmZzZXQuZ2V0KCkgKyAiKSIpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogVGhlIHJlc3VsdCBvZiBh\nIHNpbmdsZSBhbGxvY2F0aW9uLiBDb250YWlucyB0aGUgY2h1bmsgdGhhdCB0\naGUKICAgICogYWxsb2NhdGlvbiBwb2ludHMgaW50bywgYW5kIHRoZSBvZmZz\nZXQgaW4gdGhpcyBhcnJheSB3aGVyZSB0aGUKICAgICogc2xpY2UgYmVnaW5z\nLgogICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTWVtb3J5U2xpY2Ug\newogICAgICAgIHByaXZhdGUgZmluYWwgYnl0ZVtdIGRhdGE7CiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBpbnQgb2Zmc2V0OwoKICAgICAgICBwcml2YXRlIE1l\nbW9yeVNsaWNlKGJ5dGVbXSBkYXRhLCBpbnQgb2ZmKSB7CiAgICAgICAgICAg\nIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgIHRoaXMub2Zmc2V0ID0g\nb2ZmOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuICJT\nbGljZToiICsgImNhcGFjaXR5KCIgKyBkYXRhLmxlbmd0aCArICIpLCBvZmZz\nZXQoIiArIG9mZnNldCArICIpIjsKICAgICAgICB9CgogICAgICAgIGJ5dGVb\nXSBnZXREYXRhKCkgewogICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAg\nICB9CgogICAgICAgIGludCBnZXRPZmZzZXQoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBvZmZzZXQ7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

