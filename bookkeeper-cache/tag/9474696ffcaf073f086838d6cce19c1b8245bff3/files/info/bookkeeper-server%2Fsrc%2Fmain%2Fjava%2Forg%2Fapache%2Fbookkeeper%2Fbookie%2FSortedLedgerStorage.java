{"sha":"0a3884c2636fed66618af2ab9a8c3bf87abf8bbc","node_id":"MDQ6QmxvYjE1NzU5NTY6MGEzODg0YzI2MzZmZWQ2NjYxOGFmMmFiOWE4YzNiZjg3YWJmOGJiYw==","size":7484,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0a3884c2636fed66618af2ab9a8c3bf87abf8bbc","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZTsKCmlt\ncG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0\nZUJ1ZmZlcjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9y\nczsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxlZEV4ZWN1\ndG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVV\nbml0OwoKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVu\ndC5UaHJlYWRGYWN0b3J5QnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5ib29raWUuQ2hlY2twb2ludFNvdXJjZS5DaGVja3BvaW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxl\nZGdlck1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uQm9va2llUHJvdG9jb2w7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuc3RhdHMuU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2Vy\nOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgpwdWJsaWMgY2xh\nc3MgU29ydGVkTGVkZ2VyU3RvcmFnZSBleHRlbmRzIEludGVybGVhdmVkTGVk\nZ2VyU3RvcmFnZQogICAgICAgIGltcGxlbWVudHMgTGVkZ2VyU3RvcmFnZSwg\nQ2FjaGVDYWxsYmFjaywgU2tpcExpc3RGbHVzaGVyIHsKICAgIHByaXZhdGUg\nZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihTb3J0ZWRMZWRnZXJTdG9yYWdlLmNsYXNzKTsKCiAgICBwcml2YXRl\nIGZpbmFsIEVudHJ5TWVtVGFibGUgbWVtVGFibGU7CiAgICBwcml2YXRlIGZp\nbmFsIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXI7CgogICAg\ncHVibGljIFNvcnRlZExlZGdlclN0b3JhZ2UoU2VydmVyQ29uZmlndXJhdGlv\nbiBjb25mLCBMZWRnZXJNYW5hZ2VyIGxlZGdlck1hbmFnZXIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJEaXJzTWFuYWdlciBsZWRn\nZXJEaXJzTWFuYWdlciwgTGVkZ2VyRGlyc01hbmFnZXIgaW5kZXhEaXJzTWFu\nYWdlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIENo\nZWNrcG9pbnRTb3VyY2UgY2hlY2twb2ludFNvdXJjZSwgU3RhdHNMb2dnZXIg\nc3RhdHNMb2dnZXIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIoY29u\nZiwgbGVkZ2VyTWFuYWdlciwgbGVkZ2VyRGlyc01hbmFnZXIsIGluZGV4RGly\nc01hbmFnZXIsIG51bGwsIHN0YXRzTG9nZ2VyKTsKICAgICAgICB0aGlzLm1l\nbVRhYmxlID0gbmV3IEVudHJ5TWVtVGFibGUoY29uZiwgY2hlY2twb2ludFNv\ndXJjZSwgc3RhdHNMb2dnZXIpOwogICAgICAgIHRoaXMuc2NoZWR1bGVyID0g\nRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZFNjaGVkdWxlZEV4ZWN1dG9yKAog\nICAgICAgICAgICAgICAgbmV3IFRocmVhZEZhY3RvcnlCdWlsZGVyKCkKICAg\nICAgICAgICAgICAgIC5zZXROYW1lRm9ybWF0KCJTb3J0ZWRMZWRnZXJTdG9y\nYWdlLSVkIikKICAgICAgICAgICAgICAgIC5zZXRQcmlvcml0eSgoVGhyZWFk\nLk5PUk1fUFJJT1JJVFkgKyBUaHJlYWQuTUFYX1BSSU9SSVRZKS8yKS5idWls\nZCgpKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHN0\nYXJ0KCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZsdXNoKCk7CiAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIkV4Y2VwdGlvbiB0aHJvd24gd2hpbGUgZmx1c2hpbmcgbGVk\nZ2VyIGNhY2hlLiIsIGUpOwogICAgICAgIH0KICAgICAgICBzdXBlci5zdGFy\ndCgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2h1\ndGRvd24oKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAg\nIC8vIFdhaXQgZm9yIGFueSBqb2JzIGN1cnJlbnRseSBzY2hlZHVsZWQgdG8g\nYmUgY29tcGxldGVkIGFuZCB0aGVuIHNodXQgZG93bi4KICAgICAgICBzY2hl\nZHVsZXIuc2h1dGRvd24oKTsKICAgICAgICBpZiAoIXNjaGVkdWxlci5hd2Fp\ndFRlcm1pbmF0aW9uKDMsIFRpbWVVbml0LlNFQ09ORFMpKSB7CiAgICAgICAg\nICAgIHNjaGVkdWxlci5zaHV0ZG93bk5vdygpOwogICAgICAgIH0KICAgICAg\nICBzdXBlci5zaHV0ZG93bigpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIGJvb2xlYW4gbGVkZ2VyRXhpc3RzKGxvbmcgbGVkZ2VySWQpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgLy8gRG9uZSB0aGlzIHdheSBi\nZWNhdXNlIGNoZWNraW5nIHRoZSBza2lwIGxpc3QgaXMgYW4gTyhsb2dOKSBv\ncGVyYXRpb24gY29tcGFyZWQgdG8KICAgICAgICAvLyB0aGUgTygxKSBmb3Ig\ndGhlIGxlZGdlckNhY2hlLgogICAgICAgIGlmICghc3VwZXIubGVkZ2VyRXhp\nc3RzKGxlZGdlcklkKSkgewogICAgICAgICAgICBFbnRyeUtleVZhbHVlIGt2\nID0gbWVtVGFibGUuZ2V0TGFzdEVudHJ5KGxlZGdlcklkKTsKICAgICAgICAg\nICAgaWYgKG51bGwgPT0ga3YpIHsKICAgICAgICAgICAgICAgIHJldHVybiBz\ndXBlci5sZWRnZXJFeGlzdHMobGVkZ2VySWQpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIGxvbmcgYWRkRW50cnkoQnl0ZUJ1ZmZlciBlbnRy\neSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGxlZGdlcklk\nID0gZW50cnkuZ2V0TG9uZygpOwogICAgICAgIGxvbmcgZW50cnlJZCA9IGVu\ndHJ5LmdldExvbmcoKTsKICAgICAgICBlbnRyeS5yZXdpbmQoKTsKICAgICAg\nICBtZW1UYWJsZS5hZGRFbnRyeShsZWRnZXJJZCwgZW50cnlJZCwgZW50cnks\nIHRoaXMpOwogICAgICAgIHJldHVybiBlbnRyeUlkOwogICAgfQoKICAgIC8q\nKgogICAgICogR2V0IHRoZSBsYXN0IGVudHJ5IGlkIGZvciBhIHBhcnRpY3Vs\nYXIgbGVkZ2VyLgogICAgICogQHBhcmFtIGxlZGdlcklkCiAgICAgKiBAcmV0\ndXJuCiAgICAgKi8KICAgIHByaXZhdGUgQnl0ZUJ1ZmZlciBnZXRMYXN0RW50\ncnlJZChsb25nIGxlZGdlcklkKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIEVudHJ5S2V5VmFsdWUga3YgPSBtZW1UYWJsZS5nZXRMYXN0RW50cnko\nbGVkZ2VySWQpOwogICAgICAgIGlmIChudWxsICE9IGt2KSB7CiAgICAgICAg\nICAgIHJldHVybiBrdi5nZXRWYWx1ZUFzQnl0ZUJ1ZmZlcigpOwogICAgICAg\nIH0KICAgICAgICAvLyBJZiBpdCBkb2Vzbid0IGV4aXN0IGluIHRoZSBza2lw\nIGxpc3QsIHRoZW4gZmFsbGJhY2sgdG8gdGhlIGxlZGdlciBjYWNoZStpbmRl\neC4KICAgICAgICByZXR1cm4gc3VwZXIuZ2V0RW50cnkobGVkZ2VySWQsIEJv\nb2tpZVByb3RvY29sLkxBU1RfQUREX0NPTkZJUk1FRCk7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgQnl0ZUJ1ZmZlciBnZXRFbnRyeShsb25n\nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgaWYgKGVudHJ5SWQgPT0gQm9va2llUHJvdG9jb2wuTEFTVF9B\nRERfQ09ORklSTUVEKSB7CiAgICAgICAgICAgIHJldHVybiBnZXRMYXN0RW50\ncnlJZChsZWRnZXJJZCk7CiAgICAgICAgfQogICAgICAgIEJ5dGVCdWZmZXIg\nYnVmZlRvUmV0OwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJ1ZmZUb1Jl\ndCA9IHN1cGVyLmdldEVudHJ5KGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAg\nICB9IGNhdGNoIChCb29raWUuTm9FbnRyeUV4Y2VwdGlvbiBuZWUpIHsKICAg\nICAgICAgICAgRW50cnlLZXlWYWx1ZSBrdiA9IG1lbVRhYmxlLmdldEVudHJ5\nKGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAgICAgICAgaWYgKG51bGwgPT0g\na3YpIHsKICAgICAgICAgICAgICAgIC8vIFRoZSBlbnRyeSBtaWdodCBoYXZl\nIGJlZW4gZmx1c2hlZCBzaW5jZSB3ZSBsYXN0IGNoZWNrZWQsIHNvIHF1ZXJ5\nIHRoZSBsZWRnZXIgY2FjaGUgYWdhaW4uCiAgICAgICAgICAgICAgICAvLyBJ\nZiB0aGUgZW50cnkgdHJ1bHkgZG9lc24ndCBleGlzdCwgdGhlbiB0aGlzIHdp\nbGwgdGhyb3cgYSBOb0VudHJ5RXhjZXB0aW9uCiAgICAgICAgICAgICAgICBi\ndWZmVG9SZXQgPSBzdXBlci5nZXRFbnRyeShsZWRnZXJJZCwgZW50cnlJZCk7\nCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBidWZmVG9S\nZXQgPSBrdi5nZXRWYWx1ZUFzQnl0ZUJ1ZmZlcigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIC8vIGJ1ZmZUb1JldCB3aWxsIG5vdCBiZSBu\ndWxsIHdoZW4gd2UgcmVhY2ggaGVyZS4KICAgICAgICByZXR1cm4gYnVmZlRv\nUmV0OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENoZWNrcG9p\nbnQgY2hlY2twb2ludChmaW5hbCBDaGVja3BvaW50IGNoZWNrcG9pbnQpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgQ2hlY2twb2ludCBsYXN0Q2hl\nY2twb2ludCA9IGNoZWNrcG9pbnRIb2xkZXIuZ2V0TGFzdENoZWNrcG9pbnQo\nKTsKICAgICAgICAvLyBpZiBjaGVja3BvaW50IGlzIGxlc3MgdGhhbiBsYXN0\nIGNoZWNrcG9pbnQsIHdlIGRvbid0IG5lZWQgdG8gZG8gY2hlY2twb2ludCBh\nZ2Fpbi4KICAgICAgICBpZiAobGFzdENoZWNrcG9pbnQuY29tcGFyZVRvKGNo\nZWNrcG9pbnQpID4gMCkgewogICAgICAgICAgICByZXR1cm4gbGFzdENoZWNr\ncG9pbnQ7CiAgICAgICAgfQogICAgICAgIG1lbVRhYmxlLmZsdXNoKHRoaXMs\nIGNoZWNrcG9pbnQpOwogICAgICAgIHJldHVybiBzdXBlci5jaGVja3BvaW50\nKGNoZWNrcG9pbnQpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgcHJvY2Vzcyhsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgYnVmZmVyKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIHByb2Nlc3NFbnRyeShsZWRnZXJJ\nZCwgZW50cnlJZCwgYnVmZmVyLCBmYWxzZSk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBmbHVzaCgpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgbWVtVGFibGUuZmx1c2godGhpcywgQ2hlY2twb2ludC5N\nQVgpOwogICAgICAgIHN1cGVyLmZsdXNoKCk7CiAgICB9CgogICAgLy8gQ2Fj\naGVDYWxsYmFjayBmdW5jdGlvbnMuCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIG9uU2l6ZUxpbWl0UmVhY2hlZCgpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gd2hlbiBzaXplIGxpbWl0IHJlYWNoZWQsIHdlIGdl\ndCB0aGUgcHJldmlvdXMgY2hlY2twb2ludCBmcm9tIHNuYXBzaG90IG1lbS10\nYWJsZS4KICAgICAgICAvLyBhdCB0aGlzIHBvaW50LCB3ZSBhcmUgc2FmZXIg\ndG8gc2NoZWR1bGUgYSBjaGVja3BvaW50LCBzaW5jZSB0aGUgZW50cmllcyBh\nZGRlZCBiZWZvcmUKICAgICAgICAvLyB0aGlzIGNoZWNrcG9pbnQgYWxyZWFk\neSB3cml0dGVuIHRvIGVudHJ5IGxvZ2dlci4KICAgICAgICAvLyBidXQgaXQg\nd291bGQgYmUgYmV0dGVyIG5vdCB0byBsZXQgbWVtLXRhYmxlIGZsdXNoIHRv\nIGRpZmZlcmVudCBlbnRyeSBsb2cgZmlsZXMsCiAgICAgICAgLy8gc28gd2Ug\ncm9sbCBlbnRyeSBsb2cgZmlsZXMgaW4gU29ydGVkTGVkZ2VyU3RvcmFnZSBp\ndHNlbGYuCiAgICAgICAgLy8gQWZ0ZXIgdGhhdCwgd2UgY291bGQgbWFrZSB0\naGUgcHJvY2VzcyB3cml0aW5nIGRhdGEgdG8gZW50cnkgbG9nZ2VyIGZpbGUg\nbm90IGJvdW5kIHdpdGggY2hlY2twb2ludC4KICAgICAgICAvLyBvdGhlcndp\nc2UsIGl0IGh1cnRzIGFkZCBwZXJmb3JtYW5jZS4KICAgICAgICBzY2hlZHVs\nZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlN0\nYXJ0ZWQgZmx1c2hpbmcgbWVtIHRhYmxlLiIpOwogICAgICAgICAgICAgICAg\nICAgIG1lbVRhYmxlLmZsdXNoKFNvcnRlZExlZGdlclN0b3JhZ2UudGhpcyk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5TG9nZ2VyLnJlYWNoRW50\ncnlMb2dMaW1pdCgwKSkgewogICAgICAgICAgICAgICAgICAgICAgICBlbnRy\neUxvZ2dlci5yb2xsTG9nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5pbmZvKCJSb2xsaW5nIGVudHJ5IGxvZ2dlciBzaW5jZSBpdCByZWFjaGVk\nIHNpemUgbGltaXRhdGlvbiIpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgICAgICAvLyBUT0RPOiBpZiB3ZSBmYWlsZWQgdG8gZmx1c2gg\nZGF0YSwgd2Ugc2hvdWxkIHN3aXRjaCB0aGUgYm9va2llIGJhY2sgdG8gcmVh\nZG9ubHkgbW9kZQogICAgICAgICAgICAgICAgICAgIC8vICAgICAgIG9yIHNo\ndXRkb3duIGl0LgogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhj\nZXB0aW9uIHRocm93biB3aGlsZSBmbHVzaGluZyBza2lwIGxpc3QgY2FjaGUu\nIiwgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9KTsKICAgIH0KfQo=\n","encoding":"base64"}

