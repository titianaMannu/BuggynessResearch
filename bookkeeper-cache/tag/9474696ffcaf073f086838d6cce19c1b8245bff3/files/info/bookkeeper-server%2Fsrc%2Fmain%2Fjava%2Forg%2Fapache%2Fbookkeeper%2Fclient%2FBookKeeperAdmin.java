{"sha":"18a801cba914b2f6ce25af904a6d4d44ce9e0b2f","node_id":"MDQ6QmxvYjE1NzU5NTY6MThhODAxY2JhOTE0YjJmNmNlMjVhZjkwNGE2ZDRkNDRjZTllMGIyZg==","size":38555,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/18a801cba914b2f6ce25af904a6d4d44ce9e0b2f","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxi\nYWNrLk9wZW5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQXN5bmNDYWxsYmFjay5SZWNvdmVyQ2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuU3lu\nY09wZW5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VyRnJhZ21lbnRSZXBsaWNhdG9yLlNpbmdsZUZyYWdtZW50\nQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5D\nbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLm1ldGEuTGVkZ2VyTWFuYWdlci5MZWRnZXJSYW5nZUl0ZXJhdG9yOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm5ldC5Cb29raWVTb2NrZXRB\nZGRyZXNzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5NdWx0aUNhbGxiYWNrOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRl\ncm5hbENhbGxiYWNrcy5Qcm9jZXNzb3I7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuSU9VdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci51dGlsLlprVXRpbHM7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuem9va2VlcGVyLlpvb0tlZXBlcldhdGNoZXJCYXNl\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQXN5bmNDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb24uQ29kZTsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpLVXRpbDsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLlpvb0RlZnMuSWRzOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0\nIGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5Vbmtub3du\nSG9zdEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2\nYS51dGlsLkxpbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuTm9TdWNoRWxl\nbWVudEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5SYW5kb207CmltcG9y\ndCBqYXZhLnV0aWwuVVVJRDsKCmltcG9ydCBzdGF0aWMgY29tLmdvb2dsZS5j\nb21tb24uYmFzZS5DaGFyc2V0cy5VVEZfODsKCi8qKgogKiBBZG1pbiBjbGll\nbnQgZm9yIEJvb2tLZWVwZXIgY2x1c3RlcnMKICovCnB1YmxpYyBjbGFzcyBC\nb29rS2VlcGVyQWRtaW4gewogICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tLZWVwZXJB\nZG1pbi5jbGFzcyk7CiAgICAvLyBaSyBjbGllbnQgaW5zdGFuY2UKICAgIHBy\naXZhdGUgWm9vS2VlcGVyIHprOwogICAgcHJpdmF0ZSBmaW5hbCBib29sZWFu\nIG93bnNaSzsKCiAgICAvLyBaSyBsZWRnZXJzIHJlbGF0ZWQgU3RyaW5nIGNv\nbnN0YW50cwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgYm9va2llc1BhdGg7\nCgogICAgLy8gQm9va0tlZXBlciBjbGllbnQgaW5zdGFuY2UKICAgIHByaXZh\ndGUgQm9va0tlZXBlciBia2M7CiAgICBwcml2YXRlIGZpbmFsIGJvb2xlYW4g\nb3duc0JLOwoKICAgIC8vIExlZGdlckZyYWdtZW50UmVwbGljYXRvciBpbnN0\nYW5jZQogICAgcHJpdmF0ZSBMZWRnZXJGcmFnbWVudFJlcGxpY2F0b3IgbGZy\nOwoKICAgIC8qCiAgICAgKiBSYW5kb20gbnVtYmVyIGdlbmVyYXRvciB1c2Vk\nIHRvIGNob29zZSBhbiBhdmFpbGFibGUgYm9va2llIHNlcnZlciB0bwogICAg\nICogcmVwbGljYXRlIGRhdGEgZnJvbSBhIGRlYWQgYm9va2llLgogICAgICov\nCiAgICBwcml2YXRlIFJhbmRvbSByYW5kID0gbmV3IFJhbmRvbSgpOwoKICAg\nIC8qKgogICAgICogQ29uc3RydWN0b3IgdGhhdCB0YWtlcyBpbiBhIFpvb0tl\nZXBlciBzZXJ2ZXJzIGNvbm5lY3Qgc3RyaW5nIHNvIHdlIGtub3cKICAgICAq\nIGhvdyB0byBjb25uZWN0IHRvIFpvb0tlZXBlciB0byByZXRyaWV2ZSBpbmZv\ncm1hdGlvbiBhYm91dCB0aGUgQm9va0tlZXBlcgogICAgICogY2x1c3Rlci4g\nV2UgbmVlZCB0aGlzIGJlZm9yZSB3ZSBjYW4gZG8gYW55IHR5cGUgb2YgYWRt\naW4gb3BlcmF0aW9ucyBvbgogICAgICogdGhlIEJvb2tLZWVwZXIgY2x1c3Rl\nci4KICAgICAqCiAgICAgKiBAcGFyYW0gemtTZXJ2ZXJzCiAgICAgKiAgICAg\nICAgICAgIENvbW1hIHNlcGFyYXRlZCBsaXN0IG9mIGhvc3RuYW1lOnBvcnQg\ncGFpcnMgZm9yIHRoZSBab29LZWVwZXIKICAgICAqICAgICAgICAgICAgc2Vy\ndmVycyBjbHVzdGVyLgogICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAg\nICogICAgICAgICAgICAgdGhyb3dzIHRoaXMgZXhjZXB0aW9uIGlmIHRoZXJl\nIGlzIGFuIGVycm9yIGluc3RhbnRpYXRpbmcgdGhlCiAgICAgKiAgICAgICAg\nICAgICBab29LZWVwZXIgY2xpZW50LgogICAgICogQHRocm93cyBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgVGhyb3dzIHRoaXMg\nZXhjZXB0aW9uIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluc3RhbnRpYXRpbmcg\ndGhlCiAgICAgKiAgICAgICAgICAgICBCb29rS2VlcGVyIGNsaWVudC4KICAg\nICAqIEB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uCiAgICAgKiAgICAgICAgICAg\nICBUaHJvd3MgdGhpcyBleGNlcHRpb24gaWYgdGhlcmUgaXMgYW4gZXJyb3Ig\naW5zdGFudGlhdGluZyB0aGUKICAgICAqICAgICAgICAgICAgIEJvb2tLZWVw\nZXIgY2xpZW50LgogICAgICovCiAgICBwdWJsaWMgQm9va0tlZXBlckFkbWlu\nKFN0cmluZyB6a1NlcnZlcnMpIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAgdGhp\ncyhuZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpLnNldFprU2VydmVycyh6a1Nl\ncnZlcnMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdG9yIHRo\nYXQgdGFrZXMgaW4gYSBjb25maWd1cmF0aW9uIG9iamVjdCBzbyB3ZSBrbm93\nCiAgICAgKiBob3cgdG8gY29ubmVjdCB0byBab29LZWVwZXIgdG8gcmV0cmll\ndmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIEJvb2tLZWVwZXIKICAgICAqIGNs\ndXN0ZXIuIFdlIG5lZWQgdGhpcyBiZWZvcmUgd2UgY2FuIGRvIGFueSB0eXBl\nIG9mIGFkbWluIG9wZXJhdGlvbnMgb24KICAgICAqIHRoZSBCb29rS2VlcGVy\nIGNsdXN0ZXIuCiAgICAgKgogICAgICogQHBhcmFtIGNvbmYKICAgICAqICAg\nICAgICAgICBDbGllbnQgQ29uZmlndXJhdGlvbiBPYmplY3QKICAgICAqIEB0\naHJvd3MgSU9FeGNlcHRpb24KICAgICAqICAgICAgICAgICAgIHRocm93cyB0\naGlzIGV4Y2VwdGlvbiBpZiB0aGVyZSBpcyBhbiBlcnJvciBpbnN0YW50aWF0\naW5nIHRoZQogICAgICogICAgICAgICAgICAgWm9vS2VlcGVyIGNsaWVudC4K\nICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqICAg\nICAgICAgICAgIFRocm93cyB0aGlzIGV4Y2VwdGlvbiBpZiB0aGVyZSBpcyBh\nbiBlcnJvciBpbnN0YW50aWF0aW5nIHRoZQogICAgICogICAgICAgICAgICAg\nQm9va0tlZXBlciBjbGllbnQuCiAgICAgKiBAdGhyb3dzIEtlZXBlckV4Y2Vw\ndGlvbgogICAgICogICAgICAgICAgICAgVGhyb3dzIHRoaXMgZXhjZXB0aW9u\nIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluc3RhbnRpYXRpbmcgdGhlCiAgICAg\nKiAgICAgICAgICAgICBCb29rS2VlcGVyIGNsaWVudC4KICAgICAqLwogICAg\ncHVibGljIEJvb2tLZWVwZXJBZG1pbihDbGllbnRDb25maWd1cmF0aW9uIGNv\nbmYpIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24s\nIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBab29L\nZWVwZXIgY2xpZW50IGluc3RhbmNlCiAgICAgICAgWm9vS2VlcGVyV2F0Y2hl\nckJhc2UgdyA9IG5ldyBab29LZWVwZXJXYXRjaGVyQmFzZShjb25mLmdldFpr\nVGltZW91dCgpKTsKICAgICAgICB6ayA9IFprVXRpbHMuY3JlYXRlQ29ubmVj\ndGVkWm9va2VlcGVyQ2xpZW50KGNvbmYuZ2V0WmtTZXJ2ZXJzKCksIHcpOwog\nICAgICAgIG93bnNaSyA9IHRydWU7CgogICAgICAgIC8vIENyZWF0ZSB0aGUg\nYm9va2llIHBhdGgKICAgICAgICBib29raWVzUGF0aCA9IGNvbmYuZ2V0WmtB\ndmFpbGFibGVCb29raWVzUGF0aCgpOwogICAgICAgIC8vIENyZWF0ZSB0aGUg\nQm9va0tlZXBlciBjbGllbnQgaW5zdGFuY2UKICAgICAgICBia2MgPSBuZXcg\nQm9va0tlZXBlcihjb25mLCB6ayk7CiAgICAgICAgb3duc0JLID0gdHJ1ZTsK\nCiAgICAgICAgdGhpcy5sZnIgPSBuZXcgTGVkZ2VyRnJhZ21lbnRSZXBsaWNh\ndG9yKGJrYyk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciB0\naGF0IHRha2VzIGluIGEgQm9va0tlZXBlciBpbnN0YW5jZSAuIFRoaXMgd2ls\nbCBiZSB1c2VmdWwsCiAgICAgKiB3aGVuIHVzZXJzIGFscmVhZHkgaGFzIGJr\nIGluc3RhbmNlIHJlYWR5LgogICAgICoKICAgICAqIEBwYXJhbSBia2MKICAg\nICAqICAgICAgICAgICAgLSBib29ra2VlcGVyIGluc3RhbmNlCiAgICAgKi8K\nICAgIHB1YmxpYyBCb29rS2VlcGVyQWRtaW4oZmluYWwgQm9va0tlZXBlciBi\na2MpIHsKICAgICAgICB0aGlzLmJrYyA9IGJrYzsKICAgICAgICBvd25zQksg\nPSBmYWxzZTsKICAgICAgICB0aGlzLnprID0gYmtjLnprOwogICAgICAgIG93\nbnNaSyA9IGZhbHNlOwogICAgICAgIHRoaXMuYm9va2llc1BhdGggPSBia2Mu\nZ2V0Q29uZigpLmdldFprQXZhaWxhYmxlQm9va2llc1BhdGgoKTsKICAgICAg\nICB0aGlzLmxmciA9IG5ldyBMZWRnZXJGcmFnbWVudFJlcGxpY2F0b3IoYmtj\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdyYWNlZnVsbHkgcmVsZWFzZSBy\nZXNvdXJjZXMgdGhhdCB0aGlzIGNsaWVudCB1c2VzLgogICAgICoKICAgICAq\nIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqICAgICAgICAg\nICAgIGlmIHRoZXJlIGlzIGFuIGVycm9yIHNodXR0aW5nIGRvd24gdGhlIGNs\naWVudHMgdGhhdCB0aGlzCiAgICAgKiAgICAgICAgICAgICBjbGFzcyB1c2Vz\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHRocm93cyBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIGlmIChv\nd25zQkspIHsKICAgICAgICAgICAgYmtjLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgICAgIGlmIChvd25zWkspIHsKICAgICAgICAgICAgemsuY2xvc2UoKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBsaXN0IG9m\nIHRoZSBhdmFpbGFibGUgYm9va2llcy4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIGEgY29sbGVjdGlvbiBvZiBib29raWUgYWRkcmVzc2VzCiAgICAgKi8KICAg\nIHB1YmxpYyBDb2xsZWN0aW9uPEJvb2tpZVNvY2tldEFkZHJlc3M+IGdldEF2\nYWlsYWJsZUJvb2tpZXMoKQogICAgICAgICAgICB0aHJvd3MgQktFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBia2MuYm9va2llV2F0Y2hlci5nZXRCb29r\naWVzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBsaXN0IG9mIHJl\nYWRvbmx5IGJvb2tpZXMKICAgICAqCiAgICAgKiBAcmV0dXJuIGEgY29sbGVj\ndGlvbiBvZiBib29raWUgYWRkcmVzc2VzCiAgICAgKi8KICAgIHB1YmxpYyBD\nb2xsZWN0aW9uPEJvb2tpZVNvY2tldEFkZHJlc3M+IGdldFJlYWRPbmx5Qm9v\na2llcygpIHsKICAgICAgICByZXR1cm4gYmtjLmJvb2tpZVdhdGNoZXIuZ2V0\nUmVhZE9ubHlCb29raWVzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBOb3Rp\nZnkgd2hlbiB0aGUgYXZhaWxhYmxlIGxpc3Qgb2YgYm9va2llcyBjaGFuZ2Vz\nLgogICAgICogVGhpcyBpcyBhIG9uZS1zaG90IG5vdGlmaWNhdGlvbi4gVG8g\ncmVjZWl2ZSBzdWJzZXF1ZW50IG5vdGlmaWNhdGlvbnMKICAgICAqIHRoZSBs\naXN0ZW5lciBtdXN0IGJlIHJlZ2lzdGVyZWQgYWdhaW4uCiAgICAgKgogICAg\nICogQHBhcmFtIGxpc3RlbmVyIHRoZSBsaXN0ZW5lciB0byBub3RpZnkKICAg\nICAqLwogICAgcHVibGljIHZvaWQgbm90aWZ5Qm9va2llc0NoYW5nZWQoZmlu\nYWwgQm9va2llc0xpc3RlbmVyIGxpc3RlbmVyKQogICAgICAgICAgICB0aHJv\nd3MgQktFeGNlcHRpb24gewogICAgICAgIGJrYy5ib29raWVXYXRjaGVyLm5v\ndGlmeUJvb2tpZXNDaGFuZ2VkKGxpc3RlbmVyKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIE9wZW4gYSBsZWRnZXIgYXMgYW4gYWRtaW5pc3RyYXRvci4gVGhp\ncyBtZWFucyB0aGF0IG5vIGRpZ2VzdCBwYXNzd29yZAogICAgICogY2hlY2tz\nIGFyZSBkb25lLiBPdGhlcndpc2UsIHRoZSBjYWxsIGlzIGlkZW50aWNhbCB0\nbyBCb29rS2VlcGVyI2FzeW5jT3BlbkxlZGdlcgogICAgICoKICAgICAqIEBw\nYXJhbSBsSWQKICAgICAqICAgICAgICAgIGxlZGdlciBpZGVudGlmaWVyCiAg\nICAgKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAgIENhbGxiYWNrIHdoaWNo\nIHdpbGwgcmVjZWl2ZSBhIExlZGdlckhhbmRsZSBvYmplY3QKICAgICAqIEBw\nYXJhbSBjdHgKICAgICAqICAgICAgICAgIG9wdGlvbmFsIGNvbnRleHQgb2Jq\nZWN0LCB0byBiZSBwYXNzd2QgdG8gdGhlIGNhbGxiYWNrIChjYW4gYmUgbnVs\nbCkKICAgICAqCiAgICAgKiBAc2VlIEJvb2tLZWVwZXIjYXN5bmNPcGVuTGVk\nZ2VyCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzeW5jT3BlbkxlZGdlcihm\naW5hbCBsb25nIGxJZCwgZmluYWwgT3BlbkNhbGxiYWNrIGNiLCBmaW5hbCBP\nYmplY3QgY3R4KSB7CiAgICAgICAgbmV3IExlZGdlck9wZW5PcChia2MsIGxJ\nZCwgY2IsIGN0eCkuaW5pdGlhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIE9wZW4gYSBsZWRnZXIgYXMgYW4gYWRtaW5pc3RyYXRvci4gVGhpcyBtZWFu\ncyB0aGF0IG5vIGRpZ2VzdCBwYXNzd29yZAogICAgICogY2hlY2tzIGFyZSBk\nb25lLiBPdGhlcndpc2UsIHRoZSBjYWxsIGlzIGlkZW50aWNhbCB0bwogICAg\nICogQm9va0tlZXBlciNvcGVuTGVkZ2VyCiAgICAgKgogICAgICogQHBhcmFt\nIGxJZAogICAgICogICAgICAgICAgICAtIGxlZGdlciBpZGVudGlmaWVyCiAg\nICAgKiBAc2VlIEJvb2tLZWVwZXIjb3BlbkxlZGdlcgogICAgICovCiAgICBw\ndWJsaWMgTGVkZ2VySGFuZGxlIG9wZW5MZWRnZXIoZmluYWwgbG9uZyBsSWQp\nIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwKICAgICAgICAgICAgQktF\neGNlcHRpb24gewogICAgICAgIFN5bmNDb3VudGVyIGNvdW50ZXIgPSBuZXcg\nU3luY0NvdW50ZXIoKTsKICAgICAgICBjb3VudGVyLmluYygpOwogICAgICAg\nIG5ldyBMZWRnZXJPcGVuT3AoYmtjLCBsSWQsIG5ldyBTeW5jT3BlbkNhbGxi\nYWNrKCksIGNvdW50ZXIpLmluaXRpYXRlKCk7CiAgICAgICAgLyoKICAgICAg\nICAgKiBXYWl0CiAgICAgICAgICovCiAgICAgICAgY291bnRlci5ibG9jaygw\nKTsKICAgICAgICBpZiAoY291bnRlci5nZXRyYygpICE9IEJLRXhjZXB0aW9u\nLkNvZGUuT0spIHsKICAgICAgICAgICAgdGhyb3cgQktFeGNlcHRpb24uY3Jl\nYXRlKGNvdW50ZXIuZ2V0cmMoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gY291bnRlci5nZXRMaCgpOwogICAgfQoKICAgIC8qKgogICAgICogT3Bl\nbiBhIGxlZGdlciBhcyBhbiBhZG1pbmlzdHJhdG9yIHdpdGhvdXQgcmVjb3Zl\ncmluZyB0aGUgbGVkZ2VyLiBUaGlzIG1lYW5zCiAgICAgKiB0aGF0IG5vIGRp\nZ2VzdCBwYXNzd29yZCAgY2hlY2tzIGFyZSBkb25lLiBPdGhlcndpc2UsIHRo\nZSBjYWxsIGlzIGlkZW50aWNhbAogICAgICogdG8gQm9va0tlZXBlciNhc3lu\nY09wZW5MZWRnZXJOb1JlY292ZXJ5CiAgICAgKgogICAgICogQHBhcmFtIGxJ\nZAogICAgICogICAgICAgICAgbGVkZ2VyIGlkZW50aWZpZXIKICAgICAqIEBw\nYXJhbSBjYgogICAgICogICAgICAgICAgQ2FsbGJhY2sgd2hpY2ggd2lsbCBy\nZWNlaXZlIGEgTGVkZ2VySGFuZGxlIG9iamVjdAogICAgICogQHBhcmFtIGN0\neAogICAgICogICAgICAgICAgb3B0aW9uYWwgY29udGV4dCBvYmplY3QsIHRv\nIGJlIHBhc3N3ZCB0byB0aGUgY2FsbGJhY2sgKGNhbiBiZSBudWxsKQogICAg\nICoKICAgICAqIEBzZWUgQm9va0tlZXBlciNhc3luY09wZW5MZWRnZXJOb1Jl\nY292ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzeW5jT3BlbkxlZGdl\nck5vUmVjb3ZlcnkoZmluYWwgbG9uZyBsSWQsIGZpbmFsIE9wZW5DYWxsYmFj\nayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIG5ldyBMZWRnZXJP\ncGVuT3AoYmtjLCBsSWQsIGNiLCBjdHgpLmluaXRpYXRlV2l0aG91dFJlY292\nZXJ5KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPcGVuIGEgbGVkZ2VyIGFz\nIGFuIGFkbWluaXN0cmF0b3Igd2l0aG91dCByZWNvdmVyaW5nIHRoZSBsZWRn\nZXIuIFRoaXMKICAgICAqIG1lYW5zIHRoYXQgbm8gZGlnZXN0IHBhc3N3b3Jk\nIGNoZWNrcyBhcmUgZG9uZS4gT3RoZXJ3aXNlLCB0aGUgY2FsbCBpcwogICAg\nICogaWRlbnRpY2FsIHRvIEJvb2tLZWVwZXIjb3BlbkxlZGdlck5vUmVjb3Zl\ncnkKICAgICAqCiAgICAgKiBAcGFyYW0gbElkCiAgICAgKiAgICAgICAgICAg\nIGxlZGdlciBpZGVudGlmaWVyCiAgICAgKiBAc2VlIEJvb2tLZWVwZXIjb3Bl\nbkxlZGdlck5vUmVjb3ZlcnkKICAgICAqLwogICAgcHVibGljIExlZGdlckhh\nbmRsZSBvcGVuTGVkZ2VyTm9SZWNvdmVyeShmaW5hbCBsb25nIGxJZCkKICAg\nICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2Vw\ndGlvbiB7CiAgICAgICAgU3luY0NvdW50ZXIgY291bnRlciA9IG5ldyBTeW5j\nQ291bnRlcigpOwogICAgICAgIGNvdW50ZXIuaW5jKCk7CiAgICAgICAgbmV3\nIExlZGdlck9wZW5PcChia2MsIGxJZCwgbmV3IFN5bmNPcGVuQ2FsbGJhY2so\nKSwgY291bnRlcikKICAgICAgICAgICAgICAgIC5pbml0aWF0ZVdpdGhvdXRS\nZWNvdmVyeSgpOwogICAgICAgIC8qCiAgICAgICAgICogV2FpdAogICAgICAg\nICAqLwogICAgICAgIGNvdW50ZXIuYmxvY2soMCk7CiAgICAgICAgaWYgKGNv\ndW50ZXIuZ2V0cmMoKSAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAg\nICAgICAgIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShjb3VudGVyLmdldHJj\nKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNvdW50ZXIuZ2V0TGgo\nKTsKICAgIH0KCiAgICAvLyBPYmplY3QgdXNlZCBmb3IgY2FsbGluZyBhc3lu\nYyBtZXRob2RzIGFuZCB3YWl0aW5nIGZvciB0aGVtIHRvIGNvbXBsZXRlLgog\nICAgc3RhdGljIGNsYXNzIFN5bmNPYmplY3QgewogICAgICAgIGJvb2xlYW4g\ndmFsdWU7CiAgICAgICAgaW50IHJjOwoKICAgICAgICBwdWJsaWMgU3luY09i\namVjdCgpIHsKICAgICAgICAgICAgdmFsdWUgPSBmYWxzZTsKICAgICAgICAg\nICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFN5bmNocm9ub3VzIG1ldGhvZCB0byByZWJ1aWxk\nIGFuZCByZWNvdmVyIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGRhdGEgdGhhdAog\nICAgICogd2FzIHN0b3JlZCBvbiB0aGUgc291cmNlIGJvb2tpZS4gVGhhdCBi\nb29raWUgY291bGQgaGF2ZSBmYWlsZWQgY29tcGxldGVseQogICAgICogYW5k\nIG5vdyB0aGUgbGVkZ2VyIGRhdGEgdGhhdCB3YXMgc3RvcmVkIG9uIGl0IGlz\nIHVuZGVyIHJlcGxpY2F0ZWQuIEFuCiAgICAgKiBvcHRpb25hbCBkZXN0aW5h\ndGlvbiBib29raWUgc2VydmVyIGNvdWxkIGJlIGdpdmVuIGlmIHdlIHdhbnQg\ndG8gY29weSBhbGwKICAgICAqIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGRh\ndGEgb24gdGhlIGZhaWxlZCBzb3VyY2UgYm9va2llIHRvIGl0LgogICAgICog\nT3RoZXJ3aXNlLCB3ZSB3aWxsIGp1c3QgcmFuZG9tbHkgZGlzdHJpYnV0ZSB0\naGUgbGVkZ2VyIGZyYWdtZW50cyB0byB0aGUKICAgICAqIGFjdGl2ZSBzZXQg\nb2YgYm9va2llcywgcGVyaGFwcyBiYXNlZCBvbiBsb2FkLiBBbGwgWm9vS2Vl\ncGVyIGxlZGdlcgogICAgICogbWV0YWRhdGEgd2lsbCBiZSB1cGRhdGVkIHRv\nIHBvaW50IHRvIHRoZSBuZXcgYm9va2llKHMpIHRoYXQgY29udGFpbiB0aGUK\nICAgICAqIHJlcGxpY2F0ZWQgbGVkZ2VyIGZyYWdtZW50cy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gYm9va2llU3JjCiAgICAgKiAgICAgICAgICAgIFNvdXJj\nZSBib29raWUgdGhhdCBoYWQgYSBmYWlsdXJlLiBXZSB3YW50IHRvIHJlcGxp\nY2F0ZSB0aGUKICAgICAqICAgICAgICAgICAgbGVkZ2VyIGZyYWdtZW50cyB0\naGF0IHdlcmUgc3RvcmVkIHRoZXJlLgogICAgICogQHBhcmFtIGJvb2tpZURl\nc3QKICAgICAqICAgICAgICAgICAgT3B0aW9uYWwgZGVzdGluYXRpb24gYm9v\na2llIHRoYXQgaWYgcGFzc2VkLCB3ZSB3aWxsIGNvcHkgYWxsCiAgICAgKiAg\nICAgICAgICAgIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGZyb20gdGhlIHNv\ndXJjZSBib29raWUgb3ZlciB0byBpdC4KICAgICAqLwogICAgcHVibGljIHZv\naWQgcmVjb3ZlckJvb2tpZURhdGEoZmluYWwgQm9va2llU29ja2V0QWRkcmVz\ncyBib29raWVTcmMsIGZpbmFsIEJvb2tpZVNvY2tldEFkZHJlc3MgYm9va2ll\nRGVzdCkKICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9u\nLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgU3luY09iamVjdCBzeW5jID0gbmV3\nIFN5bmNPYmplY3QoKTsKICAgICAgICAvLyBDYWxsIHRoZSBhc3luYyBtZXRo\nb2QgdG8gcmVjb3ZlciBib29raWUgZGF0YS4KICAgICAgICBhc3luY1JlY292\nZXJCb29raWVEYXRhKGJvb2tpZVNyYywgYm9va2llRGVzdCwgbmV3IFJlY292\nZXJDYWxsYmFjaygpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHJlY292ZXJDb21wbGV0ZShpbnQgcmMsIE9iamVj\ndCBjdHgpIHsKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJSZWNvdmVyIGJv\nb2tpZSBvcGVyYXRpb24gY29tcGxldGVkIHdpdGggcmM6ICIgKyByYyk7CiAg\nICAgICAgICAgICAgICBTeW5jT2JqZWN0IHN5bmNPYmogPSAoU3luY09iamVj\ndCkgY3R4OwogICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5jT2Jq\nKSB7CiAgICAgICAgICAgICAgICAgICAgc3luY09iai5yYyA9IHJjOwogICAg\nICAgICAgICAgICAgICAgIHN5bmNPYmoudmFsdWUgPSB0cnVlOwogICAgICAg\nICAgICAgICAgICAgIHN5bmNPYmoubm90aWZ5KCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LCBzeW5jKTsKCiAgICAgICAg\nLy8gV2FpdCBmb3IgdGhlIGFzeW5jIG1ldGhvZCB0byBjb21wbGV0ZS4KICAg\nICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgd2hpbGUg\nKHN5bmMudmFsdWUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHN5bmMu\nd2FpdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChz\neW5jLnJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAg\ndGhyb3cgQktFeGNlcHRpb24uY3JlYXRlKHN5bmMucmMpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEFzeW5jIG1ldGhvZCB0byByZWJ1aWxk\nIGFuZCByZWNvdmVyIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGRhdGEgdGhhdCB3\nYXMKICAgICAqIHN0b3JlZCBvbiB0aGUgc291cmNlIGJvb2tpZS4gVGhhdCBi\nb29raWUgY291bGQgaGF2ZSBmYWlsZWQgY29tcGxldGVseSBhbmQKICAgICAq\nIG5vdyB0aGUgbGVkZ2VyIGRhdGEgdGhhdCB3YXMgc3RvcmVkIG9uIGl0IGlz\nIHVuZGVyIHJlcGxpY2F0ZWQuIEFuCiAgICAgKiBvcHRpb25hbCBkZXN0aW5h\ndGlvbiBib29raWUgc2VydmVyIGNvdWxkIGJlIGdpdmVuIGlmIHdlIHdhbnQg\ndG8gY29weSBhbGwKICAgICAqIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGRh\ndGEgb24gdGhlIGZhaWxlZCBzb3VyY2UgYm9va2llIHRvIGl0LgogICAgICog\nT3RoZXJ3aXNlLCB3ZSB3aWxsIGp1c3QgcmFuZG9tbHkgZGlzdHJpYnV0ZSB0\naGUgbGVkZ2VyIGZyYWdtZW50cyB0byB0aGUKICAgICAqIGFjdGl2ZSBzZXQg\nb2YgYm9va2llcywgcGVyaGFwcyBiYXNlZCBvbiBsb2FkLiBBbGwgWm9vS2Vl\ncGVyIGxlZGdlcgogICAgICogbWV0YWRhdGEgd2lsbCBiZSB1cGRhdGVkIHRv\nIHBvaW50IHRvIHRoZSBuZXcgYm9va2llKHMpIHRoYXQgY29udGFpbiB0aGUK\nICAgICAqIHJlcGxpY2F0ZWQgbGVkZ2VyIGZyYWdtZW50cy4KICAgICAqCiAg\nICAgKiBAcGFyYW0gYm9va2llU3JjCiAgICAgKiAgICAgICAgICAgIFNvdXJj\nZSBib29raWUgdGhhdCBoYWQgYSBmYWlsdXJlLiBXZSB3YW50IHRvIHJlcGxp\nY2F0ZSB0aGUKICAgICAqICAgICAgICAgICAgbGVkZ2VyIGZyYWdtZW50cyB0\naGF0IHdlcmUgc3RvcmVkIHRoZXJlLgogICAgICogQHBhcmFtIGJvb2tpZURl\nc3QKICAgICAqICAgICAgICAgICAgT3B0aW9uYWwgZGVzdGluYXRpb24gYm9v\na2llIHRoYXQgaWYgcGFzc2VkLCB3ZSB3aWxsIGNvcHkgYWxsCiAgICAgKiAg\nICAgICAgICAgIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGZyb20gdGhlIHNv\ndXJjZSBib29raWUgb3ZlciB0byBpdC4KICAgICAqIEBwYXJhbSBjYgogICAg\nICogICAgICAgICAgICBSZWNvdmVyQ2FsbGJhY2sgdG8gaW52b2tlIG9uY2Ug\nYWxsIG9mIHRoZSBkYXRhIG9uIHRoZSBkZWFkCiAgICAgKiAgICAgICAgICAg\nIGJvb2tpZSBoYXMgYmVlbiByZWNvdmVyZWQgYW5kIHJlcGxpY2F0ZWQuCiAg\nICAgKiBAcGFyYW0gY29udGV4dAogICAgICogICAgICAgICAgICBDb250ZXh0\nIGZvciB0aGUgUmVjb3ZlckNhbGxiYWNrIHRvIGNhbGwuCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIGFzeW5jUmVjb3ZlckJvb2tpZURhdGEoZmluYWwgQm9v\na2llU29ja2V0QWRkcmVzcyBib29raWVTcmMsIGZpbmFsIEJvb2tpZVNvY2tl\ndEFkZHJlc3MgYm9va2llRGVzdCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgZmluYWwgUmVjb3ZlckNhbGxiYWNrIGNiLCBmaW5h\nbCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIFN5bmMgWksgdG8gbWFr\nZSBzdXJlIHdlJ3JlIHJlYWRpbmcgdGhlIGxhdGVzdCBib29raWUgZGF0YS4K\nICAgICAgICB6ay5zeW5jKGJvb2tpZXNQYXRoLCBuZXcgQXN5bmNDYWxsYmFj\nay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3Ry\naW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgIGlmIChy\nYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBMT0cuZXJyb3IoIlpLIGVycm9yIHN5bmNpbmc6ICIsIEtlZXBlckV4Y2Vw\ndGlvbi5jcmVhdGUoS2VlcGVyRXhjZXB0aW9uLkNvZGUuZ2V0KHJjKSwgcGF0\naCkpOwogICAgICAgICAgICAgICAgICAgIGNiLnJlY292ZXJDb21wbGV0ZShC\nS0V4Y2VwdGlvbi5Db2RlLlpLRXhjZXB0aW9uLCBjb250ZXh0KTsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBnZXRBdmFpbGFibGVCb29raWVzKGJvb2tpZVNyYywgYm9v\na2llRGVzdCwgY2IsIGNvbnRleHQpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICA7CiAgICAgICAgfSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUaGlzIG1ldGhvZCBhc3luY2hyb25vdXNseSBnZXRzIHRoZSBzZXQgb2Yg\nYXZhaWxhYmxlIEJvb2tpZXMgdGhhdCB0aGUKICAgICAqIGRlYWQgaW5wdXQg\nYm9va2llJ3MgZGF0YSB3aWxsIGJlIGNvcGllZCBvdmVyIGludG8uIElmIHRo\nZSB1c2VyIHBhc3NlZCBpbgogICAgICogYSBzcGVjaWZpYyBkZXN0aW5hdGlv\nbiBib29raWUsIHRoZW4ganVzdCB1c2UgdGhhdCBvbmUuIE90aGVyd2lzZSwg\nd2UnbGwKICAgICAqIHJhbmRvbWx5IHBpY2sgb25lIG9mIHRoZSBvdGhlciBh\ndmFpbGFibGUgYm9va2llcyB0byB1c2UgZm9yIGVhY2ggbGVkZ2VyCiAgICAg\nKiBmcmFnbWVudCB3ZSBhcmUgcmVwbGljYXRpbmcuCiAgICAgKgogICAgICog\nQHBhcmFtIGJvb2tpZVNyYwogICAgICogICAgICAgICAgICBTb3VyY2UgYm9v\na2llIHRoYXQgaGFkIGEgZmFpbHVyZS4gV2Ugd2FudCB0byByZXBsaWNhdGUg\ndGhlCiAgICAgKiAgICAgICAgICAgIGxlZGdlciBmcmFnbWVudHMgdGhhdCB3\nZXJlIHN0b3JlZCB0aGVyZS4KICAgICAqIEBwYXJhbSBib29raWVEZXN0CiAg\nICAgKiAgICAgICAgICAgIE9wdGlvbmFsIGRlc3RpbmF0aW9uIGJvb2tpZSB0\naGF0IGlmIHBhc3NlZCwgd2Ugd2lsbCBjb3B5IGFsbAogICAgICogICAgICAg\nICAgICBvZiB0aGUgbGVkZ2VyIGZyYWdtZW50cyBmcm9tIHRoZSBzb3VyY2Ug\nYm9va2llIG92ZXIgdG8gaXQuCiAgICAgKiBAcGFyYW0gY2IKICAgICAqICAg\nICAgICAgICAgUmVjb3ZlckNhbGxiYWNrIHRvIGludm9rZSBvbmNlIGFsbCBv\nZiB0aGUgZGF0YSBvbiB0aGUgZGVhZAogICAgICogICAgICAgICAgICBib29r\naWUgaGFzIGJlZW4gcmVjb3ZlcmVkIGFuZCByZXBsaWNhdGVkLgogICAgICog\nQHBhcmFtIGNvbnRleHQKICAgICAqICAgICAgICAgICAgQ29udGV4dCBmb3Ig\ndGhlIFJlY292ZXJDYWxsYmFjayB0byBjYWxsLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgZ2V0QXZhaWxhYmxlQm9va2llcyhmaW5hbCBCb29raWVTb2Nr\nZXRBZGRyZXNzIGJvb2tpZVNyYywgZmluYWwgQm9va2llU29ja2V0QWRkcmVz\ncyBib29raWVEZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmluYWwgUmVjb3ZlckNhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3Qg\nY29udGV4dCkgewogICAgICAgIGZpbmFsIExpc3Q8Qm9va2llU29ja2V0QWRk\ncmVzcz4gYXZhaWxhYmxlQm9va2llcyA9IG5ldyBMaW5rZWRMaXN0PEJvb2tp\nZVNvY2tldEFkZHJlc3M+KCk7CiAgICAgICAgaWYgKGJvb2tpZURlc3QgIT0g\nbnVsbCkgewogICAgICAgICAgICBhdmFpbGFibGVCb29raWVzLmFkZChib29r\naWVEZXN0KTsKICAgICAgICAgICAgLy8gTm93IHBvbGwgWksgdG8gZ2V0IHRo\nZSBhY3RpdmUgbGVkZ2VycwogICAgICAgICAgICBnZXRBY3RpdmVMZWRnZXJz\nKGJvb2tpZVNyYywgYm9va2llRGVzdCwgY2IsIGNvbnRleHQsIGF2YWlsYWJs\nZUJvb2tpZXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHprLmdl\ndENoaWxkcmVuKGJvb2tpZXNQYXRoLCBudWxsLCBuZXcgQXN5bmNDYWxsYmFj\nay5DaGlsZHJlbkNhbGxiYWNrKCkgewogICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0\nKGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsIExpc3Q8U3RyaW5n\nPiBjaGlsZHJlbikgewogICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBD\nb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLmVycm9yKCJaSyBlcnJvciBnZXR0aW5nIGJvb2tpZSBub2RlczogIiwg\nS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNlcHRpb24uQ29kZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldChyYyksIHBh\ndGgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2IucmVjb3ZlckNvbXBs\nZXRlKEJLRXhjZXB0aW9uLkNvZGUuWktFeGNlcHRpb24sIGNvbnRleHQpOwog\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvciAoU3RyaW5nIGJvb2tp\nZU5vZGUgOiBjaGlsZHJlbikgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoQm9va0tlZXBlckNvbnN0YW50cy5SRUFET05MWQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVxdWFscyhib29raWVOb2Rl\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXhjbHVkZSB0\naGUgcmVhZG9ubHkgbm9kZSBmcm9tIGF2YWlsYWJsZSBib29raWVzLgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgQm9va2ll\nU29ja2V0QWRkcmVzcyBhZGRyOwogICAgICAgICAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkciA9IG5ldyBC\nb29raWVTb2NrZXRBZGRyZXNzKGJvb2tpZU5vZGUpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChVbmtub3duSG9zdEV4Y2VwdGlvbiBuaGUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQm9v\na2llIE5vZGUgcmV0cmlldmVkIGZyb20gWksgaGFzIGludmFsaWQgbmFtZSBm\nb3JtYXQ6ICIgKyBib29raWVOb2RlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNiLnJlY292ZXJDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLlpL\nRXhjZXB0aW9uLCBjb250ZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICBhdmFpbGFibGVCb29raWVzLmFkZChhZGRyKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g\nTm93IHBvbGwgWksgdG8gZ2V0IHRoZSBhY3RpdmUgbGVkZ2VycwogICAgICAg\nICAgICAgICAgICAgIGdldEFjdGl2ZUxlZGdlcnMoYm9va2llU3JjLCBudWxs\nLCBjYiwgY29udGV4dCwgYXZhaWxhYmxlQm9va2llcyk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFRoaXMgbWV0aG9kIGFzeW5jaHJvbm91c2x5IHBv\nbGxzIFpLIHRvIGdldCB0aGUgY3VycmVudCBzZXQgb2YgYWN0aXZlCiAgICAg\nKiBsZWRnZXJzLiBGcm9tIHRoaXMsIHdlIGNhbiBvcGVuIGVhY2ggbGVkZ2Vy\nIGFuZCBsb29rIGF0IHRoZSBtZXRhZGF0YSB0bwogICAgICogZGV0ZXJtaW5l\nIGlmIGFueSBvZiB0aGUgbGVkZ2VyIGZyYWdtZW50cyBmb3IgaXQgd2VyZSBz\ndG9yZWQgYXQgdGhlIGRlYWQKICAgICAqIGlucHV0IGJvb2tpZS4KICAgICAq\nCiAgICAgKiBAcGFyYW0gYm9va2llU3JjCiAgICAgKiAgICAgICAgICAgIFNv\ndXJjZSBib29raWUgdGhhdCBoYWQgYSBmYWlsdXJlLiBXZSB3YW50IHRvIHJl\ncGxpY2F0ZSB0aGUKICAgICAqICAgICAgICAgICAgbGVkZ2VyIGZyYWdtZW50\ncyB0aGF0IHdlcmUgc3RvcmVkIHRoZXJlLgogICAgICogQHBhcmFtIGJvb2tp\nZURlc3QKICAgICAqICAgICAgICAgICAgT3B0aW9uYWwgZGVzdGluYXRpb24g\nYm9va2llIHRoYXQgaWYgcGFzc2VkLCB3ZSB3aWxsIGNvcHkgYWxsCiAgICAg\nKiAgICAgICAgICAgIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGZyb20gdGhl\nIHNvdXJjZSBib29raWUgb3ZlciB0byBpdC4KICAgICAqIEBwYXJhbSBjYgog\nICAgICogICAgICAgICAgICBSZWNvdmVyQ2FsbGJhY2sgdG8gaW52b2tlIG9u\nY2UgYWxsIG9mIHRoZSBkYXRhIG9uIHRoZSBkZWFkCiAgICAgKiAgICAgICAg\nICAgIGJvb2tpZSBoYXMgYmVlbiByZWNvdmVyZWQgYW5kIHJlcGxpY2F0ZWQu\nCiAgICAgKiBAcGFyYW0gY29udGV4dAogICAgICogICAgICAgICAgICBDb250\nZXh0IGZvciB0aGUgUmVjb3ZlckNhbGxiYWNrIHRvIGNhbGwuCiAgICAgKiBA\ncGFyYW0gYXZhaWxhYmxlQm9va2llcwogICAgICogICAgICAgICAgICBMaXN0\nIG9mIEJvb2tpZSBTZXJ2ZXJzIHRoYXQgYXJlIGF2YWlsYWJsZSB0byB1c2Ug\nZm9yCiAgICAgKiAgICAgICAgICAgIHJlcGxpY2F0aW5nIGRhdGEgb24gdGhl\nIGZhaWxlZCBib29raWUuIFRoaXMgY291bGQgY29udGFpbiBhCiAgICAgKiAg\nICAgICAgICAgIHNpbmdsZSBib29raWUgc2VydmVyIGlmIHRoZSB1c2VyIGV4\ncGxpY2l0bHkgY2hvc2UgYSBib29raWUKICAgICAqICAgICAgICAgICAgc2Vy\ndmVyIHRvIHJlcGxpY2F0ZSBkYXRhIHRvLgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgZ2V0QWN0aXZlTGVkZ2VycyhmaW5hbCBCb29raWVTb2NrZXRBZGRy\nZXNzIGJvb2tpZVNyYywgZmluYWwgQm9va2llU29ja2V0QWRkcmVzcyBib29r\naWVEZXN0LAogICAgICAgICAgICBmaW5hbCBSZWNvdmVyQ2FsbGJhY2sgY2Is\nIGZpbmFsIE9iamVjdCBjb250ZXh0LCBmaW5hbCBMaXN0PEJvb2tpZVNvY2tl\ndEFkZHJlc3M+IGF2YWlsYWJsZUJvb2tpZXMpIHsKICAgICAgICAvLyBXcmFw\ncGVyIGNsYXNzIGFyb3VuZCB0aGUgUmVjb3ZlckNhbGxiYWNrIHNvIGl0IGNh\nbiBiZSB1c2VkCiAgICAgICAgLy8gYXMgdGhlIGZpbmFsIFZvaWRDYWxsYmFj\nayB0byBwcm9jZXNzIGxlZGdlcnMKICAgICAgICBjbGFzcyBSZWNvdmVyQ2Fs\nbGJhY2tXcmFwcGVyIGltcGxlbWVudHMgQXN5bmNDYWxsYmFjay5Wb2lkQ2Fs\nbGJhY2sgewogICAgICAgICAgICBmaW5hbCBSZWNvdmVyQ2FsbGJhY2sgY2I7\nCgogICAgICAgICAgICBSZWNvdmVyQ2FsbGJhY2tXcmFwcGVyKFJlY292ZXJD\nYWxsYmFjayBjYikgewogICAgICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBw\nYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICBjYi5yZWNvdmVy\nQ29tcGxldGUoYmtjLmdldFJldHVyblJjKHJjKSwgY3R4KTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgUHJvY2Vzc29yPExvbmc+IGxlZGdl\nclByb2Nlc3NvciA9IG5ldyBQcm9jZXNzb3I8TG9uZz4oKSB7CiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNz\nKExvbmcgbGVkZ2VySWQsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGl0\nZXJDYWxsYmFjaykgewogICAgICAgICAgICAgICAgcmVjb3ZlckxlZGdlcihi\nb29raWVTcmMsIGxlZGdlcklkLCBpdGVyQ2FsbGJhY2ssIGF2YWlsYWJsZUJv\nb2tpZXMpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBia2Mu\nZ2V0TGVkZ2VyTWFuYWdlcigpLmFzeW5jUHJvY2Vzc0xlZGdlcnMoCiAgICAg\nICAgICAgICAgICBsZWRnZXJQcm9jZXNzb3IsIG5ldyBSZWNvdmVyQ2FsbGJh\nY2tXcmFwcGVyKGNiKSwKICAgICAgICAgICAgICAgIGNvbnRleHQsIEJLRXhj\nZXB0aW9uLkNvZGUuT0ssIEJLRXhjZXB0aW9uLkNvZGUuTGVkZ2VyUmVjb3Zl\ncnlFeGNlcHRpb24pOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGEgbmV3\nIHJhbmRvbSBib29raWUsIGJ1dCBlbnN1cmUgdGhhdCBpdCBpc24ndCBvbmUg\ndGhhdCBpcyBhbHJlYWR5CiAgICAgKiBpbiB0aGUgZW5zZW1ibGUgZm9yIHRo\nZSBsZWRnZXIuCiAgICAgKi8KICAgIHByaXZhdGUgQm9va2llU29ja2V0QWRk\ncmVzcyBnZXROZXdCb29raWUoZmluYWwgTGlzdDxCb29raWVTb2NrZXRBZGRy\nZXNzPiBib29raWVzQWxyZWFkeUluRW5zZW1ibGUsCiAgICAgICAgICAgIGZp\nbmFsIExpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gYXZhaWxhYmxlQm9va2ll\ncykKICAgICAgICAgICAgdGhyb3dzIEJLRXhjZXB0aW9uLkJLTm90RW5vdWdo\nQm9va2llc0V4Y2VwdGlvbiB7CiAgICAgICAgQXJyYXlMaXN0PEJvb2tpZVNv\nY2tldEFkZHJlc3M+IGNhbmRpZGF0ZXMgPSBuZXcgQXJyYXlMaXN0PEJvb2tp\nZVNvY2tldEFkZHJlc3M+KCk7CiAgICAgICAgY2FuZGlkYXRlcy5hZGRBbGwo\nYXZhaWxhYmxlQm9va2llcyk7CiAgICAgICAgY2FuZGlkYXRlcy5yZW1vdmVB\nbGwoYm9va2llc0FscmVhZHlJbkVuc2VtYmxlKTsKICAgICAgICBpZiAoY2Fu\nZGlkYXRlcy5zaXplKCkgPT0gMCkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nQktFeGNlcHRpb24uQktOb3RFbm91Z2hCb29raWVzRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBjYW5kaWRhdGVzLmdldChyYW5kLm5l\neHRJbnQoY2FuZGlkYXRlcy5zaXplKCkpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIGFzeW5jaHJvbm91c2x5IHJlY292ZXJzIGEgZ2l2\nZW4gbGVkZ2VyIGlmIGFueSBvZiB0aGUgbGVkZ2VyCiAgICAgKiBlbnRyaWVz\nIHdlcmUgc3RvcmVkIG9uIHRoZSBmYWlsZWQgYm9va2llLgogICAgICoKICAg\nICAqIEBwYXJhbSBib29raWVTcmMKICAgICAqICAgICAgICAgICAgU291cmNl\nIGJvb2tpZSB0aGF0IGhhZCBhIGZhaWx1cmUuIFdlIHdhbnQgdG8gcmVwbGlj\nYXRlIHRoZQogICAgICogICAgICAgICAgICBsZWRnZXIgZnJhZ21lbnRzIHRo\nYXQgd2VyZSBzdG9yZWQgdGhlcmUuCiAgICAgKiBAcGFyYW0gbElkCiAgICAg\nKiAgICAgICAgICAgIExlZGdlciBpZCB3ZSB3YW50IHRvIHJlY292ZXIuCiAg\nICAgKiBAcGFyYW0gbGVkZ2VySXRlckNiCiAgICAgKiAgICAgICAgICAgIEl0\nZXJhdGlvbkNhbGxiYWNrIHRvIGludm9rZSBvbmNlIHdlJ3ZlIHJlY292ZXJl\nZCB0aGUgY3VycmVudAogICAgICogICAgICAgICAgICBsZWRnZXIuCiAgICAg\nKiBAcGFyYW0gYXZhaWxhYmxlQm9va2llcwogICAgICogICAgICAgICAgICBM\naXN0IG9mIEJvb2tpZSBTZXJ2ZXJzIHRoYXQgYXJlIGF2YWlsYWJsZSB0byB1\nc2UgZm9yCiAgICAgKiAgICAgICAgICAgIHJlcGxpY2F0aW5nIGRhdGEgb24g\ndGhlIGZhaWxlZCBib29raWUuIFRoaXMgY291bGQgY29udGFpbiBhCiAgICAg\nKiAgICAgICAgICAgIHNpbmdsZSBib29raWUgc2VydmVyIGlmIHRoZSB1c2Vy\nIGV4cGxpY2l0bHkgY2hvc2UgYSBib29raWUKICAgICAqICAgICAgICAgICAg\nc2VydmVyIHRvIHJlcGxpY2F0ZSBkYXRhIHRvLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgcmVjb3ZlckxlZGdlcihmaW5hbCBCb29raWVTb2NrZXRBZGRy\nZXNzIGJvb2tpZVNyYywgZmluYWwgbG9uZyBsSWQsCiAgICAgICAgICAgIGZp\nbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGxlZGdlckl0ZXJDYiwg\nZmluYWwgTGlzdDxCb29raWVTb2NrZXRBZGRyZXNzPiBhdmFpbGFibGVCb29r\naWVzKSB7CiAgICAgICAgTE9HLmRlYnVnKCJSZWNvdmVyaW5nIGxlZGdlciA6\nIHt9IiwgbElkKTsKCiAgICAgICAgYXN5bmNPcGVuTGVkZ2VyTm9SZWNvdmVy\neShsSWQsIG5ldyBPcGVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVuQ29tcGxldGUoaW50\nIHJjLCBmaW5hbCBMZWRnZXJIYW5kbGUgbGgsIE9iamVjdCBjdHgpIHsKICAg\nICAgICAgICAgICAgIGlmIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsK\nICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkJLIGVycm9yIG9wZW5p\nbmcgbGVkZ2VyOiAiICsgbElkLCBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpKTsK\nICAgICAgICAgICAgICAgICAgICBsZWRnZXJJdGVyQ2IucHJvY2Vzc1Jlc3Vs\ndChyYywgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIExlZGdlck1l\ndGFkYXRhIGxtID0gbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKTsKICAgICAgICAg\nICAgICAgIGlmICghbG0uaXNDbG9zZWQoKSAmJgogICAgICAgICAgICAgICAg\nICAgIGxtLmdldEVuc2VtYmxlcygpLnNpemUoKSA+IDApIHsKICAgICAgICAg\nICAgICAgICAgICBMb25nIGxhc3RLZXkgPSBsbS5nZXRFbnNlbWJsZXMoKS5s\nYXN0S2V5KCk7CiAgICAgICAgICAgICAgICAgICAgQXJyYXlMaXN0PEJvb2tp\nZVNvY2tldEFkZHJlc3M+IGxhc3RFbnNlbWJsZSA9IGxtLmdldEVuc2VtYmxl\ncygpLmdldChsYXN0S2V5KTsKICAgICAgICAgICAgICAgICAgICAvLyB0aGUg\nb3JpZ2luYWwgd3JpdGUgaGFzIG5vdCByZW1vdmVkIGZhdWx0eSBib29raWUg\nZnJvbQogICAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgbGVkZ2VyIGVu\nc2VtYmxlLiB0byBhdm9pZCBkYXRhIGxvc3MgaXNzdWUgaW4KICAgICAgICAg\nICAgICAgICAgICAvLyB0aGUgY2FzZSBvZiBjb25jdXJyZW50IHVwZGF0ZXMg\ndG8gdGhlIGVuc2VtYmxlIGNvbXBvc2l0aW9uLAogICAgICAgICAgICAgICAg\nICAgIC8vIHRoZSByZWNvdmVyeSB0b29sIHNob3VsZCBmaXJzdCBjbG9zZSB0\naGUgbGVkZ2VyCiAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RFbnNlbWJs\nZS5jb250YWlucyhib29raWVTcmMpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGNsb3NlIG9wZW5lZCBub24gcmVjb3ZlcnkgbGVkZ2VyIGhhbmRs\nZQogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cud2FybigiRXJyb3IgY2xvc2luZyBub24gcmVj\nb3ZlcnkgbGVkZ2VyIGhhbmRsZSBmb3IgbGVkZ2VyICIgKyBsSWQsIGllKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICBhc3luY09wZW5MZWRnZXIobElkLCBuZXcgT3BlbkNhbGxiYWNrKCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVuQ29tcGxl\ndGUoaW50IG5ld3JjLCBmaW5hbCBMZWRnZXJIYW5kbGUgbmV3bGgsIE9iamVj\ndCBuZXdjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAobmV3cmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQksgZXJyb3Ig\nY2xvc2UgbGVkZ2VyOiAiICsgbElkLCBCS0V4Y2VwdGlvbi5jcmVhdGUobmV3\ncmMpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VySXRlckNiLnByb2Nlc3NSZXN1bHQobmV3cmMsIG51bGwsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIGRvIHJlY292ZXJ5CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcmVjb3ZlckxlZGdlcihib29raWVTcmMs\nIGxJZCwgbGVkZ2VySXRlckNiLCBhdmFpbGFibGVCb29raWVzKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgfSwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIFRoaXMgTGlzdCBz\ndG9yZXMgdGhlIGxlZGdlciBmcmFnbWVudHMgdG8gcmVjb3ZlciBpbmRleGVk\nIGJ5CiAgICAgICAgICAgICAgICAgKiB0aGUgc3RhcnQgZW50cnkgSUQgZm9y\nIHRoZSByYW5nZS4gVGhlIGVuc2VtYmxlcyBUcmVlTWFwIGlzCiAgICAgICAg\nICAgICAgICAgKiBrZXllZCBvZmYgdGhpcy4KICAgICAgICAgICAgICAgICAq\nLwogICAgICAgICAgICAgICAgZmluYWwgTGlzdDxMb25nPiBsZWRnZXJGcmFn\nbWVudHNUb1JlY292ZXIgPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwogICAg\nICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIFRoaXMgTWFwIHdp\nbGwgc3RvcmUgdGhlIHN0YXJ0IGFuZCBlbmQgZW50cnkgSUQgdmFsdWVzIGZv\ncgogICAgICAgICAgICAgICAgICogZWFjaCBvZiB0aGUgbGVkZ2VyIGZyYWdt\nZW50IHJhbmdlcy4gVGhlIG9ubHkgZXhjZXB0aW9uIGlzIHRoZQogICAgICAg\nICAgICAgICAgICogY3VycmVudCBhY3RpdmUgZnJhZ21lbnQgc2luY2UgaXQg\naGFzIG5vIGVuZCB5ZXQuIEluIHRoZSBldmVudAogICAgICAgICAgICAgICAg\nICogb2YgYSBib29raWUgZmFpbHVyZSwgYSBuZXcgZW5zZW1ibGUgaXMgY3Jl\nYXRlZCBzbyB0aGUgY3VycmVudAogICAgICAgICAgICAgICAgICogZW5zZW1i\nbGUgc2hvdWxkIG5vdCBjb250YWluIHRoZSBkZWFkIGJvb2tpZSB3ZSBhcmUg\ndHJ5aW5nIHRvCiAgICAgICAgICAgICAgICAgKiByZWNvdmVyLgogICAgICAg\nICAgICAgICAgICovCiAgICAgICAgICAgICAgICBNYXA8TG9uZywgTG9uZz4g\nbGVkZ2VyRnJhZ21lbnRzUmFuZ2UgPSBuZXcgSGFzaE1hcDxMb25nLCBMb25n\nPigpOwogICAgICAgICAgICAgICAgTG9uZyBjdXJFbnRyeUlkID0gbnVsbDsK\nICAgICAgICAgICAgICAgIGZvciAoTWFwLkVudHJ5PExvbmcsIEFycmF5TGlz\ndDxCb29raWVTb2NrZXRBZGRyZXNzPj4gZW50cnkgOiBsaC5nZXRMZWRnZXJN\nZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpCiAgICAgICAgICAgICAgICAgICAg\nICAgICAuZW50cnlTZXQoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChj\ndXJFbnRyeUlkICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGxl\nZGdlckZyYWdtZW50c1JhbmdlLnB1dChjdXJFbnRyeUlkLCBlbnRyeS5nZXRL\nZXkoKSAtIDEpOwogICAgICAgICAgICAgICAgICAgIGN1ckVudHJ5SWQgPSBl\nbnRyeS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnku\nZ2V0VmFsdWUoKS5jb250YWlucyhib29raWVTcmMpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAqIEN1\ncnJlbnQgbGVkZ2VyIGZyYWdtZW50IGhhcyBlbnRyaWVzIHN0b3JlZCBvbiB0\naGUKICAgICAgICAgICAgICAgICAgICAgICAgICogZGVhZCBib29raWUgc28g\nd2UnbGwgbmVlZCB0byByZWNvdmVyIHRoZW0uCiAgICAgICAgICAgICAgICAg\nICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJGcmFn\nbWVudHNUb1JlY292ZXIuYWRkKGVudHJ5LmdldEtleSgpKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAvLyBhZGQgbGFzdCBlbnNlbWJsZSBvdGhlcndpc2UgaWYgdGhlIGZhaWxl\nZCBib29raWUgZXhpc3RlZCBpbgogICAgICAgICAgICAgICAgLy8gdGhlIGxh\nc3QgZW5zZW1ibGUgb2YgYSBjbG9zZWQgbGVkZ2VyLiB0aGUgZW50cmllcyBi\nZWxvbmdlZCB0bwogICAgICAgICAgICAgICAgLy8gbGFzdCBlbnNlbWJsZSB3\nb3VsZCBub3QgYmUgcmVwbGljYXRlZC4KICAgICAgICAgICAgICAgIGlmIChj\ndXJFbnRyeUlkICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBsZWRn\nZXJGcmFnbWVudHNSYW5nZS5wdXQoY3VyRW50cnlJZCwgbGguZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIC8qCiAgICAgICAgICAgICAgICAgKiBTZWUgaWYgdGhpcyBjdXJyZW50\nIGxlZGdlciBjb250YWlucyBhbnkgbGVkZ2VyIGZyYWdtZW50IHRoYXQKICAg\nICAgICAgICAgICAgICAqIG5lZWRzIHRvIGJlIHJlLXJlcGxpY2F0ZWQuIElm\nIG5vdCwgdGhlbiBqdXN0IGludm9rZSB0aGUKICAgICAgICAgICAgICAgICAq\nIG11bHRpQ2FsbGJhY2sgYW5kIHJldHVybi4KICAgICAgICAgICAgICAgICAq\nLwogICAgICAgICAgICAgICAgaWYgKGxlZGdlckZyYWdtZW50c1RvUmVjb3Zl\nci5zaXplKCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGxlZGdlckl0\nZXJDYi5wcm9jZXNzUmVzdWx0KEJLRXhjZXB0aW9uLkNvZGUuT0ssIG51bGws\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAg\nICogTXVsdGljYWxsYmFjayBmb3IgbGVkZ2VyLiBPbmNlIGFsbCBmcmFnbWVu\ndHMgZm9yIHRoZSBsZWRnZXIgaGF2ZSBiZWVuIHJlY292ZXJlZAogICAgICAg\nICAgICAgICAgICogdHJpZ2dlciB0aGUgbGVkZ2VySXRlckNiCiAgICAgICAg\nICAgICAgICAgKi8KICAgICAgICAgICAgICAgIE11bHRpQ2FsbGJhY2sgbGVk\nZ2VyRnJhZ21lbnRzTWNiCiAgICAgICAgICAgICAgICAgICAgPSBuZXcgTXVs\ndGlDYWxsYmFjayhsZWRnZXJGcmFnbWVudHNUb1JlY292ZXIuc2l6ZSgpLCBs\nZWRnZXJJdGVyQ2IsIG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBCS0V4Y2VwdGlvbi5Db2RlLk9LLCBCS0V4Y2VwdGlv\nbi5Db2RlLkxlZGdlclJlY292ZXJ5RXhjZXB0aW9uKTsKICAgICAgICAgICAg\nICAgIC8qCiAgICAgICAgICAgICAgICAgKiBOb3cgcmVjb3ZlciBhbGwgb2Yg\ndGhlIG5lY2Vzc2FyeSBsZWRnZXIgZnJhZ21lbnRzCiAgICAgICAgICAgICAg\nICAgKiBhc3luY2hyb25vdXNseSB1c2luZyBhIE11bHRpQ2FsbGJhY2sgZm9y\nIGV2ZXJ5IGZyYWdtZW50LgogICAgICAgICAgICAgICAgICovCiAgICAgICAg\nICAgICAgICBmb3IgKGZpbmFsIExvbmcgc3RhcnRFbnRyeUlkIDogbGVkZ2Vy\nRnJhZ21lbnRzVG9SZWNvdmVyKSB7CiAgICAgICAgICAgICAgICAgICAgTG9u\nZyBlbmRFbnRyeUlkID0gbGVkZ2VyRnJhZ21lbnRzUmFuZ2UuZ2V0KHN0YXJ0\nRW50cnlJZCk7CiAgICAgICAgICAgICAgICAgICAgQm9va2llU29ja2V0QWRk\ncmVzcyBuZXdCb29raWUgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG5ld0Jvb2tpZSA9IGdldE5l\nd0Jvb2tpZShsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygp\nLmdldChzdGFydEVudHJ5SWQpLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgYXZhaWxhYmxlQm9va2llcyk7CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktOb3RF\nbm91Z2hCb29raWVzRXhjZXB0aW9uIGJrZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBsZWRnZXJGcmFnbWVudHNNY2IucHJvY2Vzc1Jlc3VsdChCS0V4\nY2VwdGlvbi5Db2RlLk5vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24sCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nb250aW51ZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBMT0cuZGVidWcoIlJlcGxpY2F0aW5nIGZyYWdtZW50\nIGZyb20gWyIgKyBzdGFydEVudHJ5SWQKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgIiwiICsgZW5kRW50cnlJZCArICJdIG9mIGxlZGdl\nciAiICsgbGguZ2V0SWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiIHRvICIgKyBuZXdCb29raWUpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICBMZWRnZXJGcmFnbWVudFJlcGxpY2F0b3IuU2luZ2xlRnJh\nZ21lbnRDYWxsYmFjayBjYiA9IG5ldyBMZWRnZXJGcmFnbWVudFJlcGxpY2F0\nb3IuU2luZ2xlRnJhZ21lbnRDYWxsYmFjaygKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxlZGdlckZyYWdtZW50c01jYiwgbGgsIHN0YXJ0\nRW50cnlJZCwgYm9va2llU3JjLCBuZXdCb29raWUpOwogICAgICAgICAgICAg\nICAgICAgICAgICBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gY3Vy\ncmVudEVuc2VtYmxlID0gbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNl\nbWJsZSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydEVu\ndHJ5SWQpOwogICAgICAgICAgICAgICAgICAgICAgICBpbnQgYm9va2llSW5k\nZXggPSAtMTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0g\nY3VycmVudEVuc2VtYmxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IGN1cnJlbnRFbnNlbWJsZS5zaXplKCk7\nIGkrKykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChj\ndXJyZW50RW5zZW1ibGUuZ2V0KGkpLmVxdWFscyhib29raWVTcmMpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2tpZUluZGV4\nID0gaTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgIExlZGdlckZyYWdtZW50IGxl\nZGdlckZyYWdtZW50ID0gbmV3IExlZGdlckZyYWdtZW50KGxoLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0RW50cnlJZCwgZW5kRW50\ncnlJZCwgYm9va2llSW5kZXgpOwogICAgICAgICAgICAgICAgICAgICAgICBh\nc3luY1JlY292ZXJMZWRnZXJGcmFnbWVudChsaCwgbGVkZ2VyRnJhZ21lbnQs\nIGNiLCBuZXdCb29raWUpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2go\nSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0sIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRo\nb2QgYXN5bmNocm9ub3VzbHkgcmVjb3ZlcnMgYSBsZWRnZXIgZnJhZ21lbnQg\nd2hpY2ggaXMgYQogICAgICogY29udGlndW91cyBwb3J0aW9uIG9mIGEgbGVk\nZ2VyIHRoYXQgd2FzIHN0b3JlZCBpbiBhbiBlbnNlbWJsZSB0aGF0CiAgICAg\nKiBpbmNsdWRlZCB0aGUgZmFpbGVkIGJvb2tpZS4KICAgICAqCiAgICAgKiBA\ncGFyYW0gbGgKICAgICAqICAgICAgICAgICAgLSBMZWRnZXJIYW5kbGUgZm9y\nIHRoZSBsZWRnZXIKICAgICAqIEBwYXJhbSBsZWRnZXJGcmFnbWVudAogICAg\nICogICAgICAgICAgICAtIExlZGdlckZyYWdtZW50IHRvIHJlcGxpY2F0ZQog\nICAgICogQHBhcmFtIGxlZGdlckZyYWdtZW50TWNiCiAgICAgKiAgICAgICAg\nICAgIC0gTXVsdGlDYWxsYmFjayB0byBpbnZva2Ugb25jZSB3ZSd2ZSByZWNv\ndmVyZWQgdGhlIGN1cnJlbnQKICAgICAqICAgICAgICAgICAgbGVkZ2VyIGZy\nYWdtZW50LgogICAgICogQHBhcmFtIG5ld0Jvb2tpZQogICAgICogICAgICAg\nICAgICAtIE5ldyBib29raWUgd2Ugd2FudCB0byB1c2UgdG8gcmVjb3ZlciBh\nbmQgcmVwbGljYXRlIHRoZQogICAgICogICAgICAgICAgICBsZWRnZXIgZW50\ncmllcyB0aGF0IHdlcmUgc3RvcmVkIG9uIHRoZSBmYWlsZWQgYm9va2llLgog\nICAgICovCiAgICBwcml2YXRlIHZvaWQgYXN5bmNSZWNvdmVyTGVkZ2VyRnJh\nZ21lbnQoZmluYWwgTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICBmaW5h\nbCBMZWRnZXJGcmFnbWVudCBsZWRnZXJGcmFnbWVudCwKICAgICAgICAgICAg\nZmluYWwgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgbGVkZ2VyRnJhZ21l\nbnRNY2IsCiAgICAgICAgICAgIGZpbmFsIEJvb2tpZVNvY2tldEFkZHJlc3Mg\nbmV3Qm9va2llKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgIGxmci5yZXBsaWNhdGUobGgsIGxlZGdlckZyYWdt\nZW50LCBsZWRnZXJGcmFnbWVudE1jYiwgbmV3Qm9va2llKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFJlcGxpY2F0ZSB0aGUgTGVkZ2VyIGZyYWdtZW50IHRv\nIHRhcmdldCBCb29raWUgcGFzc2VkLgogICAgICoKICAgICAqIEBwYXJhbSBs\naAogICAgICogICAgICAgICAgICAtIGxlZGdlckhhbmRsZQogICAgICogQHBh\ncmFtIGxlZGdlckZyYWdtZW50CiAgICAgKiAgICAgICAgICAgIC0gTGVkZ2Vy\nRnJhZ21lbnQgdG8gcmVwbGljYXRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0Qm9v\na2llQWRkcmVzcwogICAgICogICAgICAgICAgICAtIHRhcmdldCBCb29raWUs\nIHRvIHdoZXJlIGVudHJpZXMgc2hvdWxkIGJlIHJlcGxpY2F0ZWQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIHJlcGxpY2F0ZUxlZGdlckZyYWdtZW50KExl\nZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgZmluYWwgTGVkZ2VyRnJhZ21l\nbnQgbGVkZ2VyRnJhZ21lbnQsCiAgICAgICAgICAgIGZpbmFsIEJvb2tpZVNv\nY2tldEFkZHJlc3MgdGFyZ2V0Qm9va2llQWRkcmVzcykKICAgICAgICAgICAg\ndGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7CiAg\nICAgICAgU3luY0NvdW50ZXIgc3luY0NvdW50ZXIgPSBuZXcgU3luY0NvdW50\nZXIoKTsKICAgICAgICBSZXN1bHRDYWxsQmFjayByZXN1bHRDYWxsQmFjayA9\nIG5ldyBSZXN1bHRDYWxsQmFjayhzeW5jQ291bnRlcik7CiAgICAgICAgU2lu\nZ2xlRnJhZ21lbnRDYWxsYmFjayBjYiA9IG5ldyBTaW5nbGVGcmFnbWVudENh\nbGxiYWNrKHJlc3VsdENhbGxCYWNrLAogICAgICAgICAgICAgICAgbGgsIGxl\nZGdlckZyYWdtZW50LmdldEZpcnN0RW50cnlJZCgpLCBsZWRnZXJGcmFnbWVu\ndAogICAgICAgICAgICAgICAgICAgICAgICAuZ2V0QWRkcmVzcygpLCB0YXJn\nZXRCb29raWVBZGRyZXNzKTsKICAgICAgICBzeW5jQ291bnRlci5pbmMoKTsK\nICAgICAgICBhc3luY1JlY292ZXJMZWRnZXJGcmFnbWVudChsaCwgbGVkZ2Vy\nRnJhZ21lbnQsIGNiLCB0YXJnZXRCb29raWVBZGRyZXNzKTsKICAgICAgICBz\neW5jQ291bnRlci5ibG9jaygwKTsKICAgICAgICBpZiAoc3luY0NvdW50ZXIu\nZ2V0cmMoKSAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAg\nIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShia2MuZ2V0UmV0dXJuUmMoc3lu\nY0NvdW50ZXIuZ2V0cmMoKSkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKiog\nVGhpcyBpcyB0aGUgY2xhc3MgZm9yIGdldHRpbmcgdGhlIHJlcGxpY2F0aW9u\nIHJlc3VsdCAqLwogICAgc3RhdGljIGNsYXNzIFJlc3VsdENhbGxCYWNrIGlt\ncGxlbWVudHMgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgewogICAgICAg\nIHByaXZhdGUgU3luY0NvdW50ZXIgc3luYzsKCiAgICAgICAgcHVibGljIFJl\nc3VsdENhbGxCYWNrKFN5bmNDb3VudGVyIHN5bmMpIHsKICAgICAgICAgICAg\ndGhpcy5zeW5jID0gc3luYzsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBT\ndHJpbmcgcywgT2JqZWN0IG9iaikgewogICAgICAgICAgICBzeW5jLnNldHJj\nKHJjKTsKICAgICAgICAgICAgc3luYy5kZWMoKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBGb3JtYXQgdGhlIEJvb2tLZWVwZXIgbWV0YWRh\ndGEgaW4gem9va2VlcGVyCiAgICAgKgogICAgICogQHBhcmFtIGlzSW50ZXJh\nY3RpdmUKICAgICAqICAgICAgICAgICAgV2hldGhlciBmb3JtYXQgc2hvdWxk\nIGFzayBwcm9tcHQgZm9yIGNvbmZpcm1hdGlvbiBpZiBvbGQgZGF0YQogICAg\nICogICAgICAgICAgICBleGlzdHMgb3Igbm90LgogICAgICogQHBhcmFtIGZv\ncmNlCiAgICAgKiAgICAgICAgICAgIElmIG5vbiBpbnRlcmFjdGl2ZSBhbmQg\nZm9yY2UgaXMgdHJ1ZSwgdGhlbiBvbGQgZGF0YSB3aWxsIGJlCiAgICAgKiAg\nICAgICAgICAgIHJlbW92ZWQgd2l0aG91dCBwcm9tcHQuCiAgICAgKiBAcmV0\ndXJuIFJldHVybnMgdHJ1ZSBpZiBmb3JtYXQgc3VjY2VlZHMgZWxzZSBmYWxz\nZS4KICAgICAqLwogICAgcHVibGljIHN0YXRpYyBib29sZWFuIGZvcm1hdChD\nbGllbnRDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAgICAgIGJvb2xlYW4g\naXNJbnRlcmFjdGl2ZSwgYm9vbGVhbiBmb3JjZSkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgWm9vS2VlcGVyV2F0Y2hlckJhc2UgdyA9IG5ldyBab29L\nZWVwZXJXYXRjaGVyQmFzZShjb25mLmdldFprVGltZW91dCgpKTsKICAgICAg\nICBab29LZWVwZXIgemtjID0gWmtVdGlscy5jcmVhdGVDb25uZWN0ZWRab29r\nZWVwZXJDbGllbnQoCiAgICAgICAgICAgICAgICBjb25mLmdldFprU2VydmVy\ncygpLCB3KTsKICAgICAgICBCb29rS2VlcGVyIGJrYyA9IG51bGw7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYm9vbGVhbiBsZWRnZXJSb290RXhpc3Rz\nID0gbnVsbCAhPSB6a2MuZXhpc3RzKAogICAgICAgICAgICAgICAgICAgIGNv\nbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSwgZmFsc2UpOwogICAgICAgICAg\nICBib29sZWFuIGF2YWlsYWJsZU5vZGVFeGlzdHMgPSBudWxsICE9IHprYy5l\neGlzdHMoCiAgICAgICAgICAgICAgICAgICAgY29uZi5nZXRaa0F2YWlsYWJs\nZUJvb2tpZXNQYXRoKCksIGZhbHNlKTsKCiAgICAgICAgICAgIC8vIENyZWF0\nZSBsZWRnZXJzIHJvb3Qgbm9kZSBpZiBub3QgZXhpc3RzCiAgICAgICAgICAg\nIGlmICghbGVkZ2VyUm9vdEV4aXN0cykgewogICAgICAgICAgICAgICAgemtj\nLmNyZWF0ZShjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCksICIiLmdldEJ5\ndGVzKFVURl84KSwKICAgICAgICAgICAgICAgICAgICAgICAgSWRzLk9QRU5f\nQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJTSVNURU5UKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICAvLyBjcmVhdGUgYXZhaWxhYmxlIGJvb2tpZXMg\nbm9kZSBpZiBub3QgZXhpc3RzCiAgICAgICAgICAgIGlmICghYXZhaWxhYmxl\nTm9kZUV4aXN0cykgewogICAgICAgICAgICAgICAgemtjLmNyZWF0ZShjb25m\nLmdldFprQXZhaWxhYmxlQm9va2llc1BhdGgoKSwgIiIuZ2V0Qnl0ZXMoVVRG\nXzgpLAogICAgICAgICAgICAgICAgICAgICAgICBJZHMuT1BFTl9BQ0xfVU5T\nQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyBJZiBvbGQgZGF0YSB3YXMgdGhlcmUgdGhlbiBjb25m\naXJtIHdpdGggYWRtaW4uCiAgICAgICAgICAgIGlmIChsZWRnZXJSb290RXhp\nc3RzKSB7CiAgICAgICAgICAgICAgICBib29sZWFuIGNvbmZpcm0gPSBmYWxz\nZTsKICAgICAgICAgICAgICAgIGlmICghaXNJbnRlcmFjdGl2ZSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIElmIG5vbiBpbnRlcmFjdGl2ZSBhbmQgZm9y\nY2UgaXMgc2V0LCB0aGVuIGRlbGV0ZSBvbGQKICAgICAgICAgICAgICAgICAg\nICAvLyBkYXRhLgogICAgICAgICAgICAgICAgICAgIGlmIChmb3JjZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBjb25maXJtID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBD\nb25maXJtIHdpdGggdGhlIGFkbWluLgogICAgICAgICAgICAgICAgICAgIGNv\nbmZpcm0gPSBJT1V0aWxzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nY29uZmlybVByb21wdCgiTGVkZ2VyIHJvb3QgYWxyZWFkeSBleGlzdHMuICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyJBcmUgeW91\nIHN1cmUgdG8gZm9ybWF0IGJvb2trZWVwZXIgbWV0YWRhdGE/ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyJUaGlzIG1heSBjYXVz\nZSBkYXRhIGxvc3MuIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBpZiAoIWNvbmZpcm0pIHsKICAgICAgICAgICAgICAgICAgICBMT0cu\nZXJyb3IoIkJvb2tLZWVwZXIgbWV0YWRhdGEgRm9ybWF0IGFib3J0ZWQhISIp\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBia2MgPSBuZXcg\nQm9va0tlZXBlcihjb25mLCB6a2MpOwogICAgICAgICAgICAvLyBGb3JtYXQg\nYWxsIGxlZGdlciBtZXRhZGF0YSBsYXlvdXQKICAgICAgICAgICAgYmtjLmxl\nZGdlck1hbmFnZXJGYWN0b3J5LmZvcm1hdChjb25mLCB6a2MpOwoKICAgICAg\nICAgICAgLy8gQ2xlYXIgdGhlIGNvb2tpZXMKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIFpLVXRpbC5kZWxldGVSZWN1cnNpdmUoemtjLCBj\nb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkKICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiL2Nvb2tpZXMiKTsKICAgICAgICAgICAgfSBjYXRjaCAoS2Vl\ncGVyRXhjZXB0aW9uLk5vTm9kZUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICBMT0cuZGVidWcoImNvb2tpZXMgbm9kZSBub3QgZXhpc3RzIGluIHpv\nb2tlZXBlciB0byBkZWxldGUiKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgLy8gQ2xlYXIgdGhlIElOU1RBTkNFSUQKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIHprYy5kZWxldGUoY29uZi5nZXRaa0xlZGdlcnNS\nb290UGF0aCgpICsgIi8iCiAgICAgICAgICAgICAgICAgICAgICAgICsgQm9v\na0tlZXBlckNvbnN0YW50cy5JTlNUQU5DRUlELCAtMSk7CiAgICAgICAgICAg\nIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJJTlNUQU5DRUlEIG5vdCBl\neGlzdHMgaW4gem9va2VlcGVyIHRvIGRlbGV0ZSIpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBjcmVhdGUgSU5TVEFOQ0VJRAogICAgICAgICAg\nICBTdHJpbmcgaW5zdGFuY2VJZCA9IFVVSUQucmFuZG9tVVVJRCgpLnRvU3Ry\naW5nKCk7CiAgICAgICAgICAgIHprYy5jcmVhdGUoY29uZi5nZXRaa0xlZGdl\ncnNSb290UGF0aCgpICsgIi8iCiAgICAgICAgICAgICAgICAgICAgKyBCb29r\nS2VlcGVyQ29uc3RhbnRzLklOU1RBTkNFSUQsIGluc3RhbmNlSWQuZ2V0Qnl0\nZXMoVVRGXzgpLAogICAgICAgICAgICAgICAgICAgIElkcy5PUEVOX0FDTF9V\nTlNBRkUsIENyZWF0ZU1vZGUuUEVSU0lTVEVOVCk7CgogICAgICAgICAgICBM\nT0cuaW5mbygiU3VjY2Vzc2Z1bGx5IGZvcm1hdHRlZCBCb29rS2VlcGVyIG1l\ndGFkYXRhIik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYg\nKG51bGwgIT0gYmtjKSB7CiAgICAgICAgICAgICAgICBia2MuY2xvc2UoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobnVsbCAhPSB6a2MpIHsK\nICAgICAgICAgICAgICAgIHprYy5jbG9zZSgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIC8qKgog\nICAgICogVGhpcyBtZXRob2QgcmV0dXJucyBhbiBpdGVyYWJsZSBvYmplY3Qg\nZm9yIHRoZSBsaXN0IG9mIGxlZGdlciBpZGVudGlmaWVycyBvZgogICAgICog\ndGhlIGxlZGdlcnMgY3VycmVudGx5IGF2YWlsYWJsZS4KICAgICAqCiAgICAg\nKiBAcmV0dXJuIGFuIGl0ZXJhYmxlIG9iamVjdCBmb3IgdGhlIGxpc3Qgb2Yg\nbGVkZ2VyIGlkZW50aWZpZXJzCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9u\nICBpZiB0aGUgbGlzdCBvZiBsZWRnZXIgaWRlbnRpZmllcnMgY2Fubm90IGJl\nIHJlYWQgZnJvbSB0aGUKICAgICAqICBtZXRhZGF0YSBzdG9yZQogICAgICov\nCiAgICBwdWJsaWMgSXRlcmFibGU8TG9uZz4gbGlzdExlZGdlcnMoKQogICAg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBMZWRnZXJSYW5n\nZUl0ZXJhdG9yIGl0ZXJhdG9yID0gYmtjLmdldExlZGdlck1hbmFnZXIoKS5n\nZXRMZWRnZXJSYW5nZXMoKTsKICAgICAgICByZXR1cm4gbmV3IEl0ZXJhYmxl\nPExvbmc+KCkgewogICAgICAgICAgICBwdWJsaWMgSXRlcmF0b3I8TG9uZz4g\naXRlcmF0b3IoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEl0ZXJh\ndG9yPExvbmc+KCkgewogICAgICAgICAgICAgICAgICAgIEl0ZXJhdG9yPExv\nbmc+IGN1cnJlbnRSYW5nZSA9IG51bGw7CgogICAgICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc05leHQoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlcmF0b3IuaGFzTmV4\ndCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKGN1cnJlbnRSYW5nZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGN1cnJlbnRSYW5nZS5oYXNOZXh0KCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHdoaWxlIGNoZWNraW5nIGlmIHRo\nZXJlIGlzIGEgbmV4dCBlbGVtZW50IiwgZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyBMb25nIG5l\neHQoKQogICAgICAgICAgICAgICAgICAgIHRocm93cyBOb1N1Y2hFbGVtZW50\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5ewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSYW5nZSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVu\ndFJhbmdlID0gaXRlcmF0b3IubmV4dCgpLmdldExlZGdlcnMoKS5pdGVyYXRv\ncigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHdoaWxl\nIHJlYWRpbmcgdGhlIG5leHQgZWxlbWVudCIsIGUpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE5vU3VjaEVsZW1lbnRFeGNlcHRp\nb24oZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudFJhbmdl\nLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHJlbW92ZSgpCiAgICAgICAgICAgICAgICAgICAgdGhyb3dzIFVuc3Vw\ncG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9u\nKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsK\nICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgLyoqCiAgICAg\nKiBAcmV0dXJuIHRoZSBtZXRhZGF0YSBmb3IgdGhlIHBhc3NlZCBsZWRnZXIg\naGFuZGxlCiAgICAgKi8KICAgIHB1YmxpYyBMZWRnZXJNZXRhZGF0YSBnZXRM\nZWRnZXJNZXRhZGF0YShMZWRnZXJIYW5kbGUgbGgpIHsKICAgICAgICByZXR1\ncm4gbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKTsKICAgIH0KfQo=\n","encoding":"base64"}

