{"sha":"3f2580fd2d16de8cd716dad0e5fae608ebd888ac","node_id":"MDQ6QmxvYjE1NzU5NTY6M2YyNTgwZmQyZDE2ZGU4Y2Q3MTZkYWQwZTVmYWU2MDhlYmQ4ODhhYw==","size":11612,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3f2580fd2d16de8cd716dad0e5fae608ebd888ac","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7CgppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nU2V0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5T\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWlj\nQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5B\ndG9taWNJbnRlZ2VyOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRv\nbWljLkF0b21pY0xvbmc7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLm5ldC5Cb29raWVTb2NrZXRBZGRyZXNzOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkJvb2tpZUNsaWVudDsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5SZWFkRW50\ncnlDYWxsYmFjazsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hh\nbm5lbEJ1ZmZlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKkNoZWNrcyB0aGUgY29t\ncGxldGUgbGVkZ2VyIGFuZCBmaW5kcyB0aGUgVW5kZXJSZXBsaWNhdGVkIGZy\nYWdtZW50cyBpZiBhbnkKICovCnB1YmxpYyBjbGFzcyBMZWRnZXJDaGVja2Vy\nIHsKICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dn\nZXJGYWN0b3J5LmdldExvZ2dlcihMZWRnZXJDaGVja2VyLmNsYXNzKTsKCiAg\nICBwdWJsaWMgZmluYWwgQm9va2llQ2xpZW50IGJvb2tpZUNsaWVudDsKCiAg\nICBzdGF0aWMgY2xhc3MgSW52YWxpZEZyYWdtZW50RXhjZXB0aW9uIGV4dGVu\nZHMgRXhjZXB0aW9uIHsKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBs\nb25nIHNlcmlhbFZlcnNpb25VSUQgPSAxNDY3MjAxMjc2NDE3MDYyMzUzTDsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgd2lsbCBjb2xsZWN0IGFsbCB0\naGUgZW50cnkgcmVhZCBjYWxsIGJhY2tzIGFuZCBmaW5hbGx5IGl0IHdpbGwg\nZ2l2ZQogICAgICogY2FsbCBiYWNrIHRvIHByZXZpb3VzIGNhbGwgYmFjayBB\nUEkgd2hpY2ggaXMgd2FpdGluZyBmb3IgaXQgb25jZSBpdCBtZWV0cwogICAg\nICogdGhlIGV4cGVjdGVkIGNhbGwgYmFja3MgZnJvbSBkb3duCiAgICAgKi8K\nICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFJlYWRNYW55RW50cmllc0NhbGxi\nYWNrIGltcGxlbWVudHMgUmVhZEVudHJ5Q2FsbGJhY2sgewogICAgICAgIEF0\nb21pY0Jvb2xlYW4gY29tcGxldGVkID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFs\nc2UpOwogICAgICAgIGZpbmFsIEF0b21pY0xvbmcgbnVtRW50cmllczsKICAg\nICAgICBmaW5hbCBMZWRnZXJGcmFnbWVudCBmcmFnbWVudDsKICAgICAgICBm\naW5hbCBHZW5lcmljQ2FsbGJhY2s8TGVkZ2VyRnJhZ21lbnQ+IGNiOwoKICAg\nICAgICBSZWFkTWFueUVudHJpZXNDYWxsYmFjayhsb25nIG51bUVudHJpZXMs\nIExlZGdlckZyYWdtZW50IGZyYWdtZW50LAogICAgICAgICAgICAgICAgR2Vu\nZXJpY0NhbGxiYWNrPExlZGdlckZyYWdtZW50PiBjYikgewogICAgICAgICAg\nICB0aGlzLm51bUVudHJpZXMgPSBuZXcgQXRvbWljTG9uZyhudW1FbnRyaWVz\nKTsKICAgICAgICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50OwogICAg\nICAgICAgICB0aGlzLmNiID0gY2I7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCByZWFkRW50cnlDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2Vy\nSWQsIGxvbmcgZW50cnlJZCwKICAgICAgICAgICAgICAgIENoYW5uZWxCdWZm\nZXIgYnVmZmVyLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIGlmIChyYyA9\nPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICBpZiAo\nbnVtRW50cmllcy5kZWNyZW1lbnRBbmRHZXQoKSA9PSAwCiAgICAgICAgICAg\nICAgICAgICAgICAgICYmICFjb21wbGV0ZWQuZ2V0QW5kU2V0KHRydWUpKSB7\nCiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUocmMs\nIGZyYWdtZW50KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBl\nbHNlIGlmICghY29tcGxldGVkLmdldEFuZFNldCh0cnVlKSkgewogICAgICAg\nICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUocmMsIGZyYWdtZW50KTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgTGVk\nZ2VyQ2hlY2tlcihCb29rS2VlcGVyIGJrYykgewogICAgICAgIGJvb2tpZUNs\naWVudCA9IGJrYy5nZXRCb29raWVDbGllbnQoKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgdmVyaWZ5TGVkZ2VyRnJhZ21lbnQoTGVkZ2VyRnJhZ21lbnQg\nZnJhZ21lbnQsCiAgICAgICAgICAgIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJG\ncmFnbWVudD4gY2IpIHRocm93cyBJbnZhbGlkRnJhZ21lbnRFeGNlcHRpb24g\newogICAgICAgIGxvbmcgZmlyc3RTdG9yZWQgPSBmcmFnbWVudC5nZXRGaXJz\ndFN0b3JlZEVudHJ5SWQoKTsKICAgICAgICBsb25nIGxhc3RTdG9yZWQgPSBm\ncmFnbWVudC5nZXRMYXN0U3RvcmVkRW50cnlJZCgpOwoKICAgICAgICBpZiAo\nZmlyc3RTdG9yZWQgPT0gTGVkZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQp\nIHsKICAgICAgICAgICAgaWYgKGxhc3RTdG9yZWQgIT0gTGVkZ2VySGFuZGxl\nLklOVkFMSURfRU5UUllfSUQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbnZhbGlkRnJhZ21lbnRFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBjYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5D\nb2RlLk9LLCBmcmFnbWVudCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CiAgICAgICAgaWYgKGZpcnN0U3RvcmVkID09IGxhc3RTdG9yZWQpIHsK\nICAgICAgICAgICAgUmVhZE1hbnlFbnRyaWVzQ2FsbGJhY2sgbWFueWNiID0g\nbmV3IFJlYWRNYW55RW50cmllc0NhbGxiYWNrKDEsCiAgICAgICAgICAgICAg\nICAgICAgZnJhZ21lbnQsIGNiKTsKICAgICAgICAgICAgYm9va2llQ2xpZW50\nLnJlYWRFbnRyeShmcmFnbWVudC5nZXRBZGRyZXNzKCksIGZyYWdtZW50CiAg\nICAgICAgICAgICAgICAgICAgLmdldExlZGdlcklkKCksIGZpcnN0U3RvcmVk\nLCBtYW55Y2IsIG51bGwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIFJlYWRNYW55RW50cmllc0NhbGxiYWNrIG1hbnljYiA9IG5ldyBSZWFkTWFu\neUVudHJpZXNDYWxsYmFjaygyLAogICAgICAgICAgICAgICAgICAgIGZyYWdt\nZW50LCBjYik7CiAgICAgICAgICAgIGJvb2tpZUNsaWVudC5yZWFkRW50cnko\nZnJhZ21lbnQuZ2V0QWRkcmVzcygpLCBmcmFnbWVudAogICAgICAgICAgICAg\nICAgICAgIC5nZXRMZWRnZXJJZCgpLCBmaXJzdFN0b3JlZCwgbWFueWNiLCBu\ndWxsKTsKICAgICAgICAgICAgYm9va2llQ2xpZW50LnJlYWRFbnRyeShmcmFn\nbWVudC5nZXRBZGRyZXNzKCksIGZyYWdtZW50CiAgICAgICAgICAgICAgICAg\nICAgLmdldExlZGdlcklkKCksIGxhc3RTdG9yZWQsIG1hbnljYiwgbnVsbCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ2FsbGJhY2sgZm9y\nIGNoZWNraW5nIHdoZXRoZXIgYW4gZW50cnkgZXhpc3RzIG9yIG5vdC4KICAg\nICAqIEl0IGlzIHVzZWQgdG8gZGlmZmVyZW50aWF0ZSB0aGUgY2FzZXMgd2hl\ncmUgaXQgaGFzIGJlZW4gd3JpdHRlbgogICAgICogYnV0IG5vdyBjYW5ub3Qg\nYmUgcmVhZCwgYW5kIHdoZXJlIGl0IG5ldmVyIGhhcyBiZWVuIHdyaXR0ZW4u\nCiAgICAgKi8KICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIEVudHJ5RXhpc3Rz\nQ2FsbGJhY2sgaW1wbGVtZW50cyBSZWFkRW50cnlDYWxsYmFjayB7CiAgICAg\nICAgQXRvbWljQm9vbGVhbiBlbnRyeU1heUV4aXN0ID0gbmV3IEF0b21pY0Jv\nb2xlYW4oZmFsc2UpOwogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgbnVt\nUmVhZHM7CiAgICAgICAgZmluYWwgR2VuZXJpY0NhbGxiYWNrPEJvb2xlYW4+\nIGNiOwoKICAgICAgICBFbnRyeUV4aXN0c0NhbGxiYWNrKGludCBudW1SZWFk\ncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEdlbmVyaWNDYWxsYmFj\nazxCb29sZWFuPiBjYikgewogICAgICAgICAgICB0aGlzLm51bVJlYWRzID0g\nbmV3IEF0b21pY0ludGVnZXIobnVtUmVhZHMpOwogICAgICAgICAgICB0aGlz\nLmNiID0gY2I7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCByZWFk\nRW50cnlDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50\ncnlJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBD\naGFubmVsQnVmZmVyIGJ1ZmZlciwgT2JqZWN0IGN0eCkgewogICAgICAgICAg\nICBpZiAoQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hFbnRyeUV4Y2VwdGlvbiAh\nPSByYyAmJgogICAgICAgICAgICAgICAgQktFeGNlcHRpb24uQ29kZS5Ob1N1\nY2hMZWRnZXJFeGlzdHNFeGNlcHRpb24gIT0gcmMpIHsKICAgICAgICAgICAg\nICAgIGVudHJ5TWF5RXhpc3Quc2V0KHRydWUpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBpZiAobnVtUmVhZHMuZGVjcmVtZW50QW5kR2V0KCkgPT0g\nMCkgewogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUocmMs\nIGVudHJ5TWF5RXhpc3QuZ2V0KCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGhpcyB3aWxsIGNvbGxlY3QgYWxs\nIHRoZSBmcmFnbWVudCByZWFkIGNhbGwgYmFja3MgYW5kIGZpbmFsbHkgaXQg\nd2lsbAogICAgICogZ2l2ZSBjYWxsIGJhY2sgdG8gYWJvdmUgY2FsbCBiYWNr\nIEFQSSB3aGljaCBpcyB3YWl0aW5nIGZvciBpdCBvbmNlIGl0CiAgICAgKiBt\nZWV0cyB0aGUgZXhwZWN0ZWQgY2FsbCBiYWNrcyBmcm9tIGRvd24KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgRnVsbExlZGdlckNhbGxiYWNr\nIGltcGxlbWVudHMKICAgICAgICAgICAgR2VuZXJpY0NhbGxiYWNrPExlZGdl\nckZyYWdtZW50PiB7CiAgICAgICAgZmluYWwgU2V0PExlZGdlckZyYWdtZW50\nPiBiYWRGcmFnbWVudHM7CiAgICAgICAgZmluYWwgQXRvbWljTG9uZyBudW1G\ncmFnbWVudHM7CiAgICAgICAgZmluYWwgR2VuZXJpY0NhbGxiYWNrPFNldDxM\nZWRnZXJGcmFnbWVudD4+IGNiOwoKICAgICAgICBGdWxsTGVkZ2VyQ2FsbGJh\nY2sobG9uZyBudW1GcmFnbWVudHMsCiAgICAgICAgICAgICAgICBHZW5lcmlj\nQ2FsbGJhY2s8U2V0PExlZGdlckZyYWdtZW50Pj4gY2IpIHsKICAgICAgICAg\nICAgYmFkRnJhZ21lbnRzID0gbmV3IEhhc2hTZXQ8TGVkZ2VyRnJhZ21lbnQ+\nKCk7CiAgICAgICAgICAgIHRoaXMubnVtRnJhZ21lbnRzID0gbmV3IEF0b21p\nY0xvbmcobnVtRnJhZ21lbnRzKTsKICAgICAgICAgICAgdGhpcy5jYiA9IGNi\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29t\ncGxldGUoaW50IHJjLCBMZWRnZXJGcmFnbWVudCByZXN1bHQpIHsKICAgICAg\nICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuQ2xpZW50Q2xvc2Vk\nRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25Db21w\nbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLkNsaWVudENsb3NlZEV4Y2VwdGlvbiwg\nYmFkRnJhZ21lbnRzKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfSBlbHNlIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7\nCiAgICAgICAgICAgICAgICBiYWRGcmFnbWVudHMuYWRkKHJlc3VsdCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG51bUZyYWdtZW50cy5kZWNy\nZW1lbnRBbmRHZXQoKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBjYi5vcGVy\nYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9LLCBiYWRGcmFnbWVu\ndHMpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQ2hlY2sgdGhhdCBhbGwgdGhlIGZyYWdtZW50cyBpbiB0aGUgcGFz\nc2VkIGluIGxlZGdlciwgYW5kIHJlcG9ydCB0aG9zZQogICAgICogd2hpY2gg\nYXJlIG1pc3NpbmcuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNoZWNrTGVk\nZ2VyKExlZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxTZXQ8TGVkZ2VyRnJhZ21lbnQ+\nPiBjYikgewogICAgICAgIC8vIGJ1aWxkIGEgc2V0IG9mIGFsbCBmcmFnbWVu\ndCByZXBsaWNhcwogICAgICAgIGZpbmFsIFNldDxMZWRnZXJGcmFnbWVudD4g\nZnJhZ21lbnRzID0gbmV3IEhhc2hTZXQ8TGVkZ2VyRnJhZ21lbnQ+KCk7Cgog\nICAgICAgIExvbmcgY3VyRW50cnlJZCA9IG51bGw7CiAgICAgICAgQXJyYXlM\naXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+IGN1ckVuc2VtYmxlID0gbnVsbDsK\nICAgICAgICBmb3IgKE1hcC5FbnRyeTxMb25nLCBBcnJheUxpc3Q8Qm9va2ll\nU29ja2V0QWRkcmVzcz4+IGUgOiBsaAogICAgICAgICAgICAgICAgLmdldExl\nZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkuZW50cnlTZXQoKSkgewog\nICAgICAgICAgICBpZiAoY3VyRW50cnlJZCAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGN1ckVuc2VtYmxlLnNpemUo\nKTsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnRzLmFkZChu\nZXcgTGVkZ2VyRnJhZ21lbnQobGgsIGN1ckVudHJ5SWQsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBlLmdldEtleSgpIC0gMSwgaSkpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGN1ckVudHJ5\nSWQgPSBlLmdldEtleSgpOwogICAgICAgICAgICBjdXJFbnNlbWJsZSA9IGUu\nZ2V0VmFsdWUoKTsKICAgICAgICB9CgogICAgICAgIC8qIENoZWNraW5nIHRo\nZSBsYXN0IHNlZ21lbnQgb2YgdGhlIGxlZGdlciBjYW4gYmUgY29tcGxpY2F0\nZWQgaW4gc29tZSBjYXNlcy4KICAgICAgICAgKiBJbiB0aGUgY2FzZSB0aGF0\nIHRoZSBsZWRnZXIgaXMgY2xvc2VkLCB3ZSBjYW4ganVzdCBjaGVjayB0aGUg\nZnJhZ21lbnRzIG9mCiAgICAgICAgICogdGhlIHNlZ21lbnQgYXMgbm9ybWFs\nLCBleGNlcHQgaW4gdGhlIGNhc2UgdGhhdCBubyBlbnRyeSB3YXMgZXZlciB3\ncml0dGVuLAogICAgICAgICAqIHRvIHRoZSBsZWRnZXIsIGluIHdoaWNoIGNh\nc2Ugd2UgY2hlY2sgbm8gZnJhZ21lbnRzLgogICAgICAgICAqIEluIHRoZSBj\nYXNlIHRoYXQgdGhlIGxlZGdlciBpcyBvcGVuLCBidXQgZW5vdWdoIGVudHJp\nZXMgaGF2ZSBiZWVuIHdyaXR0ZW4sCiAgICAgICAgICogZm9yIGxhc3RBZGRD\nb25maXJtZWQgdG8gYmUgc2V0IGFib3ZlIHRoZSBzdGFydCBlbnRyeSBvZiB0\naGUgc2VnbWVudCwgd2UKICAgICAgICAgKiBjYW4gYWxzbyBjaGVjayBhcyBu\nb3JtYWwuCiAgICAgICAgICogSG93ZXZlciwgaWYgbGFzdEFkZENvbmZpcm1l\nZCBjYW5ub3QgYmUgdHJ1c3RlZCwgc3VjaCBhcyB3aGVuIGl0J3MgbG93ZXIg\ndGhhbgogICAgICAgICAqIHRoZSBmaXJzdCBlbnRyeSBpZCwgb3Igbm90IHNl\ndCBhdCBhbGwsIHdlIGNhbm5vdCBiZSBzdXJlIGlmIHRoZXJlIGhhcyBiZWVu\nCiAgICAgICAgICogZGF0YSB3cml0dGVuIHRvIHRoZSBzZWdtZW50LiBGb3Ig\ndGhpcyByZWFzb24sIHdlIGhhdmUgdG8gc2VuZCBhIHJlYWQgcmVxdWVzdAog\nICAgICAgICAqIHRvIHRoZSBib29raWVzIHdoaWNoIHNob3VsZCBoYXZlIHRo\nZSBmaXJzdCBlbnRyeS4gSWYgdGhleSByZXNwb25kIHdpdGgKICAgICAgICAg\nKiBOb1N1Y2hFbnRyeSB3ZSBjYW4gYXNzdW1lIGl0IHdhcyBuZXZlciB3cml0\ndGVuLiBJZiB0aGV5IHJlc3BvbmQgd2l0aCBhbnl0aGluZwogICAgICAgICAq\nIGVsc2UsIHdlIG11c3QgYXNzdW1lIHRoZSBlbnRyeSBoYXMgYmVlbiB3cml0\ndGVuLCBzbyB3ZSBydW4gdGhlIGNoZWNrLgogICAgICAgICAqLwogICAgICAg\nIGlmIChjdXJFbnRyeUlkICE9IG51bGwgJiYgIShsaC5nZXRMZWRnZXJNZXRh\nZGF0YSgpLmlzQ2xvc2VkKCkgJiYgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgp\nIDwgY3VyRW50cnlJZCkpIHsKICAgICAgICAgICAgbG9uZyBsYXN0RW50cnkg\nPSBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCk7CgogICAgICAgICAgICBpZiAo\nbGFzdEVudHJ5IDwgY3VyRW50cnlJZCkgewogICAgICAgICAgICAgICAgbGFz\ndEVudHJ5ID0gY3VyRW50cnlJZDsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgZmluYWwgU2V0PExlZGdlckZyYWdtZW50PiBmaW5hbFNlZ21lbnRGcmFn\nbWVudHMgPSBuZXcgSGFzaFNldDxMZWRnZXJGcmFnbWVudD4oKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjdXJFbnNlbWJsZS5zaXplKCk7\nIGkrKykgewogICAgICAgICAgICAgICAgZmluYWxTZWdtZW50RnJhZ21lbnRz\nLmFkZChuZXcgTGVkZ2VyRnJhZ21lbnQobGgsIGN1ckVudHJ5SWQsCiAgICAg\nICAgICAgICAgICAgICAgICAgIGxhc3RFbnRyeSwgaSkpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICAvLyBDaGVjayBmb3IgdGhlIGNhc2UgdGhhdCBu\nbyBsYXN0IGNvbmZpcm1lZCBlbnRyeSBoYXMKICAgICAgICAgICAgLy8gYmVl\nbiBzZXQuCiAgICAgICAgICAgIGlmIChjdXJFbnRyeUlkID09IGxhc3RFbnRy\neSkgewogICAgICAgICAgICAgICAgZmluYWwgbG9uZyBlbnRyeVRvUmVhZCA9\nIGN1ckVudHJ5SWQ7CgogICAgICAgICAgICAgICAgRW50cnlFeGlzdHNDYWxs\nYmFjayBlZWNiCiAgICAgICAgICAgICAgICAgICAgPSBuZXcgRW50cnlFeGlz\ndHNDYWxsYmFjayhsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldFdyaXRlUXVv\ncnVtU2l6ZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3IEdlbmVyaWNDYWxsYmFjazxCb29sZWFuPigpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21wbGV0ZShpbnQgcmMsIEJv\nb2xlYW4gcmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZyYWdtZW50cy5hZGRBbGwoZmluYWxTZWdtZW50RnJhZ21lbnRz\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBjaGVja0ZyYWdtZW50cyhmcmFnbWVu\ndHMsIGNiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBiaSA6IGxoLmdldERpc3RyaWJ1dGlvblNjaGVkdWxlKCkuZ2V0V3JpdGVT\nZXQoZW50cnlUb1JlYWQpKSB7CiAgICAgICAgICAgICAgICAgICAgQm9va2ll\nU29ja2V0QWRkcmVzcyBhZGRyID0gY3VyRW5zZW1ibGUuZ2V0KGJpKTsKICAg\nICAgICAgICAgICAgICAgICBib29raWVDbGllbnQucmVhZEVudHJ5KGFkZHIs\nIGxoLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBlbnRyeVRvUmVhZCwgZWVjYiwgbnVsbCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmcmFnbWVudHMuYWRkQWxsKGZp\nbmFsU2VnbWVudEZyYWdtZW50cyk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIGNoZWNrRnJhZ21lbnRzKGZyYWdtZW50cywgY2IpOwogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBjaGVja0ZyYWdtZW50cyhTZXQ8TGVkZ2Vy\nRnJhZ21lbnQ+IGZyYWdtZW50cywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBHZW5lcmljQ2FsbGJhY2s8U2V0PExlZGdlckZyYWdtZW50Pj4g\nY2IpIHsKICAgICAgICBpZiAoZnJhZ21lbnRzLnNpemUoKSA9PSAwKSB7IC8v\nIG5vIGZyYWdtZW50cyB0byB2ZXJpZnkKICAgICAgICAgICAgY2Iub3BlcmF0\naW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgZnJhZ21lbnRzKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gdmVy\naWZ5IGFsbCB0aGUgY29sbGVjdGVkIGZyYWdtZW50IHJlcGxpY2FzCiAgICAg\nICAgRnVsbExlZGdlckNhbGxiYWNrIGFsbEZyYWdtZW50c0NiID0gbmV3IEZ1\nbGxMZWRnZXJDYWxsYmFjayhmcmFnbWVudHMKICAgICAgICAgICAgICAgIC5z\naXplKCksIGNiKTsKICAgICAgICBmb3IgKExlZGdlckZyYWdtZW50IHIgOiBm\ncmFnbWVudHMpIHsKICAgICAgICAgICAgTE9HLmRlYnVnKCJDaGVja2luZyBm\ncmFnbWVudCB7fSIsIHIpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgdmVyaWZ5TGVkZ2VyRnJhZ21lbnQociwgYWxsRnJhZ21lbnRzQ2Ip\nOwogICAgICAgICAgICB9IGNhdGNoIChJbnZhbGlkRnJhZ21lbnRFeGNlcHRp\nb24gaWZlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkludmFsaWQg\nZnJhZ21lbnQgZm91bmQgOiB7fSIsIHIpOwogICAgICAgICAgICAgICAgYWxs\nRnJhZ21lbnRzQ2Iub3BlcmF0aW9uQ29tcGxldGUoCiAgICAgICAgICAgICAg\nICAgICAgICAgIEJLRXhjZXB0aW9uLkNvZGUuSW5jb3JyZWN0UGFyYW1ldGVy\nRXhjZXB0aW9uLCByKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nfQo=\n","encoding":"base64"}

