{"sha":"4501524ae849472ae8405afdbc940f4ad0341a89","node_id":"MDQ6QmxvYjE1NzU5NTY6NDUwMTUyNGFlODQ5NDcyYWU4NDA1YWZkYmM5NDBmNGFkMDM0MWE4OQ==","size":19385,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4501524ae849472ae8405afdbc940f4ad0341a89","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7CgppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5FbnVt\nZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2\nYS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7\nCgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0Nh\nbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5uZXQuQm9va2llU29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29raWVQcm90b2NvbDsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5N\ndWx0aUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNhbGxiYWNr\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuT3JkZXJlZFNh\nZmVFeGVjdXRvci5PcmRlcmVkU2FmZUdlbmVyaWNDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLkFzeW5jQ2FsbGJhY2s7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb24uQ29kZTsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcjsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2Vy\nRmFjdG9yeTsKCi8qKgogKiBUaGlzIGlzIHRoZSBoZWxwZXIgY2xhc3MgZm9y\nIHJlcGxpY2F0aW5nIHRoZSBmcmFnbWVudHMgZnJvbSBvbmUgYm9va2llIHRv\nCiAqIGFub3RoZXIKICovCnB1YmxpYyBjbGFzcyBMZWRnZXJGcmFnbWVudFJl\ncGxpY2F0b3IgewoKICAgIC8vIEJvb2tLZWVwZXIgaW5zdGFuY2UKICAgIHBy\naXZhdGUgQm9va0tlZXBlciBia2M7CgogICAgcHVibGljIExlZGdlckZyYWdt\nZW50UmVwbGljYXRvcihCb29rS2VlcGVyIGJrYykgewogICAgICAgIHRoaXMu\nYmtjID0gYmtjOwogICAgfQoKICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExv\nZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAgICAgICAgIC5nZXRMb2dn\nZXIoTGVkZ2VyRnJhZ21lbnRSZXBsaWNhdG9yLmNsYXNzKTsKCiAgICBwcml2\nYXRlIHZvaWQgcmVwbGljYXRlRnJhZ21lbnRJbnRlcm5hbChmaW5hbCBMZWRn\nZXJIYW5kbGUgbGgsCiAgICAgICAgICAgIGZpbmFsIExlZGdlckZyYWdtZW50\nIGxmLAogICAgICAgICAgICBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxs\nYmFjayBsZWRnZXJGcmFnbWVudE1jYiwKICAgICAgICAgICAgZmluYWwgQm9v\na2llU29ja2V0QWRkcmVzcyBuZXdCb29raWUpIHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFsZi5pc0Nsb3NlZCgpKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiVHJ5aW5nIHRvIHJlcGxpY2F0ZSBhbiB1\nbmNsb3NlZCBmcmFnbWVudDsiCiAgICAgICAgICAgICAgICAgICAgICArICIg\nVGhpcyBpcyBub3Qgc2FmZSB7fSIsIGxmKTsKICAgICAgICAgICAgbGVkZ2Vy\nRnJhZ21lbnRNY2IucHJvY2Vzc1Jlc3VsdChCS0V4Y2VwdGlvbi5Db2RlLlVu\nY2xvc2VkRnJhZ21lbnRFeGNlcHRpb24sCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVsbCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgTG9uZyBzdGFydEVudHJ5\nSWQgPSBsZi5nZXRGaXJzdFN0b3JlZEVudHJ5SWQoKTsKICAgICAgICBMb25n\nIGVuZEVudHJ5SWQgPSBsZi5nZXRMYXN0U3RvcmVkRW50cnlJZCgpOwogICAg\nICAgIGlmIChlbmRFbnRyeUlkID09IG51bGwpIHsKICAgICAgICAgICAgLyoK\nICAgICAgICAgICAgICogSWRlYWxseSB0aGlzIHNob3VsZCBuZXZlciBoYXBw\nZW4gaWYgYm9va2llIGZhaWx1cmUgaXMgdGFrZW4gY2FyZQogICAgICAgICAg\nICAgKiBvZiBwcm9wZXJseS4gTm90aGluZyB3ZSBjYW4gZG8gdGhvdWdoIGlu\nIHRoaXMgY2FzZS4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIExPRy53\nYXJuKCJEZWFkIGJvb2tpZSAoIiArIGxmLmdldEFkZHJlc3MoKQogICAgICAg\nICAgICAgICAgICAgICsgIikgaXMgc3RpbGwgcGFydCBvZiB0aGUgY3VycmVu\ndCIKICAgICAgICAgICAgICAgICAgICArICIgYWN0aXZlIGVuc2VtYmxlIGZv\nciBsZWRnZXJJZDogIiArIGxoLmdldElkKCkpOwogICAgICAgICAgICBsZWRn\nZXJGcmFnbWVudE1jYi5wcm9jZXNzUmVzdWx0KEJLRXhjZXB0aW9uLkNvZGUu\nT0ssIG51bGwsIG51bGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQogICAgICAgIGlmIChzdGFydEVudHJ5SWQgPiBlbmRFbnRyeUlkKSB7CiAg\nICAgICAgICAgIC8vIGZvciBvcGVuIGxlZGdlciB3aGljaCB0aGVyZSBpcyBu\nbyBlbnRyeSwgdGhlIHN0YXJ0IGVudHJ5IGlkIGlzIDAsCiAgICAgICAgICAg\nIC8vIHRoZSBlbmQgZW50cnkgaWQgaXMgLTEuCiAgICAgICAgICAgIC8vIHdl\nIGNhbiByZXR1cm4gaW1tZWRpYXRlbHkgdG8gdHJpZ2dlciBmb3J3YXJkIHJl\nYWQKICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRNY2IucHJvY2Vzc1Jlc3Vs\ndChCS0V4Y2VwdGlvbi5Db2RlLk9LLCBudWxsLCBudWxsKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAgKiBB\nZGQgYWxsIHRoZSBlbnRyaWVzIHRvIGVudHJpZXNUb1JlcGxpY2F0ZSBsaXN0\nIGZyb20KICAgICAgICAgKiBmaXJzdFN0b3JlZEVudHJ5SWQgdG8gbGFzdFN0\nb3JlZEVudHJ5SUQuCiAgICAgICAgICovCiAgICAgICAgTGlzdDxMb25nPiBl\nbnRyaWVzVG9SZXBsaWNhdGUgPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwog\nICAgICAgIGxvbmcgbGFzdFN0b3JlZEVudHJ5SWQgPSBsZi5nZXRMYXN0U3Rv\ncmVkRW50cnlJZCgpOwogICAgICAgIGZvciAobG9uZyBpID0gbGYuZ2V0Rmly\nc3RTdG9yZWRFbnRyeUlkKCk7IGkgPD0gbGFzdFN0b3JlZEVudHJ5SWQ7IGkr\nKykgewogICAgICAgICAgICBlbnRyaWVzVG9SZXBsaWNhdGUuYWRkKGkpOwog\nICAgICAgIH0KICAgICAgICAvKgogICAgICAgICAqIE5vdyBhc3luY2hyb25v\ndXNseSByZXBsaWNhdGUgYWxsIG9mIHRoZSBlbnRyaWVzIGZvciB0aGUgbGVk\nZ2VyCiAgICAgICAgICogZnJhZ21lbnQgdGhhdCB3ZXJlIG9uIHRoZSBkZWFk\nIGJvb2tpZS4KICAgICAgICAgKi8KICAgICAgICBNdWx0aUNhbGxiYWNrIGxl\nZGdlckZyYWdtZW50RW50cnlNY2IgPSBuZXcgTXVsdGlDYWxsYmFjaygKICAg\nICAgICAgICAgICAgIGVudHJpZXNUb1JlcGxpY2F0ZS5zaXplKCksIGxlZGdl\nckZyYWdtZW50TWNiLCBudWxsLCBCS0V4Y2VwdGlvbi5Db2RlLk9LLAogICAg\nICAgICAgICAgICAgQktFeGNlcHRpb24uQ29kZS5MZWRnZXJSZWNvdmVyeUV4\nY2VwdGlvbik7CiAgICAgICAgZm9yIChmaW5hbCBMb25nIGVudHJ5SWQgOiBl\nbnRyaWVzVG9SZXBsaWNhdGUpIHsKICAgICAgICAgICAgcmVjb3ZlckxlZGdl\nckZyYWdtZW50RW50cnkoZW50cnlJZCwgbGgsIGxlZGdlckZyYWdtZW50RW50\ncnlNY2IsCiAgICAgICAgICAgICAgICAgICAgbmV3Qm9va2llKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCByZXBsaWNh\ndGUgYSBsZWRnZXIgZnJhZ21lbnQgd2hpY2ggaXMgYSBjb250aWd1b3VzIHBv\ncnRpb24gb2YKICAgICAqIGEgbGVkZ2VyIHRoYXQgd2FzIHN0b3JlZCBpbiBh\nbiBlbnNlbWJsZSB0aGF0IGluY2x1ZGVkIHRoZSBmYWlsZWQgYm9va2llLgog\nICAgICogSXQgd2lsbCBTcGxpdHMgdGhlIGZyYWdtZW50IGludG8gbXVsdGlw\nbGUgc3ViIGZyYWdtZW50cyBieSBrZWVwaW5nIHRoZQogICAgICogbWF4IGVu\ndHJpZXMgdXAgdG8gdGhlIGNvbmZpZ3VyZWQgdmFsdWUgb2YgcmVyZXBsaWNh\ndGlvbkVudHJ5QmF0Y2hTaXplIGFuZAogICAgICogdGhlbiBpdCByZS1yZXBs\naWNhdGVzIHRoYXQgYmF0Y2hlZCBlbnRyeSBmcmFnbWVudHMgb25lIGJ5IG9u\nZS4gQWZ0ZXIKICAgICAqIHJlLXJlcGxpY2F0aW9uIG9mIGFsbCBiYXRjaGVk\nIGVudHJ5IGZyYWdtZW50cywgaXQgd2lsbCB1cGRhdGUgdGhlCiAgICAgKiBl\nbnNlbWJsZSBpbmZvIHdpdGggbmV3IEJvb2tpZSBvbmNlCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBsaAogICAgICogICAgICAgICAgICBMZWRnZXJIYW5kbGUg\nZm9yIHRoZSBsZWRnZXIKICAgICAqIEBwYXJhbSBsZgogICAgICogICAgICAg\nICAgICBMZWRnZXJGcmFnbWVudCB0byByZXBsaWNhdGUKICAgICAqIEBwYXJh\nbSBsZWRnZXJGcmFnbWVudE1jYgogICAgICogICAgICAgICAgICBNdWx0aUNh\nbGxiYWNrIHRvIGludm9rZSBvbmNlIHdlJ3ZlIHJlY292ZXJlZCB0aGUgY3Vy\ncmVudAogICAgICogICAgICAgICAgICBsZWRnZXIgZnJhZ21lbnQuCiAgICAg\nKiBAcGFyYW0gdGFyZ2V0Qm9va2llQWRkcmVzcwogICAgICogICAgICAgICAg\nICBOZXcgYm9va2llIHdlIHdhbnQgdG8gdXNlIHRvIHJlY292ZXIgYW5kIHJl\ncGxpY2F0ZSB0aGUgbGVkZ2VyCiAgICAgKiAgICAgICAgICAgIGVudHJpZXMg\ndGhhdCB3ZXJlIHN0b3JlZCBvbiB0aGUgZmFpbGVkIGJvb2tpZS4KICAgICAq\nLwogICAgdm9pZCByZXBsaWNhdGUoZmluYWwgTGVkZ2VySGFuZGxlIGxoLCBm\naW5hbCBMZWRnZXJGcmFnbWVudCBsZiwKICAgICAgICAgICAgZmluYWwgQXN5\nbmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgbGVkZ2VyRnJhZ21lbnRNY2IsCiAg\nICAgICAgICAgIGZpbmFsIEJvb2tpZVNvY2tldEFkZHJlc3MgdGFyZ2V0Qm9v\na2llQWRkcmVzcykKICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhj\nZXB0aW9uIHsKICAgICAgICBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IHBhcnRpb25l\nZEZyYWdtZW50cyA9IHNwbGl0SW50b1N1YkZyYWdtZW50cyhsaCwgbGYsCiAg\nICAgICAgICAgICAgICBia2MuZ2V0Q29uZigpLmdldFJlcmVwbGljYXRpb25F\nbnRyeUJhdGNoU2l6ZSgpKTsKICAgICAgICBMT0cuaW5mbygiRnJhZ21lbnQg\nOiIgKyBsZiArICIgaXMgc3BsaXQgaW50byBzdWIgZnJhZ21lbnRzIDoiCiAg\nICAgICAgICAgICAgICArIHBhcnRpb25lZEZyYWdtZW50cyk7CiAgICAgICAg\ncmVwbGljYXRlTmV4dEJhdGNoKGxoLCBwYXJ0aW9uZWRGcmFnbWVudHMuaXRl\ncmF0b3IoKSwKICAgICAgICAgICAgICAgIGxlZGdlckZyYWdtZW50TWNiLCB0\nYXJnZXRCb29raWVBZGRyZXNzKTsKICAgIH0KCiAgICAvKiogUmVwbGljYXRl\nIHRoZSBiYXRjaGVkIGVudHJ5IGZyYWdtZW50cyBvbmUgYWZ0ZXIgb3RoZXIg\nKi8KICAgIHByaXZhdGUgdm9pZCByZXBsaWNhdGVOZXh0QmF0Y2goZmluYWwg\nTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICBmaW5hbCBJdGVyYXRvcjxM\nZWRnZXJGcmFnbWVudD4gZnJhZ21lbnRzLAogICAgICAgICAgICBmaW5hbCBB\nc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBsZWRnZXJGcmFnbWVudE1jYiwK\nICAgICAgICAgICAgZmluYWwgQm9va2llU29ja2V0QWRkcmVzcyB0YXJnZXRC\nb29raWVBZGRyZXNzKSB7CiAgICAgICAgaWYgKGZyYWdtZW50cy5oYXNOZXh0\nKCkpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJlcGxp\nY2F0ZUZyYWdtZW50SW50ZXJuYWwobGgsIGZyYWdtZW50cy5uZXh0KCksCiAg\nICAgICAgICAgICAgICAgICAgICAgIG5ldyBBc3luY0NhbGxiYWNrLlZvaWRD\nYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\ncHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyB2LCBPYmplY3QgY3R4KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRNY2IucHJvY2Vzc1Jlc3VsdChy\nYywgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXBsaWNhdGVOZXh0QmF0Y2gobGgsIGZyYWdtZW50cywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJGcmFn\nbWVudE1jYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0YXJnZXRCb29raWVBZGRyZXNzKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgICAgICB9LCB0YXJnZXRCb29raWVB\nZGRyZXNzKTsKICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRNY2Iu\ncHJvY2Vzc1Jlc3VsdCgKICAgICAgICAgICAgICAgICAgICAgICAgQktFeGNl\ncHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgbnVsbCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVy\ncnVwdCgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgbGVkZ2VyRnJhZ21lbnRNY2IucHJvY2Vzc1Jlc3VsdChCS0V4Y2Vw\ndGlvbi5Db2RlLk9LLCBudWxsLCBudWxsKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBTcGxpdCB0aGUgZnVsbCBmcmFnbWVudCBpbnRvIGJh\ndGNoZWQgZW50cnkgZnJhZ21lbnRzIGJ5IGtlZXBpbmcKICAgICAqIHJlcmVw\nbGljYXRpb25FbnRyeUJhdGNoU2l6ZSBvZiBlbnRyaWVzIGluIGVhY2ggb25l\nIGFuZCBjYW4gdHJlYXQgdGhlbSBhcwogICAgICogc3ViIGZyYWdtZW50cwog\nICAgICovCiAgICBzdGF0aWMgU2V0PExlZGdlckZyYWdtZW50PiBzcGxpdElu\ndG9TdWJGcmFnbWVudHMoTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICBM\nZWRnZXJGcmFnbWVudCBsZWRnZXJGcmFnbWVudCwgbG9uZyByZXJlcGxpY2F0\naW9uRW50cnlCYXRjaFNpemUpIHsKICAgICAgICBTZXQ8TGVkZ2VyRnJhZ21l\nbnQ+IGZyYWdtZW50cyA9IG5ldyBIYXNoU2V0PExlZGdlckZyYWdtZW50Pigp\nOwogICAgICAgIGlmIChyZXJlcGxpY2F0aW9uRW50cnlCYXRjaFNpemUgPD0g\nMCkgewogICAgICAgICAgICAvLyByZXJlcGxpY2F0aW9uRW50cnlCYXRjaFNp\nemUgY2FuIG5vdCBiZSAwIG9yIGxlc3MgdGhhbiAwLAogICAgICAgICAgICAv\nLyByZXR1cm5pbmcgd2l0aCB0aGUgY3VycmVudCBmcmFnbWVudAogICAgICAg\nICAgICBmcmFnbWVudHMuYWRkKGxlZGdlckZyYWdtZW50KTsKICAgICAgICAg\nICAgcmV0dXJuIGZyYWdtZW50czsKICAgICAgICB9CgogICAgICAgIGxvbmcg\nZmlyc3RFbnRyeUlkID0gbGVkZ2VyRnJhZ21lbnQuZ2V0Rmlyc3RTdG9yZWRF\nbnRyeUlkKCk7CiAgICAgICAgbG9uZyBsYXN0RW50cnlJZCA9IGxlZGdlckZy\nYWdtZW50LmdldExhc3RTdG9yZWRFbnRyeUlkKCk7CiAgICAgICAgbG9uZyBu\ndW1iZXJPZkVudHJpZXNUb1JlcGxpY2F0ZSA9IChsYXN0RW50cnlJZCAtIGZp\ncnN0RW50cnlJZCkgKyAxOwogICAgICAgIGxvbmcgc3BsaXRzV2l0aEZ1bGxF\nbnRyaWVzID0gbnVtYmVyT2ZFbnRyaWVzVG9SZXBsaWNhdGUKICAgICAgICAg\nICAgICAgIC8gcmVyZXBsaWNhdGlvbkVudHJ5QmF0Y2hTaXplOwoKICAgICAg\nICBpZiAoc3BsaXRzV2l0aEZ1bGxFbnRyaWVzID09IDApIHsvLyBvbmx5IG9u\nZSBmcmFnbWVudAogICAgICAgICAgICBmcmFnbWVudHMuYWRkKGxlZGdlckZy\nYWdtZW50KTsKICAgICAgICAgICAgcmV0dXJuIGZyYWdtZW50czsKICAgICAg\nICB9CgogICAgICAgIGxvbmcgZnJhZ21lbnRTcGxpdExhc3RFbnRyeSA9IDA7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzcGxpdHNXaXRoRnVsbEVu\ndHJpZXM7IGkrKykgewogICAgICAgICAgICBmcmFnbWVudFNwbGl0TGFzdEVu\ndHJ5ID0gKGZpcnN0RW50cnlJZCArIHJlcmVwbGljYXRpb25FbnRyeUJhdGNo\nU2l6ZSkgLSAxOwogICAgICAgICAgICBmcmFnbWVudHMuYWRkKG5ldyBMZWRn\nZXJGcmFnbWVudChsaCwgZmlyc3RFbnRyeUlkLAogICAgICAgICAgICAgICAg\nICAgIGZyYWdtZW50U3BsaXRMYXN0RW50cnksIGxlZGdlckZyYWdtZW50Lmdl\ndEJvb2tpZXNJbmRleCgpKSk7CiAgICAgICAgICAgIGZpcnN0RW50cnlJZCA9\nIGZyYWdtZW50U3BsaXRMYXN0RW50cnkgKyAxOwogICAgICAgIH0KCiAgICAg\nICAgbG9uZyBsYXN0U3BsaXRXaXRoUGFydGlhbEVudHJpZXMgPSBudW1iZXJP\nZkVudHJpZXNUb1JlcGxpY2F0ZQogICAgICAgICAgICAgICAgJSByZXJlcGxp\nY2F0aW9uRW50cnlCYXRjaFNpemU7CiAgICAgICAgaWYgKGxhc3RTcGxpdFdp\ndGhQYXJ0aWFsRW50cmllcyA+IDApIHsKICAgICAgICAgICAgZnJhZ21lbnRz\nLmFkZChuZXcgTGVkZ2VyRnJhZ21lbnQobGgsIGZpcnN0RW50cnlJZCwgZmly\nc3RFbnRyeUlkCiAgICAgICAgICAgICAgICAgICAgKyBsYXN0U3BsaXRXaXRo\nUGFydGlhbEVudHJpZXMgLSAxLCBsZWRnZXJGcmFnbWVudAogICAgICAgICAg\nICAgICAgICAgIC5nZXRCb29raWVzSW5kZXgoKSkpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZnJhZ21lbnRzOwogICAgfQoKICAgIC8qKgogICAgICog\nVGhpcyBtZXRob2QgYXN5bmNocm9ub3VzbHkgcmVjb3ZlcnMgYSBzcGVjaWZp\nYyBsZWRnZXIgZW50cnkgYnkgcmVhZGluZwogICAgICogdGhlIHZhbHVlcyB2\naWEgdGhlIEJvb2tLZWVwZXIgQ2xpZW50ICh3aGljaCB3b3VsZCByZWFkIGl0\nIGZyb20gdGhlIG90aGVyCiAgICAgKiByZXBsaWNhcykgYW5kIHRoZW4gd3Jp\ndGluZyBpdCB0byB0aGUgY2hvc2VuIG5ldyBib29raWUuCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBlbnRyeUlkCiAgICAgKiAgICAgICAgICAgIExlZGdlciBF\nbnRyeSBJRCB0byByZWNvdmVyLgogICAgICogQHBhcmFtIGxoCiAgICAgKiAg\nICAgICAgICAgIExlZGdlckhhbmRsZSBmb3IgdGhlIGxlZGdlcgogICAgICog\nQHBhcmFtIGxlZGdlckZyYWdtZW50RW50cnlNY2IKICAgICAqICAgICAgICAg\nICAgTXVsdGlDYWxsYmFjayB0byBpbnZva2Ugb25jZSB3ZSd2ZSByZWNvdmVy\nZWQgdGhlIGN1cnJlbnQKICAgICAqICAgICAgICAgICAgbGVkZ2VyIGVudHJ5\nLgogICAgICogQHBhcmFtIG5ld0Jvb2tpZQogICAgICogICAgICAgICAgICBO\nZXcgYm9va2llIHdlIHdhbnQgdG8gdXNlIHRvIHJlY292ZXIgYW5kIHJlcGxp\nY2F0ZSB0aGUgbGVkZ2VyCiAgICAgKiAgICAgICAgICAgIGVudHJpZXMgdGhh\ndCB3ZXJlIHN0b3JlZCBvbiB0aGUgZmFpbGVkIGJvb2tpZS4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlY292ZXJMZWRnZXJGcmFnbWVudEVudHJ5KGZp\nbmFsIExvbmcgZW50cnlJZCwKICAgICAgICAgICAgZmluYWwgTGVkZ2VySGFu\nZGxlIGxoLAogICAgICAgICAgICBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRD\nYWxsYmFjayBsZWRnZXJGcmFnbWVudEVudHJ5TWNiLAogICAgICAgICAgICBm\naW5hbCBCb29raWVTb2NrZXRBZGRyZXNzIG5ld0Jvb2tpZSkgdGhyb3dzIElu\ndGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAvKgogICAgICAgICAqIFJl\nYWQgdGhlIGxlZGdlciBlbnRyeSB1c2luZyB0aGUgTGVkZ2VySGFuZGxlLiBU\naGlzIHdpbGwgYWxsb3cgdXMgdG8KICAgICAgICAgKiByZWFkIHRoZSBlbnRy\neSBmcm9tIG9uZSBvZiB0aGUgb3RoZXIgcmVwbGljYXRlZCBib29raWVzIG90\naGVyIHRoYW4KICAgICAgICAgKiB0aGUgZGVhZCBvbmUuCiAgICAgICAgICov\nCiAgICAgICAgbGguYXN5bmNSZWFkRW50cmllcyhlbnRyeUlkLCBlbnRyeUlk\nLCBuZXcgUmVhZENhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgcmVhZENvbXBsZXRlKGludCByYywg\nTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICAgICAgICAgIEVudW1lcmF0\naW9uPExlZGdlckVudHJ5PiBzZXEsIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJCSyBlcnJvciByZWFkaW5nIGxl\nZGdlciBlbnRyeTogIiArIGVudHJ5SWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpKTsKICAgICAgICAgICAg\nICAgICAgICBsZWRnZXJGcmFnbWVudEVudHJ5TWNiLnByb2Nlc3NSZXN1bHQo\ncmMsIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8qCiAgICAgICAg\nICAgICAgICAgKiBOb3cgdGhhdCB3ZSd2ZSByZWFkIHRoZSBsZWRnZXIgZW50\ncnksIHdyaXRlIGl0IHRvIHRoZSBuZXcKICAgICAgICAgICAgICAgICAqIGJv\nb2tpZSB3ZSd2ZSBzZWxlY3RlZC4KICAgICAgICAgICAgICAgICAqLwogICAg\nICAgICAgICAgICAgTGVkZ2VyRW50cnkgZW50cnkgPSBzZXEubmV4dEVsZW1l\nbnQoKTsKICAgICAgICAgICAgICAgIGJ5dGVbXSBkYXRhID0gZW50cnkuZ2V0\nRW50cnkoKTsKICAgICAgICAgICAgICAgIENoYW5uZWxCdWZmZXIgdG9TZW5k\nID0gbGguZ2V0RGlnZXN0TWFuYWdlcigpCiAgICAgICAgICAgICAgICAgICAg\nICAgIC5jb21wdXRlRGlnZXN0QW5kUGFja2FnZUZvclNlbmRpbmcoZW50cnlJ\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaC5nZXRMYXN0\nQWRkQ29uZmlybWVkKCksIGVudHJ5LmdldExlbmd0aCgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGRhdGEsIDAsIGRhdGEubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIGJrYy5nZXRCb29raWVDbGllbnQoKS5hZGRFbnRy\neShuZXdCb29raWUsIGxoLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgIGxoLmdldExlZGdlcktleSgpLCBlbnRyeUlkLCB0b1NlbmQsCiAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBXcml0ZUNhbGxiYWNrKCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCB3cml0ZUNvbXBsZXRlKGlu\ndCByYywgbG9uZyBsZWRnZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9uZyBlbnRyeUlkLCBCb29raWVTb2NrZXRBZGRyZXNz\nIGFkZHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9i\namVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAocmMgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkJLIGVycm9yIHdy\naXRpbmcgZW50cnkgZm9yIGxlZGdlcklkOiAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGxlZGdlcklk\nICsgIiwgZW50cnlJZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyBlbnRyeUlkICsgIiwgYm9va2ll\nOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIGFkZHIsIEJLRXhjZXB0aW9uCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY3JlYXRl\nKHJjKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKExP\nRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlN1Y2Nlc3Mgd3JpdGluZyBs\nZWRnZXIgaWQgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIGxlZGdlcklkICsgIiwgZW50cnkgaWQgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nIGVudHJ5SWQgKyAiIHRvIGEgbmV3IGJvb2tpZSAiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgYWRkciArICIh\nIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKiBQYXNzIHRoZSByZXR1cm4gY29kZSByZXN1bHQgdXAgdGhl\nIGNoYWluIHdpdGgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKiB0aGUgcGFyZW50IGNhbGxiYWNrLgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxlZGdlckZyYWdtZW50RW50cnlNY2IucHJvY2Vzc1Jlc3VsdChyYywgbnVs\nbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICB9LCBudWxsLCBCb29raWVQcm90b2NvbC5GTEFHX1JF\nQ09WRVJZX0FERCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBudWxsKTsK\nICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBDYWxsYmFjayBmb3IgcmVjb3Zl\ncnkgb2YgYSBzaW5nbGUgbGVkZ2VyIGZyYWdtZW50LiBPbmNlIHRoZSBmcmFn\nbWVudCBoYXMKICAgICAqIGhhZCBhbGwgZW50cmllcyByZXBsaWNhdGVkLCB1\ncGRhdGUgdGhlIGVuc2VtYmxlIGluIHpvb2tlZXBlci4gT25jZQogICAgICog\nZmluaXNoZWQgcHJvcG9nYXRlIGNhbGxiYWNrIHVwIHRvIGxlZGdlckZyYWdt\nZW50c01jYiB3aGljaCBzaG91bGQgYmUgYQogICAgICogbXVsdGljYWxsYmFj\nayByZXNwb25zaWJsZSBmb3IgYWxsIGZyYWdtZW50cyBpbiBhIHNpbmdsZSBs\nZWRnZXIKICAgICAqLwogICAgc3RhdGljIGNsYXNzIFNpbmdsZUZyYWdtZW50\nQ2FsbGJhY2sgaW1wbGVtZW50cyBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFj\nayB7CiAgICAgICAgZmluYWwgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sg\nbGVkZ2VyRnJhZ21lbnRzTWNiOwogICAgICAgIGZpbmFsIExlZGdlckhhbmRs\nZSBsaDsKICAgICAgICBmaW5hbCBsb25nIGZyYWdtZW50U3RhcnRJZDsKICAg\nICAgICBmaW5hbCBCb29raWVTb2NrZXRBZGRyZXNzIG9sZEJvb2tpZTsKICAg\nICAgICBmaW5hbCBCb29raWVTb2NrZXRBZGRyZXNzIG5ld0Jvb2tpZTsKCiAg\nICAgICAgU2luZ2xlRnJhZ21lbnRDYWxsYmFjayhBc3luY0NhbGxiYWNrLlZv\naWRDYWxsYmFjayBsZWRnZXJGcmFnbWVudHNNY2IsCiAgICAgICAgICAgICAg\nICBMZWRnZXJIYW5kbGUgbGgsIGxvbmcgZnJhZ21lbnRTdGFydElkLAogICAg\nICAgICAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBvbGRCb29raWUsIEJv\nb2tpZVNvY2tldEFkZHJlc3MgbmV3Qm9va2llKSB7CiAgICAgICAgICAgIHRo\naXMubGVkZ2VyRnJhZ21lbnRzTWNiID0gbGVkZ2VyRnJhZ21lbnRzTWNiOwog\nICAgICAgICAgICB0aGlzLmxoID0gbGg7CiAgICAgICAgICAgIHRoaXMuZnJh\nZ21lbnRTdGFydElkID0gZnJhZ21lbnRTdGFydElkOwogICAgICAgICAgICB0\naGlzLm5ld0Jvb2tpZSA9IG5ld0Jvb2tpZTsKICAgICAgICAgICAgdGhpcy5v\nbGRCb29raWUgPSBvbGRCb29raWU7CiAgICAgICAgfQoKICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCBy\nYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgaWYg\nKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiQksgZXJyb3IgcmVwbGljYXRpbmcgbGVkZ2VyIGZyYWdt\nZW50cyBmb3IgbGVkZ2VyOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsg\nbGguZ2V0SWQoKSwgQktFeGNlcHRpb24uY3JlYXRlKHJjKSk7CiAgICAgICAg\nICAgICAgICBsZWRnZXJGcmFnbWVudHNNY2IucHJvY2Vzc1Jlc3VsdChyYywg\nbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgdXBkYXRlRW5zZW1ibGVJbmZvKGxlZGdlckZy\nYWdtZW50c01jYiwgZnJhZ21lbnRTdGFydElkLCBsaCwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9sZEJvb2tpZSwgbmV3Qm9v\na2llKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqIFVwZGF0ZXMgdGhlIGVu\nc2VtYmxlIHdpdGggbmV3Qm9va2llIGFuZCBub3RpZnkgdGhlIGVuc2VtYmxl\nVXBkYXRlZENiICovCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHVwZGF0ZUVu\nc2VtYmxlSW5mbygKICAgICAgICAgICAgQXN5bmNDYWxsYmFjay5Wb2lkQ2Fs\nbGJhY2sgZW5zZW1ibGVVcGRhdGVkQ2IsIGxvbmcgZnJhZ21lbnRTdGFydElk\nLAogICAgICAgICAgICBMZWRnZXJIYW5kbGUgbGgsIEJvb2tpZVNvY2tldEFk\nZHJlc3Mgb2xkQm9va2llLAogICAgICAgICAgICBCb29raWVTb2NrZXRBZGRy\nZXNzIG5ld0Jvb2tpZSkgewogICAgICAgIC8qCiAgICAgICAgICogVXBkYXRl\nIHRoZSBsZWRnZXIgbWV0YWRhdGEncyBlbnNlbWJsZSBpbmZvIHRvIHBvaW50\nIHRvIHRoZSBuZXcKICAgICAgICAgKiBib29raWUuCiAgICAgICAgICovCiAg\nICAgICAgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+IGVuc2VtYmxl\nID0gbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKQogICAgICAgICAgICAgICAgLmdl\ndEVuc2VtYmxlcygpLmdldChmcmFnbWVudFN0YXJ0SWQpOwogICAgICAgIGlu\ndCBkZWFkQm9va2llSW5kZXggPSBlbnNlbWJsZS5pbmRleE9mKG9sZEJvb2tp\nZSk7CiAgICAgICAgZW5zZW1ibGUucmVtb3ZlKGRlYWRCb29raWVJbmRleCk7\nCiAgICAgICAgZW5zZW1ibGUuYWRkKGRlYWRCb29raWVJbmRleCwgbmV3Qm9v\na2llKTsKICAgICAgICBsaC53cml0ZUxlZGdlckNvbmZpZyhuZXcgVXBkYXRl\nRW5zZW1ibGVDYihlbnNlbWJsZVVwZGF0ZWRDYiwKICAgICAgICAgICAgICAg\nIGZyYWdtZW50U3RhcnRJZCwgbGgsIG9sZEJvb2tpZSwgbmV3Qm9va2llKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGVuc2VtYmxlIGRh\ndGEgd2l0aCBuZXdCb29raWUuIHJlLXJlYWRzIHRoZSBtZXRhZGF0YSBvbgog\nICAgICogTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uIGFuZCB1cGRhdGUgZW5z\nZW1ibGUgYWdhaW4uIE9uIHN1Y2Nlc3NmdWxsCiAgICAgKiB1cGRhdGlvbiwg\naXQgd2lsbCBhbHNvIG5vdGlmeSB0byBzdXBlciBjYWxsIGJhY2sKICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgVXBkYXRlRW5zZW1ibGVDYiBp\nbXBsZW1lbnRzIEdlbmVyaWNDYWxsYmFjazxWb2lkPiB7CiAgICAgICAgZmlu\nYWwgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgZW5zZW1ibGVVcGRhdGVk\nQ2I7CiAgICAgICAgZmluYWwgTGVkZ2VySGFuZGxlIGxoOwogICAgICAgIGZp\nbmFsIGxvbmcgZnJhZ21lbnRTdGFydElkOwogICAgICAgIGZpbmFsIEJvb2tp\nZVNvY2tldEFkZHJlc3Mgb2xkQm9va2llOwogICAgICAgIGZpbmFsIEJvb2tp\nZVNvY2tldEFkZHJlc3MgbmV3Qm9va2llOwoKICAgICAgICBwdWJsaWMgVXBk\nYXRlRW5zZW1ibGVDYihBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBsZWRn\nZXJGcmFnbWVudHNNY2IsCiAgICAgICAgICAgICAgICBsb25nIGZyYWdtZW50\nU3RhcnRJZCwgTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICAgICAgQm9v\na2llU29ja2V0QWRkcmVzcyBvbGRCb29raWUsIEJvb2tpZVNvY2tldEFkZHJl\nc3MgbmV3Qm9va2llKSB7CiAgICAgICAgICAgIHRoaXMuZW5zZW1ibGVVcGRh\ndGVkQ2IgPSBsZWRnZXJGcmFnbWVudHNNY2I7CiAgICAgICAgICAgIHRoaXMu\nbGggPSBsaDsKICAgICAgICAgICAgdGhpcy5mcmFnbWVudFN0YXJ0SWQgPSBm\ncmFnbWVudFN0YXJ0SWQ7CiAgICAgICAgICAgIHRoaXMubmV3Qm9va2llID0g\nbmV3Qm9va2llOwogICAgICAgICAgICB0aGlzLm9sZEJvb2tpZSA9IG9sZEJv\nb2tpZTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgVm9pZCByZXN1\nbHQpIHsKICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUu\nTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICBM\nT0cud2FybigiVHdvIGZyYWdtZW50cyBhdHRlbXB0ZWQgdXBkYXRlIGF0IG9u\nY2U7IGxlZGdlciBpZDogIgogICAgICAgICAgICAgICAgICAgICAgICArIGxo\nLmdldElkKCkgKyAiIHN0YXJ0aWQ6ICIgKyBmcmFnbWVudFN0YXJ0SWQpOwog\nICAgICAgICAgICAgICAgLy8gdHJ5IGFnYWluLCB0aGUgcHJldmlvdXMgc3Vj\nY2VzcyAod2l0aCB3aGljaCB0aGlzIGhhcwogICAgICAgICAgICAgICAgLy8g\nY29uZmxpY3RlZCkgd2lsbCBoYXZlIHVwZGF0ZWQgdGhlIHN0YXQgb3RoZXIg\nb3BlcmF0aW9ucwogICAgICAgICAgICAgICAgLy8gc3VjaCBhcyAoYWRkRW5z\nZW1ibGUpIHdvdWxkIHVwZGF0ZSBpdCB0b28uCiAgICAgICAgICAgICAgICBs\naAogICAgICAgICAgICAgICAgICAgICAgICAucmVyZWFkTWV0YWRhdGEobmV3\nIE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrPExlZGdlck1ldGFkYXRhPigK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaC5iay5tYWluV29y\na2VyUG9vbCwgbGguZ2V0SWQoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzYWZlT3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJNZXRhZGF0\nYSBuZXdNZXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVycm9yKCJFcnJvciByZWFk\naW5nIHVwZGF0ZWQgbGVkZ2VyIG1ldGFkYXRhIGZvciBsZWRnZXIgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyBsaC5nZXRJZCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZW5zZW1ibGVVcGRhdGVkQ2IucHJvY2Vzc1Jlc3VsdChyYywg\nbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\naC5tZXRhZGF0YSA9IG5ld01ldGE7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHVwZGF0ZUVuc2VtYmxlSW5mbyhlbnNlbWJsZVVwZGF0\nZWRDYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmcmFnbWVudFN0YXJ0SWQsIGxoLCBvbGRCb29raWUsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3Qm9va2ll\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVs\nc2UgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRXJyb3IgdXBkYXRpbmcgbGVkZ2VyIGNvbmZp\nZyBtZXRhZGF0YSBmb3IgbGVkZ2VySWQgIgogICAgICAgICAgICAgICAgICAg\nICAgICArIGxoLmdldElkKCkgKyAiIDogIiArIEJLRXhjZXB0aW9uLmdldE1l\nc3NhZ2UocmMpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIExPRy5pbmZvKCJVcGRhdGVkIFpLIGZvciBsZWRnZXJJZDogKCIgKyBs\naC5nZXRJZCgpICsgIiA6ICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBm\ncmFnbWVudFN0YXJ0SWQKICAgICAgICAgICAgICAgICAgICAgICAgKyAiKSB0\nbyBwb2ludCBsZWRnZXIgZnJhZ21lbnRzIGZyb20gb2xkIGRlYWQgYm9va2ll\nOiAoIgogICAgICAgICAgICAgICAgICAgICAgICArIG9sZEJvb2tpZSArICIp\nIHRvIG5ldyBib29raWU6ICgiICsgbmV3Qm9va2llICsgIikiKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBQYXNzIHRo\nZSByZXR1cm4gY29kZSByZXN1bHQgdXAgdGhlIGNoYWluIHdpdGggdGhlIHBh\ncmVudAogICAgICAgICAgICAgKiBjYWxsYmFjay4KICAgICAgICAgICAgICov\nCiAgICAgICAgICAgIGVuc2VtYmxlVXBkYXRlZENiLnByb2Nlc3NSZXN1bHQo\ncmMsIG51bGwsIG51bGwpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

