{"sha":"7204d6cbb2795f5503a3ad8a38407bbc5cd84ee6","node_id":"MDQ6QmxvYjE1NzU5NTY6NzIwNGQ2Y2JiMjc5NWY1NTAzYTNhZDhhMzg0MDdiYmM1Y2Q4NGVlNg==","size":46729,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7204d6cbb2795f5503a3ad8a38407bbc5cd84ee6","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudDsKCmlt\ncG9ydCBzdGF0aWMgY29tLmdvb2dsZS5jb21tb24uYmFzZS5DaGFyc2V0cy5V\nVEZfODsKCmltcG9ydCBqYXZhLnNlY3VyaXR5LkdlbmVyYWxTZWN1cml0eUV4\nY2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0aW9u\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuUXVl\ndWU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50TGlu\na2VkUXVldWU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5SZWplY3Rl\nZEV4ZWN1dGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LmF0b21pYy5BdG9taWNCb29sZWFuOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuYXRvbWljLkF0b21pY0ludGVnZXI7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLkFkZENhbGxi\nYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3lu\nY0NhbGxiYWNrLkNsb3NlQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suUmVhZENhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxi\nYWNrLlJlYWRMYXN0Q29uZmlybWVkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5uZXQuQm9va2llU29ja2V0\nQWRkcmVzczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5C\nb29raWVQcm90b2NvbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxi\nYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFG\nb3JtYXRzLkxlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnN0YXRzLkNvdW50ZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuc3RhdHMuR2F1Z2U7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIudXRpbC5PcmRlcmVkU2FmZUV4ZWN1dG9yLk9yZGVy\nZWRTYWZlR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnV0aWwuU2FmZVJ1bm5hYmxlOwppbXBvcnQgb3JnLmpib3NzLm5l\ndHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVyOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0\nIGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVudC5SYXRlTGltaXRl\ncjsKCi8qKgogKiBMZWRnZXIgaGFuZGxlIGNvbnRhaW5zIGxlZGdlciBtZXRh\nZGF0YSBhbmQgaXMgdXNlZCB0byBhY2Nlc3MgdGhlIHJlYWQgYW5kCiAqIHdy\naXRlIG9wZXJhdGlvbnMgdG8gYSBsZWRnZXIuCiAqLwpwdWJsaWMgY2xhc3Mg\nTGVkZ2VySGFuZGxlIHsKICAgIGZpbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0g\nTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTGVkZ2VySGFuZGxlLmNsYXNzKTsK\nCiAgICBmaW5hbCBieXRlW10gbGVkZ2VyS2V5OwogICAgTGVkZ2VyTWV0YWRh\ndGEgbWV0YWRhdGE7CiAgICBmaW5hbCBCb29rS2VlcGVyIGJrOwogICAgZmlu\nYWwgbG9uZyBsZWRnZXJJZDsKICAgIGxvbmcgbGFzdEFkZFB1c2hlZDsKICAg\nIGxvbmcgbGFzdEFkZENvbmZpcm1lZDsKICAgIGxvbmcgbGVuZ3RoOwogICAg\nZmluYWwgRGlnZXN0TWFuYWdlciBtYWNNYW5hZ2VyOwogICAgZmluYWwgRGlz\ndHJpYnV0aW9uU2NoZWR1bGUgZGlzdHJpYnV0aW9uU2NoZWR1bGU7CgogICAg\nZmluYWwgUmF0ZUxpbWl0ZXIgdGhyb3R0bGVyOwoKICAgIC8qKgogICAgICog\nSW52YWxpZCBlbnRyeSBpZC4gVGhpcyB2YWx1ZSBpcyByZXR1cm5lZCBmcm9t\nIG1ldGhvZHMgd2hpY2gKICAgICAqIHNob3VsZCByZXR1cm4gYW4gZW50cnkg\naWQgYnV0IHRoZXJlIGlzIG5vIHZhbGlkIGVudHJ5IGF2YWlsYWJsZS4KICAg\nICAqLwogICAgZmluYWwgc3RhdGljIHB1YmxpYyBsb25nIElOVkFMSURfRU5U\nUllfSUQgPSBCb29raWVQcm90b2NvbC5JTlZBTElEX0VOVFJZX0lEOwoKICAg\nIGZpbmFsIEF0b21pY0ludGVnZXIgYmxvY2tBZGRDb21wbGV0aW9ucyA9IG5l\ndyBBdG9taWNJbnRlZ2VyKDApOwogICAgZmluYWwgUXVldWU8UGVuZGluZ0Fk\nZE9wPiBwZW5kaW5nQWRkT3BzID0gbmV3IENvbmN1cnJlbnRMaW5rZWRRdWV1\nZTxQZW5kaW5nQWRkT3A+KCk7CgogICAgZmluYWwgQ291bnRlciBlbnNlbWJs\nZUNoYW5nZUNvdW50ZXI7CiAgICBmaW5hbCBDb3VudGVyIGxhY1VwZGF0ZUhp\ndHNDb3VudGVyOwogICAgZmluYWwgQ291bnRlciBsYWNVcGRhdGVNaXNzZXND\nb3VudGVyOwoKICAgIExlZGdlckhhbmRsZShCb29rS2VlcGVyIGJrLCBsb25n\nIGxlZGdlcklkLCBMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YSwKICAgICAgICAg\nICAgICAgICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUsIGJ5dGVbXSBwYXNzd29y\nZCkKICAgICAgICAgICAgdGhyb3dzIEdlbmVyYWxTZWN1cml0eUV4Y2VwdGlv\nbiwgTnVtYmVyRm9ybWF0RXhjZXB0aW9uIHsKICAgICAgICB0aGlzLmJrID0g\nYms7CiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IG1ldGFkYXRhOwoKICAgICAg\nICBpZiAobWV0YWRhdGEuaXNDbG9zZWQoKSkgewogICAgICAgICAgICBsYXN0\nQWRkQ29uZmlybWVkID0gbGFzdEFkZFB1c2hlZCA9IG1ldGFkYXRhLmdldExh\nc3RFbnRyeUlkKCk7CiAgICAgICAgICAgIGxlbmd0aCA9IG1ldGFkYXRhLmdl\ndExlbmd0aCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxhc3RB\nZGRDb25maXJtZWQgPSBsYXN0QWRkUHVzaGVkID0gSU5WQUxJRF9FTlRSWV9J\nRDsKICAgICAgICAgICAgbGVuZ3RoID0gMDsKICAgICAgICB9CgogICAgICAg\nIHRoaXMubGVkZ2VySWQgPSBsZWRnZXJJZDsKCiAgICAgICAgdGhpcy50aHJv\ndHRsZXIgPSBSYXRlTGltaXRlci5jcmVhdGUoYmsuZ2V0Q29uZigpLmdldFRo\ncm90dGxlVmFsdWUoKSk7CgogICAgICAgIG1hY01hbmFnZXIgPSBEaWdlc3RN\nYW5hZ2VyLmluc3RhbnRpYXRlKGxlZGdlcklkLCBwYXNzd29yZCwgZGlnZXN0\nVHlwZSk7CiAgICAgICAgdGhpcy5sZWRnZXJLZXkgPSBNYWNEaWdlc3RNYW5h\nZ2VyLmdlbkRpZ2VzdCgibGVkZ2VyIiwgcGFzc3dvcmQpOwogICAgICAgIGRp\nc3RyaWJ1dGlvblNjaGVkdWxlID0gbmV3IFJvdW5kUm9iaW5EaXN0cmlidXRp\nb25TY2hlZHVsZSgKICAgICAgICAgICAgICAgIG1ldGFkYXRhLmdldFdyaXRl\nUXVvcnVtU2l6ZSgpLCBtZXRhZGF0YS5nZXRBY2tRdW9ydW1TaXplKCksIG1l\ndGFkYXRhLmdldEVuc2VtYmxlU2l6ZSgpKTsKCiAgICAgICAgZW5zZW1ibGVD\naGFuZ2VDb3VudGVyID0gYmsuZ2V0U3RhdHNMb2dnZXIoKS5nZXRDb3VudGVy\nKEJvb2tLZWVwZXJDbGllbnRTdGF0cy5FTlNFTUJMRV9DSEFOR0VTKTsKICAg\nICAgICBsYWNVcGRhdGVIaXRzQ291bnRlciA9IGJrLmdldFN0YXRzTG9nZ2Vy\nKCkuZ2V0Q291bnRlcihCb29rS2VlcGVyQ2xpZW50U3RhdHMuTEFDX1VQREFU\nRV9ISVRTKTsKICAgICAgICBsYWNVcGRhdGVNaXNzZXNDb3VudGVyID0gYmsu\nZ2V0U3RhdHNMb2dnZXIoKS5nZXRDb3VudGVyKEJvb2tLZWVwZXJDbGllbnRT\ndGF0cy5MQUNfVVBEQVRFX01JU1NFUyk7CiAgICAgICAgYmsuZ2V0U3RhdHNM\nb2dnZXIoKS5yZWdpc3RlckdhdWdlKEJvb2tLZWVwZXJDbGllbnRTdGF0cy5Q\nRU5ESU5HX0FERFMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG5ldyBHYXVnZTxJbnRlZ2VyPigpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyBJbnRl\nZ2VyIGdldERlZmF1bHRWYWx1ZSgpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyBJbnRlZ2VyIGdldFNhbXBsZSgpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGVuZGlu\nZ0FkZE9wcy5zaXplKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogR2V0\nIHRoZSBpZCBvZiB0aGUgY3VycmVudCBsZWRnZXIKICAgICAqCiAgICAgKiBA\ncmV0dXJuIHRoZSBpZCBvZiB0aGUgbGVkZ2VyCiAgICAgKi8KICAgIHB1Ymxp\nYyBsb25nIGdldElkKCkgewogICAgICAgIHJldHVybiBsZWRnZXJJZDsKICAg\nIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgbGFzdCBjb25maXJtZWQgZW50\ncnkgaWQgb24gdGhpcyBsZWRnZXIuIEl0IHJlYWRzCiAgICAgKiB0aGUgbG9j\nYWwgc3RhdGUgb2YgdGhlIGxlZGdlciBoYW5kbGUsIHdoaWNoIGlzIGRpZmZl\ncmVudAogICAgICogZnJvbSB0aGUgcmVhZExhc3RDb25maXJtZWQgY2FsbC4g\nSW4gdGhlIGNhc2UgdGhlIGxlZGdlcgogICAgICogaXMgbm90IGNsb3NlZCBh\nbmQgdGhlIGNsaWVudCBpcyBhIHJlYWRlciwgaXQgaXMgbmVjZXNzYXJ5CiAg\nICAgKiB0byBjYWxsIHJlYWRMYXN0Q29uZmlybWVkIHRvIG9idGFpbiBhbiBl\nc3RpbWF0ZSBvZiB0aGUKICAgICAqIGxhc3QgYWRkIG9wZXJhdGlvbiB0aGF0\nIGhhcyBiZWVuIGNvbmZpcm1lZC4KICAgICAqCiAgICAgKiBAc2VlICNyZWFk\nTGFzdENvbmZpcm1lZCgpCiAgICAgKgogICAgICogQHJldHVybiB0aGUgbGFz\ndCBjb25maXJtZWQgZW50cnkgaWQgb3Ige0BsaW5rICNJTlZBTElEX0VOVFJZ\nX0lEIElOVkFMSURfRU5UUllfSUR9IGlmIG5vIGVudHJ5IGhhcyBiZWVuIGNv\nbmZpcm1lZAogICAgICovCiAgICBwdWJsaWMgbG9uZyBnZXRMYXN0QWRkQ29u\nZmlybWVkKCkgewogICAgICAgIHJldHVybiBsYXN0QWRkQ29uZmlybWVkOwog\nICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBlbnRyeSBpZCBvZiB0aGUg\nbGFzdCBlbnRyeSB0aGF0IGhhcyBiZWVuIGVucXVldWVkIGZvciBhZGRpdGlv\nbiAoYnV0CiAgICAgKiBtYXkgbm90IGhhdmUgcG9zc2libHkgYmVlbiBwZXJz\naXRlZCB0byB0aGUgbGVkZ2VyKQogICAgICoKICAgICAqIEByZXR1cm4gdGhl\nIGlkIG9mIHRoZSBsYXN0IGVudHJ5IHB1c2hlZCBvciB7QGxpbmsgI0lOVkFM\nSURfRU5UUllfSUQgSU5WQUxJRF9FTlRSWV9JRH0gaWYgbm8gZW50cnkgaGFz\nIGJlZW4gcHVzaGVkCiAgICAgKi8KICAgIHN5bmNocm9uaXplZCBwdWJsaWMg\nbG9uZyBnZXRMYXN0QWRkUHVzaGVkKCkgewogICAgICAgIHJldHVybiBsYXN0\nQWRkUHVzaGVkOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBMZWRn\nZXIncyBrZXkvcGFzc3dvcmQuCiAgICAgKgogICAgICogQHJldHVybiBieXRl\nIGFycmF5IGZvciB0aGUgbGVkZ2VyJ3Mga2V5L3Bhc3N3b3JkLgogICAgICov\nCiAgICBwdWJsaWMgYnl0ZVtdIGdldExlZGdlcktleSgpIHsKICAgICAgICBy\nZXR1cm4gQXJyYXlzLmNvcHlPZihsZWRnZXJLZXksIGxlZGdlcktleS5sZW5n\ndGgpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBMZWRnZXJNZXRh\nZGF0YQogICAgICoKICAgICAqIEByZXR1cm4gTGVkZ2VyTWV0YWRhdGEgZm9y\nIHRoZSBMZWRnZXJIYW5kbGUKICAgICAqLwogICAgTGVkZ2VyTWV0YWRhdGEg\nZ2V0TGVkZ2VyTWV0YWRhdGEoKSB7CiAgICAgICAgcmV0dXJuIG1ldGFkYXRh\nOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBEaWdlc3RNYW5hZ2Vy\nCiAgICAgKgogICAgICogQHJldHVybiBEaWdlc3RNYW5hZ2VyIGZvciB0aGUg\nTGVkZ2VySGFuZGxlCiAgICAgKi8KICAgIERpZ2VzdE1hbmFnZXIgZ2V0RGln\nZXN0TWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gbWFjTWFuYWdlcjsKICAg\nIH0KCiAgICAvKioKICAgICAqICBBZGQgdG8gdGhlIGxlbmd0aCBvZiB0aGUg\nbGVkZ2VyIGluIGJ5dGVzLgogICAgICoKICAgICAqIEBwYXJhbSBkZWx0YQog\nICAgICogQHJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBsZWRnZXIgYWZ0ZXIg\ndGhlIGFkZGl0aW9uCiAgICAgKi8KICAgIGxvbmcgYWRkVG9MZW5ndGgobG9u\nZyBkZWx0YSkgewogICAgICAgIHRoaXMubGVuZ3RoICs9IGRlbHRhOwogICAg\nICAgIHJldHVybiB0aGlzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFJldHVybnMgdGhlIGxlbmd0aCBvZiB0aGUgbGVkZ2VyIGluIGJ5dGVzLgog\nICAgICoKICAgICAqIEByZXR1cm4gdGhlIGxlbmd0aCBvZiB0aGUgbGVkZ2Vy\nIGluIGJ5dGVzCiAgICAgKi8KICAgIHN5bmNocm9uaXplZCBwdWJsaWMgbG9u\nZyBnZXRMZW5ndGgoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubGVuZ3RoOwog\nICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBEaXN0cmlidXRpb24gU2No\nZWR1bGUKICAgICAqCiAgICAgKiBAcmV0dXJuIERpc3RyaWJ1dGlvblNjaGVk\ndWxlIGZvciB0aGUgTGVkZ2VySGFuZGxlCiAgICAgKi8KICAgIERpc3RyaWJ1\ndGlvblNjaGVkdWxlIGdldERpc3RyaWJ1dGlvblNjaGVkdWxlKCkgewogICAg\nICAgIHJldHVybiBkaXN0cmlidXRpb25TY2hlZHVsZTsKICAgIH0KCiAgICB2\nb2lkIHdyaXRlTGVkZ2VyQ29uZmlnKEdlbmVyaWNDYWxsYmFjazxWb2lkPiB3\ncml0ZUNiKSB7CiAgICAgICAgTE9HLmRlYnVnKCJXcml0aW5nIG1ldGFkYXRh\nIHRvIGxlZGdlciBtYW5hZ2VyOiB7fSwge30iLCB0aGlzLmxlZGdlcklkLCBt\nZXRhZGF0YS5nZXRWZXJzaW9uKCkpOwoKICAgICAgICBiay5nZXRMZWRnZXJN\nYW5hZ2VyKCkud3JpdGVMZWRnZXJNZXRhZGF0YShsZWRnZXJJZCwgbWV0YWRh\ndGEsIHdyaXRlQ2IpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xvc2UgdGhp\ncyBsZWRnZXIgc3luY2hyb25vdXNseS4KICAgICAqIEBzZWUgI2FzeW5jQ2xv\nc2UKICAgICAqLwogICAgcHVibGljIHZvaWQgY2xvc2UoKQogICAgICAgICAg\nICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsK\nICAgICAgICBTeW5jQ291bnRlciBjb3VudGVyID0gbmV3IFN5bmNDb3VudGVy\nKCk7CiAgICAgICAgY291bnRlci5pbmMoKTsKCiAgICAgICAgYXN5bmNDbG9z\nZShuZXcgU3luY0Nsb3NlQ2FsbGJhY2soKSwgY291bnRlcik7CgogICAgICAg\nIGNvdW50ZXIuYmxvY2soMCk7CiAgICAgICAgaWYgKGNvdW50ZXIuZ2V0cmMo\nKSAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgIHRocm93\nIEJLRXhjZXB0aW9uLmNyZWF0ZShjb3VudGVyLmdldHJjKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFzeW5jaHJvbm91cyBjbG9zZSwg\nYW55IGFkZHMgaW4gZmxpZ2h0IHdpbGwgcmV0dXJuIGVycm9ycy4KICAgICAq\nCiAgICAgKiBDbG9zaW5nIGEgbGVkZ2VyIHdpbGwgZW5zdXJlIHRoYXQgYWxs\nIGNsaWVudHMgYWdyZWUgb24gd2hhdCB0aGUgbGFzdCBlbnRyeQogICAgICog\nb2YgdGhlIGxlZGdlciBpcy4gVGhpcyBlbnN1cmVzIHRoYXQsIG9uY2UgdGhl\nIGxlZGdlciBoYXMgYmVlbiBjbG9zZWQsIGFsbAogICAgICogcmVhZHMgZnJv\nbSB0aGUgbGVkZ2VyIHdpbGwgcmV0dXJuIHRoZSBzYW1lIHNldCBvZiBlbnRy\naWVzLgogICAgICoKICAgICAqIEBwYXJhbSBjYgogICAgICogICAgICAgICAg\nY2FsbGJhY2sgaW1wbGVtZW50YXRpb24KICAgICAqIEBwYXJhbSBjdHgKICAg\nICAqICAgICAgICAgIGNvbnRyb2wgb2JqZWN0CiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGFzeW5jQ2xvc2UoQ2xvc2VDYWxsYmFjayBjYiwgT2JqZWN0IGN0\neCkgewogICAgICAgIGFzeW5jQ2xvc2VJbnRlcm5hbChjYiwgY3R4LCBCS0V4\nY2VwdGlvbi5Db2RlLkxlZGdlckNsb3NlZEV4Y2VwdGlvbik7CiAgICB9Cgog\nICAgdm9pZCBhc3luY0Nsb3NlSW50ZXJuYWwoZmluYWwgQ2xvc2VDYWxsYmFj\nayBjYiwgZmluYWwgT2JqZWN0IGN0eCwgZmluYWwgaW50IHJjKSB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZG9Bc3luY0Nsb3NlSW50ZXJuYWwoY2Is\nIGN0eCwgcmMpOwogICAgICAgIH0gY2F0Y2ggKFJlamVjdGVkRXhlY3V0aW9u\nRXhjZXB0aW9uIHJlKSB7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiRmFpbGVk\nIHRvIGNsb3NlIGxlZGdlciB7fSA6ICIsIGxlZGdlcklkLCByZSk7CiAgICAg\nICAgICAgIGVycm9yT3V0UGVuZGluZ0FkZHMoYmsuZ2V0UmV0dXJuUmMocmMp\nKTsKICAgICAgICAgICAgY2IuY2xvc2VDb21wbGV0ZShiay5nZXRSZXR1cm5S\nYyhCS0V4Y2VwdGlvbi5Db2RlLkludGVycnVwdGVkRXhjZXB0aW9uKSwgdGhp\ncywgY3R4KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTYW1l\nIGFzIHB1YmxpYyB2ZXJzaW9uIG9mIGFzeW5jQ2xvc2UgZXhjZXB0IHRoYXQg\ndGhpcyBvbmUgdGFrZXMgYW4KICAgICAqIGFkZGl0aW9uYWwgcGFyYW1ldGVy\nIHdoaWNoIGlzIHRoZSByZXR1cm4gY29kZSB0byBoYW5kIHRvIGFsbCB0aGUg\ncGVuZGluZwogICAgICogYWRkIG9wcwogICAgICoKICAgICAqIEBwYXJhbSBj\nYgogICAgICogQHBhcmFtIGN0eAogICAgICogQHBhcmFtIHJjCiAgICAgKi8K\nICAgIHZvaWQgZG9Bc3luY0Nsb3NlSW50ZXJuYWwoZmluYWwgQ2xvc2VDYWxs\nYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCwgZmluYWwgaW50IHJjKSB7CiAg\nICAgICAgYmsubWFpbldvcmtlclBvb2wuc3VibWl0T3JkZXJlZChsZWRnZXJJ\nZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVSdW4oKSB7CiAgICAgICAg\nICAgICAgICBmaW5hbCBsb25nIHByZXZMYXN0RW50cnlJZDsKICAgICAgICAg\nICAgICAgIGZpbmFsIGxvbmcgcHJldkxlbmd0aDsKICAgICAgICAgICAgICAg\nIGZpbmFsIFN0YXRlIHByZXZTdGF0ZTsKICAgICAgICAgICAgICAgIExpc3Q8\nUGVuZGluZ0FkZE9wPiBwZW5kaW5nQWRkczsKCiAgICAgICAgICAgICAgICBz\neW5jaHJvbml6ZWQoTGVkZ2VySGFuZGxlLnRoaXMpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyBpZiB0aGUgbWV0YWRhdGEgaXMgYWxyZWFkeSBjbG9zZWQs\nIHdlIGRvbid0IG5lZWQgdG8gcHJvY2VlZCB0aGUgcHJvY2VzcwogICAgICAg\nICAgICAgICAgICAgIC8vIG90aGVyd2lzZSwgaXQgbWlnaHQgZW5kIHVwIGVu\nY291bnRlcmluZyBiYWQgdmVyc2lvbiBlcnJvciBsb2cgbWVzc2FnZXMgd2hl\nbiB1cGRhdGluZyBtZXRhZGF0YQogICAgICAgICAgICAgICAgICAgIGlmICht\nZXRhZGF0YS5pc0Nsb3NlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLmNsb3NlQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgTGVkZ2Vy\nSGFuZGxlLnRoaXMsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgcHJldlN0YXRlID0gbWV0YWRhdGEuZ2V0U3RhdGUoKTsKICAgICAgICAg\nICAgICAgICAgICBwcmV2TGFzdEVudHJ5SWQgPSBtZXRhZGF0YS5nZXRMYXN0\nRW50cnlJZCgpOwogICAgICAgICAgICAgICAgICAgIHByZXZMZW5ndGggPSBt\nZXRhZGF0YS5nZXRMZW5ndGgoKTsKCiAgICAgICAgICAgICAgICAgICAgLy8g\nZHJhaW4gcGVuZGluZyBhZGRzIGZpcnN0CiAgICAgICAgICAgICAgICAgICAg\ncGVuZGluZ0FkZHMgPSBkcmFpblBlbmRpbmdBZGRzVG9FcnJvck91dCgpOwoK\nICAgICAgICAgICAgICAgICAgICAvLyBzeW5jaHJvbml6ZWQgb24gTGVkZ2Vy\nSGFuZGxlLnRoaXMgdG8gZW5zdXJlIHRoYXQKICAgICAgICAgICAgICAgICAg\nICAvLyBsYXN0QWRkUHVzaGVkIGNhbiBub3QgYmUgdXBkYXRlZCBhZnRlciB0\naGUgbWV0YWRhdGEKICAgICAgICAgICAgICAgICAgICAvLyBpcyBjbG9zZWQu\nCiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuc2V0TGVuZ3RoKGxlbmd0\naCk7CiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuY2xvc2UobGFzdEFk\nZENvbmZpcm1lZCk7CiAgICAgICAgICAgICAgICAgICAgbGFzdEFkZFB1c2hl\nZCA9IGxhc3RBZGRDb25maXJtZWQ7CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgLy8gZXJyb3Igb3V0IGFsbCBwZW5kaW5nIGFkZHMgZHVy\naW5nIGNsb3NpbmcsIHRoZSBjYWxsYmFja3Mgc2hvdWxkbid0IGJlCiAgICAg\nICAgICAgICAgICAvLyBydW5uaW5nIHVuZGVyIGFueSBiayBsb2Nrcy4KICAg\nICAgICAgICAgICAgIGVycm9yT3V0UGVuZGluZ0FkZHMocmMsIHBlbmRpbmdB\nZGRzKTsKCiAgICAgICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVk\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkNsb3Npbmcg\nbGVkZ2VyOiAiICsgbGVkZ2VySWQgKyAiIGF0IGVudHJ5SWQ6ICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyBtZXRhZGF0YS5nZXRMYXN0RW50\ncnlJZCgpICsgIiB3aXRoIHRoaXMgbWFueSBieXRlczogIiArIG1ldGFkYXRh\nLmdldExlbmd0aCgpKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICBmaW5hbCBjbGFzcyBDbG9zZUNiIGV4dGVuZHMgT3JkZXJlZFNhZmVH\nZW5lcmljQ2FsbGJhY2s8Vm9pZD4gewogICAgICAgICAgICAgICAgICAgIENs\nb3NlQ2IoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1cGVyKGJrLm1h\naW5Xb3JrZXJQb29sLCBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzYWZlT3BlcmF0aW9uQ29tcGxldGUoZmlu\nYWwgaW50IHJjLCBWb2lkIHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5NZXRhZGF0YVZlcnNp\nb25FeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl\ncmVhZE1ldGFkYXRhKG5ldyBPcmRlcmVkU2FmZUdlbmVyaWNDYWxsYmFjazxM\nZWRnZXJNZXRhZGF0YT4oYmsubWFpbldvcmtlclBvb2wsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcklkKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2Fm\nZU9wZXJhdGlvbkNvbXBsZXRlKGludCBuZXdyYywgTGVkZ2VyTWV0YWRhdGEg\nbmV3TWV0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAobmV3cmMgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJF\ncnJvciByZWFkaW5nIG5ldyBtZXRhZGF0YSBmcm9tIGxlZGdlciAiICsgbGVk\nZ2VySWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICIgd2hlbiBjbG9zaW5nLCBjb2RlPSIgKyBuZXdyYyk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5j\nbG9zZUNvbXBsZXRlKHJjLCBMZWRnZXJIYW5kbGUudGhpcywgY3R4KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRh\nLnNldFN0YXRlKHByZXZTdGF0ZSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAocHJldlN0YXRlLmVxdWFscyhTdGF0ZS5D\nTE9TRUQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbWV0YWRhdGEuY2xvc2UocHJldkxhc3RFbnRyeUlkKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5z\nZXRMZW5ndGgocHJldkxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoIW1ldGFkYXRhLmlzTmV3ZXJUaGFuKG5l\nd01ldGEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICYmICFtZXRhZGF0YS5pc0NvbmZsaWN0V2l0aChuZXdNZXRh\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHVzZSB0aGUgbmV3IG1ldGFkYXRhJ3MgZW5zZW1ibGUsIGluIGNh\nc2UgcmUtcmVwbGljYXRpb24gYWxyZWFkeQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlcGxhY2VkIHNvbWUgYm9v\na2llcyBpbiB0aGUgZW5zZW1ibGUuCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuc2V0RW5zZW1ibGVzKG5l\nd01ldGEuZ2V0RW5zZW1ibGVzKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLnNldFZlcnNpb24obmV3\nTWV0YS52ZXJzaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhZGF0YS5zZXRMZW5ndGgobGVuZ3RoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRh\nZGF0YS5jbG9zZShsYXN0QWRkQ29uZmlybWVkKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZUxlZGdlckNvbmZp\nZyhuZXcgQ2xvc2VDYigpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLnNldExlbmd0\naChsZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGFkYXRhLmNsb3NlKGxhc3RBZGRDb25maXJtZWQpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy53YXJuKCJDb25kaXRpb25hbCB1cGRhdGUgbGVkZ2VyIG1ldGFkYXRhIGZv\nciBsZWRnZXIgIiArIGxlZGdlcklkICsgIiBmYWlsZWQuIik7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IuY2xvc2VD\nb21wbGV0ZShyYywgTGVkZ2VySGFuZGxlLnRoaXMsIGN0eCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYyAhPSBC\nS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkVycm9yIHVwZGF0ZSBsZWRnZXIgbWV0YWRhdGEg\nZm9yIGxlZGdlciAiICsgbGVkZ2VySWQgKyAiIDogIiArIHJjKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNiLmNsb3NlQ29tcGxldGUocmMsIExl\nZGdlckhhbmRsZS50aGlzLCBjdHgpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IuY2xv\nc2VDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9LLCBMZWRnZXJIYW5kbGUu\ndGhpcywgY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAg\nICAgICAgd3JpdGVMZWRnZXJDb25maWcobmV3IENsb3NlQ2IoKSk7CgogICAg\nICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWFkIGEgc2VxdWVuY2Ugb2YgZW50cmllcyBzeW5jaHJvbm91c2x5LgogICAg\nICoKICAgICAqIEBwYXJhbSBmaXJzdEVudHJ5CiAgICAgKiAgICAgICAgICBp\nZCBvZiBmaXJzdCBlbnRyeSBvZiBzZXF1ZW5jZSAoaW5jbHVkZWQpCiAgICAg\nKiBAcGFyYW0gbGFzdEVudHJ5CiAgICAgKiAgICAgICAgICBpZCBvZiBsYXN0\nIGVudHJ5IG9mIHNlcXVlbmNlIChpbmNsdWRlZCkKICAgICAqCiAgICAgKi8K\nICAgIHB1YmxpYyBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gcmVhZEVudHJp\nZXMobG9uZyBmaXJzdEVudHJ5LCBsb25nIGxhc3RFbnRyeSkKICAgICAgICAg\nICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7\nCiAgICAgICAgU3luY0NvdW50ZXIgY291bnRlciA9IG5ldyBTeW5jQ291bnRl\ncigpOwogICAgICAgIGNvdW50ZXIuaW5jKCk7CgogICAgICAgIGFzeW5jUmVh\nZEVudHJpZXMoZmlyc3RFbnRyeSwgbGFzdEVudHJ5LCBuZXcgU3luY1JlYWRD\nYWxsYmFjaygpLCBjb3VudGVyKTsKCiAgICAgICAgY291bnRlci5ibG9jaygw\nKTsKICAgICAgICBpZiAoY291bnRlci5nZXRyYygpICE9IEJLRXhjZXB0aW9u\nLkNvZGUuT0spIHsKICAgICAgICAgICAgdGhyb3cgQktFeGNlcHRpb24uY3Jl\nYXRlKGNvdW50ZXIuZ2V0cmMoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gY291bnRlci5nZXRTZXF1ZW5jZSgpOwogICAgfQoKICAgIC8qKgogICAg\nICogUmVhZCBhIHNlcXVlbmNlIG9mIGVudHJpZXMgYXN5bmNocm9ub3VzbHku\nCiAgICAgKgogICAgICogQHBhcmFtIGZpcnN0RW50cnkKICAgICAqICAgICAg\nICAgIGlkIG9mIGZpcnN0IGVudHJ5IG9mIHNlcXVlbmNlCiAgICAgKiBAcGFy\nYW0gbGFzdEVudHJ5CiAgICAgKiAgICAgICAgICBpZCBvZiBsYXN0IGVudHJ5\nIG9mIHNlcXVlbmNlCiAgICAgKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAg\nIG9iamVjdCBpbXBsZW1lbnRpbmcgcmVhZCBjYWxsYmFjayBpbnRlcmZhY2UK\nICAgICAqIEBwYXJhbSBjdHgKICAgICAqICAgICAgICAgIGNvbnRyb2wgb2Jq\nZWN0CiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzeW5jUmVhZEVudHJpZXMo\nbG9uZyBmaXJzdEVudHJ5LCBsb25nIGxhc3RFbnRyeSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgUmVhZENhbGxiYWNrIGNiLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgLy8gTGl0dGxlIHNhbml0eSBjaGVjawogICAgICAg\nIGlmIChmaXJzdEVudHJ5IDwgMCB8fCBsYXN0RW50cnkgPiBsYXN0QWRkQ29u\nZmlybWVkCiAgICAgICAgICAgICAgICB8fCBmaXJzdEVudHJ5ID4gbGFzdEVu\ndHJ5KSB7CiAgICAgICAgICAgIGNiLnJlYWRDb21wbGV0ZShCS0V4Y2VwdGlv\nbi5Db2RlLlJlYWRFeGNlcHRpb24sIHRoaXMsIG51bGwsIGN0eCk7CiAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIG5ldyBQZW5kaW5nUmVhZE9wKHRoaXMsIGJrLnNjaGVkdWxlciwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3RFbnRyeSwgbGFz\ndEVudHJ5LCBjYiwgY3R4KS5pbml0aWF0ZSgpOwogICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgY2IucmVh\nZENvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuSW50ZXJydXB0ZWRFeGNlcHRp\nb24sIHRoaXMsIG51bGwsIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogQWRkIGVudHJ5IHN5bmNocm9ub3VzbHkgdG8gYW4gb3BlbiBs\nZWRnZXIuCiAgICAgKgogICAgICogQHBhcmFtIGRhdGEKICAgICAqICAgICAg\nICAgYXJyYXkgb2YgYnl0ZXMgdG8gYmUgd3JpdHRlbiB0byB0aGUgbGVkZ2Vy\nCiAgICAgKiBAcmV0dXJuIHRoZSBlbnRyeUlkIG9mIHRoZSBuZXcgaW5zZXJ0\nZWQgZW50cnkKICAgICAqLwogICAgcHVibGljIGxvbmcgYWRkRW50cnkoYnl0\nZVtdIGRhdGEpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBhZGRFbnRyeShkYXRhLCAwLCBkYXRh\nLmxlbmd0aCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgZW50cnkgc3lu\nY2hyb25vdXNseSB0byBhbiBvcGVuIGxlZGdlci4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZGF0YQogICAgICogICAgICAgICBhcnJheSBvZiBieXRlcyB0byBi\nZSB3cml0dGVuIHRvIHRoZSBsZWRnZXIKICAgICAqIEBwYXJhbSBvZmZzZXQK\nICAgICAqICAgICAgICAgIG9mZnNldCBmcm9tIHdoaWNoIHRvIHRha2UgYnl0\nZXMgZnJvbSBkYXRhCiAgICAgKiBAcGFyYW0gbGVuZ3RoCiAgICAgKiAgICAg\nICAgICBudW1iZXIgb2YgYnl0ZXMgdG8gdGFrZSBmcm9tIGRhdGEKICAgICAq\nIEByZXR1cm4gdGhlIGVudHJ5SWQgb2YgdGhlIG5ldyBpbnNlcnRlZCBlbnRy\neQogICAgICovCiAgICBwdWJsaWMgbG9uZyBhZGRFbnRyeShieXRlW10gZGF0\nYSwgaW50IG9mZnNldCwgaW50IGxlbmd0aCkKICAgICAgICAgICAgdGhyb3dz\nIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAg\nTE9HLmRlYnVnKCJBZGRpbmcgZW50cnkge30iLCBkYXRhKTsKCiAgICAgICAg\nU3luY0NvdW50ZXIgY291bnRlciA9IG5ldyBTeW5jQ291bnRlcigpOwogICAg\nICAgIGNvdW50ZXIuaW5jKCk7CgogICAgICAgIFN5bmNBZGRDYWxsYmFjayBj\nYWxsYmFjayA9IG5ldyBTeW5jQWRkQ2FsbGJhY2soKTsKICAgICAgICBhc3lu\nY0FkZEVudHJ5KGRhdGEsIG9mZnNldCwgbGVuZ3RoLCBjYWxsYmFjaywgY291\nbnRlcik7CiAgICAgICAgY291bnRlci5ibG9jaygwKTsKCiAgICAgICAgaWYg\nKGNvdW50ZXIuZ2V0cmMoKSAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAg\nICAgICAgICAgIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShjb3VudGVyLmdl\ndHJjKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGNhbGxiYWNrLmVu\ndHJ5SWQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgZW50cnkgYXN5bmNo\ncm9ub3VzbHkgdG8gYW4gb3BlbiBsZWRnZXIuCiAgICAgKgogICAgICogQHBh\ncmFtIGRhdGEKICAgICAqICAgICAgICAgIGFycmF5IG9mIGJ5dGVzIHRvIGJl\nIHdyaXR0ZW4KICAgICAqIEBwYXJhbSBjYgogICAgICogICAgICAgICAgb2Jq\nZWN0IGltcGxlbWVudGluZyBjYWxsYmFja2ludGVyZmFjZQogICAgICogQHBh\ncmFtIGN0eAogICAgICogICAgICAgICAgc29tZSBjb250cm9sIG9iamVjdAog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3luY0FkZEVudHJ5KGZpbmFsIGJ5\ndGVbXSBkYXRhLCBmaW5hbCBBZGRDYWxsYmFjayBjYiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAg\nIGFzeW5jQWRkRW50cnkoZGF0YSwgMCwgZGF0YS5sZW5ndGgsIGNiLCBjdHgp\nOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGVudHJ5IGFzeW5jaHJvbm91\nc2x5IHRvIGFuIG9wZW4gbGVkZ2VyLCB1c2luZyBhbiBvZmZzZXQgYW5kIHJh\nbmdlLgogICAgICoKICAgICAqIEBwYXJhbSBkYXRhCiAgICAgKiAgICAgICAg\nICBhcnJheSBvZiBieXRlcyB0byBiZSB3cml0dGVuCiAgICAgKiBAcGFyYW0g\nb2Zmc2V0CiAgICAgKiAgICAgICAgICBvZmZzZXQgZnJvbSB3aGljaCB0byB0\nYWtlIGJ5dGVzIGZyb20gZGF0YQogICAgICogQHBhcmFtIGxlbmd0aAogICAg\nICogICAgICAgICAgbnVtYmVyIG9mIGJ5dGVzIHRvIHRha2UgZnJvbSBkYXRh\nCiAgICAgKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAgIG9iamVjdCBpbXBs\nZW1lbnRpbmcgY2FsbGJhY2tpbnRlcmZhY2UKICAgICAqIEBwYXJhbSBjdHgK\nICAgICAqICAgICAgICAgIHNvbWUgY29udHJvbCBvYmplY3QKICAgICAqIEB0\naHJvd3MgQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9uIGlmIG9mZnNl\ndCBvciBsZW5ndGggaXMgbmVnYXRpdmUgb3IKICAgICAqICAgICAgICAgIG9m\nZnNldCBhbmQgbGVuZ3RoIHN1bSB0byBhIHZhbHVlIGhpZ2hlciB0aGFuIHRo\nZSBsZW5ndGggb2YgZGF0YS4KICAgICAqLwogICAgcHVibGljIHZvaWQgYXN5\nbmNBZGRFbnRyeShmaW5hbCBieXRlW10gZGF0YSwgZmluYWwgaW50IG9mZnNl\ndCwgZmluYWwgaW50IGxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZmluYWwgQWRkQ2FsbGJhY2sgY2IsIGZpbmFsIE9iamVjdCBjdHgp\nIHsKICAgICAgICBQZW5kaW5nQWRkT3Agb3AgPSBuZXcgUGVuZGluZ0FkZE9w\nKExlZGdlckhhbmRsZS50aGlzLCBjYiwgY3R4KTsKICAgICAgICBkb0FzeW5j\nQWRkRW50cnkob3AsIGRhdGEsIG9mZnNldCwgbGVuZ3RoLCBjYiwgY3R4KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIE1ha2UgYSByZWNvdmVyeSBhZGQgZW50\ncnkgcmVxdWVzdC4gUmVjb3ZlcnkgYWRkcyBjYW4gYWRkIHRvIGEgbGVkZ2Vy\nIGV2ZW4gaWYKICAgICAqIGl0IGhhcyBiZWVuIGZlbmNlZC4KICAgICAqCiAg\nICAgKiBUaGlzIGlzIG9ubHkgdmFsaWQgZm9yIGJvb2tpZSBhbmQgbGVkZ2Vy\nIHJlY292ZXJ5LCB3aGljaCBtYXkgbmVlZCB0byByZXBsaWNhdGUKICAgICAq\nIGVudHJpZXMgdG8gYSBxdW9ydW0gb2YgYm9va2llcyB0byBlbnN1cmUgZGF0\nYSBzYWZldHkuCiAgICAgKgogICAgICogTm9ybWFsIGNsaWVudCBzaG91bGQg\nbmV2ZXIgY2FsbCB0aGlzIG1ldGhvZC4KICAgICAqLwogICAgdm9pZCBhc3lu\nY1JlY292ZXJ5QWRkRW50cnkoZmluYWwgYnl0ZVtdIGRhdGEsIGZpbmFsIGlu\ndCBvZmZzZXQsIGZpbmFsIGludCBsZW5ndGgsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmaW5hbCBBZGRDYWxsYmFjayBjYiwgZmluYWwgT2Jq\nZWN0IGN0eCkgewogICAgICAgIFBlbmRpbmdBZGRPcCBvcCA9IG5ldyBQZW5k\naW5nQWRkT3AoTGVkZ2VySGFuZGxlLnRoaXMsIGNiLCBjdHgpLmVuYWJsZVJl\nY292ZXJ5QWRkKCk7CiAgICAgICAgZG9Bc3luY0FkZEVudHJ5KG9wLCBkYXRh\nLCBvZmZzZXQsIGxlbmd0aCwgY2IsIGN0eCk7CiAgICB9CgogICAgcHJpdmF0\nZSB2b2lkIGRvQXN5bmNBZGRFbnRyeShmaW5hbCBQZW5kaW5nQWRkT3Agb3As\nIGZpbmFsIGJ5dGVbXSBkYXRhLCBmaW5hbCBpbnQgb2Zmc2V0LCBmaW5hbCBp\nbnQgbGVuZ3RoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbCBBZGRDYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAg\nICAgIGlmIChvZmZzZXQgPCAwIHx8IGxlbmd0aCA8IDAKICAgICAgICAgICAg\nICAgIHx8IChvZmZzZXQgKyBsZW5ndGgpID4gZGF0YS5sZW5ndGgpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICJJbnZhbGlkIHZhbHVlcyBmb3Igb2Zm\nc2V0KCIrb2Zmc2V0CiAgICAgICAgICAgICAgICArIikgb3IgbGVuZ3RoKCIr\nbGVuZ3RoKyIpIik7CiAgICAgICAgfQogICAgICAgIHRocm90dGxlci5hY3F1\naXJlKCk7CgogICAgICAgIGZpbmFsIGxvbmcgZW50cnlJZDsKICAgICAgICBm\naW5hbCBsb25nIGN1cnJlbnRMZW5ndGg7CiAgICAgICAgYm9vbGVhbiB3YXND\nbG9zZWQgPSBmYWxzZTsKICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewog\nICAgICAgICAgICAvLyBzeW5jaHJvbml6ZWQgb24gdGhpcyB0byBlbnN1cmUg\ndGhhdAogICAgICAgICAgICAvLyB0aGUgbGVkZ2VyIGlzbid0IGNsb3NlZCBi\nZXR3ZWVuIGNoZWNraW5nIGFuZAogICAgICAgICAgICAvLyB1cGRhdGluZyBs\nYXN0QWRkUHVzaGVkCiAgICAgICAgICAgIGlmIChtZXRhZGF0YS5pc0Nsb3Nl\nZCgpKSB7CiAgICAgICAgICAgICAgICB3YXNDbG9zZWQgPSB0cnVlOwogICAg\nICAgICAgICAgICAgZW50cnlJZCA9IC0xOwogICAgICAgICAgICAgICAgY3Vy\ncmVudExlbmd0aCA9IDA7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICBlbnRyeUlkID0gKytsYXN0QWRkUHVzaGVkOwogICAgICAgICAg\nICAgICAgY3VycmVudExlbmd0aCA9IGFkZFRvTGVuZ3RoKGxlbmd0aCk7CiAg\nICAgICAgICAgICAgICBvcC5zZXRFbnRyeUlkKGVudHJ5SWQpOwogICAgICAg\nICAgICAgICAgcGVuZGluZ0FkZE9wcy5hZGQob3ApOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBpZiAod2FzQ2xvc2VkKSB7CiAgICAgICAg\nICAgIExPRy53YXJuKCJBdHRlbXB0IHRvIGFkZCB0byBjbG9zZWQgbGVkZ2Vy\nOiB7fSIsIGxlZGdlcklkKTsKICAgICAgICAgICAgY2IuYWRkQ29tcGxldGUo\nQktFeGNlcHRpb24uQ29kZS5MZWRnZXJDbG9zZWRFeGNlcHRpb24sCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgIExlZGdlckhhbmRsZS50aGlzLCBJTlZB\nTElEX0VOVFJZX0lELCBjdHgpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBiay5tYWluV29ya2Vy\nUG9vbC5zdWJtaXQobmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2Fm\nZVJ1bigpIHsKICAgICAgICAgICAgICAgICAgICBDaGFubmVsQnVmZmVyIHRv\nU2VuZCA9IG1hY01hbmFnZXIuY29tcHV0ZURpZ2VzdEFuZFBhY2thZ2VGb3JT\nZW5kaW5nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGVudHJ5SWQsIGxhc3RBZGRDb25maXJtZWQsIGN1cnJlbnRM\nZW5ndGgsIGRhdGEsIG9mZnNldCwgbGVuZ3RoKTsKICAgICAgICAgICAgICAg\nICAgICBvcC5pbml0aWF0ZSh0b1NlbmQsIGxlbmd0aCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gY2F0Y2ggKFJlamVj\ndGVkRXhlY3V0aW9uRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgY2IuYWRk\nQ29tcGxldGUoYmsuZ2V0UmV0dXJuUmMoQktFeGNlcHRpb24uQ29kZS5JbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiksCiAgICAgICAgICAgICAgICAgICAgTGVkZ2Vy\nSGFuZGxlLnRoaXMsIElOVkFMSURfRU5UUllfSUQsIGN0eCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHN5bmNocm9uaXplZCB2b2lkIHVwZGF0ZUxhc3RDb25m\naXJtZWQobG9uZyBsYWMsIGxvbmcgbGVuKSB7CiAgICAgICAgaWYgKGxhYyA+\nIGxhc3RBZGRDb25maXJtZWQpIHsKICAgICAgICAgICAgbGFzdEFkZENvbmZp\ncm1lZCA9IGxhYzsKICAgICAgICAgICAgbGFjVXBkYXRlSGl0c0NvdW50ZXIu\naW5jKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbGFjVXBkYXRl\nTWlzc2VzQ291bnRlci5pbmMoKTsKICAgICAgICB9CiAgICAgICAgbGFzdEFk\nZFB1c2hlZCA9IE1hdGgubWF4KGxhc3RBZGRQdXNoZWQsIGxhYyk7CiAgICAg\nICAgbGVuZ3RoID0gTWF0aC5tYXgobGVuZ3RoLCBsZW4pOwogICAgfQoKICAg\nIC8qKgogICAgICogT2J0YWlucyBhc3luY2hyb25vdXNseSB0aGUgbGFzdCBj\nb25maXJtZWQgd3JpdGUgZnJvbSBhIHF1b3J1bSBvZiBib29raWVzLiBUaGlz\nCiAgICAgKiBjYWxsIG9idGFpbnMgdGhlIHRoZSBsYXN0IGFkZCBjb25maXJt\nZWQgZWFjaCBib29raWUgaGFzIHJlY2VpdmVkIGZvciB0aGlzIGxlZGdlcgog\nICAgICogYW5kIHJldHVybnMgdGhlIG1heGltdW0uIElmIHRoZSBsZWRnZXIg\naGFzIGJlZW4gY2xvc2VkLCB0aGUgdmFsdWUgcmV0dXJuZWQgYnkgdGhpcwog\nICAgICogY2FsbCBtYXkgbm90IGNvcnJlc3BvbmQgdG8gdGhlIGlkIG9mIHRo\nZSBsYXN0IGVudHJ5IG9mIHRoZSBsZWRnZXIsIHNpbmNlIGl0IHJlYWRzCiAg\nICAgKiB0aGUgaGludCBvZiBib29raWVzLiBDb25zZXF1ZW50bHksIGluIHRo\nZSBjYXNlIHRoZSBsZWRnZXIgaGFzIGJlZW4gY2xvc2VkLCBpdCBtYXkKICAg\nICAqIHJldHVybiBhIGRpZmZlcmVudCB2YWx1ZSB0aGFuIGdldExhc3RBZGRD\nb25maXJtZWQsIHdoaWNoIHJldHVybnMgdGhlIGxvY2FsIHZhbHVlCiAgICAg\nKiBvZiB0aGUgbGVkZ2VyIGhhbmRsZS4KICAgICAqCiAgICAgKiBAc2VlICNn\nZXRMYXN0QWRkQ29uZmlybWVkKCkKICAgICAqCiAgICAgKiBAcGFyYW0gY2IK\nICAgICAqIEBwYXJhbSBjdHgKICAgICAqLwoKICAgIHB1YmxpYyB2b2lkIGFz\neW5jUmVhZExhc3RDb25maXJtZWQoZmluYWwgUmVhZExhc3RDb25maXJtZWRD\nYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIGJvb2xl\nYW4gaXNDbG9zZWQ7CiAgICAgICAgbG9uZyBsYXN0RW50cnlJZDsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaXNDbG9zZWQg\nPSBtZXRhZGF0YS5pc0Nsb3NlZCgpOwogICAgICAgICAgICBsYXN0RW50cnlJ\nZCA9IG1ldGFkYXRhLmdldExhc3RFbnRyeUlkKCk7CiAgICAgICAgfQogICAg\nICAgIGlmIChpc0Nsb3NlZCkgewogICAgICAgICAgICBjYi5yZWFkTGFzdENv\nbmZpcm1lZENvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuT0ssIGxhc3RFbnRy\neUlkLCBjdHgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAg\nICAgIFJlYWRMYXN0Q29uZmlybWVkT3AuTGFzdENvbmZpcm1lZERhdGFDYWxs\nYmFjayBpbm5lcmNiID0gbmV3IFJlYWRMYXN0Q29uZmlybWVkT3AuTGFzdENv\nbmZpcm1lZERhdGFDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25m\naXJtZWREYXRhQ29tcGxldGUoaW50IHJjLCBEaWdlc3RNYW5hZ2VyLlJlY292\nZXJ5RGF0YSBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09\nIEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgdXBkYXRlTGFzdENvbmZpcm1lZChkYXRhLmxhc3RBZGRDb25maXJtZWQs\nIGRhdGEubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2IucmVh\nZExhc3RDb25maXJtZWRDb21wbGV0ZShyYywgZGF0YS5sYXN0QWRkQ29uZmly\nbWVkLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNiLnJlYWRMYXN0Q29uZmlybWVkQ29tcGxl\ndGUocmMsIElOVkFMSURfRU5UUllfSUQsIGN0eCk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAg\nICAgIG5ldyBSZWFkTGFzdENvbmZpcm1lZE9wKHRoaXMsIGlubmVyY2IpLmlu\naXRpYXRlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBPYnRhaW5zIGFzeW5j\naHJvbm91c2x5IHRoZSBsYXN0IGNvbmZpcm1lZCB3cml0ZSBmcm9tIGEgcXVv\ncnVtIG9mIGJvb2tpZXMuCiAgICAgKiBJdCBpcyBzaW1pbGFyIGFzCiAgICAg\nKiB7QGxpbmsgI2FzeW5jVHJ5UmVhZExhc3RDb25maXJtZWQob3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRMYXN0Q29u\nZmlybWVkQ2FsbGJhY2ssIE9iamVjdCl9LAogICAgICogYnV0IGl0IGRvZXNu\nJ3Qgd2FpdCBhbGwgdGhlIHJlc3BvbnNlcyBmcm9tIHRoZSBxdW9ydW0uIEl0\nIHdvdWxkIGNhbGxiYWNrCiAgICAgKiBpbW1lZGlhdGVseSBpZiBpdCByZWNl\naXZlZCBhIExBQyB3aGljaCBpcyBsYXJnZXIgdGhhbiBjdXJyZW50IExBQy4K\nICAgICAqCiAgICAgKiBAc2VlICNhc3luY1RyeVJlYWRMYXN0Q29uZmlybWVk\nKG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5S\nZWFkTGFzdENvbmZpcm1lZENhbGxiYWNrLCBPYmplY3QpCiAgICAgKgogICAg\nICogQHBhcmFtIGNiCiAgICAgKiAgICAgICAgICBjYWxsYmFjayB0byByZXR1\ncm4gcmVhZCBsYXN0IGNvbmZpcm1lZAogICAgICogQHBhcmFtIGN0eAogICAg\nICogICAgICAgICAgY2FsbGJhY2sgY29udGV4dAogICAgICovCiAgICBwdWJs\naWMgdm9pZCBhc3luY1RyeVJlYWRMYXN0Q29uZmlybWVkKGZpbmFsIFJlYWRM\nYXN0Q29uZmlybWVkQ2FsbGJhY2sgY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBib29sZWFuIGlzQ2xvc2VkOwogICAgICAgIGxvbmcgbGFzdEVu\ndHJ5SWQ7CiAgICAgICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAg\nICAgIGlzQ2xvc2VkID0gbWV0YWRhdGEuaXNDbG9zZWQoKTsKICAgICAgICAg\nICAgbGFzdEVudHJ5SWQgPSBtZXRhZGF0YS5nZXRMYXN0RW50cnlJZCgpOwog\nICAgICAgIH0KICAgICAgICBpZiAoaXNDbG9zZWQpIHsKICAgICAgICAgICAg\nY2IucmVhZExhc3RDb25maXJtZWRDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2Rl\nLk9LLCBsYXN0RW50cnlJZCwgY3R4KTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KICAgICAgICBSZWFkTGFzdENvbmZpcm1lZE9wLkxhc3RDb25m\naXJtZWREYXRhQ2FsbGJhY2sgaW5uZXJjYiA9IG5ldyBSZWFkTGFzdENvbmZp\ncm1lZE9wLkxhc3RDb25maXJtZWREYXRhQ2FsbGJhY2soKSB7CiAgICAgICAg\nICAgIEF0b21pY0Jvb2xlYW4gY29tcGxldGVkID0gbmV3IEF0b21pY0Jvb2xl\nYW4oZmFsc2UpOwogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgcmVhZExhc3RDb25maXJtZWREYXRhQ29tcGxldGUoaW50\nIHJjLCBEaWdlc3RNYW5hZ2VyLlJlY292ZXJ5RGF0YSBkYXRhKSB7CiAgICAg\nICAgICAgICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSykgewog\nICAgICAgICAgICAgICAgICAgIHVwZGF0ZUxhc3RDb25maXJtZWQoZGF0YS5s\nYXN0QWRkQ29uZmlybWVkLCBkYXRhLmxlbmd0aCk7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKGNvbXBsZXRlZC5jb21wYXJlQW5kU2V0KGZhbHNlLCB0cnVl\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBjYi5yZWFkTGFzdENvbmZp\ncm1lZENvbXBsZXRlKHJjLCBkYXRhLmxhc3RBZGRDb25maXJtZWQsIGN0eCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY29tcGxldGVkLmNvbXBhcmVB\nbmRTZXQoZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLnJlYWRMYXN0Q29uZmlybWVkQ29tcGxldGUocmMsIElOVkFMSURfRU5U\nUllfSUQsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBuZXcg\nVHJ5UmVhZExhc3RDb25maXJtZWRPcCh0aGlzLCBpbm5lcmNiLCBnZXRMYXN0\nQWRkQ29uZmlybWVkKCkpLmluaXRpYXRlKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBDb250ZXh0IG9iamVjdHMgZm9yIHN5bmNocm9ub3VzIGNhbGwgdG8g\ncmVhZCBsYXN0IGNvbmZpcm1lZC4KICAgICAqLwogICAgc3RhdGljIGNsYXNz\nIExhc3RDb25maXJtZWRDdHggewogICAgICAgIGZpbmFsIHN0YXRpYyBsb25n\nIEVOVFJZX0lEX1BFTkRJTkcgPSAtMTA7CiAgICAgICAgbG9uZyByZXNwb25z\nZTsKICAgICAgICBpbnQgcmM7CgogICAgICAgIExhc3RDb25maXJtZWRDdHgo\nKSB7CiAgICAgICAgICAgIHRoaXMucmVzcG9uc2UgPSBFTlRSWV9JRF9QRU5E\nSU5HOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXRMYXN0Q29uZmlybWVk\nKGxvbmcgbGFzdENvbmZpcm1lZCkgewogICAgICAgICAgICB0aGlzLnJlc3Bv\nbnNlID0gbGFzdENvbmZpcm1lZDsKICAgICAgICB9CgogICAgICAgIGxvbmcg\nZ2V0bGFzdENvbmZpcm1lZCgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMu\ncmVzcG9uc2U7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHNldFJDKGludCBy\nYykgewogICAgICAgICAgICB0aGlzLnJjID0gcmM7CiAgICAgICAgfQoKICAg\nICAgICBpbnQgZ2V0UkMoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnJj\nOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiByZWFkeSgpIHsKICAgICAg\nICAgICAgcmV0dXJuICh0aGlzLnJlc3BvbnNlICE9IEVOVFJZX0lEX1BFTkRJ\nTkcpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIE9idGFpbnMg\nc3luY2hyb25vdXNseSB0aGUgbGFzdCBjb25maXJtZWQgd3JpdGUgZnJvbSBh\nIHF1b3J1bSBvZiBib29raWVzLiBUaGlzIGNhbGwKICAgICAqIG9idGFpbnMg\ndGhlIHRoZSBsYXN0IGFkZCBjb25maXJtZWQgZWFjaCBib29raWUgaGFzIHJl\nY2VpdmVkIGZvciB0aGlzIGxlZGdlcgogICAgICogYW5kIHJldHVybnMgdGhl\nIG1heGltdW0uIElmIHRoZSBsZWRnZXIgaGFzIGJlZW4gY2xvc2VkLCB0aGUg\ndmFsdWUgcmV0dXJuZWQgYnkgdGhpcwogICAgICogY2FsbCBtYXkgbm90IGNv\ncnJlc3BvbmQgdG8gdGhlIGlkIG9mIHRoZSBsYXN0IGVudHJ5IG9mIHRoZSBs\nZWRnZXIsIHNpbmNlIGl0IHJlYWRzCiAgICAgKiB0aGUgaGludCBvZiBib29r\naWVzLiBDb25zZXF1ZW50bHksIGluIHRoZSBjYXNlIHRoZSBsZWRnZXIgaGFz\nIGJlZW4gY2xvc2VkLCBpdCBtYXkKICAgICAqIHJldHVybiBhIGRpZmZlcmVu\ndCB2YWx1ZSB0aGFuIGdldExhc3RBZGRDb25maXJtZWQsIHdoaWNoIHJldHVy\nbnMgdGhlIGxvY2FsIHZhbHVlCiAgICAgKiBvZiB0aGUgbGVkZ2VyIGhhbmRs\nZS4KICAgICAqCiAgICAgKiBAc2VlICNnZXRMYXN0QWRkQ29uZmlybWVkKCkK\nICAgICAqCiAgICAgKiBAcmV0dXJuIFRoZSBlbnRyeSBpZCBvZiB0aGUgbGFz\ndCBjb25maXJtZWQgd3JpdGUgb3Ige0BsaW5rICNJTlZBTElEX0VOVFJZX0lE\nIElOVkFMSURfRU5UUllfSUR9CiAgICAgKiAgICAgICAgIGlmIG5vIGVudHJ5\nIGhhcyBiZWVuIGNvbmZpcm1lZAogICAgICogQHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbgogICAgICogQHRocm93cyBCS0V4Y2VwdGlvbgogICAgICov\nCiAgICBwdWJsaWMgbG9uZyByZWFkTGFzdENvbmZpcm1lZCgpCiAgICAgICAg\nICAgIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24g\newogICAgICAgIExhc3RDb25maXJtZWRDdHggY3R4ID0gbmV3IExhc3RDb25m\naXJtZWRDdHgoKTsKICAgICAgICBhc3luY1JlYWRMYXN0Q29uZmlybWVkKG5l\ndyBTeW5jUmVhZExhc3RDb25maXJtZWRDYWxsYmFjaygpLCBjdHgpOwogICAg\nICAgIHN5bmNocm9uaXplZChjdHgpIHsKICAgICAgICAgICAgd2hpbGUoIWN0\neC5yZWFkeSgpKSB7CiAgICAgICAgICAgICAgICBjdHgud2FpdCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZihjdHguZ2V0UkMoKSAh\nPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB0aHJvdyBCS0V4Y2VwdGlvbi5jcmVh\ndGUoY3R4LmdldFJDKCkpOwogICAgICAgIHJldHVybiBjdHguZ2V0bGFzdENv\nbmZpcm1lZCgpOwogICAgfQoKICAgIC8qKgogICAgICogT2J0YWlucyBzeW5j\naHJvbm91c2x5IHRoZSBsYXN0IGNvbmZpcm1lZCB3cml0ZSBmcm9tIGEgcXVv\ncnVtIG9mIGJvb2tpZXMuCiAgICAgKiBJdCBpcyBzaW1pbGFyIGFzIHtAbGlu\nayAjcmVhZExhc3RDb25maXJtZWQoKX0sIGJ1dCBpdCBkb2Vzbid0IHdhaXQg\nYWxsIHRoZSByZXNwb25zZXMKICAgICAqIGZyb20gdGhlIHF1b3J1bS4gSXQg\nd291bGQgY2FsbGJhY2sgaW1tZWRpYXRlbHkgaWYgaXQgcmVjZWl2ZWQgYSBM\nQUMgd2hpY2ggaXMgbGFyZ2VyCiAgICAgKiB0aGFuIGN1cnJlbnQgTEFDLgog\nICAgICoKICAgICAqIEBzZWUgI3JlYWRMYXN0Q29uZmlybWVkKCkKICAgICAq\nCiAgICAgKiBAcmV0dXJuIFRoZSBlbnRyeSBpZCBvZiB0aGUgbGFzdCBjb25m\naXJtZWQgd3JpdGUgb3Ige0BsaW5rICNJTlZBTElEX0VOVFJZX0lEIElOVkFM\nSURfRU5UUllfSUR9CiAgICAgKiAgICAgICAgIGlmIG5vIGVudHJ5IGhhcyBi\nZWVuIGNvbmZpcm1lZAogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbgogICAgICogQHRocm93cyBCS0V4Y2VwdGlvbgogICAgICovCiAgICBw\ndWJsaWMgbG9uZyB0cnlSZWFkTGFzdENvbmZpcm1lZCgpIHRocm93cyBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIExhc3RD\nb25maXJtZWRDdHggY3R4ID0gbmV3IExhc3RDb25maXJtZWRDdHgoKTsKICAg\nICAgICBhc3luY1RyeVJlYWRMYXN0Q29uZmlybWVkKG5ldyBTeW5jUmVhZExh\nc3RDb25maXJtZWRDYWxsYmFjaygpLCBjdHgpOwogICAgICAgIHN5bmNocm9u\naXplZCAoY3R4KSB7CiAgICAgICAgICAgIHdoaWxlICghY3R4LnJlYWR5KCkp\nIHsKICAgICAgICAgICAgICAgIGN0eC53YWl0KCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgaWYgKGN0eC5nZXRSQygpICE9IEJLRXhjZXB0\naW9uLkNvZGUuT0spIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShjdHguZ2V0\nUkMoKSk7CiAgICAgICAgcmV0dXJuIGN0eC5nZXRsYXN0Q29uZmlybWVkKCk7\nCiAgICB9CgogICAgLy8gY2xvc2UgdGhlIGxlZGdlciBhbmQgc2VuZCBmYWls\ncyB0byBhbGwgdGhlIGFkZHMgaW4gdGhlIHBpcGVsaW5lCiAgICB2b2lkIGhh\nbmRsZVVucmVjb3ZlcmFibGVFcnJvckR1cmluZ0FkZChpbnQgcmMpIHsKICAg\nICAgICBpZiAobWV0YWRhdGEuaXNJblJlY292ZXJ5KCkpIHsKICAgICAgICAg\nICAgLy8gd2Ugc2hvdWxkIG5vdCBjbG9zZSBsZWRnZXIgaWYgbGVkZ2VyIGlz\nIHJlY292ZXJ5IG1vZGUKICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIHdlIG1h\neSBsb3NlIGVudHJ5LgogICAgICAgICAgICBlcnJvck91dFBlbmRpbmdBZGRz\nKHJjKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBM\nT0cuZXJyb3IoIkNsb3NpbmcgbGVkZ2VyIHt9IGR1ZSB0byBlcnJvciB7fSIs\nIGxlZGdlcklkLCByYyk7CiAgICAgICAgYXN5bmNDbG9zZUludGVybmFsKE5v\nb3BDbG9zZUNhbGxiYWNrLmluc3RhbmNlLCBudWxsLCByYyk7CiAgICB9Cgog\nICAgdm9pZCBlcnJvck91dFBlbmRpbmdBZGRzKGludCByYykgewogICAgICAg\nIGVycm9yT3V0UGVuZGluZ0FkZHMocmMsIGRyYWluUGVuZGluZ0FkZHNUb0Vy\ncm9yT3V0KCkpOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBMaXN0PFBlbmRp\nbmdBZGRPcD4gZHJhaW5QZW5kaW5nQWRkc1RvRXJyb3JPdXQoKSB7CiAgICAg\nICAgUGVuZGluZ0FkZE9wIHBlbmRpbmdBZGRPcDsKICAgICAgICBMaXN0PFBl\nbmRpbmdBZGRPcD4gb3BzRHJhaW5lZCA9IG5ldyBBcnJheUxpc3Q8UGVuZGlu\nZ0FkZE9wPihwZW5kaW5nQWRkT3BzLnNpemUoKSk7CiAgICAgICAgd2hpbGUg\nKChwZW5kaW5nQWRkT3AgPSBwZW5kaW5nQWRkT3BzLnBvbGwoKSkgIT0gbnVs\nbCkgewogICAgICAgICAgICBhZGRUb0xlbmd0aCgtcGVuZGluZ0FkZE9wLmVu\ndHJ5TGVuZ3RoKTsKICAgICAgICAgICAgb3BzRHJhaW5lZC5hZGQocGVuZGlu\nZ0FkZE9wKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG9wc0RyYWluZWQ7\nCiAgICB9CgogICAgdm9pZCBlcnJvck91dFBlbmRpbmdBZGRzKGludCByYywg\nTGlzdDxQZW5kaW5nQWRkT3A+IG9wcykgewogICAgICAgIGZvciAoUGVuZGlu\nZ0FkZE9wIG9wIDogb3BzKSB7CiAgICAgICAgICAgIG9wLnN1Ym1pdENhbGxi\nYWNrKHJjKTsKICAgICAgICB9CiAgICB9CgogICAgdm9pZCBzZW5kQWRkU3Vj\nY2Vzc0NhbGxiYWNrcygpIHsKICAgICAgICAvLyBTdGFydCBmcm9tIHRoZSBo\nZWFkIG9mIHRoZSBxdWV1ZSBhbmQgcHJvY2VlZCB3aGlsZSB0aGVyZSBhcmUK\nICAgICAgICAvLyBlbnRyaWVzIHRoYXQgaGF2ZSBoYWQgYWxsIHRoZWlyIHJl\nc3BvbnNlcyBjb21lIGJhY2sKICAgICAgICBQZW5kaW5nQWRkT3AgcGVuZGlu\nZ0FkZE9wOwogICAgICAgIHdoaWxlICgocGVuZGluZ0FkZE9wID0gcGVuZGlu\nZ0FkZE9wcy5wZWVrKCkpICE9IG51bGwKICAgICAgICAgICAgICAgJiYgYmxv\nY2tBZGRDb21wbGV0aW9ucy5nZXQoKSA9PSAwKSB7CiAgICAgICAgICAgIGlm\nICghcGVuZGluZ0FkZE9wLmNvbXBsZXRlZCkgewogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBlbmRpbmdBZGRP\ncHMucmVtb3ZlKCk7CiAgICAgICAgICAgIGxhc3RBZGRDb25maXJtZWQgPSBw\nZW5kaW5nQWRkT3AuZW50cnlJZDsKICAgICAgICAgICAgcGVuZGluZ0FkZE9w\nLnN1Ym1pdENhbGxiYWNrKEJLRXhjZXB0aW9uLkNvZGUuT0spOwogICAgICAg\nIH0KCiAgICB9CgogICAgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+\nIHJlcGxhY2VCb29raWVJbk1ldGFkYXRhKGZpbmFsIEJvb2tpZVNvY2tldEFk\nZHJlc3MgYWRkciwgZmluYWwgaW50IGJvb2tpZUluZGV4KQogICAgICAgICAg\nICB0aHJvd3MgQktFeGNlcHRpb24uQktOb3RFbm91Z2hCb29raWVzRXhjZXB0\naW9uIHsKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIG5ld0Jvb2tpZTsK\nICAgICAgICBMT0cuaW5mbygiSGFuZGxpbmcgZmFpbHVyZSBvZiBib29raWU6\nIHt9IGluZGV4OiB7fSIsIGFkZHIsIGJvb2tpZUluZGV4KTsKICAgICAgICBm\naW5hbCBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gbmV3RW5zZW1i\nbGUgPSBuZXcgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+KCk7CiAg\nICAgICAgZmluYWwgbG9uZyBuZXdFbnNlbWJsZVN0YXJ0RW50cnkgPSBsYXN0\nQWRkQ29uZmlybWVkICsgMTsKCiAgICAgICAgLy8gYXZvaWQgcGFyYWxsZWwg\nZW5zZW1ibGUgY2hhbmdlcyB0byBzYW1lIGVuc2VtYmxlLgogICAgICAgIHN5\nbmNocm9uaXplZCAobWV0YWRhdGEpIHsKICAgICAgICAgICAgbmV3Qm9va2ll\nID0gYmsuYm9va2llV2F0Y2hlci5yZXBsYWNlQm9va2llKG1ldGFkYXRhLmN1\ncnJlbnRFbnNlbWJsZSwgYm9va2llSW5kZXgpOwoKICAgICAgICAgICAgbmV3\nRW5zZW1ibGUuYWRkQWxsKG1ldGFkYXRhLmN1cnJlbnRFbnNlbWJsZSk7CiAg\nICAgICAgICAgIG5ld0Vuc2VtYmxlLnNldChib29raWVJbmRleCwgbmV3Qm9v\na2llKTsKCiAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJDaGFuZ2luZyBlbnNlbWJs\nZSBmcm9tOiAiICsgbWV0YWRhdGEuY3VycmVudEVuc2VtYmxlCiAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiB0bzogIiArIG5ld0Vuc2VtYmxlICsgIiBm\nb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAg\nICAgKyAiIHN0YXJ0aW5nIGF0IGVudHJ5OiAiICsgKGxhc3RBZGRDb25maXJt\nZWQgKyAxKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1ldGFkYXRh\nLmFkZEVuc2VtYmxlKG5ld0Vuc2VtYmxlU3RhcnRFbnRyeSwgbmV3RW5zZW1i\nbGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3RW5zZW1ibGU7CiAg\nICB9CgogICAgdm9pZCBoYW5kbGVCb29raWVGYWlsdXJlKGZpbmFsIEJvb2tp\nZVNvY2tldEFkZHJlc3MgYWRkciwgZmluYWwgaW50IGJvb2tpZUluZGV4KSB7\nCiAgICAgICAgYmxvY2tBZGRDb21wbGV0aW9ucy5pbmNyZW1lbnRBbmRHZXQo\nKTsKCiAgICAgICAgc3luY2hyb25pemVkIChtZXRhZGF0YSkgewogICAgICAg\nICAgICBpZiAoIW1ldGFkYXRhLmN1cnJlbnRFbnNlbWJsZS5nZXQoYm9va2ll\nSW5kZXgpLmVxdWFscyhhZGRyKSkgewogICAgICAgICAgICAgICAgLy8gZW5z\nZW1ibGUgaGFzIGFscmVhZHkgY2hhbmdlZCwgZmFpbHVyZSBvZiB0aGlzIGFk\nZHIgaXMgaW1tYXRlcmlhbAogICAgICAgICAgICAgICAgTE9HLndhcm4oIldy\naXRlIGRpZCBub3Qgc3VjY2VlZCB0byB7fSwgYm9va2llSW5kZXgge30sIGJ1\ndCB3ZSBoYXZlIGFscmVhZHkgZml4ZWQgaXQuIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgIGFkZHIsIGJvb2tpZUluZGV4KTsKICAgICAgICAgICAgICAg\nIGJsb2NrQWRkQ29tcGxldGlvbnMuZGVjcmVtZW50QW5kR2V0KCk7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBBcnJheUxpc3Q8Qm9va2llU29ja2V0\nQWRkcmVzcz4gbmV3RW5zZW1ibGUgPSByZXBsYWNlQm9va2llSW5NZXRhZGF0\nYShhZGRyLCBib29raWVJbmRleCk7CgogICAgICAgICAgICAgICAgRW5zZW1i\nbGVJbmZvIGVuc2VtYmxlSW5mbyA9IG5ldyBFbnNlbWJsZUluZm8obmV3RW5z\nZW1ibGUsIGJvb2tpZUluZGV4LAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkcik7CiAg\nICAgICAgICAgICAgICB3cml0ZUxlZGdlckNvbmZpZyhuZXcgQ2hhbmdlRW5z\nZW1ibGVDYihlbnNlbWJsZUluZm8pKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nQktFeGNlcHRpb24uQktOb3RFbm91Z2hCb29raWVzRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IGdldCBhZGRp\ndGlvbmFsIGJvb2tpZSB0byAiCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyAicmVtYWtlIGVuc2VtYmxlLCBjbG9zaW5nIGxlZGdlcjogIiArIGxlZGdl\ncklkKTsKICAgICAgICAgICAgICAgIGhhbmRsZVVucmVjb3ZlcmFibGVFcnJv\nckR1cmluZ0FkZChlLmdldENvZGUoKSk7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLy8gQ29u\ndGFpbnMgbmV3bHkgcmVmb3JtZWQgZW5zZW1ibGUsIGJvb2tpZUluZGV4LCBm\nYWlsZWRCb29raWVBZGRyZXNzCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBj\nbGFzcyBFbnNlbWJsZUluZm8gewogICAgICAgIHByaXZhdGUgZmluYWwgQXJy\nYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+IG5ld0Vuc2VtYmxlOwogICAg\nICAgIHByaXZhdGUgZmluYWwgaW50IGJvb2tpZUluZGV4OwogICAgICAgIHBy\naXZhdGUgZmluYWwgQm9va2llU29ja2V0QWRkcmVzcyBhZGRyOwoKICAgICAg\nICBwdWJsaWMgRW5zZW1ibGVJbmZvKEFycmF5TGlzdDxCb29raWVTb2NrZXRB\nZGRyZXNzPiBuZXdFbnNlbWJsZSwgaW50IGJvb2tpZUluZGV4LAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBhZGRy\nKSB7CiAgICAgICAgICAgIHRoaXMubmV3RW5zZW1ibGUgPSBuZXdFbnNlbWJs\nZTsKICAgICAgICAgICAgdGhpcy5ib29raWVJbmRleCA9IGJvb2tpZUluZGV4\nOwogICAgICAgICAgICB0aGlzLmFkZHIgPSBhZGRyOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENhbGxiYWNrIHdoaWNoIGlzIHVwZGF0aW5n\nIHRoZSBsZWRnZXJNZXRhZGF0YSBpbiB6ayB3aXRoIHRoZSBuZXdseQogICAg\nICogcmVmb3JtZWQgZW5zZW1ibGUuIE9uIE1ldGFkYXRhVmVyc2lvbkV4Y2Vw\ndGlvbiwgd2lsbCByZXJlYWQgbGF0ZXN0CiAgICAgKiBsZWRnZXJNZXRhZGF0\nYSBhbmQgYWN0IHVwb24uCiAgICAgKi8KICAgIHByaXZhdGUgZmluYWwgY2xh\nc3MgQ2hhbmdlRW5zZW1ibGVDYiBleHRlbmRzIE9yZGVyZWRTYWZlR2VuZXJp\nY0NhbGxiYWNrPFZvaWQ+IHsKICAgICAgICBwcml2YXRlIGZpbmFsIEVuc2Vt\nYmxlSW5mbyBlbnNlbWJsZUluZm87CgogICAgICAgIENoYW5nZUVuc2VtYmxl\nQ2IoRW5zZW1ibGVJbmZvIGVuc2VtYmxlSW5mbykgewogICAgICAgICAgICBz\ndXBlcihiay5tYWluV29ya2VyUG9vbCwgbGVkZ2VySWQpOwogICAgICAgICAg\nICB0aGlzLmVuc2VtYmxlSW5mbyA9IGVuc2VtYmxlSW5mbzsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHNhZmVP\ncGVyYXRpb25Db21wbGV0ZShmaW5hbCBpbnQgcmMsIFZvaWQgcmVzdWx0KSB7\nCiAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk1ldGFk\nYXRhVmVyc2lvbkV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgLy8gV2Ug\nY2hhbmdlZCB0aGUgZW5zZW1ibGUsIGJ1dCBnb3QgYSB2ZXJzaW9uIGV4Y2Vw\ndGlvbi4gV2UKICAgICAgICAgICAgICAgIC8vIHNob3VsZCBzdGlsbCBjb25z\naWRlciB0aGlzIGFzIGFuIGVuc2VtYmxlIGNoYW5nZQogICAgICAgICAgICAg\nICAgZW5zZW1ibGVDaGFuZ2VDb3VudGVyLmluYygpOwogICAgICAgICAgICAg\nICAgcmVyZWFkTWV0YWRhdGEobmV3IFJlUmVhZExlZGdlck1ldGFkYXRhQ2Io\ncmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVu\nc2VtYmxlSW5mbykpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsK\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IHBlcnNpc3Qg\nbGVkZ2VyIG1ldGFkYXRhIHdoaWxlICIKICAgICAgICAgICAgICAgICAgICAg\nICAgICArICJjaGFuZ2luZyBlbnNlbWJsZSB0bzogIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICsgZW5zZW1ibGVJbmZvLm5ld0Vuc2VtYmxlCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiICwgY2xvc2luZyBsZWRnZXIiKTsK\nICAgICAgICAgICAgICAgIGhhbmRsZVVucmVjb3ZlcmFibGVFcnJvckR1cmlu\nZ0FkZChyYyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgYmxvY2tBZGRDb21wbGV0aW9ucy5kZWNyZW1lbnRB\nbmRHZXQoKTsKCiAgICAgICAgICAgIC8vIFdlJ3ZlIHN1Y2Nlc3NmdWxseSBj\naGFuZ2VkIGFuIGVuc2VtYmxlCiAgICAgICAgICAgIGVuc2VtYmxlQ2hhbmdl\nQ291bnRlci5pbmMoKTsKICAgICAgICAgICAgLy8gdGhlIGZhaWxlZCBib29r\naWUgaGFzIGJlZW4gcmVwbGFjZWQKICAgICAgICAgICAgdW5zZXRTdWNjZXNz\nQW5kU2VuZFdyaXRlUmVxdWVzdChlbnNlbWJsZUluZm8uYm9va2llSW5kZXgp\nOwogICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAgKiBDYWxsYmFjayB3\naGljaCBpcyByZWFkaW5nIHRoZSBsZWRnZXJNZXRhZGF0YSBwcmVzZW50IGlu\nIHprLiBUaGlzIHdpbGwgdHJ5CiAgICAgKiB0byByZXNvbHZlIHRoZSB2ZXJz\naW9uIGNvbmZsaWN0cy4KICAgICAqLwogICAgcHJpdmF0ZSBmaW5hbCBjbGFz\ncyBSZVJlYWRMZWRnZXJNZXRhZGF0YUNiIGV4dGVuZHMgT3JkZXJlZFNhZmVH\nZW5lcmljQ2FsbGJhY2s8TGVkZ2VyTWV0YWRhdGE+IHsKICAgICAgICBwcml2\nYXRlIGZpbmFsIGludCByYzsKICAgICAgICBwcml2YXRlIGZpbmFsIEVuc2Vt\nYmxlSW5mbyBlbnNlbWJsZUluZm87CgogICAgICAgIFJlUmVhZExlZGdlck1l\ndGFkYXRhQ2IoaW50IHJjLCBFbnNlbWJsZUluZm8gZW5zZW1ibGVJbmZvKSB7\nCiAgICAgICAgICAgIHN1cGVyKGJrLm1haW5Xb3JrZXJQb29sLCBsZWRnZXJJ\nZCk7CiAgICAgICAgICAgIHRoaXMucmMgPSByYzsKICAgICAgICAgICAgdGhp\ncy5lbnNlbWJsZUluZm8gPSBlbnNlbWJsZUluZm87CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBzYWZlT3BlcmF0\naW9uQ29tcGxldGUoaW50IG5ld3JjLCBMZWRnZXJNZXRhZGF0YSBuZXdNZXRh\nKSB7CiAgICAgICAgICAgIGlmIChuZXdyYyAhPSBCS0V4Y2VwdGlvbi5Db2Rl\nLk9LKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHJlYWRp\nbmcgbmV3IG1ldGFkYXRhIGZyb20gbGVkZ2VyICIKICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiYWZ0ZXIgY2hhbmdpbmcgZW5zZW1ibGUsIGNvZGU9IiAr\nIG5ld3JjKTsKICAgICAgICAgICAgICAgIGhhbmRsZVVucmVjb3ZlcmFibGVF\ncnJvckR1cmluZ0FkZChyYyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBpZiAoIXJlc29sdmVDb25mbGljdChuZXdNZXRhKSkgewog\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IHJlc29s\ndmUgbGVkZ2VyIG1ldGFkYXRhIGNvbmZsaWN0ICIKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgIndoaWxlIGNoYW5naW5nIGVuc2VtYmxlIHRvOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGVuc2VtYmxlSW5mby5u\nZXdFbnNlbWJsZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBv\nbGQgbWV0YSBkYXRhIGlzIFxuIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyBuZXcgU3RyaW5nKG1ldGFkYXRhLnNlcmlhbGl6ZSgpLCBVVEZfOCkK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIlxuLCBuZXcgbWV0YSBk\nYXRhIGlzIFxuIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBuZXcg\nU3RyaW5nKG5ld01ldGEuc2VyaWFsaXplKCksIFVURl84KQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiXG4gLGNsb3NpbmcgbGVkZ2VyIik7CiAg\nICAgICAgICAgICAgICAgICAgaGFuZGxlVW5yZWNvdmVyYWJsZUVycm9yRHVy\naW5nQWRkKHJjKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogU3BlY2lmaWMgcmVz\nb2x2ZSBjb25mbGljdHMgaGFwcGVuZWQgd2hlbiBtdWx0aXBsZSBib29raWVz\nIGZhaWx1cmVzIGluIHNhbWUgZW5zZW1ibGUuCiAgICAgICAgICogPHA+CiAg\nICAgICAgICogUmVzb2x2aW5nIHRoZSB2ZXJzaW9uIGNvbmZsaWN0cyBiZXR3\nZWVuIGxvY2FsIGxlZGdlck1ldGFkYXRhIGFuZCB6awogICAgICAgICAqIGxl\nZGdlck1ldGFkYXRhLiBUaGlzIHdpbGwgZG8gdGhlIGZvbGxvd2luZzoKICAg\nICAgICAgKiA8dWw+CiAgICAgICAgICogPGxpPgogICAgICAgICAqIGNoZWNr\nIHdoZXRoZXIgbGVkZ2VyTWV0YWRhdGEgc3RhdGUgbWF0Y2hlcyBvZiBsb2Nh\nbCBhbmQgems8L2xpPgogICAgICAgICAqIDxsaT4KICAgICAgICAgKiBpZiB0\naGUgemsgbGVkZ2VyTWV0YWRhdGEgc3RpbGwgY29udGFpbnMgdGhlIGZhaWxl\nZCBib29raWUsIHRoZW4KICAgICAgICAgKiB1cGRhdGUgem9va2VlcGVyIHdp\ndGggdGhlIG5ld0Jvb2tpZSBvdGhlcndpc2Ugc2VuZCB3cml0ZSByZXF1ZXN0\nPC9saT4KICAgICAgICAgKiA8L3VsPgogICAgICAgICAqIDwvcD4KICAgICAg\nICAgKi8KICAgICAgICBwcml2YXRlIGJvb2xlYW4gcmVzb2x2ZUNvbmZsaWN0\nKExlZGdlck1ldGFkYXRhIG5ld01ldGEpIHsKICAgICAgICAgICAgLy8gbWFr\nZSBzdXJlIHRoZSBsZWRnZXIgaXNuJ3QgY2xvc2VkIGJ5IG90aGVyIG9uZXMu\nCiAgICAgICAgICAgIGlmIChtZXRhZGF0YS5nZXRTdGF0ZSgpICE9IG5ld01l\ndGEuZ2V0U3RhdGUoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBXZSBzaG91bGQgY2hl\nY2sgbnVtYmVyIG9mIGVuc2VtYmxlcyBzaW5jZSB0aGVyZSBhcmUgdHdvIGtp\nbmRzIG9mIG1ldGFkYXRhIGNvbmZsaWN0czoKICAgICAgICAgICAgLy8gLSBD\nYXNlIDE6IE11bHRpcGxlIGJvb2tpZXMgaW52b2x2ZWQgaW4gZW5zZW1ibGUg\nY2hhbmdlLgogICAgICAgICAgICAvLyAgICAgICAgICAgTnVtYmVyIG9mIGVu\nc2VtYmxlcyBzaG91bGQgYmUgc2FtZSBpbiB0aGlzIGNhc2UuCiAgICAgICAg\nICAgIC8vIC0gQ2FzZSAyOiBSZWNvdmVyeSAoQXV0by9NYW51YWxseSkgcmVw\nbGFjZWQgZW5zZW1ibGUgYW5kIGVuc2VtYmxlIGNoYW5nZWQuCiAgICAgICAg\nICAgIC8vICAgICAgICAgICBUaGUgbWV0YWRhdGEgY2hhbmdlZCBkdWUgdG8g\nZW5zZW1ibGUgY2hhbmdlIHdvdWxkIGhhdmUgb25lIG1vcmUgZW5zZW1ibGUK\nICAgICAgICAgICAgLy8gICAgICAgICAgIHRoYW4gdGhlIG1ldGFkYXRhIGNo\nYW5nZWQgYnkgcmVjb3ZlcnkuCiAgICAgICAgICAgIGludCBkaWZmID0gbmV3\nTWV0YS5nZXRFbnNlbWJsZXMoKS5zaXplKCkgLSBtZXRhZGF0YS5nZXRFbnNl\nbWJsZXMoKS5zaXplKCk7CiAgICAgICAgICAgIGlmICgwICE9IGRpZmYpIHsK\nICAgICAgICAgICAgICAgIGlmICgtMSA9PSBkaWZmKSB7CiAgICAgICAgICAg\nICAgICAgICAgLy8gQ2FzZSAxOiBtZXRhZGF0YSBpcyBjaGFuZ2VkIGJ5IG90\naGVyIG9uZXMgKGUuZy4gUmVjb3ZlcnkpCiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHVwZGF0ZU1ldGFkYXRhSWZQb3NzaWJsZShuZXdNZXRhKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8g\nQ2FzZSAyOgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBJZiB0aGUg\nZmFpbGVkIHRoZSBib29raWUgaXMgc3RpbGwgZXhpc3RlZCBpbiB0aGUgbWV0\nYWRhdGEgKGluIHpvb2tlZXBlciksIGl0IG1lYW5zIHRoYXQKICAgICAgICAg\nICAgLy8gdGhlIGVuc2VtYmxlIGNoYW5nZSBvZiB0aGUgZmFpbGVkIGJvb2tp\nZSBpcyBmYWlsZWQgZHVlIHRvIG1ldGFkYXRhIGNvbmZsaWN0cy4gc28gdHJ5\nIHRvCiAgICAgICAgICAgIC8vIHVwZGF0ZSB0aGUgZW5zZW1ibGUgY2hhbmdl\nIG1ldGFkYXRhIGFnYWluLiBPdGhlcndpc2UsIGl0IG1lYW5zIHRoYXQgdGhl\nIGVuc2VtYmxlIGNoYW5nZQogICAgICAgICAgICAvLyBpcyBhbHJlYWR5IHN1\nY2NlZWQsIHVuc2V0IHRoZSBzdWNjZXNzIGFuZCByZS1hZGRpbmcgZW50cmll\ncy4KICAgICAgICAgICAgaWYgKG5ld01ldGEuY3VycmVudEVuc2VtYmxlLmdl\ndChlbnNlbWJsZUluZm8uYm9va2llSW5kZXgpLmVxdWFscygKICAgICAgICAg\nICAgICAgICAgICBlbnNlbWJsZUluZm8uYWRkcikpIHsKICAgICAgICAgICAg\nICAgIC8vIElmIHRoZSBpbi1tZW1vcnkgZGF0YSBkb2Vzbid0IGNvbnRhaW5z\nIHRoZSBmYWlsZWQgYm9va2llLCBpdCBtZWFucyB0aGUgZW5zZW1ibGUgY2hh\nbmdlCiAgICAgICAgICAgICAgICAvLyBkaWRuJ3QgZmluaXNoLCBzbyB0cnkg\ndG8gcmVzb2x2ZSBjb25mbGljdHMgd2l0aCB0aGUgbWV0YWRhdGEgcmVhZCBm\ncm9tIHpvb2tlZXBlciBhbmQKICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBl\nbnNlbWJsZSBjaGFuZ2VkIG1ldGFkYXRhIGFnYWluLgogICAgICAgICAgICAg\nICAgaWYgKCFtZXRhZGF0YS5jdXJyZW50RW5zZW1ibGUuZ2V0KGVuc2VtYmxl\nSW5mby5ib29raWVJbmRleCkKICAgICAgICAgICAgICAgICAgICAgICAgLmVx\ndWFscyhlbnNlbWJsZUluZm8uYWRkcikpIHsKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gdXBkYXRlTWV0YWRhdGFJZlBvc3NpYmxlKG5ld01ldGEpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgZW5zZW1ibGVDaGFuZ2VDb3VudGVyLmluYygpOwogICAgICAg\nICAgICAgICAgLy8gV2UndmUgc3VjY2Vzc2Z1bGx5IGNoYW5nZWQgYW4gZW5z\nZW1ibGUKICAgICAgICAgICAgICAgIC8vIHRoZSBmYWlsZWQgYm9va2llIGhh\ncyBiZWVuIHJlcGxhY2VkCiAgICAgICAgICAgICAgICBibG9ja0FkZENvbXBs\nZXRpb25zLmRlY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAgdW5z\nZXRTdWNjZXNzQW5kU2VuZFdyaXRlUmVxdWVzdChlbnNlbWJsZUluZm8uYm9v\na2llSW5kZXgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0\ncnVlOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIHVwZGF0\nZU1ldGFkYXRhSWZQb3NzaWJsZShMZWRnZXJNZXRhZGF0YSBuZXdNZXRhKSB7\nCiAgICAgICAgICAgIC8vIGlmIHRoZSBsb2NhbCBtZXRhZGF0YSBpcyBuZXdl\nciB0aGFuIHpvb2tlZXBlciBtZXRhZGF0YSwgaXQgbWVhbnMgdGhhdCBtZXRh\nZGF0YSBpcyB1cGRhdGVkCiAgICAgICAgICAgIC8vIGFnYWluIHdoZW4gaXQg\nd2FzIHRyeWluZyByZS1yZWFkaW5nIHRoZSBtZXRhdGFkYSwgcmUta2ljayB0\naGUgcmVyZWFkIGFnYWluCiAgICAgICAgICAgIGlmIChtZXRhZGF0YS5pc05l\nd2VyVGhhbihuZXdNZXRhKSkgewogICAgICAgICAgICAgICAgcmVyZWFkTWV0\nYWRhdGEodGhpcyk7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIG1ldGFk\nYXRhIGRvZXNuJ3QgY2hhbmdlZCBieSBvdGhlciBvbmVzLgogICAgICAgICAg\nICBpZiAobWV0YWRhdGEuaXNDb25mbGljdFdpdGgobmV3TWV0YSkpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBMT0cuaW5mbygiUmVzb2x2ZSBsZWRnZXIgbWV0YWRhdGEgY29u\nZmxpY3Qgd2hpbGUgY2hhbmdpbmcgZW5zZW1ibGUgdG86IHt9LCIKICAgICAg\nICAgICAgICAgICAgICArICIgb2xkIG1ldGEgZGF0YSBpcyBcbiB7fSBcbiwg\nbmV3IG1ldGEgZGF0YSBpcyBcbiB7fS4iLCBuZXcgT2JqZWN0W10gewogICAg\nICAgICAgICAgICAgICAgIGVuc2VtYmxlSW5mby5uZXdFbnNlbWJsZSwgbWV0\nYWRhdGEsIG5ld01ldGEgfSk7CiAgICAgICAgICAgIC8vIHVwZGF0ZSB6bm9k\nZSB2ZXJzaW9uCiAgICAgICAgICAgIG1ldGFkYXRhLnNldFZlcnNpb24obmV3\nTWV0YS5nZXRWZXJzaW9uKCkpOwogICAgICAgICAgICAvLyBtZXJnZSBlbnNl\nbWJsZSBpbmZvcyBmcm9tIG5ldyBtZXRhIGV4Y2VwdCBsYXN0IGVuc2VtYmxl\nCiAgICAgICAgICAgIC8vIHNpbmNlIHRoZXkgbWlnaHQgYmUgbW9kaWZpZWQg\nYnkgcmVjb3ZlcnkgdG9vbC4KICAgICAgICAgICAgbWV0YWRhdGEubWVyZ2VF\nbnNlbWJsZXMobmV3TWV0YS5nZXRFbnNlbWJsZXMoKSk7CiAgICAgICAgICAg\nIHdyaXRlTGVkZ2VyQ29uZmlnKG5ldyBDaGFuZ2VFbnNlbWJsZUNiKGVuc2Vt\nYmxlSW5mbykpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9\nCgogICAgfTsKCiAgICB2b2lkIHVuc2V0U3VjY2Vzc0FuZFNlbmRXcml0ZVJl\ncXVlc3QoZmluYWwgaW50IGJvb2tpZUluZGV4KSB7CiAgICAgICAgZm9yIChQ\nZW5kaW5nQWRkT3AgcGVuZGluZ0FkZE9wIDogcGVuZGluZ0FkZE9wcykgewog\nICAgICAgICAgICBwZW5kaW5nQWRkT3AudW5zZXRTdWNjZXNzQW5kU2VuZFdy\naXRlUmVxdWVzdChib29raWVJbmRleCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHZvaWQgcmVyZWFkTWV0YWRhdGEoZmluYWwgR2VuZXJpY0NhbGxiYWNrPExl\nZGdlck1ldGFkYXRhPiBjYikgewogICAgICAgIGJrLmdldExlZGdlck1hbmFn\nZXIoKS5yZWFkTGVkZ2VyTWV0YWRhdGEobGVkZ2VySWQsIGNiKTsKICAgIH0K\nCiAgICB2b2lkIHJlY292ZXIoZmluYWwgR2VuZXJpY0NhbGxiYWNrPFZvaWQ+\nIGNiKSB7CiAgICAgICAgYm9vbGVhbiB3YXNDbG9zZWQgPSBmYWxzZTsKICAg\nICAgICBib29sZWFuIHdhc0luUmVjb3ZlcnkgPSBmYWxzZTsKCiAgICAgICAg\nc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChtZXRhZGF0\nYS5pc0Nsb3NlZCgpKSB7CiAgICAgICAgICAgICAgICBsYXN0QWRkQ29uZmly\nbWVkID0gbGFzdEFkZFB1c2hlZCA9IG1ldGFkYXRhLmdldExhc3RFbnRyeUlk\nKCk7CiAgICAgICAgICAgICAgICBsZW5ndGggPSBtZXRhZGF0YS5nZXRMZW5n\ndGgoKTsKICAgICAgICAgICAgICAgIHdhc0Nsb3NlZCA9IHRydWU7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB3YXNDbG9zZWQgPSBm\nYWxzZTsKICAgICAgICAgICAgICAgIGlmIChtZXRhZGF0YS5pc0luUmVjb3Zl\ncnkoKSkgewogICAgICAgICAgICAgICAgICAgIHdhc0luUmVjb3ZlcnkgPSB0\ncnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICB3YXNJblJlY292ZXJ5ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAg\nICAgbWV0YWRhdGEubWFya0xlZGdlckluUmVjb3ZlcnkoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYg\nKHdhc0Nsb3NlZCkgewogICAgICAgICAgICAvLyBXZSBhcmUgYWxyZWFkeSBj\nbG9zZWQsIG5vdGhpbmcgdG8gZG8KICAgICAgICAgICAgY2Iub3BlcmF0aW9u\nQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgbnVsbCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmICh3YXNJblJlY292\nZXJ5KSB7CiAgICAgICAgICAgIC8vIGlmIG1ldGFkYXRhIGlzIGFscmVhZHkg\naW4gcmVjb3ZlciwgZG9udCB0cnkgdG8gd3JpdGUgYWdhaW4sCiAgICAgICAg\nICAgIC8vIGp1c3QgZG8gdGhlIHJlY292ZXJ5IGZyb20gdGhlIHN0YXJ0aW5n\nIHBvaW50CiAgICAgICAgICAgIG5ldyBMZWRnZXJSZWNvdmVyeU9wKExlZGdl\nckhhbmRsZS50aGlzLCBjYikuaW5pdGlhdGUoKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgd3JpdGVMZWRnZXJDb25maWcobmV3\nIE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrPFZvaWQ+KGJrLm1haW5Xb3Jr\nZXJQb29sLCBsZWRnZXJJZCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZXJhdGlvbkNvbXBsZXRlKGZp\nbmFsIGludCByYywgVm9pZCByZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlm\nIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4Y2Vw\ndGlvbikgewogICAgICAgICAgICAgICAgICAgIHJlcmVhZE1ldGFkYXRhKG5l\ndyBPcmRlcmVkU2FmZUdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4o\nYmsubWFpbldvcmtlclBvb2wsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsZWRnZXJJZCkgewogICAgICAgICAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgc2FmZU9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgTGVkZ2VyTWV0YWRh\ndGEgbmV3TWV0YSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25Db21wbGV0ZShyYywgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhID0gbmV3TWV0\nYTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvdmVyKGNi\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAg\nICAgICAgICAgfSBlbHNlIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk9L\nKSB7CiAgICAgICAgICAgICAgICAgICAgbmV3IExlZGdlclJlY292ZXJ5T3Ao\nTGVkZ2VySGFuZGxlLnRoaXMsIGNiKS5pbml0aWF0ZSgpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkVycm9yIHdyaXRpbmcgbGVkZ2VyIGNvbmZpZyAiICsgcmMgKyAiIG9mIGxl\nZGdlciAiICsgbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAgIGNiLm9w\nZXJhdGlvbkNvbXBsZXRlKHJjLCBudWxsKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIHN0YXRpYyBj\nbGFzcyBOb29wQ2xvc2VDYWxsYmFjayBpbXBsZW1lbnRzIENsb3NlQ2FsbGJh\nY2sgewogICAgICAgIHN0YXRpYyBOb29wQ2xvc2VDYWxsYmFjayBpbnN0YW5j\nZSA9IG5ldyBOb29wQ2xvc2VDYWxsYmFjaygpOwoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZUNvbXBsZXRlKGludCByYywg\nTGVkZ2VySGFuZGxlIGxoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIGlm\nIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAg\nICBMT0cud2FybigiQ2xvc2UgZmFpbGVkOiAiICsgQktFeGNlcHRpb24uZ2V0\nTWVzc2FnZShyYykpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIG5v\nb3AKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nU3luY1JlYWRDYWxsYmFjayBpbXBsZW1lbnRzIFJlYWRDYWxsYmFjayB7CiAg\nICAgICAgLyoqCiAgICAgICAgICogSW1wbGVtZW50YXRpb24gb2YgY2FsbGJh\nY2sgaW50ZXJmYWNlIGZvciBzeW5jaHJvbm91cyByZWFkIG1ldGhvZC4KICAg\nICAgICAgKgogICAgICAgICAqIEBwYXJhbSByYwogICAgICAgICAqICAgICAg\nICAgIHJldHVybiBjb2RlCiAgICAgICAgICogQHBhcmFtIGxlZGVyCiAgICAg\nICAgICogICAgICAgICAgbGVkZ2VyIGlkZW50aWZpZXIKICAgICAgICAgKiBA\ncGFyYW0gc2VxCiAgICAgICAgICogICAgICAgICAgc2VxdWVuY2Ugb2YgZW50\ncmllcwogICAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICAgKiAgICAgICAg\nICBjb250cm9sIG9iamVjdAogICAgICAgICAqLwogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHJlYWRDb21wbGV0ZShpbnQgcmMsIExl\nZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNlcSwgT2JqZWN0IGN0eCkg\newoKICAgICAgICAgICAgU3luY0NvdW50ZXIgY291bnRlciA9IChTeW5jQ291\nbnRlcikgY3R4OwogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGNvdW50ZXIp\nIHsKICAgICAgICAgICAgICAgIGNvdW50ZXIuc2V0U2VxdWVuY2Uoc2VxKTsK\nICAgICAgICAgICAgICAgIGNvdW50ZXIuc2V0cmMocmMpOwogICAgICAgICAg\nICAgICAgY291bnRlci5kZWMoKTsKICAgICAgICAgICAgICAgIGNvdW50ZXIu\nbm90aWZ5KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgY2xhc3MgU3luY0FkZENhbGxiYWNrIGltcGxlbWVu\ndHMgQWRkQ2FsbGJhY2sgewogICAgICAgIGxvbmcgZW50cnlJZCA9IC0xOwoK\nICAgICAgICAvKioKICAgICAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiBjYWxs\nYmFjayBpbnRlcmZhY2UgZm9yIHN5bmNocm9ub3VzIHJlYWQgbWV0aG9kLgog\nICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHJjCiAgICAgICAgICogICAg\nICAgICAgcmV0dXJuIGNvZGUKICAgICAgICAgKiBAcGFyYW0gbGVkZXIKICAg\nICAgICAgKiAgICAgICAgICBsZWRnZXIgaWRlbnRpZmllcgogICAgICAgICAq\nIEBwYXJhbSBlbnRyeQogICAgICAgICAqICAgICAgICAgIGVudHJ5IGlkZW50\naWZpZXIKICAgICAgICAgKiBAcGFyYW0gY3R4CiAgICAgICAgICogICAgICAg\nICAgY29udHJvbCBvYmplY3QKICAgICAgICAgKi8KICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgdm9pZCBhZGRDb21wbGV0ZShpbnQgcmMsIExl\nZGdlckhhbmRsZSBsaCwgbG9uZyBlbnRyeSwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICBTeW5jQ291bnRlciBjb3VudGVyID0gKFN5bmNDb3VudGVyKSBj\ndHg7CgogICAgICAgICAgICB0aGlzLmVudHJ5SWQgPSBlbnRyeTsKICAgICAg\nICAgICAgY291bnRlci5zZXRyYyhyYyk7CiAgICAgICAgICAgIGNvdW50ZXIu\nZGVjKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNs\nYXNzIFN5bmNSZWFkTGFzdENvbmZpcm1lZENhbGxiYWNrIGltcGxlbWVudHMg\nUmVhZExhc3RDb25maXJtZWRDYWxsYmFjayB7CiAgICAgICAgLyoqCiAgICAg\nICAgICogSW1wbGVtZW50YXRpb24gb2YgIGNhbGxiYWNrIGludGVyZmFjZSBm\nb3Igc3luY2hyb25vdXMgcmVhZCBsYXN0IGNvbmZpcm1lZCBtZXRob2QuCiAg\nICAgICAgICovCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgcmVhZExhc3RDb25maXJtZWRDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGFz\ndENvbmZpcm1lZCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBMYXN0Q29u\nZmlybWVkQ3R4IGxjQ3R4ID0gKExhc3RDb25maXJtZWRDdHgpIGN0eDsKCiAg\nICAgICAgICAgIHN5bmNocm9uaXplZChsY0N0eCkgewogICAgICAgICAgICAg\nICAgbGNDdHguc2V0UkMocmMpOwogICAgICAgICAgICAgICAgbGNDdHguc2V0\nTGFzdENvbmZpcm1lZChsYXN0Q29uZmlybWVkKTsKICAgICAgICAgICAgICAg\nIGxjQ3R4Lm5vdGlmeSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgc3RhdGljIGNsYXNzIFN5bmNDbG9zZUNhbGxiYWNr\nIGltcGxlbWVudHMgQ2xvc2VDYWxsYmFjayB7CiAgICAgICAgLyoqCiAgICAg\nICAgICogQ2xvc2UgY2FsbGJhY2sgbWV0aG9kCiAgICAgICAgICoKICAgICAg\nICAgKiBAcGFyYW0gcmMKICAgICAgICAgKiBAcGFyYW0gbGgKICAgICAgICAg\nKiBAcGFyYW0gY3R4CiAgICAgICAgICovCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgY2xvc2VDb21wbGV0ZShpbnQgcmMsIExlZGdl\nckhhbmRsZSBsaCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBTeW5jQ291\nbnRlciBjb3VudGVyID0gKFN5bmNDb3VudGVyKSBjdHg7CiAgICAgICAgICAg\nIGNvdW50ZXIuc2V0cmMocmMpOwogICAgICAgICAgICBzeW5jaHJvbml6ZWQg\nKGNvdW50ZXIpIHsKICAgICAgICAgICAgICAgIGNvdW50ZXIuZGVjKCk7CiAg\nICAgICAgICAgICAgICBjb3VudGVyLm5vdGlmeSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

