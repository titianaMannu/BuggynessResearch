{"sha":"a20f34ade6af14e2b892afb243827e796b78329b","node_id":"MDQ6QmxvYjE1NzU5NTY6YTIwZjM0YWRlNmFmMTRlMmI4OTJhZmIyNDM4MjdlNzk2Yjc4MzI5Yg==","size":19068,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a20f34ade6af14e2b892afb243827e796b78329b","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKaW1wb3J0IGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKaW1wb3J0IGNvbS5nb29n\nbGUucHJvdG9idWYuVGV4dEZvcm1hdDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5uZXQuQm9va2llU29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5MZWRnZXJNZXRh\nZGF0YUZvcm1hdDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJz\naW9uaW5nLlZlcnNpb247CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQgamF2YS5pby5C\ndWZmZXJlZFJlYWRlcjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247Cmlt\ncG9ydCBqYXZhLmlvLlN0cmluZ1JlYWRlcjsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2\nYS51dGlsLkl0ZXJhdG9yOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0\nIGphdmEudXRpbC5NYXAuRW50cnk7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVk\nTWFwOwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7CgppbXBvcnQgc3RhdGlj\nIGNvbS5nb29nbGUuY29tbW9uLmJhc2UuQ2hhcnNldHMuVVRGXzg7CgovKioK\nICogVGhpcyBjbGFzcyBlbmNhcHN1bGF0ZXMgYWxsIHRoZSBsZWRnZXIgbWV0\nYWRhdGEgdGhhdCBpcyBwZXJzaXN0ZW50bHkgc3RvcmVkCiAqIGluIHpvb2tl\nZXBlci4gSXQgcHJvdmlkZXMgcGFyc2luZyBhbmQgc2VyaWFsaXphdGlvbiBt\nZXRob2RzIG9mIHN1Y2ggbWV0YWRhdGEuCiAqCiAqLwpwdWJsaWMgY2xhc3Mg\nTGVkZ2VyTWV0YWRhdGEgewogICAgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cg\nPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihMZWRnZXJNZXRhZGF0YS5jbGFz\ncyk7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIGNsb3NlZCA9\nICJDTE9TRUQiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIGxT\ncGxpdHRlciA9ICJcbiI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJp\nbmcgdFNwbGl0dGVyID0gIlx0IjsKCiAgICAvLyBjYW4ndCB1c2UgLTEgZm9y\nIE5PVENMT1NFRCBiZWNhdXNlIHRoYXQgaXMgcmVzZXJ2ZWQgZm9yIGEgY2xv\nc2VkLCBlbXB0eQogICAgLy8gbGVkZ2VyCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBpbnQgTk9UQ0xPU0VEID0gLTEwMTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIGludCBJTl9SRUNPVkVSWSA9IC0xMDI7CgogICAgcHVibGljIHN0\nYXRpYyBmaW5hbCBpbnQgTE9XRVNUX0NPTVBBVF9NRVRBREFUQV9GT1JNQVRf\nVkVSU0lPTiA9IDA7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDVVJS\nRU5UX01FVEFEQVRBX0ZPUk1BVF9WRVJTSU9OID0gMjsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgU3RyaW5nIFZFUlNJT05fS0VZID0gIkJvb2tpZU1ldGFk\nYXRhRm9ybWF0VmVyc2lvbiI7CgogICAgcHJpdmF0ZSBpbnQgbWV0YWRhdGFG\nb3JtYXRWZXJzaW9uID0gMDsKCiAgICBwcml2YXRlIGludCBlbnNlbWJsZVNp\nemU7CiAgICBwcml2YXRlIGludCB3cml0ZVF1b3J1bVNpemU7CiAgICBwcml2\nYXRlIGludCBhY2tRdW9ydW1TaXplOwogICAgcHJpdmF0ZSBsb25nIGxlbmd0\naDsKICAgIHByaXZhdGUgbG9uZyBsYXN0RW50cnlJZDsKCiAgICBwcml2YXRl\nIExlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlIHN0YXRlOwogICAgcHJpdmF0\nZSBTb3J0ZWRNYXA8TG9uZywgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJl\nc3M+PiBlbnNlbWJsZXMgPQogICAgICAgIG5ldyBUcmVlTWFwPExvbmcsIEFy\ncmF5TGlzdDxCb29raWVTb2NrZXRBZGRyZXNzPj4oKTsKICAgIEFycmF5TGlz\ndDxCb29raWVTb2NrZXRBZGRyZXNzPiBjdXJyZW50RW5zZW1ibGU7CiAgICB2\nb2xhdGlsZSBWZXJzaW9uIHZlcnNpb24gPSBWZXJzaW9uLk5FVzsKCiAgICBw\ncml2YXRlIGJvb2xlYW4gaGFzUGFzc3dvcmQgPSBmYWxzZTsKICAgIHByaXZh\ndGUgTGVkZ2VyTWV0YWRhdGFGb3JtYXQuRGlnZXN0VHlwZSBkaWdlc3RUeXBl\nOwogICAgcHJpdmF0ZSBieXRlW10gcGFzc3dvcmQ7CgogICAgcHVibGljIExl\nZGdlck1ldGFkYXRhKGludCBlbnNlbWJsZVNpemUsIGludCB3cml0ZVF1b3J1\nbVNpemUsIGludCBhY2tRdW9ydW1TaXplLAogICAgICAgICAgICAgICAgICAg\nICAgICAgIEJvb2tLZWVwZXIuRGlnZXN0VHlwZSBkaWdlc3RUeXBlLCBieXRl\nW10gcGFzc3dvcmQpIHsKICAgICAgICB0aGlzLmVuc2VtYmxlU2l6ZSA9IGVu\nc2VtYmxlU2l6ZTsKICAgICAgICB0aGlzLndyaXRlUXVvcnVtU2l6ZSA9IHdy\naXRlUXVvcnVtU2l6ZTsKICAgICAgICB0aGlzLmFja1F1b3J1bVNpemUgPSBh\nY2tRdW9ydW1TaXplOwoKICAgICAgICAvKgogICAgICAgICAqIEl0IGlzIHNl\ndCBpbiBQZW5kaW5nUmVhZE9wLnJlYWRFbnRyeUNvbXBsZXRlLCBhbmQKICAg\nICAgICAgKiB3ZSByZWFkIGl0IGluIExlZGdlclJlY292ZXJ5T3AucmVhZENv\nbXBsZXRlLgogICAgICAgICAqLwogICAgICAgIHRoaXMubGVuZ3RoID0gMDsK\nICAgICAgICB0aGlzLnN0YXRlID0gTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU3Rh\ndGUuT1BFTjsKICAgICAgICB0aGlzLmxhc3RFbnRyeUlkID0gTGVkZ2VySGFu\nZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgdGhpcy5tZXRhZGF0YUZv\ncm1hdFZlcnNpb24gPSBDVVJSRU5UX01FVEFEQVRBX0ZPUk1BVF9WRVJTSU9O\nOwoKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBkaWdlc3RUeXBlLmVxdWFs\ncyhCb29rS2VlcGVyLkRpZ2VzdFR5cGUuTUFDKSA/CiAgICAgICAgICAgIExl\nZGdlck1ldGFkYXRhRm9ybWF0LkRpZ2VzdFR5cGUuSE1BQyA6IExlZGdlck1l\ndGFkYXRhRm9ybWF0LkRpZ2VzdFR5cGUuQ1JDMzI7CiAgICAgICAgdGhpcy5w\nYXNzd29yZCA9IEFycmF5cy5jb3B5T2YocGFzc3dvcmQsIHBhc3N3b3JkLmxl\nbmd0aCk7CiAgICAgICAgdGhpcy5oYXNQYXNzd29yZCA9IHRydWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDb3B5IENvbnN0cnVjdG9yLgogICAgICovCiAg\nICBMZWRnZXJNZXRhZGF0YShMZWRnZXJNZXRhZGF0YSBvdGhlcikgewogICAg\nICAgIHRoaXMuZW5zZW1ibGVTaXplID0gb3RoZXIuZW5zZW1ibGVTaXplOwog\nICAgICAgIHRoaXMud3JpdGVRdW9ydW1TaXplID0gb3RoZXIud3JpdGVRdW9y\ndW1TaXplOwogICAgICAgIHRoaXMuYWNrUXVvcnVtU2l6ZSA9IG90aGVyLmFj\na1F1b3J1bVNpemU7CiAgICAgICAgdGhpcy5sZW5ndGggPSBvdGhlci5sZW5n\ndGg7CiAgICAgICAgdGhpcy5sYXN0RW50cnlJZCA9IG90aGVyLmxhc3RFbnRy\neUlkOwogICAgICAgIHRoaXMubWV0YWRhdGFGb3JtYXRWZXJzaW9uID0gb3Ro\nZXIubWV0YWRhdGFGb3JtYXRWZXJzaW9uOwogICAgICAgIHRoaXMuc3RhdGUg\nPSBvdGhlci5zdGF0ZTsKICAgICAgICB0aGlzLnZlcnNpb24gPSBvdGhlci52\nZXJzaW9uOwogICAgICAgIHRoaXMuaGFzUGFzc3dvcmQgPSBvdGhlci5oYXNQ\nYXNzd29yZDsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBvdGhlci5kaWdl\nc3RUeXBlOwogICAgICAgIHRoaXMucGFzc3dvcmQgPSBuZXcgYnl0ZVtvdGhl\nci5wYXNzd29yZC5sZW5ndGhdOwogICAgICAgIFN5c3RlbS5hcnJheWNvcHko\nb3RoZXIucGFzc3dvcmQsIDAsIHRoaXMucGFzc3dvcmQsIDAsIG90aGVyLnBh\nc3N3b3JkLmxlbmd0aCk7CiAgICAgICAgLy8gY29weSB0aGUgZW5zZW1ibGVz\nCiAgICAgICAgZm9yIChFbnRyeTxMb25nLCBBcnJheUxpc3Q8Qm9va2llU29j\na2V0QWRkcmVzcz4+IGVudHJ5IDogb3RoZXIuZW5zZW1ibGVzLmVudHJ5U2V0\nKCkpIHsKICAgICAgICAgICAgbG9uZyBzdGFydEVudHJ5SWQgPSBlbnRyeS5n\nZXRLZXkoKTsKICAgICAgICAgICAgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFk\nZHJlc3M+IG5ld0Vuc2VtYmxlID0gbmV3IEFycmF5TGlzdDxCb29raWVTb2Nr\nZXRBZGRyZXNzPihlbnRyeS5nZXRWYWx1ZSgpKTsKICAgICAgICAgICAgdGhp\ncy5hZGRFbnNlbWJsZShzdGFydEVudHJ5SWQsIG5ld0Vuc2VtYmxlKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBMZWRnZXJNZXRhZGF0YSgpIHsK\nICAgICAgICB0aGlzKDAsIDAsIDAsIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5N\nQUMsIG5ldyBieXRlW10ge30pOwogICAgICAgIHRoaXMuaGFzUGFzc3dvcmQg\nPSBmYWxzZTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCB0aGUgTWFwIG9m\nIGJvb2tpZSBlbnNlbWJsZXMgZm9yIHRoZSB2YXJpb3VzIGxlZGdlciBmcmFn\nbWVudHMKICAgICAqIHRoYXQgbWFrZSB1cCB0aGUgbGVkZ2VyLgogICAgICoK\nICAgICAqIEByZXR1cm4gU29ydGVkTWFwIG9mIExlZGdlciBGcmFnbWVudHMg\nYW5kIHRoZSBjb3JyZXNwb25kaW5nCiAgICAgKiBib29raWUgZW5zZW1ibGVz\nIHRoYXQgc3RvcmUgdGhlIGVudHJpZXMuCiAgICAgKi8KICAgIHB1YmxpYyBT\nb3J0ZWRNYXA8TG9uZywgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+\nPiBnZXRFbnNlbWJsZXMoKSB7CiAgICAgICAgcmV0dXJuIGVuc2VtYmxlczsK\nICAgIH0KCiAgICB2b2lkIHNldEVuc2VtYmxlcyhTb3J0ZWRNYXA8TG9uZywg\nQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+PiBlbnNlbWJsZXMpIHsK\nICAgICAgICB0aGlzLmVuc2VtYmxlcyA9IGVuc2VtYmxlczsKICAgIH0KCiAg\nICBwdWJsaWMgaW50IGdldEVuc2VtYmxlU2l6ZSgpIHsKICAgICAgICByZXR1\ncm4gZW5zZW1ibGVTaXplOwogICAgfQoKICAgIHB1YmxpYyBpbnQgZ2V0V3Jp\ndGVRdW9ydW1TaXplKCkgewogICAgICAgIHJldHVybiB3cml0ZVF1b3J1bVNp\nemU7CiAgICB9CgogICAgcHVibGljIGludCBnZXRBY2tRdW9ydW1TaXplKCkg\newogICAgICAgIHJldHVybiBhY2tRdW9ydW1TaXplOwogICAgfQoKICAgIC8q\nKgogICAgICogSW4gdmVyc2lvbnMgNC4xLjAgYW5kIGJlbG93LCB0aGUgZGln\nZXN0IHR5cGUgYW5kIHBhc3N3b3JkIHdlcmUgbm90CiAgICAgKiBzdG9yZWQg\naW4gdGhlIG1ldGFkYXRhLgogICAgICoKICAgICAqIEByZXR1cm4gd2hldGhl\nciB0aGUgcGFzc3dvcmQgaGFzIGJlZW4gc3RvcmVkIGluIHRoZSBtZXRhZGF0\nYQogICAgICovCiAgICBib29sZWFuIGhhc1Bhc3N3b3JkKCkgewogICAgICAg\nIHJldHVybiBoYXNQYXNzd29yZDsKICAgIH0KCiAgICBieXRlW10gZ2V0UGFz\nc3dvcmQoKSB7CiAgICAgICAgcmV0dXJuIEFycmF5cy5jb3B5T2YocGFzc3dv\ncmQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICB9CgogICAgQm9va0tlZXBlci5E\naWdlc3RUeXBlIGdldERpZ2VzdFR5cGUoKSB7CiAgICAgICAgaWYgKGRpZ2Vz\ndFR5cGUuZXF1YWxzKExlZGdlck1ldGFkYXRhRm9ybWF0LkRpZ2VzdFR5cGUu\nSE1BQykpIHsKICAgICAgICAgICAgcmV0dXJuIEJvb2tLZWVwZXIuRGlnZXN0\nVHlwZS5NQUM7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJu\nIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMjsKICAgICAgICB9CiAgICB9\nCgogICAgcHVibGljIGxvbmcgZ2V0TGFzdEVudHJ5SWQoKSB7CiAgICAgICAg\ncmV0dXJuIGxhc3RFbnRyeUlkOwogICAgfQoKICAgIHB1YmxpYyBsb25nIGdl\ndExlbmd0aCgpIHsKICAgICAgICByZXR1cm4gbGVuZ3RoOwogICAgfQoKICAg\nIHZvaWQgc2V0TGVuZ3RoKGxvbmcgbGVuZ3RoKSB7CiAgICAgICAgdGhpcy5s\nZW5ndGggPSBsZW5ndGg7CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXND\nbG9zZWQoKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlID09IExlZGdlck1ldGFk\nYXRhRm9ybWF0LlN0YXRlLkNMT1NFRDsKICAgIH0KCiAgICBwdWJsaWMgYm9v\nbGVhbiBpc0luUmVjb3ZlcnkoKSB7CiAgICAgICAgcmV0dXJuIHN0YXRlID09\nIExlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlLklOX1JFQ09WRVJZOwogICAg\nfQoKICAgIExlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlIGdldFN0YXRlKCkg\newogICAgICAgIHJldHVybiBzdGF0ZTsKICAgIH0KCiAgICB2b2lkIHNldFN0\nYXRlKExlZGdlck1ldGFkYXRhRm9ybWF0LlN0YXRlIHN0YXRlKSB7CiAgICAg\nICAgdGhpcy5zdGF0ZSA9IHN0YXRlOwogICAgfQoKICAgIHZvaWQgbWFya0xl\nZGdlckluUmVjb3ZlcnkoKSB7CiAgICAgICAgc3RhdGUgPSBMZWRnZXJNZXRh\nZGF0YUZvcm1hdC5TdGF0ZS5JTl9SRUNPVkVSWTsKICAgIH0KCiAgICB2b2lk\nIGNsb3NlKGxvbmcgZW50cnlJZCkgewogICAgICAgIGxhc3RFbnRyeUlkID0g\nZW50cnlJZDsKICAgICAgICBzdGF0ZSA9IExlZGdlck1ldGFkYXRhRm9ybWF0\nLlN0YXRlLkNMT1NFRDsKICAgIH0KCiAgICB2b2lkIGFkZEVuc2VtYmxlKGxv\nbmcgc3RhcnRFbnRyeUlkLCBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVz\ncz4gZW5zZW1ibGUpIHsKICAgICAgICBhc3NlcnQgZW5zZW1ibGVzLmlzRW1w\ndHkoKSB8fCBzdGFydEVudHJ5SWQgPj0gZW5zZW1ibGVzLmxhc3RLZXkoKTsK\nCiAgICAgICAgZW5zZW1ibGVzLnB1dChzdGFydEVudHJ5SWQsIGVuc2VtYmxl\nKTsKICAgICAgICBjdXJyZW50RW5zZW1ibGUgPSBlbnNlbWJsZTsKICAgIH0K\nCiAgICBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gZ2V0RW5zZW1i\nbGUobG9uZyBlbnRyeUlkKSB7CiAgICAgICAgLy8gdGhlIGhlYWQgbWFwIGNh\nbm5vdCBiZSBlbXB0eSwgc2luY2Ugd2UgaW5zZXJ0IGFuIGVuc2VtYmxlIGZv\ncgogICAgICAgIC8vIGVudHJ5LWlkIDAsIHJpZ2h0IHdoZW4gd2Ugc3RhcnQK\nICAgICAgICByZXR1cm4gZW5zZW1ibGVzLmdldChlbnNlbWJsZXMuaGVhZE1h\ncChlbnRyeUlkICsgMSkubGFzdEtleSgpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIHRoZSBlbnRyeSBpZCBncmVhdGVyIHRoYW4gdGhlIGdpdmVuIGVudHJ5\nLWlkIGF0IHdoaWNoIHRoZSBuZXh0IGVuc2VtYmxlIGNoYW5nZSB0YWtlcwog\nICAgICogcGxhY2UKICAgICAqCiAgICAgKiBAcGFyYW0gZW50cnlJZAogICAg\nICogQHJldHVybiB0aGUgZW50cnkgaWQgb2YgdGhlIG5leHQgZW5zZW1ibGUg\nY2hhbmdlICgtMSBpZiBubyBmdXJ0aGVyIGVuc2VtYmxlIGNoYW5nZXMpIAog\nICAgICovCiAgICBsb25nIGdldE5leHRFbnNlbWJsZUNoYW5nZShsb25nIGVu\ndHJ5SWQpIHsKICAgICAgICBTb3J0ZWRNYXA8TG9uZywgQXJyYXlMaXN0PEJv\nb2tpZVNvY2tldEFkZHJlc3M+PiB0YWlsTWFwID0gZW5zZW1ibGVzLnRhaWxN\nYXAoZW50cnlJZCArIDEpOwoKICAgICAgICBpZiAodGFpbE1hcC5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICAgIHJldHVybiB0YWlsTWFwLmZpcnN0S2V5KCk7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJhdGVzIGEgYnl0ZSBh\ncnJheSBvZiB0aGlzIG9iamVjdAogICAgICoKICAgICAqIEByZXR1cm4gdGhl\nIG1ldGFkYXRhIHNlcmlhbGl6ZWQgaW50byBhIGJ5dGUgYXJyYXkKICAgICAq\nLwogICAgcHVibGljIGJ5dGVbXSBzZXJpYWxpemUoKSB7CiAgICAgICAgaWYg\nKG1ldGFkYXRhRm9ybWF0VmVyc2lvbiA9PSAxKSB7CiAgICAgICAgICAgIHJl\ndHVybiBzZXJpYWxpemVWZXJzaW9uMSgpOwogICAgICAgIH0KICAgICAgICBM\nZWRnZXJNZXRhZGF0YUZvcm1hdC5CdWlsZGVyIGJ1aWxkZXIgPSBMZWRnZXJN\nZXRhZGF0YUZvcm1hdC5uZXdCdWlsZGVyKCk7CiAgICAgICAgYnVpbGRlci5z\nZXRRdW9ydW1TaXplKHdyaXRlUXVvcnVtU2l6ZSkuc2V0QWNrUXVvcnVtU2l6\nZShhY2tRdW9ydW1TaXplKQogICAgICAgICAgICAuc2V0RW5zZW1ibGVTaXpl\nKGVuc2VtYmxlU2l6ZSkuc2V0TGVuZ3RoKGxlbmd0aCkKICAgICAgICAgICAg\nLnNldFN0YXRlKHN0YXRlKS5zZXRMYXN0RW50cnlJZChsYXN0RW50cnlJZCk7\nCgogICAgICAgIGlmIChoYXNQYXNzd29yZCkgewogICAgICAgICAgICBidWls\nZGVyLnNldERpZ2VzdFR5cGUoZGlnZXN0VHlwZSkuc2V0UGFzc3dvcmQoQnl0\nZVN0cmluZy5jb3B5RnJvbShwYXNzd29yZCkpOwogICAgICAgIH0KCiAgICAg\nICAgZm9yIChNYXAuRW50cnk8TG9uZywgQXJyYXlMaXN0PEJvb2tpZVNvY2tl\ndEFkZHJlc3M+PiBlbnRyeSA6IGVuc2VtYmxlcy5lbnRyeVNldCgpKSB7CiAg\nICAgICAgICAgIExlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21lbnQuQnVpbGRl\nciBzZWdtZW50QnVpbGRlciA9IExlZGdlck1ldGFkYXRhRm9ybWF0LlNlZ21l\nbnQubmV3QnVpbGRlcigpOwogICAgICAgICAgICBzZWdtZW50QnVpbGRlci5z\nZXRGaXJzdEVudHJ5SWQoZW50cnkuZ2V0S2V5KCkpOwogICAgICAgICAgICBm\nb3IgKEJvb2tpZVNvY2tldEFkZHJlc3MgYWRkciA6IGVudHJ5LmdldFZhbHVl\nKCkpIHsKICAgICAgICAgICAgICAgIHNlZ21lbnRCdWlsZGVyLmFkZEVuc2Vt\nYmxlTWVtYmVyKGFkZHIudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgYnVpbGRlci5hZGRTZWdtZW50KHNlZ21lbnRCdWlsZGVyLmJ1\naWxkKCkpOwogICAgICAgIH0KCiAgICAgICAgU3RyaW5nQnVpbGRlciBzID0g\nbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzLmFwcGVuZChWRVJTSU9O\nX0tFWSkuYXBwZW5kKHRTcGxpdHRlcikuYXBwZW5kKENVUlJFTlRfTUVUQURB\nVEFfRk9STUFUX1ZFUlNJT04pLmFwcGVuZChsU3BsaXR0ZXIpOwogICAgICAg\nIHMuYXBwZW5kKFRleHRGb3JtYXQucHJpbnRUb1N0cmluZyhidWlsZGVyLmJ1\naWxkKCkpKTsKICAgICAgICBMT0cuZGVidWcoIlNlcmlhbGl6ZWQgY29uZmln\nOiB7fSIsIHMpOwogICAgICAgIHJldHVybiBzLnRvU3RyaW5nKCkuZ2V0Qnl0\nZXMoVVRGXzgpOwogICAgfQoKICAgIHByaXZhdGUgYnl0ZVtdIHNlcmlhbGl6\nZVZlcnNpb24xKCkgewogICAgICAgIFN0cmluZ0J1aWxkZXIgcyA9IG5ldyBT\ndHJpbmdCdWlsZGVyKCk7CiAgICAgICAgcy5hcHBlbmQoVkVSU0lPTl9LRVkp\nLmFwcGVuZCh0U3BsaXR0ZXIpLmFwcGVuZChtZXRhZGF0YUZvcm1hdFZlcnNp\nb24pLmFwcGVuZChsU3BsaXR0ZXIpOwogICAgICAgIHMuYXBwZW5kKHdyaXRl\nUXVvcnVtU2l6ZSkuYXBwZW5kKGxTcGxpdHRlcikuYXBwZW5kKGVuc2VtYmxl\nU2l6ZSkuYXBwZW5kKGxTcGxpdHRlcikuYXBwZW5kKGxlbmd0aCk7CgogICAg\nICAgIGZvciAoTWFwLkVudHJ5PExvbmcsIEFycmF5TGlzdDxCb29raWVTb2Nr\nZXRBZGRyZXNzPj4gZW50cnkgOiBlbnNlbWJsZXMuZW50cnlTZXQoKSkgewog\nICAgICAgICAgICBzLmFwcGVuZChsU3BsaXR0ZXIpLmFwcGVuZChlbnRyeS5n\nZXRLZXkoKSk7CiAgICAgICAgICAgIGZvciAoQm9va2llU29ja2V0QWRkcmVz\ncyBhZGRyIDogZW50cnkuZ2V0VmFsdWUoKSkgewogICAgICAgICAgICAgICAg\ncy5hcHBlbmQodFNwbGl0dGVyKTsKICAgICAgICAgICAgICAgIHMuYXBwZW5k\nKGFkZHIudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIGlmIChzdGF0ZSA9PSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0\nZS5JTl9SRUNPVkVSWSkgewogICAgICAgICAgICBzLmFwcGVuZChsU3BsaXR0\nZXIpLmFwcGVuZChJTl9SRUNPVkVSWSkuYXBwZW5kKHRTcGxpdHRlcikuYXBw\nZW5kKGNsb3NlZCk7CiAgICAgICAgfSBlbHNlIGlmIChzdGF0ZSA9PSBMZWRn\nZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZS5DTE9TRUQpIHsKICAgICAgICAgICAg\ncy5hcHBlbmQobFNwbGl0dGVyKS5hcHBlbmQoZ2V0TGFzdEVudHJ5SWQoKSku\nYXBwZW5kKHRTcGxpdHRlcikuYXBwZW5kKGNsb3NlZCk7CiAgICAgICAgfQoK\nICAgICAgICBMT0cuZGVidWcoIlNlcmlhbGl6ZWQgY29uZmlnOiB7fSIsIHMp\nOwoKICAgICAgICByZXR1cm4gcy50b1N0cmluZygpLmdldEJ5dGVzKFVURl84\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFBhcnNlcyBhIGdpdmVuIGJ5dGUg\nYXJyYXkgYW5kIHRyYW5zZm9ybXMgaW50byBhIExlZGdlckNvbmZpZyBvYmpl\nY3QKICAgICAqCiAgICAgKiBAcGFyYW0gYnl0ZXMKICAgICAqICAgICAgICAg\nICAgYnl0ZSBhcnJheSB0byBwYXJzZQogICAgICogQHBhcmFtIHZlcnNpb24K\nICAgICAqICAgICAgICAgICAgdmVyc2lvbiBvZiB0aGUgbGVkZ2VyIG1ldGFk\nYXRhCiAgICAgKiBAcmV0dXJuIExlZGdlckNvbmZpZwogICAgICogQHRocm93\ncyBJT0V4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgaWYgdGhlIGdpdmVu\nIGJ5dGVbXSBjYW5ub3QgYmUgcGFyc2VkCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgTGVkZ2VyTWV0YWRhdGEgcGFyc2VDb25maWcoYnl0ZVtdIGJ5dGVz\nLCBWZXJzaW9uIHZlcnNpb24pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgTGVkZ2VyTWV0YWRhdGEgbGMgPSBuZXcgTGVkZ2VyTWV0YWRhdGEoKTsK\nICAgICAgICBsYy52ZXJzaW9uID0gdmVyc2lvbjsKCiAgICAgICAgU3RyaW5n\nIGNvbmZpZyA9IG5ldyBTdHJpbmcoYnl0ZXMsIFVURl84KTsKCiAgICAgICAg\nTE9HLmRlYnVnKCJQYXJzaW5nIENvbmZpZzoge30iLCBjb25maWcpOwogICAg\nICAgIEJ1ZmZlcmVkUmVhZGVyIHJlYWRlciA9IG5ldyBCdWZmZXJlZFJlYWRl\ncihuZXcgU3RyaW5nUmVhZGVyKGNvbmZpZykpOwogICAgICAgIFN0cmluZyB2\nZXJzaW9uTGluZSA9IHJlYWRlci5yZWFkTGluZSgpOwogICAgICAgIGlmICh2\nZXJzaW9uTGluZSA9PSBudWxsKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbigiSW52YWxpZCBtZXRhZGF0YS4gQ29udGVudCBtaXNzaW5n\nIik7CiAgICAgICAgfQogICAgICAgIGlmICh2ZXJzaW9uTGluZS5zdGFydHNX\naXRoKFZFUlNJT05fS0VZKSkgewogICAgICAgICAgICBTdHJpbmcgcGFydHNb\nXSA9IHZlcnNpb25MaW5lLnNwbGl0KHRTcGxpdHRlcik7CiAgICAgICAgICAg\nIGxjLm1ldGFkYXRhRm9ybWF0VmVyc2lvbiA9IG5ldyBJbnRlZ2VyKHBhcnRz\nWzFdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBpZiBubyB2\nZXJzaW9uIGlzIHNldCwgdGFrZSBpdCB0byBiZSB2ZXJzaW9uIDEKICAgICAg\nICAgICAgLy8gYXMgdGhlIHBhcnNpbmcgaXMgdGhlIHNhbWUgYXMgd2hhdCB3\nZSBoYWQgYmVmb3JlCiAgICAgICAgICAgIC8vIHdlIGludHJvZHVjZSB2ZXJz\naW9ucwogICAgICAgICAgICBsYy5tZXRhZGF0YUZvcm1hdFZlcnNpb24gPSAx\nOwogICAgICAgICAgICAvLyByZXNldCB0aGUgcmVhZGVyCiAgICAgICAgICAg\nIHJlYWRlci5jbG9zZSgpOwogICAgICAgICAgICByZWFkZXIgPSBuZXcgQnVm\nZmVyZWRSZWFkZXIobmV3IFN0cmluZ1JlYWRlcihjb25maWcpKTsKICAgICAg\nICB9CgogICAgICAgIGlmIChsYy5tZXRhZGF0YUZvcm1hdFZlcnNpb24gPCBM\nT1dFU1RfQ09NUEFUX01FVEFEQVRBX0ZPUk1BVF9WRVJTSU9OCiAgICAgICAg\nICAgIHx8IGxjLm1ldGFkYXRhRm9ybWF0VmVyc2lvbiA+IENVUlJFTlRfTUVU\nQURBVEFfRk9STUFUX1ZFUlNJT04pIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKCJNZXRhZGF0YSB2ZXJzaW9uIG5vdCBjb21wYXRpYmxl\nLiBFeHBlY3RlZCBiZXR3ZWVuICIKICAgICAgICAgICAgICAgICAgICArIExP\nV0VTVF9DT01QQVRfTUVUQURBVEFfRk9STUFUX1ZFUlNJT04gKyAiIGFuZCAi\nICsgQ1VSUkVOVF9NRVRBREFUQV9GT1JNQVRfVkVSU0lPTgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBidXQgZ290ICIgKyBsYy5t\nZXRhZGF0YUZvcm1hdFZlcnNpb24pOwogICAgICAgIH0KCiAgICAgICAgaWYg\nKGxjLm1ldGFkYXRhRm9ybWF0VmVyc2lvbiA9PSAxKSB7CiAgICAgICAgICAg\nIHJldHVybiBwYXJzZVZlcnNpb24xQ29uZmlnKGxjLCByZWFkZXIpOwogICAg\nICAgIH0KCiAgICAgICAgTGVkZ2VyTWV0YWRhdGFGb3JtYXQuQnVpbGRlciBi\ndWlsZGVyID0gTGVkZ2VyTWV0YWRhdGFGb3JtYXQubmV3QnVpbGRlcigpOwog\nICAgICAgIFRleHRGb3JtYXQubWVyZ2UocmVhZGVyLCBidWlsZGVyKTsKICAg\nICAgICBMZWRnZXJNZXRhZGF0YUZvcm1hdCBkYXRhID0gYnVpbGRlci5idWls\nZCgpOwogICAgICAgIGxjLndyaXRlUXVvcnVtU2l6ZSA9IGRhdGEuZ2V0UXVv\ncnVtU2l6ZSgpOwogICAgICAgIGlmIChkYXRhLmhhc0Fja1F1b3J1bVNpemUo\nKSkgewogICAgICAgICAgICBsYy5hY2tRdW9ydW1TaXplID0gZGF0YS5nZXRB\nY2tRdW9ydW1TaXplKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nbGMuYWNrUXVvcnVtU2l6ZSA9IGxjLndyaXRlUXVvcnVtU2l6ZTsKICAgICAg\nICB9CgogICAgICAgIGxjLmVuc2VtYmxlU2l6ZSA9IGRhdGEuZ2V0RW5zZW1i\nbGVTaXplKCk7CiAgICAgICAgbGMubGVuZ3RoID0gZGF0YS5nZXRMZW5ndGgo\nKTsKICAgICAgICBsYy5zdGF0ZSA9IGRhdGEuZ2V0U3RhdGUoKTsKICAgICAg\nICBsYy5sYXN0RW50cnlJZCA9IGRhdGEuZ2V0TGFzdEVudHJ5SWQoKTsKCiAg\nICAgICAgaWYgKGRhdGEuaGFzUGFzc3dvcmQoKSkgewogICAgICAgICAgICBs\nYy5kaWdlc3RUeXBlID0gZGF0YS5nZXREaWdlc3RUeXBlKCk7CiAgICAgICAg\nICAgIGxjLnBhc3N3b3JkID0gZGF0YS5nZXRQYXNzd29yZCgpLnRvQnl0ZUFy\ncmF5KCk7CiAgICAgICAgICAgIGxjLmhhc1Bhc3N3b3JkID0gdHJ1ZTsKICAg\nICAgICB9CgogICAgICAgIGZvciAoTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU2Vn\nbWVudCBzIDogZGF0YS5nZXRTZWdtZW50TGlzdCgpKSB7CiAgICAgICAgICAg\nIEFycmF5TGlzdDxCb29raWVTb2NrZXRBZGRyZXNzPiBhZGRycyA9IG5ldyBB\ncnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4oKTsKICAgICAgICAgICAg\nZm9yIChTdHJpbmcgbWVtYmVyIDogcy5nZXRFbnNlbWJsZU1lbWJlckxpc3Qo\nKSkgewogICAgICAgICAgICAgICAgYWRkcnMuYWRkKG5ldyBCb29raWVTb2Nr\nZXRBZGRyZXNzKG1lbWJlcikpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGxjLmFkZEVuc2VtYmxlKHMuZ2V0Rmlyc3RFbnRyeUlkKCksIGFkZHJzKTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxjOwogICAgfQoKICAgIHN0YXRp\nYyBMZWRnZXJNZXRhZGF0YSBwYXJzZVZlcnNpb24xQ29uZmlnKExlZGdlck1l\ndGFkYXRhIGxjLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQnVmZmVyZWRSZWFkZXIgcmVhZGVyKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxjLndyaXRl\nUXVvcnVtU2l6ZSA9IGxjLmFja1F1b3J1bVNpemUgPSBuZXcgSW50ZWdlcihy\nZWFkZXIucmVhZExpbmUoKSk7CiAgICAgICAgICAgIGxjLmVuc2VtYmxlU2l6\nZSA9IG5ldyBJbnRlZ2VyKHJlYWRlci5yZWFkTGluZSgpKTsKICAgICAgICAg\nICAgbGMubGVuZ3RoID0gbmV3IExvbmcocmVhZGVyLnJlYWRMaW5lKCkpOwoK\nICAgICAgICAgICAgU3RyaW5nIGxpbmUgPSByZWFkZXIucmVhZExpbmUoKTsK\nICAgICAgICAgICAgd2hpbGUgKGxpbmUgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgU3RyaW5nIHBhcnRzW10gPSBsaW5lLnNwbGl0KHRTcGxpdHRlcik7\nCgogICAgICAgICAgICAgICAgaWYgKHBhcnRzWzFdLmVxdWFscyhjbG9zZWQp\nKSB7CiAgICAgICAgICAgICAgICAgICAgTG9uZyBsID0gbmV3IExvbmcocGFy\ndHNbMF0pOwogICAgICAgICAgICAgICAgICAgIGlmIChsID09IElOX1JFQ09W\nRVJZKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxjLnN0YXRlID0gTGVk\nZ2VyTWV0YWRhdGFGb3JtYXQuU3RhdGUuSU5fUkVDT1ZFUlk7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbGMuc3RhdGUgPSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZS5DTE9TRUQ7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxjLmxhc3RFbnRyeUlkID0gbDsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIGxjLnN0YXRlID0gTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU3RhdGUuT1BF\nTjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBBcnJheUxp\nc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gYWRkcnMgPSBuZXcgQXJyYXlMaXN0\nPEJvb2tpZVNvY2tldEFkZHJlc3M+KCk7CiAgICAgICAgICAgICAgICBmb3Ig\nKGludCBqID0gMTsgaiA8IHBhcnRzLmxlbmd0aDsgaisrKSB7CiAgICAgICAg\nICAgICAgICAgICAgYWRkcnMuYWRkKG5ldyBCb29raWVTb2NrZXRBZGRyZXNz\nKHBhcnRzW2pdKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBsYy5hZGRFbnNlbWJsZShuZXcgTG9uZyhwYXJ0c1swXSksIGFkZHJzKTsK\nICAgICAgICAgICAgICAgIGxpbmUgPSByZWFkZXIucmVhZExpbmUoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbihl\nKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxjOwogICAgfQoKICAgIC8q\nKgogICAgICogVXBkYXRlcyB0aGUgdmVyc2lvbiBvZiB0aGlzIG1ldGFkYXRh\nLgogICAgICoKICAgICAqIEBwYXJhbSB2IFZlcnNpb24KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc2V0VmVyc2lvbihWZXJzaW9uIHYpIHsKICAgICAgICB0\naGlzLnZlcnNpb24gPSB2OwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJu\ncyB0aGUgbGFzdCB2ZXJzaW9uLgogICAgICoKICAgICAqIEByZXR1cm4gdmVy\nc2lvbgogICAgICovCiAgICBwdWJsaWMgVmVyc2lvbiBnZXRWZXJzaW9uKCkg\newogICAgICAgIHJldHVybiB0aGlzLnZlcnNpb247CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJcyB0aGUgbWV0YWRhdGEgbmV3ZXIgdGhhbiBnaXZlbiA8aT5u\nZXdNZXRhPC9pPi4KICAgICAqCiAgICAgKiBAcGFyYW0gbmV3TWV0YSB0aGUg\nbWV0YWRhdGEgdG8gY29tcGFyZQogICAgICogQHJldHVybiB0cnVlIGlmIDxp\nPnRoaXM8L2k+IGlzIG5ld2VyIHRoYW4gPGk+bmV3TWV0YTwvaT4sIGZhbHNl\nIG90aGVyd2lzZQogICAgICovCiAgICBib29sZWFuIGlzTmV3ZXJUaGFuKExl\nZGdlck1ldGFkYXRhIG5ld01ldGEpIHsKICAgICAgICBpZiAobnVsbCA9PSB2\nZXJzaW9uKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIFZlcnNpb24uT2NjdXJyZWQuQUZURVIgPT0gdmVy\nc2lvbi5jb21wYXJlKG5ld01ldGEudmVyc2lvbik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBJcyB0aGUgbWV0YWRhdGEgY29uZmxpY3Qgd2l0aCBuZXcgdXBk\nYXRlZCBtZXRhZGF0YS4KICAgICAqCiAgICAgKiBAcGFyYW0gbmV3TWV0YQog\nICAgICogICAgICAgICAgUmUtcmVhZCBtZXRhZGF0YQogICAgICogQHJldHVy\nbiB0cnVlIGlmIHRoZSBtZXRhZGF0YSBpcyBjb25mbGljdC4KICAgICAqLwog\nICAgYm9vbGVhbiBpc0NvbmZsaWN0V2l0aChMZWRnZXJNZXRhZGF0YSBuZXdN\nZXRhKSB7CiAgICAgICAgLyoKICAgICAgICAgKiAgaWYgbGVuZ3RoICYgY2xv\nc2UgaGF2ZSBjaGFuZ2VkLCB0aGVuIGFub3RoZXIgY2xpZW50IGhhcwogICAg\nICAgICAqICBvcGVuZWQgdGhlIGxlZGdlciwgY2FuJ3QgcmVzb2x2ZSB0aGlz\nIGNvbmZsaWN0LgogICAgICAgICAqLwoKICAgICAgICBpZiAobWV0YWRhdGFG\nb3JtYXRWZXJzaW9uICE9IG5ld01ldGEubWV0YWRhdGFGb3JtYXRWZXJzaW9u\nIHx8CiAgICAgICAgICAgIGVuc2VtYmxlU2l6ZSAhPSBuZXdNZXRhLmVuc2Vt\nYmxlU2l6ZSB8fAogICAgICAgICAgICB3cml0ZVF1b3J1bVNpemUgIT0gbmV3\nTWV0YS53cml0ZVF1b3J1bVNpemUgfHwKICAgICAgICAgICAgYWNrUXVvcnVt\nU2l6ZSAhPSBuZXdNZXRhLmFja1F1b3J1bVNpemUgfHwKICAgICAgICAgICAg\nbGVuZ3RoICE9IG5ld01ldGEubGVuZ3RoIHx8CiAgICAgICAgICAgIHN0YXRl\nICE9IG5ld01ldGEuc3RhdGUgfHwKICAgICAgICAgICAgIWRpZ2VzdFR5cGUu\nZXF1YWxzKG5ld01ldGEuZGlnZXN0VHlwZSkgfHwKICAgICAgICAgICAgIUFy\ncmF5cy5lcXVhbHMocGFzc3dvcmQsIG5ld01ldGEucGFzc3dvcmQpKSB7CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAo\nc3RhdGUgPT0gTGVkZ2VyTWV0YWRhdGFGb3JtYXQuU3RhdGUuQ0xPU0VECiAg\nICAgICAgICAgICYmIGxhc3RFbnRyeUlkICE9IG5ld01ldGEubGFzdEVudHJ5\nSWQpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAg\nICAgIC8vIGlmIGxlZGdlciBpcyBjbG9zZWQsIHdlIGNhbiBqdXN0IHRha2Ug\ndGhlIG5ldyBlbnNlbWJsZXMKICAgICAgICBpZiAobmV3TWV0YS5zdGF0ZSAh\nPSBMZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZS5DTE9TRUQpIHsKICAgICAg\nICAgICAgLy8gYWxsb3cgbmV3IG1ldGFkYXRhIHRvIGJlIG9uZSBlbnNlbWJs\nZSBsZXNzIHRoYW4gY3VycmVudCBtZXRhZGF0YQogICAgICAgICAgICAvLyBz\naW5jZSBlbnNlbWJsZSBjaGFuZ2UgbWlnaHQga2ljayBpbiB3aGVuIHJlY292\nZXJ5IGNoYW5nZWQgbWV0YWRhdGEKICAgICAgICAgICAgaW50IGRpZmYgPSBl\nbnNlbWJsZXMuc2l6ZSgpIC0gbmV3TWV0YS5lbnNlbWJsZXMuc2l6ZSgpOwog\nICAgICAgICAgICBpZiAoMCAhPSBkaWZmICYmIDEgIT0gZGlmZikgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgLy8gZW5zZW1ibGUgZGlzdHJpYnV0aW9uIHNob3VsZCBiZSBzYW1l\nCiAgICAgICAgICAgIC8vIHdlIGRvbid0IGNoZWNrIHRoZSBkZXRhaWwgZW5z\nZW1ibGUsIHNpbmNlIG5ldyBib29raWUgd2lsbCBiZSBzZXQKICAgICAgICAg\nICAgLy8gdXNpbmcgcmVjb3ZlcnkgdG9vbC4KICAgICAgICAgICAgSXRlcmF0\nb3I8TG9uZz4ga2V5SXRlciA9IGVuc2VtYmxlcy5rZXlTZXQoKS5pdGVyYXRv\ncigpOwogICAgICAgICAgICBJdGVyYXRvcjxMb25nPiBuZXdNZXRhS2V5SXRl\nciA9IG5ld01ldGEuZW5zZW1ibGVzLmtleVNldCgpLml0ZXJhdG9yKCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGk9MDsgaTxuZXdNZXRhLmVuc2VtYmxlcy5z\naXplKCk7IGkrKykgewogICAgICAgICAgICAgICAgTG9uZyBjdXJLZXkgPSBr\nZXlJdGVyLm5leHQoKTsKICAgICAgICAgICAgICAgIExvbmcgbmV3TWV0YUtl\neSA9IG5ld01ldGFLZXlJdGVyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlm\nICghY3VyS2V5LmVxdWFscyhuZXdNZXRhS2V5KSkgewogICAgICAgICAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7\nCiAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVy\nKCk7CiAgICAgICAgc2IuYXBwZW5kKCIobWV0YToiKS5hcHBlbmQobmV3IFN0\ncmluZyhzZXJpYWxpemUoKSwgVVRGXzgpKS5hcHBlbmQoIiwgdmVyc2lvbjoi\nKS5hcHBlbmQodmVyc2lvbikuYXBwZW5kKCIpIik7CiAgICAgICAgcmV0dXJu\nIHNiLnRvU3RyaW5nKCk7CiAgICB9CgogICAgdm9pZCBtZXJnZUVuc2VtYmxl\ncyhTb3J0ZWRNYXA8TG9uZywgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJl\nc3M+PiBuZXdFbnNlbWJsZXMpIHsKICAgICAgICAvLyBhbGxvdyBuZXcgbWV0\nYWRhdGEgdG8gYmUgb25lIGVuc2VtYmxlIGxlc3MgdGhhbiBjdXJyZW50IG1l\ndGFkYXRhCiAgICAgICAgLy8gc2luY2UgZW5zZW1ibGUgY2hhbmdlIG1pZ2h0\nIGtpY2sgaW4gd2hlbiByZWNvdmVyeSBjaGFuZ2VkIG1ldGFkYXRhCiAgICAg\nICAgaW50IGRpZmYgPSBlbnNlbWJsZXMuc2l6ZSgpIC0gbmV3RW5zZW1ibGVz\nLnNpemUoKTsKICAgICAgICBpZiAoMCAhPSBkaWZmICYmIDEgIT0gZGlmZikg\newogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGludCBp\nID0gMDsKICAgICAgICBmb3IgKEVudHJ5PExvbmcsIEFycmF5TGlzdDxCb29r\naWVTb2NrZXRBZGRyZXNzPj4gZW50cnkgOiBuZXdFbnNlbWJsZXMuZW50cnlT\nZXQoKSkgewogICAgICAgICAgICArK2k7CiAgICAgICAgICAgIGlmIChlbnNl\nbWJsZXMuc2l6ZSgpICE9IGkpIHsKICAgICAgICAgICAgICAgIC8vIHdlIHNo\nb3VsZCB1c2UgbGFzdCBlbnNlbWJsZSBmcm9tIGN1cnJlbnQgbWV0YWRhdGEK\nICAgICAgICAgICAgICAgIC8vIG5vdCB0aGUgbmV3IG1ldGFkYXRhIHJlYWQg\nZnJvbSB6b29rZWVwZXIKICAgICAgICAgICAgICAgIGxvbmcga2V5ID0gZW50\ncnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICBBcnJheUxpc3Q8Qm9va2ll\nU29ja2V0QWRkcmVzcz4gZW5zZW1ibGUgPSBlbnRyeS5nZXRWYWx1ZSgpOwog\nICAgICAgICAgICAgICAgZW5zZW1ibGVzLnB1dChrZXksIGVuc2VtYmxlKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCn0K\n","encoding":"base64"}

