{"sha":"4df89ea24bf3604d6aa113c73c53ca4e01944d27","node_id":"MDQ6QmxvYjE1NzU5NTY6NGRmODllYTI0YmYzNjA0ZDZhYTExM2M3M2M1M2NhNGUwMTk0NGQyNw==","size":7118,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4df89ea24bf3604d6aa113c73c53ca4e01944d27","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7Cgpp\nbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nR2VuZXJhbFNlY3VyaXR5RXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5PcGVuQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2Fs\nbGJhY2suUmVhZExhc3RDb25maXJtZWRDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBl\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVw\nZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuc3RhdHMuT3BTdGF0c0xvZ2dlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLk1hdGhVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLk9yZGVyZWRTYWZlRXhl\nY3V0b3IuT3JkZXJlZFNhZmVHZW5lcmljQ2FsbGJhY2s7CgppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5\nOwoKLyoqCiAqIEVuY2Fwc3VsYXRlcyB0aGUgbGVkZ2VyIG9wZW4gb3BlcmF0\naW9uCiAqCiAqLwpjbGFzcyBMZWRnZXJPcGVuT3AgaW1wbGVtZW50cyBHZW5l\ncmljQ2FsbGJhY2s8TGVkZ2VyTWV0YWRhdGE+IHsKICAgIHN0YXRpYyBmaW5h\nbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTGVkZ2Vy\nT3Blbk9wLmNsYXNzKTsKCiAgICBmaW5hbCBCb29rS2VlcGVyIGJrOwogICAg\nZmluYWwgbG9uZyBsZWRnZXJJZDsKICAgIGZpbmFsIE9wZW5DYWxsYmFjayBj\nYjsKICAgIGZpbmFsIE9iamVjdCBjdHg7CiAgICBMZWRnZXJIYW5kbGUgbGg7\nCiAgICBmaW5hbCBieXRlW10gcGFzc3dkOwogICAgZmluYWwgRGlnZXN0VHlw\nZSBkaWdlc3RUeXBlOwogICAgYm9vbGVhbiBkb1JlY292ZXJ5ID0gdHJ1ZTsK\nICAgIGJvb2xlYW4gYWRtaW5pc3RyYXRpdmVPcGVuID0gZmFsc2U7CiAgICBs\nb25nIHN0YXJ0VGltZTsKICAgIE9wU3RhdHNMb2dnZXIgb3Blbk9wTG9nZ2Vy\nOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICog\nQHBhcmFtIGJrCiAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAqIEBwYXJh\nbSBkaWdlc3RUeXBlCiAgICAgKiBAcGFyYW0gcGFzc3dkCiAgICAgKiBAcGFy\nYW0gY2IKICAgICAqIEBwYXJhbSBjdHgKICAgICAqLwogICAgcHVibGljIExl\nZGdlck9wZW5PcChCb29rS2VlcGVyIGJrLCBsb25nIGxlZGdlcklkLCBEaWdl\nc3RUeXBlIGRpZ2VzdFR5cGUsIGJ5dGVbXSBwYXNzd2QsCiAgICAgICAgICAg\nICAgICAgICAgICAgIE9wZW5DYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewog\nICAgICAgIHRoaXMuYmsgPSBiazsKICAgICAgICB0aGlzLmxlZGdlcklkID0g\nbGVkZ2VySWQ7CiAgICAgICAgdGhpcy5wYXNzd2QgPSBwYXNzd2Q7CiAgICAg\nICAgdGhpcy5jYiA9IGNiOwogICAgICAgIHRoaXMuY3R4ID0gY3R4OwogICAg\nICAgIHRoaXMuZGlnZXN0VHlwZSA9IGRpZ2VzdFR5cGU7CiAgICB9CgogICAg\ncHVibGljIExlZGdlck9wZW5PcChCb29rS2VlcGVyIGJrLCBsb25nIGxlZGdl\ncklkLCBPcGVuQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICB0\naGlzLmJrID0gYms7CiAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklk\nOwogICAgICAgIHRoaXMuY2IgPSBjYjsKICAgICAgICB0aGlzLmN0eCA9IGN0\neDsKCiAgICAgICAgdGhpcy5wYXNzd2QgPSBiay5nZXRDb25mKCkuZ2V0Qm9v\na2llUmVjb3ZlcnlQYXNzd2QoKTsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUg\nPSBiay5nZXRDb25mKCkuZ2V0Qm9va2llUmVjb3ZlcnlEaWdlc3RUeXBlKCk7\nCiAgICAgICAgdGhpcy5hZG1pbmlzdHJhdGl2ZU9wZW4gPSB0cnVlOwogICAg\nfQoKICAgIC8qKgogICAgICogSW5pdGl0YXRlcyB0aGUgbGVkZ2VyIG9wZW4g\nb3BlcmF0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGluaXRpYXRlKCkg\newogICAgICAgIHN0YXJ0VGltZSA9IE1hdGhVdGlscy5ub3dJbk5hbm8oKTsK\nCiAgICAgICAgb3Blbk9wTG9nZ2VyID0gYmsuZ2V0T3Blbk9wTG9nZ2VyKCk7\nCgogICAgICAgIC8qKgogICAgICAgICAqIEFzeW5jaHJvbm91c2x5IHJlYWQg\ndGhlIGxlZGdlciBtZXRhZGF0YSBub2RlLgogICAgICAgICAqLwogICAgICAg\nIGJrLmdldExlZGdlck1hbmFnZXIoKS5yZWFkTGVkZ2VyTWV0YWRhdGEobGVk\nZ2VySWQsIHRoaXMpOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGl0YXRl\ncyB0aGUgbGVkZ2VyIG9wZW4gb3BlcmF0aW9uIHdpdGhvdXQgcmVjb3ZlcnkK\nICAgICAqLwogICAgcHVibGljIHZvaWQgaW5pdGlhdGVXaXRob3V0UmVjb3Zl\ncnkoKSB7CiAgICAgICAgdGhpcy5kb1JlY292ZXJ5ID0gZmFsc2U7CiAgICAg\nICAgaW5pdGlhdGUoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVu\ndHMgT3BlbiBMZWRnZXIgQ2FsbGJhY2suCiAgICAgKi8KICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBM\nZWRnZXJNZXRhZGF0YSBtZXRhZGF0YSkgewogICAgICAgIGlmIChCS0V4Y2Vw\ndGlvbi5Db2RlLk9LICE9IHJjKSB7CiAgICAgICAgICAgIC8vIG9wZW4gbGVk\nZ2VyIGZhaWxlZC4KICAgICAgICAgICAgb3BlbkNvbXBsZXRlKHJjLCBudWxs\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZmlu\nYWwgYnl0ZVtdIHBhc3N3ZDsKICAgICAgICBmaW5hbCBEaWdlc3RUeXBlIGRp\nZ2VzdFR5cGU7CgogICAgICAgIC8qIEZvciBhbiBhZG1pbmlzdHJhdGl2ZSBv\ncGVuLCB0aGUgZGVmYXVsdCBwYXNzd29yZHMKICAgICAgICAgKiBhcmUgcmVh\nZCBmcm9tIHRoZSBjb25maWd1cmF0aW9uLCBidXQgaWYgdGhlIG1ldGFkYXRh\nCiAgICAgICAgICogYWxyZWFkeSBjb250YWlucyBwYXNzd29yZHMsIHVzZSB0\naGVzZSBpbnN0ZWFkLiAqLwogICAgICAgIGlmIChhZG1pbmlzdHJhdGl2ZU9w\nZW4gJiYgbWV0YWRhdGEuaGFzUGFzc3dvcmQoKSkgewogICAgICAgICAgICBw\nYXNzd2QgPSBtZXRhZGF0YS5nZXRQYXNzd29yZCgpOwogICAgICAgICAgICBk\naWdlc3RUeXBlID0gbWV0YWRhdGEuZ2V0RGlnZXN0VHlwZSgpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHBhc3N3ZCA9IHRoaXMucGFzc3dkOwog\nICAgICAgICAgICBkaWdlc3RUeXBlID0gdGhpcy5kaWdlc3RUeXBlOwoKICAg\nICAgICAgICAgaWYgKG1ldGFkYXRhLmhhc1Bhc3N3b3JkKCkpIHsKICAgICAg\nICAgICAgICAgIGlmICghQXJyYXlzLmVxdWFscyhwYXNzd2QsIG1ldGFkYXRh\nLmdldFBhc3N3b3JkKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVy\ncm9yKCJQcm92aWRlZCBwYXNzd2QgZG9lcyBub3QgbWF0Y2ggdGhhdCBpbiBt\nZXRhZGF0YSIpOwogICAgICAgICAgICAgICAgICAgIG9wZW5Db21wbGV0ZShC\nS0V4Y2VwdGlvbi5Db2RlLlVuYXV0aG9yaXplZEFjY2Vzc0V4Y2VwdGlvbiwg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRpZ2VzdFR5cGUgIT0gbWV0\nYWRhdGEuZ2V0RGlnZXN0VHlwZSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nTE9HLmVycm9yKCJQcm92aWRlZCBkaWdlc3QgZG9lcyBub3QgbWF0Y2ggdGhh\ndCBpbiBtZXRhZGF0YSIpOwogICAgICAgICAgICAgICAgICAgIG9wZW5Db21w\nbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLkRpZ2VzdE1hdGNoRXhjZXB0aW9uLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIGdl\ndCB0aGUgbGVkZ2VyIG1ldGFkYXRhIGJhY2sKICAgICAgICB0cnkgewogICAg\nICAgICAgICBsaCA9IG5ldyBSZWFkT25seUxlZGdlckhhbmRsZShiaywgbGVk\nZ2VySWQsIG1ldGFkYXRhLCBkaWdlc3RUeXBlLCBwYXNzd2QsICFkb1JlY292\nZXJ5KTsKICAgICAgICB9IGNhdGNoIChHZW5lcmFsU2VjdXJpdHlFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlNlY3VyaXR5IGV4Y2Vw\ndGlvbiB3aGlsZSBvcGVuaW5nIGxlZGdlcjogIiArIGxlZGdlcklkLCBlKTsK\nICAgICAgICAgICAgb3BlbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuRGln\nZXN0Tm90SW5pdGlhbGl6ZWRFeGNlcHRpb24sIG51bGwpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJbmNvcnJlY3RseSBl\nbnRlcmVkIHBhcmFtZXRlciB0aHJvdHRsZTogIiArIGJrLmdldENvbmYoKS5n\nZXRUaHJvdHRsZVZhbHVlKCksIGUpOwogICAgICAgICAgICBvcGVuQ29tcGxl\ndGUoQktFeGNlcHRpb24uQ29kZS5JbmNvcnJlY3RQYXJhbWV0ZXJFeGNlcHRp\nb24sIG51bGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICBpZiAobWV0YWRhdGEuaXNDbG9zZWQoKSkgewogICAgICAgICAgICAv\nLyBMZWRnZXIgd2FzIGNsb3NlZCBwcm9wZXJseQogICAgICAgICAgICBvcGVu\nQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgbGgpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoZG9SZWNvdmVyeSkg\newogICAgICAgICAgICBsaC5yZWNvdmVyKG5ldyBPcmRlcmVkU2FmZUdlbmVy\naWNDYWxsYmFjazxWb2lkPihiay5tYWluV29ya2VyUG9vbCwgbGVkZ2VySWQp\nIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2FmZU9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgVm9p\nZCByZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQktF\neGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAgICAgICBv\ncGVuQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgbGgpOwogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29k\nZS5VbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb24pIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgb3BlbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuVW5h\ndXRob3JpemVkQWNjZXNzRXhjZXB0aW9uLCBudWxsKTsKICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBvcGVu\nQ29tcGxldGUoYmsuZ2V0UmV0dXJuUmMoQktFeGNlcHRpb24uQ29kZS5MZWRn\nZXJSZWNvdmVyeUV4Y2VwdGlvbiksIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgbGguYXN5bmNSZWFkTGFzdENvbmZp\ncm1lZChuZXcgUmVhZExhc3RDb25maXJtZWRDYWxsYmFjaygpIHsKICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgcmVhZExhc3RDb25maXJtZWRDb21wbGV0ZShpbnQgcmMsCiAgICAgICAg\nICAgICAgICAgICAgICAgIGxvbmcgbGFzdENvbmZpcm1lZCwgT2JqZWN0IGN0\neCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlv\nbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5Db21w\nbGV0ZShiay5nZXRSZXR1cm5SYyhCS0V4Y2VwdGlvbi5Db2RlLlJlYWRFeGNl\ncHRpb24pLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgICAgICBsaC5sYXN0QWRkQ29uZmlybWVkID0g\nbGgubGFzdEFkZFB1c2hlZCA9IGxhc3RDb25maXJtZWQ7CiAgICAgICAgICAg\nICAgICAgICAgICAgIG9wZW5Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9L\nLCBsaCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9LCBudWxsKTsKCiAgICAgICAgfQogICAgfQoKICAg\nIHZvaWQgb3BlbkNvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoKSB7\nCiAgICAgICAgaWYgKEJLRXhjZXB0aW9uLkNvZGUuT0sgIT0gcmMpIHsKICAg\nICAgICAgICAgb3Blbk9wTG9nZ2VyLnJlZ2lzdGVyRmFpbGVkRXZlbnQoc3Rh\ncnRUaW1lKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBvcGVuT3BM\nb2dnZXIucmVnaXN0ZXJTdWNjZXNzZnVsRXZlbnQoc3RhcnRUaW1lKTsKICAg\nICAgICB9CiAgICAgICAgY2Iub3BlbkNvbXBsZXRlKHJjLCBsaCwgY3R4KTsK\nICAgIH0KfQo=\n","encoding":"base64"}

