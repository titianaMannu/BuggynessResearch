{"sha":"7ed7aa251751f78f691e46be9d16fe605c33ca33","node_id":"MDQ6QmxvYjE1NzU5NTY6N2VkN2FhMjUxNzUxZjc4ZjY5MWU0NmJlOWQxNmZlNjA1YzMzY2EzMw==","size":7688,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7ed7aa251751f78f691e46be9d16fe605c33ca33","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNv\nZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhw\ncmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBz\ncGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq\nIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmltcG9ydCBq\nYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljQm9vbGVhbjsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNMb25nOwoKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5B\nZGRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQXN5bmNDYWxsYmFjay5DbG9zZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxs\nYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuRGln\nZXN0TWFuYWdlci5SZWNvdmVyeURhdGE7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkdl\nbmVyaWNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktl\nZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUaGlzIGNsYXNz\nIGVuY2Fwc3VsYXRlZCB0aGUgbGVkZ2VyIHJlY292ZXJ5IG9wZXJhdGlvbi4g\nSXQgZmlyc3QgZG9lcyBhIHJlYWQKICogd2l0aCBlbnRyeS1pZCBvZiAtMSAo\nQm9va2llUHJvdG9jb2wuTEFTVF9BRERfQ09ORklSTUVEKSB0byBhbGwgYm9v\na2llcy4gVGhlbgogKiBzdGFydGluZyBmcm9tIHRoZSBsYXN0IGNvbmZpcm1l\nZCBlbnRyeSAoZnJvbSBoaW50cyBpbiB0aGUgbGVkZ2VyIGVudHJpZXMpLAog\nKiBpdCByZWFkcyBmb3J3YXJkIHVudGlsIGl0IGlzIG5vdCBhYmxlIHRvIGZp\nbmQgYSBwYXJ0aWN1bGFyIGVudHJ5LiBJdCBjbG9zZXMKICogdGhlIGxlZGdl\nciBhdCB0aGF0IGVudHJ5LgogKgogKi8KY2xhc3MgTGVkZ2VyUmVjb3ZlcnlP\ncCBpbXBsZW1lbnRzIFJlYWRDYWxsYmFjaywgQWRkQ2FsbGJhY2sgewogICAg\nc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihMZWRnZXJSZWNvdmVyeU9wLmNsYXNzKTsKICAgIExlZGdlckhhbmRs\nZSBsaDsKICAgIEF0b21pY0xvbmcgcmVhZENvdW50LCB3cml0ZUNvdW50Owog\nICAgQXRvbWljQm9vbGVhbiByZWFkRG9uZTsKICAgIEF0b21pY0Jvb2xlYW4g\nY2FsbGJhY2tEb25lOwogICAgbG9uZyBlbnRyeVRvUmVhZDsKICAgIC8vIGtl\nZXAgYSBjb3B5IG9mIG1ldGFkYXRhIGZvciByZWNvdmVyeS4KICAgIExlZGdl\nck1ldGFkYXRhIG1ldGFkYXRhRm9yUmVjb3Zlcnk7CgogICAgR2VuZXJpY0Nh\nbGxiYWNrPFZvaWQ+IGNiOwoKICAgIGNsYXNzIFJlY292ZXJ5UmVhZE9wIGV4\ndGVuZHMgUGVuZGluZ1JlYWRPcCB7CgogICAgICAgIFJlY292ZXJ5UmVhZE9w\nKExlZGdlckhhbmRsZSBsaCwgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNj\naGVkdWxlciwgbG9uZyBzdGFydEVudHJ5SWQsCiAgICAgICAgICAgICAgICBs\nb25nIGVuZEVudHJ5SWQsIFJlYWRDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICBzdXBlcihsaCwgc2NoZWR1bGVyLCBzdGFydEVudHJ5\nSWQsIGVuZEVudHJ5SWQsIGNiLCBjdHgpOwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHJvdGVjdGVkIExlZGdlck1ldGFkYXRhIGdl\ndExlZGdlck1ldGFkYXRhKCkgewogICAgICAgICAgICByZXR1cm4gbWV0YWRh\ndGFGb3JSZWNvdmVyeTsKICAgICAgICB9CgogICAgfQoKICAgIHB1YmxpYyBM\nZWRnZXJSZWNvdmVyeU9wKExlZGdlckhhbmRsZSBsaCwgR2VuZXJpY0NhbGxi\nYWNrPFZvaWQ+IGNiKSB7CiAgICAgICAgcmVhZENvdW50ID0gbmV3IEF0b21p\nY0xvbmcoMCk7CiAgICAgICAgd3JpdGVDb3VudCA9IG5ldyBBdG9taWNMb25n\nKDApOwogICAgICAgIHJlYWREb25lID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFs\nc2UpOwogICAgICAgIGNhbGxiYWNrRG9uZSA9IG5ldyBBdG9taWNCb29sZWFu\nKGZhbHNlKTsKICAgICAgICB0aGlzLmNiID0gY2I7CiAgICAgICAgdGhpcy5s\naCA9IGxoOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRpYXRlKCkgewog\nICAgICAgIFJlYWRMYXN0Q29uZmlybWVkT3Agcmxjb3AgPSBuZXcgUmVhZExh\nc3RDb25maXJtZWRPcChsaCwKICAgICAgICAgICAgICAgIG5ldyBSZWFkTGFz\ndENvbmZpcm1lZE9wLkxhc3RDb25maXJtZWREYXRhQ2FsbGJhY2soKSB7CiAg\nICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJt\nZWREYXRhQ29tcGxldGUoaW50IHJjLCBSZWNvdmVyeURhdGEgZGF0YSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24u\nQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGgubGFz\ndEFkZFB1c2hlZCA9IGxoLmxhc3RBZGRDb25maXJtZWQgPSBkYXRhLmxhc3RB\nZGRDb25maXJtZWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaC5s\nZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGVudHJ5VG9SZWFkID0gbGgubGFzdEFkZENvbmZpcm1lZDsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIGtlZXAgYSBjb3B5IG9mIGxlZGdl\nciBtZXRhZGF0YSBiZWZvcmUgcHJvY2VlZGluZwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gbGVkZ2VyIHJlY292ZXJ5CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBtZXRhZGF0YUZvclJlY292ZXJ5ID0gbmV3IExlZGdl\nck1ldGFkYXRhKGxoLmdldExlZGdlck1ldGFkYXRhKCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZG9SZWNvdmVyeVJlYWQoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5D\nb2RlLlVuYXV0aG9yaXplZEFjY2Vzc0V4Y2VwdGlvbikgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUocmMsIG51\nbGwpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUoQktF\neGNlcHRpb24uQ29kZS5SZWFkRXhjZXB0aW9uLCBudWxsKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0pOwoKICAgICAgICAvKioKICAgICAgICAgKiBFbmFibGUg\nZmVuY2luZyBvbiB0aGlzIG9wLiBXaGVuIHRoZSByZWFkIHJlcXVlc3QgcmVh\nY2hlcyB0aGUgYm9va2llcwogICAgICAgICAqIHNlcnZlciBpdCB3aWxsIGZl\nbmNlIG9mZiB0aGUgbGVkZ2VyLCBzdG9wcGluZyBhbnkgc3Vic2VxdWVudCBv\ncGVyYXRpb24KICAgICAgICAgKiBmcm9tIHdyaXRpbmcgdG8gaXQuCiAgICAg\nICAgICovCiAgICAgICAgcmxjb3AuaW5pdGlhdGVXaXRoRmVuY2luZygpOwog\nICAgfQoKICAgIC8qKgogICAgICogVHJ5IHRvIHJlYWQgcGFzdCB0aGUgbGFz\ndCBjb25maXJtZWQuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkb1JlY292\nZXJ5UmVhZCgpIHsKICAgICAgICBpZiAoIWNhbGxiYWNrRG9uZS5nZXQoKSkg\newogICAgICAgICAgICBlbnRyeVRvUmVhZCsrOwogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgbmV3IFJlY292ZXJ5UmVhZE9wKGxoLCBsaC5i\nay5zY2hlZHVsZXIsIGVudHJ5VG9SZWFkLCBlbnRyeVRvUmVhZCwgdGhpcywg\nbnVsbCkuaW5pdGlhdGUoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgcmVhZENvbXBs\nZXRlKEJLRXhjZXB0aW9uLkNvZGUuSW50ZXJydXB0ZWRFeGNlcHRpb24sIGxo\nLCBudWxsLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgY2xvc2VBbmRDYWxsYmFjaygpIHsKICAgICAg\nICBpZiAoY2FsbGJhY2tEb25lLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUp\nKSB7CiAgICAgICAgICAgIGxoLmFzeW5jQ2xvc2VJbnRlcm5hbChuZXcgQ2xv\nc2VDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgY2xvc2VDb21wbGV0ZShpbnQgcmMs\nIExlZGdlckhhbmRsZSBsaCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJDbG9zZSBsZWRnZXIge30g\nZmFpbGVkIGR1cmluZyByZWNvdmVyeTogIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIExlZGdlclJlY292ZXJ5T3AudGhpcy5saC5nZXRJZCgpLCBC\nS0V4Y2VwdGlvbi5nZXRNZXNzYWdlKHJjKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKHJjLCBudWxsKTsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBjYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9LLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJBZnRl\nciBjbG9zaW5nIGxlbmd0aCBpczoge30iLCBsaC5nZXRMZW5ndGgoKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9LCBudWxsLCBCS0V4Y2VwdGlvbi5Db2RlLkxlZGdlckNsb3NlZEV4\nY2VwdGlvbik7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgcmVhZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxl\nIGxoLCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsK\nICAgICAgICAgICAgcmVhZENvdW50LmluY3JlbWVudEFuZEdldCgpOwogICAg\nICAgICAgICBMZWRnZXJFbnRyeSBlbnRyeSA9IHNlcS5uZXh0RWxlbWVudCgp\nOwogICAgICAgICAgICBieXRlW10gZGF0YSA9IGVudHJ5LmdldEVudHJ5KCk7\nCgogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBXZSB3aWxsIGFkZCB0\naGlzIGVudHJ5IGFnYWluIHRvIG1ha2Ugc3VyZSBpdCBpcyB3cml0dGVuIHRv\nIGVub3VnaAogICAgICAgICAgICAgKiByZXBsaWNhcy4gV2Ugc3VidHJhY3Qg\ndGhlIGxlbmd0aCBvZiB0aGUgZGF0YSBpdHNlbGYsIHNpbmNlIGl0IHdpbGwK\nICAgICAgICAgICAgICogYmUgYWRkZWQgYWdhaW4gd2hlbiBwcm9jZXNzaW5n\nIHRoZSBjYWxsIHRvIGFkZCBpdC4KICAgICAgICAgICAgICovCiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAobGgpIHsKICAgICAgICAgICAgICAgIGxoLmxl\nbmd0aCA9IGVudHJ5LmdldExlbmd0aCgpIC0gKGxvbmcpIGRhdGEubGVuZ3Ro\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxoLmFzeW5jUmVjb3ZlcnlB\nZGRFbnRyeShkYXRhLCAwLCBkYXRhLmxlbmd0aCwgdGhpcywgbnVsbCk7CiAg\nICAgICAgICAgIGRvUmVjb3ZlcnlSZWFkKCk7CiAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICB9CgogICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5D\nb2RlLk5vU3VjaEVudHJ5RXhjZXB0aW9uIHx8IHJjID09IEJLRXhjZXB0aW9u\nLkNvZGUuTm9TdWNoTGVkZ2VyRXhpc3RzRXhjZXB0aW9uKSB7CiAgICAgICAg\nICAgIHJlYWREb25lLnNldCh0cnVlKTsKICAgICAgICAgICAgaWYgKHJlYWRD\nb3VudC5nZXQoKSA9PSB3cml0ZUNvdW50LmdldCgpKSB7CiAgICAgICAgICAg\nICAgICBjbG9zZUFuZENhbGxiYWNrKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gb3RoZXJ3aXNl\nLCBzb21lIG90aGVyIGVycm9yLCB3ZSBjYW4ndCBoYW5kbGUKICAgICAgICBM\nT0cuZXJyb3IoIkZhaWx1cmUgIiArIEJLRXhjZXB0aW9uLmdldE1lc3NhZ2Uo\ncmMpICsgIiB3aGlsZSByZWFkaW5nIGVudHJ5OiAiICsgZW50cnlUb1JlYWQK\nICAgICAgICAgICAgICAgICAgKyAiIGxlZGdlcjogIiArIGxoLmxlZGdlcklk\nICsgIiB3aGlsZSByZWNvdmVyaW5nIGxlZGdlciIpOwogICAgICAgIGNiLm9w\nZXJhdGlvbkNvbXBsZXRlKHJjLCBudWxsKTsKICAgICAgICByZXR1cm47CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBhZGRDb21wbGV0\nZShpbnQgcmMsIExlZGdlckhhbmRsZSBsaCwgbG9uZyBlbnRyeUlkLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUu\nT0spIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJGYWlsdXJlICIgKyBCS0V4\nY2VwdGlvbi5nZXRNZXNzYWdlKHJjKSArICIgd2hpbGUgd3JpdGluZyBlbnRy\neTogIiArIChsaC5sYXN0QWRkQ29uZmlybWVkICsgMSkKICAgICAgICAgICAg\nICAgICAgICAgICsgIiBsZWRnZXI6ICIgKyBsaC5sZWRnZXJJZCArICIgd2hp\nbGUgcmVjb3ZlcmluZyBsZWRnZXIiKTsKICAgICAgICAgICAgaWYgKGNhbGxi\nYWNrRG9uZS5jb21wYXJlQW5kU2V0KGZhbHNlLCB0cnVlKSkgewogICAgICAg\nICAgICAgICAgLy8gR2l2ZSB1cCwgd2UgY2FuJ3QgcmVjb3ZlciBmcm9tIHRo\naXMgZXJyb3IKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRl\nKHJjLCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQogICAgICAgIGxvbmcgbnVtQWRkID0gd3JpdGVDb3VudC5p\nbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICBpZiAocmVhZERvbmUuZ2V0KCkg\nJiYgcmVhZENvdW50LmdldCgpID09IG51bUFkZCkgewogICAgICAgICAgICBj\nbG9zZUFuZENhbGxiYWNrKCk7CiAgICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

