{"sha":"7b15d9e6e8a17d19d495245382dcbe8d07e6b584","node_id":"MDQ6QmxvYjE1NzU5NTY6N2IxNWQ5ZTZlOGExN2QxOWQ0OTUyNDUzODJkY2JlOGQwN2U2YjU4NA==","size":20604,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7b15d9e6e8a17d19d495245382dcbe8d07e6b584","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFj\naGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1\naXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGlu\nZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2Ug\naXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9V\nVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhl\nciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7CgppbXBvcnQgamF2\nYS5uZXQuSW5ldEFkZHJlc3M7CmltcG9ydCBqYXZhLm5ldC5Vbmtub3duSG9z\ndEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFz\naE1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51\ndGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmxvY2tzLlJl\nZW50cmFudFJlYWRXcml0ZUxvY2s7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbi5CS05vdEVub3VnaEJvb2tpZXNF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5D\nb25maWd1cmFibGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0\nLkJvb2tpZVNvY2tldEFkZHJlc3M7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubmV0LkNhY2hlZEROU1RvU3dpdGNoTWFwcGluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5uZXQuRE5TVG9Td2l0Y2hNYXBwaW5nOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm5ldC5OZXR3b3JrVG9wb2xv\nZ3k7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0Lk5vZGU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0Lk5vZGVCYXNlOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm5ldC5TY3JpcHRCYXNlZE1hcHBp\nbmc7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5SZWZsZWN0\naW9uVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29uZmlndXJh\ndGlvbi5Db25maWd1cmF0aW9uOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5n\nb29nbGUuY29tbW9uLmNvbGxlY3QuSW1tdXRhYmxlU2V0OwppbXBvcnQgY29t\nLmdvb2dsZS5jb21tb24uY29sbGVjdC5TZXRzOwoKLyoqCiAqIFNpbXBsZSBy\nYWNrd2FyZSBlbnNlbWJsZSBwbGFjZW1lbnQgcG9saWN5LgogKgogKiBNYWtl\nIG1vc3Qgb2YgdGhlIGNsYXNzIGFuZCBtZXRob2RzIGFzIHByb3RlY3RlZCwg\nc28gaXQgY291bGQgYmUgZXh0ZW5kZWQgdG8gaW1wbGVtZW50IG90aGVyIGFs\nZ29yaXRobXMuCiAqLwpwdWJsaWMgY2xhc3MgUmFja2F3YXJlRW5zZW1ibGVQ\nbGFjZW1lbnRQb2xpY3kgaW1wbGVtZW50cyBFbnNlbWJsZVBsYWNlbWVudFBv\nbGljeSB7CgogICAgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihSYWNrYXdhcmVFbnNlbWJsZVBsYWNlbWVudFBv\nbGljeS5jbGFzcyk7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nUkVQUF9ETlNfUkVTT0xWRVJfQ0xBU1MgPSAicmVwcERuc1Jlc29sdmVyQ2xh\nc3MiOwoKICAgIC8qKgogICAgICogUHJlZGljYXRlIHVzZWQgd2hlbiBjaG9v\nc2luZyBhbiBlbnNlbWJsZS4KICAgICAqLwogICAgcHJvdGVjdGVkIHN0YXRp\nYyBpbnRlcmZhY2UgUHJlZGljYXRlIHsKICAgICAgICBib29sZWFuIGFwcGx5\nKEJvb2tpZU5vZGUgY2FuZGlkYXRlLCBFbnNlbWJsZSBjaG9zZW5Cb29raWVz\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEVuc2VtYmxlIHVzZWQgdG8gaG9s\nZCB0aGUgcmVzdWx0IG9mIGFuIGVuc2VtYmxlIHNlbGVjdGVkIGZvciBwbGFj\nZW1lbnQuCiAgICAgKi8KICAgIHByb3RlY3RlZCBzdGF0aWMgaW50ZXJmYWNl\nIEVuc2VtYmxlIHsKCiAgICAgICAgLyoqCiAgICAgICAgICogQXBwZW5kIHRo\nZSBuZXcgYm9va2llIG5vZGUgdG8gdGhlIGVuc2VtYmxlLgogICAgICAgICAq\nCiAgICAgICAgICogQHBhcmFtIG5vZGUKICAgICAgICAgKiAgICAgICAgICBu\nZXcgY2FuZGlkYXRlIGJvb2tpZSBub2RlLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyB2b2lkIGFkZEJvb2tpZShCb29raWVOb2RlIG5vZGUpOwoKICAg\nICAgICAvKioKICAgICAgICAgKiBAcmV0dXJuIGxpc3Qgb2YgYWRkcmVzc2Vz\nIHJlcHJlc2VudGluZyB0aGUgZW5zZW1ibGUKICAgICAgICAgKi8KICAgICAg\nICBwdWJsaWMgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+IHRvTGlz\ndCgpOwogICAgfQoKICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgVHJ1ZVBy\nZWRpY2F0ZSBpbXBsZW1lbnRzIFByZWRpY2F0ZSB7CgogICAgICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgVHJ1ZVByZWRpY2F0ZSBpbnN0YW5jZSA9IG5ldyBU\ncnVlUHJlZGljYXRlKCk7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyBib29sZWFuIGFwcGx5KEJvb2tpZU5vZGUgY2FuZGlkYXRlLCBFbnNl\nbWJsZSBjaG9zZW5Ob2RlcykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CgogICAgfQoKICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3Mg\nRW5zZW1ibGVGb3JSZXBsYWNlbWVudCBpbXBsZW1lbnRzIEVuc2VtYmxlIHsK\nCiAgICAgICAgcHVibGljIHN0YXRpYyBmaW5hbCBFbnNlbWJsZUZvclJlcGxh\nY2VtZW50IGluc3RhbmNlID0gbmV3IEVuc2VtYmxlRm9yUmVwbGFjZW1lbnQo\nKTsKICAgICAgICBzdGF0aWMgZmluYWwgQXJyYXlMaXN0PEJvb2tpZVNvY2tl\ndEFkZHJlc3M+IEVNUFRZX0xJU1QgPSBuZXcgQXJyYXlMaXN0PEJvb2tpZVNv\nY2tldEFkZHJlc3M+KDApOwoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgdm9pZCBhZGRCb29raWUoQm9va2llTm9kZSBub2RlKSB7CiAgICAg\nICAgICAgIC8vIGRvIG5vdGhpbmcKICAgICAgICB9CgogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRk\ncmVzcz4gdG9MaXN0KCkgewogICAgICAgICAgICByZXR1cm4gRU1QVFlfTElT\nVDsKICAgICAgICB9CgogICAgfQoKICAgIC8qKgogICAgICogQSBwcmVkaWNh\ndGUgY2hlY2tpbmcgdGhlIHJhY2sgY292ZXJhZ2UgZm9yIHdyaXRlIHF1b3J1\nbSBpbiB7QGxpbmsgUm91bmRSb2JpbkRpc3RyaWJ1dGlvblNjaGVkdWxlfSwK\nICAgICAqIHdoaWNoIGVuc3VyZXMgdGhhdCBhIHdyaXRlIHF1b3J1bSBzaG91\nbGQgYmUgY292ZXJlZCBieSBhdCBsZWFzdCB0d28gcmFja3MuCiAgICAgKi8K\nICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgUlJSYWNrQ292ZXJhZ2VFbnNl\nbWJsZSBpbXBsZW1lbnRzIFByZWRpY2F0ZSwgRW5zZW1ibGUgewoKICAgICAg\nICBjbGFzcyBRdW9ydW1Db3ZlcmFnZVNldCB7CiAgICAgICAgICAgIFNldDxT\ndHJpbmc+IHJhY2tzID0gbmV3IEhhc2hTZXQ8U3RyaW5nPigpOwogICAgICAg\nICAgICBpbnQgc2VlbkJvb2tpZXMgPSAwOwoKICAgICAgICAgICAgYm9vbGVh\nbiBhcHBseShCb29raWVOb2RlIGNhbmRpZGF0ZSkgewogICAgICAgICAgICAg\nICAgaWYgKHNlZW5Cb29raWVzICsgMSA9PSB3cml0ZVF1b3J1bVNpemUpIHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFja3Muc2l6ZSgpID4gKHJh\nY2tzLmNvbnRhaW5zKGNhbmRpZGF0ZS5nZXROZXR3b3JrTG9jYXRpb24oKSkg\nPyAxIDogMCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdm9pZCBh\nZGRCb29raWUoQm9va2llTm9kZSBjYW5kaWRhdGUpIHsKICAgICAgICAgICAg\nICAgICsrc2VlbkJvb2tpZXM7CiAgICAgICAgICAgICAgICByYWNrcy5hZGQo\nY2FuZGlkYXRlLmdldE5ldHdvcmtMb2NhdGlvbigpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgZmluYWwgaW50IGVuc2VtYmxlU2l6ZTsK\nICAgICAgICBmaW5hbCBpbnQgd3JpdGVRdW9ydW1TaXplOwogICAgICAgIGZp\nbmFsIEFycmF5TGlzdDxCb29raWVOb2RlPiBjaG9zZW5Ob2RlczsKICAgICAg\nICBwcml2YXRlIGZpbmFsIFF1b3J1bUNvdmVyYWdlU2V0W10gcXVvcnVtczsK\nCiAgICAgICAgcHJvdGVjdGVkIFJSUmFja0NvdmVyYWdlRW5zZW1ibGUoaW50\nIGVuc2VtYmxlU2l6ZSwgaW50IHdyaXRlUXVvcnVtU2l6ZSkgewogICAgICAg\nICAgICB0aGlzLmVuc2VtYmxlU2l6ZSA9IGVuc2VtYmxlU2l6ZTsKICAgICAg\nICAgICAgdGhpcy53cml0ZVF1b3J1bVNpemUgPSB3cml0ZVF1b3J1bVNpemU7\nCiAgICAgICAgICAgIHRoaXMuY2hvc2VuTm9kZXMgPSBuZXcgQXJyYXlMaXN0\nPEJvb2tpZU5vZGU+KGVuc2VtYmxlU2l6ZSk7CiAgICAgICAgICAgIHRoaXMu\ncXVvcnVtcyA9IG5ldyBRdW9ydW1Db3ZlcmFnZVNldFtlbnNlbWJsZVNpemVd\nOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gYXBwbHkoQm9va2llTm9kZSBjYW5kaWRhdGUsIEVuc2VtYmxl\nIGVuc2VtYmxlKSB7CiAgICAgICAgICAgIGlmIChlbnNlbWJsZSAhPSB0aGlz\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgLy8gY2FuZGlkYXRlIHBvc2l0aW9uCiAgICAgICAg\nICAgIGludCBjYW5kaWRhdGVQb3MgPSBjaG9zZW5Ob2Rlcy5zaXplKCk7CiAg\nICAgICAgICAgIGludCBzdGFydFBvcyA9IGNhbmRpZGF0ZVBvcyAtIHdyaXRl\nUXVvcnVtU2l6ZSArIDE7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSBzdGFy\ndFBvczsgaSA8PSBjYW5kaWRhdGVQb3M7IGkrKykgewogICAgICAgICAgICAg\nICAgaW50IGlkeCA9IChpICsgZW5zZW1ibGVTaXplKSAlIGVuc2VtYmxlU2l6\nZTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHF1b3J1bXNbaWR4XSkg\newogICAgICAgICAgICAgICAgICAgIHF1b3J1bXNbaWR4XSA9IG5ldyBRdW9y\ndW1Db3ZlcmFnZVNldCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgaWYgKCFxdW9ydW1zW2lkeF0uYXBwbHkoY2FuZGlkYXRlKSkgewog\nICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2\nb2lkIGFkZEJvb2tpZShCb29raWVOb2RlIG5vZGUpIHsKICAgICAgICAgICAg\naW50IGNhbmRpZGF0ZVBvcyA9IGNob3Nlbk5vZGVzLnNpemUoKTsKICAgICAg\nICAgICAgaW50IHN0YXJ0UG9zID0gY2FuZGlkYXRlUG9zIC0gd3JpdGVRdW9y\ndW1TaXplICsgMTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IHN0YXJ0UG9z\nOyBpIDw9IGNhbmRpZGF0ZVBvczsgaSsrKSB7CiAgICAgICAgICAgICAgICBp\nbnQgaWR4ID0gKGkgKyBlbnNlbWJsZVNpemUpICUgZW5zZW1ibGVTaXplOwog\nICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gcXVvcnVtc1tpZHhdKSB7CiAg\nICAgICAgICAgICAgICAgICAgcXVvcnVtc1tpZHhdID0gbmV3IFF1b3J1bUNv\ndmVyYWdlU2V0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBxdW9ydW1zW2lkeF0uYWRkQm9va2llKG5vZGUpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGNob3Nlbk5vZGVzLmFkZChub2RlKTsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBBcnJheUxpc3Q8\nQm9va2llU29ja2V0QWRkcmVzcz4gdG9MaXN0KCkgewogICAgICAgICAgICBB\ncnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gYWRkcmVzc2VzID0gbmV3\nIEFycmF5TGlzdDxCb29raWVTb2NrZXRBZGRyZXNzPihlbnNlbWJsZVNpemUp\nOwogICAgICAgICAgICBmb3IgKEJvb2tpZU5vZGUgYm4gOiBjaG9zZW5Ob2Rl\ncykgewogICAgICAgICAgICAgICAgYWRkcmVzc2VzLmFkZChibi5nZXRBZGRy\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBhZGRyZXNz\nZXM7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gY2hv\nc2VuTm9kZXMudG9TdHJpbmcoKTsKICAgICAgICB9CgogICAgfQoKICAgIHBy\nb3RlY3RlZCBzdGF0aWMgY2xhc3MgQm9va2llTm9kZSBpbXBsZW1lbnRzIE5v\nZGUgewoKICAgICAgICBwcml2YXRlIGZpbmFsIEJvb2tpZVNvY2tldEFkZHJl\nc3MgYWRkcjsgLy8gaWRlbnRpZmllciBvZiBhIGJvb2tpZSBub2RlLgoKICAg\nICAgICBwcml2YXRlIGludCBsZXZlbDsgLy8gdGhlIGxldmVsIGluIHRvcG9s\nb2d5IHRyZWUKICAgICAgICBwcml2YXRlIE5vZGUgcGFyZW50OyAvLyBpdHMg\ncGFyZW50IGluIHRvcG9sb2d5IHRyZWUKICAgICAgICBwcml2YXRlIFN0cmlu\nZyBsb2NhdGlvbiA9IE5ldHdvcmtUb3BvbG9neS5ERUZBVUxUX1JBQ0s7IC8v\nIGl0cyBuZXR3b3JrIGxvY2F0aW9uCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBT\ndHJpbmcgbmFtZTsKCiAgICAgICAgQm9va2llTm9kZShCb29raWVTb2NrZXRB\nZGRyZXNzIGFkZHIsIFN0cmluZyBuZXR3b3JrTG9jKSB7CiAgICAgICAgICAg\nIHRoaXMuYWRkciA9IGFkZHI7CiAgICAgICAgICAgIHRoaXMubmFtZSA9IGFk\nZHIudG9TdHJpbmcoKTsKICAgICAgICAgICAgc2V0TmV0d29ya0xvY2F0aW9u\nKG5ldHdvcmtMb2MpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIEJvb2tp\nZVNvY2tldEFkZHJlc3MgZ2V0QWRkcigpIHsKICAgICAgICAgICAgcmV0dXJu\nIGFkZHI7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgaW50IGdldExldmVsKCkgewogICAgICAgICAgICByZXR1cm4gbGV2\nZWw7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBzZXRMZXZlbChpbnQgbGV2ZWwpIHsKICAgICAgICAgICAgdGhp\ncy5sZXZlbCA9IGxldmVsOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIE5vZGUgZ2V0UGFyZW50KCkgewogICAgICAgICAg\nICByZXR1cm4gcGFyZW50OwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgc2V0UGFyZW50KE5vZGUgcGFyZW50KSB7\nCiAgICAgICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50OwogICAgICAgIH0K\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRO\nYW1lKCkgewogICAgICAgICAgICByZXR1cm4gbmFtZTsKICAgICAgICB9Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0TmV0\nd29ya0xvY2F0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gbG9jYXRpb247\nCiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMg\ndm9pZCBzZXROZXR3b3JrTG9jYXRpb24oU3RyaW5nIGxvY2F0aW9uKSB7CiAg\nICAgICAgICAgIHRoaXMubG9jYXRpb24gPSBsb2NhdGlvbjsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBpbnQgaGFzaENv\nZGUoKSB7CiAgICAgICAgICAgIHJldHVybiBuYW1lLmhhc2hDb2RlKCk7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBlcXVhbHMoT2JqZWN0IG9iaikgewogICAgICAgICAgICBpZiAoIShv\nYmogaW5zdGFuY2VvZiBCb29raWVOb2RlKSkgewogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEJvb2tp\nZU5vZGUgb3RoZXIgPSAoQm9va2llTm9kZSkgb2JqOwogICAgICAgICAgICBy\nZXR1cm4gZ2V0TmFtZSgpLmVxdWFscyhvdGhlci5nZXROYW1lKCkpOwogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mb3Jt\nYXQoIjxCb29raWU6JXM+IiwgbmFtZSk7CiAgICAgICAgfQoKICAgIH0KCiAg\nICBzdGF0aWMgY2xhc3MgRGVmYXVsdFJlc29sdmVyIGltcGxlbWVudHMgRE5T\nVG9Td2l0Y2hNYXBwaW5nIHsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIExpc3Q8U3RyaW5nPiByZXNvbHZlKExpc3Q8U3RyaW5nPiBuYW1l\ncykgewogICAgICAgICAgICBMaXN0PFN0cmluZz4gck5hbWVzID0gbmV3IEFy\ncmF5TGlzdDxTdHJpbmc+KG5hbWVzLnNpemUoKSk7CiAgICAgICAgICAgIGZv\nciAoQFN1cHByZXNzV2FybmluZ3MoInVudXNlZCIpIFN0cmluZyBuYW1lIDog\nbmFtZXMpIHsKICAgICAgICAgICAgICAgIHJOYW1lcy5hZGQoTmV0d29ya1Rv\ncG9sb2d5LkRFRkFVTFRfUkFDSyk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIHJOYW1lczsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHJlbG9hZENhY2hlZE1hcHBpbmdzKCkg\newogICAgICAgICAgICAvLyBub3AKICAgICAgICB9CgogICAgfTsKCiAgICAv\nLyBmb3Igbm93LCB3ZSBqdXN0IG1haW50YWluIHRoZSB3cml0YWJsZSBib29r\naWVzJyB0b3BvbG9neQogICAgcHJpdmF0ZSBmaW5hbCBOZXR3b3JrVG9wb2xv\nZ3kgdG9wb2xvZ3k7CiAgICBwcml2YXRlIEROU1RvU3dpdGNoTWFwcGluZyBk\nbnNSZXNvbHZlcjsKICAgIHByaXZhdGUgZmluYWwgTWFwPEJvb2tpZVNvY2tl\ndEFkZHJlc3MsIEJvb2tpZU5vZGU+IGtub3duQm9va2llczsKICAgIHByaXZh\ndGUgQm9va2llTm9kZSBsb2NhbE5vZGU7CiAgICBwcml2YXRlIGZpbmFsIFJl\nZW50cmFudFJlYWRXcml0ZUxvY2sgcndMb2NrOwoKICAgIHB1YmxpYyBSYWNr\nYXdhcmVFbnNlbWJsZVBsYWNlbWVudFBvbGljeSgpIHsKICAgICAgICB0b3Bv\nbG9neSA9IG5ldyBOZXR3b3JrVG9wb2xvZ3koKTsKICAgICAgICBrbm93bkJv\nb2tpZXMgPSBuZXcgSGFzaE1hcDxCb29raWVTb2NrZXRBZGRyZXNzLCBCb29r\naWVOb2RlPigpOwoKICAgICAgICByd0xvY2sgPSBuZXcgUmVlbnRyYW50UmVh\nZFdyaXRlTG9jaygpOwogICAgfQoKICAgIHByaXZhdGUgQm9va2llTm9kZSBj\ncmVhdGVCb29raWVOb2RlKEJvb2tpZVNvY2tldEFkZHJlc3MgYWRkcikgewog\nICAgICAgIHJldHVybiBuZXcgQm9va2llTm9kZShhZGRyLCByZXNvbHZlTmV0\nd29ya0xvY2F0aW9uKGFkZHIpKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBFbnNlbWJsZVBsYWNlbWVudFBvbGljeSBpbml0aWFsaXplKENv\nbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIFN0cmluZyBkbnNSZXNvbHZl\nck5hbWUgPSBjb25mLmdldFN0cmluZyhSRVBQX0ROU19SRVNPTFZFUl9DTEFT\nUywgU2NyaXB0QmFzZWRNYXBwaW5nLmNsYXNzLmdldE5hbWUoKSk7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgZG5zUmVzb2x2ZXIgPSBSZWZsZWN0aW9u\nVXRpbHMubmV3SW5zdGFuY2UoZG5zUmVzb2x2ZXJOYW1lLCBETlNUb1N3aXRj\naE1hcHBpbmcuY2xhc3MpOwogICAgICAgICAgICBpZiAoZG5zUmVzb2x2ZXIg\naW5zdGFuY2VvZiBDb25maWd1cmFibGUpIHsKICAgICAgICAgICAgICAgICgo\nQ29uZmlndXJhYmxlKSBkbnNSZXNvbHZlcikuc2V0Q29uZihjb25mKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFJ1bnRpbWVFeGNlcHRpb24g\ncmUpIHsKICAgICAgICAgICAgTE9HLmluZm8oIkZhaWxlZCB0byBpbml0aWFs\naXplIEROUyBSZXNvbHZlciB7fSwgdXNlZCBkZWZhdWx0IHN1Ym5ldCByZXNv\nbHZlci4iLCBkbnNSZXNvbHZlck5hbWUsIHJlKTsKICAgICAgICAgICAgZG5z\nUmVzb2x2ZXIgPSBuZXcgRGVmYXVsdFJlc29sdmVyKCk7CiAgICAgICAgfQoK\nICAgICAgICBCb29raWVOb2RlIGJuOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGJuID0gY3JlYXRlQm9va2llTm9kZShuZXcgQm9va2llU29ja2V0QWRk\ncmVzcyhJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVz\ncygpLCAwKSk7CiAgICAgICAgfSBjYXRjaCAoVW5rbm93bkhvc3RFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkZhaWxlZCB0byBnZXQg\nbG9jYWwgaG9zdCBhZGRyZXNzIDogIiwgZSk7CiAgICAgICAgICAgIGJuID0g\nbnVsbDsKICAgICAgICB9CiAgICAgICAgbG9jYWxOb2RlID0gYm47CiAgICAg\nICAgTE9HLmluZm8oIkluaXRpYWxpemUgcmFja2F3YXJlIGVuc2VtYmxlIHBs\nYWNlbWVudCBwb2xpY3kgQCB7fSA6IHt9LiIsIGxvY2FsTm9kZSwKICAgICAg\nICAgICAgICAgIGRuc1Jlc29sdmVyLmdldENsYXNzKCkuZ2V0TmFtZSgpKTsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIHVuaW5pdGFsaXplKCkgewogICAgICAgIC8vIGRvIG5v\ndGhpbmcKICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyByZXNvbHZlTmV0d29y\na0xvY2F0aW9uKEJvb2tpZVNvY2tldEFkZHJlc3MgYWRkcikgewogICAgICAg\nIExpc3Q8U3RyaW5nPiBuYW1lcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigx\nKTsKICAgICAgICBpZiAoZG5zUmVzb2x2ZXIgaW5zdGFuY2VvZiBDYWNoZWRE\nTlNUb1N3aXRjaE1hcHBpbmcpIHsKICAgICAgICAgICAgbmFtZXMuYWRkKGFk\nZHIuZ2V0U29ja2V0QWRkcmVzcygpLmdldEFkZHJlc3MoKS5nZXRIb3N0QWRk\ncmVzcygpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuYW1lcy5h\nZGQoYWRkci5nZXRTb2NrZXRBZGRyZXNzKCkuZ2V0SG9zdE5hbWUoKSk7CiAg\nICAgICAgfQogICAgICAgIC8vIHJlc29sdmUgbmV0d29yayBhZGRyZXNzZXMK\nICAgICAgICBMaXN0PFN0cmluZz4gck5hbWVzID0gZG5zUmVzb2x2ZXIucmVz\nb2x2ZShuYW1lcyk7CiAgICAgICAgU3RyaW5nIG5ldExvYzsKICAgICAgICBp\nZiAobnVsbCA9PSByTmFtZXMpIHsKICAgICAgICAgICAgTE9HLndhcm4oIkZh\naWxlZCB0byByZXNvbHZlIG5ldHdvcmsgbG9jYXRpb24gZm9yIHt9LCB1c2lu\nZyBkZWZhdWx0IHJhY2sgZm9yIHRoZW0gOiB7fS4iLCBuYW1lcywKICAgICAg\nICAgICAgICAgICAgICBOZXR3b3JrVG9wb2xvZ3kuREVGQVVMVF9SQUNLKTsK\nICAgICAgICAgICAgbmV0TG9jID0gTmV0d29ya1RvcG9sb2d5LkRFRkFVTFRf\nUkFDSzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBuZXRMb2MgPSBy\nTmFtZXMuZ2V0KDApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV0TG9j\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFNldDxCb29raWVT\nb2NrZXRBZGRyZXNzPiBvbkNsdXN0ZXJDaGFuZ2VkKFNldDxCb29raWVTb2Nr\nZXRBZGRyZXNzPiB3cml0YWJsZUJvb2tpZXMsCiAgICAgICAgICAgIFNldDxC\nb29raWVTb2NrZXRBZGRyZXNzPiByZWFkT25seUJvb2tpZXMpIHsKICAgICAg\nICByd0xvY2sud3JpdGVMb2NrKCkubG9jaygpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIEltbXV0YWJsZVNldDxCb29raWVTb2NrZXRBZGRyZXNzPiBq\nb2luZWRCb29raWVzLCBsZWZ0Qm9va2llcywgZGVhZEJvb2tpZXM7CiAgICAg\nICAgICAgIFNldDxCb29raWVTb2NrZXRBZGRyZXNzPiBvbGRCb29raWVTZXQg\nPSBrbm93bkJvb2tpZXMua2V5U2V0KCk7CiAgICAgICAgICAgIC8vIGxlZnQg\nYm9va2llcyA6IGJvb2tpZXMgaW4ga25vd24gYm9va2llcywgYnV0IG5vdCBp\nbiBuZXcgd3JpdGFibGUgYm9va2llIGNsdXN0ZXIuCiAgICAgICAgICAgIGxl\nZnRCb29raWVzID0gU2V0cy5kaWZmZXJlbmNlKG9sZEJvb2tpZVNldCwgd3Jp\ndGFibGVCb29raWVzKS5pbW11dGFibGVDb3B5KCk7CiAgICAgICAgICAgIC8v\nIGpvaW5lZCBib29raWVzIDogYm9va2llcyBpbiBuZXcgd3JpdGFibGUgYm9v\na2llIGNsdXN0ZXIsIGJ1dCBub3QgaW4ga25vd24gYm9va2llcwogICAgICAg\nICAgICBqb2luZWRCb29raWVzID0gU2V0cy5kaWZmZXJlbmNlKHdyaXRhYmxl\nQm9va2llcywgb2xkQm9va2llU2V0KS5pbW11dGFibGVDb3B5KCk7CiAgICAg\nICAgICAgIC8vIGRlYWQgYm9va2llcy4KICAgICAgICAgICAgZGVhZEJvb2tp\nZXMgPSBTZXRzLmRpZmZlcmVuY2UobGVmdEJvb2tpZXMsIHJlYWRPbmx5Qm9v\na2llcykuaW1tdXRhYmxlQ29weSgpOwogICAgICAgICAgICBpZiAoTE9HLmlz\nRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygK\nICAgICAgICAgICAgICAgICAgICAgICAgIkNsdXN0ZXIgY2hhbmdlZCA6IGxl\nZnQgYm9va2llcyBhcmUge30sIGpvaW5lZCBib29raWVzIGFyZSB7fSwgd2hp\nbGUgZGVhZCBib29raWVzIGFyZSB7fS4iLAogICAgICAgICAgICAgICAgICAg\nICAgICBuZXcgT2JqZWN0W10geyBsZWZ0Qm9va2llcywgam9pbmVkQm9va2ll\ncywgZGVhZEJvb2tpZXMgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIG5vZGUgbGVmdAogICAgICAgICAgICBmb3IgKEJvb2tpZVNvY2tldEFk\nZHJlc3MgYWRkciA6IGxlZnRCb29raWVzKSB7CiAgICAgICAgICAgICAgICBC\nb29raWVOb2RlIG5vZGUgPSBrbm93bkJvb2tpZXMucmVtb3ZlKGFkZHIpOwog\nICAgICAgICAgICAgICAgdG9wb2xvZ3kucmVtb3ZlKG5vZGUpOwogICAgICAg\nICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJDbHVzdGVyIGNoYW5nZWQgOiBib29r\naWUge30gbGVmdCBmcm9tIGNsdXN0ZXIuIiwgYWRkcik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vZGUgam9p\nbmVkCiAgICAgICAgICAgIGZvciAoQm9va2llU29ja2V0QWRkcmVzcyBhZGRy\nIDogam9pbmVkQm9va2llcykgewogICAgICAgICAgICAgICAgQm9va2llTm9k\nZSBub2RlID0gY3JlYXRlQm9va2llTm9kZShhZGRyKTsKICAgICAgICAgICAg\nICAgIHRvcG9sb2d5LmFkZChub2RlKTsKICAgICAgICAgICAgICAgIGtub3du\nQm9va2llcy5wdXQoYWRkciwgbm9kZSk7CiAgICAgICAgICAgICAgICBpZiAo\nTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoIkNsdXN0ZXIgY2hhbmdlZCA6IGJvb2tpZSB7fSBqb2luZWQg\ndGhlIGNsdXN0ZXIuIiwgYWRkcik7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBkZWFkQm9va2llczsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICByd0xvY2sud3JpdGVMb2Nr\nKCkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgU2V0\nPE5vZGU+IGNvbnZlcnRCb29raWVzVG9Ob2RlcyhTZXQ8Qm9va2llU29ja2V0\nQWRkcmVzcz4gZXhjbHVkZUJvb2tpZXMpIHsKICAgICAgICBTZXQ8Tm9kZT4g\nbm9kZXMgPSBuZXcgSGFzaFNldDxOb2RlPigpOwogICAgICAgIGZvciAoQm9v\na2llU29ja2V0QWRkcmVzcyBhZGRyIDogZXhjbHVkZUJvb2tpZXMpIHsKICAg\nICAgICAgICAgQm9va2llTm9kZSBibiA9IGtub3duQm9va2llcy5nZXQoYWRk\ncik7CiAgICAgICAgICAgIGlmIChudWxsID09IGJuKSB7CiAgICAgICAgICAg\nICAgICBibiA9IGNyZWF0ZUJvb2tpZU5vZGUoYWRkcik7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgbm9kZXMuYWRkKGJuKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIG5vZGVzOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIEFycmF5TGlzdDxCb29raWVTb2NrZXRBZGRyZXNzPiBuZXdFbnNlbWJs\nZShpbnQgZW5zZW1ibGVTaXplLCBpbnQgd3JpdGVRdW9ydW1TaXplLAogICAg\nICAgICAgICBTZXQ8Qm9va2llU29ja2V0QWRkcmVzcz4gZXhjbHVkZUJvb2tp\nZXMpIHRocm93cyBCS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24gewogICAg\nICAgIHJ3TG9jay5yZWFkTG9jaygpLmxvY2soKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBTZXQ8Tm9kZT4gZXhjbHVkZU5vZGVzID0gY29udmVydEJv\nb2tpZXNUb05vZGVzKGV4Y2x1ZGVCb29raWVzKTsKICAgICAgICAgICAgUlJS\nYWNrQ292ZXJhZ2VFbnNlbWJsZSBlbnNlbWJsZSA9IG5ldyBSUlJhY2tDb3Zl\ncmFnZUVuc2VtYmxlKGVuc2VtYmxlU2l6ZSwgd3JpdGVRdW9ydW1TaXplKTsK\nICAgICAgICAgICAgQm9va2llTm9kZSBwcmV2Tm9kZSA9IG51bGw7CiAgICAg\nICAgICAgIGludCBudW1SYWNrcyA9IHRvcG9sb2d5LmdldE51bU9mUmFja3Mo\nKTsKICAgICAgICAgICAgLy8gb25seSBvbmUgcmFjaywgdXNlIHRoZSByYW5k\nb20gYWxnb3JpdGhtLgogICAgICAgICAgICBpZiAobnVtUmFja3MgPCAyKSB7\nCiAgICAgICAgICAgICAgICBMaXN0PEJvb2tpZU5vZGU+IGJucyA9IHNlbGVj\ndFJhbmRvbShlbnNlbWJsZVNpemUsIGV4Y2x1ZGVOb2RlcywKICAgICAgICAg\nICAgICAgICAgICAgICAgRW5zZW1ibGVGb3JSZXBsYWNlbWVudC5pbnN0YW5j\nZSk7CiAgICAgICAgICAgICAgICBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRk\ncmVzcz4gYWRkcnMgPSBuZXcgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFkZHJl\nc3M+KGVuc2VtYmxlU2l6ZSk7CiAgICAgICAgICAgICAgICBmb3IgKEJvb2tp\nZU5vZGUgYm4gOiBibnMpIHsKICAgICAgICAgICAgICAgICAgICBhZGRycy5h\nZGQoYm4uYWRkcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXR1cm4gYWRkcnM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g\ncGljayBub2RlcyBieSByYWNrcywgdG8gZW5zdXJlIHRoZXJlIGlzIGF0IGxl\nYXN0IHR3byByYWNrcyBwZXIgd3JpdGUgcXVvcnVtLgogICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGVuc2VtYmxlU2l6ZTsgaSsrKSB7CiAgICAg\nICAgICAgICAgICBTdHJpbmcgY3VyUmFjazsKICAgICAgICAgICAgICAgIGlm\nIChudWxsID09IHByZXZOb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG51bGwgPT0gbG9jYWxOb2RlKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGN1clJhY2sgPSBOb2RlQmFzZS5ST09UOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGN1clJhY2sgPSBs\nb2NhbE5vZGUuZ2V0TmV0d29ya0xvY2F0aW9uKCk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBjdXJSYWNrID0gIn4iICsgcHJldk5vZGUuZ2V0TmV0d29ya0xv\nY2F0aW9uKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBw\ncmV2Tm9kZSA9IHNlbGVjdEZyb21SYWNrKGN1clJhY2ssIGV4Y2x1ZGVOb2Rl\ncywgZW5zZW1ibGUsIGVuc2VtYmxlKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gZW5zZW1ibGUudG9MaXN0KCk7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgcndMb2NrLnJlYWRMb2NrKCkudW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIEJv\nb2tpZVNvY2tldEFkZHJlc3MgcmVwbGFjZUJvb2tpZShCb29raWVTb2NrZXRB\nZGRyZXNzIGJvb2tpZVRvUmVwbGFjZSwKICAgICAgICAgICAgU2V0PEJvb2tp\nZVNvY2tldEFkZHJlc3M+IGV4Y2x1ZGVCb29raWVzKSB0aHJvd3MgQktOb3RF\nbm91Z2hCb29raWVzRXhjZXB0aW9uIHsKICAgICAgICByd0xvY2sucmVhZExv\nY2soKS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgQm9va2ll\nTm9kZSBibiA9IGtub3duQm9va2llcy5nZXQoYm9va2llVG9SZXBsYWNlKTsK\nICAgICAgICAgICAgaWYgKG51bGwgPT0gYm4pIHsKICAgICAgICAgICAgICAg\nIGJuID0gY3JlYXRlQm9va2llTm9kZShib29raWVUb1JlcGxhY2UpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBTZXQ8Tm9kZT4gZXhjbHVkZU5vZGVz\nID0gY29udmVydEJvb2tpZXNUb05vZGVzKGV4Y2x1ZGVCb29raWVzKTsKICAg\nICAgICAgICAgLy8gYWRkIHRoZSBib29raWUgdG8gcmVwbGFjZSBpbiBleGNs\ndWRlIHNldAogICAgICAgICAgICBleGNsdWRlTm9kZXMuYWRkKGJuKTsKICAg\nICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIlRyeSB0byBjaG9vc2UgYSBuZXcgYm9va2ll\nIHRvIHJlcGxhY2Uge30sIGV4Y2x1ZGluZyB7fS4iLCBib29raWVUb1JlcGxh\nY2UsCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2x1ZGVOb2Rlcyk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgLy8gcGljayBhIGNhbmRpZGF0ZSBm\ncm9tIHNhbWUgcmFjayB0byByZXBsYWNlCiAgICAgICAgICAgIEJvb2tpZU5v\nZGUgY2FuZGlkYXRlID0gc2VsZWN0RnJvbVJhY2soYm4uZ2V0TmV0d29ya0xv\nY2F0aW9uKCksIGV4Y2x1ZGVOb2RlcywKICAgICAgICAgICAgICAgICAgICBU\ncnVlUHJlZGljYXRlLmluc3RhbmNlLCBFbnNlbWJsZUZvclJlcGxhY2VtZW50\nLmluc3RhbmNlKTsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxl\nZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkJvb2tpZSB7fSBp\ncyBjaG9zZW4gdG8gcmVwbGFjZSBib29raWUge30uIiwgY2FuZGlkYXRlLCBi\nbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNhbmRpZGF0\nZS5hZGRyOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJ3TG9j\nay5yZWFkTG9jaygpLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncm90ZWN0ZWQgQm9va2llTm9kZSBzZWxlY3RGcm9tUmFjayhTdHJpbmcgbmV0\nd29ya0xvYywgU2V0PE5vZGU+IGV4Y2x1ZGVCb29raWVzLCBQcmVkaWNhdGUg\ncHJlZGljYXRlLAogICAgICAgICAgICBFbnNlbWJsZSBlbnNlbWJsZSkgdGhy\nb3dzIEJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nc2VsZWN0IG9uZSBmcm9tIGxvY2FsIHJhY2sKICAgICAgICB0cnkgewogICAg\nICAgICAgICByZXR1cm4gc2VsZWN0UmFuZG9tRnJvbVJhY2sobmV0d29ya0xv\nYywgZXhjbHVkZUJvb2tpZXMsIHByZWRpY2F0ZSwgZW5zZW1ibGUpOwogICAg\nICAgIH0gY2F0Y2ggKEJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIExPRy53YXJuKCJGYWlsZWQgdG8gY2hvb3NlIGEgYm9v\na2llIGZyb20ge30gOiAiCiAgICAgICAgICAgICAgICAgICAgICsgImV4Y2x1\nZGVkIHt9LCBmYWxsYmFjayB0byBjaG9vc2UgYm9va2llIHJhbmRvbWx5IGZy\nb20gdGhlIGNsdXN0ZXIuIiwKICAgICAgICAgICAgICAgICAgICAgbmV0d29y\na0xvYywgZXhjbHVkZUJvb2tpZXMpOwogICAgICAgICAgICAvLyByYW5kb21s\neSBjaG9vc2Ugb25lIGZyb20gd2hvbGUgY2x1c3RlciwgaWdub3JlIHRoZSBw\ncm92aWRlZCBwcmVkaWNhdGUuCiAgICAgICAgICAgIHJldHVybiBzZWxlY3RS\nYW5kb20oMSwgZXhjbHVkZUJvb2tpZXMsIGVuc2VtYmxlKS5nZXQoMCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBTdHJpbmcgZ2V0UmVtb3Rl\nUmFjayhCb29raWVOb2RlIG5vZGUpIHsKICAgICAgICByZXR1cm4gIn4iICsg\nbm9kZS5nZXROZXR3b3JrTG9jYXRpb24oKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENob29zZSByYW5kb20gbm9kZSB1bmRlciBhIGdpdmVuIG5ldHdvcmsg\ncGF0aC4KICAgICAqCiAgICAgKiBAcGFyYW0gbmV0UGF0aAogICAgICogICAg\nICAgICAgbmV0d29yayBwYXRoCiAgICAgKiBAcGFyYW0gZXhjbHVkZUJvb2tp\nZXMKICAgICAqICAgICAgICAgIGV4Y2x1ZGUgYm9va2llcwogICAgICogQHBh\ncmFtIHByZWRpY2F0ZQogICAgICogICAgICAgICAgcHJlZGljYXRlIHRvIGNo\nZWNrIHdoZXRoZXIgdGhlIHRhcmdldCBpcyBhIGdvb2QgdGFyZ2V0LgogICAg\nICogQHBhcmFtIGVuc2VtYmxlCiAgICAgKiAgICAgICAgICBlbnNlbWJsZSBz\ndHJ1Y3R1cmUKICAgICAqIEByZXR1cm4gY2hvc2VuIGJvb2tpZS4KICAgICAq\nLwogICAgcHJvdGVjdGVkIEJvb2tpZU5vZGUgc2VsZWN0UmFuZG9tRnJvbVJh\nY2soU3RyaW5nIG5ldFBhdGgsIFNldDxOb2RlPiBleGNsdWRlQm9va2llcywg\nUHJlZGljYXRlIHByZWRpY2F0ZSwKICAgICAgICAgICAgRW5zZW1ibGUgZW5z\nZW1ibGUpIHRocm93cyBCS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24gewog\nICAgICAgIExpc3Q8Tm9kZT4gbGVhdmVzID0gbmV3IEFycmF5TGlzdDxOb2Rl\nPih0b3BvbG9neS5nZXRMZWF2ZXMobmV0UGF0aCkpOwogICAgICAgIENvbGxl\nY3Rpb25zLnNodWZmbGUobGVhdmVzKTsKICAgICAgICBmb3IgKE5vZGUgbiA6\nIGxlYXZlcykgewogICAgICAgICAgICBpZiAoZXhjbHVkZUJvb2tpZXMuY29u\ndGFpbnMobikpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGlmICghKG4gaW5zdGFuY2VvZiBCb29raWVO\nb2RlKSB8fCAhcHJlZGljYXRlLmFwcGx5KChCb29raWVOb2RlKSBuLCBlbnNl\nbWJsZSkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIEJvb2tpZU5vZGUgYm4gPSAoQm9va2llTm9kZSkg\nbjsKICAgICAgICAgICAgLy8gZ290IGEgZ29vZCBjYW5kaWRhdGUKICAgICAg\nICAgICAgZW5zZW1ibGUuYWRkQm9va2llKGJuKTsKICAgICAgICAgICAgLy8g\nYWRkIHRoZSBjYW5kaWRhdGUgdG8gZXhjbHVkZSBzZXQKICAgICAgICAgICAg\nZXhjbHVkZUJvb2tpZXMuYWRkKGJuKTsKICAgICAgICAgICAgcmV0dXJuIGJu\nOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgQktOb3RFbm91Z2hCb29r\naWVzRXhjZXB0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDaG9vc2Ug\nYSByYW5kb20gbm9kZSBmcm9tIHdob2xlIGNsdXN0ZXIuCiAgICAgKgogICAg\nICogQHBhcmFtIG51bUJvb2tpZXMKICAgICAqICAgICAgICAgIG51bWJlciBi\nb29raWVzIHRvIGNob29zZQogICAgICogQHBhcmFtIGV4Y2x1ZGVCb29raWVz\nCiAgICAgKiAgICAgICAgICBib29raWVzIHNldCB0byBleGNsdWRlLgogICAg\nICogQHBhcmFtIGVuc2VtYmxlCiAgICAgKiAgICAgICAgICBlbnNlbWJsZSB0\nbyBob2xkIHRoZSBib29raWUgY2hvc2VuLgogICAgICogQHJldHVybiB0aGUg\nYm9va2llIG5vZGUgY2hvc2VuLgogICAgICogQHRocm93cyBCS05vdEVub3Vn\naEJvb2tpZXNFeGNlcHRpb24KICAgICAqLwogICAgcHJvdGVjdGVkIExpc3Q8\nQm9va2llTm9kZT4gc2VsZWN0UmFuZG9tKGludCBudW1Cb29raWVzLCBTZXQ8\nTm9kZT4gZXhjbHVkZUJvb2tpZXMsIEVuc2VtYmxlIGVuc2VtYmxlKQogICAg\nICAgICAgICB0aHJvd3MgQktOb3RFbm91Z2hCb29raWVzRXhjZXB0aW9uIHsK\nICAgICAgICBMaXN0PEJvb2tpZU5vZGU+IGFsbEJvb2tpZXMgPSBuZXcgQXJy\nYXlMaXN0PEJvb2tpZU5vZGU+KGtub3duQm9va2llcy52YWx1ZXMoKSk7CiAg\nICAgICAgQ29sbGVjdGlvbnMuc2h1ZmZsZShhbGxCb29raWVzKTsKICAgICAg\nICBMaXN0PEJvb2tpZU5vZGU+IG5ld0Jvb2tpZXMgPSBuZXcgQXJyYXlMaXN0\nPEJvb2tpZU5vZGU+KG51bUJvb2tpZXMpOwogICAgICAgIGZvciAoQm9va2ll\nTm9kZSBib29raWUgOiBhbGxCb29raWVzKSB7CiAgICAgICAgICAgIGlmIChl\neGNsdWRlQm9va2llcy5jb250YWlucyhib29raWUpKSB7CiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbnNl\nbWJsZS5hZGRCb29raWUoYm9va2llKTsKICAgICAgICAgICAgZXhjbHVkZUJv\nb2tpZXMuYWRkKGJvb2tpZSk7CiAgICAgICAgICAgIG5ld0Jvb2tpZXMuYWRk\nKGJvb2tpZSk7CiAgICAgICAgICAgIC0tbnVtQm9va2llczsKICAgICAgICAg\nICAgaWYgKG51bUJvb2tpZXMgPT0gMCkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIG5ld0Jvb2tpZXM7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIExP\nRy5kZWJ1ZygiRmFpbGVkIHRvIGZpbmQge30gYm9va2llcyA6IGV4Y2x1ZGVC\nb29raWVzIHt9LCBhbGxCb29raWVzIHt9LiIsIG5ldyBPYmplY3RbXSB7CiAg\nICAgICAgICAgICAgICAgICAgbnVtQm9va2llcywgZXhjbHVkZUJvb2tpZXMs\nIGFsbEJvb2tpZXMgfSk7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBC\nS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24oKTsKICAgIH0KCn0K\n","encoding":"base64"}

