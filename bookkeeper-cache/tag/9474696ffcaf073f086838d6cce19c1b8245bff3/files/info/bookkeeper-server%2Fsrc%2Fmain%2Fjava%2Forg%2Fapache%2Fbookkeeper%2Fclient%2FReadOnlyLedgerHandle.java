{"sha":"8de4092b8d9e289a9702e2f8f2fb40e5c9bee329","node_id":"MDQ6QmxvYjE1NzU5NTY6OGRlNDA5MmI4ZDllMjg5YTk3MDJlMmY4ZjJmYjQwZTVjOWJlZTMyOQ==","size":6587,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8de4092b8d9e289a9702e2f8f2fb40e5c9bee329","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudDsKCmlt\ncG9ydCBqYXZhLnNlY3VyaXR5LkdlbmVyYWxTZWN1cml0eUV4Y2VwdGlvbjsK\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2Fs\nbGJhY2suQWRkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suQ2xvc2VDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdl\nc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm5ldC5Cb29r\naWVTb2NrZXRBZGRyZXNzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5MZWRnZXJNZXRh\nZGF0YUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0\naWwuU2FmZVJ1bm5hYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnZlcnNpb25pbmcuVmVyc2lvbjsKCmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5SZWplY3RlZEV4ZWN1dGlvbkV4Y2VwdGlvbjsKCi8qKgogKiBSZWFk\nIG9ubHkgbGVkZ2VyIGhhbmRsZS4gVGhpcyBsZWRnZXIgaGFuZGxlIGFsbG93\ncyB5b3UgdG8KICogcmVhZCBmcm9tIGEgbGVkZ2VyIGJ1dCBub3QgdG8gd3Jp\ndGUgdG8gaXQuIEl0IG92ZXJyaWRlcyBhbGwKICogdGhlIHB1YmxpYyB3cml0\nZSBvcGVyYXRpb25zIGZyb20gTGVkZ2VySGFuZGxlLgogKiBJdCBzaG91bGQg\nYmUgcmV0dXJuZWQgZm9yIEJvb2tLZWVwZXIjb3BlbkxlZGdlciBvcGVyYXRp\nb25zLgogKi8KY2xhc3MgUmVhZE9ubHlMZWRnZXJIYW5kbGUgZXh0ZW5kcyBM\nZWRnZXJIYW5kbGUgaW1wbGVtZW50cyBMZWRnZXJNZXRhZGF0YUxpc3RlbmVy\nIHsKCiAgICBjbGFzcyBNZXRhZGF0YVVwZGF0ZXIgZXh0ZW5kcyBTYWZlUnVu\nbmFibGUgewoKICAgICAgICBmaW5hbCBMZWRnZXJNZXRhZGF0YSBtOwoKICAg\nICAgICBNZXRhZGF0YVVwZGF0ZXIoTGVkZ2VyTWV0YWRhdGEgbWV0YWRhdGEp\nIHsKICAgICAgICAgICAgdGhpcy5tID0gbWV0YWRhdGE7CiAgICAgICAgfQoK\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUnVu\nKCkgewogICAgICAgICAgICBWZXJzaW9uLk9jY3VycmVkIG9jY3VycmVkID0K\nICAgICAgICAgICAgICAgICAgICBSZWFkT25seUxlZGdlckhhbmRsZS50aGlz\nLm1ldGFkYXRhLmdldFZlcnNpb24oKS5jb21wYXJlKHRoaXMubS5nZXRWZXJz\naW9uKCkpOwogICAgICAgICAgICBpZiAoVmVyc2lvbi5PY2N1cnJlZC5CRUZP\nUkUgPT0gb2NjdXJyZWQpIHsKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJV\ncGRhdGVkIGxlZGdlciBtZXRhZGF0YSBmb3IgbGVkZ2VyIHt9IHRvIHt9LiIs\nIGxlZGdlcklkLCB0aGlzLm0pOwogICAgICAgICAgICAgICAgUmVhZE9ubHlM\nZWRnZXJIYW5kbGUudGhpcy5tZXRhZGF0YSA9IHRoaXMubTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBSZWFkT25seUxlZGdlckhhbmRs\nZShCb29rS2VlcGVyIGJrLCBsb25nIGxlZGdlcklkLCBMZWRnZXJNZXRhZGF0\nYSBtZXRhZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgIERpZ2VzdFR5\ncGUgZGlnZXN0VHlwZSwgYnl0ZVtdIHBhc3N3b3JkLCBib29sZWFuIHdhdGNo\nKQogICAgICAgICAgICB0aHJvd3MgR2VuZXJhbFNlY3VyaXR5RXhjZXB0aW9u\nLCBOdW1iZXJGb3JtYXRFeGNlcHRpb24gewogICAgICAgIHN1cGVyKGJrLCBs\nZWRnZXJJZCwgbWV0YWRhdGEsIGRpZ2VzdFR5cGUsIHBhc3N3b3JkKTsKICAg\nICAgICBpZiAod2F0Y2gpIHsKICAgICAgICAgICAgYmsuZ2V0TGVkZ2VyTWFu\nYWdlcigpLnJlZ2lzdGVyTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcihsZWRnZXJJ\nZCwgdGhpcyk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgY2xvc2UoKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBiay5nZXRM\nZWRnZXJNYW5hZ2VyKCkudW5yZWdpc3RlckxlZGdlck1ldGFkYXRhTGlzdGVu\nZXIobGVkZ2VySWQsIHRoaXMpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgYXN5bmNDbG9zZShDbG9zZUNhbGxiYWNrIGNiLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgYmsuZ2V0TGVkZ2VyTWFuYWdlcigpLnVucmVn\naXN0ZXJMZWRnZXJNZXRhZGF0YUxpc3RlbmVyKGxlZGdlcklkLCB0aGlzKTsK\nICAgICAgICBjYi5jbG9zZUNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuT0ss\nIHRoaXMsIGN0eCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\nbG9uZyBhZGRFbnRyeShieXRlW10gZGF0YSkgdGhyb3dzIEludGVycnVwdGVk\nRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGFkZEVu\ndHJ5KGRhdGEsIDAsIGRhdGEubGVuZ3RoKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyBsb25nIGFkZEVudHJ5KGJ5dGVbXSBkYXRhLCBpbnQg\nb2Zmc2V0LCBpbnQgbGVuZ3RoKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBMT0cuZXJy\nb3IoIlRyaWVkIHRvIGFkZCBlbnRyeSBvbiBhIFJlYWQtT25seSBsZWRnZXIg\naGFuZGxlLCBsZWRnZXJpZD0iICsgbGVkZ2VySWQpOwogICAgICAgIHRocm93\nIEJLRXhjZXB0aW9uLmNyZWF0ZShCS0V4Y2VwdGlvbi5Db2RlLklsbGVnYWxP\ncEV4Y2VwdGlvbik7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCBhc3luY0FkZEVudHJ5KGZpbmFsIGJ5dGVbXSBkYXRhLCBmaW5hbCBB\nZGRDYWxsYmFjayBjYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIGFzeW5jQWRkRW50cnkoZGF0\nYSwgMCwgZGF0YS5sZW5ndGgsIGNiLCBjdHgpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgYXN5bmNBZGRFbnRyeShmaW5hbCBieXRl\nW10gZGF0YSwgZmluYWwgaW50IG9mZnNldCwgZmluYWwgaW50IGxlbmd0aCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgQWRkQ2FsbGJh\nY2sgY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBMT0cuZXJyb3Io\nIlRyaWVkIHRvIGFkZCBlbnRyeSBvbiBhIFJlYWQtT25seSBsZWRnZXIgaGFu\nZGxlLCBsZWRnZXJpZD0iICsgbGVkZ2VySWQpOwogICAgICAgIGNiLmFkZENv\nbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuSWxsZWdhbE9wRXhjZXB0aW9uLCB0\naGlzLAogICAgICAgICAgICAgICAgICAgICAgIExlZGdlckhhbmRsZS5JTlZB\nTElEX0VOVFJZX0lELCBjdHgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ndm9pZCBoYW5kbGVCb29raWVGYWlsdXJlKGZpbmFsIEJvb2tpZVNvY2tldEFk\nZHJlc3MgYWRkciwgZmluYWwgaW50IGJvb2tpZUluZGV4KSB7CiAgICAgICAg\nYmxvY2tBZGRDb21wbGV0aW9ucy5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKG1ldGFkYXRhKSB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBpZiAoIW1ldGFkYXRhLmN1cnJlbnRFbnNlbWJs\nZS5nZXQoYm9va2llSW5kZXgpLmVxdWFscyhhZGRyKSkgewogICAgICAgICAg\nICAgICAgICAgIC8vIGVuc2VtYmxlIGhhcyBhbHJlYWR5IGNoYW5nZWQsIGZh\naWx1cmUgb2YgdGhpcyBhZGRyIGlzIGltbWF0ZXJpYWwKICAgICAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIldyaXRlIGRpZCBub3Qgc3VjY2VlZCB0byB7\nfSwgYm9va2llSW5kZXgge30sIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArIiBidXQgd2UgaGF2ZSBhbHJlYWR5IGZpeGVkIGl0LiIsIGFkZHIs\nIGJvb2tpZUluZGV4KTsKICAgICAgICAgICAgICAgICAgICBibG9ja0FkZENv\nbXBsZXRpb25zLmRlY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICByZXBsYWNlQm9va2llSW5NZXRhZGF0YShhZGRyLCBib29raWVJbmRleCk7\nCgogICAgICAgICAgICAgICAgYmxvY2tBZGRDb21wbGV0aW9ucy5kZWNyZW1l\nbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAgIC8vIHRoZSBmYWlsZWQgYm9v\na2llIGhhcyBiZWVuIHJlcGxhY2VkCiAgICAgICAgICAgICAgICB1bnNldFN1\nY2Nlc3NBbmRTZW5kV3JpdGVSZXF1ZXN0KGJvb2tpZUluZGV4KTsKICAgICAg\nICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktOb3RFbm91Z2hCb29raWVz\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291\nbGQgbm90IGdldCBhZGRpdGlvbmFsIGJvb2tpZSB0byAiCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgKyAicmVtYWtlIGVuc2VtYmxlLCBjbG9zaW5nIGxl\nZGdlcjogIiArIGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIGhhbmRsZVVu\ncmVjb3ZlcmFibGVFcnJvckR1cmluZ0FkZChlLmdldENvZGUoKSk7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBvbkNoYW5nZWQo\nbG9uZyBsaWQsIExlZGdlck1ldGFkYXRhIG5ld01ldGFkYXRhKSB7CiAgICAg\nICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIExP\nRy5kZWJ1ZygiUmVjZWl2ZWQgbGVkZ2VyIG1ldGFkYXRhIHVwZGF0ZSBvbiB7\nfSA6IHt9IiwgbGlkLCBuZXdNZXRhZGF0YSk7CiAgICAgICAgfQogICAgICAg\nIGlmICh0aGlzLmxlZGdlcklkICE9IGxpZCkgewogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQogICAgICAgIGlmIChudWxsID09IG5ld01ldGFkYXRh\nKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgVmVy\nc2lvbi5PY2N1cnJlZCBvY2N1cnJlZCA9CiAgICAgICAgICAgICAgICB0aGlz\nLm1ldGFkYXRhLmdldFZlcnNpb24oKS5jb21wYXJlKG5ld01ldGFkYXRhLmdl\ndFZlcnNpb24oKSk7CiAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiVHJ5IHRvIHVwZGF0ZSBtZXRh\nZGF0YSBmcm9tIHt9IHRvIHt9IDoge30iLAogICAgICAgICAgICAgICAgICAg\nIG5ldyBPYmplY3RbXSB7IHRoaXMubWV0YWRhdGEsIG5ld01ldGFkYXRhLCBv\nY2N1cnJlZCB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKFZlcnNpb24uT2Nj\ndXJyZWQuQkVGT1JFID09IG9jY3VycmVkKSB7IC8vIHRoZSBtZXRhZGF0YSBp\ncyB1cGRhdGVkCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBi\nay5tYWluV29ya2VyUG9vbC5zdWJtaXRPcmRlcmVkKGxlZGdlcklkLCBuZXcg\nTWV0YWRhdGFVcGRhdGVyKG5ld01ldGFkYXRhKSk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKFJlamVjdGVkRXhlY3V0aW9uRXhjZXB0aW9uIHJlZSkgewogICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJGYWlsZWQgb24gc3VibWl0dGluZyB1\ncGRhdGVyIHRvIHVwZGF0ZSBsZWRnZXIgbWV0YWRhdGEgb24gbGVkZ2VyIHt9\nIDoge30iLAogICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZCwgbmV3\nTWV0YWRhdGEpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICByZXR1cm4gU3RyaW5nLmZvcm1hdCgiUmVhZE9ubHlMZWRnZXJIYW5k\nbGUobGlkID0gJWQsIGlkID0gJWQpIiwgbGVkZ2VySWQsIHN1cGVyLmhhc2hD\nb2RlKCkpOwogICAgfQoKfQo=\n","encoding":"base64"}

