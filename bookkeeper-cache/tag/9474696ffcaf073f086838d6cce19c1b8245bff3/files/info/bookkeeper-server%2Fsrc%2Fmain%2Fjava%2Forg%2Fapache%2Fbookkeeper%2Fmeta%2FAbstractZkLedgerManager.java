{"sha":"0fc8afee8658ef747e100ab53c23f6514e782517","node_id":"MDQ6QmxvYjE1NzU5NTY6MGZjOGFmZWU4NjU4ZWY3NDdlMTAwYWI1M2MyM2Y2NTE0ZTc4MjUxNw==","size":20389,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0fc8afee8658ef747e100ab53c23f6514e782517","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5OYXZpZ2Fi\nbGVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGls\nLlRyZWVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJy\nZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1\ncnJlbnRNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRv\ncnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TY2hlZHVsZWRFeGVj\ndXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1l\nVW5pdDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJL\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5MZWRnZXJNZXRhZGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jb25mLkFic3RyYWN0Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5MZWRnZXJN\nZXRhZGF0YUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5NdWx0aUNhbGxi\nYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tr\nZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Qcm9jZXNzb3I7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuWmtVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb247\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQXN5bmNDYWxsYmFjay5EYXRh\nQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0Nh\nbGxiYWNrLlN0YXRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLkFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uLkNvZGU7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuZGF0YS5TdGF0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29nbGUu\nY29tbW9uLnV0aWwuY29uY3VycmVudC5UaHJlYWRGYWN0b3J5QnVpbGRlcjsK\nCi8qKgogKiBBYnN0cmFjdCBsZWRnZXIgbWFuYWdlciBiYXNlZCBvbiB6b29r\nZWVwZXIsIHdoaWNoIHByb3ZpZGVzIGNvbW1vbiBtZXRob2RzIHN1Y2ggYXMg\ncXVlcnkgemsgbm9kZXMuCiAqLwphYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFpr\nTGVkZ2VyTWFuYWdlciBpbXBsZW1lbnRzIExlZGdlck1hbmFnZXIsIFdhdGNo\nZXIgewoKICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBM\nb2dnZXJGYWN0b3J5LmdldExvZ2dlcihBYnN0cmFjdFprTGVkZ2VyTWFuYWdl\nci5jbGFzcyk7CgogICAgc3RhdGljIGludCBaS19DT05ORUNUX0JBQ0tPRkZf\nTVMgPSAyMDA7CgogICAgcHJvdGVjdGVkIGZpbmFsIEFic3RyYWN0Q29uZmln\ndXJhdGlvbiBjb25mOwogICAgcHJvdGVjdGVkIGZpbmFsIFpvb0tlZXBlciB6\nazsKICAgIHByb3RlY3RlZCBmaW5hbCBTdHJpbmcgbGVkZ2VyUm9vdFBhdGg7\nCgogICAgLy8gbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVycwogICAgcHJvdGVj\ndGVkIGZpbmFsIENvbmN1cnJlbnRNYXA8TG9uZywgU2V0PExlZGdlck1ldGFk\nYXRhTGlzdGVuZXI+PiBsaXN0ZW5lcnMgPQogICAgICAgICAgICBuZXcgQ29u\nY3VycmVudEhhc2hNYXA8TG9uZywgU2V0PExlZGdlck1ldGFkYXRhTGlzdGVu\nZXI+PigpOwogICAgLy8gd2UgdXNlIHRoaXMgdG8gcHJldmVudCBsb25nIHN0\nYWNrIGNoYWlucyBmcm9tIGJ1aWxkaW5nIHVwIGluIGNhbGxiYWNrcwogICAg\ncHJvdGVjdGVkIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXI7\nCgogICAgcHJvdGVjdGVkIGNsYXNzIFJlYWRMZWRnZXJNZXRhZGF0YVRhc2sg\naW1wbGVtZW50cyBSdW5uYWJsZSwgR2VuZXJpY0NhbGxiYWNrPExlZGdlck1l\ndGFkYXRhPiB7CgogICAgICAgIGZpbmFsIGxvbmcgbGVkZ2VySWQ7CgogICAg\nICAgIFJlYWRMZWRnZXJNZXRhZGF0YVRhc2sobG9uZyBsZWRnZXJJZCkgewog\nICAgICAgICAgICB0aGlzLmxlZGdlcklkID0gbGVkZ2VySWQ7CiAgICAgICAg\nfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW4o\nKSB7CiAgICAgICAgICAgIGlmIChudWxsICE9IGxpc3RlbmVycy5nZXQobGVk\nZ2VySWQpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlJlLXJlYWQg\nbGVkZ2VyIG1ldGFkYXRhIGZvciB7fS4iLCBsZWRnZXJJZCk7CiAgICAgICAg\nICAgICAgICByZWFkTGVkZ2VyTWV0YWRhdGEobGVkZ2VySWQsIHRoaXMsIEFi\nc3RyYWN0WmtMZWRnZXJNYW5hZ2VyLnRoaXMpOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJMZWRnZXIgbWV0YWRh\ndGEgbGlzdGVuZXIgZm9yIGxlZGdlciB7fSBpcyBhbHJlYWR5IHJlbW92ZWQu\nIiwgbGVkZ2VySWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21w\nbGV0ZShpbnQgcmMsIGZpbmFsIExlZGdlck1ldGFkYXRhIHJlc3VsdCkgewog\nICAgICAgICAgICBpZiAoQktFeGNlcHRpb24uQ29kZS5PSyA9PSByYykgewog\nICAgICAgICAgICAgICAgZmluYWwgU2V0PExlZGdlck1ldGFkYXRhTGlzdGVu\nZXI+IGxpc3RlbmVyU2V0ID0gbGlzdGVuZXJzLmdldChsZWRnZXJJZCk7CiAg\nICAgICAgICAgICAgICBpZiAobnVsbCAhPSBsaXN0ZW5lclNldCkgewogICAg\nICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiTGVkZ2VyIG1ldGFkYXRhIGlz\nIGNoYW5nZWQgZm9yIHt9IDoge30uIiwgbGVkZ2VySWQsIHJlc3VsdCk7CiAg\nICAgICAgICAgICAgICAgICAgc2NoZWR1bGVyLnN1Ym1pdChuZXcgUnVubmFi\nbGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQobGlzdGVuZXJT\nZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKExl\nZGdlck1ldGFkYXRhTGlzdGVuZXIgbGlzdGVuZXIgOiBsaXN0ZW5lclNldCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5l\nci5vbkNoYW5nZWQobGVkZ2VySWQsIHJlc3VsdCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hMZWRnZXJFeGlzdHNFeGNl\ncHRpb24gPT0gcmMpIHsKICAgICAgICAgICAgICAgIC8vIHRoZSBsZWRnZXIg\naXMgcmVtb3ZlZCwgZG8gbm90aGluZwogICAgICAgICAgICAgICAgU2V0PExl\nZGdlck1ldGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0ID0gbGlzdGVuZXJz\nLnJlbW92ZShsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCAh\nPSBsaXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiUmVtb3ZlZCBsZWRnZXIgbWV0YWRhdGEgbGlzdGVuZXIgc2V0IG9uIGxl\nZGdlciB7fSBhcyBpdHMgbGVkZ2VyIGlzIGRlbGV0ZWQgOiB7fSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZCwgbGlzdGVuZXJTZXQu\nc2l6ZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIExPRy53YXJuKCJGYWlsZWQgb24gcmVhZCBs\nZWRnZXIgbWV0YWRhdGEgb2YgbGVkZ2VyIHt9IDoge30iLCBsZWRnZXJJZCwg\ncmMpOwogICAgICAgICAgICAgICAgc2NoZWR1bGVyLnNjaGVkdWxlKHRoaXMs\nIFpLX0NPTk5FQ1RfQkFDS09GRl9NUywgVGltZVVuaXQuTUlMTElTRUNPTkRT\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFpvb0tlZXBlci1iYXNlZCBMZWRnZXIgTWFuYWdlciBDb25zdHJ1Y3Rv\ncgogICAgICoKICAgICAqIEBwYXJhbSBjb25mCiAgICAgKiAgICAgICAgICBD\nb25maWd1cmF0aW9uIG9iamVjdAogICAgICogQHBhcmFtIHprCiAgICAgKiAg\nICAgICAgICBab29LZWVwZXIgQ2xpZW50IEhhbmRsZQogICAgICovCiAgICBw\ncm90ZWN0ZWQgQWJzdHJhY3Raa0xlZGdlck1hbmFnZXIoQWJzdHJhY3RDb25m\naWd1cmF0aW9uIGNvbmYsIFpvb0tlZXBlciB6aykgewogICAgICAgIHRoaXMu\nY29uZiA9IGNvbmY7CiAgICAgICAgdGhpcy56ayA9IHprOwogICAgICAgIHRo\naXMubGVkZ2VyUm9vdFBhdGggPSBjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRo\nKCk7CiAgICAgICAgdGhpcy5zY2hlZHVsZXIgPSBFeGVjdXRvcnMubmV3U2lu\nZ2xlVGhyZWFkU2NoZWR1bGVkRXhlY3V0b3IoKTsKICAgICAgICBUaHJlYWRG\nYWN0b3J5QnVpbGRlciB0ZmIgPSBuZXcgVGhyZWFkRmFjdG9yeUJ1aWxkZXIo\nKS5zZXROYW1lRm9ybWF0KAogICAgICAgICAgICAgICAgIlprTGVkZ2VyTWFu\nYWdlclNjaGVkdWxlci0lZCIpOwogICAgICAgIHRoaXMuc2NoZWR1bGVyID0g\nRXhlY3V0b3JzCiAgICAgICAgICAgICAgICAubmV3U2luZ2xlVGhyZWFkU2No\nZWR1bGVkRXhlY3V0b3IodGZiLmJ1aWxkKCkpOwogICAgICAgIExPRy5kZWJ1\nZygiVXNpbmcgQWJzdHJhY3Raa0xlZGdlck1hbmFnZXIgd2l0aCByb290IHBh\ndGggOiB7fSIsIGxlZGdlclJvb3RQYXRoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEdldCB0aGUgem5vZGUgcGF0aCB0aGF0IGlzIHVzZWQgdG8gc3RvcmUg\nbGVkZ2VyIG1ldGFkYXRhCiAgICAgKgogICAgICogQHBhcmFtIGxlZGdlcklk\nCiAgICAgKiAgICAgICAgICBMZWRnZXIgSUQKICAgICAqIEByZXR1cm4gbGVk\nZ2VyIG5vZGUgcGF0aAogICAgICovCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qg\nU3RyaW5nIGdldExlZGdlclBhdGgobG9uZyBsZWRnZXJJZCk7CgogICAgLyoq\nCiAgICAgKiBHZXQgbGVkZ2VyIGlkIGZyb20gaXRzIHpub2RlIGxlZGdlciBw\nYXRoCiAgICAgKgogICAgICogQHBhcmFtIGxlZGdlclBhdGgKICAgICAqICAg\nICAgICAgIExlZGdlciBwYXRoIHRvIHN0b3JlIG1ldGFkYXRhCiAgICAgKiBA\ncmV0dXJuIGxlZGdlciBpZAogICAgICogQHRocm93cyBJT0V4Y2VwdGlvbiB3\naGVuIHRoZSBsZWRnZXIgcGF0aCBpcyBpbnZhbGlkCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBsb25nIGdldExlZGdlcklkKFN0cmluZyBsZWRn\nZXJQYXRoKSB0aHJvd3MgSU9FeGNlcHRpb247CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBldmVudCkgewog\nICAgICAgIExPRy5pbmZvKCJSZWNlaXZlZCB3YXRjaGVkIGV2ZW50IHt9IGZy\nb20gem9va2VlcGVyIGJhc2VkIGxlZGdlciBtYW5hZ2VyLiIsIGV2ZW50KTsK\nICAgICAgICBpZiAoRXZlbnQuRXZlbnRUeXBlLk5vbmUgPT0gZXZlbnQuZ2V0\nVHlwZSgpKSB7CiAgICAgICAgICAgIC8qKiBUT0RPOiBCT09LS0VFUEVSLTUz\nNyB0byBoYW5kbGUgZXhwaXJlIGV2ZW50cy4KICAgICAgICAgICAgaWYgKEV2\nZW50LktlZXBlclN0YXRlLkV4cGlyZWQgPT0gZXZlbnQuZ2V0U3RhdGUoKSkg\newogICAgICAgICAgICAgICAgTE9HLmluZm8oIlpvb0tlZXBlciBjbGllbnQg\nZXhwaXJlZCBvbiBsZWRnZXIgbWFuYWdlci4iKTsKICAgICAgICAgICAgICAg\nIFNldDxMb25nPiBrZXlTZXQgPSBuZXcgSGFzaFNldDxMb25nPihsaXN0ZW5l\ncnMua2V5U2V0KCkpOwogICAgICAgICAgICAgICAgZm9yIChMb25nIGxpZCA6\nIGtleVNldCkgewogICAgICAgICAgICAgICAgICAgIHNjaGVkdWxlci5zdWJt\naXQobmV3IFJlYWRMZWRnZXJNZXRhZGF0YVRhc2sobGlkKSk7CiAgICAgICAg\nICAgICAgICAgICAgTE9HLmluZm8oIlJlLXJlYWQgbGVkZ2VyIG1ldGFkYXRh\nIGZvciB7fSBhZnRlciB6b29rZWVwZXIgc2Vzc2lvbiBleHBpcmVkLiIsIGxp\nZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgKiovCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAg\nU3RyaW5nIHBhdGggPSBldmVudC5nZXRQYXRoKCk7CiAgICAgICAgaWYgKG51\nbGwgPT0gcGF0aCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQog\nICAgICAgIGZpbmFsIGxvbmcgbGVkZ2VySWQ7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgbGVkZ2VySWQgPSBnZXRMZWRnZXJJZChldmVudC5nZXRQYXRo\nKCkpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAg\nICAgICAgICBMT0cuaW5mbygiUmVjZWl2ZWQgaW52YWxpZCBsZWRnZXIgcGF0\naCB7fSA6ICIsIGV2ZW50LmdldFBhdGgoKSwgaW9lKTsKICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKGV2ZW50LmdldFR5\ncGUoKSkgewogICAgICAgIGNhc2UgTm9kZURlbGV0ZWQ6CiAgICAgICAgICAg\nIFNldDxMZWRnZXJNZXRhZGF0YUxpc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxp\nc3RlbmVycy5nZXQobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAobnVsbCAh\nPSBsaXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAgc3luY2hyb25pemVk\nKGxpc3RlbmVyU2V0KXsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIlJlbW92ZWQgbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVycyBvbiBsZWRnZXIg\ne30gOiB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJ\nZCwgbGlzdGVuZXJTZXQpOwogICAgICAgICAgICAgICAgICAgIGZvcihMZWRn\nZXJNZXRhZGF0YUxpc3RlbmVyIGwgOiBsaXN0ZW5lclNldCkgewogICAgICAg\nICAgICAgICAgICAgICAgICB1bnJlZ2lzdGVyTGVkZ2VyTWV0YWRhdGFMaXN0\nZW5lcihsZWRnZXJJZCwgbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwu\nb25DaGFuZ2VkKCBsZWRnZXJJZCwgbnVsbCApOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiTm8gbGVkZ2VyIG1ldGFkYXRh\nIGxpc3RlbmVycyB0byByZW1vdmUgZnJvbSBsZWRnZXIge30gYWZ0ZXIgaXQn\ncyBkZWxldGVkLiIsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcklk\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBj\nYXNlIE5vZGVEYXRhQ2hhbmdlZDoKICAgICAgICAgICAgbmV3IFJlYWRMZWRn\nZXJNZXRhZGF0YVRhc2sobGVkZ2VySWQpLnJ1bigpOwogICAgICAgICAgICBi\ncmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBMT0cuZGVidWco\nIlJlY2VpdmVkIGV2ZW50IHt9IG9uIHt9LiIsIGV2ZW50LmdldFR5cGUoKSwg\nZXZlbnQuZ2V0UGF0aCgpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmVtb3ZlcyBsZWRnZXIgbWV0YWRh\ndGEgZnJvbSBab29LZWVwZXIgaWYgdmVyc2lvbiBtYXRjaGVzLgogICAgICoK\nICAgICAqIEBwYXJhbSAgIGxlZGdlcklkICAgIGxlZGdlciBpZGVudGlmaWVy\nCiAgICAgKiBAcGFyYW0gICB2ZXJzaW9uICAgICBsb2NhbCB2ZXJzaW9uIG9m\nIG1ldGFkYXRhIHpub2RlCiAgICAgKiBAcGFyYW0gICBjYiAgICAgICAgICBj\nYWxsYmFjayBvYmplY3QKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCByZW1vdmVMZWRnZXJNZXRhZGF0YShmaW5hbCBsb25nIGxlZGdl\ncklkLCBmaW5hbCBWZXJzaW9uIHZlcnNpb24sCiAgICAgICAgICAgIGZpbmFs\nIEdlbmVyaWNDYWxsYmFjazxWb2lkPiBjYikgewogICAgICAgIGludCB6bm9k\nZVZlcnNpb24gPSAtMTsKICAgICAgICBpZiAoVmVyc2lvbi5ORVcgPT0gdmVy\nc2lvbikgewogICAgICAgICAgICBMT0cuZXJyb3IoIlJlcXVlc3QgdG8gZGVs\nZXRlIGxlZGdlciB7fSBtZXRhZGF0YSB3aXRoIHZlcnNpb24gc2V0IHRvIHRo\nZSBpbml0aWFsIG9uZSIsIGxlZGdlcklkKTsKICAgICAgICAgICAgY2Iub3Bl\ncmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5NZXRhZGF0YVZlcnNp\nb25FeGNlcHRpb24sIChWb2lkKW51bGwpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfSBlbHNlIGlmIChWZXJzaW9uLkFOWSAhPSB2ZXJzaW9uKSB7\nCiAgICAgICAgICAgIGlmICghKHZlcnNpb24gaW5zdGFuY2VvZiBaa1ZlcnNp\nb24pKSB7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiTm90IGFuIGluc3Rh\nbmNlIG9mIFpLVmVyc2lvbjoge30iLCBsZWRnZXJJZCk7CiAgICAgICAgICAg\nICAgICBjYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk1l\ndGFkYXRhVmVyc2lvbkV4Y2VwdGlvbiwgKFZvaWQpbnVsbCk7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAg\nICAgICAgICB6bm9kZVZlcnNpb24gPSAoKFprVmVyc2lvbil2ZXJzaW9uKS5n\nZXRabm9kZVZlcnNpb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgemsuZGVsZXRlKGdldExlZGdlclBhdGgobGVkZ2VySWQpLCB6bm9k\nZVZlcnNpb24sIG5ldyBWb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0\nKGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgICAgIGludCBia1JjOwogICAgICAgICAgICAgICAgaWYgKHJjID09IEtl\nZXBlckV4Y2VwdGlvbi5Db2RlLk5PTk9ERS5pbnRWYWx1ZSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLndhcm4oIkxlZGdlciBub2RlIGRvZXMgbm90\nIGV4aXN0IGluIFpvb0tlZXBlcjogbGVkZ2VySWQ9e30iLCBsZWRnZXJJZCk7\nCiAgICAgICAgICAgICAgICAgICAgYmtSYyA9IEJLRXhjZXB0aW9uLkNvZGUu\nTm9TdWNoTGVkZ2VyRXhpc3RzRXhjZXB0aW9uOwogICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChyYyA9PSBLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRW\nYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlZCBsaXN0\nZW5lciBvbiBsZWRnZXJJZAogICAgICAgICAgICAgICAgICAgIFNldDxMZWRn\nZXJNZXRhZGF0YUxpc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxpc3RlbmVycy5y\nZW1vdmUobGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChudWxs\nICE9IGxpc3RlbmVyU2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5kZWJ1ZygiUmVtb3ZlIHJlZ2lzdGVyZWQgbGVkZ2VyIG1ldGFkYXRhIGxp\nc3RlbmVycyBvbiBsZWRnZXIge30gYWZ0ZXIgbGVkZ2VyIGlzIGRlbGV0ZWQu\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZCwg\nbGlzdGVuZXJTZXQpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiTm8gbGVkZ2VyIG1l\ndGFkYXRhIGxpc3RlbmVycyB0byByZW1vdmUgZnJvbSBsZWRnZXIge30gd2hl\nbiBpdCdzIGJlaW5nIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGJrUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9L\nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICBia1JjID0gQktFeGNlcHRpb24uQ29kZS5aS0V4Y2VwdGlvbjsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBs\nZXRlKGJrUmMsIChWb2lkKW51bGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSwgbnVsbCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCByZWdpc3RlckxlZGdlck1ldGFkYXRhTGlzdGVuZXIobG9uZyBsZWRnZXJJ\nZCwgTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAg\nIGlmIChudWxsICE9IGxpc3RlbmVyKSB7CiAgICAgICAgICAgIExPRy5pbmZv\nKCJSZWdpc3RlcmVkIGxlZGdlciBtZXRhZGF0YSBsaXN0ZW5lciB7fSBvbiBs\nZWRnZXIge30uIiwgbGlzdGVuZXIsIGxlZGdlcklkKTsKICAgICAgICAgICAg\nU2V0PExlZGdlck1ldGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0ID0gbGlz\ndGVuZXJzLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChsaXN0ZW5l\nclNldCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBTZXQ8TGVkZ2VyTWV0\nYWRhdGFMaXN0ZW5lcj4gbmV3TGlzdGVuZXJTZXQgPSBuZXcgSGFzaFNldDxM\nZWRnZXJNZXRhZGF0YUxpc3RlbmVyPigpOwogICAgICAgICAgICAgICAgU2V0\nPExlZGdlck1ldGFkYXRhTGlzdGVuZXI+IG9sZExpc3RlbmVyU2V0ID0gbGlz\ndGVuZXJzLnB1dElmQWJzZW50KGxlZGdlcklkLCBuZXdMaXN0ZW5lclNldCk7\nCiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBvbGRMaXN0ZW5lclNldCkg\newogICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyU2V0ID0gb2xkTGlzdGVu\nZXJTZXQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIGxpc3RlbmVyU2V0ID0gbmV3TGlzdGVuZXJTZXQ7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3luY2hyb25p\nemVkIChsaXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAgbGlzdGVuZXJT\nZXQuYWRkKGxpc3RlbmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBu\nZXcgUmVhZExlZGdlck1ldGFkYXRhVGFzayhsZWRnZXJJZCkucnVuKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\ndW5yZWdpc3RlckxlZGdlck1ldGFkYXRhTGlzdGVuZXIobG9uZyBsZWRnZXJJ\nZCwgTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAg\nIFNldDxMZWRnZXJNZXRhZGF0YUxpc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxp\nc3RlbmVycy5nZXQobGVkZ2VySWQpOwogICAgICAgIGlmIChsaXN0ZW5lclNl\ndCAhPSBudWxsKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAobGlzdGVu\nZXJTZXQpIHsKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lclNldC5yZW1v\ndmUobGlzdGVuZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8o\nIlVucmVnaXN0ZXJlZCBsZWRnZXIgbWV0YWRhdGEgbGlzdGVuZXIge30gb24g\nbGVkZ2VyIHt9LiIsIGxpc3RlbmVyLCBsZWRnZXJJZCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXJTZXQuaXNFbXB0\neSgpKSB7CiAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXJzLnJlbW92ZShs\nZWRnZXJJZCwgbGlzdGVuZXJTZXQpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgcmVhZExlZGdlck1ldGFkYXRhKGZpbmFsIGxvbmcgbGVk\nZ2VySWQsIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4g\ncmVhZENiKSB7CiAgICAgICAgcmVhZExlZGdlck1ldGFkYXRhKGxlZGdlcklk\nLCByZWFkQ2IsIG51bGwpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHJl\nYWRMZWRnZXJNZXRhZGF0YShmaW5hbCBsb25nIGxlZGdlcklkLCBmaW5hbCBH\nZW5lcmljQ2FsbGJhY2s8TGVkZ2VyTWV0YWRhdGE+IHJlYWRDYiwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBXYXRjaGVyIHdhdGNo\nZXIpIHsKICAgICAgICB6ay5nZXREYXRhKGdldExlZGdlclBhdGgobGVkZ2Vy\nSWQpLCB3YXRjaGVyLCBuZXcgRGF0YUNhbGxiYWNrKCkgewogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jl\nc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBieXRlW10g\nZGF0YSwgU3RhdCBzdGF0KSB7CiAgICAgICAgICAgICAgICBpZiAocmMgPT0g\nS2VlcGVyRXhjZXB0aW9uLkNvZGUuTk9OT0RFLmludFZhbHVlKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJObyBzdWNoIGxl\nZGdlcjogIiArIGxlZGdlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNlcHRp\nb24uQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIHJlYWRDYi5vcGVyYXRpb25Db21wbGV0\nZShCS0V4Y2VwdGlvbi5Db2RlLk5vU3VjaExlZGdlckV4aXN0c0V4Y2VwdGlv\nbiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHJjICE9IEtlZXBlckV4\nY2VwdGlvbi5Db2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCByZWFkIG1ldGFkYXRhIGZvciBs\nZWRnZXI6ICIgKyBsZWRnZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNlcHRpb24u\nQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAgICAgcmVh\nZENiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuWktFeGNl\ncHRpb24sIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBMZWRnZXJNZXRhZGF0\nYSBtZXRhZGF0YTsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgbWV0YWRhdGEgPSBMZWRnZXJNZXRhZGF0YS5wYXJzZUNvbmZp\nZyhkYXRhLCBuZXcgWmtWZXJzaW9uKHN0YXQuZ2V0VmVyc2lvbigpKSk7CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3QgcGFyc2UgbGVk\nZ2VyIG1ldGFkYXRhIGZvciBsZWRnZXI6ICIgKyBsZWRnZXJJZCwgZSk7CiAg\nICAgICAgICAgICAgICAgICAgcmVhZENiLm9wZXJhdGlvbkNvbXBsZXRlKEJL\nRXhjZXB0aW9uLkNvZGUuWktFeGNlcHRpb24sIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIHJlYWRDYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5D\nb2RlLk9LLCBtZXRhZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBu\ndWxsKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHdy\naXRlTGVkZ2VyTWV0YWRhdGEoZmluYWwgbG9uZyBsZWRnZXJJZCwgZmluYWwg\nTGVkZ2VyTWV0YWRhdGEgbWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxWb2lkPiBj\nYikgewogICAgICAgIFZlcnNpb24gdiA9IG1ldGFkYXRhLmdldFZlcnNpb24o\nKTsKICAgICAgICBpZiAoVmVyc2lvbi5ORVcgPT0gdiB8fCAhKHYgaW5zdGFu\nY2VvZiBaa1ZlcnNpb24pKSB7CiAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNv\nbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuTWV0YWRhdGFWZXJzaW9uRXhjZXB0\naW9uLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAg\nICAgICBmaW5hbCBaa1ZlcnNpb24genYgPSAoWmtWZXJzaW9uKSB2OwogICAg\nICAgIHprLnNldERhdGEoZ2V0TGVkZ2VyUGF0aChsZWRnZXJJZCksCiAgICAg\nICAgICAgICAgICAgICBtZXRhZGF0YS5zZXJpYWxpemUoKSwgenYuZ2V0Wm5v\nZGVWZXJzaW9uKCksCiAgICAgICAgICAgICAgICAgICBuZXcgU3RhdENhbGxi\nYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBP\nYmplY3QgY3R4LCBTdGF0IHN0YXQpIHsKICAgICAgICAgICAgICAgIGlmIChL\nZWVwZXJFeGNlcHRpb24uQ29kZS5CQURWRVJTSU9OLmludFZhbHVlKCkgPT0g\ncmMpIHsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25Db21wbGV0\nZShCS0V4Y2VwdGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4Y2VwdGlvbiwg\nbnVsbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKEtlZXBlckV4Y2Vw\ndGlvbi5Db2RlLk9LLmludFZhbHVlKCkgPT0gcmMpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyB1cGRhdGUgbWV0YWRhdGEgdmVyc2lvbgogICAgICAgICAg\nICAgICAgICAgIG1ldGFkYXRhLnNldFZlcnNpb24oenYuc2V0Wm5vZGVWZXJz\naW9uKHN0YXQuZ2V0VmVyc2lvbigpKSk7CiAgICAgICAgICAgICAgICAgICAg\nY2Iub3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgbnVs\nbCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIExPRy53YXJuKCJDb25kaXRpb25hbCB1cGRhdGUgbGVkZ2VyIG1ldGFk\nYXRhIGZhaWxlZDogIiwgS2VlcGVyRXhjZXB0aW9uLkNvZGUuZ2V0KHJjKSk7\nCiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUoQktF\neGNlcHRpb24uQ29kZS5aS0V4Y2VwdGlvbiwgbnVsbCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LCBudWxsKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFByb2Nlc3MgbGVkZ2VycyBpbiBhIHNpbmdsZSB6\nayBub2RlLgogICAgICoKICAgICAqIDxwPgogICAgICogZm9yIGVhY2ggbGVk\nZ2VyIGZvdW5kIGluIHRoaXMgemsgbm9kZSwgcHJvY2Vzc29yI3Byb2Nlc3Mo\nbGVkZ2VySWQpIHdpbGwgYmUgdHJpZ2dlcnJlZAogICAgICogdG8gcHJvY2Vz\ncyBhIHNwZWNpZmljIGxlZGdlci4gYWZ0ZXIgYWxsIGxlZGdlcnMgaGFzIGJl\nZW4gcHJvY2Vzc2VkLCB0aGUgZmluYWxDYiB3aWxsCiAgICAgKiBiZSBjYWxs\nZWQgd2l0aCBwcm92aWRlZCBjb250ZXh0IG9iamVjdC4gVGhlIFJDIHBhc3Nl\nZCB0byBmaW5hbENiIGlzIGRlY2lkZWQgYnkgOgogICAgICogPHVsPgogICAg\nICogPGxpPiBBbGwgbGVkZ2VycyBhcmUgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxs\neSwgc3VjY2Vzc1JjIHdpbGwgYmUgcGFzc2VkLgogICAgICogPGxpPiBFaXRo\nZXIgbGVkZ2VyIGlzIHByb2Nlc3NlZCBmYWlsZWQsIGZhaWx1cmVSYyB3aWxs\nIGJlIHBhc3NlZC4KICAgICAqIDwvdWw+CiAgICAgKiA8L3A+CiAgICAgKgog\nICAgICogQHBhcmFtIHBhdGgKICAgICAqICAgICAgICAgIFprIG5vZGUgcGF0\naCB0byBzdG9yZSBsZWRnZXJzCiAgICAgKiBAcGFyYW0gcHJvY2Vzc29yCiAg\nICAgKiAgICAgICAgICBQcm9jZXNzb3IgcHJvdmlkZWQgdG8gcHJvY2VzcyBs\nZWRnZXIKICAgICAqIEBwYXJhbSBmaW5hbENiCiAgICAgKiAgICAgICAgICBD\nYWxsYmFjayBvYmplY3Qgd2hlbiBhbGwgbGVkZ2VycyBhcmUgcHJvY2Vzc2Vk\nCiAgICAgKiBAcGFyYW0gY3R4CiAgICAgKiAgICAgICAgICBDb250ZXh0IG9i\namVjdCBwYXNzZWQgdG8gZmluYWxDYgogICAgICogQHBhcmFtIHN1Y2Nlc3NS\nYwogICAgICogICAgICAgICAgUkMgcGFzc2VkIHRvIGZpbmFsQ2Igd2hlbiBh\nbGwgbGVkZ2VycyBhcmUgcHJvY2Vzc2VkIHN1Y2Nlc3NmdWxseQogICAgICog\nQHBhcmFtIGZhaWx1cmVSYwogICAgICogICAgICAgICAgUkMgcGFzc2VkIHRv\nIGZpbmFsQ2Igd2hlbiBlaXRoZXIgbGVkZ2VyIGlzIHByb2Nlc3NlZCBmYWls\nZWQKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgYXN5bmNQcm9jZXNzTGVk\nZ2Vyc0luU2luZ2xlTm9kZSgKICAgICAgICAgICAgZmluYWwgU3RyaW5nIHBh\ndGgsIGZpbmFsIFByb2Nlc3NvcjxMb25nPiBwcm9jZXNzb3IsCiAgICAgICAg\nICAgIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGZpbmFsQ2Is\nIGZpbmFsIE9iamVjdCBjdHgsCiAgICAgICAgICAgIGZpbmFsIGludCBzdWNj\nZXNzUmMsIGZpbmFsIGludCBmYWlsdXJlUmMpIHsKICAgICAgICBaa1V0aWxz\nLmdldENoaWxkcmVuSW5TaW5nbGVOb2RlKHprLCBwYXRoLCBuZXcgR2VuZXJp\nY0NhbGxiYWNrPExpc3Q8U3RyaW5nPj4oKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21wbGV0\nZShpbnQgcmMsIExpc3Q8U3RyaW5nPiBsZWRnZXJOb2RlcykgewogICAgICAg\nICAgICAgICAgaWYgKENvZGUuT0suaW50VmFsdWUoKSAhPSByYykgewogICAg\nICAgICAgICAgICAgICAgIGZpbmFsQ2IucHJvY2Vzc1Jlc3VsdChmYWlsdXJl\nUmMsIG51bGwsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFNldDxMb25nPiB6\na0FjdGl2ZUxlZGdlcnMgPSBsZWRnZXJMaXN0VG9TZXQobGVkZ2VyTm9kZXMs\nIHBhdGgpOwogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJQcm9jZXNzaW5n\nIGxlZGdlcnM6IHt9IiwgemtBY3RpdmVMZWRnZXJzKTsKCiAgICAgICAgICAg\nICAgICAvLyBubyBsZWRnZXJzIGZvdW5kLCByZXR1cm4gZGlyZWN0bHkKICAg\nICAgICAgICAgICAgIGlmICh6a0FjdGl2ZUxlZGdlcnMuc2l6ZSgpID09IDAp\nIHsKICAgICAgICAgICAgICAgICAgICBmaW5hbENiLnByb2Nlc3NSZXN1bHQo\nc3VjY2Vzc1JjLCBudWxsLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBNdWx0\naUNhbGxiYWNrIG1jYiA9IG5ldyBNdWx0aUNhbGxiYWNrKHprQWN0aXZlTGVk\nZ2Vycy5zaXplKCksIGZpbmFsQ2IsIGN0eCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2Vzc1Jj\nLCBmYWlsdXJlUmMpOwogICAgICAgICAgICAgICAgLy8gc3RhcnQgbG9vcCBv\ndmVyIGFsbCBsZWRnZXJzCiAgICAgICAgICAgICAgICBmb3IgKExvbmcgbGVk\nZ2VyIDogemtBY3RpdmVMZWRnZXJzKSB7CiAgICAgICAgICAgICAgICAgICAg\ncHJvY2Vzc29yLnByb2Nlc3MobGVkZ2VyLCBtY2IpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBXaGV0aGVyIHRoZSB6bm9kZSBhIHNwZWNpYWwgem5vZGUKICAg\nICAqCiAgICAgKiBAcGFyYW0gem5vZGUKICAgICAqICAgICAgICAgIFpub2Rl\nIE5hbWUKICAgICAqIEByZXR1cm4gdHJ1ZSAgaWYgdGhlIHpub2RlIGlzIGEg\nc3BlY2lhbCB6bm9kZSBvdGhlcndpc2UgZmFsc2UKICAgICAqLwogICAgcHJv\ndGVjdGVkIGJvb2xlYW4gaXNTcGVjaWFsWm5vZGUoU3RyaW5nIHpub2RlKSB7\nCiAgICAgICAgaWYgKEJvb2tLZWVwZXJDb25zdGFudHMuQVZBSUxBQkxFX05P\nREUuZXF1YWxzKHpub2RlKQogICAgICAgICAgICAgICAgfHwgQm9va0tlZXBl\nckNvbnN0YW50cy5DT09LSUVfTk9ERS5lcXVhbHMoem5vZGUpCiAgICAgICAg\nICAgICAgICB8fCBCb29rS2VlcGVyQ29uc3RhbnRzLkxBWU9VVF9aTk9ERS5l\ncXVhbHMoem5vZGUpCiAgICAgICAgICAgICAgICB8fCBCb29rS2VlcGVyQ29u\nc3RhbnRzLklOU1RBTkNFSUQuZXF1YWxzKHpub2RlKQogICAgICAgICAgICAg\nICAgfHwgQm9va0tlZXBlckNvbnN0YW50cy5VTkRFUl9SRVBMSUNBVElPTl9O\nT0RFLmVxdWFscyh6bm9kZSkpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIENvbnZlcnQgdGhlIFpLIHJldHJpZXZlZCBsZWRnZXIgbm9k\nZXMgdG8gYSBIYXNoU2V0IGZvciBlYXNpZXIgY29tcGFyaXNvbnMuCiAgICAg\nKgogICAgICogQHBhcmFtIGxlZGdlck5vZGVzCiAgICAgKiAgICAgICAgICB6\nayBsZWRnZXIgbm9kZXMKICAgICAqIEBwYXJhbSBwYXRoCiAgICAgKiAgICAg\nICAgICB0aGUgcHJlZml4IHBhdGggb2YgdGhlIGxlZGdlciBub2RlcwogICAg\nICogQHJldHVybiBsZWRnZXIgaWQgaGFzaCBzZXQKICAgICAqLwogICAgcHJv\ndGVjdGVkIE5hdmlnYWJsZVNldDxMb25nPiBsZWRnZXJMaXN0VG9TZXQoTGlz\ndDxTdHJpbmc+IGxlZGdlck5vZGVzLCBTdHJpbmcgcGF0aCkgewogICAgICAg\nIE5hdmlnYWJsZVNldDxMb25nPiB6a0FjdGl2ZUxlZGdlcnMgPSBuZXcgVHJl\nZVNldDxMb25nPigpOwogICAgICAgIGZvciAoU3RyaW5nIGxlZGdlck5vZGUg\nOiBsZWRnZXJOb2RlcykgewogICAgICAgICAgICBpZiAoaXNTcGVjaWFsWm5v\nZGUobGVkZ2VyTm9kZSkpIHsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAvLyBjb252ZXJ0IHRoZSBub2RlIHBhdGggdG8gbGVkZ2VyIGlkIGFjY29y\nZGluZyB0byBkaWZmZXJlbnQgbGVkZ2VyIG1hbmFnZXIgaW1wbGVtZW50YXRp\nb24KICAgICAgICAgICAgICAgIHprQWN0aXZlTGVkZ2Vycy5hZGQoZ2V0TGVk\nZ2VySWQocGF0aCArICIvIiArIGxlZGdlck5vZGUpKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9H\nLndhcm4oIkVycm9yIGV4dHJhY3RpbmcgbGVkZ2VySWQgZnJvbSBaSyBsZWRn\nZXIgbm9kZTogIiArIGxlZGdlck5vZGUpOwogICAgICAgICAgICAgICAgLy8g\nVGhpcyBpcyBhIHByZXR0eSBiYWQgZXJyb3IgYXMgaXQgaW5kaWNhdGVzIGEg\nbGVkZ2VyIG5vZGUgaW4gWksKICAgICAgICAgICAgICAgIC8vIGhhcyBhbiBp\nbmNvcnJlY3QgZm9ybWF0LiBGb3Igbm93IGp1c3QgY29udGludWUgYW5kIGNv\nbnNpZGVyCiAgICAgICAgICAgICAgICAvLyB0aGlzIGFzIGEgbm9uLWV4aXN0\nZW50IGxlZGdlci4KICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB6a0FjdGl2ZUxlZGdl\ncnM7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjbG9z\nZSgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBzY2hlZHVsZXIuc2h1\ndGRvd24oKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cud2FybigiRXJyb3Igd2hlbiBjbG9zaW5nIHpvb2tlZXBl\nciBiYXNlZCBsZWRnZXIgbWFuYWdlcjogIiwgZSk7CiAgICAgICAgfQogICAg\nfQp9Cg==\n","encoding":"base64"}

