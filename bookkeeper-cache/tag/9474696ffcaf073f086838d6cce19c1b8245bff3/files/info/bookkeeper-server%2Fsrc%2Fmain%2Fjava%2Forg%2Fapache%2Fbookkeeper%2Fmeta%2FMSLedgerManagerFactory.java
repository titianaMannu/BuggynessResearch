{"sha":"2510b89d749f3123f0ea225b3396d1e84e28f292","node_id":"MDQ6QmxvYjE1NzU5NTY6MjUxMGI4OWQ3NDlmMzEyM2YwZWEyMjViMzM5NmQxZTg0ZTI4ZjI5Mg==","size":32681,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2510b89d749f3123f0ea225b3396d1e84e28f292","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YTsKCmltcG9ydCBzdGF0\naWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVU\nYWJsZS5BTExfRklFTERTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlVGFibGUuTk9OX0ZJRUxEUzsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGls\nLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlNvcnRlZFNldDsKaW1w\nb3J0IGphdmEudXRpbC5UcmVlU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5Db25jdXJyZW50TWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuRXhlY3V0b3JzOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5MZWRnZXJNZXRhZGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jb25mLkFic3RyYWN0Q29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkFic3RyYWN0WmtMZWRn\nZXJNYW5hZ2VyLlJlYWRMZWRnZXJNZXRhZGF0YVRhc2s7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLk1TRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU1dhdGNoZWRF\ndmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhc3RvcmUu\nTWV0YVN0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFz\ndG9yZS5NZXRhc3RvcmVDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlQ3Vyc29yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVDdXJzb3Iu\nUmVhZEVudHJpZXNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVGYWN0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRh\nc3RvcmVTY2FubmFibGVUYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlVGFibGVJdGVtOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVXYXRjaGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU1dh\ndGNoZWRFdmVudC5FdmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubWV0YXN0b3JlLlZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5l\ncmljQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkxlZGdlck1ldGFkYXRh\nTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLlByb2Nlc3NvcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlv\nbkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGls\nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0\naWwuWmtVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJz\naW9uaW5nLlZlcnNpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ndmVyc2lvbmluZy5WZXJzaW9uZWQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tl\nZXBlci5Bc3luY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuQXN5bmNDYWxsYmFjay5TdHJpbmdDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5ab29EZWZzLklkczsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7Cmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBjb20uZ29v\nZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuVGhyZWFkRmFjdG9yeUJ1aWxk\nZXI7CgovKioKICogTWV0YVN0b3JlIEJhc2VkIExlZGdlciBNYW5hZ2VyIEZh\nY3RvcnkKICovCnB1YmxpYyBjbGFzcyBNU0xlZGdlck1hbmFnZXJGYWN0b3J5\nIGV4dGVuZHMgTGVkZ2VyTWFuYWdlckZhY3RvcnkgewoKICAgIHByaXZhdGUg\nZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihNU0xlZGdlck1hbmFnZXJGYWN0b3J5LmNsYXNzKTsKCiAgICBzdGF0\naWMgaW50IE1TX0NPTk5FQ1RfQkFDS09GRl9NUyA9IDIwMDsKCiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBDVVJfVkVSU0lPTiA9IDE7CgogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVEFCTEVfTkFNRSA9ICJMRURHRVIi\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgTUVUQV9GSUVMRCA9\nICIuTUVUQSI7CgogICAgQWJzdHJhY3RDb25maWd1cmF0aW9uIGNvbmY7CiAg\nICBab29LZWVwZXIgems7CiAgICBNZXRhU3RvcmUgbWV0YXN0b3JlOwoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIGludCBnZXRDdXJyZW50VmVyc2lvbigp\nIHsKICAgICAgICByZXR1cm4gQ1VSX1ZFUlNJT047CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgTGVkZ2VyTWFuYWdlckZhY3RvcnkgaW5pdGlh\nbGl6ZShmaW5hbCBBYnN0cmFjdENvbmZpZ3VyYXRpb24gY29uZiwgZmluYWwg\nWm9vS2VlcGVyIHprLAogICAgICAgICAgICBmaW5hbCBpbnQgZmFjdG9yeVZl\ncnNpb24pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKENVUl9W\nRVJTSU9OICE9IGZhY3RvcnlWZXJzaW9uKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbigiSW5jb21wYXRpYmxlIGxheW91dCB2ZXJzaW9u\nIGZvdW5kIDogIiArIGZhY3RvcnlWZXJzaW9uKTsKICAgICAgICB9CiAgICAg\nICAgdGhpcy5jb25mID0gY29uZjsKICAgICAgICB0aGlzLnprID0gems7Cgog\nICAgICAgIC8vIGxvYWQgbWV0YWRhdGEgc3RvcmUKICAgICAgICBTdHJpbmcg\nbXNOYW1lID0gY29uZi5nZXRNZXRhc3RvcmVJbXBsQ2xhc3MoKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBtZXRhc3RvcmUgPSBNZXRhc3RvcmVGYWN0\nb3J5LmNyZWF0ZU1ldGFTdG9yZShtc05hbWUpOwoKICAgICAgICAgICAgLy8g\nVE9ETzogc2hvdWxkIHJlY29yZCB2ZXJzaW9uIGluIHNvbWV3aGVyZS4gZS5n\nLiBab29LZWVwZXIKICAgICAgICAgICAgaW50IG1zVmVyc2lvbiA9IG1ldGFz\ndG9yZS5nZXRWZXJzaW9uKCk7CiAgICAgICAgICAgIG1ldGFzdG9yZS5pbml0\nKGNvbmYsIG1zVmVyc2lvbik7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxl\nIHQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJGYWls\nZWQgdG8gaW5pdGlhbGl6ZSBtZXRhc3RvcmUgIiArIG1zTmFtZSArICIgOiAi\nLCB0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdW5pbml0aWFsaXplKCkg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBtZXRhc3RvcmUuY2xvc2Uo\nKTsKICAgIH0KCiAgICBzdGF0aWMgTG9uZyBrZXkyTGVkZ2VySWQoU3RyaW5n\nIGtleSkgewogICAgICAgIHJldHVybiBudWxsID09IGtleSA/IG51bGwgOiBM\nb25nLnBhcnNlTG9uZyhrZXksIDEwKTsKICAgIH0KCiAgICBzdGF0aWMgU3Ry\naW5nIGxlZGdlcklkMktleShMb25nIGxpZCkgewogICAgICAgIHJldHVybiBu\ndWxsID09IGxpZCA/IG51bGwgOiBTdHJpbmdVdGlscy5nZXRaS1N0cmluZ0lk\nKGxpZCk7CiAgICB9CgogICAgc3RhdGljIFN0cmluZyByYW5nZVRvU3RyaW5n\nKExvbmcgZmlyc3RMZWRnZXIsIGJvb2xlYW4gZmlyc3RJbmNsdXNpdmUsIExv\nbmcgbGFzdExlZGdlciwgYm9vbGVhbiBsYXN0SW5jbHVzaXZlKSB7CiAgICAg\nICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAg\nICAgICAgc2IuYXBwZW5kKGZpcnN0SW5jbHVzaXZlID8gIlsgIiA6ICIoICIp\nLmFwcGVuZChmaXJzdExlZGdlcikuYXBwZW5kKCIgfiAiKS5hcHBlbmQobGFz\ndExlZGdlcikKICAgICAgICAgICAgICAgIC5hcHBlbmQobGFzdEluY2x1c2l2\nZSA/ICIgXSIgOiAiICkiKTsKICAgICAgICByZXR1cm4gc2IudG9TdHJpbmco\nKTsKICAgIH0KCiAgICBzdGF0aWMgU29ydGVkU2V0PExvbmc+IGVudHJpZXMy\nTGVkZ2VycyhJdGVyYXRvcjxNZXRhc3RvcmVUYWJsZUl0ZW0+IGVudHJpZXMp\nIHsKICAgICAgICBTb3J0ZWRTZXQ8TG9uZz4gbGVkZ2VycyA9IG5ldyBUcmVl\nU2V0PExvbmc+KCk7CiAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFzTmV4dCgp\nKSB7CiAgICAgICAgICAgIE1ldGFzdG9yZVRhYmxlSXRlbSBpdGVtID0gZW50\ncmllcy5uZXh0KCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBsZWRnZXJzLmFkZChrZXkyTGVkZ2VySWQoaXRlbS5nZXRLZXkoKSkpOwog\nICAgICAgICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gbmZl\nKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRm91bmQgaW52YWxpZCBs\nZWRnZXIga2V5IHt9IiwgaXRlbS5nZXRLZXkoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxlZGdlcnM7CiAgICB9CgogICAg\nc3RhdGljIGNsYXNzIFN5bmNSZXN1bHQ8VD4gewogICAgICAgIFQgdmFsdWU7\nCiAgICAgICAgaW50IHJjOwogICAgICAgIGJvb2xlYW4gZmluaXNoZWQgPSBm\nYWxzZTsKCiAgICAgICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIGNvbXBs\nZXRlKGludCByYywgVCB2YWx1ZSkgewogICAgICAgICAgICB0aGlzLnJjID0g\ncmM7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICAg\nICAgZmluaXNoZWQgPSB0cnVlOwoKICAgICAgICAgICAgbm90aWZ5KCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgYmxv\nY2soKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB3aGls\nZSAoIWZpbmlzaGVkKSB7CiAgICAgICAgICAgICAgICAgICAgd2FpdCgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIGludCBnZXRSZXRDb2RlKCkg\newogICAgICAgICAgICByZXR1cm4gcmM7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgc3luY2hyb25pemVkIFQgZ2V0UmVzdWx0KCkgewogICAgICAgICAg\nICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBj\nbGFzcyBNc0xlZGdlck1hbmFnZXIgaW1wbGVtZW50cyBMZWRnZXJNYW5hZ2Vy\nLCBNZXRhc3RvcmVXYXRjaGVyIHsKICAgICAgICBmaW5hbCBab29LZWVwZXIg\nems7CiAgICAgICAgZmluYWwgQWJzdHJhY3RDb25maWd1cmF0aW9uIGNvbmY7\nCgogICAgICAgIGZpbmFsIE1ldGFTdG9yZSBtZXRhc3RvcmU7CiAgICAgICAg\nZmluYWwgTWV0YXN0b3JlU2Nhbm5hYmxlVGFibGUgbGVkZ2VyVGFibGU7CiAg\nICAgICAgZmluYWwgaW50IG1heEVudHJpZXNQZXJTY2FuOwoKICAgICAgICBz\ndGF0aWMgZmluYWwgU3RyaW5nIElER0VOX1pOT0RFID0gIm1zLWlkZ2VuIjsK\nICAgICAgICBzdGF0aWMgZmluYWwgU3RyaW5nIElER0VORVJBVElPTl9QUkVG\nSVggPSAiLyIgKyBJREdFTl9aTk9ERSArICIvSUQtIjsKCiAgICAgICAgLy8g\nbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVycwogICAgICAgIHByb3RlY3RlZCBm\naW5hbCBDb25jdXJyZW50TWFwPExvbmcsIFNldDxMZWRnZXJNZXRhZGF0YUxp\nc3RlbmVyPj4gbGlzdGVuZXJzID0KICAgICAgICAgICAgICAgIG5ldyBDb25j\ndXJyZW50SGFzaE1hcDxMb25nLCBTZXQ8TGVkZ2VyTWV0YWRhdGFMaXN0ZW5l\ncj4+KCk7CgogICAgICAgIC8vIFBhdGggdG8gZ2VuZXJhdGUgZ2xvYmFsIGlk\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgaWRHZW5QYXRoOwoKICAg\nICAgICAvLyB3ZSB1c2UgdGhpcyB0byBwcmV2ZW50IGxvbmcgc3RhY2sgY2hh\naW5zIGZyb20gYnVpbGRpbmcgdXAgaW4KICAgICAgICAvLyBjYWxsYmFja3MK\nICAgICAgICBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1bGVyOwoK\nICAgICAgICBwcm90ZWN0ZWQgY2xhc3MgUmVhZExlZGdlck1ldGFkYXRhVGFz\nayBpbXBsZW1lbnRzIFJ1bm5hYmxlLCBHZW5lcmljQ2FsbGJhY2s8TGVkZ2Vy\nTWV0YWRhdGE+IHsKCiAgICAgICAgICAgIGZpbmFsIGxvbmcgbGVkZ2VySWQ7\nCgogICAgICAgICAgICBSZWFkTGVkZ2VyTWV0YWRhdGFUYXNrKGxvbmcgbGVk\nZ2VySWQpIHsKICAgICAgICAgICAgICAgIHRoaXMubGVkZ2VySWQgPSBsZWRn\nZXJJZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAg\nIGlmIChudWxsICE9IGxpc3RlbmVycy5nZXQobGVkZ2VySWQpKSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJSZS1yZWFkIGxlZGdlciBtZXRh\nZGF0YSBmb3Ige30uIiwgbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAg\nIHJlYWRMZWRnZXJNZXRhZGF0YShsZWRnZXJJZCwgUmVhZExlZGdlck1ldGFk\nYXRhVGFzay50aGlzKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJMZWRnZXIgbWV0YWRhdGEgbGlz\ndGVuZXIgZm9yIGxlZGdlciB7fSBpcyBhbHJlYWR5IHJlbW92ZWQuIiwgbGVk\nZ2VySWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uQ29tcGxldGUoaW50IHJjLCBmaW5hbCBMZWRnZXJNZXRhZGF0YSBy\nZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChCS0V4Y2VwdGlvbi5Db2Rl\nLk9LID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgU2V0PExl\nZGdlck1ldGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0ID0gbGlzdGVuZXJz\nLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwg\nIT0gbGlzdGVuZXJTZXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmRlYnVnKCJMZWRnZXIgbWV0YWRhdGEgaXMgY2hhbmdlZCBmb3Ige30gOiB7\nfS4iLCBsZWRnZXJJZCwgcmVzdWx0KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgc2NoZWR1bGVyLnN1Ym1pdChuZXcgUnVubmFibGUoKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQobGlzdGVuZXJTZXQp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChM\nZWRnZXJNZXRhZGF0YUxpc3RlbmVyIGxpc3RlbmVyIDogbGlzdGVuZXJTZXQp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxp\nc3RlbmVyLm9uQ2hhbmdlZChsZWRnZXJJZCwgcmVzdWx0KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChCS0V4Y2VwdGlv\nbi5Db2RlLk5vU3VjaExlZGdlckV4aXN0c0V4Y2VwdGlvbiA9PSByYykgewog\nICAgICAgICAgICAgICAgICAgIC8vIHRoZSBsZWRnZXIgaXMgcmVtb3ZlZCwg\nZG8gbm90aGluZwogICAgICAgICAgICAgICAgICAgIFNldDxMZWRnZXJNZXRh\nZGF0YUxpc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxpc3RlbmVycy5yZW1vdmUo\nbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGxp\nc3RlbmVyU2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiUmVtb3ZlZCBsZWRnZXIgbWV0YWRhdGEgbGlzdGVuZXIgc2V0IG9uIGxl\nZGdlciB7fSBhcyBpdHMgbGVkZ2VyIGlzIGRlbGV0ZWQgOiB7fSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQsIGxpc3RlbmVy\nU2V0LnNpemUoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBMT0cud2Fybigi\nRmFpbGVkIG9uIHJlYWQgbGVkZ2VyIG1ldGFkYXRhIG9mIGxlZGdlciB7fSA6\nIHt9IiwgbGVkZ2VySWQsIHJjKTsKICAgICAgICAgICAgICAgICAgICBzY2hl\nZHVsZXIuc2NoZWR1bGUodGhpcywgTVNfQ09OTkVDVF9CQUNLT0ZGX01TLCBU\naW1lVW5pdC5NSUxMSVNFQ09ORFMpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBNc0xlZGdlck1hbmFnZXIo\nZmluYWwgQWJzdHJhY3RDb25maWd1cmF0aW9uIGNvbmYsIGZpbmFsIFpvb0tl\nZXBlciB6aywgZmluYWwgTWV0YVN0b3JlIG1ldGFzdG9yZSkgewogICAgICAg\nICAgICB0aGlzLmNvbmYgPSBjb25mOwogICAgICAgICAgICB0aGlzLnprID0g\nems7CiAgICAgICAgICAgIHRoaXMubWV0YXN0b3JlID0gbWV0YXN0b3JlOwoK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxlZGdlclRhYmxl\nID0gbWV0YXN0b3JlLmNyZWF0ZVNjYW5uYWJsZVRhYmxlKFRBQkxFX05BTUUp\nOwogICAgICAgICAgICB9IGNhdGNoIChNZXRhc3RvcmVFeGNlcHRpb24gbXNl\nKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkZhaWxlZCB0byBpbnN0\nYW50aWF0ZSB0YWJsZSAiICsgVEFCTEVfTkFNRSArICIgaW4gbWV0YXN0b3Jl\nICIgKyBtZXRhc3RvcmUuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJGYWlsZWQgdG8gaW5zdGFudGlh\ndGUgdGFibGUgIiArIFRBQkxFX05BTUUgKyAiIGluIG1ldGFzdG9yZSAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICsgbWV0YXN0b3JlLmdldE5hbWUoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gY29uZmlndXJhdGlvbiBz\nZXR0aW5ncwogICAgICAgICAgICBtYXhFbnRyaWVzUGVyU2NhbiA9IGNvbmYu\nZ2V0TWV0YXN0b3JlTWF4RW50cmllc1BlclNjYW4oKTsKCiAgICAgICAgICAg\nIHRoaXMuaWRHZW5QYXRoID0gY29uZi5nZXRaa0xlZGdlcnNSb290UGF0aCgp\nICsgSURHRU5FUkFUSU9OX1BSRUZJWDsKICAgICAgICAgICAgVGhyZWFkRmFj\ndG9yeUJ1aWxkZXIgdGZiID0gbmV3IFRocmVhZEZhY3RvcnlCdWlsZGVyKCkK\nICAgICAgICAgICAgICAgICAgICAuc2V0TmFtZUZvcm1hdCgiTVNMZWRnZXJN\nYW5hZ2VyU2NoZWR1bGVyLSVkIik7CiAgICAgICAgICAgIHRoaXMuc2NoZWR1\nbGVyID0gRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZFNjaGVkdWxlZEV4ZWN1\ndG9yKHRmYgogICAgICAgICAgICAgICAgICAgIC5idWlsZCgpKTsKICAgICAg\nICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHBy\nb2Nlc3MoTVNXYXRjaGVkRXZlbnQgZSl7CiAgICAgICAgICAgIGxvbmcgbGVk\nZ2VySWQgPSBrZXkyTGVkZ2VySWQoZS5nZXRLZXkoKSk7CiAgICAgICAgICAg\nIHN3aXRjaChlLmdldFR5cGUoKSkgewogICAgICAgICAgICBjYXNlIENIQU5H\nRUQ6CiAgICAgICAgICAgICAgICBuZXcgUmVhZExlZGdlck1ldGFkYXRhVGFz\nayhrZXkyTGVkZ2VySWQoZS5nZXRLZXkoKSkpLnJ1bigpOwoKICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFJFTU9WRUQ6CiAgICAg\nICAgICAgICAgICBTZXQ8TGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcj4gbGlzdGVu\nZXJTZXQgPSBsaXN0ZW5lcnMuZ2V0KGxlZGdlcklkKTsKICAgICAgICAgICAg\nICAgIGlmIChsaXN0ZW5lclNldCAhPSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgc3luY2hyb25pemVkIChsaXN0ZW5lclNldCkgewogICAgICAgICAg\nICAgICAgICAgICAgICBmb3IoTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lciBsIDog\nbGlzdGVuZXJTZXQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5y\nZWdpc3RlckxlZGdlck1ldGFkYXRhTGlzdGVuZXIobGVkZ2VySWQsIGwpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbC5vbkNoYW5nZWQoIGxlZGdl\ncklkLCBudWxsICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAg\nICAgICBMT0cud2FybigiVW5rbm93biB0eXBlOiB7fSIsIGUuZ2V0VHlwZSgp\nKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBy\nZWdpc3RlckxlZGdlck1ldGFkYXRhTGlzdGVuZXIobG9uZyBsZWRnZXJJZCwg\nTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgICAg\nICBpZiAobnVsbCAhPSBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgTE9H\nLmluZm8oIlJlZ2lzdGVyZWQgbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVyIHt9\nIG9uIGxlZGdlciB7fS4iLCBsaXN0ZW5lciwgbGVkZ2VySWQpOwogICAgICAg\nICAgICAgICAgU2V0PExlZGdlck1ldGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVy\nU2V0ID0gbGlzdGVuZXJzLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgICAg\nICBpZiAobGlzdGVuZXJTZXQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nICAgIFNldDxMZWRnZXJNZXRhZGF0YUxpc3RlbmVyPiBuZXdMaXN0ZW5lclNl\ndCA9IG5ldyBIYXNoU2V0PExlZGdlck1ldGFkYXRhTGlzdGVuZXI+KCk7CiAg\nICAgICAgICAgICAgICAgICAgU2V0PExlZGdlck1ldGFkYXRhTGlzdGVuZXI+\nIG9sZExpc3RlbmVyU2V0ID0gbGlzdGVuZXJzLnB1dElmQWJzZW50KGxlZGdl\ncklkLCBuZXdMaXN0ZW5lclNldCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG51bGwgIT0gb2xkTGlzdGVuZXJTZXQpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgbGlzdGVuZXJTZXQgPSBvbGRMaXN0ZW5lclNldDsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBs\naXN0ZW5lclNldCA9IG5ld0xpc3RlbmVyU2V0OwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN5bmNo\ncm9uaXplZCAobGlzdGVuZXJTZXQpIHsKICAgICAgICAgICAgICAgICAgICBs\naXN0ZW5lclNldC5hZGQobGlzdGVuZXIpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgbmV3IFJlYWRMZWRnZXJNZXRhZGF0YVRhc2sobGVk\nZ2VySWQpLnJ1bigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCB1bnJlZ2lzdGVyTGVk\nZ2VyTWV0YWRhdGFMaXN0ZW5lcihsb25nIGxlZGdlcklkLCBMZWRnZXJNZXRh\nZGF0YUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgICAgIFNldDxMZWRn\nZXJNZXRhZGF0YUxpc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxpc3RlbmVycy5n\nZXQobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAobGlzdGVuZXJTZXQgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChsaXN0ZW5l\nclNldCkgewogICAgICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lclNldC5y\nZW1vdmUobGlzdGVuZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5pbmZvKCJVbnJlZ2lzdGVyZWQgbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVy\nIHt9IG9uIGxlZGdlciB7fS4iLCBsaXN0ZW5lciwgbGVkZ2VySWQpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobGlz\ndGVuZXJTZXQuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGxpc3RlbmVycy5yZW1vdmUobGVkZ2VySWQsIGxpc3RlbmVyU2V0KTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgc2NoZWR1bGVyLnNodXRkb3duKCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cud2Fy\nbigiRXJyb3Igd2hlbiBjbG9zaW5nIE1zTGVkZ2VyTWFuYWdlciA6ICIsIGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlZGdlclRhYmxlLmNsb3Nl\nKCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBjcmVhdGVMZWRnZXIoZmluYWwgTGVkZ2VyTWV0YWRhdGEgbWV0\nYWRhdGEsIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxMb25nPiBsZWRnZXJDYikg\newogICAgICAgICAgICBaa1V0aWxzLmFzeW5jQ3JlYXRlRnVsbFBhdGhPcHRp\nbWlzdGljKHprLCBpZEdlblBhdGgsIG5ldyBieXRlWzBdLCBJZHMuT1BFTl9B\nQ0xfVU5TQUZFLAogICAgICAgICAgICAgICAgICAgIENyZWF0ZU1vZGUuRVBI\nRU1FUkFMX1NFUVVFTlRJQUwsIG5ldyBTdHJpbmdDYWxsYmFjaygpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBT\ndHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgZmluYWwgU3RyaW5nIGlkUGF0aE5h\nbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBL\nZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3Qg\nZ2VuZXJhdGUgbmV3IGxlZGdlciBpZCIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24uY3JlYXRlKEtl\nZXBlckV4Y2VwdGlvbi5Db2RlLmdldChyYyksIHBhdGgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJDYi5vcGVyYXRpb25Db21w\nbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLlpLRXhjZXB0aW9uLCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICogRXh0cmFj\ndCBsZWRnZXIgaWQgZnJvbSBnZW4gcGF0aAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICovCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb25n\nIGxlZGdlcklkOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZCA9IGdl\ndExlZGdlcklkRnJvbUdlblBhdGgoaWRQYXRoTmFtZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJDb3Vs\nZCBub3QgZXh0cmFjdCBsZWRnZXItaWQgZnJvbSBpZCBnZW4gcGF0aDoiICsg\ncGF0aCwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VyQ2Iub3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5aS0V4\nY2VwdGlvbiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIGxvbmcgbGlkID0gbGVk\nZ2VySWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBNZXRhc3RvcmVD\nYWxsYmFjazxWZXJzaW9uPiBtc0NhbGxiYWNrID0gbmV3IE1ldGFzdG9yZUNh\nbGxiYWNrPFZlcnNpb24+KCkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIGNvbXBsZXRlKGludCByYywgVmVyc2lvbiB2ZXJz\naW9uLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChNU0V4Y2VwdGlvbi5Db2RlLkJhZFZlcnNpb24uZ2V0\nQ29kZSgpID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsZWRnZXJDYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2Vw\ndGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4Y2VwdGlvbiwgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKE1TRXhjZXB0aW9u\nLkNvZGUuT0suZ2V0Q29kZSgpICE9IHJjKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJDYi5vcGVyYXRpb25Db21w\nbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk1ldGFTdG9yZUV4Y2VwdGlvbiwgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVn\nKCJDcmVhdGUgbGVkZ2VyIHt9IHdpdGggdmVyc2lvbiB7fSBzdWNjZXNzZnVs\neS4iLCBuZXcgT2JqZWN0W10geyBsaWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiB9KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHZlcnNpb24K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEu\nc2V0VmVyc2lvbih2ZXJzaW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbGVkZ2VyQ2Iub3BlcmF0aW9uQ29tcGxldGUoQktFeGNl\ncHRpb24uQ29kZS5PSywgbGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwoKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlclRhYmxlLnB1dChsZWRn\nZXJJZDJLZXkobGlkKSwgbmV3IFZhbHVlKCkuc2V0RmllbGQoTUVUQV9GSUVM\nRCwgbWV0YWRhdGEuc2VyaWFsaXplKCkpLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBWZXJzaW9uLk5FVywgbXNDYWxsYmFjaywgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6ay5kZWxldGUoaWRQ\nYXRoTmFtZSwgLTEsIG5ldyBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjaygp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBw\ncm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJj\nICE9IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk9LLmludFZhbHVlKCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJu\nKCJFeGNlcHRpb24gZHVyaW5nIGRlbGV0aW5nIHpub2RlIGZvciBpZCBnZW5l\ncmF0aW9uIDogIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJF\neGNlcHRpb24uQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkRlbGV0aW5n\nIHpub2RlIGZvciBpZCBnZW5lcmF0aW9uIDoge30iLCBpZFBhdGhOYW1lKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBnZXQgbGVkZ2VyIGlkIGZyb20gZ2VuZXJhdGlvbiBwYXRoCiAg\nICAgICAgcHJpdmF0ZSBsb25nIGdldExlZGdlcklkRnJvbUdlblBhdGgoU3Ry\naW5nIG5vZGVOYW1lKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAg\nICBsb25nIGxlZGdlcklkOwogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgU3RyaW5nIHBhcnRzW10gPSBub2RlTmFtZS5zcGxpdChJREdFTkVS\nQVRJT05fUFJFRklYKTsKICAgICAgICAgICAgICAgIGxlZGdlcklkID0gTG9u\nZy5wYXJzZUxvbmcocGFydHNbcGFydHMubGVuZ3RoIC0gMV0pOwogICAgICAg\nICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKGUpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHJldHVybiBsZWRnZXJJZDsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJlbW92\nZUxlZGdlck1ldGFkYXRhKGZpbmFsIGxvbmcgbGVkZ2VySWQsIGZpbmFsIFZl\ncnNpb24gdmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmaW5hbCBHZW5lcmljQ2FsbGJhY2s8Vm9pZD4gY2IpIHsK\nICAgICAgICAgICAgTWV0YXN0b3JlQ2FsbGJhY2s8Vm9pZD4gbXNDYWxsYmFj\nayA9IG5ldyBNZXRhc3RvcmVDYWxsYmFjazxWb2lkPigpIHsKICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\nY29tcGxldGUoaW50IHJjLCBWb2lkIHZhbHVlLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgICAgICAgICAgICAgaW50IGJrUmM7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKE1TRXhjZXB0aW9uLkNvZGUuTm9LZXkuZ2V0Q29kZSgpID09IHJj\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJMZWRnZXIg\nZW50cnkgZG9lcyBub3QgZXhpc3QgaW4gbWV0YSB0YWJsZTogbGVkZ2VySWQ9\ne30iLCBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJrUmMg\nPSBCS0V4Y2VwdGlvbi5Db2RlLk5vU3VjaExlZGdlckV4aXN0c0V4Y2VwdGlv\nbjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKE1TRXhjZXB0aW9u\nLkNvZGUuT0suZ2V0Q29kZSgpID09IHJjKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGJrUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJr\nUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk1ldGFTdG9yZUV4Y2VwdGlvbjsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY2Iub3Bl\ncmF0aW9uQ29tcGxldGUoYmtSYywgKFZvaWQpIG51bGwpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBsZWRnZXJUYWJs\nZS5yZW1vdmUobGVkZ2VySWQyS2V5KGxlZGdlcklkKSwgdmVyc2lvbiwgbXND\nYWxsYmFjaywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwdWJsaWMgdm9pZCByZWFkTGVkZ2VyTWV0YWRhdGEoZmluYWwg\nbG9uZyBsZWRnZXJJZCwgZmluYWwgR2VuZXJpY0NhbGxiYWNrPExlZGdlck1l\ndGFkYXRhPiByZWFkQ2IpIHsKICAgICAgICAgICAgZmluYWwgU3RyaW5nIGtl\neSA9IGxlZGdlcklkMktleShsZWRnZXJJZCk7CiAgICAgICAgICAgIE1ldGFz\ndG9yZUNhbGxiYWNrPFZlcnNpb25lZDxWYWx1ZT4+IG1zQ2FsbGJhY2sgPSBu\nZXcgTWV0YXN0b3JlQ2FsbGJhY2s8VmVyc2lvbmVkPFZhbHVlPj4oKSB7CiAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGNvbXBsZXRlKGludCByYywgVmVyc2lvbmVkPFZhbHVlPiB2YWx1\nZSwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAgIGlmIChNU0V4\nY2VwdGlvbi5Db2RlLk5vS2V5LmdldENvZGUoKSA9PSByYykgewogICAgICAg\nICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIk5vIGxlZGdlciBtZXRhZGF0\nYSBmb3VuZCBmb3IgbGVkZ2VyICIgKyBsZWRnZXJJZCArICIgOiAiLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1TRXhjZXB0aW9uLmNyZWF0\nZShNU0V4Y2VwdGlvbi5Db2RlLmdldChyYyksICJObyBrZXkgIiArIGtleSAr\nICIgZm91bmQuIikpOwogICAgICAgICAgICAgICAgICAgICAgICByZWFkQ2Iu\nb3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hMZWRn\nZXJFeGlzdHNFeGNlcHRpb24sIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIGlmIChNU0V4Y2VwdGlvbi5Db2RlLk9LLmdldENvZGUoKSAh\nPSByYykgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNv\ndWxkIG5vdCByZWFkIG1ldGFkYXRhIGZvciBsZWRnZXIgIiArIGxlZGdlcklk\nICsgIiA6ICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTVNF\neGNlcHRpb24uY3JlYXRlKE1TRXhjZXB0aW9uLkNvZGUuZ2V0KHJjKSwgIkZh\naWxlZCB0byBnZXQga2V5ICIgKyBrZXkpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgcmVhZENiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNv\nZGUuTWV0YVN0b3JlRXhjZXB0aW9uLCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YTsKICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBt\nZXRhZGF0YSA9IExlZGdlck1ldGFkYXRhCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLnBhcnNlQ29uZmlnKHZhbHVlLmdldFZhbHVlKCkuZ2V0\nRmllbGQoTUVUQV9GSUVMRCksIHZhbHVlLmdldFZlcnNpb24oKSk7CiAgICAg\nICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCBwYXJz\nZSBsZWRnZXIgbWV0YWRhdGEgZm9yIGxlZGdlciAiICsgbGVkZ2VySWQgKyAi\nIDogIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRDYi5vcGVy\nYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk1ldGFTdG9yZUV4Y2Vw\ndGlvbiwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmVh\nZENiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuT0ssIG1l\ndGFkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAg\nICAgICAgICAgbGVkZ2VyVGFibGUuZ2V0KGtleSwgdGhpcywgbXNDYWxsYmFj\naywgQUxMX0ZJRUxEUyk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwdWJsaWMgdm9pZCB3cml0ZUxlZGdlck1ldGFkYXRhKGZpbmFs\nIGxvbmcgbGVkZ2VySWQsIGZpbmFsIExlZGdlck1ldGFkYXRhIG1ldGFkYXRh\nLAogICAgICAgICAgICAgICAgZmluYWwgR2VuZXJpY0NhbGxiYWNrPFZvaWQ+\nIGNiKSB7CiAgICAgICAgICAgIFZhbHVlIGRhdGEgPSBuZXcgVmFsdWUoKS5z\nZXRGaWVsZChNRVRBX0ZJRUxELCBtZXRhZGF0YS5zZXJpYWxpemUoKSk7Cgog\nICAgICAgICAgICBMT0cuZGVidWcoIldyaXRpbmcgbGVkZ2VyIHt9IG1ldGFk\nYXRhLCB2ZXJzaW9uIHt9IiwgbmV3IE9iamVjdFtdIHsgbGVkZ2VySWQsIG1l\ndGFkYXRhLmdldFZlcnNpb24oKSB9KTsKCiAgICAgICAgICAgIGZpbmFsIFN0\ncmluZyBrZXkgPSBsZWRnZXJJZDJLZXkobGVkZ2VySWQpOwogICAgICAgICAg\nICBNZXRhc3RvcmVDYWxsYmFjazxWZXJzaW9uPiBtc0NhbGxiYWNrID0gbmV3\nIE1ldGFzdG9yZUNhbGxiYWNrPFZlcnNpb24+KCkgewogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBjb21w\nbGV0ZShpbnQgcmMsIFZlcnNpb24gdmVyc2lvbiwgT2JqZWN0IGN0eCkgewog\nICAgICAgICAgICAgICAgICAgIGludCBia1JjOwogICAgICAgICAgICAgICAg\nICAgIGlmIChNU0V4Y2VwdGlvbi5Db2RlLkJhZFZlcnNpb24uZ2V0Q29kZSgp\nID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJC\nYWQgdmVyc2lvbiBwcm92aWRlZCB0byB1cGRhdCBtZXRhZGF0YSBmb3IgbGVk\nZ2VyIHt9IiwgbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAgICAgICBi\na1JjID0gQktFeGNlcHRpb24uQ29kZS5NZXRhZGF0YVZlcnNpb25FeGNlcHRp\nb247CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChNU0V4Y2VwdGlv\nbi5Db2RlLk5vS2V5LmdldENvZGUoKSA9PSByYykgewogICAgICAgICAgICAg\nICAgICAgICAgICBMT0cud2FybigiTGVkZ2VyIHt9IGRvZXNuJ3QgZXhpc3Qg\nd2hlbiB3cml0aW5nIGl0cyBsZWRnZXIgbWV0YWRhdGEuIiwgbGVkZ2VySWQp\nOwogICAgICAgICAgICAgICAgICAgICAgICBia1JjID0gQktFeGNlcHRpb24u\nQ29kZS5Ob1N1Y2hMZWRnZXJFeGlzdHNFeGNlcHRpb247CiAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIGlmIChNU0V4Y2VwdGlvbi5Db2RlLk9LLmdldENv\nZGUoKSA9PSByYykgewogICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0\nYS5zZXRWZXJzaW9uKHZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICAg\nICBia1JjID0gQktFeGNlcHRpb24uQ29kZS5PSzsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cud2Fy\nbigiQ29uZGl0aW9uYWwgdXBkYXRlIGxlZGdlciBtZXRhZGF0YSBmYWlsZWQ6\nICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTVNFeGNlcHRp\nb24uY3JlYXRlKE1TRXhjZXB0aW9uLkNvZGUuZ2V0KHJjKSwgIkZhaWxlZCB0\nbyBwdXQga2V5ICIgKyBrZXkpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nYmtSYyA9IEJLRXhjZXB0aW9uLkNvZGUuTWV0YVN0b3JlRXhjZXB0aW9uOwog\nICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uQ29tcGxldGUoYmtSYywgbnVsbCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxlZGdlclRhYmxlLnB1\ndChrZXksIGRhdGEsIG1ldGFkYXRhLmdldFZlcnNpb24oKSwgbXNDYWxsYmFj\naywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgdm9pZCBhc3luY1Byb2Nlc3NMZWRnZXJzKGZpbmFsIFByb2Nl\nc3NvcjxMb25nPiBwcm9jZXNzb3IsIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9p\nZENhbGxiYWNrIGZpbmFsQ2IsCiAgICAgICAgICAgICAgICBmaW5hbCBPYmpl\nY3QgY29udGV4dCwgZmluYWwgaW50IHN1Y2Nlc3NSYywgZmluYWwgaW50IGZh\naWx1cmVSYykgewogICAgICAgICAgICBNZXRhc3RvcmVDYWxsYmFjazxNZXRh\nc3RvcmVDdXJzb3I+IG9wZW5DdXJzb3JDYiA9IG5ldyBNZXRhc3RvcmVDYWxs\nYmFjazxNZXRhc3RvcmVDdXJzb3I+KCkgewogICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBjb21wbGV0ZShp\nbnQgcmMsIE1ldGFzdG9yZUN1cnNvciBjdXJzb3IsIE9iamVjdCBjdHgpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoTVNFeGNlcHRpb24uQ29kZS5PSy5n\nZXRDb2RlKCkgIT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlu\nYWxDYi5wcm9jZXNzUmVzdWx0KGZhaWx1cmVSYywgbnVsbCwgY29udGV4dCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFjdXJzb3IuaGFz\nTW9yZUVudHJpZXMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaW5h\nbENiLnByb2Nlc3NSZXN1bHQoc3VjY2Vzc1JjLCBudWxsLCBjb250ZXh0KTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhc3luY1Byb2Nlc3NMZWRn\nZXJzKGN1cnNvciwgcHJvY2Vzc29yLCBmaW5hbENiLCBjb250ZXh0LCBzdWNj\nZXNzUmMsIGZhaWx1cmVSYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH07CiAgICAgICAgICAgIGxlZGdlclRhYmxlLm9wZW5DdXJzb3IoTk9O\nX0ZJRUxEUywgb3BlbkN1cnNvckNiLCBudWxsKTsKICAgICAgICB9CgogICAg\nICAgIHZvaWQgYXN5bmNQcm9jZXNzTGVkZ2VycyhmaW5hbCBNZXRhc3RvcmVD\ndXJzb3IgY3Vyc29yLCBmaW5hbCBQcm9jZXNzb3I8TG9uZz4gcHJvY2Vzc29y\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBBc3lu\nY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBmaW5hbENiLCBmaW5hbCBPYmplY3Qg\nY29udGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlu\nYWwgaW50IHN1Y2Nlc3NSYywgZmluYWwgaW50IGZhaWx1cmVSYykgewogICAg\nICAgICAgICBzY2hlZHVsZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIGRvQXN5bmNQcm9j\nZXNzTGVkZ2VycyhjdXJzb3IsIHByb2Nlc3NvciwgZmluYWxDYiwgY29udGV4\ndCwgc3VjY2Vzc1JjLCBmYWlsdXJlUmMpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIHZvaWQgZG9Bc3lu\nY1Byb2Nlc3NMZWRnZXJzKGZpbmFsIE1ldGFzdG9yZUN1cnNvciBjdXJzb3Is\nIGZpbmFsIFByb2Nlc3NvcjxMb25nPiBwcm9jZXNzb3IsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgQXN5bmNDYWxsYmFjay5W\nb2lkQ2FsbGJhY2sgZmluYWxDYiwgZmluYWwgT2JqZWN0IGNvbnRleHQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50IHN1\nY2Nlc3NSYywgZmluYWwgaW50IGZhaWx1cmVSYykgewogICAgICAgICAgICAv\nLyBubyBlbnRyaWVzIG5vdwogICAgICAgICAgICBpZiAoIWN1cnNvci5oYXNN\nb3JlRW50cmllcygpKSB7CiAgICAgICAgICAgICAgICBmaW5hbENiLnByb2Nl\nc3NSZXN1bHQoc3VjY2Vzc1JjLCBudWxsLCBjb250ZXh0KTsKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBSZWFk\nRW50cmllc0NhbGxiYWNrIG1zQ2FsbGJhY2sgPSBuZXcgUmVhZEVudHJpZXND\nYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgY29tcGxldGUoaW50IHJjLCBJdGVyYXRv\ncjxNZXRhc3RvcmVUYWJsZUl0ZW0+IGVudHJpZXMsIE9iamVjdCBjdHgpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoTVNFeGNlcHRpb24uQ29kZS5PSy5n\nZXRDb2RlKCkgIT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlu\nYWxDYi5wcm9jZXNzUmVzdWx0KGZhaWx1cmVSYywgbnVsbCwgY29udGV4dCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIFNvcnRlZFNldDxMb25n\nPiBsZWRnZXJzID0gbmV3IFRyZWVTZXQ8TG9uZz4oKTsKICAgICAgICAgICAg\nICAgICAgICB3aGlsZSAoZW50cmllcy5oYXNOZXh0KCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgTWV0YXN0b3JlVGFibGVJdGVtIGl0ZW0gPSBlbnRy\naWVzLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcnMuYWRkKGtleTJMZWRn\nZXJJZChpdGVtLmdldEtleSgpKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBuZmUpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJGb3VuZCBpbnZhbGlk\nIGxlZGdlciBrZXkge30iLCBpdGVtLmdldEtleSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAgICAgaWYgKDAgPT0gbGVkZ2Vycy5zaXplKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gcHJvY2VzcyBuZXh0IGJhdGNoIG9mIGxl\nZGdlcnMKICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmNQcm9jZXNzTGVk\nZ2VycyhjdXJzb3IsIHByb2Nlc3NvciwgZmluYWxDYiwgY29udGV4dCwgc3Vj\nY2Vzc1JjLCBmYWlsdXJlUmMpOwogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nICAgICBmaW5hbCBsb25nIHN0YXJ0TGVkZ2VyID0gbGVkZ2Vycy5maXJzdCgp\nOwogICAgICAgICAgICAgICAgICAgIGZpbmFsIGxvbmcgZW5kTGVkZ2VyID0g\nbGVkZ2Vycy5sYXN0KCk7CgogICAgICAgICAgICAgICAgICAgIEFzeW5jU2V0\nUHJvY2Vzc29yPExvbmc+IHNldFByb2Nlc3NvciA9IG5ldyBBc3luY1NldFBy\nb2Nlc3NvcjxMb25nPihzY2hlZHVsZXIpOwogICAgICAgICAgICAgICAgICAg\nIC8vIHByb2Nlc3Mgc2V0CiAgICAgICAgICAgICAgICAgICAgc2V0UHJvY2Vz\nc29yLnByb2Nlc3MobGVkZ2VycywgcHJvY2Vzc29yLCBuZXcgQXN5bmNDYWxs\nYmFjay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBj\ndHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWNjZXNz\nUmMgIT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkZhaWxlZCB3aGVuIHByb2Nlc3NpbmcgcmFuZ2UgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyByYW5nZVRv\nU3RyaW5nKHN0YXJ0TGVkZ2VyLCB0cnVlLCBlbmRMZWRnZXIsIHRydWUpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbENiLnByb2Nl\nc3NSZXN1bHQoZmFpbHVyZVJjLCBudWxsLCBjb250ZXh0KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAv\nLyBwcm9jZXNzIG5leHQgYmF0Y2ggb2YgbGVkZ2VycwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgYXN5bmNQcm9jZXNzTGVkZ2VycyhjdXJzb3IsIHBy\nb2Nlc3NvciwgZmluYWxDYiwgY29udGV4dCwgc3VjY2Vzc1JjLCBmYWlsdXJl\nUmMpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfSwgY29udGV4dCwgc3VjY2Vzc1JjLCBmYWlsdXJlUmMpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBjdXJz\nb3IuYXN5bmNSZWFkRW50cmllcyhtYXhFbnRyaWVzUGVyU2NhbiwgbXNDYWxs\nYmFjaywgbnVsbCk7CiAgICAgICAgfQoKICAgICAgICBjbGFzcyBNU0xlZGdl\nclJhbmdlSXRlcmF0b3IgaW1wbGVtZW50cyBMZWRnZXJSYW5nZUl0ZXJhdG9y\nIHsKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggb3BlbkN1cnNv\nckxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgICAgICBN\nZXRhc3RvcmVDdXJzb3IgY3Vyc29yID0gbnVsbDsKICAgICAgICAgICAgLy8g\nbGFzdCBsZWRnZXIgaWQgaW4gcHJldmlvdXMgcmFuZ2UKCiAgICAgICAgICAg\nIE1TTGVkZ2VyUmFuZ2VJdGVyYXRvcigpIHsKICAgICAgICAgICAgICAgIE1l\ndGFzdG9yZUNhbGxiYWNrPE1ldGFzdG9yZUN1cnNvcj4gb3BlbkN1cnNvckNi\nID0gbmV3IE1ldGFzdG9yZUNhbGxiYWNrPE1ldGFzdG9yZUN1cnNvcj4oKSB7\nCiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgY29tcGxldGUoaW50IHJjLCBNZXRhc3RvcmVD\ndXJzb3IgbmV3Q3Vyc29yLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChNU0V4Y2VwdGlvbi5Db2RlLk9LLmdldENvZGUoKSAh\nPSByYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJFcnJvciBvcGVuaW5nIGN1cnNvciBmb3IgbGVkZ2VyIHJhbmdlIGl0ZXJh\ndG9yIHt9IiwgcmMpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3Vyc29yID0gbmV3Q3Vy\nc29yOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIG9wZW5DdXJzb3JMYXRjaC5jb3VudERvd24oKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAg\nICAgICAgbGVkZ2VyVGFibGUub3BlbkN1cnNvcihOT05fRklFTERTLCBvcGVu\nQ3Vyc29yQ2IsIG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaGFzTmV4dCgp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIG9wZW5DdXJzb3JMYXRjaC5hd2FpdCgpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24g\naWUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkludGVycnVw\ndGVkIHdhaXRpbmcgZm9yIGN1cnNvciB0byBvcGVuIiwgaWUpOwogICAgICAg\nICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0\nKCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9u\nKCJJbnRlcnJ1cHRlZCB3YWl0aW5nIHRvIHJlYWQgcmFuZ2UiLCBpZSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oIkZhaWxlZCB0byBvcGVuIGxlZGdlciByYW5nZSBjdXJzb3IsIGNo\nZWNrIGxvZ3MiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIHJldHVybiBjdXJzb3IuaGFzTW9yZUVudHJpZXMoKTsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBM\nZWRnZXJSYW5nZSBuZXh0KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgU29ydGVkU2V0\nPExvbmc+IGxlZGdlcklkcyA9IG5ldyBUcmVlU2V0PExvbmc+KCk7CiAgICAg\nICAgICAgICAgICAgICAgSXRlcmF0b3I8TWV0YXN0b3JlVGFibGVJdGVtPiBp\ndGVyID0gY3Vyc29yLnJlYWRFbnRyaWVzKG1heEVudHJpZXNQZXJTY2FuKTsK\nICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWRzLmFkZChrZXkyTGVk\nZ2VySWQoaXRlci5uZXh0KCkuZ2V0S2V5KCkpKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJS\nYW5nZShsZWRnZXJJZHMpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoTVNF\neGNlcHRpb24gbXNlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJFeGNlcHRpb24gb2NjdXJyZWQgcmVhZGluZyBmcm9tIG1ldGFzdG9yZSIs\nIG1zZSk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0\naW9uKCJDb3VsZG4ndCByZWFkIGZyb20gbWV0YXN0b3JlIiwgbXNlKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIExlZGdlclJhbmdlSXRlcmF0\nb3IgZ2V0TGVkZ2VyUmFuZ2VzKCkgewogICAgICAgICAgICByZXR1cm4gbmV3\nIE1TTGVkZ2VyUmFuZ2VJdGVyYXRvcigpOwogICAgICAgIH0KICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBMZWRnZXJNYW5hZ2VyIG5ld0xlZGdl\nck1hbmFnZXIoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBNc0xlZGdlck1hbmFn\nZXIoY29uZiwgemssIG1ldGFzdG9yZSk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgbmV3\nTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKSB0aHJvd3MgS2VlcGVy\nRXhjZXB0aW9uLAogICAgICAgICAgICBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwg\nUmVwbGljYXRpb25FeGNlcHRpb24uQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gVE9ETzogY3VycmVudGx5IGp1c3QgdXNlIHprIGxlZGdl\nciB1bmRlcnJlcGxpY2F0aW9uIG1hbmFnZXIKICAgICAgICByZXR1cm4gbmV3\nIFprTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoY29uZiwgemspOwog\nICAgfQoKICAgIC8qKgogICAgICogUHJvY2VzcyBzZXQgb25lIGJ5IG9uZSBp\nbiBhc3luY2hyb25pemUgd2F5LiBQcm9jZXNzIHdpbGwgYmUgc3RvcHBlZAog\nICAgICogaW1tZWRpYXRlbHkgd2hlbiBlcnJvciBvY2N1cnJlZC4KICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQXN5bmNTZXRQcm9jZXNzb3I8\nVD4gewogICAgICAgIC8vIHVzZSB0aGlzIHRvIHByZXZlbnQgbG9uZyBzdGFj\nayBjaGFpbnMgZnJvbSBidWlsZGluZyB1cCBpbiBjYWxsYmFja3MKICAgICAg\nICBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1bGVyOwoKICAgICAg\nICAvKioKICAgICAgICAgKiBDb25zdHJ1Y3RvcgogICAgICAgICAqCiAgICAg\nICAgICogQHBhcmFtIHNjaGVkdWxlcgogICAgICAgICAqICAgICAgICAgICAg\nRXhlY3V0b3IgdXNlZCB0byBwcmV2ZW50IGxvbmcgc3RhY2sgY2hhaW5zCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIEFzeW5jU2V0UHJvY2Vzc29yKFNj\naGVkdWxlZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXIpIHsKICAgICAgICAg\nICAgdGhpcy5zY2hlZHVsZXIgPSBzY2hlZHVsZXI7CiAgICAgICAgfQoKICAg\nICAgICAvKioKICAgICAgICAgKiBQcm9jZXNzIHNldCBvZiBpdGVtcwogICAg\nICAgICAqCiAgICAgICAgICogQHBhcmFtIGRhdGEKICAgICAgICAgKiAgICAg\nICAgICAgIFNldCBvZiBkYXRhIHRvIHByb2Nlc3MKICAgICAgICAgKiBAcGFy\nYW0gcHJvY2Vzc29yCiAgICAgICAgICogICAgICAgICAgICBDYWxsYmFjayB0\nbyBwcm9jZXNzIGVsZW1lbnQgb2YgbGlzdCB3aGVuIHN1Y2Nlc3MKICAgICAg\nICAgKiBAcGFyYW0gZmluYWxDYgogICAgICAgICAqICAgICAgICAgICAgRmlu\nYWwgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIGFmdGVyIGFsbCBlbGVtZW50cyBp\nbiB0aGUgbGlzdAogICAgICAgICAqICAgICAgICAgICAgYXJlIHByb2Nlc3Nl\nZAogICAgICAgICAqIEBwYXJhbSBjb250eHQKICAgICAgICAgKiAgICAgICAg\nICAgIENvbnRleHQgb2YgZmluYWwgY2FsbGJhY2sKICAgICAgICAgKiBAcGFy\nYW0gc3VjY2Vzc1JjCiAgICAgICAgICogICAgICAgICAgICBSQyBwYXNzZWQg\ndG8gZmluYWwgY2FsbGJhY2sgb24gc3VjY2VzcwogICAgICAgICAqIEBwYXJh\nbSBmYWlsdXJlUmMKICAgICAgICAgKiAgICAgICAgICAgIFJDIHBhc3NlZCB0\nbyBmaW5hbCBjYWxsYmFjayBvbiBmYWlsdXJlCiAgICAgICAgICovCiAgICAg\nICAgcHVibGljIHZvaWQgcHJvY2VzcyhmaW5hbCBTZXQ8VD4gZGF0YSwgZmlu\nYWwgUHJvY2Vzc29yPFQ+IHByb2Nlc3NvciwgZmluYWwgQXN5bmNDYWxsYmFj\nay5Wb2lkQ2FsbGJhY2sgZmluYWxDYiwKICAgICAgICAgICAgICAgIGZpbmFs\nIE9iamVjdCBjb250ZXh0LCBmaW5hbCBpbnQgc3VjY2Vzc1JjLCBmaW5hbCBp\nbnQgZmFpbHVyZVJjKSB7CiAgICAgICAgICAgIGlmIChkYXRhID09IG51bGwg\nfHwgZGF0YS5zaXplKCkgPT0gMCkgewogICAgICAgICAgICAgICAgZmluYWxD\nYi5wcm9jZXNzUmVzdWx0KHN1Y2Nlc3NSYywgbnVsbCwgY29udGV4dCk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZmluYWwgSXRlcmF0b3I8VD4gaXRlciA9IGRhdGEuaXRlcmF0b3IoKTsK\nICAgICAgICAgICAgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgc3R1YkNh\nbGxiYWNrID0gbmV3IEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrKCkgewog\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9i\namVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0gc3Vj\nY2Vzc1JjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRlcm1pbmFs\nIGltbWVkaWF0ZWx5CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsQ2Iu\ncHJvY2Vzc1Jlc3VsdChmYWlsdXJlUmMsIG51bGwsIGNvbnRleHQpOwogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGlmICghaXRlci5oYXNOZXh0KCkp\nIHsgLy8gcmVhY2ggdGhlIGVuZCBvZiBsaXN0CiAgICAgICAgICAgICAgICAg\nICAgICAgIGZpbmFsQ2IucHJvY2Vzc1Jlc3VsdChzdWNjZXNzUmMsIG51bGws\nIGNvbnRleHQpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIHBy\nb2Nlc3MgbmV4dCBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgZmluYWwg\nVCBkYXRhVG9Qcm9jZXNzID0gaXRlci5uZXh0KCk7CiAgICAgICAgICAgICAg\nICAgICAgZmluYWwgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgc3R1YiA9\nIHRoaXM7CiAgICAgICAgICAgICAgICAgICAgc2NoZWR1bGVyLnN1Ym1pdChu\nZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgZmluYWwgdm9p\nZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNz\nb3IucHJvY2VzcyhkYXRhVG9Qcm9jZXNzLCBzdHViKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBUIGZpcnN0\nRWxlbWVudCA9IGl0ZXIubmV4dCgpOwogICAgICAgICAgICBwcm9jZXNzb3Iu\ncHJvY2VzcyhmaXJzdEVsZW1lbnQsIHN0dWJDYWxsYmFjayk7CiAgICAgICAg\nfQogICAgfQoKfQo=\n","encoding":"base64"}

