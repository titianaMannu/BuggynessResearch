{"sha":"03f1c600566dd6f42ab8fc661454bf1588e0a544","node_id":"MDQ6QmxvYjE1NzU5NTY6MDNmMWM2MDA1NjZkZDZmNDJhYjhmYzY2MTQ1NGJmMTU4OGUwYTU0NA==","size":13557,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/03f1c600566dd6f42ab8fc661454bf1588e0a544","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlOwoKaW1wb3J0\nIGphdmEudXRpbC5OYXZpZ2FibGVNYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7CmltcG9ydCBqYXZhLnV0aWwu\nY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU0V4Y2VwdGlvbi5Db2RlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZl\ncnNpb25lZDsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi51dGlsLmNvbmN1\ncnJlbnQuVGhyZWFkRmFjdG9yeUJ1aWxkZXI7CgpwdWJsaWMgY2xhc3MgSW5N\nZW1vcnlNZXRhc3RvcmVUYWJsZSBpbXBsZW1lbnRzIE1ldGFzdG9yZVNjYW5u\nYWJsZVRhYmxlIHsKCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIE1ldGFkYXRh\nVmVyc2lvbiBpbXBsZW1lbnRzIFZlcnNpb24gewogICAgICAgIGludCB2ZXJz\naW9uOwoKICAgICAgICBwdWJsaWMgTWV0YWRhdGFWZXJzaW9uKGludCB2KSB7\nCiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHY7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgTWV0YWRhdGFWZXJzaW9uKE1ldGFkYXRhVmVyc2lvbiB2\nKSB7CiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHYudmVyc2lvbjsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgTWV0YWRhdGFW\nZXJzaW9uIGluY3JlbWVudFZlcnNpb24oKSB7CiAgICAgICAgICAgICsrdmVy\nc2lvbjsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgT2NjdXJyZWQgY29tcGFy\nZShWZXJzaW9uIHYpIHsKICAgICAgICAgICAgaWYgKG51bGwgPT0gdikgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9u\nKCJWZXJzaW9uIGlzIG5vdCBhbGxvd2VkIHRvIGJlIG51bGwuIik7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKHYgPT0gVmVyc2lvbi5ORVcpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBPY2N1cnJlZC5BRlRFUjsKICAgICAg\nICAgICAgfSBlbHNlIGlmICh2ID09IFZlcnNpb24uQU5ZKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gT2NjdXJyZWQuQ09OQ1VSUkVOVExZOwogICAgICAg\nICAgICB9IGVsc2UgaWYgKCEodiBpbnN0YW5jZW9mIE1ldGFkYXRhVmVyc2lv\nbikpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24oIkludmFsaWQgdmVyc2lvbiB0eXBlIik7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgTWV0YWRhdGFWZXJzaW9uIG12ID0gKE1ldGFk\nYXRhVmVyc2lvbil2OwogICAgICAgICAgICBpbnQgcmVzID0gdmVyc2lvbiAt\nIG12LnZlcnNpb247CiAgICAgICAgICAgIGlmIChyZXMgPT0gMCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIE9jY3VycmVkLkNPTkNVUlJFTlRMWTsKICAg\nICAgICAgICAgfSBlbHNlIGlmIChyZXMgPCAwKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gT2NjdXJyZWQuQkVGT1JFOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgcmV0dXJuIE9jY3VycmVkLkFGVEVSOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG9iaikgewogICAgICAg\nICAgICBpZiAobnVsbCA9PSBvYmogfHwKICAgICAgICAgICAgICAgICEob2Jq\nIGluc3RhbmNlb2YgTWV0YWRhdGFWZXJzaW9uKSkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIE1l\ndGFkYXRhVmVyc2lvbiB2ID0gKE1ldGFkYXRhVmVyc2lvbilvYmo7CiAgICAg\nICAgICAgIHJldHVybiAwID09ICh2ZXJzaW9uIC0gdi52ZXJzaW9uKTsKICAg\nICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiAidmVyc2lvbj0i\nICsgdmVyc2lvbjsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiB2ZXJzaW9uOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIFN0cmlu\nZyBuYW1lOwogICAgcHJpdmF0ZSBUcmVlTWFwPFN0cmluZywgVmVyc2lvbmVk\nPFZhbHVlPj4gbWFwID0gbnVsbDsKICAgIHByaXZhdGUgVHJlZU1hcDxTdHJp\nbmcsIE1ldGFzdG9yZVdhdGNoZXI+IHdhdGNoZXJNYXAgPSBudWxsOwogICAg\ncHJpdmF0ZSBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1bGVyOwoK\nICAgIHB1YmxpYyBJbk1lbW9yeU1ldGFzdG9yZVRhYmxlKEluTWVtb3J5TWV0\nYVN0b3JlIG1ldGFzdG9yZSwgU3RyaW5nIG5hbWUpIHsKICAgICAgICB0aGlz\nLm1hcCA9IG5ldyBUcmVlTWFwPFN0cmluZywgVmVyc2lvbmVkPFZhbHVlPj4o\nKTsKICAgICAgICB0aGlzLndhdGNoZXJNYXAgPSBuZXcgVHJlZU1hcDxTdHJp\nbmcsTWV0YXN0b3JlV2F0Y2hlcj4oKTsKICAgICAgICB0aGlzLm5hbWUgPSBu\nYW1lOwogICAgICAgIFN0cmluZyB0aE5hbWUgPSAiSW5NZW1vcnlNZXRhc3Rv\ncmUtVGFibGUoIiArIG5hbWUgKyAiKS1TY2hlZHVsZXItJWQiOwogICAgICAg\nIFRocmVhZEZhY3RvcnlCdWlsZGVyIHRmYiA9IG5ldyBUaHJlYWRGYWN0b3J5\nQnVpbGRlcigpCiAgICAgICAgICAgICAgICAuc2V0TmFtZUZvcm1hdCh0aE5h\nbWUpOwogICAgICAgIHRoaXMuc2NoZWR1bGVyID0gRXhlY3V0b3JzCiAgICAg\nICAgICAgICAgICAubmV3U2luZ2xlVGhyZWFkU2NoZWR1bGVkRXhlY3V0b3Io\ndGZiLmJ1aWxkKCkpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIFN0cmluZyBnZXROYW1lICgpIHsKICAgICAgICByZXR1cm4gdGhpcy5uYW1l\nOwogICAgfQoKICAgIHN0YXRpYyBWZXJzaW9uZWQ8VmFsdWU+IGNsb25lVmFs\ndWUoVmFsdWUgdmFsdWUsIFZlcnNpb24gdmVyc2lvbiwgU2V0PFN0cmluZz4g\nZmllbGRzKSB7CiAgICAgICAgaWYgKG51bGwgIT0gdmFsdWUpIHsKICAgICAg\nICAgICAgVmFsdWUgbmV3VmFsdWUgPSBuZXcgVmFsdWUoKTsKICAgICAgICAg\nICAgaWYgKEFMTF9GSUVMRFMgPT0gZmllbGRzKSB7CiAgICAgICAgICAgICAg\nICBmaWVsZHMgPSB2YWx1ZS5nZXRGaWVsZHMoKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBmb3IgKFN0cmluZyBmIDogZmllbGRzKSB7CiAgICAgICAg\nICAgICAgICBuZXdWYWx1ZS5zZXRGaWVsZChmLCB2YWx1ZS5nZXRGaWVsZChm\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFsdWUgPSBuZXdWYWx1\nZTsKICAgICAgICB9CgogICAgICAgIGlmIChudWxsID09IHZlcnNpb24pIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCJW\nZXJzaW9uIGlzbid0IGFsbG93ZWQgdG8gYmUgbnVsbC4iKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKFZlcnNpb24uQU5ZICE9IHZlcnNpb24gJiYgVmVyc2lv\nbi5ORVcgIT0gdmVyc2lvbikgewogICAgICAgICAgICBpZiAodmVyc2lvbiBp\nbnN0YW5jZW9mIE1ldGFkYXRhVmVyc2lvbikgewogICAgICAgICAgICAgICAg\ndmVyc2lvbiA9IG5ldyBNZXRhZGF0YVZlcnNpb24oKChNZXRhZGF0YVZlcnNp\nb24pdmVyc2lvbikudmVyc2lvbik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9u\nKCJXcm9uZyB2ZXJzaW9uIHR5cGUuIik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIG5ldyBWZXJzaW9uZWQ8VmFsdWU+KHZhbHVl\nLCB2ZXJzaW9uKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2\nb2lkIGdldChmaW5hbCBTdHJpbmcga2V5LCBmaW5hbCBNZXRhc3RvcmVDYWxs\nYmFjazxWZXJzaW9uZWQ8VmFsdWU+PiBjYiwgZmluYWwgT2JqZWN0IGN0eCkg\newogICAgICAgIHNjaGVkdWxlci5zdWJtaXQobmV3IFJ1bm5hYmxlKCkgewog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgICAgICAgICAgc2NoZWR1bGVHZXQoa2V5LCBBTExf\nRklFTERTLCBjYiwgY3R4KTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwog\nICAgfQogICAgCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGdldChm\naW5hbCBTdHJpbmcga2V5LCBmaW5hbCBNZXRhc3RvcmVXYXRjaGVyIHdhdGNo\nZXIsIGZpbmFsIE1ldGFzdG9yZUNhbGxiYWNrPFZlcnNpb25lZDxWYWx1ZT4+\nIGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgc2NoZWR1bGVyLnN1\nYm1pdChuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAg\nICBzY2hlZHVsZUdldChrZXksIEFMTF9GSUVMRFMsIGNiLCBjdHgpOwogICAg\nICAgICAgICAgICAgc3luY2hyb25pemVkKHdhdGNoZXJNYXApIHsKICAgICAg\nICAgICAgICAgICAgICB3YXRjaGVyTWFwLnB1dCgga2V5LCB3YXRjaGVyICk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGdldChmaW5h\nbCBTdHJpbmcga2V5LCBmaW5hbCBTZXQ8U3RyaW5nPiBmaWVsZHMsIGZpbmFs\nIE1ldGFzdG9yZUNhbGxiYWNrPFZlcnNpb25lZDxWYWx1ZT4+IGNiLAogICAg\nICAgICAgICBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgc2NoZWR1bGVy\nLnN1Ym1pdChuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAg\nICAgICBzY2hlZHVsZUdldChrZXksIGZpZWxkcywgY2IsIGN0eCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBwdWJsaWMgc3luY2hy\nb25pemVkIHZvaWQgc2NoZWR1bGVHZXQoU3RyaW5nIGtleSwgU2V0PFN0cmlu\nZz4gZmllbGRzLCBNZXRhc3RvcmVDYWxsYmFjazxWZXJzaW9uZWQ8VmFsdWU+\nPiBjYiwKICAgICAgICAgICAgT2JqZWN0IGN0eCkgewogICAgICAgIGlmIChu\ndWxsID09IGtleSkgewogICAgICAgICAgICBjYi5jb21wbGV0ZShDb2RlLkls\nbGVnYWxPcC5nZXRDb2RlKCksIG51bGwsIGN0eCk7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgVmVyc2lvbmVkPFZhbHVlPiB2diA9\nIGdldChrZXkpOwogICAgICAgIGludCByYyA9IG51bGwgPT0gdnYgPyBDb2Rl\nLk5vS2V5LmdldENvZGUoKSA6IENvZGUuT0suZ2V0Q29kZSgpOwogICAgICAg\nIGlmICh2diAhPSBudWxsKSB7CiAgICAgICAgICAgIHZ2ID0gY2xvbmVWYWx1\nZSh2di5nZXRWYWx1ZSgpLCB2di5nZXRWZXJzaW9uKCksIGZpZWxkcyk7CiAg\nICAgICAgfQogICAgICAgIGNiLmNvbXBsZXRlKHJjLCB2diwgY3R4KTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHB1dChmaW5hbCBT\ndHJpbmcga2V5LCBmaW5hbCBWYWx1ZSB2YWx1ZSwgZmluYWwgVmVyc2lvbiB2\nZXJzaW9uLCBmaW5hbCBNZXRhc3RvcmVDYWxsYmFjazxWZXJzaW9uPiBjYiwK\nICAgICAgICAgICAgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIHNjaGVk\ndWxlci5zdWJtaXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAg\nICAgICAgICAgaWYgKG51bGwgPT0ga2V5IHx8IG51bGwgPT0gdmFsdWUgfHwg\nbnVsbCA9PSB2ZXJzaW9uKSB7CiAgICAgICAgICAgICAgICAgICAgY2IuY29t\ncGxldGUoQ29kZS5JbGxlZ2FsT3AuZ2V0Q29kZSgpLCBudWxsLCBjdHgpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIFJlc3VsdDxWZXJzaW9uPiByZXN1bHQgPSBwdXQo\na2V5LCB2YWx1ZSwgdmVyc2lvbik7CiAgICAgICAgICAgICAgICBjYi5jb21w\nbGV0ZShyZXN1bHQuY29kZS5nZXRDb2RlKCksIHJlc3VsdC52YWx1ZSwgY3R4\nKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLyoKICAgICAg\nICAgICAgICAgICAqIElmIHRoZXJlIGlzIGEgd2F0Y2hlciBzZXQgZm9yIHRo\naXMga2V5LCB3ZSBuZWVkCiAgICAgICAgICAgICAgICAgKiB0byB0cmlnZ2Vy\nIGl0LgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBpZihy\nZXN1bHQuY29kZSA9PSBNU0V4Y2VwdGlvbi5Db2RlLk9LKXsKICAgICAgICAg\nICAgICAgICAgICB0cmlnZ2VyV2F0Y2goa2V5LCBNU1dhdGNoZWRFdmVudC5F\ndmVudFR5cGUuQ0hBTkdFRCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9KTsKICAgIH0KICAgIAogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgdm9pZCByZW1vdmUoZmluYWwgU3RyaW5nIGtleSwgZmluYWwg\nVmVyc2lvbiB2ZXJzaW9uLCBmaW5hbCBNZXRhc3RvcmVDYWxsYmFjazxWb2lk\nPiBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIHNjaGVkdWxlci5z\ndWJtaXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAg\nICAgaWYgKG51bGwgPT0ga2V5IHx8IG51bGwgPT0gdmVyc2lvbikgewogICAg\nICAgICAgICAgICAgICAgIGNiLmNvbXBsZXRlKENvZGUuSWxsZWdhbE9wLmdl\ndENvZGUoKSwgbnVsbCwgY3R4KTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBDb2RlIGNv\nZGUgPSByZW1vdmUoa2V5LCB2ZXJzaW9uKTsKICAgICAgICAgICAgICAgIGNi\nLmNvbXBsZXRlKGNvZGUuZ2V0Q29kZSgpLCBudWxsLCBjdHgpOwogICAgICAg\nICAgICAgICAgCiAgICAgICAgICAgICAgICBpZihjb2RlID09IE1TRXhjZXB0\naW9uLkNvZGUuT0spewogICAgICAgICAgICAgICAgICAgIHRyaWdnZXJXYXRj\naChrZXksIE1TV2F0Y2hlZEV2ZW50LkV2ZW50VHlwZS5SRU1PVkVEKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgb3BlbkN1cnNvcihN\nZXRhc3RvcmVDYWxsYmFjazxNZXRhc3RvcmVDdXJzb3I+IGNiLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgb3BlbkN1cnNvcihFTVBUWV9TVEFSVF9LRVksIHRy\ndWUsIEVNUFRZX0VORF9LRVksIHRydWUsIE9yZGVyLkFTQywKICAgICAgICAg\nICAgICAgICAgIEFMTF9GSUVMRFMsIGNiLCBjdHgpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgb3BlbkN1cnNvcihTZXQ8U3RyaW5n\nPiBmaWVsZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIE1ldGFzdG9y\nZUNhbGxiYWNrPE1ldGFzdG9yZUN1cnNvcj4gY2IsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBvcGVuQ3Vyc29yKEVNUFRZX1NUQVJUX0tFWSwgdHJ1ZSwgRU1Q\nVFlfRU5EX0tFWSwgdHJ1ZSwgT3JkZXIuQVNDLAogICAgICAgICAgICAgICAg\nICAgZmllbGRzLCBjYiwgY3R4KTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIG9wZW5DdXJzb3IoU3RyaW5nIGZpcnN0S2V5LCBib29s\nZWFuIGZpcnN0SW5jbHVzaXZlLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICBTdHJpbmcgbGFzdEtleSwgYm9vbGVhbiBsYXN0SW5jbHVzaXZlLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICBPcmRlciBvcmRlciwgTWV0YXN0b3Jl\nQ2FsbGJhY2s8TWV0YXN0b3JlQ3Vyc29yPiBjYiwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgT2JqZWN0IGN0eCkgewogICAgICAgIG9wZW5DdXJzb3Io\nZmlyc3RLZXksIGZpcnN0SW5jbHVzaXZlLCBsYXN0S2V5LCBsYXN0SW5jbHVz\naXZlLAogICAgICAgICAgICAgICAgICAgb3JkZXIsIEFMTF9GSUVMRFMsIGNi\nLCBjdHgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\nb3BlbkN1cnNvcihmaW5hbCBTdHJpbmcgZmlyc3RLZXksIGZpbmFsIGJvb2xl\nYW4gZmlyc3RJbmNsdXNpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZpbmFsIFN0cmluZyBsYXN0S2V5LCBmaW5hbCBib29sZWFuIGxhc3RJbmNs\ndXNpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIE9yZGVy\nIG9yZGVyLCBmaW5hbCBTZXQ8U3RyaW5nPiBmaWVsZHMsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGZpbmFsIE1ldGFzdG9yZUNhbGxiYWNrPE1ldGFz\ndG9yZUN1cnNvcj4gY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBz\nY2hlZHVsZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICAgICAgICAgIFJlc3VsdDxNZXRhc3RvcmVDdXJzb3I+IHJlc3VsdCA9\nIG9wZW5DdXJzb3IoZmlyc3RLZXksIGZpcnN0SW5jbHVzaXZlLCBsYXN0S2V5\nLCBsYXN0SW5jbHVzaXZlLAogICAgICAgICAgICAgICAgICAgICAgICBvcmRl\nciwgZmllbGRzKTsKICAgICAgICAgICAgICAgIGNiLmNvbXBsZXRlKHJlc3Vs\ndC5jb2RlLmdldENvZGUoKSwgcmVzdWx0LnZhbHVlLCBjdHgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHRy\naWdnZXJXYXRjaChTdHJpbmcga2V5LCBNU1dhdGNoZWRFdmVudC5FdmVudFR5\ncGUgdHlwZSkgewogICAgICAgIHN5bmNocm9uaXplZCh3YXRjaGVyTWFwKXsK\nICAgICAgICAgICAgaWYod2F0Y2hlck1hcC5jb250YWluc0tleSgga2V5ICkp\nIHsKICAgICAgICAgICAgICAgIE1TV2F0Y2hlZEV2ZW50IGV2ZW50ID0gbmV3\nIE1TV2F0Y2hlZEV2ZW50KGtleSwgdHlwZSk7CiAgICAgICAgICAgICAgICB3\nYXRjaGVyTWFwLmdldCgga2V5ICkucHJvY2VzcyggZXZlbnQgKTsKICAgICAg\nICAgICAgICAgIHdhdGNoZXJNYXAucmVtb3ZlKCBrZXkgKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KICAgIAogICAgcHJpdmF0ZSBzeW5jaHJv\nbml6ZWQgVmVyc2lvbmVkPFZhbHVlPiBnZXQoU3RyaW5nIGtleSkgewogICAg\nICAgIHJldHVybiBtYXAuZ2V0KGtleSk7CiAgICB9CgogICAgcHJpdmF0ZSBz\neW5jaHJvbml6ZWQgQ29kZSByZW1vdmUoU3RyaW5nIGtleSwgVmVyc2lvbiB2\nZXJzaW9uKSB7CiAgICAgICAgVmVyc2lvbmVkPFZhbHVlPiB2diA9IG1hcC5n\nZXQoa2V5KTsKICAgICAgICBpZiAobnVsbCA9PSB2dikgewogICAgICAgICAg\nICByZXR1cm4gQ29kZS5Ob0tleTsKICAgICAgICB9CiAgICAgICAgaWYgKFZl\ncnNpb24uT2NjdXJyZWQuQ09OQ1VSUkVOVExZICE9IHZ2LmdldFZlcnNpb24o\nKS5jb21wYXJlKHZlcnNpb24pKSB7CiAgICAgICAgICAgIHJldHVybiBDb2Rl\nLkJhZFZlcnNpb247CiAgICAgICAgfQogICAgICAgIG1hcC5yZW1vdmUoa2V5\nKTsKICAgICAgICByZXR1cm4gQ29kZS5PSzsKICAgIH0KCiAgICBzdGF0aWMg\nY2xhc3MgUmVzdWx0PFQ+IHsKICAgICAgICBDb2RlIGNvZGU7CiAgICAgICAg\nVCB2YWx1ZTsKCiAgICAgICAgcHVibGljIFJlc3VsdChDb2RlIGNvZGUsIFQg\ndmFsdWUpIHsKICAgICAgICAgICAgdGhpcy5jb2RlID0gY29kZTsKICAgICAg\nICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlOwogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIHN5bmNocm9uaXplZCBSZXN1bHQ8VmVyc2lvbj4gcHV0KFN0\ncmluZyBrZXksIFZhbHVlIHZhbHVlLCBWZXJzaW9uIHZlcnNpb24pIHsKICAg\nICAgICBWZXJzaW9uZWQ8VmFsdWU+IHZ2ID0gbWFwLmdldChrZXkpOwogICAg\nICAgIGlmICh2diA9PSBudWxsKSB7CiAgICAgICAgICAgIGlmIChWZXJzaW9u\nLk5FVyAhPSB2ZXJzaW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3\nIFJlc3VsdDxWZXJzaW9uPihDb2RlLk5vS2V5LCBudWxsKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICB2diA9IGNsb25lVmFsdWUodmFsdWUsIHZlcnNp\nb24sIEFMTF9GSUVMRFMpOwogICAgICAgICAgICB2di5zZXRWZXJzaW9uKG5l\ndyBNZXRhZGF0YVZlcnNpb24oMCkpOwogICAgICAgICAgICBtYXAucHV0KGtl\neSwgdnYpOwogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3VsdDxWZXJzaW9u\nPihDb2RlLk9LLCBuZXcgTWV0YWRhdGFWZXJzaW9uKDApKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKFZlcnNpb24uTkVXID09IHZlcnNpb24pIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBSZXN1bHQ8VmVyc2lvbj4oQ29kZS5LZXlFeGlz\ndHMsIG51bGwpOwogICAgICAgIH0KICAgICAgICBpZiAoVmVyc2lvbi5PY2N1\ncnJlZC5DT05DVVJSRU5UTFkgIT0gdnYuZ2V0VmVyc2lvbigpLmNvbXBhcmUo\ndmVyc2lvbikpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQ8VmVy\nc2lvbj4oQ29kZS5CYWRWZXJzaW9uLCBudWxsKTsKICAgICAgICB9CiAgICAg\nICAgdnYuc2V0VmVyc2lvbigoKE1ldGFkYXRhVmVyc2lvbil2di5nZXRWZXJz\naW9uKCkpLmluY3JlbWVudFZlcnNpb24oKSk7CiAgICAgICAgdnYuc2V0VmFs\ndWUodnYuZ2V0VmFsdWUoKS5tZXJnZSh2YWx1ZSkpOwogICAgICAgIHJldHVy\nbiBuZXcgUmVzdWx0PFZlcnNpb24+KENvZGUuT0ssIG5ldyBNZXRhZGF0YVZl\ncnNpb24oKE1ldGFkYXRhVmVyc2lvbil2di5nZXRWZXJzaW9uKCkpKTsKICAg\nIH0KCiAgICBwcml2YXRlIHN5bmNocm9uaXplZCBSZXN1bHQ8TWV0YXN0b3Jl\nQ3Vyc29yPiBvcGVuQ3Vyc29yKAogICAgICAgICAgICBTdHJpbmcgZmlyc3RL\nZXksIGJvb2xlYW4gZmlyc3RJbmNsdXNpdmUsCiAgICAgICAgICAgIFN0cmlu\nZyBsYXN0S2V5LCBib29sZWFuIGxhc3RJbmNsdXNpdmUsCiAgICAgICAgICAg\nIE9yZGVyIG9yZGVyLCBTZXQ8U3RyaW5nPiBmaWVsZHMpIHsKICAgICAgICBp\nZiAoMCA9PSBtYXAuc2l6ZSgpKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcg\nUmVzdWx0PE1ldGFzdG9yZUN1cnNvcj4oQ29kZS5PSywgTWV0YXN0b3JlQ3Vy\nc29yLkVNUFRZX0NVUlNPUik7CiAgICAgICAgfQoKICAgICAgICBib29sZWFu\nIGlzTGVnYWxDdXJzb3IgPSBmYWxzZTsKICAgICAgICBOYXZpZ2FibGVNYXA8\nU3RyaW5nLCBWZXJzaW9uZWQ8VmFsdWU+PiBteU1hcCA9IG51bGw7CiAgICAg\nICAgaWYgKE9yZGVyLkFTQyA9PSBvcmRlcikgewogICAgICAgICAgICBteU1h\ncCA9IG1hcDsKICAgICAgICAgICAgaWYgKEVNUFRZX0VORF9LRVkgPT0gbGFz\ndEtleSB8fAogICAgICAgICAgICAgICAgbGFzdEtleS5jb21wYXJlVG8obXlN\nYXAubGFzdEtleSgpKSA+IDApIHsKICAgICAgICAgICAgICAgIGxhc3RLZXkg\nPSBteU1hcC5sYXN0S2V5KCk7CiAgICAgICAgICAgICAgICBsYXN0SW5jbHVz\naXZlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoRU1Q\nVFlfU1RBUlRfS0VZID09IGZpcnN0S2V5IHx8CiAgICAgICAgICAgICAgICBm\naXJzdEtleS5jb21wYXJlVG8obXlNYXAuZmlyc3RLZXkoKSkgPCAwKSB7CiAg\nICAgICAgICAgICAgICBmaXJzdEtleSA9IG15TWFwLmZpcnN0S2V5KCk7CiAg\nICAgICAgICAgICAgICBmaXJzdEluY2x1c2l2ZSA9IHRydWU7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKGZpcnN0S2V5LmNvbXBhcmVUbyhsYXN0\nS2V5KSA8PSAwKSB7CiAgICAgICAgICAgICAgICBpc0xlZ2FsQ3Vyc29yID0g\ndHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoT3JkZXIu\nREVTQyA9PSBvcmRlcikgewogICAgICAgICAgICBteU1hcCA9IG1hcC5kZXNj\nZW5kaW5nTWFwKCk7CiAgICAgICAgICAgIGlmIChFTVBUWV9TVEFSVF9LRVkg\nPT0gbGFzdEtleSB8fAogICAgICAgICAgICAgICAgbGFzdEtleS5jb21wYXJl\nVG8obXlNYXAubGFzdEtleSgpKSA8IDApIHsKICAgICAgICAgICAgICAgIGxh\nc3RLZXkgPSBteU1hcC5sYXN0S2V5KCk7CiAgICAgICAgICAgICAgICBsYXN0\nSW5jbHVzaXZlID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoRU1QVFlfRU5EX0tFWSA9PSBmaXJzdEtleSB8fAogICAgICAgICAgICAg\nICAgZmlyc3RLZXkuY29tcGFyZVRvKG15TWFwLmZpcnN0S2V5KCkpID4gMCkg\newogICAgICAgICAgICAgICAgZmlyc3RLZXkgPSBteU1hcC5maXJzdEtleSgp\nOwogICAgICAgICAgICAgICAgZmlyc3RJbmNsdXNpdmUgPSB0cnVlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaXJzdEtleS5jb21wYXJlVG8o\nbGFzdEtleSkgPj0gMCkgewogICAgICAgICAgICAgICAgaXNMZWdhbEN1cnNv\nciA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlm\nICghaXNMZWdhbEN1cnNvciB8fCBudWxsID09IG15TWFwKSB7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgUmVzdWx0PE1ldGFzdG9yZUN1cnNvcj4oQ29kZS5J\nbGxlZ2FsT3AsIG51bGwpOwogICAgICAgIH0KICAgICAgICBNZXRhc3RvcmVD\ndXJzb3IgY3Vyc29yID0gbmV3IEluTWVtb3J5TWV0YXN0b3JlQ3Vyc29yKAog\nICAgICAgICAgICAgICAgbXlNYXAuc3ViTWFwKGZpcnN0S2V5LCBmaXJzdElu\nY2x1c2l2ZSwgbGFzdEtleSwgbGFzdEluY2x1c2l2ZSksIGZpZWxkcywgc2No\nZWR1bGVyKTsKICAgICAgICByZXR1cm4gbmV3IFJlc3VsdDxNZXRhc3RvcmVD\ndXJzb3I+KENvZGUuT0ssIGN1cnNvcik7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAgICAvLyBkbyBub3Ro\naW5nCiAgICB9Cn0K\n","encoding":"base64"}

