{"sha":"9424bf93ea0ebbd8703b86cae9f646b51481288e","node_id":"MDQ6QmxvYjE1NzU5NTY6OTQyNGJmOTNlYTBlYmJkODcwM2I4NmNhZTlmNjQ2YjUxNDgxMjg4ZQ==","size":4381,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9424bf93ea0ebbd8703b86cae9f646b51481288e","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlOwoKaW1wb3J0\nIGNvbS5nb29nbGUuY29tbW9uLnByaW1pdGl2ZXMuVW5zaWduZWRCeXRlczsK\naW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLmhhc2guSGFzaGVyOwppbXBvcnQg\nY29tLmdvb2dsZS5jb21tb24uaGFzaC5IYXNoRnVuY3Rpb247CmltcG9ydCBj\nb20uZ29vZ2xlLmNvbW1vbi5oYXNoLkhhc2hpbmc7CgppbXBvcnQgamF2YS51\ndGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBv\ncnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwoKaW1wb3J0IHN0YXRpYyBjb20u\nZ29vZ2xlLmNvbW1vbi5iYXNlLkNoYXJzZXRzLlVURl84OwoKaW1wb3J0IHN0\nYXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLk1ldGFzdG9y\nZVRhYmxlLkFMTF9GSUVMRFM7CgpwdWJsaWMgY2xhc3MgVmFsdWUgewogICAg\nc3RhdGljIGZpbmFsIENvbXBhcmF0b3I8Ynl0ZVtdPiBjb21wYXJhdG9yID0K\nICAgICAgICBVbnNpZ25lZEJ5dGVzLmxleGljb2dyYXBoaWNhbENvbXBhcmF0\nb3IoKTsKCiAgICBwcm90ZWN0ZWQgTWFwPFN0cmluZywgYnl0ZVtdPiBmaWVs\nZHM7CgogICAgcHVibGljIFZhbHVlKCkgewogICAgICAgIGZpZWxkcyA9IG5l\ndyBIYXNoTWFwPFN0cmluZywgYnl0ZVtdPigpOwogICAgfQoKICAgIHB1Ymxp\nYyBWYWx1ZShWYWx1ZSB2KSB7CiAgICAgICAgZmllbGRzID0gbmV3IEhhc2hN\nYXA8U3RyaW5nLCBieXRlW10+KHYuZmllbGRzKTsKICAgIH0KCiAgICBwdWJs\naWMgYnl0ZVtdIGdldEZpZWxkKFN0cmluZyBmaWVsZCkgewogICAgICAgIHJl\ndHVybiBmaWVsZHMuZ2V0KGZpZWxkKTsKICAgIH0KCiAgICBwdWJsaWMgVmFs\ndWUgc2V0RmllbGQoU3RyaW5nIGZpZWxkLCBieXRlW10gZGF0YSkgewogICAg\nICAgIGZpZWxkcy5wdXQoZmllbGQsIGRhdGEpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIHB1YmxpYyBWYWx1ZSBjbGVhckZpZWxkcygpIHsK\nICAgICAgICBmaWVsZHMuY2xlYXIoKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgIH0KCiAgICBwdWJsaWMgU2V0PFN0cmluZz4gZ2V0RmllbGRzKCkgewog\nICAgICAgIHJldHVybiBmaWVsZHMua2V5U2V0KCk7CiAgICB9CgogICAgcHVi\nbGljIE1hcDxTdHJpbmcsIGJ5dGVbXT4gZ2V0RmllbGRzTWFwKCkgewogICAg\nICAgIHJldHVybiBDb2xsZWN0aW9ucy51bm1vZGlmaWFibGVNYXAoZmllbGRz\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNlbGVjdCBwYXJ0cyBvZiBmaWVs\nZHMuCiAgICAgKgogICAgICogQHBhcmFtIGZpZWxkcwogICAgICogICAgICAg\nICAgICBQYXJ0cyBvZiBmaWVsZHMKICAgICAqIEByZXR1cm4gbmV3IHZhbHVl\nIHdpdGggc3BlY2lmaWVkIGZpZWxkcwogICAgICovCiAgICBwdWJsaWMgVmFs\ndWUgcHJvamVjdChTZXQ8U3RyaW5nPiBmaWVsZHMpIHsKICAgICAgICBpZiAo\nQUxMX0ZJRUxEUyA9PSBmaWVsZHMpIHsKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBWYWx1ZSh0aGlzKTsKICAgICAgICB9CiAgICAgICAgVmFsdWUgdiA9IG5l\ndyBWYWx1ZSgpOwogICAgICAgIGZvciAoU3RyaW5nIGYgOiBmaWVsZHMpIHsK\nICAgICAgICAgICAgYnl0ZVtdIGRhdGEgPSB0aGlzLmZpZWxkcy5nZXQoZik7\nCiAgICAgICAgICAgIHYuc2V0RmllbGQoZiwgZGF0YSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB2OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICBIYXNoRnVuY3Rpb24gaGYg\nPSBIYXNoaW5nLm11cm11cjNfMzIoKTsKICAgICAgICBIYXNoZXIgaGMgPSBo\nZi5uZXdIYXNoZXIoKTsKICAgICAgICBmb3IgKFN0cmluZyBrZXkgOiBmaWVs\nZHMua2V5U2V0KCkpIHsKICAgICAgICAgICAgaGMucHV0U3RyaW5nKGtleSk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBoYy5oYXNoKCkuYXNJbnQoKTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBib29sZWFuIGVxdWFs\ncyhPYmplY3QgbykgewogICAgICAgIGlmICghKG8gaW5zdGFuY2VvZiBWYWx1\nZSkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAg\nICAgICBWYWx1ZSBvdGhlciA9IChWYWx1ZSkgbzsKICAgICAgICBpZiAoZmll\nbGRzLnNpemUoKSAhPSBvdGhlci5maWVsZHMuc2l6ZSgpKSB7CiAgICAgICAg\nICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgZm9yIChTdHJp\nbmcgZiA6IGZpZWxkcy5rZXlTZXQoKSkgewogICAgICAgICAgICBieXRlW10g\ndjEgPSBmaWVsZHMuZ2V0KGYpOwogICAgICAgICAgICBieXRlW10gdjIgPSBv\ndGhlci5maWVsZHMuZ2V0KGYpOwogICAgICAgICAgICBpZiAoMCAhPSBjb21w\nYXJhdG9yLmNvbXBhcmUodjEsIHYyKSkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiB0cnVlOwogICAgfQoKICAgIC8qKgogICAgICogTWVyZ2Ugb3RoZXIg\ndmFsdWUuCiAgICAgKgogICAgICogQHBhcmFtIG90aGVyCiAgICAgKiAgICAg\nICAgICBPdGhlciBWYWx1ZQogICAgICovCiAgICBwdWJsaWMgVmFsdWUgbWVy\nZ2UoVmFsdWUgb3RoZXIpIHsKICAgICAgICBmb3IgKE1hcC5FbnRyeTxTdHJp\nbmcsIGJ5dGVbXT4gZW50cnkgOiBvdGhlci5maWVsZHMuZW50cnlTZXQoKSkg\newogICAgICAgICAgICBpZiAobnVsbCA9PSBlbnRyeS5nZXRWYWx1ZSgpKSB7\nCiAgICAgICAgICAgICAgICBmaWVsZHMucmVtb3ZlKGVudHJ5LmdldEtleSgp\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZpZWxk\ncy5wdXQoZW50cnkuZ2V0S2V5KCksIGVudHJ5LmdldFZhbHVlKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFN0cmluZyB0b1N0cmluZygp\nIHsKICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKTsKICAgICAgICBzYi5hcHBlbmQoIlsiKTsKICAgICAgICBmb3IgKE1h\ncC5FbnRyeTxTdHJpbmcsIGJ5dGVbXT4gZW50cnkgOiBmaWVsZHMuZW50cnlT\nZXQoKSkgewogICAgICAgICAgICBTdHJpbmcgZiA9IGVudHJ5LmdldEtleSgp\nOwogICAgICAgICAgICBpZiAobnVsbCA9PSBmKSB7CiAgICAgICAgICAgICAg\nICBmID0gIk5VTEwiOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFN0cmlu\nZyB2YWx1ZTsKICAgICAgICAgICAgaWYgKG51bGwgPT0gZW50cnkuZ2V0VmFs\ndWUoKSkgewogICAgICAgICAgICAgICAgdmFsdWUgPSAiTk9ORSI7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IG5ldyBT\ndHJpbmcoZW50cnkuZ2V0VmFsdWUoKSwgVVRGXzgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHNiLmFwcGVuZCgiKCciKS5hcHBlbmQoZikuYXBwZW5k\nKCInPSIpLmFwcGVuZCh2YWx1ZSkuYXBwZW5kKCIpIik7CiAgICAgICAgfQog\nICAgICAgIHNiLmFwcGVuZCgiXSIpOwogICAgICAgIHJldHVybiBzYi50b1N0\ncmluZygpOwogICAgfQp9Cg==\n","encoding":"base64"}

