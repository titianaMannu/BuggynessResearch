{"sha":"26abc96159f85bbf0fddaaaee0a984a161ddbdce","node_id":"MDQ6QmxvYjE1NzU5NTY6MjZhYmM5NjE1OWY4NWJiZjBmZGRhYWFlZTBhOTg0YTE2MWRkYmRjZQ==","size":32177,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/26abc96159f85bbf0fddaaaee0a984a161ddbdce","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KLy8g\nVGhpcyBjb2RlIGhhcyBiZWVuIGNvcGllZCBmcm9tIGhhZG9vcC1jb21tb24g\nMC4yMy4xCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLm5ldDsKCmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGph\ndmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlJhbmRvbTsKaW1wb3J0\nIGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5s\nb2Nrcy5SZWFkV3JpdGVMb2NrOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJl\nbnQubG9ja3MuUmVlbnRyYW50UmVhZFdyaXRlTG9jazsKCmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7\nCgovKioKICogVGhlIGNsYXNzIHJlcHJlc2VudHMgYSBjbHVzdGVyIG9mIGNv\nbXB1dGVyIHdpdGggYSB0cmVlIGhpZXJhcmNoaWNhbAogKiBuZXR3b3JrIHRv\ncG9sb2d5LgogKiBGb3IgZXhhbXBsZSwgYSBjbHVzdGVyIG1heSBiZSBjb25z\naXN0cyBvZiBtYW55IGRhdGEgY2VudGVycyBmaWxsZWQKICogd2l0aCByYWNr\ncyBvZiBjb21wdXRlcnMuCiAqIEluIGEgbmV0d29yayB0b3BvbG9neSwgbGVh\ndmVzIHJlcHJlc2VudCBkYXRhIG5vZGVzIChjb21wdXRlcnMpIGFuZCBpbm5l\ncgogKiBub2RlcyByZXByZXNlbnQgc3dpdGNoZXMvcm91dGVycyB0aGF0IG1h\nbmFnZSB0cmFmZmljIGluL291dCBvZiBkYXRhIGNlbnRlcnMKICogb3IgcmFj\na3MuCiAqCiAqLwpwdWJsaWMgY2xhc3MgTmV0d29ya1RvcG9sb2d5IHsKCiAg\nICBwdWJsaWMgZmluYWwgc3RhdGljIFN0cmluZyBERUZBVUxUX1JBQ0sgPSAi\nL2RlZmF1bHQtcmFjayI7CiAgICBwdWJsaWMgZmluYWwgc3RhdGljIGludCBE\nRUZBVUxUX0hPU1RfTEVWRUwgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTmV0d29y\na1RvcG9sb2d5LmNsYXNzKTsKCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIElu\ndmFsaWRUb3BvbG9neUV4Y2VwdGlvbiBleHRlbmRzIFJ1bnRpbWVFeGNlcHRp\nb24gewogICAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFs\nVmVyc2lvblVJRCA9IDFMOwoKICAgICAgICBwdWJsaWMgSW52YWxpZFRvcG9s\nb2d5RXhjZXB0aW9uKFN0cmluZyBtc2cpIHsKICAgICAgICAgICAgc3VwZXIo\nbXNnKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqIElubmVyTm9kZSByZXBy\nZXNlbnRzIGEgc3dpdGNoL3JvdXRlciBvZiBhIGRhdGEgY2VudGVyIG9yIHJh\nY2suCiAgICAgKiBEaWZmZXJlbnQgZnJvbSBhIGxlYWYgbm9kZSwgaXQgaGFz\nIG5vbi1udWxsIGNoaWxkcmVuLgogICAgICovCiAgICBzdGF0aWMgY2xhc3Mg\nSW5uZXJOb2RlIGV4dGVuZHMgTm9kZUJhc2UgewogICAgICAgIHByb3RlY3Rl\nZCBMaXN0PE5vZGU+IGNoaWxkcmVuID0gbmV3IEFycmF5TGlzdDxOb2RlPigp\nOwogICAgICAgIHByaXZhdGUgaW50IG51bU9mTGVhdmVzOwoKICAgICAgICAv\nKiogQ29uc3RydWN0IGFuIElubmVyTm9kZSBmcm9tIGEgcGF0aC1saWtlIHN0\ncmluZyAqLwogICAgICAgIElubmVyTm9kZShTdHJpbmcgcGF0aCkgewogICAg\nICAgICAgICBzdXBlcihwYXRoKTsKICAgICAgICB9CgogICAgICAgIC8qKiBD\nb25zdHJ1Y3QgYW4gSW5uZXJOb2RlIGZyb20gaXRzIG5hbWUgYW5kIGl0cyBu\nZXR3b3JrIGxvY2F0aW9uICovCiAgICAgICAgSW5uZXJOb2RlKFN0cmluZyBu\nYW1lLCBTdHJpbmcgbG9jYXRpb24pIHsKICAgICAgICAgICAgc3VwZXIobmFt\nZSwgbG9jYXRpb24pOwogICAgICAgIH0KCiAgICAgICAgLyoqIENvbnN0cnVj\ndCBhbiBJbm5lck5vZGUKICAgICAgICAgKiBmcm9tIGl0cyBuYW1lLCBpdHMg\nbmV0d29yayBsb2NhdGlvbiwgaXRzIHBhcmVudCwgYW5kIGl0cyBsZXZlbCAq\nLwogICAgICAgIElubmVyTm9kZShTdHJpbmcgbmFtZSwgU3RyaW5nIGxvY2F0\naW9uLCBJbm5lck5vZGUgcGFyZW50LCBpbnQgbGV2ZWwpIHsKICAgICAgICAg\nICAgc3VwZXIobmFtZSwgbG9jYXRpb24sIHBhcmVudCwgbGV2ZWwpOwogICAg\nICAgIH0KCiAgICAgICAgLyoqIEByZXR1cm4gaXRzIGNoaWxkcmVuICovCiAg\nICAgICAgTGlzdDxOb2RlPiBnZXRDaGlsZHJlbigpIHsKICAgICAgICAgICAg\ncmV0dXJuIGNoaWxkcmVuOwogICAgICAgIH0KCiAgICAgICAgLyoqIEByZXR1\ncm4gdGhlIG51bWJlciBvZiBjaGlsZHJlbiB0aGlzIG5vZGUgaGFzICovCiAg\nICAgICAgaW50IGdldE51bU9mQ2hpbGRyZW4oKSB7CiAgICAgICAgICAgIHJl\ndHVybiBjaGlsZHJlbi5zaXplKCk7CiAgICAgICAgfQoKICAgICAgICAvKiog\nSnVkZ2UgaWYgdGhpcyBub2RlIHJlcHJlc2VudHMgYSByYWNrCiAgICAgICAg\nICogQHJldHVybiB0cnVlIGlmIGl0IGhhcyBubyBjaGlsZCBvciBpdHMgY2hp\nbGRyZW4gYXJlIG5vdCBJbm5lck5vZGVzCiAgICAgICAgICovCiAgICAgICAg\nYm9vbGVhbiBpc1JhY2soKSB7CiAgICAgICAgICAgIGlmIChjaGlsZHJlbi5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBOb2RlIGZpcnN0Q2hpbGQgPSBjaGls\nZHJlbi5nZXQoMCk7CiAgICAgICAgICAgIGlmIChmaXJzdENoaWxkIGluc3Rh\nbmNlb2YgSW5uZXJOb2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0KCiAgICAgICAgLyoqIEp1ZGdlIGlmIHRoaXMgbm9kZSBpcyBh\nbiBhbmNlc3RvciBvZiBub2RlIDxpPm48L2k+CiAgICAgICAgICoKICAgICAg\nICAgKiBAcGFyYW0gbiBhIG5vZGUKICAgICAgICAgKiBAcmV0dXJuIHRydWUg\naWYgdGhpcyBub2RlIGlzIGFuIGFuY2VzdG9yIG9mIDxpPm48L2k+CiAgICAg\nICAgICovCiAgICAgICAgYm9vbGVhbiBpc0FuY2VzdG9yKE5vZGUgbikgewog\nICAgICAgICAgICByZXR1cm4gZ2V0UGF0aCh0aGlzKS5lcXVhbHMoTm9kZUJh\nc2UuUEFUSF9TRVBBUkFUT1JfU1RSKQogICAgICAgICAgICAgICAgICAgIHx8\nIChuLmdldE5ldHdvcmtMb2NhdGlvbigpICsgTm9kZUJhc2UuUEFUSF9TRVBB\nUkFUT1JfU1RSKS5zdGFydHNXaXRoKGdldFBhdGgodGhpcykKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICsgTm9kZUJhc2UuUEFUSF9TRVBBUkFUT1Jf\nU1RSKTsKICAgICAgICB9CgogICAgICAgIC8qKiBKdWRnZSBpZiB0aGlzIG5v\nZGUgaXMgdGhlIHBhcmVudCBvZiBub2RlIDxpPm48L2k+CiAgICAgICAgICoK\nICAgICAgICAgKiBAcGFyYW0gbiBhIG5vZGUKICAgICAgICAgKiBAcmV0dXJu\nIHRydWUgaWYgdGhpcyBub2RlIGlzIHRoZSBwYXJlbnQgb2YgPGk+bjwvaT4K\nICAgICAgICAgKi8KICAgICAgICBib29sZWFuIGlzUGFyZW50KE5vZGUgbikg\newogICAgICAgICAgICByZXR1cm4gbi5nZXROZXR3b3JrTG9jYXRpb24oKS5l\ncXVhbHMoZ2V0UGF0aCh0aGlzKSk7CiAgICAgICAgfQoKICAgICAgICAvKiBS\nZXR1cm4gYSBjaGlsZCBuYW1lIG9mIHRoaXMgbm9kZSB3aG8gaXMgYW4gYW5j\nZXN0b3Igb2Ygbm9kZSA8aT5uPC9pPiAqLwogICAgICAgIHByaXZhdGUgU3Ry\naW5nIGdldE5leHRBbmNlc3Rvck5hbWUoTm9kZSBuKSB7CiAgICAgICAgICAg\nIGlmICghaXNBbmNlc3RvcihuKSkgewogICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbih0aGlzICsgImlzIG5vdCBh\nbiBhbmNlc3RvciBvZiAiICsgbik7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgU3RyaW5nIG5hbWUgPSBuLmdldE5ldHdvcmtMb2NhdGlvbigpLnN1YnN0\ncmluZyhnZXRQYXRoKHRoaXMpLmxlbmd0aCgpKTsKICAgICAgICAgICAgaWYg\nKG5hbWUuY2hhckF0KDApID09IFBBVEhfU0VQQVJBVE9SKSB7CiAgICAgICAg\nICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgaW50IGluZGV4ID0gbmFtZS5pbmRleE9mKFBBVEhf\nU0VQQVJBVE9SKTsKICAgICAgICAgICAgaWYgKGluZGV4ICE9IC0xKQogICAg\nICAgICAgICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyaW5nKDAsIGluZGV4KTsK\nICAgICAgICAgICAgcmV0dXJuIG5hbWU7CiAgICAgICAgfQoKICAgICAgICAv\nKiogQWRkIG5vZGUgPGk+bjwvaT4gdG8gdGhlIHN1YnRyZWUgb2YgdGhpcyBu\nb2RlCiAgICAgICAgICogQHBhcmFtIG4gbm9kZSB0byBiZSBhZGRlZAogICAg\nICAgICAqIEByZXR1cm4gdHJ1ZSBpZiB0aGUgbm9kZSBpcyBhZGRlZDsgZmFs\nc2Ugb3RoZXJ3aXNlCiAgICAgICAgICovCiAgICAgICAgYm9vbGVhbiBhZGQo\nTm9kZSBuKSB7CiAgICAgICAgICAgIGlmICghaXNBbmNlc3RvcihuKSkKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRp\nb24obi5nZXROYW1lKCkgKyAiLCB3aGljaCBpcyBsb2NhdGVkIGF0ICIgKyBu\nLmdldE5ldHdvcmtMb2NhdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAg\nICsgIiwgaXMgbm90IGEgZGVjZW5kZW50IG9mICIgKyBnZXRQYXRoKHRoaXMp\nKTsKICAgICAgICAgICAgaWYgKGlzUGFyZW50KG4pKSB7CiAgICAgICAgICAg\nICAgICAvLyB0aGlzIG5vZGUgaXMgdGhlIHBhcmVudCBvZiBuOyBhZGQgbiBk\naXJlY3RseQogICAgICAgICAgICAgICAgbi5zZXRQYXJlbnQodGhpcyk7CiAg\nICAgICAgICAgICAgICBuLnNldExldmVsKHRoaXMubGV2ZWwgKyAxKTsKICAg\nICAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2hpbGRyZW4uc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGRyZW4u\nZ2V0KGkpLmdldE5hbWUoKS5lcXVhbHMobi5nZXROYW1lKCkpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnNldChpLCBuKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNo\naWxkcmVuLmFkZChuKTsKICAgICAgICAgICAgICAgIG51bU9mTGVhdmVzKys7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIG5leHQgYW5jZXN0\nb3Igbm9kZQogICAgICAgICAgICAgICAgU3RyaW5nIHBhcmVudE5hbWUgPSBn\nZXROZXh0QW5jZXN0b3JOYW1lKG4pOwogICAgICAgICAgICAgICAgSW5uZXJO\nb2RlIHBhcmVudE5vZGUgPSBudWxsOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBjaGlsZHJlbi5zaXplKCk7IGkrKykgewogICAgICAg\nICAgICAgICAgICAgIGlmIChjaGlsZHJlbi5nZXQoaSkuZ2V0TmFtZSgpLmVx\ndWFscyhwYXJlbnROYW1lKSkgewogICAgICAgICAgICAgICAgICAgICAgICBw\nYXJlbnROb2RlID0gKElubmVyTm9kZSkgY2hpbGRyZW4uZ2V0KGkpOwogICAg\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocGFy\nZW50Tm9kZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gY3Jl\nYXRlIGEgbmV3IElubmVyTm9kZQogICAgICAgICAgICAgICAgICAgIHBhcmVu\ndE5vZGUgPSBjcmVhdGVQYXJlbnROb2RlKHBhcmVudE5hbWUpOwogICAgICAg\nICAgICAgICAgICAgIGNoaWxkcmVuLmFkZChwYXJlbnROb2RlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIGFkZCBuIHRvIHRoZSBz\ndWJ0cmVlIG9mIHRoZSBuZXh0IGFuY2VzdG9yIG5vZGUKICAgICAgICAgICAg\nICAgIGlmIChwYXJlbnROb2RlLmFkZChuKSkgewogICAgICAgICAgICAgICAg\nICAgIG51bU9mTGVhdmVzKys7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nIHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogQ3Jl\nYXRlcyBhIHBhcmVudCBub2RlIHRvIGJlIGFkZGVkIHRvIHRoZSBsaXN0IG9m\nIGNoaWxkcmVuLgogICAgICAgICAqIENyZWF0ZXMgYSBub2RlIHVzaW5nIHRo\nZSBJbm5lck5vZGUgZm91ciBhcmd1bWVudCBjb25zdHJ1Y3RvciBzcGVjaWZ5\naW5nCiAgICAgICAgICogdGhlIG5hbWUsIGxvY2F0aW9uLCBwYXJlbnQsIGFu\nZCBsZXZlbCBvZiB0aGlzIG5vZGUuCiAgICAgICAgICoKICAgICAgICAgKiA8\ncD5UbyBiZSBvdmVycmlkZGVuIGluIHN1YmNsYXNzZXMgZm9yIHNwZWNpZmlj\nIElubmVyTm9kZSBpbXBsZW1lbnRhdGlvbnMsCiAgICAgICAgICogYXMgYWx0\nZXJuYXRpdmUgdG8gb3ZlcnJpZGluZyB0aGUgZnVsbCB7QGxpbmsgI2FkZChO\nb2RlKX0gbWV0aG9kLgogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIHBh\ncmVudE5hbWUgVGhlIG5hbWUgb2YgdGhlIHBhcmVudCBub2RlCiAgICAgICAg\nICogQHJldHVybiBBIG5ldyBpbm5lciBub2RlCiAgICAgICAgICogQHNlZSBJ\nbm5lck5vZGUjSW5uZXJOb2RlKFN0cmluZywgU3RyaW5nLCBJbm5lck5vZGUs\nIGludCkKICAgICAgICAgKi8KICAgICAgICBwcm90ZWN0ZWQgSW5uZXJOb2Rl\nIGNyZWF0ZVBhcmVudE5vZGUoU3RyaW5nIHBhcmVudE5hbWUpIHsKICAgICAg\nICAgICAgcmV0dXJuIG5ldyBJbm5lck5vZGUocGFyZW50TmFtZSwgZ2V0UGF0\naCh0aGlzKSwgdGhpcywgdGhpcy5nZXRMZXZlbCgpICsgMSk7CiAgICAgICAg\nfQoKICAgICAgICAvKiogUmVtb3ZlIG5vZGUgPGk+bjwvaT4gZnJvbSB0aGUg\nc3VidHJlZSBvZiB0aGlzIG5vZGUKICAgICAgICAgKiBAcGFyYW0gbiBub2Rl\nIHRvIGJlIGRlbGV0ZWQKICAgICAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhl\nIG5vZGUgaXMgZGVsZXRlZDsgZmFsc2Ugb3RoZXJ3aXNlCiAgICAgICAgICov\nCiAgICAgICAgYm9vbGVhbiByZW1vdmUoTm9kZSBuKSB7CiAgICAgICAgICAg\nIFN0cmluZyBwYXJlbnQgPSBuLmdldE5ldHdvcmtMb2NhdGlvbigpOwogICAg\nICAgICAgICBTdHJpbmcgY3VycmVudFBhdGggPSBnZXRQYXRoKHRoaXMpOwog\nICAgICAgICAgICBpZiAoIWlzQW5jZXN0b3IobikpCiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKG4uZ2V0TmFt\nZSgpICsgIiwgd2hpY2ggaXMgbG9jYXRlZCBhdCAiICsgcGFyZW50CiAgICAg\nICAgICAgICAgICAgICAgICAgICsgIiwgaXMgbm90IGEgZGVzY2VuZGVudCBv\nZiAiICsgY3VycmVudFBhdGgpOwogICAgICAgICAgICBpZiAoaXNQYXJlbnQo\nbikpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMgbm9kZSBpcyB0aGUgcGFy\nZW50IG9mIG47IHJlbW92ZSBuIGRpcmVjdGx5CiAgICAgICAgICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGNoaWxkcmVuLnNpemUoKTsgaSsrKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmdldChpKS5nZXROYW1l\nKCkuZXF1YWxzKG4uZ2V0TmFtZSgpKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBjaGlsZHJlbi5yZW1vdmUoaSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIG51bU9mTGVhdmVzLS07CiAgICAgICAgICAgICAgICAgICAgICAgIG4u\nc2V0UGFyZW50KG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBuZXh0IGFu\nY2VzdG9yIG5vZGU6IHRoZSBwYXJlbnQgbm9kZQogICAgICAgICAgICAgICAg\nU3RyaW5nIHBhcmVudE5hbWUgPSBnZXROZXh0QW5jZXN0b3JOYW1lKG4pOwog\nICAgICAgICAgICAgICAgSW5uZXJOb2RlIHBhcmVudE5vZGUgPSBudWxsOwog\nICAgICAgICAgICAgICAgaW50IGk7CiAgICAgICAgICAgICAgICBmb3IgKGkg\nPSAwOyBpIDwgY2hpbGRyZW4uc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoY2hpbGRyZW4uZ2V0KGkpLmdldE5hbWUoKS5lcXVhbHMo\ncGFyZW50TmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50\nTm9kZSA9IChJbm5lck5vZGUpIGNoaWxkcmVuLmdldChpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHBhcmVudE5v\nZGUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxz\nZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHJlbW92\nZSBuIGZyb20gdGhlIHBhcmVudCBub2RlCiAgICAgICAgICAgICAgICBib29s\nZWFuIGlzUmVtb3ZlZCA9IHBhcmVudE5vZGUucmVtb3ZlKG4pOwogICAgICAg\nICAgICAgICAgLy8gaWYgdGhlIHBhcmVudCBub2RlIGhhcyBubyBjaGlsZHJl\nbiwgcmVtb3ZlIHRoZSBwYXJlbnQgbm9kZSB0b28KICAgICAgICAgICAgICAg\nIGlmIChpc1JlbW92ZWQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocGFy\nZW50Tm9kZS5nZXROdW1PZkNoaWxkcmVuKCkgPT0gMCkgewogICAgICAgICAg\nICAgICAgICAgICAgICBjaGlsZHJlbi5yZW1vdmUoaSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIG51bU9mTGVhdmVzLS07\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gaXNS\nZW1vdmVkOwogICAgICAgICAgICB9CiAgICAgICAgfSAvLyBlbmQgb2YgcmVt\nb3ZlCgogICAgICAgIC8qKiBHaXZlbiBhIG5vZGUncyBzdHJpbmcgcmVwcmVz\nZW50YXRpb24sIHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgbm9kZQogICAg\nICAgICAqIEBwYXJhbSBsb2Mgc3RyaW5nIGxvY2F0aW9uIG9mIHRoZSBmb3Jt\nIC9yYWNrL25vZGUKICAgICAgICAgKiBAcmV0dXJuIG51bGwgaWYgdGhlIG5v\nZGUgaXMgbm90IGZvdW5kIG9yIHRoZSBjaGlsZG5vZGUgaXMgdGhlcmUgYnV0\nCiAgICAgICAgICogbm90IGFuIGluc3RhbmNlIG9mIHtAbGluayBJbm5lck5v\nZGV9CiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSBOb2RlIGdldExvYyhT\ndHJpbmcgbG9jKSB7CiAgICAgICAgICAgIGlmIChsb2MgPT0gbnVsbCB8fCBs\nb2MubGVuZ3RoKCkgPT0gMCkKICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwoKICAgICAgICAgICAgU3RyaW5nW10gcGF0aCA9IGxvYy5zcGxpdChQQVRI\nX1NFUEFSQVRPUl9TVFIsIDIpOwogICAgICAgICAgICBOb2RlIGNoaWxkbm9k\nZSA9IG51bGw7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgY2hp\nbGRyZW4uc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChjaGls\nZHJlbi5nZXQoaSkuZ2V0TmFtZSgpLmVxdWFscyhwYXRoWzBdKSkgewogICAg\nICAgICAgICAgICAgICAgIGNoaWxkbm9kZSA9IGNoaWxkcmVuLmdldChpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoY2hpbGRub2RlID09IG51bGwpCiAgICAgICAgICAgICAgICByZXR1cm4g\nbnVsbDsgLy8gbm9uLWV4aXN0aW5nIG5vZGUKICAgICAgICAgICAgaWYgKHBh\ndGgubGVuZ3RoID09IDEpCiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGRu\nb2RlOwogICAgICAgICAgICBpZiAoY2hpbGRub2RlIGluc3RhbmNlb2YgSW5u\nZXJOb2RlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKChJbm5lck5vZGUp\nIGNoaWxkbm9kZSkuZ2V0TG9jKHBhdGhbMV0pOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIC8qKiBnZXQgPGk+bGVhZkluZGV4PC9p\nPiBsZWFmIG9mIHRoaXMgc3VidHJlZQogICAgICAgICAqIGlmIGl0IGlzIG5v\ndCBpbiB0aGUgPGk+ZXhjbHVkZWROb2RlPC9pPgogICAgICAgICAqCiAgICAg\nICAgICogQHBhcmFtIGxlYWZJbmRleCBhbiBpbmRleGVkIGxlYWYgb2YgdGhl\nIG5vZGUKICAgICAgICAgKiBAcGFyYW0gZXhjbHVkZWROb2RlIGFuIGV4Y2x1\nZGVkIG5vZGUgKGNhbiBiZSBudWxsKQogICAgICAgICAqIEByZXR1cm4KICAg\nICAgICAgKi8KICAgICAgICBOb2RlIGdldExlYWYoaW50IGxlYWZJbmRleCwg\nTm9kZSBleGNsdWRlZE5vZGUpIHsKICAgICAgICAgICAgaW50IGNvdW50ID0g\nMDsKICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlIGV4Y2x1ZGVkIG5vZGUg\nYSBsZWFmCiAgICAgICAgICAgIGJvb2xlYW4gaXNMZWFmID0gZXhjbHVkZWRO\nb2RlID09IG51bGwgfHwgIShleGNsdWRlZE5vZGUgaW5zdGFuY2VvZiBJbm5l\nck5vZGUpOwogICAgICAgICAgICAvLyBjYWxjdWxhdGUgdGhlIHRvdGFsIG51\nbWJlciBvZiBleGNsdWRlZCBsZWFmIG5vZGVzCiAgICAgICAgICAgIGludCBu\ndW1PZkV4Y2x1ZGVkTGVhdmVzID0gaXNMZWFmID8gMSA6ICgoSW5uZXJOb2Rl\nKSBleGNsdWRlZE5vZGUpLmdldE51bU9mTGVhdmVzKCk7CiAgICAgICAgICAg\nIGlmIChpc0xlYWZQYXJlbnQoKSkgeyAvLyBjaGlsZHJlbiBhcmUgbGVhdmVz\nCiAgICAgICAgICAgICAgICBpZiAoaXNMZWFmKSB7IC8vIGV4Y2x1ZGVkIG5v\nZGUgaXMgYSBsZWFmIG5vZGUKICAgICAgICAgICAgICAgICAgICBpbnQgZXhj\nbHVkZWRJbmRleCA9IGNoaWxkcmVuLmluZGV4T2YoZXhjbHVkZWROb2RlKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZXhjbHVkZWRJbmRleCAhPSAtMSAm\nJiBsZWFmSW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBleGNsdWRlZCBub2RlIGlzIG9uZSBvZiB0aGUgY2hpbGRyZW4gc28gYWRq\ndXN0IHRoZSBsZWFmIGluZGV4CiAgICAgICAgICAgICAgICAgICAgICAgIGxl\nYWZJbmRleCA9IGxlYWZJbmRleCA+PSBleGNsdWRlZEluZGV4ID8gbGVhZklu\nZGV4ICsgMSA6IGxlYWZJbmRleDsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyByYW5nZSBjaGVj\nawogICAgICAgICAgICAgICAgaWYgKGxlYWZJbmRleCA8IDAgfHwgbGVhZklu\nZGV4ID49IHRoaXMuZ2V0TnVtT2ZDaGlsZHJlbigpKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICByZXR1cm4gY2hpbGRyZW4uZ2V0KGxlYWZJbmRleCk7CiAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGNoaWxkcmVuLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgSW5uZXJOb2RlIGNoaWxkID0gKElubmVyTm9kZSkgY2hpbGRy\nZW4uZ2V0KGkpOwogICAgICAgICAgICAgICAgICAgIGlmIChleGNsdWRlZE5v\nZGUgPT0gbnVsbCB8fCBleGNsdWRlZE5vZGUgIT0gY2hpbGQpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gbm90IHRoZSBleGNsdWRlZE5vZGUKICAg\nICAgICAgICAgICAgICAgICAgICAgaW50IG51bU9mTGVhdmVzID0gY2hpbGQu\nZ2V0TnVtT2ZMZWF2ZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGV4Y2x1ZGVkTm9kZSAhPSBudWxsICYmIGNoaWxkLmlzQW5jZXN0b3IoZXhj\nbHVkZWROb2RlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVt\nT2ZMZWF2ZXMgLT0gbnVtT2ZFeGNsdWRlZExlYXZlczsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291\nbnQgKyBudW1PZkxlYXZlcyA+IGxlYWZJbmRleCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gdGhlIGxlYWYgaXMgaW4gdGhlIGNoaWxkIHN1\nYnRyZWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGls\nZC5nZXRMZWFmKGxlYWZJbmRleCAtIGNvdW50LCBleGNsdWRlZE5vZGUpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gZ28gdG8gdGhlIG5leHQgY2hpbGQKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNvdW50ID0gY291bnQgKyBudW1PZkxl\nYXZlczsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7IC8vIGl0IGlzIHRoZSBleGNsdWVkZWROb2RlCiAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIHNraXAgaXQgYW5kIHNldCB0aGUg\nZXhjbHVkZWROb2RlIHRvIGJlIG51bGwKICAgICAgICAgICAgICAgICAgICAg\nICAgZXhjbHVkZWROb2RlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVk\nIGJvb2xlYW4gaXNMZWFmUGFyZW50KCkgewogICAgICAgICAgICByZXR1cm4g\naXNSYWNrKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgICog\nRGV0ZXJtaW5lIGlmIGNoaWxkcmVuIGEgbGVhdmVzLCBkZWZhdWx0IGltcGxl\nbWVudGF0aW9uIGNhbGxzIHtAbGluayAjaXNSYWNrKCl9CiAgICAgICAgICAq\nIDxwPlRvIGJlIG92ZXJyaWRkZW4gaW4gc3ViY2xhc3NlcyBmb3Igc3BlY2lm\naWMgSW5uZXJOb2RlIGltcGxlbWVudGF0aW9ucywKICAgICAgICAgICogYXMg\nYWx0ZXJuYXRpdmUgdG8gb3ZlcnJpZGluZyB0aGUgZnVsbCB7QGxpbmsgI2dl\ndExlYWYoaW50LCBOb2RlKX0gbWV0aG9kLgogICAgICAgICAgKgogICAgICAg\nICAgKiBAcmV0dXJuIHRydWUgaWYgY2hpbGRyZW4gYXJlIGxlYXZlcywgZmFs\nc2Ugb3RoZXJ3aXNlCiAgICAgICAgICAqLwogICAgICAgIHByb3RlY3RlZCBi\nb29sZWFuIGFyZUNoaWxkcmVuTGVhdmVzKCkgewogICAgICAgICAgICByZXR1\ncm4gaXNSYWNrKCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBHZXQgbnVtYmVyIG9mIGxlYXZlcy4KICAgICAgICAgKi8KICAgICAgICBp\nbnQgZ2V0TnVtT2ZMZWF2ZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBudW1P\nZkxlYXZlczsKICAgICAgICB9CiAgICB9IC8vIGVuZCBvZiBJbm5lck5vZGUK\nCiAgICAvKioKICAgICAqIHRoZSByb290IGNsdXN0ZXIgbWFwCiAgICAgKi8K\nICAgIElubmVyTm9kZSBjbHVzdGVyTWFwOwogICAgLyoqIERlcHRoIG9mIGFs\nbCBsZWFmIG5vZGVzICovCiAgICBwcml2YXRlIGludCBkZXB0aE9mQWxsTGVh\ndmVzID0gLTE7CiAgICAvKiogcmFjayBjb3VudGVyICovCiAgICBwcm90ZWN0\nZWQgaW50IG51bU9mUmFja3MgPSAwOwogICAgLyoqIHRoZSBsb2NrIHVzZWQg\ndG8gbWFuYWdlIGFjY2VzcyAqLwogICAgcHJvdGVjdGVkIFJlYWRXcml0ZUxv\nY2sgbmV0bG9jayA9IG5ldyBSZWVudHJhbnRSZWFkV3JpdGVMb2NrKCk7Cgog\nICAgcHVibGljIE5ldHdvcmtUb3BvbG9neSgpIHsKICAgICAgICBjbHVzdGVy\nTWFwID0gbmV3IElubmVyTm9kZShJbm5lck5vZGUuUk9PVCk7CiAgICB9Cgog\nICAgLyoqIEFkZCBhIGxlYWYgbm9kZQogICAgICogVXBkYXRlIG5vZGUgY291\nbnRlciAmIHJhY2sgY291bnRlciBpZiBuZWNlc3NhcnkKICAgICAqIEBwYXJh\nbSBub2RlIG5vZGUgdG8gYmUgYWRkZWQ7IGNhbiBiZSBudWxsCiAgICAgKiBA\nZXhjZXB0aW9uIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpZiBhZGQgYSBu\nb2RlIHRvIGEgbGVhdmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG9yIG5vZGUgdG8gYmUgYWRkZWQgaXMgbm90IGEgbGVh\nZgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhZGQoTm9kZSBub2RlKSB7CiAg\nICAgICAgaWYgKG5vZGUgPT0gbnVsbCkKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIFN0cmluZyBvbGRUb3BvU3RyID0gdGhpcy50b1N0cmluZygpOwog\nICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgSW5uZXJOb2RlKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIk5v\ndCBhbGxvdyB0byBhZGQgYW4gaW5uZXIgbm9kZTogIiArIE5vZGVCYXNlLmdl\ndFBhdGgobm9kZSkpOwogICAgICAgIH0KICAgICAgICBpbnQgbmV3RGVwdGgg\nPSBOb2RlQmFzZS5sb2NhdGlvblRvRGVwdGgobm9kZS5nZXROZXR3b3JrTG9j\nYXRpb24oKSkgKyAxOwogICAgICAgIG5ldGxvY2sud3JpdGVMb2NrKCkubG9j\naygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmICgoZGVwdGhPZkFs\nbExlYXZlcyAhPSAtMSkgJiYgKGRlcHRoT2ZBbGxMZWF2ZXMgIT0gbmV3RGVw\ndGgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yOiBjYW4n\ndCBhZGQgbGVhZiBub2RlIGF0IGRlcHRoICIgKyBuZXdEZXB0aCArICIgdG8g\ndG9wb2xvZ3k6XG4iICsgb2xkVG9wb1N0cik7CiAgICAgICAgICAgICAgICB0\naHJvdyBuZXcgSW52YWxpZFRvcG9sb2d5RXhjZXB0aW9uKCJJbnZhbGlkIG5l\ndHdvcmsgdG9wb2xvZ3kuICIKICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nWW91IGNhbm5vdCBoYXZlIGEgcmFjayBhbmQgYSBub24tcmFjayBub2RlIGF0\nIHRoZSBzYW1lIGxldmVsIG9mIHRoZSBuZXR3b3JrIHRvcG9sb2d5LiIpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIE5vZGUgcmFjayA9IGdldE5vZGVG\nb3JOZXR3b3JrTG9jYXRpb24obm9kZSk7CiAgICAgICAgICAgIGlmIChyYWNr\nICE9IG51bGwgJiYgIShyYWNrIGluc3RhbmNlb2YgSW5uZXJOb2RlKSkgewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbigiVW5leHBlY3RlZCBkYXRhIG5vZGUgIiArIG5vZGUudG9TdHJpbmco\nKQogICAgICAgICAgICAgICAgICAgICAgICArICIgYXQgYW4gaWxsZWdhbCBu\nZXR3b3JrIGxvY2F0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naWYgKGNsdXN0ZXJNYXAuYWRkKG5vZGUpKSB7CiAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiQWRkaW5nIGEgbmV3IG5vZGU6ICIgKyBOb2RlQmFzZS5nZXRQ\nYXRoKG5vZGUpKTsKICAgICAgICAgICAgICAgIGlmIChyYWNrID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBudW1PZlJhY2tzKys7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIShub2RlIGluc3RhbmNl\nb2YgSW5uZXJOb2RlKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChkZXB0\naE9mQWxsTGVhdmVzID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGRlcHRoT2ZBbGxMZWF2ZXMgPSBub2RlLmdldExldmVsKCk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJOZXR3b3JrVG9wb2xvZ3kgYmVjYW1l\nOlxuIiArIHRoaXMudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBuZXRsb2NrLndyaXRlTG9jaygp\nLnVubG9jaygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJl\ndHVybiBhIHJlZmVyZW5jZSB0byB0aGUgbm9kZSBnaXZlbiBpdHMgc3RyaW5n\nIHJlcHJlc2VudGF0aW9uLgogICAgICogRGVmYXVsdCBpbXBsZW1lbnRhdGlv\nbiBkZWxlZ2F0ZXMgdG8ge0BsaW5rICNnZXROb2RlKFN0cmluZyl9LgogICAg\nICoKICAgICAqIDxwPlRvIGJlIG92ZXJyaWRkZW4gaW4gc3ViY2xhc3NlcyBm\nb3Igc3BlY2lmaWMgTmV0d29ya1RvcG9sb2d5CiAgICAgKiBpbXBsZW1lbnRh\ndGlvbnMsIGFzIGFsdGVybmF0aXZlIHRvIG92ZXJyaWRpbmcgdGhlIGZ1bGwg\ne0BsaW5rICNhZGQoTm9kZSl9CiAgICAgKiAgbWV0aG9kLgogICAgICoKICAg\nICAqIEBwYXJhbSBub2RlIFRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2Yg\ndGhpcyBub2RlJ3MgbmV0d29yayBsb2NhdGlvbiBpcwogICAgICogdXNlZCB0\nbyByZXRyaWV2ZSBhIE5vZGUgb2JqZWN0LgogICAgICogQHJldHVybiBhIHJl\nZmVyZW5jZSB0byB0aGUgbm9kZTsgbnVsbCBpZiB0aGUgbm9kZSBpcyBub3Qg\naW4gdGhlIHRyZWUKICAgICAqCiAgICAgKiBAc2VlICNhZGQoTm9kZSkKICAg\nICAqIEBzZWUgI2dldE5vZGUoU3RyaW5nKQogICAgICovCiAgICBwcm90ZWN0\nZWQgTm9kZSBnZXROb2RlRm9yTmV0d29ya0xvY2F0aW9uKE5vZGUgbm9kZSkg\newogICAgICAgIHJldHVybiBnZXROb2RlKG5vZGUuZ2V0TmV0d29ya0xvY2F0\naW9uKCkpOwogICAgfQoKICAgIC8qKgogICAgICogR2l2ZW4gYSBzdHJpbmcg\ncmVwcmVzZW50YXRpb24gb2YgYSByYWNrLCByZXR1cm4gaXRzIGNoaWxkcmVu\nCiAgICAgKiBAcGFyYW0gbG9jIGEgcGF0aC1saWtlIHN0cmluZyByZXByZXNl\nbnRhdGlvbiBvZiBhIHJhY2sKICAgICAqIEByZXR1cm4gYSBuZXdseSBhbGxv\nY2F0ZWQgbGlzdCB3aXRoIGFsbCB0aGUgbm9kZSdzIGNoaWxkcmVuCiAgICAg\nKi8KICAgIHB1YmxpYyBMaXN0PE5vZGU+IGdldERhdGFub2Rlc0luUmFjayhT\ndHJpbmcgbG9jKSB7CiAgICAgICAgbmV0bG9jay5yZWFkTG9jaygpLmxvY2so\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBsb2MgPSBOb2RlQmFzZS5u\nb3JtYWxpemUobG9jKTsKICAgICAgICAgICAgaWYgKCFOb2RlQmFzZS5ST09U\nLmVxdWFscyhsb2MpKSB7CiAgICAgICAgICAgICAgICBsb2MgPSBsb2Muc3Vi\nc3RyaW5nKDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIElubmVyTm9k\nZSByYWNrID0gKElubmVyTm9kZSkgY2x1c3Rlck1hcC5nZXRMb2MobG9jKTsK\nICAgICAgICAgICAgaWYgKHJhY2sgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIG5ldyBBcnJheUxpc3Q8Tm9kZT4ocmFjay5nZXRDaGlsZHJlbigpKTsK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBuZXRsb2NrLnJlYWRM\nb2NrKCkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKiBSZW1v\ndmUgYSBub2RlCiAgICAgKiBVcGRhdGUgbm9kZSBjb3VudGVyIGFuZCByYWNr\nIGNvdW50ZXIgaWYgbmVjZXNzYXJ5CiAgICAgKiBAcGFyYW0gbm9kZSBub2Rl\nIHRvIGJlIHJlbW92ZWQ7IGNhbiBiZSBudWxsCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHJlbW92ZShOb2RlIG5vZGUpIHsKICAgICAgICBpZiAobm9kZSA9\nPSBudWxsKQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgaWYgKG5vZGUg\naW5zdGFuY2VvZiBJbm5lck5vZGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiTm90IGFsbG93IHRvIHJlbW92\nZSBhbiBpbm5lciBub2RlOiAiICsgTm9kZUJhc2UuZ2V0UGF0aChub2RlKSk7\nCiAgICAgICAgfQogICAgICAgIExPRy5pbmZvKCJSZW1vdmluZyBhIG5vZGU6\nICIgKyBOb2RlQmFzZS5nZXRQYXRoKG5vZGUpKTsKICAgICAgICBuZXRsb2Nr\nLndyaXRlTG9jaygpLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBpZiAoY2x1c3Rlck1hcC5yZW1vdmUobm9kZSkpIHsKICAgICAgICAgICAg\nICAgIElubmVyTm9kZSByYWNrID0gKElubmVyTm9kZSkgZ2V0Tm9kZShub2Rl\nLmdldE5ldHdvcmtMb2NhdGlvbigpKTsKICAgICAgICAgICAgICAgIGlmIChy\nYWNrID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBudW1PZlJhY2tz\nLS07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIk5ldHdvcmtUb3BvbG9neSBiZWNhbWU6XG4iICsgdGhp\ncy50b1N0cmluZygpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIG5ldGxvY2sud3JpdGVMb2NrKCkudW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKiBDaGVjayBpZiB0aGUgdHJlZSBj\nb250YWlucyBub2RlIDxpPm5vZGU8L2k+CiAgICAgKgogICAgICogQHBhcmFt\nIG5vZGUgYSBub2RlCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgPGk+bm9kZTwv\naT4gaXMgYWxyZWFkeSBpbiB0aGUgdHJlZTsgZmFsc2Ugb3RoZXJ3aXNlCiAg\nICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zKE5vZGUgbm9kZSkg\newogICAgICAgIGlmIChub2RlID09IG51bGwpCiAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICBuZXRsb2NrLnJlYWRMb2NrKCkubG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIE5vZGUgcGFyZW50ID0gbm9kZS5n\nZXRQYXJlbnQoKTsKICAgICAgICAgICAgZm9yIChpbnQgbGV2ZWwgPSBub2Rl\nLmdldExldmVsKCk7IHBhcmVudCAhPSBudWxsICYmIGxldmVsID4gMDsgcGFy\nZW50ID0gcGFyZW50LmdldFBhcmVudCgpLCBsZXZlbC0tKSB7CiAgICAgICAg\nICAgICAgICBpZiAocGFyZW50ID09IGNsdXN0ZXJNYXApIHsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIG5l\ndGxvY2sucmVhZExvY2soKS51bmxvY2soKTsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKiBHaXZlbiBhIHN0cmluZyBy\nZXByZXNlbnRhdGlvbiBvZiBhIG5vZGUsIHJldHVybiBpdHMgcmVmZXJlbmNl\nCiAgICAgKgogICAgICogQHBhcmFtIGxvYwogICAgICogICAgICAgICAgYSBw\nYXRoLWxpa2Ugc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIGEgbm9kZQogICAg\nICogQHJldHVybiBhIHJlZmVyZW5jZSB0byB0aGUgbm9kZTsgbnVsbCBpZiB0\naGUgbm9kZSBpcyBub3QgaW4gdGhlIHRyZWUKICAgICAqLwogICAgcHVibGlj\nIE5vZGUgZ2V0Tm9kZShTdHJpbmcgbG9jKSB7CiAgICAgICAgbmV0bG9jay5y\nZWFkTG9jaygpLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBs\nb2MgPSBOb2RlQmFzZS5ub3JtYWxpemUobG9jKTsKICAgICAgICAgICAgaWYg\nKCFOb2RlQmFzZS5ST09ULmVxdWFscyhsb2MpKQogICAgICAgICAgICAgICAg\nbG9jID0gbG9jLnN1YnN0cmluZygxKTsKICAgICAgICAgICAgcmV0dXJuIGNs\ndXN0ZXJNYXAuZ2V0TG9jKGxvYyk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgbmV0bG9jay5yZWFkTG9jaygpLnVubG9jaygpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKiogR2l2ZW4gYSBzdHJpbmcgcmVwcmVzZW50YXRp\nb24gb2YgYSByYWNrIGZvciBhIHNwZWNpZmljIG5ldHdvcmsKICAgICAqICBs\nb2NhdGlvbgogICAgICoKICAgICAqIFRvIGJlIG92ZXJyaWRkZW4gaW4gc3Vi\nY2xhc3NlcyBmb3Igc3BlY2lmaWMgTmV0d29ya1RvcG9sb2d5CiAgICAgKiBp\nbXBsZW1lbnRhdGlvbnMsIGFzIGFsdGVybmF0aXZlIHRvIG92ZXJyaWRpbmcg\ndGhlIGZ1bGwKICAgICAqIHtAbGluayAjZ2V0UmFjayhTdHJpbmcpfSBtZXRo\nb2QuCiAgICAgKiBAcGFyYW0gbG9jCiAgICAgKiAgICAgICAgICBhIHBhdGgt\nbGlrZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgYSBuZXR3b3JrIGxvY2F0\naW9uCiAgICAgKiBAcmV0dXJuIGEgcmFjayBzdHJpbmcKICAgICAqLwogICAg\ncHVibGljIFN0cmluZyBnZXRSYWNrKFN0cmluZyBsb2MpIHsKICAgICAgICBy\nZXR1cm4gbG9jOwogICAgfQoKICAgIC8qKiBAcmV0dXJuIHRoZSB0b3RhbCBu\ndW1iZXIgb2YgcmFja3MgKi8KICAgIHB1YmxpYyBpbnQgZ2V0TnVtT2ZSYWNr\ncygpIHsKICAgICAgICBuZXRsb2NrLnJlYWRMb2NrKCkubG9jaygpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBudW1PZlJhY2tzOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIG5ldGxvY2sucmVhZExvY2so\nKS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqIEByZXR1cm4g\ndGhlIHRvdGFsIG51bWJlciBvZiBsZWFmIG5vZGVzICovCiAgICBwdWJsaWMg\naW50IGdldE51bU9mTGVhdmVzKCkgewogICAgICAgIG5ldGxvY2sucmVhZExv\nY2soKS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJu\nIGNsdXN0ZXJNYXAuZ2V0TnVtT2ZMZWF2ZXMoKTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBuZXRsb2NrLnJlYWRMb2NrKCkudW5sb2NrKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKiBSZXR1cm4gdGhlIGRpc3RhbmNl\nIGJldHdlZW4gdHdvIG5vZGVzCiAgICAgKiBJdCBpcyBhc3N1bWVkIHRoYXQg\ndGhlIGRpc3RhbmNlIGZyb20gb25lIG5vZGUgdG8gaXRzIHBhcmVudCBpcyAx\nCiAgICAgKiBUaGUgZGlzdGFuY2UgYmV0d2VlbiB0d28gbm9kZXMgaXMgY2Fs\nY3VsYXRlZCBieSBzdW1taW5nIHVwIHRoZWlyIGRpc3RhbmNlcwogICAgICog\ndG8gdGhlaXIgY2xvc2VzdCBjb21tb24gYW5jZXN0b3IuCiAgICAgKiBAcGFy\nYW0gbm9kZTEgb25lIG5vZGUKICAgICAqIEBwYXJhbSBub2RlMiBhbm90aGVy\nIG5vZGUKICAgICAqIEByZXR1cm4gdGhlIGRpc3RhbmNlIGJldHdlZW4gbm9k\nZTEgYW5kIG5vZGUyIHdoaWNoIGlzIHplcm8gaWYgdGhleSBhcmUgdGhlIHNh\nbWUKICAgICAqICBvciB7QGxpbmsgSW50ZWdlciNNQVhfVkFMVUV9IGlmIG5v\nZGUxIG9yIG5vZGUyIGRvIG5vdCBiZWxvbmcgdG8gdGhlIGNsdXN0ZXIKICAg\nICAqLwogICAgcHVibGljIGludCBnZXREaXN0YW5jZShOb2RlIG5vZGUxLCBO\nb2RlIG5vZGUyKSB7CiAgICAgICAgaWYgKG5vZGUxID09IG5vZGUyKSB7CiAg\nICAgICAgICAgIHJldHVybiAwOwogICAgICAgIH0KICAgICAgICBOb2RlIG4x\nID0gbm9kZTEsIG4yID0gbm9kZTI7CiAgICAgICAgaW50IGRpcyA9IDA7CiAg\nICAgICAgbmV0bG9jay5yZWFkTG9jaygpLmxvY2soKTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBpbnQgbGV2ZWwxID0gbm9kZTEuZ2V0TGV2ZWwoKSwg\nbGV2ZWwyID0gbm9kZTIuZ2V0TGV2ZWwoKTsKICAgICAgICAgICAgd2hpbGUg\nKG4xICE9IG51bGwgJiYgbGV2ZWwxID4gbGV2ZWwyKSB7CiAgICAgICAgICAg\nICAgICBuMSA9IG4xLmdldFBhcmVudCgpOwogICAgICAgICAgICAgICAgbGV2\nZWwxLS07CiAgICAgICAgICAgICAgICBkaXMrKzsKICAgICAgICAgICAgfQog\nICAgICAgICAgICB3aGlsZSAobjIgIT0gbnVsbCAmJiBsZXZlbDIgPiBsZXZl\nbDEpIHsKICAgICAgICAgICAgICAgIG4yID0gbjIuZ2V0UGFyZW50KCk7CiAg\nICAgICAgICAgICAgICBsZXZlbDItLTsKICAgICAgICAgICAgICAgIGRpcysr\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHdoaWxlIChuMSAhPSBudWxs\nICYmIG4yICE9IG51bGwgJiYgbjEuZ2V0UGFyZW50KCkgIT0gbjIuZ2V0UGFy\nZW50KCkpIHsKICAgICAgICAgICAgICAgIG4xID0gbjEuZ2V0UGFyZW50KCk7\nCiAgICAgICAgICAgICAgICBuMiA9IG4yLmdldFBhcmVudCgpOwogICAgICAg\nICAgICAgICAgZGlzICs9IDI7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBuZXRsb2NrLnJlYWRMb2NrKCkudW5sb2Nr\nKCk7CiAgICAgICAgfQogICAgICAgIGlmIChuMSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIExPRy53YXJuKCJUaGUgY2x1c3RlciBkb2VzIG5vdCBjb250YWlu\nIG5vZGU6ICIgKyBOb2RlQmFzZS5nZXRQYXRoKG5vZGUxKSk7CiAgICAgICAg\nICAgIHJldHVybiBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgICAgICB9CiAgICAg\nICAgaWYgKG4yID09IG51bGwpIHsKICAgICAgICAgICAgTE9HLndhcm4oIlRo\nZSBjbHVzdGVyIGRvZXMgbm90IGNvbnRhaW4gbm9kZTogIiArIE5vZGVCYXNl\nLmdldFBhdGgobm9kZTIpKTsKICAgICAgICAgICAgcmV0dXJuIEludGVnZXIu\nTUFYX1ZBTFVFOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZGlzICsgMjsK\nICAgIH0KCiAgICAvKiogQ2hlY2sgaWYgdHdvIG5vZGVzIGFyZSBvbiB0aGUg\nc2FtZSByYWNrCiAgICAgKiBAcGFyYW0gbm9kZTEgb25lIG5vZGUgKGNhbiBi\nZSBudWxsKQogICAgICogQHBhcmFtIG5vZGUyIGFub3RoZXIgbm9kZSAoY2Fu\nIGJlIG51bGwpCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgbm9kZTEgYW5kIG5v\nZGUyIGFyZSBvbiB0aGUgc2FtZSByYWNrOyBmYWxzZSBvdGhlcndpc2UKICAg\nICAqIEBleGNlcHRpb24gSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uIHdoZW4g\nZWl0aGVyIG5vZGUxIG9yIG5vZGUyIGlzIG51bGwsIG9yCiAgICAgKiBub2Rl\nMSBvciBub2RlMiBkbyBub3QgYmVsb25nIHRvIHRoZSBjbHVzdGVyCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzT25TYW1lUmFjayhOb2RlIG5vZGUx\nLCBOb2RlIG5vZGUyKSB7CiAgICAgICAgaWYgKG5vZGUxID09IG51bGwgfHwg\nbm9kZTIgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgfQoKICAgICAgICBuZXRsb2NrLnJlYWRMb2NrKCkubG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBpc1NhbWVQYXJlbnRz\nKG5vZGUxLCBub2RlMik7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgbmV0bG9jay5yZWFkTG9jaygpLnVubG9jaygpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIENoZWNrIGlmIG5ldHdvcmsgdG9wb2xvZ3kg\naXMgYXdhcmUgb2YgTm9kZUdyb3VwCiAgICAgKi8KICAgIHB1YmxpYyBib29s\nZWFuIGlzTm9kZUdyb3VwQXdhcmUoKSB7CiAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIGZhbHNlIGRpcmVjdGx5\nIGFzIG5vdCBhd2FyZSBvZiBOb2RlR3JvdXAsIHRvIGJlIG92ZXJyaWRlIGlu\nIHN1Yi1jbGFzcwogICAgICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc09uU2Ft\nZU5vZGVHcm91cChOb2RlIG5vZGUxLCBOb2RlIG5vZGUyKSB7CiAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyZSB0\naGUgcGFyZW50cyBvZiBlYWNoIG5vZGUgZm9yIGVxdWFsaXR5CiAgICAgKgog\nICAgICogPHA+VG8gYmUgb3ZlcnJpZGRlbiBpbiBzdWJjbGFzc2VzIGZvciBz\ncGVjaWZpYyBOZXR3b3JrVG9wb2xvZ3kKICAgICAqIGltcGxlbWVudGF0aW9u\ncywgYXMgYWx0ZXJuYXRpdmUgdG8gb3ZlcnJpZGluZyB0aGUgZnVsbAogICAg\nICoge0BsaW5rICNpc09uU2FtZVJhY2soTm9kZSwgTm9kZSl9IG1ldGhvZC4K\nICAgICAqCiAgICAgKiBAcGFyYW0gbm9kZTEgdGhlIGZpcnN0IG5vZGUgdG8g\nY29tcGFyZQogICAgICogQHBhcmFtIG5vZGUyIHRoZSBzZWNvbmQgbm9kZSB0\nbyBjb21wYXJlCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlaXIgcGFyZW50\ncyBhcmUgZXF1YWwsIGZhbHNlIG90aGVyd2lzZQogICAgICoKICAgICAqIEBz\nZWUgI2lzT25TYW1lUmFjayhOb2RlLCBOb2RlKQogICAgICovCiAgICBwcm90\nZWN0ZWQgYm9vbGVhbiBpc1NhbWVQYXJlbnRzKE5vZGUgbm9kZTEsIE5vZGUg\nbm9kZTIpIHsKICAgICAgICByZXR1cm4gbm9kZTEuZ2V0UGFyZW50KCkgPT0g\nbm9kZTIuZ2V0UGFyZW50KCk7CiAgICB9CgogICAgZmluYWwgcHJvdGVjdGVk\nIHN0YXRpYyBSYW5kb20gciA9IG5ldyBSYW5kb20oKTsKCiAgICAvKiogcmFu\nZG9tbHkgY2hvb3NlIG9uZSBub2RlIGZyb20gPGk+c2NvcGU8L2k+CiAgICAg\nKiBpZiBzY29wZSBzdGFydHMgd2l0aCB+LCBjaG9vc2Ugb25lIGZyb20gdGhl\nIGFsbCBub2RlcyBleGNlcHQgZm9yIHRoZQogICAgICogb25lcyBpbiA8aT5z\nY29wZTwvaT47IG90aGVyd2lzZSwgY2hvb3NlIG9uZSBmcm9tIDxpPnNjb3Bl\nPC9pPgogICAgICogQHBhcmFtIHNjb3BlIHJhbmdlIG9mIG5vZGVzIGZyb20g\nd2hpY2ggYSBub2RlIHdpbGwgYmUgY2hvc2VuCiAgICAgKiBAcmV0dXJuIHRo\nZSBjaG9zZW4gbm9kZQogICAgICovCiAgICBwdWJsaWMgTm9kZSBjaG9vc2VS\nYW5kb20oU3RyaW5nIHNjb3BlKSB7CiAgICAgICAgbmV0bG9jay5yZWFkTG9j\naygpLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoc2Nv\ncGUuc3RhcnRzV2l0aCgifiIpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nY2hvb3NlUmFuZG9tKE5vZGVCYXNlLlJPT1QsIHNjb3BlLnN1YnN0cmluZygx\nKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gY2hvb3NlUmFuZG9tKHNjb3BlLCBudWxsKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIG5ldGxvY2sucmVhZExv\nY2soKS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBO\nb2RlIGNob29zZVJhbmRvbShTdHJpbmcgc2NvcGUsIFN0cmluZyBleGNsdWRl\nZFNjb3BlKSB7CiAgICAgICAgaWYgKGV4Y2x1ZGVkU2NvcGUgIT0gbnVsbCkg\newogICAgICAgICAgICBpZiAoc2NvcGUuc3RhcnRzV2l0aChleGNsdWRlZFNj\nb3BlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgaWYgKCFleGNsdWRlZFNjb3BlLnN0YXJ0c1dp\ndGgoc2NvcGUpKSB7CiAgICAgICAgICAgICAgICBleGNsdWRlZFNjb3BlID0g\nbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBOb2RlIG5v\nZGUgPSBnZXROb2RlKHNjb3BlKTsKICAgICAgICBpZiAoIShub2RlIGluc3Rh\nbmNlb2YgSW5uZXJOb2RlKSkgewogICAgICAgICAgICByZXR1cm4gbm9kZTsK\nICAgICAgICB9CiAgICAgICAgSW5uZXJOb2RlIGlubmVyTm9kZSA9IChJbm5l\nck5vZGUpIG5vZGU7CiAgICAgICAgaW50IG51bU9mRGF0YW5vZGVzID0gaW5u\nZXJOb2RlLmdldE51bU9mTGVhdmVzKCk7CiAgICAgICAgaWYgKGV4Y2x1ZGVk\nU2NvcGUgPT0gbnVsbCkgewogICAgICAgICAgICBub2RlID0gbnVsbDsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICBub2RlID0gZ2V0Tm9kZShleGNs\ndWRlZFNjb3BlKTsKICAgICAgICAgICAgaWYgKCEobm9kZSBpbnN0YW5jZW9m\nIElubmVyTm9kZSkpIHsKICAgICAgICAgICAgICAgIG51bU9mRGF0YW5vZGVz\nIC09IDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBu\ndW1PZkRhdGFub2RlcyAtPSAoKElubmVyTm9kZSkgbm9kZSkuZ2V0TnVtT2ZM\nZWF2ZXMoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpbnQg\nbGVhdmVJbmRleCA9IHIubmV4dEludChudW1PZkRhdGFub2Rlcyk7CiAgICAg\nICAgcmV0dXJuIGlubmVyTm9kZS5nZXRMZWFmKGxlYXZlSW5kZXgsIG5vZGUp\nOwogICAgfQoKICAgIC8qKiByZXR1cm4gbGVhdmVzIGluIDxpPnNjb3BlPC9p\nPgogICAgICogQHBhcmFtIHNjb3BlIGEgcGF0aCBzdHJpbmcKICAgICAqIEBy\nZXR1cm4gbGVhdmVzIG5vZGVzIHVuZGVyIHNwZWNpZmljIHNjb3BlCiAgICAg\nKi8KICAgIHByaXZhdGUgU2V0PE5vZGU+IGRvR2V0TGVhdmVzKFN0cmluZyBz\nY29wZSkgewogICAgICAgIE5vZGUgbm9kZSA9IGdldE5vZGUoc2NvcGUpOwog\nICAgICAgIFNldDxOb2RlPiBsZWFmTm9kZXMgPSBuZXcgSGFzaFNldDxOb2Rl\nPigpOwogICAgICAgIGlmICghKG5vZGUgaW5zdGFuY2VvZiBJbm5lck5vZGUp\nKSB7CiAgICAgICAgICAgIGxlYWZOb2Rlcy5hZGQobm9kZSk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgSW5uZXJOb2RlIGlubmVyTm9kZSA9IChJ\nbm5lck5vZGUpIG5vZGU7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgaW5uZXJOb2RlLmdldE51bU9mTGVhdmVzKCk7IGkrKykgewogICAgICAg\nICAgICAgICAgbGVhZk5vZGVzLmFkZChpbm5lck5vZGUuZ2V0TGVhZihpLCBu\ndWxsKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGxlYWZOb2RlczsKICAgIH0KCiAgICBwdWJsaWMgU2V0PE5vZGU+IGdldExl\nYXZlcyhTdHJpbmcgc2NvcGUpIHsKICAgICAgICBuZXRsb2NrLnJlYWRMb2Nr\nKCkubG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGlmIChzY29w\nZS5zdGFydHNXaXRoKCJ+IikpIHsKICAgICAgICAgICAgICAgIFNldDxOb2Rl\nPiBhbGxOb2RlcyA9IGRvR2V0TGVhdmVzKE5vZGVCYXNlLlJPT1QpOwogICAg\nICAgICAgICAgICAgU2V0PE5vZGU+IGV4Y2x1ZGVOb2RlcyA9IGRvR2V0TGVh\ndmVzKHNjb3BlLnN1YnN0cmluZygxKSk7CiAgICAgICAgICAgICAgICBhbGxO\nb2Rlcy5yZW1vdmVBbGwoZXhjbHVkZU5vZGVzKTsKICAgICAgICAgICAgICAg\nIHJldHVybiBhbGxOb2RlczsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBkb0dldExlYXZlcyhzY29wZSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBuZXRsb2Nr\nLnJlYWRMb2NrKCkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKiByZXR1cm4gdGhlIG51bWJlciBvZiBsZWF2ZXMgaW4gPGk+c2NvcGU8L2k+\nIGJ1dCBub3QgaW4gPGk+ZXhjbHVkZWROb2RlczwvaT4KICAgICAqIGlmIHNj\nb3BlIHN0YXJ0cyB3aXRoIH4sIHJldHVybiB0aGUgbnVtYmVyIG9mIG5vZGVz\nIHRoYXQgYXJlIG5vdAogICAgICogaW4gPGk+c2NvcGU8L2k+IGFuZCA8aT5l\neGNsdWRlZE5vZGVzPC9pPjsKICAgICAqIEBwYXJhbSBzY29wZSBhIHBhdGgg\nc3RyaW5nIHRoYXQgbWF5IHN0YXJ0IHdpdGggfgogICAgICogQHBhcmFtIGV4\nY2x1ZGVkTm9kZXMgYSBsaXN0IG9mIG5vZGVzCiAgICAgKiBAcmV0dXJuIG51\nbWJlciBvZiBhdmFpbGFibGUgbm9kZXMKICAgICAqLwogICAgcHVibGljIGlu\ndCBjb3VudE51bU9mQXZhaWxhYmxlTm9kZXMoU3RyaW5nIHNjb3BlLCBDb2xs\nZWN0aW9uPE5vZGU+IGV4Y2x1ZGVkTm9kZXMpIHsKICAgICAgICBib29sZWFu\nIGlzRXhjbHVkZWQgPSBmYWxzZTsKICAgICAgICBpZiAoc2NvcGUuc3RhcnRz\nV2l0aCgifiIpKSB7CiAgICAgICAgICAgIGlzRXhjbHVkZWQgPSB0cnVlOwog\nICAgICAgICAgICBzY29wZSA9IHNjb3BlLnN1YnN0cmluZygxKTsKICAgICAg\nICB9CiAgICAgICAgc2NvcGUgPSBOb2RlQmFzZS5ub3JtYWxpemUoc2NvcGUp\nOwogICAgICAgIGludCBjb3VudCA9IDA7IC8vIHRoZSBudW1iZXIgb2Ygbm9k\nZXMgaW4gYm90aCBzY29wZSAmIGV4Y2x1ZGVkTm9kZXMKICAgICAgICBuZXRs\nb2NrLnJlYWRMb2NrKCkubG9jaygpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGZvciAoTm9kZSBub2RlIDogZXhjbHVkZWROb2RlcykgewogICAgICAg\nICAgICAgICAgaWYgKChOb2RlQmFzZS5nZXRQYXRoKG5vZGUpICsgTm9kZUJh\nc2UuUEFUSF9TRVBBUkFUT1JfU1RSKS5zdGFydHNXaXRoKHNjb3BlCiAgICAg\nICAgICAgICAgICAgICAgICAgICsgTm9kZUJhc2UuUEFUSF9TRVBBUkFUT1Jf\nU1RSKSkgewogICAgICAgICAgICAgICAgICAgIGNvdW50Kys7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTm9kZSBuID0g\nZ2V0Tm9kZShzY29wZSk7CiAgICAgICAgICAgIGludCBzY29wZU5vZGVDb3Vu\ndCA9IDE7CiAgICAgICAgICAgIGlmIChuIGluc3RhbmNlb2YgSW5uZXJOb2Rl\nKSB7CiAgICAgICAgICAgICAgICBzY29wZU5vZGVDb3VudCA9ICgoSW5uZXJO\nb2RlKSBuKS5nZXROdW1PZkxlYXZlcygpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChpc0V4Y2x1ZGVkKSB7CiAgICAgICAgICAgICAgICByZXR1\ncm4gY2x1c3Rlck1hcC5nZXROdW1PZkxlYXZlcygpIC0gc2NvcGVOb2RlQ291\nbnQgLSBleGNsdWRlZE5vZGVzLnNpemUoKSArIGNvdW50OwogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlTm9kZUNv\ndW50IC0gY291bnQ7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICBuZXRsb2NrLnJlYWRMb2NrKCkudW5sb2NrKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKiBjb252ZXJ0IGEgbmV0d29yayB0cmVl\nIHRvIGEgc3RyaW5nICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBTdHJp\nbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgLy8gcHJpbnQgdGhlIG51bWJlciBv\nZiByYWNrcwogICAgICAgIFN0cmluZ0J1aWxkZXIgdHJlZSA9IG5ldyBTdHJp\nbmdCdWlsZGVyKCk7CiAgICAgICAgdHJlZS5hcHBlbmQoIk51bWJlciBvZiBy\nYWNrczogIik7CiAgICAgICAgdHJlZS5hcHBlbmQobnVtT2ZSYWNrcyk7CiAg\nICAgICAgdHJlZS5hcHBlbmQoIlxuIik7CiAgICAgICAgLy8gcHJpbnQgdGhl\nIG51bWJlciBvZiBsZWF2ZXMKICAgICAgICBpbnQgbnVtT2ZMZWF2ZXMgPSBn\nZXROdW1PZkxlYXZlcygpOwogICAgICAgIHRyZWUuYXBwZW5kKCJFeHBlY3Rl\nZCBudW1iZXIgb2YgbGVhdmVzOiIpOwogICAgICAgIHRyZWUuYXBwZW5kKG51\nbU9mTGVhdmVzKTsKICAgICAgICB0cmVlLmFwcGVuZCgiXG4iKTsKICAgICAg\nICAvLyBwcmludCBub2RlcwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbnVtT2ZMZWF2ZXM7IGkrKykgewogICAgICAgICAgICB0cmVlLmFwcGVuZChO\nb2RlQmFzZS5nZXRQYXRoKGNsdXN0ZXJNYXAuZ2V0TGVhZihpLCBudWxsKSkp\nOwogICAgICAgICAgICB0cmVlLmFwcGVuZCgiXG4iKTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIHRyZWUudG9TdHJpbmcoKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIERpdmlkZSBuZXR3b3JrbG9jYXRpb24gc3RyaW5nIGludG8gdHdv\nIHBhcnRzIGJ5IGxhc3Qgc2VwYXJhdG9yLCBhbmQgZ2V0CiAgICAgKiB0aGUg\nZmlyc3QgcGFydCBoZXJlLgogICAgICoKICAgICAqIEBwYXJhbSBuZXR3b3Jr\nTG9jYXRpb24KICAgICAqIEByZXR1cm4KICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBTdHJpbmcgZ2V0Rmlyc3RIYWxmKFN0cmluZyBuZXR3b3JrTG9jYXRp\nb24pIHsKICAgICAgICBpbnQgaW5kZXggPSBuZXR3b3JrTG9jYXRpb24ubGFz\ndEluZGV4T2YoTm9kZUJhc2UuUEFUSF9TRVBBUkFUT1JfU1RSKTsKICAgICAg\nICByZXR1cm4gbmV0d29ya0xvY2F0aW9uLnN1YnN0cmluZygwLCBpbmRleCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBEaXZpZGUgbmV0d29ya2xvY2F0aW9u\nIHN0cmluZyBpbnRvIHR3byBwYXJ0cyBieSBsYXN0IHNlcGFyYXRvciwgYW5k\nIGdldAogICAgICogdGhlIHNlY29uZCBwYXJ0IGhlcmUuCiAgICAgKgogICAg\nICogQHBhcmFtIG5ldHdvcmtMb2NhdGlvbgogICAgICogQHJldHVybgogICAg\nICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZXRMYXN0SGFsZihTdHJp\nbmcgbmV0d29ya0xvY2F0aW9uKSB7CiAgICAgICAgaW50IGluZGV4ID0gbmV0\nd29ya0xvY2F0aW9uLmxhc3RJbmRleE9mKE5vZGVCYXNlLlBBVEhfU0VQQVJB\nVE9SX1NUUik7CiAgICAgICAgcmV0dXJuIG5ldHdvcmtMb2NhdGlvbi5zdWJz\ndHJpbmcoaW5kZXgpOwogICAgfQoKICAgIC8qKiBzd2FwIHR3byBhcnJheSBp\ndGVtcyAqLwogICAgc3RhdGljIHByb3RlY3RlZCB2b2lkIHN3YXAoTm9kZVtd\nIG5vZGVzLCBpbnQgaSwgaW50IGopIHsKICAgICAgICBOb2RlIHRlbXBOb2Rl\nOwogICAgICAgIHRlbXBOb2RlID0gbm9kZXNbal07CiAgICAgICAgbm9kZXNb\nal0gPSBub2Rlc1tpXTsKICAgICAgICBub2Rlc1tpXSA9IHRlbXBOb2RlOwog\nICAgfQoKICAgIC8qKiBTb3J0IG5vZGVzIGFycmF5IGJ5IHRoZWlyIGRpc3Rh\nbmNlcyB0byA8aT5yZWFkZXI8L2k+CiAgICAgKiBJdCBsaW5lYXJseSBzY2Fu\ncyB0aGUgYXJyYXksIGlmIGEgbG9jYWwgbm9kZSBpcyBmb3VuZCwgc3dhcCBp\ndCB3aXRoCiAgICAgKiB0aGUgZmlyc3QgZWxlbWVudCBvZiB0aGUgYXJyYXku\nCiAgICAgKiBJZiBhIGxvY2FsIHJhY2sgbm9kZSBpcyBmb3VuZCwgc3dhcCBp\ndCB3aXRoIHRoZSBmaXJzdCBlbGVtZW50IGZvbGxvd2luZwogICAgICogdGhl\nIGxvY2FsIG5vZGUuCiAgICAgKiBJZiBuZWl0aGVyIGxvY2FsIG5vZGUgb3Ig\nbG9jYWwgcmFjayBub2RlIGlzIGZvdW5kLCBwdXQgYSByYW5kb20gcmVwbGlj\nYQogICAgICogbG9jYXRpb24gYXQgcG9zaXRpb24gMC4KICAgICAqIEl0IGxl\nYXZlcyB0aGUgcmVzdCBub2RlcyB1bnRvdWNoZWQuCiAgICAgKiBAcGFyYW0g\ncmVhZGVyIHRoZSBub2RlIHRoYXQgd2lzaGVzIHRvIHJlYWQgYSBibG9jayBm\ncm9tIG9uZSBvZiB0aGUgbm9kZXMKICAgICAqIEBwYXJhbSBub2RlcyB0aGUg\nbGlzdCBvZiBub2RlcyBjb250YWluaW5nIGRhdGEgZm9yIHRoZSByZWFkZXIK\nICAgICAqLwogICAgcHVibGljIHZvaWQgcHNldWRvU29ydEJ5RGlzdGFuY2Uo\nTm9kZSByZWFkZXIsIE5vZGVbXSBub2RlcykgewogICAgICAgIGludCB0ZW1w\nSW5kZXggPSAwOwogICAgICAgIGludCBsb2NhbFJhY2tOb2RlID0gLTE7CiAg\nICAgICAgaWYgKHJlYWRlciAhPSBudWxsKSB7CiAgICAgICAgICAgIC8vc2Nh\nbiB0aGUgYXJyYXkgdG8gZmluZCB0aGUgbG9jYWwgbm9kZSAmIGxvY2FsIHJh\nY2sgbm9kZQogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG5vZGVz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAodGVtcEluZGV4\nID09IDAgJiYgcmVhZGVyID09IG5vZGVzW2ldKSB7IC8vbG9jYWwgbm9kZQog\nICAgICAgICAgICAgICAgICAgIC8vc3dhcCB0aGUgbG9jYWwgbm9kZSBhbmQg\ndGhlIG5vZGUgYXQgcG9zaXRpb24gMAogICAgICAgICAgICAgICAgICAgIGlm\nIChpICE9IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3dhcChub2Rl\ncywgdGVtcEluZGV4LCBpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgdGVtcEluZGV4ID0gMTsKICAgICAgICAgICAgICAg\nICAgICBpZiAobG9jYWxSYWNrTm9kZSAhPSAtMSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAobG9jYWxSYWNrTm9kZSA9PSAwKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb2NhbFJhY2tOb2RlID0gaTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nIGVsc2UgaWYgKGxvY2FsUmFja05vZGUgPT0gLTEgJiYgaXNPblNhbWVSYWNr\nKHJlYWRlciwgbm9kZXNbaV0pKSB7CiAgICAgICAgICAgICAgICAgICAgLy9s\nb2NhbCByYWNrCiAgICAgICAgICAgICAgICAgICAgbG9jYWxSYWNrTm9kZSA9\nIGk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRlbXBJbmRleCAhPSAwKQog\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gc3dhcCB0aGUgbG9j\nYWwgcmFjayBub2RlIGFuZCB0aGUgbm9kZSBhdCBwb3NpdGlvbiB0ZW1wSW5k\nZXgKICAgICAgICAgICAgaWYgKGxvY2FsUmFja05vZGUgIT0gLTEgJiYgbG9j\nYWxSYWNrTm9kZSAhPSB0ZW1wSW5kZXgpIHsKICAgICAgICAgICAgICAgIHN3\nYXAobm9kZXMsIHRlbXBJbmRleCwgbG9jYWxSYWNrTm9kZSk7CiAgICAgICAg\nICAgICAgICB0ZW1wSW5kZXgrKzsKICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLy8gcHV0IGEgcmFuZG9tIG5vZGUgYXQgcG9zaXRpb24gMCBp\nZiBpdCBpcyBub3QgYSBsb2NhbC9sb2NhbC1yYWNrIG5vZGUKICAgICAgICBp\nZiAodGVtcEluZGV4ID09IDAgJiYgbG9jYWxSYWNrTm9kZSA9PSAtMSAmJiBu\nb2Rlcy5sZW5ndGggIT0gMCkgewogICAgICAgICAgICBzd2FwKG5vZGVzLCAw\nLCByLm5leHRJbnQobm9kZXMubGVuZ3RoKSk7CiAgICAgICAgfQogICAgfQoK\nfQo=\n","encoding":"base64"}

