{"sha":"d69d4a812bc16e4d51256ae7bbbf0712d257cc76","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDY5ZDRhODEyYmMxNmU0ZDUxMjU2YWU3YmJiZjA3MTJkMjU3Y2M3Ng==","size":14410,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d69d4a812bc16e4d51256ae7bbbf0712d257cc76","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvOwoKaW1w\nb3J0IHN0YXRpYyBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLkNoYXJzZXRzLlVU\nRl84OwoKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1hcDsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LlJlamVjdGVkRXhlY3V0aW9uRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5sb2Nrcy5SZWVudHJhbnRSZWFkV3JpdGVM\nb2NrOwoKaW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVu\ndC5UaHJlYWRGYWN0b3J5QnVpbGRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLm5ldC5Cb29raWVTb2NrZXRBZGRyZXNz\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVw\nZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFs\nQ2FsbGJhY2tzLlJlYWRFbnRyeUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNr\ncy5Xcml0ZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnN0YXRzLk51bGxTdGF0c0xvZ2dlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5zdGF0cy5TdGF0c0xvZ2dlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci51dGlsLk9yZGVyZWRTYWZlRXhlY3V0b3I7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TYWZlUnVubmFibGU7CmltcG9y\ndCBvcmcuamJvc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7CmltcG9y\ndCBvcmcuamJvc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXJzOwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuc29ja2V0LkNsaWVudFNvY2tl\ndENoYW5uZWxGYWN0b3J5OwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5u\nZWwuc29ja2V0Lm5pby5OaW9DbGllbnRTb2NrZXRDaGFubmVsRmFjdG9yeTsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS51dGlsLkhhc2hlZFdoZWVsVGltZXI7\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlckZhY3Rvcnk7CgovKioKICogSW1wbGVtZW50cyB0aGUgY2xpZW50LXNp\nZGUgcGFydCBvZiB0aGUgQm9va0tlZXBlciBwcm90b2NvbC4KICoKICovCnB1\nYmxpYyBjbGFzcyBCb29raWVDbGllbnQgaW1wbGVtZW50cyBQZXJDaGFubmVs\nQm9va2llQ2xpZW50RmFjdG9yeSB7CiAgICBzdGF0aWMgZmluYWwgTG9nZ2Vy\nIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tpZUNsaWVudC5j\nbGFzcyk7CgogICAgZmluYWwgT3JkZXJlZFNhZmVFeGVjdXRvciBleGVjdXRv\ncjsKICAgIGZpbmFsIENsaWVudFNvY2tldENoYW5uZWxGYWN0b3J5IGNoYW5u\nZWxGYWN0b3J5OwogICAgZmluYWwgQ29uY3VycmVudEhhc2hNYXA8Qm9va2ll\nU29ja2V0QWRkcmVzcywgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudFBvb2w+IGNo\nYW5uZWxzID0KICAgICAgICAgICAgbmV3IENvbmN1cnJlbnRIYXNoTWFwPEJv\nb2tpZVNvY2tldEFkZHJlc3MsIFBlckNoYW5uZWxCb29raWVDbGllbnRQb29s\nPigpOwogICAgZmluYWwgSGFzaGVkV2hlZWxUaW1lciByZXF1ZXN0VGltZXI7\nCiAgICBwcml2YXRlIGZpbmFsIENsaWVudENvbmZpZ3VyYXRpb24gY29uZjsK\nICAgIHByaXZhdGUgdm9sYXRpbGUgYm9vbGVhbiBjbG9zZWQ7CiAgICBwcml2\nYXRlIGZpbmFsIFJlZW50cmFudFJlYWRXcml0ZUxvY2sgY2xvc2VMb2NrOwog\nICAgcHJpdmF0ZSBmaW5hbCBTdGF0c0xvZ2dlciBzdGF0c0xvZ2dlcjsKICAg\nIHByaXZhdGUgZmluYWwgaW50IG51bUNvbm5lY3Rpb25zUGVyQm9va2llOwoK\nICAgIHB1YmxpYyBCb29raWVDbGllbnQoQ2xpZW50Q29uZmlndXJhdGlvbiBj\nb25mLCBDbGllbnRTb2NrZXRDaGFubmVsRmFjdG9yeSBjaGFubmVsRmFjdG9y\neSwgT3JkZXJlZFNhZmVFeGVjdXRvciBleGVjdXRvcikgewogICAgICAgIHRo\naXMoY29uZiwgY2hhbm5lbEZhY3RvcnksIGV4ZWN1dG9yLCBOdWxsU3RhdHNM\nb2dnZXIuSU5TVEFOQ0UpOwogICAgfQoKICAgIHB1YmxpYyBCb29raWVDbGll\nbnQoQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mLCBDbGllbnRTb2NrZXRDaGFu\nbmVsRmFjdG9yeSBjaGFubmVsRmFjdG9yeSwgT3JkZXJlZFNhZmVFeGVjdXRv\nciBleGVjdXRvciwKICAgICAgICAgICAgICAgICAgICAgICAgU3RhdHNMb2dn\nZXIgc3RhdHNMb2dnZXIpIHsKICAgICAgICB0aGlzLmNvbmYgPSBjb25mOwog\nICAgICAgIHRoaXMuY2hhbm5lbEZhY3RvcnkgPSBjaGFubmVsRmFjdG9yeTsK\nICAgICAgICB0aGlzLmV4ZWN1dG9yID0gZXhlY3V0b3I7CiAgICAgICAgdGhp\ncy5jbG9zZWQgPSBmYWxzZTsKICAgICAgICB0aGlzLmNsb3NlTG9jayA9IG5l\ndyBSZWVudHJhbnRSZWFkV3JpdGVMb2NrKCk7CiAgICAgICAgdGhpcy5zdGF0\nc0xvZ2dlciA9IHN0YXRzTG9nZ2VyOwogICAgICAgIHRoaXMubnVtQ29ubmVj\ndGlvbnNQZXJCb29raWUgPSBjb25mLmdldE51bUNoYW5uZWxzUGVyQm9va2ll\nKCk7CiAgICAgICAgdGhpcy5yZXF1ZXN0VGltZXIgPSBuZXcgSGFzaGVkV2hl\nZWxUaW1lcigKICAgICAgICAgICAgICAgIG5ldyBUaHJlYWRGYWN0b3J5QnVp\nbGRlcigpLnNldE5hbWVGb3JtYXQoIkJvb2tpZUNsaWVudFRpbWVyLSVkIiku\nYnVpbGQoKSwKICAgICAgICAgICAgICAgIGNvbmYuZ2V0UENCQ1RpbWVvdXRU\naW1lclRpY2tEdXJhdGlvbk1zKCksIFRpbWVVbml0Lk1JTExJU0VDT05EUywK\nICAgICAgICAgICAgICAgIGNvbmYuZ2V0UENCQ1RpbWVvdXRUaW1lck51bVRp\nY2tzKCkpOwogICAgfQoKICAgIHByaXZhdGUgaW50IGdldFJjKGludCByYykg\newogICAgICAgIGlmIChCS0V4Y2VwdGlvbi5Db2RlLk9LID09IHJjKSB7CiAg\nICAgICAgICAgIHJldHVybiByYzsKICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICBpZiAoY2xvc2VkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQktF\neGNlcHRpb24uQ29kZS5DbGllbnRDbG9zZWRFeGNlcHRpb247CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmM7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudCBjcmVhdGUoQm9va2llU29j\na2V0QWRkcmVzcyBhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIG5ldyBQZXJD\naGFubmVsQm9va2llQ2xpZW50KGNvbmYsIGV4ZWN1dG9yLCBjaGFubmVsRmFj\ndG9yeSwgYWRkcmVzcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmVxdWVzdFRpbWVyLCBzdGF0c0xvZ2dlcik7CiAgICB9\nCgogICAgcHJpdmF0ZSBQZXJDaGFubmVsQm9va2llQ2xpZW50UG9vbCBsb29r\ndXBDbGllbnQoQm9va2llU29ja2V0QWRkcmVzcyBhZGRyLCBPYmplY3Qga2V5\nKSB7CiAgICAgICAgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudFBvb2wgY2xpZW50\nUG9vbCA9IGNoYW5uZWxzLmdldChhZGRyKTsKICAgICAgICBpZiAobnVsbCA9\nPSBjbGllbnRQb29sKSB7CiAgICAgICAgICAgIGNsb3NlTG9jay5yZWFkTG9j\naygpLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGlmIChjbG9zZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFBlckNoYW5u\nZWxCb29raWVDbGllbnRQb29sIG5ld0NsaWVudFBvb2wgPQogICAgICAgICAg\nICAgICAgICAgICAgICBuZXcgRGVmYXVsdFBlckNoYW5uZWxCb29raWVDbGll\nbnRQb29sKHRoaXMsIGFkZHIsIG51bUNvbm5lY3Rpb25zUGVyQm9va2llKTsK\nICAgICAgICAgICAgICAgIFBlckNoYW5uZWxCb29raWVDbGllbnRQb29sIG9s\nZENsaWVudFBvb2wgPSBjaGFubmVscy5wdXRJZkFic2VudChhZGRyLCBuZXdD\nbGllbnRQb29sKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IG9sZENs\naWVudFBvb2wpIHsKICAgICAgICAgICAgICAgICAgICBjbGllbnRQb29sID0g\nbmV3Q2xpZW50UG9vbDsKICAgICAgICAgICAgICAgICAgICAvLyBpbml0aWFs\naXplIHRoZSBwb29sIG9ubHkgYWZ0ZXIgd2UgcHV0IHRoZSBwb29sIGludG8g\ndGhlIG1hcAogICAgICAgICAgICAgICAgICAgIGNsaWVudFBvb2wuaW50aWFs\naXplKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgIGNsaWVudFBvb2wgPSBvbGRDbGllbnRQb29sOwogICAgICAgICAg\nICAgICAgICAgIG5ld0NsaWVudFBvb2wuY2xvc2UoZmFsc2UpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgY2xvc2VMb2NrLnJlYWRMb2NrKCkudW5sb2NrKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNsaWVudFBvb2w7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY2xvc2VDbGllbnRzKFNldDxCb29raWVT\nb2NrZXRBZGRyZXNzPiBhZGRycykgewogICAgICAgIGZpbmFsIEhhc2hTZXQ8\nUGVyQ2hhbm5lbEJvb2tpZUNsaWVudFBvb2w+IGNsaWVudHMgPQogICAgICAg\nICAgICAgICAgbmV3IEhhc2hTZXQ8UGVyQ2hhbm5lbEJvb2tpZUNsaWVudFBv\nb2w+KCk7CiAgICAgICAgY2xvc2VMb2NrLnJlYWRMb2NrKCkubG9jaygpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoQm9va2llU29ja2V0QWRk\ncmVzcyBhIDogYWRkcnMpIHsKICAgICAgICAgICAgICAgIFBlckNoYW5uZWxC\nb29raWVDbGllbnRQb29sIGMgPSBjaGFubmVscy5nZXQoYSk7CiAgICAgICAg\nICAgICAgICBpZiAoYyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nY2xpZW50cy5hZGQoYyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGlmIChjbGllbnRzLnNpemUoKSA9PSAwKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBjbG9zZUxvY2sucmVhZExvY2soKS51\nbmxvY2soKTsKICAgICAgICB9CiAgICAgICAgZm9yIChQZXJDaGFubmVsQm9v\na2llQ2xpZW50UG9vbCBjIDogY2xpZW50cykgewogICAgICAgICAgICBjLmRp\nc2Nvbm5lY3QoZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBhZGRFbnRyeShmaW5hbCBCb29raWVTb2NrZXRBZGRyZXNzIGFkZHIs\nIGZpbmFsIGxvbmcgbGVkZ2VySWQsIGZpbmFsIGJ5dGVbXSBtYXN0ZXJLZXks\nCiAgICAgICAgICAgIGZpbmFsIGxvbmcgZW50cnlJZCwKICAgICAgICAgICAg\nZmluYWwgQ2hhbm5lbEJ1ZmZlciB0b1NlbmQsIGZpbmFsIFdyaXRlQ2FsbGJh\nY2sgY2IsIGZpbmFsIE9iamVjdCBjdHgsIGZpbmFsIGludCBvcHRpb25zKSB7\nCiAgICAgICAgY2xvc2VMb2NrLnJlYWRMb2NrKCkubG9jaygpOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGZpbmFsIFBlckNoYW5uZWxCb29raWVDbGll\nbnRQb29sIGNsaWVudCA9IGxvb2t1cENsaWVudChhZGRyLCBlbnRyeUlkKTsK\nICAgICAgICAgICAgaWYgKGNsaWVudCA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBjYi53cml0ZUNvbXBsZXRlKGdldFJjKEJLRXhjZXB0aW9uLkNvZGUu\nQm9va2llSGFuZGxlTm90QXZhaWxhYmxlRXhjZXB0aW9uKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQsIGVudHJ5SWQsIGFk\nZHIsIGN0eCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIGNsaWVudC5vYnRhaW4obmV3IEdlbmVyaWNDYWxs\nYmFjazxQZXJDaGFubmVsQm9va2llQ2xpZW50PigpIHsKICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uQ29tcGxldGUoZmluYWwgaW50IHJjLCBQZXJDaGFubmVsQm9va2ll\nQ2xpZW50IHBjYmMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0g\nQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0b3Iu\nc3VibWl0T3JkZXJlZChsZWRnZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZl\nUnVuKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nYi53cml0ZUNvbXBsZXRlKHJjLCBsZWRnZXJJZCwgZW50cnlJZCwgYWRkciwg\nY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoUmVqZWN0ZWRFeGVjdXRpb25FeGNlcHRpb24gcmUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLndyaXRlQ29tcGxl\ndGUoZ2V0UmMoQktFeGNlcHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdl\ncklkLCBlbnRyeUlkLCBhZGRyLCBjdHgpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGNiYy5hZGRF\nbnRyeShsZWRnZXJJZCwgbWFzdGVyS2V5LCBlbnRyeUlkLCB0b1NlbmQsIGNi\nLCBjdHgsIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBjbG9zZUxv\nY2sucmVhZExvY2soKS51bmxvY2soKTsKICAgICAgICB9CiAgICB9CgogICAg\ncHVibGljIHZvaWQgcmVhZEVudHJ5QW5kRmVuY2VMZWRnZXIoZmluYWwgQm9v\na2llU29ja2V0QWRkcmVzcyBhZGRyLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmluYWwgbG9uZyBsZWRnZXJJZCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIGJ5dGVb\nXSBtYXN0ZXJLZXksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmaW5hbCBsb25nIGVudHJ5SWQsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBSZWFkRW50cnlDYWxsYmFj\nayBjYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBjbG9zZUxvY2sucmVhZExv\nY2soKS5sb2NrKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmluYWwg\nUGVyQ2hhbm5lbEJvb2tpZUNsaWVudFBvb2wgY2xpZW50ID0gbG9va3VwQ2xp\nZW50KGFkZHIsIGVudHJ5SWQpOwogICAgICAgICAgICBpZiAoY2xpZW50ID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGNiLnJlYWRFbnRyeUNvbXBsZXRl\nKGdldFJjKEJLRXhjZXB0aW9uLkNvZGUuQm9va2llSGFuZGxlTm90QXZhaWxh\nYmxlRXhjZXB0aW9uKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxlZGdlcklkLCBlbnRyeUlkLCBudWxsLCBjdHgpOwogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBj\nbGllbnQub2J0YWluKG5ldyBHZW5lcmljQ2FsbGJhY2s8UGVyQ2hhbm5lbEJv\nb2tpZUNsaWVudD4oKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKGZp\nbmFsIGludCByYywgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudCBwY2JjKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUu\nT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGV4ZWN1dG9yLnN1Ym1pdE9yZGVyZWQobGVk\nZ2VySWQsIG5ldyBTYWZlUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IucmVhZEVudHJ5Q29tcGxl\ndGUocmMsIGxlZGdlcklkLCBlbnRyeUlkLCBudWxsLCBjdHgpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChSZWplY3RlZEV4ZWN1dGlvbkV4Y2VwdGlvbiByZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2IucmVhZEVudHJ5Q29tcGxldGUoZ2V0UmMo\nQktFeGNlcHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4Y2VwdGlvbiksCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcklkLCBlbnRy\neUlkLCBudWxsLCBjdHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgcGNiYy5yZWFkRW50cnlBbmRG\nZW5jZUxlZGdlcihsZWRnZXJJZCwgbWFzdGVyS2V5LCBlbnRyeUlkLCBjYiwg\nY3R4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAg\nICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgY2xvc2VMb2NrLnJlYWRMb2Nr\nKCkudW5sb2NrKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHJlYWRFbnRyeShmaW5hbCBCb29raWVTb2NrZXRBZGRyZXNzIGFkZHIsIGZp\nbmFsIGxvbmcgbGVkZ2VySWQsIGZpbmFsIGxvbmcgZW50cnlJZCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICBmaW5hbCBSZWFkRW50cnlDYWxsYmFjayBj\nYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIGNsb3NlTG9jay5yZWFk\nTG9jaygpLmxvY2soKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmaW5h\nbCBQZXJDaGFubmVsQm9va2llQ2xpZW50UG9vbCBjbGllbnQgPSBsb29rdXBD\nbGllbnQoYWRkciwgZW50cnlJZCk7CiAgICAgICAgICAgIGlmIChjbGllbnQg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY2IucmVhZEVudHJ5Q29tcGxl\ndGUoZ2V0UmMoQktFeGNlcHRpb24uQ29kZS5Cb29raWVIYW5kbGVOb3RBdmFp\nbGFibGVFeGNlcHRpb24pLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbGVkZ2VySWQsIGVudHJ5SWQsIG51bGwsIGN0eCk7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGNsaWVudC5vYnRhaW4obmV3IEdlbmVyaWNDYWxsYmFjazxQZXJDaGFubmVs\nQm9va2llQ2xpZW50PigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUo\nZmluYWwgaW50IHJjLCBQZXJDaGFubmVsQm9va2llQ2xpZW50IHBjYmMpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAocmMgIT0gQktFeGNlcHRpb24uQ29k\nZS5PSykgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXhlY3V0b3Iuc3VibWl0T3JkZXJlZChs\nZWRnZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUnVuKCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5yZWFkRW50cnlDb21w\nbGV0ZShyYywgbGVkZ2VySWQsIGVudHJ5SWQsIG51bGwsIGN0eCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFJlamVjdGVkRXhlY3V0aW9uRXhjZXB0aW9uIHJlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjYi5yZWFkRW50cnlDb21wbGV0ZShnZXRS\nYyhCS0V4Y2VwdGlvbi5Db2RlLkludGVycnVwdGVkRXhjZXB0aW9uKSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQsIGVu\ndHJ5SWQsIG51bGwsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwY2JjLnJlYWRFbnRyeShs\nZWRnZXJJZCwgZW50cnlJZCwgY2IsIGN0eCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGNsb3NlTG9jay5yZWFkTG9jaygpLnVubG9jaygpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Nsb3NlZCgpIHsKICAgICAg\nICByZXR1cm4gY2xvc2VkOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3Nl\nKCkgewogICAgICAgIGNsb3NlTG9jay53cml0ZUxvY2soKS5sb2NrKCk7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgY2xvc2VkID0gdHJ1ZTsKICAgICAg\nICAgICAgZm9yIChQZXJDaGFubmVsQm9va2llQ2xpZW50UG9vbCBwb29sIDog\nY2hhbm5lbHMudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAgIHBvb2wuY2xv\nc2UodHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hhbm5lbHMu\nY2xlYXIoKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBjbG9z\nZUxvY2sud3JpdGVMb2NrKCkudW5sb2NrKCk7CiAgICAgICAgfQogICAgICAg\nIC8vIFNodXQgZG93biB0aGUgdGltZW91dCBleGVjdXRvci4KICAgICAgICB0\naGlzLnJlcXVlc3RUaW1lci5zdG9wKCk7CiAgICB9CgogICAgcHJpdmF0ZSBz\ndGF0aWMgY2xhc3MgQ291bnRlciB7CiAgICAgICAgaW50IGk7CiAgICAgICAg\naW50IHRvdGFsOwoKICAgICAgICBzeW5jaHJvbml6ZWQgdm9pZCBpbmMoKSB7\nCiAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgdG90YWwrKzsKICAgICAg\nICB9CgogICAgICAgIHN5bmNocm9uaXplZCB2b2lkIGRlYygpIHsKICAgICAg\nICAgICAgaS0tOwogICAgICAgICAgICBub3RpZnlBbGwoKTsKICAgICAgICB9\nCgogICAgICAgIHN5bmNocm9uaXplZCB2b2lkIHdhaXQoaW50IGxpbWl0KSB0\naHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICB3aGls\nZSAoaSA+IGxpbWl0KSB7CiAgICAgICAgICAgICAgICB3YWl0KCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCBpbnQg\ndG90YWwoKSB7CiAgICAgICAgICAgIHJldHVybiB0b3RhbDsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0gYXJncwogICAgICogQHRo\ncm93cyBJT0V4Y2VwdGlvbgogICAgICogQHRocm93cyBOdW1iZXJGb3JtYXRF\neGNlcHRpb24KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24K\nICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3RyaW5nW10g\nYXJncykgdGhyb3dzIE51bWJlckZvcm1hdEV4Y2VwdGlvbiwgSU9FeGNlcHRp\nb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBpZiAoYXJncy5s\nZW5ndGggIT0gMykgewogICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4o\nIlVTQUdFOiBCb29raWVDbGllbnQgYm9va2llSG9zdCBwb3J0IGxlZGdlciMi\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBXcml0\nZUNhbGxiYWNrIGNiID0gbmV3IFdyaXRlQ2FsbGJhY2soKSB7CgogICAgICAg\nICAgICBwdWJsaWMgdm9pZCB3cml0ZUNvbXBsZXRlKGludCByYywgbG9uZyBs\nZWRnZXIsIGxvbmcgZW50cnksIEJvb2tpZVNvY2tldEFkZHJlc3MgYWRkciwg\nT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgQ291bnRlciBjb3VudGVy\nID0gKENvdW50ZXIpIGN0eDsKICAgICAgICAgICAgICAgIGNvdW50ZXIuZGVj\nKCk7CiAgICAgICAgICAgICAgICBpZiAocmMgIT0gMCkgewogICAgICAgICAg\nICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigicmMgPSAiICsgcmMgKyAi\nIGZvciAiICsgZW50cnkgKyAiQCIgKyBsZWRnZXIpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBDb3VudGVy\nIGNvdW50ZXIgPSBuZXcgQ291bnRlcigpOwogICAgICAgIGJ5dGUgaGVsbG9b\nXSA9ICJoZWxsbyIuZ2V0Qnl0ZXMoVVRGXzgpOwogICAgICAgIGxvbmcgbGVk\nZ2VyID0gTG9uZy5wYXJzZUxvbmcoYXJnc1syXSk7CiAgICAgICAgVGhyZWFk\nRmFjdG9yeUJ1aWxkZXIgdGZiID0gbmV3IFRocmVhZEZhY3RvcnlCdWlsZGVy\nKCk7CiAgICAgICAgQ2xpZW50U29ja2V0Q2hhbm5lbEZhY3RvcnkgY2hhbm5l\nbEZhY3RvcnkgPSBuZXcgTmlvQ2xpZW50U29ja2V0Q2hhbm5lbEZhY3Rvcnko\nCiAgICAgICAgICAgICAgICBFeGVjdXRvcnMubmV3Q2FjaGVkVGhyZWFkUG9v\nbCh0ZmIuc2V0TmFtZUZvcm1hdCgKICAgICAgICAgICAgICAgICAgICAgICAg\nIkJvb2tLZWVwZXItTklPQm9zcy0lZCIpLmJ1aWxkKCkpLAogICAgICAgICAg\nICAgICAgRXhlY3V0b3JzLm5ld0NhY2hlZFRocmVhZFBvb2wodGZiLnNldE5h\nbWVGb3JtYXQoCiAgICAgICAgICAgICAgICAgICAgICAgICJCb29rS2VlcGVy\nLU5JT1dvcmtlci0lZCIpLmJ1aWxkKCkpKTsKICAgICAgICBPcmRlcmVkU2Fm\nZUV4ZWN1dG9yIGV4ZWN1dG9yID0gbmV3IE9yZGVyZWRTYWZlRXhlY3V0b3Io\nMSwKICAgICAgICAgICAgICAgICJCb29raWVDbGllbnRXb3JrZXIiKTsKICAg\nICAgICBCb29raWVDbGllbnQgYmMgPSBuZXcgQm9va2llQ2xpZW50KG5ldyBD\nbGllbnRDb25maWd1cmF0aW9uKCksIGNoYW5uZWxGYWN0b3J5LCBleGVjdXRv\ncik7CiAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBhZGRyID0gbmV3IEJv\nb2tpZVNvY2tldEFkZHJlc3MoYXJnc1swXSwgSW50ZWdlci5wYXJzZUludChh\ncmdzWzFdKSk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwMDAw\nOyBpKyspIHsKICAgICAgICAgICAgY291bnRlci5pbmMoKTsKICAgICAgICAg\nICAgYmMuYWRkRW50cnkoYWRkciwgbGVkZ2VyLCBuZXcgYnl0ZVswXSwgaSwg\nQ2hhbm5lbEJ1ZmZlcnMud3JhcHBlZEJ1ZmZlcihoZWxsbyksIGNiLCBjb3Vu\ndGVyLCAwKTsKICAgICAgICB9CiAgICAgICAgY291bnRlci53YWl0KDApOwog\nICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiVG90YWwgPSAiICsgY291bnRl\nci50b3RhbCgpKTsKICAgICAgICBjaGFubmVsRmFjdG9yeS5yZWxlYXNlRXh0\nZXJuYWxSZXNvdXJjZXMoKTsKICAgICAgICBleGVjdXRvci5zaHV0ZG93bigp\nOwogICAgfQp9Cg==\n","encoding":"base64"}

