{"sha":"6ece56ea329504af677d86f650abccc02c2a94bc","node_id":"MDQ6QmxvYjE1NzU5NTY6NmVjZTU2ZWEzMjk1MDRhZjY3N2Q4NmY2NTBhYmNjYzAyYzJhOTRiYw==","size":13352,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/6ece56ea329504af677d86f650abccc02c2a94bc","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90bzsKCmlt\ncG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hh\nbm5lbEJ1ZmZlckZhY3Rvcnk7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuYnVm\nZmVyLkNoYW5uZWxCdWZmZXJJbnB1dFN0cmVhbTsKaW1wb3J0IG9yZy5qYm9z\ncy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcnM7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsOwppbXBvcnQgb3JnLmpib3NzLm5l\ndHR5LmNoYW5uZWwuQ2hhbm5lbEhhbmRsZXJDb250ZXh0OwoKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVQcm90b2NvbC5QYWNr\nZXRIZWFkZXI7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuaGFuZGxlci5jb2Rl\nYy5vbmVvbmUuT25lVG9PbmVFbmNvZGVyOwppbXBvcnQgb3JnLmpib3NzLm5l\ndHR5LmhhbmRsZXIuY29kZWMub25lb25lLk9uZVRvT25lRGVjb2RlcjsKCmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\nckZhY3Rvcnk7CgpwdWJsaWMgY2xhc3MgQm9va2llUHJvdG9FbmNvZGluZyB7\nCiAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2Vy\nRmFjdG9yeS5nZXRMb2dnZXIoQm9va2llUHJvdG9FbmNvZGluZy5jbGFzcyk7\nCgogICAgc3RhdGljIGZpbmFsIEVuRGVjb2RlciBSRVFfUFJFVjMgPSBuZXcg\nUmVxdWVzdEVuRGVDb2RlclByZVYzKCk7CiAgICBzdGF0aWMgZmluYWwgRW5E\nZWNvZGVyIFJFUF9QUkVWMyA9IG5ldyBSZXNwb25zZUVuRGVDb2RlclByZVYz\nKCk7CiAgICBzdGF0aWMgZmluYWwgRW5EZWNvZGVyIFJFUV9WMyA9IG5ldyBS\nZXF1ZXN0RW5EZWNvZGVyVjMoKTsKICAgIHN0YXRpYyBmaW5hbCBFbkRlY29k\nZXIgUkVQX1YzID0gbmV3IFJlc3BvbnNlRW5EZWNvZGVyVjMoKTsKCiAgICBz\ndGF0aWMgaW50ZXJmYWNlIEVuRGVjb2RlciB7CgogICAgICAgIC8qKgogICAg\nICAgICAqIEVuY29kZSBhIDxpPm9iamVjdDwvaT4gaW50byBjaGFubmVsIGJ1\nZmZlci4KICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSBvYmplY3QKICAg\nICAgICAgKiAgICAgICAgICBvYmplY3QuCiAgICAgICAgICogQHJldHVybiBl\nbmNvZGUgYnVmZmVyLgogICAgICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAg\nICAgICAgICovCiAgICAgICAgcHVibGljIE9iamVjdCBlbmNvZGUoT2JqZWN0\nIG9iamVjdCwgQ2hhbm5lbEJ1ZmZlckZhY3RvcnkgZmFjdG9yeSkgdGhyb3dz\nIEV4Y2VwdGlvbjsKCiAgICAgICAgLyoqCiAgICAgICAgICogRGVjb2RlIGEg\nPGk+cGFja2V0PC9pPiBpbnRvIGFuIG9iamVjdC4KICAgICAgICAgKgogICAg\nICAgICAqIEBwYXJhbSBwYWNrZXQKICAgICAgICAgKiAgICAgICAgICByZWNl\naXZlZCBwYWNrZXQuCiAgICAgICAgICogQHJldHVybiBwYXJzZWQgb2JqZWN0\nLgogICAgICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIE9iamVjdCBkZWNvZGUoQ2hhbm5lbEJ1ZmZlciBwYWNr\nZXQpIHRocm93cyBFeGNlcHRpb247CgogICAgfQoKICAgIHN0YXRpYyBjbGFz\ncyBSZXF1ZXN0RW5EZUNvZGVyUHJlVjMgaW1wbGVtZW50cyBFbkRlY29kZXIg\newogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBPYmplY3QgZW5j\nb2RlKE9iamVjdCBtc2csIENoYW5uZWxCdWZmZXJGYWN0b3J5IGJ1ZmZlckZh\nY3RvcnkpCiAgICAgICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgaWYgKCEobXNnIGluc3RhbmNlb2YgQm9va2llUHJvdG9jb2wu\nUmVxdWVzdCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBtc2c7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgQm9va2llUHJvdG9jb2wuUmVxdWVzdCBy\nID0gKEJvb2tpZVByb3RvY29sLlJlcXVlc3QpbXNnOwogICAgICAgICAgICBp\nZiAociBpbnN0YW5jZW9mIEJvb2tpZVByb3RvY29sLkFkZFJlcXVlc3QpIHsK\nICAgICAgICAgICAgICAgIEJvb2tpZVByb3RvY29sLkFkZFJlcXVlc3QgYXIg\nPSAoQm9va2llUHJvdG9jb2wuQWRkUmVxdWVzdClyOwogICAgICAgICAgICAg\nICAgaW50IHRvdGFsSGVhZGVyU2l6ZSA9IDQgLy8gZm9yIHRoZSBoZWFkZXIK\nICAgICAgICAgICAgICAgICAgICArIEJvb2tpZVByb3RvY29sLk1BU1RFUl9L\nRVlfTEVOR1RIOyAvLyBmb3IgdGhlIG1hc3RlciBrZXkKICAgICAgICAgICAg\nICAgIENoYW5uZWxCdWZmZXIgYnVmID0gYnVmZmVyRmFjdG9yeS5nZXRCdWZm\nZXIodG90YWxIZWFkZXJTaXplKTsKICAgICAgICAgICAgICAgIGJ1Zi53cml0\nZUludChuZXcgUGFja2V0SGVhZGVyKHIuZ2V0UHJvdG9jb2xWZXJzaW9uKCks\nIHIuZ2V0T3BDb2RlKCksIHIuZ2V0RmxhZ3MoKSkudG9JbnQoKSk7CiAgICAg\nICAgICAgICAgICBidWYud3JpdGVCeXRlcyhyLmdldE1hc3RlcktleSgpLCAw\nLCBCb29raWVQcm90b2NvbC5NQVNURVJfS0VZX0xFTkdUSCk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gQ2hhbm5lbEJ1ZmZlcnMud3JhcHBlZEJ1ZmZlcihi\ndWYsIGFyLmdldERhdGEoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBhc3NlcnQociBpbnN0YW5jZW9mIEJvb2tpZVByb3RvY29s\nLlJlYWRSZXF1ZXN0KTsKICAgICAgICAgICAgICAgIGludCB0b3RhbEhlYWRl\nclNpemUgPSA0IC8vIGZvciByZXF1ZXN0IHR5cGUKICAgICAgICAgICAgICAg\nICAgICArIDggLy8gZm9yIGxlZGdlcklkCiAgICAgICAgICAgICAgICAgICAg\nKyA4OyAvLyBmb3IgZW50cnlJZAogICAgICAgICAgICAgICAgaWYgKHIuaGFz\nTWFzdGVyS2V5KCkpIHsKICAgICAgICAgICAgICAgICAgICB0b3RhbEhlYWRl\nclNpemUgKz0gQm9va2llUHJvdG9jb2wuTUFTVEVSX0tFWV9MRU5HVEg7CiAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQ2hhbm5lbEJ1ZmZl\nciBidWYgPSBidWZmZXJGYWN0b3J5LmdldEJ1ZmZlcih0b3RhbEhlYWRlclNp\nemUpOwogICAgICAgICAgICAgICAgYnVmLndyaXRlSW50KG5ldyBQYWNrZXRI\nZWFkZXIoci5nZXRQcm90b2NvbFZlcnNpb24oKSwgci5nZXRPcENvZGUoKSwg\nci5nZXRGbGFncygpKS50b0ludCgpKTsKICAgICAgICAgICAgICAgIGJ1Zi53\ncml0ZUxvbmcoci5nZXRMZWRnZXJJZCgpKTsKICAgICAgICAgICAgICAgIGJ1\nZi53cml0ZUxvbmcoci5nZXRFbnRyeUlkKCkpOwogICAgICAgICAgICAgICAg\naWYgKHIuaGFzTWFzdGVyS2V5KCkpIHsKICAgICAgICAgICAgICAgICAgICBi\ndWYud3JpdGVCeXRlcyhyLmdldE1hc3RlcktleSgpLCAwLCBCb29raWVQcm90\nb2NvbC5NQVNURVJfS0VZX0xFTkdUSCk7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgcmV0dXJuIGJ1ZjsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIE9iamVj\ndCBkZWNvZGUoQ2hhbm5lbEJ1ZmZlciBwYWNrZXQpCiAgICAgICAgICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgUGFja2V0SGVhZGVy\nIGggPSBQYWNrZXRIZWFkZXIuZnJvbUludChwYWNrZXQucmVhZEludCgpKTsK\nCiAgICAgICAgICAgIC8vIHBhY2tldCBmb3JtYXQgaXMgZGlmZmVyZW50IGJl\ndHdlZW4gQURERU5UUlkgYW5kIFJFQURFTlRSWQogICAgICAgICAgICBsb25n\nIGxlZGdlcklkID0gLTE7CiAgICAgICAgICAgIGxvbmcgZW50cnlJZCA9IEJv\nb2tpZVByb3RvY29sLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgICAgIGJ5\ndGVbXSBtYXN0ZXJLZXkgPSBudWxsOwogICAgICAgICAgICBzaG9ydCBmbGFn\ncyA9IGguZ2V0RmxhZ3MoKTsKCiAgICAgICAgICAgIFNlcnZlclN0YXRzLmdl\ndEluc3RhbmNlKCkuaW5jcmVtZW50UGFja2V0c1JlY2VpdmVkKCk7CgogICAg\nICAgICAgICBzd2l0Y2ggKGguZ2V0T3BDb2RlKCkpIHsKICAgICAgICAgICAg\nY2FzZSBCb29raWVQcm90b2NvbC5BRERFTlRSWToKICAgICAgICAgICAgICAg\nIC8vIGZpcnN0IHJlYWQgbWFzdGVyIGtleQogICAgICAgICAgICAgICAgbWFz\ndGVyS2V5ID0gbmV3IGJ5dGVbQm9va2llUHJvdG9jb2wuTUFTVEVSX0tFWV9M\nRU5HVEhdOwogICAgICAgICAgICAgICAgcGFja2V0LnJlYWRCeXRlcyhtYXN0\nZXJLZXksIDAsIEJvb2tpZVByb3RvY29sLk1BU1RFUl9LRVlfTEVOR1RIKTsK\nCiAgICAgICAgICAgICAgICBDaGFubmVsQnVmZmVyIGJiID0gcGFja2V0LmR1\ncGxpY2F0ZSgpOwoKICAgICAgICAgICAgICAgIGxlZGdlcklkID0gYmIucmVh\nZExvbmcoKTsKICAgICAgICAgICAgICAgIGVudHJ5SWQgPSBiYi5yZWFkTG9u\nZygpOwogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCb29raWVQcm90b2Nv\nbC5BZGRSZXF1ZXN0KGguZ2V0VmVyc2lvbigpLCBsZWRnZXJJZCwgZW50cnlJ\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgZmxhZ3MsIG1hc3RlcktleSwg\ncGFja2V0LnNsaWNlKCkpOwogICAgICAgICAgICBjYXNlIEJvb2tpZVByb3Rv\nY29sLlJFQURFTlRSWToKICAgICAgICAgICAgICAgIGxlZGdlcklkID0gcGFj\na2V0LnJlYWRMb25nKCk7CiAgICAgICAgICAgICAgICBlbnRyeUlkID0gcGFj\na2V0LnJlYWRMb25nKCk7CgogICAgICAgICAgICAgICAgaWYgKChmbGFncyAm\nIEJvb2tpZVByb3RvY29sLkZMQUdfRE9fRkVOQ0lORykgPT0gQm9va2llUHJv\ndG9jb2wuRkxBR19ET19GRU5DSU5HCiAgICAgICAgICAgICAgICAgICAgJiYg\naC5nZXRWZXJzaW9uKCkgPj0gMikgewogICAgICAgICAgICAgICAgICAgIG1h\nc3RlcktleSA9IG5ldyBieXRlW0Jvb2tpZVByb3RvY29sLk1BU1RFUl9LRVlf\nTEVOR1RIXTsKICAgICAgICAgICAgICAgICAgICBwYWNrZXQucmVhZEJ5dGVz\nKG1hc3RlcktleSwgMCwgQm9va2llUHJvdG9jb2wuTUFTVEVSX0tFWV9MRU5H\nVEgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQm9va2llUHJv\ndG9jb2wuUmVhZFJlcXVlc3QoaC5nZXRWZXJzaW9uKCksIGxlZGdlcklkLCBl\nbnRyeUlkLCBmbGFncywgbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCb29raWVQ\ncm90b2NvbC5SZWFkUmVxdWVzdChoLmdldFZlcnNpb24oKSwgbGVkZ2VySWQs\nIGVudHJ5SWQsIGZsYWdzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gcGFja2V0OwogICAgICAgIH0KICAg\nIH0KCiAgICBzdGF0aWMgY2xhc3MgUmVzcG9uc2VFbkRlQ29kZXJQcmVWMyBp\nbXBsZW1lbnRzIEVuRGVjb2RlciB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIE9iamVjdCBlbmNvZGUoT2JqZWN0IG1zZywgQ2hhbm5lbEJ1\nZmZlckZhY3RvcnkgYnVmZmVyRmFjdG9yeSkKICAgICAgICAgICAgICAgIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoIShtc2cgaW5zdGFu\nY2VvZiBCb29raWVQcm90b2NvbC5SZXNwb25zZSkpIHsKICAgICAgICAgICAg\nICAgIHJldHVybiBtc2c7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQm9v\na2llUHJvdG9jb2wuUmVzcG9uc2UgciA9IChCb29raWVQcm90b2NvbC5SZXNw\nb25zZSltc2c7CiAgICAgICAgICAgIENoYW5uZWxCdWZmZXIgYnVmID0gYnVm\nZmVyRmFjdG9yeS5nZXRCdWZmZXIoMjQpOwogICAgICAgICAgICBidWYud3Jp\ndGVJbnQobmV3IFBhY2tldEhlYWRlcihyLmdldFByb3RvY29sVmVyc2lvbigp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nLmdldE9wQ29kZSgpLCAoc2hvcnQpMCkudG9JbnQoKSk7CiAgICAgICAgICAg\nIGJ1Zi53cml0ZUludChyLmdldEVycm9yQ29kZSgpKTsKICAgICAgICAgICAg\nYnVmLndyaXRlTG9uZyhyLmdldExlZGdlcklkKCkpOwogICAgICAgICAgICBi\ndWYud3JpdGVMb25nKHIuZ2V0RW50cnlJZCgpKTsKCiAgICAgICAgICAgIFNl\ncnZlclN0YXRzLmdldEluc3RhbmNlKCkuaW5jcmVtZW50UGFja2V0c1NlbnQo\nKTsKICAgICAgICAgICAgaWYgKG1zZyBpbnN0YW5jZW9mIEJvb2tpZVByb3Rv\nY29sLlJlYWRSZXNwb25zZSkgewogICAgICAgICAgICAgICAgQm9va2llUHJv\ndG9jb2wuUmVhZFJlc3BvbnNlIHJyID0gKEJvb2tpZVByb3RvY29sLlJlYWRS\nZXNwb25zZSlyOwogICAgICAgICAgICAgICAgaWYgKHJyLmhhc0RhdGEoKSkg\newogICAgICAgICAgICAgICAgICAgIHJldHVybiBDaGFubmVsQnVmZmVycy53\ncmFwcGVkQnVmZmVyKGJ1ZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIENoYW5uZWxCdWZmZXJzLndyYXBwZWRCdWZmZXIocnIuZ2V0RGF0YSgpKSk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBidWY7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAobXNnIGluc3RhbmNlb2YgQm9va2llUHJvdG9jb2wuQWRkUmVz\ncG9uc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybiBidWY7CiAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNhbm5v\ndCBlbmNvZGUgdW5rbm93biByZXNwb25zZSB0eXBlIHt9IiwgbXNnLmdldENs\nYXNzKCkuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBtc2c7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIE9iamVjdCBkZWNvZGUoQ2hhbm5lbEJ1ZmZlciBidWZm\nZXIpCiAgICAgICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgZmluYWwgaW50IHJjOwogICAgICAgICAgICBmaW5hbCBsb25nIGxl\nZGdlcklkLCBlbnRyeUlkOwogICAgICAgICAgICBmaW5hbCBQYWNrZXRIZWFk\nZXIgaGVhZGVyOwoKICAgICAgICAgICAgaGVhZGVyID0gUGFja2V0SGVhZGVy\nLmZyb21JbnQoYnVmZmVyLnJlYWRJbnQoKSk7CiAgICAgICAgICAgIHJjID0g\nYnVmZmVyLnJlYWRJbnQoKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBidWZm\nZXIucmVhZExvbmcoKTsKICAgICAgICAgICAgZW50cnlJZCA9IGJ1ZmZlci5y\nZWFkTG9uZygpOwoKICAgICAgICAgICAgc3dpdGNoIChoZWFkZXIuZ2V0T3BD\nb2RlKCkpIHsKICAgICAgICAgICAgY2FzZSBCb29raWVQcm90b2NvbC5BRERF\nTlRSWToKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQm9va2llUHJvdG9j\nb2wuQWRkUmVzcG9uc2UoaGVhZGVyLmdldFZlcnNpb24oKSwgcmMsIGxlZGdl\ncklkLCBlbnRyeUlkKTsKICAgICAgICAgICAgY2FzZSBCb29raWVQcm90b2Nv\nbC5SRUFERU5UUlk6CiAgICAgICAgICAgICAgICBpZiAocmMgPT0gQm9va2ll\nUHJvdG9jb2wuRU9LKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBCb29raWVQcm90b2NvbC5SZWFkUmVzcG9uc2UoaGVhZGVyLmdldFZlcnNp\nb24oKSwgcmMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQsIGVudHJ5SWQsIGJ1\nZmZlci5zbGljZSgpKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCb29raWVQcm90b2NvbC5SZWFk\nUmVzcG9uc2UoaGVhZGVyLmdldFZlcnNpb24oKSwgcmMsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbGVkZ2VySWQsIGVudHJ5SWQpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGJ1ZmZl\ncjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMg\nY2xhc3MgUmVxdWVzdEVuRGVjb2RlclYzIGltcGxlbWVudHMgRW5EZWNvZGVy\nIHsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIE9iamVjdCBk\nZWNvZGUoQ2hhbm5lbEJ1ZmZlciBwYWNrZXQpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgICAgICByZXR1cm4gQm9va2tlZXBlclByb3RvY29sLlJlcXVl\nc3QucGFyc2VGcm9tKG5ldyBDaGFubmVsQnVmZmVySW5wdXRTdHJlYW0ocGFj\na2V0KSk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgT2JqZWN0IGVuY29kZShPYmplY3QgbXNnLCBDaGFubmVsQnVmZmVy\nRmFjdG9yeSBmYWN0b3J5KSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgQm9va2tlZXBlclByb3RvY29sLlJlcXVlc3QgcmVxdWVzdCA9IChCb29r\na2VlcGVyUHJvdG9jb2wuUmVxdWVzdCkgbXNnOwogICAgICAgICAgICByZXR1\ncm4gQ2hhbm5lbEJ1ZmZlcnMud3JhcHBlZEJ1ZmZlcihyZXF1ZXN0LnRvQnl0\nZUFycmF5KCkpOwogICAgICAgIH0KCiAgICB9CgogICAgc3RhdGljIGNsYXNz\nIFJlc3BvbnNlRW5EZWNvZGVyVjMgaW1wbGVtZW50cyBFbkRlY29kZXIgewoK\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgT2JqZWN0IGRlY29k\nZShDaGFubmVsQnVmZmVyIHBhY2tldCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIHJldHVybiBCb29ra2VlcGVyUHJvdG9jb2wuUmVzcG9uc2Uu\ncGFyc2VGcm9tKG5ldyBDaGFubmVsQnVmZmVySW5wdXRTdHJlYW0ocGFja2V0\nKSk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgT2JqZWN0IGVuY29kZShPYmplY3QgbXNnLCBDaGFubmVsQnVmZmVyRmFj\ndG9yeSBmYWN0b3J5KSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nQm9va2tlZXBlclByb3RvY29sLlJlc3BvbnNlIHJlc3BvbnNlID0gKEJvb2tr\nZWVwZXJQcm90b2NvbC5SZXNwb25zZSkgbXNnOwogICAgICAgICAgICByZXR1\ncm4gQ2hhbm5lbEJ1ZmZlcnMud3JhcHBlZEJ1ZmZlcihyZXNwb25zZS50b0J5\ndGVBcnJheSgpKTsKICAgICAgICB9CgogICAgfQoKICAgIHB1YmxpYyBzdGF0\naWMgY2xhc3MgUmVxdWVzdEVuY29kZXIgZXh0ZW5kcyBPbmVUb09uZUVuY29k\nZXIgewoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwcm90ZWN0ZWQgT2Jq\nZWN0IGVuY29kZShDaGFubmVsSGFuZGxlckNvbnRleHQgY3R4LCBDaGFubmVs\nIGNoYW5uZWwsIE9iamVjdCBtc2cpCiAgICAgICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxl\nZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkVuY29kZSByZXF1\nZXN0IHt9IHRvIGNoYW5uZWwge30uIiwgbXNnLCBjaGFubmVsKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAobXNnIGluc3RhbmNlb2YgQm9va2tl\nZXBlclByb3RvY29sLlJlcXVlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiBSRVFfVjMuZW5jb2RlKG1zZywgY3R4LmdldENoYW5uZWwoKS5nZXRDb25m\naWcoKS5nZXRCdWZmZXJGYWN0b3J5KCkpOwogICAgICAgICAgICB9IGVsc2Ug\naWYgKG1zZyBpbnN0YW5jZW9mIEJvb2tpZVByb3RvY29sLlJlcXVlc3QpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBSRVFfUFJFVjMuZW5jb2RlKG1zZywg\nY3R4LmdldENoYW5uZWwoKS5nZXRDb25maWcoKS5nZXRCdWZmZXJGYWN0b3J5\nKCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJJbnZhbGlkIHJlcXVlc3QgdG8gZW5jb2RlIHRvIHt9OiB7fSIs\nIGNoYW5uZWwsIG1zZy5nZXRDbGFzcygpLmdldE5hbWUoKSk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gbXNnOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgUmVxdWVzdERlY29kZXIg\nZXh0ZW5kcyBPbmVUb09uZURlY29kZXIgewoKICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwcm90ZWN0ZWQgT2JqZWN0IGRlY29kZShDaGFubmVsSGFuZGxl\nckNvbnRleHQgY3R4LCBDaGFubmVsIGNoYW5uZWwsIE9iamVjdCBtc2cpCiAg\nICAgICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\naWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoIlJlY2VpdmVkIHJlcXVlc3Qge30gZnJvbSBjaGFubmVsIHt9\nIHRvIGRlY29kZS4iLCBtc2csIGNoYW5uZWwpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGlmICghKG1zZyBpbnN0YW5jZW9mIENoYW5uZWxCdWZmZXIp\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbXNnOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIENoYW5uZWxCdWZmZXIgYnVmZmVyID0gKENoYW5uZWxC\ndWZmZXIpIG1zZzsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGJ1ZmZlci5tYXJrUmVhZGVySW5kZXgoKTsKICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJFUV9WMy5kZWNvZGUo\nYnVmZmVyKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nYnVmZmVyLnJlc2V0UmVhZGVySW5kZXgoKTsKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gUkVRX1BSRVYzLmRlY29kZShidWZmZXIpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJGYWlsZWQgdG8gZGVjb2RlIGEg\ncmVxdWVzdCBmcm9tIHt9IDogIiwgY2hhbm5lbCwgZSk7CiAgICAgICAgICAg\nICAgICB0aHJvdyBlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgUmVzcG9uc2VFbmNvZGVyIGV4dGVu\nZHMgT25lVG9PbmVFbmNvZGVyIHsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHJvdGVjdGVkIE9iamVjdCBlbmNvZGUoQ2hhbm5lbEhhbmRsZXJDb250\nZXh0IGN0eCwgQ2hhbm5lbCBjaGFubmVsLCBPYmplY3QgbXNnKQogICAgICAg\nICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChM\nT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJFbmNvZGUgcmVzcG9uc2Uge30gdG8gY2hhbm5lbCB7fS4iLCBtc2cs\nIGNoYW5uZWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtc2cg\naW5zdGFuY2VvZiBCb29ra2VlcGVyUHJvdG9jb2wuUmVzcG9uc2UpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBSRVBfVjMuZW5jb2RlKG1zZywgY3R4Lmdl\ndENoYW5uZWwoKS5nZXRDb25maWcoKS5nZXRCdWZmZXJGYWN0b3J5KCkpOwog\nICAgICAgICAgICB9IGVsc2UgaWYgKG1zZyBpbnN0YW5jZW9mIEJvb2tpZVBy\nb3RvY29sLlJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gUkVQ\nX1BSRVYzLmVuY29kZShtc2csIGN0eC5nZXRDaGFubmVsKCkuZ2V0Q29uZmln\nKCkuZ2V0QnVmZmVyRmFjdG9yeSgpKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiSW52YWxpZCByZXNwb25zZSB0\nbyBlbmNvZGUgdG8ge306IHt9IiwgY2hhbm5lbCwgbXNnLmdldENsYXNzKCku\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybiBtc2c7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBj\nbGFzcyBSZXNwb25zZURlY29kZXIgZXh0ZW5kcyBPbmVUb09uZURlY29kZXIg\newoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwcm90ZWN0ZWQgT2JqZWN0\nIGRlY29kZShDaGFubmVsSGFuZGxlckNvbnRleHQgY3R4LCBDaGFubmVsIGNo\nYW5uZWwsIE9iamVjdCBtc2cpCiAgICAgICAgICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlJlY2VpdmVkIHJlc3Bv\nbnNlIHt9IGZyb20gY2hhbm5lbCB7fSB0byBkZWNvZGUuIiwgbXNnLCBjaGFu\nbmVsKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIShtc2cgaW5z\ndGFuY2VvZiBDaGFubmVsQnVmZmVyKSkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIG1zZzsKICAgICAgICAgICAgfQogICAgICAgICAgICBDaGFubmVsQnVm\nZmVyIGJ1ZmZlciA9IChDaGFubmVsQnVmZmVyKSBtc2c7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBidWZmZXIubWFya1JlYWRlckluZGV4\nKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBSRVBfVjMuZGVjb2RlKGJ1ZmZlcik7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgICAgIGJ1ZmZlci5yZXNldFJlYWRlckluZGV4\nKCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFJFUF9QUkVWMy5kZWNv\nZGUoYnVmZmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiRmFpbGVkIHRvIGRlY29kZSBhIHJlc3BvbnNlIGZyb20gY2hhbm5lbCB7\nfSA6ICIsIGNoYW5uZWwsIGUpOwogICAgICAgICAgICAgICAgdGhyb3cgZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

