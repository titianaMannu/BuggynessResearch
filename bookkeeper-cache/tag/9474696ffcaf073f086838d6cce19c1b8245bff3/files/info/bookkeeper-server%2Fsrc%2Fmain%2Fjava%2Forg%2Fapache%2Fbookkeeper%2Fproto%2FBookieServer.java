{"sha":"bf5f438ac28647d885e0630fe3505ba93278533b","node_id":"MDQ6QmxvYjE1NzU5NTY6YmY1ZjQzOGFjMjg2NDdkODg1ZTA2MzBmZTM1MDViYTkzMjc4NTMzYg==","size":14025,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/bf5f438ac28647d885e0630fe3505ba93278533b","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90bzsKCmlt\ncG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5uZXQuTWFsZm9ybWVkVVJMRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uZXQuVW5rbm93bkhvc3RFeGNlcHRpb247CgppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWU7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUNyaXRpY2FsVGhyZWFk\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWVF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2ll\nLkV4aXRDb2RlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYu\nU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5qbXguQktNQmVhblJlZ2lzdHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLm5ldC5Cb29raWVTb2NrZXRBZGRyZXNzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnByb2Nlc3Nvci5SZXF1ZXN0UHJvY2Vzc29y\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLkF1\ndG9SZWNvdmVyeU1haW47CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNlcHRpb24uQ29tcGF0aWJpbGl0\neUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBs\naWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5OdWxs\nU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3Rh\ndHMuU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nc3RhdHMuU3RhdHNQcm92aWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLlJlZmxlY3Rpb25VdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5jbGkuQmFzaWNQYXJzZXI7CmltcG9ydCBvcmcuYXBhY2hlLmNv\nbW1vbnMuY2xpLkNvbW1hbmRMaW5lOwppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmNsaS5IZWxwRm9ybWF0dGVyOwppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmNsaS5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNs\naS5QYXJzZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb25maWd1cmF0aW9uLkNvbmZpZ3VyYXRpb25FeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rv\ncnk7CgppbXBvcnQgY29tLmdvb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlz\naWJsZUZvclRlc3Rpbmc7CgppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5ib29raWUuQm9va0tlZXBlclNlcnZlclN0YXRzLkJPT0tJRV9T\nQ09QRTsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9v\na2llLkJvb2tLZWVwZXJTZXJ2ZXJTdGF0cy5TRVJWRVJfU0NPUEU7CmltcG9y\ndCBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJl\ncGxpY2F0aW9uU3RhdHMuUkVQTElDQVRJT05fU0NPUEU7CgovKioKICogSW1w\nbGVtZW50cyB0aGUgc2VydmVyLXNpZGUgcGFydCBvZiB0aGUgQm9va0tlZXBl\nciBwcm90b2NvbC4KICoKICovCnB1YmxpYyBjbGFzcyBCb29raWVTZXJ2ZXIg\newogICAgZmluYWwgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwogICAgQm9v\na2llTmV0dHlTZXJ2ZXIgbmV0dHlTZXJ2ZXI7CiAgICBwcml2YXRlIHZvbGF0\naWxlIGJvb2xlYW4gcnVubmluZyA9IGZhbHNlOwogICAgQm9va2llIGJvb2tp\nZTsKICAgIERlYXRoV2F0Y2hlciBkZWF0aFdhdGNoZXI7CiAgICBwcml2YXRl\nIGZpbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRM\nb2dnZXIoQm9va2llU2VydmVyLmNsYXNzKTsKCiAgICBpbnQgZXhpdENvZGUg\nPSBFeGl0Q29kZS5PSzsKCiAgICAvLyBvcGVyYXRpb24gc3RhdHMKICAgIHBy\nb3RlY3RlZCBCb29raWVTZXJ2ZXJCZWFuIGpteEJrU2VydmVyQmVhbjsKICAg\nIEF1dG9SZWNvdmVyeU1haW4gYXV0b1JlY292ZXJ5TWFpbiA9IG51bGw7CiAg\nICBwcml2YXRlIGJvb2xlYW4gaXNBdXRvUmVjb3ZlcnlEYWVtb25FbmFibGVk\nOwoKICAgIC8vIHJlcXVlc3QgcHJvY2Vzc29yCiAgICBwcml2YXRlIGZpbmFs\nIFJlcXVlc3RQcm9jZXNzb3IgcmVxdWVzdFByb2Nlc3NvcjsKCiAgICAvLyBF\neHBvc2UgU3RhdHMKICAgIHByaXZhdGUgZmluYWwgU3RhdHNMb2dnZXIgc3Rh\ndHNMb2dnZXI7CgogICAgcHVibGljIEJvb2tpZVNlcnZlcihTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYpIHRocm93cyBJT0V4Y2VwdGlvbiwKICAgICAgICAg\nICAgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQm9v\na2llRXhjZXB0aW9uLAogICAgICAgICAgICBVbmF2YWlsYWJsZUV4Y2VwdGlv\nbiwgQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiB7CiAgICAgICAgdGhpcyhjb25m\nLCBOdWxsU3RhdHNMb2dnZXIuSU5TVEFOQ0UpOwogICAgfQoKICAgIHB1Ymxp\nYyBCb29raWVTZXJ2ZXIoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mLCBTdGF0\nc0xvZ2dlciBzdGF0c0xvZ2dlcikKICAgICAgICAgICAgdGhyb3dzIElPRXhj\nZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nLAogICAgICAgICAgICBCb29raWVFeGNlcHRpb24sIFVuYXZhaWxhYmxlRXhj\nZXB0aW9uLCBDb21wYXRpYmlsaXR5RXhjZXB0aW9uIHsKICAgICAgICB0aGlz\nLmNvbmYgPSBjb25mOwogICAgICAgIHRoaXMuc3RhdHNMb2dnZXIgPSBzdGF0\nc0xvZ2dlcjsKICAgICAgICB0aGlzLmJvb2tpZSA9IG5ld0Jvb2tpZShjb25m\nKTsKICAgICAgICB0aGlzLnJlcXVlc3RQcm9jZXNzb3IgPSBuZXcgQm9va2ll\nUmVxdWVzdFByb2Nlc3Nvcihjb25mLCBib29raWUsCiAgICAgICAgICAgICAg\nICBzdGF0c0xvZ2dlci5zY29wZShTRVJWRVJfU0NPUEUpKTsKICAgICAgICB0\naGlzLm5ldHR5U2VydmVyID0gbmV3IEJvb2tpZU5ldHR5U2VydmVyKHRoaXMu\nY29uZiwgcmVxdWVzdFByb2Nlc3Nvcik7CiAgICAgICAgaXNBdXRvUmVjb3Zl\ncnlEYWVtb25FbmFibGVkID0gY29uZi5pc0F1dG9SZWNvdmVyeURhZW1vbkVu\nYWJsZWQoKTsKICAgICAgICBpZiAoaXNBdXRvUmVjb3ZlcnlEYWVtb25FbmFi\nbGVkKSB7CiAgICAgICAgICAgIHRoaXMuYXV0b1JlY292ZXJ5TWFpbiA9IG5l\ndyBBdXRvUmVjb3ZlcnlNYWluKGNvbmYsIHN0YXRzTG9nZ2VyLnNjb3BlKFJF\nUExJQ0FUSU9OX1NDT1BFKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3Rl\nY3RlZCBCb29raWUgbmV3Qm9va2llKFNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZikKICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlv\nbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAg\nICAgICAgcmV0dXJuIG5ldyBCb29raWUoY29uZiwgc3RhdHNMb2dnZXIuc2Nv\ncGUoQk9PS0lFX1NDT1BFKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Rh\ncnQoKSB0aHJvd3MgSU9FeGNlcHRpb24sIFVuYXZhaWxhYmxlRXhjZXB0aW9u\nIHsKICAgICAgICB0aGlzLmJvb2tpZS5zdGFydCgpOwogICAgICAgIC8vIGZh\naWwgZmFzdCwgd2hlbiBib29raWUgc3RhcnR1cCBpcyBub3Qgc3VjY2Vzc2Z1\nbAogICAgICAgIGlmICghdGhpcy5ib29raWUuaXNSdW5uaW5nKCkpIHsKICAg\nICAgICAgICAgZXhpdENvZGUgPSBib29raWUuZ2V0RXhpdENvZGUoKTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAoaXNBdXRv\nUmVjb3ZlcnlEYWVtb25FbmFibGVkICYmIHRoaXMuYXV0b1JlY292ZXJ5TWFp\nbiAhPSBudWxsKSB7CiAgICAgICAgICAgIHRoaXMuYXV0b1JlY292ZXJ5TWFp\nbi5zdGFydCgpOwogICAgICAgIH0KICAgICAgICB0aGlzLm5ldHR5U2VydmVy\nLnN0YXJ0KCk7CgogICAgICAgIHJ1bm5pbmcgPSB0cnVlOwogICAgICAgIGRl\nYXRoV2F0Y2hlciA9IG5ldyBEZWF0aFdhdGNoZXIoY29uZik7CiAgICAgICAg\nZGVhdGhXYXRjaGVyLnN0YXJ0KCk7CgogICAgICAgIC8vIHJlZ2lzdGVyIGpt\neAogICAgICAgIHJlZ2lzdGVySk1YKCk7CiAgICB9CgogICAgQFZpc2libGVG\nb3JUZXN0aW5nCiAgICBwdWJsaWMgQm9va2llU29ja2V0QWRkcmVzcyBnZXRM\nb2NhbEFkZHJlc3MoKSB0aHJvd3MgVW5rbm93bkhvc3RFeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBCb29raWUuZ2V0Qm9va2llQWRkcmVzcyhjb25mKTsK\nICAgIH0KCiAgICBAVmlzaWJsZUZvclRlc3RpbmcKICAgIHB1YmxpYyBCb29r\naWUgZ2V0Qm9va2llKCkgewogICAgICAgIHJldHVybiBib29raWU7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTdXNwZW5kIHByb2Nlc3Npbmcgb2YgcmVxdWVz\ndHMgaW4gdGhlIGJvb2tpZSAoZm9yIHRlc3RpbmcpCiAgICAgKi8KICAgIEBW\naXNpYmxlRm9yVGVzdGluZwogICAgcHVibGljIHZvaWQgc3VzcGVuZFByb2Nl\nc3NpbmcoKSB7CiAgICAgICAgTE9HLmRlYnVnKCJTdXNwZW5kaW5nIGJvb2tp\nZSBzZXJ2ZXIsIHBvcnQgaXMge30iLCBjb25mLmdldEJvb2tpZVBvcnQoKSk7\nCiAgICAgICAgbmV0dHlTZXJ2ZXIuc3VzcGVuZFByb2Nlc3NpbmcoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFJlc3VtZSBwcm9jZXNzaW5nIHJlcXVlc3Rz\nIGluIHRoZSBib29raWUgKGZvciB0ZXN0aW5nKQogICAgICovCiAgICBAVmlz\naWJsZUZvclRlc3RpbmcKICAgIHB1YmxpYyB2b2lkIHJlc3VtZVByb2Nlc3Np\nbmcoKSB7CiAgICAgICAgTE9HLmRlYnVnKCJSZXN1bWluZyBib29raWUgc2Vy\ndmVyLCBwb3J0IGlzIHt9IiwgY29uZi5nZXRCb29raWVQb3J0KCkpOwogICAg\nICAgIG5ldHR5U2VydmVyLnJlc3VtZVByb2Nlc3NpbmcoKTsKICAgIH0KCiAg\nICBwdWJsaWMgc3luY2hyb25pemVkIHZvaWQgc2h1dGRvd24oKSB7CiAgICAg\nICAgaWYgKCFydW5uaW5nKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CiAgICAgICAgTE9HLmluZm8oIlNodXR0aW5nIGRvd24gQm9va2llU2Vy\ndmVyIik7CiAgICAgICAgdGhpcy5uZXR0eVNlcnZlci5zaHV0ZG93bigpOwog\nICAgICAgIGV4aXRDb2RlID0gYm9va2llLnNodXRkb3duKCk7CiAgICAgICAg\naWYgKGlzQXV0b1JlY292ZXJ5RGFlbW9uRW5hYmxlZCAmJiB0aGlzLmF1dG9S\nZWNvdmVyeU1haW4gIT0gbnVsbCkgewogICAgICAgICAgICB0aGlzLmF1dG9S\nZWNvdmVyeU1haW4uc2h1dGRvd24oKTsKICAgICAgICB9CiAgICAgICAgdGhp\ncy5yZXF1ZXN0UHJvY2Vzc29yLmNsb3NlKCk7CiAgICAgICAgcnVubmluZyA9\nIGZhbHNlOwoKICAgICAgICAvLyB1bnJlZ2lzdGVyIEpNWAogICAgICAgIHVu\ncmVnaXN0ZXJKTVgoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCByZWdp\nc3RlckpNWCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBqbXhCa1Nl\ncnZlckJlYW4gPSBuZXcgQm9va2llU2VydmVyQmVhbihjb25mLCB0aGlzKTsK\nICAgICAgICAgICAgQktNQmVhblJlZ2lzdHJ5LmdldEluc3RhbmNlKCkucmVn\naXN0ZXIoam14QmtTZXJ2ZXJCZWFuLCBudWxsKTsKCiAgICAgICAgICAgIGJv\nb2tpZS5yZWdpc3RlckpNWChqbXhCa1NlcnZlckJlYW4pOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJG\nYWlsZWQgdG8gcmVnaXN0ZXIgd2l0aCBKTVgiLCBlKTsKICAgICAgICAgICAg\nam14QmtTZXJ2ZXJCZWFuID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAg\ncHJvdGVjdGVkIHZvaWQgdW5yZWdpc3RlckpNWCgpIHsKICAgICAgICB0cnkg\newogICAgICAgICAgICBib29raWUudW5yZWdpc3RlckpNWCgpOwogICAgICAg\nICAgICBpZiAoam14QmtTZXJ2ZXJCZWFuICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgIEJLTUJlYW5SZWdpc3RyeS5nZXRJbnN0YW5jZSgpLnVucmVnaXN0\nZXIoam14QmtTZXJ2ZXJCZWFuKTsKICAgICAgICAgICAgfQogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJG\nYWlsZWQgdG8gdW5yZWdpc3RlciB3aXRoIEpNWCIsIGUpOwogICAgICAgIH0K\nICAgICAgICBqbXhCa1NlcnZlckJlYW4gPSBudWxsOwogICAgfQoKICAgIHB1\nYmxpYyBib29sZWFuIGlzUnVubmluZygpIHsKICAgICAgICByZXR1cm4gYm9v\na2llLmlzUnVubmluZygpICYmIG5ldHR5U2VydmVyLmlzUnVubmluZygpICYm\nIHJ1bm5pbmc7CiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIGJvb2tp\nZSBpcyBydW5uaW5nPwogICAgICoKICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBi\nb29raWUgaXMgcnVubmluZywgb3RoZXJ3aXNlIHJldHVybiBmYWxzZQogICAg\nICovCiAgICBwdWJsaWMgYm9vbGVhbiBpc0Jvb2tpZVJ1bm5pbmcoKSB7CiAg\nICAgICAgcmV0dXJuIGJvb2tpZS5pc1J1bm5pbmcoKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFdoZXRoZXIgYXV0by1yZWNvdmVyeSBzZXJ2aWNlIHJ1bm5p\nbmcgd2l0aCBCb29raWU/CiAgICAgKgogICAgICogQHJldHVybiB0cnVlIGlm\nIGF1dG8tcmVjb3Zlcnkgc2VydmljZSBpcyBydW5uaW5nLCBvdGhlcndpc2Ug\ncmV0dXJuIGZhbHNlCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQXV0\nb1JlY292ZXJ5UnVubmluZygpIHsKICAgICAgICByZXR1cm4gdGhpcy5hdXRv\nUmVjb3ZlcnlNYWluICE9IG51bGwKICAgICAgICAgICAgICAgICYmIHRoaXMu\nYXV0b1JlY292ZXJ5TWFpbi5pc0F1dG9SZWNvdmVyeVJ1bm5pbmcoKTsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBqb2luKCkgdGhyb3dzIEludGVycnVwdGVk\nRXhjZXB0aW9uIHsKICAgICAgICBib29raWUuam9pbigpOwogICAgfQoKICAg\nIHB1YmxpYyBpbnQgZ2V0RXhpdENvZGUoKSB7CiAgICAgICAgcmV0dXJuIGV4\naXRDb2RlOwogICAgfQoKICAgIC8qKgogICAgICogQSB0aHJlYWQgdG8gd2F0\nY2ggd2hldGhlciBib29raWUgJiBuaW9zZXJ2ZXIgaXMgc3RpbGwgYWxpdmUK\nICAgICAqLwogICAgcHJpdmF0ZSBjbGFzcyBEZWF0aFdhdGNoZXIgZXh0ZW5k\ncyBCb29raWVDcml0aWNhbFRocmVhZCB7CgogICAgICAgIHByaXZhdGUgZmlu\nYWwgaW50IHdhdGNoSW50ZXJ2YWw7CgogICAgICAgIERlYXRoV2F0Y2hlcihT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpIHsKICAgICAgICAgICAgc3VwZXIo\nIkJvb2tpZURlYXRoV2F0Y2hlci0iICsgY29uZi5nZXRCb29raWVQb3J0KCkp\nOwogICAgICAgICAgICB3YXRjaEludGVydmFsID0gY29uZi5nZXREZWF0aFdh\ndGNoSW50ZXJ2YWwoKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgd2hpbGUo\ndHJ1ZSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBUaHJlYWQuc2xlZXAod2F0Y2hJbnRlcnZhbCk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGlmICghaXNCb29raWVSdW5uaW5nKCkpIHsK\nICAgICAgICAgICAgICAgICAgICBzaHV0ZG93bigpOwogICAgICAgICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgaWYgKGlzQXV0b1JlY292ZXJ5RGFlbW9uRW5hYmxlZCAmJiAhaXNBdXRv\nUmVjb3ZlcnlSdW5uaW5nKCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cu\nZXJyb3IoIkF1dG9yZWNvdmVyeSBkYWVtb24gaGFzIHN0b3BwZWQuIFBsZWFz\nZSBjaGVjayB0aGUgbG9ncyIpOwogICAgICAgICAgICAgICAgICAgIGlzQXV0\nb1JlY292ZXJ5RGFlbW9uRW5hYmxlZCA9IGZhbHNlOyAvLyB0byBhdm9pZCBz\ncGFtbWluZyB0aGUgbG9ncwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIExPRy5pbmZvKCJCb29raWVEZWF0aFdhdGNoZXIg\nZXhpdGVkIGxvb3AhIik7CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBm\naW5hbCBPcHRpb25zIGJrT3B0cyA9IG5ldyBPcHRpb25zKCk7CiAgICBzdGF0\naWMgewogICAgICAgIGJrT3B0cy5hZGRPcHRpb24oImMiLCAiY29uZiIsIHRy\ndWUsICJDb25maWd1cmF0aW9uIGZvciBCb29raWUgU2VydmVyIik7CiAgICAg\nICAgYmtPcHRzLmFkZE9wdGlvbigid2l0aEF1dG9SZWNvdmVyeSIsIGZhbHNl\nLAogICAgICAgICAgICAgICAgIlN0YXJ0IEF1dG9yZWNvdmVyeSBzZXJ2aWNl\nIEJvb2tpZSBzZXJ2ZXIiKTsKICAgICAgICBia09wdHMuYWRkT3B0aW9uKCJo\nIiwgImhlbHAiLCBmYWxzZSwgIlByaW50IGhlbHAgbWVzc2FnZSIpOwogICAg\nfQoKICAgIC8qKgogICAgICogUHJpbnQgdXNhZ2UKICAgICAqLwogICAgcHJp\ndmF0ZSBzdGF0aWMgdm9pZCBwcmludFVzYWdlKCkgewogICAgICAgIEhlbHBG\nb3JtYXR0ZXIgaGYgPSBuZXcgSGVscEZvcm1hdHRlcigpOwogICAgICAgIGhm\nLnByaW50SGVscCgiQm9va2llU2VydmVyIFtvcHRpb25zXVxuXHRvclxuIgog\nICAgICAgICAgICAgICAgICAgKyAiQm9va2llU2VydmVyIDxib29raWVfcG9y\ndD4gPHprX3NlcnZlcnM+IDxqb3VybmFsX2Rpcj4gPGxlZGdlcl9kaXIgW2xl\nZGdlcl9kaXJdPiIsIGJrT3B0cyk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgdm9pZCBsb2FkQ29uZkZpbGUoU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nLCBTdHJpbmcgY29uZkZpbGUpCiAgICAgICAgdGhyb3dzIElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29u\nZi5sb2FkQ29uZihuZXcgRmlsZShjb25mRmlsZSkudG9VUkkoKS50b1VSTCgp\nKTsKICAgICAgICAgICAgY29uZi52YWxpZGF0ZSgpOwogICAgICAgIH0gY2F0\nY2ggKE1hbGZvcm1lZFVSTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiQ291bGQgbm90IG9wZW4gY29uZmlndXJhdGlvbiBmaWxlOiAi\nICsgY29uZkZpbGUsIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdh\nbEFyZ3VtZW50RXhjZXB0aW9uKCk7CiAgICAgICAgfSBjYXRjaCAoQ29uZmln\ndXJhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nTWFsZm9ybWVkIGNvbmZpZ3VyYXRpb24gZmlsZTogIiArIGNvbmZGaWxlLCBl\nKTsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2Vw\ndGlvbigpOwogICAgICAgIH0KICAgICAgICBMT0cuaW5mbygiVXNpbmcgY29u\nZmlndXJhdGlvbiBmaWxlICIgKyBjb25mRmlsZSk7CiAgICB9CgogICAgcHJp\ndmF0ZSBzdGF0aWMgU2VydmVyQ29uZmlndXJhdGlvbiBwYXJzZUFyZ3MoU3Ry\naW5nW10gYXJncykKICAgICAgICB0aHJvd3MgSWxsZWdhbEFyZ3VtZW50RXhj\nZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBCYXNpY1BhcnNl\nciBwYXJzZXIgPSBuZXcgQmFzaWNQYXJzZXIoKTsKICAgICAgICAgICAgQ29t\nbWFuZExpbmUgY21kTGluZSA9IHBhcnNlci5wYXJzZShia09wdHMsIGFyZ3Mp\nOwoKICAgICAgICAgICAgaWYgKGNtZExpbmUuaGFzT3B0aW9uKCdoJykpIHsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNl\ncHRpb24oKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICAgICAgU3RyaW5nW10gbGVmdEFyZ3MgPSBjbWRMaW5lLmdldEFy\nZ3MoKTsKCiAgICAgICAgICAgIGlmIChjbWRMaW5lLmhhc09wdGlvbignYycp\nKSB7CiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBsZWZ0QXJncyAmJiBs\nZWZ0QXJncy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgU3RyaW5nIGNvbmZGaWxlID0gY21k\nTGluZS5nZXRPcHRpb25WYWx1ZSgiYyIpOwogICAgICAgICAgICAgICAgbG9h\nZENvbmZGaWxlKGNvbmYsIGNvbmZGaWxlKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBjb25mOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY21k\nTGluZS5oYXNPcHRpb24oIndpdGhBdXRvUmVjb3ZlcnkiKSkgewogICAgICAg\nICAgICAgICAgY29uZi5zZXRBdXRvUmVjb3ZlcnlEYWVtb25FbmFibGVkKHRy\ndWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobGVmdEFyZ3Mu\nbGVuZ3RoIDwgNCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVn\nYWxBcmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBjb21tYW5kIGxpbmUgYXJndW1lbnRzIG92ZXJ3cml0ZSBzZXR0\naW5ncyBpbiBjb25maWd1cmF0aW9uIGZpbGUKICAgICAgICAgICAgY29uZi5z\nZXRCb29raWVQb3J0KEludGVnZXIucGFyc2VJbnQobGVmdEFyZ3NbMF0pKTsK\nICAgICAgICAgICAgY29uZi5zZXRaa1NlcnZlcnMobGVmdEFyZ3NbMV0pOwog\nICAgICAgICAgICBjb25mLnNldEpvdXJuYWxEaXJOYW1lKGxlZnRBcmdzWzJd\nKTsKICAgICAgICAgICAgU3RyaW5nW10gbGVkZ2VyRGlyTmFtZXMgPSBuZXcg\nU3RyaW5nW2xlZnRBcmdzLmxlbmd0aCAtIDNdOwogICAgICAgICAgICBTeXN0\nZW0uYXJyYXljb3B5KGxlZnRBcmdzLCAzLCBsZWRnZXJEaXJOYW1lcywgMCwg\nbGVkZ2VyRGlyTmFtZXMubGVuZ3RoKTsKICAgICAgICAgICAgY29uZi5zZXRM\nZWRnZXJEaXJOYW1lcyhsZWRnZXJEaXJOYW1lcyk7CgogICAgICAgICAgICBy\nZXR1cm4gY29uZjsKICAgICAgICB9IGNhdGNoIChQYXJzZUV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgcGFyc2luZyBjb21t\nYW5kIGxpbmUgYXJndW1lbnRzIDogIiwgZSk7CiAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQHBhcmFtIGFyZ3MKICAgICAqIEB0aHJv\nd3MgSU9FeGNlcHRpb24KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24KICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIG1haW4oU3Ry\naW5nW10gYXJncykgewogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uZiA9IHBh\ncnNlQXJncyhhcmdzKTsKICAgICAgICB9IGNhdGNoIChJbGxlZ2FsQXJndW1l\nbnRFeGNlcHRpb24gaWFlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJy\nb3IgcGFyc2luZyBjb21tYW5kIGxpbmUgYXJndW1lbnRzIDogIiwgaWFlKTsK\nICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKGlhZS5nZXRNZXNzYWdl\nKCkpOwogICAgICAgICAgICBwcmludFVzYWdlKCk7CiAgICAgICAgICAgIFN5\nc3RlbS5leGl0KEV4aXRDb2RlLklOVkFMSURfQ09ORik7CiAgICAgICAgfQoK\nICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIo\nKTsKICAgICAgICBTdHJpbmdbXSBsZWRnZXJEaXJOYW1lcyA9IGNvbmYuZ2V0\nTGVkZ2VyRGlyTmFtZXMoKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGxlZGdlckRpck5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGlm\nIChpICE9IDApIHsKICAgICAgICAgICAgICAgIHNiLmFwcGVuZCgnLCcpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHNiLmFwcGVuZChsZWRnZXJEaXJO\nYW1lc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgaGVsbG8gPSBT\ndHJpbmcuZm9ybWF0KAogICAgICAgICAgICAgICAgICAgICAgICAgICAiSGVs\nbG8sIEknbSB5b3VyIGJvb2tpZSwgbGlzdGVuaW5nIG9uIHBvcnQgJTEkcy4g\nWktTZXJ2ZXJzIGFyZSBvbiAlMiRzLiBKb3VybmFscyBhcmUgaW4gJTMkcy4g\nTGVkZ2VycyBhcmUgc3RvcmVkIGluICU0JHMuIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgY29uZi5nZXRCb29raWVQb3J0KCksIGNvbmYuZ2V0WmtT\nZXJ2ZXJzKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmYuZ2V0\nSm91cm5hbERpck5hbWUoKSwgc2IpOwogICAgICAgIExPRy5pbmZvKGhlbGxv\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBJbml0aWFsaXplIFN0\nYXRzIFByb3ZpZGVyCiAgICAgICAgICAgIENsYXNzPD8gZXh0ZW5kcyBTdGF0\nc1Byb3ZpZGVyPiBzdGF0c1Byb3ZpZGVyQ2xhc3MgPQogICAgICAgICAgICAg\nICAgICAgIGNvbmYuZ2V0U3RhdHNQcm92aWRlckNsYXNzKCk7CiAgICAgICAg\nICAgIGZpbmFsIFN0YXRzUHJvdmlkZXIgc3RhdHNQcm92aWRlciA9IFJlZmxl\nY3Rpb25VdGlscy5uZXdJbnN0YW5jZShzdGF0c1Byb3ZpZGVyQ2xhc3MpOwog\nICAgICAgICAgICBzdGF0c1Byb3ZpZGVyLnN0YXJ0KGNvbmYpOwoKICAgICAg\nICAgICAgZmluYWwgQm9va2llU2VydmVyIGJzID0gbmV3IEJvb2tpZVNlcnZl\ncihjb25mLCBzdGF0c1Byb3ZpZGVyLmdldFN0YXRzTG9nZ2VyKCIiKSk7CiAg\nICAgICAgICAgIGJzLnN0YXJ0KCk7CiAgICAgICAgICAgIFJ1bnRpbWUuZ2V0\nUnVudGltZSgpLmFkZFNodXRkb3duSG9vayhuZXcgVGhyZWFkKCkgewogICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMg\ndm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgYnMuc2h1dGRvd24o\nKTsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiU2h1dCBkb3duIGJv\nb2tpZSBzZXJ2ZXIgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBMT0cuaW5mbygiUmVnaXN0\nZXIgc2h1dGRvd24gaG9vayBzdWNjZXNzZnVsbHkiKTsKICAgICAgICAgICAg\nYnMuam9pbigpOwoKICAgICAgICAgICAgc3RhdHNQcm92aWRlci5zdG9wKCk7\nCiAgICAgICAgICAgIExPRy5pbmZvKCJTdG9wIHN0YXRzIHByb3ZpZGVyIik7\nCiAgICAgICAgICAgIFN5c3RlbS5leGl0KGJzLmdldEV4aXRDb2RlKCkpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiRXhjZXB0aW9uIHJ1bm5pbmcgYm9va2llIHNlcnZlciA6ICIs\nIGUpOwogICAgICAgICAgICBTeXN0ZW0uZXhpdChFeGl0Q29kZS5TRVJWRVJf\nRVhDRVBUSU9OKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

