{"sha":"ebb9ebe98be14ada2f6083408b82c29b76b21155","node_id":"MDQ6QmxvYjE1NzU5NTY6ZWJiOWViZTk4YmUxNGFkYTJmNjA4MzQwOGI4MmMyOWI3NmIyMTE1NQ==","size":6569,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ebb9ebe98be14ada2f6083408b82c29b76b21155","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90bzsKCmlt\ncG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0\nZUJ1ZmZlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2ll\nLkJvb2tpZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5uZXQuQm9va2llU29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVyUHJvdG9jb2wuQWRkUmVxdWVz\ndDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2Vl\ncGVyUHJvdG9jb2wuQWRkUmVzcG9uc2U7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uQm9va2tlZXBlclByb3RvY29sLlJlcXVlc3Q7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlclBy\nb3RvY29sLlJlc3BvbnNlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkJvb2trZWVwZXJQcm90b2NvbC5TdGF0dXNDb2RlOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuTWF0aFV0aWxzOwppbXBvcnQg\nb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbDsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\nCmNsYXNzIFdyaXRlRW50cnlQcm9jZXNzb3JWMyBleHRlbmRzIFBhY2tldFBy\nb2Nlc3NvckJhc2VWMyBpbXBsZW1lbnRzIFJ1bm5hYmxlIHsKICAgIHByaXZh\ndGUgZmluYWwgc3RhdGljIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5\nLmdldExvZ2dlcihXcml0ZUVudHJ5UHJvY2Vzc29yVjMuY2xhc3MpOwoKICAg\nIHB1YmxpYyBXcml0ZUVudHJ5UHJvY2Vzc29yVjMoUmVxdWVzdCByZXF1ZXN0\nLCBDaGFubmVsIGNoYW5uZWwsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIEJvb2tpZVJlcXVlc3RQcm9jZXNzb3IgcmVxdWVzdFByb2Nlc3Nv\ncikgewogICAgICAgIHN1cGVyKHJlcXVlc3QsIGNoYW5uZWwsIHJlcXVlc3RQ\ncm9jZXNzb3IpOwogICAgfQoKICAgIC8vIFJldHVybnMgbnVsbCBpZiB0aGVy\nZSBpcyBubyBleGNlcHRpb24gdGhyb3duCiAgICBwcml2YXRlIEFkZFJlc3Bv\nbnNlIGdldEFkZFJlc3BvbnNlKCkgewogICAgICAgIGZpbmFsIGxvbmcgc3Rh\ncnRUaW1lTmFub3MgPSBNYXRoVXRpbHMubm93SW5OYW5vKCk7CiAgICAgICAg\nQWRkUmVxdWVzdCBhZGRSZXF1ZXN0ID0gcmVxdWVzdC5nZXRBZGRSZXF1ZXN0\nKCk7CiAgICAgICAgbG9uZyBsZWRnZXJJZCA9IGFkZFJlcXVlc3QuZ2V0TGVk\nZ2VySWQoKTsKICAgICAgICBsb25nIGVudHJ5SWQgPSBhZGRSZXF1ZXN0Lmdl\ndEVudHJ5SWQoKTsKCiAgICAgICAgZmluYWwgQWRkUmVzcG9uc2UuQnVpbGRl\nciBhZGRSZXNwb25zZSA9IEFkZFJlc3BvbnNlLm5ld0J1aWxkZXIoKQogICAg\nICAgICAgICAgICAgLnNldExlZGdlcklkKGxlZGdlcklkKQogICAgICAgICAg\nICAgICAgLnNldEVudHJ5SWQoZW50cnlJZCk7CgogICAgICAgIGlmICghaXNW\nZXJzaW9uQ29tcGF0aWJsZSgpKSB7CiAgICAgICAgICAgIGFkZFJlc3BvbnNl\nLnNldFN0YXR1cyhTdGF0dXNDb2RlLkVCQURWRVJTSU9OKTsKICAgICAgICAg\nICAgcmV0dXJuIGFkZFJlc3BvbnNlLmJ1aWxkKCk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAocmVxdWVzdFByb2Nlc3Nvci5ib29raWUuaXNSZWFkT25seSgp\nKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuKCJCb29raWVTZXJ2ZXIgaXMg\ncnVubmluZyBhcyByZWFkb25seSBtb2RlLCBzbyByZWplY3RpbmcgdGhlIHJl\ncXVlc3QgZnJvbSB0aGUgY2xpZW50ISIpOwogICAgICAgICAgICBhZGRSZXNw\nb25zZS5zZXRTdGF0dXMoU3RhdHVzQ29kZS5FUkVBRE9OTFkpOwogICAgICAg\nICAgICByZXR1cm4gYWRkUmVzcG9uc2UuYnVpbGQoKTsKICAgICAgICB9Cgog\nICAgICAgIEJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNhbGxi\nYWNrIHdjYiA9IG5ldyBCb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuV3Jp\ndGVDYWxsYmFjaygpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHdyaXRlQ29tcGxldGUoaW50IHJjLCBsb25nIGxl\nZGdlcklkLCBsb25nIGVudHJ5SWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBhZGRyLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgICAgICBpZiAoQm9va2llUHJvdG9jb2wu\nRU9LID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFByb2Nl\nc3Nvci5hZGRFbnRyeVN0YXRzLnJlZ2lzdGVyU3VjY2Vzc2Z1bEV2ZW50KE1h\ndGhVdGlscy5lbGFwc2VkTVNlYyhzdGFydFRpbWVOYW5vcykpOwogICAgICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0\nUHJvY2Vzc29yLmFkZEVudHJ5U3RhdHMucmVnaXN0ZXJGYWlsZWRFdmVudChN\nYXRoVXRpbHMuZWxhcHNlZE1TZWMoc3RhcnRUaW1lTmFub3MpKTsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBTdGF0dXNDb2RlIHN0YXR1\nczsKICAgICAgICAgICAgICAgIHN3aXRjaCAocmMpIHsKICAgICAgICAgICAg\nICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkVPSzoKICAgICAgICAgICAg\nICAgICAgICAgICAgc3RhdHVzID0gU3RhdHVzQ29kZS5FT0s7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNh\nc2UgQm9va2llUHJvdG9jb2wuRUlPOgogICAgICAgICAgICAgICAgICAgICAg\nICBzdGF0dXMgPSBTdGF0dXNDb2RlLkVJTzsKICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gU3RhdHVzQ29kZS5FVUE7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgYWRkUmVzcG9uc2Uuc2V0U3RhdHVzKHN0\nYXR1cyk7CiAgICAgICAgICAgICAgICBSZXNwb25zZS5CdWlsZGVyIHJlc3Bv\nbnNlID0gUmVzcG9uc2UubmV3QnVpbGRlcigpCiAgICAgICAgICAgICAgICAg\nICAgICAgIC5zZXRIZWFkZXIoZ2V0SGVhZGVyKCkpCiAgICAgICAgICAgICAg\nICAgICAgICAgIC5zZXRTdGF0dXMoYWRkUmVzcG9uc2UuZ2V0U3RhdHVzKCkp\nCiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRBZGRSZXNwb25zZShhZGRS\nZXNwb25zZSk7CiAgICAgICAgICAgICAgICBSZXNwb25zZSByZXNwID0gcmVz\ncG9uc2UuYnVpbGQoKTsKICAgICAgICAgICAgICAgIHNlbmRSZXNwb25zZShz\ndGF0dXMsIHJlc3AsIHJlcXVlc3RQcm9jZXNzb3IuYWRkUmVxdWVzdFN0YXRz\nKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgU3RhdHVzQ29k\nZSBzdGF0dXMgPSBudWxsOwogICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkgPSBh\nZGRSZXF1ZXN0LmdldE1hc3RlcktleSgpLnRvQnl0ZUFycmF5KCk7CiAgICAg\nICAgQnl0ZUJ1ZmZlciBlbnRyeVRvQWRkID0gYWRkUmVxdWVzdC5nZXRCb2R5\nKCkuYXNSZWFkT25seUJ5dGVCdWZmZXIoKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBpZiAoYWRkUmVxdWVzdC5oYXNGbGFnKCkgJiYgYWRkUmVxdWVz\ndC5nZXRGbGFnKCkuZXF1YWxzKEFkZFJlcXVlc3QuRmxhZy5SRUNPVkVSWV9B\nREQpKSB7CiAgICAgICAgICAgICAgICByZXF1ZXN0UHJvY2Vzc29yLmJvb2tp\nZS5yZWNvdmVyeUFkZEVudHJ5KGVudHJ5VG9BZGQsIHdjYiwgY2hhbm5lbCwg\nbWFzdGVyS2V5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIHJlcXVlc3RQcm9jZXNzb3IuYm9va2llLmFkZEVudHJ5KGVudHJ5VG9B\nZGQsIHdjYiwgY2hhbm5lbCwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzdGF0dXMgPSBTdGF0dXNDb2RlLkVPSzsKICAgICAgICB9\nIGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGxvZ2dlci5l\ncnJvcigiRXJyb3Igd3JpdGluZyBlbnRyeTp7fSB0byBsZWRnZXI6e30iLAog\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgZW50cnlJ\nZCwgbGVkZ2VySWQsIGUgfSk7CiAgICAgICAgICAgIHN0YXR1cyA9IFN0YXR1\nc0NvZGUuRUlPOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5M\nZWRnZXJGZW5jZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBsb2dnZXIu\nZGVidWcoIkxlZGdlciBmZW5jZWQgd2hpbGUgd3JpdGluZyBlbnRyeTp7fSB0\nbyBsZWRnZXI6e30iLAogICAgICAgICAgICAgICAgICAgICAgICAgZW50cnlJ\nZCwgbGVkZ2VySWQpOwogICAgICAgICAgICBzdGF0dXMgPSBTdGF0dXNDb2Rl\nLkVGRU5DRUQ7CiAgICAgICAgfSBjYXRjaCAoQm9va2llRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJVbmF1dGhvcml6ZWQgYWNj\nZXNzIHRvIGxlZGdlcjp7fSB3aGlsZSB3cml0aW5nIGVudHJ5Ont9IiwKICAg\nICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcklkLCBlbnRyeUlkKTsKICAg\nICAgICAgICAgc3RhdHVzID0gU3RhdHVzQ29kZS5FVUE7CiAgICAgICAgfSBj\nYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgbG9nZ2VyLmVycm9y\nKCJVbmV4cGVjdGVkIGV4Y2VwdGlvbiB3aGlsZSB3cml0aW5nIHt9QHt9IDog\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGVu\ndHJ5SWQsIGxlZGdlcklkLCB0IH0pOwogICAgICAgICAgICAvLyBzb21lIGJh\nZCByZXF1ZXN0IHdoaWNoIGNhdXNlIHVuZXhwZWN0ZWQgZXhjZXB0aW9uCiAg\nICAgICAgICAgIHN0YXR1cyA9IFN0YXR1c0NvZGUuRUJBRFJFUTsKICAgICAg\nICB9CgogICAgICAgIC8vIElmIGV2ZXJ5dGhpbmcgaXMgb2theSwgd2UgcmV0\ndXJuIG51bGwgc28gdGhhdCB0aGUgY2FsbGluZyBmdW5jdGlvbgogICAgICAg\nIC8vIGRvZXNuJ3QgcmV0dXJuIGEgcmVzcG9uc2UgYmFjayB0byB0aGUgY2Fs\nbGVyLgogICAgICAgIGlmICghc3RhdHVzLmVxdWFscyhTdGF0dXNDb2RlLkVP\nSykpIHsKICAgICAgICAgICAgYWRkUmVzcG9uc2Uuc2V0U3RhdHVzKHN0YXR1\ncyk7CiAgICAgICAgICAgIHJldHVybiBhZGRSZXNwb25zZS5idWlsZCgpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICBBZGRSZXNw\nb25zZSBhZGRSZXNwb25zZSA9IGdldEFkZFJlc3BvbnNlKCk7CiAgICAgICAg\naWYgKG51bGwgIT0gYWRkUmVzcG9uc2UpIHsKICAgICAgICAgICAgLy8gVGhp\ncyBtZWFucyB0aGVyZSB3YXMgYW4gZXJyb3IgYW5kIHdlIHNob3VsZCBzZW5k\nIHRoaXMgYmFjay4KICAgICAgICAgICAgUmVzcG9uc2UuQnVpbGRlciByZXNw\nb25zZSA9IFJlc3BvbnNlLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAgICAg\nICAgIC5zZXRIZWFkZXIoZ2V0SGVhZGVyKCkpCiAgICAgICAgICAgICAgICAg\nICAgLnNldFN0YXR1cyhhZGRSZXNwb25zZS5nZXRTdGF0dXMoKSkKICAgICAg\nICAgICAgICAgICAgICAuc2V0QWRkUmVzcG9uc2UoYWRkUmVzcG9uc2UpOwog\nICAgICAgICAgICBSZXNwb25zZSByZXNwID0gcmVzcG9uc2UuYnVpbGQoKTsK\nICAgICAgICAgICAgc2VuZFJlc3BvbnNlKGFkZFJlc3BvbnNlLmdldFN0YXR1\ncygpLCByZXNwLAogICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBy\nb2Nlc3Nvci5hZGRSZXF1ZXN0U3RhdHMpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

