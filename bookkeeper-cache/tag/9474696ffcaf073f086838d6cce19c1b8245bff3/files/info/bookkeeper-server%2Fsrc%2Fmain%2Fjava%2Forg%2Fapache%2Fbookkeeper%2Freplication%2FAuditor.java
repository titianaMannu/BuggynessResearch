{"sha":"4e6e3fb3f9adcdce76a6150ba06ff9247c37453f","node_id":"MDQ6QmxvYjE1NzU5NTY6NGU2ZTNmYjNmOWFkY2RjZTc2YTYxNTBiYTA2ZmY5MjQ3YzM3NDUzZg==","size":24143,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4e6e3fb3f9adcdce76a6150ba06ff9247c37453f","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi5jb2xsZWN0LlNldHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2Vl\ncGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyQWRtaW47CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tpZXNMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuTGVkZ2VyQ2hlY2tlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyRnJhZ21lbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGEuTGVkZ2VyTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5tZXRhLkxlZGdlck1hbmFnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0LkJvb2tpZVNv\nY2tldEFkZHJlc3M7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2Vl\ncGVySW50ZXJuYWxDYWxsYmFja3MuUHJvY2Vzc29yOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJlcGxpY2F0aW9uRXhjZXB0\naW9uLkJLQXVkaXRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNlcHRpb24uQ29tcGF0\naWJpbGl0eUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJs\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGls\nLlprVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuem9va2Vl\ncGVyLlpvb0tlZXBlcldhdGNoZXJCYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5j\nb21tb25zLmNvbGxlY3Rpb25zLkNvbGxlY3Rpb25VdGlsczsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLkFzeW5jQ2FsbGJhY2s7CmltcG9ydCBjb20u\nZ29vZ2xlLmNvbW1vbi5hbm5vdGF0aW9ucy5WaXNpYmxlRm9yVGVzdGluZzsK\naW1wb3J0IGNvbS5nb29nbGUuY29tbW9uLnV0aWwuY29uY3VycmVudC5TZXR0\nYWJsZUZ1dHVyZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBl\nckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tl\nZXBlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LkZ1dHVyZTsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuRXhlY3V0b3JzOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJl\nbnQuU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuVGhyZWFkRmFjdG9yeTsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJl\nbnQuYXRvbWljLkF0b21pY0ludGVnZXI7CgovKioKICogQXVkaXRvciBpcyBh\nIHNpbmdsZSBlbnRpdHkgaW4gdGhlIGVudGlyZSBCb29raWUgY2x1c3RlciBh\nbmQgd2lsbCBiZSB3YXRjaGluZwogKiBhbGwgdGhlIGJvb2tpZXMgdW5kZXIg\nJ2xlZGdlcnJvb3RwYXRoL2F2YWlsYWJsZScgemtwYXRoLiBXaGVuIGFueSBv\nZiB0aGUKICogYm9va2llIGZhaWxlZCBvciBkaXNjb25uZWN0ZWQgZnJvbSB6\naywgaGUgd2lsbCBzdGFydCBpbml0aWF0aW5nIHRoZQogKiByZS1yZXBsaWNh\ndGlvbiBhY3Rpdml0aWVzIGJ5IGtlZXBpbmcgYWxsIHRoZSBjb3JyZXNwb25k\naW5nIGxlZGdlcnMgb2YgdGhlCiAqIGZhaWxlZCBib29raWUgYXMgdW5kZXJy\nZXBsaWNhdGVkIHpub2RlIGluIHprLgogKi8KcHVibGljIGNsYXNzIEF1ZGl0\nb3IgaW1wbGVtZW50cyBCb29raWVzTGlzdGVuZXIgewogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9n\nZ2VyKEF1ZGl0b3IuY2xhc3MpOwogICAgcHJpdmF0ZSBmaW5hbCBTZXJ2ZXJD\nb25maWd1cmF0aW9uIGNvbmY7CiAgICBwcml2YXRlIEJvb2tLZWVwZXIgYmtj\nOwogICAgcHJpdmF0ZSBCb29rS2VlcGVyQWRtaW4gYWRtaW47CiAgICBwcml2\nYXRlIEJvb2tpZUxlZGdlckluZGV4ZXIgYm9va2llTGVkZ2VySW5kZXhlcjsK\nICAgIHByaXZhdGUgTGVkZ2VyTWFuYWdlciBsZWRnZXJNYW5hZ2VyOwogICAg\ncHJpdmF0ZSBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBsZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlcjsKICAgIHByaXZhdGUgZmluYWwgU2No\nZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIGV4ZWN1dG9yOwogICAgcHJpdmF0ZSBM\naXN0PFN0cmluZz4ga25vd25Cb29raWVzID0gbmV3IEFycmF5TGlzdDxTdHJp\nbmc+KCk7CiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBib29raWVJZGVudGlm\naWVyOwoKICAgIHB1YmxpYyBBdWRpdG9yKGZpbmFsIFN0cmluZyBib29raWVJ\nZGVudGlmaWVyLCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYsCiAgICAgICAg\nICAgICAgICAgICBab29LZWVwZXIgemtjKSB0aHJvd3MgVW5hdmFpbGFibGVF\neGNlcHRpb24gewogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAgICAg\ndGhpcy5ib29raWVJZGVudGlmaWVyID0gYm9va2llSWRlbnRpZmllcjsKCiAg\nICAgICAgaW5pdGlhbGl6ZShjb25mLCB6a2MpOwoKICAgICAgICBleGVjdXRv\nciA9IEV4ZWN1dG9ycy5uZXdTaW5nbGVUaHJlYWRTY2hlZHVsZWRFeGVjdXRv\ncihuZXcgVGhyZWFkRmFjdG9yeSgpIHsKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIFRocmVhZCBuZXdUaHJlYWQo\nUnVubmFibGUgcikgewogICAgICAgICAgICAgICAgICAgIFRocmVhZCB0ID0g\nbmV3IFRocmVhZChyLCAiQXVkaXRvckJvb2tpZS0iICsgYm9va2llSWRlbnRp\nZmllcik7CiAgICAgICAgICAgICAgICAgICAgdC5zZXREYWVtb24odHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQ7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0pOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBp\nbml0aWFsaXplKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiwgWm9vS2VlcGVy\nIHprYykKICAgICAgICAgICAgdGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9u\nIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBMZWRnZXJNYW5hZ2VyRmFj\ndG9yeSBsZWRnZXJNYW5hZ2VyRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0\nb3J5CiAgICAgICAgICAgICAgICAgICAgLm5ld0xlZGdlck1hbmFnZXJGYWN0\nb3J5KGNvbmYsIHprYyk7CiAgICAgICAgICAgIGxlZGdlck1hbmFnZXIgPSBs\nZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2VyKCk7CiAgICAg\nICAgICAgIHRoaXMuYm9va2llTGVkZ2VySW5kZXhlciA9IG5ldyBCb29raWVM\nZWRnZXJJbmRleGVyKGxlZGdlck1hbmFnZXIpOwoKICAgICAgICAgICAgdGhp\ncy5sZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciA9IGxlZGdlck1hbmFn\nZXJGYWN0b3J5CiAgICAgICAgICAgICAgICAgICAgLm5ld0xlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyKCk7CgogICAgICAgICAgICB0aGlzLmJrYyA9\nIG5ldyBCb29rS2VlcGVyKG5ldyBDbGllbnRDb25maWd1cmF0aW9uKGNvbmYp\nLCB6a2MpOwogICAgICAgICAgICB0aGlzLmFkbWluID0gbmV3IEJvb2tLZWVw\nZXJBZG1pbihia2MpOwogICAgICAgIH0gY2F0Y2ggKENvbXBhdGliaWxpdHlF\neGNlcHRpb24gY2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuYXZhaWxh\nYmxlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICJDb21wYXRpYmls\naXR5RXhjZXB0aW9uIHdoaWxlIGluaXRpYWxpemluZyBBdWRpdG9yIiwgY2Up\nOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgVW5hdmFpbGFibGVFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAgICAgIklPRXhjZXB0aW9uIHdoaWxlIGluaXRpYWxpemluZyBB\ndWRpdG9yIiwgaW9lKTsKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRp\nb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFVuYXZhaWxhYmxlRXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICJLZWVwZXJFeGNlcHRpb24g\nd2hpbGUgaW5pdGlhbGl6aW5nIEF1ZGl0b3IiLCBrZSk7CiAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFVuYXZhaWxhYmxlRXhjZXB0aW9uKAogICAgICAgICAgICAg\nICAgICAgICJJbnRlcnJ1cHRlZCB3aGlsZSBpbml0aWFsaXppbmcgQXVkaXRv\nciIsIGllKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHN1\nYm1pdFNodXRkb3duVGFzaygpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRo\naXMpIHsKICAgICAgICAgICAgaWYgKGV4ZWN1dG9yLmlzU2h1dGRvd24oKSkg\newogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGV4ZWN1dG9yLnN1Ym1pdChuZXcgUnVubmFibGUoKSB7CiAgICAg\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKEF1ZGl0b3IudGhpcykgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhlY3V0b3Iuc2h1dGRvd24o\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0KCiAg\nICBAVmlzaWJsZUZvclRlc3RpbmcKICAgIHN5bmNocm9uaXplZCBGdXR1cmU8\nPz4gc3VibWl0QXVkaXRUYXNrKCkgewogICAgICAgIGlmIChleGVjdXRvci5p\nc1NodXRkb3duKCkpIHsKICAgICAgICAgICAgU2V0dGFibGVGdXR1cmU8Vm9p\nZD4gZiA9IFNldHRhYmxlRnV0dXJlLjxWb2lkPmNyZWF0ZSgpOwogICAgICAg\nICAgICBmLnNldEV4Y2VwdGlvbihuZXcgQktBdWRpdEV4Y2VwdGlvbigiQXVk\naXRvciBzaHV0dGluZyBkb3duIikpOwogICAgICAgICAgICByZXR1cm4gZjsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGV4ZWN1dG9yLnN1Ym1pdChuZXcg\nUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICBAU3VwcHJlc3NXYXJuaW5n\ncygidW5jaGVja2VkIikKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1\nbigpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICB3YWl0SWZMZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVkKCk7\nCgogICAgICAgICAgICAgICAgICAgICAgICBMaXN0PFN0cmluZz4gYXZhaWxh\nYmxlQm9va2llcyA9IGdldEF2YWlsYWJsZUJvb2tpZXMoKTsKCiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGNhc3RpbmcgdG8gU3RyaW5nLCBhcyBrbm93\nbkJvb2tpZXMgYW5kIGF2YWlsYWJsZUJvb2tpZXMKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gY29udGFpbnMgb25seSBTdHJpbmcgdmFsdWVzCiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIGZpbmQgbmV3IGJvb2tpZXMoaWYgYW55\nKSBhbmQgdXBkYXRlIHRoZSBrbm93biBib29raWUgbGlzdAogICAgICAgICAg\nICAgICAgICAgICAgICBDb2xsZWN0aW9uPFN0cmluZz4gbmV3Qm9va2llcyA9\nIENvbGxlY3Rpb25VdGlscy5zdWJ0cmFjdCgKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhdmFpbGFibGVCb29raWVzLCBrbm93bkJvb2tpZXMp\nOwogICAgICAgICAgICAgICAgICAgICAgICBrbm93bkJvb2tpZXMuYWRkQWxs\nKG5ld0Jvb2tpZXMpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlu\nZCBsb3N0IGJvb2tpZXMoaWYgYW55KQogICAgICAgICAgICAgICAgICAgICAg\nICBDb2xsZWN0aW9uPFN0cmluZz4gbG9zdEJvb2tpZXMgPSBDb2xsZWN0aW9u\nVXRpbHMuc3VidHJhY3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAga25vd25Cb29raWVzLCBhdmFpbGFibGVCb29raWVzKTsKCiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChsb3N0Qm9va2llcy5zaXplKCkgPiAwKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrbm93bkJvb2tpZXMucmVt\nb3ZlQWxsKGxvc3RCb29raWVzKTsKCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBhdWRpdEJvb2tpZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGJr\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2Vw\ndGlvbiBnZXR0aW5nIGJvb2tpZSBsaXN0IiwgYmtlKTsKICAgICAgICAgICAg\nICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgp\nLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkludGVycnVwdGVkIHdoaWxlIHdhdGNoaW5nIGF2YWlsYWJsZSBib29r\naWVzICIsIGllKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChCS0F1\nZGl0RXhjZXB0aW9uIGJrZSkgewogICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSB3YXRjaGluZyBhdmFpbGFibGUg\nYm9va2llcyIsIGJrZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nVW5hdmFpbGFibGVFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gd2hpbGUgd2F0Y2hpbmcgYXZh\naWxhYmxlIGJvb2tpZXMiLCB1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHJlYWRpbmcgYm9va2llIGxp\nc3QiLCBrZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBz\ndGFydCgpIHsKICAgICAgICBMT0cuaW5mbygiSSdtIHN0YXJ0aW5nIGFzIEF1\nZGl0b3IgQm9va2llLiBJRDoge30iLCBib29raWVJZGVudGlmaWVyKTsKICAg\nICAgICAvLyBvbiBzdGFydHVwIHdhdGNoaW5nIGF2YWlsYWJsZSBib29raWUg\nYW5kIGJhc2VkIG9uIHRoZQogICAgICAgIC8vIGF2YWlsYWJsZSBib29raWVz\nIGRldGVybWluaW5nIHRoZSBib29raWUgZmFpbHVyZXMuCiAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChleGVjdXRvci5p\nc1NodXRkb3duKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgbG9uZyBpbnRlcnZhbCA9IGNvbmYuZ2V0\nQXVkaXRvclBlcmlvZGljQ2hlY2tJbnRlcnZhbCgpOwoKICAgICAgICAgICAg\naWYgKGludGVydmFsID4gMCkgewogICAgICAgICAgICAgICAgTE9HLmluZm8o\nIkF1ZGl0b3IgcGVyaW9kaWMgbGVkZ2VyIGNoZWNraW5nIGVuYWJsZWQiCiAg\nICAgICAgICAgICAgICAgICAgICAgICArICIgJ2F1ZGl0b3JQZXJpb2RpY0No\nZWNrSW50ZXJ2YWwnIHt9IHNlY29uZHMiLCBpbnRlcnZhbCk7CiAgICAgICAg\nICAgICAgICBleGVjdXRvci5zY2hlZHVsZUF0Rml4ZWRSYXRlKG5ldyBSdW5u\nYWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8o\nIlJ1bm5pbmcgcGVyaW9kaWMgY2hlY2siKTsKCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGlmICghbGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIuaXNMZWRn\nZXJSZXBsaWNhdGlvbkVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIHJlcGxpY2F0aW9u\nIGRpc2FibGVkLCBza2lwcGluZyIpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\naGVja0FsbExlZGdlcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxl\nIHJ1bm5pbmcgcGVyaW9kaWMgY2hlY2siLCBrZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBp\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5j\ndXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJJbnRlcnJ1cHRlZCB3aGlsZSBy\ndW5uaW5nIHBlcmlvZGljIGNoZWNrIiwgaWUpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoQktBdWRpdEV4Y2VwdGlvbiBia2FlKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJF\neGNlcHRpb24gd2hpbGUgcnVubmluZyBwZXJpb2RpYyBjaGVjayIsIGJrYWUp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNl\ncHRpb24gYmtlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLmVycm9yKCJFeGNlcHRpb24gcnVubmluZyBwZXJpb2RpYyBjaGVjayIs\nIGJrZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkkvTyBleGNlcHRpb24gcnVubmluZyBwZXJpb2Rp\nYyBjaGVjayIsIGlvZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2Vw\ndGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiVW5kZXJyZXBsaWNhdGlvbiBtYW5hZ2VyIHVuYXZhaWxhYmxl\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyJydW5uaW5nIHBlcmlvZGljIGNoZWNrIiwgdWUpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfSwgaW50ZXJ2YWwsIGludGVydmFsLCBUaW1l\nVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIExPRy5pbmZvKCJQZXJpb2RpYyBjaGVja2luZyBkaXNhYmxlZCIp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBrbm93bkJvb2tpZXMgPSBnZXRBdmFpbGFibGVCb29raWVzKCk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGJrZSkgewogICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJDb3VsZG4ndCBnZXQgYm9va2llIGxpc3Qs\nIGV4aXRpbmciLCBia2UpOwogICAgICAgICAgICAgICAgc3VibWl0U2h1dGRv\nd25UYXNrKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxvbmcgYm9v\na2llQ2hlY2tJbnRlcnZhbCA9IGNvbmYuZ2V0QXVkaXRvclBlcmlvZGljQm9v\na2llQ2hlY2tJbnRlcnZhbCgpOwogICAgICAgICAgICBpZiAoYm9va2llQ2hl\nY2tJbnRlcnZhbCA9PSAwKSB7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygi\nQXVkaXRvciBwZXJpb2RpYyBib29raWUgY2hlY2tpbmcgZGlzYWJsZWQsIHJ1\nbm5pbmcgb25jZSBjaGVjayBub3cgYW55aG93Iik7CiAgICAgICAgICAgICAg\nICBleGVjdXRvci5zdWJtaXQoQk9PS0lFX0NIRUNLKTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJBdWRpdG9yIHBl\ncmlvZGljIGJvb2tpZSBjaGVja2luZyBlbmFibGVkIgogICAgICAgICAgICAg\nICAgICAgICAgICAgKyAiICdhdWRpdG9yUGVyaW9kaWNCb29raWVDaGVja0lu\ndGVydmFsJyB7fSBzZWNvbmRzIiwgYm9va2llQ2hlY2tJbnRlcnZhbCk7CiAg\nICAgICAgICAgICAgICBleGVjdXRvci5zY2hlZHVsZUF0Rml4ZWRSYXRlKEJP\nT0tJRV9DSEVDSywgMCwgYm9va2llQ2hlY2tJbnRlcnZhbCwgVGltZVVuaXQu\nU0VDT05EUyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIHdhaXRJZkxlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQo\nKSB0aHJvd3MgVW5hdmFpbGFibGVFeGNlcHRpb24sCiAgICAgICAgICAgIElu\ndGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBSZXBsaWNhdGlvbkVuYWJs\nZUNiIGNiID0gbmV3IFJlcGxpY2F0aW9uRW5hYmxlQ2IoKTsKICAgICAgICBp\nZiAoIWxlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyLmlzTGVkZ2VyUmVw\nbGljYXRpb25FbmFibGVkKCkpIHsKICAgICAgICAgICAgbGVkZ2VyVW5kZXJy\nZXBsaWNhdGlvbk1hbmFnZXIubm90aWZ5TGVkZ2VyUmVwbGljYXRpb25FbmFi\nbGVkKGNiKTsKICAgICAgICAgICAgY2IuYXdhaXQoKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBMaXN0PFN0cmluZz4gZ2V0QXZhaWxhYmxlQm9v\na2llcygpIHRocm93cyBCS0V4Y2VwdGlvbiB7CiAgICAgICAgLy8gR2V0IHRo\nZSBhdmFpbGFibGUgYm9va2llcywgYWxzbyB3YXRjaCBmb3IgZnVydGhlciBj\naGFuZ2VzCiAgICAgICAgLy8gV2F0Y2hpbmcgb24gb25seSBhdmFpbGFibGUg\nYm9va2llcyBpcyBzdWZmaWNpZW50LCBhcyBjaGFuZ2VzIGluIHJlYWRvbmx5\nIGJvb2tpZXMgYWxzbyBjaGFuZ2VzIGluIGF2YWlsYWJsZQogICAgICAgIC8v\nIGJvb2tpZXMKICAgICAgICBhZG1pbi5ub3RpZnlCb29raWVzQ2hhbmdlZCh0\naGlzKTsKICAgICAgICBDb2xsZWN0aW9uPEJvb2tpZVNvY2tldEFkZHJlc3M+\nIGF2YWlsYWJsZUJrQWRkcmVzc2VzID0gYWRtaW4uZ2V0QXZhaWxhYmxlQm9v\na2llcygpOwogICAgICAgIENvbGxlY3Rpb248Qm9va2llU29ja2V0QWRkcmVz\ncz4gcmVhZE9ubHlCa0FkZHJlc3NlcyA9IGFkbWluLmdldFJlYWRPbmx5Qm9v\na2llcygpOwogICAgICAgIGF2YWlsYWJsZUJrQWRkcmVzc2VzLmFkZEFsbChy\nZWFkT25seUJrQWRkcmVzc2VzKTsKCiAgICAgICAgTGlzdDxTdHJpbmc+IGF2\nYWlsYWJsZUJvb2tpZXMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTsKICAg\nICAgICBmb3IgKEJvb2tpZVNvY2tldEFkZHJlc3MgYWRkciA6IGF2YWlsYWJs\nZUJrQWRkcmVzc2VzKSB7CiAgICAgICAgICAgIGF2YWlsYWJsZUJvb2tpZXMu\nYWRkKGFkZHIudG9TdHJpbmcoKSk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBhdmFpbGFibGVCb29raWVzOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5p\nbmdzKCJ1bmNoZWNrZWQiKQogICAgcHJpdmF0ZSB2b2lkIGF1ZGl0Qm9va2ll\ncygpCiAgICAgICAgICAgIHRocm93cyBCS0F1ZGl0RXhjZXB0aW9uLCBLZWVw\nZXJFeGNlcHRpb24sCiAgICAgICAgICAgIEludGVycnVwdGVkRXhjZXB0aW9u\nLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2Fp\ndElmTGVkZ2VyUmVwbGljYXRpb25EaXNhYmxlZCgpOwogICAgICAgIH0gY2F0\nY2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiVW5kZXJyZXBsaWNhdGlvbiB1bmF2YWlsYWJsZSwgc2tpcHBp\nbmcgYXVkaXQuIgogICAgICAgICAgICAgICAgICAgICAgKyAiV2lsbCByZXRy\neSBhZnRlciBhIHBlcmlvZCIpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQoKICAgICAgICAvLyBwdXQgZXhpdCBjYXNlcyBoZXJlCiAgICAgICAg\nTWFwPFN0cmluZywgU2V0PExvbmc+PiBsZWRnZXJEZXRhaWxzID0gZ2VuZXJh\ndGVCb29raWUyTGVkZ2Vyc0luZGV4KCk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKCFsZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlci5pc0xl\nZGdlclJlcGxpY2F0aW9uRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAv\nLyBoYXMgYmVlbiBkaXNhYmxlZCB3aGlsZSB3ZSB3ZXJlIGdlbmVyYXRpbmcg\ndGhlIGluZGV4CiAgICAgICAgICAgICAgICAvLyBkaXNjYXJkIHRoaXMgcnVu\nLCBhbmQgc2NoZWR1bGUgYSBuZXcgb25lCiAgICAgICAgICAgICAgICBleGVj\ndXRvci5zdWJtaXQoQk9PS0lFX0NIRUNLKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxh\nYmxlRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVW5k\nZXJyZXBsaWNhdGlvbiB1bmF2YWlsYWJsZSwgc2tpcHBpbmcgYXVkaXQuIgog\nICAgICAgICAgICAgICAgICAgICAgKyAiV2lsbCByZXRyeSBhZnRlciBhIHBl\ncmlvZCIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAg\nICBMaXN0PFN0cmluZz4gYXZhaWxhYmxlQm9va2llcyA9IGdldEF2YWlsYWJs\nZUJvb2tpZXMoKTsKICAgICAgICAvLyBmaW5kIGxvc3QgYm9va2llcwogICAg\nICAgIFNldDxTdHJpbmc+IGtub3duQm9va2llcyA9IGxlZGdlckRldGFpbHMu\na2V5U2V0KCk7CiAgICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IGxvc3RCb29r\naWVzID0gQ29sbGVjdGlvblV0aWxzLnN1YnRyYWN0KGtub3duQm9va2llcywK\nICAgICAgICAgICAgICAgIGF2YWlsYWJsZUJvb2tpZXMpOwoKICAgICAgICBp\nZiAobG9zdEJvb2tpZXMuc2l6ZSgpID4gMCkKICAgICAgICAgICAgaGFuZGxl\nTG9zdEJvb2tpZXMobG9zdEJvb2tpZXMsIGxlZGdlckRldGFpbHMpOwogICAg\nfQoKICAgIHByaXZhdGUgTWFwPFN0cmluZywgU2V0PExvbmc+PiBnZW5lcmF0\nZUJvb2tpZTJMZWRnZXJzSW5kZXgoKQogICAgICAgICAgICB0aHJvd3MgQktB\ndWRpdEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGJvb2tpZUxlZGdlcklu\nZGV4ZXIuZ2V0Qm9va2llVG9MZWRnZXJJbmRleCgpOwogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBoYW5kbGVMb3N0Qm9va2llcyhDb2xsZWN0aW9uPFN0cmlu\nZz4gbG9zdEJvb2tpZXMsCiAgICAgICAgICAgIE1hcDxTdHJpbmcsIFNldDxM\nb25nPj4gbGVkZ2VyRGV0YWlscykgdGhyb3dzIEJLQXVkaXRFeGNlcHRpb24g\newogICAgICAgIExPRy5pbmZvKCJGb2xsb3dpbmcgYXJlIHRoZSBmYWlsZWQg\nYm9va2llczogIiArIGxvc3RCb29raWVzCiAgICAgICAgICAgICAgICArICIg\nYW5kIHNlYXJjaGluZyBpdHMgbGVkZ2VycyBmb3IgcmUtcmVwbGljYXRpb24i\nKTsKCiAgICAgICAgZm9yIChTdHJpbmcgYm9va2llSVAgOiBsb3N0Qm9va2ll\ncykgewogICAgICAgICAgICAvLyBpZGVudGlmeSBhbGwgdGhlIGxlZGdlcnMg\naW4gYm9va2llSVAgYW5kIHB1Ymxpc2hpbmcgdGhlc2UgbGVkZ2VycwogICAg\nICAgICAgICAvLyBhcyB1bmRlci1yZXBsaWNhdGVkLgogICAgICAgICAgICBw\ndWJsaXNoU3VzcGVjdGVkTGVkZ2Vycyhib29raWVJUCwgbGVkZ2VyRGV0YWls\ncy5nZXQoYm9va2llSVApKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSB2b2lkIHB1Ymxpc2hTdXNwZWN0ZWRMZWRnZXJzKFN0cmluZyBib29raWVJ\nUCwgU2V0PExvbmc+IGxlZGdlcnMpCiAgICAgICAgICAgIHRocm93cyBCS0F1\nZGl0RXhjZXB0aW9uIHsKICAgICAgICBpZiAobnVsbCA9PSBsZWRnZXJzIHx8\nIGxlZGdlcnMuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgLy8gdGhlcmUg\naXMgbm8gbGVkZ2VycyBhdmFpbGFibGUgZm9yIHRoaXMgYm9va2llIGFuZCBq\ndXN0CiAgICAgICAgICAgIC8vIGlnbm9yaW5nIHRoZSBib29raWUgZmFpbHVy\nZXMKICAgICAgICAgICAgTE9HLmluZm8oIlRoZXJlIGlzIG5vIGxlZGdlcnMg\nZm9yIHRoZSBmYWlsZWQgYm9va2llOiAiICsgYm9va2llSVApOwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIExPRy5pbmZvKCJGb2xs\nb3dpbmcgbGVkZ2VyczogIiArIGxlZGdlcnMgKyAiIG9mIGJvb2tpZTogIiAr\nIGJvb2tpZUlQCiAgICAgICAgICAgICAgICArICIgYXJlIGlkZW50aWZpZWQg\nYXMgdW5kZXJyZXBsaWNhdGVkIik7CiAgICAgICAgZm9yIChMb25nIGxlZGdl\ncklkIDogbGVkZ2VycykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgbGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdl\nclVuZGVycmVwbGljYXRlZCgKICAgICAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VySWQsIGJvb2tpZUlQKTsKICAgICAgICAgICAgfSBjYXRjaCAoVW5hdmFp\nbGFibGVFeGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBCS0F1ZGl0RXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAi\nRmFpbGVkIHRvIHB1Ymxpc2ggdW5kZXJyZXBsaWNhdGVkIGxlZGdlcjogIiAr\nIGxlZGdlcklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nIG9mIGJvb2tpZTogIiArIGJvb2tpZUlQLCB1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNzIHRoZSBy\nZXN1bHQgcmV0dXJuZWQgZnJvbSBjaGVja2luZyBhIGxlZGdlcgogICAgICov\nCiAgICBwcml2YXRlIGNsYXNzIFByb2Nlc3NMb3N0RnJhZ21lbnRzQ2IgaW1w\nbGVtZW50cyBHZW5lcmljQ2FsbGJhY2s8U2V0PExlZGdlckZyYWdtZW50Pj4g\newogICAgICAgIGZpbmFsIExlZGdlckhhbmRsZSBsaDsKICAgICAgICBmaW5h\nbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBjYWxsYmFjazsKCiAgICAg\nICAgUHJvY2Vzc0xvc3RGcmFnbWVudHNDYihMZWRnZXJIYW5kbGUgbGgsIEFz\neW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGNhbGxiYWNrKSB7CiAgICAgICAg\nICAgIHRoaXMubGggPSBsaDsKICAgICAgICAgICAgdGhpcy5jYWxsYmFjayA9\nIGNhbGxiYWNrOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uQ29tcGxldGUoaW50IHJjLCBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IGZy\nYWdtZW50cykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\naWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAg\nICAgICAgICBTZXQ8Qm9va2llU29ja2V0QWRkcmVzcz4gYm9va2llcyA9IFNl\ndHMubmV3SGFzaFNldCgpOwogICAgICAgICAgICAgICAgICAgIGZvciAoTGVk\nZ2VyRnJhZ21lbnQgZiA6IGZyYWdtZW50cykgewogICAgICAgICAgICAgICAg\nICAgICAgICBib29raWVzLmFkZChmLmdldEFkZHJlc3MoKSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGZvciAoQm9va2ll\nU29ja2V0QWRkcmVzcyBib29raWUgOiBib29raWVzKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHB1Ymxpc2hTdXNwZWN0ZWRMZWRnZXJzKGJvb2tpZS50\nb1N0cmluZygpLCBTZXRzLm5ld0hhc2hTZXQobGguZ2V0SWQoKSkpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhj\nZXB0aW9uIGJrZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJv\nciBjbG9zaW5nIGxoIiwgYmtlKTsKICAgICAgICAgICAgICAgIGlmIChyYyA9\nPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAg\ncmMgPSBCS0V4Y2VwdGlvbi5Db2RlLlJlcGxpY2F0aW9uRXhjZXB0aW9uOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJJbnRlcnJ1cHRlZCBwdWJsaXNoaW5nIHN1c3BlY3RlZCBsZWRnZXIiLCBp\nZSk7CiAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmlu\ndGVycnVwdCgpOwogICAgICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0\naW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICByYyA9IEJLRXhj\nZXB0aW9uLkNvZGUuSW50ZXJydXB0ZWRFeGNlcHRpb247CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEJLQXVkaXRFeGNlcHRpb24g\nYmthZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJBdWRpdG9yIGV4\nY2VwdGlvbiBwdWJsaXNoaW5nIHN1c3BlY3RlZCBsZWRnZXIiLCBia2FlKTsK\nICAgICAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk9L\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2Rl\nLlJlcGxpY2F0aW9uRXhjZXB0aW9uOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBjYWxsYmFjay5wcm9jZXNzUmVzdWx0\nKHJjLCBudWxsLCBudWxsKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBMaXN0IGFsbCB0aGUgbGVkZ2VycyBhbmQgY2hlY2sgdGhlbSBpbmRp\ndmlkdWFsbHkuIFRoaXMgc2hvdWxkIG5vdAogICAgICogYmUgcnVuIHZlcnkg\nb2Z0ZW4uCiAgICAgKi8KICAgIHZvaWQgY2hlY2tBbGxMZWRnZXJzKCkgdGhy\nb3dzIEJLQXVkaXRFeGNlcHRpb24sIEJLRXhjZXB0aW9uLAogICAgICAgICAg\nICBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEtlZXBlckV4\nY2VwdGlvbiB7CiAgICAgICAgWm9vS2VlcGVyV2F0Y2hlckJhc2UgdyA9IG5l\ndyBab29LZWVwZXJXYXRjaGVyQmFzZShjb25mLmdldFprVGltZW91dCgpKTsK\nICAgICAgICBab29LZWVwZXIgbmV3emsgPSBaa1V0aWxzLmNyZWF0ZUNvbm5l\nY3RlZFpvb2tlZXBlckNsaWVudChjb25mLmdldFprU2VydmVycygpLCB3KTsK\nCiAgICAgICAgZmluYWwgQm9va0tlZXBlciBjbGllbnQgPSBuZXcgQm9va0tl\nZXBlcihuZXcgQ2xpZW50Q29uZmlndXJhdGlvbihjb25mKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld3pr\nKTsKICAgICAgICBmaW5hbCBCb29rS2VlcGVyQWRtaW4gYWRtaW4gPSBuZXcg\nQm9va0tlZXBlckFkbWluKGNsaWVudCk7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGZpbmFsIExlZGdlckNoZWNrZXIgY2hlY2tlciA9IG5ldyBMZWRn\nZXJDaGVja2VyKGNsaWVudCk7CgogICAgICAgICAgICBmaW5hbCBBdG9taWNJ\nbnRlZ2VyIHJldHVybkNvZGUgPSBuZXcgQXRvbWljSW50ZWdlcihCS0V4Y2Vw\ndGlvbi5Db2RlLk9LKTsKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0\nY2ggcHJvY2Vzc0RvbmUgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAg\nICAgICAgICBQcm9jZXNzb3I8TG9uZz4gY2hlY2tMZWRnZXJzUHJvY2Vzc29y\nID0gbmV3IFByb2Nlc3NvcjxMb25nPigpIHsKICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzcyhm\naW5hbCBMb25nIGxlZGdlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBj\nYWxsYmFjaykgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmICghbGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1h\nbmFnZXIuaXNMZWRnZXJSZXBsaWNhdGlvbkVuYWJsZWQoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciByZXJlcGxp\nY2F0aW9uIGhhcyBiZWVuIGRpc2FibGVkLCBhYm9ydGluZyBwZXJpb2RpYyBj\naGVjayIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0Rv\nbmUuY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9IGNhdGNoIChSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWls\nYWJsZUV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIlVuZGVycmVwbGljYXRpb24gbWFuYWdlciB1bmF2YWlsYWJs\nZSAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArInJ1bm5p\nbmcgcGVyaW9kaWMgY2hlY2siLCB1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHByb2Nlc3NEb25lLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBudWxsOwogICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxo\nID0gYWRtaW4ub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQpOwogICAg\nICAgICAgICAgICAgICAgICAgICBjaGVja2VyLmNoZWNrTGVkZ2VyKGxoLCBu\nZXcgUHJvY2Vzc0xvc3RGcmFnbWVudHNDYihsaCwgY2FsbGJhY2spKTsKICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS05vU3Vj\naExlZGdlckV4aXN0c0V4Y2VwdGlvbiBia25zbGUpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJMZWRnZXIgd2FzIGRlbGV0ZWQgYmVm\nb3JlIHdlIGNvdWxkIGNoZWNrIGl0IiwgYmtuc2xlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgY2FsbGJhY2sucHJvY2Vzc1Jlc3VsdChCS0V4Y2VwdGlv\nbi5Db2RlLk9LLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoQktF\neGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiQ291bGRuJ3Qgb3BlbiBsZWRnZXIgIiArIGxlZGdlcklkLCBia2Up\nOwogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5wcm9jZXNzUmVz\ndWx0KEJLRXhjZXB0aW9uLkNvZGUuQm9va2llSGFuZGxlTm90QXZhaWxhYmxl\nRXhjZXB0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0\nZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJJbnRlcnJ1cHRlZCBvcGVuaW5nIGxlZGdlciIsIGllKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5p\nbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2su\ncHJvY2Vzc1Jlc3VsdChCS0V4Y2VwdGlvbi5Db2RlLkludGVycnVwdGVkRXhj\nZXB0aW9uLCBudWxsLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChsaCAhPSBudWxsKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQ291bGRuJ3QgY2xv\nc2UgbGVkZ2VyICIgKyBsZWRnZXJJZCwgYmtlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGll\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4o\nIkludGVycnVwdGVkIGNsb3NpbmcgbGVkZ2VyICIgKyBsZWRnZXJJZCwgaWUp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5jdXJy\nZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07\nCgogICAgICAgICAgICBsZWRnZXJNYW5hZ2VyLmFzeW5jUHJvY2Vzc0xlZGdl\ncnMoY2hlY2tMZWRnZXJzUHJvY2Vzc29yLAogICAgICAgICAgICAgICAgICAg\nIG5ldyBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjaygpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcg\ncywgT2JqZWN0IG9iaikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuQ29kZS5zZXQocmMpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcHJvY2Vzc0RvbmUuY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9LCBudWxsLCBCS0V4Y2Vw\ndGlvbi5Db2RlLk9LLCBCS0V4Y2VwdGlvbi5Db2RlLlJlYWRFeGNlcHRpb24p\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcHJvY2Vzc0Rv\nbmUuYXdhaXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRU\naHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBCS0F1ZGl0RXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAi\nRXhjZXB0aW9uIHdoaWxlIGNoZWNraW5nIGxlZGdlcnMiLCBlKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAocmV0dXJuQ29kZS5nZXQoKSAhPSBC\nS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBC\nS0V4Y2VwdGlvbi5jcmVhdGUocmV0dXJuQ29kZS5nZXQoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBhZG1pbi5j\nbG9zZSgpOwogICAgICAgICAgICBjbGllbnQuY2xvc2UoKTsKICAgICAgICAg\nICAgbmV3emsuY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBhdmFpbGFibGVCb29raWVzQ2hhbmdlZCgp\nIHsKICAgICAgICBzdWJtaXRBdWRpdFRhc2soKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFNodXRkb3duIHRoZSBhdWRpdG9yCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIHNodXRkb3duKCkgewogICAgICAgIExPRy5pbmZvKCJTaHV0dGlu\nZyBkb3duIGF1ZGl0b3IiKTsKICAgICAgICBzdWJtaXRTaHV0ZG93blRhc2so\nKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2hpbGUgKCFleGVjdXRv\nci5hd2FpdFRlcm1pbmF0aW9uKDMwLCBUaW1lVW5pdC5TRUNPTkRTKSkgewog\nICAgICAgICAgICAgICAgTE9HLndhcm4oIkV4ZWN1dG9yIG5vdCBzaHV0dGlu\nZyBkb3duLCBpbnRlcnJ1cHRpbmciKTsKICAgICAgICAgICAgICAgIGV4ZWN1\ndG9yLnNodXRkb3duTm93KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nYWRtaW4uY2xvc2UoKTsKICAgICAgICAgICAgYmtjLmNsb3NlKCk7CiAgICAg\nICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAg\nICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAg\nICAgICAgICAgTE9HLndhcm4oIkludGVycnVwdGVkIHdoaWxlIHNodXR0aW5n\nIGRvd24gYXVkaXRvciBib29raWUiLCBpZSk7CiAgICAgICAgfSBjYXRjaCAo\nQktFeGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJFeGNl\ncHRpb24gd2hpbGUgc2h1dHRpbmcgZG93biBhdWRpdG9yIGJvb2tpZSIsIGJr\nZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmV0dXJuIHRy\ndWUgaWYgYXVkaXRvciBpcyBydW5uaW5nIG90aGVyd2lzZSByZXR1cm4gZmFs\nc2UKICAgICAqCiAgICAgKiBAcmV0dXJuIGF1ZGl0b3Igc3RhdHVzCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzUnVubmluZygpIHsKICAgICAgICBy\nZXR1cm4gIWV4ZWN1dG9yLmlzU2h1dGRvd24oKTsKICAgIH0KCiAgICBwcml2\nYXRlIGZpbmFsIFJ1bm5hYmxlIEJPT0tJRV9DSEVDSyA9IG5ldyBSdW5uYWJs\nZSgpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBhdWRpdEJvb2tp\nZXMoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGJr\nZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGRuJ3Qg\nZ2V0IGJvb2tpZSBsaXN0LCBleGl0aW5nIiwgYmtlKTsKICAgICAgICAgICAg\nICAgICAgICBzdWJtaXRTaHV0ZG93blRhc2soKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHdhdGNoaW5nIGF2\nYWlsYWJsZSBib29raWVzIiwga2UpOwogICAgICAgICAgICAgICAgICAgIHN1\nYm1pdFNodXRkb3duVGFzaygpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAg\nICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAg\nICAgICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJydXB0ZWQgd2hpbGUgd2F0\nY2hpbmcgYXZhaWxhYmxlIGJvb2tpZXMgIiwgaWUpOwogICAgICAgICAgICAg\nICAgICAgIHN1Ym1pdFNodXRkb3duVGFzaygpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoQktBdWRpdEV4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSB3YXRjaGluZyBh\ndmFpbGFibGUgYm9va2llcyIsIGJrZSk7CiAgICAgICAgICAgICAgICAgICAg\nc3VibWl0U2h1dGRvd25UYXNrKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9OwoKfQo=\n","encoding":"base64"}

