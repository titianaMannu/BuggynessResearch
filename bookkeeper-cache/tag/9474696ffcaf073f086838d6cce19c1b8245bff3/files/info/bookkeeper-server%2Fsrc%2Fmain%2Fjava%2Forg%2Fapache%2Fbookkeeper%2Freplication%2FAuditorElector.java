{"sha":"c4fb77dffa4127f7208450d1ca25fd693e18fc56","node_id":"MDQ6QmxvYjE1NzU5NTY6YzRmYjc3ZGZmYTQxMjdmNzIwODQ1MGQxY2EyNWZkNjkzZTE4ZmM1Ng==","size":15494,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c4fb77dffa4127f7208450d1ca25fd693e18fc56","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmlvLklPRXhj\nZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5E\nYXRhRm9ybWF0cy5BdWRpdG9yVm90ZUZvcm1hdDsKaW1wb3J0IGNvbS5nb29n\nbGUuY29tbW9uLmFubm90YXRpb25zLlZpc2libGVGb3JUZXN0aW5nOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JzOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JTZXJ2aWNlOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuVGhyZWFkRmFjdG9yeTsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNCb29sZWFuOwoKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5uZXQuQm9va2llU29ja2V0QWRkcmVz\nczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNv\nbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVw\nbGljYXRpb24uUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RhdHMuQ291\nbnRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdGF0cy5OdWxs\nU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3Rh\ndHMuU3RhdHNMb2dnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ndXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3JnLmFwYWNoZS5j\nb21tb25zLmxhbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLnpv\nb2tlZXBlci5DcmVhdGVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nV2F0Y2hlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXIuRXZlbnQu\nRXZlbnRUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hl\nci5FdmVudC5LZWVwZXJTdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLlpvb0RlZnMuSWRzOwppbXBvcnQgY29tLmdvb2dsZS5wcm90b2J1Zi5U\nZXh0Rm9ybWF0OwppbXBvcnQgc3RhdGljIGNvbS5nb29nbGUuY29tbW9uLmJh\nc2UuQ2hhcnNldHMuVVRGXzg7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IHN0YXRp\nYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRp\nb25TdGF0cy5FTEVDVElPTl9BVFRFTVBUUzsKCi8qKgogKiBQZXJmb3JtaW5n\nIGF1ZGl0b3IgZWxlY3Rpb24gdXNpbmcgQXBhY2hlIFpvb0tlZXBlci4gVXNp\nbmcgWm9vS2VlcGVyIGFzIGEKICogY29vcmRpbmF0aW9uIHNlcnZpY2UsIHdo\nZW4gYSBib29raWUgYmlkcyBmb3IgYXVkaXRvciwgaXQgY3JlYXRlcyBhbiBl\ncGhlbWVyYWwKICogc2VxdWVudGlhbCBmaWxlICh6bm9kZSkgb24gWm9vS2Vl\ncGVyIGFuZCBjb25zaWRlcmVkIGFzIHRoZWlyIHZvdGUuIFZvdGUKICogZm9y\nbWF0IGlzICdWX3NlcXVlbmNlbnVtYmVyJy4gRWxlY3Rpb24gd2lsbCBiZSBk\nb25lIGJ5IGNvbXBhcmluZyB0aGUKICogZXBoZW1lcmFsIHNlcXVlbnRpYWwg\nbnVtYmVycyBhbmQgdGhlIGJvb2tpZSB3aGljaCBoYXMgY3JlYXRlZCB0aGUg\nbGVhc3Qgem5vZGUKICogd2lsbCBiZSBlbGVjdGVkIGFzIEF1ZGl0b3IuIEFs\nbCB0aGUgb3RoZXIgYm9va2llcyB3aWxsIGJlIHdhdGNoaW5nIG9uIHRoZWly\nCiAqIHByZWRlY2Vzc29yIHpub2RlIGFjY29yZGluZyB0byB0aGUgZXBoZW1l\ncmFsIHNlcXVlbmNlIG51bWJlcnMuCiAqLwpwdWJsaWMgY2xhc3MgQXVkaXRv\nckVsZWN0b3IgewogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExP\nRyA9IExvZ2dlckZhY3RvcnkKICAgICAgICAgICAgLmdldExvZ2dlcihBdWRp\ndG9yRWxlY3Rvci5jbGFzcyk7CiAgICAvLyBSZXByZXNlbnRzIHRoZSBpbmRl\neCBvZiB0aGUgYXVkaXRvciBub2RlCiAgICBwcml2YXRlIHN0YXRpYyBmaW5h\nbCBpbnQgQVVESVRPUl9JTkRFWCA9IDA7CiAgICAvLyBSZXByZXNlbnRzIHZv\ndGUgcHJlZml4CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgVk9U\nRV9QUkVGSVggPSAiVl8iOwogICAgLy8gUmVwcmVzZW50cyBwYXRoIFNlcGFy\nYXRvcgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5nIFBBVEhfU0VQ\nQVJBVE9SID0gIi8iOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3RyaW5n\nIEVMRUNUSU9OX1pOT0RFID0gImF1ZGl0b3JlbGVjdGlvbiI7CiAgICAvLyBS\nZXByZXNlbnRzIHVyTGVkZ2VyIHBhdGggaW4gemsKICAgIHByaXZhdGUgZmlu\nYWwgU3RyaW5nIGJhc2VQYXRoOwogICAgLy8gUmVwcmVzZW50cyBhdWRpdG9y\nIGVsZWN0aW9uIHBhdGggaW4gemsKICAgIHByaXZhdGUgZmluYWwgU3RyaW5n\nIGVsZWN0aW9uUGF0aDsKCiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBib29r\naWVJZDsKICAgIHByaXZhdGUgZmluYWwgU2VydmVyQ29uZmlndXJhdGlvbiBj\nb25mOwogICAgcHJpdmF0ZSBmaW5hbCBab29LZWVwZXIgemtjOwogICAgcHJp\ndmF0ZSBmaW5hbCBFeGVjdXRvclNlcnZpY2UgZXhlY3V0b3I7CgogICAgcHJp\ndmF0ZSBTdHJpbmcgbXlWb3RlOwogICAgQXVkaXRvciBhdWRpdG9yOwogICAg\ncHJpdmF0ZSBBdG9taWNCb29sZWFuIHJ1bm5pbmcgPSBuZXcgQXRvbWljQm9v\nbGVhbihmYWxzZSk7CgogICAgLy8gRXhwb3NlIFN0YXRzCiAgICBwcml2YXRl\nIGZpbmFsIENvdW50ZXIgZWxlY3Rpb25BdHRlbXB0czsKCiAgICAvKioKICAg\nICAqIEF1ZGl0b3JFbGVjdG9yIGZvciBwZXJmb3JtaW5nIHRoZSBhdWRpdG9y\nIGVsZWN0aW9uCiAgICAgKgogICAgICogQHBhcmFtIGJvb2tpZUlkCiAgICAg\nKiAgICAgICAgICAgIC0gYm9va2llIGlkZW50aWZpZXIsIGNvbXByaXNlcyBI\nb3N0QWRkcmVzczpQb3J0CiAgICAgKiBAcGFyYW0gY29uZgogICAgICogICAg\nICAgICAgICAtIGNvbmZpZ3VyYXRpb24KICAgICAqIEBwYXJhbSB6a2MKICAg\nICAqICAgICAgICAgICAgLSBaSyBpbnN0YW5jZQogICAgICogQHRocm93cyBV\nbmF2YWlsYWJsZUV4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgdGhyb3dz\nIHVuYXZhaWxhYmxlIGV4Y2VwdGlvbiB3aGlsZSBpbml0aWFsaXppbmcgdGhl\nIGVsZWN0b3IKICAgICAqLwogICAgcHVibGljIEF1ZGl0b3JFbGVjdG9yKGZp\nbmFsIFN0cmluZyBib29raWVJZCwgU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nLAogICAgICAgICAgICAgICAgICAgICAgICAgIFpvb0tlZXBlciB6a2MpIHRo\ncm93cyBVbmF2YWlsYWJsZUV4Y2VwdGlvbiB7CiAgICAgICAgdGhpcyhib29r\naWVJZCwgY29uZiwgemtjLCBOdWxsU3RhdHNMb2dnZXIuSU5TVEFOQ0UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQXVkaXRvckVsZWN0b3IgZm9yIHBlcmZv\ncm1pbmcgdGhlIGF1ZGl0b3IgZWxlY3Rpb24KICAgICAqCiAgICAgKiBAcGFy\nYW0gYm9va2llSWQKICAgICAqICAgICAgICAgICAgLSBib29raWUgaWRlbnRp\nZmllciwgY29tcHJpc2VzIEhvc3RBZGRyZXNzOlBvcnQKICAgICAqIEBwYXJh\nbSBjb25mCiAgICAgKiAgICAgICAgICAgIC0gY29uZmlndXJhdGlvbgogICAg\nICogQHBhcmFtIHprYwogICAgICogICAgICAgICAgICAtIFpLIGluc3RhbmNl\nCiAgICAgKiBAcGFyYW0gc3RhdHNMb2dnZXIKICAgICAqICAgICAgICAgICAg\nLSBzdGF0cyBsb2dnZXIKICAgICAqIEB0aHJvd3MgVW5hdmFpbGFibGVFeGNl\ncHRpb24KICAgICAqICAgICAgICAgICAgIHRocm93cyB1bmF2YWlsYWJsZSBl\neGNlcHRpb24gd2hpbGUgaW5pdGlhbGl6aW5nIHRoZSBlbGVjdG9yCiAgICAg\nKi8KICAgIHB1YmxpYyBBdWRpdG9yRWxlY3RvcihmaW5hbCBTdHJpbmcgYm9v\na2llSWQsIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICBab29LZWVwZXIgemtjLCBTdGF0c0xvZ2dlciBzdGF0\nc0xvZ2dlcikgdGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAgICAg\nICB0aGlzLmJvb2tpZUlkID0gYm9va2llSWQ7CiAgICAgICAgdGhpcy5jb25m\nID0gY29uZjsKICAgICAgICB0aGlzLnprYyA9IHprYzsKICAgICAgICB0aGlz\nLmVsZWN0aW9uQXR0ZW1wdHMgPSBzdGF0c0xvZ2dlci5nZXRDb3VudGVyKEVM\nRUNUSU9OX0FUVEVNUFRTKTsKICAgICAgICBiYXNlUGF0aCA9IGNvbmYuZ2V0\nWmtMZWRnZXJzUm9vdFBhdGgoKSArICcvJwogICAgICAgICAgICAgICAgKyBC\nb29rS2VlcGVyQ29uc3RhbnRzLlVOREVSX1JFUExJQ0FUSU9OX05PREU7CiAg\nICAgICAgZWxlY3Rpb25QYXRoID0gYmFzZVBhdGggKyAnLycgKyBFTEVDVElP\nTl9aTk9ERTsKICAgICAgICBjcmVhdGVFbGVjdG9yUGF0aCgpOwogICAgICAg\nIGV4ZWN1dG9yID0gRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZEV4ZWN1dG9y\nKG5ldyBUaHJlYWRGYWN0b3J5KCkgewogICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgVGhyZWFkIG5ld1RocmVhZChS\ndW5uYWJsZSByKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBU\naHJlYWQociwgIkF1ZGl0b3JFbGVjdG9yLSIrYm9va2llSWQpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgIH0KCiAgICBwcml2YXRl\nIHZvaWQgY3JlYXRlTXlWb3RlKCkgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwg\nSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIGlmIChudWxsID09IG15\nVm90ZSB8fCBudWxsID09IHprYy5leGlzdHMobXlWb3RlLCBmYWxzZSkpIHsK\nICAgICAgICAgICAgQXVkaXRvclZvdGVGb3JtYXQuQnVpbGRlciBidWlsZGVy\nID0gQXVkaXRvclZvdGVGb3JtYXQubmV3QnVpbGRlcigpCiAgICAgICAgICAg\nICAgICAuc2V0Qm9va2llSWQoYm9va2llSWQpOwogICAgICAgICAgICBteVZv\ndGUgPSB6a2MuY3JlYXRlKGdldFZvdGVQYXRoKFBBVEhfU0VQQVJBVE9SICsg\nVk9URV9QUkVGSVgpLAogICAgICAgICAgICAgICAgICAgIFRleHRGb3JtYXQu\ncHJpbnRUb1N0cmluZyhidWlsZGVyLmJ1aWxkKCkpLmdldEJ5dGVzKFVURl84\nKSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAgICAgICAgICAgICBD\ncmVhdGVNb2RlLkVQSEVNRVJBTF9TRVFVRU5USUFMKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0Vm90ZVBhdGgoU3RyaW5nIHZv\ndGUpIHsKICAgICAgICByZXR1cm4gZWxlY3Rpb25QYXRoICsgdm90ZTsKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgY3JlYXRlRWxlY3RvclBhdGgoKSB0aHJv\nd3MgVW5hdmFpbGFibGVFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGlmICh6a2MuZXhpc3RzKGJhc2VQYXRoLCBmYWxzZSkgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICB6a2MuY3JlYXRlKGJhc2VQYXRoLCBuZXcgYnl0ZVswXSwgSWRzLk9QRU5f\nQUNMX1VOU0FGRSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIENyZWF0\nZU1vZGUuUEVSU0lTVEVOVCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChL\nZWVwZXJFeGNlcHRpb24uTm9kZUV4aXN0c0V4Y2VwdGlvbiBuZWUpIHsKICAg\nICAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nLCBzb21lb25lIGVsc2Ug\nY291bGQgaGF2ZSBjcmVhdGVkIGl0CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKHprYy5leGlzdHMoZ2V0Vm90ZVBh\ndGgoIiIpLCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICB6a2MuY3JlYXRlKGdldFZvdGVQYXRo\nKCIiKSwgbmV3IGJ5dGVbMF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5v\nZGVFeGlzdHNFeGNlcHRpb24gbmVlKSB7CiAgICAgICAgICAgICAgICAgICAg\nLy8gZG8gbm90aGluZywgc29tZW9uZSBlbHNlIGNvdWxkIGhhdmUgY3JlYXRl\nZCBpdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAg\nfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBVbmF2YWlsYWJsZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAg\nICAgICAiRmFpbGVkIHRvIGluaXRpYWxpemUgQXVkaXRvciBFbGVjdG9yIiwg\na2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGll\nKSB7CiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJy\ndXB0KCk7CiAgICAgICAgICAgIHRocm93IG5ldyBVbmF2YWlsYWJsZUV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGluaXRpYWxp\nemUgQXVkaXRvciBFbGVjdG9yIiwgaWUpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFdhdGNoaW5nIHRoZSBwcmVkZWNlc3NvciBib29raWVz\nIGFuZCB3aWxsIGRvIGVsZWN0aW9uIG9uIHByZWRlY2Vzc29yIG5vZGUKICAg\nICAqIGRlbGV0aW9uIG9yIGV4cGlyYXRpb24uCiAgICAgKi8KICAgIHByaXZh\ndGUgY2xhc3MgRWxlY3Rpb25XYXRjaGVyIGltcGxlbWVudHMgV2F0Y2hlciB7\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vz\ncyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAgICAgaWYgKGV2ZW50\nLmdldFN0YXRlKCkgPT0gS2VlcGVyU3RhdGUuRXhwaXJlZCkgewogICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJMb3N0IFpLIGNvbm5lY3Rpb24sIHNodXR0\naW5nIGRvd24iKTsKICAgICAgICAgICAgICAgIHN1Ym1pdFNodXRkb3duVGFz\naygpOwogICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFR5cGUoKSA9\nPSBFdmVudFR5cGUuTm9kZURlbGV0ZWQpIHsKICAgICAgICAgICAgICAgIHN1\nYm1pdEVsZWN0aW9uVGFzaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0KCkgewogICAgICAgIHJ1bm5p\nbmcuc2V0KHRydWUpOwogICAgICAgIHN1Ym1pdEVsZWN0aW9uVGFzaygpOwog\nICAgfQoKICAgIC8qKgogICAgICogUnVuIGNsZWFudXAgb3BlcmF0aW9ucyBm\nb3IgdGhlIGF1ZGl0b3IgZWxlY3Rvci4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIHN1Ym1pdFNodXRkb3duVGFzaygpIHsKICAgICAgICBleGVjdXRvci5z\ndWJtaXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIGlmICghcnVubmlu\nZy5jb21wYXJlQW5kU2V0KHRydWUsIGZhbHNlKSkgewogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIExPRy5pbmZvKCJTaHV0dGluZyBkb3duIEF1ZGl0\nb3JFbGVjdG9yIik7CiAgICAgICAgICAgICAgICAgICAgaWYgKG15Vm90ZSAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB6a2MuZGVsZXRlKG15Vm90ZSwgLTEp\nOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLndhcm4oIkludGVycnVwdGVkRXhjZXB0aW9uIHdoaWxlIGRlbGV0aW5n\nIG15Vm90ZTogIiArIG15Vm90ZSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGllKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSBkZWxldGlu\nZyBteVZvdGU6IiArIG15Vm90ZSwga2UpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFBlcmZv\ncm1pbmcgdGhlIGF1ZGl0b3IgZWxlY3Rpb24gdXNpbmcgdGhlIFpvb0tlZXBl\nciBlcGhlbWVyYWwgc2VxdWVudGlhbAogICAgICogem5vZGUuIFRoZSBib29r\naWUgd2hpY2ggaGFzIGNyZWF0ZWQgdGhlIGxlYXN0IHNlcXVlbnRpYWwgd2ls\nbCBiZSBlbGVjdCBhcwogICAgICogQXVkaXRvci4KICAgICAqLwogICAgQFZp\nc2libGVGb3JUZXN0aW5nCiAgICB2b2lkIHN1Ym1pdEVsZWN0aW9uVGFzaygp\nIHsKCiAgICAgICAgUnVubmFibGUgciA9IG5ldyBSdW5uYWJsZSgpIHsKICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoIXJ1bm5pbmcuZ2V0KCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAv\nLyBjcmVhdGluZyBteSB2b3RlIGluIHprLiBWb3RlIGZvcm1hdCBpcyAnVl9u\ndW1lcmljJwogICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVNeVZvdGUo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxTdHJpbmc+IGNoaWxk\ncmVuID0gemtjLmdldENoaWxkcmVuKGdldFZvdGVQYXRoKCIiKSwgZmFsc2Up\nOwoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKDAgPj0gY2hpbGRyZW4u\nc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAiQXRsZWFzdCBvbmUgYm9va2llIHNlcnZl\nciBzaG91bGQgcHJlc2VudCB0byBlbGVjdCB0aGUgQXVkaXRvciEiKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gc29ydGluZyBpbiBhc2NlbmRpbmcgb3JkZXIgb2Ygc2VxdWVudGlh\nbCBudW1iZXIKICAgICAgICAgICAgICAgICAgICAgICAgQ29sbGVjdGlvbnMu\nc29ydChjaGlsZHJlbiwgbmV3IEVsZWN0aW9uQ29tcGFyYXRvcigpKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHZvdGVOb2RlID0gU3RyaW5n\nVXRpbHMuc3Vic3RyaW5nQWZ0ZXJMYXN0KG15Vm90ZSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFBBVEhfU0VQQVJBVE9SKTsKCiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIHN0YXJ0aW5nIEF1ZGl0aW5nIHNlcnZpY2UKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkcmVuLmdldChBVURJVE9S\nX0lOREVYKS5lcXVhbHModm90ZU5vZGUpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyB1cGRhdGUgdGhlIGF1ZGl0b3IgYm9va2llIGlkIGlu\nIHRoZSBlbGVjdGlvbiBwYXRoLiBUaGlzIGlzCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBkb25lIGZvciBkZWJ1Z2dpbmcgcHVycG9zZQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgQXVkaXRvclZvdGVGb3JtYXQuQnVp\nbGRlciBidWlsZGVyID0gQXVkaXRvclZvdGVGb3JtYXQubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldEJvb2tpZUlk\nKGJvb2tpZUlkKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB6a2Mu\nc2V0RGF0YShnZXRWb3RlUGF0aCgiIiksCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBUZXh0Rm9ybWF0LnByaW50VG9TdHJpbmco\nYnVpbGRlci5idWlsZCgpKS5nZXRCeXRlcyhVVEZfOCksIC0xKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGF1ZGl0b3IgPSBuZXcgQXVkaXRvcihi\nb29raWVJZCwgY29uZiwgemtjKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGF1ZGl0b3Iuc3RhcnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIG5v\ndCBhbiBhdWRpdG9yLCB3aWxsIGJlIHdhdGNoaW5nIHRvIG15IHByZWRlY2Vz\nc29yIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9va2lu\nZyB0aGUgcHJldmlvdXMgbm9kZSBkZWxldGlvbi4KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIFdhdGNoZXIgZWxlY3Rpb25XYXRjaGVyID0gbmV3IEVs\nZWN0aW9uV2F0Y2hlcigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\naW50IG15SW5kZXggPSBjaGlsZHJlbi5pbmRleE9mKHZvdGVOb2RlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGludCBwcmV2Tm9kZUluZGV4ID0g\nbXlJbmRleCAtIDE7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbnVsbCA9PSB6a2MuZXhpc3RzKGdldFZvdGVQYXRoKFBBVEhfU0VQQVJBVE9S\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArIGNoaWxkcmVuLmdldChwcmV2Tm9kZUluZGV4KSwgZWxlY3Rp\nb25XYXRjaGVyKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIFdoaWxlIGFkZGluZywgdGhlIHByZXZpb3VzIHpub2RlIGRvZXNuJ3Qg\nZXhpc3RzLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFn\nYWluIGdvaW5nIHRvIGVsZWN0aW9uLgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHN1Ym1pdEVsZWN0aW9uVGFzaygpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZWxlY3Rpb25BdHRlbXB0cy5pbmMoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigi\nRXhjZXB0aW9uIHdoaWxlIHBlcmZvcm1pbmcgYXVkaXRvciBlbGVjdGlvbiIs\nIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRTaHV0ZG93blRh\nc2soKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiSW50ZXJydXB0ZWQgd2hpbGUgcGVyZm9ybWluZyBhdWRpdG9yIGVs\nZWN0aW9uIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5j\ndXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHN1Ym1pdFNodXRkb3duVGFzaygpOwogICAgICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJMZWRnZXIgdW5kZXJyZXBs\naWNhdGlvbiBtYW5hZ2VyIHVuYXZhaWxhYmxlIGR1cmluZyBlbGVjdGlvbiIs\nIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRTaHV0ZG93blRh\nc2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH07CiAgICAgICAgZXhlY3V0b3Iuc3VibWl0KHIpOwog\nICAgfQoKICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgQXVkaXRvciBnZXRB\ndWRpdG9yKCkgewogICAgICAgIHJldHVybiBhdWRpdG9yOwogICAgfQoKICAg\nIC8qKgogICAgICogUXVlcnkgem9va2VlcGVyIGZvciB0aGUgY3VycmVudGx5\nIGVsZWN0ZWQgYXVkaXRvcgogICAgICogQHJldHVybiB0aGUgYm9va2llIGlk\nIG9mIHRoZSBjdXJyZW50IGF1ZGl0b3IKICAgICAqLwogICAgcHVibGljIHN0\nYXRpYyBCb29raWVTb2NrZXRBZGRyZXNzIGdldEN1cnJlbnRBdWRpdG9yKFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZiwgWm9vS2VlcGVyIHprKQogICAgICAg\nICAgICB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiwgSU9FeGNlcHRpb24gewogICAgICAgIFN0cmluZyBlbGVjdGlvblJv\nb3QgPSBjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkgKyAnLycKICAgICAg\nICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlVOREVSX1JFUExJQ0FUSU9O\nX05PREUgKyAnLycgKyBFTEVDVElPTl9aTk9ERTsKCiAgICAgICAgTGlzdDxT\ndHJpbmc+IGNoaWxkcmVuID0gemsuZ2V0Q2hpbGRyZW4oZWxlY3Rpb25Sb290\nLCBmYWxzZSk7CiAgICAgICAgQ29sbGVjdGlvbnMuc29ydChjaGlsZHJlbiwg\nbmV3IEF1ZGl0b3JFbGVjdG9yLkVsZWN0aW9uQ29tcGFyYXRvcigpKTsKICAg\nICAgICBpZiAoY2hpbGRyZW4uc2l6ZSgpIDwgMSkgewogICAgICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgU3RyaW5nIGxlZGdlciA9\nIGVsZWN0aW9uUm9vdCArICIvIiArIGNoaWxkcmVuLmdldChBVURJVE9SX0lO\nREVYKTsKICAgICAgICBieXRlW10gZGF0YSA9IHprLmdldERhdGEobGVkZ2Vy\nLCBmYWxzZSwgbnVsbCk7CgogICAgICAgIEF1ZGl0b3JWb3RlRm9ybWF0LkJ1\naWxkZXIgYnVpbGRlciA9IEF1ZGl0b3JWb3RlRm9ybWF0Lm5ld0J1aWxkZXIo\nKTsKICAgICAgICBUZXh0Rm9ybWF0Lm1lcmdlKG5ldyBTdHJpbmcoZGF0YSwg\nVVRGXzgpLCBidWlsZGVyKTsKICAgICAgICBBdWRpdG9yVm90ZUZvcm1hdCB2\nID0gYnVpbGRlci5idWlsZCgpOwogICAgICAgIFN0cmluZ1tdIHBhcnRzID0g\ndi5nZXRCb29raWVJZCgpLnNwbGl0KCI6Iik7CiAgICAgICAgcmV0dXJuIG5l\ndyBCb29raWVTb2NrZXRBZGRyZXNzKHBhcnRzWzBdLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBJbnRlZ2VyLnZhbHVlT2YocGFy\ndHNbMV0pKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNodXR0aW5nIGRvd24g\nQXVkaXRvckVsZWN0b3IKICAgICAqLwogICAgcHVibGljIHZvaWQgc2h1dGRv\nd24oKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIHN5\nbmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICBpZiAoZXhlY3V0b3Iu\naXNTaHV0ZG93bigpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgc3VibWl0U2h1dGRvd25UYXNrKCk7CiAg\nICAgICAgICAgIGV4ZWN1dG9yLnNodXRkb3duKCk7CiAgICAgICAgfQoKICAg\nICAgICBpZiAoYXVkaXRvciAhPSBudWxsKSB7CiAgICAgICAgICAgIGF1ZGl0\nb3Iuc2h1dGRvd24oKTsKICAgICAgICAgICAgYXVkaXRvciA9IG51bGw7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogSWYgY3VycmVudCBib29r\naWUgaXMgcnVubmluZyBhcyBhdWRpdG9yLCByZXR1cm4gdGhlIHN0YXR1cyBv\nZiB0aGUKICAgICAqIGF1ZGl0b3IuIE90aGVyd2lzZSByZXR1cm4gdGhlIHN0\nYXR1cyBvZiBlbGVjdG9yLgogICAgICoKICAgICAqIEByZXR1cm4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNSdW5uaW5nKCkgewogICAgICAgIGlm\nIChhdWRpdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGF1ZGl0\nb3IuaXNSdW5uaW5nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBydW5u\naW5nLmdldCgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyZSB0aGUg\ndm90ZXMgaW4gdGhlIGFzY2VuZGluZyBvcmRlciBvZiB0aGUgc2VxdWVuY2Ug\nbnVtYmVyLiBWb3RlCiAgICAgKiBmb3JtYXQgaXMgJ1Zfc2VxdWVuY2VudW1i\nZXInLCBjb21wYXJhdG9yIHdpbGwgZG8gc29ydGluZyBiYXNlZCBvbiB0aGUK\nICAgICAqIG51bWVyaWMgc2VxdWVuY2UgdmFsdWUuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIEVsZWN0aW9uQ29tcGFyYXRvcgogICAgICAg\nIGltcGxlbWVudHMgQ29tcGFyYXRvcjxTdHJpbmc+LCBTZXJpYWxpemFibGUg\newogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiAtMSBpZiB0aGUgZmly\nc3Qgdm90ZSBpcyBsZXNzIHRoYW4gc2Vjb25kLiBSZXR1cm4gMSBpZiB0aGUK\nICAgICAgICAgKiBmaXJzdCB2b3RlIGlzIGdyZWF0ZXIgdGhhbiBzZWNvbmQu\nIFJldHVybiAwIGlmIHRoZSB2b3RlcyBhcmUgZXF1YWwuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIGludCBjb21wYXJlKFN0cmluZyB2b3RlMSwgU3Ry\naW5nIHZvdGUyKSB7CiAgICAgICAgICAgIGxvbmcgdm90ZVNlcUlkMSA9IGdl\ndFZvdGVTZXF1ZW5jZUlkKHZvdGUxKTsKICAgICAgICAgICAgbG9uZyB2b3Rl\nU2VxSWQyID0gZ2V0Vm90ZVNlcXVlbmNlSWQodm90ZTIpOwogICAgICAgICAg\nICBpbnQgcmVzdWx0ID0gdm90ZVNlcUlkMSA8IHZvdGVTZXFJZDIgPyAtMQog\nICAgICAgICAgICAgICAgICAgIDogKHZvdGVTZXFJZDEgPiB2b3RlU2VxSWQy\nID8gMSA6IDApOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSBsb25nIGdldFZvdGVTZXF1ZW5jZUlkKFN0\ncmluZyB2b3RlKSB7CiAgICAgICAgICAgIFN0cmluZyB2b3RlSWQgPSBTdHJp\nbmdVdGlscy5zdWJzdHJpbmdBZnRlcih2b3RlLCBWT1RFX1BSRUZJWCk7CiAg\nICAgICAgICAgIHJldHVybiBMb25nLnBhcnNlTG9uZyh2b3RlSWQpOwogICAg\nICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

