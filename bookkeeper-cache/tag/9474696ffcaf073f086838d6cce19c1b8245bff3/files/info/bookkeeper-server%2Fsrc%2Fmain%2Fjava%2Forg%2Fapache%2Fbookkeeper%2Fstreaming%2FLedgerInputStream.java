{"sha":"7e01bdca2512b14c485b2aa9135b64a564564fd1","node_id":"MDQ6QmxvYjE1NzU5NTY6N2UwMWJkY2EyNTEyYjE0YzQ4NWIyYWE5MTM1YjY0YTU2NDU2NGZkMQ==","size":5849,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7e01bdca2512b14c485b2aa9135b64a564564fd1","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnN0cmVhbWluZzsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5J\nbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9y\ndCBqYXZhLnV0aWwuRW51bWVyYXRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyRW50cnk7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKCnB1YmxpYyBjbGFzcyBMZWRnZXJJbnB1dFN0cmVhbSBleHRlbmRz\nIElucHV0U3RyZWFtIHsKICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExvZ2dl\nciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihMZWRnZXJJbnB1dFN0\ncmVhbS5jbGFzcyk7CiAgICBwcml2YXRlIExlZGdlckhhbmRsZSBsaDsKICAg\nIHByaXZhdGUgQnl0ZUJ1ZmZlciBieXRlYnVmZjsKICAgIGJ5dGVbXSBiYnl0\nZXM7CiAgICBsb25nIGxhc3RFbnRyeSA9IDA7CiAgICBpbnQgaW5jcmVtZW50\nID0gNTA7CiAgICBpbnQgZGVmYXVsdFNpemUgPSAxMDI0ICogMTAyNDsgLy8g\nMU1CIGRlZmF1bHQgc2l6ZQogICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+\nIGxlZGdlclNlcSA9IG51bGw7CgogICAgLyoqCiAgICAgKiBjb25zdHJ1Y3Qg\nYSBvdXRwdXRzdHJlYW0gZnJvbSBhIGxlZGdlciBoYW5kbGUKICAgICAqCiAg\nICAgKiBAcGFyYW0gbGgKICAgICAqICAgICAgICAgICAgbGVkZ2VyIGhhbmRs\nZQogICAgICogQHRocm93cyB7QGxpbmsgQktFeGNlcHRpb259LCB7QGxpbmsg\nSW50ZXJydXB0ZWRFeGNlcHRpb259CiAgICAgKi8KICAgIHB1YmxpYyBMZWRn\nZXJJbnB1dFN0cmVhbShMZWRnZXJIYW5kbGUgbGgpIHRocm93cyBCS0V4Y2Vw\ndGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIHRoaXMubGgg\nPSBsaDsKICAgICAgICBiYnl0ZXMgPSBuZXcgYnl0ZVtkZWZhdWx0U2l6ZV07\nCiAgICAgICAgdGhpcy5ieXRlYnVmZiA9IEJ5dGVCdWZmZXIud3JhcChiYnl0\nZXMpOwogICAgICAgIHRoaXMuYnl0ZWJ1ZmYucG9zaXRpb24odGhpcy5ieXRl\nYnVmZi5saW1pdCgpKTsKICAgICAgICBsYXN0RW50cnkgPSBNYXRoLm1pbihs\naC5nZXRMYXN0QWRkQ29uZmlybWVkKCksIGluY3JlbWVudCk7CiAgICAgICAg\nbGVkZ2VyU2VxID0gbGgucmVhZEVudHJpZXMoMCwgbGFzdEVudHJ5KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIGNvbnN0cnVjdCBhIG91dHB1dHN0cmVhbSBm\ncm9tIGEgbGVkZ2VyIGhhbmRsZQogICAgICoKICAgICAqIEBwYXJhbSBsaAog\nICAgICogICAgICAgICAgICB0aGUgbGVkZ2VyIGhhbmRsZQogICAgICogQHBh\ncmFtIHNpemUKICAgICAqICAgICAgICAgICAgdGhlIHNpemUgb2YgdGhlIGJ1\nZmZlcgogICAgICogQHRocm93cyB7QGxpbmsgQktFeGNlcHRpb259LCB7QGxp\nbmsgSW50ZXJydXB0ZWRFeGNlcHRpb259CiAgICAgKi8KICAgIHB1YmxpYyBM\nZWRnZXJJbnB1dFN0cmVhbShMZWRnZXJIYW5kbGUgbGgsIGludCBzaXplKSB0\naHJvd3MgQktFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAg\nICAgICB0aGlzLmxoID0gbGg7CiAgICAgICAgYmJ5dGVzID0gbmV3IGJ5dGVb\nc2l6ZV07CiAgICAgICAgdGhpcy5ieXRlYnVmZiA9IEJ5dGVCdWZmZXIud3Jh\ncChiYnl0ZXMpOwogICAgICAgIHRoaXMuYnl0ZWJ1ZmYucG9zaXRpb24odGhp\ncy5ieXRlYnVmZi5saW1pdCgpKTsKICAgICAgICBsYXN0RW50cnkgPSBNYXRo\nLm1pbihsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCksIGluY3JlbWVudCk7CiAg\nICAgICAgbGVkZ2VyU2VxID0gbGgucmVhZEVudHJpZXMoMCwgbGFzdEVudHJ5\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ldGhvZCBjbG9zZSBjdXJyZW50\nbHkgZG9lc24ndCBkbyBhbnl0aGluZy4gVGhlIGFwcGxpY2F0aW9uCiAgICAg\nKiBpcyBzdXBwb3NlZCB0byBvcGVuIGFuZCBjbG9zZSB0aGUgbGVkZ2VyIGhh\nbmRsZSBiYWNraW5nIHVwCiAgICAgKiBhIHN0cmVhbSAoe0BsaW5rIExlZGdl\nckhhbmRsZX0pLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2\nb2lkIGNsb3NlKCkgewogICAgICAgIC8vIGRvIG5vdGhpbmcKICAgICAgICAv\nLyBsZXQgdGhlIGFwcGxpY2F0aW9uCiAgICAgICAgLy8gY2xvc2UgdGhlIGxl\nZGdlcgogICAgfQoKICAgIC8qKgogICAgICogcmVmaWxsIHRoZSBidWZmZXIs\nIHdlIG5lZWQgdG8gcmVhZCBtb3JlIGJ5dGVzCiAgICAgKgogICAgICogQHJl\ndHVybiBpZiB3ZSBjYW4gcmVmaWxsIG9yIG5vdAogICAgICovCiAgICBwcml2\nYXRlIHN5bmNocm9uaXplZCBib29sZWFuIHJlZmlsbCgpIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgYnl0ZWJ1ZmYuY2xlYXIoKTsKICAgICAgICBp\nZiAoIWxlZGdlclNlcS5oYXNNb3JlRWxlbWVudHMoKSAmJiBsYXN0RW50cnkg\nPj0gbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKSB7CiAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFsZWRnZXJTZXEu\naGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgLy8gZG8gcmVmaWxs\nCiAgICAgICAgICAgIGxvbmcgbGFzdCA9IE1hdGgubWluKGxhc3RFbnRyeSAr\nIGluY3JlbWVudCwgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGxlZGdlclNlcSA9IGxoLnJl\nYWRFbnRyaWVzKGxhc3RFbnRyeSArIDEsIGxhc3QpOwogICAgICAgICAgICB9\nIGNhdGNoIChCS0V4Y2VwdGlvbiBiaykgewogICAgICAgICAgICAgICAgSU9F\neGNlcHRpb24gaWUgPSBuZXcgSU9FeGNlcHRpb24oYmsuZ2V0TWVzc2FnZSgp\nKTsKICAgICAgICAgICAgICAgIGllLmluaXRDYXVzZShiayk7CiAgICAgICAg\nICAgICAgICB0aHJvdyBpZTsKICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgIFRocmVhZC5j\ndXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgbGFzdEVudHJ5ID0gbGFzdDsKICAgICAgICB9CiAgICAgICAg\nTGVkZ2VyRW50cnkgbGUgPSBsZWRnZXJTZXEubmV4dEVsZW1lbnQoKTsKICAg\nICAgICBiYnl0ZXMgPSBsZS5nZXRFbnRyeSgpOwogICAgICAgIGJ5dGVidWZm\nID0gQnl0ZUJ1ZmZlci53cmFwKGJieXRlcyk7CiAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgc3luY2hyb25p\nemVkIGludCByZWFkKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBi\nb29sZWFuIHRvcmVhZCA9IHRydWU7CiAgICAgICAgaWYgKGJ5dGVidWZmLnJl\nbWFpbmluZygpID09IDApIHsKICAgICAgICAgICAgLy8gdGhlaXIgYXJlIG5v\nIHJlbWFpbmluZyBieXRlcwogICAgICAgICAgICB0b3JlYWQgPSByZWZpbGwo\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRvcmVhZCkgewogICAgICAgICAg\nICBpbnQgcmV0ID0gMHhGRiAmIGJ5dGVidWZmLmdldCgpOwogICAgICAgICAg\nICByZXR1cm4gcmV0OwogICAgICAgIH0KICAgICAgICByZXR1cm4gLTE7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgc3luY2hyb25pemVkIGlu\ndCByZWFkKGJ5dGVbXSBiKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIC8vIGJlIHNtYXJ0IC4uLiBqdXN0IGNvcHkgdGhlIGJ5dGVzCiAgICAgICAg\nLy8gb25jZSBhbmQgcmV0dXJuIHRoZSBzaXplCiAgICAgICAgLy8gdXNlciB3\naWxsIGNhbGwgaXQgYWdhaW4KICAgICAgICBib29sZWFuIHRvcmVhZCA9IHRy\ndWU7CiAgICAgICAgaWYgKGJ5dGVidWZmLnJlbWFpbmluZygpID09IDApIHsK\nICAgICAgICAgICAgdG9yZWFkID0gcmVmaWxsKCk7CiAgICAgICAgfQogICAg\nICAgIGlmICh0b3JlYWQpIHsKICAgICAgICAgICAgaW50IGJjb3BpZWQgPSBi\neXRlYnVmZi5yZW1haW5pbmcoKTsKICAgICAgICAgICAgaW50IHRvY29weSA9\nIE1hdGgubWluKGJjb3BpZWQsIGIubGVuZ3RoKTsKICAgICAgICAgICAgLy8g\nY2Fubm90IHVzZWQgZ2V0cyBiZWNhdXNlIG9mCiAgICAgICAgICAgIC8vIHRo\nZSB1bmRlcmZsb3cvb3ZlcmZsb3cgZXhjZXB0aW9ucwogICAgICAgICAgICBT\neXN0ZW0uYXJyYXljb3B5KGJieXRlcywgYnl0ZWJ1ZmYucG9zaXRpb24oKSwg\nYiwgMCwgdG9jb3B5KTsKICAgICAgICAgICAgYnl0ZWJ1ZmYucG9zaXRpb24o\nYnl0ZWJ1ZmYucG9zaXRpb24oKSArIHRvY29weSk7CiAgICAgICAgICAgIHJl\ndHVybiB0b2NvcHk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAtMTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgaW50\nIHJlYWQoYnl0ZVtdIGIsIGludCBvZmYsIGludCBsZW4pIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgLy8gYWdhaW4gZG9udCBuZWVkIG90IGZ1bGx5\nCiAgICAgICAgLy8gZmlsbCBiLCBqdXN0IHJldHVybgogICAgICAgIC8vIHdo\nYXQgd2UgaGF2ZSBhbmQgbGV0IHRoZSBhcHBsaWNhdGlvbiBjYWxsIHJlYWQK\nICAgICAgICAvLyBhZ2FpbgogICAgICAgIGJvb2xlYW4gdG9yZWFkID0gdHJ1\nZTsKICAgICAgICBpZiAoYnl0ZWJ1ZmYucmVtYWluaW5nKCkgPT0gMCkgewog\nICAgICAgICAgICB0b3JlYWQgPSByZWZpbGwoKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKHRvcmVhZCkgewogICAgICAgICAgICBpbnQgYmNvcGllZCA9IGJ5\ndGVidWZmLnJlbWFpbmluZygpOwogICAgICAgICAgICBpbnQgdG9jb3B5ID0g\nTWF0aC5taW4oYmNvcGllZCwgbGVuKTsKICAgICAgICAgICAgU3lzdGVtLmFy\ncmF5Y29weShiYnl0ZXMsIGJ5dGVidWZmLnBvc2l0aW9uKCksIGIsIG9mZiwg\ndG9jb3B5KTsKICAgICAgICAgICAgYnl0ZWJ1ZmYucG9zaXRpb24oYnl0ZWJ1\nZmYucG9zaXRpb24oKSArIHRvY29weSk7CiAgICAgICAgICAgIHJldHVybiB0\nb2NvcHk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAtMTsKICAgIH0KfQo=\n","encoding":"base64"}

