{"sha":"05d390b61eb159e873f96097fc10bb7debf8d4d6","node_id":"MDQ6QmxvYjE1NzU5NTY6MDVkMzkwYjYxZWIxNTllODczZjk2MDk3ZmMxMGJiN2RlYmY4ZDRkNg==","size":4582,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/05d390b61eb159e873f96097fc10bb7debf8d4d6","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnN0cmVhbWluZzsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5pby5P\ndXRwdXRTdHJlYW07CmltcG9ydCBqYXZhLm5pby5CeXRlQnVmZmVyOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhh\nbmRsZTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiB0aGlzIGNsYXNzIHByb3ZpZGVz\nIGEgc3RyZWFtaW5nIGFwaSB0byBnZXQgYW4gb3V0cHV0IHN0cmVhbSBmcm9t\nIGEgbGVkZ2VyCiAqIGhhbmRsZSBhbmQgd3JpdGUgdG8gaXQgYXMgYSBzdHJl\nYW0gb2YgYnl0ZXMuIFRoaXMgaXMgYnVpbHQgb24gdG9wIG9mCiAqIGxlZGdl\ncmhhbmRsZSBhcGkgYW5kIHVzZXMgYSBidWZmZXIgdG8gY2FjaGUgdGhlIGRh\ndGEgd3JpdHRlbiB0byBpdCBhbmQgd3JpdGVzCiAqIG91dCB0aGUgZW50cnkg\ndG8gdGhlIGxlZGdlci4KICovCnB1YmxpYyBjbGFzcyBMZWRnZXJPdXRwdXRT\ndHJlYW0gZXh0ZW5kcyBPdXRwdXRTdHJlYW0gewogICAgcHJpdmF0ZSBmaW5h\nbCBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2Vy\nKExlZGdlck91dHB1dFN0cmVhbS5jbGFzcyk7CiAgICBwcml2YXRlIExlZGdl\nckhhbmRsZSBsaDsKICAgIHByaXZhdGUgQnl0ZUJ1ZmZlciBieXRlYnVmZjsK\nICAgIGJ5dGVbXSBiYnl0ZXM7CiAgICBpbnQgZGVmYXVsdFNpemUgPSAxMDI0\nICogMTAyNDsgLy8gMU1CIGRlZmF1bHQgc2l6ZQoKICAgIC8qKgogICAgICog\nY29uc3RydWN0IGEgb3V0cHV0c3RyZWFtIGZyb20gYSBsZWRnZXIgaGFuZGxl\nCiAgICAgKgogICAgICogQHBhcmFtIGxoCiAgICAgKiAgICAgICAgICAgIGxl\nZGdlciBoYW5kbGUKICAgICAqLwogICAgcHVibGljIExlZGdlck91dHB1dFN0\ncmVhbShMZWRnZXJIYW5kbGUgbGgpIHsKICAgICAgICB0aGlzLmxoID0gbGg7\nCiAgICAgICAgYmJ5dGVzID0gbmV3IGJ5dGVbZGVmYXVsdFNpemVdOwogICAg\nICAgIHRoaXMuYnl0ZWJ1ZmYgPSBCeXRlQnVmZmVyLndyYXAoYmJ5dGVzKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIGNvbnN0cnVjdCBhIG91dHB1dHN0cmVh\nbSBmcm9tIGEgbGVkZ2VyIGhhbmRsZQogICAgICoKICAgICAqIEBwYXJhbSBs\naAogICAgICogICAgICAgICAgICB0aGUgbGVkZ2VyIGhhbmRsZQogICAgICog\nQHBhcmFtIHNpemUKICAgICAqICAgICAgICAgICAgdGhlIHNpemUgb2YgdGhl\nIGJ1ZmZlcgogICAgICovCiAgICBwdWJsaWMgTGVkZ2VyT3V0cHV0U3RyZWFt\nKExlZGdlckhhbmRsZSBsaCwgaW50IHNpemUpIHsKICAgICAgICB0aGlzLmxo\nID0gbGg7CiAgICAgICAgYmJ5dGVzID0gbmV3IGJ5dGVbc2l6ZV07CiAgICAg\nICAgdGhpcy5ieXRlYnVmZiA9IEJ5dGVCdWZmZXIud3JhcChiYnl0ZXMpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7\nCiAgICAgICAgLy8gZmx1c2ggZXZlcnl0aGluZwogICAgICAgIC8vIHdlIGhh\ndmUKICAgICAgICBmbHVzaCgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHN5bmNocm9uaXplZCB2b2lkIGZsdXNoKCkgewogICAgICAgIC8v\nIGxldHMgZmx1c2ggYWxsIHRoZSBkYXRhCiAgICAgICAgLy8gaW50byB0aGUg\nbGVkZ2VyIGVudHJ5CiAgICAgICAgaWYgKGJ5dGVidWZmLnBvc2l0aW9uKCkg\nPiAwKSB7CiAgICAgICAgICAgIC8vIGNvcHkgdGhlIGJ5dGVzIGludG8KICAg\nICAgICAgICAgLy8gYSBuZXcgYnl0ZSBidWZmZXIgYW5kIHNlbmQgaXQgb3V0\nCiAgICAgICAgICAgIGJ5dGVbXSBiID0gbmV3IGJ5dGVbYnl0ZWJ1ZmYucG9z\naXRpb24oKV07CiAgICAgICAgICAgIExPRy5pbmZvKCJDb21tZW50OiBmbHVz\naGluZyB3aXRoIHBhcmFtcyAiICsgIiAiICsgYnl0ZWJ1ZmYucG9zaXRpb24o\nKSk7CiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkoYmJ5dGVzLCAwLCBi\nLCAwLCBieXRlYnVmZi5wb3NpdGlvbigpKTsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KGIpOwogICAgICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAg\nICAgICAgTE9HLndhcm4oIkludGVycnVwdGVkIHdoaWxlIGZsdXNpbmcgIiAr\nIGllKTsKICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCku\naW50ZXJydXB0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9u\nIGJrZSkgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIkJvb2tLZWVwZXIg\nZXhjZXB0aW9uICIsIGJrZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBtYWtlIHNwYWNlIGZvciBsZW4gYnl0ZXMg\ndG8gYmUgd3JpdHRlbiB0byB0aGUgYnVmZmVyLgogICAgICoKICAgICAqIEBw\nYXJhbSBsZW4KICAgICAqIEByZXR1cm4gaWYgdHJ1ZSB0aGVuIHdlIGNhbiBt\nYWtlIHNwYWNlIGZvciBsZW4gaWYgZmFsc2Ugd2UgY2Fubm90CiAgICAgKi8K\nICAgIHByaXZhdGUgYm9vbGVhbiBtYWtlU3BhY2UoaW50IGxlbikgewogICAg\nICAgIGlmIChieXRlYnVmZi5yZW1haW5pbmcoKSA8IGxlbikgewogICAgICAg\nICAgICBmbHVzaCgpOwogICAgICAgICAgICBieXRlYnVmZi5jbGVhcigpOwog\nICAgICAgICAgICBpZiAoYnl0ZWJ1ZmYuY2FwYWNpdHkoKSA8IGxlbikgewog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lkIHdyaXRlKGJ5dGVb\nXSBiKSB7CiAgICAgICAgaWYgKG1ha2VTcGFjZShiLmxlbmd0aCkpIHsKICAg\nICAgICAgICAgYnl0ZWJ1ZmYucHV0KGIpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsaC5hZGRFbnRyeShi\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24g\naWUpIHsKICAgICAgICAgICAgICAgIExPRy53YXJuKCJJbnRlcnJ1cHRlZCB3\naGlsZSB3cml0aW5nIiwgaWUpOwogICAgICAgICAgICAgICAgVGhyZWFkLmN1\ncnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgfSBjYXRj\naCAoQktFeGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgICAgICBMT0cud2Fy\nbigiQm9va0tlZXBlciBleGNlcHRpb24iLCBia2UpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHN5\nbmNocm9uaXplZCB2b2lkIHdyaXRlKGJ5dGVbXSBiLCBpbnQgb2ZmLCBpbnQg\nbGVuKSB7CiAgICAgICAgaWYgKCFtYWtlU3BhY2UobGVuKSkgewogICAgICAg\nICAgICAvLyBsZXRzIHRyeSBtYWtpbmcgdGhlIGJ1ZmZlciBiaWdnZXIKICAg\nICAgICAgICAgYmJ5dGVzID0gbmV3IGJ5dGVbbGVuXTsKICAgICAgICAgICAg\nYnl0ZWJ1ZmYgPSBCeXRlQnVmZmVyLndyYXAoYmJ5dGVzKTsKICAgICAgICB9\nCiAgICAgICAgYnl0ZWJ1ZmYucHV0KGIsIG9mZiwgbGVuKTsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCB3cml0\nZShpbnQgYikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBtYWtlU3Bh\nY2UoMSk7CiAgICAgICAgYnl0ZSBvbmVCID0gKGJ5dGUpIChiICYgMHhGRik7\nCiAgICAgICAgYnl0ZWJ1ZmYucHV0KG9uZUIpOwogICAgfQp9Cg==\n","encoding":"base64"}

