{"sha":"75902c9e8c93f874b589357e94d7d98e7c9e7310","node_id":"MDQ6QmxvYjE1NzU5NTY6NzU5MDJjOWU4YzkzZjg3NGI1ODkzNTdlOTRkN2Q5OGU3YzllNzMxMA==","size":7876,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/75902c9e8c93f874b589357e94d7d98e7c9e7310","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWw7CgppbXBvcnQgamF2\nYS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKCmltcG9y\ndCBjb20uZ29vZ2xlLmNvbW1vbi5hbm5vdGF0aW9ucy5WaXNpYmxlRm9yVGVz\ndGluZzsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBDbGFzcyB0aGF0IHByb3ZpZGVz\nIHV0aWxpdHkgZnVuY3Rpb25zIGZvciBjaGVja2luZyBkaXNrIHByb2JsZW1z\nCiAqLwpwdWJsaWMgY2xhc3MgRGlza0NoZWNrZXIgewoKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihEaXNrQ2hlY2tlci5jbGFzcyk7CgogICAgcHJpdmF0ZSBmbG9hdCBk\naXNrVXNhZ2VUaHJlc2hvbGQ7CiAgICBwcml2YXRlIGZsb2F0IGRpc2tVc2Fn\nZVdhcm5UaHJlc2hvbGQ7CgogICAgcHVibGljIGFic3RyYWN0IHN0YXRpYyBj\nbGFzcyBEaXNrRXhjZXB0aW9uIGV4dGVuZHMgSU9FeGNlcHRpb24gewogICAg\nICAgIHB1YmxpYyBEaXNrRXhjZXB0aW9uKFN0cmluZyBtc2cpIHsKICAgICAg\nICAgICAgc3VwZXIobXNnKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGlj\nIHN0YXRpYyBjbGFzcyBEaXNrRXJyb3JFeGNlcHRpb24gZXh0ZW5kcyBEaXNr\nRXhjZXB0aW9uIHsKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25n\nIHNlcmlhbFZlcnNpb25VSUQgPSA5MDkxNjA2MDIyNDQ5NzYxNzI5TDsKCiAg\nICAgICAgcHVibGljIERpc2tFcnJvckV4Y2VwdGlvbihTdHJpbmcgbXNnKSB7\nCiAgICAgICAgICAgIHN1cGVyKG1zZyk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyBzdGF0aWMgY2xhc3MgRGlza091dE9mU3BhY2VFeGNlcHRpb24g\nZXh0ZW5kcyBEaXNrRXhjZXB0aW9uIHsKICAgICAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBsb25nIHNlcmlhbFZlcnNpb25VSUQgPSAxNjA4OTg3OTc5MTU5\nMDY4NjBMOwoKICAgICAgICBwcml2YXRlIGZpbmFsIGZsb2F0IHVzYWdlOwoK\nICAgICAgICBwdWJsaWMgRGlza091dE9mU3BhY2VFeGNlcHRpb24oU3RyaW5n\nIG1zZywgZmxvYXQgdXNhZ2UpIHsKICAgICAgICAgICAgc3VwZXIobXNnKTsK\nICAgICAgICAgICAgdGhpcy51c2FnZSA9IHVzYWdlOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIGZsb2F0IGdldFVzYWdlKCkgewogICAgICAgICAgICBy\nZXR1cm4gdXNhZ2U7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0\naWMgY2xhc3MgRGlza1dhcm5UaHJlc2hvbGRFeGNlcHRpb24gZXh0ZW5kcyBE\naXNrRXhjZXB0aW9uIHsKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBs\nb25nIHNlcmlhbFZlcnNpb25VSUQgPSAtMTYyOTI4NDk4NzUwMDg0MTY1N0w7\nCgogICAgICAgIHByaXZhdGUgZmluYWwgZmxvYXQgdXNhZ2U7CgogICAgICAg\nIHB1YmxpYyBEaXNrV2FyblRocmVzaG9sZEV4Y2VwdGlvbihTdHJpbmcgbXNn\nLCBmbG9hdCB1c2FnZSkgewogICAgICAgICAgICBzdXBlcihtc2cpOwogICAg\nICAgICAgICB0aGlzLnVzYWdlID0gdXNhZ2U7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgZmxvYXQgZ2V0VXNhZ2UoKSB7CiAgICAgICAgICAgIHJldHVy\nbiB1c2FnZTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIERpc2tDaGVj\na2VyKGZsb2F0IHRocmVzaG9sZCwgZmxvYXQgd2FyblRocmVzaG9sZCkgewog\nICAgICAgIHZhbGlkYXRlVGhyZXNob2xkKHRocmVzaG9sZCwgd2FyblRocmVz\naG9sZCk7CiAgICAgICAgdGhpcy5kaXNrVXNhZ2VUaHJlc2hvbGQgPSB0aHJl\nc2hvbGQ7CiAgICAgICAgdGhpcy5kaXNrVXNhZ2VXYXJuVGhyZXNob2xkID0g\nd2FyblRocmVzaG9sZDsKICAgIH0KCiAgICAvKioKICAgICAqIFRoZSBzZW1h\nbnRpY3Mgb2YgbWtkaXJzV2l0aEV4aXN0c0NoZWNrIG1ldGhvZCBpcyBkaWZm\nZXJlbnQgZnJvbSB0aGUKICAgICAqIG1rZGlycyBtZXRob2QgcHJvdmlkZWQg\naW4gdGhlIFN1bidzIGphdmEuaW8uRmlsZSBjbGFzcyBpbiB0aGUgZm9sbG93\naW5nCiAgICAgKiB3YXk6IFdoaWxlIGNyZWF0aW5nIHRoZSBub24tZXhpc3Rl\nbnQgcGFyZW50IGRpcmVjdG9yaWVzLCB0aGlzIG1ldGhvZAogICAgICogY2hl\nY2tzIGZvciB0aGUgZXhpc3RlbmNlIG9mIHRob3NlIGRpcmVjdG9yaWVzIGlm\nIHRoZSBta2RpciBmYWlscyBhdCBhbnkKICAgICAqIHBvaW50IChzaW5jZSB0\naGF0IGRpcmVjdG9yeSBtaWdodCBoYXZlIGp1c3QgYmVlbiBjcmVhdGVkIGJ5\nIHNvbWUgb3RoZXIKICAgICAqIHByb2Nlc3MpLiBJZiBib3RoIG1rZGlyKCkg\nYW5kIHRoZSBleGlzdHMoKSBjaGVjayBmYWlscyBmb3IgYW55IHNlZW1pbmds\neQogICAgICogbm9uLWV4aXN0ZW50IGRpcmVjdG9yeSwgdGhlbiB3ZSBzaWdu\nYWwgYW4gZXJyb3I7IFN1bidzIG1rZGlyIHdvdWxkIHNpZ25hbAogICAgICog\nYW4gZXJyb3IgKHJldHVybiBmYWxzZSkgaWYgYSBkaXJlY3RvcnkgaXQgaXMg\nYXR0ZW1wdGluZyB0byBjcmVhdGUgYWxyZWFkeQogICAgICogZXhpc3RzIG9y\nIHRoZSBta2RpciBmYWlscy4KICAgICAqCiAgICAgKiBAcGFyYW0gZGlyCiAg\nICAgKiBAcmV0dXJuIHRydWUgb24gc3VjY2VzcywgZmFsc2Ugb24gZmFpbHVy\nZQogICAgICovCiAgICBwcml2YXRlIHN0YXRpYyBib29sZWFuIG1rZGlyc1dp\ndGhFeGlzdHNDaGVjayhGaWxlIGRpcikgewogICAgICAgIGlmIChkaXIubWtk\naXIoKSB8fCBkaXIuZXhpc3RzKCkpIHsKICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgfQogICAgICAgIEZpbGUgY2Fub25EaXIgPSBudWxsOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNhbm9uRGlyID0gZGlyLmdldENh\nbm9uaWNhbEZpbGUoKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAg\nICAgU3RyaW5nIHBhcmVudCA9IGNhbm9uRGlyLmdldFBhcmVudCgpOwogICAg\nICAgIHJldHVybiAocGFyZW50ICE9IG51bGwpCiAgICAgICAgICAgICAgICAm\nJiAobWtkaXJzV2l0aEV4aXN0c0NoZWNrKG5ldyBGaWxlKHBhcmVudCkpICYm\nIChjYW5vbkRpcgogICAgICAgICAgICAgICAgICAgICAgICAubWtkaXIoKSB8\nfCBjYW5vbkRpci5leGlzdHMoKSkpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ2hlY2tzIHRoZSBkaXNrIHNwYWNlIGF2YWlsYWJsZS4KICAgICAqCiAgICAg\nKiBAcGFyYW0gZGlyCiAgICAgKiAgICAgICAgICAgIERpcmVjdG9yeSB0byBj\naGVjayBmb3IgdGhlIGRpc2sgc3BhY2UKICAgICAqIEB0aHJvd3MgRGlza091\ndE9mU3BhY2VFeGNlcHRpb24KICAgICAqICAgICAgICAgICAgIFRocm93cyB7\nQGxpbmsgRGlza091dE9mU3BhY2VFeGNlcHRpb259IGlmIGF2YWlsYWJsZSBz\ncGFjZSBpcwogICAgICogICAgICAgICAgICAgbGVzcyB0aGFuIHRocmVzaGhv\nbGQuCiAgICAgKi8KICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgZmxvYXQg\nY2hlY2tEaXNrRnVsbChGaWxlIGRpcikgdGhyb3dzIERpc2tPdXRPZlNwYWNl\nRXhjZXB0aW9uLCBEaXNrV2FyblRocmVzaG9sZEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKG51bGwgPT0gZGlyKSB7CiAgICAgICAgICAgIHJldHVybiAwZjsK\nICAgICAgICB9CiAgICAgICAgaWYgKGRpci5leGlzdHMoKSkgewogICAgICAg\nICAgICBsb25nIHVzYWJsZVNwYWNlID0gZGlyLmdldFVzYWJsZVNwYWNlKCk7\nCiAgICAgICAgICAgIGxvbmcgdG90YWxTcGFjZSA9IGRpci5nZXRUb3RhbFNw\nYWNlKCk7CiAgICAgICAgICAgIGZsb2F0IGZyZWUgPSAoZmxvYXQpIHVzYWJs\nZVNwYWNlIC8gKGZsb2F0KSB0b3RhbFNwYWNlOwogICAgICAgICAgICBmbG9h\ndCB1c2VkID0gMWYgLSBmcmVlOwogICAgICAgICAgICBpZiAodXNlZCA+IGRp\nc2tVc2FnZVRocmVzaG9sZCkgewogICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJTcGFjZSBsZWZ0IG9uIGRldmljZSB7fSA6IHt9LCBVc2VkIHNwYWNlIGZy\nYWN0aW9uOiB7fSA8IHRocmVzaG9sZCB7fS4iLAogICAgICAgICAgICAgICAg\nICAgICAgICBuZXcgT2JqZWN0W10geyBkaXIsIHVzYWJsZVNwYWNlLCB1c2Vk\nLCBkaXNrVXNhZ2VUaHJlc2hvbGQgfSk7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgRGlza091dE9mU3BhY2VFeGNlcHRpb24oIlNwYWNlIGxlZnQgb24g\nZGV2aWNlICIKICAgICAgICAgICAgICAgICAgICAgICAgKyB1c2FibGVTcGFj\nZSArICIgVXNlZCBzcGFjZSBmcmFjdGlvbjoiICsgdXNlZCArICIgPCB0aHJl\nc2hvbGQgIiArIGRpc2tVc2FnZVRocmVzaG9sZCwgdXNlZCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gV2FybiBzaG91bGQgYmUgdHJpZ2dlcmVk\nIG9ubHkgaWYgZGlzayB1c2FnZSB0aHJlc2hvbGQgZG9lc24ndCB0cmlnZ2Vy\nIGZpcnN0LgogICAgICAgICAgICBpZiAodXNlZCA+IGRpc2tVc2FnZVdhcm5U\naHJlc2hvbGQpIHsKICAgICAgICAgICAgICAgIExPRy53YXJuKCJTcGFjZSBs\nZWZ0IG9uIGRldmljZSB7fSA6IHt9LCBVc2VkIHNwYWNlIGZyYWN0aW9uOiB7\nfSA8IFdhcm5UaHJlc2hvbGQge30uIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IE9iamVjdFtdIHsgZGlyLCB1c2FibGVTcGFjZSwgdXNlZCwgZGlz\na1VzYWdlVGhyZXNob2xkIH0pOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIERpc2tXYXJuVGhyZXNob2xkRXhjZXB0aW9uKCJTcGFjZSBsZWZ0IG9uIGRl\ndmljZToiCiAgICAgICAgICAgICAgICAgICAgICAgICsgdXNhYmxlU3BhY2Ug\nKyAiIFVzZWQgc3BhY2UgZnJhY3Rpb246IiArIHVzZWQgKyIgPCBXYXJuVGhy\nZXNob2xkOiIgKyBkaXNrVXNhZ2VXYXJuVGhyZXNob2xkLAogICAgICAgICAg\nICAgICAgICAgICAgICB1c2VkKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gdXNlZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBy\nZXR1cm4gY2hlY2tEaXNrRnVsbChkaXIuZ2V0UGFyZW50RmlsZSgpKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBDcmVhdGUgdGhlIGRpcmVj\ndG9yeSBpZiBpdCBkb2Vzbid0IGV4aXN0IGFuZAogICAgICoKICAgICAqIEBw\nYXJhbSBkaXIKICAgICAqICAgICAgICAgICAgRGlyZWN0b3J5IHRvIGNoZWNr\nIGZvciB0aGUgZGlzayBlcnJvci9mdWxsLgogICAgICogQHRocm93cyBEaXNr\nRXJyb3JFeGNlcHRpb24KICAgICAqICAgICAgICAgICAgIElmIGRpc2sgaGF2\naW5nIGVycm9ycwogICAgICogQHRocm93cyBEaXNrV2FyblRocmVzaG9sZEV4\nY2VwdGlvbgogICAgICogICAgICAgICAgICAgSWYgZGlzayBoYXMgbGVzcyB0\naGFuIGNvbmZpZ3VyZWQgYW1vdW50IG9mIGZyZWUgc3BhY2UuCiAgICAgKiBA\ndGhyb3dzIERpc2tPdXRPZlNwYWNlRXhjZXB0aW9uCiAgICAgKiAgICAgICAg\nICAgICBJZiBkaXNrIGlzIGZ1bGwgb3IgaGF2aW5nIGxlc3Mgc3BhY2UgdGhh\nbiB0aHJlc2hob2xkCiAgICAgKi8KICAgIHB1YmxpYyBmbG9hdCBjaGVja0Rp\ncihGaWxlIGRpcikgdGhyb3dzIERpc2tFcnJvckV4Y2VwdGlvbiwKICAgICAg\nICAgICAgRGlza091dE9mU3BhY2VFeGNlcHRpb24sIERpc2tXYXJuVGhyZXNo\nb2xkRXhjZXB0aW9uIHsKICAgICAgICBmbG9hdCB1c2FnZSA9IGNoZWNrRGlz\na0Z1bGwoZGlyKTsKICAgICAgICBpZiAoIW1rZGlyc1dpdGhFeGlzdHNDaGVj\nayhkaXIpKQogICAgICAgICAgICB0aHJvdyBuZXcgRGlza0Vycm9yRXhjZXB0\naW9uKCJjYW4gbm90IGNyZWF0ZSBkaXJlY3Rvcnk6ICIKICAgICAgICAgICAg\nICAgICAgICArIGRpci50b1N0cmluZygpKTsKCiAgICAgICAgaWYgKCFkaXIu\naXNEaXJlY3RvcnkoKSkKICAgICAgICAgICAgdGhyb3cgbmV3IERpc2tFcnJv\nckV4Y2VwdGlvbigibm90IGEgZGlyZWN0b3J5OiAiICsgZGlyLnRvU3RyaW5n\nKCkpOwoKICAgICAgICBpZiAoIWRpci5jYW5SZWFkKCkpCiAgICAgICAgICAg\nIHRocm93IG5ldyBEaXNrRXJyb3JFeGNlcHRpb24oImRpcmVjdG9yeSBpcyBu\nb3QgcmVhZGFibGU6ICIKICAgICAgICAgICAgICAgICAgICArIGRpci50b1N0\ncmluZygpKTsKCiAgICAgICAgaWYgKCFkaXIuY2FuV3JpdGUoKSkKICAgICAg\nICAgICAgdGhyb3cgbmV3IERpc2tFcnJvckV4Y2VwdGlvbigiZGlyZWN0b3J5\nIGlzIG5vdCB3cml0YWJsZTogIgogICAgICAgICAgICAgICAgICAgICsgZGly\nLnRvU3RyaW5nKCkpOwogICAgICAgIHJldHVybiB1c2FnZTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFNldCB0aGUgZGlzayBzcGFjZSB0aHJlc2hvbGQKICAg\nICAqCiAgICAgKiBAcGFyYW0gZGlza1NwYWNlVGhyZXNob2xkCiAgICAgKi8K\nICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgdm9pZCBzZXREaXNrU3BhY2VU\naHJlc2hvbGQoZmxvYXQgZGlza1NwYWNlVGhyZXNob2xkLCBmbG9hdCBkaXNr\nVXNhZ2VXYXJuVGhyZXNob2xkKSB7CiAgICAgICAgdmFsaWRhdGVUaHJlc2hv\nbGQoZGlza1NwYWNlVGhyZXNob2xkLCBkaXNrU3BhY2VUaHJlc2hvbGQpOwog\nICAgICAgIHRoaXMuZGlza1VzYWdlVGhyZXNob2xkID0gZGlza1NwYWNlVGhy\nZXNob2xkOwogICAgICAgIHRoaXMuZGlza1VzYWdlV2FyblRocmVzaG9sZCA9\nIGRpc2tVc2FnZVdhcm5UaHJlc2hvbGQ7CiAgICB9CgogICAgcHJpdmF0ZSB2\nb2lkIHZhbGlkYXRlVGhyZXNob2xkKGZsb2F0IGRpc2tTcGFjZVRocmVzaG9s\nZCwgZmxvYXQgZGlza1NwYWNlV2FyblRocmVzaG9sZCkgewogICAgICAgIGlm\nIChkaXNrU3BhY2VUaHJlc2hvbGQgPD0gMCB8fCBkaXNrU3BhY2VUaHJlc2hv\nbGQgPj0gMSB8fCBkaXNrU3BhY2VXYXJuVGhyZXNob2xkIC0gZGlza1NwYWNl\nVGhyZXNob2xkID4gMWUtNikgewogICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJEaXNrIHNwYWNlIHRocmVhc2hvbGQ6\nICIKICAgICAgICAgICAgICAgICAgICArIGRpc2tTcGFjZVRocmVzaG9sZCAr\nICIgYW5kIHdhcm4gdGhyZXNob2xkOiAiICsgZGlza1NwYWNlV2FyblRocmVz\naG9sZAogICAgICAgICAgICAgICAgICAgICsgIiBhcmUgbm90IHZhbGlkLiBT\naG91bGQgYmUgPiAwIGFuZCA8IDEgYW5kIGRpc2tTcGFjZVRocmVzaG9sZCA+\nPSBkaXNrU3BhY2VXYXJuVGhyZXNob2xkIik7CiAgICAgICAgfQogICAgfQp9\nCg==\n","encoding":"base64"}

