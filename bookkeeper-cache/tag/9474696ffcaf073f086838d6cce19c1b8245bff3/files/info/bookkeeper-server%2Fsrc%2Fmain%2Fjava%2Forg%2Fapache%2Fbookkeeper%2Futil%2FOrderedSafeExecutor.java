{"sha":"597c88662b8e799ab4f2379f84d1a4dd62840a5d","node_id":"MDQ6QmxvYjE1NzU5NTY6NTk3Yzg4NjYyYjhlNzk5YWI0ZjIzNzlmODRkMWE0ZGQ2Mjg0MGE1ZA==","size":7324,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/597c88662b8e799ab4f2379f84d1a4dd62840a5d","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbDsKCmltcG9ydCBjb20u\nZ29vZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuVGhyZWFkRmFjdG9yeUJ1\naWxkZXI7CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuRXhlY3V0aW9uRXhjZXB0aW9uOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JTZXJ2aWNlOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JzOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuUmVqZWN0ZWRFeGVjdXRpb25FeGNlcHRpb247CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZp\nY2U7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlcklu\ndGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuY29tbW9ucy5sYW5nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLnNs\nZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoK\nLyoqCiAqIFRoaXMgY2xhc3MgcHJvdmlkZXMgMiB0aGluZ3Mgb3ZlciB0aGUg\namF2YSB7QGxpbmsgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlfS4KICoKICog\nMS4gSXQgdGFrZXMge0BsaW5rIFNhZmVSdW5uYWJsZSBvYmplY3RzfSBpbnN0\nZWFkIG9mIHBsYWluIFJ1bm5hYmxlIG9iamVjdHMuCiAqIFRoaXMgbWVhbnMg\ndGhhdCBleGNlcHRpb25zIGluIHNjaGVkdWxlZCB0YXNrcyB3b250IGdvIHVu\nbm90aWNlZCBhbmQgd2lsbCBiZQogKiBsb2dnZWQuCiAqCiAqIDIuIEl0IHN1\ncHBvcnRzIHN1Ym1pdHRpbmcgdGFza3Mgd2l0aCBhbiBvcmRlcmluZyBrZXks\nIHNvIHRoYXQgdGFza3Mgc3VibWl0dGVkCiAqIHdpdGggdGhlIHNhbWUga2V5\nIHdpbGwgYWx3YXlzIGJlIGV4ZWN1dGVkIGluIG9yZGVyLCBidXQgdGFza3Mg\nYWNyb3NzCiAqIGRpZmZlcmVudCBrZXlzIGNhbiBiZSB1bm9yZGVyZWQuIFRo\naXMgcmV0YWlucyBwYXJhbGxlbGlzbSB3aGlsZSByZXRhaW5pbmcgdGhlCiAq\nIGJhc2ljIGFtb3VudCBvZiBvcmRlcmluZyB3ZSB3YW50IChlLmcuICwgcGVy\nIGxlZGdlciBoYW5kbGUpLiBPcmRlcmluZyBpcwogKiBhY2hpZXZlZCBieSBo\nYXNoaW5nIHRoZSBrZXkgb2JqZWN0cyB0byB0aHJlYWRzIGJ5IHRoZWlyIHtA\nbGluayAjaGFzaENvZGUoKX0KICogbWV0aG9kLgogKgogKi8KcHVibGljIGNs\nYXNzIE9yZGVyZWRTYWZlRXhlY3V0b3IgewogICAgZmluYWwgRXhlY3V0b3JT\nZXJ2aWNlIHRocmVhZHNbXTsKICAgIGZpbmFsIGxvbmcgdGhyZWFkSWRzW107\nCiAgICBmaW5hbCBSYW5kb20gcmFuZCA9IG5ldyBSYW5kb20oKTsKCiAgICAv\nKioKICAgICAqIENvbnN0cnVjdHMgU2FmZSBleGVjdXRvcgogICAgICoKICAg\nICAqIEBwYXJhbSBudW1UaHJlYWRzCiAgICAgKiAgICAgICAgICAgIC0gbnVt\nYmVyIG9mIHRocmVhZHMKICAgICAqIEBwYXJhbSB0aHJlYWROYW1lCiAgICAg\nKiAgICAgICAgICAgIC0gbmFtZSBvZiB0aGUgdGhyZWFkCiAgICAgKi8KICAg\nIHB1YmxpYyBPcmRlcmVkU2FmZUV4ZWN1dG9yKGludCBudW1UaHJlYWRzLCBT\ndHJpbmcgdGhyZWFkTmFtZSkgewogICAgICAgIGlmIChudW1UaHJlYWRzIDw9\nIDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4\nY2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICBpZiAoU3RyaW5nVXRpbHMu\naXNCbGFuayh0aHJlYWROYW1lKSkgewogICAgICAgICAgICAvLyBzZXRzIGRl\nZmF1bHQgbmFtZQogICAgICAgICAgICB0aHJlYWROYW1lID0gIk9yZGVyZWRT\nYWZlRXhlY3V0b3IiOwogICAgICAgIH0KICAgICAgICB0aHJlYWRzID0gbmV3\nIEV4ZWN1dG9yU2VydmljZVtudW1UaHJlYWRzXTsKICAgICAgICB0aHJlYWRJ\nZHMgPSBuZXcgbG9uZ1tudW1UaHJlYWRzXTsKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IG51bVRocmVhZHM7IGkrKykgewogICAgICAgICAgICBTdHJp\nbmdCdWlsZGVyIHRoTmFtZSA9IG5ldyBTdHJpbmdCdWlsZGVyKHRocmVhZE5h\nbWUpOwogICAgICAgICAgICB0aE5hbWUuYXBwZW5kKCItIik7CiAgICAgICAg\nICAgIHRoTmFtZS5hcHBlbmQoaSk7CiAgICAgICAgICAgIHRoTmFtZS5hcHBl\nbmQoIi0lZCIpOwogICAgICAgICAgICBUaHJlYWRGYWN0b3J5QnVpbGRlciB0\nZmIgPSBuZXcgVGhyZWFkRmFjdG9yeUJ1aWxkZXIoKQogICAgICAgICAgICAg\nICAgICAgIC5zZXROYW1lRm9ybWF0KHRoTmFtZS50b1N0cmluZygpKTsKICAg\nICAgICAgICAgdGhyZWFkc1tpXSA9IEV4ZWN1dG9ycy5uZXdTaW5nbGVUaHJl\nYWRFeGVjdXRvcih0ZmIuYnVpbGQoKSk7CiAgICAgICAgICAgIGZpbmFsIGlu\ndCB0aWQgPSBpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\ndGhyZWFkc1tpXS5zdWJtaXQobmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzYWZlUnVuKCkgewogICAgICAgICAgICAgICAgICAgICAg\nICB0aHJlYWRJZHNbdGlkXSA9IFRocmVhZC5jdXJyZW50VGhyZWFkKCkuZ2V0\nSWQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nKS5nZXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVF\neGNlcHRpb24oIkNvdWxkbid0IHN0YXJ0IHRocmVhZCAiICsgaSwgZSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEV4ZWN1dGlvbkV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgUnVudGltZUV4Y2VwdGlvbigiQ291\nbGRuJ3Qgc3RhcnQgdGhyZWFkICIgKyBpLCBlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICBFeGVjdXRvclNlcnZpY2UgY2hvb3NlVGhy\nZWFkKCkgewogICAgICAgIC8vIHNraXAgcmFuZG9tICMgZ2VuZXJhdGlvbiBp\nbiB0aGlzIHNwZWNpYWwgY2FzZQogICAgICAgIGlmICh0aHJlYWRzLmxlbmd0\naCA9PSAxKSB7CiAgICAgICAgICAgIHJldHVybiB0aHJlYWRzWzBdOwogICAg\nICAgIH0KCiAgICAgICAgcmV0dXJuIHRocmVhZHNbcmFuZC5uZXh0SW50KHRo\ncmVhZHMubGVuZ3RoKV07CgogICAgfQoKICAgIEV4ZWN1dG9yU2VydmljZSBj\naG9vc2VUaHJlYWQoT2JqZWN0IG9yZGVyaW5nS2V5KSB7CiAgICAgICAgLy8g\nc2tpcCBoYXNoY29kZSBnZW5lcmF0aW9uIGluIHRoaXMgc3BlY2lhbCBjYXNl\nCiAgICAgICAgaWYgKHRocmVhZHMubGVuZ3RoID09IDEpIHsKICAgICAgICAg\nICAgcmV0dXJuIHRocmVhZHNbMF07CiAgICAgICAgfQoKICAgICAgICByZXR1\ncm4gdGhyZWFkc1tNYXRoVXRpbHMuc2lnblNhZmVNb2Qob3JkZXJpbmdLZXku\naGFzaENvZGUoKSwgdGhyZWFkcy5sZW5ndGgpXTsKCiAgICB9CgogICAgLyoq\nCiAgICAgKiBzY2hlZHVsZXMgYSBvbmUgdGltZSBhY3Rpb24gdG8gZXhlY3V0\nZQogICAgICovCiAgICBwdWJsaWMgdm9pZCBzdWJtaXQoU2FmZVJ1bm5hYmxl\nIHIpIHsKICAgICAgICBjaG9vc2VUaHJlYWQoKS5zdWJtaXQocik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBzY2hlZHVsZXMgYSBvbmUgdGltZSBhY3Rpb24g\ndG8gZXhlY3V0ZSB3aXRoIGFuIG9yZGVyaW5nIGd1YXJhbnRlZSBvbiB0aGUg\na2V5CiAgICAgKiBAcGFyYW0gb3JkZXJpbmdLZXkKICAgICAqIEBwYXJhbSBy\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN1Ym1pdE9yZGVyZWQoT2JqZWN0\nIG9yZGVyaW5nS2V5LCBTYWZlUnVubmFibGUgcikgewogICAgICAgIGNob29z\nZVRocmVhZChvcmRlcmluZ0tleSkuc3VibWl0KHIpOwogICAgfQoKICAgIHBy\naXZhdGUgbG9uZyBnZXRUaHJlYWRJRChPYmplY3Qgb3JkZXJpbmdLZXkpIHsK\nICAgICAgICAvLyBza2lwIGhhc2hjb2RlIGdlbmVyYXRpb24gaW4gdGhpcyBz\ncGVjaWFsIGNhc2UKICAgICAgICBpZiAodGhyZWFkSWRzLmxlbmd0aCA9PSAx\nKSB7CiAgICAgICAgICAgIHJldHVybiB0aHJlYWRJZHNbMF07CiAgICAgICAg\nfQoKICAgICAgICByZXR1cm4gdGhyZWFkSWRzW01hdGhVdGlscy5zaWduU2Fm\nZU1vZChvcmRlcmluZ0tleS5oYXNoQ29kZSgpLCB0aHJlYWRJZHMubGVuZ3Ro\nKV07CiAgICB9CgogICAgcHVibGljIHZvaWQgc2h1dGRvd24oKSB7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCB0aHJlYWRzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIHRocmVhZHNbaV0uc2h1dGRvd24oKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gYXdhaXRUZXJtaW5hdGlvbihs\nb25nIHRpbWVvdXQsIFRpbWVVbml0IHVuaXQpIHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiByZXQgPSB0cnVlOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgdGhyZWFkcy5sZW5ndGg7IGkrKykg\newogICAgICAgICAgICByZXQgPSByZXQgJiYgdGhyZWFkc1tpXS5hd2FpdFRl\ncm1pbmF0aW9uKHRpbWVvdXQsIHVuaXQpOwogICAgICAgIH0KICAgICAgICBy\nZXR1cm4gcmV0OwogICAgfQoKICAgIC8qKgogICAgICogR2VuZXJpYyBjYWxs\nYmFjayBpbXBsZW1lbnRhdGlvbiB3aGljaCB3aWxsIHJ1biB0aGUKICAgICAq\nIGNhbGxiYWNrIGluIHRoZSB0aHJlYWQgd2hpY2ggbWF0Y2hlcyB0aGUgb3Jk\nZXJpbmcga2V5CiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgYWJzdHJhY3Qg\nY2xhc3MgT3JkZXJlZFNhZmVHZW5lcmljQ2FsbGJhY2s8VD4KICAgICAgICAg\nICAgaW1wbGVtZW50cyBHZW5lcmljQ2FsbGJhY2s8VD4gewogICAgICAgIHBy\naXZhdGUgZmluYWwgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9n\nZ2VyKE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrLmNsYXNzKTsKCiAgICAg\nICAgcHJpdmF0ZSBmaW5hbCBPcmRlcmVkU2FmZUV4ZWN1dG9yIGV4ZWN1dG9y\nOwogICAgICAgIHByaXZhdGUgZmluYWwgT2JqZWN0IG9yZGVyaW5nS2V5OwoK\nICAgICAgICAvKioKICAgICAgICAgKiBAcGFyYW0gZXhlY3V0b3IgVGhlIGV4\nZWN1dG9yIG9uIHdoaWNoIHRvIHJ1biB0aGUgY2FsbGJhY2sKICAgICAgICAg\nKiBAcGFyYW0gb3JkZXJpbmdLZXkgS2V5IHVzZWQgdG8gZGVjaWRlIHdoaWNo\nIHRocmVhZCB0aGUgY2FsbGJhY2sKICAgICAgICAgKiAgICAgICAgICAgICAg\nICAgICAgc2hvdWxkIHJ1biBvbi4KICAgICAgICAgKi8KICAgICAgICBwdWJs\naWMgT3JkZXJlZFNhZmVHZW5lcmljQ2FsbGJhY2soT3JkZXJlZFNhZmVFeGVj\ndXRvciBleGVjdXRvciwgT2JqZWN0IG9yZGVyaW5nS2V5KSB7CiAgICAgICAg\nICAgIHRoaXMuZXhlY3V0b3IgPSBleGVjdXRvcjsKICAgICAgICAgICAgdGhp\ncy5vcmRlcmluZ0tleSA9IG9yZGVyaW5nS2V5OwogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGZpbmFsIHZvaWQgb3BlcmF0\naW9uQ29tcGxldGUoZmluYWwgaW50IHJjLCBmaW5hbCBUIHJlc3VsdCkgewog\nICAgICAgICAgICAvLyBkdXJpbmcgY2xvc2luZywgY2FsbGJhY2tzIHRoYXQg\nYXJlIGVycm9yIG91dCBtaWdodCB0cnkgdG8gc3VibWl0IHRvCiAgICAgICAg\nICAgIC8vIHRoZSBzY2hlZHVsZXIgYWdhaW4uIGlmIHRoZSBzdWJtaXNzaW9u\nIHdpbGwgZ28gdG8gc2FtZSB0aHJlYWQsIHdlCiAgICAgICAgICAgIC8vIGRv\nbid0IG5lZWQgdG8gc3VibWl0IHRvIGV4ZWN1dG9yIGFnYWluLiB0aGlzIGlz\nIGFsc28gYW4gb3B0aW1pemF0aW9uIGZvcgogICAgICAgICAgICAvLyBjYWxs\nYmFjayBzdWJtaXNzaW9uCiAgICAgICAgICAgIGlmIChUaHJlYWQuY3VycmVu\ndFRocmVhZCgpLmdldElkKCkgPT0gZXhlY3V0b3IuZ2V0VGhyZWFkSUQob3Jk\nZXJpbmdLZXkpKSB7CiAgICAgICAgICAgICAgICBzYWZlT3BlcmF0aW9uQ29t\ncGxldGUocmMsIHJlc3VsdCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGV4ZWN1dG9y\nLnN1Ym1pdE9yZGVyZWQob3JkZXJpbmdLZXksIG5ldyBTYWZlUnVubmFibGUo\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVSdW4o\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FmZU9wZXJh\ndGlvbkNvbXBsZXRlKHJjLCByZXN1bHQpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKFJlamVjdGVkRXhlY3V0aW9uRXhjZXB0aW9u\nIHJlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkZhaWxlZCB0\nbyBzdWJtaXQgY2FsbGJhY2sgZm9yIHt9IDogIiwgb3JkZXJpbmdLZXksIHJl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGFic3RyYWN0IHZvaWQgc2FmZU9wZXJhdGlvbkNv\nbXBsZXRlKGludCByYywgVCByZXN1bHQpOwogICAgfQp9Cg==\n","encoding":"base64"}

