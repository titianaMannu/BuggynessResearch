{"sha":"a479a369039f210afe1c1aa36c43b0ca6defd6e4","node_id":"MDQ6QmxvYjE1NzU5NTY6YTQ3OWEzNjkwMzlmMjEwYWZlMWMxYWEzNmM0M2IwY2E2ZGVmZDZlNA==","size":38053,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a479a369039f210afe1c1aa36c43b0ca6defd6e4","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci56b29rZWVwZXI7\nCgppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRp\nbC5jb25jdXJyZW50LkNhbGxhYmxlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuRXhlY3V0b3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuRXhlY3V0b3JzOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nUmVqZWN0ZWRFeGVjdXRpb25FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwu\nY29uY3VycmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRp\nbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNSZWZlcmVuY2U7CgppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnpvb2tlZXBlci5ab29Xb3JrZXIuWm9v\nQ2FsbGFibGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0Nh\nbGxiYWNrLkFDTENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuQXN5bmNDYWxsYmFjay5DaGlsZHJlbjJDYWxsYmFjazsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLkFzeW5jQ2FsbGJhY2suQ2hpbGRyZW5DYWxs\nYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkFzeW5jQ2FsbGJh\nY2suRGF0YUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nQXN5bmNDYWxsYmFjay5TdGF0Q2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrLlN0cmluZ0NhbGxiYWNrOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQXN5bmNDYWxsYmFjay5Wb2lkQ2Fs\nbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5DcmVhdGVNb2Rl\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuT3A7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5PcFJlc3VsdDsKaW1wb3J0IG9yZy5hcGFjaGUu\nem9va2VlcGVyLlRyYW5zYWN0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuV2F0Y2hlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNo\nZXIuRXZlbnQuRXZlbnRUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZTsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLmRhdGEuQUNMOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nZGF0YS5TdGF0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIFByb3ZpZGUgYSB6b29r\nZWVwZXIgY2xpZW50IHRvIGhhbmRsZSBzZXNzaW9uIGV4cGlyZQogKi8KcHVi\nbGljIGNsYXNzIFpvb0tlZXBlckNsaWVudCBleHRlbmRzIFpvb0tlZXBlciBp\nbXBsZW1lbnRzIFdhdGNoZXIgewoKICAgIGZpbmFsIHN0YXRpYyBMb2dnZXIg\nbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoWm9vS2VlcGVyQ2xp\nZW50LmNsYXNzKTsKCiAgICAvLyBab29LZWVwZXIgY2xpZW50IGNvbm5lY3Rp\nb24gdmFyaWFibGVzCiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBjb25uZWN0\nU3RyaW5nOwogICAgcHJpdmF0ZSBmaW5hbCBpbnQgc2Vzc2lvblRpbWVvdXRN\nczsKCiAgICAvLyBzdGF0ZSBmb3IgdGhlIHpvb2tlZXBlciBjbGllbnQKICAg\nIHByaXZhdGUgZmluYWwgQXRvbWljUmVmZXJlbmNlPFpvb0tlZXBlcj4gemsg\nPSBuZXcgQXRvbWljUmVmZXJlbmNlPFpvb0tlZXBlcj4oKTsKICAgIHByaXZh\ndGUgZmluYWwgWm9vS2VlcGVyV2F0Y2hlckJhc2Ugd2F0Y2hlck1hbmFnZXI7\nCgogICAgcHJpdmF0ZSBmaW5hbCBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ug\ncmV0cnlFeGVjdXRvcjsKICAgIHByaXZhdGUgZmluYWwgRXhlY3V0b3JTZXJ2\naWNlIGNvbm5lY3RFeGVjdXRvcjsKCiAgICAvLyByZXRyeSBwb2xpY2VzCiAg\nICBwcml2YXRlIGZpbmFsIFJldHJ5UG9saWN5IGNvbm5lY3RSZXRyeVBvbGlj\neTsKICAgIHByaXZhdGUgZmluYWwgUmV0cnlQb2xpY3kgb3BlcmF0aW9uUmV0\ncnlQb2xpY3k7CgogICAgcHJpdmF0ZSBmaW5hbCBDYWxsYWJsZTxab29LZWVw\nZXI+IGNsaWVudENyZWF0b3IgPSBuZXcgQ2FsbGFibGU8Wm9vS2VlcGVyPigp\nIHsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFpvb0tlZXBl\nciBjYWxsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICByZXR1cm4gWm9vV29ya2VyLnN5bmNDYWxsV2l0\naFJldHJpZXMobnVsbCwgbmV3IFpvb0NhbGxhYmxlPFpvb0tlZXBlcj4oKSB7\nCgogICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgICAgIHB1YmxpYyBab29LZWVwZXIgY2FsbCgpIHRocm93cyBLZWVwZXJF\neGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlJlY29ubmVjdGluZyB6b29rZWVw\nZXIge30uIiwgY29ubmVjdFN0cmluZyk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIFpvb0tlZXBlciBuZXdaazsKICAgICAgICAgICAgICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1prID0gY3Jl\nYXRlWm9vS2VlcGVyKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKElPRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIkZhaWxlZCB0byBjcmVhdGUgem9va2VlcGVy\nIGluc3RhbmNlIHRvICIgKyBjb25uZWN0U3RyaW5nLCBpZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBLZWVwZXJFeGNlcHRpb24uY3Jl\nYXRlKEtlZXBlckV4Y2VwdGlvbi5Db2RlLkNPTk5FQ1RJT05MT1NTKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAvLyBjbG9zZSB0aGUgcHJldmlvdXMgb25lCiAgICAgICAgICAgICAgICAg\nICAgICAgIGNsb3NlWmtIYW5kbGUoKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgemsuc2V0KG5ld1prKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIuZGVidWcoIlpvb0tlZXBlciBzZXNzaW9uIHt9\nIGlzIGNyZWF0ZWQgdG8ge30uIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgTG9uZy50b0hleFN0cmluZyhuZXdaay5nZXRTZXNzaW9u\nSWQoKSksIGNvbm5lY3RTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdaazsKICAg\nICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJp\nbmcoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcu\nZm9ybWF0KCJab29LZWVwZXIgQ2xpZW50IENyZWF0b3IgKCVzKSIsIGNvbm5l\nY3RTdHJpbmcpOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICB9LCBjb25uZWN0UmV0cnlQb2xpY3kpOwogICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmVy\ncm9yKCJHYXZlIHVwIHJlY29ubmVjdGluZyB0byBab29LZWVwZXIgOiAiLCBl\nKTsKICAgICAgICAgICAgICAgIFJ1bnRpbWUuZ2V0UnVudGltZSgpLmV4aXQo\nLTEpOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgfTsKCiAgICBwdWJsaWMgc3RhdGljIFpvb0tl\nZXBlciBjcmVhdGVDb25uZWN0ZWRab29LZWVwZXIoU3RyaW5nIGNvbm5lY3RT\ndHJpbmcsIGludCBzZXNzaW9uVGltZW91dE1zKQogICAgICAgICAgICAgICAg\nICAgIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0\naW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgWm9vS2VlcGVyV2F0Y2hlckJh\nc2Ugd2F0Y2hlciA9IG5ldyBab29LZWVwZXJXYXRjaGVyQmFzZShzZXNzaW9u\nVGltZW91dE1zKTsKICAgICAgICBab29LZWVwZXIgemsgPSBuZXcgWm9vS2Vl\ncGVyKGNvbm5lY3RTdHJpbmcsIHNlc3Npb25UaW1lb3V0TXMsIHdhdGNoZXIp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHdhdGNoZXIud2FpdEZvckNv\nbm5lY3Rpb24oKTsKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24g\na2UpIHsKICAgICAgICAgICAgemsuY2xvc2UoKTsKICAgICAgICAgICAgdGhy\nb3cga2U7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24g\naWUpIHsKICAgICAgICAgICAgemsuY2xvc2UoKTsKICAgICAgICAgICAgdGhy\nb3cgaWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiB6azsKICAgIH0KCiAg\nICBwdWJsaWMgc3RhdGljIFpvb0tlZXBlckNsaWVudCBjcmVhdGVDb25uZWN0\nZWRab29LZWVwZXJDbGllbnQoU3RyaW5nIGNvbm5lY3RTdHJpbmcsIGludCBz\nZXNzaW9uVGltZW91dE1zKQogICAgICAgICAgICAgICAgICAgIHRocm93cyBL\nZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgWm9vS2VlcGVyV2F0Y2hlckJhc2Ugd2F0Y2hlck1h\nbmFnZXIgPSBuZXcgWm9vS2VlcGVyV2F0Y2hlckJhc2Uoc2Vzc2lvblRpbWVv\ndXRNcyk7CiAgICAgICAgWm9vS2VlcGVyQ2xpZW50IGNsaWVudCA9IG5ldyBa\nb29LZWVwZXJDbGllbnQoY29ubmVjdFN0cmluZywgc2Vzc2lvblRpbWVvdXRN\ncywgd2F0Y2hlck1hbmFnZXIsCiAgICAgICAgICAgICAgICBuZXcgQm91bmRF\neHBvbmVudGlhbEJhY2tvZmZSZXRyeVBvbGljeShzZXNzaW9uVGltZW91dE1z\nLCBzZXNzaW9uVGltZW91dE1zLCAwKSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgd2F0Y2hlck1hbmFnZXIud2FpdEZvckNvbm5lY3Rpb24oKTsKICAg\nICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24ga2UpIHsKICAgICAgICAg\nICAgY2xpZW50LmNsb3NlKCk7CiAgICAgICAgICAgIHRocm93IGtlOwogICAg\nICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAg\nICAgICAgIGNsaWVudC5jbG9zZSgpOwogICAgICAgICAgICB0aHJvdyBpZTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNsaWVudDsKICAgIH0KCiAgICBw\ndWJsaWMgc3RhdGljIFpvb0tlZXBlckNsaWVudCBjcmVhdGVDb25uZWN0ZWRa\nb29LZWVwZXJDbGllbnQoCiAgICAgICAgICAgIFN0cmluZyBjb25uZWN0U3Ry\naW5nLCBpbnQgc2Vzc2lvblRpbWVvdXRNcywgUmV0cnlQb2xpY3kgb3BlcmF0\naW9uUmV0cnlQb2xpY3kpCiAgICAgICAgICAgICAgICAgICAgdGhyb3dzIEtl\nZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIElPRXhjZXB0\naW9uIHsKICAgICAgICBab29LZWVwZXJXYXRjaGVyQmFzZSB3YXRjaGVyTWFu\nYWdlciA9IG5ldyBab29LZWVwZXJXYXRjaGVyQmFzZShzZXNzaW9uVGltZW91\ndE1zKTsgCiAgICAgICAgWm9vS2VlcGVyQ2xpZW50IGNsaWVudCA9IG5ldyBa\nb29LZWVwZXJDbGllbnQoY29ubmVjdFN0cmluZywgc2Vzc2lvblRpbWVvdXRN\ncywgd2F0Y2hlck1hbmFnZXIsCiAgICAgICAgICAgICAgICBvcGVyYXRpb25S\nZXRyeVBvbGljeSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2F0Y2hl\nck1hbmFnZXIud2FpdEZvckNvbm5lY3Rpb24oKTsKICAgICAgICB9IGNhdGNo\nIChLZWVwZXJFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgY2xpZW50LmNs\nb3NlKCk7CiAgICAgICAgICAgIHRocm93IGtlOwogICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIGNsaWVu\ndC5jbG9zZSgpOwogICAgICAgICAgICB0aHJvdyBpZTsKICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIGNsaWVudDsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGlj\nIFpvb0tlZXBlckNsaWVudCBjcmVhdGVDb25uZWN0ZWRab29LZWVwZXJDbGll\nbnQoCiAgICAgICAgICAgIFN0cmluZyBjb25uZWN0U3RyaW5nLCBpbnQgc2Vz\nc2lvblRpbWVvdXRNcywgU2V0PFdhdGNoZXI+IGNoaWxkV2F0Y2hlcnMsCiAg\nICAgICAgICAgIFJldHJ5UG9saWN5IG9wZXJhdGlvblJldHJ5UG9saWN5KQog\nICAgICAgICAgICAgICAgICAgIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIElu\ndGVycnVwdGVkRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiB7CiAgICAgICAgWm9v\nS2VlcGVyV2F0Y2hlckJhc2Ugd2F0Y2hlck1hbmFnZXIgPQogICAgICAgICAg\nICAgICAgbmV3IFpvb0tlZXBlcldhdGNoZXJCYXNlKHNlc3Npb25UaW1lb3V0\nTXMsIGNoaWxkV2F0Y2hlcnMpOwogICAgICAgIFpvb0tlZXBlckNsaWVudCBj\nbGllbnQgPSBuZXcgWm9vS2VlcGVyQ2xpZW50KGNvbm5lY3RTdHJpbmcsIHNl\nc3Npb25UaW1lb3V0TXMsIHdhdGNoZXJNYW5hZ2VyLAogICAgICAgICAgICAg\nICAgb3BlcmF0aW9uUmV0cnlQb2xpY3kpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIHdhdGNoZXJNYW5hZ2VyLndhaXRGb3JDb25uZWN0aW9uKCk7CiAg\nICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIGNsaWVudC5jbG9zZSgpOwogICAgICAgICAgICB0aHJvdyBrZTsKICAg\nICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAg\nICAgICAgICBjbGllbnQuY2xvc2UoKTsKICAgICAgICAgICAgdGhyb3cgaWU7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBjbGllbnQ7CiAgICB9CgogICAg\nWm9vS2VlcGVyQ2xpZW50KFN0cmluZyBjb25uZWN0U3RyaW5nLCBpbnQgc2Vz\nc2lvblRpbWVvdXRNcywgWm9vS2VlcGVyV2F0Y2hlckJhc2Ugd2F0Y2hlck1h\nbmFnZXIsCiAgICAgICAgICAgIFJldHJ5UG9saWN5IG9wZXJhdGlvblJldHJ5\nUG9saWN5KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHRoaXMoY29u\nbmVjdFN0cmluZywgc2Vzc2lvblRpbWVvdXRNcywgd2F0Y2hlck1hbmFnZXIs\nCiAgICAgICAgICAgICAgICBuZXcgQm91bmRFeHBvbmVudGlhbEJhY2tvZmZS\nZXRyeVBvbGljeSg2MDAwLCA2MDAwMCwgSW50ZWdlci5NQVhfVkFMVUUpLAog\nICAgICAgICAgICAgICAgb3BlcmF0aW9uUmV0cnlQb2xpY3kpOwogICAgfQoK\nICAgIHByaXZhdGUgWm9vS2VlcGVyQ2xpZW50KFN0cmluZyBjb25uZWN0U3Ry\naW5nLCBpbnQgc2Vzc2lvblRpbWVvdXRNcywKICAgICAgICAgICAgWm9vS2Vl\ncGVyV2F0Y2hlckJhc2Ugd2F0Y2hlck1hbmFnZXIsCiAgICAgICAgICAgIFJl\ndHJ5UG9saWN5IGNvbm5lY3RSZXRyeVBvbGljeSwgUmV0cnlQb2xpY3kgb3Bl\ncmF0aW9uUmV0cnlQb2xpY3kpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgc3VwZXIoY29ubmVjdFN0cmluZywgc2Vzc2lvblRpbWVvdXRNcywgd2F0\nY2hlck1hbmFnZXIpOwogICAgICAgIHRoaXMuY29ubmVjdFN0cmluZyA9IGNv\nbm5lY3RTdHJpbmc7CiAgICAgICAgdGhpcy5zZXNzaW9uVGltZW91dE1zID0g\nc2Vzc2lvblRpbWVvdXRNczsKICAgICAgICB0aGlzLndhdGNoZXJNYW5hZ2Vy\nID0gd2F0Y2hlck1hbmFnZXI7CiAgICAgICAgdGhpcy5jb25uZWN0UmV0cnlQ\nb2xpY3kgPSBjb25uZWN0UmV0cnlQb2xpY3k7CiAgICAgICAgdGhpcy5vcGVy\nYXRpb25SZXRyeVBvbGljeSA9IG9wZXJhdGlvblJldHJ5UG9saWN5OwogICAg\nICAgIHRoaXMucmV0cnlFeGVjdXRvciA9CiAgICAgICAgICAgICAgICBFeGVj\ndXRvcnMubmV3U2NoZWR1bGVkVGhyZWFkUG9vbChSdW50aW1lLmdldFJ1bnRp\nbWUoKS5hdmFpbGFibGVQcm9jZXNzb3JzKCkpOwogICAgICAgIHRoaXMuY29u\nbmVjdEV4ZWN1dG9yID0KICAgICAgICAgICAgICAgIEV4ZWN1dG9ycy5uZXdT\naW5nbGVUaHJlYWRFeGVjdXRvcigpOwogICAgICAgIC8vIGFkZGVkIGl0c2Vs\nZiB0byB0aGUgd2F0Y2hlcgogICAgICAgIHdhdGNoZXJNYW5hZ2VyLmFkZENo\naWxkV2F0Y2hlcih0aGlzKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9u\nIHsKICAgICAgICBjb25uZWN0RXhlY3V0b3Iuc2h1dGRvd24oKTsKICAgICAg\nICByZXRyeUV4ZWN1dG9yLnNodXRkb3duKCk7CiAgICAgICAgY2xvc2Vaa0hh\nbmRsZSgpOwogICAgfQogICAgCiAgICBwcml2YXRlIHZvaWQgY2xvc2Vaa0hh\nbmRsZSgpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAg\nWm9vS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgaWYgKG51\nbGwgPT0gemtIYW5kbGUpIHsKICAgICAgICAgICAgc3VwZXIuY2xvc2UoKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB6a0hhbmRsZS5jbG9zZSgp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCB3YWl0Rm9y\nQ29ubmVjdGlvbigpIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVw\ndGVkRXhjZXB0aW9uIHsKICAgICAgICB3YXRjaGVyTWFuYWdlci53YWl0Rm9y\nQ29ubmVjdGlvbigpOwogICAgfQoKICAgIHByb3RlY3RlZCBab29LZWVwZXIg\nY3JlYXRlWm9vS2VlcGVyKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICByZXR1cm4gbmV3IFpvb0tlZXBlcihjb25uZWN0U3RyaW5nLCBzZXNzaW9u\nVGltZW91dE1zLCB3YXRjaGVyTWFuYWdlcik7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBldmVu\ndCkgewogICAgICAgIGlmIChldmVudC5nZXRUeXBlKCkgPT0gRXZlbnRUeXBl\nLk5vbmUgJiYKICAgICAgICAgICAgICAgIGV2ZW50LmdldFN0YXRlKCkgPT0g\nS2VlcGVyU3RhdGUuRXhwaXJlZCkgewogICAgICAgICAgICBvbkV4cGlyZWQo\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIG9uRXhwaXJl\nZCgpIHsKICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJab29LZWVwZXIgc2Vzc2lvbiB7\nfSBpcyBleHBpcmVkIGZyb20ge30uIiwKICAgICAgICAgICAgICAgICAgICBM\nb25nLnRvSGV4U3RyaW5nKGdldFNlc3Npb25JZCgpKSwgY29ubmVjdFN0cmlu\nZyk7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbm5l\nY3RFeGVjdXRvci5zdWJtaXQoY2xpZW50Q3JlYXRvcik7CiAgICAgICAgfSBj\nYXRjaCAoUmVqZWN0ZWRFeGVjdXRpb25FeGNlcHRpb24gcmVlKSB7CiAgICAg\nICAgICAgIGxvZ2dlci5lcnJvcigiWm9vS2VlcGVyIHJlY29ubmVjdCB0YXNr\nIGlzIHJlamVjdGVkIDogIiwgcmVlKTsKICAgICAgICB9CiAgICB9CgoKICAg\nIHN0YXRpYyBhYnN0cmFjdCBjbGFzcyBSZXRyeVJ1bm5hYmxlIGltcGxlbWVu\ndHMgUnVubmFibGUgewoKICAgICAgICBmaW5hbCBab29Xb3JrZXIgd29ya2Vy\nOwogICAgICAgIGZpbmFsIFJ1bm5hYmxlIHRoYXQ7CgogICAgICAgIFJldHJ5\nUnVubmFibGUoUmV0cnlQb2xpY3kgcmV0cnlQb2xpY3kpIHsKICAgICAgICAg\nICAgd29ya2VyID0gbmV3IFpvb1dvcmtlcihyZXRyeVBvbGljeSk7CiAgICAg\nICAgICAgIHRoYXQgPSB0aGlzOwogICAgICAgIH0KCiAgICB9CgogICAgLy8g\naW5oZXJpdHMgZnJvbSBab29LZWVwZXIgY2xpZW50IGZvciBhbGwgb3BlcmF0\naW9ucwoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGxvbmcgZ2V0U2Vzc2lv\nbklkKCkgewogICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdldCgp\nOwogICAgICAgIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAgICAgICAgICAg\nIHJldHVybiBzdXBlci5nZXRTZXNzaW9uSWQoKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIHprSGFuZGxlLmdldFNlc3Npb25JZCgpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIGJ5dGVbXSBnZXRTZXNzaW9uUGFzc3dk\nKCkgewogICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdldCgpOwog\nICAgICAgIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5nZXRTZXNzaW9uUGFzc3dkKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiB6a0hhbmRsZS5nZXRTZXNzaW9uUGFzc3dkKCk7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgaW50IGdldFNlc3Npb25UaW1l\nb3V0KCkgewogICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdldCgp\nOwogICAgICAgIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAgICAgICAgICAg\nIHJldHVybiBzdXBlci5nZXRTZXNzaW9uVGltZW91dCgpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gemtIYW5kbGUuZ2V0U2Vzc2lvblRpbWVvdXQoKTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGFkZEF1dGhJ\nbmZvKFN0cmluZyBzY2hlbWUsIGJ5dGVbXSBhdXRoKSB7CiAgICAgICAgWm9v\nS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgaWYgKG51bGwg\nPT0gemtIYW5kbGUpIHsKICAgICAgICAgICAgc3VwZXIuYWRkQXV0aEluZm8o\nc2NoZW1lLCBhdXRoKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0K\nICAgICAgICB6a0hhbmRsZS5hZGRBdXRoSW5mbyhzY2hlbWUsIGF1dGgpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHN5bmNocm9uaXplZCB2\nb2lkIHJlZ2lzdGVyKFdhdGNoZXIgd2F0Y2hlcikgewogICAgICAgIHdhdGNo\nZXJNYW5hZ2VyLmFkZENoaWxkV2F0Y2hlcih3YXRjaGVyKTsKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBMaXN0PE9wUmVzdWx0PiBtdWx0aShm\naW5hbCBJdGVyYWJsZTxPcD4gb3BzKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24sIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIFpvb1dv\ncmtlci5zeW5jQ2FsbFdpdGhSZXRyaWVzKHRoaXMsIG5ldyBab29DYWxsYWJs\nZTxMaXN0PE9wUmVzdWx0Pj4oKSB7CgogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIExpc3Q8T3BSZXN1bHQ+IGNhbGwoKSB0aHJv\nd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5kbGUgPSB6ay5nZXQoKTsK\nICAgICAgICAgICAgICAgIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIFpvb0tlZXBlckNsaWVudC5zdXBlci5t\ndWx0aShvcHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\ncmV0dXJuIHprSGFuZGxlLm11bHRpKG9wcyk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgfSwgb3BlcmF0aW9uUmV0cnlQb2xpY3kpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgQERlcHJlY2F0ZWQKICAgIHB1YmxpYyBUcmFuc2FjdGlv\nbiB0cmFuc2FjdGlvbigpIHsKICAgICAgICAvLyBzaW5jZSB0aGVyZSBpcyBu\nbyByZWZlcmVuY2UgYWJvdXQgd2hpY2ggY2xpZW50IHRoYXQgdGhlIHRyYW5z\nYWN0aW9uIGNvdWxkIHVzZQogICAgICAgIC8vIHNvIGp1c3QgdXNlIFpvb0tl\nZXBlciBpbnN0YW5jZSBkaXJlY3RseS4KICAgICAgICAvLyB5b3UnZCBiZXR0\nZXIgdG8gdXNlIHtAbGluayAjbXVsdGl9LgogICAgICAgIFpvb0tlZXBlciB6\na0hhbmRsZSA9IHprLmdldCgpOwogICAgICAgIGlmIChudWxsID09IHprSGFu\nZGxlKSB7CiAgICAgICAgICAgIHJldHVybiBzdXBlci50cmFuc2FjdGlvbigp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gemtIYW5kbGUudHJhbnNhY3Rp\nb24oKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBMaXN0PEFD\nTD4gZ2V0QUNMKGZpbmFsIFN0cmluZyBwYXRoLCBmaW5hbCBTdGF0IHN0YXQp\nIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gWm9vV29ya2VyLnN5bmNDYWxsV2l0aFJldHJp\nZXModGhpcywgbmV3IFpvb0NhbGxhYmxlPExpc3Q8QUNMPj4oKSB7CgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIExpc3Q8QUNM\nPiBjYWxsKCkgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRF\neGNlcHRpb24gewogICAgICAgICAgICAgICAgWm9vS2VlcGVyIHprSGFuZGxl\nID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB6a0hh\nbmRsZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBab29LZWVwZXJD\nbGllbnQuc3VwZXIuZ2V0QUNMKHBhdGgsIHN0YXQpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHprSGFuZGxlLmdldEFDTChw\nYXRoLCBzdGF0KTsKICAgICAgICAgICAgfQoKICAgICAgICB9LCBvcGVyYXRp\nb25SZXRyeVBvbGljeSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCBnZXRBQ0woZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFsIFN0YXQg\nc3RhdCwgZmluYWwgQUNMQ2FsbGJhY2sgY2IsIGZpbmFsIE9iamVjdCBjb250\nZXh0KSB7CiAgICAgICAgZmluYWwgUnVubmFibGUgcHJvYyA9IG5ldyBSZXRy\neVJ1bm5hYmxlKG9wZXJhdGlvblJldHJ5UG9saWN5KSB7CgogICAgICAgICAg\nICBmaW5hbCBBQ0xDYWxsYmFjayBhY2xDYiA9IG5ldyBBQ0xDYWxsYmFjaygp\nIHsKCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0\naCwgT2JqZWN0IGN0eCwgTGlzdDxBQ0w+IGFjbCwgU3RhdCBzdGF0KSB7CiAg\nICAgICAgICAgICAgICAgICAgWm9vV29ya2VyIHdvcmtlciA9IChab29Xb3Jr\nZXIpY3R4OwogICAgICAgICAgICAgICAgICAgIGlmICh3b3JrZXIuYWxsb3dS\nZXRyeShyYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlFeGVj\ndXRvci5zY2hlZHVsZSh0aGF0LCB3b3JrZXIubmV4dFJldHJ5V2FpdFRpbWUo\nKSwgVGltZVVuaXQuTUlMTElTRUNPTkRTKTsKICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjYi5wcm9jZXNz\nUmVzdWx0KHJjLCBwYXRoLCBjb250ZXh0LCBhY2wsIHN0YXQpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIH07CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgWm9vS2VlcGVyIHprSGFu\nZGxlID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB6\na0hhbmRsZSkgewogICAgICAgICAgICAgICAgICAgIFpvb0tlZXBlckNsaWVu\ndC5zdXBlci5nZXRBQ0wocGF0aCwgc3RhdCwgYWNsQ2IsIHdvcmtlcik7CiAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHpr\nSGFuZGxlLmdldEFDTChwYXRoLCBzdGF0LCBhY2xDYiwgd29ya2VyKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAg\nICAgLy8gZXhlY3V0ZSBpdCBpbW1lZGlhdGVseQogICAgICAgIHByb2MucnVu\nKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgU3RhdCBzZXRB\nQ0woZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFsIExpc3Q8QUNMPiBhY2wsIGZp\nbmFsIGludCB2ZXJzaW9uKQogICAgICAgICAgICB0aHJvd3MgS2VlcGVyRXhj\nZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIFpvb1dvcmtlci5zeW5jQ2FsbFdpdGhSZXRyaWVzKHRoaXMsIG5ldyBab29D\nYWxsYWJsZTxTdGF0PigpIHsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgU3RhdCBjYWxsKCkgdGhyb3dzIEtlZXBlckV4Y2Vw\ndGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\nWm9vS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAg\nICBpZiAobnVsbCA9PSB6a0hhbmRsZSkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBab29LZWVwZXJDbGllbnQuc3VwZXIuc2V0QUNMKHBhdGgsIGFj\nbCwgdmVyc2lvbik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICByZXR1cm4gemtIYW5kbGUuc2V0QUNMKHBhdGgsIGFjbCwgdmVyc2lvbik7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgfSwgb3BlcmF0aW9uUmV0cnlQb2xp\nY3kpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0\nQUNMKGZpbmFsIFN0cmluZyBwYXRoLCBmaW5hbCBMaXN0PEFDTD4gYWNsLCBm\naW5hbCBpbnQgdmVyc2lvbiwKICAgICAgICAgICAgZmluYWwgU3RhdENhbGxi\nYWNrIGNiLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAgIGZpbmFs\nIFJ1bm5hYmxlIHByb2MgPSBuZXcgUmV0cnlSdW5uYWJsZShvcGVyYXRpb25S\nZXRyeVBvbGljeSkgewoKICAgICAgICAgICAgZmluYWwgU3RhdENhbGxiYWNr\nIHN0Q2IgPSBuZXcgU3RhdENhbGxiYWNrKCkgewoKICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vz\nc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBTdGF0\nIHN0YXQpIHsKICAgICAgICAgICAgICAgICAgICBab29Xb3JrZXIgd29ya2Vy\nID0gKFpvb1dvcmtlciljdHg7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdv\ncmtlci5hbGxvd1JldHJ5KHJjKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICByZXRyeUV4ZWN1dG9yLnNjaGVkdWxlKHRoYXQsIHdvcmtlci5uZXh0UmV0\ncnlXYWl0VGltZSgpLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpOwogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLnByb2Nlc3NSZXN1bHQocmMsIHBhdGgsIGNvbnRleHQsIHN0YXQpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIH07CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgWm9vS2VlcGVy\nIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAobnVs\nbCA9PSB6a0hhbmRsZSkgewogICAgICAgICAgICAgICAgICAgIFpvb0tlZXBl\nckNsaWVudC5zdXBlci5zZXRBQ0wocGF0aCwgYWNsLCB2ZXJzaW9uLCBzdENi\nLCB3b3JrZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICB6a0hhbmRsZS5zZXRBQ0wocGF0aCwgYWNsLCB2ZXJzaW9u\nLCBzdENiLCB3b3JrZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfTsKICAgICAgICAvLyBleGVjdXRlIGl0IGltbWVkaWF0\nZWx5CiAgICAgICAgcHJvYy5ydW4oKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIHN5bmMoZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFs\nIFZvaWRDYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGNvbnRleHQpIHsKICAg\nICAgICBmaW5hbCBSdW5uYWJsZSBwcm9jID0gbmV3IFJldHJ5UnVubmFibGUo\nb3BlcmF0aW9uUmV0cnlQb2xpY3kpIHsKCiAgICAgICAgICAgIGZpbmFsIFZv\naWRDYWxsYmFjayB2Q2IgPSBuZXcgVm9pZENhbGxiYWNrKCkgewoKICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgWm9vV29ya2VyIHdvcmtlciA9\nIChab29Xb3JrZXIpY3R4OwogICAgICAgICAgICAgICAgICAgIGlmICh3b3Jr\nZXIuYWxsb3dSZXRyeShyYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0cnlFeGVjdXRvci5zY2hlZHVsZSh0aGF0LCB3b3JrZXIubmV4dFJldHJ5\nV2FpdFRpbWUoKSwgVGltZVVuaXQuTUlMTElTRUNPTkRTKTsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBj\nYi5wcm9jZXNzUmVzdWx0KHJjLCBwYXRoLCBjb250ZXh0KTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9\nOwoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgIFpvb0tlZXBlciB6a0hhbmRs\nZSA9IHprLmdldCgpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gemtI\nYW5kbGUpIHsKICAgICAgICAgICAgICAgICAgICBab29LZWVwZXJDbGllbnQu\nc3VwZXIuc3luYyhwYXRoLCB2Q2IsIHdvcmtlcik7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHprSGFuZGxlLnN5bmMo\ncGF0aCwgdkNiLCB3b3JrZXIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLyBleGVjdXRlIGl0IGltbWVk\naWF0ZWx5CiAgICAgICAgcHJvYy5ydW4oKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyBTdGF0ZXMgZ2V0U3RhdGUoKSB7CiAgICAgICAgWm9v\nS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgaWYgKG51bGwg\nPT0gemtIYW5kbGUpIHsKICAgICAgICAgICAgcmV0dXJuIFpvb0tlZXBlckNs\naWVudC5zdXBlci5nZXRTdGF0ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIHJldHVybiB6a0hhbmRsZS5nZXRTdGF0ZSgpOwogICAgICAgIH0K\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJp\nbmcoKSB7CiAgICAgICAgWm9vS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7\nCiAgICAgICAgaWYgKG51bGwgPT0gemtIYW5kbGUpIHsKICAgICAgICAgICAg\ncmV0dXJuIFpvb0tlZXBlckNsaWVudC5zdXBlci50b1N0cmluZygpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiB6a0hhbmRsZS50b1N0\ncmluZygpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyBTdHJpbmcgY3JlYXRlKGZpbmFsIFN0cmluZyBwYXRoLCBmaW5hbCBi\neXRlW10gZGF0YSwKICAgICAgICAgICAgZmluYWwgTGlzdDxBQ0w+IGFjbCwg\nZmluYWwgQ3JlYXRlTW9kZSBjcmVhdGVNb2RlKQogICAgICAgICAgICAgICAg\nICAgIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0\naW9uIHsKICAgICAgICByZXR1cm4gWm9vV29ya2VyLnN5bmNDYWxsV2l0aFJl\ndHJpZXModGhpcywgbmV3IFpvb0NhbGxhYmxlPFN0cmluZz4oKSB7CgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIFN0cmluZyBj\nYWxsKCkgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgWm9vS2VlcGVyIHprSGFuZGxlID0g\nemsuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB6a0hhbmRs\nZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBab29LZWVwZXJDbGll\nbnQuc3VwZXIuY3JlYXRlKHBhdGgsIGRhdGEsIGFjbCwgY3JlYXRlTW9kZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gemtI\nYW5kbGUuY3JlYXRlKHBhdGgsIGRhdGEsIGFjbCwgY3JlYXRlTW9kZSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgfSwgb3BlcmF0aW9uUmV0cnlQb2xpY3kp\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY3JlYXRl\nKGZpbmFsIFN0cmluZyBwYXRoLCBmaW5hbCBieXRlW10gZGF0YSwgZmluYWwg\nTGlzdDxBQ0w+IGFjbCwKICAgICAgICAgICAgZmluYWwgQ3JlYXRlTW9kZSBj\ncmVhdGVNb2RlLCBmaW5hbCBTdHJpbmdDYWxsYmFjayBjYiwgZmluYWwgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICBmaW5hbCBSdW5uYWJsZSBwcm9jID0g\nbmV3IFJldHJ5UnVubmFibGUob3BlcmF0aW9uUmV0cnlQb2xpY3kpIHsKCiAg\nICAgICAgICAgIGZpbmFsIFN0cmluZ0NhbGxiYWNrIGNyZWF0ZUNiID0gbmV3\nIFN0cmluZ0NhbGxiYWNrKCkgewoKICAgICAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChp\nbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBTdHJpbmcgbmFtZSkg\newogICAgICAgICAgICAgICAgICAgIFpvb1dvcmtlciB3b3JrZXIgPSAoWm9v\nV29ya2VyKWN0eDsKICAgICAgICAgICAgICAgICAgICBpZiAod29ya2VyLmFs\nbG93UmV0cnkocmMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5\nRXhlY3V0b3Iuc2NoZWR1bGUodGhhdCwgd29ya2VyLm5leHRSZXRyeVdhaXRU\naW1lKCksIFRpbWVVbml0Lk1JTExJU0VDT05EUyk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2IucHJv\nY2Vzc1Jlc3VsdChyYywgcGF0aCwgY29udGV4dCwgbmFtZSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nfTsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5k\nbGUgPSB6ay5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHpr\nSGFuZGxlKSB7CiAgICAgICAgICAgICAgICAgICAgWm9vS2VlcGVyQ2xpZW50\nLnN1cGVyLmNyZWF0ZShwYXRoLCBkYXRhLCBhY2wsIGNyZWF0ZU1vZGUsIGNy\nZWF0ZUNiLCB3b3JrZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICB6a0hhbmRsZS5jcmVhdGUocGF0aCwgZGF0YSwg\nYWNsLCBjcmVhdGVNb2RlLCBjcmVhdGVDYiwgd29ya2VyKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgLy8g\nZXhlY3V0ZSBpdCBpbW1lZGlhdGVseQogICAgICAgIHByb2MucnVuKCk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBkZWxldGUoZmlu\nYWwgU3RyaW5nIHBhdGgsIGZpbmFsIGludCB2ZXJzaW9uKSB0aHJvd3MgS2Vl\ncGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAg\nWm9vV29ya2VyLnN5bmNDYWxsV2l0aFJldHJpZXModGhpcywgbmV3IFpvb0Nh\nbGxhYmxlPFZvaWQ+KCkgewoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyBWb2lkIGNhbGwoKSB0aHJvd3MgS2VlcGVyRXhjZXB0\naW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBa\nb29LZWVwZXIgemtIYW5kbGUgPSB6ay5nZXQoKTsKICAgICAgICAgICAgICAg\nIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAgICAgICAgICAgICAgICAgICAg\nWm9vS2VlcGVyQ2xpZW50LnN1cGVyLmRlbGV0ZShwYXRoLCB2ZXJzaW9uKTsK\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nemtIYW5kbGUuZGVsZXRlKHBhdGgsIHZlcnNpb24pOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgfSwgb3BlcmF0aW9uUmV0cnlQb2xpY3kpOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgZGVsZXRlKGZpbmFsIFN0\ncmluZyBwYXRoLCBmaW5hbCBpbnQgdmVyc2lvbiwgZmluYWwgVm9pZENhbGxi\nYWNrIGNiLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAgIGZpbmFs\nIFJ1bm5hYmxlIHByb2MgPSBuZXcgUmV0cnlSdW5uYWJsZShvcGVyYXRpb25S\nZXRyeVBvbGljeSkgewoKICAgICAgICAgICAgZmluYWwgVm9pZENhbGxiYWNr\nIGRlbGV0ZUNiID0gbmV3IFZvaWRDYWxsYmFjaygpIHsKCiAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBy\nb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICAgICAgICAgIFpvb1dvcmtlciB3b3JrZXIgPSAoWm9v\nV29ya2VyKWN0eDsKICAgICAgICAgICAgICAgICAgICBpZiAod29ya2VyLmFs\nbG93UmV0cnkocmMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJ5\nRXhlY3V0b3Iuc2NoZWR1bGUodGhhdCwgd29ya2VyLm5leHRSZXRyeVdhaXRU\naW1lKCksIFRpbWVVbml0Lk1JTExJU0VDT05EUyk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2IucHJv\nY2Vzc1Jlc3VsdChyYywgcGF0aCwgY29udGV4dCk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKCiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBy\ndW4oKSB7CiAgICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5kbGUgPSB6\nay5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHprSGFuZGxl\nKSB7CiAgICAgICAgICAgICAgICAgICAgWm9vS2VlcGVyQ2xpZW50LnN1cGVy\nLmRlbGV0ZShwYXRoLCB2ZXJzaW9uLCBkZWxldGVDYiwgd29ya2VyKTsKICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgemtI\nYW5kbGUuZGVsZXRlKHBhdGgsIHZlcnNpb24sIGRlbGV0ZUNiLCB3b3JrZXIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsK\nICAgICAgICAvLyBleGVjdXRlIGl0IGltbWVkaWF0ZWx5CiAgICAgICAgcHJv\nYy5ydW4oKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBTdGF0\nIGV4aXN0cyhmaW5hbCBTdHJpbmcgcGF0aCwgZmluYWwgV2F0Y2hlciB3YXRj\naGVyKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgcmV0dXJuIFpvb1dvcmtlci5zeW5jQ2FsbFdpdGhS\nZXRyaWVzKHRoaXMsIG5ldyBab29DYWxsYWJsZTxTdGF0PigpIHsKCiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgU3RhdCBjYWxs\nKCkgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgWm9vS2VlcGVyIHprSGFuZGxlID0gemsu\nZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB6a0hhbmRsZSkg\newogICAgICAgICAgICAgICAgICAgIHJldHVybiBab29LZWVwZXJDbGllbnQu\nc3VwZXIuZXhpc3RzKHBhdGgsIHdhdGNoZXIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgcmV0dXJuIHprSGFuZGxlLmV4aXN0cyhwYXRo\nLCB3YXRjaGVyKTsKICAgICAgICAgICAgfQoKICAgICAgICB9LCBvcGVyYXRp\nb25SZXRyeVBvbGljeSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgU3RhdCBleGlzdHMoZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFsIGJvb2xl\nYW4gd2F0Y2gpIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVk\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gWm9vV29ya2VyLnN5bmNDYWxs\nV2l0aFJldHJpZXModGhpcywgbmV3IFpvb0NhbGxhYmxlPFN0YXQ+KCkgewoK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBTdGF0\nIGNhbGwoKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5kbGUg\nPSB6ay5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHprSGFu\nZGxlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFpvb0tlZXBlckNs\naWVudC5zdXBlci5leGlzdHMocGF0aCwgd2F0Y2gpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHprSGFuZGxlLmV4aXN0cyhw\nYXRoLCB3YXRjaCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwgb3BlcmF0\naW9uUmV0cnlQb2xpY3kpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgZXhpc3RzKGZpbmFsIFN0cmluZyBwYXRoLCBmaW5hbCBXYXRj\naGVyIHdhdGNoZXIsIGZpbmFsIFN0YXRDYWxsYmFjayBjYiwgZmluYWwgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICBmaW5hbCBSdW5uYWJsZSBwcm9jID0g\nbmV3IFJldHJ5UnVubmFibGUob3BlcmF0aW9uUmV0cnlQb2xpY3kpIHsKCiAg\nICAgICAgICAgIGZpbmFsIFN0YXRDYWxsYmFjayBzdENiID0gbmV3IFN0YXRD\nYWxsYmFjaygpIHsKCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBT\ndHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgU3RhdCBzdGF0KSB7CiAgICAgICAg\nICAgICAgICAgICAgWm9vV29ya2VyIHdvcmtlciA9IChab29Xb3JrZXIpY3R4\nOwogICAgICAgICAgICAgICAgICAgIGlmICh3b3JrZXIuYWxsb3dSZXRyeShy\nYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlFeGVjdXRvci5z\nY2hlZHVsZSh0aGF0LCB3b3JrZXIubmV4dFJldHJ5V2FpdFRpbWUoKSwgVGlt\nZVVuaXQuTUlMTElTRUNPTkRTKTsKICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjYi5wcm9jZXNzUmVzdWx0\nKHJjLCBwYXRoLCBjb250ZXh0LCBzdGF0KTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwoKICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigp\nIHsKICAgICAgICAgICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdl\ndCgpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gemtIYW5kbGUpIHsK\nICAgICAgICAgICAgICAgICAgICBab29LZWVwZXJDbGllbnQuc3VwZXIuZXhp\nc3RzKHBhdGgsIHdhdGNoZXIsIHN0Q2IsIHdvcmtlcik7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHprSGFuZGxlLmV4\naXN0cyhwYXRoLCB3YXRjaGVyLCBzdENiLCB3b3JrZXIpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLyBl\neGVjdXRlIGl0IGltbWVkaWF0ZWx5CiAgICAgICAgcHJvYy5ydW4oKTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGV4aXN0cyhmaW5h\nbCBTdHJpbmcgcGF0aCwgZmluYWwgYm9vbGVhbiB3YXRjaCwgZmluYWwgU3Rh\ndENhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAg\nIGZpbmFsIFJ1bm5hYmxlIHByb2MgPSBuZXcgUmV0cnlSdW5uYWJsZShvcGVy\nYXRpb25SZXRyeVBvbGljeSkgewoKICAgICAgICAgICAgZmluYWwgU3RhdENh\nbGxiYWNrIHN0Q2IgPSBuZXcgU3RhdENhbGxiYWNrKCkgewoKICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\ncHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4\nLCBTdGF0IHN0YXQpIHsKICAgICAgICAgICAgICAgICAgICBab29Xb3JrZXIg\nd29ya2VyID0gKFpvb1dvcmtlciljdHg7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHdvcmtlci5hbGxvd1JldHJ5KHJjKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICByZXRyeUV4ZWN1dG9yLnNjaGVkdWxlKHRoYXQsIHdvcmtlci5u\nZXh0UmV0cnlXYWl0VGltZSgpLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpOwog\nICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGNiLnByb2Nlc3NSZXN1bHQocmMsIHBhdGgsIGNvbnRleHQsIHN0\nYXQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIH07CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgWm9v\nS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAgICBp\nZiAobnVsbCA9PSB6a0hhbmRsZSkgewogICAgICAgICAgICAgICAgICAgIFpv\nb0tlZXBlckNsaWVudC5zdXBlci5leGlzdHMocGF0aCwgd2F0Y2gsIHN0Q2Is\nIHdvcmtlcik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHprSGFuZGxlLmV4aXN0cyhwYXRoLCB3YXRjaCwgc3RDYiwg\nd29ya2VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH07CiAgICAgICAgLy8gZXhlY3V0ZSBpdCBpbW1lZGlhdGVseQogICAg\nICAgIHByb2MucnVuKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgYnl0ZVtdIGdldERhdGEoZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFsIFdh\ndGNoZXIgd2F0Y2hlciwgZmluYWwgU3RhdCBzdGF0KQogICAgICAgICAgICB0\naHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIFpvb1dvcmtlci5zeW5jQ2FsbFdpdGhSZXRyaWVz\nKHRoaXMsIG5ldyBab29DYWxsYWJsZTxieXRlW10+KCkgewoKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBieXRlW10gY2FsbCgp\nIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdl\ndCgpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gemtIYW5kbGUpIHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gWm9vS2VlcGVyQ2xpZW50LnN1\ncGVyLmdldERhdGEocGF0aCwgd2F0Y2hlciwgc3RhdCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gemtIYW5kbGUuZ2V0RGF0\nYShwYXRoLCB3YXRjaGVyLCBzdGF0KTsKICAgICAgICAgICAgfQoKICAgICAg\nICB9LCBvcGVyYXRpb25SZXRyeVBvbGljeSk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgYnl0ZVtdIGdldERhdGEoZmluYWwgU3RyaW5nIHBh\ndGgsIGZpbmFsIGJvb2xlYW4gd2F0Y2gsIGZpbmFsIFN0YXQgc3RhdCkKICAg\nICAgICAgICAgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBab29Xb3JrZXIuc3luY0NhbGxX\naXRoUmV0cmllcyh0aGlzLCBuZXcgWm9vQ2FsbGFibGU8Ynl0ZVtdPigpIHsK\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgYnl0\nZVtdIGNhbGwoKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5k\nbGUgPSB6ay5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHpr\nSGFuZGxlKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFpvb0tlZXBl\nckNsaWVudC5zdXBlci5nZXREYXRhKHBhdGgsIHdhdGNoLCBzdGF0KTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiB6a0hhbmRs\nZS5nZXREYXRhKHBhdGgsIHdhdGNoLCBzdGF0KTsKICAgICAgICAgICAgfQoK\nICAgICAgICB9LCBvcGVyYXRpb25SZXRyeVBvbGljeSk7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBnZXREYXRhKGZpbmFsIFN0cmlu\nZyBwYXRoLCBmaW5hbCBXYXRjaGVyIHdhdGNoZXIsIGZpbmFsIERhdGFDYWxs\nYmFjayBjYiwgZmluYWwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBmaW5h\nbCBSdW5uYWJsZSBwcm9jID0gbmV3IFJldHJ5UnVubmFibGUob3BlcmF0aW9u\nUmV0cnlQb2xpY3kpIHsKCiAgICAgICAgICAgIGZpbmFsIERhdGFDYWxsYmFj\nayBkYXRhQ2IgPSBuZXcgRGF0YUNhbGxiYWNrKCkgewoKICAgICAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJv\nY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBi\neXRlW10gZGF0YSwgU3RhdCBzdGF0KSB7CiAgICAgICAgICAgICAgICAgICAg\nWm9vV29ya2VyIHdvcmtlciA9IChab29Xb3JrZXIpY3R4OwogICAgICAgICAg\nICAgICAgICAgIGlmICh3b3JrZXIuYWxsb3dSZXRyeShyYykpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0cnlFeGVjdXRvci5zY2hlZHVsZSh0aGF0\nLCB3b3JrZXIubmV4dFJldHJ5V2FpdFRpbWUoKSwgVGltZVVuaXQuTUlMTElT\nRUNPTkRTKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBjYi5wcm9jZXNzUmVzdWx0KHJjLCBwYXRoLCBj\nb250ZXh0LCBkYXRhLCBzdGF0KTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwoKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICAgICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdldCgpOwog\nICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gemtIYW5kbGUpIHsKICAgICAg\nICAgICAgICAgICAgICBab29LZWVwZXJDbGllbnQuc3VwZXIuZ2V0RGF0YShw\nYXRoLCB3YXRjaGVyLCBkYXRhQ2IsIHdvcmtlcik7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHprSGFuZGxlLmdldERh\ndGEocGF0aCwgd2F0Y2hlciwgZGF0YUNiLCB3b3JrZXIpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICAvLyBl\neGVjdXRlIGl0IGltbWVkaWF0ZWx5CiAgICAgICAgcHJvYy5ydW4oKTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGdldERhdGEoZmlu\nYWwgU3RyaW5nIHBhdGgsIGZpbmFsIGJvb2xlYW4gd2F0Y2gsIGZpbmFsIERh\ndGFDYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAg\nICBmaW5hbCBSdW5uYWJsZSBwcm9jID0gbmV3IFJldHJ5UnVubmFibGUob3Bl\ncmF0aW9uUmV0cnlQb2xpY3kpIHsKCiAgICAgICAgICAgIGZpbmFsIERhdGFD\nYWxsYmFjayBkYXRhQ2IgPSBuZXcgRGF0YUNhbGxiYWNrKCkgewoKICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3Qg\nY3R4LCBieXRlW10gZGF0YSwgU3RhdCBzdGF0KSB7CiAgICAgICAgICAgICAg\nICAgICAgWm9vV29ya2VyIHdvcmtlciA9IChab29Xb3JrZXIpY3R4OwogICAg\nICAgICAgICAgICAgICAgIGlmICh3b3JrZXIuYWxsb3dSZXRyeShyYykpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlFeGVjdXRvci5zY2hlZHVs\nZSh0aGF0LCB3b3JrZXIubmV4dFJldHJ5V2FpdFRpbWUoKSwgVGltZVVuaXQu\nTUlMTElTRUNPTkRTKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgICAgICBjYi5wcm9jZXNzUmVzdWx0KHJjLCBw\nYXRoLCBjb250ZXh0LCBkYXRhLCBzdGF0KTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwoKICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigp\nIHsKICAgICAgICAgICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdl\ndCgpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gemtIYW5kbGUpIHsK\nICAgICAgICAgICAgICAgICAgICBab29LZWVwZXJDbGllbnQuc3VwZXIuZ2V0\nRGF0YShwYXRoLCB3YXRjaCwgZGF0YUNiLCB3b3JrZXIpOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB6a0hhbmRsZS5n\nZXREYXRhKHBhdGgsIHdhdGNoLCBkYXRhQ2IsIHdvcmtlcik7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIC8v\nIGV4ZWN1dGUgaXQgaW1tZWRpYXRlbHkKICAgICAgICBwcm9jLnJ1bigpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFN0YXQgc2V0RGF0YShm\naW5hbCBTdHJpbmcgcGF0aCwgZmluYWwgYnl0ZVtdIGRhdGEsIGZpbmFsIGlu\ndCB2ZXJzaW9uKQogICAgICAgICAgICB0aHJvd3MgS2VlcGVyRXhjZXB0aW9u\nLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIFpvb1dv\ncmtlci5zeW5jQ2FsbFdpdGhSZXRyaWVzKHRoaXMsIG5ldyBab29DYWxsYWJs\nZTxTdGF0PigpIHsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgU3RhdCBjYWxsKCkgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwg\nSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICAgICAgWm9vS2Vl\ncGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAo\nbnVsbCA9PSB6a0hhbmRsZSkgewogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiBab29LZWVwZXJDbGllbnQuc3VwZXIuc2V0RGF0YShwYXRoLCBkYXRhLCB2\nZXJzaW9uKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiB6a0hhbmRsZS5zZXREYXRhKHBhdGgsIGRhdGEsIHZlcnNpb24pOwog\nICAgICAgICAgICB9CgogICAgICAgIH0sIG9wZXJhdGlvblJldHJ5UG9saWN5\nKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNldERh\ndGEoZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFsIGJ5dGVbXSBkYXRhLCBmaW5h\nbCBpbnQgdmVyc2lvbiwKICAgICAgICAgICAgZmluYWwgU3RhdENhbGxiYWNr\nIGNiLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAgIGZpbmFsIFJ1\nbm5hYmxlIHByb2MgPSBuZXcgUmV0cnlSdW5uYWJsZShvcGVyYXRpb25SZXRy\neVBvbGljeSkgewoKICAgICAgICAgICAgZmluYWwgU3RhdENhbGxiYWNrIHN0\nQ2IgPSBuZXcgU3RhdENhbGxiYWNrKCkgewoKICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jl\nc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBTdGF0IHN0\nYXQpIHsKICAgICAgICAgICAgICAgICAgICBab29Xb3JrZXIgd29ya2VyID0g\nKFpvb1dvcmtlciljdHg7CiAgICAgICAgICAgICAgICAgICAgaWYgKHdvcmtl\nci5hbGxvd1JldHJ5KHJjKSkgewogICAgICAgICAgICAgICAgICAgICAgICBy\nZXRyeUV4ZWN1dG9yLnNjaGVkdWxlKHRoYXQsIHdvcmtlci5uZXh0UmV0cnlX\nYWl0VGltZSgpLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNi\nLnByb2Nlc3NSZXN1bHQocmMsIHBhdGgsIGNvbnRleHQsIHN0YXQpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIH07CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgWm9vS2VlcGVyIHpr\nSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAgICBpZiAobnVsbCA9\nPSB6a0hhbmRsZSkgewogICAgICAgICAgICAgICAgICAgIFpvb0tlZXBlckNs\naWVudC5zdXBlci5zZXREYXRhKHBhdGgsIGRhdGEsIHZlcnNpb24sIHN0Q2Is\nIHdvcmtlcik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIHprSGFuZGxlLnNldERhdGEocGF0aCwgZGF0YSwgdmVyc2lv\nbiwgc3RDYiwgd29ya2VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH07CiAgICAgICAgLy8gZXhlY3V0ZSBpdCBpbW1lZGlh\ndGVseQogICAgICAgIHByb2MucnVuKCk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgTGlzdDxTdHJpbmc+IGdldENoaWxkcmVuKGZpbmFsIFN0\ncmluZyBwYXRoLCBmaW5hbCBXYXRjaGVyIHdhdGNoZXIsIGZpbmFsIFN0YXQg\nc3RhdCkKICAgICAgICAgICAgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50\nZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIHJldHVybiBab29Xb3JrZXIu\nc3luY0NhbGxXaXRoUmV0cmllcyh0aGlzLCBuZXcgWm9vQ2FsbGFibGU8TGlz\ndDxTdHJpbmc+PigpIHsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgTGlzdDxTdHJpbmc+IGNhbGwoKSB0aHJvd3MgS2VlcGVy\nRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICBab29LZWVwZXIgemtIYW5kbGUgPSB6ay5nZXQoKTsKICAgICAgICAg\nICAgICAgIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIFpvb0tlZXBlckNsaWVudC5zdXBlci5nZXRDaGlsZHJl\nbihwYXRoLCB3YXRjaGVyLCBzdGF0KTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHJldHVybiB6a0hhbmRsZS5nZXRDaGlsZHJlbihwYXRo\nLCB3YXRjaGVyLCBzdGF0KTsKICAgICAgICAgICAgfQoKICAgICAgICB9LCBv\ncGVyYXRpb25SZXRyeVBvbGljeSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgTGlzdDxTdHJpbmc+IGdldENoaWxkcmVuKGZpbmFsIFN0cmlu\nZyBwYXRoLCBmaW5hbCBib29sZWFuIHdhdGNoLCBmaW5hbCBTdGF0IHN0YXQp\nCiAgICAgICAgICAgIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVw\ndGVkRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gWm9vV29ya2VyLnN5bmND\nYWxsV2l0aFJldHJpZXModGhpcywgbmV3IFpvb0NhbGxhYmxlPExpc3Q8U3Ry\naW5nPj4oKSB7CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIExpc3Q8U3RyaW5nPiBjYWxsKCkgdGhyb3dzIEtlZXBlckV4Y2Vw\ndGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\nWm9vS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAgICAgICAgICAgICAg\nICBpZiAobnVsbCA9PSB6a0hhbmRsZSkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiBab29LZWVwZXJDbGllbnQuc3VwZXIuZ2V0Q2hpbGRyZW4ocGF0\naCwgd2F0Y2gsIHN0YXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgcmV0dXJuIHprSGFuZGxlLmdldENoaWxkcmVuKHBhdGgsIHdhdGNo\nLCBzdGF0KTsKICAgICAgICAgICAgfQoKICAgICAgICB9LCBvcGVyYXRpb25S\nZXRyeVBvbGljeSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCBnZXRDaGlsZHJlbihmaW5hbCBTdHJpbmcgcGF0aCwgZmluYWwgV2F0\nY2hlciB3YXRjaGVyLAogICAgICAgICAgICBmaW5hbCBDaGlsZHJlbjJDYWxs\nYmFjayBjYiwgZmluYWwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBmaW5h\nbCBSdW5uYWJsZSBwcm9jID0gbmV3IFJldHJ5UnVubmFibGUob3BlcmF0aW9u\nUmV0cnlQb2xpY3kpIHsKCiAgICAgICAgICAgIGZpbmFsIENoaWxkcmVuMkNh\nbGxiYWNrIGNoaWxkQ2IgPSBuZXcgQ2hpbGRyZW4yQ2FsbGJhY2soKSB7Cgog\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9i\namVjdCBjdHgsCiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8U3RyaW5n\nPiBjaGlsZHJlbiwgU3RhdCBzdGF0KSB7CiAgICAgICAgICAgICAgICAgICAg\nWm9vV29ya2VyIHdvcmtlciA9IChab29Xb3JrZXIpY3R4OwogICAgICAgICAg\nICAgICAgICAgIGlmICh3b3JrZXIuYWxsb3dSZXRyeShyYykpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0cnlFeGVjdXRvci5zY2hlZHVsZSh0aGF0\nLCB3b3JrZXIubmV4dFJldHJ5V2FpdFRpbWUoKSwgVGltZVVuaXQuTUlMTElT\nRUNPTkRTKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBjYi5wcm9jZXNzUmVzdWx0KHJjLCBwYXRoLCBj\nb250ZXh0LCBjaGlsZHJlbiwgc3RhdCk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKCiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7\nCiAgICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5kbGUgPSB6ay5nZXQo\nKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAg\nICAgICAgICAgICAgICAgICAgWm9vS2VlcGVyQ2xpZW50LnN1cGVyLmdldENo\naWxkcmVuKHBhdGgsIHdhdGNoZXIsIGNoaWxkQ2IsIHdvcmtlcik7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHprSGFu\nZGxlLmdldENoaWxkcmVuKHBhdGgsIHdhdGNoZXIsIGNoaWxkQ2IsIHdvcmtl\ncik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nOwogICAgICAgIC8vIGV4ZWN1dGUgaXQgaW1tZWRpYXRlbHkKICAgICAgICBw\ncm9jLnJ1bigpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgZ2V0Q2hpbGRyZW4oZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFsIGJvb2xl\nYW4gd2F0Y2gsIGZpbmFsIENoaWxkcmVuMkNhbGxiYWNrIGNiLAogICAgICAg\nICAgICBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAgIGZpbmFsIFJ1\nbm5hYmxlIHByb2MgPSBuZXcgUmV0cnlSdW5uYWJsZShvcGVyYXRpb25SZXRy\neVBvbGljeSkgewoKICAgICAgICAgICAgZmluYWwgQ2hpbGRyZW4yQ2FsbGJh\nY2sgY2hpbGRDYiA9IG5ldyBDaGlsZHJlbjJDYWxsYmFjaygpIHsKCiAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0\nIGN0eCwKICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxTdHJpbmc+IGNo\naWxkcmVuLCBTdGF0IHN0YXQpIHsKICAgICAgICAgICAgICAgICAgICBab29X\nb3JrZXIgd29ya2VyID0gKFpvb1dvcmtlciljdHg7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKHdvcmtlci5hbGxvd1JldHJ5KHJjKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICByZXRyeUV4ZWN1dG9yLnNjaGVkdWxlKHRoYXQsIHdv\ncmtlci5uZXh0UmV0cnlXYWl0VGltZSgpLCBUaW1lVW5pdC5NSUxMSVNFQ09O\nRFMpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLnByb2Nlc3NSZXN1bHQocmMsIHBhdGgsIGNvbnRl\neHQsIGNoaWxkcmVuLCBzdGF0KTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwoKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICAgICAgICAgIFpvb0tlZXBlciB6a0hhbmRsZSA9IHprLmdldCgpOwog\nICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gemtIYW5kbGUpIHsKICAgICAg\nICAgICAgICAgICAgICBab29LZWVwZXJDbGllbnQuc3VwZXIuZ2V0Q2hpbGRy\nZW4ocGF0aCwgd2F0Y2gsIGNoaWxkQ2IsIHdvcmtlcik7CiAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHprSGFuZGxlLmdl\ndENoaWxkcmVuKHBhdGgsIHdhdGNoLCBjaGlsZENiLCB3b3JrZXIpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAg\nICAvLyBleGVjdXRlIGl0IGltbWVkaWF0ZWx5CiAgICAgICAgcHJvYy5ydW4o\nKTsKICAgIH0KCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTGlzdDxTdHJp\nbmc+IGdldENoaWxkcmVuKGZpbmFsIFN0cmluZyBwYXRoLCBmaW5hbCBXYXRj\naGVyIHdhdGNoZXIpCiAgICAgICAgICAgIHRocm93cyBLZWVwZXJFeGNlcHRp\nb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gWm9v\nV29ya2VyLnN5bmNDYWxsV2l0aFJldHJpZXModGhpcywgbmV3IFpvb0NhbGxh\nYmxlPExpc3Q8U3RyaW5nPj4oKSB7CgogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIExpc3Q8U3RyaW5nPiBjYWxsKCkgdGhyb3dz\nIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgWm9vS2VlcGVyIHprSGFuZGxlID0gemsuZ2V0KCk7CiAg\nICAgICAgICAgICAgICBpZiAobnVsbCA9PSB6a0hhbmRsZSkgewogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBab29LZWVwZXJDbGllbnQuc3VwZXIuZ2V0\nQ2hpbGRyZW4ocGF0aCwgd2F0Y2hlcik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICByZXR1cm4gemtIYW5kbGUuZ2V0Q2hpbGRyZW4ocGF0\naCwgd2F0Y2hlcik7CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwgb3BlcmF0\naW9uUmV0cnlQb2xpY3kpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIExpc3Q8U3RyaW5nPiBnZXRDaGlsZHJlbihmaW5hbCBTdHJpbmcgcGF0\naCwgZmluYWwgYm9vbGVhbiB3YXRjaCkKICAgICAgICAgICAgdGhyb3dzIEtl\nZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAg\nIHJldHVybiBab29Xb3JrZXIuc3luY0NhbGxXaXRoUmV0cmllcyh0aGlzLCBu\nZXcgWm9vQ2FsbGFibGU8TGlzdDxTdHJpbmc+PigpIHsKCiAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgTGlzdDxTdHJpbmc+IGNh\nbGwoKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5kbGUgPSB6\nay5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHprSGFuZGxl\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFpvb0tlZXBlckNsaWVu\ndC5zdXBlci5nZXRDaGlsZHJlbihwYXRoLCB3YXRjaCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gemtIYW5kbGUuZ2V0Q2hp\nbGRyZW4ocGF0aCwgd2F0Y2gpOwogICAgICAgICAgICB9CgogICAgICAgIH0s\nIG9wZXJhdGlvblJldHJ5UG9saWN5KTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIGdldENoaWxkcmVuKGZpbmFsIFN0cmluZyBwYXRo\nLCBmaW5hbCBXYXRjaGVyIHdhdGNoZXIsCiAgICAgICAgICAgIGZpbmFsIENo\naWxkcmVuQ2FsbGJhY2sgY2IsIGZpbmFsIE9iamVjdCBjb250ZXh0KSB7CiAg\nICAgICAgZmluYWwgUnVubmFibGUgcHJvYyA9IG5ldyBSZXRyeVJ1bm5hYmxl\nKG9wZXJhdGlvblJldHJ5UG9saWN5KSB7CgogICAgICAgICAgICBmaW5hbCBD\naGlsZHJlbkNhbGxiYWNrIGNoaWxkQ2IgPSBuZXcgQ2hpbGRyZW5DYWxsYmFj\naygpIHsKCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcg\ncGF0aCwgT2JqZWN0IGN0eCwKICAgICAgICAgICAgICAgICAgICAgICAgTGlz\ndDxTdHJpbmc+IGNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICAgICAgWm9v\nV29ya2VyIHdvcmtlciA9IChab29Xb3JrZXIpY3R4OwogICAgICAgICAgICAg\nICAgICAgIGlmICh3b3JrZXIuYWxsb3dSZXRyeShyYykpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0cnlFeGVjdXRvci5zY2hlZHVsZSh0aGF0LCB3\nb3JrZXIubmV4dFJldHJ5V2FpdFRpbWUoKSwgVGltZVVuaXQuTUlMTElTRUNP\nTkRTKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgICAgICAgICBjYi5wcm9jZXNzUmVzdWx0KHJjLCBwYXRoLCBjb250\nZXh0LCBjaGlsZHJlbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAg\nICAgICAgICBab29LZWVwZXIgemtIYW5kbGUgPSB6ay5nZXQoKTsKICAgICAg\nICAgICAgICAgIGlmIChudWxsID09IHprSGFuZGxlKSB7CiAgICAgICAgICAg\nICAgICAgICAgWm9vS2VlcGVyQ2xpZW50LnN1cGVyLmdldENoaWxkcmVuKHBh\ndGgsIHdhdGNoZXIsIGNoaWxkQ2IsIHdvcmtlcik7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHprSGFuZGxlLmdldENo\naWxkcmVuKHBhdGgsIHdhdGNoZXIsIGNoaWxkQ2IsIHdvcmtlcik7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAg\nIC8vIGV4ZWN1dGUgaXQgaW1tZWRpYXRlbHkKICAgICAgICBwcm9jLnJ1bigp\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgZ2V0Q2hp\nbGRyZW4oZmluYWwgU3RyaW5nIHBhdGgsIGZpbmFsIGJvb2xlYW4gd2F0Y2gs\nCiAgICAgICAgICAgIGZpbmFsIENoaWxkcmVuQ2FsbGJhY2sgY2IsIGZpbmFs\nIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgZmluYWwgUnVubmFibGUgcHJv\nYyA9IG5ldyBSZXRyeVJ1bm5hYmxlKG9wZXJhdGlvblJldHJ5UG9saWN5KSB7\nCgogICAgICAgICAgICBmaW5hbCBDaGlsZHJlbkNhbGxiYWNrIGNoaWxkQ2Ig\nPSBuZXcgQ2hpbGRyZW5DYWxsYmFjaygpIHsKCiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NS\nZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwKICAgICAg\nICAgICAgICAgICAgICAgICAgTGlzdDxTdHJpbmc+IGNoaWxkcmVuKSB7CiAg\nICAgICAgICAgICAgICAgICAgWm9vV29ya2VyIHdvcmtlciA9IChab29Xb3Jr\nZXIpY3R4OwogICAgICAgICAgICAgICAgICAgIGlmICh3b3JrZXIuYWxsb3dS\nZXRyeShyYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnlFeGVj\ndXRvci5zY2hlZHVsZSh0aGF0LCB3b3JrZXIubmV4dFJldHJ5V2FpdFRpbWUo\nKSwgVGltZVVuaXQuTUlMTElTRUNPTkRTKTsKICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBjYi5wcm9jZXNz\nUmVzdWx0KHJjLCBwYXRoLCBjb250ZXh0LCBjaGlsZHJlbik7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nfTsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\ndm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBab29LZWVwZXIgemtIYW5k\nbGUgPSB6ay5nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChudWxsID09IHpr\nSGFuZGxlKSB7CiAgICAgICAgICAgICAgICAgICAgWm9vS2VlcGVyQ2xpZW50\nLnN1cGVyLmdldENoaWxkcmVuKHBhdGgsIHdhdGNoLCBjaGlsZENiLCB3b3Jr\nZXIpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICB6a0hhbmRsZS5nZXRDaGlsZHJlbihwYXRoLCB3YXRjaCwgY2hpbGRD\nYiwgd29ya2VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH07CiAgICAgICAgLy8gZXhlY3V0ZSBpdCBpbW1lZGlhdGVseQog\nICAgICAgIHByb2MucnVuKCk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

