{"sha":"0d6e592b629b96764255df74e3e4097d741e01fd","node_id":"MDQ6QmxvYjE1NzU5NTY6MGQ2ZTU5MmI2MjliOTY3NjQyNTVkZjc0ZTNlNDA5N2Q3NDFlMDFmZA==","size":27843,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0d6e592b629b96764255df74e3e4097d741e01fd","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZTsKCmlt\ncG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRFcXVhbHM7Cmlt\ncG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRGYWxzZTsKaW1w\nb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0LmZhaWw7CgppbXBvcnQgamF2\nYS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0\nIGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGphdmEubmlvLkJ5\ndGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxlQ2hhbm5l\nbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwu\nUmFuZG9tOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQ2xpZW50VXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jb25mLlRlc3RCS0NvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5JT1V0aWxzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuWmVyb0J1ZmZlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9y\neTsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgc3RhdGljIG9yZy5q\ndW5pdC5Bc3NlcnQuKjsKCnB1YmxpYyBjbGFzcyBCb29raWVKb3VybmFsVGVz\ndCB7CiAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va2llSm91cm5hbFRlc3QuY2xhc3Mp\nOwoKICAgIGZpbmFsIFJhbmRvbSByID0gbmV3IFJhbmRvbShTeXN0ZW0uY3Vy\ncmVudFRpbWVNaWxsaXMoKSk7CgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlSW5k\nZXhGaWxlRm9yTGVkZ2VyKEZpbGUgaW5kZXhEaXIsIGxvbmcgbGVkZ2VySWQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnl0\nZVtdIG1hc3RlcktleSkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgRmlsZSBmbiA9IG5ldyBGaWxlKGluZGV4RGlyLCBJbmRleFBl\ncnNpc3RlbmNlTWdyLmdldExlZGdlck5hbWUobGVkZ2VySWQpKTsKICAgICAg\nICBmbi5nZXRQYXJlbnRGaWxlKCkubWtkaXJzKCk7CiAgICAgICAgRmlsZUlu\nZm8gZmkgPSBuZXcgRmlsZUluZm8oZm4sIG1hc3RlcktleSk7CiAgICAgICAg\nLy8gZm9yY2UgY3JlYXRpb24gb2YgaW5kZXggZmlsZQogICAgICAgIGZpLndy\naXRlKG5ldyBCeXRlQnVmZmVyW117IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMCkg\nfSwgMCk7CiAgICAgICAgZmkuY2xvc2UodHJ1ZSk7CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIHdyaXRlUGFydGlhbEluZGV4RmlsZUZvckxlZGdlcihGaWxl\nIGluZGV4RGlyLCBsb25nIGxlZGdlcklkLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBieXRlW10gbWFzdGVyS2V5\nLCBib29sZWFuIHRydW5jYXRlVG9NYXN0ZXJLZXkpCiAgICAgICAgICAgIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgZm4gPSBuZXcgRmlsZShp\nbmRleERpciwgSW5kZXhQZXJzaXN0ZW5jZU1nci5nZXRMZWRnZXJOYW1lKGxl\nZGdlcklkKSk7CiAgICAgICAgZm4uZ2V0UGFyZW50RmlsZSgpLm1rZGlycygp\nOwogICAgICAgIEZpbGVJbmZvIGZpID0gbmV3IEZpbGVJbmZvKGZuLCBtYXN0\nZXJLZXkpOwogICAgICAgIC8vIGZvcmNlIGNyZWF0aW9uIG9mIGluZGV4IGZp\nbGUKICAgICAgICBmaS53cml0ZShuZXcgQnl0ZUJ1ZmZlcltdeyBCeXRlQnVm\nZmVyLmFsbG9jYXRlKDApIH0sIDApOwogICAgICAgIGZpLmNsb3NlKHRydWUp\nOwogICAgICAgIC8vIGZpbGUgaW5mbyBoZWFkZXIKICAgICAgICBpbnQgaGVh\nZGVyTGVuID0gOCArIDQgKyBtYXN0ZXJLZXkubGVuZ3RoOwogICAgICAgIC8v\nIHRydW5jYXRlIHRoZSBpbmRleCBmaWxlCiAgICAgICAgaW50IGxlZnRTaXpl\nOwogICAgICAgIGlmICh0cnVuY2F0ZVRvTWFzdGVyS2V5KSB7CiAgICAgICAg\nICAgIGxlZnRTaXplID0gci5uZXh0SW50KGhlYWRlckxlbik7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgbGVmdFNpemUgPSBoZWFkZXJMZW4gKyBy\nLm5leHRJbnQoMTAyNCAtIGhlYWRlckxlbik7CiAgICAgICAgfQogICAgICAg\nIEZpbGVDaGFubmVsIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUoZm4sICJy\ndyIpLmdldENoYW5uZWwoKTsKICAgICAgICBmYy50cnVuY2F0ZShsZWZ0U2l6\nZSk7CiAgICAgICAgZmMuY2xvc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEdlbmVyYXRlIGZlbmNlIGVudHJ5CiAgICAgKi8KICAgIHByaXZhdGUgQnl0\nZUJ1ZmZlciBnZW5lcmF0ZUZlbmNlRW50cnkobG9uZyBsZWRnZXJJZCkgewog\nICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDgg\nKyA4KTsKICAgICAgICBiYi5wdXRMb25nKGxlZGdlcklkKTsKICAgICAgICBi\nYi5wdXRMb25nKEJvb2tpZS5NRVRBRU5UUllfSURfRkVOQ0VfS0VZKTsKICAg\nICAgICBiYi5mbGlwKCk7CiAgICAgICAgcmV0dXJuIGJiOwogICAgfQoKICAg\nIC8qKgogICAgICogR2VuZXJhdGUgbWV0YSBlbnRyeSB3aXRoIGdpdmVuIG1h\nc3RlciBrZXkKICAgICAqLwogICAgcHJpdmF0ZSBCeXRlQnVmZmVyIGdlbmVy\nYXRlTWV0YUVudHJ5KGxvbmcgbGVkZ2VySWQsIGJ5dGVbXSBtYXN0ZXJLZXkp\nIHsKICAgICAgICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci5hbGxvY2F0\nZSg4ICsgOCArIDQgKyBtYXN0ZXJLZXkubGVuZ3RoKTsKICAgICAgICBiYi5w\ndXRMb25nKGxlZGdlcklkKTsKICAgICAgICBiYi5wdXRMb25nKEJvb2tpZS5N\nRVRBRU5UUllfSURfTEVER0VSX0tFWSk7CiAgICAgICAgYmIucHV0SW50KG1h\nc3RlcktleS5sZW5ndGgpOwogICAgICAgIGJiLnB1dChtYXN0ZXJLZXkpOwog\nICAgICAgIGJiLmZsaXAoKTsKICAgICAgICByZXR1cm4gYmI7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIHdyaXRlSnVua0pvdXJuYWwoRmlsZSBqb3VybmFs\nRGlyKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGxvZ0lkID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgRmlsZSBmbiA9\nIG5ldyBGaWxlKGpvdXJuYWxEaXIsIExvbmcudG9IZXhTdHJpbmcobG9nSWQp\nICsgIi50eG4iKTsKCiAgICAgICAgRmlsZUNoYW5uZWwgZmMgPSBuZXcgUmFu\nZG9tQWNjZXNzRmlsZShmbiwgInJ3IikuZ2V0Q2hhbm5lbCgpOwoKICAgICAg\nICBCeXRlQnVmZmVyIHplcm9zID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg1MTIp\nOwogICAgICAgIGZjLndyaXRlKHplcm9zLCA0KjEwMjQqMTAyNCk7CiAgICAg\nICAgZmMucG9zaXRpb24oMCk7CgogICAgICAgIGZvciAoaW50IGkgPSAxOyBp\nIDw9IDEwOyBpKyspIHsKICAgICAgICAgICAgZmMud3JpdGUoQnl0ZUJ1ZmZl\nci53cmFwKCJKdW5rSnVua0p1bmsiLmdldEJ5dGVzKCkpKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHdyaXRlUHJlVjJKb3VybmFsKEZp\nbGUgam91cm5hbERpciwgaW50IG51bUVudHJpZXMpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGxvbmcgbG9nSWQgPSBTeXN0ZW0uY3VycmVudFRpbWVN\naWxsaXMoKTsKICAgICAgICBGaWxlIGZuID0gbmV3IEZpbGUoam91cm5hbERp\nciwgTG9uZy50b0hleFN0cmluZyhsb2dJZCkgKyAiLnR4biIpOwoKICAgICAg\nICBGaWxlQ2hhbm5lbCBmYyA9IG5ldyBSYW5kb21BY2Nlc3NGaWxlKGZuLCAi\ncnciKS5nZXRDaGFubmVsKCk7CgogICAgICAgIEJ5dGVCdWZmZXIgemVyb3Mg\nPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDUxMik7CiAgICAgICAgZmMud3JpdGUo\nemVyb3MsIDQqMTAyNCoxMDI0KTsKICAgICAgICBmYy5wb3NpdGlvbigwKTsK\nCiAgICAgICAgYnl0ZVtdIGRhdGEgPSAiSm91cm5hbFRlc3REYXRhIi5nZXRC\neXRlcygpOwogICAgICAgIGxvbmcgbGFzdENvbmZpcm1lZCA9IExlZGdlckhh\nbmRsZS5JTlZBTElEX0VOVFJZX0lEOwogICAgICAgIGZvciAoaW50IGkgPSAx\nOyBpIDw9IG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAgICBCeXRlQnVm\nZmVyIHBhY2tldCA9IENsaWVudFV0aWwuZ2VuZXJhdGVQYWNrZXQoMSwgaSwg\nbGFzdENvbmZpcm1lZCwgaSpkYXRhLmxlbmd0aCwgZGF0YSkudG9CeXRlQnVm\nZmVyKCk7CiAgICAgICAgICAgIGxhc3RDb25maXJtZWQgPSBpOwogICAgICAg\nICAgICBCeXRlQnVmZmVyIGxlbkJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRl\nKDQpOwogICAgICAgICAgICBsZW5CdWZmLnB1dEludChwYWNrZXQucmVtYWlu\naW5nKCkpOwogICAgICAgICAgICBsZW5CdWZmLmZsaXAoKTsKCiAgICAgICAg\nICAgIGZjLndyaXRlKGxlbkJ1ZmYpOwogICAgICAgICAgICBmYy53cml0ZShw\nYWNrZXQpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2\nb2lkIG1vdmVUb1Bvc2l0aW9uKEpvdXJuYWxDaGFubmVsIGpjLCBsb25nIHBv\ncykgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBqYy5mYy5wb3NpdGlv\nbihwb3MpOwogICAgICAgIGpjLmJjLnBvc2l0aW9uID0gcG9zOwogICAgICAg\nIGpjLmJjLndyaXRlQnVmZmVyU3RhcnRQb3NpdGlvbi5zZXQocG9zKTsKICAg\nIH0KCiAgICBwcml2YXRlIHN0YXRpYyB2b2lkIHVwZGF0ZUpvdXJuYWxWZXJz\naW9uKEpvdXJuYWxDaGFubmVsIGpjLCBpbnQgam91cm5hbFZlcnNpb24pIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBwcmV2UG9zID0gamMu\nZmMucG9zaXRpb24oKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCeXRl\nQnVmZmVyIHZlcnNpb25CdWZmZXIgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQp\nOwogICAgICAgICAgICB2ZXJzaW9uQnVmZmVyLnB1dEludChqb3VybmFsVmVy\nc2lvbik7CiAgICAgICAgICAgIHZlcnNpb25CdWZmZXIuZmxpcCgpOwogICAg\nICAgICAgICBqYy5mYy5wb3NpdGlvbig0KTsKICAgICAgICAgICAgSU9VdGls\ncy53cml0ZUZ1bGx5KGpjLmZjLCB2ZXJzaW9uQnVmZmVyKTsKICAgICAgICAg\nICAgamMuZmMuZm9yY2UodHJ1ZSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgamMuZmMucG9zaXRpb24ocHJldlBvcyk7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgSm91cm5hbENoYW5uZWwgd3JpdGVWMkpvdXJu\nYWwoRmlsZSBqb3VybmFsRGlyLCBpbnQgbnVtRW50cmllcykgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gbmV3\nIEpvdXJuYWxDaGFubmVsKGpvdXJuYWxEaXIsIGxvZ0lkKTsKCiAgICAgICAg\nbW92ZVRvUG9zaXRpb24oamMsIEpvdXJuYWxDaGFubmVsLlZFUlNJT05fSEVB\nREVSX1NJWkUpOwoKICAgICAgICBCdWZmZXJlZENoYW5uZWwgYmMgPSBqYy5n\nZXRCdWZmZXJlZENoYW5uZWwoKTsKCiAgICAgICAgYnl0ZVtdIGRhdGEgPSBu\nZXcgYnl0ZVsxMDI0XTsKICAgICAgICBBcnJheXMuZmlsbChkYXRhLCAoYnl0\nZSknWCcpOwogICAgICAgIGxvbmcgbGFzdENvbmZpcm1lZCA9IExlZGdlckhh\nbmRsZS5JTlZBTElEX0VOVFJZX0lEOwogICAgICAgIGZvciAoaW50IGkgPSAx\nOyBpIDw9IG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAgICBCeXRlQnVm\nZmVyIHBhY2tldCA9IENsaWVudFV0aWwuZ2VuZXJhdGVQYWNrZXQoMSwgaSwg\nbGFzdENvbmZpcm1lZCwgaSpkYXRhLmxlbmd0aCwgZGF0YSkudG9CeXRlQnVm\nZmVyKCk7CiAgICAgICAgICAgIGxhc3RDb25maXJtZWQgPSBpOwogICAgICAg\nICAgICBCeXRlQnVmZmVyIGxlbkJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRl\nKDQpOwogICAgICAgICAgICBsZW5CdWZmLnB1dEludChwYWNrZXQucmVtYWlu\naW5nKCkpOwogICAgICAgICAgICBsZW5CdWZmLmZsaXAoKTsKCiAgICAgICAg\nICAgIGJjLndyaXRlKGxlbkJ1ZmYpOwogICAgICAgICAgICBiYy53cml0ZShw\nYWNrZXQpOwogICAgICAgIH0KICAgICAgICBiYy5mbHVzaCh0cnVlKTsKCiAg\nICAgICAgdXBkYXRlSm91cm5hbFZlcnNpb24oamMsIEpvdXJuYWxDaGFubmVs\nLlYyKTsKCiAgICAgICAgcmV0dXJuIGpjOwogICAgfQoKICAgIHByaXZhdGUg\nSm91cm5hbENoYW5uZWwgd3JpdGVWM0pvdXJuYWwoRmlsZSBqb3VybmFsRGly\nLCBpbnQgbnVtRW50cmllcywgYnl0ZVtdIG1hc3RlcktleSkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gbmV3\nIEpvdXJuYWxDaGFubmVsKGpvdXJuYWxEaXIsIGxvZ0lkKTsKCiAgICAgICAg\nbW92ZVRvUG9zaXRpb24oamMsIEpvdXJuYWxDaGFubmVsLlZFUlNJT05fSEVB\nREVSX1NJWkUpOwoKICAgICAgICBCdWZmZXJlZENoYW5uZWwgYmMgPSBqYy5n\nZXRCdWZmZXJlZENoYW5uZWwoKTsKCiAgICAgICAgYnl0ZVtdIGRhdGEgPSBu\nZXcgYnl0ZVsxMDI0XTsKICAgICAgICBBcnJheXMuZmlsbChkYXRhLCAoYnl0\nZSknWCcpOwogICAgICAgIGxvbmcgbGFzdENvbmZpcm1lZCA9IExlZGdlckhh\nbmRsZS5JTlZBTElEX0VOVFJZX0lEOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDw9IG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAgICBCeXRlQnVm\nZmVyIHBhY2tldDsKICAgICAgICAgICAgaWYgKGkgPT0gMCkgewogICAgICAg\nICAgICAgICAgcGFja2V0ID0gZ2VuZXJhdGVNZXRhRW50cnkoMSwgbWFzdGVy\nS2V5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHBh\nY2tldCA9IENsaWVudFV0aWwuZ2VuZXJhdGVQYWNrZXQoMSwgaSwgbGFzdENv\nbmZpcm1lZCwgaSpkYXRhLmxlbmd0aCwgZGF0YSkudG9CeXRlQnVmZmVyKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IGk7\nCiAgICAgICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIu\nYWxsb2NhdGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50KHBhY2tl\ndC5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwoK\nICAgICAgICAgICAgYmMud3JpdGUobGVuQnVmZik7CiAgICAgICAgICAgIGJj\nLndyaXRlKHBhY2tldCk7CiAgICAgICAgfQogICAgICAgIGJjLmZsdXNoKHRy\ndWUpOwoKICAgICAgICB1cGRhdGVKb3VybmFsVmVyc2lvbihqYywgSm91cm5h\nbENoYW5uZWwuVjMpOwoKICAgICAgICByZXR1cm4gamM7CiAgICB9CgogICAg\ncHJpdmF0ZSBKb3VybmFsQ2hhbm5lbCB3cml0ZVY0Sm91cm5hbChGaWxlIGpv\ndXJuYWxEaXIsIGludCBudW1FbnRyaWVzLCBieXRlW10gbWFzdGVyS2V5KSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGxvZ0lkID0gU3lzdGVt\nLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgSm91cm5hbENoYW5uZWwg\namMgPSBuZXcgSm91cm5hbENoYW5uZWwoam91cm5hbERpciwgbG9nSWQpOwoK\nICAgICAgICBtb3ZlVG9Qb3NpdGlvbihqYywgSm91cm5hbENoYW5uZWwuVkVS\nU0lPTl9IRUFERVJfU0laRSk7CgogICAgICAgIEJ1ZmZlcmVkQ2hhbm5lbCBi\nYyA9IGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpOwoKICAgICAgICBieXRlW10g\nZGF0YSA9IG5ldyBieXRlWzEwMjRdOwogICAgICAgIEFycmF5cy5maWxsKGRh\ndGEsIChieXRlKSdYJyk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0g\nTGVkZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPD0gbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAg\nIEJ5dGVCdWZmZXIgcGFja2V0OwogICAgICAgICAgICBpZiAoaSA9PSAwKSB7\nCiAgICAgICAgICAgICAgICBwYWNrZXQgPSBnZW5lcmF0ZU1ldGFFbnRyeSgx\nLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgcGFja2V0ID0gQ2xpZW50VXRpbC5nZW5lcmF0ZVBhY2tldCgxLCBp\nLCBsYXN0Q29uZmlybWVkLCBpICogZGF0YS5sZW5ndGgsIGRhdGEpLnRvQnl0\nZUJ1ZmZlcigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxhc3RDb25m\naXJtZWQgPSBpOwogICAgICAgICAgICBCeXRlQnVmZmVyIGxlbkJ1ZmYgPSBC\neXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAgICBsZW5CdWZmLnB1\ndEludChwYWNrZXQucmVtYWluaW5nKCkpOwogICAgICAgICAgICBsZW5CdWZm\nLmZsaXAoKTsKICAgICAgICAgICAgYmMud3JpdGUobGVuQnVmZik7CiAgICAg\nICAgICAgIGJjLndyaXRlKHBhY2tldCk7CiAgICAgICAgfQogICAgICAgIC8v\nIHdyaXRlIGZlbmNlIGtleQogICAgICAgIEJ5dGVCdWZmZXIgcGFja2V0ID0g\nZ2VuZXJhdGVGZW5jZUVudHJ5KDEpOwogICAgICAgIEJ5dGVCdWZmZXIgbGVu\nQnVmID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICBsZW5CdWYu\ncHV0SW50KHBhY2tldC5yZW1haW5pbmcoKSk7CiAgICAgICAgbGVuQnVmLmZs\naXAoKTsKICAgICAgICBiYy53cml0ZShsZW5CdWYpOwogICAgICAgIGJjLndy\naXRlKHBhY2tldCk7CiAgICAgICAgYmMuZmx1c2godHJ1ZSk7CiAgICAgICAg\ndXBkYXRlSm91cm5hbFZlcnNpb24oamMsIEpvdXJuYWxDaGFubmVsLlY0KTsK\nICAgICAgICByZXR1cm4gamM7CiAgICB9CgogICAgcHJpdmF0ZSBKb3VybmFs\nQ2hhbm5lbCB3cml0ZVY1Sm91cm5hbChGaWxlIGpvdXJuYWxEaXIsIGludCBu\ndW1FbnRyaWVzLCBieXRlW10gbWFzdGVyS2V5KSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBsb25nIGxvZ0lkID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCk7CiAgICAgICAgSm91cm5hbENoYW5uZWwgamMgPSBuZXcgSm91cm5h\nbENoYW5uZWwoam91cm5hbERpciwgbG9nSWQpOwoKICAgICAgICBCdWZmZXJl\nZENoYW5uZWwgYmMgPSBqYy5nZXRCdWZmZXJlZENoYW5uZWwoKTsKCiAgICAg\nICAgQnl0ZUJ1ZmZlciBwYWRkaW5nQnVmZiA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGVEaXJlY3QoMiAqIEpvdXJuYWxDaGFubmVsLlNFQ1RPUl9TSVpFKTsKICAg\nICAgICBaZXJvQnVmZmVyLnB1dChwYWRkaW5nQnVmZik7CiAgICAgICAgYnl0\nZVtdIGRhdGEgPSBuZXcgYnl0ZVs0ICogMTAyNCAqIDEwMjRdOwogICAgICAg\nIEFycmF5cy5maWxsKGRhdGEsIChieXRlKSdYJyk7CiAgICAgICAgbG9uZyBs\nYXN0Q29uZmlybWVkID0gTGVkZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQ7\nCiAgICAgICAgbG9uZyBsZW5ndGggPSAwOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDw9IG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAgICBCeXRl\nQnVmZmVyIHBhY2tldDsKICAgICAgICAgICAgaWYgKGkgPT0gMCkgewogICAg\nICAgICAgICAgICAgcGFja2V0ID0gZ2VuZXJhdGVNZXRhRW50cnkoMSwgbWFz\ndGVyS2V5KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIHBhY2tldCA9IENsaWVudFV0aWwuZ2VuZXJhdGVQYWNrZXQoMSwgaSwgbGFz\ndENvbmZpcm1lZCwKICAgICAgICAgICAgICAgICAgICAgICAgbGVuZ3RoLCBk\nYXRhLCAwLCBpKS50b0J5dGVCdWZmZXIoKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBsYXN0Q29uZmlybWVkID0gaTsKICAgICAgICAgICAgbGVuZ3Ro\nICs9IGk7CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVC\ndWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50\nKHBhY2tldC5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxp\ncCgpOwogICAgICAgICAgICBiYy53cml0ZShsZW5CdWZmKTsKICAgICAgICAg\nICAgYmMud3JpdGUocGFja2V0KTsKICAgICAgICAgICAgSm91cm5hbC53cml0\nZVBhZGRpbmdCeXRlcyhqYywgcGFkZGluZ0J1ZmYsIEpvdXJuYWxDaGFubmVs\nLlNFQ1RPUl9TSVpFKTsKICAgICAgICB9CiAgICAgICAgLy8gd3JpdGUgZmVu\nY2Uga2V5CiAgICAgICAgQnl0ZUJ1ZmZlciBwYWNrZXQgPSBnZW5lcmF0ZUZl\nbmNlRW50cnkoMSk7CiAgICAgICAgQnl0ZUJ1ZmZlciBsZW5CdWYgPSBCeXRl\nQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgIGxlbkJ1Zi5wdXRJbnQocGFj\na2V0LnJlbWFpbmluZygpKTsKICAgICAgICBsZW5CdWYuZmxpcCgpOwogICAg\nICAgIGJjLndyaXRlKGxlbkJ1Zik7CiAgICAgICAgYmMud3JpdGUocGFja2V0\nKTsKICAgICAgICBKb3VybmFsLndyaXRlUGFkZGluZ0J5dGVzKGpjLCBwYWRk\naW5nQnVmZiwgSm91cm5hbENoYW5uZWwuU0VDVE9SX1NJWkUpOwogICAgICAg\nIGJjLmZsdXNoKHRydWUpOwogICAgICAgIHVwZGF0ZUpvdXJuYWxWZXJzaW9u\nKGpjLCBKb3VybmFsQ2hhbm5lbC5WNSk7CiAgICAgICAgcmV0dXJuIGpjOwog\nICAgfQoKICAgIC8qKgogICAgICogdGVzdCB0aGF0IHdlIGNhbiBvcGVuIGEg\nam91cm5hbCB3cml0dGVuIHdpdGhvdXQgdGhlIG1hZ2ljCiAgICAgKiB3b3Jk\nIGF0IHRoZSBzdGFydC4gVGhpcyBpcyBmb3IgdmVyc2lvbnMgb2YgYm9va2tl\nZXBlciBiZWZvcmUKICAgICAqIHRoZSBtYWdpYyB3b3JkIHdhcyBpbnRyb2R1\nY2VkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0UHJlVjJKb3VybmFsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVUZW1wRmls\nZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFsRGlyLmRl\nbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAgICAgICBC\nb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJl\nbnREaXJlY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxlIGxlZGdl\nckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIi\nKTsKICAgICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2Vy\nRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3Ry\ndWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpcikp\nOwoKICAgICAgICB3cml0ZVByZVYySm91cm5hbChCb29raWUuZ2V0Q3VycmVu\ndERpcmVjdG9yeShqb3VybmFsRGlyKSwgMTAwKTsKICAgICAgICB3cml0ZUlu\nZGV4RmlsZUZvckxlZGdlcihCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShs\nZWRnZXJEaXIpLCAxLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CgogICAg\nICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3Vy\nYXRpb24ubmV3U2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5z\nZXRaa1NlcnZlcnMobnVsbCkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJO\nYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0TGVk\nZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgo\nKSB9KTsKCiAgICAgICAgQm9va2llIGIgPSBuZXcgQm9va2llKGNvbmYpOwog\nICAgICAgIGIucmVhZEpvdXJuYWwoKTsKCiAgICAgICAgYi5yZWFkRW50cnko\nMSwgMTAwKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBiLnJlYWRFbnRy\neSgxLCAxMDEpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgaGF2ZSBm\nb3VuZCBlbnRyeSAxMDEiKTsKICAgICAgICB9IGNhdGNoIChCb29raWUuTm9F\nbnRyeUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVo\nYXZpb3VyCiAgICAgICAgfQoKICAgICAgICBiLnNodXRkb3duKCk7CiAgICB9\nCgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RWNEpvdXJuYWwoKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBG\naWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAg\nICAgIGpvdXJuYWxEaXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5t\na2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVy\nZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7Cgog\nICAgICAgIEZpbGUgbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgi\nYm9va2llIiwgImxlZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUo\nKTsKICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUu\nY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJl\nY3RvcnkobGVkZ2VyRGlyKSk7CgogICAgICAgIHdyaXRlVjRKb3VybmFsKEJv\nb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAxMDAsICJ0\nZXN0UGFzc3dkIi5nZXRCeXRlcygpKTsKCiAgICAgICAgU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mID0gVGVzdEJLQ29uZmlndXJhdGlvbi5uZXdTZXJ2ZXJD\nb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxs\nKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5n\nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcg\nU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBC\nb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgYi5yZWFkSm91\ncm5hbCgpOwoKICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGIucmVhZEVudHJ5KDEsIDEwMSk7CiAgICAg\nICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEwMSIp\nOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9\nCiAgICAgICAgYXNzZXJ0VHJ1ZShiLmhhbmRsZXMuZ2V0SGFuZGxlKDEsICJ0\nZXN0UGFzc3dkIi5nZXRCeXRlcygpKS5pc0ZlbmNlZCgpKTsKCiAgICAgICAg\nYi5zaHV0ZG93bigpOwogICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9p\nZCB0ZXN0VjVKb3VybmFsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2ll\nIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFsRGlyLmRlbGV0ZSgpOwog\nICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hl\nY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxlIGxlZGdlckRpciA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsKICAgICAg\nICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGly\nKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJv\nb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpcikpOwoKICAgICAg\nICB3cml0ZVY1Sm91cm5hbChCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShq\nb3VybmFsRGlyKSwgMiAqIEpvdXJuYWxDaGFubmVsLlNFQ1RPUl9TSVpFLAog\nICAgICAgICAgICAgICAgInRlc3RWNUpvdXJuYWwiLmdldEJ5dGVzKCkpOwoK\nICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBUZXN0QktDb25m\naWd1cmF0aW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAg\nICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAgICAgLnNl\ndEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQogICAgICAg\nICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxl\nZGdlckRpci5nZXRQYXRoKCkgfSk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3\nIEJvb2tpZShjb25mKTsKICAgICAgICBiLnJlYWRKb3VybmFsKCk7CgogICAg\nICAgIGZvciAoaW50IGkgPSAxOyBpIDw9IDIgKiBKb3VybmFsQ2hhbm5lbC5T\nRUNUT1JfU0laRTsgaSsrKSB7CiAgICAgICAgICAgIGIucmVhZEVudHJ5KDEs\nIGkpOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBiLnJl\nYWRFbnRyeSgxLCAyICogSm91cm5hbENoYW5uZWwuU0VDVE9SX1NJWkUgKyAx\nKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgZm91bmQgZW50\ncnkgIiArICgyICogSm91cm5hbENoYW5uZWwuU0VDVE9SX1NJWkUgKyAxKSk7\nCiAgICAgICAgfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW9yCiAgICAgICAgfQog\nICAgICAgIGFzc2VydFRydWUoYi5oYW5kbGVzLmdldEhhbmRsZSgxLCAidGVz\ndFY1Sm91cm5hbCIuZ2V0Qnl0ZXMoKSkuaXNGZW5jZWQoKSk7CgogICAgICAg\nIGIuc2h1dGRvd24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhh\ndCBpZiB0aGUgam91cm5hbCBpcyBhbGwgam91cm5hbCwgd2UgY2FuIG5vdAog\nICAgICogc3RhcnQgdGhlIGJvb2tpZS4gQW4gYWRtaW4gc2hvdWxkIGxvb2sg\ndG8gc2VlIHdoYXQgaGFzCiAgICAgKiBoYXBwZW5lZCBpbiB0aGlzIGNhc2UK\nICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RBbGxKdW5rSm91cm5hbCgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUo\nImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5hbERpci5kZWxl\ndGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAgICAgQm9v\na2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50\nRGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJE\naXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7\nCiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRp\nci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVj\ndHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJEaXIpKTsK\nCiAgICAgICAgd3JpdGVKdW5rSm91cm5hbChCb29raWUuZ2V0Q3VycmVudERp\ncmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVyQ29u\nZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkK\nICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0\nUGF0aCgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0\ncmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsKICAgICAgICBCb29r\naWUgYiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYiA9IG5l\ndyBCb29raWUoY29uZik7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBo\nYXZlIGJlZW4gYWJsZSB0byBzdGFydCB3aXRob3V0IGFkbWluIik7CiAgICAg\nICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgLy8gY29y\ncmVjdCBiZWhhdmlvdXIKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAoYiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBiLnNodXRkb3du\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUZXN0IHRoYXQgd2UgY2FuIHN0YXJ0IHdpdGggYW4gZW1wdHkgam91\ncm5hbC4KICAgICAqIFRoaXMgY2FuIGhhcHBlbiBpZiB0aGUgYm9va2llIGNy\nYXNoZXMgYmV0d2VlbiBjcmVhdGluZyB0aGUKICAgICAqIGpvdXJuYWwgYW5k\nIHdyaXRpbmcgdGhlIG1hZ2ljIHdvcmQuIEl0IGNvdWxkIGFsc28gaGFwcGVu\nIGJlZm9yZQogICAgICogdGhlIG1hZ2ljIHdvcmQgZXhpc3RlZCwgaWYgdGhl\nIGJvb2tpZSBzdGFydGVkIGJ1dCBub3RoaW5nIHdhcwogICAgICogZXZlciB3\ncml0dGVuLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAg\ncHVibGljIHZvaWQgdGVzdEVtcHR5Sm91cm5hbCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVt\ncEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5hbERp\nci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAg\nICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRD\ndXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBs\nZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVk\nZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxl\nZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9y\neVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJE\naXIpKTsKCiAgICAgICAgd3JpdGVQcmVWMkpvdXJuYWwoQm9va2llLmdldEN1\ncnJlbnREaXJlY3Rvcnkoam91cm5hbERpciksIDApOwoKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBUZXN0QktDb25maWd1cmF0aW9uLm5l\nd1NlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2\nZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3Vy\nbmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNldExlZGdlckRpck5h\nbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7Cgog\nICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgdGhhdCBhIGpvdXJuYWwgY2FuIGxvYWQgaWYg\nb25seSB0aGUgbWFnaWMgd29yZCBhbmQKICAgICAqIHZlcnNpb24gYXJlIHRo\nZXJlLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdEhlYWRlck9ubHlKb3VybmFsKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVU\nZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFs\nRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAg\nICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdl\ndEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxl\nIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJs\nZWRnZXIiKTsKICAgICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAg\nbGVkZ2VyRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0\nb3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdl\nckRpcikpOwoKICAgICAgICB3cml0ZVYySm91cm5hbChCb29raWUuZ2V0Q3Vy\ncmVudERpcmVjdG9yeShqb3VybmFsRGlyKSwgMCk7CgogICAgICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3\nU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZl\ncnMobnVsbCkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJu\nYWxEaXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFt\nZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsKCiAg\nICAgICAgQm9va2llIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGVzdCB0aGF0IGlmIGEgam91cm5hbCBoYXMganVuayBh\ndCB0aGUgZW5kLCBpdCBkb2VzIG5vdCBsb2FkLgogICAgICogSWYgdGhlIGpv\ndXJuYWwgaXMgY29ycnVwdCBsaWtlIHRoaXMsIGFkbWluIGludGVydmVudGlv\nbiBpcyBuZWVkZWQKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RKdW5rRW5kZWRKb3VybmFsKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5j\ncmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAgICAgICBq\nb3VybmFsRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIo\nKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9v\na2llLmdldEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAg\nICBGaWxlIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tp\nZSIsICJsZWRnZXIiKTsKICAgICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAg\nICAgICAgbGVkZ2VyRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNr\nRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5\nKGxlZGdlckRpcikpOwoKICAgICAgICBKb3VybmFsQ2hhbm5lbCBqYyA9IHdy\naXRlVjJKb3VybmFsKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJu\nYWxEaXIpLCAwKTsKICAgICAgICBqYy5nZXRCdWZmZXJlZENoYW5uZWwoKS53\ncml0ZShCeXRlQnVmZmVyLndyYXAoIkp1bmtKdW5rSnVuayIuZ2V0Qnl0ZXMo\nKSkpOwogICAgICAgIGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpLmZsdXNoKHRy\ndWUpOwoKICAgICAgICB3cml0ZUluZGV4RmlsZUZvckxlZGdlcihsZWRnZXJE\naXIsIDEsICJ0ZXN0UGFzc3dkIi5nZXRCeXRlcygpKTsKCiAgICAgICAgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mID0gVGVzdEJLQ29uZmlndXJhdGlvbi5u\nZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFprU2Vy\ndmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91\ncm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJO\nYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoK\nICAgICAgICBCb29raWUgYiA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgfSBjYXRjaCAo\nVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlv\ndXIKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQg\naWYgdGhlIGJvb2tpZSBjcmFzaGVzIHdoaWxlIHdyaXRpbmcgdGhlIGxlbmd0\naAogICAgICogb2YgYW4gZW50cnksIHRoYXQgd2UgY2FuIHJlY292ZXIuCiAg\nICAgKgogICAgICogVGhpcyBpcyBjdXJyZW50bHkgbm90IHRoZSBjYXNlLCB3\naGljaCBpcyBiYWQgYXMgcmVjb3ZlcnkKICAgICAqIHNob3VsZCBiZSBmaW5l\nIGhlcmUuIFRoZSBib29raWUgaGFzIGNyYXNoZWQgd2hpbGUgd3JpdGluZwog\nICAgICogYnV0IHNvIHRoZSBjbGllbnQgaGFzIG5vdCBiZSBub3RpZmllZCBv\nZiBzdWNjZXNzLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdFRydW5jYXRlZEluTGVuSm91cm5hbCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAg\nICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1r\nZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJl\nKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAg\nICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJi\nb29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgp\nOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5j\naGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVj\ndG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgSm91cm5hbENoYW5uZWwgamMg\nPSB3cml0ZVYySm91cm5hbCgKICAgICAgICAgICAgICAgIEJvb2tpZS5nZXRD\ndXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAxMDApOwogICAgICAgIEJ5\ndGVCdWZmZXIgemVyb3MgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDIwNDgpOwoK\nICAgICAgICBqYy5mYy5wb3NpdGlvbihqYy5nZXRCdWZmZXJlZENoYW5uZWwo\nKS5wb3NpdGlvbigpIC0gMHg0MjkpOwogICAgICAgIGpjLmZjLndyaXRlKHpl\ncm9zKTsKICAgICAgICBqYy5mYy5mb3JjZShmYWxzZSk7CgogICAgICAgIHdy\naXRlSW5kZXhGaWxlRm9yTGVkZ2VyKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0\nb3J5KGxlZGdlckRpciksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgMSwgInRlc3RQYXNzd2QiLmdldEJ5dGVzKCkpOwoKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBUZXN0QktDb25maWd1cmF0aW9uLm5l\nd1NlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2\nZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3Vy\nbmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNldExlZGdlckRpck5h\nbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7Cgog\nICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICBi\nLnJlYWRKb3VybmFsKCk7CgogICAgICAgIGIucmVhZEVudHJ5KDEsIDk5KTsK\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYi5yZWFkRW50cnkoMSwgMTAw\nKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgZm91bmQgZW50\ncnkgMTAwIik7CiAgICAgICAgfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiB0\naGUgYm9va2llIGNyYXNoZXMgaW4gdGhlIG1pZGRsZSBvZiB3cml0aW5nCiAg\nICAgKiB0aGUgYWN0dWFsIGVudHJ5IGl0IGNhbiByZWNvdmVyLgogICAgICog\nSW4gdGhpcyBjYXNlIHRoZSBlbnRyeSB3aWxsIGJlIGF2YWlsYWJsZSwgYnV0\nIGl0IHdpbGwgY29ycnVwdC4KICAgICAqIFRoaXMgaXMgb2ssIGFzIHRoZSBj\nbGllbnQgd2lsbCBkaXNyZWdhcmQgdGhlIGVudHJ5IGFmdGVyIGxvb2tpbmcK\nICAgICAqIGF0IGl0cyBjaGVja3N1bS4KICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RUcnVuY2F0ZWRJbkVu\ndHJ5Sm91cm5hbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUg\nam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJq\nb3VybmFsIik7CiAgICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAg\nICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGly\nZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpv\ndXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNy\nZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVk\nZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwog\nICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUu\nZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgSm91\ncm5hbENoYW5uZWwgamMgPSB3cml0ZVYySm91cm5hbCgKICAgICAgICAgICAg\nICAgIEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAx\nMDApOwogICAgICAgIEJ5dGVCdWZmZXIgemVyb3MgPSBCeXRlQnVmZmVyLmFs\nbG9jYXRlKDIwNDgpOwoKICAgICAgICBqYy5mYy5wb3NpdGlvbihqYy5nZXRC\ndWZmZXJlZENoYW5uZWwoKS5wb3NpdGlvbigpIC0gMHgzMDApOwogICAgICAg\nIGpjLmZjLndyaXRlKHplcm9zKTsKICAgICAgICBqYy5mYy5mb3JjZShmYWxz\nZSk7CgogICAgICAgIHdyaXRlSW5kZXhGaWxlRm9yTGVkZ2VyKEJvb2tpZS5n\nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpciksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgMSwgInRlc3RQYXNzd2QiLmdldEJ5dGVzKCkp\nOwoKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBUZXN0QktD\nb25maWd1cmF0aW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAg\nICAgICAuc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3Vy\nbmFsRGlyTmFtZShqb3VybmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAg\nLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5n\nZXRQYXRoKCkgfSk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShj\nb25mKTsKICAgICAgICBiLnJlYWRKb3VybmFsKCk7CiAgICAgICAgYi5yZWFk\nRW50cnkoMSwgOTkpOwoKICAgICAgICAvLyBzdGlsbCBhYmxlIHRvIHJlYWQg\nbGFzdCBlbnRyeSwgYnV0IGl0J3MganVuawogICAgICAgIEJ5dGVCdWZmZXIg\nYnVmID0gYi5yZWFkRW50cnkoMSwgMTAwKTsKICAgICAgICBhc3NlcnRFcXVh\nbHMoIkxlZGdlciBJZCBpcyB3cm9uZyIsIGJ1Zi5nZXRMb25nKCksIDEpOwog\nICAgICAgIGFzc2VydEVxdWFscygiRW50cnkgSWQgaXMgd3JvbmciLCBidWYu\nZ2V0TG9uZygpLCAxMDApOwogICAgICAgIGFzc2VydEVxdWFscygiTGFzdCBj\nb25maXJtZWQgaXMgd3JvbmciLCBidWYuZ2V0TG9uZygpLCA5OSk7CiAgICAg\nICAgYXNzZXJ0RXF1YWxzKCJMZW5ndGggaXMgd3JvbmciLCBidWYuZ2V0TG9u\nZygpLCAxMDAqMTAyNCk7CiAgICAgICAgYnVmLmdldExvbmcoKTsgLy8gc2tp\ncCBjaGVja3N1bQogICAgICAgIGJvb2xlYW4gYWxsWCA9IHRydWU7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDI0OyBpKyspIHsKICAgICAgICAg\nICAgYnl0ZSB4ID0gYnVmLmdldCgpOwogICAgICAgICAgICBhbGxYID0gYWxs\nWCAmJiB4ID09IChieXRlKSdYJzsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0\nRmFsc2UoIlNvbWUgb2YgYnVmZmVyIHNob3VsZCBoYXZlIGJlZW4gemVyb2Vk\nIiwgYWxsWCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGIucmVhZEVu\ndHJ5KDEsIDEwMSk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZl\nIGZvdW5kIGVudHJ5IDEwMSIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5O\nb0VudHJ5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBi\nZWhhdmlvdXIKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0\nIHBhcnRpYWwgaW5kZXggKHRydW5jYXRlIG1hc3RlciBrZXkpIHdpdGggcHJl\nLXYzIGpvdXJuYWxzCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0UGFydGlhbEZpbGVJbmZvUHJlVjNKb3Vy\nbmFsMSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRlc3RQYXJ0aWFs\nRmlsZUluZm9QcmVWM0pvdXJuYWwodHJ1ZSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUZXN0IHBhcnRpYWwgaW5kZXggd2l0aCBwcmUtdjMgam91cm5hbHMK\nICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RQYXJ0aWFsRmlsZUluZm9QcmVWM0pvdXJuYWwyKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgdGVzdFBhcnRpYWxGaWxlSW5mb1ByZVYz\nSm91cm5hbChmYWxzZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHBh\ncnRpYWwgaW5kZXggZmlsZSB3aXRoIHByZS12MyBqb3VybmFscy4KICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHRlc3RQYXJ0aWFsRmlsZUluZm9QcmVWM0pv\ndXJuYWwoYm9vbGVhbiB0cnVuY2F0ZU1hc3RlcktleSkKICAgICAgICB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxl\nLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAg\nIGpvdXJuYWxEaXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2Rp\ncigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShC\nb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAg\nICAgIEZpbGUgbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9v\na2llIiwgImxlZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsK\nICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hl\nY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoam91cm5hbERpcikpOwoKICAgICAgICB3cml0ZVByZVYySm91cm5hbChC\nb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSwgMTAwKTsK\nICAgICAgICB3cml0ZVBhcnRpYWxJbmRleEZpbGVGb3JMZWRnZXIoQm9va2ll\nLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgMSwgInRlc3RQYXNzd2QiLmdl\ndEJ5dGVzKCksIHRydW5jYXRlTWFzdGVyS2V5KTsKCiAgICAgICAgU2VydmVy\nQ29uZmlndXJhdGlvbiBjb25mID0gVGVzdEJLQ29uZmlndXJhdGlvbi5uZXdT\nZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFprU2VydmVy\ncyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5h\nbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1l\ncyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoKICAg\nICAgICBpZiAodHJ1bmNhdGVNYXN0ZXJLZXkpIHsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25m\nKTsKICAgICAgICAgICAgICAgIGIucmVhZEpvdXJuYWwoKTsKICAgICAgICAg\nICAgICAgIGZhaWwoIlNob3VsZCBub3QgcmVhY2ggaGVyZSEiKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAg\nfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEJvb2tpZSBiID0gbmV3\nIEJvb2tpZShjb25mKTsKICAgICAgICAgICAgYi5yZWFkSm91cm5hbCgpOwog\nICAgICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgYi5yZWFkRW50cnkoMSwgMTAxKTsKICAg\nICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5\nIDEwMSIpOwogICAgICAgICAgICB9IGNhdGNoIChCb29raWUuTm9FbnRyeUV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2\naW91cgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVGVzdCBwYXJ0aWFsIGluZGV4ICh0cnVuY2F0ZSBtYXN0ZXIga2V5\nKSB3aXRoIHBvc3QtdjMgam91cm5hbHMKICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RQYXJ0aWFsRmlsZUlu\nZm9Qb3N0VjNKb3VybmFsMSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIHRlc3RQYXJ0aWFsRmlsZUluZm9Qb3N0VjNKb3VybmFsKHRydWUpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4IHdpdGggcG9z\ndC12MyBqb3VybmFscwogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdFBhcnRpYWxGaWxlSW5mb1Bvc3RWM0pv\ndXJuYWwyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdGVzdFBhcnRp\nYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwoZmFsc2UpOwogICAgfQoKICAgIC8q\nKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4IGZpbGUgd2l0aCBwb3N0LXYz\nIGpvdXJuYWxzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdGVzdFBhcnRp\nYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwoYm9vbGVhbiB0cnVuY2F0ZU1hc3Rl\ncktleSkKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBGaWxl\nIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAi\nam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxEaXIuZGVsZXRlKCk7CiAgICAg\nICAgam91cm5hbERpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0Rp\ncmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShq\nb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUgbGVkZ2VyRGlyID0gRmlsZS5j\ncmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxlZGdlciIpOwogICAgICAgIGxl\nZGdlckRpci5kZWxldGUoKTsKICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsK\nICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2ll\nLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKSk7CgogICAgICAgIGJ5\ndGVbXSBtYXN0ZXJLZXkgPSAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKTsKCiAg\nICAgICAgd3JpdGVWM0pvdXJuYWwoQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoam91cm5hbERpciksIDEwMCwgbWFzdGVyS2V5KTsKICAgICAgICB3cml0\nZVBhcnRpYWxJbmRleEZpbGVGb3JMZWRnZXIoQm9va2llLmdldEN1cnJlbnRE\naXJlY3RvcnkobGVkZ2VyRGlyKSwgMSwgbWFzdGVyS2V5LAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVuY2F0ZU1hc3Rlcktl\neSk7CgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IFRlc3RC\nS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAg\nICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkKICAgICAgICAgICAgLnNldEpv\ndXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQogICAgICAgICAg\nICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGly\nLmdldFBhdGgoKSB9KTsKCiAgICAgICAgQm9va2llIGIgPSBuZXcgQm9va2ll\nKGNvbmYpOwogICAgICAgIGIucmVhZEpvdXJuYWwoKTsKICAgICAgICBiLnJl\nYWRFbnRyeSgxLCAxMDApOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGIu\ncmVhZEVudHJ5KDEsIDEwMSk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4n\ndCBoYXZlIGZvdW5kIGVudHJ5IDEwMSIpOwogICAgICAgIH0gY2F0Y2ggKEJv\nb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29y\ncmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

