{"sha":"ef4cea8d93f0443ee49f7e9df82ff79711ae1497","node_id":"MDQ6QmxvYjE1NzU5NTY6ZWY0Y2VhOGQ5M2YwNDQzZWU0OWY3ZTlkZjgyZmY3OTcxMWFlMTQ5Nw==","size":22246,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ef4cea8d93f0443ee49f7e9df82ff79711ae1497","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZTsKCmlt\ncG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRv\nbWljQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21p\nYy5BdG9taWNJbnRlZ2VyOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlv\nbnM7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVyYXRpb247CgppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5\ncGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdl\nckVudHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5M\nZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkxlZGdlck1ldGFkYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNvbmYuVGVzdEJLQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdl\nckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVy\nSW50ZXJuYWxDYWxsYmFja3MuTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50\nZXJuYWxDYWxsYmFja3MuUHJvY2Vzc29yOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnRlc3QuQm9va0tlZXBlckNsdXN0ZXJUZXN0Q2FzZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLk1hdGhVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlRlc3RVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb247\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrOwoK\naW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVz\ndDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2Vy\ndC4qOwoKLyoqCiAqIFRoaXMgY2xhc3MgdGVzdHMgdGhlIGVudHJ5IGxvZyBj\nb21wYWN0aW9uIGZ1bmN0aW9uYWxpdHkuCiAqLwpwdWJsaWMgY2xhc3MgQ29t\ncGFjdGlvblRlc3QgZXh0ZW5kcyBCb29rS2VlcGVyQ2x1c3RlclRlc3RDYXNl\nIHsKICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dn\nZXJGYWN0b3J5LmdldExvZ2dlcihDb21wYWN0aW9uVGVzdC5jbGFzcyk7CiAg\nICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGU7CgogICAgc3RhdGljIGludCBFTlRS\nWV9TSVpFID0gMTAyNDsKICAgIHN0YXRpYyBpbnQgTlVNX0JPT0tJRVMgPSAx\nOwoKICAgIGludCBudW1FbnRyaWVzOwogICAgaW50IGdjV2FpdFRpbWU7CiAg\nICBkb3VibGUgbWlub3JDb21wYWN0aW9uVGhyZXNob2xkOwogICAgZG91Ymxl\nIG1ham9yQ29tcGFjdGlvblRocmVzaG9sZDsKICAgIGxvbmcgbWlub3JDb21w\nYWN0aW9uSW50ZXJ2YWw7CiAgICBsb25nIG1ham9yQ29tcGFjdGlvbkludGVy\ndmFsOwoKICAgIFN0cmluZyBtc2c7CgogICAgcHVibGljIENvbXBhY3Rpb25U\nZXN0KCkgewogICAgICAgIHN1cGVyKE5VTV9CT09LSUVTKTsKCiAgICAgICAg\ndGhpcy5kaWdlc3RUeXBlID0gRGlnZXN0VHlwZS5DUkMzMjsKCiAgICAgICAg\nbnVtRW50cmllcyA9IDEwMDsKICAgICAgICBnY1dhaXRUaW1lID0gMTAwMDsK\nICAgICAgICBtaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQgPSAwLjFmOwogICAg\nICAgIG1ham9yQ29tcGFjdGlvblRocmVzaG9sZCA9IDAuNWY7CiAgICAgICAg\nbWlub3JDb21wYWN0aW9uSW50ZXJ2YWwgPSAyICogZ2NXYWl0VGltZSAvIDEw\nMDA7CiAgICAgICAgbWFqb3JDb21wYWN0aW9uSW50ZXJ2YWwgPSA0ICogZ2NX\nYWl0VGltZSAvIDEwMDA7CgogICAgICAgIC8vIGEgZHVtbXkgbWVzc2FnZQog\nICAgICAgIFN0cmluZ0J1aWxkZXIgbXNnU0IgPSBuZXcgU3RyaW5nQnVpbGRl\ncigpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgRU5UUllfU0laRTsg\naSsrKSB7CiAgICAgICAgICAgIG1zZ1NCLmFwcGVuZCgiYSIpOwogICAgICAg\nIH0KICAgICAgICBtc2cgPSBtc2dTQi50b1N0cmluZygpOwogICAgfQoKICAg\nIEBCZWZvcmUKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBTZXQgdXAgdGhlIGNv\nbmZpZ3VyYXRpb24gcHJvcGVydGllcyBuZWVkZWQuCiAgICAgICAgYmFzZUNv\nbmYuc2V0RW50cnlMb2dTaXplTGltaXQobnVtRW50cmllcyAqIEVOVFJZX1NJ\nWkUpOwogICAgICAgIC8vIERpc2FibGUgc2tpcCBsaXN0IGZvciBjb21wYWN0\naW9uCiAgICAgICAgYmFzZUNvbmYuc2V0R2NXYWl0VGltZShnY1dhaXRUaW1l\nKTsKICAgICAgICBiYXNlQ29uZi5zZXRNaW5vckNvbXBhY3Rpb25UaHJlc2hv\nbGQobWlub3JDb21wYWN0aW9uVGhyZXNob2xkKTsKICAgICAgICBiYXNlQ29u\nZi5zZXRNYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQobWFqb3JDb21wYWN0aW9u\nVGhyZXNob2xkKTsKICAgICAgICBiYXNlQ29uZi5zZXRNaW5vckNvbXBhY3Rp\nb25JbnRlcnZhbChtaW5vckNvbXBhY3Rpb25JbnRlcnZhbCk7CiAgICAgICAg\nYmFzZUNvbmYuc2V0TWFqb3JDb21wYWN0aW9uSW50ZXJ2YWwobWFqb3JDb21w\nYWN0aW9uSW50ZXJ2YWwpOwogICAgICAgIGJhc2VDb25mLnNldEVudHJ5TG9n\nRmlsZVByZUFsbG9jYXRpb25FbmFibGVkKGZhbHNlKTsKICAgICAgICBiYXNl\nQ29uZi5zZXRTb3J0ZWRMZWRnZXJTdG9yYWdlRW5hYmxlZChmYWxzZSk7Cgog\nICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICB9CgogICAgTGVkZ2VySGFuZGxl\nW10gcHJlcGFyZURhdGEoaW50IG51bUVudHJ5TG9ncywgYm9vbGVhbiBjaGFu\nZ2VOdW0pCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nc2luY2UgYW4gZW50cnkgbG9nIGZpbGUgY2FuIGhvbGQgYXQgbW9zdCAxMDAg\nZW50cmllcwogICAgICAgIC8vIGZpcnN0IGxlZGdlciB3cml0ZSAyIGVudHJp\nZXMsIHdoaWNoIGlzIGxlc3MgdGhhbiBsb3cgd2F0ZXIgbWFyawogICAgICAg\nIGludCBudW0xID0gMjsKICAgICAgICAvLyB0aGlyZCBsZWRnZXIgd3JpdGUg\nbW9yZSB0aGFuIGhpZ2ggd2F0ZXIgbWFyayBlbnRyaWVzCiAgICAgICAgaW50\nIG51bTMgPSAoaW50KShudW1FbnRyaWVzICogMC43Zik7CiAgICAgICAgLy8g\nc2Vjb25kIGxlZGdlciB3cml0ZSByZW1haW5pbmcgZW50cmllcywgd2hpY2gg\naXMgaGlnaGVyIHRoYW4gbG93IHdhdGVyIG1hcmsKICAgICAgICAvLyBhbmQg\nbGVzcyB0aGFuIGhpZ2ggd2F0ZXIgbWFyawogICAgICAgIGludCBudW0yID0g\nbnVtRW50cmllcyAtIG51bTMgLSBudW0xOwoKICAgICAgICBMZWRnZXJIYW5k\nbGVbXSBsaHMgPSBuZXcgTGVkZ2VySGFuZGxlWzNdOwogICAgICAgIGZvciAo\naW50IGk9MDsgaTwzOyArK2kpIHsKICAgICAgICAgICAgbGhzW2ldID0gYmtj\nLmNyZWF0ZUxlZGdlcihOVU1fQk9PS0lFUywgTlVNX0JPT0tJRVMsIGRpZ2Vz\ndFR5cGUsICIiLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgZm9y\nIChpbnQgbiA9IDA7IG4gPCBudW1FbnRyeUxvZ3M7IG4rKykgewogICAgICAg\nICAgICBmb3IgKGludCBrID0gMDsgayA8IG51bTE7IGsrKykgewogICAgICAg\nICAgICAgICAgbGhzWzBdLmFkZEVudHJ5KG1zZy5nZXRCeXRlcygpKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGludCBrID0gMDsgayA8IG51\nbTI7IGsrKykgewogICAgICAgICAgICAgICAgbGhzWzFdLmFkZEVudHJ5KG1z\nZy5nZXRCeXRlcygpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3Ig\nKGludCBrID0gMDsgayA8IG51bTM7IGsrKykgewogICAgICAgICAgICAgICAg\nbGhzWzJdLmFkZEVudHJ5KG1zZy5nZXRCeXRlcygpKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBpZiAoY2hhbmdlTnVtKSB7CiAgICAgICAgICAgICAg\nICAtLW51bTI7CiAgICAgICAgICAgICAgICArK251bTM7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiBsaHM7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIHZlcmlmeUxlZGdlcihsb25nIGxpZCwgbG9uZyBzdGFy\ndEVudHJ5SWQsIGxvbmcgZW5kRW50cnlJZCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLm9wZW5MZWRnZXIobGlk\nLCBkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKICAgICAgICBFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gZW50cmllcyA9IGxoLnJlYWRFbnRyaWVzKHN0\nYXJ0RW50cnlJZCwgZW5kRW50cnlJZCk7CiAgICAgICAgd2hpbGUgKGVudHJp\nZXMuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgTGVkZ2VyRW50\ncnkgZW50cnkgPSBlbnRyaWVzLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAg\nIGFzc2VydEVxdWFscyhtc2csIG5ldyBTdHJpbmcoZW50cnkuZ2V0RW50cnko\nKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdERpc2FibGVDb21wYWN0aW9uKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gcHJlcGFyZSBkYXRhCiAgICAg\nICAgTGVkZ2VySGFuZGxlW10gbGhzID0gcHJlcGFyZURhdGEoMywgZmFsc2Up\nOwoKICAgICAgICAvLyBkaXNhYmxlIGNvbXBhY3Rpb24KICAgICAgICBiYXNl\nQ29uZi5zZXRNaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQoMC4wZik7CiAgICAg\nICAgYmFzZUNvbmYuc2V0TWFqb3JDb21wYWN0aW9uVGhyZXNob2xkKDAuMGYp\nOwoKICAgICAgICAvLyByZXN0YXJ0IGJvb2tpZXMKICAgICAgICByZXN0YXJ0\nQm9va2llcyhiYXNlQ29uZik7CgogICAgICAgIC8vIHJlbW92ZSBsZWRnZXIy\nIGFuZCBsZWRnZXIzCiAgICAgICAgLy8gc28gZW50cnkgbG9nIDEgYW5kIDIg\nd291bGQgaGF2ZSBsZWRnZXIxIGVudHJpZXMgbGVmdAogICAgICAgIGJrYy5k\nZWxldGVMZWRnZXIobGhzWzFdLmdldElkKCkpOwogICAgICAgIGJrYy5kZWxl\ndGVMZWRnZXIobGhzWzJdLmdldElkKCkpOwogICAgICAgIExPRy5pbmZvKCJG\naW5pc2hlZCBkZWxldGluZyB0aGUgbGVkZ2VycyBjb250YWlucyBtb3N0IGVu\ndHJpZXMuIik7CiAgICAgICAgVGhyZWFkLnNsZWVwKGJhc2VDb25mLmdldE1h\nam9yQ29tcGFjdGlvbkludGVydmFsKCkgKiAxMDAwCiAgICAgICAgICAgICAg\nICAgICArIGJhc2VDb25mLmdldEdjV2FpdFRpbWUoKSk7CgogICAgICAgIC8v\nIGVudHJ5IGxvZ3MgKFswLDFdLmxvZykgc2hvdWxkIG5vdCBiZSBjb21wYWN0\nZWQuCiAgICAgICAgZm9yIChGaWxlIGxlZGdlckRpcmVjdG9yeSA6IHRtcERp\ncnMpIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTm90IEZvdW5kIGVudHJ5\nIGxvZyBmaWxlIChbMCwxXS5sb2cgdGhhdCBzaG91bGQgaGF2ZSBiZWVuIGNv\nbXBhY3RlZCBpbiBsZWRnZXJEaXJlY3Rvcnk6ICIKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgbGVkZ2VyRGlyZWN0b3J5LCBUZXN0VXRpbHMuaGFz\nTG9nRmlsZXMobGVkZ2VyRGlyZWN0b3J5LCBmYWxzZSwgMCwgMSkpOwogICAg\nICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdEZvcmNlR2FyYmFnZUNvbGxlY3Rpb24oKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPSBuZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgY29uZi5zZXRH\nY1dhaXRUaW1lKDYwMDAwKTsKICAgICAgICBjb25mLnNldE1pbm9yQ29tcGFj\ndGlvbkludGVydmFsKDEyMDAwMCk7CiAgICAgICAgY29uZi5zZXRNYWpvckNv\nbXBhY3Rpb25JbnRlcnZhbCgyNDAwMDApOwogICAgICAgIExlZGdlckRpcnNN\nYW5hZ2VyIGRpck1hbmFnZXIgPSBuZXcgTGVkZ2VyRGlyc01hbmFnZXIoY29u\nZiwgY29uZi5nZXRMZWRnZXJEaXJzKCkpOwogICAgICAgIENoZWNrcG9pbnRT\nb3VyY2UgY3AgPSBuZXcgQ2hlY2twb2ludFNvdXJjZSgpIHsKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBDaGVja3BvaW50IG5l\nd0NoZWNrcG9pbnQoKSB7CiAgICAgICAgICAgICAgICAvLyBEbyBub3RoaW5n\nLgogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBjaGVja3BvaW50Q29tcGxldGUoQ2hlY2twb2ludCBjaGVja1BvaW50LCBi\nb29sZWFuIGNvbXBhY3QpCiAgICAgICAgICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgLy8gRG8gbm90aGluZy4KICAgICAg\nICAgICAgfQogICAgICAgIH07CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0\nb3J5U3RydWN0dXJlKGNvbmYuZ2V0Sm91cm5hbERpcigpKTsKICAgICAgICBm\nb3IgKEZpbGUgZGlyIDogZGlyTWFuYWdlci5nZXRBbGxMZWRnZXJEaXJzKCkp\nIHsKICAgICAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJl\nKGRpcik7CiAgICAgICAgfQogICAgICAgIEludGVybGVhdmVkTGVkZ2VyU3Rv\ncmFnZSBzdG9yYWdlID0gbmV3IEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZShj\nb25mLAogICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJNYW5hZ2VyRmFj\ndG9yeS5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeShjb25mLCB6a2MpLm5ld0xl\nZGdlck1hbmFnZXIoKSwKICAgICAgICAgICAgICAgICAgICAgICAgZGlyTWFu\nYWdlciwgY3ApOwogICAgICAgIHN0b3JhZ2Uuc3RhcnQoKTsKICAgICAgICBs\nb25nIHN0YXJ0VGltZSA9IE1hdGhVdGlscy5ub3coKTsKICAgICAgICBUaHJl\nYWQuc2xlZXAoMjAwMCk7CiAgICAgICAgc3RvcmFnZS5nY1RocmVhZC5lbmFi\nbGVGb3JjZUdDKCk7CiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAg\nICAgIC8vIE1pbm9yIGFuZCBNYWpvciBjb21wYWN0aW9uIHRpbWVzIHNob3Vs\nZCBiZSBsYXJnZXIgdGhhbiB3aGVuIHdlIHN0YXJ0ZWQKICAgICAgICAvLyB0\naGlzIHRlc3QuCiAgICAgICAgYXNzZXJ0VHJ1ZSgiTWlub3Igb3IgbWFqb3Ig\nY29tcGFjdGlvbiBkaWQgbm90IHRyaWdnZXIgZXZlbiBvbiBmb3JjaW5nLiIs\nCiAgICAgICAgICAgICAgICBzdG9yYWdlLmdjVGhyZWFkLmxhc3RNYWpvckNv\nbXBhY3Rpb25UaW1lID4gc3RhcnRUaW1lICYmCiAgICAgICAgICAgICAgICBz\ndG9yYWdlLmdjVGhyZWFkLmxhc3RNaW5vckNvbXBhY3Rpb25UaW1lID4gc3Rh\ncnRUaW1lKTsKICAgICAgICBzdG9yYWdlLnNodXRkb3duKCk7CiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RN\naW5vckNvbXBhY3Rpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAv\nLyBwcmVwYXJlIGRhdGEKICAgICAgICBMZWRnZXJIYW5kbGVbXSBsaHMgPSBw\ncmVwYXJlRGF0YSgzLCBmYWxzZSk7CgogICAgICAgIGZvciAoTGVkZ2VySGFu\nZGxlIGxoIDogbGhzKSB7CiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBkaXNhYmxlIG1ham9yIGNvbXBhY3Rpb24KICAg\nICAgICBiYXNlQ29uZi5zZXRNYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQoMC4w\nZik7CgogICAgICAgIC8vIHJlc3RhcnQgYm9va2llcwogICAgICAgIHJlc3Rh\ncnRCb29raWVzKGJhc2VDb25mKTsKCiAgICAgICAgLy8gcmVtb3ZlIGxlZGdl\ncjIgYW5kIGxlZGdlcjMKICAgICAgICBia2MuZGVsZXRlTGVkZ2VyKGxoc1sx\nXS5nZXRJZCgpKTsKICAgICAgICBia2MuZGVsZXRlTGVkZ2VyKGxoc1syXS5n\nZXRJZCgpKTsKCiAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIGRlbGV0aW5n\nIHRoZSBsZWRnZXJzIGNvbnRhaW5zIG1vc3QgZW50cmllcy4iKTsKICAgICAg\nICBUaHJlYWQuc2xlZXAoYmFzZUNvbmYuZ2V0TWlub3JDb21wYWN0aW9uSW50\nZXJ2YWwoKSAqIDEwMDAKICAgICAgICAgICAgICAgICAgICsgYmFzZUNvbmYu\nZ2V0R2NXYWl0VGltZSgpKTsKCiAgICAgICAgLy8gZW50cnkgbG9ncyAoWzAs\nMSwyXS5sb2cpIHNob3VsZCBiZSBjb21wYWN0ZWQuCiAgICAgICAgZm9yIChG\naWxlIGxlZGdlckRpcmVjdG9yeSA6IHRtcERpcnMpIHsKICAgICAgICAgICAg\nYXNzZXJ0RmFsc2UoIkZvdW5kIGVudHJ5IGxvZyBmaWxlIChbMCwxLDJdLmxv\nZyB0aGF0IHNob3VsZCBoYXZlIG5vdCBiZWVuIGNvbXBhY3RlZCBpbiBsZWRn\nZXJEaXJlY3Rvcnk6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nbGVkZ2VyRGlyZWN0b3J5LCBUZXN0VXRpbHMuaGFzTG9nRmlsZXMobGVkZ2Vy\nRGlyZWN0b3J5LCB0cnVlLCAwLCAxLCAyKSk7CiAgICAgICAgfQoKICAgICAg\nICAvLyBldmVuIGVudHJ5IGxvZyBmaWxlcyBhcmUgcmVtb3ZlZCwgd2Ugc3Rp\nbGwgY2FuIGFjY2VzcyBlbnRyaWVzIGZvciBsZWRnZXIxCiAgICAgICAgLy8g\nc2luY2UgdGhvc2UgZW50cmllcyBoYXMgYmVlbiBjb21wYWN0ZWQgdG8gbmV3\nIGVudHJ5IGxvZwogICAgICAgIHZlcmlmeUxlZGdlcihsaHNbMF0uZ2V0SWQo\nKSwgMCwgbGhzWzBdLmdldExhc3RBZGRDb25maXJtZWQoKSk7CiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RN\nYWpvckNvbXBhY3Rpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKCiAgICAgICAg\nLy8gcHJlcGFyZSBkYXRhCiAgICAgICAgTGVkZ2VySGFuZGxlW10gbGhzID0g\ncHJlcGFyZURhdGEoMywgdHJ1ZSk7CgogICAgICAgIGZvciAoTGVkZ2VySGFu\nZGxlIGxoIDogbGhzKSB7CiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBkaXNhYmxlIG1pbm9yIGNvbXBhY3Rpb24KICAg\nICAgICBiYXNlQ29uZi5zZXRNaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQoMC4w\nZik7CgogICAgICAgIC8vIHJlc3RhcnQgYm9va2llcwogICAgICAgIHJlc3Rh\ncnRCb29raWVzKGJhc2VDb25mKTsKCiAgICAgICAgLy8gcmVtb3ZlIGxlZGdl\ncjEgYW5kIGxlZGdlcjMKICAgICAgICBia2MuZGVsZXRlTGVkZ2VyKGxoc1sw\nXS5nZXRJZCgpKTsKICAgICAgICBia2MuZGVsZXRlTGVkZ2VyKGxoc1syXS5n\nZXRJZCgpKTsKICAgICAgICBMT0cuaW5mbygiRmluaXNoZWQgZGVsZXRpbmcg\ndGhlIGxlZGdlcnMgY29udGFpbnMgbW9zdCBlbnRyaWVzLiIpOwoKICAgICAg\nICBUaHJlYWQuc2xlZXAoYmFzZUNvbmYuZ2V0TWFqb3JDb21wYWN0aW9uSW50\nZXJ2YWwoKSAqIDEwMDAKICAgICAgICAgICAgICAgICAgICsgYmFzZUNvbmYu\nZ2V0R2NXYWl0VGltZSgpKTsKCiAgICAgICAgLy8gZW50cnkgbG9ncyAoWzAs\nMSwyXS5sb2cpIHNob3VsZCBiZSBjb21wYWN0ZWQKICAgICAgICBmb3IgKEZp\nbGUgbGVkZ2VyRGlyZWN0b3J5IDogdG1wRGlycykgewogICAgICAgICAgICBh\nc3NlcnRGYWxzZSgiRm91bmQgZW50cnkgbG9nIGZpbGUgKFswLDEsMl0ubG9n\nIHRoYXQgc2hvdWxkIGhhdmUgbm90IGJlZW4gY29tcGFjdGVkIGluIGxlZGdl\nckRpcmVjdG9yeTogIgogICAgICAgICAgICAgICAgICAgICAgKyBsZWRnZXJE\naXJlY3RvcnksIFRlc3RVdGlscy5oYXNMb2dGaWxlcyhsZWRnZXJEaXJlY3Rv\ncnksIHRydWUsIDAsIDEsIDIpKTsKICAgICAgICB9CgogICAgICAgIC8vIGV2\nZW4gZW50cnkgbG9nIGZpbGVzIGFyZSByZW1vdmVkLCB3ZSBzdGlsbCBjYW4g\nYWNjZXNzIGVudHJpZXMgZm9yIGxlZGdlcjIKICAgICAgICAvLyBzaW5jZSB0\naG9zZSBlbnRyaWVzIGhhcyBiZWVuIGNvbXBhY3RlZCB0byBuZXcgZW50cnkg\nbG9nCiAgICAgICAgdmVyaWZ5TGVkZ2VyKGxoc1sxXS5nZXRJZCgpLCAwLCBs\naHNbMV0uZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAgIH0KCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE1ham9yQ29t\ncGFjdGlvbkFib3ZlVGhyZXNob2xkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gcHJlcGFyZSBkYXRhCiAgICAgICAgTGVkZ2VySGFuZGxlW10g\nbGhzID0gcHJlcGFyZURhdGEoMywgZmFsc2UpOwoKICAgICAgICBmb3IgKExl\nZGdlckhhbmRsZSBsaCA6IGxocykgewogICAgICAgICAgICBsaC5jbG9zZSgp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gcmVtb3ZlIGxlZGdlcjEgYW5kIGxl\nZGdlcjIKICAgICAgICBia2MuZGVsZXRlTGVkZ2VyKGxoc1swXS5nZXRJZCgp\nKTsKICAgICAgICBia2MuZGVsZXRlTGVkZ2VyKGxoc1sxXS5nZXRJZCgpKTsK\nICAgICAgICBMT0cuaW5mbygiRmluaXNoZWQgZGVsZXRpbmcgdGhlIGxlZGdl\ncnMgY29udGFpbnMgbGVzcyBlbnRyaWVzLiIpOwogICAgICAgIFRocmVhZC5z\nbGVlcChiYXNlQ29uZi5nZXRNYWpvckNvbXBhY3Rpb25JbnRlcnZhbCgpICog\nMTAwMAogICAgICAgICAgICAgICAgICAgKyBiYXNlQ29uZi5nZXRHY1dhaXRU\naW1lKCkpOwoKICAgICAgICAvLyBlbnRyeSBsb2dzIChbMCwxLDJdLmxvZykg\nc2hvdWxkIG5vdCBiZSBjb21wYWN0ZWQKICAgICAgICBmb3IgKEZpbGUgbGVk\nZ2VyRGlyZWN0b3J5IDogdG1wRGlycykgewogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJOb3QgRm91bmQgZW50cnkgbG9nIGZpbGUgKFsxLDJdLmxvZyB0aGF0\nIHNob3VsZCBoYXZlIGJlZW4gY29tcGFjdGVkIGluIGxlZGdlckRpcmVjdG9y\neTogIgogICAgICAgICAgICAgICAgICAgICArIGxlZGdlckRpcmVjdG9yeSwg\nVGVzdFV0aWxzLmhhc0xvZ0ZpbGVzKGxlZGdlckRpcmVjdG9yeSwgZmFsc2Us\nIDAsIDEsIDIpKTsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDb21wYWN0aW9uU21hbGxF\nbnRyeUxvZ3MoKSB0aHJvd3MgRXhjZXB0aW9uIHsKCiAgICAgICAgLy8gY3Jl\nYXRlIGEgbGVkZ2VyIHRvIHdyaXRlIGEgZmV3IGVudHJpZXMKICAgICAgICBM\nZWRnZXJIYW5kbGUgYWxoID0gYmtjLmNyZWF0ZUxlZGdlcihOVU1fQk9PS0lF\nUywgTlVNX0JPT0tJRVMsIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwog\nICAgICAgIGZvciAoaW50IGk9MDsgaTwzOyBpKyspIHsKICAgICAgICAgICBh\nbGguYWRkRW50cnkobXNnLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAgICAg\nICBhbGguY2xvc2UoKTsKCiAgICAgICAgLy8gcmVzdGFydCBib29raWUgdG8g\ncm9sbCBlbnRyeSBsb2cgZmlsZXMKICAgICAgICByZXN0YXJ0Qm9va2llcygp\nOwoKICAgICAgICAvLyBwcmVwYXJlIGRhdGEKICAgICAgICBMZWRnZXJIYW5k\nbGVbXSBsaHMgPSBwcmVwYXJlRGF0YSgzLCBmYWxzZSk7CgogICAgICAgIGZv\nciAoTGVkZ2VySGFuZGxlIGxoIDogbGhzKSB7CiAgICAgICAgICAgIGxoLmNs\nb3NlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyByZW1vdmUgbGVkZ2VyMiBh\nbmQgbGVkZ2VyMwogICAgICAgIGJrYy5kZWxldGVMZWRnZXIobGhzWzFdLmdl\ndElkKCkpOwogICAgICAgIGJrYy5kZWxldGVMZWRnZXIobGhzWzJdLmdldElk\nKCkpOwogICAgICAgIExPRy5pbmZvKCJGaW5pc2hlZCBkZWxldGluZyB0aGUg\nbGVkZ2VycyBjb250YWlucyBtb3N0IGVudHJpZXMuIik7CiAgICAgICAgLy8g\ncmVzdGFydCBib29raWVzIGFnYWluIHRvIHJvbGwgZW50cnkgbG9nIGZpbGVz\nLgogICAgICAgIHJlc3RhcnRCb29raWVzKCk7CiAgICAgICAgVGhyZWFkLnNs\nZWVwKGJhc2VDb25mLmdldE1ham9yQ29tcGFjdGlvbkludGVydmFsKCkgKiAx\nMDAwCiAgICAgICAgICAgICAgICAgICArIGJhc2VDb25mLmdldEdjV2FpdFRp\nbWUoKSk7CgogICAgICAgIC8vIGVudHJ5IGxvZ3MgKDAubG9nKSBzaG91bGQg\nbm90IGJlIGNvbXBhY3RlZAogICAgICAgIC8vIGVudHJ5IGxvZ3MgKFsxLDIs\nM10ubG9nKSBzaG91bGQgYmUgY29tcGFjdGVkLgogICAgICAgIGZvciAoRmls\nZSBsZWRnZXJEaXJlY3RvcnkgOiB0bXBEaXJzKSB7CiAgICAgICAgICAgIGFz\nc2VydFRydWUoIk5vdCBGb3VuZCBlbnRyeSBsb2cgZmlsZSAoWzBdLmxvZyB0\naGF0IHNob3VsZCBoYXZlIGJlZW4gY29tcGFjdGVkIGluIGxlZGdlckRpcmVj\ndG9yeTogIgogICAgICAgICAgICAgICAgICAgICArIGxlZGdlckRpcmVjdG9y\neSwgVGVzdFV0aWxzLmhhc0xvZ0ZpbGVzKGxlZGdlckRpcmVjdG9yeSwgdHJ1\nZSwgMCkpOwogICAgICAgICAgICBhc3NlcnRGYWxzZSgiRm91bmQgZW50cnkg\nbG9nIGZpbGUgKFsxLDIsM10ubG9nIHRoYXQgc2hvdWxkIGhhdmUgbm90IGJl\nZW4gY29tcGFjdGVkIGluIGxlZGdlckRpcmVjdG9yeTogIgogICAgICAgICAg\nICAgICAgICAgICAgKyBsZWRnZXJEaXJlY3RvcnksIFRlc3RVdGlscy5oYXNM\nb2dGaWxlcyhsZWRnZXJEaXJlY3RvcnksIHRydWUsIDEsIDIsIDMpKTsKICAg\nICAgICB9CgogICAgICAgIC8vIGV2ZW4gZW50cnkgbG9nIGZpbGVzIGFyZSBy\nZW1vdmVkLCB3ZSBzdGlsbCBjYW4gYWNjZXNzIGVudHJpZXMgZm9yIGxlZGdl\ncjEKICAgICAgICAvLyBzaW5jZSB0aG9zZSBlbnRyaWVzIGhhcyBiZWVuIGNv\nbXBhY3RlZCB0byBuZXcgZW50cnkgbG9nCiAgICAgICAgdmVyaWZ5TGVkZ2Vy\nKGxoc1swXS5nZXRJZCgpLCAwLCBsaHNbMF0uZ2V0TGFzdEFkZENvbmZpcm1l\nZCgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBjb21wYWN0\naW9uIGRvZXNudCBhZGQgdG8gaW5kZXggd2l0aG91dCBoYXZpbmcgcGVyc2lz\ndGVkCiAgICAgKiBlbnRyeWxvZyBmaXJzdC4gVGhpcyBpcyBuZWVkZWQgYmVj\nYXVzZSBjb21wYWN0aW9uIGRvZXNuJ3QgZ28gdGhyb3VnaCB0aGUgam91cm5h\nbC4KICAgICAqIHtAc2VlIGh0dHBzOi8vaXNzdWVzLmFwYWNoZS5vcmcvamly\nYS9icm93c2UvQk9PS0tFRVBFUi01MzB9CiAgICAgKiB7QHNlZSBodHRwczov\nL2lzc3Vlcy5hcGFjaGUub3JnL2ppcmEvYnJvd3NlL0JPT0tLRUVQRVItNjY0\nfQogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdENvbXBhY3Rpb25TYWZldHkoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICB0ZWFyRG93bigpOyAvLyBJIGRvbnQgd2FudCB0aGUgdGVz\ndCBpbmZyYXN0cnVjdHVyZQogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVyQ29uZmlndXJh\ndGlvbigpOwogICAgICAgIGZpbmFsIFNldDxMb25nPiBsZWRnZXJzID0gQ29s\nbGVjdGlvbnMubmV3U2V0RnJvbU1hcChuZXcgQ29uY3VycmVudEhhc2hNYXA8\nTG9uZywgQm9vbGVhbj4oKSk7CiAgICAgICAgTGVkZ2VyTWFuYWdlciBtYW5h\nZ2VyID0gZ2V0TGVkZ2VyTWFuYWdlcihsZWRnZXJzKTsKCiAgICAgICAgRmls\nZSB0bXBEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJia1Rlc3QiLCAiLmRp\nciIpOwogICAgICAgIHRtcERpci5kZWxldGUoKTsKICAgICAgICB0bXBEaXIu\nbWtkaXIoKTsKICAgICAgICBGaWxlIGN1ckRpciA9IEJvb2tpZS5nZXRDdXJy\nZW50RGlyZWN0b3J5KHRtcERpcik7CiAgICAgICAgQm9va2llLmNoZWNrRGly\nZWN0b3J5U3RydWN0dXJlKGN1ckRpcik7CiAgICAgICAgY29uZi5zZXRMZWRn\nZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10ge3RtcERpci50b1N0cmluZygpfSk7\nCgogICAgICAgIGNvbmYuc2V0RW50cnlMb2dTaXplTGltaXQoRW50cnlMb2dn\nZXIuTE9HRklMRV9IRUFERVJfU0laRSArIDMgKiAoNCtFTlRSWV9TSVpFKSk7\nCiAgICAgICAgY29uZi5zZXRHY1dhaXRUaW1lKDEwMCk7CiAgICAgICAgY29u\nZi5zZXRNaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQoMC43Zik7CiAgICAgICAg\nY29uZi5zZXRNYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQoMC4wZik7CiAgICAg\nICAgY29uZi5zZXRNaW5vckNvbXBhY3Rpb25JbnRlcnZhbCgxKTsKICAgICAg\nICBjb25mLnNldE1ham9yQ29tcGFjdGlvbkludGVydmFsKDEwKTsKICAgICAg\nICBjb25mLnNldFBhZ2VMaW1pdCgxKTsKCiAgICAgICAgQ2hlY2twb2ludFNv\ndXJjZSBjaGVja3BvaW50U291cmNlID0gbmV3IENoZWNrcG9pbnRTb3VyY2Uo\nKSB7CiAgICAgICAgICAgICAgICBBdG9taWNJbnRlZ2VyIGlkR2VuID0gbmV3\nIEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgICAgICAgICBjbGFzcyBNeUNo\nZWNrcG9pbnQgaW1wbGVtZW50cyBDaGVja3BvaW50U291cmNlLkNoZWNrcG9p\nbnQgewogICAgICAgICAgICAgICAgICAgIGludCBpZCA9IGlkR2VuLmluY3Jl\nbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZVRvKENoZWNr\ncG9pbnRTb3VyY2UuQ2hlY2twb2ludCBvKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChvID09IENoZWNrcG9pbnRTb3VyY2UuQ2hlY2twb2ludC5N\nQVgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTsK\nICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChvID09IENoZWNr\ncG9pbnRTb3VyY2UuQ2hlY2twb2ludC5NSU4pIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpZCAtICgoTXlD\naGVja3BvaW50KW8pLmlkOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyBDaGVja3BvaW50U291cmNlLkNoZWNrcG9pbnQg\nbmV3Q2hlY2twb2ludCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4g\nbmV3IE15Q2hlY2twb2ludCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIGNoZWNrcG9pbnRDb21wbGV0ZShDaGVj\na3BvaW50U291cmNlLkNoZWNrcG9pbnQgY2hlY2twb2ludCwgYm9vbGVhbiBj\nb21wYWN0KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAg\nICAgIGZpbmFsIGJ5dGVbXSBLRVkgPSAiZm9vYmFyIi5nZXRCeXRlcygpOwog\nICAgICAgIEZpbGUgbG9nMCA9IG5ldyBGaWxlKGN1ckRpciwgIjAubG9nIik7\nCiAgICAgICAgTGVkZ2VyRGlyc01hbmFnZXIgZGlycyA9IG5ldyBMZWRnZXJE\naXJzTWFuYWdlcihjb25mLCBjb25mLmdldExlZGdlckRpcnMoKSk7CiAgICAg\nICAgYXNzZXJ0RmFsc2UoIkxvZyBzaG91bGRudCBleGlzdCIsIGxvZzAuZXhp\nc3RzKCkpOwogICAgICAgIEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZSBzdG9y\nYWdlID0gbmV3IEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZShjb25mLCBtYW5h\nZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXJzLCBjaGVja3Bv\naW50U291cmNlKTsKICAgICAgICBsZWRnZXJzLmFkZCgxbCk7CiAgICAgICAg\nbGVkZ2Vycy5hZGQoMmwpOwogICAgICAgIGxlZGdlcnMuYWRkKDNsKTsKICAg\nICAgICBzdG9yYWdlLnNldE1hc3RlcktleSgxLCBLRVkpOwogICAgICAgIHN0\nb3JhZ2Uuc2V0TWFzdGVyS2V5KDIsIEtFWSk7CiAgICAgICAgc3RvcmFnZS5z\nZXRNYXN0ZXJLZXkoMywgS0VZKTsKICAgICAgICBzdG9yYWdlLmFkZEVudHJ5\nKGdlbkVudHJ5KDEsIDEsIEVOVFJZX1NJWkUpKTsKICAgICAgICBzdG9yYWdl\nLmFkZEVudHJ5KGdlbkVudHJ5KDIsIDEsIEVOVFJZX1NJWkUpKTsKICAgICAg\nICBzdG9yYWdlLmFkZEVudHJ5KGdlbkVudHJ5KDIsIDIsIEVOVFJZX1NJWkUp\nKTsKICAgICAgICBzdG9yYWdlLmFkZEVudHJ5KGdlbkVudHJ5KDMsIDIsIEVO\nVFJZX1NJWkUpKTsKICAgICAgICBzdG9yYWdlLmZsdXNoKCk7CiAgICAgICAg\nc3RvcmFnZS5zaHV0ZG93bigpOwoKICAgICAgICBhc3NlcnRUcnVlKCJMb2cg\nc2hvdWxkIGV4aXN0IiwgbG9nMC5leGlzdHMoKSk7CiAgICAgICAgbGVkZ2Vy\ncy5yZW1vdmUoMmwpOwogICAgICAgIGxlZGdlcnMucmVtb3ZlKDNsKTsKCiAg\nICAgICAgc3RvcmFnZSA9IG5ldyBJbnRlcmxlYXZlZExlZGdlclN0b3JhZ2Uo\nY29uZiwgbWFuYWdlciwgZGlycywgY2hlY2twb2ludFNvdXJjZSk7CiAgICAg\nICAgc3RvcmFnZS5zdGFydCgpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgMTA7IGkrKykgewogICAgICAgICAgICBpZiAoIWxvZzAuZXhpc3RzKCkp\nIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAgICAgICAgc3RvcmFn\nZS5lbnRyeUxvZ2dlci5mbHVzaCgpOyAvLyBzaW11bGF0ZSBzeW5jIHRocmVh\nZAogICAgICAgIH0KICAgICAgICBhc3NlcnRGYWxzZSgiTG9nIHNob3VsZG50\nIGV4aXN0IiwgbG9nMC5leGlzdHMoKSk7CgogICAgICAgIGxlZGdlcnMuYWRk\nKDRsKTsKICAgICAgICBzdG9yYWdlLnNldE1hc3RlcktleSg0LCBLRVkpOwog\nICAgICAgIHN0b3JhZ2UuYWRkRW50cnkoZ2VuRW50cnkoNCwgMSwgRU5UUllf\nU0laRSkpOyAvLyBmb3JjZSBsZWRnZXIgMSBwYWdlIHRvIGZsdXNoCgogICAg\nICAgIHN0b3JhZ2UgPSBuZXcgSW50ZXJsZWF2ZWRMZWRnZXJTdG9yYWdlKGNv\nbmYsIG1hbmFnZXIsIGRpcnMsIGNoZWNrcG9pbnRTb3VyY2UpOwogICAgICAg\nIHN0b3JhZ2UuZ2V0RW50cnkoMSwgMSk7IC8vIGVudHJ5IHNob3VsZCBleGlz\ndAogICAgfQoKICAgIHByaXZhdGUgTGVkZ2VyTWFuYWdlciBnZXRMZWRnZXJN\nYW5hZ2VyKGZpbmFsIFNldDxMb25nPiBsZWRnZXJzKSB7CiAgICAgICAgTGVk\nZ2VyTWFuYWdlciBtYW5hZ2VyID0gbmV3IExlZGdlck1hbmFnZXIoKSB7CiAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGNyZWF0ZUxlZGdlcihMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YSwg\nR2VuZXJpY0NhbGxiYWNrPExvbmc+IGNiKSB7CiAgICAgICAgICAgICAgICAg\nICAgdW5zdXBwb3J0ZWQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\ncmVtb3ZlTGVkZ2VyTWV0YWRhdGEobG9uZyBsZWRnZXJJZCwgVmVyc2lvbiB2\nZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgR2VuZXJpY0NhbGxiYWNrPFZvaWQ+IHZiKSB7CiAgICAg\nICAgICAgICAgICAgICAgdW5zdXBwb3J0ZWQoKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgcmVhZExlZGdlck1ldGFkYXRhKGxvbmcgbGVkZ2VySWQs\nIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4gcmVhZENiKSB7CiAg\nICAgICAgICAgICAgICAgICAgdW5zdXBwb3J0ZWQoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgd3JpdGVMZWRnZXJNZXRhZGF0YShsb25nIGxlZGdl\ncklkLCBMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YSwKICAgICAgICAgICAgICAg\nICAgICAgICAgR2VuZXJpY0NhbGxiYWNrPFZvaWQ+IGNiKSB7CiAgICAgICAg\nICAgICAgICAgICAgdW5zdXBwb3J0ZWQoKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgYXN5bmNQcm9jZXNzTGVkZ2VycyhQcm9jZXNzb3I8TG9uZz4g\ncHJvY2Vzc29yLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBmaW5h\nbENiLAogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QgY29udGV4dCwg\naW50IHN1Y2Nlc3NSYywgaW50IGZhaWx1cmVSYykgewogICAgICAgICAgICAg\nICAgICAgIHVuc3VwcG9ydGVkKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHJlZ2lzdGVyTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcihsb25nIGxlZGdl\ncklkLAogICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJNZXRhZGF0YUxp\nc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgICAgdW5zdXBw\nb3J0ZWQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgdW5yZWdpc3Rl\nckxlZGdlck1ldGFkYXRhTGlzdGVuZXIobG9uZyBsZWRnZXJJZCwKICAgICAg\nICAgICAgICAgICAgICAgICAgTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lciBsaXN0\nZW5lcikgewogICAgICAgICAgICAgICAgICAgIHVuc3VwcG9ydGVkKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIElPRXhj\nZXB0aW9uIHt9CgogICAgICAgICAgICAgICAgdm9pZCB1bnN1cHBvcnRlZCgp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlVuc3VwcG9ydGVk\nIG9wZXJhdGlvbiBjYWxsZWQiLCBuZXcgRXhjZXB0aW9uKCkpOwogICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJVbnN1\ncHBvcnRlZCBvcCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgTGVkZ2VyUmFu\nZ2VJdGVyYXRvciBnZXRMZWRnZXJSYW5nZXMoKSB7CiAgICAgICAgICAgICAg\nICAgICAgZmluYWwgQXRvbWljQm9vbGVhbiBoYXNuZXh0ID0gbmV3IEF0b21p\nY0Jvb2xlYW4odHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBMZWRnZXJNYW5hZ2VyLkxlZGdlclJhbmdlSXRlcmF0b3IoKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNOZXh0KCkgdGhyb3dzIElPRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBo\nYXNuZXh0LmdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgTGVkZ2VyTWFuYWdlci5MZWRnZXJSYW5nZSBuZXh0\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGhhc25leHQuc2V0KGZhbHNlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgTGVkZ2VyTWFuYWdlci5MZWRnZXJSYW5n\nZShsZWRnZXJzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9OwogICAgICAgIHJldHVybiBtYW5hZ2VyOwogICAgfQoKICAgIC8qKgog\nICAgICogVGVzdCB0aGF0IGNvbXBhY3Rpb24gc2hvdWxkIGV4ZWN1dGUgc2ls\nZW50bHkgd2hlbiB0aGVyZSBpcyBubyBlbnRyeSBsb2dzCiAgICAgKiB0byBj\nb21wYWN0LiB7QHNlZSBodHRwczovL2lzc3Vlcy5hcGFjaGUub3JnL2ppcmEv\nYnJvd3NlL0JPT0tLRUVQRVItNzAwfQogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0ID0gNjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0V2hlbk5vTG9nc1Rv\nQ29tcGFjdCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRlYXJEb3du\nKCk7IC8vIEkgZG9udCB3YW50IHRoZSB0ZXN0IGluZnJhc3RydWN0dXJlCiAg\nICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gVGVzdEJLQ29uZmln\ndXJhdGlvbi5uZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgRmls\nZSB0bXBEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJia1Rlc3QiLCAiLmRp\nciIpOwogICAgICAgIHRtcERpci5kZWxldGUoKTsKICAgICAgICB0bXBEaXIu\nbWtkaXIoKTsKICAgICAgICBGaWxlIGN1ckRpciA9IEJvb2tpZS5nZXRDdXJy\nZW50RGlyZWN0b3J5KHRtcERpcik7CiAgICAgICAgQm9va2llLmNoZWNrRGly\nZWN0b3J5U3RydWN0dXJlKGN1ckRpcik7CiAgICAgICAgY29uZi5zZXRMZWRn\nZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyB0bXBEaXIudG9TdHJpbmcoKSB9\nKTsKCiAgICAgICAgTGVkZ2VyRGlyc01hbmFnZXIgZGlycyA9IG5ldyBMZWRn\nZXJEaXJzTWFuYWdlcihjb25mLCBjb25mLmdldExlZGdlckRpcnMoKSk7CiAg\nICAgICAgZmluYWwgU2V0PExvbmc+IGxlZGdlcnMgPSBDb2xsZWN0aW9ucwog\nICAgICAgICAgICAgICAgLm5ld1NldEZyb21NYXAobmV3IENvbmN1cnJlbnRI\nYXNoTWFwPExvbmcsIEJvb2xlYW4+KCkpOwogICAgICAgIExlZGdlck1hbmFn\nZXIgbWFuYWdlciA9IGdldExlZGdlck1hbmFnZXIobGVkZ2Vycyk7CiAgICAg\nICAgQ2hlY2twb2ludFNvdXJjZSBjaGVja3BvaW50U291cmNlID0gbmV3IENo\nZWNrcG9pbnRTb3VyY2UoKSB7CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIENoZWNrcG9pbnQgbmV3Q2hlY2twb2ludCgpIHsK\nICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\nY2hlY2twb2ludENvbXBsZXRlKENoZWNrcG9pbnQgY2hlY2twb2ludCwKICAg\nICAgICAgICAgICAgICAgICBib29sZWFuIGNvbXBhY3QpIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIElu\ndGVybGVhdmVkTGVkZ2VyU3RvcmFnZSBzdG9yYWdlID0gbmV3IEludGVybGVh\ndmVkTGVkZ2VyU3RvcmFnZShjb25mLAogICAgICAgICAgICAgICAgbWFuYWdl\nciwgZGlycywgY2hlY2twb2ludFNvdXJjZSk7CgogICAgICAgIGRvdWJsZSB0\naHJlc2hvbGQgPSAwLjE7CiAgICAgICAgLy8gc2hvdWxkbid0IHRocm93IGV4\nY2VwdGlvbgogICAgICAgIHN0b3JhZ2UuZ2NUaHJlYWQuZG9Db21wYWN0RW50\ncnlMb2dzKHRocmVzaG9sZCk7CiAgICB9CgogICAgcHJpdmF0ZSBCeXRlQnVm\nZmVyIGdlbkVudHJ5KGxvbmcgbGVkZ2VyLCBsb25nIGVudHJ5LCBpbnQgc2l6\nZSkgewogICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLndyYXAo\nbmV3IGJ5dGVbc2l6ZV0pOwogICAgICAgIGJiLnB1dExvbmcobGVkZ2VyKTsK\nICAgICAgICBiYi5wdXRMb25nKGVudHJ5KTsKICAgICAgICB3aGlsZSAoYmIu\naGFzUmVtYWluaW5nKCkpIHsKICAgICAgICAgICAgYmIucHV0KChieXRlKTB4\nRkYpOwogICAgICAgIH0KICAgICAgICBiYi5mbGlwKCk7CiAgICAgICAgcmV0\ndXJuIGJiOwogICAgfQp9Cg==\n","encoding":"base64"}

