{"sha":"27577d2924c33886a875eb952c8031bbb072225e","node_id":"MDQ6QmxvYjE1NzU5NTY6Mjc1NzdkMjkyNGMzMzg4NmE4NzVlYjk1MmM4MDMxYmJiMDcyMjI1ZQ==","size":18757,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/27577d2924c33886a875eb952c8031bbb072225e","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuVXBn\ncmFkZVRlc3QubmV3VjFKb3VybmFsRGlyZWN0b3J5OwppbXBvcnQgc3RhdGlj\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuVXBncmFkZVRlc3QubmV3\nVjFMZWRnZXJEaXJlY3Rvcnk7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmJvb2tpZS5VcGdyYWRlVGVzdC5uZXdWMkpvdXJuYWxEaXJl\nY3Rvcnk7CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJv\nb2tpZS5VcGdyYWRlVGVzdC5uZXdWMkxlZGdlckRpcmVjdG9yeTsKaW1wb3J0\nIHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0LmFzc2VydFRydWU7CmltcG9ydCBz\ndGF0aWMgb3JnLmp1bml0LkFzc2VydC5mYWlsOwoKaW1wb3J0IGphdmEuaW8u\nRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CgppbXBvcnQganVu\naXQuZnJhbWV3b3JrLkFzc2VydDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkJvb2tLZWVwZXJBZG1pbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuVGVzdEJL\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5t\nZXRhLlprVmVyc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50\nZXN0LlBvcnRNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnRlc3QuWm9vS2VlcGVyVXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci52ZXJzaW9uaW5nLlZlcnNpb247CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIudmVyc2lvbmluZy5WZXJzaW9uZWQ7CmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuaW8uRmlsZVV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmp1bml0LkFmdGVyOwpp\nbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0\nOwoKcHVibGljIGNsYXNzIENvb2tpZVRlc3QgewogICAgWm9vS2VlcGVyVXRp\nbCB6a3V0aWw7CiAgICBab29LZWVwZXIgemtjID0gbnVsbDsKICAgIGZpbmFs\nIGludCBib29raWVQb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7\nCgogICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc2V0dXBab29LZWVwZXIo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB6a3V0aWwgPSBuZXcgWm9v\nS2VlcGVyVXRpbCgpOwogICAgICAgIHprdXRpbC5zdGFydFNlcnZlcigpOwog\nICAgICAgIHprYyA9IHprdXRpbC5nZXRab29LZWVwZXJDbGllbnQoKTsKICAg\nIH0KCiAgICBAQWZ0ZXIKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duWm9vS2Vl\ncGVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgemt1dGlsLmtpbGxT\nZXJ2ZXIoKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgbmV3\nRGlyZWN0b3J5KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICByZXR1\ncm4gbmV3RGlyZWN0b3J5KHRydWUpOwogICAgfQoKICAgIHByaXZhdGUgc3Rh\ndGljIFN0cmluZyBuZXdEaXJlY3RvcnkoYm9vbGVhbiBjcmVhdGVDdXJEaXIp\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBkID0gRmlsZS5j\ncmVhdGVUZW1wRmlsZSgiYm9va2llIiwgInRtcGRpciIpOwogICAgICAgIGQu\nZGVsZXRlKCk7CiAgICAgICAgZC5ta2RpcnMoKTsKICAgICAgICBpZiAoY3Jl\nYXRlQ3VyRGlyKSB7CiAgICAgICAgICAgIG5ldyBGaWxlKGQsICJjdXJyZW50\nIikubWtkaXJzKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBkLmdldFBh\ndGgoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3Qgc3RhcnRpbmcgYm9v\na2llIHdpdGggY2xlYW4gc3RhdGUuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVv\ndXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q2xlYW5TdGFydCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVyQ29uZmlndXJh\ndGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpv\nb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJu\nYWxEaXJOYW1lKG5ld0RpcmVjdG9yeShmYWxzZSkpCiAgICAgICAgICAgIC5z\nZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBuZXdEaXJlY3Rvcnko\nZmFsc2UpIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0KGJvb2tpZVBv\ncnQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2tpZSBiID0gbmV3\nIEJvb2tpZShjb25mKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICBmYWlsKCJTaG91bGQgbm90IHJlYWNoIGhlcmUuIik7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlm\nIGEgem9va2VlcGVyIGNvb2tpZQogICAgICogaXMgZGlmZmVyZW50IHRvIGEg\nbG9jYWwgY29va2llLCB0aGUgYm9va2llCiAgICAgKiB3aWxsIGZhaWwgdG8g\nc3RhcnQKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RCYWRKb3VybmFsQ29va2llKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mMSA9IFRl\nc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVyQ29uZmlndXJhdGlvbigpCiAg\nICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShuZXdEaXJlY3RvcnkoKSkK\nICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7\nIG5ld0RpcmVjdG9yeSgpIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0\nKGJvb2tpZVBvcnQpOwogICAgICAgIENvb2tpZS5CdWlsZGVyIGNvb2tpZUJ1\naWxkZXIgPSBDb29raWUuZ2VuZXJhdGVDb29raWUoY29uZjEpOwogICAgICAg\nIENvb2tpZSBjID0gY29va2llQnVpbGRlci5idWlsZCgpOwogICAgICAgIGMu\nd3JpdGVUb1pvb0tlZXBlcih6a2MsIGNvbmYxLCBWZXJzaW9uLk5FVyk7Cgog\nICAgICAgIFN0cmluZyBqb3VybmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAg\nICAgICAgU3RyaW5nIGxlZGdlckRpciA9IG5ld0RpcmVjdG9yeSgpOwogICAg\nICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjIgPSBUZXN0QktDb25maWd1\ncmF0aW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAu\nc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5n\nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGly\nKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1td\nIHsgbGVkZ2VyRGlyIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0KGJv\nb2tpZVBvcnQpOwogICAgICAgIENvb2tpZS5CdWlsZGVyIGNvb2tpZUJ1aWxk\nZXIyID0gQ29va2llLmdlbmVyYXRlQ29va2llKGNvbmYyKTsKICAgICAgICBD\nb29raWUgYzIgPSBjb29raWVCdWlsZGVyMi5idWlsZCgpOwogICAgICAgIGMy\nLndyaXRlVG9EaXJlY3RvcnkobmV3IEZpbGUoam91cm5hbERpciwgImN1cnJl\nbnQiKSk7CiAgICAgICAgYzIud3JpdGVUb0RpcmVjdG9yeShuZXcgRmlsZShs\nZWRnZXJEaXIsICJjdXJyZW50IikpOwoKICAgICAgICB0cnkgewogICAgICAg\nICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZjIpOwogICAgICAgICAg\nICBmYWlsKCJTaG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsK\nICAgICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tp\nZUV4Y2VwdGlvbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhh\ndmlvdXIKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRo\nYXQgaWYgYSBkaXJlY3RvcnkgaXMgcmVtb3ZlZCBmcm9tCiAgICAgKiB0aGUg\nY29uZmlndXJhdGlvbiwgdGhlIGJvb2tpZSB3aWxsIGZhaWwgdG8KICAgICAq\nIHN0YXJ0CiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0RGlyZWN0b3J5TWlzc2luZygpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIFN0cmluZ1tdIGxlZGdlckRpcnMgPSBuZXcgU3Ry\naW5nW10gewogICAgICAgICAgICBuZXdEaXJlY3RvcnkoKSwgbmV3RGlyZWN0\nb3J5KCksIG5ld0RpcmVjdG9yeSgpIH07CiAgICAgICAgU3RyaW5nIGpvdXJu\nYWxEaXIgPSBuZXdEaXJlY3RvcnkoKTsKICAgICAgICBTZXJ2ZXJDb25maWd1\ncmF0aW9uIGNvbmYgPSBUZXN0QktDb25maWd1cmF0aW9uLm5ld1NlcnZlckNv\nbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRp\nbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5z\nZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGlyKQogICAgICAgICAgICAuc2V0\nTGVkZ2VyRGlyTmFtZXMobGVkZ2VyRGlycykKICAgICAgICAgICAgLnNldEJv\nb2tpZVBvcnQoYm9va2llUG9ydCk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3\nIEJvb2tpZShjb25mKTsgLy8gc2hvdWxkIHdvcmsgZmluZQogICAgICAgIGIu\nc3RhcnQoKTsKICAgICAgICBiLnNodXRkb3duKCk7CgogICAgICAgIGNvbmYu\nc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyc1sw\nXSwgbGVkZ2VyRGlyc1sxXSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBCb29raWUgYjIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBm\nYWlsKCJTaG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAg\nICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4\nY2VwdGlvbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlv\ndXIKICAgICAgICB9CgogICAgICAgIGNvbmYuc2V0Sm91cm5hbERpck5hbWUo\nbmV3RGlyZWN0b3J5KCkpLnNldExlZGdlckRpck5hbWVzKGxlZGdlckRpcnMp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2tpZSBiMiA9IG5ldyBC\nb29raWUoY29uZik7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZl\nIGJlZW4gYWJsZSB0byBzdGFydCIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tp\nZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uIGljZSkgewogICAg\nICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KCiAgICAg\nICAgY29uZi5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGlyKTsKICAgICAg\nICBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICBiLnN0YXJ0KCk7CiAg\nICAgICAgYi5zaHV0ZG93bigpOwogICAgfQoKICAgIC8qKgogICAgICogVGVz\ndCB0aGF0IGlmIGEgZGlyZWN0b3J5IGlzIGFkZGVkIHRvIGEKICAgICAqIHBy\nZWV4aXN0aW5nIGJvb2tpZSwgdGhlIGJvb2tpZSB3aWxsIGZhaWwKICAgICAq\nIHRvIHN0YXJ0CiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0RGlyZWN0b3J5QWRkZWQoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbGVkZ2VyRGlyMCA9IG5ld0RpcmVj\ndG9yeSgpOwogICAgICAgIFN0cmluZyBqb3VybmFsRGlyID0gbmV3RGlyZWN0\nb3J5KCk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gVGVz\ndEJLQ29uZmlndXJhdGlvbi5uZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAg\nICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUo\nam91cm5hbERpcikKICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5l\ndyBTdHJpbmdbXSB7IGxlZGdlckRpcjAgfSkKICAgICAgICAgICAgLnNldEJv\nb2tpZVBvcnQoYm9va2llUG9ydCk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3\nIEJvb2tpZShjb25mKTsgLy8gc2hvdWxkIHdvcmsgZmluZQogICAgICAgIGIu\nc3RhcnQoKTsKICAgICAgICBiLnNodXRkb3duKCk7CgogICAgICAgIGNvbmYu\nc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyMCwg\nbmV3RGlyZWN0b3J5KCkgfSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nQm9va2llIGIyID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAgZmFp\nbCgiU2hvdWxkbid0IGhhdmUgYmVlbiBhYmxlIHRvIHN0YXJ0Iik7CiAgICAg\nICAgfSBjYXRjaCAoQm9va2llRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNl\ncHRpb24gaWNlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3Vy\nCiAgICAgICAgfQoKICAgICAgICBjb25mLnNldExlZGdlckRpck5hbWVzKG5l\ndyBTdHJpbmdbXSB7IGxlZGdlckRpcjAgfSk7CiAgICAgICAgYiA9IG5ldyBC\nb29raWUoY29uZik7CiAgICAgICAgYi5zdGFydCgpOwogICAgICAgIGIuc2h1\ndGRvd24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBh\nIGRpcmVjdG9yeSdzIGNvbnRlbnRzCiAgICAgKiBhcmUgZW1wdGllZCwgdGhl\nIGJvb2tpZSB3aWxsIGZhaWwgdG8gc3RhcnQKICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3REaXJlY3RvcnlD\nbGVhcmVkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIGxl\nZGdlckRpcjAgPSBuZXdEaXJlY3RvcnkoKTsKICAgICAgICBTdHJpbmcgam91\ncm5hbERpciA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVy\nQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1\ndGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAgICAg\nLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIpCiAgICAgICAgICAgIC5z\nZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIwICwg\nbmV3RGlyZWN0b3J5KCkgfSkKICAgICAgICAgICAgLnNldEJvb2tpZVBvcnQo\nYm9va2llUG9ydCk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShj\nb25mKTsgLy8gc2hvdWxkIHdvcmsgZmluZQogICAgICAgIGIuc3RhcnQoKTsK\nICAgICAgICBiLnNodXRkb3duKCk7CgogICAgICAgIEZpbGVVdGlscy5kZWxl\ndGVEaXJlY3RvcnkobmV3IEZpbGUobGVkZ2VyRGlyMCkpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIEJvb2tpZSBiMiA9IG5ldyBCb29raWUoY29uZik7\nCiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0\nbyBzdGFydCIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5J\nbnZhbGlkQ29va2llRXhjZXB0aW9uIGljZSkgewogICAgICAgICAgICAvLyBj\nb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgdGhhdCBpZiBhIGJvb2tpZSdzIHBvcnQgaXMgY2hhbmdlZAog\nICAgICogdGhlIGJvb2tpZSB3aWxsIGZhaWwgdG8gc3RhcnQKICAgICAqLwog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RC\nb29raWVQb3J0Q2hhbmdlZCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRp\nb24ubmV3U2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRa\na1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkK\nICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKG5ld0RpcmVjdG9yeSgp\nKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1td\nIHsgbmV3RGlyZWN0b3J5KCkgLCBuZXdEaXJlY3RvcnkoKSB9KQogICAgICAg\nICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0KTsKICAgICAgICBCb29r\naWUgYiA9IG5ldyBCb29raWUoY29uZik7IC8vIHNob3VsZCB3b3JrIGZpbmUK\nICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93bigpOwoKICAg\nICAgICBjb25mLnNldEJvb2tpZVBvcnQoMzE4Mik7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgICAg\nIGZhaWwoIlNob3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0byBzdGFydCIpOwog\nICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2ll\nRXhjZXB0aW9uIGljZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2\naW91cgogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhh\ndCBpZiBhIGJvb2tpZSB0cmllcyB0byBzdGFydAogICAgICogd2l0aCB0aGUg\nYWRkcmVzcyBvZiBhIGJvb2tpZSB3aGljaCBoYXMgYWxyZWFkeQogICAgICog\nZXhpc3RlZCBpbiB0aGUgc3lzdGVtLCB0aGVuIHRoZSBib29raWUgd2lsbCBm\nYWlsCiAgICAgKiB0byBzdGFydAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE5ld0Jvb2tpZVN0YXJ0aW5n\nV2l0aEFub3RoZXJCb29raWVzUG9ydCgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IFRlc3RCS0NvbmZp\nZ3VyYXRpb24ubmV3U2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAg\nIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJp\nbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKG5ld0RpcmVj\ndG9yeSgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0\ncmluZ1tdIHsgbmV3RGlyZWN0b3J5KCkgLCBuZXdEaXJlY3RvcnkoKSB9KQog\nICAgICAgICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0KTsKICAgICAg\nICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7IC8vIHNob3VsZCB3b3Jr\nIGZpbmUKICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93bigp\nOwoKICAgICAgICBjb25mID0gVGVzdEJLQ29uZmlndXJhdGlvbi5uZXdTZXJ2\nZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFprU2VydmVycyh6\na3V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKQogICAgICAgICAg\nICAuc2V0Sm91cm5hbERpck5hbWUobmV3RGlyZWN0b3J5KCkpCiAgICAgICAg\nICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBuZXdEaXJl\nY3RvcnkoKSAsIG5ld0RpcmVjdG9yeSgpIH0pCiAgICAgICAgICAgIC5zZXRC\nb29raWVQb3J0KGJvb2tpZVBvcnQpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBmYWlsKCJT\naG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAgICAgICB9\nIGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlv\nbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAg\nICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIFRlc3QgQ29va2llIHZlcmlm\naWNhdGlvbiB3aXRoIGZvcm1hdC4KICAgICAqLwogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RWZXJpZnlDb29raWVXaXRo\nRm9ybWF0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xpZW50Q29u\nZmlndXJhdGlvbiBhZG1pbkNvbmYgPSBuZXcgQ2xpZW50Q29uZmlndXJhdGlv\nbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tl\nZXBlckNvbm5lY3RTdHJpbmcoKSk7CgogICAgICAgIGFkbWluQ29uZi5zZXRQ\ncm9wZXJ0eSgiYm9va2tlZXBlci5mb3JtYXQiLCB0cnVlKTsKICAgICAgICAv\nLyBGb3JtYXQgdGhlIEJLIE1ldGFkYXRhIGFuZCBnZW5lcmF0ZSBJTlNUQU5D\nRUlECiAgICAgICAgQm9va0tlZXBlckFkbWluLmZvcm1hdChhZG1pbkNvbmYs\nIGZhbHNlLCB0cnVlKTsKCiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBi\nb29raWVDb25mID0gVGVzdEJLQ29uZmlndXJhdGlvbi5uZXdTZXJ2ZXJDb25m\naWd1cmF0aW9uKCkKICAgICAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1\ndGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAgICAg\nICAgIC5zZXRKb3VybmFsRGlyTmFtZShuZXdEaXJlY3RvcnkoZmFsc2UpKQog\nICAgICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdb\nXSB7IG5ld0RpcmVjdG9yeShmYWxzZSkgfSkKICAgICAgICAgICAgICAgIC5z\nZXRCb29raWVQb3J0KGJvb2tpZVBvcnQpOwogICAgICAgIC8vIEJvb2tpZSBz\naG91bGQgc3RhcnQgc3VjY2Vzc2Z1bGx5IGZvciBmcmVzaCBlbnYuCiAgICAg\nICAgbmV3IEJvb2tpZShib29raWVDb25mKTsKCiAgICAgICAgLy8gRm9ybWF0\nIG1ldGFkYXRhIG9uZSBtb3JlIHRpbWUuCiAgICAgICAgQm9va0tlZXBlckFk\nbWluLmZvcm1hdChhZG1pbkNvbmYsIGZhbHNlLCB0cnVlKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBuZXcgQm9va2llKGJvb2tpZUNvbmYpOwogICAg\nICAgICAgICBmYWlsKCJCb29raWUgc2hvdWxkIG5vdCBzdGFydCB3aXRoIHBy\nZXZpb3VzIGluc3RhbmNlIGlkLiIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tp\nZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgKICAgICAgICAgICAgICAgICAgICAiQm9va2ll\nIHN0YXJ0dXAgc2hvdWxkIGZhaWwgYmVjYXVzZSBvZiBpbnZhbGlkIGluc3Rh\nbmNlIGlkIiwKICAgICAgICAgICAgICAgICAgICBlLmdldE1lc3NhZ2UoKS5j\nb250YWlucygiaW5zdGFuY2VJZCIpKTsKICAgICAgICB9CgogICAgICAgIC8v\nIE5vdyBmb3JtYXQgdGhlIEJvb2tpZSBhbmQgcmVzdGFydC4KICAgICAgICBC\nb29raWUuZm9ybWF0KGJvb2tpZUNvbmYsIGZhbHNlLCB0cnVlKTsKICAgICAg\nICAvLyBBZnRlciBib29raWUgZm9ybWF0IGJvb2tpZSBzaG91bGQgYmUgYWJs\nZSB0byBzdGFydCBhZ2Fpbi4KICAgICAgICBuZXcgQm9va2llKGJvb2tpZUNv\nbmYpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIGEgYm9v\na2llIGlzIHN0YXJ0ZWQgd2l0aCBkaXJlY3RvcmllcyB3aXRoCiAgICAgKiB2\nZXJzaW9uIDIgZGF0YSwgdGhhdCBpdCB3aWxsIGZhaWwgdG8gc3RhcnQgKGl0\nIG5lZWRzIHVwZ3JhZGUpCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0VjJkYXRhKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gVGVz\ndEJLQ29uZmlndXJhdGlvbi5uZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAg\nICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUo\nbmV3VjJKb3VybmFsRGlyZWN0b3J5KCkpCiAgICAgICAgICAgIC5zZXRMZWRn\nZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBuZXdWMkxlZGdlckRpcmVjdG9y\neSgpIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0KGJvb2tpZVBvcnQp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2tpZSBiID0gbmV3IEJv\nb2tpZShjb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUg\nYmVlbiBhYmxlIHRvIHN0YXJ0Iik7CiAgICAgICAgfSBjYXRjaCAoQm9va2ll\nRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNlcHRpb24gaWNlKSB7CiAgICAg\nICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgICAgIGFzc2Vy\ndFRydWUoIndyb25nIGV4Y2VwdGlvbiIsIGljZS5nZXRDYXVzZSgpLmdldE1l\nc3NhZ2UoKS5jb250YWlucygidXBncmFkZSBuZWVkZWQiKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIGEgYm9va2ll\nIGlzIHN0YXJ0ZWQgd2l0aCBkaXJlY3RvcmllcyB3aXRoCiAgICAgKiB2ZXJz\naW9uIDEgZGF0YSwgdGhhdCBpdCB3aWxsIGZhaWwgdG8gc3RhcnQgKGl0IG5l\nZWRzIHVwZ3JhZGUpCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0VjFkYXRhKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gVGVzdEJL\nQ29uZmlndXJhdGlvbi5uZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAg\nICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVj\ndFN0cmluZygpKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUobmV3\nVjFKb3VybmFsRGlyZWN0b3J5KCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJE\naXJOYW1lcyhuZXcgU3RyaW5nW10geyBuZXdWMUxlZGdlckRpcmVjdG9yeSgp\nIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0KGJvb2tpZVBvcnQpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tp\nZShjb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgYmVl\nbiBhYmxlIHRvIHN0YXJ0Iik7CiAgICAgICAgfSBjYXRjaCAoQm9va2llRXhj\nZXB0aW9uLkludmFsaWRDb29raWVFeGNlcHRpb24gaWNlKSB7CiAgICAgICAg\nICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgICAgIGFzc2VydFRy\ndWUoIndyb25nIGV4Y2VwdGlvbiIsIGljZS5nZXRDYXVzZSgpLmdldE1lc3Nh\nZ2UoKS5jb250YWlucygidXBncmFkZSBuZWVkZWQiKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogVGVzdCByZXN0YXJ0IGJvb2tpZSB3aXRo\nIHVzZUhvc3ROYW1lQXNCb29raWVJRD10cnVlLCB3aGljaCBoYWQgY29va2ll\nIGdlbmVyYXRlZAogICAgICogd2l0aCBpcGFkZHJlc3MuCiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RS\nZXN0YXJ0V2l0aEhvc3ROYW1lQXNCb29raWVJRCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIFN0cmluZ1tdIGxlZGdlckRpcnMgPSBuZXcgU3RyaW5n\nW10geyBuZXdEaXJlY3RvcnkoKSwgbmV3RGlyZWN0b3J5KCksCiAgICAgICAg\nICAgICAgICBuZXdEaXJlY3RvcnkoKSB9OwogICAgICAgIFN0cmluZyBqb3Vy\nbmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAgU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mID0gVGVzdEJLQ29uZmlndXJhdGlvbi5uZXdTZXJ2ZXJD\nb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMo\nemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAg\nICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGlyKS5zZXRMZWRn\nZXJEaXJOYW1lcyhsZWRnZXJEaXJzKQogICAgICAgICAgICAgICAgLnNldEJv\nb2tpZVBvcnQoYm9va2llUG9ydCk7CiAgICAgICAgQm9va2llIGIgPSBuZXcg\nQm9va2llKGNvbmYpOyAvLyBzaG91bGQgd29yayBmaW5lCiAgICAgICAgYi5z\ndGFydCgpOwogICAgICAgIGIuc2h1dGRvd24oKTsKCiAgICAgICAgY29uZi5z\nZXRVc2VIb3N0TmFtZUFzQm9va2llSUQodHJ1ZSk7CiAgICAgICAgYiA9IG5l\ndyBCb29raWUoY29uZik7CiAgICAgICAgYi5zdGFydCgpOwogICAgICAgIGFz\nc2VydFRydWUoIkZhaWxzIHRvIHJlY29nbml6ZSBib29raWUgd2hpY2ggd2Fz\nIHN0YXJ0ZWQgd2l0aCBJUEFkZHIgYXMgSUQiLCAhY29uZi5nZXRVc2VIb3N0\nTmFtZUFzQm9va2llSUQoKSk7CiAgICAgICAgYi5zaHV0ZG93bigpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCByZXN0YXJ0IGJvb2tpZSB3aXRoIHVz\nZUhvc3ROYW1lQXNCb29raWVJRD1mYWxzZSwgd2hpY2ggaGFkIGNvb2tpZSBn\nZW5lcmF0ZWQKICAgICAqIHdpdGggaG9zdG5hbWUuCiAgICAgKi8KICAgIEBU\nZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZXN0\nYXJ0V2l0aElwQWRkcmVzc0FzQm9va2llSUQoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBTdHJpbmdbXSBsZWRnZXJEaXJzID0gbmV3IFN0cmluZ1td\nIHsgbmV3RGlyZWN0b3J5KCksIG5ld0RpcmVjdG9yeSgpLAogICAgICAgICAg\nICAgICAgbmV3RGlyZWN0b3J5KCkgfTsKICAgICAgICBTdHJpbmcgam91cm5h\nbERpciA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAgIFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVyQ29u\nZmlndXJhdGlvbigpCiAgICAgICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHpr\ndXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAg\nICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpcikuc2V0TGVkZ2Vy\nRGlyTmFtZXMobGVkZ2VyRGlycykKICAgICAgICAgICAgICAgIC5zZXRCb29r\naWVQb3J0KGJvb2tpZVBvcnQpOwogICAgICAgIGNvbmYuc2V0VXNlSG9zdE5h\nbWVBc0Jvb2tpZUlEKHRydWUpOwogICAgICAgIEJvb2tpZSBiID0gbmV3IEJv\nb2tpZShjb25mKTsgLy8gc2hvdWxkIHdvcmsgZmluZQogICAgICAgIGIuc3Rh\ncnQoKTsKICAgICAgICBiLnNodXRkb3duKCk7CgogICAgICAgIGNvbmYuc2V0\nVXNlSG9zdE5hbWVBc0Jvb2tpZUlEKGZhbHNlKTsKICAgICAgICBiID0gbmV3\nIEJvb2tpZShjb25mKTsKICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYXNz\nZXJ0VHJ1ZSgiRmFpbHMgdG8gcmVjb2duaXplIGJvb2tpZSB3aGljaCB3YXMg\nc3RhcnRlZCB3aXRoIEhvc3ROYW1lIGFzIElEIiwgY29uZi5nZXRVc2VIb3N0\nTmFtZUFzQm9va2llSUQoKSk7CiAgICAgICAgYi5zaHV0ZG93bigpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCBvbGQgdmVyc2lvbiBib29raWUgc3Rh\ncnRzIHdpdGggdGhlIGNvb2tpZXMgZ2VuZXJhdGVkIGJ5IG5ldyB2ZXJzaW9u\nCiAgICAgKiAod2l0aCB1c2VIb3N0TmFtZUFzQm9va2llSUQ9dHJ1ZSkKICAg\nICAqLwogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFYyZGF0YVdpdGhIb3N0TmFtZUFzQm9va2llSUQoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPSBUZXN0QktDb25maWd1cmF0aW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24o\nKQogICAgICAgICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0Wm9v\nS2VlcGVyQ29ubmVjdFN0cmluZygpKQogICAgICAgICAgICAgICAgLnNldEpv\ndXJuYWxEaXJOYW1lKG5ld1YySm91cm5hbERpcmVjdG9yeSgpKQogICAgICAg\nICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IG5l\nd1YyTGVkZ2VyRGlyZWN0b3J5KCkgfSkKICAgICAgICAgICAgICAgIC5zZXRC\nb29raWVQb3J0KGJvb2tpZVBvcnQpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGNvbmYuc2V0VXNlSG9zdE5hbWVBc0Jvb2tpZUlEKHRydWUpOwogICAg\nICAgICAgICBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBmYWlsKCJT\naG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAgICAgICB9\nIGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlv\nbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZSgid3JvbmcgZXhjZXB0aW9uIiwKICAgICAg\nICAgICAgICAgICAgICBpY2UuZ2V0Q2F1c2UoKS5nZXRNZXNzYWdlKCkuY29u\ndGFpbnMoInVwZ3JhZGUgbmVlZGVkIikpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3Qgd3JpdGUgY29va2llIG11bHRpcGxlIHRpbWVz\nLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0V3JpdGVUb1pvb0tlZXBlcigpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIFN0cmluZ1tdIGxlZGdlckRpcnMgPSBuZXcgU3RyaW5n\nW10geyBuZXdEaXJlY3RvcnkoKSwgbmV3RGlyZWN0b3J5KCksIG5ld0RpcmVj\ndG9yeSgpIH07CiAgICAgICAgU3RyaW5nIGpvdXJuYWxEaXIgPSBuZXdEaXJl\nY3RvcnkoKTsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBU\nZXN0QktDb25maWd1cmF0aW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKQog\nICAgICAgICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0Wm9vS2Vl\ncGVyQ29ubmVjdFN0cmluZygpKS5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFs\nRGlyKQogICAgICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKGxlZGdl\nckRpcnMpLnNldEJvb2tpZVBvcnQoYm9va2llUG9ydCk7CiAgICAgICAgQm9v\na2llIGIgPSBuZXcgQm9va2llKGNvbmYpOyAvLyBzaG91bGQgd29yayBmaW5l\nCiAgICAgICAgYi5zdGFydCgpOwogICAgICAgIGIuc2h1dGRvd24oKTsKICAg\nICAgICBWZXJzaW9uZWQ8Q29va2llPiB6a0Nvb2tpZSA9IENvb2tpZS5yZWFk\nRnJvbVpvb0tlZXBlcih6a2MsIGNvbmYpOwogICAgICAgIFZlcnNpb24gdmVy\nc2lvbjEgPSB6a0Nvb2tpZS5nZXRWZXJzaW9uKCk7CiAgICAgICAgQXNzZXJ0\nLmFzc2VydFRydWUoIkludmFsaWQgdHlwZSBleHBlY3RlZCBaa1ZlcnNpb24g\ndHlwZSIsIHZlcnNpb24xIGluc3RhbmNlb2YgWmtWZXJzaW9uKTsKICAgICAg\nICBaa1ZlcnNpb24gemtWZXJzaW9uMSA9IChaa1ZlcnNpb24pIHZlcnNpb24x\nOwogICAgICAgIENvb2tpZSBjb29raWUgPSB6a0Nvb2tpZS5nZXRWYWx1ZSgp\nOwogICAgICAgIGNvb2tpZS53cml0ZVRvWm9vS2VlcGVyKHprYywgY29uZiwg\ndmVyc2lvbjEpOwoKICAgICAgICB6a0Nvb2tpZSA9IENvb2tpZS5yZWFkRnJv\nbVpvb0tlZXBlcih6a2MsIGNvbmYpOwogICAgICAgIFZlcnNpb24gdmVyc2lv\nbjIgPSB6a0Nvb2tpZS5nZXRWZXJzaW9uKCk7CiAgICAgICAgQXNzZXJ0LmFz\nc2VydFRydWUoIkludmFsaWQgdHlwZSBleHBlY3RlZCBaa1ZlcnNpb24gdHlw\nZSIsIHZlcnNpb24yIGluc3RhbmNlb2YgWmtWZXJzaW9uKTsKICAgICAgICBa\na1ZlcnNpb24gemtWZXJzaW9uMiA9IChaa1ZlcnNpb24pIHZlcnNpb24yOwog\nICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMoIlZlcnNpb24gbWlzbWF0Y2hl\ncyEiLCB6a1ZlcnNpb24xLmdldFpub2RlVmVyc2lvbigpICsgMSwgemtWZXJz\naW9uMi5nZXRabm9kZVZlcnNpb24oKSk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUZXN0IGRlbGV0ZSBjb29raWUuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVv\ndXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3REZWxldGVGcm9tWm9v\nS2VlcGVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nW10g\nbGVkZ2VyRGlycyA9IG5ldyBTdHJpbmdbXSB7IG5ld0RpcmVjdG9yeSgpLCBu\nZXdEaXJlY3RvcnkoKSwgbmV3RGlyZWN0b3J5KCkgfTsKICAgICAgICBTdHJp\nbmcgam91cm5hbERpciA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3\nU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgICAgICAuc2V0WmtT\nZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpLnNl\ndEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIpCiAgICAgICAgICAgICAgICAu\nc2V0TGVkZ2VyRGlyTmFtZXMobGVkZ2VyRGlycykuc2V0Qm9va2llUG9ydChi\nb29raWVQb3J0KTsKICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29u\nZik7IC8vIHNob3VsZCB3b3JrIGZpbmUKICAgICAgICBiLnN0YXJ0KCk7CiAg\nICAgICAgYi5zaHV0ZG93bigpOwogICAgICAgIFZlcnNpb25lZDxDb29raWU+\nIHprQ29va2llID0gQ29va2llLnJlYWRGcm9tWm9vS2VlcGVyKHprYywgY29u\nZik7CiAgICAgICAgQ29va2llIGNvb2tpZSA9IHprQ29va2llLmdldFZhbHVl\nKCk7CiAgICAgICAgY29va2llLmRlbGV0ZUZyb21ab29LZWVwZXIoemtjLCBj\nb25mLCB6a0Nvb2tpZS5nZXRWZXJzaW9uKCkpOwogICAgfQp9Cg==\n","encoding":"base64"}

