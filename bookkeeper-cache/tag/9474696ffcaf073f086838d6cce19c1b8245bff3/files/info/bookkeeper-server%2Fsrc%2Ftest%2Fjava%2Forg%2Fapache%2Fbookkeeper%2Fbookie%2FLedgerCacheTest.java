{"sha":"b62c69508379f99df5506904bb2598c91de87b00","node_id":"MDQ6QmxvYjE1NzU5NTY6YjYyYzY5NTA4Mzc5Zjk5ZGY1NTA2OTA0YmIyNTk4YzkxZGU4N2IwMA==","size":17155,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b62c69508379f99df5506904bb2598c91de87b00","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWUuTm9MZWRnZXJFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNv\nbmYuVGVzdEJLQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhLkxlZGdlck1hbmFnZXJGYWN0b3J5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuQm9va0tlZXBlckNvbnN0YW50czsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlNuYXBzaG90TWFw\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0lu\ndGVnZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5MaW5rZWRCbG9j\na2luZ1F1ZXVlOwoKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5pby5GaWxl\nVXRpbHM7CmltcG9ydCBvcmcuanVuaXQuQWZ0ZXI7CmltcG9ydCBvcmcuanVu\naXQuQXNzZXJ0OwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9y\nZy5qdW5pdC5UZXN0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IHN0YXRpYyBvcmcu\nanVuaXQuQXNzZXJ0Lio7CgovKioKICogTGVkZ2VyQ2FjaGUgcmVsYXRlZCB0\nZXN0IGNhc2VzCiAqLwpwdWJsaWMgY2xhc3MgTGVkZ2VyQ2FjaGVUZXN0IHsK\nICAgIHByaXZhdGUgZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihMZWRnZXJDYWNoZVRlc3QuY2xhc3MpOwoKICAg\nIFNuYXBzaG90TWFwPExvbmcsIEJvb2xlYW4+IGFjdGl2ZUxlZGdlcnM7CiAg\nICBMZWRnZXJNYW5hZ2VyRmFjdG9yeSBsZWRnZXJNYW5hZ2VyRmFjdG9yeTsK\nICAgIExlZGdlckNhY2hlIGxlZGdlckNhY2hlOwogICAgVGhyZWFkIGZsdXNo\nVGhyZWFkOwogICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwogICAgRmls\nZSB0eG5EaXIsIGxlZGdlckRpcjsKCiAgICBwcml2YXRlIEJvb2tpZSBib29r\naWU7CgogICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICB0eG5EaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJsZWRnZXJjYWNoZSIsICJ0eG4iKTsKICAgICAgICB0eG5EaXIu\nZGVsZXRlKCk7CiAgICAgICAgdHhuRGlyLm1rZGlyKCk7CiAgICAgICAgbGVk\nZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgibGVkZ2VyY2FjaGUiLCAi\nbGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAg\nIGxlZGdlckRpci5ta2RpcigpOwogICAgICAgIC8vIGNyZWF0ZSBjdXJyZW50\nIGRpcgogICAgICAgIG5ldyBGaWxlKGxlZGdlckRpciwgQm9va0tlZXBlckNv\nbnN0YW50cy5DVVJSRU5UX0RJUikubWtkaXIoKTsKCiAgICAgICAgY29uZiA9\nIFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2VydmVyQ29uZmlndXJhdGlvbigp\nOwogICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKG51bGwpOwogICAgICAgIGNv\nbmYuc2V0Sm91cm5hbERpck5hbWUodHhuRGlyLmdldFBhdGgoKSk7CiAgICAg\nICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRn\nZXJEaXIuZ2V0UGF0aCgpIH0pOwogICAgICAgIGJvb2tpZSA9IG5ldyBCb29r\naWUoY29uZik7CgogICAgICAgIGxlZGdlck1hbmFnZXJGYWN0b3J5ID0KICAg\nICAgICAgICAgTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2VyTWFuYWdl\nckZhY3RvcnkoY29uZiwgbnVsbCk7CiAgICAgICAgYWN0aXZlTGVkZ2VycyA9\nIG5ldyBTbmFwc2hvdE1hcDxMb25nLCBCb29sZWFuPigpOwogICAgICAgIGxl\nZGdlckNhY2hlID0gKChJbnRlcmxlYXZlZExlZGdlclN0b3JhZ2UpIGJvb2tp\nZS5sZWRnZXJTdG9yYWdlKS5sZWRnZXJDYWNoZTsKICAgIH0KCiAgICBAQWZ0\nZXIKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGZsdXNoVGhyZWFkICE9IG51bGwpIHsKICAgICAg\nICAgICAgZmx1c2hUaHJlYWQuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIGZs\ndXNoVGhyZWFkLmpvaW4oKTsKICAgICAgICB9CiAgICAgICAgYm9va2llLmxl\nZGdlclN0b3JhZ2Uuc2h1dGRvd24oKTsKICAgICAgICBsZWRnZXJNYW5hZ2Vy\nRmFjdG9yeS51bmluaXRpYWxpemUoKTsKICAgICAgICBGaWxlVXRpbHMuZGVs\nZXRlRGlyZWN0b3J5KHR4bkRpcik7CiAgICAgICAgRmlsZVV0aWxzLmRlbGV0\nZURpcmVjdG9yeShsZWRnZXJEaXIpOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBuZXdMZWRnZXJDYWNoZSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKGxlZGdlckNhY2hlICE9IG51bGwpIHsKICAgICAgICAgICAgbGVk\nZ2VyQ2FjaGUuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgbGVkZ2VyQ2Fj\naGUgPSAoKEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZSkgYm9va2llLmxlZGdl\nclN0b3JhZ2UpLmxlZGdlckNhY2hlID0gbmV3IExlZGdlckNhY2hlSW1wbCgK\nICAgICAgICAgICAgICAgIGNvbmYsIGFjdGl2ZUxlZGdlcnMsIGJvb2tpZS5n\nZXRJbmRleERpcnNNYW5hZ2VyKCkpOwogICAgICAgIGZsdXNoVGhyZWFkID0g\nbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1\nbigpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgc2xlZXAoY29uZi5nZXRGbHVzaEludGVydmFsKCkpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuZmx1c2hMZWRn\nZXIodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElu\ndGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAvLyBraWxsZWQgYnkgdGVhcmRvd24KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlv\nbiBpbiBmbHVzaCB0aHJlYWQiLCBlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfTsKICAgICAgICBmbHVzaFRocmVhZC5zdGFydCgpOwog\nICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0QWRkRW50cnlFeGNlcHRpb24oKSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIC8vIHNldCBwYWdlIGxpbWl0YXRpb24KICAgICAgICBjb25m\nLnNldFBhZ2VMaW1pdCgxMCk7CiAgICAgICAgLy8gY3JlYXRlIGEgbGVkZ2Vy\nIGNhY2hlCiAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsKICAgICAgICAvKgog\nICAgICAgICAqIFBvcHVsYXRlIGxlZGdlciBjYWNoZS4KICAgICAgICAgKi8K\nICAgICAgICB0cnkgewogICAgICAgICAgICBieXRlW10gbWFzdGVyS2V5ID0g\nImJsYWgiLmdldEJ5dGVzKCk7CiAgICAgICAgICAgIGZvciggaW50IGkgPSAw\nOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hl\nLnNldE1hc3RlcktleSgobG9uZylpLCBtYXN0ZXJLZXkpOwogICAgICAgICAg\nICAgICAgbGVkZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoaSwgMCwgaSo4KTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJHb3QgSU9FeGNlcHRpb24uIiwg\nZSk7CiAgICAgICAgICAgIGZhaWwoIkZhaWxlZCB0byBhZGQgZW50cnkuIik7\nCiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0TGVkZ2VyRXZpY3Rpb24oKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBpbnQgbnVtRW50cmllcyA9IDEwOwogICAgICAg\nIC8vIGxpbWl0IG9wZW4gZmlsZXMgJiBwYWdlcwogICAgICAgIGNvbmYuc2V0\nT3BlbkZpbGVMaW1pdCgxKS5zZXRQYWdlTGltaXQoMikKICAgICAgICAgICAg\nLnNldFBhZ2VTaXplKDggKiBudW1FbnRyaWVzKTsKICAgICAgICAvLyBjcmVh\ndGUgbGVkZ2VyIGNhY2hlCiAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBpbnQgbnVtTGVkZ2VycyA9IDM7CiAg\nICAgICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkgPSAiYmxhaCIuZ2V0Qnl0ZXMo\nKTsKICAgICAgICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRnZXJzOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLnNldE1hc3Rlcktl\neSgobG9uZylpLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaj0wOyBqPG51bUVudHJpZXM7IGorKykgewogICAgICAgICAgICAgICAg\nICAgIGxlZGdlckNhY2hlLnB1dEVudHJ5T2Zmc2V0KGksIGosIGkgKiBudW1F\nbnRyaWVzICsgaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIkdvdCBFeGNlcHRpb24uIiwgZSk7CiAgICAgICAgICAgIGZh\naWwoIkZhaWxlZCB0byBhZGQgZW50cnkuIik7CiAgICAgICAgfQogICAgfQoK\nICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nRGVsZXRlTGVkZ2VyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaW50\nIG51bUVudHJpZXMgPSAxMDsKICAgICAgICAvLyBsaW1pdCBvcGVuIGZpbGVz\nICYgcGFnZXMKICAgICAgICBjb25mLnNldE9wZW5GaWxlTGltaXQoOTk5KS5z\nZXRQYWdlTGltaXQoMikKICAgICAgICAgICAgLnNldFBhZ2VTaXplKDggKiBu\ndW1FbnRyaWVzKTsKICAgICAgICAvLyBjcmVhdGUgbGVkZ2VyIGNhY2hlCiAg\nICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpbnQgbnVtTGVkZ2VycyA9IDI7CiAgICAgICAgICAgIGJ5dGVbXSBt\nYXN0ZXJLZXkgPSAiYmxhaCIuZ2V0Qnl0ZXMoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaT0xOyBpPD1udW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAg\nICAgIGxlZGdlckNhY2hlLnNldE1hc3RlcktleSgobG9uZylpLCBtYXN0ZXJL\nZXkpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaj0wOyBqPG51bUVudHJp\nZXM7IGorKykgewogICAgICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLnB1\ndEVudHJ5T2Zmc2V0KGksIGosIGkqbnVtRW50cmllcyArIGopOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGxlZGdl\nciBjYWNoZSBpcyBleGhhdXN0ZWQKICAgICAgICAgICAgLy8gZGVsZXRlIGxl\nZGdlcnMKICAgICAgICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRnZXJz\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLmRlbGV0ZUxl\nZGdlcigobG9uZylpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBj\ncmVhdGUgbnVtIGxlZGdlcnMgdG8gYWRkIGVudHJpZXMKICAgICAgICAgICAg\nZm9yIChpbnQgaT1udW1MZWRnZXJzKzE7IGk8PTIqbnVtTGVkZ2VyczsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5zZXRNYXN0ZXJLZXko\nKGxvbmcpaSwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGo9MDsgajxudW1FbnRyaWVzOyBqKyspIHsKICAgICAgICAgICAgICAgICAg\nICBsZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNldChpLCBqLCBpKm51bUVudHJp\nZXMgKyBqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5l\ncnJvcigiR290IEV4Y2VwdGlvbi4iLCBlKTsKICAgICAgICAgICAgZmFpbCgi\nRmFpbGVkIHRvIGFkZCBlbnRyeS4iKTsKICAgICAgICB9CiAgICB9CgogICAg\nQFRlc3QodGltZW91dD0zMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RQYWdl\nRXZpY3Rpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgbnVt\nTGVkZ2VycyA9IDEwOwogICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkgPSAiYmxh\naCIuZ2V0Qnl0ZXMoKTsKICAgICAgICAvLyBsaW1pdCBwYWdlIGNvdW50CiAg\nICAgICAgY29uZi5zZXRPcGVuRmlsZUxpbWl0KDk5OTk5OSkuc2V0UGFnZUxp\nbWl0KDMpOwogICAgICAgIC8vIGNyZWF0ZSBsZWRnZXIgY2FjaGUKICAgICAg\nICBuZXdMZWRnZXJDYWNoZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIC8vIGNyZWF0ZSBzZXJ2ZXJhbCBsZWRnZXJzCiAgICAgICAgICAgIGZvciAo\naW50IGk9MTsgaTw9bnVtTGVkZ2VyczsgaSsrKSB7CiAgICAgICAgICAgICAg\nICBsZWRnZXJDYWNoZS5zZXRNYXN0ZXJLZXkoKGxvbmcpaSwgbWFzdGVyS2V5\nKTsKICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLnB1dEVudHJ5T2Zmc2V0\nKGksIDAsIGkqOCk7CiAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5wdXRF\nbnRyeU9mZnNldChpLCAxLCBpKjgpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICAvLyBmbHVzaCBhbGwgZmlyc3QgdG8gY2xlYW4gcHJldmlvdXMgZGly\ndHkgbGVkZ2VycwogICAgICAgICAgICBsZWRnZXJDYWNoZS5mbHVzaExlZGdl\ncih0cnVlKTsKICAgICAgICAgICAgLy8gZmx1c2ggYWxsCiAgICAgICAgICAg\nIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2VyKHRydWUpOwoKICAgICAgICAgICAg\nLy8gZGVsZXRlIHNlcnZlcmFsIGxlZGdlcnMKICAgICAgICAgICAgZm9yIChp\nbnQgaT0xOyBpPD1udW1MZWRnZXJzLzI7IGkrKykgewogICAgICAgICAgICAg\nICAgbGVkZ2VyQ2FjaGUuZGVsZXRlTGVkZ2VyKGkpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyBib29raWUgcmVzdGFydHMKICAgICAgICAgICAg\nbmV3TGVkZ2VyQ2FjaGUoKTsKCiAgICAgICAgICAgIC8vIHNpbXVsYXRlIHJl\ncGxheWluZyBqb3VybmFscyB0byBhZGQgZW50cmllcyBhZ2FpbgogICAgICAg\nICAgICBmb3IgKGludCBpPTE7IGk8PW51bUxlZGdlcnM7IGkrKykgewogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJD\nYWNoZS5wdXRFbnRyeU9mZnNldChpLCAxLCBpKjgpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoTm9MZWRnZXJFeGNlcHRpb24gbnNsZSkgewogICAgICAg\nICAgICAgICAgICAgIGlmIChpPD1udW1MZWRnZXJzLzIpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gaXQgaXMgb2sKICAgICAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkVycm9yIHB1dCBlbnRyeSBvZmZzZXQgOiAiLCBuc2xlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgZmFpbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlLiIp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiR290IEV4Y2VwdGlvbi4iLCBlKTsKICAg\nICAgICAgICAgZmFpbCgiRmFpbGVkIHRvIGFkZCBlbnRyeS4iKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IExlZGdlciBDYWNoZSBm\nbHVzaCBmYWlsdXJlCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9MzAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0TGVkZ2VyQ2FjaGVGbHVzaEZhaWx1cmVP\nbkRpc2tGdWxsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBs\nZWRnZXJEaXIxID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYmtUZXN0IiwgIi5k\naXIiKTsKICAgICAgICBsZWRnZXJEaXIxLmRlbGV0ZSgpOwogICAgICAgIEZp\nbGUgbGVkZ2VyRGlyMiA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJrVGVzdCIs\nICIuZGlyIik7CiAgICAgICAgbGVkZ2VyRGlyMi5kZWxldGUoKTsKICAgICAg\nICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBUZXN0QktDb25maWd1cmF0\naW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICBjb25mLnNl\ndExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpcjEuZ2V0\nQWJzb2x1dGVQYXRoKCksIGxlZGdlckRpcjIuZ2V0QWJzb2x1dGVQYXRoKCkg\nfSk7CgogICAgICAgIEJvb2tpZSBib29raWUgPSBuZXcgQm9va2llKGNvbmYp\nOwogICAgICAgIEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZSBsZWRnZXJTdG9y\nYWdlID0gKChJbnRlcmxlYXZlZExlZGdlclN0b3JhZ2UpIGJvb2tpZS5sZWRn\nZXJTdG9yYWdlKTsKICAgICAgICBMZWRnZXJDYWNoZUltcGwgbGVkZ2VyQ2Fj\naGUgPSAoTGVkZ2VyQ2FjaGVJbXBsKSBsZWRnZXJTdG9yYWdlLmxlZGdlckNh\nY2hlOwogICAgICAgIC8vIENyZWF0ZSBsZWRnZXIgaW5kZXggZmlsZQogICAg\nICAgIGxlZGdlclN0b3JhZ2Uuc2V0TWFzdGVyS2V5KDEsICJrZXkiLmdldEJ5\ndGVzKCkpOwoKICAgICAgICBGaWxlSW5mbyBmaWxlSW5mbyA9IGxlZGdlckNh\nY2hlLmdldEluZGV4UGVyc2lzdGVuY2VNYW5hZ2VyKCkuZ2V0RmlsZUluZm8o\nTG9uZy52YWx1ZU9mKDEpLCBudWxsKTsKCiAgICAgICAgLy8gU2ltdWxhdGUg\ndGhlIGZsdXNoIGZhaWx1cmUKICAgICAgICBGaWxlSW5mbyBuZXdGaWxlSW5m\nbyA9IG5ldyBGaWxlSW5mbyhmaWxlSW5mby5nZXRMZigpLCBmaWxlSW5mby5n\nZXRNYXN0ZXJLZXkoKSk7CiAgICAgICAgbGVkZ2VyQ2FjaGUuZ2V0SW5kZXhQ\nZXJzaXN0ZW5jZU1hbmFnZXIoKS5maWxlSW5mb0NhY2hlLnB1dChMb25nLnZh\nbHVlT2YoMSksIG5ld0ZpbGVJbmZvKTsKICAgICAgICAvLyBBZGQgZW50cmll\ncwogICAgICAgIGxlZGdlclN0b3JhZ2UuYWRkRW50cnkoZ2VuZXJhdGVFbnRy\neSgxLCAxKSk7CiAgICAgICAgbGVkZ2VyU3RvcmFnZS5hZGRFbnRyeShnZW5l\ncmF0ZUVudHJ5KDEsIDIpKTsKICAgICAgICBsZWRnZXJTdG9yYWdlLmZsdXNo\nKCk7CgogICAgICAgIGxlZGdlclN0b3JhZ2UuYWRkRW50cnkoZ2VuZXJhdGVF\nbnRyeSgxLCAzKSk7CiAgICAgICAgLy8gYWRkIHRoZSBkaXIgdG8gZmFpbGVk\nIGRpcnMKICAgICAgICBib29raWUuZ2V0SW5kZXhEaXJzTWFuYWdlcigpLmFk\nZFRvRmlsbGVkRGlycygKICAgICAgICAgICAgICAgIG5ld0ZpbGVJbmZvLmdl\ndExmKCkuZ2V0UGFyZW50RmlsZSgpLmdldFBhcmVudEZpbGUoKS5nZXRQYXJl\nbnRGaWxlKCkpOwogICAgICAgIEZpbGUgYmVmb3JlID0gbmV3RmlsZUluZm8u\nZ2V0TGYoKTsKICAgICAgICAvLyBmbHVzaCBhZnRlciBkaXNrIGlzIGFkZGVk\nIGFzIGZhaWxlZC4KICAgICAgICBsZWRnZXJTdG9yYWdlLmZsdXNoKCk7CiAg\nICAgICAgRmlsZSBhZnRlciA9IG5ld0ZpbGVJbmZvLmdldExmKCk7CgogICAg\nICAgIGFzc2VydEVxdWFscygiUmVmZXJlbmNlIGNvdW50aW5nIGZvciB0aGUg\nZmlsZSBpbmZvIHNob3VsZCBiZSB6ZXJvLiIsIDAsIG5ld0ZpbGVJbmZvLmdl\ndFVzZUNvdW50KCkpOwoKICAgICAgICBhc3NlcnRGYWxzZSgiQWZ0ZXIgZmx1\nc2ggaW5kZXggZmlsZSBzaG91bGQgYmUgY2hhbmdlZCIsIGJlZm9yZS5lcXVh\nbHMoYWZ0ZXIpKTsKICAgICAgICAvLyBWZXJpZnkgd3JpdHRlbiBlbnRyaWVz\nCiAgICAgICAgQXNzZXJ0LmFzc2VydEFycmF5RXF1YWxzKGdlbmVyYXRlRW50\ncnkoMSwgMSkuYXJyYXkoKSwgbGVkZ2VyU3RvcmFnZS5nZXRFbnRyeSgxLCAx\nKS5hcnJheSgpKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0QXJyYXlFcXVhbHMo\nZ2VuZXJhdGVFbnRyeSgxLCAyKS5hcnJheSgpLCBsZWRnZXJTdG9yYWdlLmdl\ndEVudHJ5KDEsIDIpLmFycmF5KCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRB\ncnJheUVxdWFscyhnZW5lcmF0ZUVudHJ5KDEsIDMpLmFycmF5KCksIGxlZGdl\nclN0b3JhZ2UuZ2V0RW50cnkoMSwgMykuYXJyYXkoKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUZXN0IHRoYXQgaWYgd2UgYXJlIHdyaXRpbmcgdG8gbW9y\nZSBsZWRnZXJzIHRoYW4gdGhlcmUKICAgICAqIGFyZSBwYWdlcywgdGhlbiB3\nZSB3aWxsIG5vdCBmbHVzaCB0aGUgaW5kZXggYmVmb3JlIHRoZQogICAgICog\nZW50cmllcyBpbiB0aGUgZW50cnlsb2dnZXIgaGF2ZSBiZWVuIHBlcnNpc3Rl\nZCB0byBkaXNrLgogICAgICoge0BsaW5rIGh0dHBzOi8vaXNzdWVzLmFwYWNo\nZS5vcmcvamlyYS9icm93c2UvQk9PS0tFRVBFUi00NDd9CiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0SW5k\nZXhQYWdlRXZpY3Rpb25Xcml0ZU9yZGVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgZmluYWwgaW50IG51bUxlZGdlcnMgPSAxMDsKICAgICAgICBG\naWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUi\nLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxEaXIuZGVsZXRlKCk7CiAg\nICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVj\na0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9y\neShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUgbGVkZ2VyRGlyID0gRmls\nZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxlZGdlciIpOwogICAgICAg\nIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBsZWRnZXJEaXIubWtkaXIo\nKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9v\na2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKSk7CgogICAgICAg\nIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRp\nb24ubmV3U2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRa\na1NlcnZlcnMobnVsbCkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1l\nKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0TGVkZ2Vy\nRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9\nKQogICAgICAgICAgICAuc2V0Rmx1c2hJbnRlcnZhbCgxMDAwKQogICAgICAg\nICAgICAuc2V0UGFnZUxpbWl0KDEpCiAgICAgICAgICAgIC5zZXRTb3J0ZWRM\nZWRnZXJTdG9yYWdlRW5hYmxlZChmYWxzZSk7CgogICAgICAgIEJvb2tpZSBi\nID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICBiLnN0YXJ0KCk7CiAgICAg\nICAgZm9yIChpbnQgaSA9IDE7IGkgPD0gbnVtTGVkZ2VyczsgaSsrKSB7CiAg\nICAgICAgICAgIEJ5dGVCdWZmZXIgcGFja2V0ID0gZ2VuZXJhdGVFbnRyeShp\nLCAxKTsKICAgICAgICAgICAgYi5hZGRFbnRyeShwYWNrZXQsIG5ldyBCb29r\naWUuTm9wV3JpdGVDYWxsYmFjaygpLCBudWxsLCAicGFzc3dkIi5nZXRCeXRl\ncygpKTsKICAgICAgICB9CgogICAgICAgIGNvbmYgPSBUZXN0QktDb25maWd1\ncmF0aW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAu\nc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGly\nTmFtZShqb3VybmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNldExl\nZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRo\nKCkgfSk7CgogICAgICAgIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAg\nIGZvciAoaW50IGkgPSAxOyBpIDw9IG51bUxlZGdlcnM7IGkrKykgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYi5yZWFkRW50cnkoaSwg\nMSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0xlZGdlckV4Y2Vw\ndGlvbiBubGUpIHsKICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgZmluZSwg\nbWVhbnMgdGhlIGxlZGdlciB3YXMgbmV2ZXIgd3JpdHRlbiB0byB0aGUgaW5k\nZXggY2FjaGUKICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscygiTm8gbGVk\nZ2VyIHNob3VsZCBvbmx5IGhhcHBlbiBmb3IgdGhlIGxhc3QgbGVkZ2VyIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLCBudW1MZWRnZXJzKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNlcHRpb24g\nbmVlKSB7CiAgICAgICAgICAgICAgICAvLyB0aGlzIGlzIGZpbmUsIG1lYW5z\nIHRoZSBsZWRnZXIgd2FzIHdyaXR0ZW4gdG8gdGhlIGluZGV4IGNhY2hlLCBi\ndXQgbm90CiAgICAgICAgICAgICAgICAvLyB0aGUgZW50cnkgbG9nCiAgICAg\nICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAg\nICAgICAgTE9HLmluZm8oIlNob3VsZG4ndCBoYXZlIHJlY2VpdmVkIElPRXhj\nZXB0aW9uIiwgaW9lKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4n\ndCB0aHJvdyBJT0V4Y2VwdGlvbiwgc2hvdWxkIHNheSB0aGF0IGVudHJ5IGlz\nIG5vdCBmb3VuZCIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nCiAgICAvKioKICAgICAqIHtAbGluayBodHRwczovL2lzc3Vlcy5hcGFjaGUu\nb3JnL2ppcmEvYnJvd3NlL0JPT0tLRUVQRVItNTI0fQogICAgICogQ2hlY2tz\nIHRoYXQgZ2V0TGVkZ2VyRW50cnlQYWdlIGRvZXMgbm90IHRocm93IGFuIE5Q\nRSBpbiB0aGUKICAgICAqIGNhc2UgZ2V0RnJvbVRhYmxlIHJldHVybnMgYSBu\ndWxsIGxlZGdlciBlbnRyeSBwYWdlIHJlZmVyZW5jZS4KICAgICAqIFRoaXMg\nTlBFIG1pZ2h0IGtpbGwgdGhlIHN5bmMgdGhyZWFkIGxlYXZpbmcgYSBib29r\naWUgd2l0aCBubwogICAgICogc3luYyB0aHJlYWQgcnVubmluZy4KICAgICAq\nCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0\nKHRpbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY1RocmVh\nZE5QRSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbmV3TGVkZ2Vy\nQ2FjaGUoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICAoKExlZGdlckNh\nY2hlSW1wbCkgbGVkZ2VyQ2FjaGUpLmdldEluZGV4UGFnZU1hbmFnZXIoKS5n\nZXRMZWRnZXJFbnRyeVBhZ2UoMEwsIDBMLCB0cnVlKTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkV4\nY2VwdGlvbiB3aGVuIHRyeWluZyB0byBnZXQgYSBsZWRnZXIgZW50cnkgcGFn\nZSIsIGUpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgaGF2ZSB0aHJv\nd24gYW4gZXhjZXB0aW9uIik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogUmFjZSB3aGVyZSBhIGZsdXNoIHdvdWxkIGZhaWwgYmVjYXVzZSBh\nIGdhcmJhZ2UgY29sbGVjdGlvbiBvY2N1cnJlZCBhdAogICAgICogdGhlIHdy\nb25nIHRpbWUuCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hl\nLm9yZy9qaXJhL2Jyb3dzZS9CT09LS0VFUEVSLTYwNH0KICAgICAqLwogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RGbHVz\naERlbGV0ZVJhY2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBuZXdM\nZWRnZXJDYWNoZSgpOwogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgcmMg\nPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAgICAgICBmaW5hbCBMaW5rZWRC\nbG9ja2luZ1F1ZXVlPExvbmc+IGxlZGdlclEgPSBuZXcgTGlua2VkQmxvY2tp\nbmdRdWV1ZTxMb25nPigxKTsKICAgICAgICBmaW5hbCBieXRlW10gbWFzdGVy\nS2V5ID0gIm1hc3RlcktleSIuZ2V0Qnl0ZXMoKTsKICAgICAgICBUaHJlYWQg\nbmV3TGVkZ2VyVGhyZWFkID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IDEwMDAgJiYgcmMuZ2V0KCkgPT0gMDsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5zZXRNYXN0ZXJLZXkoaSwg\nbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdl\nclEucHV0KChsb25nKWkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgcmMuc2V0KC0xKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4gbmV3IGxlZGdl\nciB0aHJlYWQiLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgbmV3TGVkZ2VyVGhy\nZWFkLnN0YXJ0KCk7CgogICAgICAgIFRocmVhZCBmbHVzaFRocmVhZCA9IG5l\ndyBUaHJlYWQoKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4o\nKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIExvbmcgaWQgPSBsZWRnZXJRLnBlZWsoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChpZCA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiUHV0IGVudHJ5IGZvciB7fSIsIGlkKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbGVkZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoKGxvbmcpaWQs\nIDEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nQm9va2llLk5vTGVkZ2VyRXhjZXB0aW9uIG5sZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC8vaWdub3JlCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRn\nZXJDYWNoZS5mbHVzaExlZGdlcih0cnVlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJjLnNldCgtMSk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGlu\nIGZsdXNoIHRocmVhZCIsIGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICBmbHVzaFRo\ncmVhZC5zdGFydCgpOwoKICAgICAgICBUaHJlYWQgZGVsZXRlVGhyZWFkID0g\nbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1\nbigpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9uZyBpZCA9IGxlZGdlclEudGFrZSgpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIkRlbGV0aW5nIHt9IiwgaWQp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuZGVs\nZXRlTGVkZ2VyKGlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJjLnNldCgtMSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIGRlbGV0ZSB0aHJl\nYWQiLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH07CiAgICAgICAgZGVsZXRlVGhyZWFkLnN0YXJ0\nKCk7CgogICAgICAgIG5ld0xlZGdlclRocmVhZC5qb2luKCk7CiAgICAgICAg\nYXNzZXJ0RXF1YWxzKCJTaG91bGQgaGF2ZSBiZWVuIG5vIGVycm9ycyIsIHJj\nLmdldCgpLCAwKTsKCiAgICAgICAgZGVsZXRlVGhyZWFkLmludGVycnVwdCgp\nOwogICAgICAgIGZsdXNoVGhyZWFkLmludGVycnVwdCgpOwogICAgfQoKICAg\nIHByaXZhdGUgQnl0ZUJ1ZmZlciBnZW5lcmF0ZUVudHJ5KGxvbmcgbGVkZ2Vy\nLCBsb25nIGVudHJ5KSB7CiAgICAgICAgYnl0ZVtdIGRhdGEgPSAoImxlZGdl\nci0iICsgbGVkZ2VyICsgIi0iICsgZW50cnkpLmdldEJ5dGVzKCk7CiAgICAg\nICAgQnl0ZUJ1ZmZlciBiYiA9IEJ5dGVCdWZmZXIud3JhcChuZXcgYnl0ZVs4\nICsgOCArIGRhdGEubGVuZ3RoXSk7CiAgICAgICAgYmIucHV0TG9uZyhsZWRn\nZXIpOwogICAgICAgIGJiLnB1dExvbmcoZW50cnkpOwogICAgICAgIGJiLnB1\ndChkYXRhKTsKICAgICAgICBiYi5mbGlwKCk7CiAgICAgICAgcmV0dXJuIGJi\nOwogICAgfQp9Cg==\n","encoding":"base64"}

