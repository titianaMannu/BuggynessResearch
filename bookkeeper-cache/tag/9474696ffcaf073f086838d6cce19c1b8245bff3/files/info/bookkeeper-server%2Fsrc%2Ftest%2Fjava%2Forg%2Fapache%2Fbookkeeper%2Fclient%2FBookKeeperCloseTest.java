{"sha":"89790f66feca1e4098b7be717c8b37fc210fe274","node_id":"MDQ6QmxvYjE1NzU5NTY6ODk3OTBmNjZmZWNhMWU0MDk4YjdiZTcxN2M4YjM3ZmMyMTBmZTI3NA==","size":21449,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/89790f66feca1e4098b7be717c8b37fc210fe274","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWU7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5\nbmNDYWxsYmFjay5BZGRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5DbG9zZUNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxi\nYWNrLkNyZWF0ZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb24uQktD\nbGllbnRDbG9zZWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0LkJvb2tpZVNvY2tl\ndEFkZHJlc3M7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVy\nSW50ZXJuYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci50ZXN0LkJvb2tLZWVwZXJDbHVzdGVyVGVzdENh\nc2U7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9y\ndCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1\nZmZlcjsKaW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3Vu\ndERvd25MYXRjaDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVV\nbml0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21p\nY0ludGVnZXI7CgppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuKjsK\nCi8qKgogKiBUaGlzIHVuaXQgdGVzdCB2ZXJpZmllcyB0aGUgYmVoYXZpb3Ig\nb2YgYm9va2tlZXBlciBhcGlzLCB3aGVyZSB0aGUgb3BlcmF0aW9ucwogKiBh\ncmUgYmVpbmcgZXhlY3V0ZWQgdGhyb3VnaCBhIGNsb3NlZCBib29ra2VlcGVy\nIGNsaWVudAogKi8KcHVibGljIGNsYXNzIEJvb2tLZWVwZXJDbG9zZVRlc3Qg\nZXh0ZW5kcyBCb29rS2VlcGVyQ2x1c3RlclRlc3RDYXNlIHsKCiAgICAvLyBE\nZXBlbmRpbmcgb24gdGhlIHRhc3RlLCBzZWxlY3QgdGhlIGFtb3VudCBvZiBs\nb2dnaW5nCiAgICAvLyBieSBkZWNvbW1lbnRpbmcgb25lIG9mIHRoZSB0d28g\nbGluZXMgYmVsb3cKICAgIC8vIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2Vy\nLmdldFJvb3RMb2dnZXIoKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAgICAgICAgIC5nZXRMb2dn\nZXIoQm9va0tlZXBlckNsb3NlVGVzdC5jbGFzcyk7CiAgICBwcml2YXRlIERp\nZ2VzdFR5cGUgZGlnZXN0VHlwZSA9IERpZ2VzdFR5cGUuQ1JDMzI7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgUEFTU1dPUkQgPSAidGVzdFBh\nc3N3ZCI7CgogICAgcHVibGljIEJvb2tLZWVwZXJDbG9zZVRlc3QoKSB7CiAg\nICAgICAgc3VwZXIoMyk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlc3Rh\ncnRCb29raWVTbG93KCkgdGhyb3dzIEV4Y2VwdGlvbnsKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBraWxsQm9va2llKDApOwoKICAgICAg\nICBCb29raWUgZGVsYXlCb29raWUgPSBuZXcgQm9va2llKGNvbmYpIHsKICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcmVjb3ZlcnlBZGRFbnRyeShCeXRlQnVmZmVyIGVudHJ5LCBXcml0\nZUNhbGxiYWNrIGNiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBPYmplY3QgY3R4LCBieXRlW10gbWFzdGVyS2V5KQog\nICAgICAgICAgICAgICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEJv\nb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDUwMDApOwogICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGllKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSwgb25s\neSBpbnRlcnJ1cHRlZCBpZiBzaHV0dGluZyBkb3duLAogICAgICAgICAgICAg\nICAgICAgICAgICAvLyBhbmQgYW4gZXhjZXB0aW9uIHdvdWxkIHNwYW0gdGhl\nIGxvZ3MKICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRU\naHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgc3VwZXIucmVjb3ZlcnlBZGRFbnRyeShlbnRy\neSwgY2IsIGN0eCwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIGFkZEVudHJ5KEJ5dGVCdWZmZXIgZW50cnksIFdyaXRlQ2FsbGJh\nY2sgY2IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBP\nYmplY3QgY3R4LCBieXRlW10gbWFzdGVyS2V5KQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgVGhyZWFkLnNsZWVwKDUwMDApOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGlnbm9yZSwgb25seSBpbnRlcnJ1cHRlZCBp\nZiBzaHV0dGluZyBkb3duLAogICAgICAgICAgICAgICAgICAgICAgICAvLyBh\nbmQgYW4gZXhjZXB0aW9uIHdvdWxkIHNwYW0gdGhlIGxvZ3MKICAgICAgICAg\nICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1\ncHQoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgc3VwZXIuYWRkRW50cnkoZW50cnksIGNiLCBjdHgsIG1hc3RlcktleSk7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICBwdWJsaWMgQnl0ZUJ1ZmZlciByZWFkRW50cnko\nbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkKQogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIE5vTGVkZ2VyRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICBUaHJlYWQuc2xlZXAoNTAwMCk7CiAgICAgICAgICAgICAgICAg\nICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gaWdub3JlLCBvbmx5IGludGVycnVwdGVk\nIGlmIHNodXR0aW5nIGRvd24sCiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGFuZCBhbiBleGNlcHRpb24gd291bGQgc3BhbSB0aGUgbG9ncwogICAgICAg\nICAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVy\ncnVwdCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gc3VwZXIucmVhZEVudHJ5KGxlZGdlcklkLCBlbnRyeUlk\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICBi\nc0NvbmZzLmFkZChjb25mKTsKICAgICAgICBicy5hZGQoc3RhcnRCb29raWUo\nY29uZiwgZGVsYXlCb29raWUpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRl\nc3QgdGhhdCBjcmVhdGVsZWRnZXIgdXNpbmcgYm9va2tlZXBlciBjbGllbnQg\nd2hpY2ggaXMgY2xvc2VkIHNob3VsZAogICAgICogdGhyb3cgQ2xpZW50Q2xv\nc2VkRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAw\nMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDcmVhdGVMZWRnZXIoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBCb29rS2VlcGVyIGJrID0gbmV3IEJvb2tL\nZWVwZXIoYmFzZUNsaWVudENvbmYsIHprYyk7CiAgICAgICAgTE9HLmluZm8o\nIkNsb3NpbmcgYm9va2tlZXBlciBjbGllbnQiKTsKICAgICAgICBiay5jbG9z\nZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJrLmNyZWF0ZUxlZGdl\ncihkaWdlc3RUeXBlLCBQQVNTV09SRC5nZXRCeXRlcygpKTsKICAgICAgICAg\nICAgZmFpbCgic2hvdWxkIGhhdmUgZmFpbGVkLCBjbGllbnQgaXMgY2xvc2Vk\nIik7CiAgICAgICAgfSBjYXRjaCAoQktDbGllbnRDbG9zZWRFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0CiAgICAgICAgfQoKICAgICAg\nICAvLyB1c2luZyBhc3luYywgYmVjYXVzZSB0aGlzIGNvdWxkIHRyaWdnZXIg\nYW4gYXNzZXJ0aW9uCiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciByZXR1\ncm5Db2RlID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggb3BlbkxhdGNoID0gbmV3IENvdW50RG93bkxhdGNo\nKDEpOwogICAgICAgIENyZWF0ZUNhbGxiYWNrIGNiID0gbmV3IENyZWF0ZUNh\nbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgY3JlYXRlQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5k\nbGUgbGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgIHJldHVybkNv\nZGUuc2V0KHJjKTsKICAgICAgICAgICAgICAgIG9wZW5MYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgYmsuYXN5\nbmNDcmVhdGVMZWRnZXIoMywgMiwgZGlnZXN0VHlwZSwgUEFTU1dPUkQuZ2V0\nQnl0ZXMoKSwgY2IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Bl\nbkxhdGNoKTsKCiAgICAgICAgTE9HLmluZm8oIldhaXRpbmcgdG8gZmluaXNo\nIHRoZSBsZWRnZXIgY3JlYXRpb24iKTsKICAgICAgICAvLyB3YWl0IGZvciBj\ncmVhdGluZyB0aGUgbGVkZ2VyCiAgICAgICAgYXNzZXJ0VHJ1ZSgiY3JlYXRl\nIGxlZGdlciBjYWxsIHNob3VsZCBoYXZlIGNvbXBsZXRlZCIsCiAgICAgICAg\nICAgICAgICBvcGVuTGF0Y2guYXdhaXQoMjAsIFRpbWVVbml0LlNFQ09ORFMp\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlN1Y2Nlc2Z1bGx5IGNyZWF0ZWQg\nbGVkZ2VyIHRocm91Z2ggY2xvc2VkIGJrY2xpZW50ISIsCiAgICAgICAgICAg\nICAgICBCS0V4Y2VwdGlvbi5Db2RlLkNsaWVudENsb3NlZEV4Y2VwdGlvbiwg\ncmV0dXJuQ29kZS5nZXQoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0\nIHRoYXQgb3BlbmluZyBhIGxlZGdlciB1c2luZyBib29ra2VlcGVyIGNsaWVu\ndCB3aGljaCBpcyBjbG9zZWQgc2hvdWxkCiAgICAgKiB0aHJvdyBDbGllbnRD\nbG9zZWRFeGNlcHRpb24KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEZlbmNlTGVkZ2VyKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgQm9va0tlZXBlciBiayA9IG5ldyBCb29r\nS2VlcGVyKGJhc2VDbGllbnRDb25mLCB6a2MpOwogICAgICAgIExPRy5pbmZv\nKCJDcmVhdGUgbGVkZ2VyIGFuZCBhZGQgZW50cmllcyB0byBpdCIpOwogICAg\nICAgIExlZGdlckhhbmRsZSBsaCA9IGNyZWF0ZUxlZGdlcldpdGhFbnRyaWVz\nKGJrLCAxMDApOwogICAgICAgIExPRy5pbmZvKCJDbG9zaW5nIGJvb2trZWVw\nZXIgY2xpZW50Iik7CgogICAgICAgIHJlc3RhcnRCb29raWVTbG93KCk7Cgog\nICAgICAgIGJrLmNsb3NlKCk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGJrLm9wZW5MZWRnZXIobGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgUEFTU1dP\nUkQuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIGZhaWwoInNob3VsZCBoYXZl\nIGZhaWxlZCwgY2xpZW50IGlzIGNsb3NlZCIpOwogICAgICAgIH0gY2F0Y2gg\nKEJLQ2xpZW50Q2xvc2VkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8g\nY29ycmVjdAogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nYmsub3BlbkxlZGdlck5vUmVjb3ZlcnkobGguZ2V0SWQoKSwgZGlnZXN0VHlw\nZSwgUEFTU1dPUkQuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIGZhaWwoInNo\nb3VsZCBoYXZlIGZhaWxlZCwgY2xpZW50IGlzIGNsb3NlZCIpOwogICAgICAg\nIH0gY2F0Y2ggKEJLQ2xpZW50Q2xvc2VkRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgLy8gY29ycmVjdAogICAgICAgIH0KCiAgICAgICAgZmluYWwgQXRv\nbWljSW50ZWdlciByZXR1cm5Db2RlID0gbmV3IEF0b21pY0ludGVnZXIoMCk7\nCiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggb3BlbkxhdGNoID0gbmV3\nIENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIEFzeW5jQ2FsbGJhY2suT3Bl\nbkNhbGxiYWNrIGNiID0gbmV3IEFzeW5jQ2FsbGJhY2suT3BlbkNhbGxiYWNr\nKCkgewogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVuQ29tcGxldGUoaW50\nIHJjLCBMZWRnZXJIYW5kbGUgbGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgICAgIHJldHVybkNvZGUuc2V0KHJjKTsKICAgICAgICAgICAgICAgIG9w\nZW5MYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH07\nCiAgICAgICAgYmsuYXN5bmNPcGVuTGVkZ2VyKGxoLmdldElkKCksIGRpZ2Vz\ndFR5cGUsIFBBU1NXT1JELmdldEJ5dGVzKCksIGNiLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICBvcGVuTGF0Y2gpOwoKICAgICAgICBMT0cuaW5mbygi\nV2FpdGluZyB0byBvcGVuIHRoZSBsZWRnZXIgYXN5bmNocm9ub3VzbHkiKTsK\nICAgICAgICBhc3NlcnRUcnVlKCJPcGVuIGNhbGwgc2hvdWxkIGhhdmUgY29t\ncGxldGVkIiwKICAgICAgICAgICAgICAgIG9wZW5MYXRjaC5hd2FpdCgyMCwg\nVGltZVVuaXQuU0VDT05EUykpOwogICAgICAgIGFzc2VydFRydWUoIk9wZW4g\nc2hvdWxkIG5vdCBoYXZlIHN1Y2NlZWRlZCB0aHJvdWdoIGNsb3NlZCBia2Ns\naWVudCEiLAogICAgICAgICAgICAgICAgICAgQktFeGNlcHRpb24uQ29kZS5D\nbGllbnRDbG9zZWRFeGNlcHRpb24gPT0gcmV0dXJuQ29kZS5nZXQoKSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgZGVsZXRpbmcgYSBsZWRn\nZXIgdXNpbmcgYm9va2tlZXBlciBjbGllbnQgd2hpY2ggaXMgY2xvc2VkCiAg\nICAgKiBzaG91bGQgdGhyb3cgQ2xpZW50Q2xvc2VkRXhjZXB0aW9uCiAgICAg\nKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3REZWxldGVMZWRnZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBCb29rS2VlcGVyIGJrID0gbmV3IEJvb2tLZWVwZXIoYmFzZUNsaWVudENv\nbmYsIHprYyk7CiAgICAgICAgTE9HLmluZm8oIkNyZWF0ZSBsZWRnZXIgYW5k\nIGFkZCBlbnRyaWVzIHRvIGl0Iik7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxo\nID0gY3JlYXRlTGVkZ2VyV2l0aEVudHJpZXMoYmssIDEwMCk7CiAgICAgICAg\nTE9HLmluZm8oIkNsb3NpbmcgYm9va2tlZXBlciBjbGllbnQiKTsKICAgICAg\nICBiay5jbG9zZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJrLmRl\nbGV0ZUxlZGdlcihsaC5nZXRJZCgpKTsKICAgICAgICAgICAgZmFpbCgic2hv\ndWxkIGhhdmUgZmFpbGVkLCBjbGllbnQgaXMgY2xvc2VkIik7CiAgICAgICAg\nfSBjYXRjaCAoQktDbGllbnRDbG9zZWRFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAvLyBjb3JyZWN0CiAgICAgICAgfQoKICAgICAgICAvLyB1c2luZyBh\nc3luYywgYmVjYXVzZSB0aGlzIGNvdWxkIHRyaWdnZXIgYW4gYXNzZXJ0aW9u\nCiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciByZXR1cm5Db2RlID0gbmV3\nIEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0\nY2ggb3BlbkxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAg\nIEFzeW5jQ2FsbGJhY2suRGVsZXRlQ2FsbGJhY2sgY2IgPSBuZXcgQXN5bmND\nYWxsYmFjay5EZWxldGVDYWxsYmFjaygpIHsKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgZGVsZXRlQ29tcGxldGUoaW50IHJjLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgICAgICAgICByZXR1cm5Db2RlLnNldChyYyk7CiAgICAgICAgICAg\nICAgICBvcGVuTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9OwogICAgICAgIGJrLmFzeW5jRGVsZXRlTGVkZ2VyKGxoLmdldElk\nKCksIGNiLCBvcGVuTGF0Y2gpOwoKICAgICAgICBMT0cuaW5mbygiV2FpdGlu\nZyB0byBkZWxldGUgdGhlIGxlZGdlciBhc3luY2hyb25vdXNseSIpOwogICAg\nICAgIGFzc2VydFRydWUoIkRlbGV0ZSBjYWxsIHNob3VsZCBoYXZlIGNvbXBs\nZXRlZCIsCiAgICAgICAgICAgICAgICBvcGVuTGF0Y2guYXdhaXQoMjAsIFRp\nbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkRlbGV0\nZSBzaG91bGQgbm90IGhhdmUgc3VjY2VlZGVkIHRocm91Z2ggY2xvc2VkIGJr\nY2xpZW50ISIsCiAgICAgICAgICAgICAgICAgICAgIEJLRXhjZXB0aW9uLkNv\nZGUuQ2xpZW50Q2xvc2VkRXhjZXB0aW9uLCByZXR1cm5Db2RlLmdldCgpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBhZGRpbmcgZW50cnkg\ndG8gYSBsZWRnZXIgdXNpbmcgYm9va2tlZXBlciBjbGllbnQgd2hpY2ggaXMK\nICAgICAqIGNsb3NlZCBzaG91bGQgdGhyb3cgQ2xpZW50Q2xvc2VkRXhjZXB0\naW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RBZGRMZWRnZXJFbnRyeSgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIEJvb2tLZWVwZXIgYmsgPSBuZXcgQm9va0tlZXBlcihi\nYXNlQ2xpZW50Q29uZiwgemtjKTsKICAgICAgICBMT0cuaW5mbygiQ3JlYXRl\nIGxlZGdlciBhbmQgYWRkIGVudHJpZXMgdG8gaXQiKTsKICAgICAgICBMZWRn\nZXJIYW5kbGUgbGggPSBjcmVhdGVMZWRnZXJXaXRoRW50cmllcyhiaywgMSk7\nCiAgICAgICAgTE9HLmluZm8oIkNsb3NpbmcgYm9va2tlZXBlciBjbGllbnQi\nKTsKCiAgICAgICAgcmVzdGFydEJvb2tpZVNsb3coKTsKCiAgICAgICAgYmsu\nY2xvc2UoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGguYWRkRW50\ncnkoImZvb2JhciIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIGZhaWwoInNo\nb3VsZCBoYXZlIGZhaWxlZCwgY2xpZW50IGlzIGNsb3NlZCIpOwogICAgICAg\nIH0gY2F0Y2ggKEJLQ2xpZW50Q2xvc2VkRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgLy8gY29ycmVjdAogICAgICAgIH0KCiAgICAgICAgZmluYWwgQ291\nbnREb3duTGF0Y2ggY29tcGxldGVMYXRjaCA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKICAgICAgICBmaW5hbCBBdG9taWNJbnRlZ2VyIHJjID0gbmV3IEF0\nb21pY0ludGVnZXIoQktFeGNlcHRpb24uQ29kZS5PSyk7CiAgICAgICAgbGgu\nYXN5bmNBZGRFbnRyeSgiZm9vYmFyIi5nZXRCeXRlcygpLCBuZXcgQWRkQ2Fs\nbGJhY2soKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBhZGRDb21w\nbGV0ZShpbnQgcmNjYiwgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVudHJ5SWQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgcmMuc2V0KHJjY2IpOwog\nICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlTGF0Y2guY291bnREb3duKCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIG51bGwpOwoKICAg\nICAgICBMT0cuaW5mbygiV2FpdGluZyB0byBmaW5pc2ggYWRkaW5nIGFub3Ro\nZXIgZW50cnkgYXN5bmNocm9ub3VzbHkiKTsKICAgICAgICBhc3NlcnRUcnVl\nKCJBZGQgZW50cnkgdG8gbGVkZ2VyIGNhbGwgc2hvdWxkIGhhdmUgY29tcGxl\ndGVkIiwKICAgICAgICAgICAgICAgIGNvbXBsZXRlTGF0Y2guYXdhaXQoMjAs\nIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoCiAg\nICAgICAgICAgICAgICAiQWRkIGVudHJ5IHRvIGxlZGdlciBzaG91bGQgbm90\nIGhhdmUgc3VjY2VlZGVkIHRocm91Z2ggY2xvc2VkIGJrY2xpZW50ISIsCiAg\nICAgICAgICAgICAgICBCS0V4Y2VwdGlvbi5Db2RlLkNsaWVudENsb3NlZEV4\nY2VwdGlvbiwgcmMuZ2V0KCkpOwogICAgfQoKICAgIC8qKgogICAgICogVGVz\ndCB0aGF0IGNsb3NpbmcgYSBsZWRnZXIgdXNpbmcgYm9va2tlZXBlciBjbGll\nbnQgd2hpY2ggaXMgY2xvc2VkIHNob3VsZAogICAgICogdGhyb3cgQ2xpZW50\nQ2xvc2VkRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDbG9zZUxlZGdlcigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIEJvb2tLZWVwZXIgYmsgPSBuZXcgQm9v\na0tlZXBlcihiYXNlQ2xpZW50Q29uZiwgemtjKTsKICAgICAgICBMT0cuaW5m\nbygiQ3JlYXRlIGxlZGdlciBhbmQgYWRkIGVudHJpZXMgdG8gaXQiKTsKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGggPSBjcmVhdGVMZWRnZXJXaXRoRW50cmll\ncyhiaywgMTAwKTsKICAgICAgICBMZWRnZXJIYW5kbGUgbGgyID0gY3JlYXRl\nTGVkZ2VyV2l0aEVudHJpZXMoYmssIDEwMCk7CgogICAgICAgIExPRy5pbmZv\nKCJDbG9zaW5nIGJvb2trZWVwZXIgY2xpZW50Iik7CiAgICAgICAgYmsuY2xv\nc2UoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGguY2xvc2UoKTsK\nICAgICAgICAgICAgZmFpbCgic2hvdWxkIGhhdmUgZmFpbGVkLCBjbGllbnQg\naXMgY2xvc2VkIik7CiAgICAgICAgfSBjYXRjaCAoQktDbGllbnRDbG9zZWRF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0CiAgICAgICAg\nfQoKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBjb21wbGV0ZUxhdGNo\nID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIGZpbmFsIEF0b21p\nY0ludGVnZXIgcmMgPSBuZXcgQXRvbWljSW50ZWdlcihCS0V4Y2VwdGlvbi5D\nb2RlLk9LKTsKICAgICAgICBsaDIuYXN5bmNDbG9zZShuZXcgQ2xvc2VDYWxs\nYmFjaygpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNsb3NlQ29t\ncGxldGUoaW50IHJjY2IsIExlZGdlckhhbmRsZSBsaCwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICAgICAgICAgIHJjLnNldChyY2NiKTsKICAgICAgICAg\nICAgICAgICAgICBjb21wbGV0ZUxhdGNoLmNvdW50RG93bigpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9LCBudWxsKTsKCiAgICAgICAgTE9H\nLmluZm8oIldhaXRpbmcgdG8gZmluaXNoIGFkZGluZyBhbm90aGVyIGVudHJ5\nIGFzeW5jaHJvbm91c2x5Iik7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiQ2xvc2Ug\nbGVkZ2VyIGNhbGwgc2hvdWxkIGhhdmUgY29tcGxldGVkIiwKICAgICAgICAg\nICAgICAgIGNvbXBsZXRlTGF0Y2guYXdhaXQoMjAsIFRpbWVVbml0LlNFQ09O\nRFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoCiAgICAgICAgICAgICAgICAi\nQ2xvc2UgbGVkZ2VyIHNob3VsZCBoYXZlIHN1Y2NlZWRlZCB0aHJvdWdoIGNs\nb3NlZCBia2NsaWVudCEiLAogICAgICAgICAgICAgICAgQktFeGNlcHRpb24u\nQ29kZS5DbGllbnRDbG9zZWRFeGNlcHRpb24sIHJjLmdldCgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCByZWFkaW5nIGVudHJ5IGZyb20g\nYSBsZWRnZXIgdXNpbmcgYm9va2tlZXBlciBjbGllbnQgd2hpY2ggaXMKICAg\nICAqIGNsb3NlZCBzaG91bGQgdGhyb3cgQ2xpZW50Q2xvc2VkRXhjZXB0aW9u\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RSZWFkTGVkZ2VyRW50cnkoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBCb29rS2VlcGVyIGJrID0gbmV3IEJvb2tLZWVwZXIoYmFz\nZUNsaWVudENvbmYsIHprYyk7CiAgICAgICAgTE9HLmluZm8oIkNyZWF0ZSBs\nZWRnZXIgYW5kIGFkZCBlbnRyaWVzIHRvIGl0Iik7CiAgICAgICAgaW50IG51\nbU9mRW50cmllcyA9IDEwMDsKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBj\ncmVhdGVMZWRnZXJXaXRoRW50cmllcyhiaywgbnVtT2ZFbnRyaWVzKTsKICAg\nICAgICBMT0cuaW5mbygiQ2xvc2luZyBib29ra2VlcGVyIGNsaWVudCIpOwoK\nICAgICAgICByZXN0YXJ0Qm9va2llU2xvdygpOwoKICAgICAgICBiay5jbG9z\nZSgpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBsaC5yZWFkRW50cmll\ncygwLCBudW1PZkVudHJpZXMgLSAxKTsKICAgICAgICAgICAgZmFpbCgic2hv\ndWxkIGhhdmUgZmFpbGVkLCBjbGllbnQgaXMgY2xvc2VkIik7CiAgICAgICAg\nfSBjYXRjaCAoQktDbGllbnRDbG9zZWRFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAvLyBjb3JyZWN0CiAgICAgICAgfQoKICAgICAgICBmaW5hbCBDb3Vu\ndERvd25MYXRjaCByZWFkTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7\nCiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciByYyA9IG5ldyBBdG9taWNJ\nbnRlZ2VyKEJLRXhjZXB0aW9uLkNvZGUuT0spOwogICAgICAgIFJlYWRDYWxs\nYmFjayBjYiA9IG5ldyBSZWFkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCByZWFkQ29tcGxldGUo\naW50IHJjY2IsIExlZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgICAgICAg\nICBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3QgY3R4KSB7\nCiAgICAgICAgICAgICAgICByYy5zZXQocmNjYik7CiAgICAgICAgICAgICAg\nICByZWFkTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9OwogICAgICAgIGxoLmFzeW5jUmVhZEVudHJpZXMoMCwgbnVtT2ZFbnRy\naWVzIC0gMSwgY2IsIHJlYWRMYXRjaCk7CgogICAgICAgIExPRy5pbmZvKCJX\nYWl0aW5nIHRvIGZpbmlzaCByZWFkaW5nIHRoZSBlbnRyaWVzIGFzeW5jaHJv\nbm91c2x5Iik7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiUmVhZCBlbnRyeSBsZWRn\nZXIgY2FsbCBzaG91bGQgaGF2ZSBjb21wbGV0ZWQiLAogICAgICAgICAgICAg\nICAgcmVhZExhdGNoLmF3YWl0KDIwLCBUaW1lVW5pdC5TRUNPTkRTKSk7CiAg\nICAgICAgYXNzZXJ0RXF1YWxzKAogICAgICAgICAgICAgICAgIlJlYWQgZW50\ncnkgbGVkZ2VyIHNob3VsZCBoYXZlIHN1Y2NlZWRlZCB0aHJvdWdoIGNsb3Nl\nZCBia2NsaWVudCEiLAogICAgICAgICAgICAgICAgQktFeGNlcHRpb24uQ29k\nZS5DbGllbnRDbG9zZWRFeGNlcHRpb24sIHJjLmdldCgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgdGhhdCByZWFkbGFzdGNvbmZpcm1lZCBlbnRy\neSBmcm9tIGEgbGVkZ2VyIHVzaW5nIGJvb2trZWVwZXIgY2xpZW50CiAgICAg\nKiB3aGljaCBpcyBjbG9zZWQgc2hvdWxkIHRocm93IENsaWVudENsb3NlZEV4\nY2VwdGlvbgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0UmVhZExhc3RDb25maXJtZWQoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBCb29rS2VlcGVyIGJrID0gbmV3IEJvb2tL\nZWVwZXIoYmFzZUNsaWVudENvbmYsIHprYyk7CiAgICAgICAgTE9HLmluZm8o\nIkNyZWF0ZSBsZWRnZXIgYW5kIGFkZCBlbnRyaWVzIHRvIGl0Iik7CiAgICAg\nICAgTGVkZ2VySGFuZGxlIGxoID0gY3JlYXRlTGVkZ2VyV2l0aEVudHJpZXMo\nYmssIDEwMCk7CiAgICAgICAgTE9HLmluZm8oIkNsb3NpbmcgYm9va2tlZXBl\nciBjbGllbnQiKTsKCiAgICAgICAgLy8gbWFrZSBhbGwgYm9va2llcyBzbG93\nCiAgICAgICAgcmVzdGFydEJvb2tpZVNsb3coKTsKICAgICAgICByZXN0YXJ0\nQm9va2llU2xvdygpOwogICAgICAgIHJlc3RhcnRCb29raWVTbG93KCk7Cgog\nICAgICAgIGJrLmNsb3NlKCk7CgogICAgICAgIGZpbmFsIENvdW50RG93bkxh\ndGNoIHJlYWRMYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAg\nICBmaW5hbCBBdG9taWNJbnRlZ2VyIHJjID0gbmV3IEF0b21pY0ludGVnZXIo\nQktFeGNlcHRpb24uQ29kZS5PSyk7CiAgICAgICAgQXN5bmNDYWxsYmFjay5S\nZWFkTGFzdENvbmZpcm1lZENhbGxiYWNrIGNiID0gbmV3IEFzeW5jQ2FsbGJh\nY2suUmVhZExhc3RDb25maXJtZWRDYWxsYmFjaygpIHsKCiAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCByZWFkTGFzdENv\nbmZpcm1lZENvbXBsZXRlKGludCByY2NiLCBsb25nIGxhc3RDb25maXJtZWQs\nCiAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGN0eCkgewogICAgICAgICAg\nICAgICAgcmMuc2V0KHJjY2IpOwogICAgICAgICAgICAgICAgcmVhZExhdGNo\nLmNvdW50RG93bigpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAg\nICBsaC5hc3luY1JlYWRMYXN0Q29uZmlybWVkKGNiLCByZWFkTGF0Y2gpOwoK\nICAgICAgICBMT0cuaW5mbygiV2FpdGluZyB0byBmaW5pc2ggcmVhZGluZyBs\nYXN0IGNvbmZpcm1lZCBlbnRyeSBhc3luY2hyb25vdXNseSIpOwogICAgICAg\nIGFzc2VydFRydWUoIlJlYWRMYXN0Q29uZmlybWVkIGNhbGwgc2hvdWxkIGhh\ndmUgY29tcGxldGVkIiwKICAgICAgICAgICAgICAgIHJlYWRMYXRjaC5hd2Fp\ndCgyMCwgVGltZVVuaXQuU0VDT05EUykpOwogICAgICAgIGFzc2VydEVxdWFs\ncygKICAgICAgICAgICAgICAgICJSZWFkTGFzdENvbmZpcm1lZCBzaG91bGQg\naGF2ZSBzdWNjZWVkZWQgdGhyb3VnaCBjbG9zZWQgYmtjbGllbnQhIiwKICAg\nICAgICAgICAgICAgIEJLRXhjZXB0aW9uLkNvZGUuQ2xpZW50Q2xvc2VkRXhj\nZXB0aW9uLCByYy5nZXQoKSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGxoLnJlYWRMYXN0Q29uZmlybWVkKCk7CiAgICAgICAgICAgIGZhaWwoInNo\nb3VsZCBoYXZlIGZhaWxlZCwgY2xpZW50IGlzIGNsb3NlZCIpOwogICAgICAg\nIH0gY2F0Y2ggKEJLQ2xpZW50Q2xvc2VkRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgLy8gY29ycmVjdAogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgdGhhdCBjaGVja2luZyBhIGxlZGdlciB1c2luZyBhIGNsb3Nl\nZCBCSyBjbGllbnQgd2lsbAogICAgICogdGhyb3cgYSBDbGllbnRDbG9zZWRF\neGNlcHRpb24KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdExlZGdlckNoZWNrKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQm9va0tlZXBlciBiayA9IG5ldyBCb29rS2VlcGVy\nKGJhc2VDbGllbnRDb25mLCB6a2MpOwogICAgICAgIExPRy5pbmZvKCJDcmVh\ndGUgbGVkZ2VyIGFuZCBhZGQgZW50cmllcyB0byBpdCIpOwogICAgICAgIExl\nZGdlckhhbmRsZSBsaCA9IGNyZWF0ZUxlZGdlcldpdGhFbnRyaWVzKGJrLCAx\nMDApOwogICAgICAgIExPRy5pbmZvKCJDbG9zaW5nIGJvb2trZWVwZXIgY2xp\nZW50Iik7CiAgICAgICAgTGVkZ2VyQ2hlY2tlciBsYyA9IG5ldyBMZWRnZXJD\naGVja2VyKGJrKTsKCiAgICAgICAgcmVzdGFydEJvb2tpZVNsb3coKTsKICAg\nICAgICBiay5jbG9zZSgpOwoKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRj\naCBwb3N0TGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAg\nZmluYWwgQXRvbWljSW50ZWdlciBwb3N0UmMgPSBuZXcgQXRvbWljSW50ZWdl\ncihCS0V4Y2VwdGlvbi5Db2RlLk9LKTsKICAgICAgICBsYy5jaGVja0xlZGdl\ncihsaCwgbmV3IEdlbmVyaWNDYWxsYmFjazxTZXQ8TGVkZ2VyRnJhZ21lbnQ+\nPigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBTZXQ8\nTGVkZ2VyRnJhZ21lbnQ+IHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAg\nIHBvc3RSYy5zZXQocmMpOwogICAgICAgICAgICAgICAgICAgIHBvc3RMYXRj\naC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfSk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiY2hlY2tMZWRnZXIgc2hvdWxkIGhh\ndmUgZmluaXNoZWQiLCBwb3N0TGF0Y2guYXdhaXQoMzAsIFRpbWVVbml0LlNF\nQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBoYXZlIGNs\naWVudCBjbG9zZWQgZXhjZXB0aW9uIiwKICAgICAgICAgICAgICAgICAgICAg\ncG9zdFJjLmdldCgpLCBCS0V4Y2VwdGlvbi5Db2RlLkNsaWVudENsb3NlZEV4\nY2VwdGlvbik7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgQ2hl\nY2tlckNiIGltcGxlbWVudHMgR2VuZXJpY0NhbGxiYWNrPFNldDxMZWRnZXJG\ncmFnbWVudD4+IHsKICAgICAgICBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5l\ndyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBpbnQgcmMgPSBCS0V4Y2Vw\ndGlvbi5Db2RlLk9LOwogICAgICAgIFNldDxMZWRnZXJGcmFnbWVudD4gcmVz\ndWx0ID0gbnVsbDsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBTZXQ8TGVkZ2VyRnJh\nZ21lbnQ+IHJlc3VsdCkgewogICAgICAgICAgICB0aGlzLnJjID0gcmM7CiAg\nICAgICAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICAgICAgICBs\nYXRjaC5jb3VudERvd24oKTsKICAgICAgICB9CgogICAgICAgIGludCBnZXRS\nYyhpbnQgdGltZSwgVGltZVVuaXQgdW5pdCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGlmIChsYXRjaC5hd2FpdCh0aW1lLCB1bml0KSkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIHJjOwogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiRGlkbid0\nIGNvbXBsZXRlIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIFNldDxMZWRnZXJGcmFnbWVudD4gZ2V0UmVzdWx0KGludCB0aW1lLCBUaW1l\nVW5pdCB1bml0KSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYg\nKGxhdGNoLmF3YWl0KHRpbWUsIHVuaXQpKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiRGlkbid0IGNvbXBsZXRlIik7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CiAgICAvKioKICAgICAq\nIFRlc3QgdGhhdCBCb29rS2VlcGVyQWRtaW4gb3BlcmF0aW9uZyB1c2luZyBh\nIGNsb3NlZCBCSyBjbGllbnQgd2lsbAogICAgICogdGhyb3cgYSBDbGllbnRD\nbG9zZWRFeGNlcHRpb24KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEJvb2tLZWVwZXJBZG1pbigpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIEJvb2tLZWVwZXIgYmsgPSBuZXcg\nQm9va0tlZXBlcihiYXNlQ2xpZW50Q29uZiwgemtjKTsKICAgICAgICBCb29r\nS2VlcGVyQWRtaW4gYmthZG1pbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYmsp\nOwoKICAgICAgICBMT0cuaW5mbygiQ3JlYXRlIGxlZGdlciBhbmQgYWRkIGVu\ndHJpZXMgdG8gaXQiKTsKICAgICAgICBMZWRnZXJIYW5kbGUgbGgxID0gY3Jl\nYXRlTGVkZ2VyV2l0aEVudHJpZXMoYmssIDEwMCk7CiAgICAgICAgTGVkZ2Vy\nSGFuZGxlIGxoMiA9IGNyZWF0ZUxlZGdlcldpdGhFbnRyaWVzKGJrLCAxMDAp\nOwogICAgICAgIExlZGdlckhhbmRsZSBsaDMgPSBjcmVhdGVMZWRnZXJXaXRo\nRW50cmllcyhiaywgMTAwKTsKICAgICAgICBsaDMuY2xvc2UoKTsKCiAgICAg\nICAgQm9va2llU29ja2V0QWRkcmVzcyBib29raWVUb0tpbGwgPSBnZXRCb29r\naWUoMCk7CiAgICAgICAga2lsbEJvb2tpZShib29raWVUb0tpbGwpOwogICAg\nICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgQm9va2llU29ja2V0QWRk\ncmVzcyBuZXdCb29raWUgPSBnZXRCb29raWUoMik7CgogICAgICAgIENoZWNr\nZXJDYiBjaGVja2VyY2IgPSBuZXcgQ2hlY2tlckNiKCk7CiAgICAgICAgTGVk\nZ2VyQ2hlY2tlciBsYyA9IG5ldyBMZWRnZXJDaGVja2VyKGJrKTsKICAgICAg\nICBsYy5jaGVja0xlZGdlcihsaDMsIGNoZWNrZXJjYik7CiAgICAgICAgYXNz\nZXJ0RXF1YWxzKCJTaG91bGQgaGF2ZSBjb21wbGV0ZWQiLAogICAgICAgICAg\nICAgICAgICAgICBjaGVja2VyY2IuZ2V0UmMoMzAsIFRpbWVVbml0LlNFQ09O\nRFMpLCBCS0V4Y2VwdGlvbi5Db2RlLk9LKTsKICAgICAgICBhc3NlcnRFcXVh\nbHMoIlNob3VsZCBoYXZlIGEgbWlzc2luZyBmcmFnbWVudCIsCiAgICAgICAg\nICAgICAgICAgICAgIDEsIGNoZWNrZXJjYi5nZXRSZXN1bHQoMzAsIFRpbWVV\nbml0LlNFQ09ORFMpLnNpemUoKSk7CgogICAgICAgIC8vIG1ha2Ugc3VyZSBh\nIGJvb2tpZSBpbiBlYWNoIHF1b3J1bSBpcyBzbG93CiAgICAgICAgcmVzdGFy\ndEJvb2tpZVNsb3coKTsKICAgICAgICByZXN0YXJ0Qm9va2llU2xvdygpOwoK\nICAgICAgICBiay5jbG9zZSgpOwoKICAgICAgICB0cnkgewogICAgICAgICAg\nICBia2FkbWluLm9wZW5MZWRnZXIobGgxLmdldElkKCkpOwogICAgICAgICAg\nICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byBvcGVuIHdpdGggYSBjbG9z\nZWQgY2xpZW50Iik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktD\nbGllbnRDbG9zZWRFeGNlcHRpb24gY2NlKSB7CiAgICAgICAgICAgIC8vIGNv\ncnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAg\nICAgICAgICBia2FkbWluLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxoMS5nZXRJ\nZCgpKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8g\nb3BlbiB3aXRoIGEgY2xvc2VkIGNsaWVudCIpOwogICAgICAgIH0gY2F0Y2gg\nKEJLRXhjZXB0aW9uLkJLQ2xpZW50Q2xvc2VkRXhjZXB0aW9uIGNjZSkgewog\nICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KCiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYmthZG1pbi5yZWNvdmVyQm9va2ll\nRGF0YShib29raWVUb0tpbGwsIG5ld0Jvb2tpZSk7CiAgICAgICAgICAgIGZh\naWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHJlY292ZXIgd2l0aCBhIGNsb3Nl\nZCBjbGllbnQiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0Ns\naWVudENsb3NlZEV4Y2VwdGlvbiBjY2UpIHsKICAgICAgICAgICAgLy8gY29y\ncmVjdCBiZWhhdmlvdXIKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGJrYWRtaW4ucmVwbGljYXRlTGVkZ2VyRnJhZ21lbnQobGgzLAog\nICAgICAgICAgICAgICAgICAgIGNoZWNrZXJjYi5nZXRSZXN1bHQoMTAsIFRp\nbWVVbml0LlNFQ09ORFMpLml0ZXJhdG9yKCkubmV4dCgpLCBuZXdCb29raWUp\nOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byByZXBs\naWNhdGUgd2l0aCBhIGNsb3NlZCBjbGllbnQiKTsKICAgICAgICB9IGNhdGNo\nIChCS0V4Y2VwdGlvbi5CS0NsaWVudENsb3NlZEV4Y2VwdGlvbiBjY2UpIHsK\nICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBMZWRnZXJIYW5kbGUgY3JlYXRlTGVkZ2VyV2l0\naEVudHJpZXMoQm9va0tlZXBlciBiaywgaW50IG51bU9mRW50cmllcykKICAg\nICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoID0gYmsKICAgICAgICAgICAgICAgIC5jcmVhdGVMZWRnZXIoMywg\nMywgZGlnZXN0VHlwZSwgUEFTU1dPUkQuZ2V0Qnl0ZXMoKSk7CgogICAgICAg\nIGZpbmFsIEF0b21pY0ludGVnZXIgcmMgPSBuZXcgQXRvbWljSW50ZWdlcihC\nS0V4Y2VwdGlvbi5Db2RlLk9LKTsKICAgICAgICBmaW5hbCBDb3VudERvd25M\nYXRjaCBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaChudW1PZkVudHJpZXMp\nOwoKICAgICAgICBmaW5hbCBBZGRDYWxsYmFjayBjYiA9IG5ldyBBZGRDYWxs\nYmFjaygpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGFkZENvbXBs\nZXRlKGludCByY2NiLCBMZWRnZXJIYW5kbGUgbGgsIGxvbmcgZW50cnlJZCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9iamVj\ndCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICByYy5jb21wYXJlQW5kU2V0\nKEJLRXhjZXB0aW9uLkNvZGUuT0ssIHJjY2IpOwogICAgICAgICAgICAgICAg\nICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtT2ZF\nbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeSgi\nZm9vYmFyIi5nZXRCeXRlcygpLCBjYiwgbnVsbCk7CiAgICAgICAgfQogICAg\nICAgIGlmICghbGF0Y2guYXdhaXQoMzAsIFRpbWVVbml0LlNFQ09ORFMpKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIkVudHJpZXMgdG9v\nayB0b28gbG9uZyB0byBhZGQiKTsKICAgICAgICB9CiAgICAgICAgaWYgKHJj\nLmdldCgpICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAg\ndGhyb3cgQktFeGNlcHRpb24uY3JlYXRlKHJjLmdldCgpKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGxoOwogICAgfQoKfQo=\n","encoding":"base64"}

