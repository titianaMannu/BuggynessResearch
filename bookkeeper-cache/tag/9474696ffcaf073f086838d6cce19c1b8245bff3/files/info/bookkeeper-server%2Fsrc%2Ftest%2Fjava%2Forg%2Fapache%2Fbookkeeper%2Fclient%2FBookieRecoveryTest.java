{"sha":"f18e159d6be69128475c9c6d95c5ff16200ccd12","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjE4ZTE1OWQ2YmU2OTEyODQ3NWM5YzZkOTVjNWZmMTYyMDBjY2QxMg==","size":39031,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f18e159d6be69128475c9c6d95c5ff16200ccd12","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJh\nY2suUmVjb3ZlckNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLk1T\nTGVkZ2VyTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubmV0LkJvb2tpZVNvY2tldEFkZHJlc3M7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJh\nY2tzLkdlbmVyaWNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuUmVhZEVu\ndHJ5Q2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVz\ndC5NdWx0aUxlZGdlck1hbmFnZXJNdWx0aURpZ2VzdFRlc3RDYXNlOwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVyOwppbXBv\ncnQgb3JnLmp1bml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsK\naW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\ncjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5JbmV0QWRkcmVz\nczsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVyYXRpb247\nCmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5I\nYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlJhbmRvbTsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5hdG9taWMuQXRvbWljTG9uZzsKCmltcG9ydCBzdGF0aWMgb3Jn\nLmp1bml0LkFzc2VydC4qOwoKLyoqCiAqIFRoaXMgY2xhc3MgdGVzdHMgdGhl\nIGJvb2tpZSByZWNvdmVyeSBhZG1pbiBmdW5jdGlvbmFsaXR5LgogKi8KcHVi\nbGljIGNsYXNzIEJvb2tpZVJlY292ZXJ5VGVzdCBleHRlbmRzIE11bHRpTGVk\nZ2VyTWFuYWdlck11bHRpRGlnZXN0VGVzdENhc2UgewogICAgcHJpdmF0ZSBm\naW5hbCBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9n\nZ2VyKEJvb2tpZVJlY292ZXJ5VGVzdC5jbGFzcyk7CgogICAgLy8gT2JqZWN0\nIHVzZWQgZm9yIHN5bmNocm9uaXppbmcgYXN5bmMgbWV0aG9kIGNhbGxzCiAg\nICBjbGFzcyBTeW5jT2JqZWN0IHsKICAgICAgICBib29sZWFuIHZhbHVlOwoK\nICAgICAgICBwdWJsaWMgU3luY09iamVjdCgpIHsKICAgICAgICAgICAgdmFs\ndWUgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgLy8gT2JqZWN0IHVz\nZWQgZm9yIGltcGxlbWVudGluZyB0aGUgQm9va2llIFJlY292ZXJDYWxsYmFj\nayBmb3IgdGhpcyBqVW5pdAogICAgLy8gdGVzdC4gVGhpcyB2ZXJpZmllcyB0\naGF0IHRoZSBvcGVyYXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4KICAg\nIGNsYXNzIEJvb2tpZVJlY292ZXJDYWxsYmFjayBpbXBsZW1lbnRzIFJlY292\nZXJDYWxsYmFjayB7CiAgICAgICAgYm9vbGVhbiBzdWNjZXNzID0gZmFsc2U7\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcmVjb3Zl\nckNvbXBsZXRlKGludCByYywgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBM\nT0cuaW5mbygiUmVjb3ZlcmVkIGJvb2tpZSBvcGVyYXRpb24gY29tcGxldGVk\nIHdpdGggcmM6ICIgKyByYyk7CiAgICAgICAgICAgIHN1Y2Nlc3MgPSByYyA9\nPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgICAgICBTeW5jT2JqZWN0\nIHN5bmMgPSAoU3luY09iamVjdCkgY3R4OwogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAgIHN5bmMudmFsdWUgPSB0\ncnVlOwogICAgICAgICAgICAgICAgc3luYy5ub3RpZnkoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBPYmplY3RzIHRvIHVzZSBm\nb3IgdGhpcyBqVW5pdCB0ZXN0LgogICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBl\nOwogICAgU3RyaW5nIGxlZGdlck1hbmFnZXJGYWN0b3J5OwogICAgU3luY09i\namVjdCBzeW5jOwogICAgQm9va2llUmVjb3ZlckNhbGxiYWNrIGJvb2tpZVJl\nY292ZXJDYjsKICAgIEJvb2tLZWVwZXJBZG1pbiBia0FkbWluOwoKICAgIC8v\nIENvbnN0cnVjdG9yCiAgICBwdWJsaWMgQm9va2llUmVjb3ZlcnlUZXN0KFN0\ncmluZyBsZWRnZXJNYW5hZ2VyRmFjdG9yeSwgRGlnZXN0VHlwZSBkaWdlc3RU\neXBlKSB7CiAgICAgICAgc3VwZXIoMyk7CiAgICAgICAgdGhpcy5kaWdlc3RU\neXBlID0gZGlnZXN0VHlwZTsKICAgICAgICB0aGlzLmxlZGdlck1hbmFnZXJG\nYWN0b3J5ID0gbGVkZ2VyTWFuYWdlckZhY3Rvcnk7CiAgICAgICAgTE9HLmlu\nZm8oIlVzaW5nIGxlZGdlciBtYW5hZ2VyICIgKyBsZWRnZXJNYW5hZ2VyRmFj\ndG9yeSk7CiAgICAgICAgLy8gc2V0IGxlZGdlciBtYW5hZ2VyCiAgICAgICAg\nYmFzZUNvbmYuc2V0TGVkZ2VyTWFuYWdlckZhY3RvcnlDbGFzc05hbWUobGVk\nZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgICAgIGJhc2VDbGllbnRDb25mLnNl\ndExlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKGxlZGdlck1hbmFnZXJG\nYWN0b3J5KTsKICAgIH0KCiAgICBAQmVmb3JlCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgLy8gU2V0IHVwIHRoZSBjb25maWd1cmF0aW9uIHByb3BlcnRpZXMgbmVl\nZGVkLgogICAgICAgIGJhc2VDbGllbnRDb25mLnNldEJvb2tpZVJlY292ZXJ5\nRGlnZXN0VHlwZShkaWdlc3RUeXBlKTsKICAgICAgICBiYXNlQ2xpZW50Q29u\nZi5zZXRCb29raWVSZWNvdmVyeVBhc3N3ZCgiIi5nZXRCeXRlcygpKTsKICAg\nICAgICBzdXBlci5zZXRVcCgpOwoKICAgICAgICBzeW5jID0gbmV3IFN5bmNP\nYmplY3QoKTsKICAgICAgICBib29raWVSZWNvdmVyQ2IgPSBuZXcgQm9va2ll\nUmVjb3ZlckNhbGxiYWNrKCk7CiAgICAgICAgQ2xpZW50Q29uZmlndXJhdGlv\nbiBhZG1pbkNvbmYgPSBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbihiYXNlQ2xp\nZW50Q29uZik7CiAgICAgICAgYWRtaW5Db25mLnNldFprU2VydmVycyh6a1V0\naWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKTsKICAgICAgICBia0Fk\nbWluID0gbmV3IEJvb2tLZWVwZXJBZG1pbihhZG1pbkNvbmYpOwogICAgfQoK\nICAgIEBBZnRlcgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCB0ZWFy\nRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIFJlbGVhc2Ug\nYW55IHJlc291cmNlcyB1c2VkIGJ5IHRoZSBCb29rS2VlcGVyVG9vbHMgaW5z\ndGFuY2UuCiAgICAgICAgaWYoYmtBZG1pbiAhPSBudWxsKXsKICAgICAgICAg\nICAgYmtBZG1pbi5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICBzdXBlci50\nZWFyRG93bigpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhv\nZCB0byBjcmVhdGUgYSBudW1iZXIgb2YgbGVkZ2VycwogICAgICoKICAgICAq\nIEBwYXJhbSBudW1MZWRnZXJzCiAgICAgKiAgICAgICAgICAgIE51bWJlciBv\nZiBsZWRnZXJzIHRvIGNyZWF0ZQogICAgICogQHJldHVybiBMaXN0IG9mIExl\nZGdlckhhbmRsZXMgZm9yIGVhY2ggb2YgdGhlIGxlZGdlcnMgY3JlYXRlZAog\nICAgICovCiAgICBwcml2YXRlIExpc3Q8TGVkZ2VySGFuZGxlPiBjcmVhdGVM\nZWRnZXJzKGludCBudW1MZWRnZXJzKQogICAgICAgICAgICB0aHJvd3MgQktF\neGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgog\nICAgewogICAgICAgIHJldHVybiBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMs\nIDMsIDIpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0\nbyBjcmVhdGUgYSBudW1iZXIgb2YgbGVkZ2VycwogICAgICoKICAgICAqIEBw\nYXJhbSBudW1MZWRnZXJzCiAgICAgKiAgICAgICAgICAgIE51bWJlciBvZiBs\nZWRnZXJzIHRvIGNyZWF0ZQogICAgICogQHBhcmFtIGVuc2VtYmxlIEVuc2Vt\nYmxlIHNpemUgZm9yIGxlZGdlcnMKICAgICAqIEBwYXJhbSBxdW9ydW0gUXVv\ncnVtIHNpemUgZm9yIGxlZGdlcnMKICAgICAqIEByZXR1cm4gTGlzdCBvZiBM\nZWRnZXJIYW5kbGVzIGZvciBlYWNoIG9mIHRoZSBsZWRnZXJzIGNyZWF0ZWQK\nICAgICAqLwogICAgcHJpdmF0ZSBMaXN0PExlZGdlckhhbmRsZT4gY3JlYXRl\nTGVkZ2VycyhpbnQgbnVtTGVkZ2VycywgaW50IGVuc2VtYmxlLCBpbnQgcXVv\ncnVtKQogICAgICAgICAgICB0aHJvd3MgQktFeGNlcHRpb24sIElPRXhjZXB0\naW9uLAogICAgICAgIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBM\naXN0PExlZGdlckhhbmRsZT4gbGhzID0gbmV3IEFycmF5TGlzdDxMZWRnZXJI\nYW5kbGU+KCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1MZWRn\nZXJzOyBpKyspIHsKICAgICAgICAgICAgbGhzLmFkZChia2MuY3JlYXRlTGVk\nZ2VyKGVuc2VtYmxlLCBxdW9ydW0sCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBkaWdlc3RUeXBlLCBiYXNlQ2xpZW50Q29uZi5nZXRC\nb29raWVSZWNvdmVyeVBhc3N3ZCgpKSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBsaHM7CiAgICB9CgogICAgcHJpdmF0ZSBMaXN0PExlZGdlckhhbmRs\nZT4gb3BlbkxlZGdlcnMoTGlzdDxMZWRnZXJIYW5kbGU+IG9sZExocykKICAg\nICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxMZWRn\nZXJIYW5kbGU+IG5ld0xocyA9IG5ldyBBcnJheUxpc3Q8TGVkZ2VySGFuZGxl\nPigpOwogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIG9sZExoIDogb2xkTGhz\nKSB7CiAgICAgICAgICAgIG5ld0xocy5hZGQoYmtjLm9wZW5MZWRnZXIob2xk\nTGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgYmFzZUNsaWVudENvbmYuZ2V0Qm9v\na2llUmVjb3ZlcnlQYXNzd2QoKSkpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gbmV3TGhzOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhv\nZCB0byB3cml0ZSBkdW1teSBsZWRnZXIgZW50cmllcyB0byBhbGwgb2YgdGhl\nIGxlZGdlcnMgcGFzc2VkLgogICAgICoKICAgICAqIEBwYXJhbSBudW1FbnRy\naWVzCiAgICAgKiAgICAgICAgICAgIE51bWJlciBvZiBsZWRnZXIgZW50cmll\ncyB0byB3cml0ZSBmb3IgZWFjaCBsZWRnZXIKICAgICAqIEBwYXJhbSBzdGFy\ndEVudHJ5SWQKICAgICAqICAgICAgICAgICAgVGhlIGZpcnN0IGVudHJ5IElk\nIHdlJ3JlIGV4cGVjdGluZyB0byB3cml0ZSBmb3IgZWFjaCBsZWRnZXIKICAg\nICAqIEBwYXJhbSBsaHMKICAgICAqICAgICAgICAgICAgTGlzdCBvZiBMZWRn\nZXJIYW5kbGVzIGZvciBhbGwgbGVkZ2VycyB0byB3cml0ZSBlbnRyaWVzIHRv\nCiAgICAgKiBAdGhyb3dzIEJLRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIElu\ndGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCB3\ncml0ZUVudHJpZXN0b0xlZGdlcnMoaW50IG51bUVudHJpZXMsIGxvbmcgc3Rh\ncnRFbnRyeUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzKQogICAgICAgIHRocm93cyBC\nS0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIGZv\nciAoTGVkZ2VySGFuZGxlIGxoIDogbGhzKSB7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAg\nICAgICBsaC5hZGRFbnRyeSgoIkxlZGdlcklkOiAiICsgbGguZ2V0SWQoKSAr\nICIsIEVudHJ5SWQ6ICIgKyAoc3RhcnRFbnRyeUlkICsgaSkpLmdldEJ5dGVz\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBjbG9zZUxlZGdlcnMoTGlzdDxMZWRnZXJIYW5kbGU+IGxocykg\ndGhyb3dzIEJLRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAg\nICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMpIHsKICAgICAgICAg\nICAgbGguY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBIZWxwZXIgbWV0aG9kIHRvIHZlcmlmeSB0aGF0IHdlIGNhbiByZWFkIHRo\nZSByZWNvdmVyZWQgbGVkZ2VyIGVudHJpZXMuCiAgICAgKgogICAgICogQHBh\ncmFtIG9sZExocwogICAgICogICAgICAgICAgICBPbGQgTGVkZ2VyIEhhbmRs\nZXMKICAgICAqIEBwYXJhbSBzdGFydEVudHJ5SWQKICAgICAqICAgICAgICAg\nICAgU3RhcnQgRW50cnkgSWQgdG8gcmVhZAogICAgICogQHBhcmFtIGVuZEVu\ndHJ5SWQKICAgICAqICAgICAgICAgICAgRW5kIEVudHJ5IElkIHRvIHJlYWQK\nICAgICAqIEB0aHJvd3MgQktFeGNlcHRpb24KICAgICAqIEB0aHJvd3MgSW50\nZXJydXB0ZWRFeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHZl\ncmlmeVJlY292ZXJlZExlZGdlcnMoTGlzdDxMZWRnZXJIYW5kbGU+IG9sZExo\ncywgbG9uZyBzdGFydEVudHJ5SWQsIGxvbmcgZW5kRW50cnlJZCkgdGhyb3dz\nIEJLRXhjZXB0aW9uLAogICAgICAgIEludGVycnVwdGVkRXhjZXB0aW9uIHsK\nICAgICAgICAvLyBHZXQgYSBzZXQgb2YgTGVkZ2VySGFuZGxlcyBmb3IgYWxs\nIG9mIHRoZSBsZWRnZXJzIHRvIHZlcmlmeQogICAgICAgIExpc3Q8TGVkZ2Vy\nSGFuZGxlPiBsaHMgPSBuZXcgQXJyYXlMaXN0PExlZGdlckhhbmRsZT4oKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG9sZExocy5zaXplKCk7IGkr\nKykgewogICAgICAgICAgICBsaHMuYWRkKGJrYy5vcGVuTGVkZ2VyKG9sZExo\ncy5nZXQoaSkuZ2V0SWQoKSwgZGlnZXN0VHlwZSwgYmFzZUNsaWVudENvbmYu\nZ2V0Qm9va2llUmVjb3ZlcnlQYXNzd2QoKSkpOwogICAgICAgIH0KICAgICAg\nICAvLyBSZWFkIHRoZSBsZWRnZXIgZW50cmllcyB0byB2ZXJpZnkgdGhhdCB0\naGV5IGFyZSBhbGwgcHJlc2VudCBhbmQKICAgICAgICAvLyBjb3JyZWN0IGlu\nIHRoZSBuZXcgYm9va2llLgogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxo\nIDogbGhzKSB7CiAgICAgICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVudHJ5\nPiBlbnRyaWVzID0gbGgucmVhZEVudHJpZXMoc3RhcnRFbnRyeUlkLCBlbmRF\nbnRyeUlkKTsKICAgICAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFzTW9yZUVs\nZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIExlZGdlckVudHJ5IGVudHJ5\nID0gZW50cmllcy5uZXh0RWxlbWVudCgpOwogICAgICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZShuZXcgU3RyaW5nKGVudHJ5LmdldEVudHJ5KCkpLmVxdWFscygi\nTGVkZ2VySWQ6ICIgKyBlbnRyeS5nZXRMZWRnZXJJZCgpICsgIiwgRW50cnlJ\nZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICArIGVudHJ5LmdldEVu\ndHJ5SWQoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgdGVzdHMgdGhlIGJvb2tpZSByZWNvdmVyeSBm\ndW5jdGlvbmFsaXR5IHdpdGggZW5zZW1ibGUgY2hhbmdlcy4KICAgICAqIFdl\nJ2xsIHZlcmlmeSB0aGF0OgogICAgICogLSBib29raWUgcmVjb3Zlcnkgc2hv\ndWxkIG5vdCBhZmZlY3QgZW5zZW1ibGUgY2hhbmdlLgogICAgICogLSBlbnNl\nbWJsZSBjaGFuZ2Ugc2hvdWxkIG5vdCBlcmFzZSBjaGFuZ2VzIG1hZGUgYnkg\ncmVjb3ZlcnkuCiAgICAgKgogICAgICoge0BsaW5rIGh0dHBzOi8vaXNzdWVz\nLmFwYWNoZS5vcmcvamlyYS9icm93c2UvQk9PS0tFRVBFUi02Njd9CiAgICAg\nKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RNZXRhZGF0YUNvbmZsaWN0V2l0aFJlY292ZXJ5KCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgaW50IG51bUVudHJpZXMgPSAxMDsKICAgICAg\nICBieXRlW10gZGF0YSA9ICJ0ZXN0TWV0YWRhdGFDb25mbGljdFdpdGhSZWNv\ndmVyeSIuZ2V0Qnl0ZXMoKTsKCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0g\nYmtjLmNyZWF0ZUxlZGdlcigyLCAyLCBkaWdlc3RUeXBlLCBiYXNlQ2xpZW50\nQ29uZi5nZXRCb29raWVSZWNvdmVyeVBhc3N3ZCgpKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bUVudHJpZXM7IGkrKykgewogICAgICAgICAg\nICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAgICAgICAgQm9va2ll\nU29ja2V0QWRkcmVzcyBib29raWVUb0tpbGwgPSBsaC5nZXRMZWRnZXJNZXRh\nZGF0YSgpLmdldEVuc2VtYmxlKG51bUVudHJpZXMgLSAxKS5nZXQoMSk7CiAg\nICAgICAga2lsbEJvb2tpZShib29raWVUb0tpbGwpOwogICAgICAgIHN0YXJ0\nTmV3Qm9va2llKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1F\nbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7\nCiAgICAgICAgfQogICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tpZURhdGEo\nYm9va2llVG9LaWxsLCBudWxsKTsKICAgICAgICAvLyBmYWlsIGFub3RoZXIg\nYm9va2llIHRvIGNhdXNlIGVuc2VtYmxlIGNoYW5nZSBhZ2FpbgogICAgICAg\nIGJvb2tpZVRvS2lsbCA9IGxoLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0RW5z\nZW1ibGUoMiAqIG51bUVudHJpZXMgLSAxKS5nZXQoMSk7CiAgICAgICAgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mT2ZLaWxsZWRCb29raWUgPSBraWxsQm9v\na2llKGJvb2tpZVRvS2lsbCk7CiAgICAgICAgc3RhcnROZXdCb29raWUoKTsK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJpZXM7IGkrKykg\newogICAgICAgICAgICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAg\nICAgICAgLy8gc3RhcnQgdGhlIGtpbGxlZCBib29raWUgYWdhaW4KICAgICAg\nICBic0NvbmZzLmFkZChjb25mT2ZLaWxsZWRCb29raWUpOwogICAgICAgIGJz\nLmFkZChzdGFydEJvb2tpZShjb25mT2ZLaWxsZWRCb29raWUpKTsKICAgICAg\nICAvLyBhbGwgZW5zZW1ibGVzIHNob3VsZCBiZSBmdWxseSByZXBsaWNhdGVk\nIHNpbmNlIGl0IGlzIHJlY292ZXJlZAogICAgICAgIGFzc2VydFRydWUoIk5v\ndCBmdWxseSByZXBsaWNhdGVkIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxo\nLCAzICogbnVtRW50cmllcykpOwogICAgICAgIGxoLmNsb3NlKCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUaGlzIHRlc3RzIHRoZSBhc3luY2hyb25vdXMg\nYm9va2llIHJlY292ZXJ5IGZ1bmN0aW9uYWxpdHkgYnkgd3JpdGluZwogICAg\nICogZW50cmllcyBpbnRvIDMgYm9va2llcywga2lsbGluZyBvbmUgYm9va2ll\nLCBzdGFydGluZyB1cCBhIG5ldyBvbmUgdG8KICAgICAqIHJlcGxhY2UgaXQs\nIGFuZCB0aGVuIHJlY292ZXJpbmcgdGhlIGxlZGdlciBlbnRyaWVzIGZyb20g\ndGhlIGtpbGxlZCBib29raWUKICAgICAqIG9udG8gdGhlIG5ldyBvbmUuIFdl\nJ2xsIHZlcmlmeSB0aGF0IHRoZSBlbnRyaWVzIHN0b3JlZCBvbiB0aGUga2ls\nbGVkCiAgICAgKiBib29raWUgYXJlIHByb3Blcmx5IGNvcGllZCBvdmVyIGFu\nZCByZXN0b3JlZCBvbnRvIHRoZSBuZXcgb25lLgogICAgICoKICAgICAqIEB0\naHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0QXN5bmNCb29raWVSZWNvdmVyeVRv\nU3BlY2lmaWNCb29raWUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAv\nLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAgICAgICBpbnQgbnVtTGVkZ2VycyA9\nIDM7CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9IGNyZWF0ZUxl\nZGdlcnMobnVtTGVkZ2Vycyk7CgogICAgICAgIC8vIFdyaXRlIHRoZSBlbnRy\naWVzIGZvciB0aGUgbGVkZ2VycyB3aXRoIGR1bW15IHZhbHVlcy4KICAgICAg\nICBpbnQgbnVtTXNncyA9IDEwOwogICAgICAgIHdyaXRlRW50cmllc3RvTGVk\nZ2VycyhudW1Nc2dzLCAwLCBsaHMpOwoKICAgICAgICAvLyBTaHV0ZG93biB0\naGUgZmlyc3QgYm9va2llIHNlcnZlcgogICAgICAgIExPRy5pbmZvKCJGaW5p\nc2hlZCB3cml0aW5nIGFsbCBsZWRnZXIgZW50cmllcyBzbyBzaHV0ZG93biBv\nbmUgb2YgdGhlIGJvb2tpZXMuIik7CiAgICAgICAgaW50IGluaXRpYWxQb3J0\nID0gYnNDb25mcy5nZXQoMCkuZ2V0Qm9va2llUG9ydCgpOwogICAgICAgIGJz\nLmdldCgwKS5zaHV0ZG93bigpOwogICAgICAgIGJzLnJlbW92ZSgwKTsKCiAg\nICAgICAgLy8gU3RhcnR1cCBhIG5ldyBib29raWUgc2VydmVyCiAgICAgICAg\naW50IG5ld0Jvb2tpZVBvcnQgPSBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAg\nICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMg\nc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBiZQogICAgICAgIC8vIGNyZWF0ZWQg\nZm9yIHRoZW0uCiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1z\nZ3MsIDEwLCBsaHMpOwoKICAgICAgICAvLyBDYWxsIHRoZSBhc3luYyByZWNv\ndmVyIGJvb2tpZSBtZXRob2QuCiAgICAgICAgQm9va2llU29ja2V0QWRkcmVz\ncyBib29raWVTcmMgPSBuZXcgQm9va2llU29ja2V0QWRkcmVzcyhJbmV0QWRk\ncmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLAogICAgICAg\nICAgICAgICAgaW5pdGlhbFBvcnQpOwogICAgICAgIEJvb2tpZVNvY2tldEFk\nZHJlc3MgYm9va2llRGVzdCA9IG5ldyBCb29raWVTb2NrZXRBZGRyZXNzKElu\nZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksCiAg\nICAgICAgICAgICAgICBuZXdCb29raWVQb3J0KTsKICAgICAgICBMT0cuaW5m\nbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtpbGxlZCBib29raWUg\nKCIgKyBib29raWVTcmMgKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIHRoZSBu\nZXcgb25lICgiCiAgICAgICAgICAgICAgICAgKyBib29raWVEZXN0ICsgIiki\nKTsKICAgICAgICAvLyBJbml0aWF0ZSB0aGUgc3luYyBvYmplY3QKICAgICAg\nICBzeW5jLnZhbHVlID0gZmFsc2U7CiAgICAgICAgYmtBZG1pbi5hc3luY1Jl\nY292ZXJCb29raWVEYXRhKGJvb2tpZVNyYywgYm9va2llRGVzdCwgYm9va2ll\nUmVjb3ZlckNiLCBzeW5jKTsKCiAgICAgICAgLy8gV2FpdCBmb3IgdGhlIGFz\neW5jIG1ldGhvZCB0byBjb21wbGV0ZS4KICAgICAgICBzeW5jaHJvbml6ZWQg\nKHN5bmMpIHsKICAgICAgICAgICAgd2hpbGUgKHN5bmMudmFsdWUgPT0gZmFs\nc2UpIHsKICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGFzc2VydFRydWUoYm9va2llUmVjb3ZlckNiLnN1\nY2Nlc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gVmVyaWZ5IHRoZSByZWNv\ndmVyZWQgbGVkZ2VyIGVudHJpZXMgYXJlIG9rYXkuCiAgICAgICAgdmVyaWZ5\nUmVjb3ZlcmVkTGVkZ2VycyhsaHMsIDAsIDIgKiBudW1Nc2dzIC0gMSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGlzIHRlc3RzIHRoZSBhc3luY2hyb25v\ndXMgYm9va2llIHJlY292ZXJ5IGZ1bmN0aW9uYWxpdHkgYnkgd3JpdGluZwog\nICAgICogZW50cmllcyBpbnRvIDMgYm9va2llcywga2lsbGluZyBvbmUgYm9v\na2llLCBzdGFydGluZyB1cCBhIGZldyBuZXcKICAgICAqIGJvb2tpZXMsIGFu\nZCB0aGVuIHJlY292ZXJpbmcgdGhlIGxlZGdlciBlbnRyaWVzIGZyb20gdGhl\nIGtpbGxlZCBib29raWUKICAgICAqIG9udG8gcmFuZG9tIGF2YWlsYWJsZSBi\nb29raWUgc2VydmVycy4gV2UnbGwgdmVyaWZ5IHRoYXQgdGhlIGVudHJpZXMK\nICAgICAqIHN0b3JlZCBvbiB0aGUga2lsbGVkIGJvb2tpZSBhcmUgcHJvcGVy\nbHkgY29waWVkIG92ZXIgYW5kIHJlc3RvcmVkIG9udG8KICAgICAqIHRoZSBv\ndGhlciBib29raWVzLgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9u\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0QXN5bmNCb29raWVSZWNvdmVyeVRvUmFuZG9tQm9va2llcygp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIENyZWF0ZSB0aGUgbGVk\nZ2VycwogICAgICAgIGludCBudW1MZWRnZXJzID0gMzsKICAgICAgICBMaXN0\nPExlZGdlckhhbmRsZT4gbGhzID0gY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJz\nKTsKCiAgICAgICAgLy8gV3JpdGUgdGhlIGVudHJpZXMgZm9yIHRoZSBsZWRn\nZXJzIHdpdGggZHVtbXkgdmFsdWVzLgogICAgICAgIGludCBudW1Nc2dzID0g\nMTA7CiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDAs\nIGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJzdCBib29raWUg\nc2VydmVyCiAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIHdyaXRpbmcgYWxs\nIGxlZGdlciBlbnRyaWVzIHNvIHNodXRkb3duIG9uZSBvZiB0aGUgYm9va2ll\ncy4iKTsKICAgICAgICBpbnQgaW5pdGlhbFBvcnQgPSBic0NvbmZzLmdldCgw\nKS5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgYnMuZ2V0KDApLnNodXRkb3du\nKCk7CiAgICAgICAgYnMucmVtb3ZlKDApOwoKICAgICAgICAvLyBTdGFydHVw\nIHRocmVlIG5ldyBib29raWUgc2VydmVycwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgICAgIHN0YXJ0TmV3Qm9va2ll\nKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50\ncmllcyBmb3IgdGhlIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBi\nZQogICAgICAgIC8vIGNyZWF0ZWQgZm9yIHRoZW0uCiAgICAgICAgd3JpdGVF\nbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDEwLCBsaHMpOwoKICAgICAgICAv\nLyBDYWxsIHRoZSBhc3luYyByZWNvdmVyIGJvb2tpZSBtZXRob2QuCiAgICAg\nICAgQm9va2llU29ja2V0QWRkcmVzcyBib29raWVTcmMgPSBuZXcgQm9va2ll\nU29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRI\nb3N0QWRkcmVzcygpLAogICAgICAgICAgICAgICAgaW5pdGlhbFBvcnQpOwog\nICAgICAgIEJvb2tpZVNvY2tldEFkZHJlc3MgYm9va2llRGVzdCA9IG51bGw7\nCiAgICAgICAgTE9HLmluZm8oIk5vdyByZWNvdmVyIHRoZSBkYXRhIG9uIHRo\nZSBraWxsZWQgYm9va2llICgiICsgYm9va2llU3JjCiAgICAgICAgICAgICAg\nICAgKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIGEgcmFuZG9tIGF2YWlsYWJs\nZSBvbmUiKTsKICAgICAgICAvLyBJbml0aWF0ZSB0aGUgc3luYyBvYmplY3QK\nICAgICAgICBzeW5jLnZhbHVlID0gZmFsc2U7CiAgICAgICAgYmtBZG1pbi5h\nc3luY1JlY292ZXJCb29raWVEYXRhKGJvb2tpZVNyYywgYm9va2llRGVzdCwg\nYm9va2llUmVjb3ZlckNiLCBzeW5jKTsKCiAgICAgICAgLy8gV2FpdCBmb3Ig\ndGhlIGFzeW5jIG1ldGhvZCB0byBjb21wbGV0ZS4KICAgICAgICBzeW5jaHJv\nbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgd2hpbGUgKHN5bmMudmFsdWUg\nPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGFzc2VydFRydWUoYm9va2llUmVjb3Zl\nckNiLnN1Y2Nlc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gVmVyaWZ5IHRo\nZSByZWNvdmVyZWQgbGVkZ2VyIGVudHJpZXMgYXJlIG9rYXkuCiAgICAgICAg\ndmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaHMsIDAsIDIgKiBudW1Nc2dzIC0g\nMSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIHRlc3RzIHRoZSBzeW5j\naHJvbm91cyBib29raWUgcmVjb3ZlcnkgZnVuY3Rpb25hbGl0eSBieSB3cml0\naW5nCiAgICAgKiBlbnRyaWVzIGludG8gMyBib29raWVzLCBraWxsaW5nIG9u\nZSBib29raWUsIHN0YXJ0aW5nIHVwIGEgbmV3IG9uZSB0bwogICAgICogcmVw\nbGFjZSBpdCwgYW5kIHRoZW4gcmVjb3ZlcmluZyB0aGUgbGVkZ2VyIGVudHJp\nZXMgZnJvbSB0aGUga2lsbGVkIGJvb2tpZQogICAgICogb250byB0aGUgbmV3\nIG9uZS4gV2UnbGwgdmVyaWZ5IHRoYXQgdGhlIGVudHJpZXMgc3RvcmVkIG9u\nIHRoZSBraWxsZWQKICAgICAqIGJvb2tpZSBhcmUgcHJvcGVybHkgY29waWVk\nIG92ZXIgYW5kIHJlc3RvcmVkIG9udG8gdGhlIG5ldyBvbmUuCiAgICAgKgog\nICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTeW5jQm9va2llUmVj\nb3ZlcnlUb1NwZWNpZmljQm9va2llKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAgICAgaW50IG51bUxl\nZGdlcnMgPSAzOwogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBj\ncmVhdGVMZWRnZXJzKG51bUxlZGdlcnMpOwoKICAgICAgICAvLyBXcml0ZSB0\naGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMu\nCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0ZUVudHJp\nZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgLy8gU2h1\ndGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBMT0cuaW5m\nbygiRmluaXNoZWQgd3JpdGluZyBhbGwgbGVkZ2VyIGVudHJpZXMgc28gc2h1\ndGRvd24gb25lIG9mIHRoZSBib29raWVzLiIpOwogICAgICAgIGludCBpbml0\naWFsUG9ydCA9IGJzQ29uZnMuZ2V0KDApLmdldEJvb2tpZVBvcnQoKTsKICAg\nICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1vdmUo\nMCk7CgogICAgICAgIC8vIFN0YXJ0dXAgYSBuZXcgYm9va2llIHNlcnZlcgog\nICAgICAgIGludCBuZXdCb29raWVQb3J0ID0gc3RhcnROZXdCb29raWUoKTsK\nCiAgICAgICAgLy8gV3JpdGUgc29tZSBtb3JlIGVudHJpZXMgZm9yIHRoZSBs\nZWRnZXJzIHNvIGEgbmV3IGVuc2VtYmxlIHdpbGwgYmUKICAgICAgICAvLyBj\ncmVhdGVkIGZvciB0aGVtLgogICAgICAgIHdyaXRlRW50cmllc3RvTGVkZ2Vy\ncyhudW1Nc2dzLCAxMCwgbGhzKTsKCiAgICAgICAgLy8gQ2FsbCB0aGUgc3lu\nYyByZWNvdmVyIGJvb2tpZSBtZXRob2QuCiAgICAgICAgQm9va2llU29ja2V0\nQWRkcmVzcyBib29raWVTcmMgPSBuZXcgQm9va2llU29ja2V0QWRkcmVzcyhJ\nbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLAog\nICAgICAgICAgICAgICAgaW5pdGlhbFBvcnQpOwogICAgICAgIEJvb2tpZVNv\nY2tldEFkZHJlc3MgYm9va2llRGVzdCA9IG5ldyBCb29raWVTb2NrZXRBZGRy\nZXNzKEluZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNz\nKCksCiAgICAgICAgICAgICAgICBuZXdCb29raWVQb3J0KTsKICAgICAgICBM\nT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtpbGxlZCBi\nb29raWUgKCIgKyBib29raWVTcmMgKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRv\nIHRoZSBuZXcgb25lICgiCiAgICAgICAgICAgICAgICAgKyBib29raWVEZXN0\nICsgIikiKTsKICAgICAgICBia0FkbWluLnJlY292ZXJCb29raWVEYXRhKGJv\nb2tpZVNyYywgYm9va2llRGVzdCk7CgogICAgICAgIC8vIFZlcmlmeSB0aGUg\ncmVjb3ZlcmVkIGxlZGdlciBlbnRyaWVzIGFyZSBva2F5LgogICAgICAgIHZl\ncmlmeVJlY292ZXJlZExlZGdlcnMobGhzLCAwLCAyICogbnVtTXNncyAtIDEp\nOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyB0ZXN0cyB0aGUgc3luY2hy\nb25vdXMgYm9va2llIHJlY292ZXJ5IGZ1bmN0aW9uYWxpdHkgYnkgd3JpdGlu\nZwogICAgICogZW50cmllcyBpbnRvIDMgYm9va2llcywga2lsbGluZyBvbmUg\nYm9va2llLCBzdGFydGluZyB1cCBhIGZldyBuZXcKICAgICAqIGJvb2tpZXMs\nIGFuZCB0aGVuIHJlY292ZXJpbmcgdGhlIGxlZGdlciBlbnRyaWVzIGZyb20g\ndGhlIGtpbGxlZCBib29raWUKICAgICAqIG9udG8gcmFuZG9tIGF2YWlsYWJs\nZSBib29raWUgc2VydmVycy4gV2UnbGwgdmVyaWZ5IHRoYXQgdGhlIGVudHJp\nZXMKICAgICAqIHN0b3JlZCBvbiB0aGUga2lsbGVkIGJvb2tpZSBhcmUgcHJv\ncGVybHkgY29waWVkIG92ZXIgYW5kIHJlc3RvcmVkIG9udG8KICAgICAqIHRo\nZSBvdGhlciBib29raWVzLgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0\naW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0U3luY0Jvb2tpZVJlY292ZXJ5VG9SYW5kb21Cb29raWVz\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBs\nZWRnZXJzCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAgICAgIExp\nc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdl\ncnMpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmllcyBmb3IgdGhlIGxl\nZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMuCiAgICAgICAgaW50IG51bU1zZ3Mg\nPSAxMDsKICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywg\nMCwgbGhzKTsKCiAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tp\nZSBzZXJ2ZXIKICAgICAgICBMT0cuaW5mbygiRmluaXNoZWQgd3JpdGluZyBh\nbGwgbGVkZ2VyIGVudHJpZXMgc28gc2h1dGRvd24gb25lIG9mIHRoZSBib29r\naWVzLiIpOwogICAgICAgIGludCBpbml0aWFsUG9ydCA9IGJzQ29uZnMuZ2V0\nKDApLmdldEJvb2tpZVBvcnQoKTsKICAgICAgICBicy5nZXQoMCkuc2h1dGRv\nd24oKTsKICAgICAgICBicy5yZW1vdmUoMCk7CgogICAgICAgIC8vIFN0YXJ0\ndXAgdGhyZWUgbmV3IGJvb2tpZSBzZXJ2ZXJzCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICAgICAgc3RhcnROZXdCb29r\naWUoKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIHNvbWUgbW9yZSBl\nbnRyaWVzIGZvciB0aGUgbGVkZ2VycyBzbyBhIG5ldyBlbnNlbWJsZSB3aWxs\nIGJlCiAgICAgICAgLy8gY3JlYXRlZCBmb3IgdGhlbS4KICAgICAgICB3cml0\nZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMTAsIGxocyk7CgogICAgICAg\nIC8vIENhbGwgdGhlIHN5bmMgcmVjb3ZlciBib29raWUgbWV0aG9kLgogICAg\nICAgIEJvb2tpZVNvY2tldEFkZHJlc3MgYm9va2llU3JjID0gbmV3IEJvb2tp\nZVNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0\nSG9zdEFkZHJlc3MoKSwKICAgICAgICAgICAgICAgIGluaXRpYWxQb3J0KTsK\nICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIGJvb2tpZURlc3QgPSBudWxs\nOwogICAgICAgIExPRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUgZGF0YSBvbiB0\naGUga2lsbGVkIGJvb2tpZSAoIiArIGJvb2tpZVNyYwogICAgICAgICAgICAg\nICAgICsgIikgYW5kIHJlcGxpY2F0ZSBpdCB0byBhIHJhbmRvbSBhdmFpbGFi\nbGUgb25lIik7CiAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShi\nb29raWVTcmMsIGJvb2tpZURlc3QpOwoKICAgICAgICAvLyBWZXJpZnkgdGhl\nIHJlY292ZXJlZCBsZWRnZXIgZW50cmllcyBhcmUgb2theS4KICAgICAgICB2\nZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxocywgMCwgMiAqIG51bU1zZ3MgLSAx\nKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBSZXBsaWNhdGlv\nblZlcmlmaWNhdGlvbkNhbGxiYWNrIGltcGxlbWVudHMgUmVhZEVudHJ5Q2Fs\nbGJhY2sgewogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNoOwog\nICAgICAgIGZpbmFsIEF0b21pY0xvbmcgbnVtU3VjY2VzczsKCiAgICAgICAg\nUmVwbGljYXRpb25WZXJpZmljYXRpb25DYWxsYmFjayhpbnQgbnVtUmVxdWVz\ndHMpIHsKICAgICAgICAgICAgbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2go\nbnVtUmVxdWVzdHMpOwogICAgICAgICAgICBudW1TdWNjZXNzID0gbmV3IEF0\nb21pY0xvbmcoMCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgdm9pZCByZWFkRW50cnlDb21wbGV0ZShpbnQgcmMsIGxv\nbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCwgQ2hhbm5lbEJ1ZmZlciBidWZm\nZXIsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVn\nRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkdvdCAi\nICsgcmMgKyAiIGZvciBsZWRnZXIgIiArIGxlZGdlcklkICsgIiBlbnRyeSAi\nICsgZW50cnlJZCArICIgZnJvbSAiICsgY3R4KTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSykgewog\nICAgICAgICAgICAgICAgbnVtU3VjY2Vzcy5pbmNyZW1lbnRBbmRHZXQoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsK\nICAgICAgICB9CgogICAgICAgIGxvbmcgYXdhaXQoKSB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICBpZiAobGF0Y2guYXdhaXQo\nNjAsIFRpbWVVbml0LlNFQ09ORFMpID09IGZhbHNlKSB7CiAgICAgICAgICAg\nICAgICBMT0cud2FybigiRGlkbid0IGdldCBhbGwgcmVzcG9uc2VzIGluIHZl\ncmlmaWNhdGlvbiIpOwogICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVtU3Vj\nY2Vzcy5nZXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIGJvb2xlYW4gdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKExlZGdl\nckhhbmRsZSBsaCwgbG9uZyB1bnRpbEVudHJ5KSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBMZWRnZXJNZXRhZGF0YSBtZCA9IGdldExlZGdlck1ldGFk\nYXRhKGxoKTsKCiAgICAgICAgTWFwPExvbmcsIEFycmF5TGlzdDxCb29raWVT\nb2NrZXRBZGRyZXNzPj4gZW5zZW1ibGVzID0gbWQuZ2V0RW5zZW1ibGVzKCk7\nCgogICAgICAgIEhhc2hNYXA8TG9uZywgTG9uZz4gcmFuZ2VzID0gbmV3IEhh\nc2hNYXA8TG9uZywgTG9uZz4oKTsKICAgICAgICBBcnJheUxpc3Q8TG9uZz4g\na2V5TGlzdCA9IENvbGxlY3Rpb25zLmxpc3QoCiAgICAgICAgICAgICAgICBD\nb2xsZWN0aW9ucy5lbnVtZXJhdGlvbihlbnNlbWJsZXMua2V5U2V0KCkpKTsK\nICAgICAgICBDb2xsZWN0aW9ucy5zb3J0KGtleUxpc3QpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwga2V5TGlzdC5zaXplKCkgLSAxOyBpKyspIHsK\nICAgICAgICAgICAgcmFuZ2VzLnB1dChrZXlMaXN0LmdldChpKSwga2V5TGlz\ndC5nZXQoaSsxKSk7CiAgICAgICAgfQogICAgICAgIHJhbmdlcy5wdXQoa2V5\nTGlzdC5nZXQoa2V5TGlzdC5zaXplKCktMSksIHVudGlsRW50cnkpOwoKICAg\nICAgICBmb3IgKE1hcC5FbnRyeTxMb25nLCBBcnJheUxpc3Q8Qm9va2llU29j\na2V0QWRkcmVzcz4+IGUgOiBlbnNlbWJsZXMuZW50cnlTZXQoKSkgewogICAg\nICAgICAgICBpbnQgcXVvcnVtID0gbWQuZ2V0QWNrUXVvcnVtU2l6ZSgpOwog\nICAgICAgICAgICBsb25nIHN0YXJ0RW50cnlJZCA9IGUuZ2V0S2V5KCk7CiAg\nICAgICAgICAgIGxvbmcgZW5kRW50cnlJZCA9IHJhbmdlcy5nZXQoc3RhcnRF\nbnRyeUlkKTsKICAgICAgICAgICAgbG9uZyBleHBlY3RlZFN1Y2Nlc3MgPSBx\ndW9ydW0qKGVuZEVudHJ5SWQtc3RhcnRFbnRyeUlkKTsKICAgICAgICAgICAg\naW50IG51bVJlcXVlc3RzID0gZS5nZXRWYWx1ZSgpLnNpemUoKSooKGludCko\nZW5kRW50cnlJZC1zdGFydEVudHJ5SWQpKTsKCiAgICAgICAgICAgIFJlcGxp\nY2F0aW9uVmVyaWZpY2F0aW9uQ2FsbGJhY2sgY2IgPSBuZXcgUmVwbGljYXRp\nb25WZXJpZmljYXRpb25DYWxsYmFjayhudW1SZXF1ZXN0cyk7CiAgICAgICAg\nICAgIGZvciAobG9uZyBpID0gc3RhcnRFbnRyeUlkOyBpIDwgZW5kRW50cnlJ\nZDsgaSsrKSB7CiAgICAgICAgICAgICAgICBmb3IgKEJvb2tpZVNvY2tldEFk\nZHJlc3MgYWRkciA6IGUuZ2V0VmFsdWUoKSkgewogICAgICAgICAgICAgICAg\nICAgIGJrYy5ib29raWVDbGllbnQucmVhZEVudHJ5KGFkZHIsIGxoLmdldElk\nKCksIGksIGNiLCBhZGRyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgbG9uZyBudW1TdWNjZXNzID0gY2IuYXdhaXQo\nKTsKICAgICAgICAgICAgaWYgKG51bVN1Y2Nlc3MgPCBleHBlY3RlZFN1Y2Nl\nc3MpIHsKICAgICAgICAgICAgICAgIExPRy53YXJuKCJGcmFnbWVudCBub3Qg\nZnVsbHkgcmVwbGljYXRlZCBsZWRnZXJJZCA9ICIgKyBsaC5nZXRJZCgpCiAg\nICAgICAgICAgICAgICAgICAgICAgICArICIgc3RhcnRFbnRyeUlkID0gIiAr\nIHN0YXJ0RW50cnlJZAogICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGVu\nZEVudHJ5SWQgPSAiICsgZW5kRW50cnlJZAogICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiIGV4cGVjdGVkU3VjY2VzcyA9ICIgKyBleHBlY3RlZFN1Y2Nl\nc3MKICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBnb3RTdWNjZXNzID0g\nIiArIG51bVN1Y2Nlc3MpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVl\nOwogICAgfQoKICAgIC8vIE9iamVjdCB1c2VkIGZvciBzeW5jaHJvbml6aW5n\nIGFzeW5jIG1ldGhvZCBjYWxscwogICAgY2xhc3MgU3luY0xlZGdlck1ldGFP\nYmplY3QgewogICAgICAgIGJvb2xlYW4gdmFsdWU7CiAgICAgICAgaW50IHJj\nOwogICAgICAgIExlZGdlck1ldGFkYXRhIG1ldGE7CgogICAgICAgIHB1Ymxp\nYyBTeW5jTGVkZ2VyTWV0YU9iamVjdCgpIHsKICAgICAgICAgICAgdmFsdWUg\nPSBmYWxzZTsKICAgICAgICAgICAgbWV0YSA9IG51bGw7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgTGVkZ2VyTWV0YWRhdGEgZ2V0TGVkZ2VyTWV0\nYWRhdGEoTGVkZ2VySGFuZGxlIGxoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBmaW5hbCBTeW5jTGVkZ2VyTWV0YU9iamVjdCBzeW5jT2JqID0gbmV3\nIFN5bmNMZWRnZXJNZXRhT2JqZWN0KCk7CiAgICAgICAgYmtjLmdldExlZGdl\nck1hbmFnZXIoKS5yZWFkTGVkZ2VyTWV0YWRhdGEobGguZ2V0SWQoKSwgbmV3\nIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4oKSB7CgogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0\naW9uQ29tcGxldGUoaW50IHJjLCBMZWRnZXJNZXRhZGF0YSByZXN1bHQpIHsK\nICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc3luY09iaikgewogICAg\nICAgICAgICAgICAgICAgIHN5bmNPYmoucmMgPSByYzsKICAgICAgICAgICAg\nICAgICAgICBzeW5jT2JqLm1ldGEgPSByZXN1bHQ7CiAgICAgICAgICAgICAg\nICAgICAgc3luY09iai52YWx1ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAg\nICAgc3luY09iai5ub3RpZnkoKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICB9KTsKCiAgICAgICAgc3luY2hyb25pemVkIChz\neW5jT2JqKSB7CiAgICAgICAgICAgIHdoaWxlIChzeW5jT2JqLnZhbHVlID09\nIGZhbHNlKSB7CiAgICAgICAgICAgICAgICBzeW5jT2JqLndhaXQoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMoQktF\neGNlcHRpb24uQ29kZS5PSywgc3luY09iai5yYyk7CiAgICAgICAgcmV0dXJu\nIHN5bmNPYmoubWV0YTsKICAgIH0KCiAgICBwcml2YXRlIGJvb2xlYW4gZmlu\nZER1cGVzSW5FbnNlbWJsZXMoTGlzdDxMZWRnZXJIYW5kbGU+IGxocykgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBudW1EdXBlcyA9IDA7CiAg\nICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMpIHsKICAgICAgICAg\nICAgTGVkZ2VyTWV0YWRhdGEgbWQgPSBnZXRMZWRnZXJNZXRhZGF0YShsaCk7\nCiAgICAgICAgICAgIGZvciAoTWFwLkVudHJ5PExvbmcsIEFycmF5TGlzdDxC\nb29raWVTb2NrZXRBZGRyZXNzPj4gZSA6IG1kLmdldEVuc2VtYmxlcygpLmVu\ndHJ5U2V0KCkpIHsKICAgICAgICAgICAgICAgIEhhc2hTZXQ8Qm9va2llU29j\na2V0QWRkcmVzcz4gc2V0ID0gbmV3IEhhc2hTZXQ8Qm9va2llU29ja2V0QWRk\ncmVzcz4oKTsKICAgICAgICAgICAgICAgIGxvbmcgZnJhZ21lbnQgPSBlLmdl\ndEtleSgpOwoKICAgICAgICAgICAgICAgIGZvciAoQm9va2llU29ja2V0QWRk\ncmVzcyBhZGRyIDogZS5nZXRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKHNldC5jb250YWlucyhhZGRyKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIkR1cGUgIiArIGFkZHIgKyAiIGZvdW5kIGlu\nIGVuc2VtYmxlIGZvciBmcmFnbWVudCAiICsgZnJhZ21lbnQKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArICIgb2YgbGVkZ2VyICIgKyBsaC5n\nZXRJZCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbnVtRHVwZXMrKzsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgc2V0\nLmFkZChhZGRyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICByZXR1cm4gbnVtRHVwZXMgPiAwOwogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdCByZWNvdmVyeWluZyB0aGUgY2xvc2VkIGxl\nZGdlcnMgd2hlbiB0aGUgZmFpbGVkIGJvb2tpZSBzZXJ2ZXIgaXMgaW4gdGhl\nIGxhc3QgZW5zZW1ibGUKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAw\nMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RCb29raWVSZWNvdmVyeU9uQ2xvc2Vk\nTGVkZ2VycygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8vIENyZWF0\nZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBudW1MZWRnZXJzID0gMzsKICAg\nICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzID0gY3JlYXRlTGVkZ2Vycyhu\ndW1MZWRnZXJzLCBudW1Cb29raWVzLCAyKTsKCiAgICAgICAgLy8gV3JpdGUg\ndGhlIGVudHJpZXMgZm9yIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFsdWVz\nCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0ZUVudHJp\nZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgY2xvc2VM\nZWRnZXJzKGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIGxhc3QgYm9va2ll\nIHNlcnZlciBpbiBsYXN0IGVuc2VtYmxlCiAgICAgICAgQXJyYXlMaXN0PEJv\nb2tpZVNvY2tldEFkZHJlc3M+IGxhc3RFbnNlbWJsZSA9IGxocy5nZXQoMCku\nZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCkuZ2V0VmFsdWUoKTsKICAg\nICAgICBCb29raWVTb2NrZXRBZGRyZXNzIGJvb2tpZVRvS2lsbCA9IGxhc3RF\nbnNlbWJsZS5nZXQobGFzdEVuc2VtYmxlLnNpemUoKSAtIDEpOwogICAgICAg\nIGtpbGxCb29raWUoYm9va2llVG9LaWxsKTsKCiAgICAgICAgLy8gc3RhcnQg\nYSBuZXcgYm9va2llCiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAg\nICAgQm9va2llU29ja2V0QWRkcmVzcyBib29raWVEZXN0ID0gbnVsbDsKICAg\nICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtp\nbGxlZCBib29raWUgKCIgKyBib29raWVUb0tpbGwKICAgICAgICAgICAgICAg\nKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIGEgcmFuZG9tIGF2YWlsYWJsZSBv\nbmUiKTsKCiAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29r\naWVUb0tpbGwsIGJvb2tpZURlc3QpOwogICAgICAgIGZvciAoTGVkZ2VySGFu\nZGxlIGxoIDogbGhzKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUoIk5vdCBm\ndWxseSByZXBsaWNhdGVkIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCBu\ndW1Nc2dzKSk7CiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0Qm9va2llUmVjb3ZlcnlPbk9wZW5lZExlZGdlcnMoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAg\nICAgICBpbnQgbnVtTGVkZ2VycyA9IDM7CiAgICAgICAgTGlzdDxMZWRnZXJI\nYW5kbGU+IGxocyA9IGNyZWF0ZUxlZGdlcnMobnVtTGVkZ2VycywgbnVtQm9v\na2llcywgMik7CgogICAgICAgIC8vIFdyaXRlIHRoZSBlbnRyaWVzIGZvciB0\naGUgbGVkZ2VycyB3aXRoIGR1bW15IHZhbHVlcwogICAgICAgIGludCBudW1N\nc2dzID0gMTA7CiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1z\nZ3MsIDAsIGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJzdCBi\nb29raWUgc2VydmVyCiAgICAgICAgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFk\nZHJlc3M+IGxhc3RFbnNlbWJsZSA9IGxocy5nZXQoMCkuZ2V0TGVkZ2VyTWV0\nYWRhdGEoKS5nZXRFbnNlbWJsZXMoKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVudHJ5U2V0KCku\naXRlcmF0b3IoKS5uZXh0KCkuZ2V0VmFsdWUoKTsKICAgICAgICBCb29raWVT\nb2NrZXRBZGRyZXNzIGJvb2tpZVRvS2lsbCA9IGxhc3RFbnNlbWJsZS5nZXQo\nbGFzdEVuc2VtYmxlLnNpemUoKSAtIDEpOwogICAgICAgIGtpbGxCb29raWUo\nYm9va2llVG9LaWxsKTsKCiAgICAgICAgLy8gc3RhcnQgYSBuZXcgYm9va2ll\nCiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAgQm9va2llU29j\na2V0QWRkcmVzcyBib29raWVEZXN0ID0gbnVsbDsKICAgICAgICBMT0cuaW5m\nbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtpbGxlZCBib29raWUg\nKCIgKyBib29raWVUb0tpbGwKICAgICAgICAgICAgICAgKyAiKSBhbmQgcmVw\nbGljYXRlIGl0IHRvIGEgcmFuZG9tIGF2YWlsYWJsZSBvbmUiKTsKCiAgICAg\nICAgYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29raWVUb0tpbGwsIGJv\nb2tpZURlc3QpOwoKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6IGxo\ncykgewogICAgICAgICAgICBhc3NlcnRUcnVlKCJOb3QgZnVsbHkgcmVwbGlj\nYXRlZCIsIHZlcmlmeUZ1bGx5UmVwbGljYXRlZChsaCwgbnVtTXNncykpOwog\nICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gd2UgY2Fu\nJ3Qgd3JpdGUgZW50cmllcwogICAgICAgICAgICB3cml0ZUVudHJpZXN0b0xl\nZGdlcnMobnVtTXNncywgMCwgbGhzKTsKICAgICAgICAgICAgZmFpbCgic2hv\ndWxkIG5vdCByZWFjaCBoZXJlIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3QodGltZW91dD02\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RCb29raWVSZWNvdmVyeU9uSW5S\nZWNvdmVyeUxlZGdlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGlu\ndCBudW1Nc2dzID0gMTA7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJz\nCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAxOwogICAgICAgIExpc3Q8TGVk\nZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMsIDIs\nIDIpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmllcyBmb3IgdGhlIGxl\nZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMKICAgICAgICB3cml0ZUVudHJpZXN0\nb0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgLy8gU2h1dGRv\nd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBBcnJheUxpc3Q8\nQm9va2llU29ja2V0QWRkcmVzcz4gbGFzdEVuc2VtYmxlID0gbGhzLmdldCgw\nKS5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAuZW50cnlTZXQoKS5pdGVyYXRvcigpLm5leHQoKS5nZXRWYWx1ZSgpOwog\nICAgICAgIC8vIHJlbW92ZWQgYm9va2llCiAgICAgICAgQm9va2llU29ja2V0\nQWRkcmVzcyBib29raWVUb0tpbGwgPSBsYXN0RW5zZW1ibGUuZ2V0KDApOwog\nICAgICAgIGtpbGxCb29raWUoYm9va2llVG9LaWxsKTsKICAgICAgICAvLyB0\nZW1wIGZhaWx1cmUKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIGJvb2tp\nZVRvS2lsbDIgPSBsYXN0RW5zZW1ibGUuZ2V0KDEpOwogICAgICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZjIgPSBraWxsQm9va2llKGJvb2tpZVRvS2ls\nbDIpOwoKICAgICAgICAvLyBzdGFydCBhIG5ldyBib29raWUKICAgICAgICBz\ndGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICAvLyBvcGVuIHRoZXNlIGxlZGdl\ncnMKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBvbGRMaCA6IGxocykgewog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYmtjLm9wZW5MZWRn\nZXIob2xkTGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgYmFzZUNsaWVudENvbmYu\nZ2V0Qm9va2llUmVjb3ZlcnlQYXNzd2QoKSk7CiAgICAgICAgICAgICAgICBm\nYWlsKCJTaG91bGQgaGF2ZSB0aHJvd24gZXhjZXB0aW9uIik7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJrQWRtaW4ucmVj\nb3ZlckJvb2tpZURhdGEoYm9va2llVG9LaWxsLCBudWxsKTsKICAgICAgICAg\nICAgZmFpbCgiU2hvdWxkIGhhdmUgdGhyb3duIGV4Y2VwdGlvbiIpOwogICAg\nICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTGVkZ2VyUmVjb3ZlcnlFeGNl\ncHRpb24gYmtlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3Vy\nCiAgICAgICAgfQoKICAgICAgICAvLyByZXN0YXJ0IGZhaWxlZCBib29raWUK\nICAgICAgICBicy5hZGQoc3RhcnRCb29raWUoY29uZjIpKTsKICAgICAgICBi\nc0NvbmZzLmFkZChjb25mMik7CgogICAgICAgIC8vIHJlY292ZXIgdGhlbQog\nICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tpZURhdGEoYm9va2llVG9LaWxs\nLCBudWxsKTsKCiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMp\nIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTm90IGZ1bGx5IHJlcGxpY2F0\nZWQiLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQobGgsIG51bU1zZ3MpKTsKICAg\nICAgICB9CgogICAgICAgIC8vIG9wZW4gbGVkZ2VycyB0byByZWFkIG1ldGFk\nYXRhCiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IG5ld0xocyA9IG9wZW5M\nZWRnZXJzKGxocyk7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbmV3TGgg\nOiBuZXdMaHMpIHsKICAgICAgICAgICAgLy8gZmlyc3QgZW5zZW1ibGUgc2hv\ndWxkIGNvbnRhaW5zIGJvb2tpZVRvS2lsbDIgYW5kIG5vdCBjb250YWluIGJv\nb2tpZVRvS2lsbAogICAgICAgICAgICBNYXAuRW50cnk8TG9uZywgQXJyYXlM\naXN0PEJvb2tpZVNvY2tldEFkZHJlc3M+PiBlbnRyeSA9CiAgICAgICAgICAg\nICAgICBuZXdMaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygp\nLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCk7CiAgICAgICAgICAgIGFz\nc2VydEZhbHNlKGVudHJ5LmdldFZhbHVlKCkuY29udGFpbnMoYm9va2llVG9L\naWxsKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoZW50cnkuZ2V0VmFsdWUo\nKS5jb250YWlucyhib29raWVUb0tpbGwyKSk7CiAgICAgICAgfQoKICAgIH0K\nCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndEFzeW5jQm9va2llUmVjb3ZlcnlUb1JhbmRvbUJvb2tpZXNOb3RFbm91Z2hC\nb29raWVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRl\nIHRoZSBsZWRnZXJzCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAg\nICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51\nbUxlZGdlcnMsIG51bUJvb2tpZXMsIDIpOwoKICAgICAgICAvLyBXcml0ZSB0\naGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMu\nCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0ZUVudHJp\nZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgLy8gU2h1\ndGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBMT0cuaW5m\nbygiRmluaXNoZWQgd3JpdGluZyBhbGwgbGVkZ2VyIGVudHJpZXMgc28gc2h1\ndGRvd24gb25lIG9mIHRoZSBib29raWVzLiIpOwogICAgICAgIGludCBpbml0\naWFsUG9ydCA9IGJzQ29uZnMuZ2V0KDApLmdldEJvb2tpZVBvcnQoKTsKICAg\nICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1vdmUo\nMCk7CgogICAgICAgIC8vIENhbGwgdGhlIGFzeW5jIHJlY292ZXIgYm9va2ll\nIG1ldGhvZC4KICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIGJvb2tpZVNy\nYyA9IG5ldyBCb29raWVTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNzLmdldExv\nY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksCiAgICAgICAgICAgICAgICBp\nbml0aWFsUG9ydCk7CiAgICAgICAgTE9HLmluZm8oIk5vdyByZWNvdmVyIHRo\nZSBkYXRhIG9uIHRoZSBraWxsZWQgYm9va2llICgiICsgYm9va2llU3JjCiAg\nICAgICAgICAgICAgICAgKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIGEgcmFu\nZG9tIGF2YWlsYWJsZSBvbmUiKTsKICAgICAgICAvLyBJbml0aWF0ZSB0aGUg\nc3luYyBvYmplY3QKICAgICAgICBzeW5jLnZhbHVlID0gZmFsc2U7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0\nYShib29raWVTcmMsIG51bGwpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQg\naGF2ZSB0aHJvd24gZXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoQktF\neGNlcHRpb24uQktMZWRnZXJSZWNvdmVyeUV4Y2VwdGlvbiBia2UpIHsKICAg\nICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAgICB9\nCgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRl\nc3RTeW5jQm9va2llUmVjb3ZlcnlUb1JhbmRvbUJvb2tpZXNDaGVja0ZvckR1\ncGVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgUmFuZG9tIHIgPSBu\nZXcgUmFuZG9tKCk7CgogICAgICAgIC8vIENyZWF0ZSB0aGUgbGVkZ2Vycwog\nICAgICAgIGludCBudW1MZWRnZXJzID0gMzsKICAgICAgICBMaXN0PExlZGdl\nckhhbmRsZT4gbGhzID0gY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJzLCBudW1C\nb29raWVzLCAyKTsKCiAgICAgICAgLy8gV3JpdGUgdGhlIGVudHJpZXMgZm9y\nIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFsdWVzLgogICAgICAgIGludCBu\ndW1Nc2dzID0gMTA7CiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51\nbU1zZ3MsIDAsIGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJz\ndCBib29raWUgc2VydmVyCiAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIHdy\naXRpbmcgYWxsIGxlZGdlciBlbnRyaWVzIHNvIHNodXRkb3duIG9uZSBvZiB0\naGUgYm9va2llcy4iKTsKICAgICAgICBpbnQgcmVtb3ZlSW5kZXggPSByLm5l\neHRJbnQoYnMuc2l6ZSgpKTsKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNz\nIGJvb2tpZVNyYyA9IGJzLmdldChyZW1vdmVJbmRleCkuZ2V0TG9jYWxBZGRy\nZXNzKCk7CiAgICAgICAgYnMuZ2V0KHJlbW92ZUluZGV4KS5zaHV0ZG93bigp\nOwogICAgICAgIGJzLnJlbW92ZShyZW1vdmVJbmRleCk7CgogICAgICAgIC8v\nIFN0YXJ0dXAgbmV3IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBzdGFydE5ld0Jv\nb2tpZSgpOwoKICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcyBm\nb3IgdGhlIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBiZQogICAg\nICAgIC8vIGNyZWF0ZWQgZm9yIHRoZW0uCiAgICAgICAgd3JpdGVFbnRyaWVz\ndG9MZWRnZXJzKG51bU1zZ3MsIG51bU1zZ3MsIGxocyk7CgogICAgICAgIC8v\nIENhbGwgdGhlIGFzeW5jIHJlY292ZXIgYm9va2llIG1ldGhvZC4KICAgICAg\nICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtpbGxl\nZCBib29raWUgKCIgKyBib29raWVTcmMKICAgICAgICAgICAgICAgICArICIp\nIGFuZCByZXBsaWNhdGUgaXQgdG8gYSByYW5kb20gYXZhaWxhYmxlIG9uZSIp\nOwogICAgICAgIC8vIEluaXRpYXRlIHRoZSBzeW5jIG9iamVjdAogICAgICAg\nIHN5bmMudmFsdWUgPSBmYWxzZTsKICAgICAgICBia0FkbWluLnJlY292ZXJC\nb29raWVEYXRhKGJvb2tpZVNyYywgbnVsbCk7CgogICAgICAgIGFzc2VydEZh\nbHNlKCJEdXBlcyBleGlzdCBpbiBlbnNlbWJsZXMiLCBmaW5kRHVwZXNJbkVu\nc2VtYmxlcyhsaHMpKTsKCiAgICAgICAgLy8gV3JpdGUgc29tZSBtb3JlIGVu\ndHJpZXMgdG8gZW5zdXJlIGZlbmNpbmcgaGFzbid0IGJyb2tlbiBzdHVmZgog\nICAgICAgIHdyaXRlRW50cmllc3RvTGVkZ2VycyhudW1Nc2dzLCBudW1Nc2dz\nKjIsIGxocyk7CgogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGhz\nKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUoIk5vdCBmdWxseSByZXBsaWNh\ndGVkIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCBudW1Nc2dzKjMpKTsK\nICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9CiAgICB9CgogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHJlY292ZXJX\naXRob3V0UGFzc3dvcmRJbkNvbmYoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBieXRlW10gcGFzc3dkQ29ycmVjdCA9ICJBQUFBQUEiLmdldEJ5dGVz\nKCk7CiAgICAgICAgYnl0ZVtdIHBhc3N3ZEJhZCA9ICJCQkJCQkIiLmdldEJ5\ndGVzKCk7CiAgICAgICAgRGlnZXN0VHlwZSBkaWdlc3RDb3JyZWN0ID0gZGln\nZXN0VHlwZTsKCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0\nZUxlZGdlcigzLCAyLCBkaWdlc3RDb3JyZWN0LCBwYXNzd2RDb3JyZWN0KTsK\nICAgICAgICBsb25nIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgIGxo\nLmFkZEVudHJ5KCJmb29iYXIiLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAg\nICAgICBsaC5jbG9zZSgpOwoKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNz\nIGJvb2tpZVNyYyA9IGJzLmdldCgwKS5nZXRMb2NhbEFkZHJlc3MoKTsKICAg\nICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1vdmUo\nMCk7CiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAgLy8gQ2hl\nY2sgdGhhdCBlbnRyaWVzIGFyZSBtaXNzaW5nCiAgICAgICAgbGggPSBia2Mu\nb3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENvcnJlY3Qs\nIHBhc3N3ZENvcnJlY3QpOwogICAgICAgIGFzc2VydEZhbHNlKCJTaG91bGQg\nYmUgZW50cmllcyBtaXNzaW5nIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxo\nLCAxMDApKTsKICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICAvLyBUcnkg\ndG8gcmVjb3ZlciB3aXRoIGJhZCBwYXNzd29yZCBpbiBjb25mCiAgICAgICAg\nLy8gVGhpcyBpcyBmaW5lLCBiZWNhdXNlIGl0IG9ubHkgZmFsbHMgYmFjayB0\nbyB0aGUgY29uZmlndXJlZAogICAgICAgIC8vIHBhc3N3b3JkIGlmIHRoZSBw\nYXNzd29yZCBpbmZvIGlzIG1pc3NpbmcgZnJvbSB0aGUgbWV0YWRhdGEKICAg\nICAgICBDbGllbnRDb25maWd1cmF0aW9uIGFkbWluQ29uZiA9IG5ldyBDbGll\nbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgYWRtaW5Db25mLnNldFprU2Vy\ndmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKTsKICAg\nICAgICBhZG1pbkNvbmYuc2V0Qm9va2llUmVjb3ZlcnlEaWdlc3RUeXBlKGRp\nZ2VzdENvcnJlY3QpOwogICAgICAgIGFkbWluQ29uZi5zZXRCb29raWVSZWNv\ndmVyeVBhc3N3ZChwYXNzd2RCYWQpOwogICAgICAgIHNldE1ldGFzdG9yZUlt\ncGxDbGFzcyhhZG1pbkNvbmYpOwoKICAgICAgICBCb29rS2VlcGVyQWRtaW4g\nYmthID0gbmV3IEJvb2tLZWVwZXJBZG1pbihhZG1pbkNvbmYpOwogICAgICAg\nIGJrYS5yZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIG51bGwpOwogICAg\nICAgIGJrYS5jbG9zZSgpOwoKICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2Vy\nTm9SZWNvdmVyeShsZWRnZXJJZCwgZGlnZXN0Q29ycmVjdCwgcGFzc3dkQ29y\ncmVjdCk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiU2hvdWxkIGJlIGJhY2sgdG8g\nZnVsbHkgcmVwbGljYXRpb24iLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQobGgs\nIDEwMCkpOwogICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgIGJvb2tpZVNy\nYyA9IGJzLmdldCgwKS5nZXRMb2NhbEFkZHJlc3MoKTsKICAgICAgICBicy5n\nZXQoMCkuc2h1dGRvd24oKTsKICAgICAgICBicy5yZW1vdmUoMCk7CiAgICAg\nICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCBl\nbnRyaWVzIGFyZSBtaXNzaW5nCiAgICAgICAgbGggPSBia2Mub3BlbkxlZGdl\nck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENvcnJlY3QsIHBhc3N3ZENv\ncnJlY3QpOwogICAgICAgIGFzc2VydEZhbHNlKCJTaG91bGQgYmUgZW50cmll\ncyBtaXNzaW5nIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCAxMDApKTsK\nICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICAvLyBUcnkgdG8gcmVjb3Zl\nciB3aXRoIG5vIHBhc3N3b3JkIGluIGNvbmYKICAgICAgICBhZG1pbkNvbmYg\nPSBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgIGFkbWluQ29u\nZi5zZXRaa1NlcnZlcnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJp\nbmcoKSk7CiAgICAgICAgc2V0TWV0YXN0b3JlSW1wbENsYXNzKGFkbWluQ29u\nZik7CgogICAgICAgIGJrYSA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYWRtaW5D\nb25mKTsKICAgICAgICBia2EucmVjb3ZlckJvb2tpZURhdGEoYm9va2llU3Jj\nLCBudWxsKTsKICAgICAgICBia2EuY2xvc2UoKTsKCiAgICAgICAgbGggPSBi\na2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIGRpZ2VzdENvcnJl\nY3QsIHBhc3N3ZENvcnJlY3QpOwogICAgICAgIGFzc2VydFRydWUoIlNob3Vs\nZCBiZSBiYWNrIHRvIGZ1bGx5IHJlcGxpY2F0aW9uIiwgdmVyaWZ5RnVsbHlS\nZXBsaWNhdGVkKGxoLCAxMDApKTsKICAgICAgICBsaC5jbG9zZSgpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IHdoZW4gd2UgdHJ5IHRvIHJl\nY292ZXIgYSBsZWRnZXIgd2hpY2ggZG9lc24ndCBoYXZlCiAgICAgKiB0aGUg\ncGFzc3dvcmQgc3RvcmVkIGluIHRoZSBjb25maWd1cmF0aW9uLCB3ZSBkb24n\ndCBzdWNjZWVkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCBlbnN1cmVQYXNzd29yZFVzZWRGb3JPbGRMZWRnZXJz\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gVGhpcyB0ZXN0IGJh\nc2VzIG9uIGNyZWF0aW5nIG9sZCBsZWRnZXJzIGluIHZlcnNpb24gNC4xLjAs\nIHdoaWNoIG9ubHkKICAgICAgICAvLyBzdXBwb3J0cyBab29LZWVwZXIgYmFz\nZWQgZmxhdCBhbmQgaGllcmFyY2hpY2FsIExlZGdlck1hbmFnZXJGYWN0b3J5\nLgogICAgICAgIC8vIFNvIHdlIGlnbm9yZSBpdCBmb3IgTVNMZWRnZXJNYW5h\nZ2VyRmFjdG9yeS4KICAgICAgICBpZiAoTVNMZWRnZXJNYW5hZ2VyRmFjdG9y\neS5jbGFzcy5nZXROYW1lKCkuZXF1YWxzKGxlZGdlck1hbmFnZXJGYWN0b3J5\nKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAv\nLyBzdG9wIGFsbCBib29raWVzCiAgICAgICAgLy8gYW5kIHdpcGUgdGhlIGxl\nZGdlciBsYXlvdXQgc28gd2UgY2FuIHVzZSBhbiBvbGQgY2xpZW50CiAgICAg\nICAgemtVdGlsLmdldFpvb0tlZXBlckNsaWVudCgpLmRlbGV0ZSgiL2xlZGdl\ncnMvTEFZT1VUIiwgLTEpOwoKICAgICAgICBieXRlW10gcGFzc3dkQ29ycmVj\ndCA9ICJBQUFBQUEiLmdldEJ5dGVzKCk7CiAgICAgICAgYnl0ZVtdIHBhc3N3\nZEJhZCA9ICJCQkJCQkIiLmdldEJ5dGVzKCk7CiAgICAgICAgRGlnZXN0VHlw\nZSBkaWdlc3RDb3JyZWN0ID0gZGlnZXN0VHlwZTsKICAgICAgICBEaWdlc3RU\neXBlIGRpZ2VzdEJhZCA9IGRpZ2VzdENvcnJlY3QgPT0gRGlnZXN0VHlwZS5N\nQUMgPyBEaWdlc3RUeXBlLkNSQzMyIDogRGlnZXN0VHlwZS5NQUM7CgogICAg\nICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJv\nb2tLZWVwZXIuRGlnZXN0VHlwZSBkaWdlc3RDb3JyZWN0NDEwCiAgICAgICAg\nICAgID0gb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tlZXBlci5jbGllbnQu\nQm9va0tlZXBlci5EaWdlc3RUeXBlLnZhbHVlT2YoZGlnZXN0VHlwZS50b1N0\ncmluZygpKTsKCiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tl\nZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24gYwogICAgICAgICAgICA9\nIG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNvbmYuQ2xp\nZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgIGMuc2V0WmtTZXJ2ZXJzKHpr\nVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAg\nIC5zZXRMZWRnZXJNYW5hZ2VyVHlwZSgKICAgICAgICAgICAgICAgICAgICBs\nZWRnZXJNYW5hZ2VyRmFjdG9yeS5lcXVhbHMoIm9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhLkZsYXRMZWRnZXJNYW5hZ2VyRmFjdG9yeSIpID8KICAgICAg\nICAgICAgICAgICAgICAiZmxhdCIgOiAiaGllcmFyY2hpY2FsIik7CgogICAg\nICAgIC8vIGNyZWF0ZSBjbGllbnQgdG8gc2V0IHVwIGxheW91dCwgY2xvc2Ug\naXQsIHJlc3RhcnQgYm9va2llcywgYW5kIG9wZW4gYSBuZXcgY2xpZW50Lgog\nICAgICAgIC8vIHRoZSBuZXcgY2xpZW50IGlzIG5lY2Vzc2FyeSB0byBlbnN1\ncmUgdGhhdCBpdCBoYXMgYWxsIHRoZSByZXN0YXJ0ZWQgYm9va2llcyBpbiB0\naGUKICAgICAgICAvLyBpdHMgYXZhaWxhYmxlIGJvb2tpZSBsaXN0CiAgICAg\nICAgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tlZXBlci5jbGllbnQuQm9v\na0tlZXBlciBia2M0MQogICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hlLmJr\nX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyKGMpOwogICAg\nICAgIGJrYzQxLmNsb3NlKCk7CiAgICAgICAgcmVzdGFydEJvb2tpZXMoKTsK\nICAgICAgICBia2M0MSA9IG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29r\na2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyKGMpOwoKICAgICAgICBvcmcuYXBh\nY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGUg\nbGg0MQogICAgICAgICAgICA9IGJrYzQxLmNyZWF0ZUxlZGdlcigzLCAyLCBk\naWdlc3RDb3JyZWN0NDEwLCBwYXNzd2RDb3JyZWN0KTsKICAgICAgICBsb25n\nIGxlZGdlcklkID0gbGg0MS5nZXRJZCgpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgbGg0MS5hZGRFbnRy\neSgiZm9vYmFyIi5nZXRCeXRlcygpKTsKICAgICAgICB9CiAgICAgICAgbGg0\nMS5jbG9zZSgpOwogICAgICAgIGJrYzQxLmNsb3NlKCk7CgogICAgICAgIC8v\nIFN0YXJ0dXAgYSBuZXcgYm9va2llIHNlcnZlcgogICAgICAgIHN0YXJ0TmV3\nQm9va2llKCk7CiAgICAgICAgaW50IHJlbW92ZUluZGV4ID0gMDsKICAgICAg\nICBCb29raWVTb2NrZXRBZGRyZXNzIGJvb2tpZVNyYyA9IGJzLmdldChyZW1v\ndmVJbmRleCkuZ2V0TG9jYWxBZGRyZXNzKCk7CiAgICAgICAgYnMuZ2V0KHJl\nbW92ZUluZGV4KS5zaHV0ZG93bigpOwogICAgICAgIGJzLnJlbW92ZShyZW1v\ndmVJbmRleCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgZW50cmllcyBhcmUg\nbWlzc2luZwogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5vcGVuTGVk\nZ2VyTm9SZWNvdmVyeShsZWRnZXJJZCwgZGlnZXN0Q29ycmVjdCwgcGFzc3dk\nQ29ycmVjdCk7CiAgICAgICAgYXNzZXJ0RmFsc2UoIlNob3VsZCBiZSBlbnRy\naWVzIG1pc3NpbmciLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQobGgsIDEwMCkp\nOwogICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgIC8vIFRyeSB0byByZWNv\ndmVyIHdpdGggYmFkIHBhc3N3b3JkIGluIGNvbmYKICAgICAgICAvLyBpZiB0\naGUgZGlnZXN0IHR5cGUgaXMgTUFDCiAgICAgICAgLy8gZm9yIENSQzMyLCB0\naGUgcGFzc3dvcmQgaXMgb25seSBjaGVja2VkCiAgICAgICAgLy8gd2hlbiBh\nZGRpbmcgbmV3IGVudHJpZXMsIHdoaWNoIHJlY292ZXJ5IHdpbGwKICAgICAg\nICAvLyBuZXZlciBkbwogICAgICAgIENsaWVudENvbmZpZ3VyYXRpb24gYWRt\naW5Db25mOwogICAgICAgIEJvb2tLZWVwZXJBZG1pbiBia2E7CiAgICAgICAg\naWYgKGRpZ2VzdENvcnJlY3QgPT0gRGlnZXN0VHlwZS5NQUMpIHsKICAgICAg\nICAgICAgYWRtaW5Db25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICAgICAgYWRtaW5Db25mLnNldFprU2VydmVycyh6a1V0aWwuZ2V0\nWm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKTsKICAgICAgICAgICAgYWRtaW5D\nb25mLnNldExlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKGxlZGdlck1h\nbmFnZXJGYWN0b3J5KTsKICAgICAgICAgICAgYWRtaW5Db25mLnNldEJvb2tp\nZVJlY292ZXJ5RGlnZXN0VHlwZShkaWdlc3RDb3JyZWN0KTsKICAgICAgICAg\nICAgYWRtaW5Db25mLnNldEJvb2tpZVJlY292ZXJ5UGFzc3dkKHBhc3N3ZEJh\nZCk7CgogICAgICAgICAgICBia2EgPSBuZXcgQm9va0tlZXBlckFkbWluKGFk\nbWluQ29uZik7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBi\na2EucmVjb3ZlckJvb2tpZURhdGEoYm9va2llU3JjLCBudWxsKTsKICAgICAg\nICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHJlY292ZXIg\nd2l0aCB3cm9uZyBwYXNzd29yZCIpOwogICAgICAgICAgICB9IGNhdGNoIChC\nS0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAgICAgIC8vIGNvcnJlY3Qg\nYmVoYXZpb3VyCiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nICAgICBia2EuY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgLy8gVHJ5IHRvIHJlY292ZXIgd2l0aCBiYWQgZGlnZXN0IGluIGNv\nbmYKICAgICAgICBhZG1pbkNvbmYgPSBuZXcgQ2xpZW50Q29uZmlndXJhdGlv\nbigpOwogICAgICAgIGFkbWluQ29uZi5zZXRaa1NlcnZlcnMoemtVdGlsLmdl\ndFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAgYWRtaW5Db25m\nLnNldExlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKGxlZGdlck1hbmFn\nZXJGYWN0b3J5KTsKICAgICAgICBhZG1pbkNvbmYuc2V0Qm9va2llUmVjb3Zl\ncnlEaWdlc3RUeXBlKGRpZ2VzdEJhZCk7CiAgICAgICAgYWRtaW5Db25mLnNl\ndEJvb2tpZVJlY292ZXJ5UGFzc3dkKHBhc3N3ZENvcnJlY3QpOwoKICAgICAg\nICBia2EgPSBuZXcgQm9va0tlZXBlckFkbWluKGFkbWluQ29uZik7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYmthLnJlY292ZXJCb29raWVEYXRhKGJv\nb2tpZVNyYywgbnVsbCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBi\nZSBhYmxlIHRvIHJlY292ZXIgd2l0aCB3cm9uZyBkaWdlc3QiKTsKICAgICAg\nICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAgLy8g\nY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBia2EuY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIC8vIENoZWNr\nIHRoYXQgZW50cmllcyBhcmUgc3RpbGwgbWlzc2luZwogICAgICAgIGxoID0g\nYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxlZGdlcklkLCBkaWdlc3RDb3Jy\nZWN0LCBwYXNzd2RDb3JyZWN0KTsKICAgICAgICBhc3NlcnRGYWxzZSgiU2hv\ndWxkIGJlIGVudHJpZXMgbWlzc2luZyIsIHZlcmlmeUZ1bGx5UmVwbGljYXRl\nZChsaCwgMTAwKSk7CiAgICAgICAgbGguY2xvc2UoKTsKCiAgICAgICAgYWRt\naW5Db25mLnNldEJvb2tpZVJlY292ZXJ5RGlnZXN0VHlwZShkaWdlc3RDb3Jy\nZWN0KTsKICAgICAgICBhZG1pbkNvbmYuc2V0Qm9va2llUmVjb3ZlcnlQYXNz\nd2QocGFzc3dkQ29ycmVjdCk7CgogICAgICAgIGJrYSA9IG5ldyBCb29rS2Vl\ncGVyQWRtaW4oYWRtaW5Db25mKTsKICAgICAgICBia2EucmVjb3ZlckJvb2tp\nZURhdGEoYm9va2llU3JjLCBudWxsKTsKICAgICAgICBia2EuY2xvc2UoKTsK\nCiAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2Vy\nSWQsIGRpZ2VzdENvcnJlY3QsIHBhc3N3ZENvcnJlY3QpOwogICAgICAgIGFz\nc2VydFRydWUoIlNob3VsZCBoYXZlIHJlY292ZXJlZCBldmVyeXRoaW5nIiwg\ndmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCAxMDApKTsKICAgICAgICBsaC5j\nbG9zZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

