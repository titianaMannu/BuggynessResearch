{"sha":"ba51175e2fde93203ebd3b60761a83484ec157a1","node_id":"MDQ6QmxvYjE1NzU5NTY6YmE1MTE3NWUyZmRlOTMyMDNlYmQzYjYwNzYxYTgzNDg0ZWMxNTdhMQ==","size":13192,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ba51175e2fde93203ebd3b60761a83484ec157a1","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5DeWNsaWNCYXJyaWVyOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5E\naWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYu\nQ2xpZW50Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5uZXQuQm9va2llU29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci50ZXN0LkJhc2VUZXN0Q2FzZTsKaW1wb3J0IG9yZy5q\ndW5pdC5UZXN0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IHN0YXRpYyBvcmcuanVu\naXQuQXNzZXJ0Lio7CgovKioKICogVGhpcyB1bml0IHRlc3QgdGVzdHMgbGVk\nZ2VyIGZlbmNpbmc7CiAqCiAqLwpwdWJsaWMgY2xhc3MgVGVzdEZlbmNpbmcg\nZXh0ZW5kcyBCYXNlVGVzdENhc2UgewogICAgcHJpdmF0ZSBmaW5hbCBzdGF0\naWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlc3RG\nZW5jaW5nLmNsYXNzKTsKCiAgICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGU7Cgog\nICAgcHVibGljIFRlc3RGZW5jaW5nKERpZ2VzdFR5cGUgZGlnZXN0VHlwZSkg\newogICAgICAgIHN1cGVyKDEwKTsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUg\nPSBkaWdlc3RUeXBlOwogICAgfQoKICAgIC8qKgogICAgICogQmFzaWMgZmVu\nY2luZyB0ZXN0LiBDcmVhdGUgbGVkZ2VyLCB3cml0ZSB0byBpdCwKICAgICAq\nIG9wZW4gbGVkZ2VyLCB3cml0ZSBhZ2FpbiAoc2hvdWxkIGZhaWwpLgogICAg\nICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdEJhc2ljRmVuY2luZygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIC8qCiAgICAgICAgICogQ3JlYXRlIGxlZGdlci4KICAgICAgICAgKi8KICAg\nICAgICBMZWRnZXJIYW5kbGUgd3JpdGVsaCA9IG51bGw7CiAgICAgICAgd3Jp\ndGVsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgInBhc3N3b3Jk\nIi5nZXRCeXRlcygpKTsKCiAgICAgICAgU3RyaW5nIHRtcCA9ICJCb29rS2Vl\ncGVyIGlzIGNvb2whIjsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEw\nOyBpKyspIHsKICAgICAgICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0\nQnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICAvKgogICAgICAgICAqIFRy\neSB0byBvcGVuIGxlZGdlci4KICAgICAgICAgKi8KICAgICAgICBMZWRnZXJI\nYW5kbGUgcmVhZGxoID0gYmtjLm9wZW5MZWRnZXIod3JpdGVsaC5nZXRJZCgp\nLCBkaWdlc3RUeXBlLCAicGFzc3dvcmQiLmdldEJ5dGVzKCkpOwogICAgICAg\nIC8vIHNob3VsZCBoYXZlIHRyaWdnZXJlZCByZWNvdmVyeSBhbmQgZmVuY2lu\nZwoKICAgICAgICB0cnkgewogICAgICAgICAgICB3cml0ZWxoLmFkZEVudHJ5\nKHRtcC5nZXRCeXRlcygpKTsKICAgICAgICAgICAgTE9HLmVycm9yKCJTaG91\nbGQgaGF2ZSB0aHJvd24gYW4gZXhjZXB0aW9uIik7CiAgICAgICAgICAgIGZh\naWwoIlNob3VsZCBoYXZlIHRocm93biBhbiBleGNlcHRpb24gd2hlbiB0cnlp\nbmcgdG8gd3JpdGUiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5C\nS0xlZGdlckZlbmNlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNv\ncnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQoKICAgICAgICAvKgogICAgICAg\nICAqIENoZWNrIGlmIGhhcyByZWNvdmVyZWQgcHJvcGVybHkuCiAgICAgICAg\nICovCiAgICAgICAgYXNzZXJ0VHJ1ZSgiSGFzIG5vdCByZWNvdmVyZWQgY29y\ncmVjdGx5OiAiICsgcmVhZGxoLmdldExhc3RBZGRDb25maXJtZWQoKQogICAg\nICAgICAgICAgICAgICAgKyAiIG9yaWdpbmFsICIgKyB3cml0ZWxoLmdldExh\nc3RBZGRDb25maXJtZWQoKSwKICAgICAgICAgICAgICAgICAgIHJlYWRsaC5n\nZXRMYXN0QWRkQ29uZmlybWVkKCkgPT0gd3JpdGVsaC5nZXRMYXN0QWRkQ29u\nZmlybWVkKCkpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGludCB0aHJl\nYWRDb3VudCA9IDA7CgogICAgY2xhc3MgTGVkZ2VyT3BlblRocmVhZCBleHRl\nbmRzIFRocmVhZCB7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBsb25nIGxlZGdl\ncklkOwogICAgICAgIHByaXZhdGUgbG9uZyBsYXN0Q29uZmlybWVkRW50cnkg\nPSAwOwoKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBEaWdlc3RUeXBlIGRpZ2Vz\ndFR5cGU7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBDeWNsaWNCYXJyaWVyIGJh\ncnJpZXI7CgogICAgICAgIExlZGdlck9wZW5UaHJlYWQgKERpZ2VzdFR5cGUg\nZGlnZXN0VHlwZSwgbG9uZyBsZWRnZXJJZCwgQ3ljbGljQmFycmllciBiYXJy\naWVyKQogICAgICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHN1cGVyKCJUZXN0RmVuY2luZy1MZWRnZXJPcGVuVGhyZWFkLSIg\nKyB0aHJlYWRDb3VudCsrKTsKICAgICAgICAgICAgdGhpcy5sZWRnZXJJZCA9\nIGxlZGdlcklkOwogICAgICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBkaWdl\nc3RUeXBlOwogICAgICAgICAgICB0aGlzLmJhcnJpZXIgPSBiYXJyaWVyOwog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgcnVuKCkgewogICAgICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBudWxs\nOwogICAgICAgICAgICBCb29rS2VlcGVyIGJrID0gbnVsbDsKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIGJhcnJpZXIuYXdhaXQoKTsKICAg\nICAgICAgICAgICAgIHdoaWxlKHRydWUpIHsKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBiayA9IG5ldyBCb29r\nS2VlcGVyKG5ldyBDbGllbnRDb25maWd1cmF0aW9uKGJhc2VDbGllbnRDb25m\nKSwgYmtjLmdldFprSGFuZGxlKCkpOwoKICAgICAgICAgICAgICAgICAgICAg\nICAgbGggPSBiay5vcGVuTGVkZ2VyKGxlZGdlcklkLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlnZXN0VHlwZSwgIiIu\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RDb25m\naXJtZWRFbnRyeSA9IGxoLmdldExhc3RBZGRDb25maXJtZWQoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nQktFeGNlcHRpb24uQktNZXRhZGF0YVZlcnNpb25FeGNlcHRpb24gemtlKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJDb250ZW50aW9u\nIHdpdGggc29tZW9uZSBlbHNlIHJlY292ZXJpbmciKTsKICAgICAgICAgICAg\nICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0xlZGdlclJlY292ZXJ5\nRXhjZXB0aW9uIGJrcmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmluZm8oIkNvbnRlbnRpb24gd2l0aCBzb21lb25lIGVsc2UgcmVjb3Zlcmlu\nZyIpOwogICAgICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChsaCAhPSBudWxsKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChiayAhPSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiay5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmsgPSBudWxsOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgLy8ganVzdCBleGl0LCB0ZXN0IHNo\nb3VsZCBzcG90IGJhZCBsYXN0IGFkZCBjb25maXJtZWQKICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIG9jY3VycmVkICIsIGUpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIExPRy5pbmZvKCJUaHJlYWQgZXhpdGlu\nZywgbGFzdENvbmZpcm1lZEVudHJ5ID0gIiArIGxhc3RDb25maXJtZWRFbnRy\neSk7CiAgICAgICAgfQoKICAgICAgICBsb25nIGdldExhc3RDb25maXJtZWRF\nbnRyeSgpIHsKICAgICAgICAgICAgcmV0dXJuIGxhc3RDb25maXJtZWRFbnRy\neTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUcnkgdG8gb3Bl\nbiBhIGxlZGdlciBtYW55IHRpbWVzIGluIHBhcmFsbGVsLgogICAgICogQWxs\nIG9wZW5zIHNob3VsZCByZXN1bHQgaW4gYSBsZWRnZXIgd2l0aCBhbiBlcXVh\nbHMgbnVtYmVyIG9mCiAgICAgKiBlbnRyaWVzLgogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE1hbnlPcGVu\nUGFyYWxsZWwoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvKgogICAg\nICAgICAqIENyZWF0ZSBsZWRnZXIuCiAgICAgICAgICovCiAgICAgICAgZmlu\nYWwgTGVkZ2VySGFuZGxlIHdyaXRlbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRp\nZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwoKICAgICAgICBmaW5hbCBpbnQg\nbnVtUmVjb3ZlcnkgPSAxMDsKCiAgICAgICAgZmluYWwgU3RyaW5nIHRtcCA9\nICJCb29rS2VlcGVyIGlzIGNvb2whIjsKICAgICAgICBmaW5hbCBDb3VudERv\nd25MYXRjaCBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaChudW1SZWNvdmVy\neSk7CiAgICAgICAgVGhyZWFkIHdyaXRldGhyZWFkID0gbmV3IFRocmVhZCgp\nIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB3\naGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3Jp\ndGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZv\nKCJFeGNlcHRpb24gYWRkaW5nIGVudHJ5IiwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAg\nICAgIHdyaXRldGhyZWFkLnN0YXJ0KCk7CgoKICAgICAgICBDeWNsaWNCYXJy\naWVyIGJhcnJpZXIgPSBuZXcgQ3ljbGljQmFycmllcihudW1SZWNvdmVyeSsx\nKTsKICAgICAgICBMZWRnZXJPcGVuVGhyZWFkIHRocmVhZHNbXSA9IG5ldyBM\nZWRnZXJPcGVuVGhyZWFkW251bVJlY292ZXJ5XTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IG51bVJlY292ZXJ5OyBpKyspIHsKICAgICAgICAgICAg\ndGhyZWFkc1tpXSA9IG5ldyBMZWRnZXJPcGVuVGhyZWFkKGRpZ2VzdFR5cGUs\nIHdyaXRlbGguZ2V0SWQoKSwgYmFycmllcik7CiAgICAgICAgICAgIHRocmVh\nZHNbaV0uc3RhcnQoKTsKICAgICAgICB9CiAgICAgICAgbGF0Y2guYXdhaXQo\nKTsKICAgICAgICBiYXJyaWVyLmF3YWl0KCk7IC8vIHNob3VsZCB0cmlnZ2Vy\nIHRocmVhZHMgdG8gZ28KCiAgICAgICAgd3JpdGV0aHJlYWQuam9pbigpOwog\nICAgICAgIGxvbmcgbGFzdENvbmZpcm1lZCA9IHdyaXRlbGguZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51\nbVJlY292ZXJ5OyBpKyspIHsKICAgICAgICAgICAgdGhyZWFkc1tpXS5qb2lu\nKCk7CiAgICAgICAgICAgIGFzc2VydFRydWUoIkFkZGVkIGNvbmZpcm1lZCBp\ncyBpbmNvcnJlY3QiLAogICAgICAgICAgICAgICAgICAgICAgIGxhc3RDb25m\naXJtZWQgPD0gdGhyZWFkc1tpXS5nZXRMYXN0Q29uZmlybWVkRW50cnkoKSk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IG9w\nZW5pbmcgYSBsZWRnZXIgaW4gbm9yZWNvdmVyeSBtb2RlCiAgICAgKiBkb2Vz\nbid0IGZlbmNlIG9mZiBhIGxlZGdlcgogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE5vUmVjb3ZlcnlPcGVu\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLyoKICAgICAgICAgKiBD\ncmVhdGUgbGVkZ2VyLgogICAgICAgICAqLwogICAgICAgIExlZGdlckhhbmRs\nZSB3cml0ZWxoID0gbnVsbDsKICAgICAgICB3cml0ZWxoID0gYmtjLmNyZWF0\nZUxlZGdlcihkaWdlc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKCiAgICAgICAg\nU3RyaW5nIHRtcCA9ICJCb29rS2VlcGVyIGlzIGNvb2whIjsKICAgICAgICBm\naW5hbCBpbnQgbnVtRW50cmllcyA9IDEwOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIHdyaXRl\nbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAgICAg\nICAgLyoKICAgICAgICAgKiBUcnkgdG8gb3BlbiBsZWRnZXIuCiAgICAgICAg\nICovCiAgICAgICAgTGVkZ2VySGFuZGxlIHJlYWRsaCA9IGJrYy5vcGVuTGVk\nZ2VyTm9SZWNvdmVyeSh3cml0ZWxoLmdldElkKCksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGln\nZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgLy8gc2hvdWxkIG5v\ndCBoYXZlIHRyaWdnZXJlZCByZWNvdmVyeSBhbmQgZmVuY2luZwoKICAgICAg\nICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICBs\nb25nIG51bVJlYWRhYmxlID0gcmVhZGxoLmdldExhc3RBZGRDb25maXJtZWQo\nKTsKICAgICAgICBMT0cuZXJyb3IoIm51bVJlYWQgIiArIG51bVJlYWRhYmxl\nKTsKICAgICAgICByZWFkbGgucmVhZEVudHJpZXMoMSwgbnVtUmVhZGFibGUp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlYWRsaC5yZWFkRW50cmll\ncyhudW1SZWFkYWJsZSsxLCBudW1SZWFkYWJsZSsxKTsKICAgICAgICAgICAg\nZmFpbCgiU2hvdWxkbid0IGhhdmUgYmVlbiBhYmxlIHRvIHJlYWQgdGhpcyBm\nYXIiKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS1JlYWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAvLyBhbGwgaXMgZ29vZAogICAgICAg\nIH0KCiAgICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7\nCiAgICAgICAgbG9uZyBudW1SZWFkYWJsZTIgPSByZWFkbGguZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpOwogICAgICAgIGFzc2VydEVxdWFscygiTnVtYmVyIG9m\nIHJlYWRhYmxlIGVudHJpZXMgaGFzbid0IGNoYW5nZWQiLCBudW1SZWFkYWJs\nZTIsIG51bVJlYWRhYmxlKTsKICAgICAgICByZWFkbGguY2xvc2UoKTsKCiAg\nICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAg\nICAgd3JpdGVsaC5jbG9zZSgpOwogICAgfQoKICAgIC8qKgogICAgICogY3Jl\nYXRlIGEgbGVkZ2VyIGFuZCB3cml0ZSBlbnRyaWVzLgogICAgICoga2lsbCBh\nIGJvb2tpZSBpbiB0aGUgZW5zZW1ibGUuIFJlY292ZXIuCiAgICAgKiBGZW5j\nZSB0aGUgbGVkZ2VyLiBLaWxsIGFub3RoZXIgYm9va2llLiBSZWNvdmVyLgog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEZlbmNpbmdJbnRlcmFjdGlvbldpdGhCb29raWVSZWNvdmVyeSgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN5c3RlbS5zZXRQcm9wZXJ0\neSgiZGlnZXN0VHlwZSIsIGRpZ2VzdFR5cGUudG9TdHJpbmcoKSk7CiAgICAg\nICAgU3lzdGVtLnNldFByb3BlcnR5KCJwYXNzd2QiLCAidGVzdFBhc3N3ZCIp\nOwoKICAgICAgICBCb29rS2VlcGVyQWRtaW4gYWRtaW4gPSBuZXcgQm9va0tl\nZXBlckFkbWluKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkp\nOwoKICAgICAgICBMZWRnZXJIYW5kbGUgd3JpdGVsaCA9IGJrYy5jcmVhdGVM\nZWRnZXIoZGlnZXN0VHlwZSwgInRlc3RQYXNzd2QiLmdldEJ5dGVzKCkpOwoK\nICAgICAgICBTdHJpbmcgdG1wID0gIkZvb2JhciI7CgogICAgICAgIGZpbmFs\nIGludCBudW1FbnRyaWVzID0gMTA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgd3JpdGVsaC5h\nZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICBC\nb29raWVTb2NrZXRBZGRyZXNzIGJvb2tpZVRvS2lsbAogICAgICAgICAgICA9\nIHdyaXRlbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZShudW1F\nbnRyaWVzKS5nZXQoMCk7CiAgICAgICAga2lsbEJvb2tpZShib29raWVUb0tp\nbGwpOwoKICAgICAgICAvLyB3cml0ZSBlbnRyaWVzIHRvIGNoYW5nZSBlbnNl\nbWJsZQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllczsg\naSsrKSB7CiAgICAgICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5\ndGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgYWRtaW4ucmVjb3ZlckJvb2tp\nZURhdGEoYm9va2llVG9LaWxsLCBudWxsKTsKCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgd3Jp\ndGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAg\nICAgICBMZWRnZXJIYW5kbGUgcmVhZGxoID0gYmtjLm9wZW5MZWRnZXIod3Jp\ndGVsaC5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBkaWdlc3RUeXBlLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0\nZXMoKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd3JpdGVsaC5hZGRF\nbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nU2hvdWxkIGhhdmUgdGhyb3duIGFuIGV4Y2VwdGlvbiIpOwogICAgICAgICAg\nICBmYWlsKCJTaG91bGQgaGF2ZSB0aHJvd24gYW4gZXhjZXB0aW9uIHdoZW4g\ndHJ5aW5nIHRvIHdyaXRlIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRp\nb24uQktMZWRnZXJGZW5jZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAv\nLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KCiAgICAgICAgcmVhZGxo\nLmNsb3NlKCk7CiAgICAgICAgd3JpdGVsaC5jbG9zZSgpOwogICAgfQoKICAg\nIC8qKgogICAgICogY3JlYXRlIGEgbGVkZ2VyIGFuZCB3cml0ZSBlbnRyaWVz\nLgogICAgICogRmVuY2UgdGhlIGxlZGdlci4gS2lsbCBhIGJvb2tpZS4gUmVj\nb3Zlci4KICAgICAqIEVuc3VyZSB0aGF0IHJlY292ZXIgZG9lc24ndCByZWFs\nbG93IGFkZGluZwogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdEZlbmNpbmdJbnRlcmFjdGlvbldpdGhCb29r\naWVSZWNvdmVyeTIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTeXN0\nZW0uc2V0UHJvcGVydHkoImRpZ2VzdFR5cGUiLCBkaWdlc3RUeXBlLnRvU3Ry\naW5nKCkpOwogICAgICAgIFN5c3RlbS5zZXRQcm9wZXJ0eSgicGFzc3dkIiwg\nInRlc3RQYXNzd2QiKTsKCiAgICAgICAgQm9va0tlZXBlckFkbWluIGFkbWlu\nID0gbmV3IEJvb2tLZWVwZXJBZG1pbih6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpKTsKCiAgICAgICAgTGVkZ2VySGFuZGxlIHdyaXRlbGgg\nPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsICJ0ZXN0UGFzc3dkIi5n\nZXRCeXRlcygpKTsKCiAgICAgICAgU3RyaW5nIHRtcCA9ICJGb29iYXIiOwoK\nICAgICAgICBmaW5hbCBpbnQgbnVtRW50cmllcyA9IDEwOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAg\nICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAg\nIH0KCiAgICAgICAgTGVkZ2VySGFuZGxlIHJlYWRsaCA9IGJrYy5vcGVuTGVk\nZ2VyKHdyaXRlbGguZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZGlnZXN0VHlwZSwgInRlc3RQYXNzd2Qi\nLmdldEJ5dGVzKCkpOwogICAgICAgIC8vIHNob3VsZCBiZSBmZW5jZWQgYnkg\nbm93CiAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBib29raWVUb0tpbGwK\nICAgICAgICAgICAgPSB3cml0ZWxoLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0\nRW5zZW1ibGUobnVtRW50cmllcykuZ2V0KDApOwogICAgICAgIGtpbGxCb29r\naWUoYm9va2llVG9LaWxsKTsKICAgICAgICBhZG1pbi5yZWNvdmVyQm9va2ll\nRGF0YShib29raWVUb0tpbGwsIG51bGwpOwoKICAgICAgICB0cnkgewogICAg\nICAgICAgICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJTaG91bGQgaGF2ZSB0aHJvd24gYW4gZXhj\nZXB0aW9uIik7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBoYXZlIHRocm93\nbiBhbiBleGNlcHRpb24gd2hlbiB0cnlpbmcgdG8gd3JpdGUiKTsKICAgICAg\nICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0xlZGdlckZlbmNlZEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAg\nICAgfQoKICAgICAgICByZWFkbGguY2xvc2UoKTsKICAgICAgICB3cml0ZWxo\nLmNsb3NlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgZmVu\nY2luZyBkb2Vzbid0IHdvcmsgd2l0aCBhIGJhZCBwYXNzd29yZAogICAgICov\nCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndEZlbmNpbmdCYWRQYXNzd29yZCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIC8qCiAgICAgICAgICogQ3JlYXRlIGxlZGdlci4KICAgICAgICAgKi8K\nICAgICAgICBMZWRnZXJIYW5kbGUgd3JpdGVsaCA9IG51bGw7CiAgICAgICAg\nd3JpdGVsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgInBhc3N3\nb3JkMSIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFN0cmluZyB0bXAgPSAiQm9v\na0tlZXBlciBpcyBjb29sISI7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1w\nLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgLyoKICAgICAgICAg\nKiBUcnkgdG8gb3BlbiBsZWRnZXIuCiAgICAgICAgICovCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYmtjLm9wZW5MZWRnZXIod3JpdGVsaC5nZXRJZCgp\nLCBkaWdlc3RUeXBlLCAiYmFkUGFzc3dvcmQiLmdldEJ5dGVzKCkpOwogICAg\nICAgICAgICBmYWlsKCJTaG91bGQgbm90IGhhdmUgYmVlbiBhYmxlIHRvIG9w\nZW4gd2l0aCBhIGJhZCBwYXNzd29yZCIpOwogICAgICAgIH0gY2F0Y2ggKEJL\nRXhjZXB0aW9uLkJLVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9uIHV1ZSkg\newogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0K\nICAgICAgICAvLyBzaG91bGQgaGF2ZSB0cmlnZ2VyZWQgcmVjb3ZlcnkgYW5k\nIGZlbmNpbmcKCiAgICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0\nZXMoKSk7CiAgICB9CgogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAg\ncHVibGljIHZvaWQgdGVzdEZlbmNpbmdBbmRSZXN0YXJ0Qm9va2llcygpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIExlZGdlckhhbmRsZSB3cml0ZWxo\nID0gbnVsbDsKICAgICAgICB3cml0ZWxoID0gYmtjLmNyZWF0ZUxlZGdlcihk\naWdlc3RUeXBlLCAicGFzc3dvcmQiLmdldEJ5dGVzKCkpOwoKICAgICAgICBT\ndHJpbmcgdG1wID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICB3cml0\nZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICB9CgogICAg\nICAgIC8qCiAgICAgICAgICogVHJ5IHRvIG9wZW4gbGVkZ2VyLgogICAgICAg\nICAqLwogICAgICAgIExlZGdlckhhbmRsZSByZWFkbGggPSBia2Mub3Blbkxl\nZGdlcih3cml0ZWxoLmdldElkKCksIGRpZ2VzdFR5cGUsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXNzd29yZCIu\nZ2V0Qnl0ZXMoKSk7CgogICAgICAgIHJlc3RhcnRCb29raWVzKCk7CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdl\ndEJ5dGVzKCkpOwogICAgICAgICAgICBMT0cuZXJyb3IoIlNob3VsZCBoYXZl\nIHRocm93biBhbiBleGNlcHRpb24iKTsKICAgICAgICAgICAgZmFpbCgiU2hv\ndWxkIGhhdmUgdGhyb3duIGFuIGV4Y2VwdGlvbiB3aGVuIHRyeWluZyB0byB3\ncml0ZSIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTGVkZ2Vy\nRmVuY2VkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBi\nZWhhdmlvdXIKICAgICAgICB9CgogICAgICAgIHJlYWRsaC5jbG9zZSgpOwog\nICAgfQp9Cg==\n","encoding":"base64"}

