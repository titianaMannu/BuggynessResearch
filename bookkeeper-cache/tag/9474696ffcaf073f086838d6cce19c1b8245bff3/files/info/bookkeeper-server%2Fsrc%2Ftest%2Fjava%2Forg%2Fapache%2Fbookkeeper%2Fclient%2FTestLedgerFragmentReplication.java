{"sha":"e4f744f1baf113cf537f5cfbdc7467af9e448c2e","node_id":"MDQ6QmxvYjE1NzU5NTY6ZTRmNzQ0ZjFiYWYxMTNjZjUzN2Y1Y2ZiZGM3NDY3YWY5ZTQ0OGMyZQ==","size":13338,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/e4f744f1baf113cf537f5cfbdc7467af9e448c2e","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7CgppbXBv\ncnQgamF2YS5uZXQuSW5ldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0aW9uOwppbXBvcnQg\namF2YS51dGlsLk1hcC5FbnRyeTsKaW1wb3J0IGphdmEudXRpbC5TZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CgppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0LkJvb2tpZVNvY2tldEFkZHJl\nc3M7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tl\nZXBlckludGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LkJvb2tLZWVwZXJDbHVzdGVy\nVGVzdENhc2U7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\nCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC4qOwoKLyoqCiAqIFRl\nc3RzIEJLQWRtaW4gdGhhdCBpdCBzaG91bGQgYmUgYWJsZSB0byByZXBsaWNh\ndGUgdGhlIGZhaWxlZCBib29raWUgZnJhZ21lbnRzCiAqIHRvIHRhcmdldCBi\nb29raWUuCiAqLwpwdWJsaWMgY2xhc3MgVGVzdExlZGdlckZyYWdtZW50UmVw\nbGljYXRpb24gZXh0ZW5kcyBCb29rS2VlcGVyQ2x1c3RlclRlc3RDYXNlIHsK\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBieXRlW10gVEVTVF9QU1NXRCA9\nICJ0ZXN0cGFzc3dkIi5nZXRCeXRlcygpOwogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgRGlnZXN0VHlwZSBURVNUX0RJR0VTVF9UWVBFID0gQm9va0tlZXBl\nci5EaWdlc3RUeXBlLkNSQzMyOwogICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMg\nTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkKICAgICAgICAgICAgLmdldExv\nZ2dlcihUZXN0TGVkZ2VyRnJhZ21lbnRSZXBsaWNhdGlvbi5jbGFzcyk7Cgog\nICAgcHVibGljIFRlc3RMZWRnZXJGcmFnbWVudFJlcGxpY2F0aW9uKCkgewog\nICAgICAgIHN1cGVyKDMpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIGNs\nYXNzIENoZWNrZXJDYWxsYmFjayBpbXBsZW1lbnRzCiAgICAgICAgICAgIEdl\nbmVyaWNDYWxsYmFjazxTZXQ8TGVkZ2VyRnJhZ21lbnQ+PiB7CiAgICAgICAg\ncHJpdmF0ZSBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IHJlc3VsdCA9IG51bGw7CiAg\nICAgICAgcHJpdmF0ZSBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBDb3Vu\ndERvd25MYXRjaCgxKTsKCiAgICAgICAgU2V0PExlZGdlckZyYWdtZW50PiB3\nYWl0QW5kR2V0UmVzdWx0KCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgbGF0Y2guYXdhaXQoKTsKICAgICAgICAgICAgcmV0\ndXJuIHJlc3VsdDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgU2V0\nPExlZGdlckZyYWdtZW50PiByZXN1bHQpIHsKICAgICAgICAgICAgdGhpcy5y\nZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgICAgIGxhdGNoLmNvdW50RG93bigp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3RzIHRoYXQg\ncmVwbGljYXRlIG1ldGhvZCBzaG91bGQgcmVwbGljYXRlIHRoZSBmYWlsZWQg\nYm9va2llIGZyYWdtZW50cwogICAgICogdG8gdGFyZ2V0IGJvb2tpZSBwYXNz\nZWQuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0UmVwbGljYXRlTEZTaG91bGRDb3B5RmFpbGVkQm9va2ll\nRnJhZ21lbnRzVG9UYXJnZXRCb29raWUoKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBieXRlW10gZGF0YSA9ICJUZXN0TGVkZ2Vy\nRnJhZ21lbnRSZXBsaWNhdGlvbiIuZ2V0Qnl0ZXMoKTsKICAgICAgICBMZWRn\nZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIFRFU1RfRElH\nRVNUX1RZUEUsCiAgICAgICAgICAgICAgICBURVNUX1BTU1dEKTsKCiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAg\nIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAgICBCb29raWVT\nb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwgPSBsaC5nZXRMZWRnZXJNZXRh\nZGF0YSgpLmdldEVuc2VtYmxlcygpCiAgICAgICAgICAgICAgICAuZ2V0KDBM\nKS5nZXQoMCk7CgogICAgICAgIExPRy5pbmZvKCJLaWxsaW5nIEJvb2tpZSIs\nIHJlcGxpY2FUb0tpbGwpOwogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRv\nS2lsbCk7CgogICAgICAgIGludCBzdGFydE5ld0Jvb2tpZSA9IHN0YXJ0TmV3\nQm9va2llKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsr\nKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0K\nCiAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBuZXdCa0FkZHIgPSBuZXcg\nQm9va2llU29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcwogICAgICAgICAgICAg\nICAgLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3\nQm9va2llKTsKICAgICAgICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoi\nICsgbmV3QmtBZGRyKTsKICAgICAgICBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IHJl\nc3VsdCA9IGdldEZyYWdtZW50c1RvUmVwbGljYXRlKGxoKTsKCiAgICAgICAg\nQm9va0tlZXBlckFkbWluIGFkbWluID0gbmV3IEJvb2tLZWVwZXJBZG1pbihi\nYXNlQ2xpZW50Q29uZik7CiAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAv\nLyAwLTkgZW50cmllcyBzaG91bGQgYmUgY29weSB0byBuZXcgYm9va2llCgog\nICAgICAgIGZvciAoTGVkZ2VyRnJhZ21lbnQgbGYgOiByZXN1bHQpIHsKICAg\nICAgICAgICAgYWRtaW4ucmVwbGljYXRlTGVkZ2VyRnJhZ21lbnQobGgsIGxm\nLCBuZXdCa0FkZHIpOwogICAgICAgIH0KCiAgICAgICAgLy8gS2lsbGluZyBh\nbGwgYm9va2llcyBleGNlcHQgbmV3bHkgcmVwbGljYXRlZCBib29raWUKICAg\nICAgICBTb3J0ZWRNYXA8TG9uZywgQXJyYXlMaXN0PEJvb2tpZVNvY2tldEFk\nZHJlc3M+PiBhbGxCb29raWVzQmVmb3JlUmVwbGljYXRpb24gPSBsaAogICAg\nICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVz\nKCk7CiAgICAgICAgU2V0PEVudHJ5PExvbmcsIEFycmF5TGlzdDxCb29raWVT\nb2NrZXRBZGRyZXNzPj4+IGVudHJ5U2V0ID0gYWxsQm9va2llc0JlZm9yZVJl\ncGxpY2F0aW9uCiAgICAgICAgICAgICAgICAuZW50cnlTZXQoKTsKICAgICAg\nICBmb3IgKEVudHJ5PExvbmcsIEFycmF5TGlzdDxCb29raWVTb2NrZXRBZGRy\nZXNzPj4gZW50cnkgOiBlbnRyeVNldCkgewogICAgICAgICAgICBBcnJheUxp\nc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gYm9va2llcyA9IGVudHJ5LmdldFZh\nbHVlKCk7CiAgICAgICAgICAgIGZvciAoQm9va2llU29ja2V0QWRkcmVzcyBi\nb29raWUgOiBib29raWVzKSB7CiAgICAgICAgICAgICAgICBpZiAobmV3QmtB\nZGRyLmVxdWFscyhib29raWUpKSB7CiAgICAgICAgICAgICAgICAgICAgY29u\ndGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBraWxs\nQm9va2llKGJvb2tpZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIFNob3VsZCBiZSBhYmxlIHRvIHJlYWQgdGhlIGVudHJpZXMgZnJv\nbSAwLTkKICAgICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxoLCAwLCA5\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3RzIHRoYXQgZnJhZ21lbnQg\ncmUtcmVwbGljYXRpb24gZmFpbHMgb24gbGFzdCB1bmNsb3NlZCBsZWRnZXIK\nICAgICAqIGZyYWdtZW50cy4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZXBsaWNhdGVMRkZhaWxzT25s\neU9uTGFzdFVuQ2xvc2VkRnJhZ21lbnRzKCkKICAgICAgICAgICAgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgYnl0ZVtdIGRhdGEgPSAiVGVzdExlZGdl\nckZyYWdtZW50UmVwbGljYXRpb24iLmdldEJ5dGVzKCk7CiAgICAgICAgTGVk\nZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBURVNUX0RJ\nR0VTVF9UWVBFLAogICAgICAgICAgICAgICAgVEVTVF9QU1NXRCk7CgogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAg\nICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAgICAgICAgQm9va2ll\nU29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsID0gbGguZ2V0TGVkZ2VyTWV0\nYWRhdGEoKS5nZXRFbnNlbWJsZXMoKQogICAgICAgICAgICAgICAgLmdldCgw\nTCkuZ2V0KDApOwoKICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAg\nIExPRy5pbmZvKCJLaWxsaW5nIEJvb2tpZSIsIHJlcGxpY2FUb0tpbGwpOwog\nICAgICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbCk7CgogICAgICAgIC8v\nIExldHMgcmVmb3JtIGVuc2VtYmxlCiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEp\nOwogICAgICAgIH0KCiAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyByZXBs\naWNhVG9LaWxsMiA9IGxoLmdldExlZGdlck1ldGFkYXRhKCkKICAgICAgICAg\nICAgICAgIC5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgxKTsKCiAgICAg\nICAgaW50IHN0YXJ0TmV3Qm9va2llMiA9IHN0YXJ0TmV3Qm9va2llKCk7CiAg\nICAgICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llIiwgcmVwbGljYVRvS2ls\nbDIpOwogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbDIpOwoKICAg\nICAgICBCb29raWVTb2NrZXRBZGRyZXNzIG5ld0JrQWRkciA9IG5ldyBCb29r\naWVTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAu\nZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29r\naWUyKTsKICAgICAgICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoiICsg\nbmV3QmtBZGRyKTsKICAgICAgICBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IHJlc3Vs\ndCA9IGdldEZyYWdtZW50c1RvUmVwbGljYXRlKGxoKTsKCiAgICAgICAgQm9v\na0tlZXBlckFkbWluIGFkbWluID0gbmV3IEJvb2tLZWVwZXJBZG1pbihiYXNl\nQ2xpZW50Q29uZik7CiAgICAgICAgLy8gMC05IGVudHJpZXMgc2hvdWxkIGJl\nIGNvcHkgdG8gbmV3IGJvb2tpZQoKICAgICAgICBpbnQgdW5jbG9zZWRDb3Vu\ndCA9IDA7CiAgICAgICAgZm9yIChMZWRnZXJGcmFnbWVudCBsZiA6IHJlc3Vs\ndCkgewogICAgICAgICAgICBpZiAobGYuaXNDbG9zZWQoKSkgewogICAgICAg\nICAgICAgICAgYWRtaW4ucmVwbGljYXRlTGVkZ2VyRnJhZ21lbnQobGgsIGxm\nLCBuZXdCa0FkZHIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICAgICAgdW5jbG9zZWRDb3VudCsrOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBhZG1pbi5yZXBsaWNhdGVMZWRnZXJGcmFn\nbWVudChsaCwgbGYsIG5ld0JrQWRkcik7CiAgICAgICAgICAgICAgICAgICAg\nZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gcmVyZXBsaWNhdGUgdW5jbG9z\nZWQgbGVkZ2VyIik7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2Vw\ndGlvbiBia2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb3JyZWN0IGJl\naGF2aW91cgogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIG9ubHkgb25l\nIHVuY2xvc2VkIGZyYWdtZW50IiwgMSwgdW5jbG9zZWRDb3VudCk7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBUZXN0cyB0aGF0IFJlcGxpY2F0ZUxlZGdlckZy\nYWdtZW50IHNob3VsZCByZXR1cm4gZmFsc2UgaWYgcmVwbGljYXRpb24KICAg\nICAqIGZhaWxzCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0UmVwbGljYXRlTEZTaG91bGRSZXR1cm5GYWxz\nZUlmVGhlUmVwbGljYXRpb25GYWlscygpCiAgICAgICAgICAgIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIGJ5dGVbXSBkYXRhID0gIlRlc3RMZWRnZXJG\ncmFnbWVudFJlcGxpY2F0aW9uIi5nZXRCeXRlcygpOwogICAgICAgIExlZGdl\nckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoMiwgMSwgVEVTVF9ESUdF\nU1RfVFlQRSwKICAgICAgICAgICAgICAgIFRFU1RfUFNTV0QpOwoKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAg\nbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQoKICAgICAgICAvLyBLaWxs\nIHRoZSBmaXJzdCBCb29raWUKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNz\nIHJlcGxpY2FUb0tpbGwgPSBsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVu\nc2VtYmxlcygpCiAgICAgICAgICAgICAgICAuZ2V0KDBMKS5nZXQoMCk7CiAg\nICAgICAga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsKTsKICAgICAgICBMT0cu\naW5mbygiS2lsbGVkIEJvb2tpZSA9IiArIHJlcGxpY2FUb0tpbGwpOwoKICAg\nICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRF\nbnRyeShkYXRhKTsKICAgICAgICB9CiAgICAgICAgLy8gS2lsbCB0aGUgc2Vj\nb25kIEJvb2tpZQogICAgICAgIHJlcGxpY2FUb0tpbGwgPSBsaC5nZXRMZWRn\nZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwog\nICAgICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbCk7CiAgICAgICAgTE9H\nLmluZm8oIktpbGxlZCBCb29raWUgPSIgKyByZXBsaWNhVG9LaWxsKTsKCiAg\nICAgICAgU2V0PExlZGdlckZyYWdtZW50PiBmcmFnbWVudHMgPSBnZXRGcmFn\nbWVudHNUb1JlcGxpY2F0ZShsaCk7CiAgICAgICAgQm9va0tlZXBlckFkbWlu\nIGFkbWluID0gbmV3IEJvb2tLZWVwZXJBZG1pbihiYXNlQ2xpZW50Q29uZik7\nCiAgICAgICAgaW50IHN0YXJ0TmV3Qm9va2llID0gc3RhcnROZXdCb29raWUo\nKTsKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIGFkZGl0aW9uYWxCSyA9\nIG5ldyBCb29raWVTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNzCiAgICAgICAg\nICAgICAgICAuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgc3Rh\ncnROZXdCb29raWUpOwogICAgICAgIGZvciAoTGVkZ2VyRnJhZ21lbnQgbGYg\nOiBmcmFnbWVudHMpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGFkbWluLnJlcGxpY2F0ZUxlZGdlckZyYWdtZW50KGxoLCBsZiwgYWRk\naXRpb25hbEJLKTsKICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24u\nQktMZWRnZXJSZWNvdmVyeUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICAvLyBleHBlY3RlZAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdHMgdGhhdCBzcGxpdEludG9TdWJGcmFnbWVu\ndCBzaG91bGQgYmUgYWJsZSB0byBzcGxpdCB0aGUgb3JpZ2luYWwKICAgICAq\nIHBhc3NlZCBmcmFnbWVudCBpbnRvIHN1YiBmcmFnbWVudHMgYXQgY29ycmVj\ndCBib3VuZGFyaWVzCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAzMDAw\nMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTcGxpdEludG9TdWJGcmFnbWVudHNX\naXRoRGlmZmVyZW50RnJhZ21lbnRCb3VuZGFyaWVzKCkKICAgICAgICAgICAg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyTWV0YWRhdGEgbWV0\nYWRhdGEgPSBuZXcgTGVkZ2VyTWV0YWRhdGEoMywgMywgMywgVEVTVF9ESUdF\nU1RfVFlQRSwKICAgICAgICAgICAgICAgIFRFU1RfUFNTV0QpIHsKICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIEFycmF5TGlzdDxCb29raWVT\nb2NrZXRBZGRyZXNzPiBnZXRFbnNlbWJsZShsb25nIGVudHJ5SWQpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNDbG9zZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgTGVkZ2VySGFuZGxlIGxo\nID0gbmV3IExlZGdlckhhbmRsZShia2MsIDAsIG1ldGFkYXRhLCBURVNUX0RJ\nR0VTVF9UWVBFLAogICAgICAgICAgICAgICAgVEVTVF9QU1NXRCk7CiAgICAg\nICAgdGVzdFNwbGl0SW50b1N1YkZyYWdtZW50cygxMCwgMjEsIC0xLCAxLCBs\naCk7CiAgICAgICAgdGVzdFNwbGl0SW50b1N1YkZyYWdtZW50cygxMCwgMjEs\nIDIwLCAxLCBsaCk7CiAgICAgICAgdGVzdFNwbGl0SW50b1N1YkZyYWdtZW50\ncygwLCAwLCAxMCwgMSwgbGgpOwogICAgICAgIHRlc3RTcGxpdEludG9TdWJG\ncmFnbWVudHMoMCwgMSwgMSwgMiwgbGgpOwogICAgICAgIHRlc3RTcGxpdElu\ndG9TdWJGcmFnbWVudHMoMjAsIDI0LCAyLCAzLCBsaCk7CiAgICAgICAgdGVz\ndFNwbGl0SW50b1N1YkZyYWdtZW50cygyMSwgMzIsIDMsIDQsIGxoKTsKICAg\nICAgICB0ZXN0U3BsaXRJbnRvU3ViRnJhZ21lbnRzKDIyLCAxMDMsIDExLCA4\nLCBsaCk7CiAgICAgICAgdGVzdFNwbGl0SW50b1N1YkZyYWdtZW50cyg0OSwg\nNTEsIDEsIDMsIGxoKTsKICAgICAgICB0ZXN0U3BsaXRJbnRvU3ViRnJhZ21l\nbnRzKDExLCAxMDEsIDMsIDMxLCBsaCk7CiAgICB9CgogICAgLyoqIGFzc2Vy\ndCB0aGUgc3ViLWZyYWdtZW50IGJvdW5kYXJpZXMgKi8KICAgIHZvaWQgdGVz\ndFNwbGl0SW50b1N1YkZyYWdtZW50cyhmaW5hbCBsb25nIG9yaUZyYWdtZW50\nRmlyc3RFbnRyeSwKICAgICAgICAgICAgZmluYWwgbG9uZyBvcmlGcmFnbWVu\ndExhc3RFbnRyeSwgbG9uZyBlbnRyaWVzUGVyU3ViRnJhZ21lbnQsCiAgICAg\nICAgICAgIGxvbmcgZXhwZWN0ZWRTdWJGcmFnbWVudHMsIExlZGdlckhhbmRs\nZSBsaCkgewogICAgICAgIExlZGdlckZyYWdtZW50IGZyID0gbmV3IExlZGdl\nckZyYWdtZW50KGxoLCBvcmlGcmFnbWVudEZpcnN0RW50cnksCiAgICAgICAg\nICAgICAgICBvcmlGcmFnbWVudExhc3RFbnRyeSwgMCkgewogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGxvbmcgZ2V0TGFzdFN0\nb3JlZEVudHJ5SWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3JpRnJh\nZ21lbnRMYXN0RW50cnk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgbG9uZyBnZXRGaXJzdFN0b3Jl\nZEVudHJ5SWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gb3JpRnJhZ21l\nbnRGaXJzdEVudHJ5OwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAg\nICBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IHN1YkZyYWdtZW50cyA9IExlZGdlckZy\nYWdtZW50UmVwbGljYXRvcgogICAgICAgICAgICAgICAgLnNwbGl0SW50b1N1\nYkZyYWdtZW50cyhsaCwgZnIsIGVudHJpZXNQZXJTdWJGcmFnbWVudCk7CiAg\nICAgICAgYXNzZXJ0RXF1YWxzKGV4cGVjdGVkU3ViRnJhZ21lbnRzLCBzdWJG\ncmFnbWVudHMuc2l6ZSgpKTsKICAgICAgICBpbnQgZnVsbFN1YkZyYWdtZW50\nID0gMDsKICAgICAgICBpbnQgcGFydGlhbFN1YkZyYWdtZW50ID0gMDsKICAg\nICAgICBmb3IgKExlZGdlckZyYWdtZW50IGxlZGdlckZyYWdtZW50IDogc3Vi\nRnJhZ21lbnRzKSB7CiAgICAgICAgICAgIGlmICgobGVkZ2VyRnJhZ21lbnQu\nZ2V0TGFzdEtub3duRW50cnlJZCgpCiAgICAgICAgICAgICAgICAgICAgLSBs\nZWRnZXJGcmFnbWVudC5nZXRGaXJzdEVudHJ5SWQoKSArIDEpID09IGVudHJp\nZXNQZXJTdWJGcmFnbWVudCkgewogICAgICAgICAgICAgICAgZnVsbFN1YkZy\nYWdtZW50Kys7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBsb25nIHRvdGFsRW50cmllc1RvUmVwbGljYXRlID0gb3JpRnJhZ21lbnRM\nYXN0RW50cnkKICAgICAgICAgICAgICAgICAgICAgICAgLSBvcmlGcmFnbWVu\ndEZpcnN0RW50cnkgKyAxOwogICAgICAgICAgICAgICAgaWYgKGVudHJpZXNQ\nZXJTdWJGcmFnbWVudCA8PSAwCiAgICAgICAgICAgICAgICAgICAgICAgIHx8\nIHRvdGFsRW50cmllc1RvUmVwbGljYXRlIC8gZW50cmllc1BlclN1YkZyYWdt\nZW50ID09IDApIHsKICAgICAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMo\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiRmlyc3RFbnRyeUlkIHNo\nb3VsZCBiZSBzYW1lIGFzIG9yaWdpbmFsIGZyYWdtZW50J3MgZmlyc3RFbnRy\neUlkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyLmdldEZpcnN0\nRW50cnlJZCgpLCBsZWRnZXJGcmFnbWVudAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuZ2V0Rmlyc3RFbnRyeUlkKCkpOwogICAgICAg\nICAgICAgICAgICAgIGFzc2VydEVxdWFscygKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICJMYXN0RW50cnlJZCBzaG91bGQgYmUgc2FtZSBhcyBvcmln\naW5hbCBmcmFnbWVudCdzIGxhc3RFbnRyeUlkIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZyLmdldExhc3RLbm93bkVudHJ5SWQoKSwgbGVkZ2Vy\nRnJhZ21lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLmdldExhc3RLbm93bkVudHJ5SWQoKSk7CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIGxvbmcgcGFydGlhbFNwbGl0RW50\ncmllcyA9IHRvdGFsRW50cmllc1RvUmVwbGljYXRlCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAlIGVudHJpZXNQZXJTdWJGcmFnbWVudDsKICAgICAg\nICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAiUGFydGlhbCBmcmFnbWVudCB3aXRoIHdyb25nIGVudHJ5\nIGJvdW5kYXJpZXMiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VyRnJhZ21lbnQuZ2V0TGFzdEtub3duRW50cnlJZCgpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC0gbGVkZ2VyRnJhZ21lbnQuZ2V0\nRmlyc3RFbnRyeUlkKCkgKyAxLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcGFydGlhbFNwbGl0RW50cmllcyk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBwYXJ0aWFsU3ViRnJhZ21lbnQrKzsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMoIlVuZXhwZWN0\nZWQgbnVtYmVyIG9mIHN1YiBmYXJnbWVudHMiLCBmdWxsU3ViRnJhZ21lbnQK\nICAgICAgICAgICAgICAgICsgcGFydGlhbFN1YkZyYWdtZW50LCBleHBlY3Rl\nZFN1YkZyYWdtZW50cyk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiVGhlcmUgc2hv\ndWxkIGJlIG9ubHkgb25lIG9yIHplcm8gcGFydGlhbCBzdWIgRnJhZ21lbnQi\nLAogICAgICAgICAgICAgICAgcGFydGlhbFN1YkZyYWdtZW50ID09IDAgfHwg\ncGFydGlhbFN1YkZyYWdtZW50ID09IDEpOwogICAgfQoKICAgIHByaXZhdGUg\nU2V0PExlZGdlckZyYWdtZW50PiBnZXRGcmFnbWVudHNUb1JlcGxpY2F0ZShM\nZWRnZXJIYW5kbGUgbGgpCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyQ2hlY2tlciBjaGVja2VyID0g\nbmV3IExlZGdlckNoZWNrZXIoYmtjKTsKICAgICAgICBDaGVja2VyQ2FsbGJh\nY2sgY2IgPSBuZXcgQ2hlY2tlckNhbGxiYWNrKCk7CiAgICAgICAgY2hlY2tl\nci5jaGVja0xlZGdlcihsaCwgY2IpOwogICAgICAgIFNldDxMZWRnZXJGcmFn\nbWVudD4gZnJhZ21lbnRzID0gY2Iud2FpdEFuZEdldFJlc3VsdCgpOwogICAg\nICAgIHJldHVybiBmcmFnbWVudHM7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIHZlcmlmeVJlY292ZXJlZExlZGdlcnMoTGVkZ2VySGFuZGxlIGxoLCBsb25n\nIHN0YXJ0RW50cnlJZCwKICAgICAgICAgICAgbG9uZyBlbmRFbnRyeUlkKSB0\naHJvd3MgQktFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGhzID0gYmtjLm9wZW5MZWRnZXJOb1JlY292\nZXJ5KGxoLmdldElkKCksCiAgICAgICAgICAgICAgICBURVNUX0RJR0VTVF9U\nWVBFLCBURVNUX1BTU1dEKTsKICAgICAgICBFbnVtZXJhdGlvbjxMZWRnZXJF\nbnRyeT4gZW50cmllcyA9IGxocy5yZWFkRW50cmllcyhzdGFydEVudHJ5SWQs\nCiAgICAgICAgICAgICAgICBlbmRFbnRyeUlkKTsKICAgICAgICBhc3NlcnRU\ncnVlKCJTaG91bGQgaGF2ZSB0aGUgZWxlbWVudHMiLCBlbnRyaWVzLmhhc01v\ncmVFbGVtZW50cygpKTsKICAgICAgICB3aGlsZSAoZW50cmllcy5oYXNNb3Jl\nRWxlbWVudHMoKSkgewogICAgICAgICAgICBMZWRnZXJFbnRyeSBlbnRyeSA9\nIGVudHJpZXMubmV4dEVsZW1lbnQoKTsKICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJUZXN0TGVkZ2VyRnJhZ21lbnRSZXBsaWNhdGlvbiIsIG5ldyBTdHJp\nbmcoZW50cnkKICAgICAgICAgICAgICAgICAgICAuZ2V0RW50cnkoKSkpOwog\nICAgICAgIH0KICAgIH0KCn0K\n","encoding":"base64"}

