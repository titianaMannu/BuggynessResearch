{"sha":"2a6c71d3a57a1f0ec69142e60278b8a70c705939","node_id":"MDQ6QmxvYjE1NzU5NTY6MmE2YzcxZDNhNTdhMWYwZWM2OTE0MmU2MDI3OGI4YTcwYzcwNTkzOQ==","size":13553,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2a6c71d3a57a1f0ec69142e60278b8a70c705939","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5F\nbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQg\namF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNv\ndW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGlt\nZVVuaXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5B\nc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5uZXQuQm9va2ll\nU29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50\nZXN0LkJhc2VUZXN0Q2FzZTsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJG\nYWN0b3J5OwoKaW1wb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0Lio7Cgov\nKioKICogVGhpcyB1bml0IHRlc3QgdGVzdHMgbGVkZ2VyIGZlbmNpbmc7CiAq\nCiAqLwpwdWJsaWMgY2xhc3MgVGVzdFNwZWN1bGF0aXZlUmVhZCBleHRlbmRz\nIEJhc2VUZXN0Q2FzZSB7CiAgICBwcml2YXRlIGZpbmFsIHN0YXRpYyBMb2dn\nZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVzdFNwZWN1bGF0\naXZlUmVhZC5jbGFzcyk7CgogICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwog\nICAgYnl0ZVtdIHBhc3N3ZCA9ICJzcGVjUFciLmdldEJ5dGVzKCk7CgogICAg\ncHVibGljIFRlc3RTcGVjdWxhdGl2ZVJlYWQoRGlnZXN0VHlwZSBkaWdlc3RU\neXBlKSB7CiAgICAgICAgc3VwZXIoMTApOwogICAgICAgIHRoaXMuZGlnZXN0\nVHlwZSA9IGRpZ2VzdFR5cGU7CiAgICB9CgogICAgbG9uZyBnZXRMZWRnZXJU\nb1JlYWQoaW50IGVuc2VtYmxlLCBpbnQgcXVvcnVtKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBieXRlW10gZGF0YSA9ICJEYXRhIGZvciB0ZXN0Ii5n\nZXRCeXRlcygpOwogICAgICAgIExlZGdlckhhbmRsZSBsID0gYmtjLmNyZWF0\nZUxlZGdlcihlbnNlbWJsZSwgcXVvcnVtLCBkaWdlc3RUeXBlLCBwYXNzd2Qp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAg\nICAgICAgICBsLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAgICBs\nLmNsb3NlKCk7CgogICAgICAgIHJldHVybiBsLmdldElkKCk7CiAgICB9Cgog\nICAgQFN1cHByZXNzV2FybmluZ3MoImRlcHJlY2F0aW9uIikKICAgIEJvb2tL\nZWVwZXIgY3JlYXRlQ2xpZW50KGludCBzcGVjVGltZW91dCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mID0g\nbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0U3Bl\nY3VsYXRpdmVSZWFkVGltZW91dChzcGVjVGltZW91dCkKICAgICAgICAgICAg\nLnNldFJlYWRUaW1lb3V0KDMwMDAwKTsKICAgICAgICBjb25mLnNldFprU2Vy\ndmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKTsKICAg\nICAgICByZXR1cm4gbmV3IEJvb2tLZWVwZXIoY29uZik7CiAgICB9CgogICAg\nY2xhc3MgTGF0Y2hDYWxsYmFjayBpbXBsZW1lbnRzIFJlYWRDYWxsYmFjayB7\nCiAgICAgICAgQ291bnREb3duTGF0Y2ggbCA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKICAgICAgICBib29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAg\nICBsb25nIHN0YXJ0TWlsbGlzID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCk7CiAgICAgICAgbG9uZyBlbmRNaWxsaXMgPSBMb25nLk1BWF9WQUxVRTsK\nCiAgICAgICAgcHVibGljIHZvaWQgcmVhZENvbXBsZXRlKGludCByYywKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxo\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbnVtZXJhdGlv\nbjxMZWRnZXJFbnRyeT4gc2VxLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIGVuZE1pbGxpcyA9\nIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgICAgICBMT0cu\nZGVidWcoIkdvdCByZXNwb25zZSB7fSB7fSIsIHJjLCBnZXREdXJhdGlvbigp\nKTsKICAgICAgICAgICAgc3VjY2VzcyA9IHJjID09IEJLRXhjZXB0aW9uLkNv\nZGUuT0s7CiAgICAgICAgICAgIGwuY291bnREb3duKCk7CiAgICAgICAgfQoK\nICAgICAgICBsb25nIGdldER1cmF0aW9uKCkgewogICAgICAgICAgICByZXR1\ncm4gZW5kTWlsbGlzIC0gc3RhcnRNaWxsaXM7CiAgICAgICAgfQoKICAgICAg\nICB2b2lkIGV4cGVjdFN1Y2Nlc3MoaW50IG1pbGxpc2Vjb25kcykgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGFzc2VydFRydWUobC5hd2FpdCht\naWxsaXNlY29uZHMsIFRpbWVVbml0Lk1JTExJU0VDT05EUykpOwogICAgICAg\nICAgICBhc3NlcnRUcnVlKHN1Y2Nlc3MpOwogICAgICAgIH0KCiAgICAgICAg\ndm9pZCBleHBlY3RGYWlsKGludCBtaWxsaXNlY29uZHMpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgICAgICBhc3NlcnRUcnVlKGwuYXdhaXQobWlsbGlz\nZWNvbmRzLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpKTsKICAgICAgICAgICAg\nYXNzZXJ0RmFsc2Uoc3VjY2Vzcyk7CiAgICAgICAgfQoKICAgICAgICB2b2lk\nIGV4cGVjdFRpbWVvdXQoaW50IG1pbGxpc2Vjb25kcykgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIGFzc2VydEZhbHNlKGwuYXdhaXQobWlsbGlz\nZWNvbmRzLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUZXN0IGJhc2ljIHNwZWN1bGF0aXZlIGZ1\nbmN0aW9uYWxpdHkuCiAgICAgKiAtIENyZWF0ZSAyIGNsaWVudHMgd2l0aCBy\nZWFkIHRpbWVvdXQgZGlzYWJsZWQsIG9uZSB3aXRoIHNwZWMKICAgICAqICAg\ncmVhZCBlbmFibGVkLCB0aGUgb3RoZXIgbm90LgogICAgICogLSBjcmVhdGUg\nbGVkZ2VyCiAgICAgKiAtIHNsZWVwIHNlY29uZCBib29raWUgaW4gZW5zZW1i\nbGUKICAgICAqIC0gcmVhZCBmaXJzdCBlbnRyeSwgYm90aCBzaG91bGQgZmlu\nZCBvbiBmaXJzdCBib29raWUuCiAgICAgKiAtIHJlYWQgc2Vjb25kIGJvb2tp\nZSwgc3BlYyBjbGllbnQgc2hvdWxkIGZpbmQgb24gYm9va2llIHRocmVlLAog\nICAgICogICBub24gc3BlYyBjbGllbnQgc2hvdWxkIGhhbmcuCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nU3BlY3VsYXRpdmVSZWFkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nbG9uZyBpZCA9IGdldExlZGdlclRvUmVhZCgzLDIpOwogICAgICAgIEJvb2tL\nZWVwZXIgYmtub3NwZWMgPSBjcmVhdGVDbGllbnQoMCk7IC8vIGRpc2FibGVk\nCiAgICAgICAgQm9va0tlZXBlciBia3NwZWMgPSBjcmVhdGVDbGllbnQoMjAw\nMCk7CgogICAgICAgIExlZGdlckhhbmRsZSBsbm9zcGVjID0gYmtub3NwZWMu\nb3BlbkxlZGdlcihpZCwgZGlnZXN0VHlwZSwgcGFzc3dkKTsKICAgICAgICBM\nZWRnZXJIYW5kbGUgbHNwZWMgPSBia3NwZWMub3BlbkxlZGdlcihpZCwgZGln\nZXN0VHlwZSwgcGFzc3dkKTsKCiAgICAgICAgLy8gc2xlZXAgc2Vjb25kIGJv\nb2tpZQogICAgICAgIENvdW50RG93bkxhdGNoIHNsZWVwTGF0Y2ggPSBuZXcg\nQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgQm9va2llU29ja2V0QWRkcmVz\ncyBzZWNvbmQgPSBsbm9zcGVjLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0RW5z\nZW1ibGVzKCkuZ2V0KDBMKS5nZXQoMSk7CiAgICAgICAgc2xlZXBCb29raWUo\nc2Vjb25kLCBzbGVlcExhdGNoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgLy8gcmVhZCBmaXJzdCBlbnRyeSwgYm90aCBnbyB0byBmaXJzdCBib29r\naWUsIHNob3VsZCBiZSBmaW5lCiAgICAgICAgICAgIExhdGNoQ2FsbGJhY2sg\nbm9zcGVjY2IgPSBuZXcgTGF0Y2hDYWxsYmFjaygpOwogICAgICAgICAgICBM\nYXRjaENhbGxiYWNrIHNwZWNjYiA9IG5ldyBMYXRjaENhbGxiYWNrKCk7CiAg\nICAgICAgICAgIGxub3NwZWMuYXN5bmNSZWFkRW50cmllcygwLCAwLCBub3Nw\nZWNjYiwgbnVsbCk7CiAgICAgICAgICAgIGxzcGVjLmFzeW5jUmVhZEVudHJp\nZXMoMCwgMCwgc3BlY2NiLCBudWxsKTsKICAgICAgICAgICAgbm9zcGVjY2Iu\nZXhwZWN0U3VjY2VzcygyMDAwKTsKICAgICAgICAgICAgc3BlY2NiLmV4cGVj\ndFN1Y2Nlc3MoMjAwMCk7CgogICAgICAgICAgICAvLyByZWFkIHNlY29uZCBl\nbnRyeSwgYm90aCBsb29rIGZvciBzZWNvbmQgYm9vaywgc3BlYyByZWFkIGNs\naWVudAogICAgICAgICAgICAvLyB0cmllcyB0aGlyZCBib29raWUsIG5vbnNw\nZWMgY2xpZW50IGhhbmdzIGFzIHJlYWQgdGltZW91dCBpcyB2ZXJ5IGxvbmcu\nCiAgICAgICAgICAgIG5vc3BlY2NiID0gbmV3IExhdGNoQ2FsbGJhY2soKTsK\nICAgICAgICAgICAgc3BlY2NiID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAg\nICAgICAgICAgbG5vc3BlYy5hc3luY1JlYWRFbnRyaWVzKDEsIDEsIG5vc3Bl\nY2NiLCBudWxsKTsKICAgICAgICAgICAgbHNwZWMuYXN5bmNSZWFkRW50cmll\ncygxLCAxLCBzcGVjY2IsIG51bGwpOwogICAgICAgICAgICBzcGVjY2IuZXhw\nZWN0U3VjY2Vzcyg0MDAwKTsKICAgICAgICAgICAgbm9zcGVjY2IuZXhwZWN0\nVGltZW91dCg0MDAwKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBzbGVlcExhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICBsc3BlYy5j\nbG9zZSgpOwogICAgICAgICAgICBsbm9zcGVjLmNsb3NlKCk7CiAgICAgICAg\nICAgIGJrc3BlYy5jbG9zZSgpOwogICAgICAgICAgICBia25vc3BlYy5jbG9z\nZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhh\ndCBpZiBtb3JlIHRoYW4gb25lIHJlcGxpY2EgaXMgZG93biwgd2UgY2FuIHN0\naWxsIHJlYWQsIGFzIGxvbmcgYXMgdGhlIHF1b3J1bQogICAgICogc2l6ZSBp\ncyBsYXJnZXIgdGhhbiB0aGUgbnVtYmVyIG9mIGRvd24gcmVwbGljYXMuCiAg\nICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0U3BlY3VsYXRpdmVSZWFkTXVsdGlwbGVSZXBsaWNhc0Rvd24oKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGlkID0gZ2V0TGVkZ2Vy\nVG9SZWFkKDUsNSk7CiAgICAgICAgaW50IHRpbWVvdXQgPSA1MDAwOwogICAg\nICAgIEJvb2tLZWVwZXIgYmtzcGVjID0gY3JlYXRlQ2xpZW50KHRpbWVvdXQp\nOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbCA9IGJrc3BlYy5vcGVuTGVkZ2Vy\nKGlkLCBkaWdlc3RUeXBlLCBwYXNzd2QpOwoKICAgICAgICAvLyBzbGVlcCBi\nb29raWUgMSwgMiAmIDQKICAgICAgICBDb3VudERvd25MYXRjaCBzbGVlcExh\ndGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIHNsZWVwQm9v\na2llKGwuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKS5nZXQo\nMEwpLmdldCgxKSwgc2xlZXBMYXRjaCk7CiAgICAgICAgc2xlZXBCb29raWUo\nbC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpLmdldCgwTCku\nZ2V0KDIpLCBzbGVlcExhdGNoKTsKICAgICAgICBzbGVlcEJvb2tpZShsLmdl\ndExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQo\nNCksIHNsZWVwTGF0Y2gpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyByZWFkIGZpcnN0IGVudHJ5LCBzaG91bGQgY29tcGxldGUgZmFzdGVyIHRo\nYW4gdGltZW91dAogICAgICAgICAgICAvLyBhcyBib29raWUgMCBoYXMgdGhl\nIGVudHJ5CiAgICAgICAgICAgIExhdGNoQ2FsbGJhY2sgbGF0Y2gwID0gbmV3\nIExhdGNoQ2FsbGJhY2soKTsKICAgICAgICAgICAgbC5hc3luY1JlYWRFbnRy\naWVzKDAsIDAsIGxhdGNoMCwgbnVsbCk7CiAgICAgICAgICAgIGxhdGNoMC5l\neHBlY3RTdWNjZXNzKHRpbWVvdXQvMik7CgogICAgICAgICAgICAvLyBzZWNv\nbmQgc2hvdWxkIGhhdmUgdG8gaGl0IHR3byB0aW1lb3V0cyAoYm9va2llIDEg\nJiAyKQogICAgICAgICAgICAvLyBib29raWUgMyBoYXMgdGhlIGVudHJ5CiAg\nICAgICAgICAgIExhdGNoQ2FsbGJhY2sgbGF0Y2gxID0gbmV3IExhdGNoQ2Fs\nbGJhY2soKTsKICAgICAgICAgICAgbC5hc3luY1JlYWRFbnRyaWVzKDEsIDEs\nIGxhdGNoMSwgbnVsbCk7CiAgICAgICAgICAgIGxhdGNoMS5leHBlY3RUaW1l\nb3V0KHRpbWVvdXQpOwogICAgICAgICAgICBsYXRjaDEuZXhwZWN0U3VjY2Vz\ncyh0aW1lb3V0KjIpOwogICAgICAgICAgICBMT0cuaW5mbygiVGltZW91dCB7\nfSBsYXRjaDEgZHVyYXRpb24ge30iLCB0aW1lb3V0LCBsYXRjaDEuZ2V0RHVy\nYXRpb24oKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoInNob3VsZCBoYXZl\nIHRha2VuIGxvbmdlciB0aGFuIHR3byB0aW1lb3V0cywgYnV0IGxlc3MgdGhh\nbiAzIiwKICAgICAgICAgICAgICAgICAgICAgICBsYXRjaDEuZ2V0RHVyYXRp\nb24oKSA+PSB0aW1lb3V0KjIKICAgICAgICAgICAgICAgICAgICAgICAmJiBs\nYXRjaDEuZ2V0RHVyYXRpb24oKSA8IHRpbWVvdXQqMyk7CgogICAgICAgICAg\nICAvLyB0aGlyZCBzaG91bGQgaGF2ZSB0byBoaXQgb25lIHRpbWVvdXRzIChi\nb29raWUgMikKICAgICAgICAgICAgLy8gYm9va2llIDMgaGFzIHRoZSBlbnRy\neQogICAgICAgICAgICBMYXRjaENhbGxiYWNrIGxhdGNoMiA9IG5ldyBMYXRj\naENhbGxiYWNrKCk7CiAgICAgICAgICAgIGwuYXN5bmNSZWFkRW50cmllcygy\nLCAyLCBsYXRjaDIsIG51bGwpOwogICAgICAgICAgICBsYXRjaDIuZXhwZWN0\nVGltZW91dCh0aW1lb3V0LzIpOwogICAgICAgICAgICBsYXRjaDIuZXhwZWN0\nU3VjY2Vzcyh0aW1lb3V0KTsKICAgICAgICAgICAgTE9HLmluZm8oIlRpbWVv\ndXQge30gbGF0Y2gyIGR1cmF0aW9uIHt9IiwgdGltZW91dCwgbGF0Y2gyLmdl\ndER1cmF0aW9uKCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJzaG91bGQg\naGF2ZSB0YWtlbiBsb25nZXIgdGhhbiBvbmUgdGltZW91dCwgYnV0IGxlc3Mg\ndGhhbiAyIiwKICAgICAgICAgICAgICAgICAgICAgICBsYXRjaDIuZ2V0RHVy\nYXRpb24oKSA+PSB0aW1lb3V0CiAgICAgICAgICAgICAgICAgICAgICAgJiYg\nbGF0Y2gyLmdldER1cmF0aW9uKCkgPCB0aW1lb3V0KjIpOwoKICAgICAgICAg\nICAgLy8gZm91cnRoIHNob3VsZCBoYXZlIG5vIHRpbWVvdXQKICAgICAgICAg\nICAgLy8gYm9va2llIDMgaGFzIHRoZSBlbnRyeQogICAgICAgICAgICBMYXRj\naENhbGxiYWNrIGxhdGNoMyA9IG5ldyBMYXRjaENhbGxiYWNrKCk7CiAgICAg\nICAgICAgIGwuYXN5bmNSZWFkRW50cmllcygzLCAzLCBsYXRjaDMsIG51bGwp\nOwogICAgICAgICAgICBsYXRjaDMuZXhwZWN0U3VjY2Vzcyh0aW1lb3V0LzIp\nOwoKICAgICAgICAgICAgLy8gZmlmdGggc2hvdWxkIGhpdCBvbmUgdGltZW91\ndCwgKGJvb2tpZSA0KQogICAgICAgICAgICAvLyBib29raWUgMCBoYXMgdGhl\nIGVudHJ5CiAgICAgICAgICAgIExhdGNoQ2FsbGJhY2sgbGF0Y2g0ID0gbmV3\nIExhdGNoQ2FsbGJhY2soKTsKICAgICAgICAgICAgbC5hc3luY1JlYWRFbnRy\naWVzKDQsIDQsIGxhdGNoNCwgbnVsbCk7CiAgICAgICAgICAgIGxhdGNoNC5l\neHBlY3RUaW1lb3V0KHRpbWVvdXQvMik7CiAgICAgICAgICAgIGxhdGNoNC5l\neHBlY3RTdWNjZXNzKHRpbWVvdXQpOwogICAgICAgICAgICBMT0cuaW5mbygi\nVGltZW91dCB7fSBsYXRjaDQgZHVyYXRpb24ge30iLCB0aW1lb3V0LCBsYXRj\naDQuZ2V0RHVyYXRpb24oKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoInNo\nb3VsZCBoYXZlIHRha2VuIGxvbmdlciB0aGFuIG9uZSB0aW1lb3V0LCBidXQg\nbGVzcyB0aGFuIDIiLAogICAgICAgICAgICAgICAgICAgICAgIGxhdGNoNC5n\nZXREdXJhdGlvbigpID49IHRpbWVvdXQKICAgICAgICAgICAgICAgICAgICAg\nICAmJiBsYXRjaDQuZ2V0RHVyYXRpb24oKSA8IHRpbWVvdXQqMik7CgogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHNsZWVwTGF0Y2guY291bnRE\nb3duKCk7CiAgICAgICAgICAgIGwuY2xvc2UoKTsKICAgICAgICAgICAgYmtz\ncGVjLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCB0aGF0IGlmIGFmdGVyIGEgc3BlY3VsYXRpdmUgcmVhZCBpcyBraWNr\nZWQgb2ZmLCB0aGUgb3JpZ2luYWwgcmVhZCBjb21wbGV0ZXMKICAgICAqIG5v\ndGhpbmcgYmFkIGhhcHBlbnMuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9\nNjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3BlY3VsYXRpdmVSZWFkRmly\nc3RSZWFkQ29tcGxldGVJc09rKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgbG9uZyBpZCA9IGdldExlZGdlclRvUmVhZCgyLDIpOwogICAgICAgIGlu\ndCB0aW1lb3V0ID0gMTAwMDsKICAgICAgICBCb29rS2VlcGVyIGJrc3BlYyA9\nIGNyZWF0ZUNsaWVudCh0aW1lb3V0KTsKCiAgICAgICAgTGVkZ2VySGFuZGxl\nIGwgPSBia3NwZWMub3BlbkxlZGdlcihpZCwgZGlnZXN0VHlwZSwgcGFzc3dk\nKTsKCiAgICAgICAgLy8gc2xlZXAgYm9va2llcwogICAgICAgIENvdW50RG93\nbkxhdGNoIHNsZWVwTGF0Y2gwID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwog\nICAgICAgIENvdW50RG93bkxhdGNoIHNsZWVwTGF0Y2gxID0gbmV3IENvdW50\nRG93bkxhdGNoKDEpOwogICAgICAgIHNsZWVwQm9va2llKGwuZ2V0TGVkZ2Vy\nTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKSwgc2xl\nZXBMYXRjaDApOwogICAgICAgIHNsZWVwQm9va2llKGwuZ2V0TGVkZ2VyTWV0\nYWRhdGEoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgxKSwgc2xlZXBM\nYXRjaDEpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyByZWFkIGdv\nZXMgdG8gZmlyc3QgYm9va2llLCBzcGVjIHJlYWQgdGltZW91dCBvY2N1cnMs\nCiAgICAgICAgICAgIC8vIGdvZXMgdG8gc2Vjb25kCiAgICAgICAgICAgIExh\ndGNoQ2FsbGJhY2sgbGF0Y2gwID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAg\nICAgICAgICAgbC5hc3luY1JlYWRFbnRyaWVzKDAsIDAsIGxhdGNoMCwgbnVs\nbCk7CiAgICAgICAgICAgIGxhdGNoMC5leHBlY3RUaW1lb3V0KHRpbWVvdXQp\nOwoKICAgICAgICAgICAgLy8gd2FrZSB1cCBmaXJzdCBib29raWUKICAgICAg\nICAgICAgc2xlZXBMYXRjaDAuY291bnREb3duKCk7CiAgICAgICAgICAgIGxh\ndGNoMC5leHBlY3RTdWNjZXNzKHRpbWVvdXQvMik7CgogICAgICAgICAgICBz\nbGVlcExhdGNoMS5jb3VudERvd24oKTsKCiAgICAgICAgICAgIC8vIGNoZWNr\nIHdlIGNhbiByZWFkIG5leHQgZW50cnkgd2l0aG91dCBpc3N1ZQogICAgICAg\nICAgICBMYXRjaENhbGxiYWNrIGxhdGNoMSA9IG5ldyBMYXRjaENhbGxiYWNr\nKCk7CiAgICAgICAgICAgIGwuYXN5bmNSZWFkRW50cmllcygxLCAxLCBsYXRj\naDEsIG51bGwpOwogICAgICAgICAgICBsYXRjaDEuZXhwZWN0U3VjY2Vzcyh0\naW1lb3V0LzIpOwoKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBz\nbGVlcExhdGNoMC5jb3VudERvd24oKTsKICAgICAgICAgICAgc2xlZXBMYXRj\naDEuY291bnREb3duKCk7CiAgICAgICAgICAgIGwuY2xvc2UoKTsKICAgICAg\nICAgICAgYmtzcGVjLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVW5pdCB0ZXN0IGZvciB0aGUgc3BlY3VsYXRpdmUgcmVhZCBz\nY2hlZHVsaW5nIG1ldGhvZAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFNwZWN1bGF0aXZlUmVhZFNjaGVk\ndWxpbmcoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGlkID0g\nZ2V0TGVkZ2VyVG9SZWFkKDMsMik7CiAgICAgICAgaW50IHRpbWVvdXQgPSAx\nMDAwOwogICAgICAgIEJvb2tLZWVwZXIgYmtzcGVjID0gY3JlYXRlQ2xpZW50\nKHRpbWVvdXQpOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbCA9IGJrc3BlYy5v\ncGVuTGVkZ2VyKGlkLCBkaWdlc3RUeXBlLCBwYXNzd2QpOwoKICAgICAgICBB\ncnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gZW5zZW1ibGUgPSBsLmdl\ndExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKTsKICAg\nICAgICBTZXQ8Qm9va2llU29ja2V0QWRkcmVzcz4gYWxsSG9zdHMgPSBuZXcg\nSGFzaFNldDxCb29raWVTb2NrZXRBZGRyZXNzPihlbnNlbWJsZSk7CiAgICAg\nICAgU2V0PEJvb2tpZVNvY2tldEFkZHJlc3M+IG5vSG9zdCA9IG5ldyBIYXNo\nU2V0PEJvb2tpZVNvY2tldEFkZHJlc3M+KCk7CiAgICAgICAgU2V0PEJvb2tp\nZVNvY2tldEFkZHJlc3M+IHNlY29uZEhvc3RPbmx5ID0gbmV3IEhhc2hTZXQ8\nQm9va2llU29ja2V0QWRkcmVzcz4oKTsKICAgICAgICBzZWNvbmRIb3N0T25s\neS5hZGQoZW5zZW1ibGUuZ2V0KDEpKTsKICAgICAgICBQZW5kaW5nUmVhZE9w\nLkxlZGdlckVudHJ5UmVxdWVzdCByZXEwID0gbnVsbCwgcmVxMiA9IG51bGws\nIHJlcTQgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExhdGNo\nQ2FsbGJhY2sgbGF0Y2gwID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAgICAg\nICAgICAgUGVuZGluZ1JlYWRPcCBvcCA9IG5ldyBQZW5kaW5nUmVhZE9wKGws\nIGJrc3BlYy5zY2hlZHVsZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAwLCA1LCBsYXRjaDAsIG51bGwpOwoK\nICAgICAgICAgICAgLy8gaWYgd2UndmUgYWxyZWFkeSBoZWFyZCBmcm9tIGFs\nbCBob3N0cywKICAgICAgICAgICAgLy8gd2Ugb25seSBzZW5kIHRoZSBpbml0\naWFsIHJlYWQKICAgICAgICAgICAgcmVxMCA9IG9wLm5ldyBMZWRnZXJFbnRy\neVJlcXVlc3QoZW5zZW1ibGUsIGwuZ2V0SWQoKSwgMCk7CiAgICAgICAgICAg\nIGFzc2VydFRydWUoIlNob3VsZCBoYXZlIHNlbnQgdG8gZmlyc3QiLAogICAg\nICAgICAgICAgICAgICAgICAgIHJlcTAubWF5YmVTZW5kU3BlY3VsYXRpdmVS\nZWFkKGFsbEhvc3RzKS5lcXVhbHMoZW5zZW1ibGUuZ2V0KDApKSk7CiAgICAg\nICAgICAgIGFzc2VydE51bGwoIlNob3VsZCBub3QgaGF2ZSBzZW50IGFub3Ro\nZXIiLAogICAgICAgICAgICAgICAgICAgICAgIHJlcTAubWF5YmVTZW5kU3Bl\nY3VsYXRpdmVSZWFkKGFsbEhvc3RzKSk7CgogICAgICAgICAgICAvLyBpZiB3\nZSBoYXZlIGhlYXJkIGZyb20gc29tZSBob3N0cywgYnV0IG5vdCBvbmUgd2Ug\naGF2ZSBzZW50IHRvCiAgICAgICAgICAgIC8vIHNlbmQgYWdhaW4KICAgICAg\nICAgICAgcmVxMiA9IG9wLm5ldyBMZWRnZXJFbnRyeVJlcXVlc3QoZW5zZW1i\nbGUsIGwuZ2V0SWQoKSwgMik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlNo\nb3VsZCBoYXZlIHNlbnQgdG8gdGhpcmQiLAogICAgICAgICAgICAgICAgICAg\nICAgIHJlcTIubWF5YmVTZW5kU3BlY3VsYXRpdmVSZWFkKG5vSG9zdCkuZXF1\nYWxzKGVuc2VtYmxlLmdldCgyKSkpOwogICAgICAgICAgICBhc3NlcnRUcnVl\nKCJTaG91bGQgaGF2ZSBzZW50IHRvIGZpcnN0IiwKICAgICAgICAgICAgICAg\nICAgICAgICByZXEyLm1heWJlU2VuZFNwZWN1bGF0aXZlUmVhZChzZWNvbmRI\nb3N0T25seSkuZXF1YWxzKGVuc2VtYmxlLmdldCgwKSkpOwoKICAgICAgICAg\nICAgLy8gaWYgd2UgaGF2ZSBoZWFyZCBmcm9tIHNvbWUgaG9zdHMsIHdoaWNo\nIGluY2x1ZGVzIG9uZSB3ZSBzZW50IHRvCiAgICAgICAgICAgIC8vIGRvIG5v\ndCByZWFkIGFnYWluCiAgICAgICAgICAgIHJlcTQgPSBvcC5uZXcgTGVkZ2Vy\nRW50cnlSZXF1ZXN0KGVuc2VtYmxlLCBsLmdldElkKCksIDQpOwogICAgICAg\nICAgICBhc3NlcnRUcnVlKCJTaG91bGQgaGF2ZSBzZW50IHRvIHNlY29uZCIs\nCiAgICAgICAgICAgICAgICAgICAgICAgcmVxNC5tYXliZVNlbmRTcGVjdWxh\ndGl2ZVJlYWQobm9Ib3N0KS5lcXVhbHMoZW5zZW1ibGUuZ2V0KDEpKSk7CiAg\nICAgICAgICAgIGFzc2VydE51bGwoIlNob3VsZCBub3QgaGF2ZSBzZW50IGFu\nb3RoZXIiLAogICAgICAgICAgICAgICAgICAgICAgIHJlcTQubWF5YmVTZW5k\nU3BlY3VsYXRpdmVSZWFkKHNlY29uZEhvc3RPbmx5KSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgZm9yIChQZW5kaW5nUmVhZE9wLkxlZGdl\nckVudHJ5UmVxdWVzdCByZXEKICAgICAgICAgICAgICAgICAgICAgOiBuZXcg\nUGVuZGluZ1JlYWRPcC5MZWRnZXJFbnRyeVJlcXVlc3RbXSB7IHJlcTAsIHJl\ncTIsIHJlcTQgfSkgewogICAgICAgICAgICAgICAgaWYgKHJlcSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAg\nICAgICAgICAgIHdoaWxlICghcmVxLmlzQ29tcGxldGUoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoaSsrID4gMTApIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOyAvLyB3YWl0IGZvciB1cCB0byAxMCBz\nZWNvbmRzCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJSZXF1\nZXN0IHNob3VsZCBiZSBkb25lIiwgcmVxMC5pc0NvbXBsZXRlKCkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsLmNs\nb3NlKCk7CiAgICAgICAgICAgIGJrc3BlYy5jbG9zZSgpOwogICAgICAgIH0K\nICAgIH0KfQo=\n","encoding":"base64"}

