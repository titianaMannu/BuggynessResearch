{"sha":"ac0afb6e075b803ef21ee97f65302a8c27ae8ade","node_id":"MDQ6QmxvYjE1NzU5NTY6YWMwYWZiNmUwNzViODAzZWYyMWVlOTdmNjUzMDJhOGMyN2FlOGFkZQ==","size":7769,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ac0afb6e075b803ef21ee97f65302a8c27ae8ade","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFj\naGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1\naXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGlu\nZywgc29mdHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2Ug\naXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9V\nVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhl\nciBleHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBh\nbmQKICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNr\nYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5\ncGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnRl\nc3QuQm9va0tlZXBlckNsdXN0ZXJUZXN0Q2FzZTsKaW1wb3J0IG9yZy5qdW5p\ndC5UZXN0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJl\nbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IHN0YXRpYyBvcmcuanVu\naXQuQXNzZXJ0Lio7CgpwdWJsaWMgY2xhc3MgVGVzdFRyeVJlYWRMYXN0Q29u\nZmlybWVkIGV4dGVuZHMgQm9va0tlZXBlckNsdXN0ZXJUZXN0Q2FzZSB7Cgog\nICAgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5\nLmdldExvZ2dlcihUZXN0VHJ5UmVhZExhc3RDb25maXJtZWQuY2xhc3MpOwoK\nICAgIGZpbmFsIERpZ2VzdFR5cGUgZGlnZXN0VHlwZTsKCiAgICBwdWJsaWMg\nVGVzdFRyeVJlYWRMYXN0Q29uZmlybWVkKCkgewogICAgICAgIHN1cGVyKDYp\nOwogICAgICAgIHRoaXMuZGlnZXN0VHlwZSA9IERpZ2VzdFR5cGUuQ1JDMzI7\nCiAgICB9CgogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdFRyeVJlYWRMQUNXaGVuQWxsQm9va2llc1VwKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgaW50IG51bUVudHJpZXMgPSAz\nOwoKICAgICAgICBmaW5hbCBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRl\nTGVkZ2VyKDMsIDMsIDEsIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwog\nICAgICAgIExlZGdlckhhbmRsZSByZWFkTGggPSBia2Mub3BlbkxlZGdlck5v\nUmVjb3ZlcnkobGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMo\nKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKExlZGdlckhhbmRsZS5JTlZBTElE\nX0VOVFJZX0lELCByZWFkTGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAg\nICAgICAvLyBhZGQgZW50cmllcwogICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5\nKCgiZGF0YSIgKyBpKS5nZXRCeXRlcygpKTsKICAgICAgICB9CiAgICAgICAg\nZmluYWwgQXRvbWljQm9vbGVhbiBzdWNjZXNzID0gbmV3IEF0b21pY0Jvb2xl\nYW4oZmFsc2UpOwogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgbnVtQ2Fs\nbGJhY2tzID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggbGF0Y2gxID0gbmV3IENvdW50RG93bkxhdGNoKDEp\nOwogICAgICAgIHJlYWRMaC5hc3luY1RyeVJlYWRMYXN0Q29uZmlybWVkKG5l\ndyBBc3luY0NhbGxiYWNrLlJlYWRMYXN0Q29uZmlybWVkQ2FsbGJhY2soKSB7\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCByZWFkTGFzdENvbmZpcm1lZENvbXBsZXRlKGludCByYywgbG9uZyBsYXN0\nQ29uZmlybWVkLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICBudW1D\nYWxsYmFja3MuaW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAgICAgICAgICBp\nZiAoQktFeGNlcHRpb24uQ29kZS5PSyA9PSByYykgewogICAgICAgICAgICAg\nICAgICAgIHN1Y2Nlc3Muc2V0KHRydWUpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBzdWNjZXNzLnNldChmYWxzZSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsYXRjaDEuY291\nbnREb3duKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBudWxsKTsKICAg\nICAgICBsYXRjaDEuYXdhaXQoKTsKICAgICAgICBUaW1lVW5pdC5TRUNPTkRT\nLnNsZWVwKDIpOwogICAgICAgIGFzc2VydFRydWUoc3VjY2Vzcy5nZXQoKSk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZShudW1DYWxsYmFja3MuZ2V0KCkgPT0gMSk7\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKG51bUVudHJpZXMgLSAyLCByZWFkTGgu\nZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAgICAgICAvLyB0cnkgcmVhZCBs\nYXN0IGNvbmZpcm1lZCBhZ2FpbgogICAgICAgIHN1Y2Nlc3Muc2V0KGZhbHNl\nKTsKICAgICAgICBudW1DYWxsYmFja3Muc2V0KDApOwogICAgICAgIGZpbmFs\nIENvdW50RG93bkxhdGNoIGxhdGNoMiA9IG5ldyBDb3VudERvd25MYXRjaCgx\nKTsKICAgICAgICByZWFkTGguYXN5bmNUcnlSZWFkTGFzdENvbmZpcm1lZChu\nZXcgQXN5bmNDYWxsYmFjay5SZWFkTGFzdENvbmZpcm1lZENhbGxiYWNrKCkg\newogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZv\naWQgcmVhZExhc3RDb25maXJtZWRDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGFz\ndENvbmZpcm1lZCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgbnVt\nQ2FsbGJhY2tzLmluY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAg\naWYgKEJLRXhjZXB0aW9uLkNvZGUuT0sgPT0gcmMgJiYgbGFzdENvbmZpcm1l\nZCA9PSAobnVtRW50cmllcyAtIDIpKSB7CiAgICAgICAgICAgICAgICAgICAg\nc3VjY2Vzcy5zZXQodHJ1ZSk7CiAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3Muc2V0KGZhbHNlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxhdGNoMi5jb3VudERvd24o\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIG51bGwpOwogICAgICAgIGxh\ndGNoMi5hd2FpdCgpOwogICAgICAgIFRpbWVVbml0LlNFQ09ORFMuc2xlZXAo\nMik7CiAgICAgICAgYXNzZXJ0VHJ1ZShzdWNjZXNzLmdldCgpKTsKICAgICAg\nICBhc3NlcnRUcnVlKG51bUNhbGxiYWNrcy5nZXQoKSA9PSAxKTsKICAgICAg\nICBhc3NlcnRFcXVhbHMobnVtRW50cmllcyAtIDIsIHJlYWRMaC5nZXRMYXN0\nQWRkQ29uZmlybWVkKCkpOwoKICAgICAgICBsaC5jbG9zZSgpOwogICAgICAg\nIHJlYWRMaC5jbG9zZSgpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQgPSA2\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RUcnlSZWFkTGFDV2hlblNvbWVC\nb29raWVzRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZpbmFs\nIGludCBudW1FbnRyaWVzID0gMzsKICAgICAgICBmaW5hbCBpbnQgZW5zZW1i\nbGVTaXplID0gMzsKICAgICAgICBmaW5hbCBMZWRnZXJIYW5kbGUgbGggPSBi\na2MuY3JlYXRlTGVkZ2VyKGVuc2VtYmxlU2l6ZSwgMSwgMSwgZGlnZXN0VHlw\nZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgTGVkZ2VySGFuZGxlIHJlYWRM\naCA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsaC5nZXRJZCgpLCBkaWdl\nc3RUeXBlLCAiIi5nZXRCeXRlcygpKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nTGVkZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQsIHJlYWRMaC5nZXRMYXN0\nQWRkQ29uZmlybWVkKCkpOwogICAgICAgIC8vIGFkZCBlbnRyaWVzCiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAg\nICAgICAgICAgbGguYWRkRW50cnkoKCJkYXRhIiArIGkpLmdldEJ5dGVzKCkp\nOwogICAgICAgIH0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVu\ndHJpZXM7IGkrKykgewogICAgICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9u\nW10gY29uZnMgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbltlbnNlbWJsZVNp\nemUgLSAxXTsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBlbnNl\nbWJsZVNpemUgLSAxOyBqKyspIHsKICAgICAgICAgICAgICAgIGludCBpZHgg\nPSAoaSArIDEgKyBqKSAlIGVuc2VtYmxlU2l6ZTsKICAgICAgICAgICAgICAg\nIGNvbmZzW2pdID0ga2lsbEJvb2tpZShsaC5nZXRMZWRnZXJNZXRhZGF0YSgp\nLmN1cnJlbnRFbnNlbWJsZS5nZXQoaWR4KSk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gc3VjY2VzcyA9IG5ldyBB\ndG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICAgICAgZmluYWwgQXRvbWlj\nSW50ZWdlciBudW1DYWxsYmFja3MgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsK\nICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggbGF0Y2ggPSBuZXcg\nQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgICAgIGZpbmFsIGludCBlbnRy\neUlkID0gaTsKICAgICAgICAgICAgcmVhZExoLmFzeW5jVHJ5UmVhZExhc3RD\nb25maXJtZWQobmV3IEFzeW5jQ2FsbGJhY2suUmVhZExhc3RDb25maXJtZWRD\nYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJtZWRDb21wbGV0\nZShpbnQgcmMsIGxvbmcgbGFzdENvbmZpcm1lZCwgT2JqZWN0IGN0eCkgewog\nICAgICAgICAgICAgICAgICAgIG51bUNhbGxiYWNrcy5pbmNyZW1lbnRBbmRH\nZXQoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoQktFeGNlcHRpb24uQ29k\nZS5PSyA9PSByYykgewogICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNz\nLnNldChsYXN0Q29uZmlybWVkID09IChlbnRyeUlkIC0gMSkpOwogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHN1Y2Nlc3Muc2V0KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAgICBs\nYXRjaC5hd2FpdCgpOwogICAgICAgICAgICBhc3NlcnRUcnVlKHN1Y2Nlc3Mu\nZ2V0KCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKG51bUNhbGxiYWNrcy5n\nZXQoKSA9PSAxKTsKCiAgICAgICAgICAgIC8vIHN0YXJ0IHRoZSBib29raWVz\nCiAgICAgICAgICAgIGZvciAoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mIDog\nY29uZnMpIHsKICAgICAgICAgICAgICAgIGJzLmFkZChzdGFydEJvb2tpZShj\nb25mKSk7CiAgICAgICAgICAgICAgICBic0NvbmZzLmFkZChjb25mKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsaC5jbG9zZSgpOwogICAg\nICAgIHJlYWRMaC5jbG9zZSgpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQg\nPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RUcnlSZWFkTEFDV2hlbkFs\nbEJvb2tpZXNEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgZmlu\nYWwgaW50IG51bUVudHJpZXMgPSAyOwogICAgICAgIGZpbmFsIGludCBlbnNl\nbWJsZVNpemUgPSAzOwogICAgICAgIGZpbmFsIExlZGdlckhhbmRsZSBsaCA9\nIGJrYy5jcmVhdGVMZWRnZXIoZW5zZW1ibGVTaXplLCAxLCAxLCBkaWdlc3RU\neXBlLCAiIi5nZXRCeXRlcygpKTsKICAgICAgICBMZWRnZXJIYW5kbGUgcmVh\nZExoID0gYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxoLmdldElkKCksIGRp\nZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwogICAgICAgIGFzc2VydEVxdWFs\ncyhMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9JRCwgcmVhZExoLmdldExh\nc3RBZGRDb25maXJtZWQoKSk7CiAgICAgICAgLy8gYWRkIGVudHJpZXMKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJpZXM7IGkrKykgewog\nICAgICAgICAgICBsaC5hZGRFbnRyeSgoImRhdGEiICsgaSkuZ2V0Qnl0ZXMo\nKSk7CiAgICAgICAgfQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZW5z\nZW1ibGVTaXplOyBpKyspIHsKICAgICAgICAgICAga2lsbEJvb2tpZShsaC5n\nZXRMZWRnZXJNZXRhZGF0YSgpLmN1cnJlbnRFbnNlbWJsZS5nZXQoaSkpOwog\nICAgICAgIH0KICAgICAgICBmaW5hbCBBdG9taWNCb29sZWFuIHN1Y2Nlc3Mg\nPSBuZXcgQXRvbWljQm9vbGVhbihmYWxzZSk7CiAgICAgICAgZmluYWwgQXRv\nbWljSW50ZWdlciBudW1DYWxsYmFja3MgPSBuZXcgQXRvbWljSW50ZWdlcigw\nKTsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBD\nb3VudERvd25MYXRjaCgxKTsKICAgICAgICByZWFkTGguYXN5bmNUcnlSZWFk\nTGFzdENvbmZpcm1lZChuZXcgQXN5bmNDYWxsYmFjay5SZWFkTGFzdENvbmZp\ncm1lZENhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJtZWRDb21wbGV0ZShp\nbnQgcmMsIGxvbmcgbGFzdENvbmZpcm1lZCwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlJlYWRMYXN0Q29uZmlybWVkQ29t\ncGxldGUgOiByYyA9IHt9LCBsYWMgPSB7fS4iLCByYywgbGFzdENvbmZpcm1l\nZCk7CiAgICAgICAgICAgICAgICBudW1DYWxsYmFja3MuaW5jcmVtZW50QW5k\nR2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoQktFeGNlcHRpb24uQ29kZS5P\nSyA9PSByYykgewogICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3Muc2V0KGxh\nc3RDb25maXJtZWQgPT0gTGVkZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQp\nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAg\nICBzdWNjZXNzLnNldChmYWxzZSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0sIG51bGwpOwogICAgICAgIGxhdGNoLmF3YWl0KCk7CiAgICAg\nICAgVGltZVVuaXQuU0VDT05EUy5zbGVlcCgyKTsKICAgICAgICBhc3NlcnRG\nYWxzZShzdWNjZXNzLmdldCgpKTsKICAgICAgICBhc3NlcnRUcnVlKG51bUNh\nbGxiYWNrcy5nZXQoKSA9PSAxKTsKCiAgICAgICAgbGguY2xvc2UoKTsKICAg\nICAgICByZWFkTGguY2xvc2UoKTsKICAgIH0KfQo=\n","encoding":"base64"}

