{"sha":"8b52bf5c18135ddb516e0837c39835f5e09b8fc5","node_id":"MDQ6QmxvYjE1NzU5NTY6OGI1MmJmNWMxODEzNWRkYjUxNmUwODM3YzM5ODM1ZjVlMDliOGZjNQ==","size":23160,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8b52bf5c18135ddb516e0837c39835f5e09b8fc5","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlOwoKaW1wb3J0\nIHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLk1ldGFz\ndG9yZVNjYW5uYWJsZVRhYmxlLkVNUFRZX0VORF9LRVk7CmltcG9ydCBzdGF0\naWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVT\nY2FubmFibGVUYWJsZS5FTVBUWV9TVEFSVF9LRVk7CmltcG9ydCBzdGF0aWMg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVUYWJs\nZS5BTExfRklFTERTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlVGFibGUuTk9OX0ZJRUxEUzsKCmlt\ncG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkhhc2hT\nZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRp\nbC5UcmVlTWFwOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRh\nc3RvcmUuSW5NZW1vcnlNZXRhc3RvcmVUYWJsZS5NZXRhZGF0YVZlcnNpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLk1TRXhj\nZXB0aW9uLkNvZGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0\nYXN0b3JlLk1ldGFzdG9yZVNjYW5uYWJsZVRhYmxlLk9yZGVyOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb25l\nZDsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb25maWd1cmF0aW9uLkNv\nbXBvc2l0ZUNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMuY29uZmlndXJhdGlvbi5Db25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmp1\nbml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9y\nZy5qdW5pdC5UZXN0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29nbGUu\nY29tbW9uLmNvbGxlY3QuTWFwRGlmZmVyZW5jZTsKaW1wb3J0IGNvbS5nb29n\nbGUuY29tbW9uLmNvbGxlY3QuTWFwczsKaW1wb3J0IGNvbS5nb29nbGUuY29t\nbW9uLmNvbGxlY3QuU2V0czsKCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFz\nc2VydC4qOwoKcHVibGljIGNsYXNzIFRlc3RNZXRhU3RvcmUgewogICAgcHJp\ndmF0ZSBmaW5hbCBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3Rv\ncnkuZ2V0TG9nZ2VyKFRlc3RNZXRhU3RvcmUuY2xhc3MpOwoKICAgIHByb3Rl\nY3RlZCBmaW5hbCBzdGF0aWMgU3RyaW5nIFRBQkxFID0gIm15VGFibGUiOwog\nICAgcHJvdGVjdGVkIGZpbmFsIHN0YXRpYyBTdHJpbmcgUkVDT1JESUQgPSAi\ndGVzdCI7CiAgICBwcm90ZWN0ZWQgZmluYWwgc3RhdGljIFN0cmluZyBGSUVM\nRF9OQU1FID0gIm5hbWUiOwogICAgcHJvdGVjdGVkIGZpbmFsIHN0YXRpYyBT\ndHJpbmcgRklFTERfQ09VTlRFUiA9ICJjb3VudGVyIjsKCiAgICBwcm90ZWN0\nZWQgU3RyaW5nIGdldEZpZWxkRnJvbVZhbHVlKFZhbHVlIHZhbHVlLCBTdHJp\nbmcgZmllbGQpIHsKICAgICAgICBieXRlW10gdiA9IHZhbHVlLmdldEZpZWxk\nKGZpZWxkKTsKICAgICAgICByZXR1cm4gdiA9PSBudWxsID8gbnVsbCA6IG5l\ndyBTdHJpbmcodik7CiAgICB9CgogICAgcHJvdGVjdGVkIHN0YXRpYyBWYWx1\nZSBtYWtlVmFsdWUoU3RyaW5nIG5hbWUsIEludGVnZXIgY291bnRlcikgewog\nICAgICAgIFZhbHVlIGRhdGEgPSBuZXcgVmFsdWUoKTsKCiAgICAgICAgaWYg\nKG5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICBkYXRhLnNldEZpZWxkKEZJ\nRUxEX05BTUUsIG5hbWUuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAg\nICBpZiAoY291bnRlciAhPSBudWxsKSB7CiAgICAgICAgICAgIGRhdGEuc2V0\nRmllbGQoRklFTERfQ09VTlRFUiwgY291bnRlci50b1N0cmluZygpLmdldEJ5\ndGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGRhdGE7CiAgICB9\nCgogICAgcHJvdGVjdGVkIGNsYXNzIFJlY29yZCB7CiAgICAgICAgU3RyaW5n\nIG5hbWU7CiAgICAgICAgSW50ZWdlciBjb3VudGVyOwogICAgICAgIFZlcnNp\nb24gdmVyc2lvbjsKCiAgICAgICAgcHVibGljIFJlY29yZCgpIHsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBSZWNvcmQoU3RyaW5nIG5hbWUsIEludGVn\nZXIgY291bnRlciwgVmVyc2lvbiB2ZXJzaW9uKSB7CiAgICAgICAgICAgIHRo\naXMubmFtZSA9IG5hbWU7CiAgICAgICAgICAgIHRoaXMuY291bnRlciA9IGNv\ndW50ZXI7CiAgICAgICAgICAgIHRoaXMudmVyc2lvbiA9IHZlcnNpb247CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgUmVjb3JkKFZlcnNpb25lZDxWYWx1\nZT4gdnYpIHsKICAgICAgICAgICAgdmVyc2lvbiA9IHZ2LmdldFZlcnNpb24o\nKTsKCiAgICAgICAgICAgIFZhbHVlIHZhbHVlID0gdnYuZ2V0VmFsdWUoKTsK\nICAgICAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbmFtZSA9\nIGdldEZpZWxkRnJvbVZhbHVlKHZhbHVlLCBGSUVMRF9OQU1FKTsKICAgICAg\nICAgICAgU3RyaW5nIGMgPSBnZXRGaWVsZEZyb21WYWx1ZSh2YWx1ZSwgRklF\nTERfQ09VTlRFUik7CiAgICAgICAgICAgIGlmIChjICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIGNvdW50ZXIgPSBuZXcgSW50ZWdlcihjKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIFZlcnNpb24gZ2V0\nVmVyc2lvbigpIHsKICAgICAgICAgICAgcmV0dXJuIHZlcnNpb247CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgVmFsdWUgZ2V0VmFsdWUoKSB7CiAgICAg\nICAgICAgIHJldHVybiBUZXN0TWV0YVN0b3JlLm1ha2VWYWx1ZShuYW1lLCBj\nb3VudGVyKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBWZXJzaW9uZWQ8\nVmFsdWU+IGdldFZlcnNpb25lZFZhbHVlKCkgewogICAgICAgICAgICByZXR1\ncm4gbmV3IFZlcnNpb25lZDxWYWx1ZT4oZ2V0VmFsdWUoKSwgdmVyc2lvbik7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBtZXJnZShTdHJpbmcg\nbmFtZSwgSW50ZWdlciBjb3VudGVyLCBWZXJzaW9uIHZlcnNpb24pIHsKICAg\nICAgICAgICAgaWYgKG5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\ndGhpcy5uYW1lID0gbmFtZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAoY291bnRlciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNv\ndW50ZXIgPSBjb3VudGVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlm\nICh2ZXJzaW9uICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRoaXMudmVy\nc2lvbiA9IHZlcnNpb247CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyB2b2lkIG1lcmdlKFJlY29yZCByZWNvcmQpIHsKICAgICAg\nICAgICAgbWVyZ2UocmVjb3JkLm5hbWUsIHJlY29yZC5jb3VudGVyLCByZWNv\ncmQudmVyc2lvbik7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBj\naGVja0VxdWFsKFZlcnNpb25lZDxWYWx1ZT4gdnYpIHsKICAgICAgICAgICAg\nVmVyc2lvbiB2ID0gdnYuZ2V0VmVyc2lvbigpOwogICAgICAgICAgICBWYWx1\nZSB2YWx1ZSA9IHZ2LmdldFZhbHVlKCk7CgogICAgICAgICAgICBhc3NlcnRF\ncXVhbHMobmFtZSwgZ2V0RmllbGRGcm9tVmFsdWUodmFsdWUsIEZJRUxEX05B\nTUUpKTsKCiAgICAgICAgICAgIFN0cmluZyBjID0gZ2V0RmllbGRGcm9tVmFs\ndWUodmFsdWUsIEZJRUxEX0NPVU5URVIpOwogICAgICAgICAgICBpZiAoY291\nbnRlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBhc3NlcnROdWxsKGMp\nOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKGNvdW50ZXIudG9TdHJpbmcoKSwgYyk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGFzc2VydFRydWUoaXNFcXVhbFZlcnNpb24odmVyc2lv\nbiwgdikpOwogICAgICAgIH0KCiAgICB9CgogICAgcHJvdGVjdGVkIE1ldGFT\ndG9yZSBtZXRhc3RvcmU7CiAgICBwcm90ZWN0ZWQgTWV0YXN0b3JlU2Nhbm5h\nYmxlVGFibGUgbXlBY3R1YWxUYWJsZTsKICAgIHByb3RlY3RlZCBNZXRhc3Rv\ncmVTY2FubmFibGVUYWJsZUFzeW5jVG9TeW5jQ29udmVydGVyIG15VGFibGU7\nCgogICAgcHJvdGVjdGVkIFN0cmluZyBnZXRNZXRhU3RvcmVOYW1lKCkgewog\nICAgICAgIHJldHVybiBJbk1lbW9yeU1ldGFTdG9yZS5jbGFzcy5nZXROYW1l\nKCk7CiAgICB9CgogICAgcHJvdGVjdGVkIENvbmZpZ3VyYXRpb24gZ2V0Q29u\nZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IENvbXBvc2l0ZUNv\nbmZpZ3VyYXRpb24oKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgVmVyc2lvbiBu\nZXdCYWRWZXJzaW9uKCkgewogICAgICAgIHJldHVybiBuZXcgTWV0YWRhdGFW\nZXJzaW9uKC0xKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgVmVyc2lvbiBuZXh0\nVmVyc2lvbihWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICBpZiAoVmVyc2lv\nbi5ORVcgPT0gdmVyc2lvbikgewogICAgICAgICAgICByZXR1cm4gbmV3IE1l\ndGFkYXRhVmVyc2lvbigwKTsKICAgICAgICB9CiAgICAgICAgaWYgKFZlcnNp\nb24uQU5ZID09IHZlcnNpb24pIHsKICAgICAgICAgICAgcmV0dXJuIFZlcnNp\nb24uQU5ZOwogICAgICAgIH0KICAgICAgICBhc3NlcnRUcnVlKHZlcnNpb24g\naW5zdGFuY2VvZiBNZXRhZGF0YVZlcnNpb24pOwogICAgICAgIHJldHVybiBu\nZXcgTWV0YWRhdGFWZXJzaW9uKCgoTWV0YWRhdGFWZXJzaW9uKSB2ZXJzaW9u\nKS5pbmNyZW1lbnRWZXJzaW9uKCkpOwogICAgfQoKICAgIHByaXZhdGUgdm9p\nZCBjaGVja1ZlcnNpb24oVmVyc2lvbiB2KSB7CiAgICAgICAgYXNzZXJ0Tm90\nTnVsbCh2KTsKICAgICAgICBpZiAodiAhPSBWZXJzaW9uLk5FVyAmJiB2ICE9\nIFZlcnNpb24uQU5ZKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUodiBpbnN0\nYW5jZW9mIE1ldGFkYXRhVmVyc2lvbik7CiAgICAgICAgfQogICAgfQoKICAg\nIHByb3RlY3RlZCBib29sZWFuIGlzRXF1YWxWZXJzaW9uKFZlcnNpb24gdjEs\nIFZlcnNpb24gdjIpIHsKICAgICAgICBjaGVja1ZlcnNpb24odjEpOwogICAg\nICAgIGNoZWNrVmVyc2lvbih2Mik7CiAgICAgICAgcmV0dXJuIHYxLmNvbXBh\ncmUodjIpID09IFZlcnNpb24uT2NjdXJyZWQuQ09OQ1VSUkVOVExZOwogICAg\nfQoKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgbWV0YXN0b3JlID0gTWV0YXN0b3JlRmFj\ndG9yeS5jcmVhdGVNZXRhU3RvcmUoZ2V0TWV0YVN0b3JlTmFtZSgpKTsKICAg\nICAgICBDb25maWd1cmF0aW9uIGNvbmZpZyA9IGdldENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICBtZXRhc3RvcmUuaW5pdChjb25maWcsIG1ldGFzdG9yZS5n\nZXRWZXJzaW9uKCkpOwoKICAgICAgICBteUFjdHVhbFRhYmxlID0gbWV0YXN0\nb3JlLmNyZWF0ZVNjYW5uYWJsZVRhYmxlKFRBQkxFKTsKICAgICAgICBteVRh\nYmxlID0gbmV3IE1ldGFzdG9yZVNjYW5uYWJsZVRhYmxlQXN5bmNUb1N5bmND\nb252ZXJ0ZXIobXlBY3R1YWxUYWJsZSk7CgogICAgICAgIC8vIHNldHVwIGEg\nY2xlYW4gZW52aXJvbm1lbnQKICAgICAgICBjbGVhclRhYmxlKCk7CiAgICB9\nCgogICAgQEFmdGVyCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIC8vIGFsc28gY2xlYXIgdGFibGUgYWZ0\nZXIgdGVzdAogICAgICAgIGNsZWFyVGFibGUoKTsKCiAgICAgICAgbXlBY3R1\nYWxUYWJsZS5jbG9zZSgpOwogICAgICAgIG1ldGFzdG9yZS5jbG9zZSgpOwog\nICAgfQoKICAgIHZvaWQgY2hlY2tFeHBlY3RlZFZhbHVlKFZlcnNpb25lZDxW\nYWx1ZT4gdnYsIFN0cmluZyBleHBlY3RlZE5hbWUsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBJbnRlZ2VyIGV4cGVjdGVkQ291bnRlciwgVmVyc2lv\nbiBleHBlY3RlZFZlcnNpb24pIHsKICAgICAgICBSZWNvcmQgZXhwZWN0ZWQg\nPSBuZXcgUmVjb3JkKGV4cGVjdGVkTmFtZSwgZXhwZWN0ZWRDb3VudGVyLCBl\neHBlY3RlZFZlcnNpb24pOwogICAgICAgIGV4cGVjdGVkLmNoZWNrRXF1YWwo\ndnYpOwogICAgfQoKICAgIHByb3RlY3RlZCBJbnRlZ2VyIGdldFJhbmRvbSgp\nIHsKICAgICAgICByZXR1cm4gKGludCkoTWF0aC5yYW5kb20oKSo2NTUzNik7\nCiAgICB9CgogICAgcHJvdGVjdGVkIFZlcnNpb25lZDxWYWx1ZT4gZ2V0UmVj\nb3JkKFN0cmluZyByZWNvcmRJZCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgcmV0dXJuIG15VGFibGUuZ2V0KHJlY29y\nZElkKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5Ob0tleUV4Y2Vw\ndGlvbiBua2UpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogZ2V0IHJlY29yZCB3aXRoIHNwZWNp\nZmljIGZpZWxkcywgYXNzdW1lIHJlY29yZCBFWElTVCEKICAgICAqLwogICAg\ncHJvdGVjdGVkIFZlcnNpb25lZDxWYWx1ZT4gZ2V0RXhpc3RSZWNvcmRGaWVs\nZHMoU3RyaW5nIHJlY29yZElkLCBTZXQ8U3RyaW5nPiBmaWVsZHMpCiAgICB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBWZXJzaW9uZWQ8VmFsdWU+IHJl\ndFZhbHVlID0gbXlUYWJsZS5nZXQocmVjb3JkSWQsIGZpZWxkcyk7CiAgICAg\nICAgcmV0dXJuIHJldFZhbHVlOwogICAgfQoKICAgIC8qKgogICAgICogcHV0\nIGFuZCBjaGVjayBmaWVsZHMKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\ncHV0QW5kQ2hlY2soU3RyaW5nIHJlY29yZElkLCBTdHJpbmcgbmFtZSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbnRlZ2VyIGNv\ndW50ZXIsIFZlcnNpb24gdmVyc2lvbiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBSZWNvcmQgZXhwZWN0ZWQsIENvZGUgZXhwZWN0\nZWRDb2RlKQogICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgVmVyc2lv\nbiByZXRWZXJzaW9uID0gbnVsbDsKICAgICAgICBDb2RlIGNvZGUgPSBDb2Rl\nLk9wZXJhdGlvbkZhaWx1cmU7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ncmV0VmVyc2lvbiA9IG15VGFibGUucHV0KHJlY29yZElkLCBtYWtlVmFsdWUo\nbmFtZSwgY291bnRlciksIHZlcnNpb24pOwogICAgICAgICAgICBjb2RlID0g\nQ29kZS5PSzsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5CYWRWZXJz\naW9uRXhjZXB0aW9uIGJ2ZSkgewogICAgICAgICAgICBjb2RlID0gQ29kZS5C\nYWRWZXJzaW9uOwogICAgICAgIH0gY2F0Y2ggKE1TRXhjZXB0aW9uLk5vS2V5\nRXhjZXB0aW9uIG5rZSkgewogICAgICAgICAgICBjb2RlID0gQ29kZS5Ob0tl\neTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5LZXlFeGlzdHNFeGNl\ncHRpb24ga2VlKSB7CiAgICAgICAgICAgIGNvZGUgPSBDb2RlLktleUV4aXN0\nczsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKGV4cGVjdGVkQ29k\nZSwgY29kZSk7CgogICAgICAgIC8vIGdldCBhbmQgY2hlY2sgYWxsIGZpZWxk\ncyBvZiByZWNvcmQKICAgICAgICBpZiAoQ29kZS5PSyA9PSBjb2RlKSB7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoaXNFcXVhbFZlcnNpb24ocmV0VmVyc2lv\nbiwgbmV4dFZlcnNpb24odmVyc2lvbikpKTsKICAgICAgICAgICAgZXhwZWN0\nZWQubWVyZ2UobmFtZSwgY291bnRlciwgcmV0VmVyc2lvbik7CiAgICAgICAg\nfQoKICAgICAgICBWZXJzaW9uZWQ8VmFsdWU+IGV4aXN0ZWRWViA9IGdldFJl\nY29yZChyZWNvcmRJZCk7CiAgICAgICAgaWYgKG51bGwgPT0gZXhwZWN0ZWQp\nIHsKICAgICAgICAgICAgYXNzZXJ0TnVsbChleGlzdGVkVlYpOwogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIGV4cGVjdGVkLmNoZWNrRXF1YWwoZXhp\nc3RlZFZWKTsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQg\nY2xlYXJUYWJsZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIE1ldGFz\ndG9yZUN1cnNvciBjdXJzb3IgPSBteVRhYmxlLm9wZW5DdXJzb3IoKTsKICAg\nICAgICBpZiAoIWN1cnNvci5oYXNNb3JlRW50cmllcygpKSB7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgd2hpbGUgKGN1cnNvci5o\nYXNNb3JlRW50cmllcygpKSB7CiAgICAgICAgICAgIEl0ZXJhdG9yPE1ldGFz\ndG9yZVRhYmxlSXRlbT4gaXRlciA9IGN1cnNvci5yZWFkRW50cmllcyg5OSk7\nCiAgICAgICAgICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkgewogICAgICAg\nICAgICAgICAgTWV0YXN0b3JlVGFibGVJdGVtIGl0ZW0gPSBpdGVyLm5leHQo\nKTsKICAgICAgICAgICAgICAgIFN0cmluZyBrZXkgPSBpdGVtLmdldEtleSgp\nOwogICAgICAgICAgICAgICAgbXlUYWJsZS5yZW1vdmUoa2V5LCBWZXJzaW9u\nLkFOWSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3Vyc29y\nLmNsb3NlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IChnZXQsIGdl\ndCBwYXJ0aWFsIGZpZWxkLCByZW1vdmUpIG9uIG5vbi1leGlzdGVudCBlbGVt\nZW50LgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdE5vbkV4aXN0ZW50KCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gZ2V0CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbXlU\nYWJsZS5nZXQoUkVDT1JESUQpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQg\nZmFpbCB0byBnZXQgYSBub24tZXhpc3RlbnQga2V5Iik7CiAgICAgICAgfSBj\nYXRjaCAoTVNFeGNlcHRpb24uTm9LZXlFeGNlcHRpb24gbmtlKSB7CiAgICAg\nICAgfQoKICAgICAgICAvLyBnZXQgcGFydGlhbCBmaWVsZAogICAgICAgIFNl\ndDxTdHJpbmc+IGZpZWxkcyA9CiAgICAgICAgICAgIG5ldyBIYXNoU2V0PFN0\ncmluZz4oQXJyYXlzLmFzTGlzdChuZXcgU3RyaW5nW10geyBGSUVMRF9DT1VO\nVEVSIH0pKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBteVRhYmxlLmdl\ndChSRUNPUkRJRCwgZmllbGRzKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxk\nIGZhaWwgdG8gZ2V0IGEgbm9uLWV4aXN0ZW50IGtleSB3aXRoIHNwZWNpZmll\nZCBmaWVsZHMiKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5Ob0tl\neUV4Y2VwdGlvbiBua2UpIHsKICAgICAgICB9CgogICAgICAgIC8vIHJlbW92\nZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG15VGFibGUucmVtb3ZlKFJF\nQ09SRElELCBWZXJzaW9uLkFOWSk7CiAgICAgICAgICAgIGZhaWwoIlNob3Vs\nZCBmYWlsIHRvIGRlbGV0ZSBhIG5vbi1leGlzdGVudCBrZXkiKTsKICAgICAg\nICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5Ob0tleUV4Y2VwdGlvbiBua2UpIHsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHVzYWdlIG9m\nIGdldCBvcGVyYXRpb24gb24gKGZ1bGwgYW5kIHBhcnRpYWwpIGZpZWxkcy4K\nICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RHZXQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBWZXJz\naW9uZWQ8VmFsdWU+IHZ2OwoKICAgICAgICBmaW5hbCBTZXQ8U3RyaW5nPiBm\naWVsZHMgPQogICAgICAgICAgICBuZXcgSGFzaFNldDxTdHJpbmc+KEFycmF5\ncy5hc0xpc3QobmV3IFN0cmluZ1tdIHsgRklFTERfTkFNRSB9KSk7CgogICAg\nICAgIGZpbmFsIFN0cmluZyBuYW1lID0gImdldCI7CiAgICAgICAgZmluYWwg\nSW50ZWdlciBjb3VudGVyID0gZ2V0UmFuZG9tKCk7CgogICAgICAgIC8vIHB1\ndCB0ZXN0IGl0ZW0KICAgICAgICBWZXJzaW9uIHZlcnNpb24gPSBteVRhYmxl\nLnB1dChSRUNPUkRJRCwgbWFrZVZhbHVlKG5hbWUsIGNvdW50ZXIpLCBWZXJz\naW9uLk5FVyk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbCh2ZXJzaW9uKTsKCiAg\nICAgICAgLy8gZmV0Y2ggd2l0aCBhbGwgZmllbGRzCiAgICAgICAgdnYgPSBn\nZXRFeGlzdFJlY29yZEZpZWxkcyhSRUNPUkRJRCwgQUxMX0ZJRUxEUyk7CiAg\nICAgICAgY2hlY2tFeHBlY3RlZFZhbHVlKHZ2LCBuYW1lLCBjb3VudGVyLCB2\nZXJzaW9uKTsKCiAgICAgICAgLy8gcGFydGlhbCBnZXQgbmFtZQogICAgICAg\nIHZ2ID0gZ2V0RXhpc3RSZWNvcmRGaWVsZHMoUkVDT1JESUQsIGZpZWxkcyk7\nCiAgICAgICAgY2hlY2tFeHBlY3RlZFZhbHVlKHZ2LCBuYW1lLCBudWxsLCB2\nZXJzaW9uKTsKCiAgICAgICAgLy8gbm9uIGZpZWxkcwogICAgICAgIHZ2ID0g\nZ2V0RXhpc3RSZWNvcmRGaWVsZHMoUkVDT1JESUQsIE5PTl9GSUVMRFMpOwog\nICAgICAgIGNoZWNrRXhwZWN0ZWRWYWx1ZSh2diwgbnVsbCwgbnVsbCwgdmVy\nc2lvbik7CgogICAgICAgIC8vIGdldCBudWxsIGtleSBzaG91bGQgZmFpbAog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIGdldEV4aXN0UmVjb3JkRmllbGRz\nKG51bGwsIE5PTl9GSUVMRFMpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQg\nZmFpbCB0byBnZXQgbnVsbCBrZXkgd2l0aCBOT04gZmllbGRzIik7CiAgICAg\nICAgfSBjYXRjaCAoTVNFeGNlcHRpb24uSWxsZWdhbE9wRXhjZXB0aW9uIGlv\nZSkgewogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBnZXRF\neGlzdFJlY29yZEZpZWxkcyhudWxsLCBBTExfRklFTERTKTsKICAgICAgICAg\nICAgZmFpbCgiU2hvdWxkIGZhaWwgdG8gZ2V0IG51bGwga2V5IHdpdGggQUxM\nIGZpZWxkcy4iKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5JbGxl\nZ2FsT3BFeGNlcHRpb24gaW9lKSB7CiAgICAgICAgfQogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGdldEV4aXN0UmVjb3JkRmllbGRzKG51bGwsIGZpZWxk\ncyk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBmYWlsIHRvIGdldCBudWxs\nIGtleSB3aXRoIGZpZWxkcyAiICsgZmllbGRzKTsKICAgICAgICB9IGNhdGNo\nIChNU0V4Y2VwdGlvbi5JbGxlZ2FsT3BFeGNlcHRpb24gaW9lKSB7CiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB1c2FnZSBvZiBwdXQg\nb3BlcmF0aW9uIHdpdGggKGZ1bGwgYW5kIHBhcnRpYWwpIGZpZWxkcy4KICAg\nICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RQdXQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBJ\nbnRlZ2VyIGNvdW50ZXIgPSBnZXRSYW5kb20oKTsKICAgICAgICBmaW5hbCBT\ndHJpbmcgbmFtZSA9ICJwdXQiOwoKICAgICAgICBWZXJzaW9uIHZlcnNpb247\nCgogICAgICAgIC8qKgogICAgICAgICAqIHRlc3QgY29ycmVjdCB2ZXJzaW9u\nIHB1dAogICAgICAgICAqLwogICAgICAgIC8vIHB1dCB0ZXN0IGl0ZW0KICAg\nICAgICB2ZXJzaW9uID0gbXlUYWJsZS5wdXQoUkVDT1JESUQsIG1ha2VWYWx1\nZShuYW1lLCBjb3VudGVyKSwgVmVyc2lvbi5ORVcpOwogICAgICAgIGFzc2Vy\ndE5vdE51bGwodmVyc2lvbik7CiAgICAgICAgUmVjb3JkIGV4cGVjdGVkID0g\nbmV3IFJlY29yZChuYW1lLCBjb3VudGVyLCB2ZXJzaW9uKTsKCiAgICAgICAg\nLy8gY29ycmVjdCB2ZXJzaW9uIHB1dCB3aXRoIG9ubHkgbmFtZSBmaWVsZCBj\naGFuZ2VkCiAgICAgICAgcHV0QW5kQ2hlY2soUkVDT1JESUQsICJuYW1lMSIs\nIG51bGwsIGV4cGVjdGVkLmdldFZlcnNpb24oKSwgZXhwZWN0ZWQsIENvZGUu\nT0spOwoKICAgICAgICAvLyBjb3JyZWN0IHZlcnNpb24gcHV0IHdpdGggb25s\neSBjb3VudGVyIGZpZWxkIGNoYW5nZWQKICAgICAgICBwdXRBbmRDaGVjayhS\nRUNPUkRJRCwgbnVsbCwgY291bnRlciArIDEsIGV4cGVjdGVkLmdldFZlcnNp\nb24oKSwgZXhwZWN0ZWQsIENvZGUuT0spOwoKICAgICAgICAvLyBjb3JyZWN0\nIHZlcnNpb24gcHV0IHdpdGggYWxsIGZpZWxkcyBmaWxsZWQKICAgICAgICBw\ndXRBbmRDaGVjayhSRUNPUkRJRCwgIm5hbWUyIiwgY291bnRlciArIDIsIGV4\ncGVjdGVkLmdldFZlcnNpb24oKSwgZXhwZWN0ZWQsIENvZGUuT0spOwoKICAg\nICAgICAvLyB0ZXN0IHB1dCBleGlzdCBlbnRyeSB3aXRoIFZlcnNpb24uQU5Z\nCiAgICAgICAgY2hlY2tQYXJ0aWFsUHV0KCJwdXQgZXhpc3QgZW50cnkgd2l0\naCBWZXJzaW9uLkFOWSIsIFZlcnNpb24uQU5ZLCBleHBlY3RlZCwgQ29kZS5P\nSyk7CgogICAgICAgIC8qKgogICAgICAgICAqIHRlc3QgYmFkIHZlcnNpb24g\ncHV0CiAgICAgICAgICovCiAgICAgICAgLy8gcHV0IHRvIGV4aXN0ZWQgZW50\ncnkgd2l0aCBWZXJzaW9uLk5FVwogICAgICAgIGJhZFZlcnNpb25lZFB1dChW\nZXJzaW9uLk5FVywgQ29kZS5LZXlFeGlzdHMpOwogICAgICAgIC8vIHB1dCB0\nbyBleGlzdGVkIGVudHJ5IHdpdGggYmFkIHZlcnNpb24KICAgICAgICBiYWRW\nZXJzaW9uZWRQdXQobmV3QmFkVmVyc2lvbigpLCBDb2RlLkJhZFZlcnNpb24p\nOwoKICAgICAgICAvLyByZW1vdmUgdGhlIGVudHJ5CiAgICAgICAgbXlUYWJs\nZS5yZW1vdmUoUkVDT1JESUQsIFZlcnNpb24uQU5ZKTsKCiAgICAgICAgLy8g\ncHV0IHRvIG5vbi1leGlzdGVudCBlbnRyeSB3aXRoIGJhZCB2ZXJzaW9uCiAg\nICAgICAgYmFkVmVyc2lvbmVkUHV0KG5ld0JhZFZlcnNpb24oKSwgQ29kZS5O\nb0tleSk7CiAgICAgICAgLy8gcHV0IHRvIG5vbi1leGlzdGVudCBlbnRyeSB3\naXRoIFZlcnNpb24uQU5ZCiAgICAgICAgYmFkVmVyc2lvbmVkUHV0KFZlcnNp\nb24uQU5ZLCBDb2RlLk5vS2V5KTsKCiAgICAgICAgLyoqCiAgICAgICAgICog\ndGVzdCBpbGxlZ2FsIGFyZ3VtZW50cwogICAgICAgICAqLwogICAgICAgIGls\nbGVnYWxQdXQobnVsbCwgVmVyc2lvbi5ORVcpOwogICAgICAgIGlsbGVnYWxQ\ndXQobWFrZVZhbHVlKCJpbGxlZ2FsIHZhbHVlIiwgZ2V0UmFuZG9tKCkpLCBu\ndWxsKTsKICAgICAgICBpbGxlZ2FsUHV0KG51bGwsIG51bGwpOwogICAgfQoK\nICAgIHByb3RlY3RlZCB2b2lkIGJhZFZlcnNpb25lZFB1dChWZXJzaW9uIGJh\nZFZlcnNpb24sIENvZGUgZXhwZWN0ZWRDb2RlKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBWZXJzaW9uZWQ8VmFsdWU+IHZ2ID0gZ2V0UmVjb3JkKFJF\nQ09SRElEKTsKICAgICAgICBSZWNvcmQgZXhwZWN0ZWQgPSBudWxsOwoKICAg\nICAgICBpZiAoZXhwZWN0ZWRDb2RlICE9IENvZGUuTm9LZXkpIHsKICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbCh2dik7CiAgICAgICAgICAgIGV4cGVjdGVk\nID0gbmV3IFJlY29yZCh2dik7CiAgICAgICAgfQoKICAgICAgICBjaGVja1Bh\ncnRpYWxQdXQoImJhZFZlcnNpb25lZFB1dCIsIGJhZFZlcnNpb24sIGV4cGVj\ndGVkLCBleHBlY3RlZENvZGUpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lk\nIGNoZWNrUGFydGlhbFB1dChTdHJpbmcgbmFtZSwgVmVyc2lvbiB2ZXJzaW9u\nLCBSZWNvcmQgZXhwZWN0ZWQsIENvZGUgZXhwZWN0ZWRDb2RlKQogICAgICAg\nICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBJbnRlZ2VyIGNvdW50\nZXI7CgogICAgICAgIC8vIGJhZCB2ZXJzaW9uIHB1dCB3aXRoIGFsbCBmaWVs\nZHMgZmlsbGVkCiAgICAgICAgY291bnRlciA9IGdldFJhbmRvbSgpOwogICAg\nICAgIHB1dEFuZENoZWNrKFJFQ09SRElELCBuYW1lICsgY291bnRlciwgY291\nbnRlciwgdmVyc2lvbiwgZXhwZWN0ZWQsIGV4cGVjdGVkQ29kZSk7CgogICAg\nICAgIC8vIGJhZCB2ZXJzaW9uIHB1dCB3aXRoIG9ubHkgbmFtZSBmaWVsZCBj\naGFuZ2VkCiAgICAgICAgY291bnRlciA9IGdldFJhbmRvbSgpOwogICAgICAg\nIHB1dEFuZENoZWNrKFJFQ09SRElELCBuYW1lICsgY291bnRlciwgbnVsbCwg\ndmVyc2lvbiwgZXhwZWN0ZWQsIGV4cGVjdGVkQ29kZSk7CgogICAgICAgIC8v\nIGJhZCB2ZXJzaW9uIHB1dCB3aXRoIG9ubHkgY291bnRlciBmaWVsZCBjaGFu\nZ2VkCiAgICAgICAgcHV0QW5kQ2hlY2soUkVDT1JESUQsIG51bGwsIGNvdW50\nZXIsIHZlcnNpb24sIGV4cGVjdGVkLCBleHBlY3RlZENvZGUpOwogICAgfQoK\nICAgIHByb3RlY3RlZCB2b2lkIGlsbGVnYWxQdXQoVmFsdWUgdmFsdWUsIFZl\ncnNpb24gdmVyc2lvbikgdGhyb3dzIE1TRXhjZXB0aW9uIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBteVRhYmxlLnB1dChSRUNPUkRJRCwgdmFsdWUs\nIHZlcnNpb24pOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgZmFpbCB0byBk\nbyB2ZXJzaW9uZWQgcHV0IHdpdGggaWxsZWdhbCBhcmd1bWVudHMiKTsKICAg\nICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5JbGxlZ2FsT3BFeGNlcHRpb24g\naW9lKSB7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB1\nc2FnZSBvZiAodW5jb25kaXRpb25hbCByZW1vdmUsIEJhZFZlcnNpb24gcmVt\nb3ZlLCBDb3JyZWN0VmVyc2lvbgogICAgICogcmVtb3ZlKSBvcGVyYXRpb24u\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0UmVtb3ZlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nZmluYWwgSW50ZWdlciBjb3VudGVyID0gZ2V0UmFuZG9tKCk7CiAgICAgICAg\nZmluYWwgU3RyaW5nIG5hbWUgPSAicmVtb3ZlIjsKICAgICAgICBWZXJzaW9u\nIHZlcnNpb247CgogICAgICAgIC8vIGluc2VydCB0ZXN0IGl0ZW0KICAgICAg\nICB2ZXJzaW9uID0gbXlUYWJsZS5wdXQoUkVDT1JESUQsIG1ha2VWYWx1ZShu\nYW1lLCBjb3VudGVyKSwgVmVyc2lvbi5ORVcpOwogICAgICAgIGFzc2VydE5v\ndE51bGwodmVyc2lvbik7CgogICAgICAgIC8vIHRlc3QgdW5jb25kaXRpb25h\nbCByZW1vdmUKICAgICAgICBteVRhYmxlLnJlbW92ZShSRUNPUkRJRCwgVmVy\nc2lvbi5BTlkpOwoKICAgICAgICAvLyBpbnNlcnQgdGVzdCBpdGVtCiAgICAg\nICAgdmVyc2lvbiA9IG15VGFibGUucHV0KFJFQ09SRElELCBtYWtlVmFsdWUo\nbmFtZSwgY291bnRlciksIFZlcnNpb24uTkVXKTsKICAgICAgICBhc3NlcnRO\nb3ROdWxsKHZlcnNpb24pOwoKICAgICAgICAvLyB0ZXN0IHJlbW92ZSB3aXRo\nIGJhZCB2ZXJzaW9uCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbXlUYWJs\nZS5yZW1vdmUoUkVDT1JESUQsIFZlcnNpb24uTkVXKTsKICAgICAgICAgICAg\nZmFpbCgiU2hvdWxkIGZhaWwgdG8gcmVtb3ZlIGEgZ2l2ZW4ga2V5IHdpdGgg\nYmFkIHZlcnNpb24iKTsKICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5C\nYWRWZXJzaW9uRXhjZXB0aW9uIGJ2ZSkgewogICAgICAgIH0KICAgICAgICB0\ncnkgewogICAgICAgICAgICBteVRhYmxlLnJlbW92ZShSRUNPUkRJRCwgbmV3\nQmFkVmVyc2lvbigpKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGZhaWwg\ndG8gcmVtb3ZlIGEgZ2l2ZW4ga2V5IHdpdGggYmFkIHZlcnNpb24iKTsKICAg\nICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5CYWRWZXJzaW9uRXhjZXB0aW9u\nIGJ2ZSkgewogICAgICAgIH0KCiAgICAgICAgLy8gdGVzdCByZW1vdmUgd2l0\naCBjb3JyZWN0IHZlcnNpb24KICAgICAgICBteVRhYmxlLnJlbW92ZShSRUNP\nUkRJRCwgdmVyc2lvbik7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgb3Bl\nbkN1cnNvclRlc3QoTWV0YXN0b3JlQ3Vyc29yIGN1cnNvciwgTWFwPFN0cmlu\nZywgVmFsdWU+IGV4cGVjdGVkVmFsdWVzLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaW50IG51bUVudHJpZXNQZXJTY2FuKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBNYXA8U3Ry\naW5nLCBWYWx1ZT4gZW50cmllcyA9IE1hcHMubmV3SGFzaE1hcCgpOwogICAg\nICAgICAgICB3aGlsZSAoY3Vyc29yLmhhc01vcmVFbnRyaWVzKCkpIHsKICAg\nICAgICAgICAgICAgIEl0ZXJhdG9yPE1ldGFzdG9yZVRhYmxlSXRlbT4gaXRl\nciA9IGN1cnNvci5yZWFkRW50cmllcyhudW1FbnRyaWVzUGVyU2Nhbik7CiAg\nICAgICAgICAgICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpIHsKICAgICAg\nICAgICAgICAgICAgICBNZXRhc3RvcmVUYWJsZUl0ZW0gaXRlbSA9IGl0ZXIu\nbmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHV0KGl0ZW0u\nZ2V0S2V5KCksIGl0ZW0uZ2V0VmFsdWUoKS5nZXRWYWx1ZSgpKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBNYXBEaWZm\nZXJlbmNlPFN0cmluZywgVmFsdWU+IGRpZmYgPSBNYXBzLmRpZmZlcmVuY2Uo\nZXhwZWN0ZWRWYWx1ZXMsIGVudHJpZXMpOwogICAgICAgICAgICBhc3NlcnRU\ncnVlKGRpZmYuYXJlRXF1YWwoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgY3Vyc29yLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAg\nIHZvaWQgb3BlblJhbmdlQ3Vyc29yVGVzdChTdHJpbmcgZmlyc3RLZXksIGJv\nb2xlYW4gZmlyc3RJbmNsdXNpdmUsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nIGxhc3RLZXksIGJvb2xlYW4gbGFzdEluY2x1c2l2ZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcmRlciBvcmRlciwgU2V0\nPFN0cmluZz4gZmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIEl0ZXJhdG9yPE1hcC5FbnRyeTxTdHJpbmcsIFZhbHVlPj4gZXhwZWN0ZWRW\nYWx1ZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW50IG51bUVu\ndHJpZXNQZXJTY2FuKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBNZXRh\nc3RvcmVDdXJzb3IgY3Vyc29yID0gbXlUYWJsZS5vcGVuQ3Vyc29yKGZpcnN0\nS2V5LCBmaXJzdEluY2x1c2l2ZSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RLZXksIGxhc3RJbmNs\ndXNpdmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBvcmRlciwgZmllbGRzKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICB3aGlsZSAoY3Vyc29yLmhhc01vcmVFbnRyaWVzKCkpIHsK\nICAgICAgICAgICAgICAgIEl0ZXJhdG9yPE1ldGFzdG9yZVRhYmxlSXRlbT4g\naXRlciA9IGN1cnNvci5yZWFkRW50cmllcyhudW1FbnRyaWVzUGVyU2Nhbik7\nCiAgICAgICAgICAgICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpIHsKICAg\nICAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKGV4cGVjdGVkVmFsdWVzLmhh\nc05leHQoKSk7CiAgICAgICAgICAgICAgICAgICAgTWV0YXN0b3JlVGFibGVJ\ndGVtIGl0ZW0gPSBpdGVyLm5leHQoKTsKICAgICAgICAgICAgICAgICAgICBN\nYXAuRW50cnk8U3RyaW5nLCBWYWx1ZT4gZXhwZWN0ZWRJdGVtID0gZXhwZWN0\nZWRWYWx1ZXMubmV4dCgpOwogICAgICAgICAgICAgICAgICAgIGFzc2VydEVx\ndWFscyhleHBlY3RlZEl0ZW0uZ2V0S2V5KCksIGl0ZW0uZ2V0S2V5KCkpOwog\nICAgICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscyhleHBlY3RlZEl0ZW0u\nZ2V0VmFsdWUoKSwgaXRlbS5nZXRWYWx1ZSgpLmdldFZhbHVlKCkpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2Vy\ndEZhbHNlKGV4cGVjdGVkVmFsdWVzLmhhc05leHQoKSk7CiAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgY3Vyc29yLmNsb3NlKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB1c2FnZSBvZiAoc2Nhbikg\nb3BlcmF0aW9uIG9uIChmdWxsIGFuZCBwYXJ0aWFsKSBmaWVsZHMuCiAgICAg\nKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0T3BlbkN1cnNvcigpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBU\ncmVlTWFwPFN0cmluZywgVmFsdWU+IGFsbFZhbHVlcyA9IE1hcHMubmV3VHJl\nZU1hcCgpOwogICAgICAgIFRyZWVNYXA8U3RyaW5nLCBWYWx1ZT4gcGFydGlh\nbFZhbHVlcyA9IE1hcHMubmV3VHJlZU1hcCgpOwogICAgICAgIFRyZWVNYXA8\nU3RyaW5nLCBWYWx1ZT4gbm9uVmFsdWVzID0gTWFwcy5uZXdUcmVlTWFwKCk7\nCgogICAgICAgIFNldDxTdHJpbmc+IGNvdW50ZXJGaWVsZHMgPSBTZXRzLm5l\nd0hhc2hTZXQoRklFTERfQ09VTlRFUik7CgogICAgICAgIGZvciAoaW50IGk9\nNTsgaTwyNDsgaSsrKSB7CiAgICAgICAgICAgIGNoYXIgYyA9IChjaGFyKSgn\nYScgKyBpKTsKICAgICAgICAgICAgU3RyaW5nIGtleSA9IFN0cmluZy52YWx1\nZU9mKGMpOwogICAgICAgICAgICBWYWx1ZSB2ID0gbWFrZVZhbHVlKCJ2YWx1\nZSIgKyBpLCBpKTsKICAgICAgICAgICAgVmFsdWUgY3YgPSB2LnByb2plY3Qo\nY291bnRlckZpZWxkcyk7CiAgICAgICAgICAgIFZhbHVlIG52ID0gdi5wcm9q\nZWN0KE5PTl9GSUVMRFMpOwoKICAgICAgICAgICAgbXlUYWJsZS5wdXQoa2V5\nLCBuZXcgVmFsdWUodiksIFZlcnNpb24uTkVXKTsKICAgICAgICAgICAgYWxs\nVmFsdWVzLnB1dChrZXksIHYpOwogICAgICAgICAgICBwYXJ0aWFsVmFsdWVz\nLnB1dChrZXksIGN2KTsKICAgICAgICAgICAgbm9uVmFsdWVzLnB1dChrZXks\nIG52KTsKICAgICAgICB9CgogICAgICAgIC8vIHRlc3Qgb3BlbiBjdXJzb3IK\nICAgICAgICBNZXRhc3RvcmVDdXJzb3IgY3Vyc29yID0gbXlUYWJsZS5vcGVu\nQ3Vyc29yKEFMTF9GSUVMRFMpOwogICAgICAgIG9wZW5DdXJzb3JUZXN0KGN1\ncnNvciwgYWxsVmFsdWVzLCA3KTsKCiAgICAgICAgY3Vyc29yID0gbXlUYWJs\nZS5vcGVuQ3Vyc29yKGNvdW50ZXJGaWVsZHMpOwogICAgICAgIG9wZW5DdXJz\nb3JUZXN0KGN1cnNvciwgcGFydGlhbFZhbHVlcywgNyk7CgogICAgICAgIGN1\ncnNvciA9IG15VGFibGUub3BlbkN1cnNvcihOT05fRklFTERTKTsKICAgICAg\nICBvcGVuQ3Vyc29yVGVzdChjdXJzb3IsIG5vblZhbHVlcywgNyk7CgogICAg\nICAgIC8vIHRlc3Qgb3JkZXIgaW5jbHVzaXZlIGV4Y2x1c2l2ZQogICAgICAg\nIEl0ZXJhdG9yPE1hcC5FbnRyeTxTdHJpbmcsIFZhbHVlPj4gZXhwZWN0ZWRJ\ndGVyYXRvcjsKCiAgICAgICAgZXhwZWN0ZWRJdGVyYXRvciA9IGFsbFZhbHVl\ncy5zdWJNYXAoImwiLCB0cnVlLCAidSIsIHRydWUpLmVudHJ5U2V0KCkuaXRl\ncmF0b3IoKTsKICAgICAgICBvcGVuUmFuZ2VDdXJzb3JUZXN0KCJsIiwgdHJ1\nZSwgInUiLCB0cnVlLCBPcmRlci5BU0MsIEFMTF9GSUVMRFMsIGV4cGVjdGVk\nSXRlcmF0b3IsIDcpOwoKICAgICAgICBleHBlY3RlZEl0ZXJhdG9yID0gYWxs\nVmFsdWVzLmRlc2NlbmRpbmdNYXAoKS5zdWJNYXAoInUiLCB0cnVlLCAibCIs\nIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5lbnRyeVNldCgp\nLml0ZXJhdG9yKCk7CiAgICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdCgidSIs\nIHRydWUsICJsIiwgdHJ1ZSwgT3JkZXIuREVTQywgQUxMX0ZJRUxEUywgZXhw\nZWN0ZWRJdGVyYXRvciwgNyk7CgogICAgICAgIGV4cGVjdGVkSXRlcmF0b3Ig\nPSBhbGxWYWx1ZXMuc3ViTWFwKCJsIiwgZmFsc2UsICJ1IiwgZmFsc2UpLmVu\ndHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAgICAgICBvcGVuUmFuZ2VDdXJzb3JU\nZXN0KCJsIiwgZmFsc2UsICJ1IiwgZmFsc2UsIE9yZGVyLkFTQywgQUxMX0ZJ\nRUxEUywgZXhwZWN0ZWRJdGVyYXRvciwgNyk7CgogICAgICAgIGV4cGVjdGVk\nSXRlcmF0b3IgPSBhbGxWYWx1ZXMuZGVzY2VuZGluZ01hcCgpLnN1Yk1hcCgi\ndSIsIGZhbHNlLCAibCIsIGZhbHNlKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAgIG9wZW5SYW5n\nZUN1cnNvclRlc3QoInUiLCBmYWxzZSwgImwiLCBmYWxzZSwgT3JkZXIuREVT\nQywgQUxMX0ZJRUxEUywgZXhwZWN0ZWRJdGVyYXRvciwgNyk7CgogICAgICAg\nIGV4cGVjdGVkSXRlcmF0b3IgPSBhbGxWYWx1ZXMuc3ViTWFwKCJsIiwgdHJ1\nZSwgInUiLCBmYWxzZSkuZW50cnlTZXQoKS5pdGVyYXRvcigpOwogICAgICAg\nIG9wZW5SYW5nZUN1cnNvclRlc3QoImwiLCB0cnVlLCAidSIsIGZhbHNlLCBP\ncmRlci5BU0MsIEFMTF9GSUVMRFMsIGV4cGVjdGVkSXRlcmF0b3IsIDcpOwoK\nICAgICAgICBleHBlY3RlZEl0ZXJhdG9yID0gYWxsVmFsdWVzLmRlc2NlbmRp\nbmdNYXAoKS5zdWJNYXAoInUiLCB0cnVlLCAibCIsIGZhbHNlKQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAuZW50cnlTZXQoKS5pdGVyYXRvcigpOwog\nICAgICAgIG9wZW5SYW5nZUN1cnNvclRlc3QoInUiLCB0cnVlLCAibCIsIGZh\nbHNlLCBPcmRlci5ERVNDLCBBTExfRklFTERTLCBleHBlY3RlZEl0ZXJhdG9y\nLCA3KTsKCiAgICAgICAgZXhwZWN0ZWRJdGVyYXRvciA9IGFsbFZhbHVlcy5z\ndWJNYXAoImwiLCBmYWxzZSwgInUiLCB0cnVlKS5lbnRyeVNldCgpLml0ZXJh\ndG9yKCk7CiAgICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdCgibCIsIGZhbHNl\nLCAidSIsIHRydWUsIE9yZGVyLkFTQywgQUxMX0ZJRUxEUywgZXhwZWN0ZWRJ\ndGVyYXRvciwgNyk7CgogICAgICAgIGV4cGVjdGVkSXRlcmF0b3IgPSBhbGxW\nYWx1ZXMuZGVzY2VuZGluZ01hcCgpLnN1Yk1hcCgidSIsIGZhbHNlLCAibCIs\nIHRydWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgIC5lbnRyeVNldCgp\nLml0ZXJhdG9yKCk7CiAgICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdCgidSIs\nIGZhbHNlLCAibCIsIHRydWUsIE9yZGVyLkRFU0MsIEFMTF9GSUVMRFMsIGV4\ncGVjdGVkSXRlcmF0b3IsIDcpOwoKICAgICAgICAvLyB0ZXN0IG91dCBvZiBy\nYW5nZQogICAgICAgIFN0cmluZyBmaXJzdEtleSA9ICJmIjsKICAgICAgICBT\ndHJpbmcgbGFzdEtleSA9ICJ4IjsKICAgICAgICBleHBlY3RlZEl0ZXJhdG9y\nID0gYWxsVmFsdWVzLnN1Yk1hcChmaXJzdEtleSwgdHJ1ZSwgbGFzdEtleSwg\ndHJ1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgLmVudHJ5U2V0KCku\naXRlcmF0b3IoKTsKICAgICAgICBvcGVuUmFuZ2VDdXJzb3JUZXN0KCJhIiwg\ndHJ1ZSwgInoiLCB0cnVlLCBPcmRlci5BU0MsIEFMTF9GSUVMRFMsIGV4cGVj\ndGVkSXRlcmF0b3IsIDcpOwoKICAgICAgICBleHBlY3RlZEl0ZXJhdG9yID0g\nYWxsVmFsdWVzLnN1Yk1hcCgibCIsIHRydWUsIGxhc3RLZXksIHRydWUpLmVu\ndHJ5U2V0KCkuaXRlcmF0b3IoKTsKICAgICAgICBvcGVuUmFuZ2VDdXJzb3JU\nZXN0KCJsIiwgdHJ1ZSwgInoiLCB0cnVlLCBPcmRlci5BU0MsIEFMTF9GSUVM\nRFMsIGV4cGVjdGVkSXRlcmF0b3IsIDcpOwoKICAgICAgICBleHBlY3RlZEl0\nZXJhdG9yID0gYWxsVmFsdWVzLnN1Yk1hcChmaXJzdEtleSwgdHJ1ZSwgInUi\nLCB0cnVlKS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7CiAgICAgICAgb3BlblJh\nbmdlQ3Vyc29yVGVzdCgiYSIsIHRydWUsICJ1IiwgdHJ1ZSwgT3JkZXIuQVND\nLCBBTExfRklFTERTLCBleHBlY3RlZEl0ZXJhdG9yLCA3KTsKCiAgICAgICAg\nLy8gdGVzdCBFTVBUWV9TVEFSVF9LRVkgYW5kIEVNUFRZX0VORF9LRVkKICAg\nICAgICBleHBlY3RlZEl0ZXJhdG9yID0gYWxsVmFsdWVzLnN1Yk1hcChmaXJz\ndEtleSwgdHJ1ZSwgInUiLCB0cnVlKS5lbnRyeVNldCgpLml0ZXJhdG9yKCk7\nCiAgICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdChFTVBUWV9TVEFSVF9LRVks\nIHRydWUsICJ1IiwgdHJ1ZSwgT3JkZXIuQVNDLCBBTExfRklFTERTLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRJdGVyYXRvciwgNyk7\nCgogICAgICAgIGV4cGVjdGVkSXRlcmF0b3IgPSBhbGxWYWx1ZXMuZGVzY2Vu\nZGluZ01hcCgpLnN1Yk1hcChsYXN0S2V5LCB0cnVlLCAibCIsIHRydWUpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgIC5lbnRyeVNldCgpLml0ZXJhdG9y\nKCk7CiAgICAgICAgb3BlblJhbmdlQ3Vyc29yVGVzdChFTVBUWV9FTkRfS0VZ\nLCB0cnVlLCAibCIsIHRydWUsIE9yZGVyLkRFU0MsIEFMTF9GSUVMRFMsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZEl0ZXJhdG9yLCA3\nKTsKCiAgICAgICAgLy8gdGVzdCBpbGxlZ2FsIGFyZ3VtZW50cwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIG15VGFibGUub3BlbkN1cnNvcigiYSIsIHRy\ndWUsICJ6IiwgdHJ1ZSwgT3JkZXIuREVTQywgQUxMX0ZJRUxEUyk7CiAgICAg\nICAgICAgIGZhaWwoIlNob3VsZCBmYWlsIHdpdGggd3JvbmcgcmFuZ2UiKTsK\nICAgICAgICB9IGNhdGNoIChNU0V4Y2VwdGlvbi5JbGxlZ2FsT3BFeGNlcHRp\nb24gaW9lKSB7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIG15VGFibGUub3BlbkN1cnNvcigieiIsIHRydWUsICJhIiwgdHJ1ZSwgT3Jk\nZXIuQVNDLCBBTExfRklFTERTKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxk\nIGZhaWwgd2l0aCB3cm9uZyByYW5nZSIpOwogICAgICAgIH0gY2F0Y2ggKE1T\nRXhjZXB0aW9uLklsbGVnYWxPcEV4Y2VwdGlvbiBpb2UpIHsKICAgICAgICB9\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbXlUYWJsZS5vcGVuQ3Vyc29y\nKCJhIiwgdHJ1ZSwgInoiLCB0cnVlLCBudWxsLCBBTExfRklFTERTKTsKICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkIGZhaWwgd2l0aCBudWxsIG9yZGVyIik7\nCiAgICAgICAgfSBjYXRjaCAoTVNFeGNlcHRpb24uSWxsZWdhbE9wRXhjZXB0\naW9uIGlvZSkgewogICAgICAgIH0KICAgIH0KCn0K\n","encoding":"base64"}

