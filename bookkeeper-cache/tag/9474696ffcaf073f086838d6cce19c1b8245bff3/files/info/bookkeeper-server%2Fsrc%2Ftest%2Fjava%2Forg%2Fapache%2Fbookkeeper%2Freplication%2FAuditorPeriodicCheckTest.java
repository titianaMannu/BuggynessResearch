{"sha":"fd605a74370fc8fc9c541d9f1a8154453d1e6310","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmQ2MDVhNzQzNzBmYzhmYzljNTQxZDlmMWE4MTU0NDUzZDFlNjMxMA==","size":13341,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/fd605a74370fc8fc9c541d9f1a8154453d1e6310","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tp\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2ll\nQWNjZXNzb3I7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2ll\nLkluZGV4UGVyc2lzdGVuY2VNZ3I7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suQWRkQ2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVy\nLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdlclVuZGVycmVwbGlj\nYXRpb25NYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnRl\nc3QuQm9va0tlZXBlckNsdXN0ZXJUZXN0Q2FzZTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci51dGlsLlprVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuem9va2VlcGVyLlpvb0tlZXBlcldhdGNoZXJCYXNlOwpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQg\nb3JnLmp1bml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1w\nb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGphdmEu\naW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uRmlsZU91dHB1dFN0cmVhbTsKaW1w\nb3J0IGphdmEuaW8uRmlsZW5hbWVGaWx0ZXI7CmltcG9ydCBqYXZhLmlvLklP\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERv\nd25MYXRjaDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5B\ndG9taWNCb29sZWFuOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRv\nbWljLkF0b21pY0ludGVnZXI7CgppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5B\nc3NlcnQuKjsKCi8qKgogKiBUaGlzIHRlc3QgdmVyaWZpZXMgdGhhdCB0aGUg\ncGVyaW9kIGNoZWNrIG9uIHRoZSBhdWRpdG9yCiAqIHdpbGwgcGljayB1cCBv\nbiBtaXNzaW5nIGRhdGEgaW4gdGhlIGNsaWVudAogKi8KcHVibGljIGNsYXNz\nIEF1ZGl0b3JQZXJpb2RpY0NoZWNrVGVzdCBleHRlbmRzIEJvb2tLZWVwZXJD\nbHVzdGVyVGVzdENhc2UgewogICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkKICAgICAgICAgICAgLmdldExvZ2dl\ncihBdWRpdG9yUGVyaW9kaWNDaGVja1Rlc3QuY2xhc3MpOwoKICAgIHByaXZh\ndGUgSGFzaE1hcDxTdHJpbmcsIEF1ZGl0b3JFbGVjdG9yPiBhdWRpdG9yRWxl\nY3RvcnMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIEF1ZGl0b3JFbGVjdG9yPigp\nOwogICAgcHJpdmF0ZSBMaXN0PFpvb0tlZXBlcj4gemtDbGllbnRzID0gbmV3\nIExpbmtlZExpc3Q8Wm9vS2VlcGVyPigpOwoKICAgIHByaXZhdGUgZmluYWwg\nc3RhdGljIGludCBDSEVDS19JTlRFUlZBTCA9IDE7IC8vIHJ1biBldmVyeSBz\nZWNvbmQKCiAgICBwdWJsaWMgQXVkaXRvclBlcmlvZGljQ2hlY2tUZXN0KCkg\newogICAgICAgIHN1cGVyKDMpOwogICAgICAgIGJhc2VDb25mLnNldFBhZ2VM\naW1pdCgxKTsgLy8gdG8gbWFrZSBpdCBlYXN5IHRvIHB1c2ggbGVkZ2VyIG91\ndCBvZiBjYWNoZQogICAgfQoKICAgIEBCZWZvcmUKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBzdXBlci5zZXRVcCgpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG51bUJvb2tpZXM7IGkrKykgewogICAgICAgICAgICBTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbihic0Nv\nbmZzLmdldChpKSk7CiAgICAgICAgICAgIGNvbmYuc2V0QXVkaXRvclBlcmlv\nZGljQ2hlY2tJbnRlcnZhbChDSEVDS19JTlRFUlZBTCk7CgogICAgICAgICAg\nICBTdHJpbmcgYWRkciA9IGJzLmdldChpKS5nZXRMb2NhbEFkZHJlc3MoKS50\nb1N0cmluZygpOwoKICAgICAgICAgICAgWm9vS2VlcGVyV2F0Y2hlckJhc2Ug\ndyA9IG5ldyBab29LZWVwZXJXYXRjaGVyQmFzZSgxMDAwMCk7CiAgICAgICAg\nICAgIFpvb0tlZXBlciB6ayA9IFprVXRpbHMuY3JlYXRlQ29ubmVjdGVkWm9v\na2VlcGVyQ2xpZW50KAogICAgICAgICAgICAgICAgICAgIHprVXRpbC5nZXRa\nb29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHcpOwogICAgICAgICAgICB6a0Ns\naWVudHMuYWRkKHprKTsKCiAgICAgICAgICAgIEF1ZGl0b3JFbGVjdG9yIGF1\nZGl0b3JFbGVjdG9yID0gbmV3IEF1ZGl0b3JFbGVjdG9yKGFkZHIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNvbmYsIHprKTsKICAgICAgICAgICAgYXVkaXRvckVs\nZWN0b3JzLnB1dChhZGRyLCBhdWRpdG9yRWxlY3Rvcik7CiAgICAgICAgICAg\nIGF1ZGl0b3JFbGVjdG9yLnN0YXJ0KCk7CiAgICAgICAgICAgIExPRy5kZWJ1\nZygiU3RhcnRpbmcgQXVkaXRvciBFbGVjdG9yIik7CiAgICAgICAgfQogICAg\nfQoKICAgIEBBZnRlcgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCB0\nZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZvciAoQXVk\naXRvckVsZWN0b3IgZSA6IGF1ZGl0b3JFbGVjdG9ycy52YWx1ZXMoKSkgewog\nICAgICAgICAgICBlLnNodXRkb3duKCk7CiAgICAgICAgfQogICAgICAgIGZv\nciAoWm9vS2VlcGVyIHprIDogemtDbGllbnRzKSB7CiAgICAgICAgICAgIHpr\nLmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIHprQ2xpZW50cy5jbGVhcigp\nOwogICAgICAgIHN1cGVyLnRlYXJEb3duKCk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiB0ZXN0IHRoYXQgdGhlIHBlcmlvZGljIGNoZWNraW5nIHdpbGwgZGV0\nZWN0IGNvcnJ1cHRpb25zIGluCiAgICAgKiB0aGUgYm9va2llIGVudHJ5IGxv\nZwogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTMwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdEVudHJ5TG9nQ29ycnVwdGlvbigpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIExlZGdlck1hbmFnZXJGYWN0b3J5IG1GYWN0b3J5ID0g\nTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2VyTWFuYWdlckZhY3Rvcnko\nYnNDb25mcy5nZXQoMCksIHprYyk7CiAgICAgICAgTGVkZ2VyVW5kZXJyZXBs\naWNhdGlvbk1hbmFnZXIgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIgPSBtRmFj\ndG9yeS5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwogICAg\nICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmRpc2FibGVMZWRnZXJSZXBs\naWNhdGlvbigpOwoKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3Jl\nYXRlTGVkZ2VyKDMsIDMsIERpZ2VzdFR5cGUuQ1JDMzIsICJwYXNzd2QiLmdl\ndEJ5dGVzKCkpOwogICAgICAgIGxvbmcgbGVkZ2VySWQgPSBsaC5nZXRJZCgp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAg\nICAgICAgICAgbGguYWRkRW50cnkoInRlc3RkYXRhIi5nZXRCeXRlcygpKTsK\nICAgICAgICB9CiAgICAgICAgbGguY2xvc2UoKTsKCiAgICAgICAgQm9va2ll\nQWNjZXNzb3IuZm9yY2VGbHVzaChicy5nZXQoMCkuZ2V0Qm9va2llKCkpOwoK\nCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBic0NvbmZzLmdldCgwKS5nZXRM\nZWRnZXJEaXJzKClbMF07CiAgICAgICAgbGVkZ2VyRGlyID0gQm9va2llLmdl\ndEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKTsKICAgICAgICAvLyBjb3Jy\ndXB0IG9mIGVudHJ5TG9ncwogICAgICAgIEZpbGVbXSBlbnRyeUxvZ3MgPSBs\nZWRnZXJEaXIubGlzdEZpbGVzKG5ldyBGaWxlbmFtZUZpbHRlcigpIHsKICAg\nICAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChGaWxlIGRpciwg\nU3RyaW5nIG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmFt\nZS5lbmRzV2l0aCgiLmxvZyIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9KTsKICAgICAgICBCeXRlQnVmZmVyIGp1bmsgPSBCeXRlQnVmZmVy\nLmFsbG9jYXRlKDEwMjQqMTAyNCk7CiAgICAgICAgZm9yIChGaWxlIGYgOiBl\nbnRyeUxvZ3MpIHsKICAgICAgICAgICAgRmlsZU91dHB1dFN0cmVhbSBvdXQg\nPSBuZXcgRmlsZU91dHB1dFN0cmVhbShmKTsKICAgICAgICAgICAgb3V0Lmdl\ndENoYW5uZWwoKS53cml0ZShqdW5rKTsKICAgICAgICAgICAgb3V0LmNsb3Nl\nKCk7CiAgICAgICAgfQogICAgICAgIHJlc3RhcnRCb29raWVzKCk7IC8vIHJl\nc3RhcnQgdG8gY2xlYXIgcmVhZCBidWZmZXJzCgogICAgICAgIHVuZGVyUmVw\nbGljYXRpb25NYW5hZ2VyLmVuYWJsZUxlZGdlclJlcGxpY2F0aW9uKCk7CiAg\nICAgICAgbG9uZyB1bmRlclJlcGxpY2F0ZWRMZWRnZXIgPSAtMTsKICAgICAg\nICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAg\ndW5kZXJSZXBsaWNhdGVkTGVkZ2VyID0gdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIucG9sbExlZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICAgICAgaWYg\nKHVuZGVyUmVwbGljYXRlZExlZGdlciAhPSAtMSkgewogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGhyZWFkLnNs\nZWVwKENIRUNLX0lOVEVSVkFMICogMTAwMCk7CiAgICAgICAgfQogICAgICAg\nIGFzc2VydEVxdWFscygiTGVkZ2VyIHNob3VsZCBiZSB1bmRlciByZXBsaWNh\ndGVkIiwgbGVkZ2VySWQsIHVuZGVyUmVwbGljYXRlZExlZGdlcik7CiAgICAg\nICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIuY2xvc2UoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIHRlc3QgdGhhdCB0aGUgcGVyaW9kIGNoZWNrZXIgd2ls\nbCBkZXRlY3QgY29ycnVwdGlvbnMgaW4KICAgICAqIHRoZSBib29raWUgaW5k\nZXggZmlsZXMKICAgICAqLwogICAgQFRlc3QodGltZW91dD0zMDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3RJbmRleENvcnJ1cHRpb24oKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBMZWRnZXJNYW5hZ2VyRmFjdG9yeSBtRmFjdG9y\neSA9IExlZGdlck1hbmFnZXJGYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXJGYWN0\nb3J5KGJzQ29uZnMuZ2V0KDApLCB6a2MpOwogICAgICAgIExlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyID0g\nbUZhY3RvcnkubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsK\nCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigz\nLCAzLCBEaWdlc3RUeXBlLkNSQzMyLCAicGFzc3dkIi5nZXRCeXRlcygpKTsK\nICAgICAgICBsb25nIGxlZGdlclRvQ29ycnVwdCA9IGxoLmdldElkKCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykgewogICAgICAg\nICAgICBsaC5hZGRFbnRyeSgidGVzdGRhdGEiLmdldEJ5dGVzKCkpOwogICAg\nICAgIH0KICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICAvLyBwdXNoIGxl\nZGdlclRvQ29ycnVwdCBvdXQgb2YgcGFnZSBjYWNoZSAoYm9va2llIGlzIGNv\nbmZpZ3VyZWQgdG8gb25seSB1c2UgMSBwYWdlKQogICAgICAgIGxoID0gYmtj\nLmNyZWF0ZUxlZGdlcigzLCAzLCBEaWdlc3RUeXBlLkNSQzMyLCAicGFzc3dk\nIi5nZXRCeXRlcygpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEw\nMDsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVudHJ5KCJ0ZXN0ZGF0YSIu\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQogICAgICAgIGxoLmNsb3NlKCk7Cgog\nICAgICAgIEJvb2tpZUFjY2Vzc29yLmZvcmNlRmx1c2goYnMuZ2V0KDApLmdl\ndEJvb2tpZSgpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBic0NvbmZz\nLmdldCgwKS5nZXRMZWRnZXJEaXJzKClbMF07CiAgICAgICAgbGVkZ2VyRGly\nID0gQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKTsKCiAg\nICAgICAgLy8gY29ycnVwdCBvZiBlbnRyeUxvZ3MKICAgICAgICBGaWxlIGlu\nZGV4ID0gbmV3IEZpbGUobGVkZ2VyRGlyLCBJbmRleFBlcnNpc3RlbmNlTWdy\nLmdldExlZGdlck5hbWUobGVkZ2VyVG9Db3JydXB0KSk7CiAgICAgICAgTE9H\nLmluZm8oImZpbGUgdG8gY29ycnVwdHt9IiAsIGluZGV4KTsKICAgICAgICBC\neXRlQnVmZmVyIGp1bmsgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDEwMjQqMTAy\nNCk7CiAgICAgICAgRmlsZU91dHB1dFN0cmVhbSBvdXQgPSBuZXcgRmlsZU91\ndHB1dFN0cmVhbShpbmRleCk7CiAgICAgICAgb3V0LmdldENoYW5uZWwoKS53\ncml0ZShqdW5rKTsKICAgICAgICBvdXQuY2xvc2UoKTsKCiAgICAgICAgbG9u\nZyB1bmRlclJlcGxpY2F0ZWRMZWRnZXIgPSAtMTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgdW5kZXJSZXBs\naWNhdGVkTGVkZ2VyID0gdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIucG9sbExl\nZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICAgICAgaWYgKHVuZGVyUmVw\nbGljYXRlZExlZGdlciAhPSAtMSkgewogICAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGhyZWFkLnNsZWVwKENIRUNL\nX0lOVEVSVkFMICogMTAwMCk7CiAgICAgICAgfQogICAgICAgIGFzc2VydEVx\ndWFscygiTGVkZ2VyIHNob3VsZCBiZSB1bmRlciByZXBsaWNhdGVkIiwgbGVk\nZ2VyVG9Db3JydXB0LCB1bmRlclJlcGxpY2F0ZWRMZWRnZXIpOwogICAgICAg\nIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmNsb3NlKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUZXN0IHRoYXQgdGhlIHBlcmlvZCBjaGVja2VyIHdpbGwg\nbm90IHJ1biB3aGVuIGF1dG8gcmVwbGljYXRpb24gaGFzIGJlZW4gZGlzYWJs\nZWQKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RQZXJpb2RpY0NoZWNrV2hlbkRpc2FibGVkKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbUZh\nY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2Vy\nRmFjdG9yeShic0NvbmZzLmdldCgwKSwgemtjKTsKICAgICAgICBmaW5hbCBM\nZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB1bmRlclJlcGxpY2F0aW9u\nTWFuYWdlciA9IG1GYWN0b3J5Lm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25N\nYW5hZ2VyKCk7CiAgICAgICAgZmluYWwgaW50IG51bUxlZGdlcnMgPSAxMDA7\nCiAgICAgICAgZmluYWwgaW50IG51bU1zZ3MgPSAxMDA7CiAgICAgICAgZmlu\nYWwgQ291bnREb3duTGF0Y2ggY29tcGxldGVMYXRjaCA9IG5ldyBDb3VudERv\nd25MYXRjaChudW1Nc2dzKm51bUxlZGdlcnMpOwogICAgICAgIGZpbmFsIEF0\nb21pY0ludGVnZXIgcmMgPSBuZXcgQXRvbWljSW50ZWdlcihCS0V4Y2VwdGlv\nbi5Db2RlLk9LKTsKCiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9\nIG5ldyBBcnJheUxpc3Q8TGVkZ2VySGFuZGxlPigpOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgbnVtTGVkZ2VyczsgaSsrKSB7CiAgICAgICAgICAg\nIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoMywgMywgRGln\nZXN0VHlwZS5DUkMzMiwgInBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAg\nICAgIGxocy5hZGQobGgpOwogICAgICAgICAgICBmb3IgKGludCBqID0gMDsg\naiA8IDEwMDsgaisrKSB7CiAgICAgICAgICAgICAgICBsaC5hc3luY0FkZEVu\ndHJ5KCJ0ZXN0ZGF0YSIuZ2V0Qnl0ZXMoKSwgbmV3IEFkZENhbGxiYWNrKCkg\newogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBhZGRDb21w\nbGV0ZShpbnQgcmMyLCBMZWRnZXJIYW5kbGUgbGgsIGxvbmcgZW50cnlJZCwg\nT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKHJjLmNvbXBhcmVBbmRTZXQoQktFeGNlcHRpb24uQ29kZS5PSywgcmMyKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJG\nYWlsZWQgdG8gYWRkIGVudHJ5IDoge30iLCBCS0V4Y2VwdGlvbi5nZXRNZXNz\nYWdlKHJjMikpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVMYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0sIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nICAgIGNvbXBsZXRlTGF0Y2guYXdhaXQoKTsKICAgICAgICBpZiAocmMuZ2V0\nKCkgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICB0aHJv\ndyBCS0V4Y2VwdGlvbi5jcmVhdGUocmMuZ2V0KCkpOwogICAgICAgIH0KCiAg\nICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMpIHsKICAgICAgICAg\nICAgbGguY2xvc2UoKTsKICAgICAgICB9CgogICAgICAgIHVuZGVyUmVwbGlj\nYXRpb25NYW5hZ2VyLmRpc2FibGVMZWRnZXJSZXBsaWNhdGlvbigpOwoKICAg\nICAgICBmaW5hbCBBdG9taWNJbnRlZ2VyIG51bVJlYWRzID0gbmV3IEF0b21p\nY0ludGVnZXIoMCk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nID0ga2lsbEJvb2tpZSgwKTsKCiAgICAgICAgQm9va2llIGRlYWRCb29raWUg\nPSBuZXcgQm9va2llKGNvbmYpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyBCeXRlQnVmZmVyIHJlYWRFbnRyeShsb25nIGxl\nZGdlcklkLCBsb25nIGVudHJ5SWQpCiAgICAgICAgICAgICAgICAgICAgdGhy\nb3dzIElPRXhjZXB0aW9uLCBOb0xlZGdlckV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICAvLyB3ZSB3YW50IHRvIGRpc2FibGUgZHVyaW5nIGNoZWNraW5n\nCiAgICAgICAgICAgICAgICBudW1SZWFkcy5pbmNyZW1lbnRBbmRHZXQoKTsK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRmFrZSBJ\nL08gZXhjZXB0aW9uIik7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAg\nICAgIGJzQ29uZnMuYWRkKGNvbmYpOwogICAgICAgIGJzLmFkZChzdGFydEJv\nb2tpZShjb25mLCBkZWFkQm9va2llKSk7CgogICAgICAgIFRocmVhZC5zbGVl\ncChDSEVDS19JTlRFUlZBTCAqIDIwMDApOwogICAgICAgIGFzc2VydEVxdWFs\ncygiTm90aGluZyBzaG91bGQgaGF2ZSB0cmllZCB0byByZWFkIiwgMCwgbnVt\nUmVhZHMuZ2V0KCkpOwogICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2Vy\nLmVuYWJsZUxlZGdlclJlcGxpY2F0aW9uKCk7CiAgICAgICAgVGhyZWFkLnNs\nZWVwKENIRUNLX0lOVEVSVkFMICogMjAwMCk7IC8vIGdpdmUgaXQgdGltZSB0\nbyBydW4KCiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIuZGlzYWJs\nZUxlZGdlclJlcGxpY2F0aW9uKCk7CiAgICAgICAgLy8gZ2l2ZSBpdCB0aW1l\nIHRvIHN0b3AsIGZyb20gdGhpcyBwb2ludCBub3RoaW5nIG5ldyBzaG91bGQg\nYmUgbWFya2VkCiAgICAgICAgVGhyZWFkLnNsZWVwKENIRUNLX0lOVEVSVkFM\nICogMjAwMCk7CgogICAgICAgIGludCBudW1VbmRlcnJlcGxpY2F0ZWQgPSAw\nOwogICAgICAgIGxvbmcgdW5kZXJSZXBsaWNhdGVkTGVkZ2VyID0gLTE7CiAg\nICAgICAgZG8gewogICAgICAgICAgICB1bmRlclJlcGxpY2F0ZWRMZWRnZXIg\nPSB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5wb2xsTGVkZ2VyVG9SZXJlcGxp\nY2F0ZSgpOwogICAgICAgICAgICBpZiAodW5kZXJSZXBsaWNhdGVkTGVkZ2Vy\nID09IC0xKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBudW1VbmRlcnJlcGxpY2F0ZWQrKzsKCiAgICAgICAg\nICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLm1hcmtMZWRnZXJSZXBsaWNh\ndGVkKHVuZGVyUmVwbGljYXRlZExlZGdlcik7CiAgICAgICAgfSB3aGlsZSAo\ndW5kZXJSZXBsaWNhdGVkTGVkZ2VyICE9IC0xKTsKCiAgICAgICAgVGhyZWFk\nLnNsZWVwKENIRUNLX0lOVEVSVkFMICogMjAwMCk7IC8vIGdpdmUgYSBjaGFu\nY2UgdG8gcnVuIGFnYWluIChpdCBzaG91bGRuJ3QsIGl0J3MgZGlzYWJsZWQp\nCgogICAgICAgIC8vIGVuc3VyZSB0aGF0IG5vdGhpbmcgaXMgbWFya2VkIGFz\nIHVuZGVycmVwbGljYXRlZAogICAgICAgIHVuZGVyUmVwbGljYXRlZExlZGdl\nciA9IHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLnBvbGxMZWRnZXJUb1JlcmVw\nbGljYXRlKCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJUaGVyZSBzaG91bGQg\nYmUgbm8gdW5kZXJyZXBsaWNhdGVkIGxlZGdlcnMiLCAtMSwgdW5kZXJSZXBs\naWNhdGVkTGVkZ2VyKTsKCiAgICAgICAgTE9HLmluZm8oInt9IG9mIHt9IGxl\nZGdlcnMgdW5kZXJyZXBsaWNhdGVkIiwgbnVtVW5kZXJyZXBsaWNhdGVkLCBu\ndW1VbmRlcnJlcGxpY2F0ZWQpOwogICAgICAgIGFzc2VydFRydWUoIkFsbCBz\naG91bGQgYmUgdW5kZXJyZXBsaWNhdGVkIiwKICAgICAgICAgICAgICAgIG51\nbVVuZGVycmVwbGljYXRlZCA8PSBudW1MZWRnZXJzICYmIG51bVVuZGVycmVw\nbGljYXRlZCA+IDApOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0\nIHRoZSBwZXJpb2QgY2hlY2sgd2lsbCBzdWNjZWVkIGlmIGEgbGVkZ2VyIGlz\nIGRlbGV0ZWQgbWlkd2F5CiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0UGVyaW9kaWNDaGVja1doZW5MZWRn\nZXJEZWxldGVkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChB\ndWRpdG9yRWxlY3RvciBlIDogYXVkaXRvckVsZWN0b3JzLnZhbHVlcygpKSB7\nCiAgICAgICAgICAgIGUuc2h1dGRvd24oKTsKICAgICAgICB9CgogICAgICAg\nIGZpbmFsIGludCBudW1MZWRnZXJzID0gMTAwOwogICAgICAgIExpc3Q8TG9u\nZz4gaWRzID0gbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAg\nICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIERp\nZ2VzdFR5cGUuQ1JDMzIsICJwYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAg\nICAgICBpZHMuYWRkKGxoLmdldElkKCkpOwogICAgICAgICAgICBmb3IgKGlu\ndCBqID0gMDsgaiA8IDEwOyBqKyspIHsKICAgICAgICAgICAgICAgIGxoLmFk\nZEVudHJ5KCJ0ZXN0ZGF0YSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgZmlu\nYWwgQXVkaXRvciBhdWRpdG9yID0gbmV3IEF1ZGl0b3IoCiAgICAgICAgICAg\nICAgICBCb29raWUuZ2V0Qm9va2llQWRkcmVzcyhic0NvbmZzLmdldCgwKSku\ndG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgIGJzQ29uZnMuZ2V0KDApLCB6\na2MpOwogICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gZXhjZXB0aW9uQ2F1\nZ2h0ID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAgICAgIGZpbmFs\nIENvdW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEp\nOwogICAgICAgIFRocmVhZCB0ID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBudW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGF1ZGl0b3IuY2hlY2tBbGxMZWRnZXJzKCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkNhdWdodCBleGNlcHRpb24gd2hpbGUgY2hlY2tpbmcgYWxsIGxlZGdl\ncnMiLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0aW9uQ2F1\nZ2h0LnNldCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgdC5zdGFydCgpOwog\nICAgICAgIGxhdGNoLmF3YWl0KCk7CiAgICAgICAgZm9yIChMb25nIGlkIDog\naWRzKSB7CiAgICAgICAgICAgIGJrYy5kZWxldGVMZWRnZXIoaWQpOwogICAg\nICAgIH0KICAgICAgICB0LmpvaW4oKTsKICAgICAgICBhc3NlcnRGYWxzZSgi\nU2hvdWxkbid0IGhhdmUgdGhyb3duIGV4Y2VwdGlvbiIsIGV4Y2VwdGlvbkNh\ndWdodC5nZXQoKSk7CiAgICB9Cn0K\n","encoding":"base64"}

