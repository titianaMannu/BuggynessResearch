{"sha":"72fd11c55c97de80b49ad7e6a843f1711fbb92a5","node_id":"MDQ6QmxvYjE1NzU5NTY6NzJmZDExYzU1Yzk3ZGU4MGI0OWFkN2U2YTg0M2YxNzExZmJiOTJhNQ==","size":26632,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/72fd11c55c97de80b49ad7e6a843f1711fbb92a5","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbjsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLlNvcnRlZE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nVGltZVVuaXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyVGVzdENsaWVudDsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxl\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJI\nYW5kbGVBZGFwdGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNv\nbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhLkxlZGdlck1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdlclVuZGVycmVwbGlj\nYXRpb25NYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGEuWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5uZXQuQm9va2llU29ja2V0QWRkcmVzczsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24u\nUmVwbGljYXRpb25FeGNlcHRpb24uQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBs\naWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LkJvb2tLZWVwZXJDbHVzdGVy\nVGVzdENhc2U7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVk\nRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVudC5FdmVu\ndFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5kYXRhLlN0YXQ7\nCmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBz\ndGF0aWMgb3JnLmp1bml0LkFzc2VydC4qOwoKLyoqCiAqIEludGVncmF0aW9u\nIHRlc3RzIHZlcmlmaWVzIHRoZSBjb21wbGV0ZSBmdW5jdGlvbmFsaXR5IG9m\nIHRoZQogKiBBdWRpdG9yLXJlcmVwbGljYXRpb24gcHJvY2VzczogQXVkaXRv\nciB3aWxsIHB1Ymxpc2ggdGhlIGJvb2tpZSBmYWlsdXJlcywKICogY29uc2Vx\ndWVudGx5IFJlcGxpY2F0aW9uV29ya2VyIHdpbGwgZ2V0IHRoZSBub3RpZmlj\nYXRpb25zIGFuZCBhY3Qgb24gaXQuCiAqLwpwdWJsaWMgY2xhc3MgQm9va2ll\nQXV0b1JlY292ZXJ5VGVzdCBleHRlbmRzIEJvb2tLZWVwZXJDbHVzdGVyVGVz\ndENhc2UgewogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9\nIExvZ2dlckZhY3RvcnkKICAgICAgICAgICAgLmdldExvZ2dlcihCb29raWVB\ndXRvUmVjb3ZlcnlUZXN0LmNsYXNzKTsKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGJ5dGVbXSBQQVNTV0QgPSAiYWRtaW4iLmdldEJ5dGVzKCk7CiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBieXRlW10gZGF0YSA9ICJURVNUREFUQSIu\nZ2V0Qnl0ZXMoKTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBv\ncGVuTGVkZ2VyUmVyZXBsaWNhdGlvbkdyYWNlUGVyaW9kID0gIjMwMDAiOyAv\nLyBtaWxsaXNlY29uZHMKCiAgICBwcml2YXRlIERpZ2VzdFR5cGUgZGlnZXN0\nVHlwZTsKICAgIHByaXZhdGUgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbUZhY3Rv\ncnk7CiAgICBwcml2YXRlIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2Vy\nIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyOwogICAgcHJpdmF0ZSBMZWRnZXJN\nYW5hZ2VyIGxlZGdlck1hbmFnZXI7CgogICAgcHJpdmF0ZSBmaW5hbCBTdHJp\nbmcgVU5ERVJSRVBMSUNBVEVEX1BBVEggPSBiYXNlQ2xpZW50Q29uZgogICAg\nICAgICAgICAuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICIvdW5kZXJyZXBs\naWNhdGlvbi9sZWRnZXJzIjsKCiAgICBwdWJsaWMgQm9va2llQXV0b1JlY292\nZXJ5VGVzdCgpIHRocm93cyBJT0V4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9u\nLAogICAgICAgICAgICBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgVW5hdmFpbGFi\nbGVFeGNlcHRpb24sIENvbXBhdGliaWxpdHlFeGNlcHRpb24gewogICAgICAg\nIHN1cGVyKDMpOwoKICAgICAgICBiYXNlQ29uZi5zZXRMZWRnZXJNYW5hZ2Vy\nRmFjdG9yeUNsYXNzTmFtZSgKICAgICAgICAgICAgICAgICJvcmcuYXBhY2hl\nLmJvb2trZWVwZXIubWV0YS5IaWVyYXJjaGljYWxMZWRnZXJNYW5hZ2VyRmFj\ndG9yeSIpOwogICAgICAgIGJhc2VDb25mLnNldE9wZW5MZWRnZXJSZXJlcGxp\nY2F0aW9uR3JhY2VQZXJpb2Qob3BlbkxlZGdlclJlcmVwbGljYXRpb25HcmFj\nZVBlcmlvZCk7CiAgICAgICAgYmFzZUNsaWVudENvbmYuc2V0TGVkZ2VyTWFu\nYWdlckZhY3RvcnlDbGFzc05hbWUoCiAgICAgICAgICAgICAgICAib3JnLmFw\nYWNoZS5ib29ra2VlcGVyLm1ldGEuSGllcmFyY2hpY2FsTGVkZ2VyTWFuYWdl\nckZhY3RvcnkiKTsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBEaWdlc3RU\neXBlLk1BQzsKICAgICAgICBzZXRBdXRvUmVjb3ZlcnlFbmFibGVkKHRydWUp\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci5zZXRVcCgpOwog\nICAgICAgIGJhc2VDb25mLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2Vl\ncGVyQ29ubmVjdFN0cmluZygpKTsKICAgICAgICAvLyBpbml0aWFsaXplIHVy\nUmVwbGljYXRpb25NYW5hZ2VyCiAgICAgICAgbUZhY3RvcnkgPSBMZWRnZXJN\nYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeShiYXNlQ2xp\nZW50Q29uZiwKICAgICAgICAgICAgICAgIHprYyk7CiAgICAgICAgdW5kZXJS\nZXBsaWNhdGlvbk1hbmFnZXIgPSBtRmFjdG9yeS5uZXdMZWRnZXJVbmRlcnJl\ncGxpY2F0aW9uTWFuYWdlcigpOwogICAgICAgIExlZGdlck1hbmFnZXJGYWN0\nb3J5IG5ld0xlZGdlck1hbmFnZXJGYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZh\nY3RvcnkKICAgICAgICAgICAgICAgIC5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9y\neShiYXNlQ2xpZW50Q29uZiwgemtjKTsKICAgICAgICBsZWRnZXJNYW5hZ2Vy\nID0gbmV3TGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2VyTWFuYWdlcigp\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdGVhckRv\nd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci50ZWFyRG93\nbigpOwogICAgICAgIGlmIChudWxsICE9IG1GYWN0b3J5KSB7CiAgICAgICAg\nICAgIG1GYWN0b3J5LnVuaW5pdGlhbGl6ZSgpOwogICAgICAgICAgICBtRmFj\ndG9yeSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlmIChudWxsICE9IHVu\nZGVyUmVwbGljYXRpb25NYW5hZ2VyKSB7CiAgICAgICAgICAgIHVuZGVyUmVw\nbGljYXRpb25NYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgICAgIHVuZGVyUmVw\nbGljYXRpb25NYW5hZ2VyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYg\nKG51bGwgIT0gbGVkZ2VyTWFuYWdlcikgewogICAgICAgICAgICBsZWRnZXJN\nYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgICAgIGxlZGdlck1hbmFnZXIgPSBu\ndWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdmVy\naWZpZXMgcHVibGlzaCB1ckxlZGdlciBieSBBdWRpdG9yIGFuZCByZXBsaWNh\ndGlvbiB3b3JrZXIgaXMKICAgICAqIHBpY2tpbmcgdXAgdGhlIGVudHJpZXMg\nYW5kIGZpbmlzaGluZyB0aGUgcmVyZXBsaWNhdGlvbiBvZiBvcGVuIGxlZGdl\ncgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gOTAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0T3BlbkxlZGdlcnMoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGlzdE9mTGVkZ2VySGFuZGxl\nID0gY3JlYXRlTGVkZ2Vyc0FuZEFkZEVudHJpZXMoMSwgNSk7CiAgICAgICAg\nTGVkZ2VySGFuZGxlIGxoID0gbGlzdE9mTGVkZ2VySGFuZGxlLmdldCgwKTsK\nICAgICAgICBpbnQgbGVkZ2VyUmVwbGljYUluZGV4ID0gMDsKICAgICAgICBC\nb29raWVTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGxBZGRyID0gTGVkZ2Vy\nSGFuZGxlQWRhcHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFk\nYXRhKGxoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKCiAgICAg\nICAgZmluYWwgU3RyaW5nIHVyTGVkZ2VyWk5vZGUgPSBnZXRVckxlZGdlclpO\nb2RlKGxoKTsKICAgICAgICBsZWRnZXJSZXBsaWNhSW5kZXggPSBnZXRSZXBs\naWNhSW5kZXhJbkxlZGdlcihsaCwgcmVwbGljYVRvS2lsbEFkZHIpOwoKICAg\nICAgICBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKICAgICAgICBhc3NlcnROdWxsKCJVckxlZGdlciBhbHJlYWR5IGV4\naXN0cyEiLAogICAgICAgICAgICAgICAgd2F0Y2hVckxlZGdlck5vZGUodXJM\nZWRnZXJaTm9kZSwgbGF0Y2gpKTsKCiAgICAgICAgTE9HLmluZm8oIktpbGxp\nbmcgQm9va2llIDoiICsgcmVwbGljYVRvS2lsbEFkZHIpOwogICAgICAgIGtp\nbGxCb29raWUocmVwbGljYVRvS2lsbEFkZHIpOwoKICAgICAgICAvLyB3YWl0\naW5nIHRvIHB1Ymxpc2ggdXJMZWRnZXIgem5vZGUgYnkgQXVkaXRvcgogICAg\nICAgIGxhdGNoLmF3YWl0KCk7CiAgICAgICAgbGF0Y2ggPSBuZXcgQ291bnRE\nb3duTGF0Y2goMSk7CiAgICAgICAgTE9HLmluZm8oIldhdGNoaW5nIG9uIHVy\nTGVkZ2VyUGF0aDoiICsgdXJMZWRnZXJaTm9kZQogICAgICAgICAgICAgICAg\nKyAiIHRvIGtub3cgdGhlIHN0YXR1cyBvZiByZXJlcGxpY2F0aW9uIHByb2Nl\nc3MiKTsKICAgICAgICBhc3NlcnROb3ROdWxsKCJVckxlZGdlciBkb2Vzbid0\nIGV4aXN0cyEiLAogICAgICAgICAgICAgICAgd2F0Y2hVckxlZGdlck5vZGUo\ndXJMZWRnZXJaTm9kZSwgbGF0Y2gpKTsKCiAgICAgICAgLy8gc3RhcnRpbmcg\ndGhlIHJlcGxpY2F0aW9uIHNlcnZpY2UsIHNvIHRoYXQgaGUgd2lsbCBiZSBh\nYmxlIHRvIGFjdCBhcwogICAgICAgIC8vIHRhcmdldCBib29raWUKICAgICAg\nICBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIGludCBuZXdCb29raWVJbmRl\neCA9IGJzLnNpemUoKSAtIDE7CiAgICAgICAgQm9va2llU2VydmVyIG5ld0Jv\nb2tpZVNlcnZlciA9IGJzLmdldChuZXdCb29raWVJbmRleCk7CgogICAgICAg\nIExPRy5kZWJ1ZygiV2FpdGluZyB0byBmaW5pc2ggdGhlIHJlcGxpY2F0aW9u\nIG9mIGZhaWxlZCBib29raWUgOiAiCiAgICAgICAgICAgICAgICArIHJlcGxp\nY2FUb0tpbGxBZGRyKTsKICAgICAgICBsYXRjaC5hd2FpdCgpOwoKICAgICAg\nICAvLyBncmFjZSBwZXJpb2QgdG8gdXBkYXRlIHRoZSB1cmxlZGdlciBtZXRh\nZGF0YSBpbiB6b29rZWVwZXIKICAgICAgICBMT0cuaW5mbygiV2FpdGluZyB0\nbyB1cGRhdGUgdGhlIHVybGVkZ2VyIG1ldGFkYXRhIGluIHpvb2tlZXBlciIp\nOwoKICAgICAgICB2ZXJpZnlMZWRnZXJFbnNlbWJsZU1ldGFkYXRhQWZ0ZXJS\nZXBsaWNhdGlvbihuZXdCb29raWVTZXJ2ZXIsCiAgICAgICAgICAgICAgICBs\naXN0T2ZMZWRnZXJIYW5kbGUuZ2V0KDApLCBsZWRnZXJSZXBsaWNhSW5kZXgp\nOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB2ZXJpZmllcyBwdWJsaXNo\nIHVyTGVkZ2VyIGJ5IEF1ZGl0b3IgYW5kIHJlcGxpY2F0aW9uIHdvcmtlciBp\ncwogICAgICogcGlja2luZyB1cCB0aGUgZW50cmllcyBhbmQgZmluaXNoaW5n\nIHRoZSByZXJlcGxpY2F0aW9uIG9mIGNsb3NlZCBsZWRnZXJzCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQgPSA5MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRl\nc3RDbG9zZWRMZWRnZXJzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nTGlzdDxJbnRlZ2VyPiBsaXN0T2ZSZXBsaWNhSW5kZXggPSBuZXcgQXJyYXlM\naXN0PEludGVnZXI+KCk7CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxp\nc3RPZkxlZGdlckhhbmRsZSA9IGNyZWF0ZUxlZGdlcnNBbmRBZGRFbnRyaWVz\nKDEsIDUpOwogICAgICAgIGNsb3NlTGVkZ2VycyhsaXN0T2ZMZWRnZXJIYW5k\nbGUpOwogICAgICAgIExlZGdlckhhbmRsZSBsaGFuZGxlID0gbGlzdE9mTGVk\nZ2VySGFuZGxlLmdldCgwKTsKICAgICAgICBpbnQgbGVkZ2VyUmVwbGljYUlu\nZGV4ID0gMDsKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIHJlcGxpY2FU\nb0tpbGxBZGRyID0gTGVkZ2VySGFuZGxlQWRhcHRlcgogICAgICAgICAgICAg\nICAgLmdldExlZGdlck1ldGFkYXRhKGxoYW5kbGUpLmdldEVuc2VtYmxlcygp\nLmdldCgwTCkuZ2V0KDApOwoKICAgICAgICBDb3VudERvd25MYXRjaCBsYXRj\naCA9IG5ldyBDb3VudERvd25MYXRjaChsaXN0T2ZMZWRnZXJIYW5kbGUuc2l6\nZSgpKTsKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6IGxpc3RPZkxl\nZGdlckhhbmRsZSkgewogICAgICAgICAgICBsZWRnZXJSZXBsaWNhSW5kZXgg\nPSBnZXRSZXBsaWNhSW5kZXhJbkxlZGdlcihsaCwgcmVwbGljYVRvS2lsbEFk\nZHIpOwogICAgICAgICAgICBsaXN0T2ZSZXBsaWNhSW5kZXguYWRkKGxlZGdl\nclJlcGxpY2FJbmRleCk7CiAgICAgICAgICAgIGFzc2VydE51bGwoIlVyTGVk\nZ2VyIGFscmVhZHkgZXhpc3RzISIsCiAgICAgICAgICAgICAgICAgICAgd2F0\nY2hVckxlZGdlck5vZGUoZ2V0VXJMZWRnZXJaTm9kZShsaCksIGxhdGNoKSk7\nCiAgICAgICAgfQoKICAgICAgICBMT0cuaW5mbygiS2lsbGluZyBCb29raWUg\nOiIgKyByZXBsaWNhVG9LaWxsQWRkcik7CiAgICAgICAga2lsbEJvb2tpZShy\nZXBsaWNhVG9LaWxsQWRkcik7CgogICAgICAgIC8vIHdhaXRpbmcgdG8gcHVi\nbGlzaCB1ckxlZGdlciB6bm9kZSBieSBBdWRpdG9yCiAgICAgICAgbGF0Y2gu\nYXdhaXQoKTsKCiAgICAgICAgLy8gQWdhaW4gd2F0Y2hpbmcgdGhlIHVyTGVk\nZ2VyIHpub2RlIHRvIGtub3cgdGhlIHJlcGxpY2F0aW9uIHN0YXR1cwogICAg\nICAgIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKGxpc3RPZkxlZGdlckhh\nbmRsZS5zaXplKCkpOwogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxoIDog\nbGlzdE9mTGVkZ2VySGFuZGxlKSB7CiAgICAgICAgICAgIFN0cmluZyB1ckxl\nZGdlclpOb2RlID0gZ2V0VXJMZWRnZXJaTm9kZShsaCk7CiAgICAgICAgICAg\nIExPRy5pbmZvKCJXYXRjaGluZyBvbiB1ckxlZGdlclBhdGg6IiArIHVyTGVk\nZ2VyWk5vZGUKICAgICAgICAgICAgICAgICAgICArICIgdG8ga25vdyB0aGUg\nc3RhdHVzIG9mIHJlcmVwbGljYXRpb24gcHJvY2VzcyIpOwogICAgICAgICAg\nICBhc3NlcnROb3ROdWxsKCJVckxlZGdlciBkb2Vzbid0IGV4aXN0cyEiLAog\nICAgICAgICAgICAgICAgICAgIHdhdGNoVXJMZWRnZXJOb2RlKHVyTGVkZ2Vy\nWk5vZGUsIGxhdGNoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBzdGFydGlu\nZyB0aGUgcmVwbGljYXRpb24gc2VydmljZSwgc28gdGhhdCBoZSB3aWxsIGJl\nIGFibGUgdG8gYWN0IGFzCiAgICAgICAgLy8gdGFyZ2V0IGJvb2tpZQogICAg\nICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgaW50IG5ld0Jvb2tpZUlu\nZGV4ID0gYnMuc2l6ZSgpIC0gMTsKICAgICAgICBCb29raWVTZXJ2ZXIgbmV3\nQm9va2llU2VydmVyID0gYnMuZ2V0KG5ld0Jvb2tpZUluZGV4KTsKCiAgICAg\nICAgTE9HLmRlYnVnKCJXYWl0aW5nIHRvIGZpbmlzaCB0aGUgcmVwbGljYXRp\nb24gb2YgZmFpbGVkIGJvb2tpZSA6ICIKICAgICAgICAgICAgICAgICsgcmVw\nbGljYVRvS2lsbEFkZHIpOwoKICAgICAgICAvLyB3YWl0aW5nIHRvIGZpbmlz\naCByZXBsaWNhdGlvbgogICAgICAgIGxhdGNoLmF3YWl0KCk7CgogICAgICAg\nIC8vIGdyYWNlIHBlcmlvZCB0byB1cGRhdGUgdGhlIHVybGVkZ2VyIG1ldGFk\nYXRhIGluIHpvb2tlZXBlcgogICAgICAgIExPRy5pbmZvKCJXYWl0aW5nIHRv\nIHVwZGF0ZSB0aGUgdXJsZWRnZXIgbWV0YWRhdGEgaW4gem9va2VlcGVyIik7\nCgogICAgICAgIGZvciAoaW50IGluZGV4ID0gMDsgaW5kZXggPCBsaXN0T2ZM\nZWRnZXJIYW5kbGUuc2l6ZSgpOyBpbmRleCsrKSB7CiAgICAgICAgICAgIHZl\ncmlmeUxlZGdlckVuc2VtYmxlTWV0YWRhdGFBZnRlclJlcGxpY2F0aW9uKG5l\nd0Jvb2tpZVNlcnZlciwKICAgICAgICAgICAgICAgICAgICBsaXN0T2ZMZWRn\nZXJIYW5kbGUuZ2V0KGluZGV4KSwKICAgICAgICAgICAgICAgICAgICBsaXN0\nT2ZSZXBsaWNhSW5kZXguZ2V0KGluZGV4KSk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdCBzdG9wcGluZyByZXBsaWNhIHNlcnZpY2Ug\nd2hpbGUgcmVwbGljYXRpb24gaW4gcHJvZ3Jlc3MuIENvbnNpZGVyaW5nCiAg\nICAgKiB3aGVuIHRoZXJlIGlzIGFuIGV4Y2VwdGlvbiB3aWxsIHNodXRkb3du\nIEF1ZGl0b3IgYW5kIFJXIHByb2Nlc3Nlcy4gQWZ0ZXIKICAgICAqIHJlc3Rh\ncnRpbmcgc2hvdWxkIGJlIGFibGUgdG8gZmluaXNoIHRoZSByZS1yZXBsaWNh\ndGlvbiBhY3Rpdml0aWVzCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA5\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTdG9wV2hpbGVSZXBsaWNhdGlv\nbkluUHJvZ3Jlc3MoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQg\nbnVtYmVyT2ZMZWRnZXJzID0gMjsKICAgICAgICBMaXN0PEludGVnZXI+IGxp\nc3RPZlJlcGxpY2FJbmRleCA9IG5ldyBBcnJheUxpc3Q8SW50ZWdlcj4oKTsK\nICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGlzdE9mTGVkZ2VySGFuZGxl\nID0gY3JlYXRlTGVkZ2Vyc0FuZEFkZEVudHJpZXMoCiAgICAgICAgICAgICAg\nICBudW1iZXJPZkxlZGdlcnMsIDUpOwogICAgICAgIGNsb3NlTGVkZ2Vycyhs\naXN0T2ZMZWRnZXJIYW5kbGUpOwogICAgICAgIExlZGdlckhhbmRsZSBoYW5k\nbGUgPSBsaXN0T2ZMZWRnZXJIYW5kbGUuZ2V0KDApOwogICAgICAgIEJvb2tp\nZVNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbEFkZHIgPSBMZWRnZXJIYW5k\nbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEo\naGFuZGxlKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKICAgICAg\nICBMT0cuaW5mbygiS2lsbGluZyBCb29raWU6IiArIHJlcGxpY2FUb0tpbGxB\nZGRyKTsKCiAgICAgICAgLy8gRWFjaCBsZWRnZXIsIHRoZXJlIHdpbGwgYmUg\ndHdvIGV2ZW50cyA6IGNyZWF0ZSB1ckxlZGdlciBhbmQgYWZ0ZXIKICAgICAg\nICAvLyByZXJlcGxpY2F0aW9uIGRlbGV0ZSB1ckxlZGdlcgogICAgICAgIENv\ndW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKGxpc3RP\nZkxlZGdlckhhbmRsZS5zaXplKCkpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbGlzdE9mTGVkZ2VySGFuZGxlLnNpemUoKTsgaSsrKSB7CiAgICAg\nICAgICAgIGZpbmFsIFN0cmluZyB1ckxlZGdlclpOb2RlID0gZ2V0VXJMZWRn\nZXJaTm9kZShsaXN0T2ZMZWRnZXJIYW5kbGUKICAgICAgICAgICAgICAgICAg\nICAuZ2V0KGkpKTsKICAgICAgICAgICAgYXNzZXJ0TnVsbCgiVXJMZWRnZXIg\nYWxyZWFkeSBleGlzdHMhIiwKICAgICAgICAgICAgICAgICAgICB3YXRjaFVy\nTGVkZ2VyTm9kZSh1ckxlZGdlclpOb2RlLCBsYXRjaCkpOwogICAgICAgICAg\nICBpbnQgcmVwbGljYUluZGV4SW5MZWRnZXIgPSBnZXRSZXBsaWNhSW5kZXhJ\nbkxlZGdlcigKICAgICAgICAgICAgICAgICAgICBsaXN0T2ZMZWRnZXJIYW5k\nbGUuZ2V0KGkpLCByZXBsaWNhVG9LaWxsQWRkcik7CiAgICAgICAgICAgIGxp\nc3RPZlJlcGxpY2FJbmRleC5hZGQocmVwbGljYUluZGV4SW5MZWRnZXIpOwog\nICAgICAgIH0KCiAgICAgICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llIDoi\nICsgcmVwbGljYVRvS2lsbEFkZHIpOwogICAgICAgIGtpbGxCb29raWUocmVw\nbGljYVRvS2lsbEFkZHIpOwoKICAgICAgICAvLyB3YWl0aW5nIHRvIHB1Ymxp\nc2ggdXJMZWRnZXIgem5vZGUgYnkgQXVkaXRvcgogICAgICAgIGxhdGNoLmF3\nYWl0KCk7CgogICAgICAgIC8vIEFnYWluIHdhdGNoaW5nIHRoZSB1ckxlZGdl\nciB6bm9kZSB0byBrbm93IHRoZSByZXBsaWNhdGlvbiBzdGF0dXMKICAgICAg\nICBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaChsaXN0T2ZMZWRnZXJIYW5k\nbGUuc2l6ZSgpKTsKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6IGxp\nc3RPZkxlZGdlckhhbmRsZSkgewogICAgICAgICAgICBTdHJpbmcgdXJMZWRn\nZXJaTm9kZSA9IGdldFVyTGVkZ2VyWk5vZGUobGgpOwogICAgICAgICAgICBM\nT0cuaW5mbygiV2F0Y2hpbmcgb24gdXJMZWRnZXJQYXRoOiIgKyB1ckxlZGdl\nclpOb2RlCiAgICAgICAgICAgICAgICAgICAgKyAiIHRvIGtub3cgdGhlIHN0\nYXR1cyBvZiByZXJlcGxpY2F0aW9uIHByb2Nlc3MiKTsKICAgICAgICAgICAg\nYXNzZXJ0Tm90TnVsbCgiVXJMZWRnZXIgZG9lc24ndCBleGlzdHMhIiwKICAg\nICAgICAgICAgICAgICAgICB3YXRjaFVyTGVkZ2VyTm9kZSh1ckxlZGdlclpO\nb2RlLCBsYXRjaCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gc3RhcnRpbmcg\ndGhlIHJlcGxpY2F0aW9uIHNlcnZpY2UsIHNvIHRoYXQgaGUgd2lsbCBiZSBh\nYmxlIHRvIGFjdCBhcwogICAgICAgIC8vIHRhcmdldCBib29raWUKICAgICAg\nICBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIGludCBuZXdCb29raWVJbmRl\neCA9IGJzLnNpemUoKSAtIDE7CiAgICAgICAgQm9va2llU2VydmVyIG5ld0Jv\nb2tpZVNlcnZlciA9IGJzLmdldChuZXdCb29raWVJbmRleCk7CgogICAgICAg\nIExPRy5kZWJ1ZygiV2FpdGluZyB0byBmaW5pc2ggdGhlIHJlcGxpY2F0aW9u\nIG9mIGZhaWxlZCBib29raWUgOiAiCiAgICAgICAgICAgICAgICArIHJlcGxp\nY2FUb0tpbGxBZGRyKTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAg\nICAgICBpZiAobGF0Y2guZ2V0Q291bnQoKSA8IG51bWJlck9mTGVkZ2VycyB8\nfCBsYXRjaC5nZXRDb3VudCgpIDw9IDApIHsKICAgICAgICAgICAgICAgIHN0\nb3BSZXBsaWNhdGlvblNlcnZpY2UoKTsKICAgICAgICAgICAgICAgIExPRy5p\nbmZvKCJMYXRjaCBDb3VudCBpczoiICsgbGF0Y2guZ2V0Q291bnQoKSk7CiAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAg\nICAvLyBncmFjZSBwZXJpb2QgdG8gdGFrZSBicmVhdGgKICAgICAgICAgICAg\nVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAgIH0KCiAgICAgICAgc3RhcnRS\nZXBsaWNhdGlvblNlcnZpY2UoKTsKCiAgICAgICAgTE9HLmluZm8oIldhaXRp\nbmcgdG8gZmluaXNoIHJlcmVwbGljYXRpb24gcHJvY2Vzc2VzIik7CiAgICAg\nICAgbGF0Y2guYXdhaXQoKTsKCiAgICAgICAgLy8gZ3JhY2UgcGVyaW9kIHRv\nIHVwZGF0ZSB0aGUgdXJsZWRnZXIgbWV0YWRhdGEgaW4gem9va2VlcGVyCiAg\nICAgICAgTE9HLmluZm8oIldhaXRpbmcgdG8gdXBkYXRlIHRoZSB1cmxlZGdl\nciBtZXRhZGF0YSBpbiB6b29rZWVwZXIiKTsKCiAgICAgICAgZm9yIChpbnQg\naW5kZXggPSAwOyBpbmRleCA8IGxpc3RPZkxlZGdlckhhbmRsZS5zaXplKCk7\nIGluZGV4KyspIHsKICAgICAgICAgICAgdmVyaWZ5TGVkZ2VyRW5zZW1ibGVN\nZXRhZGF0YUFmdGVyUmVwbGljYXRpb24obmV3Qm9va2llU2VydmVyLAogICAg\nICAgICAgICAgICAgICAgIGxpc3RPZkxlZGdlckhhbmRsZS5nZXQoaW5kZXgp\nLAogICAgICAgICAgICAgICAgICAgIGxpc3RPZlJlcGxpY2FJbmRleC5nZXQo\naW5kZXgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWZXJp\nZnkgdGhlIHB1Ymxpc2hlZCB1cmxlZGdlcnMgb2YgZGVsZXRlZCBsZWRnZXJz\nKHRob3NlIGxlZGdlcnMgd2hlcmUKICAgICAqIGRlbGV0ZWQgYWZ0ZXIgcHVi\nbGlzaGluZyBhcyB1cmxlZGdlcnMgYnkgQXVkaXRvcikgc2hvdWxkIGJlIGNs\nZWFyZWQgb2ZmCiAgICAgKiBieSB0aGUgbmV3bHkgc2VsZWN0ZWQgcmVwbGlj\nYSBib29raWUKICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDMwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdE5vU3VjaExlZGdlckV4aXN0cygpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaXN0\nT2ZMZWRnZXJIYW5kbGUgPSBjcmVhdGVMZWRnZXJzQW5kQWRkRW50cmllcygy\nLCA1KTsKICAgICAgICBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBDb3Vu\ndERvd25MYXRjaChsaXN0T2ZMZWRnZXJIYW5kbGUuc2l6ZSgpKTsKICAgICAg\nICBmb3IgKExlZGdlckhhbmRsZSBsaCA6IGxpc3RPZkxlZGdlckhhbmRsZSkg\newogICAgICAgICAgICBhc3NlcnROdWxsKCJVckxlZGdlciBhbHJlYWR5IGV4\naXN0cyEiLAogICAgICAgICAgICAgICAgICAgIHdhdGNoVXJMZWRnZXJOb2Rl\nKGdldFVyTGVkZ2VyWk5vZGUobGgpLCBsYXRjaCkpOwogICAgICAgIH0KICAg\nICAgICBCb29raWVTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGxBZGRyID0g\nTGVkZ2VySGFuZGxlQWRhcHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdl\nck1ldGFkYXRhKGxpc3RPZkxlZGdlckhhbmRsZS5nZXQoMCkpLmdldEVuc2Vt\nYmxlcygpCiAgICAgICAgICAgICAgICAuZ2V0KDBMKS5nZXQoMCk7CiAgICAg\nICAga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsQWRkcik7CiAgICAgICAgcmVw\nbGljYVRvS2lsbEFkZHIgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAg\nICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEobGlzdE9mTGVkZ2VySGFuZGxl\nLmdldCgwKSkuZ2V0RW5zZW1ibGVzKCkKICAgICAgICAgICAgICAgIC5nZXQo\nMEwpLmdldCgwKTsKICAgICAgICBraWxsQm9va2llKHJlcGxpY2FUb0tpbGxB\nZGRyKTsKICAgICAgICAvLyB3YWl0aW5nIHRvIHB1Ymxpc2ggdXJMZWRnZXIg\nem5vZGUgYnkgQXVkaXRvcgogICAgICAgIGxhdGNoLmF3YWl0KCk7CgogICAg\nICAgIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKGxpc3RPZkxlZGdlckhh\nbmRsZS5zaXplKCkpOwogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxoIDog\nbGlzdE9mTGVkZ2VySGFuZGxlKSB7CiAgICAgICAgICAgIGFzc2VydE5vdE51\nbGwoIlVyTGVkZ2VyIGRvZXNuJ3QgZXhpc3RzISIsCiAgICAgICAgICAgICAg\nICAgICAgd2F0Y2hVckxlZGdlck5vZGUoZ2V0VXJMZWRnZXJaTm9kZShsaCks\nIGxhdGNoKSk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWxldGUgbGVkZ2Vy\ncwogICAgICAgIGZvciAoTGVkZ2VySGFuZGxlIGxoIDogbGlzdE9mTGVkZ2Vy\nSGFuZGxlKSB7CiAgICAgICAgICAgIGJrYy5kZWxldGVMZWRnZXIobGguZ2V0\nSWQoKSk7CiAgICAgICAgfQogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7Cgog\nICAgICAgIC8vIHdhaXRpbmcgdG8gZGVsZXRlIHB1Ymxpc2hlZCB1cmxlZGdl\ncnMsIHNpbmNlIGl0IGRvZXNuJ3QgZXhpc3RzCiAgICAgICAgbGF0Y2guYXdh\naXQoKTsKCiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaXN0T2ZM\nZWRnZXJIYW5kbGUpIHsKICAgICAgICAgICAgYXNzZXJ0TnVsbCgiVXJMZWRn\nZXIgc3RpbGwgZXhpc3RzIGFmdGVyIHJlcmVwbGljYXRpb24iLAogICAgICAg\nICAgICAgICAgICAgIHdhdGNoVXJMZWRnZXJOb2RlKGdldFVyTGVkZ2VyWk5v\nZGUobGgpLCBsYXRjaCkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgdGhhdCBpZiBhIGVtcHR5IGxlZGdlciBsb3NlcyB0aGUgYm9v\na2llIG5vdCBpbiB0aGUgcXVvcnVtIGZvciBlbnRyeSAwLCBpdCB3aWxsCiAg\nICAgKiBzdGlsbCBiZSBvcGVuYWJsZSB3aGVuIGl0IGxvc2VzIGVub3VnaCBi\nb29raWVzIHRvIGxvc2UgYSB3aG9sZSBxdW9ydW0uCiAgICAgKi8KICAgIEBU\nZXN0KHRpbWVvdXQ9MTAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RW1wdHlM\nZWRnZXJMb3Nlc1F1b3J1bUV2ZW50dWFsbHkoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2Vy\nKDMsIDIsIDIsIERpZ2VzdFR5cGUuQ1JDMzIsIFBBU1NXRCk7CiAgICAgICAg\nQ291bnREb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7\nCiAgICAgICAgU3RyaW5nIHVyWk5vZGUgPSBnZXRVckxlZGdlclpOb2RlKGxo\nKTsKICAgICAgICB3YXRjaFVyTGVkZ2VyTm9kZSh1clpOb2RlLCBsYXRjaCk7\nCgogICAgICAgIEJvb2tpZVNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbCA9\nIExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgLmdldExlZGdlck1l\ndGFkYXRhKGxoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgyKTsKICAg\nICAgICBMT0cuaW5mbygiS2lsbGluZyBsYXN0IGJvb2tpZSwge30sIGluIGVu\nc2VtYmxlIHt9IiwgcmVwbGljYVRvS2lsbCwKICAgICAgICAgICAgICAgICBM\nZWRnZXJIYW5kbGVBZGFwdGVyLmdldExlZGdlck1ldGFkYXRhKGxoKS5nZXRF\nbnNlbWJsZXMoKS5nZXQoMEwpKTsKICAgICAgICBraWxsQm9va2llKHJlcGxp\nY2FUb0tpbGwpOwoKICAgICAgICBnZXRBdWRpdG9yKDEwLCBUaW1lVW5pdC5T\nRUNPTkRTKS5zdWJtaXRBdWRpdFRhc2soKS5nZXQoKTsgLy8gZW5zdXJlIGF1\nZGl0b3IgcnVucwoKICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgYmUgbWFy\na2VkIGFzIHVuZGVycmVwbGljYXRlZCIsIGxhdGNoLmF3YWl0KDUsIFRpbWVV\nbml0LlNFQ09ORFMpKTsKICAgICAgICBsYXRjaCA9IG5ldyBDb3VudERvd25M\nYXRjaCgxKTsKICAgICAgICBTdGF0IHMgPSB3YXRjaFVyTGVkZ2VyTm9kZSh1\nclpOb2RlLCBsYXRjaCk7IC8vIHNob3VsZCBiZSBtYXJrZWQgYXMgcmVwbGlj\nYXRlZAogICAgICAgIGlmIChzICE9IG51bGwpIHsKICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZSgiU2hvdWxkIGJlIG1hcmtlZCBhcyByZXBsaWNhdGVkIiwgbGF0\nY2guYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICB9Cgog\nICAgICAgIHJlcGxpY2FUb0tpbGwgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAg\nICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5zZW1ibGVz\nKCkuZ2V0KDBMKS5nZXQoMSk7CiAgICAgICAgTE9HLmluZm8oIktpbGxpbmcg\nc2Vjb25kIGJvb2tpZSwge30sIGluIGVuc2VtYmxlIHt9IiwgcmVwbGljYVRv\nS2lsbCwKICAgICAgICAgICAgICAgICBMZWRnZXJIYW5kbGVBZGFwdGVyLmdl\ndExlZGdlck1ldGFkYXRhKGxoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpKTsK\nICAgICAgICBraWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICBn\nZXRBdWRpdG9yKDEwLCBUaW1lVW5pdC5TRUNPTkRTKS5zdWJtaXRBdWRpdFRh\nc2soKS5nZXQoKTsgLy8gZW5zdXJlIGF1ZGl0b3IgcnVucwoKICAgICAgICBh\nc3NlcnRUcnVlKCJTaG91bGQgYmUgbWFya2VkIGFzIHVuZGVycmVwbGljYXRl\nZCIsIGxhdGNoLmF3YWl0KDUsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAg\nICBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBzID0g\nd2F0Y2hVckxlZGdlck5vZGUodXJaTm9kZSwgbGF0Y2gpOyAvLyBzaG91bGQg\nYmUgbWFya2VkIGFzIHJlcGxpY2F0ZWQKICAgICAgICBpZiAocyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBiZSBtYXJrZWQg\nYXMgcmVwbGljYXRlZCIsIGxhdGNoLmF3YWl0KDUsIFRpbWVVbml0LlNFQ09O\nRFMpKTsKICAgICAgICB9CgogICAgICAgIC8vIHNob3VsZCBiZSBhYmxlIHRv\nIG9wZW4gbGVkZ2VyIHdpdGhvdXQgaXNzdWUKICAgICAgICBia2Mub3Blbkxl\nZGdlcihsaC5nZXRJZCgpLCBEaWdlc3RUeXBlLkNSQzMyLCBQQVNTV0QpOwog\nICAgfQoKICAgIC8qKgogICAgICogVGVzdCB2ZXJpZmllcyBib29raWUgcmVj\nb3ZlcnksIHRoZSBob3N0IChyZWNvcmRlZCB2aWEgaXBhZGRyZXNzIGluCiAg\nICAgKiBsZWRnZXJtZXRhZGF0YSkKICAgICAqLwogICAgQFRlc3QodGltZW91\ndCA9IDkwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdExlZGdlck1ldGFkYXRh\nQ29udGFpbnNJcEFkZHJlc3NBc0Jvb2tpZUlEKCkKICAgICAgICAgICAgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3RvcEJLQ2x1c3RlcigpOwogICAg\nICAgIGJrYyA9IG5ldyBCb29rS2VlcGVyVGVzdENsaWVudChiYXNlQ2xpZW50\nQ29uZik7CiAgICAgICAgLy8gc3RhcnQgYm9va2llIHdpdGggdXNlSG9zdE5h\nbWVBc0Jvb2tpZUlEPWZhbHNlLCBhcyBvbGQgYm9va2llCiAgICAgICAgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBzZXJ2ZXJDb25mMSA9IG5ld1NlcnZlckNvbmZp\nZ3VyYXRpb24oKTsKICAgICAgICAvLyBzdGFydCAyIG1vcmUgYm9va2llcyB3\naXRoIHVzZUhvc3ROYW1lQXNCb29raWVJRD10cnVlCiAgICAgICAgU2VydmVy\nQ29uZmlndXJhdGlvbiBzZXJ2ZXJDb25mMiA9IG5ld1NlcnZlckNvbmZpZ3Vy\nYXRpb24oKTsKICAgICAgICBzZXJ2ZXJDb25mMi5zZXRVc2VIb3N0TmFtZUFz\nQm9va2llSUQodHJ1ZSk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBz\nZXJ2ZXJDb25mMyA9IG5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAg\nICBzZXJ2ZXJDb25mMy5zZXRVc2VIb3N0TmFtZUFzQm9va2llSUQodHJ1ZSk7\nCiAgICAgICAgYnNDb25mcy5hZGQoc2VydmVyQ29uZjEpOwogICAgICAgIGJz\nQ29uZnMuYWRkKHNlcnZlckNvbmYyKTsKICAgICAgICBic0NvbmZzLmFkZChz\nZXJ2ZXJDb25mMyk7CiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2llKHNlcnZl\nckNvbmYxKSk7CiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2llKHNlcnZlckNv\nbmYyKSk7CiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2llKHNlcnZlckNvbmYz\nKSk7CgogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaXN0T2ZMZWRnZXJI\nYW5kbGUgPSBjcmVhdGVMZWRnZXJzQW5kQWRkRW50cmllcygxLCA1KTsKICAg\nICAgICBMZWRnZXJIYW5kbGUgbGggPSBsaXN0T2ZMZWRnZXJIYW5kbGUuZ2V0\nKDApOwogICAgICAgIGludCBsZWRnZXJSZXBsaWNhSW5kZXggPSAwOwogICAg\nICAgIGZpbmFsIFNvcnRlZE1hcDxMb25nLCBBcnJheUxpc3Q8Qm9va2llU29j\na2V0QWRkcmVzcz4+IGVuc2VtYmxlcyA9IExlZGdlckhhbmRsZUFkYXB0ZXIK\nICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5z\nZW1ibGVzKCk7CiAgICAgICAgZmluYWwgQXJyYXlMaXN0PEJvb2tpZVNvY2tl\ndEFkZHJlc3M+IGJrQWRkcmVzc2VzID0gZW5zZW1ibGVzLmdldCgwTCk7CiAg\nICAgICAgQm9va2llU29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsQWRkciA9\nIGJrQWRkcmVzc2VzLmdldCgwKTsKICAgICAgICBmb3IgKEJvb2tpZVNvY2tl\ndEFkZHJlc3MgYm9va2llU29ja2V0QWRkcmVzcyA6IGJrQWRkcmVzc2VzKSB7\nCiAgICAgICAgICAgIGlmKCFpc0NyZWF0ZWRGcm9tSXAoYm9va2llU29ja2V0\nQWRkcmVzcykpewogICAgICAgICAgICAgICAgcmVwbGljYVRvS2lsbEFkZHIg\nPSBib29raWVTb2NrZXRBZGRyZXNzOwogICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIktpbGwgYm9va2llIHdoaWNoIGhhcyByZWdpc3RlcmVkIHVzaW5nIGhv\nc3RuYW1lIik7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgZmluYWwgU3RyaW5nIHVyTGVkZ2VyWk5v\nZGUgPSBnZXRVckxlZGdlclpOb2RlKGxoKTsKICAgICAgICBsZWRnZXJSZXBs\naWNhSW5kZXggPSBnZXRSZXBsaWNhSW5kZXhJbkxlZGdlcihsaCwgcmVwbGlj\nYVRvS2lsbEFkZHIpOwoKICAgICAgICBDb3VudERvd25MYXRjaCBsYXRjaCA9\nIG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBhc3NlcnROdWxsKCJV\nckxlZGdlciBhbHJlYWR5IGV4aXN0cyEiLAogICAgICAgICAgICAgICAgd2F0\nY2hVckxlZGdlck5vZGUodXJMZWRnZXJaTm9kZSwgbGF0Y2gpKTsKCiAgICAg\nICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llIDoiICsgcmVwbGljYVRvS2ls\nbEFkZHIpOwogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbEFkZHIp\nOwoKICAgICAgICAvLyB3YWl0aW5nIHRvIHB1Ymxpc2ggdXJMZWRnZXIgem5v\nZGUgYnkgQXVkaXRvcgogICAgICAgIGxhdGNoLmF3YWl0KCk7CiAgICAgICAg\nbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgTE9HLmlu\nZm8oIldhdGNoaW5nIG9uIHVyTGVkZ2VyUGF0aDoiICsgdXJMZWRnZXJaTm9k\nZQogICAgICAgICAgICAgICAgKyAiIHRvIGtub3cgdGhlIHN0YXR1cyBvZiBy\nZXJlcGxpY2F0aW9uIHByb2Nlc3MiKTsKICAgICAgICBhc3NlcnROb3ROdWxs\nKCJVckxlZGdlciBkb2Vzbid0IGV4aXN0cyEiLAogICAgICAgICAgICAgICAg\nd2F0Y2hVckxlZGdlck5vZGUodXJMZWRnZXJaTm9kZSwgbGF0Y2gpKTsKCiAg\nICAgICAgLy8gc3RhcnRpbmcgdGhlIHJlcGxpY2F0aW9uIHNlcnZpY2UsIHNv\nIHRoYXQgaGUgd2lsbCBiZSBhYmxlIHRvIGFjdCBhcwogICAgICAgIC8vIHRh\ncmdldCBib29raWUKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIHNlcnZl\nckNvbmYgPSBuZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgc2Vy\ndmVyQ29uZi5zZXRVc2VIb3N0TmFtZUFzQm9va2llSUQoZmFsc2UpOwogICAg\nICAgIGJzQ29uZnMuYWRkKHNlcnZlckNvbmYpOwogICAgICAgIGJzLmFkZChz\ndGFydEJvb2tpZShzZXJ2ZXJDb25mKSk7CgogICAgICAgIGludCBuZXdCb29r\naWVJbmRleCA9IGJzLnNpemUoKSAtIDE7CiAgICAgICAgQm9va2llU2VydmVy\nIG5ld0Jvb2tpZVNlcnZlciA9IGJzLmdldChuZXdCb29raWVJbmRleCk7Cgog\nICAgICAgIExPRy5kZWJ1ZygiV2FpdGluZyB0byBmaW5pc2ggdGhlIHJlcGxp\nY2F0aW9uIG9mIGZhaWxlZCBib29raWUgOiAiCiAgICAgICAgICAgICAgICAr\nIHJlcGxpY2FUb0tpbGxBZGRyKTsKICAgICAgICBsYXRjaC5hd2FpdCgpOwoK\nICAgICAgICAvLyBncmFjZSBwZXJpb2QgdG8gdXBkYXRlIHRoZSB1cmxlZGdl\nciBtZXRhZGF0YSBpbiB6b29rZWVwZXIKICAgICAgICBMT0cuaW5mbygiV2Fp\ndGluZyB0byB1cGRhdGUgdGhlIHVybGVkZ2VyIG1ldGFkYXRhIGluIHpvb2tl\nZXBlciIpOwoKICAgICAgICB2ZXJpZnlMZWRnZXJFbnNlbWJsZU1ldGFkYXRh\nQWZ0ZXJSZXBsaWNhdGlvbihuZXdCb29raWVTZXJ2ZXIsCiAgICAgICAgICAg\nICAgICBsaXN0T2ZMZWRnZXJIYW5kbGUuZ2V0KDApLCBsZWRnZXJSZXBsaWNh\nSW5kZXgpOwoKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdmVyaWZpZXMg\nYm9va2llIHJlY292ZXJ5LCB0aGUgaG9zdCAocmVjb3JkZWQgdmlhIHVzZUhv\nc3ROYW1lIGluCiAgICAgKiBsZWRnZXJtZXRhZGF0YSkKICAgICAqLwogICAg\nQFRlc3QodGltZW91dCA9IDkwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdExl\nZGdlck1ldGFkYXRhQ29udGFpbnNIb3N0TmFtZUFzQm9va2llSUQoKQogICAg\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdG9wQktDbHVz\ndGVyKCk7CgogICAgICAgIGJrYyA9IG5ldyBCb29rS2VlcGVyVGVzdENsaWVu\ndChiYXNlQ2xpZW50Q29uZik7CiAgICAgICAgLy8gc3RhcnQgYm9va2llIHdp\ndGggdXNlSG9zdE5hbWVBc0Jvb2tpZUlEPWZhbHNlLCBhcyBvbGQgYm9va2ll\nCiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBzZXJ2ZXJDb25mMSA9IG5l\nd1NlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICAvLyBzdGFydCAyIG1v\ncmUgYm9va2llcyB3aXRoIHVzZUhvc3ROYW1lQXNCb29raWVJRD10cnVlCiAg\nICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBzZXJ2ZXJDb25mMiA9IG5ld1Nl\ncnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICBzZXJ2ZXJDb25mMi5zZXRV\nc2VIb3N0TmFtZUFzQm9va2llSUQodHJ1ZSk7CiAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBzZXJ2ZXJDb25mMyA9IG5ld1NlcnZlckNvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICBzZXJ2ZXJDb25mMy5zZXRVc2VIb3N0TmFtZUFzQm9v\na2llSUQodHJ1ZSk7CiAgICAgICAgYnNDb25mcy5hZGQoc2VydmVyQ29uZjEp\nOwogICAgICAgIGJzQ29uZnMuYWRkKHNlcnZlckNvbmYyKTsKICAgICAgICBi\nc0NvbmZzLmFkZChzZXJ2ZXJDb25mMyk7CiAgICAgICAgYnMuYWRkKHN0YXJ0\nQm9va2llKHNlcnZlckNvbmYxKSk7CiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9v\na2llKHNlcnZlckNvbmYyKSk7CiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2ll\nKHNlcnZlckNvbmYzKSk7CgogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBs\naXN0T2ZMZWRnZXJIYW5kbGUgPSBjcmVhdGVMZWRnZXJzQW5kQWRkRW50cmll\ncygxLCA1KTsKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBsaXN0T2ZMZWRn\nZXJIYW5kbGUuZ2V0KDApOwogICAgICAgIGludCBsZWRnZXJSZXBsaWNhSW5k\nZXggPSAwOwogICAgICAgIGZpbmFsIFNvcnRlZE1hcDxMb25nLCBBcnJheUxp\nc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4+IGVuc2VtYmxlcyA9IExlZGdlckhh\nbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0\nYShsaCkuZ2V0RW5zZW1ibGVzKCk7CiAgICAgICAgZmluYWwgQXJyYXlMaXN0\nPEJvb2tpZVNvY2tldEFkZHJlc3M+IGJrQWRkcmVzc2VzID0gZW5zZW1ibGVz\nLmdldCgwTCk7CiAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyByZXBsaWNh\nVG9LaWxsQWRkciA9IGJrQWRkcmVzc2VzLmdldCgwKTsKICAgICAgICBmb3Ig\nKEJvb2tpZVNvY2tldEFkZHJlc3MgYm9va2llU29ja2V0QWRkcmVzcyA6IGJr\nQWRkcmVzc2VzKSB7CiAgICAgICAgICAgIGlmIChpc0NyZWF0ZWRGcm9tSXAo\nYm9va2llU29ja2V0QWRkcmVzcykpIHsKICAgICAgICAgICAgICAgIHJlcGxp\nY2FUb0tpbGxBZGRyID0gYm9va2llU29ja2V0QWRkcmVzczsKICAgICAgICAg\nICAgICAgIExPRy5pbmZvKCJLaWxsIGJvb2tpZSB3aGljaCBoYXMgcmVnaXN0\nZXJlZCB1c2luZyBpcGFkZHJlc3MiKTsKICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmaW5hbCBTdHJp\nbmcgdXJMZWRnZXJaTm9kZSA9IGdldFVyTGVkZ2VyWk5vZGUobGgpOwogICAg\nICAgIGxlZGdlclJlcGxpY2FJbmRleCA9IGdldFJlcGxpY2FJbmRleEluTGVk\nZ2VyKGxoLCByZXBsaWNhVG9LaWxsQWRkcik7CgogICAgICAgIENvdW50RG93\nbkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAg\nIGFzc2VydE51bGwoIlVyTGVkZ2VyIGFscmVhZHkgZXhpc3RzISIsCiAgICAg\nICAgICAgICAgICB3YXRjaFVyTGVkZ2VyTm9kZSh1ckxlZGdlclpOb2RlLCBs\nYXRjaCkpOwoKICAgICAgICBMT0cuaW5mbygiS2lsbGluZyBCb29raWUgOiIg\nKyByZXBsaWNhVG9LaWxsQWRkcik7CiAgICAgICAga2lsbEJvb2tpZShyZXBs\naWNhVG9LaWxsQWRkcik7CgogICAgICAgIC8vIHdhaXRpbmcgdG8gcHVibGlz\naCB1ckxlZGdlciB6bm9kZSBieSBBdWRpdG9yCiAgICAgICAgbGF0Y2guYXdh\naXQoKTsKICAgICAgICBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsK\nICAgICAgICBMT0cuaW5mbygiV2F0Y2hpbmcgb24gdXJMZWRnZXJQYXRoOiIg\nKyB1ckxlZGdlclpOb2RlCiAgICAgICAgICAgICAgICArICIgdG8ga25vdyB0\naGUgc3RhdHVzIG9mIHJlcmVwbGljYXRpb24gcHJvY2VzcyIpOwogICAgICAg\nIGFzc2VydE5vdE51bGwoIlVyTGVkZ2VyIGRvZXNuJ3QgZXhpc3RzISIsCiAg\nICAgICAgICAgICAgICB3YXRjaFVyTGVkZ2VyTm9kZSh1ckxlZGdlclpOb2Rl\nLCBsYXRjaCkpOwoKICAgICAgICAvLyBjcmVhdGVzIG5ldyBia2NsaWVudAog\nICAgICAgIGJrYyA9IG5ldyBCb29rS2VlcGVyVGVzdENsaWVudChiYXNlQ2xp\nZW50Q29uZik7CiAgICAgICAgLy8gc3RhcnRpbmcgdGhlIHJlcGxpY2F0aW9u\nIHNlcnZpY2UsIHNvIHRoYXQgaGUgd2lsbCBiZSBhYmxlIHRvIGFjdCBhcwog\nICAgICAgIC8vIHRhcmdldCBib29raWUKICAgICAgICBTZXJ2ZXJDb25maWd1\ncmF0aW9uIHNlcnZlckNvbmYgPSBuZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCk7\nCiAgICAgICAgc2VydmVyQ29uZi5zZXRVc2VIb3N0TmFtZUFzQm9va2llSUQo\ndHJ1ZSk7CiAgICAgICAgYnNDb25mcy5hZGQoc2VydmVyQ29uZik7CiAgICAg\nICAgYnMuYWRkKHN0YXJ0Qm9va2llKHNlcnZlckNvbmYpKTsKCiAgICAgICAg\naW50IG5ld0Jvb2tpZUluZGV4ID0gYnMuc2l6ZSgpIC0gMTsKICAgICAgICBC\nb29raWVTZXJ2ZXIgbmV3Qm9va2llU2VydmVyID0gYnMuZ2V0KG5ld0Jvb2tp\nZUluZGV4KTsKCiAgICAgICAgTE9HLmRlYnVnKCJXYWl0aW5nIHRvIGZpbmlz\naCB0aGUgcmVwbGljYXRpb24gb2YgZmFpbGVkIGJvb2tpZSA6ICIKICAgICAg\nICAgICAgICAgICsgcmVwbGljYVRvS2lsbEFkZHIpOwogICAgICAgIGxhdGNo\nLmF3YWl0KCk7CgogICAgICAgIC8vIGdyYWNlIHBlcmlvZCB0byB1cGRhdGUg\ndGhlIHVybGVkZ2VyIG1ldGFkYXRhIGluIHpvb2tlZXBlcgogICAgICAgIExP\nRy5pbmZvKCJXYWl0aW5nIHRvIHVwZGF0ZSB0aGUgdXJsZWRnZXIgbWV0YWRh\ndGEgaW4gem9va2VlcGVyIik7CgogICAgICAgIHZlcmlmeUxlZGdlckVuc2Vt\nYmxlTWV0YWRhdGFBZnRlclJlcGxpY2F0aW9uKG5ld0Jvb2tpZVNlcnZlciwK\nICAgICAgICAgICAgICAgIGxpc3RPZkxlZGdlckhhbmRsZS5nZXQoMCksIGxl\nZGdlclJlcGxpY2FJbmRleCk7CgogICAgfQoKICAgIHByaXZhdGUgaW50IGdl\ndFJlcGxpY2FJbmRleEluTGVkZ2VyKExlZGdlckhhbmRsZSBsaCwKIEJvb2tp\nZVNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbCkgewogICAgICAgIFNvcnRl\nZE1hcDxMb25nLCBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4+IGVu\nc2VtYmxlcyA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAg\nIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5zZW1ibGVzKCk7CiAgICAg\nICAgaW50IGxlZGdlclJlcGxpY2FJbmRleCA9IC0xOwogICAgICAgIGZvciAo\nQm9va2llU29ja2V0QWRkcmVzcyBhZGRyIDogZW5zZW1ibGVzLmdldCgwTCkp\nIHsKICAgICAgICAgICAgKytsZWRnZXJSZXBsaWNhSW5kZXg7CiAgICAgICAg\nICAgIGlmIChhZGRyLmVxdWFscyhyZXBsaWNhVG9LaWxsKSkgewogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGxlZGdlclJlcGxpY2FJbmRleDsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgdmVyaWZ5TGVkZ2VyRW5zZW1ibGVNZXRhZGF0YUFmdGVyUmVw\nbGljYXRpb24oCiAgICAgICAgICAgIEJvb2tpZVNlcnZlciBuZXdCb29raWVT\nZXJ2ZXIsIExlZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgaW50IGxlZGdl\nclJlcGxpY2FJbmRleCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVk\nZ2VySGFuZGxlIG9wZW5MZWRnZXIgPSBia2MKICAgICAgICAgICAgICAgIC5v\ncGVuTGVkZ2VyKGxoLmdldElkKCksIGRpZ2VzdFR5cGUsIFBBU1NXRCk7Cgog\nICAgICAgIEJvb2tpZVNvY2tldEFkZHJlc3MgaW5ldFNvY2tldEFkZHJlc3Mg\nPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVk\nZ2VyTWV0YWRhdGEob3BlbkxlZGdlcikuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBM\nKQogICAgICAgICAgICAgICAgLmdldChsZWRnZXJSZXBsaWNhSW5kZXgpOwog\nICAgICAgIGFzc2VydEVxdWFscygiUmVyZXBsaWNhdGlvbiBoYXMgYmVlbiBm\nYWlsZWQgYW5kIGxlZGdlclJlcGxpY2FJbmRleCA6IgogICAgICAgICAgICAg\nICAgKyBsZWRnZXJSZXBsaWNhSW5kZXgsIG5ld0Jvb2tpZVNlcnZlci5nZXRM\nb2NhbEFkZHJlc3MoKSwKICAgICAgICAgICAgICAgIGluZXRTb2NrZXRBZGRy\nZXNzKTsKICAgICAgICBvcGVuTGVkZ2VyLmNsb3NlKCk7CiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIGNsb3NlTGVkZ2VycyhMaXN0PExlZGdlckhhbmRsZT4g\nbGlzdE9mTGVkZ2VySGFuZGxlKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBmb3IgKExl\nZGdlckhhbmRsZSBsaCA6IGxpc3RPZkxlZGdlckhhbmRsZSkgewogICAgICAg\nICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIExpc3Q8TGVkZ2VySGFuZGxlPiBjcmVhdGVMZWRnZXJzQW5kQWRkRW50cmll\ncyhpbnQgbnVtYmVyT2ZMZWRnZXJzLAogICAgICAgICAgICBpbnQgbnVtYmVy\nT2ZFbnRyaWVzKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJLRXhj\nZXB0aW9uIHsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGlzdE9mTGVk\nZ2VySGFuZGxlID0gbmV3IEFycmF5TGlzdDxMZWRnZXJIYW5kbGU+KAogICAg\nICAgICAgICAgICAgbnVtYmVyT2ZMZWRnZXJzKTsKICAgICAgICBmb3IgKGlu\ndCBpbmRleCA9IDA7IGluZGV4IDwgbnVtYmVyT2ZMZWRnZXJzOyBpbmRleCsr\nKSB7CiAgICAgICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVM\nZWRnZXIoMywgMywgZGlnZXN0VHlwZSwgUEFTU1dEKTsKICAgICAgICAgICAg\nbGlzdE9mTGVkZ2VySGFuZGxlLmFkZChsaCk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgbnVtYmVyT2ZFbnRyaWVzOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBsaXN0T2ZMZWRnZXJIYW5kbGU7CiAg\nICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0VXJMZWRnZXJaTm9kZShMZWRn\nZXJIYW5kbGUgbGgpIHsKICAgICAgICByZXR1cm4gWmtMZWRnZXJVbmRlcnJl\ncGxpY2F0aW9uTWFuYWdlci5nZXRVckxlZGdlclpub2RlKAogICAgICAgICAg\nICAgICAgVU5ERVJSRVBMSUNBVEVEX1BBVEgsIGxoLmdldElkKCkpOwogICAg\nfQoKICAgIHByaXZhdGUgU3RhdCB3YXRjaFVyTGVkZ2VyTm9kZShmaW5hbCBT\ndHJpbmcgem5vZGUsCiAgICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNo\nIGxhdGNoKSB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLAogICAgICAgICAgICBJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHprYy5leGlz\ndHMoem5vZGUsIG5ldyBXYXRjaGVyKCkgewogICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZl\nbnQgZXZlbnQpIHsKICAgICAgICAgICAgICAgIGlmIChldmVudC5nZXRUeXBl\nKCkgPT0gRXZlbnRUeXBlLk5vZGVEZWxldGVkKSB7CiAgICAgICAgICAgICAg\nICAgICAgTE9HLmluZm8oIlJlY2lldmVkIExlZGdlciByZXJlcGxpY2F0aW9u\nIGNvbXBsZXRpb24gZXZlbnQgOiIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgZXZlbnQuZ2V0VHlwZSgpKTsKICAgICAgICAgICAgICAgICAgICBs\nYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGlmIChldmVudC5nZXRUeXBlKCkgPT0gRXZlbnRUeXBlLk5vZGVD\ncmVhdGVkKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlJlY2ll\ndmVkIHVyTGVkZ2VyIHB1Ymxpc2hpbmcgZXZlbnQgOiIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgZXZlbnQuZ2V0VHlwZSgpKTsKICAgICAgICAg\nICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgfQp9Cg==\n","encoding":"base64"}

