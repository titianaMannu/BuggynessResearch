{"sha":"ff1bb0f0574c6b18e8d3d5b3c748606b397c6729","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmYxYmIwZjA1NzRjNmIxOGU4ZDNkNWIzYzc0ODYwNmIzOTdjNjcyOQ==","size":29072,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ff1bb0f0574c6b18e8d3d5b3c748606b397c6729","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRp\nb247CgppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1\nYWxzOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RmFs\nc2U7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRUcnVl\nOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuZmFpbDsKCmltcG9y\ndCBqYXZhLm5pby5jaGFyc2V0LkNoYXJzZXQ7CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRv\ncjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNl\ndDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNhbGxhYmxlOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvclNlcnZpY2U7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5GdXR1cmU7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLlRpbWVvdXRFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5hdG9taWMuQXRvbWljQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5UZXN0QktDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2Vy\nTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nbWV0YS5MZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLlprTGVkZ2VyVW5kZXJyZXBsaWNh\ndGlvbk1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uRGF0YUZvcm1hdHMuVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0Owpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJlcGxp\nY2F0aW9uRXhjZXB0aW9uLkNvbXBhdGliaWxpdHlFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRp\nb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIudGVzdC5ab29LZWVwZXJVdGlsOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuQm9va0tlZXBlckNvbnN0YW50\nczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlprVXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuem9va2VlcGVyLlpvb0tl\nZXBlcldhdGNoZXJCYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmxh\nbmcuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5L\nZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5X\nYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRj\naGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVu\ndC5FdmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29L\nZWVwZXI7CmltcG9ydCBvcmcuanVuaXQuQWZ0ZXI7CmltcG9ydCBvcmcuanVu\naXQuQmVmb3JlOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7\nCgppbXBvcnQgY29tLmdvb2dsZS5wcm90b2J1Zi5UZXh0Rm9ybWF0OwoKLyoq\nCiAqIFRlc3QgdGhlIHpvb2tlZXBlciBpbXBsZW1lbnRhdGlvbiBvZiB0aGUg\nbGVkZ2VyIHJlcGxpY2F0aW9uIG1hbmFnZXIKICovCnB1YmxpYyBjbGFzcyBU\nZXN0TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgewogICAgc3RhdGlj\nIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihU\nZXN0TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIuY2xhc3MpOwoKICAg\nIFpvb0tlZXBlclV0aWwgemtVdGlsID0gbnVsbDsKCiAgICBTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYgPSBudWxsOwogICAgRXhlY3V0b3JTZXJ2aWNlIGV4\nZWN1dG9yID0gbnVsbDsKICAgIExlZGdlck1hbmFnZXJGYWN0b3J5IGxtZjEg\nPSBudWxsOwogICAgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbG1mMiA9IG51bGw7\nCiAgICBab29LZWVwZXIgemtjMSA9IG51bGw7CiAgICBab29LZWVwZXIgemtj\nMiA9IG51bGw7CgogICAgU3RyaW5nIGJhc2VQYXRoOwogICAgU3RyaW5nIHVy\nTGVkZ2VyUGF0aDsKICAgIGJvb2xlYW4gaXNMZWRnZXJSZXBsaWNhdGlvbkRp\nc2FibGVkID0gdHJ1ZTsKCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBz\nZXR1cFpvb0tlZXBlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHpr\nVXRpbCA9IG5ldyBab29LZWVwZXJVdGlsKCk7CiAgICAgICAgemtVdGlsLnN0\nYXJ0U2VydmVyKCk7CgogICAgICAgIGNvbmYgPSBUZXN0QktDb25maWd1cmF0\naW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKS5zZXRaa1NlcnZlcnMoemtV\ndGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CgogICAgICAgIGV4\nZWN1dG9yID0gRXhlY3V0b3JzLm5ld0NhY2hlZFRocmVhZFBvb2woKTsKCiAg\nICAgICAgWm9vS2VlcGVyV2F0Y2hlckJhc2UgdyA9IG5ldyBab29LZWVwZXJX\nYXRjaGVyQmFzZSgxMDAwMCk7CiAgICAgICAgemtjMSA9IFprVXRpbHMuY3Jl\nYXRlQ29ubmVjdGVkWm9va2VlcGVyQ2xpZW50KAogICAgICAgICAgICAgICAg\nemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSwgdyk7CiAgICAg\nICAgdyA9IG5ldyBab29LZWVwZXJXYXRjaGVyQmFzZSgxMDAwMCk7CiAgICAg\nICAgemtjMiA9IFprVXRpbHMuY3JlYXRlQ29ubmVjdGVkWm9va2VlcGVyQ2xp\nZW50KAogICAgICAgICAgICAgICAgemtVdGlsLmdldFpvb0tlZXBlckNvbm5l\nY3RTdHJpbmcoKSwgdyk7CiAgICAgICAgbG1mMSA9IExlZGdlck1hbmFnZXJG\nYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGNvbmYsIHprYzEpOwog\nICAgICAgIGxtZjIgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRnZXJN\nYW5hZ2VyRmFjdG9yeShjb25mLCB6a2MyKTsKICAgICAgICBiYXNlUGF0aCA9\nIGNvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICcvJwogICAgICAgICAg\nICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlVOREVSX1JFUExJQ0FUSU9O\nX05PREU7CiAgICAgICAgdXJMZWRnZXJQYXRoID0gYmFzZVBhdGgKICAgICAg\nICAgICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5ERUZBVUxUX1pLX0xF\nREdFUlNfUk9PVF9QQVRIOwogICAgfQoKICAgIEBBZnRlcgogICAgcHVibGlj\nIHZvaWQgdGVhcmRvd25ab29LZWVwZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBpZiAoemtVdGlsICE9IG51bGwpIHsKICAgICAgICAgICAgemtV\ndGlsLmtpbGxTZXJ2ZXIoKTsKICAgICAgICAgICAgemtVdGlsID0gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgaWYgKGV4ZWN1dG9yICE9IG51bGwpIHsKICAg\nICAgICAgICAgZXhlY3V0b3IgPSBudWxsOwogICAgICAgIH0KICAgICAgICBp\nZiAoemtjMSAhPSBudWxsKSB7CiAgICAgICAgICAgIHprYzEuY2xvc2UoKTsK\nICAgICAgICAgICAgemtjMSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGlm\nICh6a2MyICE9IG51bGwpIHsKICAgICAgICAgICAgemtjMi5jbG9zZSgpOwog\nICAgICAgICAgICB6a2MyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYg\nKGxtZjEgIT0gbnVsbCkgewogICAgICAgICAgICBsbWYxLnVuaW5pdGlhbGl6\nZSgpOwogICAgICAgICAgICBsbWYxID0gbnVsbDsKICAgICAgICB9CiAgICAg\nICAgaWYgKGxtZjIgIT0gbnVsbCkgewogICAgICAgICAgICBsbWYyLnVuaW5p\ndGlhbGl6ZSgpOwogICAgICAgICAgICBsbWYyID0gbnVsbDsKICAgICAgICB9\nCiAgICB9CgogICAgcHJpdmF0ZSBGdXR1cmU8TG9uZz4gZ2V0TGVkZ2VyVG9S\nZXBsaWNhdGUoZmluYWwgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIg\nbSkgewogICAgICAgIHJldHVybiBleGVjdXRvci5zdWJtaXQobmV3IENhbGxh\nYmxlPExvbmc+KCkgewogICAgICAgICAgICAgICAgcHVibGljIExvbmcgY2Fs\nbCgpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbS5nZXRMZWRnZXJUb1JlcmVwbGljYXRlKCk7\nCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBnZXR0\naW5nIGxlZGdlciBpZCIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gLTFMOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\nZXN0IGJhc2ljIGludGVyYWN0aW9ucyB3aXRoIHRoZSBsZWRnZXIgdW5kZXJy\nZXBsaWNhdGlvbgogICAgICogbWFuYWdlci4KICAgICAqIE1hcmsgc29tZSBs\nZWRnZXJzIGFzIHVuZGVycmVwbGljYXRlZC4KICAgICAqIEVuc3VyZSB0aGF0\nIGdldExlZGdlclRvUmVwbGljYXRlIHdpbGwgYmxvY2sgdW50aWwgaXQgYSBs\nZWRnZXIKICAgICAqIGJlY29tZXMgYXZhaWxhYmxlLgogICAgICovCiAgICBA\nVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEJhc2lj\nSW50ZXJhY3Rpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTZXQ8\nTG9uZz4gbGVkZ2VycyA9IG5ldyBIYXNoU2V0PExvbmc+KCk7CiAgICAgICAg\nbGVkZ2Vycy5hZGQoMHhkZWFkYmVlZkwpOwogICAgICAgIGxlZGdlcnMuYWRk\nKDB4YmVlZmNhZmVMKTsKICAgICAgICBsZWRnZXJzLmFkZCgweGZmZmZiZWVm\nTCk7CiAgICAgICAgbGVkZ2Vycy5hZGQoMHhmYWNlYmVlZkwpOwogICAgICAg\nIFN0cmluZyBtaXNzaW5nUmVwbGljYSA9ICJsb2NhbGhvc3Q6MzE4MSI7Cgog\nICAgICAgIGludCBjb3VudCA9IDA7CiAgICAgICAgTGVkZ2VyVW5kZXJyZXBs\naWNhdGlvbk1hbmFnZXIgbSA9IGxtZjEubmV3TGVkZ2VyVW5kZXJyZXBsaWNh\ndGlvbk1hbmFnZXIoKTsKICAgICAgICBJdGVyYXRvcjxMb25nPiBpdGVyID0g\nbGVkZ2Vycy5pdGVyYXRvcigpOwogICAgICAgIHdoaWxlIChpdGVyLmhhc05l\neHQoKSkgewogICAgICAgICAgICBtLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0\nZWQoaXRlci5uZXh0KCksIG1pc3NpbmdSZXBsaWNhKTsKICAgICAgICAgICAg\nY291bnQrKzsKICAgICAgICB9CgogICAgICAgIExpc3Q8RnV0dXJlPExvbmc+\nPiBmdXR1cmVzID0gbmV3IEFycmF5TGlzdDxGdXR1cmU8TG9uZz4+KCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAg\nICAgICAgIGZ1dHVyZXMuYWRkKGdldExlZGdlclRvUmVwbGljYXRlKG0pKTsK\nICAgICAgICB9CgogICAgICAgIGZvciAoRnV0dXJlPExvbmc+IGYgOiBmdXR1\ncmVzKSB7CiAgICAgICAgICAgIExvbmcgbCA9IGYuZ2V0KDUsIFRpbWVVbml0\nLlNFQ09ORFMpOwogICAgICAgICAgICBhc3NlcnRUcnVlKGxlZGdlcnMucmVt\nb3ZlKGwpKTsKICAgICAgICB9CgogICAgICAgIEZ1dHVyZTxMb25nPiBmID0g\nZ2V0TGVkZ2VyVG9SZXBsaWNhdGUobSk7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgZi5nZXQoMSwgVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgICAg\nIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIGZpbmQgYSBsZWRnZXIgdG8g\ncmVwbGljYXRlIik7CiAgICAgICAgfSBjYXRjaCAoVGltZW91dEV4Y2VwdGlv\nbiB0ZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAg\nICAgIH0KICAgICAgICBMb25nIG5ld2wgPSAweGZlZmVmZWZlZmVmZUw7CiAg\nICAgICAgbS5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKG5ld2wsIG1pc3Np\nbmdSZXBsaWNhKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBoYXZl\nIGdvdCB0aGUgb25lIGp1c3QgYWRkZWQiLCBuZXdsLCBmLmdldCg1LCBUaW1l\nVW5pdC5TRUNPTkRTKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IGxv\nY2tpbmcgZm9yIGxlZGdlciB1bnJlcGxpY2F0aW9uIG1hbmFnZXIuCiAgICAg\nKiBJZiB0aGVyZSdzIG9ubHkgb25lIGxlZGdlciBtYXJrZWQgZm9yIHJlcmVw\nbGljYXRpb24sCiAgICAgKiBhbmQgb25lIGNsaWVudCBoYXMgaXQsIGl0IHNo\nb3VsZCBiZSBsb2NrZWQ7IGFub3RoZXIKICAgICAqIGNsaWVudCBzaG91bGRu\nJ3QgYmUgYWJsZSB0byBnZXQgaXQuIElmIHRoZSBmaXJzdCBjbGllbnQgZGll\ncwogICAgICogaG93ZXZlciwgdGhlIHNlY29uZCBjbGllbnQgc2hvdWxkIGJl\nIGFibGUgdG8gZ2V0IGl0LgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdExvY2tpbmcoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgbWlzc2luZ1JlcGxpY2EgPSAibG9j\nYWxob3N0OjMxODEiOwoKICAgICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9u\nTWFuYWdlciBtMSA9IGxtZjEubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1h\nbmFnZXIoKTsKICAgICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdl\nciBtMiA9IGxtZjIubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIo\nKTsKCiAgICAgICAgTG9uZyBsZWRnZXIgPSAweGZlYWRlZWZkYWNMOwogICAg\nICAgIG0xLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGVkZ2VyLCBtaXNz\naW5nUmVwbGljYSk7CiAgICAgICAgRnV0dXJlPExvbmc+IGYgPSBnZXRMZWRn\nZXJUb1JlcGxpY2F0ZShtMSk7CiAgICAgICAgTG9uZyBsID0gZi5nZXQoNSwg\nVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91\nbGQgYmUgdGhlIGxlZGdlciBJIGp1c3QgbWFya2VkIiwgbGVkZ2VyLCBsKTsK\nCiAgICAgICAgZiA9IGdldExlZGdlclRvUmVwbGljYXRlKG0yKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBmLmdldCgxLCBUaW1lVW5pdC5TRUNPTkRT\nKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gZmlu\nZCBhIGxlZGdlciB0byByZXBsaWNhdGUiKTsKICAgICAgICB9IGNhdGNoIChU\naW1lb3V0RXhjZXB0aW9uIHRlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3Qg\nYmVoYXZpb3VyCiAgICAgICAgfQogICAgICAgIHprYzEuY2xvc2UoKTsgLy8g\nc2hvdWxkIGtpbGwgdGhlIGxvY2sKICAgICAgICB6a2MxID0gbnVsbDsKCiAg\nICAgICAgbCA9IGYuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAg\nIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIHRoZSBsZWRnZXIgSSBtYXJrZWQi\nLCBsZWRnZXIsIGwpOwogICAgfQoKCiAgICAvKioKICAgICAqIFRlc3QgdGhh\ndCB3aGVuIGEgbGVkZ2VyIGhhcyBiZWVuIG1hcmtlZCBhcyByZXBsaWNhdGVk\nLCBpdAogICAgICogd2lsbCBub3QgYmUgb2ZmZXJlZCB0byBhbnRoZXIgY2xp\nZW50LgogICAgICogVGhpcyB0ZXN0IGNoZWNrZWQgdGhhdCBieSBtYXJraW5n\nIHR3byBsZWRnZXJzLCBhbmQgYWNxdWlyaW5nCiAgICAgKiB0aGVtIG9uIGEg\nc2luZ2xlIGNsaWVudC4gSXQgbWFya3Mgb25lIGFzIHJlcGxpY2F0ZWQgYW5k\nIHRoZW4KICAgICAqIHRoZSBjbGllbnQgaXMga2lsbGVkLiBXZSB0aGVuIGNo\nZWNrIHRoYXQgYW5vdGhlciBjbGllbnQgY2FuCiAgICAgKiBhY3F1aXJlIGEg\nbGVkZ2VyLCBhbmQgdGhhdCBpdCdzIG5vdCB0aGUgb25lIHRoYXQgd2FzIHBy\nZXZpb3VzbHkKICAgICAqIG1hcmtlZCBhcyByZXBsaWNhdGVkLgogICAgICov\nCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndE1hcmtpbmdBc1JlcGxpY2F0ZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBTdHJpbmcgbWlzc2luZ1JlcGxpY2EgPSAibG9jYWxob3N0OjMxODEi\nOwoKICAgICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtMSA9\nIGxtZjEubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAg\nICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtMiA9IGxtZjIu\nbmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAg\nTG9uZyBsZWRnZXJBID0gMHhmZWFkZWVmZGFjTDsKICAgICAgICBMb25nIGxl\nZGdlckIgPSAweGRlZmFkZWJMOwogICAgICAgIG0xLm1hcmtMZWRnZXJVbmRl\ncnJlcGxpY2F0ZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2EpOwogICAgICAg\nIG0xLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGVkZ2VyQiwgbWlzc2lu\nZ1JlcGxpY2EpOwoKICAgICAgICBGdXR1cmU8TG9uZz4gZkEgPSBnZXRMZWRn\nZXJUb1JlcGxpY2F0ZShtMSk7CiAgICAgICAgRnV0dXJlPExvbmc+IGZCID0g\nZ2V0TGVkZ2VyVG9SZXBsaWNhdGUobTEpOwoKICAgICAgICBMb25nIGxBID0g\nZkEuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgIExvbmcgbEIg\nPSBmQi5nZXQoNSwgVGltZVVuaXQuU0VDT05EUyk7CgogICAgICAgIGFzc2Vy\ndFRydWUoIlNob3VsZCBiZSB0aGUgbGVkZ2VycyBJIGp1c3QgbWFya2VkIiwK\nICAgICAgICAgICAgICAgICAgIChsQS5lcXVhbHMobGVkZ2VyQSkgJiYgbEIu\nZXF1YWxzKGxlZGdlckIpKQogICAgICAgICAgICAgICAgICAgfHwgKGxBLmVx\ndWFscyhsZWRnZXJCKSAmJiBsQi5lcXVhbHMobGVkZ2VyQSkpKTsKCiAgICAg\nICAgRnV0dXJlPExvbmc+IGYgPSBnZXRMZWRnZXJUb1JlcGxpY2F0ZShtMik7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZi5nZXQoMSwgVGltZVVuaXQu\nU0VDT05EUyk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxl\nIHRvIGZpbmQgYSBsZWRnZXIgdG8gcmVwbGljYXRlIik7CiAgICAgICAgfSBj\nYXRjaCAoVGltZW91dEV4Y2VwdGlvbiB0ZSkgewogICAgICAgICAgICAvLyBj\nb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgICAgICBtMS5tYXJrTGVk\nZ2VyUmVwbGljYXRlZChsQSk7CiAgICAgICAgemtjMS5jbG9zZSgpOyAvLyBz\naG91bGQga2lsbCB0aGUgbG9jawogICAgICAgIHprYzEgPSBudWxsOwoKICAg\nICAgICBMb25nIGwgPSBmLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAg\nICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSB0aGUgbGVkZ2VyIEkgbWFy\na2VkIiwgbEIsIGwpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCByZWxl\nYXNpbmcgb2YgYSBsZWRnZXIKICAgICAqIEEgbGVkZ2VyIGlzIHJlbGVhc2Vk\nIHdoZW4gYSBjbGllbnQgZGVjaWRlcyBpdCBkb2VzIG5vdCB3YW50CiAgICAg\nKiB0byByZXBsaWNhdGUgaXQgKG9yIGNhbm5vdCBhdCB0aGUgbW9tZW50KS4K\nICAgICAqIFdoZW4gYSBjbGllbnQgcmVsZWFzZXMgYSBwcmV2aW91c2x5IGFj\ncXVpcmVkIGxlZGdlciwgYW5vdGhlcgogICAgICogY2xpZW50IHNob3VsZCB0\naGVuIGJlIGFibGUgdG8gYWNxdWlyZSBpdC4KICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWxlYXNlKCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1pc3NpbmdSZXBs\naWNhID0gImxvY2FsaG9zdDozMTgxIjsKCiAgICAgICAgTGVkZ2VyVW5kZXJy\nZXBsaWNhdGlvbk1hbmFnZXIgbTEgPSBsbWYxLm5ld0xlZGdlclVuZGVycmVw\nbGljYXRpb25NYW5hZ2VyKCk7CiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNh\ndGlvbk1hbmFnZXIgbTIgPSBsbWYyLm5ld0xlZGdlclVuZGVycmVwbGljYXRp\nb25NYW5hZ2VyKCk7CgogICAgICAgIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVl\nZmRhY0w7CiAgICAgICAgTG9uZyBsZWRnZXJCID0gMHhkZWZhZGViTDsKICAg\nICAgICBtMS5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxlZGdlckEsIG1p\nc3NpbmdSZXBsaWNhKTsKICAgICAgICBtMS5tYXJrTGVkZ2VyVW5kZXJyZXBs\naWNhdGVkKGxlZGdlckIsIG1pc3NpbmdSZXBsaWNhKTsKCiAgICAgICAgRnV0\ndXJlPExvbmc+IGZBID0gZ2V0TGVkZ2VyVG9SZXBsaWNhdGUobTEpOwogICAg\nICAgIEZ1dHVyZTxMb25nPiBmQiA9IGdldExlZGdlclRvUmVwbGljYXRlKG0x\nKTsKCiAgICAgICAgTG9uZyBsQSA9IGZBLmdldCg1LCBUaW1lVW5pdC5TRUNP\nTkRTKTsKICAgICAgICBMb25nIGxCID0gZkIuZ2V0KDUsIFRpbWVVbml0LlNF\nQ09ORFMpOwoKICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgYmUgdGhlIGxl\nZGdlcnMgSSBqdXN0IG1hcmtlZCIsCiAgICAgICAgICAgICAgICAgICAobEEu\nZXF1YWxzKGxlZGdlckEpICYmIGxCLmVxdWFscyhsZWRnZXJCKSkKICAgICAg\nICAgICAgICAgICAgIHx8IChsQS5lcXVhbHMobGVkZ2VyQikgJiYgbEIuZXF1\nYWxzKGxlZGdlckEpKSk7CgogICAgICAgIEZ1dHVyZTxMb25nPiBmID0gZ2V0\nTGVkZ2VyVG9SZXBsaWNhdGUobTIpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGYuZ2V0KDEsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgICAgICBm\nYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byBmaW5kIGEgbGVkZ2VyIHRvIHJl\ncGxpY2F0ZSIpOwogICAgICAgIH0gY2F0Y2ggKFRpbWVvdXRFeGNlcHRpb24g\ndGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICB9CiAgICAgICAgbTEubWFya0xlZGdlclJlcGxpY2F0ZWQobEEpOwogICAg\nICAgIG0xLnJlbGVhc2VVbmRlcnJlcGxpY2F0ZWRMZWRnZXIobEIpOwoKICAg\nICAgICBMb25nIGwgPSBmLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAg\nICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSB0aGUgbGVkZ2VyIEkgbWFy\na2VkIiwgbEIsIGwpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0\nIHdoZW4gYSBmYWlsdXJlIG9jY3VycyBvbiBhIGxlZGdlciwgd2hpbGUgdGhl\nIGxlZGdlcgogICAgICogaXMgYWxyZWFkeSBiZWluZyByZXJlcGxpY2F0ZWQs\nIHRoZSBsZWRnZXIgd2lsbCBzdGlsbCBiZSBpbiB0aGUKICAgICAqIHVuZGVy\nIHJlcGxpY2F0ZWQgbGVkZ2VyIGxpc3Qgd2hlbiBmaXJzdCByZXJlcGxpY2F0\naW5nIGNsaWVudCBtYXJrcwogICAgICogaXQgYXMgcmVwbGljYXRlZC4KICAg\nICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RNYW55RmFpbHVyZXMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBTdHJpbmcgbWlzc2luZ1JlcGxpY2ExID0gImxvY2FsaG9zdDozMTgxIjsK\nICAgICAgICBTdHJpbmcgbWlzc2luZ1JlcGxpY2EyID0gImxvY2FsaG9zdDoz\nMTgyIjsKCiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIg\nbTEgPSBsbWYxLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7\nCgogICAgICAgIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVlZmRhY0w7CiAgICAg\nICAgbTEubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsZWRnZXJBLCBtaXNz\naW5nUmVwbGljYTEpOwoKICAgICAgICBGdXR1cmU8TG9uZz4gZkEgPSBnZXRM\nZWRnZXJUb1JlcGxpY2F0ZShtMSk7CiAgICAgICAgTG9uZyBsQSA9IGZBLmdl\ndCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKCiAgICAgICAgbTEubWFya0xlZGdl\nclVuZGVycmVwbGljYXRlZChsZWRnZXJBLCBtaXNzaW5nUmVwbGljYTIpOwoK\nICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSB0aGUgbGVkZ2VyIEkg\nanVzdCBtYXJrZWQiLAogICAgICAgICAgICAgICAgICAgICBsQSwgbGVkZ2Vy\nQSk7CiAgICAgICAgbTEubWFya0xlZGdlclJlcGxpY2F0ZWQobEEpOwoKICAg\nICAgICBGdXR1cmU8TG9uZz4gZiA9IGdldExlZGdlclRvUmVwbGljYXRlKG0x\nKTsKICAgICAgICBsQSA9IGYuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwog\nICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIHRoZSBsZWRnZXIgSSBo\nYWQgbWFya2VkIHByZXZpb3VzbHkiLAogICAgICAgICAgICAgICAgICAgICBs\nQSwgbGVkZ2VyQSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQg\nd2hlbiBhIGxlZGdlciBpcyBtYXJrZWQgYXMgdW5kZXJyZXBsaWNhdGVkIHdp\ndGgKICAgICAqIHRoZSBzYW1lIG1pc3NpbmcgcmVwbGljYSB0d2ljZSwgb25s\neSBtYXJraW5nIGFzIHJlcGxpY2F0ZWQKICAgICAqIHdpbGwgYmUgZW5vdWdo\nIHRvIHJlbW92ZSBpdCBmcm9tIHRoZSBsaXN0LgogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdDJyZXBvcnRT\nYW1lKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIG1pc3Np\nbmdSZXBsaWNhMSA9ICJsb2NhbGhvc3Q6MzE4MSI7CgogICAgICAgIExlZGdl\nclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIG0xID0gbG1mMS5uZXdMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwogICAgICAgIExlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyIG0yID0gbG1mMi5uZXdMZWRnZXJVbmRlcnJl\ncGxpY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICBMb25nIGxlZGdlckEgPSAw\neGZlYWRlZWZkYWNMOwogICAgICAgIG0xLm1hcmtMZWRnZXJVbmRlcnJlcGxp\nY2F0ZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2ExKTsKICAgICAgICBtMi5t\nYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxlZGdlckEsIG1pc3NpbmdSZXBs\naWNhMSk7CgogICAgICAgIC8vIHZlcmlmeSBkdXBsaWNhdGUgbWlzc2luZyBy\nZXBsaWNhCiAgICAgICAgVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0LkJ1\naWxkZXIgYnVpbGRlckEgPSBVbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQK\nICAgICAgICAgICAgICAgIC5uZXdCdWlsZGVyKCk7CiAgICAgICAgU3RyaW5n\nIHpub2RlID0gZ2V0VXJMZWRnZXJabm9kZShsZWRnZXJBKTsKICAgICAgICBi\neXRlW10gZGF0YSA9IHprYzEuZ2V0RGF0YSh6bm9kZSwgZmFsc2UsIG51bGwp\nOwogICAgICAgIFRleHRGb3JtYXQubWVyZ2UobmV3IFN0cmluZyhkYXRhLCBD\naGFyc2V0LmZvck5hbWUoIlVURi04IikpLCBidWlsZGVyQSk7CiAgICAgICAg\nTGlzdDxTdHJpbmc+IHJlcGxpY2FMaXN0ID0gYnVpbGRlckEuZ2V0UmVwbGlj\nYUxpc3QoKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlB1Ymxpc2hlZCBkdXBs\naWNhdGUgbWlzc2luZyByZXBsaWNhIDogIiArIHJlcGxpY2FMaXN0LCAxLAog\nICAgICAgICAgICAgICAgcmVwbGljYUxpc3Quc2l6ZSgpKTsKICAgICAgICBh\nc3NlcnRUcnVlKCJQdWJsaXNoZWQgZHVwbGljYXRlIG1pc3NpbmcgcmVwbGlj\nYSA6ICIgKyByZXBsaWNhTGlzdCwKICAgICAgICAgICAgICAgIHJlcGxpY2FM\naXN0LmNvbnRhaW5zKG1pc3NpbmdSZXBsaWNhMSkpOwoKICAgICAgICBGdXR1\ncmU8TG9uZz4gZkEgPSBnZXRMZWRnZXJUb1JlcGxpY2F0ZShtMSk7CiAgICAg\nICAgTG9uZyBsQSA9IGZBLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKCiAg\nICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgYmUgdGhlIGxlZGdlciBJIGp1\nc3QgbWFya2VkIiwKICAgICAgICAgICAgICAgICAgICAgbEEsIGxlZGdlckEp\nOwogICAgICAgIG0xLm1hcmtMZWRnZXJSZXBsaWNhdGVkKGxBKTsKCiAgICAg\nICAgRnV0dXJlPExvbmc+IGYgPSBnZXRMZWRnZXJUb1JlcGxpY2F0ZShtMik7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZi5nZXQoMSwgVGltZVVuaXQu\nU0VDT05EUyk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxl\nIHRvIGZpbmQgYSBsZWRnZXIgdG8gcmVwbGljYXRlIik7CiAgICAgICAgfSBj\nYXRjaCAoVGltZW91dEV4Y2VwdGlvbiB0ZSkgewogICAgICAgICAgICAvLyBj\nb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgdGhhdCBtdWx0aXBsZSBMZWRnZXJVbmRlcnJlcGxpY2F0aW9u\nTWFuYWdlcnMgc2hvdWxkIGJlIGFibGUgdG8gdGFrZQogICAgICogbG9jayBh\nbmQgcmVsZWFzZSBmb3Igc2FtZSBsZWRnZXIKICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dCA9IDMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE11bHRpcGxl\nTWFuYWdlcnNTaG91bGRCZUFibGVUb1Rha2VBbmRSZWxlYXNlTG9jaygpCiAg\nICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBt\naXNzaW5nUmVwbGljYTEgPSAibG9jYWxob3N0OjMxODEiOwogICAgICAgIGZp\nbmFsIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIG0xID0gbG1mMQog\nICAgICAgICAgICAgICAgLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5h\nZ2VyKCk7CiAgICAgICAgZmluYWwgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1h\nbmFnZXIgbTIgPSBsbWYyCiAgICAgICAgICAgICAgICAubmV3TGVkZ2VyVW5k\nZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAgICAgICBMb25nIGxlZGdlckEg\nPSAweGZlYWRlZWZkYWNMOwogICAgICAgIG0xLm1hcmtMZWRnZXJVbmRlcnJl\ncGxpY2F0ZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2ExKTsKICAgICAgICBm\naW5hbCBpbnQgaXRlcmF0aW9uQ291bnQgPSAxMDA7CiAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggbGF0Y2gxID0gbmV3IENvdW50RG93bkxhdGNoKGl0\nZXJhdGlvbkNvdW50KTsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBs\nYXRjaDIgPSBuZXcgQ291bnREb3duTGF0Y2goaXRlcmF0aW9uQ291bnQpOwog\nICAgICAgIFRocmVhZCB0aHJlYWQxID0gbmV3IFRocmVhZCgpIHsKICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigp\nIHsKICAgICAgICAgICAgICAgIHRha2VMZWRnZXJBbmRSZWxlYXNlKG0xLCBs\nYXRjaDEsIGl0ZXJhdGlvbkNvdW50KTsKICAgICAgICAgICAgfQogICAgICAg\nIH07CgogICAgICAgIFRocmVhZCB0aHJlYWQyID0gbmV3IFRocmVhZCgpIHsK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHJ1bigpIHsKICAgICAgICAgICAgICAgIHRha2VMZWRnZXJBbmRSZWxlYXNl\nKG0yLCBsYXRjaDIsIGl0ZXJhdGlvbkNvdW50KTsKICAgICAgICAgICAgfQog\nICAgICAgIH07CiAgICAgICAgdGhyZWFkMS5zdGFydCgpOwogICAgICAgIHRo\ncmVhZDIuc3RhcnQoKTsKCiAgICAgICAgLy8gd2FpdCB1bnRpbCBhdCBsZWFz\ndCBvbmUgdGhyZWFkIGNvbXBsZXRlZAogICAgICAgIHdoaWxlICghbGF0Y2gx\nLmF3YWl0KDUwLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpCiAgICAgICAgICAg\nICAgICAmJiAhbGF0Y2gyLmF3YWl0KDUwLCBUaW1lVW5pdC5NSUxMSVNFQ09O\nRFMpKSB7CiAgICAgICAgICAgIFRocmVhZC5zbGVlcCg1MCk7CiAgICAgICAg\nfQoKICAgICAgICBtMS5jbG9zZSgpOwogICAgICAgIG0yLmNsb3NlKCk7Cgog\nICAgICAgIC8vIEFmdGVyIGNvbXBsZXRpbmcgJ2xvY2sgYWNxdWlyZSxyZWxl\nYXNlJyBqb2IsIGl0IHNob3VsZCBub3RpZnkgYmVsb3cKICAgICAgICAvLyB3\nYWl0CiAgICAgICAgbGF0Y2gxLmF3YWl0KCk7CiAgICAgICAgbGF0Y2gyLmF3\nYWl0KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHZlcmlmaWVzIGZh\naWx1cmVzIG9mIGJvb2tpZXMgd2hpY2ggYXJlIHJlc2VtYmxpbmcgZWFjaCBv\ndGhlci4KICAgICAqCiAgICAgKiBCSyBzZXJ2ZXJzIG5hbWVkIGxpa2UqKioq\nKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICAg\nICAqIDEuY2x1c3Rlci5jb20sIDIuY2x1c3Rlci5jb20sIDExLmNsdXN0ZXIu\nY29tLCAxMi5jbHVzdGVyLmNvbQogICAgICogKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKgogICAgICoKICAgICAqIEJLc2VydmVyIElQOkhPU1QgbGlrZSoqKioq\nKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAg\nICogbG9jYWxob3N0OjMxODEsIGxvY2FsaG9zdDozMTgsIGxvY2FsaG9zdDoz\nMTgxMgogICAgICogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogICAgICovCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE1h\ncmtTaW1pbGFyTWlzc2luZ1JlcGxpY2EoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBMaXN0PFN0cmluZz4gbWlzc2luZ1JlcGxpY2EgPSBuZXcgQXJy\nYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBtaXNzaW5nUmVwbGljYS5hZGQo\nImxvY2FsaG9zdDozMTgxIik7CiAgICAgICAgbWlzc2luZ1JlcGxpY2EuYWRk\nKCJsb2NhbGhvc3Q6MzE4Iik7CiAgICAgICAgbWlzc2luZ1JlcGxpY2EuYWRk\nKCJsb2NhbGhvc3Q6MzE4MTIiKTsKICAgICAgICBtaXNzaW5nUmVwbGljYS5h\nZGQoIjEuY2x1c3Rlci5jb20iKTsKICAgICAgICBtaXNzaW5nUmVwbGljYS5h\nZGQoIjIuY2x1c3Rlci5jb20iKTsKICAgICAgICBtaXNzaW5nUmVwbGljYS5h\nZGQoIjExLmNsdXN0ZXIuY29tIik7CiAgICAgICAgbWlzc2luZ1JlcGxpY2Eu\nYWRkKCIxMi5jbHVzdGVyLmNvbSIpOwogICAgICAgIHZlcmlmeU1hcmtMZWRn\nZXJVbmRlcnJlcGxpY2F0ZWQobWlzc2luZ1JlcGxpY2EpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGVzdCBtdWx0aXBsZSBib29raWUgZmFpbHVyZXMgZm9y\nIGEgbGVkZ2VyIGFuZCBtYXJrZWQgYXMgdW5kZXJyZXBsaWNhdGVkCiAgICAg\nKiBvbmUgYWZ0ZXIgYW5vdGhlci4KICAgICAqLwogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RNYW55RmFpbHVyZXNJbkFu\nRW5zZW1ibGUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMaXN0PFN0\ncmluZz4gbWlzc2luZ1JlcGxpY2EgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4o\nKTsKICAgICAgICBtaXNzaW5nUmVwbGljYS5hZGQoImxvY2FsaG9zdDozMTgx\nIik7CiAgICAgICAgbWlzc2luZ1JlcGxpY2EuYWRkKCJsb2NhbGhvc3Q6MzE4\nMiIpOwogICAgICAgIHZlcmlmeU1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQo\nbWlzc2luZ1JlcGxpY2EpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBk\naXNhYmxpbmcgdGhlIGxlZGdlciByZS1yZXBsaWNhdGlvbi4gQWZ0ZXIgZGlz\nYWJsaW5nLCBpdCB3aWxsIG5vdCBiZQogICAgICogYWJsZSB0byBnZXRMZWRn\nZXJUb1JlcmVwbGljYXRlKCkuIFRoaXMgY2FsbHMgd2lsbCBlbnRlciBpbnRv\nIGluZmluaXRlCiAgICAgKiB3YWl0aW5nIHVudGlsIGVuYWJsaW5nIHJlcmVw\nbGljYXRpb24gcHJvY2VzcwogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0g\nMjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RGlzYWJsZUxlZGVnZXJSZXBs\naWNhdGlvbigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZpbmFsIExl\nZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIHJlcGxpY2FNZ3IgPSBsbWYx\nCiAgICAgICAgICAgICAgICAubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1h\nbmFnZXIoKTsKCiAgICAgICAgLy8gc2ltdWxhdGUgZmV3IHVyTGVkZ2VycyBi\nZWZvcmUgZGlzYWJsaW5nCiAgICAgICAgZmluYWwgTG9uZyBsZWRnZXJBID0g\nMHhmZWFkZWVmZGFjTDsKICAgICAgICBmaW5hbCBTdHJpbmcgbWlzc2luZ1Jl\ncGxpY2EgPSAibG9jYWxob3N0OjMxODEiOwoKICAgICAgICAvLyBkaXNhYmxp\nbmcgcmVwbGljYXRpb24KICAgICAgICByZXBsaWNhTWdyLmRpc2FibGVMZWRn\nZXJSZXBsaWNhdGlvbigpOwogICAgICAgIExPRy5pbmZvKCJEaXNhYmxlZCBM\nZWRlZ2VyIFJlcGxpY2F0aW9uIik7CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHJlcGxpY2FNZ3IubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsZWRn\nZXJBLCBtaXNzaW5nUmVwbGljYSk7CiAgICAgICAgfSBjYXRjaCAoVW5hdmFp\nbGFibGVFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZGVidWcoIlVu\nZXhwZWN0ZWQgZXhjZXB0aW9uIHdoaWxlIG1hcmtpbmcgdXJMZWRnZXIiLCBl\nKTsKICAgICAgICAgICAgZmFpbCgiVW5leHBlY3RlZCBleGNlcHRpb24gd2hp\nbGUgbWFya2luZyB1ckxlZGdlciIgKyBlLmdldE1lc3NhZ2UoKSk7CiAgICAg\nICAgfQoKICAgICAgICBGdXR1cmU8TG9uZz4gZkEgPSBnZXRMZWRnZXJUb1Jl\ncGxpY2F0ZShyZXBsaWNhTWdyKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBmQS5nZXQoMSwgVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgICAgIGZh\naWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIGZpbmQgYSBsZWRnZXIgdG8gcmVw\nbGljYXRlIik7CiAgICAgICAgfSBjYXRjaCAoVGltZW91dEV4Y2VwdGlvbiB0\nZSkgewogICAgICAgICAgICAvLyBleHBlY3RlZCBiZWhhdmlvdXIsIGFzIHRo\nZSByZXBsaWNhdGlvbiBpcyBkaXNhYmxlZAogICAgICAgICAgICBpc0xlZGdl\nclJlcGxpY2F0aW9uRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICB9CgogICAg\nICAgIGFzc2VydFRydWUoIkxlZGdlciByZXBsaWNhdGlvbiBpcyBub3QgZGlz\nYWJsZWQhIiwKICAgICAgICAgICAgICAgICFpc0xlZGdlclJlcGxpY2F0aW9u\nRGlzYWJsZWQpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBlbmFibGlu\nZyB0aGUgbGVkZ2VyIHJlLXJlcGxpY2F0aW9uLiBBZnRlciBlbmFibGVMZWRl\nZ2VyUmVwbGljYXRpb24sCiAgICAgKiBzaG91bGQgY29udGludWUgZ2V0TGVk\nZ2VyVG9SZXJlcGxpY2F0ZSgpIHRhc2sKICAgICAqLwogICAgQFRlc3QodGlt\nZW91dCA9IDIwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEVuYWJsZUxlZGdl\nclJlcGxpY2F0aW9uKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaXNM\nZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVkID0gdHJ1ZTsKICAgICAgICBmaW5h\nbCBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciByZXBsaWNhTWdyID0g\nbG1mMQogICAgICAgICAgICAgICAgLm5ld0xlZGdlclVuZGVycmVwbGljYXRp\nb25NYW5hZ2VyKCk7CgogICAgICAgIC8vIHNpbXVsYXRlIGZldyB1ckxlZGdl\ncnMgYmVmb3JlIGRpc2FibGluZwogICAgICAgIGZpbmFsIExvbmcgbGVkZ2Vy\nQSA9IDB4ZmVhZGVlZmRhY0w7CiAgICAgICAgZmluYWwgU3RyaW5nIG1pc3Np\nbmdSZXBsaWNhID0gImxvY2FsaG9zdDozMTgxIjsKICAgICAgICB0cnkgewog\nICAgICAgICAgICByZXBsaWNhTWdyLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0\nZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2EpOwogICAgICAgIH0gY2F0Y2gg\nKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmRl\nYnVnKCJVbmV4cGVjdGVkIGV4Y2VwdGlvbiB3aGlsZSBtYXJraW5nIHVyTGVk\nZ2VyIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlVuZXhwZWN0ZWQgZXhjZXB0\naW9uIHdoaWxlIG1hcmtpbmcgdXJMZWRnZXIiICsgZS5nZXRNZXNzYWdlKCkp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gZGlzYWJsaW5nIHJlcGxpY2F0aW9u\nCiAgICAgICAgcmVwbGljYU1nci5kaXNhYmxlTGVkZ2VyUmVwbGljYXRpb24o\nKTsKICAgICAgICBMT0cuZGVidWcoIkRpc2FibGVkIExlZGVnZXIgUmVwbGlj\nYXRpb24iKTsKCiAgICAgICAgU3RyaW5nIHpub2RlQSA9IGdldFVyTGVkZ2Vy\nWm5vZGUobGVkZ2VyQSk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2gg\nem5vZGVMYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgyKTsKICAgICAgICBT\ndHJpbmcgdXJsZWRnZXJBID0gU3RyaW5nVXRpbHMuc3Vic3RyaW5nQWZ0ZXJM\nYXN0KHpub2RlQSwgIi8iKTsKICAgICAgICBTdHJpbmcgdXJMb2NrTGVkZ2Vy\nQSA9IGJhc2VQYXRoICsgIi9sb2Nrcy8iICsgdXJsZWRnZXJBOwogICAgICAg\nIHprYzEuZXhpc3RzKHVyTG9ja0xlZGdlckEsIG5ldyBXYXRjaGVyKCl7CiAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBw\ncm9jZXNzKFdhdGNoZWRFdmVudCBldmVudCkgewogICAgICAgICAgICAgICAg\naWYgKGV2ZW50LmdldFR5cGUoKSA9PSBFdmVudFR5cGUuTm9kZUNyZWF0ZWQp\nIHsKICAgICAgICAgICAgICAgICAgICB6bm9kZUxhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiUmVjaWV2ZWQgbm9k\nZSBjcmVhdGlvbiBldmVudCBmb3IgdGhlIHpOb2RlUGF0aDoiCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIGV2ZW50LmdldFBhdGgoKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfX0p\nOwogICAgICAgIC8vIGdldExlZGdlclRvUmVyZXBsaWNhdGUgaXMgd2FpdGlu\nZyB1bnRpbCBlbmFibGUgcmVyZXBsaWNhdGlvbgogICAgICAgIFRocmVhZCB0\naHJlYWQxID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgTG9uZyBsQSA9IHJlcGxp\nY2FNZ3IuZ2V0TGVkZ2VyVG9SZXJlcGxpY2F0ZSgpOwogICAgICAgICAgICAg\nICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIHRoZSBsZWRnZXIgSSBq\ndXN0IG1hcmtlZCIsIGxBLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbGVkZ2VyQSk7CiAgICAgICAgICAgICAgICAgICAgaXNMZWRnZXJSZXBsaWNh\ndGlvbkRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgem5v\nZGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIHdoaWxlIG1hcmtp\nbmcgdXJMZWRnZXIiLCBlKTsKICAgICAgICAgICAgICAgICAgICBpc0xlZGdl\nclJlcGxpY2F0aW9uRGlzYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgdGhyZWFkMS5z\ndGFydCgpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBhc3NlcnRGYWxz\nZSgic2hvdWxkbid0IGNvbXBsZXRlIiwgem5vZGVMYXRjaC5hd2FpdCgxLCBU\naW1lVW5pdC5TRUNPTkRTKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoIkxl\nZGdlciByZXBsaWNhdGlvbiBpcyBub3QgZGlzYWJsZWQhIiwKICAgICAgICAg\nICAgICAgICAgICBpc0xlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQpOwogICAg\nICAgICAgICBhc3NlcnRFcXVhbHMoIkZhaWxlZCB0byBkaXNhYmxlIGxlZGdl\nciByZXBsaWNhdGlvbiEiLCAyLCB6bm9kZUxhdGNoCiAgICAgICAgICAgICAg\nICAgICAgLmdldENvdW50KCkpOwoKICAgICAgICAgICAgcmVwbGljYU1nci5l\nbmFibGVMZWRnZXJSZXBsaWNhdGlvbigpOwogICAgICAgICAgICB6bm9kZUxh\ndGNoLmF3YWl0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgICAgICBM\nT0cuZGVidWcoIkVuYWJsZWQgTGVkZWdlciBSZXBsaWNhdGlvbiIpOwogICAg\nICAgICAgICBhc3NlcnRUcnVlKCJMZWRnZXIgcmVwbGljYXRpb24gaXMgbm90\nIGRpc2FibGVkISIsCiAgICAgICAgICAgICAgICAgICAgIWlzTGVkZ2VyUmVw\nbGljYXRpb25EaXNhYmxlZCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygi\nRmFpbGVkIHRvIGRpc2FibGUgbGVkZ2VyIHJlcGxpY2F0aW9uISIsIDAsIHpu\nb2RlTGF0Y2gKICAgICAgICAgICAgICAgICAgICAuZ2V0Q291bnQoKSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgdGhyZWFkMS5pbnRlcnJ1\ncHQoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRo\nYXQgdGhlIGhpZXJhcmNoeSBnZXRzIGNsZWFuZWQgdXAgYXMgbGVkZ2Vycwog\nICAgICogYXJlIG1hcmtlZCBhcyBmdWxseSByZXBsaWNhdGVkCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nSGllcmFyY2h5Q2xlYW51cCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIGZpbmFsIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIHJlcGxpY2FN\nZ3IgPSBsbWYxCiAgICAgICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0\naW9uTWFuYWdlcigpOwogICAgICAgIC8vIDQgbGVkZ2VycywgMiBpbiB0aGUg\nc2FtZSBoaWVyYXJjaHkKICAgICAgICBsb25nW10gbGVkZ2VycyA9IHsgMHgw\nMDAwMDAwMGRlYWRiZWVmTCwgMHgwMDAwMDAwMGRlYWRiZWVlTCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgMHgwMDAwMDAwMGJlZWZjYWZlTCwgMHgw\nMDAwMDAwMGNhZmVkMDBkTCB9OwoKICAgICAgICBmb3IgKGxvbmcgbCA6IGxl\nZGdlcnMpIHsKICAgICAgICAgICAgcmVwbGljYU1nci5tYXJrTGVkZ2VyVW5k\nZXJyZXBsaWNhdGVkKGwsICJsb2NhbGhvc3Q6MzE4MSIpOwogICAgICAgIH0K\nICAgICAgICAvLyBjYW4ndCBzaW1wbHkgdGVzdCB0b3AgbGV2ZWwgYXMgd2Ug\nYXJlIGxpbWl0ZWQgdG8gbGVkZ2VyCiAgICAgICAgLy8gaWRzIG5vIGxhcmdl\nciB0aGFuIGFuIGludAogICAgICAgIFN0cmluZyB0ZXN0UGF0aCA9IHVyTGVk\nZ2VyUGF0aCArICIvMDAwMC8wMDAwIjsKICAgICAgICBMaXN0PFN0cmluZz4g\nY2hpbGRyZW4gPSB6a2MxLmdldENoaWxkcmVuKHRlc3RQYXRoLCBmYWxzZSk7\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJXcm9uZyBudW1iZXIgb2YgaGllcmFy\nY2hpZXMiLCAzLCBjaGlsZHJlbi5zaXplKCkpOwoKICAgICAgICBpbnQgbWFy\na2VkID0gMDsKICAgICAgICB3aGlsZSAobWFya2VkIDwgMykgewogICAgICAg\nICAgICBsb25nIGwgPSByZXBsaWNhTWdyLmdldExlZGdlclRvUmVyZXBsaWNh\ndGUoKTsKICAgICAgICAgICAgaWYgKGwgIT0gbGVkZ2Vyc1swXSkgewogICAg\nICAgICAgICAgICAgcmVwbGljYU1nci5tYXJrTGVkZ2VyUmVwbGljYXRlZChs\nKTsKICAgICAgICAgICAgICAgIG1hcmtlZCsrOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgcmVwbGljYU1nci5yZWxlYXNlVW5kZXJy\nZXBsaWNhdGVkTGVkZ2VyKGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGNoaWxkcmVuID0gemtjMS5nZXRDaGlsZHJlbih0ZXN0UGF0aCwg\nZmFsc2UpOwogICAgICAgIGFzc2VydEVxdWFscygiV3JvbmcgbnVtYmVyIG9m\nIGhpZXJhcmNoaWVzIiwgMSwgY2hpbGRyZW4uc2l6ZSgpKTsKCiAgICAgICAg\nbG9uZyBsID0gcmVwbGljYU1nci5nZXRMZWRnZXJUb1JlcmVwbGljYXRlKCk7\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJHb3Qgd3JvbmcgbGVkZ2VyIiwgbGVk\nZ2Vyc1swXSwgbCk7CiAgICAgICAgcmVwbGljYU1nci5tYXJrTGVkZ2VyUmVw\nbGljYXRlZChsKTsKCiAgICAgICAgY2hpbGRyZW4gPSB6a2MxLmdldENoaWxk\ncmVuKHVyTGVkZ2VyUGF0aCwgZmFsc2UpOwogICAgICAgIGFzc2VydEVxdWFs\ncygiQWxsIGhpZXJhcmNoaWVzIHNob3VsZCBiZSBjbGVhbmVkIHVwIiwgMCwg\nY2hpbGRyZW4uc2l6ZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3Qg\ndGhhdCBhcyB0aGUgaGllcmFyY2h5IGdldHMgY2xlYW5lZCB1cCwgaXQgZG9l\nc24ndCBpbnRlcmZlcmUKICAgICAqIHdpdGggdGhlIG1hcmtpbmcgb2Ygb3Ro\nZXIgbGVkZ2VycyBhcyB1bmRlcnJlcGxpY2F0ZWQKICAgICAqLwogICAgQFRl\nc3QodGltZW91dCA9IDkwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEhpZXJh\ncmNoeUNsZWFudXBJbnRlcmZlcmVuY2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBmaW5hbCBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBy\nZXBsaWNhTWdyMSA9IGxtZjEKICAgICAgICAgICAgLm5ld0xlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyKCk7CiAgICAgICAgZmluYWwgTGVkZ2VyVW5k\nZXJyZXBsaWNhdGlvbk1hbmFnZXIgcmVwbGljYU1ncjIgPSBsbWYyCiAgICAg\nICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwoK\nICAgICAgICBmaW5hbCBpbnQgaXRlcmF0aW9ucyA9IDEwMDsKICAgICAgICBm\naW5hbCBBdG9taWNCb29sZWFuIHRocmVhZEZhaWxlZCA9IG5ldyBBdG9taWNC\nb29sZWFuKGZhbHNlKTsKICAgICAgICBUaHJlYWQgbWFya1VuZGVyID0gbmV3\nIFRocmVhZCgpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigp\nIHsKICAgICAgICAgICAgICAgICAgICBsb25nIGwgPSAxOwogICAgICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgaXRlcmF0aW9uczsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXBsaWNhTWdyMS5tYXJrTGVkZ2VyVW5kZXJy\nZXBsaWNhdGVkKGwsICJsb2NhbGhvc3Q6MzE4MSIpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbCArPSAxMDAwMDsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigibWFy\na1VuZGVyIFRocmVhZCBmYWlsZWQgd2l0aCBleGNlcHRpb24iLCBlKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyZWFkRmFpbGVkLnNldCh0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAg\nICAgICBmaW5hbCBBdG9taWNJbnRlZ2VyIHByb2Nlc3NlZCA9IG5ldyBBdG9t\naWNJbnRlZ2VyKDApOwogICAgICAgIFRocmVhZCBtYXJrUmVwbCA9IG5ldyBU\naHJlYWQoKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBpdGVyYXRpb25zOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcgbCA9IHJlcGxpY2FN\nZ3IyLmdldExlZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJlcGxpY2FNZ3IyLm1hcmtMZWRnZXJSZXBsaWNhdGVk\nKGwpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkLmlu\nY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJtYXJrUmVwbCBUaHJl\nYWQgZmFpbGVkIHdpdGggZXhjZXB0aW9uIiwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHRocmVhZEZhaWxlZC5zZXQodHJ1ZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgbWFya1Jl\ncGwuc2V0RGFlbW9uKHRydWUpOwogICAgICAgIG1hcmtVbmRlci5zZXREYWVt\nb24odHJ1ZSk7CgogICAgICAgIG1hcmtSZXBsLnN0YXJ0KCk7CiAgICAgICAg\nbWFya1VuZGVyLnN0YXJ0KCk7CiAgICAgICAgbWFya1VuZGVyLmpvaW4oKTsK\nICAgICAgICBhc3NlcnRGYWxzZSgiVGhyZWFkIGZhaWxlZCB0byBjb21wbGV0\nZSIsIHRocmVhZEZhaWxlZC5nZXQoKSk7CgogICAgICAgIGludCBsYXN0UHJv\nY2Vzc2VkID0gMDsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAg\nICBtYXJrUmVwbC5qb2luKDEwMDAwKTsKICAgICAgICAgICAgaWYgKCFtYXJr\nUmVwbC5pc0FsaXZlKCkpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGFzc2VydEZhbHNlKCJtYXJrUmVwbCB0\naHJlYWQgbm90IHByb2dyZXNzaW5nIiwgbGFzdFByb2Nlc3NlZCA9PSBwcm9j\nZXNzZWQuZ2V0KCkpOwogICAgICAgIH0KICAgICAgICBhc3NlcnRGYWxzZSgi\nVGhyZWFkIGZhaWxlZCB0byBjb21wbGV0ZSIsIHRocmVhZEZhaWxlZC5nZXQo\nKSk7CgogICAgICAgIExpc3Q8U3RyaW5nPiBjaGlsZHJlbiA9IHprYzEuZ2V0\nQ2hpbGRyZW4odXJMZWRnZXJQYXRoLCBmYWxzZSk7CiAgICAgICAgZm9yIChT\ndHJpbmcgcyA6IGNoaWxkcmVuKSB7CiAgICAgICAgICAgIExPRy5pbmZvKCJz\nOiB7fSIsIHMpOwogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVhbHMoIkFs\nbCBoaWVyYXJjaGllcyBzaG91bGQgYmUgY2xlYW5lZCB1cCIsIDAsIGNoaWxk\ncmVuLnNpemUoKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlmeU1h\ncmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQoQ29sbGVjdGlvbjxTdHJpbmc+IG1p\nc3NpbmdSZXBsaWNhKQogICAgICAgICAgICB0aHJvd3MgS2VlcGVyRXhjZXB0\naW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwKICAgICAgICAgICAgQ29tcGF0\naWJpbGl0eUV4Y2VwdGlvbiwgVW5hdmFpbGFibGVFeGNlcHRpb24gewogICAg\nICAgIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVlZmRhY0w7CiAgICAgICAgU3Ry\naW5nIHpub2RlQSA9IGdldFVyTGVkZ2VyWm5vZGUobGVkZ2VyQSk7CiAgICAg\nICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgcmVwbGljYU1nciA9\nIGxtZjEKICAgICAgICAgICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0\naW9uTWFuYWdlcigpOwogICAgICAgIGZvciAoU3RyaW5nIHJlcGxpY2EgOiBt\naXNzaW5nUmVwbGljYSkgewogICAgICAgICAgICByZXBsaWNhTWdyLm1hcmtM\nZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGVkZ2VyQSwgcmVwbGljYSk7CiAgICAg\nICAgfQoKICAgICAgICBTdHJpbmcgdXJMZWRnZXJBID0gZ2V0RGF0YSh6bm9k\nZUEpOwogICAgICAgIFVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdC5CdWls\nZGVyIGJ1aWxkZXJBID0gVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0CiAg\nICAgICAgICAgICAgICAubmV3QnVpbGRlcigpOwogICAgICAgIGZvciAoU3Ry\naW5nIHJlcGxpY2EgOiBtaXNzaW5nUmVwbGljYSkgewogICAgICAgICAgICBi\ndWlsZGVyQS5hZGRSZXBsaWNhKHJlcGxpY2EpOwogICAgICAgIH0KICAgICAg\nICBMaXN0PFN0cmluZz4gcmVwbGljYUxpc3QgPSBidWlsZGVyQS5nZXRSZXBs\naWNhTGlzdCgpOwoKICAgICAgICBmb3IgKFN0cmluZyByZXBsaWNhIDogbWlz\nc2luZ1JlcGxpY2EpIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVXJMZWRn\nZXI6IiArIHVyTGVkZ2VyQQogICAgICAgICAgICAgICAgICAgICsgIiBkb2Vz\nbid0IGNvbnRhaW4gZmFpbGVkIGJvb2tpZSA6IiArIHJlcGxpY2EsIHJlcGxp\nY2FMaXN0CiAgICAgICAgICAgICAgICAgICAgLmNvbnRhaW5zKHJlcGxpY2Ep\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0RGF0\nYShTdHJpbmcgem5vZGUpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBi\neXRlW10gZGF0YSA9IHprYzEuZ2V0RGF0YSh6bm9kZSwgZmFsc2UsIG51bGwp\nOwogICAgICAgICAgICByZXR1cm4gbmV3IFN0cmluZyhkYXRhKTsKICAgICAg\nICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24gZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSByZWFkaW5nIGRhdGEgZnJvbSB6\nbm9kZSA6IiArIHpub2RlKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0\naW9uIHdoaWxlIHJlYWRpbmcgZGF0YSBmcm9tIHpub2RlIDoiICsgem5vZGUp\nOwogICAgICAgIH0KICAgICAgICByZXR1cm4gIiI7CgogICAgfQoKICAgIHBy\naXZhdGUgU3RyaW5nIGdldFVyTGVkZ2VyWm5vZGUobG9uZyBsZWRnZXJJZCkg\newogICAgICAgIHJldHVybiBaa0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5h\nZ2VyLmdldFVyTGVkZ2VyWm5vZGUodXJMZWRnZXJQYXRoLCBsZWRnZXJJZCk7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHRha2VMZWRnZXJBbmRSZWxlYXNl\nKGZpbmFsIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIG0sCiAgICAg\nICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNoLCBpbnQgbnVtYmVy\nT2ZJdGVyYXRpb25zKSB7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBu\ndW1iZXJPZkl0ZXJhdGlvbnM7IGkrKykgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgbG9uZyBsZWRnZXJUb1JlcmVwbGljYXRlID0gbS5n\nZXRMZWRnZXJUb1JlcmVwbGljYXRlKCk7CiAgICAgICAgICAgICAgICBtLnJl\nbGVhc2VVbmRlcnJlcGxpY2F0ZWRMZWRnZXIobGVkZ2VyVG9SZXJlcGxpY2F0\nZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiVW5hdmFpbGFibGVF\neGNlcHRpb24gd2hlbiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgInRh\na2luZyBvciByZWxlYXNpbmcgbG9jayIsIGUpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgIH0KICAgIH0K\nfQo=\n","encoding":"base64"}

