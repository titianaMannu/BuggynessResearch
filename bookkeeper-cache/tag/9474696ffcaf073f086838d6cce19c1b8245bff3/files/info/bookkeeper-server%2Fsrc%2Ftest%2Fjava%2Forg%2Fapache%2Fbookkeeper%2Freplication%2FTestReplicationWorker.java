{"sha":"d47e4b1ed4cf6c050062b11a4c5cc2fb97a2ba08","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDQ3ZTRiMWVkNGNmNmMwNTAwNjJiMTFhNGM1Y2MyZmI5N2EyYmEwOA==","size":22935,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d47e4b1ed4cf6c050062b11a4c5cc2fb97a2ba08","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbjsK\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5D\nbGllbnRVdGlsOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJIYW5kbGVBZGFwdGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdlck1hbmFnZXJG\nYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVk\nZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIubmV0LkJvb2tpZVNvY2tldEFkZHJlc3M7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnRlc3QuTXVsdGlMZWRnZXJNYW5h\nZ2VyVGVzdENhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRp\nbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnV0aWwuWmtVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci56b29rZWVwZXIuWm9vS2VlcGVyV2F0Y2hlckJhc2U7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuanVu\naXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBqYXZhLm5ldC5JbmV0QWRk\ncmVzczsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuTWFwLkVudHJ5\nOwppbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBzdGF0aWMgb3JnLmp1\nbml0LkFzc2VydC4qOwoKLyoqCiAqIFRlc3QgdGhlIFJlcGxpY2F0aW9uV3Jv\na2VyLCB3aGVyZSBpdCBoYXMgdG8gcmVwbGljYXRlIHRoZSBmcmFnbWVudHMg\nZnJvbQogKiBmYWlsZWQgQm9va2llcyB0byBnaXZlbiB0YXJnZXQgQm9va2ll\nLgogKi8KcHVibGljIGNsYXNzIFRlc3RSZXBsaWNhdGlvbldvcmtlciBleHRl\nbmRzIE11bHRpTGVkZ2VyTWFuYWdlclRlc3RDYXNlIHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBieXRlW10gVEVTVFBBU1NXRCA9ICJ0ZXN0cGFzc3dk\nIi5nZXRCeXRlcygpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2Vy\nIExPRyA9IExvZ2dlckZhY3RvcnkKICAgICAgICAgICAgLmdldExvZ2dlcihU\nZXN0UmVwbGljYXRpb25Xb3JrZXIuY2xhc3MpOwogICAgcHJpdmF0ZSBTdHJp\nbmcgYmFzZVBhdGggPSAiIjsKICAgIHByaXZhdGUgTGVkZ2VyTWFuYWdlckZh\nY3RvcnkgbUZhY3Rvcnk7CiAgICBwcml2YXRlIExlZGdlclVuZGVycmVwbGlj\nYXRpb25NYW5hZ2VyIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyOwogICAgcHJp\ndmF0ZSBzdGF0aWMgYnl0ZVtdIGRhdGEgPSAiVGVzdFJlcGxpY2F0aW9uV29y\na2VyIi5nZXRCeXRlcygpOwoKICAgIHB1YmxpYyBUZXN0UmVwbGljYXRpb25X\nb3JrZXIoU3RyaW5nIGxlZGdlck1hbmFnZXJGYWN0b3J5KSB7CiAgICAgICAg\nc3VwZXIoMyk7CiAgICAgICAgTE9HLmluZm8oIlJ1bm5pbmcgdGVzdCBjYXNl\nIHVzaW5nIGxlZGdlciBtYW5hZ2VyIDogIgogICAgICAgICAgICAgICAgKyBs\nZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAgICAgICAgLy8gc2V0IGxlZGdlciBt\nYW5hZ2VyIG5hbWUKICAgICAgICBiYXNlQ29uZi5zZXRMZWRnZXJNYW5hZ2Vy\nRmFjdG9yeUNsYXNzTmFtZShsZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAgICAg\nICAgYmFzZUNsaWVudENvbmYuc2V0TGVkZ2VyTWFuYWdlckZhY3RvcnlDbGFz\nc05hbWUobGVkZ2VyTWFuYWdlckZhY3RvcnkpOwogICAgICAgIGJhc2VQYXRo\nID0gYmFzZUNsaWVudENvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICcv\nJwogICAgICAgICAgICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLlVOREVS\nX1JFUExJQ0FUSU9OX05PREUKICAgICAgICAgICAgICAgICsgQm9va0tlZXBl\nckNvbnN0YW50cy5ERUZBVUxUX1pLX0xFREdFUlNfUk9PVF9QQVRIOwogICAg\nICAgIGJhc2VDb25mLnNldFJlcmVwbGljYXRpb25FbnRyeUJhdGNoU2l6ZSgz\nKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNldFVw\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc2V0VXAoKTsK\nICAgICAgICAvLyBpbml0aWFsaXplIHVyUmVwbGljYXRpb25NYW5hZ2VyCiAg\nICAgICAgbUZhY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeS5uZXdMZWRn\nZXJNYW5hZ2VyRmFjdG9yeShiYXNlQ2xpZW50Q29uZiwKICAgICAgICAgICAg\nICAgIHprYyk7CiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIgPSBt\nRmFjdG9yeS5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdGVhckRvd24o\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci50ZWFyRG93bigp\nOwogICAgICAgIGlmKG51bGwgIT0gbUZhY3RvcnkpewogICAgICAgICAgICBt\nRmFjdG9yeS51bmluaXRpYWxpemUoKTsKICAgICAgICAgICAgbUZhY3Rvcnkg\nPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZihudWxsICE9IHVuZGVyUmVw\nbGljYXRpb25NYW5hZ2VyKXsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlv\nbk1hbmFnZXIuY2xvc2UoKTsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlv\nbk1hbmFnZXIgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3RzIHRoYXQgcmVwbGljYXRpb24gd29ya2VyIHNob3VsZCByZXBs\naWNhdGUgdGhlIGZhaWxlZCBib29raWUKICAgICAqIGZyYWdtZW50cyB0byB0\nYXJnZXQgYm9va2llIGdpdmVuIHRvIHRoZSB3b3JrZXIuCiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQgPSAzMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RS\nV1Nob3VsZFJlcGxpY2F0ZUZyYWdtZW50c1RvVGFyZ2V0Qm9va2llKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtj\nLmNyZWF0ZUxlZGdlcigzLCAzLCBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JD\nMzIsCiAgICAgICAgICAgICAgICBURVNUUEFTU1dEKTsKCiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFk\nZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAgICBCb29raWVTb2NrZXRB\nZGRyZXNzIHJlcGxpY2FUb0tpbGwgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAg\nICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEobGgpLmdldEVuc2Vt\nYmxlcygpLmdldCgwTCkuZ2V0KDApOwoKICAgICAgICBMT0cuaW5mbygiS2ls\nbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxsKTsKICAgICAgICBraWxsQm9v\na2llKHJlcGxpY2FUb0tpbGwpOwoKICAgICAgICBpbnQgc3RhcnROZXdCb29r\naWUgPSBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRyeShkYXRh\nKTsKICAgICAgICB9CgogICAgICAgIEJvb2tpZVNvY2tldEFkZHJlc3MgbmV3\nQmtBZGRyID0gbmV3IEJvb2tpZVNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MK\nICAgICAgICAgICAgICAgIC5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVz\ncygpLCBzdGFydE5ld0Jvb2tpZSk7CiAgICAgICAgTE9HLmluZm8oIk5ldyBC\nb29raWUgYWRkciA6IiArIG5ld0JrQWRkcik7CgogICAgICAgIFJlcGxpY2F0\naW9uV29ya2VyIHJ3ID0gbmV3IFJlcGxpY2F0aW9uV29ya2VyKHprYywgYmFz\nZUNvbmYsIG5ld0JrQWRkcik7CgogICAgICAgIHJ3LnN0YXJ0KCk7CiAgICAg\nICAgdHJ5IHsKCiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2Vy\nLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGguZ2V0SWQoKSwKICAgICAg\nICAgICAgICAgICAgICByZXBsaWNhVG9LaWxsLnRvU3RyaW5nKCkpOwoKICAg\nICAgICAgICAgd2hpbGUgKFJlcGxpY2F0aW9uVGVzdFV0aWwuaXNMZWRnZXJJ\nblVuZGVyUmVwbGljYXRpb24oemtjLCBsaAogICAgICAgICAgICAgICAgICAg\nIC5nZXRJZCgpLCBiYXNlUGF0aCkpIHsKICAgICAgICAgICAgICAgIFRocmVh\nZC5zbGVlcCgxMDApOwogICAgICAgICAgICB9CgogICAgICAgICAgICBraWxs\nQWxsQm9va2llcyhsaCwgbmV3QmtBZGRyKTsKCiAgICAgICAgICAgIC8vIFNo\nb3VsZCBiZSBhYmxlIHRvIHJlYWQgdGhlIGVudHJpZXMgZnJvbSAwLTkKICAg\nICAgICAgICAgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaCwgMCwgOSk7CiAg\nICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcncuc2h1dGRvd24oKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0cyB0aGF0IHJl\ncGxpY2F0aW9uIHdvcmtlciBzaG91bGQgcmV0cnkgZm9yIHJlcGxpY2F0aW9u\nIHVudGlsIGVub3VnaAogICAgICogYm9va2llcyBhdmFpbGFibGUgZm9yIHJl\ncGxpY2F0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RSV1Nob3VsZFJldHJ5VW50aWxUaGVyZUFy\nZUVub3VnaEJrc0F2YWlsYWJsZUZvclJlcGxpY2F0aW9uKCkKICAgICAgICAg\nICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxo\nID0gYmtjLmNyZWF0ZUxlZGdlcigxLCAxLCBCb29rS2VlcGVyLkRpZ2VzdFR5\ncGUuQ1JDMzIsCiAgICAgICAgICAgICAgICBURVNUUEFTU1dEKTsKCiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAg\nIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAgICAgICBsaC5jbG9z\nZSgpOwogICAgICAgIEJvb2tpZVNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2ls\nbCA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5nZXRM\nZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQo\nMCk7CiAgICAgICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llIiwgcmVwbGlj\nYVRvS2lsbCk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBraWxsZWRC\nb29raWVDb25maWcgPSBraWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAg\nICAgICBpbnQgc3RhcnROZXdCb29raWUgPSBzdGFydE5ld0Jvb2tpZSgpOwog\nICAgICAgIEJvb2tpZVNvY2tldEFkZHJlc3MgbmV3QmtBZGRyID0gbmV3IEJv\nb2tpZVNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MKICAgICAgICAgICAgICAg\nIC5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBzdGFydE5ld0Jv\nb2tpZSk7CiAgICAgICAgTE9HLmluZm8oIk5ldyBCb29raWUgYWRkciA6IiAr\nIG5ld0JrQWRkcik7CgogICAgICAgIGtpbGxBbGxCb29raWVzKGxoLCBuZXdC\na0FkZHIpOwogICAgICAgIFJlcGxpY2F0aW9uV29ya2VyIHJ3ID0gbmV3IFJl\ncGxpY2F0aW9uV29ya2VyKHprYywgYmFzZUNvbmYsIG5ld0JrQWRkcik7Cgog\nICAgICAgIHJ3LnN0YXJ0KCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\ndW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdlclVuZGVycmVwbGlj\nYXRlZChsaC5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgIHJlcGxpY2FU\nb0tpbGwudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGludCBjb3VudGVyID0g\nMzA7CiAgICAgICAgICAgIHdoaWxlIChjb3VudGVyLS0gPiAwKSB7CiAgICAg\nICAgICAgICAgICBhc3NlcnRUcnVlKCJFeHBlY3RpbmcgdGhhdCByZXBsaWNh\ndGlvbiBzaG91bGQgbm90IGNvbXBsZXRlIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBs\naWNhdGlvbih6a2MsIGxoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLmdldElkKCksIGJhc2VQYXRoKSk7CiAgICAgICAgICAgICAgICBUaHJl\nYWQuc2xlZXAoMTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBy\nZXN0YXJ0IGtpbGxlZCBib29raWUKICAgICAgICAgICAgYnMuYWRkKHN0YXJ0\nQm9va2llKGtpbGxlZEJvb2tpZUNvbmZpZykpOwogICAgICAgICAgICBic0Nv\nbmZzLmFkZChraWxsZWRCb29raWVDb25maWcpOwogICAgICAgICAgICB3aGls\nZSAoUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNh\ndGlvbih6a2MsIGxoCiAgICAgICAgICAgICAgICAgICAgLmdldElkKCksIGJh\nc2VQYXRoKSkgewogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gU2hvdWxkIGJlIGFibGUg\ndG8gcmVhZCB0aGUgZW50cmllcyBmcm9tIDAtOQogICAgICAgICAgICB2ZXJp\nZnlSZWNvdmVyZWRMZWRnZXJzKGxoLCAwLCA5KTsKICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICBydy5zaHV0ZG93bigpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFRlc3RzIHRoYXQgcmVwbGljYXRpb24gd29y\na2VyMSBzaG91bGQgdGFrZSBvbmUgZnJhZ21lbnQgcmVwbGljYXRpb24gYW5k\nCiAgICAgKiBvdGhlciByZXBsaWNhdGlvbiB3b3JrZXIgYWxzbyBzaG91bGQg\nY29tcGV0ZSBmb3IgdGhlIHJlcGxpY2F0aW9uLgogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0ID0gOTAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0MlJXc1No\nb3VsZENvbXBldGVGb3JSZXBsaWNhdGlvbk9mMkZyYWdtZW50c0FuZENvbXBs\nZXRlUmVwbGljYXRpb24oKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2Vy\nKDIsIDIsIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAg\nICAgICAgIFRFU1RQQVNTV0QpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7\nCiAgICAgICAgfQogICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgQm9va2ll\nU29ja2V0QWRkcmVzcyByZXBsaWNhVG9LaWxsID0gTGVkZ2VySGFuZGxlQWRh\ncHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxoKS5n\nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKICAgICAgICBMT0cuaW5m\nbygiS2lsbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxsKTsKICAgICAgICBT\nZXJ2ZXJDb25maWd1cmF0aW9uIGtpbGxlZEJvb2tpZUNvbmZpZyA9IGtpbGxC\nb29raWUocmVwbGljYVRvS2lsbCk7CgogICAgICAgIGtpbGxBbGxCb29raWVz\nKGxoLCBudWxsKTsKICAgICAgICAvLyBTdGFydGUgUlcxCiAgICAgICAgaW50\nIHN0YXJ0TmV3Qm9va2llMSA9IHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAg\nQm9va2llU29ja2V0QWRkcmVzcyBuZXdCa0FkZHIxID0gbmV3IEJvb2tpZVNv\nY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MKICAgICAgICAgICAgICAgIC5nZXRM\nb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBzdGFydE5ld0Jvb2tpZTEp\nOwogICAgICAgIExPRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBuZXdC\na0FkZHIxKTsKICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydzEgPSBuZXcg\nUmVwbGljYXRpb25Xb3JrZXIoemtjLCBiYXNlQ29uZiwgbmV3QmtBZGRyMSk7\nCgogICAgICAgIC8vIFN0YXJ0ZSBSVzIKICAgICAgICBpbnQgc3RhcnROZXdC\nb29raWUyID0gc3RhcnROZXdCb29raWUoKTsKICAgICAgICBCb29raWVTb2Nr\nZXRBZGRyZXNzIG5ld0JrQWRkcjIgPSBuZXcgQm9va2llU29ja2V0QWRkcmVz\ncyhJbmV0QWRkcmVzcwogICAgICAgICAgICAgICAgLmdldExvY2FsSG9zdCgp\nLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3Qm9va2llMik7CiAgICAgICAg\nTE9HLmluZm8oIk5ldyBCb29raWUgYWRkciA6IiArIG5ld0JrQWRkcjIpOwog\nICAgICAgIFpvb0tlZXBlcldhdGNoZXJCYXNlIHcgPSBuZXcgWm9vS2VlcGVy\nV2F0Y2hlckJhc2UoMTAwMDApOwogICAgICAgIFpvb0tlZXBlciB6a2MxID0g\nWmtVdGlscy5jcmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGllbnQoCiAgICAg\nICAgICAgICAgICB6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygp\nLCB3KTsKICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydzIgPSBuZXcgUmVw\nbGljYXRpb25Xb3JrZXIoemtjMSwgYmFzZUNvbmYsCiAgICAgICAgICAgICAg\nICBuZXdCa0FkZHIyKTsKICAgICAgICBydzEuc3RhcnQoKTsKICAgICAgICBy\ndzIuc3RhcnQoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdW5kZXJS\nZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChs\naC5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgIHJlcGxpY2FUb0tpbGwu\ndG9TdHJpbmcoKSk7CiAgICAgICAgICAgIGludCBjb3VudGVyID0gMTA7CiAg\nICAgICAgICAgIHdoaWxlIChjb3VudGVyLS0gPiAwKSB7CiAgICAgICAgICAg\nICAgICBhc3NlcnRUcnVlKCJFeHBlY3RpbmcgdGhhdCByZXBsaWNhdGlvbiBz\naG91bGQgbm90IGNvbXBsZXRlIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nUmVwbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlv\nbih6a2MsIGxoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdl\ndElkKCksIGJhc2VQYXRoKSk7CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xl\nZXAoMTAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZXN0YXJ0\nIGtpbGxlZCBib29raWUKICAgICAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2ll\nKGtpbGxlZEJvb2tpZUNvbmZpZykpOwogICAgICAgICAgICBic0NvbmZzLmFk\nZChraWxsZWRCb29raWVDb25maWcpOwogICAgICAgICAgICB3aGlsZSAoUmVw\nbGljYXRpb25UZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlvbih6\na2MsIGxoCiAgICAgICAgICAgICAgICAgICAgLmdldElkKCksIGJhc2VQYXRo\nKSkgewogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgLy8gU2hvdWxkIGJlIGFibGUgdG8gcmVh\nZCB0aGUgZW50cmllcyBmcm9tIDAtOQogICAgICAgICAgICB2ZXJpZnlSZWNv\ndmVyZWRMZWRnZXJzKGxoLCAwLCA5KTsKICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICBydzEuc2h1dGRvd24oKTsKICAgICAgICAgICAgcncyLnNo\ndXRkb3duKCk7CiAgICAgICAgICAgIHprYzEuY2xvc2UoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0cyB0aGF0IFJlcGxpY2F0aW9u\nIHdvcmtlciBzaG91bGQgY2xlYW4gdGhlIGxlYWRnZXIgdW5kZXIgcmVwbGlj\nYXRpb24KICAgICAqIG5vZGUgb2YgdGhlIGxlZGdlciBhbHJlYWR5IGRlbGV0\nZWQKICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDMwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0UldTaG91bGRDbGVhblRoZUxlZGdlckZyb21VbmRlclJl\ncGxpY2F0aW9uSWZMZWRnZXJBbHJlYWR5RGVsZXRlZCgpCiAgICAgICAgICAg\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExlZGdlckhhbmRsZSBsaCA9\nIGJrYy5jcmVhdGVMZWRnZXIoMiwgMiwgQm9va0tlZXBlci5EaWdlc3RUeXBl\nLkNSQzMyLAogICAgICAgICAgICAgICAgVEVTVFBBU1NXRCk7CgogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBs\naC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CiAgICAgICAgbGguY2xvc2Uo\nKTsKICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwg\nPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVk\nZ2VyTWV0YWRhdGEobGgpLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDAp\nOwogICAgICAgIExPRy5pbmZvKCJLaWxsaW5nIEJvb2tpZSIsIHJlcGxpY2FU\nb0tpbGwpOwogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbCk7Cgog\nICAgICAgIGludCBzdGFydE5ld0Jvb2tpZSA9IHN0YXJ0TmV3Qm9va2llKCk7\nCiAgICAgICAgQm9va2llU29ja2V0QWRkcmVzcyBuZXdCa0FkZHIgPSBuZXcg\nQm9va2llU29ja2V0QWRkcmVzcyhJbmV0QWRkcmVzcwogICAgICAgICAgICAg\nICAgLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIHN0YXJ0TmV3\nQm9va2llKTsKICAgICAgICBMT0cuaW5mbygiTmV3IEJvb2tpZSBhZGRyIDoi\nICsgbmV3QmtBZGRyKTsKICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydyA9\nIG5ldyBSZXBsaWNhdGlvbldvcmtlcih6a2MsIGJhc2VDb25mLCBuZXdCa0Fk\nZHIpOwogICAgICAgIHJ3LnN0YXJ0KCk7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGJrYy5kZWxldGVMZWRnZXIobGguZ2V0SWQoKSk7IC8vIERlbGV0\naW5nIHRoZSBsZWRnZXIKICAgICAgICAgICAgLy8gQWxzbyBtYXJrIGxlZGdl\nciBhcyBpbiBVbmRlclJlcGxpY2F0aW9uCiAgICAgICAgICAgIHVuZGVyUmVw\nbGljYXRpb25NYW5hZ2VyLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGgu\nZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICByZXBsaWNhVG9LaWxsLnRv\nU3RyaW5nKCkpOwogICAgICAgICAgICB3aGlsZSAoUmVwbGljYXRpb25UZXN0\nVXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxoCiAgICAg\nICAgICAgICAgICAgICAgLmdldElkKCksIGJhc2VQYXRoKSkgewogICAgICAg\nICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBydy5zaHV0ZG93bigpOwog\nICAgICAgIH0KCiAgICB9CgogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdE11bHRpcGxlTGVkZ2VyUmVwbGljYXRpb25X\naXRoUmVwbGljYXRpb25Xb3JrZXIoKQogICAgICAgICAgICB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBMZWRnZXIxCiAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoMSA9IGJrYy5jcmVhdGVMZWRnZXIoMywgMywgQm9va0tlZXBlci5E\naWdlc3RUeXBlLkNSQzMyLAogICAgICAgICAgICAgICAgVEVTVFBBU1NXRCk7\nCgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAg\nICAgICAgICBsaDEuYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAg\nIEJvb2tpZVNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbEZyb21GaXJzdExl\nZGdlciA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5n\nZXRMZWRnZXJNZXRhZGF0YShsaDEpLmdldEVuc2VtYmxlcygpLmdldCgwTCku\nZ2V0KDApOwoKICAgICAgICBMT0cuaW5mbygiS2lsbGluZyBCb29raWUiLCBy\nZXBsaWNhVG9LaWxsRnJvbUZpcnN0TGVkZ2VyKTsKCiAgICAgICAgLy8gTGVk\nZ2VyMgogICAgICAgIExlZGdlckhhbmRsZSBsaDIgPSBia2MuY3JlYXRlTGVk\nZ2VyKDMsIDMsIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAg\nICAgICAgICAgIFRFU1RQQVNTV0QpOwoKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IDEwOyBpKyspIHsKICAgICAgICAgICAgbGgyLmFkZEVudHJ5KGRh\ndGEpOwogICAgICAgIH0KICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIHJl\ncGxpY2FUb0tpbGxGcm9tU2Vjb25kTGVkZ2VyID0gTGVkZ2VySGFuZGxlQWRh\ncHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxoMiku\nZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQoMCk7CgogICAgICAgIExPRy5p\nbmZvKCJLaWxsaW5nIEJvb2tpZSIsIHJlcGxpY2FUb0tpbGxGcm9tU2Vjb25k\nTGVkZ2VyKTsKCiAgICAgICAgLy8gS2lsbCBsZWRnZXIxCiAgICAgICAga2ls\nbEJvb2tpZShyZXBsaWNhVG9LaWxsRnJvbUZpcnN0TGVkZ2VyKTsKICAgICAg\nICBsaDEuY2xvc2UoKTsKICAgICAgICAvLyBLaWxsIGxlZGdlcjIKICAgICAg\nICBraWxsQm9va2llKHJlcGxpY2FUb0tpbGxGcm9tRmlyc3RMZWRnZXIpOwog\nICAgICAgIGxoMi5jbG9zZSgpOwoKICAgICAgICBpbnQgc3RhcnROZXdCb29r\naWUgPSBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICBCb29raWVTb2NrZXRB\nZGRyZXNzIG5ld0JrQWRkciA9IG5ldyBCb29raWVTb2NrZXRBZGRyZXNzKElu\nZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAuZ2V0TG9jYWxIb3N0KCkuZ2V0\nSG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29raWUpOwogICAgICAgIExPRy5p\nbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBuZXdCa0FkZHIpOwoKICAgICAg\nICBSZXBsaWNhdGlvbldvcmtlciBydyA9IG5ldyBSZXBsaWNhdGlvbldvcmtl\ncih6a2MsIGJhc2VDb25mLCBuZXdCa0FkZHIpOwoKICAgICAgICBydy5zdGFy\ndCgpOwogICAgICAgIHRyeSB7CgogICAgICAgICAgICAvLyBNYXJrIGxlZGdl\ncjEgYW5kIDIgYXMgdW5kZXJyZXBsaWNhdGVkCiAgICAgICAgICAgIHVuZGVy\nUmVwbGljYXRpb25NYW5hZ2VyLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQo\nbGgxLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAgcmVwbGljYVRvS2ls\nbEZyb21GaXJzdExlZGdlci50b1N0cmluZygpKTsKICAgICAgICAgICAgdW5k\nZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdlclVuZGVycmVwbGljYXRl\nZChsaDIuZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICByZXBsaWNhVG9L\naWxsRnJvbVNlY29uZExlZGdlci50b1N0cmluZygpKTsKCiAgICAgICAgICAg\nIHdoaWxlIChSZXBsaWNhdGlvblRlc3RVdGlsLmlzTGVkZ2VySW5VbmRlclJl\ncGxpY2F0aW9uKHprYywgbGgxCiAgICAgICAgICAgICAgICAgICAgLmdldElk\nKCksIGJhc2VQYXRoKSkgewogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVw\nKDEwMCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdoaWxlIChSZXBs\naWNhdGlvblRlc3RVdGlsLmlzTGVkZ2VySW5VbmRlclJlcGxpY2F0aW9uKHpr\nYywgbGgyCiAgICAgICAgICAgICAgICAgICAgLmdldElkKCksIGJhc2VQYXRo\nKSkgewogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGtpbGxBbGxCb29raWVzKGxoMSwgbmV3\nQmtBZGRyKTsKCiAgICAgICAgICAgIC8vIFNob3VsZCBiZSBhYmxlIHRvIHJl\nYWQgdGhlIGVudHJpZXMgZnJvbSAwLTkKICAgICAgICAgICAgdmVyaWZ5UmVj\nb3ZlcmVkTGVkZ2VycyhsaDEsIDAsIDkpOwogICAgICAgICAgICB2ZXJpZnlS\nZWNvdmVyZWRMZWRnZXJzKGxoMiwgMCwgOSk7CiAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgcncuc2h1dGRvd24oKTsKICAgICAgICB9CgogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdHMgdGhhdCBSZXBsaWNhdGlvbldvcmtl\nciBzaG91bGQgZmVuY2UgdGhlIGxlZGdlciBhbmQgcmVsZWFzZSBsZWRnZXIK\nICAgICAqIGxvY2sgYWZ0ZXIgdGltZW91dC4gVGhlbiByZXBsaWNhdGlvbiBz\naG91bGQgaGFwcGVuIG5vcm1hbGx5LgogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0ID0gNjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0UldTaG91bGRSZXBs\naWNhdGVUaGVMZWRnZXJzQWZ0ZXJUaW1lb3V0SWZMYXN0RnJhZ21lbnRJc1VS\nKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgTGVk\nZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBCb29rS2Vl\ncGVyLkRpZ2VzdFR5cGUuQ1JDMzIsCiAgICAgICAgICAgICAgICBURVNUUEFT\nU1dEKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7\nCiAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgIH0KICAg\nICAgICBCb29raWVTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGwgPSBMZWRn\nZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0\nYWRhdGEobGgpLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwoKICAg\nICAgICBMT0cuaW5mbygiS2lsbGluZyBCb29raWUiLCByZXBsaWNhVG9LaWxs\nKTsKICAgICAgICBraWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAgICAg\nICBpbnQgc3RhcnROZXdCb29raWUgPSBzdGFydE5ld0Jvb2tpZSgpOwoKICAg\nICAgICBCb29raWVTb2NrZXRBZGRyZXNzIG5ld0JrQWRkciA9IG5ldyBCb29r\naWVTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNzCiAgICAgICAgICAgICAgICAu\nZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgc3RhcnROZXdCb29r\naWUpOwogICAgICAgIExPRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIgKyBu\nZXdCa0FkZHIpOwoKICAgICAgICAvLyBzZXQgdG8gM3MgaW5zdGVhZCBvZiBk\nZWZhdWx0IDMwcwogICAgICAgIGJhc2VDb25mLnNldE9wZW5MZWRnZXJSZXJl\ncGxpY2F0aW9uR3JhY2VQZXJpb2QoIjMwMDAiKTsKICAgICAgICBSZXBsaWNh\ndGlvbldvcmtlciBydyA9IG5ldyBSZXBsaWNhdGlvbldvcmtlcih6a2MsIGJh\nc2VDb25mLCBuZXdCa0FkZHIpOwoKICAgICAgICBMZWRnZXJNYW5hZ2VyRmFj\ndG9yeSBtRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0b3J5CiAgICAgICAg\nICAgICAgICAubmV3TGVkZ2VyTWFuYWdlckZhY3RvcnkoYmFzZUNsaWVudENv\nbmYsIHprYyk7CiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFn\nZXIgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIgPSBtRmFjdG9yeQogICAgICAg\nICAgICAgICAgLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7\nCiAgICAgICAgcncuc3RhcnQoKTsKICAgICAgICB0cnkgewoKICAgICAgICAg\nICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdlclVuZGVycmVw\nbGljYXRlZChsaC5nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgIHJlcGxp\nY2FUb0tpbGwudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIHdoaWxlIChSZXBs\naWNhdGlvblRlc3RVdGlsLmlzTGVkZ2VySW5VbmRlclJlcGxpY2F0aW9uKHpr\nYywgbGgKICAgICAgICAgICAgICAgICAgICAuZ2V0SWQoKSwgYmFzZVBhdGgp\nKSB7CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBraWxsQWxsQm9va2llcyhsaCwgbmV3QmtB\nZGRyKTsKICAgICAgICAgICAgLy8gU2hvdWxkIGJlIGFibGUgdG8gcmVhZCB0\naGUgZW50cmllcyBmcm9tIDAtOQogICAgICAgICAgICB2ZXJpZnlSZWNvdmVy\nZWRMZWRnZXJzKGxoLCAwLCA5KTsKICAgICAgICAgICAgbGggPSBia2Mub3Bl\nbkxlZGdlck5vUmVjb3ZlcnkobGguZ2V0SWQoKSwKICAgICAgICAgICAgICAg\nICAgICBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsIFRFU1RQQVNTV0Qp\nOwogICAgICAgICAgICBhc3NlcnRGYWxzZSgiTGVkZ2VyIG11c3QgaGF2ZSBi\nZWVuIGNsb3NlZCBieSBSVyIsIENsaWVudFV0aWwKICAgICAgICAgICAgICAg\nICAgICAuaXNMZWRnZXJPcGVuKGxoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgcncuc2h1dGRvd24oKTsKICAgICAgICAgICAgdW5kZXJS\nZXBsaWNhdGlvbk1hbmFnZXIuY2xvc2UoKTsKICAgICAgICB9CgogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdHMgdGhhdCBSZXBsaWNhdGlvbldvcmtlciBz\naG91bGQgbm90IGhhdmUgaWRlbnRpZmllZCBmb3IgcG9zdHBvbmluZwogICAg\nICogdGhlIHJlcGxpY2F0aW9uIGlmIGxlZGdlciBpcyBpbiBvcGVuIHN0YXRl\nIGFuZCBsYXN0RnJhZ21lbnQgaXMgbm90IGluCiAgICAgKiB1bmRlclJlcGxp\nY2F0aW9uIHN0YXRlLiBOb3RlIHRoYXQgUlcgc2hvdWxkIG5vdCBmZW5jZSBz\ndWNoIGxlZGdlcnMuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAzMDAw\nMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSV1Nob3VsZFJlcGxpY2F0ZVRoZUxl\nZGdlcnNBZnRlclRpbWVvdXRJZkxhc3RGcmFnbWVudElzTm90VVIoKQogICAg\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJIYW5k\nbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIEJvb2tLZWVwZXIuRGln\nZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgIFRFU1RQQVNTV0QpOwoK\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAgICAg\nICAgICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIEJv\nb2tpZVNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbCA9IExlZGdlckhhbmRs\nZUFkYXB0ZXIKICAgICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShs\naCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQoMCk7CgogICAgICAgIExP\nRy5pbmZvKCJLaWxsaW5nIEJvb2tpZSIsIHJlcGxpY2FUb0tpbGwpOwogICAg\nICAgIGtpbGxCb29raWUocmVwbGljYVRvS2lsbCk7CgogICAgICAgIGludCBz\ndGFydE5ld0Jvb2tpZSA9IHN0YXJ0TmV3Qm9va2llKCk7CgogICAgICAgIC8v\nIFJlZm9ybSBlbnNlbWJsZS4uLk1ha2luZyBzdXJlIHRoYXQgbGFzdCBmcmFn\nbWVudCBpcyBub3QgaW4KICAgICAgICAvLyB1bmRlci1yZXBsaWNhdGlvbgog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAg\nICAgICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICB9CgogICAgICAgIEJv\nb2tpZVNvY2tldEFkZHJlc3MgbmV3QmtBZGRyID0gbmV3IEJvb2tpZVNvY2tl\ndEFkZHJlc3MoSW5ldEFkZHJlc3MKICAgICAgICAgICAgICAgIC5nZXRMb2Nh\nbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBzdGFydE5ld0Jvb2tpZSk7CiAg\nICAgICAgTE9HLmluZm8oIk5ldyBCb29raWUgYWRkciA6IiArIG5ld0JrQWRk\ncik7CgogICAgICAgIFJlcGxpY2F0aW9uV29ya2VyIHJ3ID0gbmV3IFJlcGxp\nY2F0aW9uV29ya2VyKHprYywgYmFzZUNvbmYsIG5ld0JrQWRkcik7CgogICAg\nICAgIExlZGdlck1hbmFnZXJGYWN0b3J5IG1GYWN0b3J5ID0gTGVkZ2VyTWFu\nYWdlckZhY3RvcnkKICAgICAgICAgICAgICAgIC5uZXdMZWRnZXJNYW5hZ2Vy\nRmFjdG9yeShiYXNlQ2xpZW50Q29uZiwgemtjKTsKICAgICAgICBMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB1bmRlclJlcGxpY2F0aW9uTWFuYWdl\nciA9IG1GYWN0b3J5CiAgICAgICAgICAgICAgICAubmV3TGVkZ2VyVW5kZXJy\nZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAgcncuc3RhcnQoKTsKICAg\nICAgICB0cnkgewoKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsaC5nZXRJZCgpLAogICAg\nICAgICAgICAgICAgICAgIHJlcGxpY2FUb0tpbGwudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgIHdoaWxlIChSZXBsaWNhdGlvblRlc3RVdGlsLmlzTGVkZ2Vy\nSW5VbmRlclJlcGxpY2F0aW9uKHprYywgbGgKICAgICAgICAgICAgICAgICAg\nICAuZ2V0SWQoKSwgYmFzZVBhdGgpKSB7CiAgICAgICAgICAgICAgICBUaHJl\nYWQuc2xlZXAoMTAwKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAga2ls\nbEFsbEJvb2tpZXMobGgsIG5ld0JrQWRkcik7CgogICAgICAgICAgICAvLyBT\naG91bGQgYmUgYWJsZSB0byByZWFkIHRoZSBlbnRyaWVzIGZyb20gMC05CiAg\nICAgICAgICAgIHZlcmlmeVJlY292ZXJlZExlZGdlcnMobGgsIDAsIDkpOwog\nICAgICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsaC5n\nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgIEJvb2tLZWVwZXIuRGlnZXN0\nVHlwZS5DUkMzMiwgVEVTVFBBU1NXRCk7CgogICAgICAgICAgICAvLyBMZWRn\nZXIgc2hvdWxkIGJlIHN0aWxsIGluIG9wZW4gc3RhdGUKICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZSgiTGVkZ2VyIG11c3QgaGF2ZSBiZWVuIGNsb3NlZCBieSBS\nVyIsIENsaWVudFV0aWwKICAgICAgICAgICAgICAgICAgICAuaXNMZWRnZXJP\ncGVuKGxoKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgcncu\nc2h1dGRvd24oKTsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIuY2xvc2UoKTsKICAgICAgICB9CgogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCB0aGF0IGlmIHRoZSBsb2NhbCBib29raWUgdHVybnMgb3V0IHRvIGJl\nIHJlYWRvbmx5LCB0aGVuIG5vIHBvaW50IGluIHJ1bm5pbmcgUlcuIFNvIFJX\nIHNob3VsZCBzaHV0ZG93bi4KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9\nIDIwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFJXU2h1dGRvd25PbkxvY2Fs\nQm9va2llUmVhZG9ubHlUcmFuc2l0aW9uKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigz\nLCAzLCBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsIFRFU1RQQVNTV0Qp\nOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAg\nICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAg\nIEJvb2tpZVNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbCA9CiAgICAgICAg\nICAgICAgICBMZWRnZXJIYW5kbGVBZGFwdGVyLmdldExlZGdlck1ldGFkYXRh\nKGxoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKTsKCiAgICAgICAg\nTE9HLmluZm8oIktpbGxpbmcgQm9va2llIiwgcmVwbGljYVRvS2lsbCk7CiAg\nICAgICAga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsKTsKCiAgICAgICAgaW50\nIG5ld0JrUG9ydCA9IHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxoLmFkZEVu\ndHJ5KGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgQm9va2llU29ja2V0QWRk\ncmVzcyBuZXdCa0FkZHIgPSBuZXcgQm9va2llU29ja2V0QWRkcmVzcyhJbmV0\nQWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBuZXdC\na1BvcnQpOwogICAgICAgIExPRy5pbmZvKCJOZXcgQm9va2llIGFkZHIgOiIg\nKyBuZXdCa0FkZHIpOwoKICAgICAgICBSZXBsaWNhdGlvbldvcmtlciBydyA9\nIG5ldyBSZXBsaWNhdGlvbldvcmtlcih6a2MsIGJhc2VDb25mLCBuZXdCa0Fk\nZHIpOwoKICAgICAgICBydy5zdGFydCgpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIEJvb2tpZVNlcnZlciBuZXdCayA9IGJzLmdldChicy5zaXplKCkg\nLSAxKTsKICAgICAgICAgICAgYnNDb25mcy5nZXQoYnNDb25mcy5zaXplKCkg\nLSAxKS5zZXRSZWFkT25seU1vZGVFbmFibGVkKHRydWUpOwogICAgICAgICAg\nICBuZXdCay5nZXRCb29raWUoKS50cmFuc2l0aW9uVG9SZWFkT25seU1vZGUo\nKTsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFya0xl\nZGdlclVuZGVycmVwbGljYXRlZChsaC5nZXRJZCgpLCByZXBsaWNhVG9LaWxs\nLnRvU3RyaW5nKCkpOwogICAgICAgICAgICB3aGlsZSAoUmVwbGljYXRpb25U\nZXN0VXRpbC5pc0xlZGdlckluVW5kZXJSZXBsaWNhdGlvbih6a2MsIGxoLmdl\ndElkKCksIGJhc2VQYXRoKSAmJiBydy5pc1J1bm5pbmcoKSkgewogICAgICAg\nICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgYXNzZXJ0RmFsc2UoIlJXIHNob3VsZCBzaHV0ZG93biBpZiB0\naGUgYm9va2llIGlzIHJlYWRvbmx5IiwgcncuaXNSdW5uaW5nKCkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHJ3LnNodXRkb3duKCk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IHRoZSBy\nZXBsaWNhdGlvbiB3b3JrZXIgd2lsbCBzaHV0ZG93biBpZiBpdCBsb3NlIGl0\ncyB6b29rZWVwZXIgc2Vzc2lvbgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0\nPTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFJXWktTZXNzaW9uTG9zdCgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFpvb0tlZXBlcldhdGNoZXJC\nYXNlIHcgPSBuZXcgWm9vS2VlcGVyV2F0Y2hlckJhc2UoMTAwMDApOwogICAg\nICAgIFpvb0tlZXBlciB6ayA9IFprVXRpbHMuY3JlYXRlQ29ubmVjdGVkWm9v\na2VlcGVyQ2xpZW50KAogICAgICAgICAgICAgICAgemtVdGlsLmdldFpvb0tl\nZXBlckNvbm5lY3RTdHJpbmcoKSwgdyk7CgogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIFJlcGxpY2F0aW9uV29ya2VyIHJ3ID0gbmV3IFJlcGxpY2F0aW9u\nV29ya2VyKHprLCBiYXNlQ29uZiwgZ2V0Qm9va2llKDApKTsKICAgICAgICAg\nICAgcncuc3RhcnQoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCAxMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAocncuaXNSdW5uaW5n\nKCkpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBhc3NlcnRUcnVlKCJSZXBsaWNhdGlv\nbiB3b3JrZXIgc2hvdWxkIGJlIHJ1bm5pbmciLCBydy5pc1J1bm5pbmcoKSk7\nCiAgICAgICAgICAgIHN0b3BaS0NsdXN0ZXIoKTsKCiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICAgICAg\naWYgKCFydy5pc1J1bm5pbmcoKSkgewogICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgVGhyZWFk\nLnNsZWVwKDEwMDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2Vy\ndEZhbHNlKCJSZXBsaWNhdGlvbiB3b3JrZXIgc2hvdWxkIGhhdmUgc2h1dCBk\nb3duIiwgcncuaXNSdW5uaW5nKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAg\nICAgICAgICAgIHprLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBraWxsQWxsQm9va2llcyhMZWRnZXJIYW5kbGUgbGgsIEJv\nb2tpZVNvY2tldEFkZHJlc3MgZXhjbHVkZUJLKQogICAgICAgICAgICB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBLaWxsaW5nIGFsbCBib29raWVz\nIGV4Y2VwdCBuZXdseSByZXBsaWNhdGVkIGJvb2tpZQogICAgICAgIFNldDxF\nbnRyeTxMb25nLCBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4+PiBl\nbnRyeVNldCA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgICAg\nIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5zZW1ibGVzKCkuZW50cnlT\nZXQoKTsKICAgICAgICBmb3IgKEVudHJ5PExvbmcsIEFycmF5TGlzdDxCb29r\naWVTb2NrZXRBZGRyZXNzPj4gZW50cnkgOiBlbnRyeVNldCkgewogICAgICAg\nICAgICBBcnJheUxpc3Q8Qm9va2llU29ja2V0QWRkcmVzcz4gYm9va2llcyA9\nIGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgIGZvciAoQm9va2llU29j\na2V0QWRkcmVzcyBib29raWUgOiBib29raWVzKSB7CiAgICAgICAgICAgICAg\nICBpZiAoYm9va2llLmVxdWFscyhleGNsdWRlQkspKSB7CiAgICAgICAgICAg\nICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBraWxsQm9va2llKGJvb2tpZSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlmeVJlY292ZXJl\nZExlZGdlcnMoTGVkZ2VySGFuZGxlIGxoLCBsb25nIHN0YXJ0RW50cnlJZCwK\nICAgICAgICAgICAgbG9uZyBlbmRFbnRyeUlkKSB0aHJvd3MgQktFeGNlcHRp\nb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJIYW5k\nbGUgbGhzID0gYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxoLmdldElkKCks\nCiAgICAgICAgICAgICAgICBCb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIs\nIFRFU1RQQVNTV0QpOwogICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVudHJ5\nPiBlbnRyaWVzID0gbGhzLnJlYWRFbnRyaWVzKHN0YXJ0RW50cnlJZCwKICAg\nICAgICAgICAgICAgIGVuZEVudHJ5SWQpOwogICAgICAgIGFzc2VydFRydWUo\nIlNob3VsZCBoYXZlIHRoZSBlbGVtZW50cyIsIGVudHJpZXMuaGFzTW9yZUVs\nZW1lbnRzKCkpOwogICAgICAgIHdoaWxlIChlbnRyaWVzLmhhc01vcmVFbGVt\nZW50cygpKSB7CiAgICAgICAgICAgIExlZGdlckVudHJ5IGVudHJ5ID0gZW50\ncmllcy5uZXh0RWxlbWVudCgpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMo\nIlRlc3RSZXBsaWNhdGlvbldvcmtlciIsIG5ldyBTdHJpbmcoZW50cnkuZ2V0\nRW50cnkoKSkpOwogICAgICAgIH0KICAgIH0KCn0K\n","encoding":"base64"}

