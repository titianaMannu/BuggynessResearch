{"sha":"9662777b5201aca9d4ecb80ba7c3ec52470bad57","node_id":"MDQ6QmxvYjE1NzU5NTY6OTY2Mjc3N2I1MjAxYWNhOWQ0ZWNiODBiYTdjM2VjNTI0NzBiYWQ1Nw==","size":19571,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9662777b5201aca9d4ecb80ba7c3ec52470bad57","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0QWRkcmVzczsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuTWFwLkVudHJ5OwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5UaW1lVW5pdDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5i\nb29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyVGVzdENsaWVudDsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkFic3RyYWN0Q29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkNsaWVudENv\nbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29u\nZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNvbmYuVGVzdEJLQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5tZXRhc3RvcmUuSW5NZW1vcnlNZXRhU3RvcmU7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0LkJvb2tpZVNvY2tl\ndEFkZHJlc3M7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nQm9va2llU2VydmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJl\ncGxpY2F0aW9uLkF1dG9SZWNvdmVyeU1haW47CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucmVwbGljYXRpb24uQXVkaXRvcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2Vw\ndGlvbi5Db21wYXRpYmlsaXR5RXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJlcGxpY2F0aW9uRXhjZXB0aW9u\nLlVuYXZhaWxhYmxlRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5jb21t\nb25zLmlvLkZpbGVVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9y\nZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogQSBjbGFzcyBy\ndW5zIHNldmVyYWwgYm9va2llIHNlcnZlcnMgZm9yIHRlc3RpbmcuCiAqLwpw\ndWJsaWMgYWJzdHJhY3QgY2xhc3MgQm9va0tlZXBlckNsdXN0ZXJUZXN0Q2Fz\nZSB7CgogICAgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0\nb3J5LmdldExvZ2dlcihCb29rS2VlcGVyQ2x1c3RlclRlc3RDYXNlLmNsYXNz\nKTsKCiAgICAvLyBab29LZWVwZXIgcmVsYXRlZCB2YXJpYWJsZXMKICAgIHBy\nb3RlY3RlZCBab29LZWVwZXJVdGlsIHprVXRpbCA9IG5ldyBab29LZWVwZXJV\ndGlsKCk7CiAgICBwcm90ZWN0ZWQgWm9vS2VlcGVyIHprYzsKCiAgICAvLyBC\nb29rS2VlcGVyIHJlbGF0ZWQgdmFyaWFibGVzCiAgICBwcm90ZWN0ZWQgTGlz\ndDxGaWxlPiB0bXBEaXJzID0gbmV3IExpbmtlZExpc3Q8RmlsZT4oKTsKICAg\nIHByb3RlY3RlZCBMaXN0PEJvb2tpZVNlcnZlcj4gYnMgPSBuZXcgTGlua2Vk\nTGlzdDxCb29raWVTZXJ2ZXI+KCk7CiAgICBwcm90ZWN0ZWQgTGlzdDxTZXJ2\nZXJDb25maWd1cmF0aW9uPiBic0NvbmZzID0gbmV3IExpbmtlZExpc3Q8U2Vy\ndmVyQ29uZmlndXJhdGlvbj4oKTsKICAgIHByb3RlY3RlZCBpbnQgbnVtQm9v\na2llczsKICAgIHByb3RlY3RlZCBCb29rS2VlcGVyVGVzdENsaWVudCBia2M7\nCgogICAgcHJvdGVjdGVkIFNlcnZlckNvbmZpZ3VyYXRpb24gYmFzZUNvbmYg\nPSBUZXN0QktDb25maWd1cmF0aW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24o\nKTsKICAgIHByb3RlY3RlZCBDbGllbnRDb25maWd1cmF0aW9uIGJhc2VDbGll\nbnRDb25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsKCiAgICBwcml2\nYXRlIE1hcDxCb29raWVTZXJ2ZXIsIEF1dG9SZWNvdmVyeU1haW4+IGF1dG9S\nZWNvdmVyeVByb2Nlc3NlcyA9IG5ldyBIYXNoTWFwPEJvb2tpZVNlcnZlciwg\nQXV0b1JlY292ZXJ5TWFpbj4oKTsKCiAgICBwcml2YXRlIGJvb2xlYW4gaXNB\ndXRvUmVjb3ZlcnlFbmFibGVkOwoKICAgIHB1YmxpYyBCb29rS2VlcGVyQ2x1\nc3RlclRlc3RDYXNlKGludCBudW1Cb29raWVzKSB7CiAgICAgICAgdGhpcy5u\ndW1Cb29raWVzID0gbnVtQm9va2llczsKICAgIH0KCiAgICBAQmVmb3JlCiAg\nICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIExPRy5pbmZvKCJTZXR0aW5nIHVwIHRlc3Qge30iLCBnZXRDbGFzcygp\nKTsKICAgICAgICBJbk1lbW9yeU1ldGFTdG9yZS5yZXNldCgpOwogICAgICAg\nIHNldE1ldGFzdG9yZUltcGxDbGFzcyhiYXNlQ29uZik7CiAgICAgICAgc2V0\nTWV0YXN0b3JlSW1wbENsYXNzKGJhc2VDbGllbnRDb25mKTsKCiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgLy8gc3RhcnQgem9va2VlcGVyIHNlcnZpY2UK\nICAgICAgICAgICAgc3RhcnRaS0NsdXN0ZXIoKTsKICAgICAgICAgICAgLy8g\nc3RhcnQgYm9va2tlZXBlciBzZXJ2aWNlCiAgICAgICAgICAgIHN0YXJ0QktD\nbHVzdGVyKCk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBzZXR0aW5nIHVwIiwgZSk7CiAg\nICAgICAgICAgIHRocm93IGU7CiAgICAgICAgfQogICAgfQoKICAgIEBBZnRl\ncgogICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBMT0cuaW5mbygiVGVhckRvd24iKTsKICAgICAgICAvLyBz\ndG9wIGJvb2trZWVwZXIgc2VydmljZQogICAgICAgIHN0b3BCS0NsdXN0ZXIo\nKTsKICAgICAgICAvLyBzdG9wIHpvb2tlZXBlciBzZXJ2aWNlCiAgICAgICAg\nc3RvcFpLQ2x1c3RlcigpOwogICAgICAgIExPRy5pbmZvKCJUZWFyaW5nIGRv\nd24gdGVzdCB7fSIsIGdldENsYXNzKCkpOwogICAgfQoKICAgIC8qKgogICAg\nICogU3RhcnQgem9va2VlcGVyIGNsdXN0ZXIKICAgICAqCiAgICAgKiBAdGhy\nb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdGFy\ndFpLQ2x1c3RlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHprVXRp\nbC5zdGFydFNlcnZlcigpOwogICAgICAgIHprYyA9IHprVXRpbC5nZXRab29L\nZWVwZXJDbGllbnQoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0b3Agem9v\na2VlcGVyIGNsdXN0ZXIKICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlv\nbgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9wWktDbHVzdGVyKCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgemtVdGlsLmtpbGxTZXJ2ZXIo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFN0YXJ0IGNsdXN0ZXIuIEFsc28s\nIHN0YXJ0cyB0aGUgYXV0byByZWNvdmVyeSBwcm9jZXNzIGZvciBlYWNoIGJv\nb2tpZSwgaWYKICAgICAqIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBpcyB0cnVl\nLgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHN0YXJ0QktDbHVzdGVyKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgYmFzZUNsaWVudENvbmYuc2V0WmtTZXJ2ZXJzKHpr\nVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAgIGlm\nIChudW1Cb29raWVzID4gMCkgewogICAgICAgICAgICBia2MgPSBuZXcgQm9v\na0tlZXBlclRlc3RDbGllbnQoYmFzZUNsaWVudENvbmYpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gQ3JlYXRlIEJvb2tpZSBTZXJ2ZXJzIChCMSwgQjIsIEIz\nKQogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtQm9va2llczsgaSsr\nKSB7CiAgICAgICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogU3RvcCBjbHVzdGVyLiBBbHNvLCBzdG9w\ncyBhbGwgdGhlIGF1dG8gcmVjb3ZlcnkgcHJvY2Vzc2VzIGZvciB0aGUgYm9v\na2llCiAgICAgKiBjbHVzdGVyLCBpZiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQg\naXMgdHJ1ZS4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAg\nICovCiAgICBwcm90ZWN0ZWQgdm9pZCBzdG9wQktDbHVzdGVyKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGJrYyAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGJrYy5jbG9zZSgpOzsKICAgICAgICB9CgogICAgICAgIGZvciAo\nQm9va2llU2VydmVyIHNlcnZlciA6IGJzKSB7CiAgICAgICAgICAgIHNlcnZl\nci5zaHV0ZG93bigpOwogICAgICAgICAgICBBdXRvUmVjb3ZlcnlNYWluIGF1\ndG9SZWNvdmVyeSA9IGF1dG9SZWNvdmVyeVByb2Nlc3Nlcy5nZXQoc2VydmVy\nKTsKICAgICAgICAgICAgaWYgKGF1dG9SZWNvdmVyeSAhPSBudWxsICYmIGlz\nQXV0b1JlY292ZXJ5RW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBhdXRv\nUmVjb3Zlcnkuc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiU2h1dGRvd24gYXV0byByZWNvdmVyeSBmb3IgYm9va2llc2VydmVyOiIK\nICAgICAgICAgICAgICAgICAgICAgICAgKyBzZXJ2ZXIuZ2V0TG9jYWxBZGRy\nZXNzKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJzLmNs\nZWFyKCk7CiAgICAgICAgZm9yIChGaWxlIGYgOiB0bXBEaXJzKSB7CiAgICAg\nICAgICAgIEZpbGVVdGlscy5kZWxldGVEaXJlY3RvcnkoZik7CiAgICAgICAg\nfQogICAgfQoKICAgIHByb3RlY3RlZCBTZXJ2ZXJDb25maWd1cmF0aW9uIG5l\nd1NlcnZlckNvbmZpZ3VyYXRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBGaWxlIGYgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAi\ndGVzdCIpOwogICAgICAgIHRtcERpcnMuYWRkKGYpOwogICAgICAgIGYuZGVs\nZXRlKCk7CiAgICAgICAgZi5ta2RpcigpOwoKICAgICAgICBpbnQgcG9ydCA9\nIFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAgIHJldHVybiBu\nZXdTZXJ2ZXJDb25maWd1cmF0aW9uKHBvcnQsIHprVXRpbC5nZXRab29LZWVw\nZXJDb25uZWN0U3RyaW5nKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgZiwgbmV3IEZpbGVbXSB7IGYgfSk7CiAgICB9CgogICAg\ncHJvdGVjdGVkIFNlcnZlckNvbmZpZ3VyYXRpb24gbmV3U2VydmVyQ29uZmln\ndXJhdGlvbihpbnQgcG9ydCwgU3RyaW5nIHprU2VydmVycywgRmlsZSBqb3Vy\nbmFsRGlyLCBGaWxlW10gbGVkZ2VyRGlycykgewogICAgICAgIFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKGJh\nc2VDb25mKTsKICAgICAgICBjb25mLnNldEJvb2tpZVBvcnQocG9ydCk7CiAg\nICAgICAgY29uZi5zZXRaa1NlcnZlcnMoemtTZXJ2ZXJzKTsKICAgICAgICBj\nb25mLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKTsK\nICAgICAgICBjb25mLnNldEFsbG93TG9vcGJhY2sodHJ1ZSk7CiAgICAgICAg\nU3RyaW5nW10gbGVkZ2VyRGlyTmFtZXMgPSBuZXcgU3RyaW5nW2xlZGdlckRp\ncnMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpPTA7IGk8bGVkZ2VyRGly\ncy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBsZWRnZXJEaXJOYW1lc1tp\nXSA9IGxlZGdlckRpcnNbaV0uZ2V0UGF0aCgpOwogICAgICAgIH0KICAgICAg\nICBjb25mLnNldExlZGdlckRpck5hbWVzKGxlZGdlckRpck5hbWVzKTsKICAg\nICAgICByZXR1cm4gY29uZjsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBi\nb29raWUgYWRkcmVzcyBmb3IgYm9va2llIGF0IGluZGV4CiAgICAgKi8KICAg\nIHB1YmxpYyBCb29raWVTb2NrZXRBZGRyZXNzIGdldEJvb2tpZShpbnQgaW5k\nZXgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGlmIChicy5zaXplKCkg\nPD0gaW5kZXggfHwgaW5kZXggPCAwKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIkludmFsaWQgaW5kZXgsIHRo\nZXJlIGFyZSBvbmx5ICIgKyBicy5zaXplKCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgYm9va2llcy4gQXNr\nZWQgZm9yICIgKyBpbmRleCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBi\ncy5nZXQoaW5kZXgpLmdldExvY2FsQWRkcmVzcygpOwogICAgfQoKICAgIC8q\nKgogICAgICogS2lsbCBhIGJvb2tpZSBieSBpdHMgc29ja2V0IGFkZHJlc3Mu\nIEFsc28sIHN0b3BzIHRoZSBhdXRvcmVjb3ZlcnkgcHJvY2VzcwogICAgICog\nZm9yIHRoZSBjb3JyZXNwb25kaW5nIGJvb2tpZSBzZXJ2ZXIsIGlmIGlzQXV0\nb1JlY292ZXJ5RW5hYmxlZCBpcyB0cnVlLgogICAgICoKICAgICAqIEBwYXJh\nbSBhZGRyCiAgICAgKiAgICAgICAgICAgIFNvY2tldCBBZGRyZXNzCiAgICAg\nKiBAcmV0dXJuIHRoZSBjb25maWd1cmF0aW9uIG9mIGtpbGxlZCBib29raWUK\nICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqLwog\nICAgcHVibGljIFNlcnZlckNvbmZpZ3VyYXRpb24ga2lsbEJvb2tpZShCb29r\naWVTb2NrZXRBZGRyZXNzIGFkZHIpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIEJvb2tpZVNlcnZlciB0b1JlbW92ZSA9IG51bGw7CiAgICAgICAgaW50\nIHRvUmVtb3ZlSW5kZXggPSAwOwogICAgICAgIGZvciAoQm9va2llU2VydmVy\nIHNlcnZlciA6IGJzKSB7CiAgICAgICAgICAgIGlmIChzZXJ2ZXIuZ2V0TG9j\nYWxBZGRyZXNzKCkuZXF1YWxzKGFkZHIpKSB7CiAgICAgICAgICAgICAgICBz\nZXJ2ZXIuc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgIHRvUmVtb3ZlID0g\nc2VydmVyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgKyt0b1JlbW92ZUluZGV4OwogICAgICAgIH0KICAgICAg\nICBpZiAodG9SZW1vdmUgIT0gbnVsbCkgewogICAgICAgICAgICBzdG9wQXV0\nb1JlY292ZXJ5U2VydmljZSh0b1JlbW92ZSk7CiAgICAgICAgICAgIGJzLnJl\nbW92ZSh0b1JlbW92ZSk7CiAgICAgICAgICAgIHJldHVybiBic0NvbmZzLnJl\nbW92ZSh0b1JlbW92ZUluZGV4KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICB9CgogICAgLyoqCiAgICAgKiBLaWxsIGEgYm9va2llIGJ5\nIGluZGV4LiBBbHNvLCBzdG9wcyB0aGUgcmVzcGVjdGl2ZSBhdXRvIHJlY292\nZXJ5IHByb2Nlc3MKICAgICAqIGZvciB0aGlzIGJvb2tpZSwgaWYgaXNBdXRv\nUmVjb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAgICAgKgogICAgICogQHBhcmFt\nIGluZGV4CiAgICAgKiAgICAgICAgICAgIEJvb2tpZSBJbmRleAogICAgICog\nQHJldHVybiB0aGUgY29uZmlndXJhdGlvbiBvZiBraWxsZWQgYm9va2llCiAg\nICAgKiBAdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhy\nb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBTZXJ2ZXJDb25m\naWd1cmF0aW9uIGtpbGxCb29raWUoaW50IGluZGV4KSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoaW5kZXggPj0gYnMuc2l6ZSgpKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiQm9va2llIGRvZXMgbm90\nIGV4aXN0Iik7CiAgICAgICAgfQogICAgICAgIEJvb2tpZVNlcnZlciBzZXJ2\nZXIgPSBicy5nZXQoaW5kZXgpOwogICAgICAgIHNlcnZlci5zaHV0ZG93bigp\nOwogICAgICAgIHN0b3BBdXRvUmVjb3ZlcnlTZXJ2aWNlKHNlcnZlcik7CiAg\nICAgICAgYnMucmVtb3ZlKHNlcnZlcik7CiAgICAgICAgcmV0dXJuIGJzQ29u\nZnMucmVtb3ZlKGluZGV4KTsKICAgIH0KCiAgICAvKioKICAgICAqIFNsZWVw\nIGEgYm9va2llCiAgICAgKgogICAgICogQHBhcmFtIGFkZHIKICAgICAqICAg\nICAgICAgIFNvY2tldCBBZGRyZXNzCiAgICAgKiBAcGFyYW0gc2Vjb25kcwog\nICAgICogICAgICAgICAgU2xlZXAgc2Vjb25kcwogICAgICogQHJldHVybiBD\nb3VudCBEb3duIGxhdGNoIHdoaWNoIHdpbGwgYmUgY291bnRlZCBkb3duIHdo\nZW4gc2xlZXAgZmluaXNoZXMKICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRF\neGNlcHRpb24KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwog\nICAgcHVibGljIENvdW50RG93bkxhdGNoIHNsZWVwQm9va2llKEJvb2tpZVNv\nY2tldEFkZHJlc3MgYWRkciwgZmluYWwgaW50IHNlY29uZHMpCiAgICAgICAg\nICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZvciAoZmluYWwgQm9v\na2llU2VydmVyIGJvb2tpZSA6IGJzKSB7CiAgICAgICAgICAgIGlmIChib29r\naWUuZ2V0TG9jYWxBZGRyZXNzKCkuZXF1YWxzKGFkZHIpKSB7CiAgICAgICAg\nICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBsID0gbmV3IENvdW50RG93\nbkxhdGNoKDEpOwogICAgICAgICAgICAgICAgVGhyZWFkIHNsZWVwZXIgPSBu\nZXcgVGhyZWFkKCkgewogICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBib29raWUuc3VzcGVuZFByb2Nlc3Np\nbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsLmNvdW50\nRG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVh\nZC5zbGVlcChzZWNvbmRzKjEwMDApOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGJvb2tpZS5yZXN1bWVQcm9jZXNzaW5nKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJy\nb3Igc3VzcGVuZGluZyBib29raWUiLCBlKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBzbGVlcGVyLnN0YXJ0\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gbDsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkJvb2tp\nZSBub3QgZm91bmQiKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNsZWVwIGEg\nYm9va2llIHVudGlsIEkgY291bnQgZG93biB0aGUgbGF0Y2gKICAgICAqCiAg\nICAgKiBAcGFyYW0gYWRkcgogICAgICogICAgICAgICAgU29ja2V0IEFkZHJl\nc3MKICAgICAqIEBwYXJhbSBsCiAgICAgKiAgICAgICAgICBMYXRjaCB0byB3\nYWl0IG9uCiAgICAgKiBAdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAg\nICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2\nb2lkIHNsZWVwQm9va2llKEJvb2tpZVNvY2tldEFkZHJlc3MgYWRkciwgZmlu\nYWwgQ291bnREb3duTGF0Y2ggbCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgZm9yIChmaW5hbCBCb29raWVTZXJ2ZXIgYm9va2ll\nIDogYnMpIHsKICAgICAgICAgICAgaWYgKGJvb2tpZS5nZXRMb2NhbEFkZHJl\nc3MoKS5lcXVhbHMoYWRkcikpIHsKICAgICAgICAgICAgICAgIGJvb2tpZS5z\ndXNwZW5kUHJvY2Vzc2luZygpOwogICAgICAgICAgICAgICAgVGhyZWFkIHNs\nZWVwZXIgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwuYXdhaXQoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGJvb2tpZS5yZXN1bWVQcm9jZXNz\naW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkVycm9yIHN1c3BlbmRpbmcgYm9va2llIiwgZSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9OwogICAgICAgICAgICAgICAgc2xlZXBlci5zdGFydCgpOwog\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiQm9va2llIG5vdCBm\nb3VuZCIpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzdGFydCBib29raWUg\nc2VydmVycy4gQWxzbyByZXN0YXJ0cyBhbGwgdGhlIHJlc3BlY3RpdmUgYXV0\nbyByZWNvdmVyeQogICAgICogcHJvY2VzcywgaWYgaXNBdXRvUmVjb3ZlcnlF\nbmFibGVkIGlzIHRydWUuCiAgICAgKgogICAgICogQHRocm93cyBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbgogICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAg\nICogQHRocm93cyBLZWVwZXJFeGNlcHRpb24KICAgICAqIEB0aHJvd3MgQm9v\na2llRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJlc3RhcnRC\nb29raWVzKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgcmVzdGFydEJvb2tpZXMobnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAg\nKiBSZXN0YXJ0IGJvb2tpZSBzZXJ2ZXJzIHVzaW5nIG5ldyBjb25maWd1cmF0\naW9uIHNldHRpbmdzLiBBbHNvIHJlc3RhcnQgdGhlCiAgICAgKiByZXNwZWN0\naXZlIGF1dG8gcmVjb3ZlcnkgcHJvY2VzcywgaWYgaXNBdXRvUmVjb3ZlcnlF\nbmFibGVkIGlzIHRydWUuCiAgICAgKgogICAgICogQHBhcmFtIG5ld0NvbmYK\nICAgICAqICAgICAgICAgICAgTmV3IENvbmZpZ3VyYXRpb24gU2V0dGluZ3MK\nICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24KICAgICAqIEB0\naHJvd3MgSU9FeGNlcHRpb24KICAgICAqIEB0aHJvd3MgS2VlcGVyRXhjZXB0\naW9uCiAgICAgKiBAdGhyb3dzIEJvb2tpZUV4Y2VwdGlvbgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCByZXN0YXJ0Qm9va2llcyhTZXJ2ZXJDb25maWd1cmF0\naW9uIG5ld0NvbmYpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIC8vIHNodXQgZG93biBib29raWUgc2VydmVyCiAgICAgICAgZm9y\nIChCb29raWVTZXJ2ZXIgc2VydmVyIDogYnMpIHsKICAgICAgICAgICAgc2Vy\ndmVyLnNodXRkb3duKCk7CiAgICAgICAgICAgIHN0b3BBdXRvUmVjb3ZlcnlT\nZXJ2aWNlKHNlcnZlcik7CiAgICAgICAgfQogICAgICAgIGJzLmNsZWFyKCk7\nCiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAgIC8vIHJlc3Rh\ncnQgdGhlbSB0byBlbnN1cmUgd2UgY2FuJ3QKICAgICAgICBmb3IgKFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZiA6IGJzQ29uZnMpIHsKICAgICAgICAgICAg\naWYgKG51bGwgIT0gbmV3Q29uZikgewogICAgICAgICAgICAgICAgY29uZi5s\nb2FkQ29uZihuZXdDb25mKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBi\ncy5hZGQoc3RhcnRCb29raWUoY29uZikpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEhlbHBlciBtZXRob2QgdG8gc3RhcnR1cCBhIG5ldyBi\nb29raWUgc2VydmVyIHdpdGggdGhlIGluZGljYXRlZCBwb3J0CiAgICAgKiBu\ndW1iZXIuIEFsc28sIHN0YXJ0cyB0aGUgYXV0byByZWNvdmVyeSBwcm9jZXNz\nLCBpZiB0aGUKICAgICAqIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBpcyBzZXQg\ndHJ1ZS4KICAgICAqCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAg\nKi8KICAgIHB1YmxpYyBpbnQgc3RhcnROZXdCb29raWUoKQogICAgICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYgPSBuZXdTZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAg\nYnNDb25mcy5hZGQoY29uZik7CiAgICAgICAgYnMuYWRkKHN0YXJ0Qm9va2ll\nKGNvbmYpKTsKCiAgICAgICAgcmV0dXJuIGNvbmYuZ2V0Qm9va2llUG9ydCgp\nOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhvZCB0byBzdGFy\ndHVwIGEgYm9va2llIHNlcnZlciB1c2luZyBhIGNvbmZpZ3VyYXRpb24gb2Jq\nZWN0LgogICAgICogQWxzbywgc3RhcnRzIHRoZSBhdXRvIHJlY292ZXJ5IHBy\nb2Nlc3MgaWYgaXNBdXRvUmVjb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAgICAg\nKgogICAgICogQHBhcmFtIGNvbmYKICAgICAqICAgICAgICAgICAgU2VydmVy\nIENvbmZpZ3VyYXRpb24gT2JqZWN0CiAgICAgKgogICAgICovCiAgICBwcm90\nZWN0ZWQgQm9va2llU2VydmVyIHN0YXJ0Qm9va2llKFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZikKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgQm9va2llU2VydmVyIHNlcnZlciA9IG5ldyBCb29raWVTZXJ2ZXIo\nY29uZik7CiAgICAgICAgc2VydmVyLnN0YXJ0KCk7CgogICAgICAgIGludCBw\nb3J0ID0gY29uZi5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgU3RyaW5nIGhv\nc3QgPSBJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVz\ncygpOwogICAgICAgIGlmIChjb25mLmdldFVzZUhvc3ROYW1lQXNCb29raWVJ\nRCgpKSB7CiAgICAgICAgICAgIGhvc3QgPSBJbmV0QWRkcmVzcy5nZXRMb2Nh\nbEhvc3QoKS5nZXRDYW5vbmljYWxIb3N0TmFtZSgpOwogICAgICAgIH0KICAg\nICAgICB3aGlsZSAoYmtjLmdldFprSGFuZGxlKCkuZXhpc3RzKAogICAgICAg\nICAgICAgICAgIi9sZWRnZXJzL2F2YWlsYWJsZS8iICsgaG9zdCArICI6IiAr\nIHBvcnQsIGZhbHNlKSA9PSBudWxsKSB7CiAgICAgICAgICAgIFRocmVhZC5z\nbGVlcCg1MDApOwogICAgICAgIH0KCiAgICAgICAgYmtjLnJlYWRCb29raWVz\nQmxvY2tpbmcoKTsKICAgICAgICBMT0cuaW5mbygiTmV3IGJvb2tpZSBvbiBw\nb3J0ICIgKyBwb3J0ICsgIiBoYXMgYmVlbiBjcmVhdGVkLiIpOwoKICAgICAg\nICB0cnkgewogICAgICAgICAgICBzdGFydEF1dG9SZWNvdmVyeShzZXJ2ZXIs\nIGNvbmYpOwogICAgICAgIH0gY2F0Y2ggKENvbXBhdGliaWxpdHlFeGNlcHRp\nb24gY2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gd2hp\nbGUgc3RhcnRpbmcgQXV0b1JlY292ZXJ5ISIsIGNlKTsKICAgICAgICB9IGNh\ndGNoIChVbmF2YWlsYWJsZUV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICBM\nT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSBzdGFydGluZyBBdXRvUmVjb3Zl\ncnkhIiwgdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VydmVyOwog\nICAgfQoKICAgIC8qKgogICAgICogU3RhcnQgYSBib29raWUgd2l0aCB0aGUg\nZ2l2ZW4gYm9va2llIGluc3RhbmNlLiBBbHNvLCBzdGFydHMgdGhlIGF1dG8K\nICAgICAqIHJlY292ZXJ5IGZvciB0aGlzIGJvb2tpZSwgaWYgaXNBdXRvUmVj\nb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAgICAgKi8KICAgIHByb3RlY3RlZCBC\nb29raWVTZXJ2ZXIgc3RhcnRCb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBj\nb25mLCBmaW5hbCBCb29raWUgYikKICAgICAgICAgICAgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQm9va2llU2VydmVyIHNlcnZlciA9IG5ldyBCb29r\naWVTZXJ2ZXIoY29uZikgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHJvdGVjdGVkIEJvb2tpZSBuZXdCb29raWUoU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYjsKICAg\nICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgc2VydmVyLnN0YXJ0KCk7\nCgogICAgICAgIGludCBwb3J0ID0gY29uZi5nZXRCb29raWVQb3J0KCk7CiAg\nICAgICAgU3RyaW5nIGhvc3QgPSBJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3Qo\nKS5nZXRIb3N0QWRkcmVzcygpOwogICAgICAgIGlmIChjb25mLmdldFVzZUhv\nc3ROYW1lQXNCb29raWVJRCgpKSB7CiAgICAgICAgICAgIGhvc3QgPSBJbmV0\nQWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRDYW5vbmljYWxIb3N0TmFtZSgp\nOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoYmtjLmdldFprSGFuZGxlKCku\nZXhpc3RzKAogICAgICAgICAgICAgICAgIi9sZWRnZXJzL2F2YWlsYWJsZS8i\nICsgaG9zdCArICI6IiArIHBvcnQsIGZhbHNlKSA9PSBudWxsKSB7CiAgICAg\nICAgICAgIFRocmVhZC5zbGVlcCg1MDApOwogICAgICAgIH0KCiAgICAgICAg\nYmtjLnJlYWRCb29raWVzQmxvY2tpbmcoKTsKICAgICAgICBMT0cuaW5mbygi\nTmV3IGJvb2tpZSBvbiBwb3J0ICIgKyBwb3J0ICsgIiBoYXMgYmVlbiBjcmVh\ndGVkLiIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0YXJ0QXV0b1Jl\nY292ZXJ5KHNlcnZlciwgY29uZik7CiAgICAgICAgfSBjYXRjaCAoQ29tcGF0\naWJpbGl0eUV4Y2VwdGlvbiBjZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIkV4Y2VwdGlvbiB3aGlsZSBzdGFydGluZyBBdXRvUmVjb3ZlcnkhIiwgY2Up\nOwogICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIHVlKSB7\nCiAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHN0YXJ0\naW5nIEF1dG9SZWNvdmVyeSEiLCB1ZSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBzZXJ2ZXI7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0TWV0YXN0\nb3JlSW1wbENsYXNzKEFic3RyYWN0Q29uZmlndXJhdGlvbiBjb25mKSB7CiAg\nICAgICAgY29uZi5zZXRNZXRhc3RvcmVJbXBsQ2xhc3MoSW5NZW1vcnlNZXRh\nU3RvcmUuY2xhc3MuZ2V0TmFtZSgpKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIEZsYWdzIHVzZWQgdG8gZW5hYmxlL2Rpc2FibGUgdGhlIGF1dG8gcmVjb3Zl\ncnkgcHJvY2Vzcy4gSWYgaXQgaXMgZW5hYmxlZCwKICAgICAqIHN0YXJ0aW5n\nIHRoZSBib29raWUgc2VydmVyIHdpbGwgc3RhcnRzIHRoZSBhdXRvIHJlY292\nZXJ5IHByb2Nlc3MgZm9yIHRoYXQKICAgICAqIGJvb2tpZS4gQWxzbywgc3Rv\ncHBpbmcgYm9va2llIHdpbGwgc3RvcHMgdGhlIHJlc3BlY3RpdmUgYXV0byBy\nZWNvdmVyeQogICAgICogcHJvY2Vzcy4KICAgICAqCiAgICAgKiBAcGFyYW0g\naXNBdXRvUmVjb3ZlcnlFbmFibGVkCiAgICAgKiAgICAgICAgICAgIFZhbHVl\nIHRydWUgd2lsbCBlbmFibGUgdGhlIGF1dG8gcmVjb3ZlcnkgcHJvY2Vzcy4g\nVmFsdWUgZmFsc2UKICAgICAqICAgICAgICAgICAgd2lsbCBkaXNhYmxlIHRo\nZSBhdXRvIHJlY292ZXJ5IHByb2Nlc3MKICAgICAqLwogICAgcHVibGljIHZv\naWQgc2V0QXV0b1JlY292ZXJ5RW5hYmxlZChib29sZWFuIGlzQXV0b1JlY292\nZXJ5RW5hYmxlZCkgewogICAgICAgIHRoaXMuaXNBdXRvUmVjb3ZlcnlFbmFi\nbGVkID0gaXNBdXRvUmVjb3ZlcnlFbmFibGVkOwogICAgfQoKICAgIC8qKgog\nICAgICogRmxhZyB1c2VkIHRvIGNoZWNrIHdoZXRoZXIgYXV0byByZWNvdmVy\neSBwcm9jZXNzIGlzIGVuYWJsZWQvZGlzYWJsZWQuIEJ5CiAgICAgKiBkZWZh\ndWx0IHRoZSBmbGFnIGlzIGZhbHNlLgogICAgICoKICAgICAqIEByZXR1cm4g\ndHJ1ZSwgaWYgdGhlIGF1dG8gcmVjb3ZlcnkgaXMgZW5hYmxlZC4gT3RoZXJ3\naXNlIHJldHVybiBmYWxzZS4KICAgICAqLwogICAgcHVibGljIGJvb2xlYW4g\naXNBdXRvUmVjb3ZlcnlFbmFibGVkKCkgewogICAgICAgIHJldHVybiBpc0F1\ndG9SZWNvdmVyeUVuYWJsZWQ7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHN0\nYXJ0QXV0b1JlY292ZXJ5KEJvb2tpZVNlcnZlciBic2VydmVyLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZikgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGlzQXV0\nb1JlY292ZXJ5RW5hYmxlZCgpKSB7CiAgICAgICAgICAgIEF1dG9SZWNvdmVy\neU1haW4gYXV0b1JlY292ZXJ5UHJvY2VzcyA9IG5ldyBBdXRvUmVjb3ZlcnlN\nYWluKGNvbmYpOwogICAgICAgICAgICBhdXRvUmVjb3ZlcnlQcm9jZXNzLnN0\nYXJ0KCk7CiAgICAgICAgICAgIGF1dG9SZWNvdmVyeVByb2Nlc3Nlcy5wdXQo\nYnNlcnZlciwgYXV0b1JlY292ZXJ5UHJvY2Vzcyk7CiAgICAgICAgICAgIExP\nRy5kZWJ1ZygiU3RhcnRpbmcgQXVkaXRvciBSZWNvdmVyeSBmb3IgdGhlIGJv\nb2tpZToiCiAgICAgICAgICAgICAgICAgICAgKyBic2VydmVyLmdldExvY2Fs\nQWRkcmVzcygpKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIHN0b3BBdXRvUmVjb3ZlcnlTZXJ2aWNlKEJvb2tpZVNlcnZlciB0b1JlbW92\nZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQXV0b1JlY292ZXJ5TWFp\nbiBhdXRvUmVjb3ZlcnlNYWluID0gYXV0b1JlY292ZXJ5UHJvY2Vzc2VzCiAg\nICAgICAgICAgICAgICAucmVtb3ZlKHRvUmVtb3ZlKTsKICAgICAgICBpZiAo\nbnVsbCAhPSBhdXRvUmVjb3ZlcnlNYWluICYmIGlzQXV0b1JlY292ZXJ5RW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgIGF1dG9SZWNvdmVyeU1haW4uc2h1dGRv\nd24oKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJTaHV0ZG93biBhdXRvIHJl\nY292ZXJ5IGZvciBib29raWVzZXJ2ZXI6IgogICAgICAgICAgICAgICAgICAg\nICsgdG9SZW1vdmUuZ2V0TG9jYWxBZGRyZXNzKCkpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFdpbGwgc3RhcnRzIHRoZSBhdXRvIHJlY292\nZXJ5IHByb2Nlc3MgZm9yIHRoZSBib29raWUgc2VydmVycy4gT25lIGF1dG8K\nICAgICAqIHJlY292ZXJ5IHByb2Nlc3MgcGVyIGVhY2ggYm9va2llIHNlcnZl\nciwgaWYgaXNBdXRvUmVjb3ZlcnlFbmFibGVkIGlzCiAgICAgKiBlbmFibGVk\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzdGFydFJlcGxpY2F0aW9uU2Vy\ndmljZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBpbmRleCA9\nIC0xOwogICAgICAgIGZvciAoQm9va2llU2VydmVyIGJzZXJ2ZXIgOiBicykg\newogICAgICAgICAgICBzdGFydEF1dG9SZWNvdmVyeShic2VydmVyLCBic0Nv\nbmZzLmdldCgrK2luZGV4KSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogV2lsbCBzdG9wcyBhbGwgdGhlIGF1dG8gcmVjb3ZlcnkgcHJvY2Vz\nc2VzIGZvciB0aGUgYm9va2llIGNsdXN0ZXIsIGlmCiAgICAgKiBpc0F1dG9S\nZWNvdmVyeUVuYWJsZWQgaXMgdHJ1ZS4KICAgICAqLwogICAgcHVibGljIHZv\naWQgc3RvcFJlcGxpY2F0aW9uU2VydmljZSgpIHRocm93cyBFeGNlcHRpb257\nCiAgICAgICAgaWYoZmFsc2UgPT0gaXNBdXRvUmVjb3ZlcnlFbmFibGVkKCkp\newogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGZvciAo\nRW50cnk8Qm9va2llU2VydmVyLCBBdXRvUmVjb3ZlcnlNYWluPiBhdXRvUmVj\nb3ZlcnlQcm9jZXNzIDogYXV0b1JlY292ZXJ5UHJvY2Vzc2VzCiAgICAgICAg\nICAgICAgICAuZW50cnlTZXQoKSkgewogICAgICAgICAgICBhdXRvUmVjb3Zl\ncnlQcm9jZXNzLmdldFZhbHVlKCkuc2h1dGRvd24oKTsKICAgICAgICAgICAg\nTE9HLmRlYnVnKCJTaHV0ZG93biBBdWRpdG9yIFJlY292ZXJ5IGZvciB0aGUg\nYm9va2llOiIKICAgICAgICAgICAgICAgICAgICArIGF1dG9SZWNvdmVyeVBy\nb2Nlc3MuZ2V0S2V5KCkuZ2V0TG9jYWxBZGRyZXNzKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgQXVkaXRvciBnZXRBdWRpdG9yKGludCB0aW1l\nb3V0LCBUaW1lVW5pdCB1bml0KSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBmaW5hbCBsb25nIHRpbWVvdXRBdCA9IFN5c3RlbS5uYW5vVGltZSgpICsg\nVGltZVVuaXQuTkFOT1NFQ09ORFMuY29udmVydCh0aW1lb3V0LCB1bml0KTsK\nICAgICAgICB3aGlsZSAoU3lzdGVtLm5hbm9UaW1lKCkgPCB0aW1lb3V0QXQp\nIHsKICAgICAgICAgICAgZm9yIChBdXRvUmVjb3ZlcnlNYWluIHAgOiBhdXRv\nUmVjb3ZlcnlQcm9jZXNzZXMudmFsdWVzKCkpIHsKICAgICAgICAgICAgICAg\nIEF1ZGl0b3IgYSA9IHAuZ2V0QXVkaXRvcigpOwogICAgICAgICAgICAgICAg\naWYgKGEgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBh\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIFRocmVhZC5zbGVlcCgxMDApOwogICAgICAgIH0KICAgICAgICB0aHJvdyBu\nZXcgRXhjZXB0aW9uKCJObyBhdWRpdG9yIGZvdW5kIik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBDaGVjayB3aGV0aGVyIHRoZSBJbmV0U29ja2V0QWRkcmVz\ncyB3YXMgY3JlYXRlZCB1c2luZyBhIGhvc3RuYW1lIG9yIGFuIElQCiAgICAg\nKiBhZGRyZXNzLiBSZXByZXNlbnQgYXMgJ2hvc3RuYW1lL0lQYWRkcmVzcycg\naWYgdGhlIEluZXRTb2NrZXRBZGRyZXNzIHdhcwogICAgICogY3JlYXRlZCB1\nc2luZyBob3N0bmFtZS4gUmVwcmVzZW50IGFzICcvSVBhZGRyZXNzJyBpZiB0\naGUKICAgICAqIEluZXRTb2NrZXRBZGRyZXNzIHdhcyBjcmVhdGVkIHVzaW5n\nIGFuIElQYWRkcmVzcwogICAgICoKICAgICAqIEBwYXJhbSBhZGRyCiAgICAg\nKiAgICAgICAgICAgIGluZXRhZGRyZXNzCiAgICAgKiBAcmV0dXJuIHRydWUg\naWYgdGhlIGFkZHJlc3Mgd2FzIGNyZWF0ZWQgdXNpbmcgYW4gSVAgYWRkcmVz\ncywgZmFsc2UgaWYgdGhlCiAgICAgKiAgICAgICAgIGFkZHJlc3Mgd2FzIGNy\nZWF0ZWQgdXNpbmcgYSBob3N0bmFtZQogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIGJvb2xlYW4gaXNDcmVhdGVkRnJvbUlwKEJvb2tpZVNvY2tldEFkZHJl\nc3MgYWRkcikgewogICAgICAgIHJldHVybiBhZGRyLmdldFNvY2tldEFkZHJl\nc3MoKS50b1N0cmluZygpLnN0YXJ0c1dpdGgoIi8iKTsKICAgIH0KfQo=\n","encoding":"base64"}

