{"sha":"4d29ff48d152d0335e764e018a32ac36c8dd142e","node_id":"MDQ6QmxvYjE1NzU5NTY6NGQyOWZmNDhkMTUyZDAzMzVlNzY0ZTAxOGEzMmFjMzZjOGRkMTQyZQ==","size":41561,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4d29ff48d152d0335e764e018a32ac36c8dd142e","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdDsKCi8qCiAqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBz\nb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4\ncHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAq\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQg\nbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAqLwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5pby5CeXRlQnVmZmVyOwppbXBvcnQgamF2YS5uaW8u\nY2hhcnNldC5DaGFyc2V0OwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRp\nbC5SYW5kb207CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKCmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2su\nQWRkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkFzeW5jQ2FsbGJhY2suUmVhZENhbGxiYWNrOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRMYXN0\nQ29uZmlybWVkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RyZWFtaW5nLkxlZGdl\ncklucHV0U3RyZWFtOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnN0\ncmVhbWluZy5MZWRnZXJPdXRwdXRTdHJlYW07CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmp1bml0\nLkFzc2VydDsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcu\nanVuaXQuVGVzdDsKCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC4q\nOwoKLyoqCiAqIFRoaXMgdGVzdCB0ZXN0cyByZWFkIGFuZCB3cml0ZSwgc3lu\nY2hyb25vdXMgYW5kIGFzeW5jaHJvbm91cywgc3RyaW5ncyBhbmQKICogaW50\nZWdlcnMgZm9yIGEgQm9va0tlZXBlciBjbGllbnQuIFRoZSB0ZXN0IGRlcGxv\neW1lbnQgdXNlcyBhIFpvb0tlZXBlciBzZXJ2ZXIKICogYW5kIHRocmVlIEJv\nb2tLZWVwZXJzLgogKgogKi8KCnB1YmxpYyBjbGFzcyBCb29raWVSZWFkV3Jp\ndGVUZXN0IGV4dGVuZHMgTXVsdGlMZWRnZXJNYW5hZ2VyTXVsdGlEaWdlc3RU\nZXN0Q2FzZQogICAgaW1wbGVtZW50cyBBZGRDYWxsYmFjaywgUmVhZENhbGxi\nYWNrLCBSZWFkTGFzdENvbmZpcm1lZENhbGxiYWNrIHsKCiAgICAvLyBEZXBl\nbmRpbmcgb24gdGhlIHRhc3RlLCBzZWxlY3QgdGhlIGFtb3VudCBvZiBsb2dn\naW5nCiAgICAvLyBieSBkZWNvbW1lbnRpbmcgb25lIG9mIHRoZSB0d28gbGlu\nZXMgYmVsb3cKICAgIC8vIHByaXZhdGUgZmluYWwgc3RhdGljIExvZ2dlciBM\nT0cgPSBMb2dnZXIuZ2V0Um9vdExvZ2dlcigpOwogICAgcHJpdmF0ZSBmaW5h\nbCBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2Vy\nKEJvb2tpZVJlYWRXcml0ZVRlc3QuY2xhc3MpOwoKICAgIGJ5dGVbXSBsZWRn\nZXJQYXNzd29yZCA9ICJhYWEiLmdldEJ5dGVzKCk7CiAgICBMZWRnZXJIYW5k\nbGUgbGgsIGxoMjsKICAgIGxvbmcgbGVkZ2VySWQ7CgogICAgLy8gdGVzdCBy\nZWxhdGVkIHZhcmlhYmxlcwogICAgaW50IG51bUVudHJpZXNUb1dyaXRlID0g\nMjAwOwogICAgaW50IG1heEludCA9IDIxNDc0ODM2NDc7CiAgICBSYW5kb20g\ncm5nOyAvLyBSYW5kb20gTnVtYmVyIEdlbmVyYXRvcgogICAgQXJyYXlMaXN0\nPGJ5dGVbXT4gZW50cmllczsgLy8gZ2VuZXJhdGVkIGVudHJpZXMKICAgIEFy\ncmF5TGlzdDxJbnRlZ2VyPiBlbnRyaWVzU2l6ZTsKCiAgICBEaWdlc3RUeXBl\nIGRpZ2VzdFR5cGU7CgogICAgcHVibGljIEJvb2tpZVJlYWRXcml0ZVRlc3Qo\nU3RyaW5nIGxlZGdlck1hbmFnZXJGYWN0b3J5LCBEaWdlc3RUeXBlIGRpZ2Vz\ndFR5cGUpIHsKICAgICAgICBzdXBlcigzKTsKICAgICAgICB0aGlzLmRpZ2Vz\ndFR5cGUgPSBkaWdlc3RUeXBlOwogICAgICAgIC8vIHNldCBsZWRnZXIgbWFu\nYWdlcgogICAgICAgIGJhc2VDb25mLnNldExlZGdlck1hbmFnZXJGYWN0b3J5\nQ2xhc3NOYW1lKGxlZGdlck1hbmFnZXJGYWN0b3J5KTsKICAgICAgICBiYXNl\nQ2xpZW50Q29uZi5zZXRMZWRnZXJNYW5hZ2VyRmFjdG9yeUNsYXNzTmFtZShs\nZWRnZXJNYW5hZ2VyRmFjdG9yeSk7CiAgICB9CgogICAgY2xhc3MgU3luY09i\naiB7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkOwogICAgICAgIHZvbGF0\naWxlIGludCBjb3VudGVyOwogICAgICAgIGJvb2xlYW4gdmFsdWU7CiAgICAg\nICAgQXRvbWljSW50ZWdlciByYyA9IG5ldyBBdG9taWNJbnRlZ2VyKEJLRXhj\nZXB0aW9uLkNvZGUuT0spOwogICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVu\ndHJ5PiBscyA9IG51bGw7CgogICAgICAgIHB1YmxpYyBTeW5jT2JqKCkgewog\nICAgICAgICAgICBjb3VudGVyID0gMDsKICAgICAgICAgICAgbGFzdENvbmZp\ncm1lZCA9IExlZGdlckhhbmRsZS5JTlZBTElEX0VOVFJZX0lEOwogICAgICAg\nICAgICB2YWx1ZSA9IGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBz\nZXRSZXR1cm5Db2RlKGludCByYykgewogICAgICAgICAgICB0aGlzLnJjLmNv\nbXBhcmVBbmRTZXQoQktFeGNlcHRpb24uQ29kZS5PSywgcmMpOwogICAgICAg\nIH0KCiAgICAgICAgaW50IGdldFJldHVybkNvZGUoKSB7CiAgICAgICAgICAg\nIHJldHVybiByYy5nZXQoKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgc2V0\nTGVkZ2VyRW50cmllcyhFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMpIHsK\nICAgICAgICAgICAgdGhpcy5scyA9IGxzOwogICAgICAgIH0KCiAgICAgICAg\nRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGdldExlZGdlckVudHJpZXMoKSB7\nCiAgICAgICAgICAgIHJldHVybiBsczsKICAgICAgICB9CiAgICB9CgogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RPcGVu\nRXhjZXB0aW9uKCkgdGhyb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbGggPSBia2Mu\nb3BlbkxlZGdlcigwLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAg\nICAgICAgICAgIGZhaWwoIkhhdmVuJ3QgdGhyb3duIGV4Y2VwdGlvbiIpOwog\nICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nTE9HLndhcm4oIlN1Y2Nlc3NmdWxseSB0aHJvd24gYW5kIGNhdWdodCBleGNl\ncHRpb246IiwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\ndGVzdCB0aGUgc3RyZWFtaW5nIGFwaSBmb3IgcmVhZGluZyBhbmQgd3JpdGlu\nZwogICAgICoKICAgICAqIEB0aHJvd3Mge0BsaW5rIElPRXhjZXB0aW9ufQog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFN0cmVhbWluZ0NsaWVudHMoKSB0aHJvd3MgSU9FeGNlcHRpb24s\nIEJLRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAg\nbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3\nb3JkKTsKICAgICAgICAvLyB3cml0ZSBhIHN0cmluZyBzbyB0aGF0IHdlIGNu\nYQogICAgICAgIC8vIGNyZWF0ZSBhIGJ1ZmZlciBvZiBhIHNpbmdsZSBieXRl\ncwogICAgICAgIC8vIGFuZCBjaGVjayBmb3IgY29ybmVyIGNhc2VzCiAgICAg\nICAgU3RyaW5nIHRvV3JpdGUgPSAid2UgbmVlZCB0byBjaGVjayBmb3IgdGhp\ncyBzdHJpbmcgdG8gbWF0Y2ggIiArICJhbmQgZm9yIHRoZSByZWNvcmQgbWFo\nYWRldiBpcyB0aGUgYmVzdCI7CiAgICAgICAgTGVkZ2VyT3V0cHV0U3RyZWFt\nIGxvdXQgPSBuZXcgTGVkZ2VyT3V0cHV0U3RyZWFtKGxoLCAxKTsKICAgICAg\nICBieXRlW10gYiA9IHRvV3JpdGUuZ2V0Qnl0ZXMoKTsKICAgICAgICBsb3V0\nLndyaXRlKGIpOwogICAgICAgIGxvdXQuY2xvc2UoKTsKICAgICAgICBsb25n\nIGxJZCA9IGxoLmdldElkKCk7CiAgICAgICAgbGguY2xvc2UoKTsKICAgICAg\nICAvLyBjaGVjayBmb3Igc2FuaXR5CiAgICAgICAgbGggPSBia2Mub3Blbkxl\nZGdlcihsSWQsIGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAg\nICBMZWRnZXJJbnB1dFN0cmVhbSBsaW4gPSBuZXcgTGVkZ2VySW5wdXRTdHJl\nYW0obGgsIDEpOwogICAgICAgIGJ5dGVbXSBicmVhZCA9IG5ldyBieXRlW2Iu\nbGVuZ3RoXTsKICAgICAgICBpbnQgcmVhZCA9IDA7CiAgICAgICAgd2hpbGUg\nKHJlYWQgPCBiLmxlbmd0aCkgewogICAgICAgICAgICByZWFkID0gcmVhZCAr\nIGxpbi5yZWFkKGJyZWFkLCByZWFkLCBiLmxlbmd0aCk7CiAgICAgICAgfQoK\nICAgICAgICBTdHJpbmcgbmV3U3RyaW5nID0gbmV3IFN0cmluZyhicmVhZCk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZSgidGhlc2UgdHdvIHNob3VsZCBzYW1lIiwg\ndG9Xcml0ZS5lcXVhbHMobmV3U3RyaW5nKSk7CiAgICAgICAgbGluLmNsb3Nl\nKCk7CiAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAvLyBjcmVhdGUgYW5v\ndGhlciBsZWRnZXIgdG8gd3JpdGUgb25lIGJ5dGUgYXQgYSB0aW1lCiAgICAg\nICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBh\nc3N3b3JkKTsKICAgICAgICBsb3V0ID0gbmV3IExlZGdlck91dHB1dFN0cmVh\nbShsaCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiLmxlbmd0aDsg\naSsrKSB7CiAgICAgICAgICAgIGxvdXQud3JpdGUoYltpXSk7CiAgICAgICAg\nfQogICAgICAgIGxvdXQuY2xvc2UoKTsKICAgICAgICBsSWQgPSBsaC5nZXRJ\nZCgpOwogICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgbGggPSBia2Mub3Bl\nbkxlZGdlcihsSWQsIGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICBsaW4gPSBuZXcgTGVkZ2VySW5wdXRTdHJlYW0obGgpOwogICAgICAg\nIGJyZWFkID0gbmV3IGJ5dGVbYi5sZW5ndGhdOwogICAgICAgIHJlYWQgPSAw\nOwogICAgICAgIHdoaWxlIChyZWFkIDwgYi5sZW5ndGgpIHsKICAgICAgICAg\nICAgcmVhZCA9IHJlYWQgKyBsaW4ucmVhZChicmVhZCwgcmVhZCwgYi5sZW5n\ndGgpOwogICAgICAgIH0KICAgICAgICBuZXdTdHJpbmcgPSBuZXcgU3RyaW5n\nKGJyZWFkKTsKICAgICAgICBhc3NlcnRUcnVlKCJ0aGVzZSB0d28gc2hvdWxk\nIGJlIHNhbWUgIiwgdG9Xcml0ZS5lcXVhbHMobmV3U3RyaW5nKSk7CiAgICAg\nICAgbGluLmNsb3NlKCk7CiAgICAgICAgbGguY2xvc2UoKTsKICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgdGVzdFJlYWRXcml0ZUFzeW5jU2luZ2xlQ2xpZW50\nKGludCBudW1FbnRyaWVzKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIFN5bmNPYmogc3luYyA9IG5ldyBTeW5jT2JqKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgICAgIGxo\nID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29y\nZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2VzdCgiU0hB\nMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdldElkKCk7CiAgICAg\nICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBsaC5nZXRJZCgpKTsK\nICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzVG9X\ncml0ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIGVudHJ5\nID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICAgICAgICAgIGVu\ndHJ5LnB1dEludChybmcubmV4dEludChtYXhJbnQpKTsKICAgICAgICAgICAg\nICAgIGVudHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAgICAgICAgIGVudHJp\nZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICAgICAgZW50cmll\nc1NpemUuYWRkKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsKICAgICAgICAgICAg\nICAgIGxoLmFzeW5jQWRkRW50cnkoZW50cnkuYXJyYXkoKSwgdGhpcywgc3lu\nYyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIHdhaXQgZm9yIGFs\nbCBlbnRyaWVzIHRvIGJlIGFja25vd2xlZGdlZAogICAgICAgICAgICBzeW5j\naHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChzeW5j\nLmNvdW50ZXIgPCBudW1FbnRyaWVzVG9Xcml0ZSkgewogICAgICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiRW50cmllcyBjb3VudGVyID0gIiArIHN5bmMu\nY291bnRlcik7CiAgICAgICAgICAgICAgICAgICAgc3luYy53YWl0KCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMo\nIkVycm9yIGFkZGluZyIsIEJLRXhjZXB0aW9uLkNvZGUuT0ssIHN5bmMuZ2V0\nUmV0dXJuQ29kZSgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgTE9H\nLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAgICAgICAg\nIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgpOwoKICAg\nICAgICAgICAgLy8gKioqIFdSSVRJTkcgUEFSVCBDT01QTEVURSAvLyBSRUFE\nIFBBUlQgQkVHSU5TICoqKgoKICAgICAgICAgICAgLy8gb3BlbiBsZWRnZXIK\nICAgICAgICAgICAgbGggPSBia2Mub3BlbkxlZGdlcihsZWRnZXJJZCwgZGln\nZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICBMT0cuZGVi\ndWcoIk51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW46ICIgKyAobGguZ2V0TGFz\ndEFkZENvbmZpcm1lZCgpICsgMSkpOwogICAgICAgICAgICBhc3NlcnRUcnVl\nKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbiIsIGxoLmdl\ndExhc3RBZGRDb25maXJtZWQoKSA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAx\nKSk7CgogICAgICAgICAgICAvLyByZWFkIGVudHJpZXMKICAgICAgICAgICAg\nbGguYXN5bmNSZWFkRW50cmllcygwLCBudW1FbnRyaWVzVG9Xcml0ZSAtIDEs\nIHRoaXMsIHN5bmMpOwoKICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5j\nKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3luYy52YWx1ZSA9PSBmYWxz\nZSkgewogICAgICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJFcnJv\nciByZWFkaW5nIiwgQktFeGNlcHRpb24uQ29kZS5PSywgc3luYy5nZXRSZXR1\ncm5Db2RlKCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBMT0cuZGVi\ndWcoIioqKiBSRUFEIENPTVBMRVRFICoqKiIpOwoKICAgICAgICAgICAgLy8g\nYXQgdGhpcyBwb2ludCwgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGxzIGlz\nIGZpbGxlZCB3aXRoIHRoZSByZXR1cm5lZAogICAgICAgICAgICAvLyB2YWx1\nZXMKICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAgICBFbnVtZXJh\ndGlvbjxMZWRnZXJFbnRyeT4gbHMgPSBzeW5jLmdldExlZGdlckVudHJpZXMo\nKTsKICAgICAgICAgICAgd2hpbGUgKGxzLmhhc01vcmVFbGVtZW50cygpKSB7\nCiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIG9yaWdiYiA9IEJ5dGVCdWZm\nZXIud3JhcChlbnRyaWVzLmdldChpKSk7CiAgICAgICAgICAgICAgICBJbnRl\nZ2VyIG9yaWdFbnRyeSA9IG9yaWdiYi5nZXRJbnQoKTsKICAgICAgICAgICAg\nICAgIGJ5dGVbXSBlbnRyeSA9IGxzLm5leHRFbGVtZW50KCkuZ2V0RW50cnko\nKTsKICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgcmVzdWx0ID0gQnl0ZUJ1\nZmZlci53cmFwKGVudHJ5KTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1Zygi\nTGVuZ3RoIG9mIHJlc3VsdDogIiArIHJlc3VsdC5jYXBhY2l0eSgpKTsKICAg\nICAgICAgICAgICAgIExPRy5kZWJ1ZygiT3JpZ2luYWwgZW50cnk6ICIgKyBv\ncmlnRW50cnkpOwoKICAgICAgICAgICAgICAgIEludGVnZXIgcmV0ckVudHJ5\nID0gcmVzdWx0LmdldEludCgpOwogICAgICAgICAgICAgICAgTE9HLmRlYnVn\nKCJSZXRyaWV2ZWQgZW50cnk6ICIgKyByZXRyRW50cnkpOwogICAgICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgiQ2hlY2tpbmcgZW50cnkgIiArIGkgKyAiIGZv\nciBlcXVhbGl0eSIsIG9yaWdFbnRyeS5lcXVhbHMocmV0ckVudHJ5KSk7CiAg\nICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJDaGVja2luZyBlbnRyeSAiICsg\naSArICIgZm9yIHNpemUiLCBlbnRyeS5sZW5ndGggPT0gZW50cmllc1NpemUu\nZ2V0KGkpLmludFZhbHVlKCkpOwogICAgICAgICAgICAgICAgaSsrOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIG51\nbWJlciBvZiByZWFkIGVudHJpZXMiLCBpID09IG51bUVudHJpZXNUb1dyaXRl\nKTsKCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfSBjYXRjaCAo\nQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3Qg\nZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1\nZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVy\ncm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0\nIGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAgfQogICAg\nfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVhZFdyaXRlQXN5\nbmNTaW5nbGVDbGllbnQyMDAoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIHRlc3RSZWFkV3JpdGVBc3luY1NpbmdsZUNsaWVudCgyMDApOwogICAg\nfQoKICAgIC8qKgogICAgICogQ2hlY2sgdGhhdCB0aGUgYWRkIGFwaSB3aXRo\nIG9mZnNldCBhbmQgbGVuZ3RoIHdvcmsgY29ycmVjdGx5LgogICAgICogRmly\nc3QgdHJ5IHZhcnlpbmcgdGhlIG9mZnNldC4gVGhlbiB0aGUgbGVuZ3RoIHdp\ndGggYSBmaXhlZCBub24temVybwogICAgICogb2Zmc2V0LgogICAgICovCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFJl\nYWRXcml0ZVJhbmdlQXN5bmNTaW5nbGVDbGllbnQoKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIFN5bmNPYmogc3luYyA9IG5ldyBTeW5jT2JqKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2Vy\nCiAgICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBl\nLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVz\nc2FnZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxo\nLmdldElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIg\nKyBsaC5nZXRJZCgpKTsKICAgICAgICAgICAgYnl0ZSBieXRlc1tdID0geydh\nJywnYicsJ2MnLCdkJywnZScsJ2YnLCdnJywnaCcsJ2knfTsKCiAgICAgICAg\nICAgIGxoLmFzeW5jQWRkRW50cnkoYnl0ZXMsIDAsIGJ5dGVzLmxlbmd0aCwg\ndGhpcywgc3luYyk7CiAgICAgICAgICAgIGxoLmFzeW5jQWRkRW50cnkoYnl0\nZXMsIDAsIDQsIHRoaXMsIHN5bmMpOyAvLyBhYmNkCiAgICAgICAgICAgIGxo\nLmFzeW5jQWRkRW50cnkoYnl0ZXMsIDMsIDQsIHRoaXMsIHN5bmMpOyAvLyBk\nZWZnCiAgICAgICAgICAgIGxoLmFzeW5jQWRkRW50cnkoYnl0ZXMsIDMsIChi\neXRlcy5sZW5ndGgtMyksIHRoaXMsIHN5bmMpOyAvLyBkZWZnaGkKICAgICAg\nICAgICAgaW50IG51bUVudHJpZXMgPSA0OwoKICAgICAgICAgICAgLy8gd2Fp\ndCBmb3IgYWxsIGVudHJpZXMgdG8gYmUgYWNrbm93bGVkZ2VkCiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAgICAgICAgICAgd2hp\nbGUgKHN5bmMuY291bnRlciA8IG51bUVudHJpZXMpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIkVudHJpZXMgY291bnRlciA9ICIgKyBzeW5j\nLmNvdW50ZXIpOwogICAgICAgICAgICAgICAgICAgIHN5bmMud2FpdCgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxz\nKCJFcnJvciBhZGRpbmciLCBCS0V4Y2VwdGlvbi5Db2RlLk9LLCBzeW5jLmdl\ndFJldHVybkNvZGUoKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBsaC5hc3luY0FkZEVudHJ5KGJ5dGVzLCAt\nMSwgYnl0ZXMubGVuZ3RoLCB0aGlzLCBzeW5jKTsKICAgICAgICAgICAgICAg\nIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHVzZSBuZWdhdGl2ZSBvZmZz\nZXQiKTsKICAgICAgICAgICAgfSBjYXRjaCAoQXJyYXlJbmRleE91dE9mQm91\nbmRzRXhjZXB0aW9uIGFpb2IpIHsKICAgICAgICAgICAgICAgIC8vIGV4cGVj\ndGVkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGxoLmFzeW5jQWRkRW50cnkoYnl0ZXMsIDAsIGJ5dGVzLmxlbmd0\naCsxLCB0aGlzLCBzeW5jKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3Vs\nZG4ndCBiZSBhYmxlIHRvIHVzZSB0aGF0IG11Y2ggbGVuZ3RoIik7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlv\nbiBhaW9iKSB7CiAgICAgICAgICAgICAgICAvLyBleHBlY3RlZAogICAgICAg\nICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsaC5h\nc3luY0FkZEVudHJ5KGJ5dGVzLCAtMSwgYnl0ZXMubGVuZ3RoKzIsIHRoaXMs\nIHN5bmMpOwogICAgICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFi\nbGUgdG8gdXNlIG5lZ2F0aXZlIG9mZnNldCAiCiAgICAgICAgICAgICAgICAg\nICAgICsgIndpdGggdGhhdCBtdWNoIGxlbmd0aCIpOwogICAgICAgICAgICB9\nIGNhdGNoIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gYWlvYikg\newogICAgICAgICAgICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAgICAgfQog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGguYXN5bmNBZGRF\nbnRyeShieXRlcywgNCwgLTMsIHRoaXMsIHN5bmMpOwogICAgICAgICAgICAg\nICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gdXNlIG5lZ2F0aXZlIGxl\nbmd0aCIpOwogICAgICAgICAgICB9IGNhdGNoIChBcnJheUluZGV4T3V0T2ZC\nb3VuZHNFeGNlcHRpb24gYWlvYikgewogICAgICAgICAgICAgICAgLy8gZXhw\nZWN0ZWQKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywgLTQsIC0zLCB0aGlz\nLCBzeW5jKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBh\nYmxlIHRvIHVzZSBuZWdhdGl2ZSBvZmZzZXQgJiBsZW5ndGgiKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoQXJyYXlJbmRleE91dE9mQm91bmRzRXhjZXB0aW9u\nIGFpb2IpIHsKICAgICAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAgICAgICAg\nICAgIH0KCgogICAgICAgICAgICBMT0cuZGVidWcoIioqKiBXUklURSBDT01Q\nTEVURSAqKioiKTsKICAgICAgICAgICAgLy8gY2xvc2UgbGVkZ2VyCiAgICAg\nICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgICAgICAvLyAqKiogV1JJVElO\nRyBQQVJUIENPTVBMRVRFIC8vIFJFQUQgUEFSVCBCRUdJTlMgKioqCgogICAg\nICAgICAgICAvLyBvcGVuIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5v\ncGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29y\nZCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiTnVtYmVyIG9mIGVudHJpZXMg\nd3JpdHRlbjogIiArIChsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgKyAxKSk7\nCiAgICAgICAgICAgIGFzc2VydFRydWUoIlZlcmlmeWluZyBudW1iZXIgb2Yg\nZW50cmllcyB3cml0dGVuIiwKICAgICAgICAgICAgICAgICAgICAgICBsaC5n\nZXRMYXN0QWRkQ29uZmlybWVkKCkgPT0gKG51bUVudHJpZXMgLSAxKSk7Cgog\nICAgICAgICAgICAvLyByZWFkIGVudHJpZXMKICAgICAgICAgICAgbGguYXN5\nbmNSZWFkRW50cmllcygwLCBudW1FbnRyaWVzIC0gMSwgdGhpcywgc3luYyk7\nCgogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAg\nICAgICAgIHdoaWxlIChzeW5jLnZhbHVlID09IGZhbHNlKSB7CiAgICAgICAg\nICAgICAgICAgICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoIkVycm9yIHJlYWRpbmciLCBC\nS0V4Y2VwdGlvbi5Db2RlLk9LLCBzeW5jLmdldFJldHVybkNvZGUoKSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFJFQUQg\nQ09NUExFVEUgKioqIik7CgogICAgICAgICAgICAvLyBhdCB0aGlzIHBvaW50\nLCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMgaXMgZmlsbGVkIHdpdGgg\ndGhlIHJldHVybmVkCiAgICAgICAgICAgIC8vIHZhbHVlcwogICAgICAgICAg\nICBpbnQgaSA9IDA7CiAgICAgICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVu\ndHJ5PiBscyA9IHN5bmMuZ2V0TGVkZ2VyRW50cmllcygpOwogICAgICAgICAg\nICB3aGlsZSAobHMuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAg\nICAgIGJ5dGVbXSBleHBlY3RlZCA9IG51bGw7CiAgICAgICAgICAgICAgICBi\neXRlW10gZW50cnkgPSBscy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCk7Cgog\nICAgICAgICAgICAgICAgc3dpdGNoIChpKSB7CiAgICAgICAgICAgICAgICBj\nYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQgPSBBcnJheXMu\nY29weU9mUmFuZ2UoYnl0ZXMsIDAsIGJ5dGVzLmxlbmd0aCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDE6CiAg\nICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQgPSBBcnJheXMuY29weU9mUmFu\nZ2UoYnl0ZXMsIDAsIDQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgICAgIGV4\ncGVjdGVkID0gQXJyYXlzLmNvcHlPZlJhbmdlKGJ5dGVzLCAzLCAzKzQpOwog\nICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2Fz\nZSAzOgogICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkID0gQXJyYXlzLmNv\ncHlPZlJhbmdlKGJ5dGVzLCAzLCAzKyhieXRlcy5sZW5ndGgtMykpOwogICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgYXNzZXJ0Tm90TnVsbCgiVGhlcmUgYXJlIG1vcmUgY2hl\nY2tzIHRoYW4gd3JpdGVzIiwgZXhwZWN0ZWQpOwoKICAgICAgICAgICAgICAg\nIFN0cmluZyBtZXNzYWdlID0gIkNoZWNraW5nIGVudHJ5ICIgKyBpICsgIiBm\nb3IgZXF1YWxpdHkgWyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyBuZXcgU3RyaW5nKGVudHJ5LCAiVVRGLTgiKSArICIsIgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIG5ldyBTdHJpbmcoZXhwZWN0\nZWQsICJVVEYtOCIpICsgIl0iOwogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1\nZShtZXNzYWdlLCBBcnJheXMuZXF1YWxzKGVudHJ5LCBleHBlY3RlZCkpOwoK\nICAgICAgICAgICAgICAgIGkrKzsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBhc3NlcnRUcnVlKCJDaGVja2luZyBudW1iZXIgb2YgcmVhZCBlbnRyaWVz\nIiwgaSA9PSBudW1FbnRyaWVzKTsKCiAgICAgICAgICAgIGxoLmNsb3NlKCk7\nCiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZh\naWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIp\nOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAg\nICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9u\nIik7CiAgICAgICAgfQogICAgfQoKICAgIGNsYXNzIFRocm90dGxlVGVzdENh\nbGxiYWNrIGltcGxlbWVudHMgUmVhZENhbGxiYWNrIHsKICAgICAgICBpbnQg\ndGhyb3R0bGU7CgogICAgICAgIFRocm90dGxlVGVzdENhbGxiYWNrKGludCB0\naHJlc2hvbGQpIHsKICAgICAgICAgICAgdGhpcy50aHJvdHRsZSA9IHRocmVz\naG9sZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyB2b2lkIHJlYWRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBs\naCwgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNlcSwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICBTeW5jT2JqIHN5bmMgPSAoU3luY09iailjdHg7CiAg\nICAgICAgICAgIHN5bmMuc2V0TGVkZ2VyRW50cmllcyhzZXEpOwogICAgICAg\nICAgICBzeW5jLnNldFJldHVybkNvZGUocmMpOwogICAgICAgICAgICBzeW5j\naHJvbml6ZWQoc3luYykgewogICAgICAgICAgICAgICAgc3luYy5jb3VudGVy\nICs9IHRocm90dGxlOwogICAgICAgICAgICAgICAgc3luYy5ub3RpZnkoKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBMT0cuaW5mbygiQ3VycmVudCBj\nb3VudGVyOiAiICsgc3luYy5jb3VudGVyKTsKICAgICAgICB9CiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RT\neW5jUmVhZEFzeW5jV3JpdGVTdHJpbmdzU2luZ2xlQ2xpZW50KCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBTeW5jT2JqIHN5bmMgPSBuZXcgU3lu\nY09iaigpOwogICAgICAgIExPRy5pbmZvKCJURVNUIFJFQUQgV1JJVEUgU1RS\nSU5HUyBNSVhFRCBTSU5HTEUgQ0xJRU5UIik7CiAgICAgICAgU3RyaW5nIGNo\nYXJzZXQgPSAidXRmLTgiOwogICAgICAgIExPRy5kZWJ1ZygiRGVmYXVsdCBj\naGFyc2V0OiAiICsgQ2hhcnNldC5kZWZhdWx0Q2hhcnNldCgpKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAg\nICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdl\nclBhc3N3b3JkKTsKICAgICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGln\nZXN0KCJTSEExIik7CiAgICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQo\nKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdl\ndElkKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVu\ndHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIGludCByYW5k\nb21JbnQgPSBybmcubmV4dEludChtYXhJbnQpOwogICAgICAgICAgICAgICAg\nYnl0ZVtdIGVudHJ5ID0gbmV3IFN0cmluZyhJbnRlZ2VyLnRvU3RyaW5nKHJh\nbmRvbUludCkpLmdldEJ5dGVzKGNoYXJzZXQpOwogICAgICAgICAgICAgICAg\nZW50cmllcy5hZGQoZW50cnkpOwogICAgICAgICAgICAgICAgbGguYXN5bmNB\nZGRFbnRyeShlbnRyeSwgdGhpcywgc3luYyk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIHdhaXQgZm9yIGFsbCBlbnRyaWVzIHRvIGJlIGFja25v\nd2xlZGdlZAogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAg\nICAgICAgICAgICAgIHdoaWxlIChzeW5jLmNvdW50ZXIgPCBudW1FbnRyaWVz\nVG9Xcml0ZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRW50\ncmllcyBjb3VudGVyID0gIiArIHN5bmMuY291bnRlcik7CiAgICAgICAgICAg\nICAgICAgICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBhc3NlcnRFcXVhbHMoIkVycm9yIGFkZGluZyIsIEJLRXhj\nZXB0aW9uLkNvZGUuT0ssIHN5bmMuZ2V0UmV0dXJuQ29kZSgpKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgTE9HLmRlYnVnKCIqKiogQVNZTkMgV1JJ\nVEUgQ09NUExFVEUgKioqIik7CiAgICAgICAgICAgIC8vIGNsb3NlIGxlZGdl\ncgogICAgICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICAgICAgLy8gKioq\nIFdSSVRJTkcgUEFSVCBDT01QTEVURUQgLy8gUkVBRCBQQVJUIEJFR0lOUyAq\nKioKCiAgICAgICAgICAgIC8vIG9wZW4gbGVkZ2VyCiAgICAgICAgICAgIGxo\nID0gYmtjLm9wZW5MZWRnZXIobGVkZ2VySWQsIGRpZ2VzdFR5cGUsIGxlZGdl\nclBhc3N3b3JkKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJOdW1iZXIgb2Yg\nZW50cmllcyB3cml0dGVuOiAiICsgKGxoLmdldExhc3RBZGRDb25maXJtZWQo\nKSArIDEpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmVyaWZ5aW5nIG51\nbWJlciBvZiBlbnRyaWVzIHdyaXR0ZW4iLCBsaC5nZXRMYXN0QWRkQ29uZmly\nbWVkKCkgPT0gKG51bUVudHJpZXNUb1dyaXRlIC0gMSkpOwoKICAgICAgICAg\nICAgLy8gcmVhZCBlbnRyaWVzCiAgICAgICAgICAgIEVudW1lcmF0aW9uPExl\nZGdlckVudHJ5PiBscyA9IGxoLnJlYWRFbnRyaWVzKDAsIG51bUVudHJpZXNU\nb1dyaXRlIC0gMSk7CgogICAgICAgICAgICBMT0cuZGVidWcoIioqKiBTWU5D\nIFJFQUQgQ09NUExFVEUgKioqIik7CgogICAgICAgICAgICAvLyBhdCB0aGlz\nIHBvaW50LCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMgaXMgZmlsbGVk\nIHdpdGggdGhlIHJldHVybmVkCiAgICAgICAgICAgIC8vIHZhbHVlcwogICAg\nICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxlIChscy5oYXNN\nb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgYnl0ZVtdIG9yaWdF\nbnRyeUJ5dGVzID0gZW50cmllcy5nZXQoaSsrKTsKICAgICAgICAgICAgICAg\nIGJ5dGVbXSByZXRyRW50cnlCeXRlcyA9IGxzLm5leHRFbGVtZW50KCkuZ2V0\nRW50cnkoKTsKCiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIk9yaWdpbmFs\nIGJ5dGUgZW50cnkgc2l6ZTogIiArIG9yaWdFbnRyeUJ5dGVzLmxlbmd0aCk7\nCiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlNhdmVkIGJ5dGUgZW50cnkg\nc2l6ZTogIiArIHJldHJFbnRyeUJ5dGVzLmxlbmd0aCk7CgogICAgICAgICAg\nICAgICAgU3RyaW5nIG9yaWdFbnRyeSA9IG5ldyBTdHJpbmcob3JpZ0VudHJ5\nQnl0ZXMsIGNoYXJzZXQpOwogICAgICAgICAgICAgICAgU3RyaW5nIHJldHJF\nbnRyeSA9IG5ldyBTdHJpbmcocmV0ckVudHJ5Qnl0ZXMsIGNoYXJzZXQpOwoK\nICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiT3JpZ2luYWwgZW50cnk6ICIg\nKyBvcmlnRW50cnkpOwogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJSZXRy\naWV2ZWQgZW50cnk6ICIgKyByZXRyRW50cnkpOwoKICAgICAgICAgICAgICAg\nIGFzc2VydFRydWUoIkNoZWNraW5nIGVudHJ5ICIgKyBpICsgIiBmb3IgZXF1\nYWxpdHkiLCBvcmlnRW50cnkuZXF1YWxzKHJldHJFbnRyeSkpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIG51bWJl\nciBvZiByZWFkIGVudHJpZXMiLCBpID09IG51bUVudHJpZXNUb1dyaXRlKTsK\nCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfSBjYXRjaCAoQktF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFp\nbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0\nbyBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKElu\ndGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9y\nKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZh\naWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAgfQoKICAgIH0K\nCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndFJlYWRXcml0ZVN5bmNTaW5nbGVDbGllbnQoKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxl\nZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0\nVHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5p\ndE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQg\nPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElE\nOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAg\nICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7\nCiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4\nSW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKICAg\nICAgICAgICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAg\nICAgICAgICAgICAgbGguYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAg\nbGggPSBia2Mub3BlbkxlZGdlcihsZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVk\nZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICBMT0cuZGVidWcoIk51bWJlciBv\nZiBlbnRyaWVzIHdyaXR0ZW46ICIgKyBsaC5nZXRMYXN0QWRkQ29uZmlybWVk\nKCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVy\nIG9mIGVudHJpZXMgd3JpdHRlbiIsIGxoLmdldExhc3RBZGRDb25maXJtZWQo\nKSA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAxKSk7CgogICAgICAgICAgICBF\nbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMgPSBsaC5yZWFkRW50cmllcygw\nLCBudW1FbnRyaWVzVG9Xcml0ZSAtIDEpOwogICAgICAgICAgICBpbnQgaSA9\nIDA7CiAgICAgICAgICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkg\newogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBvcmlnYmIgPSBCeXRlQnVm\nZmVyLndyYXAoZW50cmllcy5nZXQoaSsrKSk7CiAgICAgICAgICAgICAgICBJ\nbnRlZ2VyIG9yaWdFbnRyeSA9IG9yaWdiYi5nZXRJbnQoKTsKICAgICAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgcmVzdWx0ID0gQnl0ZUJ1ZmZlci53cmFwKGxz\nLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKSk7CiAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoIkxlbmd0aCBvZiByZXN1bHQ6ICIgKyByZXN1bHQuY2FwYWNp\ndHkoKSk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIk9yaWdpbmFsIGVu\ndHJ5OiAiICsgb3JpZ0VudHJ5KTsKCiAgICAgICAgICAgICAgICBJbnRlZ2Vy\nIHJldHJFbnRyeSA9IHJlc3VsdC5nZXRJbnQoKTsKICAgICAgICAgICAgICAg\nIExPRy5kZWJ1ZygiUmV0cmlldmVkIGVudHJ5OiAiICsgcmV0ckVudHJ5KTsK\nICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIGVudHJ5ICIg\nKyBpICsgIiBmb3IgZXF1YWxpdHkiLCBvcmlnRW50cnkuZXF1YWxzKHJldHJF\nbnRyeSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxoLmNsb3NlKCk7\nCiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZh\naWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIp\nOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAg\nICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9u\nIik7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVhZFdyaXRlWmVybygpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ3Jl\nYXRlIGEgbGVkZ2VyCiAgICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdl\ncihkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8v\nIGJrYy5pbml0TWVzc2FnZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBs\nZWRnZXJJZCA9IGxoLmdldElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJM\nZWRnZXIgSUQ6ICIgKyBsaC5nZXRJZCgpKTsKICAgICAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggY29tcGxldGVMYXRjaCA9IG5ldyBDb3VudERvd25M\nYXRjaChudW1FbnRyaWVzVG9Xcml0ZSk7CiAgICAgICAgICAgIGZpbmFsIEF0\nb21pY0ludGVnZXIgcmMgPSBuZXcgQXRvbWljSW50ZWdlcihCS0V4Y2VwdGlv\nbi5Db2RlLk9LKTsKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAgICAgbGgu\nYXN5bmNBZGRFbnRyeShuZXcgYnl0ZVswXSwgbmV3IEFkZENhbGxiYWNrKCkg\newogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBhZGRDb21w\nbGV0ZShpbnQgcmNjYiwgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVudHJ5SWQs\nIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJj\nLmNvbXBhcmVBbmRTZXQoQktFeGNlcHRpb24uQ29kZS5PSywgcmNjYik7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZUxhdGNoLmNvdW50\nRG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgfSwgbnVsbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nY29tcGxldGVMYXRjaC5hd2FpdCgpOwogICAgICAgICAgICBpZiAocmMuZ2V0\nKCkgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAg\ndGhyb3cgQktFeGNlcHRpb24uY3JlYXRlKHJjLmdldCgpKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICogV3JpdGUgYSBu\nb24temVybyBlbnRyeQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgQnl0\nZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAg\nICAgICAgIGVudHJ5LnB1dEludChybmcubmV4dEludChtYXhJbnQpKTsKICAg\nICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CiAgICAgICAgICAgIGVudHJp\nZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICBsaC5hZGRFbnRy\neShlbnRyeS5hcnJheSgpKTsKCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAg\nICAgICAgICAgIGxoID0gYmtjLm9wZW5MZWRnZXIobGVkZ2VySWQsIGRpZ2Vz\ndFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgTE9HLmRlYnVn\nKCJOdW1iZXIgb2YgZW50cmllcyB3cml0dGVuOiAiICsgbGguZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmVyaWZ5\naW5nIG51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW4iLCBsaC5nZXRMYXN0QWRk\nQ29uZmlybWVkKCkgPT0gbnVtRW50cmllc1RvV3JpdGUpOwoKICAgICAgICAg\nICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGxzID0gbGgucmVhZEVudHJp\nZXMoMCwgbnVtRW50cmllc1RvV3JpdGUgLSAxKTsKICAgICAgICAgICAgaW50\nIGkgPSAwOwogICAgICAgICAgICB3aGlsZSAobHMuaGFzTW9yZUVsZW1lbnRz\nKCkpIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgcmVzdWx0ID0gQnl0\nZUJ1ZmZlci53cmFwKGxzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKSk7CiAg\nICAgICAgICAgICAgICBMT0cuZGVidWcoIkxlbmd0aCBvZiByZXN1bHQ6ICIg\nKyByZXN1bHQuY2FwYWNpdHkoKSk7CgogICAgICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZSgiQ2hlY2tpbmcgaWYgZW50cnkgIiArIGkgKyAiIGhhcyB6ZXJvIGJ5\ndGVzIiwgcmVzdWx0LmNhcGFjaXR5KCkgPT0gMCk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChCS0V4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWls\nZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRv\nIEJvb2tLZWVwZXIgZXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoSW50\nZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFp\nbGVkIGR1ZSB0byBpbnRlcnJ1cHRpb24iKTsKICAgICAgICB9CiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RN\ndWx0aUxlZGdlcigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgICAg\nIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNz\nd29yZCk7CiAgICAgICAgICAgIGxoMiA9IGJrYy5jcmVhdGVMZWRnZXIoZGln\nZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwoKICAgICAgICAgICAgbG9uZyBs\nZWRnZXJJZCA9IGxoLmdldElkKCk7CiAgICAgICAgICAgIGxvbmcgbGVkZ2Vy\nSWQyID0gbGgyLmdldElkKCk7CgogICAgICAgICAgICBmaW5hbCBDb3VudERv\nd25MYXRjaCBjb21wbGV0ZUxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKG51\nbUVudHJpZXNUb1dyaXRlKjIpOwogICAgICAgICAgICBmaW5hbCBBdG9taWNJ\nbnRlZ2VyIHJjID0gbmV3IEF0b21pY0ludGVnZXIoQktFeGNlcHRpb24uQ29k\nZS5PSyk7CgogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3Qo\nIlNIQTEiKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJRCAxOiAi\nICsgbGguZ2V0SWQoKSArICIsIExlZGdlciBJRCAyOiAiICsgbGgyLmdldElk\nKCkpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJp\nZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIGxoLmFzeW5jQWRk\nRW50cnkobmV3IGJ5dGVbMF0sIG5ldyBBZGRDYWxsYmFjaygpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgYWRkQ29tcGxldGUoaW50\nIHJjMiwgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVudHJ5SWQsIE9iamVjdCBj\ndHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJjLmNvbXBhcmVB\nbmRTZXQoQktFeGNlcHRpb24uQ29kZS5PSywgcmMyKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbXBsZXRlTGF0Y2guY291bnREb3duKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nLCBudWxsKTsKICAgICAgICAgICAgICAgIGxoMi5hc3luY0FkZEVudHJ5KG5l\ndyBieXRlWzBdLCBuZXcgQWRkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIGFkZENvbXBsZXRlKGludCByYzIsIExl\nZGdlckhhbmRsZSBsaCwgbG9uZyBlbnRyeUlkLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICByYy5jb21wYXJlQW5kU2V0KEJL\nRXhjZXB0aW9uLkNvZGUuT0ssIHJjMik7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb21wbGV0ZUxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgbnVsbCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29tcGxldGVMYXRjaC5hd2Fp\ndCgpOwogICAgICAgICAgICBpZiAocmMuZ2V0KCkgIT0gQktFeGNlcHRpb24u\nQ29kZS5PSykgewogICAgICAgICAgICAgICAgdGhyb3cgQktFeGNlcHRpb24u\nY3JlYXRlKHJjLmdldCgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nbGguY2xvc2UoKTsKICAgICAgICAgICAgbGgyLmNsb3NlKCk7CgogICAgICAg\nICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBl\nLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIGxoMiA9IGJrYy5vcGVu\nTGVkZ2VyKGxlZGdlcklkMiwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQp\nOwoKICAgICAgICAgICAgTE9HLmRlYnVnKCJOdW1iZXIgb2YgZW50cmllcyB3\ncml0dGVuOiAiICsgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpICsgIiwgIiAr\nIGxoMi5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwogICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbiBs\naCAoIiArIGxoLmdldExhc3RBZGRDb25maXJtZWQoKSArICIpIiwgbGgKICAg\nICAgICAgICAgICAgICAgICAgICAuZ2V0TGFzdEFkZENvbmZpcm1lZCgpID09\nIChudW1FbnRyaWVzVG9Xcml0ZSAtIDEpKTsKICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZSgiVmVyaWZ5aW5nIG51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW4gbGgy\nICgiICsgbGgyLmdldExhc3RBZGRDb25maXJtZWQoKSArICIpIiwgbGgyCiAg\nICAgICAgICAgICAgICAgICAgICAgLmdldExhc3RBZGRDb25maXJtZWQoKSA9\nPSAobnVtRW50cmllc1RvV3JpdGUgLSAxKSk7CgogICAgICAgICAgICBFbnVt\nZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMgPSBsaC5yZWFkRW50cmllcygwLCBu\ndW1FbnRyaWVzVG9Xcml0ZSAtIDEpOwogICAgICAgICAgICBpbnQgaSA9IDA7\nCiAgICAgICAgICAgIHdoaWxlIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewog\nICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciByZXN1bHQgPSBCeXRlQnVmZmVy\nLndyYXAobHMubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgpKTsKICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiTGVuZ3RoIG9mIHJlc3VsdDogIiArIHJlc3Vs\ndC5jYXBhY2l0eSgpKTsKCiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJD\naGVja2luZyBpZiBlbnRyeSAiICsgaSArICIgaGFzIHplcm8gYnl0ZXMiLCBy\nZXN1bHQuY2FwYWNpdHkoKSA9PSAwKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBsaC5jbG9zZSgpOwogICAgICAgICAgICBscyA9IGxoMi5yZWFkRW50\ncmllcygwLCBudW1FbnRyaWVzVG9Xcml0ZSAtIDEpOwogICAgICAgICAgICBp\nID0gMDsKICAgICAgICAgICAgd2hpbGUgKGxzLmhhc01vcmVFbGVtZW50cygp\nKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIHJlc3VsdCA9IEJ5dGVC\ndWZmZXIud3JhcChscy5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCkpOwogICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJMZW5ndGggb2YgcmVzdWx0OiAiICsg\ncmVzdWx0LmNhcGFjaXR5KCkpOwoKICAgICAgICAgICAgICAgIGFzc2VydFRy\ndWUoIkNoZWNraW5nIGlmIGVudHJ5ICIgKyBpICsgIiBoYXMgemVybyBieXRl\ncyIsIHJlc3VsdC5jYXBhY2l0eSgpID09IDApOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGxoMi5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxl\nZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8g\nQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigi\nVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWls\nZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFJl\nYWRXcml0ZUFzeW5jTGVuZ3RoKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBTeW5jT2JqIHN5bmMgPSBuZXcgU3luY09iaigpOwogICAgICAgIHRy\neSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgogICAgICAgICAg\nICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFz\nc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3Qo\nIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwog\nICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQo\nKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmll\nc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBl\nbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAgICAg\nICBlbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAg\nICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAgICAgICAgICAgICAgICBl\nbnRyaWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAgICAgICAgICAgICAgIGVu\ndHJpZXNTaXplLmFkZChlbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAgICAgICAg\nICAgICAgICBsaC5hc3luY0FkZEVudHJ5KGVudHJ5LmFycmF5KCksIHRoaXMs\nIHN5bmMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyB3YWl0IGZv\nciBhbGwgZW50cmllcyB0byBiZSBhY2tub3dsZWRnZWQKICAgICAgICAgICAg\nc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAo\nc3luYy5jb3VudGVyIDwgbnVtRW50cmllc1RvV3JpdGUpIHsKICAgICAgICAg\nICAgICAgICAgICBMT0cuZGVidWcoIkVudHJpZXMgY291bnRlciA9ICIgKyBz\neW5jLmNvdW50ZXIpOwogICAgICAgICAgICAgICAgICAgIHN5bmMud2FpdCgp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJFcnJvciBhZGRpbmciLCBCS0V4Y2VwdGlvbi5Db2RlLk9LLCBzeW5j\nLmdldFJldHVybkNvZGUoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nbG9uZyBsZW5ndGggPSBudW1FbnRyaWVzVG9Xcml0ZSAqIDQ7CiAgICAgICAg\nICAgIGFzc2VydFRydWUoIkxlZGdlciBsZW5ndGggYmVmb3JlIGNsb3Npbmc6\nICIgKyBsaC5nZXRMZW5ndGgoKSwgbGguZ2V0TGVuZ3RoKCkgPT0gbGVuZ3Ro\nKTsKCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFdSSVRFIENPTVBMRVRF\nICoqKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAg\nICAgbGguY2xvc2UoKTsKCiAgICAgICAgICAgIC8vICoqKiBXUklUSU5HIFBB\nUlQgQ09NUExFVEUgLy8gUkVBRCBQQVJUIEJFR0lOUyAqKioKCiAgICAgICAg\nICAgIC8vIG9wZW4gbGVkZ2VyCiAgICAgICAgICAgIGxoID0gYmtjLm9wZW5M\nZWRnZXIobGVkZ2VySWQsIGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsK\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTGVkZ2VyIGxlbmd0aCBhZnRlciBv\ncGVuaW5nOiAiICsgbGguZ2V0TGVuZ3RoKCksIGxoLmdldExlbmd0aCgpID09\nIGxlbmd0aCk7CgoKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9\nIGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBm\nYWlsZWQgZHVlIHRvIEJvb2tLZWVwZXIgZXhjZXB0aW9uIik7CiAgICAgICAg\nfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZh\naWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBpbnRlcnJ1cHRpb24iKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHJpdmF0ZSBsb25nIHdyaXRlTkVudHJpZXNMYXN0\nV3JpdGVTeW5jKExlZGdlckhhbmRsZSBsaCwgaW50IG51bVRvV3JpdGUpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNo\nIGNvbXBsZXRlTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2gobnVtVG9Xcml0\nZSAtIDEpOwogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgcmMgPSBuZXcg\nQXRvbWljSW50ZWdlcihCS0V4Y2VwdGlvbi5Db2RlLk9LKTsKCiAgICAgICAg\nQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1Ub1dyaXRlIC0gMTsgaSsr\nKSB7CiAgICAgICAgICAgIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0\nKTsKICAgICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heElu\ndCkpOwogICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAgICAgICAg\nICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICBl\nbnRyaWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAgICAg\nICAgICBsaC5hc3luY0FkZEVudHJ5KGVudHJ5LmFycmF5KCksIG5ldyBBZGRD\nYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBh\nZGRDb21wbGV0ZShpbnQgcmNjYiwgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVu\ndHJ5SWQsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmMuY29tcGFyZUFuZFNldChCS0V4Y2VwdGlvbi5Db2RlLk9LLCByY2NiKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVMYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgY29tcGxldGVMYXRjaC5hd2Fp\ndCgpOwogICAgICAgIGlmIChyYy5nZXQoKSAhPSBCS0V4Y2VwdGlvbi5Db2Rl\nLk9LKSB7CiAgICAgICAgICAgIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShy\nYy5nZXQoKSk7CiAgICAgICAgfQoKICAgICAgICBlbnRyeSA9IEJ5dGVCdWZm\nZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0\nSW50KG1heEludCkpOwogICAgICAgIGVudHJ5LnBvc2l0aW9uKDApOwoKICAg\nICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgpKTsKICAgICAgICBlbnRy\naWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAgICAgIGxo\nLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwogICAgICAgIHJldHVybiBsaC5n\nZXRMYXN0QWRkQ29uZmlybWVkKCk7CiAgICB9CgogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkRnJvbU9wZW5MZWRn\nZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2Mu\nY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAg\nICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAg\nTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdldElkKCkpOwoKICAgICAg\nICAgICAgbG9uZyBsYWMgPSB3cml0ZU5FbnRyaWVzTGFzdFdyaXRlU3luYyhs\naCwgbnVtRW50cmllc1RvV3JpdGUpOwoKICAgICAgICAgICAgTGVkZ2VySGFu\nZGxlIGxoT3BlbiA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJ\nZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAv\nLyBubyByZWNvdmVyeSBvcGVuZWQgbGVkZ2VyICdzIGxhc3QgY29uZmlybWVk\nIGVudHJ5IGlkIGlzIGxlc3MgdGhhbiB3cml0dGVuCiAgICAgICAgICAgIC8v\nIGFuZCBpdCBqdXN0IGNhbiByZWFkIHVudGlsIChpLTEpCiAgICAgICAgICAg\nIGxvbmcgdG9SZWFkID0gbGFjIC0gMTsKCiAgICAgICAgICAgIEVudW1lcmF0\naW9uPExlZGdlckVudHJ5PiByZWFkRW50cnkgPSBsaE9wZW4ucmVhZEVudHJp\nZXModG9SZWFkLCB0b1JlYWQpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJF\nbnVtZXJhdGlvbiBvZiBsZWRnZXIgZW50cmllcyBoYXMgbm8gZWxlbWVudCIs\nIHJlYWRFbnRyeS5oYXNNb3JlRWxlbWVudHMoKSA9PSB0cnVlKTsKICAgICAg\nICAgICAgTGVkZ2VyRW50cnkgZSA9IHJlYWRFbnRyeS5uZXh0RWxlbWVudCgp\nOwogICAgICAgICAgICBhc3NlcnRFcXVhbHModG9SZWFkLCBlLmdldEVudHJ5\nSWQoKSk7CiAgICAgICAgICAgIEFzc2VydC5hc3NlcnRBcnJheUVxdWFscyhl\nbnRyaWVzLmdldCgoaW50KXRvUmVhZCksIGUuZ2V0RW50cnkoKSk7CiAgICAg\nICAgICAgIC8vIHNob3VsZCBub3Qgd3JpdHRlbiB0byBhIHJlYWQgb25seSBs\nZWRnZXIKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAg\nICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwog\nICAgICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CgogICAgICAgICAg\nICAgICAgbGhPcGVuLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwogICAgICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkIGhhdmUgdGhyb3duIGFuIGV4Y2VwdGlv\nbiBoZXJlIik7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJL\nSWxsZWdhbE9wRXhjZXB0aW9uIGJraW9lKSB7CiAgICAgICAgICAgICAgICAv\nLyB0aGlzIGlzIHRoZSBjb3JyZWN0IHJlc3BvbnNlCiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBleCkgewogICAgICAgICAgICAgICAgTE9HLmVy\ncm9yKCJVbmV4cGVjdGVkIGV4Y2VwdGlvbiIsIGV4KTsKICAgICAgICAgICAg\nICAgIGZhaWwoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIik7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgLy8gY2xvc2UgcmVhZCBvbmx5IGxlZGdlciBzaG91\nbGQgbm90IGNoYW5nZSBtZXRhZGF0YQogICAgICAgICAgICBsaE9wZW4uY2xv\nc2UoKTsKCiAgICAgICAgICAgIGxhYyA9IHdyaXRlTkVudHJpZXNMYXN0V3Jp\ndGVTeW5jKGxoLCBudW1FbnRyaWVzVG9Xcml0ZSk7CgogICAgICAgICAgICBh\nc3NlcnRFcXVhbHMoIkxhc3QgY29uZmlybWVkIGFkZDogIiwgbGFjLCAobnVt\nRW50cmllc1RvV3JpdGUgKiAyKSAtIDEpOwoKICAgICAgICAgICAgTE9HLmRl\nYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAgICAgICAgIC8v\nIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAg\nICAgICAvKgogICAgICAgICAgICAgKiBBc3luY2hyb25vdXMgY2FsbCB0byBy\nZWFkIGxhc3QgY29uZmlybWVkIGVudHJ5CiAgICAgICAgICAgICAqLwogICAg\nICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVk\nZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3NhZ2VE\naWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJ\nZCgpOwoKICAgICAgICAgICAgd3JpdGVORW50cmllc0xhc3RXcml0ZVN5bmMo\nbGgsIG51bUVudHJpZXNUb1dyaXRlKTsKCiAgICAgICAgICAgIFN5bmNPYmog\nc3luYyA9IG5ldyBTeW5jT2JqKCk7CiAgICAgICAgICAgIGxoLmFzeW5jUmVh\nZExhc3RDb25maXJtZWQodGhpcywgc3luYyk7CgogICAgICAgICAgICAvLyBX\nYWl0IGZvciBmb3IgbGFzdCBjb25maXJtZWQKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoc3luYy5s\nYXN0Q29uZmlybWVkID09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgTE9H\nLmRlYnVnKCJDb3VudGVyID0gIiArIHN5bmMubGFzdENvbmZpcm1lZCk7CiAg\nICAgICAgICAgICAgICAgICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoIkVycm9yIHJlYWRp\nbmciLCBCS0V4Y2VwdGlvbi5Db2RlLk9LLCBzeW5jLmdldFJldHVybkNvZGUo\nKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGFzc2VydEVxdWFscygi\nTGFzdCBjb25maXJtZWQgYWRkIiwgc3luYy5sYXN0Q29uZmlybWVkLCAobnVt\nRW50cmllc1RvV3JpdGUgLSAyKSk7CgogICAgICAgICAgICBMT0cuZGVidWco\nIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAgICAgICAgICAgLy8gY2xv\nc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfSBj\nYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFp\nbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWls\nKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAg\nfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0UmVhZEZyb21PcGVuTGVkZ2VyT3Blbk9uY2UoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDcmVh\ndGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2Vy\nKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgLy8g\nYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAgICAgICAgICAgIGxl\nZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxl\nZGdlciBJRDogIiArIGxoLmdldElkKCkpOwogICAgICAgICAgICBMZWRnZXJI\nYW5kbGUgbGhPcGVuID0gYmtjLm9wZW5MZWRnZXJOb1JlY292ZXJ5KGxlZGdl\ncklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAg\nIHdyaXRlTkVudHJpZXNMYXN0V3JpdGVTeW5jKGxoLCBudW1FbnRyaWVzVG9X\ncml0ZS8yKTsKCiAgICAgICAgICAgIEJ5dGVCdWZmZXIgZW50cnkgPSBCeXRl\nQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAgICBlbnRyeS5wdXRJbnQo\ncm5nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAgIGVudHJ5LnBvc2l0\naW9uKDApOwoKICAgICAgICAgICAgLy8gbm8gcmVjb3Zlcnkgb3BlbmVkIGxl\nZGdlciAncyBsYXN0IGNvbmZpcm1lZCBlbnRyeSBpZCBpcwogICAgICAgICAg\nICAvLyBsZXNzIHRoYW4gd3JpdHRlbgogICAgICAgICAgICAvLyBhbmQgaXQg\nanVzdCBjYW4gcmVhZCB1bnRpbCAoaS0xKQogICAgICAgICAgICBpbnQgdG9S\nZWFkID0gbnVtRW50cmllc1RvV3JpdGUvMiAtIDI7CgogICAgICAgICAgICBs\nb25nIHJlYWRMYXN0Q29uZmlybWVkID0gbGhPcGVuLnJlYWRMYXN0Q29uZmly\nbWVkKCk7CiAgICAgICAgICAgIGFzc2VydFRydWUocmVhZExhc3RDb25maXJt\nZWQgIT0gMCk7CiAgICAgICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVudHJ5\nPiByZWFkRW50cnkgPSBsaE9wZW4ucmVhZEVudHJpZXModG9SZWFkLCB0b1Jl\nYWQpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJFbnVtZXJhdGlvbiBvZiBs\nZWRnZXIgZW50cmllcyBoYXMgbm8gZWxlbWVudCIsIHJlYWRFbnRyeS5oYXNN\nb3JlRWxlbWVudHMoKSA9PSB0cnVlKTsKICAgICAgICAgICAgTGVkZ2VyRW50\ncnkgZSA9IHJlYWRFbnRyeS5uZXh0RWxlbWVudCgpOwogICAgICAgICAgICBh\nc3NlcnRFcXVhbHModG9SZWFkLCBlLmdldEVudHJ5SWQoKSk7CiAgICAgICAg\nICAgIEFzc2VydC5hc3NlcnRBcnJheUVxdWFscyhlbnRyaWVzLmdldCh0b1Jl\nYWQpLCBlLmdldEVudHJ5KCkpOwogICAgICAgICAgICAvLyBzaG91bGQgbm90\nIHdyaXR0ZW4gdG8gYSByZWFkIG9ubHkgbGVkZ2VyCiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBsaE9wZW4uYWRkRW50cnkoZW50cnkuYXJy\nYXkoKSk7CiAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGQgaGF2ZSB0aHJv\nd24gYW4gZXhjZXB0aW9uIGhlcmUiKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nQktFeGNlcHRpb24uQktJbGxlZ2FsT3BFeGNlcHRpb24gYmtpb2UpIHsKICAg\nICAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhlIGNvcnJlY3QgcmVzcG9uc2UK\nICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIiwgZXgp\nOwogICAgICAgICAgICAgICAgZmFpbCgiVW5leHBlY3RlZCBleGNlcHRpb24i\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3cml0ZU5FbnRyaWVzTGFz\ndFdyaXRlU3luYyhsaCwgbnVtRW50cmllc1RvV3JpdGUvMik7CgogICAgICAg\nICAgICBsb25nIGxhc3QgPSBsaC5yZWFkTGFzdENvbmZpcm1lZCgpOwogICAg\nICAgICAgICBhc3NlcnRUcnVlKCJMYXN0IGNvbmZpcm1lZCBhZGQ6ICIgKyBs\nYXN0LCBsYXN0ID09IChudW1FbnRyaWVzVG9Xcml0ZSAtIDIpKTsKCiAgICAg\nICAgICAgIExPRy5kZWJ1ZygiKioqIFdSSVRFIENPTVBMRVRFICoqKiIpOwog\nICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAgICAgbGguY2xv\nc2UoKTsKICAgICAgICAgICAgLy8gY2xvc2UgcmVhZCBvbmx5IGxlZGdlciBz\naG91bGQgbm90IGNoYW5nZSBtZXRhZGF0YQogICAgICAgICAgICBsaE9wZW4u\nY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAg\nICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIEJvb2tLZWVwZXIgZXhj\nZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwg\nZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBpbnRl\ncnJ1cHRpb24iKTsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkRnJvbU9wZW5MZWRn\nZXJaZXJvQW5kT25lKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgICAg\nIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNz\nd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2VzdCgi\nU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdldElkKCk7CiAg\nICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBsaC5nZXRJZCgp\nKTsKICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoT3BlbiA9IGJrYy5vcGVu\nTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2Vy\nUGFzc3dvcmQpOwoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICogV2Ug\naGF2ZW4ndCB3cml0dGVuIGFueXRoaW5nLCBzbyBpdCBzaG91bGQgYmUgZW1w\ndHkuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBMT0cuZGVidWcoIkNo\nZWNraW5nIHRoYXQgaXQgaXMgZW1wdHkiKTsKICAgICAgICAgICAgbG9uZyBy\nZWFkTGFzdENvbmZpcm1lZCA9IGxoT3Blbi5yZWFkTGFzdENvbmZpcm1lZCgp\nOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJMYXN0IGNvbmZpcm1lZCBoYXMg\ndGhlIHdyb25nIHZhbHVlIiwKICAgICAgICAgICAgICAgICAgICAgICByZWFk\nTGFzdENvbmZpcm1lZCA9PSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9J\nRCk7CgogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBXcml0aW5nIG9u\nZSBlbnRyeS4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIExPRy5kZWJ1\nZygiR29pbmcgdG8gd3JpdGUgb25lIGVudHJ5Iik7CiAgICAgICAgICAgIEJ5\ndGVCdWZmZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAg\nICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4SW50KSk7CiAg\nICAgICAgICAgIGVudHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAgICAgZW50\ncmllcy5hZGQoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgIGVudHJpZXNT\naXplLmFkZChlbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAgICAgICAgICAgIGxo\nLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwoKICAgICAgICAgICAgLyoKICAg\nICAgICAgICAgICogVGhlIGhpbnQgc2hvdWxkIHN0aWxsIGluZGljYXRlIHRo\nYXQgdGhlcmUgaXMgbm8gY29uZmlybWVkCiAgICAgICAgICAgICAqIGFkZC4K\nICAgICAgICAgICAgICovCiAgICAgICAgICAgIExPRy5kZWJ1ZygiQ2hlY2tp\nbmcgdGhhdCBpdCBpcyBzdGlsbCBlbXB0eSBldmVuIGFmdGVyIHdyaXRpbmcg\nb25lIGVudHJ5Iik7CiAgICAgICAgICAgIHJlYWRMYXN0Q29uZmlybWVkID0g\nbGhPcGVuLnJlYWRMYXN0Q29uZmlybWVkKCk7CiAgICAgICAgICAgIGFzc2Vy\ndFRydWUocmVhZExhc3RDb25maXJtZWQgPT0gTGVkZ2VySGFuZGxlLklOVkFM\nSURfRU5UUllfSUQpOwoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICog\nQWRkaW5nIG9uZSBtb3JlLCBhbmQgdGhpcyB0aW1lIHdlIHNob3VsZCBleHBl\nY3QgdG8KICAgICAgICAgICAgICogc2VlIG9uZSBlbnRyeS4KICAgICAgICAg\nICAgICovCiAgICAgICAgICAgIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0\nZSg0KTsKICAgICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1h\neEludCkpOwogICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKCiAgICAg\nICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAg\nICBlbnRyaWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAg\nICAgICAgICBsaC5hZGRFbnRyeShlbnRyeS5hcnJheSgpKTsKCiAgICAgICAg\nICAgIExPRy5pbmZvKCJDaGVja2luZyB0aGF0IGl0IGhhcyBhbiBlbnRyeSIp\nOwogICAgICAgICAgICByZWFkTGFzdENvbmZpcm1lZCA9IGxoT3Blbi5yZWFk\nTGFzdENvbmZpcm1lZCgpOwogICAgICAgICAgICBhc3NlcnRUcnVlKHJlYWRM\nYXN0Q29uZmlybWVkID09IDBMKTsKCiAgICAgICAgICAgIC8vIGNsb3NlIGxl\nZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgICAgICAvLyBj\nbG9zZSByZWFkIG9ubHkgbGVkZ2VyIHNob3VsZCBub3QgY2hhbmdlIG1ldGFk\nYXRhCiAgICAgICAgICAgIGxoT3Blbi5jbG9zZSgpOwogICAgICAgIH0gY2F0\nY2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJU\nZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxl\nZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgi\nVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0K\nICAgIH0KCgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RMYXN0Q29uZmlybWVkQWRkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2Vy\nCiAgICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBl\nLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVz\nc2FnZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxo\nLmdldElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIg\nKyBsaC5nZXRJZCgpKTsKCiAgICAgICAgICAgIHdyaXRlTkVudHJpZXNMYXN0\nV3JpdGVTeW5jKGxoLCBudW1FbnRyaWVzVG9Xcml0ZSk7CiAgICAgICAgICAg\nIGxvbmcgbGFzdCA9IGxoLnJlYWRMYXN0Q29uZmlybWVkKCk7CiAgICAgICAg\nICAgIGFzc2VydFRydWUoIkxhc3QgY29uZmlybWVkIGFkZDogIiArIGxhc3Qs\nIGxhc3QgPT0gKG51bUVudHJpZXNUb1dyaXRlIC0gMikpOwoKICAgICAgICAg\nICAgTE9HLmRlYnVnKCIqKiogV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAg\nICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgp\nOwogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBBc3luY2hyb25vdXMg\nY2FsbCB0byByZWFkIGxhc3QgY29uZmlybWVkIGVudHJ5CiAgICAgICAgICAg\nICAqLwogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0\nVHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5p\ndE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQg\nPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElE\nOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIHdyaXRlTkVudHJpZXNM\nYXN0V3JpdGVTeW5jKGxoLCBudW1FbnRyaWVzVG9Xcml0ZSk7CgogICAgICAg\nICAgICBTeW5jT2JqIHN5bmMgPSBuZXcgU3luY09iaigpOwogICAgICAgICAg\nICBsaC5hc3luY1JlYWRMYXN0Q29uZmlybWVkKHRoaXMsIHN5bmMpOwoKICAg\nICAgICAgICAgLy8gV2FpdCBmb3IgZm9yIGxhc3QgY29uZmlybWVkCiAgICAg\nICAgICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAgICAgICAgICAg\nd2hpbGUgKHN5bmMubGFzdENvbmZpcm1lZCA9PSBMZWRnZXJIYW5kbGUuSU5W\nQUxJRF9FTlRSWV9JRCkgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiQ291bnRlciA9ICIgKyBzeW5jLmxhc3RDb25maXJtZWQpOwogICAgICAg\nICAgICAgICAgICAgIHN5bmMud2FpdCgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJFcnJvciByZWFkaW5nIiwg\nQktFeGNlcHRpb24uQ29kZS5PSywgc3luYy5nZXRSZXR1cm5Db2RlKCkpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBhc3NlcnRUcnVlKCJMYXN0IGNv\nbmZpcm1lZCBhZGQ6ICIgKyBzeW5jLmxhc3RDb25maXJtZWQsIHN5bmMubGFz\ndENvbmZpcm1lZCA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAyKSk7CgogICAg\nICAgICAgICBMT0cuZGVidWcoIioqKiBXUklURSBDT01QTEVURSAqKioiKTsK\nICAgICAgICAgICAgLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNs\nb3NlKCk7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAg\nICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2Vw\ndGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUp\nOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJy\ndXB0aW9uIik7CiAgICAgICAgfQogICAgfQoKCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIGFkZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxl\nIGxoLCBsb25nIGVudHJ5SWQsIE9iamVjdCBjdHgpIHsKICAgICAgICBTeW5j\nT2JqIHN5bmMgPSAoU3luY09iaikgY3R4OwogICAgICAgIHN5bmMuc2V0UmV0\ndXJuQ29kZShyYyk7CiAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAg\nICAgICAgICAgIHN5bmMuY291bnRlcisrOwogICAgICAgICAgICBzeW5jLm5v\ndGlmeSgpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIHJlYWRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBs\naCwgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNlcSwgT2JqZWN0IGN0eCkg\newogICAgICAgIFN5bmNPYmogc3luYyA9IChTeW5jT2JqKSBjdHg7CiAgICAg\nICAgc3luYy5zZXRMZWRnZXJFbnRyaWVzKHNlcSk7CiAgICAgICAgc3luYy5z\nZXRSZXR1cm5Db2RlKHJjKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMp\nIHsKICAgICAgICAgICAgc3luYy52YWx1ZSA9IHRydWU7CiAgICAgICAgICAg\nIHN5bmMubm90aWZ5KCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJtZWRDb21wbGV0ZShp\nbnQgcmMsIGxvbmcgbGFzdENvbmZpcm1lZCwgT2JqZWN0IGN0eCkgewogICAg\nICAgIFN5bmNPYmogc3luYyA9IChTeW5jT2JqKSBjdHg7CiAgICAgICAgc3lu\nYy5zZXRSZXR1cm5Db2RlKHJjKTsKICAgICAgICBzeW5jaHJvbml6ZWQoc3lu\nYykgewogICAgICAgICAgICBzeW5jLmxhc3RDb25maXJtZWQgPSBsYXN0Q29u\nZmlybWVkOwogICAgICAgICAgICBzeW5jLm5vdGlmeSgpOwogICAgICAgIH0K\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2\nb2lkIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIu\nc2V0VXAoKTsKICAgICAgICBybmcgPSBuZXcgUmFuZG9tKFN5c3RlbS5jdXJy\nZW50VGltZU1pbGxpcygpKTsgLy8gSW5pdGlhbGl6ZSB0aGUgUmFuZG9tCiAg\nICAgICAgLy8gTnVtYmVyIEdlbmVyYXRvcgogICAgICAgIGVudHJpZXMgPSBu\nZXcgQXJyYXlMaXN0PGJ5dGVbXT4oKTsgLy8gaW5pdGlhbGl6ZSB0aGUgZW50\ncmllcyBsaXN0CiAgICAgICAgZW50cmllc1NpemUgPSBuZXcgQXJyYXlMaXN0\nPEludGVnZXI+KCk7CiAgICB9CgogICAgLyogQ2xlYW4gdXAgYSBkaXJlY3Rv\ncnkgcmVjdXJzaXZlbHkgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGNsZWFu\nVXBEaXIoRmlsZSBkaXIpIHsKICAgICAgICBpZiAoZGlyLmlzRGlyZWN0b3J5\nKCkpIHsKICAgICAgICAgICAgTE9HLmluZm8oIkNsZWFuaW5nIHVwICIgKyBk\naXIuZ2V0TmFtZSgpKTsKICAgICAgICAgICAgU3RyaW5nW10gY2hpbGRyZW4g\nPSBkaXIubGlzdCgpOwogICAgICAgICAgICBmb3IgKFN0cmluZyBzdHJpbmcg\nOiBjaGlsZHJlbikgewogICAgICAgICAgICAgICAgYm9vbGVhbiBzdWNjZXNz\nID0gY2xlYW5VcERpcihuZXcgRmlsZShkaXIsIHN0cmluZykpOwogICAgICAg\nICAgICAgICAgaWYgKCFzdWNjZXNzKQogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAv\nLyBUaGUgZGlyZWN0b3J5IGlzIG5vdyBlbXB0eSBzbyBkZWxldGUgaXQKICAg\nICAgICByZXR1cm4gZGlyLmRlbGV0ZSgpOwogICAgfQoKICAgIC8qIFVzZXIg\nZm9yIHRlc3RpbmcgcHVycG9zZXMsIHZvaWQgKi8KICAgIGNsYXNzIGVtcHR5\nV2F0Y2hlciBpbXBsZW1lbnRzIFdhdGNoZXIgewogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2\nZW50KSB7CiAgICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

