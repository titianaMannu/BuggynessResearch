{"sha":"caf1c3d0c456821c583a36926d2be065da84de42","node_id":"MDQ6QmxvYjE1NzU5NTY6Y2FmMWMzZDBjNDU2ODIxYzU4M2EzNjkyNmQyYmUwNjVkYTg0ZGU0Mg==","size":6711,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/caf1c3d0c456821c583a36926d2be065da84de42","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5pby5CeXRlQnVmZmVyOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuU2VtYXBob3JlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuYXRvbWljLkF0b21pY0ludGVnZXI7CgppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWU7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubmV0LkJvb2tpZVNvY2tl\ndEFkZHJlc3M7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5U\nZXN0QktDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNh\nbGxiYWNrOwppbXBvcnQgb3JnLmp1bml0LkFmdGVyOwppbXBvcnQgb3JnLmp1\nbml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5\nOwoKaW1wb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0Lio7CgovKioKICog\nVGVzdHMgd3JpdGluZyB0byBjb25jdXJyZW50IGxlZGdlcnMKICovCnB1Ymxp\nYyBjbGFzcyBDb25jdXJyZW50TGVkZ2VyVGVzdCB7CiAgICBwcml2YXRlIGZp\nbmFsIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dn\nZXIoQ29uY3VycmVudExlZGdlclRlc3QuY2xhc3MpOwoKICAgIEJvb2tpZSBi\nb29raWU7CiAgICBGaWxlIHR4bkRpciwgbGVkZ2VyRGlyOwogICAgaW50IHJl\nY3ZUaW1lb3V0ID0gMTAwMDA7CiAgICBTZW1hcGhvcmUgdGhyb3R0bGU7CiAg\nICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBUZXN0QktDb25maWd1cmF0\naW9uLm5ld1NlcnZlckNvbmZpZ3VyYXRpb24oKTsKCiAgICBAQmVmb3JlCiAg\nICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIFN0cmluZyB0eG5EaXJOYW1lID0gU3lzdGVtLmdldFByb3BlcnR5KCJ0\neG5EaXIiKTsKICAgICAgICBpZiAodHhuRGlyTmFtZSAhPSBudWxsKSB7CiAg\nICAgICAgICAgIHR4bkRpciA9IG5ldyBGaWxlKHR4bkRpck5hbWUpOwogICAg\nICAgIH0KICAgICAgICBTdHJpbmcgbGVkZ2VyRGlyTmFtZSA9IFN5c3RlbS5n\nZXRQcm9wZXJ0eSgibGVkZ2VyRGlyIik7CiAgICAgICAgaWYgKGxlZGdlckRp\nck5hbWUgIT0gbnVsbCkgewogICAgICAgICAgICBsZWRnZXJEaXIgPSBuZXcg\nRmlsZShsZWRnZXJEaXJOYW1lKTsKICAgICAgICB9CiAgICAgICAgRmlsZSB0\nbXBGaWxlID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9vayIsICIudHhuIiwg\ndHhuRGlyKTsKICAgICAgICB0bXBGaWxlLmRlbGV0ZSgpOwogICAgICAgIHR4\nbkRpciA9IG5ldyBGaWxlKHRtcEZpbGUuZ2V0UGFyZW50KCksIHRtcEZpbGUu\nZ2V0TmFtZSgpKyIuZGlyIik7CiAgICAgICAgdHhuRGlyLm1rZGlycygpOwog\nICAgICAgIHRtcEZpbGUgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29rIiwg\nIi5sZWRnZXIiLCBsZWRnZXJEaXIpOwogICAgICAgIGxlZGdlckRpciA9IG5l\ndyBGaWxlKHRtcEZpbGUuZ2V0UGFyZW50KCksIHRtcEZpbGUuZ2V0TmFtZSgp\nKyIuZGlyIik7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGlycygpOwoKICAgICAg\nICBjb25mLnNldEJvb2tpZVBvcnQoNTAwMCk7CiAgICAgICAgY29uZi5zZXRa\na1NlcnZlcnMobnVsbCk7CiAgICAgICAgY29uZi5zZXRKb3VybmFsRGlyTmFt\nZSh0eG5EaXIuZ2V0UGF0aCgpKTsKICAgICAgICBjb25mLnNldExlZGdlckRp\nck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7\nCiAgICAgICAgYm9va2llID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICBi\nb29raWUuc3RhcnQoKTsKICAgIH0KCiAgICBzdGF0aWMgdm9pZCByZWN1cnNp\ndmVEZWxldGUoRmlsZSBmKSB7CiAgICAgICAgaWYgKGYuaXNGaWxlKCkpIHsK\nICAgICAgICAgICAgZi5kZWxldGUoKTsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBmb3IoRmlsZSBpOiBmLmxpc3RGaWxlcygpKSB7CiAgICAgICAg\nICAgICAgICByZWN1cnNpdmVEZWxldGUoaSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZi5kZWxldGUoKTsKICAgICAgICB9CiAgICB9CgogICAgQEFm\ndGVyCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHsKICAgICAgICBib29r\naWUuc2h1dGRvd24oKTsKICAgICAgICByZWN1cnNpdmVEZWxldGUodHhuRGly\nKTsKICAgICAgICByZWN1cnNpdmVEZWxldGUobGVkZ2VyRGlyKTsKICAgIH0K\nCiAgICBieXRlIHplcm9zW10gPSBuZXcgYnl0ZVsxNl07CgogICAgaW50IGl0\nZXJhdGlvbnMgPSA1MTsKICAgIHsKICAgICAgICBTdHJpbmcgaXRlcmF0aW9u\nc1N0cmluZyA9IFN5c3RlbS5nZXRQcm9wZXJ0eSgiaXRlcmF0aW9ucyIpOwog\nICAgICAgIGlmIChpdGVyYXRpb25zU3RyaW5nICE9IG51bGwpIHsKICAgICAg\nICAgICAgaXRlcmF0aW9ucyA9IEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9u\nc1N0cmluZyk7CiAgICAgICAgfQogICAgfQogICAgaW50IGl0ZXJhdGlvblN0\nZXAgPSAyNTsKICAgIHsKICAgICAgICBTdHJpbmcgaXRlcmF0aW9uc1N0cmlu\nZyA9IFN5c3RlbS5nZXRQcm9wZXJ0eSgiaXRlcmF0aW9uU3RlcCIpOwogICAg\nICAgIGlmIChpdGVyYXRpb25zU3RyaW5nICE9IG51bGwpIHsKICAgICAgICAg\nICAgaXRlcmF0aW9uU3RlcCA9IEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9u\nc1N0cmluZyk7CiAgICAgICAgfQogICAgfQogICAgQFRlc3QodGltZW91dD02\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDb25jdXJyZW50V3JpdGUoKSB0\naHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29r\naWVFeGNlcHRpb24gewogICAgICAgIGludCBzaXplID0gMTAyNDsKICAgICAg\nICBpbnQgdG90YWx3cml0ZXMgPSAxMjg7CiAgICAgICAgaWYgKFN5c3RlbS5n\nZXRQcm9wZXJ0eSgidG90YWx3cml0ZXMiKSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIHRvdGFsd3JpdGVzID0gSW50ZWdlci5wYXJzZUludChTeXN0ZW0uZ2V0\nUHJvcGVydHkoInRvdGFsd3JpdGVzIikpOwogICAgICAgIH0KICAgICAgICBM\nT0cuaW5mbygiUnVubmluZyB1cCB0byAiICsgaXRlcmF0aW9ucyArICIgaXRl\ncmF0aW9ucyIpOwogICAgICAgIExPRy5pbmZvKCJUb3RhbCB3cml0ZXMgPSAi\nICsgdG90YWx3cml0ZXMpOwogICAgICAgIGludCBsZWRnZXJzOwogICAgICAg\nIGZvcihsZWRnZXJzID0gMTsgbGVkZ2VycyA8PSBpdGVyYXRpb25zOyBsZWRn\nZXJzICs9IGl0ZXJhdGlvblN0ZXApIHsKICAgICAgICAgICAgbG9uZyBkdXJh\ndGlvbiA9IGRvV3JpdGVzKGxlZGdlcnMsIHNpemUsIHRvdGFsd3JpdGVzKTsK\nICAgICAgICAgICAgTE9HLmluZm8odG90YWx3cml0ZXMgKyAiIG9uICIgKyBs\nZWRnZXJzICsgIiB0b29rICIgKyBkdXJhdGlvbiArICIgbXMiKTsKICAgICAg\nICB9CiAgICAgICAgTE9HLmluZm8oImxlZGdlcnMgIiArIGxlZGdlcnMpOwog\nICAgICAgIGZvcihsZWRnZXJzID0gMTsgbGVkZ2VycyA8PSBpdGVyYXRpb25z\nOyBsZWRnZXJzICs9IGl0ZXJhdGlvblN0ZXApIHsKICAgICAgICAgICAgbG9u\nZyBkdXJhdGlvbiA9IGRvUmVhZHMobGVkZ2Vycywgc2l6ZSwgdG90YWx3cml0\nZXMpOwogICAgICAgICAgICBMT0cuaW5mbyhsZWRnZXJzICsgIiByZWFkICIg\nKyBkdXJhdGlvbiArICIgbXMiKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSBsb25nIGRvUmVhZHMoaW50IGxlZGdlcnMsIGludCBzaXplLCBpbnQg\ndG90YWx3cml0ZXMpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwg\nSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAg\nICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwog\nICAgICAgIGZvcihpbnQgaSA9IDE7IGkgPD0gdG90YWx3cml0ZXMvbGVkZ2Vy\nczsgaSsrKSB7CiAgICAgICAgICAgIGZvcihpbnQgaiA9IDE7IGogPD0gbGVk\nZ2VyczsgaisrKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIGVudHJ5\nID0gYm9va2llLnJlYWRFbnRyeShqLCBpKTsKICAgICAgICAgICAgICAgIC8v\nIHNraXAgdGhlIGxlZGdlciBpZCBhbmQgdGhlIGVudHJ5IGlkCiAgICAgICAg\nICAgICAgICBlbnRyeS5nZXRMb25nKCk7CiAgICAgICAgICAgICAgICBlbnRy\neS5nZXRMb25nKCk7CiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoaiAr\nICJAIiArIGksIGorMiwgZW50cnkuZ2V0TG9uZygpKTsKICAgICAgICAgICAg\nICAgIGFzc2VydEVxdWFscyhqICsgIkAiICsgaSwgaSszLCBlbnRyeS5nZXRM\nb25nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxvbmcg\nZmluaXNoID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAg\ncmV0dXJuIGZpbmlzaCAtIHN0YXJ0OwogICAgfQogICAgcHJpdmF0ZSBsb25n\nIGRvV3JpdGVzKGludCBsZWRnZXJzLCBpbnQgc2l6ZSwgaW50IHRvdGFsd3Jp\ndGVzKQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVw\ndGVkRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHRocm90\ndGxlID0gbmV3IFNlbWFwaG9yZSgxMDAwMCk7CiAgICAgICAgV3JpdGVDYWxs\nYmFjayBjYiA9IG5ldyBXcml0ZUNhbGxiYWNrKCkgewogICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgd3JpdGVDb21wbGV0\nZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCwKICAgICAg\nICAgICAgICAgICAgICBCb29raWVTb2NrZXRBZGRyZXNzIGFkZHIsIE9iamVj\ndCBjdHgpIHsKICAgICAgICAgICAgICAgIEF0b21pY0ludGVnZXIgY291bnRl\nciA9IChBdG9taWNJbnRlZ2VyKWN0eDsKICAgICAgICAgICAgICAgIGNvdW50\nZXIuZ2V0QW5kSW5jcmVtZW50KCk7CiAgICAgICAgICAgICAgICB0aHJvdHRs\nZS5yZWxlYXNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAg\nIEF0b21pY0ludGVnZXIgY291bnRlciA9IG5ldyBBdG9taWNJbnRlZ2VyKCk7\nCiAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpOwogICAgICAgIGZvcihpbnQgaSA9IDE7IGkgPD0gdG90YWx3cml0ZXMv\nbGVkZ2VyczsgaSsrKSB7CiAgICAgICAgICAgIGZvcihpbnQgaiA9IDE7IGog\nPD0gbGVkZ2VyczsgaisrKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVy\nIGJ5dGVzID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZShzaXplKTsKICAgICAgICAg\nICAgICAgIGJ5dGVzLnB1dExvbmcoaik7CiAgICAgICAgICAgICAgICBieXRl\ncy5wdXRMb25nKGkpOwogICAgICAgICAgICAgICAgYnl0ZXMucHV0TG9uZyhq\nKzIpOwogICAgICAgICAgICAgICAgYnl0ZXMucHV0TG9uZyhpKzMpOwogICAg\nICAgICAgICAgICAgYnl0ZXMucHV0KCgiVGhpcyBpcyBsZWRnZXIgIiArIGog\nKyAiIGVudHJ5ICIgKyBpKS5nZXRCeXRlcygpKTsKICAgICAgICAgICAgICAg\nIGJ5dGVzLnBvc2l0aW9uKDApOwogICAgICAgICAgICAgICAgYnl0ZXMubGlt\naXQoYnl0ZXMuY2FwYWNpdHkoKSk7CiAgICAgICAgICAgICAgICB0aHJvdHRs\nZS5hY3F1aXJlKCk7CiAgICAgICAgICAgICAgICBib29raWUuYWRkRW50cnko\nYnl0ZXMsIGNiLCBjb3VudGVyLCB6ZXJvcyk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgbG9uZyBmaW5pc2ggPSBTeXN0ZW0uY3VycmVudFRp\nbWVNaWxsaXMoKTsKICAgICAgICByZXR1cm4gZmluaXNoIC0gc3RhcnQ7CiAg\nICB9Cn0K\n","encoding":"base64"}

