{"sha":"16ef0c52e55bad00f3a046a390ffa9b62c5b9f20","node_id":"MDQ6QmxvYjE1NzU5NTY6MTZlZjBjNTJlNTViYWQwMGYzYTA0NmEzOTBmZmE5YjYyYzViOWYyMA==","size":13292,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/16ef0c52e55bad00f3a046a390ffa9b62c5b9f20","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnRlc3Q7CgppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51\ndGlsLkVudW1lcmF0aW9uOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTm9TdWNoRWxlbWVudEV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNCb29sZWFuOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNr\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5CS0V4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9v\na0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQm9va0tlZXBlclRlc3RDbGllbnQ7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkxlZGdlckVudHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuanVu\naXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcu\nc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0\nLkFzc2VydC4qOwppbXBvcnQgc3RhdGljIGNvbS5nb29nbGUuY29tbW9uLmJh\nc2UuQ2hhcnNldHMuVVRGXzg7CgpwdWJsaWMgY2xhc3MgTXVsdGlwbGVUaHJl\nYWRSZWFkVGVzdCBleHRlbmRzIEJvb2tLZWVwZXJDbHVzdGVyVGVzdENhc2Ug\newogICAgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihNdWx0aXBsZVRocmVhZFJlYWRUZXN0LmNsYXNzKTsKCiAgICBCb29r\nS2VlcGVyLkRpZ2VzdFR5cGUgZGlnZXN0VHlwZTsKICAgIGJ5dGUgW10gbGVk\nZ2VyUGFzc3dvcmQgPSAiYWFhIi5nZXRCeXRlcygpOwogICAgcHJpdmF0ZSBp\nbnQgZW50cmllc1BlckxlZGdlciA9IDEwMDsKICAgIGZpbmFsIFN5bmNPYmog\nbWFpblN5bmNPYmogPSBuZXcgU3luY09iaigpOwoKICAgIGNsYXNzIFN5bmNP\nYmogewogICAgICAgIHZvbGF0aWxlIGludCBjb3VudGVyOwogICAgICAgIGJv\nb2xlYW4gZmFpbGVkOwogICAgICAgIHB1YmxpYyBTeW5jT2JqKCkgewogICAg\nICAgICAgICBjb3VudGVyID0gMDsKICAgICAgICAgICAgZmFpbGVkID0gZmFs\nc2U7CiAgICAgICAgfQogICAgfQoKICAgIEJvb2tLZWVwZXJUZXN0Q2xpZW50\nIHJlYWRCa2M7CgogICAgcHVibGljIE11bHRpcGxlVGhyZWFkUmVhZFRlc3Qo\nKSB7CiAgICAgICAgc3VwZXIoNik7CiAgICAgICAgdGhpcy5kaWdlc3RUeXBl\nID0gQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMyOwogICAgICAgIGJhc2VD\nbGllbnRDb25mLnNldEFkZEVudHJ5VGltZW91dCgyMCk7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgcmVhZEJr\nYyA9IG5ldyBCb29rS2VlcGVyVGVzdENsaWVudChiYXNlQ2xpZW50Q29uZik7\nCiAgICB9CgogICAgcHJpdmF0ZSBUaHJlYWQgZ2V0V3JpdGVyVGhyZWFkKGZp\nbmFsIGludCB0Tm8sIGZpbmFsIExlZGdlckhhbmRsZSBsaCwgZmluYWwgQXRv\nbWljQm9vbGVhbiByZXN1bHRIb2xkZXIpIHsKICAgICAgICBUaHJlYWQgdCA9\nIG5ldyBUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAg\nICAgICAgICAgZmluYWwgU3luY09iaiB0U3luYyA9IG5ldyBTeW5jT2JqKCk7\nCiAgICAgICAgICAgICAgICBmb3IgKGludCBqID0gMDsgaiA8IGVudHJpZXNQ\nZXJMZWRnZXI7IGorKykgewogICAgICAgICAgICAgICAgICAgIGZpbmFsIGJ5\ndGVbXSBlbnRyeSA9ICgiRW50cnktIiArIHRObyArICItIiArIGopLmdldEJ5\ndGVzKCk7CiAgICAgICAgICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShl\nbnRyeSwgbmV3IEFzeW5jQ2FsbGJhY2suQWRkQ2FsbGJhY2soKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBhZGRDb21wbGV0ZShpbnQgcmMsIExlZGdl\nckhhbmRsZSBsZWRnZXJIYW5kbGUsIGxvbmcgZWlkLCBPYmplY3Qgbykgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgU3luY09iaiBzeW5jT2JqID0g\nKFN5bmNPYmopbzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNo\ncm9uaXplZCAoc3luY09iaikgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQWRk\nIGVudHJ5IHt9IGZhaWxlZCA6IHJjID0ge30iLCBuZXcgU3RyaW5nKGVudHJ5\nLCBVVEZfOCksIHJjKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc3luY09iai5mYWlsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzeW5jT2JqLm5vdGlmeSgpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNPYmouY291bnRlcisrOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW5jT2JqLm5v\ndGlmeSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIHRTeW5jKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCAodFN5\nbmMpIHsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIXRTeW5jLmZhaWxl\nZCAmJiB0U3luYy5jb3VudGVyIDwgZW50cmllc1BlckxlZGdlcikgewogICAg\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgdFN5bmMud2FpdCgpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmlu\ndGVycnVwdCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHJlc3VsdEhvbGRl\nci5zZXQoIXRTeW5jLmZhaWxlZCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAvLyBjbG9zZSB0aGlzIGhhbmRsZQogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBsaC5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkludGVycnVwdGVk\nIG9uIGNsb3NpbmcgbGVkZ2VyIGhhbmRsZSB7fSA6ICIsIGxoLmdldElkKCks\nIGllKTsKICAgICAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVh\nZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoQktF\neGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJFcnJvciBvbiBjbG9zaW5nIGxlZGdlciBoYW5kbGUge30gOiAiLCBsaC5n\nZXRJZCgpLCBia2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfSwgIldyaXRlVGhyZWFkKExpZD0iICsgbGguZ2V0SWQoKSAr\nICIpIik7CiAgICAgICAgdC5zZXRVbmNhdWdodEV4Y2VwdGlvbkhhbmRsZXIo\nbmV3IFRocmVhZC5VbmNhdWdodEV4Y2VwdGlvbkhhbmRsZXIoKSB7CiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCB1bmNh\ndWdodEV4Y2VwdGlvbihUaHJlYWQgdGhyZWFkLCBUaHJvd2FibGUgdGhyb3dh\nYmxlKSB7CiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKG1haW5TeW5j\nT2JqKSB7CiAgICAgICAgICAgICAgICAgICAgbWFpblN5bmNPYmouZmFpbGVk\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0pOwogICAgICAgIHJldHVybiB0OwogICAgfQoKICAgIHByaXZhdGUg\nVGhyZWFkIGdldFJlYWRlclRocmVhZChmaW5hbCBpbnQgdE5vLCBmaW5hbCBM\nZWRnZXJIYW5kbGUgbGgsIGZpbmFsIGludCBsZWRnZXJOdW1iZXIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgQXRvbWljQm9v\nbGVhbiByZXN1bHRIb2xkZXIpIHsKICAgICAgICBUaHJlYWQgdCA9IG5ldyBU\naHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAg\nICAgLy9MZWRnZXJIYW5kbGUgbGggPSBjbGllbnRMaXN0LmdldCgwKS5vcGVu\nTGVkZ2VyKGxlZGdlcklkcy5nZXQodE5vICUgbnVtTGVkZ2VycyksIGRpZ2Vz\ndFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgICAgIGxvbmcg\nc3RhcnRFbnRyeUlkID0gMDsKICAgICAgICAgICAgICAgIGxvbmcgZW5kRW50\ncnlJZDsKICAgICAgICAgICAgICAgIGxvbmcgZWlkID0gMDsKICAgICAgICAg\nICAgICAgIHdoaWxlIChzdGFydEVudHJ5SWQgPD0gZW50cmllc1BlckxlZGdl\nciAtIDEpIHsKICAgICAgICAgICAgICAgICAgICBlbmRFbnRyeUlkID0gTWF0\naC5taW4oc3RhcnRFbnRyeUlkICsgMTAgLSAxLCBlbnRyaWVzUGVyTGVkZ2Vy\nIC0gMSk7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgbG9uZyBudW1FbnRy\naWVzID0gKGVuZEVudHJ5SWQgLSBzdGFydEVudHJ5SWQpICsgMTsKICAgICAg\nICAgICAgICAgICAgICBib29sZWFuIHN1Y2Nlc3MgPSB0cnVlOwogICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEVu\ndW1lcmF0aW9uPExlZGdlckVudHJ5PiBsaXN0ID0gbGgucmVhZEVudHJpZXMo\nc3RhcnRFbnRyeUlkLCBlbmRFbnRyeUlkKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBudW1FbnRyaWVzOyBqKyspIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZGdlckVudHJ5IGU7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGUgPSBsaXN0Lm5leHRFbGVtZW50KCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hFbGVt\nZW50RXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcgY3Vy\nRWlkID0gZWlkKys7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nZS5nZXRFbnRyeUlkKCkgIT0gY3VyRWlkKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeHBlY3RlZCBlbnRyeSBpZCB7\nfSBmb3IgbGVkZ2VyIHt9IGJ1dCB7fSBmb3VuZC4iLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgT2JqZWN0W10geyBj\ndXJFaWQsIGxoLmdldElkKCksIGUuZ2V0RW50cnlJZCgpIH0pOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGJ5dGVbXSBkYXRhID0gZS5nZXRFbnRyeSgpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKCFBcnJheXMuZXF1YWxzKCgiRW50cnktIiAr\nIGxlZGdlck51bWJlciArICItIiArIGUuZ2V0RW50cnlJZCgpKS5nZXRCeXRl\ncygpLCBkYXRhKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRXhwZWN0ZWQgZW50cnkgZGF0YSAnRW50cnkte30te30n\nIGJ1dCB7fSBmb3VuZCBmb3IgbGVkZ2VyIHt9LiIsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IGxl\nZGdlck51bWJlciwgZS5nZXRFbnRyeUlkKCksIG5ldyBTdHJpbmcoZGF0YSwg\nVVRGXzgpLCBsaC5nZXRJZCgpIH0pOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgc3VjY2VzcyA9ICFsaXN0Lmhhc01vcmVFbGVtZW50cygpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdWNjZXNzKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJGb3Vu\nZCBtb3JlIGVudHJpZXMgcmV0dXJuZWQgb24gcmVhZGluZyAoe30te30pIGZy\nb20gbGVkZ2VyIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7IHN0YXJ0RW50cnlJZCwgZW5k\nRW50cnlJZCwgbGguZ2V0SWQoKSB9KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJydXB0\nZWQgb24gcmVhZGluZyBlbnRyaWVzICh7fSAtIHt9KSBmcm9tIGxlZGdlciB7\nfSA6ICIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcg\nT2JqZWN0W10geyBzdGFydEVudHJ5SWQsIGVuZEVudHJ5SWQsIGxoLmdldElk\nKCksIGllIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQuY3Vy\ncmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgICAg\nICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoQktFeGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiRmFpbGVkIG9uIHJlYWRpbmcgZW50cmllcyAoe30g\nLSB7fSkgZnJvbSBsZWRnZXIge30gOiAiLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgc3RhcnRFbnRyeUlkLCBl\nbmRFbnRyeUlkLCBsaC5nZXRJZCgpLCBia2UgfSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0SG9sZGVyLnNldChzdWNj\nZXNzKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIHN0YXJ0RW50cnlJZCA9IGVuZEVu\ndHJ5SWQgKyAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSwgIlJlYWRUaHJlYWQoVGlkID0iICsgdE5vICArICIsIExpZD0i\nICsgbGguZ2V0SWQoKSArICIpIik7CiAgICAgICAgdC5zZXRVbmNhdWdodEV4\nY2VwdGlvbkhhbmRsZXIobmV3IFRocmVhZC5VbmNhdWdodEV4Y2VwdGlvbkhh\nbmRsZXIoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCB1bmNhdWdodEV4Y2VwdGlvbihUaHJlYWQgdGhyZWFkLCBU\naHJvd2FibGUgdGhyb3dhYmxlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIlVuY2F1Z2h0IGV4Y2VwdGlvbiBpbiB0aHJlYWQge30gOiAiLCB0aHJl\nYWQuZ2V0TmFtZSgpLCB0aHJvd2FibGUpOwogICAgICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChtYWluU3luY09iaikgewogICAgICAgICAgICAgICAgICAg\nIG1haW5TeW5jT2JqLmZhaWxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICByZXR1cm4gdDsK\nICAgIH0KCiAgICAvKioKICAgICAqIExlZGdlciBMIGlzIGhhbmRsZWQgdGhy\nZWFkcyBbTCwgVCsoVC9MKSwgVCsyKihUL0wpIC4uLiBdCiAgICAgKiBSZWFk\ncyBhcmUgc2ltdWx0YW5lb3VzLCB3cml0ZXMgYXJlIHNlcXVlbnRpYWwuCiAg\nICAgKiBAdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24KICAgICAqLwogICAg\ncHVibGljIHZvaWQgbXVsdGlMZWRnZXJNdWx0aVRocmVhZFJlYWQoZmluYWwg\naW50IG51bUxlZGdlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmaW5hbCBpbnQgbnVtVGhyZWFkcykgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBhc3NlcnRUcnVlKG51bUxlZGdlcnMgIT0g\nMCAmJiBudW1UaHJlYWRzID49IG51bUxlZGdlcnMgJiYgbnVtVGhyZWFkcyAl\nIG51bUxlZGdlcnMgPT0gMCk7CgogICAgICAgIC8vIFdlIGNyZWF0ZSBudW1U\naHJlYWQvbnVtTGVkZ2VyIGNsaWVudHMgc28gdGhhdCBlYWNoIGNsaWVudCBj\nYW4gYmUgdXNlZCB0byBvcGVuIGEgaGFuZGxlLgogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGZpbmFsIExpc3Q8TGVkZ2VySGFuZGxlPiBvbGRMZWRnZXJI\nYW5kbGVzID0gbmV3IEFycmF5TGlzdDxMZWRnZXJIYW5kbGU+KCk7CiAgICAg\nICAgICAgIGZpbmFsIExpc3Q8TG9uZz4gbGVkZ2VySWRzID0gbmV3IEFycmF5\nTGlzdDxMb25nPigpOwogICAgICAgICAgICBMaXN0PFRocmVhZD4gdGhyZWFk\nTGlzdCA9IG5ldyBBcnJheUxpc3Q8VGhyZWFkPigpOwogICAgICAgICAgICBM\naXN0PEF0b21pY0Jvb2xlYW4+IHdyaXRlUmVzdWx0cyA9IG5ldyBBcnJheUxp\nc3Q8QXRvbWljQm9vbGVhbj4oKTsKICAgICAgICAgICAgLy8gU3RhcnQgd3Jp\ndGUgdGhyZWFkcy4KICAgICAgICAgICAgLy8gT25seSBvbmUgdGhyZWFkIHdy\naXRlcyB0byBhIGxlZGdlciwgc28ganVzdCB1c2UgbnVtTGVkZ2VycyBpbnN0\nZWFkLgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUxlZGdl\ncnM7IGkrKykgewogICAgICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0g\nYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7\nCiAgICAgICAgICAgICAgICBvbGRMZWRnZXJIYW5kbGVzLmFkZChsaCk7CiAg\nICAgICAgICAgICAgICBsZWRnZXJJZHMuYWRkKGxoLmdldElkKCkpOwogICAg\nICAgICAgICAgICAgQXRvbWljQm9vbGVhbiB3cml0ZVJlc3VsdCA9IG5ldyBB\ndG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICAgICAgICAgIHdyaXRlUmVz\ndWx0cy5hZGQod3JpdGVSZXN1bHQpOwogICAgICAgICAgICAgICAgVGhyZWFk\nIHQ7CiAgICAgICAgICAgICAgICB0aHJlYWRMaXN0LmFkZCh0ID0gZ2V0V3Jp\ndGVyVGhyZWFkKGksIG9sZExlZGdlckhhbmRsZXMuZ2V0KGkpLCB3cml0ZVJl\nc3VsdCkpOwogICAgICAgICAgICAgICAgdC5zdGFydCgpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIC8vIFdhaXQgZm9yIHRoZSB0aHJlYWRzIHRvIGNv\nbXBsZXRlCiAgICAgICAgICAgIGZvciAoVGhyZWFkIHQgOiB0aHJlYWRMaXN0\nKSB7CiAgICAgICAgICAgICAgICB0LmpvaW4oKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBzeW5jaHJvbml6ZWQgKG1haW5TeW5jT2JqKSB7CiAgICAg\nICAgICAgICAgICBpZiAobWFpblN5bmNPYmouZmFpbGVkKSB7CiAgICAgICAg\nICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgYmVjYXVzZSB3ZSBlbmNv\ndW50ZXJlZCB1bmNhdWdodCBleGNlcHRpb24gb24gYWRkaW5nIGVudHJpZXMu\nIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1MZWRnZXJzOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGFzc2VydFRydWUoIkZhaWxlZCBvbiBhZGRpbmcgZW50\ncmllcyBmb3IgbGVkZ2VyICIgKyBvbGRMZWRnZXJIYW5kbGVzLmdldChpKS5n\nZXRJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZVJlc3Vs\ndHMuZ2V0KGkpLmdldCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAv\nLyBDbG9zZSB0aGUgbGVkZ2VyIGhhbmRsZXMuCiAgICAgICAgICAgIGZvciAo\nTGVkZ2VySGFuZGxlIGxoIDogb2xkTGVkZ2VySGFuZGxlcykgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBsaC5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktMZWRn\nZXJDbG9zZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBmYWlsKCJF\ncnJvciB3aGlsZSBjbG9zaW5nIGhhbmRsZS4iKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBOb3cgdHJ5IHRvIHJl\nYWQuCiAgICAgICAgICAgIG1haW5TeW5jT2JqLmZhaWxlZCA9IGZhbHNlOwog\nICAgICAgICAgICB0aHJlYWRMaXN0LmNsZWFyKCk7CgogICAgICAgICAgICBM\naXN0PEF0b21pY0Jvb2xlYW4+IHJlYWRSZXN1bHRzID0gbmV3IEFycmF5TGlz\ndDxBdG9taWNCb29sZWFuPigpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG51bVRocmVhZHM7IGkrKykgewogICAgICAgICAgICAgICAgQXRv\nbWljQm9vbGVhbiByZWFkUmVzdWx0ID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFs\nc2UpOwogICAgICAgICAgICAgICAgVGhyZWFkIHQ7CiAgICAgICAgICAgICAg\nICB0aHJlYWRMaXN0LmFkZCh0ID0gZ2V0UmVhZGVyVGhyZWFkKGksIHJlYWRC\na2Mub3BlbkxlZGdlcihsZWRnZXJJZHMuZ2V0KGkgJSBudW1MZWRnZXJzKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgZGlnZXN0VHlwZSwgbGVkZ2VyUGFz\nc3dvcmQpLCBpICUgbnVtTGVkZ2VycywgcmVhZFJlc3VsdCkpOwogICAgICAg\nICAgICAgICAgcmVhZFJlc3VsdHMuYWRkKHJlYWRSZXN1bHQpOwogICAgICAg\nICAgICAgICAgdC5zdGFydCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIC8vIFdhaXQgZm9yIHRoZSB0aHJlYWRzIHRvIGNvbXBsZXRlLgogICAgICAg\nICAgICBmb3IgKFRocmVhZCB0IDogdGhyZWFkTGlzdCkgewogICAgICAgICAg\nICAgICAgdC5qb2luKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChtYWluU3luY09iaikgewogICAgICAgICAgICAgICAgaWYg\nKG1haW5TeW5jT2JqLmZhaWxlZCkgewogICAgICAgICAgICAgICAgICAgIGZh\naWwoIlRlc3QgZmFpbGVkIGJlY2F1c2Ugd2UgZW5jb3VudGVyZWQgdW5jYXVn\naHQgZXhjZXB0aW9uIG9uIHJlYWRpbmcgZW50cmllcyIpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoQXRvbWlj\nQm9vbGVhbiByZWFkUmVzdWx0IDogcmVhZFJlc3VsdHMpIHsKICAgICAgICAg\nICAgICAgIGFzc2VydFRydWUoIkZhaWxlZCBvbiByZWFkIGVudHJpZXMiLCBy\nZWFkUmVzdWx0LmdldCgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0\nY2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJU\nZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxl\nZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgi\nVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0K\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0MTBMZWRnZXJzMjBUaHJlYWRzUmVhZCgpIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgbXVsdGlMZWRnZXJNdWx0aVRocmVhZFJlYWQo\nMTAsIDIwKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0MTBMZWRnZXJzMjAwVGhyZWFkc1JlYWQoKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIG11bHRpTGVkZ2VyTXVsdGlU\naHJlYWRSZWFkKDEwLCAyMDApOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQg\nPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3QxTGVkZ2VyMjBUaHJlYWRz\nUmVhZCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbXVsdGlMZWRn\nZXJNdWx0aVRocmVhZFJlYWQoMSwgMjApOwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICByZWFkQmtjLmNsb3NlKCk7CiAgICAgICAgc3VwZXIudGVh\nckRvd24oKTsKICAgIH0KfQo=\n","encoding":"base64"}

