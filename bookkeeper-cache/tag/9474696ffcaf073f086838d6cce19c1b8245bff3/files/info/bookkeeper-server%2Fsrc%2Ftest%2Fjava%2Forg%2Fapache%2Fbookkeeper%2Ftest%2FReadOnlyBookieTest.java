{"sha":"8ccd07d851b0af5293ffb6a68827da586927aa81","node_id":"MDQ6QmxvYjE1NzU5NTY6OGNjZDA3ZDg1MWIwYWY1MjkzZmZiNmE2ODgyN2RhNTg2OTI3YWE4MQ==","size":11475,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8ccd07d851b0af5293ffb6a68827da586927aa81","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tp\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuTGVkZ2Vy\nRGlyc01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckVudHJ5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7CgppbXBvcnQgc3RhdGljIG9y\nZy5qdW5pdC5Bc3NlcnQuKjsKCi8qKgogKiBUZXN0IHRvIHZlcmlmeSB0aGUg\ncmVhZG9ubHkgZmVhdHVyZSBvZiBib29raWVzCiAqLwpwdWJsaWMgY2xhc3Mg\nUmVhZE9ubHlCb29raWVUZXN0IGV4dGVuZHMgQm9va0tlZXBlckNsdXN0ZXJU\nZXN0Q2FzZSB7CgogICAgcHVibGljIFJlYWRPbmx5Qm9va2llVGVzdCgpIHsK\nICAgICAgICBzdXBlcigyKTsKICAgICAgICBiYXNlQ29uZi5zZXRTb3J0ZWRM\nZWRnZXJTdG9yYWdlRW5hYmxlZChmYWxzZSk7CiAgICAgICAgYmFzZUNvbmYu\nc2V0RW50cnlMb2dGaWxlUHJlQWxsb2NhdGlvbkVuYWJsZWQoZmFsc2UpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgcmVhZG9ubHkgYm9va2llCiAg\nICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RCb29raWVTaG91bGRTZXJ2ZUFzUmVhZE9ubHkoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBraWxsQm9va2llKDApOwogICAgICAgIGJh\nc2VDb25mLnNldFJlYWRPbmx5TW9kZUVuYWJsZWQodHJ1ZSk7CiAgICAgICAg\nc3RhcnROZXdCb29raWUoKTsKICAgICAgICBMZWRnZXJIYW5kbGUgbGVkZ2Vy\nID0gYmtjLmNyZWF0ZUxlZGdlcigyLCAyLCBEaWdlc3RUeXBlLk1BQywKICAg\nICAgICAgICAgICAgICIiLmdldEJ5dGVzKCkpOwoKICAgICAgICAvLyBDaGVj\nayBuZXcgYm9va2llIHdpdGggcmVhZG9ubHkgbW9kZSBlbmFibGVkLgogICAg\nICAgIEZpbGVbXSBsZWRnZXJEaXJzID0gYnNDb25mcy5nZXQoMSkuZ2V0TGVk\nZ2VyRGlycygpOwogICAgICAgIGFzc2VydEVxdWFscygiT25seSBvbmUgbGVk\nZ2VyIGRpciBzaG91bGQgYmUgcHJlc2VudCIsIDEsCiAgICAgICAgICAgICAg\nICBsZWRnZXJEaXJzLmxlbmd0aCk7CiAgICAgICAgQm9va2llIGJvb2tpZSA9\nIGJzLmdldCgxKS5nZXRCb29raWUoKTsKICAgICAgICBMZWRnZXJEaXJzTWFu\nYWdlciBsZWRnZXJEaXJzTWFuYWdlciA9IGJvb2tpZS5nZXRMZWRnZXJEaXJz\nTWFuYWdlcigpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBp\nKyspIHsKICAgICAgICAgICAgbGVkZ2VyLmFkZEVudHJ5KCJkYXRhIi5nZXRC\neXRlcygpKTsKICAgICAgICB9CgogICAgICAgIC8vIE5vdyBhZGQgdGhlIGN1\ncnJlbnQgbGVkZ2VyIGRpciB0byBmaWxsZWQgZGlycyBsaXN0CiAgICAgICAg\nbGVkZ2VyRGlyc01hbmFnZXIuYWRkVG9GaWxsZWREaXJzKG5ldyBGaWxlKGxl\nZGdlckRpcnNbMF0sICJjdXJyZW50IikpOwoKICAgICAgICB0cnkgewogICAg\nICAgICAgICBsZWRnZXIuYWRkRW50cnkoImRhdGEiLmdldEJ5dGVzKCkpOwog\nICAgICAgICAgICBmYWlsKCJTaG91bGQgZmFpbCB0byBhZGQgZW50cnkgc2lu\nY2UgdGhlcmUgaXNuJ3QgZW5vdWdoIGJvb2tpZXMgYWxpdmUuIik7CiAgICAg\nICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktOb3RFbm91Z2hCb29raWVzRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gRXhwZWN0ZWQKICAgICAgICB9\nCgogICAgICAgIGFzc2VydFRydWUoIkJvb2tpZSBzaG91bGQgYmUgcnVubmlu\nZyBhbmQgY29udmVydGVkIHRvIHJlYWRvbmx5IG1vZGUiLAogICAgICAgICAg\nICAgICAgYm9va2llLmlzUnVubmluZygpICYmIGJvb2tpZS5pc1JlYWRPbmx5\nKCkpOwoKICAgICAgICAvLyBOb3cga2lsbCB0aGUgb3RoZXIgYm9va2llIGFu\nZCByZWFkIGVudHJpZXMgZnJvbSB0aGUgcmVhZG9ubHkgYm9va2llCiAgICAg\nICAga2lsbEJvb2tpZSgwKTsKCiAgICAgICAgRW51bWVyYXRpb248TGVkZ2Vy\nRW50cnk+IHJlYWRFbnRyaWVzID0gbGVkZ2VyLnJlYWRFbnRyaWVzKDAsIDkp\nOwogICAgICAgIHdoaWxlIChyZWFkRW50cmllcy5oYXNNb3JlRWxlbWVudHMo\nKSkgewogICAgICAgICAgICBMZWRnZXJFbnRyeSBlbnRyeSA9IHJlYWRFbnRy\naWVzLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygi\nRW50cnkgc2hvdWxkIGNvbnRhaW4gY29ycmVjdCBkYXRhIiwgImRhdGEiLAog\nICAgICAgICAgICAgICAgICAgIG5ldyBTdHJpbmcoZW50cnkuZ2V0RW50cnko\nKSkpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0Qm9va2llU2hvdWxkVHVybldyaXRh\nYmxlRnJvbVJlYWRPbmx5KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\na2lsbEJvb2tpZSgwKTsKICAgICAgICBiYXNlQ29uZi5zZXRSZWFkT25seU1v\nZGVFbmFibGVkKHRydWUpOwogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAg\nICAgICAgTGVkZ2VySGFuZGxlIGxlZGdlciA9IGJrYy5jcmVhdGVMZWRnZXIo\nMiwgMiwgRGlnZXN0VHlwZS5NQUMsCiAgICAgICAgICAgICAgICAiIi5nZXRC\neXRlcygpKTsKCiAgICAgICAgLy8gQ2hlY2sgbmV3IGJvb2tpZSB3aXRoIHJl\nYWRvbmx5IG1vZGUgZW5hYmxlZC4KICAgICAgICBGaWxlW10gbGVkZ2VyRGly\ncyA9IGJzQ29uZnMuZ2V0KDEpLmdldExlZGdlckRpcnMoKTsKICAgICAgICBh\nc3NlcnRFcXVhbHMoIk9ubHkgb25lIGxlZGdlciBkaXIgc2hvdWxkIGJlIHBy\nZXNlbnQiLCAxLAogICAgICAgICAgICAgICAgbGVkZ2VyRGlycy5sZW5ndGgp\nOwogICAgICAgIEJvb2tpZSBib29raWUgPSBicy5nZXQoMSkuZ2V0Qm9va2ll\nKCk7CiAgICAgICAgTGVkZ2VyRGlyc01hbmFnZXIgbGVkZ2VyRGlyc01hbmFn\nZXIgPSBib29raWUuZ2V0TGVkZ2VyRGlyc01hbmFnZXIoKTsKCiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxl\nZGdlci5hZGRFbnRyeSgiZGF0YSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoK\nICAgICAgICBGaWxlIHRlc3REaXIgPSBuZXcgRmlsZShsZWRnZXJEaXJzWzBd\nLCAiY3VycmVudCIpOwoKICAgICAgICAvLyBOb3cgYWRkIHRoZSBjdXJyZW50\nIGxlZGdlciBkaXIgdG8gZmlsbGVkIGRpcnMgbGlzdAogICAgICAgIGxlZGdl\nckRpcnNNYW5hZ2VyLmFkZFRvRmlsbGVkRGlycyh0ZXN0RGlyKTsKCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgbGVkZ2VyLmFkZEVudHJ5KCJkYXRhIi5n\nZXRCeXRlcygpKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGZhaWwgdG8g\nYWRkIGVudHJ5IHNpbmNlIHRoZXJlIGlzbid0IGVub3VnaCBib29raWVzIGFs\naXZlLiIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTm90RW5v\ndWdoQm9va2llc0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIEV4cGVj\ndGVkCiAgICAgICAgfQogICAgICAgIExPRy5pbmZvKCJib29raWUgaXMgcnVu\nbmluZyB7fSwgcmVhZG9ubHkge30uIiwgYm9va2llLmlzUnVubmluZygpLCBi\nb29raWUuaXNSZWFkT25seSgpKTsKICAgICAgICBhc3NlcnRUcnVlKCJCb29r\naWUgc2hvdWxkIGJlIHJ1bm5pbmcgYW5kIGNvbnZlcnRlZCB0byByZWFkb25s\neSBtb2RlIiwKICAgICAgICAgICAgICAgIGJvb2tpZS5pc1J1bm5pbmcoKSAm\nJiBib29raWUuaXNSZWFkT25seSgpKTsKCiAgICAgICAgLy8gcmVmcmVzaCB0\naGUgYm9va2tlZXBlciBjbGllbnQKICAgICAgICBia2MucmVhZEJvb2tpZXNC\nbG9ja2luZygpOwogICAgICAgIC8vIHNob3VsZCBmYWlsIHRvIGNyZWF0ZSBs\nZWRnZXIKICAgICAgICB0cnkgewogICAgICAgICAgICBia2MuY3JlYXRlTGVk\nZ2VyKDIsIDIsIERpZ2VzdFR5cGUuTUFDLCAiIi5nZXRCeXRlcygpKTsKICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkIGZhaWwgdG8gY3JlYXRlIGEgbGVkZ2Vy\nIHNpbmNlIHRoZXJlIGlzbid0IGVub3VnaCBib29raWVzIGFsaXZlLiIpOwog\nICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9va2ll\nc0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAgLy8gRXhwZWN0ZWQuCiAg\nICAgICAgfQoKICAgICAgICAvLyBOb3cgYWRkIHRoZSBjdXJyZW50IGxlZGdl\nciBkaXIgYmFjayB0byB3cml0YWJsZSBkaXJzIGxpc3QKICAgICAgICBsZWRn\nZXJEaXJzTWFuYWdlci5hZGRUb1dyaXRhYmxlRGlycyh0ZXN0RGlyLCB0cnVl\nKTsKCiAgICAgICAgTE9HLmluZm8oImJvb2tpZSBpcyBydW5uaW5nIHt9LCBy\nZWFkb25seSB7fS4iLCBib29raWUuaXNSdW5uaW5nKCksIGJvb2tpZS5pc1Jl\nYWRPbmx5KCkpOwogICAgICAgIGFzc2VydFRydWUoIkJvb2tpZSBzaG91bGQg\nYmUgcnVubmluZyBhbmQgY29udmVydGVkIGJhY2sgdG8gd3JpdGFibGUgbW9k\nZSIsIGJvb2tpZS5pc1J1bm5pbmcoKQogICAgICAgICAgICAgICAgJiYgIWJv\nb2tpZS5pc1JlYWRPbmx5KCkpOwogICAgICAgIC8vIGZvcmNlIGNsaWVudCB0\nbyByZWFkIGJvb2tpZXMKICAgICAgICBia2MucmVhZEJvb2tpZXNCbG9ja2lu\nZygpOwogICAgICAgIExlZGdlckhhbmRsZSBuZXdMZWRnZXIgPSBia2MuY3Jl\nYXRlTGVkZ2VyKDIsIDIsIERpZ2VzdFR5cGUuTUFDLCAiIi5nZXRCeXRlcygp\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAg\nICAgICAgICAgbmV3TGVkZ2VyLmFkZEVudHJ5KCJkYXRhIi5nZXRCeXRlcygp\nKTsKICAgICAgICB9CiAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+\nIHJlYWRFbnRyaWVzID0gbmV3TGVkZ2VyLnJlYWRFbnRyaWVzKDAsIDkpOwog\nICAgICAgIHdoaWxlIChyZWFkRW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSkg\newogICAgICAgICAgICBMZWRnZXJFbnRyeSBlbnRyeSA9IHJlYWRFbnRyaWVz\nLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygiRW50\ncnkgc2hvdWxkIGNvbnRhaW4gY29ycmVjdCBkYXRhIiwgImRhdGEiLCBuZXcg\nU3RyaW5nKGVudHJ5LmdldEVudHJ5KCkpKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBjaGVjayByZWFkT25seU1vZGVFbmFibGVkPWZhbHNl\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RCb29raWVTaHV0ZG93bklmUmVhZE9ubHlNb2RlTm90RW5h\nYmxlZCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGVbXSBsZWRn\nZXJEaXJzID0gYnNDb25mcy5nZXQoMSkuZ2V0TGVkZ2VyRGlycygpOwogICAg\nICAgIGFzc2VydEVxdWFscygiT25seSBvbmUgbGVkZ2VyIGRpciBzaG91bGQg\nYmUgcHJlc2VudCIsIDEsCiAgICAgICAgICAgICAgICBsZWRnZXJEaXJzLmxl\nbmd0aCk7CiAgICAgICAgQm9va2llIGJvb2tpZSA9IGJzLmdldCgxKS5nZXRC\nb29raWUoKTsKICAgICAgICBMZWRnZXJIYW5kbGUgbGVkZ2VyID0gYmtjLmNy\nZWF0ZUxlZGdlcigyLCAyLCBEaWdlc3RUeXBlLk1BQywKICAgICAgICAgICAg\nICAgICIiLmdldEJ5dGVzKCkpOwogICAgICAgIExlZGdlckRpcnNNYW5hZ2Vy\nIGxlZGdlckRpcnNNYW5hZ2VyID0gYm9va2llLmdldExlZGdlckRpcnNNYW5h\nZ2VyKCk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykg\newogICAgICAgICAgICBsZWRnZXIuYWRkRW50cnkoImRhdGEiLmdldEJ5dGVz\nKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gTm93IGFkZCB0aGUgY3VycmVu\ndCBsZWRnZXIgZGlyIHRvIGZpbGxlZCBkaXJzIGxpc3QKICAgICAgICBsZWRn\nZXJEaXJzTWFuYWdlci5hZGRUb0ZpbGxlZERpcnMobmV3IEZpbGUobGVkZ2Vy\nRGlyc1swXSwgImN1cnJlbnQiKSk7CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGxlZGdlci5hZGRFbnRyeSgiZGF0YSIuZ2V0Qnl0ZXMoKSk7CiAgICAg\nICAgICAgIGZhaWwoIlNob3VsZCBmYWlsIHRvIGFkZCBlbnRyeSBzaW5jZSB0\naGVyZSBpc24ndCBlbm91Z2ggYm9va2llcyBhbGl2ZS4iKTsKICAgICAgICB9\nIGNhdGNoIChCS0V4Y2VwdGlvbi5CS05vdEVub3VnaEJvb2tpZXNFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAvLyBFeHBlY3RlZAogICAgICAgIH0KCiAg\nICAgICAgLy8gd2FpdCBmb3IgdXAgdG8gMTAgc2Vjb25kcyBmb3IgYm9va2ll\nIHRvIHNodXQgZG93bgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAg\nJiYgYm9va2llLmlzQWxpdmUoKTsgaSsrKSB7CiAgICAgICAgICAgIFRocmVh\nZC5zbGVlcCgxMDAwKTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0RmFsc2Uo\nIkJvb2tpZSBzaG91bGQgc2h1dGRvd24gaWYgcmVhZE9ubHlNb2RlIG5vdCBl\nbmFibGVkIiwKICAgICAgICAgICAgICAgIGJvb2tpZS5pc0FsaXZlKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogQ2hlY2sgbXVsdGlwbGUgbGVkZ2VyIGRp\ncnMKICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdEJvb2tpZUNvbnRpbnVlV3JpdGluZ0lmTXVsdGlwbGVM\nZWRnZXJzUHJlc2VudCgpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIHN0YXJ0TmV3Qm9va2llV2l0aE11bHRpcGxlTGVkZ2VyRGly\ncygyKTsKCiAgICAgICAgRmlsZVtdIGxlZGdlckRpcnMgPSBic0NvbmZzLmdl\ndCgxKS5nZXRMZWRnZXJEaXJzKCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJP\nbmx5IG9uZSBsZWRnZXIgZGlyIHNob3VsZCBiZSBwcmVzZW50IiwgMiwKICAg\nICAgICAgICAgICAgIGxlZGdlckRpcnMubGVuZ3RoKTsKICAgICAgICBCb29r\naWUgYm9va2llID0gYnMuZ2V0KDEpLmdldEJvb2tpZSgpOwogICAgICAgIExl\nZGdlckhhbmRsZSBsZWRnZXIgPSBia2MuY3JlYXRlTGVkZ2VyKDIsIDIsIERp\nZ2VzdFR5cGUuTUFDLAogICAgICAgICAgICAgICAgIiIuZ2V0Qnl0ZXMoKSk7\nCiAgICAgICAgTGVkZ2VyRGlyc01hbmFnZXIgbGVkZ2VyRGlyc01hbmFnZXIg\nPSBib29raWUuZ2V0TGVkZ2VyRGlyc01hbmFnZXIoKTsKCiAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGxlZGdl\nci5hZGRFbnRyeSgiZGF0YSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAg\nICAgICAvLyBOb3cgYWRkIHRoZSBjdXJyZW50IGxlZGdlciBkaXIgdG8gZmls\nbGVkIGRpcnMgbGlzdAogICAgICAgIGxlZGdlckRpcnNNYW5hZ2VyLmFkZFRv\nRmlsbGVkRGlycyhuZXcgRmlsZShsZWRnZXJEaXJzWzBdLCAiY3VycmVudCIp\nKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwOyBpKyspIHsKICAg\nICAgICAgICAgbGVkZ2VyLmFkZEVudHJ5KCJkYXRhIi5nZXRCeXRlcygpKTsK\nICAgICAgICB9CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJ3cml0YWJsZSBkaXJz\nIHNob3VsZCBoYXZlIG9uZSBkaXIiLCAxLCBsZWRnZXJEaXJzTWFuYWdlcgog\nICAgICAgICAgICAgICAgLmdldFdyaXRhYmxlTGVkZ2VyRGlycygpLnNpemUo\nKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiQm9va2llIHNob3VsZCBzaHV0ZG93\nbiBpZiByZWFkT25seU1vZGUgbm90IGVuYWJsZWQiLAogICAgICAgICAgICAg\nICAgYm9va2llLmlzQWxpdmUoKSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIHN0YXJ0TmV3Qm9va2llV2l0aE11bHRpcGxlTGVkZ2VyRGlycyhpbnQgbnVt\nT2ZMZWRnZXJEaXJzKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBic0NvbmZzLmdl\ndCgxKTsKICAgICAgICBraWxsQm9va2llKDEpOwoKICAgICAgICBGaWxlW10g\nbGVkZ2VyRGlycyA9IG5ldyBGaWxlW251bU9mTGVkZ2VyRGlyc107CiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1PZkxlZGdlckRpcnM7IGkrKykg\newogICAgICAgICAgICBGaWxlIGRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUo\nImJvb2tpZSIsICJ0ZXN0Iik7CiAgICAgICAgICAgIHRtcERpcnMuYWRkKGRp\ncik7CiAgICAgICAgICAgIGRpci5kZWxldGUoKTsKICAgICAgICAgICAgZGly\nLm1rZGlyKCk7CiAgICAgICAgICAgIGxlZGdlckRpcnNbaV0gPSBkaXI7CiAg\nICAgICAgfQoKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIG5ld0NvbmYg\nPSBuZXdTZXJ2ZXJDb25maWd1cmF0aW9uKAogICAgICAgICAgICAgICAgY29u\nZi5nZXRCb29raWVQb3J0KCkgKyAxLCB6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpLAogICAgICAgICAgICAgICAgbGVkZ2VyRGlyc1swXSwg\nbGVkZ2VyRGlycyk7CiAgICAgICAgYnNDb25mcy5hZGQobmV3Q29uZik7CiAg\nICAgICAgYnMuYWRkKHN0YXJ0Qm9va2llKG5ld0NvbmYpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgbGVkZ2VyIGNyZWF0aW9uIHdpdGggcmVhZG9u\nbHkgYm9va2llcwogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0TGVkZ2VyQ3JlYXRpb25TaG91bGRGYWls\nV2l0aFJlYWRvbmx5Qm9va2llKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAga2lsbEJvb2tpZSgxKTsKICAgICAgICBiYXNlQ29uZi5zZXRSZWFkT25s\neU1vZGVFbmFibGVkKHRydWUpOwogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7\nCiAgICAgICAgYnMuZ2V0KDEpLmdldEJvb2tpZSgpLnRyYW5zaXRpb25Ub1Jl\nYWRPbmx5TW9kZSgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJrYy5y\nZWFkQm9va2llc0Jsb2NraW5nKCk7CiAgICAgICAgICAgIGJrYy5jcmVhdGVM\nZWRnZXIoMiwgMiwgRGlnZXN0VHlwZS5DUkMzMiwgIiIuZ2V0Qnl0ZXMoKSk7\nCiAgICAgICAgICAgIGZhaWwoIk11c3QgdGhyb3cgZXhjZXB0aW9uLCBhcyB0\naGVyZSBpcyBvbmUgcmVhZG9ubHkgYm9va2llIik7CiAgICAgICAgfSBjYXRj\naCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBFeHBlY3RlZAog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRyeSB0byByZWFkIGNs\nb3NlZCBsZWRnZXIgZnJvbSByZXN0YXJ0ZWQgUmVhZE9ubHlCb29raWUuCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkRnJvbVJlYWRPbmx5Qm9v\na2llU2hvdWxkQmVTdWNjZXNzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgTGVkZ2VySGFuZGxlIGxlZGdlciA9IGJrYy5jcmVhdGVMZWRnZXIoMiwg\nMiwgRGlnZXN0VHlwZS5NQUMsICIiLmdldEJ5dGVzKCkpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICBsZWRn\nZXIuYWRkRW50cnkoImRhdGEiLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAg\nICAgICBsZWRnZXIuY2xvc2UoKTsKICAgICAgICBic0NvbmZzLmdldCgxKS5z\nZXRSZWFkT25seU1vZGVFbmFibGVkKHRydWUpOwogICAgICAgIGJzQ29uZnMu\nZ2V0KDEpLnNldERpc2tDaGVja0ludGVydmFsKDUwMCk7CiAgICAgICAgcmVz\ndGFydEJvb2tpZXMoKTsKCiAgICAgICAgLy8gQ2hlY2sgbmV3IGJvb2tpZSB3\naXRoIHJlYWRvbmx5IG1vZGUgZW5hYmxlZC4KICAgICAgICBGaWxlW10gbGVk\nZ2VyRGlycyA9IGJzQ29uZnMuZ2V0KDEpLmdldExlZGdlckRpcnMoKTsKICAg\nICAgICBhc3NlcnRFcXVhbHMoIk9ubHkgb25lIGxlZGdlciBkaXIgc2hvdWxk\nIGJlIHByZXNlbnQiLCAxLCBsZWRnZXJEaXJzLmxlbmd0aCk7CiAgICAgICAg\nQm9va2llIGJvb2tpZSA9IGJzLmdldCgxKS5nZXRCb29raWUoKTsKICAgICAg\nICBMZWRnZXJEaXJzTWFuYWdlciBsZWRnZXJEaXJzTWFuYWdlciA9IGJvb2tp\nZS5nZXRMZWRnZXJEaXJzTWFuYWdlcigpOwoKICAgICAgICAvLyBOb3cgYWRk\nIHRoZSBjdXJyZW50IGxlZGdlciBkaXIgdG8gZmlsbGVkIGRpcnMgbGlzdAog\nICAgICAgIGxlZGdlckRpcnNNYW5hZ2VyLmFkZFRvRmlsbGVkRGlycyhuZXcg\nRmlsZShsZWRnZXJEaXJzWzBdLCAiY3VycmVudCIpKTsKCiAgICAgICAgLy8g\nV2FpdCB0aWxsIEJvb2tpZSBjb252ZXJ0cyB0byBSZWFkT25seSBtb2RlLgog\nICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAgICBhc3NlcnRUcnVl\nKCJCb29raWUgc2hvdWxkIGJlIGNvbnZlcnRlZCB0byByZWFkb25seSBtb2Rl\nIiwgYm9va2llLmlzUnVubmluZygpICYmIGJvb2tpZS5pc1JlYWRPbmx5KCkp\nOwoKICAgICAgICAvLyBOb3cga2lsbCB0aGUgb3RoZXIgYm9va2llIGFuZCBy\nZWFkIGVudHJpZXMgZnJvbSB0aGUgcmVhZG9ubHkgYm9va2llCiAgICAgICAg\na2lsbEJvb2tpZSgwKTsKCiAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50\ncnk+IHJlYWRFbnRyaWVzID0gbGVkZ2VyLnJlYWRFbnRyaWVzKDAsIDkpOwog\nICAgICAgIHdoaWxlIChyZWFkRW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSkg\newogICAgICAgICAgICBMZWRnZXJFbnRyeSBlbnRyeSA9IHJlYWRFbnRyaWVz\nLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygiRW50\ncnkgc2hvdWxkIGNvbnRhaW4gY29ycmVjdCBkYXRhIiwgImRhdGEiLCBuZXcg\nU3RyaW5nKGVudHJ5LmdldEVudHJ5KCkpKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

