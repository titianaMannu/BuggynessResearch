{"sha":"89939b414736f201ed1f6659a6ccb982f0d00d7a","node_id":"MDQ6QmxvYjE1NzU5NTY6ODk5MzliNDE0NzM2ZjIwMWVkMWY2NjU5YTZjY2I5ODJmMGQwMGQ3YQ==","size":29388,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/89939b414736f201ed1f6659a6ccb982f0d00d7a","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0LmFzc2VydEVxdWFsczsKaW1w\nb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0LmFzc2VydFRydWU7CmltcG9y\ndCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5mYWlsOwoKaW1wb3J0IGphdmEu\naW8uRmlsZTsKaW1wb3J0IGphdmEubmV0LkluZXRBZGRyZXNzOwppbXBvcnQg\namF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tp\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2ll\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tp\nZS5GaWxlU3lzdGVtVXBncmFkZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuQm9va0tlZXBlckFkbWluOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlRlc3RCS0NvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuanVuaXQuQWZ0ZXI7CmltcG9ydCBvcmcuanVuaXQu\nQmVmb3JlOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7Cgpw\ndWJsaWMgY2xhc3MgVGVzdEJhY2t3YXJkQ29tcGF0IHsKICAgIHByaXZhdGUg\nZmluYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihUZXN0QmFja3dhcmRDb21wYXQuY2xhc3MpOwoKICAgIHByaXZhdGUg\nc3RhdGljIFpvb0tlZXBlclV0aWwgemtVdGlsID0gbmV3IFpvb0tlZXBlclV0\naWwoKTs7CiAgICBwcml2YXRlIHN0YXRpYyBieXRlW10gRU5UUllfREFUQSA9\nICJUaGlzSXNBbkVudHJ5Ii5nZXRCeXRlcygpOwoKICAgIHN0YXRpYyB2b2lk\nIHdhaXRVcChpbnQgcG9ydCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nd2hpbGUoemtVdGlsLmdldFpvb0tlZXBlckNsaWVudCgpLmV4aXN0cygKICAg\nICAgICAgICAgICAgICAgICAgICIvbGVkZ2Vycy9hdmFpbGFibGUvIiArIElu\nZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCkgKyAi\nOiIgKyBwb3J0LAogICAgICAgICAgICAgICAgICAgICAgZmFsc2UpID09IG51\nbGwpIHsKICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDUwMCk7CiAgICAgICAg\nfQogICAgfQogICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc3RhcnRab29L\nZWVwZXJTZXJ2ZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB6a1V0\naWwuc3RhcnRTZXJ2ZXIoKTsKICAgIH0KCiAgICBAQWZ0ZXIKICAgIHB1Ymxp\nYyB2b2lkIHN0b3Bab29LZWVwZXJTZXJ2ZXIoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICB6a1V0aWwua2lsbFNlcnZlcigpOwogICAgfQoKICAgIC8q\nKgogICAgICogVmVyc2lvbiA0LjAuMCBjbGFzc2VzCiAgICAgKi8KICAgIHN0\nYXRpYyBjbGFzcyBTZXJ2ZXI0MDAgewogICAgICAgIG9yZy5hcGFjaGUuYmtf\ndjRfMF8wLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uIGNv\nbmY7CiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9va2tlZXBlci5w\ncm90by5Cb29raWVTZXJ2ZXIgc2VydmVyID0gbnVsbDsKCiAgICAgICAgU2Vy\ndmVyNDAwKEZpbGUgam91cm5hbERpciwgRmlsZSBsZWRnZXJEaXIsIGludCBw\nb3J0KSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgY29uZiA9IG5l\ndyBvcmcuYXBhY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVy\nQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBjb25mLnNldEJvb2tpZVBv\ncnQocG9ydCk7CiAgICAgICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKHprVXRp\nbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAgICAgICBj\nb25mLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKTsK\nICAgICAgICAgICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5n\nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwogICAgICAgIH0KCiAgICAg\nICAgdm9pZCBzdGFydCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAg\nICBzZXJ2ZXIgPSBuZXcgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9va2tlZXBl\nci5wcm90by5Cb29raWVTZXJ2ZXIoY29uZik7CiAgICAgICAgICAgIHNlcnZl\nci5zdGFydCgpOwogICAgICAgICAgICB3YWl0VXAoY29uZi5nZXRCb29raWVQ\nb3J0KCkpOwogICAgICAgIH0KCiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8w\nXzAuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24gZ2V0Q29u\nZigpIHsKICAgICAgICAgICAgcmV0dXJuIGNvbmY7CiAgICAgICAgfQoKICAg\nICAgICB2b2lkIHN0b3AoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgaWYgKHNlcnZlciAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBzZXJ2\nZXIuc2h1dGRvd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICBzdGF0aWMgY2xhc3MgTGVkZ2VyNDAwIHsKICAgICAgICBvcmcuYXBh\nY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyIGJr\nOwogICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMF8wLmJvb2trZWVwZXIuY2xp\nZW50LkxlZGdlckhhbmRsZSBsaDsKCiAgICAgICAgcHJpdmF0ZSBMZWRnZXI0\nMDAob3JnLmFwYWNoZS5ia192NF8wXzAuYm9va2tlZXBlci5jbGllbnQuQm9v\na0tlZXBlciBiaywKICAgICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGUg\nbGgpIHsKICAgICAgICAgICAgdGhpcy5iayA9IGJrOwogICAgICAgICAgICB0\naGlzLmxoID0gbGg7CiAgICAgICAgfQoKICAgICAgICBzdGF0aWMgTGVkZ2Vy\nNDAwIG5ld0xlZGdlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAg\nICBvcmcuYXBhY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyIG5ld2JrCiAgICAgICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hl\nLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyKHprVXRp\nbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAgICAgICBv\ncmcuYXBhY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJI\nYW5kbGUgbmV3bGgKICAgICAgICAgICAgICAgID0gbmV3YmsuY3JlYXRlTGVk\nZ2VyKDEsIDEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBv\ncmcuYXBhY2hlLmJrX3Y0XzBfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2Vl\ncGVyLkRpZ2VzdFR5cGUuQ1JDMzIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAiZm9vYmFyIi5nZXRCeXRlcygpKTsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBMZWRnZXI0MDAobmV3YmssIG5ld2xoKTsKICAgICAgICB9\nCgogICAgICAgIHN0YXRpYyBMZWRnZXI0MDAgb3BlbkxlZGdlcihsb25nIGlk\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5i\na192NF8wXzAuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlciBuZXdiawog\nICAgICAgICAgICAgICAgPSBuZXcgb3JnLmFwYWNoZS5ia192NF8wXzAuYm9v\na2tlZXBlci5jbGllbnQuQm9va0tlZXBlcih6a1V0aWwuZ2V0Wm9vS2VlcGVy\nQ29ubmVjdFN0cmluZygpKTsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192\nNF8wXzAuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlIG5ld2xoCiAg\nICAgICAgICAgICAgICA9IG5ld2JrLm9wZW5MZWRnZXIoaWQsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8wXzAu\nYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMy\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJmb29iYXIiLmdl\ndEJ5dGVzKCkpOwogICAgICAgICAgICByZXR1cm4gbmV3IExlZGdlcjQwMChu\nZXdiaywgbmV3bGgpOwogICAgICAgIH0KCiAgICAgICAgbG9uZyBnZXRJZCgp\nIHsKICAgICAgICAgICAgcmV0dXJuIGxoLmdldElkKCk7CiAgICAgICAgfQoK\nICAgICAgICB2b2lkIHdyaXRlMTAwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGxoLmFkZEVudHJ5KEVOVFJZX0RBVEEpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICBsb25nIHJlYWRBbGwoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgbG9uZyBjb3VudCA9IDA7CiAg\nICAgICAgICAgIEVudW1lcmF0aW9uPG9yZy5hcGFjaGUuYmtfdjRfMF8wLmJv\nb2trZWVwZXIuY2xpZW50LkxlZGdlckVudHJ5PiBlbnRyaWVzCiAgICAgICAg\nICAgICAgICA9IGxoLnJlYWRFbnRyaWVzKDAsIGxoLmdldExhc3RBZGRDb25m\naXJtZWQoKSk7CiAgICAgICAgICAgIHdoaWxlIChlbnRyaWVzLmhhc01vcmVF\nbGVtZW50cygpKSB7CiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJlbnRy\neSBkYXRhIGRvZXNuJ3QgbWF0Y2giLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICBBcnJheXMuZXF1YWxzKGVudHJpZXMubmV4dEVsZW1lbnQoKS5nZXRF\nbnRyeSgpLCBFTlRSWV9EQVRBKSk7CiAgICAgICAgICAgICAgICBjb3VudCsr\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb3VudDsKICAg\nICAgICB9CgogICAgICAgIHZvaWQgY2xvc2UoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChsaCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgbGguY2xvc2UoKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAg\nICAgICAgICAgIGlmIChiayAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgYmsuY2xvc2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFZlcnNpb24gNC4x\nLjAgY2xhc3NlcwogICAgICovCiAgICBzdGF0aWMgY2xhc3MgU2VydmVyNDEw\nIHsKICAgICAgICBvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNv\nbmYuU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwogICAgICAgIG9yZy5hcGFj\naGUuYmtfdjRfMV8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyIHNl\ncnZlciA9IG51bGw7CgogICAgICAgIFNlcnZlcjQxMChGaWxlIGpvdXJuYWxE\naXIsIEZpbGUgbGVkZ2VyRGlyLCBpbnQgcG9ydCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIGNvbmYgPSBuZXcgb3JnLmFwYWNoZS5ia192NF8x\nXzAuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAg\nICAgICAgICAgY29uZi5zZXRCb29raWVQb3J0KHBvcnQpOwogICAgICAgICAg\nICBjb25mLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVj\ndFN0cmluZygpKTsKICAgICAgICAgICAgY29uZi5zZXRKb3VybmFsRGlyTmFt\nZShqb3VybmFsRGlyLmdldFBhdGgoKSk7CiAgICAgICAgICAgIGNvbmYuc2V0\nTGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBh\ndGgoKSB9KTsKICAgICAgICB9CgogICAgICAgIHZvaWQgc3RhcnQoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgc2VydmVyID0gbmV3IG9yZy5h\ncGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVy\nKGNvbmYpOwogICAgICAgICAgICBzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICAg\nICAgd2FpdFVwKGNvbmYuZ2V0Qm9va2llUG9ydCgpKTsKICAgICAgICB9Cgog\nICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY29uZi5T\nZXJ2ZXJDb25maWd1cmF0aW9uIGdldENvbmYoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBjb25mOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzdG9wKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChzZXJ2ZXIgIT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgc2VydmVyLnNodXRkb3duKCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNsYXNzIExl\nZGdlcjQxMCB7CiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tl\nZXBlci5jbGllbnQuQm9va0tlZXBlciBiazsKICAgICAgICBvcmcuYXBhY2hl\nLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGUgbGg7\nCgogICAgICAgIHByaXZhdGUgTGVkZ2VyNDEwKG9yZy5hcGFjaGUuYmtfdjRf\nMV8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIgYmssCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tl\nZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlIGxoKSB7CiAgICAgICAgICAgIHRo\naXMuYmsgPSBiazsKICAgICAgICAgICAgdGhpcy5saCA9IGxoOwogICAgICAg\nIH0KCiAgICAgICAgc3RhdGljIExlZGdlcjQxMCBuZXdMZWRnZXIoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8x\nXzAuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlciBuZXdiawogICAgICAg\nICAgICAgICAgPSBuZXcgb3JnLmFwYWNoZS5ia192NF8xXzAuYm9va2tlZXBl\nci5jbGllbnQuQm9va0tlZXBlcih6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVj\ndFN0cmluZygpKTsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlIG5ld2xoCiAgICAgICAg\nICAgICAgICA9IG5ld2JrLmNyZWF0ZUxlZGdlcigxLCAxLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ia192NF8xXzAu\nYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMy\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZvb2JhciIu\nZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGVkZ2VyNDEw\nKG5ld2JrLCBuZXdsaCk7CiAgICAgICAgfQoKICAgICAgICBzdGF0aWMgTGVk\nZ2VyNDEwIG9wZW5MZWRnZXIobG9uZyBpZCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIu\nY2xpZW50LkJvb2tLZWVwZXIgbmV3YmsKICAgICAgICAgICAgICAgID0gbmV3\nIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tL\nZWVwZXIoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAg\nICAgICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xp\nZW50LkxlZGdlckhhbmRsZSBuZXdsaAogICAgICAgICAgICAgICAgPSBuZXdi\nay5vcGVuTGVkZ2VyKGlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuYmtfdjRfMV8wLmJvb2trZWVwZXIuY2xpZW50LkJv\nb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAiZm9vYmFyIi5nZXRCeXRlcygpKTsKICAgICAgICAg\nICAgcmV0dXJuIG5ldyBMZWRnZXI0MTAobmV3YmssIG5ld2xoKTsKICAgICAg\nICB9CgogICAgICAgIGxvbmcgZ2V0SWQoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBsaC5nZXRJZCgpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCB3cml0ZTEw\nMCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBsaC5hZGRF\nbnRyeShFTlRSWV9EQVRBKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgbG9uZyByZWFkQWxsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIGxvbmcgY291bnQgPSAwOwogICAgICAgICAgICBFbnVtZXJhdGlv\nbjxvcmcuYXBhY2hlLmJrX3Y0XzFfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRn\nZXJFbnRyeT4gZW50cmllcwogICAgICAgICAgICAgICAgPSBsaC5yZWFkRW50\ncmllcygwLCBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwogICAgICAgICAg\nICB3aGlsZSAoZW50cmllcy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZSgiZW50cnkgZGF0YSBkb2Vzbid0IG1hdGNo\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgQXJyYXlzLmVxdWFscyhl\nbnRyaWVzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKSwgRU5UUllfREFUQSkp\nOwogICAgICAgICAgICAgICAgY291bnQrKzsKICAgICAgICAgICAgfQogICAg\nICAgICAgICByZXR1cm4gY291bnQ7CiAgICAgICAgfQoKICAgICAgICB2b2lk\nIGNsb3NlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBpZiAobGggIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBpZiAoYmsgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGJrLmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBWZXJzaW9uIDQuMi4wIGNsYXNzZXMKICAgICAqLwog\nICAgc3RhdGljIGNsYXNzIFNlcnZlcjQyMCB7CiAgICAgICAgb3JnLmFwYWNo\nZS5ia192NF8yXzAuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZjsKICAgICAgICBvcmcuYXBhY2hlLmJrX3Y0XzJfMC5ib29ra2Vl\ncGVyLnByb3RvLkJvb2tpZVNlcnZlciBzZXJ2ZXIgPSBudWxsOwoKICAgICAg\nICBTZXJ2ZXI0MjAoRmlsZSBqb3VybmFsRGlyLCBGaWxlIGxlZGdlckRpciwg\naW50IHBvcnQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBjb25m\nID0gbmV3IG9yZy5hcGFjaGUuYmtfdjRfMl8wLmJvb2trZWVwZXIuY29uZi5T\nZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGNvbmYuc2V0Qm9v\na2llUG9ydChwb3J0KTsKICAgICAgICAgICAgY29uZi5zZXRaa1NlcnZlcnMo\nemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAg\nICAgIGNvbmYuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRo\nKCkpOwogICAgICAgICAgICBjb25mLnNldExlZGdlckRpck5hbWVzKG5ldyBT\ndHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7CiAgICAgICAgfQoK\nICAgICAgICB2b2lkIHN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHNlcnZlciA9IG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzJfMC5ib29r\na2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlcihjb25mKTsKICAgICAgICAgICAg\nc2VydmVyLnN0YXJ0KCk7CiAgICAgICAgICAgIHdhaXRVcChjb25mLmdldEJv\nb2tpZVBvcnQoKSk7CiAgICAgICAgfQoKICAgICAgICBvcmcuYXBhY2hlLmJr\nX3Y0XzJfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbiBn\nZXRDb25mKCkgewogICAgICAgICAgICByZXR1cm4gY29uZjsKICAgICAgICB9\nCgogICAgICAgIHZvaWQgc3RvcCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBpZiAoc2VydmVyICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIHNlcnZlci5zaHV0ZG93bigpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHN0YXRpYyBjbGFzcyBMZWRnZXI0MjAgewogICAgICAgIG9y\nZy5hcGFjaGUuYmtfdjRfMl8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVw\nZXIgYms7CiAgICAgICAgb3JnLmFwYWNoZS5ia192NF8yXzAuYm9va2tlZXBl\nci5jbGllbnQuTGVkZ2VySGFuZGxlIGxoOwoKICAgICAgICBwcml2YXRlIExl\nZGdlcjQyMChvcmcuYXBhY2hlLmJrX3Y0XzJfMC5ib29ra2VlcGVyLmNsaWVu\ndC5Cb29rS2VlcGVyIGJrLAogICAgICAgICAgICAgICAgICAgICAgICAgIG9y\nZy5hcGFjaGUuYmtfdjRfMl8wLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhh\nbmRsZSBsaCkgewogICAgICAgICAgICB0aGlzLmJrID0gYms7CiAgICAgICAg\nICAgIHRoaXMubGggPSBsaDsKICAgICAgICB9CgogICAgICAgIHN0YXRpYyBM\nZWRnZXI0MjAgbmV3TGVkZ2VyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuYmtfdjRfMl8wLmJvb2trZWVwZXIuY2xpZW50\nLkJvb2tLZWVwZXIgbmV3YmsKICAgICAgICAgICAgICAgID0gbmV3IG9yZy5h\ncGFjaGUuYmtfdjRfMl8wLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIo\nemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAg\nICAgIG9yZy5hcGFjaGUuYmtfdjRfMl8wLmJvb2trZWVwZXIuY2xpZW50Lkxl\nZGdlckhhbmRsZSBuZXdsaAogICAgICAgICAgICAgICAgPSBuZXdiay5jcmVh\ndGVMZWRnZXIoMSwgMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuYmtfdjRfMl8wLmJvb2trZWVwZXIuY2xpZW50LkJv\nb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICJmb29iYXIiLmdldEJ5dGVzKCkpOwogICAgICAg\nICAgICByZXR1cm4gbmV3IExlZGdlcjQyMChuZXdiaywgbmV3bGgpOwogICAg\nICAgIH0KCiAgICAgICAgc3RhdGljIExlZGdlcjQyMCBvcGVuTGVkZ2VyKGxv\nbmcgaWQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBvcmcuYXBh\nY2hlLmJrX3Y0XzJfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyIG5l\nd2JrCiAgICAgICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hlLmJrX3Y0XzJf\nMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyKHprVXRpbC5nZXRab29L\nZWVwZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAgICAgICBvcmcuYXBhY2hl\nLmJrX3Y0XzJfMC5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJIYW5kbGUgbmV3\nbGgKICAgICAgICAgICAgICAgID0gbmV3Ymsub3BlbkxlZGdlcihpZCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmJrX3Y0\nXzJfMC5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGUu\nQ1JDMzIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImZvb2Jh\nciIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIHJldHVybiBuZXcgTGVkZ2Vy\nNDIwKG5ld2JrLCBuZXdsaCk7CiAgICAgICAgfQoKICAgICAgICBsb25nIGdl\ndElkKCkgewogICAgICAgICAgICByZXR1cm4gbGguZ2V0SWQoKTsKICAgICAg\nICB9CgogICAgICAgIHZvaWQgd3JpdGUxMDAoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkrKykg\newogICAgICAgICAgICAgICAgbGguYWRkRW50cnkoRU5UUllfREFUQSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxvbmcgcmVhZEFsbCgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIGNvdW50ID0g\nMDsKICAgICAgICAgICAgRW51bWVyYXRpb248b3JnLmFwYWNoZS5ia192NF8y\nXzAuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyRW50cnk+IGVudHJpZXMKICAg\nICAgICAgICAgICAgID0gbGgucmVhZEVudHJpZXMoMCwgbGguZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpKTsKICAgICAgICAgICAgd2hpbGUgKGVudHJpZXMuaGFz\nTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUo\nImVudHJ5IGRhdGEgZG9lc24ndCBtYXRjaCIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEFycmF5cy5lcXVhbHMoZW50cmllcy5uZXh0RWxlbWVudCgp\nLmdldEVudHJ5KCksIEVOVFJZX0RBVEEpKTsKICAgICAgICAgICAgICAgIGNv\ndW50Kys7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGNvdW50\nOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBjbG9zZSgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYg\nKGxoICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBsaC5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewog\nICAgICAgICAgICAgICAgaWYgKGJrICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBiay5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3VycmVu\ndCB2ZXJpb24gY2xhc3NlcwogICAgICovCiAgICBzdGF0aWMgY2xhc3MgU2Vy\ndmVyQ3VycmVudCB7CiAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNv\nbmYuU2VydmVyQ29uZmlndXJhdGlvbiBjb25mOwogICAgICAgIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXIgc2VydmVyID0gbnVs\nbDsKCiAgICAgICAgU2VydmVyQ3VycmVudChGaWxlIGpvdXJuYWxEaXIsIEZp\nbGUgbGVkZ2VyRGlyLCBpbnQgcG9ydCwKICAgICAgICAgICAgICAgIGJvb2xl\nYW4gdXNlSG9zdE5hbWVBc0Jvb2tpZUlEKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgY29uZiA9IFRlc3RCS0NvbmZpZ3VyYXRpb24ubmV3U2Vy\ndmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBjb25mLnNldEJvb2tp\nZVBvcnQocG9ydCk7CiAgICAgICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKHpr\nVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAgICAg\nICBjb25mLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgp\nKTsKICAgICAgICAgICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3Ry\naW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwogICAgICAgICAgICBj\nb25mLnNldFVzZUhvc3ROYW1lQXNCb29raWVJRCh1c2VIb3N0TmFtZUFzQm9v\na2llSUQpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzdGFydCgpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgICAgICBzZXJ2ZXIgPSBuZXcgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlcihjb25mKTsKICAg\nICAgICAgICAgc2VydmVyLnN0YXJ0KCk7CiAgICAgICAgICAgIHdhaXRVcChj\nb25mLmdldEJvb2tpZVBvcnQoKSk7CiAgICAgICAgfQoKICAgICAgICBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uIGdl\ndENvbmYoKSB7CiAgICAgICAgICAgIHJldHVybiBjb25mOwogICAgICAgIH0K\nCiAgICAgICAgdm9pZCBzdG9wKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIGlmIChzZXJ2ZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAg\nc2VydmVyLnNodXRkb3duKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgc3RhdGljIGNsYXNzIExlZGdlckN1cnJlbnQgewogICAgICAg\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlciBiazsK\nICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhh\nbmRsZSBsaDsKCiAgICAgICAgcHJpdmF0ZSBMZWRnZXJDdXJyZW50KG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlciBiaywKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5MZWRnZXJIYW5kbGUgbGgpIHsKICAgICAgICAgICAgdGhpcy5i\nayA9IGJrOwogICAgICAgICAgICB0aGlzLmxoID0gbGg7CiAgICAgICAgfQoK\nICAgICAgICBzdGF0aWMgTGVkZ2VyQ3VycmVudCBuZXdMZWRnZXIoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5Cb29rS2VlcGVyIG5ld2JrCiAgICAgICAgICAgICAgICA9\nIG5ldyBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIo\nemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAg\nICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxl\nIG5ld2xoCiAgICAgICAgICAgICAgICA9IG5ld2JrLmNyZWF0ZUxlZGdlcigx\nLCAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5\ncGUuQ1JDMzIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAiZm9vYmFyIi5nZXRCeXRlcygpKTsKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBMZWRnZXJDdXJyZW50KG5ld2JrLCBuZXdsaCk7CiAgICAgICAgfQoKICAg\nICAgICBzdGF0aWMgTGVkZ2VyQ3VycmVudCBvcGVuTGVkZ2VyKGxvbmcgaWQp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIgbmV3YmsKICAgICAgICAgICAg\nICAgID0gbmV3IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tl\nZXBlcih6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKTsKICAg\nICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJI\nYW5kbGUgbmV3bGgKICAgICAgICAgICAgICAgID0gbmV3Ymsub3BlbkxlZGdl\ncihpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZS5D\nUkMzMiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZm9vYmFy\nIi5nZXRCeXRlcygpKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBMZWRnZXJD\ndXJyZW50KG5ld2JrLCBuZXdsaCk7CiAgICAgICAgfQoKICAgICAgICBsb25n\nIGdldElkKCkgewogICAgICAgICAgICByZXR1cm4gbGguZ2V0SWQoKTsKICAg\nICAgICB9CgogICAgICAgIHZvaWQgd3JpdGUxMDAoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7IGkr\nKykgewogICAgICAgICAgICAgICAgbGguYWRkRW50cnkoRU5UUllfREFUQSk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGxvbmcgcmVhZEFs\nbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIGNvdW50\nID0gMDsKICAgICAgICAgICAgRW51bWVyYXRpb248b3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5MZWRnZXJFbnRyeT4gZW50cmllcwogICAgICAgICAg\nICAgICAgPSBsaC5yZWFkRW50cmllcygwLCBsaC5nZXRMYXN0QWRkQ29uZmly\nbWVkKCkpOwogICAgICAgICAgICB3aGlsZSAoZW50cmllcy5oYXNNb3JlRWxl\nbWVudHMoKSkgewogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiZW50cnkg\nZGF0YSBkb2Vzbid0IG1hdGNoIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgQXJyYXlzLmVxdWFscyhlbnRyaWVzLm5leHRFbGVtZW50KCkuZ2V0RW50\ncnkoKSwgRU5UUllfREFUQSkpOwogICAgICAgICAgICAgICAgY291bnQrKzsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY291bnQ7CiAgICAg\nICAgfQoKICAgICAgICB2b2lkIGNsb3NlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAobGggIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgICAgICBpZiAoYmsgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nIGJrLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICB9CgogICAgLyoKICAgICAqIFRlc3Qgb2xkIGNvb2tp\nZSBhY2Nlc3NpbmcgdGhlIG5ldyB2ZXJzaW9uIGZvcm1hdHRlZCBjbHVzdGVy\nLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdE9sZENvb2tpZUFjY2Vzc2luZ05ld0NsdXN0ZXIoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxl\nLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAg\nIGpvdXJuYWxEaXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2Rp\ncigpOwogICAgICAgIEZpbGUgbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1w\nRmlsZSgiYm9va2llIiwgImxlZGdlciIpOwogICAgICAgIGxlZGdlckRpci5k\nZWxldGUoKTsKICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsKCiAgICAgICAg\naW50IHBvcnQgPSBQb3J0TWFuYWdlci5uZXh0RnJlZVBvcnQoKTsKCiAgICAg\nICAgLy8gc3RhcnQgb2xkIHNlcnZlcgogICAgICAgIFNlcnZlcjQxMCBzNDEw\nID0gbmV3IFNlcnZlcjQxMChqb3VybmFsRGlyLCBsZWRnZXJEaXIsIHBvcnQp\nOwogICAgICAgIHM0MTAuc3RhcnQoKTsKCiAgICAgICAgTGVkZ2VyNDEwIGw0\nMTAgPSBMZWRnZXI0MTAubmV3TGVkZ2VyKCk7CiAgICAgICAgbDQxMC53cml0\nZTEwMCgpOwogICAgICAgIGw0MTAuZ2V0SWQoKTsKICAgICAgICBsNDEwLmNs\nb3NlKCk7CiAgICAgICAgczQxMC5zdG9wKCk7CgogICAgICAgIC8vIEZvcm1h\ndCB0aGUgbWV0YWRhdGEgdXNpbmcgY3VycmVudCB2ZXJzaW9uCiAgICAgICAg\nU2VydmVyQ3VycmVudCBjdXJyZW50U2VydmVyID0gbmV3IFNlcnZlckN1cnJl\nbnQoam91cm5hbERpciwgbGVkZ2VyRGlyLAogICAgICAgICAgICAgICAgcG9y\ndCwgZmFsc2UpOwogICAgICAgIEJvb2tLZWVwZXJBZG1pbi5mb3JtYXQobmV3\nIENsaWVudENvbmZpZ3VyYXRpb24oY3VycmVudFNlcnZlci5jb25mKSwKICAg\nICAgICAgICAgICAgIGZhbHNlLCB0cnVlKTsKICAgICAgICAvLyBzdGFydCB0\naGUgY3VycmVudCB2ZXJzaW9uIHNlcnZlciB3aXRoIG9sZCB2ZXJzaW9uIGNv\nb2tpZQogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGN1cnJlbnRTZXJ2ZXIu\nc3RhcnQoKTsKICAgICAgICAgICAgZmFpbCgiQm9va2llIHNob3VsZCBub3Qg\nc3RhcnQgd2l0aCBvbGQgY29va2llIik7CiAgICAgICAgfSBjYXRjaCAoQm9v\na2llRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiT2xk\nIENvb2tpZSBzaG91bGQgbm90IGJlIGFibGUgdG8gYWNjZXNzIiwgZQogICAg\nICAgICAgICAgICAgICAgIC5nZXRNZXNzYWdlKCkuY29udGFpbnMoImluc3Rh\nbmNlSWQiKSk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgY3Vy\ncmVudFNlcnZlci5zdG9wKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBGb3Jt\nYXQgdGhlIGJvb2tpZSBhbHNvIGFuZCByZXN0YXJ0CiAgICAgICAgYXNzZXJ0\nVHJ1ZSgiRm9ybWF0IHNob3VsZCBiZSBzdWNjZXNzIiwKICAgICAgICAgICAg\nICAgIEJvb2tpZS5mb3JtYXQoY3VycmVudFNlcnZlci5jb25mLCBmYWxzZSwg\ndHJ1ZSkpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGN1cnJlbnRTZXJ2\nZXIgPSBudWxsOwogICAgICAgICAgICBjdXJyZW50U2VydmVyID0gbmV3IFNl\ncnZlckN1cnJlbnQoam91cm5hbERpciwgbGVkZ2VyRGlyLCBwb3J0LCBmYWxz\nZSk7CiAgICAgICAgICAgIGN1cnJlbnRTZXJ2ZXIuc3RhcnQoKTsKICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAobnVsbCAhPSBjdXJyZW50\nU2VydmVyKSB7CiAgICAgICAgICAgICAgICBjdXJyZW50U2VydmVyLnN0b3Ao\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgY29tcGF0YWJpbGl0eSBiZXR3ZWVuIHZlcnNpb24gNC4wLjAg\nYW5kIHRoZSBjdXJyZW50IHZlcnNpb24uCiAgICAgKiBJbmNvbXBhdGFiaWxp\ndGllcyBhcmU6CiAgICAgKiAgLSBDdXJyZW50IGNsaWVudCB3aWxsIG5vdCBi\nZSBhYmxlIHRvIHRhbGsgdG8gNC4wLjAgc2VydmVyLgogICAgICogIC0gNC4w\nLjAgY2xpZW50IHdpbGwgbm90IGJlIGFibGUgdG8gZmVuY2UgbGVkZ2VycyBv\nbiBjdXJyZW50IHNlcnZlci4KICAgICAqICAtIEN1cnJlbnQgc2VydmVyIHdv\nbid0IHN0YXJ0IHdpdGggNC4wLjAgc2VydmVyIGRpcmVjdG9yaWVzIHdpdGhv\ndXQgdXBncmFkZS4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RDb21wYXQ0MDAoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxE\naXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAg\nICAgIEZpbGUgbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9v\na2llIiwgImxlZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsK\nICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsKCiAgICAgICAgaW50IHBvcnQg\nPSBQb3J0TWFuYWdlci5uZXh0RnJlZVBvcnQoKTsKICAgICAgICAvLyBzdGFy\ndCBzZXJ2ZXIsIHVwZ3JhZGUKICAgICAgICBTZXJ2ZXI0MDAgczQwMCA9IG5l\ndyBTZXJ2ZXI0MDAoam91cm5hbERpciwgbGVkZ2VyRGlyLCBwb3J0KTsKICAg\nICAgICBzNDAwLnN0YXJ0KCk7CgogICAgICAgIExlZGdlcjQwMCBsNDAwID0g\nTGVkZ2VyNDAwLm5ld0xlZGdlcigpOwogICAgICAgIGw0MDAud3JpdGUxMDAo\nKTsKICAgICAgICBsb25nIG9sZExlZGdlcklkID0gbDQwMC5nZXRJZCgpOwog\nICAgICAgIGw0MDAuY2xvc2UoKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCBj\ndXJyZW50IGNsaWVudCBpc24ndCBhYmxlIHRvIHdyaXRlIHRvIG9sZCBzZXJ2\nZXIKICAgICAgICBMZWRnZXJDdXJyZW50IGxjdXIgPSBMZWRnZXJDdXJyZW50\nLm5ld0xlZGdlcigpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxjdXIu\nd3JpdGUxMDAoKTsKICAgICAgICAgICAgZmFpbCgiQ3VycmVudCBzaG91bGRu\nJ3QgYmUgYWJsZSB0byB3cml0ZSB0byA0LjAuMCBzZXJ2ZXIiKTsKICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgIH0KICAgICAgICBs\nY3VyLmNsb3NlKCk7CgogICAgICAgIHM0MDAuc3RvcCgpOwoKICAgICAgICAv\nLyBTdGFydCB0aGUgY3VycmVudCBzZXJ2ZXIsIHdpbGwgcmVxdWlyZSBhIGZp\nbGVzeXN0ZW0gdXBncmFkZQogICAgICAgIFNlcnZlckN1cnJlbnQgc2N1ciA9\nIG5ldyBTZXJ2ZXJDdXJyZW50KGpvdXJuYWxEaXIsIGxlZGdlckRpciwgcG9y\ndCwgZmFsc2UpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNjdXIuc3Rh\ncnQoKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8g\nc3RhcnQgd2l0aG91dCBkaXJlY3RvcnkgdXBncmFkZSIpOwogICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgfQogICAgICAgIEZpbGVT\neXN0ZW1VcGdyYWRlLnVwZ3JhZGUoc2N1ci5nZXRDb25mKCkpOwoKICAgICAg\nICBzY3VyLnN0YXJ0KCk7CgogICAgICAgIC8vIGNoZWNrIHRoYXQgb2xkIGNs\naWVudCBjYW4gcmVhZCBpdHMgb2xkIGxlZGdlcnMgb24gbmV3IHNlcnZlcgog\nICAgICAgIGw0MDAgPSBMZWRnZXI0MDAub3BlbkxlZGdlcihvbGRMZWRnZXJJ\nZCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDEwMCwgbDQwMC5yZWFkQWxsKCkp\nOwogICAgICAgIGw0MDAuY2xvc2UoKTsKCiAgICAgICAgLy8gY2hlY2sgdGhh\ndCBvbGQgY2xpZW50IGNhbiBjcmVhdGUgbGVkZ2VycyBvbiBuZXcgc2VydmVy\nCiAgICAgICAgbDQwMCA9IExlZGdlcjQwMC5uZXdMZWRnZXIoKTsKICAgICAg\nICBsNDAwLndyaXRlMTAwKCk7CiAgICAgICAgbDQwMC5jbG9zZSgpOwoKICAg\nICAgICAvLyBjaGVjayB0aGF0IGN1cnJlbnQgY2xpZW50IGNhbiByZWFkIG9s\nZCBsZWRnZXIKICAgICAgICBsY3VyID0gTGVkZ2VyQ3VycmVudC5vcGVuTGVk\nZ2VyKG9sZExlZGdlcklkKTsKICAgICAgICBhc3NlcnRFcXVhbHMoMTAwLCBs\nY3VyLnJlYWRBbGwoKSk7CiAgICAgICAgbGN1ci5jbG9zZSgpOwoKICAgICAg\nICAvLyBjaGVjayB0aGF0IG9sZCBjbGllbnQgY2FuIHJlYWQgY3VycmVudCBj\nbGllbnQncyBsZWRnZXJzCiAgICAgICAgbGN1ciA9IExlZGdlckN1cnJlbnQu\nb3BlbkxlZGdlcihvbGRMZWRnZXJJZCk7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKDEwMCwgbGN1ci5yZWFkQWxsKCkpOwogICAgICAgIGxjdXIuY2xvc2UoKTsK\nCiAgICAgICAgLy8gY2hlY2sgdGhhdCBvbGQgY2xpZW50IGNhbiBub3QgZmVu\nY2UgYSBjdXJyZW50IGNsaWVudAogICAgICAgIC8vIGR1ZSB0byBsYWNrIG9m\nIHBhc3N3b3JkCiAgICAgICAgbGN1ciA9IExlZGdlckN1cnJlbnQubmV3TGVk\nZ2VyKCk7CiAgICAgICAgbGN1ci53cml0ZTEwMCgpOwogICAgICAgIGxvbmcg\nZmVuY2VMZWRnZXJJZCA9IGxjdXIuZ2V0SWQoKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBsNDAwID0gTGVkZ2VyNDAwLm9wZW5MZWRnZXIoZmVuY2VM\nZWRnZXJJZCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxl\nIHRvIG9wZW4gbGVkZ2VyIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICB9CiAgICAgICAgbGN1ci53cml0ZTEwMCgpOwogICAgICAgIGxjdXIuY2xv\nc2UoKTsKCiAgICAgICAgbGN1ciA9IExlZGdlckN1cnJlbnQub3BlbkxlZGdl\ncihmZW5jZUxlZGdlcklkKTsKICAgICAgICBhc3NlcnRFcXVhbHMoMjAwLCBs\nY3VyLnJlYWRBbGwoKSk7CiAgICAgICAgbGN1ci5jbG9zZSgpOwoKICAgICAg\nICBzY3VyLnN0b3AoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgY29t\ncGF0YWJpbGl0eSBiZXR3ZWVuIHZlcnNpb24gNC4xLjAgYW5kIHRoZSBjdXJy\nZW50IHZlcnNpb24uCiAgICAgKiAgLSBBIDQuMS4wIGNsaWVudCBpcyBub3Qg\nYWJsZSB0byBvcGVuIGEgbGVkZ2VyIGNyZWF0ZWQgYnkgdGhlIGN1cnJlbnQK\nICAgICAqICAgIHZlcnNpb24gZHVlIHRvIGEgY2hhbmdlIGluIHRoZSBsZWRn\nZXIgbWV0YWRhdGEgZm9ybWF0LgogICAgICogIC0gT3RoZXJ3aXNlLCB0aGV5\nIHNob3VsZCBiZSBjb21wYXRpYmxlLgogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdENvbXBhdDQxMCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAg\nICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1r\nZGlyKCk7CiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGly\nLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwoKICAgICAg\nICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAg\nICAgIC8vIHN0YXJ0IHNlcnZlciwgdXBncmFkZQogICAgICAgIFNlcnZlcjQx\nMCBzNDEwID0gbmV3IFNlcnZlcjQxMChqb3VybmFsRGlyLCBsZWRnZXJEaXIs\nIHBvcnQpOwogICAgICAgIHM0MTAuc3RhcnQoKTsKCiAgICAgICAgTGVkZ2Vy\nNDEwIGw0MTAgPSBMZWRnZXI0MTAubmV3TGVkZ2VyKCk7CiAgICAgICAgbDQx\nMC53cml0ZTEwMCgpOwogICAgICAgIGxvbmcgb2xkTGVkZ2VySWQgPSBsNDEw\nLmdldElkKCk7CiAgICAgICAgbDQxMC5jbG9zZSgpOwoKICAgICAgICAvLyBD\naGVjayB0aGF0IGN1cnJlbnQgY2xpZW50IGNhbiB0byB3cml0ZSB0byBvbGQg\nc2VydmVyCiAgICAgICAgTGVkZ2VyQ3VycmVudCBsY3VyID0gTGVkZ2VyQ3Vy\ncmVudC5uZXdMZWRnZXIoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBs\nY3VyLndyaXRlMTAwKCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBi\nZSBhYmxlIHRvIHdyaXRlIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICB9CiAgICAgICAgbGN1ci5jbG9zZSgpOwoKICAgICAgICBzNDEwLnN0b3Ao\nKTsKCiAgICAgICAgLy8gU3RhcnQgdGhlIGN1cnJlbnQgc2VydmVyLCB3aWxs\nIG5vdCByZXF1aXJlIGEgZmlsZXN5c3RlbSB1cGdyYWRlCiAgICAgICAgU2Vy\ndmVyQ3VycmVudCBzY3VyID0gbmV3IFNlcnZlckN1cnJlbnQoam91cm5hbERp\nciwgbGVkZ2VyRGlyLCBwb3J0LCBmYWxzZSk7CiAgICAgICAgc2N1ci5zdGFy\ndCgpOwoKICAgICAgICAvLyBjaGVjayB0aGF0IG9sZCBjbGllbnQgY2FuIHJl\nYWQgaXRzIG9sZCBsZWRnZXJzIG9uIG5ldyBzZXJ2ZXIKICAgICAgICBsNDEw\nID0gTGVkZ2VyNDEwLm9wZW5MZWRnZXIob2xkTGVkZ2VySWQpOwogICAgICAg\nIGFzc2VydEVxdWFscygxMDAsIGw0MTAucmVhZEFsbCgpKTsKICAgICAgICBs\nNDEwLmNsb3NlKCk7CgogICAgICAgIC8vIGNoZWNrIHRoYXQgb2xkIGNsaWVu\ndCBjYW4gY3JlYXRlIGxlZGdlcnMgb24gbmV3IHNlcnZlcgogICAgICAgIGw0\nMTAgPSBMZWRnZXI0MTAubmV3TGVkZ2VyKCk7CiAgICAgICAgbDQxMC53cml0\nZTEwMCgpOwogICAgICAgIGw0MTAuY2xvc2UoKTsKCiAgICAgICAgLy8gY2hl\nY2sgdGhhdCBhbiBvbGQgY2xpZW50IGNhbiBmZW5jZSBhbiBvbGQgY2xpZW50\nCiAgICAgICAgbDQxMCA9IExlZGdlcjQxMC5uZXdMZWRnZXIoKTsKICAgICAg\nICBsNDEwLndyaXRlMTAwKCk7CgogICAgICAgIExlZGdlcjQxMCBsNDEwZiA9\nIExlZGdlcjQxMC5vcGVuTGVkZ2VyKGw0MTAuZ2V0SWQoKSk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgbDQxMC53cml0ZTEwMCgpOwogICAgICAgICAg\nICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byB3cml0ZSIpOwogICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJl\nY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgICAgIGw0MTBmLmNsb3NlKCk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgbDQxMC5jbG9zZSgpOwogICAg\nICAgICAgICBmYWlsKCJTaG91bGRuJ3QgYmUgYWJsZSB0byBjbG9zZSIpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8v\nIGNvcnJlY3QKICAgICAgICB9CgogICAgICAgIC8vIGNoZWNrIHRoYXQgYSBu\nZXcgY2xpZW50IGNhbiBmZW5jZSBhbiBvbGQgY2xpZW50CiAgICAgICAgLy8g\nYW5kIHRoZSBvbGQgY2xpZW50IGNhbiBjb250aW51ZSB0byByZWFkIHRoYXQg\nbGVkZ2VyCiAgICAgICAgbDQxMCA9IExlZGdlcjQxMC5uZXdMZWRnZXIoKTsK\nICAgICAgICBsNDEwLndyaXRlMTAwKCk7CgogICAgICAgIG9sZExlZGdlcklk\nID0gbDQxMC5nZXRJZCgpOwogICAgICAgIGxjdXIgPSBMZWRnZXJDdXJyZW50\nLm9wZW5MZWRnZXIob2xkTGVkZ2VySWQpOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGw0MTAud3JpdGUxMDAoKTsKICAgICAgICAgICAgZmFpbCgiU2hv\ndWxkbid0IGJlIGFibGUgdG8gd3JpdGUiKTsKICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91\ncgogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBsNDEwLmNs\nb3NlKCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRv\nIGNsb3NlIik7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgLy8gY29ycmVjdAogICAgICAgIH0KICAgICAgICBsY3VyLmNs\nb3NlKCk7CgogICAgICAgIGw0MTAgPSBMZWRnZXI0MTAub3BlbkxlZGdlcihv\nbGRMZWRnZXJJZCk7CgogICAgICAgIGFzc2VydEVxdWFscygxMDAsIGw0MTAu\ncmVhZEFsbCgpKTsKICAgICAgICBsNDEwLmNsb3NlKCk7CgogICAgICAgIC8v\nIGNoZWNrIHRoYXQgY3VycmVudCBjbGllbnQgY2FuIHJlYWQgb2xkIGxlZGdl\ncgogICAgICAgIGxjdXIgPSBMZWRnZXJDdXJyZW50Lm9wZW5MZWRnZXIob2xk\nTGVkZ2VySWQpOwogICAgICAgIGFzc2VydEVxdWFscygxMDAsIGxjdXIucmVh\nZEFsbCgpKTsKICAgICAgICBsY3VyLmNsb3NlKCk7CgogICAgICAgIC8vIGNo\nZWNrIHRoYXQgb2xkIGNsaWVudCBjYW4gcmVhZCBjdXJyZW50IGNsaWVudCdz\nIGxlZGdlcnMKICAgICAgICBsY3VyID0gTGVkZ2VyQ3VycmVudC5vcGVuTGVk\nZ2VyKG9sZExlZGdlcklkKTsKICAgICAgICBhc3NlcnRFcXVhbHMoMTAwLCBs\nY3VyLnJlYWRBbGwoKSk7CiAgICAgICAgbGN1ci5jbG9zZSgpOwoKICAgICAg\nICAvLyBjaGVjayB0aGF0IG9sZCBjbGllbnQgY2FuIG5vdCBmZW5jZSBhIGN1\ncnJlbnQgY2xpZW50CiAgICAgICAgLy8gc2luY2UgaXQgY2Fubm90IG9wZW4g\nYSBuZXcgbGVkZ2VyIGR1ZSB0byB0aGUgZm9ybWF0IGNoYW5nZXMKICAgICAg\nICBsY3VyID0gTGVkZ2VyQ3VycmVudC5uZXdMZWRnZXIoKTsKICAgICAgICBs\nY3VyLndyaXRlMTAwKCk7CiAgICAgICAgbG9uZyBmZW5jZUxlZGdlcklkID0g\nbGN1ci5nZXRJZCgpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGw0MTAg\nPSBMZWRnZXI0MTAub3BlbkxlZGdlcihmZW5jZUxlZGdlcklkKTsKICAgICAg\nICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gb3BlbiBsZWRnZXIi\nKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgICAgICBsY3Vy\nLndyaXRlMTAwKCk7CiAgICAgICAgbGN1ci5jbG9zZSgpOwoKICAgICAgICBz\nY3VyLnN0b3AoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgY29tcGF0\nYWJpbGl0eSBiZXR3ZWVuIG9sZCB2ZXJzaW9ucyBhbmQgdGhlIGN1cnJlbnQg\ndmVyc2lvbi4KICAgICAqIC0gb2xkIHNlcnZlciByZXN0YXJ0cyB3aXRoIHVz\nZUhvc3ROYW1lQXNCb29raWVJRD10cnVlLgogICAgICogLSBSZWFkIGxlZGdl\ncnMgd2l0aCBvbGQgYW5kIG5ldyBjbGllbnRzCiAgICAgKi8KICAgIEBUZXN0\nKHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDb21wYXRS\nZWFkcygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5h\nbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFs\nIik7CiAgICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3Vy\nbmFsRGlyLm1rZGlyKCk7CiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxl\nLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAg\nbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2Rpcigp\nOwoKICAgICAgICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9y\ndCgpOwogICAgICAgIC8vIHN0YXJ0IHNlcnZlciwgdXBncmFkZQogICAgICAg\nIFNlcnZlcjQxMCBzNDEwID0gbmV3IFNlcnZlcjQxMChqb3VybmFsRGlyLCBs\nZWRnZXJEaXIsIHBvcnQpOwogICAgICAgIHM0MTAuc3RhcnQoKTsKCiAgICAg\nICAgTGVkZ2VyNDEwIGw0MTAgPSBMZWRnZXI0MTAubmV3TGVkZ2VyKCk7CiAg\nICAgICAgbDQxMC53cml0ZTEwMCgpOwogICAgICAgIGxvbmcgb2xkTGVkZ2Vy\nSWQgPSBsNDEwLmdldElkKCk7CiAgICAgICAgbDQxMC5jbG9zZSgpOwoKICAg\nICAgICAvLyBDaGVjayB0aGF0IDQyMCBjbGllbnQgY2FuIHRvIHdyaXRlIHRv\nIDQxMCBzZXJ2ZXIKICAgICAgICBMZWRnZXI0MjAgbDQyMCA9IExlZGdlcjQy\nMC5uZXdMZWRnZXIoKTsKICAgICAgICBsNDIwLndyaXRlMTAwKCk7CiAgICAg\nICAgbG9uZyBsaWQ0MjAgPSBsNDIwLmdldElkKCk7CiAgICAgICAgbDQyMC5j\nbG9zZSgpOwoKICAgICAgICBzNDEwLnN0b3AoKTsKCiAgICAgICAgLy8gU3Rh\ncnQgdGhlIGN1cnJlbnQgc2VydmVyLCB3aWxsIG5vdCByZXF1aXJlIGEgZmls\nZXN5c3RlbSB1cGdyYWRlCiAgICAgICAgU2VydmVyQ3VycmVudCBzY3VyID0g\nbmV3IFNlcnZlckN1cnJlbnQoam91cm5hbERpciwgbGVkZ2VyRGlyLCBwb3J0\nLAogICAgICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgc2N1ci5zdGFydCgp\nOwoKICAgICAgICAvLyBjaGVjayB0aGF0IG9sZCBjbGllbnQgY2FuIHJlYWQg\naXRzIG9sZCBsZWRnZXJzIG9uIG5ldyBzZXJ2ZXIKICAgICAgICBsNDEwID0g\nTGVkZ2VyNDEwLm9wZW5MZWRnZXIob2xkTGVkZ2VySWQpOwogICAgICAgIGFz\nc2VydEVxdWFscygxMDAsIGw0MTAucmVhZEFsbCgpKTsKICAgICAgICBsNDEw\nLmNsb3NlKCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgNDIwIGNsaWVudCBj\nYW4gcmVhZCBvbGQgbGVkZ2VycyBvbiBuZXcgc2VydmVyCiAgICAgICAgbDQy\nMCA9IExlZGdlcjQyMC5vcGVuTGVkZ2VyKGxpZDQyMCk7CiAgICAgICAgYXNz\nZXJ0RXF1YWxzKCJGYWlsZWQgdG8gcmVhZCBlbnRyaWVzISIsIDEwMCwgbDQy\nMC5yZWFkQWxsKCkpOwogICAgICAgIGw0MjAuY2xvc2UoKTsKCiAgICAgICAg\nLy8gQ2hlY2sgdGhhdCBjdXJyZW50IGNsaWVudCBjYW4gcmVhZCBvbGQgbGVk\nZ2VycyBvbiBuZXcgc2VydmVyCiAgICAgICAgZmluYWwgTGVkZ2VyQ3VycmVu\ndCBjdXJsZWRnZXIgPSBMZWRnZXJDdXJyZW50Lm9wZW5MZWRnZXIobGlkNDIw\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkZhaWxlZCB0byByZWFkIGVudHJp\nZXMhIiwgMTAwLCBjdXJsZWRnZXIucmVhZEFsbCgpKTsKICAgICAgICBjdXJs\nZWRnZXIuY2xvc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgY29t\ncGF0YWJpbGl0eSBiZXR3ZWVuIHZlcnNpb24gb2xkIHZlcnNpb24gYW5kIHRo\nZSBjdXJyZW50IHZlcnNpb24uCiAgICAgKiAtIDQuMS4wIHNlcnZlciByZXN0\nYXJ0cyB3aXRoIHVzZUhvc3ROYW1lQXNCb29raWVJRD10cnVlLgogICAgICog\nLSBXcml0ZSBsZWRnZXJzIHdpdGggb2xkIGFuZCBuZXcgY2xpZW50cwogICAg\nICogLSBSZWFkIGxlZGdlcnMgd3JpdHRlbiBieSBvbGQgY2xpZW50cy4KICAg\nICAqLwogICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdENvbXBhdFdyaXRlcygpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJv\nb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5hbERpci5kZWxldGUo\nKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAgICAgRmlsZSBs\nZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVk\nZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxl\nZGdlckRpci5ta2RpcigpOwoKICAgICAgICBpbnQgcG9ydCA9IFBvcnRNYW5h\nZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAgIC8vIHN0YXJ0IHNlcnZlciwg\ndXBncmFkZQogICAgICAgIFNlcnZlcjQxMCBzNDEwID0gbmV3IFNlcnZlcjQx\nMChqb3VybmFsRGlyLCBsZWRnZXJEaXIsIHBvcnQpOwogICAgICAgIHM0MTAu\nc3RhcnQoKTsKICAgICAgICBzNDEwLnN0b3AoKTsKCiAgICAgICAgLy8gU3Rh\ncnQgdGhlIGN1cnJlbnQgc2VydmVyLCB3aWxsIG5vdCByZXF1aXJlIGEgZmls\nZXN5c3RlbSB1cGdyYWRlCiAgICAgICAgU2VydmVyQ3VycmVudCBzY3VyID0g\nbmV3IFNlcnZlckN1cnJlbnQoam91cm5hbERpciwgbGVkZ2VyRGlyLCBwb3J0\nLAogICAgICAgICAgICAgICAgdHJ1ZSk7CiAgICAgICAgc2N1ci5zdGFydCgp\nOwoKICAgICAgICAvLyBDaGVjayB0aGF0IGN1cnJlbnQgY2xpZW50IGNhbiB0\nbyB3cml0ZSB0byBzZXJ2ZXIKICAgICAgICBMZWRnZXJDdXJyZW50IGxjdXIg\nPSBMZWRnZXJDdXJyZW50Lm5ld0xlZGdlcigpOwogICAgICAgIGxjdXIud3Jp\ndGUxMDAoKTsKICAgICAgICBsY3VyLmNsb3NlKCk7CiAgICAgICAgZmluYWwg\nTGVkZ2VyQ3VycmVudCBjdXJsZWRnZXIgPSBMZWRnZXJDdXJyZW50Lm9wZW5M\nZWRnZXIobGN1ci5nZXRJZCgpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkZh\naWxlZCB0byByZWFkIGVudHJpZXMhIiwgMTAwLCBjdXJsZWRnZXIucmVhZEFs\nbCgpKTsKCiAgICAgICAgLy8gQ2hlY2sgdGhhdCA0MTAgY2xpZW50IGNhbiB3\ncml0ZSB0byBzZXJ2ZXIKICAgICAgICBMZWRnZXI0MTAgbDQxMCA9IExlZGdl\ncjQxMC5uZXdMZWRnZXIoKTsKICAgICAgICBsNDEwLndyaXRlMTAwKCk7CiAg\nICAgICAgbG9uZyBvbGRMZWRnZXJJZCA9IGw0MTAuZ2V0SWQoKTsKICAgICAg\nICBsNDEwLmNsb3NlKCk7CgogICAgICAgIC8vIENoZWNrIHRoYXQgNDIwIGNs\naWVudCBjYW4gd3JpdGUgdG8gc2VydmVyCiAgICAgICAgTGVkZ2VyNDEwIGw0\nMjAgPSBMZWRnZXI0MTAubmV3TGVkZ2VyKCk7CiAgICAgICAgbDQyMC53cml0\nZTEwMCgpOwogICAgICAgIGxvbmcgbGlkNDIwID0gbDQyMC5nZXRJZCgpOwog\nICAgICAgIGw0MjAuY2xvc2UoKTsKCiAgICAgICAgLy8gY2hlY2sgdGhhdCBu\nZXcgY2xpZW50IGNhbiByZWFkIG9sZCBsZWRnZXJzIG9uIG5ldyBzZXJ2ZXIK\nICAgICAgICBMZWRnZXJDdXJyZW50IG9sZGxlZGdlciA9IExlZGdlckN1cnJl\nbnQub3BlbkxlZGdlcihvbGRMZWRnZXJJZCk7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJGYWlsZWQgdG8gcmVhZCBlbnRyaWVzISIsIDEwMCwgb2xkbGVkZ2Vy\nLnJlYWRBbGwoKSk7CiAgICAgICAgb2xkbGVkZ2VyLmNsb3NlKCk7CgogICAg\nICAgIC8vIGNoZWNrIHRoYXQgbmV3IGNsaWVudCBjYW4gcmVhZCBvbGQgbGVk\nZ2VycyBvbiBuZXcgc2VydmVyCiAgICAgICAgb2xkbGVkZ2VyID0gTGVkZ2Vy\nQ3VycmVudC5vcGVuTGVkZ2VyKGxpZDQyMCk7CiAgICAgICAgYXNzZXJ0RXF1\nYWxzKCJGYWlsZWQgdG8gcmVhZCBlbnRyaWVzISIsIDEwMCwgb2xkbGVkZ2Vy\nLnJlYWRBbGwoKSk7CiAgICAgICAgb2xkbGVkZ2VyLmNsb3NlKCk7CiAgICB9\nCn0K\n","encoding":"base64"}

