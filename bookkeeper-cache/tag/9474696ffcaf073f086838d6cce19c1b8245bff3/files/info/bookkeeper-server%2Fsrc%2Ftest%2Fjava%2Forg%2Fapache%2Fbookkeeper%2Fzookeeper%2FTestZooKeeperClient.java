{"sha":"f48fe37f70a4100f0183966b00359460f8ec8fe6","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjQ4ZmUzN2Y3MGE0MTAwZjAxODM5NjZiMDAzNTk0NjBmOGVjOGZlNg==","size":14148,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f48fe37f70a4100f0183966b00359460f8ec8fe6","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci56b29rZWVwZXI7\nCgppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRp\nbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5U\naW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5B\ndG9taWNSZWZlcmVuY2U7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnRlc3QuWm9vS2VlcGVyVXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLkFzeW5jQ2FsbGJhY2suQ2hpbGRyZW4yQ2FsbGJhY2s7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrLkRhdGFDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkFzeW5jQ2FsbGJhY2su\nU3RhdENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQXN5\nbmNDYWxsYmFjay5TdHJpbmdDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUu\nem9va2VlcGVyLkFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrOwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuQ3JlYXRlTW9kZTsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tl\nZXBlci5XYXRjaGVyLkV2ZW50LkV2ZW50VHlwZTsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLldhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGU7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29EZWZzLklkczsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLmRhdGEuU3RhdDsKaW1wb3J0IG9yZy5qdW5pdC5BZnRl\ncjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuQXNz\nZXJ0OwppbXBvcnQganVuaXQuZnJhbWV3b3JrLlRlc3RDYXNlOwoKLyoqCiAq\nIFRlc3QgdGhlIHdyYXBwZXIgb2Yge0BsaW5rIG9yZy5hcGFjaGUuem9va2Vl\ncGVyLlpvb0tlZXBlcn0gY2xpZW50LgogKi8KcHVibGljIGNsYXNzIFRlc3Ra\nb29LZWVwZXJDbGllbnQgZXh0ZW5kcyBUZXN0Q2FzZSB7CgogICAgc3RhdGlj\nIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihUZXN0Wm9vS2VlcGVyQ2xpZW50LmNsYXNzKTsKCiAgICAvLyBab29LZWVw\nZXIgcmVsYXRlZCB2YXJpYWJsZXMKICAgIHByb3RlY3RlZCBab29LZWVwZXJV\ndGlsIHprVXRpbCA9IG5ldyBab29LZWVwZXJVdGlsKCk7CgogICAgQEJlZm9y\nZQogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIGxvZ2dlci5pbmZvKCJTZXR0aW5nIHVw\nIHRlc3Qge30uIiwgZ2V0TmFtZSgpKTsKICAgICAgICB6a1V0aWwuc3RhcnRT\nZXJ2ZXIoKTsKICAgIH0KCiAgICBAQWZ0ZXIKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICB6a1V0aWwua2lsbFNlcnZlcigpOwogICAgICAgIGxvZ2dlci5pbmZv\nKCJUZWFyZWQgZG93biB0ZXN0IHt9LiIsIGdldE5hbWUoKSk7CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIGV4cGlyZVpvb0tlZXBlclNlc3Npb24oWm9vS2Vl\ncGVyIHprLCBpbnQgdGltZW91dCkKICAgICAgICAgICAgdGhyb3dzIElPRXhj\nZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9u\nIHsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBD\nb3VudERvd25MYXRjaCgxKTsKICAgICAgICBab29LZWVwZXIgbmV3WmsgPSBu\nZXcgWm9vS2VlcGVyKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5n\nKCksIHRpbWVvdXQsCiAgICAgICAgICAgICAgICBuZXcgV2F0Y2hlcigpIHsK\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBldmVudCkgewogICAgICAgICAgICAg\nICAgaWYgKGV2ZW50LmdldFR5cGUoKSA9PSBFdmVudFR5cGUuTm9uZSAmJgog\nICAgICAgICAgICAgICAgICAgICAgICBldmVudC5nZXRTdGF0ZSgpID09IEtl\nZXBlclN0YXRlLlN5bmNDb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAg\nICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQoKICAgICAgICB9LCB6ay5nZXRTZXNzaW9uSWQoKSwgemsuZ2V0\nU2Vzc2lvblBhc3N3ZCgpKTsKICAgICAgICBpZiAoIWxhdGNoLmF3YWl0KHRp\nbWVvdXQsIFRpbWVVbml0Lk1JTExJU0VDT05EUykpIHsKICAgICAgICAgICAg\ndGhyb3cgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNlcHRpb24u\nQ29kZS5DT05ORUNUSU9OTE9TUyk7CiAgICAgICAgfQogICAgICAgIG5ld1pr\nLmNsb3NlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTaHV0ZG93biBaayBT\nZXJ2ZXIgd2hlbiBjbGllbnQgcmVjZWl2ZWQgYW4gZXhwaXJlIGV2ZW50Lgog\nICAgICogU28gdGhlIGNsaWVudCBpc3N1ZSByZWNyZWF0aW9uIGNsaWVudCB0\nYXNrIGJ1dCBpdCB3b3VsZCBub3Qgc3VjY2VlZAogICAgICogdW50aWwgd2Ug\nc3RhcnQgdGhlIHpvb2tlZXBlciBzZXJ2ZXIgYWdhaW4uCiAgICAgKi8KICAg\nIGNsYXNzIFNodXRkb3duWmtTZXJ2ZXJDbGllbnQgZXh0ZW5kcyBab29LZWVw\nZXJDbGllbnQgewoKICAgICAgICBTaHV0ZG93blprU2VydmVyQ2xpZW50KFN0\ncmluZyBjb25uZWN0U3RyaW5nLCBpbnQgc2Vzc2lvblRpbWVvdXRNcywKICAg\nICAgICAgICAgICAgIFpvb0tlZXBlcldhdGNoZXJCYXNlIHdhdGNoZXIsIFJl\ndHJ5UG9saWN5IG9wZXJhdGlvblJldHJ5UG9saWN5KXRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIHN1cGVyKGNvbm5lY3RTdHJpbmcsIHNlc3Np\nb25UaW1lb3V0TXMsIHdhdGNoZXIsIG9wZXJhdGlvblJldHJ5UG9saWN5KTsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2\nb2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAg\nIGlmIChldmVudC5nZXRUeXBlKCkgPT0gRXZlbnRUeXBlLk5vbmUgJiYKICAg\nICAgICAgICAgICAgICAgICBldmVudC5nZXRTdGF0ZSgpID09IEtlZXBlclN0\nYXRlLkV4cGlyZWQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgemtVdGlsLnN0b3BTZXJ2ZXIoKTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAg\nICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gc3RvcCB6b29rZWVwZXIgc2Vy\ndmVyIDogIiwgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgc3VwZXIucHJvY2VzcyhldmVudCk7CiAgICAgICAgfQoK\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTEyMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFJlY29ubmVjdEFmdGVyRXhpcHJlZCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGV4cGlyZUxhdGNo\nID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIFdhdGNoZXIgdGVz\ndFdhdGNoZXIgPSBuZXcgV2F0Y2hlcigpIHsKCiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRF\ndmVudCBldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFR5\ncGUoKSA9PSBFdmVudFR5cGUuTm9uZSAmJgogICAgICAgICAgICAgICAgICAg\nICAgICBldmVudC5nZXRTdGF0ZSgpID09IEtlZXBlclN0YXRlLkV4cGlyZWQp\nIHsKICAgICAgICAgICAgICAgICAgICBleHBpcmVMYXRjaC5jb3VudERvd24o\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICB9\nOwogICAgICAgIGZpbmFsIGludCB0aW1lb3V0ID0gMjAwMDsKICAgICAgICBa\nb29LZWVwZXJXYXRjaGVyQmFzZSB3YXRjaGVyTWFuYWdlciA9CiAgICAgICAg\nICAgICAgICBuZXcgWm9vS2VlcGVyV2F0Y2hlckJhc2UodGltZW91dCkuYWRk\nQ2hpbGRXYXRjaGVyKHRlc3RXYXRjaGVyKTsKICAgICAgICBMaXN0PFdhdGNo\nZXI+IHdhdGNoZXJzID0gbmV3IEFycmF5TGlzdDxXYXRjaGVyPigxKTsKICAg\nICAgICB3YXRjaGVycy5hZGQodGVzdFdhdGNoZXIpOwogICAgICAgIFpvb0tl\nZXBlckNsaWVudCBjbGllbnQgPSBuZXcgU2h1dGRvd25aa1NlcnZlckNsaWVu\ndCgKICAgICAgICAgICAgICAgIHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0\nU3RyaW5nKCksIHRpbWVvdXQsIHdhdGNoZXJNYW5hZ2VyLAogICAgICAgICAg\nICAgICAgbmV3IEJvdW5kRXhwb25lbnRpYWxCYWNrb2ZmUmV0cnlQb2xpY3ko\ndGltZW91dCwgdGltZW91dCwgMCkKICAgICAgICAgICAgICAgICk7CiAgICAg\nICAgY2xpZW50LndhaXRGb3JDb25uZWN0aW9uKCk7CiAgICAgICAgQXNzZXJ0\nLmFzc2VydFRydWUoIkNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhbiBhbGl2\nZSBab29LZWVwZXIuIiwKICAgICAgICAgICAgICAgIGNsaWVudC5nZXRTdGF0\nZSgpLmlzQ29ubmVjdGVkKCkpOwogICAgICAgIGxvZ2dlci5pbmZvKCJFeHBp\ncmUgem9va2VlcGVyIGNsaWVudCIpOwogICAgICAgIGV4cGlyZVpvb0tlZXBl\nclNlc3Npb24oY2xpZW50LCB0aW1lb3V0KTsKCiAgICAgICAgLy8gd2FpdCB1\nbnRpbCBzZXNzaW9uIGV4cGlyZQogICAgICAgIEFzc2VydC5hc3NlcnRUcnVl\nKCJDbGllbnQgcmVnaXN0ZXJlZCB3YXRjaGVyIHNob3VsZCByZWNlaXZlIGV4\ncGlyZSBldmVudC4iLAogICAgICAgICAgICAgICAgZXhwaXJlTGF0Y2guYXdh\naXQoMiAqIHRpbWVvdXQsIFRpbWVVbml0Lk1JTExJU0VDT05EUykpOwoKICAg\nICAgICBBc3NlcnQuYXNzZXJ0RmFsc2UoIkNsaWVudCBkb2Vzbid0IHJlY2Vp\ndmUgZXhwaXJlIGV2ZW50IGZyb20gWm9vS2VlcGVyLiIsCiAgICAgICAgICAg\nICAgICBjbGllbnQuZ2V0U3RhdGUoKS5pc0Nvbm5lY3RlZCgpKTsKICAgICAg\nICAKICAgICAgICB0cnkgewogICAgICAgICAgICBjbGllbnQuZXhpc3RzKCIv\ndG1wIiwgZmFsc2UpOwogICAgICAgICAgICBBc3NlcnQuZmFpbCgiU2hvdWxk\nIGZhaWwgZHVlIHRvIGNvbm5lY3Rpb24gbG9zcy4iKTsKICAgICAgICB9IGNh\ndGNoIChLZWVwZXJFeGNlcHRpb24uQ29ubmVjdGlvbkxvc3NFeGNlcHRpb24g\nY2xlKSB7CiAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAgICAgICAgfSBjYXRj\naCAoS2VlcGVyRXhjZXB0aW9uLlNlc3Npb25FeHBpcmVkRXhjZXB0aW9uIGNs\nZSkgewogICAgICAgICAgICAvLyBleHBlY3RlZAogICAgICAgIH0KCiAgICAg\nICAgemtVdGlsLnJlc3RhcnRTZXJ2ZXIoKTsKCiAgICAgICAgLy8gd2FpdCBm\nb3IgYSByZWNvbm5lY3QgY3ljbGUKICAgICAgICBUaHJlYWQuc2xlZXAoMip0\naW1lb3V0KTsKICAgICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZSgiQ2xpZW50IGZh\naWxlZCB0byBjb25uZWN0IHpvb2tlZXBlciBldmVuIGl0IHdhcyBiYWNrLiIs\nCiAgICAgICAgICAgICAgICBjbGllbnQuZ2V0U3RhdGUoKS5pc0Nvbm5lY3Rl\nZCgpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBjbGllbnQuZXhpc3Rz\nKCIvdG1wIiwgZmFsc2UpOwogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2Vw\ndGlvbi5Db25uZWN0aW9uTG9zc0V4Y2VwdGlvbiBjbGUpIHsKICAgICAgICAg\nICAgQXNzZXJ0LmZhaWwoIlNob3VsZCBub3QgdGhyb3cgQ29ubmVjdGlvbkxv\nc3NFeGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRp\nb24uU2Vzc2lvbkV4cGlyZWRFeGNlcHRpb24gY2xlKSB7CiAgICAgICAgICAg\nIEFzc2VydC5mYWlsKCJTaG91bGQgbm90IHRocm93IFNlc3Npb25FeHBpcmVk\nRXhjZXB0aW9uIik7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVv\ndXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmV0cnlTeW5jT3BlcmF0\naW9ucygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZpbmFsIGludCB0\naW1lb3V0ID0gMjAwMDsKICAgICAgICBab29LZWVwZXJDbGllbnQgY2xpZW50\nID0gWm9vS2VlcGVyQ2xpZW50LmNyZWF0ZUNvbm5lY3RlZFpvb0tlZXBlckNs\naWVudCgKICAgICAgICAgICAgICAgIHprVXRpbC5nZXRab29LZWVwZXJDb25u\nZWN0U3RyaW5nKCksIHRpbWVvdXQsIG5ldyBIYXNoU2V0PFdhdGNoZXI+KCks\nCiAgICAgICAgICAgICAgICBuZXcgQm91bmRFeHBvbmVudGlhbEJhY2tvZmZS\nZXRyeVBvbGljeSh0aW1lb3V0LCB0aW1lb3V0LCBJbnRlZ2VyLk1BWF9WQUxV\nRSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgQXNzZXJ0LmFzc2VydFRy\ndWUoIkNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhbiBhbGl2ZSBab29LZWVw\nZXIuIiwKICAgICAgICAgICAgICAgIGNsaWVudC5nZXRTdGF0ZSgpLmlzQ29u\nbmVjdGVkKCkpOwoKICAgICAgICBTdHJpbmcgcGF0aCA9ICIvYSI7CiAgICAg\nICAgYnl0ZVtdIGRhdGEgPSAidGVzdCIuZ2V0Qnl0ZXMoKTsKCiAgICAgICAg\nZXhwaXJlWm9vS2VlcGVyU2Vzc2lvbihjbGllbnQsIHRpbWVvdXQpOwogICAg\nICAgIGxvZ2dlci5pbmZvKCJDcmVhdGUgem5vZGUgIiArIHBhdGgpOwogICAg\nICAgIGNsaWVudC5jcmVhdGUocGF0aCwgZGF0YSwgSWRzLk9QRU5fQUNMX1VO\nU0FGRSwgQ3JlYXRlTW9kZS5QRVJTSVNURU5UKTsKICAgICAgICBsb2dnZXIu\naW5mbygiQ3JlYXRlZCB6bm9kZSAiICsgcGF0aCk7CgogICAgICAgIGV4cGly\nZVpvb0tlZXBlclNlc3Npb24oY2xpZW50LCB0aW1lb3V0KTsKICAgICAgICBs\nb2dnZXIuaW5mbygiRXhpc3RzIHpub2RlICIgKyBwYXRoKTsKICAgICAgICBT\ndGF0IHN0YXQgPSBjbGllbnQuZXhpc3RzKHBhdGgsIGZhbHNlKTsKICAgICAg\nICBBc3NlcnQuYXNzZXJ0Tm90TnVsbCgiem5vZGUgZG9lc24ndCBleGlzdGVk\nIiwgc3RhdCk7CgogICAgICAgIGV4cGlyZVpvb0tlZXBlclNlc3Npb24oY2xp\nZW50LCB0aW1lb3V0KTsKICAgICAgICBsb2dnZXIuaW5mbygiR2V0IGRhdGEg\nZnJvbSB6bm9kZSAiICsgcGF0aCk7CiAgICAgICAgU3RhdCBuZXdTdGF0ID0g\nbmV3IFN0YXQoKTsKICAgICAgICBjbGllbnQuZ2V0RGF0YShwYXRoLCBmYWxz\nZSwgbmV3U3RhdCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyhzdGF0\nLCBuZXdTdGF0KTsKCiAgICAgICAgZXhwaXJlWm9vS2VlcGVyU2Vzc2lvbihj\nbGllbnQsIHRpbWVvdXQpOwogICAgICAgIGxvZ2dlci5pbmZvKCJDcmVhdGUg\nY2hpbGRyZW4gdW5kZXIgem5vZGUgIiArIHBhdGgpOwogICAgICAgIGNsaWVu\ndC5jcmVhdGUocGF0aCArICIvY2hpbGRyZW4iLCBkYXRhLCBJZHMuT1BFTl9B\nQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQpOwoKICAgICAgICBl\neHBpcmVab29LZWVwZXJTZXNzaW9uKGNsaWVudCwgdGltZW91dCk7CiAgICAg\nICAgTGlzdDxTdHJpbmc+IGNoaWxkcmVuID0gY2xpZW50LmdldENoaWxkcmVu\nKHBhdGgsIGZhbHNlLCBuZXdTdGF0KTsKICAgICAgICBBc3NlcnQuYXNzZXJ0\nRXF1YWxzKDEsIGNoaWxkcmVuLnNpemUoKSk7CiAgICAgICAgQXNzZXJ0LmFz\nc2VydEVxdWFscygiY2hpbGRyZW4iLCBjaGlsZHJlbi5nZXQoMCkpOwogICAg\nICAgIGxvZ2dlci5pbmZvKCJHZXQgY2hpbGRyZW4gdW5kZXIgem5vZGUgIiAr\nIHBhdGgpOwoKICAgICAgICBleHBpcmVab29LZWVwZXJTZXNzaW9uKGNsaWVu\ndCwgdGltZW91dCk7CiAgICAgICAgY2xpZW50LmRlbGV0ZShwYXRoICsgIi9j\naGlsZHJlbiIsIC0xKTsKICAgICAgICBsb2dnZXIuaW5mbygiRGVsZXRlIGNo\naWxkcmVuIGZyb20gem5vZGUgIiArIHBhdGgpOwogICAgfQoKICAgIEBUZXN0\nKHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmV0cnlPbkNy\nZWF0aW5nRXBoZW1lcmFsWm5vZGUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBmaW5hbCBpbnQgdGltZW91dCA9IDIwMDA7CiAgICAgICAgWm9vS2Vl\ncGVyQ2xpZW50IGNsaWVudCA9IFpvb0tlZXBlckNsaWVudC5jcmVhdGVDb25u\nZWN0ZWRab29LZWVwZXJDbGllbnQoCiAgICAgICAgICAgICAgICB6a1V0aWwu\nZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLCB0aW1lb3V0LCBuZXcgSGFz\naFNldDxXYXRjaGVyPigpLAogICAgICAgICAgICAgICAgbmV3IEJvdW5kRXhw\nb25lbnRpYWxCYWNrb2ZmUmV0cnlQb2xpY3kodGltZW91dCwgdGltZW91dCwg\nSW50ZWdlci5NQVhfVkFMVUUpCiAgICAgICAgICAgICAgICApOwogICAgICAg\nIEFzc2VydC5hc3NlcnRUcnVlKCJDbGllbnQgZmFpbGVkIHRvIGNvbm5lY3Qg\nYW4gYWxpdmUgWm9vS2VlcGVyLiIsCiAgICAgICAgICAgICAgICBjbGllbnQu\nZ2V0U3RhdGUoKS5pc0Nvbm5lY3RlZCgpKTsKCiAgICAgICAgU3RyaW5nIHBh\ndGggPSAiL2EiOwogICAgICAgIGJ5dGVbXSBkYXRhID0gInRlc3QiLmdldEJ5\ndGVzKCk7CgogICAgICAgIGxvZ2dlci5pbmZvKCJDcmVhdGUgem5vZGUgIiAr\nIHBhdGgpOwogICAgICAgIGNsaWVudC5jcmVhdGUocGF0aCwgZGF0YSwgSWRz\nLk9QRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5FUEhFTUVSQUwpOwogICAg\nICAgIGxvZ2dlci5pbmZvKCJDcmVhdGVkIHpub2RlICIgKyBwYXRoKTsKCiAg\nICAgICAgZXhwaXJlWm9vS2VlcGVyU2Vzc2lvbihjbGllbnQsIHRpbWVvdXQp\nOwogICAgICAgIGxvZ2dlci5pbmZvKCJDcmVhdGUgem5vZGUgdy8gbmV3IHNl\nc3Npb24gOiAiICsgcGF0aCk7CiAgICAgICAgY2xpZW50LmNyZWF0ZShwYXRo\nLCBkYXRhLCBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLkVQSEVN\nRVJBTCk7CiAgICAgICAgbG9nZ2VyLmluZm8oIkNyZWF0ZWQgem5vZGUgdy8g\nbmV3IHNlc3Npb24gOiAiICsgcGF0aCk7CiAgICB9CgogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZXRyeUFzeW5jT3Bl\ncmF0aW9ucygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZpbmFsIGlu\ndCB0aW1lb3V0ID0gMjAwMDsKICAgICAgICBab29LZWVwZXJDbGllbnQgY2xp\nZW50ID0gWm9vS2VlcGVyQ2xpZW50LmNyZWF0ZUNvbm5lY3RlZFpvb0tlZXBl\nckNsaWVudCgKICAgICAgICAgICAgICAgIHprVXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCksIHRpbWVvdXQsIG5ldyBIYXNoU2V0PFdhdGNoZXI+\nKCksCiAgICAgICAgICAgICAgICBuZXcgQm91bmRFeHBvbmVudGlhbEJhY2tv\nZmZSZXRyeVBvbGljeSh0aW1lb3V0LCB0aW1lb3V0LCBJbnRlZ2VyLk1BWF9W\nQUxVRSkKICAgICAgICAgICAgICAgICk7CiAgICAgICAgQXNzZXJ0LmFzc2Vy\ndFRydWUoIkNsaWVudCBmYWlsZWQgdG8gY29ubmVjdCBhbiBhbGl2ZSBab29L\nZWVwZXIuIiwKICAgICAgICAgICAgICAgIGNsaWVudC5nZXRTdGF0ZSgpLmlz\nQ29ubmVjdGVkKCkpOwoKICAgICAgICBTdHJpbmcgcGF0aCA9ICIvYSI7CiAg\nICAgICAgYnl0ZVtdIGRhdGEgPSAidGVzdCIuZ2V0Qnl0ZXMoKTsKCiAgICAg\nICAgZXhwaXJlWm9vS2VlcGVyU2Vzc2lvbihjbGllbnQsIHRpbWVvdXQpOwog\nICAgICAgIGxvZ2dlci5pbmZvKCJDcmVhdGUgem5vZGUgIiArIHBhdGgpOwog\nICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGNyZWF0ZUxhdGNoID0gbmV3\nIENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIGNsaWVudC5jcmVhdGUocGF0\naCwgZGF0YSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJT\nSVNURU5ULAogICAgICAgICAgICAgICAgbmV3IFN0cmluZ0NhbGxiYWNrKCkg\newoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0\nIGN0eCwgU3RyaW5nIG5hbWUpIHsKICAgICAgICAgICAgICAgIGlmIChLZWVw\nZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpID09IHJjKSB7CiAgICAg\nICAgICAgICAgICAgICAgY3JlYXRlTGF0Y2guY291bnREb3duKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgfSwgbnVsbCk7\nCiAgICAgICAgY3JlYXRlTGF0Y2guYXdhaXQoKTsKICAgICAgICBsb2dnZXIu\naW5mbygiQ3JlYXRlZCB6bm9kZSAiICsgcGF0aCk7CgogICAgICAgIGV4cGly\nZVpvb0tlZXBlclNlc3Npb24oY2xpZW50LCB0aW1lb3V0KTsKICAgICAgICBs\nb2dnZXIuaW5mbygiRXhpc3RzIHpub2RlICIgKyBwYXRoKTsKICAgICAgICBm\naW5hbCBDb3VudERvd25MYXRjaCBleGlzdHNMYXRjaCA9IG5ldyBDb3VudERv\nd25MYXRjaCgxKTsKICAgICAgICBjbGllbnQuZXhpc3RzKHBhdGgsIGZhbHNl\nLCBuZXcgU3RhdENhbGxiYWNrKCkgewoKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJj\nLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgU3RhdCBzdGF0KSB7CiAgICAg\nICAgICAgICAgICBpZiAoS2VlcGVyRXhjZXB0aW9uLkNvZGUuT0suaW50VmFs\ndWUoKSA9PSByYykgewogICAgICAgICAgICAgICAgICAgIGV4aXN0c0xhdGNo\nLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCgogICAgICAgIH0sIG51bGwpOwogICAgICAgIGV4aXN0c0xhdGNoLmF3YWl0\nKCk7CgogICAgICAgIGV4cGlyZVpvb0tlZXBlclNlc3Npb24oY2xpZW50LCB0\naW1lb3V0KTsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBnZXRMYXRj\naCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBsb2dnZXIuaW5m\nbygiR2V0IGRhdGEgZnJvbSB6bm9kZSAiICsgcGF0aCk7CiAgICAgICAgY2xp\nZW50LmdldERhdGEocGF0aCwgZmFsc2UsIG5ldyBEYXRhQ2FsbGJhY2soKSB7\nCgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZv\naWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3Qg\nY3R4LCBieXRlW10gZGF0YSwgU3RhdCBzdGF0KSB7CiAgICAgICAgICAgICAg\nICBpZiAoS2VlcGVyRXhjZXB0aW9uLkNvZGUuT0suaW50VmFsdWUoKSA9PSBy\nYykgewogICAgICAgICAgICAgICAgICAgIGdldExhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgIH0s\nIG51bGwpOwogICAgICAgIGdldExhdGNoLmF3YWl0KCk7CgogICAgICAgIGV4\ncGlyZVpvb0tlZXBlclNlc3Npb24oY2xpZW50LCB0aW1lb3V0KTsKICAgICAg\nICBsb2dnZXIuaW5mbygiQ3JlYXRlIGNoaWxkcmVuIHVuZGVyIHpub2RlICIg\nKyBwYXRoKTsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBjcmVhdGVD\naGlsZExhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIGNs\naWVudC5jcmVhdGUocGF0aCArICIvY2hpbGRyZW4iLCBkYXRhLCBJZHMuT1BF\nTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQsCiAgICAgICAg\nICAgICAgICBuZXcgU3RyaW5nQ2FsbGJhY2soKSB7CgogICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3Vs\ndChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBTdHJpbmcgbmFt\nZSkgewogICAgICAgICAgICAgICAgaWYgKEtlZXBlckV4Y2VwdGlvbi5Db2Rl\nLk9LLmludFZhbHVlKCkgPT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICBj\ncmVhdGVDaGlsZExhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CgogICAgICAgIH0sIG51bGwpOwogICAgICAgIGNy\nZWF0ZUNoaWxkTGF0Y2guYXdhaXQoKTsKCiAgICAgICAgZXhwaXJlWm9vS2Vl\ncGVyU2Vzc2lvbihjbGllbnQsIHRpbWVvdXQpOwogICAgICAgIGZpbmFsIENv\ndW50RG93bkxhdGNoIGdldENoaWxkTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0\nY2goMSk7CiAgICAgICAgZmluYWwgQXRvbWljUmVmZXJlbmNlPExpc3Q8U3Ry\naW5nPj4gY2hpbGRyZW4gPQogICAgICAgICAgICAgICAgbmV3IEF0b21pY1Jl\nZmVyZW5jZTxMaXN0PFN0cmluZz4+KCk7CiAgICAgICAgY2xpZW50LmdldENo\naWxkcmVuKHBhdGgsIGZhbHNlLCBuZXcgQ2hpbGRyZW4yQ2FsbGJhY2soKSB7\nCgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZv\naWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3Qg\nY3R4LCBMaXN0PFN0cmluZz4gY2hpbGRMaXN0LCBTdGF0IHN0YXQpIHsKICAg\nICAgICAgICAgICAgIGlmIChLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRW\nYWx1ZSgpID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4u\nc2V0KGNoaWxkTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgZ2V0Q2hpbGRM\nYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQoKICAgICAgICB9LCBudWxsKTsKICAgICAgICBnZXRDaGlsZExhdGNo\nLmF3YWl0KCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydE5vdE51bGwoY2hpbGRy\nZW4uZ2V0KCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMoMSwgY2hp\nbGRyZW4uZ2V0KCkuc2l6ZSgpKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1\nYWxzKCJjaGlsZHJlbiIsIGNoaWxkcmVuLmdldCgpLmdldCgwKSk7CiAgICAg\nICAgbG9nZ2VyLmluZm8oIkdldCBjaGlsZHJlbiB1bmRlciB6bm9kZSAiICsg\ncGF0aCk7CgogICAgICAgIGV4cGlyZVpvb0tlZXBlclNlc3Npb24oY2xpZW50\nLCB0aW1lb3V0KTsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBkZWxl\ndGVDaGlsZExhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAg\nIGNsaWVudC5kZWxldGUocGF0aCArICIvY2hpbGRyZW4iLCAtMSwgbmV3IFZv\naWRDYWxsYmFjaygpIHsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5n\nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgIGlmIChLZWVw\nZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpID09IHJjKSB7CiAgICAg\nICAgICAgICAgICAgICAgZGVsZXRlQ2hpbGRMYXRjaC5jb3VudERvd24oKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICB9LCBu\ndWxsKTsKICAgICAgICBkZWxldGVDaGlsZExhdGNoLmF3YWl0KCk7CiAgICAg\nICAgbG9nZ2VyLmluZm8oIkRlbGV0ZSBjaGlsZHJlbiBmcm9tIHpub2RlICIg\nKyBwYXRoKTsKICAgIH0KCn0K\n","encoding":"base64"}

