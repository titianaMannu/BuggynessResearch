{"sha":"7d2453aa29d477dd823ec0bbeb5a183e3efce531","node_id":"MDQ6QmxvYjE1NzU5NTY6N2QyNDUzYWEyOWQ0NzdkZDgyM2VjMGJiZWI1YTE4M2UzZWZjZTUzMQ==","size":23018,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7d2453aa29d477dd823ec0bbeb5a183e3efce531","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHk7CgppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5jbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3JpYmVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuY2xpZW50LmNvbmYuQ2xpZW50Q29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5kYXRhLlB1YlN1\nYkRhdGE7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuZGF0YS5U\nb3BpY1N1YnNjcmliZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGll\nbnQuZXhjZXB0aW9ucy5BbHJlYWR5U3RhcnREZWxpdmVyeUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5leGNlcHRpb25zLklu\ndmFsaWRTdWJzY3JpYmVySWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5jbGllbnQuaGFuZGxlcnMuUHViU3ViQ2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuaGFuZGxlcnMuU3Vic2NyaWJl\nUmVzcG9uc2VIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZmls\ndGVyLkNsaWVudE1lc3NhZ2VGaWx0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLkNsaWVu\ndEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb24uQ2xpZW50Tm90\nU3Vic2NyaWJlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLkNvdWxkTm90Q29ubmVjdEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMu\nUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZTsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlc3BvbnNlQm9k\neTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnM7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1\nZXN0LkNyZWF0ZU9yQXR0YWNoOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9leHRlbnNpb25zLlN1YnNjcmlwdGlvblN0YXRlVXRpbHM7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcudXRpbC5TdWJzY3JpcHRpb25MaXN0ZW5lcjsKCi8q\nKgogKiBUaGlzIGlzIHRoZSBIZWR3aWcgTmV0dHkgc3BlY2lmaWMgaW1wbGVt\nZW50YXRpb24gb2YgdGhlIFN1YnNjcmliZXIgaW50ZXJmYWNlLgogKgogKi8K\nQFN1cHByZXNzV2FybmluZ3MoImRlcHJlY2F0aW9uIikgLy8gc28gdGhhdCB3\nZSBjYW4gaW1wbGVtZW50ZWQgdGhlIERlcHJlY2F0ZWQgc3Vic2NyaWJlIG1l\ndGhvZHMgd2l0aG91dCBhIHdhcm5pbmcKcHVibGljIGNsYXNzIEhlZHdpZ1N1\nYnNjcmliZXIgaW1wbGVtZW50cyBTdWJzY3JpYmVyIHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dn\nZXIoSGVkd2lnU3Vic2NyaWJlci5jbGFzcyk7CgogICAgcHJvdGVjdGVkIGZp\nbmFsIENsaWVudENvbmZpZ3VyYXRpb24gY2ZnOwogICAgcHJvdGVjdGVkIGZp\nbmFsIEhDaGFubmVsTWFuYWdlciBjaGFubmVsTWFuYWdlcjsKCiAgICBwdWJs\naWMgSGVkd2lnU3Vic2NyaWJlcihIZWR3aWdDbGllbnRJbXBsIGNsaWVudCkg\newogICAgICAgIHRoaXMuY2ZnID0gY2xpZW50LmdldENvbmZpZ3VyYXRpb24o\nKTsKICAgICAgICB0aGlzLmNoYW5uZWxNYW5hZ2VyID0gY2xpZW50LmdldEhD\naGFubmVsTWFuYWdlcigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFkZFN1\nYnNjcmlwdGlvbkxpc3RlbmVyKFN1YnNjcmlwdGlvbkxpc3RlbmVyIGxpc3Rl\nbmVyKSB7CiAgICAgICAgY2hhbm5lbE1hbmFnZXIuZ2V0U3Vic2NyaXB0aW9u\nRXZlbnRFbWl0dGVyKCkKICAgICAgICAgICAgICAgICAgICAgIC5hZGRTdWJz\nY3JpcHRpb25MaXN0ZW5lcihsaXN0ZW5lcik7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVtb3ZlU3Vic2NyaXB0aW9uTGlzdGVuZXIoU3Vic2NyaXB0aW9u\nTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICBjaGFubmVsTWFuYWdlci5n\nZXRTdWJzY3JpcHRpb25FdmVudEVtaXR0ZXIoKQogICAgICAgICAgICAgICAg\nICAgICAgLnJlbW92ZVN1YnNjcmlwdGlvbkxpc3RlbmVyKGxpc3RlbmVyKTsK\nICAgIH0KCiAgICAvLyBQcml2YXRlIG1ldGhvZCB0aGF0IGhvbGRzIHRoZSBj\nb21tb24gbG9naWMgZm9yIGRvaW5nIHN5bmNocm9ub3VzCiAgICAvLyBTdWJz\nY3JpYmUgb3IgVW5zdWJzY3JpYmUgcmVxdWVzdHMuIFRoaXMgaXMgZm9yIGNv\nZGUgcmV1c2Ugc2luY2UgdGhlc2UKICAgIC8vIHR3byBmbG93cyBhcmUgdmVy\neSBzaW1pbGFyLiBUaGUgYXNzdW1wdGlvbiBpcyB0aGF0IHRoZSBpbnB1dAog\nICAgLy8gT3BlcmF0aW9uVHlwZSBpcyBlaXRoZXIgU1VCU0NSSUJFIG9yIFVO\nU1VCU0NSSUJFLgogICAgcHJpdmF0ZSB2b2lkIHN1YlVuc3ViKEJ5dGVTdHJp\nbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBPcGVyYXRpb25U\neXBlIG9wZXJhdGlvblR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zKQogICAgICAgICAgICB0aHJv\nd3MgQ291bGROb3RDb25uZWN0RXhjZXB0aW9uLCBDbGllbnRBbHJlYWR5U3Vi\nc2NyaWJlZEV4Y2VwdGlvbiwKICAgICAgICBDbGllbnROb3RTdWJzY3JpYmVk\nRXhjZXB0aW9uLCBTZXJ2aWNlRG93bkV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIFN0cmlu\nZ0J1aWxkZXIgZGVidWdNc2cgPSBuZXcgU3RyaW5nQnVpbGRlcigpLmFwcGVu\nZCgiQ2FsbGluZyBhIHN5bmMgc3ViVW5zdWIgcmVxdWVzdCBmb3IgdG9waWM6\nICIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBw\nZW5kKHRvcGljLnRvU3RyaW5nVXRmOCgpKS5hcHBlbmQoIiwgc3Vic2NyaWJl\ncklkOiAiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLmFwcGVuZChzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkpLmFwcGVuZCgi\nLCBvcGVyYXRpb25UeXBlOiAiKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLmFwcGVuZChvcGVyYXRpb25UeXBlKTsKICAgICAgICAg\nICAgaWYgKG51bGwgIT0gb3B0aW9ucykgewogICAgICAgICAgICAgICAgZGVi\ndWdNc2cuYXBwZW5kKCIsIGNyZWF0ZU9yQXR0YWNoOiAiKS5hcHBlbmQob3B0\naW9ucy5nZXRDcmVhdGVPckF0dGFjaCgpKQogICAgICAgICAgICAgICAgICAg\nICAgICAuYXBwZW5kKCIsIG1lc3NhZ2VCb3VuZDogIikuYXBwZW5kKG9wdGlv\nbnMuZ2V0TWVzc2FnZUJvdW5kKCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGxvZ2dlci5kZWJ1ZyhkZWJ1Z01zZy50b1N0cmluZygpKTsKICAgICAg\nICB9CiAgICAgICAgUHViU3ViRGF0YSBwdWJTdWJEYXRhID0gbmV3IFB1YlN1\nYkRhdGEodG9waWMsIG51bGwsIHN1YnNjcmliZXJJZCwgb3BlcmF0aW9uVHlw\nZSwgb3B0aW9ucywgbnVsbCwgbnVsbCk7CiAgICAgICAgc3luY2hyb25pemVk\nIChwdWJTdWJEYXRhKSB7CiAgICAgICAgICAgIFB1YlN1YkNhbGxiYWNrIHB1\nYlN1YkNhbGxiYWNrID0gbmV3IFB1YlN1YkNhbGxiYWNrKHB1YlN1YkRhdGEp\nOwogICAgICAgICAgICBhc3luY1N1YlVuc3ViKHRvcGljLCBzdWJzY3JpYmVy\nSWQsIHB1YlN1YkNhbGxiYWNrLCBudWxsLCBvcGVyYXRpb25UeXBlLCBvcHRp\nb25zKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdoaWxl\nICghcHViU3ViRGF0YS5pc0RvbmUpCiAgICAgICAgICAgICAgICAgICAgcHVi\nU3ViRGF0YS53YWl0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVw\ndGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBT\nZXJ2aWNlRG93bkV4Y2VwdGlvbigiSW50ZXJydXB0ZWQgRXhjZXB0aW9uIHdo\naWxlIHdhaXRpbmcgZm9yIGFzeW5jIHN1YlVuc3ViIGNhbGwiKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICAvLyBDaGVjayBmcm9tIHRoZSBQdWJTdWJD\nYWxsYmFjayBpZiBpdCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QuCiAgICAgICAg\nICAgIGlmICghcHViU3ViQ2FsbGJhY2suZ2V0SXNDYWxsU3VjY2Vzc2Z1bCgp\nKSB7CiAgICAgICAgICAgICAgICAvLyBTZWUgd2hhdCB0aGUgZXhjZXB0aW9u\nIHdhcyB0aGF0IHdhcyB0aHJvd24gd2hlbiB0aGUgb3BlcmF0aW9uCiAgICAg\nICAgICAgICAgICAvLyBmYWlsZWQuCiAgICAgICAgICAgICAgICBQdWJTdWJF\neGNlcHRpb24gZmFpbHVyZUV4Y2VwdGlvbiA9IHB1YlN1YkNhbGxiYWNrLmdl\ndEZhaWx1cmVFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIGlmIChmYWls\ndXJlRXhjZXB0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAv\nLyBUaGlzIHNob3VsZCBub3QgaGFwcGVuIGFzIHRoZSBvcGVyYXRpb24gZmFp\nbGVkIGJ1dCBhIG51bGwKICAgICAgICAgICAgICAgICAgICAvLyBQdWJTdWJF\neGNlcHRpb24gd2FzIHBhc3NlZC4gTG9nIGEgd2FybmluZyBtZXNzYWdlIGJ1\ndAogICAgICAgICAgICAgICAgICAgIC8vIHRocm93IGEgZ2VuZXJpYyBTZXJ2\naWNlRG93bkV4Y2VwdGlvbi4KICAgICAgICAgICAgICAgICAgICBsb2dnZXIu\nZXJyb3IoIlN5bmMgU3ViVW5zdWIgb3BlcmF0aW9uIGZhaWxlZCBidXQgbm8g\nUHViU3ViRXhjZXB0aW9uIHdhcyBwYXNzZWQhIik7CiAgICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IFNlcnZpY2VEb3duRXhjZXB0aW9uKCJTZXJ2ZXIg\nYWNrIHJlc3BvbnNlIHRvIFN1YlVuc3ViIHJlcXVlc3QgaXMgbm90IHN1Y2Nl\nc3NmdWwiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8v\nIEZvciB0aGUgZXhwZWN0ZWQgZXhjZXB0aW9ucyB0aGF0IGNvdWxkIG9jY3Vy\nLCBqdXN0IHJldGhyb3cKICAgICAgICAgICAgICAgIC8vIHRoZW0uCiAgICAg\nICAgICAgICAgICBlbHNlIGlmIChmYWlsdXJlRXhjZXB0aW9uIGluc3RhbmNl\nb2YgQ291bGROb3RDb25uZWN0RXhjZXB0aW9uKQogICAgICAgICAgICAgICAg\nICAgIHRocm93IChDb3VsZE5vdENvbm5lY3RFeGNlcHRpb24pIGZhaWx1cmVF\neGNlcHRpb247CiAgICAgICAgICAgICAgICBlbHNlIGlmIChmYWlsdXJlRXhj\nZXB0aW9uIGluc3RhbmNlb2YgQ2xpZW50QWxyZWFkeVN1YnNjcmliZWRFeGNl\ncHRpb24pCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgKENsaWVudEFscmVh\nZHlTdWJzY3JpYmVkRXhjZXB0aW9uKSBmYWlsdXJlRXhjZXB0aW9uOwogICAg\nICAgICAgICAgICAgZWxzZSBpZiAoZmFpbHVyZUV4Y2VwdGlvbiBpbnN0YW5j\nZW9mIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24pCiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgKENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24p\nIGZhaWx1cmVFeGNlcHRpb247CiAgICAgICAgICAgICAgICBlbHNlIGlmIChm\nYWlsdXJlRXhjZXB0aW9uIGluc3RhbmNlb2YgU2VydmljZURvd25FeGNlcHRp\nb24pCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgKFNlcnZpY2VEb3duRXhj\nZXB0aW9uKSBmYWlsdXJlRXhjZXB0aW9uOwogICAgICAgICAgICAgICAgZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJVbmV4cGVj\ndGVkIFB1YlN1YkV4Y2VwdGlvbiB0aHJvd246ICIsIGZhaWx1cmVFeGNlcHRp\nb24pOwogICAgICAgICAgICAgICAgICAgIC8vIFRocm93IGEgZ2VuZXJpYyBT\nZXJ2aWNlRG93bkV4Y2VwdGlvbiBidXQgd3JhcCB0aGUKICAgICAgICAgICAg\nICAgICAgICAvLyBvcmlnaW5hbCBQdWJTdWJFeGNlcHRpb24gd2l0aGluIGl0\nLgogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBTZXJ2aWNlRG93bkV4\nY2VwdGlvbihmYWlsdXJlRXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBQcml2YXRl\nIG1ldGhvZCB0aGF0IGhvbGRzIHRoZSBjb21tb24gbG9naWMgZm9yIGRvaW5n\nIGFzeW5jaHJvbm91cwogICAgLy8gU3Vic2NyaWJlIG9yIFVuc3Vic2NyaWJl\nIHJlcXVlc3RzLiBUaGlzIGlzIGZvciBjb2RlIHJldXNlIHNpbmNlIHRoZXNl\nIHR3bwogICAgLy8gZmxvd3MgYXJlIHZlcnkgc2ltaWxhci4gVGhlIGFzc3Vt\ncHRpb24gaXMgdGhhdCB0aGUgaW5wdXQgT3BlcmF0aW9uVHlwZSBpcwogICAg\nLy8gZWl0aGVyIFNVQlNDUklCRSBvciBVTlNVQlNDUklCRS4KICAgIHByaXZh\ndGUgdm9pZCBhc3luY1N1YlVuc3ViKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgQ2FsbGJhY2s8UmVzcG9uc2VCb2R5PiBjYWxsYmFjaywgT2JqZWN0\nIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBPcGVy\nYXRpb25UeXBlIG9wZXJhdGlvblR5cGUsIFN1YnNjcmlwdGlvbk9wdGlvbnMg\nb3B0aW9ucykgewogICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQo\nKSkgewogICAgICAgICAgICBTdHJpbmdCdWlsZGVyIGRlYnVnTXNnID0gbmV3\nIFN0cmluZ0J1aWxkZXIoKS5hcHBlbmQoIkNhbGxpbmcgYSBhc3luYyBzdWJV\nbnN1YiByZXF1ZXN0IGZvciB0b3BpYzogIikKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC5hcHBlbmQodG9waWMudG9TdHJpbmdVdGY4\nKCkpLmFwcGVuZCgiLCBzdWJzY3JpYmVySWQ6ICIpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKHN1YnNjcmliZXJJZC50\nb1N0cmluZ1V0ZjgoKSkuYXBwZW5kKCIsIG9wZXJhdGlvblR5cGU6ICIpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKG9w\nZXJhdGlvblR5cGUpOwogICAgICAgICAgICBpZiAobnVsbCAhPSBvcHRpb25z\nKSB7CiAgICAgICAgICAgICAgICBkZWJ1Z01zZy5hcHBlbmQoIiwgY3JlYXRl\nT3JBdHRhY2g6ICIpLmFwcGVuZChvcHRpb25zLmdldENyZWF0ZU9yQXR0YWNo\nKCkpCiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoIiwgbWVzc2Fn\nZUJvdW5kOiAiKS5hcHBlbmQob3B0aW9ucy5nZXRNZXNzYWdlQm91bmQoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGRlYnVn\nTXNnLnRvU3RyaW5nKCkpOwogICAgICAgIH0KICAgICAgICBpZiAoT3BlcmF0\naW9uVHlwZS5TVUJTQ1JJQkUuZXF1YWxzKG9wZXJhdGlvblR5cGUpKSB7CiAg\nICAgICAgICAgIGlmIChvcHRpb25zLmdldE1lc3NhZ2VCb3VuZCgpIDw9IDAg\nJiYKICAgICAgICAgICAgICAgIGNmZy5nZXRTdWJzY3JpcHRpb25NZXNzYWdl\nQm91bmQoKSA+IDApIHsKICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvbk9w\ndGlvbnMuQnVpbGRlciBzb0J1aWxkZXIgPQogICAgICAgICAgICAgICAgICAg\nIFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcihvcHRpb25zKS5zZXRN\nZXNzYWdlQm91bmQoCiAgICAgICAgICAgICAgICAgICAgICAgIGNmZy5nZXRT\ndWJzY3JpcHRpb25NZXNzYWdlQm91bmQoKSk7CiAgICAgICAgICAgICAgICBv\ncHRpb25zID0gc29CdWlsZGVyLmJ1aWxkKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgUHViU3ViRGF0YSBwdWJTdWJEYXRhID0gbmV3IFB1\nYlN1YkRhdGEodG9waWMsIG51bGwsIHN1YnNjcmliZXJJZCwgb3BlcmF0aW9u\nVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBvcHRpb25zLCBjYWxsYmFjaywgY29udGV4dCk7CiAgICAgICAg\nY2hhbm5lbE1hbmFnZXIuc3VibWl0T3AocHViU3ViRGF0YSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkLCBDcmVhdGVPckF0dGFjaCBtb2RlKQog\nICAgICAgICAgICB0aHJvd3MgQ291bGROb3RDb25uZWN0RXhjZXB0aW9uLCBD\nbGllbnRBbHJlYWR5U3Vic2NyaWJlZEV4Y2VwdGlvbiwgU2VydmljZURvd25F\neGNlcHRpb24sCiAgICAgICAgSW52YWxpZFN1YnNjcmliZXJJZEV4Y2VwdGlv\nbiB7CiAgICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zID0gU3Vi\nc2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkuc2V0Q3JlYXRlT3JBdHRh\nY2gobW9kZSkuYnVpbGQoKTsKICAgICAgICBzdWJzY3JpYmUodG9waWMsIHN1\nYnNjcmliZXJJZCwgb3B0aW9ucywgZmFsc2UpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHN1YnNjcmliZShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5n\nIHN1YnNjcmliZXJJZCwgU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zKQog\nICAgICAgICAgICB0aHJvd3MgQ291bGROb3RDb25uZWN0RXhjZXB0aW9uLCBD\nbGllbnRBbHJlYWR5U3Vic2NyaWJlZEV4Y2VwdGlvbiwgU2VydmljZURvd25F\neGNlcHRpb24sCiAgICAgICAgIEludmFsaWRTdWJzY3JpYmVySWRFeGNlcHRp\nb24gewogICAgICAgIHN1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklkLCBv\ncHRpb25zLCBmYWxzZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgc3Vi\nc2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkLCBTdWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnMsIGJvb2xlYW4gaXNI\ndWIpCiAgICAgICAgICAgIHRocm93cyBDb3VsZE5vdENvbm5lY3RFeGNlcHRp\nb24sIENsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uLCBTZXJ2aWNl\nRG93bkV4Y2VwdGlvbiwKICAgICAgICBJbnZhbGlkU3Vic2NyaWJlcklkRXhj\nZXB0aW9uIHsKICAgICAgICAvLyBWYWxpZGF0ZSB0aGF0IHRoZSBmb3JtYXQg\nb2YgdGhlIHN1YnNjcmliZXJJZCBpcyB2YWxpZCBlaXRoZXIgYXMgYQogICAg\nICAgIC8vIGxvY2FsIG9yIGh1YiBzdWJzY3JpYmVyLgogICAgICAgIGlmICgh\naXNWYWxpZFN1YnNjcmliZXJJZChzdWJzY3JpYmVySWQsIGlzSHViKSkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgSW52YWxpZFN1YnNjcmliZXJJZEV4Y2Vw\ndGlvbigiU3Vic2NyaWJlcklkIHBhc3NlZCBpcyBub3QgdmFsaWQ6ICIgKyBz\ndWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBpc0h1Yjog\nIiArIGlzSHViKTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgc3ViVW5zdWIodG9waWMsIHN1YnNjcmliZXJJZCwgT3BlcmF0aW9uVHlw\nZS5TVUJTQ1JJQkUsIG9wdGlvbnMpOwogICAgICAgIH0gY2F0Y2ggKENsaWVu\ndE5vdFN1YnNjcmliZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBsb2dn\nZXIuZXJyb3IoIlVuZXhwZWN0ZWQgRXhjZXB0aW9uIHRocm93bjogIiwgZSk7\nCiAgICAgICAgICAgIC8vIFRoaXMgZXhjZXB0aW9uIHNob3VsZCBuZXZlciBi\nZSB0aHJvd24gaGVyZS4gQnV0IGp1c3QgaW4gY2FzZSwKICAgICAgICAgICAg\nLy8gdGhyb3cgYSBnZW5lcmljIFNlcnZpY2VEb3duRXhjZXB0aW9uIGJ1dCB3\ncmFwIHRoZSBvcmlnaW5hbAogICAgICAgICAgICAvLyBFeGNlcHRpb24gd2l0\naGluIGl0LgogICAgICAgICAgICB0aHJvdyBuZXcgU2VydmljZURvd25FeGNl\ncHRpb24oZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFz\neW5jU3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vi\nc2NyaWJlcklkLCBDcmVhdGVPckF0dGFjaCBtb2RlLCBDYWxsYmFjazxWb2lk\nPiBjYWxsYmFjaywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9i\namVjdCBjb250ZXh0KSB7CiAgICAgICAgU3Vic2NyaXB0aW9uT3B0aW9ucyBv\ncHRpb25zID0gU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkuc2V0\nQ3JlYXRlT3JBdHRhY2gobW9kZSkuYnVpbGQoKTsKICAgICAgICBhc3luY1N1\nYnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklkLCBvcHRpb25zLCBjYWxsYmFj\naywgY29udGV4dCwgZmFsc2UpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFz\neW5jU3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vi\nc2NyaWJlcklkLCBTdWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnMsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBjYWxs\nYmFjaywgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBhc3luY1N1YnNjcmli\nZSh0b3BpYywgc3Vic2NyaWJlcklkLCBvcHRpb25zLCBjYWxsYmFjaywgY29u\ndGV4dCwgZmFsc2UpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFzeW5j\nU3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2Ny\naWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3Vi\nc2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVj\ndCBjb250ZXh0LCBib29sZWFuIGlzSHViKSB7CiAgICAgICAgLy8gVmFsaWRh\ndGUgdGhhdCB0aGUgZm9ybWF0IG9mIHRoZSBzdWJzY3JpYmVySWQgaXMgdmFs\naWQgZWl0aGVyIGFzIGEKICAgICAgICAvLyBsb2NhbCBvciBodWIgc3Vic2Ny\naWJlci4KICAgICAgICBpZiAoIWlzVmFsaWRTdWJzY3JpYmVySWQoc3Vic2Ny\naWJlcklkLCBpc0h1YikpIHsKICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0\naW9uRmFpbGVkKGNvbnRleHQsIG5ldyBTZXJ2aWNlRG93bkV4Y2VwdGlvbihu\nZXcgSW52YWxpZFN1YnNjcmliZXJJZEV4Y2VwdGlvbigKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiU3Vic2NyaWJlcklkIHBh\nc3NlZCBpcyBub3QgdmFsaWQ6ICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdV\ndGY4KCkgKyAiLCBpc0h1YjogIiArIGlzSHViKSkpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQogICAgICAgIGFzeW5jU3ViVW5zdWIodG9waWMs\nIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgICAgICAgICAgIG5ldyBWb2lk\nQ2FsbGJhY2tBZGFwdGVyPFJlc3BvbnNlQm9keT4oY2FsbGJhY2spLCBjb250\nZXh0LAogICAgICAgICAgICAgICAgICAgICAgT3BlcmF0aW9uVHlwZS5TVUJT\nQ1JJQkUsIG9wdGlvbnMpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVuc3Vi\nc2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkKSB0aHJvd3MgQ291bGROb3RDb25uZWN0RXhjZXB0aW9uLAogICAgICAg\nIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24sIFNlcnZpY2VEb3duRXhj\nZXB0aW9uLCBJbnZhbGlkU3Vic2NyaWJlcklkRXhjZXB0aW9uIHsKICAgICAg\nICB1bnN1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklkLCBmYWxzZSk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgdW5zdWJzY3JpYmUoQnl0ZVN0cmlu\nZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIGJvb2xlYW4gaXNI\ndWIpCiAgICAgICAgICAgIHRocm93cyBDb3VsZE5vdENvbm5lY3RFeGNlcHRp\nb24sIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24sIFNlcnZpY2VEb3du\nRXhjZXB0aW9uLAogICAgICAgIEludmFsaWRTdWJzY3JpYmVySWRFeGNlcHRp\nb24gewogICAgICAgIC8vIFZhbGlkYXRlIHRoYXQgdGhlIGZvcm1hdCBvZiB0\naGUgc3Vic2NyaWJlcklkIGlzIHZhbGlkIGVpdGhlciBhcyBhCiAgICAgICAg\nLy8gbG9jYWwgb3IgaHViIHN1YnNjcmliZXIuCiAgICAgICAgaWYgKCFpc1Zh\nbGlkU3Vic2NyaWJlcklkKHN1YnNjcmliZXJJZCwgaXNIdWIpKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Vic2NyaWJlcklkRXhjZXB0aW9u\nKCJTdWJzY3JpYmVySWQgcGFzc2VkIGlzIG5vdCB2YWxpZDogIiArIHN1YnNj\ncmliZXJJZC50b1N0cmluZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIsIGlzSHViOiAiICsg\naXNIdWIpOwogICAgICAgIH0KICAgICAgICAvLyBTeW5jaHJvbm91c2x5IGNs\nb3NlIHRoZSBzdWJzY3JpcHRpb24gb24gdGhlIGNsaWVudCBzaWRlLiBFdmVu\nCiAgICAgICAgLy8gaWYgdGhlIHVuc3Vic2NyaWJlIHJlcXVlc3QgdG8gdGhl\nIHNlcnZlciBlcnJvcnMgb3V0LCB3ZSB3b24ndCBiZQogICAgICAgIC8vIGRl\nbGl2ZXJpbmcgbWVzc2FnZXMgZm9yIHRoaXMgc3Vic2NyaXB0aW9uIHRvIHRo\nZSBjbGllbnQuIFRoZSBjbGllbnQKICAgICAgICAvLyBjYW4gbGF0ZXIgcmV0\ncnkgdGhlIHVuc3Vic2NyaWJlIHJlcXVlc3QgdG8gdGhlIHNlcnZlciBzbyB0\naGV5IGFyZQogICAgICAgIC8vICJmdWxseSIgdW5zdWJzY3JpYmVkIGZyb20g\ndGhlIGdpdmVuIHRvcGljLgogICAgICAgIGNsb3NlU3Vic2NyaXB0aW9uKHRv\ncGljLCBzdWJzY3JpYmVySWQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHN1YlVuc3ViKHRvcGljLCBzdWJzY3JpYmVySWQsIE9wZXJhdGlvblR5cGUu\nVU5TVUJTQ1JJQkUsIG51bGwpOwogICAgICAgIH0gY2F0Y2ggKENsaWVudEFs\ncmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJVbmV4cGVjdGVkIEV4Y2VwdGlvbiB0aHJvd246ICIsIGUp\nOwogICAgICAgICAgICAvLyBUaGlzIGV4Y2VwdGlvbiBzaG91bGQgbmV2ZXIg\nYmUgdGhyb3duIGhlcmUuIEJ1dCBqdXN0IGluIGNhc2UsCiAgICAgICAgICAg\nIC8vIHRocm93IGEgZ2VuZXJpYyBTZXJ2aWNlRG93bkV4Y2VwdGlvbiBidXQg\nd3JhcCB0aGUgb3JpZ2luYWwKICAgICAgICAgICAgLy8gRXhjZXB0aW9uIHdp\ndGhpbiBpdC4KICAgICAgICAgICAgdGhyb3cgbmV3IFNlcnZpY2VEb3duRXhj\nZXB0aW9uKGUpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBh\nc3luY1Vuc3Vic2NyaWJlKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFs\nIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywg\nZmluYWwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBkb0FzeW5jVW5zdWJz\nY3JpYmUodG9waWMsIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbmV3IFZvaWRDYWxsYmFja0FkYXB0ZXI8UmVzcG9uc2VCb2R5\nPihjYWxsYmFjayksCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRl\neHQsIGZhbHNlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCBhc3luY1Vu\nc3Vic2NyaWJlKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgZmlu\nYWwgT2JqZWN0IGNvbnRleHQsIGJvb2xlYW4gaXNIdWIpIHsKICAgICAgICBk\nb0FzeW5jVW5zdWJzY3JpYmUodG9waWMsIHN1YnNjcmliZXJJZCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbmV3IFZvaWRDYWxsYmFja0FkYXB0ZXI8\nUmVzcG9uc2VCb2R5PihjYWxsYmFjayksCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNvbnRleHQsIGlzSHViKTsKICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgZG9Bc3luY1Vuc3Vic2NyaWJlKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMs\nIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBDYWxsYmFjazxSZXNwb25z\nZUJvZHk+IGNhbGxiYWNrLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBmaW5hbCBPYmplY3QgY29udGV4dCwgYm9vbGVhbiBpc0h1Yikg\newogICAgICAgIC8vIFZhbGlkYXRlIHRoYXQgdGhlIGZvcm1hdCBvZiB0aGUg\nc3Vic2NyaWJlcklkIGlzIHZhbGlkIGVpdGhlciBhcyBhCiAgICAgICAgLy8g\nbG9jYWwgb3IgaHViIHN1YnNjcmliZXIuCiAgICAgICAgaWYgKCFpc1ZhbGlk\nU3Vic2NyaWJlcklkKHN1YnNjcmliZXJJZCwgaXNIdWIpKSB7CiAgICAgICAg\nICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjb250ZXh0LCBuZXcgU2Vy\ndmljZURvd25FeGNlcHRpb24obmV3IEludmFsaWRTdWJzY3JpYmVySWRFeGNl\ncHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIlN1YnNjcmliZXJJZCBwYXNzZWQgaXMgbm90IHZhbGlkOiAiICsgc3Vi\nc2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpICsgIiwgaXNIdWI6ICIgKyBpc0h1\nYikpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAv\nLyBBc3luY2hyb25vdXNseSBjbG9zZSB0aGUgc3Vic2NyaXB0aW9uLiBPbiB0\naGUgY2FsbGJhY2sgdG8gdGhhdAogICAgICAgIC8vIG9wZXJhdGlvbiBvbmNl\nIGl0IGNvbXBsZXRlcywgcG9zdCB0aGUgYXN5bmMgdW5zdWJzY3JpYmUgcmVx\ndWVzdC4KICAgICAgICBkb0FzeW5jQ2xvc2VTdWJzY3JpcHRpb24odG9waWMs\nIHN1YnNjcmliZXJJZCwgbmV3IENhbGxiYWNrPFJlc3BvbnNlQm9keT4oKSB7\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBSZXNwb25zZUJvZHkg\ncmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgICAgIGFzeW5jU3Vi\nVW5zdWIodG9waWMsIHN1YnNjcmliZXJJZCwgY2FsbGJhY2ssIGNvbnRleHQs\nIE9wZXJhdGlvblR5cGUuVU5TVUJTQ1JJQkUsIG51bGwpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2Vw\ndGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9w\nZXJhdGlvbkZhaWxlZChjb250ZXh0LCBleGNlcHRpb24pOwogICAgICAgICAg\nICB9CiAgICAgICAgfSwgbnVsbCk7CiAgICB9CgogICAgLy8gVGhpcyBpcyBh\nIGhlbHBlciBtZXRob2QgdG8gZGV0ZXJtaW5lIGlmIGEgc3Vic2NyaWJlcklk\nIGlzIHZhbGlkIGFzIGVpdGhlcgogICAgLy8gYSBodWIgb3IgbG9jYWwgc3Vi\nc2NyaWJlcgogICAgcHJpdmF0ZSBib29sZWFuIGlzVmFsaWRTdWJzY3JpYmVy\nSWQoQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIGJvb2xlYW4gaXNIdWIpIHsK\nICAgICAgICBpZiAoKGlzSHViICYmICFTdWJzY3JpcHRpb25TdGF0ZVV0aWxz\nLmlzSHViU3Vic2NyaWJlcihzdWJzY3JpYmVySWQpKQogICAgICAgICAgICAg\nICAgfHwgKCFpc0h1YiAmJiBTdWJzY3JpcHRpb25TdGF0ZVV0aWxzLmlzSHVi\nU3Vic2NyaWJlcihzdWJzY3JpYmVySWQpKSkKICAgICAgICAgICAgcmV0dXJu\nIGZhbHNlOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgY29uc3VtZShCeXRlU3RyaW5nIHRv\ncGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgTWVzc2FnZVNlcUlkIG1l\nc3NhZ2VTZXFJZCkKICAgICAgICAgICAgdGhyb3dzIENsaWVudE5vdFN1YnNj\ncmliZWRFeGNlcHRpb24gewogICAgICAgIFRvcGljU3Vic2NyaWJlciB0b3Bp\nY1N1YnNjcmliZXIgPSBuZXcgVG9waWNTdWJzY3JpYmVyKHRvcGljLCBzdWJz\nY3JpYmVySWQpOwogICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2FsbGluZyBjb25z\ndW1lIGZvciB7fSwgbWVzc2FnZVNlcUlkOiB7fS4iLAogICAgICAgICAgICAg\nICAgICAgICB0b3BpY1N1YnNjcmliZXIsIG1lc3NhZ2VTZXFJZCk7CgogICAg\nICAgIFN1YnNjcmliZVJlc3BvbnNlSGFuZGxlciBzdWJzY3JpYmVSZXNwb25z\nZUhhbmRsZXIgPQogICAgICAgICAgICBjaGFubmVsTWFuYWdlci5nZXRTdWJz\nY3JpYmVSZXNwb25zZUhhbmRsZXIodG9waWNTdWJzY3JpYmVyKTsKICAgICAg\nICAvLyBDaGVjayB0aGF0IHRoaXMgdG9waWMgc3Vic2NyaXB0aW9uIG9uIHRo\nZSBjbGllbnQgc2lkZSBleGlzdHMuCiAgICAgICAgaWYgKG51bGwgPT0gc3Vi\nc2NyaWJlUmVzcG9uc2VIYW5kbGVyIHx8CiAgICAgICAgICAgICFzdWJzY3Jp\nYmVSZXNwb25zZUhhbmRsZXIuaGFzU3Vic2NyaXB0aW9uKHRvcGljU3Vic2Ny\naWJlcikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IENsaWVudE5vdFN1YnNj\ncmliZWRFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAiQ2Fubm90IHNlbmQg\nY29uc3VtZSBtZXNzYWdlIHNpbmNlIGNsaWVudCBpcyBub3Qgc3Vic2NyaWJl\nZCB0byB0b3BpYzogIgogICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSArICIsIHN1YnNjcmliZXJJZDogIiArIHN1YnNjcmliZXJJZC50\nb1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgfQogICAgICAgIC8vIFNlbmQgdGhl\nIGNvbnN1bWUgbWVzc2FnZSB0byB0aGUgc2VydmVyIHVzaW5nIHRoZSBzYW1l\nIHN1YnNjcmliZQogICAgICAgIC8vIGNoYW5uZWwgdGhhdCB0aGUgdG9waWMg\nc3Vic2NyaXB0aW9uIHVzZXMuCiAgICAgICAgc3Vic2NyaWJlUmVzcG9uc2VI\nYW5kbGVyLmNvbnN1bWUodG9waWNTdWJzY3JpYmVyLCBtZXNzYWdlU2VxSWQp\nOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmlwdGlvbihC\neXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCkgdGhy\nb3dzIENvdWxkTm90Q29ubmVjdEV4Y2VwdGlvbiwKICAgICAgICBTZXJ2aWNl\nRG93bkV4Y2VwdGlvbiB7CiAgICAgICAgLy8gVGhlIHN1YnNjcmlwdGlvbiB0\neXBlIG9mIGluZm8gc2hvdWxkIGJlIHN0b3JlZCBvbiB0aGUgc2VydmVyIGVu\nZCwgbm90CiAgICAgICAgLy8gdGhlIGNsaWVudCBzaWRlLiBFdmVudHVhbGx5\nLCB0aGUgc2VydmVyIHdpbGwgaGF2ZSB0aGUgU3Vic2NyaXB0aW9uCiAgICAg\nICAgLy8gTWFuYWdlciBwYXJ0IHRoYXQgdGllcyBpbnRvIFpvb2tlZXBlciB0\nbyBtYW5hZ2UgdGhpcyBpbmZvLgogICAgICAgIC8vIENvbW1lbnRpbmcgb3V0\nIHRoZXNlIHR5cGUgb2YgQVBJJ3MgcmVsYXRlZCB0byB0aGF0IGhlcmUgZm9y\nIG5vdyB1bnRpbAogICAgICAgIC8vIHRoaXMgZGF0YSBpcyBhdmFpbGFibGUg\nb24gdGhlIHNlcnZlci4gV2lsbCBmaWd1cmUgb3V0IHdoYXQgdGhlCiAgICAg\nICAgLy8gY29ycmVjdCB3YXkgdG8gY29udGFjdCB0aGUgc2VydmVyIHRvIGdl\ndCB0aGlzIGluZm8gaXMgdGhlbi4KICAgICAgICAvLyBUaGUgY2xpZW50IHNp\nZGUganVzdCBoYXMgc29mdCBtZW1vcnkgc3RhdGUgZm9yIGNsaWVudCBzdWJz\nY3JpcHRpb24KICAgICAgICAvLyBpbmZvcm1hdGlvbi4KICAgICAgICBUb3Bp\nY1N1YnNjcmliZXIgdG9waWNTdWJzY3JpYmVyID0gbmV3IFRvcGljU3Vic2Ny\naWJlcih0b3BpYywgc3Vic2NyaWJlcklkKTsKICAgICAgICBTdWJzY3JpYmVS\nZXNwb25zZUhhbmRsZXIgc3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyID0KICAg\nICAgICAgICAgY2hhbm5lbE1hbmFnZXIuZ2V0U3Vic2NyaWJlUmVzcG9uc2VI\nYW5kbGVyKHRvcGljU3Vic2NyaWJlcik7CiAgICAgICAgcmV0dXJuICEobnVs\nbCA9PSBzdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIgfHwKICAgICAgICAgICAg\nICAgICAhc3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyLmhhc1N1YnNjcmlwdGlv\nbih0b3BpY1N1YnNjcmliZXIpKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdDxC\neXRlU3RyaW5nPiBnZXRTdWJzY3JpcHRpb25MaXN0KEJ5dGVTdHJpbmcgc3Vi\nc2NyaWJlcklkKSB0aHJvd3MgQ291bGROb3RDb25uZWN0RXhjZXB0aW9uLAog\nICAgICAgIFNlcnZpY2VEb3duRXhjZXB0aW9uIHsKICAgICAgICAvLyBTYW1l\nIGFzIHRoZSBwcmV2aW91cyBoYXNTdWJzY3JpcHRpb24gbWV0aG9kLCB0aGlz\nIGRhdGEgc2hvdWxkIHJlc2lkZQogICAgICAgIC8vIG9uIHRoZSBzZXJ2ZXIg\nZW5kLCBub3QgdGhlIGNsaWVudCBzaWRlLgogICAgICAgIHJldHVybiBudWxs\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0RGVsaXZlcnkoZmluYWwg\nQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgQnl0ZVN0cmluZyBzdWJzY3JpYmVy\nSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VIYW5k\nbGVyIG1lc3NhZ2VIYW5kbGVyKQogICAgICAgICAgICB0aHJvd3MgQ2xpZW50\nTm90U3Vic2NyaWJlZEV4Y2VwdGlvbiwgQWxyZWFkeVN0YXJ0RGVsaXZlcnlF\neGNlcHRpb24gewogICAgICAgIFRvcGljU3Vic2NyaWJlciB0b3BpY1N1YnNj\ncmliZXIgPSBuZXcgVG9waWNTdWJzY3JpYmVyKHRvcGljLCBzdWJzY3JpYmVy\nSWQpOwogICAgICAgIGxvZ2dlci5kZWJ1ZygiU3RhcnRpbmcgZGVsaXZlcnkg\nZm9yIHt9LiIsIHRvcGljU3Vic2NyaWJlcik7CiAgICAgICAgY2hhbm5lbE1h\nbmFnZXIuc3RhcnREZWxpdmVyeSh0b3BpY1N1YnNjcmliZXIsIG1lc3NhZ2VI\nYW5kbGVyKTsgCiAgICB9CgogICAgcHVibGljIHZvaWQgc3RhcnREZWxpdmVy\neVdpdGhGaWx0ZXIoZmluYWwgQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgQnl0\nZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBNZXNzYWdlSGFuZGxlciBtZXNzYWdlSGFuZGxl\nciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENs\naWVudE1lc3NhZ2VGaWx0ZXIgbWVzc2FnZUZpbHRlcikKICAgICAgICAgICAg\ndGhyb3dzIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24sIEFscmVhZHlT\ndGFydERlbGl2ZXJ5RXhjZXB0aW9uIHsKICAgICAgICBpZiAobnVsbCA9PSBt\nZXNzYWdlSGFuZGxlciB8fCBudWxsID09IG1lc3NhZ2VGaWx0ZXIpIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCJOdWxs\nIG1lc3NhZ2UgaGFuZGxlciBvciBtZXNzYWdlIGZpbHRlciBpcyAgICAgICBw\ncm92aWRlZC4iKTsKICAgICAgICB9CiAgICAgICAgVG9waWNTdWJzY3JpYmVy\nIHRvcGljU3Vic2NyaWJlciA9IG5ldyBUb3BpY1N1YnNjcmliZXIodG9waWMs\nIHN1YnNjcmliZXJJZCk7CiAgICAgICAgbWVzc2FnZUhhbmRsZXIgPSBuZXcg\nRmlsdGVyYWJsZU1lc3NhZ2VIYW5kbGVyKG1lc3NhZ2VIYW5kbGVyLCBtZXNz\nYWdlRmlsdGVyKTsKICAgICAgICBsb2dnZXIuZGVidWcoIlN0YXJ0aW5nIGRl\nbGl2ZXJ5IHdpdGggZmlsdGVyIGZvciB7fS4iLCB0b3BpY1N1YnNjcmliZXIp\nOwogICAgICAgIGNoYW5uZWxNYW5hZ2VyLnN0YXJ0RGVsaXZlcnkodG9waWNT\ndWJzY3JpYmVyLCBtZXNzYWdlSGFuZGxlcik7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgc3RvcERlbGl2ZXJ5KGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZp\nbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkKQogICAgdGhyb3dzIENsaWVu\ndE5vdFN1YnNjcmliZWRFeGNlcHRpb24gewogICAgICAgIFRvcGljU3Vic2Ny\naWJlciB0b3BpY1N1YnNjcmliZXIgPSBuZXcgVG9waWNTdWJzY3JpYmVyKHRv\ncGljLCBzdWJzY3JpYmVySWQpOwogICAgICAgIGxvZ2dlci5kZWJ1ZygiU3Rv\ncHBpbmcgZGVsaXZlcnkgZm9yIHt9LiIsIHRvcGljU3Vic2NyaWJlcik7CiAg\nICAgICAgY2hhbm5lbE1hbmFnZXIuc3RvcERlbGl2ZXJ5KHRvcGljU3Vic2Ny\naWJlcik7IAogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlU3Vic2NyaXB0\naW9uKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklk\nKSB0aHJvd3MgU2VydmljZURvd25FeGNlcHRpb24gewogICAgICAgIFB1YlN1\nYkRhdGEgcHViU3ViRGF0YSA9IG5ldyBQdWJTdWJEYXRhKHRvcGljLCBudWxs\nLCBzdWJzY3JpYmVySWQsIG51bGwsIG51bGwsIG51bGwsIG51bGwpOwogICAg\nICAgIHN5bmNocm9uaXplZCAocHViU3ViRGF0YSkgewogICAgICAgICAgICBQ\ndWJTdWJDYWxsYmFjayBwdWJTdWJDYWxsYmFjayA9IG5ldyBQdWJTdWJDYWxs\nYmFjayhwdWJTdWJEYXRhKTsKICAgICAgICAgICAgZG9Bc3luY0Nsb3NlU3Vi\nc2NyaXB0aW9uKHRvcGljLCBzdWJzY3JpYmVySWQsIHB1YlN1YkNhbGxiYWNr\nLCBudWxsKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHdo\naWxlICghcHViU3ViRGF0YS5pc0RvbmUpCiAgICAgICAgICAgICAgICAgICAg\ncHViU3ViRGF0YS53YWl0KCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBTZXJ2aWNlRG93bkV4Y2VwdGlvbigiSW50ZXJydXB0ZWQgRXhjZXB0aW9u\nIHdoaWxlIHdhaXRpbmcgZm9yIGFzeW5jQ2xvc2VTdWJzY3JpcHRpb24gY2Fs\nbCIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIENoZWNrIGZyb20g\ndGhlIFB1YlN1YkNhbGxiYWNrIGlmIGl0IHdhcyBzdWNjZXNzZnVsIG9yIG5v\ndC4KICAgICAgICAgICAgaWYgKCFwdWJTdWJDYWxsYmFjay5nZXRJc0NhbGxT\ndWNjZXNzZnVsKCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBTZXJ2\naWNlRG93bkV4Y2VwdGlvbigiRXhjZXB0aW9uIHdoaWxlIHRyeWluZyB0byBj\nbG9zZSB0aGUgc3Vic2NyaXB0aW9uIGZvciB0b3BpYzogIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMu\ndG9TdHJpbmdVdGY4KCkgKyAiLCBzdWJzY3JpYmVySWQ6ICIgKyBzdWJzY3Jp\nYmVySWQudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzeW5jQ2xvc2VTdWJzY3JpcHRp\nb24oZmluYWwgQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgQnl0ZVN0cmluZyBz\ndWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBmaW5hbCBP\nYmplY3QgY29udGV4dCkgewogICAgICAgIGRvQXN5bmNDbG9zZVN1YnNjcmlw\ndGlvbih0b3BpYywgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBuZXcgVm9pZENhbGxiYWNrQWRhcHRlcjxSZXNwb25z\nZUJvZHk+KGNhbGxiYWNrKSwgY29udGV4dCk7CiAgICB9CgogICAgcHJpdmF0\nZSB2b2lkIGRvQXN5bmNDbG9zZVN1YnNjcmlwdGlvbihmaW5hbCBCeXRlU3Ry\naW5nIHRvcGljLCBmaW5hbCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwg\nQ2FsbGJhY2s8UmVzcG9uc2VCb2R5PiBjYWxsYmFjaywgZmluYWwgT2JqZWN0\nIGNvbnRleHQpIHsKICAgICAgICBUb3BpY1N1YnNjcmliZXIgdG9waWNTdWJz\nY3JpYmVyID0gbmV3IFRvcGljU3Vic2NyaWJlcih0b3BpYywgc3Vic2NyaWJl\ncklkKTsKICAgICAgICBsb2dnZXIuZGVidWcoIlN0b3BwaW5nIGRlbGl2ZXJ5\nIGZvciB7fSBiZWZvcmUgY2xvc2luZyBzdWJzY3JpcHRpb24uIiwgdG9waWNT\ndWJzY3JpYmVyKTsKICAgICAgICAvLyBXZSBvbmx5IHN0b3AgZGVsaXZlcnkg\naGVyZSBub3QgaW4gY2hhbm5lbCBtYW5hZ2VyCiAgICAgICAgLy8gQmVjYXVz\nZSBjaGFubmVsTWFuYWdlciNhc3luY0Nsb3NlU3Vic2NyaXB0aW9uIHdpbGwg\nY2FsbGVkCiAgICAgICAgLy8gd2hlbiBzdWJzY3JpcHRpb24gY2hhbm5lbCBk\naXNjb25uZWN0ZWQgdG8gY2xlYXIgbG9jYWwgc3Vic2NyaXB0aW9uCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgY2hhbm5lbE1hbmFnZXIuc3RvcERlbGl2\nZXJ5KHRvcGljU3Vic2NyaWJlcik7IAogICAgICAgIH0gY2F0Y2ggKENsaWVu\ndE5vdFN1YnNjcmliZWRFeGNlcHRpb24gY25zZSkgewogICAgICAgICAgICAv\nLyBpdCBpcyBPSyB0byBpZ25vcmUgdGhlIGV4Y2VwdGlvbiB3aGVuIGNsb3Np\nbmcgc3Vic2NyaXB0aW9uCiAgICAgICAgfQogICAgICAgIGxvZ2dlci5kZWJ1\nZygiQ2xvc2luZyBzdWJzY3JpcHRpb24gYXN5bmNocm9ub3VzbHkgZm9yIHt9\nLiIsIHRvcGljU3Vic2NyaWJlcik7CiAgICAgICAgY2hhbm5lbE1hbmFnZXIu\nYXN5bmNDbG9zZVN1YnNjcmlwdGlvbih0b3BpY1N1YnNjcmliZXIsIGNhbGxi\nYWNrLCBjb250ZXh0KTsKICAgIH0KfQo=\n","encoding":"base64"}

