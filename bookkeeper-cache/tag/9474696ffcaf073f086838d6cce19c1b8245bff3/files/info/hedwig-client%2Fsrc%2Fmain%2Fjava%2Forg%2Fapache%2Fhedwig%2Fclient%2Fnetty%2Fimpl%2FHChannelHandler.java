{"sha":"8b751ae8f45c73df85abec03ec301354215f76b5","node_id":"MDQ6QmxvYjE1NzU5NTY6OGI3NTFhZThmNDVjNzNkZjg1YWJlYzAzZWMzMDEzNTQyMTVmNzZiNQ==","size":13796,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8b751ae8f45c73df85abec03ec301354215f76b5","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHkuaW1wbDsKCmlt\ncG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJy\nZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1\ncnJlbnRNYXA7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmpib3NzLm5ldHR5\nLmNoYW5uZWwuQ2hhbm5lbDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFu\nbmVsLkNoYW5uZWxIYW5kbGVyQ29udGV4dDsKaW1wb3J0IG9yZy5qYm9zcy5u\nZXR0eS5jaGFubmVsLkNoYW5uZWxTdGF0ZUV2ZW50OwppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmNoYW5uZWwuRXhjZXB0aW9uRXZlbnQ7CmltcG9ydCBvcmcu\namJvc3MubmV0dHkuY2hhbm5lbC5NZXNzYWdlRXZlbnQ7CmltcG9ydCBvcmcu\namJvc3MubmV0dHkuY2hhbm5lbC5TaW1wbGVDaGFubmVsSGFuZGxlcjsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5oYW5kbGVyLnNzbC5Tc2xIYW5kbGVyOwoK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5jb25mLkNsaWVudENv\nbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQu\nZGF0YS5QdWJTdWJEYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xp\nZW50LmV4Y2VwdGlvbnMuTm9SZXNwb25zZUhhbmRsZXJFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHkuTmV0VXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuaGFuZGxlcnMuQWJz\ndHJhY3RSZXNwb25zZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5jbGllbnQuaGFuZGxlcnMuU3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNl\ncHRpb24uVW5jZXJ0YWluU3RhdGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbi5VbmV4cGVj\ndGVkQ29uZGl0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1YlN1YlJlc3BvbnNlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUmVzcG9uc2VCb2R5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhdHVz\nQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50UmVzcG9uc2U7CmltcG9ydCBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5WYXJBcmdzLnZhOwoKcHVi\nbGljIGNsYXNzIEhDaGFubmVsSGFuZGxlciBleHRlbmRzIFNpbXBsZUNoYW5u\nZWxIYW5kbGVyIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgbG9nZ2Vy\nID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSENoYW5uZWxIYW5kbGVyLmNs\nYXNzKTsKCiAgICAvLyBDb25jdXJyZW50IE1hcCB0byBzdG9yZSBmb3IgZWFj\naCBhc3luYyBQdWJTdWIgcmVxdWVzdCwgdGhlIHR4biBJRAogICAgLy8gYW5k\nIHRoZSBjb3JyZXNwb25kaW5nIFB1YlN1YiBjYWxsJ3MgZGF0YSB3aGljaCBz\ndG9yZXMgdGhlIFZvaWRDYWxsYmFjayB0bwogICAgLy8gaW52b2tlIHdoZW4g\nd2UgcmVjZWl2ZSBhIFB1YlN1YiBhY2sgcmVzcG9uc2UgZnJvbSB0aGUgc2Vy\ndmVyLgogICAgLy8gVGhpcyBpcyBzcGVjaWZpYyB0byB0aGlzIGluc3RhbmNl\nIG9mIHRoZSBIQ2hhbm5lbEhhbmRsZXIgd2hpY2ggaXMKICAgIC8vIHRpZWQg\ndG8gYSBzcGVjaWZpYyBuZXR0eSBDaGFubmVsIFBpcGVsaW5lLgogICAgcHJp\ndmF0ZSBmaW5hbCBDb25jdXJyZW50TWFwPExvbmcsIFB1YlN1YkRhdGE+IHR4\nbjJQdWJTdWJEYXRhID0KICAgICAgICBuZXcgQ29uY3VycmVudEhhc2hNYXA8\nTG9uZywgUHViU3ViRGF0YT4oKTsKCiAgICAvLyBCb29sZWFuIGluZGljYXRp\nbmcgaWYgd2UgY2xvc2VkIHRoZSBjaGFubmVsIHRoaXMgSENoYW5uZWxIYW5k\nbGVyIGlzCiAgICAvLyBhdHRhY2hlZCB0byBleHBsaWNpdGx5IG9yIG5vdC4g\nSWYgc28sIHdlIGRvIG5vdCBuZWVkIHRvIGRvIHRoZQogICAgLy8gY2hhbm5l\nbCBkaXNjb25uZWN0ZWQgbG9naWMgaGVyZS4KICAgIHByaXZhdGUgdm9sYXRp\nbGUgYm9vbGVhbiBjaGFubmVsQ2xvc2VkRXhwbGljaXRseSA9IGZhbHNlOwoK\nICAgIHByaXZhdGUgZmluYWwgQWJzdHJhY3RIQ2hhbm5lbE1hbmFnZXIgY2hh\nbm5lbE1hbmFnZXI7CiAgICBwcml2YXRlIGZpbmFsIENsaWVudENvbmZpZ3Vy\nYXRpb24gY2ZnOwoKICAgIHByaXZhdGUgZmluYWwgTWFwPE9wZXJhdGlvblR5\ncGUsIEFic3RyYWN0UmVzcG9uc2VIYW5kbGVyPiBoYW5kbGVyczsKICAgIHBy\naXZhdGUgZmluYWwgU3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyIHN1YkhhbmRs\nZXI7CgogICAgcHVibGljIEhDaGFubmVsSGFuZGxlcihDbGllbnRDb25maWd1\ncmF0aW9uIGNmZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgQWJzdHJh\nY3RIQ2hhbm5lbE1hbmFnZXIgY2hhbm5lbE1hbmFnZXIsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgIE1hcDxPcGVyYXRpb25UeXBlLCBBYnN0cmFjdFJl\nc3BvbnNlSGFuZGxlcj4gaGFuZGxlcnMpIHsKICAgICAgICB0aGlzLmNmZyA9\nIGNmZzsKICAgICAgICB0aGlzLmNoYW5uZWxNYW5hZ2VyID0gY2hhbm5lbE1h\nbmFnZXI7CiAgICAgICAgdGhpcy5oYW5kbGVycyA9IGhhbmRsZXJzOwogICAg\nICAgIHN1YkhhbmRsZXIgPSAoU3Vic2NyaWJlUmVzcG9uc2VIYW5kbGVyKSBo\nYW5kbGVycy5nZXQoT3BlcmF0aW9uVHlwZS5TVUJTQ1JJQkUpOwogICAgfQoK\nICAgIHB1YmxpYyBTdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIgZ2V0U3Vic2Ny\naWJlUmVzcG9uc2VIYW5kbGVyKCkgewogICAgICAgIHJldHVybiBzdWJIYW5k\nbGVyOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlbW92ZVR4bihsb25nIHR4\nbklkKSB7CiAgICAgICAgdHhuMlB1YlN1YkRhdGEucmVtb3ZlKHR4bklkKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRUeG4obG9uZyB0eG5JZCwgUHVi\nU3ViRGF0YSBwdWJTdWJEYXRhKSB7CiAgICAgICAgdHhuMlB1YlN1YkRhdGEu\ncHV0KHR4bklkLCBwdWJTdWJEYXRhKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIG1lc3NhZ2VSZWNlaXZlZChDaGFubmVsSGFuZGxl\nckNvbnRleHQgY3R4LCBNZXNzYWdlRXZlbnQgZSkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgLy8gSWYgdGhlIE1lc3NhZ2UgaXMgbm90IGEgUHViU3Vi\nUmVzcG9uc2UsIGp1c3Qgc2VuZCBpdCB1cHN0cmVhbSBhbmQgbGV0CiAgICAg\nICAgLy8gc29tZXRoaW5nIGVsc2UgaGFuZGxlIGl0LgogICAgICAgIGlmICgh\nKGUuZ2V0TWVzc2FnZSgpIGluc3RhbmNlb2YgUHViU3ViUmVzcG9uc2UpKSB7\nCiAgICAgICAgICAgIGN0eC5zZW5kVXBzdHJlYW0oZSk7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLy8gUmV0cmlldmUgdGhlIFB1\nYlN1YlJlc3BvbnNlIGZyb20gdGhlIE1lc3NhZ2UgdGhhdCB3YXMgc2VudCBi\neSB0aGUKICAgICAgICAvLyBzZXJ2ZXIuCiAgICAgICAgUHViU3ViUmVzcG9u\nc2UgcmVzcG9uc2UgPSAoUHViU3ViUmVzcG9uc2UpIGUuZ2V0TWVzc2FnZSgp\nOwogICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVzcG9uc2UgcmVjZWl2ZWQgZnJv\nbSBob3N0OiB7fSwgcmVzcG9uc2U6IHt9LiIsCiAgICAgICAgICAgICAgICAg\nICAgIHZhKE5ldFV0aWxzLmdldEhvc3RGcm9tQ2hhbm5lbChjdHguZ2V0Q2hh\nbm5lbCgpKSwgcmVzcG9uc2UpKTsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIGlm\nIHRoaXMgUHViU3ViUmVzcG9uc2UgaXMgYW4gYWNrIHJlc3BvbnNlIGZvciBh\nIFB1YlN1YgogICAgICAgIC8vIFJlcXVlc3Qgb3IgaWYgaXQgaXMgYSBtZXNz\nYWdlIGJlaW5nIHB1c2hlZCB0byB0aGUgY2xpZW50IHN1YnNjcmliZXIuCiAg\nICAgICAgaWYgKHJlc3BvbnNlLmhhc01lc3NhZ2UoKSkgewogICAgICAgICAg\nICAvLyBTdWJzY3JpYmVkIG1lc3NhZ2VzIGJlaW5nIHB1c2hlZCB0byB0aGUg\nY2xpZW50IHNvIGhhbmRsZS9jb25zdW1lCiAgICAgICAgICAgIC8vIGl0IGFu\nZCByZXR1cm4uCiAgICAgICAgICAgIGlmIChudWxsID09IHN1YkhhbmRsZXIp\nIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiUmVjZWl2ZWQgbWVz\nc2FnZSBmcm9tIGEgbm9uLXN1YnNjcmlwdGlvbiBjaGFubmVsIDoge30iLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHN1YkhhbmRsZXIuaGFu\nZGxlU3Vic2NyaWJlTWVzc2FnZShyZXNwb25zZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8gUHJv\nY2VzcyBTdWJzY3JpcHRpb24gRXZlbnRzCiAgICAgICAgaWYgKHJlc3BvbnNl\nLmhhc1Jlc3BvbnNlQm9keSgpKSB7CiAgICAgICAgICAgIFJlc3BvbnNlQm9k\neSByZXNwID0gcmVzcG9uc2UuZ2V0UmVzcG9uc2VCb2R5KCk7CiAgICAgICAg\nICAgIC8vIEEgc3BlY2lhbCBzdWJzY3JpcHRpb24gZXZlbnQgaW5kaWNhdGVz\nIHRoZSBzdGF0ZSBvZiBhIHN1YnNjcmliZXIKICAgICAgICAgICAgaWYgKHJl\nc3AuaGFzU3Vic2NyaXB0aW9uRXZlbnQoKSkgewogICAgICAgICAgICAgICAg\naWYgKG51bGwgPT0gc3ViSGFuZGxlcikgewogICAgICAgICAgICAgICAgICAg\nIGxvZ2dlci5lcnJvcigiUmVjZWl2ZWQgc3Vic2NyaXB0aW9uIGV2ZW50IGZy\nb20gYSBub24tc3Vic2NyaXB0aW9uIGNoYW5uZWwgOiB7fSIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlKTsgCiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFN1YnNjcmlw\ndGlvbkV2ZW50UmVzcG9uc2UgZXZlbnRSZXNwID0gcmVzcC5nZXRTdWJzY3Jp\ncHRpb25FdmVudCgpOwogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1\nZygiUmVjZWl2ZWQgc3Vic2NyaXB0aW9uIGV2ZW50IHt9IGZvciAodG9waWM6\ne30sIHN1YnNjcmliZXI6e30pLiIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHZhKGV2ZW50UmVzcC5nZXRFdmVudCgpLCByZXNwb25zZS5n\nZXRUb3BpYygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXNwb25zZS5nZXRTdWJzY3JpYmVySWQoKSkpOwogICAgICAgICAgICAg\nICAgICAgIHN1YkhhbmRsZXIuaGFuZGxlU3Vic2NyaXB0aW9uRXZlbnQocmVz\ncG9uc2UuZ2V0VG9waWMoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmdldFN1YnNj\ncmliZXJJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXZlbnRSZXNwLmdldEV2ZW50KCkpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBSZXNwb25zZSBpcyBh\nbiBhY2sgdG8gYSBwcmlvciBQdWJTdWJSZXF1ZXN0IHNvIGZpcnN0IHJldHJp\nZXZlIHRoZQogICAgICAgIC8vIFB1YlN1YiBkYXRhIGZvciB0aGlzIHR4bi4K\nICAgICAgICBQdWJTdWJEYXRhIHB1YlN1YkRhdGEgPSB0eG4yUHViU3ViRGF0\nYS5yZW1vdmUocmVzcG9uc2UuZ2V0VHhuSWQoKSk7CgogICAgICAgIC8vIFZh\nbGlkYXRlIHRoYXQgdGhlIFB1YlN1YiBkYXRhIGZvciB0aGlzIHR4biBpcyBz\ndG9yZWQuIElmIG5vdCwganVzdAogICAgICAgIC8vIGxvZyBhbiBlcnJvciBt\nZXNzYWdlIGFuZCByZXR1cm4gc2luY2Ugd2UgZG9uJ3Qga25vdyBob3cgdG8g\naGFuZGxlCiAgICAgICAgLy8gdGhpcy4KICAgICAgICBpZiAocHViU3ViRGF0\nYSA9PSBudWxsKSB7CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiUHViU3Vi\nIERhdGEgd2FzIG5vdCBmb3VuZCBmb3IgUHViU3ViUmVzcG9uc2U6IHt9Iiwg\ncmVzcG9uc2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICAvLyBTdG9yZSB0aGUgdG9waWMySG9zdCBtYXBwaW5nIGlmIHRoaXMg\nd2Fzbid0IGEgc2VydmVyIHJlZGlyZWN0LiBXZSdsbAogICAgICAgIC8vIGFz\nc3VtZSB0aGF0IGlmIHRoZSBzZXJ2ZXIgd2FzIGFibGUgdG8gaGF2ZSBhbiBv\ncGVuIENoYW5uZWwgY29ubmVjdGlvbgogICAgICAgIC8vIHRvIHRoZSBjbGll\nbnQsIGFuZCByZXNwb25kZWQgd2l0aCBhbiBhY2sgbWVzc2FnZSBvdGhlciB0\naGFuIHRoZQogICAgICAgIC8vIE5PVF9SRVNQT05TSUJMRV9GT1JfVE9QSUMg\nb25lLCBpdCBpcyB0aGUgY29ycmVjdCB0b3BpYyBtYXN0ZXIuCiAgICAgICAg\naWYgKCFyZXNwb25zZS5nZXRTdGF0dXNDb2RlKCkuZXF1YWxzKFN0YXR1c0Nv\nZGUuTk9UX1JFU1BPTlNJQkxFX0ZPUl9UT1BJQykpIHsKICAgICAgICAgICAg\nLy8gUmV0cmlldmUgdGhlIHNlcnZlciBob3N0IHRoYXQgd2UndmUgY29ubmVj\ndGVkIHRvIGFuZCBzdG9yZSB0aGUKICAgICAgICAgICAgLy8gbWFwcGluZyBm\ncm9tIHRoZSB0b3BpYyB0byB0aGlzIGhvc3QuIEZvciBhbGwgb3RoZXIgbm9u\nLXJlZGlyZWN0ZWQKICAgICAgICAgICAgLy8gc2VydmVyIHN0YXR1c2VzLCB3\nZSBjb25zaWRlciB0aGF0IGFzIGEgc3VjY2Vzc2Z1bCBjb25uZWN0aW9uIHRv\nIHRoZQogICAgICAgICAgICAvLyBjb3JyZWN0IHRvcGljIG1hc3Rlci4KICAg\nICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgaG9zdCA9IE5ldFV0aWxzLmdl\ndEhvc3RGcm9tQ2hhbm5lbChjdHguZ2V0Q2hhbm5lbCgpKTsKICAgICAgICAg\nICAgY2hhbm5lbE1hbmFnZXIuc3RvcmVUb3BpYzJIb3N0TWFwcGluZyhwdWJT\ndWJEYXRhLnRvcGljLCBob3N0KTsKICAgICAgICB9CgogICAgICAgIC8vIERl\ncGVuZGluZyBvbiB0aGUgb3BlcmF0aW9uIHR5cGUsIGNhbGwgdGhlIGFwcHJv\ncHJpYXRlIGhhbmRsZXIuCiAgICAgICAgbG9nZ2VyLmRlYnVnKCJIYW5kbGlu\nZyBhIHt9IHJlc3BvbnNlOiB7fSwgcHViU3ViRGF0YToge30sIGhvc3Q6IHt9\nLiIsCiAgICAgICAgICAgICAgICAgICAgIHZhKHB1YlN1YkRhdGEub3BlcmF0\naW9uVHlwZSwgcmVzcG9uc2UsIHB1YlN1YkRhdGEsIGN0eC5nZXRDaGFubmVs\nKCkpKTsKICAgICAgICBBYnN0cmFjdFJlc3BvbnNlSGFuZGxlciByZXNwSGFu\nZGxlciA9IGhhbmRsZXJzLmdldChwdWJTdWJEYXRhLm9wZXJhdGlvblR5cGUp\nOwogICAgICAgIGlmIChudWxsID09IHJlc3BIYW5kbGVyKSB7CiAgICAgICAg\nICAgIC8vIFRoZSBhYm92ZSBhcmUgdGhlIG9ubHkgZXhwZWN0ZWQgUHViU3Vi\nUmVzcG9uc2UgbWVzc2FnZXMgcmVjZWl2ZWQKICAgICAgICAgICAgLy8gZnJv\nbSB0aGUgc2VydmVyIGZvciB0aGUgdmFyaW91cyBjbGllbnQgc2lkZSByZXF1\nZXN0cyBtYWRlLgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlJlc3BvbnNl\nIHJlY2VpdmVkIGZyb20gc2VydmVyIGlzIGZvciBhbiB1bmhhbmRsZWQgb3Bl\ncmF0aW9uIHt9LCB0eG5JZDoge30uIiwKICAgICAgICAgICAgICAgICAgICAg\nICAgIHZhKHB1YlN1YkRhdGEub3BlcmF0aW9uVHlwZSwgcmVzcG9uc2UuZ2V0\nVHhuSWQoKSkpOwogICAgICAgICAgICBwdWJTdWJEYXRhLmdldENhbGxiYWNr\nKCkub3BlcmF0aW9uRmFpbGVkKHB1YlN1YkRhdGEuY29udGV4dCwKICAgICAg\nICAgICAgICAgIG5ldyBVbmV4cGVjdGVkQ29uZGl0aW9uRXhjZXB0aW9uKCJD\nYW4ndCBmaW5kIHJlc3BvbnNlIGhhbmRsZXIgZm9yIG9wZXJhdGlvbiAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIHB1YlN1YkRhdGEub3BlcmF0aW9uVHlwZSkpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQogICAgICAgIHJlc3BIYW5kbGVyLmhhbmRsZVJl\nc3BvbnNlKHJlc3BvbnNlLCBwdWJTdWJEYXRhLCBjdHguZ2V0Q2hhbm5lbCgp\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjaGVja1RpbWVvdXRSZXF1ZXN0\ncygpIHsKICAgICAgICBsb25nIGN1clRpbWUgPSBTeXN0ZW0uY3VycmVudFRp\nbWVNaWxsaXMoKTsKICAgICAgICBsb25nIHRpbWVvdXRJbnRlcnZhbCA9IGNm\nZy5nZXRTZXJ2ZXJBY2tSZXNwb25zZVRpbWVvdXQoKTsKICAgICAgICBmb3Ig\nKFB1YlN1YkRhdGEgcHViU3ViRGF0YSA6IHR4bjJQdWJTdWJEYXRhLnZhbHVl\ncygpKSB7CiAgICAgICAgICAgIGNoZWNrVGltZW91dFJlcXVlc3QocHViU3Vi\nRGF0YSwgY3VyVGltZSwgdGltZW91dEludGVydmFsKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIGNoZWNrVGltZW91dFJlcXVlc3QoUHVi\nU3ViRGF0YSBwdWJTdWJEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9uZyBjdXJUaW1lLCBsb25nIHRpbWVvdXRJbnRlcnZh\nbCkgewogICAgICAgIGlmIChjdXJUaW1lID4gcHViU3ViRGF0YS5yZXF1ZXN0\nV3JpdGVUaW1lICsgdGltZW91dEludGVydmFsKSB7CiAgICAgICAgICAgIC8v\nIEN1cnJlbnQgUHViU3ViUmVxdWVzdCBoYXMgdGltZWQgb3V0IHNvIHJlbW92\nZSBpdCBmcm9tIHRoZQogICAgICAgICAgICAvLyBSZXNwb25zZUhhbmRsZXIn\ncyBtYXAgYW5kIGludm9rZSB0aGUgVm9pZENhbGxiYWNrJ3MKICAgICAgICAg\nICAgLy8gb3BlcmF0aW9uRmFpbGVkIG1ldGhvZC4KICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJDdXJyZW50IFB1YlN1YlJlcXVlc3QgaGFzIHRpbWVkIG91\ndCBmb3IgcHViU3ViRGF0YTogIiArIHB1YlN1YkRhdGEpOwogICAgICAgICAg\nICB0eG4yUHViU3ViRGF0YS5yZW1vdmUocHViU3ViRGF0YS50eG5JZCk7CiAg\nICAgICAgICAgIHB1YlN1YkRhdGEuZ2V0Q2FsbGJhY2soKS5vcGVyYXRpb25G\nYWlsZWQocHViU3ViRGF0YS5jb250ZXh0LAogICAgICAgICAgICAgICAgbmV3\nIFVuY2VydGFpblN0YXRlRXhjZXB0aW9uKCJTZXJ2ZXIgYWNrIHJlc3BvbnNl\nIG5ldmVyIHJlY2VpdmVkIHNvIFB1YlN1YlJlcXVlc3QgaGFzIHRpbWVkIG91\ndCEiKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIExvZ2ljIHRvIGRlYWwg\nd2l0aCB3aGF0IGhhcHBlbnMgd2hlbiBhIENoYW5uZWwgdG8gYSBzZXJ2ZXIg\naG9zdCBpcwogICAgLy8gZGlzY29ubmVjdGVkLgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgdm9pZCBjaGFubmVsRGlzY29ubmVjdGVkKENoYW5uZWxIYW5k\nbGVyQ29udGV4dCBjdHgsIENoYW5uZWxTdGF0ZUV2ZW50IGUpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIC8vIElmIHRoaXMgY2hhbm5lbCB3YXMgY2xv\nc2VkIGV4cGxpY2l0bHkgYnkgdGhlIGNsaWVudCBjb2RlLAogICAgICAgIC8v\nIHdlIGRvIG5vdCBuZWVkIHRvIGRvIGFueSBvZiB0aGlzIGxvZ2ljLiBUaGlz\nIGNvdWxkIGhhcHBlbgogICAgICAgIC8vIGZvciByZWR1bmRhbnQgUHVibGlz\naCBjaGFubmVscyBjcmVhdGVkIG9yIHJlZGlyZWN0ZWQgc3Vic2NyaWJlCiAg\nICAgICAgLy8gY2hhbm5lbHMgdGhhdCBhcmUgbm90IHVzZWQgYW55bW9yZSBv\nciB3aGVuIHdlIHNodXRkb3duIHRoZQogICAgICAgIC8vIGNsaWVudCBhbmQg\nbWFudWFsbHkgY2xvc2UgYWxsIG9mIHRoZSBvcGVuIGNoYW5uZWxzLgogICAg\nICAgIC8vIEFsc28gZG9uJ3QgZG8gYW55IG9mIHRoZSBkaXNjb25uZWN0IGxv\nZ2ljIGlmIHRoZSBjbGllbnQgaGFzIHN0b3BwZWQuCiAgICAgICAgaWYgKGNo\nYW5uZWxDbG9zZWRFeHBsaWNpdGx5IHx8IGNoYW5uZWxNYW5hZ2VyLmlzQ2xv\nc2VkKCkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgLy8gTWFrZSBzdXJlIHRoZSBob3N0IHJldHJpZXZlZCBpcyBub3QgbnVs\nbCBhcyB0aGVyZSBjb3VsZCBiZSBzb21lIHdlaXJkCiAgICAgICAgLy8gY2hh\nbm5lbCBkaXNjb25uZWN0IGV2ZW50cyBoYXBwZW5pbmcgZHVyaW5nIGEgY2xp\nZW50IHNodXRkb3duLgogICAgICAgIC8vIElmIGl0IGlzLCBqdXN0IHJldHVy\nbiBhcyB0aGVyZSBzaG91bGRuJ3QgYmUgYW55dGhpbmcgd2UgbmVlZCB0byBk\nby4KICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBob3N0ID0gTmV0VXRpbHMu\nZ2V0SG9zdEZyb21DaGFubmVsKGN0eC5nZXRDaGFubmVsKCkpOwogICAgICAg\nIGlmIChob3N0ID09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgbG9nZ2VyLmluZm8oIkNoYW5uZWwge30gd2FzIGRp\nc2Nvbm5lY3RlZCB0byBob3N0IHt9LiIsCiAgICAgICAgICAgICAgICAgICAg\ndmEoY3R4LmdldENoYW5uZWwoKSwgaG9zdCkpOwoKICAgICAgICAvLyBJZiB0\naGlzIENoYW5uZWwgd2FzIHVzZWQgZm9yIFB1Ymxpc2ggYW5kIFVuc3Vic2Ny\naWJlIGZsb3dzLCBqdXN0CiAgICAgICAgLy8gcmVtb3ZlIGl0IGZyb20gdGhl\nIEhld2RpZ1B1Ymxpc2hlcidzIGhvc3QyQ2hhbm5lbCBtYXAuIFdlIHdpbGwK\nICAgICAgICAvLyByZS1lc3RhYmxpc2ggYSBDaGFubmVsIGNvbm5lY3Rpb24g\ndG8gdGhhdCBzZXJ2ZXIgd2hlbiB0aGUgbmV4dAogICAgICAgIC8vIHB1Ymxp\nc2gvdW5zdWJzY3JpYmUgcmVxdWVzdCB0byBhIHRvcGljIHRoYXQgdGhlIHNl\ncnZlciBvd25zIG9jY3Vycy4KCiAgICAgICAgLy8gTm93IGRldGVybWluZSB3\naGF0IHR5cGUgb2Ygb3BlcmF0aW9uIHRoaXMgY2hhbm5lbCB3YXMgdXNlZCBm\nb3IuCiAgICAgICAgaWYgKG51bGwgPT0gc3ViSGFuZGxlcikgewogICAgICAg\nICAgICBjaGFubmVsTWFuYWdlci5vbk5vblN1YnNjcmlwdGlvbkNoYW5uZWxE\naXNjb25uZWN0ZWQoaG9zdCwgY3R4LmdldENoYW5uZWwoKSk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgY2hhbm5lbE1hbmFnZXIub25TdWJzY3Jp\ncHRpb25DaGFubmVsRGlzY29ubmVjdGVkKGhvc3QsIGN0eC5nZXRDaGFubmVs\nKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8gRmluYWxseSwgYWxsIG9mIHRo\nZSBQdWJTdWJSZXF1ZXN0cyB0aGF0IGFyZSBzdGlsbCB3YWl0aW5nIGZvciBh\nbiBhY2sKICAgICAgICAvLyByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgbmVl\nZCB0byBiZSByZW1vdmVkIGFuZCB0aW1lZCBvdXQuIEludm9rZSB0aGUKICAg\nICAgICAvLyBvcGVyYXRpb25GYWlsZWQgY2FsbGJhY2tzIG9uIGFsbCBvZiB0\naGVtLiBVc2UgdGhlCiAgICAgICAgLy8gVW5jZXJ0YWluU3RhdGVFeGNlcHRp\nb24gc2luY2UgdGhlIHNlcnZlciBkaWQgcmVjZWl2ZSB0aGUgcmVxdWVzdCBi\ndXQKICAgICAgICAvLyB3ZSdyZSBub3Qgc3VyZSBvZiB0aGUgc3RhdGUgb2Yg\ndGhlIHJlcXVlc3Qgc2luY2UgdGhlIGFjayByZXNwb25zZSB3YXMKICAgICAg\nICAvLyBuZXZlciByZWNlaXZlZC4KICAgICAgICBmb3IgKFB1YlN1YkRhdGEg\ncHViU3ViRGF0YSA6IHR4bjJQdWJTdWJEYXRhLnZhbHVlcygpKSB7CiAgICAg\nICAgICAgIGxvZ2dlci5kZWJ1ZygiQ2hhbm5lbCBkaXNjb25uZWN0ZWQgc28g\naW52b2tpbmcgdGhlIG9wZXJhdGlvbkZhaWxlZCBjYWxsYmFjayBmb3IgcHVi\nU3ViRGF0YToge30iLAogICAgICAgICAgICAgICAgICAgICAgICAgcHViU3Vi\nRGF0YSk7CiAgICAgICAgICAgIHB1YlN1YkRhdGEuZ2V0Q2FsbGJhY2soKS5v\ncGVyYXRpb25GYWlsZWQocHViU3ViRGF0YS5jb250ZXh0LCBuZXcgVW5jZXJ0\nYWluU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIlNlcnZlciBhY2sgcmVzcG9u\nc2UgbmV2ZXIgcmVjZWl2ZWQgYmVmb3JlIHNlcnZlciBjb25uZWN0aW9uIGRp\nc2Nvbm5lY3RlZCEiKSk7CiAgICAgICAgfQogICAgICAgIHR4bjJQdWJTdWJE\nYXRhLmNsZWFyKCk7CiAgICB9CgogICAgLy8gTG9naWMgdG8gZGVhbCB3aXRo\nIHdoYXQgaGFwcGVucyB3aGVuIGEgQ2hhbm5lbCB0byBhIHNlcnZlciBob3N0\nIGlzCiAgICAvLyBjb25uZWN0ZWQuIFRoaXMgaXMgbmVlZGVkIGlmIHRoZSBj\nbGllbnQgaXMgdXNpbmcgYW4gU1NMIHBvcnQgdG8KICAgIC8vIGNvbW11bmlj\nYXRlIHdpdGggdGhlIHNlcnZlci4gSWYgc28sIHdlIG5lZWQgdG8gZG8gdGhl\nIFNTTCBoYW5kc2hha2UgaGVyZQogICAgLy8gd2hlbiB0aGUgY2hhbm5lbCBp\ncyBmaXJzdCBjb25uZWN0ZWQuCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2\nb2lkIGNoYW5uZWxDb25uZWN0ZWQoQ2hhbm5lbEhhbmRsZXJDb250ZXh0IGN0\neCwgQ2hhbm5lbFN0YXRlRXZlbnQgZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgLy8gTm8gbmVlZCB0byBpbml0aWF0ZSB0aGUgU1NMIGhhbmRzaGFr\nZSBpZiB3ZSBhcmUgY2xvc2luZyB0aGlzIGNoYW5uZWwKICAgICAgICAvLyBl\neHBsaWNpdGx5IG9yIHRoZSBjbGllbnQgaGFzIGJlZW4gc3RvcHBlZC4KICAg\nICAgICBpZiAoY2ZnLmlzU1NMRW5hYmxlZCgpICYmICFjaGFubmVsQ2xvc2Vk\nRXhwbGljaXRseSAmJiAhY2hhbm5lbE1hbmFnZXIuaXNDbG9zZWQoKSkgewog\nICAgICAgICAgICBsb2dnZXIuZGVidWcoIkluaXRpYXRpbmcgdGhlIFNTTCBo\nYW5kc2hha2UiKTsKICAgICAgICAgICAgY3R4LmdldFBpcGVsaW5lKCkuZ2V0\nKFNzbEhhbmRsZXIuY2xhc3MpLmhhbmRzaGFrZSgpOwogICAgICAgIH0KICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGV4Y2VwdGlvbkNh\ndWdodChDaGFubmVsSGFuZGxlckNvbnRleHQgY3R4LCBFeGNlcHRpb25FdmVu\ndCBlKSB7CiAgICAgICAgbG9nZ2VyLmVycm9yKCJFeGNlcHRpb24gY2F1Z2h0\nIG9uIGNsaWVudCBjaGFubmVsIiwgZS5nZXRDYXVzZSgpKTsKICAgICAgICBl\nLmdldENoYW5uZWwoKS5jbG9zZSgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGNsb3NlRXhwbGljaXRseSgpIHsKICAgICAgICAvLyBUT0RPOiBCT09LS0VF\nUEVSLTM1MCA6IEhhbmRsZSBjb25zdW1lIGJ1ZmZlcmluZywgZXRjIGhlcmUg\nLSBpbiBhIGRpZmZlcmVudCBwYXRjaAogICAgICAgIGNoYW5uZWxDbG9zZWRF\neHBsaWNpdGx5ID0gdHJ1ZTsKICAgIH0KfQo=\n","encoding":"base64"}

