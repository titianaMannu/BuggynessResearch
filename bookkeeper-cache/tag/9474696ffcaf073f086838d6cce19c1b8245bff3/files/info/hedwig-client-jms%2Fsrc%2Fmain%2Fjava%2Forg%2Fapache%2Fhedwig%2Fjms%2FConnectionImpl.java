{"sha":"1a77fcfeec29a5780c758a7e49a1440070b15cfd","node_id":"MDQ6QmxvYjE1NzU5NTY6MWE3N2ZjZmVlYzI5YTU3ODBjNzU4YTdlNDlhMTQ0MDA3MGIxNWNmZA==","size":18512,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1a77fcfeec29a5780c758a7e49a1440070b15cfd","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXM7CgppbXBvcnQgb3JnLnNsZjRq\nLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1w\nb3J0IGphdmF4Lmptcy5Db25uZWN0aW9uOwppbXBvcnQgamF2YXguam1zLkNv\nbm5lY3Rpb25Db25zdW1lcjsKaW1wb3J0IGphdmF4Lmptcy5Db25uZWN0aW9u\nTWV0YURhdGE7CmltcG9ydCBqYXZheC5qbXMuRGVzdGluYXRpb247CmltcG9y\ndCBqYXZheC5qbXMuRXhjZXB0aW9uTGlzdGVuZXI7CmltcG9ydCBqYXZheC5q\nbXMuSW52YWxpZENsaWVudElERXhjZXB0aW9uOwppbXBvcnQgamF2YXguam1z\nLkpNU0V4Y2VwdGlvbjsKaW1wb3J0IGphdmF4Lmptcy5RdWV1ZTsKaW1wb3J0\nIGphdmF4Lmptcy5RdWV1ZUNvbm5lY3Rpb247CmltcG9ydCBqYXZheC5qbXMu\nU2VydmVyU2Vzc2lvblBvb2w7CmltcG9ydCBqYXZheC5qbXMuVG9waWM7Cmlt\ncG9ydCBqYXZheC5qbXMuVG9waWNDb25uZWN0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5IYXNoU2V0OwppbXBv\ncnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwoKLyoq\nCiAqIEltcGxlbWVudGF0aW9uIG9mIGpteCBDb25uZWN0aW9uCiAqIE1VU1Qg\nYmUgTVQtc2FmZSAoMi44KQogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIENv\nbm5lY3Rpb25JbXBsIGltcGxlbWVudHMgQ29ubmVjdGlvbiwgVG9waWNDb25u\nZWN0aW9uLCBRdWV1ZUNvbm5lY3Rpb24gewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihDb25uZWN0aW9uSW1wbC5jbGFzcyk7CgogICAgLy8gQ29waWVkIGZyb20g\nb2xkIEhlZHdpZ0Nvbm5lY3RvaW4KICAgIC8vIFRPRE8gbW92ZSB0byBhIGNv\nbnN0YW50cyBjbGFzcz8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5n\nIEhFRFdJR19DTElFTlRfQ09ORklHX0ZJTEUgPSAiaGVkd2lnLmNsaWVudC5j\nb25maWcuZmlsZSI7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTZXQ8U3Ry\naW5nPiBnbG9iYWxDbGllbnRJZFNldCA9IG5ldyBIYXNoU2V0PFN0cmluZz4o\nMTYpOwoKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIHVzZXI7CiAgICBwcml2\nYXRlIGZpbmFsIFN0cmluZyBwYXNzd29yZDsKCiAgICAvLyBXaWxsIGJlIHNl\ndCB0byBhIHJhbmRvbSBzdHJpbmcgaWYgdW5zcGVjaWZpZWQgLSB3ZSBkbyBu\nb3QgaGF2ZSBhIHdheSAoY3VycmVudGx5KSBmb3IgYWRtaW4KICAgIC8vIHNw\nZWNpZmllZCB2YWx1ZSAuLi4KICAgIC8vIE5vdGUsIHVzaW5nIHRoZSBzeXN0\nZW0gcHJvcGVydHkgbWVhbnMKICAgIC8vIHByaXZhdGUgU3RyaW5nIGNsaWVu\ndElEID0gU3lzdGVtLmdldFByb3BlcnR5KCJIRURXSUdfQ0xJRU5UX0lEIiwg\nbnVsbCk7CiAgICBwcml2YXRlIHZvbGF0aWxlIFN0cmluZyBjbGllbnRJRCA9\nIG51bGw7CgogICAgLy8gSSBkbyBub3QgbGlrZSBsb2NraW5nIG9uICd0aGlz\nJyBpbnNwaXRlIG9mIHRoZSBwZXJmIGRpZmYgLSBhbGxvd3MgJ290aGVycycg\ndG8gbG9jayBvbiBvdXIKICAgIC8vIGxvY2sgb2JqZWN0IChjbGllbnQgY29k\nZSBmb3IgZXhhbXBsZSkgOiBsZWFrcyBNVC1zYWZldHkuCiAgICBwcml2YXRl\nIGZpbmFsIE9iamVjdCBsb2NrT2JqZWN0ID0gbmV3IE9iamVjdCgpOwoKICAg\nIC8vIENhbGwgdGhpcyB3aGVuIHRoZXJlIGFyZSBpc3N1ZXMgKHByaW1hcmls\neSBjb25uZWN0aW9uIGlzc3VlcyBpbW8pLgogICAgLy8gVGhlcmUgYXJlIHR3\nbyBpc3N1ZXMgd2l0aCBzdXBwb3J0aW5nIHRoaXMgOgogICAgLy8gYSkgd2Ug\nZG8gbm90IGZvbGxvdyBqbXMgbW9kZWwgb2YgY29ubmVjdGlvbiAtPiBtdWx0\naXBsZSBzZXNzaW9uczsgZm9yIHVzLCBjb25uZWN0aW9uIGRvZXMgbm90CiAg\nICAvLyByZXByZXNlbnQgdW5kZXJseWluZyBjb25uZWN0aW9uIHRvCiAgICAv\nLyBoZWR3aWcsIGJ1dCBzZXNzaW9uIGRvZXMuIFNvIHRoZSBiYXNpYyBtb2Rl\nbCBkb2VzIG5vdCBmaXQuCiAgICAvLyBiKSBmcm9tIHdoYXQgSSBzZWUsIGhl\nZHdpZy1jbGllbnQgZG9lcyBub3QgZXhwb3NlIHRoZSBhYmlsaXR5IHRvIGRv\nIHRoaXMuIChpdCBhdXRvbWF0aWNhbGx5IHJlY29ubmVjdHMpCiAgICAvLyBo\nZW5jZSB3ZSBkbyBub3Qgc3VwcG9ydCB0aGlzIHlldC4KICAgIHByaXZhdGUg\ndm9sYXRpbGUgRXhjZXB0aW9uTGlzdGVuZXIgZXhjZXB0aW9uTGlzdGVuZXI7\nCgogICAgLy8gY29ubmVjdGlvbiAnc3RhcnRzJyBpbiBzdG9wcGVkIG1vZGUu\nCiAgICAvLyBVbnRpbCBpdCBpcyBzdGFydGVkLCBOTyBtZXNzYWdlcyBNVVNU\nIGJlIGRlbGl2ZXJlZCAtIDQuMy4zCiAgICBwcml2YXRlIFN0YXRlTWFuYWdl\nciBjb25uZWN0aW9uU3RhdGUgPSBuZXcgU3RhdGVNYW5hZ2VyKFN0YXRlTWFu\nYWdlci5TdGF0ZS5TVE9QUEVELCBsb2NrT2JqZWN0KTsKCiAgICBwcml2YXRl\nIGZpbmFsIExpc3Q8U2Vzc2lvbkltcGw+IHNlc3Npb25MaXN0ID0gbmV3IEFy\ncmF5TGlzdDxTZXNzaW9uSW1wbD4oNCk7CiAgICBwcml2YXRlIGZpbmFsIENv\nbm5lY3Rpb25NZXRhRGF0YSBtZXRhZGF0YSA9IG5ldyBDb25uZWN0aW9uTWV0\nYURhdGFJbXBsKCk7CgogICAgcHJvdGVjdGVkIENvbm5lY3Rpb25JbXBsKCkg\newogICAgICAgIHRoaXMudXNlciA9IG51bGw7CiAgICAgICAgdGhpcy5wYXNz\nd29yZCA9IG51bGw7CiAgICB9CgogICAgcHJvdGVjdGVkIENvbm5lY3Rpb25J\nbXBsKFN0cmluZyB1c2VyLCBTdHJpbmcgcGFzc3dvcmQpIHsKICAgICAgICB0\naGlzLnVzZXIgPSB1c2VyOwogICAgICAgIHRoaXMucGFzc3dvcmQgPSBwYXNz\nd29yZDsKICAgIH0KCiAgICAvKioKICAgICAqIHtAaW5oZXJpdERvY30KICAg\nICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgU2Vzc2lvbkltcGwgY3Jl\nYXRlU2Vzc2lvbihib29sZWFuIHRyYW5zYWN0ZWQsIGludCBhY2tub3dsZWRn\nZU1vZGUpICB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4g\nY3JlYXRlU2Vzc2lvbkltcGwodHJhbnNhY3RlZCwgYWNrbm93bGVkZ2VNb2Rl\nLCBudWxsKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU2Vzc2lvbkltcGwgY3Jl\nYXRlU2Vzc2lvbkltcGwoYm9vbGVhbiB0cmFuc2FjdGVkLCBpbnQgYWNrbm93\nbGVkZ2VNb2RlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25U\neXBlIHR5cGUpICB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBmaW5h\nbCBib29sZWFuIG5lZWRTdGFydDsKICAgICAgICBzeW5jaHJvbml6ZWQgKGxv\nY2tPYmplY3QpewogICAgICAgICAgICBpZiAoY29ubmVjdGlvblN0YXRlLmlz\nSW5DbG9zZU1vZGUoKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgamF2YXgu\nam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQ29ubmVjdGlvbiBjbG9zZWQi\nKTsKICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25TdGF0ZS5pc1RyYW5zaXRp\nb25TdGF0ZSgpKSB7CiAgICAgICAgICAgICAgICBjb25uZWN0aW9uU3RhdGUu\nd2FpdEZvclRyYW5zaWVudFN0YXRlQ2hhbmdlKFN0YXRlTWFuYWdlci5XQUlU\nX1RJTUVfRk9SX1RSQU5TSUVOVF9TVEFURV9DSEFOR0UsIGxvZ2dlcik7CiAg\nICAgICAgICAgICAgICAvLyBOb3QgZXhwZWN0ZWQgYWN0dWFsbHksIHByZXNl\nbnQgdG8gZ3VhcmQgYWdhaW5zdCBmdXR1cmUgY2hhbmdlcyAuLi4KICAgICAg\nICAgICAgICAgIGlmIChjb25uZWN0aW9uU3RhdGUuaXNUcmFuc2l0aW9uU3Rh\ndGUoKSkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlv\nbigiQ29ubmVjdGlvbiBkaWQgbm90IG1ha2Ugc3RhdGUgY2hhbmdlIHRvIHN0\nZWFkeSBzdGF0ZSA/Iik7CgogICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rp\nb25TdGF0ZS5pc0Nsb3NlZCgpKSB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJD\nb25uZWN0aW9uIGFscmVhZHkgY2xvc2VkIik7CgogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBhc3NlcnQgU3RhdGVNYW5hZ2VyLlN0YXRlLlNUT1BQRUQg\nPT0gY29ubmVjdGlvblN0YXRlLmdldEN1cnJlbnRTdGF0ZSgpIHx8CiAgICAg\nICAgICAgICAgICAgICAgU3RhdGVNYW5hZ2VyLlN0YXRlLlNUQVJURUQgPT0g\nY29ubmVjdGlvblN0YXRlLmdldEN1cnJlbnRTdGF0ZSgpOwoKICAgICAgICAg\nICAgLy8gY3JlYXRlIHdpdGhpbiBsb2NrLCBzbyB0aGF0IGl0IGNhbiByZWdp\nc3RlciB3aXRoIGNvbm5lY3Rpb24sIGV0YyAuLi4KICAgICAgICAgICAgLy8g\nc2Vzc2lvbiA9IG5ldyBTZXNzaW9uSW1wbCh0aGlzLCB0cmFuc2FjdGVkLCBh\nY2tub3dsZWRnZU1vZGUpOwogICAgICAgICAgICBmaW5hbCBTZXNzaW9uSW1w\nbCBzZXNzaW9uID0gY3JlYXRlU2Vzc2lvbkluc3RhbmNlKHRyYW5zYWN0ZWQs\nIGFja25vd2xlZGdlTW9kZSwgdHlwZSk7CiAgICAgICAgICAgIHNlc3Npb25M\naXN0LmFkZChzZXNzaW9uKTsKICAgICAgICAgICAgbmVlZFN0YXJ0ID0gY29u\nbmVjdGlvblN0YXRlLmlzU3RhcnRlZCgpOwoKICAgICAgICAgICAgaWYgKG5l\nZWRTdGFydCkgc2Vzc2lvbi5zdGFydCgpOwogICAgICAgICAgICByZXR1cm4g\nc2Vzc2lvbjsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IFNlc3Npb25JbXBsIGNyZWF0ZVNlc3Npb25JbnN0YW5jZShib29sZWFu\nIHRyYW5zYWN0ZWQsIGludCBhY2tub3dsZWRnZU1vZGUsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25UeXBlIHR5cGUp\nCiAgICAgICAgdGhyb3dzIEpNU0V4Y2VwdGlvbjsKCiAgICBwdWJsaWMgYm9v\nbGVhbiByZW1vdmVTZXNzaW9uKFNlc3Npb25JbXBsIHNlc3Npb24pewogICAg\nICAgIC8vIHNpbXBseSByZW1vdmUuCiAgICAgICAgc3luY2hyb25pemVkIChs\nb2NrT2JqZWN0KXsKICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25MaXN0LnJl\nbW92ZShzZXNzaW9uKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiB7QGluaGVyaXREb2N9CiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIFN0cmluZyBnZXRDbGllbnRJRCgpIHsKICAgICAgICByZXR1cm4gY2xp\nZW50SUQ7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbGxvdyBjbGllbnRJRCB0\nbyBiZSBzZXQgb25seSBpZiBpdCBpcyBOT1QgYWRtaW5pc3RyYXRpdmVseSBj\nb25maWd1cmVkIGZvciBjb25uZWN0aW9uLiAoNC4zLjIpCiAgICAgKiBTaW5j\nZSB3ZSBkbyBub3Qgd29yayAoeWV0KSB3aXRoaW4gdGhlIGNvbnRleHQgb2Yg\nYSBjb250YWluZXIsIHRoaXMgYXNwZWN0IGlzIGEgVE9ETyBmb3Igbm93Lgog\nICAgICoKICAgICAqIHtAaW5oZXJpdERvY30KICAgICAqLwogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBzZXRDbGllbnRJRChTdHJpbmcgY2xpZW50\nSUQpIHRocm93cyBJbnZhbGlkQ2xpZW50SURFeGNlcHRpb24sIGphdmF4Lmpt\ncy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24gewogICAgICAgIGlmIChudWxsID09\nIGNsaWVudElEKSB0aHJvdyBuZXcgSW52YWxpZENsaWVudElERXhjZXB0aW9u\nKCJjbGllbnRJZCBzcGVjaWZpZWQgaXMgbnVsbCIpOwoKICAgICAgICBzeW5j\naHJvbml6ZWQgKGdsb2JhbENsaWVudElkU2V0KXsKICAgICAgICAgICAgaWYg\nKGdsb2JhbENsaWVudElkU2V0LmNvbnRhaW5zKGNsaWVudElEKSkKICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSW52YWxpZENsaWVudElERXhjZXB0aW9uKCJj\nbGllbnRJZCAnIiArIGNsaWVudElEICsgIicgYWxyZWFkeSBpbiB1c2UgaW4g\ndGhpcyBwcm92aWRlciIpOwogICAgICAgICAgICBpZiAobnVsbCAhPSB0aGlz\nLmNsaWVudElEICYmICF0aGlzLmNsaWVudElELmVxdWFscyhjbGllbnRJRCkp\nCiAgICAgICAgICAgICAgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oImNsaWVudElEIGFscmVhZHkgc2V0IHRvICIgKyB0aGlz\nLmNsaWVudElEICsKICAgICAgICAgICAgICAgICAgIiwgY2FudCBvdmVycmlk\nZSB0byAiICsgY2xpZW50SUQpOwogICAgICAgICAgICB0aGlzLmNsaWVudElE\nID0gY2xpZW50SUQ7CiAgICAgICAgICAgIGdsb2JhbENsaWVudElkU2V0LmFk\nZChjbGllbnRJRCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\ne0Bpbmhlcml0RG9jfQogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyBDb25uZWN0aW9uTWV0YURhdGEgZ2V0TWV0YURhdGEoKSB0aHJvd3MgSk1T\nRXhjZXB0aW9uIHsKICAgICAgICAvLyByZXR1cm4gbmV3IENvbm5lY3Rpb25N\nZXRhRGF0YUltcGwoKTsKICAgICAgICByZXR1cm4gbWV0YWRhdGE7CiAgICB9\nCgogICAgLyoqCiAgICAgKiB7QGluaGVyaXREb2N9CiAgICAgKi8KICAgIEBP\ndmVycmlkZQogICAgcHVibGljIEV4Y2VwdGlvbkxpc3RlbmVyIGdldEV4Y2Vw\ndGlvbkxpc3RlbmVyKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIGV4Y2VwdGlvbkxpc3RlbmVyOwogICAgfQoKICAgIC8qKgogICAg\nICoge0Bpbmhlcml0RG9jfQogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIHNldEV4Y2VwdGlvbkxpc3RlbmVyKEV4Y2VwdGlvbkxpc3Rl\nbmVyIGV4Y2VwdGlvbkxpc3RlbmVyKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsK\nICAgICAgICB0aGlzLmV4Y2VwdGlvbkxpc3RlbmVyID0gZXhjZXB0aW9uTGlz\ndGVuZXI7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdENvbm5lY3Rpb25D\nbGllbnRJRCgpIHRocm93cyBqYXZheC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0\naW9uLCBJbnZhbGlkQ2xpZW50SURFeGNlcHRpb24gewogICAgICAgIHN5bmNo\ncm9uaXplZCAobG9ja09iamVjdCl7CiAgICAgICAgICAgIC8vIGRlZmF1bHQg\ndG8gaGVkd2lnX2NsaWVudF9pZCA/CiAgICAgICAgICAgIGlmIChudWxsID09\nIGNsaWVudElEKSBzZXRDbGllbnRJRChTZXNzaW9uSW1wbC5nZW5lcmF0ZVJh\nbmRvbVN0cmluZygpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiB7QGluaGVyaXREb2N9CiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgc3RhcnQoKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKCiAgICAg\nICAgZmluYWwgU3RhdGVNYW5hZ2VyLlN0YXRlIHByZXZTdGF0ZTsKICAgICAg\nICBmaW5hbCBMaXN0PFNlc3Npb25JbXBsPiBzZXNzaW9uTGlzdENvcHk7Cgog\nICAgICAgIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRy\nYWNlKCJBdHRlbXB0aW5nIHRvIHN0YXJ0IGNvbm5lY3Rpb24iKTsKCiAgICAg\nICAgc3luY2hyb25pemVkIChsb2NrT2JqZWN0KXsKICAgICAgICAgICAgaWYg\nKGNvbm5lY3Rpb25TdGF0ZS5pc1N0YXJ0ZWQoKSkgcmV0dXJuIDsKICAgICAg\nICAgICAgaWYgKGNvbm5lY3Rpb25TdGF0ZS5pc0Nsb3NlZCgpKSB0aHJvdyBu\nZXcgSk1TRXhjZXB0aW9uKCJDb25uZWN0aW9uIGFscmVhZHkgY2xvc2VkIik7\nCgogICAgICAgICAgICBpZiAoY29ubmVjdGlvblN0YXRlLmlzVHJhbnNpdGlv\nblN0YXRlKCkpewogICAgICAgICAgICAgICAgY29ubmVjdGlvblN0YXRlLndh\naXRGb3JUcmFuc2llbnRTdGF0ZUNoYW5nZShTdGF0ZU1hbmFnZXIuV0FJVF9U\nSU1FX0ZPUl9UUkFOU0lFTlRfU1RBVEVfQ0hBTkdFLCBsb2dnZXIpOwogICAg\nICAgICAgICAgICAgLy8gTm90IGV4cGVjdGVkIGFjdHVhbGx5LCBwcmVzZW50\nIHRvIGd1YXJkIGFnYWluc3QgZnV0dXJlIGNoYW5nZXMgLi4uCiAgICAgICAg\nICAgICAgICBpZiAoY29ubmVjdGlvblN0YXRlLmlzVHJhbnNpdGlvblN0YXRl\nKCkpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24o\nIkNvbm5lY3Rpb24gZGlkIG5vdCBtYWtlIHN0YXRlIGNoYW5nZSB0byBzdGVh\nZHkgc3RhdGUgPyIpOwoKICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9u\nU3RhdGUuaXNDbG9zZWQoKSkgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiQ29u\nbmVjdGlvbiBhbHJlYWR5IGNsb3NlZCIpOwogICAgICAgICAgICAgICAgaWYg\nKGNvbm5lY3Rpb25TdGF0ZS5pc1N0YXJ0ZWQoKSkgcmV0dXJuIDsKCiAgICAg\nICAgICAgICAgICBhc3NlcnQgY29ubmVjdGlvblN0YXRlLmlzU3RvcHBlZCgp\nOwogICAgICAgICAgICAgICAgLy8gdHJ5IGFnYWluIC4uLgogICAgICAgICAg\nICB9CgogICAgICAgICAgICBwcmV2U3RhdGUgPSBjb25uZWN0aW9uU3RhdGUu\nZ2V0Q3VycmVudFN0YXRlKCk7CiAgICAgICAgICAgIGNvbm5lY3Rpb25TdGF0\nZS5zZXRDdXJyZW50U3RhdGUoU3RhdGVNYW5hZ2VyLlN0YXRlLlNUQVJUSU5H\nKTsKICAgICAgICAgICAgaW5pdENvbm5lY3Rpb25DbGllbnRJRCgpOwogICAg\nICAgICAgICBzZXNzaW9uTGlzdENvcHkgPSBuZXcgQXJyYXlMaXN0PFNlc3Np\nb25JbXBsPihzZXNzaW9uTGlzdCk7CiAgICAgICAgfQoKICAgICAgICBTdGF0\nZU1hbmFnZXIuU3RhdGUgbmV4dFN0YXRlID0gcHJldlN0YXRlOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIC8vIFRoZXJlIHdpbGwgYmUgb25seSBvbmUg\ndGhyZWFkIGRvd24gaGVyZSAuLi4KCiAgICAgICAgICAgIC8vIHN0YXJ0IGFu\neSBwcm92aWRlciBzcGVjaWZpYyBpbXBsZW1lbnRhdGlvbiBib290c3RyYXAg\nLi4uCiAgICAgICAgICAgIGRvU3RhcnQodXNlciwgcGFzc3dvcmQpOwogICAg\nICAgICAgICAvLyBDb3B5IHRvIHByZXZlbnQgY29uY3VycmVudCBtb2QgZXhj\nZXB0aW9ucy4KICAgICAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxl\nZCgpKSBsb2dnZXIudHJhY2UoIlN0YXJ0aW5nICIgKyBzZXNzaW9uTGlzdENv\ncHkuc2l6ZSgpICsgIiBzZXNzaW9ucyIpOwogICAgICAgICAgICBmb3IgKFNl\nc3Npb25JbXBsIHNlc3Npb24gOiBzZXNzaW9uTGlzdENvcHkpIHsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5z\ndGFydCgpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSk1TRXhjZXB0aW9u\nIGpleCl7CiAgICAgICAgICAgICAgICAgICAgLy8gbG9nIHRoZSBlcnJvciBh\nbmQgaWdub3JlCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0lu\nZm9FbmFibGVkKCkpIGxvZ2dlci5pbmZvKCJleGNlcHRpb24gc3RhcnRpbmcg\nc2Vzc2lvbiA6ICIgKyBqZXgpOwogICAgICAgICAgICAgICAgICAgIERlYnVn\nVXRpbC5kdW1wSk1TU3RhY2t0cmFjZShsb2dnZXIsIGpleCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dFN0YXRl\nID0gU3RhdGVNYW5hZ2VyLlN0YXRlLlNUQVJURUQ7CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgLy8gc2V0IHN0YXR1cyBhbmQgbm90aWZ5Lgog\nICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2tPYmplY3QpewogICAgICAg\nICAgICAgICAgY29ubmVjdGlvblN0YXRlLnNldEN1cnJlbnRTdGF0ZShuZXh0\nU3RhdGUpOwogICAgICAgICAgICAgICAgbG9ja09iamVjdC5ub3RpZnlBbGwo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCgogICAgcHJvdGVj\ndGVkIFN0cmluZyBnZXRVc2VyKCl7CiAgICAgICAgcmV0dXJuIHVzZXI7CiAg\nICB9CiAgICBwcm90ZWN0ZWQgU3RyaW5nIGdldFBhc3N3b3JkKCl7CiAgICAg\nICAgcmV0dXJuIHBhc3N3b3JkOwogICAgfQoKICAgIHByb3RlY3RlZCBhYnN0\ncmFjdCB2b2lkIGRvU3RhcnQoU3RyaW5nIHVzZXIsIFN0cmluZyBwYXNzd29y\nZCkgdGhyb3dzIEpNU0V4Y2VwdGlvbjsKICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCB2b2lkIGRvU3RvcCgpOwogICAgcHJvdGVjdGVkIGFic3RyYWN0IHZvaWQg\nZG9DbG9zZSgpOwoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc3Rv\ncCgpIHRocm93cyBKTVNFeGNlcHRpb24gewoKICAgICAgICBmaW5hbCBTdGF0\nZU1hbmFnZXIuU3RhdGUgcHJldlN0YXRlOwogICAgICAgIGZpbmFsIExpc3Q8\nU2Vzc2lvbkltcGw+IHNlc3Npb25MaXN0Q29weTsKCiAgICAgICAgaWYgKGxv\nZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dnZXIudHJhY2UoIkF0dGVtcHRp\nbmcgdG8gc3RvcCBjb25uZWN0aW9uIik7CgogICAgICAgIHN5bmNocm9uaXpl\nZCAobG9ja09iamVjdCl7CiAgICAgICAgICAgIGlmIChjb25uZWN0aW9uU3Rh\ndGUuaXNDbG9zZWQoKSkgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiQWxyZWFk\neSBjbG9zZWQiKTsKICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb25TdGF0ZS5p\nc1N0b3BwZWQoKSkgcmV0dXJuIDsKCiAgICAgICAgICAgIGlmIChjb25uZWN0\naW9uU3RhdGUuaXNUcmFuc2l0aW9uU3RhdGUoKSl7CiAgICAgICAgICAgICAg\nICBjb25uZWN0aW9uU3RhdGUud2FpdEZvclRyYW5zaWVudFN0YXRlQ2hhbmdl\nKFN0YXRlTWFuYWdlci5XQUlUX1RJTUVfRk9SX1RSQU5TSUVOVF9TVEFURV9D\nSEFOR0UsIGxvZ2dlcik7CiAgICAgICAgICAgICAgICAvLyBOb3QgZXhwZWN0\nZWQgYWN0dWFsbHksIHByZXNlbnQgdG8gZ3VhcmQgYWdhaW5zdCBmdXR1cmUg\nY2hhbmdlcyAuLi4KICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uU3Rh\ndGUuaXNUcmFuc2l0aW9uU3RhdGUoKSkKICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEpNU0V4Y2VwdGlvbigiQ29ubmVjdGlvbiBkaWQgbm90IG1ha2Ug\nc3RhdGUgY2hhbmdlIHRvIHN0ZWFkeSBzdGF0ZSA/Iik7CgogICAgICAgICAg\nICAgICAgaWYgKGNvbm5lY3Rpb25TdGF0ZS5pc0Nsb3NlZCgpKSB0aHJvdyBu\nZXcgSk1TRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIpOwogICAgICAgICAg\nICAgICAgaWYgKGNvbm5lY3Rpb25TdGF0ZS5pc1N0b3BwZWQoKSkgcmV0dXJu\nIDsKCiAgICAgICAgICAgICAgICBhc3NlcnQgY29ubmVjdGlvblN0YXRlLmlz\nU3RhcnRlZCgpOwoKICAgICAgICAgICAgICAgIC8vIHRyeSAoYWdhaW4gPykg\nLi4uCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHByZXZTdGF0ZSA9IGNv\nbm5lY3Rpb25TdGF0ZS5nZXRDdXJyZW50U3RhdGUoKTsKICAgICAgICAgICAg\nY29ubmVjdGlvblN0YXRlLnNldEN1cnJlbnRTdGF0ZShTdGF0ZU1hbmFnZXIu\nU3RhdGUuU1RPUFBJTkcpOwogICAgICAgICAgICBzZXNzaW9uTGlzdENvcHkg\nPSBuZXcgQXJyYXlMaXN0PFNlc3Npb25JbXBsPihzZXNzaW9uTGlzdCk7CiAg\nICAgICAgfQoKICAgICAgICBTdGF0ZU1hbmFnZXIuU3RhdGUgbmV4dFN0YXRl\nID0gcHJldlN0YXRlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIElu\nIGNhc2UgdGhlcmUgYXJlIGFueSBzcGVjaWZpYyBjaGFuZ2VzIHRvIGJlIGRv\nbmUuCiAgICAgICAgICAgIC8vIENvcHkgdG8gcHJldmVudCBjb25jdXJyZW50\nIG1vZCBleGNlcHRpb25zLgoKICAgICAgICAgICAgLy8gU3RvcCBhbGwgc2Vz\nc2lvbnMgLSBkb2luZyB0aGlzIHdpdGhpbiBNVC1zYWZlIGJsb2NrIHRvIHBy\nZXZlbnQgYW55IHBvc3NpYmlsaXR5IG9mIHJhY2UgY29uZGl0aW9ucy4KICAg\nICAgICAgICAgLy8gUG90ZW50aWFsbHkgZXhwZW5zaXZlLCBidXQgaXQgaXMg\nYSB0cmFkZW9mZiBiZXR3ZWVuIGNvcnJlY3RuZXNzIGFuZCBwZXJmb3JtYW5j\nZSA6LSgKICAgICAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgp\nKSBsb2dnZXIudHJhY2UoIlN0b3BwaW5nICIgKyBzZXNzaW9uTGlzdENvcHku\nc2l6ZSgpICsgIiBzZXNzaW9ucyIpOwogICAgICAgICAgICBmb3IgKFNlc3Np\nb25JbXBsIHNlc3Npb24gOiBzZXNzaW9uTGlzdENvcHkpIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5zdG9w\nKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRpb24gamV4\nKXsKICAgICAgICAgICAgICAgICAgICAvLyBsb2cgdGhlIGVycm9yIGFuZCBp\nZ25vcmUKICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzSW5mb0Vu\nYWJsZWQoKSkgbG9nZ2VyLmluZm8oImV4Y2VwdGlvbiBjbG9zaW5nIHNlc3Np\nb24gOiAiICsgamV4KTsKICAgICAgICAgICAgICAgICAgICBEZWJ1Z1V0aWwu\nZHVtcEpNU1N0YWNrdHJhY2UobG9nZ2VyLCBqZXgpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIHN0b3AgY29ubmVj\ndGlvbiBBRlRFUiBzZXNzaW9uJ3MgYXJlIHN0b3BwZWQuCiAgICAgICAgICAg\nIGRvU3RvcCgpOwogICAgICAgICAgICBuZXh0U3RhdGUgPSBTdGF0ZU1hbmFn\nZXIuU3RhdGUuU1RPUFBFRDsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICAvLyBzZXQgc3RhdHVzIGFuZCBub3RpZnkuCiAgICAgICAgICAgIHN5\nbmNocm9uaXplZCAobG9ja09iamVjdCl7CiAgICAgICAgICAgICAgICBsb2Nr\nT2JqZWN0Lm5vdGlmeUFsbCgpOwogICAgICAgICAgICAgICAgY29ubmVjdGlv\nblN0YXRlLnNldEN1cnJlbnRTdGF0ZShuZXh0U3RhdGUpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIHZvaWQgY2xvc2UoKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKCiAgICAgICAg\nZmluYWwgU3RhdGVNYW5hZ2VyLlN0YXRlIHByZXZTdGF0ZTsKICAgICAgICBm\naW5hbCBMaXN0PFNlc3Npb25JbXBsPiBzZXNzaW9uTGlzdENvcHk7CgogICAg\nICAgIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNl\nKCJBdHRlbXB0aW5nIHRvIGNsb3NlIGNvbm5lY3Rpb24iKTsKCiAgICAgICAg\nc3luY2hyb25pemVkIChsb2NrT2JqZWN0KXsKICAgICAgICAgICAgaWYgKGNv\nbm5lY3Rpb25TdGF0ZS5pc0Nsb3NlZCgpKSByZXR1cm4gOwogICAgICAgICAg\nICBpZiAoISBjb25uZWN0aW9uU3RhdGUuaXNTdG9wcGVkKCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChjb25uZWN0aW9uU3RhdGUuaXNUcmFuc2l0aW9uU3Rh\ndGUoKSl7CiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvblN0YXRlLndh\naXRGb3JUcmFuc2llbnRTdGF0ZUNoYW5nZSgKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIFN0YXRlTWFuYWdlci5XQUlUX1RJTUVfRk9SX1RSQU5TSUVO\nVF9TVEFURV9DSEFOR0UsIGxvZ2dlcik7CiAgICAgICAgICAgICAgICAgICAg\nLy8gTm90IGV4cGVjdGVkIGFjdHVhbGx5LCBwcmVzZW50IHRvIGd1YXJkIGFn\nYWluc3QgZnV0dXJlIGNoYW5nZXMgLi4uCiAgICAgICAgICAgICAgICAgICAg\naWYgKGNvbm5lY3Rpb25TdGF0ZS5pc1RyYW5zaXRpb25TdGF0ZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiQ29u\nbmVjdGlvbiBkaWQgbm90IG1ha2Ugc3RhdGUgY2hhbmdlIHRvIHN0ZWFkeSBz\ndGF0ZSA/Iik7CgogICAgICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9u\nU3RhdGUuaXNDbG9zZWQoKSkgcmV0dXJuIDsKCiAgICAgICAgICAgICAgICAg\nICAgYXNzZXJ0IGNvbm5lY3Rpb25TdGF0ZS5pc1N0YXJ0ZWQoKSB8fCBjb25u\nZWN0aW9uU3RhdGUuaXNTdG9wcGVkKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHByZXZTdGF0ZSA9IGNvbm5lY3Rp\nb25TdGF0ZS5nZXRDdXJyZW50U3RhdGUoKTsKICAgICAgICAgICAgY29ubmVj\ndGlvblN0YXRlLnNldEN1cnJlbnRTdGF0ZShTdGF0ZU1hbmFnZXIuU3RhdGUu\nQ0xPU0lORyk7CiAgICAgICAgICAgIHNlc3Npb25MaXN0Q29weSA9IG5ldyBB\ncnJheUxpc3Q8U2Vzc2lvbkltcGw+KHNlc3Npb25MaXN0KTsKICAgICAgICB9\nCgogICAgICAgIFN0YXRlTWFuYWdlci5TdGF0ZSBuZXh0U3RhdGUgPSBwcmV2\nU3RhdGU7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENvcHkgdG8g\ncHJldmVudCBjb25jdXJyZW50IG1vZCBleGNlcHRpb25zLgoKICAgICAgICAg\nICAgLy8gQ2xvc2UgYWxsIHNlc3Npb25zIC0gZG9pbmcgdGhpcyB3aXRoaW4g\nTVQtc2FmZSBibG9jayB0byBwcmV2ZW50IGFueSBwb3NzaWJpbGl0eSBvZiBy\nYWNlIGNvbmRpdGlvbnMuCiAgICAgICAgICAgIC8vIFBvdGVudGlhbGx5IGV4\ncGVuc2l2ZSwgYnV0IGl0IGlzIGEgdHJhZGVvZmYgYmV0d2VlbiBjb3JyZWN0\nbmVzcyBhbmQgcGVyZm9ybWFuY2UgOi0oCiAgICAgICAgICAgIGlmIChsb2dn\nZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJDbG9zaW5nICIg\nKyBzZXNzaW9uTGlzdENvcHkuc2l6ZSgpICsgIiBzZXNzaW9ucyIpOwogICAg\nICAgICAgICBmb3IgKFNlc3Npb25JbXBsIHNlc3Npb24gOiBzZXNzaW9uTGlz\ndENvcHkpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgc2Vzc2lvbi5jbG9zZSgpOwogICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGV4KXsKICAgICAgICAgICAgICAgICAgICAvLyBsb2cg\ndGhlIGVycm9yIGFuZCBpZ25vcmUKICAgICAgICAgICAgICAgICAgICBpZiAo\nbG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIGxvZ2dlci5kZWJ1ZygiZXhjZXB0\naW9uIGNsb3Npbmcgc2Vzc2lvbiIsIGV4KTsKICAgICAgICAgICAgICAgICAg\nICBlbHNlIGlmIChsb2dnZXIuaXNJbmZvRW5hYmxlZCgpKSBsb2dnZXIuaW5m\nbygiZXhjZXB0aW9uIGNsb3Npbmcgc2Vzc2lvbiA6ICIgKyBleCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZG9DbG9z\nZSgpOwogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGdsb2JhbENsaWVudElk\nU2V0KXsKICAgICAgICAgICAgICAgIGFzc2VydCAobnVsbCAhPSBnZXRDbGll\nbnRJRCgpKTsKICAgICAgICAgICAgICAgIGdsb2JhbENsaWVudElkU2V0LnJl\nbW92ZShnZXRDbGllbnRJRCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBuZXh0U3RhdGUgPSBTdGF0ZU1hbmFnZXIuU3RhdGUuQ0xPU0VEOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIC8vIHNldCBzdGF0dXMgYW5k\nIG5vdGlmeS4KICAgICAgICAgICAgc3luY2hyb25pemVkIChsb2NrT2JqZWN0\nKXsKICAgICAgICAgICAgICAgIGxvY2tPYmplY3Qubm90aWZ5QWxsKCk7Cgog\nICAgICAgICAgICAgICAgaWYgKFN0YXRlTWFuYWdlci5TdGF0ZS5DTE9TRUQg\nPT0gbmV4dFN0YXRlICYmICFjb25uZWN0aW9uU3RhdGUuaXNDbG9zZWQoKSkg\newogICAgICAgICAgICAgICAgICAgIC8vIGNsZWFyIHNlc3Npb25zLgogICAg\nICAgICAgICAgICAgICAgIHNlc3Npb25MaXN0LmNsZWFyKCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBzZXQgYWZ0ZXIgZXZlcnl0\naGluZyBpcyBkb25lLgogICAgICAgICAgICAgICAgY29ubmVjdGlvblN0YXRl\nLnNldEN1cnJlbnRTdGF0ZShuZXh0U3RhdGUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENvbm5l\nY3Rpb25Db25zdW1lciBjcmVhdGVDb25uZWN0aW9uQ29uc3VtZXIoRGVzdGlu\nYXRpb24gZGVzdGluYXRpb24sIFN0cmluZyBtZXNzYWdlU2VsZWN0b3IsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBTZXJ2ZXJTZXNzaW9uUG9vbCBzZXNzaW9uUG9vbCwgaW50IG1h\neE1lc3NhZ2VzKQogICAgICAgIHRocm93cyBKTVNFeGNlcHRpb24gewoKICAg\nICAgICB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJVbnN1cHBvcnRlZCIpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIENvbm5lY3Rpb25Db25z\ndW1lciBjcmVhdGVEdXJhYmxlQ29ubmVjdGlvbkNvbnN1bWVyKFRvcGljIHRv\ncGljLCBTdHJpbmcgc3Vic2NyaXB0aW9uTmFtZSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBTdHJpbmcgbWVzc2FnZVNlbGVjdG9yLCBTZXJ2ZXJTZXNzaW9uUG9vbCBz\nZXNzaW9uUG9vbCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgbWF4TWVzc2FnZXMp\nCiAgICAgICAgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CgogICAgICAgIHRocm93\nIG5ldyBKTVNFeGNlcHRpb24oIlVuc3VwcG9ydGVkIik7CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgQ29ubmVjdGlvbkNvbnN1bWVyIGNyZWF0\nZUNvbm5lY3Rpb25Db25zdW1lcihRdWV1ZSBxdWV1ZSwgU3RyaW5nIHMsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBTZXJ2ZXJTZXNzaW9uUG9vbCBzZXJ2ZXJTZXNzaW9uUG9vbCwg\naW50IG1heE1lc3NhZ2VzKQogICAgICAgIHRocm93cyBKTVNFeGNlcHRpb24g\newoKICAgICAgICB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJVbnN1cHBvcnRl\nZCIpOwogICAgfQoKCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBDb25uZWN0\naW9uQ29uc3VtZXIgY3JlYXRlQ29ubmVjdGlvbkNvbnN1bWVyKFRvcGljIHRv\ncGljLCBTdHJpbmcgbWVzc2FnZVNlbGVjdG9yLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VydmVy\nU2Vzc2lvblBvb2wgc2Vzc2lvblBvb2wsIGludCBtYXhNZXNzYWdlcykKICAg\nICAgICB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKCiAgICAgICAgdGhyb3cgbmV3\nIEpNU0V4Y2VwdGlvbigiVW5zdXBwb3J0ZWQiKTsKICAgIH0KCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0luU3RhcnRNb2RlKCkgewogICAgICAgIHJldHVybiBj\nb25uZWN0aW9uU3RhdGUuaXNJblN0YXJ0TW9kZSgpOwogICAgfQoKICAgIHBy\nb3RlY3RlZCBhYnN0cmFjdCBNZXNzYWdpbmdTZXNzaW9uRmFjYWRlIGNyZWF0\nZU1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUoU2Vzc2lvbkltcGwgc2Vzc2lvbikg\ndGhyb3dzIEpNU0V4Y2VwdGlvbjsKCgogICAgLy8gcmVxdWlyZWQgdG8gY2F0\nY2ggcmVzb3VyY2UgbGVha3MgLi4uCiAgICBAT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCB2b2lkIGZpbmFsaXplKCkgdGhyb3dzIFRocm93YWJsZSB7CiAgICAg\nICAgc3VwZXIuZmluYWxpemUoKTsKICAgICAgICBpZiAoIWNvbm5lY3Rpb25T\ndGF0ZS5pc0Nsb3NlZCgpKSB7CiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNF\ncnJvckVuYWJsZWQoKSkgbG9nZ2VyLmVycm9yKCJDb25uZWN0aW9uIHdhcyBO\nT1QgY2xvc2VkIGJlZm9yZSBpdCB3ZW50IG91dCBvZiBzY29wZSIpOwogICAg\nICAgICAgICBjbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBpbnQgTE9DQUxMWV9TRU5UX01FU1NBR0VfSURfQ0FD\nSEVfU0laRSA9CiAgICAgICAgSW50ZWdlci5nZXRJbnRlZ2VyKCJMT0NBTExZ\nX1NFTlRfTUVTU0FHRV9JRF9DQUNIRV9TSVpFIiwgMTAyNCk7CiAgICAvLyBU\naGlzIGlzIGdhdXJkZWQgYnkgcHVibGlzaGVkTWVzc2FnZUlkcwogICAgcHJp\ndmF0ZSBmaW5hbCBMUlVDYWNoZVNldDxTdHJpbmc+IHB1Ymxpc2hlZE1lc3Nh\nZ2VJZHMgPQogICAgICAgIG5ldyBMUlVDYWNoZVNldDxTdHJpbmc+KExPQ0FM\nTFlfU0VOVF9NRVNTQUdFX0lEX0NBQ0hFX1NJWkUsIHRydWUpOwoKICAgIGJv\nb2xlYW4gaXNMb2NhbGx5UHVibGlzaGVkKFN0cmluZyBtZXNzYWdlSWQpewoK\nICAgICAgICBpZiAobnVsbCA9PSBtZXNzYWdlSWQpIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgc3luY2hyb25pemVkKHB1Ymxpc2hlZE1lc3NhZ2VJZHMpewog\nICAgICAgICAgICByZXR1cm4gcHVibGlzaGVkTWVzc2FnZUlkcy5jb250YWlu\ncyhtZXNzYWdlSWQpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIGFkZFRv\nTG9jYWxseVB1Ymxpc2hlZE1lc3NhZ2VJZHMoU3RyaW5nIG1lc3NhZ2VJZCl7\nCgogICAgICAgIGlmIChudWxsID09IG1lc3NhZ2VJZCkgcmV0dXJuIDsKCiAg\nICAgICAgc3luY2hyb25pemVkKHB1Ymxpc2hlZE1lc3NhZ2VJZHMpewogICAg\nICAgICAgICBwdWJsaXNoZWRNZXNzYWdlSWRzLmFkZChtZXNzYWdlSWQpOwog\nICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

