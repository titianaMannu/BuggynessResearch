{"sha":"f86d9559b5c8869f39e57a21002929bd10b065d1","node_id":"MDQ6QmxvYjE1NzU5NTY6Zjg2ZDk1NTliNWM4ODY5ZjM5ZTU3YTIxMDAyOTI5YmQxMGIwNjVkMQ==","size":89535,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f86d9559b5c8869f39e57a21002929bd10b065d1","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXM7CgppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuam1zLm1lc3NhZ2UuQnl0ZXNNZXNzYWdlSW1wbDsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLmptcy5tZXNzYWdlLk1hcE1lc3NhZ2VJbXBs\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuam1zLm1lc3NhZ2UuTWVzc2Fn\nZUltcGw7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5qbXMubWVzc2FnZS5N\nZXNzYWdlVXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmptcy5tZXNz\nYWdlLk9iamVjdE1lc3NhZ2VJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcuam1zLm1lc3NhZ2UuU3RyZWFtTWVzc2FnZUltcGw7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5qbXMubWVzc2FnZS5UZXh0TWVzc2FnZUltcGw7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuc2VsZWN0b3IuTm9kZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmptcy5zZWxlY3Rvci5TZWxlY3RvclBh\ncnNlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBqYXZheC5qbXMuQnl0ZXNNZXNz\nYWdlOwppbXBvcnQgamF2YXguam1zLkRlc3RpbmF0aW9uOwppbXBvcnQgamF2\nYXguam1zLkludmFsaWREZXN0aW5hdGlvbkV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmF4Lmptcy5KTVNFeGNlcHRpb247CmltcG9ydCBqYXZheC5qbXMuTWFwTWVz\nc2FnZTsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlOwppbXBvcnQgamF2YXgu\nam1zLk1lc3NhZ2VDb25zdW1lcjsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdl\nTGlzdGVuZXI7CmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZVByb2R1Y2VyOwpp\nbXBvcnQgamF2YXguam1zLk9iamVjdE1lc3NhZ2U7CmltcG9ydCBqYXZheC5q\nbXMuUXVldWU7CmltcG9ydCBqYXZheC5qbXMuUXVldWVCcm93c2VyOwppbXBv\ncnQgamF2YXguam1zLlF1ZXVlUmVjZWl2ZXI7CmltcG9ydCBqYXZheC5qbXMu\nUXVldWVTZW5kZXI7CmltcG9ydCBqYXZheC5qbXMuU2Vzc2lvbjsKaW1wb3J0\nIGphdmF4Lmptcy5TdHJlYW1NZXNzYWdlOwppbXBvcnQgamF2YXguam1zLlRl\nbXBvcmFyeVF1ZXVlOwppbXBvcnQgamF2YXguam1zLlRlbXBvcmFyeVRvcGlj\nOwppbXBvcnQgamF2YXguam1zLlRleHRNZXNzYWdlOwppbXBvcnQgamF2YXgu\nam1zLlRvcGljOwppbXBvcnQgamF2YXguam1zLlRvcGljUHVibGlzaGVyOwpp\nbXBvcnQgamF2YXguam1zLlRvcGljU3Vic2NyaWJlcjsKaW1wb3J0IGphdmF4\nLmptcy5UcmFuc2FjdGlvblJvbGxlZEJhY2tFeGNlcHRpb247CmltcG9ydCBq\nYXZhLmlvLlNlcmlhbGl6YWJsZTsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JZGVudGl0eUhhc2hN\nYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuVVVJRDsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFwOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuQ29weU9uV3JpdGVBcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsK\nCi8qKgogKiBJbXBsZW1lbnRhdGlvbiBvZiBqbXMgU2Vzc2lvbi4KICogSVMg\nTk9UIE1ULXNhZmUgKDIuOCkgLSBleGNlcHQgZm9yIGNsb3NlKCkKICoKICog\nV2UgYXJlIHlldCB0byBzdXBwb3J0L2ltcGxlbWVudCB0aGlzIC0gbXVzdCBw\nYXNzIGEgZmxhZyB0aHJvdWdoIGNvbnN0cnVjdG9yIG9uICJob3ciIHRoaXMg\nb2JqZWN0CiAqIHdhcyBjcmVhdGVkIGFuZCB1c2UgdGhhdCB0byB0aHJvdyBl\neGNlcHRpb24uLi4KICoKICovCnB1YmxpYyBjbGFzcyBTZXNzaW9uSW1wbCBp\nbXBsZW1lbnRzIFNlc3Npb24gewoKCiAgICBwcml2YXRlIGZpbmFsIHN0YXRp\nYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoU2Vz\nc2lvbkltcGwuY2xhc3MpOwoKICAgIC8vIDhrLCB0b28gaGlnaCA/CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBNQVhfU0VTU0lPTl9CVUZGRVJFRF9N\nRVNTQUdFUyA9CiAgICAgICAgSW50ZWdlci5nZXRJbnRlZ2VyKCJTZXNzaW9u\nLk1BWF9CVUZGRVJFRF9NRVNTQUdFUyIsIDEwMjQgKiA4KTsKICAgIC8vIDAu\nNWsgdG9vIGxvdy9oaWdoID8KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50\nIE1BWF9TVUJTQ1JJQkVSX0JVRkZFUkVEX01FU1NBR0VTID0KICAgICAgICBJ\nbnRlZ2VyLmdldEludGVnZXIoIlNlc3Npb24uTUFYX1NVQlNDUklCRVJfQlVG\nRkVSRURfTUVTU0FHRVMiLCA1MTIpOwoKICAgIC8vIE51bWJlciBvZiBhdHRl\nbXB0cyB0byByZXRyeSBhbmQgc2VlIGlmIGEgdHJhbnNhY3Rpb24ga2VlcHMg\nZ2V0dGluZyByb2xsZWQgYmFjayBhcyBwYXJ0CiAgICAvLyBvZiBhc3luYyBk\nZWxpdmVyeSBvZiBtZXNzYWdlcy4KICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\naW50IFJFVFJZX0RJU1BBVENIX1RPX1RSQU5TQUNUSU9OX0FUVEVNUFRTID0K\nICAgICAgICBJbnRlZ2VyLmdldEludGVnZXIoIlNlc3Npb24uUkVUUllfRElT\nUEFUQ0hfVE9fVFJBTlNBQ1RJT05fQVRURU1QVFMiLCA5KTsKCiAgICBwcml2\nYXRlIGZpbmFsIGJvb2xlYW4gdHJhbnNhY3RlZDsKICAgIHByaXZhdGUgZmlu\nYWwgaW50IGFja25vd2xlZGdlTW9kZTsKICAgIHByaXZhdGUgdm9sYXRpbGUg\nTWVzc2FnZUxpc3RlbmVyIG1lc3NhZ2VMaXN0ZW5lciA9IG51bGw7CgogICAg\ncHJpdmF0ZSBmaW5hbCBDb25uZWN0aW9uSW1wbCBjb25uZWN0aW9uOwogICAg\ncHJpdmF0ZSBmaW5hbCBNZXNzYWdpbmdTZXNzaW9uRmFjYWRlIHNlc3Npb25G\nYWNhZGU7CgogICAgcHJpdmF0ZSBmaW5hbCBPYmplY3QgbG9ja09iamVjdCA9\nIG5ldyBPYmplY3QoKTsKICAgIC8vIE1lc3NhZ2UgcHJvY2Vzc2luZyBsb2Nr\ncyBvbiB0aGlzIG9iamVjdCBpdHNlbGYgLSBldmVyeXRoaW5nIGVsc2Ugb24g\nbG9ja09iamVjdC4gVGhpcyBpcyB0bwogICAgLy8gcHJldmVudCBpbnRlcmFj\ndGlvbnMgd2l0aCBoZWR3aWcgdGhyZWFkaW5nIGlkaW9tcy4KICAgIC8vIG1l\nc3NhZ2VMaXN0IGlzIGEgbGVhZiBpbiBjYWxsIGdyYXBoIC0gc28gaXQgbXVz\ndCBub3QgY2F1c2UgTVQgaW50ZXJhY3Rpb25zIHdpdGggb3RoZXIgbG9ja3MK\nICAgIC8vIGFjcXVpcmVkIHByaW9yIHRvIGl0LgogICAgcHJpdmF0ZSBmaW5h\nbCBMaXN0PFJlY2VpdmVkTWVzc2FnZT4gbWVzc2FnZUxpc3QgPSBuZXcgTGlu\na2VkTGlzdDxSZWNlaXZlZE1lc3NhZ2U+KCk7CiAgICBwcml2YXRlIGZpbmFs\nIExpc3Q8VHJhbnNhY3RlZFJlY2VpdmVPcGVyYXRpb24+IHJvbGxlZGJhY2tN\nZXNzYWdlTGlzdAogICAgICAgID0gbmV3IExpbmtlZExpc3Q8VHJhbnNhY3Rl\nZFJlY2VpdmVPcGVyYXRpb24+KCk7CgogICAgcHJpdmF0ZSBTdGF0ZU1hbmFn\nZXIgc2Vzc2lvblN0YXRlID0gbmV3IFN0YXRlTWFuYWdlcihTdGF0ZU1hbmFn\nZXIuU3RhdGUuU1RPUFBFRCwgbG9ja09iamVjdCk7CgogICAgLy8gU2ltcGx5\nIGVuY2Fwc3VsYXRpbmcgYWxsIHN0YXRlIHdpdGhpbiBhIHNpbmdsZSBjbGFz\ncy4KICAgIHByaXZhdGUgZmluYWwgU3Vic2NyaXB0aW9ucyBzdWJzY3JpcHRp\nb25zID0gbmV3IFN1YnNjcmlwdGlvbnMoKTsKCiAgICBwcml2YXRlIGJvb2xl\nYW4gbWVzc2FnZUxpc3RlbmVyVGhyZWFkU3RhcnRlZCA9IGZhbHNlOwogICAg\ncHJpdmF0ZSBmaW5hbCBUaHJlYWQgbWVzc2FnZUxpc3RlbmVyVGhyZWFkOwog\nICAgcHJpdmF0ZSBib29sZWFuIG1lc3NhZ2VMaXN0ZW5lclRocmVhZEZpbmlz\naGVkID0gZmFsc2U7CgogICAgcHVibGljIFNlc3Npb25JbXBsKENvbm5lY3Rp\nb25JbXBsIGNvbm5lY3Rpb24sIGJvb2xlYW4gdHJhbnNhY3RlZCwgaW50IGFj\na25vd2xlZGdlTW9kZSkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSAhPSBhY2tub3dsZWRnZU1v\nZGUgJiYKICAgICAgICAgICAgU2Vzc2lvbi5DTElFTlRfQUNLTk9XTEVER0Ug\nIT0gYWNrbm93bGVkZ2VNb2RlICYmCiAgICAgICAgICAgIFNlc3Npb24uRFVQ\nU19PS19BQ0tOT1dMRURHRSAhPSBhY2tub3dsZWRnZU1vZGUpewogICAgICAg\nICAgICAvLyBPbjt5IGlmIG5vdCB0cmFuc2FjdGVkICEKICAgICAgICAgICAg\naWYgKCF0cmFuc2FjdGVkKXsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBq\nYXZheC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJVbmtub3duL3Vuc3Vw\ncG9ydGVkIGFja25vd2xlZGdlTW9kZSBzcGVjaWZpZWQgOiAiICsKICAgICAg\nICAgICAgICAgICAgICBhY2tub3dsZWRnZU1vZGUpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgICAgIHRoaXMudHJhbnNhY3RlZCA9IHRyYW5zYWN0\nZWQ7CiAgICAgICAgdGhpcy5hY2tub3dsZWRnZU1vZGUgPSBhY2tub3dsZWRn\nZU1vZGU7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjsK\nICAgICAgICB0aGlzLnNlc3Npb25GYWNhZGUgPSBjb25uZWN0aW9uLmNyZWF0\nZU1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUodGhpcyk7CiAgICAgICAgdGhpcy5t\nZXNzYWdlTGlzdGVuZXJUaHJlYWQgPSBuZXcgVGhyZWFkKHRoaXMsICJKTVMg\nbWVzc2FnZSBsaXN0ZW5lciB0aHJlYWQiKTsKICAgICAgICAvLyBub3QgZGFl\nbW9uLCByaWdodCA/CiAgICAgICAgdGhpcy5tZXNzYWdlTGlzdGVuZXJUaHJl\nYWQuc2V0RGFlbW9uKGZhbHNlKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBCeXRlc01lc3NhZ2UgY3JlYXRlQnl0ZXNNZXNzYWdlKCkgdGhy\nb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHNlc3Npb25TdGF0ZS5p\nc0luQ2xvc2VNb2RlKCkpIHRocm93IG5ldyBqYXZheC5qbXMuSWxsZWdhbFN0\nYXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIpOwogICAgICAgIHJldHVy\nbiBuZXcgQnl0ZXNNZXNzYWdlSW1wbCh0aGlzKTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyBNYXBNZXNzYWdlIGNyZWF0ZU1hcE1lc3NhZ2Uo\nKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0\nYXRlLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxl\nZ2FsU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CiAgICAgICAg\ncmV0dXJuIG5ldyBNYXBNZXNzYWdlSW1wbCh0aGlzKTsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyBNZXNzYWdlIGNyZWF0ZU1lc3NhZ2UoKSB0\naHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRl\nLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2Fs\nU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CiAgICAgICAgcmV0\ndXJuIG5ldyBNZXNzYWdlSW1wbCh0aGlzKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyBPYmplY3RNZXNzYWdlIGNyZWF0ZU9iamVjdE1lc3Nh\nZ2UoKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lv\nblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5J\nbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CiAgICAg\nICAgcmV0dXJuIG5ldyBPYmplY3RNZXNzYWdlSW1wbCh0aGlzLCBudWxsKTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBPYmplY3RNZXNzYWdl\nIGNyZWF0ZU9iamVjdE1lc3NhZ2UoU2VyaWFsaXphYmxlIHNlcmlhbGl6YWJs\nZSkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHNlc3Npb25T\ndGF0ZS5pc0luQ2xvc2VNb2RlKCkpIHRocm93IG5ldyBqYXZheC5qbXMuSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIpOwogICAgICAg\nIHJldHVybiBuZXcgT2JqZWN0TWVzc2FnZUltcGwodGhpcywgc2VyaWFsaXph\nYmxlKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBTdHJlYW1N\nZXNzYWdlIGNyZWF0ZVN0cmVhbU1lc3NhZ2UoKSB0aHJvd3MgSk1TRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUo\nKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24o\nIkFscmVhZHkgY2xvc2VkIik7CiAgICAgICAgcmV0dXJuIG5ldyBTdHJlYW1N\nZXNzYWdlSW1wbCh0aGlzKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyBUZXh0TWVzc2FnZSBjcmVhdGVUZXh0TWVzc2FnZSgpIHRocm93cyBK\nTVNFeGNlcHRpb24gewogICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNJbkNs\nb3NlTW9kZSgpKSB0aHJvdyBuZXcgamF2YXguam1zLklsbGVnYWxTdGF0ZUV4\nY2VwdGlvbigiQWxyZWFkeSBjbG9zZWQiKTsKICAgICAgICByZXR1cm4gbmV3\nIFRleHRNZXNzYWdlSW1wbCh0aGlzKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyBUZXh0TWVzc2FnZSBjcmVhdGVUZXh0TWVzc2FnZShTdHJp\nbmcgcGF5bG9hZCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKHNlc3Npb25TdGF0ZS5pc0luQ2xvc2VNb2RlKCkpIHRocm93IG5ldyBqYXZh\neC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIp\nOwogICAgICAgIHJldHVybiBuZXcgVGV4dE1lc3NhZ2VJbXBsKHRoaXMsIHBh\neWxvYWQpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGJvb2xl\nYW4gZ2V0VHJhbnNhY3RlZCgpIHsKICAgICAgICByZXR1cm4gdHJhbnNhY3Rl\nZDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBpbnQgZ2V0QWNr\nbm93bGVkZ2VNb2RlKCkgewogICAgICAgIHJldHVybiBhY2tub3dsZWRnZU1v\nZGU7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjb21t\naXQoKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICAvLyBBcHBhcmVu\ndGx5LCB3ZSBjYW4gc2VuZCBldmVuIGlmIGNvbm5lY3Rpb24gaXMgbm90IG9w\nZW4gPwogICAgICAgIC8vIGlmICghc2Vzc2lvblN0YXRlLmlzU3RhcnRlZCgp\nKSB0aHJvdyBuZXcgamF2YXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigi\nU2Vzc2lvbiBub3Qgb3BlbiIpOwogICAgICAgIGlmICghZ2V0VHJhbnNhY3Rl\nZCgpKSB0aHJvdyBuZXcgamF2YXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlv\nbigiU2Vzc2lvbiBub3QgdHJhbnNhY3RlZCIpOwogICAgICAgIGlmIChzZXNz\naW9uU3RhdGUuaXNJbkNsb3NlTW9kZSgpKSB0aHJvdyBuZXcgamF2YXguam1z\nLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQWxyZWFkeSBjbG9zZWQiKTsKCiAg\nICAgICAgY29tbWl0VHJhbnNhY3Rpb25TdGF0ZSgpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgcm9sbGJhY2soKSB0aHJvd3MgSk1T\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIXNlc3Npb25TdGF0ZS5pc1N0YXJ0\nZWQoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRp\nb24oIlNlc3Npb24gbm90IG9wZW4iKTsKICAgICAgICBpZiAoIWdldFRyYW5z\nYWN0ZWQoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNl\ncHRpb24oIlNlc3Npb24gbm90IHRyYW5zYWN0ZWQiKTsKICAgICAgICBpZiAo\nc2Vzc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4\nLmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7\nCgogICAgICAgIHJvbGxiYWNrVHJhbnNhY3Rpb25TdGF0ZSgpOwogICAgfQoK\nICAgIHZvaWQgc3RhcnQoKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAg\nICBmaW5hbCBTdGF0ZU1hbmFnZXIuU3RhdGUgcHJldlN0YXRlOwogICAgICAg\nIGZpbmFsIE1hcDxTdWJzY3JpcHRpb24sIENvcHlPbldyaXRlQXJyYXlMaXN0\nPE1lc3NhZ2VDb25zdW1lcj4+IHN1YnNjcmlwdGlvblRvU3Vic2NyaWJlck1h\ncENvcHk7CgogICAgICAgIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkg\nbG9nZ2VyLnRyYWNlKCJBdHRlbXB0aW5nIHRvIHN0YXJ0IHNlc3Npb24iKTsK\nCiAgICAgICAgc3luY2hyb25pemVkIChsb2NrT2JqZWN0KXsKICAgICAgICAg\nICAgLy8gRG8gbm90IHRocm93IGV4Y2VwdGlvbiwgaXQgbWlnaHQgYmUgY29u\nbmVjdGlvbiBzdGFydGluZyB3aGlsZSBhbm90aGVyIHRocmVhZCBtaWdodAog\nICAgICAgICAgICAvLyBiZSBkb2luZyBhIGNsb3NlKCkgLSB0aGVyZSBpcyBh\nCiAgICAgICAgICAgIC8vIHBvdGVudGlhbCByYWNlIHRoZXJlICEKICAgICAg\nICAgICAgLy8gaWYgKGlzQ2xvc2VkKCkpIHRocm93IG5ldyBqYXZheC5qbXMu\nSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIpOwogICAg\nICAgICAgICBpZiAoaXNDbG9zZWQoKSkgcmV0dXJuIDsKICAgICAgICAgICAg\naWYgKHNlc3Npb25TdGF0ZS5pc1N0YXJ0ZWQoKSkgcmV0dXJuIDsKCiAgICAg\nICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNUcmFuc2l0aW9uU3RhdGUoKSl7\nCiAgICAgICAgICAgICAgICBzZXNzaW9uU3RhdGUud2FpdEZvclRyYW5zaWVu\ndFN0YXRlQ2hhbmdlKFN0YXRlTWFuYWdlci5XQUlUX1RJTUVfRk9SX1RSQU5T\nSUVOVF9TVEFURV9DSEFOR0UsIGxvZ2dlcik7CiAgICAgICAgICAgICAgICAv\nLyBOb3QgZXhwZWN0ZWQgYWN0dWFsbHksIHByZXNlbnQgdG8gZ3VhcmQgYWdh\naW5zdCBmdXR1cmUgY2hhbmdlcyAuLi4KICAgICAgICAgICAgICAgIGlmIChz\nZXNzaW9uU3RhdGUuaXNUcmFuc2l0aW9uU3RhdGUoKSkKICAgICAgICAgICAg\nICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiQ29ubmVjdGlvbiBkaWQg\nbm90IG1ha2Ugc3RhdGUgY2hhbmdlIHRvIHN0ZWFkeSBzdGF0ZSA/Iik7Cgog\nICAgICAgICAgICAgICAgaWYgKGlzQ2xvc2VkKCkpIHRocm93IG5ldyBqYXZh\neC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIp\nOwogICAgICAgICAgICAgICAgaWYgKHNlc3Npb25TdGF0ZS5pc1N0YXJ0ZWQo\nKSkgcmV0dXJuIDsKCiAgICAgICAgICAgICAgICBhc3NlcnQgc2Vzc2lvblN0\nYXRlLmlzU3RvcHBlZCgpOwogICAgICAgICAgICAgICAgLy8gdHJ5IGFnYWlu\nIC4uLgogICAgICAgICAgICB9CgogICAgICAgICAgICBwcmV2U3RhdGUgPSBz\nZXNzaW9uU3RhdGUuZ2V0Q3VycmVudFN0YXRlKCk7CiAgICAgICAgICAgIHNl\nc3Npb25TdGF0ZS5zZXRDdXJyZW50U3RhdGUoU3RhdGVNYW5hZ2VyLlN0YXRl\nLlNUQVJUSU5HKTsKCiAgICAgICAgICAgIC8vIENvcHkgdG8gcHJldmVudCBj\nb25jdXJyZW50IG1vZCBleGNlcHRpb25zIC0gaXMgaXQgcmVxdWlyZWQgaGVy\nZSA/IE5vdCBzdXJlIC4uLgogICAgICAgICAgICBzdWJzY3JpcHRpb25Ub1N1\nYnNjcmliZXJNYXBDb3B5ID0gc3Vic2NyaXB0aW9ucy5jcmVhdGVTdWJzY3Jp\ncHRpb25Ub1N1YnNjcmliZXJNYXBDb3B5KCk7CiAgICAgICAgfQoKICAgICAg\nICBTdGF0ZU1hbmFnZXIuU3RhdGUgbmV4dFN0YXRlID0gcHJldlN0YXRlOwoK\nICAgICAgICB0cnkgewogICAgICAgICAgICByb2xsYmFja1RyYW5zYWN0aW9u\nU3RhdGUoKTsKICAgICAgICAgICAgLy8gTm90ZTogdGhpcyBwYXJ0IG9mIHRo\nZSBjb2RlIElTIHRocmVhZC1zYWZlIGZvciBvdXIgcHJpdmF0ZSBzdGF0ZS4K\nCiAgICAgICAgICAgIC8vIFZhbGlkYXRlIHN0YXRlIC0gaW4gdGVybXMgb2Yg\nbGlzdGVuZXIncywgZXRjIDogd2UgYXJlIHJlbHlpbmcgb24gdGhlIHNpbmds\nZSB0aHJlYWQgc2VtYW50aWNzIG9mIEpNUwogICAgICAgICAgICAvLyB0byBO\nT1QgZG8gYW55IGNvbXBsZXggbG9ja2luZywgZXRjLgoKICAgICAgICAgICAg\naWYgKG51bGwgIT0gZ2V0TWVzc2FnZUxpc3RlbmVyKCkpewogICAgICAgICAg\nICAgICAgLy8gVGhlcmUgQ0FOTk9UIGJlIGFueSBzdWJzY3JpYmVyIHdpdGgg\nbGlzdGVuZXJzIHJlZ2lzdGVyZWQuCiAgICAgICAgICAgICAgICBmb3IgKE1l\nc3NhZ2VDb25zdW1lciBjb25zdW1lciA6IHN1YnNjcmlwdGlvbnMuZ2V0QWxs\nQ29uc3VtZXJzU2V0KCkpewogICAgICAgICAgICAgICAgICAgIGlmIChudWxs\nICE9IGNvbnN1bWVyLmdldE1lc3NhZ2VMaXN0ZW5lcigpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24oIlNlc3Np\nb24ncyBtZXNzYWdlIGxpc3RlbmVyIGlzIGFscmVhZHkgc2V0IC0gIiArCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAiY2Fubm90IGhhdmUgYSBjb25z\ndW1lciB3aXRoIGxpc3RlbmVyIGFsc28gc2V0LiIpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCiAg\nICAgICAgICAgIHNlc3Npb25GYWNhZGUuc3RhcnQoKTsKCiAgICAgICAgICAg\nIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJT\ndGFydGluZyAiICsgc3Vic2NyaXB0aW9uVG9TdWJzY3JpYmVyTWFwQ29weS5z\naXplKCkgKwogICAgICAgICAgICAgICAgIiBzdWJzY3JpYmVycyIpOwoKICAg\nICAgICAgICAgLy8gU3Vic2NyaWJlIHRvIGFsbCB0aGUgc3Vic2NyaWJlcklk\nJ3MKICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8U3Vic2NyaXB0aW9uLCBD\nb3B5T25Xcml0ZUFycmF5TGlzdDxNZXNzYWdlQ29uc3VtZXI+PiBlbnRyeSA6\nCiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uVG9TdWJzY3JpYmVy\nTWFwQ29weS5lbnRyeVNldCgpKXsKCiAgICAgICAgICAgICAgICBpZiAoZW50\ncnkuZ2V0VmFsdWUoKS5pc0VtcHR5KCkpIGNvbnRpbnVlOwogICAgICAgICAg\nICAgICAgaWYgKGVudHJ5LmdldEtleSgpLmlzVG9waWMoKSl7CiAgICAgICAg\nICAgICAgICAgICAgVG9waWNTdWJzY3JpcHRpb24gdG9waWNTdWJzY3JpcHRp\nb24gPSAoVG9waWNTdWJzY3JpcHRpb24pIGVudHJ5LmdldEtleSgpOwogICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNlc3Npb25GYWNhZGUuc3Vic2NyaWJlVG9Ub3BpYyh0b3BpY1N1YnNjcmlw\ndGlvbi50b3BpY05hbWUsIHRvcGljU3Vic2NyaXB0aW9uLnN1YnNjcmliZXJJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSk1TRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGFuZCBpZ25v\ncmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBDQU4gZmFpbCwg\naXQgaXMgb2sgdG8gZmFpbCAhCiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIoUG90ZW50aWFsbHkgQmVuaWdu\nIGVycm9yKSBFcnJvciBzdWJzY3JpYmluZyBmcm9tIHRvcGljIGZvciBlbnRy\neSA6ICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGlj\nU3Vic2NyaXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIERl\nYnVnVXRpbC5kdW1wSk1TU3RhY2t0cmFjZShsb2dnZXIsIGUpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNlc3Npb25GYWNhZGUuc3RhcnRUb3BpY0RlbGl2ZXJ5KHRvcGljU3Vic2Ny\naXB0aW9uLnRvcGljTmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHRvcGljU3Vic2NyaXB0aW9uLnN1YnNjcmliZXJJZCk7CiAgICAgICAgICAg\nICAgICAgICAgfSBjYXRjaCAoSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gTG9nIGFuZCBpZ25vcmUKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkVycm9y\nIHN0YXJ0aW5nIHRvcGljIGRlbGl2ZXJ5IGZvciBlbnRyeSA6ICIgKyBlbnRy\neS5nZXRLZXkoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1\nZ1V0aWwuZHVtcEpNU1N0YWNrdHJhY2UobG9nZ2VyLCBlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAg\nICAgICAgICAgIGFzc2VydCBlbnRyeS5nZXRLZXkoKS5pc1F1ZXVlKCk7Cgog\nICAgICAgICAgICAgICAgICAgIFF1ZXVlU3Vic2NyaXB0aW9uIHF1ZXVlU3Vi\nc2NyaXB0aW9uID0gKFF1ZXVlU3Vic2NyaXB0aW9uKSBlbnRyeS5nZXRLZXko\nKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gbm90aW9u\nIGxpa2Ugc3Vic2NyaXB0aW9uIHRvIHF1ZXVlLCByaWdodCA/CiAgICAgICAg\nICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgICAgICBzZXNzaW9uRmFjYWRlLnN1YnNjcmliZVRv\nUXVldWUocXVldWVTdWJzY3JpcHRpb24ucXVldWVOYW1lLAogICAgICAgICAg\nICAgICAgICAgICAgICAgIHF1ZXVlU3Vic2NyaXB0aW9uLnN1YnNjcmliZXJJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSk1TRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGFuZCBpZ25v\ncmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBDQU4gZmFpbCwg\naXQgaXMgb2sgdG8gZmFpbCAhCiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCIoUG90ZW50aWFsbHkgQmVuaWdu\nIGVycm9yKSBFcnJvciBzdWJzY3JpYmluZyBmcm9tIHF1ZXVlIGZvciBlbnRy\neSA6ICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZVN1\nYnNjcmlwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBVdGls\nLmR1bXBKTVNTdGFja3RyYWNlKGxvZ2dlciwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgICAgICBzZXNzaW9uRmFjYWRlLnN0YXJ0UXVldWVEZWxp\ndmVyeShxdWV1ZVN1YnNjcmlwdGlvbi5xdWV1ZU5hbWUsIHF1ZXVlU3Vic2Ny\naXB0aW9uLnN1YnNjcmliZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gTG9nIGFuZCBpZ25vcmUKICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkVycm9yIHN0YXJ0aW5nIHF1\nZXVlIGRlbGl2ZXJ5IGZvciBlbnRyeSA6ICIgKyBlbnRyeS5nZXRLZXkoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Z1V0aWwuZHVtcEpN\nU1N0YWNrdHJhY2UobG9nZ2VyLCBlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0U3RhdGUgPSBTdGF0ZU1h\nbmFnZXIuU3RhdGUuU1RBUlRFRDsKICAgICAgICB9IGZpbmFsbHkgewogICAg\nICAgICAgICAvLyBzZXQgc3RhdHVzIGFuZCBub3RpZnkuCiAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAobG9ja09iamVjdCl7CiAgICAgICAgICAgICAgICBs\nb2NrT2JqZWN0Lm5vdGlmeUFsbCgpOwogICAgICAgICAgICAgICAgc2Vzc2lv\nblN0YXRlLnNldEN1cnJlbnRTdGF0ZShuZXh0U3RhdGUpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgc3RvcCgpIHRocm93cyBK\nTVNFeGNlcHRpb24gewogICAgICAgIGZpbmFsIFN0YXRlTWFuYWdlci5TdGF0\nZSBwcmV2U3RhdGU7CiAgICAgICAgZmluYWwgTWFwPFN1YnNjcmlwdGlvbiwg\nQ29weU9uV3JpdGVBcnJheUxpc3Q8TWVzc2FnZUNvbnN1bWVyPj4gc3Vic2Ny\naXB0aW9uVG9TdWJzY3JpYmVyTWFwQ29weTsKCiAgICAgICAgaWYgKGxvZ2dl\nci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dnZXIudHJhY2UoIkF0dGVtcHRpbmcg\ndG8gc3RvcCBjb25uZWN0aW9uIik7CgogICAgICAgIHN5bmNocm9uaXplZCAo\nbG9ja09iamVjdCl7CiAgICAgICAgICAgIGlmIChpc0Nsb3NlZCgpKSB0aHJv\ndyBuZXcgamF2YXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQWxyZWFk\neSBjbG9zZWQiKTsKICAgICAgICAgICAgaWYgKHNlc3Npb25TdGF0ZS5pc1N0\nb3BwZWQoKSkgcmV0dXJuIDsKCiAgICAgICAgICAgIGlmIChzZXNzaW9uU3Rh\ndGUuaXNUcmFuc2l0aW9uU3RhdGUoKSl7CiAgICAgICAgICAgICAgICBzZXNz\naW9uU3RhdGUud2FpdEZvclRyYW5zaWVudFN0YXRlQ2hhbmdlKFN0YXRlTWFu\nYWdlci5XQUlUX1RJTUVfRk9SX1RSQU5TSUVOVF9TVEFURV9DSEFOR0UsIGxv\nZ2dlcik7CiAgICAgICAgICAgICAgICAvLyBOb3QgZXhwZWN0ZWQgYWN0dWFs\nbHksIHByZXNlbnQgdG8gZ3VhcmQgYWdhaW5zdCBmdXR1cmUgY2hhbmdlcyAu\nLi4KICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNUcmFuc2l0\naW9uU3RhdGUoKSkKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEpNU0V4\nY2VwdGlvbigiQ29ubmVjdGlvbiBkaWQgbm90IG1ha2Ugc3RhdGUgY2hhbmdl\nIHRvIHN0ZWFkeSBzdGF0ZSA/Iik7CgogICAgICAgICAgICAgICAgaWYgKGlz\nQ2xvc2VkKCkpIHRocm93IG5ldyBqYXZheC5qbXMuSWxsZWdhbFN0YXRlRXhj\nZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIpOwogICAgICAgICAgICAgICAgaWYg\nKHNlc3Npb25TdGF0ZS5pc1N0b3BwZWQoKSkgcmV0dXJuIDsKCiAgICAgICAg\nICAgICAgICBhc3NlcnQgc2Vzc2lvblN0YXRlLmlzU3RhcnRlZCgpOwoKICAg\nICAgICAgICAgICAgIC8vIHRyeSBhZ2FpbiAuLi4KICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgcHJldlN0YXRlID0gc2Vzc2lvblN0YXRlLmdldEN1cnJl\nbnRTdGF0ZSgpOwogICAgICAgICAgICBzZXNzaW9uU3RhdGUuc2V0Q3VycmVu\ndFN0YXRlKFN0YXRlTWFuYWdlci5TdGF0ZS5TVE9QUElORyk7CgogICAgICAg\nICAgICAvLyBDb3B5IHRvIHByZXZlbnQgY29uY3VycmVudCBtb2QgZXhjZXB0\naW9ucy4KICAgICAgICAgICAgc3Vic2NyaXB0aW9uVG9TdWJzY3JpYmVyTWFw\nQ29weSA9IHN1YnNjcmlwdGlvbnMuY3JlYXRlU3Vic2NyaXB0aW9uVG9TdWJz\nY3JpYmVyTWFwQ29weSgpOwogICAgICAgIH0KCiAgICAgICAgU3RhdGVNYW5h\nZ2VyLlN0YXRlIG5leHRTdGF0ZSA9IHByZXZTdGF0ZTsKICAgICAgICB0cnkg\newogICAgICAgICAgICByb2xsYmFja1RyYW5zYWN0aW9uU3RhdGUoKTsKICAg\nICAgICAgICAgLy8gSW4gY2FzZSB0aGVyZSBhcmUgb3RoZXIgdGhpbmdzIHRv\nIGJlIGRvbmUgLi4uCgogICAgICAgICAgICAvLyBVbnN1YnNjcmliZSB0byBh\nbGwgdGhlIHN1YnNjcmliZXJJZCdzCiAgICAgICAgICAgIGlmIChsb2dnZXIu\naXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJTdG9wcGluZyAiICsK\nICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvblRvU3Vic2NyaWJlck1hcENv\ncHkuc2l6ZSgpICsgIiBzdWJzY3JpYmVycyIpOwogICAgICAgICAgICBmb3Ig\nKE1hcC5FbnRyeTxTdWJzY3JpcHRpb24sIENvcHlPbldyaXRlQXJyYXlMaXN0\nPE1lc3NhZ2VDb25zdW1lcj4+IGVudHJ5IDoKICAgICAgICAgICAgICAgICAg\nICBzdWJzY3JpcHRpb25Ub1N1YnNjcmliZXJNYXBDb3B5LmVudHJ5U2V0KCkp\newoKICAgICAgICAgICAgICAgIGlmIChlbnRyeS5nZXRWYWx1ZSgpLmlzRW1w\ndHkoKSkgY29udGludWU7CiAgICAgICAgICAgICAgICBpZiAoZW50cnkuZ2V0\nS2V5KCkuaXNUb3BpYygpKXsKICAgICAgICAgICAgICAgICAgICBUb3BpY1N1\nYnNjcmlwdGlvbiB0b3BpY1N1YnNjcmlwdGlvbiA9IChUb3BpY1N1YnNjcmlw\ndGlvbikgZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RvcFRvcGljRGVsaXZlcnko\ndG9waWNTdWJzY3JpcHRpb24udG9waWNOYW1lLCB0b3BpY1N1YnNjcmlwdGlv\nbi5zdWJzY3JpYmVySWQpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEpNU0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIExvZyBhbmQgaWdub3JlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChs\nb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9nZ2VyLmRlYnVnKCJFcnJvciB1bnN1YnNjcmliaW5nIGZy\nb20gdG9waWMgZm9yIGVudHJ5IDogIiArIHRvcGljU3Vic2NyaXB0aW9uKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlYnVnVXRpbC5kdW1wSk1T\nU3RhY2t0cmFjZShsb2dnZXIsIGUpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgIGFzc2Vy\ndCBlbnRyeS5nZXRLZXkoKS5pc1F1ZXVlKCk7CgogICAgICAgICAgICAgICAg\nICBRdWV1ZVN1YnNjcmlwdGlvbiBxdWV1ZVN1YnNjcmlwdGlvbiA9IChRdWV1\nZVN1YnNjcmlwdGlvbikgZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICBzdG9wUXVldWVEZWxp\ndmVyeShxdWV1ZVN1YnNjcmlwdGlvbi5xdWV1ZU5hbWUsIHF1ZXVlU3Vic2Ny\naXB0aW9uLnN1YnNjcmliZXJJZCk7CiAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEpNU0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAv\nLyBMb2cgYW5kIGlnbm9yZQogICAgICAgICAgICAgICAgICAgICAgaWYgKGxv\nZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmRlYnVnKCJFcnJvciB1bnN1YnNjcmliaW5nIGZyb20g\ncXVldWUgZm9yIGVudHJ5IDogIiArIHF1ZXVlU3Vic2NyaXB0aW9uKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Z1V0aWwuZHVtcEpNU1N0YWNr\ndHJhY2UobG9nZ2VyLCBlKTsKICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIC8vIHN0b3AgZmFjYWRlIEFGVEVSIHN1YnNjcmli\nZXIncyBhcmUgc3RvcHBlZC4KICAgICAgICAgICAgc2Vzc2lvbkZhY2FkZS5z\ndG9wKCk7CiAgICAgICAgICAgIG5leHRTdGF0ZSA9IFN0YXRlTWFuYWdlci5T\ndGF0ZS5TVE9QUEVEOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAobG9ja09iamVjdCl7CiAgICAgICAgICAgICAgICBs\nb2NrT2JqZWN0Lm5vdGlmeUFsbCgpOwogICAgICAgICAgICAgICAgc2Vzc2lv\nblN0YXRlLnNldEN1cnJlbnRTdGF0ZShuZXh0U3RhdGUpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAgICAqCiAgICAgKiBD\nbG9zZXMgdGhlIHNlc3Npb24uIDxici8+CiAgICAgKiBTaW5jZSBhIHByb3Zp\nZGVyIG1heSBhbGxvY2F0ZSBzb21lIHJlc291cmNlcyBvbiBiZWhhbGYgb2Yg\nYSBzZXNzaW9uIG91dHNpZGUgdGhlIEpWTSwgY2xpZW50cwogICAgICogc2hv\ndWxkIGNsb3NlIHRoZSByZXNvdXJjZXMKICAgICAqIHdoZW4gdGhleSBhcmUg\nbm90IG5lZWRlZC4gUmVseWluZyBvbiBnYXJiYWdlIGNvbGxlY3Rpb24gdG8g\nZXZlbnR1YWxseSByZWNsYWltIHRoZXNlIHJlc291cmNlcwogICAgICogbWF5\nIG5vdCBiZSB0aW1lbHkgZW5vdWdoLjxici8+CiAgICAgKiA8cC8+CiAgICAg\nKiBUaGVyZSBpcyBubyBuZWVkIHRvIGNsb3NlIHRoZSBwcm9kdWNlcnMgYW5k\nIGNvbnN1bWVycyBvZiBhIGNsb3NlZCBzZXNzaW9uLgogICAgICogPHAvPgog\nICAgICoKICAgICAqCiAgICAgKiBBIGJsb2NrZWQgbWVzc2FnZSBjb25zdW1l\nciByZWNlaXZlIGNhbGwgcmV0dXJucyBudWxsIHdoZW4gdGhpcyBzZXNzaW9u\nIGlzIGNsb3NlZC4KICAgICAqIDxwLz4KICAgICAqIENsb3NpbmcgYSB0cmFu\nc2FjdGVkIHNlc3Npb24gbXVzdCByb2xsIGJhY2sgdGhlIHRyYW5zYWN0aW9u\nIGluIHByb2dyZXNzLjxici8+CiAgICAgKiBUaGlzIG1ldGhvZCBpcyB0aGUg\nb25seSBTZXNzaW9uIG1ldGhvZCB0aGF0IGNhbiBiZSBjYWxsZWQgY29uY3Vy\ncmVudGx5Ljxici8+CiAgICAgKiBJbnZva2luZyBhbnkgb3RoZXIgU2Vzc2lv\nbiBtZXRob2Qgb24gYSBjbG9zZWQgc2Vzc2lvbiBtdXN0IHRocm93IGEgSk1T\nRXhjZXB0aW9uLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbi48YnIvPgogICAgICog\nQ2xvc2luZyBhIGNsb3NlZCBzZXNzaW9uIG11c3Qgbm90IHRocm93IGFuIGV4\nY2VwdGlvbi48YnIvPgogICAgICoKICAgICAqLwogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgVGhyZWFkTG9jYWw8Qm9vbGVhbj4gY2xvc2VGcm9tV2l0aGlu\nTGlzdGVuZXIgPSBuZXcgVGhyZWFkTG9jYWw8Qm9vbGVhbj4oKXsKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwcm90ZWN0ZWQgQm9vbGVhbiBpbml0aWFs\nVmFsdWUoKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9\nCiAgICB9OwoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY2xvc2Uo\nKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBTdGF0ZU1h\nbmFnZXIuU3RhdGUgcHJldlN0YXRlOwogICAgICAgIGZpbmFsIFNldDxNZXNz\nYWdlQ29uc3VtZXI+IHN1YnNjcmliZXJTZXRDb3B5ID0gQ29sbGVjdGlvbnMu\nbmV3U2V0RnJvbU1hcCgKICAgICAgICAgICAgbmV3IElkZW50aXR5SGFzaE1h\ncDxNZXNzYWdlQ29uc3VtZXIsIEJvb2xlYW4+KCkpOwoKICAgICAgICBpZiAo\nbG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgiQXR0ZW1w\ndGluZyB0byBjbG9zZSBzZXNzaW9uIik7CgogICAgICAgIHN5bmNocm9uaXpl\nZCAobG9ja09iamVjdCl7CiAgICAgICAgICAgIGlmIChpc0Nsb3NlZCgpKSBy\nZXR1cm4gOwogICAgICAgICAgICBpZiAoISBzZXNzaW9uU3RhdGUuaXNTdG9w\ncGVkKCkpIHsKICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNU\ncmFuc2l0aW9uU3RhdGUoKSl7CiAgICAgICAgICAgICAgICAgICAgc2Vzc2lv\nblN0YXRlLndhaXRGb3JUcmFuc2llbnRTdGF0ZUNoYW5nZShTdGF0ZU1hbmFn\nZXIuV0FJVF9USU1FX0ZPUl9UUkFOU0lFTlRfU1RBVEVfQ0hBTkdFLCBsb2dn\nZXIpOwogICAgICAgICAgICAgICAgICAgIC8vIE5vdCBleHBlY3RlZCBhY3R1\nYWxseSwgcHJlc2VudCB0byBndWFyZCBhZ2FpbnN0IGZ1dHVyZSBjaGFuZ2Vz\nIC4uLgogICAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNU\ncmFuc2l0aW9uU3RhdGUoKSkKICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBKTVNFeGNlcHRpb24oIkNvbm5lY3Rpb24gZGlkIG5vdCBtYWtlIHN0\nYXRlIGNoYW5nZSB0byBzdGVhZHkgc3RhdGUgPyIpOwoKICAgICAgICAgICAg\nICAgICAgICBpZiAoaXNDbG9zZWQoKSkgcmV0dXJuIDsKCiAgICAgICAgICAg\nICAgICAgICAgYXNzZXJ0IHNlc3Npb25TdGF0ZS5pc1N0YXJ0ZWQoKSB8fCBz\nZXNzaW9uU3RhdGUuaXNTdG9wcGVkKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHByZXZTdGF0ZSA9IHNlc3Npb25T\ndGF0ZS5nZXRDdXJyZW50U3RhdGUoKTsKICAgICAgICAgICAgc2Vzc2lvblN0\nYXRlLnNldEN1cnJlbnRTdGF0ZShTdGF0ZU1hbmFnZXIuU3RhdGUuQ0xPU0lO\nRyk7CiAgICAgICAgICAgIC8vIENvcHkgdG8gcHJldmVudCBjb25jdXJyZW50\nIG1vZCBleGNlcHRpb25zLgogICAgICAgICAgICBzdWJzY3JpYmVyU2V0Q29w\neS5hZGRBbGwoc3Vic2NyaXB0aW9ucy5nZXRBbGxDb25zdW1lcnNTZXQoKSk7\nCiAgICAgICAgfQoKICAgICAgICBTdGF0ZU1hbmFnZXIuU3RhdGUgbmV4dFN0\nYXRlID0gcHJldlN0YXRlOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBy\nb2xsYmFja1RyYW5zYWN0aW9uU3RhdGUoKTsKICAgICAgICAgICAgY29ubmVj\ndGlvbi5yZW1vdmVTZXNzaW9uKHRoaXMpOwoKICAgICAgICAgICAgLy8gQ2xv\nc2UgYWxsIHB1Ymxpc2hlcnMgLSBkb2luZyB0aGlzIHdpdGhpbiBzeW5jaHJv\nbml6ZWQgYmxvY2sgdG8gcHJldmVudCBhbnkgcG9zc2liaWxpdHkKICAgICAg\nICAgICAgLy8gb2YgcmFjZSBjb25kaXRpb25zLgogICAgICAgICAgICAvLyBQ\nb3RlbnRpYWxseSBleHBlbnNpdmUsIGJ1dCBpdCBpcyBhIHRyYWRlb2ZmIGJl\ndHdlZW4gY29ycmVjdG5lc3MgYW5kIHBlcmZvcm1hbmNlIDotKAogICAgICAg\nICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFj\nZSgiQ2xvc2luZyAiICsgc3Vic2NyaWJlclNldENvcHkuc2l6ZSgpICsgIiBz\ndWJzY3JpYmVycyIpOwogICAgICAgICAgICBmb3IgKE1lc3NhZ2VDb25zdW1l\nciBzdWJzY3JpYmVyIDogc3Vic2NyaWJlclNldENvcHkpewogICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgICAgIC8vIExvZyBhbmQgaWdub3JlCiAg\nICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRXJy\nb3IgdW5zdWJzY3JpYmluZyBmcm9tIGRlc3RpbmF0aW9uIGZvciBlbnRyeSA6\nICIgKyBzdWJzY3JpYmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgRGVi\ndWdVdGlsLmR1bXBKTVNTdGFja3RyYWNlKGxvZ2dlciwgZSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHNlc3Npb25GYWNhZGUuY2xvc2UoKTsKICAgICAgICAg\nICAgbmV4dFN0YXRlID0gU3RhdGVNYW5hZ2VyLlN0YXRlLkNMT1NFRDsKICAg\nICAgICB9IGZpbmFsbHkgewoKICAgICAgICAgICAgLy8gc2V0IHN0YXR1cyBh\nbmQgbm90aWZ5LgogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2tPYmpl\nY3QpewogICAgICAgICAgICAgICAgbG9ja09iamVjdC5ub3RpZnlBbGwoKTsK\nICAgICAgICAgICAgICAgIHNlc3Npb25TdGF0ZS5zZXRDdXJyZW50U3RhdGUo\nbmV4dFN0YXRlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\naWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dnZXIudHJhY2UodGhp\ncyArICJXYWl0aW5nIGZvciBtZXNzYWdlTGlzdGVuZXJUaHJlYWRTdGFydGVk\nICIgKwogICAgICAgICAgICBtZXNzYWdlTGlzdGVuZXJUaHJlYWRTdGFydGVk\nICsgIiwgbWVzc2FnZUxpc3RlbmVyVGhyZWFkRmluaXNoZWQgIiArIG1lc3Nh\nZ2VMaXN0ZW5lclRocmVhZEZpbmlzaGVkKTsKCiAgICAgICAgLy8gc3BpbiBv\nbiBtZXNzYWdlTGlzdGVuZXJUaHJlYWRGaW5pc2hlZAogICAgICAgIC8vIHNw\naW4gT05MWSBpZiB3ZSBhcmUgTk9UIHdpdGhpbiB0aGUgbGlzdGVuZXIgYWxy\nZWFkeSAhCiAgICAgICAgaWYgKCEgY2xvc2VGcm9tV2l0aGluTGlzdGVuZXIu\nZ2V0KCkpewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2tPYmplY3Qp\newogICAgICAgICAgICAgICAgbG9uZyB3YWl0VGltZSA9IDEwMDsKICAgICAg\nICAgICAgICAgIGxvbmcgcmV0cnlDb3VudCA9IFN0YXRlTWFuYWdlci5XQUlU\nX1RJTUVfRk9SX1RSQU5TSUVOVF9TVEFURV9DSEFOR0UgLyB3YWl0VGltZTsK\nICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlTGlzdGVuZXJUaHJlYWRTdGFy\ndGVkKSB7CiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCFtZXNzYWdlTGlz\ndGVuZXJUaHJlYWRGaW5pc2hlZCkgewogICAgICAgICAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9ja09iamVj\ndC53YWl0KHdhaXRUaW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gaWdub3JlIC4uLgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSBsb2dn\nZXIuZGVidWcoImludGVycnVwdGVkID8iLCBlKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXRyeUNvdW50\nIC0tOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBGYWlsIGlmIHdlIGhh\ndmUgd2FpdGluZyBsb25nIGVub3VnaCAuLi4gaGFyZGNvZGVkIGZvciBub3cu\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXRyeUNvdW50IDw9IDAp\nIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGxvZ2dl\nci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dnZXIudHJhY2UoIldhaXRpbmcgZm9y\nIG1lc3NhZ2VMaXN0ZW5lclRocmVhZEZpbmlzaGVkICIgKwogICAgICAgICAg\nICBtZXNzYWdlTGlzdGVuZXJUaHJlYWRGaW5pc2hlZCArICIgRE9ORSIpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcmVjb3Zlcigp\nIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIC8vIFR5cGljYWxseSB3\naWxsIGJlIGluIHN0b3BwZWQgc3RhdGUuCiAgICAgICAgaWYgKHNlc3Npb25T\ndGF0ZS5pc0luQ2xvc2VNb2RlKCkpIHRocm93IG5ldyBqYXZheC5qbXMuSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIpOwogICAgICAg\nIGlmIChnZXRUcmFuc2FjdGVkKCkpCiAgICAgICAgICB0aHJvdyBuZXcgamF2\nYXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiY2Fubm90IGludm9rZSBy\nZWNvdmVyIGluIHRyYW5zYWN0ZWQgc2Vzc2lvbi4iKTsKICAgICAgICB0aHJv\ndyBuZXcgSk1TRXhjZXB0aW9uKCJyZWNvdmVyeSA6IFRPRE8iKTsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBNZXNzYWdlTGlzdGVuZXIgZ2V0\nTWVzc2FnZUxpc3RlbmVyKCkgewogICAgICAgIHJldHVybiBtZXNzYWdlTGlz\ndGVuZXI7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBz\nZXRNZXNzYWdlTGlzdGVuZXIoZmluYWwgTWVzc2FnZUxpc3RlbmVyIG1lc3Nh\nZ2VMaXN0ZW5lcikgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKHNlc3Npb25TdGF0ZS5pc0luQ2xvc2VNb2RlKCkpIHRocm93IG5ldyBqYXZh\neC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIp\nOwogICAgICAgIC8vIEV4cGxpY2l0bHkgZm9yYmlkZGluZyBpdCBmb3Igbm93\nIDogbGVhZHMgdG8gdG9vIG1hbnkgY29tcGxleGl0aWVzIG90aGVyd2lzZS4K\nICAgICAgICAvLyBzdGFydCBzZXNzaW9uIE9OTFkgQUZURVIgeW91IGhhdmUg\nc2V0IHRoZSBsaXN0ZW5lci4KICAgICAgICBpZiAobWVzc2FnZUxpc3RlbmVy\nICE9IHRoaXMubWVzc2FnZUxpc3RlbmVyICYmIHNlc3Npb25TdGF0ZS5pc0lu\nU3RhcnRNb2RlKCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2Vw\ndGlvbigiU2V0IHRoZSBtZXNzYWdlIGxpc3RlbmVyIEJFRk9SRSBzdGFydGlu\nZyBzZXNzaW9uIChhbmQvb3IgY29ubmVjdGlvbikiKTsKICAgICAgICB9Cgog\nICAgICAgIHRoaXMubWVzc2FnZUxpc3RlbmVyID0gbWVzc2FnZUxpc3RlbmVy\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcnVuKCkg\newogICAgICAgIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2Vy\nLnRyYWNlKCJTZXNzaW9uIHRocmVhZCBzdGFydGVkIik7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgd2hpbGUgKCFpc0Nsb3NlZCgpKXsKICAgICAgICAg\nICAgICAgIGZpbmFsIExpc3Q8UmVjZWl2ZWRNZXNzYWdlPiBtZXNzYWdlTGlz\ndENvcHk7CiAgICAgICAgICAgICAgICBmaW5hbCBMaXN0PFRyYW5zYWN0ZWRS\nZWNlaXZlT3BlcmF0aW9uPiByb2xsZWRiYWNrTWVzc2FnZUxpc3RDb3B5Owog\nICAgICAgICAgICAgICAgZmluYWwgTWVzc2FnZUxpc3RlbmVyIG1zZ2xpc3Rl\nbmVyOwogICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChsb2NrT2JqZWN0\nKXsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoIWlzQ2xvc2VkKCkgJiYK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICghc2Vzc2lvblN0YXRlLmlz\nU3RhcnRlZCgpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKG51bGwgPT0gZ2V0TWVzc2FnZUxpc3RlbmVyKCkgJiYgMCA9PSBzdWJzY3Jp\ncHRpb25zLmdldE51bVN1YnNjcmliZXJzKCkpIHx8CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKG1lc3NhZ2VMaXN0LmlzRW1wdHkoKSAmJiBy\nb2xsZWRiYWNrTWVzc2FnZUxpc3QuaXNFbXB0eSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKQogICAgICAgICAgICAgICAgICAgICAgICApIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGJ1ZmZlciBv\ndmVyLXJ1bidzIGR1ZSB0byBubyBsaXN0ZW5lciBiZWluZyBhdmFpbGFibGUg\nIQogICAgICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZUxpc3Quc2l6\nZSgpID4gTUFYX1NFU1NJT05fQlVGRkVSRURfTUVTU0FHRVMpewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gc2ltcGx5IGRpc2NhcmQgaXQgd2l0\naCBhbiBlcnJvciBsb2dnZWQuCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAobG9nZ2VyLmlzSW5mb0VuYWJsZWQoKSkgbG9nZ2VyLmluZm8oIkRp\nc2NhcmRpbmcgIiArIG1lc3NhZ2VMaXN0LnNpemUoKSArCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIiBtZXNzYWdlcyBzaW5jZSB0aGVyZSBh\ncmUgbm8gY29uc3VtZXJzIGZvciB0aGVtIik7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBtZXNzYWdlTGlzdC5jbGVhcigpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNr\nIGZvciBidWZmZXIgb3Zlci1ydW4ncyBkdWUgdG8gbm8gbGlzdGVuZXIgYmVp\nbmcgYXZhaWxhYmxlICEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJv\nbGxlZGJhY2tNZXNzYWdlTGlzdC5zaXplKCkgPiBNQVhfU0VTU0lPTl9CVUZG\nRVJFRF9NRVNTQUdFUyl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAv\nLyBzaW1wbHkgZGlzY2FyZCBpdCB3aXRoIGFuIGVycm9yIGxvZ2dlZC4KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNJbmZvRW5h\nYmxlZCgpKSBsb2dnZXIuaW5mbygiRGlzY2FyZGluZyAiICsgcm9sbGVkYmFj\na01lc3NhZ2VMaXN0LnNpemUoKSArCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIiBtZXNzYWdlcyBzaW5jZSB0aGVyZSBhcmUgbm8gY29uc3Vt\nZXJzIGZvciB0aGVtIGZyb20gcmVjb3ZlcmVkIGxpc3QuIik7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByb2xsZWRiYWNrTWVzc2FnZUxpc3QuY2xl\nYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dn\nZXIudHJhY2UodGhpcyArICJzZXNzaW9uU3RhdGUgOiAiICsgc2Vzc2lvblN0\nYXRlICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIsIGxpc3RlbmVy\nICIgKyBnZXRNZXNzYWdlTGlzdGVuZXIoKSArICIsIG51bVN1YnNjcmliZXJz\nIDogIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpcHRp\nb25zLmdldE51bVN1YnNjcmliZXJzKCkpOwogICAgICAgICAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9ja09i\namVjdC53YWl0KDUwMCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIFNob3VsZCB3ZSBpZ25vcmUgdGhpcyA/IFRoZXJl\nIGlzIG5vIHdheSB0aGlzIHRocmVhZCBjYW4gYmUgaW50ZXJydXB0ZWQgY3Vy\ncmVudGx5IC0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdoaWxl\nIGNsb3NpbmcgaXQgd2lsbCBjYXVzZSBpc3N1ZXMgIQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gTG9nIGFuZCBmb3JnZXQKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1\nZygiSWdub3JpbmcgaW50ZXJydXB0ZWQgZXhjZXB0aW9uIiwgZSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nICAgIGlmIChpc0Nsb3NlZCgpKSBicmVhazsKICAgICAgICAgICAgICAgICAg\nICBtc2dsaXN0ZW5lciA9IGdldE1lc3NhZ2VMaXN0ZW5lcigpOwogICAgICAg\nICAgICAgICAgICAgIG1lc3NhZ2VMaXN0Q29weSA9IG5ldyBBcnJheUxpc3Q8\nUmVjZWl2ZWRNZXNzYWdlPihtZXNzYWdlTGlzdCk7CiAgICAgICAgICAgICAg\nICAgICAgcm9sbGVkYmFja01lc3NhZ2VMaXN0Q29weSA9IG5ldyBBcnJheUxp\nc3Q8VHJhbnNhY3RlZFJlY2VpdmVPcGVyYXRpb24+KHJvbGxlZGJhY2tNZXNz\nYWdlTGlzdCk7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZUxpc3QuY2xl\nYXIoKTsKICAgICAgICAgICAgICAgICAgICByb2xsZWRiYWNrTWVzc2FnZUxp\nc3QuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICBhc3NlcnQgc3Vic2Ny\naXB0aW9ucy5nZXROdW1TdWJzY3JpYmVycygpID4gMCB8fCBudWxsICE9IG1z\nZ2xpc3RlbmVyOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJQ\ncm9jZXNzaW5nICIgKyBtZXNzYWdlTGlzdENvcHkuc2l6ZSgpICsKICAgICAg\nICAgICAgICAgICAgICAiIG1lc3NhZ2VzIHVzaW5nIGxpc3RlbmVyID8gIiAr\nIChudWxsICE9IG1zZ2xpc3RlbmVyKSk7CgogICAgICAgICAgICAgICAgZGlz\ncGF0Y2hSZWNlaXZlZE1lc3NhZ2VzVG9TdWJzY3JpYmVycyhtc2dsaXN0ZW5l\nciwgbWVzc2FnZUxpc3RDb3B5LCByb2xsZWRiYWNrTWVzc2FnZUxpc3RDb3B5\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIFN0cmluZyBtc2cgPSBudWxsOwogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKGxvY2tPYmplY3QpewogICAgICAgICAgICAgICAgbG9ja09iamVjdC5u\nb3RpZnlBbGwoKTsKICAgICAgICAgICAgICAgIG1lc3NhZ2VMaXN0ZW5lclRo\ncmVhZEZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGlmIChsb2dn\nZXIuaXNUcmFjZUVuYWJsZWQoKSkgbXNnID0gIkV4aXRpbmcgdGhyZWFkIGFu\nZCBzZXR0aW5nICIgKwogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2VMaXN0\nZW5lclRocmVhZEZpbmlzaGVkOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKG1z\nZyk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBkaXNwYXRj\naFJlY2VpdmVkTWVzc2FnZXNUb1N1YnNjcmliZXJzKE1lc3NhZ2VMaXN0ZW5l\nciBzZXNzaW9uTWVzc2FnZUxpc3RlbmVyLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxSZWNl\naXZlZE1lc3NhZ2U+IG1lc3NhZ2VMaXN0Q29weSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8\nVHJhbnNhY3RlZFJlY2VpdmVPcGVyYXRpb24+IHJvbGxlZGJhY2tNZXNzYWdl\nTGlzdENvcHkpIHsKICAgICAgICBhc3NlcnQgbnVsbCAhPSBtZXNzYWdlTGlz\ndENvcHk7CgogICAgICAgIC8vIERvaW5nIGl0IGJlZm9yZSBwcm9jZXNzaW5n\nIG1lc3NhZ2VMaXN0LgogICAgICAgIGhhbmRsZVJvbGxiYWNrSW5EaXNwYXRj\naChyb2xsZWRiYWNrTWVzc2FnZUxpc3RDb3B5KTsKCiAgICAgICAgZm9yIChm\naW5hbCBSZWNlaXZlZE1lc3NhZ2UgcmVjZWl2ZWRNZXNzYWdlIDogbWVzc2Fn\nZUxpc3RDb3B5KXsKCiAgICAgICAgICAgIGlmIChpc0Nsb3NlZCgpKSBicmVh\nazsKCiAgICAgICAgICAgIC8vIEl0IGlzIHBvc3NpYmxlIHRoYXQgcHJldmlv\ndXMgbGlzdGVuZXIgcm9sbGVkYmFjayB0cmFuc2FjdGlvbiAuLi4gY2hlY2sg\ndGhhdCBiZWZvcmUKICAgICAgICAgICAgLy8gZGVsaXZlcmluZyB0aGUgb3Ro\nZXIgbWVzc2FnZXMgIQogICAgICAgICAgICAvLyBFbHNlIHdlIHdpbGwgbWVz\ncyB1cCB0aGUgb2RlciBvZiBtZXNzYWdlIGRlbGl2ZXJ5LgogICAgICAgICAg\nICB7CiAgICAgICAgICAgICAgICBpbnQgcmV0cnlDb3VudCA9IDA7CiAgICAg\nICAgICAgICAgICB3aGlsZSAocmV0cnlDb3VudCA8IFJFVFJZX0RJU1BBVENI\nX1RPX1RSQU5TQUNUSU9OX0FUVEVNUFRTKXsKICAgICAgICAgICAgICAgICAg\nICBpZiAoISBoYW5kbGVSb2xsYmFja0luRGlzcGF0Y2gobnVsbCkpIGJyZWFr\nOwogICAgICAgICAgICAgICAgICAgIHJldHJ5Q291bnQgKys7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoUkVUUllfRElTUEFUQ0hf\nVE9fVFJBTlNBQ1RJT05fQVRURU1QVFMgPT0gcmV0cnlDb3VudCl7CiAgICAg\nICAgICAgICAgICAgICAgLy8gd2UgY2FudCBkbyBtdWNoIC0gY2xvc2Ugc2Vz\nc2lvbiBhbmQgYWJvcnQuCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgU2Vzc2lvbkltcGwudGhpcy5jbG9zZSgp\nOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEpNU0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1\nZ0VuYWJsZWQoKSkgbG9nZ2VyLmRlYnVnKCJFeGNlcHRpb24gY2xvc2luZyBz\nZXNzaW9uIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIHJldHVybiA7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGZpbmFsIFN1YnNjcmlwdGlvbiBzdWJzY3Jp\ncHRpb24gPSBjcmVhdGVTdWJzY3JpcHRpb24ocmVjZWl2ZWRNZXNzYWdlLmRl\nc3RpbmF0aW9uVHlwZSwKICAgICAgICAgICAgICAgIHJlY2VpdmVkTWVzc2Fn\nZS5vcmlnaW5hbE1lc3NhZ2UuZ2V0U291cmNlTmFtZSgpLCByZWNlaXZlZE1l\nc3NhZ2Uub3JpZ2luYWxNZXNzYWdlLmdldFN1YnNjcmliZXJJZCgpKTsKCiAg\nICAgICAgICAgIC8vIENPVyAtIHNvIG5vIG5lZWQgdG8gd29ycnkgYWJvdXQg\nY29uY3VycmVudC1tb2QncyBvciBpbmNvbnNpc3RlbnQgc3RhdGVzIC0gb3Ro\nZXIgdGhhbgogICAgICAgICAgICAvLyBwb3RlbnRpYWwgc3RhbGUgc3RhdGUs\nCiAgICAgICAgICAgIC8vIHdoaWNoIGlzIGZpbmUgc2luY2UgTWVzc2FnZUNv\nbnN1bWVyJ3MgYXJlIGVzc2VudGlhbGx5IGltbXV0YWJsZSBmcm9tIGJhc2lj\nIHN0YXRlIHBvaW50CiAgICAgICAgICAgIC8vIG9mIHZpZXcgKHN1YnNjcmli\nZXJJZCwgZGVzdGluYXRpb24pLgogICAgICAgICAgICBDb3B5T25Xcml0ZUFy\ncmF5TGlzdDw/IGV4dGVuZHMgTWVzc2FnZUNvbnN1bWVyPiBzdWJzY3JpYmVy\nTGlzdCA9CiAgICAgICAgICAgICAgICBzdWJzY3JpcHRpb25zLmdldFN1YnNj\ncmliZXJzKHN1YnNjcmlwdGlvbik7CiAgICAgICAgICAgIGlmIChudWxsID09\nIHN1YnNjcmliZXJMaXN0KSBjb250aW51ZTsKCiAgICAgICAgICAgIGlmICgh\nIHN1YnNjcmliZXJMaXN0Lmxpc3RJdGVyYXRvcigpLmhhc05leHQoKSkgY29u\ndGludWU7CgogICAgICAgICAgICAvLyBGb3Igc2VsZWN0b3Igc3VwcG9ydCAt\nIHBpY2sgdXAgdGhlIGxhc3QgcmVnaXN0ZXIKICAgICAgICAgICAgTm9kZSBh\nc3QgPSBzdWJzY3JpcHRpb25zLmdldFNlbGVjdG9yRXhwcmVzc2lvbihzdWJz\nY3JpcHRpb24pOwogICAgICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFi\nbGVkKCkpIGxvZ2dlci50cmFjZSgic3Vic2NyaXB0aW9uIDogIiArIHN1YnNj\ncmlwdGlvbiArICIsIHNlbGVjdG9yIDogIiArIGFzdCk7CiAgICAgICAgICAg\nIGlmIChudWxsICE9IGFzdCl7CiAgICAgICAgICAgICAgICAvLyBmaW5hbCBC\nb29sZWFuIHZhbHVlID0gU2VsZWN0b3JQYXJzZXIuZXZhbHVhdGVTZWxlY3Rv\ncihhc3QsIHJlY2VpdmVkTWVzc2FnZS5vcmlnaW5hbE1lc3NhZ2UpOwogICAg\nICAgICAgICAgICAgZmluYWwgQm9vbGVhbiB2YWx1ZSA9IFNlbGVjdG9yUGFy\nc2VyLmV2YWx1YXRlU2VsZWN0b3IoYXN0LCByZWNlaXZlZE1lc3NhZ2UubXNn\nKTsKCiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB2YWx1ZSl7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiVW5hYmxl\nIHRvIGV2YWx1YXRlIHNlbGVjdG9yID8gLi4uIGlnbm9yaW5nIG1lc3NhZ2Ui\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJNZXNz\nYWdlIDogIiArIHJlY2VpdmVkTWVzc2FnZS5tc2cpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZWNlaXZlZE1lc3NhZ2Uu\nb3JpZ2luYWxNZXNzYWdlLmdldEFja1J1bm5hYmxlKCkucnVuKCk7CiAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBpZiAoISBCb29sZWFuLlRSVUUuZXF1YWxzKHZhbHVl\nKSl7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5h\nYmxlZCgpKSBsb2dnZXIudHJhY2UoIlNlbGVjdG9yIERJRCBOT1QgZXZhbHVh\ndGUgdG8gdHJ1ZSAoIiArCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVl\nICsgIiksIGlnbm9yZSBtZXNzYWdlIGlnbm9yaW5nIG1lc3NhZ2UiKTsKICAg\nICAgICAgICAgICAgICAgICByZWNlaXZlZE1lc3NhZ2Uub3JpZ2luYWxNZXNz\nYWdlLmdldEFja1J1bm5hYmxlKCkucnVuKCk7CiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCgogICAgICAgICAgICBpZiAobnVsbCAhPSBzZXNzaW9uTWVzc2FnZUxpc3Rl\nbmVyKXsKICAgICAgICAgICAgICAgIC8vIFNpbmNlIHRoZXJlIHdhcyBhdGxl\nYXN0IG9uZSBzdWJzY3JpYmVyIHdoZW4gd2Ugc3RhcnRlZCB0aGlzIGxvb3Ag\nKHdoaWNoIG1pZ2h0CiAgICAgICAgICAgICAgICAvLyBub3QgYmUgY2FzZSBh\nbnltb3JlLCBidXQgdGhhdCBpcyBqdXN0IGFuIHVuY29udHJvbGxhYmxlIGhh\ncm1sZXNzIHJhY2UpCiAgICAgICAgICAgICAgICAvLyB3ZSBjYW4gc2VuZCBp\ndCB0byBtZXNzYWdlTGlzdGVuZXIgZm9yIHRoZSBzZXNzaW9uLgogICAgICAg\nICAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dnZXIu\ndHJhY2UoIkRpc3BhdGNoaW5nICIgKyByZWNlaXZlZE1lc3NhZ2Uub3JpZ2lu\nYWxNZXNzYWdlICsKICAgICAgICAgICAgICAgICAgICAiIHRvIHNlc3Npb24g\nbGlzdGVuZXIiKTsKCiAgICAgICAgICAgICAgICBpZiAoaXNNZXNzYWdlRXhw\naXJlZChyZWNlaXZlZE1lc3NhZ2Uub3JpZ2luYWxNZXNzYWdlKSl7CiAgICAg\nICAgICAgICAgICAgICAgLy8gbWVzc2FnZSBhbHJlYWR5IGV4cGlyZWQuCiAg\nICAgICAgICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB3ZSBhY2tub3dsZWRn\nZSBmb3IgYWxsIHN1YnNjcmliZXJzIHdpdGggdGhpcyBzdWJzY3JpcHRpb24g\naWQgLi4uCiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWRNZXNzYWdlLm9y\naWdpbmFsTWVzc2FnZS5nZXRBY2tSdW5uYWJsZSgpLnJ1bigpOwogICAgICAg\nICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgZmluYWwg\nTWVzc2FnZUltcGwgbWVzc2FnZSA9IE1lc3NhZ2VVdGlsLmNyZWF0ZUNsb25l\nRm9yRGlzcGF0Y2godGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgcmVj\nZWl2ZWRNZXNzYWdlLm9yaWdpbmFsTWVzc2FnZSwgcmVjZWl2ZWRNZXNzYWdl\nLm9yaWdpbmFsTWVzc2FnZS5nZXRTb3VyY2VOYW1lKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJlY2VpdmVkTWVzc2FnZS5vcmlnaW5hbE1lc3NhZ2Uu\nZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICAgICAgICAgICAgICAgIGRlbGl2\nZXJUb0xpc3RlbmVyKHNlc3Npb25NZXNzYWdlTGlzdGVuZXIsIHJlY2VpdmVk\nTWVzc2FnZSwgbWVzc2FnZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAv\nLyBVbmV4cGVjdGVkIG5vdCB0byBiZSBhYmxlIHRvIGNsb25lIC4uLgogICAg\nICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlVuZXhw\nZWN0ZWQgZXhjZXB0aW9uIHRyeWluZyB0byBwcm9jZXNzIG1lc3NhZ2UiKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgRGVidWdVdGlsLmR1bXBKTVNTdGFj\na3RyYWNlKGxvZ2dlciwgZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoZmluYWwgTWVzc2FnZUNvbnN1\nbWVyIHN1YnNjcmliZXIgOiBzdWJzY3JpYmVyTGlzdCl7CiAgICAgICAgICAg\nICAgICBpZiAoaXNDbG9zZWQoKSkgYnJlYWs7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGZpbmFsIE1lc3NhZ2VMaXN0ZW5l\nciBzdWJzY3JpYmVyTGlzdGVuZXIgPSBzdWJzY3JpYmVyLmdldE1lc3NhZ2VM\naXN0ZW5lcigpOwogICAgICAgICAgICAgICAgICAgIC8vIENsb25lIC0gc2lu\nY2UgZWFjaCBzdWJzY3JiZXIgY2FuIG1vZGlmeSB0aGUgbWVzc2FnZS4gIFdl\nIGFyZSBvcHRpbWl6aW5nIHRoaXMKICAgICAgICAgICAgICAgICAgICAvLyB0\nbyBjbG9uZSBvbmx5IGlmIHN1YnNjcmliZXJMaXN0CiAgICAgICAgICAgICAg\nICAgICAgLy8gaGFzIG1vcmUgdGhhbiBvbmUgc3Vic2NyaWJlciB0byBhdm9p\nZCB0aGUgKHBvdGVudGlhbGx5KSBleHBlbnNpdmUgY3JlYXRpb24uCiAgICAg\nICAgICAgICAgICAgICAgaWYgKGdldE5vTG9jYWwoc3Vic2NyaXB0aW9uLCBz\ndWJzY3JpYmVyKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0xv\nY2FsbHlQdWJsaXNoZWQocmVjZWl2ZWRNZXNzYWdlLm9yaWdpbmFsTWVzc2Fn\nZS5nZXRKTVNNZXNzYWdlSUQoKSkpewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gVGhpcyBtZWFucyB3ZSBhY2tub3dsZWRnZSBmb3IgYWxsIHN1\nYnNjcmliZXJzIHdpdGggdGhpcyBzdWJzY3JpcHRpb24gaWQgLi4uCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlZE1lc3NhZ2Uub3JpZ2lu\nYWxNZXNzYWdlLmdldEFja1J1bm5hYmxlKCkucnVuKCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICBpZiAoaXNNZXNzYWdlRXhwaXJlZChyZWNlaXZlZE1lc3NhZ2Uub3Jp\nZ2luYWxNZXNzYWdlKSl7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2Vp\ndmVkTWVzc2FnZS5vcmlnaW5hbE1lc3NhZ2UuZ2V0QWNrUnVubmFibGUoKS5y\ndW4oKTsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAg\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmaW5hbCBN\nZXNzYWdlSW1wbCBtZXNzYWdlID0gTWVzc2FnZVV0aWwuY3JlYXRlQ2xvbmVG\nb3JEaXNwYXRjaCh0aGlzLAogICAgICAgICAgICAgICAgICAgICAgICByZWNl\naXZlZE1lc3NhZ2Uub3JpZ2luYWxNZXNzYWdlLCByZWNlaXZlZE1lc3NhZ2Uu\nb3JpZ2luYWxNZXNzYWdlLmdldFNvdXJjZU5hbWUoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgcmVjZWl2ZWRNZXNzYWdlLm9yaWdpbmFsTWVzc2FnZS5n\nZXRTdWJzY3JpYmVySWQoKSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChs\nb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJEaXNwYXRj\naGluZyAiICsgbWVzc2FnZSArCiAgICAgICAgICAgICAgICAgICAgICAgICIg\ndG8gc3Vic2NyaWJlciBzdWJzY3JpYmVyTGlzdGVuZXIgPyAiICsgKHN1YnNj\ncmliZXJMaXN0ZW5lciAhPSBudWxsKSk7CgogICAgICAgICAgICAgICAgICAg\nIGlmIChudWxsICE9IHN1YnNjcmliZXJMaXN0ZW5lcikgewogICAgICAgICAg\nICAgICAgICAgICAgICBkZWxpdmVyVG9MaXN0ZW5lcihzdWJzY3JpYmVyTGlz\ndGVuZXIsIHJlY2VpdmVkTWVzc2FnZSwgbWVzc2FnZSwgZmFsc2UpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbkZhY2FkZS5lbnF1ZXVl\nUmVjZWl2ZWRNZXNzYWdlKHN1YnNjcmliZXIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgUmVjZWl2ZWRNZXNzYWdlKHJlY2VpdmVkTWVzc2Fn\nZS5vcmlnaW5hbE1lc3NhZ2UsIG1lc3NhZ2UsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmVjZWl2ZWRNZXNzYWdlLmRlc3RpbmF0aW9uVHlw\nZSksIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgICAgIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2Vy\nLnRyYWNlKCJEaXNwYXRjaGluZyAiICsgbWVzc2FnZSArCiAgICAgICAgICAg\nICAgICAgICAgICAgICIgdG8gc3Vic2NyaWJlckxpc3RlbmVyID8gIiArIChz\ndWJzY3JpYmVyTGlzdGVuZXIgIT0gbnVsbCkgKyAiLCBET05FIik7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgICAgIC8vIFVuZXhwZWN0ZWQgbm90IHRvIGJlIGFibGUgdG8g\nY2xvbmUgLi4uCiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0Rl\nYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dl\nci5kZWJ1ZygiVW5leHBlY3RlZCBleGNlcHRpb24gdHJ5aW5nIHRvIHByb2Nl\nc3MgbWVzc2FnZSIsIGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBjb250aW51ZSA7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChsb2dnZXIuaXNU\ncmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJkaXNwYXRjaFJlY2VpdmVk\nTWVzc2FnZXNUb1N1YnNjcmliZXJzKCkgRE9ORSIpOwogICAgfQoKICAgIHBy\naXZhdGUgYm9vbGVhbiBnZXROb0xvY2FsKFN1YnNjcmlwdGlvbiBzdWJzY3Jp\ncHRpb24sIE1lc3NhZ2VDb25zdW1lciBzdWJzY3JpYmVyKSB0aHJvd3MgSk1T\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc3Vic2NyaXB0aW9uLmlzVG9waWMo\nKSkgcmV0dXJuICgoVG9waWNTdWJzY3JpYmVyKSBzdWJzY3JpYmVyKS5nZXRO\nb0xvY2FsKCk7CiAgICAgICAgLy8gbm90aGluZyBlcXVpdmFsZW50IGZvciBx\ndWV1ZS4KICAgICAgICAvLyBpZiAoc3Vic2NyaXB0aW9uLmlzUXVldWUoKSkg\ncmV0dXJuICgoUXVldWVSZWNlaXZlcikgc3Vic2NyaWJlcikuZ2V0Tm9Mb2Nh\nbCgpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICAvLyBOb3Rl\nIHRoYXQgcm9sbGJhY2sgY2FuIGhhcHBlbiBXSElMRSBhIGxpc3RlbmVyIGlz\nIGJlaW5nIHJ1biAtIHNvIHdlIG5lZWQgdG8gY2hlY2sgdGhpcwogICAgLy8g\nYmV0d2VlbiBFQUNIIG1lc3NhZ2UgZGVsaXZlcnkgOi0oCiAgICAvLyBOb3Qg\nanVzdCBhcyBwYXJ0IG9mIGJsb2NrIGRyYWluaW5nIG9mIHRoZSBxdWV1ZS4K\nICAgIC8vIHJldHVybnMgdHJ1ZSBpZiB0aGVyZSB3YXMgYW55IGFzeW5jIG9w\nZXJhdGlvbiB0byByb2xsYmFjayAoc3BlY2lmaWNhbGx5IGFzeW5jICEpLgog\nICAgcHJpdmF0ZSBib29sZWFuIGhhbmRsZVJvbGxiYWNrSW5EaXNwYXRjaChM\naXN0PFRyYW5zYWN0ZWRSZWNlaXZlT3BlcmF0aW9uPiByb2xsZWRiYWNrTWVz\nc2FnZUxpc3RDb3B5KSB7CiAgICAgICAgaWYgKG51bGwgPT0gcm9sbGVkYmFj\na01lc3NhZ2VMaXN0Q29weSkgewogICAgICAgICAgICAvLyBBdHRlbXB0IHRv\nIGRyYWluIHRoZSBxdWV1ZS4KICAgICAgICAgICAgc3luY2hyb25pemVkIChs\nb2NrT2JqZWN0KXsKICAgICAgICAgICAgICAgIGlmIChyb2xsZWRiYWNrTWVz\nc2FnZUxpc3QuaXNFbXB0eSgpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAg\nICAgICByb2xsZWRiYWNrTWVzc2FnZUxpc3RDb3B5ID0gbmV3IEFycmF5TGlz\ndDxUcmFuc2FjdGVkUmVjZWl2ZU9wZXJhdGlvbj4ocm9sbGVkYmFja01lc3Nh\nZ2VMaXN0KTsKICAgICAgICAgICAgICAgIHJvbGxlZGJhY2tNZXNzYWdlTGlz\ndC5jbGVhcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBp\nZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgicm9s\nbGVkYmFja01lc3NhZ2VMaXN0ICgiICsKICAgICAgICAgICAgcm9sbGVkYmFj\na01lc3NhZ2VMaXN0Q29weS5zaXplKCkgKyAiKSAuLi4gIiArIHJvbGxlZGJh\nY2tNZXNzYWdlTGlzdENvcHkpOwoKICAgICAgICBMaW5rZWRMaXN0PFRyYW5z\nYWN0ZWRSZWNlaXZlT3BlcmF0aW9uPiBsaXN0ZW5lckRlbGl2ZXJ5TGlzdCA9\nIG5ldyBMaW5rZWRMaXN0PFRyYW5zYWN0ZWRSZWNlaXZlT3BlcmF0aW9uPigp\nOwogICAgICAgIGZvciAoVHJhbnNhY3RlZFJlY2VpdmVPcGVyYXRpb24gcmVj\nZWl2ZU9wIDogcm9sbGVkYmFja01lc3NhZ2VMaXN0Q29weSl7CiAgICAgICAg\nICAgIGlmIChpc0Nsb3NlZCgpKSBicmVhazsKICAgICAgICAgICAgcmVjZWl2\nZU9wLnJlY292ZXIobGlzdGVuZXJEZWxpdmVyeUxpc3QpOwogICAgICAgIH0K\nICAgICAgICBmb3IgKFRyYW5zYWN0ZWRSZWNlaXZlT3BlcmF0aW9uIHJlY2Vp\ndmVPcCA6IGxpc3RlbmVyRGVsaXZlcnlMaXN0KXsKICAgICAgICAgICAgaWYg\nKGlzQ2xvc2VkKCkpIGJyZWFrOwogICAgICAgICAgICByZWNlaXZlT3AucmVj\nb3ZlckZvckxpc3RlbmVyKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4g\nbGlzdGVuZXJEZWxpdmVyeUxpc3Quc2l6ZSgpID4gMDsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgZGVsaXZlclRvTGlzdGVuZXIoTWVzc2FnZUxpc3RlbmVy\nIHNlc3Npb25NZXNzYWdlTGlzdGVuZXIsIFJlY2VpdmVkTWVzc2FnZSByZWNl\naXZlZE1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgTWVzc2FnZUltcGwgdGhlTWVzc2FnZSwgYm9vbGVhbiByZWRlbGl2ZXJ5\nKSB7CgogICAgICAvLyBOT1QgcmUtZW50ZXJlbnQgbWV0aG9kIC4uLgogICAg\nICAgIGNsb3NlRnJvbVdpdGhpbkxpc3RlbmVyLnNldCh0cnVlKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpbnQgZXJyb3JSZXRyeSA9IDA7CiAgICAg\nICAgICAgIGJvb2xlYW4gc3VjY2VzcyA9IGZhbHNlOwogICAgICAgICAgICBm\naW5hbCBpbnQgcmV0cnlGb3IgPQogICAgICAgICAgICAgICAgICAgICghZ2V0\nVHJhbnNhY3RlZCgpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAo\nU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFID09IGdldEFja25vd2xlZGdlTW9k\nZSgpIHx8CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFNl\nc3Npb24uQ0xJRU5UX0FDS05PV0xFREdFID09IGdldEFja25vd2xlZGdlTW9k\nZSgpKSkKICAgICAgICAgICAgICAgICAgICA/IDMgOiAxOwoKICAgICAgICAg\nICAgd2hpbGUgKGVycm9yUmV0cnkgPCByZXRyeUZvciAmJiAhaXNDbG9zZWQo\nKSl7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nIGlmIChyZWRlbGl2ZXJ5IHx8IGVycm9yUmV0cnkgPiAwKSB0aGVNZXNzYWdl\nLnNldEpNU1JlZGVsaXZlcmVkKHRydWUpOwoKICAgICAgICAgICAgICAgICAg\nICAvLyBDaGFuZ2VkIG15IG1pbmQsIGFsd2F5cyBhY2sgdGhlIG1lc3NhZ2Ug\nYmVmb3JlIHByb2Nlc3NpbmcgaXQuIFRoaXMgc2VlbXMgdG8KICAgICAgICAg\nICAgICAgICAgICAvLyBiZSBjb25zaXN0ZW50IHdpdGggYWN0aXZlbXEgdGVz\ndGNhc2VzIHRvbyAuLi4KICAgICAgICAgICAgICAgICAgICBoYW5kbGVBdXRv\nbWF0aWNNZXNzYWdlQWNrbm93bGVkZ2VtZW50KHJlY2VpdmVkTWVzc2FnZSwg\nc2Vzc2lvbk1lc3NhZ2VMaXN0ZW5lcik7CiAgICAgICAgICAgICAgICAgICAg\nc2Vzc2lvbk1lc3NhZ2VMaXN0ZW5lci5vbk1lc3NhZ2UodGhlTWVzc2FnZSk7\nCiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyA9IHRydWU7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWsgOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nUnVudGltZUV4Y2VwdGlvbiByRXgpewogICAgICAgICAgICAgICAgICAgIC8v\nIEJhZGx5IGJlaGF2ZWQgY2xpZW50LCByZXRyeSAuLi4KICAgICAgICAgICAg\nICAgICAgICBpZiAobG9nZ2VyLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAg\nICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJVbmV4cGVjdGVkIHJ1bnRpbWUg\nZXhjZXB0aW9uIGZyb20gY2xpZW50IG1lc3NhZ2UgbGlzdGVuZXIuIiwgckV4\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVycm9yUmV0\ncnkgKys7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpc0Nsb3Nl\nZCgpKSByZXR1cm4gOwoKICAgICAgICAgICAgaWYgKCFzdWNjZXNzKXsKICAg\nICAgICAgICAgICAgIC8vIElmIGZhaWxlZCwgdGhlbiByZXNldCB0cmFuc2Fj\ndGlvbiBzdGF0ZSAtIHNvIHRoYXQgbmV4dCB0eG4gd2lsbCBub3QgZ2V0IGFm\nZmVjdGVkIGJ5IHRoaXMuCiAgICAgICAgICAgICAgICByb2xsYmFja1RyYW5z\nYWN0aW9uU3RhdGUoKTsKICAgICAgICAgICAgICAgIC8vIFdlIGdhdmUgdXAg\nZGVsaXZlcnlpbmcgbWVzc2FnZSAuLi4KICAgICAgICAgICAgICAgIGlmIChy\nZXRyeUZvciA+IDEpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2Vy\nLmlzSW5mb0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgIGxvZ2dl\nci5pbmZvKCJEZWxpdmVyeSBvZiBtZXNzYWdlIHRvIGxpc3RlbmVyIHJlc3Vs\ndGVkIGluIHJlcGVhdGVkIGZhaWx1cmVzLCAiICsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAiIGRyb3BwaW5nIG1lc3NhZ2UgLSAgc2Vzc2lvbiByZWNv\ndmVyeSBzaG91bGQgYmUgdXNlZCB0byBoYW5kbGUgaXQuIik7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAobG9nZ2VyLmlzSW5mb0VuYWJsZWQoKSkgbG9nZ2VyLmlu\nZm8oIlVzZSBzZXNzaW9uIHJlY292ZXJ5IHRvIGhhbmRsZSBtZXNzYWdlIik7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBjbG9zZUZyb21XaXRoaW5MaXN0ZW5lci5y\nZW1vdmUoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIE1lc3NhZ2lu\nZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25UeXBlIGZpbmREZXN0aW5hdGlv\nblR5cGUoU3RyaW5nIGRlc3RpbmF0aW9uKSB0aHJvd3MgSk1TRXhjZXB0aW9u\nIHsKICAgICAgICByZXR1cm4gc2Vzc2lvbkZhY2FkZS5maW5kRGVzdGluYXRp\nb25UeXBlKGRlc3RpbmF0aW9uKTsKICAgIH0KCiAgICBwdWJsaWMgTWVzc2Fn\naW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUgZmluZERlc3RpbmF0\naW9uVHlwZShEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbikgdGhyb3dzIEpNU0V4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHNlc3Npb25GYWNhZGUuZmluZERl\nc3RpbmF0aW9uVHlwZShkZXN0aW5hdGlvbik7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgTWVzc2FnZVByb2R1Y2VyIGNyZWF0ZVByb2R1Y2Vy\nKERlc3RpbmF0aW9uIGRlc3RpbmF0aW9uKSB0aHJvd3MgSk1TRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkg\ndGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFs\ncmVhZHkgY2xvc2VkIik7CiAgICAgICAgY29ubmVjdGlvbi5pbml0Q29ubmVj\ndGlvbkNsaWVudElEKCk7CgogICAgICAgIHJldHVybiBjcmVhdGVQcm9kdWNl\nckltcGwoZmluZERlc3RpbmF0aW9uVHlwZShkZXN0aW5hdGlvbiksIGRlc3Rp\nbmF0aW9uKTsKICAgIH0KCiAgICBwcml2YXRlIE1lc3NhZ2VQcm9kdWNlciBj\ncmVhdGVQcm9kdWNlckltcGwoTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0\naW5hdGlvblR5cGUgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbikg\ndGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgc3dpdGNoICh0eXBlKXsK\nICAgICAgICAgICAgY2FzZSBRVUVVRToKICAgICAgICAgICAgICAgIHJldHVy\nbiBzZXNzaW9uRmFjYWRlLmNyZWF0ZVF1ZXVlU2VuZGVyKGRlc3RpbmF0aW9u\nKTsKICAgICAgICAgICAgY2FzZSBUT1BJQzoKICAgICAgICAgICAgICAgIHJl\ndHVybiBzZXNzaW9uRmFjYWRlLmNyZWF0ZVRvcGljUHVibGlzaGVyKGRlc3Rp\nbmF0aW9uKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBKTVNFeGNlcHRpb24oIlVuYWJsZSB0byBmaW5kIGRlc3Rp\nbmF0aW9uIHR5cGUgIiArIGRlc3RpbmF0aW9uICsKICAgICAgICAgICAgICAg\nICAgICAiLCBwbGVhc2UgdXNlIGV4cGxpY2l0IHF1ZXVlL3RvcGljIG1ldGhv\nZHMgdG8gY3JlYXRlIHByb2R1Y2VyIik7CiAgICAgICAgfQogICAgfQoKICAg\nIC8vIGRlbGVnYXRlIHRvIHRoaXMgSUYgdGhpcyBtZXRob2QgY2FuIGJlIGlu\ndm9rZWQgKHNwZWNpZmljYWxseSwgaWYgbm90IFF1ZXVlU2Vzc2lvbikKICAg\nIHByb3RlY3RlZCBUb3BpY1B1Ymxpc2hlciBjcmVhdGVQdWJsaXNoZXJJbXBs\nKFRvcGljIHRvcGljKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoc2Vzc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGph\ndmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2Vk\nIik7CiAgICAgICAgaWYgKG51bGwgPT0gdG9waWMpIHRocm93IG5ldyBJbnZh\nbGlkRGVzdGluYXRpb25FeGNlcHRpb24oIklsbGVnYWwgZGVzdGluYXRpb24i\nKTsKICAgICAgICBjb25uZWN0aW9uLmluaXRDb25uZWN0aW9uQ2xpZW50SUQo\nKTsKCiAgICAgICAgcmV0dXJuIChUb3BpY1B1Ymxpc2hlcikgY3JlYXRlUHJv\nZHVjZXJJbXBsKE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25U\neXBlLlRPUElDLCB0b3BpYyk7CiAgICB9CgoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIE1lc3NhZ2VDb25zdW1lciBjcmVhdGVDb25zdW1lcihEZXN0aW5h\ndGlvbiBkZXN0aW5hdGlvbikgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKHNlc3Npb25TdGF0ZS5pc0luQ2xvc2VNb2RlKCkpIHRocm93IG5l\ndyBqYXZheC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJBbHJlYWR5IGNs\nb3NlZCIpOwogICAgICAgIGlmIChudWxsID09IGRlc3RpbmF0aW9uKSB0aHJv\ndyBuZXcgSW52YWxpZERlc3RpbmF0aW9uRXhjZXB0aW9uKCJJbGxlZ2FsIGRl\nc3RpbmF0aW9uIik7CiAgICAgICAgY29ubmVjdGlvbi5pbml0Q29ubmVjdGlv\nbkNsaWVudElEKCk7CgogICAgICAgIHJldHVybiBjcmVhdGVDb25zdW1lcklt\ncGwoZmluZERlc3RpbmF0aW9uVHlwZShkZXN0aW5hdGlvbiksIGRlc3RpbmF0\naW9uKTsKICAgIH0KCiAgICBwcml2YXRlIE1lc3NhZ2VDb25zdW1lciBjcmVh\ndGVDb25zdW1lckltcGwoTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5h\ndGlvblR5cGUgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbikgdGhy\nb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgc3dpdGNoICh0eXBlKXsKICAg\nICAgICAgICAgY2FzZSBRVUVVRToKICAgICAgICAgICAgICAgIHJldHVybiBz\nZXNzaW9uRmFjYWRlLmNyZWF0ZVF1ZXVlUmVjZWl2ZXIoZGVzdGluYXRpb24p\nOwogICAgICAgICAgICBjYXNlIFRPUElDOgogICAgICAgICAgICAgICAgcmV0\ndXJuIHNlc3Npb25GYWNhZGUuY3JlYXRlVG9waWNTdWJzY3JpYmVyKGRlc3Rp\nbmF0aW9uKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBKTVNFeGNlcHRpb24oIlVuYWJsZSB0byBmaW5kIGRlc3Rp\nbmF0aW9uIHR5cGUgIiArIGRlc3RpbmF0aW9uICsKICAgICAgICAgICAgICAg\nICAgICAiLCBwbGVhc2UgdXNlIGV4cGxpY2l0IHF1ZXVlL3RvcGljIG1ldGhv\nZHMgdG8gY3JlYXRlIGNvbnN1bWVyIik7CiAgICAgICAgfQogICAgfQoKICAg\nIC8vIGRlbGVnYXRlIHRvIHRoaXMgSUYgdGhpcyBtZXRob2QgY2FuIGJlIGlu\ndm9rZWQgKHNwZWNpZmljYWxseSwgaWYgbm90IFF1ZXVlU2Vzc2lvbikKICAg\nIHByb3RlY3RlZCBUb3BpY1N1YnNjcmliZXIgY3JlYXRlU3Vic2NyaWJlcklt\ncGwoVG9waWMgdG9waWMpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAg\nIGlmIChzZXNzaW9uU3RhdGUuaXNJbkNsb3NlTW9kZSgpKSB0aHJvdyBuZXcg\namF2YXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQWxyZWFkeSBjbG9z\nZWQiKTsKICAgICAgICBpZiAobnVsbCA9PSB0b3BpYykgdGhyb3cgbmV3IElu\ndmFsaWREZXN0aW5hdGlvbkV4Y2VwdGlvbigiSWxsZWdhbCBkZXN0aW5hdGlv\nbiIpOwogICAgICAgIGNvbm5lY3Rpb24uaW5pdENvbm5lY3Rpb25DbGllbnRJ\nRCgpOwoKICAgICAgICByZXR1cm4gKFRvcGljU3Vic2NyaWJlcikgY3JlYXRl\nQ29uc3VtZXJJbXBsKE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRp\nb25UeXBlLlRPUElDLCB0b3BpYyk7CiAgICB9CgogICAgLy8gZGVsZWdhdGUg\ndG8gdGhpcyBJRiB0aGlzIG1ldGhvZCBjYW4gYmUgaW52b2tlZCAoc3BlY2lm\naWNhbGx5LCBpZiBub3QgUXVldWVTZXNzaW9uKQogICAgcHJvdGVjdGVkIFRv\ncGljU3Vic2NyaWJlciBjcmVhdGVTdWJzY3JpYmVySW1wbChUb3BpYyB0b3Bp\nYywgU3RyaW5nIG1lc3NhZ2VTZWxlY3RvciwgYm9vbGVhbiBub0xvY2FsKQog\nICAgICAgIHRocm93cyBKTVNFeGNlcHRpb24gewoKICAgICAgICBpZiAoc2Vz\nc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmpt\ncy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CiAg\nICAgICAgaWYgKG51bGwgPT0gdG9waWMpIHRocm93IG5ldyBJbnZhbGlkRGVz\ndGluYXRpb25FeGNlcHRpb24oIklsbGVnYWwgZGVzdGluYXRpb24iKTsKICAg\nICAgICBjb25uZWN0aW9uLmluaXRDb25uZWN0aW9uQ2xpZW50SUQoKTsKCiAg\nICAgICAgcmV0dXJuIChUb3BpY1N1YnNjcmliZXIpIGNyZWF0ZUNvbnN1bWVy\nSW1wbChNZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlwZS5U\nT1BJQywKICAgICAgICAgICAgdG9waWMsIG1lc3NhZ2VTZWxlY3Rvciwgbm9M\nb2NhbCk7CiAgICB9CgoKICAgIEBPdmVycmlkZQogICAgcHVibGljIE1lc3Nh\nZ2VDb25zdW1lciBjcmVhdGVDb25zdW1lcihEZXN0aW5hdGlvbiBkZXN0aW5h\ndGlvbiwgU3RyaW5nIG1lc3NhZ2VTZWxlY3RvcikgdGhyb3dzIEpNU0V4Y2Vw\ndGlvbiB7CiAgICAgICAgaWYgKHNlc3Npb25TdGF0ZS5pc0luQ2xvc2VNb2Rl\nKCkpIHRocm93IG5ldyBqYXZheC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9u\nKCJBbHJlYWR5IGNsb3NlZCIpOwogICAgICAgIGlmIChudWxsID09IGRlc3Rp\nbmF0aW9uKSB0aHJvdyBuZXcgSW52YWxpZERlc3RpbmF0aW9uRXhjZXB0aW9u\nKCJJbGxlZ2FsIGRlc3RpbmF0aW9uIik7CiAgICAgICAgY29ubmVjdGlvbi5p\nbml0Q29ubmVjdGlvbkNsaWVudElEKCk7CgogICAgICAgIHJldHVybiBjcmVh\ndGVDb25zdW1lcihkZXN0aW5hdGlvbiwgbWVzc2FnZVNlbGVjdG9yLCBmYWxz\nZSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTWVzc2FnZUNv\nbnN1bWVyIGNyZWF0ZUNvbnN1bWVyKERlc3RpbmF0aW9uIGRlc3RpbmF0aW9u\nLCBTdHJpbmcgbWVzc2FnZVNlbGVjdG9yLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBib29sZWFuIG5vTG9jYWwpIHRocm93\ncyBKTVNFeGNlcHRpb24gewoKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlz\nSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CiAgICAgICAgaWYgKG51\nbGwgPT0gZGVzdGluYXRpb24pIHRocm93IG5ldyBJbnZhbGlkRGVzdGluYXRp\nb25FeGNlcHRpb24oIklsbGVnYWwgZGVzdGluYXRpb24iKTsKICAgICAgICBj\nb25uZWN0aW9uLmluaXRDb25uZWN0aW9uQ2xpZW50SUQoKTsKCiAgICAgICAg\ncmV0dXJuIGNyZWF0ZUNvbnN1bWVySW1wbChmaW5kRGVzdGluYXRpb25UeXBl\nKGRlc3RpbmF0aW9uKSwgZGVzdGluYXRpb24sIG1lc3NhZ2VTZWxlY3Rvciwg\nbm9Mb2NhbCk7CiAgICB9CgogICAgcHJpdmF0ZSBNZXNzYWdlQ29uc3VtZXIg\nY3JlYXRlQ29uc3VtZXJJbXBsKE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVz\ndGluYXRpb25UeXBlIHR5cGUsIERlc3RpbmF0aW9uIGRlc3RpbmF0aW9uLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIFN0cmluZyBtZXNzYWdlU2VsZWN0b3IsIGJvb2xlYW4gbm9Mb2NhbCkgdGhy\nb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgc3dpdGNoICh0eXBlKXsKICAg\nICAgICAgICAgY2FzZSBRVUVVRToKICAgICAgICAgICAgICAgIHJldHVybiBz\nZXNzaW9uRmFjYWRlLmNyZWF0ZVF1ZXVlUmVjZWl2ZXIoZGVzdGluYXRpb24s\nIG1lc3NhZ2VTZWxlY3Rvciwgbm9Mb2NhbCk7CiAgICAgICAgICAgIGNhc2Ug\nVE9QSUM6CiAgICAgICAgICAgICAgICByZXR1cm4gc2Vzc2lvbkZhY2FkZS5j\ncmVhdGVUb3BpY1N1YnNjcmliZXIoZGVzdGluYXRpb24sIG1lc3NhZ2VTZWxl\nY3Rvciwgbm9Mb2NhbCk7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJVbmFibGUgdG8gZmlu\nZCBkZXN0aW5hdGlvbiB0eXBlICIgKyBkZXN0aW5hdGlvbiArCiAgICAgICAg\nICAgICAgICAgICAgIiwgcGxlYXNlIHVzZSBleHBsaWNpdCBxdWV1ZS90b3Bp\nYyBtZXRob2RzIHRvIGNyZWF0ZSBjb25zdW1lciIpOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLyBUT0RPOiBDaGVjayBpZiBpdCBpcyBhY3R1YWxseSBhIFF1\nZXVlICEKICAgIEBPdmVycmlkZQogICAgcHVibGljIFF1ZXVlIGNyZWF0ZVF1\nZXVlKFN0cmluZyBxdWV1ZU5hbWUpIHRocm93cyBKTVNFeGNlcHRpb24gewog\nICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNJbkNsb3NlTW9kZSgpKSB0aHJv\ndyBuZXcgamF2YXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQWxyZWFk\neSBjbG9zZWQiKTsKCiAgICAgICAgcmV0dXJuIChRdWV1ZSkgZ2V0RGVzdGlu\nYXRpb24oTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUu\nUVVFVUUsIHF1ZXVlTmFtZSk7CiAgICB9CgogICAgLy8gZGVsZWdhdGUgdG8g\ndGhpcyBJRiB0aGlzIG1ldGhvZCBjYW4gYmUgaW52b2tlZCAoc3BlY2lmaWNh\nbGx5LCBpZiBub3QgVG9waWNTZXNzaW9uKQogICAgcHJvdGVjdGVkIFF1ZXVl\nUmVjZWl2ZXIgY3JlYXRlUmVjZWl2ZXJJbXBsKFF1ZXVlIHF1ZXVlKSB0aHJv\nd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gc2Vzc2lvbkZhY2Fk\nZS5jcmVhdGVRdWV1ZVJlY2VpdmVyKHF1ZXVlKTsKICAgIH0KCiAgICAvLyBk\nZWxlZ2F0ZSB0byB0aGlzIElGIHRoaXMgbWV0aG9kIGNhbiBiZSBpbnZva2Vk\nIChzcGVjaWZpY2FsbHksIGlmIG5vdCBRdWV1ZVNlc3Npb24pCiAgICBwcm90\nZWN0ZWQgUXVldWVSZWNlaXZlciBjcmVhdGVSZWNlaXZlckltcGwoUXVldWUg\ncXVldWUsIFN0cmluZyBtZXNzYWdlU2VsZWN0b3IpIHRocm93cyBKTVNFeGNl\ncHRpb24gewogICAgICAgIHJldHVybiBzZXNzaW9uRmFjYWRlLmNyZWF0ZVF1\nZXVlUmVjZWl2ZXIocXVldWUsIG1lc3NhZ2VTZWxlY3Rvcik7CiAgICB9Cgog\nICAgLy8gZGVsZWdhdGUgdG8gdGhpcyBJRiB0aGlzIG1ldGhvZCBjYW4gYmUg\naW52b2tlZCAoc3BlY2lmaWNhbGx5LCBpZiBub3QgUXVldWVTZXNzaW9uKQog\nICAgcHJvdGVjdGVkIFF1ZXVlU2VuZGVyIGNyZWF0ZVNlbmRlckltcGwoUXVl\ndWUgcXVldWUpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIHJldHVy\nbiBzZXNzaW9uRmFjYWRlLmNyZWF0ZVF1ZXVlU2VuZGVyKHF1ZXVlKTsKICAg\nIH0KCiAgICAvLyBUT0RPOiBDaGVjayBpZiBpdCBpcyBhY3R1YWxseSBhIFRv\ncGljICEKICAgIEBPdmVycmlkZQogICAgcHVibGljIFRvcGljIGNyZWF0ZVRv\ncGljKFN0cmluZyB0b3BpY05hbWUpIHRocm93cyBKTVNFeGNlcHRpb24gewog\nICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNJbkNsb3NlTW9kZSgpKSB0aHJv\ndyBuZXcgamF2YXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlvbigiQWxyZWFk\neSBjbG9zZWQiKTsKICAgICAgICBpZiAobnVsbCA9PSB0b3BpY05hbWUpIHRo\ncm93IG5ldyBJbnZhbGlkRGVzdGluYXRpb25FeGNlcHRpb24oIklsbGVnYWwg\nZGVzdGluYXRpb24iKTsKICAgICAgICBjb25uZWN0aW9uLmluaXRDb25uZWN0\naW9uQ2xpZW50SUQoKTsKCiAgICAgICAgcmV0dXJuIChUb3BpYykgZ2V0RGVz\ndGluYXRpb24oTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5\ncGUuVE9QSUMsIHRvcGljTmFtZSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgVG9waWNTdWJzY3JpYmVyIGNyZWF0ZUR1cmFibGVTdWJzY3Jp\nYmVyKFRvcGljIHRvcGljLCBTdHJpbmcgc3Vic2NyaWJlZElkKSB0aHJvd3Mg\nSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlzSW5D\nbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVF\neGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CgogICAgICAgIGlmIChudWxs\nID09IHRvcGljKSB0aHJvdyBuZXcgSW52YWxpZERlc3RpbmF0aW9uRXhjZXB0\naW9uKCJJbGxlZ2FsIGRlc3RpbmF0aW9uIik7CiAgICAgICAgaWYgKG51bGwg\nPT0gc3Vic2NyaWJlZElkKSB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJJbGxl\nZ2FsIHN1YnNjcmliZWRJZCIpOwogICAgICAgIGNvbm5lY3Rpb24uaW5pdENv\nbm5lY3Rpb25DbGllbnRJRCgpOwoKICAgICAgICBzdWJzY3JpcHRpb25zLnJl\nZ2lzdGVyU3Vic2NyaWJlcklkVG9Ub3BpYyhzdWJzY3JpYmVkSWQsIHRvcGlj\nLmdldFRvcGljTmFtZSgpKTsKICAgICAgICByZXR1cm4gc2Vzc2lvbkZhY2Fk\nZS5jcmVhdGVEdXJhYmxlU3Vic2NyaWJlcih0b3BpYywgY3JlYXRlU3Vic2Ny\naWJlcklkKHN1YnNjcmliZWRJZCkpOwogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIFRvcGljU3Vic2NyaWJlciBjcmVhdGVEdXJhYmxlU3Vic2Ny\naWJlcihUb3BpYyB0b3BpYywgU3RyaW5nIHN1YnNjcmliZWRJZCwgU3RyaW5n\nIG1lc3NhZ2VTZWxlY3RvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBub0xvY2FsKSB0aHJv\nd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlz\nSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CgogICAgICAgIGlmIChu\ndWxsID09IHRvcGljKSB0aHJvdyBuZXcgSW52YWxpZERlc3RpbmF0aW9uRXhj\nZXB0aW9uKCJJbGxlZ2FsIGRlc3RpbmF0aW9uIik7CiAgICAgICAgaWYgKG51\nbGwgPT0gc3Vic2NyaWJlZElkKSB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJJ\nbGxlZ2FsIHN1YnNjcmliZWRJZCIpOwogICAgICAgIGNvbm5lY3Rpb24uaW5p\ndENvbm5lY3Rpb25DbGllbnRJRCgpOwoKICAgICAgICBzdWJzY3JpcHRpb25z\nLnJlZ2lzdGVyU3Vic2NyaWJlcklkVG9Ub3BpYyhzdWJzY3JpYmVkSWQsIHRv\ncGljLmdldFRvcGljTmFtZSgpKTsKICAgICAgICByZXR1cm4gc2Vzc2lvbkZh\nY2FkZS5jcmVhdGVEdXJhYmxlU3Vic2NyaWJlcih0b3BpYywgY3JlYXRlU3Vi\nc2NyaWJlcklkKHN1YnNjcmliZWRJZCksCiAgICAgICAgICAgIG1lc3NhZ2VT\nZWxlY3Rvciwgbm9Mb2NhbCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCB1bnN1YnNjcmliZShTdHJpbmcgc3Vic2NyaWJlZElkKSB0\naHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRl\nLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2Fs\nU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CgogICAgICAgIGZp\nbmFsIFN0cmluZyB0b3BpY05hbWUgPSBzdWJzY3JpcHRpb25zLmZpbmRUb3Bp\nY05hbWVGb3JTdWJzY3JpYmVySWQoc3Vic2NyaWJlZElkKTsKICAgICAgICBz\nZXNzaW9uRmFjYWRlLnVuc3Vic2NyaWJlRnJvbVRvcGljKHRvcGljTmFtZSwg\nY3JlYXRlU3Vic2NyaWJlcklkKHN1YnNjcmliZWRJZCkpOwogICAgfQoKICAg\nIHB1YmxpYyBTdHJpbmcgY3JlYXRlU3Vic2NyaWJlcklkKGZpbmFsIFN0cmlu\nZyBzdWJzY3JpYmVkSWQpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAg\nIGZpbmFsIFN0cmluZyBjbGllbnRJZCA9IGNvbm5lY3Rpb24uZ2V0Q2xpZW50\nSUQoKTsKICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1\naWxkZXIoKTsKCiAgICAgICAgLy8gU29tZSBhcmJpdHJhcnkgY29tYmluYXRp\nb24gb2YgY2xpZW50IGlkIGFuZCBzdWJzY3JpYmVyIGlkLgogICAgICAgIHNi\nLmFwcGVuZCgiQ0xJRU5UX0lEOiIpOwogICAgICAgIHNiLmFwcGVuZChjbGll\nbnRJZCk7CiAgICAgICAgc2IuYXBwZW5kKCd8Jyk7CiAgICAgICAgc2IuYXBw\nZW5kKCJTVUJTQ1JJQkVSX0lEOiIpOwogICAgICAgIHNiLmFwcGVuZChzdWJz\nY3JpYmVkSWQpOwoKICAgICAgICByZXR1cm4gc2IudG9TdHJpbmcoKTsKICAg\nIH0KCiAgICAvKgogICAgcHVibGljIFN0cmluZyBjcmVhdGVUZW1wb3JhcnlU\nb3BpY0lkKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwg\nU3RyaW5nIGNsaWVudElkID0gY29ubmVjdGlvbi5nZXRDbGllbnRJRCgpOwog\nICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigp\nOwoKICAgICAgICAvLyBTb21lIGFyYml0cmFyeSBjb21iaW5hdGlvbiBvZiBj\nbGllbnQgaWQgYW5kIHN1YnNjcmliZXIgaWQuCiAgICAgICAgc2IuYXBwZW5k\nKCJDTElFTlRfSUQ6Iik7CiAgICAgICAgc2IuYXBwZW5kKGNsaWVudElkKTsK\nICAgICAgICBzYi5hcHBlbmQoJ3wnKTsKICAgICAgICBzYi5hcHBlbmQoIlRP\nUElDX0lEOiIpOwogICAgICAgIHNiLmFwcGVuZChnZW5lcmF0ZVJhbmRvbVN0\ncmluZygpKTsKCiAgICAgICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICB9\nCiAgICAqLwoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFF1ZXVlQnJvd3Nl\nciBjcmVhdGVCcm93c2VyKFF1ZXVlIHF1ZXVlKSB0aHJvd3MgSk1TRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUo\nKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24o\nIkFscmVhZHkgY2xvc2VkIik7CgogICAgICAgIHJldHVybiBzZXNzaW9uRmFj\nYWRlLmNyZWF0ZUJyb3dzZXIocXVldWUpOwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIFF1ZXVlQnJvd3NlciBjcmVhdGVCcm93c2VyKFF1ZXVl\nIHF1ZXVlLCBTdHJpbmcgbWVzc2FnZVNlbGVjdG9yKSB0aHJvd3MgSk1TRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlzSW5DbG9zZU1v\nZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRp\nb24oIkFscmVhZHkgY2xvc2VkIik7CgogICAgICAgIHJldHVybiBzZXNzaW9u\nRmFjYWRlLmNyZWF0ZUJyb3dzZXIocXVldWUsIG1lc3NhZ2VTZWxlY3Rvcik7\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgVGVtcG9yYXJ5UXVl\ndWUgY3JlYXRlVGVtcG9yYXJ5UXVldWUoKSB0aHJvd3MgSk1TRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoc2Vzc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkg\ndGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFs\ncmVhZHkgY2xvc2VkIik7CgogICAgICAgIHJldHVybiBzZXNzaW9uRmFjYWRl\nLmNyZWF0ZVRlbXBvcmFyeVF1ZXVlKCk7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgVGVtcG9yYXJ5VG9waWMgY3JlYXRlVGVtcG9yYXJ5VG9w\naWMoKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vzc2lv\nblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmptcy5J\nbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CgogICAg\nICAgIHJldHVybiBzZXNzaW9uRmFjYWRlLmNyZWF0ZVRlbXBvcmFyeVRvcGlj\nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc3Vic2NyaWJlckNyZWF0ZWQo\nKSB7CiAgICAgICAgLy8gc3Vic2NyaWJlckNyZWF0ZWRDb3VudCArKzsKICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBhY2tub3dsZWRnZShNZXNzYWdlSW1wbCBt\nZXNzYWdlKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoc2Vz\nc2lvblN0YXRlLmlzSW5DbG9zZU1vZGUoKSkgdGhyb3cgbmV3IGphdmF4Lmpt\ncy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24oIkFscmVhZHkgY2xvc2VkIik7CiAg\nICAgICAgLy8gSWYgTk9UIGluIGV4cGxpY2l0IGFja25vd2xlZGdlIG1vZGUs\nIGlnbm9yZSByZXF1ZXN0LgogICAgICAgIGlmIChTZXNzaW9uLkNMSUVOVF9B\nQ0tOT1dMRURHRSAhPSBnZXRBY2tub3dsZWRnZU1vZGUoKSkgcmV0dXJuOwog\nICAgICAgIC8vIElmIGluIHRyYW5zYWN0aW9uLCBpZ25vcmUgcmVxdWVzdC4K\nICAgICAgICBpZiAoZ2V0VHJhbnNhY3RlZCgpKSByZXR1cm4gOwoKICAgICAg\nICBzZXNzaW9uRmFjYWRlLmFja25vd2xlZGdlKG1lc3NhZ2UpOwogICAgfQoK\nICAgIHB1YmxpYyBTdHJpbmcgdG9OYW1lKERlc3RpbmF0aW9uIGRlc3RpbmF0\naW9uKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAoZGVzdGlu\nYXRpb24gaW5zdGFuY2VvZiBUb3BpYykgcmV0dXJuICgoVG9waWMpZGVzdGlu\nYXRpb24pLmdldFRvcGljTmFtZSgpOwogICAgICAgIGlmIChkZXN0aW5hdGlv\nbiBpbnN0YW5jZW9mIFF1ZXVlKSByZXR1cm4gKChRdWV1ZSlkZXN0aW5hdGlv\nbikuZ2V0UXVldWVOYW1lKCk7CgogICAgICAgIHRocm93IG5ldyBqYXZheC5q\nbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJVbmtub3duL3Vuc3VwcG9ydGVk\nIGRlc3RpbmF0aW9uICIgKyBkZXN0aW5hdGlvbik7CiAgICB9CgogICAgcHVi\nbGljIHN0YXRpYyBUb3BpYyBhc1RvcGljKGZpbmFsIFN0cmluZyB0b3BpY05h\nbWUpewogICAgICAgIHJldHVybiBuZXcgVG9waWMoKSB7CiAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFRvcGlj\nTmFtZSgpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgICAgICAgICAg\ncmV0dXJuIHRvcGljTmFtZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmco\nKXsKICAgICAgICAgICAgICAgIHJldHVybiB0b3BpY05hbWU7CiAgICAgICAg\nICAgIH0KICAgICAgICB9OwogICAgfQoKCiAgICBwdWJsaWMgc3RhdGljIFF1\nZXVlIGFzUXVldWUoZmluYWwgU3RyaW5nIHF1ZXVlTmFtZSl7CiAgICAgICAg\ncmV0dXJuIG5ldyBRdWV1ZSgpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0UXVldWVOYW1lKCkgdGhyb3dz\nIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICByZXR1cm4gcXVldWVO\nYW1lOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpewogICAgICAgICAg\nICAgICAgcmV0dXJuIHF1ZXVlTmFtZTsKICAgICAgICAgICAgfQogICAgICAg\nIH07CiAgICB9CiAgICAvLyBUT0RPOiBDb252ZXJ0IHRvIEpOREkgbG9va3Vw\nLgogICAgcHVibGljIERlc3RpbmF0aW9uIGdldERlc3RpbmF0aW9uKGZpbmFs\nIE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25UeXBlIHR5cGUs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwg\nU3RyaW5nIGRlc3RpbmF0aW9uKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAg\nICAgICBzd2l0Y2ggKHR5cGUpewogICAgICAgICAgICBjYXNlIFRPUElDOgog\nICAgICAgICAgICAgICAgcmV0dXJuIGFzVG9waWMoZGVzdGluYXRpb24pOwog\nICAgICAgICAgICBjYXNlIFFVRVVFOgogICAgICAgICAgICAgICAgcmV0dXJu\nIGFzUXVldWUoZGVzdGluYXRpb24pOwogICAgICAgICAgICBkZWZhdWx0Ogog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiVW5rbm93\nbiBkZXN0aW5hdGlvbiB0eXBlICIgKyB0eXBlICsKICAgICAgICAgICAgICAg\nICAgICAiIGZvciBkZXN0aW5hdGlvbiAiICsgZGVzdGluYXRpb24pOwogICAg\nICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZW5lcmF0\nZVJhbmRvbVN0cmluZygpIHsKICAgICAgICAvLyBVVUlEIGlzIGV4cGVuc2l2\nZSwgYnV0IHVzaW5nIGl0IGZvciBub3cgLi4uCiAgICAgICAgcmV0dXJuIFVV\nSUQucmFuZG9tVVVJRCgpLnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgcmVnaXN0ZXJUb3BpY1N1YnNjcmlwdGlvbkluZm8oVG9waWNTdWJz\nY3JpcHRpb24gdG9waWNTdWJzY3JpcHRpb24sIE5vZGUgc2VsZWN0b3JBc3Qp\nIHsKICAgICAgICBzdWJzY3JpcHRpb25zLnJlZ2lzdGVyVG9waWNTdWJzY3Jp\ncHRpb25TZWxlY3Rvcih0b3BpY1N1YnNjcmlwdGlvbiwgc2VsZWN0b3JBc3Qp\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVyUXVldWVTdWJzY3Jp\ncHRpb25JbmZvKFF1ZXVlU3Vic2NyaXB0aW9uIHF1ZXVlU3Vic2NyaXB0aW9u\nLCBOb2RlIHNlbGVjdG9yQXN0KSB7CiAgICAgICAgc3Vic2NyaXB0aW9ucy5y\nZWdpc3RlclF1ZXVlU3Vic2NyaXB0aW9uU2VsZWN0b3IocXVldWVTdWJzY3Jp\ncHRpb24sIHNlbGVjdG9yQXN0KTsKICAgIH0KCiAgICAvLyByZXR1cm5zIHRy\ndWUgSUYgd2UgbmVlZCB0byBkbyBhbiBleHBsaWNpdCBzdWJzY3JpYmUgdG8g\ndGhlIHRvcGljICh0aGVyZSB3YXMgTk8gc3Vic2NyaXB0aW9uIHRvIGl0IGVh\ncmxpZXIpLgogICAgcHVibGljIHZvaWQgcmVnaXN0ZXJUb3BpY1N1YnNjcmli\nZXIoVG9waWNTdWJzY3JpYmVyIHRvcGljU3Vic2NyaWJlcikgdGhyb3dzIEpN\nU0V4Y2VwdGlvbiB7CiAgICAgICAgcmVnaXN0ZXJTdWJzY3JpYmVyKHRvcGlj\nU3Vic2NyaWJlciwgTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlv\nblR5cGUuVE9QSUMsCiAgICAgICAgICAgIHRvcGljU3Vic2NyaWJlci5nZXRU\nb3BpYygpLmdldFRvcGljTmFtZSgpLCBzZXNzaW9uRmFjYWRlLmdldFN1YnNj\ncmliZXJJZCh0b3BpY1N1YnNjcmliZXIpKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCByZWdpc3RlclF1ZXVlU3Vic2NyaWJlcihRdWV1ZVJlY2VpdmVyIHF1\nZXVlUmVjZWl2ZXIpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIHJl\nZ2lzdGVyU3Vic2NyaWJlcihxdWV1ZVJlY2VpdmVyLCBNZXNzYWdpbmdTZXNz\naW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlwZS5RVUVVRSwKICAgICAgICAgICAg\ncXVldWVSZWNlaXZlci5nZXRRdWV1ZSgpLmdldFF1ZXVlTmFtZSgpLCBzZXNz\naW9uRmFjYWRlLmdldFN1YnNjcmliZXJJZChxdWV1ZVJlY2VpdmVyKSk7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlZ2lzdGVyU3Vic2NyaWJlcihNZXNz\nYWdlQ29uc3VtZXIgc3Vic2NyaWJlciwgTWVzc2FnaW5nU2Vzc2lvbkZhY2Fk\nZS5EZXN0aW5hdGlvblR5cGUgdHlwZSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBmaW5hbCBTdHJpbmcgZGVzdGluYXRpb24sIGZpbmFs\nIFN0cmluZyBzdWJzY3JpYmVySWQpIHRocm93cyBKTVNFeGNlcHRpb24gewoK\nICAgICAgICBhc3NlcnQgTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5h\ndGlvblR5cGUuUVVFVUUgPT0gdHlwZSB8fAogICAgICAgICAgICBNZXNzYWdp\nbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlwZS5UT1BJQyA9PSB0eXBl\nOwoKICAgICAgICBib29sZWFuIG5lZWRTdWJzY3JpcHRpb24gPSBmYWxzZTsK\nICAgICAgICBib29sZWFuIG5lZWREZWxpdmVyeSA9IGZhbHNlOwogICAgICAg\nIGlmIChsb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJS\nZWdpc3RlcmluZyAuLi4gIiArIHN1YnNjcmliZXIgKyAiIGZvciAiICsgZGVz\ndGluYXRpb24gKwogICAgICAgICAgICAiLCBzaWQgIiArIHN1YnNjcmliZXJJ\nZCk7CgogICAgICAgIHN5bmNocm9uaXplZCAobG9ja09iamVjdCl7CiAgICAg\nICAgICAgIGlmIChzZXNzaW9uU3RhdGUuaXNJbkNsb3NlTW9kZSgpKSB0aHJv\ndyBuZXcgSk1TRXhjZXB0aW9uKCJBbHJlYWR5IGNsb3NlZCIpOwoKICAgICAg\nICAgICAgLy8gYWxyZWFkeSBzdWJzY3JpYmVkLgogICAgICAgICAgICBpZiAo\nISBzdWJzY3JpcHRpb25zLmFkZFRvU3Vic2NyaWJlclNldChzdWJzY3JpYmVy\nKSkgcmV0dXJuIDsKCiAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb25zLmFk\nZFRvU3Vic2NyaWJlcnMoc3Vic2NyaWJlciwgdHlwZSwgZGVzdGluYXRpb24s\nIHN1YnNjcmliZXJJZCkpIHsKICAgICAgICAgICAgICAgIC8vIG5lZWRTdWJz\nY3JpcHRpb24gPSBzZXNzaW9uU3RhdGUuaXNTdGFydGVkKCk7CiAgICAgICAg\nICAgICAgICBuZWVkU3Vic2NyaXB0aW9uID0gISBzZXNzaW9uU3RhdGUuaXNJ\nbkNsb3NlTW9kZSgpOwogICAgICAgICAgICAgICAgbmVlZERlbGl2ZXJ5ID0g\nc2Vzc2lvblN0YXRlLmlzU3RhcnRlZCgpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICAvLyBUT0RPOiBUaGVyZSBpcyBhIHBvdGVudGlhbCBy\nYWNlIGhlcmUgYmV0d2VlbiByZWdpc3RlcmluZy9zdGFydGluZyBzdWJzY3Jp\ncHRpb24gYW5kCiAgICAgICAgLy8gc3RvcHBpbmcvY2xvc2luZyBzdWJzY3Jp\ncHRpb24ocykgZWxzZXdoZXJlLgogICAgICAgIC8vIFdlIHNob3VsZCByZXNv\nbHZlIGl0IGJ5IHRha2luZyBhIHBlciBMaXN0IGxvY2sgKHdoaWNoIGlzIGdh\ndXJhbnRlZWQgdG8gYmUgbm9uLW51bGwgaGVyZSkKICAgICAgICAvLyBhbmQg\nYSBwZXIgTGlzdCBzdWJzY3JpcHRpb24gc3RhdHVzLgogICAgICAgIC8vIEZv\nciBub3csIE5PVCBoYW5kbGluZyBjcmF6eSBlZGdlLWNhc2VzIGxpa2UgdGhp\ncyAtIHVuZGVyIG1vc3QgY2lyY3Vtc2FuY2VzLCB0aGlzIHdpbGwKICAgICAg\nICAvLyBmYWlsIGZvciBvdGhlciByZWFzb25zIGFueXdheSAhCgogICAgICAg\nIC8vIFNlc3Npb24gbXVzdCBiZSB1c2VkIGJ5IGNsaWVudHMgb25seSBpbiBh\nIHRocmVhZCBzYWZlIG1hbm5lciwgc2luY2UgaXQgaXMgb2sgdG8gZG8gdGhp\ncwogICAgICAgIC8vIG91dHNpZGUgdGhlIGxvY2suCiAgICAgICAgaWYgKG5l\nZWRTdWJzY3JpcHRpb24pewogICAgICAgICAgICBpZiAobG9nZ2VyLmlzVHJh\nY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgiU3Vic2NyaWJpbmcgLi4uICIg\nKyBzdWJzY3JpYmVyICsgIiBmb3IgIiArCiAgICAgICAgICAgICAgICBkZXN0\naW5hdGlvbiArICIsIHNpZCAiICsgc3Vic2NyaWJlcklkKTsKCiAgICAgICAg\nICAgIGlmIChNZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlw\nZS5UT1BJQyA9PSB0eXBlKXsKICAgICAgICAgICAgICAgIC8vIE9ubHkgZm9y\nIHRvcGljJ3MsIHJpZ2h0ID8KICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgc2Vzc2lvbkZhY2FkZS5zdWJzY3JpYmVUb1RvcGlj\nKGRlc3RpbmF0aW9uLCBzdWJzY3JpYmVySWQpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoSk1TRXhjZXB0aW9uIGUpewogICAgICAgICAgICAgICAgICAg\nIC8vIEl0IG1pZ2h0IGJlIHBvc3NpYmxlIGZvciB0aGlzIHRvIGZhaWwgLi4u\nCiAgICAgICAgICAgICAgICAgICAgLy8gTG9nIGFuZCBpZ25vcmUKICAgICAg\nICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJFcnJvciBz\ndWJzY3JpYmluZyBmcm9tIHRvcGljIGZvciBlbnRyeSA6ICIgKyBzdWJzY3Jp\nYmVySWQpOwogICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Z1V0aWwuZHVt\ncEpNU1N0YWNrdHJhY2UobG9nZ2VyLCBlKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dnZXIudHJhY2Uo\nIlN1YnNjcmliaW5nIC4uLiAiICsgc3Vic2NyaWJlciArICIgZm9yICIgKwog\nICAgICAgICAgICAgICAgZGVzdGluYXRpb24gKyAiLCBzaWQgIiArIHN1YnNj\ncmliZXJJZCArICIgRE9ORSIpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG5l\nZWREZWxpdmVyeSkgewogICAgICAgICAgICBpZiAoTWVzc2FnaW5nU2Vzc2lv\nbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUuVE9QSUMgPT0gdHlwZSl7CiAgICAg\nICAgICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dl\nci50cmFjZSgiVG9waWMgZGVsaXZlcnkgLi4uICIgKyBzdWJzY3JpYmVyICsg\nIiBmb3IgIiArCiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb24gKyAi\nLCBzaWQgIiArIHN1YnNjcmliZXJJZCk7CiAgICAgICAgICAgICAgICBzZXNz\naW9uRmFjYWRlLnN0YXJ0VG9waWNEZWxpdmVyeShkZXN0aW5hdGlvbiwgc3Vi\nc2NyaWJlcklkKTsKICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNUcmFj\nZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJUb3BpYyBkZWxpdmVyeSAuLi4g\nIiArIHN1YnNjcmliZXIgKyAiIGZvciAiICsKICAgICAgICAgICAgICAgICAg\nICBkZXN0aW5hdGlvbiArICIsIHNpZCAiICsgc3Vic2NyaWJlcklkICsgIiBE\nT05FIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dl\nci50cmFjZSgiUXVldWUgZGVsaXZlcnkgLi4uICIgKyBzdWJzY3JpYmVyICsg\nIiBmb3IgIiArCiAgICAgICAgICAgICAgICAgICAgZGVzdGluYXRpb24gKyAi\nLCBzaWQgIiArIHN1YnNjcmliZXJJZCk7CiAgICAgICAgICAgICAgICBzZXNz\naW9uRmFjYWRlLnN0YXJ0UXVldWVEZWxpdmVyeShkZXN0aW5hdGlvbiwgc3Vi\nc2NyaWJlcklkKTsKICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNUcmFj\nZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJRdWV1ZSBkZWxpdmVyeSAuLi4g\nIiArIHN1YnNjcmliZXIgKyAiIGZvciAiICsKICAgICAgICAgICAgICAgICAg\nICBkZXN0aW5hdGlvbiArICIsIHNpZCAiICsgc3Vic2NyaWJlcklkICsgIiBE\nT05FIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChs\nb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJyZWdpc3Rl\nclN1YnNjcmliZXIgLi4uICIgKyBtZXNzYWdlTGlzdGVuZXJUaHJlYWRTdGFy\ndGVkKTsKICAgICAgICBpZiAoISBtZXNzYWdlTGlzdGVuZXJUaHJlYWRTdGFy\ndGVkKXsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHRoaXMu\nbWVzc2FnZUxpc3RlbmVyVGhyZWFkLnN0YXJ0KCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKElsbGVnYWxUaHJlYWRTdGF0ZUV4Y2VwdGlvbiAgaXRzZSl7CiAg\nICAgICAgICAgICAgICAvLyBpZ25vcmUKICAgICAgICAgICAgICAgIC8vIFRo\naXMgc2hvdWxkIG5vdCBoYXBwZW4sIGl0IHdpbGwgaGFwcGVuIHdoZW4gU2Vz\nc2lvbiBpcyB1c2VkIGluIGFuIE1ULXVuc2FmZSBtYW5uZXIsCiAgICAgICAg\nICAgICAgICAvLyBjb250cmFyeSB0byB3aGF0IGlzIGV4cGVjdGVkIGZyb20g\nSk1TLgogICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxl\nZCgpKSBsb2dnZXIuZGVidWcoIlVuZXhwZWN0ZWQiLCBpdHNlKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBtZXNzYWdlTGlzdGVuZXJUaHJlYWRTdGFy\ndGVkID0gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgaWYgKGxvZ2dlci5pc1Ry\nYWNlRW5hYmxlZCgpKSBsb2dnZXIudHJhY2UoInJlZ2lzdGVyU3Vic2NyaWJl\nciAuLi4gRE9ORSIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVucmVnaXN0\nZXJUb3BpY1N1YnNjcmliZXIoVG9waWNTdWJzY3JpYmVyIHRvcGljU3Vic2Ny\naWJlcikgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgdW5yZWdpc3Rl\nclN1YnNjcmliZXIodG9waWNTdWJzY3JpYmVyLCBNZXNzYWdpbmdTZXNzaW9u\nRmFjYWRlLkRlc3RpbmF0aW9uVHlwZS5UT1BJQywKICAgICAgICAgICAgdG9w\naWNTdWJzY3JpYmVyLmdldFRvcGljKCkuZ2V0VG9waWNOYW1lKCksIHNlc3Np\nb25GYWNhZGUuZ2V0U3Vic2NyaWJlcklkKHRvcGljU3Vic2NyaWJlcikpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHVucmVnaXN0ZXJRdWV1ZVJlY2VpdmVy\nKFF1ZXVlUmVjZWl2ZXIgcXVldWVSZWNlaXZlcikgdGhyb3dzIEpNU0V4Y2Vw\ndGlvbiB7CiAgICAgICAgdW5yZWdpc3RlclN1YnNjcmliZXIocXVldWVSZWNl\naXZlciwgTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUu\nUVVFVUUsCiAgICAgICAgICAgIHF1ZXVlUmVjZWl2ZXIuZ2V0UXVldWUoKS5n\nZXRRdWV1ZU5hbWUoKSwgc2Vzc2lvbkZhY2FkZS5nZXRTdWJzY3JpYmVySWQo\ncXVldWVSZWNlaXZlcikpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB1bnJl\nZ2lzdGVyU3Vic2NyaWJlcihNZXNzYWdlQ29uc3VtZXIgc3Vic2NyaWJlciwg\nTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUgdHlwZSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBT\ndHJpbmcgZGVzdGluYXRpb24sIGZpbmFsIFN0cmluZyBzdWJzY3JpYmVySWQp\nIHRocm93cyBKTVNFeGNlcHRpb24gewoKICAgICAgICBhc3NlcnQgTWVzc2Fn\naW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUuUVVFVUUgPT0gdHlw\nZSB8fAogICAgICAgICAgICBNZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3Rp\nbmF0aW9uVHlwZS5UT1BJQyA9PSB0eXBlOwogICAgICAgIGZpbmFsIGJvb2xl\nYW4gc3RvcERlbGl2ZXJ5OwoKICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2tP\nYmplY3QpewogICAgICAgICAgICAvLyBpZiBpbiBjbG9zaW5nLCBjb250aW51\nZSBvbiBhbnl3YXkgLi4uCiAgICAgICAgICAgIGlmIChpc0Nsb3NlZCgpKSBy\nZXR1cm4gOwoKICAgICAgICAgICAgc3RvcERlbGl2ZXJ5ID0gc3Vic2NyaXB0\naW9ucy5yZW1vdmVTdWJzY3JpYmVyKHN1YnNjcmliZXIsIHR5cGUsIGRlc3Rp\nbmF0aW9uLCBzdWJzY3JpYmVySWQpOwogICAgICAgICAgICBpZiAoc3RvcERl\nbGl2ZXJ5KSB7CiAgICAgICAgICAgICAgICBpZiAoISBzdWJzY3JpcHRpb25z\nLmdldEFsbENvbnN1bWVyc1NldCgpLnJlbW92ZShzdWJzY3JpYmVyKSkgcmV0\ndXJuIDsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gU2Vz\nc2lvbiBpcyBleHBlY3RlZCB0byBiZSB1c2VkIGluIGEgTVQgc2FmZSBtYW5u\nZXIsIHNpbmNlIGl0IGlzIE1ULXVuc2FmZS4KICAgICAgICBpZiAoc3RvcERl\nbGl2ZXJ5KXsKICAgICAgICAgICAgaWYgKE1lc3NhZ2luZ1Nlc3Npb25GYWNh\nZGUuRGVzdGluYXRpb25UeXBlLlRPUElDID09IHR5cGUpewogICAgICAgICAg\nICAgICAgc3RvcFRvcGljRGVsaXZlcnkoZGVzdGluYXRpb24sIHN1YnNjcmli\nZXJJZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAg\nICAgICAgICAgICBzdG9wUXVldWVEZWxpdmVyeShkZXN0aW5hdGlvbiwgc3Vi\nc2NyaWJlcklkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBoYW5kbGVBdXRvbWF0aWNNZXNzYWdlQWNrbm93bGVk\nZ2VtZW50KFJlY2VpdmVkTWVzc2FnZSByZWNlaXZlZE1lc3NhZ2UsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIE1lc3NhZ2VMaXN0ZW5lciBzZXNzaW9uTWVzc2FnZUxpc3RlbmVyKSB7\nCiAgICAgICAgZG9IYW5kbGVBdXRvbWF0aWNNZXNzYWdlQWNrbm93bGVkZ2Vt\nZW50KG5ldyBUcmFuc2FjdGVkUmVjZWl2ZU9wZXJhdGlvbihyZWNlaXZlZE1l\nc3NhZ2UsCiAgICAgICAgICAgIHNlc3Npb25NZXNzYWdlTGlzdGVuZXIpKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBoYW5kbGVBdXRvbWF0aWNNZXNzYWdl\nQWNrbm93bGVkZ2VtZW50KFJlY2VpdmVkTWVzc2FnZSByZWNlaXZlZE1lc3Nh\nZ2UsIE1lc3NhZ2VDb25zdW1lciBzdWJzY3JpYmVyKSB7CiAgICAgICAgZG9I\nYW5kbGVBdXRvbWF0aWNNZXNzYWdlQWNrbm93bGVkZ2VtZW50KG5ldyBUcmFu\nc2FjdGVkUmVjZWl2ZU9wZXJhdGlvbihyZWNlaXZlZE1lc3NhZ2UsIHN1YnNj\ncmliZXIpKTsKICAgIH0KCiAgICAvLyBUaGlzIGlzIGEgcHJvdmlkZXIgaW50\nZXJuYWwgbWV0aG9kLgogICAgcHJpdmF0ZSB2b2lkIGRvSGFuZGxlQXV0b21h\ndGljTWVzc2FnZUFja25vd2xlZGdlbWVudChUcmFuc2FjdGVkUmVjZWl2ZU9w\nZXJhdGlvbiByZWNlaXZlT3BlcmF0aW9uKSB7CiAgICAgICAgaWYgKGlzQ2xv\nc2VkKCkpIHJldHVybiA7CiAgICAgICAgLy8gSWYgaW4gdHJhbnNhY3Rpb24s\nIGlnbm9yZS4KICAgICAgICBpZiAodHJhbnNhY3RlZCkgewogICAgICAgICAg\nICBlbnF1ZXVlUmVjZWl2ZVdpdGhpblRyYW5zYWN0aW9uKHJlY2VpdmVPcGVy\nYXRpb24pOwogICAgICAgICAgICByZXR1cm4gOwogICAgICAgIH0KCiAgICAg\nICAgaWYgKFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSA9PSBnZXRBY2tub3ds\nZWRnZU1vZGUoKSB8fAogICAgICAgICAgICBTZXNzaW9uLkRVUFNfT0tfQUNL\nTk9XTEVER0UgPT0gZ2V0QWNrbm93bGVkZ2VNb2RlKCkpewogICAgICAgICAg\nICAvLyBJZ25vcmUgKGFueSkgZXhjZXB0aW9ucyB3aGljaCBtaWdodCBiZSB0\naHJvd24gLi4uCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBp\nZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgiYWNr\nbm93bGVkZ2luZyAuLi4gIiArIHJlY2VpdmVPcGVyYXRpb24pOwogICAgICAg\nICAgICAgICAgcmVjZWl2ZU9wZXJhdGlvbi5yZWNlaXZlZE1lc3NhZ2Uub3Jp\nZ2luYWxNZXNzYWdlLmdldEFja1J1bm5hYmxlKCkucnVuKCk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCl7CiAgICAgICAgICAgICAgICBp\nZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZGVidWcoIklnbm9yaW5nIGV4Y2VwdGlvbiB3aGlsZSBz\nZW5kaW5nIGFjayAuLi4gIiwgZXgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICBwdWJsaWMgdm9pZCB1\nbnN1YnNjcmliZUZyb21Ub3BpYyhTdHJpbmcgdG9waWNOYW1lLCBTdHJpbmcg\nc3Vic2NyaWJlZElkKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBz\nZXNzaW9uRmFjYWRlLnVuc3Vic2NyaWJlRnJvbVRvcGljKHRvcGljTmFtZSwg\nc3Vic2NyaWJlZElkKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9wVG9w\naWNEZWxpdmVyeShTdHJpbmcgdG9waWNOYW1lLCBTdHJpbmcgc3Vic2NyaWJl\nZElkKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBzZXNzaW9uRmFj\nYWRlLnN0b3BUb3BpY0RlbGl2ZXJ5KHRvcGljTmFtZSwgc3Vic2NyaWJlZElk\nKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdG9wUXVldWVEZWxpdmVyeShT\ndHJpbmcgcXVldWVOYW1lLCBTdHJpbmcgc3Vic2NyaWJlZElkKSB0aHJvd3Mg\nSk1TRXhjZXB0aW9uIHsKICAgICAgICBzZXNzaW9uRmFjYWRlLnN0b3BRdWV1\nZURlbGl2ZXJ5KHF1ZXVlTmFtZSwgc3Vic2NyaWJlZElkKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBtZXNzYWdlUmVjZWl2ZWQoZmluYWwgTWVzc2FnZUlt\ncGwgbXNnLCBNZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlw\nZSB0eXBlKQogICAgICAgIHRocm93cyBKTVNFeGNlcHRpb24gewoKICAgICAg\nICBTdHJpbmcgdHJhY2VNc2cgPSBudWxsOwogICAgICAgIFJlY2VpdmVkTWVz\nc2FnZSByZWNlaXZlZE1lc3NhZ2UgPSBuZXcgUmVjZWl2ZWRNZXNzYWdlKG1z\nZywgbXNnLCB0eXBlKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2tPYmpl\nY3QpewogICAgICAgICAgICAvLyBpZ25vcmUgaWYgY2xvc2VkIC4uLiBjb250\naW51ZSBvbiBpZiBpbiBjbG9zaW5nIHN0YXRlLgogICAgICAgICAgICBpZiAo\naXNDbG9zZWQoKSkgcmV0dXJuIDsKICAgICAgICAgICAgbWVzc2FnZUxpc3Qu\nYWRkKHJlY2VpdmVkTWVzc2FnZSk7CgogICAgICAgICAgICBpZiAoIWdldFRy\nYW5zYWN0ZWQoKSAmJiBDTElFTlRfQUNLTk9XTEVER0UgPT0gZ2V0QWNrbm93\nbGVkZ2VNb2RlKCkpIHsKICAgICAgICAgICAgICAgIHNlc3Npb25GYWNhZGUu\ncmVnaXN0ZXJVbkFja25vd2xlZGdlZE1lc3NhZ2UocmVjZWl2ZWRNZXNzYWdl\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9ja09iamVjdC5ub3Rp\nZnlBbGwoKTsKICAgICAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxl\nZCgpKSB0cmFjZU1zZyA9ICJtZXNzYWdlUmVjZWl2ZWQgZnJvbSAiICsgbXNn\nLmdldFNvdXJjZU5hbWUoKSArCiAgICAgICAgICAgICAgICAiLCBmb3IgIiAr\nIG1zZy5nZXRTdWJzY3JpYmVySWQoKSArICIgPSAiICsgbXNnOwogICAgICAg\nIH0KCiAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dn\nZXIudHJhY2UodHJhY2VNc2cpOwogICAgfQoKICAgIC8vIEEgc2ltcGxlIGlt\nbXV0YWJsZSBkYXRhc3RydWN0dXJlIHRvIGhvbGQgZGV0YWlscyBhYm91dCBh\nIG1lc3NhZ2Ugd2hpY2ggaGFzIGJlZW4gcmVjaWV2ZWQuCiAgICBwdWJsaWMg\nc3RhdGljIGNsYXNzIFJlY2VpdmVkTWVzc2FnZSB7CiAgICAgICAgLy8gRW5z\ndXJlIHRoYXQgdGhlIG9yaWdpbmFsIG1lc3NhZ2UgaXMgTk9UIG1vZGlmaWVk\nIGluIGFueSB3YXkgIQogICAgICAgIHB1YmxpYyBmaW5hbCBNZXNzYWdlSW1w\nbCBvcmlnaW5hbE1lc3NhZ2U7CiAgICAgICAgLy8gVGhpcyBpcyB0aGUgbWVz\nc2FnZSByZXR1cm5lZCB0byB0aGUgY2xpZW50IDogdG8gdGhlIGxpc3RlbmVy\nIGFuZC9vciBpbiB0aGUgVG9waWNTdWJzY3JpYmVySW1wbCAtCiAgICAgICAg\nLy8gY3JlYXRlZCBhcyBhCiAgICAgICAgLy8gY2xvbmUgb2YgdGhlIG9yaWdp\nbmFsTWVzc2FnZS4KICAgICAgICBwdWJsaWMgZmluYWwgTWVzc2FnZUltcGwg\nbXNnOwoKICAgICAgICBwdWJsaWMgZmluYWwgTWVzc2FnaW5nU2Vzc2lvbkZh\nY2FkZS5EZXN0aW5hdGlvblR5cGUgZGVzdGluYXRpb25UeXBlOwoKICAgICAg\nICBwcml2YXRlIFJlY2VpdmVkTWVzc2FnZShNZXNzYWdlSW1wbCBvcmlnaW5h\nbE1lc3NhZ2UsIE1lc3NhZ2VJbXBsIG1zZywKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBNZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0\naW9uVHlwZSBkZXN0aW5hdGlvblR5cGUpIHsKICAgICAgICAgICAgdGhpcy5v\ncmlnaW5hbE1lc3NhZ2UgPSBvcmlnaW5hbE1lc3NhZ2U7CiAgICAgICAgICAg\nIHRoaXMubXNnID0gbXNnOwogICAgICAgICAgICB0aGlzLmRlc3RpbmF0aW9u\nVHlwZSA9IGRlc3RpbmF0aW9uVHlwZTsKICAgICAgICB9CgogICAgICAgIEBP\ndmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAg\nICAgICAgICAgIGZpbmFsIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5n\nQnVpbGRlcigpOwogICAgICAgICAgICBzYi5hcHBlbmQoIlJlY2VpdmVkTWVz\nc2FnZSIpOwogICAgICAgICAgICBzYi5hcHBlbmQoIntvcmlnaW5hbE1lc3Nh\nZ2U9IikuYXBwZW5kKG9yaWdpbmFsTWVzc2FnZSk7CiAgICAgICAgICAgIHNi\nLmFwcGVuZCgiLCBtc2c9IikuYXBwZW5kKG1zZyk7CiAgICAgICAgICAgIHNi\nLmFwcGVuZCgiLCBkZXN0aW5hdGlvblR5cGU9IikuYXBwZW5kKGRlc3RpbmF0\naW9uVHlwZSk7CiAgICAgICAgICAgIHNiLmFwcGVuZCgnfScpOwogICAgICAg\nICAgICByZXR1cm4gc2IudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLy8gcmVxdWlyZWQgdG8gY2F0Y2ggcmVzb3VyY2UgbGVha3MgLi4uCiAg\nICBAT3ZlcnJpZGUKICAgIHByb3RlY3RlZCB2b2lkIGZpbmFsaXplKCkgdGhy\nb3dzIFRocm93YWJsZSB7CiAgICAgICAgc3VwZXIuZmluYWxpemUoKTsKICAg\nICAgICBpZiAoIXNlc3Npb25TdGF0ZS5pc0luQ2xvc2VNb2RlKCkpIHsKICAg\nICAgICAgICAgaWYgKGxvZ2dlci5pc0Vycm9yRW5hYmxlZCgpKSBsb2dnZXIu\nZXJyb3IoIlNlc3Npb24gd2FzIE5PVCBjbG9zZWQgYmVmb3JlIGl0IHdlbnQg\nb3V0IG9mIHNjb3BlIik7CiAgICAgICAgICAgIGNsb3NlKCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzQ2xvc2VkKCkgewogICAg\nICAgIHJldHVybiBzZXNzaW9uU3RhdGUuaXNDbG9zZWQoKTsKICAgIH0KCgog\nICAgLy8gVE9ETzogSW50cm9kdWNlIGEgZGFlbW9uIHRocmVhZCB3aGljaCBw\nZXJpb2RpY2FsbHkgdXBkYXRlcyB0aGlzIC0gZWFjaCBjYWxsIHRvCiAgICAv\nLyBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMgaXMgYSBuYXRpdmUgY2FsbAog\nICAgLy8gQW5kIGNhbiBiZSB2ZXJ5IGV4cGVuc2l2ZSBpZiB0aGVyZSBhcmUg\nYSBsb3Qgb2YgY29uY3VycmVudCBpbnZvY2F0aW9ucyB0byBpdCA6IGxlYXJu\naW5ncwogICAgLy8gZnJvbSBYTVBQIHNlcnZlciBjaXJjYSAyMDA2ICEKICAg\nIHB1YmxpYyBzdGF0aWMgbG9uZyBjdXJyZW50VGltZU1pbGxpcygpIHsKICAg\nICAgICByZXR1cm4gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICB9\nCgogICAgcHVibGljIFN1YnNjcmlwdGlvbiBjcmVhdGVTdWJzY3JpcHRpb24o\nTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUgdHlwZSwg\nU3RyaW5nIG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBTdHJpbmcgc3Vic2NyaWJlcklkKXsKICAgICAgICBzd2l0\nY2godHlwZSl7CiAgICAgICAgICBjYXNlIFFVRVVFOgogICAgICAgICAgICAg\nIHJldHVybiBuZXcgUXVldWVTdWJzY3JpcHRpb24obmFtZSwgc3Vic2NyaWJl\ncklkKTsKICAgICAgICAgIGNhc2UgVE9QSUM6CiAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBUb3BpY1N1YnNjcmlwdGlvbihuYW1lLCBzdWJzY3JpYmVySWQp\nOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJVbmtub3duIGRlc3RpbmF0aW9u\nIHR5cGUgIiArIHR5cGUgKwogICAgICAgICAgICAgICAgICAiIGZvciBkZXN0\naW5hdGlvbiAiICsgbmFtZSArICIsIHN1YnNjcmliZXJJZCAiICsgc3Vic2Ny\naWJlcklkKTsKICAgICAgICB9CiAgICB9CiAgICBwdWJsaWMgaW50ZXJmYWNl\nIFN1YnNjcmlwdGlvbiB7CiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNUb3Bp\nYygpOwogICAgICAgIHB1YmxpYyBib29sZWFuIGlzUXVldWUoKTsKICAgIH0K\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFRvcGljU3Vic2NyaXB0\naW9uIGltcGxlbWVudHMgU3Vic2NyaXB0aW9uIHsKICAgICAgICBwdWJsaWMg\nZmluYWwgU3RyaW5nIHRvcGljTmFtZTsKICAgICAgICBwdWJsaWMgZmluYWwg\nU3RyaW5nIHN1YnNjcmliZXJJZDsKCiAgICAgICAgcHVibGljIFRvcGljU3Vi\nc2NyaXB0aW9uKFN0cmluZyB0b3BpY05hbWUsIFN0cmluZyBzdWJzY3JpYmVy\nSWQpIHsKICAgICAgICAgICAgaWYgKG51bGwgPT0gdG9waWNOYW1lIHx8IG51\nbGwgPT0gc3Vic2NyaWJlcklkKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oIlVuZXhwZWN0ZWQgbnVsbCBhcyBw\nYXJhbWV0ZXIgdG9waWNOYW1lOiAiICsKICAgICAgICAgICAgICAgICAgICB0\nb3BpY05hbWUgKyAiLCBzdWJzY3JpYmVySWQ6ICIgKyBzdWJzY3JpYmVySWQp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudG9waWNOYW1lID0g\ndG9waWNOYW1lOwogICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJJZCA9IHN1\nYnNjcmliZXJJZDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFu\nIGlzVG9waWMoKSB7IHJldHVybiB0cnVlOyB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGlzUXVldWUoKSB7IHJldHVybiBmYWxzZTsgfQoKICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0\nIG8pIHsKICAgICAgICAgICAgaWYgKHRoaXMgPT0gbykgcmV0dXJuIHRydWU7\nCiAgICAgICAgICAgIGlmIChvID09IG51bGwgfHwgZ2V0Q2xhc3MoKSAhPSBv\nLmdldENsYXNzKCkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIFRvcGlj\nU3Vic2NyaXB0aW9uIHRoYXQgPSAoVG9waWNTdWJzY3JpcHRpb24pIG87Cgog\nICAgICAgICAgICBpZiAoIXN1YnNjcmliZXJJZC5lcXVhbHModGhhdC5zdWJz\nY3JpYmVySWQpKSByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIGlmICghdG9w\naWNOYW1lLmVxdWFscyh0aGF0LnRvcGljTmFtZSkpIHJldHVybiBmYWxzZTsK\nCiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBoYXNoQ29kZSgpIHsKICAg\nICAgICAgICAgaW50IHJlc3VsdCA9IHRvcGljTmFtZS5oYXNoQ29kZSgpOwog\nICAgICAgICAgICByZXN1bHQgPSAzMSAqIHJlc3VsdCArIHN1YnNjcmliZXJJ\nZC5oYXNoQ29kZSgpOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmlu\nZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgZmluYWwgU3RyaW5nQnVpbGRl\nciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgIHNiLmFw\ncGVuZCgiVG9waWNTdWJzY3JpcHRpb24iKTsKICAgICAgICAgICAgc2IuYXBw\nZW5kKCJ7dG9waWNOYW1lPSciKS5hcHBlbmQodG9waWNOYW1lKS5hcHBlbmQo\nJ1wnJyk7CiAgICAgICAgICAgIHNiLmFwcGVuZCgiLCBzdWJzY3JpYmVySWQ9\nJyIpLmFwcGVuZChzdWJzY3JpYmVySWQpLmFwcGVuZCgnXCcnKTsKICAgICAg\nICAgICAgc2IuYXBwZW5kKCd9Jyk7CiAgICAgICAgICAgIHJldHVybiBzYi50\nb1N0cmluZygpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGNsYXNzIFF1ZXVlU3Vic2NyaXB0aW9uIGltcGxlbWVudHMgU3Vi\nc2NyaXB0aW9uIHsKICAgICAgICBwdWJsaWMgZmluYWwgU3RyaW5nIHF1ZXVl\nTmFtZTsKICAgICAgICBwdWJsaWMgZmluYWwgU3RyaW5nIHN1YnNjcmliZXJJ\nZDsKCiAgICAgICAgcHVibGljIFF1ZXVlU3Vic2NyaXB0aW9uKFN0cmluZyBx\ndWV1ZU5hbWUsIFN0cmluZyBzdWJzY3JpYmVySWQpIHsKICAgICAgICAgICAg\naWYgKG51bGwgPT0gcXVldWVOYW1lIHx8IG51bGwgPT0gc3Vic2NyaWJlcklk\nKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNl\ncHRpb24oIlVuZXhwZWN0ZWQgbnVsbCBhcyBwYXJhbWV0ZXIgcXVldWVOYW1l\nOiAiICsKICAgICAgICAgICAgICAgICAgICBxdWV1ZU5hbWUgKyAiLCBzdWJz\nY3JpYmVySWQ6ICIgKyBzdWJzY3JpYmVySWQpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHRoaXMucXVldWVOYW1lID0gcXVldWVOYW1lOwogICAgICAg\nICAgICB0aGlzLnN1YnNjcmliZXJJZCA9IHN1YnNjcmliZXJJZDsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIGlzVG9waWMoKSB7IHJldHVy\nbiBmYWxzZTsgfQoKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1F1ZXVlKCkg\neyByZXR1cm4gdHJ1ZTsgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAgICAg\naWYgKHRoaXMgPT0gbykgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChv\nID09IG51bGwgfHwgZ2V0Q2xhc3MoKSAhPSBvLmdldENsYXNzKCkpIHJldHVy\nbiBmYWxzZTsKCiAgICAgICAgICAgIFF1ZXVlU3Vic2NyaXB0aW9uIHRoYXQg\nPSAoUXVldWVTdWJzY3JpcHRpb24pIG87CgogICAgICAgICAgICBpZiAoIXN1\nYnNjcmliZXJJZC5lcXVhbHModGhhdC5zdWJzY3JpYmVySWQpKSByZXR1cm4g\nZmFsc2U7CiAgICAgICAgICAgIGlmICghcXVldWVOYW1lLmVxdWFscyh0aGF0\nLnF1ZXVlTmFtZSkpIHJldHVybiBmYWxzZTsKCiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIGludCBoYXNoQ29kZSgpIHsKICAgICAgICAgICAgaW50IHJlc3Vs\ndCA9IHF1ZXVlTmFtZS5oYXNoQ29kZSgpOwogICAgICAgICAgICByZXN1bHQg\nPSAzMSAqIHJlc3VsdCArIHN1YnNjcmliZXJJZC5oYXNoQ29kZSgpOwogICAg\nICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgZmluYWwgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdC\ndWlsZGVyKCk7CiAgICAgICAgICAgIHNiLmFwcGVuZCgiUXVldWVTdWJzY3Jp\ncHRpb24iKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCJ7cXVldWVOYW1lPSci\nKS5hcHBlbmQocXVldWVOYW1lKS5hcHBlbmQoJ1wnJyk7CiAgICAgICAgICAg\nIHNiLmFwcGVuZCgiLCBzdWJzY3JpYmVySWQ9JyIpLmFwcGVuZChzdWJzY3Jp\nYmVySWQpLmFwcGVuZCgnXCcnKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCd9\nJyk7CiAgICAgICAgICAgIHJldHVybiBzYi50b1N0cmluZygpOwogICAgICAg\nIH0KICAgIH0KCgogICAgcHJpdmF0ZSBzdGF0aWMgaW50ZXJmYWNlIFRyYW5z\nYWN0ZWRPcGVyYXRpb24gewogICAgICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNr\nKCk7CiAgICAgICAgcHVibGljIHZvaWQgY29tbWl0KCkgdGhyb3dzIEpNU0V4\nY2VwdGlvbjsKICAgICAgICBwdWJsaWMgYm9vbGVhbiByZXF1aXJlc1N0YXJ0\nZWRTZXNzaW9uKCk7CiAgICB9CgogICAgcHJpdmF0ZSBjbGFzcyBUcmFuc2Fj\ndGVkU2VuZE9wZXJhdGlvbiBpbXBsZW1lbnRzIFRyYW5zYWN0ZWRPcGVyYXRp\nb24gewogICAgICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIGRlc3RpbmF0aW9u\nOwogICAgICAgIHByaXZhdGUgZmluYWwgTWVzc2FnZUltcGwgbWVzc2FnZUlt\ncGw7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBNZXNzYWdlIHVzZXJNZXNzYWdl\nOwoKICAgICAgICBwcml2YXRlIFRyYW5zYWN0ZWRTZW5kT3BlcmF0aW9uKFN0\ncmluZyBkZXN0aW5hdGlvbiwgTWVzc2FnZUltcGwgbWVzc2FnZUltcGwsIE1l\nc3NhZ2UgdXNlck1lc3NhZ2UpIHsKICAgICAgICAgICAgdGhpcy5kZXN0aW5h\ndGlvbiA9IGRlc3RpbmF0aW9uOwogICAgICAgICAgICB0aGlzLm1lc3NhZ2VJ\nbXBsID0gbWVzc2FnZUltcGw7CiAgICAgICAgICAgIHRoaXMudXNlck1lc3Nh\nZ2UgPSB1c2VyTWVzc2FnZTsKICAgICAgICB9CgoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgdm9pZCBjb21taXQoKSB0aHJvd3MgSk1TRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgU3RyaW5nIG1zZ0lkID0gU2Vzc2lvbklt\ncGwudGhpcy5zZXNzaW9uRmFjYWRlLnB1Ymxpc2goZGVzdGluYXRpb24sIG1l\nc3NhZ2VJbXBsKTsKICAgICAgICAgICAgaWYgKHVzZXJNZXNzYWdlIGluc3Rh\nbmNlb2YgTWVzc2FnZUltcGwpICgoTWVzc2FnZUltcGwpIHVzZXJNZXNzYWdl\nKS5zZXRKTVNNZXNzYWdlSURJbnRlcm5hbChtc2dJZCk7CiAgICAgICAgICAg\nIGVsc2UgdXNlck1lc3NhZ2Uuc2V0Sk1TTWVzc2FnZUlEKG1zZ0lkKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJvbGxiYWNrKCkgewogICAg\nICAgICAgICAvLyBub29wIC4uLgogICAgICAgIH0KCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gcmVxdWlyZXNTdGFydGVkU2Vz\nc2lvbigpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0\ncmluZygpIHsKICAgICAgICAgICAgZmluYWwgU3RyaW5nQnVpbGRlciBzYiA9\nIG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgIHNiLmFwcGVuZCgi\nVHJhbnNhY3RlZFNlbmRPcGVyYXRpb24iKTsKICAgICAgICAgICAgc2IuYXBw\nZW5kKCJ7ZGVzdGluYXRpb249JyIpLmFwcGVuZChkZXN0aW5hdGlvbikuYXBw\nZW5kKCdcJycpOwogICAgICAgICAgICBzYi5hcHBlbmQoIiwgbWVzc2FnZUlt\ncGw9IikuYXBwZW5kKG1lc3NhZ2VJbXBsKTsKICAgICAgICAgICAgc2IuYXBw\nZW5kKCIsIHVzZXJNZXNzYWdlPSIpLmFwcGVuZCh1c2VyTWVzc2FnZSk7CiAg\nICAgICAgICAgIHNiLmFwcGVuZCgnfScpOwogICAgICAgICAgICByZXR1cm4g\nc2IudG9TdHJpbmcoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBj\nbGFzcyBUcmFuc2FjdGVkUmVjZWl2ZU9wZXJhdGlvbiBpbXBsZW1lbnRzIFRy\nYW5zYWN0ZWRPcGVyYXRpb24gewogICAgICAgIHByaXZhdGUgZmluYWwgUmVj\nZWl2ZWRNZXNzYWdlIHJlY2VpdmVkTWVzc2FnZTsKICAgICAgICBwcml2YXRl\nIGZpbmFsIE1lc3NhZ2VMaXN0ZW5lciBzZXNzaW9uTWVzc2FnZUxpc3RlbmVy\nOwogICAgICAgIHByaXZhdGUgZmluYWwgTWVzc2FnZUNvbnN1bWVyIHN1YnNj\ncmliZXI7CgogICAgICAgIHByaXZhdGUgVHJhbnNhY3RlZFJlY2VpdmVPcGVy\nYXRpb24oUmVjZWl2ZWRNZXNzYWdlIHJlY2VpdmVkTWVzc2FnZSwgTWVzc2Fn\nZUxpc3RlbmVyIHNlc3Npb25NZXNzYWdlTGlzdGVuZXIpIHsKICAgICAgICAg\nICAgdGhpcy5yZWNlaXZlZE1lc3NhZ2UgPSByZWNlaXZlZE1lc3NhZ2U7CiAg\nICAgICAgICAgIHRoaXMuc2Vzc2lvbk1lc3NhZ2VMaXN0ZW5lciA9IHNlc3Np\nb25NZXNzYWdlTGlzdGVuZXI7CiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJl\nciA9IG51bGw7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIFRyYW5zYWN0\nZWRSZWNlaXZlT3BlcmF0aW9uKFJlY2VpdmVkTWVzc2FnZSByZWNlaXZlZE1l\nc3NhZ2UsIE1lc3NhZ2VDb25zdW1lciBzdWJzY3JpYmVyKSB7CiAgICAgICAg\nICAgIHRoaXMucmVjZWl2ZWRNZXNzYWdlID0gcmVjZWl2ZWRNZXNzYWdlOwog\nICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSBzdWJzY3JpYmVyOwogICAg\nICAgICAgICB0aGlzLnNlc3Npb25NZXNzYWdlTGlzdGVuZXIgPSBudWxsOwog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJv\nb2xlYW4gcmVxdWlyZXNTdGFydGVkU2Vzc2lvbigpIHsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgdm9pZCByb2xsYmFjaygpIHsKCiAgICAgICAgICAgIC8v\nIGFzeW5jIGRpc3BhdGNoIC4uLgogICAgICAgICAgICBpZiAobnVsbCAhPSBz\nZXNzaW9uTWVzc2FnZUxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBzeW5j\naHJvbml6ZWQgKFNlc3Npb25JbXBsLnRoaXMubG9ja09iamVjdCl7CiAgICAg\nICAgICAgICAgICAgICAgcm9sbGVkYmFja01lc3NhZ2VMaXN0LmFkZCh0aGlz\nKTsKICAgICAgICAgICAgICAgICAgICBTZXNzaW9uSW1wbC50aGlzLmxvY2tP\nYmplY3Qubm90aWZ5QWxsKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgLy8gSWYgcm9sbGJhY2sgaW4gc3luYyBtb2Rl\nLCBkbyBpbiBzYW1lIHRocmVhZCAtIGVsc2UgYSByb2xsYmFjaywgcmVjZWl2\nZSBXSUxMIHNlZSBtZXNzYWdlcwogICAgICAgICAgICAvLyBpbiBkaWZmZXJl\nbnQgb3JkZXIgIQogICAgICAgICAgICAvLyBUaGlzIGlzIGFsc28gcmVxdWly\nZWQgc2luY2UgaW4gYXN5bmMgbW9kZSwgc2Vzc2lvbiBJUyBOT1QgTVQtc2Fm\nZSAtIGFuZCBzbyBpcwogICAgICAgICAgICAvLyBleHBlY3RpbmcgdGhpcyBi\nZWhhdmlvci4KICAgICAgICAgICAgZWxzZSBpZiAobnVsbCAhPSBzdWJzY3Jp\nYmVyKXsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgTWVzc2FnZUltcGwgdGhlTWVzc2FnZSA9IE1lc3NhZ2VVdGlsLmNyZWF0\nZUNsb25lRm9yRGlzcGF0Y2goU2Vzc2lvbkltcGwudGhpcywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkTWVzc2FnZS5vcmlnaW5hbE1l\nc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNlaXZlZE1l\nc3NhZ2Uub3JpZ2luYWxNZXNzYWdlLmdldFNvdXJjZU5hbWUoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkTWVzc2FnZS5vcmlnaW5h\nbE1lc3NhZ2UuZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICAgICAgICAgICAg\nICAgIHRoZU1lc3NhZ2Uuc2V0Sk1TUmVkZWxpdmVyZWQodHJ1ZSk7CgogICAg\nICAgICAgICAgICAgICAgIHNlc3Npb25GYWNhZGUuZW5xdWV1ZVJlY2VpdmVk\nTWVzc2FnZShzdWJzY3JpYmVyLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IFJlY2VpdmVkTWVzc2FnZShyZWNlaXZlZE1lc3NhZ2Uub3JpZ2lu\nYWxNZXNzYWdlLCB0aGVNZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJlY2VpdmVkTWVzc2FnZS5kZXN0aW5hdGlvblR5cGUpLCB0\ncnVlKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEpNU0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1\nZygiVW5hYmxlIHRvIGVucXVldWUgcmVjZWl2ZWQgbWVzc2FnZSB0byIpOwog\nICAgICAgICAgICAgICAgICAgICAgICBEZWJ1Z1V0aWwuZHVtcEpNU1N0YWNr\ndHJhY2UobG9nZ2VyLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAg\nIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIGNvbW1pdCgpIHRocm93\ncyBKTVNFeGNlcHRpb24gewogICAgICAgICAgICB0cnkgewogICAgICAgICAg\nICAgICAgcmVjZWl2ZWRNZXNzYWdlLm9yaWdpbmFsTWVzc2FnZS5nZXRBY2tS\ndW5uYWJsZSgpLnJ1bigpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZXgpewogICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJJ\nZ25vcmluZyBleGNlcHRpb24gd2hpbGUgc2VuZGluZyBhY2sgLi4uICIsIGV4\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0K\nCiAgICAgICAgLyoqCiAgICAgICAgICogUmVjb3ZlcnkgaXMgc2xpZ2h0bHkg\ndHJpY2t5IC0gd2UgaGF2ZSB0d28gY2FzZXMgaGVyZSA6CiAgICAgICAgICog\nYSkgTWVzc2FnZXMgd2hpY2ggdG8gYmUgY29uc3VtZWQgdmlhIHN1YnNjcmli\nZXIgd2hpY2ggc3VwcG9ydCB0aGUgc3luYyBtb2RlIC0gdmlhIHJlY2VpdmUo\nKSwgdmFyaWFudHMuCiAgICAgICAgICogYikgTWVzc2FnZXMgd2hpY2ggYXJl\nIHRvIGJlIGNvbnN1bWVkIHZpYSB0aGUgc3Vic2NyaWJlciBvciBzZXNzaW9u\nJ3MgYXN5bmMgbW9kZSAtIHZpYSBsaXN0ZW5lci4KICAgICAgICAgKgogICAg\nICAgICAqCiAgICAgICAgICogV2UgaGF2ZSB0byBlbnN1cmUgdGhhdCBtZXNz\nYWdlIHJlY292ZXJ5IHdpbGwgcmVzdWx0IGluIHRoZSBleGFjdCBTQU1FIG9y\nZGVyIG9mIG1lc3NhZ2UKICAgICAgICAgKiBkZWxpdmVyeSB0byBjbGllbnQg\nYXMgaXQgd2FzIGRvbmUgZmlyc3QgdGltZQogICAgICAgICAqICh3aGVuIHJv\nbGxiYWNrIHdhcyB0cmlnZ2VyZWQpLgogICAgICAgICAqIFRvIGVuc3VyZSB0\naGlzLCB0aGUgcmVjb3ZlciBtZXRob2QgaXMgY2FsbGVkIGluIFJFVkVSU0Ug\nb3JkZXIgaW4gd2hpY2ggb3BlcmF0aW9ucyB3ZXJlCiAgICAgICAgICogZW5x\ndWV1ZWQgaW4gdGhlIHR4biAobG9nKSBxdWV1ZS4KICAgICAgICAgKgogICAg\nICAgICAqIFRvIGhhbmRsZSAoYSksIHNlc3Npb25GYWNhZGUuZW5xdWV1ZVJl\nY2VpdmVkTWVzc2FnZSBwdXNoZXMgbWVzc2FnZSB0byBiZWdpbmluZyBvZiBw\nZW5kaW5nCiAgICAgICAgICogbWVzc2FnZSBxdWV1ZSBpbiBzdWJzY3JpYmVy\nLgogICAgICAgICAqIFRha2VuIGFsb25nIHdpdGggcmV2ZXJzZSBvcmRlciBv\nZiB1bndpbmRpbmcgb2YgdHhuIGxvZywgdGhpcyBlbnN1cmUgdGhlIGRlc2ly\nZWQgYmVoYXZpb3IgZm9yIChhKS4KICAgICAgICAgKgogICAgICAgICAqIFRv\nIGVuc3VyZSBkZXNpcmVkIGJlaGF2aW9yIGZvciAoYiksIHdlIHBhc3MgYSBs\naXN0ZW5lckRlbGl2ZXJ5TGlzdCBhcyBwYXJhbWV0ZXIgLSB3aGljaCBpcwog\nICAgICAgICAqIHVzZWQgdG8gbWFpbnRhaW4gdGhlCiAgICAgICAgICogb3Jk\nZXIgb2YgaG93IHRvIGludm9rZSBvbk1lc3NhZ2UgdG8gcmVjb3ZlciBmb3Ig\nYXN5bmMgZGlzcGF0Y2guIE5vdGU6IHdlIGtlZXAgYWRkaW5nIHRvCiAgICAg\nICAgICogYmVnaW5pbmcgb2YgdGhpcyBsaXN0IHRvIGVuc3VyZSB0aGF0CiAg\nICAgICAgICogaW4gdGhlIGVuZCwgb2xkZXN0IG1lc3NhZ2UgaW4gdHhuIGxv\nZyBpcyB0aGUgZmlyc3QgbWVzc2FnZSBpbiBsaXN0ZW5lckRlbGl2ZXJ5TGlz\ndCB3aGVuCiAgICAgICAgICogd2UgYXR0ZW1wdCByZWNvdmVyeS4KICAgICAg\nICAgKgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2b2lkIHJlY292ZXIo\nTGlua2VkTGlzdDxUcmFuc2FjdGVkUmVjZWl2ZU9wZXJhdGlvbj4gbGlzdGVu\nZXJEZWxpdmVyeUxpc3QpIHsKICAgICAgICAgICAgLy8gRG8gdGhlIGFjdHVh\nbCByZWNvdmVyeSAuLi4KICAgICAgICAgICAgaWYgKG51bGwgIT0gc3Vic2Ny\naWJlcil7CiAgICAgICAgICAgICAgICAvLyBhbHJlYWR5IGhhbmRsZWQgaW4g\ncm9sbGJhY2sgLi4uCiAgICAgICAgICAgICAgICBhc3NlcnQgZmFsc2UgOiAi\ndW5leHBlY3RlZCAuLi4iOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVs\nc2UgaWYgKG51bGwgIT0gc2Vzc2lvbk1lc3NhZ2VMaXN0ZW5lcil7CiAgICAg\nICAgICAgICAgICBsaXN0ZW5lckRlbGl2ZXJ5TGlzdC5hZGRGaXJzdCh0aGlz\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgcmVjb3ZlckZvckxpc3RlbmVyKCl7CiAgICAgICAgICAgIGFzc2VydCBu\ndWxsID09IHN1YnNjcmliZXI7CiAgICAgICAgICAgIGFzc2VydCBudWxsICE9\nIHNlc3Npb25NZXNzYWdlTGlzdGVuZXI7CgogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgZmluYWwgTWVzc2FnZUltcGwgbWVzc2FnZSA9IE1l\nc3NhZ2VVdGlsLmNyZWF0ZUNsb25lRm9yRGlzcGF0Y2goU2Vzc2lvbkltcGwu\ndGhpcywKICAgICAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWRNZXNzYWdl\nLm9yaWdpbmFsTWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVj\nZWl2ZWRNZXNzYWdlLm9yaWdpbmFsTWVzc2FnZS5nZXRTb3VyY2VOYW1lKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmVkTWVzc2FnZS5vcmln\naW5hbE1lc3NhZ2UuZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICAgICAgICAg\nICAgZGVsaXZlclRvTGlzdGVuZXIoc2Vzc2lvbk1lc3NhZ2VMaXN0ZW5lciwg\ncmVjZWl2ZWRNZXNzYWdlLCBtZXNzYWdlLCB0cnVlKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8v\nIFVuZXhwZWN0ZWQgbm90IHRvIGJlIGFibGUgdG8gY2xvbmUgLi4uCiAgICAg\nICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlVuZXhwZWN0ZWQgZXhj\nZXB0aW9uIHRyeWluZyB0byBwcm9jZXNzIG1lc3NhZ2UiKTsKICAgICAgICAg\nICAgICAgICAgICBEZWJ1Z1V0aWwuZHVtcEpNU1N0YWNrdHJhY2UobG9nZ2Vy\nLCBlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0\nb1N0cmluZygpIHsKICAgICAgICAgICAgZmluYWwgU3RyaW5nQnVpbGRlciBz\nYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgIHNiLmFwcGVu\nZCgiVHJhbnNhY3RlZFJlY2VpdmVPcGVyYXRpb24iKTsKICAgICAgICAgICAg\nc2IuYXBwZW5kKCJ7cmVjZWl2ZWRNZXNzYWdlPSIpLmFwcGVuZChyZWNlaXZl\nZE1lc3NhZ2UpOwogICAgICAgICAgICBzYi5hcHBlbmQoIiwgc2Vzc2lvbk1l\nc3NhZ2VMaXN0ZW5lcj0iKS5hcHBlbmQoc2Vzc2lvbk1lc3NhZ2VMaXN0ZW5l\ncik7CiAgICAgICAgICAgIHNiLmFwcGVuZCgiLCBzdWJzY3JpYmVyPSIpLmFw\ncGVuZChzdWJzY3JpYmVyKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCd9Jyk7\nCiAgICAgICAgICAgIHJldHVybiBzYi50b1N0cmluZygpOwogICAgICAgIH0K\nICAgIH0KCgogICAgLy8gRm9yIHR4biBzdXBwb3J0LgogICAgcHJpdmF0ZSBm\naW5hbCBPYmplY3QgdHJhbnNhY3Rpb25Mb2NrID0gbmV3IE9iamVjdCgpOwog\nICAgcHJpdmF0ZSBmaW5hbCBMaXN0PFRyYW5zYWN0ZWRPcGVyYXRpb24+IHRy\nYW5zYWN0ZWRPcGVyYXRpb24gPSBuZXcgTGlua2VkTGlzdDxUcmFuc2FjdGVk\nT3BlcmF0aW9uPigpOwoKICAgIHByaXZhdGUgdm9pZCByb2xsYmFja1RyYW5z\nYWN0aW9uU3RhdGUoKXsKICAgICAgICBmaW5hbCBBcnJheUxpc3Q8VHJhbnNh\nY3RlZE9wZXJhdGlvbj4gdHJhbnNhY3RlZE9wZXJhdGlvbkNvcHk7CiAgICAg\nICAgc3luY2hyb25pemVkICh0cmFuc2FjdGlvbkxvY2spewogICAgICAgICAg\nICB0cmFuc2FjdGVkT3BlcmF0aW9uQ29weSA9IG5ldyBBcnJheUxpc3Q8VHJh\nbnNhY3RlZE9wZXJhdGlvbj4odHJhbnNhY3RlZE9wZXJhdGlvbik7CiAgICAg\nICAgICAgIHRyYW5zYWN0ZWRPcGVyYXRpb24uY2xlYXIoKTsKICAgICAgICB9\nCiAgICAgICAgcm9sbGJhY2tUcmFuc2FjdGlvblN0YXRlKHRyYW5zYWN0ZWRP\ncGVyYXRpb25Db3B5KTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgcm9sbGJh\nY2tUcmFuc2FjdGlvblN0YXRlKEFycmF5TGlzdDxUcmFuc2FjdGVkT3BlcmF0\naW9uPiB0cmFuc2FjdGVkT3BlcmF0aW9uQ29weSl7CgogICAgICAgIGlmIChs\nb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgbG9nZ2VyLmRlYnVnKCJBdHRlbXB0\naW5nIHRvIHJvbGxiYWNrICIgKwogICAgICAgICAgICB0cmFuc2FjdGVkT3Bl\ncmF0aW9uQ29weS5zaXplKCkgKyAiIG9wZXJhdGlvbnMiKTsKICAgICAgICBp\nZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgiT3Bl\ncmF0aW9ucyA6ICIgKyB0cmFuc2FjdGVkT3BlcmF0aW9uQ29weSk7CgogICAg\nICAgIC8vIFJvbGxiYWNrIE1VU1QgYmUgaW4gcmV2ZXJzZSBvcmRlciAhCiAg\nICAgICAgZmluYWwgaW50IHNpemUgPSB0cmFuc2FjdGVkT3BlcmF0aW9uQ29w\neS5zaXplKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IHNpemUgLSAxO2kgPj0g\nMDsgaSAtLSl7CiAgICAgICAgICAgIFRyYW5zYWN0ZWRPcGVyYXRpb24gb3Ag\nPSB0cmFuc2FjdGVkT3BlcmF0aW9uQ29weS5nZXQoaSk7CiAgICAgICAgICAg\nIG9wLnJvbGxiYWNrKCk7CiAgICAgICAgfQogICAgfQoKCiAgICAvLyBOb3Rl\nOiB0aGUgbWVzc2FnZUltcGwgTVVTVCBiZSBhIGNvcHkgb2Ygd2hhdCB0aGUg\ndXNlciBzZW50IC0gc28gdGhhdCBtb2RpZmljYXRpb25zIGJ5IHVzZXIKICAg\nIC8vIFdJTEwgTk9UIGFmZmVjdCB0aGlzLgogICAgcHVibGljIHZvaWQgZW5x\ndWV1ZVB1Ymxpc2hXaXRoaW5UcmFuc2FjdGlvbihTdHJpbmcgdG9waWNOYW1l\nLCBNZXNzYWdlSW1wbCBtZXNzYWdlSW1wbCwgTWVzc2FnZSB1c2VyTWVzc2Fn\nZSkgewogICAgICAgIFRyYW5zYWN0ZWRTZW5kT3BlcmF0aW9uIHNlbmRPcGVy\nYXRpb24gPSBuZXcgVHJhbnNhY3RlZFNlbmRPcGVyYXRpb24odG9waWNOYW1l\nLCBtZXNzYWdlSW1wbCwgdXNlck1lc3NhZ2UpOwogICAgICAgIHN5bmNocm9u\naXplZCAodHJhbnNhY3Rpb25Mb2NrKXsKICAgICAgICAgICAgdHJhbnNhY3Rl\nZE9wZXJhdGlvbi5hZGQoc2VuZE9wZXJhdGlvbik7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBlbnF1ZXVlUmVjZWl2ZVdpdGhpblRyYW5z\nYWN0aW9uKFRyYW5zYWN0ZWRSZWNlaXZlT3BlcmF0aW9uIHJlY2VpdmVPcGVy\nYXRpb24pIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRyYW5zYWN0aW9uTG9j\nayl7CiAgICAgICAgICAgIHRyYW5zYWN0ZWRPcGVyYXRpb24uYWRkKHJlY2Vp\ndmVPcGVyYXRpb24pOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZv\naWQgY29tbWl0VHJhbnNhY3Rpb25TdGF0ZSgpIHRocm93cyBKTVNFeGNlcHRp\nb24gewogICAgICAgIGZpbmFsIEFycmF5TGlzdDxUcmFuc2FjdGVkT3BlcmF0\naW9uPiB0cmFuc2FjdGVkT3BlcmF0aW9uQ29weTsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRyYW5zYWN0aW9uTG9jayl7CiAgICAgICAgICAgIHRyYW5zYWN0\nZWRPcGVyYXRpb25Db3B5ID0gbmV3IEFycmF5TGlzdDxUcmFuc2FjdGVkT3Bl\ncmF0aW9uPih0cmFuc2FjdGVkT3BlcmF0aW9uKTsKICAgICAgICAgICAgdHJh\nbnNhY3RlZE9wZXJhdGlvbi5jbGVhcigpOwogICAgICAgIH0KCiAgICAgICAg\naWYgKCFzZXNzaW9uU3RhdGUuaXNTdGFydGVkKCkpewogICAgICAgICAgICAv\nLyBFbnN1cmUgdGhhdCB0aGVyZSBhcmUgT05MWSBzZW5kIG9wJ3MgLSBlbHNl\nIHRocm93IFRyYW5zYWN0aW9uUm9sbGVkQmFja0V4Y2VwdGlvbiA6IHdlCiAg\nICAgICAgICAgIC8vIGNhbm5vdCBhY2sgbWVzc2FnZSAhCiAgICAgICAgICAg\nIGZvciAoVHJhbnNhY3RlZE9wZXJhdGlvbiBvcCA6IHRyYW5zYWN0ZWRPcGVy\nYXRpb25Db3B5KXsKICAgICAgICAgICAgICAgIGlmIChvcC5yZXF1aXJlc1N0\nYXJ0ZWRTZXNzaW9uKCkpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBU\ncmFuc2FjdGlvblJvbGxlZEJhY2tFeGNlcHRpb24oIkNvbW1pdCBmYWlsZWQg\nOiBzZXNzaW9uIGlzIG5vdCBvcGVuIC0gY2FudCBhY2sgbWVzc2FnZSIpOwog\nICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKFRyYW5zYWN0\nZWRPcGVyYXRpb24gb3AgOiB0cmFuc2FjdGVkT3BlcmF0aW9uQ29weSl7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBvcC5jb21taXQoKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoSk1TRXhjZXB0aW9uIGpFeCl7CiAgICAg\nICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIGxvZ2dl\nci5kZWJ1ZygiQ29tbWl0IGZhaWxlZCBmb3IgIiArIG9wLCBqRXgpOwogICAg\nICAgICAgICAgICAgcm9sbGJhY2tUcmFuc2FjdGlvblN0YXRlKHRyYW5zYWN0\nZWRPcGVyYXRpb25Db3B5KTsKICAgICAgICAgICAgICAgIFRyYW5zYWN0aW9u\nUm9sbGVkQmFja0V4Y2VwdGlvbiB0cmJFeCA9IG5ldyBUcmFuc2FjdGlvblJv\nbGxlZEJhY2tFeGNlcHRpb24oIkNvbW1pdCBmYWlsZWQiKTsKICAgICAgICAg\nICAgICAgIHRyYkV4LnNldExpbmtlZEV4Y2VwdGlvbihqRXgpOwogICAgICAg\nICAgICAgICAgdGhyb3cgdHJiRXg7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gaXNNZXNzYWdlRXhwaXJlZChN\nZXNzYWdlSW1wbCBtZXNzYWdlKSB7CiAgICAgICAgcmV0dXJuIDAgIT0gbWVz\nc2FnZS5nZXRKTVNFeHBpcmF0aW9uKCkgJiYgU2Vzc2lvbkltcGwuY3VycmVu\ndFRpbWVNaWxsaXMoKSA+IG1lc3NhZ2UuZ2V0Sk1TRXhwaXJhdGlvbigpOwog\nICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzTG9jYWxseVB1Ymxpc2hlZChT\ndHJpbmcgbWVzc2FnZUlkKSB7CiAgICAgICAgcmV0dXJuIGNvbm5lY3Rpb24u\naXNMb2NhbGx5UHVibGlzaGVkKG1lc3NhZ2VJZCk7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgYWRkVG9Mb2NhbGx5UHVibGlzaGVkTWVzc2FnZUlkcyhTdHJp\nbmcgbWVzc2FnZUlkKSB7CiAgICAgICAgY29ubmVjdGlvbi5hZGRUb0xvY2Fs\nbHlQdWJsaXNoZWRNZXNzYWdlSWRzKG1lc3NhZ2VJZCk7CiAgICB9CgogICAg\ncHVibGljIENvbm5lY3Rpb25JbXBsIGdldENvbm5lY3Rpb24oKSB7CiAgICAg\nICAgcmV0dXJuIGNvbm5lY3Rpb247CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgY2xhc3MgU3Vic2NyaXB0aW9ucyB7CiAgICAgICAgLy8gS2Vl\ncHMgdHJhY2sgb2YgbnVtYmVyIG9mIHN1YnNjcmliZXJzIGNyZWF0ZWQuIFRo\naXMgd2lsbCBwcmV2ZW50IHNldE1lc3NhZ2VMaXN0ZW5lciBmb3JtCiAgICAg\nICAgLy8gc3VjY2VlZGluZyBpbiBjYXNlIHN1YnNjcmliZXJDcmVhdGVkQ291\nbnQgPiAwCiAgICAgICAgLy8gVGhlaXIgdXNlIGlzIG11dHVhbGx5IGV4Y2x1\nc2l2ZS4KICAgICAgICAvLyBwcml2YXRlIGludCBzdWJzY3JpYmVyQ3JlYXRl\nZENvdW50ID0gMDsKICAgICAgICBwcml2YXRlIEF0b21pY0ludGVnZXIgbnVt\nU3Vic2NyaWJlcnMgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBDb25jdXJyZW50SGFzaE1hcDxUb3BpY1N1YnNjcmlw\ndGlvbiwgTm9kZT4gdG9waWNTdWJzY3JpcHRpb25Ub1NlbGVjdG9yTWFwID0K\nICAgICAgICAgICAgbmV3IENvbmN1cnJlbnRIYXNoTWFwPFRvcGljU3Vic2Ny\naXB0aW9uLCBOb2RlPigzMik7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBDb25j\ndXJyZW50SGFzaE1hcDxRdWV1ZVN1YnNjcmlwdGlvbiwgTm9kZT4gcXVldWVT\ndWJzY3JpcHRpb25Ub1NlbGVjdG9yTWFwID0KICAgICAgICAgICAgbmV3IENv\nbmN1cnJlbnRIYXNoTWFwPFF1ZXVlU3Vic2NyaXB0aW9uLCBOb2RlPigzMik7\nCgogICAgICAgIC8vIFdlIG1ha2UgdXNlIG9mIGNvbmN1cnJlbnQgYXBpIGZv\nciB0aGlzIG1hcCAoYW5kIGl0cyBsaXN0KSBzaW5jZSB3ZSB3aWxsIGJlIHJl\nYWRpbmcKICAgICAgICAvLyBpdCBoZWF2aWx5IGNvbmN1cnJlbnRseSB3aGls\nZSBtb2RpZnlpbmcgaXQgcmFyZWx5LgogICAgICAgIHByaXZhdGUgZmluYWwg\nTWFwPFN1YnNjcmlwdGlvbiwgQ29weU9uV3JpdGVBcnJheUxpc3Q8TWVzc2Fn\nZUNvbnN1bWVyPj4gdG9waWNTdWJzY3JpcHRpb25Ub1N1YnNjcmliZXJNYXAg\nPQogICAgICAgICAgICBuZXcgQ29uY3VycmVudEhhc2hNYXA8U3Vic2NyaXB0\naW9uLCBDb3B5T25Xcml0ZUFycmF5TGlzdDxNZXNzYWdlQ29uc3VtZXI+Pigp\nOwogICAgICAgIHByaXZhdGUgZmluYWwgTWFwPFN1YnNjcmlwdGlvbiwgQ29w\neU9uV3JpdGVBcnJheUxpc3Q8TWVzc2FnZUNvbnN1bWVyPj4gcXVldWVTdWJz\nY3JpcHRpb25Ub1N1YnNjcmliZXJNYXAgPQogICAgICAgICAgICBuZXcgQ29u\nY3VycmVudEhhc2hNYXA8U3Vic2NyaXB0aW9uLCBDb3B5T25Xcml0ZUFycmF5\nTGlzdDxNZXNzYWdlQ29uc3VtZXI+PigpOwoKICAgICAgICAvLyBUaGUgdmFs\ndWUgZm9yIHRoZSBrZXkgaXMgaXJyZWxldmFudCAtIHRoZXJlIGlzIG5vdAog\nICAgICAgIHByaXZhdGUgZmluYWwgU2V0PE1lc3NhZ2VDb25zdW1lcj4gYWxs\nQ29uc3VtZXJzU2V0ID0gQ29sbGVjdGlvbnMubmV3U2V0RnJvbU1hcCgKICAg\nICAgICAgICAgbmV3IElkZW50aXR5SGFzaE1hcDxNZXNzYWdlQ29uc3VtZXIs\nIEJvb2xlYW4+KCkpOwoKICAgICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBp\nbnQgU1VCU0NSSUJFUl9JRF9UT19ERVNUSU5BVElPTl9DQUNIRV9TSVpFID0K\nICAgICAgICAgICAgSW50ZWdlci5nZXRJbnRlZ2VyKCJTVUJTQ1JJQkVSX0lE\nX1RPX0RFU1RJTkFUSU9OX0NBQ0hFX1NJWkUiLCAxMDI0KTsKICAgICAgICAv\nLyBUaGlzIGlzIGd1YXJkZWQgYnkgc3Vic2NyaWJlcklkVG88RGVzdGluYXRp\nb24+IGxvY2sgLSBxdWVyeS9tb2RpZnkgT05MWSBpbiB0aGF0IGNvbnRleHQg\nIQogICAgICAgIHByaXZhdGUgZmluYWwgTWFwPFN0cmluZywgU3RyaW5nPiB0\nb3BpY1N1YnNjcmliZXJJZFRvVG9waWNOYW1lID0KICAgICAgICAgICAgbmV3\nIExSVUNhY2hlTWFwPFN0cmluZywgU3RyaW5nPihTVUJTQ1JJQkVSX0lEX1RP\nX0RFU1RJTkFUSU9OX0NBQ0hFX1NJWkUsIHRydWUpOwoKICAgICAgICBwdWJs\naWMgTWFwPFN1YnNjcmlwdGlvbiwgQ29weU9uV3JpdGVBcnJheUxpc3Q8TWVz\nc2FnZUNvbnN1bWVyPj4gY3JlYXRlU3Vic2NyaXB0aW9uVG9TdWJzY3JpYmVy\nTWFwQ29weSgpIHsKICAgICAgICAgIE1hcDxTdWJzY3JpcHRpb24sIENvcHlP\nbldyaXRlQXJyYXlMaXN0PE1lc3NhZ2VDb25zdW1lcj4+IHJldHZhbAogICAg\nICAgICAgICAgID0gbmV3IEhhc2hNYXA8U3Vic2NyaXB0aW9uLCBDb3B5T25X\ncml0ZUFycmF5TGlzdDxNZXNzYWdlQ29uc3VtZXI+PigpOwogICAgICAgICAg\ncmV0dmFsLnB1dEFsbCh0b3BpY1N1YnNjcmlwdGlvblRvU3Vic2NyaWJlck1h\ncCk7CiAgICAgICAgICByZXR2YWwucHV0QWxsKHF1ZXVlU3Vic2NyaXB0aW9u\nVG9TdWJzY3JpYmVyTWFwKTsKICAgICAgICAgIHJldHVybiByZXR2YWw7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgU2V0PE1lc3NhZ2VDb25zdW1lcj4g\nZ2V0QWxsQ29uc3VtZXJzU2V0KCkgewogICAgICAgICAgcmV0dXJuIGFsbENv\nbnN1bWVyc1NldDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBDb3B5T25X\ncml0ZUFycmF5TGlzdDw/IGV4dGVuZHMgTWVzc2FnZUNvbnN1bWVyPiBnZXRT\ndWJzY3JpYmVycyhTdWJzY3JpcHRpb24gc3Vic2NyaXB0aW9uKSB7CiAgICAg\nICAgICAgIGlmIChzdWJzY3JpcHRpb24uaXNUb3BpYygpKSB7CiAgICAgICAg\nICAgICAgICBhc3NlcnQgc3Vic2NyaXB0aW9uIGluc3RhbmNlb2YgVG9waWNT\ndWJzY3JpcHRpb247CiAgICAgICAgICAgICAgICByZXR1cm4gdG9waWNTdWJz\nY3JpcHRpb25Ub1N1YnNjcmliZXJNYXAuZ2V0KHN1YnNjcmlwdGlvbik7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbi5pc1F1\nZXVlKCkpIHsKICAgICAgICAgICAgICAgIGFzc2VydCBzdWJzY3JpcHRpb24g\naW5zdGFuY2VvZiBRdWV1ZVN1YnNjcmlwdGlvbjsKICAgICAgICAgICAgICAg\nIHJldHVybiBxdWV1ZVN1YnNjcmlwdGlvblRvU3Vic2NyaWJlck1hcC5nZXQo\nc3Vic2NyaXB0aW9uKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJv\ndyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJVbmtub3duIHN1YnNj\ncmlwdGlvbiB0eXBlICIgKyBzdWJzY3JpcHRpb24pOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIE5vZGUgZ2V0U2VsZWN0b3JFeHByZXNzaW9uKFN1YnNj\ncmlwdGlvbiBzdWJzY3JpcHRpb24pIHsKICAgICAgICAgICAgaWYgKHN1YnNj\ncmlwdGlvbi5pc1RvcGljKCkpIHsKICAgICAgICAgICAgICAgIGFzc2VydCBz\ndWJzY3JpcHRpb24gaW5zdGFuY2VvZiBUb3BpY1N1YnNjcmlwdGlvbjsKICAg\nICAgICAgICAgICAgIHJldHVybiB0b3BpY1N1YnNjcmlwdGlvblRvU2VsZWN0\nb3JNYXAuZ2V0KHN1YnNjcmlwdGlvbik7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKHN1YnNjcmlwdGlvbi5pc1F1ZXVlKCkpIHsKICAgICAgICAg\nICAgICAgIGFzc2VydCBzdWJzY3JpcHRpb24gaW5zdGFuY2VvZiBRdWV1ZVN1\nYnNjcmlwdGlvbjsKICAgICAgICAgICAgICAgIHJldHVybiBxdWV1ZVN1YnNj\ncmlwdGlvblRvU2VsZWN0b3JNYXAuZ2V0KHN1YnNjcmlwdGlvbik7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVu\ndEV4Y2VwdGlvbigiVW5rbm93biBzdWJzY3JpcHRpb24gdHlwZSAiICsgc3Vi\nc2NyaXB0aW9uKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJl\nZ2lzdGVyU3Vic2NyaWJlcklkVG9Ub3BpYyhTdHJpbmcgc3Vic2NyaWJlZElk\nLCBTdHJpbmcgdG9waWNOYW1lKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgc3luY2hyb25pemVkICh0b3BpY1N1YnNjcmliZXJJZFRvVG9w\naWNOYW1lKXsKICAgICAgICAgICAgICAgIFN0cmluZyBjdXJyZW50VG9waWNO\nYW1lID0gdG9waWNTdWJzY3JpYmVySWRUb1RvcGljTmFtZS5nZXQoc3Vic2Ny\naWJlZElkKTsKICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGN1cnJlbnRU\nb3BpY05hbWUgJiYgIWN1cnJlbnRUb3BpY05hbWUuZXF1YWxzKHRvcGljTmFt\nZSkpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSk1TRXhjZXB0\naW9uKCJUaGVyZSBpcyBhbHJlYWR5IGEgc3Vic2NyaXB0aW9uIGluIHRoaXMg\nc2Vzc2lvbiBmb3IgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICJzYW1l\nIHN1YnNjcmliZXJJZCBmb3IgdG9waWMgIiArIGN1cnJlbnRUb3BpY05hbWUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdG9waWNTdWJz\nY3JpYmVySWRUb1RvcGljTmFtZS5wdXQoc3Vic2NyaWJlZElkLCB0b3BpY05h\nbWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMg\nU3RyaW5nIGZpbmRUb3BpY05hbWVGb3JTdWJzY3JpYmVySWQoU3RyaW5nIHN1\nYnNjcmliZWRJZCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAodG9waWNTdWJzY3JpYmVySWRUb1RvcGljTmFtZSl7\nCiAgICAgICAgICAgICAgICBTdHJpbmcgdG9waWNOYW1lID0gdG9waWNTdWJz\nY3JpYmVySWRUb1RvcGljTmFtZS5nZXQoc3Vic2NyaWJlZElkKTsKICAgICAg\nICAgICAgICAgIGlmIChudWxsID09IHRvcGljTmFtZSl7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiVW5hYmxlIHRvIGZp\nbmQgdG9waWNOYW1lIGZvciBzdWJzY3JpYmVySWQgIiArIHN1YnNjcmliZWRJ\nZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4g\ndG9waWNOYW1lOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCByZWdpc3RlclRvcGljU3Vic2NyaXB0aW9uU2VsZWN0b3Io\nVG9waWNTdWJzY3JpcHRpb24gdG9waWNTdWJzY3JpcHRpb24sIE5vZGUgc2Vs\nZWN0b3JBc3QpIHsKICAgICAgICAgICAgdG9waWNTdWJzY3JpcHRpb25Ub1Nl\nbGVjdG9yTWFwLnB1dCh0b3BpY1N1YnNjcmlwdGlvbiwgc2VsZWN0b3JBc3Qp\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVnaXN0ZXJRdWV1\nZVN1YnNjcmlwdGlvblNlbGVjdG9yKFF1ZXVlU3Vic2NyaXB0aW9uIHF1ZXVl\nU3Vic2NyaXB0aW9uLCBOb2RlIHNlbGVjdG9yQXN0KSB7CiAgICAgICAgICAg\nIHF1ZXVlU3Vic2NyaXB0aW9uVG9TZWxlY3Rvck1hcC5wdXQocXVldWVTdWJz\nY3JpcHRpb24sIHNlbGVjdG9yQXN0KTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyBib29sZWFuIGFkZFRvU3Vic2NyaWJlclNldChNZXNzYWdlQ29uc3Vt\nZXIgY29uc3VtZXIpIHsKICAgICAgICAgICAgcmV0dXJuIGFsbENvbnN1bWVy\nc1NldC5hZGQoY29uc3VtZXIpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gYWRkVG9TdWJzY3JpYmVycyhNZXNzYWdlQ29uc3VtZXIgc3Vi\nc2NyaWJlciwgTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5\ncGUgdHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIFN0cmluZyBkZXN0aW5hdGlvbiwgU3RyaW5nIHN1YnNjcmliZXJJZCkg\newogICAgICAgICAgICBzd2l0Y2ggKHR5cGUpewogICAgICAgICAgICAgIGNh\nc2UgUVVFVUUgOgogICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUlmTWlz\nc2luZ0FuZEFkZChxdWV1ZVN1YnNjcmlwdGlvblRvU3Vic2NyaWJlck1hcCwK\nICAgICAgICAgICAgICAgICAgICBuZXcgUXVldWVTdWJzY3JpcHRpb24oZGVz\ndGluYXRpb24sIHN1YnNjcmliZXJJZCksCiAgICAgICAgICAgICAgICAgICAg\nc3Vic2NyaWJlcik7CiAgICAgICAgICAgICAgY2FzZSBUT1BJQzoKICAgICAg\nICAgICAgICAgIHJldHVybiBjcmVhdGVJZk1pc3NpbmdBbmRBZGQodG9waWNT\ndWJzY3JpcHRpb25Ub1N1YnNjcmliZXJNYXAsCiAgICAgICAgICAgICAgICAg\nICAgbmV3IFRvcGljU3Vic2NyaXB0aW9uKGRlc3RpbmF0aW9uLCBzdWJzY3Jp\nYmVySWQpLAogICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXIpOwogICAg\nICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIlVua25vd24gc3Vic2NyaXB0\naW9uIHR5cGUgIiArIHR5cGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiByZW1vdmVTdWJzY3JpYmVyKE1lc3Nh\nZ2VDb25zdW1lciBzdWJzY3JpYmVyLCBNZXNzYWdpbmdTZXNzaW9uRmFjYWRl\nLkRlc3RpbmF0aW9uVHlwZSB0eXBlLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgU3RyaW5nIGRlc3RpbmF0aW9uLCBTdHJpbmcg\nc3Vic2NyaWJlcklkKSB7CiAgICAgICAgICAgIGJvb2xlYW4gcmV0dmFsID0g\nZmFsc2U7CiAgICAgICAgICAgIHN3aXRjaCAodHlwZSl7CiAgICAgICAgICAg\nICAgICBjYXNlIFRPUElDOgogICAgICAgICAgICAgICAgewogICAgICAgICAg\nICAgICAgICAgIGZpbmFsIENvcHlPbldyaXRlQXJyYXlMaXN0PE1lc3NhZ2VD\nb25zdW1lcj4gc3Vic2NyaWJlckxpc3QgPQogICAgICAgICAgICAgICAgICAg\nICAgICB0b3BpY1N1YnNjcmlwdGlvblRvU3Vic2NyaWJlck1hcC5nZXQobmV3\nIFRvcGljU3Vic2NyaXB0aW9uKGRlc3RpbmF0aW9uLCBzdWJzY3JpYmVySWQp\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBzdWJzY3JpYmVy\nTGlzdCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3Vic2NyaWJl\nckxpc3QucmVtb3ZlKHN1YnNjcmliZXIpKXsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG51bVN1YnNjcmliZXJzLmRlY3JlbWVudEFuZEdldCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YnNjcmliZXJMaXN0\nLmlzRW1wdHkoKSl7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gVW5zdWJzY3JpYmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR2YWwgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGVsc2UgcmV0dmFsID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGNhc2UgUVVFVUU6CiAgICAgICAgICAgICAgICB7\nCiAgICAgICAgICAgICAgICAgICAgZmluYWwgQ29weU9uV3JpdGVBcnJheUxp\nc3Q8TWVzc2FnZUNvbnN1bWVyPiBzdWJzY3JpYmVyTGlzdCA9CiAgICAgICAg\nICAgICAgICAgICAgICAgIHF1ZXVlU3Vic2NyaXB0aW9uVG9TdWJzY3JpYmVy\nTWFwLmdldChuZXcgUXVldWVTdWJzY3JpcHRpb24oZGVzdGluYXRpb24sIHN1\nYnNjcmliZXJJZCkpOwogICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9\nIHN1YnNjcmliZXJMaXN0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChzdWJzY3JpYmVyTGlzdC5yZW1vdmUoc3Vic2NyaWJlcikpewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbnVtU3Vic2NyaWJlcnMuZGVjcmVtZW50\nQW5kR2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3Vi\nc2NyaWJlckxpc3QuaXNFbXB0eSgpKXsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBVbnN1YnNjcmliZQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHZhbCA9IHRydWU7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgZWxzZSByZXR2\nYWwgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9u\nKCJVbmtub3duIHN1YnNjcmlwdGlvbiB0eXBlICIgKyB0eXBlKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmV0dmFsOwogICAgICAgIH0K\nCiAgICAgICAgLy8gcmV0dXJucyB0cnVlIElGIGEgbmV3IGxpc3QgaXMgaW5z\nZXJ0ZWQuCiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGNyZWF0ZUlmTWlzc2lu\nZ0FuZEFkZChNYXA8U3Vic2NyaXB0aW9uLCBDb3B5T25Xcml0ZUFycmF5TGlz\ndDxNZXNzYWdlQ29uc3VtZXI+PiBtYXAsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb24ga2V5LCBN\nZXNzYWdlQ29uc3VtZXIgdmFsdWUpIHsKICAgICAgICAgICAgYm9vbGVhbiBy\nZXR2YWwgPSBmYWxzZTsKICAgICAgICAgICAgaWYgKCFtYXAuY29udGFpbnNL\nZXkoa2V5KSkgewogICAgICAgICAgICAgICAgbWFwLnB1dChrZXksIG5ldyBD\nb3B5T25Xcml0ZUFycmF5TGlzdDxNZXNzYWdlQ29uc3VtZXI+KCkpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBMaXN0PE1lc3NhZ2VDb25zdW1lcj4g\nIGxpc3QgPSBtYXAuZ2V0KGtleSk7CiAgICAgICAgICAgIGlmIChsaXN0Lmlz\nRW1wdHkoKSkgcmV0dmFsID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKCFsaXN0\nLmNvbnRhaW5zKHZhbHVlKSkgewogICAgICAgICAgICAgICAgbGlzdC5hZGQo\ndmFsdWUpOwogICAgICAgICAgICAgICAgbnVtU3Vic2NyaWJlcnMuaW5jcmVt\nZW50QW5kR2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJu\nIHJldHZhbDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgZ2V0TnVt\nU3Vic2NyaWJlcnMoKSB7CiAgICAgICAgICAgIHJldHVybiBudW1TdWJzY3Jp\nYmVycy5nZXQoKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

