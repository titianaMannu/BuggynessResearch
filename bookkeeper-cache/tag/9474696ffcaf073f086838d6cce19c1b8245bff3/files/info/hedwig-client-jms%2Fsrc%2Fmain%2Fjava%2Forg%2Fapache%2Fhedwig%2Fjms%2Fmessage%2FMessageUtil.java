{"sha":"15b75ee737bbf6d50a6d7fa033186af70d718952","node_id":"MDQ6QmxvYjE1NzU5NTY6MTViNzVlZTczN2JiZjZkNTBhNmQ3ZmEwMzMxODZhZjcwZDcxODk1Mg==","size":19431,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/15b75ee737bbf6d50a6d7fa033186af70d718952","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXMubWVzc2FnZTsKCgppbXBvcnQg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuam1zLlNlc3Npb25JbXBsOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuam1zLm1lc3NhZ2UuaGVhZGVyLk1ldGFkYXRhUHJvY2Vzc29y\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2w7CgppbXBvcnQgamF2YXguam1zLkJ5dGVzTWVzc2FnZTsKaW1wb3J0\nIGphdmF4Lmptcy5KTVNFeGNlcHRpb247CmltcG9ydCBqYXZheC5qbXMuTWFw\nTWVzc2FnZTsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlOwppbXBvcnQgamF2\nYXguam1zLk1lc3NhZ2VGb3JtYXRFeGNlcHRpb247CmltcG9ydCBqYXZheC5q\nbXMuT2JqZWN0TWVzc2FnZTsKaW1wb3J0IGphdmF4Lmptcy5TdHJlYW1NZXNz\nYWdlOwppbXBvcnQgamF2YXguam1zLlRleHRNZXNzYWdlOwppbXBvcnQgamF2\nYS5pby5CeXRlQXJyYXlJbnB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uQnl0\nZUFycmF5T3V0cHV0U3RyZWFtOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuaW8uT2JqZWN0SW5wdXRTdHJlYW07CmltcG9ydCBq\nYXZhLmlvLk9iamVjdE91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEudXRpbC5D\nb2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQg\namF2YS51dGlsLnJlZ2V4LlBhdHRlcm47CgovKioKICogQnVuY2ggb2Ygc2lt\ncGxlIHV0aWwgbWV0aG9kcyB0byByZWR1Y2UgY29kZSBpbiB0aGUgaW1wbGVt\nZW50YXRpb24uCiAqLwpwdWJsaWMgY2xhc3MgTWVzc2FnZVV0aWwgewoKICAg\nIC8vIFRoZSB2YXJpb3VzIG1lc3NhZ2UgdHlwZXMgc3VwcG9ydGVkLgogICAg\ncHVibGljIGVudW0gU3VwcG9ydGVkTWVzc2FnZVR5cGVzIHsKICAgICAgT05M\nWV9NRVNTQUdFKChieXRlKSAwKSwKICAgICAgVEVYVCgoYnl0ZSkgMSksCiAg\nICAgIEJZVEVTKChieXRlKSAyKSwKICAgICAgTUFQKChieXRlKSAzKSwKICAg\nICAgU1RSRUFNKChieXRlKSA0KSwKICAgICAgT0JKRUNUKChieXRlKSA1KTsK\nCiAgICAgIHByaXZhdGUgZmluYWwgYnl0ZSB0eXBlOwogICAgICBwcml2YXRl\nIFN1cHBvcnRlZE1lc3NhZ2VUeXBlcyhieXRlIHR5cGUpewogICAgICAgIHRo\naXMudHlwZSA9IHR5cGU7CiAgICAgIH0KCiAgICAgIHB1YmxpYyBieXRlIGdl\ndFR5cGUoKSB7CiAgICAgICAgcmV0dXJuIHR5cGU7CiAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBNYXA8Qnl0ZSwgU3VwcG9ydGVk\nTWVzc2FnZVR5cGVzPiB2YWx1ZVRvU3VwcG9ydGVkTWVzc2FnZVR5cGU7CiAg\nICBzdGF0aWMgewogICAgICAgIFN1cHBvcnRlZE1lc3NhZ2VUeXBlc1tdIGFy\nciA9IFN1cHBvcnRlZE1lc3NhZ2VUeXBlcy52YWx1ZXMoKTsKICAgICAgICBN\nYXA8Qnl0ZSwgU3VwcG9ydGVkTWVzc2FnZVR5cGVzPiBtYXAgPSBuZXcgSGFz\naE1hcDxCeXRlLCBTdXBwb3J0ZWRNZXNzYWdlVHlwZXM+KGFyci5sZW5ndGgp\nOwogICAgICAgIGZvciAoU3VwcG9ydGVkTWVzc2FnZVR5cGVzIHR5cGUgOiBh\ncnIpewogICAgICAgICAgICBtYXAucHV0KHR5cGUuZ2V0VHlwZSgpLCB0eXBl\nKTsKICAgICAgICB9CiAgICAgICAgdmFsdWVUb1N1cHBvcnRlZE1lc3NhZ2VU\neXBlID0gQ29sbGVjdGlvbnMudW5tb2RpZmlhYmxlTWFwKG1hcCk7CiAgICB9\nCgogICAgcHVibGljIHN0YXRpYyBib29sZWFuIGFzQm9vbGVhbihPYmplY3Qg\ndmFsdWUpIHRocm93cyBNZXNzYWdlRm9ybWF0RXhjZXB0aW9uIHsKICAgICAg\nICAvLyBUaGUgSk1TIHNwZWMgZXhwbGljaXRseSB3YW50cyB1cyB0byByYWlz\nZSBOUEUgIQogICAgICAgIC8vIGlmIChudWxsID09IHZhbHVlKSByZXR1cm4g\nZmFsc2U7CiAgICAgICAgaWYgKG51bGwgPT0gdmFsdWUpIHJldHVybiBCb29s\nZWFuLnZhbHVlT2YoKFN0cmluZykgdmFsdWUpOwoKICAgICAgICBpZiAodmFs\ndWUgaW5zdGFuY2VvZiBCb29sZWFuKSByZXR1cm4gKEJvb2xlYW4pIHZhbHVl\nOwogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykgcmV0dXJu\nIEJvb2xlYW4udmFsdWVPZigoU3RyaW5nKSB2YWx1ZSk7CiAgICAgICAgdGhy\nb3cgbmV3IE1lc3NhZ2VGb3JtYXRFeGNlcHRpb24oIlVuc3VwcG9ydGVkIHBy\nb3BlcnR5IHR5cGUgIiArIHZhbHVlLmdldENsYXNzKCkgKyAiIGZvciAiICsg\ndmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgYnl0ZSBhc0J5dGUo\nT2JqZWN0IHZhbHVlKSB0aHJvd3MgTWVzc2FnZUZvcm1hdEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gVGhlIEpNUyBzcGVjIGV4cGxpY2l0bHkgd2FudHMgdXMg\ndG8gcmFpc2UgTlBFICEKICAgICAgICAvLyBpZiAobnVsbCA9PSB2YWx1ZSkg\ncmV0dXJuIDA7CiAgICAgICAgaWYgKG51bGwgPT0gdmFsdWUpIHJldHVybiBC\neXRlLnZhbHVlT2YoKFN0cmluZykgdmFsdWUpOwoKICAgICAgICBpZiAodmFs\ndWUgaW5zdGFuY2VvZiBCeXRlKSByZXR1cm4gKEJ5dGUpIHZhbHVlOwogICAg\nICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykgcmV0dXJuIEJ5dGUu\ndmFsdWVPZigoU3RyaW5nKSB2YWx1ZSk7CiAgICAgICAgdGhyb3cgbmV3IE1l\nc3NhZ2VGb3JtYXRFeGNlcHRpb24oIlVuc3VwcG9ydGVkIHByb3BlcnR5IHR5\ncGUgIiArIHZhbHVlLmdldENsYXNzKCkgKyAiIGZvciAiICsgdmFsdWUpOwog\nICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgc2hvcnQgYXNTaG9ydChPYmplY3Qg\ndmFsdWUpIHRocm93cyBNZXNzYWdlRm9ybWF0RXhjZXB0aW9uIHsKICAgICAg\nICAvLyBUaGUgSk1TIHNwZWMgZXhwbGljaXRseSB3YW50cyB1cyB0byByYWlz\nZSBOUEUgIQogICAgICAgIC8vIGlmIChudWxsID09IHZhbHVlKSByZXR1cm4g\nMDsKICAgICAgICBpZiAobnVsbCA9PSB2YWx1ZSkgcmV0dXJuIFNob3J0LnZh\nbHVlT2YoKFN0cmluZykgdmFsdWUpOwoKICAgICAgICBpZiAodmFsdWUgaW5z\ndGFuY2VvZiBCeXRlKSByZXR1cm4gKEJ5dGUpIHZhbHVlOwogICAgICAgIGlm\nICh2YWx1ZSBpbnN0YW5jZW9mIFNob3J0KSByZXR1cm4gKFNob3J0KSB2YWx1\nZTsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBTdHJpbmcpIHJldHVy\nbiBTaG9ydC52YWx1ZU9mKChTdHJpbmcpIHZhbHVlKTsKICAgICAgICB0aHJv\ndyBuZXcgTWVzc2FnZUZvcm1hdEV4Y2VwdGlvbigiVW5zdXBwb3J0ZWQgcHJv\ncGVydHkgdHlwZSAiICsgdmFsdWUuZ2V0Q2xhc3MoKSArICIgZm9yICIgKyB2\nYWx1ZSk7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBpbnQgYXNJbnRlZ2Vy\nKE9iamVjdCB2YWx1ZSkgdGhyb3dzIE1lc3NhZ2VGb3JtYXRFeGNlcHRpb24g\newogICAgICAgIC8vIFRoZSBKTVMgc3BlYyBleHBsaWNpdGx5IHdhbnRzIHVz\nIHRvIHJhaXNlIE5QRSAhCiAgICAgICAgLy8gaWYgKG51bGwgPT0gdmFsdWUp\nIHJldHVybiAwOwogICAgICAgIGlmIChudWxsID09IHZhbHVlKSByZXR1cm4g\nSW50ZWdlci52YWx1ZU9mKChTdHJpbmcpIHZhbHVlKTsKCiAgICAgICAgaWYg\nKHZhbHVlIGluc3RhbmNlb2YgQnl0ZSkgcmV0dXJuIChCeXRlKSB2YWx1ZTsK\nICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBTaG9ydCkgcmV0dXJuIChT\naG9ydCkgdmFsdWU7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgSW50\nZWdlcikgcmV0dXJuIChJbnRlZ2VyKSB2YWx1ZTsKICAgICAgICBpZiAodmFs\ndWUgaW5zdGFuY2VvZiBTdHJpbmcpIHJldHVybiBJbnRlZ2VyLnZhbHVlT2Yo\nKFN0cmluZykgdmFsdWUpOwogICAgICAgIHRocm93IG5ldyBNZXNzYWdlRm9y\nbWF0RXhjZXB0aW9uKCJVbnN1cHBvcnRlZCBwcm9wZXJ0eSB0eXBlICIgKyB2\nYWx1ZS5nZXRDbGFzcygpICsgIiBmb3IgIiArIHZhbHVlKTsKICAgIH0KCiAg\nICBwdWJsaWMgc3RhdGljIGxvbmcgYXNMb25nKE9iamVjdCB2YWx1ZSkgdGhy\nb3dzIE1lc3NhZ2VGb3JtYXRFeGNlcHRpb24gewogICAgICAgIC8vIFRoZSBK\nTVMgc3BlYyBleHBsaWNpdGx5IHdhbnRzIHVzIHRvIHJhaXNlIE5QRSAhCiAg\nICAgICAgLy8gaWYgKG51bGwgPT0gdmFsdWUpIHJldHVybiAwOwogICAgICAg\nIGlmIChudWxsID09IHZhbHVlKSByZXR1cm4gTG9uZy52YWx1ZU9mKChTdHJp\nbmcpIHZhbHVlKTsKCiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQnl0\nZSkgcmV0dXJuIChCeXRlKSB2YWx1ZTsKICAgICAgICBpZiAodmFsdWUgaW5z\ndGFuY2VvZiBTaG9ydCkgcmV0dXJuIChTaG9ydCkgdmFsdWU7CiAgICAgICAg\naWYgKHZhbHVlIGluc3RhbmNlb2YgSW50ZWdlcikgcmV0dXJuIChJbnRlZ2Vy\nKSB2YWx1ZTsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMb25nKSBy\nZXR1cm4gKExvbmcpIHZhbHVlOwogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5j\nZW9mIFN0cmluZykgcmV0dXJuIExvbmcudmFsdWVPZigoU3RyaW5nKSB2YWx1\nZSk7CiAgICAgICAgdGhyb3cgbmV3IE1lc3NhZ2VGb3JtYXRFeGNlcHRpb24o\nIlVuc3VwcG9ydGVkIHByb3BlcnR5IHR5cGUgIiArIHZhbHVlLmdldENsYXNz\nKCkgKyAiIGZvciAiICsgdmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0\naWMgZmxvYXQgYXNGbG9hdChPYmplY3QgdmFsdWUpIHRocm93cyBNZXNzYWdl\nRm9ybWF0RXhjZXB0aW9uIHsKICAgICAgICAvLyBUaGUgSk1TIHNwZWMgZXhw\nbGljaXRseSB3YW50cyB1cyB0byByYWlzZSBOUEUgIQogICAgICAgIC8vIGlm\nIChudWxsID09IHZhbHVlKSByZXR1cm4gMC4wZjsKICAgICAgICBpZiAobnVs\nbCA9PSB2YWx1ZSkgcmV0dXJuIEZsb2F0LnZhbHVlT2YoKFN0cmluZykgdmFs\ndWUpOwoKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBGbG9hdCkgcmV0\ndXJuIChGbG9hdCkgdmFsdWU7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNl\nb2YgU3RyaW5nKSByZXR1cm4gRmxvYXQudmFsdWVPZigoU3RyaW5nKSB2YWx1\nZSk7CiAgICAgICAgdGhyb3cgbmV3IE1lc3NhZ2VGb3JtYXRFeGNlcHRpb24o\nIlVuc3VwcG9ydGVkIHByb3BlcnR5IHR5cGUgIiArIHZhbHVlLmdldENsYXNz\nKCkgKyAiIGZvciAiICsgdmFsdWUpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0\naWMgZG91YmxlIGFzRG91YmxlIChPYmplY3QgdmFsdWUpIHRocm93cyBNZXNz\nYWdlRm9ybWF0RXhjZXB0aW9uIHsKICAgICAgICAvLyBUaGUgSk1TIHNwZWMg\nZXhwbGljaXRseSB3YW50cyB1cyB0byByYWlzZSBOUEUgIQogICAgICAgIC8v\nIGlmIChudWxsID09IHZhbHVlKSByZXR1cm4gMC4wOwogICAgICAgIGlmIChu\ndWxsID09IHZhbHVlKSByZXR1cm4gRG91YmxlLnZhbHVlT2YoKFN0cmluZykg\ndmFsdWUpOwoKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBGbG9hdCkg\ncmV0dXJuIChGbG9hdCkgdmFsdWU7CiAgICAgICAgaWYgKHZhbHVlIGluc3Rh\nbmNlb2YgRG91YmxlICkgcmV0dXJuIChEb3VibGUpIHZhbHVlOwogICAgICAg\nIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFN0cmluZykgcmV0dXJuIERvdWJsZS52\nYWx1ZU9mKChTdHJpbmcpIHZhbHVlKTsKICAgICAgICB0aHJvdyBuZXcgTWVz\nc2FnZUZvcm1hdEV4Y2VwdGlvbigiVW5zdXBwb3J0ZWQgcHJvcGVydHkgdHlw\nZSAiICsgdmFsdWUuZ2V0Q2xhc3MoKSArICIgZm9yICIgKyB2YWx1ZSk7CiAg\nICB9CgogICAgcHVibGljIHN0YXRpYyBEb3VibGUgYXNEb3VibGVTZWxlY3Rv\nclByb2Nlc3NpbmcoT2JqZWN0IHZhbHVlKSB0aHJvd3MgTWVzc2FnZUZvcm1h\ndEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG51bGwgPT0gdmFsdWUpIHJldHVy\nbiBudWxsOwoKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBGbG9hdCkg\ncmV0dXJuIChkb3VibGUpIChGbG9hdCkgdmFsdWU7CiAgICAgICAgaWYgKHZh\nbHVlIGluc3RhbmNlb2YgRG91YmxlICkgcmV0dXJuIChEb3VibGUpIHZhbHVl\nOwoKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBMb25nKSByZXR1cm4g\nKGRvdWJsZSkgKExvbmcpIHZhbHVlOwogICAgICAgIGlmICh2YWx1ZSBpbnN0\nYW5jZW9mIEludGVnZXIpIHJldHVybiAoZG91YmxlKSAoSW50ZWdlcikgdmFs\ndWU7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU2hvcnQpIHJldHVy\nbiAoZG91YmxlKSAoU2hvcnQpIHZhbHVlOwogICAgICAgIGlmICh2YWx1ZSBp\nbnN0YW5jZW9mIEJ5dGUpIHJldHVybiAoZG91YmxlKSAoQnl0ZSkgdmFsdWU7\nCgogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBzdGF0\naWMgSW50ZWdlciBhc0ludGVnZXJTZWxlY3RvclByb2Nlc3NpbmcoT2JqZWN0\nIHZhbHVlKSB0aHJvd3MgTWVzc2FnZUZvcm1hdEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKG51bGwgPT0gdmFsdWUpIHJldHVybiBudWxsOwoKICAgICAgICBp\nZiAodmFsdWUgaW5zdGFuY2VvZiBGbG9hdCkgcmV0dXJuIChpbnQpIChmbG9h\ndCkgKEZsb2F0KSB2YWx1ZTsKICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2Vv\nZiBEb3VibGUgKSByZXR1cm4gKGludCkgKGRvdWJsZSkgKERvdWJsZSkgdmFs\ndWU7CgogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIExvbmcpIHJldHVy\nbiAoaW50KSAobG9uZykgKExvbmcpIHZhbHVlOwogICAgICAgIGlmICh2YWx1\nZSBpbnN0YW5jZW9mIEludGVnZXIpIHJldHVybiAoSW50ZWdlcikgdmFsdWU7\nCiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgU2hvcnQpIHJldHVybiAo\naW50KSAoU2hvcnQpIHZhbHVlOwogICAgICAgIGlmICh2YWx1ZSBpbnN0YW5j\nZW9mIEJ5dGUpIHJldHVybiAoaW50KSAoQnl0ZSkgdmFsdWU7CgogICAgICAg\nIHJldHVybiBudWxsOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgU3RyaW5n\nIGFzU3RyaW5nKE9iamVjdCB2YWx1ZSkgewogICAgICAgIGlmIChudWxsID09\nIHZhbHVlKSByZXR1cm4gbnVsbDsKCiAgICAgICAgaWYgKHZhbHVlIGluc3Rh\nbmNlb2YgU3RyaW5nKSByZXR1cm4gKFN0cmluZykgdmFsdWU7CiAgICAgICAg\nLy8gY29udmVydHMgZnJvbSBib29sZWFuLCBieXRlLCBzaG9ydCwgY2hhciwg\naW50LCBsb25nLCBmbG9hdCBhbmQgZG91YmxlIHRvIFN0cmluZy4KICAgICAg\nICByZXR1cm4gIiIgKyB2YWx1ZTsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGlj\nIGNoYXIgYXNDaGFyKE9iamVjdCB2YWx1ZSkgdGhyb3dzIE1lc3NhZ2VGb3Jt\nYXRFeGNlcHRpb24gewogICAgICAgIC8vIHRyZWF0IGl0IGFzIGludGVnZXIg\nd2l0aCBudWxsCiAgICAgICAgaWYgKG51bGwgPT0gdmFsdWUpIHJldHVybiAo\nY2hhcikgMDsKCiAgICAgICAgLy8gb25seSBmcm9tL3RvIGNoYXIKICAgICAg\nICBpZiAodmFsdWUgaW5zdGFuY2VvZiBDaGFyYWN0ZXIpIHJldHVybiAoQ2hh\ncmFjdGVyKSB2YWx1ZTsKICAgICAgICB0aHJvdyBuZXcgTWVzc2FnZUZvcm1h\ndEV4Y2VwdGlvbigiVW5zdXBwb3J0ZWQgcHJvcGVydHkgdHlwZSAiICsgdmFs\ndWUuZ2V0Q2xhc3MoKSArICIgZm9yICIgKyB2YWx1ZSk7CiAgICB9CgogICAg\ncHVibGljIHN0YXRpYyBieXRlW10gYXNCeXRlcyhPYmplY3QgdmFsdWUpIHRo\ncm93cyBNZXNzYWdlRm9ybWF0RXhjZXB0aW9uIHsKICAgICAgICBpZiAobnVs\nbCA9PSB2YWx1ZSB8fCB2YWx1ZSBpbnN0YW5jZW9mIGJ5dGVbXSkgcmV0dXJu\nIChieXRlW10pIHZhbHVlOwogICAgICAgIHRocm93IG5ldyBNZXNzYWdlRm9y\nbWF0RXhjZXB0aW9uKCJVbnN1cHBvcnRlZCBwcm9wZXJ0eSB0eXBlICIgKyB2\nYWx1ZS5nZXRDbGFzcygpICsgIiBmb3IgIiArIHZhbHVlKTsKICAgIH0KCiAg\nICBwdWJsaWMgc3RhdGljIGJvb2xlYW4gaXNWYWxpZEtleShTdHJpbmcga2V5\nKSB7CiAgICAgICAgcmV0dXJuIG51bGwgIT0ga2V5ICYmIDAgIT0ga2V5Lmxl\nbmd0aCgpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgYnl0ZVtdIG9iamVj\ndFRvQnl0ZXMoT2JqZWN0IG9iaikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBCeXRlQXJyYXlPdXRwdXRTdHJlYW0gYmFvcyA9IG5ldyBCeXRlQXJy\nYXlPdXRwdXRTdHJlYW0oMTI4KTsKICAgICAgICBPYmplY3RPdXRwdXRTdHJl\nYW0gb29zID0gbmV3IE9iamVjdE91dHB1dFN0cmVhbShiYW9zKTsKICAgICAg\nICB0cnkgewogICAgICAgICAgICBvb3Mud3JpdGVPYmplY3Qob2JqKTsKICAg\nICAgICAgICAgb29zLmZsdXNoKCk7CiAgICAgICAgfSBmaW5hbGx5IHsKICAg\nICAgICAgICAgdHJ5IHsgb29zLmNsb3NlKCk7IH0gY2F0Y2ggKElPRXhjZXB0\naW9uIGlvRXgpIHsgLyogaWdub3JlICovIH0KICAgICAgICB9CgogICAgICAg\nIHJldHVybiBiYW9zLnRvQnl0ZUFycmF5KCk7CiAgICB9CgogICAgcHVibGlj\nIHN0YXRpYyBPYmplY3QgYnl0ZXNUb09iamVjdChieXRlW10gZGF0YSkgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBPYmplY3RJbnB1dFN0cmVhbSBv\naXMgPSBuZXcgT2JqZWN0SW5wdXRTdHJlYW0obmV3IEJ5dGVBcnJheUlucHV0\nU3RyZWFtKGRhdGEpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXR1\ncm4gb2lzLnJlYWRPYmplY3QoKTsKICAgICAgICB9IGNhdGNoIChDbGFzc05v\ndEZvdW5kRXhjZXB0aW9uICBjbmZFeCl7CiAgICAgICAgICAgIC8vIHVuZXhw\nZWN0ZWQgIQogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhj\nZXB0aW9uKCJVbmV4cGVjdGVkIiwgY25mRXgpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHRyeSB7IG9pcy5jbG9zZSgpOyB9IGNhdGNoKElP\nRXhjZXB0aW9uIGlvRXgpIHsgLyogaWdub3JlICovIH0KICAgICAgICB9CiAg\nICB9CgoKCiAgICBwdWJsaWMgc3RhdGljIE1lc3NhZ2VJbXBsIHByb2Nlc3NI\nZWR3aWdNZXNzYWdlKFNlc3Npb25JbXBsIHNlc3Npb24sIFB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2UgbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHNvdXJjZVRvcGlj\nTmFtZSwgU3RyaW5nIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUnVubmFibGUgYWNr\nUnVubmFibGUpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIE1hcDxT\ndHJpbmcsIE9iamVjdD4gbWFwID0gTWV0YWRhdGFQcm9jZXNzb3IucGFyc2VI\nZWFkZXJzKG1lc3NhZ2UpOwoKICAgICAgICBPYmplY3Qgam1zQm9keVR5cGVW\nYWx1ZSA9IG1hcC5nZXQoTWVzc2FnZUltcGwuSk1TX01FU1NBR0VfVFlQRV9L\nRVkpOwogICAgICAgIC8vIFNob3VsZCB3ZSB0cmVhdCB0aGVzZSBhcyBieXRl\ncyBtZXNzYWdlIGJ5IGRlZmF1bHQgPwogICAgICAgIC8vIGlmICghIChqbXNC\nb2R5VHlwZVZhbHVlIGluc3RhbmNlb2YgQnl0ZSkgKQogICAgICAgIC8vICAg\nIHRocm93IG5ldyBKTVNFeGNlcHRpb24oIlVuc3VwcG9ydGVkIG1lc3NhZ2Ug\nOiAiICsgbWVzc2FnZSArICIsIHVuYWJsZSB0byBkZXRlcm1pbmUgam1zIG1l\nc3NhZ2UgdHlwZSAiICsKICAgICAgICAvLyAgICAgIGptc0JvZHlUeXBlVmFs\ndWUpOwogICAgICAgIGlmICghIChqbXNCb2R5VHlwZVZhbHVlIGluc3RhbmNl\nb2YgQnl0ZSkgKSBqbXNCb2R5VHlwZVZhbHVlID0gKEJ5dGUpIFN1cHBvcnRl\nZE1lc3NhZ2VUeXBlcy5CWVRFUy5nZXRUeXBlKCk7CgogICAgICAgIFN1cHBv\ncnRlZE1lc3NhZ2VUeXBlcyB0eXBlID0gdmFsdWVUb1N1cHBvcnRlZE1lc3Nh\nZ2VUeXBlLmdldCgoQnl0ZSkgam1zQm9keVR5cGVWYWx1ZSk7CiAgICAgICAg\nc3dpdGNoICh0eXBlKXsKICAgICAgICAgICAgY2FzZSBTVFJFQU06CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IFN0cmVhbU1lc3NhZ2VJbXBsKHNlc3Np\nb24sIG1lc3NhZ2UsIG1hcCwgc291cmNlVG9waWNOYW1lLCBzdWJzY3JpYmVy\nSWQsIGFja1J1bm5hYmxlKTsKICAgICAgICAgICAgY2FzZSBNQVA6CiAgICAg\nICAgICAgICAgICByZXR1cm4gbmV3IE1hcE1lc3NhZ2VJbXBsKHNlc3Npb24s\nIG1lc3NhZ2UsIG1hcCwgc291cmNlVG9waWNOYW1lLCBzdWJzY3JpYmVySWQs\nIGFja1J1bm5hYmxlKTsKICAgICAgICAgICAgY2FzZSBURVhUOgogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBUZXh0TWVzc2FnZUltcGwoc2Vzc2lvbiwg\nbWVzc2FnZSwgbWFwLCBzb3VyY2VUb3BpY05hbWUsIHN1YnNjcmliZXJJZCwg\nYWNrUnVubmFibGUpOwogICAgICAgICAgICBjYXNlIE9CSkVDVDoKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgT2JqZWN0TWVzc2FnZUltcGwoc2Vzc2lv\nbiwgbWVzc2FnZSwgbWFwLCBzb3VyY2VUb3BpY05hbWUsIHN1YnNjcmliZXJJ\nZCwgYWNrUnVubmFibGUpOwogICAgICAgICAgICBjYXNlIEJZVEVTOgogICAg\nICAgICAgICAgICAgcmV0dXJuIG5ldyBCeXRlc01lc3NhZ2VJbXBsKHNlc3Np\nb24sIG1lc3NhZ2UsIG1hcCwgc291cmNlVG9waWNOYW1lLCBzdWJzY3JpYmVy\nSWQsIGFja1J1bm5hYmxlKTsKICAgICAgICAgICAgY2FzZSBPTkxZX01FU1NB\nR0U6CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1lc3NhZ2VJbXBsKHNl\nc3Npb24sIG1lc3NhZ2UsIG1hcCwgc291cmNlVG9waWNOYW1lLCBzdWJzY3Jp\nYmVySWQsIGFja1J1bm5hYmxlKTsKICAgICAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24oIlVuc3VwcG9y\ndGVkIG1lc3NhZ2UgdHlwZSA6ICIgKyB0eXBlICsgIiBmb3IgbWVzc2FnZSAi\nICsgbWVzc2FnZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0\naWMgTWVzc2FnZUltcGwgY3JlYXRlTWVzc2FnZUNvcHkoU2Vzc2lvbkltcGwg\nc2Vzc2lvbiwgTWVzc2FnZSBtZXNzYWdlKSB0aHJvd3MgSk1TRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAobWVzc2FnZSBpbnN0YW5jZW9mIE1lc3NhZ2VJbXBs\nKSB7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVNZXNzYWdlSW1wbENvcHko\nc2Vzc2lvbiwgKE1lc3NhZ2VJbXBsKSBtZXNzYWdlKTsKICAgICAgICB9Cgog\nICAgICAgIGlmIChtZXNzYWdlIGluc3RhbmNlb2YgQnl0ZXNNZXNzYWdlKSB7\nCiAgICAgICAgICAgIHJldHVybiBuZXcgQnl0ZXNNZXNzYWdlSW1wbCgoQnl0\nZXNNZXNzYWdlKSBtZXNzYWdlLCBzZXNzaW9uKTsKICAgICAgICB9CiAgICAg\nICAgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBNYXBNZXNzYWdlKSB7CiAgICAg\nICAgICAgIHJldHVybiBuZXcgTWFwTWVzc2FnZUltcGwoKE1hcE1lc3NhZ2Up\nIG1lc3NhZ2UsIHNlc3Npb24pOwogICAgICAgIH0KICAgICAgICBpZiAobWVz\nc2FnZSBpbnN0YW5jZW9mIE9iamVjdE1lc3NhZ2UpIHsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBPYmplY3RNZXNzYWdlSW1wbCgoT2JqZWN0TWVzc2FnZSkg\nbWVzc2FnZSwgc2Vzc2lvbik7CiAgICAgICAgfQogICAgICAgIGlmIChtZXNz\nYWdlIGluc3RhbmNlb2YgU3RyZWFtTWVzc2FnZSkgewogICAgICAgICAgICBy\nZXR1cm4gbmV3IFN0cmVhbU1lc3NhZ2VJbXBsKChTdHJlYW1NZXNzYWdlKSBt\nZXNzYWdlLCBzZXNzaW9uKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1lc3Nh\nZ2UgaW5zdGFuY2VvZiBUZXh0TWVzc2FnZSkgewogICAgICAgICAgICByZXR1\ncm4gbmV3IFRleHRNZXNzYWdlSW1wbCgoVGV4dE1lc3NhZ2UpIG1lc3NhZ2Us\nIHNlc3Npb24pOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ldyBNZXNz\nYWdlSW1wbChtZXNzYWdlLCBzZXNzaW9uKTsKICAgIH0KCiAgICBwcml2YXRl\nIHN0YXRpYyBNZXNzYWdlSW1wbCBjcmVhdGVNZXNzYWdlSW1wbENvcHkoU2Vz\nc2lvbkltcGwgc2Vzc2lvbiwgTWVzc2FnZUltcGwgbWVzc2FnZSkKICAgICAg\nICB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKCiAgICAgICAgaWYgKG1lc3NhZ2Ug\naW5zdGFuY2VvZiBCeXRlc01lc3NhZ2VJbXBsKSB7CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgQnl0ZXNNZXNzYWdlSW1wbChzZXNzaW9uLCAoQnl0ZXNNZXNz\nYWdlSW1wbCkgbWVzc2FnZSwgbWVzc2FnZS5nZXRTb3VyY2VOYW1lKCksCiAg\nICAgICAgICAgICAgICBtZXNzYWdlLmdldFN1YnNjcmliZXJJZCgpKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBNYXBNZXNz\nYWdlSW1wbCkgewogICAgICAgICAgICByZXR1cm4gbmV3IE1hcE1lc3NhZ2VJ\nbXBsKHNlc3Npb24sIChNYXBNZXNzYWdlSW1wbCkgbWVzc2FnZSwgbWVzc2Fn\nZS5nZXRTb3VyY2VOYW1lKCksCiAgICAgICAgICAgICAgICBtZXNzYWdlLmdl\ndFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1lc3Nh\nZ2UgaW5zdGFuY2VvZiBPYmplY3RNZXNzYWdlSW1wbCkgewogICAgICAgICAg\nICByZXR1cm4gbmV3IE9iamVjdE1lc3NhZ2VJbXBsKHNlc3Npb24sIChPYmpl\nY3RNZXNzYWdlSW1wbCkgbWVzc2FnZSwgbWVzc2FnZS5nZXRTb3VyY2VOYW1l\nKCksCiAgICAgICAgICAgICAgICBtZXNzYWdlLmdldFN1YnNjcmliZXJJZCgp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBT\ndHJlYW1NZXNzYWdlSW1wbCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFN0\ncmVhbU1lc3NhZ2VJbXBsKHNlc3Npb24sIChTdHJlYW1NZXNzYWdlSW1wbCkg\nbWVzc2FnZSwgbWVzc2FnZS5nZXRTb3VyY2VOYW1lKCksCiAgICAgICAgICAg\nICAgICBtZXNzYWdlLmdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9CiAg\nICAgICAgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBUZXh0TWVzc2FnZUltcGwp\nIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0TWVzc2FnZUltcGwoc2Vz\nc2lvbiwgKFRleHRNZXNzYWdlSW1wbCkgbWVzc2FnZSwgbWVzc2FnZS5nZXRT\nb3VyY2VOYW1lKCksCiAgICAgICAgICAgICAgICBtZXNzYWdlLmdldFN1YnNj\ncmliZXJJZCgpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBuZXcgTWVz\nc2FnZUltcGwoc2Vzc2lvbiwgbWVzc2FnZSwgbWVzc2FnZS5nZXRTb3VyY2VO\nYW1lKCksIG1lc3NhZ2UuZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBKTVNfTUVTU0FHRV9JRF9Q\nUkVGSVggPSAiSUQ6IjsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmlu\nZyBMT0NBTF9QUkVGSVggPSAiTE9DQUwoIjsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBSRU1PVEVfUFJFRklYID0gIlJFTU9URSgiOwogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgY2hhciBTRVFfSURfU1VGRklYID0gJykn\nOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgY2hhciBSRU1PVEVfUkVDT1JE\nX1NFUEFSQVRPUiA9ICcsJzsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGNo\nYXIgUkVNT1RFX1JFQ09SRF9TRVFfSURfUFJFRklYID0gJ1snOwogICAgcHJp\ndmF0ZSBzdGF0aWMgZmluYWwgY2hhciBSRU1PVEVfUkVDT1JEX1NFUV9JRF9T\nVUZGSVggPSAnXSc7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBQYXR0ZXJu\nIHJlbW90ZU1lc3NhZ2VJZFNwbGl0UGF0dGVybiA9IFBhdHRlcm4uY29tcGls\nZSgiIiArIFJFTU9URV9SRUNPUkRfU0VQQVJBVE9SKTsKCiAgICAvKioKICAg\nICAqIEJhc2VkIG9uCiAgICAgKiB7QGxpbmsgb3JnLmFwYWNoZS5oZWR3aWcu\nYWRtaW4uY29uc29sZS5SZWFkVG9waWMjZm9ybWF0TWVzc2FnZShQdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlKX0KICAgICAqCiAgICAgKiBUaGlzIGlzIHRpZ2h0\nbHkgY291cGxlZCB3aXRoCiAgICAgKiBAc2VlICNnZW5lcmF0ZVNlcUlkRnJv\nbUpNU01lc3NhZ2VJZChTdHJpbmcpCiAgICAgKgogICAgICogQHBhcmFtIHNl\ncUlkIFRoZSBzZXF1ZW5jZSBpZCB0byBjb252ZXJ0IHRvIHN0cmluZy4KICAg\nICAqIEByZXR1cm4gVGhlIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUg\nc2VxLWlkLgogICAgICovCiAgICBwdWJsaWMgc3RhdGljIFN0cmluZyBnZW5l\ncmF0ZUpNU01lc3NhZ2VJZEZyb21TZXFJZChmaW5hbCBQdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQgc2VxSWQpIHsKICAgICAgICBTdHJpbmdCdWlsZGVy\nIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAvLyBtYW5kYXRv\ncnkgcHJlZml4IGZvciBzeXN0ZW0gZ2VuZXJhdGVkIGlkJ3MuCiAgICAgICAg\nc2IuYXBwZW5kKEpNU19NRVNTQUdFX0lEX1BSRUZJWCk7CgogICAgICAgIGlm\nIChzZXFJZC5oYXNMb2NhbENvbXBvbmVudCgpKSB7CiAgICAgICAgICAgIHNi\nLmFwcGVuZChMT0NBTF9QUkVGSVgpLmFwcGVuZChzZXFJZC5nZXRMb2NhbENv\nbXBvbmVudCgpKS5hcHBlbmQoU0VRX0lEX1NVRkZJWCk7CiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgTGlzdDxQdWJTdWJQcm90b2NvbC5SZWdpb25T\ncGVjaWZpY1NlcUlkPiByZW1vdGVJZHMgPSBzZXFJZC5nZXRSZW1vdGVDb21w\nb25lbnRzTGlzdCgpOwogICAgICAgICAgICBib29sZWFuIGZpcnN0ID0gdHJ1\nZTsKCiAgICAgICAgICAgIHNiLmFwcGVuZChSRU1PVEVfUFJFRklYKTsKICAg\nICAgICAgICAgZm9yIChQdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkIHJzc2lkIDogcmVtb3RlSWRzKSB7CiAgICAgICAgICAgICAgICBpZiAo\nIWZpcnN0KSBzYi5hcHBlbmQoUkVNT1RFX1JFQ09SRF9TRVBBUkFUT1IpOwog\nICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAg\nIHNiLmFwcGVuZChyc3NpZC5nZXRSZWdpb24oKS50b1N0cmluZ1V0ZjgoKSk7\nCiAgICAgICAgICAgICAgICBzYi5hcHBlbmQoUkVNT1RFX1JFQ09SRF9TRVFf\nSURfUFJFRklYKTsKICAgICAgICAgICAgICAgIHNiLmFwcGVuZChyc3NpZC5n\nZXRTZXFJZCgpKTsKICAgICAgICAgICAgICAgIHNiLmFwcGVuZChSRU1PVEVf\nUkVDT1JEX1NFUV9JRF9TVUZGSVgpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHNiLmFwcGVuZChTRVFfSURfU1VGRklYKTsKICAgICAgICB9CgogICAg\nICAgIHJldHVybiBzYi50b1N0cmluZygpOwogICAgfQoKICAgIC8qKgogICAg\nICogQmFzZWQgb24KICAgICAqIHtAbGluayBvcmcuYXBhY2hlLmhlZHdpZy5h\nZG1pbi5jb25zb2xlLlJlYWRUb3BpYyNmb3JtYXRNZXNzYWdlKFB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2UpfQogICAgICoKICAgICAqIFRoaXMgaXMgdGlnaHRs\neSBjb3VwbGVkIHdpdGgKICAgICAqIEBzZWUgI2dlbmVyYXRlSk1TTWVzc2Fn\nZUlkRnJvbVNlcUlkKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2VTZXFJZCkKICAgICAqIEBwYXJhbSBtZXNzYWdl\nSWQgVGhlIG1lc3NhZ2UgaWQgdG8gY29udmVydCB0byBzdHJpbmcuCiAgICAg\nKiBAcmV0dXJuIFRoZSBzZXEtaWQKICAgICAqIEB0aHJvd3MgamF2YXguam1z\nLkpNU0V4Y2VwdGlvbiBJbiBjYXNlIG9mIGV4Y2VwdGlvbnMgZG9pbmcgdGhl\nIGNvbnZlcnNpb24uCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZVNlcUlkIGdlbmVyYXRlU2VxSWRGcm9tSk1TTWVz\nc2FnZUlkKGZpbmFsIFN0cmluZyBtZXNzYWdlSWQpCiAgICAgICAgdGhyb3dz\nIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG51bGwgPT0gbWVzc2FnZUlk\nIHx8ICFtZXNzYWdlSWQuc3RhcnRzV2l0aChKTVNfTUVTU0FHRV9JRF9QUkVG\nSVgpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24oIklu\ndmFsaWQgbWVzc2FnZUlkIHNwZWNpZmllZCAnIiArIG1lc3NhZ2VJZCArICIn\nIik7CiAgICAgICAgfQoKICAgICAgICBQdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQuQnVpbGRlciBidWlsZGVyID0gUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkLm5ld0J1aWxkZXIoKTsKICAgICAgICAvLyBsb2NhbCA/CiAgICAg\nICAgaWYgKG1lc3NhZ2VJZC5yZWdpb25NYXRjaGVzKEpNU19NRVNTQUdFX0lE\nX1BSRUZJWC5sZW5ndGgoKSwgTE9DQUxfUFJFRklYLCAwLCBMT0NBTF9QUkVG\nSVgubGVuZ3RoKCkpKXsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGxvbmcgc2VxSWQgPSBMb25nLnBhcnNlTG9uZyhtZXNzYWdlSWQuc3Vi\nc3RyaW5nKEpNU19NRVNTQUdFX0lEX1BSRUZJWC5sZW5ndGgoKSArCiAgICAg\nICAgICAgICAgICAgICAgTE9DQUxfUFJFRklYLmxlbmd0aCgpLCBtZXNzYWdl\nSWQubGVuZ3RoKCkgLSAxKSk7CiAgICAgICAgICAgICAgICBidWlsZGVyLnNl\ndExvY2FsQ29tcG9uZW50KHNlcUlkKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nTnVtYmVyRm9ybWF0RXhjZXB0aW9uIG5mRXgpewogICAgICAgICAgICAgICAg\nSk1TRXhjZXB0aW9uIGpFeCA9IG5ldyBKTVNFeGNlcHRpb24oIlVuYWJsZSB0\nbyBwYXJzZSBsb2NhbCBzZXEgaWQgZnJvbSAnIiArCiAgICAgICAgICAgICAg\nICAgICAgbWVzc2FnZUlkICsgIicgLi4gIiArIG5mRXgpOwogICAgICAgICAg\nICAgICAgakV4LnNldExpbmtlZEV4Y2VwdGlvbihuZkV4KTsKICAgICAgICAg\nICAgICAgIHRocm93IGpFeDsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBlbHNlIHsKICAgICAgICAgICAgYXNzZXJ0IG1lc3NhZ2VJZC5yZWdp\nb25NYXRjaGVzKEpNU19NRVNTQUdFX0lEX1BSRUZJWC5sZW5ndGgoKSwgUkVN\nT1RFX1BSRUZJWCwgMCwKICAgICAgICAgICAgICAgIFJFTU9URV9QUkVGSVgu\nbGVuZ3RoKCkpOwoKICAgICAgICAgICAgZmluYWwgU3RyaW5nW10gcmVtb3Rl\nUGFydHM7CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIGZpbmFsIFN0\ncmluZyByZW1vdGVNZXNzYWdlSWQgPSBtZXNzYWdlSWQuc3Vic3RyaW5nKEpN\nU19NRVNTQUdFX0lEX1BSRUZJWC5sZW5ndGgoKSArCiAgICAgICAgICAgICAg\nICAgICAgUkVNT1RFX1BSRUZJWC5sZW5ndGgoKSwgbWVzc2FnZUlkLmxlbmd0\naCgpIC0gMSk7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgZXcgc3RvcCB1\nc2luZyBwYXR0ZXJuIGFuZCBtb3ZlIHRvIHVzaW5nIGluZGV4T2YncyA/CiAg\nICAgICAgICAgICAgICByZW1vdGVQYXJ0cyA9IHJlbW90ZU1lc3NhZ2VJZFNw\nbGl0UGF0dGVybi5zcGxpdChyZW1vdGVNZXNzYWdlSWQpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBmb3IgKFN0cmluZyByZW1vdGUgOiByZW1vdGVQ\nYXJ0cyl7CiAgICAgICAgICAgICAgICBpZiAoUkVNT1RFX1JFQ09SRF9TRVFf\nSURfU1VGRklYICE9IHJlbW90ZS5jaGFyQXQocmVtb3RlLmxlbmd0aCgpIC0g\nMSkpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24o\nIkludmFsaWQgcmVtb3RlIHJlZ2lvbiBzbmlwcGV0IChubyBzZXEgc3VmZml4\nKSAnIiArCiAgICAgICAgICAgICAgICAgICAgICByZW1vdGUgKyAiJyB3aXRo\naW4gJyIgKyBtZXNzYWdlSWQpOwogICAgICAgICAgICAgICAgZmluYWwgaW50\nIHJlZ2lvbkluZHggPSByZW1vdGUuaW5kZXhPZihSRU1PVEVfUkVDT1JEX1NF\nUV9JRF9QUkVGSVgpOwogICAgICAgICAgICAgICAgaWYgKC0xID09IHJlZ2lv\nbkluZHgpCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRp\nb24oIkludmFsaWQgcmVtb3RlIHJlZ2lvbiBzbmlwcGV0IChubyByZWdpb24p\nICciICsgcmVtb3RlICsKICAgICAgICAgICAgICAgICAgICAgICInIHdpdGhp\nbiAnIiArIG1lc3NhZ2VJZCk7CiAgICAgICAgICAgICAgICBmaW5hbCBTdHJp\nbmcgcmVnaW9uID0gcmVtb3RlLnN1YnN0cmluZygwLCByZWdpb25JbmR4KTsK\nICAgICAgICAgICAgICAgIGZpbmFsIGxvbmcgc2VxSWQ7CgoKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgc2VxSWQgPSBMb25n\nLnBhcnNlTG9uZyhyZW1vdGUuc3Vic3RyaW5nKHJlZ2lvbkluZHggKyAxLCBy\nZW1vdGUubGVuZ3RoKCkgLSAxKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gbmZFeCl7CiAgICAgICAgICAgICAg\nICAgICAgSk1TRXhjZXB0aW9uIGpFeCA9IG5ldyBKTVNFeGNlcHRpb24oIlVu\nYWJsZSB0byBwYXJzZSByZW1vdGUgc2VxIGlkIGZyb20gJyIgKwogICAgICAg\nICAgICAgICAgICAgICAgICByZW1vdGUgKyAiJyB3aXRoaW4gJyIgKyBtZXNz\nYWdlSWQgKyAiJyAuLiAiICsgbmZFeCk7CiAgICAgICAgICAgICAgICAgICAg\nakV4LnNldExpbmtlZEV4Y2VwdGlvbihuZkV4KTsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBqRXg7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAg\nICAgICAgUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZC5CdWls\nZGVyIHJidWlsZGVyID0KICAgICAgICAgICAgICAgICAgICBQdWJTdWJQcm90\nb2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLm5ld0J1aWxkZXIoKTsKICAgICAg\nICAgICAgICAgIHJidWlsZGVyLnNldFJlZ2lvbihCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOChyZWdpb24pKTsKICAgICAgICAgICAgICAgIHJidWlsZGVyLnNl\ndFNlcUlkKHNlcUlkKTsKICAgICAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmVt\nb3RlQ29tcG9uZW50cyhyYnVpbGRlcik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkKCk7CiAgICB9Cgog\nICAgcHVibGljIHN0YXRpYyBNZXNzYWdlSW1wbCBjcmVhdGVDbG9uZUZvckRp\nc3BhdGNoKFNlc3Npb25JbXBsIHNlc3Npb24sIE1lc3NhZ2VJbXBsIG1zZywK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBTdHJpbmcgc291cmNlVG9waWNOYW1lLCBTdHJpbmcgc3Vic2Ny\naWJlcklkKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBNZXNzYWdl\nSW1wbCByZXR2YWwgPSBtc2cuY3JlYXRlQ2xvbmUoc2Vzc2lvbiwgc291cmNl\nVG9waWNOYW1lLCBzdWJzY3JpYmVySWQpOwogICAgICAgIHJldHZhbC5yZXNl\ndCgpOwogICAgICAgIHJldHVybiByZXR2YWw7CiAgICB9Cn0K\n","encoding":"base64"}

