{"sha":"38fccd9bd81c01c7e7883c481812739a812caf9f","node_id":"MDQ6QmxvYjE1NzU5NTY6MzhmY2NkOWJkODFjMDFjN2U3ODgzYzQ4MTgxMjczOWE4MTJjYWY5Zg==","size":7308,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/38fccd9bd81c01c7e7883c481812739a812caf9f","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5oZWR3aWcuam1zLm1lc3NhZ2UuaGVhZGVyOwoK\naW1wb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKaW1wb3J0\nIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2w7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQg\nb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQgamF2YS51dGlsLkhh\nc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwoKLyoqCiAqIERlY291cGxl\nIHJlc3Qgb2Ygc3lzdGVtIGZyb20gaGFuZGxpbmcgbWV0YWRhdGEvaGVhZGVy\ncyBpbiBoZWR3aWcuCiAqIFNpbmNlIHRoaXMgcGFydCBtaWdodCBjaGFuZ2Ug\nKGFuZCBpcyBzaGFyZWQgYWNyb3NzIHRoZSBzeXN0ZW0pLCBjaGFuZ2VzIHRv\nIGl0IHNob3VsZCBiZSBpc29sYXRlZCBmcm9tIHJlc3Qgb2YKICogam1zIHBy\nb3ZpZGVyIGFzIG11Y2ggYXMgcG9zc2libGUgc28gdGhhdCB0aGV5IGNhbiBl\ndm9sdmUgaW5kZXBlbmRlbnRseSB3aXRoIG1pbmltYWwgb3ZlcmxhcC4KICov\nCnB1YmxpYyBjbGFzcyBNZXRhZGF0YVByb2Nlc3NvciB7CgogICAgcHJpdmF0\nZSBmaW5hbCBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3Rvcnku\nZ2V0TG9nZ2VyKE1ldGFkYXRhUHJvY2Vzc29yLmNsYXNzKTsKCiAgICBwdWJs\naWMgc3RhdGljIE1hcDxTdHJpbmcsIE9iamVjdD4gcGFyc2VIZWFkZXJzKFB1\nYlN1YlByb3RvY29sLk1lc3NhZ2UgbWVzc2FnZSl7CiAgICAgICAgTWFwPFN0\ncmluZywgT2JqZWN0PiBwcm9wZXJ0aWVzID0gbmV3IEhhc2hNYXA8U3RyaW5n\nLCBPYmplY3Q+KCk7CgogICAgICAgIC8vIGlmIG5vdCBoZWFkZXIgb3IgcHJv\ncGVydGllcywgcmV0dXJuIGVtcHR5IG1hcCAuLi4KICAgICAgICBpZiAoISBt\nZXNzYWdlLmhhc0hlYWRlcigpIHx8ICEgbWVzc2FnZS5nZXRIZWFkZXIoKS5o\nYXNQcm9wZXJ0aWVzKCkpIHJldHVybiBwcm9wZXJ0aWVzOwoKICAgICAgICAv\nLyBmaXJzdCwgcG9wdWxhdGUgdGhlIG1hcCwgdGhlbiByZW1vdmUgdGhlIHN0\nYW5kYXJkIGhlYWRlcnMgZnJvbSBpdC4KICAgICAgICBmb3IgKFB1YlN1YlBy\nb3RvY29sLk1hcC5FbnRyeSBlbnRyeSA6IG1lc3NhZ2UuZ2V0SGVhZGVyKCku\nZ2V0UHJvcGVydGllcygpLmdldEVudHJpZXNMaXN0KCkpewogICAgICAgICAg\nICBmaW5hbCBKbXNIZWFkZXIuSm1zVmFsdWUgdmFsdWU7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBCeXRlU3RyaW5nIGRhdGEgPSBlbnRy\neS5nZXRWYWx1ZSgpOwogICAgICAgICAgICAgICAgdmFsdWUgPSBKbXNIZWFk\nZXIuSm1zVmFsdWUucGFyc2VGcm9tKGRhdGEpOwogICAgICAgICAgICB9IGNh\ndGNoIChJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgLy8gaW5jb3JyZWN0IHR5cGUsIHdlIGNhbnQgZG8gbXVj\naCwgaWdub3JlIGFuZCBjb250aW51ZS4KICAgICAgICAgICAgICAgIGlmIChs\nb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgbG9nZ2VyLmRlYnVnKCJDYW50IHBh\ncnNlIGhlYWRlciAiICsKICAgICAgICAgICAgICAgICAgICBlbnRyeS5nZXRL\nZXkoKSArICIgYXMgYSBqbXMgdmFsdWUsIGlnbm9yaW5nIik7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nc3dpdGNoKHZhbHVlLmdldFR5cGUoKSl7CiAgICAgICAgICAgICAgICBjYXNl\nIEJPT0xFQU46CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllcy5wdXQo\nZW50cnkuZ2V0S2V5KCksIChib29sZWFuKSB2YWx1ZS5nZXRCb29sZWFuVmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEJZVEU6CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGll\ncy5wdXQoZW50cnkuZ2V0S2V5KCksIChieXRlKSB2YWx1ZS5nZXRCeXRlVmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIFNIT1JUOgogICAgICAgICAgICAgICAgICAgIHByb3BlcnRp\nZXMucHV0KGVudHJ5LmdldEtleSgpLCAoc2hvcnQpIHZhbHVlLmdldFNob3J0\nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIElOVDoKICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0\naWVzLnB1dChlbnRyeS5nZXRLZXkoKSwgKGludCkgdmFsdWUuZ2V0SW50VmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIExPTkc6CiAgICAgICAgICAgICAgICAgICAgcHJvcGVydGll\ncy5wdXQoZW50cnkuZ2V0S2V5KCksIChsb25nKSB2YWx1ZS5nZXRMb25nVmFs\ndWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEZMT0FUOgogICAgICAgICAgICAgICAgICAgIHByb3BlcnRp\nZXMucHV0KGVudHJ5LmdldEtleSgpLCAoZmxvYXQpIHZhbHVlLmdldEZsb2F0\nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIERPVUJMRToKICAgICAgICAgICAgICAgICAgICBwcm9w\nZXJ0aWVzLnB1dChlbnRyeS5nZXRLZXkoKSwgKGRvdWJsZSkgdmFsdWUuZ2V0\nRG91YmxlVmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgICAgICBjYXNlIFNUUklORzoKICAgICAgICAgICAgICAgICAg\nICBwcm9wZXJ0aWVzLnB1dChlbnRyeS5nZXRLZXkoKSwgKFN0cmluZykgdmFs\ndWUuZ2V0U3RyaW5nVmFsdWUoKSk7CiAgICAgICAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgICAgICBjYXNlIEJZVEVTOgogICAgICAgICAgICAg\nICAgICAgIHByb3BlcnRpZXMucHV0KGVudHJ5LmdldEtleSgpLCB2YWx1ZS5n\nZXRCeXRlc1ZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICAv\nLyBmdXR1cmUgYWRkaXRpb24gbm90IHlldCBzdXBwb3J0ZWQgLi4uCiAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlVua25vd24gbWV0YWRhdGEg\na2V5IHR5cGUgIiArIHZhbHVlLmdldFR5cGUoKSArCiAgICAgICAgICAgICAg\nICAgICAgICAgICIgLi4uIHVuc3VwcG9ydGVkIGJ5IGptcyBwcm92aWRlci4g\nSWdub3JpbmciKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gcHJvcGVydGll\nczsKICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgYWRkSGVhZGVycyhQ\ndWJTdWJQcm90b2NvbC5NZXNzYWdlLkJ1aWxkZXIgYnVpbGRlciwgTWFwPFN0\ncmluZywgT2JqZWN0PiBwcm9wZXJ0aWVzKSB7CiAgICAgICAgLy8gVG9vIG1h\nbnkgYnVpbGRlci5hZGRNZXRhZGF0YSguLi4pIGNvZGUgaW4gdGhpcyBtZXRo\nb2QsIGV4dGVybmFsaXplIHRvIHRoZWlyIG93biBtZXRob2RzID8gbWF5YmUg\nbGF0ZXIgLi4uCiAgICAgICAgLy8gYWRkIHRoZSB1c2VyIHByb3BlcnRpZXMs\nIGFuZCB0aGVuIG92ZXJyaWRlIHN0YW5kYXJkIHByb3BlcnRpZXMuCgogICAg\nICAgIFB1YlN1YlByb3RvY29sLk1hcC5CdWlsZGVyIG1hcEJ1aWxkZXIgPSBQ\ndWJTdWJQcm90b2NvbC5NYXAubmV3QnVpbGRlcigpOwoKICAgICAgICBmb3Ig\nKE1hcC5FbnRyeTxTdHJpbmcsIE9iamVjdD4gZW50cnkgOiBwcm9wZXJ0aWVz\nLmVudHJ5U2V0KCkpewogICAgICAgICAgICAvLyBpZ25vcmluZywgcmlnaHQg\nPwogICAgICAgICAgICBpZiAobnVsbCA9PSBlbnRyeS5nZXRWYWx1ZSgpKSBj\nb250aW51ZTsKCiAgICAgICAgICAgIGZpbmFsIEptc0hlYWRlci5KbXNWYWx1\nZS5CdWlsZGVyIGptc1ZhbHVlQnVpbGRlciA9IEptc0hlYWRlci5KbXNWYWx1\nZS5uZXdCdWlsZGVyKCk7CgogICAgICAgICAgICBmaW5hbCBTdHJpbmcga2V5\nID0gZW50cnkuZ2V0S2V5KCk7CiAgICAgICAgICAgIGZpbmFsIE9iamVjdCB2\nYWx1ZSA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgIGlmICh2YWx1\nZSBpbnN0YW5jZW9mIEJvb2xlYW4pewogICAgICAgICAgICAgICAgam1zVmFs\ndWVCdWlsZGVyLnNldFR5cGUoSm1zSGVhZGVyLkptc1ZhbHVlLlZhbHVlVHlw\nZS5CT09MRUFOKTsKICAgICAgICAgICAgICAgIGptc1ZhbHVlQnVpbGRlci5z\nZXRCb29sZWFuVmFsdWUoKEJvb2xlYW4pIHZhbHVlKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIEJ5dGUp\newogICAgICAgICAgICAgICAgam1zVmFsdWVCdWlsZGVyLnNldFR5cGUoSm1z\nSGVhZGVyLkptc1ZhbHVlLlZhbHVlVHlwZS5CWVRFKTsKICAgICAgICAgICAg\nICAgIGptc1ZhbHVlQnVpbGRlci5zZXRCeXRlVmFsdWUoKEJ5dGUpIHZhbHVl\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSBp\nbnN0YW5jZW9mIFNob3J0KXsKICAgICAgICAgICAgICAgIGptc1ZhbHVlQnVp\nbGRlci5zZXRUeXBlKEptc0hlYWRlci5KbXNWYWx1ZS5WYWx1ZVR5cGUuU0hP\nUlQpOwogICAgICAgICAgICAgICAgam1zVmFsdWVCdWlsZGVyLnNldFNob3J0\nVmFsdWUoKFNob3J0KSB2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBJbnRlZ2VyKXsKICAgICAg\nICAgICAgICAgIGptc1ZhbHVlQnVpbGRlci5zZXRUeXBlKEptc0hlYWRlci5K\nbXNWYWx1ZS5WYWx1ZVR5cGUuSU5UKTsKICAgICAgICAgICAgICAgIGptc1Zh\nbHVlQnVpbGRlci5zZXRJbnRWYWx1ZSgoSW50ZWdlcikgdmFsdWUpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHZhbHVlIGluc3RhbmNl\nb2YgTG9uZyl7CiAgICAgICAgICAgICAgICBqbXNWYWx1ZUJ1aWxkZXIuc2V0\nVHlwZShKbXNIZWFkZXIuSm1zVmFsdWUuVmFsdWVUeXBlLkxPTkcpOwogICAg\nICAgICAgICAgICAgam1zVmFsdWVCdWlsZGVyLnNldExvbmdWYWx1ZSgoTG9u\nZykgdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYg\nKHZhbHVlIGluc3RhbmNlb2YgRmxvYXQpewogICAgICAgICAgICAgICAgam1z\nVmFsdWVCdWlsZGVyLnNldFR5cGUoSm1zSGVhZGVyLkptc1ZhbHVlLlZhbHVl\nVHlwZS5GTE9BVCk7CiAgICAgICAgICAgICAgICBqbXNWYWx1ZUJ1aWxkZXIu\nc2V0RmxvYXRWYWx1ZSgoRmxvYXQpIHZhbHVlKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIERvdWJsZSl7\nCiAgICAgICAgICAgICAgICBqbXNWYWx1ZUJ1aWxkZXIuc2V0VHlwZShKbXNI\nZWFkZXIuSm1zVmFsdWUuVmFsdWVUeXBlLkRPVUJMRSk7CiAgICAgICAgICAg\nICAgICBqbXNWYWx1ZUJ1aWxkZXIuc2V0RG91YmxlVmFsdWUoKERvdWJsZSkg\ndmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgaWYgKHZh\nbHVlIGluc3RhbmNlb2YgU3RyaW5nKXsKICAgICAgICAgICAgICAgIGptc1Zh\nbHVlQnVpbGRlci5zZXRUeXBlKEptc0hlYWRlci5KbXNWYWx1ZS5WYWx1ZVR5\ncGUuU1RSSU5HKTsKICAgICAgICAgICAgICAgIGptc1ZhbHVlQnVpbGRlci5z\nZXRTdHJpbmdWYWx1ZSgoU3RyaW5nKSB2YWx1ZSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgZWxzZSBpZiAodmFsdWUgaW5zdGFuY2VvZiBieXRlW10p\newogICAgICAgICAgICAgICAgam1zVmFsdWVCdWlsZGVyLnNldFR5cGUoSm1z\nSGVhZGVyLkptc1ZhbHVlLlZhbHVlVHlwZS5CWVRFUyk7CiAgICAgICAgICAg\nICAgICBqbXNWYWx1ZUJ1aWxkZXIuc2V0Qnl0ZXNWYWx1ZShCeXRlU3RyaW5n\nLmNvcHlGcm9tKChieXRlW10pIHZhbHVlKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCJVbmtub3duIHByb3BlcnR5IHZhbHVl\nIHR5cGUgPyAiICsgZW50cnkpOwogICAgICAgICAgICB9CgoKICAgICAgICAg\nICAgUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5LkJ1aWxkZXIgZW50cnlCdWls\nZGVyID0gUHViU3ViUHJvdG9jb2wuTWFwLkVudHJ5Lm5ld0J1aWxkZXIoKTsK\nICAgICAgICAgICAgZW50cnlCdWlsZGVyLnNldEtleShrZXkpOwogICAgICAg\nICAgICBlbnRyeUJ1aWxkZXIuc2V0VmFsdWUoam1zVmFsdWVCdWlsZGVyLmJ1\naWxkKCkudG9CeXRlU3RyaW5nKCkpOwoKICAgICAgICAgICAgbWFwQnVpbGRl\nci5hZGRFbnRyaWVzKGVudHJ5QnVpbGRlci5idWlsZCgpKTsKICAgICAgICB9\nCgogICAgICAgIFB1YlN1YlByb3RvY29sLk1lc3NhZ2VIZWFkZXIuQnVpbGRl\nciBtZXNzYWdlSGVhZGVyQnVpbGRlciA9IFB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VIZWFkZXIubmV3QnVpbGRlcigpOwogICAgICAgIG1lc3NhZ2VIZWFkZXJC\ndWlsZGVyLnNldFByb3BlcnRpZXMobWFwQnVpbGRlci5idWlsZCgpKTsKCiAg\nICAgICAgYnVpbGRlci5zZXRIZWFkZXIobWVzc2FnZUhlYWRlckJ1aWxkZXIu\nYnVpbGQoKSk7CiAgICB9Cn0K\n","encoding":"base64"}

