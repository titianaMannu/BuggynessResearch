{"sha":"83df4f100114a3f1372ac62d6645312ef29c2f40","node_id":"MDQ6QmxvYjE1NzU5NTY6ODNkZjRmMTAwMTE0YTNmMTM3MmFjNjJkNjY0NTMxMmVmMjljMmY0MA==","size":20487,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/83df4f100114a3f1372ac62d6645312ef29c2f40","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuc2VsZWN0b3I7CgppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuam1zLm1lc3NhZ2UuTWVzc2FnZUltcGw7Cgpp\nbXBvcnQgamF2YS51dGlsLnJlZ2V4LlBhdHRlcm47CmltcG9ydCBqYXZhLnV0\naWwucmVnZXguUGF0dGVyblN5bnRheEV4Y2VwdGlvbjsKCi8qKgogKiBIYW5k\nbGVzIHByb3BlcnR5IChhbmQgaGVhZGVyKSBkZXJlZmVyZW5jZSBhZ2FpbnN0\nIG1lc3NhZ2UgZXZhbHVhdGlvbiAoYmFzZWQgb24gaWRlbnRpZmllciBzcGVj\naWZpZWQpLgogKi8KcHVibGljIGFic3RyYWN0IGNsYXNzIFByb3BlcnR5RXhw\nckZ1bmN0aW9uIGltcGxlbWVudHMgRXhwckZ1bmN0aW9uIHsKCiAgICBwdWJs\naWMgc3RhdGljIGNsYXNzIExvb2t1cEV4cHIgZXh0ZW5kcyBQcm9wZXJ0eUV4\ncHJGdW5jdGlvbiB7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgaWRl\nbnRpZmllcjsKCiAgICAgICAgcHVibGljIExvb2t1cEV4cHIoU3RyaW5nIGlk\nZW50aWZpZXIpIHsKICAgICAgICAgICAgdGhpcy5pZGVudGlmaWVyID0gaWRl\nbnRpZmllcjsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAg\nIHB1YmxpYyB2b2lkIGV2YWx1YXRlKFNlbGVjdG9yRXZhbFN0YXRlIHN0YXRl\nKSB0aHJvd3MgU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgLy8gTm8gKHN0YWNrKSBwYXJhbXMgcmVxdWlyZWQgLi4uCgogICAg\nICAgICAgICBTZWxlY3RvckNvbnN0YW50IHJlc3VsdCA9IGRvRXZhbHVhdGUo\nc3RhdGUuZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgaWYgKE15Tm9kZS5s\nb2dnZXIuaXNUcmFjZUVuYWJsZWQoKSkgTXlOb2RlLmxvZ2dlci50cmFjZShn\nZXRDbGFzcygpICsgIjogaWRlbnRpZmllciAnIiArCiAgICAgICAgICAgICAg\nICBpZGVudGlmaWVyICsgIicgLT4gIiArIHJlc3VsdCk7CiAgICAgICAgICAg\nIHN0YXRlLmdldFN0YWNrKCkucHVzaChyZXN1bHQpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIFNlbGVjdG9yQ29u\nc3RhbnQgZG9FdmFsdWF0ZShmaW5hbCBNZXNzYWdlSW1wbCBtZXNzYWdlKSB0\naHJvd3MgU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9uIHsKCgogICAgICAg\nICAgICBpZiAoIW1lc3NhZ2UucHJvcGVydHlFeGlzdHMoaWRlbnRpZmllcikp\nIHsKICAgICAgICAgICAgICAgIC8vIGRlZmF1bHRpbmcgdG8gU3RyaW5nLCBk\nb2VzIGl0IG1hdHRlciA/CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNl\nbGVjdG9yQ29uc3RhbnQoKFN0cmluZykgbnVsbCk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGZpbmFsIE9iamVjdCB2YWwgPSBtZXNzYWdlLmdldFNl\nbGVjdG9yUHJvY2Vzc2luZ1Byb3BlcnR5VmFsdWUoaWRlbnRpZmllcik7Cgog\nICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgQnl0ZSkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RvckNvbnN0YW50KChpbnQpIChC\neXRlKSB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh2YWwg\naW5zdGFuY2VvZiBTaG9ydCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBTZWxlY3RvckNvbnN0YW50KChpbnQpIChTaG9ydCkgdmFsKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgSW50ZWdl\ncikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RvckNvbnN0\nYW50KChJbnRlZ2VyKSB2YWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGlmICh2YWwgaW5zdGFuY2VvZiBMb25nKSB7CiAgICAgICAgICAgICAgICBs\nb25nIGx2YWwgPSAoTG9uZykgdmFsOwogICAgICAgICAgICAgICAgaWYgKGx2\nYWwgPj0gKGxvbmcpIEludGVnZXIuTUFYX1ZBTFVFIHx8IGx2YWwgPD0gKGxv\nbmcpIEludGVnZXIuTUlOX1ZBTFVFKQogICAgICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBTZWxlY3RvckV2YWx1YXRpb25FeGNlcHRpb24oZ2V0Q2xhc3Mo\nKSArICIgbG9uZyB2YWx1ZSAiICsgbHZhbCArCiAgICAgICAgICAgICAgICAg\nICAgICAgICIgb3V0IG9mIHJhbmdlIGZvciBhbiBpbnQiKTsKCiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IFNlbGVjdG9yQ29uc3RhbnQoKGludCkgbHZh\nbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5j\nZW9mIEJvb2xlYW4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgU2Vs\nZWN0b3JDb25zdGFudCgoQm9vbGVhbikgdmFsKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpZiAodmFsIGluc3RhbmNlb2YgRmxvYXQpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBuZXcgU2VsZWN0b3JDb25zdGFudCgoZG91Ymxl\nKSAoRmxvYXQpIHZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKHZhbCBpbnN0YW5jZW9mIERvdWJsZSkgewogICAgICAgICAgICAgICAgcmV0\ndXJuIG5ldyBTZWxlY3RvckNvbnN0YW50KChEb3VibGUpIHZhbCk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIFN0cmlu\nZykgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RvckNvbnN0\nYW50KChTdHJpbmcpIHZhbCk7CiAgICAgICAgICAgIH0KCgogICAgICAgICAg\nICB0aHJvdyBuZXcgU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9uKGdldENs\nYXNzKCkgKyAiIFVuYWJsZSB0byBpbnRlcnByZXQgdmFsdWUgJyIgKyB2YWwg\nKwogICAgICAgICAgICAgICAgIicgZm9yIGlkZW50aWZpZXIgIiArIGlkZW50\naWZpZXIpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgZmluYWwg\nU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAg\nICAgICAgIHNiLmFwcGVuZCgiTG9va3VwRXhwciIpOwogICAgICAgICAgICBz\nYi5hcHBlbmQoIntpZGVudGlmaWVyPSciKS5hcHBlbmQoaWRlbnRpZmllciku\nYXBwZW5kKCdcJycpOwogICAgICAgICAgICBzYi5hcHBlbmQoJ30nKTsKICAg\nICAgICAgICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgSXNOdWxsRXhwciBleHRlbmRz\nIFByb3BlcnR5RXhwckZ1bmN0aW9uIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBib29sZWFuIG5lZ2F0ZTsKCiAgICAgICAgcHVibGljIElzTnVsbEV4cHIo\nYm9vbGVhbiBuZWdhdGUpIHsKICAgICAgICAgICAgdGhpcy5uZWdhdGUgPSBu\nZWdhdGU7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgdm9pZCBldmFsdWF0ZShTZWxlY3RvckV2YWxTdGF0ZSBzdGF0ZSkg\ndGhyb3dzIFNlbGVjdG9yRXZhbHVhdGlvbkV4Y2VwdGlvbiB7CgogICAgICAg\nICAgICBmaW5hbCBTZWxlY3RvckNvbnN0YW50IHJlc3VsdCA9IGRvRXZhbHVh\ndGUoc3RhdGUpOwogICAgICAgICAgICBpZiAoTXlOb2RlLmxvZ2dlci5pc1Ry\nYWNlRW5hYmxlZCgpKSBNeU5vZGUubG9nZ2VyLnRyYWNlKGdldENsYXNzKCkg\nKyAiIC0+ICIgKyByZXN1bHQpOwogICAgICAgICAgICBzdGF0ZS5nZXRTdGFj\naygpLnB1c2gocmVzdWx0KTsKICAgICAgICB9CgogICAgICAgIHByaXZhdGUg\nU2VsZWN0b3JDb25zdGFudCBkb0V2YWx1YXRlKFNlbGVjdG9yRXZhbFN0YXRl\nIHN0YXRlKSB0aHJvd3MgU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9uIHsK\nCiAgICAgICAgICAgIGlmIChzdGF0ZS5nZXRTdGFjaygpLmlzRW1wdHkoKSkK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBTZWxlY3RvckV2YWx1YXRpb25F\neGNlcHRpb24oZ2V0Q2xhc3MoKSArICIgc3RhY2sgY29ycnVwdGlvbiA/ICIg\nKyBzdGF0ZS5nZXRTdGFjaygpKTsKCiAgICAgICAgICAgIGZpbmFsIFNlbGVj\ndG9yQ29uc3RhbnQgdmFsdWUgPSBzdGF0ZS5nZXRTdGFjaygpLnBvcCgpOwoK\nICAgICAgICAgICAgYm9vbGVhbiByZXN1bHQgPSB2YWx1ZS5pc051bGwoKTsK\nICAgICAgICAgICAgaWYgKG5lZ2F0ZSkgcmVzdWx0ID0gIXJlc3VsdDsKICAg\nICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RvckNvbnN0YW50KHJlc3VsdCk7\nCiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMg\nU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICBmaW5hbCBTdHJpbmdC\ndWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAg\nc2IuYXBwZW5kKCJJc051bGxFeHByIik7CiAgICAgICAgICAgIHNiLmFwcGVu\nZCgie25lZ2F0ZT0iKS5hcHBlbmQobmVnYXRlKTsKICAgICAgICAgICAgc2Iu\nYXBwZW5kKCd9Jyk7CiAgICAgICAgICAgIHJldHVybiBzYi50b1N0cmluZygp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIElu\nRXhwciBleHRlbmRzIFByb3BlcnR5RXhwckZ1bmN0aW9uIHsKCiAgICAgICAg\ncHJpdmF0ZSBmaW5hbCBib29sZWFuIG5lZ2F0ZTsKCiAgICAgICAgcHVibGlj\nIEluRXhwcihib29sZWFuIG5lZ2F0ZSkgewogICAgICAgICAgICB0aGlzLm5l\nZ2F0ZSA9IG5lZ2F0ZTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIGV2YWx1YXRlKFNlbGVjdG9yRXZhbFN0YXRl\nIHN0YXRlKSB0aHJvd3MgU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgaWYgKHN0YXRlLmdldFN0YWNrKCkuc2l6ZSgpIDwgMikK\nICAgICAgICAgICAgICAgIHRocm93IG5ldyBTZWxlY3RvckV2YWx1YXRpb25F\neGNlcHRpb24oZ2V0Q2xhc3MoKSArICIgc3RhY2sgY29ycnVwdGlvbiA/ICIg\nKyBzdGF0ZS5nZXRTdGFjaygpKTsKCiAgICAgICAgICAgIGZpbmFsIFNlbGVj\ndG9yQ29uc3RhbnQgcGFyYW1TZXQgPSBzdGF0ZS5nZXRTdGFjaygpLnBvcCgp\nOwogICAgICAgICAgICBmaW5hbCBTZWxlY3RvckNvbnN0YW50IGNoZWNrRm9y\nID0gc3RhdGUuZ2V0U3RhY2soKS5wb3AoKTsKCiAgICAgICAgICAgIGZpbmFs\nIFNlbGVjdG9yQ29uc3RhbnQgcmVzdWx0ID0gZG9FdmFsdWF0ZShwYXJhbVNl\ndCwgY2hlY2tGb3IpOwogICAgICAgICAgICBpZiAoTXlOb2RlLmxvZ2dlci5p\nc1RyYWNlRW5hYmxlZCgpKSBNeU5vZGUubG9nZ2VyLnRyYWNlKGdldENsYXNz\nKCkgKyAiOiBjaGVja0ZvciAnIiArCiAgICAgICAgICAgICAgICBjaGVja0Zv\nciArICInLCBwYXJhbVNldCAnIiArIHBhcmFtU2V0KyAiJyAtPiAiICsgcmVz\ndWx0KTsKCiAgICAgICAgICAgIHN0YXRlLmdldFN0YWNrKCkucHVzaChyZXN1\nbHQpOwogICAgICAgICAgICByZXR1cm4gOwoKICAgICAgICB9CgogICAgICAg\nIHByaXZhdGUgU2VsZWN0b3JDb25zdGFudCBkb0V2YWx1YXRlKFNlbGVjdG9y\nQ29uc3RhbnQgcGFyYW1TZXQsIFNlbGVjdG9yQ29uc3RhbnQgY2hlY2tGb3Ip\nCiAgICAgICAgICAgIHRocm93cyBTZWxlY3RvckV2YWx1YXRpb25FeGNlcHRp\nb24gewoKICAgICAgICAgICAgaWYgKGNoZWNrRm9yLmlzTnVsbCgpKXsKICAg\nICAgICAgICAgICAgIHJldHVybiBuZXcgU2VsZWN0b3JDb25zdGFudCgoU3Ry\naW5nKSBudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKFNl\nbGVjdG9yQ29uc3RhbnQuU2VsZWN0b3JEYXRhVHlwZS5TVFJJTkdfU0VUICE9\nIHBhcmFtU2V0LnR5cGUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBT\nZWxlY3RvckV2YWx1YXRpb25FeGNlcHRpb24oZ2V0Q2xhc3MoKSArICIgRXhw\nZWN0ZWQgc3RyaW5nIGxpc3QsIGZvdW5kIDogIiArCiAgICAgICAgICAgICAg\nICAgICAgcGFyYW1TZXQudHlwZSArICIsIGZvciAiICsgcGFyYW1TZXQpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChTZWxlY3RvckNvbnN0YW50\nLlNlbGVjdG9yRGF0YVR5cGUuU1RSSU5HICE9IGNoZWNrRm9yLnR5cGUpewog\nICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNlbGVjdG9yRXZhbHVhdGlvbkV4\nY2VwdGlvbihnZXRDbGFzcygpICsgIiBFeHBlY3RlZCBzdHJpbmcgLCBmb3Vu\nZCA6ICIgKwogICAgICAgICAgICAgICAgICAgIGNoZWNrRm9yLnR5cGUgKyAi\nLCBmb3IgIiArIGNoZWNrRm9yKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgYm9vbGVhbiByZXN1bHQgPSBwYXJhbVNldC5nZXRTdHJpbmdTZXQoKS5j\nb250YWlucyhjaGVja0Zvci5nZXRTdHJpbmdWYWx1ZSgpKTsKICAgICAgICAg\nICAgaWYgKG5lZ2F0ZSkgcmVzdWx0ID0gIXJlc3VsdDsKICAgICAgICAgICAg\ncmV0dXJuIG5ldyBTZWxlY3RvckNvbnN0YW50KHJlc3VsdCk7CiAgICAgICAg\nfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgU3RyaW5nIHRv\nU3RyaW5nKCkgewogICAgICAgICAgICBmaW5hbCBTdHJpbmdCdWlsZGVyIHNi\nID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgc2IuYXBwZW5k\nKCJJbkV4cHIiKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCJ7bmVnYXRlPSIp\nLmFwcGVuZChuZWdhdGUpOwogICAgICAgICAgICBzYi5hcHBlbmQoJ30nKTsK\nICAgICAgICAgICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgY2xhc3MgTGlrZUV4cHIgZXh0ZW5k\ncyBQcm9wZXJ0eUV4cHJGdW5jdGlvbiB7CgogICAgICAgIHByaXZhdGUgZmlu\nYWwgUGF0dGVybiBsaWtlUGF0dGVybjsKICAgICAgICBwcml2YXRlIGZpbmFs\nIFN0cmluZyBsaWtlUGF0dGVyblN0cjsKICAgICAgICBwcml2YXRlIGZpbmFs\nIGJvb2xlYW4gbmVnYXRlOwoKICAgICAgICBwdWJsaWMgTGlrZUV4cHIoU3Ry\naW5nIGxpa2VFeHByZXNzaW9uLCBTdHJpbmcgZXNjYXBlQ2hhcmFjdGVyLCBi\nb29sZWFuIG5lZ2F0ZSkgdGhyb3dzIFBhcnNlRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgaWYgKG51bGwgIT0gZXNjYXBlQ2hhcmFjdGVyICYmIDEgIT0gZXNj\nYXBlQ2hhcmFjdGVyLmxlbmd0aCgpKSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgUGFyc2VFeGNlcHRpb24oZ2V0Q2xhc3MoKSArICIgRXNjYXBlIGNo\nYXJhY3RlciBtdXN0IGJlIGEgc2luZ2xlIGNoYXJhY3RlciA6ICciICsKICAg\nICAgICAgICAgICAgICAgICBlc2NhcGVDaGFyYWN0ZXIgKyAiJyIpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHRoaXMubGlrZVBhdHRlcm5TdHIgPSBn\nZW5lcmF0ZVJlZ2V4cFBhdHRlcm4obGlrZUV4cHJlc3Npb24sIGVzY2FwZUNo\nYXJhY3Rlcik7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0\naGlzLmxpa2VQYXR0ZXJuID0gUGF0dGVybi5jb21waWxlKHRoaXMubGlrZVBh\ndHRlcm5TdHIsIFBhdHRlcm4uRE9UQUxMKTsKICAgICAgICAgICAgfSBjYXRj\naCAoUGF0dGVyblN5bnRheEV4Y2VwdGlvbiBwc0V4KXsKICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBQYXJzZUV4Y2VwdGlvbihMaWtlRXhwci5jbGFzcyAr\nICIgVW5hYmxlIHRvIGNvbXBpbGUgJyIgKyBsaWtlRXhwcmVzc2lvbiArCiAg\nICAgICAgICAgICAgICAgICAgIicgaW50byByZWdleHAgUGF0dGVybiB1c2lu\nZyAnIiArIHRoaXMubGlrZVBhdHRlcm5TdHIrICInIik7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgdGhpcy5uZWdhdGUgPSBuZWdhdGU7CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgZ2VuZXJhdGVSZWdl\neHBXaXRob3V0V2lsZGNhcmQoZmluYWwgU3RyaW5nIGV4cHJlc3Npb24pewog\nICAgICAgICAgICBpbnQgaW5keE9mZnNldCA9IDA7CiAgICAgICAgICAgIGlu\ndCBzdWJzdHJpbmdPZmZzZXQgPSAwOwogICAgICAgICAgICBTdHJpbmdCdWls\nZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgd2hp\nbGUgKGluZHhPZmZzZXQgPCBleHByZXNzaW9uLmxlbmd0aCgpKXsKICAgICAg\nICAgICAgICAgIGZpbmFsIGludCBpbmR4VW5kZXIgPSBleHByZXNzaW9uLmlu\nZGV4T2YoJ18nLCBpbmR4T2Zmc2V0KTsKICAgICAgICAgICAgICAgIGZpbmFs\nIGludCBpbmR4TW9kID0gZXhwcmVzc2lvbi5pbmRleE9mKCclJywgaW5keE9m\nZnNldCk7CiAgICAgICAgICAgICAgICBpZiAoLTEgPT0gaW5keFVuZGVyICYm\nIC0xID09IGluZHhNb2QpIGJyZWFrOwoKICAgICAgICAgICAgICAgIGZpbmFs\nIGludCBpbmR4OwoKICAgICAgICAgICAgICAgIGlmICgtMSAhPSBpbmR4VW5k\nZXIgJiYgLTEgIT0gaW5keE1vZCkgaW5keCA9IE1hdGgubWluKGluZHhVbmRl\nciwgaW5keE1vZCk7CiAgICAgICAgICAgICAgICBlbHNlIGlmICgtMSAhPSBp\nbmR4VW5kZXIpIGluZHggPSBpbmR4VW5kZXI7CiAgICAgICAgICAgICAgICBl\nbHNlIGluZHggPSBpbmR4TW9kOwoKICAgICAgICAgICAgICAgIGlmIChpbmR4\nICE9IHN1YnN0cmluZ09mZnNldCkgewogICAgICAgICAgICAgICAgICAgIHNi\nLmFwcGVuZChQYXR0ZXJuLnF1b3RlKGV4cHJlc3Npb24uc3Vic3RyaW5nKHN1\nYnN0cmluZ09mZnNldCwgaW5keCkpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHNiLmFwcGVuZChpbmR4ID09IGluZHhVbmRlciA/ICIu\nIiA6ICIuKiIpOwogICAgICAgICAgICAgICAgc3Vic3RyaW5nT2Zmc2V0ID0g\naW5keCArIDE7CiAgICAgICAgICAgICAgICBpbmR4T2Zmc2V0ID0gaW5keCAr\nIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGV4cHJlc3Npb24u\nbGVuZ3RoKCkgIT0gc3Vic3RyaW5nT2Zmc2V0KSB7CiAgICAgICAgICAgICAg\nICBzYi5hcHBlbmQoUGF0dGVybi5xdW90ZShleHByZXNzaW9uLnN1YnN0cmlu\nZyhzdWJzdHJpbmdPZmZzZXQpKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHJldHVybiBzYi50b1N0cmluZygpOwogICAgICAgIH0KCiAgICAgICAg\nLy8gSWYgd2lsZGNhcmQgaWYgcHJlZml4ZWQgd2l0aCBlc2NhcGVDaGFyLCBp\nZ25vcmUgaXQuCiAgICAgICAgcHJpdmF0ZSBzdGF0aWMgU3RyaW5nIGdlbmVy\nYXRlUmVnZXhwV2l0aFdpbGRjYXJkKGZpbmFsIFN0cmluZyBleHByZXNzaW9u\nLCBjaGFyIGVzY2FwZUNoYXIpewogICAgICAgICAgICBpbnQgaW5keE9mZnNl\ndCA9IDA7CiAgICAgICAgICAgIGludCBzdWJzdHJpbmdPZmZzZXQgPSAwOwog\nICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKTsKICAgICAgICAgICAgd2hpbGUgKGluZHhPZmZzZXQgPCBleHByZXNz\naW9uLmxlbmd0aCgpKXsKICAgICAgICAgICAgICAgIGZpbmFsIGludCBpbmR4\nVW5kZXIgPSBleHByZXNzaW9uLmluZGV4T2YoJ18nLCBpbmR4T2Zmc2V0KTsK\nICAgICAgICAgICAgICAgIGZpbmFsIGludCBpbmR4TW9kID0gZXhwcmVzc2lv\nbi5pbmRleE9mKCclJywgaW5keE9mZnNldCk7CiAgICAgICAgICAgICAgICBp\nZiAoLTEgPT0gaW5keFVuZGVyICYmIC0xID09IGluZHhNb2QpIGJyZWFrOwoK\nICAgICAgICAgICAgICAgIGZpbmFsIGludCBpbmR4OwoKICAgICAgICAgICAg\nICAgIGlmICgtMSAhPSBpbmR4VW5kZXIgJiYgLTEgIT0gaW5keE1vZCkgaW5k\neCA9IE1hdGgubWluKGluZHhVbmRlciwgaW5keE1vZCk7CiAgICAgICAgICAg\nICAgICBlbHNlIGlmICgtMSAhPSBpbmR4VW5kZXIpIGluZHggPSBpbmR4VW5k\nZXI7CiAgICAgICAgICAgICAgICBlbHNlIGluZHggPSBpbmR4TW9kOwoKICAg\nICAgICAgICAgICAgIGlmIChpbmR4ID4gMCAmJiBlc2NhcGVDaGFyID09IGV4\ncHJlc3Npb24uY2hhckF0KGluZHggLSAxKSkgewogICAgICAgICAgICAgICAg\nICAgIC8vIGlnbm9yZSBpdC4KICAgICAgICAgICAgICAgICAgICBpbmR4T2Zm\nc2V0ID0gaW5keCArIDE7CiAgICAgICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGluZHgg\nIT0gc3Vic3RyaW5nT2Zmc2V0KSB7CiAgICAgICAgICAgICAgICAgICAgc2Iu\nYXBwZW5kKFBhdHRlcm4ucXVvdGUoZXhwcmVzc2lvbi5zdWJzdHJpbmcoc3Vi\nc3RyaW5nT2Zmc2V0LCBpbmR4KSkpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgc2IuYXBwZW5kKGluZHggPT0gaW5keFVuZGVyID8gIi4i\nIDogIi4qIik7CiAgICAgICAgICAgICAgICBzdWJzdHJpbmdPZmZzZXQgPSBp\nbmR4ICsgMTsKICAgICAgICAgICAgICAgIGluZHhPZmZzZXQgPSBpbmR4ICsg\nMTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZXhwcmVzc2lvbi5s\nZW5ndGgoKSAhPSBzdWJzdHJpbmdPZmZzZXQpIHsKICAgICAgICAgICAgICAg\nIHNiLmFwcGVuZChQYXR0ZXJuLnF1b3RlKGV4cHJlc3Npb24uc3Vic3RyaW5n\nKHN1YnN0cmluZ09mZnNldCkpKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICAgICAgfQoKICAgICAgICBw\ncml2YXRlIHN0YXRpYyBTdHJpbmcgZ2VuZXJhdGVSZWdleHBQYXR0ZXJuKGZp\nbmFsIFN0cmluZyBsaWtlRXhwcmVzc2lvbiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIFN0cmlu\nZyBlc2NhcGVDaGFyYWN0ZXJTdHIpIHRocm93cyBQYXJzZUV4Y2VwdGlvbiB7\nCgogICAgICAgICAgICBpZiAobnVsbCA9PSBlc2NhcGVDaGFyYWN0ZXJTdHIp\newogICAgICAgICAgICAgICAgLy8gT2ssIGhhbmQtZ2VuZXJhdGluZyB0aGUg\ncGF0dGVybiBzZWVtcyB0byBiZSB0aGUgb25seSBnZW5lcmljIHdheSB0byBo\nYW5kbGUgdGhpcywgc2lnaCA6LSgKCiAgICAgICAgICAgICAgICBTdHJpbmcg\ncnBhdCA9IGdlbmVyYXRlUmVnZXhwV2l0aG91dFdpbGRjYXJkKGxpa2VFeHBy\nZXNzaW9uKTsKICAgICAgICAgICAgICAgIHJldHVybiBycGF0OwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBleHBlY3QgdGhpcyB0byBiZSB0aGVy\nZSAuLi4KICAgICAgICAgICAgZmluYWwgY2hhciBlc2NhcGVDaGFyID0gZXNj\nYXBlQ2hhcmFjdGVyU3RyLmNoYXJBdCgwKTsKCiAgICAgICAgICAgIC8vIFRl\nc3Qgd2hlbiBlc2NhcGVDaGFyID09ICddJywgJ1snIGFuZCAnXicuIGRvbmUg\nIQogICAgICAgICAgICBTdHJpbmcgcnBhdCA9IGdlbmVyYXRlUmVnZXhwV2l0\naFdpbGRjYXJkKGxpa2VFeHByZXNzaW9uLCBlc2NhcGVDaGFyKTsKCiAgICAg\nICAgICAgIHJwYXQgPSBycGF0LnJlcGxhY2UoZXNjYXBlQ2hhciArICIlIiwg\nIiUiKTsKICAgICAgICAgICAgcnBhdCA9IHJwYXQucmVwbGFjZShlc2NhcGVD\naGFyICsgIl8iLCAiXyIpOwoKICAgICAgICAgICAgcmV0dXJuIHJwYXQ7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9p\nZCBldmFsdWF0ZShTZWxlY3RvckV2YWxTdGF0ZSBzdGF0ZSkgdGhyb3dzIFNl\nbGVjdG9yRXZhbHVhdGlvbkV4Y2VwdGlvbiB7CgogICAgICAgICAgICBpZiAo\nc3RhdGUuZ2V0U3RhY2soKS5pc0VtcHR5KCkpIHRocm93IG5ldyBTZWxlY3Rv\nckV2YWx1YXRpb25FeGNlcHRpb24oZ2V0Q2xhc3MoKSArCiAgICAgICAgICAg\nICAgICAiIHN0YWNrIGNvcnJ1cHRpb24gPyAiICsgc3RhdGUuZ2V0U3RhY2so\nKSk7CgogICAgICAgICAgICBmaW5hbCBTZWxlY3RvckNvbnN0YW50IGNoZWNr\nRm9yID0gc3RhdGUuZ2V0U3RhY2soKS5wb3AoKTsKCiAgICAgICAgICAgIGZp\nbmFsIFNlbGVjdG9yQ29uc3RhbnQgcmVzdWx0ID0gZG9FdmFsdWF0ZShjaGVj\na0Zvcik7CiAgICAgICAgICAgIGlmIChNeU5vZGUubG9nZ2VyLmlzVHJhY2VF\nbmFibGVkKCkpIE15Tm9kZS5sb2dnZXIudHJhY2UoZ2V0Q2xhc3MoKSArICI6\nIGNoZWNrRm9yICciICsKICAgICAgICAgICAgICAgIGNoZWNrRm9yICsgIicg\nLT4gIiArIHJlc3VsdCk7CgogICAgICAgICAgICBzdGF0ZS5nZXRTdGFjaygp\nLnB1c2gocmVzdWx0KTsKICAgICAgICAgICAgcmV0dXJuIDsKICAgICAgICB9\nCgogICAgICAgIHByaXZhdGUgU2VsZWN0b3JDb25zdGFudCBkb0V2YWx1YXRl\nKFNlbGVjdG9yQ29uc3RhbnQgY2hlY2tGb3IpIHRocm93cyBTZWxlY3RvckV2\nYWx1YXRpb25FeGNlcHRpb24gewogICAgICAgICAgICBpZiAoY2hlY2tGb3Iu\naXNOdWxsKCkpewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3Rv\nckNvbnN0YW50KChTdHJpbmcpIG51bGwpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBpZiAoU2VsZWN0b3JDb25zdGFudC5TZWxlY3RvckRhdGFUeXBl\nLlNUUklORyAhPSBjaGVja0Zvci50eXBlKXsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBTZWxlY3RvckV2YWx1YXRpb25FeGNlcHRpb24oZ2V0Q2xhc3Mo\nKSArICIgRXhwZWN0ZWQgc3RyaW5nICwgZm91bmQgOiAiICsKICAgICAgICAg\nICAgICAgICAgICBjaGVja0Zvci50eXBlICsgIiwgZm9yICIgKyBjaGVja0Zv\ncik7CiAgICAgICAgICAgIH0KCgogICAgICAgICAgICBmaW5hbCBTdHJpbmcg\ndmFsdWUgPSBjaGVja0Zvci5nZXRTdHJpbmdWYWx1ZSgpOwoKICAgICAgICAg\nICAgaWYgKG51bGwgPT0gdmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVy\nbiBuZXcgU2VsZWN0b3JDb25zdGFudCgoQm9vbGVhbikgbnVsbCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGJvb2xlYW4gcmVzdWx0ID0gbGlrZVBh\ndHRlcm4ubWF0Y2hlcih2YWx1ZSkubWF0Y2hlcygpOwogICAgICAgICAgICBp\nZiAobmVnYXRlKSByZXN1bHQgPSAhcmVzdWx0OwogICAgICAgICAgICByZXR1\ncm4gbmV3IFNlbGVjdG9yQ29uc3RhbnQocmVzdWx0KTsKICAgICAgICB9Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJp\nbmcoKSB7CiAgICAgICAgICAgIGZpbmFsIFN0cmluZ0J1aWxkZXIgc2IgPSBu\nZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgICAgICBzYi5hcHBlbmQoIkxp\na2VFeHByIik7CiAgICAgICAgICAgIHNiLmFwcGVuZCgie2xpa2VQYXR0ZXJu\nU3RyPSIpLmFwcGVuZChsaWtlUGF0dGVyblN0cik7CiAgICAgICAgICAgIHNi\nLmFwcGVuZCgiLCBuZWdhdGU9IikuYXBwZW5kKG5lZ2F0ZSk7CiAgICAgICAg\nICAgIHNiLmFwcGVuZCgnfScpOwogICAgICAgICAgICByZXR1cm4gc2IudG9T\ndHJpbmcoKTsKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBj\nbGFzcyBCZXR3ZWVuRXhwciBleHRlbmRzIFByb3BlcnR5RXhwckZ1bmN0aW9u\nIHsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBib29sZWFuIG5lZ2F0ZTsKCiAg\nICAgICAgcHVibGljIEJldHdlZW5FeHByKGJvb2xlYW4gbmVnYXRlKSB7CiAg\nICAgICAgICAgIHRoaXMubmVnYXRlID0gbmVnYXRlOwogICAgICAgIH0KCiAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgZXZhbHVhdGUo\nU2VsZWN0b3JFdmFsU3RhdGUgc3RhdGUpIHRocm93cyBTZWxlY3RvckV2YWx1\nYXRpb25FeGNlcHRpb24gewogICAgICAgICAgICBpZiAoc3RhdGUuZ2V0U3Rh\nY2soKS5zaXplKCkgPCAzKXsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBT\nZWxlY3RvckV2YWx1YXRpb25FeGNlcHRpb24oZ2V0Q2xhc3MoKSArICIgc3Rh\nY2sgY29ycnVwdGlvbiA/ICIgKyBzdGF0ZS5nZXRTdGFjaygpKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgZmluYWwgU2VsZWN0b3JDb25zdGFudCBy\naWdodCA9IHN0YXRlLmdldFN0YWNrKCkucG9wKCk7CiAgICAgICAgICAgIGZp\nbmFsIFNlbGVjdG9yQ29uc3RhbnQgbGVmdCA9IHN0YXRlLmdldFN0YWNrKCku\ncG9wKCk7CgogICAgICAgICAgICBmaW5hbCBTZWxlY3RvckNvbnN0YW50IGNo\nZWNrRm9yID0gc3RhdGUuZ2V0U3RhY2soKS5wb3AoKTsKCiAgICAgICAgICAg\nIGZpbmFsIFNlbGVjdG9yQ29uc3RhbnQgcmVzdWx0ID0gZG9FdmFsdWF0ZShj\naGVja0ZvciwgbGVmdCwgcmlnaHQpOwogICAgICAgICAgICBpZiAoTXlOb2Rl\nLmxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBNeU5vZGUubG9nZ2VyLnRyYWNl\nKGdldENsYXNzKCkgKyAiOiBsZWZ0ICciICsgbGVmdCArCiAgICAgICAgICAg\nICAgICAiJywgcmlnaHQgJyIgKyByaWdodCArICInLCBjaGVja0ZvciAnIiAr\nIGNoZWNrRm9yICsgIicgLT4gIiArIHJlc3VsdCk7CiAgICAgICAgICAgIHN0\nYXRlLmdldFN0YWNrKCkucHVzaChyZXN1bHQpOwogICAgICAgIH0KCiAgICAg\nICAgcHJpdmF0ZSBTZWxlY3RvckNvbnN0YW50IGRvRXZhbHVhdGUoZmluYWwg\nU2VsZWN0b3JDb25zdGFudCBjaGVja0ZvciwgZmluYWwgU2VsZWN0b3JDb25z\ndGFudCBsZWZ0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZpbmFsIFNlbGVjdG9yQ29uc3RhbnQgcmlnaHQpIHRocm93\ncyBTZWxlY3RvckV2YWx1YXRpb25FeGNlcHRpb24gewoKICAgICAgICAgICAg\naWYgKGxlZnQuaXNOdWxsKCkgfHwgcmlnaHQuaXNOdWxsKCkpIHsKICAgICAg\nICAgICAgICAgIC8vIFVuZXhwZWN0ZWQgZm9yIGEgYm91bmQgdG8gYmUgbnVs\nbCAuLi4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBTZWxlY3RvckV2YWx1\nYXRpb25FeGNlcHRpb24oZ2V0Q2xhc3MoKSArICIgVW5leHBlY3RlZCBmb3Ig\nbGVmdCBvciByaWdodCBib3VuZCB0byBiZSBudWxsICIgKwogICAgICAgICAg\nICAgICAgICAgIGxlZnQgKyAiLCAiICsgcmlnaHQpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBpZiAoY2hlY2tGb3IuaXNOdWxsKCkpewogICAgICAg\nICAgICAgICAgLy8gSWYgY2hlY2tGb3IgaXMgbnVsbCwgdGhlbiBpdCBjYW50\nIGJlIGJldHdlZW4gYW55d2F5IC0gcmV0dXJuIHVua25vd24uCiAgICAgICAg\nICAgICAgICByZXR1cm4gbmV3IFNlbGVjdG9yQ29uc3RhbnQoKEJvb2xlYW4p\nIG51bGwpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmaW5hbCBCb29s\nZWFuIHJlc3VsdDsKCiAgICAgICAgICAgIC8vIEJldHdlZW4gbGVmdCBhbmQg\ncmlnaHQgLi4uCiAgICAgICAgICAgIHN3aXRjaCAobGVmdC50eXBlKSB7CiAg\nICAgICAgICAgICAgICBjYXNlIElOVDogewogICAgICAgICAgICAgICAgICAg\nIHN3aXRjaCAocmlnaHQudHlwZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBjYXNlIElOVDogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVz\ndWx0ID0gaGFuZGxlQmV0d2VlbkludEFuZEludChjaGVja0ZvciwgbGVmdC5n\nZXRJbnRWYWx1ZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJpZ2h0LmdldEludFZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgY2FzZSBET1VCTEU6IHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJlc3VsdCA9IGhhbmRsZUJldHdlZW5JbnRBbmRE\nb3VibGUoY2hlY2tGb3IsIGxlZnQuZ2V0SW50VmFsdWUoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByaWdodC5nZXREb3VibGVWYWx1ZSgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9uKGdldENsYXNzKCkgKyAiIFVu\nc3VwcG9ydGVkIHR5cGUgZm9yIHJpZ2h0ICIgKwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHJpZ2h0LnR5cGUpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIGNhc2UgRE9VQkxFOiB7CiAgICAgICAg\nICAgICAgICAgICAgc3dpdGNoIChyaWdodC50eXBlKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNhc2UgSU5UOiB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZXN1bHQgPSBoYW5kbGVCZXR3ZWVuSW50QW5kRG91YmxlKGNo\nZWNrRm9yLCByaWdodC5nZXRJbnRWYWx1ZSgpLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxlZnQuZ2V0RG91YmxlVmFsdWUoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIERPVUJM\nRTogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gaGFu\nZGxlQmV0d2VlbkRvdWJsZUFuZERvdWJsZShjaGVja0ZvciwgbGVmdC5nZXRE\nb3VibGVWYWx1ZSgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJpZ2h0LmdldERvdWJsZVZhbHVlKCkpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBTZWxlY3RvckV2YWx1YXRpb25FeGNl\ncHRpb24oZ2V0Q2xhc3MoKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIiBVbnN1cHBvcnRlZCB0eXBlIGZvciByaWdodCAiICsgcmlnaHQu\ndHlwZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgU2VsZWN0\nb3JFdmFsdWF0aW9uRXhjZXB0aW9uKGdldENsYXNzKCkgKyAiIFVuc3VwcG9y\ndGVkIHR5cGUgZm9yIGxlZnQgIiArIHJpZ2h0LnR5cGUpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBpZiAobnVsbCA9PSByZXN1bHQpIHsKICAgICAg\nICAgICAgICAgIC8vIENhbm5vdCBmaW5kIHRoZSByZXN1bHQgYXMgdGhlIHR5\ncGUgd2UgZXhwZWN0ZWQuCiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFNl\nbGVjdG9yQ29uc3RhbnQoKEJvb2xlYW4pIG51bGwpOwogICAgICAgICAgICB9\nCgoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTZWxlY3RvckNvbnN0YW50KG5l\nZ2F0ZSA/ICFyZXN1bHQgOiByZXN1bHQpOwogICAgICAgIH0KCiAgICAgICAg\ncHJpdmF0ZSBCb29sZWFuIGhhbmRsZUJldHdlZW5JbnRBbmRJbnQoU2VsZWN0\nb3JDb25zdGFudCBjaGVja0ZvciwgaW50IGludEJvdW5kLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBvdGhl\nckludEJvdW5kKSB0aHJvd3MgU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgZmluYWwgaW50IGxvdyA9IE1hdGgubWluKGludEJv\ndW5kLCBvdGhlckludEJvdW5kKTsKICAgICAgICAgICAgZmluYWwgaW50IGhp\nZ2ggPSBNYXRoLm1heChpbnRCb3VuZCwgb3RoZXJJbnRCb3VuZCk7CgogICAg\nICAgICAgICBhc3NlcnQgISBjaGVja0Zvci5pc051bGwoKTsKCgogICAgICAg\nICAgICBzd2l0Y2ggKGNoZWNrRm9yLnR5cGUpewogICAgICAgICAgICAgICAg\nY2FzZSBJTlQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNoZWNrRm9y\nLmdldEludFZhbHVlKCkgPj0gbG93ICYmIGNoZWNrRm9yLmdldEludFZhbHVl\nKCkgPD0gaGlnaDsKICAgICAgICAgICAgICAgIGNhc2UgRE9VQkxFOgogICAg\nICAgICAgICAgICAgICAgIHJldHVybiBjaGVja0Zvci5nZXREb3VibGVWYWx1\nZSgpID49IGxvdyAmJiBjaGVja0Zvci5nZXREb3VibGVWYWx1ZSgpIDw9IGhp\nZ2g7CiAgICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAg\nICAgIHRocm93IG5ldyBTZWxlY3RvckV2YWx1YXRpb25FeGNlcHRpb24oZ2V0\nQ2xhc3MoKSArCiAgICAgICAgICAgICAgICAgICAgICAgICIgSWRlbnRpZmll\nciB2YWx1ZSBpcyBvZiBpbGxlZ2FsIHR5cGUgIiArIGNoZWNrRm9yLnR5cGUg\nKyAiIC4uLiAiICsgY2hlY2tGb3IpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIEJvb2xlYW4gaGFuZGxlQmV0d2VlbkludEFu\nZERvdWJsZShTZWxlY3RvckNvbnN0YW50IGNoZWNrRm9yLCBpbnQgaW50Qm91\nbmQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgZG91YmxlIGRvdWJsZUJvdW5kKSB0aHJvd3MgU2VsZWN0b3JF\ndmFsdWF0aW9uRXhjZXB0aW9uIHsKICAgICAgICAgICAgZmluYWwgZG91Ymxl\nIGxvdyA9IE1hdGgubWluKChkb3VibGUpIGludEJvdW5kLCBkb3VibGVCb3Vu\nZCk7CiAgICAgICAgICAgIGZpbmFsIGRvdWJsZSBoaWdoID0gTWF0aC5tYXgo\nKGRvdWJsZSkgaW50Qm91bmQsIGRvdWJsZUJvdW5kKTsKCiAgICAgICAgICAg\nIGFzc2VydCAhIGNoZWNrRm9yLmlzTnVsbCgpOwoKCiAgICAgICAgICAgIHN3\naXRjaCAoY2hlY2tGb3IudHlwZSl7CiAgICAgICAgICAgICAgICBjYXNlIElO\nVDoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tGb3IuZ2V0SW50\nVmFsdWUoKSA+PSBsb3cgJiYgY2hlY2tGb3IuZ2V0SW50VmFsdWUoKSA8PSBo\naWdoOwogICAgICAgICAgICAgICAgY2FzZSBET1VCTEU6CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGNoZWNrRm9yLmdldERvdWJsZVZhbHVlKCkgPj0g\nbG93ICYmIGNoZWNrRm9yLmdldERvdWJsZVZhbHVlKCkgPD0gaGlnaDsKICAg\nICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IFNlbGVjdG9yRXZhbHVhdGlvbkV4Y2VwdGlvbihnZXRDbGFzcygp\nICsKICAgICAgICAgICAgICAgICAgICAgICAgIiBJZGVudGlmaWVyIHZhbHVl\nIGlzIG9mIGlsbGVnYWwgdHlwZSAiICsgY2hlY2tGb3IudHlwZSArICIgLi4u\nICIgKyBjaGVja0Zvcik7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHByaXZhdGUgQm9vbGVhbiBoYW5kbGVCZXR3ZWVuRG91YmxlQW5kRG91\nYmxlKFNlbGVjdG9yQ29uc3RhbnQgY2hlY2tGb3IsIGRvdWJsZSBkb3VibGVC\nb3VuZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBkb3VibGUgb3RoZXJEb3VibGVCb3VuZCkgdGhyb3dz\nIFNlbGVjdG9yRXZhbHVhdGlvbkV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGZp\nbmFsIGRvdWJsZSBsb3cgPSBNYXRoLm1pbihkb3VibGVCb3VuZCwgb3RoZXJE\nb3VibGVCb3VuZCk7CiAgICAgICAgICAgIGZpbmFsIGRvdWJsZSBoaWdoID0g\nTWF0aC5tYXgoZG91YmxlQm91bmQsIG90aGVyRG91YmxlQm91bmQpOwoKICAg\nICAgICAgICAgYXNzZXJ0ICEgY2hlY2tGb3IuaXNOdWxsKCk7CgoKICAgICAg\nICAgICAgc3dpdGNoIChjaGVja0Zvci50eXBlKXsKICAgICAgICAgICAgICAg\nIGNhc2UgSU5UOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBjaGVja0Zv\nci5nZXRJbnRWYWx1ZSgpID49IGxvdyAmJiBjaGVja0Zvci5nZXRJbnRWYWx1\nZSgpIDw9IGhpZ2g7CiAgICAgICAgICAgICAgICBjYXNlIERPVUJMRToKICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gY2hlY2tGb3IuZ2V0RG91YmxlVmFs\ndWUoKSA+PSBsb3cgJiYgY2hlY2tGb3IuZ2V0RG91YmxlVmFsdWUoKSA8PSBo\naWdoOwogICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgU2VsZWN0b3JFdmFsdWF0aW9uRXhjZXB0aW9uKGdl\ndENsYXNzKCkgKwogICAgICAgICAgICAgICAgICAgICAgICAiIElkZW50aWZp\nZXIgdmFsdWUgaXMgb2YgaWxsZWdhbCB0eXBlICIgKyBjaGVja0Zvci50eXBl\nICsgIiAuLi4gIiArIGNoZWNrRm9yKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0\nb1N0cmluZygpIHsKICAgICAgICAgICAgZmluYWwgU3RyaW5nQnVpbGRlciBz\nYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgIHNiLmFwcGVu\nZCgiQmV0d2VlbkV4cHIiKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCJ7bmVn\nYXRlPSIpLmFwcGVuZChuZWdhdGUpOwogICAgICAgICAgICBzYi5hcHBlbmQo\nJ30nKTsKICAgICAgICAgICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICAg\nICAgfQogICAgfQp9\n","encoding":"base64"}

