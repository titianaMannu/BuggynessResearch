{"sha":"4c23d5ce7b72a9f1aec221a916b485f2b0bbc560","node_id":"MDQ6QmxvYjE1NzU5NTY6NGMyM2Q1Y2U3YjcyYTlmMWFlYzIyMWE5MTZiNDg1ZjJiMGJiYzU2MA==","size":26915,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4c23d5ce7b72a9f1aec221a916b485f2b0bbc560","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuc3BpOwoKaW1wb3J0IGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLmNsaWVudC5IZWR3aWdDbGllbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5jbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5QdWJsaXNoZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuY29uZi5DbGllbnRDb25maWd1cmF0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmV4Y2VwdGlv\nbnMuQWxyZWFkeVN0YXJ0RGVsaXZlcnlFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5jbGllbnQuZXhjZXB0aW9ucy5JbnZhbGlkU3Vic2Ny\naWJlcklkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhj\nZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5qbXMuTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZTsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLmptcy5TZXNzaW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmptcy5EZWJ1Z1V0aWw7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5qbXMubWVzc2FnZS5NZXNzYWdlSW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmptcy5tZXNzYWdlLk1lc3NhZ2VVdGlsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2w7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpcHRpb25PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVh\ndGVPckF0dGFjaDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2Fs\nbGJhY2s7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNs\nZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQgamF2YXguam1zLkRlc3RpbmF0\naW9uOwppbXBvcnQgamF2YXguam1zLkpNU0V4Y2VwdGlvbjsKaW1wb3J0IGph\ndmF4Lmptcy5NZXNzYWdlQ29uc3VtZXI7CmltcG9ydCBqYXZheC5qbXMuUXVl\ndWU7CmltcG9ydCBqYXZheC5qbXMuUXVldWVCcm93c2VyOwppbXBvcnQgamF2\nYXguam1zLlF1ZXVlUmVjZWl2ZXI7CmltcG9ydCBqYXZheC5qbXMuUXVldWVT\nZW5kZXI7CmltcG9ydCBqYXZheC5qbXMuVGVtcG9yYXJ5UXVldWU7CmltcG9y\ndCBqYXZheC5qbXMuVGVtcG9yYXJ5VG9waWM7CmltcG9ydCBqYXZheC5qbXMu\nVG9waWM7CmltcG9ydCBqYXZheC5qbXMuVG9waWNQdWJsaXNoZXI7CmltcG9y\ndCBqYXZheC5qbXMuVG9waWNTdWJzY3JpYmVyOwppbXBvcnQgamF2YS51dGls\nLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3RJdGVyYXRv\ncjsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CgovKioKICogSW1wbGVtZW50YXRp\nb24gb2YgaGVkd2lnIHNwZWNpZmljIGltcGxlbWVudGF0aW9uLiA8YnIvPgog\nKiBKTVMgVklPTEFUSU9OOiBUaGlzIGltcGxlbWVudGF0aW9uIGNyZWF0ZXMg\nYSBzaW5nbGUgYmFja2VuZCBoZWR3aWcgY29ubmVjdGlvbiBQRVIgc2Vzc2lv\nbiAtIGFuZAogKiBET0VTIE5PVCBzaGFyZSBtdWx0aXBsZSBzZXNzb2lucyBv\nbiB0b3Agb2YgYSBzaW5nbGUgY29ubmVjdGlvbi4KICogPHAvPgogKiBUaGlz\nIGlzIGEgd2lsZnVsIHZpb2xhdGlvbiBvZiBKTVMgc3BlY2lmaWNhdGlvbiwg\nYnV0IGV4aXN0cyBvbmx5IGJlY2F1c2UgSGVkd2lnIGRvZXMgbm90IGhhdmUK\nICogYW55IG5vdGlvbiB0byBzdXBwb3J0IHRoaXMuIDxici8+CiAqIE9uY2Ug\naGVkd2lnIGRvZXMgYWxsb3cgZm9yIHNlc3Npb24gbXVsdGlwbGV4aW5nLCB3\nZSB3aWxsIG5lZWQgdG8gcmV2aXNpdCB0aGlzIChvciBjcmVhdGUgYSBuZXcg\naW1wbCkKICogdG8gdGFrZSBpbnRvIGFjY291bnQgdGhlIGNoYW5nZXMuCiAq\nCiAqLwpwdWJsaWMgY2xhc3MgSGVkd2lnTWVzc2FnaW5nU2Vzc2lvbkZhY2Fk\nZSBpbXBsZW1lbnRzIE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUsIE1lc3NhZ2VI\nYW5kbGVyIHsKCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9n\nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSGVkd2lnTWVzc2FnaW5n\nU2Vzc2lvbkZhY2FkZS5jbGFzcyk7CgogICAgICAgICAgICAvLyBXZSBzaW11\nbGF0ZSBub0xvY2FsIHRocm91Z2ggdGhlIGNvbm5lY3Rpb24gLSB3aGljaCB3\naWxsIGJlIHNoYXJlZCBhY3Jvc3Mgc2Vzc2lvbnMuCiAgICBwcml2YXRlIGZp\nbmFsIEhlZHdpZ0Nvbm5lY3Rpb25JbXBsIGNvbm5lY3Rpb247CiAgICBwcml2\nYXRlIGZpbmFsIFNlc3Npb25JbXBsIHNlc3Npb247CiAgICBwcml2YXRlIEhl\nZHdpZ0NsaWVudCBoZWR3aWdDbGllbnQ7CiAgICBwcml2YXRlIHZvbGF0aWxl\nIGJvb2xlYW4gc3RvcHBlZCA9IGZhbHNlOwoKICAgIC8qCiAgICAgSGVkd2ln\nIHNlcnZlciBoYXMgYSBhY2stdW50aWwtTiBhcHByb2FjaCB0byBhY2tub2xl\nZGdlbWVudHMgOiB0aGF0IGlzLCBpZiB3ZSBhY2tub3dsZWRnZSBtZXNzYWdl\nIE4sCiAgICAgYWxsIHByZXZpb3VzIE4tMSBtZXNzYWdlIGFyZSBhbHNvCiAg\nICAgYWNrbm93bGVkZ2VkLgogICAgIEJ1dCBoZWR3aWctY2xpZW50IERPRVMg\nTk9UIHN1cHBvcnQgdGhpcyA6IHBhcnRpY3VsYXJseSBpbiBjb250ZXh0IG9m\nIHRocm90dGxpbmcuCgogICAgIFNvLCB3aGVuIHdlIGFyZSBpbiBDTElFTlRf\nQUNLTk9XTEVER0UgbW9kZSBhbmQgTk9UIGluIHRyYW5zYWN0ZWQgc2Vzc2lv\nbiwgSSBhbSBtb2RpZnlpbmcgdGhlIGJlaGF2aW9yCiAgICAgdG8gbWlycm9y\nIGV4cGVjdGF0aW9uIG9mIGJvdGgKICAgICBoZWR3aWcgY2xpZW50IGFuZCBz\nZXJ2ZXIgaGVyZSBpbiBTZXNzaW9uSW1wbCBpdHNlbGYgKGluc3RlYWQgb2Yg\nZmFjYWRlIHdoZXJlIHRoaXMgcHJvYmFibHkgYmVsb25nIGJldHRlcikuCgog\nICAgIFRoaXMgYXBwcm9hY2ggZG9lcyBub3Qgc2VlbSB0byB3b3JrIGZpbmUg\nZHVlIHRvIGltcGxpY2l0IGFzc3VtcHRpb25zIGluIGhlZHdpZyBjbGllbnQg\nLi4uIEkgYW0KICAgICBtb2RpZnlpbmcgaXQgaW4gZm9sbG93aW5nIHdheSA6\nCiAgICAgYSkgRm9yIGVhY2ggbWVzc2FnZSByZWNlaWV2ZWQsIG1haW50YWlu\nIGl0IGluIExpc3QuCiAgICAgYikgQWNrbm93bGVkZ2luZyBhIG1lc3NhZ2Ug\nbWVhbnMgdHJhdmVyc2luZyB0aGlzIGxpc3QgdG8gZmluZCBtZXNzYWdlIHdp\ndGggc2FtZSBzZXEtaWQgOiBhbmQKICAgICBhY2tub3dsZWRnZSBBTEwgbWVz\nc2FnZSB1bnRpbCB0aGF0IGluIHRoZSBsaXN0LgogICAgIFNpbmNlIGhlZHdp\nZyBkb2VzIGFjayB1bnRpbCwgaW5jdGVhZCBvZiBpbmRpdmlkdWFsIGFjaywg\ndGhpcyB2aW9sYXRpb24gb2YgSk1TIHNwZWMgaXMgY29uc2lzdGVudCB3aXRo\nIGhlZHdpZy4KICAgICBOb3RlIHRoYXQgZXZlbiB0aG91Z2ggaGVkd2lnIGRv\nZXMgYWNrIHVudGlsLCBoZWR3aWcgY2xpZW50IG9uIG90aGVyIGhhbmQgRE9F\nUyBOT1QgISBJdCB3aWxsCiAgICAgdGhyb3R0bGUgY29ubmVjdGlvbiBpZiB3\nZSBkbyBub3QgYWNrIGluZGl2aWR1YWxseSAuLi4KICAgICBzaWdoIDotKAog\nICAgICAqLwogICAgcHJpdmF0ZSBmaW5hbCBMaXN0PFNlc3Npb25JbXBsLlJl\nY2VpdmVkTWVzc2FnZT4gdW5BY2tNZXNzYWdlTGlzdCA9IG5ldyBMaW5rZWRM\naXN0PFNlc3Npb25JbXBsLlJlY2VpdmVkTWVzc2FnZT4oKTsKCiAgICAvLyBC\nb3RoIG9mIHRoZXNlIHN5bmNocm9uaXplZCBvbiBkZWxpdmVyeVN0YXJ0SW5m\nb1NldC4KICAgIHByaXZhdGUgZmluYWwgU2V0PERlbGl2ZXJ5U3RhcnRJbmZv\nPiBkZWxpdmVyeVN0YXJ0SW5mb1NldCA9IG5ldyBIYXNoU2V0PERlbGl2ZXJ5\nU3RhcnRJbmZvPigzMik7CiAgICBwcml2YXRlIGZpbmFsIFNldDxEZWxpdmVy\neVN0YXJ0SW5mbz4gc3Vic2NyaWJlSW5mb1NldCA9IG5ldyBIYXNoU2V0PERl\nbGl2ZXJ5U3RhcnRJbmZvPigzMik7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgY2xhc3MgRGVsaXZlcnlTdGFydEluZm8gewogICAgICAgIHByaXZhdGUg\nZmluYWwgU3RyaW5nIHRvcGljTmFtZTsKICAgICAgICBwcml2YXRlIGZpbmFs\nIFN0cmluZyBzdWJzY3JpYmVySWQ7CgogICAgICAgIHByaXZhdGUgRGVsaXZl\ncnlTdGFydEluZm8oU3RyaW5nIHN1YnNjcmliZXJJZCwgU3RyaW5nIHRvcGlj\nTmFtZSkgewogICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJJZCA9IHN1YnNj\ncmliZXJJZDsKICAgICAgICAgICAgdGhpcy50b3BpY05hbWUgPSB0b3BpY05h\nbWU7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgYm9vbGVhbiBlcXVhbHMoT2JqZWN0IG8pIHsKICAgICAgICAgICAgaWYg\nKHRoaXMgPT0gbykgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGlmIChvID09\nIG51bGwgfHwgZ2V0Q2xhc3MoKSAhPSBvLmdldENsYXNzKCkpIHJldHVybiBm\nYWxzZTsKCiAgICAgICAgICAgIERlbGl2ZXJ5U3RhcnRJbmZvIHRoYXQgPSAo\nRGVsaXZlcnlTdGFydEluZm8pIG87CgogICAgICAgICAgICBpZiAoc3Vic2Ny\naWJlcklkICE9IG51bGwgPyAhc3Vic2NyaWJlcklkLmVxdWFscyh0aGF0LnN1\nYnNjcmliZXJJZCkgOiB0aGF0LnN1YnNjcmliZXJJZCAhPSBudWxsKQogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICBpZiAodG9w\naWNOYW1lICE9IG51bGwgPyAhdG9waWNOYW1lLmVxdWFscyh0aGF0LnRvcGlj\nTmFtZSkgOiB0aGF0LnRvcGljTmFtZSAhPSBudWxsKSByZXR1cm4gZmFsc2U7\nCgogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAg\nIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBpbnQgaGFzaENvZGUoKSB7CiAg\nICAgICAgICAgIGludCByZXN1bHQgPSB0b3BpY05hbWUgIT0gbnVsbCA/IHRv\ncGljTmFtZS5oYXNoQ29kZSgpIDogMDsKICAgICAgICAgICAgcmVzdWx0ID0g\nMzEgKiByZXN1bHQgKyAoc3Vic2NyaWJlcklkICE9IG51bGwgPyBzdWJzY3Jp\nYmVySWQuaGFzaENvZGUoKSA6IDApOwogICAgICAgICAgICByZXR1cm4gcmVz\ndWx0OwogICAgICAgIH0KICAgIH0KCgogICAgcHVibGljIEhlZHdpZ01lc3Nh\nZ2luZ1Nlc3Npb25GYWNhZGUoSGVkd2lnQ29ubmVjdGlvbkltcGwgY29ubmVj\ndGlvbiwgU2Vzc2lvbkltcGwgc2Vzc2lvbikgdGhyb3dzIEpNU0V4Y2VwdGlv\nbiB7CiAgICAgICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjsKICAg\nICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uOwogICAgICAgIC8vIGFsd2F5\ncyBjcmVhdGUgY2xpZW50IC4uLgogICAgICAgIGZpbmFsIENsaWVudENvbmZp\nZ3VyYXRpb24gY2ZnID0gY29ubmVjdGlvbi5nZXRIZWR3aWdDbGllbnRDb25m\naWcoKTsKICAgICAgICBpZiAobnVsbCA9PSBjZmcpIHRocm93IG5ldyBKTVNF\neGNlcHRpb24oIlVuYWJsZSB0byBmZXRjaCBjbGllbnQgY29uZmlnID8iKTsK\nICAgICAgICB0aGlzLmhlZHdpZ0NsaWVudCA9IG5ldyBIZWR3aWdDbGllbnQo\nY2ZnKTsKICAgICAgICByZXNldFN0YXJ0SW5mb1NldCgpOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc3RhcnQoKSB0aHJvd3MgSk1T\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWNvbm5lY3Rpb24uaXNJblN0YXJ0\nTW9kZSgpKSB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJDb25uZWN0aW9uIG5v\ndCB5ZXQgc3RhcnRlZCA/Iik7CiAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNl\nRW5hYmxlZCgpKSBsb2dnZXIudHJhY2UoIkNyZWF0aW5nIEhlZHdpZ0NsaWVu\ndCIpOwogICAgICAgIC8vIGNyZWF0ZSBvbmx5IGlmIHRoZXJlIGlzIG5lZWQg\nZm9yIGl0LgogICAgICAgIGlmIChudWxsID09IHRoaXMuaGVkd2lnQ2xpZW50\nKSB7CiAgICAgICAgICAgIHRoaXMuaGVkd2lnQ2xpZW50ID0gbmV3IEhlZHdp\nZ0NsaWVudChjb25uZWN0aW9uLmdldEhlZHdpZ0NsaWVudENvbmZpZygpKTsK\nICAgICAgICAgICAgcmVzZXRTdGFydEluZm9TZXQoKTsKICAgICAgICB9CiAg\nICAgICAgdGhpcy5zdG9wcGVkID0gZmFsc2U7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBzdG9wKCkgewogICAgICAgIC8vIHN0b3Bw\naW5nIGRvZXMgbm90IGluaGliaXQgc2VuZC4KICAgICAgICBpZiAobG9nZ2Vy\nLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgiU3RvcHBpbmcgSGVk\nd2lnQ2xpZW50Iik7CiAgICAgICAgLyoKICAgICAgICBIZWR3aWdDbGllbnQg\nY2xpZW50ID0gdGhpcy5oZWR3aWdDbGllbnQ7CiAgICAgICAgdGhpcy5oZWR3\naWdDbGllbnQgPSBudWxsOwogICAgICAgIGNsaWVudC5jbG9zZSgpOwogICAg\nICAgICovCiAgICAgICAgdGhpcy5zdG9wcGVkID0gdHJ1ZTsKICAgIH0KCgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsKICAgICAg\nICBIZWR3aWdDbGllbnQgY2xpZW50ID0gdGhpcy5oZWR3aWdDbGllbnQ7CiAg\nICAgICAgcmVzZXRTdGFydEluZm9TZXQoKTsKCiAgICAgICAgdGhpcy5zdG9w\ncGVkID0gdHJ1ZTsKICAgICAgICB0aGlzLmhlZHdpZ0NsaWVudCA9IG51bGw7\nCiAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBsb2dnZXIu\ndHJhY2UoIkNsb3NpbmcgSGVkd2lnQ2xpZW50Iik7CiAgICAgICAgY2xpZW50\nLmNsb3NlKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJlc2V0U3RhcnRJ\nbmZvU2V0KCl7CiAgICAgICAgc3luY2hyb25pemVkIChkZWxpdmVyeVN0YXJ0\nSW5mb1NldCl7CiAgICAgICAgICAgIGRlbGl2ZXJ5U3RhcnRJbmZvU2V0LmNs\nZWFyKCk7CiAgICAgICAgICAgIHN1YnNjcmliZUluZm9TZXQuY2xlYXIoKTsK\nICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgRGVz\ndGluYXRpb25UeXBlIGZpbmREZXN0aW5hdGlvblR5cGUoU3RyaW5nIGRlc3Rp\nbmF0aW9uKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICAvLyBUT0RP\nOiBGb3Igbm93LCB3ZSBzdXBwb3J0IE9OTFkgdG9waWMncywgc28gYWx3YXlz\nIHJldHVybmluZyB0aGF0LgogICAgICAgIHJldHVybiBEZXN0aW5hdGlvblR5\ncGUuVE9QSUM7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgRGVz\ndGluYXRpb25UeXBlIGZpbmREZXN0aW5hdGlvblR5cGUoRGVzdGluYXRpb24g\nZGVzdGluYXRpb24pIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIGlm\nIChkZXN0aW5hdGlvbiBpbnN0YW5jZW9mIFRvcGljKSByZXR1cm4gRGVzdGlu\nYXRpb25UeXBlLlRPUElDOwogICAgICAgIGlmIChkZXN0aW5hdGlvbiBpbnN0\nYW5jZW9mIFF1ZXVlKSByZXR1cm4gRGVzdGluYXRpb25UeXBlLlFVRVVFOwoK\nICAgICAgICAvLyBUT0RPOiBGb3Igbm93LCB3ZSBzdXBwb3J0IE9OTFkgdG9w\naWMncywgc28gYWx3YXlzIHJldHVybmluZyB0aGF0IHdoZW4gdW5rbm93bi4K\nICAgICAgICByZXR1cm4gRGVzdGluYXRpb25UeXBlLlRPUElDOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIFRvcGljUHVibGlzaGVyIGNyZWF0\nZVRvcGljUHVibGlzaGVyKERlc3RpbmF0aW9uIGRlc3RpbmF0aW9uKSB0aHJv\nd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gbmV3IFRvcGljUHVi\nbGlzaGVySW1wbCh0aGlzLCBzZXNzaW9uLCBudWxsICE9IGRlc3RpbmF0aW9u\nID8KICAgICAgICAgICAgc2Vzc2lvbi5jcmVhdGVUb3BpYyhzZXNzaW9uLnRv\nTmFtZShkZXN0aW5hdGlvbikpIDogbnVsbCk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgVG9waWNTdWJzY3JpYmVyIGNyZWF0ZVRvcGljU3Vi\nc2NyaWJlcihEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbikgdGhyb3dzIEpNU0V4\nY2VwdGlvbiB7CiAgICAgICAgc2Vzc2lvbi5zdWJzY3JpYmVyQ3JlYXRlZCgp\nOwogICAgICAgIGNvbm5lY3Rpb24uaW5pdENvbm5lY3Rpb25DbGllbnRJRCgp\nOwogICAgICAgIHJldHVybiBuZXcgVG9waWNTdWJzY3JpYmVySW1wbChzZXNz\naW9uLCBzZXNzaW9uLmNyZWF0ZVRvcGljKHNlc3Npb24udG9OYW1lKGRlc3Rp\nbmF0aW9uKSksCiAgICAgICAgICAgICAgICBzZXNzaW9uLmNyZWF0ZVN1YnNj\ncmliZXJJZChTZXNzaW9uSW1wbC5nZW5lcmF0ZVJhbmRvbVN0cmluZygpKSwg\ndHJ1ZSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgVG9waWNT\ndWJzY3JpYmVyIGNyZWF0ZVRvcGljU3Vic2NyaWJlcihEZXN0aW5hdGlvbiBk\nZXN0aW5hdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFN0cmluZyBtZXNzYWdlU2VsZWN0b3IsIGJvb2xl\nYW4gbm9Mb2NhbCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgc2Vz\nc2lvbi5zdWJzY3JpYmVyQ3JlYXRlZCgpOwogICAgICAgIGNvbm5lY3Rpb24u\naW5pdENvbm5lY3Rpb25DbGllbnRJRCgpOwogICAgICAgIHJldHVybiBuZXcg\nVG9waWNTdWJzY3JpYmVySW1wbChzZXNzaW9uLAogICAgICAgICAgICAgICAg\nc2Vzc2lvbi5jcmVhdGVUb3BpYyhzZXNzaW9uLnRvTmFtZShkZXN0aW5hdGlv\nbikpLAogICAgICAgICAgICAgICAgc2Vzc2lvbi5jcmVhdGVTdWJzY3JpYmVy\nSWQoU2Vzc2lvbkltcGwuZ2VuZXJhdGVSYW5kb21TdHJpbmcoKSksIG1lc3Nh\nZ2VTZWxlY3Rvciwgbm9Mb2NhbCwgdHJ1ZSk7CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgVG9waWNTdWJzY3JpYmVyIGNyZWF0ZUR1cmFibGVT\ndWJzY3JpYmVyKFRvcGljIHRvcGljLCBTdHJpbmcgc3Vic2NyaWJlZElkKSB0\naHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAobnVsbCAhPSBzZXNz\naW9uLmdldE1lc3NhZ2VMaXN0ZW5lcigpKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBKTVNFeGNlcHRpb24oIk1lc3NhZ2UgbGlzdGVuZXIgaXMgc2V0IC0g\nbm90IG90aGVyIGZvcm0gb2YgbWVzc2FnZSByZWNlaXB0IGNhbiBiZSB1c2Vk\nIik7CiAgICAgICAgfQogICAgICAgIHNlc3Npb24uc3Vic2NyaWJlckNyZWF0\nZWQoKTsKCiAgICAgICAgVG9waWNTdWJzY3JpYmVySW1wbCBzdWJzY3JpYmVy\nID0gbmV3IFRvcGljU3Vic2NyaWJlckltcGwoc2Vzc2lvbiwgdG9waWMsIHN1\nYnNjcmliZWRJZCwgZmFsc2UpOwogICAgICAgIHN1YnNjcmliZXIuc3RhcnQo\nKTsKICAgICAgICByZXR1cm4gc3Vic2NyaWJlcjsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyBUb3BpY1N1YnNjcmliZXIgY3JlYXRlRHVyYWJs\nZVN1YnNjcmliZXIoVG9waWMgdG9waWMsIFN0cmluZyBzdWJzY3JpYmVkSWQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIFN0cmluZyBtZXNzYWdlU2VsZWN0b3IsIGJvb2xlYW4gbm9Mb2Nh\nbCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG51bGwgIT0g\nc2Vzc2lvbi5nZXRNZXNzYWdlTGlzdGVuZXIoKSkgewogICAgICAgICAgICB0\naHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJNZXNzYWdlIGxpc3RlbmVyIGlzIHNl\ndCAtIG5vdCBvdGhlciBmb3JtIG9mIG1lc3NhZ2UgcmVjZWlwdCBjYW4gYmUg\ndXNlZCIpOwogICAgICAgIH0KICAgICAgICBzZXNzaW9uLnN1YnNjcmliZXJD\ncmVhdGVkKCk7CiAgICAgICAgY29ubmVjdGlvbi5pbml0Q29ubmVjdGlvbkNs\naWVudElEKCk7CgogICAgICAgIHJldHVybiBuZXcgVG9waWNTdWJzY3JpYmVy\nSW1wbChzZXNzaW9uLCB0b3BpYywgc3Vic2NyaWJlZElkLCBtZXNzYWdlU2Vs\nZWN0b3IsIG5vTG9jYWwsIGZhbHNlKTsKICAgIH0KCiAgICAvKgogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgdm9pZCB1bnN1YnNjcmliZShTdHJpbmcgc3Vi\nc2NyaWJlcklkKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICB0aHJv\ndyBuZXcgSk1TRXhjZXB0aW9uKCJIZWR3aWcgcmVxdWlyZXMgQk9USCB0b3Bp\nYyBuYW1lIGFuZCBzdWJzY3JpYmVySWQgdG8gdW5zdWJzY3JpYmUgLQogICAg\nICAgIHVubGlrZSBKTVMuIE5lZWQgdG8gZmlndXJlIHRoaXMgb3V0LiIpOwog\nICAgfQogICAgKi8KCiAgICAvLyBOb3RlOiBvcmRlciBTRU5TSVRJVkUgISEK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcmVnaXN0ZXJVbkFja25v\nd2xlZGdlZE1lc3NhZ2UoU2Vzc2lvbkltcGwuUmVjZWl2ZWRNZXNzYWdlIG1l\nc3NhZ2UpIHsKICAgICAgICBzeW5jaHJvbml6ZWQgKHVuQWNrTWVzc2FnZUxp\nc3QpewogICAgICAgICAgICB1bkFja01lc3NhZ2VMaXN0LmFkZChtZXNzYWdl\nKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICAvLyBwdWJs\naWMgdm9pZCBhY2tub3dsZWRnZShTdHJpbmcgdG9waWNOYW1lLCBTdHJpbmcg\nc3Vic2NyaWJlcklkLCBTdHJpbmcgam1zTWVzc2FnZUlEKQogICAgcHVibGlj\nIHZvaWQgYWNrbm93bGVkZ2UoTWVzc2FnZUltcGwgbWVzc2FnZSkgdGhyb3dz\nIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKHRoaXMuc3RvcHBlZCB8fCBu\ndWxsID09IGhlZHdpZ0NsaWVudCkKICAgICAgICAgIHRocm93IG5ldyBqYXZh\neC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJzZXNzaW9uIGluIHN0b3Bw\nZWQgb3IgY2xvc2VkIHN0YXRlLCBjYW50IGFja25vd2xlZGdlIG1lc3NhZ2Ui\nKTsKCiAgICAgICAgLyoKICAgICAgICAgVGhpcyBhcHByb2FjaCBkb2VzIG5v\ndCBzZWVtIHRvIHdvcmsgZmluZSBkdWUgdG8gaW1wbGljaXQgYXNzdW1wdGlv\nbnMgaW4gaGVkd2lnIGNsaWVudCAuLi4KICAgICAgICAgSSBhbSBtb2RpZnlp\nbmcgaXQgaW4gZm9sbG93aW5nIHdheSA6CiAgICAgICAgIGEpIEZvciBlYWNo\nIG1lc3NhZ2UgcmVjZWlldmVkLCBtYWludGFpbiBpdCBpbiBMaXN0LgogICAg\nICAgICBiKSBBY2tub3dsZWRnaW5nIGEgbWVzc2FnZSBtZWFucyB0cmF2ZXJz\naW5nIHRoaXMgbGlzdCB0byBmaW5kIG1lc3NhZ2Ugd2l0aCBzYW1lIHNlcS1p\nZCA6CiAgICAgICAgIGFuZCBhY2tub3dsZWRnZSBBTEwgbWVzc2FnZSB1bnRp\nbCB0aGF0IGluIHRoZSBsaXN0LgogICAgICAgICBTaW5jZSBoZWR3aWcgZG9l\ncyBhY2sgdW50aWwsIGluY3RlYWQgb2YgaW5kaXZpZHVhbCBhY2ssIHRoaXMg\ndmlvbGF0aW9uIG9mIEpNUyBzcGVjIGlzIGNvbnNpc3RlbnQgd2l0aCBoZWR3\naWcuCiAgICAgICAgIE5vdGUgdGhhdCBldmVuIHRob3VnaCBoZWR3aWcgZG9l\ncyBhY2sgdW50aWwsIGhlZHdpZyBjbGllbnQgb24gb3RoZXIgaGFuZCBET0VT\nIE5PVCAhIEl0IHdpbGwKICAgICAgICAgIHRocm90dGxlIGNvbm5lY3Rpb24g\naWYgd2UgZG8gbm90IGFjayBpbmRpdmlkdWFsbHkgLi4uCiAgICAgICAgIHNp\nZ2ggOi0oCiAgICAgICAgICAqLwogICAgICAgIC8vIHNlbmRBY2tub3dsZWRn\nZSh0b3BpY05hbWUsIHN1YnNjcmliZXJJZCwgc2VxSWQpOwoKICAgICAgICBM\naW5rZWRMaXN0PFNlc3Npb25JbXBsLlJlY2VpdmVkTWVzc2FnZT4gYWNrTGlz\ndCA9IG5ldyBMaW5rZWRMaXN0PFNlc3Npb25JbXBsLlJlY2VpdmVkTWVzc2Fn\nZT4oKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHVuQWNrTWVzc2FnZUxpc3Qp\newogICAgICAgICAgICAvLyBTaG91bGQgSSBzaW1wbHkgY29weSBhbmQgcmVs\nZWFzZSA/CiAgICAgICAgICAgIExpc3RJdGVyYXRvcjxTZXNzaW9uSW1wbC5S\nZWNlaXZlZE1lc3NhZ2U+IGl0ZXIgPSB1bkFja01lc3NhZ2VMaXN0Lmxpc3RJ\ndGVyYXRvcigpOwoKICAgICAgICAgICAgYm9vbGVhbiBmb3VuZCA9IGZhbHNl\nOwogICAgICAgICAgICB3aGlsZSAoaXRlci5oYXNOZXh0KCkpewogICAgICAg\nICAgICAgICAgaWYgKGl0ZXIubmV4dCgpLm9yaWdpbmFsTWVzc2FnZS5nZXRT\nZXJ2ZXJKbXNNZXNzYWdlSWQoKS5lcXVhbHMobWVzc2FnZS5nZXRTZXJ2ZXJK\nbXNNZXNzYWdlSWQoKSkpewogICAgICAgICAgICAgICAgICAgIGZvdW5kID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gcHJvYmFibHkg\nYWxyZWFkeSBhY2tub3dsZWRnZWQgPwogICAgICAgICAgICBpZiAoIWZvdW5k\nKSByZXR1cm4gOwogICAgICAgICAgICB3aGlsZSAoaXRlci5oYXNQcmV2aW91\ncygpKXsKICAgICAgICAgICAgICAgIGFja0xpc3QuYWRkRmlyc3QoaXRlci5w\ncmV2aW91cygpKTsKICAgICAgICAgICAgICAgIGl0ZXIucmVtb3ZlKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIE5vdyBhY2tub3ds\nZWRnZSB0aGUgbWVzc2FnZXMgaW4gYWNrTGlzdCBieSBydW5uaW5nIGl0cyBy\ndW5uYWJsZS4KICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgbG9nZ2VyLnRyYWNlKCJmYWNhZGUgYWNrbm93bGVk\nZ2UgYWNrTGlzdCAoIiArIGFja0xpc3Quc2l6ZSgpICsgIikgLi4uICIgKyBh\nY2tMaXN0KTsKICAgICAgICB9CiAgICAgICAgZm9yIChTZXNzaW9uSW1wbC5S\nZWNlaXZlZE1lc3NhZ2UgbXNnIDogYWNrTGlzdCl7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICBtc2cub3JpZ2luYWxNZXNzYWdlLmdldEFj\na1J1bm5hYmxlKCkucnVuKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBleCl7CiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgYW55IGV4Y2Vw\ndGlvbiB0aHJvd24uCiAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVi\ndWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVi\ndWcoIklnbm9yaW5nIGV4Y2VwdGlvbiB0aHJvd24gd2hpbGUgYWNrbm93bGVk\nZ2luZyBtZXNzYWdlcyIsIGV4KTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHNl\nbmRBY2tub3dsZWRnZShTdHJpbmcgdG9waWNOYW1lLCBTdHJpbmcgc3Vic2Ny\naWJlcklkLCBQdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgc2VxSWQpCiAg\nICAgICAgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CgogICAgICAgIGlmIChsb2dn\nZXIuaXNUcmFjZUVuYWJsZWQoKSkgbG9nZ2VyLnRyYWNlKCJBY2tub3dsZWRn\naW5nICIgKwogICAgICAgICAgICBNZXNzYWdlVXRpbC5nZW5lcmF0ZUpNU01l\nc3NhZ2VJZEZyb21TZXFJZChzZXFJZCkgKyAiIGZvciAiICsgdG9waWNOYW1l\nICsgIiBieSAiICsgc3Vic2NyaWJlcklkKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBoZWR3aWdDbGllbnQuZ2V0U3Vic2NyaWJlcigpLmNvbnN1bWUo\nQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgodG9waWNOYW1lKSwKICAgICAgICAg\nICAgICAgIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KHN1YnNjcmliZXJJZCks\nIHNlcUlkKTsKICAgICAgICB9IGNhdGNoIChQdWJTdWJFeGNlcHRpb24uQ2xp\nZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIEpN\nU0V4Y2VwdGlvbiBqRXggPSBuZXcgSk1TRXhjZXB0aW9uKCJDbGllbnQgbm90\nIHN1YnNjcmliZWQgLi4gIiArIGUpOwogICAgICAgICAgICBqRXguc2V0TGlu\na2VkRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB0aHJvdyBqRXg7CiAgICAg\nICAgfQogICAgfQoKCiAgICBwdWJsaWMgdm9pZCBzdWJzY3JpYmVUb1RvcGlj\nKFN0cmluZyB0b3BpY05hbWUsIFN0cmluZyBzdWJzY3JpYmVkSWQpIHRocm93\ncyBKTVNFeGNlcHRpb24gewogICAgICAgIGlmIChudWxsID09IGhlZHdpZ0Ns\naWVudCkKICAgICAgICAgIHRocm93IG5ldyBqYXZheC5qbXMuSWxsZWdhbFN0\nYXRlRXhjZXB0aW9uKCJzZXNzaW9uIGluIGNsb3NlZCBzdGF0ZSwgY2FudCBz\ndWJzY3JpYmUgdG8gdG9waWMgIiArIHRvcGljTmFtZSk7CgogICAgICAgIGZp\nbmFsIERlbGl2ZXJ5U3RhcnRJbmZvIGluZm8gPSBuZXcgRGVsaXZlcnlTdGFy\ndEluZm8odG9waWNOYW1lLCBzdWJzY3JpYmVkSWQpOwogICAgICAgIGZpbmFs\nIGJvb2xlYW4gc3RhcnQ7CiAgICAgICAgc3luY2hyb25pemVkIChkZWxpdmVy\neVN0YXJ0SW5mb1NldCl7CiAgICAgICAgICAgIHN0YXJ0ID0gICEgc3Vic2Ny\naWJlSW5mb1NldC5jb250YWlucyhpbmZvKTsKCiAgICAgICAgICAgIGlmIChz\ndGFydCkgewogICAgICAgICAgICAgICAgc3Vic2NyaWJlSW5mb1NldC5hZGQo\naW5mbyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICgh\nIHN0YXJ0KSB7CiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJs\nZWQoKSkgbG9nZ2VyLmRlYnVnKCJDbGllbnQgYWxyZWFkeSBzdWJzY3JpYmVk\nID8iKTsKICAgICAgICAgICAgcmV0dXJuIDsKICAgICAgICB9CgogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0cyA9\nIFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAgICAg\nICAgICAuc2V0Q3JlYXRlT3JBdHRhY2goQ3JlYXRlT3JBdHRhY2guQ1JFQVRF\nX09SX0FUVEFDSCkuYnVpbGQoKTsKICAgICAgICAgICAgaGVkd2lnQ2xpZW50\nLmdldFN1YnNjcmliZXIoKS5zdWJzY3JpYmUoQnl0ZVN0cmluZy5jb3B5RnJv\nbVV0ZjgodG9waWNOYW1lKSwKICAgICAgICAgICAgICAgICAgICBCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOChzdWJzY3JpYmVkSWQpLCBvcHRzKTsKICAgICAg\nICB9IGNhdGNoIChQdWJTdWJFeGNlcHRpb24uQ291bGROb3RDb25uZWN0RXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgSk1TRXhjZXB0aW9uIGplID0gbmV3\nIEpNU0V4Y2VwdGlvbigicmVjZWl2ZSBmYWlsZWQsIGNvdWxkIG5vdCBjb25u\nZWN0IC4uICIgKyBlKTsKICAgICAgICAgICAgamUuc2V0TGlua2VkRXhjZXB0\naW9uKGUpOwogICAgICAgICAgICB0aHJvdyBqZTsKICAgICAgICB9IGNhdGNo\nIChQdWJTdWJFeGNlcHRpb24uQ2xpZW50QWxyZWFkeVN1YnNjcmliZWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBKTVNFeGNlcHRpb24gamUgPSBuZXcg\nSk1TRXhjZXB0aW9uKCJyZWNlaXZlIGZhaWxlZCwgYWxyZWFkeSBzdWJzY3Jp\nYmVkIC4uICIgKyBlKTsKICAgICAgICAgICAgamUuc2V0TGlua2VkRXhjZXB0\naW9uKGUpOwogICAgICAgICAgICB0aHJvdyBqZTsKICAgICAgICB9IGNhdGNo\nIChQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBKTVNFeGNlcHRpb24gamUgPSBuZXcgSk1TRXhjZXB0aW9u\nKCJyZWNlaXZlIGZhaWxlZCwgaGVkd2lnIHNlcnZpY2UgZG93biAuLiAiICsg\nZSk7CiAgICAgICAgICAgIGplLnNldExpbmtlZEV4Y2VwdGlvbihlKTsKICAg\nICAgICAgICAgdGhyb3cgamU7CiAgICAgICAgfSBjYXRjaCAoSW52YWxpZFN1\nYnNjcmliZXJJZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIEpNU0V4Y2Vw\ndGlvbiBqZSA9IG5ldyBKTVNFeGNlcHRpb24oInJlY2VpdmUgZmFpbGVkLCBp\nbnZhbGlkIHN1YnNjcmliZXIgLi4gIiArIGUpOwogICAgICAgICAgICBqZS5z\nZXRMaW5rZWRFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIHRocm93IGplOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB1bnN1YnNjcmliZUZy\nb21Ub3BpYyhTdHJpbmcgdG9waWNOYW1lLCBTdHJpbmcgc3Vic2NyaWJlZElk\nKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBpZiAobnVsbCA9PSBo\nZWR3aWdDbGllbnQpCiAgICAgICAgICB0aHJvdyBuZXcgamF2YXguam1zLkls\nbGVnYWxTdGF0ZUV4Y2VwdGlvbigic2Vzc2lvbiBpbiBjbG9zZWQgc3RhdGUs\nIGNhbnQgYWNrbm93bGVkZ2UgbWVzc2FnZSIpOwoKICAgICAgICAvLyBBbHNv\nIGltcGxpZXMgcmVtb3ZhbCBvZiBkZWxpdmVyeSwgcmlnaHQgPwogICAgICAg\nIGZpbmFsIERlbGl2ZXJ5U3RhcnRJbmZvIGluZm8gPSBuZXcgRGVsaXZlcnlT\ndGFydEluZm8odG9waWNOYW1lLCBzdWJzY3JpYmVkSWQpOwogICAgICAgIHN5\nbmNocm9uaXplZCAoZGVsaXZlcnlTdGFydEluZm9TZXQpewogICAgICAgICAg\nICBkZWxpdmVyeVN0YXJ0SW5mb1NldC5yZW1vdmUoaW5mbyk7CiAgICAgICAg\nICAgIHN1YnNjcmliZUluZm9TZXQucmVtb3ZlKGluZm8pOwogICAgICAgIH0K\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaGVkd2lnQ2xpZW50LmdldFN1\nYnNjcmliZXIoKS51bnN1YnNjcmliZShCeXRlU3RyaW5nLmNvcHlGcm9tVXRm\nOCh0b3BpY05hbWUpLAogICAgICAgICAgICAgICAgQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0Zjgoc3Vic2NyaWJlZElkKSk7CiAgICAgICAgfSBjYXRjaCAoUHVi\nU3ViRXhjZXB0aW9uLkNvdWxkTm90Q29ubmVjdEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIEpNU0V4Y2VwdGlvbiBqZSA9IG5ldyBKTVNFeGNlcHRpb24o\nInJlY2VpdmUgZmFpbGVkLCBjb3VsZCBub3QgY29ubmVjdCAuLiAiICsgZSk7\nCiAgICAgICAgICAgIGplLnNldExpbmtlZEV4Y2VwdGlvbihlKTsKICAgICAg\nICAgICAgdGhyb3cgamU7CiAgICAgICAgfSBjYXRjaCAoUHViU3ViRXhjZXB0\naW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgSk1T\nRXhjZXB0aW9uIGplID0gbmV3IEpNU0V4Y2VwdGlvbigicmVjZWl2ZSBmYWls\nZWQsIGhlZHdpZyBzZXJ2aWNlIGRvd24gLi4gIiArIGUpOwogICAgICAgICAg\nICBqZS5zZXRMaW5rZWRFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIHRocm93\nIGplOwogICAgICAgIH0gY2F0Y2ggKEludmFsaWRTdWJzY3JpYmVySWRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBKTVNFeGNlcHRpb24gamUgPSBuZXcg\nSk1TRXhjZXB0aW9uKCJyZWNlaXZlIGZhaWxlZCwgaW52YWxpZCBzdWJzY3Jp\nYmVyIC4uICIgKyBlKTsKICAgICAgICAgICAgamUuc2V0TGlua2VkRXhjZXB0\naW9uKGUpOwogICAgICAgICAgICB0aHJvdyBqZTsKICAgICAgICB9IGNhdGNo\nIChQdWJTdWJFeGNlcHRpb24uQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIEpNU0V4Y2VwdGlvbiBqZSA9IG5ldyBKTVNF\neGNlcHRpb24oInJlY2VpdmUgZmFpbGVkLCBjbGllbnQgbm90IHN1YnNjcmli\nZWQgLi4gIiArIGUpOwogICAgICAgICAgICBqZS5zZXRMaW5rZWRFeGNlcHRp\nb24oZSk7CiAgICAgICAgICAgIHRocm93IGplOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzdG9wVG9waWNEZWxpdmVyeShTdHJpbmcgdG9w\naWNOYW1lLCBTdHJpbmcgc3Vic2NyaWJlZElkKSB0aHJvd3MgSk1TRXhjZXB0\naW9uIHsKICAgICAgICBpZiAobnVsbCA9PSBoZWR3aWdDbGllbnQpCiAgICAg\nICAgICB0aHJvdyBuZXcgamF2YXguam1zLklsbGVnYWxTdGF0ZUV4Y2VwdGlv\nbigic2Vzc2lvbiBpbiBjbG9zZWQgc3RhdGUsIGNhbnQgYWNrbm93bGVkZ2Ug\nbWVzc2FnZSIpOwoKICAgICAgICBEZWxpdmVyeVN0YXJ0SW5mbyBpbmZvID0g\nbmV3IERlbGl2ZXJ5U3RhcnRJbmZvKHRvcGljTmFtZSwgc3Vic2NyaWJlZElk\nKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKGRlbGl2ZXJ5U3RhcnRJbmZvU2V0\nKXsKICAgICAgICAgICAgZGVsaXZlcnlTdGFydEluZm9TZXQucmVtb3ZlKGlu\nZm8pOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaGVk\nd2lnQ2xpZW50LmdldFN1YnNjcmliZXIoKS5zdG9wRGVsaXZlcnkoQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0ZjgodG9waWNOYW1lKSwKICAgICAgICAgICAgICAg\nIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KHN1YnNjcmliZWRJZCkpOwogICAg\nICAgIH0gY2F0Y2ggKFB1YlN1YkV4Y2VwdGlvbi5DbGllbnROb3RTdWJzY3Jp\nYmVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgaWYgKGxvZ2dlci5pc1Ry\nYWNlRW5hYmxlZCgpKSBsb2dnZXIudHJhY2UoIkNsaWVudCBub3Qgc3Vic2Ny\naWJlZCBvciBhbHJlYWR5IHVuc3Vic2NyaWJlZCA/ICIsIGUpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydFRvcGljRGVsaXZlcnko\nU3RyaW5nIHRvcGljTmFtZSwgU3RyaW5nIHN1YnNjcmliZWRJZCkgdGhyb3dz\nIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKG51bGwgPT0gaGVkd2lnQ2xp\nZW50KQogICAgICAgICAgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3Rh\ndGVFeGNlcHRpb24oInNlc3Npb24gaW4gY2xvc2VkIHN0YXRlLCBjYW50IGFj\na25vd2xlZGdlIG1lc3NhZ2UiKTsKCiAgICAgICAgZmluYWwgRGVsaXZlcnlT\ndGFydEluZm8gaW5mbyA9IG5ldyBEZWxpdmVyeVN0YXJ0SW5mbyh0b3BpY05h\nbWUsIHN1YnNjcmliZWRJZCk7CiAgICAgICAgZmluYWwgYm9vbGVhbiBzdGFy\ndDsKICAgICAgICBzeW5jaHJvbml6ZWQgKGRlbGl2ZXJ5U3RhcnRJbmZvU2V0\nKXsKICAgICAgICAgICAgc3RhcnQgPSAgISBkZWxpdmVyeVN0YXJ0SW5mb1Nl\ndC5jb250YWlucyhpbmZvKTsKCiAgICAgICAgICAgIGlmIChzdGFydCkgewog\nICAgICAgICAgICAgICAgZGVsaXZlcnlTdGFydEluZm9TZXQuYWRkKGluZm8p\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoISBzdGFy\ndCkgewogICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkp\nIGxvZ2dlci5kZWJ1ZygiQ2xpZW50IGFscmVhZHkgc3RhcnRlZCBkZWxpdmVy\neSA/Iik7CiAgICAgICAgICAgIHJldHVybiA7CiAgICAgICAgfQoKICAgICAg\nICB0cnkgewogICAgICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVk\nKCkpIGxvZ2dlci50cmFjZSgiU3RhcnQgdG9waWMgZGVsaXZlcnkgZm9yICIg\nKyB0b3BpY05hbWUgKwogICAgICAgICAgICAgICAgIiwgc3Vic2NyaWJlcklk\nICIgKyBzdWJzY3JpYmVkSWQpOwogICAgICAgICAgICBoZWR3aWdDbGllbnQu\nZ2V0U3Vic2NyaWJlcigpLnN0YXJ0RGVsaXZlcnkoQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgodG9waWNOYW1lKSwKICAgICAgICAgICAgICAgIEJ5dGVTdHJp\nbmcuY29weUZyb21VdGY4KHN1YnNjcmliZWRJZCksIHRoaXMpOwogICAgICAg\nICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFj\nZSgiU3RhcnQgdG9waWMgZGVsaXZlcnkgZm9yICIgKyB0b3BpY05hbWUgKwog\nICAgICAgICAgICAgICAgIiwgc3Vic2NyaWJlcklkICIgKyBzdWJzY3JpYmVk\nSWQgKyAiIERPTkUiKTsKICAgICAgICB9IGNhdGNoIChQdWJTdWJFeGNlcHRp\nb24uQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgbG9nZ2VyLmRlYnVn\nKCJDbGllbnQgbm90IHN1YnNjcmliZWQgb3IgYWxyZWFkeSB1bnN1YnNjcmli\nZWQgPyAiLCBlKTsKICAgICAgICB9IGNhdGNoIChBbHJlYWR5U3RhcnREZWxp\ndmVyeUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNE\nZWJ1Z0VuYWJsZWQoKSkgbG9nZ2VyLmRlYnVnKCJDbGllbnQgYWxyZWFkeSBz\ndGFydGVkIGRlbGl2ZXJ5ID8gIiwgZSk7CiAgICAgICAgfQogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgZGVsaXZlcihCeXRlU3RyaW5n\nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZSBtc2csCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFs\nIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBmaW5hbCBPYmplY3QgY29udGV4\ndCkgewogICAgICAgIC8vIERlbGl2ZXIgdGhlIG1lc3NhZ2UgdG8gdGhlIHNl\nc3Npb24uCgogICAgICAgIGlmICh0aGlzLnN0b3BwZWQpIHsKICAgICAgICAg\nICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSBsb2dnZXIuZGVidWco\nIklnbm9yaW5nIG1lc3NhZ2Ugd2hpbGUgaW4gc3RvcHBlZCBtb2RlIC4uIHRv\ncGljIC0gIiArCiAgICAgICAgICAgICAgICB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSArICIsIHN1YnNjcmliZXIgLSAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5n\nVXRmOCgpICsgIiwgbXNnIC0gIiArIG1zZyk7CiAgICAgICAgICAgIHJldHVy\nbiA7CiAgICAgICAgfQoKICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFi\nbGVkKCkpIGxvZ2dlci50cmFjZSgicmVjaWV2ZWQgbWVzc2FnZSBmcm9tIHNl\ncnZlciA6IHRvcGljIC0gIiArCiAgICAgICAgICAgICAgICB0b3BpYy50b1N0\ncmluZ1V0ZjgoKSArICIsIHN1YnNjcmliZXIgLSAiICsgc3Vic2NyaWJlcklk\nLnRvU3RyaW5nVXRmOCgpICsgIiwgbXNnIC0gIiArIG1zZyk7CgogICAgICAg\nIC8vIEkgYW0gYXNzdW1pbmcgdGhhdCB3ZSBjYW4gZGVmZXIgdGhlIGFja25v\nd2xlZGdlbWVudCBvZiB0aGUgbWVzc2FnZSAuLi4KICAgICAgICBmaW5hbCBT\ndHJpbmcgdG9waWNOYW1lID0gdG9waWMudG9TdHJpbmdVdGY4KCk7CiAgICAg\nICAgZmluYWwgU3RyaW5nIHNpZCA9IHN1YnNjcmliZXJJZC50b1N0cmluZ1V0\nZjgoKTsKICAgICAgICBmaW5hbCBQdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQgc2VxSWQgPSBtc2cuZ2V0TXNnSWQoKTsKICAgICAgICBmaW5hbCBSdW5u\nYWJsZSBhY2sgPSBuZXcgUnVubmFibGUoKXsKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0\naW9uRmluaXNoZWQoY29udGV4dCwgbnVsbCk7CiAgICAgICAgICAgICAgICAv\nLyBPbmx5IHdoZW4gYXV0by1zZW5kIGlzIE5PVCBlbmFibGVkLgogICAgICAg\nICAgICAgICAgaWYgKCEgY29ubmVjdGlvbi5nZXRIZWR3aWdDbGllbnRDb25m\naWcoKS5pc0F1dG9TZW5kQ29uc3VtZU1lc3NhZ2VFbmFibGVkKCkpIHsKICAg\nICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAg\nICBzZW5kQWNrbm93bGVkZ2UodG9waWNOYW1lLCBzaWQsIHNlcUlkKTsKICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5k\nZWJ1ZygiVW5hYmxlIHRvIHNlbmQgYWNrbm93bGVkZ2VtZW50IC4uLiAiICsg\ndG9waWNOYW1lICsgIiwgIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgc2lkICsgIiwgc2VxSWQgOiAiICsgc2VxSWQpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgRGVidWdVdGlsLmR1bXBKTVNTdGFja3RyYWNl\nKGxvZ2dlciwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9OwoKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAo\nbG9nZ2VyLmlzVHJhY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgiUHVzaGlu\nZyB0byBzZXNzaW9uICIgKyBzZXNzaW9uKTsKCiAgICAgICAgICAgIE1lc3Nh\nZ2VJbXBsIG1lc3NhZ2VJbXBsID0gTWVzc2FnZVV0aWwucHJvY2Vzc0hlZHdp\nZ01lc3NhZ2Uoc2Vzc2lvbiwgbXNnLCB0b3BpY05hbWUsIHNpZCwgYWNrKTsK\nICAgICAgICAgICAgc2Vzc2lvbi5tZXNzYWdlUmVjZWl2ZWQobWVzc2FnZUlt\ncGwsIERlc3RpbmF0aW9uVHlwZS5UT1BJQyk7CiAgICAgICAgfSBjYXRjaCAo\nSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gVW5hYmxlIHRvIHBy\nb2Nlc3MgdGhlIGluY29taW5nIG1lc3NhZ2UgLSBsb2cgYW5kIGlnbm9yZSA/\nCiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewog\nICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJVbmFibGUgdG8gY29uc3Vt\nZSBtZXNzYWdlIik7CiAgICAgICAgICAgICAgICBEZWJ1Z1V0aWwuZHVtcEpN\nU1N0YWNrdHJhY2UobG9nZ2VyLCBlKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIGdldFN1YnNjcmliZXJJZChU\nb3BpY1N1YnNjcmliZXIgdG9waWNTdWJzY3JpYmVyKSB0aHJvd3MgSk1TRXhj\nZXB0aW9uIHsKICAgICAgICBpZiAoISAodG9waWNTdWJzY3JpYmVyIGluc3Rh\nbmNlb2YgVG9waWNTdWJzY3JpYmVySW1wbCkgKQogICAgICAgICAgdGhyb3cg\nbmV3IEpNU0V4Y2VwdGlvbigiVG9waWNTdWJzY3JpYmVyIG5vdCBpbnN0YW5j\nZW9mIG9mIFRvcGljU3Vic2NyaWJlckltcGwgPyAiICsKICAgICAgICAgICAg\nICB0b3BpY1N1YnNjcmliZXIuZ2V0Q2xhc3MoKSk7CgogICAgICAgIHJldHVy\nbiAoKFRvcGljU3Vic2NyaWJlckltcGwpIHRvcGljU3Vic2NyaWJlcikuZ2V0\nU3Vic2NyaWJlcklkKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgYm9vbGVhbiBlbnF1ZXVlUmVjZWl2ZWRNZXNzYWdlKE1lc3NhZ2VDb25z\ndW1lciBtZXNzYWdlQ29uc3VtZXIsIFNlc3Npb25JbXBsLlJlY2VpdmVkTWVz\nc2FnZSByZWNlaXZlZE1lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGJvb2xlYW4gYWRkRmlyc3QpIHRocm93cyBK\nTVNFeGNlcHRpb24gewogICAgICAgIGlmICghIChtZXNzYWdlQ29uc3VtZXIg\naW5zdGFuY2VvZiBUb3BpY1N1YnNjcmliZXJJbXBsKSApCiAgICAgICAgICB0\naHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJUb3BpY1N1YnNjcmliZXIgbm90IGlu\nc3RhbmNlb2Ygb2YgVG9waWNTdWJzY3JpYmVySW1wbCA/ICIgKwogICAgICAg\nICAgICAgIG1lc3NhZ2VDb25zdW1lci5nZXRDbGFzcygpKTsKCiAgICAgICAg\ncmV0dXJuICgoVG9waWNTdWJzY3JpYmVySW1wbCkgbWVzc2FnZUNvbnN1bWVy\nKS5lbnF1ZXVlUmVjZWl2ZWRNZXNzYWdlKHJlY2VpdmVkTWVzc2FnZSwgYWRk\nRmlyc3QpOwogICAgfQoKICAgIHB1YmxpYyBQdWJsaXNoZXIgZ2V0UHVibGlz\naGVyKCkgdGhyb3dzIGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24g\newogICAgICAgIGlmIChudWxsID09IGhlZHdpZ0NsaWVudCkKICAgICAgICAg\nIHRocm93IG5ldyBqYXZheC5qbXMuSWxsZWdhbFN0YXRlRXhjZXB0aW9uKCJz\nZXNzaW9uIGluIGNsb3NlZCBzdGF0ZSwgY2FudCBhY2tub3dsZWRnZSBtZXNz\nYWdlIik7CiAgICAgICAgcmV0dXJuIGhlZHdpZ0NsaWVudC5nZXRQdWJsaXNo\nZXIoKTsKICAgIH0KCiAgICBwdWJsaWMgU3RyaW5nIHB1Ymxpc2goU3RyaW5n\nIHRvcGljTmFtZSwgTWVzc2FnZUltcGwgbWVzc2FnZSkgdGhyb3dzIEpNU0V4\nY2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgUHViU3ViUHJv\ndG9jb2wuUHVibGlzaFJlc3BvbnNlIHJlc3BvbnNlID0gZ2V0UHVibGlzaGVy\nKCkucHVibGlzaCgKICAgICAgICAgICAgICAgIEJ5dGVTdHJpbmcuY29weUZy\nb21VdGY4KHRvcGljTmFtZSksIG1lc3NhZ2UuZ2VuZXJhdGVIZWR3aWdNZXNz\nYWdlKCkpOwogICAgICAgICAgICBQdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQgc2VxSWQgPQogICAgICAgICAgICAgICAgKG51bGwgIT0gcmVzcG9uc2Ug\nJiYgcmVzcG9uc2UuaGFzUHVibGlzaGVkTXNnSWQoKSA/IHJlc3BvbnNlLmdl\ndFB1Ymxpc2hlZE1zZ0lkKCkgOiBudWxsKTsKICAgICAgICAgICAgaWYgKG51\nbGwgPT0gc2VxSWQpewogICAgICAgICAgICAgICAgLy8gaWYgKGxvZ2dlci5p\nc0RlYnVnRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgLy8gbG9nZ2VyLmRl\nYnVnKCJVbmV4cGVjdGVkIE5PVCB0byByZWNlaXZlIHRoZSBzZXF1ZW5jZSBp\nZCBpbiByZXNwb25zZSB0byBwdWJsaXNoICIgKyByZXNwb25zZSk7CiAgICAg\nICAgICAgICAgICBsb2dnZXIud2FybigiVW5leHBlY3RlZCBOT1QgdG8gcmVj\nZWl2ZSB0aGUgc2VxdWVuY2UgaWQgaW4gcmVzcG9uc2UgdG8gcHVibGlzaCAi\nICsgcmVzcG9uc2UpOwogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBNZXNzYWdlVXRpbC5n\nZW5lcmF0ZUpNU01lc3NhZ2VJZEZyb21TZXFJZChzZXFJZCk7CiAgICAgICAg\nfSBjYXRjaCAoUHViU3ViRXhjZXB0aW9uLkNvdWxkTm90Q29ubmVjdEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIEpNU0V4Y2VwdGlvbiBqbXNFeCA9IG5l\ndyBKTVNFeGNlcHRpb24oIkNhbnQgcHVibGlzaCB0byAiICsgdG9waWNOYW1l\nICsgIiAuLiAiICsgZSk7CiAgICAgICAgICAgIGptc0V4LnNldExpbmtlZEV4\nY2VwdGlvbihlKTsKICAgICAgICAgICAgdGhyb3cgam1zRXg7CiAgICAgICAg\nfSBjYXRjaCAoUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgSk1TRXhjZXB0aW9uIGptc0V4ID0gbmV3IEpN\nU0V4Y2VwdGlvbigiQ2FudCBwdWJsaXNoIHRvICIgKyB0b3BpY05hbWUgKyAi\nIC4uICIgKyBlKTsKICAgICAgICAgICAgam1zRXguc2V0TGlua2VkRXhjZXB0\naW9uKGUpOwogICAgICAgICAgICB0aHJvdyBqbXNFeDsKICAgICAgICB9CiAg\nICB9CgogICAgLy8gUXVldWUgbWV0aG9kcyB3aGljaCBhcmUgTk9UIHN1cHBv\ncnRlZCB5ZXQuCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBRdWV1ZVNlbmRl\nciBjcmVhdGVRdWV1ZVNlbmRlcihEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbikg\ndGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgdGhyb3cgbmV3IEpNU0V4\nY2VwdGlvbigiaGVkd2lnIGRvZXMgbm90IHN1cHBvcnQgcXVldWVzIHlldCIp\nOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFF1ZXVlUmVjZWl2\nZXIgY3JlYXRlUXVldWVSZWNlaXZlcihEZXN0aW5hdGlvbiBkZXN0aW5hdGlv\nbikgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgdGhyb3cgbmV3IEpN\nU0V4Y2VwdGlvbigiaGVkd2lnIGRvZXMgbm90IHN1cHBvcnQgcXVldWVzIHll\ndCIpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIFF1ZXVlUmVj\nZWl2ZXIgY3JlYXRlUXVldWVSZWNlaXZlcihEZXN0aW5hdGlvbiBkZXN0aW5h\ndGlvbiwgU3RyaW5nIG1lc3NhZ2VTZWxlY3RvcikgdGhyb3dzIEpNU0V4Y2Vw\ndGlvbiB7CiAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiaGVkd2ln\nIGRvZXMgbm90IHN1cHBvcnQgcXVldWVzIHlldCIpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIFF1ZXVlUmVjZWl2ZXIgY3JlYXRlUXVldWVS\nZWNlaXZlcihEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbiwgU3RyaW5nIG1lc3Nh\nZ2VTZWxlY3RvciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYm9vbGVhbiBub0xvY2FsKSB0aHJvd3MgSk1TRXhjZXB0\naW9uIHsKICAgICAgICB0aHJvdyBuZXcgSk1TRXhjZXB0aW9uKCJoZWR3aWcg\nZG9lcyBub3Qgc3VwcG9ydCBxdWV1ZXMgeWV0Iik7CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgU3RyaW5nIGdldFN1YnNjcmliZXJJZChRdWV1\nZVJlY2VpdmVyIHF1ZXVlUmVjZWl2ZXIpIHRocm93cyBKTVNFeGNlcHRpb24g\newogICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24oImhlZHdpZyBkb2Vz\nIG5vdCBzdXBwb3J0IHF1ZXVlcyB5ZXQiKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIHN0b3BRdWV1ZURlbGl2ZXJ5KFN0cmluZyBx\ndWV1ZU5hbWUsIFN0cmluZyBzdWJzY3JpYmVkSWQpIHRocm93cyBKTVNFeGNl\ncHRpb24gewogICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24oImhlZHdp\nZyBkb2VzIG5vdCBzdXBwb3J0IHF1ZXVlcyB5ZXQiKTsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHN0YXJ0UXVldWVEZWxpdmVyeShT\ndHJpbmcgcXVldWVOYW1lLCBTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3Mg\nSk1TRXhjZXB0aW9uIHsKICAgICAgICB0aHJvdyBuZXcgSk1TRXhjZXB0aW9u\nKCJoZWR3aWcgZG9lcyBub3Qgc3VwcG9ydCBxdWV1ZXMgeWV0Iik7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgUXVldWVCcm93c2VyIGNyZWF0\nZUJyb3dzZXIoUXVldWUgcXVldWUpIHRocm93cyBKTVNFeGNlcHRpb24gewog\nICAgICAgIHRocm93IG5ldyBKTVNFeGNlcHRpb24oImhlZHdpZyBkb2VzIG5v\ndCBzdXBwb3J0IHF1ZXVlcyB5ZXQiKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyBRdWV1ZUJyb3dzZXIgY3JlYXRlQnJvd3NlcihRdWV1ZSBx\ndWV1ZSwgU3RyaW5nIG1lc3NhZ2VTZWxlY3RvcikgdGhyb3dzIEpNU0V4Y2Vw\ndGlvbiB7CiAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiaGVkd2ln\nIGRvZXMgbm90IHN1cHBvcnQgcXVldWVzIHlldCIpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIFRlbXBvcmFyeVRvcGljIGNyZWF0ZVRlbXBv\ncmFyeVRvcGljKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgdGhy\nb3cgbmV3IEpNU0V4Y2VwdGlvbigiaGVkd2lnIGRvZXMgbm90IHN1cHBvcnQg\ncXVldWVzIHlldCIpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGlj\nIFRlbXBvcmFyeVF1ZXVlIGNyZWF0ZVRlbXBvcmFyeVF1ZXVlKCkgdGhyb3dz\nIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgdGhyb3cgbmV3IEpNU0V4Y2VwdGlv\nbigiaGVkd2lnIGRvZXMgbm90IHN1cHBvcnQgcXVldWVzIHlldCIpOwogICAg\nfQoKfQo=\n","encoding":"base64"}

