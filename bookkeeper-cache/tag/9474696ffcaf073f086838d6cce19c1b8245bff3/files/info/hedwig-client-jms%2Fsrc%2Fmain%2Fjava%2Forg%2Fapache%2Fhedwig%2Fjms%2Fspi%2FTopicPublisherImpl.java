{"sha":"23dfb54126ce2030451f663593defea6d2399fb3","node_id":"MDQ6QmxvYjE1NzU5NTY6MjNkZmI1NDEyNmNlMjAzMDQ1MWY2NjM1OTNkZWZlYTZkMjM5OWZiMw==","size":9656,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/23dfb54126ce2030451f663593defea6d2399fb3","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuc3BpOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLmptcy5TZXNzaW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmptcy5tZXNzYWdlLk1lc3NhZ2VJbXBsOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuam1zLm1lc3NhZ2UuTWVzc2FnZVV0aWw7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZh\nY3Rvcnk7CgppbXBvcnQgamF2YXguam1zLkRlbGl2ZXJ5TW9kZTsKaW1wb3J0\nIGphdmF4Lmptcy5EZXN0aW5hdGlvbjsKaW1wb3J0IGphdmF4Lmptcy5JbnZh\nbGlkRGVzdGluYXRpb25FeGNlcHRpb247CmltcG9ydCBqYXZheC5qbXMuSk1T\nRXhjZXB0aW9uOwppbXBvcnQgamF2YXguam1zLk1lc3NhZ2U7CmltcG9ydCBq\nYXZheC5qbXMuVG9waWM7CmltcG9ydCBqYXZheC5qbXMuVG9waWNQdWJsaXNo\nZXI7CgovKioKICoKICovCnB1YmxpYyBjbGFzcyBUb3BpY1B1Ymxpc2hlcklt\ncGwgZXh0ZW5kcyBNZXNzYWdlUHJvZHVjZXJJbXBsIGltcGxlbWVudHMgVG9w\naWNQdWJsaXNoZXIgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dl\nciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUb3BpY1B1Ymxp\nc2hlckltcGwuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgSGVkd2lnTWVz\nc2FnaW5nU2Vzc2lvbkZhY2FkZSBmYWNhZGU7CiAgICBwcml2YXRlIGZpbmFs\nIFRvcGljIHRvcGljOwoKICAgIHB1YmxpYyBUb3BpY1B1Ymxpc2hlckltcGwo\nSGVkd2lnTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZSBmYWNhZGUsIFNlc3Npb25J\nbXBsIHNlc3Npb24sIFRvcGljIHRvcGljKSB7CiAgICAgICAgc3VwZXIoc2Vz\nc2lvbik7CiAgICAgICAgdGhpcy5mYWNhZGUgPSBmYWNhZGU7CiAgICAgICAg\ndGhpcy50b3BpYyA9IHRvcGljOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIFRvcGljIGdldFRvcGljKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7\nCiAgICAgICAgcmV0dXJuIHRvcGljOwogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgcHVibGlzaChNZXNzYWdlIG1lc3NhZ2UpIHRocm93\ncyBKTVNFeGNlcHRpb24gewogICAgICAgIGlmIChudWxsID09IGdldFRvcGlj\nKCkpIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigi\nTmVlZCB0byBzcGVjaWZ5IHRvcGljIik7CiAgICAgICAgcHVibGlzaChnZXRU\nb3BpYygpLCBtZXNzYWdlKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIHB1Ymxpc2goVG9waWMgdG9waWMsIE1lc3NhZ2UgbWVzc2Fn\nZSkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgcHVibGlzaCh0b3Bp\nYywgbWVzc2FnZSwgZ2V0RGVsaXZlcnlNb2RlKCksIGdldFByaW9yaXR5KCks\nIGdldFRpbWVUb0xpdmUoKSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBwdWJsaXNoKE1lc3NhZ2UgbWVzc2FnZSwgaW50IGRlbGl2\nZXJ5TW9kZSwgaW50IHByaW9yaXR5LCBsb25nIHRpbWVUb0xpdmUpIHRocm93\ncyBKTVNFeGNlcHRpb24gewogICAgICAgIGlmIChudWxsID09IGdldFRvcGlj\nKCkpIHRocm93IG5ldyBVbnN1cHBvcnRlZE9wZXJhdGlvbkV4Y2VwdGlvbigi\nTmVlZCB0byBzcGVjaWZ5IHRvcGljIik7CiAgICAgICAgcHVibGlzaChnZXRU\nb3BpYygpLCBtZXNzYWdlLCBkZWxpdmVyeU1vZGUsIHByaW9yaXR5LCB0aW1l\nVG9MaXZlKTsKICAgIH0KCiAgICAvLyBhbGwgcHVibGlzaC9zZW5kIG1ldGhv\nZHMgZGVsZWdhdGUgdG8gdGhpcyAuLi4KICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgcHVibGlzaChmaW5hbCBUb3BpYyB0b3BpYywgZmluYWwgTWVz\nc2FnZSBtZXNzYWdlLCBmaW5hbCBpbnQgZGVsaXZlcnlNb2RlLAogICAgICAg\nICAgICAgICAgICAgICAgICBmaW5hbCBpbnQgcHJpb3JpdHksIGZpbmFsIGxv\nbmcgdGltZVRvTGl2ZSkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CgogICAgICAg\nIC8vIFNpbXVsYXRpbmcgdGhpcyBpbiBwcm92aWRlciAuLi4KICAgICAgICAv\nLyBpZiAoMCAhPSB0aW1lVG9MaXZlKSB0aHJvdyBuZXcgSk1TRXhjZXB0aW9u\nKCJXZSBkbyBub3Qgc3VwcG9ydCBUVEwgZm9yIG1lc3NhZ2VzIHJpZ2h0IG5v\ndy4KICAgICAgICAvLyBTcGVjaWZpZWQgVFRMIDogIiArIHRpbWVUb0xpdmUp\nOwoKICAgICAgICBpZiAoTWVzc2FnZVByb2R1Y2VySW1wbC5ERUZBVUxUX1BS\nSU9SSVRZICE9IHByaW9yaXR5KSB7CiAgICAgICAgICAgIGlmIChsb2dnZXIu\naXNJbmZvRW5hYmxlZCgpKQogICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJX\nZSBkbyBub3Qgc3VwcG9ydCBtZXNzYWdlIHByaW9yaXRpZXMgcmlnaHQgbm93\nLiBTcGVjaWZpZWQgcHJpb3JpdHkgOiAiICsgcHJpb3JpdHkpOwogICAgICAg\nIH0KICAgICAgICBpZiAoRGVsaXZlcnlNb2RlLlBFUlNJU1RFTlQgIT0gZGVs\naXZlcnlNb2RlKSB7CiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNJbmZvRW5h\nYmxlZCgpKQogICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJXZSBzdXBwb3J0\nIG9ubHkgUEVSU0lTVEVOVCBkZWxpdmVyeSBtb2RlLiBVbnN1cHBvcnRlZCBt\nb2RlIDogIiArIGRlbGl2ZXJ5TW9kZSk7CiAgICAgICAgfQoKICAgICAgICBp\nZiAobnVsbCA9PSB0b3BpYyl7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkRGVzdGluYXRpb25FeGNlcHRpb24oIlRvcGljIG11c3QgYmUgc3BlY2lm\naWVkIHRvIHB1Ymxpc2giKTsKICAgICAgICB9CgogICAgICAgIGZpbmFsIE1l\nc3NhZ2VJbXBsIGNvcGllZE1lc3NhZ2VJbXBsOwogICAgICAgIGlmIChtZXNz\nYWdlIGluc3RhbmNlb2YgTWVzc2FnZUltcGwpIGNvcGllZE1lc3NhZ2VJbXBs\nID0gTWVzc2FnZVV0aWwuY3JlYXRlQ2xvbmVGb3JEaXNwYXRjaCgKICAgICAg\nICAgICAgZ2V0U2Vzc2lvbigpLCAoTWVzc2FnZUltcGwpIG1lc3NhZ2UsIHRv\ncGljLmdldFRvcGljTmFtZSgpLCBudWxsKTsKICAgICAgICBlbHNlIGNvcGll\nZE1lc3NhZ2VJbXBsID0gTWVzc2FnZVV0aWwuY3JlYXRlTWVzc2FnZUNvcHko\nZ2V0U2Vzc2lvbigpLCBtZXNzYWdlKTsKCiAgICAgICAgLy8gTm90ZTogRW5z\ndXJlIHRoYXQgd2Ugc2V0IHByb3BlcnRpZXMgYmVsb3cgb24gYm90aCBtZXNz\nYWdlICh1c2VyIGlucHV0KSBhbmQgY29waWVkTWVzc2FnZUltcGwKICAgICAg\nICAvLyAodGhlIGNsb25lZC9jb3BpZWQgbWVzc2FnZSkuCiAgICAgICAgLy8g\nV2UgYXJlIGRvaW5nIHNldCBvbiBib3RoIGluc3RlYWQgb2Ygc2V0IGZvbGxv\nd2VkIGJ5IGNsb3NlL2NvcHkgdG8gcHJldmVudCBjYXNlcyB3aGVyZSBtZXNz\nYWdlCiAgICAgICAgLy8gaW1wbGVtZW50YXRpb24gZHJvcHMKICAgICAgICAv\nLyBoZWFkZXJzIChsaWtlIG91ciBvd24gaW1wbCBlYXJsaWVyICEpCgogICAg\nICAgIC8vIHByaW9yaXR5IC4uLgogICAgICAgIHsKICAgICAgICAgICAgLy8g\nU2V0IHRoZSBtZXNzYWdlIHByaW9yaXR5CiAgICAgICAgICAgIC8vIDMuNC4x\nMCBKTVNQcmlvcml0eSAiV2hlbiBhIG1lc3NhZ2UgaXMgc2VudCwgdGhpcyBm\naWVsZCBpcyBpZ25vcmVkLiBBZnRlciBjb21wbGV0aW9uIG9mCiAgICAgICAg\nICAgIC8vIHRoZSBzZW5kLCBpdCBob2xkcyB0aGUgdmFsdWUgc3BlY2lmaWVk\nIGJ5IHRoZSBtZXRob2Qgc2VuZGluZyB0aGUgbWVzc2FnZS4iCiAgICAgICAg\nICAgIC8vIE9uIG90aGVyIGhhbmQsIHdlIGhhdmUKICAgICAgICAgICAgLy8g\nMy40LjEyIE92ZXJyaWRpbmcgTWVzc2FnZSBIZWFkZXIgRmllbGRzIDogIkpN\nUyBwZXJtaXRzIGFuIGFkbWluaXN0cmF0b3IgdG8gY29uZmlndXJlCiAgICAg\nICAgICAgIC8vIEpNUyB0byBvdmVycmlkZSB0aGUgY2xpZW50LXNwZWNpZmll\nZAogICAgICAgICAgICAvLyB2YWx1ZXMgZm9yIEpNU0RlbGl2ZXJ5TW9kZSwg\nSk1TRXhwaXJhdGlvbiBhbmQgSk1TUHJpb3JpdHkuIElmIHRoaXMgaXMgZG9u\nZSwgdGhlIGhlYWRlcgogICAgICAgICAgICAvLyBmaWVsZCB2YWx1ZSBtdXN0\nIHJlZmxlY3QgdGhlCiAgICAgICAgICAgIC8vIGFkbWluaXN0cmF0aXZlbHkg\nc3BlY2lmaWVkIHZhbHVlLiIKICAgICAgICAgICAgLy8gRm9yIG5vdywgdG8g\ndW5ibG9jayB0ZXN0Y2FzZXMsIHNldHRpbmcgdG8gbXNnUHJpb3JpdHkgOi0p\nIEFjdHVhbGx5LCBJIHRoaW5rIHdlIHNob3VsZAogICAgICAgICAgICAvLyBz\nZXQgaXQgdG8gTWVzc2FnZS5ERUZBVUxUX1BSSU9SSVRZIC4uLgogICAgICAg\nICAgICBtZXNzYWdlLnNldEpNU1ByaW9yaXR5KHByaW9yaXR5KTsKICAgICAg\nICAgICAgY29waWVkTWVzc2FnZUltcGwuc2V0Sk1TUHJpb3JpdHkocHJpb3Jp\ndHkpOwogICAgICAgICAgICAvLyBtZXNzYWdlLnNldEpNU1ByaW9yaXR5KE1l\nc3NhZ2UuREVGQVVMVF9QUklPUklUWSk7CiAgICAgICAgICAgIC8vIGNvcGll\nZE1lc3NhZ2VJbXBsLnNldEpNU1ByaW9yaXR5KE1lc3NhZ2UuREVGQVVMVF9Q\nUklPUklUWSk7CiAgICAgICAgfQoKICAgICAgICAvLyBkZWxpdmVyeSBtb2Rl\nIC4uLgogICAgICAgIHsKCiAgICAgICAgICAgIC8vIDMuNC4yIEpNU0RlbGl2\nZXJ5TW9kZSAiVGhlIEpNU0RlbGl2ZXJ5TW9kZSBoZWFkZXIgZmllbGQgY29u\ndGFpbnMgdGhlIGRlbGl2ZXJ5IG1vZGUKICAgICAgICAgICAgLy8gc3BlY2lm\naWVkIHdoZW4gdGhlIG1lc3NhZ2Ugd2FzIHNlbnQuCiAgICAgICAgICAgIC8v\nIFdoZW4gYSBtZXNzYWdlIGlzIHNlbnQsIHRoaXMgZmllbGQgaXMgaWdub3Jl\nZC4gQWZ0ZXIgY29tcGxldGlvbiBvZiB0aGUgc2VuZCwgaXQgaG9sZHMKICAg\nICAgICAgICAgLy8gdGhlIGRlbGl2ZXJ5IG1vZGUgc3BlY2lmaWVkIGJ5IHRo\nZSBzZW5kaW5nIG1ldGhvZC4iCiAgICAgICAgICAgIG1lc3NhZ2Uuc2V0Sk1T\nRGVsaXZlcnlNb2RlKGRlbGl2ZXJ5TW9kZSk7CiAgICAgICAgICAgIGNvcGll\nZE1lc3NhZ2VJbXBsLnNldEpNU0RlbGl2ZXJ5TW9kZShkZWxpdmVyeU1vZGUp\nOwogICAgICAgIH0KCiAgICAgICAgLy8gZGVzdGluYXRpb24gLi4uCiAgICAg\nICAgewogICAgICAgICAgICAvLyAzLjQuMSBKTVNEZXN0aW5hdGlvbiAiVGhl\nIEpNU0Rlc3RpbmF0aW9uIGhlYWRlciBmaWVsZCBjb250YWlucyB0aGUgZGVz\ndGluYXRpb24gdG8gd2hpY2gKICAgICAgICAgICAgLy8gdGhlIG1lc3NhZ2Ug\naXMgYmVpbmcgc2VudC4KICAgICAgICAgICAgLy8gV2hlbiBhIG1lc3NhZ2Ug\naXMgc2VudCwgdGhpcyBmaWVsZCBpcyBpZ25vcmVkLiBBZnRlciBjb21wbGV0\naW9uIG9mIHRoZSBzZW5kLCBpdCBob2xkcwogICAgICAgICAgICAvLyB0aGUg\nZGVzdGluYXRpb24gb2JqZWN0CiAgICAgICAgICAgIC8vIHNwZWNpZmllZCBi\neSB0aGUgc2VuZGluZyBtZXRob2QuIFdoZW4gYSBtZXNzYWdlIGlzIHJlY2Vp\ndmVkLCBpdHMgZGVzdGluYXRpb24gdmFsdWUKICAgICAgICAgICAgLy8gbXVz\ndCBiZSBlcXVpdmFsZW50IHRvIHRoZQogICAgICAgICAgICAvLyB2YWx1ZSBh\nc3NpZ25lZCB3aGVuIGl0IHdhcyBzZW50LiIKICAgICAgICAgICAgbWVzc2Fn\nZS5zZXRKTVNEZXN0aW5hdGlvbihnZXRTZXNzaW9uKCkuY3JlYXRlVG9waWMo\ndG9waWMuZ2V0VG9waWNOYW1lKCkpKTsKICAgICAgICAgICAgY29waWVkTWVz\nc2FnZUltcGwuc2V0Sk1TRGVzdGluYXRpb24oZ2V0U2Vzc2lvbigpLmNyZWF0\nZVRvcGljKHRvcGljLmdldFRvcGljTmFtZSgpKSk7CiAgICAgICAgfQoKICAg\nICAgICB7CiAgICAgICAgICAgIC8vIDMuNC40IEpNU1RpbWVzdGFtcAogICAg\nICAgICAgICAvLyAiVGhlIEpNU1RpbWVzdGFtcCBoZWFkZXIgZmllbGQgY29u\ndGFpbnMgdGhlIHRpbWUgYSBtZXNzYWdlIHdhcyBoYW5kZWQgb2ZmIHRvIGEg\ncHJvdmlkZXIgdG8gYmUgc2VudC4KICAgICAgICAgICAgLy8gSXQgaXMgbm90\nIHRoZSB0aW1lIHRoZSBtZXNzYWdlIHdhcyBhY3R1YWxseSB0cmFuc21pdHRl\nZCBiZWNhdXNlIHRoZSBhY3R1YWwgc2VuZCBtYXkgb2NjdXIgbGF0ZXIKICAg\nICAgICAgICAgLy8gZHVlIHRvIHRyYW5zYWN0aW9ucyBvciBvdGhlciBjbGll\nbnQgc2lkZSBxdWV1ZWluZyBvZiBtZXNzYWdlcy4iCiAgICAgICAgICAgIGZp\nbmFsIGxvbmcgdGltZXN0YW1wID0gU2Vzc2lvbkltcGwuY3VycmVudFRpbWVN\naWxsaXMoKTsKICAgICAgICAgICAgbWVzc2FnZS5zZXRKTVNUaW1lc3RhbXAo\ndGltZXN0YW1wKTsKICAgICAgICAgICAgY29waWVkTWVzc2FnZUltcGwuc2V0\nSk1TVGltZXN0YW1wKHRpbWVzdGFtcCk7CiAgICAgICAgfQoKICAgICAgICBp\nZiAodGltZVRvTGl2ZSA+IDApIHsKICAgICAgICAgICAgZmluYWwgbG9uZyBl\neHBpcnlUaW1lID0gU2Vzc2lvbkltcGwuY3VycmVudFRpbWVNaWxsaXMoKSAr\nIHRpbWVUb0xpdmU7CiAgICAgICAgICAgIG1lc3NhZ2Uuc2V0Sk1TRXhwaXJh\ndGlvbihleHBpcnlUaW1lKTsKICAgICAgICAgICAgY29waWVkTWVzc2FnZUlt\ncGwuc2V0Sk1TRXhwaXJhdGlvbihleHBpcnlUaW1lKTsKICAgICAgICB9CiAg\nICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIG5vIGV4cGlyeS4KICAgICAg\nICAgICAgbWVzc2FnZS5zZXRKTVNFeHBpcmF0aW9uKDApOwogICAgICAgIH0K\nCgogICAgICAgIGlmIChnZXRTZXNzaW9uKCkuZ2V0VHJhbnNhY3RlZCgpKXsK\nICAgICAgICAgICAgLy8gZW5xdWV1ZSBpZiB3aXRoaW4gdHJhbnNhY3Rpb25z\nLgogICAgICAgICAgICBnZXRTZXNzaW9uKCkuZW5xdWV1ZVB1Ymxpc2hXaXRo\naW5UcmFuc2FjdGlvbih0b3BpYy5nZXRUb3BpY05hbWUoKSwgY29waWVkTWVz\nc2FnZUltcGwsIG1lc3NhZ2UpOwogICAgICAgICAgICByZXR1cm4gOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpKSBs\nb2dnZXIudHJhY2UoIlB1Ymxpc2hpbmcgbWVzc2FnZSAuLi4gcmVjZXBpZW50\nICIgKyB0b3BpYy5nZXRUb3BpY05hbWUoKSk7CiAgICAgICAgLy8gZmFjYWRl\nLmdldFB1Ymxpc2hlcigpLnB1Ymxpc2goQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgodG9waWMuZ2V0VG9waWNOYW1lKCkpLAogICAgICAgIC8vIGNvcGllZE1l\nc3NhZ2VJbXBsLmdlbmVyYXRlSGVkd2lnTWVzc2FnZSh0aGlzKSk7CiAgICAg\nICAgU3RyaW5nIG1zZ0lkID0gZmFjYWRlLnB1Ymxpc2godG9waWMuZ2V0VG9w\naWNOYW1lKCksIGNvcGllZE1lc3NhZ2VJbXBsKTsKICAgICAgICBnZXRTZXNz\naW9uKCkuYWRkVG9Mb2NhbGx5UHVibGlzaGVkTWVzc2FnZUlkcyhtc2dJZCk7\nCiAgICAgICAgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiBNZXNzYWdlSW1wbCkg\nKChNZXNzYWdlSW1wbCkgbWVzc2FnZSkuc2V0Sk1TTWVzc2FnZUlESW50ZXJu\nYWwobXNnSWQpOwogICAgICAgIGVsc2UgbWVzc2FnZS5zZXRKTVNNZXNzYWdl\nSUQobXNnSWQpOwoKICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVk\nKCkpIGxvZ2dlci50cmFjZSgiUHVibGlzaGluZyBtZXNzYWdlIC4uLiByZWNl\ncGllbnQgIiArCiAgICAgICAgICAgIHRvcGljLmdldFRvcGljTmFtZSgpICsg\nIiwgbXNnSWQgOiAiICsgbXNnSWQgKyAiIERPTkUiKTsKCiAgICAgICAgLy8g\nVGhpcyBpcyBub3QgcmVxdWlyZWQsIHdlIGFscmVhZHkgZG8gdGhpcyBhcyBw\nYXJ0IG9mIGNvcGllZE1lc3NhZ2VJbXBsLmdlbmVyYXRlSGVkd2lnTWVzc2Fn\nZSgpCiAgICAgICAgLy8gbWVzc2FnZS5zZXRKTVNUaW1lc3RhbXAoU2Vzc2lv\nbkltcGwuY3VycmVudFRpbWVNaWxsaXMoKSk7CgogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIERlc3RpbmF0aW9uIGdldERlc3RpbmF0aW9uKCkg\ndGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIHRvcGljOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY2xvc2UoKSB0\naHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICAvLyBUaGlzIHdpbGwgYmUg\nYSBub29wIGFjdHVhbGx5IC4uLiBzZXNzaW9uLmNsb3NlKCkgdGFrZXMgY2Fy\nZSBvZiBjbG9zaW5nIHRoZSBwdWJsaXNoZXIuCiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBzZW5kKE1lc3NhZ2UgbWVzc2FnZSkgdGhy\nb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgcHVibGlzaChtZXNzYWdlKTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNlbmQoRGVz\ndGluYXRpb24gZGVzdGluYXRpb24sIE1lc3NhZ2UgbWVzc2FnZSkgdGhyb3dz\nIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCEoZGVzdGluYXRpb24gaW5z\ndGFuY2VvZiBUb3BpYykpCiAgICAgICAgICB0aHJvdyBuZXcgSk1TRXhjZXB0\naW9uKCJFeHBlY3RlZCBkZXN0aW5hdGlvbiB0byBiZSBhIFRvcGljIDogIiAr\nIGRlc3RpbmF0aW9uKTsKICAgICAgICBwdWJsaXNoKChUb3BpYykgZGVzdGlu\nYXRpb24sIG1lc3NhZ2UpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgc2VuZChNZXNzYWdlIG1lc3NhZ2UsIGludCBkZWxpdmVyeU1v\nZGUsIGludCBwcmlvcml0eSwgbG9uZyB0aW1lVG9MaXZlKSB0aHJvd3MgSk1T\nRXhjZXB0aW9uIHsKICAgICAgICBwdWJsaXNoKG1lc3NhZ2UsIGRlbGl2ZXJ5\nTW9kZSwgcHJpb3JpdHksIHRpbWVUb0xpdmUpOwogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgc2VuZChEZXN0aW5hdGlvbiBkZXN0aW5h\ndGlvbiwgTWVzc2FnZSBtZXNzYWdlLCBpbnQgZGVsaXZlcnlNb2RlLAogICAg\nICAgICAgICAgICAgICAgICBpbnQgcHJpb3JpdHksIGxvbmcgdGltZVRvTGl2\nZSkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCEoZGVzdGlu\nYXRpb24gaW5zdGFuY2VvZiBUb3BpYykpCiAgICAgICAgICB0aHJvdyBuZXcg\nSk1TRXhjZXB0aW9uKCJFeHBlY3RlZCBkZXN0aW5hdGlvbiB0byBiZSBhIFRv\ncGljIDogIiArIGRlc3RpbmF0aW9uKTsKCiAgICAgICAgcHVibGlzaCgoVG9w\naWMpIGRlc3RpbmF0aW9uLCBtZXNzYWdlLCBkZWxpdmVyeU1vZGUsIHByaW9y\naXR5LCB0aW1lVG9MaXZlKTsKICAgIH0KfQo=\n","encoding":"base64"}

