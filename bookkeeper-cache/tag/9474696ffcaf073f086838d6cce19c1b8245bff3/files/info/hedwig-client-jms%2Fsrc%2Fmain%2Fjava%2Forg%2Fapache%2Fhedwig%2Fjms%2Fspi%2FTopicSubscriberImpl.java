{"sha":"4a51e8dd8eb2cccd68cfd5661c011fc31bfba520","node_id":"MDQ6QmxvYjE1NzU5NTY6NGE1MWU4ZGQ4ZWIyY2NjZDY4Y2ZkNTY2MWMwMTFmYzMxYmZiYTUyMA==","size":11300,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4a51e8dd8eb2cccd68cfd5661c011fc31bfba520","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuc3BpOwoKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLmptcy5TZXNzaW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmptcy5EZWJ1Z1V0aWw7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQg\namF2YXguam1zLkludmFsaWRTZWxlY3RvckV4Y2VwdGlvbjsKaW1wb3J0IGph\ndmF4Lmptcy5KTVNFeGNlcHRpb247CmltcG9ydCBqYXZheC5qbXMuTWVzc2Fn\nZTsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlTGlzdGVuZXI7CmltcG9ydCBq\nYXZheC5qbXMuVG9waWM7CmltcG9ydCBqYXZheC5qbXMuVG9waWNTdWJzY3Jp\nYmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CgovKioK\nICogU3Vic2NyaWJlciB0byBhIHRvcGljLgogKgogKi8KcHVibGljIGNsYXNz\nIFRvcGljU3Vic2NyaWJlckltcGwgZXh0ZW5kcyBNZXNzYWdlQ29uc3VtZXJJ\nbXBsIGltcGxlbWVudHMgVG9waWNTdWJzY3JpYmVyIHsKCiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5n\nZXRMb2dnZXIoVG9waWNTdWJzY3JpYmVySW1wbC5jbGFzcyk7CgogICAgcHJp\ndmF0ZSBmaW5hbCBTZXNzaW9uSW1wbCBzZXNzaW9uOwogICAgcHJpdmF0ZSBm\naW5hbCBUb3BpYyB0b3BpYzsKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIHN1\nYnNjcmliZXJJZDsKICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiBub0xvY2Fs\nOwoKICAgIHByaXZhdGUgZmluYWwgYm9vbGVhbiBmb3JjZVVuc3Vic2NyaWJl\nOwogICAgcHJpdmF0ZSB2b2xhdGlsZSBib29sZWFuIHJlZ2lzdGVyZWQgPSBm\nYWxzZTsKICAgIHByaXZhdGUgYm9vbGVhbiBjbG9zZWQgPSBmYWxzZTsKCiAg\nICAvLyBBbnkgcHVibGljYWxseSBleHBvc2VkIG9iamVjdCBNVVNUIE5PVCBy\nZWx5IG9uICd0aGlzJyBmb3IgaXRzIGxvY2tpbmcgc2VtYW50aWNzIHVubGVz\ncyBpdCBpcwogICAgLy8gZXhwbGljaXRseSBleHBvc2luZyB0aGlzIGJlaGF2\naW9yLgogICAgcHJpdmF0ZSBmaW5hbCBPYmplY3QgbG9ja09iamVjdCA9IG5l\ndyBPYmplY3QoKTsKICAgIHByaXZhdGUgZmluYWwgTGlua2VkTGlzdDxTZXNz\naW9uSW1wbC5SZWNlaXZlZE1lc3NhZ2U+IHBlbmRpbmdNZXNzYWdlTGlzdAog\nICAgICAgID0gbmV3IExpbmtlZExpc3Q8U2Vzc2lvbkltcGwuUmVjZWl2ZWRN\nZXNzYWdlPigpOwoKICAgIHB1YmxpYyBUb3BpY1N1YnNjcmliZXJJbXBsKFNl\nc3Npb25JbXBsIHNlc3Npb24sIFRvcGljIHRvcGljLCBTdHJpbmcgc3Vic2Ny\naWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbGVh\nbiBmb3JjZVVuc3Vic2NyaWJlKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAg\nICAgICBzdXBlcihudWxsKTsKICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNz\naW9uOwogICAgICAgIHRoaXMudG9waWMgPSB0b3BpYzsKICAgICAgICB0aGlz\nLnN1YnNjcmliZXJJZCA9IHN1YnNjcmliZXJJZDsKICAgICAgICAvLyBkZWZh\ndWx0IGlzIGZhbHNlIHJpZ2h0ID8KICAgICAgICB0aGlzLm5vTG9jYWwgPSBm\nYWxzZTsKICAgICAgICB0aGlzLmZvcmNlVW5zdWJzY3JpYmUgPSBmb3JjZVVu\nc3Vic2NyaWJlOwoKICAgICAgICAvLyBJIGFtIG5vdCBzdXJlIGlmIHdlIGhh\ndmUgdG8gcmVnaXN0ZXIgd2l0aCBzZXNzaW9uIGltbWVkaWF0ZWx5IG9uIGNy\nZWF0ZSBvciBub3QgLi4uCiAgICAgICAgcmVnaXN0ZXJXaXRoU2Vzc2lvbigp\nOwogICAgfQoKICAgIHB1YmxpYyBUb3BpY1N1YnNjcmliZXJJbXBsKFNlc3Np\nb25JbXBsIHNlc3Npb24sIFRvcGljIHRvcGljLCBTdHJpbmcgc3Vic2NyaWJl\ncklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIG1l\nc3NhZ2VTZWxlY3RvciwgYm9vbGVhbiBub0xvY2FsLCBib29sZWFuIGZvcmNl\nVW5zdWJzY3JpYmUpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIHN1\ncGVyKG1lc3NhZ2VTZWxlY3Rvcik7CiAgICAgICAgdGhpcy5zZXNzaW9uID0g\nc2Vzc2lvbjsKICAgICAgICB0aGlzLnRvcGljID0gdG9waWM7CiAgICAgICAg\ndGhpcy5zdWJzY3JpYmVySWQgPSBzdWJzY3JpYmVySWQ7CgogICAgICAgIHRo\naXMubm9Mb2NhbCA9IG5vTG9jYWw7CiAgICAgICAgdGhpcy5mb3JjZVVuc3Vi\nc2NyaWJlID0gZm9yY2VVbnN1YnNjcmliZTsKCiAgICAgICAgaWYgKG51bGwg\nPT0gZ2V0U2VsZWN0b3JBc3QoKSl7CiAgICAgICAgICAgIC8vIE9ubHkgaWYg\nTk9UIGVtcHR5IHN0cmluZyAtIHRyZWF0IGVtcHR5IHN0cmluZyBhcyBudWxs\nIHNlbGVjdG9yIHNwZWMuCiAgICAgICAgICAgIGlmIChudWxsICE9IG1lc3Nh\nZ2VTZWxlY3RvciAmJiAwICE9IG1lc3NhZ2VTZWxlY3Rvci50cmltKCkubGVu\nZ3RoKCkpewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEludmFsaWRTZWxl\nY3RvckV4Y2VwdGlvbigiSW52YWxpZCBzZWxlY3RvciBzcGVjaWZpZWQgJyIg\nKyBtZXNzYWdlU2VsZWN0b3IgKyAiJyIpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIGVsc2UgewogICAgICAgICAgICBzZXNzaW9uLnJlZ2lz\ndGVyVG9waWNTdWJzY3JpcHRpb25JbmZvKG5ldyBTZXNzaW9uSW1wbC5Ub3Bp\nY1N1YnNjcmlwdGlvbih0b3BpYy5nZXRUb3BpY05hbWUoKSwKICAgICAgICAg\nICAgICAgIHN1YnNjcmliZXJJZCksIGdldFNlbGVjdG9yQXN0KCkpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gSSBhbSBub3Qgc3VyZSBpZiB3ZSBoYXZlIHRv\nIHJlZ2lzdGVyIHdpdGggc2Vzc2lvbiBpbW1lZGlhdGVseSBvbiBjcmVhdGUg\nb3Igbm90IC4uLgogICAgICAgIHJlZ2lzdGVyV2l0aFNlc3Npb24oKTsKICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBUb3BpYyBnZXRUb3BpYygp\nIHsKICAgICAgICByZXR1cm4gdG9waWM7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgYm9vbGVhbiBnZXROb0xvY2FsKCkgewogICAgICAgIHJl\ndHVybiBub0xvY2FsOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0U3Vi\nc2NyaWJlcklkKCkgewogICAgICAgIHJldHVybiBzdWJzY3JpYmVySWQ7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXRNZXNzYWdl\nTGlzdGVuZXIoTWVzc2FnZUxpc3RlbmVyIG1lc3NhZ2VMaXN0ZW5lcikgdGhy\nb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc2V0TWVzc2FnZUxp\nc3RlbmVyKG1lc3NhZ2VMaXN0ZW5lcik7CiAgICAgICAgcmVnaXN0ZXJXaXRo\nU2Vzc2lvbigpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCByZWdpc3Rlcldp\ndGhTZXNzaW9uKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CgogICAgICAgIC8v\nIEZhaWwgZmFzdCAuLi4gdm9sYXRpbGUgcGVyZiBoaXQgaXMgb2sgaW4gY29t\ncGFyaXNvbiB0byByZXN0LgogICAgICAgIGlmICh0aGlzLnJlZ2lzdGVyZWQp\nIHJldHVybiA7CgogICAgICAgIGZpbmFsIGJvb2xlYW4gcmVnaXN0ZXI7CiAg\nICAgICAgc3luY2hyb25pemVkIChsb2NrT2JqZWN0KXsKICAgICAgICAgICAg\nLy8gaWYgKGNsb3NlZCkgdGhyb3cgbmV3IEpNU0V4Y2VwdGlvbigiQWxyZWFk\neSBjbG9zZWQiKTsKICAgICAgICAgICAgaWYgKGNsb3NlZCkgcmV0dXJuIDsK\nCiAgICAgICAgICAgIGlmICghdGhpcy5yZWdpc3RlcmVkKSB7CiAgICAgICAg\nICAgICAgICB0aGlzLnJlZ2lzdGVyZWQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgcmVnaXN0ZXIgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGVsc2UgcmVnaXN0ZXIgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYg\nKHJlZ2lzdGVyKSB0aGlzLnNlc3Npb24ucmVnaXN0ZXJUb3BpY1N1YnNjcmli\nZXIodGhpcyk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTWVz\nc2FnZSByZWNlaXZlKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAg\ncmV0dXJuIHJlY2VpdmUoMCk7CiAgICB9CgoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIE1lc3NhZ2UgcmVjZWl2ZShmaW5hbCBsb25nIG1heFRpbWVvdXQp\nIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIHJldHVybiByZWNlaXZl\nSW1wbChtYXhUaW1lb3V0LCB0cnVlKTsKICAgIH0KCiAgICBwcml2YXRlIE1l\nc3NhZ2UgcmVjZWl2ZUltcGwoZmluYWwgbG9uZyBtYXhUaW1lb3V0LCBib29s\nZWFuIGNhbldhaXQpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIGZp\nbmFsIGxvbmcgd2FpdFRpbWVvdXQ7CiAgICAgICAgZmluYWwgbG9uZyBzdGFy\ndFRpbWU7CgogICAgICAgIC8vIHBlcmlvZGljYWxseSB3YWtlIHVwICEKICAg\nICAgICBpZiAoY2FuV2FpdCl7CiAgICAgICAgICAgIGlmIChtYXhUaW1lb3V0\nIDw9IDApIHdhaXRUaW1lb3V0ID0gMTAwMDsKICAgICAgICAgICAgZWxzZSB7\nCiAgICAgICAgICAgICAgICBsb25nIGR1cmF0aW9uID0gbWF4VGltZW91dCAv\nIDE2OwogICAgICAgICAgICAgICAgaWYgKGR1cmF0aW9uIDw9IDApIGR1cmF0\naW9uID0gMTsKICAgICAgICAgICAgICAgIHdhaXRUaW1lb3V0ID0gZHVyYXRp\nb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RhcnRUaW1lID0gU2Vz\nc2lvbkltcGwuY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICB9CiAgICAg\nICAgZWxzZSB7CiAgICAgICAgICAgIHdhaXRUaW1lb3V0ID0gMDsKICAgICAg\nICAgICAgc3RhcnRUaW1lID0gMDsKICAgICAgICB9CgogICAgICAgIHJlZ2lz\ndGVyV2l0aFNlc3Npb24oKTsKCiAgICAgICAgLy8gY2hlY2sgYmVmb3JlIGxv\nY2sgLi4uCiAgICAgICAgaWYgKG51bGwgIT0gZ2V0TWVzc2FnZUxpc3RlbmVy\nKCkpIHsKICAgICAgICAgIHRocm93IG5ldyBqYXZheC5qbXMuSWxsZWdhbFN0\nYXRlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAiVGhlcmUgaXMgYSBt\nZXNzYWdlIGxpc3RlbmVyIGFscmVhZHkgc3Vic2NyaWJlZCBmb3IgdGhpcyBz\ndWJzY3JpYmVyIik7CiAgICAgICAgfQoKICAgICAgICBmaW5hbCBTZXNzaW9u\nSW1wbC5SZWNlaXZlZE1lc3NhZ2UgbWVzc2FnZTsKICAgICAgICBmaW5hbCBM\naXN0PFNlc3Npb25JbXBsLlJlY2VpdmVkTWVzc2FnZT4gYWNrTGlzdCA9IG5l\ndyBBcnJheUxpc3Q8U2Vzc2lvbkltcGwuUmVjZWl2ZWRNZXNzYWdlPig0KTsK\nCiAgICAgICAgc3luY2hyb25pemVkIChsb2NrT2JqZWN0KXsKCm91dGVyOgog\nICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewoKICAgICAgICAgICAgICAgIC8v\nIFNob3VsZCB3ZSBpZ25vcmUgY2FjaGVkIG1lc3NhZ2VzIGluc3RlYWQgb2Yg\ndGhpcyA/CiAgICAgICAgICAgICAgICAvLyBPbmNlIGNsb3NlZCwgd29udCBo\nZWxwIG11Y2ggYW55d2F5LCByaWdodCA/CiAgICAgICAgICAgICAgICBpZiAo\nY2xvc2VkKSB7CiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSA9IG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgYnJlYWsgb3V0ZXI7CiAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgLy8gV2hpbGUgd2Ugd2FpdGVkLCBp\ndCBjb3VsZCBoYXZlIGJlZW4gc2V0LgogICAgICAgICAgICAgICAgaWYgKG51\nbGwgIT0gZ2V0TWVzc2FnZUxpc3RlbmVyKCkpIHsKICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IGphdmF4Lmptcy5JbGxlZ2FsU3RhdGVFeGNlcHRpb24o\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgIlRoZXJlIGlzIGEgbWVzc2Fn\nZSBsaXN0ZW5lciBhbHJlYWR5IHN1YnNjcmliZWQgZm9yIHRoaXMgc3Vic2Ny\naWJlciIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHdo\naWxlIChjYW5XYWl0ICYmIHBlbmRpbmdNZXNzYWdlTGlzdC5pc0VtcHR5KCkp\newoKICAgICAgICAgICAgICAgICAgICAvLyBTaG91bGQgd2UgaWdub3JlIGNh\nY2hlZCBtZXNzYWdlcyBpbnN0ZWFkIG9mIHRoaXMgPwogICAgICAgICAgICAg\nICAgICAgIC8vIE9uY2UgY2xvc2VkLCB3b250IGhlbHAgbXVjaCBhbnl3YXks\nIHJpZ2h0ID8KICAgICAgICAgICAgICAgICAgICBpZiAoY2xvc2VkKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBudWxsOwogICAgICAg\nICAgICAgICAgICAgICAgICBicmVhayBvdXRlcjsKICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIGlmICgwICE9IG1heFRpbWVv\ndXQgJiYgc3RhcnRUaW1lICsgbWF4VGltZW91dCA8IFNlc3Npb25JbXBsLmN1\ncnJlbnRUaW1lTWlsbGlzKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nbWVzc2FnZSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFr\nIG91dGVyOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9ja09iamVj\ndC53YWl0KHdhaXRUaW1lb3V0KTsKICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpRXgpewogICAgICAgICAgICAg\nICAgICAgICAgICBKTVNFeGNlcHRpb24gakV4ID0gbmV3IEpNU0V4Y2VwdGlv\nbigiSW50ZXJydXB0ZWQgLi4gIiArIGlFeCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGpFeC5zZXRMaW5rZWRFeGNlcHRpb24oaUV4KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3cgakV4OwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KCgogICAgICAgICAgICAgICAgaWYgKHBl\nbmRpbmdNZXNzYWdlTGlzdC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAg\nICAgICBtZXNzYWdlID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICBicmVh\nayBvdXRlcjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIFNl\nc3Npb25JbXBsLlJlY2VpdmVkTWVzc2FnZSB0bWVzc2FnZSA9IHBlbmRpbmdN\nZXNzYWdlTGlzdC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIGFja0xpc3Qu\nYWRkKHRtZXNzYWdlKTsKCiAgICAgICAgICAgICAgICBpZiAobm9Mb2NhbCl7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb24uaXNMb2NhbGx5UHVi\nbGlzaGVkKHRtZXNzYWdlLm9yaWdpbmFsTWVzc2FnZS5nZXRKTVNNZXNzYWdl\nSUQoKSkpewogICAgICAgICAgICAgICAgICAgICAgICAvLyBmaW5kIG5leHQg\nbWVzc2FnZS4KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgaWYgKHNlc3Npb24uaXNNZXNzYWdlRXhwaXJlZCh0bWVzc2Fn\nZS5vcmlnaW5hbE1lc3NhZ2UpKSBjb250aW51ZTsKICAgICAgICAgICAgICAg\nIC8vIHVzZSB0aGlzIG1lc3NhZ2UgdGhlbi4KICAgICAgICAgICAgICAgIG1l\nc3NhZ2UgPSB0bWVzc2FnZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAobG9nZ2VyLmlzVHJh\nY2VFbmFibGVkKCkpIGxvZ2dlci50cmFjZSgiQWNrbGlzdCByZWNlaXZlICgi\nICsgYWNrTGlzdC5zaXplKCkgKyAiKSAuLi4gIiArIGFja0xpc3QpOwogICAg\nICAgIGZvciAoU2Vzc2lvbkltcGwuUmVjZWl2ZWRNZXNzYWdlIGFja01lc3Nh\nZ2UgOiBhY2tMaXN0KXsKICAgICAgICAgICAgc2Vzc2lvbi5oYW5kbGVBdXRv\nbWF0aWNNZXNzYWdlQWNrbm93bGVkZ2VtZW50KGFja01lc3NhZ2UsIHRoaXMp\nOwogICAgICAgIH0KCiAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxl\nZCgpKSBsb2dnZXIudHJhY2UoInJlY2VpdmUgcmVzcG9uc2UgIiArIChudWxs\nICE9IG1lc3NhZ2UgPyBtZXNzYWdlLm1zZyA6IG51bGwpKTsKICAgICAgICBy\nZXR1cm4gbnVsbCAhPSBtZXNzYWdlID8gbWVzc2FnZS5tc2cgOiBudWxsOwog\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTWVzc2FnZSByZWNlaXZl\nTm9XYWl0KCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgcmV0dXJu\nIHJlY2VpdmVJbXBsKDAsIGZhbHNlKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7\nCgogICAgICAgIGZpbmFsIGJvb2xlYW4gdW5yZWdpc3RlcjsKICAgICAgICBm\naW5hbCBib29sZWFuIHVuc3Vic2NyaWJlOwoKICAgICAgICBzeW5jaHJvbml6\nZWQgKGxvY2tPYmplY3QpewogICAgICAgICAgICBpZiAoY2xvc2VkKSByZXR1\ncm4gOwogICAgICAgICAgICBjbG9zZWQgPSB0cnVlOwoKICAgICAgICAgICAg\nLy8gVGhpcyBtZWFucyB0aGF0IHdlIGRyb3AgYWxsIHBlbmRpbmcgbWVzc2Fn\nZXMgLi4uCiAgICAgICAgICAgIC8vIGdjIGZyaWVuZGx5LgogICAgICAgICAg\nICBwZW5kaW5nTWVzc2FnZUxpc3QuY2xlYXIoKTsKCiAgICAgICAgICAgIHVu\ncmVnaXN0ZXIgPSByZWdpc3RlcmVkOwogICAgICAgICAgICB0aGlzLnJlZ2lz\ndGVyZWQgPSBmYWxzZTsKCiAgICAgICAgICAgIHVuc3Vic2NyaWJlID0gdGhp\ncy5mb3JjZVVuc3Vic2NyaWJlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHVu\ncmVnaXN0ZXIpIHRoaXMuc2Vzc2lvbi51bnJlZ2lzdGVyVG9waWNTdWJzY3Jp\nYmVyKHRoaXMpOwoKICAgICAgICAvLyB0aGlzLnNlc3Npb24uc3RvcFRvcGlj\nRGVsaXZlcnkodG9waWMuZ2V0VG9waWNOYW1lKCksIHN1YnNjcmliZXJJZCk7\nCiAgICAgICAgaWYgKHVuc3Vic2NyaWJlKSBzZXNzaW9uLnVuc3Vic2NyaWJl\nRnJvbVRvcGljKHRvcGljLmdldFRvcGljTmFtZSgpLCBzdWJzY3JpYmVySWQp\nOwoKICAgICAgICAvLyBub3RoaW5nIGVsc2UgdG8gYmUgZG9uZSAuLi4KICAg\nIH0KCiAgICBib29sZWFuIGVucXVldWVSZWNlaXZlZE1lc3NhZ2UoU2Vzc2lv\nbkltcGwuUmVjZWl2ZWRNZXNzYWdlIHJlY2VpdmVkTWVzc2FnZSwgZmluYWwg\nYm9vbGVhbiBhZGRGaXJzdCkgewogICAgICAgIGlmIChsb2dnZXIuaXNUcmFj\nZUVuYWJsZWQoKSkKICAgICAgICAgIGxvZ2dlci50cmFjZSgiRW5xdWVpbmcg\nbWVzc2FnZSAiICsgcmVjZWl2ZWRNZXNzYWdlICsgIiB0byBzdWJzY3JpYmVy\nICIgKyBzdWJzY3JpYmVySWQgKwogICAgICAgICAgICAgICIgZm9yIHRvcGlj\nICIgKyB0b3BpYy50b1N0cmluZygpICsgIiwgYWRkRmlyc3QgOiAiICsgYWRk\nRmlyc3QpOwoKICAgICAgICBTdHJpbmcgaW5mb01zZyA9IG51bGw7CiAgICAg\nICAgU3RyaW5nIHRyYWNlTXNnID0gbnVsbDsKICAgICAgICBzeW5jaHJvbml6\nZWQgKGxvY2tPYmplY3QpewogICAgICAgICAgICAvLyBpZ25vcmUKICAgICAg\nICAgICAgaWYgKGNsb3NlZCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAv\nLyBJZiBudW1iZXIgb2YgYnVmZmVyZWQgbWVzc2FnZXMgPiBzb21lIG1heCBs\naW1pdCwgZXZpY3QgdGhlbSAtIGVsc2Ugd2UgcnVuIG91dCBvZiBtZW1vcnkg\nIQogICAgICAgICAgICBpZiAocGVuZGluZ01lc3NhZ2VMaXN0LnNpemUoKSA+\nIFNlc3Npb25JbXBsLk1BWF9TVUJTQ1JJQkVSX0JVRkZFUkVEX01FU1NBR0VT\nKSB7CiAgICAgICAgICAgICAgICAvLyBzaW1wbHkgZGlzY2FyZCBpdCB3aXRo\nIGFuIGVycm9yIGxvZ2dlZC4KICAgICAgICAgICAgICAgIGluZm9Nc2cgPSAi\nRGlzY2FyZGluZyAiICsgcGVuZGluZ01lc3NhZ2VMaXN0LnNpemUoKSArICIg\nbWVzc2FnZXMgc2luY2UgdGhlcmUgYXJlIG5vIGNvbnN1bWVycyBmb3IgdGhl\nbSI7CiAgICAgICAgICAgICAgICBwZW5kaW5nTWVzc2FnZUxpc3QuY2xlYXIo\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gTm90ZTogU2VsZWN0\nb3IgZXZhbHVhdGlvbiB3aWxsIGhhcHBlbiBpbiBTZXNzaW9uSW1wbC4KICAg\nICAgICAgICAgLy8gaWYgKCFzZWxlY3Rvck1hdGNoZWQocmVjZWl2ZWRNZXNz\nYWdlKSkgcmV0dXJuIGZhbHNlOwoKICAgICAgICAgICAgaWYgKGFkZEZpcnN0\nKSBwZW5kaW5nTWVzc2FnZUxpc3QuYWRkRmlyc3QocmVjZWl2ZWRNZXNzYWdl\nKTsKICAgICAgICAgICAgZWxzZSBwZW5kaW5nTWVzc2FnZUxpc3QuYWRkKHJl\nY2VpdmVkTWVzc2FnZSk7CgogICAgICAgICAgICBsb2NrT2JqZWN0Lm5vdGlm\neUFsbCgpOwogICAgICAgICAgICBpZiAobG9nZ2VyLmlzVHJhY2VFbmFibGVk\nKCkpIHRyYWNlTXNnID0gInBlbmRpbmdNZXNzYWdlTGlzdCAoIiArIHBlbmRp\nbmdNZXNzYWdlTGlzdC5zaXplKCkgKwogICAgICAgICAgICAgICAgIikgOiBc\nbiIgKyBwZW5kaW5nTWVzc2FnZUxpc3QgKyAiXG4tLS1cbiBuZXh0IDogIiAr\nIHBlbmRpbmdNZXNzYWdlTGlzdC5nZXRGaXJzdCgpOwogICAgICAgIH0KCiAg\nICAgICAgaWYgKG51bGwgIT0gaW5mb01zZykgbG9nZ2VyLmluZm8oaW5mb01z\nZyk7CiAgICAgICAgaWYgKGxvZ2dlci5pc1RyYWNlRW5hYmxlZCgpICYmIG51\nbGwgIT0gdHJhY2VNc2cpIGxvZ2dlci50cmFjZSh0cmFjZU1zZyk7CgogICAg\nICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0\nKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJlZ2lzdGVyV2l0aFNl\nc3Npb24oKTsKICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRpb24gakV4KXsK\nICAgICAgICAgICAgLy8gaWdub3JlLgogICAgICAgICAgICBEZWJ1Z1V0aWwu\nZHVtcEpNU1N0YWNrdHJhY2UobG9nZ2VyLCBqRXgpOwogICAgICAgIH0KICAg\nIH0KfQo=\n","encoding":"base64"}

