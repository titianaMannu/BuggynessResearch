{"sha":"d4155a767083bb83a664462e7ad3cae49e847bbe","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDQxNTVhNzY3MDgzYmI4M2E2NjQ0NjJlN2FkM2NhZTQ5ZTg0N2JiZQ==","size":9853,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d4155a767083bb83a664462e7ad3cae49e847bbe","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFja2Fn\nZSBvcmcuYXBhY2hlLmFjdGl2ZW1xOwoKaW1wb3J0IGphdmEubGFuZy5yZWZs\nZWN0LkZpZWxkOwppbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTWV0aG9kOwpp\nbXBvcnQgamF2YS5sYW5nLnJlZmxlY3QuTW9kaWZpZXI7CmltcG9ydCBqYXZh\nLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBvcnQgamF2YS51dGlsLkhh\nc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZh\nLnV0aWwuTGlua2VkSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRM\naXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0OwppbXBvcnQganVu\naXQuZnJhbWV3b3JrLlRlc3RTdWl0ZTsKCmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICog\nUG9vciBtYW5zIHdheSBvZiBnZXR0aW5nIEpVbml0IHRvIHJ1biBhIHRlc3Qg\nY2FzZSB0aHJvdWdoIGEgZmV3IGRpZmZlcmVudAogKiBjb21iaW5hdGlvbnMg\nb2Ygb3B0aW9ucy4gVXNhZ2U6IElmIHlvdSBoYXZlIGEgdGVzdCBjYXNlIGNh\nbGxlZCB0ZXN0Rm9vIHdoYXQKICogeW91IHdhbnQgdG8gcnVuIHRocm91Z2gg\nYSBmZXcgY29tYmluYXRpb25zLCBvZiBvZiB2YWx1ZXMgZm9yIHRoZSBhdHRy\naWJ1dGVzCiAqIGFnZSBhbmQgY29sb3IsIHlvdSB3b3VsZCBzb21ldGhpbmcg\nbGlrZTogPGNvZGU+CiAqICAgIHB1YmxpYyB2b2lkIGluaXRDb21ib3NGb3JU\nZXN0Rm9vKCkgewogKiAgICAgICAgYWRkQ29tYmluYXRpb25WYWx1ZXMoICJh\nZ2UiLCBuZXcgT2JqZWN0W117IG5ldyBJbnRlZ2VyKDIxKSwgbmV3IEludGVn\nZXIoMzApIH0gKTsKICogICAgICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCAi\nY29sb3IiLCBuZXcgT2JqZWN0W117ImJsdWUiLCAiZ3JlZW4ifSApOwogKiAg\nICB9CiAqIDwvY29kZT4KICogVGhlIHRlc3RGb28gdGVzdCBjYXNlIHdvdWxk\nIGJlIHJ1biBmb3IgZWFjaCBwb3NzaWJsZSBjb21iaW5hdGlvbiBvZiBhZ2Ug\nYW5kCiAqIGNvbG9yIHRoYXQgeW91IHNldHVwIGluIHRoZSBpbml0Q29tYm9z\nRm9yVGVzdEZvbyBtZXRob2QuIEJlZm9yZSBlYWNoCiAqIGNvbWJpbmF0aW9u\nIGlzIHJ1biwgdGhlIGFnZSBhbmQgY29sb3IgZmllbGRzIG9mIHRoZSB0ZXN0\nIGNsYXNzIGFyZSBzZXQgdG8gb25lCiAqIG9mIHRoZSB2YWx1ZXMgZGVmaW5l\nZC4gVGhpcyBpcyBkb25lIGJlZm9yZSB0aGUgbm9ybWFsIHNldFVwIG1ldGhv\nZCBpcyBjYWxsZWQuCiAqIElmIHlvdSB3YW50IHRoZSB0ZXN0IGNvbWJpbmF0\naW9ucyB0byBzaG93IHVwIGFzIHNlcGFyYXRlIHRlc3QgcnVucyBpbiB0aGUK\nICogSlVuaXQgcmVwb3J0cywgYWRkIGEgc3VpdGUgbWV0aG9kIHRvIHlvdXIg\ndGVzdCBjYXNlIHNpbWlsYXIgdG86IDxjb2RlPgogKiAgICAgcHVibGljIHN0\nYXRpYyBUZXN0IHN1aXRlKCkgewogKiAgICAgICAgIHJldHVybiBzdWl0ZShG\nb29UZXN0LmNsYXNzKTsKICogICAgIH0KICogPC9jb2RlPgogKgogKgogKi8K\ncHVibGljIGFic3RyYWN0IGNsYXNzIENvbWJpbmF0aW9uVGVzdFN1cHBvcnQg\nZXh0ZW5kcyBBdXRvRmFpbFRlc3RTdXBwb3J0IHsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dn\nZXIoQ29tYmluYXRpb25UZXN0U3VwcG9ydC5jbGFzcyk7CgogICAgcHJpdmF0\nZSBIYXNoTWFwPFN0cmluZywgQ29tYm9PcHRpb24+IGNvbWJvT3B0aW9ucyA9\nIG5ldyBIYXNoTWFwPFN0cmluZywgQ29tYm9PcHRpb24+KCk7CiAgICBwcml2\nYXRlIGJvb2xlYW4gY29tYm9zRXZhbHVhdGVkOwogICAgcHJpdmF0ZSBNYXA8\nU3RyaW5nLCBPYmplY3Q+IG9wdGlvbnM7CgogICAgc3RhdGljIGNsYXNzIENv\nbWJvT3B0aW9uIHsKICAgICAgICBmaW5hbCBTdHJpbmcgYXR0cmlidXRlOwog\nICAgICAgIGZpbmFsIExpbmtlZEhhc2hTZXQ8T2JqZWN0PiB2YWx1ZXMgPSBu\nZXcgTGlua2VkSGFzaFNldDxPYmplY3Q+KCk7CgogICAgICAgIHB1YmxpYyBD\nb21ib09wdGlvbihTdHJpbmcgYXR0cmlidXRlLCBDb2xsZWN0aW9uPE9iamVj\ndD4gb3B0aW9ucykgewogICAgICAgICAgICB0aGlzLmF0dHJpYnV0ZSA9IGF0\ndHJpYnV0ZTsKICAgICAgICAgICAgdGhpcy52YWx1ZXMuYWRkQWxsKG9wdGlv\nbnMpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhZGRDb21i\naW5hdGlvblZhbHVlcyhTdHJpbmcgYXR0cmlidXRlLCBPYmplY3RbXSBvcHRp\nb25zKSB7CiAgICAgICAgQ29tYm9PcHRpb24gY28gPSB0aGlzLmNvbWJvT3B0\naW9ucy5nZXQoYXR0cmlidXRlKTsKICAgICAgICBpZiAoY28gPT0gbnVsbCkg\newogICAgICAgICAgICB0aGlzLmNvbWJvT3B0aW9ucy5wdXQoYXR0cmlidXRl\nLCBuZXcgQ29tYm9PcHRpb24oYXR0cmlidXRlLCBBcnJheXMuYXNMaXN0KG9w\ndGlvbnMpKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY28udmFs\ndWVzLmFkZEFsbChBcnJheXMuYXNMaXN0KG9wdGlvbnMpKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHVibGljIHZvaWQgcnVuQmFyZSgpIHRocm93cyBUaHJv\nd2FibGUgewogICAgICAgIGlmIChjb21ib3NFdmFsdWF0ZWQpIHsKICAgICAg\nICAgICAgc3VwZXIucnVuQmFyZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgIENvbWJpbmF0aW9uVGVzdFN1cHBvcnRbXSBjb21iaW5hdGlvbnMg\nPSBnZXRDb21iaW5hdGlvbnMoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBjb21iaW5hdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIENvbWJpbmF0aW9uVGVzdFN1cHBvcnQgdGVzdCA9IGNvbWJpbmF0\naW9uc1tpXTsKICAgICAgICAgICAgICAgIGlmIChnZXROYW1lKCkgPT0gbnVs\nbCB8fCBnZXROYW1lKCkuZXF1YWxzKHRlc3QuZ2V0TmFtZSgpKSkgewogICAg\nICAgICAgICAgICAgICAgIHRlc3QucnVuQmFyZSgpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBzZXRPcHRpb25zKE1hcDxTdHJpbmcsIE9iamVjdD4gb3B0aW9u\ncykgdGhyb3dzIE5vU3VjaEZpZWxkRXhjZXB0aW9uLCBJbGxlZ2FsQWNjZXNz\nRXhjZXB0aW9uIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zOwog\nICAgICAgIGZvciAoSXRlcmF0b3I8U3RyaW5nPiBpdGVyYXRvciA9IG9wdGlv\nbnMua2V5U2V0KCkuaXRlcmF0b3IoKTsgaXRlcmF0b3IuaGFzTmV4dCgpOykg\newogICAgICAgICAgICBTdHJpbmcgYXR0cmlidXRlID0gaXRlcmF0b3IubmV4\ndCgpOwogICAgICAgICAgICBPYmplY3QgdmFsdWUgPSBvcHRpb25zLmdldChh\ndHRyaWJ1dGUpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nRmllbGQgZmllbGQgPSBnZXRDbGFzcygpLmdldEZpZWxkKGF0dHJpYnV0ZSk7\nCiAgICAgICAgICAgICAgICBmaWVsZC5zZXQodGhpcywgdmFsdWUpOwogICAg\nICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewogICAgICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBib29sZWFuIGZvdW5kID0g\nZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHNldHRlck5hbWUg\nPSAic2V0IiArIGF0dHJpYnV0ZS5zdWJzdHJpbmcoMCwgMSkudG9VcHBlckNh\nc2UoKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBhdHRyaWJ1dGUuc3Vic3RyaW5nKDEpOwogICAgICAgICAgICAgICAgICAg\nIGZvcihNZXRob2QgbWV0aG9kIDogZ2V0Q2xhc3MoKS5nZXRNZXRob2RzKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGhvZC5nZXROYW1l\nKCkuZXF1YWxzKHNldHRlck5hbWUpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBtZXRob2QuaW52b2tlKHRoaXMsIHZhbHVlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAg\nICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBOb1N1Y2hNZXRob2RFcnJvcigiTm8gc2V0dGVyIGZvdW5kIGZvciBm\naWVsZDogIiArIGF0dHJpYnV0ZSk7CiAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIH0gY2F0Y2goVGhyb3dhYmxlIGV4KSB7CiAgICAg\nICAgICAgICAgICAgICAgTE9HLmluZm8oIkNvdWxkIG5vdCBzZXQgZmllbGQg\nJyIgKyBhdHRyaWJ1dGUgKyAiJyB0byB2YWx1ZSAnIiArIHZhbHVlICsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAiJywgbWFrZSBzdXJlIHRoZSBm\naWVsZCBleGlzdHMgYW5kIGlzIHB1YmxpYyBvciBoYXMgYSBzZXR0ZXIuIik7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBDb21iaW5hdGlvblRlc3RTdXBwb3J0W10gZ2V0\nQ29tYmluYXRpb25zKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE1l\ndGhvZCBtZXRob2QgPSBnZXRDbGFzcygpLmdldE1ldGhvZCgiaW5pdENvbWJv\ncyIsIChDbGFzc1tdKW51bGwpOwogICAgICAgICAgICBtZXRob2QuaW52b2tl\nKHRoaXMsIChPYmplY3RbXSludWxsKTsKICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgZSkgewogICAgICAgIH0KCiAgICAgICAgU3RyaW5nIG5hbWUgPSBn\nZXROYW1lKCkuc3BsaXQoIiAiKVswXTsKICAgICAgICBTdHJpbmcgY29tYm9T\nZXR1cE1ldGhvZE5hbWUgPSAiaW5pdENvbWJvc0ZvciIgKyBDaGFyYWN0ZXIu\ndG9VcHBlckNhc2UobmFtZS5jaGFyQXQoMCkpICsgbmFtZS5zdWJzdHJpbmco\nMSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgTWV0aG9kIG1ldGhvZCA9\nIGdldENsYXNzKCkuZ2V0TWV0aG9kKGNvbWJvU2V0dXBNZXRob2ROYW1lLCAo\nQ2xhc3NbXSludWxsKTsKICAgICAgICAgICAgbWV0aG9kLmludm9rZSh0aGlz\nLCAoT2JqZWN0W10pbnVsbCk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxl\nIGUpIHsKICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEFy\ncmF5TGlzdDxIYXNoTWFwPFN0cmluZywgT2JqZWN0Pj4gZXhwYW5kZWRPcHRp\nb25zID0gbmV3IEFycmF5TGlzdDxIYXNoTWFwPFN0cmluZywgT2JqZWN0Pj4o\nKTsKICAgICAgICAgICAgZXhwYW5kQ29tYmluYXRpb25zKG5ldyBBcnJheUxp\nc3Q8Q29tYm9PcHRpb24+KGNvbWJvT3B0aW9ucy52YWx1ZXMoKSksIGV4cGFu\nZGVkT3B0aW9ucyk7CgogICAgICAgICAgICBpZiAoZXhwYW5kZWRPcHRpb25z\nLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgY29tYm9zRXZhbHVhdGVk\nID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQ29tYmluYXRp\nb25UZXN0U3VwcG9ydFtdIHt0aGlzfTsKICAgICAgICAgICAgfSBlbHNlIHsK\nCiAgICAgICAgICAgICAgICBBcnJheUxpc3Q8Q29tYmluYXRpb25UZXN0U3Vw\ncG9ydD4gcmVzdWx0ID0gbmV3IEFycmF5TGlzdDxDb21iaW5hdGlvblRlc3RT\ndXBwb3J0PigpOwogICAgICAgICAgICAgICAgLy8gUnVuIHRoZSB0ZXN0IGNh\nc2UgZm9yIGVhY2ggcG9zc2libGUgY29tYmluYXRpb24KICAgICAgICAgICAg\nICAgIGZvciAoSXRlcmF0b3I8SGFzaE1hcDxTdHJpbmcsIE9iamVjdD4+IGl0\nZXIgPSBleHBhbmRlZE9wdGlvbnMuaXRlcmF0b3IoKTsgaXRlci5oYXNOZXh0\nKCk7KSB7CiAgICAgICAgICAgICAgICAgICAgQ29tYmluYXRpb25UZXN0U3Vw\ncG9ydCBjb21ibyA9IChDb21iaW5hdGlvblRlc3RTdXBwb3J0KVRlc3RTdWl0\nZS5jcmVhdGVUZXN0KGdldENsYXNzKCksIG5hbWUpOwogICAgICAgICAgICAg\nICAgICAgIGNvbWJvLmNvbWJvc0V2YWx1YXRlZCA9IHRydWU7CiAgICAgICAg\nICAgICAgICAgICAgY29tYm8uc2V0T3B0aW9ucyhpdGVyLm5leHQoKSk7CiAg\nICAgICAgICAgICAgICAgICAgcmVzdWx0LmFkZChjb21ibyk7CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgQ29tYmluYXRpb25UZXN0U3Vw\ncG9ydCByY1tdID0gbmV3IENvbWJpbmF0aW9uVGVzdFN1cHBvcnRbcmVzdWx0\nLnNpemUoKV07CiAgICAgICAgICAgICAgICByZXN1bHQudG9BcnJheShyYyk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gcmM7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewogICAgICAgICAgICBjb21i\nb3NFdmFsdWF0ZWQgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gbmV3IENv\nbWJpbmF0aW9uVGVzdFN1cHBvcnRbXSB7dGhpc307CiAgICAgICAgfQoKICAg\nIH0KCiAgICBwcml2YXRlIHZvaWQgZXhwYW5kQ29tYmluYXRpb25zKExpc3Q8\nQ29tYm9PcHRpb24+IG9wdGlvbnNMZWZ0LCBMaXN0PEhhc2hNYXA8U3RyaW5n\nLCBPYmplY3Q+PiBleHBhbmRlZENvbWJvcykgewogICAgICAgIGlmICghb3B0\naW9uc0xlZnQuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIEhhc2hNYXA8U3Ry\naW5nLCBPYmplY3Q+IG1hcDsKICAgICAgICAgICAgaWYgKGNvbWJvT3B0aW9u\ncy5zaXplKCkgPT0gb3B0aW9uc0xlZnQuc2l6ZSgpKSB7CiAgICAgICAgICAg\nICAgICBtYXAgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIE9iamVjdD4oKTsKICAg\nICAgICAgICAgICAgIGV4cGFuZGVkQ29tYm9zLmFkZChtYXApOwogICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWFwID0gZXhwYW5kZWRD\nb21ib3MuZ2V0KGV4cGFuZGVkQ29tYm9zLnNpemUoKSAtIDEpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICBMaW5rZWRMaXN0PENvbWJvT3B0aW9uPiBs\nID0gbmV3IExpbmtlZExpc3Q8Q29tYm9PcHRpb24+KG9wdGlvbnNMZWZ0KTsK\nICAgICAgICAgICAgQ29tYm9PcHRpb24gY29tYm9PcHRpb24gPSBsLnJlbW92\nZUxhc3QoKTsKICAgICAgICAgICAgaW50IGkgPSAwOwogICAgICAgICAgICBm\nb3IgKEl0ZXJhdG9yPE9iamVjdD4gaXRlciA9IGNvbWJvT3B0aW9uLnZhbHVl\ncy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIE9iamVjdCB2YWx1ZSA9IGl0ZXIubmV4dCgpOwogICAgICAgICAgICAg\nICAgaWYgKGkgIT0gMCkgewogICAgICAgICAgICAgICAgICAgIG1hcCA9IG5l\ndyBIYXNoTWFwPFN0cmluZywgT2JqZWN0PihtYXApOwogICAgICAgICAgICAg\nICAgICAgIGV4cGFuZGVkQ29tYm9zLmFkZChtYXApOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgbWFwLnB1dChjb21ib09wdGlvbi5hdHRy\naWJ1dGUsIHZhbHVlKTsKICAgICAgICAgICAgICAgIGV4cGFuZENvbWJpbmF0\naW9ucyhsLCBleHBhbmRlZENvbWJvcyk7CiAgICAgICAgICAgICAgICBpKys7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHN0\nYXRpYyBUZXN0IHN1aXRlKENsYXNzPD8gZXh0ZW5kcyBDb21iaW5hdGlvblRl\nc3RTdXBwb3J0PiBjbGF6eikgewogICAgICAgIFRlc3RTdWl0ZSBzdWl0ZSA9\nIG5ldyBUZXN0U3VpdGUoKTsKCiAgICAgICAgQXJyYXlMaXN0PFN0cmluZz4g\nbmFtZXMgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oKTsKICAgICAgICBNZXRo\nb2RbXSBtZXRob2RzID0gY2xhenouZ2V0TWV0aG9kcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbWV0aG9kcy5sZW5ndGg7IGkrKykgewogICAg\nICAgICAgICBTdHJpbmcgbmFtZSA9IG1ldGhvZHNbaV0uZ2V0TmFtZSgpOwog\nICAgICAgICAgICBpZiAobmFtZXMuY29udGFpbnMobmFtZSkgfHwgIWlzUHVi\nbGljVGVzdE1ldGhvZChtZXRob2RzW2ldKSkgewogICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmFtZXMuYWRk\nKG5hbWUpOwogICAgICAgICAgICBUZXN0IHRlc3QgPSBUZXN0U3VpdGUuY3Jl\nYXRlVGVzdChjbGF6eiwgbmFtZSk7CiAgICAgICAgICAgIGlmICh0ZXN0IGlu\nc3RhbmNlb2YgQ29tYmluYXRpb25UZXN0U3VwcG9ydCkgewogICAgICAgICAg\nICAgICAgQ29tYmluYXRpb25UZXN0U3VwcG9ydFtdIGNvbWJpbmF0aW9ucyA9\nICgoQ29tYmluYXRpb25UZXN0U3VwcG9ydCl0ZXN0KS5nZXRDb21iaW5hdGlv\nbnMoKTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgY29t\nYmluYXRpb25zLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAg\nc3VpdGUuYWRkVGVzdChjb21iaW5hdGlvbnNbal0pOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3Vp\ndGUuYWRkVGVzdCh0ZXN0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICByZXR1cm4gc3VpdGU7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMg\nYm9vbGVhbiBpc1B1YmxpY1Rlc3RNZXRob2QoTWV0aG9kIG0pIHsKICAgICAg\nICByZXR1cm4gaXNUZXN0TWV0aG9kKG0pICYmIE1vZGlmaWVyLmlzUHVibGlj\nKG0uZ2V0TW9kaWZpZXJzKCkpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIGJvb2xlYW4gaXNUZXN0TWV0aG9kKE1ldGhvZCBtKSB7CiAgICAgICAgU3Ry\naW5nIG5hbWUgPSBtLmdldE5hbWUoKTsKICAgICAgICBDbGFzczw/PltdIHBh\ncmFtZXRlcnMgPSBtLmdldFBhcmFtZXRlclR5cGVzKCk7CiAgICAgICAgQ2xh\nc3M8Pz4gcmV0dXJuVHlwZSA9IG0uZ2V0UmV0dXJuVHlwZSgpOwogICAgICAg\nIHJldHVybiBwYXJhbWV0ZXJzLmxlbmd0aCA9PSAwICYmIG5hbWUuc3RhcnRz\nV2l0aCgidGVzdCIpICYmIHJldHVyblR5cGUuZXF1YWxzKFZvaWQuVFlQRSk7\nCiAgICB9CgogICAgcHVibGljIFN0cmluZyBnZXROYW1lKCkgewogICAgICAg\nIHJldHVybiBnZXROYW1lKGZhbHNlKTsKICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIGdldE5hbWUoYm9vbGVhbiBvcmlnaW5hbCkgewogICAgICAgIGlmIChv\ncHRpb25zICE9IG51bGwgJiYgIW9yaWdpbmFsKSB7CiAgICAgICAgICAgIHJl\ndHVybiBzdXBlci5nZXROYW1lKCkgKyAiICIgKyBvcHRpb25zOwogICAgICAg\nIH0KICAgICAgICByZXR1cm4gc3VwZXIuZ2V0TmFtZSgpOwogICAgfQp9Cg==\n","encoding":"base64"}

