{"sha":"408b40e7ff4eac752aa63ac1055cf288976be475","node_id":"MDQ6QmxvYjE1NzU5NTY6NDA4YjQwZTdmZjRlYWM3NTJhYTYzYWMxMDU1Y2YyODg5NzZiZTQ3NQ==","size":38674,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/408b40e7ff4eac752aa63ac1055cf288976be475","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFja2Fn\nZSBvcmcuYXBhY2hlLmFjdGl2ZW1xOwoKaW1wb3J0IGphdmEubGFuZy5UaHJl\nYWQuVW5jYXVnaHRFeGNlcHRpb25IYW5kbGVyOwppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1w\nb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7\nCmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5FeGVjdXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5U\naW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5B\ndG9taWNJbnRlZ2VyOwoKaW1wb3J0IGphdmF4Lmptcy5CeXRlc01lc3NhZ2U7\nCmltcG9ydCBqYXZheC5qbXMuRGVsaXZlcnlNb2RlOwppbXBvcnQgamF2YXgu\nam1zLk1lc3NhZ2U7CmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZUNvbnN1bWVy\nOwppbXBvcnQgamF2YXguam1zLk1lc3NhZ2VMaXN0ZW5lcjsKaW1wb3J0IGph\ndmF4Lmptcy5NZXNzYWdlUHJvZHVjZXI7CmltcG9ydCBqYXZheC5qbXMuU2Vz\nc2lvbjsKaW1wb3J0IGphdmF4Lmptcy5UZXh0TWVzc2FnZTsKaW1wb3J0IGph\ndmF4Lmptcy5Ub3BpYzsKCgoKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVz\ndDsKCgppbXBvcnQgamF2YXguam1zLkRlc3RpbmF0aW9uOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLmptcy5NZXNzYWdpbmdTZXNzaW9uRmFjYWRlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuam1zLlNlc3Npb25JbXBsOwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcuam1zLnNwaS5IZWR3aWdDb25uZWN0aW9u\nRmFjdG9yeUltcGw7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuc3Bp\nLkhlZHdpZ0Nvbm5lY3Rpb25JbXBsOwppbXBvcnQgb3JnLmp1bml0Lklnbm9y\nZTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUZXN0IGNhc2VzIHVzZWQgdG8gdGVz\ndCB0aGUgSk1TIG1lc3NhZ2UgY29uc3VtZXIuCiAqLwpwdWJsaWMgY2xhc3Mg\nSk1TQ29uc3VtZXJUZXN0IGV4dGVuZHMgSm1zVGVzdFN1cHBvcnQgewoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0\nb3J5LmdldExvZ2dlcihKTVNDb25zdW1lclRlc3QuY2xhc3MpOwoKICAgIHB1\nYmxpYyBEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbjsKICAgIHB1YmxpYyBpbnQg\nZGVsaXZlcnlNb2RlOwogICAgcHVibGljIGludCBwcmVmZXRjaDsKICAgIHB1\nYmxpYyBpbnQgYWNrTW9kZTsKICAgIHB1YmxpYyBNZXNzYWdpbmdTZXNzaW9u\nRmFjYWRlLkRlc3RpbmF0aW9uVHlwZSBkZXN0aW5hdGlvblR5cGU7CiAgICBw\ndWJsaWMgYm9vbGVhbiBkdXJhYmxlQ29uc3VtZXI7CgogICAgcHVibGljIHN0\nYXRpYyBUZXN0IHN1aXRlKCkgewogICAgICAgIHJldHVybiBzdWl0ZShKTVND\nb25zdW1lclRlc3QuY2xhc3MpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMg\ndm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHsKICAgICAgICBqdW5pdC50ZXh0\ndWkuVGVzdFJ1bm5lci5ydW4oc3VpdGUoKSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgaW5pdENvbWJvc0ZvclRlc3RNZXNzYWdlTGlzdGVuZXJXaXRoQ29u\nc3VtZXJDYW5CZVN0b3BwZWQoKSB7CiAgICAgICAgYWRkQ29tYmluYXRpb25W\nYWx1ZXMoImRlbGl2ZXJ5TW9kZSIsIG5ldyBPYmplY3RbXSB7SW50ZWdlci52\nYWx1ZU9mKERlbGl2ZXJ5TW9kZS5OT05fUEVSU0lTVEVOVCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgSW50ZWdlci52YWx1ZU9mKERlbGl2ZXJ5TW9kZS5QRVJTSVNURU5U\nKX0pOwogICAgICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCJkZXN0aW5hdGlv\nblR5cGUiLCBuZXcgTWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlv\nblR5cGVbXSB7CiAgICAgICAgICAgICAgICBNZXNzYWdpbmdTZXNzaW9uRmFj\nYWRlLkRlc3RpbmF0aW9uVHlwZS5UT1BJQ30pOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RNZXNzYWdlTGlzdGVuZXJXaXRoQ29uc3VtZXJDYW5CZVN0\nb3BwZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKCiAgICAgICAgZmluYWwgQXRv\nbWljSW50ZWdlciBjb3VudGVyID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAg\nICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggZG9uZTEgPSBuZXcgQ291bnRE\nb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggZG9u\nZTIgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAgICAgIC8vIFJlY2Vp\ndmUgYSBtZXNzYWdlIHdpdGggdGhlIEpNUyBBUEkKICAgICAgICBjb25uZWN0\naW9uLnN0YXJ0KCk7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVj\ndGlvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9fQUNLTk9X\nTEVER0UpOwogICAgICAgIGRlc3RpbmF0aW9uID0gY3JlYXRlRGVzdGluYXRp\nb24oc2Vzc2lvbiwgZGVzdGluYXRpb25UeXBlKTsKICAgICAgICBNZXNzYWdl\nQ29uc3VtZXIgY29uc3VtZXIgPSAoTWVzc2FnZUNvbnN1bWVyKXNlc3Npb24u\nY3JlYXRlQ29uc3VtZXIoZGVzdGluYXRpb24pOwogICAgICAgIGNvbnN1bWVy\nLnNldE1lc3NhZ2VMaXN0ZW5lcihuZXcgTWVzc2FnZUxpc3RlbmVyKCkgewog\nICAgICAgICAgICBwdWJsaWMgdm9pZCBvbk1lc3NhZ2UoTWVzc2FnZSBtKSB7\nCiAgICAgICAgICAgICAgICBjb3VudGVyLmluY3JlbWVudEFuZEdldCgpOwog\nICAgICAgICAgICAgICAgaWYgKGNvdW50ZXIuZ2V0KCkgPT0gMSkgewogICAg\nICAgICAgICAgICAgICAgIGRvbmUxLmNvdW50RG93bigpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGNvdW50ZXIuZ2V0KCkgPT0g\nMikgewogICAgICAgICAgICAgICAgICAgIGRvbmUyLmNvdW50RG93bigpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7Cgog\nICAgICAgIC8vIFNlbmQgYSBmaXJzdCBtZXNzYWdlIHRvIG1ha2Ugc3VyZSB0\naGF0IHRoZSBjb25zdW1lciBkaXNwYXRjaGVyIGlzCiAgICAgICAgLy8gcnVu\nbmluZwogICAgICAgIHNlbmRNZXNzYWdlcyhzZXNzaW9uLCBkZXN0aW5hdGlv\nbiwgMSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShkb25lMS5hd2FpdCgxLCBUaW1l\nVW5pdC5TRUNPTkRTKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDEsIGNvdW50\nZXIuZ2V0KCkpOwoKICAgICAgICAvLyBTdG9wIHRoZSBjb25zdW1lci4KICAg\nICAgICBjb25uZWN0aW9uLnN0b3AoKTsKCiAgICAgICAgLy8gU2VuZCBhIG1l\nc3NhZ2UsIGJ1dCBzaG91bGQgbm90IGdldCBkZWxpdmVyZWQuCiAgICAgICAg\nc2VuZE1lc3NhZ2VzKHNlc3Npb24sIGRlc3RpbmF0aW9uLCAxKTsKICAgICAg\nICBhc3NlcnRGYWxzZShkb25lMi5hd2FpdCgxLCBUaW1lVW5pdC5TRUNPTkRT\nKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKDEsIGNvdW50ZXIuZ2V0KCkpOwoK\nICAgICAgICAvLyBTdGFydCB0aGUgY29uc3VtZXIsIGFuZCB0aGUgbWVzc2Fn\nZSBzaG91bGQgbm93IGdldCBkZWxpdmVyZWQuCiAgICAgICAgY29ubmVjdGlv\nbi5zdGFydCgpOwogICAgICAgIGFzc2VydFRydWUoZG9uZTIuYXdhaXQoMSwg\nVGltZVVuaXQuU0VDT05EUykpOwogICAgICAgIGFzc2VydEVxdWFscygyLCBj\nb3VudGVyLmdldCgpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0TWVz\nc2FnZUxpc3RlbmVyV2l0aENvbnN1bWVyQ2FuQmVTdG9wcGVkQ29uY3VyZW50\nbHkoKSB0aHJvd3MgRXhjZXB0aW9uIHsKCiAgICAgICAgZmluYWwgQXRvbWlj\nSW50ZWdlciBjb3VudGVyID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAg\nICAgZmluYWwgQ291bnREb3duTGF0Y2ggY2xvc2VEb25lID0gbmV3IENvdW50\nRG93bkxhdGNoKDEpOwoKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CiAg\nICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNz\naW9uKGZhbHNlLCBTZXNzaW9uLkNMSUVOVF9BQ0tOT1dMRURHRSk7CiAgICAg\nICAgZGVzdGluYXRpb24gPSBjcmVhdGVEZXN0aW5hdGlvbihzZXNzaW9uLCBN\nZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlwZS5UT1BJQyk7\nCgogICAgICAgIGZpbmFsIE1hcDxUaHJlYWQsIFRocm93YWJsZT4gZXhjZXB0\naW9ucyA9CiAgICAgICAgICAgIENvbGxlY3Rpb25zLnN5bmNocm9uaXplZE1h\ncChuZXcgSGFzaE1hcDxUaHJlYWQsIFRocm93YWJsZT4oKSk7CiAgICAgICAg\nVGhyZWFkLnNldERlZmF1bHRVbmNhdWdodEV4Y2VwdGlvbkhhbmRsZXIobmV3\nIFVuY2F1Z2h0RXhjZXB0aW9uSGFuZGxlcigpIHsKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgdW5jYXVnaHRFeGNlcHRpb24oVGhyZWFkIHQsIFRocm93YWJs\nZSBlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlVuY2F1Z2h0IGV4\nY2VwdGlvbjoiLCBlKTsKICAgICAgICAgICAgICAgIGV4Y2VwdGlvbnMucHV0\nKHQsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGZp\nbmFsIGludCBudW1PdXRTdGFuZGluZyA9IChjb25uZWN0aW9uLmdldEhlZHdp\nZ0NsaWVudENvbmZpZygpLmdldE1heGltdW1PdXRzdGFuZGluZ01lc3NhZ2Vz\nKCkgKiAyIC8gMykgKyAxOwoKICAgICAgICBmaW5hbCBNZXNzYWdlQ29uc3Vt\nZXIgY29uc3VtZXIgPSAoTWVzc2FnZUNvbnN1bWVyKXNlc3Npb24uY3JlYXRl\nQ29uc3VtZXIoZGVzdGluYXRpb24pOwoKICAgICAgICBmaW5hbCBjbGFzcyBB\nY2tBbmRDbG9zZSBpbXBsZW1lbnRzIFJ1bm5hYmxlIHsKICAgICAgICAgICAg\ncHJpdmF0ZSBNZXNzYWdlIG1lc3NhZ2U7CgogICAgICAgICAgICBwdWJsaWMg\nQWNrQW5kQ2xvc2UoTWVzc2FnZSBtKSB7CiAgICAgICAgICAgICAgICB0aGlz\nLm1lc3NhZ2UgPSBtOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIG1lc3NhZ2UuYWNrbm93bGVkZ2UoKTsKICAgICAgICAg\nICAgICAgICAgICBpbnQgY291bnQgPSBjb3VudGVyLmluY3JlbWVudEFuZEdl\ndCgpOwogICAgICAgICAgICAgICAgICAgIGlmICg1OTAgPT0gY291bnQpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgaW4gYSBzZXBhcmF0\nZSB0aHJlYWQgaXMgb2sgYnkgam1zCiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNs\nb3NlRG9uZS5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIG9uIGNsb3NlIG9y\nIGFjazoiLCBlKTsKICAgICAgICAgICAgICAgICAgICBleGNlcHRpb25zLnB1\ndChUaHJlYWQuY3VycmVudFRocmVhZCgpLCBlKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIGZpbmFsIEF0\nb21pY0ludGVnZXIgbGlzdGVuZXJSZWNlaXZlZENvdW50ID0gbmV3IEF0b21p\nY0ludGVnZXIoMCk7CiAgICAgICAgLy8gZmluYWwgRXhlY3V0b3JTZXJ2aWNl\nIGV4ZWN1dG9yID0gRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZEV4ZWN1dG9y\nKCk7CiAgICAgICAgZmluYWwgRXhlY3V0b3JTZXJ2aWNlIGV4ZWN1dG9yID0g\nRXhlY3V0b3JzLm5ld0NhY2hlZFRocmVhZFBvb2woKTsKICAgICAgICBjb25z\ndW1lci5zZXRNZXNzYWdlTGlzdGVuZXIobmV3IE1lc3NhZ2VMaXN0ZW5lcigp\nIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgb25NZXNzYWdlKE1lc3NhZ2Ug\nbSkgewogICAgICAgICAgICAgICAgLy8gY2xvc2UgY2FuIGJlIGluIGEgZGlm\nZmVyZW50IHRocmVhZCwgYnV0IE5PVCBhY2tub3dsZWRnZSBpaXJjCiAgICAg\nICAgICAgICAgICAvLyAtIHRoaXMgd2lsbCBub3QgY2F1c2UgYSBwcm9ibGVt\nIGZvciB1cyB0aG91Z2ggLi4uCiAgICAgICAgICAgICAgICAvLyBhY2sgYW5k\nIGNsb3NlIGV2ZW50dWFsbHkgaW4gc2VwYXJhdGUgdGhyZWFkCiAgICAgICAg\nICAgICAgICBpbnQgdmFsID0gbGlzdGVuZXJSZWNlaXZlZENvdW50LmluY3Jl\nbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAgLy8gU3lzdGVtLm91dC5w\ncmludGxuKCJtZXNzYWdlIGNvdW50IDogIiArIHZhbCArICIsIG1lc3NhZ2Ug\nOiAiICsgbSk7CiAgICAgICAgICAgICAgICBleGVjdXRvci5leGVjdXRlKG5l\ndyBBY2tBbmRDbG9zZShtKSk7CiAgICAgICAgICAgICAgICAvLyBuZXcgQWNr\nQW5kQ2xvc2UobSkucnVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsK\nCiAgICAgICAgLy8gcHJlbG9hZCB0aGUgcXVldWUKICAgICAgICBzZW5kTWVz\nc2FnZXMoc2Vzc2lvbiwgZGVzdGluYXRpb24sIDYwMCk7CgogICAgICAgIGFz\nc2VydCBjbG9zZURvbmUuYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMpIDoK\nICAgICAgICAiY2xvc2VEb25lIDogIiArIGNsb3NlRG9uZS5nZXRDb3VudCgp\nICsgIiwgY291bnRlciA6ICIgKyBjb3VudGVyLmdldCgpCiAgICAgICAgICAg\nICsgIiwgbGlzdGVuZXJSZWNlaXZlZENvdW50IDogIiArIGxpc3RlbmVyUmVj\nZWl2ZWRDb3VudC5nZXQoKTsKICAgICAgICAvLyBhd2FpdCBwb3NzaWJsZSBl\neGNlcHRpb25zCiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAg\nIGFzc2VydFRydWUoIm5vIGV4Y2VwdGlvbnM6ICIgKyBleGNlcHRpb25zLCBl\neGNlcHRpb25zLmlzRW1wdHkoKSk7CiAgICB9CgoKICAgIHB1YmxpYyB2b2lk\nIGluaXRDb21ib3NGb3JUZXN0TXV0aVJlY2VpdmVXaXRoUHJlZmV0Y2gxKCkg\newogICAgICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCJkZWxpdmVyeU1vZGUi\nLCBuZXcgT2JqZWN0W10gewogICAgICAgICAgICAgICAgSW50ZWdlci52YWx1\nZU9mKERlbGl2ZXJ5TW9kZS5OT05fUEVSU0lTVEVOVCksIEludGVnZXIudmFs\ndWVPZihEZWxpdmVyeU1vZGUuUEVSU0lTVEVOVCl9KTsKICAgICAgICBhZGRD\nb21iaW5hdGlvblZhbHVlcygiYWNrTW9kZSIsIG5ldyBPYmplY3RbXSB7CiAg\nICAgICAgICAgICAgICBJbnRlZ2VyLnZhbHVlT2YoU2Vzc2lvbi5BVVRPX0FD\nS05PV0xFREdFKSwgSW50ZWdlci52YWx1ZU9mKFNlc3Npb24uRFVQU19PS19B\nQ0tOT1dMRURHRSksCiAgICAgICAgICAgICAgICBJbnRlZ2VyLnZhbHVlT2Yo\nU2Vzc2lvbi5DTElFTlRfQUNLTk9XTEVER0UpfSk7CiAgICAgICAgYWRkQ29t\nYmluYXRpb25WYWx1ZXMoImRlc3RpbmF0aW9uVHlwZSIsIG5ldyBPYmplY3Rb\nXSB7TWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUuVE9Q\nSUN9KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0TXV0aVJlY2VpdmVX\naXRoUHJlZmV0Y2gxKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CgogICAgICAgIC8v\nIFNldCBwcmVmZXRjaCB0byAxCiAgICAgICAgY29ubmVjdGlvbi5zdGFydCgp\nOwoKICAgICAgICAvLyBVc2UgYWxsIHRoZSBhY2sgbW9kZXMKICAgICAgICBT\nZXNzaW9uIHNlc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24oZmFs\nc2UsIGFja01vZGUpOwogICAgICAgIGRlc3RpbmF0aW9uID0gY3JlYXRlRGVz\ndGluYXRpb24oc2Vzc2lvbiwgZGVzdGluYXRpb25UeXBlKTsKICAgICAgICBN\nZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1\nbWVyKGRlc3RpbmF0aW9uKTsKCiAgICAgICAgLy8gU2VuZCB0aGUgbWVzc2Fn\nZXMKICAgICAgICBzZW5kTWVzc2FnZXMoc2Vzc2lvbiwgZGVzdGluYXRpb24s\nIDQpOwoKICAgICAgICAvLyBNYWtlIHN1cmUgNCBtZXNzYWdlcyB3ZXJlIGRl\nbGl2ZXJlZC4KICAgICAgICBNZXNzYWdlIG1lc3NhZ2UgPSBudWxsOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICAg\nIG1lc3NhZ2UgPSBjb25zdW1lci5yZWNlaXZlKDEwMDApOwogICAgICAgICAg\nICBhc3NlcnROb3ROdWxsKG1lc3NhZ2UpOwogICAgICAgIH0KICAgICAgICBh\nc3NlcnROdWxsKGNvbnN1bWVyLnJlY2VpdmVOb1dhaXQoKSk7CiAgICAgICAg\nYXNzZXJ0IG51bGwgIT0gbWVzc2FnZTsKICAgICAgICBtZXNzYWdlLmFja25v\nd2xlZGdlKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5pdENvbWJvc0Zv\nclRlc3REdXJhYmxlQ29uc3VtZXJTZWxlY3RvckNoYW5nZSgpIHsKICAgICAg\nICBhZGRDb21iaW5hdGlvblZhbHVlcygiZGVsaXZlcnlNb2RlIiwgbmV3IE9i\namVjdFtdIHsKICAgICAgICAgICAgICAgIEludGVnZXIudmFsdWVPZihEZWxp\ndmVyeU1vZGUuTk9OX1BFUlNJU1RFTlQpLCBJbnRlZ2VyLnZhbHVlT2YoRGVs\naXZlcnlNb2RlLlBFUlNJU1RFTlQpfSk7CiAgICAgICAgYWRkQ29tYmluYXRp\nb25WYWx1ZXMoImRlc3RpbmF0aW9uVHlwZSIsIG5ldyBPYmplY3RbXSB7TWVz\nc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUuVE9QSUN9KTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0RHVyYWJsZUNvbnN1bWVyU2Vs\nZWN0b3JDaGFuZ2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKCiAgICAgICAgLy8g\nUmVjZWl2ZSBhIG1lc3NhZ2Ugd2l0aCB0aGUgSk1TIEFQSQogICAgICAgIGlm\nIChudWxsID09IGNvbm5lY3Rpb24uZ2V0Q2xpZW50SUQoKSkgY29ubmVjdGlv\nbi5zZXRDbGllbnRJRChnZXROYW1lKCkgKyAidGVzdCIpOwogICAgICAgIGNv\nbm5lY3Rpb24uc3RhcnQoKTsKICAgICAgICBTZXNzaW9uIHNlc3Npb24gPSBj\nb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24oZmFsc2UsIFNlc3Npb24uQVVUT19B\nQ0tOT1dMRURHRSk7CiAgICAgICAgZGVzdGluYXRpb24gPSBjcmVhdGVEZXN0\naW5hdGlvbihzZXNzaW9uLCBkZXN0aW5hdGlvblR5cGUpOwogICAgICAgIE1l\nc3NhZ2VQcm9kdWNlciBwcm9kdWNlciA9IHNlc3Npb24uY3JlYXRlUHJvZHVj\nZXIoZGVzdGluYXRpb24pOwogICAgICAgIHByb2R1Y2VyLnNldERlbGl2ZXJ5\nTW9kZShkZWxpdmVyeU1vZGUpOwogICAgICAgIE1lc3NhZ2VDb25zdW1lciBj\nb25zdW1lciA9IHNlc3Npb24uY3JlYXRlRHVyYWJsZVN1YnNjcmliZXIoKFRv\ncGljKWRlc3RpbmF0aW9uLCAidGVzdCIsICJjb2xvcj0ncmVkJyIsIGZhbHNl\nKTsKCiAgICAgICAgLy8gU2VuZCB0aGUgbWVzc2FnZXMKICAgICAgICBUZXh0\nTWVzc2FnZSBtZXNzYWdlID0gc2Vzc2lvbi5jcmVhdGVUZXh0TWVzc2FnZSgi\nMXN0Iik7CiAgICAgICAgbWVzc2FnZS5zZXRTdHJpbmdQcm9wZXJ0eSgiY29s\nb3IiLCAicmVkIik7CiAgICAgICAgcHJvZHVjZXIuc2VuZChtZXNzYWdlKTsK\nCiAgICAgICAgTWVzc2FnZSBtID0gY29uc3VtZXIucmVjZWl2ZSgxMDAwKTsK\nICAgICAgICBhc3NlcnROb3ROdWxsKG0pOwogICAgICAgIGFzc2VydEVxdWFs\ncygiMXN0IiwgKChUZXh0TWVzc2FnZSltKS5nZXRUZXh0KCkpOwoKICAgICAg\nICAvLyBDaGFuZ2UgdGhlIHN1YnNjcmlwdGlvbi4KICAgICAgICBjb25zdW1l\nci5jbG9zZSgpOwogICAgICAgIGNvbnN1bWVyID0gc2Vzc2lvbi5jcmVhdGVE\ndXJhYmxlU3Vic2NyaWJlcigoVG9waWMpZGVzdGluYXRpb24sICJ0ZXN0Iiwg\nImNvbG9yPSdibHVlJyIsIGZhbHNlKTsKCiAgICAgICAgbWVzc2FnZSA9IHNl\nc3Npb24uY3JlYXRlVGV4dE1lc3NhZ2UoIjJuZCIpOwogICAgICAgIG1lc3Nh\nZ2Uuc2V0U3RyaW5nUHJvcGVydHkoImNvbG9yIiwgInJlZCIpOwogICAgICAg\nIHByb2R1Y2VyLnNlbmQobWVzc2FnZSk7CiAgICAgICAgbWVzc2FnZSA9IHNl\nc3Npb24uY3JlYXRlVGV4dE1lc3NhZ2UoIjNyZCIpOwogICAgICAgIG1lc3Nh\nZ2Uuc2V0U3RyaW5nUHJvcGVydHkoImNvbG9yIiwgImJsdWUiKTsKICAgICAg\nICBwcm9kdWNlci5zZW5kKG1lc3NhZ2UpOwoKICAgICAgICAvLyBTZWxlY3Rv\nciBzaG91bGQgc2tpcCB0aGUgMm5kIG1lc3NhZ2UuCiAgICAgICAgbSA9IGNv\nbnN1bWVyLnJlY2VpdmUoMTAwMCk7CiAgICAgICAgYXNzZXJ0Tm90TnVsbCht\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIjNyZCIsICgoVGV4dE1lc3NhZ2Up\nbSkuZ2V0VGV4dCgpKTsKCiAgICAgICAgYXNzZXJ0TnVsbChjb25zdW1lci5y\nZWNlaXZlTm9XYWl0KCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRD\nb21ib3NGb3JUZXN0U2VuZFJlY2VpdmVCeXRlc01lc3NhZ2UoKSB7CiAgICAg\nICAgYWRkQ29tYmluYXRpb25WYWx1ZXMoImRlbGl2ZXJ5TW9kZSIsIG5ldyBP\nYmplY3RbXSB7CiAgICAgICAgICAgICAgICBJbnRlZ2VyLnZhbHVlT2YoRGVs\naXZlcnlNb2RlLk5PTl9QRVJTSVNURU5UKSwgSW50ZWdlci52YWx1ZU9mKERl\nbGl2ZXJ5TW9kZS5QRVJTSVNURU5UKX0pOwogICAgICAgIGFkZENvbWJpbmF0\naW9uVmFsdWVzKCJkZXN0aW5hdGlvblR5cGUiLCBuZXcgT2JqZWN0W10ge01l\nc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25UeXBlLlRPUElDfSk7\nCiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdFNlbmRSZWNlaXZlQnl0ZXNN\nZXNzYWdlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CgogICAgICAgIC8vIFJlY2Vp\ndmUgYSBtZXNzYWdlIHdpdGggdGhlIEpNUyBBUEkKICAgICAgICBjb25uZWN0\naW9uLnN0YXJ0KCk7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVj\ndGlvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9fQUNLTk9X\nTEVER0UpOwogICAgICAgIGRlc3RpbmF0aW9uID0gY3JlYXRlRGVzdGluYXRp\nb24oc2Vzc2lvbiwgZGVzdGluYXRpb25UeXBlKTsKICAgICAgICBNZXNzYWdl\nQ29uc3VtZXIgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1bWVyKGRl\nc3RpbmF0aW9uKTsKICAgICAgICBNZXNzYWdlUHJvZHVjZXIgcHJvZHVjZXIg\nPSBzZXNzaW9uLmNyZWF0ZVByb2R1Y2VyKGRlc3RpbmF0aW9uKTsKCiAgICAg\nICAgQnl0ZXNNZXNzYWdlIG1lc3NhZ2UgPSBzZXNzaW9uLmNyZWF0ZUJ5dGVz\nTWVzc2FnZSgpOwogICAgICAgIG1lc3NhZ2Uud3JpdGVCb29sZWFuKHRydWUp\nOwogICAgICAgIG1lc3NhZ2Uud3JpdGVCb29sZWFuKGZhbHNlKTsKICAgICAg\nICBwcm9kdWNlci5zZW5kKG1lc3NhZ2UpOwoKICAgICAgICAvLyBNYWtlIHN1\ncmUgb25seSAxIG1lc3NhZ2Ugd2FzIGRlbGl2ZXJlZC4KICAgICAgICBCeXRl\nc01lc3NhZ2UgbSA9IChCeXRlc01lc3NhZ2UpY29uc3VtZXIucmVjZWl2ZSgx\nMDAwKTsKICAgICAgICBhc3NlcnROb3ROdWxsKG0pOwogICAgICAgIGFzc2Vy\ndFRydWUobS5yZWFkQm9vbGVhbigpKTsKICAgICAgICBhc3NlcnRGYWxzZSht\nLnJlYWRCb29sZWFuKCkpOwoKICAgICAgICBhc3NlcnROdWxsKGNvbnN1bWVy\nLnJlY2VpdmVOb1dhaXQoKSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgaW5p\ndENvbWJvc0ZvclRlc3RTZXRNZXNzYWdlTGlzdGVuZXJBZnRlclN0YXJ0KCkg\newogICAgICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCJkZWxpdmVyeU1vZGUi\nLCBuZXcgT2JqZWN0W10gewogICAgICAgICAgICAgICAgSW50ZWdlci52YWx1\nZU9mKERlbGl2ZXJ5TW9kZS5OT05fUEVSU0lTVEVOVCksIEludGVnZXIudmFs\ndWVPZihEZWxpdmVyeU1vZGUuUEVSU0lTVEVOVCl9KTsKICAgICAgICBhZGRD\nb21iaW5hdGlvblZhbHVlcygiZGVzdGluYXRpb25UeXBlIiwgbmV3IE9iamVj\ndFtdIHtNZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlwZS5U\nT1BJQ30pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RTZXRNZXNzYWdl\nTGlzdGVuZXJBZnRlclN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CgogICAg\nICAgIGZpbmFsIEF0b21pY0ludGVnZXIgY291bnRlciA9IG5ldyBBdG9taWNJ\nbnRlZ2VyKDApOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGRvbmUg\nPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAgICAgIC8vIFJlY2VpdmUg\nYSBtZXNzYWdlIHdpdGggdGhlIEpNUyBBUEkKICAgICAgICBjb25uZWN0aW9u\nLnN0YXJ0KCk7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlv\nbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9fQUNLTk9XTEVE\nR0UpOwogICAgICAgIGRlc3RpbmF0aW9uID0gY3JlYXRlRGVzdGluYXRpb24o\nc2Vzc2lvbiwgZGVzdGluYXRpb25UeXBlKTsKICAgICAgICBNZXNzYWdlQ29u\nc3VtZXIgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1bWVyKGRlc3Rp\nbmF0aW9uKTsKCiAgICAgICAgLy8gU2VlIGlmIHRoZSBtZXNzYWdlIGdldCBz\nZW50IHRvIHRoZSBsaXN0ZW5lcgogICAgICAgIGNvbnN1bWVyLnNldE1lc3Nh\nZ2VMaXN0ZW5lcihuZXcgTWVzc2FnZUxpc3RlbmVyKCkgewogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBvbk1lc3NhZ2UoTWVzc2FnZSBtKSB7CiAgICAgICAg\nICAgICAgICBjb3VudGVyLmluY3JlbWVudEFuZEdldCgpOwogICAgICAgICAg\nICAgICAgaWYgKGNvdW50ZXIuZ2V0KCkgPT0gNCkgewogICAgICAgICAgICAg\nICAgICAgIGRvbmUuY291bnREb3duKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gU2VuZCB0aGUg\nbWVzc2FnZXMKICAgICAgICBzZW5kTWVzc2FnZXMoc2Vzc2lvbiwgZGVzdGlu\nYXRpb24sIDQpOwoKICAgICAgICBhc3NlcnRUcnVlKGRvbmUuYXdhaXQoMTAw\nMCwgVGltZVVuaXQuTUlMTElTRUNPTkRTKSk7CiAgICAgICAgVGhyZWFkLnNs\nZWVwKDIwMCk7CgogICAgICAgIC8vIE1ha2Ugc3VyZSBvbmx5IDQgbWVzc2Fn\nZXMgd2VyZSBkZWxpdmVyZWQuCiAgICAgICAgYXNzZXJ0RXF1YWxzKDQsIGNv\ndW50ZXIuZ2V0KCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRDb21i\nb3NGb3JUZXN0UGFzc01lc3NhZ2VMaXN0ZW5lckludG9DcmVhdGVDb25zdW1l\ncigpIHsKICAgICAgICBhZGRDb21iaW5hdGlvblZhbHVlcygiZGVzdGluYXRp\nb25UeXBlIiwgbmV3IE9iamVjdFtdIHtNZXNzYWdpbmdTZXNzaW9uRmFjYWRl\nLkRlc3RpbmF0aW9uVHlwZS5UT1BJQ30pOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHRlc3RQYXNzTWVzc2FnZUxpc3RlbmVySW50b0NyZWF0ZUNvbnN1bWVy\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CgogICAgICAgIGZpbmFsIEF0b21pY0lu\ndGVnZXIgY291bnRlciA9IG5ldyBBdG9taWNJbnRlZ2VyKDApOwogICAgICAg\nIGZpbmFsIENvdW50RG93bkxhdGNoIGRvbmUgPSBuZXcgQ291bnREb3duTGF0\nY2goMSk7CgogICAgICAgIC8vIFJlY2VpdmUgYSBtZXNzYWdlIHdpdGggdGhl\nIEpNUyBBUEkKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CiAgICAgICAg\nU2Vzc2lvbkltcGwgc2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lv\nbihmYWxzZSwgU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFKTsKICAgICAgICBk\nZXN0aW5hdGlvbiA9IGNyZWF0ZURlc3RpbmF0aW9uKHNlc3Npb24sIGRlc3Rp\nbmF0aW9uVHlwZSk7CiAgICAgICAgTWVzc2FnZUNvbnN1bWVyIGNvbnN1bWVy\nID0gc2Vzc2lvbi5jcmVhdGVDb25zdW1lcihkZXN0aW5hdGlvbik7CiAgICAg\nICAgY29uc3VtZXIuc2V0TWVzc2FnZUxpc3RlbmVyKG5ldyBNZXNzYWdlTGlz\ndGVuZXIoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uTWVzc2FnZShN\nZXNzYWdlIG0pIHsKICAgICAgICAgICAgICAgIGNvdW50ZXIuaW5jcmVtZW50\nQW5kR2V0KCk7CiAgICAgICAgICAgICAgICBpZiAoY291bnRlci5nZXQoKSA9\nPSA0KSB7CiAgICAgICAgICAgICAgICAgICAgZG9uZS5jb3VudERvd24oKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoK\nICAgICAgICAvLyBTZW5kIHRoZSBtZXNzYWdlcwogICAgICAgIHNlbmRNZXNz\nYWdlcyhzZXNzaW9uLCBkZXN0aW5hdGlvbiwgNCk7CgogICAgICAgIGFzc2Vy\ndFRydWUoZG9uZS5hd2FpdCgxMDAwLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMp\nKTsKICAgICAgICBUaHJlYWQuc2xlZXAoMjAwKTsKCiAgICAgICAgLy8gTWFr\nZSBzdXJlIG9ubHkgNCBtZXNzYWdlcyB3ZXJlIGRlbGl2ZXJlZC4KICAgICAg\nICBhc3NlcnRFcXVhbHMoNCwgY291bnRlci5nZXQoKSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgaW5pdENvbWJvc0ZvclRlc3RNZXNzYWdlTGlzdGVuZXJP\nbk1lc3NhZ2VDbG9zZVVuYWNrZWRXaXRoUHJlZmV0Y2gxU3RheUluUXVldWUo\nKSB7CiAgICAgICAgYWRkQ29tYmluYXRpb25WYWx1ZXMoImRlbGl2ZXJ5TW9k\nZSIsIG5ldyBPYmplY3RbXSB7CiAgICAgICAgICAgICAgICBJbnRlZ2VyLnZh\nbHVlT2YoRGVsaXZlcnlNb2RlLk5PTl9QRVJTSVNURU5UKSwgSW50ZWdlci52\nYWx1ZU9mKERlbGl2ZXJ5TW9kZS5QRVJTSVNURU5UKX0pOwogICAgICAgIGFk\nZENvbWJpbmF0aW9uVmFsdWVzKCJhY2tNb2RlIiwgbmV3IE9iamVjdFtdIHtJ\nbnRlZ2VyLnZhbHVlT2YoU2Vzc2lvbi5DTElFTlRfQUNLTk9XTEVER0UpfSk7\nCiAgICAgICAgYWRkQ29tYmluYXRpb25WYWx1ZXMoImRlc3RpbmF0aW9uVHlw\nZSIsIG5ldyBPYmplY3RbXSB7TWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0\naW5hdGlvblR5cGUuVE9QSUN9KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0\nZXN0TWVzc2FnZUxpc3RlbmVyT25NZXNzYWdlQ2xvc2VVbmFja2VkV2l0aFBy\nZWZldGNoMVN0YXlJblF1ZXVlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgZmluYWwgQXRvbWljSW50ZWdlciBjb3VudGVyID0gbmV3IEF0b21pY0lu\ndGVnZXIoMCk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggc2VuZERv\nbmUgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgQ291\nbnREb3duTGF0Y2ggZ290MkRvbmUgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7\nCgogICAgICAgIC8vIFNldCBwcmVmZXRjaCB0byAxCiAgICAgICAgLy8gVGhp\ncyB0ZXN0IGNhc2UgZG9lcyBub3Qgd29yayBpZiBvcHRpbWl6ZWQgbWVzc2Fn\nZSBkaXNwYXRjaCBpcyB1c2VkIGFzCiAgICAgICAgLy8gdGhlIG1haW4gdGhy\nZWFkIHNlbmQgYmxvY2sgdW50aWwgdGhlIGNvbnN1bWVyIHJlY2VpdmVzIHRo\nZQogICAgICAgIC8vIG1lc3NhZ2UuIFRoaXMgdGVzdCBkZXBlbmRzIG9uIHRo\ncmVhZCBkZWNvdXBsaW5nIHNvIHRoYXQgdGhlIG1haW4KICAgICAgICAvLyB0\naHJlYWQgY2FuIHN0b3AgdGhlIGNvbnN1bWVyIHRocmVhZC4KICAgICAgICBp\nZiAobnVsbCA9PSBjb25uZWN0aW9uLmdldENsaWVudElEKCkpIGNvbm5lY3Rp\nb24uc2V0Q2xpZW50SUQoZ2V0TmFtZSgpICsgInRlc3QtY2xpZW50LWlkLTEi\nKTsKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CgogICAgICAgIC8vIFVz\nZSBhbGwgdGhlIGFjayBtb2RlcwogICAgICAgIFNlc3Npb24gc2Vzc2lvbiA9\nIGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lvbihmYWxzZSwgYWNrTW9kZSk7CiAg\nICAgICAgZGVzdGluYXRpb24gPSBjcmVhdGVEZXN0aW5hdGlvbihzZXNzaW9u\nLCBkZXN0aW5hdGlvblR5cGUpOwogICAgICAgIE1lc3NhZ2VDb25zdW1lciBj\nb25zdW1lciA9IHNlc3Npb24uY3JlYXRlRHVyYWJsZVN1YnNjcmliZXIoKFRv\ncGljKSBkZXN0aW5hdGlvbiwgInN1YnNjcmliZXItaWQxIik7CiAgICAgICAg\nY29uc3VtZXIuc2V0TWVzc2FnZUxpc3RlbmVyKG5ldyBNZXNzYWdlTGlzdGVu\nZXIoKSB7CiAgICAgICAgICAgIHByaXZhdGUgZmluYWwgSGVkd2lnQ29ubmVj\ndGlvbkltcGwgX2Nvbm5lY3Rpb24gPSBjb25uZWN0aW9uOwogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBvbk1lc3NhZ2UoTWVzc2FnZSBtKSB7CiAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIFRleHRNZXNzYWdl\nIHRtID0gKFRleHRNZXNzYWdlKW07CiAgICAgICAgICAgICAgICAgICAgTE9H\nLmluZm8oIkdvdCBpbiBmaXJzdCBsaXN0ZW5lcjogIiArIHRtLmdldFRleHQo\nKSk7CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKG1lc3NhZ2VU\nZXh0UHJlZml4ICsgY291bnRlci5nZXQoKSwgdG0uZ2V0VGV4dCgpKTsKICAg\nICAgICAgICAgICAgICAgICBjb3VudGVyLmluY3JlbWVudEFuZEdldCgpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChjb3VudGVyLmdldCgpID09IDIpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgc2VuZERvbmUuYXdhaXQoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgX2Nvbm5lY3Rpb24uY2xvc2UoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgZ290MkRvbmUuY291bnREb3duKCk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIHdp\nbGwgZmFpbCB3aGVuIHdlIGNsb3NlIGNvbm5lY3Rpb24gd2hlbiBjb3VudGVy\nID09IDIgIQogICAgICAgICAgICAgICAgICAgIHRtLmFja25vd2xlZGdlKCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAg\nICAgLy8gU2VuZCB0aGUgbWVzc2FnZXMKICAgICAgICBzZW5kTWVzc2FnZXMo\nc2Vzc2lvbiwgZGVzdGluYXRpb24sIDQpOwogICAgICAgIHNlbmREb25lLmNv\ndW50RG93bigpOwoKICAgICAgICAvLyBXYWl0IGZvciBmaXJzdCAyIG1lc3Nh\nZ2VzIHRvIGFycml2ZS4KICAgICAgICBhc3NlcnQgZ290MkRvbmUuYXdhaXQo\nNSwgVGltZVVuaXQuU0VDT05EUykgOgogICAgICAgICJjb3VudGVyMSA6ICIg\nKyBjb3VudGVyLmdldCgpICsgIiwgZ290MkRvbmUgOiAiICsgZ290MkRvbmUu\nZ2V0Q291bnQoKSArICIsIHNlbmREb25lIDogIiArIHNlbmREb25lLmdldENv\ndW50KCk7CgogICAgICAgIC8vIFJlLXN0YXJ0IGNvbm5lY3Rpb24uCiAgICAg\nICAgY29ubmVjdGlvbi5jbG9zZSgpOwogICAgICAgIGNvbm5lY3Rpb24gPSAo\nSGVkd2lnQ29ubmVjdGlvbkltcGwpZmFjdG9yeS5jcmVhdGVDb25uZWN0aW9u\nKCk7CiAgICAgICAgaWYgKG51bGwgPT0gY29ubmVjdGlvbi5nZXRDbGllbnRJ\nRCgpKSBjb25uZWN0aW9uLnNldENsaWVudElEKGdldE5hbWUoKSArICJ0ZXN0\nLWNsaWVudC1pZC0xIik7CiAgICAgICAgY29ubmVjdGlvbnMuYWRkKGNvbm5l\nY3Rpb24pOwoKICAgICAgICAvLyBQaWNrdXAgdGhlIHJlbWFpbmluZyBtZXNz\nYWdlcy4KICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBkb25lMiA9IG5l\ndyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBzZXNzaW9uID0gY29ubmVj\ndGlvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBhY2tNb2RlKTsKICAgICAgICBj\nb25zdW1lciA9IHNlc3Npb24uY3JlYXRlRHVyYWJsZVN1YnNjcmliZXIoKFRv\ncGljKSBkZXN0aW5hdGlvbiwgInN1YnNjcmliZXItaWQxIik7CiAgICAgICAg\nY29uc3VtZXIuc2V0TWVzc2FnZUxpc3RlbmVyKG5ldyBNZXNzYWdlTGlzdGVu\nZXIoKSB7CiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uTWVzc2FnZShNZXNz\nYWdlIG0pIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgVGV4dE1lc3NhZ2UgdG0gPSAoVGV4dE1lc3NhZ2UpbTsKICAgICAg\nICAgICAgICAgICAgICBMT0cuaW5mbygiR290IGluIHNlY29uZCBsaXN0ZW5l\ncjogIiArIHRtLmdldFRleHQoKSk7CiAgICAgICAgICAgICAgICAgICAgLy8g\nb3JkZXIgaXMgbm90IGd1YXJhbnRlZWQgYXMgdGhlIGNvbm5lY3Rpb24gaXMg\nc3RhcnRlZCBiZWZvcmUgdGhlIGxpc3RlbmVyIGlzIHNldC4KICAgICAgICAg\nICAgICAgICAgICAvLyBhc3NlcnRFcXVhbHMobWVzc2FnZVRleHRQcmVmaXgg\nKyBjb3VudGVyLmdldCgpLCB0bS5nZXRUZXh0KCkpOwogICAgICAgICAgICAg\nICAgICAgIGNvdW50ZXIuaW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAgICAg\nICAgICAgICAgdG0uYWNrbm93bGVkZ2UoKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoY291bnRlci5nZXQoKSA9PSA0KSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGRvbmUyLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSBlKSB7CiAg\nICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJ1bmV4cGVjdGVkIGV4IG9u\nTWVzc2FnZTogIiwgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9KTsKCiAgICAgICAgY29ubmVjdGlvbi5zdGFydCgpOwoK\nICAgICAgICBhc3NlcnQgZG9uZTIuYXdhaXQoMjAwMCwgVGltZVVuaXQuTUlM\nTElTRUNPTkRTKSA6CiAgICAgICAgImNvdW50MiA6ICIgKyBkb25lMi5nZXRD\nb3VudCgpICsgIiwgY291bnRlciA6ICIgKyBjb3VudGVyLmdldCgpOwogICAg\nICAgIFRocmVhZC5zbGVlcCgyMDApOwoKICAgICAgICAvLyBhc3NlcnQgbXNn\nIDIgd2FzIHJlZGVsaXZlcmVkIGFzIGNsb3NlKCkgZnJvbSBvbk1lc3NhZ2Vz\nKCkgd2lsbCBvbmx5IGFjayBpbiBhdXRvX2FjayBhbmQgZHVwc19vayBtb2Rl\nCiAgICAgICAgYXNzZXJ0IDUgPT0gY291bnRlci5nZXQoKTogImNvdW50MyA6\nICIgKyBkb25lMi5nZXRDb3VudCgpICsgIiwgY291bnRlciA6ICIgKyBjb3Vu\ndGVyLmdldCgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRDb21ib3NG\nb3JUZXN0TWVzc2FnZUxpc3RlbmVyQXV0b0Fja09uQ2xvc2VXaXRoUHJlZmV0\nY2gxKCkgewogICAgICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCJkZWxpdmVy\neU1vZGUiLCBuZXcgT2JqZWN0W10gewogICAgICAgICAgICAgICAgSW50ZWdl\nci52YWx1ZU9mKERlbGl2ZXJ5TW9kZS5OT05fUEVSU0lTVEVOVCksIEludGVn\nZXIudmFsdWVPZihEZWxpdmVyeU1vZGUuUEVSU0lTVEVOVCl9KTsKICAgICAg\nICBhZGRDb21iaW5hdGlvblZhbHVlcygiYWNrTW9kZSIsIG5ldyBPYmplY3Rb\nXSB7CiAgICAgICAgICAgICAgICBJbnRlZ2VyLnZhbHVlT2YoU2Vzc2lvbi5B\nVVRPX0FDS05PV0xFREdFKSwgSW50ZWdlci52YWx1ZU9mKFNlc3Npb24uQ0xJ\nRU5UX0FDS05PV0xFREdFKX0pOwogICAgICAgIGFkZENvbWJpbmF0aW9uVmFs\ndWVzKCJkZXN0aW5hdGlvblR5cGUiLCBuZXcgT2JqZWN0W10ge01lc3NhZ2lu\nZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25UeXBlLlRPUElDfSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgdGVzdE1lc3NhZ2VMaXN0ZW5lckF1dG9BY2tP\nbkNsb3NlV2l0aFByZWZldGNoMSgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGZpbmFsIEF0b21pY0ludGVnZXIgY291bnRlciA9IG5ldyBBdG9taWNJ\nbnRlZ2VyKDApOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHNlbmRE\nb25lID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIGZpbmFsIENv\ndW50RG93bkxhdGNoIGdvdDJEb25lID0gbmV3IENvdW50RG93bkxhdGNoKDEp\nOwoKICAgICAgICAvLyBTZXQgcHJlZmV0Y2ggdG8gMQogICAgICAgIC8vIFRo\naXMgdGVzdCBjYXNlIGRvZXMgbm90IHdvcmsgaWYgb3B0aW1pemVkIG1lc3Nh\nZ2UgZGlzcGF0Y2ggaXMgdXNlZCBhcwogICAgICAgIC8vIHRoZSBtYWluIHRo\ncmVhZCBzZW5kIGJsb2NrIHVudGlsIHRoZSBjb25zdW1lciByZWNlaXZlcyB0\naGUKICAgICAgICAvLyBtZXNzYWdlLiBUaGlzIHRlc3QgZGVwZW5kcyBvbiB0\naHJlYWQgZGVjb3VwbGluZyBzbyB0aGF0IHRoZSBtYWluCiAgICAgICAgLy8g\ndGhyZWFkIGNhbiBzdG9wIHRoZSBjb25zdW1lciB0aHJlYWQuCiAgICAgICAg\naWYgKG51bGwgPT0gY29ubmVjdGlvbi5nZXRDbGllbnRJRCgpKSBjb25uZWN0\naW9uLnNldENsaWVudElEKGdldE5hbWUoKSArICJ0ZXN0LWNsaWVudC1pZC0y\nIik7CiAgICAgICAgY29ubmVjdGlvbi5zdGFydCgpOwoKICAgICAgICAvLyBV\nc2UgYWxsIHRoZSBhY2sgbW9kZXMKICAgICAgICBTZXNzaW9uIHNlc3Npb24g\nPSBjb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24oZmFsc2UsIGFja01vZGUpOwog\nICAgICAgIGRlc3RpbmF0aW9uID0gY3JlYXRlRGVzdGluYXRpb24oc2Vzc2lv\nbiwgZGVzdGluYXRpb25UeXBlKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIg\nY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKChU\nb3BpYykgZGVzdGluYXRpb24sICJzdWJzY3JpYmVyLWlkMiIpOwogICAgICAg\nIGZpbmFsIExpc3Q8TWVzc2FnZT4gcmVjZWl2ZWRNZXNzYWdlcyA9IG5ldyBB\ncnJheUxpc3Q8TWVzc2FnZT4oOCk7CiAgICAgICAgY29uc3VtZXIuc2V0TWVz\nc2FnZUxpc3RlbmVyKG5ldyBNZXNzYWdlTGlzdGVuZXIoKSB7CiAgICAgICAg\nICAgIGZpbmFsIEhlZHdpZ0Nvbm5lY3Rpb25JbXBsIF9jb25uZWN0aW9uID0g\nY29ubmVjdGlvbjsKICAgICAgICAgICAgcHVibGljIHZvaWQgb25NZXNzYWdl\nKE1lc3NhZ2UgbSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBUZXh0TWVzc2FnZSB0bSA9IChUZXh0TWVzc2FnZSltOwog\nICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJHb3QgaW4gZmlyc3QgbGlz\ndGVuZXI6ICIgKyB0bS5nZXRUZXh0KCkpOwogICAgICAgICAgICAgICAgICAg\nIGFzc2VydEVxdWFscyhtZXNzYWdlVGV4dFByZWZpeCArIGNvdW50ZXIuZ2V0\nKCksIHRtLmdldFRleHQoKSk7CiAgICAgICAgICAgICAgICAgICAgY291bnRl\nci5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAgICAgICBtLmFj\na25vd2xlZGdlKCk7CiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWRNZXNz\nYWdlcy5hZGQobSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ZXIu\nZ2V0KCkgPT0gMikgewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kRG9u\nZS5hd2FpdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBfY29ubmVjdGlv\nbi5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBnb3QyRG9uZS5j\nb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChUaHJvd2FibGUgZSkgewogICAgICAgICAgICAgICAg\nICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gU2VuZCB0aGUg\nbWVzc2FnZXMKICAgICAgICBzZW5kTWVzc2FnZXMoc2Vzc2lvbiwgZGVzdGlu\nYXRpb24sIDQpOwogICAgICAgIHNlbmREb25lLmNvdW50RG93bigpOwoKICAg\nICAgICAvLyBXYWl0IGZvciBmaXJzdCAyIG1lc3NhZ2VzIHRvIGFycml2ZS4K\nICAgICAgICBhc3NlcnQgZ290MkRvbmUuYXdhaXQoNSwgVGltZVVuaXQuU0VD\nT05EUykgOgogICAgICAgICJjb3VudGVyIDogIiArIGNvdW50ZXIuZ2V0KCkg\nKyAiLCBnb3QyRG9uZSA6ICIgKyBnb3QyRG9uZS5nZXRDb3VudCgpICsgIiwg\nc2VuZERvbmUgOiAiICsgc2VuZERvbmUuZ2V0Q291bnQoKTsKCiAgICAgICAg\nLy8gUmUtc3RhcnQgY29ubmVjdGlvbi4KICAgICAgICBjb25uZWN0aW9uLmNs\nb3NlKCk7CiAgICAgICAgY29ubmVjdGlvbiA9IChIZWR3aWdDb25uZWN0aW9u\nSW1wbClmYWN0b3J5LmNyZWF0ZUNvbm5lY3Rpb24oKTsKICAgICAgICBpZiAo\nbnVsbCA9PSBjb25uZWN0aW9uLmdldENsaWVudElEKCkpIGNvbm5lY3Rpb24u\nc2V0Q2xpZW50SUQoZ2V0TmFtZSgpICsgInRlc3QtY2xpZW50LWlkLTIiKTsK\nICAgICAgICBjb25uZWN0aW9ucy5hZGQoY29ubmVjdGlvbik7CgogICAgICAg\nIC8vIFBpY2t1cCB0aGUgcmVtYWluaW5nIG1lc3NhZ2VzLgogICAgICAgIGZp\nbmFsIENvdW50RG93bkxhdGNoIGRvbmUyID0gbmV3IENvdW50RG93bkxhdGNo\nKDEpOwogICAgICAgIHNlc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0ZVNlc3Np\nb24oZmFsc2UsIGFja01vZGUpOwogICAgICAgIGNvbnN1bWVyID0gc2Vzc2lv\nbi5jcmVhdGVEdXJhYmxlU3Vic2NyaWJlcigoVG9waWMpIGRlc3RpbmF0aW9u\nLCAic3Vic2NyaWJlci1pZDIiKTsKICAgICAgICBjb25zdW1lci5zZXRNZXNz\nYWdlTGlzdGVuZXIobmV3IE1lc3NhZ2VMaXN0ZW5lcigpIHsKICAgICAgICAg\nICAgcHVibGljIHZvaWQgb25NZXNzYWdlKE1lc3NhZ2UgbSkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBUZXh0TWVzc2Fn\nZSB0bSA9IChUZXh0TWVzc2FnZSltOwogICAgICAgICAgICAgICAgICAgIExP\nRy5pbmZvKCJHb3QgaW4gc2Vjb25kIGxpc3RlbmVyOiAiICsgdG0uZ2V0VGV4\ndCgpKTsKICAgICAgICAgICAgICAgICAgICBjb3VudGVyLmluY3JlbWVudEFu\nZEdldCgpOwogICAgICAgICAgICAgICAgICAgIG0uYWNrbm93bGVkZ2UoKTsK\nICAgICAgICAgICAgICAgICAgICByZWNlaXZlZE1lc3NhZ2VzLmFkZChtKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoY291bnRlci5nZXQoKSA9PSA0KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmUyLmNvdW50RG93bigpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKFRocm93YWJsZSBlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJ1bmV4cGVjdGVkIGV4IG9uTWVzc2FnZTogIiwgZSk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgY29u\nbmVjdGlvbi5zdGFydCgpOwoKICAgICAgICBhc3NlcnQgZG9uZTIuYXdhaXQo\nNSwgVGltZVVuaXQuU0VDT05EUykgOiAiY291bnQgOiAiICsgZG9uZTIuZ2V0\nQ291bnQoKSArICIsIGNvdW50ZXIgOiAiICsgY291bnRlci5nZXQoKTsKICAg\nICAgICBUaHJlYWQuc2xlZXAoMjAwKTsKCiAgICAgICAgLy8gY2xvc2UgZnJv\nbSBvbk1lc3NhZ2Ugd2l0aCBBdXRvX2FjayB3aWxsIGFjawogICAgICAgIC8v\nIE1ha2Ugc3VyZSBvbmx5IDQgbWVzc2FnZXMgd2VyZSBkZWxpdmVyZWQuCiAg\nICAgICAgYXNzZXJ0IDQgPT0gY291bnRlci5nZXQoKSA6CiAgICAgICAgImNv\ndW50ZXIgOiAiICsgY291bnRlci5nZXQoKSArICIsIGdvdDJEb25lIDogIiAr\nIGdvdDJEb25lLmdldENvdW50KCkgKyAiLCBzZW5kRG9uZSA6ICIKICAgICAg\nICAgICAgKyBzZW5kRG9uZS5nZXRDb3VudCgpICsgIiwgbWVzc2FnZXMgOiAi\nICsgcmVjZWl2ZWRNZXNzYWdlczsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBp\nbml0Q29tYm9zRm9yVGVzdE1lc3NhZ2VMaXN0ZW5lcldpdGhDb25zdW1lcldp\ndGhQcmVmZXRjaDEoKSB7CiAgICAgICAgYWRkQ29tYmluYXRpb25WYWx1ZXMo\nImRlbGl2ZXJ5TW9kZSIsIG5ldyBPYmplY3RbXSB7CiAgICAgICAgICAgICAg\nICBJbnRlZ2VyLnZhbHVlT2YoRGVsaXZlcnlNb2RlLk5PTl9QRVJTSVNURU5U\nKSwgSW50ZWdlci52YWx1ZU9mKERlbGl2ZXJ5TW9kZS5QRVJTSVNURU5UKX0p\nOwogICAgICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCJkZXN0aW5hdGlvblR5\ncGUiLCBuZXcgT2JqZWN0W10ge01lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVz\ndGluYXRpb25UeXBlLlRPUElDfSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndGVzdE1lc3NhZ2VMaXN0ZW5lcldpdGhDb25zdW1lcldpdGhQcmVmZXRjaDEo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKCiAgICAgICAgZmluYWwgQXRvbWljSW50\nZWdlciBjb3VudGVyID0gbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAg\nZmluYWwgQ291bnREb3duTGF0Y2ggZG9uZSA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKCiAgICAgICAgLy8gUmVjZWl2ZSBhIG1lc3NhZ2Ugd2l0aCB0aGUg\nSk1TIEFQSQogICAgICAgIGNvbm5lY3Rpb24uc3RhcnQoKTsKCiAgICAgICAg\nU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKGZh\nbHNlLCBTZXNzaW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAgIGRlc3Rp\nbmF0aW9uID0gY3JlYXRlRGVzdGluYXRpb24oc2Vzc2lvbiwgZGVzdGluYXRp\nb25UeXBlKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBz\nZXNzaW9uLmNyZWF0ZUNvbnN1bWVyKGRlc3RpbmF0aW9uKTsKICAgICAgICBj\nb25zdW1lci5zZXRNZXNzYWdlTGlzdGVuZXIobmV3IE1lc3NhZ2VMaXN0ZW5l\ncigpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgb25NZXNzYWdlKE1lc3Nh\nZ2UgbSkgewogICAgICAgICAgICAgICAgY291bnRlci5pbmNyZW1lbnRBbmRH\nZXQoKTsKICAgICAgICAgICAgICAgIGlmIChjb3VudGVyLmdldCgpID09IDQp\nIHsKICAgICAgICAgICAgICAgICAgICBkb25lLmNvdW50RG93bigpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAg\nICAgIC8vIFNlbmQgdGhlIG1lc3NhZ2VzCiAgICAgICAgc2VuZE1lc3NhZ2Vz\nKHNlc3Npb24sIGRlc3RpbmF0aW9uLCA0KTsKCiAgICAgICAgYXNzZXJ0VHJ1\nZShkb25lLmF3YWl0KDEwMDAsIFRpbWVVbml0Lk1JTExJU0VDT05EUykpOwog\nICAgICAgIFRocmVhZC5zbGVlcCgyMDApOwoKICAgICAgICAvLyBNYWtlIHN1\ncmUgb25seSA0IG1lc3NhZ2VzIHdlcmUgZGVsaXZlcmVkLgogICAgICAgIGFz\nc2VydEVxdWFscyg0LCBjb3VudGVyLmdldCgpKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBpbml0Q29tYm9zRm9yVGVzdE1lc3NhZ2VMaXN0ZW5lcldpdGhD\nb25zdW1lcigpIHsKICAgICAgICBhZGRDb21iaW5hdGlvblZhbHVlcygiZGVs\naXZlcnlNb2RlIiwgbmV3IE9iamVjdFtdIHsKICAgICAgICAgICAgICAgIElu\ndGVnZXIudmFsdWVPZihEZWxpdmVyeU1vZGUuTk9OX1BFUlNJU1RFTlQpLCBJ\nbnRlZ2VyLnZhbHVlT2YoRGVsaXZlcnlNb2RlLlBFUlNJU1RFTlQpfSk7CiAg\nICAgICAgYWRkQ29tYmluYXRpb25WYWx1ZXMoImRlc3RpbmF0aW9uVHlwZSIs\nIG5ldyBPYmplY3RbXSB7TWVzc2FnaW5nU2Vzc2lvbkZhY2FkZS5EZXN0aW5h\ndGlvblR5cGUuVE9QSUN9KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nTWVzc2FnZUxpc3RlbmVyV2l0aENvbnN1bWVyKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CgogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgY291bnRlciA9IG5l\ndyBBdG9taWNJbnRlZ2VyKDApOwogICAgICAgIGZpbmFsIENvdW50RG93bkxh\ndGNoIGRvbmUgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAgICAgIC8v\nIFJlY2VpdmUgYSBtZXNzYWdlIHdpdGggdGhlIEpNUyBBUEkKICAgICAgICBj\nb25uZWN0aW9uLnN0YXJ0KCk7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0g\nY29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9f\nQUNLTk9XTEVER0UpOwogICAgICAgIGRlc3RpbmF0aW9uID0gY3JlYXRlRGVz\ndGluYXRpb24oc2Vzc2lvbiwgZGVzdGluYXRpb25UeXBlKTsKICAgICAgICBN\nZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1\nbWVyKGRlc3RpbmF0aW9uKTsKICAgICAgICBjb25zdW1lci5zZXRNZXNzYWdl\nTGlzdGVuZXIobmV3IE1lc3NhZ2VMaXN0ZW5lcigpIHsKICAgICAgICAgICAg\ncHVibGljIHZvaWQgb25NZXNzYWdlKE1lc3NhZ2UgbSkgewogICAgICAgICAg\nICAgICAgY291bnRlci5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAg\nICAgIGlmIChjb3VudGVyLmdldCgpID09IDQpIHsKICAgICAgICAgICAgICAg\nICAgICBkb25lLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIC8vIFNlbmQgdGhlIG1l\nc3NhZ2VzCiAgICAgICAgc2VuZE1lc3NhZ2VzKHNlc3Npb24sIGRlc3RpbmF0\naW9uLCA0KTsKCiAgICAgICAgYXNzZXJ0VHJ1ZShkb25lLmF3YWl0KDEwMDAs\nIFRpbWVVbml0Lk1JTExJU0VDT05EUykpOwogICAgICAgIFRocmVhZC5zbGVl\ncCgyMDApOwoKICAgICAgICAvLyBNYWtlIHN1cmUgb25seSA0IG1lc3NhZ2Vz\nIHdlcmUgZGVsaXZlcmVkLgogICAgICAgIGFzc2VydEVxdWFscyg0LCBjb3Vu\ndGVyLmdldCgpKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbml0Q29tYm9z\nRm9yVGVzdFVuYWNrZWRXaXRoUHJlZmV0Y2gxU3RheUluUXVldWUoKSB7CiAg\nICAgICAgYWRkQ29tYmluYXRpb25WYWx1ZXMoImRlbGl2ZXJ5TW9kZSIsIG5l\ndyBPYmplY3RbXSB7CiAgICAgICAgICAgICAgICBJbnRlZ2VyLnZhbHVlT2Yo\nRGVsaXZlcnlNb2RlLk5PTl9QRVJTSVNURU5UKSwgSW50ZWdlci52YWx1ZU9m\nKERlbGl2ZXJ5TW9kZS5QRVJTSVNURU5UKX0pOwogICAgICAgIGFkZENvbWJp\nbmF0aW9uVmFsdWVzKCJhY2tNb2RlIiwgbmV3IE9iamVjdFtdIHsKICAgICAg\nICAgICAgICAgIEludGVnZXIudmFsdWVPZihTZXNzaW9uLkFVVE9fQUNLTk9X\nTEVER0UpLCBJbnRlZ2VyLnZhbHVlT2YoU2Vzc2lvbi5EVVBTX09LX0FDS05P\nV0xFREdFKSwKICAgICAgICAgICAgICAgIEludGVnZXIudmFsdWVPZihTZXNz\naW9uLkNMSUVOVF9BQ0tOT1dMRURHRSl9KTsKICAgICAgICBhZGRDb21iaW5h\ndGlvblZhbHVlcygiZGVzdGluYXRpb25UeXBlIiwgbmV3IE9iamVjdFtdIHtN\nZXNzYWdpbmdTZXNzaW9uRmFjYWRlLkRlc3RpbmF0aW9uVHlwZS5UT1BJQ30p\nOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RVbmFja2VkV2l0aFByZWZl\ndGNoMVN0YXlJblF1ZXVlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CgogICAgICAg\nIC8vIFNldCBwcmVmZXRjaCB0byAxCiAgICAgICAgaWYgKG51bGwgPT0gY29u\nbmVjdGlvbi5nZXRDbGllbnRJRCgpKSBjb25uZWN0aW9uLnNldENsaWVudElE\nKGdldE5hbWUoKSArICJ0ZXN0LWNsaWVudC1pZC0zIik7CiAgICAgICAgY29u\nbmVjdGlvbi5zdGFydCgpOwoKICAgICAgICAvLyBVc2UgYWxsIHRoZSBhY2sg\nbW9kZXMKICAgICAgICBTZXNzaW9uIHNlc3Npb24gPSBjb25uZWN0aW9uLmNy\nZWF0ZVNlc3Npb24oZmFsc2UsIGFja01vZGUpOwogICAgICAgIGRlc3RpbmF0\naW9uID0gY3JlYXRlRGVzdGluYXRpb24oc2Vzc2lvbiwgZGVzdGluYXRpb25U\neXBlKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBzZXNz\naW9uLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKChUb3BpYykgZGVzdGluYXRp\nb24sICJzdWJzY3JpYmVyLWlkMyIpOwoKICAgICAgICAvLyBTZW5kIHRoZSBt\nZXNzYWdlcwogICAgICAgIHNlbmRNZXNzYWdlcyhzZXNzaW9uLCBkZXN0aW5h\ndGlvbiwgNCk7CgogICAgICAgIC8vIE9ubHkgcGljayB1cCB0aGUgZmlyc3Qg\nMiBtZXNzYWdlcy4KICAgICAgICBNZXNzYWdlIG1lc3NhZ2UgPSBudWxsOwog\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAg\nICAgIG1lc3NhZ2UgPSBjb25zdW1lci5yZWNlaXZlKDEwMDApOwogICAgICAg\nICAgICBhc3NlcnROb3ROdWxsKG1lc3NhZ2UpOwogICAgICAgICAgICBhc3Nl\ncnQgKG1lc3NhZ2UgaW5zdGFuY2VvZiBUZXh0TWVzc2FnZSk7CiAgICAgICAg\nICAgIGFzc2VydCAoKChUZXh0TWVzc2FnZSkgbWVzc2FnZSkuZ2V0VGV4dCgp\nLmVxdWFscyhtZXNzYWdlVGV4dFByZWZpeCAgKyBpKSkKICAgICAgICAgICAg\nICAgIDogIlJlY2VpdmVkIG1lc3NhZ2UgIiArICgoVGV4dE1lc3NhZ2UpIG1l\nc3NhZ2UpLmdldFRleHQoKSArICIgLi4gaSA9ICIgKyBpOwogICAgICAgIH0K\nICAgICAgICBhc3NlcnQgbnVsbCAhPSBtZXNzYWdlOwogICAgICAgIG1lc3Nh\nZ2UuYWNrbm93bGVkZ2UoKTsKCiAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgp\nOwogICAgICAgIGNvbm5lY3Rpb24gPSAoSGVkd2lnQ29ubmVjdGlvbkltcGwp\nZmFjdG9yeS5jcmVhdGVDb25uZWN0aW9uKCk7CiAgICAgICAgaWYgKG51bGwg\nPT0gY29ubmVjdGlvbi5nZXRDbGllbnRJRCgpKSBjb25uZWN0aW9uLnNldENs\naWVudElEKGdldE5hbWUoKSArICJ0ZXN0LWNsaWVudC1pZC0zIik7CiAgICAg\nICAgLy8gVXNlIGFsbCB0aGUgYWNrIG1vZGVzCiAgICAgICAgc2Vzc2lvbiA9\nIGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lvbihmYWxzZSwgYWNrTW9kZSk7CiAg\nICAgICAgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUR1cmFibGVTdWJzY3Jp\nYmVyKChUb3BpYykgZGVzdGluYXRpb24sICJzdWJzY3JpYmVyLWlkMyIpOwog\nICAgICAgIGNvbm5lY3Rpb25zLmFkZChjb25uZWN0aW9uKTsKICAgICAgICBj\nb25uZWN0aW9uLnN0YXJ0KCk7CgogICAgICAgIC8vIFBpY2t1cCB0aGUgcmVz\ndCBvZiB0aGUgbWVzc2FnZXMuCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCAyOyBpKyspIHsKICAgICAgICAgICAgbWVzc2FnZSA9IGNvbnN1bWVyLnJl\nY2VpdmUoMTAwMCk7CiAgICAgICAgICAgIGFzc2VydE5vdE51bGwobWVzc2Fn\nZSk7CiAgICAgICAgICAgIGFzc2VydCAobWVzc2FnZSBpbnN0YW5jZW9mIFRl\neHRNZXNzYWdlKTsKICAgICAgICAgICAgYXNzZXJ0ICgoKFRleHRNZXNzYWdl\nKSBtZXNzYWdlKS5nZXRUZXh0KCkuZXF1YWxzKG1lc3NhZ2VUZXh0UHJlZml4\nICArIChpICsgMikpKSA6CiAgICAgICAgICAgICJSZWNlaXZlZCBtZXNzYWdl\nICIgKyAoKFRleHRNZXNzYWdlKSBtZXNzYWdlKS5nZXRUZXh0KCkgKyAiIC4u\nIGkgPSAiICsgaTsKICAgICAgICB9CiAgICAgICAgbWVzc2FnZS5hY2tub3ds\nZWRnZSgpOwogICAgICAgIC8vIGFzc2VydE51bGwoY29uc3VtZXIucmVjZWl2\nZU5vV2FpdCgpKTsKICAgICAgICB7CiAgICAgICAgICAgIE1lc3NhZ2UgbXNn\nID0gY29uc3VtZXIucmVjZWl2ZU5vV2FpdCgpOwogICAgICAgICAgICBhc3Nl\ncnQgbnVsbCA9PSBtc2cgOiAiVW5leHBlY3RlZCBtZXNzYWdlICIgKyBtc2c7\nCiAgICAgICAgfQoKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBpbml0Q29tYm9z\nRm9yVGVzdFByZWZldGNoMU1lc3NhZ2VOb3REaXNwYXRjaGVkKCkgewogICAg\nICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCJkZWxpdmVyeU1vZGUiLCBuZXcg\nT2JqZWN0W10gewogICAgICAgICAgICAgICAgSW50ZWdlci52YWx1ZU9mKERl\nbGl2ZXJ5TW9kZS5OT05fUEVSU0lTVEVOVCksIEludGVnZXIudmFsdWVPZihE\nZWxpdmVyeU1vZGUuUEVSU0lTVEVOVCl9KTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0UHJlZmV0Y2gxTWVzc2FnZU5vdERpc3BhdGNoZWQoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKCiAgICAgICAgLy8gU2V0IHByZWZldGNoIHRvIDEK\nICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CgogICAgICAgIFNlc3Npb24g\nc2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lvbih0cnVlLCAwKTsK\nICAgICAgICBkZXN0aW5hdGlvbiA9IFNlc3Npb25JbXBsLmFzVG9waWMoIlRF\nU1QiKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBzZXNz\naW9uLmNyZWF0ZUNvbnN1bWVyKGRlc3RpbmF0aW9uKTsKCiAgICAgICAgLy8g\nVGhlIHByZWZldGNoIHNob3VsZCBmaWxsIHVwIHdpdGggMSBtZXNzYWdlLgog\nICAgICAgIC8vIFNpbmNlIHByZWZldGNoIGlzIHN0aWxsIGZ1bGwsIHRoZSAy\nbmQgbWVzc2FnZSBzaG91bGQgZ2V0IGRpc3BhdGNoZWQKICAgICAgICAvLyB0\nbyBhbm90aGVyIGNvbnN1bWVyLi4gbGV0cyBjcmVhdGUgdGhlIDJuZCBjb25z\ndW1lciB0ZXN0IHRoYXQgaXQgZG9lcwogICAgICAgIC8vIG1ha2Ugc3VyZSBp\ndCBkb2VzLgogICAgICAgIEhlZHdpZ0Nvbm5lY3Rpb25JbXBsIGNvbm5lY3Rp\nb24yID0gKEhlZHdpZ0Nvbm5lY3Rpb25JbXBsKWZhY3RvcnkuY3JlYXRlQ29u\nbmVjdGlvbigpOwogICAgICAgIGNvbm5lY3Rpb24yLnN0YXJ0KCk7CiAgICAg\nICAgY29ubmVjdGlvbnMuYWRkKGNvbm5lY3Rpb24yKTsKICAgICAgICBTZXNz\naW9uIHNlc3Npb24yID0gY29ubmVjdGlvbjIuY3JlYXRlU2Vzc2lvbih0cnVl\nLCAwKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIyID0gc2Vz\nc2lvbjIuY3JlYXRlQ29uc3VtZXIoZGVzdGluYXRpb24pOwoKICAgICAgICAv\nLyBTZW5kIDIgbWVzc2FnZXMgdG8gdGhlIGRlc3RpbmF0aW9uLgogICAgICAg\nIHNlbmRNZXNzYWdlcyhzZXNzaW9uLCBkZXN0aW5hdGlvbiwgMik7CiAgICAg\nICAgc2Vzc2lvbi5jb21taXQoKTsKCiAgICAgICAgLy8gUGljayB1cCB0aGUg\nZmlyc3QgbWVzc2FnZS4KICAgICAgICBNZXNzYWdlIG1lc3NhZ2UxID0gY29u\nc3VtZXIucmVjZWl2ZSgxMDAwKTsKICAgICAgICBhc3NlcnROb3ROdWxsKG1l\nc3NhZ2UxKTsKICAgICAgICBhc3NlcnROb3ROdWxsKGNvbnN1bWVyLnJlY2Vp\ndmUoMTAwMCkpOwoKICAgICAgICAvLyBQaWNrIHVwIHRoZSAybmQgbWVzc2Fn\nZXMuCiAgICAgICAgTWVzc2FnZSBtZXNzYWdlMiA9IGNvbnN1bWVyMi5yZWNl\naXZlKDUwMDApOwogICAgICAgIGFzc2VydE5vdE51bGwobWVzc2FnZTIpOwog\nICAgICAgIGFzc2VydE5vdE51bGwoY29uc3VtZXIyLnJlY2VpdmUoMTAwMCkp\nOwoKICAgICAgICBzZXNzaW9uLmNvbW1pdCgpOwogICAgICAgIHNlc3Npb24y\nLmNvbW1pdCgpOwoKICAgICAgICBhc3NlcnROdWxsKGNvbnN1bWVyLnJlY2Vp\ndmVOb1dhaXQoKSk7CgogICAgfQoKICAgIHB1YmxpYyB2b2lkIGluaXRDb21i\nb3NGb3JUZXN0RG9udFN0YXJ0KCkgewogICAgICAgIGFkZENvbWJpbmF0aW9u\nVmFsdWVzKCJkZWxpdmVyeU1vZGUiLCBuZXcgT2JqZWN0W10ge0ludGVnZXIu\ndmFsdWVPZihEZWxpdmVyeU1vZGUuTk9OX1BFUlNJU1RFTlQpfSk7CiAgICAg\nICAgYWRkQ29tYmluYXRpb25WYWx1ZXMoImRlc3RpbmF0aW9uVHlwZSIsIG5l\ndyBPYmplY3RbXSB7IE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRp\nb25UeXBlLlRPUElDfSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdERv\nbnRTdGFydCgpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBTZXNzaW9u\nIHNlc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24oZmFsc2UsIFNl\nc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAgICAgZGVzdGluYXRpb24g\nPSBjcmVhdGVEZXN0aW5hdGlvbihzZXNzaW9uLCBkZXN0aW5hdGlvblR5cGUp\nOwogICAgICAgIE1lc3NhZ2VDb25zdW1lciBjb25zdW1lciA9IHNlc3Npb24u\nY3JlYXRlQ29uc3VtZXIoZGVzdGluYXRpb24pOwoKICAgICAgICAvLyBTZW5k\nIHRoZSBtZXNzYWdlcwogICAgICAgIHNlbmRNZXNzYWdlcyhzZXNzaW9uLCBk\nZXN0aW5hdGlvbiwgMSk7CgogICAgICAgIC8vIE1ha2Ugc3VyZSBubyBtZXNz\nYWdlcyB3ZXJlIGRlbGl2ZXJlZC4KICAgICAgICBhc3NlcnROdWxsKGNvbnN1\nbWVyLnJlY2VpdmUoMTAwMCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGlu\naXRDb21ib3NGb3JUZXN0U3RhcnRBZnRlclNlbmQoKSB7CiAgICAgICAgYWRk\nQ29tYmluYXRpb25WYWx1ZXMoImRlbGl2ZXJ5TW9kZSIsIG5ldyBPYmplY3Rb\nXSB7SW50ZWdlci52YWx1ZU9mKERlbGl2ZXJ5TW9kZS5OT05fUEVSU0lTVEVO\nVCl9KTsKICAgICAgICBhZGRDb21iaW5hdGlvblZhbHVlcygiZGVzdGluYXRp\nb25UeXBlIiwgbmV3IE9iamVjdFtdIHtNZXNzYWdpbmdTZXNzaW9uRmFjYWRl\nLkRlc3RpbmF0aW9uVHlwZS5UT1BJQ30pOwogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIHRlc3RTdGFydEFmdGVyU2VuZCgpIHRocm93cyBFeGNlcHRpb24gewoK\nICAgICAgICBTZXNzaW9uIHNlc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0ZVNl\nc3Npb24oZmFsc2UsIFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAg\nICAgZGVzdGluYXRpb24gPSBjcmVhdGVEZXN0aW5hdGlvbihzZXNzaW9uLCBk\nZXN0aW5hdGlvblR5cGUpOwogICAgICAgIE1lc3NhZ2VDb25zdW1lciBjb25z\ndW1lciA9IHNlc3Npb24uY3JlYXRlQ29uc3VtZXIoZGVzdGluYXRpb24pOwoK\nICAgICAgICAvLyBTZW5kIHRoZSBtZXNzYWdlcwogICAgICAgIHNlbmRNZXNz\nYWdlcyhzZXNzaW9uLCBkZXN0aW5hdGlvbiwgMSk7CgogICAgICAgIC8vIFN0\nYXJ0IHRoZSBjb25uY2VjdGlvbiBhZnRlciB0aGUgbWVzc2FnZSB3YXMgc2Vu\ndC4KICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CgogICAgICAgIC8vIE1h\na2Ugc3VyZSBvbmx5IDEgbWVzc2FnZSB3YXMgZGVsaXZlcmVkLgogICAgICAg\nIGFzc2VydE5vdE51bGwoY29uc3VtZXIucmVjZWl2ZSgxMDAwKSk7CiAgICAg\nICAgYXNzZXJ0TnVsbChjb25zdW1lci5yZWNlaXZlTm9XYWl0KCkpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGluaXRDb21ib3NGb3JUZXN0UmVjZWl2ZU1l\nc3NhZ2VXaXRoQ29uc3VtZXIoKSB7CiAgICAgICAgYWRkQ29tYmluYXRpb25W\nYWx1ZXMoImRlbGl2ZXJ5TW9kZSIsIG5ldyBPYmplY3RbXSB7CiAgICAgICAg\nICAgICAgICBJbnRlZ2VyLnZhbHVlT2YoRGVsaXZlcnlNb2RlLk5PTl9QRVJT\nSVNURU5UKSwgSW50ZWdlci52YWx1ZU9mKERlbGl2ZXJ5TW9kZS5QRVJTSVNU\nRU5UKX0pOwogICAgICAgIGFkZENvbWJpbmF0aW9uVmFsdWVzKCJkZXN0aW5h\ndGlvblR5cGUiLCBuZXcgT2JqZWN0W10ge01lc3NhZ2luZ1Nlc3Npb25GYWNh\nZGUuRGVzdGluYXRpb25UeXBlLlRPUElDfSk7CiAgICB9CgogICAgcHVibGlj\nIHZvaWQgdGVzdFJlY2VpdmVNZXNzYWdlV2l0aENvbnN1bWVyKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CgogICAgICAgIC8vIFJlY2VpdmUgYSBtZXNzYWdlIHdp\ndGggdGhlIEpNUyBBUEkKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CiAg\nICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNz\naW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAg\nIGRlc3RpbmF0aW9uID0gY3JlYXRlRGVzdGluYXRpb24oc2Vzc2lvbiwgZGVz\ndGluYXRpb25UeXBlKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3Vt\nZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1bWVyKGRlc3RpbmF0aW9uKTsKCiAg\nICAgICAgLy8gU2VuZCB0aGUgbWVzc2FnZXMKICAgICAgICBzZW5kTWVzc2Fn\nZXMoc2Vzc2lvbiwgZGVzdGluYXRpb24sIDEpOwoKICAgICAgICAvLyBNYWtl\nIHN1cmUgb25seSAxIG1lc3NhZ2Ugd2FzIGRlbGl2ZXJlZC4KICAgICAgICBN\nZXNzYWdlIG0gPSBjb25zdW1lci5yZWNlaXZlKDEwMDApOwogICAgICAgIGFz\nc2VydE5vdE51bGwobSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCIwIiwgKChU\nZXh0TWVzc2FnZSltKS5nZXRUZXh0KCkpOwogICAgICAgIGFzc2VydE51bGwo\nY29uc3VtZXIucmVjZWl2ZU5vV2FpdCgpKTsKICAgIH0KCgogICAgcHVibGlj\nIHZvaWQgdGVzdER1cHNPa0NvbnN1bWVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCgogICAgICAgIC8vIFJlY2VpdmUgYSBtZXNzYWdlIHdpdGggdGhlIEpNUyBB\nUEkKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CiAgICAgICAgU2Vzc2lv\nbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBT\nZXNzaW9uLkRVUFNfT0tfQUNLTk9XTEVER0UpOwogICAgICAgIGRlc3RpbmF0\naW9uID0gY3JlYXRlRGVzdGluYXRpb24oc2Vzc2lvbiwgTWVzc2FnaW5nU2Vz\nc2lvbkZhY2FkZS5EZXN0aW5hdGlvblR5cGUuVE9QSUMpOwogICAgICAgIE1l\nc3NhZ2VDb25zdW1lciBjb25zdW1lciA9IHNlc3Npb24uY3JlYXRlRHVyYWJs\nZVN1YnNjcmliZXIoKFRvcGljKSBkZXN0aW5hdGlvbiwgInN1YnNjcmliZXIt\naWQ0Iik7CgogICAgICAgIC8vIFNlbmQgdGhlIG1lc3NhZ2VzCiAgICAgICAg\nc2VuZE1lc3NhZ2VzKHNlc3Npb24sIGRlc3RpbmF0aW9uLCA0KTsKCiAgICAg\nICAgLy8gTWFrZSBzdXJlIG9ubHkgNCBtZXNzYWdlIGFyZSBkZWxpdmVyZWQu\nCiAgICAgICAgZm9yKCBpbnQgaT0wOyBpIDwgNDsgaSsrKXsKICAgICAgICAg\nICAgTWVzc2FnZSBtID0gY29uc3VtZXIucmVjZWl2ZSgxMDAwKTsKICAgICAg\nICAgICAgYXNzZXJ0Tm90TnVsbChtKTsKICAgICAgICB9CiAgICAgICAgYXNz\nZXJ0TnVsbChjb25zdW1lci5yZWNlaXZlKDEwMDApKTsKCiAgICAgICAgLy8g\nQ2xvc2Ugb3V0IHRoZSBjb25zdW1lci4uIG5vIG90aGVyIG1lc3NhZ2VzIHNo\nb3VsZCBiZSBsZWZ0IG9uIHRoZSBxdWV1ZS4KICAgICAgICBjb25zdW1lci5j\nbG9zZSgpOwoKICAgICAgICBjb25zdW1lciA9IHNlc3Npb24uY3JlYXRlRHVy\nYWJsZVN1YnNjcmliZXIoKFRvcGljKSBkZXN0aW5hdGlvbiwgInN1YnNjcmli\nZXItaWQ0Iik7CiAgICAgICAgYXNzZXJ0TnVsbChjb25zdW1lci5yZWNlaXZl\nKDEwMDApKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVkaXNwYXRj\naE9mVW5jb21taXR0ZWRUeCgpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAg\nICBjb25uZWN0aW9uLnN0YXJ0KCk7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9u\nID0gY29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKHRydWUsIFNlc3Npb24uU0VT\nU0lPTl9UUkFOU0FDVEVEKTsKICAgICAgICBkZXN0aW5hdGlvbiA9IGNyZWF0\nZURlc3RpbmF0aW9uKHNlc3Npb24sIE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUu\nRGVzdGluYXRpb25UeXBlLlRPUElDKTsKICAgICAgICBNZXNzYWdlQ29uc3Vt\nZXIgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVy\nKChUb3BpYykgZGVzdGluYXRpb24sICJzdWJzY3JpYmVyLWlkMiIpOwoKICAg\nICAgICBzZW5kTWVzc2FnZXMoY29ubmVjdGlvbiwgZGVzdGluYXRpb24sIDIp\nOwoKICAgICAgICBhc3NlcnROb3ROdWxsKGNvbnN1bWVyLnJlY2VpdmUoMTAw\nMCkpOwogICAgICAgIGFzc2VydE5vdE51bGwoY29uc3VtZXIucmVjZWl2ZSgx\nMDAwKSk7CgogICAgICAgIC8vIGluc3RhbGwgYW5vdGhlciBjb25zdW1lciB3\naGlsZSBtZXNzYWdlIGRpc3BhdGNoIGlzIHVuYWNrZWQvdW5jb21taXR0ZWQK\nCiAgICAgICAgLy8gbm8gY29tbWl0IHNvIHdpbGwgYXV0byByb2xsYmFjayBh\nbmQgZ2V0IHJlLWRpc3BhdGNoZWQgdG8gcmVkaXNwdGFjaENvbnN1bWVyCiAg\nICAgICAgc2Vzc2lvbi5jbG9zZSgpOwoKICAgICAgICBTZXNzaW9uIHJlZGlz\ncGF0Y2hTZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKHRydWUs\nIFNlc3Npb24uU0VTU0lPTl9UUkFOU0FDVEVEKTsKICAgICAgICBNZXNzYWdl\nQ29uc3VtZXIgcmVkaXNwYXRjaENvbnN1bWVyCiAgICAgICAgICAgID0gcmVk\naXNwYXRjaFNlc3Npb24uY3JlYXRlRHVyYWJsZVN1YnNjcmliZXIoKFRvcGlj\nKSBkZXN0aW5hdGlvbiwgInN1YnNjcmliZXItaWQyIik7CgogICAgICAgIE1l\nc3NhZ2UgbXNnID0gcmVkaXNwYXRjaENvbnN1bWVyLnJlY2VpdmUoMTAwMCk7\nCiAgICAgICAgYXNzZXJ0Tm90TnVsbChtc2cpOwogICAgICAgIC8vIGFzc2Vy\ndFRydWUoInJlZGVsaXZlcmVkIGZsYWcgc2V0IiwgbXNnLmdldEpNU1JlZGVs\naXZlcmVkKCkpOwoKICAgICAgICBtc2cgPSByZWRpc3BhdGNoQ29uc3VtZXIu\ncmVjZWl2ZSgxMDAwKTsKICAgICAgICBhc3NlcnROb3ROdWxsKG1zZyk7CiAg\nICAgICAgLy8gYXNzZXJ0VHJ1ZShtc2cuZ2V0Sk1TUmVkZWxpdmVyZWQoKSk7\nCiAgICAgICAgcmVkaXNwYXRjaFNlc3Npb24uY29tbWl0KCk7CgogICAgICAg\nIGFzc2VydE51bGwocmVkaXNwYXRjaENvbnN1bWVyLnJlY2VpdmUoNTAwKSk7\nCiAgICAgICAgcmVkaXNwYXRjaFNlc3Npb24uY2xvc2UoKTsKICAgIH0KCgog\nICAgcHVibGljIHZvaWQgdGVzdFJlZGlzcGF0Y2hPZlJvbGxlZGJhY2tUeCgp\nIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0\nKCk7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVh\ndGVTZXNzaW9uKHRydWUsIFNlc3Npb24uU0VTU0lPTl9UUkFOU0FDVEVEKTsK\nICAgICAgICBkZXN0aW5hdGlvbiA9IGNyZWF0ZURlc3RpbmF0aW9uKHNlc3Np\nb24sIE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUuRGVzdGluYXRpb25UeXBlLlRP\nUElDKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBzZXNz\naW9uLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKChUb3BpYykgZGVzdGluYXRp\nb24sICJzdWJzY3JpYmVyLWlkMSIpOwoKICAgICAgICBzZW5kTWVzc2FnZXMo\nY29ubmVjdGlvbiwgZGVzdGluYXRpb24sIDIpOwoKICAgICAgICBhc3NlcnRO\nb3ROdWxsKGNvbnN1bWVyLnJlY2VpdmUoMTAwMCkpOwogICAgICAgIGFzc2Vy\ndE5vdE51bGwoY29uc3VtZXIucmVjZWl2ZSgxMDAwKSk7CgogICAgICAgIC8v\nIGluc3RhbGwgYW5vdGhlciBjb25zdW1lciB3aGlsZSBtZXNzYWdlIGRpc3Bh\ndGNoIGlzIHVuYWNrZWQvdW5jb21taXR0ZWQKCiAgICAgICAgc2Vzc2lvbi5y\nb2xsYmFjaygpOwogICAgICAgIHNlc3Npb24uY2xvc2UoKTsKCiAgICAgICAg\nU2Vzc2lvbiByZWRpc3BhdGNoU2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRl\nU2Vzc2lvbih0cnVlLCBTZXNzaW9uLlNFU1NJT05fVFJBTlNBQ1RFRCk7CiAg\nICAgICAgTWVzc2FnZUNvbnN1bWVyIHJlZGlzcGF0Y2hDb25zdW1lcgogICAg\nICAgICAgICA9IHJlZGlzcGF0Y2hTZXNzaW9uLmNyZWF0ZUR1cmFibGVTdWJz\nY3JpYmVyKChUb3BpYykgZGVzdGluYXRpb24sICJzdWJzY3JpYmVyLWlkMSIp\nOwoKICAgICAgICBNZXNzYWdlIG1zZyA9IHJlZGlzcGF0Y2hDb25zdW1lci5y\nZWNlaXZlKDEwMDApOwogICAgICAgIGFzc2VydE5vdE51bGwobXNnKTsKICAg\nICAgICAvLyBhc3NlcnRUcnVlKG1zZy5nZXRKTVNSZWRlbGl2ZXJlZCgpKTsK\nICAgICAgICBtc2cgPSByZWRpc3BhdGNoQ29uc3VtZXIucmVjZWl2ZSgxMDAw\nKTsKICAgICAgICBhc3NlcnROb3ROdWxsKG1zZyk7CiAgICAgICAgLy8gYXNz\nZXJ0VHJ1ZShtc2cuZ2V0Sk1TUmVkZWxpdmVyZWQoKSk7CiAgICAgICAgcmVk\naXNwYXRjaFNlc3Npb24uY29tbWl0KCk7CgogICAgICAgIGFzc2VydE51bGwo\ncmVkaXNwYXRjaENvbnN1bWVyLnJlY2VpdmUoNTAwKSk7CiAgICAgICAgcmVk\naXNwYXRjaFNlc3Npb24uY2xvc2UoKTsKICAgIH0KCiAgICBwdWJsaWMgdm9p\nZCBpbml0Q29tYm9zRm9yVGVzdEFja09mRXhwaXJlZCgpIHsKICAgICAgICBh\nZGRDb21iaW5hdGlvblZhbHVlcygiZGVzdGluYXRpb25UeXBlIiwKICAgICAg\nICAgICAgICAgIG5ldyBPYmplY3RbXSB7TWVzc2FnaW5nU2Vzc2lvbkZhY2Fk\nZS5EZXN0aW5hdGlvblR5cGUuVE9QSUN9KTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0QWNrT2ZFeHBpcmVkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgSGVkd2lnQ29ubmVjdGlvbkZhY3RvcnlJbXBsIGZhY3QgPSBuZXcg\nSGVkd2lnQ29ubmVjdGlvbkZhY3RvcnlJbXBsKCk7CiAgICAgICAgY29ubmVj\ndGlvbiA9IGZhY3QuY3JlYXRlQ29ubmVjdGlvbigpOwoKICAgICAgICBjb25u\nZWN0aW9uLnN0YXJ0KCk7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29u\nbmVjdGlvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9fQUNL\nTk9XTEVER0UpOwogICAgICAgIGRlc3RpbmF0aW9uID0gKERlc3RpbmF0aW9u\nKSAoZGVzdGluYXRpb25UeXBlID09IE1lc3NhZ2luZ1Nlc3Npb25GYWNhZGUu\nRGVzdGluYXRpb25UeXBlLlFVRVVFID8KICAgICAgICAgICAgICAgIHNlc3Np\nb24uY3JlYXRlVG9waWMoInRlc3QiKSA6IHNlc3Npb24uY3JlYXRlVG9waWMo\nInRlc3QiKSk7CgogICAgICAgIE1lc3NhZ2VDb25zdW1lciBjb25zdW1lciA9\nIHNlc3Npb24uY3JlYXRlQ29uc3VtZXIoZGVzdGluYXRpb24pOwoKICAgICAg\nICBTZXNzaW9uIHNlbmRTZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNz\naW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAg\nICAgICBNZXNzYWdlUHJvZHVjZXIgcHJvZHVjZXIgPSBzZW5kU2Vzc2lvbi5j\ncmVhdGVQcm9kdWNlcihkZXN0aW5hdGlvbik7CiAgICAgICAgZmluYWwgaW50\nIGNvdW50ID0gNDsKCgogICAgICAgIC8vIHByb2R1Y2VyLnNldFRpbWVUb0xp\ndmUoMCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsr\nKSB7CiAgICAgICAgICAgIFRleHRNZXNzYWdlIG1lc3NhZ2UgPSBzZW5kU2Vz\nc2lvbi5jcmVhdGVUZXh0TWVzc2FnZSgibm8gZXhwaXJ5IiArIGkpOwogICAg\nICAgICAgICBwcm9kdWNlci5zZW5kKG1lc3NhZ2UpOwogICAgICAgIH0KCiAg\nICAgICAgTWVzc2FnZUNvbnN1bWVyIGFtcUNvbnN1bWVyID0gKE1lc3NhZ2VD\nb25zdW1lcikgY29uc3VtZXI7CgogICAgICAgIGZvcihpbnQgaT0wOyBpPGNv\ndW50OyBpKyspIHsKICAgICAgICAgICAgVGV4dE1lc3NhZ2UgbXNnID0gKFRl\neHRNZXNzYWdlKSBhbXFDb25zdW1lci5yZWNlaXZlKCk7CiAgICAgICAgICAg\nIGFzc2VydE5vdE51bGwobXNnKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgi\nbWVzc2FnZSBoYXMgXCJubyBleHBpcnlcIiB0ZXh0OiAiICsgbXNnLmdldFRl\neHQoKSwgbXNnLmdldFRleHQoKS5jb250YWlucygibm8gZXhwaXJ5IikpOwoK\nICAgICAgICAgICAgLy8gZm9yY2UgYW4gYWNrIHdoZW4gdGhlcmUgYXJlIGV4\ncGlyZWQgbWVzc2FnZXMKICAgICAgICAgICAgbXNnLmFja25vd2xlZGdlKCk7\nCiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

