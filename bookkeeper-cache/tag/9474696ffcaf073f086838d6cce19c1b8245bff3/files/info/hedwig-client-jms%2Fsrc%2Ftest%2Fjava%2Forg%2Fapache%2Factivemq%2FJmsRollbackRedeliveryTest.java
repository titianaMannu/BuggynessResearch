{"sha":"82572be43fb84719989042af5f1c975d059ffd47","node_id":"MDQ6QmxvYjE1NzU5NTY6ODI1NzJiZTQzZmI4NDcxOTk4OTA0MmFmNWYxYzk3NWQwNTlmZmQ0Nw==","size":14544,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/82572be43fb84719989042af5f1c975d059ffd47","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBhY2th\nZ2Ugb3JnLmFwYWNoZS5hY3RpdmVtcTsKCgppbXBvcnQgamF2YXguam1zLlRv\ncGljOwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFwOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0ludGVnZXI7CgppbXBvcnQgamF2\nYXguam1zLkNvbm5lY3Rpb247CmltcG9ydCBqYXZheC5qbXMuQ29ubmVjdGlv\nbkZhY3Rvcnk7CmltcG9ydCBqYXZheC5qbXMuRGVzdGluYXRpb247CmltcG9y\ndCBqYXZheC5qbXMuSk1TRXhjZXB0aW9uOwppbXBvcnQgamF2YXguam1zLk1l\nc3NhZ2VDb25zdW1lcjsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlUHJvZHVj\nZXI7CmltcG9ydCBqYXZheC5qbXMuU2Vzc2lvbjsKaW1wb3J0IGphdmF4Lmpt\ncy5UZXh0TWVzc2FnZTsKCgppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuam1z\nLlNlc3Npb25JbXBsOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuam1zLnNw\naS5IZWR3aWdDb25uZWN0aW9uRmFjdG9yeUltcGw7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7Cgpw\ndWJsaWMgY2xhc3MgSm1zUm9sbGJhY2tSZWRlbGl2ZXJ5VGVzdCBleHRlbmRz\nIEF1dG9GYWlsVGVzdFN1cHBvcnQgewogICAgcHJvdGVjdGVkIHN0YXRpYyBm\naW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSm1z\nUm9sbGJhY2tSZWRlbGl2ZXJ5VGVzdC5jbGFzcyk7CiAgICBmaW5hbCBpbnQg\nbmJNZXNzYWdlcyA9IDEwOwogICAgZmluYWwgU3RyaW5nIGRlc3RpbmF0aW9u\nTmFtZSA9ICJEZXN0aW5hdGlvbiI7CiAgICBib29sZWFuIGNvbnN1bWVyQ2xv\nc2UgPSB0cnVlOwogICAgYm9vbGVhbiByb2xsYmFjayA9IHRydWU7CgogICAg\ncHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBzZXRBdXRvRmFpbCh0cnVlKTsKICAgICAgICBzdXBlci5zZXRVcCgpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgc3VwZXIudGVhckRvd24oKTsKICAgIH0KCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0UmVkZWxpdmVyeSgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIGRvVGVzdFJlZGVsaXZlcnkoZmFsc2UpOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHRlc3RSZWRlbGl2ZXJ5V2l0aEludGVybGVhdmVkUHJv\nZHVjZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBkb1Rlc3RSZWRl\nbGl2ZXJ5KHRydWUpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRvVGVzdFJl\nZGVsaXZlcnkoYm9vbGVhbiBpbnRlcmxlYXZlUHJvZHVjZXIpIHRocm93cyBF\neGNlcHRpb24gewoKICAgICAgICBDb25uZWN0aW9uRmFjdG9yeSBjb25uZWN0\naW9uRmFjdG9yeSA9IG5ldyBIZWR3aWdDb25uZWN0aW9uRmFjdG9yeUltcGwo\nKTsKICAgICAgICBDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSBjb25uZWN0aW9u\nRmFjdG9yeS5jcmVhdGVDb25uZWN0aW9uKCk7CiAgICAgICAgU2Vzc2lvbiBz\nZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKHRydWUsIFNlc3Np\nb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAgICAgRGVzdGluYXRpb24gZGVz\ndGluYXRpb24gPSBzZXNzaW9uLmNyZWF0ZVRvcGljKGRlc3RpbmF0aW9uTmFt\nZSk7CiAgICAgICAgTWVzc2FnZUNvbnN1bWVyIGNvbnN1bWVyID0gc2Vzc2lv\nbi5jcmVhdGVDb25zdW1lcihkZXN0aW5hdGlvbik7CiAgICAgICAgY29ubmVj\ndGlvbi5zdGFydCgpOwoKICAgICAgICBpZiAoaW50ZXJsZWF2ZVByb2R1Y2Vy\nKSB7CiAgICAgICAgICAgIHBvcHVsYXRlRGVzdGluYXRpb25XaXRoSW50ZXJs\nZWF2ZWRQcm9kdWNlcihuYk1lc3NhZ2VzLCBkZXN0aW5hdGlvbk5hbWUsIGNv\nbm5lY3Rpb24pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHBvcHVs\nYXRlRGVzdGluYXRpb24obmJNZXNzYWdlcywgZGVzdGluYXRpb25OYW1lLCBj\nb25uZWN0aW9uKTsKICAgICAgICB9CiAgICAgICAgLy8gQ29uc3VtZSBtZXNz\nYWdlcyBhbmQgcm9sbGJhY2sgdHJhbnNhY3Rpb25zCiAgICAgICAgewogICAg\nICAgICAgICBBdG9taWNJbnRlZ2VyIHJlY2VpdmVkID0gbmV3IEF0b21pY0lu\ndGVnZXIoKTsKICAgICAgICAgICAgTWFwPFN0cmluZywgQm9vbGVhbj4gcm9s\nbGVkYmFjayA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxTdHJpbmcsIEJvb2xl\nYW4+KCk7CiAgICAgICAgICAgIHdoaWxlIChyZWNlaXZlZC5nZXQoKSA8IG5i\nTWVzc2FnZXMpIHsKICAgICAgICAgICAgICAgIFRleHRNZXNzYWdlIG1zZyA9\nIChUZXh0TWVzc2FnZSkgY29uc3VtZXIucmVjZWl2ZSg2MDAwMDAwKTsKICAg\nICAgICAgICAgICAgIGlmIChtc2cgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChtc2cgIT0gbnVsbCAmJiByb2xsZWRiYWNrLnB1dChtc2cu\nZ2V0VGV4dCgpLCBCb29sZWFuLlRSVUUpICE9IG51bGwpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgTE9HLmluZm8oIlJlY2VpdmVkIG1lc3NhZ2UgIiAr\nIG1zZy5nZXRUZXh0KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyAiICgiICsgcmVjZWl2ZWQuZ2V0QW5kSW5jcmVtZW50KCkgKyAiKSIg\nKyBtc2cuZ2V0Sk1TTWVzc2FnZUlEKCkpOwogICAgICAgICAgICAgICAgICAg\nICAgICBhc3NlcnRUcnVlKG1zZy5nZXRKTVNSZWRlbGl2ZXJlZCgpKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gYXNzZXJ0RXF1YWxzKDIsIG1zZy5n\nZXRMb25nUHJvcGVydHkoIkpNU1hEZWxpdmVyeUNvdW50IikpOwogICAgICAg\nICAgICAgICAgICAgICAgICBzZXNzaW9uLmNvbW1pdCgpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5pbmZvKCJSb2xsYmFjayBtZXNzYWdlICIgKyBtc2cuZ2V0VGV4dCgpICsg\nIiBpZDogIiArICBtc2cuZ2V0Sk1TTWVzc2FnZUlEKCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICBhc3NlcnRGYWxzZSgic2hvdWxkIG5vdCBoYXZlIHJl\nZGVsaXZlcnkgZmxhZyBzZXQsIGlkOiAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgbXNnLmdldEpNU01lc3NhZ2VJRCgpLCBtc2cu\nZ2V0Sk1TUmVkZWxpdmVyZWQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHNlc3Npb24ucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29u\nc3VtZXIuY2xvc2UoKTsKICAgICAgICAgICAgc2Vzc2lvbi5jbG9zZSgpOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0UmVkZWxpdmVy\neU9uU2luZ2xlQ29uc3VtZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKCiAgICAg\nICAgQ29ubmVjdGlvbkZhY3RvcnkgY29ubmVjdGlvbkZhY3RvcnkgPQogICAg\nICAgICAgICBuZXcgSGVkd2lnQ29ubmVjdGlvbkZhY3RvcnlJbXBsKCk7CiAg\nICAgICAgQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gY29ubmVjdGlvbkZhY3Rv\ncnkuY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgIGNvbm5lY3Rpb24uc3Rh\ncnQoKTsKICAgICAgICBTZXNzaW9uIHNlc3Npb24gPSBjb25uZWN0aW9uLmNy\nZWF0ZVNlc3Npb24odHJ1ZSwgU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFKTsK\nICAgICAgICBEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbiA9IHNlc3Npb24uY3Jl\nYXRlVG9waWMoZGVzdGluYXRpb25OYW1lKTsKICAgICAgICBNZXNzYWdlQ29u\nc3VtZXIgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1bWVyKGRlc3Rp\nbmF0aW9uKTsKCiAgICAgICAgcG9wdWxhdGVEZXN0aW5hdGlvbldpdGhJbnRl\ncmxlYXZlZFByb2R1Y2VyKG5iTWVzc2FnZXMsIGRlc3RpbmF0aW9uTmFtZSwg\nY29ubmVjdGlvbik7CgogICAgICAgIC8vIENvbnN1bWUgbWVzc2FnZXMgYW5k\nIHJvbGxiYWNrIHRyYW5zYWN0aW9ucwogICAgICAgIHsKICAgICAgICAgICAg\nQXRvbWljSW50ZWdlciByZWNlaXZlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKCk7\nCiAgICAgICAgICAgIE1hcDxTdHJpbmcsIEJvb2xlYW4+IHJvbGxlZGJhY2sg\nPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8U3RyaW5nLCBCb29sZWFuPigpOwog\nICAgICAgICAgICB3aGlsZSAocmVjZWl2ZWQuZ2V0KCkgPCBuYk1lc3NhZ2Vz\nKSB7CiAgICAgICAgICAgICAgICBUZXh0TWVzc2FnZSBtc2cgPSAoVGV4dE1l\nc3NhZ2UpIGNvbnN1bWVyLnJlY2VpdmUoNjAwMDAwMCk7CiAgICAgICAgICAg\nICAgICBpZiAobXNnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAobXNnICE9IG51bGwgJiYgcm9sbGVkYmFjay5wdXQobXNnLmdldFRleHQo\nKSwgQm9vbGVhbi5UUlVFKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExPRy5pbmZvKCJSZWNlaXZlZCBtZXNzYWdlICIgKyBtc2cuZ2V0\nVGV4dCgpICsgIiAoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIHJlY2VpdmVkLmdldEFuZEluY3JlbWVudCgpICsgIikiICsgbXNnLmdl\ndEpNU01lc3NhZ2VJRCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZShtc2cuZ2V0Sk1TUmVkZWxpdmVyZWQoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHNlc3Npb24uY29tbWl0KCk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIlJvbGxiYWNrIG1lc3NhZ2UgIiArIG1zZy5nZXRUZXh0KCkgKyAiIGlk\nOiAiICsgIG1zZy5nZXRKTVNNZXNzYWdlSUQoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHNlc3Npb24ucm9sbGJhY2soKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgY29uc3VtZXIuY2xvc2UoKTsKICAgICAgICAgICAgc2Vzc2lvbi5j\nbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nUmVkZWxpdmVyeU9uU2luZ2xlU2Vzc2lvbigpIHRocm93cyBFeGNlcHRpb24g\newoKICAgICAgICBDb25uZWN0aW9uRmFjdG9yeSBjb25uZWN0aW9uRmFjdG9y\neSA9CiAgICAgICAgICAgIG5ldyBIZWR3aWdDb25uZWN0aW9uRmFjdG9yeUlt\ncGwoKTsKICAgICAgICBDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSBjb25uZWN0\naW9uRmFjdG9yeS5jcmVhdGVDb25uZWN0aW9uKCk7CiAgICAgICAgU2Vzc2lv\nbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKHRydWUsIFNl\nc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAgICAgRGVzdGluYXRpb24g\nZGVzdGluYXRpb24gPSBzZXNzaW9uLmNyZWF0ZVRvcGljKGRlc3RpbmF0aW9u\nTmFtZSk7CiAgICAgICAgTWVzc2FnZUNvbnN1bWVyIGNvbnN1bWVyID0gc2Vz\nc2lvbi5jcmVhdGVDb25zdW1lcihkZXN0aW5hdGlvbik7CiAgICAgICAgY29u\nbmVjdGlvbi5zdGFydCgpOwoKICAgICAgICBwb3B1bGF0ZURlc3RpbmF0aW9u\nKG5iTWVzc2FnZXMsIGRlc3RpbmF0aW9uTmFtZSwgY29ubmVjdGlvbik7Cgog\nICAgICAgIC8vIENvbnN1bWUgbWVzc2FnZXMgYW5kIHJvbGxiYWNrIHRyYW5z\nYWN0aW9ucwogICAgICAgIHsKICAgICAgICAgICAgQXRvbWljSW50ZWdlciBy\nZWNlaXZlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKCk7CiAgICAgICAgICAgIE1h\ncDxTdHJpbmcsIEJvb2xlYW4+IHJvbGxlZGJhY2sgPSBuZXcgQ29uY3VycmVu\ndEhhc2hNYXA8U3RyaW5nLCBCb29sZWFuPigpOwogICAgICAgICAgICB3aGls\nZSAocmVjZWl2ZWQuZ2V0KCkgPCBuYk1lc3NhZ2VzKSB7CiAgICAgICAgICAg\nICAgICBUZXh0TWVzc2FnZSBtc2cgPSAoVGV4dE1lc3NhZ2UpIGNvbnN1bWVy\nLnJlY2VpdmUoNjAwMDAwMCk7CiAgICAgICAgICAgICAgICBpZiAobXNnICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobXNnICE9IG51bGwg\nJiYgcm9sbGVkYmFjay5wdXQobXNnLmdldFRleHQoKSwgQm9vbGVhbi5UUlVF\nKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5pbmZv\nKCJSZWNlaXZlZCBtZXNzYWdlICIgKyBtc2cuZ2V0VGV4dCgpICsgIiAoIgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHJlY2VpdmVkLmdl\ndEFuZEluY3JlbWVudCgpICsgIikiICsgbXNnLmdldEpNU01lc3NhZ2VJRCgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZShtc2cuZ2V0\nSk1TUmVkZWxpdmVyZWQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNl\nc3Npb24uY29tbWl0KCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlJvbGxiYWNrIG1l\nc3NhZ2UgIiArIG1zZy5nZXRUZXh0KCkgKyAiIGlkOiAiICsgIG1zZy5nZXRK\nTVNNZXNzYWdlSUQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNlc3Np\nb24ucm9sbGJhY2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3VtZXIu\nY2xvc2UoKTsKICAgICAgICAgICAgc2Vzc2lvbi5jbG9zZSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvLyBBTVEtMTU5MwogICAgcHVibGljIHZvaWQgdGVz\ndFZhbGlkYXRlUmVkZWxpdmVyeUNvdW50T25Sb2xsYmFjaygpIHRocm93cyBF\neGNlcHRpb24gewoKICAgICAgICBmaW5hbCBpbnQgbnVtTWVzc2FnZXMgPSAx\nOwogICAgICAgIENvbm5lY3Rpb25GYWN0b3J5IGNvbm5lY3Rpb25GYWN0b3J5\nID0KICAgICAgICAgICAgbmV3IEhlZHdpZ0Nvbm5lY3Rpb25GYWN0b3J5SW1w\nbCgpOwogICAgICAgIENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IGNvbm5lY3Rp\nb25GYWN0b3J5LmNyZWF0ZUNvbm5lY3Rpb24oKTsKICAgICAgICBTZXNzaW9u\nIHNlc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24odHJ1ZSwgU2Vz\nc2lvbi5TRVNTSU9OX1RSQU5TQUNURUQpOwogICAgICAgIERlc3RpbmF0aW9u\nIGRlc3RpbmF0aW9uID0gc2Vzc2lvbi5jcmVhdGVUb3BpYyhkZXN0aW5hdGlv\nbk5hbWUpOwoKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBz\nZXNzaW9uLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKChUb3BpYykgZGVzdGlu\nYXRpb24sICJzdWJzY3JpYmVyLWlkLTEiKTsKICAgICAgICBjb25uZWN0aW9u\nLnN0YXJ0KCk7CgogICAgICAgIHBvcHVsYXRlRGVzdGluYXRpb24obnVtTWVz\nc2FnZXMsIGRlc3RpbmF0aW9uTmFtZSwgY29ubmVjdGlvbik7CgogICAgICAg\nIHsKICAgICAgICAgICAgQXRvbWljSW50ZWdlciByZWNlaXZlZCA9IG5ldyBB\ndG9taWNJbnRlZ2VyKCk7CiAgICAgICAgICAgIC8vIGhhcmRjb2RlZCwgd2Ug\nYWN0dWFsbHkgYWxsb3cgZm9yIGluZmluaXRlIHJvbGxiYWNrL3JlZGVsaXZl\ncnkgLi4uCiAgICAgICAgICAgIGZpbmFsIGludCBtYXhSZXRyaWVzID0gNTsK\nICAgICAgICAgICAgd2hpbGUgKHJlY2VpdmVkLmdldCgpIDwgbWF4UmV0cmll\ncykgewogICAgICAgICAgICAgICAgVGV4dE1lc3NhZ2UgbXNnID0gKFRleHRN\nZXNzYWdlKSBjb25zdW1lci5yZWNlaXZlKDEwMDApOwogICAgICAgICAgICAg\nICAgYXNzZXJ0IG1zZyAhPSBudWxsOwogICAgICAgICAgICAgICAgaWYgKG1z\nZyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlJl\nY2VpdmVkIG1lc3NhZ2UgIiArIG1zZy5nZXRUZXh0KCkgKyAiICgiCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyByZWNlaXZlZC5nZXRBbmRJbmNy\nZW1lbnQoKSArICIpIiArIG1zZy5nZXRKTVNNZXNzYWdlSUQoKSk7CiAgICAg\nICAgICAgICAgICAgICAgc2Vzc2lvbi5yb2xsYmFjaygpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHNlc3Npb24uY2xv\nc2UoKTsKICAgICAgICAgICAgY29uc3VtZU1lc3NhZ2UoY29ubmVjdGlvbiwg\nInN1YnNjcmliZXItaWQtMSIpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBB\nTVEtMTU5MwogICAgcHVibGljIHZvaWQgdGVzdFZhbGlkYXRlUmVkZWxpdmVy\neUNvdW50T25Sb2xsYmFja1dpdGhQcmVmZXRjaDAoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKCiAgICAgICBmaW5hbCBpbnQgbnVtTWVzc2FnZXMgPSAxOwogICAg\nICAgQ29ubmVjdGlvbkZhY3RvcnkgY29ubmVjdGlvbkZhY3RvcnkgPQogICAg\nICAgICAgICBuZXcgSGVkd2lnQ29ubmVjdGlvbkZhY3RvcnlJbXBsKCk7CiAg\nICAgICAgQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gY29ubmVjdGlvbkZhY3Rv\ncnkuY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgIFNlc3Npb24gc2Vzc2lv\nbiA9IGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lvbih0cnVlLCBTZXNzaW9uLlNF\nU1NJT05fVFJBTlNBQ1RFRCk7CiAgICAgICAgRGVzdGluYXRpb24gZGVzdGlu\nYXRpb24gPSBzZXNzaW9uLmNyZWF0ZVRvcGljKGRlc3RpbmF0aW9uTmFtZSk7\nCgogICAgICAgIE1lc3NhZ2VDb25zdW1lciBjb25zdW1lciA9IHNlc3Npb24u\nY3JlYXRlRHVyYWJsZVN1YnNjcmliZXIoKFRvcGljKSBkZXN0aW5hdGlvbiwg\nInN1YnNjcmliZXItaWQtMiIpOwogICAgICAgIGNvbm5lY3Rpb24uc3RhcnQo\nKTsKCiAgICAgICAgcG9wdWxhdGVEZXN0aW5hdGlvbihudW1NZXNzYWdlcywg\nZGVzdGluYXRpb25OYW1lLCBjb25uZWN0aW9uKTsKCiAgICAgICAgewogICAg\nICAgICAgICBBdG9taWNJbnRlZ2VyIHJlY2VpdmVkID0gbmV3IEF0b21pY0lu\ndGVnZXIoKTsKICAgICAgICAgICAgLy8gaGFyZGNvZGVkLCB3ZSBhY3R1YWxs\neSBhbGxvdyBmb3IgaW5maW5pdGUgcm9sbGJhY2svcmVkZWxpdmVyeSAuLi4K\nICAgICAgICAgICAgZmluYWwgaW50IG1heFJldHJpZXMgPSA1OwogICAgICAg\nICAgICB3aGlsZSAocmVjZWl2ZWQuZ2V0KCkgPCBtYXhSZXRyaWVzKSB7CiAg\nICAgICAgICAgICAgICBUZXh0TWVzc2FnZSBtc2cgPSAoVGV4dE1lc3NhZ2Up\nIGNvbnN1bWVyLnJlY2VpdmUoMTAwMCk7CiAgICAgICAgICAgICAgICBhc3Nl\ncnQgbXNnICE9IG51bGw7CiAgICAgICAgICAgICAgICBpZiAobXNnICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiUmVjZWl2ZWQg\nbWVzc2FnZSAiICsgbXNnLmdldFRleHQoKSArICIgKCIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICArIHJlY2VpdmVkLmdldEFuZEluY3JlbWVudCgp\nICsgIikiICsgbXNnLmdldEpNU01lc3NhZ2VJRCgpKTsKICAgICAgICAgICAg\nICAgICAgICBzZXNzaW9uLnJvbGxiYWNrKCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHNlc3Npb24uY2xvc2UoKTsK\nICAgICAgICAgICAgY29uc3VtZU1lc3NhZ2UoY29ubmVjdGlvbiwgInN1YnNj\ncmliZXItaWQtMiIpOwogICAgICAgIH0KICAgIH0KCgogICAgcHJpdmF0ZSB2\nb2lkIGNvbnN1bWVNZXNzYWdlKENvbm5lY3Rpb24gY29ubmVjdGlvbiwgU3Ry\naW5nIHN1YnNjcmliZXJJZCkKICAgICAgICAgICAgdGhyb3dzIEpNU0V4Y2Vw\ndGlvbiB7CiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5j\ncmVhdGVTZXNzaW9uKHRydWUsIFNlc3Npb24uU0VTU0lPTl9UUkFOU0FDVEVE\nKTsKICAgICAgICBEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbiA9IHNlc3Npb24u\nY3JlYXRlVG9waWMoZGVzdGluYXRpb25OYW1lKTsKICAgICAgICBNZXNzYWdl\nQ29uc3VtZXIgY29uc3VtZXI7CiAgICAgICAgaWYgKG51bGwgPT0gc3Vic2Ny\naWJlcklkKSBjb25zdW1lciA9IHNlc3Npb24uY3JlYXRlQ29uc3VtZXIoZGVz\ndGluYXRpb24pOwogICAgICAgIGVsc2UgY29uc3VtZXIgPSBzZXNzaW9uLmNy\nZWF0ZUR1cmFibGVTdWJzY3JpYmVyKChUb3BpYykgZGVzdGluYXRpb24sIHN1\nYnNjcmliZXJJZCk7CgogICAgICAgIFRleHRNZXNzYWdlIG1zZyA9IChUZXh0\nTWVzc2FnZSkgY29uc3VtZXIucmVjZWl2ZSgxMDAwKTsKICAgICAgICBhc3Nl\ncnROb3ROdWxsKG1zZyk7CiAgICAgICAgc2Vzc2lvbi5jb21taXQoKTsKICAg\nICAgICBzZXNzaW9uLmNsb3NlKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\ndGVzdFJlZGVsaXZlcnlQcm9wZXJ0eVdpdGhOb1JvbGxiYWNrKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgaW50IG51bU1lc3NhZ2VzID0g\nMTsKICAgICAgICBDb25uZWN0aW9uRmFjdG9yeSBjb25uZWN0aW9uRmFjdG9y\neSA9CiAgICAgICAgICAgIG5ldyBIZWR3aWdDb25uZWN0aW9uRmFjdG9yeUlt\ncGwoKTsKICAgICAgICBDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSBjb25uZWN0\naW9uRmFjdG9yeS5jcmVhdGVDb25uZWN0aW9uKCk7CiAgICAgICAgLy8gZW5z\ndXJlIHJlZ2lzdHJhdGlvbiBvZiBkdXJhYmxlIHN1YnNjcmlwdGlvbgogICAg\nICAgIHsKICAgICAgICAgICAgY29ubmVjdGlvbi5zZXRDbGllbnRJRChnZXRO\nYW1lKCkgKyAiLWNsaWVudC1pZC0xIik7CiAgICAgICAgICAgIFNlc3Npb24g\nc2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lvbih0cnVlLCBTZXNz\naW9uLlNFU1NJT05fVFJBTlNBQ1RFRCk7CiAgICAgICAgICAgIERlc3RpbmF0\naW9uIGRlc3RpbmF0aW9uID0gc2Vzc2lvbi5jcmVhdGVUb3BpYyhkZXN0aW5h\ndGlvbk5hbWUpOwoKICAgICAgICAgICAgTWVzc2FnZUNvbnN1bWVyIGNvbnN1\nbWVyID0gc2Vzc2lvbi5jcmVhdGVEdXJhYmxlU3Vic2NyaWJlcigoVG9waWMp\nIGRlc3RpbmF0aW9uLCAic3Vic2NyaWJlci1pZC0zIik7CiAgICAgICAgfQog\nICAgICAgIGNvbm5lY3Rpb24uc3RhcnQoKTsKCiAgICAgICAgcG9wdWxhdGVE\nZXN0aW5hdGlvbihudW1NZXNzYWdlcywgZGVzdGluYXRpb25OYW1lLCBjb25u\nZWN0aW9uKTsKICAgICAgICBjb25uZWN0aW9uLmNsb3NlKCk7CiAgICAgICAg\newogICAgICAgICAgICBBdG9taWNJbnRlZ2VyIHJlY2VpdmVkID0gbmV3IEF0\nb21pY0ludGVnZXIoKTsKICAgICAgICAgICAgLy8gaGFyZGNvZGVkLCB3ZSBh\nY3R1YWxseSBhbGxvdyBmb3IgaW5maW5pdGUgcm9sbGJhY2svcmVkZWxpdmVy\neSAuLi4KICAgICAgICAgICAgZmluYWwgaW50IG1heFJldHJpZXMgPSA1Owog\nICAgICAgICAgICB3aGlsZSAocmVjZWl2ZWQuZ2V0KCkgPCBtYXhSZXRyaWVz\nKSB7CiAgICAgICAgICAgICAgICBjb25uZWN0aW9uID0gY29ubmVjdGlvbkZh\nY3RvcnkuY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgICAgICAgICAgY29u\nbmVjdGlvbi5zZXRDbGllbnRJRChnZXROYW1lKCkgKyAiLWNsaWVudC1pZC0x\nIik7CiAgICAgICAgICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CiAgICAg\nICAgICAgICAgICBTZXNzaW9uIHNlc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0\nZVNlc3Npb24odHJ1ZSwgU2Vzc2lvbi5TRVNTSU9OX1RSQU5TQUNURUQpOwog\nICAgICAgICAgICAgICAgRGVzdGluYXRpb24gZGVzdGluYXRpb24gPSBzZXNz\naW9uLmNyZWF0ZVRvcGljKGRlc3RpbmF0aW9uTmFtZSk7CgogICAgICAgICAg\nICAgICAgTWVzc2FnZUNvbnN1bWVyIGNvbnN1bWVyID0gc2Vzc2lvbi5jcmVh\ndGVEdXJhYmxlU3Vic2NyaWJlcigoVG9waWMpIGRlc3RpbmF0aW9uLCAic3Vi\nc2NyaWJlci1pZC0zIik7CiAgICAgICAgICAgICAgICBUZXh0TWVzc2FnZSBt\nc2cgPSAoVGV4dE1lc3NhZ2UpIGNvbnN1bWVyLnJlY2VpdmUoMjAwMCk7CiAg\nICAgICAgICAgICAgICBhc3NlcnQgbXNnICE9IG51bGw7CiAgICAgICAgICAg\nICAgICBpZiAobXNnICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiUmVjZWl2ZWQgbWVzc2FnZSAiICsgbXNnLmdldFRleHQoKSAr\nICIgKCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHJlY2VpdmVk\nLmdldEFuZEluY3JlbWVudCgpICsgIikiICsgbXNnLmdldEpNU01lc3NhZ2VJ\nRCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNlc3Np\nb24uY2xvc2UoKTsKICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uY2xvc2Uo\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25uZWN0aW9uID0gY29u\nbmVjdGlvbkZhY3RvcnkuY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgICAg\nICBjb25uZWN0aW9uLnNldENsaWVudElEKGdldE5hbWUoKSArICItY2xpZW50\nLWlkLTEiKTsKICAgICAgICAgICAgY29ubmVjdGlvbi5zdGFydCgpOwogICAg\nICAgICAgICBjb25zdW1lTWVzc2FnZShjb25uZWN0aW9uLCAic3Vic2NyaWJl\nci1pZC0zIik7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBw\nb3B1bGF0ZURlc3RpbmF0aW9uKGZpbmFsIGludCBuYk1lc3NhZ2VzLAogICAg\nICAgICAgICBmaW5hbCBTdHJpbmcgZGVzdGluYXRpb25OYW1lLCBDb25uZWN0\naW9uIGNvbm5lY3Rpb24pCiAgICAgICAgICAgIHRocm93cyBKTVNFeGNlcHRp\nb24gewogICAgICAgIFNlc3Npb24gc2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3Jl\nYXRlU2Vzc2lvbihmYWxzZSwgU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFKTsK\nICAgICAgICBEZXN0aW5hdGlvbiBkZXN0aW5hdGlvbiA9IHNlc3Npb24uY3Jl\nYXRlVG9waWMoZGVzdGluYXRpb25OYW1lKTsKICAgICAgICBNZXNzYWdlUHJv\nZHVjZXIgcHJvZHVjZXIgPSBzZXNzaW9uLmNyZWF0ZVByb2R1Y2VyKGRlc3Rp\nbmF0aW9uKTsKICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8PSBuYk1lc3Nh\nZ2VzOyBpKyspIHsKICAgICAgICAgICAgcHJvZHVjZXIuc2VuZChzZXNzaW9u\nLmNyZWF0ZVRleHRNZXNzYWdlKCI8aGVsbG8gaWQ9JyIgKyBpICsgIicvPiIp\nKTsKICAgICAgICB9CiAgICAgICAgcHJvZHVjZXIuY2xvc2UoKTsKICAgICAg\nICBzZXNzaW9uLmNsb3NlKCk7CiAgICB9CgoKICAgIHByaXZhdGUgdm9pZCBw\nb3B1bGF0ZURlc3RpbmF0aW9uV2l0aEludGVybGVhdmVkUHJvZHVjZXIoZmlu\nYWwgaW50IG5iTWVzc2FnZXMsCiAgICAgICAgICAgIGZpbmFsIFN0cmluZyBk\nZXN0aW5hdGlvbk5hbWUsIENvbm5lY3Rpb24gY29ubmVjdGlvbikKICAgICAg\nICAgICAgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgU2Vzc2lvbiBz\nZXNzaW9uMSA9IGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lvbihmYWxzZSwgU2Vz\nc2lvbi5BVVRPX0FDS05PV0xFREdFKTsKICAgICAgICBEZXN0aW5hdGlvbiBk\nZXN0aW5hdGlvbjEgPSBzZXNzaW9uMS5jcmVhdGVUb3BpYyhkZXN0aW5hdGlv\nbk5hbWUpOwogICAgICAgIE1lc3NhZ2VQcm9kdWNlciBwcm9kdWNlcjEgPSBz\nZXNzaW9uMS5jcmVhdGVQcm9kdWNlcihkZXN0aW5hdGlvbjEpOwogICAgICAg\nIFNlc3Npb24gc2Vzc2lvbjIgPSBjb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24o\nZmFsc2UsIFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAgICAgRGVz\ndGluYXRpb24gZGVzdGluYXRpb24yID0gc2Vzc2lvbjIuY3JlYXRlVG9waWMo\nZGVzdGluYXRpb25OYW1lKTsKICAgICAgICBNZXNzYWdlUHJvZHVjZXIgcHJv\nZHVjZXIyID0gc2Vzc2lvbjIuY3JlYXRlUHJvZHVjZXIoZGVzdGluYXRpb24y\nKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDE7IGkgPD0gbmJNZXNzYWdlczsg\naSsrKSB7CiAgICAgICAgICAgIGlmIChpJTIgPT0gMCkgewogICAgICAgICAg\nICAgICAgcHJvZHVjZXIxLnNlbmQoc2Vzc2lvbjEuY3JlYXRlVGV4dE1lc3Nh\nZ2UoIjxoZWxsbyBpZD0nIiArIGkgKyAiJy8+IikpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgcHJvZHVjZXIyLnNlbmQoc2Vzc2lv\nbjIuY3JlYXRlVGV4dE1lc3NhZ2UoIjxoZWxsbyBpZD0nIiArIGkgKyAiJy8+\nIikpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHByb2R1Y2Vy\nMS5jbG9zZSgpOwogICAgICAgIHNlc3Npb24xLmNsb3NlKCk7CiAgICAgICAg\ncHJvZHVjZXIyLmNsb3NlKCk7CiAgICAgICAgc2Vzc2lvbjIuY2xvc2UoKTsK\nICAgIH0KCn0K\n","encoding":"base64"}

