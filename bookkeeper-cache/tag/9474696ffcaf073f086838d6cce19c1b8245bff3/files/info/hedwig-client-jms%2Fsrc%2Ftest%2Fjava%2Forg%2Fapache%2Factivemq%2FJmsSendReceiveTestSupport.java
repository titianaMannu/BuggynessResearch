{"sha":"62a17150c8d9ffce52e1c493bb68d12fccce4bb9","node_id":"MDQ6QmxvYjE1NzU5NTY6NjJhMTcxNTBjOGQ5ZmZjZTUyZTFjNDkzYmI2OGQxMmZjY2NlNGJiOQ==","size":7408,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/62a17150c8d9ffce52e1c493bb68d12fccce4bb9","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFja2Fn\nZSBvcmcuYXBhY2hlLmFjdGl2ZW1xOwoKaW1wb3J0IGphdmEudXRpbC5BcnJh\neUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkRhdGU7CmltcG9y\ndCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsK\nCmltcG9ydCBqYXZheC5qbXMuRGVsaXZlcnlNb2RlOwppbXBvcnQgamF2YXgu\nam1zLkRlc3RpbmF0aW9uOwppbXBvcnQgamF2YXguam1zLkpNU0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlOwppbXBvcnQgamF2YXguam1z\nLk1lc3NhZ2VDb25zdW1lcjsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlTGlz\ndGVuZXI7CmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZVByb2R1Y2VyOwppbXBv\ncnQgamF2YXguam1zLlNlc3Npb247CmltcG9ydCBqYXZheC5qbXMuVGV4dE1l\nc3NhZ2U7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXJGYWN0b3J5OwoKcHVibGljIGNsYXNzIEptc1NlbmRSZWNl\naXZlVGVzdFN1cHBvcnQgZXh0ZW5kcyBUZXN0U3VwcG9ydCBpbXBsZW1lbnRz\nIE1lc3NhZ2VMaXN0ZW5lciB7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBM\nb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSm1zU2VuZFJl\nY2VpdmVUZXN0U3VwcG9ydC5jbGFzcyk7CgogICAgcHJvdGVjdGVkIGludCBt\nZXNzYWdlQ291bnQgPSAxMDA7CiAgICBwcm90ZWN0ZWQgU3RyaW5nW10gZGF0\nYTsKICAgIHByb3RlY3RlZCBTZXNzaW9uIHNlc3Npb247CiAgICBwcm90ZWN0\nZWQgTWVzc2FnZUNvbnN1bWVyIGNvbnN1bWVyOwogICAgcHJvdGVjdGVkIE1l\nc3NhZ2VQcm9kdWNlciBwcm9kdWNlcjsKICAgIHByb3RlY3RlZCBEZXN0aW5h\ndGlvbiBjb25zdW1lckRlc3RpbmF0aW9uOwogICAgcHJvdGVjdGVkIERlc3Rp\nbmF0aW9uIHByb2R1Y2VyRGVzdGluYXRpb247CiAgICBwcm90ZWN0ZWQgTGlz\ndDxNZXNzYWdlPiBtZXNzYWdlcyA9IGNyZWF0ZUNvbmN1cnJlbnRMaXN0KCk7\nCiAgICBwcm90ZWN0ZWQgYm9vbGVhbiB0b3BpYyA9IHRydWU7CiAgICBwcm90\nZWN0ZWQgYm9vbGVhbiBkdXJhYmxlOwogICAgcHJvdGVjdGVkIGludCBkZWxp\ndmVyeU1vZGUgPSBEZWxpdmVyeU1vZGUuUEVSU0lTVEVOVDsKICAgIHByb3Rl\nY3RlZCBmaW5hbCBPYmplY3QgbG9jayA9IG5ldyBPYmplY3QoKTsKICAgIHBy\nb3RlY3RlZCBib29sZWFuIHZlcmJvc2U7CgogICAgLyoKICAgICAqIEBzZWUg\nanVuaXQuZnJhbWV3b3JrLlRlc3RDYXNlI3NldFVwKCkKICAgICAqLwogICAg\ncHJvdGVjdGVkIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBzdXBlci5zZXRVcCgpOwogICAgICAgIFN0cmluZyB0ZW1wID0gU3lz\ndGVtLmdldFByb3BlcnR5KCJtZXNzYWdlQ291bnQiKTsKCiAgICAgICAgaWYg\nKHRlbXAgIT0gbnVsbCkgewogICAgICAgICAgICBpbnQgaSA9IEludGVnZXIu\ncGFyc2VJbnQodGVtcCk7CiAgICAgICAgICAgIGlmIChpID4gMCkgewogICAg\nICAgICAgICAgICAgbWVzc2FnZUNvdW50ID0gaTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgTE9HLmluZm8oIk1lc3NhZ2UgY291bnQgZm9y\nIHRlc3QgY2FzZSBpczogIiArIG1lc3NhZ2VDb3VudCk7CiAgICAgICAgZGF0\nYSA9IG5ldyBTdHJpbmdbbWVzc2FnZUNvdW50XTsKCiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBtZXNzYWdlQ291bnQ7IGkrKykgewogICAgICAgICAg\nICBkYXRhW2ldID0gIlRleHQgZm9yIG1lc3NhZ2U6ICIgKyBpICsgIiBhdCAi\nICsgbmV3IERhdGUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTZW5kcyBhbmQgY29uc3VtZXMgdGhlIG1lc3NhZ2VzLgogICAgICoKICAg\nICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIHRlc3RTZW5kUmVjZWl2ZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIG1lc3NhZ2VzLmNsZWFyKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBkYXRhLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIE1lc3NhZ2UgbWVz\nc2FnZSA9IHNlc3Npb24uY3JlYXRlVGV4dE1lc3NhZ2UoZGF0YVtpXSk7CiAg\nICAgICAgICAgIG1lc3NhZ2Uuc2V0U3RyaW5nUHJvcGVydHkoInN0cmluZ1By\nb3BlcnR5IiwgZGF0YVtpXSk7CiAgICAgICAgICAgIG1lc3NhZ2Uuc2V0SW50\nUHJvcGVydHkoImludFByb3BlcnR5IiwgaSk7CgogICAgICAgICAgICBpZiAo\ndmVyYm9zZSkgewogICAgICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJBYm91\ndCB0byBzZW5kIGEgbWVzc2FnZTogIiArIG1lc3NhZ2UgKyAiIHdpdGggdGV4\ndDogIiArIGRhdGFbaV0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CgogICAgICAgICAgICBzZW5kVG9Qcm9kdWNlcihwcm9kdWNlciwgcHJv\nZHVjZXJEZXN0aW5hdGlvbiwgbWVzc2FnZSk7CiAgICAgICAgICAgIG1lc3Nh\nZ2VTZW50KCk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRNZXNzYWdlc0Fy\nZVJlY2VpdmVkKCk7CiAgICAgICAgTE9HLmluZm8oIiIgKyBkYXRhLmxlbmd0\naCArICIgbWVzc2FnZXMocykgcmVjZWl2ZWQsIGNsb3NpbmcgZG93biBjb25u\nZWN0aW9ucyIpOwogICAgfQoKICAgIC8qKgogICAgICogU2VuZHMgYSBtZXNz\nYWdlIHRvIGEgZGVzdGluYXRpb24gdXNpbmcgdGhlIHN1cHBsaWVkIHByb2R1\nY2VyCiAgICAgKiBAcGFyYW0gcHJvZHVjZXIKICAgICAqIEBwYXJhbSBwcm9k\ndWNlckRlc3RpbmF0aW9uCiAgICAgKiBAcGFyYW0gbWVzc2FnZQogICAgICog\nQHRocm93cyBKTVNFeGNlcHRpb24KICAgICAqLwogICAgcHJvdGVjdGVkIHZv\naWQgc2VuZFRvUHJvZHVjZXIoTWVzc2FnZVByb2R1Y2VyIHByb2R1Y2VyLAog\nICAgICAgICAgICBEZXN0aW5hdGlvbiBwcm9kdWNlckRlc3RpbmF0aW9uLCBN\nZXNzYWdlIG1lc3NhZ2UpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAg\nIHByb2R1Y2VyLnNlbmQocHJvZHVjZXJEZXN0aW5hdGlvbiwgbWVzc2FnZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBBc3NlcnRzIG1lc3NhZ2VzIGFyZSBy\nZWNlaXZlZC4KICAgICAqCiAgICAgKiBAdGhyb3dzIEpNU0V4Y2VwdGlvbgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBhc3NlcnRNZXNzYWdlc0FyZVJl\nY2VpdmVkKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgd2FpdEZv\nck1lc3NhZ2VzVG9CZURlbGl2ZXJlZCgpOwogICAgICAgIGFzc2VydE1lc3Nh\nZ2VzUmVjZWl2ZWRBcmVWYWxpZChtZXNzYWdlcyk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUZXN0cyBpZiB0aGUgbWVzc2FnZXMgcmVjZWl2ZWQgYXJlIHZh\nbGlkLgogICAgICoKICAgICAqIEBwYXJhbSByZWNlaXZlZE1lc3NhZ2VzIC0g\nbGlzdCBvZiByZWNlaXZlZCBtZXNzYWdlcy4KICAgICAqIEB0aHJvd3MgSk1T\nRXhjZXB0aW9uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIGFzc2VydE1l\nc3NhZ2VzUmVjZWl2ZWRBcmVWYWxpZChMaXN0PE1lc3NhZ2U+IHJlY2VpdmVk\nTWVzc2FnZXMpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIExpc3Q8\nT2JqZWN0PiBjb3B5T2ZNZXNzYWdlcyA9IEFycmF5cy5hc0xpc3QocmVjZWl2\nZWRNZXNzYWdlcy50b0FycmF5KCkpOwogICAgICAgIGludCBjb3VudGVyID0g\nMDsKCiAgICAgICAgaWYgKGRhdGEubGVuZ3RoICE9IGNvcHlPZk1lc3NhZ2Vz\nLnNpemUoKSkgewogICAgICAgICAgICBmb3IgKEl0ZXJhdG9yPE9iamVjdD4g\naXRlciA9IGNvcHlPZk1lc3NhZ2VzLml0ZXJhdG9yKCk7IGl0ZXIuaGFzTmV4\ndCgpOykgewogICAgICAgICAgICAgICAgVGV4dE1lc3NhZ2UgbWVzc2FnZSA9\nIChUZXh0TWVzc2FnZSlpdGVyLm5leHQoKTsKICAgICAgICAgICAgICAgIGlm\nIChMT0cuaXNJbmZvRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nTE9HLmluZm8oIjw9PSAiICsgY291bnRlcisrICsgIiA9ICIgKyBtZXNzYWdl\nLmdldFRleHQoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIGFzc2VydEVxdWFscygiTm90IGVub3VnaCBt\nZXNzYWdlcyByZWNlaXZlZCIsIGRhdGEubGVuZ3RoLCByZWNlaXZlZE1lc3Nh\nZ2VzLnNpemUoKSk7CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgZGF0\nYS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBUZXh0TWVzc2FnZSByZWNl\naXZlZCA9IChUZXh0TWVzc2FnZSlyZWNlaXZlZE1lc3NhZ2VzLmdldChpKTsK\nICAgICAgICAgICAgU3RyaW5nIHRleHQgPSByZWNlaXZlZC5nZXRUZXh0KCk7\nCiAgICAgICAgICAgIFN0cmluZyBzdHJpbmdQcm9wZXJ0eSA9IHJlY2VpdmVk\nLmdldFN0cmluZ1Byb3BlcnR5KCJzdHJpbmdQcm9wZXJ0eSIpOwogICAgICAg\nICAgICBpbnQgaW50UHJvcGVydHkgPSByZWNlaXZlZC5nZXRJbnRQcm9wZXJ0\neSgiaW50UHJvcGVydHkiKTsKCiAgICAgICAgICAgIGlmICh2ZXJib3NlKSB7\nCiAgICAgICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiUmVjZWl2ZWQgVGV4dDog\nIiArIHRleHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBhc3NlcnRFcXVhbHMoIk1lc3NhZ2U6ICIgKyBpLCBkYXRh\nW2ldLCB0ZXh0KTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGRhdGFbaV0s\nIHN0cmluZ1Byb3BlcnR5KTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGks\nIGludFByb3BlcnR5KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXYWl0cyBmb3IgbWVzc2FnZXMgdG8gYmUgZGVsaXZlcmVkLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCB3YWl0Rm9yTWVzc2FnZXNUb0JlRGVsaXZl\ncmVkKCkgewogICAgICAgIGxvbmcgbWF4V2FpdFRpbWUgPSAzMDAwMDsKICAg\nICAgICBsb25nIHdhaXRUaW1lID0gbWF4V2FpdFRpbWU7CiAgICAgICAgbG9u\nZyBzdGFydCA9IChtYXhXYWl0VGltZSA8PSAwKSA/IDAgOiBTeXN0ZW0uY3Vy\ncmVudFRpbWVNaWxsaXMoKTsKCiAgICAgICAgc3luY2hyb25pemVkIChsb2Nr\nKSB7CiAgICAgICAgICAgIHdoaWxlIChtZXNzYWdlcy5zaXplKCkgPCBkYXRh\nLmxlbmd0aCAmJiB3YWl0VGltZSA+PSAwKSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIGxvY2sud2FpdCgyMDApOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgd2FpdFRpbWUgPSBt\nYXhXYWl0VGltZSAtIChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0\nYXJ0KTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKgog\nICAgICogKG5vbi1KYXZhZG9jKQogICAgICoKICAgICAqIEBzZWUgamF2YXgu\nam1zLk1lc3NhZ2VMaXN0ZW5lciNvbk1lc3NhZ2UoamF2YXguam1zLk1lc3Nh\nZ2UpCiAgICAgKi8KICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBvbk1l\nc3NhZ2UoTWVzc2FnZSBtZXNzYWdlKSB7CiAgICAgICAgY29uc3VtZU1lc3Nh\nZ2UobWVzc2FnZSwgbWVzc2FnZXMpOwogICAgfQoKICAgIC8qKgogICAgICog\nQ29uc3VtZXMgbWVzc2FnZXMuCiAgICAgKgogICAgICogQHBhcmFtIG1lc3Nh\nZ2UgLSBtZXNzYWdlIHRvIGJlIGNvbnN1bWVkLgogICAgICogQHBhcmFtIG1l\nc3NhZ2VMaXN0IC1saXN0IG9mIGNvbnN1bWVkIG1lc3NhZ2VzLgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBjb25zdW1lTWVzc2FnZShNZXNzYWdlIG1l\nc3NhZ2UsIExpc3Q8TWVzc2FnZT4gbWVzc2FnZUxpc3QpIHsKICAgICAgICBp\nZiAodmVyYm9zZSkgewogICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJSZWNlaXZlZCBt\nZXNzYWdlOiAiICsgbWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIG1lc3NhZ2VMaXN0LmFkZChtZXNzYWdlKTsKCiAgICAgICAg\naWYgKG1lc3NhZ2VMaXN0LnNpemUoKSA+PSBkYXRhLmxlbmd0aCkgewogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQgKGxvY2spIHsKICAgICAgICAgICAgICAg\nIGxvY2subm90aWZ5QWxsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBBcnJheUxpc3QgYXMg\nYSBzeW5jaHJvbml6ZWQgbGlzdC4KICAgICAqCiAgICAgKiBAcmV0dXJuIExp\nc3QKICAgICAqLwogICAgcHJvdGVjdGVkIExpc3Q8TWVzc2FnZT4gY3JlYXRl\nQ29uY3VycmVudExpc3QoKSB7CiAgICAgICAgcmV0dXJuIENvbGxlY3Rpb25z\nLnN5bmNocm9uaXplZExpc3QobmV3IEFycmF5TGlzdDxNZXNzYWdlPigpKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIEp1c3QgYSBob29rIHNvIGNhbiBpbnNl\ncnQgZmFpbHVyZSB0ZXN0cwogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0\naW9uCiAgICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIG1lc3NhZ2VTZW50KCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CgogICAgfQp9Cg==\n","encoding":"base64"}

