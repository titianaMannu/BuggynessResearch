{"sha":"73dd2edb5d15cfb76e37968fc3a5873bd204132e","node_id":"MDQ6QmxvYjE1NzU5NTY6NzNkZDJlZGI1ZDE1Y2ZiNzZlMzc5NjhmYzNhNTg3M2JkMjA0MTMyZQ==","size":7437,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/73dd2edb5d15cfb76e37968fc3a5873bd204132e","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBhY2th\nZ2Ugb3JnLmFwYWNoZS5hY3RpdmVtcTsKCmltcG9ydCBqYXZheC5qbXMuQ29u\nbmVjdGlvbjsKaW1wb3J0IGphdmF4Lmptcy5EZWxpdmVyeU1vZGU7CmltcG9y\ndCBqYXZheC5qbXMuRGVzdGluYXRpb247CmltcG9ydCBqYXZheC5qbXMuSk1T\nRXhjZXB0aW9uOwppbXBvcnQgamF2YXguam1zLk1lc3NhZ2U7CmltcG9ydCBq\nYXZheC5qbXMuTWVzc2FnZUNvbnN1bWVyOwppbXBvcnQgamF2YXguam1zLk1l\nc3NhZ2VQcm9kdWNlcjsKaW1wb3J0IGphdmF4Lmptcy5TZXNzaW9uOwppbXBv\ncnQgamF2YXguam1zLlRleHRNZXNzYWdlOwppbXBvcnQgamF2YXguam1zLlRv\ncGljOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKgogKi8KcHVibGljIGNsYXNzIEpt\nc1RvcGljU2VsZWN0b3JUZXN0IGV4dGVuZHMgVGVzdFN1cHBvcnQgewogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3Rv\ncnkuZ2V0TG9nZ2VyKEptc1RvcGljU2VsZWN0b3JUZXN0LmNsYXNzKTsKCiAg\nICBwcm90ZWN0ZWQgQ29ubmVjdGlvbiBjb25uZWN0aW9uOwogICAgcHJvdGVj\ndGVkIFNlc3Npb24gc2Vzc2lvbjsKICAgIHByb3RlY3RlZCBNZXNzYWdlQ29u\nc3VtZXIgY29uc3VtZXI7CiAgICBwcm90ZWN0ZWQgTWVzc2FnZVByb2R1Y2Vy\nIHByb2R1Y2VyOwogICAgcHJvdGVjdGVkIERlc3RpbmF0aW9uIGNvbnN1bWVy\nRGVzdGluYXRpb247CiAgICBwcm90ZWN0ZWQgRGVzdGluYXRpb24gcHJvZHVj\nZXJEZXN0aW5hdGlvbjsKICAgIHByb3RlY3RlZCBib29sZWFuIHRvcGljID0g\ndHJ1ZTsKICAgIHByb3RlY3RlZCBib29sZWFuIGR1cmFibGU7CiAgICBwcm90\nZWN0ZWQgaW50IGRlbGl2ZXJ5TW9kZSA9IERlbGl2ZXJ5TW9kZS5QRVJTSVNU\nRU5UOwoKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3VwZXIuc2V0VXAoKTsKCiAgICAgICAgY29ubmVjdGlv\nbkZhY3RvcnkgPSBjcmVhdGVDb25uZWN0aW9uRmFjdG9yeSgpOwogICAgICAg\nIGNvbm5lY3Rpb24gPSBjcmVhdGVDb25uZWN0aW9uKCFkdXJhYmxlKTsKICAg\nICAgICBpZiAoZHVyYWJsZSkgewogICAgICAgICAgICBjb25uZWN0aW9uLnNl\ndENsaWVudElEKGdldENsYXNzKCkuZ2V0TmFtZSgpKTsKICAgICAgICB9Cgog\nICAgICAgIExPRy5pbmZvKCJDcmVhdGVkIGNvbm5lY3Rpb246ICIgKyBjb25u\nZWN0aW9uKTsKCiAgICAgICAgc2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRl\nU2Vzc2lvbihmYWxzZSwgU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFKTsKCiAg\nICAgICAgTE9HLmluZm8oIkNyZWF0ZWQgc2Vzc2lvbjogIiArIHNlc3Npb24p\nOwoKICAgICAgICBpZiAodG9waWMpIHsKICAgICAgICAgICAgY29uc3VtZXJE\nZXN0aW5hdGlvbiA9IHNlc3Npb24uY3JlYXRlVG9waWMoZ2V0Q29uc3VtZXJT\ndWJqZWN0KCkpOwogICAgICAgICAgICBwcm9kdWNlckRlc3RpbmF0aW9uID0g\nc2Vzc2lvbi5jcmVhdGVUb3BpYyhnZXRQcm9kdWNlclN1YmplY3QoKSk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3VtZXJEZXN0aW5hdGlv\nbiA9IHNlc3Npb24uY3JlYXRlVG9waWMoZ2V0Q29uc3VtZXJTdWJqZWN0KCkp\nOwogICAgICAgICAgICBwcm9kdWNlckRlc3RpbmF0aW9uID0gc2Vzc2lvbi5j\ncmVhdGVUb3BpYyhnZXRQcm9kdWNlclN1YmplY3QoKSk7CiAgICAgICAgfQoK\nICAgICAgICBMT0cuaW5mbygiQ3JlYXRlZCAgY29uc3VtZXIgZGVzdGluYXRp\nb246ICIgKyBjb25zdW1lckRlc3RpbmF0aW9uCiAgICAgICAgICAgICAgICAg\nKyAiIG9mIHR5cGU6ICIgKyBjb25zdW1lckRlc3RpbmF0aW9uLmdldENsYXNz\nKCkpOwogICAgICAgIExPRy5pbmZvKCJDcmVhdGVkICBwcm9kdWNlciBkZXN0\naW5hdGlvbjogIiArIHByb2R1Y2VyRGVzdGluYXRpb24KICAgICAgICAgICAg\nICAgICArICIgb2YgdHlwZTogIiArIHByb2R1Y2VyRGVzdGluYXRpb24uZ2V0\nQ2xhc3MoKSk7CiAgICAgICAgcHJvZHVjZXIgPSBzZXNzaW9uLmNyZWF0ZVBy\nb2R1Y2VyKHByb2R1Y2VyRGVzdGluYXRpb24pOwogICAgICAgIHByb2R1Y2Vy\nLnNldERlbGl2ZXJ5TW9kZShkZWxpdmVyeU1vZGUpOwoKICAgICAgICBMT0cu\naW5mbygiQ3JlYXRlZCBwcm9kdWNlcjogIiArIHByb2R1Y2VyICsgIiBkZWxp\ndmVyeSBtb2RlID0gIgogICAgICAgICAgICAgICAgICsgKGRlbGl2ZXJ5TW9k\nZSA9PSBEZWxpdmVyeU1vZGUuUEVSU0lTVEVOVCA/ICJQRVJTSVNURU5UIiA6\nICJOT05fUEVSU0lTVEVOVCIpKTsKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0\nKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBzZXNzaW9uLmNsb3NlKCk7CiAgICAgICAg\nY29ubmVjdGlvbi5jbG9zZSgpOwogICAgICAgIHN1cGVyLnRlYXJEb3duKCk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIE1lc3NhZ2VDb25zdW1lciBjcmVhdGVD\nb25zdW1lcihTdHJpbmcgc2VsZWN0b3IpIHRocm93cyBKTVNFeGNlcHRpb24g\newogICAgICAgIGlmIChkdXJhYmxlKSB7CiAgICAgICAgICAgIExPRy5pbmZv\nKCJDcmVhdGluZyBkdXJhYmxlIGNvbnN1bWVyIik7CiAgICAgICAgICAgIHJl\ndHVybiBzZXNzaW9uLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKChUb3BpYylj\nb25zdW1lckRlc3RpbmF0aW9uLCBnZXROYW1lKCksIHNlbGVjdG9yLCBmYWxz\nZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBzZXNzaW9uLmNyZWF0ZUNv\nbnN1bWVyKGNvbnN1bWVyRGVzdGluYXRpb24sIHNlbGVjdG9yKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBzZW5kTWVzc2FnZXMoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBUZXh0TWVzc2FnZSBtZXNzYWdlID0gc2Vzc2lvbi5j\ncmVhdGVUZXh0TWVzc2FnZSgiMSIpOwogICAgICAgIG1lc3NhZ2Uuc2V0SW50\nUHJvcGVydHkoImlkIiwgMSk7CiAgICAgICAgbWVzc2FnZS5zZXRKTVNUeXBl\nKCJhIik7CiAgICAgICAgbWVzc2FnZS5zZXRTdHJpbmdQcm9wZXJ0eSgic3Ry\naW5nUHJvcGVydHkiLCAiYSIpOwogICAgICAgIG1lc3NhZ2Uuc2V0TG9uZ1By\nb3BlcnR5KCJsb25nUHJvcGVydHkiLCAxKTsKICAgICAgICBtZXNzYWdlLnNl\ndEJvb2xlYW5Qcm9wZXJ0eSgiYm9vbGVhblByb3BlcnR5IiwgdHJ1ZSk7CiAg\nICAgICAgcHJvZHVjZXIuc2VuZChtZXNzYWdlKTsKCiAgICAgICAgbWVzc2Fn\nZSA9IHNlc3Npb24uY3JlYXRlVGV4dE1lc3NhZ2UoIjIiKTsKICAgICAgICBt\nZXNzYWdlLnNldEludFByb3BlcnR5KCJpZCIsIDIpOwogICAgICAgIG1lc3Nh\nZ2Uuc2V0Sk1TVHlwZSgiYSIpOwogICAgICAgIG1lc3NhZ2Uuc2V0U3RyaW5n\nUHJvcGVydHkoInN0cmluZ1Byb3BlcnR5IiwgImEiKTsKICAgICAgICBtZXNz\nYWdlLnNldExvbmdQcm9wZXJ0eSgibG9uZ1Byb3BlcnR5IiwgMSk7CiAgICAg\nICAgbWVzc2FnZS5zZXRCb29sZWFuUHJvcGVydHkoImJvb2xlYW5Qcm9wZXJ0\neSIsIGZhbHNlKTsKICAgICAgICBwcm9kdWNlci5zZW5kKG1lc3NhZ2UpOwoK\nICAgICAgICBtZXNzYWdlID0gc2Vzc2lvbi5jcmVhdGVUZXh0TWVzc2FnZSgi\nMyIpOwogICAgICAgIG1lc3NhZ2Uuc2V0SW50UHJvcGVydHkoImlkIiwgMyk7\nCiAgICAgICAgbWVzc2FnZS5zZXRKTVNUeXBlKCJhIik7CiAgICAgICAgbWVz\nc2FnZS5zZXRTdHJpbmdQcm9wZXJ0eSgic3RyaW5nUHJvcGVydHkiLCAiYSIp\nOwogICAgICAgIG1lc3NhZ2Uuc2V0TG9uZ1Byb3BlcnR5KCJsb25nUHJvcGVy\ndHkiLCAxKTsKICAgICAgICBtZXNzYWdlLnNldEJvb2xlYW5Qcm9wZXJ0eSgi\nYm9vbGVhblByb3BlcnR5IiwgdHJ1ZSk7CiAgICAgICAgcHJvZHVjZXIuc2Vu\nZChtZXNzYWdlKTsKCiAgICAgICAgbWVzc2FnZSA9IHNlc3Npb24uY3JlYXRl\nVGV4dE1lc3NhZ2UoIjQiKTsKICAgICAgICBtZXNzYWdlLnNldEludFByb3Bl\ncnR5KCJpZCIsIDQpOwogICAgICAgIG1lc3NhZ2Uuc2V0Sk1TVHlwZSgiYiIp\nOwogICAgICAgIG1lc3NhZ2Uuc2V0U3RyaW5nUHJvcGVydHkoInN0cmluZ1By\nb3BlcnR5IiwgImIiKTsKICAgICAgICBtZXNzYWdlLnNldExvbmdQcm9wZXJ0\neSgibG9uZ1Byb3BlcnR5IiwgMik7CiAgICAgICAgbWVzc2FnZS5zZXRCb29s\nZWFuUHJvcGVydHkoImJvb2xlYW5Qcm9wZXJ0eSIsIGZhbHNlKTsKICAgICAg\nICBwcm9kdWNlci5zZW5kKG1lc3NhZ2UpOwoKICAgICAgICBtZXNzYWdlID0g\nc2Vzc2lvbi5jcmVhdGVUZXh0TWVzc2FnZSgiNSIpOwogICAgICAgIG1lc3Nh\nZ2Uuc2V0SW50UHJvcGVydHkoImlkIiwgNSk7CiAgICAgICAgbWVzc2FnZS5z\nZXRKTVNUeXBlKCJjIik7CiAgICAgICAgbWVzc2FnZS5zZXRTdHJpbmdQcm9w\nZXJ0eSgic3RyaW5nUHJvcGVydHkiLCAiYyIpOwogICAgICAgIG1lc3NhZ2Uu\nc2V0TG9uZ1Byb3BlcnR5KCJsb25nUHJvcGVydHkiLCAzKTsKICAgICAgICBt\nZXNzYWdlLnNldEJvb2xlYW5Qcm9wZXJ0eSgiYm9vbGVhblByb3BlcnR5Iiwg\ndHJ1ZSk7CiAgICAgICAgcHJvZHVjZXIuc2VuZChtZXNzYWdlKTsKICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBjb25zdW1lTWVzc2FnZXMoaW50IHJlbWFpbmlu\nZykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgY29uc3VtZXIgPSBjcmVh\ndGVDb25zdW1lcihudWxsKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIHJlbWFpbmluZzsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN1bWVyLnJlY2Vp\ndmUoMTAwMCk7CiAgICAgICAgfQogICAgICAgIGNvbnN1bWVyLmNsb3NlKCk7\nCgogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RFbXB0eVByb3BlcnR5U2Vs\nZWN0b3IoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgcmVtYWlu\naW5nID0gNTsKICAgICAgICBNZXNzYWdlIG1lc3NhZ2UgPSBudWxsOwogICAg\nICAgIGNvbnN1bWVyID0gY3JlYXRlQ29uc3VtZXIoIiIpOwogICAgICAgIHNl\nbmRNZXNzYWdlcygpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAg\nICAgIG1lc3NhZ2UgPSBjb25zdW1lci5yZWNlaXZlKDEwMDApOwogICAgICAg\nICAgICBpZiAobWVzc2FnZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmVtYWluaW5nLS07\nCiAgICAgICAgfQogICAgICAgIGFzc2VydEVxdWFscyhyZW1haW5pbmcsIDAp\nOwogICAgICAgIGNvbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgY29uc3VtZU1l\nc3NhZ2VzKHJlbWFpbmluZyk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVz\ndFByb3BlcnR5U2VsZWN0b3IoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBpbnQgcmVtYWluaW5nID0gNTsKICAgICAgICBNZXNzYWdlIG1lc3NhZ2Ug\nPSBudWxsOwogICAgICAgIGNvbnN1bWVyID0gY3JlYXRlQ29uc3VtZXIoInN0\ncmluZ1Byb3BlcnR5ID0gJ2EnIGFuZCBsb25nUHJvcGVydHkgPSAxIGFuZCBi\nb29sZWFuUHJvcGVydHkgPSB0cnVlIik7CiAgICAgICAgc2VuZE1lc3NhZ2Vz\nKCk7CiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgbWVzc2Fn\nZSA9IGNvbnN1bWVyLnJlY2VpdmUoMTAwMCk7CiAgICAgICAgICAgIGlmICht\nZXNzYWdlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIFN0cmluZyB0ZXh0ID0gKChUZXh0TWVz\nc2FnZSltZXNzYWdlKS5nZXRUZXh0KCk7CiAgICAgICAgICAgIGlmICghdGV4\ndC5lcXVhbHMoIjEiKSAmJiAhdGV4dC5lcXVhbHMoIjMiKSkgewogICAgICAg\nICAgICAgICAgZmFpbCgidW5leHBlY3RlZCBtZXNzYWdlOiAiICsgdGV4dCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVtYWluaW5nLS07CiAgICAg\nICAgfQogICAgICAgIGFzc2VydEVxdWFscyhyZW1haW5pbmcsIDMpOwogICAg\nICAgIGNvbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgY29uc3VtZU1lc3NhZ2Vz\nKHJlbWFpbmluZyk7CgogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RKTVNQ\ncm9wZXJ0eVNlbGVjdG9yKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\naW50IHJlbWFpbmluZyA9IDU7CiAgICAgICAgTWVzc2FnZSBtZXNzYWdlID0g\nbnVsbDsKICAgICAgICBjb25zdW1lciA9IGNyZWF0ZUNvbnN1bWVyKCJKTVNU\neXBlID0gJ2EnIGFuZCBzdHJpbmdQcm9wZXJ0eSA9ICdhJyIpOwogICAgICAg\nIHNlbmRNZXNzYWdlcygpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAg\nICAgICAgIG1lc3NhZ2UgPSBjb25zdW1lci5yZWNlaXZlKDEwMDApOwogICAg\nICAgICAgICBpZiAobWVzc2FnZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBTdHJpbmcgdGV4\ndCA9ICgoVGV4dE1lc3NhZ2UpbWVzc2FnZSkuZ2V0VGV4dCgpOwogICAgICAg\nICAgICBpZiAoIXRleHQuZXF1YWxzKCIxIikgJiYgIXRleHQuZXF1YWxzKCIy\nIikgJiYgIXRleHQuZXF1YWxzKCIzIikpIHsKICAgICAgICAgICAgICAgIGZh\naWwoInVuZXhwZWN0ZWQgbWVzc2FnZTogIiArIHRleHQpOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIHJlbWFpbmluZy0tOwogICAgICAgIH0KICAgICAg\nICBhc3NlcnRFcXVhbHMocmVtYWluaW5nLCAyKTsKICAgICAgICBjb25zdW1l\nci5jbG9zZSgpOwogICAgICAgIGNvbnN1bWVNZXNzYWdlcyhyZW1haW5pbmcp\nOwoKICAgIH0KCn0K\n","encoding":"base64"}

