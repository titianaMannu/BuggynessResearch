{"sha":"735d701ebbbd39d3eebec7ab25188415a81f76b5","node_id":"MDQ6QmxvYjE1NzU5NTY6NzM1ZDcwMWViYmJkMzlkM2VlYmVjN2FiMjUxODg0MTVhODFmNzZiNQ==","size":6701,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/735d701ebbbd39d3eebec7ab25188415a81f76b5","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFja2Fn\nZSBvcmcuYXBhY2hlLmFjdGl2ZW1xOwoKaW1wb3J0IGphdmF4Lmptcy5Ub3Bp\nYzsKCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5KbXNUZXN0QmFzZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmptcy5TZXNzaW9uSW1wbDsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5qbXMuc3BpLkhlZHdpZ0Nvbm5lY3Rpb25GYWN0b3J5SW1wbDsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBq\nYXZheC5qbXMuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmF4Lmptcy5EZWxpdmVy\neU1vZGU7CmltcG9ydCBqYXZheC5qbXMuRGVzdGluYXRpb247CmltcG9ydCBq\nYXZheC5qbXMuSk1TRXhjZXB0aW9uOwppbXBvcnQgamF2YXguam1zLk1lc3Nh\nZ2U7CmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZUNvbnN1bWVyOwppbXBvcnQg\namF2YXguam1zLk1lc3NhZ2VMaXN0ZW5lcjsKaW1wb3J0IGphdmF4Lmptcy5N\nZXNzYWdlUHJvZHVjZXI7CmltcG9ydCBqYXZheC5qbXMuU2Vzc2lvbjsKaW1w\nb3J0IGphdmF4Lmptcy5UZXh0TWVzc2FnZTsKCmltcG9ydCBqdW5pdC5mcmFt\nZXdvcmsuVGVzdENhc2U7CgppbXBvcnQgamF2YXguam1zLkRlc3RpbmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuam1zLm1lc3NhZ2UuTWVzc2Fn\nZUltcGw7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXJGYWN0b3J5OwoKcHVibGljIGNsYXNzIE1lc3NhZ2VMaXN0\nZW5lclJlZGVsaXZlcnlUZXN0IGV4dGVuZHMgSm1zVGVzdEJhc2UgewoKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0\nb3J5LmdldExvZ2dlcihNZXNzYWdlTGlzdGVuZXJSZWRlbGl2ZXJ5VGVzdC5j\nbGFzcyk7CgogICAgcHJpdmF0ZSBDb25uZWN0aW9uIGNvbm5lY3Rpb247Cgog\nICAgcHJvdGVjdGVkIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBzdXBlci5zZXRVcCgpOwogICAgICAgIGNvbm5lY3Rpb24gPSBj\ncmVhdGVDb25uZWN0aW9uKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBAc2Vl\nIGp1bml0LmZyYW1ld29yay5UZXN0Q2FzZSN0ZWFyRG93bigpCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgaWYgKGNvbm5lY3Rpb24gIT0gbnVsbCkgewogICAgICAg\nICAgICBjb25uZWN0aW9uLmNsb3NlKCk7CiAgICAgICAgICAgIGNvbm5lY3Rp\nb24gPSBudWxsOwogICAgICAgIH0KICAgICAgICBzdXBlci50ZWFyRG93bigp\nOwogICAgfQoKICAgIHByb3RlY3RlZCBDb25uZWN0aW9uIGNyZWF0ZUNvbm5l\nY3Rpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBIZWR3aWdDb25u\nZWN0aW9uRmFjdG9yeUltcGwgZmFjdG9yeSA9IG5ldyBIZWR3aWdDb25uZWN0\naW9uRmFjdG9yeUltcGwoKTsKICAgICAgICByZXR1cm4gZmFjdG9yeS5jcmVh\ndGVDb25uZWN0aW9uKCk7CiAgICB9CgogICAgcHJpdmF0ZSBjbGFzcyBUZXN0\nTWVzc2FnZUxpc3RlbmVyIGltcGxlbWVudHMgTWVzc2FnZUxpc3RlbmVyIHsK\nCiAgICAgICAgcHVibGljIGludCBjb3VudGVyID0gMDsKICAgICAgICBwcml2\nYXRlIFNlc3Npb24gc2Vzc2lvbjsKICAgICAgICBzdGF0aWMgZmluYWwgaW50\nIFJPTExCQUNLX0NPVU5UID0gNTsKCiAgICAgICAgcHVibGljIFRlc3RNZXNz\nYWdlTGlzdGVuZXIoU2Vzc2lvbiBzZXNzaW9uKSB7CiAgICAgICAgICAgIHRo\naXMuc2Vzc2lvbiA9IHNlc3Npb247CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgdm9pZCBvbk1lc3NhZ2UoTWVzc2FnZSBtZXNzYWdlKSB7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiTWVzc2FnZSBS\nZWNlaXZlZDogIiArIG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgY291bnRl\ncisrOwogICAgICAgICAgICAgICAgaWYgKGNvdW50ZXIgPCBST0xMQkFDS19D\nT1VOVCkgewogICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJNZXNzYWdl\nIFJvbGxiYWNrLiIpOwogICAgICAgICAgICAgICAgICAgIHNlc3Npb24ucm9s\nbGJhY2soKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgTE9HLmluZm8oIk1lc3NhZ2UgQ29tbWl0LiIpOwogICAgICAg\nICAgICAgICAgICAgIG1lc3NhZ2UuYWNrbm93bGVkZ2UoKTsKICAgICAgICAg\nICAgICAgICAgICBzZXNzaW9uLmNvbW1pdCgpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciB3aGVuIHJvbGxpbmcgYmFj\nayB0cmFuc2FjdGlvbiIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RUb3BpY1JvbGxiYWNrQ29uc3VtZXJM\naXN0ZW5lcigpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIGNvbm5l\nY3Rpb24uc3RhcnQoKTsKCiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29u\nbmVjdGlvbi5jcmVhdGVTZXNzaW9uKHRydWUsIFNlc3Npb24uQ0xJRU5UX0FD\nS05PV0xFREdFKTsKICAgICAgICBUb3BpYyBxdWV1ZSA9IHNlc3Npb24uY3Jl\nYXRlVG9waWMoInF1ZXVlLSIgKyBnZXROYW1lKCkpOwogICAgICAgIE1lc3Nh\nZ2VQcm9kdWNlciBwcm9kdWNlciA9IGNyZWF0ZVByb2R1Y2VyKHNlc3Npb24s\nIHF1ZXVlKTsKICAgICAgICBNZXNzYWdlIG1lc3NhZ2UgPSBjcmVhdGVUZXh0\nTWVzc2FnZShzZXNzaW9uKTsKICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29u\nc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1bWVyKHF1ZXVlKTsKICAgICAg\nICBUZXN0TWVzc2FnZUxpc3RlbmVyIGxpc3RlbmVyID0gbmV3IFRlc3RNZXNz\nYWdlTGlzdGVuZXIoc2Vzc2lvbik7CiAgICAgICAgY29uc3VtZXIuc2V0TWVz\nc2FnZUxpc3RlbmVyKGxpc3RlbmVyKTsKICAgICAgICBwcm9kdWNlci5zZW5k\nKG1lc3NhZ2UpOwogICAgICAgIHNlc3Npb24uY29tbWl0KCk7CgoKICAgICAg\nICBNZXNzYWdlQ29uc3VtZXIgbWMgPSAoTWVzc2FnZUNvbnN1bWVyKWNvbnN1\nbWVyOwoKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgVGhyZWFkLnNsZWVw\nKDUwMCk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24g\nZSkgewoKICAgICAgICB9CgogICAgICAgIGFzc2VydEVxdWFscyhUZXN0TWVz\nc2FnZUxpc3RlbmVyLlJPTExCQUNLX0NPVU5ULCBsaXN0ZW5lci5jb3VudGVy\nKTsKCiAgICAgICAgc2Vzc2lvbi5jbG9zZSgpOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RUb3BpY1Nlc3Npb25MaXN0ZW5lckV4Y2VwdGlvblJldHJ5\nKCkgdGhyb3dzICBFeGNlcHRpb24gewogICAgICAgIGNvbm5lY3Rpb24uc3Rh\ncnQoKTsKCiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5j\ncmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNzaW9uLkFVVE9fQUNLTk9XTEVER0Up\nOwogICAgICAgIFRvcGljIHF1ZXVlID0gc2Vzc2lvbi5jcmVhdGVUb3BpYygi\ncXVldWUtIiArIGdldE5hbWUoKSk7CiAgICAgICAgTWVzc2FnZSBtZXNzYWdl\nID0gY3JlYXRlVGV4dE1lc3NhZ2Uoc2Vzc2lvbiwgIjEiKTsKICAgICAgICBN\nZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBzZXNzaW9uLmNyZWF0ZUNvbnN1\nbWVyKHF1ZXVlKTsKCiAgICAgICAgZmluYWwgaW50IG1heERlbGl2ZXJpZXMg\nPSAyOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGdvdE1lc3NhZ2Ug\nPSBuZXcgQ291bnREb3duTGF0Y2goMik7CiAgICAgICAgZmluYWwgQXRvbWlj\nSW50ZWdlciBjb3VudCAgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAgICAg\nICBmaW5hbCBBcnJheUxpc3Q8U3RyaW5nPiByZWNlaXZlZCA9IG5ldyBBcnJh\neUxpc3Q8U3RyaW5nPigpOwogICAgICAgIGNvbnN1bWVyLnNldE1lc3NhZ2VM\naXN0ZW5lcihuZXcgTWVzc2FnZUxpc3RlbmVyKCkgewogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBvbk1lc3NhZ2UoTWVzc2FnZSBtZXNzYWdlKSB7CiAgICAg\nICAgICAgICAgICBMT0cuaW5mbygiTWVzc2FnZSBSZWNlaXZlZDogIiArIG1l\nc3NhZ2UpOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICByZWNlaXZlZC5hZGQoKChUZXh0TWVzc2FnZSkgbWVzc2FnZSkuZ2V0\nVGV4dCgpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEpNU0V4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2Uo\nKTsKICAgICAgICAgICAgICAgICAgICBmYWlsKGUudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoY291bnQuaW5j\ncmVtZW50QW5kR2V0KCkgPCBtYXhEZWxpdmVyaWVzKSB7CiAgICAgICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZ2V0TmFtZSgp\nICsgIiBmb3JjZSBhIHJlZGVsaXZlcnkiKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIC8vIG5ldyBibG9vZAogICAgICAgICAgICAgICAg\nY291bnQuc2V0KDApOwogICAgICAgICAgICAgICAgZ290TWVzc2FnZS5jb3Vu\ndERvd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBN\nZXNzYWdlUHJvZHVjZXIgcHJvZHVjZXIgPSBjcmVhdGVQcm9kdWNlcihzZXNz\naW9uLCBxdWV1ZSk7CiAgICAgICAgcHJvZHVjZXIuc2VuZChtZXNzYWdlKTsK\nICAgICAgICBtZXNzYWdlID0gY3JlYXRlVGV4dE1lc3NhZ2Uoc2Vzc2lvbiwg\nIjIiKTsKICAgICAgICBwcm9kdWNlci5zZW5kKG1lc3NhZ2UpOwoKICAgICAg\nICBhc3NlcnRUcnVlKCJnb3QgbWVzc2FnZSBiZWZvcmUgcmV0cnkgZXhwaXJ5\nIiwgZ290TWVzc2FnZS5hd2FpdCgyMCwgVGltZVVuaXQuU0VDT05EUykpOwoK\nICAgICAgICBmb3IgKGludCBpPTA7IGk8bWF4RGVsaXZlcmllczsgaSsrKSB7\nCiAgICAgICAgICAgIGFzc2VydEVxdWFscygiZ290IGZpcnN0IHJlZGVsaXZl\ncmVkOiAiICsgaSwgIjEiLCByZWNlaXZlZC5nZXQoaSkpOwogICAgICAgIH0K\nICAgICAgICBmb3IgKGludCBpPW1heERlbGl2ZXJpZXM7IGk8bWF4RGVsaXZl\ncmllcyoyOyBpKyspIHsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJnb3Qg\nZmlyc3QgcmVkZWxpdmVyZWQ6ICIgKyBpLCAiMiIsIHJlY2VpdmVkLmdldChp\nKSk7CiAgICAgICAgfQogICAgICAgIHNlc3Npb24uY2xvc2UoKTsKICAgIH0K\nCiAgICBwcml2YXRlIFRleHRNZXNzYWdlIGNyZWF0ZVRleHRNZXNzYWdlKFNl\nc3Npb24gc2Vzc2lvbiwgU3RyaW5nIHRleHQpIHRocm93cyBKTVNFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBzZXNzaW9uLmNyZWF0ZVRleHRNZXNzYWdl\nKHRleHQpOwogICAgfQogICAgcHJpdmF0ZSBUZXh0TWVzc2FnZSBjcmVhdGVU\nZXh0TWVzc2FnZShTZXNzaW9uIHNlc3Npb24pIHRocm93cyBKTVNFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBzZXNzaW9uLmNyZWF0ZVRleHRNZXNzYWdl\nKCJIZWxsbyIpOwogICAgfQoKICAgIHByaXZhdGUgTWVzc2FnZVByb2R1Y2Vy\nIGNyZWF0ZVByb2R1Y2VyKFNlc3Npb24gc2Vzc2lvbiwgRGVzdGluYXRpb24g\ncXVldWUpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIE1lc3NhZ2VQ\ncm9kdWNlciBwcm9kdWNlciA9IHNlc3Npb24uY3JlYXRlUHJvZHVjZXIocXVl\ndWUpOwogICAgICAgIHByb2R1Y2VyLnNldERlbGl2ZXJ5TW9kZShnZXREZWxp\ndmVyeU1vZGUoKSk7CiAgICAgICAgcmV0dXJuIHByb2R1Y2VyOwogICAgfQoK\nICAgIHByb3RlY3RlZCBpbnQgZ2V0RGVsaXZlcnlNb2RlKCkgewogICAgICAg\nIHJldHVybiBEZWxpdmVyeU1vZGUuUEVSU0lTVEVOVDsKICAgIH0KfQo=\n","encoding":"base64"}

