{"sha":"8959de26fe156dff0e393a7405c37d608d9ab331","node_id":"MDQ6QmxvYjE1NzU5NTY6ODk1OWRlMjZmZTE1NmRmZjBlMzkzYTc0MDVjMzdkNjA4ZDlhYjMzMQ==","size":7057,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8959de26fe156dff0e393a7405c37d608d9ab331","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFja2Fn\nZSBvcmcuYXBhY2hlLmFjdGl2ZW1xLnBlcmY7CgppbXBvcnQgamF2YXguam1z\nLkNvbm5lY3Rpb247CmltcG9ydCBqYXZheC5qbXMuRGVsaXZlcnlNb2RlOwpp\nbXBvcnQgamF2YXguam1zLkRlc3RpbmF0aW9uOwppbXBvcnQgamF2YXguam1z\nLk1lc3NhZ2U7CmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZUNvbnN1bWVyOwpp\nbXBvcnQgamF2YXguam1zLk1lc3NhZ2VQcm9kdWNlcjsKaW1wb3J0IGphdmF4\nLmptcy5TZXNzaW9uOwppbXBvcnQgamF2YXguam1zLlRleHRNZXNzYWdlOwpp\nbXBvcnQgamF2YXguam1zLlRvcGljOwoKaW1wb3J0IGp1bml0LmZyYW1ld29y\nay5UZXN0Q2FzZTsKaW1wb3J0IGp1bml0LnRleHR1aS5UZXN0UnVubmVyOwoK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLkptc1Rlc3RCYXNlOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuam1zLnNwaS5IZWR3aWdDb25uZWN0aW9uRmFj\ndG9yeUltcGw7CgoKaW1wb3J0IG9yZy5qdW5pdC5JZ25vcmU7CmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rv\ncnk7CgoKLy8gRm9yIG5vdywgaWdub3JlIGl0IC4uLgpASWdub3JlCnB1Ymxp\nYyBjbGFzcyBOZXR3b3JrZWRTeW5jVGVzdCBleHRlbmRzIEptc1Rlc3RCYXNl\nIHsKCiAgICAvLyBjb25zdGFudHMKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\naW50IE1FU1NBR0VfQ09VTlQgPSAxMDAwMDsgLy8xMDAwMDA7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5n\nZXRMb2dnZXIoTmV0d29ya2VkU3luY1Rlc3QuY2xhc3MpOwogICAgLyoqCiAg\nICAgKiBAcGFyYW0gbmFtZQogICAgICovCiAgICBwdWJsaWMgTmV0d29ya2Vk\nU3luY1Rlc3QoU3RyaW5nIG5hbWUpIHsKICAgICAgICBzdXBlcihuYW1lKTsK\nICAgICAgICBMT0cuaW5mbygiVGVzdGNhc2Ugc3RhcnRlZC4iKTsKICAgIH0K\nCiAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZyBhcmdzW10pIHsK\nICAgICAgIFRlc3RSdW5uZXIucnVuKE5ldHdvcmtlZFN5bmNUZXN0LmNsYXNz\nKTsKICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RNZXNzYWdlRXhjaGFuZ2Uo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMT0cuaW5mbygidGVzdE1l\nc3NhZ2VFeGNoYW5nZSgpIGNhbGxlZC4iKTsKCiAgICAgICAgbG9uZyBzdGFy\ndCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwoKICAgICAgICAvLyBj\ncmVhdGUgcHJvZHVjZXIgYW5kIGNvbnN1bWVyIHRocmVhZHMKICAgICAgICBU\naHJlYWQgcHJvZHVjZXIgPSBuZXcgVGhyZWFkKG5ldyBQcm9kdWNlcigpKTsK\nICAgICAgICBUaHJlYWQgY29uc3VtZXIgPSBuZXcgVGhyZWFkKG5ldyBDb25z\ndW1lcigpKTsKICAgICAgICAvLyBzdGFydCB0aHJlYWRzCiAgICAgICAgY29u\nc3VtZXIuc3RhcnQoKTsKICAgICAgICBUaHJlYWQuc2xlZXAoMjAwMCk7CiAg\nICAgICAgcHJvZHVjZXIuc3RhcnQoKTsKCiAgICAgICAgLy8gd2FpdCBmb3Ig\ndGhyZWFkcyB0byBmaW5pc2gKICAgICAgICBwcm9kdWNlci5qb2luKCk7CiAg\nICAgICAgY29uc3VtZXIuam9pbigpOwogICAgICAgIGxvbmcgZW5kID0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CgogICAgICAgIFN5c3RlbS5vdXQu\ncHJpbnRsbigiRHVyYXRpb246ICIrKGVuZC1zdGFydCkpOwogICAgfQp9Cgov\nKioKICogTWVzc2FnZSBwcm9kdWNlciBydW5uaW5nIGFzIGEgc2VwYXJhdGUg\ndGhyZWFkLCBjb25uZWN0aW5nIHRvIGJyb2tlcjEKICovCmNsYXNzIFByb2R1\nY2VyIGltcGxlbWVudHMgUnVubmFibGUgewoKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihQ\ncm9kdWNlci5jbGFzcyk7CgogICAgLyoqCiAgICAgKiBjb25uZWN0IHRvIGJy\nb2tlciBhbmQgY29uc3RhbnRseSBzZW5kIG1lc3NhZ2VzCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHJ1bigpIHsKCiAgICAgICAgQ29ubmVjdGlvbiBjb25u\nZWN0aW9uID0gbnVsbDsKICAgICAgICBTZXNzaW9uIHNlc3Npb24gPSBudWxs\nOwogICAgICAgIE1lc3NhZ2VQcm9kdWNlciBwcm9kdWNlciA9IG51bGw7Cgog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIEhlZHdpZ0Nvbm5lY3Rpb25GYWN0\nb3J5SW1wbCBhbXEgPSBuZXcgSGVkd2lnQ29ubmVjdGlvbkZhY3RvcnlJbXBs\nKCk7CiAgICAgICAgICAgIGNvbm5lY3Rpb24gPSBhbXEuY3JlYXRlQ29ubmVj\ndGlvbigpOwoKICAgICAgICAgICAgY29ubmVjdGlvbi5zZXRFeGNlcHRpb25M\naXN0ZW5lcihuZXcgamF2YXguam1zLkV4Y2VwdGlvbkxpc3RlbmVyKCkgewog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb25FeGNlcHRpb24oamF2YXgu\nam1zLkpNU0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgZS5w\ncmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSk7CgogICAgICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CiAgICAg\nICAgICAgIHNlc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24oZmFs\nc2UsIFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAgICAgICAgIFRv\ncGljIGRlc3RpbmF0aW9uID0gc2Vzc2lvbi5jcmVhdGVUb3BpYygiVEVTVC5G\nT08iKTsKCiAgICAgICAgICAgIHByb2R1Y2VyID0gc2Vzc2lvbi5jcmVhdGVQ\ncm9kdWNlcihkZXN0aW5hdGlvbik7CiAgICAgICAgICAgIHByb2R1Y2VyLnNl\ndERlbGl2ZXJ5TW9kZShEZWxpdmVyeU1vZGUuUEVSU0lTVEVOVCk7CgogICAg\nICAgICAgICBsb25nIGNvdW50ZXIgPSAwOwoKICAgICAgICAgICAgLy8gQ3Jl\nYXRlIGFuZCBzZW5kIG1lc3NhZ2UKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBOZXR3b3JrZWRTeW5jVGVzdC5NRVNTQUdFX0NPVU5UOyBpKysp\nIHsKCiAgICAgICAgICAgICAgICBTdHJpbmcgdGV4dCA9ICJIZWxsbyB3b3Js\nZCEgRnJvbTogIgogICAgICAgICAgICAgICAgICAgICAgICArIFRocmVhZC5j\ndXJyZW50VGhyZWFkKCkuZ2V0TmFtZSgpICsgIiA6ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgKyB0aGlzLmhhc2hDb2RlKCkgKyAiOiIgKyBjb3VudGVy\nOwogICAgICAgICAgICAgICAgVGV4dE1lc3NhZ2UgbWVzc2FnZSA9IHNlc3Np\nb24uY3JlYXRlVGV4dE1lc3NhZ2UodGV4dCk7CiAgICAgICAgICAgICAgICBw\ncm9kdWNlci5zZW5kKG1lc3NhZ2UpOwogICAgICAgICAgICAgICAgY291bnRl\ncisrOwoKICAgICAgICAgICAgICAgIGlmICgoY291bnRlciAlIDEwMDApID09\nIDApCiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oInNlbnQgIiArIGNv\ndW50ZXIgKyAiIG1lc3NhZ2VzIik7CgogICAgICAgICAgICB9CiAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncihleC50b1N0cmluZygpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0gZmluYWxseSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBpZiAocHJvZHVjZXIgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBw\ncm9kdWNlci5jbG9zZSgpOwogICAgICAgICAgICAgICAgaWYgKHNlc3Npb24g\nIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICBpZiAoY29ubmVjdGlvbiAhPSBudWxsKQogICAg\nICAgICAgICAgICAgICAgIGNvbm5lY3Rpb24uY2xvc2UoKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiUHJvYmxlbSBjbG9zaW5nIGRvd24gSk1TIG9iamVjdHM6ICIg\nKyBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQoKLyoKICog\nTWVzc2FnZSBjb25zdW1lciBydW5uaW5nIGFzIGEgc2VwYXJhdGUgdGhyZWFk\nLCBjb25uZWN0aW5nIHRvIGJyb2tlcjIKICovCmNsYXNzIENvbnN1bWVyIGlt\ncGxlbWVudHMgUnVubmFibGUgewoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihDb25zdW1l\nci5jbGFzcyk7OwoKICAgIC8qKgogICAgICogY29ubmVjdCB0byBicm9rZXIg\nYW5kIHJlY2VpdmUgbWVzc2FnZXMKICAgICAqLwogICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgIENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IG51bGw7\nCiAgICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gbnVsbDsKICAgICAgICBNZXNz\nYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBudWxsOwoKICAgICAgICB0cnkgewog\nICAgICAgICAgICBIZWR3aWdDb25uZWN0aW9uRmFjdG9yeUltcGwgYW1xID0g\nbmV3IEhlZHdpZ0Nvbm5lY3Rpb25GYWN0b3J5SW1wbCgpOwogICAgICAgICAg\nICBjb25uZWN0aW9uID0gYW1xLmNyZWF0ZUNvbm5lY3Rpb24oKTsKICAgICAg\nICAgICAgLy8gbmVlZCB0byBzZXQgY2xpZW50SUQgd2hlbiB1c2luZyBkdXJh\nYmxlIHN1YnNjcmlwdGlvbi4KICAgICAgICAgICAgaWYgKG51bGwgPT0gY29u\nbmVjdGlvbi5nZXRDbGllbnRJRCgpKSBjb25uZWN0aW9uLnNldENsaWVudElE\nKCJ0bWllbGtlIik7CgogICAgICAgICAgICBjb25uZWN0aW9uLnNldEV4Y2Vw\ndGlvbkxpc3RlbmVyKG5ldyBqYXZheC5qbXMuRXhjZXB0aW9uTGlzdGVuZXIo\nKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvbkV4Y2VwdGlvbihq\nYXZheC5qbXMuSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAg\nICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9KTsKCiAgICAgICAgICAgIGNvbm5lY3Rpb24uc3RhcnQoKTsK\nICAgICAgICAgICAgc2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lv\nbihmYWxzZSwgU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFKTsKICAgICAgICAg\nICAgRGVzdGluYXRpb24gZGVzdGluYXRpb24gPSBzZXNzaW9uLmNyZWF0ZVRv\ncGljKCJURVNULkZPTyIpOwogICAgICAgICAgICBjb25zdW1lciA9IHNlc3Np\nb24uY3JlYXRlRHVyYWJsZVN1YnNjcmliZXIoKFRvcGljKSBkZXN0aW5hdGlv\nbiwidG1pZWxrZSIpOwoKICAgICAgICAgICAgbG9uZyBjb3VudGVyID0gMDsK\nICAgICAgICAgICAgLy8gV2FpdCBmb3IgYSBtZXNzYWdlCiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgTmV0d29ya2VkU3luY1Rlc3QuTUVTU0FH\nRV9DT1VOVDsgaSsrKSB7CiAgICAgICAgICAgICAgICBNZXNzYWdlIG1lc3Nh\nZ2UyID0gY29uc3VtZXIucmVjZWl2ZSgpOwogICAgICAgICAgICAgICAgaWYg\nKG1lc3NhZ2UyIGluc3RhbmNlb2YgVGV4dE1lc3NhZ2UpIHsKICAgICAgICAg\nICAgICAgICAgICBUZXh0TWVzc2FnZSB0ZXh0TWVzc2FnZSA9IChUZXh0TWVz\nc2FnZSkgbWVzc2FnZTI7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHRl\neHQgPSB0ZXh0TWVzc2FnZS5nZXRUZXh0KCk7CiAgICAgICAgICAgICAgICAg\nICAgLy8gbG9nZ2VyLmluZm8oIlJlY2VpdmVkOiAiICsgdGV4dCk7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiUmVjZWl2ZWQgbWVzc2FnZSBvZiB1bnN1cHBvcnRlZCB0eXBlLiBF\neHBlY3RpbmcgVGV4dE1lc3NhZ2UuICIrIG1lc3NhZ2UyKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIGNvdW50ZXIrKzsKICAgICAgICAg\nICAgICAgIGlmICgoY291bnRlciAlIDEwMDApID09IDApCiAgICAgICAgICAg\nICAgICAgICAgTE9HLmluZm8oInJlY2VpdmVkICIgKyBjb3VudGVyICsgIiBt\nZXNzYWdlcyIpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBpbiBD\nb25zdW1lcjogIiArIGUpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGlmIChjb25zdW1lciAhPSBudWxsKQogICAgICAgICAgICAgICAgICAgIGNv\nbnN1bWVyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbiAh\nPSBudWxsKQogICAgICAgICAgICAgICAgICAgIHNlc3Npb24uY2xvc2UoKTsK\nICAgICAgICAgICAgICAgIGlmIChjb25uZWN0aW9uICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpOwogICAgICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsKICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiRXJyb3IgY2xvc2luZyBkb3duIEpNUyBvYmplY3RzOiAiICsg\nZXgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

