{"sha":"b14ef718c50552a9ec9ccc5bbbaedd97547e17bb","node_id":"MDQ6QmxvYjE1NzU5NTY6YjE0ZWY3MThjNTA1NTJhOWVjOWNjYzViYmJhZWRkOTc1NDdlMTdiYg==","size":12443,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b14ef718c50552a9ec9ccc5bbbaedd97547e17bb","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFja2Fn\nZSBvcmcuYXBhY2hlLmFjdGl2ZW1xLnVzZWNhc2VzOwoKCmltcG9ydCBqYXZh\neC5qbXMuVG9waWM7CmltcG9ydCBqYXZheC5qbXMuQ29ubmVjdGlvbjsKaW1w\nb3J0IGphdmF4Lmptcy5EZWxpdmVyeU1vZGU7CmltcG9ydCBqYXZheC5qbXMu\nRGVzdGluYXRpb247CmltcG9ydCBqYXZheC5qbXMuSk1TRXhjZXB0aW9uOwpp\nbXBvcnQgamF2YXguam1zLk1lc3NhZ2U7CmltcG9ydCBqYXZheC5qbXMuTWVz\nc2FnZUNvbnN1bWVyOwppbXBvcnQgamF2YXguam1zLk1lc3NhZ2VQcm9kdWNl\ncjsKaW1wb3J0IGphdmF4Lmptcy5TZXNzaW9uOwppbXBvcnQgamF2YXguam1z\nLlRleHRNZXNzYWdlOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmptcy5z\ncGkuSGVkd2lnQ29ubmVjdGlvbkZhY3RvcnlJbXBsOwppbXBvcnQgb3JnLmFw\nYWNoZS5hY3RpdmVtcS5KbXNDb25uZWN0aW9uU3RhcnRTdG9wVGVzdDsKCgoK\nCi8qKgogKiBUZXN0IGNhc2UgaW50ZW5kZWQgdG8gZGVtb25zdHJhdGUgZGVs\naXZlcnkgaW50ZXJydXB0aW9uIHRvIHF1ZXVlIGNvbnN1bWVycyB3aGVuCiAq\nIGEgSk1TIHNlbGVjdG9yIGxlYXZlcyBzb21lIG1lc3NhZ2VzIG9uIHRoZSBx\ndWV1ZSAoZHVlIHRvIHVzZSBvZiBhIEpNUyBTZWxlY3RvcikKICoKICogdGVz\ndE5vbkRpc2NyaW1pbmF0aW5nQ29uc3VtZXIoKSBkZW1vbnN0cmF0ZXMgcHJv\ncGVyIGZ1bmN0aW9uYWxpdHkgZm9yIGNvbnN1bWVycyB0aGF0IGRvbid0IHVz\nZQogKiBhIHNlbGVjdG9yIHRvIHF1YWxpZnkgdGhlaXIgaW5wdXQuCiAqCiAq\nIHRlc3REaXNjcmltaW5hdGluZ0NvbnN1bWVyKCkgZGVtb25zdHJhdGVzIHRo\nZSBmYWlsdXJlIGNvbmRpdGlvbiBpbiB3aGljaCBkZWxpdmVyeSB0byB0aGUg\nY29uc3VtZXIKICogZXZlbnR1YWxseSBoYWx0cy4KICoKICogVGhlIGV4cGVj\ndGVkIGJlaGF2aW9yIGlzIGZvciB0aGUgZGVsaXZlcnkgdG8gdGhlIGNsaWVu\ndCB0byBiZSBtYWludGFpbmVkIHJlZ2FyZGxlc3Mgb2YgdGhlIGRlcHRoCiAq\nIG9mIHRoZSBxdWV1ZSwgcGFydGljdWxhcmx5IHdoZW4gdGhlIG1lc3NhZ2Vz\nIGluIHRoZSBxdWV1ZSBkbyBub3QgbWVldCB0aGUgc2VsZWN0b3IgY3JpdGVy\naWEgb2YgdGhlCiAqIGNsaWVudC4KICoKICogaHR0cHM6Ly9pc3N1ZXMuYXBh\nY2hlLm9yZy9hY3RpdmVtcS9icm93c2UvQU1RLTIyMTcKICoKICovCnB1Ymxp\nYyBjbGFzcyBEaXNjcmltaW5hdGluZ0NvbnN1bWVyTG9hZFRlc3QgZXh0ZW5k\ncyBUZXN0U3VwcG9ydCB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgb3Jn\nLmFwYWNoZS5jb21tb25zLmxvZ2dpbmcuTG9nIExPRyA9IG9yZy5hcGFjaGUu\nY29tbW9ucy5sb2dnaW5nLkxvZ0ZhY3RvcnkKICAgICAgICAuZ2V0TG9nKERp\nc2NyaW1pbmF0aW5nQ29uc3VtZXJMb2FkVGVzdC5jbGFzcyk7CgogICAgcHJp\ndmF0ZSBDb25uZWN0aW9uIHByb2R1Y2VyQ29ubmVjdGlvbjsKICAgIHByaXZh\ndGUgQ29ubmVjdGlvbiBjb25zdW1lckNvbm5lY3Rpb247CiAgICBwcml2YXRl\nIGludCBjb3VudGVyU2VudCA9IDA7CiAgICBwcml2YXRlIGludCBjb3VudGVy\nUmVjZWl2ZWQgPSAwOwoKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgU3RyaW5n\nIEpNU1RZUEVfRUFUTUUgID0gIkRpc2NyaW1pbmF0aW5nTG9hZENsaWVudC5F\nYXRNZSI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBKTVNUWVBF\nX0lHTk9SRU1FID0gIkRpc2NyaW1pbmF0aW5nTG9hZENsaWVudC5JZ25vcmVN\nZSI7CgogICAgcHJpdmF0ZSBpbnQgdGVzdFNpemUgPSA1MDAwOyAvLyBzZXR0\naW5nIHRoaXMgdG8gYSBzbWFsbCBudW1iZXIgd2lsbCBwYXNzIGFsbCB0ZXN0\ncwoKCiAgICBwcm90ZWN0ZWQgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgdGhpcy5wcm9k\ndWNlckNvbm5lY3Rpb24gPSB0aGlzLmNyZWF0ZUNvbm5lY3Rpb24oKTsKICAg\nICAgICB0aGlzLmNvbnN1bWVyQ29ubmVjdGlvbiA9IHRoaXMuY3JlYXRlQ29u\nbmVjdGlvbigpOwogICAgfQoKICAgIC8qKgogICAgICogQHNlZSBqdW5pdC5m\ncmFtZXdvcmsuVGVzdENhc2UjdGVhckRvd24oKQogICAgICovCiAgICBwcm90\nZWN0ZWQgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGlmIChwcm9kdWNlckNvbm5lY3Rpb24gIT0gbnVsbCkgewogICAgICAg\nICAgICBwcm9kdWNlckNvbm5lY3Rpb24uY2xvc2UoKTsKICAgICAgICAgICAg\ncHJvZHVjZXJDb25uZWN0aW9uID0gbnVsbDsKICAgICAgICB9CiAgICAgICAg\naWYgKGNvbnN1bWVyQ29ubmVjdGlvbiAhPSBudWxsKSB7CiAgICAgICAgICAg\nIGNvbnN1bWVyQ29ubmVjdGlvbi5jbG9zZSgpOwogICAgICAgICAgICBjb25z\ndW1lckNvbm5lY3Rpb24gPSBudWxsOwogICAgICAgIH0KICAgICAgICBzdXBl\nci50ZWFyRG93bigpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0byBj\naGVjayBpZiBhIHNpbmdsZSBjb25zdW1lciB3aXRoIG5vIEpNUyBzZWxlY3Rv\nciB3aWxsIHJlY2VpdmUgYWxsIGludGVuZGVkIG1lc3NhZ2VzCiAgICAgKgog\nICAgICogQHRocm93cyBqYXZhLmxhbmcuRXhjZXB0aW9uCiAgICAgKi8KICAg\nIHB1YmxpYyB2b2lkIHRlc3ROb25EaXNjcmltaW5hdGluZ0NvbnN1bWVyKCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgY29uc3VtZXJDb25uZWN0aW9u\nID0gY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgIGNvbnN1bWVyQ29ubmVj\ndGlvbi5zdGFydCgpOwogICAgICAgIExPRy5pbmZvKCJjb25zdW1lckNvbm5l\nY3Rpb24gPSAiICtjb25zdW1lckNvbm5lY3Rpb24pOwoKICAgICAgICB0cnkg\ne1RocmVhZC5zbGVlcCgxMDAwKTsgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHt9\nCgogICAgICAgIC8vIGhlcmUgd2UgcGFzcyBpbiBudWxsIGZvciB0aGUgSk1T\nIHNlbGVjdG9yCiAgICAgICAgQ29uc3VtZXIgY29uc3VtZXIgPSBuZXcgQ29u\nc3VtZXIoY29uc3VtZXJDb25uZWN0aW9uLCBudWxsKTsKICAgICAgICBUaHJl\nYWQgY29uc3VtZXJUaHJlYWQgPSBuZXcgVGhyZWFkKGNvbnN1bWVyKTsKCiAg\nICAgICAgY29uc3VtZXJUaHJlYWQuc3RhcnQoKTsKCiAgICAgICAgcHJvZHVj\nZXJDb25uZWN0aW9uID0gY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgIHBy\nb2R1Y2VyQ29ubmVjdGlvbi5zdGFydCgpOwogICAgICAgIExPRy5pbmZvKCJw\ncm9kdWNlckNvbm5lY3Rpb24gPSAiICtwcm9kdWNlckNvbm5lY3Rpb24pOwoK\nICAgICAgICB0cnkge1RocmVhZC5zbGVlcCgzMDAwKTsgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHt9CgogICAgICAgIFByb2R1Y2VyIHByb2R1Y2VyID0gbmV3\nIFByb2R1Y2VyKHByb2R1Y2VyQ29ubmVjdGlvbik7CiAgICAgICAgVGhyZWFk\nIHByb2R1Y2VyVGhyZWFkID0gbmV3IFRocmVhZChwcm9kdWNlcik7CiAgICAg\nICAgcHJvZHVjZXJUaHJlYWQuc3RhcnQoKTsKCiAgICAgICAgLy8gbm93IHRo\nYXQgZXZlcnl0aGluZyBpcyBydW5uaW5nLCBsZXQncyB3YWl0IGZvciB0aGUg\nY29uc3VtZXIgdGhyZWFkIHRvIGZpbmlzaCAuLi4KICAgICAgICBjb25zdW1l\nclRocmVhZC5qb2luKCk7CiAgICAgICAgcHJvZHVjZXIuc3RvcCA9IHRydWU7\nCgogICAgICAgIGlmIChjb25zdW1lci5nZXRDb3VudCgpID09IHRlc3RTaXpl\nICkKICAgICAgICAgICAgTE9HLmluZm8oInRlc3QgY29tcGxldGUgLi4uLiBh\nbGwgbWVzc3NhZ2VzIGNvbnN1bWVkISEiKTsKICAgICAgICBlbHNlCiAgICAg\nICAgICAgIExPRy5pbmZvKCJ0ZXN0IGZhaWxlZCAuLi4uIFNlbnQgIiArICh0\nZXN0U2l6ZSAvIDEpICsKICAgICAgICAgICAgICAgICAgICAgIiBtZXNzYWdl\ncyBpbnRlbmRlZCB0byBiZSBjb25zdW1lZCAoICIgKyB0ZXN0U2l6ZQogICAg\nICAgICAgICAgICAgICAgICArICIgdG90YWwpLCBidXQgb25seSBjb25zdW1l\nZCAiICsgY29uc3VtZXIuZ2V0Q291bnQoKSk7CgoKICAgICAgICBhc3NlcnRU\ncnVlKCJTZW50ICIgKyB0ZXN0U2l6ZSArICIgbWVzc2FnZXMgaW50ZW5kZWQg\ndG8gYmUgY29uc3VtZWQsIGJ1dCBvbmx5IGNvbnN1bWVkICIgKyBjb25zdW1l\nci5nZXRDb3VudCgpLAogICAgICAgICAgICAgICAgICAgKGNvbnN1bWVyLmdl\ndENvdW50KCkgPT0gdGVzdFNpemUgKSk7CiAgICAgICAgYXNzZXJ0RmFsc2Uo\nIkRlbGl2ZXJ5IG9mIG1lc3NhZ2VzIHRvIGNvbnN1bWVyIHdhcyBoYWx0ZWQg\nZHVyaW5nIHRoaXMgdGVzdCIsIGNvbnN1bWVyLmRlbGl2ZXJ5SGFsdGVkKCkp\nOwoKCiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRvIGNoZWNrIGlmIGEg\nc2luZ2xlIGNvbnN1bWVyIHdpdGggYSBKTVMgc2VsZWN0b3Igd2lsbCByZWNl\naXZlIGFsbCBpbnRlbmRlZCBtZXNzYWdlcwogICAgICoKICAgICAqIEB0aHJv\nd3MgamF2YS5sYW5nLkV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0RGlzY3JpbWluYXRpbmdDb25zdW1lcigpIHRocm93cyBFeGNlcHRp\nb24gewoKICAgICAgICBjb25zdW1lckNvbm5lY3Rpb24gPSBjcmVhdGVDb25u\nZWN0aW9uKCk7CiAgICAgICAgY29uc3VtZXJDb25uZWN0aW9uLnN0YXJ0KCk7\nCiAgICAgICAgTE9HLmluZm8oImNvbnN1bWVyQ29ubmVjdGlvbiA9ICIgK2Nv\nbnN1bWVyQ29ubmVjdGlvbik7CgogICAgICAgIHRyeSB7VGhyZWFkLnNsZWVw\nKDEwMDApOyB9IGNhdGNoIChFeGNlcHRpb24gZSkge30KCiAgICAgICAgLy8g\naGVyZSB3ZSBwYXNzIHRoZSBKTVMgc2VsZWN0b3Igd2UgaW50ZW5kIHRvIGNv\nbnN1bWUKICAgICAgICBDb25zdW1lciBjb25zdW1lciA9IG5ldyBDb25zdW1l\ncihjb25zdW1lckNvbm5lY3Rpb24sIEpNU1RZUEVfRUFUTUUpOwogICAgICAg\nIFRocmVhZCBjb25zdW1lclRocmVhZCA9IG5ldyBUaHJlYWQoY29uc3VtZXIp\nOwoKICAgICAgICBjb25zdW1lclRocmVhZC5zdGFydCgpOwoKICAgICAgICBw\ncm9kdWNlckNvbm5lY3Rpb24gPSBjcmVhdGVDb25uZWN0aW9uKCk7CiAgICAg\nICAgcHJvZHVjZXJDb25uZWN0aW9uLnN0YXJ0KCk7CiAgICAgICAgTE9HLmlu\nZm8oInByb2R1Y2VyQ29ubmVjdGlvbiA9ICIgK3Byb2R1Y2VyQ29ubmVjdGlv\nbik7CgogICAgICAgIHRyeSB7VGhyZWFkLnNsZWVwKDMwMDApOyB9IGNhdGNo\nIChFeGNlcHRpb24gZSkge30KCiAgICAgICAgUHJvZHVjZXIgcHJvZHVjZXIg\nPSBuZXcgUHJvZHVjZXIocHJvZHVjZXJDb25uZWN0aW9uKTsKICAgICAgICBU\naHJlYWQgcHJvZHVjZXJUaHJlYWQgPSBuZXcgVGhyZWFkKHByb2R1Y2VyKTsK\nICAgICAgICBwcm9kdWNlclRocmVhZC5zdGFydCgpOwoKICAgICAgICAvLyBu\nb3cgdGhhdCBldmVyeXRoaW5nIGlzIHJ1bm5pbmcsIGxldCdzIHdhaXQgZm9y\nIHRoZSBjb25zdW1lciB0aHJlYWQgdG8gZmluaXNoIC4uLgogICAgICAgIGNv\nbnN1bWVyVGhyZWFkLmpvaW4oKTsKICAgICAgICBwcm9kdWNlci5zdG9wID0g\ndHJ1ZTsKCiAgICAgICAgaWYgKGNvbnN1bWVyLmdldENvdW50KCkgPT0gKHRl\nc3RTaXplIC8gMikpCiAgICAgICAgewogICAgICAgICAgICBMT0cuaW5mbygi\ndGVzdCBjb21wbGV0ZSAuLi4uIGFsbCBtZXNzc2FnZXMgY29uc3VtZWQhISIp\nOwogICAgICAgIH0KICAgICAgICBlbHNlCiAgICAgICAgICAgIHsKICAgICAg\nICAgICAgICAgIExPRy5pbmZvKCJ0ZXN0IGZhaWxlZCAuLi4uIFNlbnQgIiAr\nIHRlc3RTaXplCiAgICAgICAgICAgICAgICAgICAgICAgICArICIgb3JpZ2lu\nYWwgbWVzc2FnZXMsIG9ubHkgaGFsZiBvZiB3aGljaCAoIiArICh0ZXN0U2l6\nZSAvIDIpICsKICAgICAgICAgICAgICAgICAgICAgICAgICIpIHdlcmUgaW50\nZW5kZWQgdG8gYmUgY29uc3VtZWQ6IGNvbnN1bWVyIHBhdXNlZCBhdDogIiAr\nIGNvbnN1bWVyLmdldENvdW50KCkpOwogICAgICAgICAgICAgICAgLy9TeXN0\nZW0ub3V0LnByaW50bG4oInRlc3QgZmFpbGVkIC4uLi4gU2VudCAiICsgdGVz\ndFNpemUKICAgICAgICAgICAgICAgIC8vKyAiIG9yaWdpbmFsIG1lc3NhZ2Vz\nLCBvbmx5IGhhbGYgb2Ygd2hpY2ggKCIgKyAodGVzdFNpemUgLyAyKSArCiAg\nICAgICAgICAgICAgICAvLyAiKSB3ZXJlIGludGVuZGVkIHRvIGJlIGNvbnN1\nbWVkOiBjb25zdW1lciBwYXVzZWQgYXQ6ICIgKyBjb25zdW1lci5nZXRDb3Vu\ndCgpKTsKICAgICAgICAgICAgfQogICAgICAgIGFzc2VydFRydWUoIlNlbnQg\nIiArIHRlc3RTaXplICArICIgb3JpZ2luYWwgbWVzc2FnZXMsIG9ubHkgaGFs\nZiBvZiB3aGljaCAoIiArICh0ZXN0U2l6ZSAvIDIpICsKICAgICAgICAgICAg\nICAgICAgICIpIHdlcmUgaW50ZW5kZWQgdG8gYmUgY29uc3VtZWQ6IGNvbnN1\nbWVyIHBhdXNlZCBhdDogIiArIGNvbnN1bWVyLmdldENvdW50KCksCiAgICAg\nICAgICAgICAgICAgICAoY29uc3VtZXIuZ2V0Q291bnQoKSA9PSAodGVzdFNp\nemUgLyAyKSkpOwogICAgICAgIGFzc2VydFRydWUoIkRlbGl2ZXJ5IG9mIG1l\nc3NhZ2VzIHRvIGNvbnN1bWVyIHdhcyBoYWx0ZWQgZHVyaW5nIHRoaXMgdGVz\ndCBhcyBpdCBvbmx5IHdhbnRzIGhhbGYiLAogICAgICAgICAgICAgICAgICAg\nY29uc3VtZXIuZGVsaXZlcnlIYWx0ZWQoKSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBIZWxwZXIgY2xhc3MgdGhhdCB3aWxsIHB1Ymxpc2ggMiAqIHRlc3RT\naXplIG1lc3NhZ2VzLiAgVGhlIG1lc3NhZ2VzIHdpbGwgYmUgZGlzdHJpYnV0\nZWQgZXZlbmx5CiAgICAgKiBiZXR3ZWVuIHRoZSBmb2xsb3dpbmcgdHdvIEpN\nUyB0eXBlczoKICAgICAqCiAgICAgKiBAc2VlIEpNU1RZUEVfSU5URU5ERURf\nRk9SX0NPTlNVTVBUSU9OCiAgICAgKiBAc2VlIEpNU1RZUEVfTk9UX0lOVEVO\nREVEX0ZPUl9DT05TVU1QVElPTgogICAgICoKICAgICAqLwogICAgcHJpdmF0\nZSBjbGFzcyBQcm9kdWNlciBleHRlbmRzIFRocmVhZAogICAgewogICAgICAg\nIHByaXZhdGUgaW50IGNvdW50ZXJTZW50ID0gMDsKICAgICAgICBwcml2YXRl\nIENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IG51bGw7CiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gc3RvcCA9IGZhbHNlOwoKICAgICAgICBwdWJsaWMgUHJvZHVj\nZXIoQ29ubmVjdGlvbiBjb25uZWN0aW9uKQogICAgICAgIHsKICAgICAgICAg\nICAgdGhpcy5jb25uZWN0aW9uID0gY29ubmVjdGlvbjsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgIGZpbmFsIFNlc3Npb24gc2Vzc2lvbiA9IGNvbm5l\nY3Rpb24uY3JlYXRlU2Vzc2lvbihmYWxzZSwgU2Vzc2lvbi5BVVRPX0FDS05P\nV0xFREdFKTsKICAgICAgICAgICAgICAgIGZpbmFsIFRvcGljIHF1ZXVlID0g\nc2Vzc2lvbi5jcmVhdGVUb3BpYygidGVzdCIpOwoKICAgICAgICAgICAgICAg\nIC8vIHdhaXQgZm9yIDEwIHNlY29uZHMgdG8gYWxsb3cgY29uc3VtZXIucmVj\nZWl2ZSB0byBiZSBydW4KICAgICAgICAgICAgICAgIC8vIGZpcnN0CiAgICAg\nICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMDApOwogICAgICAgICAgICAg\nICAgTWVzc2FnZVByb2R1Y2VyIHByb2R1Y2VyID0gc2Vzc2lvbi5jcmVhdGVQ\ncm9kdWNlcihxdWV1ZSk7CgogICAgICAgICAgICAgICAgd2hpbGUgKCFzdG9w\nICYmIChjb3VudGVyU2VudCA8IHRlc3RTaXplKSkKICAgICAgICAgICAgICAg\nICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpcnN0IHNlbmQg\nYSBtZXNzYWdlIGludGVuZGVkIHRvIGJlIGNvbnN1bWVkIC4uLi4KICAgICAg\nICAgICAgICAgICAgICAgICAgVGV4dE1lc3NhZ2UgbWVzc2FnZSA9IHNlc3Np\nb24uY3JlYXRlVGV4dE1lc3NhZ2UoIioqKiBJbGwgLi4uLi4uLiBJbmkgKioq\nIik7ICAvLyBhbG1hIG1hdGVyIC4uLgogICAgICAgICAgICAgICAgICAgICAg\nICBtZXNzYWdlLnNldEpNU1R5cGUoSk1TVFlQRV9FQVRNRSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vTE9HLmluZm8oInNlbmRpbmcgLi4uLiBKTVNU\neXBlID0gIiArIG1lc3NhZ2UuZ2V0Sk1TVHlwZSgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgcHJvZHVjZXIuc2VuZChtZXNzYWdlLERlbGl2ZXJ5TW9k\nZS5OT05fUEVSU0lTVEVOVCwwLDE4MDAwMDApOwoKICAgICAgICAgICAgICAg\nICAgICAgICAgY291bnRlclNlbnQrKzsKCiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIG5vdyBzZW5kIGEgbWVzc2FnZSBpbnRlbmRlZCB0byBiZSBjb25z\ndW1lZCBieSBzb21lIG90aGVyIGNvbnN1bWVyIGluIHRoZSB0aGUgZnV0dXJl\nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIC4uLiB3ZSBleHBlY3QgdGhl\nc2UgbWVzc2FnZXMgdG8gYWNjcnVlIGluIHRoZSBxdWV1ZQogICAgICAgICAg\nICAgICAgICAgICAgICBtZXNzYWdlID0gc2Vzc2lvbi5jcmVhdGVUZXh0TWVz\nc2FnZSgiKioqIElsbCAuLi4uLi4uIEluaSAqKioiKTsgIC8vIGFsbWEgbWF0\nZXIgLi4uCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2V0Sk1T\nVHlwZShKTVNUWVBFX0lHTk9SRU1FKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgLy9MT0cuaW5mbygic2VuZGluZyAuLi4uIEpNU1R5cGUgPSAiICsgbWVz\nc2FnZS5nZXRKTVNUeXBlKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBw\ncm9kdWNlci5zZW5kKG1lc3NhZ2UsRGVsaXZlcnlNb2RlLk5PTl9QRVJTSVNU\nRU5ULDAsMTgwMDAwMCk7CgogICAgICAgICAgICAgICAgICAgICAgICBjb3Vu\ndGVyU2VudCsrOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICBzZXNzaW9uLmNsb3NlKCk7CgogICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgZS5wcmludFN0YWNrVHJh\nY2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBMT0cuaW5mbygicHJv\nZHVjZXIgdGhyZWFkIGNvbXBsZXRlIC4uLiAiICsgY291bnRlclNlbnQgKyAi\nIG1lc3NhZ2VzIHNlbnQgdG8gdGhlIHF1ZXVlIik7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgaW50IGdldENvdW50KCkKICAgICAgICB7CiAgICAgICAg\nICAgIHJldHVybiB0aGlzLmNvdW50ZXJTZW50OwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEhlbHBlciBjbGFzcyB0aGF0IHdpbGwgY29uc3Vt\nZSBtZXNzYWdlcyBmcm9tIHRoZSBxdWV1ZSBiYXNlZCBvbiB0aGUgc3VwcGxp\nZWQgSk1TIHNlbGVjdG9yLgogICAgICogVGhyZWFkIHdpbGwgc3RvcCBhZnRl\nciB0aGUgZmlyc3QgcmVjZWl2ZSguLikgdGltZW91dCwgb3Igb25jZSBhbGwg\nZXhwZWN0ZWQgbWVzc2FnZXMgaGF2ZQogICAgICogYmVlbiByZWNlaXZlZCAo\nc2VlIHRlc3RTaXplKS4gIElmIHRoZSB0aHJlYWQgc3RvcHMgZHVlIHRvIGEg\ndGltZW91dCwgaXQgaXMgZXhwZXJpZW5jaW5nIHRoZQogICAgICogZGVsaXZl\ncnkgcGF1c2UgdGhhdCBpcyBzeW1wdG9tYXRpYyBvZiBhIGJ1ZyBpbiB0aGUg\nYnJva2VyLgogICAgICovCiAgICBwcml2YXRlIGNsYXNzIENvbnN1bWVyIGV4\ndGVuZHMgVGhyZWFkCiAgICB7CiAgICAgICAgcHJvdGVjdGVkIGludCBjb3Vu\ndGVyUmVjZWl2ZWQgPSAwOwogICAgICAgIHByaXZhdGUgQ29ubmVjdGlvbiBj\nb25uZWN0aW9uID0gbnVsbDsKICAgICAgICBwcml2YXRlIFN0cmluZyBqbXNT\nZWxlY3RvciA9IG51bGw7CiAgICAgICAgcHJpdmF0ZSBib29sZWFuIGRlbGl2\nZXJ5SGFsdGVkID0gZmFsc2U7CgogICAgICAgIHB1YmxpYyBDb25zdW1lcihD\nb25uZWN0aW9uIGNvbm5lY3Rpb24sIFN0cmluZyBqbXNTZWxlY3RvcikKICAg\nICAgICB7CiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvbiA9IGNvbm5lY3Rp\nb247CiAgICAgICAgICAgIHRoaXMuam1zU2VsZWN0b3IgPSBqbXNTZWxlY3Rv\ncjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICAgICAgYm9vbGVhbiB0ZXN0Q29tcGxldGUgPSBmYWxzZTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIFNlc3Npb24gc2Vzc2lvbiA9\nIGNvbnN1bWVyQ29ubmVjdGlvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNz\naW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAgICAgICAgICAgZmluYWwg\nVG9waWMgcXVldWUgPSBzZXNzaW9uLmNyZWF0ZVRvcGljKCJ0ZXN0Iik7CiAg\nICAgICAgICAgICAgICBNZXNzYWdlQ29uc3VtZXIgY29uc3VtZXIgPSBudWxs\nOwogICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gdGhpcy5qbXNTZWxlY3Rv\ncikKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNvbnN1bWVyID0gc2Vzc2lvbi5jcmVhdGVDb25zdW1lcihxdWV1ZSwg\nIkpNU1R5cGU9JyIgKyB0aGlzLmptc1NlbGVjdG9yICsgIiciKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb25zdW1l\nciA9IHNlc3Npb24uY3JlYXRlQ29uc3VtZXIocXVldWUpOwogICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aGlsZSAoIWRlbGl2ZXJ5\nSGFsdGVkICYmIChjb3VudGVyUmVjZWl2ZWQgPCB0ZXN0U2l6ZSkpCiAgICAg\nICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBUZXh0\nTWVzc2FnZSByZXN1bHQgPSAoVGV4dE1lc3NhZ2UpIGNvbnN1bWVyLnJlY2Vp\ndmUoMzAwMDApOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50\nZXJSZWNlaXZlZCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9T\neXN0ZW0ub3V0LnByaW50bG4oImNvbnN1bWluZyAuLi4uIEpNU1R5cGUgPSAi\nICsgcmVzdWx0LmdldEpNU1R5cGUoKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gKyAiIHJlY2VpdmVkID0gIiArIGNvdW50ZXJSZWNlaXZlZCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiY29uc3Vt\naW5nIC4uLi4gSk1TVHlwZSA9ICIgKyByZXN1bHQuZ2V0Sk1TVHlwZSgpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgcmVjZWl2\nZWQgPSAiICsgY291bnRlclJlY2VpdmVkKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oImNvbnN1\nbWluZyAuLi4uIHRpbWVvdXQgd2hpbGUgd2FpdGluZyBmb3IgYSBtZXNzYWdl\nIC4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiLi4gYnJva2VyIG11c3QgaGF2ZSBzdG9wcGVkIGRlbGl2ZXJ5IC4uLiAg\ncmVjZWl2ZWQgPSAiICsgY291bnRlclJlY2VpdmVkKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeUhhbHRlZCA9IHRydWU7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgc2Vzc2lvbi5jbG9zZSgpOwogICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBpbnQgZ2V0Q291bnQoKQogICAgICAgIHsKICAg\nICAgICAgICAgcmV0dXJuIHRoaXMuY291bnRlclJlY2VpdmVkOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gZGVsaXZlcnlIYWx0ZWQoKQog\nICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVsaXZlcnlIYWx0\nZWQ7CiAgICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

