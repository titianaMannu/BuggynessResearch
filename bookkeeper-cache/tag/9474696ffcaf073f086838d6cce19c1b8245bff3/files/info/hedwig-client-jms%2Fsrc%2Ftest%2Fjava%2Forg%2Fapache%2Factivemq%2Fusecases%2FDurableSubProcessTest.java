{"sha":"a9272793d7575be2bf73cd27c2c61e62fb8311b6","node_id":"MDQ6QmxvYjE1NzU5NTY6YTkyNzI3OTNkNzU3NWJlMmJmNzNjZDI3YzJjNjFlNjJmYjgzMTFiNg==","size":21442,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a9272793d7575be2bf73cd27c2c61e62fb8311b6","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRo\nZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFja2Fn\nZSBvcmcuYXBhY2hlLmFjdGl2ZW1xLnVzZWNhc2VzOwoKaW1wb3J0IGphdmF4\nLmptcy5Db25uZWN0aW9uOwppbXBvcnQgamF2YXguam1zLkNvbm5lY3Rpb25G\nYWN0b3J5OwppbXBvcnQgamF2YXguam1zLkpNU0V4Y2VwdGlvbjsKaW1wb3J0\nIGphdmF4Lmptcy5NZXNzYWdlOwppbXBvcnQgamF2YXguam1zLk1lc3NhZ2VD\nb25zdW1lcjsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlUHJvZHVjZXI7Cmlt\ncG9ydCBqYXZheC5qbXMuU2Vzc2lvbjsKaW1wb3J0IGphdmF4Lmptcy5Ub3Bp\nYzsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmptcy5zcGkuSGVkd2lnQ29u\nbmVjdGlvbkZhY3RvcnlJbXBsOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmp1\nbml0LlRlc3Q7CgppbXBvcnQgamF2YS50ZXh0LlNpbXBsZURhdGVGb3JtYXQ7\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5EYXRlOwppbXBvcnQgamF2YS51\ndGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuVmVjdG9yOwppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudExpbmtlZFF1ZXVlOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29weU9uV3JpdGVBcnJheUxp\nc3Q7CgovLyBzZWUgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9yZy9hY3RpdmVt\ncS9icm93c2UvQU1RLTI5ODUKLy8gdGhpcyBkZW1vbnN0cmF0ZWQgcmVjZWl2\naW5nIG9sZCBtZXNzYWdlcyBldmVudHVhbGx5IGFsb25nIHdpdGggdmFsaWRh\ndGluZyBvcmRlciByZWNlaXB0CnB1YmxpYyBjbGFzcyBEdXJhYmxlU3ViUHJv\nY2Vzc1Rlc3QgZXh0ZW5kcyBvcmcuYXBhY2hlLmFjdGl2ZW1xLlRlc3RTdXBw\nb3J0ICB7CiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0g\nTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoRHVyYWJsZVN1YlByb2Nlc3NUZXN0\nLmNsYXNzKTsKICAgIC8vIHB1YmxpYyBzdGF0aWMgZmluYWwgbG9uZyBSVU5U\nSU1FID0gNCAqIDYwICogMTAwMDsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\nbG9uZyBSVU5USU1FID0gNjAgKiAxMDAwOwoKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IFNFUlZFUl9TTEVFUCA9IDIgKiAxMDAwOyAvLyBtYXgKICAg\nIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENBUkdPX1NJWkUgPSAxMDsgLy8g\nbWF4CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTUFYX0NMSUVOVFMg\nPSA3OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBSYW5kb20gQ0xJRU5UX0xJ\nRkVUSU1FID0gbmV3IFJhbmRvbSgzMCAqIDEwMDAsIDIgKiA2MCAqIDEwMDAp\nOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBSYW5kb20gQ0xJRU5UX09OTElO\nRSA9IG5ldyBSYW5kb20oMiAqIDEwMDAsIDE1ICogMTAwMCk7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIFJhbmRvbSBDTElFTlRfT0ZGTElORSA9IG5ldyBS\nYW5kb20oMSAqIDEwMDAsIDIwICogMTAwMCk7CgogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBib29sZWFuIEFMTE9XX1NVQlNDUklQVElPTl9BQkFORE9OTUVO\nVCA9IHRydWU7CgoKICAgIHByaXZhdGUgVG9waWMgdG9waWM7CgogICAgcHJp\ndmF0ZSBDbGllbnRNYW5hZ2VyIGNsaWVudE1hbmFnZXI7CiAgICBwcml2YXRl\nIFNlcnZlciBzZXJ2ZXI7CiAgICBwcml2YXRlIEhvdXNlS2VlcGVyIGhvdXNl\nS2VlcGVyOwoKICAgIHN0YXRpYyBmaW5hbCBWZWN0b3I8VGhyb3dhYmxlPiBl\neGNlcHRpb25zID0gbmV3IFZlY3RvcjxUaHJvd2FibGU+KCk7CgogICAgcHVi\nbGljIHZvaWQgdGVzdFByb2Nlc3MoKSB7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgc2VydmVyLnN0YXJ0KCk7CiAgICAgICAgICAgIGNsaWVudE1hbmFn\nZXIuc3RhcnQoKTsKCiAgICAgICAgICAgIGlmIChBTExPV19TVUJTQ1JJUFRJ\nT05fQUJBTkRPTk1FTlQpCiAgICAgICAgICAgICAgICBob3VzZUtlZXBlci5z\ndGFydCgpOwoKICAgICAgICAgICAgVGhyZWFkLnNsZWVwKFJVTlRJTUUpOwog\nICAgICAgICAgICBhc3NlcnRUcnVlKCJubyBleGNlcHRpb25zOiAiICsgZXhj\nZXB0aW9ucywgZXhjZXB0aW9ucy5pc0VtcHR5KCkpOwogICAgICAgIH0KICAg\nICAgICBjYXRjaCAoVGhyb3dhYmxlIGUpIHsKICAgICAgICAgICAgZXhpdCgi\nRHVyYWJsZVN1YlByb2Nlc3NUZXN0LnRlc3RQcm9jZXNzIGZhaWxlZC4iLCBl\nKTsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oIkRPTkUuIik7CiAgICB9\nCgogICAgLyoqCiAgICAgKiBDcmVhdGVzIGJhdGNoIG9mIG1lc3NhZ2VzIGlu\nIGEgdHJhbnNhY3Rpb24gcGVyaW9kaWNhbGx5LgogICAgICogVGhlIGxhc3Qg\nbWVzc2FnZSBpbiB0aGUgdHJhbnNhY3Rpb24gaXMgYWx3YXlzIGEgc3BlY2lh\nbAogICAgICogbWVzc2FnZSB3aGF0IGNvbnRhaW5zIGluZm8gYWJvdXQgdGhl\nIHdob2xlIHRyYW5zYWN0aW9uLgogICAgICogPHA+Tm90aWZpZXMgdGhlIGNs\naWVudHMgYWJvdXQgdGhlIGNyZWF0ZWQgbWVzc2FnZXMgYWxzby4KICAgICAq\nLwogICAgZmluYWwgY2xhc3MgU2VydmVyIGV4dGVuZHMgVGhyZWFkIHsKCiAg\nICAgICAgZmluYWwgQ29ubmVjdGlvbkZhY3RvcnkgY2YgPSBuZXcgSGVkd2ln\nQ29ubmVjdGlvbkZhY3RvcnlJbXBsKCk7CgogICAgICAgIGZpbmFsIE9iamVj\ndCBzZW5kTXV0ZXggPSBuZXcgT2JqZWN0KCk7CiAgICAgICAgZmluYWwgU3Ry\naW5nW10gY2FyZ29zID0gbmV3IFN0cmluZ1s1MDBdOwoKICAgICAgICBpbnQg\ndHJhbnNSb3ZlciA9IDA7CiAgICAgICAgaW50IG1lc3NhZ2VSb3ZlciA9IDA7\nCgogICAgICAgIHB1YmxpYyBTZXJ2ZXIoKSB7CiAgICAgICAgICAgIHN1cGVy\nKCJTZXJ2ZXIiKTsKICAgICAgICAgICAgc2V0RGFlbW9uKHRydWUpOwogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgd2hp\nbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBEdXJhYmxlU3ViUHJv\nY2Vzc1Rlc3Quc2xlZXBSYW5kb20oU0VSVkVSX1NMRUVQKTsKICAgICAgICAg\nICAgICAgICAgICBzZW5kKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgY2F0Y2ggKFRocm93YWJsZSBlKSB7CiAgICAg\nICAgICAgICAgICBleGl0KCJTZXJ2ZXIucnVuIGZhaWxlZCIsIGUpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzZW5k\nKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIC8vIGRvIG5v\ndCBjcmVhdGUgbmV3IGNsaWVudHMgbm93CiAgICAgICAgICAgIC8vIFRvRG86\nIFRlc3QgdGhpcyBjYXNlIGxhdGVyLgogICAgICAgICAgICBzeW5jaHJvbml6\nZWQgKHNlbmRNdXRleCkgewogICAgICAgICAgICAgICAgaW50IHRyYW5zID0g\nKyt0cmFuc1JvdmVyOwogICAgICAgICAgICAgICAgYm9vbGVhbiByZWxldmFu\ndFRyYW5zID0gcmFuZG9tKDIpID4gMTsKICAgICAgICAgICAgICAgIENsaWVu\ndFR5cGUgY2xpZW50VHlwZSA9IHJlbGV2YW50VHJhbnMgPyBDbGllbnRUeXBl\nLnJhbmRvbUNsaWVudFR5cGUoKSA6IG51bGw7IC8vIHNlbmRzIHRoaXMgdHlw\nZXMKICAgICAgICAgICAgICAgIGludCBjb3VudCA9IHJhbmRvbSgyMDApOwoK\nICAgICAgICAgICAgICAgIExPRy5pbmZvKCJTZW5kaW5nIFRyYW5zW2lkPSIg\nKyB0cmFucyArICIsIGNvdW50PSIgKyBjb3VudCArICIsIGNsaWVudFR5cGU9\nIiArIGNsaWVudFR5cGUgKyAiXSIpOwoKICAgICAgICAgICAgICAgIENvbm5l\nY3Rpb24gY29uID0gY2YuY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgICAg\nICAgICAgU2Vzc2lvbiBzZXNzID0gY29uLmNyZWF0ZVNlc3Npb24odHJ1ZSwg\nU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFKTsKICAgICAgICAgICAgICAgIE1l\nc3NhZ2VQcm9kdWNlciBwcm9kID0gc2Vzcy5jcmVhdGVQcm9kdWNlcihudWxs\nKTsKCiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGNvdW50\nOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBNZXNzYWdlIG1lc3NhZ2Ug\nPSBzZXNzLmNyZWF0ZU1lc3NhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBt\nZXNzYWdlLnNldEludFByb3BlcnR5KCJJRCIsICsrbWVzc2FnZVJvdmVyKTsK\nICAgICAgICAgICAgICAgICAgICBTdHJpbmcgdHlwZSA9IGNsaWVudFR5cGUg\nIT0gbnVsbCA/IGNsaWVudFR5cGUucmFuZG9tTWVzc2FnZVR5cGUoKSA6CiAg\nICAgICAgICAgICAgICAgICAgICAgIENsaWVudFR5cGUucmFuZG9tTm9uUmVs\nZXZhbnRNZXNzYWdlVHlwZSgpOwogICAgICAgICAgICAgICAgICAgIG1lc3Nh\nZ2Uuc2V0U3RyaW5nUHJvcGVydHkoIlRZUEUiLCB0eXBlKTsKCiAgICAgICAg\nICAgICAgICAgICAgaWYgKENBUkdPX1NJWkUgPiAwKQogICAgICAgICAgICAg\nICAgICAgICAgICBtZXNzYWdlLnNldFN0cmluZ1Byb3BlcnR5KCJDQVJHTyIs\nIGdldENhcmdvKENBUkdPX1NJWkUpKTsKCiAgICAgICAgICAgICAgICAgICAg\ncHJvZC5zZW5kKHRvcGljLCBtZXNzYWdlKTsKICAgICAgICAgICAgICAgICAg\nICBjbGllbnRNYW5hZ2VyLm9uU2VydmVyTWVzc2FnZShtZXNzYWdlKTsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBNZXNzYWdlIG1lc3Nh\nZ2UgPSBzZXNzLmNyZWF0ZU1lc3NhZ2UoKTsKICAgICAgICAgICAgICAgIG1l\nc3NhZ2Uuc2V0SW50UHJvcGVydHkoIklEIiwgKyttZXNzYWdlUm92ZXIpOwog\nICAgICAgICAgICAgICAgbWVzc2FnZS5zZXRJbnRQcm9wZXJ0eSgiVFJBTlMi\nLCB0cmFucyk7CiAgICAgICAgICAgICAgICBtZXNzYWdlLnNldEJvb2xlYW5Q\ncm9wZXJ0eSgiQ09NTUlUIiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICBtZXNz\nYWdlLnNldEJvb2xlYW5Qcm9wZXJ0eSgiUkVMRVZBTlQiLCByZWxldmFudFRy\nYW5zKTsKICAgICAgICAgICAgICAgIHByb2Quc2VuZCh0b3BpYywgbWVzc2Fn\nZSk7CiAgICAgICAgICAgICAgICBjbGllbnRNYW5hZ2VyLm9uU2VydmVyTWVz\nc2FnZShtZXNzYWdlKTsKCiAgICAgICAgICAgICAgICBzZXNzLmNvbW1pdCgp\nOwogICAgICAgICAgICAgICAgc2Vzcy5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgY29uLmNsb3NlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHByaXZhdGUgU3RyaW5nIGdldENhcmdvKGludCBsZW5ndGgpIHsKICAg\nICAgICAgICAgaWYgKGxlbmd0aCA9PSAwKQogICAgICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CgogICAgICAgICAgICBpZiAobGVuZ3RoIDwgY2FyZ29zLmxl\nbmd0aCkgewogICAgICAgICAgICAgICAgU3RyaW5nIHJlc3VsdCA9IGNhcmdv\nc1tsZW5ndGhdOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZ2V0Q2FyZ29JbXBs\nKGxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgY2FyZ29zW2xlbmd0aF0g\nPSByZXN1bHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBy\nZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVy\nbiBnZXRDYXJnb0ltcGwobGVuZ3RoKTsKICAgICAgICB9CgogICAgICAgIHBy\naXZhdGUgU3RyaW5nIGdldENhcmdvSW1wbChpbnQgbGVuZ3RoKSB7CiAgICAg\nICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcihs\nZW5ndGgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gbGVuZ3RoOyAtLWkg\nPj0wOyApIHsKICAgICAgICAgICAgICAgIHNiLmFwcGVuZCgnYScpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBzYi50b1N0cmluZygpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENsaWVudHMgbGlzdGVu\nIG9uIGRpZmZlcmVudCBtZXNzYWdlcyBpbiB0aGUgdG9waWMuCiAgICAgKiBU\naGUgJ1RZUEUnIHByb3BlcnR5IGhlbHBzIHRoZSBjbGllbnQgdG8gc2VsZWN0\nIHRoZQogICAgICogcHJvcGVyIG1lc3NhZ2VzLgogICAgICovCiAgICBwcml2\nYXRlIGVudW0gQ2xpZW50VHlwZSB7CiAgICAgICAgQSAoImEiLCAiYiIsICJj\nIiksCiAgICAgICAgQiAoImMiLCAiZCIsICJlIiksCiAgICAgICAgQyAoImQi\nLCAiZSIsICJmIiksCiAgICAgICAgRCAoImciLCAiaCIpOwoKICAgICAgICBw\ndWJsaWMgZmluYWwgU3RyaW5nW10gbWVzc2FnZVR5cGVzOwogICAgICAgIHB1\nYmxpYyBmaW5hbCBIYXNoU2V0PFN0cmluZz4gbWVzc2FnZVR5cGVTZXQ7CiAg\nICAgICAgcHVibGljIGZpbmFsIFN0cmluZyBzZWxlY3RvcjsKCiAgICAgICAg\nQ2xpZW50VHlwZShTdHJpbmcuLi4gbWVzc2FnZVR5cGVzKSB7CiAgICAgICAg\nICAgIHRoaXMubWVzc2FnZVR5cGVzID0gbWVzc2FnZVR5cGVzOwogICAgICAg\nICAgICBtZXNzYWdlVHlwZVNldCA9IG5ldyBIYXNoU2V0PFN0cmluZz4oQXJy\nYXlzLmFzTGlzdChtZXNzYWdlVHlwZXMpKTsKCiAgICAgICAgICAgIFN0cmlu\nZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigiVFlQRSBpbiAoIik7\nCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbWVzc2FnZVR5cGVz\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBpZiAoaSA+IDApCiAg\nICAgICAgICAgICAgICAgICAgc2IuYXBwZW5kKCIsICIpOwogICAgICAgICAg\nICAgICAgc2IuYXBwZW5kKCdcJycpLmFwcGVuZChtZXNzYWdlVHlwZXNbaV0p\nLmFwcGVuZCgnXCcnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzYi5h\ncHBlbmQoJyknKTsKICAgICAgICAgICAgc2VsZWN0b3IgPSBzYi50b1N0cmlu\nZygpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHN0YXRpYyBDbGllbnRU\neXBlIHJhbmRvbUNsaWVudFR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiB2\nYWx1ZXMoKVtEdXJhYmxlU3ViUHJvY2Vzc1Rlc3QucmFuZG9tKHZhbHVlcygp\nLmxlbmd0aCAtIDEpXTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBmaW5h\nbCBTdHJpbmcgcmFuZG9tTWVzc2FnZVR5cGUoKSB7CiAgICAgICAgICAgIHJl\ndHVybiBtZXNzYWdlVHlwZXNbRHVyYWJsZVN1YlByb2Nlc3NUZXN0LnJhbmRv\nbShtZXNzYWdlVHlwZXMubGVuZ3RoIC0gMSldOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHN0YXRpYyBTdHJpbmcgcmFuZG9tTm9uUmVsZXZhbnRNZXNz\nYWdlVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIEludGVnZXIudG9TdHJp\nbmcoRHVyYWJsZVN1YlByb2Nlc3NUZXN0LnJhbmRvbSgyMCkpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNSZWxldmFudChT\ndHJpbmcgbWVzc2FnZVR5cGUpIHsKICAgICAgICAgICAgcmV0dXJuIG1lc3Nh\nZ2VUeXBlU2V0LmNvbnRhaW5zKG1lc3NhZ2VUeXBlKTsKICAgICAgICB9Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBmaW5hbCBTdHJpbmcg\ndG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm5hbWUoKSAv\nKisgJ1snICsgc2VsZWN0b3IgKyAnXScqLzsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBDcmVhdGVzIG5ldyBjbGllbnMuCiAgICAgKi8KICAg\nIHByaXZhdGUgZmluYWwgY2xhc3MgQ2xpZW50TWFuYWdlciBleHRlbmRzIFRo\ncmVhZCB7CgogICAgICAgIHByaXZhdGUgaW50IGNsaWVudFJvdmVyID0gMDsK\nCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBDb3B5T25Xcml0ZUFycmF5TGlzdDxD\nbGllbnQ+IGNsaWVudHMgPSBuZXcgQ29weU9uV3JpdGVBcnJheUxpc3Q8Q2xp\nZW50PigpOwoKICAgICAgICBwdWJsaWMgQ2xpZW50TWFuYWdlcigpIHsKICAg\nICAgICAgICAgc3VwZXIoIkNsaWVudE1hbmFnZXIiKTsKICAgICAgICAgICAg\nc2V0RGFlbW9uKHRydWUpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoY2xpZW50cy5zaXplKCkgPCBNQVhfQ0xJRU5UUykKICAg\nICAgICAgICAgICAgICAgICAgICAgY3JlYXRlTmV3Q2xpZW50KCk7CgogICAg\nICAgICAgICAgICAgICAgIGludCBzaXplID0gY2xpZW50cy5zaXplKCk7CiAg\nICAgICAgICAgICAgICAgICAgc2xlZXBSYW5kb20oc2l6ZSAqIDMgKiAxMDAw\nLCBzaXplICogNiAqIDEwMDApOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGNhdGNoIChUaHJvd2FibGUgZSkgewogICAg\nICAgICAgICAgICAgZXhpdCgiQ2xpZW50TWFuYWdlci5ydW4gZmFpbGVkLiIs\nIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcml2YXRl\nIHZvaWQgY3JlYXRlTmV3Q2xpZW50KCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIENsaWVudFR5cGUgdHlwZSA9IENsaWVudFR5cGUucmFu\nZG9tQ2xpZW50VHlwZSgpOwoKICAgICAgICAgICAgQ2xpZW50IGNsaWVudDsK\nICAgICAgICAgICAgc3luY2hyb25pemVkIChzZXJ2ZXIuc2VuZE11dGV4KSB7\nCiAgICAgICAgICAgICAgICBjbGllbnQgPSBuZXcgQ2xpZW50KCsrY2xpZW50\nUm92ZXIsIHR5cGUsIENMSUVOVF9MSUZFVElNRSwgQ0xJRU5UX09OTElORSwg\nQ0xJRU5UX09GRkxJTkUpOwogICAgICAgICAgICAgICAgY2xpZW50cy5hZGQo\nY2xpZW50KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjbGllbnQuc3Rh\ncnQoKTsKCiAgICAgICAgICAgIExPRy5pbmZvKGNsaWVudC50b1N0cmluZygp\nICsgIiBjcmVhdGVkLiAiICsgdGhpcyk7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCByZW1vdmVDbGllbnQoQ2xpZW50IGNsaWVudCkgewogICAg\nICAgICAgICBjbGllbnRzLnJlbW92ZShjbGllbnQpOwogICAgICAgIH0KCiAg\nICAgICAgcHVibGljIHZvaWQgb25TZXJ2ZXJNZXNzYWdlKE1lc3NhZ2UgbWVz\nc2FnZSkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIGZvciAo\nQ2xpZW50IGNsaWVudDogY2xpZW50cykgewogICAgICAgICAgICAgICAgY2xp\nZW50Lm9uU2VydmVyTWVzc2FnZShtZXNzYWdlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0\ncmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBz\nYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCJDbGllbnRNYW5hZ2VyW2NvdW50PSIp\nOwogICAgICAgICAgICBzYi5hcHBlbmQoY2xpZW50cy5zaXplKCkpOwogICAg\nICAgICAgICBzYi5hcHBlbmQoIiwgY2xpZW50cz0iKTsKICAgICAgICAgICAg\nYm9vbGVhbiBzZXAgPSBmYWxzZTsKICAgICAgICAgICAgZm9yIChDbGllbnQg\nY2xpZW50OiBjbGllbnRzKSB7CiAgICAgICAgICAgICAgICBpZiAoc2VwKSBz\nYi5hcHBlbmQoIiwgIik7CiAgICAgICAgICAgICAgICBlbHNlIHNlcCA9IHRy\ndWU7CiAgICAgICAgICAgICAgICBzYi5hcHBlbmQoY2xpZW50LnRvU3RyaW5n\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHNiLmFwcGVuZCgnXScp\nOwogICAgICAgICAgICByZXR1cm4gc2IudG9TdHJpbmcoKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdW1lcyBtYXNzYWdlcyBmcm9t\nIGEgZHVyYWJsZSBzdWJzY3JpcHRpb24uCiAgICAgKiBHb2VzIG9ubGluZS9v\nZmZsaW5lIHBlcmlvZGljYWxseS4gQ2hlY2tzIHRoZSBpbmNvbWluZyBtZXNz\nYWdlcwogICAgICogYWdhaW5zdCB0aGUgc2VudCBtZXNzYWdlcyBvZiB0aGUg\nc2VydmVyLgogICAgICovCiAgICBwcml2YXRlIGZpbmFsIGNsYXNzIENsaWVu\ndCBleHRlbmRzIFRocmVhZCB7CgogICAgICAgIGZpbmFsIENvbm5lY3Rpb25G\nYWN0b3J5IGNmID0gbmV3IEhlZHdpZ0Nvbm5lY3Rpb25GYWN0b3J5SW1wbCgp\nOwoKICAgICAgICBwdWJsaWMgc3RhdGljIGZpbmFsIFN0cmluZyBTVUJTQ1JJ\nUFRJT05fTkFNRSA9ICJzdWJzY3JpcHRpb24iOwoKICAgICAgICBwcml2YXRl\nIGZpbmFsIGludCBpZDsKICAgICAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBj\nb25DbGllbnRJZDsKCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBSYW5kb20gbGlm\nZXRpbWU7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBSYW5kb20gb25saW5lOwog\nICAgICAgIHByaXZhdGUgZmluYWwgUmFuZG9tIG9mZmxpbmU7CiAgICAgICAg\ncHJpdmF0ZSBpbnQgbnVtSXRlciA9IDA7CgogICAgICAgIHByaXZhdGUgZmlu\nYWwgQ2xpZW50VHlwZSBjbGllbnRUeXBlOwogICAgICAgIHByaXZhdGUgZmlu\nYWwgU3RyaW5nIHNlbGVjdG9yOwoKICAgICAgICBwcml2YXRlIGZpbmFsIENv\nbmN1cnJlbnRMaW5rZWRRdWV1ZTxNZXNzYWdlPiB3YWl0aW5nTGlzdCA9IG5l\ndyBDb25jdXJyZW50TGlua2VkUXVldWU8TWVzc2FnZT4oKTsKCiAgICAgICAg\ncHVibGljIENsaWVudChpbnQgaWQsIENsaWVudFR5cGUgY2xpZW50VHlwZSwg\nUmFuZG9tIGxpZmV0aW1lLCBSYW5kb20gb25saW5lLCBSYW5kb20gb2ZmbGlu\nZSkKICAgICAgICAgICAgICAgIHRocm93cyBKTVNFeGNlcHRpb24gewogICAg\nICAgICAgICBzdXBlcigiQ2xpZW50IiArIGlkKTsKICAgICAgICAgICAgc2V0\nRGFlbW9uKHRydWUpOwoKICAgICAgICAgICAgdGhpcy5pZCA9IGlkOwogICAg\nICAgICAgICBjb25DbGllbnRJZCA9ICJjbGkiICsgaWQ7CiAgICAgICAgICAg\nIHRoaXMuY2xpZW50VHlwZSA9IGNsaWVudFR5cGU7CiAgICAgICAgICAgIHNl\nbGVjdG9yID0gIihDT01NSVQgPSB0cnVlIGFuZCBSRUxFVkFOVCA9IHRydWUp\nIG9yICIgKyBjbGllbnRUeXBlLnNlbGVjdG9yOwoKICAgICAgICAgICAgdGhp\ncy5saWZldGltZSA9IGxpZmV0aW1lOwogICAgICAgICAgICB0aGlzLm9ubGlu\nZSA9IG9ubGluZTsKICAgICAgICAgICAgdGhpcy5vZmZsaW5lID0gb2ZmbGlu\nZTsKCiAgICAgICAgICAgIHN1YnNjcmliZSgpOwogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAg\nICAgICAgICBsb25nIGVuZCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nICsgbGlmZXRpbWUubmV4dCgpOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgYm9vbGVhbiBzbGVlcCA9IGZhbHNlOwogICAgICAgICAgICAg\nICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgICAgICBsb25nIG1h\neCA9IGVuZCAtIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChtYXggPD0gMCkKICAgICAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CgogICAgICAgICAgICAgICAgICAgIGlmIChzbGVlcCkg\nb2ZmbGluZS5zbGVlcFJhbmRvbSgpOwogICAgICAgICAgICAgICAgICAgIGVs\nc2Ugc2xlZXAgPSB0cnVlOwoKICAgICAgICAgICAgICAgICAgICBudW1JdGVy\nICsrOwogICAgICAgICAgICAgICAgICAgIHByb2Nlc3Mob25saW5lLm5leHQo\nKSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCFB\nTExPV19TVUJTQ1JJUFRJT05fQUJBTkRPTk1FTlQgfHwgcmFuZG9tKDEpID4g\nMCkKICAgICAgICAgICAgICAgICAgICB1bnN1YnNjcmliZSgpOwogICAgICAg\nICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8o\nIkNsaWVudCBhYmFuZG9uIHRoZSBzdWJzY3JpcHRpb24uICIgKyB0aGlzKTsK\nCiAgICAgICAgICAgICAgICAgICAgLy8gaG91c2VrZWVwZXIgc2hvdWxkIHN3\nZWVwIHRoZXNlIGFiYW5kb25lZCBzdWJzY3JpcHRpb25zCiAgICAgICAgICAg\nICAgICAgICAgaG91c2VLZWVwZXIuYWJhbmRvbmVkU3Vic2NyaXB0aW9ucy5h\nZGQoY29uQ2xpZW50SWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGNhdGNoIChUaHJvd2FibGUgZSkgewogICAgICAg\nICAgICAgICAgZXhpdCh0b1N0cmluZygpICsgIiBmYWlsZWQuIiwgZSk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGNsaWVudE1hbmFnZXIucmVtb3Zl\nQ2xpZW50KHRoaXMpOwogICAgICAgICAgICBMT0cuaW5mbyh0b1N0cmluZygp\nICsgIiBET05FLiIpOwogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lk\nIHByb2Nlc3MobG9uZyBtaWxsaXMpIHRocm93cyBKTVNFeGNlcHRpb24gewog\nICAgICAgICAgICBsb25nIGVuZCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpICsgbWlsbGlzOwogICAgICAgICAgICBsb25nIGhhcmRFbmQgPSBlbmQg\nKyAyMDAwOyAvLyB3YWl0IHRvIGZpbmlzaCB0aGUgdHJhbnNhY3Rpb24uCiAg\nICAgICAgICAgIGJvb2xlYW4gaW5UcmFuc2FjdGlvbiA9IGZhbHNlOwogICAg\nICAgICAgICBpbnQgdHJhbnNDb3VudCA9IDA7CgogICAgICAgICAgICBMT0cu\naW5mbyh0b1N0cmluZygpICsgIiBPTkxJTkUuIik7CiAgICAgICAgICAgIENv\nbm5lY3Rpb24gY29uID0gb3BlbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAg\nU2Vzc2lvbiBzZXNzID0gY29uLmNyZWF0ZVNlc3Npb24oZmFsc2UsIFNlc3Np\nb24uQ0xJRU5UX0FDS05PV0xFREdFKTsKICAgICAgICAgICAgTWVzc2FnZUNv\nbnN1bWVyIGNvbnN1bWVyID0gc2Vzcy5jcmVhdGVEdXJhYmxlU3Vic2NyaWJl\ncih0b3BpYywgU1VCU0NSSVBUSU9OX05BTUUsIHNlbGVjdG9yLCBmYWxzZSk7\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBkbyB7CiAgICAg\nICAgICAgICAgICAgICAgbG9uZyBtYXggPSBlbmQgLSBTeXN0ZW0uY3VycmVu\ndFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWF4IDw9\nIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpblRyYW5zYWN0\naW9uKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7CgogICAg\nICAgICAgICAgICAgICAgICAgICBtYXggPSBoYXJkRW5kIC0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChtYXggPD0gMCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXQo\nIiIgKyB0aGlzICsgIiBmYWlsZWQ6IFRyYW5zYWN0aW9uIGlzIG5vdCBmaW5p\nc2hlZC4iKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgIE1lc3NhZ2UgbWVzc2FnZSA9IGNvbnN1bWVyLnJlY2VpdmUobWF4\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAobWVzc2FnZSA9PSBudWxsKQog\nICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKCiAgICAgICAgICAg\nICAgICAgICAgb25DbGllbnRNZXNzYWdlKG1lc3NhZ2UpOwoKICAgICAgICAg\nICAgICAgICAgICBpZiAobWVzc2FnZS5wcm9wZXJ0eUV4aXN0cygiQ09NTUlU\nIikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5hY2tub3ds\nZWRnZSgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlJl\nY2VpdmVkIFRyYW5zW2lkPSIgKyBtZXNzYWdlLmdldEludFByb3BlcnR5KCJU\nUkFOUyIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiwg\nY291bnQ9IiArIHRyYW5zQ291bnQgKyAiXSBpbiAiICsgdGhpcyArICIuIik7\nCgogICAgICAgICAgICAgICAgICAgICAgICBpblRyYW5zYWN0aW9uID0gZmFs\nc2U7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zQ291bnQgPSAwOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaW5UcmFuc2FjdGlvbiA9IHRy\ndWU7CiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zQ291bnQrKzsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IHdoaWxlICh0\ncnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmaW5hbGx5IHsKICAg\nICAgICAgICAgICAgIHNlc3MuY2xvc2UoKTsKICAgICAgICAgICAgICAgIGNv\nbi5jbG9zZSgpOwoKICAgICAgICAgICAgICAgIExPRy5pbmZvKHRvU3RyaW5n\nKCkgKyAiIE9GRkxJTkUuIik7CgogICAgICAgICAgICAgICAgLy8gQ2hlY2sg\naWYgdGhlIG1lc3NhZ2VzIGFyZSBpbiB0aGUgd2FpdGluZwogICAgICAgICAg\nICAgICAgLy8gbGlzdCBmb3IgbG9uZyB0aW1lLgogICAgICAgICAgICAgICAg\nTWVzc2FnZSB0b3BNZXNzYWdlID0gd2FpdGluZ0xpc3QucGVlaygpOwogICAg\nICAgICAgICAgICAgaWYgKHRvcE1lc3NhZ2UgIT0gbnVsbCkKICAgICAgICAg\nICAgICAgICAgICBjaGVja0RlbGl2ZXJ5VGltZSh0b3BNZXNzYWdlKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb25T\nZXJ2ZXJNZXNzYWdlKE1lc3NhZ2UgbWVzc2FnZSkgdGhyb3dzIEpNU0V4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIGlmIChCb29sZWFuLlRSVUUuZXF1YWxzKG1l\nc3NhZ2UuZ2V0T2JqZWN0UHJvcGVydHkoIkNPTU1JVCIpKSkgewogICAgICAg\nICAgICAgICAgaWYgKEJvb2xlYW4uVFJVRS5lcXVhbHMobWVzc2FnZS5nZXRP\nYmplY3RQcm9wZXJ0eSgiUkVMRVZBTlQiKSkpCiAgICAgICAgICAgICAgICAg\nICAgd2FpdGluZ0xpc3QuYWRkKG1lc3NhZ2UpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgU3RyaW5nIG1lc3Nh\nZ2VUeXBlID0gbWVzc2FnZS5nZXRTdHJpbmdQcm9wZXJ0eSgiVFlQRSIpOwog\nICAgICAgICAgICAgICAgaWYgKGNsaWVudFR5cGUuaXNSZWxldmFudChtZXNz\nYWdlVHlwZSkpCiAgICAgICAgICAgICAgICAgICAgd2FpdGluZ0xpc3QuYWRk\nKG1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBvbkNsaWVudE1lc3NhZ2UoTWVzc2FnZSBtZXNzYWdlKSB7\nCiAgICAgICAgICAgIE1lc3NhZ2Ugc2VydmVyTWVzc2FnZSA9IHdhaXRpbmdM\naXN0LnBvbGwoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIGlmIChzZXJ2ZXJNZXNzYWdlID09IG51bGwpCiAgICAgICAgICAgICAgICAg\nICAgZXhpdCgiIiArIHRoaXMgKyAiIGZhaWxlZDogVGhlcmUgaXMgbm8gbmV4\ndCBzZXJ2ZXIgbWVzc2FnZSwgYnV0IHJlY2VpdmVkOiAiICsgbWVzc2FnZSk7\nCgogICAgICAgICAgICAgICAgSW50ZWdlciByZWNlaXZlZElkID0gKEludGVn\nZXIpIG1lc3NhZ2UuZ2V0T2JqZWN0UHJvcGVydHkoIklEIik7CiAgICAgICAg\nICAgICAgICBJbnRlZ2VyIHNlcnZlcklkID0gKEludGVnZXIpIHNlcnZlck1l\nc3NhZ2UuZ2V0T2JqZWN0UHJvcGVydHkoIklEIik7CiAgICAgICAgICAgICAg\nICBpZiAocmVjZWl2ZWRJZCA9PSBudWxsIHx8IHNlcnZlcklkID09IG51bGwp\nCiAgICAgICAgICAgICAgICAgICAgZXhpdCgiIiArIHRoaXMgKyAiIGZhaWxl\nZDogbWVzc2FnZSBJRCBub3QgZm91bmQuXHJcbiIgKwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIiByZWNlaXZlZDogIiArIG1lc3NhZ2UgKyAiXHJc\nbiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiAgIHNlcnZlcjog\nIiArIHNlcnZlck1lc3NhZ2UpOwoKICAgICAgICAgICAgICAgIGlmICghc2Vy\ndmVySWQuZXF1YWxzKHJlY2VpdmVkSWQpKQogICAgICAgICAgICAgICAgICAg\nIGV4aXQoIiIgKyB0aGlzICsgIiBmYWlsZWQ6IFJlY2VpdmVkIHdyb25nIG1l\nc3NhZ2UuXHJcbiIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBy\nZWNlaXZlZDogIiArIG1lc3NhZ2UgKyAiXHJcbiIgKwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIiAgIHNlcnZlcjogIiArIHNlcnZlck1lc3NhZ2Up\nOwoKICAgICAgICAgICAgICAgIGNoZWNrRGVsaXZlcnlUaW1lKG1lc3NhZ2Up\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhdGNoIChUaHJvd2FibGUg\nZSkgewogICAgICAgICAgICAgICAgZXhpdCgiIiArIHRoaXMgKyAiLm9uQ2xp\nZW50TWVzc2FnZSBmYWlsZWQuXHJcbiIgKwogICAgICAgICAgICAgICAgICAg\nICAgICAiIHJlY2VpdmVkOiAiICsgbWVzc2FnZSArICJcclxuIiArCiAgICAg\nICAgICAgICAgICAgICAgICAgICIgICBzZXJ2ZXI6ICIgKyBzZXJ2ZXJNZXNz\nYWdlLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoq\nCiAgICAgICAgICogQ2hlY2tzIGlmIHRoZSBtZXNzYWdlIHdhcyBub3QgZGVs\naXZlcmVkIGZhc3QgZW5vdWdoLgogICAgICAgICAqLwogICAgICAgIHB1Ymxp\nYyB2b2lkIGNoZWNrRGVsaXZlcnlUaW1lKE1lc3NhZ2UgbWVzc2FnZSkgdGhy\nb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIGxvbmcgY3JlYXRpb24g\nPSBtZXNzYWdlLmdldEpNU1RpbWVzdGFtcCgpOwogICAgICAgICAgICAvLyAr\nIDEwMDAgZm9yIHRoZSB2YXJpb3VzIGFkZGl0aW9uYWwgc2V0dXAgdGltZXMg\ndGhhdCBhY3RpdmVtcSBzdXBwb3J0cyAoaWYgSSBhbSBub3Qgd3JvbmcgISkK\nICAgICAgICAgICAgbG9uZyBtaW4gPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxs\naXMoKSAtIG51bUl0ZXIgKiAoKG9mZmxpbmUubWF4ICsgb25saW5lLm1pbikg\nKyAxMDAwKTsKCiAgICAgICAgICAgIGlmIChtaW4gPiBjcmVhdGlvbikgewog\nICAgICAgICAgICAgICAgU2ltcGxlRGF0ZUZvcm1hdCBkZiA9IG5ldyBTaW1w\nbGVEYXRlRm9ybWF0KCJISDptbTpzcy5TU1MiKTsKICAgICAgICAgICAgICAg\nIGV4aXQoIiIgKyB0aGlzICsgIi5jaGVja0RlbGl2ZXJ5VGltZSBmYWlsZWQu\nIE1lc3NhZ2UgdGltZTogIiArIGRmLmZvcm1hdChuZXcgRGF0ZShjcmVhdGlv\nbikpCiAgICAgICAgICAgICAgICAgICAgICsgIiwgbWluOiAiICsgZGYuZm9y\nbWF0KG5ldyBEYXRlKG1pbikpICsgIlxyXG4iICsgbWVzc2FnZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHByaXZhdGUgQ29ubmVjdGlv\nbiBvcGVuQ29ubmVjdGlvbigpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAg\nICAgICAgICBDb25uZWN0aW9uIGNvbiA9IGNmLmNyZWF0ZUNvbm5lY3Rpb24o\nKTsKICAgICAgICAgICAgY29uLnNldENsaWVudElEKGNvbkNsaWVudElkKTsK\nICAgICAgICAgICAgY29uLnN0YXJ0KCk7CiAgICAgICAgICAgIHJldHVybiBj\nb247CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgc3Vic2NyaWJl\nKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIENvbm5lY3Rp\nb24gY29uID0gb3BlbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgU2Vzc2lv\nbiBzZXNzaW9uID0gY29uLmNyZWF0ZVNlc3Npb24oZmFsc2UsIFNlc3Npb24u\nQVVUT19BQ0tOT1dMRURHRSk7CiAgICAgICAgICAgIHNlc3Npb24uY3JlYXRl\nRHVyYWJsZVN1YnNjcmliZXIodG9waWMsIFNVQlNDUklQVElPTl9OQU1FLCBz\nZWxlY3RvciwgdHJ1ZSk7CiAgICAgICAgICAgIHNlc3Npb24uY2xvc2UoKTsK\nICAgICAgICAgICAgY29uLmNsb3NlKCk7CiAgICAgICAgfQoKICAgICAgICBw\ncml2YXRlIHZvaWQgdW5zdWJzY3JpYmUoKSB0aHJvd3MgSk1TRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIENvbm5lY3Rp\nb24gY29uID0gb3BlbkNvbm5lY3Rpb24oKTsKICAgICAgICAgICAgICAgIFNl\nc3Npb24gc2Vzc2lvbiA9IGNvbi5jcmVhdGVTZXNzaW9uKGZhbHNlLCBTZXNz\naW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAgICAgICAgICAgc2Vzc2lv\nbi51bnN1YnNjcmliZShTVUJTQ1JJUFRJT05fTkFNRSk7CiAgICAgICAgICAg\nICAgICBzZXNzaW9uLmNsb3NlKCk7CiAgICAgICAgICAgICAgICBjb24uY2xv\nc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSk1TRXhjZXB0aW9uIGpzRXgp\neyAvLyBpZ25vcmUKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsK\nICAgICAgICAgICAgcmV0dXJuICJDbGllbnRbaWQ9IiArIGlkICsgIiwgdHlw\nZT0iICsgY2xpZW50VHlwZSArICJdIjsKICAgICAgICB9CiAgICB9CgogICAg\nLyoqCiAgICAgKiBTd2VlcHMgb3V0IG5vdC11c2VkIGR1cmFibGUgc3Vic2Ny\naXB0aW9ucy4KICAgICAqLwogICAgcHJpdmF0ZSBmaW5hbCBjbGFzcyBIb3Vz\nZUtlZXBlciBleHRlbmRzIFRocmVhZCB7CgogICAgICAgIHByaXZhdGUgSG91\nc2VLZWVwZXIoKSB7CiAgICAgICAgICAgIHN1cGVyKCJIb3VzZUtlZXBlciIp\nOwogICAgICAgICAgICBzZXREYWVtb24odHJ1ZSk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgZmluYWwgQ29weU9uV3JpdGVBcnJheUxpc3Q8U3RyaW5n\nPiBhYmFuZG9uZWRTdWJzY3JpcHRpb25zID0gbmV3IENvcHlPbldyaXRlQXJy\nYXlMaXN0PFN0cmluZz4oKTsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICB3aGlsZSAodHJ1ZSkg\newogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBU\naHJlYWQuc2xlZXAoNjAgKiAxMDAwKTsKICAgICAgICAgICAgICAgICAgICBz\nd2VlcCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY2F0\nY2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgICAg\nICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBjYXRjaCAoVGhyb3dhYmxlIGUpIHsKICAgICAgICAgICAgICAgICAgICBF\neGNlcHRpb24gbG9nID0gbmV3IEV4Y2VwdGlvbigiSG91c2VLZWVwZXIgZmFp\nbGVkLiIsIGUpOwogICAgICAgICAgICAgICAgICAgIGxvZy5wcmludFN0YWNr\nVHJhY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHN3ZWVwKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIExPRy5pbmZvKCJIb3VzZWtlZXBlciBz\nd2VlcGluZy4iKTsKCiAgICAgICAgICAgIGludCBjbG9zZWQgPSAwOwogICAg\nICAgICAgICBBcnJheUxpc3Q8U3RyaW5nPiBzd2VlcGVkID0gbmV3IEFycmF5\nTGlzdDxTdHJpbmc+KCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBmb3IgKFN0cmluZyBjbGllbnRJZDogYWJhbmRvbmVkU3Vic2NyaXB0\naW9ucykgewogICAgICAgICAgICAgICAgICAgIHN3ZWVwZWQuYWRkKGNsaWVu\ndElkKTsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiU3dlZXBpbmcg\nb3V0IHN1YnNjcmlwdGlvbiBvZiAiICsgY2xpZW50SWQgKyAiLiIpOwogICAg\nICAgICAgICAgICAgICAgIGNsb3NlZCsrOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGZpbmFsbHkgewogICAgICAgICAg\nICAgICAgYWJhbmRvbmVkU3Vic2NyaXB0aW9ucy5yZW1vdmVBbGwoc3dlZXBl\nZCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5pbmZvKCJIb3Vz\nZWtlZXBlciBzd2VlcGVkIG91dCAiICsgY2xvc2VkICsgIiBzdWJzY3JpcHRp\nb25zLiIpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGlu\ndCByYW5kb20oaW50IG1heCkgewogICAgICAgIHJldHVybiAoaW50KSAoTWF0\naC5yYW5kb20oKSAqIChtYXggKyAxKSk7CiAgICB9CgogICAgcHVibGljIHN0\nYXRpYyBpbnQgcmFuZG9tKGludCBtaW4sIGludCBtYXgpIHsKICAgICAgICBy\nZXR1cm4gcmFuZG9tKG1heCAtIG1pbikgKyBtaW47CiAgICB9CgogICAgcHVi\nbGljIHN0YXRpYyB2b2lkIHNsZWVwUmFuZG9tKGludCBtYXhNaWxsaXMpIHRo\ncm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgVGhyZWFkLnNs\nZWVwKHJhbmRvbShtYXhNaWxsaXMpKTsKICAgIH0KCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgc2xlZXBSYW5kb20oaW50IG1pbk1pbGxpcywgaW50IG1heE1p\nbGxpcykgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBU\naHJlYWQuc2xlZXAocmFuZG9tKG1pbk1pbGxpcywgbWF4TWlsbGlzKSk7CiAg\nICB9CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBSYW5kb20gewoK\nICAgICAgICBmaW5hbCBpbnQgbWluOwogICAgICAgIGZpbmFsIGludCBtYXg7\nCgogICAgICAgIFJhbmRvbShpbnQgbWluLCBpbnQgbWF4KSB7CiAgICAgICAg\nICAgIHRoaXMubWluID0gbWluOwogICAgICAgICAgICB0aGlzLm1heCA9IG1h\neDsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBpbnQgbmV4dCgpIHsKICAg\nICAgICAgICAgcmV0dXJuIHJhbmRvbShtaW4sIG1heCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBzbGVlcFJhbmRvbSgpIHRocm93cyBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIER1cmFibGVTdWJQcm9j\nZXNzVGVzdC5zbGVlcFJhbmRvbShtaW4sIG1heCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBleGl0KFN0cmluZyBtZXNzYWdl\nKSB7CiAgICAgICAgZXhpdChtZXNzYWdlLCBudWxsKTsKICAgIH0KCiAgICBw\ndWJsaWMgc3RhdGljIHZvaWQgZXhpdChTdHJpbmcgbWVzc2FnZSwgVGhyb3dh\nYmxlIGUpIHsKICAgICAgICBUaHJvd2FibGUgbG9nID0gbmV3IFJ1bnRpbWVF\neGNlcHRpb24obWVzc2FnZSwgZSk7CiAgICAgICAgbG9nLnByaW50U3RhY2tU\ncmFjZSgpOwogICAgICAgIExPRy5lcnJvcihtZXNzYWdlLCBlKTsKICAgICAg\nICBleGNlcHRpb25zLmFkZChlKTsKICAgICAgICBmYWlsKG1lc3NhZ2UpOwog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHNldFVwKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgdG9waWMgPSAoVG9waWMpIGNyZWF0ZURlc3RpbmF0\naW9uKCk7CgogICAgICAgIGNsaWVudE1hbmFnZXIgPSBuZXcgQ2xpZW50TWFu\nYWdlcigpOwogICAgICAgIHNlcnZlciA9IG5ldyBTZXJ2ZXIoKTsKICAgICAg\nICBob3VzZUtlZXBlciA9IG5ldyBIb3VzZUtlZXBlcigpOwoKICAgICAgICBz\ndXBlci5zZXRVcCgpOwogICAgfQp9Cg==\n","encoding":"base64"}

