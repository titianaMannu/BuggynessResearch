{"sha":"b8d12da0fa03c9f4ac7c37eaa16999171a4b242d","node_id":"MDQ6QmxvYjE1NzU5NTY6YjhkMTJkYTBmYTAzYzlmNGFjN2MzN2VhYTE2OTk5MTcxYTRiMjQyZA==","size":7842,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b8d12da0fa03c9f4ac7c37eaa16999171a4b242d","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUgb3IgbW9yZQogKiBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlIGRpc3Ry\naWJ1dGVkIHdpdGgKICogdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLgogKiBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZSB0byBZb3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMAogKiAodGhlICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ug\nd2l0aAogKiB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBl\neHByZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhl\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQK\nICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdl\nIG9yZy5hcGFjaGUuYWN0aXZlbXEudXNlY2FzZXM7CgppbXBvcnQgc3RhdGlj\nIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0VHJ1ZTsKCmltcG9ydCBqYXZhLmlv\nLkZpbGU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsK\nCmltcG9ydCBqYXZheC5qbXMuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmF4Lmpt\ncy5Db25uZWN0aW9uRmFjdG9yeTsKaW1wb3J0IGphdmF4Lmptcy5KTVNFeGNl\ncHRpb247CmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZTsKaW1wb3J0IGphdmF4\nLmptcy5NZXNzYWdlQ29uc3VtZXI7CmltcG9ydCBqYXZheC5qbXMuTWVzc2Fn\nZVByb2R1Y2VyOwppbXBvcnQgamF2YXguam1zLlNlc3Npb247CmltcG9ydCBq\nYXZheC5qbXMuVG9waWM7CgppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuSm1z\nVGVzdEJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuU2Vzc2lv\nbkltcGw7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5qbXMuc3BpLkhlZHdp\nZ0Nvbm5lY3Rpb25GYWN0b3J5SW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUuYWN0\naXZlbXEudXRpbC5XYWl0OwppbXBvcnQgb3JnLmp1bml0LkFmdGVyOwppbXBv\ncnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0Owpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXJGYWN0b3J5OwoKcHVibGljIGNsYXNzIER1cmFibGVTdWJTZWxlY3RvckRl\nbGF5VGVzdCBleHRlbmRzIEptc1Rlc3RCYXNlIHsKCiAgICBwcml2YXRlIHN0\nYXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dn\nZXIoRHVyYWJsZVN1YlNlbGVjdG9yRGVsYXlUZXN0LmNsYXNzKTsKCiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGxvbmcgUlVOVElNRSA9IDMgKiA2MCAqIDEw\nMDA7CgogICAgcHJpdmF0ZSBUb3BpYyB0b3BpYzsKCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0UHJvY2VzcygpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBE\ndXJhYmxlU3Vic2NyaWJlciBzdWJzY3JpYmVyc1tdID0gbmV3IER1cmFibGVT\ndWJzY3JpYmVyWzEwXTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBz\ndWJzY3JpYmVycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBzdWJzY3Jp\nYmVyc1tpXSA9IG5ldyBEdXJhYmxlU3Vic2NyaWJlcihpKTsKICAgICAgICB9\nCgogICAgICAgIE1zZ1Byb2R1Y2VyIG1zZ1Byb2R1Y2VyID0gbmV3IE1zZ1By\nb2R1Y2VyKCk7CiAgICAgICAgbXNnUHJvZHVjZXIuc3RhcnQoKTsKCiAgICAg\nICAgZm9yIChpbnQgaSA9IDA7IGkgPCBzdWJzY3JpYmVycy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICBzdWJzY3JpYmVyc1tpXS5wcm9jZXNzKCk7CiAg\nICAgICAgfQoKCiAgICAgICAgLy8gd2FpdCBmb3Igc2VydmVyIHRvIGZpbmlz\naAogICAgICAgIG1zZ1Byb2R1Y2VyLmpvaW4oKTsKCiAgICAgICAgZm9yIChp\nbnQgaiA9IDA7IGogPCBzdWJzY3JpYmVycy5sZW5ndGg7IGorKykgewogICAg\nICAgICAgICBMT0cuaW5mbygiVW5zdWJzY3JpYmluZyBzdWJzY3JpYmVyICIg\nKyBzdWJzY3JpYmVyc1tqXSk7CiAgICAgICAgICAgIHN1YnNjcmliZXJzW2pd\nLnVuc3Vic2NyaWJlKCk7CiAgICAgICAgfQoKICAgICAgICAvLyBhbGxvdyB0\naGUgY2xlYW4gdXAgdGhyZWFkIHRpbWUgdG8gcnVuCiAgICAgICAgVGltZVVu\naXQuTUlOVVRFUy5zbGVlcCgyKTsKICAgICAgICBMT0cuaW5mbygiRE9ORS4i\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1lc3NhZ2UgUHJvZHVjZXIKICAg\nICAqLwogICAgZmluYWwgY2xhc3MgTXNnUHJvZHVjZXIgZXh0ZW5kcyBUaHJl\nYWQgewoKICAgICAgICBmaW5hbCBDb25uZWN0aW9uRmFjdG9yeSBjZiA9IG5l\ndyBIZWR3aWdDb25uZWN0aW9uRmFjdG9yeUltcGwoKTsKCiAgICAgICAgaW50\nIHRyYW5zUm92ZXIgPSAwOwogICAgICAgIGludCBtZXNzYWdlUm92ZXIgPSAw\nOwoKICAgICAgICBwdWJsaWMgTXNnUHJvZHVjZXIoKSB7CiAgICAgICAgICAg\nIHN1cGVyKCJNc2dQcm9kdWNlciIpOwogICAgICAgICAgICBzZXREYWVtb24o\ndHJ1ZSk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIGxvbmcgZW5kVGltZSA9\nIFJVTlRJTUUgKyBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKCiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB3aGlsZSAoZW5kVGltZSA+\nIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgVGhyZWFkLnNsZWVwKDQwMCk7CiAgICAgICAgICAgICAgICAgICAg\nc2VuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNo\nIChUaHJvd2FibGUgZSkgewogICAgICAgICAgICAgICBlLnByaW50U3RhY2tU\ncmFjZShTeXN0ZW0ub3V0KTsKICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJ1\nbnRpbWVFeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHNlbmQoKSB0aHJvd3MgSk1TRXhjZXB0aW9u\nIHsKCiAgICAgICAgICAgIGludCB0cmFucyA9ICsrdHJhbnNSb3ZlcjsKICAg\nICAgICAgICAgYm9vbGVhbiByZWxldmFudFRyYW5zID0gdHJ1ZTsKICAgICAg\nICAgICAgaW50IGNvdW50ID0gNDA7CgogICAgICAgICAgICBMT0cuaW5mbygi\nU2VuZGluZyBUcmFuc1tpZD0iICsgdHJhbnMgKyAiLCBjb3VudD0iCiAgICAg\nICAgICAgICAgICAgICAgKyBjb3VudCArICJdIik7CgogICAgICAgICAgICBD\nb25uZWN0aW9uIGNvbiA9IGNmLmNyZWF0ZUNvbm5lY3Rpb24oKTsKCiAgICAg\nICAgICAgIFNlc3Npb24gc2VzcyA9IGNvbi5jcmVhdGVTZXNzaW9uKGZhbHNl\nLCBTZXNzaW9uLkFVVE9fQUNLTk9XTEVER0UpOwoKICAgICAgICAgICAgTWVz\nc2FnZVByb2R1Y2VyIHByb2QgPSBzZXNzLmNyZWF0ZVByb2R1Y2VyKG51bGwp\nOwoKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjb3VudDsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBNZXNzYWdlIG1lc3NhZ2UgPSBzZXNzLmNy\nZWF0ZU1lc3NhZ2UoKTsKICAgICAgICAgICAgICAgIG1lc3NhZ2Uuc2V0SW50\nUHJvcGVydHkoIklEIiwgKyttZXNzYWdlUm92ZXIpOwogICAgICAgICAgICAg\nICAgbWVzc2FnZS5zZXRJbnRQcm9wZXJ0eSgiVFJBTlMiLCB0cmFucyk7CiAg\nICAgICAgICAgICAgICBtZXNzYWdlLnNldEJvb2xlYW5Qcm9wZXJ0eSgiUkVM\nRVZBTlQiLCBmYWxzZSk7CiAgICAgICAgICAgICAgICBwcm9kLnNlbmQodG9w\naWMsIG1lc3NhZ2UpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBNZXNz\nYWdlIG1lc3NhZ2UgPSBzZXNzLmNyZWF0ZU1lc3NhZ2UoKTsKICAgICAgICAg\nICAgbWVzc2FnZS5zZXRJbnRQcm9wZXJ0eSgiSUQiLCArK21lc3NhZ2VSb3Zl\ncik7CiAgICAgICAgICAgIG1lc3NhZ2Uuc2V0SW50UHJvcGVydHkoIlRSQU5T\nIiwgdHJhbnMpOwogICAgICAgICAgICBtZXNzYWdlLnNldEJvb2xlYW5Qcm9w\nZXJ0eSgiQ09NTUlUIiwgdHJ1ZSk7CiAgICAgICAgICAgIG1lc3NhZ2Uuc2V0\nQm9vbGVhblByb3BlcnR5KCJSRUxFVkFOVCIsIHJlbGV2YW50VHJhbnMpOwog\nICAgICAgICAgICBwcm9kLnNlbmQodG9waWMsIG1lc3NhZ2UpOwoKICAgICAg\nICAgICAgTE9HLmluZm8oIkNvbW1pdHRlZCBUcmFuc1tpZD0iICsgdHJhbnMg\nKyAiLCBjb3VudD0iCiAgICAgICAgICAgICAgICAgICAgKyBjb3VudCArICJd\nLCBJRD0iICsgbWVzc2FnZVJvdmVyKTsKCiAgICAgICAgICAgIHNlc3MuY2xv\nc2UoKTsKICAgICAgICAgICAgY29uLmNsb3NlKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogQ29uc3VtZXMgbWFzc2FnZXMgZnJvbSBhIGR1\ncmFibGUgc3Vic2NyaXB0aW9uLiBHb2VzIG9ubGluZS9vZmZsaW5lCiAgICAg\nKiBwZXJpb2RpY2FsbHkuIENoZWNrcyB0aGUgaW5jb21pbmcgbWVzc2FnZXMg\nYWdhaW5zdCB0aGUgc2VudCBtZXNzYWdlcyBvZgogICAgICogdGhlIHNlcnZl\nci4KICAgICAqLwogICAgcHJpdmF0ZSBmaW5hbCBjbGFzcyBEdXJhYmxlU3Vi\nc2NyaWJlciB7CgogICAgICAgIGZpbmFsIENvbm5lY3Rpb25GYWN0b3J5IGNm\nID0gbmV3IEhlZHdpZ0Nvbm5lY3Rpb25GYWN0b3J5SW1wbCgpOwoKICAgICAg\nICBwcml2YXRlIGZpbmFsIFN0cmluZyBzdWJOYW1lIDsKCiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBpbnQgaWQ7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJp\nbmcgY29uQ2xpZW50SWQ7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcg\nc2VsZWN0b3I7CgogICAgICAgIHByaXZhdGUgZmluYWwgU2Vzc2lvbiBzZXNz\nOwogICAgICAgIHByaXZhdGUgZmluYWwgTWVzc2FnZUNvbnN1bWVyIGNvbnN1\nbWVyOwogICAgICAgIHByaXZhdGUgZmluYWwgQ29ubmVjdGlvbiBjb247Cgog\nICAgICAgIHB1YmxpYyBEdXJhYmxlU3Vic2NyaWJlcihpbnQgaWQpIHRocm93\ncyBKTVNFeGNlcHRpb24gewogICAgICAgICAgICB0aGlzLmlkID0gaWQ7CiAg\nICAgICAgICAgIGNvbkNsaWVudElkID0gImNsaSIgKyBpZDsKICAgICAgICAg\nICAgc3ViTmFtZSA9ICJzdWJzY3JpcHRpb24iKyBpZDsKICAgICAgICAgICAg\nc2VsZWN0b3IgPSJSRUxFVkFOVCA9IHRydWUiOwogICAgICAgICAgICBjb24g\nPSBvcGVuQ29ubmVjdGlvbigpOwogICAgICAgICAgICBzZXNzID0gY29uLmNy\nZWF0ZVNlc3Npb24oZmFsc2UsIFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7\nCiAgICAgICAgICAgIGNvbnN1bWVyID0gc2Vzcy5jcmVhdGVEdXJhYmxlU3Vi\nc2NyaWJlcih0b3BpYywgc3ViTmFtZSwgc2VsZWN0b3IsIGZhbHNlKTsKCiAg\nICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgcHJvY2VzcygpIHRocm93\ncyBKTVNFeGNlcHRpb24gewogICAgICAgICAgICBsb25nIGVuZCA9IFN5c3Rl\nbS5jdXJyZW50VGltZU1pbGxpcygpICsgMjAwMDA7CiAgICAgICAgICAgIGlu\ndCB0cmFuc0NvdW50ID0gMDsKCiAgICAgICAgICAgIExPRy5pbmZvKHRvU3Ry\naW5nKCkgKyAiIE9OTElORS4iKTsKCiAgICAgICAgICAgIHRyeSB7CgogICAg\nICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgICAgICAgIGxvbmcgbWF4\nID0gZW5kIC0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CgogICAgICAg\nICAgICAgICAgICAgIGlmIChtYXggPD0gMCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgICAgICBNZXNzYWdlIG1lc3NhZ2UgPSBjb25zdW1lci5y\nZWNlaXZlKG1heCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1lc3NhZ2Ug\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIExP\nRy5pbmZvKCJSZWNlaXZlZCBUcmFuc1tpZD0iCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIG1lc3NhZ2UuZ2V0SW50UHJvcGVydHkoIlRSQU5TIikg\nKyAiLCBjb3VudD0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRy\nYW5zQ291bnQgKyAiXSBpbiAiICsgdGhpcyArICIuIik7CgogICAgICAgICAg\nICAgICAgfSB3aGlsZSAodHJ1ZSk7CgogICAgICAgICAgICB9IGZpbmFsbHkg\newogICAgICAgICAgICAgICAgc2Vzcy5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgY29uLmNsb3NlKCk7CgogICAgICAgICAgICAgICAgTE9HLmluZm8odG9T\ndHJpbmcoKSArICIgT0ZGTElORS4iKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSBDb25uZWN0aW9uIG9wZW5Db25uZWN0aW9u\nKCkgdGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIENvbm5lY3Rp\nb24gY29uID0gY2YuY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgICAgICBj\nb24uc2V0Q2xpZW50SUQoY29uQ2xpZW50SWQpOwogICAgICAgICAgICBjb24u\nc3RhcnQoKTsKICAgICAgICAgICAgcmV0dXJuIGNvbjsKICAgICAgICB9Cgog\nICAgICAgIHByaXZhdGUgdm9pZCB1bnN1YnNjcmliZSgpIHRocm93cyBKTVNF\neGNlcHRpb24gewogICAgICAgICAgICBDb25uZWN0aW9uIGNvbiA9IG9wZW5D\nb25uZWN0aW9uKCk7CiAgICAgICAgICAgIFNlc3Npb24gc2Vzc2lvbiA9IGNv\nbgogICAgICAgICAgICAgICAgICAgIC5jcmVhdGVTZXNzaW9uKGZhbHNlLCBT\nZXNzaW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAgICAgICAvLyBDYWxs\nIGEgZHVtbXAgY3JlYXRlRHVyYWJsZVN1YnNjcmliZXIgKG8uYS5oLmptcy5w\nYWNrYWdlLWluZm8uaHRtbCBmb3IgbW9yZSBvbiB3aHkpLgogICAgICAgICAg\nICBzZXNzaW9uLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKHRvcGljLCBzdWJO\nYW1lLCBzZWxlY3RvciwgZmFsc2UpOwogICAgICAgICAgICBzZXNzaW9uLnVu\nc3Vic2NyaWJlKHN1Yk5hbWUpOwogICAgICAgICAgICBzZXNzaW9uLmNsb3Nl\nKCk7CiAgICAgICAgICAgIGNvbi5jbG9zZSgpOwogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygp\nIHsKICAgICAgICAgICAgcmV0dXJuICJEdXJhYmxlU3Vic2NyaWJlcltpZD0i\nICsgaWQgKyAiXSI7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc2V0\nVXAoKTsKICAgICAgICB0b3BpYyA9IFNlc3Npb25JbXBsLmFzVG9waWMoIlRv\ncGljVCIpOwogICAgfQoKICAgIHB1YmxpYyBTdHJpbmcgZ2V0TmFtZSgpIHsK\nICAgICAgICByZXR1cm4gIkR1cmFibGVTdWJTZWxlY3RvckRlbGF5VGVzdCI7\nCiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgYm9vbGVhbiBkZWxldGUoRmls\nZSBwYXRoKSB7CiAgICAgICAgaWYgKHBhdGggPT0gbnVsbCkKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CgogICAgICAgIGlmIChwYXRoLmlzRGlyZWN0b3J5\nKCkpIHsKICAgICAgICAgICAgZm9yIChGaWxlIGZpbGUgOiBwYXRoLmxpc3RG\naWxlcygpKSB7CiAgICAgICAgICAgICAgICBkZWxldGUoZmlsZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBhdGguZGVsZXRl\nKCk7CiAgICB9Cn0K\n","encoding":"base64"}

