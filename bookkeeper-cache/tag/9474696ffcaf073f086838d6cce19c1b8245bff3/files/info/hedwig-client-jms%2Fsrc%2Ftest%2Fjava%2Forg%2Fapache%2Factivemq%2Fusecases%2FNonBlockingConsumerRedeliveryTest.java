{"sha":"adfb47dc7c0df2a11613fd6caf83a89c71a3978d","node_id":"MDQ6QmxvYjE1NzU5NTY6YWRmYjQ3ZGM3YzBkZjJhMTE2MTNmZDZjYWY4M2E4OWM3MWEzOTc4ZA==","size":13019,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/adfb47dc7c0df2a11613fd6caf83a89c71a3978d","content":"LyogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZSBvciBtb3JlCiAqIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUgZGlzdHJpYnV0\nZWQgd2l0aAogKiB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24gcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuCiAqIFRoZSBBU0Yg\nbGljZW5zZXMgdGhpcyBmaWxlIHRvIFlvdSB1bmRlciB0aGUgQXBhY2hlIExp\nY2Vuc2UsIFZlcnNpb24gMi4wCiAqICh0aGUgIkxpY2Vuc2UiKTsgeW91IG1h\neSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRo\nCiAqIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRo\nZSBMaWNlbnNlIGF0CiAqCiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3Jn\nL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBi\neSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29m\ndHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlz\ndHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJS\nQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHBy\nZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNw\nZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICog\nbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwpwYWNrYWdlIG9y\nZy5hcGFjaGUuYWN0aXZlbXEudXNlY2FzZXM7CgoKaW1wb3J0IGphdmF4Lmpt\ncy5UZXh0TWVzc2FnZTsKaW1wb3J0IGphdmF4Lmptcy5Ub3BpYzsKaW1wb3J0\nIHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0Lio7CgppbXBvcnQgamF2YS51dGls\nLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1w\nb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoU2V0OwppbXBvcnQgamF2YS51dGls\nLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsK\nCmltcG9ydCBqYXZheC5qbXMuQ29ubmVjdGlvbjsKaW1wb3J0IGphdmF4Lmpt\ncy5EZXN0aW5hdGlvbjsKaW1wb3J0IGphdmF4Lmptcy5KTVNFeGNlcHRpb247\nCmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZTsKaW1wb3J0IGphdmF4Lmptcy5N\nZXNzYWdlQ29uc3VtZXI7CmltcG9ydCBqYXZheC5qbXMuTWVzc2FnZUxpc3Rl\nbmVyOwppbXBvcnQgamF2YXguam1zLk1lc3NhZ2VQcm9kdWNlcjsKaW1wb3J0\nIGphdmF4Lmptcy5TZXNzaW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLkptc1Rlc3RCYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuam1zLnNw\naS5IZWR3aWdDb25uZWN0aW9uSW1wbDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLmptcy5zcGkuSGVkd2lnQ29ubmVjdGlvbkZhY3RvcnlJbXBsOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuYWN0aXZlbXEudXRpbC5XYWl0OwppbXBvcnQgb3Jn\nLmp1bml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0\nIG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKcHVibGljIGNsYXNzIE5v\nbkJsb2NraW5nQ29uc3VtZXJSZWRlbGl2ZXJ5VGVzdCBleHRlbmRzIEptc1Rl\nc3RCYXNlIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExvZ2dlciBMT0cg\nPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihOb25CbG9ja2luZ0NvbnN1bWVy\nUmVkZWxpdmVyeVRlc3QuY2xhc3MpOwoKICAgIHByaXZhdGUgZmluYWwgU3Ry\naW5nIGRlc3RpbmF0aW9uTmFtZSA9ICJEZXN0aW5hdGlvbiI7CiAgICAvLyBw\ncml2YXRlIGZpbmFsIGludCBNU0dfQ09VTlQgPSAxMDA7CgogICAgcHJpdmF0\nZSBIZWR3aWdDb25uZWN0aW9uRmFjdG9yeUltcGwgY29ubmVjdGlvbkZhY3Rv\ncnk7CgogICAgcHVibGljIHZvaWQgdGVzdE1lc3NhZ2VEZWxlaXZlcmVkV2hl\nbk5vbkJsb2NraW5nRW5hYmxlZCgpIHRocm93cyBFeGNlcHRpb24gewoKICAg\nICAgICBmaW5hbCBMaXN0PFN0cmluZz4gcmVjZWl2ZWQgPSBuZXcgQXJyYXlM\naXN0PFN0cmluZz4oMTYpOwogICAgICAgIGZpbmFsIExpc3Q8U3RyaW5nPiBi\nZWZvcmVSb2xsYmFjayA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigxNik7CiAg\nICAgICAgZmluYWwgTGlzdDxTdHJpbmc+IGFmdGVyUm9sbGJhY2sgPSBuZXcg\nQXJyYXlMaXN0PFN0cmluZz4oMTYpOwoKICAgICAgICBIZWR3aWdDb25uZWN0\naW9uSW1wbCBjb25uZWN0aW9uID0gY29ubmVjdGlvbkZhY3RvcnkuY3JlYXRl\nQ29ubmVjdGlvbigpOwogICAgICAgIFNlc3Npb24gc2Vzc2lvbiA9IGNvbm5l\nY3Rpb24uY3JlYXRlU2Vzc2lvbih0cnVlLCBTZXNzaW9uLkFVVE9fQUNLTk9X\nTEVER0UpOwogICAgICAgIERlc3RpbmF0aW9uIGRlc3RpbmF0aW9uID0gc2Vz\nc2lvbi5jcmVhdGVUb3BpYyhkZXN0aW5hdGlvbk5hbWUpOwogICAgICAgIE1l\nc3NhZ2VDb25zdW1lciBjb25zdW1lciA9IHNlc3Npb24uY3JlYXRlQ29uc3Vt\nZXIoZGVzdGluYXRpb24pOwoKICAgICAgICBjb25zdW1lci5zZXRNZXNzYWdl\nTGlzdGVuZXIobmV3IE1lc3NhZ2VMaXN0ZW5lcigpIHsKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9uTWVzc2FnZShN\nZXNzYWdlIG1lc3NhZ2UpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgcmVjZWl2ZWQuYWRkKCgoVGV4dE1lc3NhZ2UpIG1l\nc3NhZ2UpLmdldFRleHQoKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChK\nTVNFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIC8vIHNob3Vs\nZCBub3QgaGFwcGVuIC4uLgogICAgICAgICAgICAgICAgICAgIGUucHJpbnRT\ndGFja1RyYWNlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9KTsKCiAgICAgICAgZmluYWwgaW50IE1TR19DT1VOVCA9IGNv\nbm5lY3Rpb24uZ2V0SGVkd2lnQ2xpZW50Q29uZmlnKCkuZ2V0TWF4aW11bU91\ndHN0YW5kaW5nTWVzc2FnZXMoKSAtIDE7CgogICAgICAgIHNlbmRNZXNzYWdl\ncyhNU0dfQ09VTlQpOwoKICAgICAgICBzZXNzaW9uLmNvbW1pdCgpOwogICAg\nICAgIGNvbm5lY3Rpb24uc3RhcnQoKTsKCgogICAgICAgIFdhaXQud2FpdEZv\ncihuZXcgV2FpdC5Db25kaXRpb24oKSB7CiAgICAgICAgICAgIHB1YmxpYyBi\nb29sZWFuIGlzU2F0aXNpZmllZCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgTE9HLmluZm8oIkNvbnN1bWVyIGhhcyByZWNlaXZlZCAi\nICsgcmVjZWl2ZWQuc2l6ZSgpICsgIiBtZXNzYWdlcy4iKTsKICAgICAgICAg\nICAgICAgIHJldHVybiByZWNlaXZlZC5zaXplKCkgPT0gTVNHX0NPVU5UOwog\nICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGFzc2VydFRydWUo\nIlByZS1Sb2xsYmFjayBleHBlY3RzIHRvIHJlY2VpdmU6ICIgKyBNU0dfQ09V\nTlQgKyAiIG1lc3NhZ2VzLCBnb3QgIgogICAgICAgICAgICAgICAgICAgKyBy\nZWNlaXZlZC5zaXplKCkgKyAiLiIsTVNHX0NPVU5UID09IHJlY2VpdmVkLnNp\nemUoKSk7CgogICAgICAgIGJlZm9yZVJvbGxiYWNrLmFkZEFsbChyZWNlaXZl\nZCk7CiAgICAgICAgcmVjZWl2ZWQuY2xlYXIoKTsKICAgICAgICBzZXNzaW9u\nLnJvbGxiYWNrKCk7CgogICAgICAgIGFzc2VydFRydWUoIlBvc3QtUm9sbGJh\nY2sgZXhwZWN0cyB0byByZWNlaXZlOiAiICsgTVNHX0NPVU5UICsgIiBtZXNz\nYWdlcy4iLAogICAgICAgICAgICBXYWl0LndhaXRGb3IobmV3IFdhaXQuQ29u\nZGl0aW9uKCl7CiAgICAgICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1Nh\ndGlzaWZpZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAg\nICAgICBMT0cuaW5mbygiQ29uc3VtZXIgaGFzIHJlY2VpdmVkICIgKyByZWNl\naXZlZC5zaXplKCkgKyAiIG1lc3NhZ2VzIHNpbmNlIHJvbGxiYWNrLiIpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlZC5zaXplKCkgPT0g\nTVNHX0NPVU5UOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgKSk7CgogICAgICAgIGFmdGVyUm9sbGJhY2suYWRkQWxsKHJlY2Vp\ndmVkKTsKICAgICAgICByZWNlaXZlZC5jbGVhcigpOwoKICAgICAgICBhc3Nl\ncnRFcXVhbHMoYmVmb3JlUm9sbGJhY2suc2l6ZSgpLCBhZnRlclJvbGxiYWNr\nLnNpemUoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKGJlZm9yZVJvbGxiYWNr\nLCBhZnRlclJvbGxiYWNrKTsKICAgICAgICBzZXNzaW9uLmNvbW1pdCgpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RNZXNzYWdlRGVsZWl2ZXJ5RG9l\nc250U3RvcCgpIHRocm93cyBFeGNlcHRpb24gewoKICAgICAgICBmaW5hbCBM\naXN0PFN0cmluZz4gcmVjZWl2ZWQgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6\nZWRMaXN0KG5ldyBBcnJheUxpc3Q8U3RyaW5nPigxNikpOwogICAgICAgIGZp\nbmFsIExpc3Q8U3RyaW5nPiBiZWZvcmVSb2xsYmFjayA9IG5ldyBBcnJheUxp\nc3Q8U3RyaW5nPigxNik7CiAgICAgICAgZmluYWwgTGlzdDxTdHJpbmc+IGFm\ndGVyUm9sbGJhY2sgPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oMTYpOwoKICAg\nICAgICBIZWR3aWdDb25uZWN0aW9uSW1wbCBjb25uZWN0aW9uID0gY29ubmVj\ndGlvbkZhY3RvcnkuY3JlYXRlQ29ubmVjdGlvbigpOwogICAgICAgIFNlc3Np\nb24gc2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRlU2Vzc2lvbih0cnVlLCBT\nZXNzaW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAgIERlc3RpbmF0aW9u\nIGRlc3RpbmF0aW9uID0gc2Vzc2lvbi5jcmVhdGVUb3BpYyhkZXN0aW5hdGlv\nbk5hbWUpOwogICAgICAgIE1lc3NhZ2VDb25zdW1lciBjb25zdW1lciA9IHNl\nc3Npb24uY3JlYXRlQ29uc3VtZXIoZGVzdGluYXRpb24pOwoKICAgICAgICBj\nb25zdW1lci5zZXRNZXNzYWdlTGlzdGVuZXIobmV3IE1lc3NhZ2VMaXN0ZW5l\ncigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIG9uTWVzc2FnZShNZXNzYWdlIG1lc3NhZ2UpIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgcmVjZWl2ZWQuYWRk\nKCgoVGV4dE1lc3NhZ2UpIG1lc3NhZ2UpLmdldFRleHQoKSk7CiAgICAgICAg\nICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgICAgIC8vIHNob3VsZCBub3QgaGFwcGVuCiAgICAgICAgICAgICAg\nICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICBmaW5hbCBpbnQg\nTVNHX0NPVU5UID0gY29ubmVjdGlvbi5nZXRIZWR3aWdDbGllbnRDb25maWco\nKS5nZXRNYXhpbXVtT3V0c3RhbmRpbmdNZXNzYWdlcygpIC8gMiAtIDE7Cgog\nICAgICAgIHNlbmRNZXNzYWdlcyhNU0dfQ09VTlQpOwogICAgICAgIGNvbm5l\nY3Rpb24uc3RhcnQoKTsKCiAgICAgICAgYXNzZXJ0VHJ1ZSgiUHJlLVJvbGxi\nYWNrIGV4cGVjdHMgdG8gcmVjZWl2ZTogIiArIE1TR19DT1VOVCArICIgbWVz\nc2FnZXMuIiwKICAgICAgICAgICAgV2FpdC53YWl0Rm9yKG5ldyBXYWl0LkNv\nbmRpdGlvbigpewogICAgICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaXNT\nYXRpc2lmaWVkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAg\nICAgICAgTE9HLmluZm8oIkNvbnN1bWVyIGhhcyByZWNlaXZlZCAiICsgcmVj\nZWl2ZWQuc2l6ZSgpICsgIiBtZXNzYWdlcy4iKTsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gcmVjZWl2ZWQuc2l6ZSgpID09IE1TR19DT1VOVDsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICkpOwoKICAg\nICAgICBiZWZvcmVSb2xsYmFjay5hZGRBbGwocmVjZWl2ZWQpOwogICAgICAg\nIHJlY2VpdmVkLmNsZWFyKCk7CiAgICAgICAgc2Vzc2lvbi5yb2xsYmFjaygp\nOwoKICAgICAgICBzZW5kTWVzc2FnZXMoTVNHX0NPVU5UKTsKCiAgICAgICAg\newogICAgICAgICAgICBib29sZWFuIG1lc3NhZ2VzUmVjZWl2ZWQgPSBXYWl0\nLndhaXRGb3IobmV3IFdhaXQuQ29uZGl0aW9uKCl7CiAgICAgICAgICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc1NhdGlzaWZpZWQoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiQ29uc3VtZXIg\naGFzIHJlY2VpdmVkICIgKyByZWNlaXZlZC5zaXplKCkgKyAiIG1lc3NhZ2Vz\nIHNpbmNlIHJvbGxiYWNrLiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbiByZWNlaXZlZC5zaXplKCkgPT0gTVNHX0NPVU5UICogMjsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGFzc2VydFRy\ndWUoIlBvc3QtUm9sbGJhY2sgZXhwZWN0cyB0byByZWNlaXZlOiAiICsgTVNH\nX0NPVU5UICsgIiBtZXNzYWdlcywgcmVjZWl2ZWQgIgogICAgICAgICAgICAg\nICAgICAgICAgICsgcmVjZWl2ZWQuc2l6ZSgpICsgIiBtZXNzYWdlcy4iLCBt\nZXNzYWdlc1JlY2VpdmVkKTsKICAgICAgICB9CgogICAgICAgIGFmdGVyUm9s\nbGJhY2suYWRkQWxsKHJlY2VpdmVkKTsKICAgICAgICByZWNlaXZlZC5jbGVh\ncigpOwoKICAgICAgICBhc3NlcnRFcXVhbHMoYmVmb3JlUm9sbGJhY2suc2l6\nZSgpICogMiwgYWZ0ZXJSb2xsYmFjay5zaXplKCkpOwoKICAgICAgICBzZXNz\naW9uLmNvbW1pdCgpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3ROb25C\nbG9ja2luZ01lc3NhZ2VEZWxlaXZlcnlJc0RlbGF5ZWQoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBmaW5hbCBMaXN0PFN0cmluZz4gcmVjZWl2ZWQg\nPSBuZXcgQXJyYXlMaXN0PFN0cmluZz4oMTYpOwoKICAgICAgICBIZWR3aWdD\nb25uZWN0aW9uSW1wbCBjb25uZWN0aW9uID0gKEhlZHdpZ0Nvbm5lY3Rpb25J\nbXBsKSBjb25uZWN0aW9uRmFjdG9yeS5jcmVhdGVDb25uZWN0aW9uKCk7CiAg\nICAgICAgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVTZXNz\naW9uKHRydWUsIFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAgICAg\nRGVzdGluYXRpb24gZGVzdGluYXRpb24gPSBzZXNzaW9uLmNyZWF0ZVRvcGlj\nKGRlc3RpbmF0aW9uTmFtZSk7CiAgICAgICAgTWVzc2FnZUNvbnN1bWVyIGNv\nbnN1bWVyID0gc2Vzc2lvbi5jcmVhdGVDb25zdW1lcihkZXN0aW5hdGlvbik7\nCgogICAgICAgIGNvbnN1bWVyLnNldE1lc3NhZ2VMaXN0ZW5lcihuZXcgTWVz\nc2FnZUxpc3RlbmVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgb25NZXNzYWdlKE1lc3NhZ2UgbWVzc2FnZSkg\newogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBy\nZWNlaXZlZC5hZGQoKChUZXh0TWVzc2FnZSkgbWVzc2FnZSkuZ2V0VGV4dCgp\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEpNU0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gc2hvdWxkIG5vdCBoYXBwZW4KICAg\nICAgICAgICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAg\nIGZpbmFsIGludCBNU0dfQ09VTlQgPSBjb25uZWN0aW9uLmdldEhlZHdpZ0Ns\naWVudENvbmZpZygpLmdldE1heGltdW1PdXRzdGFuZGluZ01lc3NhZ2VzKCkg\nLSAxOwoKICAgICAgICBzZW5kTWVzc2FnZXMoTVNHX0NPVU5UKTsKICAgICAg\nICBjb25uZWN0aW9uLnN0YXJ0KCk7CgogICAgICAgIGFzc2VydFRydWUoIlBy\nZS1Sb2xsYmFjayBleHBlY3RzIHRvIHJlY2VpdmU6ICIgKyBNU0dfQ09VTlQg\nKyAiIG1lc3NhZ2VzLiIsCiAgICAgICAgICAgIFdhaXQud2FpdEZvcihuZXcg\nV2FpdC5Db25kaXRpb24oKXsKICAgICAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGlzU2F0aXNpZmllZCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICAgICAgICAgIExPRy5pbmZvKCJDb25zdW1lciBoYXMgcmVjZWl2ZWQg\nIiArIHJlY2VpdmVkLnNpemUoKSArICIgbWVzc2FnZXMuIik7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVkLnNpemUoKSA9PSBNU0dfQ09V\nTlQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAp\nKTsKCiAgICAgICAgcmVjZWl2ZWQuY2xlYXIoKTsKICAgICAgICBzZXNzaW9u\nLnJvbGxiYWNrKCk7CgogICAgICAgIHsKICAgICAgICAgICAgYm9vbGVhbiBj\nb25kaXRpb24gPSBXYWl0LndhaXRGb3IobmV3IFdhaXQuQ29uZGl0aW9uKCkg\newogICAgICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaXNTYXRpc2lmaWVk\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICAgICAgcmV0\ndXJuIHJlY2VpdmVkLnNpemUoKSA+IDA7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0sIFRpbWVVbml0LlNFQ09ORFMudG9NaWxsaXMoNCkKICAg\nICAgICAgICAgKTsKICAgICAgICAgICAgLy8gV2UgZG8gbm90IGhhdmUgYW55\nIG5vdGlvbiBvZiBkZWxheWluZyByZWRlcmxpdmVyeSAtIHNvIHdlIGltbWVk\naWF0ZWx5IGdldCB0aGUgbWVzc2FnZSAodW5saWtlIGFjdGl2ZW1xJ3MKICAg\nICAgICAgICAgLy8gY29ubmVjdGlvbi5nZXRSZWRlbGl2ZXJ5UG9saWN5KCku\nc2V0SW5pdGlhbFJlZGVsaXZlcnlEZWxheShUaW1lVW5pdC5TRUNPTkRTLnRv\nTWlsbGlzKDYpKTsKICAgICAgICAgICAgLy8gYXNzZXJ0RmFsc2UoIkRlbGF5\nZWQgcmVkZWxpdmVyeSB0ZXN0IG5vdCBleHBlY3RpbmcgYW55IG1lc3NhZ2Vz\nIHlldC4gZ290ICIKICAgICAgICAgICAgLy8gKyByZWNlaXZlZC5zaXplKCkg\nKyAiIG1lc3NhZ2VzIiwgY29uZGl0aW9uKTsKICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZSgiUm9sbGJhY2sgZXhwZWN0cyB0byByZWNlaXZlOiAiICsgTVNHX0NP\nVU5UICsgIiBtZXNzYWdlcy4iLAogICAgICAgICAgICAgICAgV2FpdC53YWl0\nRm9yKG5ldyBXYWl0LkNvbmRpdGlvbigpewogICAgICAgICAgICAgICAgICAg\nIHB1YmxpYyBib29sZWFuIGlzU2F0aXNpZmllZCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiQ29uc3Vt\nZXIgaGFzIHJlY2VpdmVkICIgKyByZWNlaXZlZC5zaXplKCkgKyAiIG1lc3Nh\nZ2VzLiIpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVjZWl2\nZWQuc2l6ZSgpID09IE1TR19DT1VOVDsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkpOwogICAgICAgIH0K\nCiAgICAgICAgc2Vzc2lvbi5jb21taXQoKTsKICAgICAgICBzZXNzaW9uLmNs\nb3NlKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgdGVzdE5vbkJsb2NraW5n\nTWVzc2FnZURlbGVpdmVyeVdpdGhSb2xsYmFja3MoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBmaW5hbCBMaXN0PFN0cmluZz4gcmVjZWl2ZWQgPSBu\nZXcgQXJyYXlMaXN0PFN0cmluZz4oMTYpOwoKICAgICAgICBIZWR3aWdDb25u\nZWN0aW9uSW1wbCBjb25uZWN0aW9uID0gKEhlZHdpZ0Nvbm5lY3Rpb25JbXBs\nKSBjb25uZWN0aW9uRmFjdG9yeS5jcmVhdGVDb25uZWN0aW9uKCk7CiAgICAg\nICAgZmluYWwgU2Vzc2lvbiBzZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVT\nZXNzaW9uKHRydWUsIFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CiAgICAg\nICAgZmluYWwgRGVzdGluYXRpb24gZGVzdGluYXRpb24gPSBzZXNzaW9uLmNy\nZWF0ZVRvcGljKGRlc3RpbmF0aW9uTmFtZSk7CiAgICAgICAgZmluYWwgTWVz\nc2FnZUNvbnN1bWVyIGNvbnN1bWVyID0gc2Vzc2lvbi5jcmVhdGVDb25zdW1l\ncihkZXN0aW5hdGlvbik7CgogICAgICAgIGNvbnN1bWVyLnNldE1lc3NhZ2VM\naXN0ZW5lcihuZXcgTWVzc2FnZUxpc3RlbmVyKCkgewogICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb25NZXNzYWdlKE1l\nc3NhZ2UgbWVzc2FnZSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICByZWNlaXZlZC5hZGQoKChUZXh0TWVzc2FnZSkgbWVz\nc2FnZSkuZ2V0VGV4dCgpKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEpN\nU0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2hvdWxk\nIG5vdCBoYXBwZW4KICAgICAgICAgICAgICAgICAgICBlLnByaW50U3RhY2tU\ncmFjZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfSk7CgogICAgICAgIGZpbmFsIGludCBNU0dfQ09VTlQgPSBjb25uZWN0\naW9uLmdldEhlZHdpZ0NsaWVudENvbmZpZygpLmdldE1heGltdW1PdXRzdGFu\nZGluZ01lc3NhZ2VzKCkgLSAxOwoKICAgICAgICBzZW5kTWVzc2FnZXMoTVNH\nX0NPVU5UKTsKICAgICAgICBjb25uZWN0aW9uLnN0YXJ0KCk7CgogICAgICAg\nIGFzc2VydFRydWUoIlByZS1Sb2xsYmFjayBleHBlY3RzIHRvIHJlY2VpdmU6\nICIgKyBNU0dfQ09VTlQgKyAiIG1lc3NhZ2VzLiIsCiAgICAgICAgICAgIFdh\naXQud2FpdEZvcihuZXcgV2FpdC5Db25kaXRpb24oKXsKICAgICAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGlzU2F0aXNpZmllZCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgICAgICAgICAgICAgIExPRy5pbmZvKCJDb25zdW1l\nciBoYXMgcmVjZWl2ZWQgIiArIHJlY2VpdmVkLnNpemUoKSArICIgbWVzc2Fn\nZXMuIik7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY2VpdmVkLnNp\nemUoKSA9PSBNU0dfQ09VTlQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICApKTsKCiAgICAgICAgcmVjZWl2ZWQuY2xlYXIoKTsK\nCiAgICAgICAgY29uc3VtZXIuc2V0TWVzc2FnZUxpc3RlbmVyKG5ldyBNZXNz\nYWdlTGlzdGVuZXIoKSB7CgogICAgICAgICAgICBpbnQgY291bnQgPSAwOwoK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIG9uTWVzc2FnZShNZXNzYWdlIG1lc3NhZ2UpIHsKCiAgICAgICAgICAgICAg\nICBpZiAoKytjb3VudCA+IDEwKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5yb2xsYmFjaygp\nOwogICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiUm9sbGluZyBi\nYWNrIHNlc3Npb24uIik7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50\nID0gMDsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChKTVNFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQ2F1\nZ2h0IGFuIHVuZXhjZXB0ZWQgZXhjZXB0aW9uOiAiICsgZS5nZXRNZXNzYWdl\nKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICAgICAgcmVjZWl2ZWQuYWRkKCgoVGV4dE1lc3NhZ2UpIG1lc3Nh\nZ2UpLmdldFRleHQoKSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nc2hvdWxkIG5vdCBoYXBwZW4KICAgICAgICAgICAgICAgICAgICAgICAgZS5w\ncmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2Vzc2lvbi5jb21taXQoKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChKTVNFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBM\nT0cud2FybigiQ2F1Z2h0IGFuIHVuZXhjZXB0ZWQgZXhjZXB0aW9uOiAiICsg\nZS5nZXRNZXNzYWdlKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAg\nICBzZXNzaW9uLnJvbGxiYWNrKCk7CgogICAgICAgIGFzc2VydFRydWUoIlBv\nc3QtUm9sbGJhY2sgZXhwZWN0cyB0byByZWNlaXZlOiAiICsgTVNHX0NPVU5U\nICsgIiBtZXNzYWdlcy4iLAogICAgICAgICAgICBXYWl0LndhaXRGb3IobmV3\nIFdhaXQuQ29uZGl0aW9uKCl7CiAgICAgICAgICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBpc1NhdGlzaWZpZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgICAgICAgICBMT0cuaW5mbygiQ29uc3VtZXIgaGFzIHJlY2VpdmVk\nICIgKyByZWNlaXZlZC5zaXplKCkgKyAiIG1lc3NhZ2VzIHNpbmNlIHJvbGxi\nYWNrLiIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlZC5z\naXplKCkgPT0gTVNHX0NPVU5UOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgKSk7CgogICAgICAgIGFzc2VydEVxdWFscyhNU0df\nQ09VTlQsIHJlY2VpdmVkLnNpemUoKSk7CiAgICAgICAgc2Vzc2lvbi5jb21t\naXQoKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc2VuZE1lc3NhZ2VzKGZp\nbmFsIGludCBNU0dfQ09VTlQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIENvbm5lY3Rpb24gY29ubmVjdGlvbiA9IGNvbm5lY3Rpb25GYWN0b3J5LmNy\nZWF0ZUNvbm5lY3Rpb24oKTsKICAgICAgICBTZXNzaW9uIHNlc3Npb24gPSBj\nb25uZWN0aW9uLmNyZWF0ZVNlc3Npb24oZmFsc2UsIFNlc3Npb24uQVVUT19B\nQ0tOT1dMRURHRSk7CiAgICAgICAgRGVzdGluYXRpb24gZGVzdGluYXRpb24g\nPSBzZXNzaW9uLmNyZWF0ZVRvcGljKGRlc3RpbmF0aW9uTmFtZSk7CiAgICAg\nICAgTWVzc2FnZVByb2R1Y2VyIHByb2R1Y2VyID0gc2Vzc2lvbi5jcmVhdGVQ\ncm9kdWNlcihkZXN0aW5hdGlvbik7CiAgICAgICAgZm9yKGludCBpID0gMDsg\naSA8IE1TR19DT1VOVDsgKytpKSB7CiAgICAgICAgICAgIHByb2R1Y2VyLnNl\nbmQoc2Vzc2lvbi5jcmVhdGVUZXh0TWVzc2FnZSgiIiArIGkpKTsKICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBzdXBlci5zZXRVcCgpOwogICAgICAgIGNvbm5l\nY3Rpb25GYWN0b3J5ID0gbmV3IEhlZHdpZ0Nvbm5lY3Rpb25GYWN0b3J5SW1w\nbCgpOwogICAgfQoKfQo=\n","encoding":"base64"}

