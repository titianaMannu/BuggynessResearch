{"sha":"be64fc4ce6112546bb5e0332167c6017457e2ee0","node_id":"MDQ6QmxvYjE1NzU5NTY6YmU2NGZjNGNlNjExMjU0NmJiNWUwMzMyMTY3YzYwMTc0NTdlMmVlMA==","size":14478,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/be64fc4ce6112546bb5e0332167c6017457e2ee0","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5qbXM7CgppbXBvcnQganVuaXQuZnJh\nbWV3b3JrLkFzc2VydDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLkptc1Rl\nc3RCYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuam1zLmpuZGkuSGVk\nd2lnSW5pdGlhbENvbnRleHQ7CgppbXBvcnQgamF2YXguam1zLkpNU0V4Y2Vw\ndGlvbjsKaW1wb3J0IGphdmF4Lmptcy5NZXNzYWdlOwppbXBvcnQgamF2YXgu\nam1zLk1lc3NhZ2VMaXN0ZW5lcjsKaW1wb3J0IGphdmF4Lmptcy5TZXNzaW9u\nOwppbXBvcnQgamF2YXguam1zLlRleHRNZXNzYWdlOwppbXBvcnQgamF2YXgu\nam1zLlRvcGljOwppbXBvcnQgamF2YXguam1zLlRvcGljQ29ubmVjdGlvbjsK\naW1wb3J0IGphdmF4Lmptcy5Ub3BpY0Nvbm5lY3Rpb25GYWN0b3J5OwppbXBv\ncnQgamF2YXguam1zLlRvcGljUHVibGlzaGVyOwppbXBvcnQgamF2YXguam1z\nLlRvcGljU2Vzc2lvbjsKaW1wb3J0IGphdmF4Lmptcy5Ub3BpY1N1YnNjcmli\nZXI7CmltcG9ydCBqYXZheC5uYW1pbmcuQ29udGV4dDsKaW1wb3J0IGphdmF4\nLm5hbWluZy5OYW1pbmdFeGNlcHRpb247CgovKioKICogQmFzaWMgSk1TIHRl\nc3RjYXNlcy4KICovCnB1YmxpYyBjbGFzcyBCYXNpY0pNU1Rlc3QgZXh0ZW5k\ncyBKbXNUZXN0QmFzZSB7CgogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50\nIE5VTV9JVEVSQVRJT05TID0gMTsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIFN0cmluZyBURVhUX01FU1NBR0UgPSAidGVzdF9tZXNzYWdlIjsKCiAgICAv\nLyBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgQ0hBVF9UT1BJQ19OQU1F\nID0gImNoYXRfdG9waWMiOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgU3Ry\naW5nW10gQ0hBVF9NRVNTQUdFUyA9IHsibWVzc2FnZTEiLCAibWVzc2FnZTIi\nLCAibWVzc2FnZTMiLCAibWVzc2FnZTQifTsKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBBVFRSSUJVVEVfS0VZID0gImtleSI7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBTdHJpbmcgQVRUUklCVVRFX1ZBTFVFID0gInZh\nbHVlIjsKCiAgICBwcml2YXRlIFRvcGljQ29ubmVjdGlvbkZhY3RvcnkgdG9w\naWNDb25uZWN0aW9uRmFjdG9yeTsKCiAgICAvLyBwcml2YXRlIHN0YXRpYyBm\naW5hbCBTdHJpbmcgdGVzdFRvcGljTmFtZSA9ICJ0ZXN0X3RvcGljMyI7CiAg\nICBwcml2YXRlIFN0cmluZyB0ZXN0VG9waWNOYW1lOwoKICAgIEBPdmVycmlk\nZQogICAgcHJvdGVjdGVkIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBzdXBlci5zZXRVcCgpOwogICAgICAgIENvbnRleHQgbWVz\nc2FnaW5nID0gbmV3IEhlZHdpZ0luaXRpYWxDb250ZXh0KCk7CiAgICAgICAg\ndG9waWNDb25uZWN0aW9uRmFjdG9yeSA9IChUb3BpY0Nvbm5lY3Rpb25GYWN0\nb3J5KSBtZXNzYWdpbmcubG9va3VwKAogICAgICAgICAgICAgICAgSGVkd2ln\nSW5pdGlhbENvbnRleHQuVE9QSUNfQ09OTkVDVElPTl9GQUNUT1JZX05BTUUp\nOwogICAgICAgIHRlc3RUb3BpY05hbWUgPSBTZXNzaW9uSW1wbC5nZW5lcmF0\nZVJhbmRvbVN0cmluZygpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBzdXBlci50ZWFyRG93bigpOwogICAgICAgIHRlc3RUb3BpY05hbWUgPSBu\ndWxsOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHRlc3RTaW1wbGVKbXMoKSB0\naHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IE5VTV9JVEVSQVRJT05TOyBpKyspIHsKICAgICAgICAgICAgc2ltcGxl\nSk1TVGVzdEltcGwoZmFsc2UpOwogICAgICAgIH0KICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IE5VTV9JVEVSQVRJT05TOyBpKyspIHsKICAgICAgICAg\nICAgc2ltcGxlSk1TVGVzdEltcGwodHJ1ZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHByaXZhdGUgdm9pZCBzaW1wbGVKTVNUZXN0SW1wbChib29sZWFuIHRy\nYW5zYWN0ZWQpIHRocm93cyBKTVNFeGNlcHRpb24gewogICAgICAgIFRvcGlj\nQ29ubmVjdGlvbiBjb25uZWN0aW9uID0gdG9waWNDb25uZWN0aW9uRmFjdG9y\neS5jcmVhdGVUb3BpY0Nvbm5lY3Rpb24oKTsKCiAgICAgICAgLy8gQ3JlYXRp\nbmcgdHdvIHNlc3Npb25zIDogb25lIHRvIHN1YnNjcmliZSwgdGhlIG90aGVy\nIHRvIHB1Ymxpc2ggYW5kIHRlc3QgYmV0d2VlbiB0aGVtIC4uLgogICAgICAg\nIFRvcGljU2Vzc2lvbiBwdWJsaXNoVG9waWNTZXNzaW9uID0gY29ubmVjdGlv\nbi5jcmVhdGVUb3BpY1Nlc3Npb24odHJhbnNhY3RlZCwgU2Vzc2lvbi5BVVRP\nX0FDS05PV0xFREdFKTsKICAgICAgICBUb3BpY1Nlc3Npb24gc3Vic2NyaWJl\nVG9waWNTZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVUb3BpY1Nlc3Npb24o\ndHJhbnNhY3RlZCwgU2Vzc2lvbi5BVVRPX0FDS05PV0xFREdFKTsKCiAgICAg\nICAgVG9waWNQdWJsaXNoZXIgcHVibGlzaGVyID0gcHVibGlzaFRvcGljU2Vz\nc2lvbi5jcmVhdGVQdWJsaXNoZXIocHVibGlzaFRvcGljU2Vzc2lvbi5jcmVh\ndGVUb3BpYyh0ZXN0VG9waWNOYW1lKSk7CiAgICAgICAgVG9waWNTdWJzY3Jp\nYmVyIHN1YnNjcmliZXIgPSBzdWJzY3JpYmVUb3BpY1Nlc3Npb24uY3JlYXRl\nRHVyYWJsZVN1YnNjcmliZXIoCiAgICAgICAgICAgICAgICBwdWJsaXNoVG9w\naWNTZXNzaW9uLmNyZWF0ZVRvcGljKHRlc3RUb3BpY05hbWUpLCAidGVzdF9z\ndWJzY3JpYmVyIik7CiAgICAgICAgLy9Ub3BpY1N1YnNjcmliZXIgc3Vic2Ny\naWJlcl9kdXAgPQogICAgICAgIHN1YnNjcmliZVRvcGljU2Vzc2lvbi5jcmVh\ndGVEdXJhYmxlU3Vic2NyaWJlcigKICAgICAgICAgICAgICAgIHB1Ymxpc2hU\nb3BpY1Nlc3Npb24uY3JlYXRlVG9waWModGVzdFRvcGljTmFtZSksICJ0ZXN0\nX3N1YnNjcmliZXIiKTsKICAgICAgICAvLyBUb3BpY1N1YnNjcmliZXIgc3Vi\nc2NyaWJlcjEgPQogICAgICAgIHN1YnNjcmliZVRvcGljU2Vzc2lvbi5jcmVh\ndGVEdXJhYmxlU3Vic2NyaWJlcigKICAgICAgICAgICAgICAgIHB1Ymxpc2hU\nb3BpY1Nlc3Npb24uY3JlYXRlVG9waWModGVzdFRvcGljTmFtZSksICJ0ZXN0\nX3N1YnNjcmliZXIxIik7CgogICAgICAgIC8vIFN0YXJ0IGNvbm5lY3Rpb24g\nLi4uCiAgICAgICAgY29ubmVjdGlvbi5zdGFydCgpOwogICAgICAgIC8vIHN1\nYnNjcmliZXIucmVjZWl2ZU5vV2FpdCgpOwoKICAgICAgICBwdWJsaXNoZXIu\ncHVibGlzaChwdWJsaXNoVG9waWNTZXNzaW9uLmNyZWF0ZVRleHRNZXNzYWdl\nKFRFWFRfTUVTU0FHRSkpOwogICAgICAgIGlmICh0cmFuc2FjdGVkKSBwdWJs\naXNoVG9waWNTZXNzaW9uLmNvbW1pdCgpOwoKICAgICAgICBNZXNzYWdlIG1l\nc3NhZ2UgPSBzdWJzY3JpYmVyLnJlY2VpdmUoKTsKCiAgICAgICAgQXNzZXJ0\nLmFzc2VydE5vdE51bGwobWVzc2FnZSk7CiAgICAgICAgQXNzZXJ0LmFzc2Vy\ndFRydWUobWVzc2FnZSBpbnN0YW5jZW9mIFRleHRNZXNzYWdlKTsKICAgICAg\nICBBc3NlcnQuYXNzZXJ0RXF1YWxzKCgoVGV4dE1lc3NhZ2UpIG1lc3NhZ2Up\nLmdldFRleHQoKSwgVEVYVF9NRVNTQUdFKTsKCiAgICAgICAgaWYgKHRyYW5z\nYWN0ZWQpIHN1YnNjcmliZVRvcGljU2Vzc2lvbi5jb21taXQoKTsKCiAgICAg\nICAgc3Vic2NyaWJlVG9waWNTZXNzaW9uLmNsb3NlKCk7CiAgICAgICAgLy8g\nTXVzdCByZXR1cm4gbnVsbCwgd2UgaGF2ZSBjbG9zZWQgdGhlIHNlc3Npb24u\nCiAgICAgICAgQXNzZXJ0LmFzc2VydE51bGwoc3Vic2NyaWJlci5yZWNlaXZl\nKCkpOwoKICAgICAgICBjb25uZWN0aW9uLmNsb3NlKCk7CiAgICB9CgoKICAg\nIC8vIEJhc2VkIG9uIGNvZGUgZnJvbSBodHRwOi8vb25qYXZhLmNvbS9wdWIv\nYS9vbmphdmEvZXhjZXJwdC9qbXNfY2gyL2luZGV4Lmh0bWw/cGFnZT0yCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0U2ltcGxlQ2hhdCgpIHRocm93cyBOYW1pbmdF\neGNlcHRpb24sIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBOVU1fSVRFUkFUSU9OUzsgaSsrKSB7CiAgICAgICAgICAgIHNp\nbXBsZUNoYXRUZXN0SW1wbChmYWxzZSk7CiAgICAgICAgfQogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgTlVNX0lURVJBVElPTlM7IGkrKykgewogICAg\nICAgICAgICBzaW1wbGVDaGF0VGVzdEltcGwodHJ1ZSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHByaXZhdGUgdm9pZCBzaW1wbGVDaGF0VGVzdEltcGwoYm9v\nbGVhbiB0cmFuc2FjdGVkKSB0aHJvd3MgTmFtaW5nRXhjZXB0aW9uLCBKTVNF\neGNlcHRpb24gewogICAgICAgIC8vIENyZWF0ZSBhIEpNUyBjb25uZWN0aW9u\nCiAgICAgICAgVG9waWNDb25uZWN0aW9uIGNvbm5lY3Rpb24gPSB0b3BpY0Nv\nbm5lY3Rpb25GYWN0b3J5LmNyZWF0ZVRvcGljQ29ubmVjdGlvbigpOwoKICAg\nICAgICAvLyBDcmVhdGUgdHdvIEpNUyBzZXNzaW9uIG9iamVjdHMKICAgICAg\nICBUb3BpY1Nlc3Npb24gcHViU2Vzc2lvbiA9IGNvbm5lY3Rpb24uY3JlYXRl\nVG9waWNTZXNzaW9uKHRyYW5zYWN0ZWQsIFNlc3Npb24uQVVUT19BQ0tOT1dM\nRURHRSk7CiAgICAgICAgVG9waWNTZXNzaW9uIHN1YlNlc3Npb24gPSBjb25u\nZWN0aW9uLmNyZWF0ZVRvcGljU2Vzc2lvbih0cmFuc2FjdGVkLCBTZXNzaW9u\nLkFVVE9fQUNLTk9XTEVER0UpOwoKICAgICAgICAvLyBMb29rIHVwIGEgSk1T\nIHRvcGljCiAgICAgICAgLy8gVG9waWMgY2hhdFRvcGljID0gcHViU2Vzc2lv\nbi5jcmVhdGVUb3BpYyhDSEFUX1RPUElDX05BTUUpOwogICAgICAgIFRvcGlj\nIGNoYXRUb3BpYyA9IHB1YlNlc3Npb24uY3JlYXRlVG9waWMoU2Vzc2lvbklt\ncGwuZ2VuZXJhdGVSYW5kb21TdHJpbmcoKSk7CgogICAgICAgIC8vIENyZWF0\nZSBhIEpNUyBwdWJsaXNoZXIgYW5kIHN1YnNjcmliZXIKICAgICAgICBUb3Bp\nY1B1Ymxpc2hlciBwdWJsaXNoZXIgPSBwdWJTZXNzaW9uLmNyZWF0ZVB1Ymxp\nc2hlcihjaGF0VG9waWMpOwogICAgICAgIFRvcGljU3Vic2NyaWJlciBzdWJz\nY3JpYmVyID0gc3ViU2Vzc2lvbi5jcmVhdGVTdWJzY3JpYmVyKGNoYXRUb3Bp\nYyk7CiAgICAgICAgVG9waWNTdWJzY3JpYmVyIHN1YnNjcmliZXIxID0gc3Vi\nU2Vzc2lvbi5jcmVhdGVTdWJzY3JpYmVyKGNoYXRUb3BpYyk7CgogICAgICAg\nIGZpbmFsIE11dGFibGU8Qm9vbGVhbj4gZXJyb3IgPSBuZXcgTXV0YWJsZTxC\nb29sZWFuPihmYWxzZSk7CiAgICAgICAgZmluYWwgTXV0YWJsZTxTdHJpbmc+\nIGVycm9yTWVzc2FnZSA9IG5ldyBNdXRhYmxlPFN0cmluZz4obnVsbCk7CiAg\nICAgICAgZmluYWwgTXV0YWJsZTxJbnRlZ2VyPiBtZXNzYWdlQ291bnQgPSBu\nZXcgTXV0YWJsZTxJbnRlZ2VyPigwKTsKICAgICAgICAvLyBTZXQgYSBKTVMg\nbWVzc2FnZSBsaXN0ZW5lcgogICAgICAgIHN1YnNjcmliZXIuc2V0TWVzc2Fn\nZUxpc3RlbmVyKG5ldyBNZXNzYWdlTGlzdGVuZXIoKSB7CiAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvbk1lc3NhZ2Uo\nTWVzc2FnZSBtZXNzYWdlKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBhbHJl\nYWR5IGZhaWxlZCwgaWdub3JlLgogICAgICAgICAgICAgICAgaWYgKGVycm9y\nLmdldFZhbHVlKCkpIHJldHVybjsKCiAgICAgICAgICAgICAgICBpZiAoISht\nZXNzYWdlIGluc3RhbmNlb2YgVGV4dE1lc3NhZ2UpKSB7CiAgICAgICAgICAg\nICAgICAgICAgZXJyb3JNZXNzYWdlLnNldFZhbHVlKCJOb3QgdGV4dCBtZXNz\nYWdlID8iKTsKICAgICAgICAgICAgICAgICAgICBlcnJvci5zZXRWYWx1ZSh0\ncnVlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBUZXh0TWVzc2FnZSB0ZXh0TWVzc2Fn\nZSA9IChUZXh0TWVzc2FnZSkgbWVzc2FnZTsKICAgICAgICAgICAgICAgIFN0\ncmluZyB0ZXh0OwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICB0ZXh0ID0gdGV4dE1lc3NhZ2UuZ2V0VGV4dCgpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoSk1TRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICAg\nICAgICAgIGVycm9yTWVzc2FnZS5zZXRWYWx1ZSgiRXhjZXB0aW9uIGdldHRp\nbmcgdGV4dCA6ICIgKyBlKTsKICAgICAgICAgICAgICAgICAgICBlcnJvci5z\nZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZmluYWwgaW50IGNv\ndW50ID0gbWVzc2FnZUNvdW50LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAg\nICBtZXNzYWdlQ291bnQuc2V0VmFsdWUobWVzc2FnZUNvdW50LmdldFZhbHVl\nKCkgKyAxKTsKCiAgICAgICAgICAgICAgICBpZiAoY291bnQgPj0gQ0hBVF9N\nRVNTQUdFUy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICBlcnJvck1l\nc3NhZ2Uuc2V0VmFsdWUoIlVuZXhwZWN0ZWQgbWVzc2FnZSBjb3VudCA6ICIg\nKyBjb3VudCk7CiAgICAgICAgICAgICAgICAgICAgZXJyb3Iuc2V0VmFsdWUo\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFDSEFUX01FU1NBR0VTW2Nv\ndW50XS5lcXVhbHModGV4dCkpIHsKICAgICAgICAgICAgICAgICAgICBlcnJv\nck1lc3NhZ2Uuc2V0VmFsdWUoIk1lc3NhZ2UgbWlzbWF0Y2guIGV4cGVjdGVk\nIDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIENIQVRfTUVTU0FHRVNbY291bnRdICsgIiwgcmVjZWl2ZWQgOiAiICsg\ndGV4dCk7CiAgICAgICAgICAgICAgICAgICAgZXJyb3Iuc2V0VmFsdWUodHJ1\nZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBpZiAoIUFUVFJJQlVURV9WQUxVRS5lcXVhbHModGV4dE1lc3NhZ2UuZ2V0\nU3RyaW5nUHJvcGVydHkoQVRUUklCVVRFX0tFWSkpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGVycm9yTWVzc2FnZS5zZXRWYWx1ZSgiQXR0cmlidXRl\nIHZhbHVlIG1pc21hdGNoLiBFeHBlY3RlZCA6ICIgKyBBVFRSSUJVVEVfVkFM\nVUUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgIiwgZm91bmQgOiAiICsgdGV4dE1lc3NhZ2UuZ2V0U3RyaW5nUHJv\ncGVydHkoQVRUUklCVVRFX0tFWSkpOwogICAgICAgICAgICAgICAgICAgICAg\nICBlcnJvci5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEpNU0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgICAg\nICBlcnJvck1lc3NhZ2Uuc2V0VmFsdWUoIkV4Y2VwdGlvbiBnZXR0aW5nIHRl\neHQgOiAiICsgZSk7CiAgICAgICAgICAgICAgICAgICAgZXJyb3Iuc2V0VmFs\ndWUodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAg\nIC8vIFN0YXJ0IHRoZSBKTVMgY29ubmVjdGlvbjsgYWxsb3dzIG1lc3NhZ2Vz\nIHRvIGJlIGRlbGl2ZXJlZAogICAgICAgIGNvbm5lY3Rpb24uc3RhcnQoKTsK\nICAgICAgICBmb3IgKFN0cmluZyBtZXNzYWdlIDogQ0hBVF9NRVNTQUdFUykg\newogICAgICAgICAgICBUZXh0TWVzc2FnZSB0bWVzc2FnZSA9IHB1YlNlc3Np\nb24uY3JlYXRlVGV4dE1lc3NhZ2UobWVzc2FnZSk7CiAgICAgICAgICAgIHRt\nZXNzYWdlLnNldFN0cmluZ1Byb3BlcnR5KEFUVFJJQlVURV9LRVksIEFUVFJJ\nQlVURV9WQUxVRSk7CiAgICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRt\nZXNzYWdlKTsKICAgICAgICB9CgogICAgICAgIGlmICh0cmFuc2FjdGVkKSBw\ndWJTZXNzaW9uLmNvbW1pdCgpOwoKICAgICAgICB0cnkgewogICAgICAgICAg\nICBUaHJlYWQuc2xlZXAoMTApOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVw\ndGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZS5wcmludFN0YWNrVHJh\nY2UoKTsKICAgICAgICB9CgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nQ0hBVF9NRVNTQUdFUy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBNZXNz\nYWdlIHJlY2VpdmVkTWVzc2FnZSA9IHN1YnNjcmliZXIxLnJlY2VpdmUoMTAw\nKTsKICAgICAgICAgICAgQXNzZXJ0LmFzc2VydE5vdE51bGwocmVjZWl2ZWRN\nZXNzYWdlKTsKICAgICAgICB9CgogICAgICAgIGlmIChtZXNzYWdlQ291bnQu\nZ2V0VmFsdWUoKSAhPSBDSEFUX01FU1NBR0VTLmxlbmd0aCkgewogICAgICAg\nICAgICBlcnJvci5zZXRWYWx1ZSh0cnVlKTsKICAgICAgICAgICAgZXJyb3JN\nZXNzYWdlLnNldFZhbHVlKCJFeHBlY3RlZCB0byByZWNlaXZlICIgKyBDSEFU\nX01FU1NBR0VTLmxlbmd0aAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiLCBnb3QgIiArIG1lc3NhZ2VDb3VudC5nZXRWYWx1ZSgpICsg\nIiBtZXNzYWdlcy4iKTsKICAgICAgICB9CgogICAgICAgIGlmICh0cmFuc2Fj\ndGVkKSBzdWJTZXNzaW9uLmNvbW1pdCgpOwoKICAgICAgICBBc3NlcnQuYXNz\nZXJ0RmFsc2UoU3RyaW5nLnZhbHVlT2YoZXJyb3IuZ2V0VmFsdWUoKSksIGVy\ncm9yLmdldFZhbHVlKCkpOwogICAgICAgIGNvbm5lY3Rpb24uY2xvc2UoKTsK\nICAgIH0KCgogICAgcHVibGljIHZvaWQgdGVzdFNpbXBsZVNlbGVjdG9yKCkg\ndGhyb3dzIEpNU0V4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBOVU1fSVRFUkFUSU9OUzsgaSsrKSB7CiAgICAgICAgICAgIHNpbXBs\nZVNlbGVjdG9ySW1wbChmYWxzZSk7CiAgICAgICAgfQogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgTlVNX0lURVJBVElPTlM7IGkrKykgewogICAgICAg\nICAgICBzaW1wbGVTZWxlY3RvckltcGwodHJ1ZSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCBzaW1wbGVTZWxlY3RvckltcGwoYm9vbGVh\nbiB0cmFuc2FjdGVkKSB0aHJvd3MgSk1TRXhjZXB0aW9uIHsKICAgICAgICBU\nb3BpY0Nvbm5lY3Rpb24gY29ubmVjdGlvbiA9IHRvcGljQ29ubmVjdGlvbkZh\nY3RvcnkuY3JlYXRlVG9waWNDb25uZWN0aW9uKCk7CgogICAgICAgIC8vIENy\nZWF0aW5nIHRocmVlIHNlc3Npb25zIDogb25lIHRvIHN1YnNjcmliZSB3aXRo\nIHNlbGVjdG9yLAogICAgICAgIC8vIG9uZSB0byBwdWJsaXNoIGFuZCB0aGly\nZCB0byB2YWxpZGF0ZSB0aGF0IHRoZSBtZXNzYWdlIHdhcy93YXMtbm90IGRl\nbGl2ZXJlZCAhCiAgICAgICAgVG9waWNTZXNzaW9uIHB1Ymxpc2hUb3BpY1Nl\nc3Npb24gPSBjb25uZWN0aW9uLmNyZWF0ZVRvcGljU2Vzc2lvbih0cmFuc2Fj\ndGVkLCBTZXNzaW9uLkFVVE9fQUNLTk9XTEVER0UpOwogICAgICAgIFRvcGlj\nU2Vzc2lvbiBzdWJzY3JpYmVUb3BpY1Nlc3Npb24gPSBjb25uZWN0aW9uLmNy\nZWF0ZVRvcGljU2Vzc2lvbih0cmFuc2FjdGVkLCBTZXNzaW9uLkFVVE9fQUNL\nTk9XTEVER0UpOwogICAgICAgIFRvcGljU2Vzc2lvbiBzdWJzY3JpYmVWYWxp\nZGF0aW9uVG9waWNTZXNzaW9uID0gY29ubmVjdGlvbi5jcmVhdGVUb3BpY1Nl\nc3Npb24odHJhbnNhY3RlZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIFNlc3Npb24uQVVUT19BQ0tOT1dMRURHRSk7CgoKICAg\nICAgICBUb3BpY1B1Ymxpc2hlciBwdWJsaXNoZXIgPSBwdWJsaXNoVG9waWNT\nZXNzaW9uLmNyZWF0ZVB1Ymxpc2hlcihwdWJsaXNoVG9waWNTZXNzaW9uLmNy\nZWF0ZVRvcGljKHRlc3RUb3BpY05hbWUpKTsKCiAgICAgICAgLy8gVGhlIGZp\ncnN0IHN1YnNjcmliZXIncyBzdWJzY3JpcHRpb24gc2hvdWxkIGJlIG92ZXJy\naWRkZW4gYnkgdGhlIHNlY29uZAogICAgICAgIC8vIGhlbmNlLCB3ZSBNVVNU\nIGhhdmUgc2VsZWN0b3IgZW5hYmxlZC4KICAgICAgICBUb3BpY1N1YnNjcmli\nZXIgc2VsZWN0b3JTdWJzY3JpYmVyID0gc3Vic2NyaWJlVG9waWNTZXNzaW9u\nLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKAogICAgICAgICAgICAgICAgcHVi\nbGlzaFRvcGljU2Vzc2lvbi5jcmVhdGVUb3BpYyh0ZXN0VG9waWNOYW1lKSwg\nInRlc3Rfc3Vic2NyaWJlciIpOwogICAgICAgIFRvcGljU3Vic2NyaWJlciBz\nZWxlY3RvclN1YnNjcmliZXJfZHVwID0gc3Vic2NyaWJlVG9waWNTZXNzaW9u\nLmNyZWF0ZUR1cmFibGVTdWJzY3JpYmVyKAogICAgICAgICAgICAgICAgcHVi\nbGlzaFRvcGljU2Vzc2lvbi5jcmVhdGVUb3BpYyh0ZXN0VG9waWNOYW1lKSwK\nICAgICAgICAgICAgICAgICJ0ZXN0X3N1YnNjcmliZXIiLCBBVFRSSUJVVEVf\nS0VZICsgIiA8PiAnIiArIEFUVFJJQlVURV9WQUxVRSArICInIiwgZmFsc2Up\nOwoKICAgICAgICAvLyB3aXRob3V0IHNlbGVjdG9yLgogICAgICAgIFRvcGlj\nU3Vic2NyaWJlciBzdWJzY3JpYmVyVmFsaWRhdGlvbiA9CiAgICAgICAgICAg\nICAgICBzdWJzY3JpYmVWYWxpZGF0aW9uVG9waWNTZXNzaW9uLmNyZWF0ZUR1\ncmFibGVTdWJzY3JpYmVyKAogICAgICAgICAgICAgICAgICAgICAgICBwdWJs\naXNoVG9waWNTZXNzaW9uLmNyZWF0ZVRvcGljKHRlc3RUb3BpY05hbWUpLCAi\ndGVzdF9zdWJzY3JpYmVyMSIpOwoKICAgICAgICAvLyBTdGFydCBjb25uZWN0\naW9uIC4uLgogICAgICAgIGNvbm5lY3Rpb24uc3RhcnQoKTsKCiAgICAgICAg\nZmluYWwgU3RyaW5nIHRleHRNZXNzYWdlID0gVEVYVF9NRVNTQUdFICsgIiwg\ndHJhbnNhY3RlZCA6ICIgKyB0cmFuc2FjdGVkOwogICAgICAgIC8vIFNlbmQg\ndGhlIG1lc3NhZ2UuCiAgICAgICAgewogICAgICAgICAgICBUZXh0TWVzc2Fn\nZSBtZXNzYWdlID0gcHVibGlzaFRvcGljU2Vzc2lvbi5jcmVhdGVUZXh0TWVz\nc2FnZSh0ZXh0TWVzc2FnZSk7CiAgICAgICAgICAgIG1lc3NhZ2Uuc2V0U3Ry\naW5nUHJvcGVydHkoQVRUUklCVVRFX0tFWSwgQVRUUklCVVRFX1ZBTFVFKTsK\nICAgICAgICAgICAgcHVibGlzaGVyLnB1Ymxpc2gobWVzc2FnZSk7CiAgICAg\nICAgfQoKICAgICAgICBpZiAodHJhbnNhY3RlZCkgewogICAgICAgICAgICAv\nLyBNdXN0IHJldHVybiBudWxsIC4uLiBubyBwdWJsaXNoIG11c3QgaGFwcGVu\nIHVudGlsIHdlIGNvbW1pdCAhCiAgICAgICAgICAgIE1lc3NhZ2UgbWVzc2Fn\nZSA9IHN1YnNjcmliZXJWYWxpZGF0aW9uLnJlY2VpdmUoMjAwKTsKICAgICAg\nICAgICAgQXNzZXJ0LmFzc2VydE51bGwoIlVuZXhwZWN0ZWQgbWVzc2FnZSA6\nICIgKyBtZXNzYWdlLCBtZXNzYWdlKTsKICAgICAgICAgICAgcHVibGlzaFRv\ncGljU2Vzc2lvbi5jb21taXQoKTsKICAgICAgICB9CgogICAgICAgIC8vIHN1\nYnNjcmliZXJWYWxpZGF0aW9uIG11c3QgZ2V0IHRoZSBtZXNzYWdlIGFzIHNv\nb24gYXMgaXQgaXMgYXZhaWxhYmxlLAogICAgICAgIC8vIHdoaWxlIHNlbGVj\ndG9yU3Vic2NyaWJlciBtaWdodC9taWdodCBub3QKICAgICAgICAvLyAoZGVw\nZW5kaW5nIG9uIHdoZXRoZXIgU2VsZWN0b3Igd29ya3MgOi0pICkuIFNvIHdh\naXQgb24gc3Vic2NyaWJlclZhbGlkYXRpb24KICAgICAgICB7CiAgICAgICAg\nICAgIE1lc3NhZ2UgcmVjZWl2ZWRNZXNzYWdlID0gc3Vic2NyaWJlclZhbGlk\nYXRpb24ucmVjZWl2ZSgyMDApOwoKICAgICAgICAgICAgLy8gVmFsaWRhdGUg\nd2hldGhlciBpdCBpcyB0aGUgY29ycmVjdCBtZXNzYWdlLgogICAgICAgICAg\nICBBc3NlcnQuYXNzZXJ0Tm90TnVsbCgicmVjZWl2ZWRNZXNzYWdlIHdhcyBl\neHBlY3RlZCIsIHJlY2VpdmVkTWVzc2FnZSk7CiAgICAgICAgICAgIEFzc2Vy\ndC5hc3NlcnRUcnVlKCJyZWNlaXZlZE1lc3NhZ2Ugbm90IGEgdGV4dE1lc3Nh\nZ2UgPyAiICsgcmVjZWl2ZWRNZXNzYWdlLAogICAgICAgICAgICAgICAgcmVj\nZWl2ZWRNZXNzYWdlIGluc3RhbmNlb2YgVGV4dE1lc3NhZ2UpOwogICAgICAg\nICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKCJ0ZXN0IGNvbnRlbnQgZG9lcyBu\nb3QgbWF0Y2ggPyAiICsgKChUZXh0TWVzc2FnZSkgcmVjZWl2ZWRNZXNzYWdl\nKS5nZXRUZXh0KCksCiAgICAgICAgICAgICAgICB0ZXh0TWVzc2FnZSwgKChU\nZXh0TWVzc2FnZSkgcmVjZWl2ZWRNZXNzYWdlKS5nZXRUZXh0KCkpOwoKICAg\nICAgICAgICAgZmluYWwgU3RyaW5nIGF0dHJWYWx1ZSA9IHJlY2VpdmVkTWVz\nc2FnZS5nZXRTdHJpbmdQcm9wZXJ0eShBVFRSSUJVVEVfS0VZKTsKICAgICAg\nICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscygiYXR0cmlidXRlIHZhbHVlIGlu\ndmFsaWQgPyAiICsgYXR0clZhbHVlLCBhdHRyVmFsdWUsIEFUVFJJQlVURV9W\nQUxVRSk7CgogICAgICAgICAgICBpZiAodHJhbnNhY3RlZCkgc3Vic2NyaWJl\nVmFsaWRhdGlvblRvcGljU2Vzc2lvbi5jb21taXQoKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIE5vdyB0aGF0IHN1YnNjcmliZXJWYWxpZGF0aW9uIHJlY2Vp\ndmVkIHRoZSBtZXNzYWdlLAogICAgICAgIC8vIHNlbGVjdG9yU3Vic2NyaWJl\nciBhbmQvb3Igc2VsZWN0b3JTdWJzY3JpYmVyX2R1cCBtdXN0IGFsc28gcmVj\nZWl2ZSB0aGUKICAgICAgICAvLyBtZXNzYWdlIG9yIHRoZXkgd2lsbCBuZXZl\nciByZWNlaXZlIHRoZSBtZXNzYWdlIChzaW5jZSBzZWxlY3RvciBibG9ja2Vk\nIGl0KS4KICAgICAgICB7CiAgICAgICAgICAgIC8vIEV2ZW4gdGhvdWdoIHNl\nbGVjdG9yU3Vic2NyaWJlciB3YXMgc3Vic2NyaWJlZCBXSVRIT1VUIHNlbGVj\ndG9yLCB3ZSBjcmVhdGUgc2VsZWN0b3JTdWJzY3JpYmVyX2R1cCBMQVRFUiB0\nbwogICAgICAgICAgICAvLyBvdmVycmlkZSB0aGUgc3Vic2NyaXB0aW9uIHBv\nbGljeSB1c2luZyB0aGUgU0FNRSBzdWJzY3JpcHRpb24gaWQvdG9waWMKICAg\nICAgICAgICAgLy8gLSBzbyBzZWxlY3RvclN1YnNjcmliZXJfZHVwIGNvbmZp\nZyBNVVNUIHRha2UKICAgICAgICAgICAgLy8gcHJlY2VkZW5jZSAuLi4KICAg\nICAgICAgICAgTWVzc2FnZSBtc2cgPSBzZWxlY3RvclN1YnNjcmliZXIucmVj\nZWl2ZSgxMDApOwogICAgICAgICAgICBNZXNzYWdlIG1zZzEgPSBzZWxlY3Rv\nclN1YnNjcmliZXJfZHVwLnJlY2VpdmUoMTAwKTsKICAgICAgICAgICAgQXNz\nZXJ0LmFzc2VydE51bGwoIlVuZXhwZWN0ZWQgcmVjZWl2ZWQgbWVzc2FnZSAi\nICsgbXNnLCBtc2cpOwogICAgICAgICAgICBBc3NlcnQuYXNzZXJ0TnVsbCgi\nVW5leHBlY3RlZCByZWNlaXZlZCBtZXNzYWdlICIgKyBtc2cxLCBtc2cxKTsK\nICAgICAgICB9CgogICAgICAgIC8vIGNsb3NlIGFsbCBzZXNzaW9ucy4KICAg\nICAgICBzdWJzY3JpYmVUb3BpY1Nlc3Npb24uY2xvc2UoKTsKICAgICAgICBz\ndWJzY3JpYmVWYWxpZGF0aW9uVG9waWNTZXNzaW9uLmNsb3NlKCk7CiAgICAg\nICAgcHVibGlzaFRvcGljU2Vzc2lvbi5jbG9zZSgpOwoKICAgICAgICAvLyBN\ndXN0IHJldHVybiBudWxsLCB3ZSBoYXZlIGNsb3NlZCB0aGUgc2Vzc2lvbiAh\nIHNpbXBsZSB2YWxpZGF0aW9uIDotKQogICAgICAgIHsKICAgICAgICAgICAg\nTWVzc2FnZSBzbXNnID0gc3Vic2NyaWJlclZhbGlkYXRpb24ucmVjZWl2ZSgp\nOwogICAgICAgICAgICBBc3NlcnQuYXNzZXJ0TnVsbCgiVW5leHBlY3RlZCB2\nYWxpZGF0aW9uIG1lc3NhZ2UgcmVjZWl2ZWQgIiArIHNtc2csIHNtc2cpOwog\nICAgICAgIH0KCiAgICAgICAgLy8gY2xvc2UgY29ubmVjdGlvbiAuLi4KICAg\nICAgICBjb25uZWN0aW9uLmNsb3NlKCk7CiAgICB9Cn0K\n","encoding":"base64"}

