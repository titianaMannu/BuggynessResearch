{"sha":"282b3b8e877643a88b69ec14b9e14a284b71c621","node_id":"MDQ6QmxvYjE1NzU5NTY6MjgyYjNiOGU4Nzc2NDNhODhiNjllYzE0YjllMTRhMjg0YjcxYzYyMQ==","size":38154,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/282b3b8e877643a88b69ec14b9e14a284b71c621","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuZGVsaXZlcnk7CgppbXBv\ncnQgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuVmFyQXJncy52YTsK\nCmltcG9ydCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLlF1ZXVlOwppbXBvcnQgamF2\nYS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5Tb3J0ZWRNYXA7CmltcG9y\ndCBqYXZhLnV0aWwuVHJlZU1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LkJsb2NraW5nUXVldWU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5Db25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LkNvbmN1cnJlbnRNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5Qcmlvcml0eUJsb2NraW5nUXVldWU7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5MaW5rZWRCbG9ja2luZ1F1ZXVlOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5sb2Nrcy5SZWVudHJhbnRSZWFkV3JpdGVMb2NrOwoKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9y\neTsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi5hbm5vdGF0aW9ucy5WaXNp\nYmxlRm9yVGVzdGluZzsKaW1wb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZzsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5N\nYXRoVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuZGF0\nYS5Ub3BpY1N1YnNjcmliZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5l\neGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLmZpbHRlci5TZXJ2ZXJNZXNzYWdlRmlsdGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1YlN1YlJlc3BvbnNlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhdHVzQ29kZTsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvbkV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXM7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2V4dGVuc2lvbnMuUHViU3ViUmVz\ncG9uc2VVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5j\nb21tb24uU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnNlcnZlci5jb21tb24uVW5leHBlY3RlZEVycm9yOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLmhhbmRsZXJzLlN1YnNjcmlwdGlv\nbkNoYW5uZWxNYW5hZ2VyLlN1YkNoYW5uZWxEaXNjb25uZWN0ZWRMaXN0ZW5l\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5uZXR0eS5TZXJ2\nZXJTdGF0czsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5wZXJz\naXN0ZW5jZS5DYW5jZWxTY2FuUmVxdWVzdDsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnNlcnZlci5wZXJzaXN0ZW5jZS5GYWN0b3J5OwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBlcnNpc3RlbmNlLk1hcE1ldGhvZHM7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2Uu\nUGVyc2lzdGVuY2VNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\nc2VydmVyLnBlcnNpc3RlbmNlLlJlYWRBaGVhZENhY2hlOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBlcnNpc3RlbmNlLlNjYW5DYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5wZXJzaXN0ZW5j\nZS5TY2FuUmVxdWVzdDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZl\nci50b3BpY3MuVG9waWNNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcudXRpbC5DYWxsYmFjazsKaW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy51dGlsLlZhckFyZ3MudmE7CgpwdWJsaWMgY2xhc3MgRklGT0RlbGl2\nZXJ5TWFuYWdlciBpbXBsZW1lbnRzIERlbGl2ZXJ5TWFuYWdlciwgU3ViQ2hh\nbm5lbERpc2Nvbm5lY3RlZExpc3RlbmVyIHsKCiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihGSUZPRGVsaXZlcnlNYW5hZ2VyLmNsYXNzKTsKCiAgICBwcml2YXRl\nIHN0YXRpYyBDYWxsYmFjazxWb2lkPiBOT1BfQ0FMTEJBQ0sgPSBuZXcgQ2Fs\nbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCBy\nZXN1bHQpIHsKICAgICAgICB9CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1\nYkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICB9CiAgICB9OwoKICAg\nIHByb3RlY3RlZCBpbnRlcmZhY2UgRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdCB7\nCiAgICAgICAgcHVibGljIHZvaWQgcGVyZm9ybVJlcXVlc3QoKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIFN0b3JlcyBhIG1hcHBpbmcgZnJvbSB0b3BpYyB0\nbyB0aGUgZGVsaXZlcnkgcG9pbnRlcnMgb24gdGhlIHRvcGljLiBUaGUKICAg\nICAqIGRlbGl2ZXJ5IHBvaW50ZXJzIGFyZSBzdG9yZWQgaW4gYSBzb3J0ZWQg\nbWFwIGZyb20gc2VxLWlkIHRvIHRoZSBzZXQgb2YKICAgICAqIHN1YnNjcmli\nZXJzIGF0IHRoYXQgc2VxLWlkCiAgICAgKi8KICAgIENvbmN1cnJlbnRNYXA8\nQnl0ZVN0cmluZywgU29ydGVkTWFwPExvbmcsIFNldDxBY3RpdmVTdWJzY3Jp\nYmVyU3RhdGU+Pj4gcGVyVG9waWNEZWxpdmVyeVB0cnM7CgogICAgLyoqCiAg\nICAgKiBNYXBwaW5nIGZyb20gZGVsaXZlcnkgZW5kIHBvaW50IHRvIHRoZSBz\ndWJzY3JpYmVyIHN0YXRlIHRoYXQgd2UgYXJlCiAgICAgKiBzZXJ2aW5nIGF0\nIHRoYXQgZW5kIHBvaW50LiBUaGlzIHByZXZlbnRzIHVzIGUuZy4sIGZyb20g\nc2VydmluZyB0d28KICAgICAqIHN1YnNjcmlwdGlvbnMgdG8gdGhlIHNhbWUg\nZW5kcG9pbnQKICAgICAqLwogICAgQ29uY3VycmVudE1hcDxUb3BpY1N1YnNj\ncmliZXIsIEFjdGl2ZVN1YnNjcmliZXJTdGF0ZT4gc3Vic2NyaWJlclN0YXRl\nczsKCiAgICBwcml2YXRlIGZpbmFsIFJlYWRBaGVhZENhY2hlIGNhY2hlOwog\nICAgcHJpdmF0ZSBmaW5hbCBQZXJzaXN0ZW5jZU1hbmFnZXIgcGVyc2lzdGVu\nY2VNZ3I7CiAgICBwcml2YXRlIFRvcGljTWFuYWdlciB0bTsKICAgIHByaXZh\ndGUgU2VydmVyQ29uZmlndXJhdGlvbiBjZmc7CgogICAgcHJpdmF0ZSBmaW5h\nbCBpbnQgbnVtRGVsaXZlcnlXb3JrZXJzOwogICAgcHJpdmF0ZSBmaW5hbCBE\nZWxpdmVyeVdvcmtlcltdIGRlbGl2ZXJ5V29ya2VyczsKCiAgICBwcml2YXRl\nIGNsYXNzIERlbGl2ZXJ5V29ya2VyIGltcGxlbWVudHMgUnVubmFibGUgewoK\nICAgICAgICBCbG9ja2luZ1F1ZXVlPERlbGl2ZXJ5TWFuYWdlclJlcXVlc3Q+\nIHJlcXVlc3RRdWV1ZSA9CiAgICAgICAgICAgIG5ldyBMaW5rZWRCbG9ja2lu\nZ1F1ZXVlPERlbGl2ZXJ5TWFuYWdlclJlcXVlc3Q+KCk7OwoKICAgICAgICAv\nKioKICAgICAgICAgKiBUaGUgcXVldWUgb2YgYWxsIHN1YnNjcmlwdGlvbnMg\ndGhhdCBhcmUgZmFjaW5nIGEgdHJhbnNpZW50IGVycm9yIGVpdGhlcgogICAg\nICAgICAqIGluIHNjYW5uaW5nIGZyb20gdGhlIHBlcnNpc3RlbmNlIG1hbmFn\nZXIsIG9yIGluIHNlbmRpbmcgdG8gdGhlIGNvbnN1bWVyCiAgICAgICAgICov\nCiAgICAgICAgUXVldWU8QWN0aXZlU3Vic2NyaWJlclN0YXRlPiByZXRyeVF1\nZXVlID0KICAgICAgICAgICAgbmV3IFByaW9yaXR5QmxvY2tpbmdRdWV1ZTxB\nY3RpdmVTdWJzY3JpYmVyU3RhdGU+KDMyLCBuZXcgQ29tcGFyYXRvcjxBY3Rp\ndmVTdWJzY3JpYmVyU3RhdGU+KCkgewogICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUoQWN0aXZl\nU3Vic2NyaWJlclN0YXRlIGFzMSwgQWN0aXZlU3Vic2NyaWJlclN0YXRlIGFz\nMikgewogICAgICAgICAgICAgICAgICAgIGxvbmcgcyA9IGFzMS5sYXN0U2Nh\nbkVycm9yVGltZSAtIGFzMi5sYXN0U2NhbkVycm9yVGltZTsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gcyA+IDAgPyAxIDogKHMgPCAwID8gLTEgOiAw\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAg\nIC8vIEJvb2xlYW4gaW5kaWNhdGluZyBpZiB0aGlzIHRocmVhZCBzaG91bGQg\nY29udGludWUgcnVubmluZy4gVGhpcyBpcyB1c2VkCiAgICAgICAgLy8gd2hl\nbiB3ZSB3YW50IHRvIHN0b3AgdGhlIHRocmVhZCBkdXJpbmcgYSBQdWJTdWJT\nZXJ2ZXIgc2h1dGRvd24uCiAgICAgICAgcHJvdGVjdGVkIHZvbGF0aWxlIGJv\nb2xlYW4ga2VlcFJ1bm5pbmcgPSB0cnVlOwogICAgICAgIHByaXZhdGUgZmlu\nYWwgVGhyZWFkIHdvcmtlclRocmVhZDsKICAgICAgICBwcml2YXRlIGZpbmFs\nIGludCBpZHg7CgogICAgICAgIHByaXZhdGUgZmluYWwgT2JqZWN0IHN1c3Bl\nbnNpb25Mb2NrID0gbmV3IE9iamVjdCgpOwogICAgICAgIHByaXZhdGUgYm9v\nbGVhbiBzdXNwZW5kZWQgPSBmYWxzZTsKCiAgICAgICAgRGVsaXZlcnlXb3Jr\nZXIoaW50IGluZGV4KSB7CiAgICAgICAgICAgIHRoaXMuaWR4ID0gaW5kZXg7\nCiAgICAgICAgICAgIHdvcmtlclRocmVhZCA9IG5ldyBUaHJlYWQodGhpcywg\nIkRlbGl2ZXJ5TWFuYWdlclRocmVhZC0iICsgaW5kZXgpOwogICAgICAgIH0K\nCiAgICAgICAgdm9pZCBzdGFydCgpIHsKICAgICAgICAgICAgd29ya2VyVGhy\nZWFkLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAg\nKiBTdG9wIG1ldGhvZCB3aGljaCB3aWxsIGVucXVldWUgYSBTaHV0ZG93bkRl\nbGl2ZXJ5TWFuYWdlclJlcXVlc3QuCiAgICAgICAgICovCiAgICAgICAgdm9p\nZCBzdG9wKCkgewogICAgICAgICAgICBlbnF1ZXVlV2l0aG91dEZhaWx1cmUo\nbmV3IFNodXRkb3duRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdCgpKTsKICAgICAg\nICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFN0b3AgRklGTyBkZWxpdmVy\neSB3b3JrZXIgZnJvbSBwcm9jZXNzaW5nIHJlcXVlc3RzLiAoZm9yIHRlc3Rp\nbmcpCiAgICAgICAgICovCiAgICAgICAgdm9pZCBzdXNwZW5kUHJvY2Vzc2lu\nZygpIHsKICAgICAgICAgICAgc3luY2hyb25pemVkKHN1c3BlbnNpb25Mb2Nr\nKSB7CiAgICAgICAgICAgICAgICBzdXNwZW5kZWQgPSB0cnVlOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBSZXN1\nbWUgRklGTyBkZWxpdmVyeSB3b3JrZXIuIChmb3IgdGVzdGluZykKICAgICAg\nICAgKi8KICAgICAgICB2b2lkIHJlc3VtZVByb2Nlc3NpbmcoKSB7CiAgICAg\nICAgICAgIHN5bmNocm9uaXplZChzdXNwZW5zaW9uTG9jaykgewogICAgICAg\nICAgICAgICAgc3VzcGVuZGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBz\ndXNwZW5zaW9uTG9jay5ub3RpZnkoKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVu\nKCkgewogICAgICAgICAgICB3aGlsZSAoa2VlcFJ1bm5pbmcpIHsKICAgICAg\nICAgICAgICAgIERlbGl2ZXJ5TWFuYWdlclJlcXVlc3QgcmVxdWVzdCA9IG51\nbGw7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAvLyBXZSB1c2UgYSB0aW1lb3V0IG9mIDEgc2Vjb25kLCBzbyB0aGF0IHdl\nIGNhbiB3YWtlIHVwIG9uY2UgaW4KICAgICAgICAgICAgICAgICAgICAvLyBh\nIHdoaWxlIHRvIGNoZWNrIGlmIHRoZXJlIGlzIHNvbWV0aGluZyBpbiB0aGUg\ncmV0cnkgcXVldWUuCiAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCA9IHJl\ncXVlc3RRdWV1ZS5wb2xsKDEsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAg\nICAgICAgICAgICAgIHN5bmNocm9uaXplZChzdXNwZW5zaW9uTG9jaykgewog\nICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSAoc3VzcGVuZGVkKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzdXNwZW5zaW9uTG9jay53YWl0\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJl\nbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICAvLyBGaXJzdCByZXRyeSBhbnkgc3Vic2NyaXB0aW9u\ncyB0aGF0IGhhZCBmYWlsZWQgYW5kIG5lZWQgYSByZXRyeQogICAgICAgICAg\nICAgICAgcmV0cnlFcnJvcmVkU3Vic2NyaWJlcnMoKTsKCiAgICAgICAgICAg\nICAgICBpZiAocmVxdWVzdCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgcmVxdWVzdC5wZXJmb3JtUmVxdWVzdCgpOwoKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgZW5xdWV1ZVdpdGhv\ndXRGYWlsdXJlKERlbGl2ZXJ5TWFuYWdlclJlcXVlc3QgcmVxdWVzdCkgewog\nICAgICAgICAgICBpZiAoIXJlcXVlc3RRdWV1ZS5vZmZlcihyZXF1ZXN0KSkg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRFcnJvcigi\nQ291bGQgbm90IGVucXVldWUgb2JqZWN0OiAiICsgcmVxdWVzdAogICAgICAg\nICAgICAgICAgICAgICsgIiB0byByZXF1ZXN0IHF1ZXVlIGZvciBkZWxpdmVy\neSB3b3JrZXIgLiIgKyBpZHgpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCByZXRyeUVycm9yZWRTdWJzY3JpYmVyQWZ0\nZXJEZWxheShBY3RpdmVTdWJzY3JpYmVyU3RhdGUgc3Vic2NyaWJlcikgewog\nICAgICAgICAgICBzdWJzY3JpYmVyLnNldExhc3RTY2FuRXJyb3JUaW1lKE1h\ndGhVdGlscy5ub3coKSk7CgogICAgICAgICAgICBpZiAoIXJldHJ5UXVldWUu\nb2ZmZXIoc3Vic2NyaWJlcikpIHsKICAgICAgICAgICAgICAgIHRocm93IG5l\ndyBVbmV4cGVjdGVkRXJyb3IoIkNvdWxkIG5vdCBlbnF1ZXVlIHRvIHJldHJ5\nIHF1ZXVlIGZvciBkZWxpdmVyeSB3b3JrZXIgIiArIGlkeCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsZWFyUmV0\ncnlEZWxheUZvclN1YnNjcmliZXIoQWN0aXZlU3Vic2NyaWJlclN0YXRlIHN1\nYnNjcmliZXIpIHsKICAgICAgICAgICAgc3Vic2NyaWJlci5jbGVhckxhc3RT\nY2FuRXJyb3JUaW1lKCk7CiAgICAgICAgICAgIGlmICghcmV0cnlRdWV1ZS5v\nZmZlcihzdWJzY3JpYmVyKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuZXhwZWN0ZWRFcnJvcigiQ291bGQgbm90IGVucXVldWUgdG8gZGVsaXZl\ncnkgbWFuYWdlciByZXRyeSBxdWV1ZSIpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIC8vIG5vIHJlcXVlc3QgaW4gcmVxdWVzdCBxdWV1ZSBub3cKICAg\nICAgICAgICAgLy8gaXNzdWUgYSBlbXB0eSBkZWxpdmVyeSByZXF1ZXN0IHRv\nIG5vdCB3YWl0aW5nIGZvciBwb2xsaW5nIHJlcXVlc3RzIHF1ZXVlCiAgICAg\nICAgICAgIGlmIChyZXF1ZXN0UXVldWUuaXNFbXB0eSgpKSB7CiAgICAgICAg\nICAgICAgICBlbnF1ZXVlV2l0aG91dEZhaWx1cmUobmV3IERlbGl2ZXJ5TWFu\nYWdlclJlcXVlc3QoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwZXJm\nb3JtUmVxdWVzdCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8g\nbm90aGluZwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBwcm90ZWN0ZWQgdm9pZCByZXRyeUVycm9yZWRTdWJzY3JpYmVycygp\nIHsKICAgICAgICAgICAgbG9uZyBsYXN0SW50ZXJlc3RpbmdGYWlsdXJlVGlt\nZSA9IE1hdGhVdGlscy5ub3coKSAtIGNmZy5nZXRTY2FuQmFja29mZlBlcmlv\nZE1zKCk7CiAgICAgICAgICAgIEFjdGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJz\nY3JpYmVyOwoKICAgICAgICAgICAgd2hpbGUgKChzdWJzY3JpYmVyID0gcmV0\ncnlRdWV1ZS5wZWVrKCkpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGlm\nIChzdWJzY3JpYmVyLmdldExhc3RTY2FuRXJyb3JUaW1lKCkgPiBsYXN0SW50\nZXJlc3RpbmdGYWlsdXJlVGltZSkgewogICAgICAgICAgICAgICAgICAgIC8v\nIE5vdCBlbm91Z2ggdGltZSBoYXMgZWxhcHNlZCB5ZXQsIHdpbGwgcmV0cnkg\nbGF0ZXIKICAgICAgICAgICAgICAgICAgICAvLyBTaW5jZSB0aGUgcXVldWUg\naXMgZmlmbywgbm8gbmVlZCB0byBjaGVjayBsYXRlciBpdGVtcwogICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICAvLyByZXRyeSBub3cKICAgICAgICAgICAgICAgIHN1YnNj\ncmliZXIuZGVsaXZlck5leHRNZXNzYWdlKCk7CiAgICAgICAgICAgICAgICBy\nZXRyeVF1ZXVlLnBvbGwoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgcHJvdGVjdGVkIGNsYXNzIFNodXRkb3duRGVsaXZlcnlNYW5hZ2Vy\nUmVxdWVzdCBpbXBsZW1lbnRzIERlbGl2ZXJ5TWFuYWdlclJlcXVlc3Qgewog\nICAgICAgICAgICAvLyBUaGlzIGlzIGEgc2ltcGxlIHR5cGUgb2YgUmVxdWVz\ndCB3ZSB3aWxsIGVucXVldWUgd2hlbiB0aGUKICAgICAgICAgICAgLy8gUHVi\nU3ViU2VydmVyIGlzIHNodXQgZG93biBhbmQgd2Ugd2FudCB0byBzdG9wIHRo\nZSBEZWxpdmVyeU1hbmFnZXIKICAgICAgICAgICAgLy8gdGhyZWFkLgogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcGVy\nZm9ybVJlcXVlc3QoKSB7CiAgICAgICAgICAgICAgICBrZWVwUnVubmluZyA9\nIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgIH0KCgoKICAg\nIHB1YmxpYyBGSUZPRGVsaXZlcnlNYW5hZ2VyKFRvcGljTWFuYWdlciB0bSwg\nUGVyc2lzdGVuY2VNYW5hZ2VyIHBlcnNpc3RlbmNlTWdyLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjZmcp\nIHsKICAgICAgICB0aGlzLnRtID0gdG07CiAgICAgICAgdGhpcy5wZXJzaXN0\nZW5jZU1nciA9IHBlcnNpc3RlbmNlTWdyOwogICAgICAgIGlmIChwZXJzaXN0\nZW5jZU1nciBpbnN0YW5jZW9mIFJlYWRBaGVhZENhY2hlKSB7CiAgICAgICAg\nICAgIHRoaXMuY2FjaGUgPSAoUmVhZEFoZWFkQ2FjaGUpIHBlcnNpc3RlbmNl\nTWdyOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuY2FjaGUg\nPSBudWxsOwogICAgICAgIH0KICAgICAgICBwZXJUb3BpY0RlbGl2ZXJ5UHRy\ncyA9CiAgICAgICAgICAgIG5ldyBDb25jdXJyZW50SGFzaE1hcDxCeXRlU3Ry\naW5nLCBTb3J0ZWRNYXA8TG9uZywgU2V0PEFjdGl2ZVN1YnNjcmliZXJTdGF0\nZT4+PigpOwogICAgICAgIHN1YnNjcmliZXJTdGF0ZXMgPQogICAgICAgICAg\nICBuZXcgQ29uY3VycmVudEhhc2hNYXA8VG9waWNTdWJzY3JpYmVyLCBBY3Rp\ndmVTdWJzY3JpYmVyU3RhdGU+KCk7CiAgICAgICAgdGhpcy5jZmcgPSBjZmc7\nCiAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgZGVsaXZlcnkgd29ya2Vycwog\nICAgICAgIHRoaXMubnVtRGVsaXZlcnlXb3JrZXJzID0gY2ZnLmdldE51bURl\nbGl2ZXJ5VGhyZWFkcygpOwogICAgICAgIHRoaXMuZGVsaXZlcnlXb3JrZXJz\nID0gbmV3IERlbGl2ZXJ5V29ya2VyW251bURlbGl2ZXJ5V29ya2Vyc107CiAg\nICAgICAgZm9yIChpbnQgaT0wOyBpPG51bURlbGl2ZXJ5V29ya2VyczsgaSsr\nKSB7CiAgICAgICAgICAgIGRlbGl2ZXJ5V29ya2Vyc1tpXSA9IG5ldyBEZWxp\ndmVyeVdvcmtlcihpKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgdm9pZCBzdGFydCgpIHsKICAgICAgICBmb3IgKGludCBp\nPTA7IGk8bnVtRGVsaXZlcnlXb3JrZXJzOyBpKyspIHsKICAgICAgICAgICAg\nZGVsaXZlcnlXb3JrZXJzW2ldLnN0YXJ0KCk7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogU3RvcCBGSUZPIGRlbGl2ZXJ5IG1hbmFnZXIgZnJv\nbSBwcm9jZXNzaW5nIHJlcXVlc3RzLiAoZm9yIHRlc3RpbmcpCiAgICAgKi8K\nICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgcHVibGljIHZvaWQgc3VzcGVu\nZFByb2Nlc3NpbmcoKSB7CiAgICAgICAgZm9yIChpbnQgaT0wOyBpPG51bURl\nbGl2ZXJ5V29ya2VyczsgaSsrKSB7CiAgICAgICAgICAgIGRlbGl2ZXJ5V29y\na2Vyc1tpXS5zdXNwZW5kUHJvY2Vzc2luZygpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJlc3VtZSBGSUZPIGRlbGl2ZXJ5IG1hbmFnZXIu\nIChmb3IgdGVzdGluZykKICAgICAqLwogICAgQFZpc2libGVGb3JUZXN0aW5n\nCiAgICBwdWJsaWMgdm9pZCByZXN1bWVQcm9jZXNzaW5nKCkgewogICAgICAg\nIGZvciAoaW50IGk9MDsgaTxudW1EZWxpdmVyeVdvcmtlcnM7IGkrKykgewog\nICAgICAgICAgICBkZWxpdmVyeVdvcmtlcnNbaV0ucmVzdW1lUHJvY2Vzc2lu\nZygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFN0b3AgdGhl\nIEZJRk8gZGVsaXZlcnkgbWFuYWdlci4KICAgICAqLwogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgdm9pZCBzdG9wKCkgewogICAgICAgIGZvciAoaW50IGk9\nMDsgaTxudW1EZWxpdmVyeVdvcmtlcnM7IGkrKykgewogICAgICAgICAgICBk\nZWxpdmVyeVdvcmtlcnNbaV0uc3RvcCgpOwogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIERlbGl2ZXJ5V29ya2VyIGdldERlbGl2ZXJ5V29ya2VyKEJ5\ndGVTdHJpbmcgdG9waWMpIHsKICAgICAgICByZXR1cm4gZGVsaXZlcnlXb3Jr\nZXJzW01hdGhVdGlscy5zaWduU2FmZU1vZCh0b3BpYy5oYXNoQ29kZSgpLCBu\ndW1EZWxpdmVyeVdvcmtlcnMpXTsKICAgIH0KCiAgICAvKioKICAgICAqID09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PSBPdXIKICAgICAqIHVzdWFsIGVucXVl\ndWUgZnVuY3Rpb24sIHN0b3AgaWYgZXJyb3IgYmVjYXVzZSBvZiB1bmJvdW5k\nZWQgcXVldWUsIHNob3VsZAogICAgICogbmV2ZXIgaGFwcGVuCiAgICAgKgog\nICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBlbnF1ZXVlV2l0aG91dEZhaWx1\ncmUoQnl0ZVN0cmluZyB0b3BpYywgRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdCBy\nZXF1ZXN0KSB7CiAgICAgICAgZ2V0RGVsaXZlcnlXb3JrZXIodG9waWMpLmVu\ncXVldWVXaXRob3V0RmFpbHVyZShyZXF1ZXN0KTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRlbGxzIHRoZSBkZWxpdmVyeSBtYW5hZ2VyIHRvIHN0YXJ0IHNl\nbmRpbmcgb3V0IG1lc3NhZ2VzIGZvciBhIHBhcnRpY3VsYXIKICAgICAqIHN1\nYnNjcmlwdGlvbgogICAgICoKICAgICAqIEBwYXJhbSB0b3BpYwogICAgICog\nQHBhcmFtIHN1YnNjcmliZXJJZAogICAgICogQHBhcmFtIHNlcUlkVG9TdGFy\ndEZyb20KICAgICAqICAgICAgICAgICAgTWVzc2FnZSBzZXF1ZW5jZS1pZCBm\ncm9tIHdoZXJlIGRlbGl2ZXJ5IHNob3VsZCBiZSBzdGFydGVkCiAgICAgKiBA\ncGFyYW0gZW5kUG9pbnQKICAgICAqICAgICAgICAgICAgVGhlIGRlbGl2ZXJ5\nIGVuZCBwb2ludCB0byB3aGljaCBzZW5kIG1lc3NhZ2VzIHRvCiAgICAgKiBA\ncGFyYW0gZmlsdGVyCiAgICAgKiAgICAgICAgICAgIE9ubHkgbWVzc2FnZXMg\ncGFzc2luZyB0aGlzIGZpbHRlciBzaG91bGQgYmUgc2VudCB0byB0aGlzCiAg\nICAgKiAgICAgICAgICAgIHN1YnNjcmliZXIKICAgICAqIEBwYXJhbSBjYWxs\nYmFjawogICAgICogICAgICAgICAgICBDYWxsYmFjayBpbnN0YW5jZQogICAg\nICogQHBhcmFtIGN0eAogICAgICogICAgICAgICAgICBDYWxsYmFjayBjb250\nZXh0CiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgc3Rh\ncnRTZXJ2aW5nU3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlvblByZWZlcmVuY2VzIHByZWZl\ncmVuY2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIE1lc3NhZ2VTZXFJZCBzZXFJZFRvU3RhcnRGcm9tLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERlbGl2ZXJ5RW5kUG9p\nbnQgZW5kUG9pbnQsIFNlcnZlck1lc3NhZ2VGaWx0ZXIgZmlsdGVyLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNr\nPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgQWN0aXZl\nU3Vic2NyaWJlclN0YXRlIHN1YnNjcmliZXIgPQogICAgICAgICAgICBuZXcg\nQWN0aXZlU3Vic2NyaWJlclN0YXRlKHRvcGljLCBzdWJzY3JpYmVySWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlZmVyZW5j\nZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vx\nSWRUb1N0YXJ0RnJvbS5nZXRMb2NhbENvbXBvbmVudCgpIC0gMSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmRQb2ludCwgZmls\ndGVyLCBjYWxsYmFjaywgY3R4KTsKCiAgICAgICAgZW5xdWV1ZVdpdGhvdXRG\nYWlsdXJlKHRvcGljLCBzdWJzY3JpYmVyKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzdG9wU2VydmluZ1N1YnNjcmliZXIoQnl0ZVN0cmluZyB0b3BpYywg\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9uRXZlbnQgZXZlbnQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2s8\nVm9pZD4gY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICBlbnF1ZXVlV2l0aG91\ndEZhaWx1cmUodG9waWMsIG5ldyBTdG9wU2VydmluZ1N1YnNjcmliZXIodG9w\naWMsIHN1YnNjcmliZXJJZCwgZXZlbnQsIGNiLCBjdHgpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEluc3RydWN0cyB0aGUgZGVsaXZlcnkgbWFuYWdlciB0\nbyBiYWNrb2ZmIG9uIHRoZSBnaXZlbiBzdWJzY3JpYmVyIGFuZAogICAgICog\ncmV0cnkgc2VuZGluZyBhZnRlciBzb21lIHRpbWUKICAgICAqCiAgICAgKiBA\ncGFyYW0gc3Vic2NyaWJlcgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZXRy\neUVycm9yZWRTdWJzY3JpYmVyQWZ0ZXJEZWxheShBY3RpdmVTdWJzY3JpYmVy\nU3RhdGUgc3Vic2NyaWJlcikgewogICAgICAgIGdldERlbGl2ZXJ5V29ya2Vy\nKHN1YnNjcmliZXIuZ2V0VG9waWMoKSkucmV0cnlFcnJvcmVkU3Vic2NyaWJl\nckFmdGVyRGVsYXkoc3Vic2NyaWJlcik7CiAgICB9CgogICAgcHVibGljIHZv\naWQgY2xlYXJSZXRyeURlbGF5Rm9yU3Vic2NyaWJlcihBY3RpdmVTdWJzY3Jp\nYmVyU3RhdGUgc3Vic2NyaWJlcikgewogICAgICAgIGdldERlbGl2ZXJ5V29y\na2VyKHN1YnNjcmliZXIuZ2V0VG9waWMoKSkuY2xlYXJSZXRyeURlbGF5Rm9y\nU3Vic2NyaWJlcihzdWJzY3JpYmVyKTsKICAgIH0KCiAgICAvLyBUT0RPOiBm\nb3Igbm93LCBJIGRvbid0IG1vdmUgbWVzc2FnZUNvbnN1bWVkIHJlcXVlc3Qg\ndG8gZGVsaXZlcnkgbWFuYWdlciB0aHJlYWQsCiAgICAvLyAgICAgICB3aGlj\naCBpcyBzdXBwb3NlZCB0byBiZSBmaXhlZCBpbiB7QGxpbmsgaHR0cHM6Ly9p\nc3N1ZXMuYXBhY2hlLm9yZy9qaXJhL2Jyb3dzZS9CT09LS0VFUEVSLTUwM30K\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgbWVzc2FnZUNvbnN1bWVk\nKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXFJZCBj\nb25zdW1lZFNlcUlkKSB7CiAgICAgICAgQWN0aXZlU3Vic2NyaWJlclN0YXRl\nIHN1YlN0YXRlID0KICAgICAgICAgICAgc3Vic2NyaWJlclN0YXRlcy5nZXQo\nbmV3IFRvcGljU3Vic2NyaWJlcih0b3BpYywgc3Vic2NyaWJlcklkKSk7CiAg\nICAgICAgaWYgKG51bGwgPT0gc3ViU3RhdGUpIHsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KICAgICAgICBzdWJTdGF0ZS5tZXNzYWdlQ29uc3Vt\nZWQoY29uc3VtZWRTZXFJZC5nZXRMb2NhbENvbXBvbmVudCgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEluc3RydWN0cyB0aGUgZGVsaXZlcnkgbWFuYWdl\nciB0byBtb3ZlIHRoZSBkZWxpdmVyeSBwb2ludGVyIGZvciBhIGdpdmVuCiAg\nICAgKiBzdWJzY3JpYmVyCiAgICAgKgogICAgICogQHBhcmFtIHN1YnNjcmli\nZXIKICAgICAqIEBwYXJhbSBwcmV2U2VxSWQKICAgICAqIEBwYXJhbSBuZXdT\nZXFJZAogICAgICovCiAgICBwdWJsaWMgdm9pZCBtb3ZlRGVsaXZlcnlQdHJG\nb3J3YXJkKEFjdGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJzY3JpYmVyLCBsb25n\nIHByZXZTZXFJZCwgbG9uZyBuZXdTZXFJZCkgewogICAgICAgIGVucXVldWVX\naXRob3V0RmFpbHVyZShzdWJzY3JpYmVyLmdldFRvcGljKCksCiAgICAgICAg\nICAgIG5ldyBEZWxpdmVyeVB0ck1vdmUoc3Vic2NyaWJlciwgcHJldlNlcUlk\nLCBuZXdTZXFJZCkpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHJlbW92\nZURlbGl2ZXJ5UHRyKEFjdGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJzY3JpYmVy\nLCBMb25nIHNlcUlkLCBib29sZWFuIGlzQWJzZW5jZU9rLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9vbGVhbiBwcnVuZVRvcGlj\nKSB7CgogICAgICAgIGFzc2VydCBzZXFJZCAhPSBudWxsOwoKICAgICAgICAv\nLyByZW1vdmUgdGhpcyBzdWJzY3JpYmVyIGZyb20gdGhlIGRlbGl2ZXJ5IHBv\naW50ZXJzIGRhdGEgc3RydWN0dXJlCiAgICAgICAgQnl0ZVN0cmluZyB0b3Bp\nYyA9IHN1YnNjcmliZXIuZ2V0VG9waWMoKTsKICAgICAgICBTb3J0ZWRNYXA8\nTG9uZywgU2V0PEFjdGl2ZVN1YnNjcmliZXJTdGF0ZT4+IGRlbGl2ZXJ5UHRy\ncyA9IHBlclRvcGljRGVsaXZlcnlQdHJzLmdldCh0b3BpYyk7CgogICAgICAg\nIGlmIChkZWxpdmVyeVB0cnMgPT0gbnVsbCAmJiAhaXNBYnNlbmNlT2spIHsK\nICAgICAgICAgICAgdGhyb3cgbmV3IFVuZXhwZWN0ZWRFcnJvcigiTm8gZGVs\naXZlcnkgcG9pbnRlcnMgZm91bmQgd2hpbGUgZGlzY29ubmVjdGluZyAiICsg\nImNoYW5uZWwgZm9yIHRvcGljOiIgKyB0b3BpYyk7CiAgICAgICAgfQoKICAg\nICAgICBpZihudWxsID09IGRlbGl2ZXJ5UHRycykgewogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoIU1hcE1ldGhvZHMucmVt\nb3ZlRnJvbU11bHRpTWFwKGRlbGl2ZXJ5UHRycywgc2VxSWQsIHN1YnNjcmli\nZXIpICYmICFpc0Fic2VuY2VPaykgewoKICAgICAgICAgICAgdGhyb3cgbmV3\nIFVuZXhwZWN0ZWRFcnJvcigiQ291bGQgbm90IGZpbmQgc3Vic2NyaWJlcjoi\nICsgc3Vic2NyaWJlciArICIgYXQgdGhlIGV4cGVjdGVkIGRlbGl2ZXJ5IHBv\naW50ZXIiKTsKICAgICAgICB9CgogICAgICAgIGlmIChwcnVuZVRvcGljICYm\nIGRlbGl2ZXJ5UHRycy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgcGVyVG9w\naWNEZWxpdmVyeVB0cnMucmVtb3ZlKHRvcGljKTsKICAgICAgICB9CgogICAg\nfQoKICAgIHByb3RlY3RlZCBsb25nIGdldE1pbmltdW1TZXFJZChCeXRlU3Ry\naW5nIHRvcGljKSB7CiAgICAgICAgU29ydGVkTWFwPExvbmcsIFNldDxBY3Rp\ndmVTdWJzY3JpYmVyU3RhdGU+PiBkZWxpdmVyeVB0cnMgPSBwZXJUb3BpY0Rl\nbGl2ZXJ5UHRycy5nZXQodG9waWMpOwoKICAgICAgICBpZiAoZGVsaXZlcnlQ\ndHJzID09IG51bGwgfHwgZGVsaXZlcnlQdHJzLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICByZXR1cm4gTG9uZy5NQVhfVkFMVUUgLSAxOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gZGVsaXZlcnlQdHJzLmZpcnN0S2V5KCk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIHZvaWQgYWRkRGVsaXZlcnlQdHIoQWN0aXZlU3Vi\nc2NyaWJlclN0YXRlIHN1YnNjcmliZXIsIExvbmcgc2VxSWQpIHsKCiAgICAg\nICAgLy8gSWYgdGhpcyB0b3BpYyBkb2Vzbid0IGV4aXN0IGluIHRoZSBwZXIt\ndG9waWMgZGVsaXZlcnkgcG9pbnRlcnMgdGFibGUsCiAgICAgICAgLy8gY3Jl\nYXRlIGFuIGVudHJ5IGZvciBpdAogICAgICAgIFNvcnRlZE1hcDxMb25nLCBT\nZXQ8QWN0aXZlU3Vic2NyaWJlclN0YXRlPj4gZGVsaXZlcnlQdHJzID0gTWFw\nTWV0aG9kcy5nZXRBZnRlckluc2VydGluZ0lmQWJzZW50KAogICAgICAgICAg\nICAgICAgICAgIHBlclRvcGljRGVsaXZlcnlQdHJzLCBzdWJzY3JpYmVyLmdl\ndFRvcGljKCksIFRyZWVNYXBMb25nVG9TZXRTdWJzY3JpYmVyRmFjdG9yeS5p\nbnN0YW5jZSk7CgogICAgICAgIE1hcE1ldGhvZHMuYWRkVG9NdWx0aU1hcChk\nZWxpdmVyeVB0cnMsIHNlcUlkLCBzdWJzY3JpYmVyLCBIYXNoTWFwU3Vic2Ny\naWJlckZhY3RvcnkuaW5zdGFuY2UpOwogICAgfQoKICAgIHB1YmxpYyBjbGFz\ncyBBY3RpdmVTdWJzY3JpYmVyU3RhdGUKICAgICAgICBpbXBsZW1lbnRzIFNj\nYW5DYWxsYmFjaywgRGVsaXZlcnlDYWxsYmFjaywgRGVsaXZlcnlNYW5hZ2Vy\nUmVxdWVzdCwgQ2FuY2VsU2NhblJlcXVlc3QgewoKICAgICAgICBzdGF0aWMg\nZmluYWwgaW50IFVOTElNSVRFRCA9IDA7CgogICAgICAgIEJ5dGVTdHJpbmcg\ndG9waWM7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQ7CiAgICAg\nICAgbG9uZyBsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZDsKICAgICAgICBib29s\nZWFuIGNvbm5lY3RlZCA9IHRydWU7CiAgICAgICAgUmVlbnRyYW50UmVhZFdy\naXRlTG9jayBjb25uZWN0ZWRMb2NrID0gbmV3IFJlZW50cmFudFJlYWRXcml0\nZUxvY2soKTsKICAgICAgICBEZWxpdmVyeUVuZFBvaW50IGRlbGl2ZXJ5RW5k\nUG9pbnQ7CiAgICAgICAgbG9uZyBsYXN0U2NhbkVycm9yVGltZSA9IC0xOwog\nICAgICAgIGxvbmcgbG9jYWxTZXFJZERlbGl2ZXJpbmdOb3c7CiAgICAgICAg\nbG9uZyBsYXN0U2VxSWRDb21tdW5pY2F0ZWRFeHRlcm5hbGx5OwogICAgICAg\nIGxvbmcgbGFzdFNlcUlkQ29uc3VtZWRVdGlsOwogICAgICAgIGJvb2xlYW4g\naXNUaHJvdHRsZWQgPSBmYWxzZTsKICAgICAgICBmaW5hbCBpbnQgbWVzc2Fn\nZVdpbmRvd1NpemU7CiAgICAgICAgU2VydmVyTWVzc2FnZUZpbHRlciBmaWx0\nZXI7CiAgICAgICAgQ2FsbGJhY2s8Vm9pZD4gY2I7CiAgICAgICAgT2JqZWN0\nIGN0eDsKCiAgICAgICAgLy8gdHJhY2sgdGhlIG91dHN0YW5kaW5nIHNjYW4g\ncmVxdWVzdAogICAgICAgIC8vIHNvIHdlIGNvdWxkIGNhbmNlbCBpdAogICAg\nICAgIFNjYW5SZXF1ZXN0IG91dHN0YW5kaW5nU2NhblJlcXVlc3Q7CgogICAg\nICAgIGZpbmFsIHN0YXRpYyBpbnQgU0VRX0lEX1NMQUNLID0gMTA7CgogICAg\nICAgIHB1YmxpYyBBY3RpdmVTdWJzY3JpYmVyU3RhdGUoQnl0ZVN0cmluZyB0\nb3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25QcmVmZXJlbmNl\ncyBwcmVmZXJlbmNlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxvbmcgbGFzdExvY2FsU2VxSWREZWxpdmVyZWQsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZWxpdmVyeUVuZFBvaW50\nIGRlbGl2ZXJ5RW5kUG9pbnQsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBTZXJ2ZXJNZXNzYWdlRmlsdGVyIGZpbHRlciwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNrPFZvaWQ+\nIGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHRoaXMudG9waWMgPSB0\nb3BpYzsKICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVySWQgPSBzdWJzY3Jp\nYmVySWQ7CiAgICAgICAgICAgIHRoaXMubGFzdExvY2FsU2VxSWREZWxpdmVy\nZWQgPSBsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZDsKICAgICAgICAgICAgdGhp\ncy5sYXN0U2VxSWRDb25zdW1lZFV0aWwgPSBsYXN0TG9jYWxTZXFJZERlbGl2\nZXJlZDsKICAgICAgICAgICAgdGhpcy5kZWxpdmVyeUVuZFBvaW50ID0gZGVs\naXZlcnlFbmRQb2ludDsKICAgICAgICAgICAgdGhpcy5maWx0ZXIgPSBmaWx0\nZXI7CiAgICAgICAgICAgIGlmIChwcmVmZXJlbmNlcy5oYXNNZXNzYWdlV2lu\nZG93U2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBtZXNzYWdlV2luZG93U2l6\nZSA9IHByZWZlcmVuY2VzLmdldE1lc3NhZ2VXaW5kb3dTaXplKCk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBpZiAoRklGT0RlbGl2\nZXJ5TWFuYWdlci50aGlzLmNmZy5nZXREZWZhdWx0TWVzc2FnZVdpbmRvd1Np\nemUoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICBtZXNzYWdlV2luZG93\nU2l6ZSA9CiAgICAgICAgICAgICAgICAgICAgICAgIEZJRk9EZWxpdmVyeU1h\nbmFnZXIudGhpcy5jZmcuZ2V0RGVmYXVsdE1lc3NhZ2VXaW5kb3dTaXplKCk7\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIG1lc3NhZ2VXaW5kb3dTaXplID0gVU5MSU1JVEVEOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuY2IgPSBjYjsK\nICAgICAgICAgICAgdGhpcy5jdHggPSBjdHg7CiAgICAgICAgfQoKICAgICAg\nICBwdWJsaWMgdm9pZCBzZXROb3RDb25uZWN0ZWQoU3Vic2NyaXB0aW9uRXZl\nbnQgZXZlbnQpIHsKICAgICAgICAgICAgdGhpcy5jb25uZWN0ZWRMb2NrLndy\naXRlTG9jaygpLmxvY2soKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIC8vIGhhdmUgY2xvc2VkIGl0LgogICAgICAgICAgICAgICAgaWYg\nKCFjb25uZWN0ZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aGlzLmNvbm5lY3Rl\nZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgLy8gcHV0IGl0c2VsZiBpbiBS\nZWFkQWhlYWQgcXVldWUgdG8gY2FuY2VsIG91dHN0YW5kaW5nIHNjYW4gcmVx\ndWVzdAogICAgICAgICAgICAgICAgLy8gaWYgb3V0c3RhbmRpbmcgc2NhbiBy\nZXF1ZXN0IGNhbGxiYWNrIGJlZm9yZSBjYW5jZWwgb3AgZXhlY3V0ZWQsCiAg\nICAgICAgICAgICAgICAvLyBub3RoaW5nIGl0IHdvdWxkIGNhbmNlbC4KICAg\nICAgICAgICAgICAgIGlmIChudWxsICE9IGNhY2hlICYmIG51bGwgIT0gb3V0\nc3RhbmRpbmdTY2FuUmVxdWVzdCkgewogICAgICAgICAgICAgICAgICAgIGNh\nY2hlLmNhbmNlbFNjYW5SZXF1ZXN0KHRvcGljLCB0aGlzKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAg\nICAgIHRoaXMuY29ubmVjdGVkTG9jay53cml0ZUxvY2soKS51bmxvY2soKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG51bGwgIT0gZXZlbnQg\nJiYKICAgICAgICAgICAgICAgIChTdWJzY3JpcHRpb25FdmVudC5UT1BJQ19N\nT1ZFRCA9PSBldmVudCB8fAogICAgICAgICAgICAgICAgIFN1YnNjcmlwdGlv\nbkV2ZW50LlNVQlNDUklQVElPTl9GT1JDRURfQ0xPU0VEID09IGV2ZW50KSkg\newogICAgICAgICAgICAgICAgLy8gd2Ugc2hvdWxkIG5vdCBjbG9zZSB0aGUg\nY2hhbm5lbCBub3cgYWZ0ZXIgZW5hYmxpbmcgbXVsdGlwbGV4aW5nCiAgICAg\nICAgICAgICAgICBQdWJTdWJSZXNwb25zZSByZXNwb25zZSA9IFB1YlN1YlJl\nc3BvbnNlVXRpbHMuZ2V0UmVzcG9uc2VGb3JTdWJzY3JpcHRpb25FdmVudCgK\nICAgICAgICAgICAgICAgICAgICB0b3BpYywgc3Vic2NyaWJlcklkLCBldmVu\ndAogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGRlbGl2ZXJ5\nRW5kUG9pbnQuc2VuZChyZXNwb25zZSwgbmV3IERlbGl2ZXJ5Q2FsbGJhY2so\nKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2VuZGluZ0ZpbmlzaGVkKCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nIG5vdwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCB0cmFuc2llbnRFcnJv\nck9uU2VuZCgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90\naGluZyBub3cKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgcGVybWFuZW50RXJyb3JPblNlbmQoKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIGlmIGNoYW5uZWwgaXMgYnJva2VuLCBjbG9zZSB0aGUgY2hh\nbm5lbAogICAgICAgICAgICAgICAgICAgICAgICBkZWxpdmVyeUVuZFBvaW50\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gdW5pbml0aWFs\naXplIGZpbHRlcgogICAgICAgICAgICB0aGlzLmZpbHRlci51bmluaXRpYWxp\nemUoKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBCeXRlU3RyaW5nIGdl\ndFRvcGljKCkgewogICAgICAgICAgICByZXR1cm4gdG9waWM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIGxvbmcgZ2V0TGFzdFNj\nYW5FcnJvclRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiBsYXN0U2NhbkVy\ncm9yVGltZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBzeW5jaHJvbml6\nZWQgdm9pZCBzZXRMYXN0U2NhbkVycm9yVGltZShsb25nIGxhc3RTY2FuRXJy\nb3JUaW1lKSB7CiAgICAgICAgICAgIHRoaXMubGFzdFNjYW5FcnJvclRpbWUg\nPSBsYXN0U2NhbkVycm9yVGltZTsKICAgICAgICB9CgogICAgICAgIC8qKgog\nICAgICAgICAqIENsZWFyIHRoZSBsYXN0IHNjYW4gZXJyb3IgdGltZSBzbyBp\ndCBjb3VsZCBiZSByZXRyeSBpbW1lZGlhdGVseS4KICAgICAgICAgKi8KICAg\nICAgICBwcm90ZWN0ZWQgc3luY2hyb25pemVkIHZvaWQgY2xlYXJMYXN0U2Nh\nbkVycm9yVGltZSgpIHsKICAgICAgICAgICAgdGhpcy5sYXN0U2NhbkVycm9y\nVGltZSA9IC0xOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xl\nYW4gaXNDb25uZWN0ZWQoKSB7CiAgICAgICAgICAgIGNvbm5lY3RlZExvY2su\ncmVhZExvY2soKS5sb2NrKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gY29ubmVjdGVkOwogICAgICAgICAgICB9IGZpbmFs\nbHkgewogICAgICAgICAgICAgICAgY29ubmVjdGVkTG9jay5yZWFkTG9jaygp\nLnVubG9jaygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgc3luY2hyb25pemVkIHZvaWQgbWVzc2FnZUNvbnN1bWVkKGxv\nbmcgbmV3U2VxSWRDb25zdW1lZCkgewogICAgICAgICAgICBpZiAobmV3U2Vx\nSWRDb25zdW1lZCA8PSBsYXN0U2VxSWRDb25zdW1lZFV0aWwpIHsKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBp\nZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAg\nIGxvZ2dlci5kZWJ1ZygiU3Vic2NyaWJlciAoe30pIG1vdmVkIGNvbnN1bWVk\nIHB0ciBmcm9tIHt9IHRvIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdmEodGhpcywgbGFzdFNlcUlkQ29uc3VtZWRVdGlsLCBuZXdTZXFJ\nZENvbnN1bWVkKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGFzdFNl\ncUlkQ29uc3VtZWRVdGlsID0gbmV3U2VxSWRDb25zdW1lZDsKICAgICAgICAg\nICAgLy8gYWZ0ZXIgdXBkYXRlZCBzZXEgaWQgY2hlY2sgd2hldGhlciBpdCBz\ndGlsbCBleGNlZWQgbXNnIGxpbWl0YXRpb24KICAgICAgICAgICAgaWYgKG1z\nZ0xpbWl0RXhjZWVkZWQoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChpc1Rocm90dGxlZCkgewog\nICAgICAgICAgICAgICAgaXNUaHJvdHRsZWQgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgIGxvZ2dlci5pbmZvKCJUcnkgdG8gd2FrZSB1cCBzdWJzY3JpYmVy\nICh7fSkgdG8gZGVsaXZlciBtZXNzYWdlcyBhZ2FpbiA6IGxhc3QgZGVsaXZl\ncmVkIHt9LCBsYXN0IGNvbnN1bWVkIHt9LiIsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB2YSh0aGlzLCBsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZCwg\nbGFzdFNlcUlkQ29uc3VtZWRVdGlsKSk7CgogICAgICAgICAgICAgICAgZW5x\ndWV1ZVdpdGhvdXRGYWlsdXJlKHRvcGljLCBuZXcgRGVsaXZlcnlNYW5hZ2Vy\nUmVxdWVzdCgpIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBwZXJmb3JtUmVxdWVzdCgp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZW5xdWV1ZQogICAgICAg\nICAgICAgICAgICAgICAgICBjbGVhclJldHJ5RGVsYXlGb3JTdWJzY3JpYmVy\nKEFjdGl2ZVN1YnNjcmliZXJTdGF0ZS50aGlzKTsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAg\nICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIGJvb2xlYW4gbXNnTGltaXRFeGNl\nZWRlZCgpIHsKICAgICAgICAgICAgaWYgKG1lc3NhZ2VXaW5kb3dTaXplID09\nIFVOTElNSVRFRCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsYXN0TG9jYWxTZXFJZERl\nbGl2ZXJlZCAtIGxhc3RTZXFJZENvbnN1bWVkVXRpbCA+PSBtZXNzYWdlV2lu\nZG93U2l6ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIHZvaWQgZGVsaXZlck5leHRNZXNzYWdlKCkgewog\nICAgICAgICAgICBjb25uZWN0ZWRMb2NrLnJlYWRMb2NrKCkubG9jaygpOwog\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgZG9EZWxpdmVyTmV4\ndE1lc3NhZ2UoKTsKICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgICAgIGNvbm5lY3RlZExvY2sucmVhZExvY2soKS51bmxvY2soKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIGRv\nRGVsaXZlck5leHRNZXNzYWdlKCkgewogICAgICAgICAgICBpZiAoIWNvbm5l\nY3RlZCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAg\nICAgICAgIC8vIGNoZWNrIHdoZXRoZXIgd2UgaGF2ZSBkZWxpdmVyZWQgZW5v\ndWdoIG1lc3NhZ2VzIHdpdGhvdXQgcmVjZWl2aW5nIHRoZWlyIGNvbnN1bWVz\nCiAgICAgICAgICAgICAgICBpZiAobXNnTGltaXRFeGNlZWRlZCgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlN1YnNjcmliZXIgKHt9\nKSBpcyB0aHJvdHRsZWQgOiBsYXN0IGRlbGl2ZXJlZCB7fSwgbGFzdCBjb25z\ndW1lZCB7fS4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZh\nKHRoaXMsIGxhc3RMb2NhbFNlcUlkRGVsaXZlcmVkLCBsYXN0U2VxSWRDb25z\ndW1lZFV0aWwpKTsKICAgICAgICAgICAgICAgICAgICBpc1Rocm90dGxlZCA9\nIHRydWU7CiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZywgc2lu\nY2UgdGhlIGRlbGl2ZXJ5IHByb2Nlc3Mgd291bGQgYmUgdGhyb3R0bGVkLgog\nICAgICAgICAgICAgICAgICAgIC8vIEFmdGVyIG1lc3NhZ2UgY29uc3VtZWQs\nIGl0IHdvdWxkIGJlIGFkZGVkIGJhY2sgdG8gcmV0cnkgcXVldWUuCiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgIGxvY2FsU2VxSWREZWxpdmVyaW5nTm93ID0gcGVyc2lz\ndGVuY2VNZ3IuZ2V0U2VxSWRBZnRlclNraXBwaW5nKHRvcGljLCBsYXN0TG9j\nYWxTZXFJZERlbGl2ZXJlZCwgMSk7CgogICAgICAgICAgICAgICAgb3V0c3Rh\nbmRpbmdTY2FuUmVxdWVzdCA9IG5ldyBTY2FuUmVxdWVzdCh0b3BpYywgbG9j\nYWxTZXFJZERlbGl2ZXJpbmdOb3csCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8qIGNhbGxiYWNrPSAqL3RoaXMsIC8qIGN0eD0gKi9udWxsKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgcGVyc2lzdGVuY2VNZ3Iuc2NhblNpbmds\nZU1lc3NhZ2Uob3V0c3RhbmRpbmdTY2FuUmVxdWVzdCk7CiAgICAgICAgfQoK\nICAgICAgICAvKioKICAgICAgICAgKiA9PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAg\nICAgICAgKiB7QGxpbmsgQ2FuY2VsU2NhblJlcXVlc3R9IG1ldGhvZHMKICAg\nICAgICAgKgogICAgICAgICAqIFRoaXMgbWV0aG9kIHJ1bnMgaW5zIHNhbWUg\ndGhyZWFkcyB3aXRoIFNjYW5DYWxsYmFjay4gV2hlbiBpdCBydW5zLAogICAg\nICAgICAqIGl0IGNoZWNrZWQgd2hldGhlciBpdCBpcyBvdXRzdGFuZGluZyBz\nY2FuIHJlcXVlc3QuIGlmIHRoZXJlIGlzIG9uZSwKICAgICAgICAgKiBjYW5j\nZWwgaXQuCiAgICAgICAgICovCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIFNjYW5SZXF1ZXN0IGdldFNjYW5SZXF1ZXN0KCkgewogICAgICAg\nICAgICAvLyBubyByYWNlIGJldHdlZW4gY2FuY2VsIHJlcXVlc3QgYW5kIHNj\nYW4gY2FsbGJhY2sKICAgICAgICAgICAgLy8gdGhlIG9ubHkgcmFjZSBpcyBi\nZXR3ZWVuIHN0b3BTZXJ2aW5nIGFuZCBkZWxpdmVyTmV4dE1lc3NhZ2UKICAg\nICAgICAgICAgLy8gZGVsaXZlck5leHRNZXNzYWdlIHdvdWxkIGJlIGV4ZWN1\ndGVkIGluIG5ldHR5IGNhbGxiYWNrIHdoaWNoIGlzIGluIG5ldHR5IHRocmVh\nZAogICAgICAgICAgICAvLyBzdG9wU2VydmluZyBpcyBydW4gaW4gZGVsaXZl\ncnkgdGhyZWFkLiBpZiBzdG9wU2VydmluZyBydW5zIGJlZm9yZSBkZWxpdmVy\nTmV4dE1lc3NhZ2UKICAgICAgICAgICAgLy8gZGVsaXZlck5leHRNZXNzYWdl\nIHdvdWxkIGhhdmUgY2hhbmNlIHRvIHB1dCBhIHN0dWIgaW4gUmVhZEFoZWFk\nQ2FjaGUKICAgICAgICAgICAgLy8gdGhlbiB3ZSBkb24ndCBoYXZlIGFueSBj\naGFuY2UgdG8gY2FuY2VsIGl0LgogICAgICAgICAgICAvLyB1c2UgY29ubmVj\ndGVkTG9jayB0byBhdm9pZCBzdWNoIHJhY2UuCiAgICAgICAgICAgIHJldHVy\nbiBvdXRzdGFuZGluZ1NjYW5SZXF1ZXN0OwogICAgICAgIH0KCiAgICAgICAg\ncHJpdmF0ZSBib29sZWFuIGNoZWNrQ29ubmVjdGVkKCkgewogICAgICAgICAg\nICBjb25uZWN0ZWRMb2NrLnJlYWRMb2NrKCkubG9jaygpOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgLy8gbWVzc2FnZSBzY2FubmVkIG1l\nYW5zIHRoZSBvdXRzdGFuZGluZyByZXF1ZXN0IGlzIGV4ZWN1dGVkCiAgICAg\nICAgICAgICAgICBvdXRzdGFuZGluZ1NjYW5SZXF1ZXN0ID0gbnVsbDsKICAg\nICAgICAgICAgICAgIHJldHVybiBjb25uZWN0ZWQ7CiAgICAgICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgICAgICBjb25uZWN0ZWRMb2NrLnJlYWRM\nb2NrKCkudW5sb2NrKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8qKgogICAgICAgICAqID09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAg\nICAqIHtAbGluayBTY2FuQ2FsbGJhY2t9IG1ldGhvZHMKICAgICAgICAgKi8K\nCiAgICAgICAgcHVibGljIHZvaWQgbWVzc2FnZVNjYW5uZWQoT2JqZWN0IGN0\neCwgTWVzc2FnZSBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY2hlY2tD\nb25uZWN0ZWQoKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBvbmx5IGluY3JlbWVudCB0b3BpYyBh\nY2Nlc3MgdGltZXMgd2hlbiB0cmllZCB0byBkZWxpdmVyIGEgbWVzc2FnZQog\nICAgICAgICAgICAvLyBmb3IgdGhvc2Ugc3Vic2NyaWJlcnMganVzdCB3YWl0\naW5nIGZvciBhIHB1Ymxpc2hlZCBmb3IgYSBsb25nIHRpbWUKICAgICAgICAg\nICAgLy8gd2UgZG9uJ3QgaW5jcmVtZW50IHRvcGljIGFjY2VzcyB0aW1lcywg\nc28gdGhlIHRvcGljIHdvdWxkIGJlIGV2aWN0ZWQKICAgICAgICAgICAgLy8g\naW4gZnV0dXJlLgogICAgICAgICAgICB0bS5pbmNyZW1lbnRUb3BpY0FjY2Vz\nc1RpbWVzKHRvcGljKTsKCiAgICAgICAgICAgIGlmICghZmlsdGVyLnRlc3RN\nZXNzYWdlKG1lc3NhZ2UpKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgZmls\ndGVyZWQgb3V0IG1lc3NhZ2VzLCB3ZSBkb24ndCBkZWxpdmVyIHRoZSBtZXNz\nYWdlIHRvIGNsaWVudCwgc28gd2Ugd291bGQgbm90CiAgICAgICAgICAgICAg\nICAvLyByZWNlaXZlIGl0cyBjb25zdW1lIHJlcXVlc3Qgd2hpY2ggbW92ZXMg\ndGhlIDxpPmxhc3RTZXFJZENvbnN1bWVkVXRpbDwvaT4gcG9pbnRlci4KICAg\nICAgICAgICAgICAgIC8vIHdlIG1vdmUgdGhlIDxpPmxhc3RTZXFJZENvbnN1\nbWVkVXRpbDwvaT4gaGVyZSBmb3IgZmlsdGVyZWQgb3V0IG1lc3NhZ2VzLCB3\naGljaCB3b3VsZAogICAgICAgICAgICAgICAgLy8gYXZvaWQgYSBzdWJzY3Jp\nYmVyIGJlaW5nIHRocm90dGxlZCBkdWUgdG8gdGhlIG1lc3NhZ2UgZ2FwIGlu\ndHJvZHVjZWQgYnkgZmlsdGVyaW5nLgogICAgICAgICAgICAgICAgLy8KICAg\nICAgICAgICAgICAgIC8vIGl0IGlzIE9LIHRvIG1vdmUgPGk+bGFzdFNlcUlk\nQ29uc3VtZWRVdGlsPC9pPiBoZXJlLCBzaW5jZSB0aGlzIHBvaW50ZXIgaXMg\nc3Vic2NyaWJlcidzCiAgICAgICAgICAgICAgICAvLyBkZWxpdmVyeSBzdGF0\nZSB3aGljaCB0byB0cm90dGxpbmcgZGVsaXZlci4gY2hhbmdpbmcgPGk+bGFz\ndFNlcUlkQ29uc3VtZWRVdGlsPC9pPiB3b3VsZAogICAgICAgICAgICAgICAg\nLy8gbm90IGFmZmVjdCB0aGUgc3Vic2NyaWJlcidzIGNvbnN1bWUgcG9pbnRl\nciBpbiB6b29rZWVwZXIgd2hpY2ggaXMgbWFuYWdlZCBpbiBzdWJzY3JpcHRp\nb24KICAgICAgICAgICAgICAgIC8vIG1hbmFnZXIuCiAgICAgICAgICAgICAg\nICAvLwogICAgICAgICAgICAgICAgLy8gQW5kIG1hcmtpbmcgbWVzc2FnZSBj\nb25zdW1lZCBiZWZvcmUgY2FsbGluZyBzZW5kaW5nIGZpbmlzaGVkLCB3b3Vs\nZCBhdm9pZCB0aGUgc3Vic2NyaWJlcgogICAgICAgICAgICAgICAgLy8gYmVp\nbmcgdGhyb3R0bGVkIGZpcnN0IGFuZCByZWxlYXNlZCBmcm9tIHRocm90dGxl\nZCBzdGF0ZSBsYXN0ZXIuCiAgICAgICAgICAgICAgICBtZXNzYWdlQ29uc3Vt\nZWQobWVzc2FnZS5nZXRNc2dJZCgpLmdldExvY2FsQ29tcG9uZW50KCkpOwog\nICAgICAgICAgICAgICAgc2VuZGluZ0ZpbmlzaGVkKCk7CiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8qKgog\nICAgICAgICAgICAgKiBUaGUgbWV0aG9kIGJlbG93IHdpbGwgaW52b2tlIG91\nciBzZW5kaW5nRmluaXNoZWQoKSBtZXRob2Qgd2hlbgogICAgICAgICAgICAg\nKiBkb25lCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBQdWJTdWJSZXNw\nb25zZSByZXNwb25zZSA9IFB1YlN1YlJlc3BvbnNlLm5ld0J1aWxkZXIoKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRQcm90\nb2NvbFZlcnNpb24oUHJvdG9jb2xWZXJzaW9uLlZFUlNJT05fT05FKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRTdGF0dXND\nb2RlKFN0YXR1c0NvZGUuU1VDQ0VTUykuc2V0VHhuSWQoMCkKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0TWVzc2FnZShtZXNz\nYWdlKS5zZXRUb3BpYyh0b3BpYykKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAuc2V0U3Vic2NyaWJlcklkKHN1YnNjcmliZXJJZCku\nYnVpbGQoKTsKCiAgICAgICAgICAgIGRlbGl2ZXJ5RW5kUG9pbnQuc2VuZChy\nZXNwb25zZSwgLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGNhbGxiYWNrID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRoaXMpOwoKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIHNjYW5GYWlsZWQoT2JqZWN0IGN0eCwgRXhjZXB0\naW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICBpZiAoIWNoZWNrQ29ubmVj\ndGVkKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgLy8gd2FpdCBmb3Igc29tZSB0aW1lIGFuZCB0aGVu\nIHJldHJ5CiAgICAgICAgICAgIHJldHJ5RXJyb3JlZFN1YnNjcmliZXJBZnRl\nckRlbGF5KHRoaXMpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgc2NhbkZpbmlzaGVkKE9iamVjdCBjdHgsIFJl\nYXNvbkZvckZpbmlzaCByZWFzb24pIHsKICAgICAgICAgICAgY2hlY2tDb25u\nZWN0ZWQoKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqID09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PQogICAgICAgICAqIHtAbGluayBEZWxpdmVyeUNh\nbGxiYWNrfSBtZXRob2RzCiAgICAgICAgICovCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgc2VuZGluZ0ZpbmlzaGVkKCkgewogICAg\nICAgICAgICBpZiAoIWlzQ29ubmVjdGVkKCkpIHsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgc3luY2hyb25p\nemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBsYXN0TG9jYWxTZXFJZERl\nbGl2ZXJlZCA9IGxvY2FsU2VxSWREZWxpdmVyaW5nTm93OwoKICAgICAgICAg\nICAgICAgIGlmIChsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZCA+IGxhc3RTZXFJ\nZENvbW11bmljYXRlZEV4dGVybmFsbHkgKyBTRVFfSURfU0xBQ0spIHsKICAg\nICAgICAgICAgICAgICAgICAvLyBOb3RlOiBUaGUgb3JkZXIgb2YgdGhlIG5l\neHQgMiBzdGF0ZW1lbnRzIGlzIGltcG9ydGFudC4gV2Ugc2hvdWxkCiAgICAg\nICAgICAgICAgICAgICAgLy8gc3VibWl0IGEgcmVxdWVzdCB0byBjaGFuZ2Ug\nb3VyIGRlbGl2ZXJ5IHBvaW50ZXIgb25seSAqYWZ0ZXIqIHdlCiAgICAgICAg\nICAgICAgICAgICAgLy8gaGF2ZSBhY3R1YWxseSBjaGFuZ2VkIGl0LiBPdGhl\ncndpc2UsIHRoZXJlIGlzIGEgcmFjZSBjb25kaXRpb24KICAgICAgICAgICAg\nICAgICAgICAvLyB3aXRoIHJlbW92YWwgb2YgdGhpcyBjaGFubmVsLCB3LnIu\ndCwgbWFpbnRhaW5pbmcgdGhlIGRlbGl2ZXJ5UHRycwogICAgICAgICAgICAg\nICAgICAgIC8vIHRyZWUgbWFwLgogICAgICAgICAgICAgICAgICAgIGxvbmcg\ncHJldklkID0gbGFzdFNlcUlkQ29tbXVuaWNhdGVkRXh0ZXJuYWxseTsKICAg\nICAgICAgICAgICAgICAgICBsYXN0U2VxSWRDb21tdW5pY2F0ZWRFeHRlcm5h\nbGx5ID0gbGFzdExvY2FsU2VxSWREZWxpdmVyZWQ7CiAgICAgICAgICAgICAg\nICAgICAgbW92ZURlbGl2ZXJ5UHRyRm9yd2FyZCh0aGlzLCBwcmV2SWQsIGxh\nc3RMb2NhbFNlcUlkRGVsaXZlcmVkKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICAvLyBpbmNyZW1lbnQgZGVsaXZlcmll\nZCBtZXNzYWdlCiAgICAgICAgICAgIFNlcnZlclN0YXRzLmdldEluc3RhbmNl\nKCkuaW5jcmVtZW50TWVzc2FnZXNEZWxpdmVyZWQoKTsKICAgICAgICAgICAg\nZGVsaXZlck5leHRNZXNzYWdlKCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgc3luY2hyb25pemVkIGxvbmcgZ2V0TGFzdFNlcUlkQ29tbXVuaWNhdGVk\nRXh0ZXJuYWxseSgpIHsKICAgICAgICAgICAgcmV0dXJuIGxhc3RTZXFJZENv\nbW11bmljYXRlZEV4dGVybmFsbHk7CiAgICAgICAgfQoKCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcGVybWFuZW50RXJyb3JPblNl\nbmQoKSB7CiAgICAgICAgICAgIC8vIHRoZSB1bmRlcmx5aW5nIGNoYW5uZWwg\naXMgYnJva2VuLCB0aGUgY2hhbm5lbCB3aWxsCiAgICAgICAgICAgIC8vIGJl\nIGNsb3NlZCBpbiBVbWJyZWxsYUhhbmRsZXIgd2hlbiBleGNlcHRpb24gaGFw\ncGVuZWQuCiAgICAgICAgICAgIC8vIHNvIHdlIGRvbid0IG5lZWQgdG8gY2xv\nc2UgdGhlIGNoYW5uZWwgYWdhaW4KICAgICAgICAgICAgc3RvcFNlcnZpbmdT\ndWJzY3JpYmVyKHRvcGljLCBzdWJzY3JpYmVySWQsIG51bGwsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBOT1BfQ0FMTEJBQ0ssIG51bGwp\nOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgdHJhbnNpZW50RXJyb3JPblNlbmQoKSB7CiAgICAgICAgICAgIHJl\ndHJ5RXJyb3JlZFN1YnNjcmliZXJBZnRlckRlbGF5KHRoaXMpOwogICAgICAg\nIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogPT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nCiAgICAgICAgICoge0BsaW5rIERlbGl2ZXJ5TWFuYWdlclJlcXVlc3R9IG1l\ndGhvZHMKICAgICAgICAgKi8KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgdm9pZCBwZXJmb3JtUmVxdWVzdCgpIHsKICAgICAgICAgICAgLy8g\nUHV0IHRoaXMgc3Vic2NyaWJlciBpbiB0aGUgY2hhbm5lbCB0byBzdWJzY3Jp\nYmVyIG1hcHBpbmcKICAgICAgICAgICAgQWN0aXZlU3Vic2NyaWJlclN0YXRl\nIHByZXZTdWJzY3JpYmVyID0KICAgICAgICAgICAgICAgIHN1YnNjcmliZXJT\ndGF0ZXMucHV0KG5ldyBUb3BpY1N1YnNjcmliZXIodG9waWMsIHN1YnNjcmli\nZXJJZCksIHRoaXMpOwoKICAgICAgICAgICAgLy8gYWZ0ZXIgcHV0IHRoZSBh\nY3RpdmUgc3Vic2NyaWJlciBpbiBzdWJzY3JpYmVyIHN0YXRlcyBtYXBwaW5n\nCiAgICAgICAgICAgIC8vIHRyaWdnZXIgdGhlIGNhbGxiYWNrIHRvIHRlbGwg\naXQgc3RhcnRlZCB0byBkZWxpdmVyIHRoZSBtZXNzYWdlCiAgICAgICAgICAg\nIC8vIHNob3VsZCBsZXQgc3Vic2NyaWJlciByZXNwb25zZSBnbyBmaXJzdCBi\nZWZvcmUgZmlyc3QgZGVsaXZlcmVkIG1lc3NhZ2UuCiAgICAgICAgICAgIGNi\nLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgKFZvaWQpbnVsbCk7CgogICAgICAg\nICAgICBpZiAocHJldlN1YnNjcmliZXIgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgLy8gd2UgYWxyZWFkeSBpbiB0aGUgZGVsaXZlcnkgdGhyZWFkLCB3\nZSBkb24ndCBuZWVkIHRvIGVxdWV1ZSBhIHN0b3AgcmVxdWVzdAogICAgICAg\nICAgICAgICAgLy8ganVzdCBzdG9wIGl0IG5vdywgc2luY2Ugc3RvcCBpcyBu\nb3QgYmxvY2tpbmcgb3BlcmF0aW9uLgogICAgICAgICAgICAgICAgLy8gYW5k\nIGFsc28gaXQgY2xlYW5zIHRoZSBvbGQgc3RhdGUgb2YgdGhlIGFjdGl2ZSBz\ndWJzY3JpYmVyIGltbWVkaWF0ZWx5LgogICAgICAgICAgICAgICAgU3Vic2Ny\naXB0aW9uRXZlbnQgc2U7CiAgICAgICAgICAgICAgICBpZiAoZGVsaXZlcnlF\nbmRQb2ludC5lcXVhbHMocHJldlN1YnNjcmliZXIuZGVsaXZlcnlFbmRQb2lu\ndCkpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlN1YnNj\ncmliZXIge30gcmVwbGFjZWQgYSBkdXBsaWNhdGVkIHN1YnNjcmliZXIge30g\nYXQgc2FtZSBkZWxpdmVyeSBwb2ludCB7fS4iLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB2YSh0aGlzLCBwcmV2U3Vic2NyaWJlciwgZGVs\naXZlcnlFbmRQb2ludCkpOwogICAgICAgICAgICAgICAgICAgIHNlID0gbnVs\nbDsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgbG9nZ2VyLmRlYnVnKCJTdWJzY3JpYmVyIHt9IGZyb20gZGVsaXZlcnkg\ncG9pbnQge30gZm9yY2VsbHkgY2xvc2VkIGRlbGl2ZXJ5IHBvaW50IHt9LiIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhKHRoaXMsIGRl\nbGl2ZXJ5RW5kUG9pbnQsIHByZXZTdWJzY3JpYmVyLmRlbGl2ZXJ5RW5kUG9p\nbnQpKTsKICAgICAgICAgICAgICAgICAgICBzZSA9IFN1YnNjcmlwdGlvbkV2\nZW50LlNVQlNDUklQVElPTl9GT1JDRURfQ0xPU0VEOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZG9TdG9wU2VydmluZ1N1YnNjcmliZXIo\ncHJldlN1YnNjcmliZXIsIHNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgc3luY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICBsYXN0\nU2VxSWRDb21tdW5pY2F0ZWRFeHRlcm5hbGx5ID0gbGFzdExvY2FsU2VxSWRE\nZWxpdmVyZWQ7CiAgICAgICAgICAgICAgICBhZGREZWxpdmVyeVB0cih0aGlz\nLCBsYXN0TG9jYWxTZXFJZERlbGl2ZXJlZCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGRlbGl2ZXJOZXh0TWVzc2FnZSgpOwogICAgICAgIH07Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJp\nbmcoKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3Ry\naW5nQnVpbGRlcigpOwogICAgICAgICAgICBzYi5hcHBlbmQoIlRvcGljOiAi\nKTsKICAgICAgICAgICAgc2IuYXBwZW5kKHRvcGljLnRvU3RyaW5nVXRmOCgp\nKTsKICAgICAgICAgICAgc2IuYXBwZW5kKCJTdWJzY3JpYmVyOiAiKTsKICAg\nICAgICAgICAgc2IuYXBwZW5kKHN1YnNjcmliZXJJZC50b1N0cmluZ1V0Zjgo\nKSk7CiAgICAgICAgICAgIHNiLmFwcGVuZCgiLCBEZWxpdmVyeVB0cjogIik7\nCiAgICAgICAgICAgIHNiLmFwcGVuZChsYXN0TG9jYWxTZXFJZERlbGl2ZXJl\nZCk7CiAgICAgICAgICAgIHJldHVybiBzYi50b1N0cmluZygpOwoKICAgICAg\nICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGNsYXNzIFN0b3BTZXJ2aW5nU3Vi\nc2NyaWJlciBpbXBsZW1lbnRzIERlbGl2ZXJ5TWFuYWdlclJlcXVlc3Qgewog\nICAgICAgIFRvcGljU3Vic2NyaWJlciB0czsKICAgICAgICBTdWJzY3JpcHRp\nb25FdmVudCBldmVudDsKICAgICAgICBmaW5hbCBDYWxsYmFjazxWb2lkPiBj\nYjsKICAgICAgICBmaW5hbCBPYmplY3QgY3R4OwoKICAgICAgICBwdWJsaWMg\nU3RvcFNlcnZpbmdTdWJzY3JpYmVyKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgU3Vic2NyaXB0aW9uRXZlbnQgZXZlbnQsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBj\nYWxsYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgICAgICB0aGlzLnRzID0g\nbmV3IFRvcGljU3Vic2NyaWJlcih0b3BpYywgc3Vic2NyaWJlcklkKTsKICAg\nICAgICAgICAgdGhpcy5ldmVudCA9IGV2ZW50OwogICAgICAgICAgICB0aGlz\nLmNiID0gY2FsbGJhY2s7CiAgICAgICAgICAgIHRoaXMuY3R4ID0gY3R4Owog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgcGVyZm9ybVJlcXVlc3QoKSB7CiAgICAgICAgICAgIEFjdGl2ZVN1YnNj\ncmliZXJTdGF0ZSBzdWJzY3JpYmVyID0gc3Vic2NyaWJlclN0YXRlcy5yZW1v\ndmUodHMpOwogICAgICAgICAgICBpZiAobnVsbCAhPSBzdWJzY3JpYmVyKSB7\nCiAgICAgICAgICAgICAgICBkb1N0b3BTZXJ2aW5nU3Vic2NyaWJlcihzdWJz\nY3JpYmVyLCBldmVudCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICB9CgogICAg\nfQoKICAgIC8qKgogICAgICogU3RvcCBzZXJ2aW5nIGEgc3Vic2NyaWJlci4g\nVGhpcyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBpbiBhCiAgICAgKiB7QGxp\nbmsgRGVsaXZlcnlNYW5hZ2VyUmVxdWVzdH0uCiAgICAgKgogICAgICogQHBh\ncmFtIHN1YnNjcmliZXIKICAgICAqICAgICAgICAgIEFjdGl2ZSBTdWJzY3Jp\nYmVyIHRvIHN0b3AKICAgICAqIEBwYXJhbSBldmVudAogICAgICogICAgICAg\nICAgU3Vic2NyaXB0aW9uIEV2ZW50IGZvciB0aGUgc3RvcCByZWFzb24KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGRvU3RvcFNlcnZpbmdTdWJzY3JpYmVy\nKEFjdGl2ZVN1YnNjcmliZXJTdGF0ZSBzdWJzY3JpYmVyLCBTdWJzY3JpcHRp\nb25FdmVudCBldmVudCkgewogICAgICAgIC8vIFRoaXMgd2lsbCBhdXRvbWF0\naWNhbGx5IHN0b3AgZGVsaXZlcnksIGFuZCBkaXNjb25uZWN0IHRoZSBjaGFu\nbmVsCiAgICAgICAgc3Vic2NyaWJlci5zZXROb3RDb25uZWN0ZWQoZXZlbnQp\nOwoKICAgICAgICAvLyBpZiB0aGUgc3Vic2NyaWJlciBoYXMgbW92ZWQgb24s\nIGEgbW92ZSByZXF1ZXN0IGZvciBpdHMgZGVsaXZlcnkKICAgICAgICAvLyBw\nb2ludGVyIG11c3QgYmUgcGVuZGluZyBpbiB0aGUgcmVxdWVzdCBxdWV1ZS4g\nTm90ZSB0aGF0IHRoZQogICAgICAgIC8vIHN1YnNjcmliZXIgZmlyc3QgY2hh\nbmdlcyBpdHMgZGVsaXZlcnkgcG9pbnRlciBhbmQgdGhlbiBzdWJtaXRzIGEK\nICAgICAgICAvLyByZXF1ZXN0IHRvIG1vdmUgc28gdGhpcyB3b3Jrcy4KICAg\nICAgICByZW1vdmVEZWxpdmVyeVB0cihzdWJzY3JpYmVyLCBzdWJzY3JpYmVy\nLmdldExhc3RTZXFJZENvbW11bmljYXRlZEV4dGVybmFsbHkoKSwgLy8KICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyBpc0Fic2VuY2VPaz0KICAgICAg\nICAgICAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIHBydW5lVG9waWM9CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgdHJ1ZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGNsYXNzIERlbGl2ZXJ5\nUHRyTW92ZSBpbXBsZW1lbnRzIERlbGl2ZXJ5TWFuYWdlclJlcXVlc3QgewoK\nICAgICAgICBBY3RpdmVTdWJzY3JpYmVyU3RhdGUgc3Vic2NyaWJlcjsKICAg\nICAgICBMb25nIG9sZFNlcUlkOwogICAgICAgIExvbmcgbmV3U2VxSWQ7Cgog\nICAgICAgIHB1YmxpYyBEZWxpdmVyeVB0ck1vdmUoQWN0aXZlU3Vic2NyaWJl\nclN0YXRlIHN1YnNjcmliZXIsIExvbmcgb2xkU2VxSWQsIExvbmcgbmV3U2Vx\nSWQpIHsKICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVyID0gc3Vic2NyaWJl\ncjsKICAgICAgICAgICAgdGhpcy5vbGRTZXFJZCA9IG9sZFNlcUlkOwogICAg\nICAgICAgICB0aGlzLm5ld1NlcUlkID0gbmV3U2VxSWQ7CiAgICAgICAgfQoK\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBwZXJmb3Jt\nUmVxdWVzdCgpIHsKICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IHN1\nYnNjcmliZXIuZ2V0VG9waWMoKTsKICAgICAgICAgICAgbG9uZyBwcmV2TWlu\nU2VxSWQgPSBnZXRNaW5pbXVtU2VxSWQodG9waWMpOwoKICAgICAgICAgICAg\naWYgKHN1YnNjcmliZXIuaXNDb25uZWN0ZWQoKSkgewogICAgICAgICAgICAg\nICAgcmVtb3ZlRGVsaXZlcnlQdHIoc3Vic2NyaWJlciwgb2xkU2VxSWQsIC8v\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpc0Fic2Vu\nY2VPaz0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNl\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJ1bmVU\nb3BpYz0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNl\nKTsKCiAgICAgICAgICAgICAgICBhZGREZWxpdmVyeVB0cihzdWJzY3JpYmVy\nLCBuZXdTZXFJZCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICByZW1vdmVEZWxpdmVyeVB0cihzdWJzY3JpYmVyLCBvbGRTZXFJZCwg\nLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlzQWJz\nZW5jZU9rPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1\nZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHBydW5l\nVG9waWM9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVl\nKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9uZyBub3dNaW5TZXFJ\nZCA9IGdldE1pbmltdW1TZXFJZCh0b3BpYyk7CgogICAgICAgICAgICBpZiAo\nbm93TWluU2VxSWQgPiBwcmV2TWluU2VxSWQpIHsKICAgICAgICAgICAgICAg\nIHBlcnNpc3RlbmNlTWdyLmRlbGl2ZXJlZFVudGlsKHRvcGljLCBub3dNaW5T\nZXFJZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICoKICAgICAq\nIER1bWIgZmFjdG9yaWVzIGZvciBvdXIgbWFwIG1ldGhvZHMKICAgICAqLwog\nICAgcHJvdGVjdGVkIHN0YXRpYyBjbGFzcyBUcmVlTWFwTG9uZ1RvU2V0U3Vi\nc2NyaWJlckZhY3RvcnkgaW1wbGVtZW50cwogICAgICAgIEZhY3Rvcnk8U29y\ndGVkTWFwPExvbmcsIFNldDxBY3RpdmVTdWJzY3JpYmVyU3RhdGU+Pj4gewog\nICAgICAgIHN0YXRpYyBUcmVlTWFwTG9uZ1RvU2V0U3Vic2NyaWJlckZhY3Rv\ncnkgaW5zdGFuY2UgPSBuZXcgVHJlZU1hcExvbmdUb1NldFN1YnNjcmliZXJG\nYWN0b3J5KCk7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBT\nb3J0ZWRNYXA8TG9uZywgU2V0PEFjdGl2ZVN1YnNjcmliZXJTdGF0ZT4+IG5l\nd0luc3RhbmNlKCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFRyZWVNYXA8\nTG9uZywgU2V0PEFjdGl2ZVN1YnNjcmliZXJTdGF0ZT4+KCk7CiAgICAgICAg\nfQogICAgfQoKICAgIHByb3RlY3RlZCBzdGF0aWMgY2xhc3MgSGFzaE1hcFN1\nYnNjcmliZXJGYWN0b3J5IGltcGxlbWVudHMgRmFjdG9yeTxTZXQ8QWN0aXZl\nU3Vic2NyaWJlclN0YXRlPj4gewogICAgICAgIHN0YXRpYyBIYXNoTWFwU3Vi\nc2NyaWJlckZhY3RvcnkgaW5zdGFuY2UgPSBuZXcgSGFzaE1hcFN1YnNjcmli\nZXJGYWN0b3J5KCk7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyBTZXQ8QWN0aXZlU3Vic2NyaWJlclN0YXRlPiBuZXdJbnN0YW5jZSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIG5ldyBIYXNoU2V0PEFjdGl2ZVN1YnNjcmli\nZXJTdGF0ZT4oKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgdm9pZCBvblN1YkNoYW5uZWxEaXNjb25uZWN0ZWQoVG9waWNT\ndWJzY3JpYmVyIHRvcGljU3Vic2NyaWJlcikgewogICAgICAgIHN0b3BTZXJ2\naW5nU3Vic2NyaWJlcih0b3BpY1N1YnNjcmliZXIuZ2V0VG9waWMoKSwgdG9w\naWNTdWJzY3JpYmVyLmdldFN1YnNjcmliZXJJZCgpLAogICAgICAgICAgICAg\nICAgbnVsbCwgTk9QX0NBTExCQUNLLCBudWxsKTsKICAgIH0KCn0K\n","encoding":"base64"}

