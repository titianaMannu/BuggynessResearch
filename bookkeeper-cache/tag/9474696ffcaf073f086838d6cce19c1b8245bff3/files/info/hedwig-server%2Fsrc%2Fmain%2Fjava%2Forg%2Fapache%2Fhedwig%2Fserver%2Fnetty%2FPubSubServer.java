{"sha":"94d61ad1bc52e98d0148b155363a09d6f3a09aab","node_id":"MDQ6QmxvYjE1NzU5NTY6OTRkNjFhZDFiYzUyZTk4ZDAxNDhiMTU1MzYzYTA5ZDZmM2EwOWFhYg==","size":22962,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/94d61ad1bc52e98d0148b155363a09d6f3a09aab","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIubmV0dHk7CgppbXBvcnQg\namF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1w\nb3J0IGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgamF2YS5u\nZXQuTWFsZm9ybWVkVVJMRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkNv\nbGxlY3Rpb25zOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291\nbnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVj\ndXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TY2hlZHVsZWRF\neGVjdXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5T\neW5jaHJvbm91c1F1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nVGltZVVuaXQ7CgppbXBvcnQgY29tLmdvb2dsZS5jb21tb24uYW5ub3RhdGlv\nbnMuVmlzaWJsZUZvclRlc3Rpbmc7CmltcG9ydCBjb20uZ29vZ2xlLmNvbW1v\nbi51dGlsLmNvbmN1cnJlbnQuVGhyZWFkRmFjdG9yeUJ1aWxkZXI7CgppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29uZmlndXJh\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9v\na0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29uZmln\ndXJhdGlvbi5Db25maWd1cmF0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLnNs\nZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5Owpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5qYm9zcy5u\nZXR0eS5ib290c3RyYXAuU2VydmVyQm9vdHN0cmFwOwppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmNoYW5uZWwuZ3JvdXAuQ2hhbm5lbEdyb3VwOwppbXBvcnQg\nb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuZ3JvdXAuRGVmYXVsdENoYW5uZWxH\ncm91cDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLnNvY2tldC5D\nbGllbnRTb2NrZXRDaGFubmVsRmFjdG9yeTsKaW1wb3J0IG9yZy5qYm9zcy5u\nZXR0eS5jaGFubmVsLnNvY2tldC5TZXJ2ZXJTb2NrZXRDaGFubmVsRmFjdG9y\neTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLnNvY2tldC5uaW8u\nTmlvQ2xpZW50U29ja2V0Q2hhbm5lbEZhY3Rvcnk7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuY2hhbm5lbC5zb2NrZXQubmlvLk5pb1NlcnZlclNvY2tldENo\nYW5uZWxGYWN0b3J5OwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmxvZ2dpbmcu\nSW50ZXJuYWxMb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmpib3NzLm5ldHR5\nLmxvZ2dpbmcuTG9nNEpMb2dnZXJGYWN0b3J5OwoKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuT3Bl\ncmF0aW9uVHlwZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5j\nb21tb24uU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnNlcnZlci5jb21tb24uVGVybWluYXRlSlZNRXhjZXB0aW9uSGFu\nZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5kZWxpdmVy\neS5EZWxpdmVyeU1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5z\nZXJ2ZXIuZGVsaXZlcnkuRklGT0RlbGl2ZXJ5TWFuYWdlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5oYW5kbGVycy5DbG9zZVN1YnNjcmlw\ndGlvbkhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIu\naGFuZGxlcnMuQ29uc3VtZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5zZXJ2ZXIuaGFuZGxlcnMuSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnNlcnZlci5oYW5kbGVycy5OZXR0eUhhbmRsZXJCZWFuOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLmhhbmRsZXJzLlB1Ymxp\nc2hIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLmhh\nbmRsZXJzLlN1YnNjcmliZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5zZXJ2ZXIuaGFuZGxlcnMuU3Vic2NyaXB0aW9uQ2hhbm5lbE1hbmFn\nZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuaGFuZGxlcnMu\nU3Vic2NyaXB0aW9uQ2hhbm5lbE1hbmFnZXIuU3ViQ2hhbm5lbERpc2Nvbm5l\nY3RlZExpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVy\nLmhhbmRsZXJzLlVuc3Vic2NyaWJlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnNlcnZlci5qbXguSGVkd2lnTUJlYW5SZWdpc3RyeTsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5tZXRhLk1ldGFkYXRhTWFu\nYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIu\nbWV0YS5aa01ldGFkYXRhTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2UuQm9va2tlZXBlclBlcnNp\nc3RlbmNlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZl\nci5wZXJzaXN0ZW5jZS5Mb2NhbERCUGVyc2lzdGVuY2VNYW5hZ2VyOwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBlcnNpc3RlbmNlLlBlcnNp\nc3RlbmNlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZl\nci5wZXJzaXN0ZW5jZS5QZXJzaXN0ZW5jZU1hbmFnZXJXaXRoUmFuZ2VTY2Fu\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBlcnNpc3RlbmNl\nLlJlYWRBaGVhZENhY2hlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2Vy\ndmVyLnJlZ2lvbnMuSGVkd2lnSHViQ2xpZW50RmFjdG9yeTsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5yZWdpb25zLlJlZ2lvbk1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuc3NsLlNzbFNlcnZl\nckNvbnRleHRGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2Vy\ndmVyLnN1YnNjcmlwdGlvbnMuSW5NZW1vcnlTdWJzY3JpcHRpb25NYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnN1YnNjcmlwdGlv\nbnMuU3Vic2NyaXB0aW9uTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnNlcnZlci5zdWJzY3JpcHRpb25zLk1NU3Vic2NyaXB0aW9uTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci50b3BpY3MuTU1U\nb3BpY01hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIu\ndG9waWNzLlRvcGljTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnNlcnZlci50b3BpY3MuVHJpdmlhbE93bkFsbFRvcGljTWFuYWdlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci50b3BpY3MuWmtUb3BpY01h\nbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNvbmN1cnJl\nbmN5VXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkVpdGhl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBlci5TYWZlQXN5\nbmNDYWxsYmFjazsKCnB1YmxpYyBjbGFzcyBQdWJTdWJTZXJ2ZXIgewoKICAg\nIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dn\nZXIoUHViU3ViU2VydmVyLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBTdHJpbmcgSk1YTkFNRV9QUkVGSVggPSAiUHViU3ViU2VydmVyXyI7\nCgogICAgLy8gTmV0dHkgcmVsYXRlZCB2YXJpYWJsZXMKICAgIFNlcnZlclNv\nY2tldENoYW5uZWxGYWN0b3J5IHNlcnZlckNoYW5uZWxGYWN0b3J5OwogICAg\nQ2xpZW50U29ja2V0Q2hhbm5lbEZhY3RvcnkgY2xpZW50Q2hhbm5lbEZhY3Rv\ncnk7CiAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5jbGllbnQuY29uZi5DbGllbnRDb25maWd1cmF0aW9uIGNs\naWVudENvbmZpZ3VyYXRpb247CiAgICBDaGFubmVsR3JvdXAgYWxsQ2hhbm5l\nbHM7CgogICAgLy8gTWFuYWdlciBjb21wb25lbnRzIHRoYXQgbWFrZSB1cCB0\naGUgUHViU3ViU2VydmVyCiAgICBQZXJzaXN0ZW5jZU1hbmFnZXIgcG07CiAg\nICBEZWxpdmVyeU1hbmFnZXIgZG07CiAgICBUb3BpY01hbmFnZXIgdG07CiAg\nICBTdWJzY3JpcHRpb25NYW5hZ2VyIHNtOwogICAgUmVnaW9uTWFuYWdlciBy\nbTsKCiAgICAvLyBNZXRhZGF0YSBNYW5hZ2VyIEZhY3RvcnkKICAgIE1ldGFk\nYXRhTWFuYWdlckZhY3RvcnkgbW07CgogICAgWm9vS2VlcGVyIHprOyAvLyBu\ndWxsIGlmIHdlIGFyZSBpbiBzdGFuZGFsb25lIG1vZGUKICAgIEJvb2tLZWVw\nZXIgYms7IC8vIG51bGwgaWYgd2UgYXJlIGluIHN0YW5kYWxvbmUgbW9kZQoK\nICAgIC8vIHdlIHVzZSB0aGlzIHRvIHByZXZlbnQgbG9uZyBzdGFjayBjaGFp\nbnMgZnJvbSBidWlsZGluZyB1cCBpbiBjYWxsYmFja3MKICAgIFNjaGVkdWxl\nZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXI7CgogICAgLy8gSk1YIEJlYW5z\nCiAgICBOZXR0eUhhbmRsZXJCZWFuIGpteE5ldHR5QmVhbjsKICAgIFB1YlN1\nYlNlcnZlckJlYW4gam14U2VydmVyQmVhbjsKICAgIGZpbmFsIFRocmVhZEdy\nb3VwIHRnOwoKICAgIHByb3RlY3RlZCBQZXJzaXN0ZW5jZU1hbmFnZXIgaW5z\ndGFudGlhdGVQZXJzaXN0ZW5jZU1hbmFnZXIoVG9waWNNYW5hZ2VyIHRvcGlj\nTWdyKSB0aHJvd3MgSU9FeGNlcHRpb24sCiAgICAgICAgSW50ZXJydXB0ZWRF\neGNlcHRpb24gewoKICAgICAgICBQZXJzaXN0ZW5jZU1hbmFnZXJXaXRoUmFu\nZ2VTY2FuIHVuZGVybHlpbmdQTTsKCiAgICAgICAgaWYgKGNvbmYuaXNTdGFu\nZGFsb25lKCkpIHsKCiAgICAgICAgICAgIHVuZGVybHlpbmdQTSA9IExvY2Fs\nREJQZXJzaXN0ZW5jZU1hbmFnZXIuaW5zdGFuY2UoKTsKCiAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIENsaWVu\ndENvbmZpZ3VyYXRpb24gYmtDb25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICAgICAgICAgIGJrQ29uZi5hZGRDb25maWd1cmF0aW9u\nKGNvbmYuZ2V0Q29uZigpKTsKICAgICAgICAgICAgICAgIGJrID0gbmV3IEJv\nb2tLZWVwZXIoYmtDb25mLCB6aywgY2xpZW50Q2hhbm5lbEZhY3RvcnkpOwog\nICAgICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDb3VsZCBub3QgaW5zdGFudGlh\ndGUgYm9va2tlZXBlciBjbGllbnQiLCBlKTsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJT0V4Y2VwdGlvbihlKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICB1bmRlcmx5aW5nUE0gPSBuZXcgQm9va2tlZXBlclBlcnNpc3RlbmNl\nTWFuYWdlcihiaywgbW0sIHRvcGljTWdyLCBjb25mLCBzY2hlZHVsZXIpOwoK\nICAgICAgICB9CgogICAgICAgIFBlcnNpc3RlbmNlTWFuYWdlciBwbSA9IHVu\nZGVybHlpbmdQTTsKCiAgICAgICAgaWYgKGNvbmYuZ2V0UmVhZEFoZWFkRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgIHBtID0gbmV3IFJlYWRBaGVhZENhY2hl\nKHVuZGVybHlpbmdQTSwgY29uZikuc3RhcnQoKTsKICAgICAgICB9CgogICAg\nICAgIHJldHVybiBwbTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU3Vic2NyaXB0\naW9uTWFuYWdlciBpbnN0YW50aWF0ZVN1YnNjcmlwdGlvbk1hbmFnZXIoVG9w\naWNNYW5hZ2VyIHRtLCBQZXJzaXN0ZW5jZU1hbmFnZXIgcG0sCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgRGVsaXZlcnlNYW5hZ2VyIGRtKSB7CiAgICAgICAgaWYg\nKGNvbmYuaXNTdGFuZGFsb25lKCkpIHsKICAgICAgICAgICAgcmV0dXJuIG5l\ndyBJbk1lbW9yeVN1YnNjcmlwdGlvbk1hbmFnZXIoY29uZiwgdG0sIHBtLCBk\nbSwgc2NoZWR1bGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBy\nZXR1cm4gbmV3IE1NU3Vic2NyaXB0aW9uTWFuYWdlcihjb25mLCBtbSwgdG0s\nIHBtLCBkbSwgc2NoZWR1bGVyKTsKICAgICAgICB9CgogICAgfQoKICAgIHBy\nb3RlY3RlZCBSZWdpb25NYW5hZ2VyIGluc3RhbnRpYXRlUmVnaW9uTWFuYWdl\ncihQZXJzaXN0ZW5jZU1hbmFnZXIgcG0sIFNjaGVkdWxlZEV4ZWN1dG9yU2Vy\ndmljZSBzY2hlZHVsZXIpIHsKICAgICAgICByZXR1cm4gbmV3IFJlZ2lvbk1h\nbmFnZXIocG0sIGNvbmYsIHprLCBzY2hlZHVsZXIsIG5ldyBIZWR3aWdIdWJD\nbGllbnRGYWN0b3J5KGNvbmYsIGNsaWVudENvbmZpZ3VyYXRpb24sCiAgICAg\nICAgICAgICAgICBjbGllbnRDaGFubmVsRmFjdG9yeSkpOwogICAgfQoKICAg\nIHByb3RlY3RlZCB2b2lkIGluc3RhbnRpYXRlWm9va2VlcGVyQ2xpZW50KCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFjb25mLmlzU3RhbmRh\nbG9uZSgpKSB7CiAgICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHNp\nZ25hbFprUmVhZHkgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CgogICAgICAg\nICAgICB6ayA9IG5ldyBab29LZWVwZXIoY29uZi5nZXRaa0hvc3QoKSwgY29u\nZi5nZXRaa1RpbWVvdXQoKSwgbmV3IFdhdGNoZXIoKSB7CiAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHBy\nb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAgICAg\nICAgaWYoRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZC5lcXVhbHMo\nZXZlbnQuZ2V0U3RhdGUoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nc2lnbmFsWmtSZWFkeS5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAg\nICAgICAvLyB3YWl0IHVudGlsIGNvbm5lY3Rpb24gaXMgZWZmZWN0aXZlCiAg\nICAgICAgICAgIGlmICghc2lnbmFsWmtSZWFkeS5hd2FpdChjb25mLmdldFpr\nVGltZW91dCgpKjIsIFRpbWVVbml0Lk1JTExJU0VDT05EUykpIHsKICAgICAg\nICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ291bGQgbm90IGVzdGFibGlzaCBj\nb25uZWN0aW9uIHdpdGggWm9vS2VlcGVyIGFmdGVyIHprX3RpbWVvdXQqMiA9\nICIgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmYuZ2V0WmtU\naW1lb3V0KCkqMiArICIgbXMuIChEZWZhdWx0IHZhbHVlIGZvciB6a190aW1l\nb3V0IGlzIDIwMDApLiIpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEV4\nY2VwdGlvbigiQ291bGQgbm90IGVzdGFibGlzaCBjb25uZWN0aW9uIHdpdGgg\nWm9vS2VlcGVyIGFmdGVyIHprX3RpbWVvdXQqMiA9ICIgKwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjb25mLmdldFprVGltZW91dCgp\nKjIgKyAiIG1zLiAoRGVmYXVsdCB2YWx1ZSBmb3IgemtfdGltZW91dCBpcyAy\nMDAwKS4iKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBpbnN0YW50aWF0ZU1ldGFkYXRhTWFuYWdlckZhY3Rv\ncnkoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29uZi5pc1N0\nYW5kYWxvbmUoKSkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQog\nICAgICAgIG1tID0gTWV0YWRhdGFNYW5hZ2VyRmFjdG9yeS5uZXdNZXRhZGF0\nYU1hbmFnZXJGYWN0b3J5KGNvbmYsIHprKTsKICAgIH0KCiAgICBwcm90ZWN0\nZWQgVG9waWNNYW5hZ2VyIGluc3RhbnRpYXRlVG9waWNNYW5hZ2VyKCkgdGhy\nb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBUb3BpY01hbmFnZXIgdG07Cgog\nICAgICAgIGlmIChjb25mLmlzU3RhbmRhbG9uZSgpKSB7CiAgICAgICAgICAg\nIHRtID0gbmV3IFRyaXZpYWxPd25BbGxUb3BpY01hbmFnZXIoY29uZiwgc2No\nZWR1bGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgaWYgKGNvbmYuaXNNZXRhZGF0YU1hbmFnZXJCYXNl\nZFRvcGljTWFuYWdlckVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nIHRtID0gbmV3IE1NVG9waWNNYW5hZ2VyKGNvbmYsIHprLCBtbSwgc2NoZWR1\nbGVyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKCEobW0gaW5zdGFuY2VvZiBaa01ldGFkYXRhTWFuYWdlckZh\nY3RvcnkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbigiVXNlcyAiICsgbW0uZ2V0Q2xhc3MoKS5nZXROYW1lKCkg\nKyAiIHRvIHN0b3JlIGhlZHdpZyBtZXRhZGF0YSwgIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgImJ1dCB1c2VzIHpv\nb2tlZXBlciBlcGhlbWVyYWwgem5vZGVzIHRvIHN0b3JlIHRvcGljIG93bmVy\nc2hpcC4gIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIkNoZWNrIHlvdXIgY29uZmlndXJhdGlvbiBhcyB0aGlzIGNv\ndWxkIGxlYWQgdG8gc2NhbGFiaWxpdHkgaXNzdWVzLiIpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0bSA9IG5ldyBaa1Rv\ncGljTWFuYWdlcih6aywgY29uZiwgc2NoZWR1bGVyKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoUHViU3ViRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ291bGQgbm90IGlu\nc3RhbnRpYXRlIFRvcGljT3duZXJzaGlwTWFuYWdlciBiYXNlZCB0b3BpYyBt\nYW5hZ2VyIiwgZSk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIHRtOwogICAgfQoKICAgcHJvdGVjdGVkIE1hcDxPcGVyYXRpb25UeXBl\nLCBIYW5kbGVyPiBpbml0aWFsaXplTmV0dHlIYW5kbGVycygKICAgICAgICAg\nICBUb3BpY01hbmFnZXIgdG0sIERlbGl2ZXJ5TWFuYWdlciBkbSwKICAgICAg\nICAgICBQZXJzaXN0ZW5jZU1hbmFnZXIgcG0sIFN1YnNjcmlwdGlvbk1hbmFn\nZXIgc20sCiAgICAgICAgICAgU3Vic2NyaXB0aW9uQ2hhbm5lbE1hbmFnZXIg\nc3ViQ2hhbm5lbE1ncikgewogICAgICAgIE1hcDxPcGVyYXRpb25UeXBlLCBI\nYW5kbGVyPiBoYW5kbGVycyA9IG5ldyBIYXNoTWFwPE9wZXJhdGlvblR5cGUs\nIEhhbmRsZXI+KCk7CiAgICAgICAgaGFuZGxlcnMucHV0KE9wZXJhdGlvblR5\ncGUuUFVCTElTSCwgbmV3IFB1Ymxpc2hIYW5kbGVyKHRtLCBwbSwgY29uZikp\nOwogICAgICAgIGhhbmRsZXJzLnB1dChPcGVyYXRpb25UeXBlLlNVQlNDUklC\nRSwKICAgICAgICAgICAgICAgICAgICAgbmV3IFN1YnNjcmliZUhhbmRsZXIo\nY29uZiwgdG0sIGRtLCBwbSwgc20sIHN1YkNoYW5uZWxNZ3IpKTsKICAgICAg\nICBoYW5kbGVycy5wdXQoT3BlcmF0aW9uVHlwZS5VTlNVQlNDUklCRSwKICAg\nICAgICAgICAgICAgICAgICAgbmV3IFVuc3Vic2NyaWJlSGFuZGxlcihjb25m\nLCB0bSwgc20sIGRtLCBzdWJDaGFubmVsTWdyKSk7CiAgICAgICAgaGFuZGxl\ncnMucHV0KE9wZXJhdGlvblR5cGUuQ09OU1VNRSwgbmV3IENvbnN1bWVIYW5k\nbGVyKHRtLCBzbSwgY29uZikpOwogICAgICAgIGhhbmRsZXJzLnB1dChPcGVy\nYXRpb25UeXBlLkNMT1NFU1VCU0NSSVBUSU9OLAogICAgICAgICAgICAgICAg\nICAgICBuZXcgQ2xvc2VTdWJzY3JpcHRpb25IYW5kbGVyKGNvbmYsIHRtLCBz\nbSwgZG0sIHN1YkNoYW5uZWxNZ3IpKTsKICAgICAgICBoYW5kbGVycyA9IENv\nbGxlY3Rpb25zLnVubW9kaWZpYWJsZU1hcChoYW5kbGVycyk7CiAgICAgICAg\ncmV0dXJuIGhhbmRsZXJzOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGlu\naXRpYWxpemVOZXR0eShTc2xTZXJ2ZXJDb250ZXh0RmFjdG9yeSBzc2xGYWN0\nb3J5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hcDxP\ncGVyYXRpb25UeXBlLCBIYW5kbGVyPiBoYW5kbGVycywKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25DaGFubmVsTWFu\nYWdlciBzdWJDaGFubmVsTWdyKSB7CiAgICAgICAgYm9vbGVhbiBpc1NTTEVu\nYWJsZWQgPSAoc3NsRmFjdG9yeSAhPSBudWxsKSA/IHRydWUgOiBmYWxzZTsK\nICAgICAgICBJbnRlcm5hbExvZ2dlckZhY3Rvcnkuc2V0RGVmYXVsdEZhY3Rv\ncnkobmV3IExvZzRKTG9nZ2VyRmFjdG9yeSgpKTsKICAgICAgICBTZXJ2ZXJC\nb290c3RyYXAgYm9vdHN0cmFwID0gbmV3IFNlcnZlckJvb3RzdHJhcChzZXJ2\nZXJDaGFubmVsRmFjdG9yeSk7CiAgICAgICAgVW1icmVsbGFIYW5kbGVyIHVt\nYnJlbGxhSGFuZGxlciA9CiAgICAgICAgICAgIG5ldyBVbWJyZWxsYUhhbmRs\nZXIoYWxsQ2hhbm5lbHMsIGhhbmRsZXJzLCBzdWJDaGFubmVsTWdyLCBpc1NT\nTEVuYWJsZWQpOwogICAgICAgIFB1YlN1YlNlcnZlclBpcGVsaW5lRmFjdG9y\neSBwaXBlbGluZSA9CiAgICAgICAgICAgIG5ldyBQdWJTdWJTZXJ2ZXJQaXBl\nbGluZUZhY3RvcnkodW1icmVsbGFIYW5kbGVyLCBzc2xGYWN0b3J5LAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmYu\nZ2V0TWF4aW11bU1lc3NhZ2VTaXplKCkpOwoKICAgICAgICBib290c3RyYXAu\nc2V0UGlwZWxpbmVGYWN0b3J5KHBpcGVsaW5lKTsKICAgICAgICBib290c3Ry\nYXAuc2V0T3B0aW9uKCJjaGlsZC50Y3BOb0RlbGF5IiwgdHJ1ZSk7CiAgICAg\nICAgYm9vdHN0cmFwLnNldE9wdGlvbigiY2hpbGQua2VlcEFsaXZlIiwgdHJ1\nZSk7CiAgICAgICAgYm9vdHN0cmFwLnNldE9wdGlvbigicmV1c2VBZGRyZXNz\nIiwgdHJ1ZSk7CgogICAgICAgIC8vIEJpbmQgYW5kIHN0YXJ0IHRvIGFjY2Vw\ndCBpbmNvbWluZyBjb25uZWN0aW9ucy4KICAgICAgICBhbGxDaGFubmVscy5h\nZGQoYm9vdHN0cmFwLmJpbmQoaXNTU0xFbmFibGVkID8gbmV3IEluZXRTb2Nr\nZXRBZGRyZXNzKGNvbmYuZ2V0U1NMU2VydmVyUG9ydCgpKQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG5ldyBJbmV0U29ja2V0\nQWRkcmVzcyhjb25mLmdldFNlcnZlclBvcnQoKSkpKTsKICAgICAgICBsb2dn\nZXIuaW5mbygiR29pbmcgaW50byByZWNlaXZlIGxvb3AiKTsKICAgIH0KCiAg\nICBwdWJsaWMgdm9pZCBzaHV0ZG93bigpIHsKICAgICAgICAvLyBUT0RPOiB0\nZWxsIGJrIHRvIGNsb3NlIGxvZ3MKCiAgICAgICAgLy8gU3RvcCB0b3BpYyBt\nYW5hZ2VyIGZpcnN0IHNpbmNlIGl0IGlzIGNvcmUgb2YgSHViIHNlcnZlcgog\nICAgICAgIHRtLnN0b3AoKTsKCiAgICAgICAgLy8gU3RvcCB0aGUgUmVnaW9u\nTWFuYWdlci4KICAgICAgICBybS5zdG9wKCk7CgogICAgICAgIC8vIFN0b3Ag\ndGhlIERlbGl2ZXJ5TWFuYWdlciBhbmQgUmVhZEFoZWFkQ2FjaGUgdGhyZWFk\ncyAoaWYKICAgICAgICAvLyBhcHBsaWNhYmxlKS4KICAgICAgICBkbS5zdG9w\nKCk7CiAgICAgICAgcG0uc3RvcCgpOwoKICAgICAgICAvLyBTdG9wIHRoZSBT\ndWJzY3JpcHRpb25NYW5hZ2VyIGlmIG5lZWRlZC4KICAgICAgICBzbS5zdG9w\nKCk7CgogICAgICAgIC8vIFNodXRkb3duIG1ldGFkYXRhIG1hbmFnZXIgaWYg\nbmVlZGVkCiAgICAgICAgaWYgKG51bGwgIT0gbW0pIHsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIG1tLnNodXRkb3duKCk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAg\nICBsb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIHNodXRkb3duIG1ldGFkYXRh\nIG1hbmFnZXIgZmFjdG9yeSEiLCBpZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIC8vIFNodXRkb3duIHRoZSBab29LZWVwZXIgYW5kIEJv\nb2tLZWVwZXIgY2xpZW50cyBvbmx5IGlmIHdlIGFyZQogICAgICAgIC8vIG5v\ndCBpbiBzdGFuZC1hbG9uZSBtb2RlLgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGlmIChiayAhPSBudWxsKQogICAgICAgICAgICAgICAgYmsuY2xvc2Uo\nKTsKICAgICAgICAgICAgaWYgKHprICE9IG51bGwpCiAgICAgICAgICAgICAg\nICB6ay5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJFcnJvciB3\naGlsZSBjbG9zaW5nIFpvb0tlZXBlciBjbGllbnQgOiAiLCBlKTsKICAgICAg\nICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJFcnJvciB3aGlsZSBjbG9zaW5nIEJvb2tLZWVwZXIgY2xp\nZW50IDogIiwgYmtlKTsKICAgICAgICB9CgogICAgICAgIC8vIENsb3NlIGFu\nZCByZWxlYXNlIHRoZSBOZXR0eSBjaGFubmVscyBhbmQgcmVzb3VyY2VzCiAg\nICAgICAgYWxsQ2hhbm5lbHMuY2xvc2UoKS5hd2FpdFVuaW50ZXJydXB0aWJs\neSgpOwogICAgICAgIHNlcnZlckNoYW5uZWxGYWN0b3J5LnJlbGVhc2VFeHRl\ncm5hbFJlc291cmNlcygpOwogICAgICAgIGNsaWVudENoYW5uZWxGYWN0b3J5\nLnJlbGVhc2VFeHRlcm5hbFJlc291cmNlcygpOwogICAgICAgIHNjaGVkdWxl\nci5zaHV0ZG93bigpOwoKICAgICAgICAvLyB1bnJlZ2lzdGVyIGpteAogICAg\nICAgIHVucmVnaXN0ZXJKTVgoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9p\nZCByZWdpc3RlckpNWChTdWJzY3JpcHRpb25DaGFubmVsTWFuYWdlciBzdWJD\naGFubmVsTWdyKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3RyaW5n\nIGpteE5hbWUgPSBKTVhOQU1FX1BSRUZJWCArIGNvbmYuZ2V0U2VydmVyUG9y\ndCgpICsgIl8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyBjb25mLmdldFNTTFNlcnZlclBvcnQoKTsKICAgICAgICAg\nICAgam14U2VydmVyQmVhbiA9IG5ldyBQdWJTdWJTZXJ2ZXJCZWFuKGpteE5h\nbWUpOwogICAgICAgICAgICBIZWR3aWdNQmVhblJlZ2lzdHJ5LmdldEluc3Rh\nbmNlKCkucmVnaXN0ZXIoam14U2VydmVyQmVhbiwgbnVsbCk7CiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBqbXhOZXR0eUJlYW4gPSBuZXcg\nTmV0dHlIYW5kbGVyQmVhbihzdWJDaGFubmVsTWdyKTsKICAgICAgICAgICAg\nICAgIEhlZHdpZ01CZWFuUmVnaXN0cnkuZ2V0SW5zdGFuY2UoKS5yZWdpc3Rl\ncihqbXhOZXR0eUJlYW4sIGpteFNlcnZlckJlYW4pOwogICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgbG9nZ2Vy\nLndhcm4oIkZhaWxlZCB0byByZWdpc3RlciB3aXRoIEpNWCIsIGUpOwogICAg\nICAgICAgICAgICAgam14TmV0dHlCZWFuID0gbnVsbDsKICAgICAgICAgICAg\nfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIGxvZ2dlci53YXJuKCJGYWlsZWQgdG8gcmVnaXN0ZXIgd2l0aCBKTVgiLCBl\nKTsKICAgICAgICAgICAgam14U2VydmVyQmVhbiA9IG51bGw7CiAgICAgICAg\nfQogICAgICAgIGlmIChwbSBpbnN0YW5jZW9mIFJlYWRBaGVhZENhY2hlKSB7\nCiAgICAgICAgICAgICgoUmVhZEFoZWFkQ2FjaGUpcG0pLnJlZ2lzdGVySk1Y\nKGpteFNlcnZlckJlYW4pOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0\nZWQgdm9pZCB1bnJlZ2lzdGVySk1YKCkgewogICAgICAgIGlmIChwbSAhPSBu\ndWxsICYmIHBtIGluc3RhbmNlb2YgUmVhZEFoZWFkQ2FjaGUpIHsKICAgICAg\nICAgICAgKChSZWFkQWhlYWRDYWNoZSlwbSkudW5yZWdpc3RlckpNWCgpOwog\nICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoam14TmV0\ndHlCZWFuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEhlZHdpZ01CZWFu\nUmVnaXN0cnkuZ2V0SW5zdGFuY2UoKS51bnJlZ2lzdGVyKGpteE5ldHR5QmVh\nbik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBsb2dnZXIud2FybigiRmFpbGVkIHRvIHVucmVn\naXN0ZXIgd2l0aCBKTVgiLCBlKTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKGpteFNlcnZlckJlYW4gIT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgSGVkd2lnTUJlYW5SZWdpc3RyeS5nZXRJbnN0YW5jZSgp\nLnVucmVnaXN0ZXIoam14U2VydmVyQmVhbik7CiAgICAgICAgICAgIH0KICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBsb2dn\nZXIud2FybigiRmFpbGVkIHRvIHVucmVnaXN0ZXIgd2l0aCBKTVgiLCBlKTsK\nICAgICAgICB9CiAgICAgICAgam14TmV0dHlCZWFuID0gbnVsbDsKICAgICAg\nICBqbXhTZXJ2ZXJCZWFuID0gbnVsbDsKICAgIH0KCiAgICAvKioKICAgICAq\nIFN0YXJ0cyB0aGUgaGVkd2lnIHNlcnZlciBvbiB0aGUgZ2l2ZW4gcG9ydAog\nICAgICoKICAgICAqIEBwYXJhbSBwb3J0CiAgICAgKiBAdGhyb3dzIENvbmZp\nZ3VyYXRpb25FeGNlcHRpb24KICAgICAqICAgICAgICAgICAgIGlmIHRoZXJl\nIGlzIHNvbWV0aGluZyB3cm9uZyB3aXRoIHRoZSBnaXZlbiBjb25maWd1cmF0\naW9uCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dz\nIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIENvbmZpZ3Vy\nYXRpb25FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIFB1YlN1YlNlcnZl\ncihmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIHNlcnZlckNvbmZpZ3VyYXRp\nb24sCiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIG9yZy5hcGFjaGUu\naGVkd2lnLmNsaWVudC5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24gY2xpZW50\nQ29uZmlndXJhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwg\nVGhyZWFkLlVuY2F1Z2h0RXhjZXB0aW9uSGFuZGxlciBleGNlcHRpb25IYW5k\nbGVyKQogICAgICAgICAgICB0aHJvd3MgQ29uZmlndXJhdGlvbkV4Y2VwdGlv\nbiB7CgogICAgICAgIC8vIEZpcnN0IHZhbGlkYXRlIHRoZSBzZXJ2ZXJDb25m\naWd1cmF0aW9uCiAgICAgICAgdGhpcy5jb25mID0gc2VydmVyQ29uZmlndXJh\ndGlvbjsKICAgICAgICBzZXJ2ZXJDb25maWd1cmF0aW9uLnZhbGlkYXRlKCk7\nCgogICAgICAgIC8vIFZhbGlkYXRlIHRoZSBjbGllbnQgY29uZmlndXJhdGlv\nbgogICAgICAgIHRoaXMuY2xpZW50Q29uZmlndXJhdGlvbiA9IGNsaWVudENv\nbmZpZ3VyYXRpb247CiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbi52YWxp\nZGF0ZSgpOwoKICAgICAgICAvLyBXZSBuZWVkIGEgY3VzdG9tIHRocmVhZCBn\ncm91cCwgc28gdGhhdCB3ZSBjYW4gb3ZlcnJpZGUgdGhlIHVuY2F1Z2h0CiAg\nICAgICAgLy8gZXhjZXB0aW9uIG1ldGhvZAogICAgICAgIHRnID0gbmV3IFRo\ncmVhZEdyb3VwKCJoZWR3aWciKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICBwdWJsaWMgdm9pZCB1bmNhdWdodEV4Y2VwdGlvbihUaHJl\nYWQgdCwgVGhyb3dhYmxlIGUpIHsKICAgICAgICAgICAgICAgIGV4Y2VwdGlv\nbkhhbmRsZXIudW5jYXVnaHRFeGNlcHRpb24odCwgZSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9OwogICAgICAgIC8vIFpvb0tlZXBlciB0aHJlYWRzIHJl\nZ2lzdGVyIHRoZWlyIG93biBoYW5kbGVyLiBCdXQgaWYgc29tZSB3b3JrIHRo\nYXQKICAgICAgICAvLyB3ZSBkbyBpbiBaSyB0aHJlYWRzIHRocm93cyBhbiBl\neGNlcHRpb24sIHdlIHdhbnQgb3VyIGhhbmRsZXIgdG8gYmUKICAgICAgICAv\nLyBjYWxsZWQsIG5vdCB0aGVpcnMuCiAgICAgICAgU2FmZUFzeW5jQ2FsbGJh\nY2suc2V0VW5jYXVnaHRFeGNlcHRpb25IYW5kbGVyKGV4Y2VwdGlvbkhhbmRs\nZXIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0KCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgZmluYWwgU3luY2hyb25vdXNRdWV1ZTxFaXRo\nZXI8T2JqZWN0LCBFeGNlcHRpb24+PiBxdWV1ZSA9IG5ldyBTeW5jaHJvbm91\nc1F1ZXVlPEVpdGhlcjxPYmplY3QsIEV4Y2VwdGlvbj4+KCk7CgogICAgICAg\nIG5ldyBUaHJlYWQodGcsIG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgLy8gU2lu\nY2UgemsgaXMgbmVlZGVkIGJ5IGFsbW9zdCBldmVyeW9uZSx0cnkgdG8gc2Vl\nIGlmIHdlCiAgICAgICAgICAgICAgICAgICAgLy8gbmVlZCB0aGF0IGZpcnN0\nCiAgICAgICAgICAgICAgICAgICAgVGhyZWFkRmFjdG9yeUJ1aWxkZXIgdGZi\nID0gbmV3IFRocmVhZEZhY3RvcnlCdWlsZGVyKCk7CiAgICAgICAgICAgICAg\nICAgICAgc2NoZWR1bGVyID0gRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZFNj\naGVkdWxlZEV4ZWN1dG9yKHRmYgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLnNldE5hbWVGb3JtYXQoIlB1YlN1YlNlcnZlclNjaGVkdWxlci0lZCIp\nLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgICAgIHNlcnZlckNoYW5uZWxG\nYWN0b3J5ID0gbmV3IE5pb1NlcnZlclNvY2tldENoYW5uZWxGYWN0b3J5KAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgRXhlY3V0b3JzLm5ld0NhY2hl\nZFRocmVhZFBvb2wodGZiLnNldE5hbWVGb3JtYXQoCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICJQdWJTdWItU2VydmVyLU5JT0Jvc3Mt\nJWQiKS5idWlsZCgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEV4\nZWN1dG9ycy5uZXdDYWNoZWRUaHJlYWRQb29sKHRmYi5zZXROYW1lRm9ybWF0\nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiUHViU3Vi\nLVNlcnZlci1OSU9Xb3JrZXItJWQiKS5idWlsZCgpKSk7CiAgICAgICAgICAg\nICAgICAgICAgY2xpZW50Q2hhbm5lbEZhY3RvcnkgPSBuZXcgTmlvQ2xpZW50\nU29ja2V0Q2hhbm5lbEZhY3RvcnkoCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBFeGVjdXRvcnMubmV3Q2FjaGVkVGhyZWFkUG9vbCh0ZmIuc2V0TmFt\nZUZvcm1hdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIlB1YlN1Yi1DbGllbnQtTklPQm9zcy0lZCIpLmJ1aWxkKCkpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgRXhlY3V0b3JzLm5ld0NhY2hlZFRocmVh\nZFBvb2wodGZiLnNldE5hbWVGb3JtYXQoCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICJQdWJTdWItQ2xpZW50LU5JT1dvcmtlci0lZCIp\nLmJ1aWxkKCkpKTsKCiAgICAgICAgICAgICAgICAgICAgaW5zdGFudGlhdGVa\nb29rZWVwZXJDbGllbnQoKTsKICAgICAgICAgICAgICAgICAgICBpbnN0YW50\naWF0ZU1ldGFkYXRhTWFuYWdlckZhY3RvcnkoKTsKICAgICAgICAgICAgICAg\nICAgICB0bSA9IGluc3RhbnRpYXRlVG9waWNNYW5hZ2VyKCk7CiAgICAgICAg\nICAgICAgICAgICAgcG0gPSBpbnN0YW50aWF0ZVBlcnNpc3RlbmNlTWFuYWdl\ncih0bSk7CiAgICAgICAgICAgICAgICAgICAgZG0gPSBuZXcgRklGT0RlbGl2\nZXJ5TWFuYWdlcih0bSwgcG0sIGNvbmYpOwogICAgICAgICAgICAgICAgICAg\nIGRtLnN0YXJ0KCk7CgogICAgICAgICAgICAgICAgICAgIHNtID0gaW5zdGFu\ndGlhdGVTdWJzY3JpcHRpb25NYW5hZ2VyKHRtLCBwbSwgZG0pOwogICAgICAg\nICAgICAgICAgICAgIHJtID0gaW5zdGFudGlhdGVSZWdpb25NYW5hZ2VyKHBt\nLCBzY2hlZHVsZXIpOwogICAgICAgICAgICAgICAgICAgIHNtLmFkZExpc3Rl\nbmVyKHJtKTsKCiAgICAgICAgICAgICAgICAgICAgYWxsQ2hhbm5lbHMgPSBu\nZXcgRGVmYXVsdENoYW5uZWxHcm91cCgiaGVkd2lnIik7CiAgICAgICAgICAg\nICAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgTmV0dHkgSGFuZGxlcnMgKHVz\nZWQgYnkgdGhlCiAgICAgICAgICAgICAgICAgICAgLy8gVW1icmVsbGFIYW5k\nbGVyKSBvbmNlIHNvIHRoZXkgY2FuIGJlIHNoYXJlZCBieQogICAgICAgICAg\nICAgICAgICAgIC8vIGJvdGggdGhlIFNTTCBhbmQgbm9uLVNTTCBjaGFubmVs\ncy4KICAgICAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25DaGFubmVsTWFu\nYWdlciBzdWJDaGFubmVsTWdyID0gbmV3IFN1YnNjcmlwdGlvbkNoYW5uZWxN\nYW5hZ2VyKCk7CiAgICAgICAgICAgICAgICAgICAgc3ViQ2hhbm5lbE1nci5h\nZGRTdWJDaGFubmVsRGlzY29ubmVjdGVkTGlzdGVuZXIoKFN1YkNoYW5uZWxE\naXNjb25uZWN0ZWRMaXN0ZW5lcikgZG0pOwogICAgICAgICAgICAgICAgICAg\nIE1hcDxPcGVyYXRpb25UeXBlLCBIYW5kbGVyPiBoYW5kbGVycyA9CiAgICAg\nICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemVOZXR0eUhhbmRsZXJzKHRt\nLCBkbSwgcG0sIHNtLCBzdWJDaGFubmVsTWdyKTsKICAgICAgICAgICAgICAg\nICAgICAvLyBJbml0aWFsaXplIE5ldHR5IGZvciB0aGUgcmVndWxhciBub24t\nU1NMIGNoYW5uZWxzCiAgICAgICAgICAgICAgICAgICAgaW5pdGlhbGl6ZU5l\ndHR5KG51bGwsIGhhbmRsZXJzLCBzdWJDaGFubmVsTWdyKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoY29uZi5pc1NTTEVuYWJsZWQoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpbml0aWFsaXplTmV0dHkobmV3IFNzbFNlcnZl\nckNvbnRleHRGYWN0b3J5KGNvbmYpLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaGFuZGxlcnMsIHN1YkNoYW5uZWxNZ3IpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBy\nZWdpc3RlciBqbXgKICAgICAgICAgICAgICAgICAgICByZWdpc3RlckpNWChz\ndWJDaGFubmVsTWdyKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGls\ncy5wdXQocXVldWUsIEVpdGhlci5yaWdodChlKSk7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KHF1ZXVlLCBFaXRoZXIub2YobmV3\nIE9iamVjdCgpLCAoRXhjZXB0aW9uKSBudWxsKSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgfSkuc3RhcnQoKTsKCiAgICAgICAgRWl0aGVyPE9iamVjdCwg\nRXhjZXB0aW9uPiBlaXRoZXIgPSBDb25jdXJyZW5jeVV0aWxzLnRha2UocXVl\ndWUpOwogICAgICAgIGlmIChlaXRoZXIubGVmdCgpID09IG51bGwpIHsKICAg\nICAgICAgICAgdGhyb3cgZWl0aGVyLnJpZ2h0KCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyBQdWJTdWJTZXJ2ZXIoU2VydmVyQ29uZmlndXJhdGlv\nbiBzZXJ2ZXJDb25maWd1cmF0aW9uLAogICAgICAgICAgICAgICAgICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuY29uZi5DbGllbnRDb25maWd1\ncmF0aW9uIGNsaWVudENvbmZpZ3VyYXRpb24pIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIHRoaXMoc2VydmVyQ29uZmlndXJhdGlvbiwgY2xpZW50Q29u\nZmlndXJhdGlvbiwgbmV3IFRlcm1pbmF0ZUpWTUV4Y2VwdGlvbkhhbmRsZXIo\nKSk7CiAgICB9CgogICAgcHVibGljIFB1YlN1YlNlcnZlcihTZXJ2ZXJDb25m\naWd1cmF0aW9uIHNlcnZlckNvbmZpZ3VyYXRpb24pIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIHRoaXMoc2VydmVyQ29uZmlndXJhdGlvbiwgbmV3IG9y\nZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5jb25mLkNsaWVudENvbmZpZ3VyYXRp\nb24oKSk7CiAgICB9CgogICAgQFZpc2libGVGb3JUZXN0aW5nCiAgICBwdWJs\naWMgRGVsaXZlcnlNYW5hZ2VyIGdldERlbGl2ZXJ5TWFuYWdlcigpIHsKICAg\nICAgICByZXR1cm4gZG07CiAgICB9CgogICAgLyoqCiAgICAgKgogICAgICog\nQHBhcmFtIG1zZwogICAgICogQHBhcmFtIHJjCiAgICAgKiAgICAgICAgICAg\nIDogY29kZSB0byBleGl0IHdpdGgKICAgICAqLwogICAgcHVibGljIHN0YXRp\nYyB2b2lkIGVycm9yTXNnQW5kRXhpdChTdHJpbmcgbXNnLCBUaHJvd2FibGUg\ndCwgaW50IHJjKSB7CiAgICAgICAgbG9nZ2VyLmVycm9yKG1zZywgdCk7CiAg\nICAgICAgU3lzdGVtLmVyci5wcmludGxuKG1zZyk7CiAgICAgICAgU3lzdGVt\nLmV4aXQocmMpOwogICAgfQoKICAgIHB1YmxpYyBmaW5hbCBzdGF0aWMgaW50\nIFJDX0lOVkFMSURfQ09ORl9GSUxFID0gMTsKICAgIHB1YmxpYyBmaW5hbCBz\ndGF0aWMgaW50IFJDX01JU0NPTkZJR1VSRUQgPSAyOwogICAgcHVibGljIGZp\nbmFsIHN0YXRpYyBpbnQgUkNfT1RIRVIgPSAzOwoKICAgIC8qKgogICAgICog\nQHBhcmFtIGFyZ3MKICAgICAqLwogICAgcHVibGljIHN0YXRpYyB2b2lkIG1h\naW4oU3RyaW5nW10gYXJncykgewoKICAgICAgICBsb2dnZXIuaW5mbygiQXR0\nZW1wdGluZyB0byBzdGFydCBIZWR3aWciKTsKICAgICAgICBTZXJ2ZXJDb25m\naWd1cmF0aW9uIHNlcnZlckNvbmZpZ3VyYXRpb24gPSBuZXcgU2VydmVyQ29u\nZmlndXJhdGlvbigpOwogICAgICAgIC8vIFRoZSBjbGllbnQgY29uZmlndXJh\ndGlvbiBmb3IgdGhlIGhlZHdpZyBjbGllbnQgaW4gdGhlIHJlZ2lvbiBtYW5h\nZ2VyLgogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5jb25mLkNs\naWVudENvbmZpZ3VyYXRpb24gcmVnaW9uTWdyQ2xpZW50Q29uZmlndXJhdGlv\nbgogICAgICAgICAgICAgICAgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcuY2xp\nZW50LmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbigpOwogICAgICAgIGlmIChh\ncmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgU3RyaW5nIGNvbmZGaWxl\nID0gYXJnc1swXTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHNlcnZlckNvbmZpZ3VyYXRpb24ubG9hZENvbmYobmV3IEZpbGUoY29uZkZp\nbGUpLnRvVVJJKCkudG9VUkwoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE1h\nbGZvcm1lZFVSTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBTdHJp\nbmcgbXNnID0gIkNvdWxkIG5vdCBvcGVuIHNlcnZlciBjb25maWd1cmF0aW9u\nIGZpbGU6ICIgKyBjb25mRmlsZTsKICAgICAgICAgICAgICAgIGVycm9yTXNn\nQW5kRXhpdChtc2csIGUsIFJDX0lOVkFMSURfQ09ORl9GSUxFKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoQ29uZmlndXJhdGlvbkV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICBTdHJpbmcgbXNnID0gIk1hbGZvcm1lZCBzZXJ2ZXIg\nY29uZmlndXJhdGlvbiBmaWxlOiAiICsgY29uZkZpbGU7CiAgICAgICAgICAg\nICAgICBlcnJvck1zZ0FuZEV4aXQobXNnLCBlLCBSQ19NSVNDT05GSUdVUkVE\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2dnZXIuaW5mbygiVXNp\nbmcgY29uZmlndXJhdGlvbiBmaWxlICIgKyBjb25mRmlsZSk7CiAgICAgICAg\nfQogICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAg\nLy8gYXJnc1sxXSBpcyB0aGUgY2xpZW50IGNvbmZpZ3VyYXRpb24gZmlsZS4K\nICAgICAgICAgICAgU3RyaW5nIGNvbmZGaWxlID0gYXJnc1sxXTsKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJlZ2lvbk1nckNsaWVudENv\nbmZpZ3VyYXRpb24ubG9hZENvbmYobmV3IEZpbGUoY29uZkZpbGUpLnRvVVJJ\nKCkudG9VUkwoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE1hbGZvcm1lZFVS\nTEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBTdHJpbmcgbXNnID0g\nIkNvdWxkIG5vdCBvcGVuIGNsaWVudCBjb25maWd1cmF0aW9uIGZpbGU6ICIg\nKyBjb25mRmlsZTsKICAgICAgICAgICAgICAgIGVycm9yTXNnQW5kRXhpdCht\nc2csIGUsIFJDX0lOVkFMSURfQ09ORl9GSUxFKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoQ29uZmlndXJhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nICAgICBTdHJpbmcgbXNnID0gIk1hbGZvcm1lZCBjbGllbnQgY29uZmlndXJh\ndGlvbiBmaWxlOiAiICsgY29uZkZpbGU7CiAgICAgICAgICAgICAgICBlcnJv\nck1zZ0FuZEV4aXQobXNnLCBlLCBSQ19NSVNDT05GSUdVUkVEKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBu\nZXcgUHViU3ViU2VydmVyKHNlcnZlckNvbmZpZ3VyYXRpb24sIHJlZ2lvbk1n\nckNsaWVudENvbmZpZ3VyYXRpb24pLnN0YXJ0KCk7CiAgICAgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgZXJyb3JNc2dBbmRFeGl0\nKCJFcnJvciBkdXJpbmcgc3RhcnR1cCIsIHQsIFJDX09USEVSKTsKICAgICAg\nICB9CiAgICB9Cn0K\n","encoding":"base64"}

