{"sha":"d0ea5b3229d407b805b913db527b36a599f154a8","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDBlYTViMzIyOWQ0MDdiODA1YjkxM2RiNTI3YjM2YTU5OWYxNTRhOA==","size":56563,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d0ea5b3229d407b805b913db527b36a599f154a8","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5F\nbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5N\nYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlRy\nZWVNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxl\nZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLmF0b21pYy5BdG9taWNCb29sZWFuOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5DbG9zZUNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxi\nYWNrLkRlbGV0ZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VyRW50cnk7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RU\neXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcu\nVmVyc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9u\naW5nLlZlcnNpb25lZDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNl\ncHRpb24uU2VydmVyTm90UmVzcG9uc2libGVGb3JUb3BpY0V4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkxlZGdlclJhbmdlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvZXh0ZW5zaW9ucy5NZXNzYWdlSWRVdGlsczsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uVG9w\naWNPcFF1ZXVlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5j\nb21tb24uVW5leHBlY3RlZEVycm9yOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcuc2VydmVyLm1ldGEuTWV0YWRhdGFNYW5hZ2VyRmFjdG9yeTsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5tZXRhLlRvcGljUGVyc2lzdGVu\nY2VNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBl\ncnNpc3RlbmNlLlNjYW5DYWxsYmFjay5SZWFzb25Gb3JGaW5pc2g7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzLlRvcGljTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci50b3BpY3MuVG9w\naWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnV0aWwuQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy56b29rZWVwZXIuU2FmZUFzeW5CS0NhbGxiYWNrOwppbXBvcnQgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuVmFyQXJncy52YTsKaW1wb3J0IHN0\nYXRpYyBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLkNoYXJzZXRzLlVURl84OwoK\nLyoqCiAqIFRoaXMgcGVyc2lzdGVuY2UgbWFuYWdlciB1c2VzIHpvb2tlZXBl\nciBhbmQgYm9va2tlZXBlciB0byBzdG9yZSBtZXNzYWdlcy4KICoKICogSW5m\nb3JtYXRpb24gYWJvdXQgdG9waWNzIGFyZSBzdG9yZWQgaW4gem9va2VlcGVy\nIHdpdGggYSB6bm9kZSBuYW1lZCBhZnRlciB0aGUKICogdG9waWMgdGhhdCBj\nb250YWlucyBhbiBBU0NJSSBlbmNvZGVkIGxpc3Qgd2l0aCByZWNvcmRzIG9m\nIHRoZSBmb2xsb3dpbmcgZm9ybToKICoKICogPHByZT4KICogc3RhcnRTZXFJ\nZChpbmNsdWRlZClcdGxlZGdlcklkXG4KICogPC9wcmU+CiAqCiAqLwoKcHVi\nbGljIGNsYXNzIEJvb2trZWVwZXJQZXJzaXN0ZW5jZU1hbmFnZXIgaW1wbGVt\nZW50cyBQZXJzaXN0ZW5jZU1hbmFnZXJXaXRoUmFuZ2VTY2FuLCBUb3BpY093\nbmVyc2hpcENoYW5nZUxpc3RlbmVyIHsKICAgIHN0YXRpYyBMb2dnZXIgbG9n\nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va2tlZXBlclBlcnNp\nc3RlbmNlTWFuYWdlci5jbGFzcyk7CiAgICBzdGF0aWMgYnl0ZVtdIHBhc3N3\nZCA9ICJzaWxseXNlY3JldCIuZ2V0Qnl0ZXMoVVRGXzgpOwogICAgcHJpdmF0\nZSBCb29rS2VlcGVyIGJrOwogICAgcHJpdmF0ZSBUb3BpY1BlcnNpc3RlbmNl\nTWFuYWdlciB0cE1hbmFnZXI7CiAgICBwcml2YXRlIFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY2ZnOwogICAgcHJpdmF0ZSBUb3BpY01hbmFnZXIgdG07CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgbG9uZyBTVEFSVF9TRVFfSUQgPSAxTDsK\nICAgIC8vIG1heCBudW1iZXIgb2YgZW50cmllcyBhbGxvd2VkIGluIGEgbGVk\nZ2VyCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBsb25nIFVOTElNSVRFRF9F\nTlRSSUVTID0gMEw7CiAgICBwcml2YXRlIGZpbmFsIGxvbmcgbWF4RW50cmll\nc1BlckxlZGdlcjsKCiAgICBzdGF0aWMgY2xhc3MgSW5NZW1vcnlMZWRnZXJS\nYW5nZSB7CiAgICAgICAgTGVkZ2VyUmFuZ2UgcmFuZ2U7CiAgICAgICAgTGVk\nZ2VySGFuZGxlIGhhbmRsZTsKCiAgICAgICAgcHVibGljIEluTWVtb3J5TGVk\nZ2VyUmFuZ2UoTGVkZ2VyUmFuZ2UgcmFuZ2UsIExlZGdlckhhbmRsZSBoYW5k\nbGUpIHsKICAgICAgICAgICAgdGhpcy5yYW5nZSA9IHJhbmdlOwogICAgICAg\nICAgICB0aGlzLmhhbmRsZSA9IGhhbmRsZTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyBJbk1lbW9yeUxlZGdlclJhbmdlKExlZGdlclJhbmdlIHJhbmdl\nKSB7CiAgICAgICAgICAgIHRoaXMocmFuZ2UsIG51bGwpOwogICAgICAgIH0K\nCiAgICAgICAgcHVibGljIGxvbmcgZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCkg\newogICAgICAgICAgICBhc3NlcnQgcmFuZ2UuaGFzU3RhcnRTZXFJZEluY2x1\nZGVkKCk7CiAgICAgICAgICAgIHJldHVybiByYW5nZS5nZXRTdGFydFNlcUlk\nSW5jbHVkZWQoKTsKICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNsYXNz\nIFRvcGljSW5mbyB7CiAgICAgICAgLyoqCiAgICAgICAgICogc3RvcmVzIHRo\nZSBsYXN0IG1lc3NhZ2Utc2VxLWlkIHZlY3RvciB0aGF0IGhhcyBiZWVuIHB1\nc2hlZCB0byBCSyBmb3IKICAgICAgICAgKiBwZXJzaXN0ZW5jZSAoYnV0IG5v\ndCBuZWNlc3NhcmlseSBhY2tlZCB5ZXQgYnkgQkspCiAgICAgICAgICoKICAg\nICAgICAgKi8KICAgICAgICBNZXNzYWdlU2VxSWQgbGFzdFNlcUlkUHVzaGVk\nOwoKICAgICAgICAvKioKICAgICAgICAgKiBzdG9yZXMgdGhlIGxhc3QgbWVz\nc2FnZS1pZCB0aGF0IGhhcyBiZWVuIGFja2VkIGJ5IEJLLiBUaGlzIG51bWJl\nciBpcwogICAgICAgICAqIGJhc2ljYWxseSB1c2VkIGZvciBsaW1pdGluZyBz\nY2FucyB0byBub3QgcmVhZCBwYXN0IHdoYXQgaGFzIGJlZW4KICAgICAgICAg\nKiBwZXJzaXN0ZWQgYnkgQksKICAgICAgICAgKi8KICAgICAgICBsb25nIGxh\nc3RFbnRyeUlkQWNrZWRJbkN1cnJlbnRMZWRnZXIgPSAtMTsgLy8gYmVjYXVz\nZSBCSyBsZWRnZXJzIHN0YXJ0cwogICAgICAgIC8vIGF0IDAKCiAgICAgICAg\nLyoqCiAgICAgICAgICogc3RvcmVzIGEgc29ydGVkIHN0cnVjdHVyZSBvZiB0\naGUgbGVkZ2VycyBmb3IgYSB0b3BpYywgbWFwcGluZyBmcm9tCiAgICAgICAg\nICogdGhlIGVuZFNlcUlkSW5jbHVkZWQgdG8gdGhlIGxlZGdlciBpbmZvLiBU\naGlzIHN0cnVjdHVyZSBkb2VzIG5vdAogICAgICAgICAqIGluY2x1ZGUgdGhl\nIGN1cnJlbnQgbGVkZ2VyCiAgICAgICAgICovCiAgICAgICAgVHJlZU1hcDxM\nb25nLCBJbk1lbW9yeUxlZGdlclJhbmdlPiBsZWRnZXJSYW5nZXMgPSBuZXcg\nVHJlZU1hcDxMb25nLCBJbk1lbW9yeUxlZGdlclJhbmdlPigpOwogICAgICAg\nIFZlcnNpb24gbGVkZ2VyUmFuZ2VzVmVyc2lvbiA9IFZlcnNpb24uTkVXOwoK\nICAgICAgICAvKioKICAgICAgICAgKiBUaGlzIGlzIHRoZSBoYW5kbGUgb2Yg\ndGhlIGN1cnJlbnQgbGVkZ2VyIHRoYXQgaXMgYmVpbmcgdXNlZCB0byB3cml0\nZQogICAgICAgICAqIG1lc3NhZ2VzCiAgICAgICAgICovCiAgICAgICAgSW5N\nZW1vcnlMZWRnZXJSYW5nZSBjdXJyZW50TGVkZ2VyUmFuZ2U7CgogICAgICAg\nIC8qKgogICAgICAgICAqIEZsYWcgdG8gcmVsZWFzZSB0b3BpYyB3aGVuIGVu\nY291bnRlcmluZyB1bnJlY292ZXJhYmxlIGV4Y2VwdGlvbnMKICAgICAgICAg\nKi8KICAgICAgICBBdG9taWNCb29sZWFuIGRvUmVsZWFzZSA9IG5ldyBBdG9t\naWNCb29sZWFuKGZhbHNlKTsKCiAgICAgICAgLyoqCiAgICAgICAgICogRmxh\nZyBpbmRpY2F0cyB0aGUgdG9waWMgaXMgY2hhbmdpbmcgbGVkZ2VyCiAgICAg\nICAgICovCiAgICAgICAgQXRvbWljQm9vbGVhbiBkb0NoYW5nZUxlZGdlciA9\nIG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICAvKioKICAgICAg\nICAgKiBMYXN0IHNlcSBpZCB0byBjaGFuZ2UgbGVkZ2VyLgogICAgICAgICAq\nLwogICAgICAgIGxvbmcgbGFzdFNlcUlkQmVmb3JlTGVkZ2VyQ2hhbmdlID0g\nLTE7CiAgICAgICAgLyoqCiAgICAgICAgICogTGlzdCB0byBidWZmZXIgYWxs\nIHBlcnNpc3QgcmVxdWVzdHMgZHVyaW5nIGNoYW5naW5nIGxlZGdlci4KICAg\nICAgICAgKi8KICAgICAgICBMaW5rZWRMaXN0PFBlcnNpc3RSZXF1ZXN0PiBk\nZWZlcnJlZFJlcXVlc3RzID0gbnVsbDsKCiAgICAgICAgZmluYWwgc3RhdGlj\nIGludCBVTkxJTUlURUQgPSAwOwogICAgICAgIGludCBtZXNzYWdlQm91bmQg\nPSBVTkxJTUlURUQ7CiAgICB9CgogICAgTWFwPEJ5dGVTdHJpbmcsIFRvcGlj\nSW5mbz4gdG9waWNJbmZvcyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxCeXRl\nU3RyaW5nLCBUb3BpY0luZm8+KCk7CgogICAgVG9waWNPcFF1ZXVlciBxdWV1\nZXI7CgogICAgLyoqCiAgICAgKiBJbnN0YW50aWF0ZXMgYSBCb29rS2VlcGVy\nUGVyc2lzdGVuY2UgbWFuYWdlci4KICAgICAqCiAgICAgKiBAcGFyYW0gYmsK\nICAgICAqICAgICAgICAgICAgYSByZWZlcmVuY2UgdG8gYm9va2tlZXBlciB0\nbyB1c2UuCiAgICAgKiBAcGFyYW0gbWV0YU1hbmFnZXJGYWN0b3J5CiAgICAg\nKiAgICAgICAgICAgIGEgbWV0YWRhdGEgbWFuYWdlciBmYWN0b3J5IGhhbmRs\nZSB0byB1c2UuCiAgICAgKiBAcGFyYW0gdG0KICAgICAqICAgICAgICAgICAg\nYSByZWZlcmVuY2UgdG8gdG9waWMgbWFuYWdlci4KICAgICAqIEBwYXJhbSBj\nZmcKICAgICAqICAgICAgICAgICAgU2VydmVyIGNvbmZpZ3VyYXRpb24gb2Jq\nZWN0CiAgICAgKiBAcGFyYW0gZXhlY3V0b3IKICAgICAqICAgICAgICAgICAg\nQSBleGVjdXRvcgogICAgICovCiAgICBwdWJsaWMgQm9va2tlZXBlclBlcnNp\nc3RlbmNlTWFuYWdlcihCb29rS2VlcGVyIGJrLCBNZXRhZGF0YU1hbmFnZXJG\nYWN0b3J5IG1ldGFNYW5hZ2VyRmFjdG9yeSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFRvcGljTWFuYWdlciB0bSwgU2VydmVy\nQ29uZmlndXJhdGlvbiBjZmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2UgZXhlY3V0\nb3IpIHsKICAgICAgICB0aGlzLmJrID0gYms7CiAgICAgICAgdGhpcy50cE1h\nbmFnZXIgPSBtZXRhTWFuYWdlckZhY3RvcnkubmV3VG9waWNQZXJzaXN0ZW5j\nZU1hbmFnZXIoKTsKICAgICAgICB0aGlzLmNmZyA9IGNmZzsKICAgICAgICB0\naGlzLnRtID0gdG07CiAgICAgICAgdGhpcy5tYXhFbnRyaWVzUGVyTGVkZ2Vy\nID0gY2ZnLmdldE1heEVudHJpZXNQZXJMZWRnZXIoKTsKICAgICAgICBxdWV1\nZXIgPSBuZXcgVG9waWNPcFF1ZXVlcihleGVjdXRvcik7CiAgICAgICAgdG0u\nYWRkVG9waWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lcih0aGlzKTsKICAgIH0K\nCiAgICBwcml2YXRlIHN0YXRpYyBMZWRnZXJSYW5nZSBidWlsZExlZGdlclJh\nbmdlKGxvbmcgbGVkZ2VySWQsIGxvbmcgc3RhcnRPZkxlZGdlciwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVz\nc2FnZVNlcUlkIGVuZE9mTGVkZ2VyKSB7CiAgICAgICAgTGVkZ2VyUmFuZ2Uu\nQnVpbGRlciBidWlsZGVyID0KICAgICAgICAgICAgTGVkZ2VyUmFuZ2UubmV3\nQnVpbGRlcigpLnNldExlZGdlcklkKGxlZGdlcklkKS5zZXRTdGFydFNlcUlk\nSW5jbHVkZWQoc3RhcnRPZkxlZGdlcikKICAgICAgICAgICAgICAgICAgICAg\nICAuc2V0RW5kU2VxSWRJbmNsdWRlZChlbmRPZkxlZGdlcik7CiAgICAgICAg\ncmV0dXJuIGJ1aWxkZXIuYnVpbGQoKTsKICAgIH0KCiAgICBjbGFzcyBSYW5n\nZVNjYW5PcCBleHRlbmRzIFRvcGljT3BRdWV1ZXIuU3luY2hyb25vdXNPcCB7\nCiAgICAgICAgUmFuZ2VTY2FuUmVxdWVzdCByZXF1ZXN0OwogICAgICAgIGlu\ndCBudW1NZXNzYWdlc1JlYWQgPSAwOwogICAgICAgIGxvbmcgdG90YWxTaXpl\nUmVhZCA9IDA7CiAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbzsKICAgICAg\nICBsb25nIHN0YXJ0U2VxSWRUb1NjYW47CgogICAgICAgIHB1YmxpYyBSYW5n\nZVNjYW5PcChSYW5nZVNjYW5SZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICAg\nICAgdGhpcyhyZXF1ZXN0LCAtMUwsIDAsIDBMKTsKICAgICAgICB9CgogICAg\nICAgIHB1YmxpYyBSYW5nZVNjYW5PcChSYW5nZVNjYW5SZXF1ZXN0IHJlcXVl\nc3QsIGxvbmcgc3RhcnRTZXFJZCwgaW50IG51bU1lc3NhZ2VzUmVhZCwgbG9u\nZyB0b3RhbFNpemVSZWFkKSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcihy\nZXF1ZXN0LnRvcGljKTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVx\ndWVzdDsKICAgICAgICAgICAgdGhpcy5zdGFydFNlcUlkVG9TY2FuID0gc3Rh\ncnRTZXFJZDsKICAgICAgICAgICAgdGhpcy5udW1NZXNzYWdlc1JlYWQgPSBu\ndW1NZXNzYWdlc1JlYWQ7CiAgICAgICAgICAgIHRoaXMudG90YWxTaXplUmVh\nZCA9IHRvdGFsU2l6ZVJlYWQ7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBydW5JbnRlcm5hbCgpIHsKICAg\nICAgICAgICAgdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwoK\nICAgICAgICAgICAgaWYgKHRvcGljSW5mbyA9PSBudWxsKSB7CiAgICAgICAg\nICAgICAgICByZXF1ZXN0LmNhbGxiYWNrLnNjYW5GYWlsZWQocmVxdWVzdC5j\ndHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmVyTm90UmVzcG9uc2libGVG\nb3JUb3BpY0V4Y2VwdGlvbigiIikpOwogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiBzdGFydFNlcUlk\nVG9TY2FuIGlzIGxlc3MgdGhhbiB6ZXJvLCB3aGljaCBtZWFucyBpdCBpcyBh\nbiB1bmZpbmlzaGVkIHNjYW4gcmVxdWVzdAogICAgICAgICAgICAvLyB3ZSBj\nb250aW51ZSB0aGUgc2NhbiBmcm9tIHRoZSBwcm92aWRlZCBwb3NpdGlvbgog\nICAgICAgICAgICBzdGFydFJlYWRpbmdGcm9tKHN0YXJ0U2VxSWRUb1NjYW4g\nPCAwID8gcmVxdWVzdC5zdGFydFNlcUlkIDogc3RhcnRTZXFJZFRvU2Nhbik7\nCiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCByZWFkKGZpbmFs\nIEluTWVtb3J5TGVkZ2VyUmFuZ2UgaW1sciwgZmluYWwgbG9uZyBzdGFydFNl\ncUlkLCBmaW5hbCBsb25nIGVuZFNlcUlkKSB7CiAgICAgICAgICAgIC8vIFZl\ncmlmeSB3aGV0aGVyIHN0YXJ0U2VxSWQgZmFsbHMgaW4gbGVkZ2VyIHJhbmdl\nLgogICAgICAgICAgICAvLyBPbmx5IHRoZSBsZWZ0IGVuZHBvaW50IG9mIHJh\nbmdlIG5lZWRzIHRvIGJlIGNoZWNrZWQuCiAgICAgICAgICAgIGlmIChpbWxy\nLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpID4gc3RhcnRTZXFJZCkgewogICAg\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKAogICAgICAgICAgICAgICAgICAg\nICAgICAiSW52YWxpZCBSYW5nZVNjYW4gcmVhZCwgc3RhcnRTZXFJZCB7fSBk\nb2Vzbid0IGZhbGwgaW4gbGVkZ2VyIHJhbmdlIFt7fSB+IHt9XSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIHZhKHN0YXJ0U2VxSWQsIGltbHIuZ2V0U3Rh\ncnRTZXFJZEluY2x1ZGVkKCksIGltbHIucmFuZ2UuaGFzRW5kU2VxSWRJbmNs\ndWRlZCgpID8gaW1sci5yYW5nZQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC5nZXRFbmRTZXFJZEluY2x1ZGVkKCkuZ2V0TG9jYWxDb21wb25l\nbnQoKSA6ICIiKSk7CiAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNr\nLnNjYW5GYWlsZWQocmVxdWVzdC5jdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24u\nVW5leHBlY3RlZENvbmRpdGlvbkV4Y2VwdGlvbigiU2NhbiByZXF1ZXN0IGlz\nIG91dCBvZiByYW5nZSIpKTsKCiAgICAgICAgICAgICAgICAvLyB0cnkgcmVs\nZWFzZSB0b3BpYyB0byByZXNldCB0aGUgc3RhdGUKICAgICAgICAgICAgICAg\nIGxvc3RUb3BpYyh0b3BpYyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpbWxyLmhhbmRsZSA9PSBu\ndWxsKSB7CgogICAgICAgICAgICAgICAgYmsuYXN5bmNPcGVuTGVkZ2VyKGlt\nbHIucmFuZ2UuZ2V0TGVkZ2VySWQoKSwgRGlnZXN0VHlwZS5DUkMzMiwgcGFz\nc3dkLAogICAgICAgICAgICAgICAgbmV3IFNhZmVBc3luQktDYWxsYmFjay5P\ncGVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZW5Db21w\nbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBsZWRnZXJIYW5kbGUsIE9iamVj\ndCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGltbHIuaGFuZGxlID0gbGVkZ2VySGFuZGxlOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmVhZChpbWxyLCBzdGFydFNlcUlkLCBlbmRTZXFJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nQktFeGNlcHRpb24gYmtlID0gQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDb3VsZCBub3Qg\nb3BlbiBsZWRnZXI6ICIgKyBpbWxyLnJhbmdlLmdldExlZGdlcklkKCkgKyAi\nIGZvciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyB0b3BpYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVl\nc3QuY2FsbGJhY2suc2NhbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRp\nb24uU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9LCByZXF1ZXN0LmN0eCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGxlZGdlciBo\nYW5kbGUgaXMgbm90IG51bGwsIHdlIGNhbiByZWFkIGZyb20gaXQKICAgICAg\nICAgICAgbG9uZyBjb3JyZWN0ZWRFbmRTZXFJZCA9IE1hdGgubWluKHN0YXJ0\nU2VxSWQgKyByZXF1ZXN0Lm1lc3NhZ2VMaW1pdCAtIG51bU1lc3NhZ2VzUmVh\nZCAtIDEsIGVuZFNlcUlkKTsKCiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNE\nZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVn\nKCJJc3N1aW5nIGEgYmsgcmVhZCBmb3IgbGVkZ2VyOiAiICsgaW1sci5oYW5k\nbGUuZ2V0SWQoKSArICIgZnJvbSBlbnRyeS1pZDogIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgKHN0YXJ0U2VxSWQgLSBpbWxyLmdldFN0YXJ0\nU2VxSWRJbmNsdWRlZCgpKSArICIgdG8gZW50cnktaWQ6ICIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIChjb3JyZWN0ZWRFbmRTZXFJZCAtIGlt\nbHIuZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCkpKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgaW1sci5oYW5kbGUuYXN5bmNSZWFkRW50cmllcyhzdGFy\ndFNlcUlkIC0gaW1sci5nZXRTdGFydFNlcUlkSW5jbHVkZWQoKSwgY29ycmVj\ndGVkRW5kU2VxSWQKICAgICAgICAgICAgLSBpbWxyLmdldFN0YXJ0U2VxSWRJ\nbmNsdWRlZCgpLCBuZXcgU2FmZUFzeW5CS0NhbGxiYWNrLlJlYWRDYWxsYmFj\naygpIHsKCiAgICAgICAgICAgICAgICBsb25nIGV4cGVjdGVkRW50cnlJZCA9\nIHN0YXJ0U2VxSWQgLSBpbWxyLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpOwoK\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgc2FmZVJlYWRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRs\nZSBsaCwgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNlcSwgT2JqZWN0IGN0\neCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlv\nbi5Db2RlLk9LIHx8ICFzZXEuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUu\nT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1lYW5zIHRo\nYXQgdGhlcmUgaXMgbm8gZW50cmllcyByZWFkLCBwcm92aWRlIGEgbWVhbmlu\nZ2Z1bCBleGNlcHRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJj\nID0gQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hFbnRyeUV4Y2VwdGlvbjsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBCS0V4Y2VwdGlvbiBia2UgPSBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwog\nICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkVycm9yIHdo\naWxlIHJlYWRpbmcgZnJvbSBsZWRnZXI6ICIgKyBpbWxyLnJhbmdlLmdldExl\nZGdlcklkKCkgKyAiIGZvciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgYmtl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFjay5z\nY2FuRmFpbGVkKHJlcXVlc3QuY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNl\ncnZpY2VEb3duRXhjZXB0aW9uKGJrZSkpOwogICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICBMZWRnZXJFbnRyeSBlbnRyeSA9IG51bGw7CiAgICAgICAg\nICAgICAgICAgICAgd2hpbGUgKHNlcS5oYXNNb3JlRWxlbWVudHMoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICBlbnRyeSA9IHNlcS5uZXh0RWxlbWVu\ndCgpOwogICAgICAgICAgICAgICAgICAgICAgICBNZXNzYWdlIG1lc3NhZ2U7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBtZXNzYWdlID0gTWVzc2FnZS5wYXJzZUZyb20oZW50\ncnkuZ2V0RW50cnlJbnB1dFN0cmVhbSgpKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgU3RyaW5nIG1zZyA9ICJVbnJlYWRhYmxlIG1lc3Nh\nZ2UgZm91bmQgaW4gbGVkZ2VyOiAiICsgaW1sci5yYW5nZS5nZXRMZWRnZXJJ\nZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiIGZvciB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1zZywgZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNr\nLnNjYW5GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlVuZXhwZWN0\nZWRDb25kaXRpb25FeGNlcHRpb24obXNnKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVhZCBy\nZXNwb25zZSBmcm9tIGxlZGdlcjoge30gZW50cnktaWQ6IHt9IiwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxoLmdldElkKCksIGVu\ndHJ5LmdldEVudHJ5SWQoKSk7CgogICAgICAgICAgICAgICAgICAgICAgICBh\nc3NlcnQgZXhwZWN0ZWRFbnRyeUlkID09IGVudHJ5LmdldEVudHJ5SWQoKSA6\nICJleHBlY3RlZEVudHJ5SWQgKCIgKyBleHBlY3RlZEVudHJ5SWQKICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiKSAhPSBlbnRyeS5nZXRFbnRyeUlkKCkg\nKCIgKyBlbnRyeS5nZXRFbnRyeUlkKCkgKyAiKSI7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGFzc2VydCAobWVzc2FnZS5nZXRNc2dJZCgpLmdldExvY2Fs\nQ29tcG9uZW50KCkgLSBpbWxyLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgpKSA9\nPSBleHBlY3RlZEVudHJ5SWQ7CgogICAgICAgICAgICAgICAgICAgICAgICBl\neHBlY3RlZEVudHJ5SWQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgcmVx\ndWVzdC5jYWxsYmFjay5tZXNzYWdlU2Nhbm5lZChjdHgsIG1lc3NhZ2UpOwog\nICAgICAgICAgICAgICAgICAgICAgICBudW1NZXNzYWdlc1JlYWQrKzsKICAg\nICAgICAgICAgICAgICAgICAgICAgdG90YWxTaXplUmVhZCArPSBtZXNzYWdl\nLmdldEJvZHkoKS5zaXplKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAobnVtTWVzc2FnZXNSZWFkID49IHJlcXVlc3QubWVzc2FnZUxpbWl0KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNr\nLnNjYW5GaW5pc2hlZChjdHgsIFJlYXNvbkZvckZpbmlzaC5OVU1fTUVTU0FH\nRVNfTElNSVRfRVhDRUVERUQpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAodG90YWxTaXplUmVhZCA+PSByZXF1ZXN0\nLnNpemVMaW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVx\ndWVzdC5jYWxsYmFjay5zY2FuRmluaXNoZWQoY3R4LCBSZWFzb25Gb3JGaW5p\nc2guU0laRV9MSU1JVF9FWENFRURFRCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNv\nbnRpbnVlIHNjYW5uaW5nIG1lc3NhZ2VzCiAgICAgICAgICAgICAgICAgICAg\nc2Nhbk1lc3NhZ2VzKHJlcXVlc3QsIGltbHIuZ2V0U3RhcnRTZXFJZEluY2x1\nZGVkKCkgKyBlbnRyeS5nZXRFbnRyeUlkKCkgKyAxLCBudW1NZXNzYWdlc1Jl\nYWQsIHRvdGFsU2l6ZVJlYWQpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9LCByZXF1ZXN0LmN0eCk7CiAgICAgICAgfQoKICAgICAgICBwcm90\nZWN0ZWQgdm9pZCBzdGFydFJlYWRpbmdGcm9tKGxvbmcgc3RhcnRTZXFJZCkg\newoKICAgICAgICAgICAgTWFwLkVudHJ5PExvbmcsIEluTWVtb3J5TGVkZ2Vy\nUmFuZ2U+IGVudHJ5ID0gdG9waWNJbmZvLmxlZGdlclJhbmdlcy5jZWlsaW5n\nRW50cnkoc3RhcnRTZXFJZCk7CgogICAgICAgICAgICBpZiAoZW50cnkgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgLy8gTm9uZSBvZiB0aGUgb2xkIGxl\nZGdlcnMgaGF2ZSB0aGlzIHNlcS1pZCwgd2UgbXVzdCB1c2UgdGhlCiAgICAg\nICAgICAgICAgICAvLyBjdXJyZW50IGxlZGdlcgogICAgICAgICAgICAgICAg\nbG9uZyBlbmRTZXFJZCA9IHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2Uu\nZ2V0U3RhcnRTZXFJZEluY2x1ZGVkKCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIHRvcGljSW5mby5sYXN0RW50cnlJZEFja2VkSW5DdXJy\nZW50TGVkZ2VyOwoKICAgICAgICAgICAgICAgIGlmIChlbmRTZXFJZCA8IHN0\nYXJ0U2VxSWQpIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxi\nYWNrLnNjYW5GaW5pc2hlZChyZXF1ZXN0LmN0eCwgUmVhc29uRm9yRmluaXNo\nLk5PX01PUkVfTUVTU0FHRVMpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZWFkKHRv\ncGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UsIHN0YXJ0U2VxSWQsIGVuZFNl\ncUlkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJl\nYWQoZW50cnkuZ2V0VmFsdWUoKSwgc3RhcnRTZXFJZCwgZW50cnkuZ2V0VmFs\ndWUoKS5yYW5nZS5nZXRFbmRTZXFJZEluY2x1ZGVkKCkuZ2V0TG9jYWxDb21w\nb25lbnQoKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNjYW5NZXNzYWdlcyhSYW5n\nZVNjYW5SZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICBxdWV1ZXIucHVzaEFu\nZE1heWJlUnVuKHJlcXVlc3QudG9waWMsIG5ldyBSYW5nZVNjYW5PcChyZXF1\nZXN0KSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgc2Nhbk1lc3NhZ2Vz\nKFJhbmdlU2NhblJlcXVlc3QgcmVxdWVzdCwgbG9uZyBzY2FuU2VxSWQsIGlu\ndCBudW1Nc2dzUmVhZCwgbG9uZyB0b3RhbFNpemVSZWFkKSB7CiAgICAgICAg\ncXVldWVyLnB1c2hBbmRNYXliZVJ1bihyZXF1ZXN0LnRvcGljLCBuZXcgUmFu\nZ2VTY2FuT3AocmVxdWVzdCwgc2NhblNlcUlkLCBudW1Nc2dzUmVhZCwgdG90\nYWxTaXplUmVhZCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGRlbGl2ZXJl\nZFVudGlsKEJ5dGVTdHJpbmcgdG9waWMsIExvbmcgc2VxSWQpIHsKICAgICAg\nICAvLyBOb3RoaW5nIHRvIGRvIGhlcmUuIHRoaXMgaXMganVzdCBhIGhpbnQg\ndGhhdCB3ZSBjYW5ub3QgdXNlLgogICAgfQoKICAgIGNsYXNzIFVwZGF0ZUxl\nZGdlck9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hyb25vdXNPcDxW\nb2lkPiB7CiAgICAgICAgcHJpdmF0ZSBTZXQ8TG9uZz4gbGVkZ2Vyc0RlbGV0\nZWQ7CgogICAgICAgIHB1YmxpYyBVcGRhdGVMZWRnZXJPcChCeXRlU3RyaW5n\nIHRvcGljLCBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYiwgZmluYWwgT2JqZWN0\nIGN0eCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2V0PExvbmc+\nIGxlZGdlcnNEZWxldGVkKSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0\nb3BpYywgY2IsIGN0eCk7CiAgICAgICAgICAgIHRoaXMubGVkZ2Vyc0RlbGV0\nZWQgPSBsZWRnZXJzRGVsZXRlZDsKICAgICAgICB9CgogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\nZmluYWwgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5mb3MuZ2V0KHRv\ncGljKTsKICAgICAgICAgICAgaWYgKHRvcGljSW5mbyA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlNlcnZlciBpcyBub3QgcmVz\ncG9uc2libGUgZm9yIHRvcGljISIpOwogICAgICAgICAgICAgICAgY2Iub3Bl\ncmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2ZXJO\nb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9uKCIiKSk7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTGVk\nZ2VyUmFuZ2VzLkJ1aWxkZXIgYnVpbGRlciA9IExlZGdlclJhbmdlcy5uZXdC\ndWlsZGVyKCk7CiAgICAgICAgICAgIGZpbmFsIFNldDxMb25nPiBrZXlzVG9S\nZW1vdmUgPSBuZXcgSGFzaFNldDxMb25nPigpOwogICAgICAgICAgICBib29s\nZWFuIGZvdW5kVW5jb25zdW1lZExlZGdlciA9IGZhbHNlOwogICAgICAgICAg\nICBmb3IgKE1hcC5FbnRyeTxMb25nLCBJbk1lbW9yeUxlZGdlclJhbmdlPiBl\nIDogdG9waWNJbmZvLmxlZGdlclJhbmdlcy5lbnRyeVNldCgpKSB7CiAgICAg\nICAgICAgICAgICBMZWRnZXJSYW5nZSBsciA9IGUuZ2V0VmFsdWUoKS5yYW5n\nZTsKICAgICAgICAgICAgICAgIGxvbmcgbGVkZ2VySWQgPSBsci5nZXRMZWRn\nZXJJZCgpOwogICAgICAgICAgICAgICAgaWYgKCFmb3VuZFVuY29uc3VtZWRM\nZWRnZXIgJiYgbGVkZ2Vyc0RlbGV0ZWQuY29udGFpbnMobGVkZ2VySWQpKSB7\nCiAgICAgICAgICAgICAgICAgICAga2V5c1RvUmVtb3ZlLmFkZChlLmdldEtl\neSgpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxyLmhhc0VuZFNlcUlk\nSW5jbHVkZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcg\nbXNnID0gIlNob3VsZCBub3QgcmVtb3ZlIHVuY2xvc2VkIGxlZGdlciAiICsg\nbGVkZ2VySWQgKyAiIGZvciB0b3BpYyAiICsgdG9waWMudG9TdHJpbmdVdGY4\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihtc2cp\nOwogICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQo\nY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlVuZXhwZWN0ZWRDb25kaXRpb25F\neGNlcHRpb24obXNnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgIGZvdW5kVW5jb25zdW1lZExlZGdl\nciA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgYnVpbGRlci5hZGRSYW5n\nZXMobHIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGJ1aWxkZXIuYWRkUmFuZ2VzKHRvcGljSW5mby5jdXJyZW50TGVk\nZ2VyUmFuZ2UucmFuZ2UpOwoKICAgICAgICAgICAgaWYgKCFrZXlzVG9SZW1v\ndmUuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICBmaW5hbCBMZWRnZXJS\nYW5nZXMgbmV3UmFuZ2VzID0gYnVpbGRlci5idWlsZCgpOwogICAgICAgICAg\nICAgICAgdHBNYW5hZ2VyLndyaXRlVG9waWNQZXJzaXN0ZW5jZUluZm8oCiAg\nICAgICAgICAgICAgICB0b3BpYywgbmV3UmFuZ2VzLCB0b3BpY0luZm8ubGVk\nZ2VyUmFuZ2VzVmVyc2lvbiwgbmV3IENhbGxiYWNrPFZlcnNpb24+KCkgewog\nICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlz\naGVkKE9iamVjdCBjdHgsIFZlcnNpb24gbmV3VmVyc2lvbikgewogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBGaW5hbGx5LCBhbGwgZG9uZQogICAgICAg\nICAgICAgICAgICAgICAgICBmb3IgKExvbmcgayA6IGtleXNUb1JlbW92ZSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLmxlZGdl\nclJhbmdlcy5yZW1vdmUoayk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLmxlZGdlclJhbmdl\nc1ZlcnNpb24gPSBuZXdWZXJzaW9uOwogICAgICAgICAgICAgICAgICAgICAg\nICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBv\ncGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4\nY2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRp\nb25GYWlsZWQoY3R4LCBleGNlcHRpb24pOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgs\nIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIGNs\nYXNzIENvbnN1bWVVbnRpbE9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5TeW5j\naHJvbm91c09wIHsKICAgICAgICBwcml2YXRlIGZpbmFsIGxvbmcgc2VxSWQ7\nCgogICAgICAgIHB1YmxpYyBDb25zdW1lVW50aWxPcChCeXRlU3RyaW5nIHRv\ncGljLCBsb25nIHNlcUlkKSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0\nb3BpYyk7CiAgICAgICAgICAgIHRoaXMuc2VxSWQgPSBzZXFJZDsKICAgICAg\nICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1\nbkludGVybmFsKCkgewogICAgICAgICAgICBUb3BpY0luZm8gdG9waWNJbmZv\nID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwogICAgICAgICAgICBpZiAodG9w\naWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJv\ncigiU2VydmVyIGlzIG5vdCByZXNwb25zaWJsZSBmb3IgdG9waWMhIik7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGZpbmFsIExpbmtlZExpc3Q8TG9uZz4gbGVkZ2Vyc1RvRGVsZXRlID0g\nbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsKICAgICAgICAgICAgZm9yIChMb25n\nIGVuZFNlcUlkSW5jbHVkZWQgOiB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmtl\neVNldCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoZW5kU2VxSWRJbmNsdWRl\nZCA8PSBzZXFJZCkgewogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgbGVk\nZ2VyJ3MgbWVzc2FnZSBlbnRyaWVzIGhhdmUgYWxsIGJlZW4gY29uc3VtZWQg\nYWxyZWFkeQogICAgICAgICAgICAgICAgICAgIC8vIHNvIGl0IGlzIHNhZmUg\ndG8gZGVsZXRlIGl0IGZyb20gQm9va0tlZXBlci4KICAgICAgICAgICAgICAg\nICAgICBsb25nIGxlZGdlcklkID0gdG9waWNJbmZvLmxlZGdlclJhbmdlcy5n\nZXQoZW5kU2VxSWRJbmNsdWRlZCkucmFuZ2UuZ2V0TGVkZ2VySWQoKTsKICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJzVG9EZWxldGUuYWRkKGxlZGdlcklk\nKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIC8vIG5vIGxlZGdlcnMgbmVlZCB0byBkZWxldGUKICAgICAg\nICAgICAgaWYgKGxlZGdlcnNUb0RlbGV0ZS5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nU2V0PExvbmc+IGxlZGdlcnNEZWxldGVkID0gbmV3IEhhc2hTZXQ8TG9uZz4o\nKTsKICAgICAgICAgICAgZGVsZXRlTGVkZ2Vyc0FuZFVwZGF0ZUxlZGdlcnNS\nYW5nZSh0b3BpYywgbGVkZ2Vyc1RvRGVsZXRlLCBsZWRnZXJzRGVsZXRlZCk7\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBkZWxldGVMZWRn\nZXJzQW5kVXBkYXRlTGVkZ2Vyc1JhbmdlKGZpbmFsIEJ5dGVTdHJpbmcgdG9w\naWMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmaW5hbCBMaW5rZWRMaXN0PExvbmc+IGxlZGdlcnNUb0Rl\nbGV0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZpbmFsIFNldDxMb25nPiBsZWRnZXJzRGVsZXRlZCkg\newogICAgICAgIGlmIChsZWRnZXJzVG9EZWxldGUuaXNFbXB0eSgpKSB7CiAg\nICAgICAgICAgIENhbGxiYWNrPFZvaWQ+IGNiID0gbmV3IENhbGxiYWNrPFZv\naWQ+KCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9u\nRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCByZXN1bHQpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBkbyBub3RoaW5nLCBvcCBpcyBhc3luYyB0byBzdG9w\nIG90aGVyIG9wcwogICAgICAgICAgICAgICAgICAgIC8vIG9jY3VycmluZyBv\nbiB0aGUgdG9waWMgZHVyaW5nIHRoZSB1cGRhdGUKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxl\nZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAg\nICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gdXBk\nYXRlIGxlZGdlciB6bm9kZSBmb3IgdG9waWMge30gZGVsZXRpbmcgbGVkZ2Vy\ncyB7fSA6IHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndmEodG9waWMudG9TdHJpbmdVdGY4KCksIGxlZGdlcnNEZWxldGVkLCBleGNl\ncHRpb24uZ2V0TWVzc2FnZSgpKSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH07CiAgICAgICAgICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4o\ndG9waWMsIG5ldyBVcGRhdGVMZWRnZXJPcCh0b3BpYywgY2IsIG51bGwsIGxl\nZGdlcnNEZWxldGVkKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIGZpbmFsIExvbmcgbGVkZ2VyID0gbGVkZ2Vyc1RvRGVsZXRl\nLnBvbGwoKTsKICAgICAgICBpZiAobnVsbCA9PSBsZWRnZXIpIHsKICAgICAg\nICAgICAgZGVsZXRlTGVkZ2Vyc0FuZFVwZGF0ZUxlZGdlcnNSYW5nZSh0b3Bp\nYywgbGVkZ2Vyc1RvRGVsZXRlLCBsZWRnZXJzRGVsZXRlZCk7CiAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGJrLmFzeW5jRGVsZXRl\nTGVkZ2VyKGxlZGdlciwgbmV3IERlbGV0ZUNhbGxiYWNrKCkgewogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgZGVsZXRl\nQ29tcGxldGUoaW50IHJjLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAg\nICBpZiAoQktFeGNlcHRpb24uQ29kZS5Ob1N1Y2hMZWRnZXJFeGlzdHNFeGNl\ncHRpb24gPT0gcmMgfHwKICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlv\nbi5Db2RlLk9LID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgbGVkZ2Vy\nc0RlbGV0ZWQuYWRkKGxlZGdlcik7CiAgICAgICAgICAgICAgICAgICAgZGVs\nZXRlTGVkZ2Vyc0FuZFVwZGF0ZUxlZGdlcnNSYW5nZSh0b3BpYywgbGVkZ2Vy\nc1RvRGVsZXRlLCBsZWRnZXJzRGVsZXRlZCk7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIud2FybigiRXhjZXB0aW9uIHdoaWxlIGRlbGV0\naW5nIGNvbnN1bWVkIGxlZGdlciB7fSwgc3RvcCBkZWxldGluZyBvdGhlciBs\nZWRnZXJzIHt9ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nICJhbmQgdXBkYXRlIGxlZGdlciByYW5nZXMgd2l0aCBkZWxldGVkIGxlZGdl\ncnMge30gOiB7fSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndmEobGVkZ2VyLCBsZWRnZXJzVG9EZWxldGUsIGxlZGdlcnNEZWxldGVkLCBC\nS0V4Y2VwdGlvbi5jcmVhdGUocmMpKSk7CiAgICAgICAgICAgICAgICAgICAg\nLy8gV2Ugc2hvdWxkIG5vdCBjb250aW51ZSB3aGVuIGZhaWxlZCB0byBkZWxl\ndGUgbGVkZ2VyCiAgICAgICAgICAgICAgICAgICAgQ2FsbGJhY2s8Vm9pZD4g\nY2IgPSBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBj\ndHgsIFZvaWQgcmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyBkbyBub3RoaW5nLCBvcCBpcyBhc3luYyB0byBzdG9wIG90aGVyIG9w\ncwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb2NjdXJyaW5nIG9u\nIHRoZSB0b3BpYyBkdXJpbmcgdGhlIHVwZGF0ZQogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24g\nZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZXJyb3IoIkZhaWxlZCB0byB1cGRhdGUgbGVkZ2VyIHpub2RlIGZvciB0\nb3BpYyB7fSBkZWxldGluZyBsZWRnZXJzIHt9IDoge30iLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhKHRvcGljLCBsZWRn\nZXJzRGVsZXRlZCwgZXhjZXB0aW9uLmdldE1lc3NhZ2UoKSkpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAg\nICAgICAgICAgICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGlj\nLCBuZXcgVXBkYXRlTGVkZ2VyT3AodG9waWMsIGNiLCBudWxsLCBsZWRnZXJz\nRGVsZXRlZCkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0sIG51bGwpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbnN1bWVkVW50aWwoQnl0ZVN0cmlu\nZyB0b3BpYywgTG9uZyBzZXFJZCkgewogICAgICAgIHF1ZXVlci5wdXNoQW5k\nTWF5YmVSdW4odG9waWMsIG5ldyBDb25zdW1lVW50aWxPcCh0b3BpYywgTWF0\naC5tYXgoc2VxSWQsIGdldE1pblNlcUlkRm9yVG9waWModG9waWMpKSkpOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIGNvbnN1bWVUb0JvdW5kKEJ5dGVTdHJp\nbmcgdG9waWMpIHsKICAgICAgICBUb3BpY0luZm8gdG9waWNJbmZvID0gdG9w\naWNJbmZvcy5nZXQodG9waWMpOwoKICAgICAgICBpZiAodG9waWNJbmZvID09\nIG51bGwgfHwgdG9waWNJbmZvLm1lc3NhZ2VCb3VuZCA9PSB0b3BpY0luZm8u\nVU5MSU1JVEVEKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAg\nICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IENvbnN1\nbWVVbnRpbE9wKHRvcGljLCBnZXRNaW5TZXFJZEZvclRvcGljKHRvcGljKSkp\nOwogICAgfQoKICAgIHB1YmxpYyBsb25nIGdldE1pblNlcUlkRm9yVG9waWMo\nQnl0ZVN0cmluZyB0b3BpYykgewogICAgICAgIFRvcGljSW5mbyB0b3BpY0lu\nZm8gPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAgIGlmICh0b3Bp\nY0luZm8gPT0gbnVsbCB8fCB0b3BpY0luZm8ubWVzc2FnZUJvdW5kID09IHRv\ncGljSW5mby5VTkxJTUlURUQpIHsKICAgICAgICAgICAgcmV0dXJuIExvbmcu\nTUlOX1ZBTFVFOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVy\nbiAodG9waWNJbmZvLmxhc3RTZXFJZFB1c2hlZC5nZXRMb2NhbENvbXBvbmVu\ndCgpIC0gdG9waWNJbmZvLm1lc3NhZ2VCb3VuZCkgKyAxOwogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgTWVzc2FnZVNlcUlkIGdldEN1cnJlbnRTZXFJ\nZEZvclRvcGljKEJ5dGVTdHJpbmcgdG9waWMpIHRocm93cyBTZXJ2ZXJOb3RS\nZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9uIHsKICAgICAgICBUb3BpY0lu\nZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwoKICAgICAg\nICBpZiAodG9waWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgdGhyb3cg\nbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRv\ncGljRXhjZXB0aW9uKCIiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0\nb3BpY0luZm8ubGFzdFNlcUlkUHVzaGVkOwogICAgfQoKICAgIHB1YmxpYyBs\nb25nIGdldFNlcUlkQWZ0ZXJTa2lwcGluZyhCeXRlU3RyaW5nIHRvcGljLCBs\nb25nIHNlcUlkLCBpbnQgc2tpcEFtb3VudCkgewogICAgICAgIHJldHVybiBN\nYXRoLm1heChzZXFJZCArIHNraXBBbW91bnQsIGdldE1pblNlcUlkRm9yVG9w\naWModG9waWMpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbGVhc2UgdG9w\naWMgb24gZmFpbHVyZQogICAgICoKICAgICAqIEBwYXJhbSB0b3BpYwogICAg\nICogICAgICAgICAgVG9waWMgTmFtZQogICAgICogQHBhcmFtIGUKICAgICAq\nICAgICAgICAgIEZhaWx1cmUgRXhjZXB0aW9uCiAgICAgKiBAcGFyYW0gY3R4\nCiAgICAgKiAgICAgICAgICBDYWxsYmFjayBjb250ZXh0CiAgICAgKi8KICAg\nIHByb3RlY3RlZCB2b2lkIHJlbGVhc2VUb3BpY0lmUmVxdWVzdGVkKGZpbmFs\nIEJ5dGVTdHJpbmcgdG9waWMsIEV4Y2VwdGlvbiBlLCBPYmplY3QgY3R4KSB7\nCiAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5mb3MuZ2V0\nKHRvcGljKTsKICAgICAgICBpZiAodG9waWNJbmZvID09IG51bGwpIHsKICAg\nICAgICAgICAgbG9nZ2VyLndhcm4oIk5vIHRvcGljIGZvdW5kIHdoZW4gdHJ5\naW5nIHRvIHJlbGVhc2Ugb3duZXJzaGlwIG9mIHRvcGljICIgKyB0b3BpYy50\nb1N0cmluZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAgICAgKyAiIG9uIGZh\naWx1cmUuIik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAg\nICAgLy8gZG8gcmVsZWFzZSBvd25lciBzaGlwIG9mIHRvcGljCiAgICAgICAg\naWYgKHRvcGljSW5mby5kb1JlbGVhc2UuY29tcGFyZUFuZFNldChmYWxzZSwg\ndHJ1ZSkpIHsKICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlJlbGVhc2UgdG9w\naWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiB3aGVuIGJvb2trZWVw\nZXIgcGVyc2lzdGVuY2UgbWFuYW5nZXIgZW5jb3VudGVycyBmYWlsdXJlIDoi\nLAogICAgICAgICAgICAgICAgICAgICAgICBlKTsKICAgICAgICAgICAgdG0u\ncmVsZWFzZVRvcGljKHRvcGljLCBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNl\ncHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2Vy\nLmVycm9yKCJFeGNlcHRpb24gZm91bmQgb24gcmVsZWFzaW5nIHRvcGljICIg\nKyB0b3BpYy50b1N0cmluZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiIHdoZW4gZW5jb3VudGVyaW5nIGV4Y2VwdGlvbiBmcm9t\nIGJvb2trZWVwZXI6IiwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCBy\nZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIGxvZ2dl\nci5pbmZvKCJzdWNjZXNzZnVsbHkgcmVsZWFzaW5nIHRvcGljIHt9IHdoZW4g\nZW5jb3VudGVyaW5nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nICIgZXhjZXB0aW9uIGZyb20gYm9va2tlZXBlciIsIHRvcGljLnRvU3RyaW5n\nVXRmOCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbnVs\nbCk7CiAgICAgICAgfQogICAgICAgIC8vIGlmIHJlbGVhc2UgaGFwcGVucyB3\naGVuIHRoZSB0b3BpYyBpcyBjaGFuZ2luZyBsZWRnZXIKICAgICAgICAvLyB3\nZSBuZWVkIHRvIGZhaWwgYWxsIHF1ZXVlZCBwZXJzaXN0IHJlcXVlc3RzCiAg\nICAgICAgaWYgKHRvcGljSW5mby5kb0NoYW5nZUxlZGdlci5nZXQoKSkgewog\nICAgICAgICAgICBmb3IgKFBlcnNpc3RSZXF1ZXN0IHByIDogdG9waWNJbmZv\nLmRlZmVycmVkUmVxdWVzdHMpIHsKICAgICAgICAgICAgICAgIHByLmdldENh\nbGxiYWNrKCkub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2Vw\ndGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdG9waWNJbmZvLmRlZmVycmVkUmVxdWVzdHMuY2xlYXIo\nKTsKICAgICAgICAgICAgdG9waWNJbmZvLmxhc3RTZXFJZEJlZm9yZUxlZGdl\nckNoYW5nZSA9IC0xOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgY2xh\nc3MgUGVyc2lzdE9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5TeW5jaHJvbm91\nc09wIHsKICAgICAgICBQZXJzaXN0UmVxdWVzdCByZXF1ZXN0OwoKICAgICAg\nICBwdWJsaWMgUGVyc2lzdE9wKFBlcnNpc3RSZXF1ZXN0IHJlcXVlc3QpIHsK\nICAgICAgICAgICAgcXVldWVyLnN1cGVyKHJlcXVlc3QudG9waWMpOwogICAg\nICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0OwogICAgICAgIH0KCiAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuSW50ZXJu\nYWwoKSB7CiAgICAgICAgICAgIGRvUGVyc2lzdE1lc3NhZ2UocmVxdWVzdCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdCBhIG1l\nc3NhZ2UgYnkgZXhlY3V0aW5nIGEgcGVyc2lzdCByZXF1ZXN0LgogICAgICov\nCiAgICBwcm90ZWN0ZWQgdm9pZCBkb1BlcnNpc3RNZXNzYWdlKGZpbmFsIFBl\ncnNpc3RSZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICBmaW5hbCBCeXRlU3Ry\naW5nIHRvcGljID0gcmVxdWVzdC50b3BpYzsKICAgICAgICBmaW5hbCBUb3Bp\nY0luZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwoKICAg\nICAgICBpZiAodG9waWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgcmVx\ndWVzdC5nZXRDYWxsYmFjaygpLm9wZXJhdGlvbkZhaWxlZChyZXF1ZXN0LmN0\neCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZv\nclRvcGljRXhjZXB0aW9uKCIiKSk7CiAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICB9CgogICAgICAgIGlmICh0b3BpY0luZm8uZG9SZWxlYXNlLmdldCgp\nKSB7CiAgICAgICAgICAgIHJlcXVlc3QuZ2V0Q2FsbGJhY2soKS5vcGVyYXRp\nb25GYWlsZWQocmVxdWVzdC5jdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2Vy\ndmljZURvd25FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAiVGhlIG93bmVy\nc2hpcCBvZiB0aGUgdG9waWMgaXMgcmVsZWFzaW5nIGR1ZSB0byB1bnJlY292\nZXJhYmxlIGlzc3VlLiIpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KCiAgICAgICAgLy8gaWYgdGhlIHRvcGljIGlzIGNoYW5naW5nIGxlZGdl\nciwgcXVldWUgZm9sbG93aW5nIHBlcnNpc3QgcmVxdWVzdHMgdW50aWwgbGVk\nZ2VyIGlzIGNoYW5nZWQKICAgICAgICBpZiAodG9waWNJbmZvLmRvQ2hhbmdl\nTGVkZ2VyLmdldCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJUb3Bp\nYyB7fSBpcyBjaGFuZ2luZyBsZWRnZXIsIHNvIHF1ZXVlIHBlcnNpc3QgcmVx\ndWVzdCBmb3IgbWVzc2FnZS4iLAogICAgICAgICAgICAgICAgICAgICAgICB0\nb3BpYy50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgIHRvcGljSW5mby5k\nZWZlcnJlZFJlcXVlc3RzLmFkZChyZXF1ZXN0KTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgZmluYWwgbG9uZyBsb2NhbFNlcUlk\nID0gdG9waWNJbmZvLmxhc3RTZXFJZFB1c2hlZC5nZXRMb2NhbENvbXBvbmVu\ndCgpICsgMTsKICAgICAgICBNZXNzYWdlU2VxSWQuQnVpbGRlciBidWlsZGVy\nID0gTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIoKTsKICAgICAgICBpZiAocmVx\ndWVzdC5tZXNzYWdlLmhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgTWVzc2Fn\nZUlkVXRpbHMudGFrZVJlZ2lvbk1heGltdW0oYnVpbGRlciwgdG9waWNJbmZv\nLmxhc3RTZXFJZFB1c2hlZCwgcmVxdWVzdC5tZXNzYWdlLmdldE1zZ0lkKCkp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGJ1aWxkZXIuYWRkQWxs\nUmVtb3RlQ29tcG9uZW50cyh0b3BpY0luZm8ubGFzdFNlcUlkUHVzaGVkLmdl\ndFJlbW90ZUNvbXBvbmVudHNMaXN0KCkpOwogICAgICAgIH0KICAgICAgICBi\ndWlsZGVyLnNldExvY2FsQ29tcG9uZW50KGxvY2FsU2VxSWQpOwoKICAgICAg\nICAvLyBjaGVjayB3aGV0aGVyIHJlYWNoIHRoZSB0aHJlc2hvbGQgb2YgYSBs\nZWRnZXIsIGlmIGl0IGRvZXMsCiAgICAgICAgLy8gb3BlbiBhIGxlZGdlciB0\nbyB3cml0ZQogICAgICAgIGxvbmcgZW50cmllc0luVGhpc0xlZGdlciA9IGxv\nY2FsU2VxSWQgLSB0b3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlLmdldFN0\nYXJ0U2VxSWRJbmNsdWRlZCgpICsgMTsKICAgICAgICBpZiAoVU5MSU1JVEVE\nX0VOVFJJRVMgIT0gbWF4RW50cmllc1BlckxlZGdlciAmJgogICAgICAgICAg\nICBlbnRyaWVzSW5UaGlzTGVkZ2VyID49IG1heEVudHJpZXNQZXJMZWRnZXIp\nIHsKICAgICAgICAgICAgaWYgKHRvcGljSW5mby5kb0NoYW5nZUxlZGdlci5j\nb21wYXJlQW5kU2V0KGZhbHNlLCB0cnVlKSkgewogICAgICAgICAgICAgICAg\nLy8gZm9yIG9yZGVyIGd1YXJhbnRlZXMsIHdlIHNob3VsZCB3YWl0IHVudGls\nIGFsbCB0aGUgYWRkaW5nIG9wZXJhdGlvbnMgZm9yIGN1cnJlbnQgbGVkZ2Vy\nCiAgICAgICAgICAgICAgICAvLyBhcmUgc3VjY2VlZC4gc28gd2UganVzdCBt\nYXJrIGl0IGFzIGxhc3RTZXFJZEJlZm9yZUxlZGdlckNoYW5nZQogICAgICAg\nICAgICAgICAgLy8gd2hlbiB0aGUgbGFzdFNlcUlkQmVmb3JlTGVkZ2VyQ2hh\nbmdlIGFja2VkLCB3ZSBkbyBjaGFuZ2luZyB0aGUgbGVkZ2VyCiAgICAgICAg\nICAgICAgICBpZiAobnVsbCA9PSB0b3BpY0luZm8uZGVmZXJyZWRSZXF1ZXN0\ncykgewogICAgICAgICAgICAgICAgICAgIHRvcGljSW5mby5kZWZlcnJlZFJl\ncXVlc3RzID0gbmV3IExpbmtlZExpc3Q8UGVyc2lzdFJlcXVlc3Q+KCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0b3BpY0luZm8ubGFz\ndFNlcUlkQmVmb3JlTGVkZ2VyQ2hhbmdlID0gbG9jYWxTZXFJZDsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdG9waWNJbmZvLmxhc3RTZXFJ\nZFB1c2hlZCA9IGJ1aWxkZXIuYnVpbGQoKTsKICAgICAgICBNZXNzYWdlIG1z\nZ1RvU2VyaWFsaXplID0gTWVzc2FnZS5uZXdCdWlsZGVyKHJlcXVlc3QubWVz\nc2FnZSkuc2V0TXNnSWQodG9waWNJbmZvLmxhc3RTZXFJZFB1c2hlZCkuYnVp\nbGQoKTsKCiAgICAgICAgZmluYWwgTWVzc2FnZVNlcUlkIHJlc3BvbnNlU2Vx\nSWQgPSBtc2dUb1NlcmlhbGl6ZS5nZXRNc2dJZCgpOwogICAgICAgIHRvcGlj\nSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuaGFuZGxlLmFzeW5jQWRkRW50cnko\nbXNnVG9TZXJpYWxpemUudG9CeXRlQXJyYXkoKSwKICAgICAgICBuZXcgU2Fm\nZUFzeW5CS0NhbGxiYWNrLkFkZENhbGxiYWNrKCkgewogICAgICAgICAgICBB\ndG9taWNCb29sZWFuIHByb2Nlc3NlZCA9IG5ldyBBdG9taWNCb29sZWFuKGZh\nbHNlKTsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHNhZmVBZGRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBs\naCwgbG9uZyBlbnRyeUlkLCBPYmplY3QgY3R4KSB7CgogICAgICAgICAgICAg\nICAgLy8gYXZvaWQgZG91YmxlIGNhbGxiYWNrIGJ5IG1pc3Rha2UsIHNpbmNl\nIHdlIG1heSBkbyBjaGFuZ2UgbGVkZ2VyIGluIHRoaXMgY2FsbGJhY2suCiAg\nICAgICAgICAgICAgICBpZiAoIXByb2Nlc3NlZC5jb21wYXJlQW5kU2V0KGZh\nbHNlLCB0cnVlKSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4\nY2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgQktFeGNl\ncHRpb24gYmtlID0gQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIHBlcnNpc3Rp\nbmcgZW50cnkgdG8gbGVkZ2VyOiAiICsgbGguZ2V0SWQoKSArICIgZm9yIHRv\ncGljOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdG9w\naWMudG9TdHJpbmdVdGY4KCksIGJrZSk7CiAgICAgICAgICAgICAgICAgICAg\ncmVxdWVzdC5nZXRDYWxsYmFjaygpLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5l\ndyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7\nCgogICAgICAgICAgICAgICAgICAgIC8vIFRvIHByZXNlcnZlIG9yZGVyaW5n\nIGd1YXJhbnRlZXMsIHdlCiAgICAgICAgICAgICAgICAgICAgLy8gc2hvdWxk\nIGdpdmUgdXAgdGhlIHRvcGljIGFuZCBub3QgbGV0CiAgICAgICAgICAgICAg\nICAgICAgLy8gb3RoZXIgb3BlcmF0aW9ucyB0aHJvdWdoCiAgICAgICAgICAg\nICAgICAgICAgcmVsZWFzZVRvcGljSWZSZXF1ZXN0ZWQocmVxdWVzdC50b3Bp\nYywgYmtlLCBjdHgpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZW50cnlJZCAr\nIHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuZ2V0U3RhcnRTZXFJZElu\nY2x1ZGVkKCkgIT0gbG9jYWxTZXFJZCkgewogICAgICAgICAgICAgICAgICAg\nIFN0cmluZyBtc2cgPSAiRXhwZWN0ZWQgQksgdG8gYXNzaWduIGVudHJ5LWlk\nOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgKGxvY2Fs\nU2VxSWQgLSB0b3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlLmdldFN0YXJ0\nU2VxSWRJbmNsdWRlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArICIgYnV0IGl0IGluc3RlYWQgYXNzaWduZWQgZW50cnktaWQ6ICIg\nKyBlbnRyeUlkICsgIiB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgImxlZGdlcjog\nIiArIGxoLmdldElkKCk7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVy\ncm9yKG1zZyk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuZXhw\nZWN0ZWRFcnJvcihtc2cpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIHRvcGljSW5mby5sYXN0RW50cnlJZEFja2VkSW5DdXJyZW50TGVk\nZ2VyID0gZW50cnlJZDsKICAgICAgICAgICAgICAgIHJlcXVlc3QuZ2V0Q2Fs\nbGJhY2soKS5vcGVyYXRpb25GaW5pc2hlZChjdHgsIHJlc3BvbnNlU2VxSWQp\nOwogICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBhY2tlZCBlbnRyeSBpcyB0\naGUgbGFzdCBlbnRyeSBvZiBjdXJyZW50IGxlZGdlcgogICAgICAgICAgICAg\nICAgLy8gd2UgY2FuIGFkZCBhIENoYW5nZUxlZGdlck9wIHRvIGV4ZWN1dGUg\ndG8gY2hhbmdlIGxlZGdlcgogICAgICAgICAgICAgICAgaWYgKHRvcGljSW5m\nby5kb0NoYW5nZUxlZGdlci5nZXQoKSAmJgogICAgICAgICAgICAgICAgICAg\nIGVudHJ5SWQgKyB0b3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlLmdldFN0\nYXJ0U2VxSWRJbmNsdWRlZCgpID09IHRvcGljSW5mby5sYXN0U2VxSWRCZWZv\ncmVMZWRnZXJDaGFuZ2UpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjaGFu\nZ2UgbGVkZ2VyCiAgICAgICAgICAgICAgICAgICAgY2hhbmdlTGVkZ2VyKHRv\ncGljLCBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhj\nZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gY2hhbmdlIGxlZGdlciBmb3Ig\ndG9waWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBleGNlcHRpb24pOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hhbmdlIGxlZGdlciBm\nYWlsZWQsIHdlIHNob3VsZCBnaXZlIHVwIHRvcGljCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZWxlYXNlVG9waWNJZlJlcXVlc3RlZChyZXF1ZXN0\nLnRvcGljLCBleGNlcHRpb24sIGN0eCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlz\naGVkKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGljSW5mby5kb0NoYW5nZUxl\nZGdlci5zZXQoZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndG9waWNJbmZvLmxhc3RTZXFJZEJlZm9yZUxlZGdlckNoYW5nZSA9IC0xOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGxlZGdlciBpcyBj\naGFuZ2VkLCBwZXJzaXN0IHF1ZXVlZCByZXF1ZXN0cwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgLy8gaWYgdGhlIG51bWJlciBvZiBxdWV1ZWQgcGVy\nc2lzdCByZXF1ZXN0cyBpcyBtb3JlIHRoYW4gbWF4RW50cmllc1BlckxlZGdl\ncgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UganVzdCBwZXJz\naXN0IG1heEVudHJpZXNQZXJMZWRnZXIgcmVxdWVzdHMsIG90aGVyIHJlcXVl\nc3RzIGFyZSBzdGlsbCBxdWV1ZWQKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHVudGlsIG5leHQgbGVkZ2VyIGNoYW5nZWQuCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpbnQgbnVtUmVxdWVzdHMgPSAwOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgd2hpbGUgKCF0b3BpY0luZm8uZGVmZXJy\nZWRSZXF1ZXN0cy5pc0VtcHR5KCkgJiYKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBudW1SZXF1ZXN0cyA8IG1heEVudHJpZXNQZXJMZWRn\nZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQZXJzaXN0\nUmVxdWVzdCBwciA9IHRvcGljSW5mby5kZWZlcnJlZFJlcXVlc3RzLnJlbW92\nZUZpcnN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9Q\nZXJzaXN0TWVzc2FnZShwcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKytudW1SZXF1ZXN0czsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1\nZygiRmluaXNoZWQgcGVyc2lzdGluZyB7fSBxdWV1ZWQgcmVxdWVzdHMsIGJ1\ndCB0aGVyZSBhcmUgc3RpbGwge30gcmVxdWVzdHMgaW4gcXVldWUuIiwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1SZXF1\nZXN0cywgdG9waWNJbmZvLmRlZmVycmVkUmVxdWVzdHMuc2l6ZSgpKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0s\nIGN0eCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9LCByZXF1ZXN0LmN0eCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcGVy\nc2lzdE1lc3NhZ2UoUGVyc2lzdFJlcXVlc3QgcmVxdWVzdCkgewogICAgICAg\nIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4ocmVxdWVzdC50b3BpYywgbmV3IFBl\ncnNpc3RPcChyZXF1ZXN0KSk7CiAgICB9CgogICAgcHVibGljIHZvaWQgc2Nh\nblNpbmdsZU1lc3NhZ2UoU2NhblJlcXVlc3QgcmVxdWVzdCkgewogICAgICAg\nIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJOb3QgaW1wbGVtZW50ZWQi\nKTsKICAgIH0KCiAgICBzdGF0aWMgU2FmZUFzeW5CS0NhbGxiYWNrLkNsb3Nl\nQ2FsbGJhY2sgbm9PcENsb3NlQ2FsbGJhY2sgPSBuZXcgU2FmZUFzeW5CS0Nh\nbGxiYWNrLkNsb3NlQ2FsbGJhY2soKSB7CiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgc2FmZUNsb3NlQ29tcGxldGUoaW50IHJjLCBM\nZWRnZXJIYW5kbGUgbGVkZ2VySGFuZGxlLCBPYmplY3QgY3R4KSB7CiAgICAg\nICAgfTsKICAgIH07CgogICAgY2xhc3MgQWNxdWlyZU9wIGV4dGVuZHMgVG9w\naWNPcFF1ZXVlci5Bc3luY2hyb25vdXNPcDxWb2lkPiB7CiAgICAgICAgcHVi\nbGljIEFjcXVpcmVPcChCeXRlU3RyaW5nIHRvcGljLCBDYWxsYmFjazxWb2lk\nPiBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBxdWV1ZXIuc3VwZXIo\ndG9waWMsIGNiLCBjdHgpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICBpZiAo\ndG9waWNJbmZvcy5jb250YWluc0tleSh0b3BpYykpIHsKICAgICAgICAgICAg\nICAgIC8vIEFscmVhZHkgYWNxdWlyZWQsIGRvIG5vdGhpbmcKICAgICAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIC8vIHJlYWQgcGVyc2lzdGVuY2UgaW5mbwogICAgICAgICAgICB0cE1hbmFn\nZXIucmVhZFRvcGljUGVyc2lzdGVuY2VJbmZvKHRvcGljLCBuZXcgQ2FsbGJh\nY2s8VmVyc2lvbmVkPExlZGdlclJhbmdlcz4+KCkgewogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWZXJzaW9uZWQ8TGVkZ2VyUmFu\nZ2VzPiByYW5nZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAh\nPSByYW5nZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1Rv\ncGljTGVkZ2VyUmFuZ2VzKHJhbmdlcy5nZXRWYWx1ZSgpLCByYW5nZXMuZ2V0\nVmVyc2lvbigpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9waWNMZWRnZXJSYW5nZXMo\nTGVkZ2VyUmFuZ2VzLmdldERlZmF1bHRJbnN0YW5jZSgpLCBWZXJzaW9uLk5F\nVyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhj\nZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgIGNiLm9w\nZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgfQoKICAgICAgICB2\nb2lkIHByb2Nlc3NUb3BpY0xlZGdlclJhbmdlcyhmaW5hbCBMZWRnZXJSYW5n\nZXMgcmFuZ2VzLCBmaW5hbCBWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICAg\nICAgZmluYWwgTGlzdDxMZWRnZXJSYW5nZT4gcmFuZ2VzTGlzdCA9IHJhbmdl\ncy5nZXRSYW5nZXNMaXN0KCk7CiAgICAgICAgICAgIGlmICghcmFuZ2VzTGlz\ndC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIExlZGdlclJhbmdlIHJh\nbmdlID0gcmFuZ2VzTGlzdC5nZXQoMCk7CiAgICAgICAgICAgICAgICBpZiAo\ncmFuZ2UuaGFzU3RhcnRTZXFJZEluY2x1ZGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICAvLyB3ZSBhbHJlYWR5IGhhdmUgc3RhcnQgc2VxIGlkCiAgICAg\nICAgICAgICAgICAgICAgcHJvY2Vzc1RvcGljTGVkZ2VyUmFuZ2VzKHJhbmdl\nc0xpc3QsIHZlcnNpb24sIHJhbmdlLmdldFN0YXJ0U2VxSWRJbmNsdWRlZCgp\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBnZXRTdGFydFNlcUlkVG9Qcm9jZXNzVG9w\naWNMZWRnZXJSYW5nZXMocmFuZ2VzTGlzdCwgdmVyc2lvbik7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8g\ncHJvY2VzcyB0b3BpYyBsZWRnZXIgcmFuZ2VzIGRpcmVjdGx5CiAgICAgICAg\nICAgIHByb2Nlc3NUb3BpY0xlZGdlclJhbmdlcyhyYW5nZXNMaXN0LCB2ZXJz\naW9uLCBTVEFSVF9TRVFfSUQpOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAg\nICAgICAgICogUHJvY2VzcyBvbGQgdmVyc2lvbiBsZWRnZXIgcmFuZ2VzIHRv\nIGZldGNoIHN0YXJ0IHNlcSBpZC4KICAgICAgICAgKi8KICAgICAgICB2b2lk\nIGdldFN0YXJ0U2VxSWRUb1Byb2Nlc3NUb3BpY0xlZGdlclJhbmdlcygKICAg\nICAgICAgICAgZmluYWwgTGlzdDxMZWRnZXJSYW5nZT4gcmFuZ2VzTGlzdCwg\nZmluYWwgVmVyc2lvbiB2ZXJzaW9uKSB7CgogICAgICAgICAgICBmaW5hbCBM\nZWRnZXJSYW5nZSByYW5nZSA9IHJhbmdlc0xpc3QuZ2V0KDApOwoKICAgICAg\nICAgICAgaWYgKCFyYW5nZS5oYXNFbmRTZXFJZEluY2x1ZGVkKCkpIHsKICAg\nICAgICAgICAgICAgIC8vIHByb2Nlc3MgdG9waWMgbGVkZ2VyIHJhbmdlcyBk\naXJlY3RseQogICAgICAgICAgICAgICAgcHJvY2Vzc1RvcGljTGVkZ2VyUmFu\nZ2VzKHJhbmdlc0xpc3QsIHZlcnNpb24sIFNUQVJUX1NFUV9JRCk7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIGZpbmFsIGxvbmcgbGVkZ2VySWQgPSByYW5nZS5nZXRMZWRnZXJJZCgpOwog\nICAgICAgICAgICAvLyBvcGVuIHRoZSBmaXJzdCBsZWRnZXIgdG8gY29tcHV0\nZSByaWdodCBzdGFydCBzZXEgaWQKICAgICAgICAgICAgYmsuYXN5bmNPcGVu\nTGVkZ2VyKGxlZGdlcklkLCBEaWdlc3RUeXBlLkNSQzMyLCBwYXNzd2QsCiAg\nICAgICAgICAgIG5ldyBTYWZlQXN5bkJLQ2FsbGJhY2suT3BlbkNhbGxiYWNr\nKCkgewoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgc2FmZU9wZW5Db21wbGV0ZShpbnQgcmMsIExlZGdl\nckhhbmRsZSBsZWRnZXJIYW5kbGUsIE9iamVjdCBjdHgpIHsKCiAgICAgICAg\nICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNo\nTGVkZ2VyRXhpc3RzRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIHByb2Nlc3MgbmV4dCBsZWRnZXIgCiAgICAgICAgICAgICAgICAg\nICAgICAgIHByb2Nlc3NUb3BpY0xlZGdlclJhbmdlcyhyYW5nZXNMaXN0LCB2\nZXJzaW9uLCBTVEFSVF9TRVFfSUQpOwogICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYyAh\nPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIEJLRXhjZXB0aW9uIGJrZSA9IEJLRXhjZXB0aW9uLmNyZWF0ZShyYyk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ291bGQg\nbm90IG9wZW4gbGVkZ2VyIHt9IHRvIGdldCBzdGFydCBzZXEgaWQgd2hpbGUg\nYWNxdWlyaW5nIHRvcGljIHt9IDoge30iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgdmEobGVkZ2VySWQsIHRvcGljLnRvU3RyaW5n\nVXRmOCgpLCBia2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3Bl\ncmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNl\nRG93bkV4Y2VwdGlvbihia2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAgICAgZmluYWwgbG9uZyBudW1FbnRyaWVzSW5MYXN0TGVkZ2VyID0gbGVk\nZ2VySGFuZGxlLmdldExhc3RBZGRDb25maXJtZWQoKSArIDE7CgogICAgICAg\nICAgICAgICAgICAgIC8vIHRoZSBsZWRnZXIgaXMgY2xvc2VkIGJlZm9yZSwg\nY2FsbGluZyBjbG9zZSBpcyBqdXN0IGEgbm9wIG9wZXJhdGlvbi4KICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBs\nZWRnZXJIYW5kbGUuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICAvLyB0aGUgZXhjZXB0aW9uIHdvdWxkIG5ldmVyIGJlIHRo\ncm93biBmb3IgYSByZWFkIG9ubHkgbGVkZ2VyIGhhbmRsZS4KICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gdGhlIGV4Y2VwdGlvbiB3b3VsZCBuZXZl\nciBiZSB0aHJvd24gZm9yIGEgcmVhZCBvbmx5IGxlZGdlciBoYW5kbGUuCiAg\nICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBpZiAo\nbnVtRW50cmllc0luTGFzdExlZGdlciA8PSAwKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIFN0cmluZyBtc2cgPSAiTm8gZW50cmllcyBmb3VuZCBpbiBh\nIGhhdmUtZW5kLXNlcS1pZCBsZWRnZXIgIiArIGxlZGdlcklkCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgd2hlbiBhY3F1aXJp\nbmcgdG9waWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIi4iOwogICAg\nICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IobXNnKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3\nIFB1YlN1YkV4Y2VwdGlvbi5VbmV4cGVjdGVkQ29uZGl0aW9uRXhjZXB0aW9u\nKG1zZykpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxvbmcgZW5k\nT2ZMZWRnZXIgPSByYW5nZS5nZXRFbmRTZXFJZEluY2x1ZGVkKCkuZ2V0TG9j\nYWxDb21wb25lbnQoKTsKICAgICAgICAgICAgICAgICAgICBsb25nIHN0YXJ0\nT2ZMZWRnZXIgPSBlbmRPZkxlZGdlciAtIG51bUVudHJpZXNJbkxhc3RMZWRn\nZXIgKyAxOwoKICAgICAgICAgICAgICAgICAgICBwcm9jZXNzVG9waWNMZWRn\nZXJSYW5nZXMocmFuZ2VzTGlzdCwgdmVyc2lvbiwgc3RhcnRPZkxlZGdlcik7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LCBjdHgpOwogICAg\nICAgIH0KCiAgICAgICAgdm9pZCBwcm9jZXNzVG9waWNMZWRnZXJSYW5nZXMo\nZmluYWwgTGlzdDxMZWRnZXJSYW5nZT4gcmFuZ2VzTGlzdCwgZmluYWwgVmVy\nc2lvbiB2ZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxvbmcgc3RhcnRPZkxlZGdlcikgewogICAgICAgICAgICBsb2dn\nZXIuaW5mbygiUHJvY2VzcyB7fSBsZWRnZXJzIGZvciB0b3BpYyB7fSBzdGFy\ndGluZyBmcm9tIHNlcSBpZCB7fS4iLAogICAgICAgICAgICAgICAgICAgICAg\nICB2YShyYW5nZXNMaXN0LnNpemUoKSwgdG9waWMudG9TdHJpbmdVdGY4KCks\nIHN0YXJ0T2ZMZWRnZXIpKTsKCiAgICAgICAgICAgIEl0ZXJhdG9yPExlZGdl\nclJhbmdlPiBsckl0ZXJhdG9yID0gcmFuZ2VzTGlzdC5pdGVyYXRvcigpOwoK\nICAgICAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IG5ldyBUb3BpY0lu\nZm8oKTsKICAgICAgICAgICAgd2hpbGUgKGxySXRlcmF0b3IuaGFzTmV4dCgp\nKSB7CiAgICAgICAgICAgICAgICBMZWRnZXJSYW5nZSByYW5nZSA9IGxySXRl\ncmF0b3IubmV4dCgpOwoKICAgICAgICAgICAgICAgIGlmIChyYW5nZS5oYXNF\nbmRTZXFJZEluY2x1ZGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAvLyB0\naGlzIG1lYW5zIGl0IHdhcyBhIHZhbGlkIGFuZCBjb21wbGV0ZWx5IGNsb3Nl\nZCBsZWRnZXIKICAgICAgICAgICAgICAgICAgICBsb25nIGVuZE9mTGVkZ2Vy\nID0gcmFuZ2UuZ2V0RW5kU2VxSWRJbmNsdWRlZCgpLmdldExvY2FsQ29tcG9u\nZW50KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmdlLmhhc1N0YXJ0\nU2VxSWRJbmNsdWRlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0\nYXJ0T2ZMZWRnZXIgPSByYW5nZS5nZXRTdGFydFNlcUlkSW5jbHVkZWQoKTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICByYW5nZSA9IGJ1aWxkTGVkZ2VyUmFuZ2UocmFuZ2UuZ2V0TGVk\nZ2VySWQoKSwgc3RhcnRPZkxlZGdlciwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlLmdldEVuZFNlcUlk\nSW5jbHVkZWQoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIHRvcGljSW5mby5sZWRnZXJSYW5nZXMucHV0KGVuZE9mTGVk\nZ2VyLCBuZXcgSW5NZW1vcnlMZWRnZXJSYW5nZShyYW5nZSkpOwogICAgICAg\nICAgICAgICAgICAgIGlmIChzdGFydE9mTGVkZ2VyIDwgZW5kT2ZMZWRnZXIg\nKyAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0T2ZMZWRnZXIg\nPSBlbmRPZkxlZGdlciArIDE7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgIC8vIElmIGl0IGRvZXNuJ3QgaGF2ZSBhIHZhbGlk\nIGVuZCwgaXQgbXVzdCBiZSB0aGUgbGFzdCBsZWRnZXIKICAgICAgICAgICAg\nICAgIGlmIChsckl0ZXJhdG9yLmhhc05leHQoKSkgewogICAgICAgICAgICAg\nICAgICAgIFN0cmluZyBtc2cgPSAiTGVkZ2VyLWlkOiAiICsgcmFuZ2UuZ2V0\nTGVkZ2VySWQoKSArICIgZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdV\ndGY4KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGlz\nIG5vdCB0aGUgbGFzdCBvbmUgYnV0IHN0aWxsIGRvZXMgbm90IGhhdmUgYW4g\nZW5kIHNlcS1pZCI7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9y\nKG1zZyk7CiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVk\nKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5VbmV4cGVjdGVkQ29uZGl0aW9u\nRXhjZXB0aW9uKG1zZykpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmFuZ2Uu\naGFzU3RhcnRTZXFJZEluY2x1ZGVkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBzdGFydE9mTGVkZ2VyID0gcmFuZ2UuZ2V0U3RhcnRTZXFJZEluY2x1ZGVk\nKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gVGhl\nIGxhc3QgbGVkZ2VyIGRvZXMgbm90IGhhdmUgYSB2YWxpZCBzZXEtaWQsIGxl\ndHMgdHJ5IHRvCiAgICAgICAgICAgICAgICAvLyBmaW5kIGl0IG91dAogICAg\nICAgICAgICAgICAgcmVjb3Zlckxhc3RUb3BpY0xlZGdlckFuZE9wZW5OZXdP\nbmUocmFuZ2UuZ2V0TGVkZ2VySWQoKSwgc3RhcnRPZkxlZGdlciwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHZlcnNpb24sIHRvcGljSW5mbyk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIEFsbCBsZWRnZXJzIHdl\ncmUgZm91bmQgcHJvcGVybHkgY2xvc2VkLCBqdXN0IHN0YXJ0IGEgbmV3IG9u\nZQogICAgICAgICAgICBvcGVuTmV3VG9waWNMZWRnZXIodG9waWMsIHZlcnNp\nb24sIHRvcGljSW5mbywgc3RhcnRPZkxlZGdlciwgZmFsc2UsIGNiLCBjdHgp\nOwogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogUmVjb3ZlcnMg\ndGhlIGxhc3QgbGVkZ2VyLCBvcGVucyBhIG5ldyBvbmUsIGFuZCBwZXJzaXN0\ncyB0aGUgbmV3CiAgICAgICAgICogaW5mb3JtYXRpb24gdG8gWksKICAgICAg\nICAgKgogICAgICAgICAqIEBwYXJhbSBsZWRnZXJJZAogICAgICAgICAqICAg\nICAgICAgICAgTGVkZ2VyIHRvIGJlIHJlY292ZXJlZAogICAgICAgICAqIEBw\nYXJhbSBleHBlY3RlZFN0YXJ0U2VxSWQgCiAgICAgICAgICogICAgICAgICAg\nICBTdGFydCBzZXEgaWQgb2YgdGhlIGxlZGdlciB0byByZWNvdmVyCiAgICAg\nICAgICogQHBhcmFtIGV4cGVjdGVkVmVyc2lvbk9mTGVkZ2VyTm9kZQogICAg\nICAgICAqICAgICAgICAgICAgRXhwZWN0ZWQgdmVyc2lvbiB0byB1cGRhdGUg\nbGVkZ2VycyByYW5nZQogICAgICAgICAqIEBwYXJhbSB0b3BpY0luZm8KICAg\nICAgICAgKiAgICAgICAgICAgIFRvcGljIGluZm8KICAgICAgICAgKi8KICAg\nICAgICBwcml2YXRlIHZvaWQgcmVjb3Zlckxhc3RUb3BpY0xlZGdlckFuZE9w\nZW5OZXdPbmUoZmluYWwgbG9uZyBsZWRnZXJJZCwgZmluYWwgbG9uZyBleHBl\nY3RlZFN0YXJ0U2VxSWQsCiAgICAgICAgICAgICAgICBmaW5hbCBWZXJzaW9u\nIGV4cGVjdGVkVmVyc2lvbk9mTGVkZ2VyTm9kZSwgZmluYWwgVG9waWNJbmZv\nIHRvcGljSW5mbykgewoKICAgICAgICAgICAgYmsuYXN5bmNPcGVuTGVkZ2Vy\nKGxlZGdlcklkLCBEaWdlc3RUeXBlLkNSQzMyLCBwYXNzd2QsIG5ldyBTYWZl\nQXN5bkJLQ2FsbGJhY2suT3BlbkNhbGxiYWNrKCkgewogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZl\nT3BlbkNvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxlZGdlckhhbmRs\nZSwgT2JqZWN0IGN0eCkgewoKICAgICAgICAgICAgICAgICAgICBpZiAocmMg\nIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAg\nICAgICBCS0V4Y2VwdGlvbiBia2UgPSBCS0V4Y2VwdGlvbi5jcmVhdGUocmMp\nOwogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIldoaWxl\nIGFjcXVpcmluZyB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIsIGNvdWxk\nIG5vdCBvcGVuIHVucmVjb3ZlcmVkIGxlZGdlcjogIiArIGxlZGdlcklkLCBi\na2UpOwogICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWls\nZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0\naW9uKGJrZSkpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBmaW5h\nbCBsb25nIG51bUVudHJpZXNJbkxhc3RMZWRnZXIgPSBsZWRnZXJIYW5kbGUu\nZ2V0TGFzdEFkZENvbmZpcm1lZCgpICsgMTsKCiAgICAgICAgICAgICAgICAg\nICAgaWYgKG51bUVudHJpZXNJbkxhc3RMZWRnZXIgPD0gMCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAvLyB0aGlzIHdhcyBhbiBlbXB0eSBsZWRnZXIg\ndGhhdCBzb21lb25lIGNyZWF0ZWQgYnV0CiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGNvdWxkbid0IHdyaXRlIHRvLCBzbyBqdXN0IGlnbm9yZSBpdAog\nICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiUHJ1bmluZyBl\nbXB0eSBsZWRnZXI6ICIgKyBsZWRnZXJJZCArICIgZm9yIHRvcGljOiAiICsg\ndG9waWMudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICBjbG9zZUxlZGdlcihsZWRnZXJIYW5kbGUpOwogICAgICAgICAgICAgICAg\nICAgICAgICBvcGVuTmV3VG9waWNMZWRnZXIodG9waWMsIGV4cGVjdGVkVmVy\nc2lvbk9mTGVkZ2VyTm9kZSwgdG9waWNJbmZvLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWRTdGFydFNlcUlk\nLCBmYWxzZSwgY2IsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nICAgIC8vIHdlIGhhdmUgdG8gcmVhZCB0aGUgbGFzdCBlbnRyeSBvZiB0aGUg\nbGVkZ2VyIHRvIGZpbmQKICAgICAgICAgICAgICAgICAgICAvLyBvdXQgdGhl\nIGxhc3Qgc2VxLWlkCgogICAgICAgICAgICAgICAgICAgIGxlZGdlckhhbmRs\nZS5hc3luY1JlYWRFbnRyaWVzKG51bUVudHJpZXNJbkxhc3RMZWRnZXIgLSAx\nLCBudW1FbnRyaWVzSW5MYXN0TGVkZ2VyIC0gMSwKICAgICAgICAgICAgICAg\nICAgICBuZXcgU2FmZUFzeW5CS0NhbGxiYWNrLlJlYWRDYWxsYmFjaygpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVSZWFkQ29tcGxldGUoaW50\nIHJjLCBMZWRnZXJIYW5kbGUgbGgsIEVudW1lcmF0aW9uPExlZGdlckVudHJ5\nPiBzZXEsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdCBjdHgpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2Vw\ndGlvbi5Db2RlLk9LIHx8ICFzZXEuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQktFeGNl\ncHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAvLyBtZWFucyB0aGF0IHRoZXJlIGlzIG5vIGVudHJpZXMgcmVh\nZCwgcHJvdmlkZSBhIG1lYW5pbmdmdWwgZXhjZXB0aW9uCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29k\nZS5Ob1N1Y2hFbnRyeUV4Y2VwdGlvbjsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbG9nZ2VyLmluZm8oIlJlY2VpdmVkIGVycm9yIGNvZGUge30iLCByYyk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQktFeGNlcHRpb24gYmtl\nID0gQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIldoaWxlIHJlY292ZXJpbmcg\nbGVkZ2VyOiAiICsgbGVkZ2VySWQgKyAiIGZvciB0b3BpYzogIgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGlj\nLnRvU3RyaW5nVXRmOCgpICsgIiwgY291bGQgbm90IHJlYWQgbGFzdCBlbnRy\neSIsIGJrZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2\naWNlRG93bkV4Y2VwdGlvbihia2UpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSBsYXN0\nTWVzc2FnZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdE1lc3NhZ2UgPSBN\nZXNzYWdlLnBhcnNlRnJvbShzZXEubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgU3RyaW5nIG1zZyA9ICJXaGlsZSByZWNvdmVy\naW5nIGxlZGdlcjogIiArIGxlZGdlcklkICsgIiBmb3IgdG9waWM6ICIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0\nb3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIGNvdWxkIG5vdCBkZXNlcmlhbGl6\nZSBsYXN0IG1lc3NhZ2UiOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZ2dlci5lcnJvcihtc2csIGUpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJT\ndWJFeGNlcHRpb24uVW5leHBlY3RlZENvbmRpdGlvbkV4Y2VwdGlvbihtc2cp\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9uZyBlbmRPZkxlZGdlciAgPSBsYXN0TWVzc2FnZS5n\nZXRNc2dJZCgpLmdldExvY2FsQ29tcG9uZW50KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsb25nIHN0YXJ0T2ZMZWRnZXIgPSBlbmRPZkxlZGdl\nciAtIG51bUVudHJpZXNJbkxhc3RMZWRnZXIgKyAxOwoKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChzdGFydE9mTGVkZ2VyICE9IGV4cGVjdGVk\nU3RhcnRTZXFJZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGdhcCB3b3VsZCBiZSBpbnRyb2R1Y2VkIGJ5IG9sZCB2ZXJzaW9uIHdo\nZW4gZ2MgY29uc3VtZWQgbGVkZ2VycwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIFN0cmluZyBtc2cgPSAiRXhwZWN0ZWQgc3RhcnQgc2VxIGlk\nIG9mIHJlY292ZXJlZCBsZWRnZXIgIiArIGxlZGdlcklkCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiB0byBiZSAi\nICsgZXhwZWN0ZWRTdGFydFNlcUlkICsgIiBidXQgaXQgd2FzICIKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBzdGFy\ndE9mTGVkZ2VyICsgIi4iOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZ2dlci53YXJuKG1zZyk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVkZ2VyUmFu\nZ2UgbHIgPSBidWlsZExlZGdlclJhbmdlKGxlZGdlcklkLCBzdGFydE9mTGVk\nZ2VyLCBsYXN0TWVzc2FnZS5nZXRNc2dJZCgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHRvcGljSW5mby5sZWRnZXJSYW5nZXMucHV0KGVuZE9m\nTGVkZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBu\nZXcgSW5NZW1vcnlMZWRnZXJSYW5nZShsciwgbGgpKTsKCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiUmVjb3ZlcmVkIHVuY2xv\nc2VkIGxlZGdlcjoge30gZm9yIHRvcGljOiB7fSB3aXRoIHt9IGVudHJpZXMg\nc3RhcnRpbmcgZnJvbSBzZXEgaWQge30iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdmEobGVkZ2VySWQsIHRvcGljLnRvU3Ry\naW5nVXRmOCgpLCBudW1FbnRyaWVzSW5MYXN0TGVkZ2VyLCBzdGFydE9mTGVk\nZ2VyKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Blbk5ld1Rv\ncGljTGVkZ2VyKHRvcGljLCBleHBlY3RlZFZlcnNpb25PZkxlZGdlck5vZGUs\nIHRvcGljSW5mbywgZW5kT2ZMZWRnZXIgKyAxLCBmYWxzZSwgY2IsIGN0eCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9LCBjdHgpOwoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0s\nIGN0eCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogT3BlbiBO\nZXcgTGVkZ2VyIHRvIHdyaXRlIGZvciBhIHRvcGljLgogICAgICoKICAgICAq\nIEBwYXJhbSB0b3BpYwogICAgICogICAgICAgICAgVG9waWMgTmFtZQogICAg\nICogQHBhcmFtIGV4cGVjdGVkVmVyc2lvbk9mTGVkZ2Vyc05vZGUKICAgICAq\nICAgICAgICAgIEV4cGVjdGVkIFZlcnNpb24gdG8gVXBkYXRlIExlZGdlcnMg\nTm9kZS4KICAgICAqIEBwYXJhbSB0b3BpY0luZm8KICAgICAqICAgICAgICAg\nIFRvcGljIEluZm9ybWF0aW9uCiAgICAgKiBAcGFyYW0gc3RhcnRTZXFJZAog\nICAgICogICAgICAgICAgU3RhcnQgb2Ygc2VxdWVuY2UgaWQgZm9yIG5ldyBs\nZWRnZXIKICAgICAqIEBwYXJhbSBjaGFuZ2VMZWRnZXIKICAgICAqICAgICAg\nICAgIFdoZXRoZXIgaXMgaXQgY2FsbGVkIHdoZW4gY2hhbmdpbmcgbGVkZ2Vy\nCiAgICAgKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAgIENhbGxiYWNrIHRv\nIHRyaWdnZXIgYWZ0ZXIgb3BlbmluZyBuZXcgbGVkZ2VyLgogICAgICogQHBh\ncmFtIGN0eAogICAgICogICAgICAgICAgQ2FsbGJhY2sgY29udGV4dC4KICAg\nICAqLwogICAgdm9pZCBvcGVuTmV3VG9waWNMZWRnZXIoZmluYWwgQnl0ZVN0\ncmluZyB0b3BpYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFs\nIFZlcnNpb24gZXhwZWN0ZWRWZXJzaW9uT2ZMZWRnZXJzTm9kZSwgZmluYWwg\nVG9waWNJbmZvIHRvcGljSW5mbywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZpbmFsIGxvbmcgc3RhcnRTZXFJZCwgZmluYWwgYm9vbGVhbiBjaGFu\nZ2VMZWRnZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBD\nYWxsYmFjazxWb2lkPiBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAg\nIGJrLmFzeW5jQ3JlYXRlTGVkZ2VyKGNmZy5nZXRCa0Vuc2VtYmxlU2l6ZSgp\nLCBjZmcuZ2V0QmtXcml0ZVF1b3J1bVNpemUoKSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBjZmcuZ2V0QmtBY2tRdW9ydW1TaXplKCksIERpZ2Vz\ndFR5cGUuQ1JDMzIsIHBhc3N3ZCwKICAgICAgICBuZXcgU2FmZUFzeW5CS0Nh\nbGxiYWNrLkNyZWF0ZUNhbGxiYWNrKCkgewogICAgICAgICAgICBBdG9taWNC\nb29sZWFuIHByb2Nlc3NlZCA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsK\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzYWZlQ3JlYXRlQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgs\nIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgIGlmICghcHJvY2Vzc2Vk\nLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAg\nICAgICAgICAgICAgQktFeGNlcHRpb24gYmtlID0gQktFeGNlcHRpb24uY3Jl\nYXRlKHJjKTsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkNv\ndWxkIG5vdCBjcmVhdGUgbmV3IGxlZGdlciB3aGlsZSBhY3F1aXJpbmcgdG9w\naWM6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3Bp\nYy50b1N0cmluZ1V0ZjgoKSwgYmtlKTsKICAgICAgICAgICAgICAgICAgICBj\nYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNl\ncnZpY2VEb3duRXhjZXB0aW9uKGJrZSkpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAv\nLyBjb21wdXRlIGxhc3Qgc2VxIGlkCiAgICAgICAgICAgICAgICBpZiAoIWNo\nYW5nZUxlZGdlcikgewogICAgICAgICAgICAgICAgICAgIHRvcGljSW5mby5s\nYXN0U2VxSWRQdXNoZWQgPSB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmlzRW1w\ndHkoKSA/IE1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCkKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldExvY2Fs\nQ29tcG9uZW50KHN0YXJ0U2VxSWQgLSAxKS5idWlsZCgpIDogdG9waWNJbmZv\nLmxlZGdlclJhbmdlcy5sYXN0RW50cnkoKS5nZXRWYWx1ZSgpLnJhbmdlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC5nZXRFbmRTZXFJZEluY2x1ZGVkKCk7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgTGVkZ2VyUmFuZ2UgbGFzdFJhbmdlID0gTGVkZ2Vy\nUmFuZ2UubmV3QnVpbGRlcigpLnNldExlZGdlcklkKGxoLmdldElkKCkpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0U3Rh\ncnRTZXFJZEluY2x1ZGVkKHN0YXJ0U2VxSWQpLmJ1aWxkKCk7CiAgICAgICAg\nICAgICAgICB0b3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlID0gbmV3IElu\nTWVtb3J5TGVkZ2VyUmFuZ2UobGFzdFJhbmdlLCBsaCk7CiAgICAgICAgICAg\nICAgICB0b3BpY0luZm8ubGFzdEVudHJ5SWRBY2tlZEluQ3VycmVudExlZGdl\nciA9IC0xOwoKICAgICAgICAgICAgICAgIC8vIFBlcnNpc3QgdGhlIGZhY3Qg\ndGhhdCB3ZSBzdGFydGVkIHRoaXMgbmV3CiAgICAgICAgICAgICAgICAvLyBs\nZWRnZXIgdG8gWksKCiAgICAgICAgICAgICAgICBMZWRnZXJSYW5nZXMuQnVp\nbGRlciBidWlsZGVyID0gTGVkZ2VyUmFuZ2VzLm5ld0J1aWxkZXIoKTsKICAg\nICAgICAgICAgICAgIGZvciAoSW5NZW1vcnlMZWRnZXJSYW5nZSBpbWxyIDog\ndG9waWNJbmZvLmxlZGdlclJhbmdlcy52YWx1ZXMoKSkgewogICAgICAgICAg\nICAgICAgICAgIGJ1aWxkZXIuYWRkUmFuZ2VzKGltbHIucmFuZ2UpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgYnVpbGRlci5hZGRSYW5n\nZXMobGFzdFJhbmdlKTsKCiAgICAgICAgICAgICAgICB0cE1hbmFnZXIud3Jp\ndGVUb3BpY1BlcnNpc3RlbmNlSW5mbygKICAgICAgICAgICAgICAgIHRvcGlj\nLCBidWlsZGVyLmJ1aWxkKCksIGV4cGVjdGVkVmVyc2lvbk9mTGVkZ2Vyc05v\nZGUsIG5ldyBDYWxsYmFjazxWZXJzaW9uPigpIHsKICAgICAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWZXJzaW9uIG5ld1Zl\ncnNpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gRmluYWxseSwg\nYWxsIGRvbmUKICAgICAgICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLmxl\nZGdlclJhbmdlc1ZlcnNpb24gPSBuZXdWZXJzaW9uOwogICAgICAgICAgICAg\nICAgICAgICAgICB0b3BpY0luZm9zLnB1dCh0b3BpYywgdG9waWNJbmZvKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQo\nY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2Vw\ndGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0aW9uKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgfSwgY3R4KTsK\nICAgIH0KCiAgICAvKioKICAgICAqIGFjcXVpcmUgb3duZXJzaGlwIG9mIGEg\ndG9waWMsIGRvaW5nIHdoYXRldmVyIGlzIG5lZWRlZCB0byBiZSBhYmxlIHRv\nCiAgICAgKiBwZXJmb3JtIHJlYWRzIGFuZCB3cml0ZXMgb24gdGhhdCB0b3Bp\nYyBmcm9tIGhlcmUgb24KICAgICAqCiAgICAgKiBAcGFyYW0gdG9waWMKICAg\nICAqIEBwYXJhbSBjYWxsYmFjawogICAgICogQHBhcmFtIGN0eAogICAgICov\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGFjcXVpcmVkVG9waWMo\nQnl0ZVN0cmluZyB0b3BpYywgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9i\namVjdCBjdHgpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRv\ncGljLCBuZXcgQWNxdWlyZU9wKHRvcGljLCBjYWxsYmFjaywgY3R4KSk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDaGFuZ2UgbGVkZ2VyIHRvIHdyaXRlIGZv\nciBhIHRvcGljLgogICAgICovCiAgICBjbGFzcyBDaGFuZ2VMZWRnZXJPcCBl\neHRlbmRzIFRvcGljT3BRdWV1ZXIuQXN5bmNocm9ub3VzT3A8Vm9pZD4gewoK\nICAgICAgICBwdWJsaWMgQ2hhbmdlTGVkZ2VyT3AoQnl0ZVN0cmluZyB0b3Bp\nYywgQ2FsbGJhY2s8Vm9pZD4gY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgcXVldWVyLnN1cGVyKHRvcGljLCBjYiwgY3R4KTsKICAgICAgICB9Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5mb3Mu\nZ2V0KHRvcGljKTsKICAgICAgICAgICAgaWYgKG51bGwgPT0gdG9waWNJbmZv\nKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIldlaXJlZCEgaHVi\nIHNlcnZlciBkb2Vzbid0IG93biB0b3BpYyAiICsgdG9waWMudG9TdHJpbmdV\ndGY4KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHdoZW4gY2hh\nbmdpbmcgbGVkZ2VyIHRvIHdyaXRlLiIpOwogICAgICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2\nZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9uKCIiKSk7CiAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nY2xvc2VMYXN0VG9waWNMZWRnZXJBbmRPcGVuTmV3T25lKHRvcGljSW5mbyk7\nCiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgY2xvc2VMYXN0VG9w\naWNMZWRnZXJBbmRPcGVuTmV3T25lKGZpbmFsIFRvcGljSW5mbyB0b3BpY0lu\nZm8pIHsKICAgICAgICAgICAgZmluYWwgbG9uZyBsZWRnZXJJZCA9IHRvcGlj\nSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuaGFuZGxlLmdldElkKCk7CiAgICAg\nICAgICAgIHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UuaGFuZGxlLmFz\neW5jQ2xvc2UobmV3IENsb3NlQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAg\nICBBdG9taWNCb29sZWFuIHByb2Nlc3NlZCA9IG5ldyBBdG9taWNCb29sZWFu\nKGZhbHNlKTsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgY2xvc2VDb21wbGV0ZShpbnQgcmMsIExlZGdl\nckhhbmRsZSBsaCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAg\nIGlmICghcHJvY2Vzc2VkLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKEJLRXhjZXB0aW9u\nLkNvZGUuT0sgIT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQktF\neGNlcHRpb24gYmtlID0gQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDb3VsZCBub3QgY2xv\nc2UgbGVkZ2VyICIgKyBsZWRnZXJJZAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgIiB3aGlsZSBjaGFuZ2luZyBsZWRnZXIgb2YgdG9w\naWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBia2UpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHVi\nU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGJrZSkpOwogICAg\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGxvbmcgZW5kU2VxSWQgPSB0b3Bp\nY0luZm8ubGFzdFNlcUlkUHVzaGVkLmdldExvY2FsQ29tcG9uZW50KCk7CiAg\nICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIGxhc3QgcmFuZ2UKICAgICAg\nICAgICAgICAgICAgICBMZWRnZXJSYW5nZSBsYXN0UmFuZ2UgPQogICAgICAg\nICAgICAgICAgICAgICAgICBidWlsZExlZGdlclJhbmdlKGxlZGdlcklkLCB0\nb3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlLmdldFN0YXJ0U2VxSWRJbmNs\ndWRlZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRvcGljSW5mby5sYXN0U2VxSWRQdXNoZWQpOwoKICAgICAgICAgICAg\nICAgICAgICB0b3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlLnJhbmdlID0g\nbGFzdFJhbmdlOwogICAgICAgICAgICAgICAgICAgIC8vIHB1dCBjdXJyZW50\nIGxlZGdlciB0byBsZWRnZXIgcmFuZ2VzCiAgICAgICAgICAgICAgICAgICAg\ndG9waWNJbmZvLmxlZGdlclJhbmdlcy5wdXQoZW5kU2VxSWQsIHRvcGljSW5m\nby5jdXJyZW50TGVkZ2VyUmFuZ2UpOwogICAgICAgICAgICAgICAgICAgIGxv\nZ2dlci5pbmZvKCJDbG9zZWQgd3JpdHRlbiBsZWRnZXIgIiArIGxlZGdlcklk\nICsgIiBmb3IgdG9waWMgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiB0byBjaGFuZ2UgbGVkZ2Vy\nLiIpOwogICAgICAgICAgICAgICAgICAgIG9wZW5OZXdUb3BpY0xlZGdlcih0\nb3BpYywgdG9waWNJbmZvLmxlZGdlclJhbmdlc1ZlcnNpb24sCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGljSW5mbywgZW5k\nU2VxSWQgKyAxLCB0cnVlLCBjYiwgY3R4KTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICB9CgogICAgfQoKICAgIC8q\nKgogICAgICogQ2hhbmdlIGxlZGdlciB0byB3cml0ZSBmb3IgYSB0b3BpYy4K\nICAgICAqCiAgICAgKiBAcGFyYW0gdG9waWMKICAgICAqICAgICAgICAgIFRv\ncGljIE5hbWUKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY2hhbmdlTGVk\nZ2VyKEJ5dGVTdHJpbmcgdG9waWMsIENhbGxiYWNrPFZvaWQ+IGNiLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3Bp\nYywgbmV3IENoYW5nZUxlZGdlck9wKHRvcGljLCBjYiwgY3R4KSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgY2xvc2VMZWRnZXIoTGVkZ2VySGFuZGxlIGxo\nKSB7CiAgICAgICAgLy8gdHJ5IHsKICAgICAgICAvLyBsaC5hc3luY0Nsb3Nl\nKG5vT3BDbG9zZUNhbGxiYWNrLCBudWxsKTsKICAgICAgICAvLyB9IGNhdGNo\nIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgLy8gbG9nZ2Vy\nLmVycm9yKGUpOwogICAgICAgIC8vIFRocmVhZC5jdXJyZW50VGhyZWFkKCku\naW50ZXJydXB0KCk7CiAgICAgICAgLy8gfQogICAgfQoKICAgIGNsYXNzIFJl\nbGVhc2VPcCBleHRlbmRzIFRvcGljT3BRdWV1ZXIuU3luY2hyb25vdXNPcCB7\nCgogICAgICAgIHB1YmxpYyBSZWxlYXNlT3AoQnl0ZVN0cmluZyB0b3BpYykg\newogICAgICAgICAgICBxdWV1ZXIuc3VwZXIodG9waWMpOwogICAgICAgIH0K\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuSW50\nZXJuYWwoKSB7CiAgICAgICAgICAgIFRvcGljSW5mbyB0b3BpY0luZm8gPSB0\nb3BpY0luZm9zLnJlbW92ZSh0b3BpYyk7CgogICAgICAgICAgICBpZiAodG9w\naWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIChJbk1lbW9yeUxlZGdlclJh\nbmdlIGltbHIgOiB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLnZhbHVlcygpKSB7\nCiAgICAgICAgICAgICAgICBpZiAoaW1sci5oYW5kbGUgIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgICAgIGNsb3NlTGVkZ2VyKGltbHIuaGFuZGxlKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAg\naWYgKHRvcGljSW5mby5jdXJyZW50TGVkZ2VyUmFuZ2UgIT0gbnVsbCAmJiB0\nb3BpY0luZm8uY3VycmVudExlZGdlclJhbmdlLmhhbmRsZSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICBjbG9zZUxlZGdlcih0b3BpY0luZm8uY3VycmVu\ndExlZGdlclJhbmdlLmhhbmRsZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFueSByZXNvdXJjZXMg\nZm9yIHRoZSB0b3BpYyB0aGF0IG1pZ2h0IGJlIGN1cnJlbnRseSBoZWxkLiBU\naGVyZQogICAgICogd29udCBiZSBhbnkgc3Vic2VxdWVudCByZWFkcyBvciB3\ncml0ZXMgb24gdGhhdCB0b3BpYyBjb21pbmcKICAgICAqCiAgICAgKiBAcGFy\nYW0gdG9waWMKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCBsb3N0VG9waWMoQnl0ZVN0cmluZyB0b3BpYykgewogICAgICAgIHF1ZXVl\nci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBSZWxlYXNlT3AodG9waWMp\nKTsKICAgIH0KCiAgICBjbGFzcyBTZXRNZXNzYWdlQm91bmRPcCBleHRlbmRz\nIFRvcGljT3BRdWV1ZXIuU3luY2hyb25vdXNPcCB7CiAgICAgICAgZmluYWwg\naW50IGJvdW5kOwoKICAgICAgICBwdWJsaWMgU2V0TWVzc2FnZUJvdW5kT3Ao\nQnl0ZVN0cmluZyB0b3BpYywgaW50IGJvdW5kKSB7CiAgICAgICAgICAgIHF1\nZXVlci5zdXBlcih0b3BpYyk7CiAgICAgICAgICAgIHRoaXMuYm91bmQgPSBi\nb3VuZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyB2b2lkIHJ1bkludGVybmFsKCkgewogICAgICAgICAgICBUb3BpY0lu\nZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwogICAgICAg\nICAgICBpZiAodG9waWNJbmZvICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIHRvcGljSW5mby5tZXNzYWdlQm91bmQgPSBib3VuZDsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRNZXNzYWdl\nQm91bmQoQnl0ZVN0cmluZyB0b3BpYywgSW50ZWdlciBib3VuZCkgewogICAg\nICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBTZXRNZXNz\nYWdlQm91bmRPcCh0b3BpYywgYm91bmQpKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBjbGVhck1lc3NhZ2VCb3VuZChCeXRlU3RyaW5nIHRvcGljKSB7CiAg\nICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IFNldE1l\nc3NhZ2VCb3VuZE9wKHRvcGljLCBUb3BpY0luZm8uVU5MSU1JVEVEKSk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzdG9wKCkgewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHRwTWFuYWdlci5jbG9zZSgpOwog\nICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAg\nICBsb2dnZXIud2FybigiRXhjZXB0aW9uIGNsb3NpbmcgdG9waWMgcGVyc2lz\ndGVuY2UgbWFuYWdlciA6ICIsIGlvZSk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

