{"sha":"6f474c823880db82dc714a73763883dcabcb5462","node_id":"MDQ6QmxvYjE1NzU5NTY6NmY0NzRjODIzODgwZGI4MmRjNzE0YTczNzYzODgzZGNhYmNiNTQ2Mg==","size":18033,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/6f474c823880db82dc714a73763883dcabcb5462","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuc3FsLkNvbm5lY3Rpb247CmltcG9ydCBqYXZhLnNx\nbC5Ecml2ZXJNYW5hZ2VyOwppbXBvcnQgamF2YS5zcWwuUHJlcGFyZWRTdGF0\nZW1lbnQ7CmltcG9ydCBqYXZhLnNxbC5SZXN1bHRTZXQ7CmltcG9ydCBqYXZh\nLnNxbC5TUUxFeGNlcHRpb247CmltcG9ydCBqYXZhLnNxbC5TdGF0ZW1lbnQ7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1h\ncDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRNYXA7\nCgppbXBvcnQgamF2YS5tYXRoLkJpZ0ludGVnZXI7CmltcG9ydCBqYXZhLnNl\nY3VyaXR5Lk1lc3NhZ2VEaWdlc3Q7CmltcG9ydCBqYXZhLnNlY3VyaXR5Lk5v\nU3VjaEFsZ29yaXRobUV4Y2VwdGlvbjsKCmltcG9ydCBqYXZheC5zcWwucm93\nc2V0LnNlcmlhbC5TZXJpYWxCbG9iOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBz\ndGF0aWMgY29tLmdvb2dsZS5jb21tb24uYmFzZS5DaGFyc2V0cy5VVEZfODsK\nCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlv\nbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLlVuZXhwZWN0ZWRDb25k\naXRpb25FeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlk\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9leHRlbnNpb25zLk1l\nc3NhZ2VJZFV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVy\nLnBlcnNpc3RlbmNlLlNjYW5DYWxsYmFjay5SZWFzb25Gb3JGaW5pc2g7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5GaWxlVXRpbHM7CgpwdWJsaWMgY2xh\nc3MgTG9jYWxEQlBlcnNpc3RlbmNlTWFuYWdlciBpbXBsZW1lbnRzIFBlcnNp\nc3RlbmNlTWFuYWdlcldpdGhSYW5nZVNjYW4gewogICAgc3RhdGljIExvZ2dl\nciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihMb2NhbERCUGVy\nc2lzdGVuY2VNYW5hZ2VyLmNsYXNzKTsKCiAgICBzdGF0aWMgU3RyaW5nIGNv\nbm5lY3Rpb25VUkw7CgogICAgc3RhdGljIHsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBGaWxlIHRlbXBEaXIgPSBGaWxlVXRpbHMuY3JlYXRlVGVtcERp\ncmVjdG9yeSgiZGVyYnkiLCBudWxsKTsKCiAgICAgICAgICAgIC8vIFNpbmNl\nIGRlcmJ5IG5lZWRzIHRvIGNyZWF0ZSBpdCwgSSB3aWxsIGhhdmUgdG8gZGVs\nZXRlIGl0IGZpcnN0CiAgICAgICAgICAgIGlmICghdGVtcERpci5kZWxldGUo\nKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJD\nb3VsZCBub3QgZGVsZXRlIGRpcjogIiArIHRlbXBEaXIuZ2V0QWJzb2x1dGVQ\nYXRoKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbm5lY3Rpb25V\nUkwgPSAiamRiYzpkZXJieToiICsgdGVtcERpci5nZXRBYnNvbHV0ZVBhdGgo\nKSArICI7Y3JlYXRlPXRydWUiOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRp\nb24oZSk7CiAgICAgICAgfQoKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBUaHJlYWRMb2NhbDxDb25uZWN0aW9uPiB0aHJlYWRMb2NhbENvbm5l\nY3Rpb24gPSBuZXcgVGhyZWFkTG9jYWw8Q29ubmVjdGlvbj4oKSB7CiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHJvdGVjdGVkIENvbm5lY3Rpb24gaW5p\ndGlhbFZhbHVlKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIERyaXZlck1hbmFnZXIuZ2V0Q29ubmVjdGlvbihjb25uZWN0\naW9uVVJMKTsKICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ291bGQgbm90IGNv\nbm5lY3QgdG8gZGVyYnkiLCBlKTsKICAgICAgICAgICAgICAgIHJldHVybiBu\ndWxsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBUaHJlYWRMb2NhbDxNZXNzYWdlRGlnZXN0PiB0\naHJlYWRMb2NhbERpZ2VzdCA9IG5ldyBUaHJlYWRMb2NhbDxNZXNzYWdlRGln\nZXN0PigpIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwcm90ZWN0ZWQg\nTWVzc2FnZURpZ2VzdCBpbml0aWFsVmFsdWUoKSB7CiAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICByZXR1cm4gTWVzc2FnZURpZ2VzdC5nZXRJ\nbnN0YW5jZSgiTUQ1Iik7CiAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaEFs\nZ29yaXRobUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIu\nZXJyb3IoIkNvdWxkIG5vdCBmaW5kIE1ENSBoYXNoIiwgZSk7CiAgICAgICAg\nICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH07CiAgICBzdGF0aWMgZmluYWwgU3RyaW5nIElEX0ZJRUxEX05BTUUg\nPSAiaWQiOwogICAgc3RhdGljIGZpbmFsIFN0cmluZyBNU0dfRklFTERfTkFN\nRSA9ICJtc2ciOwogICAgc3RhdGljIGZpbmFsIFN0cmluZyBkcml2ZXIgPSAi\nb3JnLmFwYWNoZS5kZXJieS5qZGJjLkVtYmVkZGVkRHJpdmVyIjsKCiAgICBz\ndGF0aWMgZmluYWwgaW50IFNDQU5fQ0hVTksgPSAxMDAwOwoKICAgIC8qKgog\nICAgICogSGF2aW5nIHRyb3VibGUgcmVzdGFydGluZyB0aGUgZGF0YWJhc2Ug\nbXVsdGlwbGUgdGltZXMgZnJvbSB3aXRoaW4gdGhlCiAgICAgKiBzYW1lIGp2\nbS4gSGVuY2UgdG8gZmFjaWxpdGF0ZSB1bml0cyB0ZXN0cywgd2UgYXJlIGp1\nc3QgZ29pbmcgdG8gaGF2ZSBhCiAgICAgKiB2ZXJzaW9uIG51bWJlciB0aGF0\nIHdlIHdpbGwgYXBwZW5kIHRvIGV2ZXJ5IHRhYmxlIG5hbWUuIFRoaXMgdmVy\nc2lvbgogICAgICogbnVtYmVyIHdpbGwgYmUgaW5jcmVtZW50ZWQgaW4gbGll\ndSBvZiBzaHV0dGluZyBkb3duIHRoZSBkYXRhYmFzZSBhbmQKICAgICAqIHJl\nc3RhcnRpbmcgaXQsIHNvIHRoYXQgd2UgZ2V0IGRpZmZlcmVudCB0YWJsZSBu\nYW1lcywgYW5kIGl0IGJlaGF2ZXMgbGlrZQogICAgICogYSBicmFuZCBuZXcg\nZGF0YWJhc2UKICAgICAqLwogICAgcHJpdmF0ZSBpbnQgdmVyc2lvbiA9IDA7\nCgogICAgQ29uY3VycmVudE1hcDxCeXRlU3RyaW5nLCBNZXNzYWdlU2VxSWQ+\nIGN1cnJUb3BpY1NlcUlkcyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxCeXRl\nU3RyaW5nLCBNZXNzYWdlU2VxSWQ+KCk7CgogICAgc3RhdGljIExvY2FsREJQ\nZXJzaXN0ZW5jZU1hbmFnZXIgaW5zdGFuY2UgPSBuZXcgTG9jYWxEQlBlcnNp\nc3RlbmNlTWFuYWdlcigpOwoKICAgIHB1YmxpYyBzdGF0aWMgTG9jYWxEQlBl\ncnNpc3RlbmNlTWFuYWdlciBpbnN0YW5jZSgpIHsKICAgICAgICByZXR1cm4g\naW5zdGFuY2U7CiAgICB9CgogICAgcHJpdmF0ZSBMb2NhbERCUGVyc2lzdGVu\nY2VNYW5hZ2VyKCkgewoKICAgICAgICB0cnkgewogICAgICAgICAgICBDbGFz\ncy5mb3JOYW1lKGRyaXZlcikubmV3SW5zdGFuY2UoKTsKICAgICAgICAgICAg\nbG9nZ2VyLmluZm8oIkRlcmJ5IERyaXZlciBsb2FkZWQiKTsKICAgICAgICB9\nIGNhdGNoIChqYXZhLmxhbmcuQ2xhc3NOb3RGb3VuZEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRGVyYnkgZHJpdmVyIG5vdCBm\nb3VuZCIsIGUpOwogICAgICAgIH0gY2F0Y2ggKEluc3RhbnRpYXRpb25FeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkNvdWxkIG5v\ndCBpbnN0YW50aWF0ZSBkZXJieSBkcml2ZXIiLCBlKTsKICAgICAgICB9IGNh\ndGNoIChJbGxlZ2FsQWNjZXNzRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nbG9nZ2VyLmVycm9yKCJDb3VsZCBub3QgaW5zdGFudGlhdGUgZGVyYnkgZHJp\ndmVyIiwgZSk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgc3RvcCgpIHsKICAgICAgICAvLyBkbyBub3RoaW5nCiAg\nICB9CgogICAgLyoqCiAgICAgKiBFbnN1cmVzIHRoYXQgYXQgbGVhc3QgdGhl\nIGRlZmF1bHQgc2VxLWlkIGV4aXN0cyBpbiB0aGUgbWFwIGZvciB0aGUgZ2l2\nZW4KICAgICAqIHRvcGljLiBDaGVja3MgZm9yIHJhY2UgY29uZGl0aW9ucyAo\nLmUuZywgYW5vdGhlciB0aHJlYWQgaW5zZXJ0cyB0aGUKICAgICAqIGRlZmF1\nbHQgaWQgYmVmb3JlIHVzKSwgYW5kIHJldHVybnMgdGhlIGxhdGVzdCBzZXEt\naWQgdmFsdWUgaW4gdGhlIG1hcAogICAgICoKICAgICAqIEBwYXJhbSB0b3Bp\nYwogICAgICogQHJldHVybgogICAgICovCiAgICBwcml2YXRlIE1lc3NhZ2VT\nZXFJZCBlbnN1cmVTZXFJZEV4aXN0c0ZvclRvcGljKEJ5dGVTdHJpbmcgdG9w\naWMpIHsKICAgICAgICBNZXNzYWdlU2VxSWQgcHJlc2VudFNlcUlkSW5NYXAg\nPSBjdXJyVG9waWNTZXFJZHMuZ2V0KHRvcGljKTsKCiAgICAgICAgaWYgKHBy\nZXNlbnRTZXFJZEluTWFwICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJu\nIHByZXNlbnRTZXFJZEluTWFwOwogICAgICAgIH0KCiAgICAgICAgcHJlc2Vu\ndFNlcUlkSW5NYXAgPSBNZXNzYWdlU2VxSWQubmV3QnVpbGRlcigpLnNldExv\nY2FsQ29tcG9uZW50KDApLmJ1aWxkKCk7CiAgICAgICAgTWVzc2FnZVNlcUlk\nIG9sZFNlcUlkSW5NYXAgPSBjdXJyVG9waWNTZXFJZHMucHV0SWZBYnNlbnQo\ndG9waWMsIHByZXNlbnRTZXFJZEluTWFwKTsKCiAgICAgICAgaWYgKG9sZFNl\ncUlkSW5NYXAgIT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gb2xkU2Vx\nSWRJbk1hcDsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByZXNlbnRTZXFJ\nZEluTWFwOwoKICAgIH0KCiAgICAvKioKICAgICAqIEFkanVzdCB0aGUgY3Vy\ncmVudCBzZXEgaWQgb2YgdGhlIHRvcGljIGJhc2VkIG9uIHRoZSBtZXNzYWdl\nIHdlIGFyZSBhYm91dAogICAgICogdG8gcHVibGlzaC4gVGhlIGxvY2FsIGNv\nbXBvbmVudCBvZiB0aGUgY3VycmVudCBzZXEtaWQgaXMgYWx3YXlzCiAgICAg\nKiBpbmNyZW1lbnRlZCBieSAxLiBGb3IgdGhlIG90aGVyIGNvbXBvbmVudHMs\nIHRoZXJlIGFyZSB0d28gY2FzZXM6CiAgICAgKgogICAgICogMS4gSWYgdGhl\nIG1lc3NhZ2UgdG8gYmUgcHVibGlzaGVkIGRvZXNuJ3QgaGF2ZSBhIHNlcS1p\nZCAobG9jYWxseQogICAgICogcHVibGlzaGVkIG1lc3NhZ2VzKSwgdGhlIG90\naGVyIGNvbXBvbmVudHMgYXJlIGxlZnQgYXMgaXMuCiAgICAgKgogICAgICog\nMi4gSWYgdGhlIG1lc3NhZ2UgdG8gYmUgcHVibGlzaGVkIGhhcyBhIHNlcS1p\nZCwgd2UgdGFrZSB0aGUgbWF4IG9mIHRoZQogICAgICogY3VycmVudCBvbmUg\nd2UgaGF2ZSwgYW5kIHRoYXQgaW4gdGhlIG1lc3NhZ2UgdG8gYmUgcHVibGlz\naGVkLgogICAgICoKICAgICAqIEBwYXJhbSB0b3BpYwogICAgICogQHBhcmFt\nIG1lc3NhZ2VUb1B1Ymxpc2gKICAgICAqIEByZXR1cm4gVGhlIHZhbHVlIG9m\nIHRoZSBsb2NhbCBzZXEtaWQgb2J0YWluZWQgYWZ0ZXIgaW5jcmVtZW50aW5n\nIHRoZQogICAgICogICAgICAgICBsb2NhbCBjb21wb25lbnQuIFRoaXMgdmFs\ndWUgc2hvdWxkIGJlIHVzZWQgYXMgYW4gaWQgd2hpbGUKICAgICAqICAgICAg\nICAgcGVyc2lzdGluZyB0byBEZXJieQogICAgICogQHRocm93cyBVbmV4cGVj\ndGVkQ29uZGl0aW9uRXhjZXB0aW9uCiAgICAgKi8KICAgIHByaXZhdGUgbG9u\nZyBhZGp1c3RUb3BpY1NlcUlkRm9yUHVibGlzaChCeXRlU3RyaW5nIHRvcGlj\nLCBNZXNzYWdlIG1lc3NhZ2VUb1B1Ymxpc2gpCiAgICAgICAgICAgIHRocm93\ncyBVbmV4cGVjdGVkQ29uZGl0aW9uRXhjZXB0aW9uIHsKICAgICAgICBsb25n\nIHJldFZhbHVlID0gMDsKICAgICAgICBNZXNzYWdlU2VxSWQgb2xkSWQ7CiAg\nICAgICAgTWVzc2FnZVNlcUlkLkJ1aWxkZXIgbmV3SWRCdWlsZGVyID0gTWVz\nc2FnZVNlcUlkLm5ld0J1aWxkZXIoKTsKCiAgICAgICAgZG8gewogICAgICAg\nICAgICBvbGRJZCA9IGVuc3VyZVNlcUlkRXhpc3RzRm9yVG9waWModG9waWMp\nOwoKICAgICAgICAgICAgLy8gSW5jcmVtZW50IG91ciBvd24gY29tcG9uZW50\nIGJ5IDEKICAgICAgICAgICAgcmV0VmFsdWUgPSBvbGRJZC5nZXRMb2NhbENv\nbXBvbmVudCgpICsgMTsKICAgICAgICAgICAgbmV3SWRCdWlsZGVyLnNldExv\nY2FsQ29tcG9uZW50KHJldFZhbHVlKTsKCiAgICAgICAgICAgIGlmIChtZXNz\nYWdlVG9QdWJsaXNoLmhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIC8v\nIHRha2UgYSByZWdpb24td2lzZSBtYXgKICAgICAgICAgICAgICAgIE1lc3Nh\nZ2VJZFV0aWxzLnRha2VSZWdpb25NYXhpbXVtKG5ld0lkQnVpbGRlciwgbWVz\nc2FnZVRvUHVibGlzaC5nZXRNc2dJZCgpLCBvbGRJZCk7CgogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgbmV3SWRCdWlsZGVyLmFkZEFs\nbFJlbW90ZUNvbXBvbmVudHMob2xkSWQuZ2V0UmVtb3RlQ29tcG9uZW50c0xp\nc3QoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IHdoaWxlICghY3VyclRv\ncGljU2VxSWRzLnJlcGxhY2UodG9waWMsIG9sZElkLCBuZXdJZEJ1aWxkZXIu\nYnVpbGQoKSkpOwoKICAgICAgICByZXR1cm4gcmV0VmFsdWU7CgogICAgfQoK\nICAgIHB1YmxpYyBsb25nIGdldFNlcUlkQWZ0ZXJTa2lwcGluZyhCeXRlU3Ry\naW5nIHRvcGljLCBsb25nIHNlcUlkLCBpbnQgc2tpcEFtb3VudCkgewogICAg\nICAgIHJldHVybiBzZXFJZCArIHNraXBBbW91bnQ7CiAgICB9CgogICAgcHVi\nbGljIHZvaWQgcGVyc2lzdE1lc3NhZ2UoUGVyc2lzdFJlcXVlc3QgcmVxdWVz\ndCkgewoKICAgICAgICBDb25uZWN0aW9uIGNvbm4gPSB0aHJlYWRMb2NhbENv\nbm5lY3Rpb24uZ2V0KCk7CgogICAgICAgIENhbGxiYWNrPE1lc3NhZ2VTZXFJ\nZD4gY2FsbGJhY2sgPSByZXF1ZXN0LmdldENhbGxiYWNrKCk7CiAgICAgICAg\nT2JqZWN0IGN0eCA9IHJlcXVlc3QuZ2V0Q3R4KCk7CiAgICAgICAgQnl0ZVN0\ncmluZyB0b3BpYyA9IHJlcXVlc3QuZ2V0VG9waWMoKTsKICAgICAgICBNZXNz\nYWdlIG1lc3NhZ2UgPSByZXF1ZXN0LmdldE1lc3NhZ2UoKTsKCiAgICAgICAg\naWYgKGNvbm4gPT0gbnVsbCkgewogICAgICAgICAgICBjYWxsYmFjay5vcGVy\nYXRpb25GYWlsZWQoY3R4LCBuZXcgU2VydmljZURvd25FeGNlcHRpb24oIk5v\ndCBjb25uZWN0ZWQgdG8gZGVyYnkiKSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIGxvbmcgc2VxSWQ7CgogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIHNlcUlkID0gYWRqdXN0VG9waWNTZXFJZEZvclB1Ymxp\nc2godG9waWMsIG1lc3NhZ2UpOwogICAgICAgIH0gY2F0Y2ggKFVuZXhwZWN0\nZWRDb25kaXRpb25FeGNlcHRpb24gZSkgewogICAgICAgICAgICBjYWxsYmFj\nay5vcGVyYXRpb25GYWlsZWQoY3R4LCBlKTsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG10OwoK\nICAgICAgICBib29sZWFuIHRyaWVkQ3JlYXRpbmdUYWJsZSA9IGZhbHNlOwog\nICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBtZXNzYWdlLmdldEJvZHkoKTsKICAgICAgICAgICAgICAg\nIHN0bXQgPSBjb25uLnByZXBhcmVTdGF0ZW1lbnQoIklOU0VSVCBJTlRPICIg\nKyBnZXRUYWJsZU5hbWVGb3JUb3BpYyh0b3BpYykgKyAiIFZBTFVFUyg/LD8p\nIik7CiAgICAgICAgICAgICAgICBzdG10LnNldExvbmcoMSwgc2VxSWQpOwog\nICAgICAgICAgICAgICAgc3RtdC5zZXRCbG9iKDIsIG5ldyBTZXJpYWxCbG9i\nKG1lc3NhZ2UudG9CeXRlQXJyYXkoKSkpOwoKICAgICAgICAgICAgICAgIGlu\ndCByb3dDb3VudCA9IHN0bXQuZXhlY3V0ZVVwZGF0ZSgpOwogICAgICAgICAg\nICAgICAgc3RtdC5jbG9zZSgpOwogICAgICAgICAgICAgICAgaWYgKHJvd0Nv\ndW50ICE9IDEpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3Io\nIlVuZXhwZWN0ZWQgbnVtYmVyIG9mIGFmZmVjdGVkIHJvd3MgZnJvbSBkZXJi\neSIpOwogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZh\naWxlZChjdHgsIG5ldyBTZXJ2aWNlRG93bkV4Y2VwdGlvbigiVW5leHBlY3Rl\nZCByZXNwb25zZSBmcm9tIGRlcmJ5IikpOwogICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3FsZSkg\newogICAgICAgICAgICAgICAgU3RyaW5nIHRoZUVycm9yID0gKHNxbGUpLmdl\ndFNRTFN0YXRlKCk7CiAgICAgICAgICAgICAgICBpZiAodGhlRXJyb3IuZXF1\nYWxzKCI0MlgwNSIpICYmICF0cmllZENyZWF0aW5nVGFibGUpIHsKICAgICAg\nICAgICAgICAgICAgICBjcmVhdGVUYWJsZShjb25uLCB0b3BpYyk7CiAgICAg\nICAgICAgICAgICAgICAgdHJpZWRDcmVhdGluZ1RhYmxlID0gdHJ1ZTsKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIGV4\nZWN1dGluZyBkZXJieSBpbnNlcnQiLCBzcWxlKTsKICAgICAgICAgICAgICAg\nIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBTZXJ2aWNlRG93\nbkV4Y2VwdGlvbihzcWxlKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2FsbGJhY2sub3BlcmF0\naW9uRmluaXNoZWQoY3R4LCBNZXNzYWdlSWRVdGlscy5tZXJnZUxvY2FsU2Vx\nSWQobWVzc2FnZSwgc2VxSWQpLmdldE1zZ0lkKCkpOwogICAgfQoKICAgIC8q\nCiAgICAgKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB0aHJvdyBhbiBleGNlcHRp\nb24gYmVjYXVzZSBhbm90aGVyIHRocmVhZCBtaWdodAogICAgICogc25lYWsg\naW4gYW5kIGNyZWF0ZSB0aGUgdGFibGUgYmVmb3JlIHVzCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBjcmVhdGVUYWJsZShDb25uZWN0aW9uIGNvbm4sIEJ5\ndGVTdHJpbmcgdG9waWMpIHsKICAgICAgICBTdGF0ZW1lbnQgc3RtdCA9IG51\nbGw7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgc3RtdCA9IGNvbm4uY3Jl\nYXRlU3RhdGVtZW50KCk7CiAgICAgICAgICAgIFN0cmluZyB0YWJsZU5hbWUg\nPSBnZXRUYWJsZU5hbWVGb3JUb3BpYyh0b3BpYyk7CiAgICAgICAgICAgIHN0\nbXQuZXhlY3V0ZSgiQ1JFQVRFIFRBQkxFICIgKyB0YWJsZU5hbWUgKyAiICgi\nICsgSURfRklFTERfTkFNRSArICIgQklHSU5UIE5PVCBOVUxMIENPTlNUUkFJ\nTlQgSURfUEtfIgogICAgICAgICAgICAgICAgICAgICsgdGFibGVOYW1lICsg\nIiBQUklNQVJZIEtFWSwiICsgTVNHX0ZJRUxEX05BTUUgKyAiIEJMT0IoMk0p\nIE5PVCBOVUxMKSIpOwogICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ291bGQgbm90IGNyZWF0\nZSB0YWJsZSIsIGUpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoc3RtdCAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICAgICAgc3RtdC5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJFcnJvciBjbG9zaW5nIHN0\nYXRlbWVudCIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBNZXNzYWdlU2VxSWQgZ2V0Q3VycmVudFNlcUlkRm9yVG9w\naWMoQnl0ZVN0cmluZyB0b3BpYykgewogICAgICAgIHJldHVybiBlbnN1cmVT\nZXFJZEV4aXN0c0ZvclRvcGljKHRvcGljKTsKICAgIH0KCiAgICBwdWJsaWMg\ndm9pZCBzY2FuU2luZ2xlTWVzc2FnZShTY2FuUmVxdWVzdCByZXF1ZXN0KSB7\nCiAgICAgICAgc2Nhbk1lc3NhZ2VzSW50ZXJuYWwocmVxdWVzdC5nZXRUb3Bp\nYygpLCByZXF1ZXN0LmdldFN0YXJ0U2VxSWQoKSwgMSwgTG9uZy5NQVhfVkFM\nVUUsIHJlcXVlc3QuZ2V0Q2FsbGJhY2soKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZXF1ZXN0LmdldEN0eCgpLCAxKTsKICAgICAgICByZXR1\ncm47CiAgICB9CgogICAgcHVibGljIHZvaWQgc2Nhbk1lc3NhZ2VzKFJhbmdl\nU2NhblJlcXVlc3QgcmVxdWVzdCkgewogICAgICAgIHNjYW5NZXNzYWdlc0lu\ndGVybmFsKHJlcXVlc3QuZ2V0VG9waWMoKSwgcmVxdWVzdC5nZXRTdGFydFNl\ncUlkKCksIHJlcXVlc3QuZ2V0TWVzc2FnZUxpbWl0KCksIHJlcXVlc3QKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0U2l6ZUxpbWl0KCksIHJl\ncXVlc3QuZ2V0Q2FsbGJhY2soKSwgcmVxdWVzdC5nZXRDdHgoKSwgU0NBTl9D\nSFVOSyk7CiAgICAgICAgcmV0dXJuOwogICAgfQoKICAgIHByaXZhdGUgU3Ry\naW5nIGdldFRhYmxlTmFtZUZvclRvcGljKEJ5dGVTdHJpbmcgdG9waWMpIHsK\nICAgICAgICBTdHJpbmcgc3JjID0gKHRvcGljLnRvU3RyaW5nVXRmOCgpICsg\nIl8iICsgdmVyc2lvbik7CiAgICAgICAgdGhyZWFkTG9jYWxEaWdlc3QuZ2V0\nKCkucmVzZXQoKTsKICAgICAgICBieXRlW10gZGlnZXN0ID0gdGhyZWFkTG9j\nYWxEaWdlc3QuZ2V0KCkuZGlnZXN0KHNyYy5nZXRCeXRlcyhVVEZfOCkpOwog\nICAgICAgIEJpZ0ludGVnZXIgYmlnSW50ID0gbmV3IEJpZ0ludGVnZXIoMSxk\naWdlc3QpOwogICAgICAgIHJldHVybiBTdHJpbmcuZm9ybWF0KCJUQUJMRV8l\nMDMyWCIsIGJpZ0ludCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHNjYW5N\nZXNzYWdlc0ludGVybmFsKEJ5dGVTdHJpbmcgdG9waWMsIGxvbmcgc3RhcnRT\nZXFJZCwgaW50IG1lc3NhZ2VMaW1pdCwgbG9uZyBzaXplTGltaXQsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU2NhbkNhbGxiYWNr\nIGNhbGxiYWNrLCBPYmplY3QgY3R4LCBpbnQgc2NhbkNodW5rKSB7CgogICAg\nICAgIENvbm5lY3Rpb24gY29ubiA9IHRocmVhZExvY2FsQ29ubmVjdGlvbi5n\nZXQoKTsKCiAgICAgICAgaWYgKGNvbm4gPT0gbnVsbCkgewogICAgICAgICAg\nICBjYWxsYmFjay5zY2FuRmFpbGVkKGN0eCwgbmV3IFNlcnZpY2VEb3duRXhj\nZXB0aW9uKCJOb3QgY29ubmVjdGVkIHRvIGRlcmJ5IikpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBsb25nIGN1cnJlbnRTZXFJ\nZDsKICAgICAgICBjdXJyZW50U2VxSWQgPSBzdGFydFNlcUlkOwoKICAgICAg\nICBQcmVwYXJlZFN0YXRlbWVudCBzdG10ID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc3RtdCA9IGNv\nbm4ucHJlcGFyZVN0YXRlbWVudCgiU0VMRUNUICogRlJPTSAiICsgZ2V0VGFi\nbGVOYW1lRm9yVG9waWModG9waWMpICsgIiBXSEVSRSAiICsgSURfRklFTERf\nTkFNRQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArICIgPj0gPyAgQU5EICIgKyBJRF9GSUVMRF9OQU1FICsgIiA8PSA/\nIik7CgogICAgICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24gc3FsZSkg\newogICAgICAgICAgICAgICAgU3RyaW5nIHRoZUVycm9yID0gKHNxbGUpLmdl\ndFNRTFN0YXRlKCk7CiAgICAgICAgICAgICAgICBpZiAodGhlRXJyb3IuZXF1\nYWxzKCI0MlgwNSIpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTm8gdGFi\nbGUsIHNjYW4gaXMgb3ZlcgogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNr\nLnNjYW5GaW5pc2hlZChjdHgsIFJlYXNvbkZvckZpbmlzaC5OT19NT1JFX01F\nU1NBR0VTKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IHNx\nbGU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGludCBudW1NZXNzYWdlcyA9IDA7CiAgICAgICAgICAgIGxvbmcgdG90\nYWxTaXplID0gMDsKCiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CgogICAg\nICAgICAgICAgICAgc3RtdC5zZXRMb25nKDEsIGN1cnJlbnRTZXFJZCk7CiAg\nICAgICAgICAgICAgICBzdG10LnNldExvbmcoMiwgY3VycmVudFNlcUlkICsg\nc2NhbkNodW5rKTsKCiAgICAgICAgICAgICAgICBpZiAoIXN0bXQuZXhlY3V0\nZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGVycm9yTXNnID0g\nIlNlbGVjdCBxdWVyeSBkaWQgbm90IHJldHVybiBhIHJlc3VsdCBzZXQiOwog\nICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihlcnJvck1zZyk7CiAg\nICAgICAgICAgICAgICAgICAgc3RtdC5jbG9zZSgpOwogICAgICAgICAgICAg\nICAgICAgIGNhbGxiYWNrLnNjYW5GYWlsZWQoY3R4LCBuZXcgU2VydmljZURv\nd25FeGNlcHRpb24oZXJyb3JNc2cpKTsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgUmVz\ndWx0U2V0IHJlc3VsdFNldCA9IHN0bXQuZ2V0UmVzdWx0U2V0KCk7CgogICAg\nICAgICAgICAgICAgaWYgKCFyZXN1bHRTZXQubmV4dCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgc3RtdC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAg\nIGNhbGxiYWNrLnNjYW5GaW5pc2hlZChjdHgsIFJlYXNvbkZvckZpbmlzaC5O\nT19NT1JFX01FU1NBR0VTKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZG8gewoKICAg\nICAgICAgICAgICAgICAgICBsb25nIGxvY2FsU2VxSWQgPSByZXN1bHRTZXQu\nZ2V0TG9uZygxKTsKCiAgICAgICAgICAgICAgICAgICAgTWVzc2FnZS5CdWls\nZGVyIG1lc3NhZ2VCdWlsZGVyID0gTWVzc2FnZS5uZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKHJlc3VsdFNldC5nZXRCaW5hcnlTdHJlYW0oMikpOwoKICAgICAg\nICAgICAgICAgICAgICAvLyBNZXJnZSBpbiB0aGUgbG9jYWwgc2VxLWlkIHNp\nbmNlIHRoYXQgaXMgbm90IHN0b3JlZCB3aXRoCiAgICAgICAgICAgICAgICAg\nICAgLy8gdGhlIG1lc3NhZ2UKICAgICAgICAgICAgICAgICAgICBNZXNzYWdl\nIG1lc3NhZ2UgPSBNZXNzYWdlSWRVdGlscy5tZXJnZUxvY2FsU2VxSWQobWVz\nc2FnZUJ1aWxkZXIsIGxvY2FsU2VxSWQpOwoKICAgICAgICAgICAgICAgICAg\nICBjYWxsYmFjay5tZXNzYWdlU2Nhbm5lZChjdHgsIG1lc3NhZ2UpOwogICAg\nICAgICAgICAgICAgICAgIG51bU1lc3NhZ2VzKys7CiAgICAgICAgICAgICAg\nICAgICAgdG90YWxTaXplICs9IG1lc3NhZ2UuZ2V0Qm9keSgpLnNpemUoKTsK\nCiAgICAgICAgICAgICAgICAgICAgaWYgKG51bU1lc3NhZ2VzID4gbWVzc2Fn\nZUxpbWl0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0bXQuY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2suc2NhbkZpbmlz\naGVkKGN0eCwgUmVhc29uRm9yRmluaXNoLk5VTV9NRVNTQUdFU19MSU1JVF9F\nWENFRURFRCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRvdGFsU2l6ZSA+IHNpemVM\naW1pdCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdG10LmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLnNjYW5GaW5pc2hl\nZChjdHgsIFJlYXNvbkZvckZpbmlzaC5TSVpFX0xJTUlUX0VYQ0VFREVEKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICB9IHdoaWxlIChyZXN1bHRTZXQu\nbmV4dCgpKTsKCiAgICAgICAgICAgICAgICBjdXJyZW50U2VxSWQgKz0gU0NB\nTl9DSFVOSzsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFNRTEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiU1FMIEV4\nY2VwdGlvbiIsIGUpOwogICAgICAgICAgICBjYWxsYmFjay5zY2FuRmFpbGVk\nKGN0eCwgbmV3IFNlcnZpY2VEb3duRXhjZXB0aW9uKGUpKTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJNZXNzYWdlIHN0b3JlZCBpbiBk\nZXJieSBpcyBub3QgcGFyc2VhYmxlIiwgZSk7CiAgICAgICAgICAgIGNhbGxi\nYWNrLnNjYW5GYWlsZWQoY3R4LCBuZXcgU2VydmljZURvd25FeGNlcHRpb24o\nZSkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBmaW5hbGx5IHsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChzdG10ICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBzdG10LmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKFNRTEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkVycm9y\nIGNsb3Npbmcgc3RhdGVtZW50IiwgZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgcHVibGljIHZvaWQgZGVsaXZlcmVkVW50aWwoQnl0\nZVN0cmluZyB0b3BpYywgTG9uZyBzZXFJZCkgewogICAgICAgIC8vIG5vb3AK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb25zdW1lZFVudGlsKEJ5dGVTdHJp\nbmcgdG9waWMsIExvbmcgc2VxSWQpIHsKICAgICAgICBDb25uZWN0aW9uIGNv\nbm4gPSB0aHJlYWRMb2NhbENvbm5lY3Rpb24uZ2V0KCk7CiAgICAgICAgaWYg\nKGNvbm4gPT0gbnVsbCkgewogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIk5v\ndCBjb25uZWN0ZWQgdG8gZGVyYnkiKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KICAgICAgICBQcmVwYXJlZFN0YXRlbWVudCBzdG10ID0gbnVs\nbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBzdG10ID0gY29ubi5wcmVw\nYXJlU3RhdGVtZW50KCJERUxFVEUgRlJPTSAiICsgZ2V0VGFibGVOYW1lRm9y\nVG9waWModG9waWMpICsgIiBXSEVSRSAiICsgSURfRklFTERfTkFNRQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiA8PSA/\nIik7CiAgICAgICAgICAgIHN0bXQuc2V0TG9uZygxLCBzZXFJZCk7CiAgICAg\nICAgICAgIGludCByb3dDb3VudCA9IHN0bXQuZXhlY3V0ZVVwZGF0ZSgpOwog\nICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAg\nICAgICAgICAgICBsb2dnZXIuZGVidWcoIkRlbGV0ZWQgIiArIHJvd0NvdW50\nICsgIiByZWNvcmRzIGZvciB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpCiAgICAgICAgICAgICAgICAgICsgIiwgc2VxSWQ6ICIgKyBzZXFJZCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChTUUxFeGNlcHRpb24g\nc3FsZSkgewogICAgICAgICAgICBTdHJpbmcgdGhlRXJyb3IgPSAoc3FsZSku\nZ2V0U1FMU3RhdGUoKTsKICAgICAgICAgICAgaWYgKHRoZUVycm9yLmVxdWFs\ncygiNDJYMDUiKSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oIlRh\nYmxlIGZvciB0b3BpYyAoIiArIHRvcGljICsgIikgZG9lcyBub3QgZXhpc3Qg\nc28gbm8gY29uc3VtZWQgbWVzc2FnZXMgdG8gZGVsZXRlISIpOwogICAgICAg\nICAgICB9IGVsc2UKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRXJy\nb3Igd2hpbGUgZXhlY3V0aW5nIGRlcmJ5IGRlbGV0ZSBmb3IgY29uc3VtZWQg\nbWVzc2FnZXMiLCBzcWxlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHN0bXQgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgIHN0bXQuY2xvc2UoKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoU1FMRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRXJyb3IgY2xvc2lu\nZyBzdGF0ZW1lbnQiLCBlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRNZXNzYWdlQm91bmQoQnl0ZVN0cmlu\nZyB0b3BpYywgSW50ZWdlciBib3VuZCkgewogICAgICAgIC8vIG5vb3A7IE1h\neWJlIGltcGxlbWVudCBsYXRlcgogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNs\nZWFyTWVzc2FnZUJvdW5kKEJ5dGVTdHJpbmcgdG9waWMpIHsKICAgICAgICAv\nLyBub29wOyBNYXliZSBpbXBsZW1lbnQgbGF0ZXIKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBjb25zdW1lVG9Cb3VuZChCeXRlU3RyaW5nIHRvcGljKSB7CiAg\nICAgICAgLy8gbm9vcDsgTWF5YmUgaW1wbGVtZW50IGxhdGVyCiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCBmaW5hbGl6ZSgpIHRo\ncm93cyBUaHJvd2FibGUgewogICAgICAgIGlmIChkcml2ZXIuZXF1YWxzKCJv\ncmcuYXBhY2hlLmRlcmJ5LmpkYmMuRW1iZWRkZWREcml2ZXIiKSkgewogICAg\nICAgICAgICBib29sZWFuIGdvdFNRTEV4YyA9IGZhbHNlOwogICAgICAgICAg\nICAvLyBUaGlzIGlzIHdlaXJkOiBvbiBub3JtYWwgc2h1dGRvd24sIGl0IHRo\ncm93cyBhbiBleGNlcHRpb24KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIERyaXZlck1hbmFnZXIuZ2V0Q29ubmVjdGlvbigiamRiYzpkZXJi\neTo7c2h1dGRvd249dHJ1ZSIpLmNsb3NlKCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKFNRTEV4Y2VwdGlvbiBzZSkgewogICAgICAgICAgICAgICAgaWYgKHNl\nLmdldFNRTFN0YXRlKCkuZXF1YWxzKCJYSjAxNSIpKSB7CiAgICAgICAgICAg\nICAgICAgICAgZ290U1FMRXhjID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIWdvdFNRTEV4Yykgewog\nICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJEYXRhYmFzZSBkaWQgbm90\nIHNodXQgZG93biBub3JtYWxseSIpOwogICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkRhdGFiYXNlIHNodXQgZG93\nbiBub3JtYWxseSIpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg\nIHN1cGVyLmZpbmFsaXplKCk7CiAgICB9CgogICAgcHVibGljIHZvaWQgcmVz\nZXQoKSB7CiAgICAgICAgLy8ganVzdCBtb3ZlIHRoZSBuYW1lc3BhY2Ugb3Zl\nciB0byB0aGUgbmV4dCBvbmUKICAgICAgICB2ZXJzaW9uKys7CiAgICAgICAg\nY3VyclRvcGljU2VxSWRzLmNsZWFyKCk7CiAgICB9Cn0K\n","encoding":"base64"}

