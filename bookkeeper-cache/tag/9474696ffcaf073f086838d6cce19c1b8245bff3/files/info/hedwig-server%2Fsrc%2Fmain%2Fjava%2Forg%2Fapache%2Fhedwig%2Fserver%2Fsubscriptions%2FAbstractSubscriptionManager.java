{"sha":"0dcbe3925472444a0d3c77574a20dce878cfb35d","node_id":"MDQ6QmxvYjE1NzU5NTY6MGRjYmUzOTI1NDcyNDQ0YTBkM2M3NzU3NGEyMGRjZTg3OGNmYjM1ZA==","size":38222,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0dcbe3925472444a0d3c77574a20dce878cfb35d","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuc3Vic2NyaXB0aW9uczsK\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLk1hcDsKaW1wb3J0IGphdmEudXRpbC5NYXAuRW50cnk7CmltcG9ydCBqYXZh\nLnV0aWwuVGltZXI7CmltcG9ydCBqYXZhLnV0aWwuVGltZXJUYXNrOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5MaW5rZWRCbG9ja2luZ1F1ZXVl\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0\nb3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWlj\nLkF0b21pY0ludGVnZXI7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb25lZDsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdDsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmlwdGlvbkRhdGE7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25QcmVmZXJlbmNl\nczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbkV2ZW50OwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9leHRlbnNpb25zLk1lc3NhZ2VJ\nZFV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9leHRlbnNp\nb25zLlN1YnNjcmlwdGlvblN0YXRlVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlRvcGljT3BR\ndWV1ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuZGVsaXZl\ncnkuRGVsaXZlcnlNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\nc2VydmVyLnBlcnNpc3RlbmNlLlBlcnNpc3RlbmNlTWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci50b3BpY3MuVG9waWNNYW5hZ2Vy\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnRvcGljcy5Ub3Bp\nY093bmVyc2hpcENoYW5nZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcudXRpbC5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnV0aWwuQ2FsbGJhY2tVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnV0aWwuQ29uY3VycmVuY3lVdGlsczsKCnB1YmxpYyBhYnN0cmFjdCBjbGFz\ncyBBYnN0cmFjdFN1YnNjcmlwdGlvbk1hbmFnZXIgaW1wbGVtZW50cyBTdWJz\nY3JpcHRpb25NYW5hZ2VyLCBUb3BpY093bmVyc2hpcENoYW5nZUxpc3RlbmVy\nIHsKCiAgICBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3Rvcnku\nZ2V0TG9nZ2VyKEFic3RyYWN0U3Vic2NyaXB0aW9uTWFuYWdlci5jbGFzcyk7\nCgogICAgcHJvdGVjdGVkIGZpbmFsIFNlcnZlckNvbmZpZ3VyYXRpb24gY2Zn\nOwogICAgcHJvdGVjdGVkIGZpbmFsIENvbmN1cnJlbnRIYXNoTWFwPEJ5dGVT\ndHJpbmcsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0\nYXRlPj4gdG9wMnN1YjJzZXEgPQogICAgICBuZXcgQ29uY3VycmVudEhhc2hN\nYXA8Qnl0ZVN0cmluZywgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2Ny\naXB0aW9uU3RhdGU+PigpOwogICAgcHJvdGVjdGVkIGZpbmFsIFRvcGljT3BR\ndWV1ZXIgcXVldWVyOwogICAgcHJpdmF0ZSBmaW5hbCBBcnJheUxpc3Q8U3Vi\nc2NyaXB0aW9uRXZlbnRMaXN0ZW5lcj4gbGlzdGVuZXJzID0gbmV3IEFycmF5\nTGlzdDxTdWJzY3JpcHRpb25FdmVudExpc3RlbmVyPigpOwoKICAgIC8vIEhh\nbmRsZSB0byB0aGUgRGVsaXZlcnlNYW5hZ2VyIGZvciB0aGUgc2VydmVyIHNv\nIHdlIGNhbiBzdG9wIHNlcnZpbmcgc3Vic2NyaWJlcnMKICAgIC8vIHdoZW4g\nbG9zaW5nIHRvcGljcwogICAgcHJpdmF0ZSBmaW5hbCBEZWxpdmVyeU1hbmFn\nZXIgZG07CiAgICAvLyBIYW5kbGUgdG8gdGhlIFBlcnNpc3RlbmNlTWFuYWdl\nciBmb3IgdGhlIHNlcnZlciBzbyB3ZSBjYW4gcGFzcyBhbG9uZyB0aGUKICAg\nIC8vIG1lc3NhZ2UgY29uc3VtZSBwb2ludGVycyBmb3IgZWFjaCB0b3BpYy4K\nICAgIHByaXZhdGUgZmluYWwgUGVyc2lzdGVuY2VNYW5hZ2VyIHBtOwogICAg\nLy8gVGltZXIgZm9yIHJ1bm5pbmcgYSByZWN1cnJpbmcgdGhyZWFkIHRhc2sg\ndG8gZ2V0IHRoZSBtaW5pbXVtIG1lc3NhZ2UKICAgIC8vIHNlcXVlbmNlIElE\nIGZvciBlYWNoIHRvcGljIHRoYXQgYWxsIHN1YnNjcmliZXJzIGZvciBpdCBo\nYXZlIGNvbnN1bWVkCiAgICAvLyBhbHJlYWR5LiBXaXRoIHRoYXQgaW5mb3Jt\nYXRpb24sIHdlIGNhbiBjYWxsIHRoZSBQZXJzaXN0ZW5jZU1hbmFnZXIgdG8K\nICAgIC8vIHVwZGF0ZSBpdCBvbiB0aGUgbWVzc2FnZXMgdGhhdCBhcmUgc2Fm\nZSB0byBiZSBnYXJiYWdlIGNvbGxlY3RlZC4KICAgIHByaXZhdGUgZmluYWwg\nVGltZXIgdGltZXIgPSBuZXcgVGltZXIodHJ1ZSk7CiAgICAvLyBJbiBtZW1v\ncnkgbWFwcGluZyBvZiB0b3BpY3MgdG8gdGhlIG1pbmltdW0gY29uc3VtZWQg\nbWVzc2FnZSBzZXF1ZW5jZSBJRAogICAgLy8gZm9yIGFsbCBzdWJzY3JpYmVy\ncyB0byB0aGUgdG9waWMuCiAgICBwcml2YXRlIGZpbmFsIENvbmN1cnJlbnRI\nYXNoTWFwPEJ5dGVTdHJpbmcsIExvbmc+IHRvcGljMk1pbkNvbnN1bWVkTWVz\nc2FnZXNNYXAgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8Qnl0ZVN0cmluZywg\nTG9uZz4oKTsKCiAgICBwcm90ZWN0ZWQgZmluYWwgQ2FsbGJhY2s8Vm9pZD4g\nbm9vcENhbGxiYWNrID0gbmV3IE5vb3BDYWxsYmFjazxWb2lkPigpOwoKICAg\nIHN0YXRpYyBjbGFzcyBOb29wQ2FsbGJhY2s8VD4gaW1wbGVtZW50cyBDYWxs\nYmFjazxUPiB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlv\nbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgbG9nZ2VyLndhcm4oIkV4Y2Vw\ndGlvbiBmb3VuZCBpbiBBYnN0cmFjdFN1YnNjcmlwdGlvbk1hbmFnZXIgOiAi\nLCBleGNlcHRpb24pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQg\nb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVCByZXN1bHRPZk9wZXJh\ndGlvbikgewogICAgICAgIH07CiAgICB9CgogICAgcHVibGljIEFic3RyYWN0\nU3Vic2NyaXB0aW9uTWFuYWdlcihTZXJ2ZXJDb25maWd1cmF0aW9uIGNmZywg\nVG9waWNNYW5hZ2VyIHRtLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBQZXJzaXN0ZW5jZU1hbmFnZXIgcG0sIERlbGl2ZXJ5TWFu\nYWdlciBkbSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxlcikgewogICAg\nICAgIHRoaXMuY2ZnID0gY2ZnOwogICAgICAgIHF1ZXVlciA9IG5ldyBUb3Bp\nY09wUXVldWVyKHNjaGVkdWxlcik7CiAgICAgICAgdG0uYWRkVG9waWNPd25l\ncnNoaXBDaGFuZ2VMaXN0ZW5lcih0aGlzKTsKICAgICAgICB0aGlzLnBtID0g\ncG07CiAgICAgICAgdGhpcy5kbSA9IGRtOwogICAgICAgIC8vIFNjaGVkdWxl\nIHRoZSByZWN1cnJpbmcgTWVzc2FnZXNDb25zdW1lZFRhc2sgb25seSBpZiBh\nCiAgICAgICAgLy8gUGVyc2lzdGVuY2VNYW5hZ2VyIGlzIHBhc3NlZC4KICAg\nICAgICBpZiAocG0gIT0gbnVsbCkgewogICAgICAgICAgICB0aW1lci5zY2hl\nZHVsZShuZXcgTWVzc2FnZXNDb25zdW1lZFRhc2soKSwgMCwgY2ZnLmdldE1l\nc3NhZ2VzQ29uc3VtZWRUaHJlYWRSdW5JbnRlcnZhbCgpKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGlzIHRoZSBUaW1lciBUYXNr\nIGZvciBmaW5kaW5nIG91dCBmb3IgZWFjaCB0b3BpYywgd2hhdCB0aGUgbWlu\naW11bQogICAgICogY29uc3VtZWQgbWVzc2FnZSBieSB0aGUgc3Vic2NyaWJl\ncnMgYXJlLiBUaGlzIGluZm9ybWF0aW9uIGlzIHVzZWQgdG8gcGFzcwogICAg\nICogYWxvbmcgdG8gdGhlIHNlcnZlcidzIFBlcnNpc3RlbmNlTWFuYWdlciBz\nbyBpdCBjYW4gZ2FyYmFnZSBjb2xsZWN0IG9sZGVyCiAgICAgKiB0b3BpYyBt\nZXNzYWdlcyB0aGF0IGFyZSBubyBsb25nZXIgbmVlZGVkIGJ5IHRoZSBzdWJz\nY3JpYmVycy4KICAgICAqLwogICAgY2xhc3MgTWVzc2FnZXNDb25zdW1lZFRh\nc2sgZXh0ZW5kcyBUaW1lclRhc2sgewogICAgICAgIC8qKgogICAgICAgICAq\nIEltcGxlbWVudCB0aGUgVGltZXJUYXNrJ3MgYWJzdHJhY3QgcnVuIG1ldGhv\nZC4KICAgICAgICAgKi8KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIC8vIFdlIGFyZSBsb29waW5n\nIHRocm91Z2ggcmVsYXRpdmVseSBzbWFsbCBpbiBtZW1vcnkgZGF0YSBzdHJ1\nY3R1cmVzCiAgICAgICAgICAgIC8vIHNvIGl0IHNob3VsZCBiZSBzYWZlIHRv\nIHJ1biB0aGlzIGZhaXJseSBvZnRlbi4KICAgICAgICAgICAgZm9yIChCeXRl\nU3RyaW5nIHRvcGljIDogdG9wMnN1YjJzZXEua2V5U2V0KCkpIHsKICAgICAg\nICAgICAgICAgIGZpbmFsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNj\ncmlwdGlvblN0YXRlPiB0b3BpY1N1YnNjcmlwdGlvbnMgPSB0b3Ayc3ViMnNl\ncS5nZXQodG9waWMpOwogICAgICAgICAgICAgICAgaWYgKHRvcGljU3Vic2Ny\naXB0aW9ucyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbG9uZyBt\naW5Db25zdW1lZE1lc3NhZ2UgPSBMb25nLk1BWF9WQUxVRTsKICAgICAgICAg\nICAgICAgIGJvb2xlYW4gaGFzQm91bmQgPSB0cnVlOwogICAgICAgICAgICAg\nICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBzdWJzY3JpYmVycyBvbiB0aGUgY3Vy\ncmVudCB0b3BpYyB0byBmaW5kIHRoZQogICAgICAgICAgICAgICAgLy8gbWlu\naW11bSBwZXJzaXN0ZWQgbWVzc2FnZSBpZC4gVGhlIHJlYXNvbiBub3QgdXNp\nbmcgaW4tbWVtb3J5CiAgICAgICAgICAgICAgICAvLyBjb25zdW1lZCBtZXNz\nYWdlIGlkIGlzIExlZGdlclJhbmdzIGFuZCBJbk1lbW9yeVN1YnNjcmlwdGlv\nblN0YXRlCiAgICAgICAgICAgICAgICAvLyBtYXkgYmUgaW5jb25zaXN0ZW50\nIGluIGNhc2Ugb2YgYSBzZXJ2ZXIgY3Jhc2guCiAgICAgICAgICAgICAgICBm\nb3IgKEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGUgY3VyU3Vic2NyaXB0aW9u\nIDogdG9waWNTdWJzY3JpcHRpb25zLnZhbHVlcygpKSB7CiAgICAgICAgICAg\nICAgICAgICAgaWYgKGN1clN1YnNjcmlwdGlvbi5nZXRMYXN0UGVyc2lzdGVk\nU2VxSWQoKSA8IG1pbkNvbnN1bWVkTWVzc2FnZSkgewogICAgICAgICAgICAg\nICAgICAgICAgICBtaW5Db25zdW1lZE1lc3NhZ2UgPSBjdXJTdWJzY3JpcHRp\nb24uZ2V0TGFzdFBlcnNpc3RlZFNlcUlkKCk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIGhhc0JvdW5kID0gaGFzQm91bmQg\nJiYgY3VyU3Vic2NyaXB0aW9uLmdldFN1YnNjcmlwdGlvblByZWZlcmVuY2Vz\nKCkuaGFzTWVzc2FnZUJvdW5kKCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBib29sZWFuIGNhbGxQZXJzaXN0ZW5jZU1hbmFnZXIgPSB0\ncnVlOwogICAgICAgICAgICAgICAgLy8gQ2FsbCB0aGUgUGVyc2lzdGVuY2VN\nYW5hZ2VyIGlmIG5vYm9keSBzdWJzY3JpYmVzIHRvIHRoZSB0b3BpYwogICAg\nICAgICAgICAgICAgLy8geWV0LCBvciB0aGUgY29uc3VtZSBwb2ludGVyIGhh\ncyBtb3ZlZCBhaGVhZCBzaW5jZSB0aGUgbGFzdAogICAgICAgICAgICAgICAg\nLy8gdGltZSwgb3IgaWYgdGhpcyBpcyB0aGUgaW5pdGlhbCBzdWJzY3JpcHRp\nb24uCiAgICAgICAgICAgICAgICBMb25nIG1pbkNvbnN1bWVkRnJvbU1hcCA9\nIHRvcGljMk1pbkNvbnN1bWVkTWVzc2FnZXNNYXAuZ2V0KHRvcGljKTsKICAg\nICAgICAgICAgICAgIGlmICh0b3BpY1N1YnNjcmlwdGlvbnMuaXNFbXB0eSgp\nCiAgICAgICAgICAgICAgICAgICAgfHwgKG1pbkNvbnN1bWVkRnJvbU1hcCAh\nPSBudWxsICYmIG1pbkNvbnN1bWVkRnJvbU1hcCA8IG1pbkNvbnN1bWVkTWVz\nc2FnZSkKICAgICAgICAgICAgICAgICAgICB8fCAobWluQ29uc3VtZWRGcm9t\nTWFwID09IG51bGwgJiYgbWluQ29uc3VtZWRNZXNzYWdlICE9IDApKSB7CiAg\nICAgICAgICAgICAgICAgICAgLy8gUmVwbGFjZSBvciBwdXQgdGhlIG5ldyBt\naW4gY29uc3VtZWQgdmFsdWUuIElmIGl0IGhhcyBjaGFuZ2VkCiAgICAgICAg\nICAgICAgICAgICAgLy8gZG8gbm90aGluZywgYXMgYW5vdGhlciB0aHJlYWQg\naGFzIHVwZGF0ZWQgdGhlIG1pbiBjb25zdW1lZCBtZXNzYWdlCiAgICAgICAg\nICAgICAgICAgICAgaWYgKChtaW5Db25zdW1lZEZyb21NYXAgIT0gbnVsbAog\nICAgICAgICAgICAgICAgICAgICAgICAgJiYgKHRvcGljMk1pbkNvbnN1bWVk\nTWVzc2FnZXNNYXAucmVwbGFjZSh0b3BpYywgbWluQ29uc3VtZWRGcm9tTWFw\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBtaW5Db25zdW1lZE1lc3NhZ2UpKSkK\nICAgICAgICAgICAgICAgICAgICAgICAgfHwgKHRvcGljMk1pbkNvbnN1bWVk\nTWVzc2FnZXNNYXAucHV0SWZBYnNlbnQodG9waWMsIG1pbkNvbnN1bWVkTWVz\nc2FnZSkgPT0gbnVsbCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG0u\nY29uc3VtZWRVbnRpbCh0b3BpYywgbWluQ29uc3VtZWRNZXNzYWdlKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKGhhc0JvdW5kKSB7CiAgICAgICAgICAgICAgICAgICAgcG0uY29uc3VtZVRv\nQm91bmQodG9waWMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgY2xhc3MgQWNxdWlyZU9w\nIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hyb25vdXNPcDxWb2lkPiB7\nCiAgICAgICAgcHVibGljIEFjcXVpcmVPcChCeXRlU3RyaW5nIHRvcGljLCBD\nYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAg\nICAgICBxdWV1ZXIuc3VwZXIodG9waWMsIGNhbGxiYWNrLCBjdHgpOwogICAg\nICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgICAgICBpZiAodG9wMnN1YjJzZXEuY29udGFpbnNL\nZXkodG9waWMpKSB7CiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5p\nc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICByZWFkU3Vic2NyaXB0aW9ucyh0b3Bp\nYywgbmV3IENhbGxiYWNrPE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNj\ncmlwdGlvblN0YXRlPj4oKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChP\nYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAg\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0\naW9uKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZp\nbmlzaGVkKGZpbmFsIE9iamVjdCBjdHgsCiAgICAgICAgICAgICAgICBmaW5h\nbCBNYXA8Qnl0ZVN0cmluZywgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZT4g\ncmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAvLyBX\nZSd2ZSBqdXN0IGluaGVyaXRlZCBhIGJ1bmNoIG9mIHN1YnNjcmliZXIgZm9y\nIHRoaXMKICAgICAgICAgICAgICAgICAgICAvLyB0b3BpYywgc29tZSBvZiB3\naGljaCBtYXkgYmUgbG9jYWwuIElmIHRoZXkgYXJlLCB0aGVuIHdlCiAgICAg\nICAgICAgICAgICAgICAgLy8gbmVlZCB0byAoMSkgbm90aWZ5IGxpc3RlbmVy\ncyBvZiB0aGlzIGFuZCAoMikgcmVjb3JkIHRoZQogICAgICAgICAgICAgICAg\nICAgIC8vIG51bWJlciBmb3IgYm9va2tlZXBpbmcgc28gdGhhdCBmdXR1cmUK\nICAgICAgICAgICAgICAgICAgICAvLyBzdWJzY3JpYmVzL3Vuc3Vic2NyaWJl\ncyBjYW4gZWZmaWNpZW50bHkgbm90aWZ5IGxpc3RlbmVycy4KCiAgICAgICAg\nICAgICAgICAgICAgLy8gVGhlIGZpbmFsICJjb21taXQiIChhbmQgImFib3J0\nIikgb3BlcmF0aW9ucy4KICAgICAgICAgICAgICAgICAgICBmaW5hbCBDYWxs\nYmFjazxWb2lkPiBjYjIgPSBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CgogICAg\nICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBj\ndHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiU3Vic2NyaXB0aW9uIG1h\nbmFnZXIgZmFpbGVkIHRvIGFjcXVpcmVkIHRvcGljICIgKyB0b3BpYy50b1N0\ncmluZ1V0ZjgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBleGNlcHRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHZvaWRPYmopIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDJzdWIyc2VxLnB1dCh0b3Bp\nYywgcmVzdWx0T2ZPcGVyYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmluZm8oIlN1YnNjcmlwdGlvbiBtYW5hZ2VyIHN1Y2Nl\nc3NmdWxseSBhY3F1aXJlZCB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlv\nbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAg\nICAgLy8gTm90aWZ5IGxpc3RlbmVycyBpZiBuZWNlc3NhcnkuCiAgICAgICAg\nICAgICAgICAgICAgaWYgKGhhc0xvY2FsU3Vic2NyaXB0aW9ucyhyZXN1bHRP\nZk9wZXJhdGlvbikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZ5\nRmlyc3RMb2NhbFN1YnNjcmliZSh0b3BpYywgZmFsc2UsIGNiMiwgY3R4KTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICBjYjIub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHVwZGF0\nZU1lc3NhZ2VCb3VuZCh0b3BpYyk7CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICB9LCBjdHgpOwoKICAgICAgICB9CgogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBub3RpZnlGaXJzdExvY2FsU3Vic2NyaWJlKEJ5dGVTdHJpbmcg\ndG9waWMsIGJvb2xlYW4gc3luY2hyb25vdXMsIGZpbmFsIENhbGxiYWNrPFZv\naWQ+IGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgQ2FsbGJhY2s8\nVm9pZD4gbWNiID0gQ2FsbGJhY2tVdGlscy5tdWx0aUNhbGxiYWNrKGxpc3Rl\nbmVycy5zaXplKCksIGNiLCBjdHgpOwogICAgICAgIGZvciAoU3Vic2NyaXB0\naW9uRXZlbnRMaXN0ZW5lciBsaXN0ZW5lciA6IGxpc3RlbmVycykgewogICAg\nICAgICAgICBsaXN0ZW5lci5vbkZpcnN0TG9jYWxTdWJzY3JpYmUodG9waWMs\nIHN5bmNocm9ub3VzLCBtY2IpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIEZpZ3VyZSBvdXQgd2hvIGlzIHN1YnNjcmliZWQuIERvIG5vdGhp\nbmcgaWYgYWxyZWFkeSBhY3F1aXJlZC4gSWYgdGhlcmUncwogICAgICogYW4g\nZXJyb3IgcmVhZGluZyB0aGUgc3Vic2NyaWJlcnMnIHNlcXVlbmNlIElEcywg\ndGhlbiB0aGUgdG9waWMgaXMgbm90CiAgICAgKiBhY3F1aXJlZC4KICAgICAq\nCiAgICAgKiBAcGFyYW0gdG9waWMKICAgICAqIEBwYXJhbSBjYWxsYmFjawog\nICAgICogQHBhcmFtIGN0eAogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIGFjcXVpcmVkVG9waWMoZmluYWwgQnl0ZVN0cmluZyB0b3Bp\nYywgZmluYWwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjdHgp\nIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcg\nQWNxdWlyZU9wKHRvcGljLCBjYWxsYmFjaywgY3R4KSk7CiAgICB9CgogICAg\nY2xhc3MgUmVsZWFzZU9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hy\nb25vdXNPcDxWb2lkPiB7CgogICAgICAgIHB1YmxpYyBSZWxlYXNlT3AoZmlu\nYWwgQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgQ2FsbGJhY2s8Vm9pZD4gY2Is\nIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVyKHRvcGlj\nLCBjYiwgY3R4KTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgQ2FsbGJhY2s8\nVm9pZD4gZmluYWxDYiA9IG5ldyBDYWxsYmFjazxWb2lkPigpIHsKICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCByZXN1bHRP\nZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZv\nKCJGaW5pc2hlZCB1cGRhdGUgc3Vic2NyaXB0aW9uIHN0YXRlcyB3aGVuIGxv\nc3RpbmcgdG9waWMgIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nIHRvcGljLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAgICAgICAgICBm\naW5pc2goKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkZhaWxlZChPYmplY3QgY3R4LAogICAgICAgICAgICAgICAgICAgICAgICBQ\ndWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAg\nICAgbG9nZ2VyLndhcm4oIkVycm9yIHdoZW4gcmVsZWFzaW5nIHRvcGljIDog\nIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBleGNlcHRpb24pOwogICAgICAg\nICAgICAgICAgICAgIGZpbmlzaCgpOwogICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgIHByaXZhdGUgdm9pZCBmaW5pc2goKSB7CiAgICAgICAg\nICAgICAgICAgICAgLy8gdGVsbCBkZWxpdmVyeSBtYW5hZ2VyIHRvIHN0b3Ag\nZGVsaXZlcnkgZm9yIHN1YnNjcmlwdGlvbnMgb2YgdGhpcyB0b3BpYwogICAg\nICAgICAgICAgICAgICAgIGZpbmFsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9y\neVN1YnNjcmlwdGlvblN0YXRlPiB0b3BpY1N1YnNjcmlwdGlvbnMgPSB0b3Ay\nc3ViMnNlcS5yZW1vdmUodG9waWMpOwogICAgICAgICAgICAgICAgICAgIC8v\nIG5vIHN1YnNjcmlwdGlvbnMgbm93LCBpdCBtYXkgYmUgcmVtb3ZlZCBieSBv\ndGhlciByZWxlYXNlIG9wcwogICAgICAgICAgICAgICAgICAgIGlmIChudWxs\nICE9IHRvcGljU3Vic2NyaXB0aW9ucykgewogICAgICAgICAgICAgICAgICAg\nICAgICBmb3IgKEJ5dGVTdHJpbmcgc3ViSWQgOiB0b3BpY1N1YnNjcmlwdGlv\nbnMua2V5U2V0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiU3RvcCBzZXJ2aW5nIHN1\nYnNjcmliZXIgKCIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsICIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgc3Vi\nSWQudG9TdHJpbmdVdGY4KCkgKyAiKSB3aGVuIGxvc2luZyB0b3BpYyIpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKG51bGwgIT0gZG0pIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBkbS5zdG9wU2VydmluZ1N1YnNjcmliZXIodG9w\naWMsIHN1YklkLCBTdWJzY3JpcHRpb25FdmVudC5UT1BJQ19NT1ZFRCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbm9vcENhbGxiYWNrLCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAobG9n\nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgbG9nZ2VyLmRlYnVnKCJTdG9wIHNlcnZpbmcgdG9waWMgIiArIHRvcGlj\nLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgLy8gU2luY2Ugd2UgZGVjcmVtZW50IGxvY2FsIGNv\ndW50IHdoZW4gc29tZSBvZiByZW1vdGUgc3Vic2NyaXB0aW9ucyBmYWlsZWQs\nCiAgICAgICAgICAgICAgICAgICAgLy8gd2hpbGUgd2UgZG9uJ3QgdW5zdWJz\nY3JpYmUgdGhvc2Ugc3VjY2VlZCBzdWJzY3JpcHRpb25zLiBzbyB3ZSBjYW4n\ndCBkZXBlbmRzCiAgICAgICAgICAgICAgICAgICAgLy8gb24gbG9jYWwgY291\nbnQsIGp1c3QgdHJ5IHRvIG5vdGlmeSB1bnN1YnNjcmliZS4KICAgICAgICAg\nICAgICAgICAgICBub3RpZnlMYXN0TG9jYWxVbnN1YnNjcmliZSh0b3BpYyk7\nCiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4\nLCBudWxsKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAg\nICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAg\nICAgICAgICAgICBsb2dnZXIuZGVidWcoIlRyeSB0byB1cGRhdGUgc3Vic2Ny\naXB0aW9uIHN0YXRlcyB3aGVuIGxvc2luZyB0b3BpYyAiICsgdG9waWMudG9T\ndHJpbmdVdGY4KCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHVwZGF0\nZVN1YnNjcmlwdGlvblN0YXRlcyh0b3BpYywgZmluYWxDYiwgY3R4KTsKICAg\nICAgICB9CiAgICB9CgogICAgdm9pZCB1cGRhdGVTdWJzY3JpcHRpb25TdGF0\nZXMoQnl0ZVN0cmluZyB0b3BpYywgQ2FsbGJhY2s8Vm9pZD4gZmluYWxDYiwg\nT2JqZWN0IGN0eCkgewogICAgICAgIC8vIFRyeSB0byB1cGRhdGUgc3Vic2Ny\naXB0aW9uIHN0YXRlcyBvZiBhIHNwZWNpZmllZCB0b3BpYwogICAgICAgIE1h\ncDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlPiBzdGF0\nZXMgPSB0b3Ayc3ViMnNlcS5nZXQodG9waWMpOwogICAgICAgIGlmIChudWxs\nID09IHN0YXRlcykgewogICAgICAgICAgICBmaW5hbENiLm9wZXJhdGlvbkZp\nbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgQ2FsbGJhY2s8Vm9pZD4gbWNiID0gQ2FsbGJhY2tVdGlscy5tdWx0aUNh\nbGxiYWNrKHN0YXRlcy5zaXplKCksIGZpbmFsQ2IsIGN0eCk7CiAgICAgICAg\nICAgIGZvciAoRW50cnk8Qnl0ZVN0cmluZywgSW5NZW1vcnlTdWJzY3JpcHRp\nb25TdGF0ZT4gZW50cnkgOiBzdGF0ZXMuZW50cnlTZXQoKSkgewogICAgICAg\nICAgICAgICAgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSBtZW1TdGF0ZSA9\nIGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAobWVtU3Rh\ndGUuc2V0TGFzdENvbnN1bWVTZXFJZEltbWVkaWF0ZWx5KCkpIHsKICAgICAg\nICAgICAgICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb25TdGF0ZSh0b3BpYywg\nZW50cnkuZ2V0S2V5KCksIG1lbVN0YXRlLCBtY2IsIGN0eCk7CiAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG1jYi5vcGVy\nYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICog\nUmVtb3ZlIHRoZSBsb2NhbCBtYXBwaW5nLgogICAgICovCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIGxvc3RUb3BpYyhCeXRlU3RyaW5nIHRvcGlj\nKSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3\nIFJlbGVhc2VPcCh0b3BpYywgbm9vcENhbGxiYWNrLCBudWxsKSk7CiAgICB9\nCgogICAgcHJpdmF0ZSB2b2lkIG5vdGlmeUxhc3RMb2NhbFVuc3Vic2NyaWJl\nKEJ5dGVTdHJpbmcgdG9waWMpIHsKICAgICAgICBmb3IgKFN1YnNjcmlwdGlv\nbkV2ZW50TGlzdGVuZXIgbGlzdGVuZXIgOiBsaXN0ZW5lcnMpCiAgICAgICAg\nICAgIGxpc3RlbmVyLm9uTGFzdExvY2FsVW5zdWJzY3JpYmUodG9waWMpOwog\nICAgfQoKICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIHJlYWRTdWJzY3Jp\ncHRpb25zKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsCiAgICAgICAgICAgIGZp\nbmFsIENhbGxiYWNrPE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlw\ndGlvblN0YXRlPj4gY2IsIGZpbmFsIE9iamVjdCBjdHgpOwogICAgCiAgICBw\ncm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCByZWFkU3Vic2NyaXB0aW9uRGF0YShm\naW5hbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBCeXRlU3RyaW5nIHN1YnNj\ncmliZXJJZCwgCiAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPEluTWVtb3J5\nU3Vic2NyaXB0aW9uU3RhdGU+IGNiLCBPYmplY3QgY3R4KTsKICAgIAogICAg\ncHJpdmF0ZSBjbGFzcyBTdWJzY3JpYmVPcCBleHRlbmRzIFRvcGljT3BRdWV1\nZXIuQXN5bmNocm9ub3VzT3A8U3Vic2NyaXB0aW9uRGF0YT4gewogICAgICAg\nIFN1YnNjcmliZVJlcXVlc3Qgc3ViUmVxdWVzdDsKICAgICAgICBNZXNzYWdl\nU2VxSWQgY29uc3VtZVNlcUlkOwoKICAgICAgICBwdWJsaWMgU3Vic2NyaWJl\nT3AoQnl0ZVN0cmluZyB0b3BpYywgU3Vic2NyaWJlUmVxdWVzdCBzdWJSZXF1\nZXN0LCBNZXNzYWdlU2VxSWQgY29uc3VtZVNlcUlkLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICBDYWxsYmFjazxTdWJzY3JpcHRpb25EYXRhPiBjYWxs\nYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBxdWV1ZXIuc3VwZXIo\ndG9waWMsIGNhbGxiYWNrLCBjdHgpOwogICAgICAgICAgICB0aGlzLnN1YlJl\ncXVlc3QgPSBzdWJSZXF1ZXN0OwogICAgICAgICAgICB0aGlzLmNvbnN1bWVT\nZXFJZCA9IGNvbnN1bWVTZXFJZDsKICAgICAgICB9CgogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKCiAgICAgICAgICAg\nIGZpbmFsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0\nYXRlPiB0b3BpY1N1YnNjcmlwdGlvbnMgPSB0b3Ayc3ViMnNlcS5nZXQodG9w\naWMpOwogICAgICAgICAgICBpZiAodG9waWNTdWJzY3JpcHRpb25zID09IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgs\nIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmVyTm90UmVzcG9uc2libGVGb3JU\nb3BpY0V4Y2VwdGlvbigiIikpOwogICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICBmaW5hbCBCeXRlU3RyaW5nIHN1\nYnNjcmliZXJJZCA9IHN1YlJlcXVlc3QuZ2V0U3Vic2NyaWJlcklkKCk7CiAg\nICAgICAgICAgIGZpbmFsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGUgc3Vi\nc2NyaXB0aW9uU3RhdGUgPSB0b3BpY1N1YnNjcmlwdGlvbnMuZ2V0KHN1YnNj\ncmliZXJJZCk7CiAgICAgICAgICAgIENyZWF0ZU9yQXR0YWNoIGNyZWF0ZU9y\nQXR0YWNoID0gc3ViUmVxdWVzdC5nZXRDcmVhdGVPckF0dGFjaCgpOwoKICAg\nICAgICAgICAgaWYgKHN1YnNjcmlwdGlvblN0YXRlICE9IG51bGwpIHsKCiAg\nICAgICAgICAgICAgICBpZiAoY3JlYXRlT3JBdHRhY2guZXF1YWxzKENyZWF0\nZU9yQXR0YWNoLkNSRUFURSkpIHsKICAgICAgICAgICAgICAgICAgICBTdHJp\nbmcgbXNnID0gIlRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAi\nIHN1YnNjcmliZXJJZDogIiArIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0Zjgo\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgcmVxdWVz\ndGVkIGNyZWF0aW5nIGEgc3Vic2NyaXB0aW9uIGJ1dCBpdCBpcyBhbHJlYWR5\nIHN1YnNjcmliZWQgd2l0aCBzdGF0ZTogIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIFN1YnNjcmlwdGlvblN0YXRlVXRpbHMudG9TdHJp\nbmcoc3Vic2NyaXB0aW9uU3RhdGUuZ2V0U3Vic2NyaXB0aW9uU3RhdGUoKSk7\nCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1zZyk7CiAgICAg\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1\nYlN1YkV4Y2VwdGlvbi5DbGllbnRBbHJlYWR5U3Vic2NyaWJlZEV4Y2VwdGlv\nbihtc2cpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gU3Vic2NyaXB0aW9uIGV4\naXN0ZWQgYmVmb3JlLCBjaGVjayB3aGV0aGVyIG5ldyBwcmVmZXJlbmNlcyBw\ncm92aWRlZAogICAgICAgICAgICAgICAgLy8gaWYgbmV3IHByZWZlcmVuY2Vz\nIHByb3ZpZGVkLCBtZXJnZWQgdGhlIHN1YnNjcmlwdGlvbiBkYXRhIGFuZCB1\ncGRhdGVkIHRoZW0KICAgICAgICAgICAgICAgIC8vIFRPRE86IG5lZWRzIEFD\nTCBtZWNoYW5pc20gd2hlbiBjaGFuZ2luZyBwcmVmZXJlbmNlcwogICAgICAg\nICAgICAgICAgaWYgKHN1YlJlcXVlc3QuaGFzUHJlZmVyZW5jZXMoKSAmJgog\nICAgICAgICAgICAgICAgICAgIHN1YnNjcmlwdGlvblN0YXRlLnVwZGF0ZVBy\nZWZlcmVuY2VzKHN1YlJlcXVlc3QuZ2V0UHJlZmVyZW5jZXMoKSkpIHsKICAg\nICAgICAgICAgICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb25QcmVmZXJlbmNl\ncyh0b3BpYywgc3Vic2NyaWJlcklkLCBzdWJzY3JpcHRpb25TdGF0ZSwgbmV3\nIENhbGxiYWNrPFZvaWQ+KCkgewogICAgICAgICAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\nb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBl\neGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9w\nZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRp\nb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdE9mT3BlcmF0aW9u\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlz\nRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZGVidWcoIlRvcGljOiAiICsgdG9waWMudG9TdHJpbmdV\ndGY4KCkgKyAiIHN1YnNjcmliZXJJZDogIiArIHN1YnNjcmliZXJJZC50b1N0\ncmluZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICIgYXR0YWNoaW5nIHRvIHN1YnNjcmlwdGlvbiB3aXRo\nIHN0YXRlOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgU3Vic2NyaXB0aW9uU3RhdGVVdGlscy50b1N0cmluZyhz\ndWJzY3JpcHRpb25TdGF0ZS5nZXRTdWJzY3JpcHRpb25TdGF0ZSgpKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIs\nIHdpdGggcHJlZmVyZW5jZXM6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyBTdWJzY3JpcHRpb25TdGF0ZVV0aWxz\nLnRvU3RyaW5nKHN1YnNjcmlwdGlvblN0YXRlLmdldFN1YnNjcmlwdGlvblBy\nZWZlcmVuY2VzKCkpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZSBtZXNzYWdl\nIGJvdW5kIGlmIG5lY2Vzc2FyeQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdXBkYXRlTWVzc2FnZUJvdW5kKHRvcGljKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgc3Vic2Ny\naXB0aW9uU3RhdGUudG9TdWJzY3JpcHRpb25EYXRhKCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgY3R4KTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlIGp1c3QgYXR0YWNoCiAg\nICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIlRvcGljOiAiICsg\ndG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIHN1YnNjcmliZXJJZDogIiArIHN1\nYnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArICIgYXR0YWNoaW5nIHRvIHN1YnNjcmlwdGlvbiB3\naXRoIHN0YXRlOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgU3Vic2NyaXB0aW9uU3RhdGVVdGlscy50b1N0cmluZyhzdWJzY3JpcHRp\nb25TdGF0ZS5nZXRTdWJzY3JpcHRpb25TdGF0ZSgpKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArICIsIHdpdGggcHJlZmVyZW5jZXM6ICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBTdWJzY3JpcHRp\nb25TdGF0ZVV0aWxzLnRvU3RyaW5nKHN1YnNjcmlwdGlvblN0YXRlLmdldFN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzKCkpKTsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIHN1\nYnNjcmlwdGlvblN0YXRlLnRvU3Vic2NyaXB0aW9uRGF0YSgpKTsKICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nLy8gd2UgZG9uJ3QgaGF2ZSBhIG1hcHBpbmcgZm9yIHRoaXMgc3Vic2NyaWJl\ncgogICAgICAgICAgICBpZiAoY3JlYXRlT3JBdHRhY2guZXF1YWxzKENyZWF0\nZU9yQXR0YWNoLkFUVEFDSCkpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBt\nc2cgPSAiVG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgc3Vi\nc2NyaWJlcklkOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIHJlcXVlc3RlZCBhdHRh\nY2hpbmcgdG8gYW4gZXhpc3Rpbmcgc3Vic2NyaXB0aW9uIGJ1dCBpdCBpcyBu\nb3Qgc3Vic2NyaWJlZCI7CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3Io\nbXNnKTsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgs\nIG5ldyBQdWJTdWJFeGNlcHRpb24uQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2Vw\ndGlvbihtc2cpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gbm93IHRoZSBoYXJkIGNhc2UsIHRoaXMg\naXMgYSBicmFuZCBuZXcgc3Vic2NyaXB0aW9uLCBtdXN0IHJlY29yZAogICAg\nICAgICAgICBTdWJzY3JpcHRpb25TdGF0ZS5CdWlsZGVyIHN0YXRlQnVpbGRl\nciA9IFN1YnNjcmlwdGlvblN0YXRlLm5ld0J1aWxkZXIoKS5zZXRNc2dJZChj\nb25zdW1lU2VxSWQpOwoKICAgICAgICAgICAgU3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXMuQnVpbGRlciBwcmVmZXJlbmNlc0J1aWxkZXI7CiAgICAgICAgICAg\nIGlmIChzdWJSZXF1ZXN0Lmhhc1ByZWZlcmVuY2VzKCkpIHsKICAgICAgICAg\nICAgICAgIHByZWZlcmVuY2VzQnVpbGRlciA9IFN1YnNjcmlwdGlvblByZWZl\ncmVuY2VzLm5ld0J1aWxkZXIoc3ViUmVxdWVzdC5nZXRQcmVmZXJlbmNlcygp\nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHByZWZl\ncmVuY2VzQnVpbGRlciA9IFN1YnNjcmlwdGlvblByZWZlcmVuY2VzLm5ld0J1\naWxkZXIoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gYmFja3dh\ncmQgY29tcGFiaWxpdHkKICAgICAgICAgICAgaWYgKHN1YlJlcXVlc3QuaGFz\nTWVzc2FnZUJvdW5kKCkpIHsKICAgICAgICAgICAgICAgIHByZWZlcmVuY2Vz\nQnVpbGRlciA9IHByZWZlcmVuY2VzQnVpbGRlci5zZXRNZXNzYWdlQm91bmQo\nc3ViUmVxdWVzdC5nZXRNZXNzYWdlQm91bmQoKSk7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIFN1YnNjcmlwdGlvbkRhdGEuQnVpbGRlciBzdWJEYXRh\nQnVpbGRlciA9CiAgICAgICAgICAgICAgICBTdWJzY3JpcHRpb25EYXRhLm5l\nd0J1aWxkZXIoKS5zZXRTdGF0ZShzdGF0ZUJ1aWxkZXIpLnNldFByZWZlcmVu\nY2VzKHByZWZlcmVuY2VzQnVpbGRlcik7CiAgICAgICAgICAgIGZpbmFsIFN1\nYnNjcmlwdGlvbkRhdGEgc3ViRGF0YSA9IHN1YkRhdGFCdWlsZGVyLmJ1aWxk\nKCk7CgogICAgICAgICAgICBjcmVhdGVTdWJzY3JpcHRpb25EYXRhKHRvcGlj\nLCBzdWJzY3JpYmVySWQsIHN1YkRhdGEsIG5ldyBDYWxsYmFjazxWZXJzaW9u\nPigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1\nYlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAg\nICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBleGNlcHRpb24pOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0\nIGN0eCwgZmluYWwgVmVyc2lvbiB2ZXJzaW9uKSB7CiAgICAgICAgICAgICAg\nICAgICAgQ2FsbGJhY2s8Vm9pZD4gY2IyID0gbmV3IENhbGxiYWNrPFZvaWQ+\nKCkgewogICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVk\nKGZpbmFsIE9iamVjdCBjdHgsIGZpbmFsIFB1YlN1YkV4Y2VwdGlvbiBleGNl\ncHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5l\ncnJvcigic3Vic2NyaXB0aW9uIGZvciBzdWJzY3JpYmVyICIgKyBzdWJzY3Jp\nYmVySWQudG9TdHJpbmdVdGY4KCkgKyAiIHRvIHRvcGljICIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3Ry\naW5nVXRmOCgpICsgIiBmYWlsZWQgZHVlIHRvIGZhaWxlZCBsaXN0ZW5lciBj\nYWxsYmFjayIsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBzaG91bGQgcmVtb3ZlIHN1YnNjcmlwdGlvbiB3aGVuIHN5bmNo\ncm9uaXplZCBjcm9zcy1yZWdpb24gc3Vic2NyaXB0aW9uIGZhaWxlZAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlU3Vic2NyaXB0aW9uRGF0\nYSh0b3BpYywgc3Vic2NyaWJlcklkLCB2ZXJzaW9uLCBuZXcgQ2FsbGJhY2s8\nVm9pZD4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGNvbnRleHQsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBWb2lkIHJlc3Vs\ndE9mT3BlcmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGZpbmlzaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGNvbnRleHQsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQdWJTdWJFeGNlcHRpb24g\nZXgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJSZW1vdmUgc3Vic2NyaXB0aW9uIGZvciBzdWJzY3JpYmVy\nICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkgKyAiIHRvIHRvcGlj\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIGZhaWxlZCA6ICIs\nIGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlu\naXNoKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaXZhdGUgdm9pZCBmaW5p\nc2goKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNi\nLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgfSwgY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVj\ndCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRvcGljU3Vic2NyaXB0aW9ucy5wdXQoc3Vic2Ny\naWJlcklkLCBuZXcgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZShzdWJEYXRh\nLCB2ZXJzaW9uKSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBk\nYXRlTWVzc2FnZUJvdW5kKHRvcGljKTsKCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIHN1YkRhdGEpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAg\nIH07CgogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgd2lsbCBiZSB0\naGUgZmlyc3QgbG9jYWwgc3Vic2NyaXB0aW9uLCBub3RpZnlGaXJzdExvY2Fs\nU3Vic2NyaWJlCiAgICAgICAgICAgICAgICAgICAgaWYgKCFTdWJzY3JpcHRp\nb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJSZXF1ZXN0LmdldFN1\nYnNjcmliZXJJZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhaGFz\nTG9jYWxTdWJzY3JpcHRpb25zKHRvcGljU3Vic2NyaXB0aW9ucykpCiAgICAg\nICAgICAgICAgICAgICAgICAgIG5vdGlmeUZpcnN0TG9jYWxTdWJzY3JpYmUo\ndG9waWMsIHN1YlJlcXVlc3QuZ2V0U3luY2hyb25vdXMoKSwgY2IyLCBjdHgp\nOwogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAg\nICAgICAgY2IyLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBnaXZl\nbiBzdWJzY3JpYmVySWQtdG8tc3Vic2NyaWJlclN0YXRlIG1hcCBjb250YWlu\ncyBhIGxvY2FsIHN1YnNjcmlwdGlvbjoKICAgICAqIHRoZSB2YXN0IG1ham9y\naXR5IG9mIHN1YnNjcmlwdGlvbnMgYXJlIGxvY2FsLCBzbyB3ZSB3aWxsIHF1\naWNrbHkgZW5jb3VudGVyIG9uZSBpZiBpdCBleGlzdHMuCiAgICAgKi8KICAg\nIHByaXZhdGUgc3RhdGljIGJvb2xlYW4gaGFzTG9jYWxTdWJzY3JpcHRpb25z\nKE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlPiB0\nb3BpY1N1YnNjcmlwdGlvbnMpIHsKICAgICAgZm9yIChCeXRlU3RyaW5nIHN1\nYklkIDogdG9waWNTdWJzY3JpcHRpb25zLmtleVNldCgpKQogICAgICAgIGlm\nICghU3Vic2NyaXB0aW9uU3RhdGVVdGlscy5pc0h1YlN1YnNjcmliZXIoc3Vi\nSWQpKQogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCB1cGRhdGVNZXNzYWdlQm91bmQo\nQnl0ZVN0cmluZyB0b3BpYykgewogICAgICAgIGZpbmFsIE1hcDxCeXRlU3Ry\naW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0YXRlPiB0b3BpY1N1YnNjcmlw\ndGlvbnMgPSB0b3Ayc3ViMnNlcS5nZXQodG9waWMpOwogICAgICAgIGlmICh0\nb3BpY1N1YnNjcmlwdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQogICAgICAgIGludCBtYXhCb3VuZCA9IEludGVnZXIu\nTUlOX1ZBTFVFOwogICAgICAgIGZvciAoTWFwLkVudHJ5PEJ5dGVTdHJpbmcs\nIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IGUgOiB0b3BpY1N1YnNjcmlw\ndGlvbnMuZW50cnlTZXQoKSkgewogICAgICAgICAgICBpZiAoIWUuZ2V0VmFs\ndWUoKS5nZXRTdWJzY3JpcHRpb25QcmVmZXJlbmNlcygpLmhhc01lc3NhZ2VC\nb3VuZCgpKSB7CiAgICAgICAgICAgICAgICBtYXhCb3VuZCA9IEludGVnZXIu\nTUlOX1ZBTFVFOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBtYXhCb3VuZCA9IE1hdGgubWF4\nKG1heEJvdW5kLCBlLmdldFZhbHVlKCkuZ2V0U3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXMoKS5nZXRNZXNzYWdlQm91bmQoKSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgaWYgKG1heEJvdW5kID09IEludGVnZXIuTUlOX1ZB\nTFVFKSB7CiAgICAgICAgICAgIHBtLmNsZWFyTWVzc2FnZUJvdW5kKHRvcGlj\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwbS5zZXRNZXNzYWdl\nQm91bmQodG9waWMsIG1heEJvdW5kKTsKICAgICAgICB9CiAgICB9CgogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXJ2ZVN1YnNjcmliZVJlcXVl\nc3QoQnl0ZVN0cmluZyB0b3BpYywgU3Vic2NyaWJlUmVxdWVzdCBzdWJSZXF1\nZXN0LCBNZXNzYWdlU2VxSWQgY29uc3VtZVNlcUlkLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNrPFN1YnNjcmlwdGlv\nbkRhdGE+IGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgcXVldWVy\nLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IFN1YnNjcmliZU9wKHRvcGlj\nLCBzdWJSZXF1ZXN0LCBjb25zdW1lU2VxSWQsIGNhbGxiYWNrLCBjdHgpKTsK\nICAgIH0KCiAgICBwcml2YXRlIGNsYXNzIENvbnN1bWVPcCBleHRlbmRzIFRv\ncGljT3BRdWV1ZXIuQXN5bmNocm9ub3VzT3A8Vm9pZD4gewogICAgICAgIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkOwogICAgICAgIE1lc3NhZ2VTZXFJZCBj\nb25zdW1lU2VxSWQ7CgogICAgICAgIHB1YmxpYyBDb25zdW1lT3AoQnl0ZVN0\ncmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIE1lc3NhZ2VT\nZXFJZCBjb25zdW1lU2VxSWQsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLAog\nICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0IGN0eCkgewogICAgICAg\nICAgICBxdWV1ZXIuc3VwZXIodG9waWMsIGNhbGxiYWNrLCBjdHgpOwogICAg\nICAgICAgICB0aGlzLnN1YnNjcmliZXJJZCA9IHN1YnNjcmliZXJJZDsKICAg\nICAgICAgICAgdGhpcy5jb25zdW1lU2VxSWQgPSBjb25zdW1lU2VxSWQ7CiAg\nICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9p\nZCBydW4oKSB7CiAgICAgICAgICAgIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9y\neVN1YnNjcmlwdGlvblN0YXRlPiB0b3BpY1N1YnMgPSB0b3Ayc3ViMnNlcS5n\nZXQodG9waWMpOwogICAgICAgICAgICBpZiAodG9waWNTdWJzID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwg\nbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGZpbmFsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGUg\nc3ViU3RhdGUgPSB0b3BpY1N1YnMuZ2V0KHN1YnNjcmliZXJJZCk7CiAgICAg\nICAgICAgIGlmIChzdWJTdGF0ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAo\nc3ViU3RhdGUuc2V0TGFzdENvbnN1bWVTZXFJZChjb25zdW1lU2VxSWQsIGNm\nZy5nZXRDb25zdW1lSW50ZXJ2YWwoKSkpIHsKICAgICAgICAgICAgICAgIHVw\nZGF0ZVN1YnNjcmlwdGlvblN0YXRlKHRvcGljLCBzdWJzY3JpYmVySWQsIHN1\nYlN0YXRlLCBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCByZXN1bHRP\nZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJTdGF0\nZS5zZXRMYXN0UGVyc2lzdGVkU2VxSWQoY29uc3VtZVNlcUlkLmdldExvY2Fs\nQ29tcG9uZW50KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVy\nYXRpb25GaW5pc2hlZChjdHgsIHJlc3VsdE9mT3BlcmF0aW9uKTsKICAgICAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZh\naWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChj\ndHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfSwgY3R4KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiT25seSBhZHZhbmNlZCBj\nb25zdW1lIHBvaW50ZXIgaW4gbWVtb3J5LCB3aWxsIHBlcnNpc3QgbGF0ZXIs\nIHRvcGljOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\ndG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIHN1YnNjcmliZXJJZDogIiArIHN1\nYnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArICIgcGVyc2lzdGVudFN0YXRlOiAiICsgU3Vic2Ny\naXB0aW9uU3RhdGVVdGlscy50b1N0cmluZyhzdWJTdGF0ZS5nZXRTdWJzY3Jp\ncHRpb25TdGF0ZSgpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArICIgaW4tbWVtb3J5IGNvbnN1bWUtaWQ6ICIKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyBNZXNzYWdlSWRVdGlscy5tc2dJZFRvUmVh\nZGFibGVTdHJpbmcoc3ViU3RhdGUuZ2V0TGFzdENvbnN1bWVTZXFJZCgpKSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYi5vcGVyYXRp\nb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIC8vIHRlbGwgZGVsaXZlcnkgbWFuYWdlIGFib3V0IHRoZSBjb25zdW1l\nIGV2ZW50CiAgICAgICAgICAgIGlmIChudWxsICE9IGRtKSB7CiAgICAgICAg\nICAgICAgICBkbS5tZXNzYWdlQ29uc3VtZWQodG9waWMsIHN1YnNjcmliZXJJ\nZCwgY29uc3VtZVNlcUlkKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNldENvbnN1bWVT\nZXFJZEZvclN1YnNjcmliZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmlu\nZyBzdWJzY3JpYmVySWQsIE1lc3NhZ2VTZXFJZCBjb25zdW1lU2VxSWQsCiAg\nICAgICAgICAgIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY3R4\nKSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3\nIENvbnN1bWVPcCh0b3BpYywgc3Vic2NyaWJlcklkLCBjb25zdW1lU2VxSWQs\nIGNhbGxiYWNrLCBjdHgpKTsKICAgIH0KCiAgICBwcml2YXRlIGNsYXNzIENs\nb3NlU3Vic2NyaXB0aW9uT3AgZXh0ZW5kcyBUb3BpY09wUXVldWVyLkFzeW5j\naHJvbm91c09wPFZvaWQ+IHsKCiAgICAgICAgcHVibGljIENsb3NlU3Vic2Ny\naXB0aW9uT3AoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2Fs\nbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgcXVldWVyLnN1cGVyKHRvcGljLCBjYWxsYmFjaywgY3R4KTsKICAgICAg\nICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1\nbigpIHsKICAgICAgICAgICAgLy8gVE9ETzogQk9PS0tFRVBFUi00MTI6IHdl\nIG1pZ2h0IG5lZWQgdG8gbW92ZSB0aGUgbG9hZGVkIHN1YnNjcmlwdGlvbgog\nICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgdG8gcmVjbGFp\nbSBtZW1vcnkKICAgICAgICAgICAgLy8gQnV0IGZvciBub3cgd2UgZG8gbm90\naGluZwogICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51\nbGwpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlU3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcgdG9waWMsIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBj\ndHgpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBu\nZXcgQ2xvc2VTdWJzY3JpcHRpb25PcCh0b3BpYywgc3Vic2NyaWJlcklkLCBj\nYWxsYmFjaywgY3R4KSk7CiAgICB9CgogICAgcHJpdmF0ZSBjbGFzcyBVbnN1\nYnNjcmliZU9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hyb25vdXNP\ncDxWb2lkPiB7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQ7Cgog\nICAgICAgIHB1YmxpYyBVbnN1YnNjcmliZU9wKEJ5dGVTdHJpbmcgdG9waWMs\nIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBDYWxsYmFjazxWb2lkPiBjYWxs\nYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBxdWV1ZXIuc3VwZXIo\ndG9waWMsIGNhbGxiYWNrLCBjdHgpOwogICAgICAgICAgICB0aGlzLnN1YnNj\ncmliZXJJZCA9IHN1YnNjcmliZXJJZDsKICAgICAgICB9CgogICAgICAgIEBP\ndmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAg\nICAgZmluYWwgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9u\nU3RhdGU+IHRvcGljU3Vic2NyaXB0aW9ucyA9IHRvcDJzdWIyc2VxLmdldCh0\nb3BpYyk7CiAgICAgICAgICAgIGlmICh0b3BpY1N1YnNjcmlwdGlvbnMgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0\neCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZv\nclRvcGljRXhjZXB0aW9uKCIiKSk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdG9waWNTdWJzY3Jp\ncHRpb25zLmNvbnRhaW5zS2V5KHN1YnNjcmliZXJJZCkpIHsKICAgICAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNl\ncHRpb24uQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbigiIikpOwogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIAogICAgICAgICAgICBkZWxldGVTdWJzY3JpcHRpb25EYXRhKHRvcGljLCBz\ndWJzY3JpYmVySWQsIHRvcGljU3Vic2NyaXB0aW9ucy5nZXQoc3Vic2NyaWJl\ncklkKS5nZXRWZXJzaW9uKCksCiAgICAgICAgICAgICAgICAgICAgbmV3IENh\nbGxiYWNrPFZvaWQ+KCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2Jq\nZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlv\nbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5p\nc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAg\nICAgICAgICAgICAgICAgICAgdG9waWNTdWJzY3JpcHRpb25zLnJlbW92ZShz\ndWJzY3JpYmVySWQpOwogICAgICAgICAgICAgICAgICAgIC8vIE5vdGlmeSBs\naXN0ZW5lcnMgaWYgbmVjZXNzYXJ5LgogICAgICAgICAgICAgICAgICAgIGlm\nICghU3Vic2NyaXB0aW9uU3RhdGVVdGlscy5pc0h1YlN1YnNjcmliZXIoc3Vi\nc2NyaWJlcklkKQogICAgICAgICAgICAgICAgICAgICAgICAmJiAhaGFzTG9j\nYWxTdWJzY3JpcHRpb25zKHRvcGljU3Vic2NyaXB0aW9ucykpCiAgICAgICAg\nICAgICAgICAgICAgICAgIG5vdGlmeUxhc3RMb2NhbFVuc3Vic2NyaWJlKHRv\ncGljKTsKCiAgICAgICAgICAgICAgICAgICAgdXBkYXRlTWVzc2FnZUJvdW5k\nKHRvcGljKTsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5p\nc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9LCBjdHgpOwoKICAgICAgICB9CgogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgdW5zdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywg\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIENhbGxiYWNrPFZvaWQ+IGNhbGxi\nYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRNYXli\nZVJ1bih0b3BpYywgbmV3IFVuc3Vic2NyaWJlT3AodG9waWMsIHN1YnNjcmli\nZXJJZCwgY2FsbGJhY2ssIGN0eCkpOwogICAgfQoKICAgIC8qKgogICAgICog\nTm90IHRocmVhZC1zYWZlLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIGFkZExpc3RlbmVyKFN1YnNjcmlwdGlvbkV2ZW50TGlzdGVu\nZXIgbGlzdGVuZXIpIHsKICAgICAgICBsaXN0ZW5lcnMuYWRkKGxpc3RlbmVy\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIE1ldGhvZCB0byBzdG9wIHRoaXMg\nY2xhc3MgZ3JhY2VmdWxseSBpbmNsdWRpbmcgcmVsZWFzaW5nIGFueSByZXNv\ndXJjZXMKICAgICAqIHVzZWQgYW5kIHN0b3BwaW5nIGFsbCB0aHJlYWRzIHNw\nYXduZWQuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN0b3AoKSB7CiAgICAg\nICAgdGltZXIuY2FuY2VsKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nZmluYWwgTGlua2VkQmxvY2tpbmdRdWV1ZTxCb29sZWFuPiBxdWV1ZSA9IG5l\ndyBMaW5rZWRCbG9ja2luZ1F1ZXVlPEJvb2xlYW4+KCk7CiAgICAgICAgICAg\nIC8vIHVwZGF0ZSBkaXJ0eSBzdWJzY3JpcHRpb25zCiAgICAgICAgICAgIGZv\nciAoQnl0ZVN0cmluZyB0b3BpYyA6IHRvcDJzdWIyc2VxLmtleVNldCgpKSB7\nCiAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBmaW5hbENiID0gbmV3\nIENhbGxiYWNrPFZvaWQ+KCkgewogICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24p\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5w\ndXQocXVldWUsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRp\nb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGls\ncy5wdXQocXVldWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdXBkYXRlU3Vic2Ny\naXB0aW9uU3RhdGVzKHRvcGljLCBmaW5hbENiLCBudWxsKTsKICAgICAgICAg\nICAgICAgIHF1ZXVlLnRha2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAg\nIGxvZ2dlci53YXJuKCJFcnJvciBkdXJpbmcgdXBkYXRpbmcgc3Vic2NyaXB0\naW9uIHN0YXRlcyA6ICIsIGllKTsKICAgICAgICB9CiAgICB9CgogICAgcHJp\ndmF0ZSB2b2lkIHVwZGF0ZVN1YnNjcmlwdGlvblN0YXRlKGZpbmFsIEJ5dGVT\ndHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFs\nIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGUgc3RhdGUsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgQ2FsbGJhY2s8\nVm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjdHgpIHsKICAgICAgICBTdWJzY3Jp\ncHRpb25EYXRhIHN1YkRhdGE7CiAgICAgICAgQ2FsbGJhY2s8VmVyc2lvbj4g\nY2IgPSBuZXcgQ2FsbGJhY2s8VmVyc2lvbj4oKSB7CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5p\nc2hlZChPYmplY3QgY3R4LCBWZXJzaW9uIHZlcnNpb24pIHsKICAgICAgICAg\nICAgICAgIHN0YXRlLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAg\nICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHVi\nU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgaWYg\nKGV4Y2VwdGlvbiBpbnN0YW5jZW9mIFB1YlN1YkV4Y2VwdGlvbi5CYWRWZXJz\naW9uRXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgcmVhZFN1YnNj\ncmlwdGlvbkRhdGEodG9waWMsIHN1YnNjcmliZXJJZCwgbmV3IENhbGxiYWNr\nPEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+KCkgewogICAgICAgICAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbk1lbW9yeVN1YnNjcmlw\ndGlvblN0YXRlIHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBzdGF0ZS5zZXRWZXJzaW9uKHJlc3VsdE9mT3BlcmF0\naW9uLmdldFZlcnNpb24oKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB1cGRhdGVTdWJzY3JpcHRpb25TdGF0ZSh0b3BpYywgc3Vic2NyaWJlcklk\nLCBzdGF0ZSwgY2FsbGJhY2ssIGN0eCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxl\nZChPYmplY3QgY3R4LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4\nY2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAgICAgICAgICAgIAogICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gCiAg\nICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GYWlsZWQoY3R4LCBl\neGNlcHRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICBp\nZiAoaXNQYXJ0aWFsVXBkYXRlU3VwcG9ydGVkKCkpIHsKICAgICAgICAgICAg\nc3ViRGF0YSA9IFN1YnNjcmlwdGlvbkRhdGEubmV3QnVpbGRlcigpLnNldFN0\nYXRlKHN0YXRlLmdldFN1YnNjcmlwdGlvblN0YXRlKCkpLmJ1aWxkKCk7CiAg\nICAgICAgICAgIHVwZGF0ZVN1YnNjcmlwdGlvbkRhdGEodG9waWMsIHN1YnNj\ncmliZXJJZCwgc3ViRGF0YSwgc3RhdGUuZ2V0VmVyc2lvbigpLCBjYiwgY3R4\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdWJEYXRhID0gc3Rh\ndGUudG9TdWJzY3JpcHRpb25EYXRhKCk7CiAgICAgICAgICAgIHJlcGxhY2VT\ndWJzY3JpcHRpb25EYXRhKHRvcGljLCBzdWJzY3JpYmVySWQsIHN1YkRhdGEs\nIHN0YXRlLmdldFZlcnNpb24oKSwgY2IsIGN0eCk7CiAgICAgICAgfQogICAg\nfQoKICAgIHByaXZhdGUgdm9pZCB1cGRhdGVTdWJzY3JpcHRpb25QcmVmZXJl\nbmNlcyhmaW5hbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBCeXRlU3RyaW5n\nIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmaW5hbCBJbk1lbW9yeVN1YnNjcmlwdGlvblN0\nYXRlIHN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBP\nYmplY3QgY3R4KSB7CiAgICAgICAgU3Vic2NyaXB0aW9uRGF0YSBzdWJEYXRh\nOwogICAgICAgIENhbGxiYWNrPFZlcnNpb24+IGNiID0gbmV3IENhbGxiYWNr\nPFZlcnNpb24+KCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwg\nVmVyc2lvbiB2ZXJzaW9uKSB7CiAgICAgICAgICAgICAgICBzdGF0ZS5zZXRW\nZXJzaW9uKHZlcnNpb24pOwogICAgICAgICAgICAgICAgY2FsbGJhY2sub3Bl\ncmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNl\ncHRpb24pIHsKICAgICAgICAgICAgICAgIGlmIChleGNlcHRpb24gaW5zdGFu\nY2VvZiBQdWJTdWJFeGNlcHRpb24uQmFkVmVyc2lvbkV4Y2VwdGlvbikgewog\nICAgICAgICAgICAgICAgICAgIHJlYWRTdWJzY3JpcHRpb25EYXRhKHRvcGlj\nLCBzdWJzY3JpYmVySWQsIG5ldyBDYWxsYmFjazxJbk1lbW9yeVN1YnNjcmlw\ndGlvblN0YXRlPigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSByZXN1bHRP\nZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3Rh\ndGUuc2V0VmVyc2lvbihyZXN1bHRPZk9wZXJhdGlvbi5nZXRWZXJzaW9uKCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3Vic2NyaXB0\naW9uUHJlZmVyZW5jZXModG9waWMsIHN1YnNjcmliZXJJZCwgc3RhdGUsIGNh\nbGxiYWNrLCBjdHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0\neCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQdWJTdWJFeGNl\ncHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjYWxsYmFjay5vcGVyYXRpb25GYWlsZWQoY3R4LCBleGNlcHRpb24pOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfSwgY3R4KTsKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IAogICAgICAgICAgICAg\nICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0aW9uKTsK\nICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgaWYgKGlzUGFydGlh\nbFVwZGF0ZVN1cHBvcnRlZCgpKSB7CiAgICAgICAgICAgIHN1YkRhdGEgPSBT\ndWJzY3JpcHRpb25EYXRhLm5ld0J1aWxkZXIoKS5zZXRQcmVmZXJlbmNlcyhz\ndGF0ZS5nZXRTdWJzY3JpcHRpb25QcmVmZXJlbmNlcygpKS5idWlsZCgpOwog\nICAgICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb25EYXRhKHRvcGljLCBzdWJz\nY3JpYmVySWQsIHN1YkRhdGEsIHN0YXRlLmdldFZlcnNpb24oKSwgY2IsIGN0\neCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3ViRGF0YSA9IHN0\nYXRlLnRvU3Vic2NyaXB0aW9uRGF0YSgpOwogICAgICAgICAgICByZXBsYWNl\nU3Vic2NyaXB0aW9uRGF0YSh0b3BpYywgc3Vic2NyaWJlcklkLCBzdWJEYXRh\nLCBzdGF0ZS5nZXRWZXJzaW9uKCksIGNiLCBjdHgpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3QgYm9vbGVhbiBpc1BhcnRpYWxV\ncGRhdGVTdXBwb3J0ZWQoKTsKCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9p\nZCBjcmVhdGVTdWJzY3JpcHRpb25EYXRhKGZpbmFsIEJ5dGVTdHJpbmcgdG9w\naWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICBTdWJz\nY3JpcHRpb25EYXRhIGRhdGEsIENhbGxiYWNrPFZlcnNpb24+IGNhbGxiYWNr\nLCBPYmplY3QgY3R4KTsKCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCB1\ncGRhdGVTdWJzY3JpcHRpb25EYXRhKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLCBTdWJzY3JpcHRpb25EYXRhIGRhdGEsCiAg\nICAgICAgICAgIFZlcnNpb24gdmVyc2lvbiwgQ2FsbGJhY2s8VmVyc2lvbj4g\nY2FsbGJhY2ssIE9iamVjdCBjdHgpOwoKICAgIHByb3RlY3RlZCBhYnN0cmFj\ndCB2b2lkIHJlcGxhY2VTdWJzY3JpcHRpb25EYXRhKEJ5dGVTdHJpbmcgdG9w\naWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBTdWJzY3JpcHRpb25EYXRh\nIGRhdGEsCiAgICAgICAgICAgIFZlcnNpb24gdmVyc2lvbiwgQ2FsbGJhY2s8\nVmVyc2lvbj4gY2FsbGJhY2ssIE9iamVjdCBjdHgpOwoKICAgIHByb3RlY3Rl\nZCBhYnN0cmFjdCB2b2lkIGRlbGV0ZVN1YnNjcmlwdGlvbkRhdGEoQnl0ZVN0\ncmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIFZlcnNpb24g\ndmVyc2lvbiwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssCiAgICAgICAgICAg\nIE9iamVjdCBjdHgpOwoKfQo=\n","encoding":"base64"}

