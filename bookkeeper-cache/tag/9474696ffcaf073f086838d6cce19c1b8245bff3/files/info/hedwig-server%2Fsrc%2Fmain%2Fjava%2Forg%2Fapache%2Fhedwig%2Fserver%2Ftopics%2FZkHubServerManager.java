{"sha":"9651058394eae394c3c7b1f5c62f96f1a3f3d8a4","node_id":"MDQ6QmxvYjE1NzU5NTY6OTY1MTA1ODM5NGVhZTM5NGMzYzdiMWY1YzYyZjk2ZjFhM2YzZDhhNA==","size":21311,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/9651058394eae394c3c7b1f5c62f96f1a3f3d8a4","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIHN0YXRpYyBjb20uZ29vZ2xlLmNvbW1vbi5iYXNlLkNoYXJzZXRzLlVURl84\nOwoKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0\naWwuSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5SYW5kb207CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKCmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2Fs\nbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkhlZHdpZ1Nv\nY2tldEFkZHJlc3M7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy56b29rZWVw\nZXIuU2FmZUFzeW5jWktDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnpvb2tlZXBlci5TYWZlQXN5bmNaS0NhbGxiYWNrLlN0YXRDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBlci5aa1V0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQ3JlYXRlTW9kZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Db2Rl\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLlpvb0RlZnMuSWRzOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuZGF0YS5TdGF0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIFpvb0tl\nZXBlciBiYXNlZCBodWIgc2VydmVyIG1hbmFnZXIuCiAqLwpjbGFzcyBaa0h1\nYlNlcnZlck1hbmFnZXIgaW1wbGVtZW50cyBIdWJTZXJ2ZXJNYW5hZ2VyIHsK\nCiAgICBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3RvcnkuZ2V0\nTG9nZ2VyKFprSHViU2VydmVyTWFuYWdlci5jbGFzcyk7CgogICAgZmluYWwg\nUmFuZG9tIHJhbmQgPSBuZXcgUmFuZG9tKCk7CgogICAgcHJpdmF0ZSBmaW5h\nbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICBwcml2YXRlIGZpbmFs\nIFpvb0tlZXBlciB6azsKICAgIHByaXZhdGUgZmluYWwgSGVkd2lnU29ja2V0\nQWRkcmVzcyBhZGRyOwogICAgcHJpdmF0ZSBmaW5hbCBUb3BpY01hbmFnZXIg\ndG07CiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBlcGhlbWVyYWxOb2RlUGF0\naDsKICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIGh1Yk5vZGVzUGF0aDsKCiAg\nICAvLyBodWIgaW5mbyBzdHJ1Y3R1cmUgcmVwcmVzZW50IGl0c2VsZgogICAg\ncHJvdGVjdGVkIEh1YkluZm8gbXlIdWJJbmZvOwogICAgcHJvdGVjdGVkIHZv\nbGF0aWxlIGJvb2xlYW4gaXNTdXNwZW5kZWQgPSBmYWxzZTsKICAgIHByb3Rl\nY3RlZCBNYW5hZ2VyTGlzdGVuZXIgbGlzdGVuZXIgPSBudWxsOwogICAgcHJv\ndGVjdGVkIGZpbmFsIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBleGVjdXRv\ncjsKCiAgICAvLyB1cGxvYWQgaHViIHNlcnZlciBsb2FkIHRvIHpvb2tlZXBl\ncgogICAgU3RhdENhbGxiYWNrIGxvYWRSZXBvcnRpbmdTdGF0Q2FsbGJhY2sg\nPSBuZXcgU3RhdENhbGxiYWNrKCkgewogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3Ry\naW5nIHBhdGgsIE9iamVjdCBjdHgsIFN0YXQgc3RhdCkgewogICAgICAgICAg\nICBpZiAocmMgIT0gS2VlcGVyRXhjZXB0aW9uLkNvZGUuT0suaW50VmFsdWUo\nKSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oIkZhaWxlZCB0byB1\ncGRhdGUgbG9hZCBpbmZvcm1hdGlvbiBvZiBodWIge30gaW4gemsiLCBteUh1\nYkluZm8pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICAv\nKioKICAgICAqIFdhdGNoZXIgdG8gbW9uaXRvciBhdmFpbGFibGUgaHViIHNl\ncnZlciBsaXN0LgogICAgICovCiAgICBjbGFzcyBaa0h1YnNXYXRjaGVyIGlt\ncGxlbWVudHMgV2F0Y2hlciB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAg\nICAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKS5lcXVhbHMoV2F0Y2hlci5F\ndmVudC5FdmVudFR5cGUuTm9uZSkpIHsKICAgICAgICAgICAgICAgIGlmIChl\ndmVudC5nZXRTdGF0ZSgpLmVxdWFscygKICAgICAgICAgICAgICAgICAgICAg\nICAgV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZS5EaXNjb25uZWN0ZWQpKSB7\nCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oIlpLIGNsaWVudCBo\nYXMgYmVlbiBkaXNjb25uZWN0ZWQgdG8gdGhlIFpLIHNlcnZlciEiKTsKICAg\nICAgICAgICAgICAgICAgICBpc1N1c3BlbmRlZCA9IHRydWU7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKG51bGwgIT0gbGlzdGVuZXIpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgbGlzdGVuZXIub25TdXNwZW5kKCk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVu\ndC5nZXRTdGF0ZSgpLmVxdWFscygKICAgICAgICAgICAgICAgICAgICAgICAg\nV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZS5TeW5jQ29ubmVjdGVkKSkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChpc1N1c3BlbmRlZCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiWksgY2xpZW50IGhhcyBi\nZWVuIHJlY29ubmVjdGVkIHRvIHRoZSBaSyBzZXJ2ZXIhIik7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlzU3VzcGVuZGVk\nID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gbGlz\ndGVuZXIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXIub25S\nZXN1bWUoKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGV2ZW50LmdldFN0\nYXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuRXhwaXJl\nZCkpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiWksgY2xpZW50\nIGNvbm5lY3Rpb24gdG8gdGhlIFpLIHNlcnZlciBoYXMgZXhwaXJlZC4hIik7\nCiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBsaXN0ZW5lcikgewogICAg\nICAgICAgICAgICAgICAgIC8vIFNodXRkb3duIG91ciBleGVjdXRvciBOT1ch\nCiAgICAgICAgICAgICAgICAgICAgZXhlY3V0b3Iuc2h1dGRvd25Ob3coKTsK\nICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lci5vblNodXRkb3duKCk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgY2xhc3MgUmViYWxhbmNlUnVubmFibGUgaW1wbGVtZW50cyBSdW5u\nYWJsZSB7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBkb3VibGUgdG9sZXJhbmNl\nUGVyY2VudGFnZTsKICAgICAgICBwcml2YXRlIGZpbmFsIEh1YkxvYWQgbWF4\nTG9hZFRvU2hlZDsKICAgICAgICBwcml2YXRlIGZpbmFsIGxvbmcgZGVsYXlT\nZWNvbmRzOwoKICAgICAgICBwdWJsaWMgUmViYWxhbmNlUnVubmFibGUoZG91\nYmxlIHRvbGVyYW5jZVBlcmNlbnRhZ2UsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIEh1YkxvYWQgbWF4TG9hZFRvU2hlZCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbG9uZyBkZWxheVNlY29uZHMpIHsK\nICAgICAgICAgICAgdGhpcy50b2xlcmFuY2VQZXJjZW50YWdlID0gdG9sZXJh\nbmNlUGVyY2VudGFnZTsKICAgICAgICAgICAgdGhpcy5tYXhMb2FkVG9TaGVk\nID0gbWF4TG9hZFRvU2hlZDsKICAgICAgICAgICAgdGhpcy5kZWxheVNlY29u\nZHMgPSBkZWxheVNlY29uZHM7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIC8v\nIElmIHdlIGFyZSBpbiBzdXNwZW5kZWQgc3RhdGUsIGRvbid0IGF0dGVtcHQg\nYSByZWJhbGFuY2UuCiAgICAgICAgICAgIGlmIChpc1N1c3BlbmRlZCkgewog\nICAgICAgICAgICAgICAgZXhlY3V0b3Iuc2NoZWR1bGUodGhpcywgZGVsYXlT\nZWNvbmRzLCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBXZSBzaG91bGQg\nYXR0ZW1wdCBhIHJlYmFsYW5jZS4gV2UgcmVzY2hlZHVsZSB0aGUgam9iIGF0\nIHRoZSB0YWlsIHNvIHRoYXQKICAgICAgICAgICAgLy8gdHdvIHJlYmFsYW5j\nZXMgZG9uJ3QgaGFwcGVuIHNpbXVsdGFuZW91c2x5LgogICAgICAgICAgICBy\nZWJhbGFuY2VDbHVzdGVyKHRvbGVyYW5jZVBlcmNlbnRhZ2UsIG1heExvYWRU\nb1NoZWQsIG5ldyBDYWxsYmFjazxCb29sZWFuPigpIHsKICAgICAgICAgICAg\nICAgIHByaXZhdGUgdm9pZCByZXNjaGVkdWxlKFJ1bm5hYmxlIHRhc2spIHsK\nICAgICAgICAgICAgICAgICAgICBleGVjdXRvci5zY2hlZHVsZSh0YXNrLCBk\nZWxheVNlY29uZHMsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwg\nQm9vbGVhbiBkaWRSZWJhbGFuY2UpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoZGlkUmViYWxhbmNlID09IHRydWUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmluZm8oIlRoZSBhdHRlbXB0IHRvIHJlYmFsYW5jZSB0\naGUgY2x1c3RlciB3YXMgc3VjY2Vzc2Z1bCIpOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5p\nbmZvKCJUaGVyZSB3YXMgbm8gbmVlZCB0byByZWJhbGFuY2UuIik7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIE91ciBv\ncmlnaW5hbCBydW5uYWJsZSB3YXMgcGFzc2VkIGFzIHRoZSBjb250ZXh0Lgog\nICAgICAgICAgICAgICAgICAgIHJlc2NoZWR1bGUoKFJ1bm5hYmxlKWN0eCk7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQo\nT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIuZXJyb3IoIlRoZSBhdHRlbXB0IHRvIHJlYmFsYW5j\nZSB0aGUgY2x1c3RlciBkaWQgbm90IHN1Y2NlZWQuIiwgZSk7CiAgICAgICAg\nICAgICAgICAgICAgLy8gUmVzY2hlZHVsZSB0aGUgam9iCiAgICAgICAgICAg\nICAgICAgICAgcmVzY2hlZHVsZSgoUnVubmFibGUpY3R4KTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfSwgdGhpcyk7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgdm9pZCBzdGFydCgpIHsKICAgICAgICAgICAgLy8gSW5p\ndGlhdGUgb25seSBpZiBkZWxheVNlY29uZHMgPiAwCiAgICAgICAgICAgIGlm\nIChkZWxheVNlY29uZHMgPiAwKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIu\naW5mbygiU3RhcnRpbmcgdGhlIHJlYmFsYW5jZXIgdGhyZWFkIHdpdGggdG9s\nZXJhbmNlPXt9LCBtYXhMb2FkVG9TaGVkPXt9IGFuZCBkZWxheT17fSIsCiAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgdG9sZXJhbmNlUGVy\nY2VudGFnZSwgbWF4TG9hZFRvU2hlZC5nZXROdW1Ub3BpY3MoKSwgZGVsYXlT\nZWNvbmRzIH0pOwogICAgICAgICAgICAgICAgZXhlY3V0b3Iuc2NoZWR1bGUo\ndGhpcywgZGVsYXlTZWNvbmRzLCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgWmtIdWJTZXJ2\nZXJNYW5hZ2VyKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgWm9vS2VlcGVyIHprLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIGFkZHIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRvcGljTWFuYWdlciB0\nbSkgewogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAgICAgdGhpcy56\nayA9IHprOwogICAgICAgIHRoaXMuYWRkciA9IGFkZHI7CiAgICAgICAgdGhp\ncy50bSA9IHRtOwogICAgICAgIC8vIHpub2RlIHBhdGggdG8gc3RvcmUgYWxs\nIGF2YWlsYWJsZSBodWIgc2VydmVycwogICAgICAgIHRoaXMuaHViTm9kZXNQ\nYXRoID0gdGhpcy5jb25mLmdldFprSG9zdHNQcmVmaXgobmV3IFN0cmluZ0J1\naWxkZXIoKSkudG9TdHJpbmcoKTsKICAgICAgICAvLyB0aGUgbm9kZSdzIGVw\naGVtZXJhbCBub2RlIHBhdGgKICAgICAgICB0aGlzLmVwaGVtZXJhbE5vZGVQ\nYXRoID0gZ2V0SHViWmtOb2RlUGF0aChhZGRyKTsKICAgICAgICB0aGlzLmV4\nZWN1dG9yID0gRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZFNjaGVkdWxlZEV4\nZWN1dG9yKCk7CiAgICAgICAgLy8gcmVnaXN0ZXIgYXZhaWxhYmxlIGh1YiBz\nZXJ2ZXJzIGxpc3Qgd2F0Y2hlcgogICAgICAgIHprLnJlZ2lzdGVyKG5ldyBa\na0h1YnNXYXRjaGVyKCkpOwoKICAgICAgICAvLyBTdGFydCB0aGUgcmViYWxh\nbmNlciBoZXJlLgogICAgICAgIG5ldyBSZWJhbGFuY2VSdW5uYWJsZShjb25m\nLmdldFJlYmFsYW5jZVRvbGVyYW5jZSgpLCBjb25mLmdldFJlYmFsYW5jZU1h\neFNoZWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZi5n\nZXRSZWJhbGFuY2VJbnRlcnZhbCgpKS5zdGFydCgpOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgcmVnaXN0ZXJMaXN0ZW5lcihNYW5h\nZ2VyTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICB0aGlzLmxpc3RlbmVy\nID0gbGlzdGVuZXI7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgdGhlIHpu\nb2RlIHBhdGggaWRlbnRpZnlpbmcgYSBodWIgc2VydmVyLgogICAgICoKICAg\nICAqIEBwYXJhbSBub2RlCiAgICAgKiAgICAgICAgICBIdWIgU2VydmVyIEFk\nZHJlc3MKICAgICAqIEByZXR1cm4gem5vZGUgcGF0aCBpZGVudGlmeWluZyB0\naGUgaHViIHNlcnZlci4KICAgICAqLwogICAgcHJpdmF0ZSBTdHJpbmcgZ2V0\nSHViWmtOb2RlUGF0aChIZWR3aWdTb2NrZXRBZGRyZXNzIG5vZGUpIHsKICAg\nICAgICBTdHJpbmcgbm9kZVBhdGggPSB0aGlzLmNvbmYuZ2V0WmtIb3N0c1By\nZWZpeChuZXcgU3RyaW5nQnVpbGRlcigpKQogICAgICAgICAgICAgICAgICAg\nICAgICAgIC5hcHBlbmQoIi8iKS5hcHBlbmQobm9kZSkudG9TdHJpbmcoKTsK\nICAgICAgICByZXR1cm4gbm9kZVBhdGg7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBwdWJsaWMgdm9pZCByZWdpc3RlclNlbGYoZmluYWwgSHViTG9hZCBz\nZWxmRGF0YSwgZmluYWwgQ2FsbGJhY2s8SHViSW5mbz4gY2FsbGJhY2ssIE9i\namVjdCBjdHgpIHsKICAgICAgICBieXRlW10gbG9hZERhdGFCeXRlcyA9IHNl\nbGZEYXRhLnRvU3RyaW5nKCkuZ2V0Qnl0ZXMoVVRGXzgpOwogICAgICAgIFpr\nVXRpbHMuY3JlYXRlRnVsbFBhdGhPcHRpbWlzdGljKHprLCBlcGhlbWVyYWxO\nb2RlUGF0aCwgbG9hZERhdGFCeXRlcywgSWRzLk9QRU5fQUNMX1VOU0FGRSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDcmVh\ndGVNb2RlLkVQSEVNRVJBTCwgbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suU3Ry\naW5nQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0\ncmluZyBwYXRoLCBPYmplY3QgY3R4LCBTdHJpbmcgbmFtZSkgewogICAgICAg\nICAgICAgICAgaWYgKHJjID09IENvZGUuT0suaW50VmFsdWUoKSkgewogICAg\nICAgICAgICAgICAgICAgIC8vIG5vdyB3ZSBhcmUgaGVyZQogICAgICAgICAg\nICAgICAgICAgIHprLmV4aXN0cyhlcGhlbWVyYWxOb2RlUGF0aCwgZmFsc2Us\nIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLlN0YXRDYWxsYmFjaygpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCBy\nYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsIFN0YXQgc3RhdCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IENvZGUuT0suaW50\nVmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG15\nSHViSW5mbyA9IG5ldyBIdWJJbmZvKGFkZHIsIHN0YXQuZ2V0Q3p4aWQoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3Bl\ncmF0aW9uRmluaXNoZWQoY3R4LCBteUh1YkluZm8pOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKGN0eCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBQdWJTdWJFeGNl\ncHRpb24uU2VydmljZURvd25FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAiSSBjYW4ndCBzdGF0ZSBteSBodWIg\nbm9kZSBhZnRlciBJIGNyZWF0ZWQgaXQgOiAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIGVwaGVtZXJhbE5vZGVQYXRoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICBpZiAocmMgIT0gQ29kZS5OT0RFRVhJU1RTLmludFZhbHVlKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24ga2UgPSBa\na1V0aWxzLmxvZ0Vycm9yQW5kQ3JlYXRlWktFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAiQ291bGQgbm90IGNyZWF0ZSBlcGhlbWVy\nYWwgbm9kZSB0byByZWdpc3RlciBodWIiLCBlcGhlbWVyYWxOb2RlUGF0aCwg\ncmMpOwogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZh\naWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNl\ncHRpb24oa2UpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkZv\ndW5kIHN0YWxlIGVwaGVtZXJhbCBub2RlIHdoaWxlIHJlZ2lzdGVyaW5nIGh1\nYiB3aXRoIFpLLCBkZWxldGluZyBpdCIpOwoKICAgICAgICAgICAgICAgIC8v\nIE5vZGUgZXhpc3RzLCBsZXRzIHRyeSB0byBkZWxldGUgaXQgYW5kIHJldHJ5\nCiAgICAgICAgICAgICAgICB6ay5kZWxldGUoZXBoZW1lcmFsTm9kZVBhdGgs\nIC0xLCBuZXcgU2FmZUFzeW5jWktDYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7\nCiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2FmZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBT\ndHJpbmcgcGF0aCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAocmMgPT0gQ29kZS5PSy5pbnRWYWx1ZSgpIHx8IHJjID09IENv\nZGUuTk9OT0RFLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHJlZ2lzdGVyU2VsZihzZWxmRGF0YSwgY2FsbGJhY2ssIGN0eCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgS2Vl\ncGVyRXhjZXB0aW9uIGtlID0gWmtVdGlscy5sb2dFcnJvckFuZENyZWF0ZVpL\nRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJD\nb3VsZCBub3QgZGVsZXRlIHN0YWxlIGVwaGVtZXJhbCBub2RlIHRvIHJlZ2lz\ndGVyIGh1YiIsIGVwaGVtZXJhbE5vZGVQYXRoLCByYyk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5l\ndyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oa2UpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9LCBjdHgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgdW5yZWdpc3RlclNlbGYoKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHprLmRlbGV0ZShlcGhl\nbWVyYWxOb2RlUGF0aCwgLTEpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVw\ndGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKGUpOwogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbihlKTsKICAg\nICAgICB9CiAgICB9CgoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\ndXBsb2FkU2VsZkxvYWREYXRhKEh1YkxvYWQgc2VsZkxvYWQpIHsKICAgICAg\nICBsb2dnZXIuZGVidWcoIlJlcG9ydGluZyBodWIgbG9hZCBvZiB7fSA6IHt9\nIiwgbXlIdWJJbmZvLCBzZWxmTG9hZCk7CiAgICAgICAgYnl0ZVtdIGxvYWRE\nYXRhQnl0ZXMgPSBzZWxmTG9hZC50b1N0cmluZygpLmdldEJ5dGVzKFVURl84\nKTsKICAgICAgICB6ay5zZXREYXRhKGVwaGVtZXJhbE5vZGVQYXRoLCBsb2Fk\nRGF0YUJ5dGVzLCAtMSwKICAgICAgICAgICAgICAgICAgIGxvYWRSZXBvcnRp\nbmdTdGF0Q2FsbGJhY2ssIG51bGwpOwogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgaXNIdWJBbGl2ZShmaW5hbCBIdWJJbmZvIGh1Yiwg\nZmluYWwgQ2FsbGJhY2s8Qm9vbGVhbj4gY2FsbGJhY2ssIE9iamVjdCBjdHgp\nIHsKICAgICAgICB6ay5leGlzdHMoZ2V0SHViWmtOb2RlUGF0aChodWIuZ2V0\nQWRkcmVzcygpKSwgZmFsc2UsIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLlN0\nYXRDYWxsYmFjaygpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3Ry\naW5nIHBhdGgsIE9iamVjdCBjdHgsIFN0YXQgc3RhdCkgewogICAgICAgICAg\nICAgICAgaWYgKHJjID09IENvZGUuTk9OT0RFLmludFZhbHVlKCkpIHsKICAg\nICAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChj\ndHgsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmMgPT0g\nQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGh1Yi5nZXRaeGlkKCkgPT0gc3RhdC5nZXRDenhpZCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGN0\neCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQo\nY3R4LCBmYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5v\ncGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZp\nY2VEb3duRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiRmFp\nbGVkIHRvIGNoZWNrIHdoZXRoZXIgaHViIHNlcnZlciAiICsgaHViICsgIiBp\ncyBhbGl2ZSEiKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICB9LCBjdHgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgY2hvb3NlTGVhc3RMb2FkZWRIdWIoZmluYWwgQ2FsbGJhY2s8\nSHViSW5mbz4gY2FsbGJhY2ssIE9iamVjdCBjdHgpIHsKICAgICAgICAvLyBH\nZXQgdGhlIGxpc3Qgb2YgZXhpc3RpbmcgaG9zdHMKICAgICAgICB6ay5nZXRD\naGlsZHJlbihodWJOb2Rlc1BhdGgsIGZhbHNlLCBuZXcgU2FmZUFzeW5jWktD\nYWxsYmFjay5DaGlsZHJlbkNhbGxiYWNrKCkgewogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVByb2Nlc3NSZXN1\nbHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTGlzdDxTdHJpbmc+\nIGNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5P\nSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgS2VlcGVyRXhj\nZXB0aW9uIGUgPSBaa1V0aWxzLmxvZ0Vycm9yQW5kQ3JlYXRlWktFeGNlcHRp\nb24oCiAgICAgICAgICAgICAgICAgICAgICAgICJDb3VsZCBub3QgZ2V0IGxp\nc3Qgb2YgYXZhaWxhYmxlIGh1YnMiLCBwYXRoLCByYyk7CiAgICAgICAgICAg\nICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1\nYlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgY2hvb3NlTGVhc3RMb2FkZWROb2RlKGNoaWxkcmVuLCBj\nYWxsYmFjaywgY3R4KTsKICAgICAgICAgICAgfQogICAgICAgIH0sIGN0eCk7\nCiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNob29zZUxlYXN0TG9hZGVkTm9k\nZShmaW5hbCBMaXN0PFN0cmluZz4gY2hpbGRyZW4sCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNrPEh1Yklu\nZm8+IGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgU2FmZUFzeW5j\nWktDYWxsYmFjay5EYXRhQ2FsbGJhY2sgZGF0YUNhbGxiYWNrID0gbmV3IFNh\nZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrKCkgewogICAgICAgICAg\nICBpbnQgbnVtUmVzcG9uc2VzID0gMDsKICAgICAgICAgICAgSHViTG9hZCBt\naW5Mb2FkID0gSHViTG9hZC5NQVhfTE9BRDsKICAgICAgICAgICAgU3RyaW5n\nIGxlYXN0TG9hZGVkID0gbnVsbDsKICAgICAgICAgICAgbG9uZyBsZWFzdExv\nYWRlZEN6eGlkID0gMDsKCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0\ncmluZyBwYXRoLCBPYmplY3QgY3R4LAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBieXRlW10gZGF0YSwgU3RhdCBzdGF0KSB7\nCiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAocmMgPT0gS2VlcGVyRXhjZXB0aW9uLkNvZGUu\nT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgSHViTG9hZCBsb2FkID0g\nSHViTG9hZC5wYXJzZShuZXcgU3RyaW5nKGRhdGEsIFVURl84KSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkZvdW5kIHNl\ncnZlciB7fSB3aXRoIGxvYWQ6IHt9IiwgY3R4LCBsb2FkKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGludCBjb21wYXJlUmVzID0gbG9hZC5jb21w\nYXJlVG8obWluTG9hZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoY29tcGFyZVJlcyA8IDAgfHwgKGNvbXBhcmVSZXMgPT0gMCAmJiByYW5k\nLm5leHRCb29sZWFuKCkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbWluTG9hZCA9IGxvYWQ7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbGVhc3RMb2FkZWQgPSAoU3RyaW5nKSBjdHg7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGVhc3RMb2FkZWRDenhpZCA9IHN0\nYXQuZ2V0Q3p4aWQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSHViTG9hZC5JbnZh\nbGlkSHViTG9hZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIud2FybigiQ29ycnVwdGVkIGxvYWQgaW5mb3JtYXRp\nb24gZnJvbSBodWIgOiAiICsgY3R4KTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIHNvbWUgY29ycnVwdGVkIGRhdGEsIHdlJ2xsIGp1c3QgaWdu\nb3JlIHRoaXMgaHViCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbnVtUmVzcG9u\nc2VzKys7CgogICAgICAgICAgICAgICAgICAgIGlmIChudW1SZXNwb25zZXMg\nPT0gY2hpbGRyZW4uc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChsZWFzdExvYWRlZCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GYWlsZWQoY3R4LAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBQdWJTdWJFeGNlcHRp\nb24uU2VydmljZURvd25FeGNlcHRpb24oIk5vIGh1YiBhdmFpbGFibGUiKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEhlZHdpZ1NvY2tldEFk\nZHJlc3Mgb3duZXIgPSBuZXcgSGVkd2lnU29ja2V0QWRkcmVzcyhsZWFzdExv\nYWRlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5v\ncGVyYXRpb25GaW5pc2hlZChjdHgsIG5ldyBIdWJJbmZvKG93bmVyLCBsZWFz\ndExvYWRlZEN6eGlkKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKFRocm93YWJsZSB0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjYWxsYmFjay5vcGVyYXRpb25GYWlsZWQoY3R4LAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG5ldyBQdWJTdWJFeGNlcHRpb24uU2Vydmlj\nZURvd25FeGNlcHRpb24oIkxlYXN0IGxvYWRlZCBodWIgc2VydmVyICIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIGxlYXN0TG9hZGVkICsgIiBpcyBp\nbnZhbGlkLiIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH07CgogICAgICAgIGZvciAoU3RyaW5nIGNoaWxkIDogY2hp\nbGRyZW4pIHsKICAgICAgICAgICAgemsuZ2V0RGF0YShjb25mLmdldFprSG9z\ndHNQcmVmaXgobmV3IFN0cmluZ0J1aWxkZXIoKSkuYXBwZW5kKCIvIikuYXBw\nZW5kKGNoaWxkKS50b1N0cmluZygpLCBmYWxzZSwKICAgICAgICAgICAgICAg\nICAgICAgICBkYXRhQ2FsbGJhY2ssIGNoaWxkKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBHZXQgYSBtYXAgb2YgYWxsIGN1cnJlbnRseSBh\nY3RpdmUgaHVicyB3aXRoIHRoZWlyIGFkdmVydGlzZWQgbG9hZC4KICAgICAq\nIEBwYXJhbSBjYWxsYmFjawogICAgICogQHBhcmFtIG9yaWdpbmFsQ3R4CiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRBY3RpdmVIdWJzSW5mb1dpdGhM\nb2FkKGZpbmFsIENhbGxiYWNrPE1hcDxIdWJJbmZvLCBIdWJMb2FkPj4gY2Fs\nbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmaW5hbCBPYmplY3Qgb3JpZ2luYWxDdHgpIHsKICAgICAgICAvLyBH\nZXQgdGhlIGxpc3Qgb2YgY2hpbGRyZW4gYW5kIHRoZW4gZm9yIGVhY2ggY2hp\nbGQsIGdldCB0aGUgZGF0YS4gQWxsIGFzeW5jaHJvbm91c2x5LgogICAgICAg\nIHprLmdldENoaWxkcmVuKGh1Yk5vZGVzUGF0aCwgZmFsc2UsIG5ldyBTYWZl\nQXN5bmNaS0NhbGxiYWNrLkNoaWxkcmVuQ2FsbGJhY2soKSB7CiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUHJv\nY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBm\naW5hbCBMaXN0PFN0cmluZz4gY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAg\nIGlmIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBLZWVwZXJFeGNlcHRpb24gZSA9IFprVXRpbHMubG9nRXJyb3JB\nbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICJDb3VsZCBub3QgZ2V0IGNoaWxkcmVuIGZvciBnaXZlbiBwYXRoIiwg\ncGF0aCwgcmMpOwogICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJh\ndGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURv\nd25FeGNlcHRpb24oZSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUaGUgZGF0\nYSBjYWxsYmFjayBmb3IgZXZlcnkgY2hpbGQgbm9kZQogICAgICAgICAgICAg\nICAgU2FmZUFzeW5jWktDYWxsYmFjay5EYXRhQ2FsbGJhY2sgZGF0YUNhbGxi\nYWNrID0gbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrKCkg\newogICAgICAgICAgICAgICAgICAgIE1hcDxIdWJJbmZvLCBIdWJMb2FkPiBs\nb2FkTWFwID0gbmV3IEhhc2hNYXA8SHViSW5mbywgSHViTG9hZD4oKTsKICAg\nICAgICAgICAgICAgICAgICBpbnQgbnVtUmVzcG9uc2UgPSAwOwogICAgICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBh\ndGgsIE9iamVjdCBkYXRhQ3R4LAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBkYXRhLCBTdGF0IHN0\nYXQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkICh0\naGlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0g\nQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gUHV0IHRoaXMgbG9hZCBpbiB0aGUgbWFwLiBkYXRhQ3R4\nIGlzIGFjdHVhbGx5IHRoZSBjaGlsZCBzdHJpbmcgd2hpY2ggaXMgdGhlCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSVA6UE9SVDpTU0wg\ncmVwcmVzZW50YXRpb24gb2YgdGhlIGh1Yi4KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBIdWJJbmZvIGh1YkluZm8gPQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEh1YkluZm8obmV3IEhlZHdp\nZ1NvY2tldEFkZHJlc3MoKFN0cmluZylkYXRhQ3R4KSwgc3RhdC5nZXRDenhp\nZCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgSHVi\nTG9hZCBodWJMb2FkID0gSHViTG9hZC5wYXJzZShuZXcgU3RyaW5nKGRhdGEs\nIFVURl84KSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHRoaXMubG9hZE1hcC5wdXQoaHViSW5mbywgaHViTG9hZCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSHViTG9hZC5JbnZh\nbGlkSHViTG9hZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJDb3JydXB0IGRhdGEgZm91\nbmQgZm9yIGEgaHViLiBJZ25vcmluZy4iKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1SZXNwb25zZSsrOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bVJlc3BvbnNlID09\nIGNoaWxkcmVuLnNpemUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIFdlIGdvdCBsZXNzIG51bWJlciBvZiB2YWxpZCByZXNwb25z\nZXMgdGhhbiB0aGUgaHVicyB3ZSBzYXcgcHJldmlvdXNseS4KICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyBTaWduYWwgYW4gZXJyb3IuCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRNYXAuc2l6\nZSgpICE9IG51bVJlc3BvbnNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChvcmlnaW5h\nbEN0eCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG5ldyBQdWJTdWJFeGNlcHRpb24uVW5leHBlY3RlZENvbmRpdGlvbkV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICJGZXdlciBPSyByZXNwb25zZXMgdGhhbiB0aGUgbnVtYmVyIG9mIGFj\ndGl2ZSBodWJzIHNlZW4gcHJldmlvdXNseS4iKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gV2UndmUgc2VlbiBhbGwgcmVzcG9uc2VzLiBBbGwgT0suCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0\naW9uRmluaXNoZWQob3JpZ2luYWxDdHgsIGxvYWRNYXApOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAg\nICAgICAgICAgICAgICBmb3IgKFN0cmluZyBjaGlsZCA6IGNoaWxkcmVuKSB7\nCiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIHpub2RlID0gY29uZi5nZXRa\na0hvc3RzUHJlZml4KG5ldyBTdHJpbmdCdWlsZGVyKCkpLmFwcGVuZCgiLyIp\nLmFwcGVuZChjaGlsZCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAg\nICB6ay5nZXREYXRhKHpub2RlLCBmYWxzZSwgZGF0YUNhbGxiYWNrLCBjaGls\nZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nLCBvcmlnaW5hbEN0eCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgdm9pZCByZWJhbGFuY2VDbHVzdGVyKGZpbmFsIGRvdWJsZSB0b2xlcmFu\nY2VQZXJjZW50YWdlLCBmaW5hbCBIdWJMb2FkIG1heExvYWRUb1NoZWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNr\nPEJvb2xlYW4+IGNhbGxiYWNrLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAg\nICAgLy8gR2V0IHRoZSBsb2FkIG9uIGFsbCBhY3RpdmUgaHVicyBhbmQgdGhl\nbiBzaGVkIGxvYWQgaWYgcmVxdWlyZWQuCiAgICAgICAgZ2V0QWN0aXZlSHVi\nc0luZm9XaXRoTG9hZChuZXcgQ2FsbGJhY2s8TWFwPEh1YkluZm8sIEh1Ykxv\nYWQ+PigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIE1hcDxI\ndWJJbmZvLCBIdWJMb2FkPiBsb2FkTWFwKSB7CiAgICAgICAgICAgICAgICBp\nZiAobnVsbCA9PSB0bSkgewogICAgICAgICAgICAgICAgICAgIC8vIE5vIHRv\ncGljIG1hbmFnZXIsIHNvIG5vIGxvYWQgdG8gc2hlZC4KICAgICAgICAgICAg\nICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjdHgsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBUb3BpY0Jhc2VkTG9hZFNoZWRkZXIgdGJs\ncyA9IG5ldyBUb3BpY0Jhc2VkTG9hZFNoZWRkZXIodG0sCiAgICAgICAgICAg\nICAgICAgICAgICAgIHRvbGVyYW5jZVBlcmNlbnRhZ2UsIG1heExvYWRUb1No\nZWQpOwogICAgICAgICAgICAgICAgdGJscy5zaGVkTG9hZChsb2FkTWFwLCBj\nYWxsYmFjaywgY3R4KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxl\nZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICAgICAgLy8gUmViYWxhbmNlIGZhaWxlZC4gTG9nIHRoaXMgYW5kIHNpZ25h\nbCBmYWlsdXJlIG9uIHRoZSBjYWxsYmFjay4KICAgICAgICAgICAgICAgIGxv\nZ2dlci5lcnJvcigiRmFpbGVkIHRvIGdldCBhY3RpdmUgaHVicy4gQ2Fubm90\nIGF0dGVtcHQgYSByZWJhbGFuY2UuIik7CiAgICAgICAgICAgICAgICBjYWxs\nYmFjay5vcGVyYXRpb25GYWlsZWQoY3R4LCBlKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0sIGN0eCk7CiAgICB9CgoKfQo=\n","encoding":"base64"}

