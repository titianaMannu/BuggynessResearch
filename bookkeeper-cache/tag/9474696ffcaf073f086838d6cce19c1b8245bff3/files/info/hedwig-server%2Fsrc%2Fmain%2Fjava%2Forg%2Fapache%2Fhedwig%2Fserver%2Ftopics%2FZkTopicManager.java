{"sha":"12744fdd9a462fd243bac16638863d3dfe457540","node_id":"MDQ6QmxvYjE1NzU5NTY6MTI3NDRmZGQ5YTQ2MmZkMjQzYmFjMTY2Mzg4NjNkM2RmZTQ1NzU0MA==","size":15064,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/12744fdd9a462fd243bac16638863d3dfe457540","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIGphdmEubmV0LlVua25vd25Ib3N0RXhjZXB0aW9uOwppbXBvcnQgamF2YS5p\nby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNj\naGVkdWxlZEV4ZWN1dG9yU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LlN5bmNocm9ub3VzUXVldWU7CgppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuQ3JlYXRlTW9kZTsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Db2RlOwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5kYXRhLlN0YXQ7CgppbXBvcnQgc3RhdGljIGNvbS5nb29n\nbGUuY29tbW9uLmJhc2UuQ2hhcnNldHMuVVRGXzg7CmltcG9ydCBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNvbmN1cnJlbmN5VXRpbHM7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkVpdGhlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuSGVkd2lnU29ja2V0QWRkcmVzczsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBlci5TYWZlQXN5bmNa\nS0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuem9va2VlcGVy\nLlprVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy56b29rZWVwZXIu\nU2FmZUFzeW5jWktDYWxsYmFjay5EYXRhQ2FsbGJhY2s7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy56b29rZWVwZXIuU2FmZUFzeW5jWktDYWxsYmFjay5T\ndGF0Q2FsbGJhY2s7CgovKioKICogVG9waWNzIGFyZSBvcGVyYXRlZCBvbiBp\nbiBwYXJhbGxlbCBhcyB0aGV5IGFyZSBpbmRlcGVuZGVudC4KICoKICovCnB1\nYmxpYyBjbGFzcyBaa1RvcGljTWFuYWdlciBleHRlbmRzIEFic3RyYWN0VG9w\naWNNYW5hZ2VyIGltcGxlbWVudHMgVG9waWNNYW5hZ2VyIHsKCiAgICBzdGF0\naWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFpr\nVG9waWNNYW5hZ2VyLmNsYXNzKTsKCiAgICAvKioKICAgICAqIFBlcnNpc3Rl\nbnQgc3RvcmFnZSBmb3IgdG9waWMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHBy\naXZhdGUgWm9vS2VlcGVyIHprOwoKICAgIC8vIGh1YiBzZXJ2ZXIgbWFuYWdl\ncgogICAgcHJpdmF0ZSBmaW5hbCBIdWJTZXJ2ZXJNYW5hZ2VyIGh1Yk1hbmFn\nZXI7CgogICAgcHJpdmF0ZSBmaW5hbCBIdWJJbmZvIG15SHViSW5mbzsKICAg\nIHByaXZhdGUgZmluYWwgSHViTG9hZCBteUh1YkxvYWQ7CgogICAgLy8gQm9v\nbGVhbiBmbGFnIGluZGljYXRpbmcgaWYgd2Ugc2hvdWxkIHN1c3BlbmQgYWN0\naXZpdHkuIElmIHRoaXMgaXMgdHJ1ZSwKICAgIC8vIGFsbCBvZiB0aGUgT3Bz\nIHB1dCBpbnRvIHRoZSBxdWV1ZXIgd2lsbCBmYWlsIGF1dG9tYXRpY2FsbHku\nCiAgICBwcm90ZWN0ZWQgdm9sYXRpbGUgYm9vbGVhbiBpc1N1c3BlbmRlZCA9\nIGZhbHNlOwoKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHRvcGljIG1h\nbmFnZXIuIFBhc3MgaW4gYW4gYWN0aXZlIFpvb0tlZXBlciBjbGllbnQgb2Jq\nZWN0LgogICAgICoKICAgICAqIEBwYXJhbSB6awogICAgICovCiAgICBwdWJs\naWMgWmtUb3BpY01hbmFnZXIoZmluYWwgWm9vS2VlcGVyIHprLCBmaW5hbCBT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNmZywgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2\naWNlIHNjaGVkdWxlcikKICAgICAgICAgICAgdGhyb3dzIFVua25vd25Ib3N0\nRXhjZXB0aW9uLCBQdWJTdWJFeGNlcHRpb24gewoKICAgICAgICBzdXBlcihj\nZmcsIHNjaGVkdWxlcik7CiAgICAgICAgdGhpcy56ayA9IHprOwogICAgICAg\nIHRoaXMuaHViTWFuYWdlciA9IG5ldyBaa0h1YlNlcnZlck1hbmFnZXIoY2Zn\nLCB6aywgYWRkciwgdGhpcyk7CgogICAgICAgIG15SHViTG9hZCA9IG5ldyBI\ndWJMb2FkKHRvcGljcy5zaXplKCkpOwogICAgICAgIHRoaXMuaHViTWFuYWdl\nci5yZWdpc3Rlckxpc3RlbmVyKG5ldyBIdWJTZXJ2ZXJNYW5hZ2VyLk1hbmFn\nZXJMaXN0ZW5lcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIG9uU3VzcGVuZCgpIHsKICAgICAgICAgICAgICAg\nIGlzU3VzcGVuZGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb25SZXN1bWUo\nKSB7CiAgICAgICAgICAgICAgICBpc1N1c3BlbmRlZCA9IGZhbHNlOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBw\ndWJsaWMgdm9pZCBvblNodXRkb3duKCkgewogICAgICAgICAgICAgICAgLy8g\naWYgaHViIHNlcnZlciBtYW5hZ2VyIGNhbid0IHdvcmssIHdlIGhhZCB0byBx\ndWl0CiAgICAgICAgICAgICAgICBSdW50aW1lLmdldFJ1bnRpbWUoKS5leGl0\nKDEpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGZpbmFs\nIFN5bmNocm9ub3VzUXVldWU8RWl0aGVyPEh1YkluZm8sIFB1YlN1YkV4Y2Vw\ndGlvbj4+IHF1ZXVlID0KICAgICAgICAgICAgbmV3IFN5bmNocm9ub3VzUXVl\ndWU8RWl0aGVyPEh1YkluZm8sIFB1YlN1YkV4Y2VwdGlvbj4+KCk7CiAgICAg\nICAgdGhpcy5odWJNYW5hZ2VyLnJlZ2lzdGVyU2VsZihteUh1YkxvYWQsIG5l\ndyBDYWxsYmFjazxIdWJJbmZvPigpIHsKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKGZp\nbmFsIE9iamVjdCBjdHgsIGZpbmFsIEh1YkluZm8gcmVzdWx0T2ZPcGVyYXRp\nb24pIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJTdWNjZXNzZnVs\nbHkgcmVnaXN0ZXJlZCBodWIge30gd2l0aCB6b29rZWVwZXIiLCByZXN1bHRP\nZk9wZXJhdGlvbik7CiAgICAgICAgICAgICAgICBDb25jdXJyZW5jeVV0aWxz\nLnB1dChxdWV1ZSwgRWl0aGVyLm9mKHJlc3VsdE9mT3BlcmF0aW9uLCAoUHVi\nU3ViRXhjZXB0aW9uKSBudWxsKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9u\nKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkZhaWxlZCB0byBy\nZWdpc3RlciBodWIgd2l0aCB6b29rZWVwZXIiLCBleGNlcHRpb24pOwogICAg\nICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQocXVldWUsIEVpdGhl\nci5vZigoSHViSW5mbyludWxsLCBleGNlcHRpb24pKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0sIG51bGwpOwoKICAgICAgICBFaXRoZXI8SHViSW5mbywg\nUHViU3ViRXhjZXB0aW9uPiByZXN1bHQgPSBDb25jdXJyZW5jeVV0aWxzLnRh\na2UocXVldWUpOwogICAgICAgIFB1YlN1YkV4Y2VwdGlvbiBwc2UgPSByZXN1\nbHQucmlnaHQoKTsKICAgICAgICBpZiAocHNlICE9IG51bGwpIHsKICAgICAg\nICAgICAgdGhyb3cgcHNlOwogICAgICAgIH0KICAgICAgICBteUh1YkluZm8g\nPSByZXN1bHQubGVmdCgpOwogICAgfQoKICAgIFN0cmluZyBodWJQYXRoKEJ5\ndGVTdHJpbmcgdG9waWMpIHsKICAgICAgICByZXR1cm4gY2ZnLmdldFprVG9w\naWNQYXRoKG5ldyBTdHJpbmdCdWlsZGVyKCksIHRvcGljKS5hcHBlbmQoIi9o\ndWIiKS50b1N0cmluZygpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJv\ndGVjdGVkIHZvaWQgcmVhbEdldE93bmVyKGZpbmFsIEJ5dGVTdHJpbmcgdG9w\naWMsIGZpbmFsIGJvb2xlYW4gc2hvdWxkQ2xhaW0sCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmluYWwgQ2FsbGJhY2s8SGVkd2lnU29ja2V0\nQWRkcmVzcz4gY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICAvLyBJ\nZiBvcGVyYXRpb25zIGFyZSBzdXNwZW5kZWQgZHVlIHRvIGEgWksgY2xpZW50\nIGRpc2Nvbm5lY3QsIGp1c3QgZXJyb3IKICAgICAgICAvLyBvdXQgdGhpcyBj\nYWxsIGFuZCByZXR1cm4uCiAgICAgICAgaWYgKGlzU3VzcGVuZGVkKSB7CiAg\nICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJF\neGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIlpLVG9waWNNYW5hZ2VyIHNlcnZpY2Ug\naXMgdGVtcG9yYXJpbHkgc3VzcGVuZGVkISIpKTsKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgVG9waWNTdGF0cyBzdGF0cyA9IHRv\ncGljcy5nZXRJZlByZXNlbnQodG9waWMpOwogICAgICAgIGlmIChudWxsICE9\nIHN0YXRzKSB7CiAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0\neCwgYWRkcik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAg\nICAgIG5ldyBaa0dldE93bmVyT3AodG9waWMsIHNob3VsZENsYWltLCBjYiwg\nY3R4KS5yZWFkKCk7CiAgICB9CgogICAgLy8gUmVjdXJzaXZlbHkgY2FsbCBl\nYWNoIG90aGVyLgogICAgY2xhc3MgWmtHZXRPd25lck9wIHsKICAgICAgICBC\neXRlU3RyaW5nIHRvcGljOwogICAgICAgIGJvb2xlYW4gc2hvdWxkQ2xhaW07\nCiAgICAgICAgQ2FsbGJhY2s8SGVkd2lnU29ja2V0QWRkcmVzcz4gY2I7CiAg\nICAgICAgT2JqZWN0IGN0eDsKICAgICAgICBTdHJpbmcgaHViUGF0aDsKCiAg\nICAgICAgcHVibGljIFprR2V0T3duZXJPcChCeXRlU3RyaW5nIHRvcGljLCBi\nb29sZWFuIHNob3VsZENsYWltLCBDYWxsYmFjazxIZWR3aWdTb2NrZXRBZGRy\nZXNzPiBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICB0aGlzLnRvcGlj\nID0gdG9waWM7CiAgICAgICAgICAgIHRoaXMuc2hvdWxkQ2xhaW0gPSBzaG91\nbGRDbGFpbTsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAgICAgICAg\nICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICAgICAgaHViUGF0aCA9IGh1YlBh\ndGgodG9waWMpOwoKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNo\nb29zZSgpIHsKICAgICAgICAgICAgaHViTWFuYWdlci5jaG9vc2VMZWFzdExv\nYWRlZEh1YihuZXcgQ2FsbGJhY2s8SHViSW5mbz4oKSB7CiAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9w\nZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIEh1YkluZm8gb3duZXIpIHsK\nICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygie30gOiBMZWFzdCBs\nb2FkZWQgb3duZXIge30gaXMgY2hvc2VuIGZvciB0b3BpYyB7fSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgYWRk\nciwgb3duZXIsIHRvcGljLnRvU3RyaW5nVXRmOCgpIH0pOwogICAgICAgICAg\nICAgICAgICAgIGlmIChvd25lci5nZXRBZGRyZXNzKCkuZXF1YWxzKGFkZHIp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsYWltKCk7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nY2Iub3BlcmF0aW9uRmluaXNoZWQoWmtHZXRPd25lck9wLnRoaXMuY3R4LCBv\nd25lci5nZXRBZGRyZXNzKCkpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVj\ndCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBwc2UpIHsKICAgICAgICAgICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIkZhaWxlZCB0byBjaG9vc2UgbGVhc3QgbG9h\nZGVkIGh1YiBzZXJ2ZXIgZm9yIHRvcGljICIKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIDogIiwg\ncHNlKTsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQo\nY3R4LCBwc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBu\ndWxsKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsYWltT3JD\naG9vc2UoKSB7CiAgICAgICAgICAgIGlmIChzaG91bGRDbGFpbSkKICAgICAg\nICAgICAgICAgIGNsYWltKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAgICAg\nICAgICAgIGNob29zZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZv\naWQgcmVhZCgpIHsKICAgICAgICAgICAgemsuZ2V0RGF0YShodWJQYXRoLCBm\nYWxzZSwgbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrKCkg\newogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBw\nYXRoLCBPYmplY3QgY3R4LCBieXRlW10gZGF0YSwgU3RhdCBzdGF0KSB7Cgog\nICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBDb2RlLk5PTk9ERS5pbnRW\nYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsYWltT3JDaG9v\nc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9\nIENvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBLZWVwZXJFeGNlcHRpb24gZSA9IFprVXRpbHMubG9nRXJyb3JBbmRDcmVh\ndGVaS0V4Y2VwdGlvbigiQ291bGQgbm90IHJlYWQgb3duZXJzaGlwIGZvciB0\nb3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCksIHBhdGgsIHJjKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwg\nbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxs\neSBkaWQgYSByZWFkCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgSHViSW5mbyBvd25lckh1YkluZm8gPSBIdWJJ\nbmZvLnBhcnNlKG5ldyBTdHJpbmcoZGF0YSwgVVRGXzgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgSGVkd2lnU29ja2V0QWRkcmVzcyBvd25lciA9IG93\nbmVySHViSW5mby5nZXRBZGRyZXNzKCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmICghb3duZXIuZXF1YWxzKGFkZHIpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWco\nInRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIGJlbG9uZ3Mg\ndG8gc29tZW9uZSBlbHNlOiAiICsgb3duZXIpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uRmluaXNoZWQoY3R4LCBvd25lcik7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIkRpc2Nv\ndmVyZWQgc3RhbGUgc2VsZi1ub2RlIGZvciB0b3BpYzogIiArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpICsgIiwgd2lsbCBkZWxldGUgaXQiKTsKICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChIdWJJbmZvLkludmFsaWRIdWJJbmZvRXhj\nZXB0aW9uIGloaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2Vy\nLmluZm8oIkRpc2NvdmVyZWQgaW52YWxpZCBodWIgaW5mbyBmb3IgdG9waWM6\nICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIHdpbGwgZGVsZXRlIGl0\nIDogIiwgaWhpZSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICAvLyB3ZSBtdXN0IGhhdmUgcHJldmlvdXNseSBmYWlsZWQg\nYW5kIGxlZnQgYQogICAgICAgICAgICAgICAgICAgIC8vIHJlc2lkdWFsIGVw\naGVtZXJhbCBub2RlIGhlcmUsIHNvIHdlIG11c3QKICAgICAgICAgICAgICAg\nICAgICAvLyBkZWxldGUgaXQgKGNsZWFuIGl0IHVwKSBhbmQgdGhlbgogICAg\nICAgICAgICAgICAgICAgIC8vIHJlLWNyZWF0ZS9yZS1hY3F1aXJlIHRoZSB0\nb3BpYy4KICAgICAgICAgICAgICAgICAgICB6ay5kZWxldGUoaHViUGF0aCwg\nc3RhdC5nZXRWZXJzaW9uKCksIG5ldyBWb2lkQ2FsbGJhY2soKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3Ry\naW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChDb2RlLk9LLmludFZhbHVlKCkgPT0gcmMgfHwgQ29kZS5O\nT05PREUuaW50VmFsdWUoKSA9PSByYykgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNsYWltT3JDaG9vc2UoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIGUgPSBaa1V0aWxzLmxvZ0Vycm9y\nQW5kQ3JlYXRlWktFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNvdWxkIG5vdCBk\nZWxldGUgc2VsZiBub2RlIGZvciB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5n\nVXRmOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2Vw\ndGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9LCBjdHgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgY2xhaW0oKSB7CiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1\nZ0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJj\nbGFpbWluZyB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgWmtVdGlscy5jcmVhdGVGdWxsUGF0\naE9wdGltaXN0aWMoemssIGh1YlBhdGgsCiAgICAgICAgICAgICAgICAgICAg\nbXlIdWJJbmZvLnRvU3RyaW5nKCkuZ2V0Qnl0ZXMoVVRGXzgpLCBJZHMuT1BF\nTl9BQ0xfVU5TQUZFLAogICAgICAgICAgICAgICAgICAgIENyZWF0ZU1vZGUu\nRVBIRU1FUkFMLCBuZXcgU2FmZUFzeW5jWktDYWxsYmFjay5TdHJpbmdDYWxs\nYmFjaygpIHsKCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywg\nU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsIFN0cmluZyBuYW1lKSB7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHJjID09IENvZGUuT0suaW50VmFsdWUoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dl\nci5kZWJ1ZygiY2xhaW1lZCB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICBub3RpZnlMaXN0ZW5lcnNBbmRBZGRUb093bmVkVG9waWNz\nKHRvcGljLCBjYiwgY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgaHVi\nTWFuYWdlci51cGxvYWRTZWxmTG9hZERhdGEobXlIdWJMb2FkLnNldE51bVRv\ncGljcyh0b3BpY3Muc2l6ZSgpKSk7CiAgICAgICAgICAgICAgICAgICAgfSBl\nbHNlIGlmIChyYyA9PSBDb2RlLk5PREVFWElTVFMuaW50VmFsdWUoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICByZWFkKCk7CiAgICAgICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgS2VlcGVy\nRXhjZXB0aW9uIGUgPSBaa1V0aWxzLmxvZ0Vycm9yQW5kQ3JlYXRlWktFeGNl\ncHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICJGYWlsZWQgdG8gY3JlYXRlIGVwaGVtZXJhbCBub2RlIHRv\nIGNsYWltIG93bmVyc2hpcCBvZiB0b3BpYzogIgogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3Ry\naW5nVXRmOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24u\nU2VydmljZURvd25FeGNlcHRpb24oZSkpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgY3R4KTsKICAg\nICAgICB9CgogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIHZv\naWQgcG9zdFJlbGVhc2VDbGVhbnVwKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMs\nIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNiLCBPYmplY3QgY3R4KSB7CgogICAg\nICAgIC8vIFJlZHVjZSBsb2FkLiBXZSd2ZSByZW1vdmVkIHRoZSB0b3BpYyBm\ncm9tIG91ciB0b3BpYyBzZXQsIHNvIGRvIHRoaXMgYXMgd2VsbC4KICAgICAg\nICAvLyBXaGVuIHdlIHJlY2xhaW0gdGhlIHRvcGljLCB3ZSB3aWxsIGluY3Jl\nbWVudCB0aGUgbG9hZCBhZ2Fpbi4KICAgICAgICBodWJNYW5hZ2VyLnVwbG9h\nZFNlbGZMb2FkRGF0YShteUh1YkxvYWQuc2V0TnVtVG9waWNzKHRvcGljcy5z\naXplKCkpKTsKCiAgICAgICAgemsuZ2V0RGF0YShodWJQYXRoKHRvcGljKSwg\nZmFsc2UsIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLkRhdGFDYWxsYmFjaygp\nIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9i\namVjdCBjdHgsIGJ5dGVbXSBkYXRhLCBTdGF0IHN0YXQpIHsKICAgICAgICAg\nICAgICAgIGlmIChyYyA9PSBDb2RlLk5PTk9ERS5pbnRWYWx1ZSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgLy8gTm9kZSBoYXMgc29tZWhvdyBkaXNhcHBl\nYXJlZCBmcm9tIHVuZGVyIHVzLCBsaXZlIHdpdGggaXQKICAgICAgICAgICAg\nICAgICAgICAvLyBzaW5jZSBpdHMgYSB0cmFuc2llbnQgbm9kZQogICAgICAg\nICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJXaGlsZSBkZWxldGluZyBzZWxm\nLW5vZGUgZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAi\nLCBub2RlIG5vdCBmb3VuZCIpOwogICAgICAgICAgICAgICAgICAgIGNiLm9w\nZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nIGlmIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBLZWVwZXJFeGNlcHRpb24gZSA9IFprVXRpbHMubG9nRXJyb3JB\nbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAiRmFpbGVkIHRvIGRlbGV0ZSBzZWxmLW93\nbmVyc2hpcCBub2RlIGZvciB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0\naW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93\nbkV4Y2VwdGlvbihlKSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFN0cmluZyBodWJJ\nbmZvU3RyID0gbmV3IFN0cmluZyhkYXRhLCBVVEZfOCk7CiAgICAgICAgICAg\nICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIEh1YkluZm8gb3duZXJI\ndWJJbmZvID0gSHViSW5mby5wYXJzZShodWJJbmZvU3RyKTsKICAgICAgICAg\nICAgICAgICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIG93bmVyID0gb3duZXJI\ndWJJbmZvLmdldEFkZHJlc3MoKTsKICAgICAgICAgICAgICAgICAgICBpZiAo\nIW93bmVyLmVxdWFscyhhZGRyKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIud2FybigiV2FudGVkIHRvIGRlbGV0ZSBzZWxmLW5vZGUgZm9y\nIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiIGJ1dCBub2Rl\nIGZvciAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nb3duZXIgKyAiIGZvdW5kLCBsZWF2aW5nIHVudG91Y2hlZCIpOwogICAgICAg\nICAgICAgICAgICAgICAgICAvLyBOb3Qgb3VyIG5vZGUsIHNvbWVvbmUgZWxz\nZSdzLCBsZWF2ZSBpdCBhbG9uZQogICAgICAgICAgICAgICAgICAgICAgICBj\nYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoSHViSW5mby5JbnZhbGlkSHViSW5mb0V4\nY2VwdGlvbiBpaGllKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmlu\nZm8oIkludmFsaWQgaHViIGluZm8gIiArIGh1YkluZm9TdHIgKyAiIGZvdW5k\nIHdoZW4gcmVsZWFzZSB0b3BpYyAiCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiLiBMZWF2aW5nIHVu\ndG91Y2hlZCB1bnRpbCBuZXh0IGFjcXVpcmUgYWN0aW9uLiIpOwogICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIHprLmRlbGV0ZShwYXRoLCBzdGF0LmdldFZl\ncnNpb24oKSwgbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suVm9pZENhbGxiYWNr\nKCkgewogICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCBy\nYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFsdWUoKSAmJiByYyAh\nPSBDb2RlLk5PTk9ERS5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24gZSA9IFprVXRpbHMKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmxv\nZ0Vycm9yQW5kQ3JlYXRlWktFeGNlcHRpb24oIkZhaWxlZCB0byBkZWxldGUg\nc2VsZi1vd25lcnNoaXAgbm9kZSBmb3IgdG9waWM6ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nIHRvcGljLnRvU3RyaW5nVXRmOCgpLCBwYXRoLCByYyk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcg\nUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGUpKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3Bl\ncmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAgICB9CiAg\nICAgICAgfSwgY3R4KTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIHN0b3AoKSB7CiAgICAgICAgLy8gd2UganVzdCB1bnJlZ2lzdGVy\nIGl0IHdpdGggem9va2VlcGVyIHRvIG1ha2UgaXQgdW5hdmFpbGFibGUgZnJv\nbSBodWIgc2VydmVycyBsaXN0CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naHViTWFuYWdlci51bnJlZ2lzdGVyU2VsZigpOwogICAgICAgIH0gY2F0Y2gg\nKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJF\ncnJvciB1bnJlZ2lzdGVyaW5nIGh1YiBzZXJ2ZXIgOiIsIGUpOwogICAgICAg\nIH0KICAgICAgICBzdXBlci5zdG9wKCk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

