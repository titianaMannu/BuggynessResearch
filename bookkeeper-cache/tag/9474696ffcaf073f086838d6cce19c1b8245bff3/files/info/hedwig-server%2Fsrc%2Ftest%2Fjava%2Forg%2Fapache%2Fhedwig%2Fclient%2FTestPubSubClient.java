{"sha":"c206ce41f7603e7fab815d1703bd63717eae6b84","node_id":"MDQ6QmxvYjE1NzU5NTY6YzIwNmNlNDFmNzYwM2U3ZmFiODE1ZDE3MDNiZDYzNzE3ZWFlNmI4NA==","size":30953,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c206ce41f7603e7fab815d1703bd63717eae6b84","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQ7CgppbXBvcnQgamF2YS51\ndGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uOwppbXBv\ncnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TeW5jaHJvbm91c1F1ZXVlOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKCmlt\ncG9ydCBvcmcuanVuaXQuQWZ0ZXI7CmltcG9ydCBvcmcuanVuaXQuQmVmb3Jl\nOwppbXBvcnQgb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBvcmcuanVuaXQucnVu\nbmVyLlJ1bldpdGg7CmltcG9ydCBvcmcuanVuaXQucnVubmVycy5QYXJhbWV0\nZXJpemVkOwppbXBvcnQgb3JnLmp1bml0LnJ1bm5lcnMuUGFyYW1ldGVyaXpl\nZC5QYXJhbWV0ZXJzOwoKaW1wb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZzsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGku\nTWVzc2FnZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGll\nbnQuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuY2xpZW50LmFwaS5QdWJsaXNoZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5jbGllbnQuYXBpLlN1YnNjcmliZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0\naW9uLkNsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZVNlcUlkOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlc3BvbnNlOwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvbkV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9uczsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5QdWJTdWJTZXJ2ZXJTdGFuZEFsb25l\nVGVzdEJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxi\nYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5Db25jdXJyZW5j\neVV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5TdWJzY3Jp\ncHRpb25MaXN0ZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwu\nSGVkd2lnU29ja2V0QWRkcmVzczsKCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0\nLkFzc2VydC4qOwoKQFJ1bldpdGgoUGFyYW1ldGVyaXplZC5jbGFzcykKcHVi\nbGljIGNsYXNzIFRlc3RQdWJTdWJDbGllbnQgZXh0ZW5kcyBQdWJTdWJTZXJ2\nZXJTdGFuZEFsb25lVGVzdEJhc2UgewoKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGludCBSRVRFTlRJT05fU0VDU19WQUxVRSA9IDEwOwoKICAgIC8vIENs\naWVudCBzaWRlIHZhcmlhYmxlcwogICAgcHJvdGVjdGVkIEhlZHdpZ0NsaWVu\ndCBjbGllbnQ7CiAgICBwcm90ZWN0ZWQgUHVibGlzaGVyIHB1Ymxpc2hlcjsK\nICAgIHByb3RlY3RlZCBTdWJzY3JpYmVyIHN1YnNjcmliZXI7CgogICAgcHJv\ndGVjdGVkIGNsYXNzIFJldGVudGlvblNlcnZlckNvbmZpZ3VyYXRpb24gZXh0\nZW5kcyBTdGFuZEFsb25lU2VydmVyQ29uZmlndXJhdGlvbiB7CiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNTdGFuZGFsb25l\nKCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBpbnQgZ2V0UmV0ZW50aW9u\nU2VjcygpIHsKICAgICAgICAgICAgcmV0dXJuIFJFVEVOVElPTl9TRUNTX1ZB\nTFVFOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBTeW5jaHJvbm91c1F1ZXVl\ncyB0byB2ZXJpZnkgYXN5bmMgY2FsbHMKICAgIHByaXZhdGUgZmluYWwgU3lu\nY2hyb25vdXNRdWV1ZTxCb29sZWFuPiBxdWV1ZSA9IG5ldyBTeW5jaHJvbm91\nc1F1ZXVlPEJvb2xlYW4+KCk7CiAgICBwcml2YXRlIGZpbmFsIFN5bmNocm9u\nb3VzUXVldWU8Qm9vbGVhbj4gY29uc3VtZVF1ZXVlID0gbmV3IFN5bmNocm9u\nb3VzUXVldWU8Qm9vbGVhbj4oKTsKICAgIHByaXZhdGUgZmluYWwgU3luY2hy\nb25vdXNRdWV1ZTxTdWJzY3JpcHRpb25FdmVudD4gZXZlbnRRdWV1ZSA9CiAg\nICAgICAgbmV3IFN5bmNocm9ub3VzUXVldWU8U3Vic2NyaXB0aW9uRXZlbnQ+\nKCk7CgogICAgY2xhc3MgVGVzdFN1YnNjcmlwdGlvbkxpc3RlbmVyIGltcGxl\nbWVudHMgU3Vic2NyaXB0aW9uTGlzdGVuZXIgewogICAgICAgIFN5bmNocm9u\nb3VzUXVldWU8U3Vic2NyaXB0aW9uRXZlbnQ+IGV2ZW50UXVldWU7CiAgICAg\nICAgcHVibGljIFRlc3RTdWJzY3JpcHRpb25MaXN0ZW5lcigpIHsKICAgICAg\nICAgICAgdGhpcy5ldmVudFF1ZXVlID0gVGVzdFB1YlN1YkNsaWVudC50aGlz\nLmV2ZW50UXVldWU7CiAgICAgICAgfQogICAgICAgIHB1YmxpYyBUZXN0U3Vi\nc2NyaXB0aW9uTGlzdGVuZXIoU3luY2hyb25vdXNRdWV1ZTxTdWJzY3JpcHRp\nb25FdmVudD4gcXVldWUpIHsKICAgICAgICAgICAgdGhpcy5ldmVudFF1ZXVl\nID0gcXVldWU7CiAgICAgICAgfQogICAgICAgIEBPdmVycmlkZQogICAgICAg\nIHB1YmxpYyB2b2lkIHByb2Nlc3NFdmVudChmaW5hbCBCeXRlU3RyaW5nIHRv\ncGljLCBmaW5hbCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgU3Vic2NyaXB0aW9uRXZl\nbnQgZXZlbnQpIHsKICAgICAgICAgICAgbmV3IFRocmVhZChuZXcgUnVubmFi\nbGUoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICBs\nb2dnZXIuZGVidWcoIkV2ZW50IHt9IHJlY2VpdmVkIGZvciBzdWJzY3JpcHRp\nb24odG9waWM6e30sIHN1YnNjcmliZXI6e30pIiwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgZXZlbnQsIHRvcGlj\nLnRvU3RyaW5nVXRmOCgpLCBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkg\nfSk7CiAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQo\nVGVzdFN1YnNjcmlwdGlvbkxpc3RlbmVyLnRoaXMuZXZlbnRRdWV1ZSwgZXZl\nbnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5zdGFydCgp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBUZXN0IGltcGxlbWVudGF0aW9u\nIG9mIENhbGxiYWNrIGZvciBhc3luYyBjbGllbnQgYWN0aW9ucy4KICAgIGNs\nYXNzIFRlc3RDYWxsYmFjayBpbXBsZW1lbnRzIENhbGxiYWNrPFZvaWQ+IHsK\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0\naW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCByZXN1bHRPZk9wZXJhdGlv\nbikgewogICAgICAgICAgICBuZXcgVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsK\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIGlmIChsb2dn\nZXIuaXNEZWJ1Z0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nbG9nZ2VyLmRlYnVnKCJPcGVyYXRpb24gZmluaXNoZWQhIik7CiAgICAgICAg\nICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQocXVldWUsIHRydWUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS5zdGFydCgpOwog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIGZpbmFsIFB1YlN1YkV4\nY2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgbmV3IFRocmVhZChu\nZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIuZXJyb3IoIk9wZXJhdGlvbiBmYWlsZWQhIiwgZXhj\nZXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICBDb25jdXJyZW5jeVV0aWxz\nLnB1dChxdWV1ZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9KS5zdGFydCgpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBUZXN0\nIGltcGxlbWVudGF0aW9uIG9mIHN1YnNjcmliZXIncyBtZXNzYWdlIGhhbmRs\nZXIuCiAgICBjbGFzcyBUZXN0TWVzc2FnZUhhbmRsZXIgaW1wbGVtZW50cyBN\nZXNzYWdlSGFuZGxlciB7CgogICAgICAgIHByaXZhdGUgZmluYWwgU3luY2hy\nb25vdXNRdWV1ZTxCb29sZWFuPiBjb25zdW1lUXVldWU7CgogICAgICAgIHB1\nYmxpYyBUZXN0TWVzc2FnZUhhbmRsZXIoKSB7CiAgICAgICAgICAgIHRoaXMu\nY29uc3VtZVF1ZXVlID0gVGVzdFB1YlN1YkNsaWVudC50aGlzLmNvbnN1bWVR\ndWV1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBUZXN0TWVzc2FnZUhh\nbmRsZXIoU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPiBjb25zdW1lUXVldWUp\nIHsKICAgICAgICAgICAgdGhpcy5jb25zdW1lUXVldWUgPSBjb25zdW1lUXVl\ndWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBkZWxpdmVyKEJ5\ndGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBNZXNz\nYWdlIG1zZywgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBPYmplY3QgY29udGV4dCkgewogICAgICAgICAg\nICBuZXcgVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkg\newogICAgICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJs\nZWQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJD\nb25zdW1lIG9wZXJhdGlvbiBmaW5pc2hlZCBzdWNjZXNzZnVsbHkhIik7CiAg\nICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQoVGVzdE1l\nc3NhZ2VIYW5kbGVyLnRoaXMuY29uc3VtZVF1ZXVlLCB0cnVlKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSkuc3RhcnQoKTsKICAgICAgICAg\nICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4dCwgbnVsbCk7\nCiAgICAgICAgfQogICAgfQoKICAgIEBQYXJhbWV0ZXJzCiAgICBwdWJsaWMg\nc3RhdGljIENvbGxlY3Rpb248T2JqZWN0W10+IGNvbmZpZ3MoKSB7CiAgICAg\nICAgcmV0dXJuIEFycmF5cy5hc0xpc3QobmV3IE9iamVjdFtdW10geyB7IHRy\ndWUgfSwgeyBmYWxzZSB9IH0pOwogICAgfQoKICAgIHByb3RlY3RlZCBib29s\nZWFuIGlzU3Vic2NyaXB0aW9uQ2hhbm5lbFNoYXJpbmdFbmFibGVkOwoKICAg\nIHB1YmxpYyBUZXN0UHViU3ViQ2xpZW50KGJvb2xlYW4gaXNTdWJzY3JpcHRp\nb25DaGFubmVsU2hhcmluZ0VuYWJsZWQpIHsKICAgICAgICB0aGlzLmlzU3Vi\nc2NyaXB0aW9uQ2hhbm5lbFNoYXJpbmdFbmFibGVkID0gaXNTdWJzY3JpcHRp\nb25DaGFubmVsU2hhcmluZ0VuYWJsZWQ7CiAgICB9CgogICAgQE92ZXJyaWRl\nCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgY2xp\nZW50ID0gbmV3IEhlZHdpZ0NsaWVudChuZXcgQ2xpZW50Q29uZmlndXJhdGlv\nbigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyBIZWR3aWdTb2NrZXRBZGRyZXNzIGdldERlZmF1bHRTZXJ2ZXJIZWR3aWdT\nb2NrZXRBZGRyZXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldERl\nZmF1bHRIZWR3aWdBZGRyZXNzKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1N1\nYnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZCgpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBUZXN0UHViU3ViQ2xpZW50LnRoaXMuaXNTdWJzY3Jp\ncHRpb25DaGFubmVsU2hhcmluZ0VuYWJsZWQ7CiAgICAgICAgICAgIH0KICAg\nICAgICB9KTsKICAgICAgICBwdWJsaXNoZXIgPSBjbGllbnQuZ2V0UHVibGlz\naGVyKCk7CiAgICAgICAgc3Vic2NyaWJlciA9IGNsaWVudC5nZXRTdWJzY3Jp\nYmVyKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBAQWZ0ZXIKICAgIHB1\nYmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgY2xpZW50LmNsb3NlKCk7CiAgICAgICAgc3VwZXIudGVhckRvd24oKTsK\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFN5bmNQdWJsaXNoKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgYm9vbGVhbiBwdWJsaXNoU3VjY2VzcyA9IHRydWU7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgcHVibGlzaGVyLnB1Ymxpc2goQnl0ZVN0cmluZy5j\nb3B5RnJvbVV0ZjgoIm15U3luY1RvcGljIiksIE1lc3NhZ2UubmV3QnVpbGRl\ncigpLnNldEJvZHkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiSGVsbG8gU3luYyBXb3JsZCEi\nKSkuYnVpbGQoKSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgcHVibGlzaFN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB9\nCiAgICAgICAgYXNzZXJ0VHJ1ZShwdWJsaXNoU3VjY2Vzcyk7CiAgICB9Cgog\nICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RT\neW5jUHVibGlzaFdpdGhSZXNwb25zZSgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOCgidGVzdFN5bmNQdWJsaXNoV2l0aFJlc3BvbnNlIik7CiAgICAgICAg\nQnl0ZVN0cmluZyBzdWJpZCA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJt\neXN1YmlkIik7CgogICAgICAgIGZpbmFsIFN0cmluZyBwcmVmaXggPSAiU3lu\nY01lc3NhZ2UtIjsKICAgICAgICBmaW5hbCBpbnQgbnVtTWVzc2FnZXMgPSAz\nMDsKCiAgICAgICAgZmluYWwgTWFwPFN0cmluZywgTWVzc2FnZVNlcUlkPiBw\ndWJsaXNoZWRNc2dzID0KICAgICAgICAgICAgbmV3IEhhc2hNYXA8U3RyaW5n\nLCBNZXNzYWdlU2VxSWQ+KCk7CgogICAgICAgIGZpbmFsIEF0b21pY0ludGVn\nZXIgbnVtUmVjZWl2ZWQgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAgICAg\nICBmaW5hbCBDb3VudERvd25MYXRjaCByZWNlaXZlTGF0Y2ggPSBuZXcgQ291\nbnREb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgTWFwPFN0cmluZywgTWVz\nc2FnZVNlcUlkPiByZWNlaXZlZE1zZ3MgPQogICAgICAgICAgICBuZXcgSGFz\naE1hcDxTdHJpbmcsIE1lc3NhZ2VTZXFJZD4oKTsKCiAgICAgICAgU3Vic2Ny\naXB0aW9uT3B0aW9ucyBvcHRzID0gU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdC\ndWlsZGVyKCkKICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKENyZWF0\nZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpLmJ1aWxkKCk7CiAgICAgICAg\nc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRzKTsKICAg\nICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YmlkLCBu\nZXcgTWVzc2FnZUhhbmRsZXIoKSB7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCBwdWJsaWMgdm9pZCBkZWxpdmVyKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBNZXNzYWdlIG1zZywgQ2FsbGJhY2s8Vm9p\nZD4gY2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgICAgICAg\nICBTdHJpbmcgc3RyID0gbXNnLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKTsK\nICAgICAgICAgICAgICAgIHJlY2VpdmVkTXNncy5wdXQoc3RyLCBtc2cuZ2V0\nTXNnSWQoKSk7CiAgICAgICAgICAgICAgICBpZiAobnVtTWVzc2FnZXMgPT0g\nbnVtUmVjZWl2ZWQuaW5jcmVtZW50QW5kR2V0KCkpIHsKICAgICAgICAgICAg\nICAgICAgICByZWNlaXZlTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5p\nc2hlZChjb250ZXh0LCBudWxsKTsKICAgICAgICAgICAgfQogICAgICAgIH0p\nOwoKICAgICAgICBmb3IgKGludCBpPTA7IGk8bnVtTWVzc2FnZXM7IGkrKykg\newogICAgICAgICAgICBTdHJpbmcgc3RyID0gcHJlZml4ICsgaTsKICAgICAg\nICAgICAgQnl0ZVN0cmluZyBkYXRhID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgoc3RyKTsKICAgICAgICAgICAgTWVzc2FnZSBtc2cgPSBNZXNzYWdlLm5l\nd0J1aWxkZXIoKS5zZXRCb2R5KGRhdGEpLmJ1aWxkKCk7CiAgICAgICAgICAg\nIFB1Ymxpc2hSZXNwb25zZSByZXNwb25zZSA9IHB1Ymxpc2hlci5wdWJsaXNo\nKHRvcGljLCBtc2cpOwogICAgICAgICAgICBhc3NlcnROb3ROdWxsKHJlc3Bv\nbnNlKTsKICAgICAgICAgICAgcHVibGlzaGVkTXNncy5wdXQoc3RyLCByZXNw\nb25zZS5nZXRQdWJsaXNoZWRNc2dJZCgpKTsKICAgICAgICB9CgogICAgICAg\nIGFzc2VydFRydWUoIlRpbWVkIG91dCB3YWl0aW5nIG9uIGNhbGxiYWNrIGZv\nciBtZXNzYWdlcy4iLAogICAgICAgICAgICAgICAgICAgcmVjZWl2ZUxhdGNo\nLmF3YWl0KDMwLCBUaW1lVW5pdC5TRUNPTkRTKSk7CiAgICAgICAgYXNzZXJ0\nRXF1YWxzKCJTaG91bGQgYmUgZXhwZWN0ZWQgIiArIG51bU1lc3NhZ2VzICsg\nIiBtZXNzYWdlcy4iLAogICAgICAgICAgICAgICAgICAgICBudW1NZXNzYWdl\ncywgbnVtUmVjZWl2ZWQuZ2V0KCkpOwogICAgICAgIGFzc2VydEVxdWFscygi\nU2hvdWxkIGJlIGV4cGVjdGVkICIgKyBudW1NZXNzYWdlcyArICIgbWVzc2Fn\nZXMgaW4gbWFwLiIsCiAgICAgICAgICAgICAgICAgICAgIG51bU1lc3NhZ2Vz\nLCByZWNlaXZlZE1zZ3Muc2l6ZSgpKTsKCiAgICAgICAgZm9yIChpbnQgaT0w\nOyBpPG51bU1lc3NhZ2VzOyBpKyspIHsKICAgICAgICAgICAgZmluYWwgU3Ry\naW5nIHN0ciA9IHByZWZpeCArIGk7CiAgICAgICAgICAgIE1lc3NhZ2VTZXFJ\nZCBwdWJJZCA9IHB1Ymxpc2hlZE1zZ3MuZ2V0KHN0cik7CiAgICAgICAgICAg\nIE1lc3NhZ2VTZXFJZCByZXZJZCA9IHJlY2VpdmVkTXNncy5nZXQoc3RyKTsK\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRG9lc24ndCByZWNlaXZlIHNhbWUg\nbWVzc2FnZSBzZXEgaWQgZm9yICIgKyBzdHIsCiAgICAgICAgICAgICAgICAg\nICAgICAgcHViSWQuZXF1YWxzKHJldklkKSk7CiAgICAgICAgfQogICAgfQoK\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nQXN5bmNQdWJsaXNoKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgcHVi\nbGlzaGVyLmFzeW5jUHVibGlzaChCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgi\nbXlBc3luY1RvcGljIiksIE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHko\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0cmlu\nZy5jb3B5RnJvbVV0ZjgoIkhlbGxvIEFzeW5jIFdvcmxkISIpKS5idWlsZCgp\nLCBuZXcgVGVzdENhbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRy\ndWUocXVldWUudGFrZSgpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEFzeW5jUHVibGlzaFdpdGhSZXNw\nb25zZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcg\ndG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgidGVzdEFzeW5jUHVi\nbGlzaFdpdGhSZXNwb25zZSIpOwogICAgICAgIEJ5dGVTdHJpbmcgc3ViaWQg\nPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlzdWJpZCIpOwoKICAgICAg\nICBmaW5hbCBTdHJpbmcgcHJlZml4ID0gIkFzeW5jTWVzc2FnZS0iOwogICAg\nICAgIGZpbmFsIGludCBudW1NZXNzYWdlcyA9IDMwOwoKICAgICAgICBmaW5h\nbCBBdG9taWNJbnRlZ2VyIG51bVB1Ymxpc2hlZCA9IG5ldyBBdG9taWNJbnRl\nZ2VyKDApOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHB1Ymxpc2hM\nYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBmaW5hbCBN\nYXA8U3RyaW5nLCBNZXNzYWdlU2VxSWQ+IHB1Ymxpc2hlZE1zZ3MgPQogICAg\nICAgICAgICBuZXcgSGFzaE1hcDxTdHJpbmcsIE1lc3NhZ2VTZXFJZD4oKTsK\nCiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBudW1SZWNlaXZlZCA9IG5l\ndyBBdG9taWNJbnRlZ2VyKDApOwogICAgICAgIGZpbmFsIENvdW50RG93bkxh\ndGNoIHJlY2VpdmVMYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAg\nICAgICBmaW5hbCBNYXA8U3RyaW5nLCBNZXNzYWdlU2VxSWQ+IHJlY2VpdmVk\nTXNncyA9CiAgICAgICAgICAgIG5ldyBIYXNoTWFwPFN0cmluZywgTWVzc2Fn\nZVNlcUlkPigpOwoKICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zIG9wdHMg\nPSBTdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1aWxkZXIoKQogICAgICAgICAg\nICAuc2V0Q3JlYXRlT3JBdHRhY2goQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09S\nX0FUVEFDSCkuYnVpbGQoKTsKICAgICAgICBzdWJzY3JpYmVyLnN1YnNjcmli\nZSh0b3BpYywgc3ViaWQsIG9wdHMpOwogICAgICAgIHN1YnNjcmliZXIuc3Rh\ncnREZWxpdmVyeSh0b3BpYywgc3ViaWQsIG5ldyBNZXNzYWdlSGFuZGxlcigp\nIHsKICAgICAgICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIGRlbGl2\nZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIE1lc3NhZ2UgbXNnLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0\nIGNvbnRleHQpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBzdHIgPSBtc2cu\nZ2V0Qm9keSgpLnRvU3RyaW5nVXRmOCgpOwogICAgICAgICAgICAgICAgcmVj\nZWl2ZWRNc2dzLnB1dChzdHIsIG1zZy5nZXRNc2dJZCgpKTsKICAgICAgICAg\nICAgICAgIGlmIChudW1NZXNzYWdlcyA9PSBudW1SZWNlaXZlZC5pbmNyZW1l\nbnRBbmRHZXQoKSkgewogICAgICAgICAgICAgICAgICAgIHJlY2VpdmVMYXRj\naC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGNvbnRleHQsIG51bGwp\nOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGZvciAoaW50\nIGk9MDsgaTxudW1NZXNzYWdlczsgaSsrKSB7CiAgICAgICAgICAgIGZpbmFs\nIFN0cmluZyBzdHIgPSBwcmVmaXggKyBpOwogICAgICAgICAgICBCeXRlU3Ry\naW5nIGRhdGEgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChzdHIpOwogICAg\nICAgICAgICBNZXNzYWdlIG1zZyA9IE1lc3NhZ2UubmV3QnVpbGRlcigpLnNl\ndEJvZHkoZGF0YSkuYnVpbGQoKTsKICAgICAgICAgICAgcHVibGlzaGVyLmFz\neW5jUHVibGlzaFdpdGhSZXNwb25zZSh0b3BpYywgbXNnLCBuZXcgQ2FsbGJh\nY2s8UHVibGlzaFJlc3BvbnNlPigpIHsKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmlu\naXNoZWQoT2JqZWN0IGN0eCwgUHVibGlzaFJlc3BvbnNlIHJlc3BvbnNlKSB7\nCiAgICAgICAgICAgICAgICAgICAgcHVibGlzaGVkTXNncy5wdXQoc3RyLCBy\nZXNwb25zZS5nZXRQdWJsaXNoZWRNc2dJZCgpKTsKICAgICAgICAgICAgICAg\nICAgICBpZiAobnVtTWVzc2FnZXMgPT0gbnVtUHVibGlzaGVkLmluY3JlbWVu\ndEFuZEdldCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHB1Ymxpc2hM\nYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3Qg\nY3R4LCBmaW5hbCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAg\nICAgICAgICAgICAgICAgcHVibGlzaExhdGNoLmNvdW50RG93bigpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICB9\nCiAgICAgICAgYXNzZXJ0VHJ1ZSgiVGltZWQgb3V0IHdhaXRpbmcgb24gY2Fs\nbGJhY2sgZm9yIHB1Ymxpc2ggcmVxdWVzdHMuIiwKICAgICAgICAgICAgICAg\nICAgIHB1Ymxpc2hMYXRjaC5hd2FpdCgxMCwgVGltZVVuaXQuU0VDT05EUykp\nOwogICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIGV4cGVjdGVkICIg\nKyBudW1NZXNzYWdlcyArICIgcHVibGlzaGVzLiIsCiAgICAgICAgICAgICAg\nICAgICAgIG51bU1lc3NhZ2VzLCBudW1QdWJsaXNoZWQuZ2V0KCkpOwogICAg\nICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIGV4cGVjdGVkICIgKyBudW1N\nZXNzYWdlcyArICIgcHVibGlzaGUgcmVzcG9uc2VzLiIsCiAgICAgICAgICAg\nICAgICAgICAgIG51bU1lc3NhZ2VzLCBwdWJsaXNoZWRNc2dzLnNpemUoKSk7\nCgogICAgICAgIGFzc2VydFRydWUoIlRpbWVkIG91dCB3YWl0aW5nIG9uIGNh\nbGxiYWNrIGZvciBtZXNzYWdlcy4iLAogICAgICAgICAgICAgICAgICAgcmVj\nZWl2ZUxhdGNoLmF3YWl0KDMwLCBUaW1lVW5pdC5TRUNPTkRTKSk7CiAgICAg\nICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgYmUgZXhwZWN0ZWQgIiArIG51bU1l\nc3NhZ2VzICsgIiBtZXNzYWdlcy4iLAogICAgICAgICAgICAgICAgICAgICBu\ndW1NZXNzYWdlcywgbnVtUmVjZWl2ZWQuZ2V0KCkpOwogICAgICAgIGFzc2Vy\ndEVxdWFscygiU2hvdWxkIGJlIGV4cGVjdGVkICIgKyBudW1NZXNzYWdlcyAr\nICIgbWVzc2FnZXMgaW4gbWFwLiIsCiAgICAgICAgICAgICAgICAgICAgIG51\nbU1lc3NhZ2VzLCByZWNlaXZlZE1zZ3Muc2l6ZSgpKTsKCiAgICAgICAgZm9y\nIChpbnQgaT0wOyBpPG51bU1lc3NhZ2VzOyBpKyspIHsKICAgICAgICAgICAg\nZmluYWwgU3RyaW5nIHN0ciA9IHByZWZpeCArIGk7CiAgICAgICAgICAgIE1l\nc3NhZ2VTZXFJZCBwdWJJZCA9IHB1Ymxpc2hlZE1zZ3MuZ2V0KHN0cik7CiAg\nICAgICAgICAgIE1lc3NhZ2VTZXFJZCByZXZJZCA9IHJlY2VpdmVkTXNncy5n\nZXQoc3RyKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRG9lc24ndCByZWNl\naXZlIHNhbWUgbWVzc2FnZSBzZXEgaWQgZm9yICIgKyBzdHIsCiAgICAgICAg\nICAgICAgICAgICAgICAgcHViSWQuZXF1YWxzKHJldklkKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0TXVsdGlwbGVBc3luY1B1Ymxpc2goKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGljMSA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJteUZpcnN0VG9waWMiKTsKICAgICAgICBCeXRlU3Ry\naW5nIHRvcGljMiA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJteU5ld1Rv\ncGljIik7CgogICAgICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMx\nLCBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5KEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJIZWxsbyBXb3JsZCEiKSkuYnVpbGQoKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIG5ldyBUZXN0Q2FsbGJhY2soKSwgbnVs\nbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAg\nIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMyLCBNZXNzYWdlLm5ld0J1\naWxkZXIoKS5zZXRCb2R5KEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJIZWxs\nbyBvbiBuZXcgdG9waWMhIikpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAuYnVpbGQoKSwgbmV3IFRlc3RDYWxsYmFjaygpLCBudWxsKTsKICAg\nICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAgcHVibGlz\naGVyLmFzeW5jUHVibGlzaCh0b3BpYzEsIE1lc3NhZ2UubmV3QnVpbGRlcigp\nLnNldEJvZHkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIkhlbGxvIEFnYWluIG9uIG9sZCB0\nb3BpYyEiKSkuYnVpbGQoKSwgbmV3IFRlc3RDYWxsYmFjaygpLCBudWxsKTsK\nICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICB9CgogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTeW5j\nU3Vic2NyaWJlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVh\nbiBzdWJzY3JpYmVTdWNjZXNzID0gdHJ1ZTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zIG9wdHMgPSBTdWJzY3JpcHRp\nb25PcHRpb25zLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAgICAgLnNldENy\nZWF0ZU9yQXR0YWNoKENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gp\nLmJ1aWxkKCk7CiAgICAgICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KCJteVN5bmNTdWJzY3JpYmVUb3BpYyIp\nLCBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiMSIpLCBvcHRzKTsKICAgICAg\nICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBzdWJzY3Jp\nYmVTdWNjZXNzID0gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGFzc2VydFRy\ndWUoc3Vic2NyaWJlU3VjY2Vzcyk7CiAgICB9CgogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RBc3luY1N1YnNjcmliZSgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN1YnNjcmlwdGlvbk9wdGlv\nbnMgb3B0cyA9IFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAg\nICAgICAgICAgIC5zZXRDcmVhdGVPckF0dGFjaChDcmVhdGVPckF0dGFjaC5D\nUkVBVEVfT1JfQVRUQUNIKS5idWlsZCgpOwogICAgICAgIHN1YnNjcmliZXIu\nYXN5bmNTdWJzY3JpYmUoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15QXN5\nbmNTdWJzY3JpYmVUb3BpYyIpLCBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgi\nMSIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0cywg\nbmV3IFRlc3RDYWxsYmFjaygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVl\nKHF1ZXVlLnRha2UoKSk7CiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAw\nMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTdGFydERlbGl2ZXJ5QWZ0ZXJDbG9z\nZVN1YigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcg\ndG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgidGVzdFN0YXJ0RGVs\naXZlcnlBZnRlckNsb3NlU3ViIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJp\nZCA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJteXN1YmlkIik7CiAgICAg\nICAgU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRzID0gU3Vic2NyaXB0aW9uT3B0\naW9ucy5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0\nYWNoKENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpLmJ1aWxkKCk7\nCiAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBv\ncHRzKTsKCiAgICAgICAgLy8gU3RhcnQgZGVsaXZlcnkgZm9yIHRoZSBzdWJz\nY3JpYmVyCiAgICAgICAgc3Vic2NyaWJlci5zdGFydERlbGl2ZXJ5KHRvcGlj\nLCBzdWJpZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcigpKTsKCiAgICAgICAg\nLy8gTm93IHB1Ymxpc2ggc29tZSBtZXNzYWdlcyBmb3IgdGhlIHRvcGljIHRv\nIGJlIGNvbnN1bWVkIGJ5IHRoZQogICAgICAgIC8vIHN1YnNjcmliZXIuCiAg\nICAgICAgcHVibGlzaGVyLnB1Ymxpc2godG9waWMsIE1lc3NhZ2UubmV3QnVp\nbGRlcigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldEJv\nZHkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIk1lc3NhZ2UgIzEiKSkuYnVp\nbGQoKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgp\nKTsKCiAgICAgICAgLy8gQ2xvc2Ugc3Vic2NyaWJlciBmb3IgdGhlIHN1YnNj\ncmliZXIKICAgICAgICBzdWJzY3JpYmVyLmNsb3NlU3Vic2NyaXB0aW9uKHRv\ncGljLCBzdWJpZCk7CgogICAgICAgIC8vIHN1YnNjcmliZSBhZ2FpbgogICAg\nICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKHRvcGljLCBzdWJpZCwgb3B0cyk7\nCiAgICAgICAgc3Vic2NyaWJlci5zdGFydERlbGl2ZXJ5KHRvcGljLCBzdWJp\nZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcigpKTsKCiAgICAgICAgcHVibGlz\naGVyLnB1Ymxpc2godG9waWMsIE1lc3NhZ2UubmV3QnVpbGRlcigpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldEJvZHkoQnl0ZVN0cmlu\nZy5jb3B5RnJvbVV0ZjgoIk1lc3NhZ2UgIzIiKSkuYnVpbGQoKSk7CiAgICAg\nICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgpKTsKICAgIH0KCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN1\nYnNjcmliZUFuZENvbnN1bWUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nIm15Q29uc3VtZVRvcGljIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiMSIpOwogICAgICAg\nIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0cyA9IFN1YnNjcmlwdGlvbk9wdGlv\nbnMubmV3QnVpbGRlcigpCiAgICAgICAgICAgIC5zZXRDcmVhdGVPckF0dGFj\naChDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIKS5idWlsZCgpOwoK\nICAgICAgICBzdWJzY3JpYmVyLmFzeW5jU3Vic2NyaWJlKHRvcGljLCBzdWJz\nY3JpYmVySWQsIG9wdHMsIG5ldyBUZXN0Q2FsbGJhY2soKSwgbnVsbCk7CiAg\nICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwoKICAgICAgICAvLyBT\ndGFydCBkZWxpdmVyeSBmb3IgdGhlIHN1YnNjcmliZXIKICAgICAgICBzdWJz\nY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YnNjcmliZXJJZCwgbmV3\nIFRlc3RNZXNzYWdlSGFuZGxlcigpKTsKCiAgICAgICAgLy8gTm93IHB1Ymxp\nc2ggc29tZSBtZXNzYWdlcyBmb3IgdGhlIHRvcGljIHRvIGJlIGNvbnN1bWVk\nIGJ5IHRoZQogICAgICAgIC8vIHN1YnNjcmliZXIuCiAgICAgICAgcHVibGlz\naGVyLmFzeW5jUHVibGlzaCh0b3BpYywgTWVzc2FnZS5uZXdCdWlsZGVyKCku\nc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiTWVzc2FnZSAjMSIp\nKS5idWlsZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3\nIFRlc3RDYWxsYmFjaygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVlKHF1\nZXVlLnRha2UoKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUu\ndGFrZSgpKTsKICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJsaXNoKHRvcGlj\nLCBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5KEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJNZXNzYWdlICMyIikpLmJ1aWxkKCksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBuZXcgVGVzdENhbGxiYWNrKCksIG51bGwp\nOwogICAgICAgIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBh\nc3NlcnRUcnVlKGNvbnN1bWVRdWV1ZS50YWtlKCkpOwogICAgICAgIHB1Ymxp\nc2hlci5hc3luY1B1Ymxpc2godG9waWMsIE1lc3NhZ2UubmV3QnVpbGRlcigp\nLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIk1lc3NhZ2UgIzMi\nKSkuYnVpbGQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5l\ndyBUZXN0Q2FsbGJhY2soKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShx\ndWV1ZS50YWtlKCkpOwogICAgICAgIGFzc2VydFRydWUoY29uc3VtZVF1ZXVl\nLnRha2UoKSk7CiAgICAgICAgcHVibGlzaGVyLmFzeW5jUHVibGlzaCh0b3Bp\nYywgTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShCeXRlU3RyaW5nLmNv\ncHlGcm9tVXRmOCgiTWVzc2FnZSAjNCIpKS5idWlsZCgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbmV3IFRlc3RDYWxsYmFjaygpLCBudWxs\nKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAg\nYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgpKTsKICAgICAgICBwdWJs\naXNoZXIuYXN5bmNQdWJsaXNoKHRvcGljLCBNZXNzYWdlLm5ld0J1aWxkZXIo\nKS5zZXRCb2R5KEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJNZXNzYWdlICM1\nIikpLmJ1aWxkKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBu\nZXcgVGVzdENhbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRydWUo\ncXVldWUudGFrZSgpKTsKICAgICAgICBhc3NlcnRUcnVlKGNvbnN1bWVRdWV1\nZS50YWtlKCkpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0QXN5bmNTdWJzY3JpYmVBbmRVbnN1YnNjcmli\nZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcgdG9w\naWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlBc3luY1Vuc3ViVG9w\naWMiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCA9IEJ5dGVT\ndHJpbmcuY29weUZyb21VdGY4KCIxIik7CiAgICAgICAgU3Vic2NyaXB0aW9u\nT3B0aW9ucyBvcHRzID0gU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVy\nKCkKICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKENyZWF0ZU9yQXR0\nYWNoLkNSRUFURV9PUl9BVFRBQ0gpLmJ1aWxkKCk7CiAgICAgICAgc3Vic2Ny\naWJlci5hc3luY1N1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklkLCBvcHRz\nLCBuZXcgVGVzdENhbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRy\ndWUocXVldWUudGFrZSgpKTsKICAgICAgICBzdWJzY3JpYmVyLmFzeW5jVW5z\ndWJzY3JpYmUodG9waWMsIHN1YnNjcmliZXJJZCwgbmV3IFRlc3RDYWxsYmFj\naygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7\nCiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RTeW5jVW5zdWJzY3JpYmVXaXRob3V0U3Vic2NyaXB0aW9uKCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiB1bnN1YnNjcmli\nZVN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBz\ndWJzY3JpYmVyLnVuc3Vic2NyaWJlKEJ5dGVTdHJpbmcuY29weUZyb21VdGY4\nKCJteVN5bmNVbnN1YlRvcGljIiksIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4\nKCIxIikpOwogICAgICAgIH0gY2F0Y2ggKENsaWVudE5vdFN1YnNjcmliZWRF\neGNlcHRpb24gZSkgewogICAgICAgICAgICB1bnN1YnNjcmliZVN1Y2Nlc3Mg\nPSB0cnVlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBleCkgewogICAg\nICAgICAgICB1bnN1YnNjcmliZVN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB9\nCiAgICAgICAgYXNzZXJ0VHJ1ZSh1bnN1YnNjcmliZVN1Y2Nlc3MpOwogICAg\nfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0QXN5bmNTdWJzY3JpYmVBbmRDbG9zZVN1YnNjcmlwdGlvbigpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRl\nU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlBc3luY1N1YkFuZENsb3NlU3ViVG9w\naWMiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCA9IEJ5dGVT\ndHJpbmcuY29weUZyb21VdGY4KCIxIik7CiAgICAgICAgU3Vic2NyaXB0aW9u\nT3B0aW9ucyBvcHRzID0gU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVy\nKCkKICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKENyZWF0ZU9yQXR0\nYWNoLkNSRUFURV9PUl9BVFRBQ0gpLmJ1aWxkKCk7CiAgICAgICAgc3Vic2Ny\naWJlci5hc3luY1N1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklkLCBvcHRz\nLCBuZXcgVGVzdENhbGxiYWNrKCksIG51bGwpOwogICAgICAgIGFzc2VydFRy\ndWUocXVldWUudGFrZSgpKTsKICAgICAgICBzdWJzY3JpYmVyLmNsb3NlU3Vi\nc2NyaXB0aW9uKHRvcGljLCBzdWJzY3JpYmVySWQpOwogICAgICAgIGFzc2Vy\ndFRydWUodHJ1ZSk7CiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RTdWJDbG9zZXN1YkFuZFB1Ymxpc2goKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0g\nQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15U3ViQ2xvc2VzdWJBbmRQdWJs\naXNoIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJpZCA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJteXN1YiIpOwogICAgICAgIC8vIHRvIHBvcHVsYXRl\nIHN0YXJ0U2VydmluZy9zdG9wU2VydmluZyBzZXF1ZXVlbmNlCiAgICAgICAg\nU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRzID0gU3Vic2NyaXB0aW9uT3B0aW9u\ncy5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNo\nKENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpLmJ1aWxkKCk7CiAg\nICAgICAgZm9yIChpbnQgaT0wOyBpPDU7IGkrKykgewogICAgICAgICAgICBz\ndWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIG9wdHMpOwogICAg\nICAgICAgICBzdWJzY3JpYmVyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBz\ndWJpZCk7CiAgICAgICAgfQogICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJl\nKHRvcGljLCBzdWJpZCwgb3B0cyk7CiAgICAgICAgc3Vic2NyaWJlci5zdGFy\ndERlbGl2ZXJ5KHRvcGljLCBzdWJpZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxl\ncigpKTsKICAgICAgICBmb3IgKGludCBpPTA7IGk8MzsgaSsrKSB7CiAgICAg\nICAgICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMsCiAgICAgICAg\nICAgICAgICBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5KEJ5dGVTdHJp\nbmcuY29weUZyb21VdGY4KCJNZXNzYWdlICMiICsgaSkpLmJ1aWxkKCksCiAg\nICAgICAgICAgICAgICBuZXcgVGVzdENhbGxiYWNrKCksIG51bGwpOwogICAg\nICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAgICAg\nIGFzc2VydFRydWUoY29uc3VtZVF1ZXVlLnRha2UoKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0U3luY1N1YnNjcmliZVdpdGhMaXN0ZW5lcigpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5n\nLmNvcHlGcm9tVXRmOCgibXlTeW5jU3Vic2NyaWJlV2l0aExpc3RlbmVyIik7\nCiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQgPSBCeXRlU3RyaW5n\nLmNvcHlGcm9tVXRmOCgibXlzdWIiKTsKICAgICAgICBzdWJzY3JpYmVyLmFk\nZFN1YnNjcmlwdGlvbkxpc3RlbmVyKG5ldyBUZXN0U3Vic2NyaXB0aW9uTGlz\ndGVuZXIoKSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgU3Vic2NyaXB0\naW9uT3B0aW9ucyBvcHRpb25zID0KICAgICAgICAgICAgICAgIFN1YnNjcmlw\ndGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAgICAgICAgICAuc2V0\nQ3JlYXRlT3JBdHRhY2goQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFD\nSCkKICAgICAgICAgICAgICAgIC5zZXRFbmFibGVSZXN1YnNjcmliZShmYWxz\nZSkuYnVpbGQoKTsKICAgICAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUo\ndG9waWMsIHN1YnNjcmliZXJJZCwgb3B0aW9ucyk7CiAgICAgICAgfSBjYXRj\naCAoUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgZmFpbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlISIpOwog\nICAgICAgIH0KICAgICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9w\naWMsIHN1YnNjcmliZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcigpKTsK\nICAgICAgICB0ZWFyRG93bkh1YlNlcnZlcigpOwogICAgICAgIGFzc2VydEVx\ndWFscyhTdWJzY3JpcHRpb25FdmVudC5UT1BJQ19NT1ZFRCwgZXZlbnRRdWV1\nZS50YWtlKCkpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0QXN5bmNTdWJzY3JpYmVXaXRoTGlzdGVuZXIo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGlj\nID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15QXN5bmNTdWJzY3JpYmVX\naXRoTGlzdGVuZXIiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1YnNjcmliZXJJ\nZCA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJteXN1YiIpOwogICAgICAg\nIHN1YnNjcmliZXIuYWRkU3Vic2NyaXB0aW9uTGlzdGVuZXIobmV3IFRlc3RT\ndWJzY3JpcHRpb25MaXN0ZW5lcigpKTsKICAgICAgICBTdWJzY3JpcHRpb25P\ncHRpb25zIG9wdGlvbnMgPQogICAgICAgICAgICBTdWJzY3JpcHRpb25PcHRp\nb25zLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAuc2V0Q3JlYXRlT3JBdHRh\nY2goQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSCkKICAgICAgICAg\nICAgLnNldEVuYWJsZVJlc3Vic2NyaWJlKGZhbHNlKS5idWlsZCgpOwogICAg\nICAgIHN1YnNjcmliZXIuYXN5bmNTdWJzY3JpYmUodG9waWMsIHN1YnNjcmli\nZXJJZCwgb3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG5ldyBUZXN0Q2FsbGJhY2soKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0\nVHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIHN1YnNjcmliZXIuc3RhcnRE\nZWxpdmVyeSh0b3BpYywgc3Vic2NyaWJlcklkLCBuZXcgVGVzdE1lc3NhZ2VI\nYW5kbGVyKCkpOwogICAgICAgIHRlYXJEb3duSHViU2VydmVyKCk7CiAgICAg\nICAgYXNzZXJ0RXF1YWxzKFN1YnNjcmlwdGlvbkV2ZW50LlRPUElDX01PVkVE\nLCBldmVudFF1ZXVlLnRha2UoKSk7CiAgICB9CgogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTeW5jU3Vic2NyaWJlRm9y\nY2VBdHRhY2goKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3Ry\naW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15U3luY1N1\nYnNjcmliZUZvcmNlQXR0YWNoIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlzdWIiKTsK\nICAgICAgICBzdWJzY3JpYmVyLmFkZFN1YnNjcmlwdGlvbkxpc3RlbmVyKG5l\ndyBUZXN0U3Vic2NyaXB0aW9uTGlzdGVuZXIoKSk7CiAgICAgICAgU3Vic2Ny\naXB0aW9uT3B0aW9ucyBvcHRpb25zID0KICAgICAgICAgICAgU3Vic2NyaXB0\naW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgLnNldENyZWF0\nZU9yQXR0YWNoKENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpCiAg\nICAgICAgICAgIC5zZXRGb3JjZUF0dGFjaCh0cnVlKS5zZXRFbmFibGVSZXN1\nYnNjcmliZShmYWxzZSkuYnVpbGQoKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBzdWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklk\nLCBvcHRpb25zKTsKICAgICAgICB9IGNhdGNoIChQdWJTdWJFeGNlcHRpb24u\nU2VydmljZURvd25FeGNlcHRpb24gZSkgewogICAgICAgICAgICBmYWlsKCJT\naG91bGQgbm90IHJlYWNoIGhlcmUhIik7CiAgICAgICAgfQogICAgICAgIHN1\nYnNjcmliZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3Vic2NyaWJlcklkLCBu\nZXcgVGVzdE1lc3NhZ2VIYW5kbGVyKCkpOwoKICAgICAgICAvLyBuZXcgYSBj\nbGllbnQKICAgICAgICBIZWR3aWdDbGllbnQgY2xpZW50MiA9IG5ldyBIZWR3\naWdDbGllbnQobmV3IENsaWVudENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBIZWR3\naWdTb2NrZXRBZGRyZXNzIGdldERlZmF1bHRTZXJ2ZXJIZWR3aWdTb2NrZXRB\nZGRyZXNzKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXREZWZh\ndWx0SGVkd2lnQWRkcmVzcygpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9KTsKICAgICAgICBTdWJzY3JpYmVyIHN1YnNjcmliZXIyID0gY2xp\nZW50Mi5nZXRTdWJzY3JpYmVyKCk7CiAgICAgICAgUHVibGlzaGVyIHB1Ymxp\nc2hlcjIgPSBjbGllbnQyLmdldFB1Ymxpc2hlcigpOwogICAgICAgIFN5bmNo\ncm9ub3VzUXVldWU8U3Vic2NyaXB0aW9uRXZlbnQ+IGV2ZW50UXVldWUyID0K\nICAgICAgICAgICAgbmV3IFN5bmNocm9ub3VzUXVldWU8U3Vic2NyaXB0aW9u\nRXZlbnQ+KCk7CiAgICAgICAgc3Vic2NyaWJlcjIuYWRkU3Vic2NyaXB0aW9u\nTGlzdGVuZXIobmV3IFRlc3RTdWJzY3JpcHRpb25MaXN0ZW5lcihldmVudFF1\nZXVlMikpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN1YnNjcmliZXIy\nLnN1YnNjcmliZSh0b3BpYywgc3Vic2NyaWJlcklkLCBvcHRpb25zKTsKICAg\nICAgICB9IGNhdGNoIChQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBmYWlsKCJTaG91bGQgbm90IHJlYWNo\nIGhlcmUhIik7CiAgICAgICAgfQoKICAgICAgICBTeW5jaHJvbm91c1F1ZXVl\nPEJvb2xlYW4+IGNvbnN1bWVRdWV1ZTIgPSBuZXcgU3luY2hyb25vdXNRdWV1\nZTxCb29sZWFuPigpOwogICAgICAgIHN1YnNjcmliZXIyLnN0YXJ0RGVsaXZl\ncnkodG9waWMsIHN1YnNjcmliZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxl\ncihjb25zdW1lUXVldWUyKSk7CgogICAgICAgIGFzc2VydEVxdWFscyhTdWJz\nY3JpcHRpb25FdmVudC5TVUJTQ1JJUFRJT05fRk9SQ0VEX0NMT1NFRCwgZXZl\nbnRRdWV1ZS50YWtlKCkpOwogICAgICAgIGFzc2VydFRydWUoZXZlbnRRdWV1\nZTIuaXNFbXB0eSgpKTsKCiAgICAgICAgLy8gTm93IHB1Ymxpc2ggc29tZSBt\nZXNzYWdlcyBmb3IgdGhlIHRvcGljIHRvIGJlIGNvbnN1bWVkIGJ5IHRoZQog\nICAgICAgIC8vIHN1YnNjcmliZXIuCiAgICAgICAgcHVibGlzaGVyLmFzeW5j\nUHVibGlzaCh0b3BpYywgTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShC\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiTWVzc2FnZSAjMSIpKS5idWlsZCgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFRlc3RDYWxs\nYmFjaygpLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2Uo\nKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUyLnRha2UoKSk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUuaXNFbXB0eSgpKTsK\nCiAgICAgICAgcHVibGlzaGVyMi5hc3luY1B1Ymxpc2godG9waWMsIE1lc3Nh\nZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgoIk1lc3NhZ2UgIzIiKSkuYnVpbGQoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG5ldyBUZXN0Q2FsbGJhY2soKSwgbnVsbCk7CiAgICAg\nICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIGFzc2VydFRy\ndWUoY29uc3VtZVF1ZXVlMi50YWtlKCkpOwogICAgICAgIGFzc2VydFRydWUo\nY29uc3VtZVF1ZXVlLmlzRW1wdHkoKSk7CgogICAgICAgIGNsaWVudDIuY2xv\nc2UoKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdFN5bmNTdWJzY3JpYmVXaXRoTGlzdGVuZXJXaGVuUmVs\nZWFzaW5nVG9waWMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBjbGll\nbnQuY2xvc2UoKTsKCiAgICAgICAgdGVhckRvd25IdWJTZXJ2ZXIoKTsKICAg\nICAgICBzdGFydEh1YlNlcnZlcihuZXcgUmV0ZW50aW9uU2VydmVyQ29uZmln\ndXJhdGlvbigpKTsKICAgICAgICBjbGllbnQgPSBuZXcgSGVkd2lnQ2xpZW50\nKG5ldyBDbGllbnRDb25maWd1cmF0aW9uKCkgewogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIEhlZHdpZ1NvY2tldEFkZHJlc3Mg\nZ2V0RGVmYXVsdFNlcnZlckhlZHdpZ1NvY2tldEFkZHJlc3MoKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gZ2V0RGVmYXVsdEhlZHdpZ0FkZHJlc3MoKTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyBib29sZWFuIGlzU3Vic2NyaXB0aW9uQ2hhbm5lbFNoYXJp\nbmdFbmFibGVkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIFRlc3RQdWJT\ndWJDbGllbnQudGhpcy5pc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5h\nYmxlZDsKICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIHB1Ymxp\nc2hlciA9IGNsaWVudC5nZXRQdWJsaXNoZXIoKTsKICAgICAgICBzdWJzY3Jp\nYmVyID0gY2xpZW50LmdldFN1YnNjcmliZXIoKTsKCiAgICAgICAgQnl0ZVN0\ncmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJteVN5bmNT\ndWJzY3JpYmVXaXRoTGlzdGVuZXJXaGVuUmVsZWFzaW5nVG9waWMiKTsKICAg\nICAgICBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCA9IEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJteXN1YiIpOwogICAgICAgIHN1YnNjcmliZXIuYWRkU3Vi\nc2NyaXB0aW9uTGlzdGVuZXIobmV3IFRlc3RTdWJzY3JpcHRpb25MaXN0ZW5l\ncigpKTsKICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnMgPQog\nICAgICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1aWxkZXIoKQog\nICAgICAgICAgICAuc2V0Q3JlYXRlT3JBdHRhY2goQ3JlYXRlT3JBdHRhY2gu\nQ1JFQVRFX09SX0FUVEFDSCkKICAgICAgICAgICAgLnNldEZvcmNlQXR0YWNo\nKGZhbHNlKS5zZXRFbmFibGVSZXN1YnNjcmliZShmYWxzZSkuYnVpbGQoKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBzdWJzY3JpYmVyLnN1YnNjcmli\nZSh0b3BpYywgc3Vic2NyaWJlcklkLCBvcHRpb25zKTsKICAgICAgICB9IGNh\ndGNoIChQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24gZSkg\newogICAgICAgICAgICBmYWlsKCJTaG91bGQgbm90IHJlYWNoIGhlcmUhIik7\nCiAgICAgICAgfQogICAgICAgIHN1YnNjcmliZXIuc3RhcnREZWxpdmVyeSh0\nb3BpYywgc3Vic2NyaWJlcklkLCBuZXcgVGVzdE1lc3NhZ2VIYW5kbGVyKCkp\nOwoKICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJsaXNoKHRvcGljLCBNZXNz\nYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5KEJ5dGVTdHJpbmcuY29weUZyb21V\ndGY4KCJNZXNzYWdlICMxIikpLmJ1aWxkKCksCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBuZXcgVGVzdENhbGxiYWNrKCksIG51bGwpOwogICAg\nICAgIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBhc3NlcnRU\ncnVlKGNvbnN1bWVRdWV1ZS50YWtlKCkpOwoKICAgICAgICBUaHJlYWQuc2xl\nZXAoUkVURU5USU9OX1NFQ1NfVkFMVUUgKiAyKTsKICAgICAgICBhc3NlcnRF\ncXVhbHMoU3Vic2NyaXB0aW9uRXZlbnQuVE9QSUNfTU9WRUQsIGV2ZW50UXVl\ndWUudGFrZSgpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0ID0gNjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q2xvc2VTdWJzY3JpYmVEdXJpbmdSZXN1\nYnNjcmliZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGNsaWVudC5j\nbG9zZSgpOwoKICAgICAgICBmaW5hbCBsb25nIHJlY29ubmVjdFdhaXRUaW1l\nID0gMjAwMEw7CiAgICAgICAgY2xpZW50ID0gbmV3IEhlZHdpZ0NsaWVudChu\nZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyBIZWR3aWdTb2NrZXRBZGRyZXNzIGdl\ndERlZmF1bHRTZXJ2ZXJIZWR3aWdTb2NrZXRBZGRyZXNzKCkgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGdldERlZmF1bHRIZWR3aWdBZGRyZXNzKCk7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgYm9vbGVhbiBpc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFyaW5n\nRW5hYmxlZCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBUZXN0UHViU3Vi\nQ2xpZW50LnRoaXMuaXNTdWJzY3JpcHRpb25DaGFubmVsU2hhcmluZ0VuYWJs\nZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgbG9uZyBnZXRTdWJzY3JpYmVSZWNvbm5lY3RSZXRy\neVdhaXRUaW1lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlY29ubmVj\ndFdhaXRUaW1lOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAg\nIHB1Ymxpc2hlciA9IGNsaWVudC5nZXRQdWJsaXNoZXIoKTsKICAgICAgICBz\ndWJzY3JpYmVyID0gY2xpZW50LmdldFN1YnNjcmliZXIoKTsKCiAgICAgICAg\nQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJ0\nZXN0Q2xvc2VTdWJzY3JpYmVEdXJpbmdSZXN1YnNjcmliZSIpOwogICAgICAg\nIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkID0gQnl0ZVN0cmluZy5jb3B5RnJv\nbVV0ZjgoIm15c3ViIik7CiAgICAgICAgc3Vic2NyaWJlci5hZGRTdWJzY3Jp\ncHRpb25MaXN0ZW5lcihuZXcgVGVzdFN1YnNjcmlwdGlvbkxpc3RlbmVyKCkp\nOwogICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0aW9ucyA9CiAgICAg\nICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAgICAg\nICAgICAgIC5zZXRDcmVhdGVPckF0dGFjaChDcmVhdGVPckF0dGFjaC5DUkVB\nVEVfT1JfQVRUQUNIKQogICAgICAgICAgICAuc2V0Rm9yY2VBdHRhY2goZmFs\nc2UpLnNldEVuYWJsZVJlc3Vic2NyaWJlKHRydWUpLmJ1aWxkKCk7CiAgICAg\nICAgc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1YnNjcmliZXJJZCwg\nb3B0aW9ucyk7CiAgICAgICAgbG9nZ2VyLmluZm8oIlN1YnNjcmliZWQgdG9w\naWMge30sIHN1YnNjcmliZXIge30uIiwgdG9waWMudG9TdHJpbmdVdGY4KCks\nCiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRm\nOCgpKTsKICAgICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMs\nIHN1YnNjcmliZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcigpKTsKCiAg\nICAgICAgLy8gdGVhciBkb3duIHRoZSBodWIgc2VydmVyIHRvIGxldCBzdWJz\nY3JpYmUgZW50ZXIKICAgICAgICB0ZWFyRG93bkh1YlNlcnZlcigpOwogICAg\nICAgIGxvZ2dlci5pbmZvKCJUZWFyIGRvd24gdGhlIGh1YiBzZXJ2ZXIiKTsK\nCiAgICAgICAgLy8gd2FpdCBmb3IgY2xpZW50IGVudGVyIHRvIHJlc3Vic2Ny\naWJlIGxvZ2ljCiAgICAgICAgVGhyZWFkLnNsZWVwKHJlY29ubmVjdFdhaXRU\naW1lIC8gMik7CgogICAgICAgIC8vIGNsb3NlIHN1YgogICAgICAgIHN1YnNj\ncmliZXIuY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YnNjcmliZXJJZCk7\nCgogICAgICAgIC8vIHN0YXJ0IHRoZSBodWIgc2VydmVyIGFnYWluCiAgICAg\nICAgc3RhcnRIdWJTZXJ2ZXIoY29uZik7CgogICAgICAgIC8vIHB1Ymxpc2gg\nYSBuZXcgbWVzc2FnZQogICAgICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2go\ndG9waWMsIE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoQnl0ZVN0cmlu\nZy5jb3B5RnJvbVV0ZjgoIk1lc3NhZ2UgIzEiKSkuYnVpbGQoKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBUZXN0Q2FsbGJhY2soKSwg\nbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwoKICAg\nICAgICAvLyB3YWl0IGZvciBhbm90aGVyIHJlY29ubmVjdCB0aW1lIHBlcmlv\nZAogICAgICAgIGFzc2VydE51bGwoIlNob3VsZCBub3QgcmVjZWl2ZSBhbnkg\nbWVzc2FnZXMgc2luY2UgdGhlIHN1YnNjcmlwdGlvbiBoYXMgYWxyZWFkeSBi\nZWVuIGNsb3NlZC4iLAogICAgICAgICAgICAgICAgICAgY29uc3VtZVF1ZXVl\nLnBvbGwocmVjb25uZWN0V2FpdFRpbWUgKyByZWNvbm5lY3RXYWl0VGltZSAv\nIDIsIFRpbWVVbml0Lk1JTExJU0VDT05EUykpOwogICAgfQoKfQo=\n","encoding":"base64"}

