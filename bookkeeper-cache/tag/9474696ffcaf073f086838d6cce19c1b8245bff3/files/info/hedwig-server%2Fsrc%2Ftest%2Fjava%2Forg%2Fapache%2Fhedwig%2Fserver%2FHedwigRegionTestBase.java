{"sha":"adb4ea9aa9924c2154e807870995468d793fa7c6","node_id":"MDQ6QmxvYjE1NzU5NTY6YWRiNGVhOWFhOTkyNGMyMTU0ZTgwNzg3MDk5NTQ2OGQ3OTNmYTdjNg==","size":11166,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/adb4ea9aa9924c2154e807870995468d793fa7c6","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXI7CgppbXBvcnQgamF2YS51\ndGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKCmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\nckZhY3Rvcnk7CmltcG9ydCBvcmcuanVuaXQuQWZ0ZXI7CmltcG9ydCBvcmcu\nanVuaXQuQmVmb3JlOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVu\ndC5jb25mLkNsaWVudENvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5jbGllbnQuSGVkd2lnQ2xpZW50OwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuc2VydmVyLmNvbW1vbi5TZXJ2ZXJDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLm5ldHR5LlB1YlN1YlNl\ncnZlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5wZXJzaXN0\nZW5jZS5Cb29rS2VlcGVyVGVzdEJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3M7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnRlc3QuUG9ydE1hbmFnZXI7CgovKioKICogVGhp\ncyBpcyBhIGJhc2UgY2xhc3MgZm9yIGFueSB0ZXN0cyB0aGF0IG5lZWQgYSBI\nZWR3aWcgUmVnaW9uKHMpIHNldHVwIHdpdGggYQogKiBudW1iZXIgb2YgSGVk\nd2lnIGh1YnMgcGVyIHJlZ2lvbiwgYW4gYXNzb2NpYXRlZCBIZWR3aWdDbGll\nbnQgcGVyIHJlZ2lvbiBhbmQKICogdGhlIHJlcXVpcmVkIEJvb2tLZWVwZXIg\nYW5kIFpvb0tlZXBlciBpbnN0YW5jZXMuCiAqCiAqLwpwdWJsaWMgYWJzdHJh\nY3QgY2xhc3MgSGVkd2lnUmVnaW9uVGVzdEJhc2UgewoKICAgIHByb3RlY3Rl\nZCBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3RvcnkuZ2V0TG9n\nZ2VyKEhlZHdpZ1JlZ2lvblRlc3RCYXNlLmNsYXNzKTsKCiAgICAvLyBCb29r\nS2VlcGVyIHZhcmlhYmxlcwogICAgLy8gRGVmYXVsdCBudW1iZXIgb2YgYm9v\na2llIHNlcnZlcnMgdG8gc2V0dXAuIEV4dGVuZGluZyBjbGFzc2VzCiAgICAv\nLyBjYW4gb3ZlcnJpZGUgdGhpcy4gV2Ugc2hvdWxkIGJlIGFibGUgdG8gcmV1\nc2UgdGhlIHNhbWUgQm9va0tlZXBlcgogICAgLy8gZW5zZW1ibGUgYW1vbmcg\nYWxsIG9mIHRoZSByZWdpb25zLCBhdCBsZWFzdCBmb3IgdW5pdCB0ZXN0aW5n\nIHB1cnBvc2VzLgogICAgcHJvdGVjdGVkIGludCBudW1Cb29raWVzID0gMzsK\nICAgIHByb3RlY3RlZCBCb29rS2VlcGVyVGVzdEJhc2UgYmt0YjsKCiAgICAv\nLyBIZWR3aWcgUmVnaW9uIHZhcmlhYmxlcwogICAgLy8gRGVmYXVsdCBudW1i\nZXIgb2YgSGVkd2lnIFJlZ2lvbnMgdG8gc2V0dXAuIEV4dGVuZGluZyBjbGFz\nc2VzIGNhbgogICAgLy8gb3ZlcnJpZGUgdGhpcy4KICAgIHByb3RlY3RlZCBp\nbnQgbnVtUmVnaW9ucyA9IDI7CiAgICBwcm90ZWN0ZWQgaW50IG51bVNlcnZl\ncnNQZXJSZWdpb24gPSAxOwoKICAgIC8vIE1hcCB3aXRoIGtleXMgYmVpbmcg\nUmVnaW9uIG5hbWVzIGFuZCB2YWx1ZXMgYmVpbmcgdGhlIGxpc3Qgb2YgSGVk\nd2lnCiAgICAvLyBIdWJzIChQdWJTdWJTZXJ2ZXJzKSBmb3IgdGhhdCBwYXJ0\naWN1bGFyIHJlZ2lvbi4KICAgIHByb3RlY3RlZCBNYXA8U3RyaW5nLCBMaXN0\nPFB1YlN1YlNlcnZlcj4+IHJlZ2lvblNlcnZlcnNNYXA7CiAgICAvLyBNYXAg\nd2l0aCBrZXlzIGJlaW5nIFJlZ2lvbiBuYW1lcyBhbmQgdmFsdWVzIGJlaW5n\nIHRoZSBIZWR3aWcgQ2xpZW50CiAgICAvLyBpbnN0YW5jZS4KICAgIHByb3Rl\nY3RlZCBNYXA8U3RyaW5nLCBIZWR3aWdDbGllbnQ+IHJlZ2lvbkNsaWVudHNN\nYXA7CgogICAgcHJvdGVjdGVkIE1hcDxTdHJpbmcsIEludGVnZXI+IHJlZ2lv\nbk5hbWVUb0luZGV4TWFwOwogICAgcHJvdGVjdGVkIE1hcDxJbnRlZ2VyLCBM\naXN0PEhlZHdpZ1NvY2tldEFkZHJlc3M+PiByZWdpb25IdWJBZGRyZXNzZXM7\nCgogICAgLy8gU3RyaW5nIGNvbnN0YW50IHVzZWQgYXMgdGhlIHByZWZpeCBm\nb3IgdGhlIHJlZ2lvbiBuYW1lcy4KICAgIHByb3RlY3RlZCBzdGF0aWMgZmlu\nYWwgU3RyaW5nIFJFR0lPTl9QUkVGSVggPSAicmVnaW9uIjsKCiAgICAvLyBE\nZWZhdWx0IGNoaWxkIGNsYXNzIG9mIHRoZSBTZXJ2ZXJDb25maWd1cmF0aW9u\nIHRvIGJlIHVzZWQgaGVyZS4KICAgIC8vIEV4dGVuZGluZyBjbGFzc2VzIGNh\nbiBkZWZpbmUgdGhlaXIgb3duIChwb3NzaWJseSBleHRlbmRpbmcgZnJvbSB0\naGlzKSBhbmQKICAgIC8vIG92ZXJyaWRlIHRoZSBnZXRTZXJ2ZXJDb25maWd1\ncmF0aW9uIG1ldGhvZCBiZWxvdyB0byByZXR1cm4gdGhlaXIgb3duCiAgICAv\nLyBjb25maWd1cmF0aW9uLgogICAgcHJvdGVjdGVkIGNsYXNzIFJlZ2lvblNl\ncnZlckNvbmZpZ3VyYXRpb24gZXh0ZW5kcyBTZXJ2ZXJDb25maWd1cmF0aW9u\nIHsKICAgICAgICBwcml2YXRlIGZpbmFsIGludCBzZXJ2ZXJQb3J0LCBzc2xT\nZXJ2ZXJQb3J0OwogICAgICAgIHByaXZhdGUgZmluYWwgU3RyaW5nIHJlZ2lv\nbk5hbWU7CgogICAgICAgIHB1YmxpYyBSZWdpb25TZXJ2ZXJDb25maWd1cmF0\naW9uKGludCBzZXJ2ZXJQb3J0LCBpbnQgc3NsU2VydmVyUG9ydCwgU3RyaW5n\nIHJlZ2lvbk5hbWUpIHsKICAgICAgICAgICAgdGhpcy5zZXJ2ZXJQb3J0ID0g\nc2VydmVyUG9ydDsKICAgICAgICAgICAgdGhpcy5zc2xTZXJ2ZXJQb3J0ID0g\nc3NsU2VydmVyUG9ydDsKICAgICAgICAgICAgdGhpcy5yZWdpb25OYW1lID0g\ncmVnaW9uTmFtZTsKICAgICAgICAgICAgY29uZi5zZXRQcm9wZXJ0eShSRUdJ\nT04sIHJlZ2lvbk5hbWUpOwogICAgICAgICAgICBzZXRSZWdpb25MaXN0KCk7\nCiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBzZXRSZWdpb25M\naXN0KCkgewogICAgICAgICAgICBMaXN0PFN0cmluZz4gbXlSZWdpb25MaXN0\nID0gbmV3IExpbmtlZExpc3Q8U3RyaW5nPigpOwogICAgICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bVJlZ2lvbnM7IGkrKykgewogICAgICAgICAg\nICAgICAgaW50IGN1ckRlZmF1bHRTZXJ2ZXJQb3J0ID0gcmVnaW9uSHViQWRk\ncmVzc2VzLmdldChpKS5nZXQoMCkuZ2V0UG9ydCgpOwogICAgICAgICAgICAg\nICAgaW50IGN1ckRlZmF1bHRTU0xTZXJ2ZXJQb3J0ID0gcmVnaW9uSHViQWRk\ncmVzc2VzLmdldChpKS5nZXQoMCkuZ2V0U1NMUG9ydCgpOwogICAgICAgICAg\nICAgICAgLy8gQWRkIHRoaXMgcmVnaW9uIGRlZmF1bHQgc2VydmVyIHBvcnQg\naWYgaXQgaXMgZm9yIGEgcmVnaW9uCiAgICAgICAgICAgICAgICAvLyBvdGhl\nciB0aGFuIGl0cyBvd24uCiAgICAgICAgICAgICAgICBpZiAocmVnaW9uTmFt\nZVRvSW5kZXhNYXAuZ2V0KHJlZ2lvbk5hbWUpICE9IGkpIHsKICAgICAgICAg\nICAgICAgICAgICBteVJlZ2lvbkxpc3QuYWRkKCJsb2NhbGhvc3Q6IiArIGN1\nckRlZmF1bHRTZXJ2ZXJQb3J0ICsgIjoiICsgY3VyRGVmYXVsdFNTTFNlcnZl\nclBvcnQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAg\nICAgICAgICByZWdpb25MaXN0ID0gbXlSZWdpb25MaXN0OwogICAgICAgIH0K\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBnZXRTZXJ2\nZXJQb3J0KCkgewogICAgICAgICAgICByZXR1cm4gc2VydmVyUG9ydDsKICAg\nICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBpbnQg\nZ2V0U1NMU2VydmVyUG9ydCgpIHsKICAgICAgICAgICAgcmV0dXJuIHNzbFNl\ncnZlclBvcnQ7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgU3RyaW5nIGdldFprSG9zdCgpIHsKICAgICAgICAgICAgcmV0\ndXJuIGJrdGIuZ2V0WmtIb3N0UG9ydCgpOwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRNeVJlZ2lvbigp\nIHsKICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbk5hbWU7CiAgICAgICAgfQoK\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc1NT\nTEVuYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4g\naXNJbnRlclJlZ2lvblNTTEVuYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVy\nbiB0cnVlOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIFN0cmluZyBnZXRDZXJ0TmFtZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuICIvc2VydmVyLnAxMiI7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldFBhc3N3b3JkKCkgewogICAg\nICAgICAgICByZXR1cm4gImVVeVN2cDJwaE0yV2siOwogICAgICAgIH0KICAg\nIH0KCiAgICAvLyBNZXRob2QgdG8gZ2V0IGEgU2VydmVyQ29uZmlndXJhdGlv\nbiBmb3IgdGhlIFB1YlN1YlNlcnZlcnMgY3JlYXRlZCB1c2luZwogICAgLy8g\ndGhlIHNwZWNpZmllZCBwb3J0cyBhbmQgcmVnaW9uIG5hbWUuIEV4dGVuZGlu\nZyBjaGlsZCBjbGFzc2VzIGNhbiBvdmVycmlkZQogICAgLy8gdGhpcy4gVGhp\ncyBkZWZhdWx0IGltcGxlbWVudGF0aW9uIHdpbGwgcmV0dXJuIHRoZQogICAg\nLy8gUmVnaW9uU2VydmVyQ29uZmlndXJhdGlvbiBvYmplY3QgZGVmaW5lZCBh\nYm92ZS4KICAgIHByb3RlY3RlZCBTZXJ2ZXJDb25maWd1cmF0aW9uIGdldFNl\ncnZlckNvbmZpZ3VyYXRpb24oaW50IHNlcnZlclBvcnQsIGludCBzc2xTZXJ2\nZXJQb3J0LCBTdHJpbmcgcmVnaW9uTmFtZSkgewogICAgICAgIHJldHVybiBu\nZXcgUmVnaW9uU2VydmVyQ29uZmlndXJhdGlvbihzZXJ2ZXJQb3J0LCBzc2xT\nZXJ2ZXJQb3J0LCByZWdpb25OYW1lKTsKICAgIH0KCiAgICAvLyBEZWZhdWx0\nIENsaWVudENvbmZpZ3VyYXRpb24gdG8gdXNlLiBUaGlzIGp1c3QgcG9pbnRz\nIHRvIHRoZSBmaXJzdAogICAgLy8gSGVkd2lnIGh1YiBzZXJ2ZXIgaW4gZWFj\naCByZWdpb24gYXMgdGhlICJkZWZhdWx0IHNlcnZlciBob3N0IiB0byBjb25u\nZWN0CiAgICAvLyB0by4KICAgIHByb3RlY3RlZCBjbGFzcyBSZWdpb25DbGll\nbnRDb25maWd1cmF0aW9uIGV4dGVuZHMgQ2xpZW50Q29uZmlndXJhdGlvbiB7\nCiAgICAgICAgcHVibGljIFJlZ2lvbkNsaWVudENvbmZpZ3VyYXRpb24oaW50\nIHNlcnZlclBvcnQsIGludCBzc2xTZXJ2ZXJQb3J0KSB7CiAgICAgICAgICAg\nIG15RGVmYXVsdFNlcnZlckFkZHJlc3MgPSBuZXcgSGVkd2lnU29ja2V0QWRk\ncmVzcygibG9jYWxob3N0OiIgKyBzZXJ2ZXJQb3J0ICsgIjoiICsgc3NsU2Vy\ndmVyUG9ydCk7CiAgICAgICAgfQogICAgICAgIC8vIEJlbG93IHlvdSBjYW4g\nb3ZlcnJpZGUgYW55IG9mIHRoZSBkZWZhdWx0IENsaWVudENvbmZpZ3VyYXRp\nb24KICAgICAgICAvLyBwYXJhbWV0ZXJzIGlmIG5lZWRlZC4KICAgIH0KCiAg\nICAvLyBNZXRob2QgdG8gZ2V0IGEgQ2xpZW50Q29uZmlndXJhdGlvbiBmb3Ig\ndGhlIEhlZHdpZ0NsaWVudHMgY3JlYXRlZC4KICAgIC8vIElucHV0cyBhcmUg\ndGhlIGRlZmF1bHQgSGVkd2lnIGh1YiBzZXJ2ZXIncyBwb3J0cyB0byBwb2lu\ndCB0by4KICAgIHByb3RlY3RlZCBDbGllbnRDb25maWd1cmF0aW9uIGdldENs\naWVudENvbmZpZ3VyYXRpb24oaW50IHNlcnZlclBvcnQsIGludCBzc2xTZXJ2\nZXJQb3J0KSB7CiAgICAgICAgcmV0dXJuIG5ldyBSZWdpb25DbGllbnRDb25m\naWd1cmF0aW9uKHNlcnZlclBvcnQsIHNzbFNlcnZlclBvcnQpOwogICAgfQoK\nICAgIC8vIE1ldGhvZCB0byBnZXQgYSBDbGllbnRDb25maWd1cmF0aW9uIGZv\nciB0aGUgQ3Jvc3MgUmVnaW9uIEhlZHdpZyBDbGllbnQuCiAgICBwcm90ZWN0\nZWQgQ2xpZW50Q29uZmlndXJhdGlvbiBnZXRSZWdpb25DbGllbnRDb25maWd1\ncmF0aW9uKCkgewogICAgICAgIHJldHVybiBuZXcgQ2xpZW50Q29uZmlndXJh\ndGlvbigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyBIZWR3aWdTb2NrZXRBZGRyZXNzIGdldERlZmF1bHRTZXJ2ZXJIZWR3\naWdTb2NrZXRBZGRyZXNzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJl\nZ2lvbkh1YkFkZHJlc3Nlcy5nZXQoMCkuZ2V0KDApOwogICAgICAgICAgICB9\nCiAgICAgICAgfTsKICAgIH0KCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9p\nZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxvZ2dlci5p\nbmZvKCJTVEFSVElORyAiICsgZ2V0Q2xhc3MoKSk7CiAgICAgICAgYmt0YiA9\nIG5ldyBCb29rS2VlcGVyVGVzdEJhc2UobnVtQm9va2llcyk7CiAgICAgICAg\nYmt0Yi5zZXRVcCgpOwoKICAgICAgICAvLyBDcmVhdGUgdGhlIEhlZHdpZyBQ\ndWJTdWJTZXJ2ZXIgSHVicyBmb3IgYWxsIG9mIHRoZSByZWdpb25zCiAgICAg\nICAgcmVnaW9uU2VydmVyc01hcCA9IG5ldyBIYXNoTWFwPFN0cmluZywgTGlz\ndDxQdWJTdWJTZXJ2ZXI+PihudW1SZWdpb25zLCAxLjBmKTsKICAgICAgICBy\nZWdpb25DbGllbnRzTWFwID0gbmV3IEhhc2hNYXA8U3RyaW5nLCBIZWR3aWdD\nbGllbnQ+KG51bVJlZ2lvbnMsIDEuMGYpOwoKICAgICAgICByZWdpb25IdWJB\nZGRyZXNzZXMgPSBuZXcgSGFzaE1hcDxJbnRlZ2VyLCBMaXN0PEhlZHdpZ1Nv\nY2tldEFkZHJlc3M+PihudW1SZWdpb25zLCAxLjBmKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IG51bVJlZ2lvbnM7IGkrKykgewogICAgICAgICAg\nICBMaXN0PEhlZHdpZ1NvY2tldEFkZHJlc3M+IGFkZHJlc3NlcyA9IG5ldyBM\naW5rZWRMaXN0PEhlZHdpZ1NvY2tldEFkZHJlc3M+KCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgbnVtU2VydmVyc1BlclJlZ2lvbjsgaisr\nKSB7CiAgICAgICAgICAgICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIGEgPSBu\nZXcgSGVkd2lnU29ja2V0QWRkcmVzcygibG9jYWxob3N0IiwKICAgICAgICAg\nICAgICAgICAgICAgICAgUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCksIFBv\ncnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpKTsKICAgICAgICAgICAgICAgIGFk\nZHJlc3Nlcy5hZGQoYSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVn\naW9uSHViQWRkcmVzc2VzLnB1dChpLCBhZGRyZXNzZXMpOwogICAgICAgIH0K\nICAgICAgICByZWdpb25OYW1lVG9JbmRleE1hcCA9IG5ldyBIYXNoTWFwPFN0\ncmluZywgSW50ZWdlcj4oKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBudW1SZWdpb25zOyBpKyspIHsKICAgICAgICAgICAgc3RhcnRSZWdpb24o\naSk7CiAgICAgICAgfQogICAgICAgIGxvZ2dlci5pbmZvKCJIZWR3aWdSZWdp\nb24gdGVzdCBzZXR1cCBmaW5pc2hlZCIpOwogICAgfQoKICAgIEBBZnRlcgog\nICAgcHVibGljIHZvaWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBsb2dnZXIuaW5mbygidGVhckRvd24gc3RhcnRpbmciKTsKICAg\nICAgICAvLyBTdG9wIGFsbCBvZiB0aGUgSGVkd2lnQ2xpZW50cyBmb3IgYWxs\nIHJlZ2lvbnMKICAgICAgICBmb3IgKEhlZHdpZ0NsaWVudCBjbGllbnQgOiBy\nZWdpb25DbGllbnRzTWFwLnZhbHVlcygpKSB7CiAgICAgICAgICAgIGNsaWVu\ndC5jbG9zZSgpOwogICAgICAgIH0KICAgICAgICByZWdpb25DbGllbnRzTWFw\nLmNsZWFyKCk7CiAgICAgICAgLy8gU2h1dGRvd24gYWxsIG9mIHRoZSBQdWJT\ndWJTZXJ2ZXJzIGluIGFsbCByZWdpb25zCiAgICAgICAgZm9yIChMaXN0PFB1\nYlN1YlNlcnZlcj4gc2VydmVyc0xpc3QgOiByZWdpb25TZXJ2ZXJzTWFwLnZh\nbHVlcygpKSB7CiAgICAgICAgICAgIGZvciAoUHViU3ViU2VydmVyIHNlcnZl\nciA6IHNlcnZlcnNMaXN0KSB7CiAgICAgICAgICAgICAgICBzZXJ2ZXIuc2h1\ndGRvd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsb2dn\nZXIuaW5mbygiRmluaXNoZWQgc2h1dHRpbmcgZG93biBhbGwgb2YgdGhlIGh1\nYiBzZXJ2ZXJzISIpOwogICAgICAgIHJlZ2lvblNlcnZlcnNNYXAuY2xlYXIo\nKTsKICAgICAgICAvLyBTaHV0ZG93biB0aGUgQm9va0tlZXBlciBhbmQgWm9v\nS2VlcGVyIHN0dWZmCiAgICAgICAgYmt0Yi50ZWFyRG93bigpOwogICAgICAg\nIGxvZ2dlci5pbmZvKCJGSU5JU0hFRCAiICsgZ2V0Q2xhc3MoKSk7CiAgICB9\nCgogICAgcHJvdGVjdGVkIHZvaWQgc3RvcFJlZ2lvbihpbnQgcmVnaW9uSWR4\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgcmVnaW9uTmFt\nZSA9IFJFR0lPTl9QUkVGSVggKyByZWdpb25JZHg7CiAgICAgICAgaWYgKGxv\nZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci5k\nZWJ1ZygiU3RvcCByZWdpb24gOiAiICsgcmVnaW9uTmFtZSk7CiAgICAgICAg\nfQogICAgICAgIEhlZHdpZ0NsaWVudCByZWdpb25DbGllbnQgPSByZWdpb25D\nbGllbnRzTWFwLnJlbW92ZShyZWdpb25OYW1lKTsKICAgICAgICBpZiAobnVs\nbCAhPSByZWdpb25DbGllbnQpIHsKICAgICAgICAgICAgcmVnaW9uQ2xpZW50\nLmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIExpc3Q8UHViU3ViU2VydmVy\nPiBzZXJ2ZXJzTGlzdCA9IHJlZ2lvblNlcnZlcnNNYXAucmVtb3ZlKHJlZ2lv\nbk5hbWUpOwogICAgICAgIGlmIChudWxsID09IHNlcnZlcnNMaXN0KSB7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZm9yIChQdWJT\ndWJTZXJ2ZXIgc2VydmVyIDogc2VydmVyc0xpc3QpIHsKICAgICAgICAgICAg\nc2VydmVyLnNodXRkb3duKCk7CiAgICAgICAgfQogICAgICAgIGxvZ2dlci5p\nbmZvKCJGaW5pc2hlZCBzaHV0dGluZyBkb3duIGFsbCBvZiB0aGUgaHViIHNl\ncnZlcnMgaW4gcmVnaW9uICIgKyByZWdpb25OYW1lKTsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBzdGFydFJlZ2lvbihpbnQgaSkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgU3RyaW5nIHJlZ2lvbk5hbWUgPSBSRUdJT05fUFJF\nRklYICsgaTsKICAgICAgICByZWdpb25OYW1lVG9JbmRleE1hcC5wdXQocmVn\naW9uTmFtZSwgaSk7CgogICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJs\nZWQoKSkgewogICAgICAgICAgICBsb2dnZXIuZGVidWcoIlN0YXJ0IHJlZ2lv\nbiA6ICIgKyByZWdpb25OYW1lKTsKICAgICAgICB9CgogICAgICAgIExpc3Q8\nUHViU3ViU2VydmVyPiBzZXJ2ZXJzTGlzdCA9IG5ldyBMaW5rZWRMaXN0PFB1\nYlN1YlNlcnZlcj4oKTsKICAgICAgICAvLyBGb3IgdGhlIGN1cnJlbnQgcmVn\naW9uLCBjcmVhdGUgdGhlIG5lY2Vzc2FyeSBhbW91bnQgb2YgaHViCiAgICAg\nICAgLy8gc2VydmVycy4gV2Ugd2lsbCBiYXNpY2FsbHkgaW5jcmVtZW50IHRo\ncm91Z2ggdGhlIHBvcnQgbnVtYmVycwogICAgICAgIC8vIHN0YXJ0aW5nIGZy\nb20gdGhlIGluaXRpYWwgb25lcyBkZWZpbmVkLgogICAgICAgIGZvciAoaW50\nIGogPSAwOyBqIDwgbnVtU2VydmVyc1BlclJlZ2lvbjsgaisrKSB7CiAgICAg\nICAgICAgIEhlZHdpZ1NvY2tldEFkZHJlc3MgYSA9IHJlZ2lvbkh1YkFkZHJl\nc3Nlcy5nZXQoaSkuZ2V0KGopOwogICAgICAgICAgICBQdWJTdWJTZXJ2ZXIg\ncyA9IG5ldyBQdWJTdWJTZXJ2ZXIoCiAgICAgICAgICAgICAgICAgICAgZ2V0\nU2VydmVyQ29uZmlndXJhdGlvbihhLmdldFBvcnQoKSwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuZ2V0U1NMUG9ydCgp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmVnaW9uTmFtZSksCiAgICAgICAgICAgICAgICAgICAgZ2V0UmVnaW9uQ2xp\nZW50Q29uZmlndXJhdGlvbigpLAogICAgICAgICAgICAgICAgICAgIG5ldyBM\nb2dnaW5nRXhjZXB0aW9uSGFuZGxlcigpKTsKICAgICAgICAgICAgc2VydmVy\nc0xpc3QuYWRkKHMpOwogICAgICAgICAgICBzLnN0YXJ0KCk7CiAgICAgICAg\nfQogICAgICAgIC8vIFN0b3JlIHRoaXMgbGlzdCBvZiBzZXJ2ZXJzIGNyZWF0\nZWQgZm9yIHRoZSBjdXJyZW50IHJlZ2lvbgogICAgICAgIHJlZ2lvblNlcnZl\ncnNNYXAucHV0KHJlZ2lvbk5hbWUsIHNlcnZlcnNMaXN0KTsKICAgICAgICAv\nLyBDcmVhdGUgYSBIZWR3aWcgQ2xpZW50IHRoYXQgcG9pbnRzIHRvIHRoZSBm\naXJzdCBIdWIgc2VydmVyCiAgICAgICAgLy8gY3JlYXRlZCBpbiB0aGUgbG9v\ncCBhYm92ZSBmb3IgdGhlIGN1cnJlbnQgcmVnaW9uLgogICAgICAgIEhlZHdp\nZ0NsaWVudCByZWdpb25DbGllbnQgPSBuZXcgSGVkd2lnQ2xpZW50KAogICAg\nICAgICAgICAgICAgZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihyZWdpb25IdWJB\nZGRyZXNzZXMuZ2V0KGkpLmdldCgwKS5nZXRQb3J0KCksCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZ2lvbkh1YkFkZHJlc3Nl\ncy5nZXQoaSkuZ2V0KDApLmdldFNTTFBvcnQoKSkpOwogICAgICAgIHJlZ2lv\nbkNsaWVudHNNYXAucHV0KHJlZ2lvbk5hbWUsIHJlZ2lvbkNsaWVudCk7CiAg\nICB9Cn0K\n","encoding":"base64"}

