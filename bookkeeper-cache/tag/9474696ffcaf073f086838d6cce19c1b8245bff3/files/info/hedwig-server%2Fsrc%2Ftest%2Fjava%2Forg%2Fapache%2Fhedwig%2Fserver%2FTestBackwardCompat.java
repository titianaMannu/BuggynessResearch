{"sha":"f4e806d67dce41ff6824eb0c09bbf25a68360f55","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjRlODA2ZDY3ZGNlNDFmZjY4MjRlYjBjMDliYmYyNWE2ODM2MGY1NQ==","size":53663,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f4e806d67dce41ff6824eb0c09bbf25a68360f55","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXI7CgppbXBvcnQgamF2YS5u\nZXQuSW5ldEFkZHJlc3M7CmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBq\nYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5MaXN0Owpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1w\nb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKCmltcG9ydCBv\ncmcuanVuaXQuVGVzdDsKaW1wb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0\nLio7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnRlc3QuWm9vS2Vl\ncGVyVXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LlBv\ncnRNYW5hZ2VyOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuSGVk\nd2lnU29ja2V0QWRkcmVzczsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nY29uZmlndXJhdGlvbi5Db25maWd1cmF0aW9uOwppbXBvcnQgb3JnLnNsZjRq\nLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoq\nCiAqIFRlc3QgQmFja3dhcmQgQ29tcGF0YWJpbGl0eSBiZXR3ZWVuIGRpZmZl\ncmVudCB2ZXJzaW9ucwogKi8KcHVibGljIGNsYXNzIFRlc3RCYWNrd2FyZENv\nbXBhdCB7CgogICAgcHJpdmF0ZSBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExv\nZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlc3RCYWNrd2FyZENvbXBhdC5jbGFz\ncyk7CgogICAgc3RhdGljIGZpbmFsIGludCBDT05TVU1FSU5URVJWQUwgPSA1\nOwogICAgc3RhdGljIFpvb0tlZXBlclV0aWwgemtVdGlsID0gbmV3IFpvb0tl\nZXBlclV0aWwoKTsKCiAgICBzdGF0aWMgY2xhc3MgQm9va0tlZXBlckNsdXN0\nZXI0MDAgewoKICAgICAgICBpbnQgbnVtQm9va2llczsKICAgICAgICBMaXN0\nPG9yZy5hcGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uPiBia0NvbmZzOwogICAgICAgIExpc3Q8b3JnLmFwYWNo\nZS5od192NF8wXzAuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXI+IGJr\nczsKCiAgICAgICAgQm9va0tlZXBlckNsdXN0ZXI0MDAoaW50IG51bUJvb2tp\nZXMpIHsKICAgICAgICAgICAgdGhpcy5udW1Cb29raWVzID0gbnVtQm9va2ll\nczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0YXJ0KCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHprVXRpbC5zdGFydFNlcnZl\ncigpOwoKICAgICAgICAgICAgYmtzID0gbmV3IExpbmtlZExpc3Q8b3JnLmFw\nYWNoZS5od192NF8wXzAuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXI+\nKCk7CiAgICAgICAgICAgIGJrQ29uZnMgPSBuZXcgTGlua2VkTGlzdDxvcmcu\nYXBhY2hlLmh3X3Y0XzBfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmln\ndXJhdGlvbj4oKTsKCiAgICAgICAgICAgIGZvciAoaW50IGk9MDsgaTxudW1C\nb29raWVzOyBpKyspIHsKICAgICAgICAgICAgICAgIHN0YXJ0Qm9va2llU2Vy\ndmVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHN0b3AoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nZm9yIChvcmcuYXBhY2hlLmh3X3Y0XzBfMC5ib29ra2VlcGVyLnByb3RvLkJv\nb2tpZVNlcnZlciBicyA6IGJrcykgewogICAgICAgICAgICAgICAgYnMuc2h1\ndGRvd24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBia3MuY2xlYXIo\nKTsKCiAgICAgICAgICAgIHprVXRpbC5raWxsU2VydmVyKCk7CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBzdGFydEJvb2tpZVNlcnZlcigp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpbnQgcG9ydCA9IFBv\ncnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAgICAgICBGaWxlIHRt\ncERpciA9IG9yZy5hcGFjaGUuaHdfdjRfMF8wLmhlZHdpZy51dGlsLkZpbGVV\ndGlscy5jcmVhdGVUZW1wRGlyZWN0b3J5KAogICAgICAgICAgICAgICAgZ2V0\nQ2xhc3MoKS5nZXROYW1lKCkgKyBwb3J0LCAidGVzdCIpOwogICAgICAgICAg\nICBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVy\nQ29uZmlndXJhdGlvbiBjb25mID0gbmV3U2VydmVyQ29uZmlndXJhdGlvbigK\nICAgICAgICAgICAgICAgIHBvcnQsIHprVXRpbC5nZXRab29LZWVwZXJDb25u\nZWN0U3RyaW5nKCksIHRtcERpciwgbmV3IEZpbGVbXSB7IHRtcERpciB9KTsK\nICAgICAgICAgICAgYmtzLmFkZChzdGFydEJvb2tpZShjb25mKSk7CiAgICAg\nICAgICAgIGJrQ29uZnMuYWRkKGNvbmYpOwogICAgICAgIH0KCiAgICAgICAg\ncHJvdGVjdGVkIG9yZy5hcGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIuY29u\nZi5TZXJ2ZXJDb25maWd1cmF0aW9uIG5ld1NlcnZlckNvbmZpZ3VyYXRpb24o\nCiAgICAgICAgICAgIGludCBwb3J0LCBTdHJpbmcgemtTZXJ2ZXJzLCBGaWxl\nIGpvdXJuYWxEaXIsIEZpbGVbXSBsZWRnZXJEaXJzKSB7CiAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uIGNvbmYgPQogICAgICAgICAgICAgICAgbmV3IG9yZy5h\ncGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgICAgIGNvbmYuc2V0Qm9va2llUG9ydChwb3J0\nKTsKICAgICAgICAgICAgY29uZi5zZXRaa1NlcnZlcnMoemtTZXJ2ZXJzKTsK\nICAgICAgICAgICAgY29uZi5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGly\nLmdldFBhdGgoKSk7CiAgICAgICAgICAgIFN0cmluZ1tdIGxlZGdlckRpck5h\nbWVzID0gbmV3IFN0cmluZ1tsZWRnZXJEaXJzLmxlbmd0aF07CiAgICAgICAg\nICAgIGZvciAoaW50IGk9MDsgaTxsZWRnZXJEaXJzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBsZWRnZXJEaXJOYW1lc1tpXSA9IGxlZGdlckRp\ncnNbaV0uZ2V0UGF0aCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNv\nbmYuc2V0TGVkZ2VyRGlyTmFtZXMobGVkZ2VyRGlyTmFtZXMpOwogICAgICAg\nICAgICByZXR1cm4gY29uZjsKICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5ib29ra2VlcGVyLnByb3RvLkJvb2tp\nZVNlcnZlciBzdGFydEJvb2tpZSgKICAgICAgICAgICAgb3JnLmFwYWNoZS5o\nd192NF8wXzAuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZikgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIG9yZy5hcGFj\naGUuaHdfdjRfMF8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyIHNl\ncnZlcgogICAgICAgICAgICAgICAgPSBuZXcgb3JnLmFwYWNoZS5od192NF8w\nXzAuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXIoY29uZik7CiAgICAg\nICAgICAgIHNlcnZlci5zdGFydCgpOwoKICAgICAgICAgICAgaW50IHBvcnQg\nPSBjb25mLmdldEJvb2tpZVBvcnQoKTsKICAgICAgICAgICAgd2hpbGUgKHpr\nVXRpbC5nZXRab29LZWVwZXJDbGllbnQoKS5leGlzdHMoCiAgICAgICAgICAg\nICAgICAgICAgIi9sZWRnZXJzL2F2YWlsYWJsZS8iICsgSW5ldEFkZHJlc3Mu\nZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSArICI6IiArIHBvcnQs\nCiAgICAgICAgICAgICAgICAgICAgZmFsc2UpID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIFRocmVhZC5zbGVlcCg1MDApOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIHJldHVybiBzZXJ2ZXI7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogVmVyc2lvbiA0LjAuMCBjbGFzc2VzCiAgICAgKi8KICAg\nIHN0YXRpYyBjbGFzcyBTZXJ2ZXI0MDAgewogICAgICAgIG9yZy5hcGFjaGUu\naHdfdjRfMF8wLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZjsKICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3\naWcuc2VydmVyLm5ldHR5LlB1YlN1YlNlcnZlciBzZXJ2ZXI7CgogICAgICAg\nIFNlcnZlcjQwMChmaW5hbCBTdHJpbmcgemtIb3N0cywgZmluYWwgaW50IHBv\ncnQsIGZpbmFsIGludCBzc2xQb3J0KSB7CiAgICAgICAgICAgIGNvbmYgPSBu\nZXcgb3JnLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLnNlcnZlci5jb21tb24u\nU2VydmVyQ29uZmlndXJhdGlvbigpIHsKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIFN0cmluZyBnZXRaa0hvc3Qo\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHprSG9zdHM7CiAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICBwdWJsaWMgaW50IGdldFNlcnZlclBvcnQoKSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHBvcnQ7CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBw\ndWJsaWMgaW50IGdldFNTTFNlcnZlclBvcnQoKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIHNzbFBvcnQ7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH07CiAgICAgICAgfQoKICAgICAgICB2b2lkIHN0YXJ0KCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHNlcnZlciA9IG5ldyBvcmcu\nYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcuc2VydmVyLm5ldHR5LlB1YlN1YlNl\ncnZlcihjb25mKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgc3RvcCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpZiAobnVsbCAhPSBzZXJ2\nZXIpIHsKICAgICAgICAgICAgICAgIHNlcnZlci5zaHV0ZG93bigpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRpYyBjbGFzcyBD\nbGllbnQ0MDAgewogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMF8wLmhlZHdp\nZy5jbGllbnQuY29uZi5DbGllbnRDb25maWd1cmF0aW9uIGNvbmY7CiAgICAg\nICAgb3JnLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLmNsaWVudC5hcGkuQ2xp\nZW50IGNsaWVudDsKICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3\naWcuY2xpZW50LmFwaS5QdWJsaXNoZXIgcHVibGlzaGVyOwogICAgICAgIG9y\nZy5hcGFjaGUuaHdfdjRfMF8wLmhlZHdpZy5jbGllbnQuYXBpLlN1YnNjcmli\nZXIgc3Vic2NyaWJlcjsKCiAgICAgICAgQ2xpZW50NDAwKGZpbmFsIFN0cmlu\nZyBjb25uZWN0U3RyaW5nKSB7CiAgICAgICAgICAgIGNvbmYgPSBuZXcgb3Jn\nLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLmNsaWVudC5jb25mLkNsaWVudENv\nbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICAgICAgcHJvdGVjdGVkIG9yZy5hcGFjaGUuaHdf\ndjRfMF8wLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3MKICAgICAg\nICAgICAgICAgICAgICAgICAgZ2V0RGVmYXVsdFNlcnZlckhlZHdpZ1NvY2tl\ndEFkZHJlc3MoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBu\nZXcgb3JnLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLnV0aWwuSGVkd2lnU29j\na2V0QWRkcmVzcyhjb25uZWN0U3RyaW5nKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBjbGllbnQgPSBu\nZXcgb3JnLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLmNsaWVudC5IZWR3aWdD\nbGllbnQoY29uZik7CiAgICAgICAgICAgIHB1Ymxpc2hlciA9IGNsaWVudC5n\nZXRQdWJsaXNoZXIoKTsKICAgICAgICAgICAgc3Vic2NyaWJlciA9IGNsaWVu\ndC5nZXRTdWJzY3JpYmVyKCk7CiAgICAgICAgfQoKICAgICAgICB2b2lkIGNs\nb3NlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChudWxs\nICE9IGNsaWVudCkgewogICAgICAgICAgICAgICAgY2xpZW50LmNsb3NlKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIG9yZy5hcGFjaGUu\naHdfdjRfMF8wLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlU2VxSWQgcHVibGlzaCgKICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3Bp\nYywgQnl0ZVN0cmluZyBkYXRhKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgb3JnLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2UgbWVzc2FnZSA9CiAgICAgICAgICAgICAg\nICBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgICAg\nICAgICAuc2V0Qm9keShkYXRhKS5idWlsZCgpOwogICAgICAgICAgICBwdWJs\naXNoZXIucHVibGlzaCh0b3BpYywgbWVzc2FnZSk7CiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgY2xhc3Mg\nQm9va0tlZXBlckNsdXN0ZXI0MTAgewoKICAgICAgICBpbnQgbnVtQm9va2ll\nczsKICAgICAgICBMaXN0PG9yZy5hcGFjaGUuaHdfdjRfMV8wLmJvb2trZWVw\nZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uPiBia0NvbmZzOwogICAgICAg\nIExpc3Q8b3JnLmFwYWNoZS5od192NF8xXzAuYm9va2tlZXBlci5wcm90by5C\nb29raWVTZXJ2ZXI+IGJrczsKCiAgICAgICAgQm9va0tlZXBlckNsdXN0ZXI0\nMTAoaW50IG51bUJvb2tpZXMpIHsKICAgICAgICAgICAgdGhpcy5udW1Cb29r\naWVzID0gbnVtQm9va2llczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2\nb2lkIHN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHpr\nVXRpbC5zdGFydFNlcnZlcigpOwoKICAgICAgICAgICAgYmtzID0gbmV3IExp\nbmtlZExpc3Q8b3JnLmFwYWNoZS5od192NF8xXzAuYm9va2tlZXBlci5wcm90\nby5Cb29raWVTZXJ2ZXI+KCk7CiAgICAgICAgICAgIGJrQ29uZnMgPSBuZXcg\nTGlua2VkTGlzdDxvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29ra2VlcGVyLmNv\nbmYuU2VydmVyQ29uZmlndXJhdGlvbj4oKTsKCiAgICAgICAgICAgIGZvciAo\naW50IGk9MDsgaTxudW1Cb29raWVzOyBpKyspIHsKICAgICAgICAgICAgICAg\nIHN0YXJ0Qm9va2llU2VydmVyKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHN0b3AoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgZm9yIChvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29r\na2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlciBicyA6IGJrcykgewogICAgICAg\nICAgICAgICAgYnMuc2h1dGRvd24oKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBia3MuY2xlYXIoKTsKCiAgICAgICAgICAgIHprVXRpbC5raWxsU2Vy\ndmVyKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBzdGFy\ndEJvb2tpZVNlcnZlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAg\nICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAg\nICAgICAgICBGaWxlIHRtcERpciA9IG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhl\nZHdpZy51dGlsLkZpbGVVdGlscy5jcmVhdGVUZW1wRGlyZWN0b3J5KAogICAg\nICAgICAgICAgICAgZ2V0Q2xhc3MoKS5nZXROYW1lKCkgKyBwb3J0LCAidGVz\ndCIpOwogICAgICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29ra2Vl\ncGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3U2VydmVy\nQ29uZmlndXJhdGlvbigKICAgICAgICAgICAgICAgICAgICBwb3J0LCB6a1V0\naWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLCB0bXBEaXIsIG5ldyBG\naWxlW10geyB0bXBEaXIgfSk7CiAgICAgICAgICAgIGJrcy5hZGQoc3RhcnRC\nb29raWUoY29uZikpOwogICAgICAgICAgICBia0NvbmZzLmFkZChjb25mKTsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmh3X3Y0\nXzFfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbiBuZXdT\nZXJ2ZXJDb25maWd1cmF0aW9uKAogICAgICAgICAgICBpbnQgcG9ydCwgU3Ry\naW5nIHprU2VydmVycywgRmlsZSBqb3VybmFsRGlyLCBGaWxlW10gbGVkZ2Vy\nRGlycykgewogICAgICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29r\na2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0KICAgICAg\nICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29ra2VlcGVy\nLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgICAgICBjb25m\nLnNldEJvb2tpZVBvcnQocG9ydCk7CiAgICAgICAgICAgIGNvbmYuc2V0WmtT\nZXJ2ZXJzKHprU2VydmVycyk7CiAgICAgICAgICAgIGNvbmYuc2V0Sm91cm5h\nbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpOwogICAgICAgICAgICBT\ndHJpbmdbXSBsZWRnZXJEaXJOYW1lcyA9IG5ldyBTdHJpbmdbbGVkZ2VyRGly\ncy5sZW5ndGhdOwogICAgICAgICAgICBmb3IgKGludCBpPTA7IGk8bGVkZ2Vy\nRGlycy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgbGVkZ2VyRGly\nTmFtZXNbaV0gPSBsZWRnZXJEaXJzW2ldLmdldFBhdGgoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBjb25mLnNldExlZGdlckRpck5hbWVzKGxlZGdl\nckRpck5hbWVzKTsKICAgICAgICAgICAgcmV0dXJuIGNvbmY7CiAgICAgICAg\nfQoKICAgICAgICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5od192NF8xXzAuYm9v\na2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXIgc3RhcnRCb29raWUoCiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmJvb2trZWVwZXIuY29uZi5T\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29ra2VlcGVyLnBy\nb3RvLkJvb2tpZVNlcnZlciBzZXJ2ZXIKICAgICAgICAgICAgICAgID0gbmV3\nIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmJvb2trZWVwZXIucHJvdG8uQm9va2ll\nU2VydmVyKGNvbmYpOwogICAgICAgICAgICBzZXJ2ZXIuc3RhcnQoKTsKCiAg\nICAgICAgICAgIGludCBwb3J0ID0gY29uZi5nZXRCb29raWVQb3J0KCk7CiAg\nICAgICAgICAgIHdoaWxlICh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ2xpZW50KCku\nZXhpc3RzKAogICAgICAgICAgICAgICAgICAgICIvbGVkZ2Vycy9hdmFpbGFi\nbGUvIiArIEluZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRy\nZXNzKCkgKyAiOiIgKyBwb3J0LAogICAgICAgICAgICAgICAgICAgIGZhbHNl\nKSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoNTAw\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VydmVyOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFZlcnNpb24gNC4xLjAg\nY2xhc3NlcwogICAgICovCiAgICBzdGF0aWMgY2xhc3MgU2VydmVyNDEwIHsK\nICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcuc2VydmVyLmNv\nbW1vbi5TZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICAgICAgb3JnLmFw\nYWNoZS5od192NF8xXzAuaGVkd2lnLnNlcnZlci5uZXR0eS5QdWJTdWJTZXJ2\nZXIgc2VydmVyOwoKICAgICAgICBTZXJ2ZXI0MTAoZmluYWwgU3RyaW5nIHpr\nSG9zdHMsIGZpbmFsIGludCBwb3J0LCBmaW5hbCBpbnQgc3NsUG9ydCkgewog\nICAgICAgICAgICBjb25mID0gbmV3IG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhl\nZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRpb24oKSB7CiAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1Ymxp\nYyBpbnQgZ2V0Q29uc3VtZUludGVydmFsKCkgewogICAgICAgICAgICAgICAg\nICAgIHJldHVybiBDT05TVU1FSU5URVJWQUw7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0WmtIb3N0KCkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB6a0hvc3RzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIGludCBn\nZXRTZXJ2ZXJQb3J0KCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBw\nb3J0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIGludCBnZXRTU0xTZXJ2ZXJQ\nb3J0KCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzc2xQb3J0Owog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBzdGFydCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBzZXJ2ZXIgPSBuZXcgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2ln\nLnNlcnZlci5uZXR0eS5QdWJTdWJTZXJ2ZXIoY29uZik7CiAgICAgICAgICAg\nIHNlcnZlci5zdGFydCgpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzdG9w\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChudWxsICE9\nIHNlcnZlcikgewogICAgICAgICAgICAgICAgc2VydmVyLnNodXRkb3duKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgc3RhdGljIGNs\nYXNzIENsaWVudDQxMCB7CiAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAu\naGVkd2lnLmNsaWVudC5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24gY29uZjsK\nICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcuY2xpZW50LmFw\naS5DbGllbnQgY2xpZW50OwogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8w\nLmhlZHdpZy5jbGllbnQuYXBpLlB1Ymxpc2hlciBwdWJsaXNoZXI7CiAgICAg\nICAgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLmNsaWVudC5hcGkuU3Vi\nc2NyaWJlciBzdWJzY3JpYmVyOwoKICAgICAgICBjbGFzcyBJbnRNZXNzYWdl\nSGFuZGxlciBpbXBsZW1lbnRzIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdp\nZy5jbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyIHsKICAgICAgICAgICAgQnl0\nZVN0cmluZyB0b3BpYzsKICAgICAgICAgICAgQnl0ZVN0cmluZyBzdWJJZDsK\nICAgICAgICAgICAgaW50IG5leHQ7CgogICAgICAgICAgICBDb3VudERvd25M\nYXRjaCBsYXRjaDsKCiAgICAgICAgICAgIEludE1lc3NhZ2VIYW5kbGVyKEJ5\ndGVTdHJpbmcgdCwgQnl0ZVN0cmluZyBzLCBpbnQgc3RhcnQsIGludCBudW0p\nIHsKICAgICAgICAgICAgICAgIHRoaXMudG9waWMgPSB0OwogICAgICAgICAg\nICAgICAgdGhpcy5zdWJJZCA9IHM7CiAgICAgICAgICAgICAgICB0aGlzLm5l\neHQgPSBzdGFydDsKICAgICAgICAgICAgICAgIHRoaXMubGF0Y2ggPSBuZXcg\nQ291bnREb3duTGF0Y2gobnVtKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIGRlbGl2ZXIo\nQnl0ZVN0cmluZyB0LCBCeXRlU3RyaW5nIHMsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgbXNnLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhl\nZHdpZy51dGlsLkNhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY29u\ndGV4dCkgewogICAgICAgICAgICAgICAgaWYgKCF0LmVxdWFscyh0b3BpYykg\nfHwgIXMuZXF1YWxzKHN1YklkKSkgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGludCBu\ndW0gPSBJbnRlZ2VyLnBhcnNlSW50KG1zZy5nZXRCb2R5KCkudG9TdHJpbmdV\ndGY4KCkpOwogICAgICAgICAgICAgICAgaWYgKG51bSA9PSBuZXh0KSB7CiAg\nICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAgICAgICAg\nICAgICAgICAgICAgKytuZXh0OwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4dCwg\nbnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGF3YWl0KGxvbmcgdGltZW91dCwgVGltZVVuaXQgdW5pdCkKICAgICAg\nICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBsYXRjaC5hd2FpdCh0aW1lb3V0LCB1bml0KTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQ2xpZW50NDEwKGZpbmFs\nIFN0cmluZyBjb25uZWN0U3RyaW5nKSB7CiAgICAgICAgICAgIGNvbmYgPSBu\nZXcgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLmNsaWVudC5jb25mLkNs\naWVudENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGlzQXV0b1NlbmRD\nb25zdW1lTWVzc2FnZUVuYWJsZWQoKSB7CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0Q29u\nc3VtZWRNZXNzYWdlc0J1ZmZlclNpemUoKSB7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHByb3RlY3RlZCBvcmcuYXBh\nY2hlLmh3X3Y0XzFfMC5oZWR3aWcudXRpbC5IZWR3aWdTb2NrZXRBZGRyZXNz\nCiAgICAgICAgICAgICAgICAgICAgZ2V0RGVmYXVsdFNlcnZlckhlZHdpZ1Nv\nY2tldEFkZHJlc3MoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5l\ndyBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcudXRpbC5IZWR3aWdTb2Nr\nZXRBZGRyZXNzKGNvbm5lY3RTdHJpbmcpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9OwogICAgICAgICAgICBjbGllbnQgPSBuZXcgb3JnLmFw\nYWNoZS5od192NF8xXzAuaGVkd2lnLmNsaWVudC5IZWR3aWdDbGllbnQoY29u\nZik7CiAgICAgICAgICAgIHB1Ymxpc2hlciA9IGNsaWVudC5nZXRQdWJsaXNo\nZXIoKTsKICAgICAgICAgICAgc3Vic2NyaWJlciA9IGNsaWVudC5nZXRTdWJz\nY3JpYmVyKCk7CiAgICAgICAgfQoKICAgICAgICB2b2lkIGNsb3NlKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChudWxsICE9IGNsaWVu\ndCkgewogICAgICAgICAgICAgICAgY2xpZW50LmNsb3NlKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8w\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQg\ncHVibGlzaCgKICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0\ncmluZyBkYXRhKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2UgbWVzc2FnZSA9CiAgICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZS5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgICAgICAgICAuc2V0\nQm9keShkYXRhKS5idWlsZCgpOwogICAgICAgICAgICBwdWJsaXNoZXIucHVi\nbGlzaCh0b3BpYywgbWVzc2FnZSk7CiAgICAgICAgICAgIHJldHVybiBudWxs\nOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBwdWJsaXNoSW50cyhCeXRlU3Ry\naW5nIHRvcGljLCBpbnQgc3RhcnQsIGludCBudW0pIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICBmb3IgKGludCBpPTA7IGk8bnVtOyBpKyspIHsK\nICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIG1zZyA9CiAgICAgICAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJv\nZHkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIiIgKyAoc3RhcnQraSkpKS5i\ndWlsZCgpOwogICAgICAgICAgICAgICAgcHVibGlzaGVyLnB1Ymxpc2godG9w\naWMsIG1zZyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZv\naWQgc2VuZFhFeHBlY3RMYXN0WShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3Ry\naW5nIHN1YmlkLCBmaW5hbCBpbnQgeCwgZmluYWwgaW50IHkpCiAgICAgICAg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGZvciAoaW50IGk9MDsg\naTx4OyBpKyspIHsKICAgICAgICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNo\nKHRvcGljLCBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keSgK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCeXRl\nU3RyaW5nLmNvcHlGcm9tVXRmOChTdHJpbmcudmFsdWVPZihpKSkpLmJ1aWxk\nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnNjcmliZXIuc3Vi\nc2NyaWJlKHRvcGljLCBzdWJpZCwgb3JnLmFwYWNoZS5od192NF8xXzAuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Qu\nQ3JlYXRlT3JBdHRhY2guQVRUQUNIKTsKCiAgICAgICAgICAgIGZpbmFsIEF0\nb21pY0ludGVnZXIgZXhwZWN0ZWQgPSBuZXcgQXRvbWljSW50ZWdlcih4IC0g\neSk7CiAgICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNoID0g\nbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgICAgICBzdWJzY3JpYmVy\nLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YmlkLCBuZXcgb3JnLmFwYWNoZS5o\nd192NF8xXzAuaGVkd2lnLmNsaWVudC5hcGkuTWVzc2FnZUhhbmRsZXIoKSB7\nCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHN5\nbmNocm9uaXplZCBwdWJsaWMgdm9pZCBkZWxpdmVyKEJ5dGVTdHJpbmcgdG9w\naWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5o\nd192NF8xXzAuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2UgbXNnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnV0aWwu\nQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjb250ZXh0KSB7CiAg\nICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAg\nICAgaW50IHZhbHVlID0gSW50ZWdlci52YWx1ZU9mKG1zZy5nZXRCb2R5KCku\ndG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\ndmFsdWUgPT0gZXhwZWN0ZWQuZ2V0KCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGV4cGVjdGVkLmluY3JlbWVudEFuZEdldCgpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9nZ2VyLmVycm9yKCJEaWQgbm90IHJlY2VpdmUgZXhwZWN0\nZWQgdmFsdWUsIGV4cGVjdGVkIHt9LCBnb3Qge30iLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLmdldCgpLCB2\nYWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZC5z\nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3Vu\ndERvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWQuZ2V0KCkgPT0geCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4dCwgbnVsbCk7\nCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJSZWNlaXZl\nZCBiYWQgbWVzc2FnZSIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBs\nYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJUaW1lZCBvdXQgd2FpdGluZyBmb3IgbWVzc2FnZXMgWSBpcyAi\nICsgeSArICIgZXhwZWN0ZWQgaXMgY3VycmVudGx5ICIKICAgICAgICAgICAg\nICAgICAgICAgICArIGV4cGVjdGVkLmdldCgpLCBsYXRjaC5hd2FpdCgxMCwg\nVGltZVVuaXQuU0VDT05EUykpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMo\nIlNob3VsZCBiZSBleHBlY3RlZCBtZXNzYWdlIHdpdGggIiArIHgsIHgsIGV4\ncGVjdGVkLmdldCgpKTsKICAgICAgICAgICAgc3Vic2NyaWJlci5zdG9wRGVs\naXZlcnkodG9waWMsIHN1YmlkKTsKICAgICAgICAgICAgc3Vic2NyaWJlci5j\nbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQpOwogICAgICAgICAgICBU\naHJlYWQuc2xlZXAoMTAwMCk7IC8vIGdpdmUgc2VydmVyIHRpbWUgdG8gcnVu\nIGRpc2Nvbm5lY3QgbG9naWMgKEJPT0tLRUVQRVItNTEzKQogICAgICAgIH0K\nCiAgICAgICAgdm9pZCBzdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywgQnl0\nZVN0cmluZyBzdWJzY3JpYmVySWQpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zID0K\nICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zLm5l\nd0J1aWxkZXIoKQogICAgICAgICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNo\nKG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkNSRUFU\nRV9PUl9BVFRBQ0gpLmJ1aWxkKCk7CiAgICAgICAgICAgIHN1YnNjcmliZSh0\nb3BpYywgc3Vic2NyaWJlcklkLCBvcHRpb25zKTsKICAgICAgICB9CgogICAg\nICAgIHZvaWQgc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJp\nbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnMpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICBzdWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywg\nc3Vic2NyaWJlcklkLCBvcHRpb25zKTsKICAgICAgICB9CgogICAgICAgIHZv\naWQgY2xvc2VTdWJzY3JpcHRpb24oQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0\ncmluZyBzdWJzY3JpYmVySWQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBzdWJzY3JpYmVyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJz\nY3JpYmVySWQpOwogICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7IC8v\nIGdpdmUgc2VydmVyIHRpbWUgdG8gcnVuIGRpc2Nvbm5lY3QgbG9naWMgKEJP\nT0tLRUVQRVItNTEzKQogICAgICAgIH0KCiAgICAgICAgdm9pZCByZWNlaXZl\nSW50cyhCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJ\nZCwgaW50IHN0YXJ0LCBpbnQgbnVtKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgSW50TWVzc2FnZUhhbmRsZXIgbXNnSGFuZGxlciA9IG5ldyBJ\nbnRNZXNzYWdlSGFuZGxlcih0b3BpYywgc3Vic2NyaWJlcklkLCBzdGFydCwg\nbnVtKTsKICAgICAgICAgICAgc3Vic2NyaWJlci5zdGFydERlbGl2ZXJ5KHRv\ncGljLCBzdWJzY3JpYmVySWQsIG1zZ0hhbmRsZXIpOwogICAgICAgICAgICBt\nc2dIYW5kbGVyLmF3YWl0KG51bSwgVGltZVVuaXQuU0VDT05EUyk7CiAgICAg\nICAgICAgIHN1YnNjcmliZXIuc3RvcERlbGl2ZXJ5KHRvcGljLCBzdWJzY3Jp\nYmVySWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIDQuMi4w\nIFZlcnNpb24KICAgICAqLwogICAgc3RhdGljIGNsYXNzIEJvb2tLZWVwZXJD\nbHVzdGVyNDIwewoKICAgICAgICBpbnQgbnVtQm9va2llczsKICAgICAgICBM\naXN0PG9yZy5hcGFjaGUuaHdfdjRfMl8wLmJvb2trZWVwZXIuY29uZi5TZXJ2\nZXJDb25maWd1cmF0aW9uPiBia0NvbmZzOwogICAgICAgIExpc3Q8b3JnLmFw\nYWNoZS5od192NF8yXzAuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXI+\nIGJrczsKCgogICAgICAgIEJvb2tLZWVwZXJDbHVzdGVyNDIwKGludCBudW1C\nb29raWVzKSB7CiAgICAgICAgICAgIHRoaXMubnVtQm9va2llcyA9IG51bUJv\nb2tpZXM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdGFydCgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICB6a1V0aWwuc3RhcnRT\nZXJ2ZXIoKTsKCiAgICAgICAgICAgIGJrcyA9IG5ldyBMaW5rZWRMaXN0PG9y\nZy5hcGFjaGUuaHdfdjRfMl8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2Vy\ndmVyPigpOwogICAgICAgICAgICBia0NvbmZzID0gbmV3IExpbmtlZExpc3Q8\nb3JnLmFwYWNoZS5od192NF8yXzAuYm9va2tlZXBlci5jb25mLlNlcnZlckNv\nbmZpZ3VyYXRpb24+KCk7CgogICAgICAgICAgICBmb3IgKGludCBpPTA7IGk8\nbnVtQm9va2llczsgaSsrKSB7CiAgICAgICAgICAgICAgICBzdGFydEJvb2tp\nZVNlcnZlcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBzdG9wKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIGZvciAob3JnLmFwYWNoZS5od192NF8yXzAuYm9va2tlZXBlci5wcm90\nby5Cb29raWVTZXJ2ZXIgYnMgOiBia3MpIHsKICAgICAgICAgICAgICAgIGJz\nLnNodXRkb3duKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmtzLmNs\nZWFyKCk7CgogICAgICAgICAgICB6a1V0aWwua2lsbFNlcnZlcigpOwogICAg\nICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIHZvaWQgc3RhcnRCb29raWVTZXJ2\nZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaW50IHBvcnQg\nPSBQb3J0TWFuYWdlci5uZXh0RnJlZVBvcnQoKTsKICAgICAgICAgICAgRmls\nZSB0bXBEaXIgPSBvcmcuYXBhY2hlLmh3X3Y0XzJfMC5oZWR3aWcudXRpbC5G\naWxlVXRpbHMuY3JlYXRlVGVtcERpcmVjdG9yeSgKICAgICAgICAgICAgICAg\nIGdldENsYXNzKCkuZ2V0TmFtZSgpICsgcG9ydCwgInRlc3QiKTsKICAgICAg\nICAgICAgb3JnLmFwYWNoZS5od192NF8yXzAuYm9va2tlZXBlci5jb25mLlNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ld1NlcnZlckNvbmZpZ3VyYXRp\nb24oCiAgICAgICAgICAgICAgICBwb3J0LCB6a1V0aWwuZ2V0Wm9vS2VlcGVy\nQ29ubmVjdFN0cmluZygpLCB0bXBEaXIsIG5ldyBGaWxlW10geyB0bXBEaXIg\nfSk7CiAgICAgICAgICAgIGJrcy5hZGQoc3RhcnRCb29raWUoY29uZikpOwog\nICAgICAgICAgICBia0NvbmZzLmFkZChjb25mKTsKICAgICAgICB9CgogICAg\nICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmh3X3Y0XzJfMC5ib29ra2VlcGVy\nLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbiBuZXdTZXJ2ZXJDb25maWd1cmF0\naW9uKAogICAgICAgICAgICBpbnQgcG9ydCwgU3RyaW5nIHprU2VydmVycywg\nRmlsZSBqb3VybmFsRGlyLCBGaWxlW10gbGVkZ2VyRGlycykgewogICAgICAg\nICAgICBvcmcuYXBhY2hlLmh3X3Y0XzJfMC5ib29ra2VlcGVyLmNvbmYuU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mID0KICAgICAgICAgICAgICAgIG5ldyBv\ncmcuYXBhY2hlLmh3X3Y0XzJfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29u\nZmlndXJhdGlvbigpOwogICAgICAgICAgICBjb25mLnNldEJvb2tpZVBvcnQo\ncG9ydCk7CiAgICAgICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKHprU2VydmVy\ncyk7CiAgICAgICAgICAgIGNvbmYuc2V0Sm91cm5hbERpck5hbWUoam91cm5h\nbERpci5nZXRQYXRoKCkpOwogICAgICAgICAgICBTdHJpbmdbXSBsZWRnZXJE\naXJOYW1lcyA9IG5ldyBTdHJpbmdbbGVkZ2VyRGlycy5sZW5ndGhdOwogICAg\nICAgICAgICBmb3IgKGludCBpPTA7IGk8bGVkZ2VyRGlycy5sZW5ndGg7IGkr\nKykgewogICAgICAgICAgICAgICAgbGVkZ2VyRGlyTmFtZXNbaV0gPSBsZWRn\nZXJEaXJzW2ldLmdldFBhdGgoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBjb25mLnNldExlZGdlckRpck5hbWVzKGxlZGdlckRpck5hbWVzKTsKICAg\nICAgICAgICAgcmV0dXJuIGNvbmY7CiAgICAgICAgfQoKICAgICAgICBwcm90\nZWN0ZWQgb3JnLmFwYWNoZS5od192NF8yXzAuYm9va2tlZXBlci5wcm90by5C\nb29raWVTZXJ2ZXIgc3RhcnRCb29raWUoCiAgICAgICAgICAgIG9yZy5hcGFj\naGUuaHdfdjRfMl8wLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBvcmcu\nYXBhY2hlLmh3X3Y0XzJfMC5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZl\nciBzZXJ2ZXIKICAgICAgICAgICAgICAgID0gbmV3IG9yZy5hcGFjaGUuaHdf\ndjRfMl8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyKGNvbmYpOwog\nICAgICAgICAgICBzZXJ2ZXIuc3RhcnQoKTsKCiAgICAgICAgICAgIGludCBw\nb3J0ID0gY29uZi5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgICAgIHdoaWxl\nICh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ2xpZW50KCkuZXhpc3RzKAogICAgICAg\nICAgICAgICAgICAgICIvbGVkZ2Vycy9hdmFpbGFibGUvIiArIEluZXRBZGRy\nZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCkgKyAiOiIgKyBw\nb3J0LAogICAgICAgICAgICAgICAgICAgIGZhbHNlKSA9PSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoNTAwKTsKICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gc2VydmVyOwogICAgICAgIH0KICAgIH0K\nCiAgICBzdGF0aWMgY2xhc3MgU2VydmVyNDIwIHsKICAgICAgICBvcmcuYXBh\nY2hlLmh3X3Y0XzJfMC5oZWR3aWcuc2VydmVyLmNvbW1vbi5TZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmY7CiAgICAgICAgb3JnLmFwYWNoZS5od192NF8yXzAu\naGVkd2lnLnNlcnZlci5uZXR0eS5QdWJTdWJTZXJ2ZXIgc2VydmVyOwoKICAg\nICAgICBTZXJ2ZXI0MjAoZmluYWwgU3RyaW5nIHprSG9zdHMsIGZpbmFsIGlu\ndCBwb3J0LCBmaW5hbCBpbnQgc3NsUG9ydCkgewogICAgICAgICAgICBjb25m\nID0gbmV3IG9yZy5hcGFjaGUuaHdfdjRfMl8wLmhlZHdpZy5zZXJ2ZXIuY29t\nbW9uLlNlcnZlckNvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0Q29uc3Vt\nZUludGVydmFsKCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBDT05T\nVU1FSU5URVJWQUw7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgU3RyaW5nIGdl\ndFprSG9zdCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gemtIb3N0\nczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0U2VydmVyUG9ydCgp\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9ydDsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgIHB1YmxpYyBpbnQgZ2V0U1NMU2VydmVyUG9ydCgpIHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gc3NsUG9ydDsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZvaWQgc3Rh\ncnQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgc2VydmVyID0g\nbmV3IG9yZy5hcGFjaGUuaHdfdjRfMl8wLmhlZHdpZy5zZXJ2ZXIubmV0dHku\nUHViU3ViU2VydmVyKGNvbmYpOwogICAgICAgICAgICBzZXJ2ZXIuc3RhcnQo\nKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgc3RvcCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgICAgICBpZiAobnVsbCAhPSBzZXJ2ZXIpIHsKICAg\nICAgICAgICAgICAgIHNlcnZlci5zaHV0ZG93bigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ3VycmVudCBWZXJz\naW9uCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBCb29rS2VlcGVyQ2x1c3Rl\nckN1cnJlbnQgewoKICAgICAgICBpbnQgbnVtQm9va2llczsKICAgICAgICBM\naXN0PG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3Vy\nYXRpb24+IGJrQ29uZnM7CiAgICAgICAgTGlzdDxvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucHJvdG8uQm9va2llU2VydmVyPiBia3M7CgoKICAgICAgICBCb29r\nS2VlcGVyQ2x1c3RlckN1cnJlbnQoaW50IG51bUJvb2tpZXMpIHsKICAgICAg\nICAgICAgdGhpcy5udW1Cb29raWVzID0gbnVtQm9va2llczsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHprVXRpbC5zdGFydFNlcnZlcigpOwoKICAgICAg\nICAgICAgYmtzID0gbmV3IExpbmtlZExpc3Q8b3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkJvb2tpZVNlcnZlcj4oKTsKICAgICAgICAgICAgYmtDb25m\ncyA9IG5ldyBMaW5rZWRMaXN0PG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb24+KCk7CgogICAgICAgICAgICBmb3IgKGlu\ndCBpPTA7IGk8bnVtQm9va2llczsgaSsrKSB7CiAgICAgICAgICAgICAgICBz\ndGFydEJvb2tpZVNlcnZlcigpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgdm9pZCBzdG9wKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIGZvciAob3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkJvb2tpZVNlcnZlciBicyA6IGJrcykgewogICAgICAgICAgICAgICAgYnMu\nc2h1dGRvd24oKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBia3MuY2xl\nYXIoKTsKCiAgICAgICAgICAgIHprVXRpbC5raWxsU2VydmVyKCk7CiAgICAg\nICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBzdGFydEJvb2tpZVNlcnZl\ncigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpbnQgcG9ydCA9\nIFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAgICAgICBGaWxl\nIHRtcERpciA9IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuRmlsZVV0aWxzLmNy\nZWF0ZVRlbXBEaXJlY3RvcnkoCiAgICAgICAgICAgICAgICBnZXRDbGFzcygp\nLmdldE5hbWUoKSArIHBvcnQsICJ0ZXN0Iik7CiAgICAgICAgICAgIG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZiA9IG5ld1NlcnZlckNvbmZpZ3VyYXRpb24oCiAgICAgICAgICAgICAgICBw\nb3J0LCB6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLCB0bXBE\naXIsIG5ldyBGaWxlW10geyB0bXBEaXIgfSk7CiAgICAgICAgICAgIGNvbmYu\nc2V0QWxsb3dMb29wYmFjayh0cnVlKTsKICAgICAgICAgICAgYmtzLmFkZChz\ndGFydEJvb2tpZShjb25mKSk7CiAgICAgICAgICAgIGJrQ29uZnMuYWRkKGNv\nbmYpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24gbmV3U2VydmVy\nQ29uZmlndXJhdGlvbigKICAgICAgICAgICAgaW50IHBvcnQsIFN0cmluZyB6\na1NlcnZlcnMsIEZpbGUgam91cm5hbERpciwgRmlsZVtdIGxlZGdlckRpcnMp\nIHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mID0KICAgICAgICAgICAgICAgIG5ldyBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9u\nKCk7CiAgICAgICAgICAgIGNvbmYuc2V0QWxsb3dMb29wYmFjayh0cnVlKTsK\nICAgICAgICAgICAgY29uZi5zZXRCb29raWVQb3J0KHBvcnQpOwogICAgICAg\nICAgICBjb25mLnNldFprU2VydmVycyh6a1NlcnZlcnMpOwogICAgICAgICAg\nICBjb25mLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgp\nKTsKICAgICAgICAgICAgU3RyaW5nW10gbGVkZ2VyRGlyTmFtZXMgPSBuZXcg\nU3RyaW5nW2xlZGdlckRpcnMubGVuZ3RoXTsKICAgICAgICAgICAgZm9yIChp\nbnQgaT0wOyBpPGxlZGdlckRpcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGxlZGdlckRpck5hbWVzW2ldID0gbGVkZ2VyRGlyc1tpXS5nZXRQ\nYXRoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uZi5zZXRMZWRn\nZXJEaXJOYW1lcyhsZWRnZXJEaXJOYW1lcyk7CiAgICAgICAgICAgIHJldHVy\nbiBjb25mOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2ZXIgc3RhcnRCb29raWUo\nCiAgICAgICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZikgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2\nZXIgc2VydmVyCiAgICAgICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyKGNvbmYpOwogICAgICAgICAg\nICBzZXJ2ZXIuc3RhcnQoKTsKCiAgICAgICAgICAgIGludCBwb3J0ID0gY29u\nZi5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgICAgIHdoaWxlICh6a1V0aWwu\nZ2V0Wm9vS2VlcGVyQ2xpZW50KCkuZXhpc3RzKAogICAgICAgICAgICAgICAg\nICAgICIvbGVkZ2Vycy9hdmFpbGFibGUvIiArIEluZXRBZGRyZXNzLmdldExv\nY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCkgKyAiOiIgKyBwb3J0LAogICAg\nICAgICAgICAgICAgICAgIGZhbHNlKSA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICBUaHJlYWQuc2xlZXAoNTAwKTsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gc2VydmVyOwogICAgICAgIH0KICAgIH0KCiAgICBzdGF0\naWMgY2xhc3MgU2VydmVyQ3VycmVudCB7CiAgICAgICAgb3JnLmFwYWNoZS5o\nZWR3aWcuc2VydmVyLmNvbW1vbi5TZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7\nCiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLm5ldHR5LlB1YlN1\nYlNlcnZlciBzZXJ2ZXI7CgogICAgICAgIFNlcnZlckN1cnJlbnQoZmluYWwg\nU3RyaW5nIHprSG9zdHMsIGZpbmFsIGludCBwb3J0LCBmaW5hbCBpbnQgc3Ns\nUG9ydCkgewogICAgICAgICAgICBjb25mID0gbmV3IG9yZy5hcGFjaGUuaGVk\nd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlvbigpIHsKICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGlj\nIGludCBnZXRDb25zdW1lSW50ZXJ2YWwoKSB7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIENPTlNVTUVJTlRFUlZBTDsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1\nYmxpYyBTdHJpbmcgZ2V0WmtIb3N0KCkgewogICAgICAgICAgICAgICAgICAg\nIHJldHVybiB6a0hvc3RzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIGludCBn\nZXRTZXJ2ZXJQb3J0KCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBw\nb3J0OwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIGludCBnZXRTU0xTZXJ2ZXJQ\nb3J0KCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBzc2xQb3J0Owog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBzdGFydCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBzZXJ2ZXIgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLm5l\ndHR5LlB1YlN1YlNlcnZlcihjb25mKTsKICAgICAgICAgICAgc2VydmVyLnN0\nYXJ0KCk7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHN0b3AoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKG51bGwgIT0gc2VydmVyKSB7\nCiAgICAgICAgICAgICAgICBzZXJ2ZXIuc2h1dGRvd24oKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBzdGF0aWMgY2xhc3MgQ2xpZW50\nQ3VycmVudCB7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmNv\nbmYuQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mOwogICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLmNsaWVudC5hcGkuQ2xpZW50IGNsaWVudDsKICAgICAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYXBpLlB1Ymxpc2hlciBwdWJsaXNo\nZXI7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJz\nY3JpYmVyIHN1YnNjcmliZXI7CgogICAgICAgIGNsYXNzIEludE1lc3NhZ2VI\nYW5kbGVyIGltcGxlbWVudHMgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFw\naS5NZXNzYWdlSGFuZGxlciB7CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgdG9w\naWM7CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgc3ViSWQ7CiAgICAgICAgICAg\nIGludCBuZXh0OwoKICAgICAgICAgICAgQ291bnREb3duTGF0Y2ggbGF0Y2g7\nCgogICAgICAgICAgICBJbnRNZXNzYWdlSGFuZGxlcihCeXRlU3RyaW5nIHQs\nIEJ5dGVTdHJpbmcgcywgaW50IHN0YXJ0LCBpbnQgbnVtKSB7CiAgICAgICAg\nICAgICAgICB0aGlzLnRvcGljID0gdDsKICAgICAgICAgICAgICAgIHRoaXMu\nc3ViSWQgPSBzOwogICAgICAgICAgICAgICAgdGhpcy5uZXh0ID0gc3RhcnQ7\nCiAgICAgICAgICAgICAgICB0aGlzLmxhdGNoID0gbmV3IENvdW50RG93bkxh\ndGNoKG51bSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBkZWxpdmVyKEJ5dGVTdHJpbmcg\ndCwgQnl0ZVN0cmluZyBzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgbXNnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s8Vm9pZD4gY2FsbGJh\nY2ssIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAgICAgICAgICBpZiAoIXQu\nZXF1YWxzKHRvcGljKSB8fCAhcy5lcXVhbHMoc3ViSWQpKSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgaW50IG51bSA9IEludGVnZXIucGFyc2VJbnQobXNnLmdldEJv\nZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgICAgICBpZiAobnVt\nID09IG5leHQpIHsKICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICArK25leHQ7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5p\nc2hlZChjb250ZXh0LCBudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgcHVibGljIGJvb2xlYW4gYXdhaXQobG9uZyB0aW1lb3V0LCBUaW1lVW5p\ndCB1bml0KQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRp\nb24gewogICAgICAgICAgICAgICAgcmV0dXJuIGxhdGNoLmF3YWl0KHRpbWVv\ndXQsIHVuaXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBD\nbGllbnRDdXJyZW50KGZpbmFsIFN0cmluZyBjb25uZWN0U3RyaW5nKSB7CiAg\nICAgICAgICAgIHRoaXModHJ1ZSwgY29ubmVjdFN0cmluZyk7CiAgICAgICAg\nfQoKICAgICAgICBDbGllbnRDdXJyZW50KGZpbmFsIGJvb2xlYW4gYXV0b0Nv\nbnN1bWVFbmFibGVkLCBmaW5hbCBTdHJpbmcgY29ubmVjdFN0cmluZykgewog\nICAgICAgICAgICBjb25mID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVu\ndC5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24oKSB7CiAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGlz\nQXV0b1NlbmRDb25zdW1lTWVzc2FnZUVuYWJsZWQoKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIGF1dG9Db25zdW1lRW5hYmxlZDsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgcHVibGljIGludCBnZXRDb25zdW1lZE1lc3NhZ2VzQnVmZmVyU2l6\nZSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgcHJvdGVjdGVkIEhlZHdpZ1NvY2tldEFkZHJlc3MgZ2V0RGVmYXVs\ndFNlcnZlckhlZHdpZ1NvY2tldEFkZHJlc3MoKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIG5ldyBIZWR3aWdTb2NrZXRBZGRyZXNzKGNvbm5lY3RT\ndHJpbmcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAg\nICAgICAgICBjbGllbnQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50\nLkhlZHdpZ0NsaWVudChjb25mKTsKICAgICAgICAgICAgcHVibGlzaGVyID0g\nY2xpZW50LmdldFB1Ymxpc2hlcigpOwogICAgICAgICAgICBzdWJzY3JpYmVy\nID0gY2xpZW50LmdldFN1YnNjcmliZXIoKTsKICAgICAgICB9CgogICAgICAg\nIHZvaWQgY2xvc2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\naWYgKG51bGwgIT0gY2xpZW50KSB7CiAgICAgICAgICAgICAgICBjbGllbnQu\nY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkIHB1Ymxpc2goCiAgICAgICAgICAgIEJ5dGVTdHJpbmcgdG9waWMs\nIEJ5dGVTdHJpbmcgZGF0YSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgbWVzc2FnZSA9CiAgICAgICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLm5ld0J1\naWxkZXIoKQogICAgICAgICAgICAgICAgICAgIC5zZXRCb2R5KGRhdGEpLmJ1\naWxkKCk7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25zZSByZXNwID0KICAgICAg\nICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRvcGljLCBtZXNzYWdlKTsK\nICAgICAgICAgICAgaWYgKG51bGwgPT0gcmVzcCkgewogICAgICAgICAgICAg\nICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0\ndXJuIHJlc3AuZ2V0UHVibGlzaGVkTXNnSWQoKTsKICAgICAgICB9CgogICAg\nICAgIHZvaWQgcHVibGlzaEludHMoQnl0ZVN0cmluZyB0b3BpYywgaW50IHN0\nYXJ0LCBpbnQgbnVtKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nZm9yIChpbnQgaT0wOyBpPG51bTsgaSsrKSB7CiAgICAgICAgICAgICAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNz\nYWdlIG1zZyA9CiAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVy\nKCkuc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiIiArIChzdGFy\ndCtpKSkpLmJ1aWxkKCk7CiAgICAgICAgICAgICAgICBwdWJsaXNoZXIucHVi\nbGlzaCh0b3BpYywgbXNnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBzZW5kWEV4cGVjdExhc3RZKEJ5dGVTdHJpbmcgdG9waWMs\nIEJ5dGVTdHJpbmcgc3ViaWQsIGZpbmFsIGludCB4LCBmaW5hbCBpbnQgeSkK\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgZm9yIChp\nbnQgaT0wOyBpPHg7IGkrKykgewogICAgICAgICAgICAgICAgcHVibGlzaGVy\nLnB1Ymxpc2godG9waWMsIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0ZjgoU3RyaW5nLnZhbHVlT2YoaSkpKS5idWlsZCgp\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25z\nIG9wdHMKICAgICAgICAgICAgICAgID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdC\ndWlsZGVyKCkKICAgICAgICAgICAgICAgIC5zZXRDcmVhdGVPckF0dGFjaChv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkFUVEFDSCkKICAgICAgICAg\nICAgICAgIC5idWlsZCgpOwogICAgICAgICAgICBzdWJzY3JpYmVyLnN1YnNj\ncmliZSh0b3BpYywgc3ViaWQsIG9wdHMpOwoKICAgICAgICAgICAgZmluYWwg\nQXRvbWljSW50ZWdlciBleHBlY3RlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKHgg\nLSB5KTsKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggbGF0Y2gg\nPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgICAgIHN1YnNjcmli\nZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3ViaWQsIG5ldyBvcmcuYXBhY2hl\nLmhlZHdpZy5jbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyKCkgewogICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBzeW5jaHJvbml6\nZWQgcHVibGljIHZvaWQgZGVsaXZlcihCeXRlU3RyaW5nIHRvcGljLCBCeXRl\nU3RyaW5nIHN1YnNjcmliZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgbXNnLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcudXRpbC5DYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpbnQgdmFsdWUgPSBJbnRlZ2VyLnZhbHVl\nT2YobXNnLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBleHBlY3RlZC5nZXQoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQuaW5jcmVtZW50\nQW5kR2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkRpZCBu\nb3QgcmVjZWl2ZSBleHBlY3RlZCB2YWx1ZSwgZXhwZWN0ZWQge30sIGdvdCB7\nfSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZXhwZWN0ZWQuZ2V0KCksIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGV4cGVjdGVkLnNldCgwKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHBlY3RlZC5n\nZXQoKSA9PSB4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRj\naC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hl\nZChjb250ZXh0LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZXJyb3IoIlJlY2VpdmVkIGJhZCBtZXNzYWdlIiwgZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7\nCiAgICAgICAgICAgIGFzc2VydFRydWUoIlRpbWVkIG91dCB3YWl0aW5nIGZv\nciBtZXNzYWdlcyBZIGlzICIgKyB5ICsgIiBleHBlY3RlZCBpcyBjdXJyZW50\nbHkgIgogICAgICAgICAgICAgICAgICAgICAgICsgZXhwZWN0ZWQuZ2V0KCks\nIGxhdGNoLmF3YWl0KDEwLCBUaW1lVW5pdC5TRUNPTkRTKSk7CiAgICAgICAg\nICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIGV4cGVjdGVkIG1lc3NhZ2Ug\nd2l0aCAiICsgeCwgeCwgZXhwZWN0ZWQuZ2V0KCkpOwogICAgICAgICAgICBz\ndWJzY3JpYmVyLnN0b3BEZWxpdmVyeSh0b3BpYywgc3ViaWQpOwogICAgICAg\nICAgICBzdWJzY3JpYmVyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJp\nZCk7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHJlY2VpdmVOdW1Nb2RNKGZp\nbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3ViaWQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBpbnQgc3RhcnQs\nIGZpbmFsIGludCBudW0sIGZpbmFsIGludCBNKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVyLlNlcnZl\nck1lc3NhZ2VGaWx0ZXIgZmlsdGVyID0KICAgICAgICAgICAgICAgIG5ldyBv\ncmcuYXBhY2hlLmhlZHdpZy5maWx0ZXIuU2VydmVyTWVzc2FnZUZpbHRlcigp\nIHsKCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAg\nIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5maWx0ZXIuU2VydmVyTWVzc2Fn\nZUZpbHRlcgogICAgICAgICAgICAgICAgICAgIGluaXRpYWxpemUoQ29uZmln\ndXJhdGlvbiBjb25mKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90\naGluZwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgdW5pbml0aWFsaXplKCkgewogICAgICAg\nICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmc7CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVyLk1lc3NhZ2VGaWx0ZXJC\nYXNlCiAgICAgICAgICAgICAgICAgICAgc2V0U3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXMoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVy\nSWQsCiAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVyZW5jZXMg\ncHJlZmVyZW5jZXMpIHsKICAgICAgICAgICAgICAgICAgICAvLyBkbyBub3Ro\naW5nOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIGJvb2xlYW4gdGVzdE1lc3NhZ2Uob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBtc2cp\nIHsKICAgICAgICAgICAgICAgICAgICBpbnQgdmFsdWUgPSBJbnRlZ2VyLnZh\nbHVlT2YobXNnLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIDAgPT0gdmFsdWUgJSBNOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICBmaWx0ZXIuaW5p\ndGlhbGl6ZShjb25mLmdldENvbmYoKSk7CgoKICAgICAgICAgICAgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uT3B0aW9ucyBvcHRzCiAgICAgICAgICAgICAgICA9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9w\ndGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAgICAgICAgICAuc2V0Q3JlYXRl\nT3JBdHRhY2gob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaC5BVFRBQ0gp\nCiAgICAgICAgICAgICAgICAuYnVpbGQoKTsKICAgICAgICAgICAgc3Vic2Ny\naWJlci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRzKTsKICAgICAgICAg\nICAgZmluYWwgaW50IGJhc2UgPSBzdGFydCArIE0gLSBzdGFydCAlIE07CiAg\nICAgICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgZXhwZWN0ZWQgPSBuZXcg\nQXRvbWljSW50ZWdlcihiYXNlKTsKICAgICAgICAgICAgZmluYWwgQ291bnRE\nb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAg\nICAgICAgIHN1YnNjcmliZXIuc3RhcnREZWxpdmVyeVdpdGhGaWx0ZXIodG9w\naWMsIHN1YmlkLCBuZXcgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5N\nZXNzYWdlSGFuZGxlcigpIHsKICAgICAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCBwdWJsaWMgdm9pZCBkZWxpdmVyKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBtc2csCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmpl\nY3QgY29udGV4dCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGludCB2YWx1ZSA9IEludGVnZXIudmFsdWVP\nZihtc2cuZ2V0Qm9keSgpLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gZHVwbGljYXRlZCBtZXNzYWdlcyByZWNlaXZlZCwg\naWdub3JlIHRoZW0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVl\nID4gc3RhcnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2\nYWx1ZSA9PSBleHBlY3RlZC5nZXQoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGV4cGVjdGVkLmFkZEFuZEdldChNKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJEaWQgbm90IHJlY2VpdmUg\nZXhwZWN0ZWQgdmFsdWUsIGV4cGVjdGVkIHt9LCBnb3Qge30iLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3Rl\nZC5nZXQoKSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGV4cGVjdGVkLnNldCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChl\neHBlY3RlZC5nZXQoKSA9PSAoYmFzZSArIG51bSAqIE0pKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3Bl\ncmF0aW9uRmluaXNoZWQoY29udGV4dCwgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgbG9nZ2VyLmVycm9yKCJSZWNlaXZlZCBiYWQgbWVzc2FnZSIs\nIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERvd24o\nKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0sIChvcmcuYXBhY2hlLmhlZHdpZy5maWx0ZXIuQ2xpZW50\nTWVzc2FnZUZpbHRlcikgZmlsdGVyKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1\nZSgiVGltZWQgb3V0IHdhaXRpbmcgZm9yIG1lc3NhZ2VzIG1vZCAiICsgTSAr\nICIgZXhwZWN0ZWQgaXMgIiArIGV4cGVjdGVkLmdldCgpLAogICAgICAgICAg\nICAgICAgICAgICAgIGxhdGNoLmF3YWl0KDEwLCBUaW1lVW5pdC5TRUNPTkRT\nKSk7CiAgICAgICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxkIGJlIGV4cGVj\ndGVkIG1lc3NhZ2Ugd2l0aCAiICsgKGJhc2UgKyBudW0gKiBNKSwgKGJhc2Ug\nKyBudW0qTSksIGV4cGVjdGVkLmdldCgpKTsKICAgICAgICAgICAgc3Vic2Ny\naWJlci5zdG9wRGVsaXZlcnkodG9waWMsIHN1YmlkKTsKICAgICAgICAgICAg\nZmlsdGVyLnVuaW5pdGlhbGl6ZSgpOwogICAgICAgICAgICBzdWJzY3JpYmVy\nLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJpZCk7CiAgICAgICAgfQoK\nICAgICAgICB2b2lkIHN1YnNjcmliZShCeXRlU3RyaW5nIHRvcGljLCBCeXRl\nU3RyaW5nIHN1YnNjcmliZXJJZCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0aW9ucyA9CiAgICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1aWxkZXIoKQogICAgICAgICAg\nICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRl\nT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSCkuYnVpbGQoKTsKICAgICAgICAg\nICAgc3Vic2NyaWJlKHRvcGljLCBzdWJzY3JpYmVySWQsIG9wdGlvbnMpOwog\nICAgICAgIH0KCiAgICAgICAgdm9pZCBzdWJzY3JpYmUoQnl0ZVN0cmluZyB0\nb3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUodG9w\naWMsIHN1YnNjcmliZXJJZCwgb3B0aW9ucyk7CiAgICAgICAgfQoKICAgICAg\nICB2b2lkIGNsb3NlU3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcgdG9waWMsIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgc3Vic2NyaWJlci5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywg\nc3Vic2NyaWJlcklkKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgcmVjZWl2\nZUludHMoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVy\nSWQsIGludCBzdGFydCwgaW50IG51bSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIEludE1lc3NhZ2VIYW5kbGVyIG1zZ0hhbmRsZXIgPSBuZXcg\nSW50TWVzc2FnZUhhbmRsZXIodG9waWMsIHN1YnNjcmliZXJJZCwgc3RhcnQs\nIG51bSk7CiAgICAgICAgICAgIHN1YnNjcmliZXIuc3RhcnREZWxpdmVyeSh0\nb3BpYywgc3Vic2NyaWJlcklkLCBtc2dIYW5kbGVyKTsKICAgICAgICAgICAg\nbXNnSGFuZGxlci5hd2FpdChudW0sIFRpbWVVbml0LlNFQ09ORFMpOwogICAg\nICAgICAgICBzdWJzY3JpYmVyLnN0b3BEZWxpdmVyeSh0b3BpYywgc3Vic2Ny\naWJlcklkKTsKICAgICAgICB9CgogICAgICAgIC8vIHRocm90dGxlIGRvZXNu\nJ3Qgd29yayB0YWxraW5nIHdpdGggNDEgc2VydmVyCiAgICAgICAgdm9pZCB0\naHJvdHRsZVg0MShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1Ymlk\nLCBmaW5hbCBpbnQgWCkKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zID0KICAgICAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAg\nICAgICAgICAuc2V0Q3JlYXRlT3JBdHRhY2gob3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVh\ndGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIKQogICAgICAgICAgICAgICAg\nLnNldE1lc3NhZ2VXaW5kb3dTaXplKFgpIC5idWlsZCgpOwogICAgICAgICAg\nICBzdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRpb25zKTsKICAgICAgICAg\nICAgY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YmlkKTsKICAgICAgICAg\nICAgcHVibGlzaEludHModG9waWMsIDEsIDMqWCk7CiAgICAgICAgICAgIHN1\nYnNjcmliZSh0b3BpYywgc3ViaWQpOwoKICAgICAgICAgICAgZmluYWwgQXRv\nbWljSW50ZWdlciBleHBlY3RlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKDEpOwog\nICAgICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCB0aHJvdHRsZUxhdGNo\nID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgICAgICBmaW5hbCBD\nb3VudERvd25MYXRjaCBub25UaHJvdHRsZUxhdGNoID0gbmV3IENvdW50RG93\nbkxhdGNoKDEpOwogICAgICAgICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZl\ncnkodG9waWMsIHN1YmlkLCBuZXcgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50\nLmFwaS5NZXNzYWdlSGFuZGxlcigpIHsKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIHN5bmNocm9uaXplZCB2b2lk\nIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlIG1zZywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnV0\naWwuQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjb250ZXh0KSB7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaW50IHZhbHVlID0gSW50ZWdlci52YWx1ZU9mKG1zZy5nZXRCb2R5\nKCkudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICAgICAgICAgICAgICBs\nb2dnZXIuZGVidWcoIlJlY2VpdmVkIG1lc3NhZ2Uge30sIiwgdmFsdWUpOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlID09IGV4cGVjdGVk\nLmdldCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3Rl\nZC5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVycm9y\nIGNvbmRpdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2Vy\nLmVycm9yKCJEaWQgbm90IHJlY2VpdmUgZXhwZWN0ZWQgdmFsdWUsIGV4cGVj\ndGVkIHt9LCBnb3Qge30iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGV4cGVjdGVkLmdldCgpLCB2YWx1ZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBleHBlY3RlZC5zZXQoMCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB0aHJvdHRsZUxhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbm9uVGhyb3R0bGVMYXRj\naC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWQuZ2V0KCkgPiBYKzEp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm90dGxlTGF0Y2gu\nY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGV4cGVjdGVkLmdldCgpID09ICgzICog\nWCArIDEpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBub25UaHJv\ndHRsZUxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlv\nbkZpbmlzaGVkKGNvbnRleHQsIG51bGwpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZ2dlci5lcnJvcigiUmVjZWl2ZWQgYmFkIG1lc3NhZ2UiLCBlKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3R0bGVMYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9uVGhyb3R0bGVMYXRj\naC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJTaG91bGQgUmVjZWl2ZSBtb3JlIG1lc3NhZ2VzIHRoYW4gdGhyb3R0\nbGUgdmFsdWUgIiArIFgsCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm90\ndGxlTGF0Y2guYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMpKTsKCiAgICAg\nICAgICAgIGFzc2VydFRydWUoIlRpbWVkIG91dCB3YWl0aW5nIGZvciBtZXNz\nYWdlcyAiICsgKDMqWCArIDEpLAogICAgICAgICAgICAgICAgICAgICAgIG5v\nblRocm90dGxlTGF0Y2guYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMpKTsK\nICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgYmUgZXhwZWN0ZWQg\nbWVzc2FnZSB3aXRoICIgKyAoMypYICsgMSksCiAgICAgICAgICAgICAgICAg\nICAgICAgICAzKlggKyAxLCBleHBlY3RlZC5nZXQoKSk7CgogICAgICAgICAg\nICBzdWJzY3JpYmVyLnN0b3BEZWxpdmVyeSh0b3BpYywgc3ViaWQpOwogICAg\nICAgICAgICBjbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQpOwogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgY29tcGF0YWJpbGl0\neSBvZiBtZXNzYWdlIGJvdW5kIGJldHdlZW4gdmVyc2lvbiA0LjAuMCBhbmQK\nICAgICAqIGN1cnJlbnQgdmVyc2lvbi4KICAgICAqCiAgICAgKiAxKSBtZXNz\nYWdlIGJvdW5kIGRvZXNuJ3QgdGFrZSBlZmZlY3RzIG9uIDQuMC4wIHNlcnZl\nci4KICAgICAqIDIpIG1lc3NhZ2UgYm91bmQgdGFrZSBlZmZlY3RzIG9uIGJv\ndGggNC4xLjAgYW5kIGN1cnJlbnQgc2VydmVyCiAgICAgKi8KICAgIEBUZXN0\nKHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0TWVzc2FnZUJv\ndW5kQ29tcGF0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZVN0\ncmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJ0ZXN0TWVz\nc2FnZUJvdW5kQ29tcGF0Iik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJpZCA9\nIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJteXN1YiIpOwoKICAgICAgICBp\nbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAg\nIGludCBzc2xQb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7Cgog\nICAgICAgIC8vIHN0YXJ0IGJvb2trZWVwZXIgNDAwCiAgICAgICAgQm9va0tl\nZXBlckNsdXN0ZXI0MDAgYmtjNDAwID0gbmV3IEJvb2tLZWVwZXJDbHVzdGVy\nNDAwKDMpOwogICAgICAgIGJrYzQwMC5zdGFydCgpOwoKICAgICAgICAvLyBz\ndGFydCA0MDAgc2VydmVyCiAgICAgICAgU2VydmVyNDAwIHM0MDAgPSBuZXcg\nU2VydmVyNDAwKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCks\nIHBvcnQsIHNzbFBvcnQpOwogICAgICAgIHM0MDAuc3RhcnQoKTsKCiAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zNWN1ciA9CiAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAgICAgIC5z\nZXRDcmVhdGVPckF0dGFjaChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNo\nLkNSRUFURV9PUl9BVFRBQ0gpCiAgICAgICAgICAgIC5zZXRNZXNzYWdlQm91\nbmQoNSkuYnVpbGQoKTsKCiAgICAgICAgQ2xpZW50Q3VycmVudCBjY3VyID0g\nbmV3IENsaWVudEN1cnJlbnQoImxvY2FsaG9zdDoiICsgcG9ydCArICI6IiAr\nIHNzbFBvcnQpOwogICAgICAgIGNjdXIuc3Vic2NyaWJlKHRvcGljLCBzdWJp\nZCwgb3B0aW9uczVjdXIpOwogICAgICAgIGNjdXIuY2xvc2VTdWJzY3JpcHRp\nb24odG9waWMsIHN1YmlkKTsKICAgICAgICBjY3VyLnNlbmRYRXhwZWN0TGFz\ndFkodG9waWMsIHN1YmlkLCA1MCwgNTApOwoKICAgICAgICAvLyBzdG9wIDQw\nMCBzZXJ2ZXJzCiAgICAgICAgczQwMC5zdG9wKCk7CiAgICAgICAgYmtjNDAw\nLnN0b3AoKTsKCiAgICAgICAgLy8gc3RhcnQgYm9va2tlZXBlciA0MTAKICAg\nICAgICBCb29rS2VlcGVyQ2x1c3RlcjQxMCBia2M0MTAgPSBuZXcgQm9va0tl\nZXBlckNsdXN0ZXI0MTAoMyk7CiAgICAgICAgYmtjNDEwLnN0YXJ0KCk7Cgog\nICAgICAgIC8vIHN0YXJ0IDQxMCBzZXJ2ZXIKICAgICAgICBTZXJ2ZXI0MTAg\nczQxMCA9IG5ldyBTZXJ2ZXI0MTAoemtVdGlsLmdldFpvb0tlZXBlckNvbm5l\nY3RTdHJpbmcoKSwgcG9ydCwgc3NsUG9ydCk7CiAgICAgICAgczQxMC5zdGFy\ndCgpOwoKICAgICAgICBjY3VyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIG9w\ndGlvbnM1Y3VyKTsKICAgICAgICBjY3VyLmNsb3NlU3Vic2NyaXB0aW9uKHRv\ncGljLCBzdWJpZCk7CiAgICAgICAgY2N1ci5zZW5kWEV4cGVjdExhc3RZKHRv\ncGljLCBzdWJpZCwgNTAsIDUpOwoKICAgICAgICAvLyBzdG9wIDQxMCBzZXJ2\nZXJzCiAgICAgICAgczQxMC5zdG9wKCk7CiAgICAgICAgYmtjNDEwLnN0b3Ao\nKTsKCiAgICAgICAgLy8gc3RhcnQgYm9va2tlZXBlciBjdXJyZW50CiAgICAg\nICAgQm9va0tlZXBlckNsdXN0ZXI0MjAgYmtjNDIwID0gbmV3IEJvb2tLZWVw\nZXJDbHVzdGVyNDIwKDMpOwogICAgICAgIGJrYzQyMC5zdGFydCgpOwoKICAg\nICAgICAvLyBzdGFydCA0MjAgc2VydmVyCiAgICAgICAgU2VydmVyNDIwIHM0\nMjAgPSBuZXcgU2VydmVyNDIwKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0\nU3RyaW5nKCksIHBvcnQsIHNzbFBvcnQpOwogICAgICAgIHM0MjAuc3RhcnQo\nKTsKCiAgICAgICAgY2N1ci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRp\nb25zNWN1cik7CiAgICAgICAgY2N1ci5jbG9zZVN1YnNjcmlwdGlvbih0b3Bp\nYywgc3ViaWQpOwogICAgICAgIGNjdXIuc2VuZFhFeHBlY3RMYXN0WSh0b3Bp\nYywgc3ViaWQsIDUwLCA1KTsKCiAgICAgICAgLy8gc3RvcCA0MjAgc2VydmVy\nCiAgICAgICAgczQyMC5zdG9wKCk7CiAgICAgICAgYmtjNDIwLnN0b3AoKTsK\nCiAgICAgICAgY2N1ci5jbG9zZSgpOwogICAgfQoKICAgIC8qKgogICAgICog\nVGVzdCBjb21wYXRhYmlsaXR5IG9mIHB1Ymxpc2ggaW50ZXJmYWNlIGJldHdl\nZW4gdmVyc2lvbiA0LjEuMAogICAgICogYW5kIGN1cnJlbnQgdmVyaXNvbi4K\nICAgICAqCiAgICAgKiAxKSA0LjEuMCBjbGllbnQgY291bGQgdGFsayB3aXRo\nIGN1cnJlbnQgc2VydmVyLgogICAgICogMikgY3VycmVudCBjbGllbnQgY291\nbGQgdGFsayB3aXRoIDQuMS4wIHNlcnZlciwKICAgICAqICAgIGJ1dCBubyBt\nZXNzYWdlIHNlcSBpZCB3b3VsZCBiZSByZXR1cm5lZAogICAgICovCiAgICBA\nVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFB1Ymxp\nc2hDb21wYXQ0MTAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRl\nU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIlRlc3RQ\ndWJsaXNoQ29tcGF0NDEwIik7CiAgICAgICAgQnl0ZVN0cmluZyBkYXRhID0g\nQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoInRlc3RkYXRhIik7CgogICAgICAg\nIC8vIHN0YXJ0IGJvb2trZWVwZXIgNDEwCiAgICAgICAgQm9va0tlZXBlckNs\ndXN0ZXI0MTAgYmtjNDEwID0gbmV3IEJvb2tLZWVwZXJDbHVzdGVyNDEwKDMp\nOwogICAgICAgIGJrYzQxMC5zdGFydCgpOwoKICAgICAgICBpbnQgcG9ydCA9\nIFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAgIGludCBzc2xQ\nb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7CgogICAgICAgIC8v\nIHN0YXJ0IDQxMCBzZXJ2ZXIKICAgICAgICBTZXJ2ZXI0MTAgczQxMCA9IG5l\ndyBTZXJ2ZXI0MTAoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmco\nKSwgcG9ydCwgc3NsUG9ydCk7CiAgICAgICAgczQxMC5zdGFydCgpOwoKICAg\nICAgICBDbGllbnRDdXJyZW50IGNjdXIgPSBuZXcgQ2xpZW50Q3VycmVudCgi\nbG9jYWxob3N0OiIrcG9ydCsiOiIrc3NsUG9ydCk7CiAgICAgICAgQ2xpZW50\nNDEwIGM0MTAgPSBuZXcgQ2xpZW50NDEwKCJsb2NhbGhvc3Q6Iitwb3J0KyI6\nIitzc2xQb3J0KTsKCiAgICAgICAgLy8gY2xpZW50IGM0MTAgY291bGQgcHVi\nbGlzaCBtZXNzYWdlIHRvIDQxMCBzZXJ2ZXIKICAgICAgICBhc3NlcnROdWxs\nKGM0MTAucHVibGlzaCh0b3BpYywgZGF0YSkpOwogICAgICAgIC8vIGNsaWVu\ndCBjY3VyIGNvdWxkIHB1Ymxpc2ggbWVzc2FnZSB0byA0MTAgc2VydmVyCiAg\nICAgICAgLy8gYnV0IG5vIG1lc3NhZ2Ugc2VxIGlkIHdvdWxkIGJlIHJldHVy\nbmVkCiAgICAgICAgYXNzZXJ0TnVsbChjY3VyLnB1Ymxpc2godG9waWMsIGRh\ndGEpKTsKCiAgICAgICAgLy8gc3RvcCA0MTAgc2VydmVyCiAgICAgICAgczQx\nMC5zdG9wKCk7CgogICAgICAgIC8vIHN0YXJ0IDQyMCBzZXJ2ZXIKICAgICAg\nICBTZXJ2ZXI0MjAgczQyMCA9IG5ldyBTZXJ2ZXI0MjAoemtVdGlsLmdldFpv\nb0tlZXBlckNvbm5lY3RTdHJpbmcoKSwgcG9ydCwgc3NsUG9ydCk7CiAgICAg\nICAgczQyMC5zdGFydCgpOwoKICAgICAgICAvLyBjbGllbnQgYzQxMCBjb3Vs\nZCBwdWJsaXNoIG1lc3NhZ2UgdG8gNDEwIHNlcnZlcgogICAgICAgIC8vIGJ1\ndCBubyBtZXNzYWdlIHNlcSBpZCB3b3VsZCBiZSByZXR1cm5lZAogICAgICAg\nIGFzc2VydE51bGwoYzQxMC5wdWJsaXNoKHRvcGljLCBkYXRhKSk7CiAgICAg\nICAgLy8gY2xpZW50IGNjdXIgY291bGQgcHVibGlzaCBtZXNzYWdlIHRvIGN1\ncnJlbnQgc2VydmVyCiAgICAgICAgYXNzZXJ0Tm90TnVsbChjY3VyLnB1Ymxp\nc2godG9waWMsIGRhdGEpKTsKCiAgICAgICAgY2N1ci5jbG9zZSgpOwogICAg\nICAgIGM0MTAuY2xvc2UoKTsKCiAgICAgICAgLy8gc3RvcCA0MjAgc2VydmVy\nCiAgICAgICAgczQyMC5zdG9wKCk7CiAgICAgICAgYmtjNDEwLnN0b3AoKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgY29tcGF0YWJpbGl0eSBiZXR3\nZWVuIHZlcnNpb24gNC4xLjAgYW5kIHRoZSBjdXJyZW50IHZlcnNpb24uCiAg\nICAgKgogICAgICogQSBjdXJyZW50IHNlcnZlciBjb3VsZCByZWFkIHN1YnNj\ncmlwdGlvbiBkYXRhIHJlY29yZGVkIGJ5IDQuMS4wIHNlcnZlci4KICAgICAq\nLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRl\nc3RTdWJzY3JpcHRpb25EYXRhQ29tcGF0NDEwKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJUZXN0Q29tcGF0NDEwIik7CiAgICAgICAgQnl0ZVN0cmlu\nZyBzdWI0MTAgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgic3ViNDEwIik7\nCiAgICAgICAgQnl0ZVN0cmluZyBzdWJjdXIgPSBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOCgic3ViY3VyIik7CgogICAgICAgIC8vIHN0YXJ0IGJvb2trZWVw\nZXIgNDEwCiAgICAgICAgQm9va0tlZXBlckNsdXN0ZXI0MTAgYmtjNDEwID0g\nbmV3IEJvb2tLZWVwZXJDbHVzdGVyNDEwKDMpOwogICAgICAgIGJrYzQxMC5z\ndGFydCgpOwoKICAgICAgICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRG\ncmVlUG9ydCgpOwogICAgICAgIGludCBzc2xQb3J0ID0gUG9ydE1hbmFnZXIu\nbmV4dEZyZWVQb3J0KCk7CgogICAgICAgIC8vIHN0YXJ0IDQxMCBzZXJ2ZXIK\nICAgICAgICBTZXJ2ZXI0MTAgczQxMCA9IG5ldyBTZXJ2ZXI0MTAoemtVdGls\nLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSwgcG9ydCwgc3NsUG9ydCk7\nCiAgICAgICAgczQxMC5zdGFydCgpOwoKICAgICAgICBDbGllbnQ0MTAgYzQx\nMCA9IG5ldyBDbGllbnQ0MTAoImxvY2FsaG9zdDoiK3BvcnQrIjoiK3NzbFBv\ncnQpOwogICAgICAgIGM0MTAuc3Vic2NyaWJlKHRvcGljLCBzdWI0MTApOwog\nICAgICAgIGM0MTAuY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YjQxMCk7\nCiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOyAvLyBnaXZlIHNlcnZlciB0\naW1lIHRvIHJ1biBkaXNjb25uZWN0IGxvZ2ljIChCT09LS0VFUEVSLTUxMykK\nCiAgICAgICAgQ2xpZW50Q3VycmVudCBjY3VyID0gbmV3IENsaWVudEN1cnJl\nbnQoImxvY2FsaG9zdDoiK3BvcnQrIjoiK3NzbFBvcnQpOwogICAgICAgIGNj\ndXIuc3Vic2NyaWJlKHRvcGljLCBzdWJjdXIpOwogICAgICAgIGNjdXIuY2xv\nc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YmN1cik7CgogICAgICAgIC8vIHB1\nYmxpc2ggbWVzc2FnZXMgdXNpbmcgb2xkIGNsaWVudAogICAgICAgIGM0MTAu\ncHVibGlzaEludHModG9waWMsIDAsIDEwKTsKICAgICAgICAvLyBzdG9wIDQx\nMCBzZXJ2ZXIKICAgICAgICBzNDEwLnN0b3AoKTsKCiAgICAgICAgLy8gc3Rh\ncnQgNDIwIHNlcnZlcgogICAgICAgIFNlcnZlcjQyMCBzNDIwID0gbmV3IFNl\ncnZlcjQyMCh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHBvcnQsIHNzbFBvcnQpOwogICAgICAgIHM0MjAuc3RhcnQoKTsKCiAgICAg\nICAgYzQxMC5zdWJzY3JpYmUodG9waWMsIHN1YjQxMCk7CiAgICAgICAgYzQx\nMC5yZWNlaXZlSW50cyh0b3BpYywgc3ViNDEwLCAwLCAxMCk7CgogICAgICAg\nIGNjdXIuc3Vic2NyaWJlKHRvcGljLCBzdWJjdXIpOwogICAgICAgIGNjdXIu\ncmVjZWl2ZUludHModG9waWMsIHN1YmN1ciwgMCwgMTApOwoKICAgICAgICAv\nLyBwdWJsaXNoIG1lc3NhZ2VzIHVzaW5nIGN1cnJlbnQgY2xpZW50CiAgICAg\nICAgY2N1ci5wdWJsaXNoSW50cyh0b3BpYywgMTAsIDEwKTsKCiAgICAgICAg\nYzQxMC5yZWNlaXZlSW50cyh0b3BpYywgc3ViNDEwLCAxMCwgMTApOwogICAg\nICAgIGNjdXIucmVjZWl2ZUludHModG9waWMsIHN1YmN1ciwgMTAsIDEwKTsK\nCiAgICAgICAgLy8gc3RvcCA0MjAgc2VydmVyCiAgICAgICAgczQyMC5zdG9w\nKCk7CgogICAgICAgIGM0MTAuY2xvc2UoKTsKICAgICAgICBjY3VyLmNsb3Nl\nKCk7CgogICAgICAgIC8vIHN0b3AgYm9va2tlZXBlciBjbHVzdGVyCiAgICAg\nICAgYmtjNDEwLnN0b3AoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3Qg\nY29tcGF0YWJpbGl0eSBiZXR3ZWVuIHZlcnNpb24gNC4xLjAgYW5kIHRoZSBj\ndXJyZW50IHZlcnNpb24uCiAgICAgKgogICAgICogQSA0LjEuMCBjbGllbnQg\nY291bGQgbm90IHVwZGF0ZSBtZXNzYWdlIGJvdW5kLCB3aGlsZSBjdXJyZW50\nIGNvdWxkIGRvIGl0LgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdFVwZGF0ZU1lc3NhZ2VCb3VuZENvbXBh\ndDQxMCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcg\ndG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiVGVzdFVwZGF0ZU1l\nc3NhZ2VCb3VuZENvbXBhdDQxMCIpOwogICAgICAgIEJ5dGVTdHJpbmcgc3Vi\naWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgibXlzdWIiKTsKCiAgICAg\nICAgLy8gc3RhcnQgYm9va2tlZXBlcgogICAgICAgIEJvb2tLZWVwZXJDbHVz\ndGVyNDIwIGJrYzQyMCA9IG5ldyBCb29rS2VlcGVyQ2x1c3RlcjQyMCgzKTsK\nICAgICAgICBia2M0MjAuc3RhcnQoKTsKCiAgICAgICAgaW50IHBvcnQgPSBQ\nb3J0TWFuYWdlci5uZXh0RnJlZVBvcnQoKTsKICAgICAgICBpbnQgc3NsUG9y\ndCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwoKICAgICAgICAvLyBz\ndGFydCBodWIgc2VydmVyCiAgICAgICAgU2VydmVyNDIwIHM0MjAgPSBuZXcg\nU2VydmVyNDIwKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcG9ydCwgc3NsUG9ydCk7CiAgICAgICAgczQyMC5zdGFydCgpOwoKICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnM1Y3VyID0KICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkKICAgICAgICAgICAg\nLnNldENyZWF0ZU9yQXR0YWNoKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRh\nY2guQ1JFQVRFX09SX0FUVEFDSCkKICAgICAgICAgICAgLnNldE1lc3NhZ2VC\nb3VuZCg1KS5idWlsZCgpOwogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8w\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25P\ncHRpb25zIG9wdGlvbnM1djQxMCA9CiAgICAgICAgICAgIG9yZy5hcGFjaGUu\naHdfdjRfMV8wLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25PcHRpb25zLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAuc2V0\nQ3JlYXRlT3JBdHRhY2gob3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRl\nT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSCkKICAgICAgICAgICAgLnNldE1l\nc3NhZ2VCb3VuZCg1KS5idWlsZCgpOwogICAgICAgIG9yZy5hcGFjaGUuaHdf\ndjRfMV8wLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25PcHRpb25zIG9wdGlvbnMyMHY0MTAgPQogICAgICAgICAgICBvcmcu\nYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkKICAgICAgICAg\nICAgLnNldENyZWF0ZU9yQXR0YWNoKG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nLkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpCiAgICAgICAgICAg\nIC5zZXRNZXNzYWdlQm91bmQoMjApLmJ1aWxkKCk7CgogICAgICAgIENsaWVu\ndDQxMCBjNDEwID0gbmV3IENsaWVudDQxMCgibG9jYWxob3N0OiIrcG9ydCsi\nOiIrc3NsUG9ydCk7CiAgICAgICAgYzQxMC5zdWJzY3JpYmUodG9waWMsIHN1\nYmlkLCBvcHRpb25zMjB2NDEwKTsKICAgICAgICBjNDEwLmNsb3NlU3Vic2Ny\naXB0aW9uKHRvcGljLCBzdWJpZCk7CiAgICAgICAgVGhyZWFkLnNsZWVwKDEw\nMDApOyAvLyBnaXZlIHNlcnZlciB0aW1lIHRvIHJ1biBkaXNjb25uZWN0IGxv\nZ2ljIChCT09LS0VFUEVSLTUxMykKCiAgICAgICAgYzQxMC5zZW5kWEV4cGVj\ndExhc3RZKHRvcGljLCBzdWJpZCwgNTAsIDIwKTsKCiAgICAgICAgYzQxMC5z\ndWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRpb25zNXY0MTApOwogICAgICAg\nIGM0MTAuY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YmlkKTsKICAgICAg\nICBUaHJlYWQuc2xlZXAoMTAwMCk7IC8vIGdpdmUgc2VydmVyIHRpbWUgdG8g\ncnVuIGRpc2Nvbm5lY3QgbG9naWMgKEJPT0tLRUVQRVItNTEzKQoKICAgICAg\nICAvLyB0aGUgbWVzc2FnZSBib3VuZCBpc24ndCB1cGRhdGVkLgogICAgICAg\nIGM0MTAuc2VuZFhFeHBlY3RMYXN0WSh0b3BpYywgc3ViaWQsIDUwLCAyMCk7\nCgogICAgICAgIENsaWVudEN1cnJlbnQgY2N1ciA9IG5ldyBDbGllbnRDdXJy\nZW50KCJsb2NhbGhvc3Q6Iitwb3J0KyI6Iitzc2xQb3J0KTsKICAgICAgICBj\nY3VyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIG9wdGlvbnM1Y3VyKTsKICAg\nICAgICBjY3VyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJpZCk7CiAg\nICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOyAvLyBnaXZlIHNlcnZlciB0aW1l\nIHRvIHJ1biBkaXNjb25uZWN0IGxvZ2ljIChCT09LS0VFUEVSLTUxMykKCiAg\nICAgICAgLy8gdGhlIG1lc3NhZ2UgYm91bmQgc2hvdWxkIGJlIHVwZGF0ZWQu\nCiAgICAgICAgYzQxMC5zZW5kWEV4cGVjdExhc3RZKHRvcGljLCBzdWJpZCwg\nNTAsIDUpOwoKICAgICAgICAvLyBzdG9wIDQyMCBzZXJ2ZXIKICAgICAgICBz\nNDIwLnN0b3AoKTsKCiAgICAgICAgYzQxMC5jbG9zZSgpOwogICAgICAgIGNj\ndXIuY2xvc2UoKTsKCiAgICAgICAgLy8gc3RvcCBib29ra2VlcGVyIGNsdXN0\nZXIKICAgICAgICBia2M0MjAuc3RvcCgpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGVzdCBjb21wYXRhYmlsaXR5IGJldHdlZW4gdmVyc2lvbiA0LjEuMCBh\nbmQgdGhlIGN1cnJlbnQgdmVyc2lvbi4KICAgICAqCiAgICAgKiBBIGN1cnJl\nbnQgY2xpZW50IHJ1bm5pbmcgbWVzc2FnZSBmaWx0ZXIgd291bGQgZmFpbCBv\nbiA0LjEuMCBodWIgc2VydmVycy4KICAgICAqLwogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDbGllbnRNZXNzYWdlRmls\ndGVyQ29tcGF0NDEwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQnl0\nZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJUZXN0\nVXBkYXRlTWVzc2FnZUJvdW5kQ29tcGF0NDEwIik7CiAgICAgICAgQnl0ZVN0\ncmluZyBzdWJpZCA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJteXN1YiIp\nOwoKICAgICAgICAvLyBzdGFydCBib29ra2VlcGVyCiAgICAgICAgQm9va0tl\nZXBlckNsdXN0ZXI0MTAgYmtjNDEwID0gbmV3IEJvb2tLZWVwZXJDbHVzdGVy\nNDEwKDMpOwogICAgICAgIGJrYzQxMC5zdGFydCgpOwoKICAgICAgICBpbnQg\ncG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAgIGlu\ndCBzc2xQb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7CgogICAg\nICAgIC8vIHN0YXJ0IGh1YiBzZXJ2ZXIgNDEwCiAgICAgICAgU2VydmVyNDEw\nIHM0MTAgPSBuZXcgU2VydmVyNDEwKHprVXRpbC5nZXRab29LZWVwZXJDb25u\nZWN0U3RyaW5nKCksIHBvcnQsIHNzbFBvcnQpOwogICAgICAgIHM0MTAuc3Rh\ncnQoKTsKCiAgICAgICAgQ2xpZW50Q3VycmVudCBjY3VyID0gbmV3IENsaWVu\ndEN1cnJlbnQoImxvY2FsaG9zdDoiK3BvcnQrIjoiK3NzbFBvcnQpOwogICAg\nICAgIGNjdXIuc3Vic2NyaWJlKHRvcGljLCBzdWJpZCk7CiAgICAgICAgY2N1\nci5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQpOwoKICAgICAgICBj\nY3VyLnB1Ymxpc2hJbnRzKHRvcGljLCAwLCAxMDApOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGNjdXIucmVjZWl2ZU51bU1vZE0odG9waWMsIHN1Ymlk\nLCAwLCA1MCwgMik7CiAgICAgICAgICAgIGZhaWwoImNsaWVudC1zaWRlIGZp\nbHRlciBjb3VsZCBub3QgcnVuIG9uIDQuMS4wIGh1YiBzZXJ2ZXIiKTsKICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBsb2dn\nZXIuaW5mbygiU2hvdWxkIGZhaWwgdG8gcnVuIGNsaWVudC1zaWRlIG1lc3Nh\nZ2UgZmlsdGVyIG9uIDQuMS4wIGh1YiBzZXJ2ZXIuIiwgZSk7CiAgICAgICAg\nICAgIGNjdXIuY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YmlkKTsKICAg\nICAgICB9CgogICAgICAgIC8vIHN0b3AgNDEwIHNlcnZlcgogICAgICAgIHM0\nMTAuc3RvcCgpOwogICAgICAgIC8vIHN0b3AgYm9va2tlZXBlciBjbHVzdGVy\nCiAgICAgICAgYmtjNDEwLnN0b3AoKTsKICAgIH0KCiAgICAvKioKICAgICAq\nIFRlc3QgY29tcGF0YWJpbGl0eSBiZXR3ZWVuIHZlcnNpb24gNC4xLjAgYW5k\nIHRoZSBjdXJyZW50IHZlcnNpb24uCiAgICAgKgogICAgICogU2VydmVyIHNp\nZGUgdGhyb3R0bGluZyBkb2VzJ3Qgd29yayB3aGVuIGN1cnJlbnQgY2xpZW50\nIGNvbm5lY3RzIHRvIG9sZCB2ZXJzaW9uCiAgICAgKiBzZXJ2ZXIuCiAgICAg\nKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0U2VydmVyU2lkZVRocm90dGxlQ29tcGF0NDEwKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJUZXN0U2VydmVyU2lkZVRocm90dGxlQ29tcGF0NDEw\nIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJpZCA9IEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJteXN1YiIpOwoKICAgICAgICAvLyBzdGFydCBib29ra2Vl\ncGVyCiAgICAgICAgQm9va0tlZXBlckNsdXN0ZXI0MTAgYmtjNDEwID0gbmV3\nIEJvb2tLZWVwZXJDbHVzdGVyNDEwKDMpOwogICAgICAgIGJrYzQxMC5zdGFy\ndCgpOwoKICAgICAgICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVl\nUG9ydCgpOwogICAgICAgIGludCBzc2xQb3J0ID0gUG9ydE1hbmFnZXIubmV4\ndEZyZWVQb3J0KCk7CgogICAgICAgIC8vIHN0YXJ0IGh1YiBzZXJ2ZXIgNDEw\nCiAgICAgICAgU2VydmVyNDEwIHM0MTAgPSBuZXcgU2VydmVyNDEwKHprVXRp\nbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHBvcnQsIHNzbFBvcnQp\nOwogICAgICAgIHM0MTAuc3RhcnQoKTsKCiAgICAgICAgQ2xpZW50Q3VycmVu\ndCBjY3VyID0gbmV3IENsaWVudEN1cnJlbnQoZmFsc2UsICJsb2NhbGhvc3Q6\nIitwb3J0KyI6Iitzc2xQb3J0KTsKICAgICAgICBjY3VyLnRocm90dGxlWDQx\nKHRvcGljLCBzdWJpZCwgMTApOwoKICAgICAgICBjY3VyLmNsb3NlKCk7Cgog\nICAgICAgIC8vIHN0b3AgNDEwIHNlcnZlcgogICAgICAgIHM0MTAuc3RvcCgp\nOwogICAgICAgIC8vIHN0b3AgYm9va2tlZXBlciBjbHVzdGVyCiAgICAgICAg\nYmtjNDEwLnN0b3AoKTsKICAgIH0KfQo=\n","encoding":"base64"}

