{"sha":"8388deae11087c2bba4590a059994331550b7ede","node_id":"MDQ6QmxvYjE1NzU5NTY6ODM4OGRlYWUxMTA4N2MyYmJhNDU5MGEwNTk5OTQzMzE1NTBiN2VkZQ==","size":12554,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8388deae11087c2bba4590a059994331550b7ede","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuZGVsaXZlcnk7CgppbXBv\ncnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1YWxzOwppbXBv\ncnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0Tm90TnVsbDsKaW1w\nb3J0IHN0YXRpYyBvcmcuanVuaXQuQXNzZXJ0LmFzc2VydE51bGw7CmltcG9y\ndCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRUcnVlOwoKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRMaW5rZWRRdWV1ZTsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JzOwppbXBvcnQg\namF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNl\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljQm9vbGVhbjsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNJbnRl\nZ2VyOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHVi\nU3ViRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVy\nLlBpcGVsaW5lRmlsdGVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlB1YlN1YlJlc3BvbnNlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uUHJlZmVy\nZW5jZXM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9u\nLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5zZXJ2ZXIudG9waWNzLlN0dWJUb3BpY01hbmFnZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2UuUGVyc2lzdFJlcXVl\nc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVu\nY2UuUGVyc2lzdGVuY2VNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcuc2VydmVyLnBlcnNpc3RlbmNlLlN0dWJQZXJzaXN0ZW5jZU1hbmFnZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuc3Vic2NyaXB0aW9u\ncy5BbGxUb0FsbFRvcG9sb2d5RmlsdGVyOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcudXRpbC5DYWxsYmFjazsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0Owpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZzsKCnB1YmxpYyBjbGFzcyBUZXN0RklGT0RlbGl2ZXJ5TWFuYWdlciB7\nCiAgICBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3RvcnkuZ2V0\nTG9nZ2VyKFRlc3RGSUZPRGVsaXZlcnlNYW5hZ2VyLmNsYXNzKTsKCiAgICBz\ndGF0aWMgY2xhc3MgVGVzdENhbGxiYWNrIGltcGxlbWVudHMgQ2FsbGJhY2s8\nTWVzc2FnZVNlcUlkPiB7CiAgICAgICAgQXRvbWljQm9vbGVhbiBzdWNjZXNz\nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwogICAgICAgIGZpbmFsIENv\ndW50RG93bkxhdGNoIGxhdGNoOwogICAgICAgIE1lc3NhZ2VTZXFJZCBtc2dp\nZCA9IG51bGw7CgogICAgICAgIFRlc3RDYWxsYmFjayhDb3VudERvd25MYXRj\naCBsKSB7CiAgICAgICAgICAgIHRoaXMubGF0Y2ggPSBsOwogICAgICAgIH0K\nICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0\neCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICBs\nb2dnZXIuZXJyb3IoIlBlcnNpc3Qgb3BlcmF0aW9uIGZhaWxlZCIsIGV4Y2Vw\ndGlvbik7CiAgICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2Jq\nZWN0IGN0eCwgTWVzc2FnZVNlcUlkIHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAg\nICAgICAgICAgIG1zZ2lkID0gcmVzdWx0T2ZPcGVyYXRpb247CiAgICAgICAg\nICAgIHN1Y2Nlc3Muc2V0KHRydWUpOwogICAgICAgICAgICBsYXRjaC5jb3Vu\ndERvd24oKTsKICAgICAgICB9CgogICAgICAgIE1lc3NhZ2VTZXFJZCBnZXRJ\nZCgpIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiUGVyc2lzdCBvcGVyYXRp\nb24gZmFpbGVkIiwgc3VjY2Vzcy5nZXQoKSk7CiAgICAgICAgICAgIHJldHVy\nbiBtc2dpZDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEZWxp\ndmVyeSBlbmRwb2ludCB3aGljaCBwdXRzIGFsbCByZXNwb25zZXMgb24gYSBx\ndWV1ZQogICAgICovCiAgICBzdGF0aWMgY2xhc3MgRXhlY3V0b3JEZWxpdmVy\neUVuZFBvaW50V2l0aFF1ZXVlIGltcGxlbWVudHMgRGVsaXZlcnlFbmRQb2lu\ndCB7CiAgICAgICAgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIGV4ZWN1dG9y\nID0gRXhlY3V0b3JzLm5ld1NpbmdsZVRocmVhZFNjaGVkdWxlZEV4ZWN1dG9y\nKCk7CiAgICAgICAgQXRvbWljSW50ZWdlciBudW1SZXNwb25zZXMgPSBuZXcg\nQXRvbWljSW50ZWdlcigwKTsKICAgICAgICBDb25jdXJyZW50TGlua2VkUXVl\ndWU8UHViU3ViUmVzcG9uc2U+IHF1ZXVlID0gbmV3IENvbmN1cnJlbnRMaW5r\nZWRRdWV1ZTxQdWJTdWJSZXNwb25zZT4oKTsKCiAgICAgICAgcHVibGljIHZv\naWQgc2VuZChmaW5hbCBQdWJTdWJSZXNwb25zZSByZXNwb25zZSwgZmluYWwg\nRGVsaXZlcnlDYWxsYmFjayBjYWxsYmFjaykgewogICAgICAgICAgICBsb2dn\nZXIuaW5mbygiUmVjZWl2ZWQgcmVzcG9uc2Uge30iLCByZXNwb25zZSk7CiAg\nICAgICAgICAgIHF1ZXVlLmFkZChyZXNwb25zZSk7CiAgICAgICAgICAgIG51\nbVJlc3BvbnNlcy5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgZXhl\nY3V0b3Iuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGNhbGxiYWNrLnNlbmRpbmdGaW5pc2hlZCgpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgICAgIGV4ZWN1dG9y\nLnNodXRkb3duKCk7CiAgICAgICAgfQoKICAgICAgICBQdWJTdWJSZXNwb25z\nZSBnZXROZXh0UmVzcG9uc2UoKSB7CiAgICAgICAgICAgIHJldHVybiBxdWV1\nZS5wb2xsKCk7CiAgICAgICAgfQoKICAgICAgICBpbnQgZ2V0TnVtUmVzcG9u\nc2VzKCkgewogICAgICAgICAgICByZXR1cm4gbnVtUmVzcG9uc2VzLmdldCgp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCB0\naGUgRklGTyBkZWxpdmVyeSBtYW5hZ2VyIGV4ZWN1dGVzIHN0b3BTZXJ2aW5n\nIGFuZCBzdGFydFNlcnZpbmcKICAgICAqIGluIHRoZSBjb3JyZWN0IG9yZGVy\nCiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9yZy9qaXJh\nL2Jyb3dzZS9CT09LS0VFUEVSLTUzOX0KICAgICAqLwogICAgQFRlc3QodGlt\nZW91dCA9IDYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEZJRk9EZWxpdmVy\neVN1YkNsb3NlU3ViUmFjZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1\ncmF0aW9uKCk7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJp\nbmcuY29weUZyb21VdGY4KCJzdWJSYWNlVG9waWMiKTsKICAgICAgICBCeXRl\nU3RyaW5nIHN1YnNjcmliZXIgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgi\nc3ViUmFjZVN1YnNjcmliZXIiKTsKCiAgICAgICAgUGVyc2lzdGVuY2VNYW5h\nZ2VyIHBtID0gbmV3IFN0dWJQZXJzaXN0ZW5jZU1hbmFnZXIoKTsKICAgICAg\nICBGSUZPRGVsaXZlcnlNYW5hZ2VyIGZkbSA9IG5ldyBGSUZPRGVsaXZlcnlN\nYW5hZ2VyKG5ldyBTdHViVG9waWNNYW5hZ2VyKGNvbmYpLCBwbSwgY29uZik7\nCiAgICAgICAgRXhlY3V0b3JEZWxpdmVyeUVuZFBvaW50V2l0aFF1ZXVlIGRl\ncCA9IG5ldyBFeGVjdXRvckRlbGl2ZXJ5RW5kUG9pbnRXaXRoUXVldWUoKTsK\nICAgICAgICBTdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBwcmVmcyA9IFN1YnNj\ncmlwdGlvblByZWZlcmVuY2VzLm5ld0J1aWxkZXIoKS5idWlsZCgpOwoKICAg\nICAgICBQaXBlbGluZUZpbHRlciBmaWx0ZXIgPSBuZXcgUGlwZWxpbmVGaWx0\nZXIoKTsKICAgICAgICBmaWx0ZXIuYWRkTGFzdChuZXcgQWxsVG9BbGxUb3Bv\nbG9neUZpbHRlcigpKTsKICAgICAgICBmaWx0ZXIuaW5pdGlhbGl6ZShjb25m\nLmdldENvbmYoKSk7CiAgICAgICAgZmlsdGVyLnNldFN1YnNjcmlwdGlvblBy\nZWZlcmVuY2VzKHRvcGljLCBzdWJzY3JpYmVyLCBwcmVmcyk7CiAgICAgICAg\nTWVzc2FnZVNlcUlkIHN0YXJ0SWQgPSBNZXNzYWdlU2VxSWQubmV3QnVpbGRl\ncigpLnNldExvY2FsQ29tcG9uZW50KDEpLmJ1aWxkKCk7CgogICAgICAgIENv\ndW50RG93bkxhdGNoIGwgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAg\nICAgTWVzc2FnZSBtID0gTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShC\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOChTdHJpbmcudmFsdWVPZigxKSkpLmJ1\naWxkKCk7CiAgICAgICAgVGVzdENhbGxiYWNrIGNiID0gbmV3IFRlc3RDYWxs\nYmFjayhsKTsKICAgICAgICBwbS5wZXJzaXN0TWVzc2FnZShuZXcgUGVyc2lz\ndFJlcXVlc3QodG9waWMsIG0sIGNiLCBudWxsKSk7CiAgICAgICAgYXNzZXJ0\nVHJ1ZSgiUGVyc2lzdGVuY2UgbmV2ZXIgZmluaXNoZWQiLCBsLmF3YWl0KDEw\nLCBUaW1lVW5pdC5TRUNPTkRTKSk7CgogICAgICAgIGZpbmFsIENvdW50RG93\nbkxhdGNoIG9wbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMyk7CiAgICAg\nICAgZmRtLnN0YXJ0KCk7CiAgICAgICAgZmRtLnN0YXJ0U2VydmluZ1N1YnNj\ncmlwdGlvbih0b3BpYywgc3Vic2NyaWJlciwgcHJlZnMsIHN0YXJ0SWQsIGRl\ncCwgZmlsdGVyLAogICAgICAgICAgICAgICAgbmV3IENhbGxiYWNrPFZvaWQ+\nKCkgewogICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2Jq\nZWN0IGN0eCwgVm9pZCByZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgIG9wbGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3Qg\nY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICBvcGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBudWxsKTsKICAgICAg\nICBmZG0uc3RvcFNlcnZpbmdTdWJzY3JpYmVyKHRvcGljLCBzdWJzY3JpYmVy\nLCBudWxsLAogICAgICAgICAgICAgICAgbmV3IENhbGxiYWNrPFZvaWQ+KCkg\newogICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0\nIGN0eCwgVm9pZCByZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nIG9wbGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4\nLCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICBvcGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICBm\nZG0uc3RhcnRTZXJ2aW5nU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJzY3JpYmVy\nLCBwcmVmcywgc3RhcnRJZCwgZGVwLCBmaWx0ZXIsCiAgICAgICAgICAgICAg\nICBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBv\ncGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdCkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgb3BsYXRjaC5jb3VudERvd24oKTsK\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNl\ncHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAgIG9wbGF0Y2guY291\nbnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0sIG51bGwpOwoKICAgICAgICBhc3NlcnRUcnVlKCJPcHMgbmV2ZXIg\nZmluaXNoZWQiLCBvcGxhdGNoLmF3YWl0KDEwLCBUaW1lVW5pdC5TRUNPTkRT\nKSk7CiAgICAgICAgaW50IHNlY29uZHMgPSA1OwogICAgICAgIHdoaWxlIChk\nZXAuZ2V0TnVtUmVzcG9uc2VzKCkgPCAyKSB7CiAgICAgICAgICAgIGlmIChz\nZWNvbmRzLS0gPT0gMCkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAg\nICAgIH0KICAgICAgICBQdWJTdWJSZXNwb25zZSByID0gZGVwLmdldE5leHRS\nZXNwb25zZSgpOwogICAgICAgIGFzc2VydE5vdE51bGwoIlRoZXJlIHNob3Vs\nZCBiZSBhIHJlc3BvbnNlIiwgcik7CiAgICAgICAgYXNzZXJ0VHJ1ZSgiUmVz\ncG9uc2Ugc2hvdWxkIGNvbnRhaW4gYSBtZXNzYWdlIiwgci5oYXNNZXNzYWdl\nKCkpOwogICAgICAgIHIgPSBkZXAuZ2V0TmV4dFJlc3BvbnNlKCk7CiAgICAg\nICAgYXNzZXJ0Tm90TnVsbCgiVGhlcmUgc2hvdWxkIGJlIGEgcmVzcG9uc2Ui\nLCByKTsKICAgICAgICBhc3NlcnRUcnVlKCJSZXNwb25zZSBzaG91bGQgY29u\ndGFpbiBhIG1lc3NhZ2UiLCByLmhhc01lc3NhZ2UoKSk7CiAgICAgICAgciA9\nIGRlcC5nZXROZXh0UmVzcG9uc2UoKTsKICAgICAgICBhc3NlcnROdWxsKCJU\naGVyZSBzaG91bGQgb25seSBiZSAyIHJlc3BvbnNlcyIsIHIpOwogICAgfQoK\nICAgIHN0YXRpYyBjbGFzcyBFeGVjdXRvckRlbGl2ZXJ5RW5kUG9pbnQgaW1w\nbGVtZW50cyBEZWxpdmVyeUVuZFBvaW50IHsKICAgICAgICBTY2hlZHVsZWRF\neGVjdXRvclNlcnZpY2UgZXhlY3V0b3IgPSBFeGVjdXRvcnMubmV3U2luZ2xl\nVGhyZWFkU2NoZWR1bGVkRXhlY3V0b3IoKTsKICAgICAgICBBdG9taWNJbnRl\nZ2VyIG51bURlbGl2ZXJlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKCk7CiAgICAg\nICAgZmluYWwgRGVsaXZlcnlNYW5hZ2VyIGRtOwoKICAgICAgICBFeGVjdXRv\nckRlbGl2ZXJ5RW5kUG9pbnQoRGVsaXZlcnlNYW5hZ2VyIGRtKSB7CiAgICAg\nICAgICAgIHRoaXMuZG0gPSBkbTsKICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyB2b2lkIHNlbmQoZmluYWwgUHViU3ViUmVzcG9uc2UgcmVzcG9uc2UsIGZp\nbmFsIERlbGl2ZXJ5Q2FsbGJhY2sgY2FsbGJhY2spIHsKICAgICAgICAgICAg\nZXhlY3V0b3Iuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChyZXNwb25zZS5oYXNNZXNzYWdlKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VTZXFJZCBtc2dpZCA9IHJlc3Bv\nbnNlLmdldE1lc3NhZ2UoKS5nZXRNc2dJZCgpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKChtc2dpZC5nZXRMb2NhbENvbXBvbmVudCgpICUg\nMikgPT0gMSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRt\nLm1lc3NhZ2VDb25zdW1lZChyZXNwb25zZS5nZXRUb3BpYygpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZ2V0\nU3Vic2NyaWJlcklkKCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZXNwb25zZS5nZXRNZXNzYWdlKCkuZ2V0TXNnSWQoKSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGV4ZWN1dG9yLnNjaGVkdWxlKG5l\ndyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkbS5tZXNzYWdlQ29uc3Vt\nZWQocmVzcG9uc2UuZ2V0VG9waWMoKSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmdldFN1\nYnNjcmliZXJJZCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuZ2V0TWVzc2FnZSgpLmdl\ndE1zZ0lkKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nLCAxLCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICBudW1EZWxpdmVyZWQuaW5jcmVtZW50QW5kR2V0KCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLnNlbmRpbmdGaW5p\nc2hlZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0pOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgY2xvc2UoKSB7\nCiAgICAgICAgICAgIGV4ZWN1dG9yLnNodXRkb3duKCk7CiAgICAgICAgfQoK\nICAgICAgICBpbnQgZ2V0TnVtRGVsaXZlcmVkKCkgewogICAgICAgICAgICBy\nZXR1cm4gbnVtRGVsaXZlcmVkLmdldCgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgdGhyb3R0bGUgcmFjZSBpc3N1ZSBjYXVzZSBi\neSBtZXNzYWdlQ29uc3VtZWQgYW5kIGRvRGVsaXZlck5leHRNZXNzYWdlCiAg\nICAgKiB7QGxpbmsgaHR0cHM6Ly9pc3N1ZXMuYXBhY2hlLm9yZy9qaXJhL2Jy\nb3dzZS9CT09LS0VFUEVSLTUwM30KICAgICAqLwogICAgQFRlc3QodGltZW91\ndCA9IDYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEZJRk9EZWxpdmVyeVRo\ncm90dGxpbmdSYWNlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgZmlu\nYWwgaW50IG51bU1lc3NhZ2VzID0gMjA7CiAgICAgICAgZmluYWwgaW50IHRo\ncm90dGxlU2l6ZSA9IDEwOwogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkgewogICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgaW50IGdl\ndERlZmF1bHRNZXNzYWdlV2luZG93U2l6ZSgpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gdGhyb3R0bGVTaXplOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9OwogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRl\nU3RyaW5nLmNvcHlGcm9tVXRmOCgidGhyb3R0bGluZ1JhY2VUb3BpYyIpOwog\nICAgICAgIEJ5dGVTdHJpbmcgc3Vic2NyaWJlciA9IEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJ0aHJvdHRsaW5nUmFjZVN1YnNjcmliZXIiKTsKCiAgICAg\nICAgUGVyc2lzdGVuY2VNYW5hZ2VyIHBtID0gbmV3IFN0dWJQZXJzaXN0ZW5j\nZU1hbmFnZXIoKTsKICAgICAgICBGSUZPRGVsaXZlcnlNYW5hZ2VyIGZkbSA9\nIG5ldyBGSUZPRGVsaXZlcnlNYW5hZ2VyKG5ldyBTdHViVG9waWNNYW5hZ2Vy\nKGNvbmYpLCBwbSwgY29uZik7CiAgICAgICAgRXhlY3V0b3JEZWxpdmVyeUVu\nZFBvaW50IGRlcCA9IG5ldyBFeGVjdXRvckRlbGl2ZXJ5RW5kUG9pbnQoZmRt\nKTsKICAgICAgICBTdWJzY3JpcHRpb25QcmVmZXJlbmNlcyBwcmVmcyA9IFN1\nYnNjcmlwdGlvblByZWZlcmVuY2VzLm5ld0J1aWxkZXIoKS5idWlsZCgpOwoK\nICAgICAgICBQaXBlbGluZUZpbHRlciBmaWx0ZXIgPSBuZXcgUGlwZWxpbmVG\naWx0ZXIoKTsKICAgICAgICBmaWx0ZXIuYWRkTGFzdChuZXcgQWxsVG9BbGxU\nb3BvbG9neUZpbHRlcigpKTsKICAgICAgICBmaWx0ZXIuaW5pdGlhbGl6ZShj\nb25mLmdldENvbmYoKSk7CiAgICAgICAgZmlsdGVyLnNldFN1YnNjcmlwdGlv\nblByZWZlcmVuY2VzKHRvcGljLCBzdWJzY3JpYmVyLCBwcmVmcyk7CgogICAg\nICAgIENvdW50RG93bkxhdGNoIGwgPSBuZXcgQ291bnREb3duTGF0Y2gobnVt\nTWVzc2FnZXMpOwoKICAgICAgICBUZXN0Q2FsbGJhY2sgZmlyc3RDYWxsYmFj\nayA9IG51bGw7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1NZXNz\nYWdlczsgaSsrKSB7CiAgICAgICAgICAgIE1lc3NhZ2UgbSA9IE1lc3NhZ2Uu\nbmV3QnVpbGRlcigpLnNldEJvZHkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nU3RyaW5nLnZhbHVlT2YoaSkpKS5idWlsZCgpOwogICAgICAgICAgICBUZXN0\nQ2FsbGJhY2sgY2IgPSBuZXcgVGVzdENhbGxiYWNrKGwpOwogICAgICAgICAg\nICBpZiAoZmlyc3RDYWxsYmFjayA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICBmaXJzdENhbGxiYWNrID0gY2I7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcG0ucGVyc2lzdE1lc3NhZ2UobmV3IFBlcnNpc3RSZXF1ZXN0KHRvcGlj\nLCBtLCBjYiwgbnVsbCkpOwogICAgICAgIH0KICAgICAgICBmZG0uc3RhcnQo\nKTsKICAgICAgICBhc3NlcnRUcnVlKCJQZXJzaXN0ZW5jZSBuZXZlciBmaW5p\nc2hlZCIsIGwuYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAg\nICBmZG0uc3RhcnRTZXJ2aW5nU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJzY3Jp\nYmVyLCBwcmVmcywgZmlyc3RDYWxsYmFjay5nZXRJZCgpLCBkZXAsIGZpbHRl\nciwKICAgICAgICAgICAgICAgIG5ldyBDYWxsYmFjazxWb2lkPigpIHsKICAg\nICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgs\nIFZvaWQgcmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJT\ndWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyB3b3VsZCBub3QgaGFwcGVuZWQKICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfSwgbnVsbCk7CgogICAgICAgIGludCBj\nb3VudCA9IDMwOyAvLyB3YWl0IGZvciAzMCBzZWNvbmRzIG1heGltdW0KICAg\nICAgICB3aGlsZSAoZGVwLmdldE51bURlbGl2ZXJlZCgpIDwgbnVtTWVzc2Fn\nZXMpIHsKICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAg\nICAgICBpZiAoY291bnQtLSA9PSAwKSB7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBhc3NlcnRFcXVh\nbHMoIlNob3VsZCBoYXZlIGRlbGl2ZXJlZCAiICsgbnVtTWVzc2FnZXMsIG51\nbU1lc3NhZ2VzLCBkZXAuZ2V0TnVtRGVsaXZlcmVkKCkpOwogICAgfQoKfQo=\n","encoding":"base64"}

