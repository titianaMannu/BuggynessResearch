{"sha":"46c0c17758af78a9dd540af9baa96effbb8791c4","node_id":"MDQ6QmxvYjE1NzU5NTY6NDZjMGMxNzc1OGFmNzhhOWRkNTQwYWY5YmFhOTZlZmZiYjg3OTFjNA==","size":15763,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/46c0c17758af78a9dd540af9baa96effbb8791c4","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuZGVsaXZlcnk7CgppbXBv\ncnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJh\neXM7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbjsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERv\nd25MYXRjaDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0lu\ndGVnZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNvbmZpZ3VyYXRp\nb24uQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5j\nb25maWd1cmF0aW9uLkNvbmZpZ3VyYXRpb25FeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuSGVkd2lnQ2xpZW50OwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5NZXNzYWdlSGFuZGxlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuUHVibGlzaGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3Jp\nYmVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVyLkNsaWVudE1l\nc3NhZ2VGaWx0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5maWx0ZXIu\nTWVzc2FnZUZpbHRlckJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5m\naWx0ZXIuU2VydmVyTWVzc2FnZUZpbHRlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZTsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VIZWFkZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nT3B0aW9uczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2VzOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9leHRlbnNpb25zLlN1YnNjcmlwdGlv\nblN0YXRlVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIu\nSGVkd2lnSHViVGVzdEJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5z\nZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwppbXBvcnQgb3JnLmp1bml0\nLkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5q\ndW5pdC5UZXN0OwppbXBvcnQgb3JnLmp1bml0LnJ1bm5lci5SdW5XaXRoOwpp\nbXBvcnQgb3JnLmp1bml0LnJ1bm5lcnMuUGFyYW1ldGVyaXplZDsKaW1wb3J0\nIG9yZy5qdW5pdC5ydW5uZXJzLlBhcmFtZXRlcml6ZWQuUGFyYW1ldGVyczsK\nCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CgppbXBv\ncnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuKjsKCkBSdW5XaXRoKFBhcmFt\nZXRlcml6ZWQuY2xhc3MpCnB1YmxpYyBjbGFzcyBUZXN0VGhyb3R0bGluZ0Rl\nbGl2ZXJ5IGV4dGVuZHMgSGVkd2lnSHViVGVzdEJhc2UgewoKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIGludCBERUZBVUxUX01FU1NBR0VfV0lORE9XX1NJ\nWkUgPSAxMDsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFN0cmluZyBPUFRf\nTU9EID0gIk1PRCI7CgogICAgc3RhdGljIGNsYXNzIE1vZE1lc3NhZ2VGaWx0\nZXIgaW1wbGVtZW50cyBTZXJ2ZXJNZXNzYWdlRmlsdGVyLCBDbGllbnRNZXNz\nYWdlRmlsdGVyIHsKCiAgICAgICAgaW50IG1vZDsKCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIE1lc3NhZ2VGaWx0ZXJCYXNlIHNldFN1YnNj\ncmlwdGlvblByZWZlcmVuY2VzKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJp\nbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgU3Vic2NyaXB0aW9u\nUHJlZmVyZW5jZXMgcHJlZmVyZW5jZXMpIHsKICAgICAgICAgICAgTWFwPFN0\ncmluZywgQnl0ZVN0cmluZz4gdXNlck9wdGlvbnMgPSBTdWJzY3JpcHRpb25T\ndGF0ZVV0aWxzLmJ1aWxkVXNlck9wdGlvbnMocHJlZmVyZW5jZXMpOwogICAg\nICAgICAgICBCeXRlU3RyaW5nIG1vZFZhbHVlID0gdXNlck9wdGlvbnMuZ2V0\nKE9QVF9NT0QpOwogICAgICAgICAgICBpZiAobnVsbCA9PSBtb2RWYWx1ZSkg\newogICAgICAgICAgICAgICAgbW9kID0gMDsKICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgIG1vZCA9IEludGVnZXIudmFsdWVPZihtb2RW\nYWx1ZS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiB0ZXN0TWVzc2FnZShNZXNzYWdlIG1l\nc3NhZ2UpIHsKICAgICAgICAgICAgaW50IHZhbHVlID0gSW50ZWdlci52YWx1\nZU9mKG1lc3NhZ2UuZ2V0Qm9keSgpLnRvU3RyaW5nVXRmOCgpKTsKICAgICAg\nICAgICAgcmV0dXJuIDAgPT0gdmFsdWUgJSBtb2Q7CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgU2VydmVyTWVzc2FnZUZp\nbHRlciBpbml0aWFsaXplKENvbmZpZ3VyYXRpb24gY29uZikgdGhyb3dzIENv\nbmZpZ3VyYXRpb25FeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgLy8gZG8gbm90aGluZwogICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIHVuaW5pdGlhbGl6ZSgpIHsKICAgICAgICAgICAgLy8gZG8gbm90aGluZwog\nICAgICAgIH0KCiAgICB9CgoKICAgIHByb3RlY3RlZCBjbGFzcyBUaHJvdHRs\nZURlbGl2ZXJ5U2VydmVyQ29uZmlndXJhdGlvbiBleHRlbmRzIEh1YlNlcnZl\nckNvbmZpZ3VyYXRpb24gewoKICAgICAgICBUaHJvdHRsZURlbGl2ZXJ5U2Vy\ndmVyQ29uZmlndXJhdGlvbihpbnQgc2VydmVyUG9ydCwgaW50IHNzbFNlcnZl\nclBvcnQpIHsKICAgICAgICAgICAgc3VwZXIoc2VydmVyUG9ydCwgc3NsU2Vy\ndmVyUG9ydCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgaW50IGdldERlZmF1bHRNZXNzYWdlV2luZG93U2l6ZSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIFRlc3RUaHJvdHRsaW5nRGVsaXZlcnkuREVG\nQVVMVF9NRVNTQUdFX1dJTkRPV19TSVpFOwogICAgICAgIH0KICAgIH0KCiAg\nICBwcm90ZWN0ZWQgY2xhc3MgVGhyb3R0bGVEZWxpdmVyeUNsaWVudENvbmZp\nZ3VyYXRpb24gZXh0ZW5kcyBIdWJDbGllbnRDb25maWd1cmF0aW9uIHsKCiAg\nICAgICAgaW50IG1lc3NhZ2VXaW5kb3dTaXplOwoKICAgICAgICBUaHJvdHRs\nZURlbGl2ZXJ5Q2xpZW50Q29uZmlndXJhdGlvbigpIHsKICAgICAgICAgICAg\ndGhpcyhUZXN0VGhyb3R0bGluZ0RlbGl2ZXJ5LkRFRkFVTFRfTUVTU0FHRV9X\nSU5ET1dfU0laRSk7CiAgICAgICAgfQoKICAgICAgICBUaHJvdHRsZURlbGl2\nZXJ5Q2xpZW50Q29uZmlndXJhdGlvbihpbnQgbWVzc2FnZVdpbmRvd1NpemUp\nIHsKICAgICAgICAgICAgdGhpcy5tZXNzYWdlV2luZG93U2l6ZSA9IG1lc3Nh\nZ2VXaW5kb3dTaXplOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIGludCBnZXRNYXhpbXVtT3V0c3RhbmRpbmdNZXNzYWdl\ncygpIHsKICAgICAgICAgICAgcmV0dXJuIG1lc3NhZ2VXaW5kb3dTaXplOwog\nICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXRNZXNzYWdlV2luZG93U2l6ZShp\nbnQgbWVzc2FnZVdpbmRvd1NpemUpIHsKICAgICAgICAgICAgdGhpcy5tZXNz\nYWdlV2luZG93U2l6ZSA9IG1lc3NhZ2VXaW5kb3dTaXplOwogICAgICAgIH0K\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNB\ndXRvU2VuZENvbnN1bWVNZXNzYWdlRW5hYmxlZCgpIHsKICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gaXNTdWJzY3JpcHRpb25DaGFubmVsU2hh\ncmluZ0VuYWJsZWQoKSB7CiAgICAgICAgICAgIHJldHVybiBpc1N1YnNjcmlw\ndGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZDsKICAgICAgICB9CiAgICB9Cgog\nICAgcHJpdmF0ZSB2b2lkIHB1Ymxpc2hOdW1zKFB1Ymxpc2hlciBwdWIsIEJ5\ndGVTdHJpbmcgdG9waWMsIGludCBzdGFydCwgaW50IG51bSwgaW50IE0pIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDw9\nIG51bTsgaSsrKSB7CiAgICAgICAgICAgIFB1YlN1YlByb3RvY29sLk1hcC5C\ndWlsZGVyIHByb3BzQnVpbGRlciA9IFB1YlN1YlByb3RvY29sLk1hcC5uZXdC\ndWlsZGVyKCkuYWRkRW50cmllcygKICAgICAgICAgICAgICAgICAgICBQdWJT\ndWJQcm90b2NvbC5NYXAuRW50cnkubmV3QnVpbGRlcigpLnNldEtleShPUFRf\nTU9EKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnNldFZhbHVlKEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KFN0cmluZy52YWx1ZU9mKChzdGFydCAr\nIGkpICUgTSkpKSk7CiAgICAgICAgICAgIE1lc3NhZ2VIZWFkZXIuQnVpbGRl\nciBoZWFkZXJCdWlsZGVyID0gTWVzc2FnZUhlYWRlci5uZXdCdWlsZGVyKCku\nc2V0UHJvcGVydGllcyhwcm9wc0J1aWxkZXIpOwogICAgICAgICAgICBNZXNz\nYWdlIG1zZyA9IE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoQnl0ZVN0\ncmluZy5jb3B5RnJvbVV0ZjgoU3RyaW5nLnZhbHVlT2Yoc3RhcnQgKyBpKSkp\nCiAgICAgICAgICAgICAgICAgICAgLnNldEhlYWRlcihoZWFkZXJCdWlsZGVy\nKS5idWlsZCgpOwogICAgICAgICAgICBwdWIucHVibGlzaCh0b3BpYywgbXNn\nKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHRocm90dGxl\nV2l0aEZpbHRlcihQdWJsaXNoZXIgcHViLCBmaW5hbCBTdWJzY3JpYmVyIHN1\nYiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3Bp\nYywgQnl0ZVN0cmluZyBzdWJpZCwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZmluYWwgaW50IFgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8v\nIHB1Ymxpc2ggbnVtYmVycyB3aXRoIGhlYWRlciAoc28gb25seSAzIG1lc3Nh\nZ2VzIHdvdWxkIGJlIGRlbGl2ZXJlZCkKICAgICAgICBwdWJsaXNoTnVtcyhw\ndWIsIHRvcGljLCAwLCAzICogWCwgWCk7CgogICAgICAgIC8vIHN1YnNjcmli\nZSB0aGUgdG9waWMgd2l0aCBmaWx0ZXIKICAgICAgICBQdWJTdWJQcm90b2Nv\nbC5NYXAgdXNlck9wdGlvbnMgPSBQdWJTdWJQcm90b2NvbC5NYXAKICAgICAg\nICAgICAgICAgIC5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgICAgIC5hZGRF\nbnRyaWVzKAogICAgICAgICAgICAgICAgICAgICAgICBQdWJTdWJQcm90b2Nv\nbC5NYXAuRW50cnkubmV3QnVpbGRlcigpLnNldEtleShPUFRfTU9EKQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRWYWx1ZShCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOChTdHJpbmcudmFsdWVPZihYKSkpKS5idWlsZCgp\nOwogICAgICAgIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0cyA9IFN1YnNjcmlw\ndGlvbk9wdGlvbnMubmV3QnVpbGRlcigpLnNldENyZWF0ZU9yQXR0YWNoKENy\nZWF0ZU9yQXR0YWNoLkFUVEFDSCkKICAgICAgICAgICAgICAgIC5zZXRPcHRp\nb25zKHVzZXJPcHRpb25zKS5zZXRNZXNzYWdlRmlsdGVyKE1vZE1lc3NhZ2VG\naWx0ZXIuY2xhc3MuZ2V0TmFtZSgpKS5idWlsZCgpOwogICAgICAgIHN1Yi5z\ndWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRzKTsKCiAgICAgICAgZmluYWwg\nQXRvbWljSW50ZWdlciBleHBlY3RlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKFgp\nOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENv\ndW50RG93bkxhdGNoKDEpOwogICAgICAgIHN1Yi5zdGFydERlbGl2ZXJ5KHRv\ncGljLCBzdWJpZCwgbmV3IE1lc3NhZ2VIYW5kbGVyKCkgewogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHN5bmNocm9uaXplZCB2\nb2lkIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIE1lc3NhZ2UgbXNnLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBjYWxsYmFj\naywgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgaW50IHZhbHVlID0gSW50ZWdlci52YWx1ZU9m\nKG1zZy5nZXRCb2R5KCkudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICAg\nICAgICAgIGxvZ2dlci5kZWJ1ZygiUmVjZWl2ZWQgbWVzc2FnZSB7fSwiLCB2\nYWx1ZSk7CgogICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBleHBl\nY3RlZC5nZXQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBleHBlY3Rl\nZC5hZGRBbmRHZXQoWCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXJyb3IgY29uZGl0aW9uCiAg\nICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRGlkIG5vdCBy\nZWNlaXZlIGV4cGVjdGVkIHZhbHVlLCBleHBlY3RlZCB7fSwgZ290IHt9IiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVk\nLmdldCgpLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVj\ndGVkLnNldCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgbGF0Y2guY291\nbnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGlmICh2YWx1ZSA9PSAzICogWCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmlu\naXNoZWQoY29udGV4dCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgc3Vi\nLmNvbnN1bWUodG9waWMsIHN1YnNjcmliZXJJZCwgbXNnLmdldE1zZ0lkKCkp\nOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlJlY2VpdmVkIGJhZCBt\nZXNzYWdlIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnRE\nb3duKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICB9KTsKCiAgICAgICAgYXNzZXJ0VHJ1ZSgiVGltZWQgb3V0IHdhaXRpbmcg\nZm9yIG1lc3NhZ2VzICIgKyAzICogWCwgbGF0Y2guYXdhaXQoMTAsIFRpbWVV\nbml0LlNFQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBi\nZSBleHBlY3RlZCBtZXNzYWdlIHdpdGggIiArIDQgKiBYLCA0ICogWCwgZXhw\nZWN0ZWQuZ2V0KCkpOwoKICAgICAgICBzdWIuc3RvcERlbGl2ZXJ5KHRvcGlj\nLCBzdWJpZCk7CiAgICAgICAgc3ViLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGlj\nLCBzdWJpZCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHRocm90dGxlWChQ\ndWJsaXNoZXIgcHViLCBmaW5hbCBTdWJzY3JpYmVyIHN1YiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmlu\nZyBzdWJpZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50\nIFgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZvciAoaW50IGk9MTsg\naTw9MypYOyBpKyspIHsKICAgICAgICAgICAgcHViLnB1Ymxpc2godG9waWMs\nIE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChTdHJp\nbmcudmFsdWVPZihpKSkpLmJ1aWxkKCkpOwogICAgICAgIH0KICAgICAgICBT\ndWJzY3JpcHRpb25PcHRpb25zIG9wdHMgPSBTdWJzY3JpcHRpb25PcHRpb25z\nLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAuc2V0Q3JlYXRlT3JBdHRhY2go\nQ3JlYXRlT3JBdHRhY2guQVRUQUNIKS5idWlsZCgpOwogICAgICAgIHN1Yi5z\ndWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRzKTsKCiAgICAgICAgZmluYWwg\nQXRvbWljSW50ZWdlciBleHBlY3RlZCA9IG5ldyBBdG9taWNJbnRlZ2VyKDEp\nOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHRocm90dGxlTGF0Y2gg\nPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgQ291bnRE\nb3duTGF0Y2ggbm9uVGhyb3R0bGVMYXRjaCA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKICAgICAgICBzdWIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3ViaWQs\nIG5ldyBNZXNzYWdlSGFuZGxlcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBkZWxpdmVy\nKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBN\nZXNzYWdlIG1zZywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBj\nb250ZXh0KSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIGludCB2YWx1ZSA9IEludGVnZXIudmFsdWVPZihtc2cuZ2V0Qm9k\neSgpLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZGVidWcoIlJlY2VpdmVkIG1lc3NhZ2Uge30sIiwgdmFsdWUpOwoKICAg\nICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gZXhwZWN0ZWQuZ2V0KCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQuaW5jcmVtZW50\nQW5kR2V0KCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgLy8gZXJyb3IgY29uZGl0aW9uCiAgICAgICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRGlkIG5vdCByZWNlaXZl\nIGV4cGVjdGVkIHZhbHVlLCBleHBlY3RlZCB7fSwgZ290IHt9IiwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLmdldCgp\nLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLnNl\ndCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3R0bGVMYXRjaC5j\nb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgbm9uVGhyb3R0\nbGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGV4cGVjdGVkLmdldCgpID4gWCsxKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm90dGxlTGF0Y2guY291bnRE\nb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGlmIChleHBlY3RlZC5nZXQoKSA9PSAoMyAqIFggKyAxKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBub25UaHJvdHRsZUxhdGNoLmNvdW50RG93\nbigpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjb250ZXh0LCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWQuZ2V0KCkgPiBYICsg\nMSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWIuY29uc3VtZSh0b3Bp\nYywgc3Vic2NyaWJlcklkLCBtc2cuZ2V0TXNnSWQoKSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlJlY2Vp\ndmVkIGJhZCBtZXNzYWdlIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgdGhy\nb3R0bGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICBu\nb25UaHJvdHRsZUxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgICAgYXNzZXJ0RmFs\nc2UoIlJlY2VpdmVkIG1vcmUgbWVzc2FnZXMgdGhhbiB0aHJvdHRsZSB2YWx1\nZSAiICsgWCwKICAgICAgICAgICAgICAgICAgICB0aHJvdHRsZUxhdGNoLmF3\nYWl0KDMsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVh\nbHMoIlNob3VsZCBiZSBleHBlY3RlZCBtZXNzYWdlcyB3aXRoIG9ubHkgIiAr\nIChYKzEpLCBYKzEsIGV4cGVjdGVkLmdldCgpKTsKCiAgICAgICAgLy8gY29u\nc3VtZSBtZXNzYWdlcyB0byBub3QgdGhyb3R0bGUgaXQKICAgICAgICBmb3Ig\nKGludCBpPTE7IGk8PVg7IGkrKykgewogICAgICAgICAgICBzdWIuY29uc3Vt\nZSh0b3BpYywgc3ViaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIE1lc3Nh\nZ2VTZXFJZC5uZXdCdWlsZGVyKCkuc2V0TG9jYWxDb21wb25lbnQoaSkuYnVp\nbGQoKSk7CiAgICAgICAgfQoKICAgICAgICBhc3NlcnRUcnVlKCJUaW1lZCBv\ndXQgd2FpdGluZyBmb3IgbWVzc2FnZXMgIiArICgzKlggKyAxKSwKICAgICAg\nICAgICAgICAgICAgIG5vblRocm90dGxlTGF0Y2guYXdhaXQoMTAsIFRpbWVV\nbml0LlNFQ09ORFMpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBi\nZSBleHBlY3RlZCBtZXNzYWdlIHdpdGggIiArICgzKlggKyAxKSwKICAgICAg\nICAgICAgICAgICAgICAgMypYICsgMSwgZXhwZWN0ZWQuZ2V0KCkpOwoKICAg\nICAgICBzdWIuc3RvcERlbGl2ZXJ5KHRvcGljLCBzdWJpZCk7CiAgICAgICAg\nc3ViLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJpZCk7CiAgICB9Cgog\nICAgQFBhcmFtZXRlcnMKICAgIHB1YmxpYyBzdGF0aWMgQ29sbGVjdGlvbjxP\nYmplY3RbXT4gY29uZmlncygpIHsKICAgICAgICByZXR1cm4gQXJyYXlzLmFz\nTGlzdChuZXcgT2JqZWN0W11bXSB7IHsgZmFsc2UgfSwgeyB0cnVlIH0gfSk7\nCiAgICB9CgogICAgcHJvdGVjdGVkIGJvb2xlYW4gaXNTdWJzY3JpcHRpb25D\naGFubmVsU2hhcmluZ0VuYWJsZWQ7CgogICAgcHVibGljIFRlc3RUaHJvdHRs\naW5nRGVsaXZlcnkoYm9vbGVhbiBpc1N1YnNjcmlwdGlvbkNoYW5uZWxTaGFy\naW5nRW5hYmxlZCkgewogICAgICAgIHN1cGVyKDEpOwogICAgICAgIHRoaXMu\naXNTdWJzY3JpcHRpb25DaGFubmVsU2hhcmluZ0VuYWJsZWQgPSBpc1N1YnNj\ncmlwdGlvbkNoYW5uZWxTaGFyaW5nRW5hYmxlZDsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIuc2V0VXAoKTsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIEBBZnRlcgogICAgcHVibGljIHZvaWQgdGVh\nckRvd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBzdXBlci50ZWFy\nRG93bigpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHJvdGVjdGVkIFNl\ncnZlckNvbmZpZ3VyYXRpb24gZ2V0U2VydmVyQ29uZmlndXJhdGlvbihpbnQg\ncG9ydCwgaW50IHNzbFBvcnQpIHsKICAgICAgICByZXR1cm4gbmV3IFRocm90\ndGxlRGVsaXZlcnlTZXJ2ZXJDb25maWd1cmF0aW9uKHBvcnQsIHNzbFBvcnQp\nOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0U2VydmVyU2lkZVRocm90dGxlKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgaW50IG1lc3NhZ2VXaW5kb3dTaXplID0gREVGQVVMVF9N\nRVNTQUdFX1dJTkRPV19TSVpFOwogICAgICAgIFRocm90dGxlRGVsaXZlcnlD\nbGllbnRDb25maWd1cmF0aW9uIGNvbmYgPQogICAgICAgICAgICBuZXcgVGhy\nb3R0bGVEZWxpdmVyeUNsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBI\nZWR3aWdDbGllbnQgY2xpZW50ID0gbmV3IEhlZHdpZ0NsaWVudChjb25mKTsK\nICAgICAgICBQdWJsaXNoZXIgcHViID0gY2xpZW50LmdldFB1Ymxpc2hlcigp\nOwogICAgICAgIFN1YnNjcmliZXIgc3ViID0gY2xpZW50LmdldFN1YnNjcmli\nZXIoKTsKCiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJ0ZXN0U2VydmVyU2lkZVRocm90dGxlIik7CiAgICAg\nICAgQnl0ZVN0cmluZyBzdWJpZCA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4\nKCJzZXJ2ZXJUaHJvdHRsZVN1YiIpOwogICAgICAgIFN1YnNjcmlwdGlvbk9w\ndGlvbnMgb3B0cyA9IFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgIC5zZXRDcmVhdGVPckF0dGFjaChDcmVhdGVPckF0dGFj\naC5DUkVBVEUpLmJ1aWxkKCk7CiAgICAgICAgc3ViLnN1YnNjcmliZSh0b3Bp\nYywgc3ViaWQsIG9wdHMpOwogICAgICAgIHN1Yi5jbG9zZVN1YnNjcmlwdGlv\nbih0b3BpYywgc3ViaWQpOwoKICAgICAgICAvLyB0aHJvdHRsZSB3aXRoIGh1\nYiBzZXJ2ZXIncyBzZXR0aW5nCiAgICAgICAgdGhyb3R0bGVYKHB1Yiwgc3Vi\nLCB0b3BpYywgc3ViaWQsIERFRkFVTFRfTUVTU0FHRV9XSU5ET1dfU0laRSk7\nCgogICAgICAgIG1lc3NhZ2VXaW5kb3dTaXplID0gREVGQVVMVF9NRVNTQUdF\nX1dJTkRPV19TSVpFIC8gMjsKICAgICAgICAvLyB0aHJvdHRsZSB3aXRoIGEg\nbG93ZXIgdmFsdWUgdGhhbiBodWIgc2VydmVyJ3Mgc2V0dGluZwogICAgICAg\nIFN1YnNjcmlwdGlvbk9wdGlvbnMuQnVpbGRlciBvcHRpb25zQnVpbGRlciA9\nIFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAgICAg\nIC5zZXRDcmVhdGVPckF0dGFjaChDcmVhdGVPckF0dGFjaC5DUkVBVEUpCiAg\nICAgICAgICAgIC5zZXRNZXNzYWdlV2luZG93U2l6ZShtZXNzYWdlV2luZG93\nU2l6ZSk7CiAgICAgICAgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRm\nOCgidGVzdFNlcnZlclNpZGVUaHJvdHRsZVdpdGhMb3dlclZhbHVlIik7CiAg\nICAgICAgc3ViLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIG9wdGlvbnNCdWls\nZGVyLmJ1aWxkKCkpOwogICAgICAgIHN1Yi5jbG9zZVN1YnNjcmlwdGlvbih0\nb3BpYywgc3ViaWQpOwogICAgICAgIHRocm90dGxlWChwdWIsIHN1YiwgdG9w\naWMsIHN1YmlkLCBtZXNzYWdlV2luZG93U2l6ZSk7CgogICAgICAgIG1lc3Nh\nZ2VXaW5kb3dTaXplID0gREVGQVVMVF9NRVNTQUdFX1dJTkRPV19TSVpFICsg\nNTsKICAgICAgICAvLyB0aHJvdHRsZSB3aXRoIGEgaGlnaGVyIHZhbHVlIHRo\nYW4gaHViIHNlcnZlcidzIHNldHRpbmcKICAgICAgICBvcHRpb25zQnVpbGRl\nciA9IFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAuc2V0Q3JlYXRlT3JBdHRhY2goQ3JlYXRlT3JB\ndHRhY2guQ1JFQVRFKQogICAgICAgICAgICAgICAgICAgICAgICAgLnNldE1l\nc3NhZ2VXaW5kb3dTaXplKG1lc3NhZ2VXaW5kb3dTaXplKTsKICAgICAgICB0\nb3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJ0ZXN0U2VydmVyU2lk\nZVRocm90dGxlV2l0aEhpZ2hlclZhbHVlIik7CiAgICAgICAgc3ViLnN1YnNj\ncmliZSh0b3BpYywgc3ViaWQsIG9wdGlvbnNCdWlsZGVyLmJ1aWxkKCkpOwog\nICAgICAgIHN1Yi5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQpOwog\nICAgICAgIHRocm90dGxlWChwdWIsIHN1YiwgdG9waWMsIHN1YmlkLCBtZXNz\nYWdlV2luZG93U2l6ZSk7CgogICAgICAgIGNsaWVudC5jbG9zZSgpOwogICAg\nfQoKICAgIEBUZXN0KHRpbWVvdXQgPSA2MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RUaHJvdHRsZVdpdGhTZXJ2ZXJTaWRlRmlsdGVyKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgaW50IG1lc3NhZ2VXaW5kb3dTaXplID0gREVG\nQVVMVF9NRVNTQUdFX1dJTkRPV19TSVpFOwogICAgICAgIFRocm90dGxlRGVs\naXZlcnlDbGllbnRDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgVGhyb3R0bGVE\nZWxpdmVyeUNsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBIZWR3aWdD\nbGllbnQgY2xpZW50ID0gbmV3IEhlZHdpZ0NsaWVudChjb25mKTsKICAgICAg\nICBQdWJsaXNoZXIgcHViID0gY2xpZW50LmdldFB1Ymxpc2hlcigpOwogICAg\nICAgIFN1YnNjcmliZXIgc3ViID0gY2xpZW50LmdldFN1YnNjcmliZXIoKTsK\nCiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZy\nb21VdGY4KCJ0ZXN0VGhyb3R0bGVXaXRoU2VydmVyU2lkZUZpbHRlciIpOwog\nICAgICAgIEJ5dGVTdHJpbmcgc3ViaWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOCgibXlzdWIiKTsKICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zIG9w\ndHMgPSBTdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1aWxkZXIoKS5zZXRDcmVh\ndGVPckF0dGFjaChDcmVhdGVPckF0dGFjaC5DUkVBVEUpLmJ1aWxkKCk7CiAg\nICAgICAgc3ViLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIG9wdHMpOwogICAg\nICAgIHN1Yi5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQpOwoKICAg\nICAgICAvLyBtZXNzYWdlIGdhcDogaGFsZiBvZiB0aGUgdGhyb3R0bGUgdGhy\nZXNob2xkCiAgICAgICAgdGhyb3R0bGVXaXRoRmlsdGVyKHB1Yiwgc3ViLCB0\nb3BpYywgc3ViaWQsIG1lc3NhZ2VXaW5kb3dTaXplIC8gMik7CiAgICAgICAg\nLy8gbWVzc2FnZSBnYXA6IGVxdWFscyB0byB0aGUgdGhyb3R0bGUgdGhyZXNo\nb2xkCiAgICAgICAgdGhyb3R0bGVXaXRoRmlsdGVyKHB1Yiwgc3ViLCB0b3Bp\nYywgc3ViaWQsIG1lc3NhZ2VXaW5kb3dTaXplKTsKICAgICAgICAvLyBtZXNz\nYWdlIGdhcDogbGFyZ2VyIHRoYW4gdGhlIHRocm90dGxlIHRocmVzaG9sZAog\nICAgICAgIHRocm90dGxlV2l0aEZpbHRlcihwdWIsIHN1YiwgdG9waWMsIHN1\nYmlkLCBtZXNzYWdlV2luZG93U2l6ZSArIG1lc3NhZ2VXaW5kb3dTaXplIC8g\nMik7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

