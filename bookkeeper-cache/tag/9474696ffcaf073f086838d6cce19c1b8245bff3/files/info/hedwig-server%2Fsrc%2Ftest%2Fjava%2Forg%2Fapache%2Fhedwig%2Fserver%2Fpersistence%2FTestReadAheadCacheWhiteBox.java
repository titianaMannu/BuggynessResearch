{"sha":"2179030c6f6684723c9931caa776b1f0f9b6da38","node_id":"MDQ6QmxvYjE1NzU5NTY6MjE3OTAzMGM2ZjY2ODQ3MjNjOTkzMWNhYTc3NmIxZjBmOWI2ZGEzOA==","size":12378,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2179030c6f6684723c9931caa776b1f0f9b6da38","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuKjsKCmltcG9ydCBqYXZh\nLnV0aWwuTGlzdDsKCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbDsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1w\nb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsK\nCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5NYXRoVXRpbHM7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5IZWxwZXJNZXRob2RzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuU3R1YkNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuU3R1YlNjYW5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2U7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZp\nZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNvbmN1\ncnJlbmN5VXRpbHM7CgpwdWJsaWMgY2xhc3MgVGVzdFJlYWRBaGVhZENhY2hl\nV2hpdGVCb3ggewogICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJ0ZXN0VG9waWMiKTsKICAgIGZpbmFsIHN0YXRpYyBp\nbnQgTlVNX01FU1NBR0VTID0gMTA7CiAgICBmaW5hbCBzdGF0aWMgaW50IE1T\nR19TSVpFID0gNTA7CiAgICBMaXN0PE1lc3NhZ2U+IG1lc3NhZ2VzID0gSGVs\ncGVyTWV0aG9kcy5nZXRSYW5kb21QdWJsaXNoZWRNZXNzYWdlcyhOVU1fTUVT\nU0FHRVMsIE1TR19TSVpFKTsKICAgIFN0dWJQZXJzaXN0ZW5jZU1hbmFnZXIg\nc3R1YlBlcnNpc3RlbmNlTWFuYWdlcjsKICAgIFJlYWRBaGVhZENhY2hlIGNh\nY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXI7CiAgICBNeVNlcnZlckNvbmZp\nZ3VyYXRpb24gbXlDb25mID0gbmV3IE15U2VydmVyQ29uZmlndXJhdGlvbigp\nOwoKICAgIGNsYXNzIE15UmVhZEFoZWFkQ2FjaGUgZXh0ZW5kcyBSZWFkQWhl\nYWRDYWNoZSB7CiAgICAgICAgcHVibGljIE15UmVhZEFoZWFkQ2FjaGUoUGVy\nc2lzdGVuY2VNYW5hZ2VyV2l0aFJhbmdlU2NhbiBwZXJzaXN0ZW5jZU1hbmdl\nciwgU2VydmVyQ29uZmlndXJhdGlvbiBjZmcpIHsKICAgICAgICAgICAgc3Vw\nZXIocGVyc2lzdGVuY2VNYW5nZXIsIGNmZyk7CiAgICAgICAgfQoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBlbnF1ZXVlV2l0\naG91dEZhaWx1cmVCeVRvcGljKEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIENh\nY2hlUmVxdWVzdCBvYmopIHsKICAgICAgICAgICAgLy8gbWFrZSBpdCBwZXJm\nb3JtIGluIHRoZSBzYW1lIHRocmVhZAogICAgICAgICAgICBvYmoucGVyZm9y\nbVJlcXVlc3QoKTsKICAgICAgICB9CgogICAgfQoKICAgIGNsYXNzIE15U2Vy\ndmVyQ29uZmlndXJhdGlvbiBleHRlbmRzIFNlcnZlckNvbmZpZ3VyYXRpb24g\newoKICAgICAgICAvLyBOb3RlIHRoZXNlIGFyZSBzZXQgdXAsIHNvIHRoYXQg\ndGhlIHNpemUgbGltaXQgd2lsbCBiZSByZWFjaGVkIGJlZm9yZQogICAgICAg\nIC8vIHRoZSBjb3VudCBsaW1pdAogICAgICAgIGludCByZWFkQWhlYWRDb3Vu\ndCA9IE5VTV9NRVNTQUdFUyAvIDI7CiAgICAgICAgbG9uZyByZWFkQWhlYWRT\naXplID0gKGxvbmcpIChNU0dfU0laRSAqIDIuNSk7CiAgICAgICAgbG9uZyBt\nYXhDYWNoZVNpemUgPSBJbnRlZ2VyLk1BWF9WQUxVRTsKICAgICAgICBsb25n\nIGNhY2hlRW50cnlUVEwgPSAwTDsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIGludCBnZXRSZWFkQWhlYWRDb3VudCgpIHsKICAgICAgICAg\nICAgcmV0dXJuIHJlYWRBaGVhZENvdW50OwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGxvbmcgZ2V0UmVhZEFoZWFkU2l6\nZUJ5dGVzKCkgewogICAgICAgICAgICByZXR1cm4gcmVhZEFoZWFkU2l6ZTsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBs\nb25nIGdldE1heGltdW1DYWNoZVNpemUoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBtYXhDYWNoZVNpemU7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwdWJsaWMgbG9uZyBnZXRDYWNoZUVudHJ5VFRMKCkgewogICAg\nICAgICAgICByZXR1cm4gY2FjaGVFbnRyeVRUTDsKICAgICAgICB9CgogICAg\nfQoKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgc3R1YlBlcnNpc3RlbmNlTWFuYWdlciA9\nIG5ldyBTdHViUGVyc2lzdGVuY2VNYW5hZ2VyKCk7CiAgICAgICAgY2FjaGVC\nYXNlZFBlcnNpc3RlbmNlTWFuYWdlciA9IG5ldyBNeVJlYWRBaGVhZENhY2hl\nKHN0dWJQZXJzaXN0ZW5jZU1hbmFnZXIsIG15Q29uZikuc3RhcnQoKTsKICAg\nIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdFBlcnNpc3RNZXNzYWdlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgU3R1YkNhbGxiYWNrPFB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZD4g\nY2FsbGJhY2sgPSBuZXcgU3R1YkNhbGxiYWNrPFB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZD4oKTsKICAgICAgICBQZXJzaXN0UmVxdWVzdCByZXF1ZXN0\nID0gbmV3IFBlcnNpc3RSZXF1ZXN0KHRvcGljLCBtZXNzYWdlcy5nZXQoMCks\nIGNhbGxiYWNrLCBudWxsKTsKCiAgICAgICAgc3R1YlBlcnNpc3RlbmNlTWFu\nYWdlci5mYWlsdXJlID0gdHJ1ZTsKICAgICAgICBjYWNoZUJhc2VkUGVyc2lz\ndGVuY2VNYW5hZ2VyLnBlcnNpc3RNZXNzYWdlKHJlcXVlc3QpOwogICAgICAg\nIGFzc2VydE5vdE51bGwoQ29uY3VycmVuY3lVdGlscy50YWtlKGNhbGxiYWNr\nLnF1ZXVlKS5yaWdodCgpKTsKCiAgICAgICAgQ2FjaGVLZXkga2V5ID0gbmV3\nIENhY2hlS2V5KHRvcGljLCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2Vy\nLmdldEN1cnJlbnRTZXFJZEZvclRvcGljKHRvcGljKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TG9jYWxDb21wb25lbnQoKSk7\nCiAgICAgICAgYXNzZXJ0RmFsc2UoY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFu\nYWdlci5jYWNoZS5jb250YWluc0tleShrZXkpKTsKCiAgICAgICAgc3R1YlBl\ncnNpc3RlbmNlTWFuYWdlci5mYWlsdXJlID0gZmFsc2U7CiAgICAgICAgcGVy\nc2lzdE1lc3NhZ2UobWVzc2FnZXMuZ2V0KDApKTsKICAgIH0KCiAgICBwcml2\nYXRlIHZvaWQgcGVyc2lzdE1lc3NhZ2UoTWVzc2FnZSBtc2cpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIFN0dWJDYWxsYmFjazxQdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQ+IGNhbGxiYWNrID0gbmV3IFN0dWJDYWxsYmFjazxQ\ndWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ+KCk7CiAgICAgICAgUGVyc2lz\ndFJlcXVlc3QgcmVxdWVzdCA9IG5ldyBQZXJzaXN0UmVxdWVzdCh0b3BpYywg\nbXNnLCBjYWxsYmFjaywgbnVsbCk7CiAgICAgICAgY2FjaGVCYXNlZFBlcnNp\nc3RlbmNlTWFuYWdlci5wZXJzaXN0TWVzc2FnZShyZXF1ZXN0KTsKICAgICAg\nICBhc3NlcnROb3ROdWxsKENvbmN1cnJlbmN5VXRpbHMudGFrZShjYWxsYmFj\nay5xdWV1ZSkubGVmdCgpKTsKICAgICAgICBDYWNoZUtleSBrZXkgPSBuZXcg\nQ2FjaGVLZXkodG9waWMsIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIu\nZ2V0Q3VycmVudFNlcUlkRm9yVG9waWModG9waWMpCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC5nZXRMb2NhbENvbXBvbmVudCgpKTsK\nICAgICAgICBDYWNoZVZhbHVlIGNhY2hlVmFsdWUgPSBjYWNoZUJhc2VkUGVy\nc2lzdGVuY2VNYW5hZ2VyLmNhY2hlLmdldChrZXkpOwogICAgICAgIGFzc2Vy\ndE5vdE51bGwoY2FjaGVWYWx1ZSk7CiAgICAgICAgYXNzZXJ0RmFsc2UoY2Fj\naGVWYWx1ZS5pc1N0dWIoKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShIZWxwZXJN\nZXRob2RzLmFyZUVxdWFsKGNhY2hlVmFsdWUuZ2V0TWVzc2FnZSgpLCBtc2cp\nKTsKCiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RTY2FuU2luZ2xlTWVzc2FnZSgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIFN0dWJTY2FuQ2FsbGJhY2sgY2FsbGJhY2sgPSBuZXcg\nU3R1YlNjYW5DYWxsYmFjaygpOwogICAgICAgIFNjYW5SZXF1ZXN0IHJlcXVl\nc3QgPSBuZXcgU2NhblJlcXVlc3QodG9waWMsIDEsIGNhbGxiYWNrLCBudWxs\nKTsKICAgICAgICBzdHViUGVyc2lzdGVuY2VNYW5hZ2VyLmZhaWx1cmUgPSB0\ncnVlOwoKICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLnNj\nYW5TaW5nbGVNZXNzYWdlKHJlcXVlc3QpOwogICAgICAgIGFzc2VydFRydWUo\nY2FsbGJhY2suaXNGYWlsZWQoKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZSgwID09\nIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGUuc2l6ZSgpKTsK\nCiAgICAgICAgc3R1YlBlcnNpc3RlbmNlTWFuYWdlci5mYWlsdXJlID0gZmFs\nc2U7CiAgICAgICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5zY2Fu\nU2luZ2xlTWVzc2FnZShyZXF1ZXN0KTsKICAgICAgICBhc3NlcnRUcnVlKG15\nQ29uZi5yZWFkQWhlYWRDb3VudCA9PSBjYWNoZUJhc2VkUGVyc2lzdGVuY2VN\nYW5hZ2VyLmNhY2hlLnNpemUoKSk7CgogICAgICAgIHBlcnNpc3RNZXNzYWdl\nKG1lc3NhZ2VzLmdldCgwKSk7CiAgICAgICAgYXNzZXJ0VHJ1ZShjYWxsYmFj\nay5pc1N1Y2Nlc3MoKSk7CgogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RGVsaXZlcmVkVW50aWwoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBmb3IgKE1lc3NhZ2UgbSA6IG1lc3Nh\nZ2VzKSB7CiAgICAgICAgICAgIHBlcnNpc3RNZXNzYWdlKG0pOwogICAgICAg\nIH0KICAgICAgICBhc3NlcnRFcXVhbHMoKGxvbmcpIE5VTV9NRVNTQUdFUyAq\nIE1TR19TSVpFLCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLnByZXNl\nbnRDYWNoZVNpemUuZ2V0KCkpOwogICAgICAgIGxvbmcgbWlkZGxlID0gbWVz\nc2FnZXMuc2l6ZSgpIC8gMjsKICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVu\nY2VNYW5hZ2VyLmRlbGl2ZXJlZFVudGlsKHRvcGljLCBtaWRkbGUpOwoKICAg\nICAgICBhc3NlcnRFcXVhbHMobWVzc2FnZXMuc2l6ZSgpIC0gbWlkZGxlLCBj\nYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlLnNpemUoKSk7Cgog\nICAgICAgIGxvbmcgbWlkZGxlMiA9IG1pZGRsZSAtIDE7CiAgICAgICAgY2Fj\naGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5kZWxpdmVyZWRVbnRpbCh0b3Bp\nYywgbWlkZGxlMik7CiAgICAgICAgLy8gc2hvdWxkIGhhdmUgbm8gZWZmZWN0\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKG1lc3NhZ2VzLnNpemUoKSAtIG1pZGRs\nZSwgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5jYWNoZS5zaXplKCkp\nOwoKICAgICAgICAvLyBkZWxpdmVyZWQgYWxsIG1lc3NhZ2VzCiAgICAgICAg\nY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5kZWxpdmVyZWRVbnRpbCh0\nb3BpYywgKGxvbmcpIG1lc3NhZ2VzLnNpemUoKSk7CiAgICAgICAgLy8gc2hv\ndWxkIGhhdmUgbm8gZWZmZWN0CiAgICAgICAgYXNzZXJ0VHJ1ZShjYWNoZUJh\nc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlLmlzRW1wdHkoKSk7CiAgICAg\nICAgYXNzZXJ0VHJ1ZShjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNh\nY2hlU2VnbWVudC5nZXQoKQogICAgICAgICAgICAgICAgICAgLnRpbWVJbmRl\neE9mQWRkaXRpb24uaXNFbXB0eSgpKTsKICAgICAgICBhc3NlcnRUcnVlKGNh\nY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIub3JkZXJlZEluZGV4T25TZXFJ\nZC5pc0VtcHR5KCkpOwogICAgICAgIGFzc2VydFRydWUoMCA9PSBjYWNoZUJh\nc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLnByZXNlbnRDYWNoZVNpemUuZ2V0KCkp\nOwoKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdERvUmVhZEFoZWFkKCkgewogICAgICAgIFN0dWJTY2FuQ2Fs\nbGJhY2sgY2FsbGJhY2sgPSBuZXcgU3R1YlNjYW5DYWxsYmFjaygpOwogICAg\nICAgIFNjYW5SZXF1ZXN0IHJlcXVlc3QgPSBuZXcgU2NhblJlcXVlc3QodG9w\naWMsIDEsIGNhbGxiYWNrLCBudWxsKTsKICAgICAgICBjYWNoZUJhc2VkUGVy\nc2lzdGVuY2VNYW5hZ2VyLmRvUmVhZEFoZWFkKHJlcXVlc3QpOwoKICAgICAg\nICBhc3NlcnRFcXVhbHMobXlDb25mLnJlYWRBaGVhZENvdW50LCBjYWNoZUJh\nc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlLnNpemUoKSk7CgogICAgICAg\nIHJlcXVlc3QgPSBuZXcgU2NhblJlcXVlc3QodG9waWMsIG15Q29uZi5yZWFk\nQWhlYWRDb3VudCAvIDIgLSAxLCBjYWxsYmFjaywgbnVsbCk7CiAgICAgICAg\nY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5kb1JlYWRBaGVhZChyZXF1\nZXN0KTsKICAgICAgICBhc3NlcnRFcXVhbHMobXlDb25mLnJlYWRBaGVhZENv\ndW50LCBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmNhY2hlLnNpemUo\nKSk7CgogICAgICAgIHJlcXVlc3QgPSBuZXcgU2NhblJlcXVlc3QodG9waWMs\nIG15Q29uZi5yZWFkQWhlYWRDb3VudCAvIDIgKyAyLCBjYWxsYmFjaywgbnVs\nbCk7CiAgICAgICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5kb1Jl\nYWRBaGVhZChyZXF1ZXN0KTsKICAgICAgICBhc3NlcnRFcXVhbHMoKGludCkg\nKDEuNSAqIG15Q29uZi5yZWFkQWhlYWRDb3VudCksIGNhY2hlQmFzZWRQZXJz\naXN0ZW5jZU1hbmFnZXIuY2FjaGUuc2l6ZSgpKTsKCiAgICB9CgogICAgQFRl\nc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkQWhl\nYWRTaXplTGltaXQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBmb3Ig\nKE1lc3NhZ2UgbSA6IG1lc3NhZ2VzKSB7CiAgICAgICAgICAgIHBlcnNpc3RN\nZXNzYWdlKG0pOwogICAgICAgIH0KICAgICAgICBjYWNoZUJhc2VkUGVyc2lz\ndGVuY2VNYW5hZ2VyLmNhY2hlLmNsZWFyKCk7CiAgICAgICAgU3R1YlNjYW5D\nYWxsYmFjayBjYWxsYmFjayA9IG5ldyBTdHViU2NhbkNhbGxiYWNrKCk7CiAg\nICAgICAgU2NhblJlcXVlc3QgcmVxdWVzdCA9IG5ldyBTY2FuUmVxdWVzdCh0\nb3BpYywgMSwgY2FsbGJhY2ssIG51bGwpOwogICAgICAgIGNhY2hlQmFzZWRQ\nZXJzaXN0ZW5jZU1hbmFnZXIuc2NhblNpbmdsZU1lc3NhZ2UocmVxdWVzdCk7\nCgogICAgICAgIGFzc2VydFRydWUoY2FsbGJhY2suaXNTdWNjZXNzKCkpOwog\nICAgICAgIGFzc2VydEVxdWFscygoaW50KSBNYXRoLmNlaWwobXlDb25mLnJl\nYWRBaGVhZFNpemUgLyAoTVNHX1NJWkUgKyAwLjApKSwgY2FjaGVCYXNlZFBl\ncnNpc3RlbmNlTWFuYWdlci5jYWNoZQogICAgICAgICAgICAgICAgICAgICAu\nc2l6ZSgpKTsKCiAgICB9CgogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAg\nIHB1YmxpYyB2b2lkIHRlc3REb1JlYWRBaGVhZFN0YXJ0aW5nRnJvbSgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIHBlcnNpc3RNZXNzYWdlKG1lc3Nh\nZ2VzLmdldCgwKSk7CiAgICAgICAgaW50IHJlYWRBaGVhZENvdW50ID0gNTsK\nICAgICAgICBpbnQgc3RhcnQgPSAxOwogICAgICAgIFJhbmdlU2NhblJlcXVl\nc3QgcmVhZEFoZWFkUmVxdWVzdCA9IGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1h\nbmFnZXIuZG9SZWFkQWhlYWRTdGFydGluZ0Zyb20odG9waWMsIHN0YXJ0LAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJl\nYWRBaGVhZENvdW50KTsKICAgICAgICBhc3NlcnROdWxsKHJlYWRBaGVhZFJl\ncXVlc3QpOwoKICAgICAgICBTdHViU2NhbkNhbGxiYWNrIGNhbGxiYWNrID0g\nbmV3IFN0dWJTY2FuQ2FsbGJhY2soKTsKICAgICAgICBpbnQgZW5kID0gMTAw\nOwogICAgICAgIFNjYW5SZXF1ZXN0IHJlcXVlc3QgPSBuZXcgU2NhblJlcXVl\nc3QodG9waWMsIGVuZCwgY2FsbGJhY2ssIG51bGwpOwogICAgICAgIGNhY2hl\nQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuZG9SZWFkQWhlYWQocmVxdWVzdCk7\nCgogICAgICAgIGludCBwb3MgPSA5ODsKICAgICAgICByZWFkQWhlYWRSZXF1\nZXN0ID0gY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5kb1JlYWRBaGVh\nZFN0YXJ0aW5nRnJvbSh0b3BpYywgcG9zLCByZWFkQWhlYWRDb3VudCk7CiAg\nICAgICAgYXNzZXJ0RXF1YWxzKHJlYWRBaGVhZFJlcXVlc3QubWVzc2FnZUxp\nbWl0LCBlbmQgLSBwb3MpOwoKICAgICAgICBlbmQgPSAyMDA7CiAgICAgICAg\ncmVxdWVzdCA9IG5ldyBTY2FuUmVxdWVzdCh0b3BpYywgZW5kLCBjYWxsYmFj\naywgbnVsbCk7CiAgICAgICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdl\nci5kb1JlYWRBaGVhZChyZXF1ZXN0KTsKCiAgICAgICAgLy8gdG9vIGZhciBi\nYWNrCiAgICAgICAgcG9zID0gMTUwOwogICAgICAgIHJlYWRBaGVhZFJlcXVl\nc3QgPSBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLmRvUmVhZEFoZWFk\nU3RhcnRpbmdGcm9tKHRvcGljLCBwb3MsIHJlYWRBaGVhZENvdW50KTsKICAg\nICAgICBhc3NlcnRFcXVhbHMocmVhZEFoZWFkUmVxdWVzdC5tZXNzYWdlTGlt\naXQsIHJlYWRBaGVhZENvdW50KTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEFkZE1lc3NhZ2VUb0NhY2hl\nKCkgewogICAgICAgIENhY2hlS2V5IGtleSA9IG5ldyBDYWNoZUtleSh0b3Bp\nYywgMSk7CiAgICAgICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5h\nZGRNZXNzYWdlVG9DYWNoZShrZXksIG1lc3NhZ2VzLmdldCgwKSwgTWF0aFV0\naWxzLm5vdygpKTsKICAgICAgICBhc3NlcnRFcXVhbHMoMSwgY2FjaGVCYXNl\nZFBlcnNpc3RlbmNlTWFuYWdlci5jYWNoZS5zaXplKCkpOwogICAgICAgIGFz\nc2VydEVxdWFscyhNU0dfU0laRSwgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFu\nYWdlci5wcmVzZW50Q2FjaGVTaXplLmdldCgpKTsKICAgICAgICBhc3NlcnRF\ncXVhbHMoMSwgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5vcmRlcmVk\nSW5kZXhPblNlcUlkLmdldCh0b3BpYykuc2l6ZSgpKTsKICAgICAgICBhc3Nl\ncnRUcnVlKGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIub3JkZXJlZElu\nZGV4T25TZXFJZC5nZXQodG9waWMpLmNvbnRhaW5zKDFMKSk7CgogICAgICAg\nIENhY2hlVmFsdWUgdmFsdWUgPSBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5h\nZ2VyLmNhY2hlLmdldChrZXkpOwogICAgICAgIGFzc2VydFRydWUoY2FjaGVC\nYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5jYWNoZVNlZ21lbnQuZ2V0KCkKICAg\nICAgICAgICAgICAgICAgIC50aW1lSW5kZXhPZkFkZGl0aW9uLmdldCh2YWx1\nZS50aW1lT2ZBZGRpdGlvbikuY29udGFpbnMoa2V5KSk7CiAgICB9CgogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZW1v\ndmVNZXNzYWdlRnJvbUNhY2hlKCkgewogICAgICAgIENhY2hlS2V5IGtleSA9\nIG5ldyBDYWNoZUtleSh0b3BpYywgMSk7CiAgICAgICAgY2FjaGVCYXNlZFBl\ncnNpc3RlbmNlTWFuYWdlci5hZGRNZXNzYWdlVG9DYWNoZShrZXksIG1lc3Nh\nZ2VzLmdldCgwKSwgTWF0aFV0aWxzLm5vdygpKTsKICAgICAgICBjYWNoZUJh\nc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLnJlbW92ZU1lc3NhZ2VGcm9tQ2FjaGUo\na2V5LCBuZXcgRXhjZXB0aW9uKCksIHRydWUsIHRydWUpOwogICAgICAgIGFz\nc2VydFRydWUoY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5jYWNoZS5p\nc0VtcHR5KCkpOwogICAgICAgIGFzc2VydFRydWUoY2FjaGVCYXNlZFBlcnNp\nc3RlbmNlTWFuYWdlci5vcmRlcmVkSW5kZXhPblNlcUlkLmlzRW1wdHkoKSk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZShjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5h\nZ2VyLmNhY2hlU2VnbWVudC5nZXQoKQogICAgICAgICAgICAgICAgICAgLnRp\nbWVJbmRleE9mQWRkaXRpb24uaXNFbXB0eSgpKTsKICAgIH0KCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdENvbGxlY3RP\nbGRDYWNoZUVudHJpZXMoKSB7CiAgICAgICAgaW50IGkgPSAxOwogICAgICAg\nIGZvciAoTWVzc2FnZSBtIDogbWVzc2FnZXMpIHsKICAgICAgICAgICAgQ2Fj\naGVLZXkga2V5ID0gbmV3IENhY2hlS2V5KHRvcGljLCBpKTsKICAgICAgICAg\nICAgY2FjaGVCYXNlZFBlcnNpc3RlbmNlTWFuYWdlci5hZGRNZXNzYWdlVG9D\nYWNoZShrZXksIG0sIGkpOwogICAgICAgICAgICBpKys7CiAgICAgICAgfQoK\nICAgICAgICBpbnQgbiA9IDI7CiAgICAgICAgbXlDb25mLm1heENhY2hlU2l6\nZSA9IG4gKiBNU0dfU0laRSAqIG15Q29uZi5nZXROdW1SZWFkQWhlYWRDYWNo\nZVRocmVhZHMoKTsKICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5h\nZ2VyLnJlbG9hZENvbmYobXlDb25mKTsKICAgICAgICBjYWNoZUJhc2VkUGVy\nc2lzdGVuY2VNYW5hZ2VyLmNvbGxlY3RPbGRPckV4cGlyZWRDYWNoZUVudHJp\nZXMoCiAgICAgICAgICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5h\nZ2VyLmNhY2hlU2VnbWVudC5nZXQoKSk7CiAgICAgICAgYXNzZXJ0RXF1YWxz\nKG4sIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGUuc2l6ZSgp\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMobiwgY2FjaGVCYXNlZFBlcnNpc3Rl\nbmNlTWFuYWdlci5jYWNoZVNlZ21lbnQuZ2V0KCkKICAgICAgICAgICAgICAg\nICAgICAgLnRpbWVJbmRleE9mQWRkaXRpb24uc2l6ZSgpKTsKICAgIH0KCiAg\nICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdENv\nbGxlY3RFeHBpcmVkQ2FjaGVFbnRyaWVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgaW50IGkgPSAxOwogICAgICAgIGludCBuID0gMjsKICAgICAg\nICBsb25nIHR0bCA9IDUwMDBMOwogICAgICAgIG15Q29uZi5jYWNoZUVudHJ5\nVFRMID0gdHRsOwogICAgICAgIGxvbmcgY3VyVGltZSA9IE1hdGhVdGlscy5u\nb3coKTsKICAgICAgICBjYWNoZUJhc2VkUGVyc2lzdGVuY2VNYW5hZ2VyLnJl\nbG9hZENvbmYobXlDb25mKTsKICAgICAgICBmb3IgKE1lc3NhZ2UgbSA6IG1l\nc3NhZ2VzKSB7CiAgICAgICAgICAgIENhY2hlS2V5IGtleSA9IG5ldyBDYWNo\nZUtleSh0b3BpYywgaSk7CiAgICAgICAgICAgIGNhY2hlQmFzZWRQZXJzaXN0\nZW5jZU1hbmFnZXIuYWRkTWVzc2FnZVRvQ2FjaGUoa2V5LCBtLCBjdXJUaW1l\nKyspOwogICAgICAgICAgICBpZiAoaSA9PSBOVU1fTUVTU0FHRVMgLSBuKSB7\nCiAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoMiAqIHR0bCk7CiAgICAg\nICAgICAgICAgICBjdXJUaW1lICs9IDIgKiB0dGw7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaSsrOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0RXF1\nYWxzKG4sIGNhY2hlQmFzZWRQZXJzaXN0ZW5jZU1hbmFnZXIuY2FjaGUuc2l6\nZSgpKTsKICAgICAgICBhc3NlcnRFcXVhbHMobiwgY2FjaGVCYXNlZFBlcnNp\nc3RlbmNlTWFuYWdlci5jYWNoZVNlZ21lbnQuZ2V0KCkKICAgICAgICAgICAg\nICAgICAgICAgLnRpbWVJbmRleE9mQWRkaXRpb24uc2l6ZSgpKTsKICAgIH0K\nCn0K\n","encoding":"base64"}

