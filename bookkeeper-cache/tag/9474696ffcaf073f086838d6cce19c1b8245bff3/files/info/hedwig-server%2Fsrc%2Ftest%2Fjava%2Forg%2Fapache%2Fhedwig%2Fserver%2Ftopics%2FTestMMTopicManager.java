{"sha":"4c54d39f3154b0ff907bec46f27b8420e7b96e92","node_id":"MDQ6QmxvYjE1NzU5NTY6NGM1NGQzOWYzMTU0YjBmZjkwN2JlYzQ2ZjI3Yjg0MjBlN2I5NmU5Mg==","size":13226,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4c54d39f3154b0ff907bec46f27b8420e7b96e92","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsKaW1wb3J0IGphdmEu\ndXRpbC5jb25jdXJyZW50LlNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZTsKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlN5bmNocm9ub3VzUXVldWU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwpp\nbXBvcnQgb3JnLmp1bml0LkFmdGVyOwppbXBvcnQgb3JnLmp1bml0LkFzc2Vy\ndDsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5TdHViQ2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3Vi\nRXhjZXB0aW9uLkNvbXBvc2l0ZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5tZXRhLk1ldGFkYXRh\nTWFuYWdlckZhY3RvcnlUZXN0Q2FzZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnNlcnZlci5tZXRhLlRvcGljT3duZXJzaGlwTWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudmVyc2lvbmluZy5WZXJzaW9u\nZWQ7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5Db25jdXJyZW5jeVV0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5FaXRoZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3M7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLlBhaXI7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy56b29rZWVwZXIuWm9vS2VlcGVyVGVzdEJhc2U7\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlckZhY3Rvcnk7CgpwdWJsaWMgY2xhc3MgVGVzdE1NVG9waWNNYW5hZ2Vy\nIGV4dGVuZHMgTWV0YWRhdGFNYW5hZ2VyRmFjdG9yeVRlc3RDYXNlIHsKCiAg\nICBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2Vy\nKFRlc3RNTVRvcGljTWFuYWdlci5jbGFzcyk7CgogICAgcHJvdGVjdGVkIE1N\nVG9waWNNYW5hZ2VyIHRtOwogICAgcHJvdGVjdGVkIFRvcGljT3duZXJzaGlw\nTWFuYWdlciB0b207CgogICAgcHJvdGVjdGVkIGNsYXNzIENhbGxiYWNrUXVl\ndWU8VD4gaW1wbGVtZW50cyBDYWxsYmFjazxUPiB7CiAgICAgICAgU3luY2hy\nb25vdXNRdWV1ZTxFaXRoZXI8VCwgRXhjZXB0aW9uPj4gcSA9IG5ldyBTeW5j\naHJvbm91c1F1ZXVlPEVpdGhlcjxULCBFeGNlcHRpb24+PigpOwoKICAgICAg\nICBwdWJsaWMgU3luY2hyb25vdXNRdWV1ZTxFaXRoZXI8VCwgRXhjZXB0aW9u\nPj4gZ2V0UXVldWUoKSB7CiAgICAgICAgICAgIHJldHVybiBxOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIEVpdGhlcjxULCBFeGNlcHRpb24+IHRha2Uo\nKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICBy\nZXR1cm4gcS50YWtlKCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0\neCwgZmluYWwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAg\nICAgICBMT0cuZXJyb3IoImdvdCBleGNlcHRpb246ICIgKyBleGNlcHRpb24p\nOwogICAgICAgICAgICBuZXcgVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAg\nICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIENvbmN1cnJlbmN5\nVXRpbHMucHV0KHEsIEVpdGhlci5vZigoVCkgbnVsbCwgKEV4Y2VwdGlvbikg\nZXhjZXB0aW9uKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0p\nLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3QgY3R4LCBm\naW5hbCBUIHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAgICAgICAgICAgIG5ldyBU\naHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAg\nICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQocSwgRWl0aGVy\nLm9mKHJlc3VsdE9mT3BlcmF0aW9uLCAoRXhjZXB0aW9uKSBudWxsKSk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnN0YXJ0KCk7CiAgICAg\nICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBDYWxsYmFja1F1ZXVlPEhlZHdp\nZ1NvY2tldEFkZHJlc3M+IGFkZHJDYnEgPSBuZXcgQ2FsbGJhY2tRdWV1ZTxI\nZWR3aWdTb2NrZXRBZGRyZXNzPigpOwogICAgcHJvdGVjdGVkIENhbGxiYWNr\nUXVldWU8Qnl0ZVN0cmluZz4gYnNDYnEgPSBuZXcgQ2FsbGJhY2tRdWV1ZTxC\neXRlU3RyaW5nPigpOwogICAgcHJvdGVjdGVkIENhbGxiYWNrUXVldWU8Vm9p\nZD4gdm9pZENicSA9IG5ldyBDYWxsYmFja1F1ZXVlPFZvaWQ+KCk7CgogICAg\ncHJvdGVjdGVkIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOCgidG9waWMiKTsKICAgIHByb3RlY3RlZCBIZWR3aWdTb2NrZXRB\nZGRyZXNzIG1lOwogICAgcHJvdGVjdGVkIFNjaGVkdWxlZEV4ZWN1dG9yU2Vy\ndmljZSBzY2hlZHVsZXI7CgogICAgcHVibGljIFRlc3RNTVRvcGljTWFuYWdl\ncihTdHJpbmcgbWV0YU1hbmFnZXJDbHMpIHsKICAgICAgICBzdXBlcihtZXRh\nTWFuYWdlckNscyk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBAQmVmb3Jl\nCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIHN1cGVyLnNldFVwKCk7CiAgICAgICAgbWUgPSBjb25mLmdldFNl\ncnZlckFkZHIoKTsKICAgICAgICBzY2hlZHVsZXIgPSBFeGVjdXRvcnMubmV3\nU2luZ2xlVGhyZWFkU2NoZWR1bGVkRXhlY3V0b3IoKTsKICAgICAgICB0b20g\nPSBtZXRhZGF0YU1hbmFnZXJGYWN0b3J5Lm5ld1RvcGljT3duZXJzaGlwTWFu\nYWdlcigpOwogICAgICAgIHRtID0gbmV3IE1NVG9waWNNYW5hZ2VyKGNvbmYs\nIHprLCBtZXRhZGF0YU1hbmFnZXJGYWN0b3J5LCBzY2hlZHVsZXIpOwogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgQEFmdGVyCiAgICBwdWJsaWMgdm9pZCB0\nZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRvbS5jbG9z\nZSgpOwogICAgICAgIHRtLnN0b3AoKTsKICAgICAgICBzdXBlci50ZWFyRG93\nbigpOwogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0R2V0T3duZXJTaW5nbGUoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICB0bS5nZXRPd25lcih0b3BpYywgZmFsc2UsIGFkZHJDYnEs\nIG51bGwpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMobWUsIGNoZWNr\nKGFkZHJDYnEudGFrZSgpKSk7CiAgICB9CgogICAgcHJvdGVjdGVkIEJ5dGVT\ndHJpbmcgbWtUb3BpYyhpbnQgaSkgewogICAgICAgIHJldHVybiBCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOCh0b3BpYy50b1N0cmluZ1V0ZjgoKSArIGkpOwog\nICAgfQoKICAgIHByb3RlY3RlZCA8VD4gVCBjaGVjayhFaXRoZXI8VCwgRXhj\nZXB0aW9uPiBleCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGV4\nLmxlZnQoKSA9PSBudWxsKQogICAgICAgICAgICB0aHJvdyBleC5yaWdodCgp\nOwogICAgICAgIGVsc2UKICAgICAgICAgICAgcmV0dXJuIGV4LmxlZnQoKTsK\nICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIEN1c3RvbVNlcnZlckNv\nbmZpZ3VyYXRpb24gZXh0ZW5kcyBTZXJ2ZXJDb25maWd1cmF0aW9uIHsKICAg\nICAgICBpbnQgcG9ydDsKCiAgICAgICAgcHVibGljIEN1c3RvbVNlcnZlckNv\nbmZpZ3VyYXRpb24oaW50IHBvcnQpIHsKICAgICAgICAgICAgdGhpcy5wb3J0\nID0gcG9ydDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAg\nIHB1YmxpYyBpbnQgZ2V0U2VydmVyUG9ydCgpIHsKICAgICAgICAgICAgcmV0\ndXJuIHBvcnQ7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRpbWVvdXQ9\nNjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0R2V0T3duZXJNdWx0aSgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZjEgPSBuZXcgQ3VzdG9tU2VydmVyQ29uZmlndXJhdGlvbihjb25mLmdl\ndFNlcnZlclBvcnQoKSArIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgY29uZjIgPSBuZXcgQ3VzdG9tU2VydmVyQ29uZmlndXJhdGlvbihjb25m\nLmdldFNlcnZlclBvcnQoKSArIDIpOwogICAgICAgIE1NVG9waWNNYW5hZ2Vy\nIHRtMSA9IG5ldyBNTVRvcGljTWFuYWdlcihjb25mMSwgemssIG1ldGFkYXRh\nTWFuYWdlckZhY3RvcnksIHNjaGVkdWxlciksCiAgICAgICAgICAgICAgICAg\nICAgICAgdG0yID0gbmV3IE1NVG9waWNNYW5hZ2VyKGNvbmYyLCB6aywgbWV0\nYWRhdGFNYW5hZ2VyRmFjdG9yeSwgc2NoZWR1bGVyKTsKCiAgICAgICAgdG0u\nZ2V0T3duZXIodG9waWMsIGZhbHNlLCBhZGRyQ2JxLCBudWxsKTsKICAgICAg\nICBIZWR3aWdTb2NrZXRBZGRyZXNzIG93bmVyID0gY2hlY2soYWRkckNicS50\nYWtlKCkpOwoKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEwMDsgKytp\nKSB7CiAgICAgICAgICAgIHRtLmdldE93bmVyKHRvcGljLCBmYWxzZSwgYWRk\nckNicSwgbnVsbCk7CiAgICAgICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMo\nb3duZXIsIGNoZWNrKGFkZHJDYnEudGFrZSgpKSk7CgogICAgICAgICAgICB0\nbTEuZ2V0T3duZXIodG9waWMsIGZhbHNlLCBhZGRyQ2JxLCBudWxsKTsKICAg\nICAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyhvd25lciwgY2hlY2soYWRk\nckNicS50YWtlKCkpKTsKCiAgICAgICAgICAgIHRtMi5nZXRPd25lcih0b3Bp\nYywgZmFsc2UsIGFkZHJDYnEsIG51bGwpOwogICAgICAgICAgICBBc3NlcnQu\nYXNzZXJ0RXF1YWxzKG93bmVyLCBjaGVjayhhZGRyQ2JxLnRha2UoKSkpOwog\nICAgICAgIH0KCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCAxMDA7ICsr\naSkgewogICAgICAgICAgICBpZiAoIW93bmVyLmVxdWFscyhtZSkpCiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgdG0uZ2V0T3duZXIobWtU\nb3BpYyhpKSwgZmFsc2UsIGFkZHJDYnEsIG51bGwpOwogICAgICAgICAgICBv\nd25lciA9IGNoZWNrKGFkZHJDYnEudGFrZSgpKTsKICAgICAgICAgICAgaWYg\nKGkgPT0gOTkpCiAgICAgICAgICAgICAgICBBc3NlcnQuZmFpbCgiTmV2ZXIg\nY2hvc2UgYW5vdGhlciBvd25lciIpOwogICAgICAgIH0KCiAgICAgICAgdG0x\nLnN0b3AoKTsKICAgICAgICB0bTIuc3RvcCgpOwogICAgfQoKICAgIEBUZXN0\nKHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0TG9hZEJhbGFu\nY2luZygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRtLmdldE93bmVy\nKHRvcGljLCBmYWxzZSwgYWRkckNicSwgbnVsbCk7CgogICAgICAgIEFzc2Vy\ndC5hc3NlcnRFcXVhbHMobWUsIGNoZWNrKGFkZHJDYnEudGFrZSgpKSk7Cgog\nICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjEgPSBuZXcgQ3VzdG9t\nU2VydmVyQ29uZmlndXJhdGlvbihjb25mLmdldFNlcnZlclBvcnQoKSArIDEp\nOwogICAgICAgIFRvcGljTWFuYWdlciB0bTEgPSBuZXcgTU1Ub3BpY01hbmFn\nZXIoY29uZjEsIHprLCBtZXRhZGF0YU1hbmFnZXJGYWN0b3J5LCBzY2hlZHVs\nZXIpOwoKICAgICAgICBCeXRlU3RyaW5nIHRvcGljMSA9IG1rVG9waWMoMSk7\nCiAgICAgICAgdG0uZ2V0T3duZXIodG9waWMxLCBmYWxzZSwgYWRkckNicSwg\nbnVsbCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyhjb25mMS5nZXRT\nZXJ2ZXJBZGRyKCksIGNoZWNrKGFkZHJDYnEudGFrZSgpKSk7CgogICAgICAg\nIHRtMS5zdG9wKCk7CiAgICB9CgogICAgY2xhc3MgU3R1Yk93bmVyc2hpcENo\nYW5nZUxpc3RlbmVyIGltcGxlbWVudHMgVG9waWNPd25lcnNoaXBDaGFuZ2VM\naXN0ZW5lciB7CiAgICAgICAgYm9vbGVhbiBmYWlsdXJlOwogICAgICAgIFN5\nbmNocm9ub3VzUXVldWU8UGFpcjxCeXRlU3RyaW5nLCBCb29sZWFuPj4gYnNR\ndWV1ZTsKCiAgICAgICAgcHVibGljIFN0dWJPd25lcnNoaXBDaGFuZ2VMaXN0\nZW5lcihTeW5jaHJvbm91c1F1ZXVlPFBhaXI8Qnl0ZVN0cmluZywgQm9vbGVh\nbj4+IGJzUXVldWUpIHsKICAgICAgICAgICAgdGhpcy5ic1F1ZXVlID0gYnNR\ndWV1ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHNldEZhaWx1\ncmUoYm9vbGVhbiBmYWlsdXJlKSB7CiAgICAgICAgICAgIHRoaXMuZmFpbHVy\nZSA9IGZhaWx1cmU7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgdm9pZCBsb3N0VG9waWMoZmluYWwgQnl0ZVN0cmluZyB0\nb3BpYykgewogICAgICAgICAgICBuZXcgVGhyZWFkKG5ldyBSdW5uYWJsZSgp\nIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIENvbmN1\ncnJlbmN5VXRpbHMucHV0KGJzUXVldWUsIFBhaXIub2YodG9waWMsIGZhbHNl\nKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pLnN0YXJ0KCk7\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBhY3F1aXJlZFRvcGlj\nKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIENhbGxiYWNrPFZvaWQ+\nIGNhbGxiYWNrLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIG5l\ndyBUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAg\nICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQoYnNRdWV1\nZSwgUGFpci5vZih0b3BpYywgdHJ1ZSkpOwogICAgICAgICAgICAgICAgICAg\nIGlmIChmYWlsdXJlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxi\nYWNrLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24u\nU2VydmljZURvd25FeGNlcHRpb24oIkFza2VkIHRvIGZhaWwiKSk7CiAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0pLnN0YXJ0KCk7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0KHRp\nbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0T3duZXJzaGlwQ2hh\nbmdlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3luY2hyb25vdXNR\ndWV1ZTxQYWlyPEJ5dGVTdHJpbmcsIEJvb2xlYW4+PiBic1F1ZXVlID0gbmV3\nIFN5bmNocm9ub3VzUXVldWU8UGFpcjxCeXRlU3RyaW5nLCBCb29sZWFuPj4o\nKTsKCiAgICAgICAgU3R1Yk93bmVyc2hpcENoYW5nZUxpc3RlbmVyIGxpc3Rl\nbmVyID0gbmV3IFN0dWJPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lcihic1F1ZXVl\nKTsKCiAgICAgICAgdG0uYWRkVG9waWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5l\ncihsaXN0ZW5lcik7CgogICAgICAgIC8vIHJlZ3VsYXIgYWNxdWlyZQogICAg\nICAgIHRtLmdldE93bmVyKHRvcGljLCB0cnVlLCBhZGRyQ2JxLCBudWxsKTsK\nICAgICAgICBQYWlyPEJ5dGVTdHJpbmcsIEJvb2xlYW4+IHBhaXIgPSBic1F1\nZXVlLnRha2UoKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKHRvcGlj\nLCBwYWlyLmZpcnN0KCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRUcnVlKHBh\naXIuc2Vjb25kKCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMobWUs\nIGNoZWNrKGFkZHJDYnEudGFrZSgpKSk7CiAgICAgICAgYXNzZXJ0T3duZXJz\naGlwTm9kZUV4aXN0cygpOwoKICAgICAgICAvLyB0b3BpYyB0aGF0IEkgYWxy\nZWFkeSBvd24KICAgICAgICB0bS5nZXRPd25lcih0b3BpYywgdHJ1ZSwgYWRk\nckNicSwgbnVsbCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFscyhtZSwg\nY2hlY2soYWRkckNicS50YWtlKCkpKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0\nVHJ1ZShic1F1ZXVlLmlzRW1wdHkoKSk7CiAgICAgICAgYXNzZXJ0T3duZXJz\naGlwTm9kZUV4aXN0cygpOwoKICAgICAgICAvLyByZWd1bGFyIHJlbGVhc2UK\nICAgICAgICB0bS5yZWxlYXNlVG9waWModG9waWMsIGNiLCBudWxsKTsKICAg\nICAgICBwYWlyID0gYnNRdWV1ZS50YWtlKCk7CiAgICAgICAgQXNzZXJ0LmFz\nc2VydEVxdWFscyh0b3BpYywgcGFpci5maXJzdCgpKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0RmFsc2UocGFpci5zZWNvbmQoKSk7CiAgICAgICAgQXNzZXJ0\nLmFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBhc3NlcnRPd25l\ncnNoaXBOb2RlRG9lc250RXhpc3QoKTsKCiAgICAgICAgLy8gcmVsZWFzaW5n\nIHRvcGljIHRoYXQgSSBkb24ndCBvd24KICAgICAgICB0bS5yZWxlYXNlVG9w\naWMobWtUb3BpYygwKSwgY2IsIG51bGwpOwogICAgICAgIEFzc2VydC5hc3Nl\ncnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydFRy\ndWUoYnNRdWV1ZS5pc0VtcHR5KCkpOwoKICAgICAgICAvLyBzZXQgbGlzdGVu\nZXIgdG8gcmV0dXJuIGVycm9yCiAgICAgICAgbGlzdGVuZXIuc2V0RmFpbHVy\nZSh0cnVlKTsKCiAgICAgICAgdG0uZ2V0T3duZXIodG9waWMsIHRydWUsIGFk\nZHJDYnEsIG51bGwpOwogICAgICAgIHBhaXIgPSBic1F1ZXVlLnRha2UoKTsK\nICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKHRvcGljLCBwYWlyLmZpcnN0\nKCkpOwogICAgICAgIEFzc2VydC5hc3NlcnRUcnVlKHBhaXIuc2Vjb25kKCkp\nOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMoUHViU3ViRXhjZXB0aW9u\nLlNlcnZpY2VEb3duRXhjZXB0aW9uLmNsYXNzLCAoKENvbXBvc2l0ZUV4Y2Vw\ndGlvbikgYWRkckNicS50YWtlKCkucmlnaHQoKSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIC5nZXRFeGNlcHRpb25zKCkuaXRlcmF0b3IoKS5uZXh0\nKCkuZ2V0Q2xhc3MoKSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEZhbHNlKG51\nbGwgIT0gdG0udG9waWNzLmdldElmUHJlc2VudCh0b3BpYykpOwogICAgICAg\nIFRocmVhZC5zbGVlcCgxMDApOwogICAgICAgIGFzc2VydE93bmVyc2hpcE5v\nZGVEb2VzbnRFeGlzdCgpOwoKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3Nl\ncnRPd25lcnNoaXBOb2RlRXhpc3RzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgU3R1YkNhbGxiYWNrPFZlcnNpb25lZDxIdWJJbmZvPj4gY2FsbGJh\nY2sgPSBuZXcgU3R1YkNhbGxiYWNrPFZlcnNpb25lZDxIdWJJbmZvPj4oKTsK\nICAgICAgICB0b20ucmVhZE93bmVySW5mbyh0b3BpYywgY2FsbGJhY2ssIG51\nbGwpOwogICAgICAgIFZlcnNpb25lZDxIdWJJbmZvPiBodWJJbmZvID0gY2Fs\nbGJhY2sucXVldWUudGFrZSgpLmxlZnQoKTsKICAgICAgICBBc3NlcnQuYXNz\nZXJ0RXF1YWxzKHRtLmFkZHIsIGh1YkluZm8uZ2V0VmFsdWUoKS5nZXRBZGRy\nZXNzKCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGFzc2VydE93bmVyc2hp\ncE5vZGVEb2VzbnRFeGlzdCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIFN0dWJDYWxsYmFjazxWZXJzaW9uZWQ8SHViSW5mbz4+IGNhbGxiYWNrID0g\nbmV3IFN0dWJDYWxsYmFjazxWZXJzaW9uZWQ8SHViSW5mbz4+KCk7CiAgICAg\nICAgdG9tLnJlYWRPd25lckluZm8odG9waWMsIGNhbGxiYWNrLCBudWxsKTsK\nICAgICAgICBWZXJzaW9uZWQ8SHViSW5mbz4gaHViSW5mbyA9IGNhbGxiYWNr\nLnF1ZXVlLnRha2UoKS5sZWZ0KCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVx\ndWFscyhudWxsLCBodWJJbmZvKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFpLQ2xpZW50RGlzY29ubmVj\ndGVkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gRmlyc3QgYXNz\nZXJ0IG93bmVyc2hpcCBvZiB0aGUgdG9waWMKICAgICAgICB0bS5nZXRPd25l\ncih0b3BpYywgdHJ1ZSwgYWRkckNicSwgbnVsbCk7CiAgICAgICAgQXNzZXJ0\nLmFzc2VydEVxdWFscyhtZSwgY2hlY2soYWRkckNicS50YWtlKCkpKTsKCiAg\nICAgICAgLy8gU3VzcGVuZCB0aGUgWktUb3BpY01hbmFnZXIgYW5kIG1ha2Ug\nc3VyZSBjYWxscyB0byBnZXRPd25lciBlcnJvciBvdXQKICAgICAgICB0bS5p\nc1N1c3BlbmRlZCA9IHRydWU7CiAgICAgICAgdG0uZ2V0T3duZXIodG9waWMs\nIHRydWUsIGFkZHJDYnEsIG51bGwpOwogICAgICAgIEFzc2VydC5hc3NlcnRF\ncXVhbHMoUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uLmNs\nYXNzLCBhZGRyQ2JxLnRha2UoKS5yaWdodCgpLmdldENsYXNzKCkpOwogICAg\nICAgIC8vIFJlbGVhc2UgdGhlIHRvcGljLiBUaGlzIHNob3VsZCBub3QgZXJy\nb3Igb3V0IGV2ZW4gaWYgc3VzcGVuZGVkLgogICAgICAgIHRtLnJlbGVhc2VU\nb3BpYyh0b3BpYywgY2IsIG51bGwpOwogICAgICAgIEFzc2VydC5hc3NlcnRU\ncnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAgYXNzZXJ0T3duZXJzaGlwTm9k\nZURvZXNudEV4aXN0KCk7CgogICAgICAgIC8vIFJlc3RhcnQgdGhlIFpLVG9w\naWNNYW5hZ2VyIGFuZCBtYWtlIHN1cmUgY2FsbHMgdG8gZ2V0T3duZXIgYXJl\nIG9rYXkKICAgICAgICB0bS5pc1N1c3BlbmRlZCA9IGZhbHNlOwogICAgICAg\nIHRtLmdldE93bmVyKHRvcGljLCB0cnVlLCBhZGRyQ2JxLCBudWxsKTsKICAg\nICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG1lLCBjaGVjayhhZGRyQ2JxLnRh\na2UoKSkpOwogICAgICAgIGFzc2VydE93bmVyc2hpcE5vZGVFeGlzdHMoKTsK\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFJldGVudGlvbkFmdGVyQWNjZXNzKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgY29uZi5nZXRDb25mKCkuc2V0UHJvcGVydHkoInJldGVu\ndGlvbl9zZWNzX2FmdGVyX2FjY2VzcyIsICI1Iik7CiAgICAgICAgTU1Ub3Bp\nY01hbmFnZXIgdG0xID0gbmV3IE1NVG9waWNNYW5hZ2VyKGNvbmYsIHprLCBt\nZXRhZGF0YU1hbmFnZXJGYWN0b3J5LCBzY2hlZHVsZXIpOwogICAgICAgIHRt\nMS5nZXRPd25lcih0b3BpYywgdHJ1ZSwgYWRkckNicSwgbnVsbCk7CiAgICAg\nICAgQXNzZXJ0LmFzc2VydEVxdWFscyhtZSwgY2hlY2soYWRkckNicS50YWtl\nKCkpKTsKICAgICAgICBUaHJlYWQuc2xlZXAoNjAwMEwpOwogICAgICAgIHRt\nMS50b3BpY3MuY2xlYW5VcCgpOwogICAgICAgIFRocmVhZC5zbGVlcCgyMDAw\nTCk7CiAgICAgICAgYXNzZXJ0T3duZXJzaGlwTm9kZURvZXNudEV4aXN0KCk7\nCiAgICAgICAgdG0xLmdldE93bmVyKHRvcGljLCB0cnVlLCBhZGRyQ2JxLCBu\ndWxsKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0RXF1YWxzKG1lLCBjaGVjayhh\nZGRyQ2JxLnRha2UoKSkpOwogICAgICAgIFRocmVhZC5zbGVlcCgxMDAwTCk7\nCiAgICAgICAgdG0xLnRvcGljcy5jbGVhblVwKCk7CiAgICAgICAgVGhyZWFk\nLnNsZWVwKDIwMDBMKTsKICAgICAgICBhc3NlcnRPd25lcnNoaXBOb2RlRXhp\nc3RzKCk7CgogICAgICAgIHRtMS5zdG9wKCk7CiAgICB9CgogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RNYXhOdW1Ub3Bp\nY3MoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBjb25mLmdldENvbmYo\nKS5zZXRQcm9wZXJ0eSgibWF4X251bV90b3BpY3MiLCAiMSIpOwogICAgICAg\nIE1NVG9waWNNYW5hZ2VyIHRtMSA9IG5ldyBNTVRvcGljTWFuYWdlcihjb25m\nLCB6aywgbWV0YWRhdGFNYW5hZ2VyRmFjdG9yeSwgc2NoZWR1bGVyKTsKICAg\nICAgICB0bTEuZ2V0T3duZXIodG9waWMsIHRydWUsIGFkZHJDYnEsIG51bGwp\nOwogICAgICAgIEFzc2VydC5hc3NlcnRFcXVhbHMobWUsIGNoZWNrKGFkZHJD\nYnEudGFrZSgpKSk7CiAgICAgICAgYXNzZXJ0T3duZXJzaGlwTm9kZUV4aXN0\ncygpOwogICAgICAgIHRtMS5nZXRPd25lcihCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOCgiTWF4TnVtVG9waWMiKSwKICAgICAgICAgICAgICAgICAgICAgdHJ1\nZSwgYWRkckNicSwgbnVsbCk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEVxdWFs\ncyhtZSwgY2hlY2soYWRkckNicS50YWtlKCkpKTsKICAgICAgICBUaHJlYWQu\nc2xlZXAoMjAwMEwpOwogICAgICAgIGFzc2VydE93bmVyc2hpcE5vZGVEb2Vz\nbnRFeGlzdCgpOwogICAgICAgIHRtMS5zdG9wKCk7CiAgICB9CgoKfQo=\n","encoding":"base64"}

