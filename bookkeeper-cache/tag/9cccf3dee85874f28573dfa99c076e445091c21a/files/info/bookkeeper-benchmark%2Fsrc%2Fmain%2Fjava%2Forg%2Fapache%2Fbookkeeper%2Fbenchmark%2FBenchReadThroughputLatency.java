{"sha":"18fb5248e2dc3ccd8077ee06299798d6df6c2437","node_id":"MDQ6QmxvYjE1NzU5NTY6MThmYjUyNDhlMmRjM2NjZDgwNzdlZTA2Mjk5Nzk4ZDZkZjZjMjQzNw==","size":11488,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/18fb5248e2dc3ccd8077ee06299798d6df6c2437","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0\naGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25z\nIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICov\nCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKCmlt\ncG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlci5FdmVudDsKCmltcG9ydCBqYXZhLnV0aWwuRW51\nbWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5yZWdleC5QYXR0ZXJuOwppbXBvcnQgamF2YS51dGlsLnJlZ2V4Lk1hdGNo\nZXI7CgppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0\nY2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWlj\nSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBG\nb3JtYXR0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9wdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuT3B0aW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmU7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkNvbW1hbmRMaW5lUGFyc2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Qb3NpeFBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuUGFyc2VFeGNlcHRpb247Cgpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXJGYWN0b3J5OwoKcHVibGljIGNsYXNzIEJlbmNoUmVhZFRocm91Z2hwdXRM\nYXRlbmN5IHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9y\neS5nZXRMb2dnZXIoQmVuY2hSZWFkVGhyb3VnaHB1dExhdGVuY3kuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFBhdHRlcm4gTEVER0VSX1BB\nVFRFUk4gPSBQYXR0ZXJuLmNvbXBpbGUoIkwoWzAtOV0rKSQiKTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBDb21wYXJhdG9yPFN0cmluZz4gWktfTEVE\nR0VSX0NPTVBBUkUgPSBuZXcgQ29tcGFyYXRvcjxTdHJpbmc+KCkgewogICAg\nICAgIHB1YmxpYyBpbnQgY29tcGFyZShTdHJpbmcgbzEsIFN0cmluZyBvMikg\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgTWF0Y2hlciBt\nMSA9IExFREdFUl9QQVRURVJOLm1hdGNoZXIobzEpOwogICAgICAgICAgICAg\nICAgTWF0Y2hlciBtMiA9IExFREdFUl9QQVRURVJOLm1hdGNoZXIobzIpOwog\nICAgICAgICAgICAgICAgaWYgKG0xLmZpbmQoKSAmJiBtMi5maW5kKCkpIHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci52YWx1ZU9mKG0x\nLmdyb3VwKDEpKQogICAgICAgICAgICAgICAgICAgICAgICAtIEludGVnZXIu\ndmFsdWVPZihtMi5ncm91cCgxKSk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIHJldHVybiBvMS5jb21wYXJlVG8obzIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG8xLmNvbXBhcmVU\nbyhvMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHBy\naXZhdGUgc3RhdGljIHZvaWQgcmVhZExlZGdlcihDbGllbnRDb25maWd1cmF0\naW9uIGNvbmYsIGxvbmcgbGVkZ2VySWQsIGJ5dGVbXSBwYXNzd2QpIHsKICAg\nICAgICBMT0cuaW5mbygiUmVhZGluZyBsZWRnZXIge30iLCBsZWRnZXJJZCk7\nCiAgICAgICAgQm9va0tlZXBlciBiayA9IG51bGw7CiAgICAgICAgbG9uZyB0\naW1lID0gMDsKICAgICAgICBsb25nIGVudHJpZXNSZWFkID0gMDsKICAgICAg\nICBsb25nIGxhc3RSZWFkID0gMDsKICAgICAgICBpbnQgbm9jaGFuZ2UgPSAw\nOwoKICAgICAgICBsb25nIGFic29sdXRlTGltaXQgPSA1MDAwMDAwOwogICAg\nICAgIExlZGdlckhhbmRsZSBsaCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYmsgPSBuZXcgQm9va0tlZXBlcihjb25mKTsKICAgICAgICAg\nICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIGxoID0gYmsub3Bl\nbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIEJvb2tLZWVwZXIuRGlnZXN0\nVHlwZS5DUkMzMiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHBhc3N3ZCk7CiAgICAgICAgICAgICAgICBsb25nIGxh\nc3RDb25maXJtZWQgPSBNYXRoLm1pbihsaC5nZXRMYXN0QWRkQ29uZmlybWVk\nKCksIGFic29sdXRlTGltaXQpOwogICAgICAgICAgICAgICAgaWYgKGxhc3RD\nb25maXJtZWQgPT0gbGFzdFJlYWQpIHsKICAgICAgICAgICAgICAgICAgICBu\nb2NoYW5nZSsrOwogICAgICAgICAgICAgICAgICAgIGlmIChub2NoYW5nZSA9\nPSAxMCkgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbm9jaGFuZ2UgPSAw\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9uZyBzdGFy\ndHRpbWUgPSBTeXN0ZW0ubmFub1RpbWUoKTsKCiAgICAgICAgICAgICAgICB3\naGlsZSAobGFzdFJlYWQgPCBsYXN0Q29uZmlybWVkKSB7CiAgICAgICAgICAg\nICAgICAgICAgbG9uZyBuZXh0TGltaXQgPSBsYXN0UmVhZCArIDEwMDAwMDsK\nICAgICAgICAgICAgICAgICAgICBsb25nIHJlYWRUbyA9IE1hdGgubWluKG5l\neHRMaW1pdCwgbGFzdENvbmZpcm1lZCk7CiAgICAgICAgICAgICAgICAgICAg\nRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGVudHJpZXMgPSBsaC5yZWFkRW50\ncmllcyhsYXN0UmVhZCsxLCByZWFkVG8pOwogICAgICAgICAgICAgICAgICAg\nIGxhc3RSZWFkID0gcmVhZFRvOwogICAgICAgICAgICAgICAgICAgIHdoaWxl\nIChlbnRyaWVzLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIExlZGdlckVudHJ5IGUgPSBlbnRyaWVzLm5leHRFbGVtZW50\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXNSZWFkKys7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICgoZW50cmllc1JlYWQgJSAxMDAw\nMCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmlu\nZm8oInt9IGVudHJpZXMgcmVhZCIsIGVudHJpZXNSZWFkKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvbmcgZW5kdGltZSA9IFN5\nc3RlbS5uYW5vVGltZSgpOwogICAgICAgICAgICAgICAgdGltZSArPSBlbmR0\naW1lIC0gc3RhcnR0aW1lOwoKICAgICAgICAgICAgICAgIGxoLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICBsaCA9IG51bGw7CiAgICAgICAgICAgICAgICBU\naHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAv\nLyBpZ25vcmUKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSApIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4gcmVhZGVyIiwgZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgTE9HLmluZm8oIlJl\nYWQge30gaW4ge31tcyIsIGVudHJpZXNSZWFkLCB0aW1lLzEwMDAvMTAwMCk7\nCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGxoICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBsaC5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGJrICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBiay5jbG9zZSgpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gY2xvc2luZyBz\ndHVmZiIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIHZvaWQgdXNhZ2UoT3B0aW9ucyBvcHRpb25zKSB7\nCiAgICAgICAgSGVscEZvcm1hdHRlciBmb3JtYXR0ZXIgPSBuZXcgSGVscEZv\ncm1hdHRlcigpOwogICAgICAgIGZvcm1hdHRlci5wcmludEhlbHAoIkJlbmNo\nUmVhZFRocm91Z2hwdXRMYXRlbmN5IDxvcHRpb25zPiIsIG9wdGlvbnMpOwog\nICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJkZXByZWNhdGlvbiIpCiAg\nICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBPcHRpb25zIG9wdGlvbnMgPSBuZXcg\nT3B0aW9ucygpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJsZWRnZXIi\nLCB0cnVlLCAiTGVkZ2VyIHRvIHJlYWQuIElmIGVtcHR5LCByZWFkIGFsbCBs\nZWRnZXJzIHdoaWNoIGNvbWUgYXZhaWxhYmxlLiAiIAogICAgICAgICAgICAg\nICAgICAgICAgICAgICsgIiBDYW5ub3QgYmUgdXNlZCB3aXRoIC1saXN0ZW4i\nKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigibGlzdGVuIiwgdHJ1ZSwg\nIkxpc3RlbiBmb3IgY3JlYXRpb24gb2YgPGFyZz4gbGVkZ2VycywgYW5kIHJl\nYWQgZWFjaCBvbmUgZnVsbHkiKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlv\nbigicGFzc3dvcmQiLCB0cnVlLCAiUGFzc3dvcmQgdXNlZCB0byBhY2Nlc3Mg\nbGVkZ2VycyAoZGVmYXVsdCAnYmVuY2hQYXNzd2QnKSIpOwogICAgICAgIG9w\ndGlvbnMuYWRkT3B0aW9uKCJ6b29rZWVwZXIiLCB0cnVlLCAiWm9va2VlcGVy\nIGVuc2VtYmxlLCBkZWZhdWx0IFwibG9jYWxob3N0OjIxODFcIiIpOwogICAg\nICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJzb2NrZXR0aW1lb3V0IiwgdHJ1ZSwg\nIlNvY2tldCB0aW1lb3V0IGZvciBib29ra2VlcGVyIGNsaWVudC4gSW4gc2Vj\nb25kcy4gRGVmYXVsdCA1Iik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24o\nImhlbHAiLCBmYWxzZSwgIlRoaXMgbWVzc2FnZSIpOwoKICAgICAgICBDb21t\nYW5kTGluZVBhcnNlciBwYXJzZXIgPSBuZXcgUG9zaXhQYXJzZXIoKTsKICAg\nICAgICBDb21tYW5kTGluZSBjbWQgPSBwYXJzZXIucGFyc2Uob3B0aW9ucywg\nYXJncyk7CgogICAgICAgIGlmIChjbWQuaGFzT3B0aW9uKCJoZWxwIikpIHsK\nICAgICAgICAgICAgdXNhZ2Uob3B0aW9ucyk7CiAgICAgICAgICAgIFN5c3Rl\nbS5leGl0KC0xKTsKICAgICAgICB9CgogICAgICAgIGZpbmFsIFN0cmluZyBz\nZXJ2ZXJzID0gY21kLmdldE9wdGlvblZhbHVlKCJ6b29rZWVwZXIiLCAibG9j\nYWxob3N0OjIxODEiKTsKICAgICAgICBmaW5hbCBieXRlW10gcGFzc3dkID0g\nY21kLmdldE9wdGlvblZhbHVlKCJwYXNzd29yZCIsICJiZW5jaFBhc3N3ZCIp\nLmdldEJ5dGVzKCk7CiAgICAgICAgZmluYWwgaW50IHNvY2tUaW1lb3V0ID0g\nSW50ZWdlci52YWx1ZU9mKGNtZC5nZXRPcHRpb25WYWx1ZSgic29ja2V0dGlt\nZW91dCIsICI1IikpOwogICAgICAgIGlmIChjbWQuaGFzT3B0aW9uKCJsZWRn\nZXIiKSAmJiBjbWQuaGFzT3B0aW9uKCJsaXN0ZW4iKSkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIkNhbm5vdCB1c2VkIC1sZWRnZXIgYW5kIC1saXN0ZW4g\ndG9nZXRoZXIiKTsKICAgICAgICAgICAgdXNhZ2Uob3B0aW9ucyk7CiAgICAg\nICAgICAgIFN5c3RlbS5leGl0KC0xKTsKICAgICAgICB9CgogICAgICAgIGZp\nbmFsIEF0b21pY0ludGVnZXIgbGVkZ2VyID0gbmV3IEF0b21pY0ludGVnZXIo\nMCk7CiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBudW1MZWRnZXJzID0g\nbmV3IEF0b21pY0ludGVnZXIoMCk7CiAgICAgICAgaWYgKGNtZC5oYXNPcHRp\nb24oImxlZGdlciIpKSB7CiAgICAgICAgICAgIGxlZGdlci5zZXQoSW50ZWdl\nci52YWx1ZU9mKGNtZC5nZXRPcHRpb25WYWx1ZSgibGVkZ2VyIikpKTsKICAg\nICAgICB9IGVsc2UgaWYgKGNtZC5oYXNPcHRpb24oImxpc3RlbiIpKSB7CiAg\nICAgICAgICAgIG51bUxlZGdlcnMuc2V0KEludGVnZXIudmFsdWVPZihjbWQu\nZ2V0T3B0aW9uVmFsdWUoImxpc3RlbiIpKSk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgTE9HLmVycm9yKCJZb3UgbXVzdCB1c2UgLWxlZGdlciBv\nciAtbGlzdGVuIik7CiAgICAgICAgICAgIHVzYWdlKG9wdGlvbnMpOwogICAg\nICAgICAgICBTeXN0ZW0uZXhpdCgtMSk7CiAgICAgICAgfQoKICAgICAgICBm\naW5hbCBDb3VudERvd25MYXRjaCBzaHV0ZG93bkxhdGNoID0gbmV3IENvdW50\nRG93bkxhdGNoKDEpOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGNv\nbm5lY3RlZExhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAg\nIGZpbmFsIFN0cmluZyBub2RlcGF0aCA9IFN0cmluZy5mb3JtYXQoIi9sZWRn\nZXJzL0wlMDEwZCIsIGxlZGdlci5nZXQoKSk7CgogICAgICAgIGZpbmFsIENs\naWVudENvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBDbGllbnRDb25maWd1cmF0\naW9uKCk7CiAgICAgICAgY29uZi5zZXRSZWFkVGltZW91dChzb2NrVGltZW91\ndCkuc2V0WmtTZXJ2ZXJzKHNlcnZlcnMpOwoKCiAgICAgICAgZmluYWwgWm9v\nS2VlcGVyIHprID0gbmV3IFpvb0tlZXBlcihzZXJ2ZXJzLCAzMDAwLCBuZXcg\nV2F0Y2hlcigpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nl\nc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKGV2ZW50LmdldFN0YXRlKCkgPT0gRXZlbnQuS2VlcGVyU3RhdGUuU3lu\nY0Nvbm5lY3RlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgZXZl\nbnQuZ2V0VHlwZSgpID09IEV2ZW50LkV2ZW50VHlwZS5Ob25lKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbm5lY3RlZExhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfSk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgemsucmVn\naXN0ZXIobmV3IFdhdGNoZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChldmVudC5nZXRTdGF0ZSgpID09IEV2ZW50LktlZXBlclN0\nYXRlLlN5bmNDb25uZWN0ZWQgCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgJiYgZXZlbnQuZ2V0VHlwZSgpID09IEV2ZW50LkV2ZW50VHlwZS5O\nb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVj\ndGVkTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFR5cGUoKSA9PSBFdmVudC5FdmVu\ndFR5cGUuTm9kZUNyZWF0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgJiYgZXZlbnQuZ2V0UGF0aCgpLmVxdWFscyhub2RlcGF0\naCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkTGVk\nZ2VyKGNvbmYsIGxlZGdlci5nZXQoKSwgcGFzc3dkKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzaHV0ZG93bkxhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChldmVu\ndC5nZXRUeXBlKCkgPT0gRXZlbnQuRXZlbnRUeXBlLk5vZGVDaGlsZHJlbkNo\nYW5nZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nbnVtTGVkZ2Vycy5nZXQoKSA8IDApIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBM\naXN0PFN0cmluZz4gY2hpbGRyZW4gPSB6ay5nZXRDaGlsZHJlbigiL2xlZGdl\ncnMiLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBM\naXN0PFN0cmluZz4gbGVkZ2VycyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoU3RyaW5n\nIGNoaWxkIDogY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKExFREdFUl9QQVRURVJOLm1hdGNoZXIoY2hpbGQp\nLmZpbmQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbGVkZ2Vycy5hZGQoY2hpbGQpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENvbGxl\nY3Rpb25zLnNvcnQobGVkZ2VycywgWktfTEVER0VSX0NPTVBBUkUpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBsYXN0ID0gbGVk\nZ2Vycy5nZXQobGVkZ2Vycy5zaXplKCkgLSAxKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmaW5hbCBNYXRjaGVyIG0gPSBMRURHRVJfUEFU\nVEVSTi5tYXRjaGVyKGxhc3QpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChtLmZpbmQoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpbnQgbGVkZ2Vyc0xlZnQgPSBudW1MZWRnZXJzLmRl\nY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBUaHJlYWQgdCA9IG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICByZWFkTGVkZ2VyKGNvbmYsIExvbmcudmFsdWVPZihtLmdy\nb3VwKDEpKSwgcGFzc3dkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0LnN0YXJ0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmIChsZWRnZXJzTGVmdCA8PSAwKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaHV0ZG93bkxhdGNoLmNv\ndW50RG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJDYW50IGZpbGUgbGVkZ2VyIGlkIGluIHt9IiwgbGFzdCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBMT0cud2FybigiVW5rbm93biBldmVudCB7fSIsIGV2ZW50KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIHdhdGNoZXIi\nLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBjb25u\nZWN0ZWRMYXRjaC5hd2FpdCgpOwogICAgICAgICAgICBpZiAobGVkZ2VyLmdl\ndCgpICE9IDApIHsKICAgICAgICAgICAgICAgIGlmICh6ay5leGlzdHMobm9k\nZXBhdGgsIHRydWUpICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBy\nZWFkTGVkZ2VyKGNvbmYsIGxlZGdlci5nZXQoKSwgcGFzc3dkKTsKICAgICAg\nICAgICAgICAgICAgICBzaHV0ZG93bkxhdGNoLmNvdW50RG93bigpOwogICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBMT0cu\naW5mbygiV2F0Y2hpbmcgZm9yIGNyZWF0aW9uIG9mIiArIG5vZGVwYXRoKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIHprLmdldENoaWxkcmVuKCIvbGVkZ2VycyIsIHRydWUpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHNodXRkb3duTGF0Y2guYXdhaXQo\nKTsKICAgICAgICAgICAgTE9HLmluZm8oIlNodXR0aW5nIGRvd24iKTsKICAg\nICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICB6ay5jbG9zZSgpOwogICAg\nICAgIH0KICAgIH0KfQ==\n","encoding":"base64"}

