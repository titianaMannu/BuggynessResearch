{"sha":"953fcea946b6d088e8194cd45ca0a5f54a59324d","node_id":"MDQ6QmxvYjE1NzU5NTY6OTUzZmNlYTk0NmI2ZDA4OGU4MTk0Y2Q0NWNhMGE1ZjU0YTU5MzI0ZA==","size":23128,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/953fcea946b6d088e8194cd45ca0a5f54a59324d","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoK\naW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5C\neXRlQnVmZmVyOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5Db21w\nYXJhdG9yOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVu\ndEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMu\nQXRvbWljQm9vbGVhbjsKCmltcG9ydCBjb20uZ29vZ2xlLmNvbW1vbi51dGls\nLmNvbmN1cnJlbnQuUmF0ZUxpbWl0ZXI7CgppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmJvb2tpZS5FbnRyeUxvZ2dlci5FbnRyeUxvZ1NjYW5uZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkdhcmJhZ2VD\nb2xsZWN0b3IuR2FyYmFnZUNsZWFuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLk1hdGhVdGlsczsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlNuYXBzaG90TWFwOwppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJG\nYWN0b3J5OwoKLyoqCiAqIFRoaXMgaXMgdGhlIGdhcmJhZ2UgY29sbGVjdG9y\nIHRocmVhZCB0aGF0IHJ1bnMgaW4gdGhlIGJhY2tncm91bmQgdG8KICogcmVt\nb3ZlIGFueSBlbnRyeSBsb2cgZmlsZXMgdGhhdCBubyBsb25nZXIgY29udGFp\nbnMgYW55IGFjdGl2ZSBsZWRnZXIuCiAqLwpwdWJsaWMgY2xhc3MgR2FyYmFn\nZUNvbGxlY3RvclRocmVhZCBleHRlbmRzIFRocmVhZCB7CiAgICBwcml2YXRl\nIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRM\nb2dnZXIoR2FyYmFnZUNvbGxlY3RvclRocmVhZC5jbGFzcyk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBpbnQgU0VDT05EID0gMTAwMDsKCiAgICAvLyBN\nYXBzIGVudHJ5IGxvZyBmaWxlcyB0byB0aGUgc2V0IG9mIGxlZGdlcnMgdGhh\ndCBjb21wcmlzZSB0aGUgZmlsZSBhbmQgdGhlIHNpemUgdXNhZ2UgcGVyIGxl\nZGdlcgogICAgcHJpdmF0ZSBNYXA8TG9uZywgRW50cnlMb2dNZXRhZGF0YT4g\nZW50cnlMb2dNZXRhTWFwID0gbmV3IENvbmN1cnJlbnRIYXNoTWFwPExvbmcs\nIEVudHJ5TG9nTWV0YWRhdGE+KCk7CgogICAgLy8gVGhpcyBpcyBob3cgb2Z0\nZW4gd2Ugd2FudCB0byBydW4gdGhlIEdhcmJhZ2UgQ29sbGVjdG9yIFRocmVh\nZCAoaW4gbWlsbGlzZWNvbmRzKS4KICAgIGZpbmFsIGxvbmcgZ2NXYWl0VGlt\nZTsKCiAgICAvLyBDb21wYWN0aW9uIHBhcmFtZXRlcnMKICAgIGJvb2xlYW4g\nZW5hYmxlTWlub3JDb21wYWN0aW9uID0gZmFsc2U7CiAgICBmaW5hbCBkb3Vi\nbGUgbWlub3JDb21wYWN0aW9uVGhyZXNob2xkOwogICAgZmluYWwgbG9uZyBt\naW5vckNvbXBhY3Rpb25JbnRlcnZhbDsKCiAgICBib29sZWFuIGVuYWJsZU1h\nam9yQ29tcGFjdGlvbiA9IGZhbHNlOwogICAgZmluYWwgZG91YmxlIG1ham9y\nQ29tcGFjdGlvblRocmVzaG9sZDsKICAgIGZpbmFsIGxvbmcgbWFqb3JDb21w\nYWN0aW9uSW50ZXJ2YWw7CgogICAgbG9uZyBsYXN0TWlub3JDb21wYWN0aW9u\nVGltZTsKICAgIGxvbmcgbGFzdE1ham9yQ29tcGFjdGlvblRpbWU7CgogICAg\nZmluYWwgaW50IG1heE91dHN0YW5kaW5nUmVxdWVzdHM7CiAgICBmaW5hbCBp\nbnQgY29tcGFjdGlvblJhdGU7CiAgICBmaW5hbCBDb21wYWN0aW9uU2Nhbm5l\nckZhY3Rvcnkgc2Nhbm5lckZhY3Rvcnk7CgogICAgLy8gRW50cnkgTG9nZ2Vy\nIEhhbmRsZQogICAgZmluYWwgRW50cnlMb2dnZXIgZW50cnlMb2dnZXI7Cgog\nICAgLy8gTGVkZ2VyIENhY2hlIEhhbmRsZQogICAgZmluYWwgTGVkZ2VyQ2Fj\naGUgbGVkZ2VyQ2FjaGU7CiAgICBmaW5hbCBTbmFwc2hvdE1hcDxMb25nLCBC\nb29sZWFuPiBhY3RpdmVMZWRnZXJzOwoKICAgIC8vIGZsYWcgdG8gZW5zdXJl\nIGdjIHRocmVhZCB3aWxsIG5vdCBiZSBpbnRlcnJ1cHRlZCBkdXJpbmcgY29t\ncGFjdGlvbgogICAgLy8gdG8gcmVkdWNlIHRoZSByaXNrIGdldHRpbmcgZW50\ncnkgbG9nIGNvcnJ1cHRlZAogICAgZmluYWwgQXRvbWljQm9vbGVhbiBjb21w\nYWN0aW5nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwoKICAgIHZvbGF0\naWxlIGJvb2xlYW4gcnVubmluZyA9IHRydWU7CgogICAgLy8gdHJhY2sgdGhl\nIGxhc3Qgc2Nhbm5lZCBzdWNjZXNzZnVsbHkgbG9nIGlkCiAgICBsb25nIHNj\nYW5uZWRMb2dJZCA9IDA7CgogICAgZmluYWwgR2FyYmFnZUNvbGxlY3RvciBn\nYXJiYWdlQ29sbGVjdG9yOwogICAgZmluYWwgR2FyYmFnZUNsZWFuZXIgZ2Fy\nYmFnZUNsZWFuZXI7CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgT2Zmc2V0\nIHsKICAgICAgICBmaW5hbCBsb25nIGxlZGdlcjsKICAgICAgICBmaW5hbCBs\nb25nIGVudHJ5OwogICAgICAgIGZpbmFsIGxvbmcgb2Zmc2V0OwoKICAgICAg\nICBPZmZzZXQobG9uZyBsZWRnZXIsIGxvbmcgZW50cnksIGxvbmcgb2Zmc2V0\nKSB7CiAgICAgICAgICAgIHRoaXMubGVkZ2VyID0gbGVkZ2VyOwogICAgICAg\nICAgICB0aGlzLmVudHJ5ID0gZW50cnk7CiAgICAgICAgICAgIHRoaXMub2Zm\nc2V0ID0gb2Zmc2V0OwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEEgc2Nhbm5lciB3cmFwcGVyIHRvIGNoZWNrIHdoZXRoZXIgYSBsZWRnZXIg\naXMgYWxpdmUgaW4gYW4gZW50cnkgbG9nIGZpbGUKICAgICAqLwogICAgY2xh\nc3MgQ29tcGFjdGlvblNjYW5uZXJGYWN0b3J5IGltcGxlbWVudHMgRW50cnlM\nb2dnZXIuRW50cnlMb2dMaXN0ZW5lciB7CiAgICAgICAgTGlzdDxPZmZzZXQ+\nIG9mZnNldHMgPSBuZXcgQXJyYXlMaXN0PE9mZnNldD4oKTsKCiAgICAgICAg\nRW50cnlMb2dTY2FubmVyIG5ld1NjYW5uZXIoZmluYWwgRW50cnlMb2dNZXRh\nZGF0YSBtZXRhKSB7CiAgICAgICAgICAgIGZpbmFsIFJhdGVMaW1pdGVyIHJh\ndGVMaW1pdGVyID0gUmF0ZUxpbWl0ZXIuY3JlYXRlKGNvbXBhY3Rpb25SYXRl\nKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBFbnRyeUxvZ1NjYW5uZXIoKSB7\nCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1\nYmxpYyBib29sZWFuIGFjY2VwdChsb25nIGxlZGdlcklkKSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIG1ldGEuY29udGFpbnNMZWRnZXIobGVkZ2Vy\nSWQpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhmaW5h\nbCBsb25nIGxlZGdlcklkLCBsb25nIG9mZnNldCwgQnl0ZUJ1ZmZlciBlbnRy\neSkKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgICAgICAgICByYXRlTGltaXRlci5hY3F1aXJlKCk7\nCiAgICAgICAgICAgICAgICAgICAgc3luY2hyb25pemVkIChDb21wYWN0aW9u\nU2Nhbm5lckZhY3RvcnkudGhpcykgewogICAgICAgICAgICAgICAgICAgICAg\nICBpZiAob2Zmc2V0cy5zaXplKCkgPiBtYXhPdXRzdGFuZGluZ1JlcXVlc3Rz\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0RW50cnlsb2dG\nbHVzaGVkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgZW50cnkuZ2V0TG9uZygpOyAvLyBkaXNjYXJkIGxl\nZGdlciBpZCwgd2UgYWxyZWFkeSBoYXZlIGl0CiAgICAgICAgICAgICAgICAg\nICAgICAgIGxvbmcgZW50cnlJZCA9IGVudHJ5LmdldExvbmcoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgZW50cnkucmV3aW5kKCk7CgogICAgICAgICAg\nICAgICAgICAgICAgICBsb25nIG5ld29mZnNldCA9IGVudHJ5TG9nZ2VyLmFk\nZEVudHJ5KGxlZGdlcklkLCBlbnRyeSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGZsdXNoZWQuc2V0KGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgb2Zmc2V0cy5hZGQobmV3IE9mZnNldChsZWRnZXJJZCwgZW50cnlJZCwg\nbmV3b2Zmc2V0KSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIH0KCiAgICAgICAgQXRv\nbWljQm9vbGVhbiBmbHVzaGVkID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2Up\nOwogICAgICAgIE9iamVjdCBmbHVzaExvY2sgPSBuZXcgT2JqZWN0KCk7Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9uRW50cnlM\nb2dGbHVzaGVkKCkgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGZsdXNo\nTG9jaykgewogICAgICAgICAgICAgICAgZmx1c2hlZC5zZXQodHJ1ZSk7CiAg\nICAgICAgICAgICAgICBmbHVzaExvY2subm90aWZ5QWxsKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCBwcml2YXRl\nIHZvaWQgd2FpdEVudHJ5bG9nRmx1c2hlZCgpIHRocm93cyBJT0V4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBzeW5jaHJv\nbml6ZWQgKGZsdXNoTG9jaykgewogICAgICAgICAgICAgICAgICAgIHdoaWxl\nICghZmx1c2hlZC5nZXQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAm\nJiBlbnRyeUxvZ2dlci5pc0ZsdXNoUmVxdWlyZWQoKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAmJiBydW5uaW5nKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGZsdXNoTG9jay53YWl0KDEwMDApOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWZsdXNoZWQuZ2V0KCkK\nICAgICAgICAgICAgICAgICAgICAgICAgJiYgZW50cnlMb2dnZXIuaXNGbHVz\naFJlcXVpcmVkKCkKICAgICAgICAgICAgICAgICAgICAgICAgJiYgIXJ1bm5p\nbmcpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKCJTaHV0ZG93biBiZWZvcmUgZmx1c2hlZCIpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAg\nICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkludGVycnVwdGVk\nIHdhaXRpbmcgZm9yIGZsdXNoIiwgaWUpOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICBmb3IgKE9mZnNldCBvIDogb2Zmc2V0cykgewogICAgICAgICAg\nICAgICAgbGVkZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoby5sZWRnZXIsIG8u\nZW50cnksIG8ub2Zmc2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBv\nZmZzZXRzLmNsZWFyKCk7CiAgICAgICAgfQoKICAgICAgICBzeW5jaHJvbml6\nZWQgdm9pZCBmbHVzaCgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIHdhaXRFbnRyeWxvZ0ZsdXNoZWQoKTsKCiAgICAgICAgICAgIGxlZGdl\nckNhY2hlLmZsdXNoTGVkZ2VyKHRydWUpOwogICAgICAgIH0KICAgIH0KCgog\nICAgLyoqCiAgICAgKiBDcmVhdGUgYSBnYXJiYWdlIGNvbGxlY3RvciB0aHJl\nYWQuCiAgICAgKgogICAgICogQHBhcmFtIGNvbmYKICAgICAqICAgICAgICAg\nIFNlcnZlciBDb25maWd1cmF0aW9uIE9iamVjdC4KICAgICAqIEB0aHJvd3Mg\nSU9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIEdhcmJhZ2VDb2xsZWN0\nb3JUaHJlYWQoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgTGVkZ2VyQ2FjaGUgbGVk\nZ2VyQ2FjaGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBF\nbnRyeUxvZ2dlciBlbnRyeUxvZ2dlciwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIFNuYXBzaG90TWFwPExvbmcsIEJvb2xlYW4+IGFjdGl2\nZUxlZGdlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBM\nZWRnZXJNYW5hZ2VyIGxlZGdlck1hbmFnZXIpCiAgICAgICAgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBzdXBlcigiR2FyYmFnZUNvbGxlY3RvclRo\ncmVhZCIpOwoKICAgICAgICB0aGlzLmxlZGdlckNhY2hlID0gbGVkZ2VyQ2Fj\naGU7CiAgICAgICAgdGhpcy5lbnRyeUxvZ2dlciA9IGVudHJ5TG9nZ2VyOwog\nICAgICAgIHRoaXMuYWN0aXZlTGVkZ2VycyA9IGFjdGl2ZUxlZGdlcnM7Cgog\nICAgICAgIHRoaXMuZ2NXYWl0VGltZSA9IGNvbmYuZ2V0R2NXYWl0VGltZSgp\nOwogICAgICAgIHRoaXMubWF4T3V0c3RhbmRpbmdSZXF1ZXN0cyA9IGNvbmYu\nZ2V0Q29tcGFjdGlvbk1heE91dHN0YW5kaW5nUmVxdWVzdHMoKTsKICAgICAg\nICB0aGlzLmNvbXBhY3Rpb25SYXRlID0gY29uZi5nZXRDb21wYWN0aW9uUmF0\nZSgpOwogICAgICAgIHRoaXMuc2Nhbm5lckZhY3RvcnkgPSBuZXcgQ29tcGFj\ndGlvblNjYW5uZXJGYWN0b3J5KCk7CiAgICAgICAgZW50cnlMb2dnZXIuYWRk\nTGlzdGVuZXIodGhpcy5zY2FubmVyRmFjdG9yeSk7CgogICAgICAgIHRoaXMu\nZ2FyYmFnZUNsZWFuZXIgPSBuZXcgR2FyYmFnZUNvbGxlY3Rvci5HYXJiYWdl\nQ2xlYW5lcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIGNsZWFuKGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKExPRy5pc0Rl\nYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5k\nZWJ1ZygiZGVsZXRlIGxlZGdlciA6ICIgKyBsZWRnZXJJZCk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxlZGdlckNhY2hl\nLmRlbGV0ZUxlZGdlcihsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICB9IGNh\ndGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJFeGNlcHRpb24gd2hlbiBkZWxldGluZyB0aGUgbGVkZ2VyIGlu\nZGV4IGZpbGUgb24gdGhlIEJvb2tpZTogIiwgZSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKICAgICAgICB0aGlzLmdh\ncmJhZ2VDb2xsZWN0b3IgPSBuZXcgU2NhbkFuZENvbXBhcmVHYXJiYWdlQ29s\nbGVjdG9yKGxlZGdlck1hbmFnZXIsIGFjdGl2ZUxlZGdlcnMpOwoKICAgICAg\nICAvLyBjb21wYWN0aW9uIHBhcmFtZXRlcnMKICAgICAgICBtaW5vckNvbXBh\nY3Rpb25UaHJlc2hvbGQgPSBjb25mLmdldE1pbm9yQ29tcGFjdGlvblRocmVz\naG9sZCgpOwogICAgICAgIG1pbm9yQ29tcGFjdGlvbkludGVydmFsID0gY29u\nZi5nZXRNaW5vckNvbXBhY3Rpb25JbnRlcnZhbCgpICogU0VDT05EOwogICAg\nICAgIG1ham9yQ29tcGFjdGlvblRocmVzaG9sZCA9IGNvbmYuZ2V0TWFqb3JD\nb21wYWN0aW9uVGhyZXNob2xkKCk7CiAgICAgICAgbWFqb3JDb21wYWN0aW9u\nSW50ZXJ2YWwgPSBjb25mLmdldE1ham9yQ29tcGFjdGlvbkludGVydmFsKCkg\nKiBTRUNPTkQ7CgogICAgICAgIGlmIChtaW5vckNvbXBhY3Rpb25JbnRlcnZh\nbCA+IDAgJiYgbWlub3JDb21wYWN0aW9uVGhyZXNob2xkID4gMCkgewogICAg\nICAgICAgICBpZiAobWlub3JDb21wYWN0aW9uVGhyZXNob2xkID4gMS4wZikg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJJbnZh\nbGlkIG1pbm9yIGNvbXBhY3Rpb24gdGhyZXNob2xkICIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyBtaW5vckNvbXBhY3Rpb25UaHJl\nc2hvbGQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtaW5vckNv\nbXBhY3Rpb25JbnRlcnZhbCA8PSBnY1dhaXRUaW1lKSB7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlRvbyBzaG9ydCBtaW5vciBj\nb21wYWN0aW9uIGludGVydmFsIDogIgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIG1pbm9yQ29tcGFjdGlvbkludGVydmFsKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBlbmFibGVNaW5vckNvbXBhY3Rpb24g\nPSB0cnVlOwogICAgICAgIH0KCiAgICAgICAgaWYgKG1ham9yQ29tcGFjdGlv\nbkludGVydmFsID4gMCAmJiBtYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQgPiAw\nKSB7CiAgICAgICAgICAgIGlmIChtYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQg\nPiAxLjBmKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRp\nb24oIkludmFsaWQgbWFqb3IgY29tcGFjdGlvbiB0aHJlc2hvbGQgIgogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIG1ham9yQ29tcGFj\ndGlvblRocmVzaG9sZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKG1ham9yQ29tcGFjdGlvbkludGVydmFsIDw9IGdjV2FpdFRpbWUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiVG9vIHNob3J0\nIG1ham9yIGNvbXBhY3Rpb24gaW50ZXJ2YWwgOiAiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgbWFqb3JDb21wYWN0aW9uSW50ZXJ2\nYWwpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVuYWJsZU1ham9yQ29t\ncGFjdGlvbiA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAoZW5hYmxl\nTWlub3JDb21wYWN0aW9uICYmIGVuYWJsZU1ham9yQ29tcGFjdGlvbikgewog\nICAgICAgICAgICBpZiAobWlub3JDb21wYWN0aW9uSW50ZXJ2YWwgPj0gbWFq\nb3JDb21wYWN0aW9uSW50ZXJ2YWwgfHwKICAgICAgICAgICAgICAgIG1pbm9y\nQ29tcGFjdGlvblRocmVzaG9sZCA+PSBtYWpvckNvbXBhY3Rpb25UaHJlc2hv\nbGQpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigi\nSW52YWxpZCBtaW5vci9tYWpvciBjb21wYWN0aW9uIHNldHRpbmdzIDogbWlu\nb3IgKCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBt\naW5vckNvbXBhY3Rpb25UaHJlc2hvbGQgKyAiLCAiICsgbWlub3JDb21wYWN0\naW9uSW50ZXJ2YWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyAiKSwgbWFqb3IgKCIgKyBtYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQg\nKyAiLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nbWFqb3JDb21wYWN0aW9uSW50ZXJ2YWwgKyAiKSIpOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBMT0cuaW5mbygiTWlub3IgQ29tcGFjdGlv\nbiA6IGVuYWJsZWQ9IiArIGVuYWJsZU1pbm9yQ29tcGFjdGlvbiArICIsIHRo\ncmVzaG9sZD0iCiAgICAgICAgICAgICAgICsgbWlub3JDb21wYWN0aW9uVGhy\nZXNob2xkICsgIiwgaW50ZXJ2YWw9IiArIG1pbm9yQ29tcGFjdGlvbkludGVy\ndmFsKTsKICAgICAgICBMT0cuaW5mbygiTWFqb3IgQ29tcGFjdGlvbiA6IGVu\nYWJsZWQ9IiArIGVuYWJsZU1ham9yQ29tcGFjdGlvbiArICIsIHRocmVzaG9s\nZD0iCiAgICAgICAgICAgICAgICsgbWFqb3JDb21wYWN0aW9uVGhyZXNob2xk\nICsgIiwgaW50ZXJ2YWw9IiArIG1ham9yQ29tcGFjdGlvbkludGVydmFsKTsK\nCiAgICAgICAgbGFzdE1pbm9yQ29tcGFjdGlvblRpbWUgPSBsYXN0TWFqb3JD\nb21wYWN0aW9uVGltZSA9IE1hdGhVdGlscy5ub3coKTsKICAgIH0KCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICB3aGls\nZSAocnVubmluZykgewogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMp\nIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nd2FpdChnY1dhaXRUaW1lKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElu\ndGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBU\naHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAg\nICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBFeHRyYWN0IGFsbCBvZiB0aGUgbGVk\nZ2VyIElEJ3MgdGhhdCBjb21wcmlzZSBhbGwgb2YgdGhlIGVudHJ5IGxvZ3MK\nICAgICAgICAgICAgLy8gKGV4Y2VwdCBmb3IgdGhlIGN1cnJlbnQgbmV3IG9u\nZSB3aGljaCBpcyBzdGlsbCBiZWluZyB3cml0dGVuIHRvKS4KICAgICAgICAg\nICAgZW50cnlMb2dNZXRhTWFwID0gZXh0cmFjdE1ldGFGcm9tRW50cnlMb2dz\nKGVudHJ5TG9nTWV0YU1hcCk7CgogICAgICAgICAgICAvLyBnYyBpbmFjdGl2\nZS9kZWxldGVkIGxlZGdlcnMKICAgICAgICAgICAgZG9HY0xlZGdlcnMoKTsK\nCiAgICAgICAgICAgIC8vIGdjIGVudHJ5IGxvZ3MKICAgICAgICAgICAgZG9H\nY0VudHJ5TG9ncygpOwoKICAgICAgICAgICAgbG9uZyBjdXJUaW1lID0gTWF0\naFV0aWxzLm5vdygpOwogICAgICAgICAgICBpZiAoZW5hYmxlTWFqb3JDb21w\nYWN0aW9uICYmCiAgICAgICAgICAgICAgICBjdXJUaW1lIC0gbGFzdE1ham9y\nQ29tcGFjdGlvblRpbWUgPiBtYWpvckNvbXBhY3Rpb25JbnRlcnZhbCkgewog\nICAgICAgICAgICAgICAgLy8gZW50ZXIgbWFqb3IgY29tcGFjdGlvbgogICAg\nICAgICAgICAgICAgTE9HLmluZm8oIkVudGVyIG1ham9yIGNvbXBhY3Rpb24i\nKTsKICAgICAgICAgICAgICAgIGRvQ29tcGFjdEVudHJ5TG9ncyhtYWpvckNv\nbXBhY3Rpb25UaHJlc2hvbGQpOwogICAgICAgICAgICAgICAgbGFzdE1ham9y\nQ29tcGFjdGlvblRpbWUgPSBNYXRoVXRpbHMubm93KCk7CiAgICAgICAgICAg\nICAgICAvLyBhbHNvIG1vdmUgbWlub3IgY29tcGFjdGlvbiB0aW1lCiAgICAg\nICAgICAgICAgICBsYXN0TWlub3JDb21wYWN0aW9uVGltZSA9IGxhc3RNYWpv\nckNvbXBhY3Rpb25UaW1lOwogICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlbmFibGVNaW5vckNvbXBh\nY3Rpb24gJiYKICAgICAgICAgICAgICAgIGN1clRpbWUgLSBsYXN0TWlub3JD\nb21wYWN0aW9uVGltZSA+IG1pbm9yQ29tcGFjdGlvbkludGVydmFsKSB7CiAg\nICAgICAgICAgICAgICAvLyBlbnRlciBtaW5vciBjb21wYWN0aW9uCiAgICAg\nICAgICAgICAgICBMT0cuaW5mbygiRW50ZXIgbWlub3IgY29tcGFjdGlvbiIp\nOwogICAgICAgICAgICAgICAgZG9Db21wYWN0RW50cnlMb2dzKG1pbm9yQ29t\ncGFjdGlvblRocmVzaG9sZCk7CiAgICAgICAgICAgICAgICBsYXN0TWlub3JD\nb21wYWN0aW9uVGltZSA9IE1hdGhVdGlscy5ub3coKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERvIGdhcmJhZ2Ug\nY29sbGVjdGlvbiBsZWRnZXIgaW5kZXggZmlsZXMKICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGRvR2NMZWRnZXJzKCkgewogICAgICAgIGdhcmJhZ2VDb2xs\nZWN0b3IuZ2MoZ2FyYmFnZUNsZWFuZXIpOwogICAgfQoKICAgIC8qKgogICAg\nICogR2FyYmFnZSBjb2xsZWN0IHRob3NlIGVudHJ5IGxvZ2dlcnMgd2hpY2gg\nYXJlIG5vdCBhc3NvY2lhdGVkIHdpdGggYW55IGFjdGl2ZSBsZWRnZXJzCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBkb0djRW50cnlMb2dzKCkgewogICAg\nICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgb2YgdGhlIGVudHJ5IGxvZ3MgYW5k\nIHJlbW92ZSB0aGUgbm9uLWFjdGl2ZSBsZWRnZXJzLgogICAgICAgIGZvciAo\nTG9uZyBlbnRyeUxvZ0lkIDogZW50cnlMb2dNZXRhTWFwLmtleVNldCgpKSB7\nCiAgICAgICAgICAgIEVudHJ5TG9nTWV0YWRhdGEgbWV0YSA9IGVudHJ5TG9n\nTWV0YU1hcC5nZXQoZW50cnlMb2dJZCk7CiAgICAgICAgICAgIGZvciAoTG9u\nZyBlbnRyeUxvZ0xlZGdlciA6IG1ldGEubGVkZ2Vyc01hcC5rZXlTZXQoKSkg\newogICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBlbnRyeSBsb2cgbGVk\nZ2VyIGZyb20gdGhlIHNldCBpZiBpdCBpc24ndCBhY3RpdmUuCiAgICAgICAg\nICAgICAgICBpZiAoIWFjdGl2ZUxlZGdlcnMuY29udGFpbnNLZXkoZW50cnlM\nb2dMZWRnZXIpKSB7CiAgICAgICAgICAgICAgICAgICAgbWV0YS5yZW1vdmVM\nZWRnZXIoZW50cnlMb2dMZWRnZXIpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmIChtZXRhLmlzRW1wdHkoKSkgewog\nICAgICAgICAgICAgICAgLy8gVGhpcyBtZWFucyB0aGUgZW50cnkgbG9nIGlz\nIG5vdCBhc3NvY2lhdGVkIHdpdGggYW55IGFjdGl2ZSBsZWRnZXJzIGFueW1v\ncmUuCiAgICAgICAgICAgICAgICAvLyBXZSBjYW4gcmVtb3ZlIHRoaXMgZW50\ncnkgbG9nIGZpbGUgbm93LgogICAgICAgICAgICAgICAgTE9HLmluZm8oIkRl\nbGV0aW5nIGVudHJ5TG9nSWQgIiArIGVudHJ5TG9nSWQgKyAiIGFzIGl0IGhh\ncyBubyBhY3RpdmUgbGVkZ2VycyEiKTsKICAgICAgICAgICAgICAgIHJlbW92\nZUVudHJ5TG9nKGVudHJ5TG9nSWQpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFjdCBlbnRyeSBsb2dzIGlm\nIG5lY2Vzc2FyeS4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIENvbXBhY3Rp\nb24gd2lsbCBiZSBleGVjdXRlZCBmcm9tIGxvdyB1bnVzZWQgc3BhY2UgdG8g\naGlnaCB1bnVzZWQgc3BhY2UuCiAgICAgKiBUaG9zZSBlbnRyeSBsb2cgZmls\nZXMgd2hvc2UgcmVtYWluaW5nIHNpemUgcGVyY2VudGFnZSBpcyBoaWdoZXIg\ndGhhbiB0aHJlc2hvbGQKICAgICAqIHdvdWxkIG5vdCBiZSBjb21wYWN0ZWQu\nCiAgICAgKiA8L3A+CiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBkb0NvbXBh\nY3RFbnRyeUxvZ3MoZG91YmxlIHRocmVzaG9sZCkgewogICAgICAgIExPRy5p\nbmZvKCJEbyBjb21wYWN0aW9uIHRvIGNvbXBhY3QgdGhvc2UgZmlsZXMgbG93\nZXIgdGhhbiAiICsgdGhyZXNob2xkKTsKICAgICAgICAvLyBzb3J0IHRoZSBs\nZWRnZXIgbWV0YSBieSBvY2N1cGllZCB1bnVzZWQgc3BhY2UKICAgICAgICBD\nb21wYXJhdG9yPEVudHJ5TG9nTWV0YWRhdGE+IHNpemVDb21wYXJhdG9yID0g\nbmV3IENvbXBhcmF0b3I8RW50cnlMb2dNZXRhZGF0YT4oKSB7CiAgICAgICAg\nICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgaW50IGNvbXBhcmUo\nRW50cnlMb2dNZXRhZGF0YSBtMSwgRW50cnlMb2dNZXRhZGF0YSBtMikgewog\nICAgICAgICAgICAgICAgbG9uZyB1bnVzZWRTaXplMSA9IG0xLnRvdGFsU2l6\nZSAtIG0xLnJlbWFpbmluZ1NpemU7CiAgICAgICAgICAgICAgICBsb25nIHVu\ndXNlZFNpemUyID0gbTIudG90YWxTaXplIC0gbTIucmVtYWluaW5nU2l6ZTsK\nICAgICAgICAgICAgICAgIGlmICh1bnVzZWRTaXplMSA+IHVudXNlZFNpemUy\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgICAg\nICAgICAgfSBlbHNlIGlmICh1bnVzZWRTaXplMSA8IHVudXNlZFNpemUyKSB7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAwOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAg\nICBMaXN0PEVudHJ5TG9nTWV0YWRhdGE+IGxvZ3NUb0NvbXBhY3QgPSBuZXcg\nQXJyYXlMaXN0PEVudHJ5TG9nTWV0YWRhdGE+KCk7CiAgICAgICAgbG9nc1Rv\nQ29tcGFjdC5hZGRBbGwoZW50cnlMb2dNZXRhTWFwLnZhbHVlcygpKTsKICAg\nICAgICBDb2xsZWN0aW9ucy5zb3J0KGxvZ3NUb0NvbXBhY3QsIHNpemVDb21w\nYXJhdG9yKTsKICAgICAgICBMaXN0PExvbmc+IHRvUmVtb3ZlID0gbmV3IEFy\ncmF5TGlzdDxMb25nPigpOwoKICAgICAgICBmb3IgKEVudHJ5TG9nTWV0YWRh\ndGEgbWV0YSA6IGxvZ3NUb0NvbXBhY3QpIHsKICAgICAgICAgICAgaWYgKG1l\ndGEuZ2V0VXNhZ2UoKSA+PSB0aHJlc2hvbGQpIHsKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExPRy5kZWJ1Zygi\nQ29tcGFjdGluZyBlbnRyeSBsb2cge30gYmVsb3cgdGhyZXNob2xkIHt9LiIs\nIG1ldGEuZW50cnlMb2dJZCwgdGhyZXNob2xkKTsKICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGNvbXBhY3RFbnRyeUxvZyhzY2FubmVyRmFj\ndG9yeSwgbWV0YSk7CiAgICAgICAgICAgICAgICB0b1JlbW92ZS5hZGQobWV0\nYS5lbnRyeUxvZ0lkKTsKICAgICAgICAgICAgfSBjYXRjaCAoTGVkZ2VyRGly\nc01hbmFnZXIuTm9Xcml0YWJsZUxlZGdlckRpckV4Y2VwdGlvbiBud2xkZSkg\newogICAgICAgICAgICAgICAgTE9HLndhcm4oIk5vIHdyaXRhYmxlIGxlZGdl\nciBkaXJlY3RvcnkgYXZhaWxhYmxlLCBhYm9ydGluZyBjb21wYWN0aW9uIiwg\nbndsZGUpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgLy8g\naWYgY29tcGFjdCBlbnRyeSBsb2cgdGhyb3dzIElPRXhjZXB0aW9uLCB3ZSBk\nb24ndCB3YW50IHRvIHJlbW92ZSB0aGF0CiAgICAgICAgICAgICAgICAvLyBl\nbnRyeSBsb2cuIGhvd2V2ZXIsIGlmIHNvbWUgZW50cmllcyBmcm9tIHRoYXQg\nbG9nIGhhdmUgYmVlbiByZWFkZGVkCiAgICAgICAgICAgICAgICAvLyB0byB0\naGUgZW50cnkgbG9nLCBhbmQgdGhlIG9mZnNldCB1cGRhdGVkLCBpdCdzIG9r\nIHRvIGZsdXNoIHRoYXQKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJy\nb3IgY29tcGFjdGluZyBlbnRyeSBsb2cuIExvZyB3b24ndCBiZSBkZWxldGVk\nIiwgaW9lKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCFydW5u\naW5nKSB7IC8vIGlmIGdjIHRocmVhZCBpcyBub3QgcnVubmluZywgc3RvcCBj\nb21wYWN0aW9uCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gY29t\ncGFjdGlvbiBmaW5pc2hlZCwgZmx1c2ggYW55IG91dHN0YW5kaW5nIG9mZnNl\ndHMKICAgICAgICAgICAgc2Nhbm5lckZhY3RvcnkuZmx1c2goKTsKICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJDYW5ub3QgZmx1c2ggY29tcGFjdGVkIGVudHJpZXMsIHNraXAg\ncmVtb3ZhbCIsIGlvZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nCgogICAgICAgIC8vIG9mZnNldHMgaGF2ZSBiZWVuIGZsdXNoZWQsIGl0cyBu\nb3cgc2FmZSB0byByZW1vdmUgdGhlIG9sZCBlbnRyeWxvZ3MKICAgICAgICBm\nb3IgKExvbmcgbCA6IHRvUmVtb3ZlKSB7CiAgICAgICAgICAgIHJlbW92ZUVu\ndHJ5TG9nKGwpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNo\ndXRkb3duIHRoZSBnYXJiYWdlIGNvbGxlY3RvciB0aHJlYWQuCiAgICAgKgog\nICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZiB0aGVyZSBp\ncyBhbiBleGNlcHRpb24gc3RvcHBpbmcgZ2MgdGhyZWFkLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzaHV0ZG93bigpIHRocm93cyBJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiB7CiAgICAgICAgdGhpcy5ydW5uaW5nID0gZmFsc2U7CiAgICAg\nICAgaWYgKGNvbXBhY3RpbmcuY29tcGFyZUFuZFNldChmYWxzZSwgdHJ1ZSkp\nIHsKICAgICAgICAgICAgLy8gaWYgc2V0dGluZyBjb21wYWN0aW5nIGZsYWcg\nc3VjY2VlZCwgbWVhbnMgZ2NUaHJlYWQgaXMgbm90IGNvbXBhY3Rpbmcgbm93\nCiAgICAgICAgICAgIC8vIGl0IGlzIHNhZmUgdG8gaW50ZXJydXB0IGl0c2Vs\nZiBub3cKICAgICAgICAgICAgdGhpcy5pbnRlcnJ1cHQoKTsKICAgICAgICB9\nCiAgICAgICAgdGhpcy5qb2luKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZW1vdmUgZW50cnkgbG9nLgogICAgICoKICAgICAqIEBwYXJhbSBlbnRyeUxv\nZ0lkCiAgICAgKiAgICAgICAgICBFbnRyeSBMb2cgRmlsZSBJZAogICAgICov\nCiAgICBwcml2YXRlIHZvaWQgcmVtb3ZlRW50cnlMb2cobG9uZyBlbnRyeUxv\nZ0lkKSB7CiAgICAgICAgLy8gcmVtb3ZlIGVudHJ5IGxvZyBmaWxlIHN1Y2Nl\nc3NmdWxseQogICAgICAgIGlmIChlbnRyeUxvZ2dlci5yZW1vdmVFbnRyeUxv\nZyhlbnRyeUxvZ0lkKSkgewogICAgICAgICAgICBlbnRyeUxvZ01ldGFNYXAu\ncmVtb3ZlKGVudHJ5TG9nSWQpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENvbXBhY3QgYW4gZW50cnkgbG9nLgogICAgICoKICAgICAqIEBw\nYXJhbSBlbnRyeUxvZ0lkCiAgICAgKiAgICAgICAgICBFbnRyeSBMb2cgRmls\nZSBJZAogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjb21wYWN0RW50cnlM\nb2coQ29tcGFjdGlvblNjYW5uZXJGYWN0b3J5IHNjYW5uZXJGYWN0b3J5LAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEVudHJ5TG9nTWV0\nYWRhdGEgZW50cnlMb2dNZXRhKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIC8vIFNpbWlsYXIgd2l0aCBTeW5jIFRocmVhZAogICAgICAgIC8vIHRy\neSB0byBtYXJrIGNvbXBhY3RpbmcgZmxhZyB0byBtYWtlIHN1cmUgaXQgd291\nbGQgbm90IGJlIGludGVycnVwdGVkCiAgICAgICAgLy8gYnkgc2h1dGRvd24g\nZHVyaW5nIGNvbXBhY3Rpb24uIG90aGVyd2lzZSBpdCB3aWxsIHJlY2VpdmUK\nICAgICAgICAvLyBDbG9zZWRCeUludGVycnVwdEV4Y2VwdGlvbiB3aGljaCBt\nYXkgY2F1c2UgaW5kZXggZmlsZSAmIGVudHJ5IGxvZ2dlcgogICAgICAgIC8v\nIGNsb3NlZCBhbmQgY29ycnVwdGVkLgogICAgICAgIGlmICghY29tcGFjdGlu\nZy5jb21wYXJlQW5kU2V0KGZhbHNlLCB0cnVlKSkgewogICAgICAgICAgICAv\nLyBzZXQgY29tcGFjdGluZyBmbGFnIGZhaWxlZCwgbWVhbnMgY29tcGFjdGlu\nZyBpcyB0cnVlIG5vdwogICAgICAgICAgICAvLyBpbmRpY2F0ZXMgYW5vdGhl\nciB0aHJlYWQgd2FudHMgdG8gaW50ZXJydXB0IGdjIHRocmVhZCB0byBleGl0\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIExPRy5p\nbmZvKCJDb21wYWN0aW5nIGVudHJ5IGxvZyA6IHt9IiwgZW50cnlMb2dNZXRh\nLmVudHJ5TG9nSWQpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBlbnRy\neUxvZ2dlci5zY2FuRW50cnlMb2coZW50cnlMb2dNZXRhLmVudHJ5TG9nSWQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FubmVy\nRmFjdG9yeS5uZXdTY2FubmVyKGVudHJ5TG9nTWV0YSkpOwogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIC8vIGNsZWFyIGNvbXBhY3RpbmcgZmxh\nZwogICAgICAgICAgICBjb21wYWN0aW5nLnNldChmYWxzZSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogUmVjb3JkcyB0aGUgdG90YWwgc2l6\nZSwgcmVtYWluaW5nIHNpemUgYW5kIHRoZSBzZXQgb2YgbGVkZ2VycyB0aGF0\nIGNvbXByaXNlIGEgZW50cnkgbG9nLgogICAgICovCiAgICBzdGF0aWMgY2xh\nc3MgRW50cnlMb2dNZXRhZGF0YSB7CiAgICAgICAgbG9uZyBlbnRyeUxvZ0lk\nOwogICAgICAgIGxvbmcgdG90YWxTaXplOwogICAgICAgIGxvbmcgcmVtYWlu\naW5nU2l6ZTsKICAgICAgICBDb25jdXJyZW50SGFzaE1hcDxMb25nLCBMb25n\nPiBsZWRnZXJzTWFwOwoKICAgICAgICBwdWJsaWMgRW50cnlMb2dNZXRhZGF0\nYShsb25nIGxvZ0lkKSB7CiAgICAgICAgICAgIHRoaXMuZW50cnlMb2dJZCA9\nIGxvZ0lkOwoKICAgICAgICAgICAgdG90YWxTaXplID0gcmVtYWluaW5nU2l6\nZSA9IDA7CiAgICAgICAgICAgIGxlZGdlcnNNYXAgPSBuZXcgQ29uY3VycmVu\ndEhhc2hNYXA8TG9uZywgTG9uZz4oKTsKICAgICAgICB9CgogICAgICAgIHB1\nYmxpYyB2b2lkIGFkZExlZGdlclNpemUobG9uZyBsZWRnZXJJZCwgbG9uZyBz\naXplKSB7CiAgICAgICAgICAgIHRvdGFsU2l6ZSArPSBzaXplOwogICAgICAg\nICAgICByZW1haW5pbmdTaXplICs9IHNpemU7CiAgICAgICAgICAgIExvbmcg\nbGVkZ2VyU2l6ZSA9IGxlZGdlcnNNYXAuZ2V0KGxlZGdlcklkKTsKICAgICAg\nICAgICAgaWYgKG51bGwgPT0gbGVkZ2VyU2l6ZSkgewogICAgICAgICAgICAg\nICAgbGVkZ2VyU2l6ZSA9IDBMOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGxlZGdlclNpemUgKz0gc2l6ZTsKICAgICAgICAgICAgbGVkZ2Vyc01hcC5w\ndXQobGVkZ2VySWQsIGxlZGdlclNpemUpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgcmVtb3ZlTGVkZ2VyKGxvbmcgbGVkZ2VySWQpIHsKICAg\nICAgICAgICAgTG9uZyBzaXplID0gbGVkZ2Vyc01hcC5yZW1vdmUobGVkZ2Vy\nSWQpOwogICAgICAgICAgICBpZiAobnVsbCA9PSBzaXplKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmVt\nYWluaW5nU2l6ZSAtPSBzaXplOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gY29udGFpbnNMZWRnZXIobG9uZyBsZWRnZXJJZCkgewogICAg\nICAgICAgICByZXR1cm4gbGVkZ2Vyc01hcC5jb250YWluc0tleShsZWRnZXJJ\nZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgZG91YmxlIGdldFVzYWdl\nKCkgewogICAgICAgICAgICBpZiAodG90YWxTaXplID09IDBMKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gMC4wZjsKICAgICAgICAgICAgfQogICAgICAg\nICAgICByZXR1cm4gKGRvdWJsZSlyZW1haW5pbmdTaXplIC8gdG90YWxTaXpl\nOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGJvb2xlYW4gaXNFbXB0eSgp\nIHsKICAgICAgICAgICAgcmV0dXJuIGxlZGdlcnNNYXAuaXNFbXB0eSgpOwog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0\ncmluZyB0b1N0cmluZygpIHsKICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBz\nYiA9IG5ldyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgICAgIHNiLmFwcGVu\nZCgieyB0b3RhbFNpemUgPSAiKS5hcHBlbmQodG90YWxTaXplKS5hcHBlbmQo\nIiwgcmVtYWluaW5nU2l6ZSA9ICIpCiAgICAgICAgICAgICAgLmFwcGVuZChy\nZW1haW5pbmdTaXplKS5hcHBlbmQoIiwgbGVkZ2Vyc01hcCA9ICIpLmFwcGVu\nZChsZWRnZXJzTWFwKS5hcHBlbmQoIiB9Iik7CiAgICAgICAgICAgIHJldHVy\nbiBzYi50b1N0cmluZygpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIEEgc2Nhbm5lciB1c2VkIHRvIGV4dHJhY3QgZW50cnkgbG9nIG1ldGEg\nZnJvbSBlbnRyeSBsb2cgZmlsZXMuCiAgICAgKi8KICAgIHN0YXRpYyBjbGFz\ncyBFeHRyYWN0aW9uU2Nhbm5lciBpbXBsZW1lbnRzIEVudHJ5TG9nU2Nhbm5l\nciB7CiAgICAgICAgRW50cnlMb2dNZXRhZGF0YSBtZXRhOwoKICAgICAgICBw\ndWJsaWMgRXh0cmFjdGlvblNjYW5uZXIoRW50cnlMb2dNZXRhZGF0YSBtZXRh\nKSB7CiAgICAgICAgICAgIHRoaXMubWV0YSA9IG1ldGE7CiAgICAgICAgfQoK\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBhY2Nl\ncHQobG9uZyBsZWRnZXJJZCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsK\nICAgICAgICB9CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgcHJvY2Vzcyhsb25nIGxlZGdlcklkLCBsb25nIG9mZnNldCwgQnl0ZUJ1\nZmZlciBlbnRyeSkgewogICAgICAgICAgICAvLyBhZGQgbmV3IGVudHJ5IHNp\nemUgb2YgYSBsZWRnZXIgdG8gZW50cnkgbG9nIG1ldGEKICAgICAgICAgICAg\nbWV0YS5hZGRMZWRnZXJTaXplKGxlZGdlcklkLCBlbnRyeS5saW1pdCgpICsg\nNCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRv\nIHJlYWQgaW4gYWxsIG9mIHRoZSBlbnRyeSBsb2dzICh0aG9zZSB0aGF0IHdl\nIGhhdmVuJ3QgZG9uZSBzbyB5ZXQpLAogICAgICogYW5kIGZpbmQgdGhlIHNl\ndCBvZiBsZWRnZXIgSUQncyB0aGF0IG1ha2UgdXAgZWFjaCBlbnRyeSBsb2cg\nZmlsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZW50cnlMb2dNZXRhTWFwCiAg\nICAgKiAgICAgICAgICBFeGlzdGluZyBFbnRyeUxvZ3MgdG8gTWV0YQogICAg\nICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAgICovCiAgICBwcm90ZWN0ZWQg\nTWFwPExvbmcsIEVudHJ5TG9nTWV0YWRhdGE+IGV4dHJhY3RNZXRhRnJvbUVu\ndHJ5TG9ncyhNYXA8TG9uZywgRW50cnlMb2dNZXRhZGF0YT4gZW50cnlMb2dN\nZXRhTWFwKSB7CiAgICAgICAgLy8gRXh0cmFjdCBpdCBmb3IgZXZlcnkgZW50\ncnkgbG9nIGV4Y2VwdCBmb3IgdGhlIGN1cnJlbnQgb25lLgogICAgICAgIC8v\nIEVudHJ5IExvZyBJRCdzIGFyZSBqdXN0IGEgbG9uZyB2YWx1ZSB0aGF0IHN0\nYXJ0cyBhdCAwIGFuZCBpbmNyZW1lbnRzCiAgICAgICAgLy8gYnkgMSB3aGVu\nIHRoZSBsb2cgZmlsbHMgdXAgYW5kIHdlIHJvbGwgdG8gYSBuZXcgb25lLgog\nICAgICAgIGxvbmcgY3VyTG9nSWQgPSBlbnRyeUxvZ2dlci5nZXRDdXJyZW50\nTG9nSWQoKTsKICAgICAgICBib29sZWFuIGhhc0V4Y2VwdGlvbldoZW5TY2Fu\nID0gZmFsc2U7CiAgICAgICAgZm9yIChsb25nIGVudHJ5TG9nSWQgPSBzY2Fu\nbmVkTG9nSWQ7IGVudHJ5TG9nSWQgPCBjdXJMb2dJZDsgZW50cnlMb2dJZCsr\nKSB7CiAgICAgICAgICAgIC8vIENvbWIgdGhlIGN1cnJlbnQgZW50cnkgbG9n\nIGZpbGUgaWYgaXQgaGFzIG5vdCBhbHJlYWR5IGJlZW4gZXh0cmFjdGVkLgog\nICAgICAgICAgICBpZiAoZW50cnlMb2dNZXRhTWFwLmNvbnRhaW5zS2V5KGVu\ndHJ5TG9nSWQpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciBsb2cgZmls\nZSBleGlzdHMgb3Igbm90CiAgICAgICAgICAgIC8vIGlmIGl0IGRvZXNuJ3Qg\nZXhpc3QsIHRoaXMgbG9nIGZpbGUgbWlnaHQgaGF2ZSBiZWVuIGdhcmJhZ2Ug\nY29sbGVjdGVkLgogICAgICAgICAgICBpZiAoIWVudHJ5TG9nZ2VyLmxvZ0V4\naXN0cyhlbnRyeUxvZ0lkKSkgewogICAgICAgICAgICAgICAgY29udGludWU7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5pbmZvKCJFeHRyYWN0\naW5nIGVudHJ5IGxvZyBtZXRhIGZyb20gZW50cnlMb2dJZDoge30iLCBlbnRy\neUxvZ0lkKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAv\nLyBSZWFkIHRocm91Z2ggdGhlIGVudHJ5IGxvZyBmaWxlIGFuZCBleHRyYWN0\nIHRoZSBlbnRyeSBsb2cgbWV0YQogICAgICAgICAgICAgICAgRW50cnlMb2dN\nZXRhZGF0YSBlbnRyeUxvZ01ldGEgPSBleHRyYWN0TWV0YUZyb21FbnRyeUxv\nZyhlbnRyeUxvZ2dlciwgZW50cnlMb2dJZCk7CiAgICAgICAgICAgICAgICBl\nbnRyeUxvZ01ldGFNYXAucHV0KGVudHJ5TG9nSWQsIGVudHJ5TG9nTWV0YSk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgIGhhc0V4Y2VwdGlvbldoZW5TY2FuID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgIExPRy53YXJuKCJQcmVtYXR1cmUgZXhjZXB0aW9uIHdoZW4g\ncHJvY2Vzc2luZyAiICsgZW50cnlMb2dJZCArCiAgICAgICAgICAgICAgICAg\nICAgICAgICAiIHJlY292ZXJ5IHdpbGwgdGFrZSBjYXJlIG9mIHRoZSBwcm9i\nbGVtIiwgZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGlmIHNj\nYW4gZmFpbGVkIG9uIHNvbWUgZW50cnkgbG9nLCB3ZSBkb24ndCBtb3ZlICdz\nY2FubmVkTG9nSWQnIHRvIG5leHQgaWQKICAgICAgICAgICAgLy8gaWYgc2Nh\nbiBzdWNjZWVkLCB3ZSBkb24ndCBuZWVkIHRvIHNjYW4gaXQgYWdhaW4gZHVy\naW5nIG5leHQgZ2MgcnVuLAogICAgICAgICAgICAvLyB3ZSBtb3ZlICdzY2Fu\nbmVkTG9nSWQnIHRvIG5leHQgaWQKICAgICAgICAgICAgaWYgKCFoYXNFeGNl\ncHRpb25XaGVuU2NhbikgewogICAgICAgICAgICAgICAgKytzY2FubmVkTG9n\nSWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGVu\ndHJ5TG9nTWV0YU1hcDsKICAgIH0KCiAgICBzdGF0aWMgRW50cnlMb2dNZXRh\nZGF0YSBleHRyYWN0TWV0YUZyb21FbnRyeUxvZyhFbnRyeUxvZ2dlciBlbnRy\neUxvZ2dlciwgbG9uZyBlbnRyeUxvZ0lkKQogICAgICAgICAgICB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIEVudHJ5TG9nTWV0YWRhdGEgZW50cnlM\nb2dNZXRhID0gbmV3IEVudHJ5TG9nTWV0YWRhdGEoZW50cnlMb2dJZCk7CiAg\nICAgICAgRXh0cmFjdGlvblNjYW5uZXIgc2Nhbm5lciA9IG5ldyBFeHRyYWN0\naW9uU2Nhbm5lcihlbnRyeUxvZ01ldGEpOwogICAgICAgIC8vIFJlYWQgdGhy\nb3VnaCB0aGUgZW50cnkgbG9nIGZpbGUgYW5kIGV4dHJhY3QgdGhlIGVudHJ5\nIGxvZyBtZXRhCiAgICAgICAgZW50cnlMb2dnZXIuc2NhbkVudHJ5TG9nKGVu\ndHJ5TG9nSWQsIHNjYW5uZXIpOwogICAgICAgIExPRy5kZWJ1ZygiUmV0cmll\ndmVkIGVudHJ5IGxvZyBtZXRhIGRhdGEgZW50cnlMb2dJZDoge30sIG1ldGE6\nIHt9IiwKICAgICAgICAgICAgICAgICAgZW50cnlMb2dJZCwgZW50cnlMb2dN\nZXRhKTsKICAgICAgICByZXR1cm4gZW50cnlMb2dNZXRhOwogICAgfQp9Cg==\n","encoding":"base64"}

