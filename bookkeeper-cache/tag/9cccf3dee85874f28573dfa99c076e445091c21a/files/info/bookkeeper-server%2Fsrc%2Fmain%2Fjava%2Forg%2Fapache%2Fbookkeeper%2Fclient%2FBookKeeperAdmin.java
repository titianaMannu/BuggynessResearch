{"sha":"fea01c6af301b881556a7b1e50ff97e8d7b5e494","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmVhMDFjNmFmMzAxYjg4MTU1NmE3YjFlNTBmZjk3ZThkN2I1ZTQ5NA==","size":38264,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/fea01c6af301b881556a7b1e50ff97e8d7b5e494","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGph\ndmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFw\nOwppbXBvcnQgamF2YS51dGlsLk5vU3VjaEVsZW1lbnRFeGNlcHRpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2YS51dGlsLlVVSUQ7\nCgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0Nh\nbGxiYWNrLk9wZW5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5SZWNvdmVyQ2FsbGJhY2s7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIu\nU3luY09wZW5DYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuTGVkZ2VyRnJhZ21lbnRSZXBsaWNhdG9yLlNpbmdsZUZyYWdt\nZW50Q2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29u\nZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdlci5MZWRnZXJSYW5nZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdlck1hbmFnZXIuTGVk\nZ2VyUmFuZ2VJdGVyYXRvcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuTXVsdGlDYWxs\nYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29r\na2VlcGVySW50ZXJuYWxDYWxsYmFja3MuUHJvY2Vzc29yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuQm9va0tlZXBlckNvbnN0YW50czsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLklPVXRpbHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5aa1V0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnpvb2tlZXBlci5ab29LZWVwZXJX\nYXRjaGVyQmFzZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkFzeW5j\nQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5DcmVhdGVN\nb2RlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWktVdGlsOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uLkNvZGU7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29EZWZzLklkczsKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9y\neTsKCi8qKgogKiBBZG1pbiBjbGllbnQgZm9yIEJvb2tLZWVwZXIgY2x1c3Rl\ncnMKICovCnB1YmxpYyBjbGFzcyBCb29rS2VlcGVyQWRtaW4gewogICAgcHJp\ndmF0ZSBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9n\nZ2VyKEJvb2tLZWVwZXJBZG1pbi5jbGFzcyk7CiAgICAvLyBaSyBjbGllbnQg\naW5zdGFuY2UKICAgIHByaXZhdGUgWm9vS2VlcGVyIHprOwogICAgLy8gWksg\nbGVkZ2VycyByZWxhdGVkIFN0cmluZyBjb25zdGFudHMKICAgIHByaXZhdGUg\nZmluYWwgU3RyaW5nIGJvb2tpZXNQYXRoOwoKICAgIC8vIEJvb2tLZWVwZXIg\nY2xpZW50IGluc3RhbmNlCiAgICBwcml2YXRlIEJvb2tLZWVwZXIgYmtjOwog\nICAgCiAgICAvLyBMZWRnZXJGcmFnbWVudFJlcGxpY2F0b3IgaW5zdGFuY2UK\nICAgIHByaXZhdGUgTGVkZ2VyRnJhZ21lbnRSZXBsaWNhdG9yIGxmcjsKCiAg\nICAvKgogICAgICogUmFuZG9tIG51bWJlciBnZW5lcmF0b3IgdXNlZCB0byBj\naG9vc2UgYW4gYXZhaWxhYmxlIGJvb2tpZSBzZXJ2ZXIgdG8KICAgICAqIHJl\ncGxpY2F0ZSBkYXRhIGZyb20gYSBkZWFkIGJvb2tpZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBSYW5kb20gcmFuZCA9IG5ldyBSYW5kb20oKTsKCiAgICAvKioK\nICAgICAqIENvbnN0cnVjdG9yIHRoYXQgdGFrZXMgaW4gYSBab29LZWVwZXIg\nc2VydmVycyBjb25uZWN0IHN0cmluZyBzbyB3ZSBrbm93CiAgICAgKiBob3cg\ndG8gY29ubmVjdCB0byBab29LZWVwZXIgdG8gcmV0cmlldmUgaW5mb3JtYXRp\nb24gYWJvdXQgdGhlIEJvb2tLZWVwZXIKICAgICAqIGNsdXN0ZXIuIFdlIG5l\nZWQgdGhpcyBiZWZvcmUgd2UgY2FuIGRvIGFueSB0eXBlIG9mIGFkbWluIG9w\nZXJhdGlvbnMgb24KICAgICAqIHRoZSBCb29rS2VlcGVyIGNsdXN0ZXIuCiAg\nICAgKgogICAgICogQHBhcmFtIHprU2VydmVycwogICAgICogICAgICAgICAg\nICBDb21tYSBzZXBhcmF0ZWQgbGlzdCBvZiBob3N0bmFtZTpwb3J0IHBhaXJz\nIGZvciB0aGUgWm9vS2VlcGVyCiAgICAgKiAgICAgICAgICAgIHNlcnZlcnMg\nY2x1c3Rlci4KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqICAg\nICAgICAgICAgIHRocm93cyB0aGlzIGV4Y2VwdGlvbiBpZiB0aGVyZSBpcyBh\nbiBlcnJvciBpbnN0YW50aWF0aW5nIHRoZQogICAgICogICAgICAgICAgICAg\nWm9vS2VlcGVyIGNsaWVudC4KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRF\neGNlcHRpb24KICAgICAqICAgICAgICAgICAgIFRocm93cyB0aGlzIGV4Y2Vw\ndGlvbiBpZiB0aGVyZSBpcyBhbiBlcnJvciBpbnN0YW50aWF0aW5nIHRoZQog\nICAgICogICAgICAgICAgICAgQm9va0tlZXBlciBjbGllbnQuCiAgICAgKiBA\ndGhyb3dzIEtlZXBlckV4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgVGhy\nb3dzIHRoaXMgZXhjZXB0aW9uIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluc3Rh\nbnRpYXRpbmcgdGhlCiAgICAgKiAgICAgICAgICAgICBCb29rS2VlcGVyIGNs\naWVudC4KICAgICAqLwogICAgcHVibGljIEJvb2tLZWVwZXJBZG1pbihTdHJp\nbmcgemtTZXJ2ZXJzKSB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVk\nRXhjZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24gewogICAgICAgIHRoaXMobmV3\nIENsaWVudENvbmZpZ3VyYXRpb24oKS5zZXRaa1NlcnZlcnMoemtTZXJ2ZXJz\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3RvciB0aGF0IHRh\na2VzIGluIGEgY29uZmlndXJhdGlvbiBvYmplY3Qgc28gd2Uga25vdwogICAg\nICogaG93IHRvIGNvbm5lY3QgdG8gWm9vS2VlcGVyIHRvIHJldHJpZXZlIGlu\nZm9ybWF0aW9uIGFib3V0IHRoZSBCb29rS2VlcGVyCiAgICAgKiBjbHVzdGVy\nLiBXZSBuZWVkIHRoaXMgYmVmb3JlIHdlIGNhbiBkbyBhbnkgdHlwZSBvZiBh\nZG1pbiBvcGVyYXRpb25zIG9uCiAgICAgKiB0aGUgQm9va0tlZXBlciBjbHVz\ndGVyLgogICAgICoKICAgICAqIEBwYXJhbSBjb25mCiAgICAgKiAgICAgICAg\nICAgQ2xpZW50IENvbmZpZ3VyYXRpb24gT2JqZWN0CiAgICAgKiBAdGhyb3dz\nIElPRXhjZXB0aW9uCiAgICAgKiAgICAgICAgICAgICB0aHJvd3MgdGhpcyBl\neGNlcHRpb24gaWYgdGhlcmUgaXMgYW4gZXJyb3IgaW5zdGFudGlhdGluZyB0\naGUKICAgICAqICAgICAgICAgICAgIFpvb0tlZXBlciBjbGllbnQuCiAgICAg\nKiBAdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiAgICAgICAg\nICAgICBUaHJvd3MgdGhpcyBleGNlcHRpb24gaWYgdGhlcmUgaXMgYW4gZXJy\nb3IgaW5zdGFudGlhdGluZyB0aGUKICAgICAqICAgICAgICAgICAgIEJvb2tL\nZWVwZXIgY2xpZW50LgogICAgICogQHRocm93cyBLZWVwZXJFeGNlcHRpb24K\nICAgICAqICAgICAgICAgICAgIFRocm93cyB0aGlzIGV4Y2VwdGlvbiBpZiB0\naGVyZSBpcyBhbiBlcnJvciBpbnN0YW50aWF0aW5nIHRoZQogICAgICogICAg\nICAgICAgICAgQm9va0tlZXBlciBjbGllbnQuCiAgICAgKi8KICAgIHB1Ymxp\nYyBCb29rS2VlcGVyQWRtaW4oQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mKSB0\naHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBLZWVw\nZXJFeGNlcHRpb24gewogICAgICAgIC8vIENyZWF0ZSB0aGUgWm9vS2VlcGVy\nIGNsaWVudCBpbnN0YW5jZQogICAgICAgIFpvb0tlZXBlcldhdGNoZXJCYXNl\nIHcgPSBuZXcgWm9vS2VlcGVyV2F0Y2hlckJhc2UoY29uZi5nZXRaa1RpbWVv\ndXQoKSk7CiAgICAgICAgemsgPSBaa1V0aWxzLmNyZWF0ZUNvbm5lY3RlZFpv\nb2tlZXBlckNsaWVudChjb25mLmdldFprU2VydmVycygpLCB3KTsKICAgICAg\nICAvLyBDcmVhdGUgdGhlIGJvb2tpZSBwYXRoCiAgICAgICAgYm9va2llc1Bh\ndGggPSBjb25mLmdldFprQXZhaWxhYmxlQm9va2llc1BhdGgoKTsKICAgICAg\nICAvLyBDcmVhdGUgdGhlIEJvb2tLZWVwZXIgY2xpZW50IGluc3RhbmNlCiAg\nICAgICAgYmtjID0gbmV3IEJvb2tLZWVwZXIoY29uZiwgemspOwogICAgICAg\nIHRoaXMubGZyID0gbmV3IExlZGdlckZyYWdtZW50UmVwbGljYXRvcihia2Mp\nOwogICAgfQoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IgdGhhdCB0YWtl\ncyBpbiBhIEJvb2tLZWVwZXIgaW5zdGFuY2UgLiBUaGlzIHdpbGwgYmUgdXNl\nZnVsLAogICAgICogd2hlbiB1c2VycyBhbHJlYWR5IGhhcyBiayBpbnN0YW5j\nZSByZWFkeS4KICAgICAqIAogICAgICogQHBhcmFtIGJrYwogICAgICogICAg\nICAgICAgICAtIGJvb2trZWVwZXIgaW5zdGFuY2UKICAgICAqLwogICAgcHVi\nbGljIEJvb2tLZWVwZXJBZG1pbihmaW5hbCBCb29rS2VlcGVyIGJrYykgewog\nICAgICAgIHRoaXMuYmtjID0gYmtjOwogICAgICAgIHRoaXMuemsgPSBia2Mu\nems7CiAgICAgICAgdGhpcy5ib29raWVzUGF0aCA9IGJrYy5nZXRDb25mKCku\nZ2V0WmtBdmFpbGFibGVCb29raWVzUGF0aCgpOwogICAgICAgIHRoaXMubGZy\nID0gbmV3IExlZGdlckZyYWdtZW50UmVwbGljYXRvcihia2MpOwogICAgfQoK\nICAgIC8qKgogICAgICogR3JhY2VmdWxseSByZWxlYXNlIHJlc291cmNlcyB0\naGF0IHRoaXMgY2xpZW50IHVzZXMuCiAgICAgKgogICAgICogQHRocm93cyBJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgaWYgdGhl\ncmUgaXMgYW4gZXJyb3Igc2h1dHRpbmcgZG93biB0aGUgY2xpZW50cyB0aGF0\nIHRoaXMKICAgICAqICAgICAgICAgICAgIGNsYXNzIHVzZXMuCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgdGhyb3dzIEludGVycnVwdGVkRXhj\nZXB0aW9uLCBCS0V4Y2VwdGlvbiB7CiAgICAgICAgYmtjLmNsb3NlKCk7CiAg\nICAgICAgemsuY2xvc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEdldCBh\nIGxpc3Qgb2YgdGhlIGF2YWlsYWJsZSBib29raWVzLgogICAgICoKICAgICAq\nIEByZXR1cm4gYSBjb2xsZWN0aW9uIG9mIGJvb2tpZSBhZGRyZXNzZXMKICAg\nICAqLwogICAgcHVibGljIENvbGxlY3Rpb248SW5ldFNvY2tldEFkZHJlc3M+\nIGdldEF2YWlsYWJsZUJvb2tpZXMoKQogICAgICAgICAgICB0aHJvd3MgQktF\neGNlcHRpb24gewogICAgICAgIHJldHVybiBia2MuYm9va2llV2F0Y2hlci5n\nZXRCb29raWVzKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBsaXN0\nIG9mIHJlYWRvbmx5IGJvb2tpZXMKICAgICAqCiAgICAgKiBAcmV0dXJuIGEg\nY29sbGVjdGlvbiBvZiBib29raWUgYWRkcmVzc2VzCiAgICAgKi8KICAgIHB1\nYmxpYyBDb2xsZWN0aW9uPEluZXRTb2NrZXRBZGRyZXNzPiBnZXRSZWFkT25s\neUJvb2tpZXMoKSB7CiAgICAgICAgcmV0dXJuIGJrYy5ib29raWVXYXRjaGVy\nLmdldFJlYWRPbmx5Qm9va2llcygpOwogICAgfQoKICAgIC8qKgogICAgICog\nTm90aWZ5IHdoZW4gdGhlIGF2YWlsYWJsZSBsaXN0IG9mIGJvb2tpZXMgY2hh\nbmdlcy4KICAgICAqIFRoaXMgaXMgYSBvbmUtc2hvdCBub3RpZmljYXRpb24u\nIFRvIHJlY2VpdmUgc3Vic2VxdWVudCBub3RpZmljYXRpb25zCiAgICAgKiB0\naGUgbGlzdGVuZXIgbXVzdCBiZSByZWdpc3RlcmVkIGFnYWluLgogICAgICoK\nICAgICAqIEBwYXJhbSBsaXN0ZW5lciB0aGUgbGlzdGVuZXIgdG8gbm90aWZ5\nCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG5vdGlmeUJvb2tpZXNDaGFuZ2Vk\nKGZpbmFsIEJvb2tpZXNMaXN0ZW5lciBsaXN0ZW5lcikKICAgICAgICAgICAg\ndGhyb3dzIEJLRXhjZXB0aW9uIHsKICAgICAgICBia2MuYm9va2llV2F0Y2hl\nci5ub3RpZnlCb29raWVzQ2hhbmdlZChsaXN0ZW5lcik7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBPcGVuIGEgbGVkZ2VyIGFzIGFuIGFkbWluaXN0cmF0b3Iu\nIFRoaXMgbWVhbnMgdGhhdCBubyBkaWdlc3QgcGFzc3dvcmQKICAgICAqIGNo\nZWNrcyBhcmUgZG9uZS4gT3RoZXJ3aXNlLCB0aGUgY2FsbCBpcyBpZGVudGlj\nYWwgdG8gQm9va0tlZXBlciNhc3luY09wZW5MZWRnZXIKICAgICAqCiAgICAg\nKiBAcGFyYW0gbElkCiAgICAgKiAgICAgICAgICBsZWRnZXIgaWRlbnRpZmll\ncgogICAgICogQHBhcmFtIGNiCiAgICAgKiAgICAgICAgICBDYWxsYmFjayB3\naGljaCB3aWxsIHJlY2VpdmUgYSBMZWRnZXJIYW5kbGUgb2JqZWN0CiAgICAg\nKiBAcGFyYW0gY3R4CiAgICAgKiAgICAgICAgICBvcHRpb25hbCBjb250ZXh0\nIG9iamVjdCwgdG8gYmUgcGFzc3dkIHRvIHRoZSBjYWxsYmFjayAoY2FuIGJl\nIG51bGwpCiAgICAgKgogICAgICogQHNlZSBCb29rS2VlcGVyI2FzeW5jT3Bl\nbkxlZGdlcgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3luY09wZW5MZWRn\nZXIoZmluYWwgbG9uZyBsSWQsIGZpbmFsIE9wZW5DYWxsYmFjayBjYiwgZmlu\nYWwgT2JqZWN0IGN0eCkgewogICAgICAgIG5ldyBMZWRnZXJPcGVuT3AoYmtj\nLCBsSWQsIGNiLCBjdHgpLmluaXRpYXRlKCk7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogT3BlbiBhIGxlZGdlciBhcyBhbiBhZG1pbmlzdHJhdG9yLiBU\naGlzIG1lYW5zIHRoYXQgbm8gZGlnZXN0IHBhc3N3b3JkCiAgICAgKiBjaGVj\na3MgYXJlIGRvbmUuIE90aGVyd2lzZSwgdGhlIGNhbGwgaXMgaWRlbnRpY2Fs\nIHRvCiAgICAgKiBCb29rS2VlcGVyI29wZW5MZWRnZXIKICAgICAqIAogICAg\nICogQHBhcmFtIGxJZAogICAgICogICAgICAgICAgICAtIGxlZGdlciBpZGVu\ndGlmaWVyCiAgICAgKiBAc2VlIEJvb2tLZWVwZXIjb3BlbkxlZGdlcgogICAg\nICovCiAgICBwdWJsaWMgTGVkZ2VySGFuZGxlIG9wZW5MZWRnZXIoZmluYWwg\nbG9uZyBsSWQpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwKICAgICAg\nICAgICAgQktFeGNlcHRpb24gewogICAgICAgIFN5bmNDb3VudGVyIGNvdW50\nZXIgPSBuZXcgU3luY0NvdW50ZXIoKTsKICAgICAgICBjb3VudGVyLmluYygp\nOwogICAgICAgIG5ldyBMZWRnZXJPcGVuT3AoYmtjLCBsSWQsIG5ldyBTeW5j\nT3BlbkNhbGxiYWNrKCksIGNvdW50ZXIpLmluaXRpYXRlKCk7CiAgICAgICAg\nLyoKICAgICAgICAgKiBXYWl0CiAgICAgICAgICovCiAgICAgICAgY291bnRl\nci5ibG9jaygwKTsKICAgICAgICBpZiAoY291bnRlci5nZXRyYygpICE9IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgdGhyb3cgQktFeGNl\ncHRpb24uY3JlYXRlKGNvdW50ZXIuZ2V0cmMoKSk7CiAgICAgICAgfQoKICAg\nICAgICByZXR1cm4gY291bnRlci5nZXRMaCgpOwogICAgfQoKICAgIC8qKgog\nICAgICogT3BlbiBhIGxlZGdlciBhcyBhbiBhZG1pbmlzdHJhdG9yIHdpdGhv\ndXQgcmVjb3ZlcmluZyB0aGUgbGVkZ2VyLiBUaGlzIG1lYW5zCiAgICAgKiB0\naGF0IG5vIGRpZ2VzdCBwYXNzd29yZCAgY2hlY2tzIGFyZSBkb25lLiBPdGhl\ncndpc2UsIHRoZSBjYWxsIGlzIGlkZW50aWNhbAogICAgICogdG8gQm9va0tl\nZXBlciNhc3luY09wZW5MZWRnZXJOb1JlY292ZXJ5CiAgICAgKgogICAgICog\nQHBhcmFtIGxJZAogICAgICogICAgICAgICAgbGVkZ2VyIGlkZW50aWZpZXIK\nICAgICAqIEBwYXJhbSBjYgogICAgICogICAgICAgICAgQ2FsbGJhY2sgd2hp\nY2ggd2lsbCByZWNlaXZlIGEgTGVkZ2VySGFuZGxlIG9iamVjdAogICAgICog\nQHBhcmFtIGN0eAogICAgICogICAgICAgICAgb3B0aW9uYWwgY29udGV4dCBv\nYmplY3QsIHRvIGJlIHBhc3N3ZCB0byB0aGUgY2FsbGJhY2sgKGNhbiBiZSBu\ndWxsKQogICAgICoKICAgICAqIEBzZWUgQm9va0tlZXBlciNhc3luY09wZW5M\nZWRnZXJOb1JlY292ZXJ5CiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGFzeW5j\nT3BlbkxlZGdlck5vUmVjb3ZlcnkoZmluYWwgbG9uZyBsSWQsIGZpbmFsIE9w\nZW5DYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIG5l\ndyBMZWRnZXJPcGVuT3AoYmtjLCBsSWQsIGNiLCBjdHgpLmluaXRpYXRlV2l0\naG91dFJlY292ZXJ5KCk7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogT3Bl\nbiBhIGxlZGdlciBhcyBhbiBhZG1pbmlzdHJhdG9yIHdpdGhvdXQgcmVjb3Zl\ncmluZyB0aGUgbGVkZ2VyLiBUaGlzCiAgICAgKiBtZWFucyB0aGF0IG5vIGRp\nZ2VzdCBwYXNzd29yZCBjaGVja3MgYXJlIGRvbmUuIE90aGVyd2lzZSwgdGhl\nIGNhbGwgaXMKICAgICAqIGlkZW50aWNhbCB0byBCb29rS2VlcGVyI29wZW5M\nZWRnZXJOb1JlY292ZXJ5CiAgICAgKiAKICAgICAqIEBwYXJhbSBsSWQKICAg\nICAqICAgICAgICAgICAgbGVkZ2VyIGlkZW50aWZpZXIKICAgICAqIEBzZWUg\nQm9va0tlZXBlciNvcGVuTGVkZ2VyTm9SZWNvdmVyeQogICAgICovCiAgICBw\ndWJsaWMgTGVkZ2VySGFuZGxlIG9wZW5MZWRnZXJOb1JlY292ZXJ5KGZpbmFs\nIGxvbmcgbElkKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBTeW5jQ291bnRlciBjb3Vu\ndGVyID0gbmV3IFN5bmNDb3VudGVyKCk7CiAgICAgICAgY291bnRlci5pbmMo\nKTsKICAgICAgICBuZXcgTGVkZ2VyT3Blbk9wKGJrYywgbElkLCBuZXcgU3lu\nY09wZW5DYWxsYmFjaygpLCBjb3VudGVyKQogICAgICAgICAgICAgICAgLmlu\naXRpYXRlV2l0aG91dFJlY292ZXJ5KCk7CiAgICAgICAgLyoKICAgICAgICAg\nKiBXYWl0CiAgICAgICAgICovCiAgICAgICAgY291bnRlci5ibG9jaygwKTsK\nICAgICAgICBpZiAoY291bnRlci5nZXRyYygpICE9IEJLRXhjZXB0aW9uLkNv\nZGUuT0spIHsKICAgICAgICAgICAgdGhyb3cgQktFeGNlcHRpb24uY3JlYXRl\nKGNvdW50ZXIuZ2V0cmMoKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4g\nY291bnRlci5nZXRMaCgpOwogICAgfQoKICAgIC8vIE9iamVjdCB1c2VkIGZv\nciBjYWxsaW5nIGFzeW5jIG1ldGhvZHMgYW5kIHdhaXRpbmcgZm9yIHRoZW0g\ndG8gY29tcGxldGUuCiAgICBzdGF0aWMgY2xhc3MgU3luY09iamVjdCB7CiAg\nICAgICAgYm9vbGVhbiB2YWx1ZTsKICAgICAgICBpbnQgcmM7CgogICAgICAg\nIHB1YmxpYyBTeW5jT2JqZWN0KCkgewogICAgICAgICAgICB2YWx1ZSA9IGZh\nbHNlOwogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3luY2hyb25vdXMgbWV0\naG9kIHRvIHJlYnVpbGQgYW5kIHJlY292ZXIgdGhlIGxlZGdlciBmcmFnbWVu\ndHMgZGF0YSB0aGF0CiAgICAgKiB3YXMgc3RvcmVkIG9uIHRoZSBzb3VyY2Ug\nYm9va2llLiBUaGF0IGJvb2tpZSBjb3VsZCBoYXZlIGZhaWxlZCBjb21wbGV0\nZWx5CiAgICAgKiBhbmQgbm93IHRoZSBsZWRnZXIgZGF0YSB0aGF0IHdhcyBz\ndG9yZWQgb24gaXQgaXMgdW5kZXIgcmVwbGljYXRlZC4gQW4KICAgICAqIG9w\ndGlvbmFsIGRlc3RpbmF0aW9uIGJvb2tpZSBzZXJ2ZXIgY291bGQgYmUgZ2l2\nZW4gaWYgd2Ugd2FudCB0byBjb3B5IGFsbAogICAgICogb2YgdGhlIGxlZGdl\nciBmcmFnbWVudHMgZGF0YSBvbiB0aGUgZmFpbGVkIHNvdXJjZSBib29raWUg\ndG8gaXQuCiAgICAgKiBPdGhlcndpc2UsIHdlIHdpbGwganVzdCByYW5kb21s\neSBkaXN0cmlidXRlIHRoZSBsZWRnZXIgZnJhZ21lbnRzIHRvIHRoZQogICAg\nICogYWN0aXZlIHNldCBvZiBib29raWVzLCBwZXJoYXBzIGJhc2VkIG9uIGxv\nYWQuIEFsbCBab29LZWVwZXIgbGVkZ2VyCiAgICAgKiBtZXRhZGF0YSB3aWxs\nIGJlIHVwZGF0ZWQgdG8gcG9pbnQgdG8gdGhlIG5ldyBib29raWUocykgdGhh\ndCBjb250YWluIHRoZQogICAgICogcmVwbGljYXRlZCBsZWRnZXIgZnJhZ21l\nbnRzLgogICAgICoKICAgICAqIEBwYXJhbSBib29raWVTcmMKICAgICAqICAg\nICAgICAgICAgU291cmNlIGJvb2tpZSB0aGF0IGhhZCBhIGZhaWx1cmUuIFdl\nIHdhbnQgdG8gcmVwbGljYXRlIHRoZQogICAgICogICAgICAgICAgICBsZWRn\nZXIgZnJhZ21lbnRzIHRoYXQgd2VyZSBzdG9yZWQgdGhlcmUuCiAgICAgKiBA\ncGFyYW0gYm9va2llRGVzdAogICAgICogICAgICAgICAgICBPcHRpb25hbCBk\nZXN0aW5hdGlvbiBib29raWUgdGhhdCBpZiBwYXNzZWQsIHdlIHdpbGwgY29w\neSBhbGwKICAgICAqICAgICAgICAgICAgb2YgdGhlIGxlZGdlciBmcmFnbWVu\ndHMgZnJvbSB0aGUgc291cmNlIGJvb2tpZSBvdmVyIHRvIGl0LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCByZWNvdmVyQm9va2llRGF0YShmaW5hbCBJbmV0\nU29ja2V0QWRkcmVzcyBib29raWVTcmMsIGZpbmFsIEluZXRTb2NrZXRBZGRy\nZXNzIGJvb2tpZURlc3QpCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIFN5bmNPYmplY3Qg\nc3luYyA9IG5ldyBTeW5jT2JqZWN0KCk7CiAgICAgICAgLy8gQ2FsbCB0aGUg\nYXN5bmMgbWV0aG9kIHRvIHJlY292ZXIgYm9va2llIGRhdGEuCiAgICAgICAg\nYXN5bmNSZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIGJvb2tpZURlc3Qs\nIG5ldyBSZWNvdmVyQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCByZWNvdmVyQ29tcGxldGUoaW50\nIHJjLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygi\nUmVjb3ZlciBib29raWUgb3BlcmF0aW9uIGNvbXBsZXRlZCB3aXRoIHJjOiAi\nICsgcmMpOwogICAgICAgICAgICAgICAgU3luY09iamVjdCBzeW5jT2JqID0g\nKFN5bmNPYmplY3QpIGN0eDsKICAgICAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAoc3luY09iaikgewogICAgICAgICAgICAgICAgICAgIHN5bmNPYmoucmMg\nPSByYzsKICAgICAgICAgICAgICAgICAgICBzeW5jT2JqLnZhbHVlID0gdHJ1\nZTsKICAgICAgICAgICAgICAgICAgICBzeW5jT2JqLm5vdGlmeSgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwgc3luYyk7\nCgogICAgICAgIC8vIFdhaXQgZm9yIHRoZSBhc3luYyBtZXRob2QgdG8gY29t\ncGxldGUuCiAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAg\nICAgIHdoaWxlIChzeW5jLnZhbHVlID09IGZhbHNlKSB7CiAgICAgICAgICAg\nICAgICBzeW5jLndhaXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICBpZiAoc3luYy5yYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAg\nICAgICAgICAgIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShzeW5jLnJjKTsK\nICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3luYyBtZXRob2Qg\ndG8gcmVidWlsZCBhbmQgcmVjb3ZlciB0aGUgbGVkZ2VyIGZyYWdtZW50cyBk\nYXRhIHRoYXQgd2FzCiAgICAgKiBzdG9yZWQgb24gdGhlIHNvdXJjZSBib29r\naWUuIFRoYXQgYm9va2llIGNvdWxkIGhhdmUgZmFpbGVkIGNvbXBsZXRlbHkg\nYW5kCiAgICAgKiBub3cgdGhlIGxlZGdlciBkYXRhIHRoYXQgd2FzIHN0b3Jl\nZCBvbiBpdCBpcyB1bmRlciByZXBsaWNhdGVkLiBBbgogICAgICogb3B0aW9u\nYWwgZGVzdGluYXRpb24gYm9va2llIHNlcnZlciBjb3VsZCBiZSBnaXZlbiBp\nZiB3ZSB3YW50IHRvIGNvcHkgYWxsCiAgICAgKiBvZiB0aGUgbGVkZ2VyIGZy\nYWdtZW50cyBkYXRhIG9uIHRoZSBmYWlsZWQgc291cmNlIGJvb2tpZSB0byBp\ndC4KICAgICAqIE90aGVyd2lzZSwgd2Ugd2lsbCBqdXN0IHJhbmRvbWx5IGRp\nc3RyaWJ1dGUgdGhlIGxlZGdlciBmcmFnbWVudHMgdG8gdGhlCiAgICAgKiBh\nY3RpdmUgc2V0IG9mIGJvb2tpZXMsIHBlcmhhcHMgYmFzZWQgb24gbG9hZC4g\nQWxsIFpvb0tlZXBlciBsZWRnZXIKICAgICAqIG1ldGFkYXRhIHdpbGwgYmUg\ndXBkYXRlZCB0byBwb2ludCB0byB0aGUgbmV3IGJvb2tpZShzKSB0aGF0IGNv\nbnRhaW4gdGhlCiAgICAgKiByZXBsaWNhdGVkIGxlZGdlciBmcmFnbWVudHMu\nCiAgICAgKgogICAgICogQHBhcmFtIGJvb2tpZVNyYwogICAgICogICAgICAg\nICAgICBTb3VyY2UgYm9va2llIHRoYXQgaGFkIGEgZmFpbHVyZS4gV2Ugd2Fu\ndCB0byByZXBsaWNhdGUgdGhlCiAgICAgKiAgICAgICAgICAgIGxlZGdlciBm\ncmFnbWVudHMgdGhhdCB3ZXJlIHN0b3JlZCB0aGVyZS4KICAgICAqIEBwYXJh\nbSBib29raWVEZXN0CiAgICAgKiAgICAgICAgICAgIE9wdGlvbmFsIGRlc3Rp\nbmF0aW9uIGJvb2tpZSB0aGF0IGlmIHBhc3NlZCwgd2Ugd2lsbCBjb3B5IGFs\nbAogICAgICogICAgICAgICAgICBvZiB0aGUgbGVkZ2VyIGZyYWdtZW50cyBm\ncm9tIHRoZSBzb3VyY2UgYm9va2llIG92ZXIgdG8gaXQuCiAgICAgKiBAcGFy\nYW0gY2IKICAgICAqICAgICAgICAgICAgUmVjb3ZlckNhbGxiYWNrIHRvIGlu\ndm9rZSBvbmNlIGFsbCBvZiB0aGUgZGF0YSBvbiB0aGUgZGVhZAogICAgICog\nICAgICAgICAgICBib29raWUgaGFzIGJlZW4gcmVjb3ZlcmVkIGFuZCByZXBs\naWNhdGVkLgogICAgICogQHBhcmFtIGNvbnRleHQKICAgICAqICAgICAgICAg\nICAgQ29udGV4dCBmb3IgdGhlIFJlY292ZXJDYWxsYmFjayB0byBjYWxsLgog\nICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3luY1JlY292ZXJCb29raWVEYXRh\nKGZpbmFsIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZVNyYywgZmluYWwgSW5l\ndFNvY2tldEFkZHJlc3MgYm9va2llRGVzdCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZmluYWwgUmVjb3ZlckNhbGxiYWNrIGNi\nLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIFN5bmMgWksg\ndG8gbWFrZSBzdXJlIHdlJ3JlIHJlYWRpbmcgdGhlIGxhdGVzdCBib29raWUg\nZGF0YS4KICAgICAgICB6ay5zeW5jKGJvb2tpZXNQYXRoLCBuZXcgQXN5bmND\nYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCBy\nYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAg\nIGlmIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIlpLIGVycm9yIHN5bmNpbmc6ICIsIEtlZXBl\nckV4Y2VwdGlvbi5jcmVhdGUoS2VlcGVyRXhjZXB0aW9uLkNvZGUuZ2V0KHJj\nKSwgcGF0aCkpOwogICAgICAgICAgICAgICAgICAgIGNiLnJlY292ZXJDb21w\nbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLlpLRXhjZXB0aW9uLCBjb250ZXh0KTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBnZXRBdmFpbGFibGVCb29raWVzKGJvb2tpZVNy\nYywgYm9va2llRGVzdCwgY2IsIGNvbnRleHQpOwogICAgICAgICAgICB9Owog\nICAgICAgIH0sIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBt\nZXRob2QgYXN5bmNocm9ub3VzbHkgZ2V0cyB0aGUgc2V0IG9mIGF2YWlsYWJs\nZSBCb29raWVzIHRoYXQgdGhlCiAgICAgKiBkZWFkIGlucHV0IGJvb2tpZSdz\nIGRhdGEgd2lsbCBiZSBjb3BpZWQgb3ZlciBpbnRvLiBJZiB0aGUgdXNlciBw\nYXNzZWQgaW4KICAgICAqIGEgc3BlY2lmaWMgZGVzdGluYXRpb24gYm9va2ll\nLCB0aGVuIGp1c3QgdXNlIHRoYXQgb25lLiBPdGhlcndpc2UsIHdlJ2xsCiAg\nICAgKiByYW5kb21seSBwaWNrIG9uZSBvZiB0aGUgb3RoZXIgYXZhaWxhYmxl\nIGJvb2tpZXMgdG8gdXNlIGZvciBlYWNoIGxlZGdlcgogICAgICogZnJhZ21l\nbnQgd2UgYXJlIHJlcGxpY2F0aW5nLgogICAgICoKICAgICAqIEBwYXJhbSBi\nb29raWVTcmMKICAgICAqICAgICAgICAgICAgU291cmNlIGJvb2tpZSB0aGF0\nIGhhZCBhIGZhaWx1cmUuIFdlIHdhbnQgdG8gcmVwbGljYXRlIHRoZQogICAg\nICogICAgICAgICAgICBsZWRnZXIgZnJhZ21lbnRzIHRoYXQgd2VyZSBzdG9y\nZWQgdGhlcmUuCiAgICAgKiBAcGFyYW0gYm9va2llRGVzdAogICAgICogICAg\nICAgICAgICBPcHRpb25hbCBkZXN0aW5hdGlvbiBib29raWUgdGhhdCBpZiBw\nYXNzZWQsIHdlIHdpbGwgY29weSBhbGwKICAgICAqICAgICAgICAgICAgb2Yg\ndGhlIGxlZGdlciBmcmFnbWVudHMgZnJvbSB0aGUgc291cmNlIGJvb2tpZSBv\ndmVyIHRvIGl0LgogICAgICogQHBhcmFtIGNiCiAgICAgKiAgICAgICAgICAg\nIFJlY292ZXJDYWxsYmFjayB0byBpbnZva2Ugb25jZSBhbGwgb2YgdGhlIGRh\ndGEgb24gdGhlIGRlYWQKICAgICAqICAgICAgICAgICAgYm9va2llIGhhcyBi\nZWVuIHJlY292ZXJlZCBhbmQgcmVwbGljYXRlZC4KICAgICAqIEBwYXJhbSBj\nb250ZXh0CiAgICAgKiAgICAgICAgICAgIENvbnRleHQgZm9yIHRoZSBSZWNv\ndmVyQ2FsbGJhY2sgdG8gY2FsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lk\nIGdldEF2YWlsYWJsZUJvb2tpZXMoZmluYWwgSW5ldFNvY2tldEFkZHJlc3Mg\nYm9va2llU3JjLCBmaW5hbCBJbmV0U29ja2V0QWRkcmVzcyBib29raWVEZXN0\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwg\nUmVjb3ZlckNhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewog\nICAgICAgIGZpbmFsIExpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGF2YWlsYWJs\nZUJvb2tpZXMgPSBuZXcgTGlua2VkTGlzdDxJbmV0U29ja2V0QWRkcmVzcz4o\nKTsKICAgICAgICBpZiAoYm9va2llRGVzdCAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGF2YWlsYWJsZUJvb2tpZXMuYWRkKGJvb2tpZURlc3QpOwogICAgICAg\nICAgICAvLyBOb3cgcG9sbCBaSyB0byBnZXQgdGhlIGFjdGl2ZSBsZWRnZXJz\nCiAgICAgICAgICAgIGdldEFjdGl2ZUxlZGdlcnMoYm9va2llU3JjLCBib29r\naWVEZXN0LCBjYiwgY29udGV4dCwgYXZhaWxhYmxlQm9va2llcyk7CiAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgemsuZ2V0Q2hpbGRyZW4oYm9va2ll\nc1BhdGgsIG51bGwsIG5ldyBBc3luY0NhbGxiYWNrLkNoaWxkcmVuQ2FsbGJh\nY2soKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcg\ncGF0aCwgT2JqZWN0IGN0eCwgTGlzdDxTdHJpbmc+IGNoaWxkcmVuKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFsdWUo\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlpLIGVy\ncm9yIGdldHRpbmcgYm9va2llIG5vZGVzOiAiLCBLZWVwZXJFeGNlcHRpb24u\nY3JlYXRlKEtlZXBlckV4Y2VwdGlvbi5Db2RlCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAuZ2V0KHJjKSwgcGF0aCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICBjYi5yZWNvdmVyQ29tcGxldGUoQktFeGNlcHRpb24u\nQ29kZS5aS0V4Y2VwdGlvbiwgY29udGV4dCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgZm9yIChTdHJpbmcgYm9va2llTm9kZSA6IGNoaWxkcmVu\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChCb29rS2VlcGVyQ29u\nc3RhbnRzLlJFQURPTkxZCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuZXF1YWxzKGJvb2tpZU5vZGUpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyBleGNsdWRlIHRoZSByZWFkb25seSBub2Rl\nIGZyb20gYXZhaWxhYmxlIGJvb2tpZXMuCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICBTdHJpbmcgcGFydHNbXSA9IGJvb2tp\nZU5vZGUuc3BsaXQoQm9va0tlZXBlckNvbnN0YW50cy5DT0xPTik7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPCAyKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkJvb2tpZSBO\nb2RlIHJldHJpZXZlZCBmcm9tIFpLIGhhcyBpbnZhbGlkIG5hbWUgZm9ybWF0\nOiAiICsgYm9va2llTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjYi5yZWNvdmVyQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5aS0V4Y2Vw\ndGlvbiwgY29udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAgICAgYXZhaWxhYmxlQm9va2llcy5hZGQobmV3IEluZXRTb2Nr\nZXRBZGRyZXNzKHBhcnRzWzBdLCBJbnRlZ2VyLnBhcnNlSW50KHBhcnRzWzFd\nKSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAvLyBOb3cgcG9sbCBaSyB0byBnZXQgdGhlIGFjdGl2ZSBsZWRnZXJzCiAg\nICAgICAgICAgICAgICAgICAgZ2V0QWN0aXZlTGVkZ2Vycyhib29raWVTcmMs\nIG51bGwsIGNiLCBjb250ZXh0LCBhdmFpbGFibGVCb29raWVzKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbnVsbCk7CiAgICAgICAgfQog\nICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2QgYXN5bmNocm9ub3Vz\nbHkgcG9sbHMgWksgdG8gZ2V0IHRoZSBjdXJyZW50IHNldCBvZiBhY3RpdmUK\nICAgICAqIGxlZGdlcnMuIEZyb20gdGhpcywgd2UgY2FuIG9wZW4gZWFjaCBs\nZWRnZXIgYW5kIGxvb2sgYXQgdGhlIG1ldGFkYXRhIHRvCiAgICAgKiBkZXRl\ncm1pbmUgaWYgYW55IG9mIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGZvciBpdCB3\nZXJlIHN0b3JlZCBhdCB0aGUgZGVhZAogICAgICogaW5wdXQgYm9va2llLgog\nICAgICoKICAgICAqIEBwYXJhbSBib29raWVTcmMKICAgICAqICAgICAgICAg\nICAgU291cmNlIGJvb2tpZSB0aGF0IGhhZCBhIGZhaWx1cmUuIFdlIHdhbnQg\ndG8gcmVwbGljYXRlIHRoZQogICAgICogICAgICAgICAgICBsZWRnZXIgZnJh\nZ21lbnRzIHRoYXQgd2VyZSBzdG9yZWQgdGhlcmUuCiAgICAgKiBAcGFyYW0g\nYm9va2llRGVzdAogICAgICogICAgICAgICAgICBPcHRpb25hbCBkZXN0aW5h\ndGlvbiBib29raWUgdGhhdCBpZiBwYXNzZWQsIHdlIHdpbGwgY29weSBhbGwK\nICAgICAqICAgICAgICAgICAgb2YgdGhlIGxlZGdlciBmcmFnbWVudHMgZnJv\nbSB0aGUgc291cmNlIGJvb2tpZSBvdmVyIHRvIGl0LgogICAgICogQHBhcmFt\nIGNiCiAgICAgKiAgICAgICAgICAgIFJlY292ZXJDYWxsYmFjayB0byBpbnZv\na2Ugb25jZSBhbGwgb2YgdGhlIGRhdGEgb24gdGhlIGRlYWQKICAgICAqICAg\nICAgICAgICAgYm9va2llIGhhcyBiZWVuIHJlY292ZXJlZCBhbmQgcmVwbGlj\nYXRlZC4KICAgICAqIEBwYXJhbSBjb250ZXh0CiAgICAgKiAgICAgICAgICAg\nIENvbnRleHQgZm9yIHRoZSBSZWNvdmVyQ2FsbGJhY2sgdG8gY2FsbC4KICAg\nICAqIEBwYXJhbSBhdmFpbGFibGVCb29raWVzCiAgICAgKiAgICAgICAgICAg\nIExpc3Qgb2YgQm9va2llIFNlcnZlcnMgdGhhdCBhcmUgYXZhaWxhYmxlIHRv\nIHVzZSBmb3IKICAgICAqICAgICAgICAgICAgcmVwbGljYXRpbmcgZGF0YSBv\nbiB0aGUgZmFpbGVkIGJvb2tpZS4gVGhpcyBjb3VsZCBjb250YWluIGEKICAg\nICAqICAgICAgICAgICAgc2luZ2xlIGJvb2tpZSBzZXJ2ZXIgaWYgdGhlIHVz\nZXIgZXhwbGljaXRseSBjaG9zZSBhIGJvb2tpZQogICAgICogICAgICAgICAg\nICBzZXJ2ZXIgdG8gcmVwbGljYXRlIGRhdGEgdG8uCiAgICAgKi8KICAgIHBy\naXZhdGUgdm9pZCBnZXRBY3RpdmVMZWRnZXJzKGZpbmFsIEluZXRTb2NrZXRB\nZGRyZXNzIGJvb2tpZVNyYywgZmluYWwgSW5ldFNvY2tldEFkZHJlc3MgYm9v\na2llRGVzdCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZp\nbmFsIFJlY292ZXJDYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGNvbnRleHQs\nIGZpbmFsIExpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGF2YWlsYWJsZUJvb2tp\nZXMpIHsKICAgICAgICAvLyBXcmFwcGVyIGNsYXNzIGFyb3VuZCB0aGUgUmVj\nb3ZlckNhbGxiYWNrIHNvIGl0IGNhbiBiZSB1c2VkCiAgICAgICAgLy8gYXMg\ndGhlIGZpbmFsIFZvaWRDYWxsYmFjayB0byBwcm9jZXNzIGxlZGdlcnMKICAg\nICAgICBjbGFzcyBSZWNvdmVyQ2FsbGJhY2tXcmFwcGVyIGltcGxlbWVudHMg\nQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2sgewogICAgICAgICAgICBmaW5h\nbCBSZWNvdmVyQ2FsbGJhY2sgY2I7CgogICAgICAgICAgICBSZWNvdmVyQ2Fs\nbGJhY2tXcmFwcGVyKFJlY292ZXJDYWxsYmFjayBjYikgewogICAgICAgICAg\nICAgICAgdGhpcy5jYiA9IGNiOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jl\nc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAg\nICAgICAgICAgICBjYi5yZWNvdmVyQ29tcGxldGUocmMsIGN0eCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIFByb2Nlc3NvcjxMb25nPiBs\nZWRnZXJQcm9jZXNzb3IgPSBuZXcgUHJvY2Vzc29yPExvbmc+KCkgewogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJv\nY2VzcyhMb25nIGxlZGdlcklkLCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFj\nayBpdGVyQ2FsbGJhY2spIHsKICAgICAgICAgICAgICAgIHJlY292ZXJMZWRn\nZXIoYm9va2llU3JjLCBsZWRnZXJJZCwgaXRlckNhbGxiYWNrLCBhdmFpbGFi\nbGVCb29raWVzKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAg\nYmtjLmdldExlZGdlck1hbmFnZXIoKS5hc3luY1Byb2Nlc3NMZWRnZXJzKAog\nICAgICAgICAgICBsZWRnZXJQcm9jZXNzb3IsIG5ldyBSZWNvdmVyQ2FsbGJh\nY2tXcmFwcGVyKGNiKSwKICAgICAgICAgICAgY29udGV4dCwgQktFeGNlcHRp\nb24uQ29kZS5PSywgQktFeGNlcHRpb24uQ29kZS5MZWRnZXJSZWNvdmVyeUV4\nY2VwdGlvbik7CiAgICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBuZXcgcmFu\nZG9tIGJvb2tpZSwgYnV0IGVuc3VyZSB0aGF0IGl0IGlzbid0IG9uZSB0aGF0\nIGlzIGFscmVhZHkKICAgICAqIGluIHRoZSBlbnNlbWJsZSBmb3IgdGhlIGxl\nZGdlci4KICAgICAqLwogICAgcHJpdmF0ZSBJbmV0U29ja2V0QWRkcmVzcyBn\nZXROZXdCb29raWUoZmluYWwgTGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gYm9v\na2llc0FscmVhZHlJbkVuc2VtYmxlLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIExpc3Q8SW5ldFNvY2tldEFk\nZHJlc3M+IGF2YWlsYWJsZUJvb2tpZXMpIAogICAgICAgICAgICB0aHJvd3Mg\nQktFeGNlcHRpb24uQktOb3RFbm91Z2hCb29raWVzRXhjZXB0aW9uIHsKICAg\nICAgICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGNhbmRpZGF0ZXMg\nPSBuZXcgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPigpOwogICAgICAg\nIGNhbmRpZGF0ZXMuYWRkQWxsKGF2YWlsYWJsZUJvb2tpZXMpOwogICAgICAg\nIGNhbmRpZGF0ZXMucmVtb3ZlQWxsKGJvb2tpZXNBbHJlYWR5SW5FbnNlbWJs\nZSk7CiAgICAgICAgaWYgKGNhbmRpZGF0ZXMuc2l6ZSgpID09IDApIHsKICAg\nICAgICAgICAgdGhyb3cgbmV3IEJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9v\na2llc0V4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2Fu\nZGlkYXRlcy5nZXQocmFuZC5uZXh0SW50KGNhbmRpZGF0ZXMuc2l6ZSgpKSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBhc3luY2hyb25v\ndXNseSByZWNvdmVycyBhIGdpdmVuIGxlZGdlciBpZiBhbnkgb2YgdGhlIGxl\nZGdlcgogICAgICogZW50cmllcyB3ZXJlIHN0b3JlZCBvbiB0aGUgZmFpbGVk\nIGJvb2tpZS4KICAgICAqCiAgICAgKiBAcGFyYW0gYm9va2llU3JjCiAgICAg\nKiAgICAgICAgICAgIFNvdXJjZSBib29raWUgdGhhdCBoYWQgYSBmYWlsdXJl\nLiBXZSB3YW50IHRvIHJlcGxpY2F0ZSB0aGUKICAgICAqICAgICAgICAgICAg\nbGVkZ2VyIGZyYWdtZW50cyB0aGF0IHdlcmUgc3RvcmVkIHRoZXJlLgogICAg\nICogQHBhcmFtIGxJZAogICAgICogICAgICAgICAgICBMZWRnZXIgaWQgd2Ug\nd2FudCB0byByZWNvdmVyLgogICAgICogQHBhcmFtIGxlZGdlckl0ZXJDYgog\nICAgICogICAgICAgICAgICBJdGVyYXRpb25DYWxsYmFjayB0byBpbnZva2Ug\nb25jZSB3ZSd2ZSByZWNvdmVyZWQgdGhlIGN1cnJlbnQKICAgICAqICAgICAg\nICAgICAgbGVkZ2VyLgogICAgICogQHBhcmFtIGF2YWlsYWJsZUJvb2tpZXMK\nICAgICAqICAgICAgICAgICAgTGlzdCBvZiBCb29raWUgU2VydmVycyB0aGF0\nIGFyZSBhdmFpbGFibGUgdG8gdXNlIGZvcgogICAgICogICAgICAgICAgICBy\nZXBsaWNhdGluZyBkYXRhIG9uIHRoZSBmYWlsZWQgYm9va2llLiBUaGlzIGNv\ndWxkIGNvbnRhaW4gYQogICAgICogICAgICAgICAgICBzaW5nbGUgYm9va2ll\nIHNlcnZlciBpZiB0aGUgdXNlciBleHBsaWNpdGx5IGNob3NlIGEgYm9va2ll\nCiAgICAgKiAgICAgICAgICAgIHNlcnZlciB0byByZXBsaWNhdGUgZGF0YSB0\nby4KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHJlY292ZXJMZWRnZXIoZmlu\nYWwgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llU3JjLCBmaW5hbCBsb25nIGxJ\nZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIEFzeW5j\nQ2FsbGJhY2suVm9pZENhbGxiYWNrIGxlZGdlckl0ZXJDYiwgZmluYWwgTGlz\ndDxJbmV0U29ja2V0QWRkcmVzcz4gYXZhaWxhYmxlQm9va2llcykgewogICAg\nICAgIExPRy5kZWJ1ZygiUmVjb3ZlcmluZyBsZWRnZXIgOiB7fSIsIGxJZCk7\nCgogICAgICAgIGFzeW5jT3BlbkxlZGdlck5vUmVjb3ZlcnkobElkLCBuZXcg\nT3BlbkNhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgb3BlbkNvbXBsZXRlKGludCByYywgZmluYWwg\nTGVkZ2VySGFuZGxlIGxoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAg\nICBpZiAocmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJCSyBlcnJvciBvcGVuaW5nIGxlZGdlcjog\nIiArIGxJZCwgQktFeGNlcHRpb24uY3JlYXRlKHJjKSk7CiAgICAgICAgICAg\nICAgICAgICAgbGVkZ2VySXRlckNiLnByb2Nlc3NSZXN1bHQocmMsIG51bGws\nIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBMZWRnZXJNZXRhZGF0YSBsbSA9\nIGxoLmdldExlZGdlck1ldGFkYXRhKCk7CiAgICAgICAgICAgICAgICBpZiAo\nIWxtLmlzQ2xvc2VkKCkgJiYKICAgICAgICAgICAgICAgICAgICBsbS5nZXRF\nbnNlbWJsZXMoKS5zaXplKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAg\nTG9uZyBsYXN0S2V5ID0gbG0uZ2V0RW5zZW1ibGVzKCkubGFzdEtleSgpOwog\nICAgICAgICAgICAgICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVz\ncz4gbGFzdEVuc2VtYmxlID0gbG0uZ2V0RW5zZW1ibGVzKCkuZ2V0KGxhc3RL\nZXkpOwogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBvcmlnaW5hbCB3cml0\nZSBoYXMgbm90IHJlbW92ZWQgZmF1bHR5IGJvb2tpZSBmcm9tCiAgICAgICAg\nICAgICAgICAgICAgLy8gY3VycmVudCBsZWRnZXIgZW5zZW1ibGUuIHRvIGF2\nb2lkIGRhdGEgbG9zcyBpc3N1ZSBpbgogICAgICAgICAgICAgICAgICAgIC8v\nIHRoZSBjYXNlIG9mIGNvbmN1cnJlbnQgdXBkYXRlcyB0byB0aGUgZW5zZW1i\nbGUgY29tcG9zaXRpb24sCiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHJl\nY292ZXJ5IHRvb2wgc2hvdWxkIGZpcnN0IGNsb3NlIHRoZSBsZWRnZXIKICAg\nICAgICAgICAgICAgICAgICBpZiAobGFzdEVuc2VtYmxlLmNvbnRhaW5zKGJv\nb2tpZVNyYykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2Ug\nb3BlbmVkIG5vbiByZWNvdmVyeSBsZWRnZXIgaGFuZGxlCiAgICAgICAgICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsaC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy53YXJuKCJFcnJvciBjbG9zaW5nIG5vbiByZWNvdmVyeSBsZWRnZXIg\naGFuZGxlIGZvciBsZWRnZXIgIiArIGxJZCwgaWUpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jT3Bl\nbkxlZGdlcihsSWQsIG5ldyBPcGVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZW5Db21wbGV0ZShpbnQgbmV3cmMs\nIGZpbmFsIExlZGdlckhhbmRsZSBuZXdsaCwgT2JqZWN0IG5ld2N0eCkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdyYyAhPSBD\nb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLmVycm9yKCJCSyBlcnJvciBjbG9zZSBsZWRnZXI6\nICIgKyBsSWQsIEJLRXhjZXB0aW9uLmNyZWF0ZShuZXdyYykpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJdGVyQ2IucHJv\nY2Vzc1Jlc3VsdChuZXdyYywgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgLy8gZG8gcmVjb3ZlcnkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZWNvdmVyTGVkZ2VyKGJvb2tpZVNyYywgbElkLCBsZWRnZXJJ\ndGVyQ2IsIGF2YWlsYWJsZUJvb2tpZXMpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9LCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAv\nKgogICAgICAgICAgICAgICAgICogVGhpcyBMaXN0IHN0b3JlcyB0aGUgbGVk\nZ2VyIGZyYWdtZW50cyB0byByZWNvdmVyIGluZGV4ZWQgYnkKICAgICAgICAg\nICAgICAgICAqIHRoZSBzdGFydCBlbnRyeSBJRCBmb3IgdGhlIHJhbmdlLiBU\naGUgZW5zZW1ibGVzIFRyZWVNYXAgaXMKICAgICAgICAgICAgICAgICAqIGtl\neWVkIG9mZiB0aGlzLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAg\nICAgICBmaW5hbCBMaXN0PExvbmc+IGxlZGdlckZyYWdtZW50c1RvUmVjb3Zl\nciA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7CiAgICAgICAgICAgICAgICAv\nKgogICAgICAgICAgICAgICAgICogVGhpcyBNYXAgd2lsbCBzdG9yZSB0aGUg\nc3RhcnQgYW5kIGVuZCBlbnRyeSBJRCB2YWx1ZXMgZm9yCiAgICAgICAgICAg\nICAgICAgKiBlYWNoIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnQgcmFuZ2VzLiBU\naGUgb25seSBleGNlcHRpb24gaXMgdGhlCiAgICAgICAgICAgICAgICAgKiBj\ndXJyZW50IGFjdGl2ZSBmcmFnbWVudCBzaW5jZSBpdCBoYXMgbm8gZW5kIHll\ndC4gSW4gdGhlIGV2ZW50CiAgICAgICAgICAgICAgICAgKiBvZiBhIGJvb2tp\nZSBmYWlsdXJlLCBhIG5ldyBlbnNlbWJsZSBpcyBjcmVhdGVkIHNvIHRoZSBj\ndXJyZW50CiAgICAgICAgICAgICAgICAgKiBlbnNlbWJsZSBzaG91bGQgbm90\nIGNvbnRhaW4gdGhlIGRlYWQgYm9va2llIHdlIGFyZSB0cnlpbmcgdG8KICAg\nICAgICAgICAgICAgICAqIHJlY292ZXIuCiAgICAgICAgICAgICAgICAgKi8K\nICAgICAgICAgICAgICAgIE1hcDxMb25nLCBMb25nPiBsZWRnZXJGcmFnbWVu\ndHNSYW5nZSA9IG5ldyBIYXNoTWFwPExvbmcsIExvbmc+KCk7CiAgICAgICAg\nICAgICAgICBMb25nIGN1ckVudHJ5SWQgPSBudWxsOwogICAgICAgICAgICAg\nICAgZm9yIChNYXAuRW50cnk8TG9uZywgQXJyYXlMaXN0PEluZXRTb2NrZXRB\nZGRyZXNzPj4gZW50cnkgOiBsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVu\nc2VtYmxlcygpCiAgICAgICAgICAgICAgICAgICAgICAgICAuZW50cnlTZXQo\nKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjdXJFbnRyeUlkICE9IG51\nbGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckZyYWdtZW50c1Jh\nbmdlLnB1dChjdXJFbnRyeUlkLCBlbnRyeS5nZXRLZXkoKSAtIDEpOwogICAg\nICAgICAgICAgICAgICAgIGN1ckVudHJ5SWQgPSBlbnRyeS5nZXRLZXkoKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZW50cnkuZ2V0VmFsdWUoKS5jb250\nYWlucyhib29raWVTcmMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8q\nCiAgICAgICAgICAgICAgICAgICAgICAgICAqIEN1cnJlbnQgbGVkZ2VyIGZy\nYWdtZW50IGhhcyBlbnRyaWVzIHN0b3JlZCBvbiB0aGUKICAgICAgICAgICAg\nICAgICAgICAgICAgICogZGVhZCBib29raWUgc28gd2UnbGwgbmVlZCB0byBy\nZWNvdmVyIHRoZW0uCiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAg\nICAgICAgICAgICAgICAgICAgICBsZWRnZXJGcmFnbWVudHNUb1JlY292ZXIu\nYWRkKGVudHJ5LmdldEtleSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBhZGQgbGFzdCBl\nbnNlbWJsZSBvdGhlcndpc2UgaWYgdGhlIGZhaWxlZCBib29raWUgZXhpc3Rl\nZCBpbgogICAgICAgICAgICAgICAgLy8gdGhlIGxhc3QgZW5zZW1ibGUgb2Yg\nYSBjbG9zZWQgbGVkZ2VyLiB0aGUgZW50cmllcyBiZWxvbmdlZCB0bwogICAg\nICAgICAgICAgICAgLy8gbGFzdCBlbnNlbWJsZSB3b3VsZCBub3QgYmUgcmVw\nbGljYXRlZC4KICAgICAgICAgICAgICAgIGlmIChjdXJFbnRyeUlkICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJGcmFnbWVudHNSYW5n\nZS5wdXQoY3VyRW50cnlJZCwgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8qCiAgICAgICAg\nICAgICAgICAgKiBTZWUgaWYgdGhpcyBjdXJyZW50IGxlZGdlciBjb250YWlu\ncyBhbnkgbGVkZ2VyIGZyYWdtZW50IHRoYXQKICAgICAgICAgICAgICAgICAq\nIG5lZWRzIHRvIGJlIHJlLXJlcGxpY2F0ZWQuIElmIG5vdCwgdGhlbiBqdXN0\nIGludm9rZSB0aGUKICAgICAgICAgICAgICAgICAqIG11bHRpQ2FsbGJhY2sg\nYW5kIHJldHVybi4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAg\nICAgaWYgKGxlZGdlckZyYWdtZW50c1RvUmVjb3Zlci5zaXplKCkgPT0gMCkg\newogICAgICAgICAgICAgICAgICAgIGxlZGdlckl0ZXJDYi5wcm9jZXNzUmVz\ndWx0KEJLRXhjZXB0aW9uLkNvZGUuT0ssIG51bGwsIG51bGwpOwogICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICogTXVsdGljYWxsYmFj\nayBmb3IgbGVkZ2VyLiBPbmNlIGFsbCBmcmFnbWVudHMgZm9yIHRoZSBsZWRn\nZXIgaGF2ZSBiZWVuIHJlY292ZXJlZAogICAgICAgICAgICAgICAgICogdHJp\nZ2dlciB0aGUgbGVkZ2VySXRlckNiCiAgICAgICAgICAgICAgICAgKi8KICAg\nICAgICAgICAgICAgIE11bHRpQ2FsbGJhY2sgbGVkZ2VyRnJhZ21lbnRzTWNi\nCiAgICAgICAgICAgICAgICAgICAgPSBuZXcgTXVsdGlDYWxsYmFjayhsZWRn\nZXJGcmFnbWVudHNUb1JlY292ZXIuc2l6ZSgpLCBsZWRnZXJJdGVyQ2IsIG51\nbGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBC\nS0V4Y2VwdGlvbi5Db2RlLk9LLCBCS0V4Y2VwdGlvbi5Db2RlLkxlZGdlclJl\nY292ZXJ5RXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgIC8qCiAgICAgICAg\nICAgICAgICAgKiBOb3cgcmVjb3ZlciBhbGwgb2YgdGhlIG5lY2Vzc2FyeSBs\nZWRnZXIgZnJhZ21lbnRzCiAgICAgICAgICAgICAgICAgKiBhc3luY2hyb25v\ndXNseSB1c2luZyBhIE11bHRpQ2FsbGJhY2sgZm9yIGV2ZXJ5IGZyYWdtZW50\nLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBmb3IgKGZp\nbmFsIExvbmcgc3RhcnRFbnRyeUlkIDogbGVkZ2VyRnJhZ21lbnRzVG9SZWNv\ndmVyKSB7CiAgICAgICAgICAgICAgICAgICAgTG9uZyBlbmRFbnRyeUlkID0g\nbGVkZ2VyRnJhZ21lbnRzUmFuZ2UuZ2V0KHN0YXJ0RW50cnlJZCk7CiAgICAg\nICAgICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgbmV3Qm9va2llID0g\nbnVsbDsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICBuZXdCb29raWUgPSBnZXROZXdCb29raWUobGguZ2V0TGVk\nZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKS5nZXQoc3RhcnRFbnRyeUlk\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGF2YWlsYWJsZUJvb2tpZXMpOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9va2llc0V4Y2Vw\ndGlvbiBia2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyRnJh\nZ21lbnRzTWNiLnByb2Nlc3NSZXN1bHQoQktFeGNlcHRpb24uQ29kZS5Ob3RF\nbm91Z2hCb29raWVzRXhjZXB0aW9uLCAKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVs\nbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAg\nICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJSZXBsaWNhdGluZyBmcmFn\nbWVudCBmcm9tIFsiICsgc3RhcnRFbnRyeUlkIAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyAiLCIgKyBlbmRFbnRyeUlkICsgIl0gb2Yg\nbGVkZ2VyICIgKyBsaC5nZXRJZCgpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICIgdG8gIiArIG5ld0Jvb2tpZSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIExlZGdlckZyYWdtZW50UmVwbGljYXRvci5TaW5n\nbGVGcmFnbWVudENhbGxiYWNrIGNiID0gbmV3IExlZGdlckZyYWdtZW50UmVw\nbGljYXRvci5TaW5nbGVGcmFnbWVudENhbGxiYWNrKAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRzTWNiLCBsaCwg\nc3RhcnRFbnRyeUlkLCBib29raWVTcmMsIG5ld0Jvb2tpZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4g\nY3VycmVudEVuc2VtYmxlID0gIGxoLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0\nRW5zZW1ibGUoc3RhcnRFbnRyeUlkKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgaW50IGJvb2tpZUluZGV4ID0gLTE7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChudWxsICE9IGN1cnJlbnRFbnNlbWJsZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjdXJyZW50\nRW5zZW1ibGUuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoY3VycmVudEVuc2VtYmxlLmdldChpKS5lcXVhbHMo\nYm9va2llU3JjKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBib29raWVJbmRleCA9IGk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBM\nZWRnZXJGcmFnbWVudCBsZWRnZXJGcmFnbWVudCA9IG5ldyBMZWRnZXJGcmFn\nbWVudChsaCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFy\ndEVudHJ5SWQsIGVuZEVudHJ5SWQsIGJvb2tpZUluZGV4KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgYXN5bmNSZWNvdmVyTGVkZ2VyRnJhZ21lbnQobGgs\nIGxlZGdlckZyYWdtZW50LCBjYiwgbmV3Qm9va2llKTsKICAgICAgICAgICAg\nICAgICAgICB9IGNhdGNoKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5p\nbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICB9LCBudWxsKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoaXMgbWV0aG9kIGFzeW5jaHJvbm91c2x5IHJlY292ZXJzIGEg\nbGVkZ2VyIGZyYWdtZW50IHdoaWNoIGlzIGEKICAgICAqIGNvbnRpZ3VvdXMg\ncG9ydGlvbiBvZiBhIGxlZGdlciB0aGF0IHdhcyBzdG9yZWQgaW4gYW4gZW5z\nZW1ibGUgdGhhdAogICAgICogaW5jbHVkZWQgdGhlIGZhaWxlZCBib29raWUu\nCiAgICAgKiAKICAgICAqIEBwYXJhbSBsaAogICAgICogICAgICAgICAgICAt\nIExlZGdlckhhbmRsZSBmb3IgdGhlIGxlZGdlcgogICAgICogQHBhcmFtIGxm\nCiAgICAgKiAgICAgICAgICAgIC0gTGVkZ2VyRnJhZ21lbnQgdG8gcmVwbGlj\nYXRlCiAgICAgKiBAcGFyYW0gbGVkZ2VyRnJhZ21lbnRNY2IKICAgICAqICAg\nICAgICAgICAgLSBNdWx0aUNhbGxiYWNrIHRvIGludm9rZSBvbmNlIHdlJ3Zl\nIHJlY292ZXJlZCB0aGUgY3VycmVudAogICAgICogICAgICAgICAgICBsZWRn\nZXIgZnJhZ21lbnQuCiAgICAgKiBAcGFyYW0gbmV3Qm9va2llCiAgICAgKiAg\nICAgICAgICAgIC0gTmV3IGJvb2tpZSB3ZSB3YW50IHRvIHVzZSB0byByZWNv\ndmVyIGFuZCByZXBsaWNhdGUgdGhlCiAgICAgKiAgICAgICAgICAgIGxlZGdl\nciBlbnRyaWVzIHRoYXQgd2VyZSBzdG9yZWQgb24gdGhlIGZhaWxlZCBib29r\naWUuCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhc3luY1JlY292ZXJMZWRn\nZXJGcmFnbWVudChmaW5hbCBMZWRnZXJIYW5kbGUgbGgsCiAgICAgICAgICAg\nIGZpbmFsIExlZGdlckZyYWdtZW50IGxlZGdlckZyYWdtZW50LAogICAgICAg\nICAgICBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBsZWRnZXJG\ncmFnbWVudE1jYiwKICAgICAgICAgICAgZmluYWwgSW5ldFNvY2tldEFkZHJl\nc3MgbmV3Qm9va2llKSB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewog\nICAgICAgIGxmci5yZXBsaWNhdGUobGgsIGxlZGdlckZyYWdtZW50LCBsZWRn\nZXJGcmFnbWVudE1jYiwgbmV3Qm9va2llKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFJlcGxpY2F0ZSB0aGUgTGVkZ2VyIGZyYWdtZW50IHRvIHRhcmdldCBC\nb29raWUgcGFzc2VkLgogICAgICogCiAgICAgKiBAcGFyYW0gbGgKICAgICAq\nICAgICAgICAgICAgLSBsZWRnZXJIYW5kbGUKICAgICAqIEBwYXJhbSBsZWRn\nZXJGcmFnbWVudAogICAgICogICAgICAgICAgICAtIExlZGdlckZyYWdtZW50\nIHRvIHJlcGxpY2F0ZQogICAgICogQHBhcmFtIHRhcmdldEJvb2tpZUFkZHJl\nc3MKICAgICAqICAgICAgICAgICAgLSB0YXJnZXQgQm9va2llLCB0byB3aGVy\nZSBlbnRyaWVzIHNob3VsZCBiZSByZXBsaWNhdGVkLgogICAgICovCiAgICBw\ndWJsaWMgdm9pZCByZXBsaWNhdGVMZWRnZXJGcmFnbWVudChMZWRnZXJIYW5k\nbGUgbGgsCiAgICAgICAgICAgIGZpbmFsIExlZGdlckZyYWdtZW50IGxlZGdl\nckZyYWdtZW50LAogICAgICAgICAgICBmaW5hbCBJbmV0U29ja2V0QWRkcmVz\ncyB0YXJnZXRCb29raWVBZGRyZXNzKQogICAgICAgICAgICB0aHJvd3MgSW50\nZXJydXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBTeW5j\nQ291bnRlciBzeW5jQ291bnRlciA9IG5ldyBTeW5jQ291bnRlcigpOwogICAg\nICAgIFJlc3VsdENhbGxCYWNrIHJlc3VsdENhbGxCYWNrID0gbmV3IFJlc3Vs\ndENhbGxCYWNrKHN5bmNDb3VudGVyKTsKICAgICAgICBTaW5nbGVGcmFnbWVu\ndENhbGxiYWNrIGNiID0gbmV3IFNpbmdsZUZyYWdtZW50Q2FsbGJhY2socmVz\ndWx0Q2FsbEJhY2ssCiAgICAgICAgICAgICAgICBsaCwgbGVkZ2VyRnJhZ21l\nbnQuZ2V0Rmlyc3RFbnRyeUlkKCksIGxlZGdlckZyYWdtZW50CiAgICAgICAg\nICAgICAgICAgICAgICAgIC5nZXRBZGRyZXNzKCksIHRhcmdldEJvb2tpZUFk\nZHJlc3MpOwogICAgICAgIHN5bmNDb3VudGVyLmluYygpOwogICAgICAgIGFz\neW5jUmVjb3ZlckxlZGdlckZyYWdtZW50KGxoLCBsZWRnZXJGcmFnbWVudCwg\nY2IsIHRhcmdldEJvb2tpZUFkZHJlc3MpOwogICAgICAgIHN5bmNDb3VudGVy\nLmJsb2NrKDApOwogICAgICAgIGlmIChzeW5jQ291bnRlci5nZXRyYygpICE9\nIEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgdGhyb3cgQktF\neGNlcHRpb24uY3JlYXRlKHN5bmNDb3VudGVyLmdldHJjKCkpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKiogVGhpcyBpcyB0aGUgY2xhc3MgZm9yIGdldHRp\nbmcgdGhlIHJlcGxpY2F0aW9uIHJlc3VsdCAqLwogICAgc3RhdGljIGNsYXNz\nIFJlc3VsdENhbGxCYWNrIGltcGxlbWVudHMgQXN5bmNDYWxsYmFjay5Wb2lk\nQ2FsbGJhY2sgewogICAgICAgIHByaXZhdGUgU3luY0NvdW50ZXIgc3luYzsK\nCiAgICAgICAgcHVibGljIFJlc3VsdENhbGxCYWNrKFN5bmNDb3VudGVyIHN5\nbmMpIHsKICAgICAgICAgICAgdGhpcy5zeW5jID0gc3luYzsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHByb2Nl\nc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcywgT2JqZWN0IG9iaikgewogICAg\nICAgICAgICBzeW5jLnNldHJjKHJjKTsKICAgICAgICAgICAgc3luYy5kZWMo\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBGb3JtYXQgdGhl\nIEJvb2tLZWVwZXIgbWV0YWRhdGEgaW4gem9va2VlcGVyCiAgICAgKiAKICAg\nICAqIEBwYXJhbSBpc0ludGVyYWN0aXZlCiAgICAgKiAgICAgICAgICAgIFdo\nZXRoZXIgZm9ybWF0IHNob3VsZCBhc2sgcHJvbXB0IGZvciBjb25maXJtYXRp\nb24gaWYgb2xkIGRhdGEKICAgICAqICAgICAgICAgICAgZXhpc3RzIG9yIG5v\ndC4KICAgICAqIEBwYXJhbSBmb3JjZQogICAgICogICAgICAgICAgICBJZiBu\nb24gaW50ZXJhY3RpdmUgYW5kIGZvcmNlIGlzIHRydWUsIHRoZW4gb2xkIGRh\ndGEgd2lsbCBiZQogICAgICogICAgICAgICAgICByZW1vdmVkIHdpdGhvdXQg\ncHJvbXB0LgogICAgICogQHJldHVybiBSZXR1cm5zIHRydWUgaWYgZm9ybWF0\nIHN1Y2NlZWRzIGVsc2UgZmFsc2UuCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0\naWMgYm9vbGVhbiBmb3JtYXQoQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mLAog\nICAgICAgICAgICBib29sZWFuIGlzSW50ZXJhY3RpdmUsIGJvb2xlYW4gZm9y\nY2UpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFpvb0tlZXBlcldhdGNo\nZXJCYXNlIHcgPSBuZXcgWm9vS2VlcGVyV2F0Y2hlckJhc2UoY29uZi5nZXRa\na1RpbWVvdXQoKSk7CiAgICAgICAgWm9vS2VlcGVyIHprYyA9IFprVXRpbHMu\nY3JlYXRlQ29ubmVjdGVkWm9va2VlcGVyQ2xpZW50KAogICAgICAgICAgICAg\nICAgY29uZi5nZXRaa1NlcnZlcnMoKSwgdyk7CiAgICAgICAgQm9va0tlZXBl\nciBia2MgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2xl\nYW4gbGVkZ2VyUm9vdEV4aXN0cyA9IG51bGwgIT0gemtjLmV4aXN0cygKICAg\nICAgICAgICAgICAgICAgICBjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCks\nIGZhbHNlKTsKICAgICAgICAgICAgYm9vbGVhbiBhdmFpbGFibGVOb2RlRXhp\nc3RzID0gbnVsbCAhPSB6a2MuZXhpc3RzKAogICAgICAgICAgICAgICAgICAg\nIGNvbmYuZ2V0WmtBdmFpbGFibGVCb29raWVzUGF0aCgpLCBmYWxzZSk7Cgog\nICAgICAgICAgICAvLyBDcmVhdGUgbGVkZ2VycyByb290IG5vZGUgaWYgbm90\nIGV4aXN0cwogICAgICAgICAgICBpZiAoIWxlZGdlclJvb3RFeGlzdHMpIHsK\nICAgICAgICAgICAgICAgIHprYy5jcmVhdGUoY29uZi5nZXRaa0xlZGdlcnNS\nb290UGF0aCgpLCAiIi5nZXRCeXRlcygpLAogICAgICAgICAgICAgICAgICAg\nICAgICBJZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RF\nTlQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGNyZWF0ZSBhdmFp\nbGFibGUgYm9va2llcyBub2RlIGlmIG5vdCBleGlzdHMKICAgICAgICAgICAg\naWYgKCFhdmFpbGFibGVOb2RlRXhpc3RzKSB7CiAgICAgICAgICAgICAgICB6\na2MuY3JlYXRlKGNvbmYuZ2V0WmtBdmFpbGFibGVCb29raWVzUGF0aCgpLCAi\nIi5nZXRCeXRlcygpLAogICAgICAgICAgICAgICAgICAgICAgICBJZHMuT1BF\nTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQpOwogICAgICAg\nICAgICB9CgogICAgICAgICAgICAvLyBJZiBvbGQgZGF0YSB3YXMgdGhlcmUg\ndGhlbiBjb25maXJtIHdpdGggYWRtaW4uCiAgICAgICAgICAgIGlmIChsZWRn\nZXJSb290RXhpc3RzKSB7CiAgICAgICAgICAgICAgICBib29sZWFuIGNvbmZp\ncm0gPSBmYWxzZTsKICAgICAgICAgICAgICAgIGlmICghaXNJbnRlcmFjdGl2\nZSkgewogICAgICAgICAgICAgICAgICAgIC8vIElmIG5vbiBpbnRlcmFjdGl2\nZSBhbmQgZm9yY2UgaXMgc2V0LCB0aGVuIGRlbGV0ZSBvbGQKICAgICAgICAg\nICAgICAgICAgICAvLyBkYXRhLgogICAgICAgICAgICAgICAgICAgIGlmIChm\nb3JjZSkgewogICAgICAgICAgICAgICAgICAgICAgICBjb25maXJtID0gdHJ1\nZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICBjb25maXJtID0gZmFsc2U7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBDb25maXJtIHdpdGggdGhlIGFkbWluLgogICAgICAgICAgICAg\nICAgICAgIGNvbmZpcm0gPSBJT1V0aWxzCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAuY29uZmlybVByb21wdCgiTGVkZ2VyIHJvb3QgYWxyZWFkeSBl\neGlzdHMuICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyJBcmUgeW91IHN1cmUgdG8gZm9ybWF0IGJvb2trZWVwZXIgbWV0YWRhdGE/\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyJUaGlz\nIG1heSBjYXVzZSBkYXRhIGxvc3MuIik7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBpZiAoIWNvbmZpcm0pIHsKICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkJvb2tLZWVwZXIgbWV0YWRhdGEgRm9ybWF0IGFi\nb3J0ZWQhISIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBi\na2MgPSBuZXcgQm9va0tlZXBlcihjb25mLCB6a2MpOwogICAgICAgICAgICAv\nLyBGb3JtYXQgYWxsIGxlZGdlciBtZXRhZGF0YSBsYXlvdXQKICAgICAgICAg\nICAgYmtjLmxlZGdlck1hbmFnZXJGYWN0b3J5LmZvcm1hdChjb25mLCB6a2Mp\nOwoKICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIGNvb2tpZXMKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIFpLVXRpbC5kZWxldGVSZWN1cnNp\ndmUoemtjLCBjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkKICAgICAgICAg\nICAgICAgICAgICAgICAgKyAiL2Nvb2tpZXMiKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vTm9kZUV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICBMT0cuZGVidWcoImNvb2tpZXMgbm9kZSBub3QgZXhp\nc3RzIGluIHpvb2tlZXBlciB0byBkZWxldGUiKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgLy8gQ2xlYXIgdGhlIElOU1RBTkNFSUQKICAgICAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgICAgIHprYy5kZWxldGUoY29uZi5nZXRa\na0xlZGdlcnNSb290UGF0aCgpICsgIi8iCiAgICAgICAgICAgICAgICAgICAg\nICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5JTlNUQU5DRUlELCAtMSk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJJTlNUQU5D\nRUlEIG5vdCBleGlzdHMgaW4gem9va2VlcGVyIHRvIGRlbGV0ZSIpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICAvLyBjcmVhdGUgSU5TVEFOQ0VJRAog\nICAgICAgICAgICBTdHJpbmcgaW5zdGFuY2VJZCA9IFVVSUQucmFuZG9tVVVJ\nRCgpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIHprYy5jcmVhdGUoY29uZi5n\nZXRaa0xlZGdlcnNSb290UGF0aCgpICsgIi8iCiAgICAgICAgICAgICAgICAg\nICAgKyBCb29rS2VlcGVyQ29uc3RhbnRzLklOU1RBTkNFSUQsIGluc3RhbmNl\nSWQuZ2V0Qnl0ZXMoKSwKICAgICAgICAgICAgICAgICAgICBJZHMuT1BFTl9B\nQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQpOwoKICAgICAgICAg\nICAgTE9HLmluZm8oIlN1Y2Nlc3NmdWxseSBmb3JtYXR0ZWQgQm9va0tlZXBl\nciBtZXRhZGF0YSIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGlmIChudWxsICE9IGJrYykgewogICAgICAgICAgICAgICAgYmtjLmNsb3Nl\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG51bGwgIT0gemtj\nKSB7CiAgICAgICAgICAgICAgICB6a2MuY2xvc2UoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIHJldHVybnMgYW4gaXRlcmFibGUgb2Jq\nZWN0IGZvciB0aGUgbGlzdCBvZiBsZWRnZXIgaWRlbnRpZmllcnMgb2YKICAg\nICAqIHRoZSBsZWRnZXJzIGN1cnJlbnRseSBhdmFpbGFibGUuCiAgICAgKgog\nICAgICogQHJldHVybiBhbiBpdGVyYWJsZSBvYmplY3QgZm9yIHRoZSBsaXN0\nIG9mIGxlZGdlciBpZGVudGlmaWVycwogICAgICogQHRocm93cyBJT0V4Y2Vw\ndGlvbiAgaWYgdGhlIGxpc3Qgb2YgbGVkZ2VyIGlkZW50aWZpZXJzIGNhbm5v\ndCBiZSByZWFkIGZyb20gdGhlCiAgICAgKiAgbWV0YWRhdGEgc3RvcmUKICAg\nICAqLwogICAgcHVibGljIEl0ZXJhYmxlPExvbmc+IGxpc3RMZWRnZXJzKCkK\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwgTGVkZ2Vy\nUmFuZ2VJdGVyYXRvciBpdGVyYXRvciA9IGJrYy5nZXRMZWRnZXJNYW5hZ2Vy\nKCkuZ2V0TGVkZ2VyUmFuZ2VzKCk7CiAgICAgICAgcmV0dXJuIG5ldyBJdGVy\nYWJsZTxMb25nPigpIHsKICAgICAgICAgICAgcHVibGljIEl0ZXJhdG9yPExv\nbmc+IGl0ZXJhdG9yKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJ\ndGVyYXRvcjxMb25nPigpIHsKICAgICAgICAgICAgICAgICAgICBJdGVyYXRv\ncjxMb25nPiBjdXJyZW50UmFuZ2UgPSBudWxsOwoKICAgICAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNOZXh0KCkgewogICAgICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZXJhdG9yLmhh\nc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5pbmZvKCJJJ20gaW4gdGhpcyBwYXJ0IG9mIik7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRSYW5nZSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJl\nbnRSYW5nZS5oYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVy\ncm9yIHdoaWxlIGNoZWNraW5nIGlmIHRoZXJlIGlzIGEgbmV4dCBlbGVtZW50\nIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAg\nICB9CgogICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyBMb25nIG5leHQoKQogICAgICAgICAgICAgICAg\nICAgIHRocm93cyBOb1N1Y2hFbGVtZW50RXhjZXB0aW9uIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgdHJ5ewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGN1cnJlbnRSYW5nZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY3VycmVudFJhbmdlID0gaXRlcmF0b3IubmV4\ndCgpLmdldExlZGdlcnMoKS5pdGVyYXRvcigpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBMT0cuZXJyb3IoIkVycm9yIHdoaWxlIHJlYWRpbmcgdGhlIG5leHQgZWxl\nbWVudCIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nbmV3IE5vU3VjaEVsZW1lbnRFeGNlcHRpb24oZS5nZXRNZXNzYWdlKCkpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gY3VycmVudFJhbmdlLm5leHQoKTsKICAgICAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZSgpCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3dzIFVuc3VwcG9ydGVkT3BlcmF0aW9uRXhjZXB0\naW9uIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3Vw\ncG9ydGVkT3BlcmF0aW9uRXhjZXB0aW9uKCk7CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAg\nIH07CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHRoZSBtZXRhZGF0\nYSBmb3IgdGhlIHBhc3NlZCBsZWRnZXIgaGFuZGxlCiAgICAgKi8KICAgIHB1\nYmxpYyBMZWRnZXJNZXRhZGF0YSBnZXRMZWRnZXJNZXRhZGF0YShMZWRnZXJI\nYW5kbGUgbGgpIHsKICAgICAgICByZXR1cm4gbGguZ2V0TGVkZ2VyTWV0YWRh\ndGEoKTsKICAgIH0KfQo=\n","encoding":"base64"}

