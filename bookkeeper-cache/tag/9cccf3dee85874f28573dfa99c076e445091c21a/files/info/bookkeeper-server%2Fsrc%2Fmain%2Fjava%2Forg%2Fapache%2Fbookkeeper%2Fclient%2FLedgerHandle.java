{"sha":"5a9c75217ab8aed5c65ad2173bc6ff95e23e564d","node_id":"MDQ6QmxvYjE1NzU5NTY6NWE5Yzc1MjE3YWI4YWVkNWM2NWFkMjE3M2JjNmZmOTVlMjNlNTY0ZA==","size":41571,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/5a9c75217ab8aed5c65ad2173bc6ff95e23e564d","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudDsKCmlt\ncG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEu\nc2VjdXJpdHkuR2VuZXJhbFNlY3VyaXR5RXhjZXB0aW9uOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudExpbmtlZFF1ZXVlOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZh\nLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5RdWV1ZTsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFj\nay5SZWFkTGFzdENvbmZpcm1lZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxs\nYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5\nbmNDYWxsYmFjay5DbG9zZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRp\nb24uQktOb3RFbm91Z2hCb29raWVzRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlck1l\ndGFkYXRhOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5PcmRlcmVkU2FmZUV4\nZWN1dG9yLk9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVQcm90b2NvbDsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9ybWF0cy5M\nZWRnZXJNZXRhZGF0YUZvcm1hdC5TdGF0ZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci51dGlsLlNhZmVSdW5uYWJsZTsKCmltcG9ydCBjb20uZ29v\nZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuUmF0ZUxpbWl0ZXI7CgppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJG\nYWN0b3J5OwoKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5l\nbEJ1ZmZlcjsKCi8qKgogKiBMZWRnZXIgaGFuZGxlIGNvbnRhaW5zIGxlZGdl\nciBtZXRhZGF0YSBhbmQgaXMgdXNlZCB0byBhY2Nlc3MgdGhlIHJlYWQgYW5k\nCiAqIHdyaXRlIG9wZXJhdGlvbnMgdG8gYSBsZWRnZXIuCiAqLwpwdWJsaWMg\nY2xhc3MgTGVkZ2VySGFuZGxlIHsKICAgIGZpbmFsIHN0YXRpYyBMb2dnZXIg\nTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoTGVkZ2VySGFuZGxlLmNs\nYXNzKTsKCiAgICBmaW5hbCBieXRlW10gbGVkZ2VyS2V5OwogICAgTGVkZ2Vy\nTWV0YWRhdGEgbWV0YWRhdGE7CiAgICBmaW5hbCBCb29rS2VlcGVyIGJrOwog\nICAgZmluYWwgbG9uZyBsZWRnZXJJZDsKICAgIGxvbmcgbGFzdEFkZFB1c2hl\nZDsKICAgIGxvbmcgbGFzdEFkZENvbmZpcm1lZDsKICAgIGxvbmcgbGVuZ3Ro\nOwogICAgZmluYWwgRGlnZXN0TWFuYWdlciBtYWNNYW5hZ2VyOwogICAgZmlu\nYWwgRGlzdHJpYnV0aW9uU2NoZWR1bGUgZGlzdHJpYnV0aW9uU2NoZWR1bGU7\nCgogICAgZmluYWwgUmF0ZUxpbWl0ZXIgdGhyb3R0bGVyOwoKICAgIC8qKgog\nICAgICogSW52YWxpZCBlbnRyeSBpZC4gVGhpcyB2YWx1ZSBpcyByZXR1cm5l\nZCBmcm9tIG1ldGhvZHMgd2hpY2gKICAgICAqIHNob3VsZCByZXR1cm4gYW4g\nZW50cnkgaWQgYnV0IHRoZXJlIGlzIG5vIHZhbGlkIGVudHJ5IGF2YWlsYWJs\nZS4KICAgICAqLwogICAgZmluYWwgc3RhdGljIHB1YmxpYyBsb25nIElOVkFM\nSURfRU5UUllfSUQgPSBCb29raWVQcm90b2NvbC5JTlZBTElEX0VOVFJZX0lE\nOwoKICAgIGZpbmFsIEF0b21pY0ludGVnZXIgYmxvY2tBZGRDb21wbGV0aW9u\ncyA9IG5ldyBBdG9taWNJbnRlZ2VyKDApOwogICAgZmluYWwgUXVldWU8UGVu\nZGluZ0FkZE9wPiBwZW5kaW5nQWRkT3BzID0gbmV3IENvbmN1cnJlbnRMaW5r\nZWRRdWV1ZTxQZW5kaW5nQWRkT3A+KCk7CgogICAgTGVkZ2VySGFuZGxlKEJv\nb2tLZWVwZXIgYmssIGxvbmcgbGVkZ2VySWQsIExlZGdlck1ldGFkYXRhIG1l\ndGFkYXRhLAogICAgICAgICAgICAgICAgIERpZ2VzdFR5cGUgZGlnZXN0VHlw\nZSwgYnl0ZVtdIHBhc3N3b3JkKQogICAgICAgICAgICB0aHJvd3MgR2VuZXJh\nbFNlY3VyaXR5RXhjZXB0aW9uLCBOdW1iZXJGb3JtYXRFeGNlcHRpb24gewog\nICAgICAgIHRoaXMuYmsgPSBiazsKICAgICAgICB0aGlzLm1ldGFkYXRhID0g\nbWV0YWRhdGE7CgogICAgICAgIGlmIChtZXRhZGF0YS5pc0Nsb3NlZCgpKSB7\nCiAgICAgICAgICAgIGxhc3RBZGRDb25maXJtZWQgPSBsYXN0QWRkUHVzaGVk\nID0gbWV0YWRhdGEuZ2V0TGFzdEVudHJ5SWQoKTsKICAgICAgICAgICAgbGVu\nZ3RoID0gbWV0YWRhdGEuZ2V0TGVuZ3RoKCk7CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgbGFzdEFkZENvbmZpcm1lZCA9IGxhc3RBZGRQdXNoZWQg\nPSBJTlZBTElEX0VOVFJZX0lEOwogICAgICAgICAgICBsZW5ndGggPSAwOwog\nICAgICAgIH0KCiAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklkOwoK\nICAgICAgICB0aGlzLnRocm90dGxlciA9IFJhdGVMaW1pdGVyLmNyZWF0ZShi\nay5nZXRDb25mKCkuZ2V0VGhyb3R0bGVWYWx1ZSgpKTsKCiAgICAgICAgbWFj\nTWFuYWdlciA9IERpZ2VzdE1hbmFnZXIuaW5zdGFudGlhdGUobGVkZ2VySWQs\nIHBhc3N3b3JkLCBkaWdlc3RUeXBlKTsKICAgICAgICB0aGlzLmxlZGdlcktl\neSA9IE1hY0RpZ2VzdE1hbmFnZXIuZ2VuRGlnZXN0KCJsZWRnZXIiLCBwYXNz\nd29yZCk7CiAgICAgICAgZGlzdHJpYnV0aW9uU2NoZWR1bGUgPSBuZXcgUm91\nbmRSb2JpbkRpc3RyaWJ1dGlvblNjaGVkdWxlKAogICAgICAgICAgICAgICAg\nbWV0YWRhdGEuZ2V0V3JpdGVRdW9ydW1TaXplKCksIG1ldGFkYXRhLmdldEFj\na1F1b3J1bVNpemUoKSwgbWV0YWRhdGEuZ2V0RW5zZW1ibGVTaXplKCkpOwog\nICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSBpZCBvZiB0aGUgY3VycmVu\ndCBsZWRnZXIKICAgICAqCiAgICAgKiBAcmV0dXJuIHRoZSBpZCBvZiB0aGUg\nbGVkZ2VyCiAgICAgKi8KICAgIHB1YmxpYyBsb25nIGdldElkKCkgewogICAg\nICAgIHJldHVybiBsZWRnZXJJZDsKICAgIH0KCiAgICAvKioKICAgICAqIEdl\ndCB0aGUgbGFzdCBjb25maXJtZWQgZW50cnkgaWQgb24gdGhpcyBsZWRnZXIu\nIEl0IHJlYWRzCiAgICAgKiB0aGUgbG9jYWwgc3RhdGUgb2YgdGhlIGxlZGdl\nciBoYW5kbGUsIHdoaWNoIGlzIGRpZmZlcmVudAogICAgICogZnJvbSB0aGUg\ncmVhZExhc3RDb25maXJtZWQgY2FsbC4gSW4gdGhlIGNhc2UgdGhlIGxlZGdl\ncgogICAgICogaXMgbm90IGNsb3NlZCBhbmQgdGhlIGNsaWVudCBpcyBhIHJl\nYWRlciwgaXQgaXMgbmVjZXNzYXJ5CiAgICAgKiB0byBjYWxsIHJlYWRMYXN0\nQ29uZmlybWVkIHRvIG9idGFpbiBhbiBlc3RpbWF0ZSBvZiB0aGUKICAgICAq\nIGxhc3QgYWRkIG9wZXJhdGlvbiB0aGF0IGhhcyBiZWVuIGNvbmZpcm1lZC4K\nICAgICAqCiAgICAgKiBAc2VlICNyZWFkTGFzdENvbmZpcm1lZCgpCiAgICAg\nKgogICAgICogQHJldHVybiB0aGUgbGFzdCBjb25maXJtZWQgZW50cnkgaWQg\nb3Ige0BsaW5rICNJTlZBTElEX0VOVFJZX0lEIElOVkFMSURfRU5UUllfSUR9\nIGlmIG5vIGVudHJ5IGhhcyBiZWVuIGNvbmZpcm1lZAogICAgICovCiAgICBw\ndWJsaWMgbG9uZyBnZXRMYXN0QWRkQ29uZmlybWVkKCkgewogICAgICAgIHJl\ndHVybiBsYXN0QWRkQ29uZmlybWVkOwogICAgfQoKICAgIC8qKgogICAgICog\nR2V0IHRoZSBlbnRyeSBpZCBvZiB0aGUgbGFzdCBlbnRyeSB0aGF0IGhhcyBi\nZWVuIGVucXVldWVkIGZvciBhZGRpdGlvbiAoYnV0CiAgICAgKiBtYXkgbm90\nIGhhdmUgcG9zc2libHkgYmVlbiBwZXJzaXRlZCB0byB0aGUgbGVkZ2VyKQog\nICAgICoKICAgICAqIEByZXR1cm4gdGhlIGlkIG9mIHRoZSBsYXN0IGVudHJ5\nIHB1c2hlZCBvciB7QGxpbmsgI0lOVkFMSURfRU5UUllfSUQgSU5WQUxJRF9F\nTlRSWV9JRH0gaWYgbm8gZW50cnkgaGFzIGJlZW4gcHVzaGVkCiAgICAgKi8K\nICAgIHN5bmNocm9uaXplZCBwdWJsaWMgbG9uZyBnZXRMYXN0QWRkUHVzaGVk\nKCkgewogICAgICAgIHJldHVybiBsYXN0QWRkUHVzaGVkOwogICAgfQoKICAg\nIC8qKgogICAgICogR2V0IHRoZSBMZWRnZXIncyBrZXkvcGFzc3dvcmQuCiAg\nICAgKgogICAgICogQHJldHVybiBieXRlIGFycmF5IGZvciB0aGUgbGVkZ2Vy\nJ3Mga2V5L3Bhc3N3b3JkLgogICAgICovCiAgICBwdWJsaWMgYnl0ZVtdIGdl\ndExlZGdlcktleSgpIHsKICAgICAgICByZXR1cm4gQXJyYXlzLmNvcHlPZihs\nZWRnZXJLZXksIGxlZGdlcktleS5sZW5ndGgpOwogICAgfQoKICAgIC8qKgog\nICAgICogR2V0IHRoZSBMZWRnZXJNZXRhZGF0YQogICAgICoKICAgICAqIEBy\nZXR1cm4gTGVkZ2VyTWV0YWRhdGEgZm9yIHRoZSBMZWRnZXJIYW5kbGUKICAg\nICAqLwogICAgTGVkZ2VyTWV0YWRhdGEgZ2V0TGVkZ2VyTWV0YWRhdGEoKSB7\nCiAgICAgICAgcmV0dXJuIG1ldGFkYXRhOwogICAgfQoKICAgIC8qKgogICAg\nICogR2V0IHRoZSBEaWdlc3RNYW5hZ2VyCiAgICAgKgogICAgICogQHJldHVy\nbiBEaWdlc3RNYW5hZ2VyIGZvciB0aGUgTGVkZ2VySGFuZGxlCiAgICAgKi8K\nICAgIERpZ2VzdE1hbmFnZXIgZ2V0RGlnZXN0TWFuYWdlcigpIHsKICAgICAg\nICByZXR1cm4gbWFjTWFuYWdlcjsKICAgIH0KCiAgICAvKioKICAgICAqICBB\nZGQgdG8gdGhlIGxlbmd0aCBvZiB0aGUgbGVkZ2VyIGluIGJ5dGVzLgogICAg\nICoKICAgICAqIEBwYXJhbSBkZWx0YQogICAgICogQHJldHVybgogICAgICov\nCiAgICBsb25nIGFkZFRvTGVuZ3RoKGxvbmcgZGVsdGEpIHsKICAgICAgICB0\naGlzLmxlbmd0aCArPSBkZWx0YTsKICAgICAgICByZXR1cm4gdGhpcy5sZW5n\ndGg7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSBsZW5ndGgg\nb2YgdGhlIGxlZGdlciBpbiBieXRlcy4KICAgICAqCiAgICAgKiBAcmV0dXJu\nIHRoZSBsZW5ndGggb2YgdGhlIGxlZGdlciBpbiBieXRlcwogICAgICovCiAg\nICBzeW5jaHJvbml6ZWQgcHVibGljIGxvbmcgZ2V0TGVuZ3RoKCkgewogICAg\nICAgIHJldHVybiB0aGlzLmxlbmd0aDsKICAgIH0KCiAgICAvKioKICAgICAq\nIEdldCB0aGUgRGlzdHJpYnV0aW9uIFNjaGVkdWxlCiAgICAgKgogICAgICog\nQHJldHVybiBEaXN0cmlidXRpb25TY2hlZHVsZSBmb3IgdGhlIExlZGdlckhh\nbmRsZQogICAgICovCiAgICBEaXN0cmlidXRpb25TY2hlZHVsZSBnZXREaXN0\ncmlidXRpb25TY2hlZHVsZSgpIHsKICAgICAgICByZXR1cm4gZGlzdHJpYnV0\naW9uU2NoZWR1bGU7CiAgICB9CgogICAgdm9pZCB3cml0ZUxlZGdlckNvbmZp\nZyhHZW5lcmljQ2FsbGJhY2s8Vm9pZD4gd3JpdGVDYikgewogICAgICAgIExP\nRy5kZWJ1ZygiV3JpdGluZyBtZXRhZGF0YSB0byBsZWRnZXIgbWFuYWdlcjog\ne30sIHt9IiwgdGhpcy5sZWRnZXJJZCwgbWV0YWRhdGEuZ2V0VmVyc2lvbigp\nKTsKCiAgICAgICAgYmsuZ2V0TGVkZ2VyTWFuYWdlcigpLndyaXRlTGVkZ2Vy\nTWV0YWRhdGEobGVkZ2VySWQsIG1ldGFkYXRhLCB3cml0ZUNiKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIENsb3NlIHRoaXMgbGVkZ2VyIHN5bmNocm9ub3Vz\nbHkuCiAgICAgKiBAc2VlICNhc3luY0Nsb3NlCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGNsb3NlKCkgCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIFN5bmNDb3VudGVy\nIGNvdW50ZXIgPSBuZXcgU3luY0NvdW50ZXIoKTsKICAgICAgICBjb3VudGVy\nLmluYygpOwoKICAgICAgICBhc3luY0Nsb3NlKG5ldyBTeW5jQ2xvc2VDYWxs\nYmFjaygpLCBjb3VudGVyKTsKCiAgICAgICAgY291bnRlci5ibG9jaygwKTsK\nICAgICAgICBpZiAoY291bnRlci5nZXRyYygpICE9IEJLRXhjZXB0aW9uLkNv\nZGUuT0spIHsKICAgICAgICAgICAgdGhyb3cgQktFeGNlcHRpb24uY3JlYXRl\nKGNvdW50ZXIuZ2V0cmMoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogQXN5bmNocm9ub3VzIGNsb3NlLCBhbnkgYWRkcyBpbiBmbGlnaHQg\nd2lsbCByZXR1cm4gZXJyb3JzLgogICAgICogCiAgICAgKiBDbG9zaW5nIGEg\nbGVkZ2VyIHdpbGwgZW5zdXJlIHRoYXQgYWxsIGNsaWVudHMgYWdyZWUgb24g\nd2hhdCB0aGUgbGFzdCBlbnRyeSAKICAgICAqIG9mIHRoZSBsZWRnZXIgaXMu\nIFRoaXMgZW5zdXJlcyB0aGF0LCBvbmNlIHRoZSBsZWRnZXIgaGFzIGJlZW4g\nY2xvc2VkLCBhbGwgCiAgICAgKiByZWFkcyBmcm9tIHRoZSBsZWRnZXIgd2ls\nbCByZXR1cm4gdGhlIHNhbWUgc2V0IG9mIGVudHJpZXMuIAogICAgICogCiAg\nICAgKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAgIGNhbGxiYWNrIGltcGxl\nbWVudGF0aW9uCiAgICAgKiBAcGFyYW0gY3R4CiAgICAgKiAgICAgICAgICBj\nb250cm9sIG9iamVjdAogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3luY0Nsb3NlKENsb3Nl\nQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICBhc3luY0Nsb3Nl\nSW50ZXJuYWwoY2IsIGN0eCwgQktFeGNlcHRpb24uQ29kZS5MZWRnZXJDbG9z\nZWRFeGNlcHRpb24pOwogICAgfQoKICAgIC8qKgogICAgICogU2FtZSBhcyBw\ndWJsaWMgdmVyc2lvbiBvZiBhc3luY0Nsb3NlIGV4Y2VwdCB0aGF0IHRoaXMg\nb25lIHRha2VzIGFuCiAgICAgKiBhZGRpdGlvbmFsIHBhcmFtZXRlciB3aGlj\naCBpcyB0aGUgcmV0dXJuIGNvZGUgdG8gaGFuZCB0byBhbGwgdGhlIHBlbmRp\nbmcKICAgICAqIGFkZCBvcHMKICAgICAqCiAgICAgKiBAcGFyYW0gY2IKICAg\nICAqIEBwYXJhbSBjdHgKICAgICAqIEBwYXJhbSByYwogICAgICovCiAgICB2\nb2lkIGFzeW5jQ2xvc2VJbnRlcm5hbChmaW5hbCBDbG9zZUNhbGxiYWNrIGNi\nLCBmaW5hbCBPYmplY3QgY3R4LCBmaW5hbCBpbnQgcmMpIHsKICAgICAgICBi\nay5tYWluV29ya2VyUG9vbC5zdWJtaXRPcmRlcmVkKGxlZGdlcklkLCBuZXcg\nU2FmZVJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigpIHsKICAgICAgICAgICAgICAg\nIGZpbmFsIGxvbmcgcHJldkxhc3RFbnRyeUlkOwogICAgICAgICAgICAgICAg\nZmluYWwgbG9uZyBwcmV2TGVuZ3RoOwogICAgICAgICAgICAgICAgZmluYWwg\nU3RhdGUgcHJldlN0YXRlOwogICAgICAgICAgICAgICAgTGlzdDxQZW5kaW5n\nQWRkT3A+IHBlbmRpbmdBZGRzOwoKICAgICAgICAgICAgICAgIHN5bmNocm9u\naXplZChMZWRnZXJIYW5kbGUudGhpcykgewogICAgICAgICAgICAgICAgICAg\nIC8vIGlmIHRoZSBtZXRhZGF0YSBpcyBhbHJlYWR5IGNsb3NlZCwgd2UgZG9u\nJ3QgbmVlZCB0byBwcm9jZWVkIHRoZSBwcm9jZXNzCiAgICAgICAgICAgICAg\nICAgICAgLy8gb3RoZXJ3aXNlLCBpdCBtaWdodCBlbmQgdXAgZW5jb3VudGVy\naW5nIGJhZCB2ZXJzaW9uIGVycm9yIGxvZyBtZXNzYWdlcyB3aGVuIHVwZGF0\naW5nIG1ldGFkYXRhCiAgICAgICAgICAgICAgICAgICAgaWYgKG1ldGFkYXRh\nLmlzQ2xvc2VkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY2IuY2xv\nc2VDb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9LLCBMZWRnZXJIYW5kbGUu\ndGhpcywgY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBwcmV2\nU3RhdGUgPSBtZXRhZGF0YS5nZXRTdGF0ZSgpOwogICAgICAgICAgICAgICAg\nICAgIHByZXZMYXN0RW50cnlJZCA9IG1ldGFkYXRhLmdldExhc3RFbnRyeUlk\nKCk7CiAgICAgICAgICAgICAgICAgICAgcHJldkxlbmd0aCA9IG1ldGFkYXRh\nLmdldExlbmd0aCgpOwoKICAgICAgICAgICAgICAgICAgICAvLyBkcmFpbiBw\nZW5kaW5nIGFkZHMgZmlyc3QKICAgICAgICAgICAgICAgICAgICBwZW5kaW5n\nQWRkcyA9IGRyYWluUGVuZGluZ0FkZHNUb0Vycm9yT3V0KCk7CgogICAgICAg\nICAgICAgICAgICAgIC8vIHN5bmNocm9uaXplZCBvbiBMZWRnZXJIYW5kbGUu\ndGhpcyB0byBlbnN1cmUgdGhhdCAKICAgICAgICAgICAgICAgICAgICAvLyBs\nYXN0QWRkUHVzaGVkIGNhbiBub3QgYmUgdXBkYXRlZCBhZnRlciB0aGUgbWV0\nYWRhdGEgCiAgICAgICAgICAgICAgICAgICAgLy8gaXMgY2xvc2VkLiAKICAg\nICAgICAgICAgICAgICAgICBtZXRhZGF0YS5zZXRMZW5ndGgobGVuZ3RoKTsK\nICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5jbG9zZShsYXN0QWRkQ29u\nZmlybWVkKTsKICAgICAgICAgICAgICAgICAgICBsYXN0QWRkUHVzaGVkID0g\nbGFzdEFkZENvbmZpcm1lZDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAvLyBlcnJvciBvdXQgYWxsIHBlbmRpbmcgYWRkcyBkdXJpbmcg\nY2xvc2luZywgdGhlIGNhbGxiYWNrcyBzaG91bGRuJ3QgYmUKICAgICAgICAg\nICAgICAgIC8vIHJ1bm5pbmcgdW5kZXIgYW55IGJrIGxvY2tzLgogICAgICAg\nICAgICAgICAgZXJyb3JPdXRQZW5kaW5nQWRkcyhyYywgcGVuZGluZ0FkZHMp\nOwoKICAgICAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiQ2xvc2luZyBsZWRn\nZXI6ICIgKyBsZWRnZXJJZCArICIgYXQgZW50cnlJZDogIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIG1ldGFkYXRhLmdldExhc3RFbnRyeUlk\nKCkgKyAiIHdpdGggdGhpcyBtYW55IGJ5dGVzOiAiICsgbWV0YWRhdGEuZ2V0\nTGVuZ3RoKCkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nIGZpbmFsIGNsYXNzIENsb3NlQ2IgZXh0ZW5kcyBPcmRlcmVkU2FmZUdlbmVy\naWNDYWxsYmFjazxWb2lkPiB7CiAgICAgICAgICAgICAgICAgICAgQ2xvc2VD\nYigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VwZXIoYmsubWFpbldv\ncmtlclBvb2wsIGxlZGdlcklkKTsKICAgICAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHNhZmVPcGVyYXRpb25Db21wbGV0ZShmaW5hbCBp\nbnQgcmMsIFZvaWQgcmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4\nY2VwdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVyZWFk\nTWV0YWRhdGEobmV3IE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrPExlZGdl\nck1ldGFkYXRhPihiay5tYWluV29ya2VyUG9vbCwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlT3Bl\ncmF0aW9uQ29tcGxldGUoaW50IG5ld3JjLCBMZWRnZXJNZXRhZGF0YSBuZXdN\nZXRhKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChuZXdyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9y\nIHJlYWRpbmcgbmV3IG1ldGFkYXRhIGZyb20gbGVkZ2VyICIgKyBsZWRnZXJJ\nZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICsgIiB3aGVuIGNsb3NpbmcsIGNvZGU9IiArIG5ld3JjKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLmNsb3Nl\nQ29tcGxldGUocmMsIExlZGdlckhhbmRsZS50aGlzLCBjdHgpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuc2V0\nU3RhdGUocHJldlN0YXRlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChwcmV2U3RhdGUuZXF1YWxzKFN0YXRlLkNMT1NF\nRCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBtZXRhZGF0YS5jbG9zZShwcmV2TGFzdEVudHJ5SWQpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLnNldExl\nbmd0aChwcmV2TGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmICghbWV0YWRhdGEuaXNOZXdlclRoYW4obmV3TWV0\nYSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgJiYgIW1ldGFkYXRhLmlzQ29uZmxpY3RXaXRoKG5ld01ldGEpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gdXNlIHRoZSBuZXcgbWV0YWRhdGEncyBlbnNlbWJsZSwgaW4gY2FzZSBy\nZS1yZXBsaWNhdGlvbiBhbHJlYWR5CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gcmVwbGFjZWQgc29tZSBib29raWVz\nIGluIHRoZSBlbnNlbWJsZS4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBtZXRhZGF0YS5zZXRFbnNlbWJsZXMobmV3TWV0\nYS5nZXRFbnNlbWJsZXMoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuc2V0VmVyc2lvbihuZXdNZXRh\nLnZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG1ldGFkYXRhLnNldExlbmd0aChsZW5ndGgpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFkYXRh\nLmNsb3NlKGxhc3RBZGRDb25maXJtZWQpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlTGVkZ2VyQ29uZmlnKG5l\ndyBDbG9zZUNiKCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuc2V0TGVuZ3RoKGxl\nbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbWV0YWRhdGEuY2xvc2UobGFzdEFkZENvbmZpcm1lZCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndh\ncm4oIkNvbmRpdGlvbmFsIHVwZGF0ZSBsZWRnZXIgbWV0YWRhdGEgZm9yIGxl\nZGdlciAiICsgbGVkZ2VySWQgKyAiIGZhaWxlZC4iKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5jbG9zZUNvbXBs\nZXRlKHJjLCBMZWRnZXJIYW5kbGUudGhpcywgY3R4KTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwog\nICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJjICE9IEJLRXhj\nZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRXJyb3IgdXBkYXRlIGxlZGdlciBtZXRhZGF0YSBmb3Ig\nbGVkZ2VyICIgKyBsZWRnZXJJZCArICIgOiAiICsgcmMpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgY2IuY2xvc2VDb21wbGV0ZShyYywgTGVkZ2Vy\nSGFuZGxlLnRoaXMsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5jbG9zZUNv\nbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuT0ssIExlZGdlckhhbmRsZS50aGlz\nLCBjdHgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAg\nICB3cml0ZUxlZGdlckNvbmZpZyhuZXcgQ2xvc2VDYigpKTsKCiAgICAgICAg\nICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICAqIFJlYWQg\nYSBzZXF1ZW5jZSBvZiBlbnRyaWVzIHN5bmNocm9ub3VzbHkuCiAgICAgKgog\nICAgICogQHBhcmFtIGZpcnN0RW50cnkKICAgICAqICAgICAgICAgIGlkIG9m\nIGZpcnN0IGVudHJ5IG9mIHNlcXVlbmNlIChpbmNsdWRlZCkKICAgICAqIEBw\nYXJhbSBsYXN0RW50cnkKICAgICAqICAgICAgICAgIGlkIG9mIGxhc3QgZW50\ncnkgb2Ygc2VxdWVuY2UgKGluY2x1ZGVkKQogICAgICoKICAgICAqLwogICAg\ncHVibGljIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiByZWFkRW50cmllcyhs\nb25nIGZpcnN0RW50cnksIGxvbmcgbGFzdEVudHJ5KQogICAgICAgICAgICB0\naHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsKICAg\nICAgICBTeW5jQ291bnRlciBjb3VudGVyID0gbmV3IFN5bmNDb3VudGVyKCk7\nCiAgICAgICAgY291bnRlci5pbmMoKTsKCiAgICAgICAgYXN5bmNSZWFkRW50\ncmllcyhmaXJzdEVudHJ5LCBsYXN0RW50cnksIG5ldyBTeW5jUmVhZENhbGxi\nYWNrKCksIGNvdW50ZXIpOwoKICAgICAgICBjb3VudGVyLmJsb2NrKDApOwog\nICAgICAgIGlmIChjb3VudGVyLmdldHJjKCkgIT0gQktFeGNlcHRpb24uQ29k\nZS5PSykgewogICAgICAgICAgICB0aHJvdyBCS0V4Y2VwdGlvbi5jcmVhdGUo\nY291bnRlci5nZXRyYygpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBj\nb3VudGVyLmdldFNlcXVlbmNlKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZWFkIGEgc2VxdWVuY2Ugb2YgZW50cmllcyBhc3luY2hyb25vdXNseS4KICAg\nICAqCiAgICAgKiBAcGFyYW0gZmlyc3RFbnRyeQogICAgICogICAgICAgICAg\naWQgb2YgZmlyc3QgZW50cnkgb2Ygc2VxdWVuY2UKICAgICAqIEBwYXJhbSBs\nYXN0RW50cnkKICAgICAqICAgICAgICAgIGlkIG9mIGxhc3QgZW50cnkgb2Yg\nc2VxdWVuY2UKICAgICAqIEBwYXJhbSBjYgogICAgICogICAgICAgICAgb2Jq\nZWN0IGltcGxlbWVudGluZyByZWFkIGNhbGxiYWNrIGludGVyZmFjZQogICAg\nICogQHBhcmFtIGN0eAogICAgICogICAgICAgICAgY29udHJvbCBvYmplY3QK\nICAgICAqLwogICAgcHVibGljIHZvaWQgYXN5bmNSZWFkRW50cmllcyhsb25n\nIGZpcnN0RW50cnksIGxvbmcgbGFzdEVudHJ5LAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBSZWFkQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgp\nIHsKICAgICAgICAvLyBMaXR0bGUgc2FuaXR5IGNoZWNrCiAgICAgICAgaWYg\nKGZpcnN0RW50cnkgPCAwIHx8IGxhc3RFbnRyeSA+IGxhc3RBZGRDb25maXJt\nZWQKICAgICAgICAgICAgICAgIHx8IGZpcnN0RW50cnkgPiBsYXN0RW50cnkp\nIHsKICAgICAgICAgICAgY2IucmVhZENvbXBsZXRlKEJLRXhjZXB0aW9uLkNv\nZGUuUmVhZEV4Y2VwdGlvbiwgdGhpcywgbnVsbCwgY3R4KTsKICAgICAgICAg\nICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgbmV3IFBlbmRpbmdSZWFkT3AodGhpcywgYmsuc2NoZWR1bGVyLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmaXJzdEVudHJ5LCBsYXN0RW50\ncnksIGNiLCBjdHgpLmluaXRpYXRlKCk7CiAgICAgICAgfSBjYXRjaCAoSW50\nZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBjYi5yZWFkQ29t\ncGxldGUoQktFeGNlcHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4Y2VwdGlvbiwg\ndGhpcywgbnVsbCwgY3R4KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBBZGQgZW50cnkgc3luY2hyb25vdXNseSB0byBhbiBvcGVuIGxlZGdl\nci4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YQogICAgICogICAgICAgICBh\ncnJheSBvZiBieXRlcyB0byBiZSB3cml0dGVuIHRvIHRoZSBsZWRnZXIKICAg\nICAqIEByZXR1cm4gdGhlIGVudHJ5SWQgb2YgdGhlIG5ldyBpbnNlcnRlZCBl\nbnRyeQogICAgICovCiAgICBwdWJsaWMgbG9uZyBhZGRFbnRyeShieXRlW10g\nZGF0YSkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlv\nbiB7CiAgICAgICAgcmV0dXJuIGFkZEVudHJ5KGRhdGEsIDAsIGRhdGEubGVu\nZ3RoKTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBlbnRyeSBzeW5jaHJv\nbm91c2x5IHRvIGFuIG9wZW4gbGVkZ2VyLgogICAgICoKICAgICAqIEBwYXJh\nbSBkYXRhCiAgICAgKiAgICAgICAgIGFycmF5IG9mIGJ5dGVzIHRvIGJlIHdy\naXR0ZW4gdG8gdGhlIGxlZGdlcgogICAgICogQHBhcmFtIG9mZnNldAogICAg\nICogICAgICAgICAgb2Zmc2V0IGZyb20gd2hpY2ggdG8gdGFrZSBieXRlcyBm\ncm9tIGRhdGEKICAgICAqIEBwYXJhbSBsZW5ndGgKICAgICAqICAgICAgICAg\nIG51bWJlciBvZiBieXRlcyB0byB0YWtlIGZyb20gZGF0YQogICAgICogQHJl\ndHVybiB0aGUgZW50cnlJZCBvZiB0aGUgbmV3IGluc2VydGVkIGVudHJ5CiAg\nICAgKi8KICAgIHB1YmxpYyBsb25nIGFkZEVudHJ5KGJ5dGVbXSBkYXRhLCBp\nbnQgb2Zmc2V0LCBpbnQgbGVuZ3RoKQogICAgICAgICAgICB0aHJvd3MgSW50\nZXJydXB0ZWRFeGNlcHRpb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBMT0cu\nZGVidWcoIkFkZGluZyBlbnRyeSB7fSIsIGRhdGEpOwoKICAgICAgICBTeW5j\nQ291bnRlciBjb3VudGVyID0gbmV3IFN5bmNDb3VudGVyKCk7CiAgICAgICAg\nY291bnRlci5pbmMoKTsKCiAgICAgICAgU3luY0FkZENhbGxiYWNrIGNhbGxi\nYWNrID0gbmV3IFN5bmNBZGRDYWxsYmFjaygpOwogICAgICAgIGFzeW5jQWRk\nRW50cnkoZGF0YSwgb2Zmc2V0LCBsZW5ndGgsIGNhbGxiYWNrLCBjb3VudGVy\nKTsKICAgICAgICBjb3VudGVyLmJsb2NrKDApOwogICAgICAgIAogICAgICAg\nIGlmIChjb3VudGVyLmdldHJjKCkgIT0gQktFeGNlcHRpb24uQ29kZS5PSykg\newogICAgICAgICAgICB0aHJvdyBCS0V4Y2VwdGlvbi5jcmVhdGUoY291bnRl\nci5nZXRyYygpKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBjYWxsYmFj\nay5lbnRyeUlkOwogICAgfQoKICAgIC8qKgogICAgICogQWRkIGVudHJ5IGFz\neW5jaHJvbm91c2x5IHRvIGFuIG9wZW4gbGVkZ2VyLgogICAgICoKICAgICAq\nIEBwYXJhbSBkYXRhCiAgICAgKiAgICAgICAgICBhcnJheSBvZiBieXRlcyB0\nbyBiZSB3cml0dGVuCiAgICAgKiBAcGFyYW0gY2IKICAgICAqICAgICAgICAg\nIG9iamVjdCBpbXBsZW1lbnRpbmcgY2FsbGJhY2tpbnRlcmZhY2UKICAgICAq\nIEBwYXJhbSBjdHgKICAgICAqICAgICAgICAgIHNvbWUgY29udHJvbCBvYmpl\nY3QKICAgICAqLwogICAgcHVibGljIHZvaWQgYXN5bmNBZGRFbnRyeShmaW5h\nbCBieXRlW10gZGF0YSwgZmluYWwgQWRkQ2FsbGJhY2sgY2IsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIE9iamVjdCBjdHgpIHsKICAg\nICAgICBhc3luY0FkZEVudHJ5KGRhdGEsIDAsIGRhdGEubGVuZ3RoLCBjYiwg\nY3R4KTsKICAgIH0KCiAgICAvKioKICAgICAqIEFkZCBlbnRyeSBhc3luY2hy\nb25vdXNseSB0byBhbiBvcGVuIGxlZGdlciwgdXNpbmcgYW4gb2Zmc2V0IGFu\nZCByYW5nZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZGF0YQogICAgICogICAg\nICAgICAgYXJyYXkgb2YgYnl0ZXMgdG8gYmUgd3JpdHRlbgogICAgICogQHBh\ncmFtIG9mZnNldAogICAgICogICAgICAgICAgb2Zmc2V0IGZyb20gd2hpY2gg\ndG8gdGFrZSBieXRlcyBmcm9tIGRhdGEKICAgICAqIEBwYXJhbSBsZW5ndGgK\nICAgICAqICAgICAgICAgIG51bWJlciBvZiBieXRlcyB0byB0YWtlIGZyb20g\nZGF0YQogICAgICogQHBhcmFtIGNiCiAgICAgKiAgICAgICAgICBvYmplY3Qg\naW1wbGVtZW50aW5nIGNhbGxiYWNraW50ZXJmYWNlCiAgICAgKiBAcGFyYW0g\nY3R4CiAgICAgKiAgICAgICAgICBzb21lIGNvbnRyb2wgb2JqZWN0CiAgICAg\nKiBAdGhyb3dzIEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBpZiBv\nZmZzZXQgb3IgbGVuZ3RoIGlzIG5lZ2F0aXZlIG9yCiAgICAgKiAgICAgICAg\nICBvZmZzZXQgYW5kIGxlbmd0aCBzdW0gdG8gYSB2YWx1ZSBoaWdoZXIgdGhh\nbiB0aGUgbGVuZ3RoIG9mIGRhdGEuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lk\nIGFzeW5jQWRkRW50cnkoZmluYWwgYnl0ZVtdIGRhdGEsIGZpbmFsIGludCBv\nZmZzZXQsIGZpbmFsIGludCBsZW5ndGgsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZpbmFsIEFkZENhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgUGVuZGluZ0FkZE9wIG9wID0gbmV3IFBlbmRpbmdB\nZGRPcChMZWRnZXJIYW5kbGUudGhpcywgY2IsIGN0eCk7CiAgICAgICAgZG9B\nc3luY0FkZEVudHJ5KG9wLCBkYXRhLCBvZmZzZXQsIGxlbmd0aCwgY2IsIGN0\neCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBNYWtlIGEgcmVjb3ZlcnkgYWRk\nIGVudHJ5IHJlcXVlc3QuIFJlY292ZXJ5IGFkZHMgY2FuIGFkZCB0byBhIGxl\nZGdlciBldmVuIGlmCiAgICAgKiBpdCBoYXMgYmVlbiBmZW5jZWQuCiAgICAg\nKgogICAgICogVGhpcyBpcyBvbmx5IHZhbGlkIGZvciBib29raWUgYW5kIGxl\nZGdlciByZWNvdmVyeSwgd2hpY2ggbWF5IG5lZWQgdG8gcmVwbGljYXRlCiAg\nICAgKiBlbnRyaWVzIHRvIGEgcXVvcnVtIG9mIGJvb2tpZXMgdG8gZW5zdXJl\nIGRhdGEgc2FmZXR5LgogICAgICoKICAgICAqIE5vcm1hbCBjbGllbnQgc2hv\ndWxkIG5ldmVyIGNhbGwgdGhpcyBtZXRob2QuCiAgICAgKi8KICAgIHZvaWQg\nYXN5bmNSZWNvdmVyeUFkZEVudHJ5KGZpbmFsIGJ5dGVbXSBkYXRhLCBmaW5h\nbCBpbnQgb2Zmc2V0LCBmaW5hbCBpbnQgbGVuZ3RoLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZmluYWwgQWRkQ2FsbGJhY2sgY2IsIGZpbmFs\nIE9iamVjdCBjdHgpIHsKICAgICAgICBQZW5kaW5nQWRkT3Agb3AgPSBuZXcg\nUGVuZGluZ0FkZE9wKExlZGdlckhhbmRsZS50aGlzLCBjYiwgY3R4KS5lbmFi\nbGVSZWNvdmVyeUFkZCgpOwogICAgICAgIGRvQXN5bmNBZGRFbnRyeShvcCwg\nZGF0YSwgb2Zmc2V0LCBsZW5ndGgsIGNiLCBjdHgpOwogICAgfQoKICAgIHBy\naXZhdGUgdm9pZCBkb0FzeW5jQWRkRW50cnkoZmluYWwgUGVuZGluZ0FkZE9w\nIG9wLCBmaW5hbCBieXRlW10gZGF0YSwgZmluYWwgaW50IG9mZnNldCwgZmlu\nYWwgaW50IGxlbmd0aCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZmluYWwgQWRkQ2FsbGJhY2sgY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBpZiAob2Zmc2V0IDwgMCB8fCBsZW5ndGggPCAwCiAgICAgICAg\nICAgICAgICB8fCAob2Zmc2V0ICsgbGVuZ3RoKSA+IGRhdGEubGVuZ3RoKSB7\nCiAgICAgICAgICAgIHRocm93IG5ldyBBcnJheUluZGV4T3V0T2ZCb3VuZHNF\neGNlcHRpb24oCiAgICAgICAgICAgICAgICAiSW52YWxpZCB2YWx1ZXMgZm9y\nIG9mZnNldCgiK29mZnNldAogICAgICAgICAgICAgICAgKyIpIG9yIGxlbmd0\naCgiK2xlbmd0aCsiKSIpOwogICAgICAgIH0KICAgICAgICB0aHJvdHRsZXIu\nYWNxdWlyZSgpOwoKICAgICAgICBmaW5hbCBsb25nIGVudHJ5SWQ7CiAgICAg\nICAgZmluYWwgbG9uZyBjdXJyZW50TGVuZ3RoOwogICAgICAgIGJvb2xlYW4g\nd2FzQ2xvc2VkID0gZmFsc2U7CiAgICAgICAgc3luY2hyb25pemVkKHRoaXMp\nIHsKICAgICAgICAgICAgLy8gc3luY2hyb25pemVkIG9uIHRoaXMgdG8gZW5z\ndXJlIHRoYXQKICAgICAgICAgICAgLy8gdGhlIGxlZGdlciBpc24ndCBjbG9z\nZWQgYmV0d2VlbiBjaGVja2luZyBhbmQKICAgICAgICAgICAgLy8gdXBkYXRp\nbmcgbGFzdEFkZFB1c2hlZAogICAgICAgICAgICBpZiAobWV0YWRhdGEuaXND\nbG9zZWQoKSkgewogICAgICAgICAgICAgICAgd2FzQ2xvc2VkID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgIGVudHJ5SWQgPSAtMTsKICAgICAgICAgICAgICAg\nIGN1cnJlbnRMZW5ndGggPSAwOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgZW50cnlJZCA9ICsrbGFzdEFkZFB1c2hlZDsKICAgICAg\nICAgICAgICAgIGN1cnJlbnRMZW5ndGggPSBhZGRUb0xlbmd0aChsZW5ndGgp\nOwogICAgICAgICAgICAgICAgb3Auc2V0RW50cnlJZChlbnRyeUlkKTsKICAg\nICAgICAgICAgICAgIHBlbmRpbmdBZGRPcHMuYWRkKG9wKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHdhc0Nsb3NlZCkgewogICAg\nICAgICAgICBMT0cud2FybigiQXR0ZW1wdCB0byBhZGQgdG8gY2xvc2VkIGxl\nZGdlcjoge30iLCBsZWRnZXJJZCk7CiAgICAgICAgICAgIGNiLmFkZENvbXBs\nZXRlKEJLRXhjZXB0aW9uLkNvZGUuTGVkZ2VyQ2xvc2VkRXhjZXB0aW9uLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICBMZWRnZXJIYW5kbGUudGhpcywg\nSU5WQUxJRF9FTlRSWV9JRCwgY3R4KTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgYmsubWFpbldv\ncmtlclBvb2wuc3VibWl0KG5ldyBTYWZlUnVubmFibGUoKSB7CiAgICAgICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHNhZmVSdW4oKSB7CiAgICAgICAgICAgICAgICAgICAgQ2hhbm5lbEJ1ZmZl\nciB0b1NlbmQgPSBtYWNNYW5hZ2VyLmNvbXB1dGVEaWdlc3RBbmRQYWNrYWdl\nRm9yU2VuZGluZygKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBlbnRyeUlkLCBsYXN0QWRkQ29uZmlybWVkLCBjdXJy\nZW50TGVuZ3RoLCBkYXRhLCBvZmZzZXQsIGxlbmd0aCk7CiAgICAgICAgICAg\nICAgICAgICAgb3AuaW5pdGlhdGUodG9TZW5kLCBsZW5ndGgpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoIChS\ndW50aW1lRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgY2IuYWRkQ29tcGxl\ndGUoQktFeGNlcHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4Y2VwdGlvbiwKICAg\nICAgICAgICAgICAgICAgICBMZWRnZXJIYW5kbGUudGhpcywgSU5WQUxJRF9F\nTlRSWV9JRCwgY3R4KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBPYnRhaW5zIGFzeW5jaHJvbm91c2x5IHRoZSBsYXN0IGNvbmZpcm1lZCB3\ncml0ZSBmcm9tIGEgcXVvcnVtIG9mIGJvb2tpZXMuIFRoaXMgCiAgICAgKiBj\nYWxsIG9idGFpbnMgdGhlIHRoZSBsYXN0IGFkZCBjb25maXJtZWQgZWFjaCBi\nb29raWUgaGFzIHJlY2VpdmVkIGZvciB0aGlzIGxlZGdlcgogICAgICogYW5k\nIHJldHVybnMgdGhlIG1heGltdW0uIElmIHRoZSBsZWRnZXIgaGFzIGJlZW4g\nY2xvc2VkLCB0aGUgdmFsdWUgcmV0dXJuZWQgYnkgdGhpcwogICAgICogY2Fs\nbCBtYXkgbm90IGNvcnJlc3BvbmQgdG8gdGhlIGlkIG9mIHRoZSBsYXN0IGVu\ndHJ5IG9mIHRoZSBsZWRnZXIsIHNpbmNlIGl0IHJlYWRzCiAgICAgKiB0aGUg\naGludCBvZiBib29raWVzLiBDb25zZXF1ZW50bHksIGluIHRoZSBjYXNlIHRo\nZSBsZWRnZXIgaGFzIGJlZW4gY2xvc2VkLCBpdCBtYXkgCiAgICAgKiByZXR1\ncm4gYSBkaWZmZXJlbnQgdmFsdWUgdGhhbiBnZXRMYXN0QWRkQ29uZmlybWVk\nLCB3aGljaCByZXR1cm5zIHRoZSBsb2NhbCB2YWx1ZSAKICAgICAqIG9mIHRo\nZSBsZWRnZXIgaGFuZGxlLgogICAgICogCiAgICAgKiBAc2VlICNnZXRMYXN0\nQWRkQ29uZmlybWVkKCkKICAgICAqCiAgICAgKiBAcGFyYW0gY2IKICAgICAq\nIEBwYXJhbSBjdHgKICAgICAqLwoKICAgIHB1YmxpYyB2b2lkIGFzeW5jUmVh\nZExhc3RDb25maXJtZWQoZmluYWwgUmVhZExhc3RDb25maXJtZWRDYWxsYmFj\nayBjYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIGJvb2xlYW4gaXND\nbG9zZWQ7CiAgICAgICAgbG9uZyBsYXN0RW50cnlJZDsKICAgICAgICBzeW5j\naHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaXNDbG9zZWQgPSBtZXRh\nZGF0YS5pc0Nsb3NlZCgpOwogICAgICAgICAgICBsYXN0RW50cnlJZCA9IG1l\ndGFkYXRhLmdldExhc3RFbnRyeUlkKCk7CiAgICAgICAgfQogICAgICAgIGlm\nIChpc0Nsb3NlZCkgewogICAgICAgICAgICBjYi5yZWFkTGFzdENvbmZpcm1l\nZENvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuT0ssIGxhc3RFbnRyeUlkLCBj\ndHgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIFJl\nYWRMYXN0Q29uZmlybWVkT3AuTGFzdENvbmZpcm1lZERhdGFDYWxsYmFjayBp\nbm5lcmNiID0gbmV3IFJlYWRMYXN0Q29uZmlybWVkT3AuTGFzdENvbmZpcm1l\nZERhdGFDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJtZWRE\nYXRhQ29tcGxldGUoaW50IHJjLCBEaWdlc3RNYW5hZ2VyLlJlY292ZXJ5RGF0\nYSBkYXRhKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJLRXhj\nZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFz\ndEFkZENvbmZpcm1lZCA9IE1hdGgubWF4KGxhc3RBZGRDb25maXJtZWQsIGRh\ndGEubGFzdEFkZENvbmZpcm1lZCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGxhc3RBZGRQdXNoZWQgPSBNYXRoLm1heChsYXN0QWRkUHVzaGVkLCBkYXRh\nLmxhc3RBZGRDb25maXJtZWQpOwogICAgICAgICAgICAgICAgICAgICAgICBs\nZW5ndGggPSBNYXRoLm1heChsZW5ndGgsIGRhdGEubGVuZ3RoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgY2IucmVhZExhc3RDb25maXJtZWRDb21wbGV0\nZShyYywgZGF0YS5sYXN0QWRkQ29uZmlybWVkLCBjdHgpOwogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNi\nLnJlYWRMYXN0Q29uZmlybWVkQ29tcGxldGUocmMsIElOVkFMSURfRU5UUllf\nSUQsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9OwogICAgICAgIG5ldyBSZWFkTGFzdENvbmZp\ncm1lZE9wKHRoaXMsIGlubmVyY2IpLmluaXRpYXRlKCk7CiAgICB9CgoKICAg\nIC8qKgogICAgICogQ29udGV4dCBvYmplY3RzIGZvciBzeW5jaHJvbm91cyBj\nYWxsIHRvIHJlYWQgbGFzdCBjb25maXJtZWQuCiAgICAgKi8KICAgIHN0YXRp\nYyBjbGFzcyBMYXN0Q29uZmlybWVkQ3R4IHsKICAgICAgICBmaW5hbCBzdGF0\naWMgbG9uZyBFTlRSWV9JRF9QRU5ESU5HID0gLTEwOwogICAgICAgIGxvbmcg\ncmVzcG9uc2U7CiAgICAgICAgaW50IHJjOwoKICAgICAgICBMYXN0Q29uZmly\nbWVkQ3R4KCkgewogICAgICAgICAgICB0aGlzLnJlc3BvbnNlID0gRU5UUllf\nSURfUEVORElORzsKICAgICAgICB9CgogICAgICAgIHZvaWQgc2V0TGFzdENv\nbmZpcm1lZChsb25nIGxhc3RDb25maXJtZWQpIHsKICAgICAgICAgICAgdGhp\ncy5yZXNwb25zZSA9IGxhc3RDb25maXJtZWQ7CiAgICAgICAgfQoKICAgICAg\nICBsb25nIGdldGxhc3RDb25maXJtZWQoKSB7CiAgICAgICAgICAgIHJldHVy\nbiB0aGlzLnJlc3BvbnNlOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzZXRS\nQyhpbnQgcmMpIHsKICAgICAgICAgICAgdGhpcy5yYyA9IHJjOwogICAgICAg\nIH0KCiAgICAgICAgaW50IGdldFJDKCkgewogICAgICAgICAgICByZXR1cm4g\ndGhpcy5yYzsKICAgICAgICB9CgogICAgICAgIGJvb2xlYW4gcmVhZHkoKSB7\nCiAgICAgICAgICAgIHJldHVybiAodGhpcy5yZXNwb25zZSAhPSBFTlRSWV9J\nRF9QRU5ESU5HKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBP\nYnRhaW5zIHN5bmNocm9ub3VzbHkgdGhlIGxhc3QgY29uZmlybWVkIHdyaXRl\nIGZyb20gYSBxdW9ydW0gb2YgYm9va2llcy4gVGhpcyBjYWxsCiAgICAgKiBv\nYnRhaW5zIHRoZSB0aGUgbGFzdCBhZGQgY29uZmlybWVkIGVhY2ggYm9va2ll\nIGhhcyByZWNlaXZlZCBmb3IgdGhpcyBsZWRnZXIKICAgICAqIGFuZCByZXR1\ncm5zIHRoZSBtYXhpbXVtLiBJZiB0aGUgbGVkZ2VyIGhhcyBiZWVuIGNsb3Nl\nZCwgdGhlIHZhbHVlIHJldHVybmVkIGJ5IHRoaXMKICAgICAqIGNhbGwgbWF5\nIG5vdCBjb3JyZXNwb25kIHRvIHRoZSBpZCBvZiB0aGUgbGFzdCBlbnRyeSBv\nZiB0aGUgbGVkZ2VyLCBzaW5jZSBpdCByZWFkcwogICAgICogdGhlIGhpbnQg\nb2YgYm9va2llcy4gQ29uc2VxdWVudGx5LCBpbiB0aGUgY2FzZSB0aGUgbGVk\nZ2VyIGhhcyBiZWVuIGNsb3NlZCwgaXQgbWF5IAogICAgICogcmV0dXJuIGEg\nZGlmZmVyZW50IHZhbHVlIHRoYW4gZ2V0TGFzdEFkZENvbmZpcm1lZCwgd2hp\nY2ggcmV0dXJucyB0aGUgbG9jYWwgdmFsdWUgCiAgICAgKiBvZiB0aGUgbGVk\nZ2VyIGhhbmRsZS4KICAgICAqIAogICAgICogQHNlZSAjZ2V0TGFzdEFkZENv\nbmZpcm1lZCgpCiAgICAgKiAKICAgICAqIEByZXR1cm4gVGhlIGVudHJ5IGlk\nIG9mIHRoZSBsYXN0IGNvbmZpcm1lZCB3cml0ZSBvciB7QGxpbmsgI0lOVkFM\nSURfRU5UUllfSUQgSU5WQUxJRF9FTlRSWV9JRH0KICAgICAqICAgICAgICAg\naWYgbm8gZW50cnkgaGFzIGJlZW4gY29uZmlybWVkCiAgICAgKiBAdGhyb3dz\nIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIEJLRXhjZXB0\naW9uCiAgICAgKi8KICAgIAogICAgcHVibGljIGxvbmcgcmVhZExhc3RDb25m\naXJtZWQoKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRp\nb24sIEJLRXhjZXB0aW9uIHsKICAgICAgICBMYXN0Q29uZmlybWVkQ3R4IGN0\neCA9IG5ldyBMYXN0Q29uZmlybWVkQ3R4KCk7CiAgICAgICAgYXN5bmNSZWFk\nTGFzdENvbmZpcm1lZChuZXcgU3luY1JlYWRMYXN0Q29uZmlybWVkQ2FsbGJh\nY2soKSwgY3R4KTsKICAgICAgICBzeW5jaHJvbml6ZWQoY3R4KSB7CiAgICAg\nICAgICAgIHdoaWxlKCFjdHgucmVhZHkoKSkgewogICAgICAgICAgICAgICAg\nY3R4LndhaXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAg\naWYoY3R4LmdldFJDKCkgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgdGhyb3cg\nQktFeGNlcHRpb24uY3JlYXRlKGN0eC5nZXRSQygpKTsKICAgICAgICByZXR1\ncm4gY3R4LmdldGxhc3RDb25maXJtZWQoKTsKICAgIH0KCiAgICAvLyBjbG9z\nZSB0aGUgbGVkZ2VyIGFuZCBzZW5kIGZhaWxzIHRvIGFsbCB0aGUgYWRkcyBp\nbiB0aGUgcGlwZWxpbmUKICAgIHZvaWQgaGFuZGxlVW5yZWNvdmVyYWJsZUVy\ncm9yRHVyaW5nQWRkKGludCByYykgewogICAgICAgIGlmIChtZXRhZGF0YS5p\nc0luUmVjb3ZlcnkoKSkgewogICAgICAgICAgICAvLyB3ZSBzaG91bGQgbm90\nIGNsb3NlIGxlZGdlciBpZiBsZWRnZXIgaXMgcmVjb3ZlcnkgbW9kZQogICAg\nICAgICAgICAvLyBvdGhlcndpc2Ugd2UgbWF5IGxvc2UgZW50cnkuCiAgICAg\nICAgICAgIGVycm9yT3V0UGVuZGluZ0FkZHMocmMpOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQogICAgICAgIExPRy5lcnJvcigiQ2xvc2luZyBs\nZWRnZXIge30gZHVlIHRvIGVycm9yIHt9IiwgbGVkZ2VySWQsIHJjKTsKICAg\nICAgICBhc3luY0Nsb3NlSW50ZXJuYWwoTm9vcENsb3NlQ2FsbGJhY2suaW5z\ndGFuY2UsIG51bGwsIHJjKTsKICAgIH0KCiAgICB2b2lkIGVycm9yT3V0UGVu\nZGluZ0FkZHMoaW50IHJjKSB7CiAgICAgICAgZXJyb3JPdXRQZW5kaW5nQWRk\ncyhyYywgZHJhaW5QZW5kaW5nQWRkc1RvRXJyb3JPdXQoKSk7CiAgICB9Cgog\nICAgc3luY2hyb25pemVkIExpc3Q8UGVuZGluZ0FkZE9wPiBkcmFpblBlbmRp\nbmdBZGRzVG9FcnJvck91dCgpIHsKICAgICAgICBQZW5kaW5nQWRkT3AgcGVu\nZGluZ0FkZE9wOwogICAgICAgIExpc3Q8UGVuZGluZ0FkZE9wPiBvcHNEcmFp\nbmVkID0gbmV3IEFycmF5TGlzdDxQZW5kaW5nQWRkT3A+KHBlbmRpbmdBZGRP\ncHMuc2l6ZSgpKTsKICAgICAgICB3aGlsZSAoKHBlbmRpbmdBZGRPcCA9IHBl\nbmRpbmdBZGRPcHMucG9sbCgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgIGFk\nZFRvTGVuZ3RoKC1wZW5kaW5nQWRkT3AuZW50cnlMZW5ndGgpOwogICAgICAg\nICAgICBvcHNEcmFpbmVkLmFkZChwZW5kaW5nQWRkT3ApOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gb3BzRHJhaW5lZDsKICAgIH0KCiAgICB2b2lkIGVy\ncm9yT3V0UGVuZGluZ0FkZHMoaW50IHJjLCBMaXN0PFBlbmRpbmdBZGRPcD4g\nb3BzKSB7CiAgICAgICAgZm9yIChQZW5kaW5nQWRkT3Agb3AgOiBvcHMpIHsK\nICAgICAgICAgICAgb3Auc3VibWl0Q2FsbGJhY2socmMpOwogICAgICAgIH0K\nICAgIH0KCiAgICB2b2lkIHNlbmRBZGRTdWNjZXNzQ2FsbGJhY2tzKCkgewog\nICAgICAgIC8vIFN0YXJ0IGZyb20gdGhlIGhlYWQgb2YgdGhlIHF1ZXVlIGFu\nZCBwcm9jZWVkIHdoaWxlIHRoZXJlIGFyZQogICAgICAgIC8vIGVudHJpZXMg\ndGhhdCBoYXZlIGhhZCBhbGwgdGhlaXIgcmVzcG9uc2VzIGNvbWUgYmFjawog\nICAgICAgIFBlbmRpbmdBZGRPcCBwZW5kaW5nQWRkT3A7CiAgICAgICAgd2hp\nbGUgKChwZW5kaW5nQWRkT3AgPSBwZW5kaW5nQWRkT3BzLnBlZWsoKSkgIT0g\nbnVsbAogICAgICAgICAgICAgICAmJiBibG9ja0FkZENvbXBsZXRpb25zLmdl\ndCgpID09IDApIHsKICAgICAgICAgICAgaWYgKCFwZW5kaW5nQWRkT3AuY29t\ncGxldGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgcGVuZGluZ0FkZE9wcy5yZW1vdmUoKTsKICAgICAg\nICAgICAgbGFzdEFkZENvbmZpcm1lZCA9IHBlbmRpbmdBZGRPcC5lbnRyeUlk\nOwogICAgICAgICAgICBwZW5kaW5nQWRkT3Auc3VibWl0Q2FsbGJhY2soQktF\neGNlcHRpb24uQ29kZS5PSyk7CiAgICAgICAgfQoKICAgIH0KCiAgICBBcnJh\neUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IHJlcGxhY2VCb29raWVJbk1ldGFk\nYXRhKGZpbmFsIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIGZpbmFsIGludCBi\nb29raWVJbmRleCkKICAgICAgICAgICAgdGhyb3dzIEJLRXhjZXB0aW9uLkJL\nTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbiB7CiAgICAgICAgSW5ldFNvY2tl\ndEFkZHJlc3MgbmV3Qm9va2llOwogICAgICAgIExPRy5pbmZvKCJIYW5kbGlu\nZyBmYWlsdXJlIG9mIGJvb2tpZToge30gaW5kZXg6IHt9IiwgYWRkciwgYm9v\na2llSW5kZXgpOwogICAgICAgIGZpbmFsIEFycmF5TGlzdDxJbmV0U29ja2V0\nQWRkcmVzcz4gbmV3RW5zZW1ibGUgPSBuZXcgQXJyYXlMaXN0PEluZXRTb2Nr\nZXRBZGRyZXNzPigpOwogICAgICAgIGZpbmFsIGxvbmcgbmV3RW5zZW1ibGVT\ndGFydEVudHJ5ID0gbGFzdEFkZENvbmZpcm1lZCArIDE7CgogICAgICAgIC8v\nIGF2b2lkIHBhcmFsbGVsIGVuc2VtYmxlIGNoYW5nZXMgdG8gc2FtZSBlbnNl\nbWJsZS4KICAgICAgICBzeW5jaHJvbml6ZWQgKG1ldGFkYXRhKSB7CiAgICAg\nICAgICAgIG5ld0Jvb2tpZSA9IGJrLmJvb2tpZVdhdGNoZXIuZ2V0QWRkaXRp\nb25hbEJvb2tpZShtZXRhZGF0YS5jdXJyZW50RW5zZW1ibGUpOwoKICAgICAg\nICAgICAgbmV3RW5zZW1ibGUuYWRkQWxsKG1ldGFkYXRhLmN1cnJlbnRFbnNl\nbWJsZSk7CiAgICAgICAgICAgIG5ld0Vuc2VtYmxlLnNldChib29raWVJbmRl\neCwgbmV3Qm9va2llKTsKCiAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0Vu\nYWJsZWQoKSkgewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJDaGFuZ2lu\nZyBlbnNlbWJsZSBmcm9tOiAiICsgbWV0YWRhdGEuY3VycmVudEVuc2VtYmxl\nCiAgICAgICAgICAgICAgICAgICAgICAgICsgIiB0bzogIiArIG5ld0Vuc2Vt\nYmxlICsgIiBmb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQKICAgICAgICAgICAg\nICAgICAgICAgICAgKyAiIHN0YXJ0aW5nIGF0IGVudHJ5OiAiICsgKGxhc3RB\nZGRDb25maXJtZWQgKyAxKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIG1ldGFkYXRhLmFkZEVuc2VtYmxlKG5ld0Vuc2VtYmxlU3RhcnRFbnRyeSwg\nbmV3RW5zZW1ibGUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3RW5z\nZW1ibGU7CiAgICB9CgogICAgdm9pZCBoYW5kbGVCb29raWVGYWlsdXJlKGZp\nbmFsIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIGZpbmFsIGludCBib29raWVJ\nbmRleCkgewogICAgICAgIGJsb2NrQWRkQ29tcGxldGlvbnMuaW5jcmVtZW50\nQW5kR2V0KCk7CgogICAgICAgIHN5bmNocm9uaXplZCAobWV0YWRhdGEpIHsK\nICAgICAgICAgICAgaWYgKCFtZXRhZGF0YS5jdXJyZW50RW5zZW1ibGUuZ2V0\nKGJvb2tpZUluZGV4KS5lcXVhbHMoYWRkcikpIHsKICAgICAgICAgICAgICAg\nIC8vIGVuc2VtYmxlIGhhcyBhbHJlYWR5IGNoYW5nZWQsIGZhaWx1cmUgb2Yg\ndGhpcyBhZGRyIGlzIGltbWF0ZXJpYWwKICAgICAgICAgICAgICAgIExPRy53\nYXJuKCJXcml0ZSBkaWQgbm90IHN1Y2NlZWQgdG8ge30sIGJvb2tpZUluZGV4\nIHt9LCBidXQgd2UgaGF2ZSBhbHJlYWR5IGZpeGVkIGl0LiIsCiAgICAgICAg\nICAgICAgICAgICAgICAgICBhZGRyLCBib29raWVJbmRleCk7CiAgICAgICAg\nICAgICAgICBibG9ja0FkZENvbXBsZXRpb25zLmRlY3JlbWVudEFuZEdldCgp\nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgQXJyYXlMaXN0PEluZXRT\nb2NrZXRBZGRyZXNzPiBuZXdFbnNlbWJsZSA9IHJlcGxhY2VCb29raWVJbk1l\ndGFkYXRhKGFkZHIsIGJvb2tpZUluZGV4KTsKCiAgICAgICAgICAgICAgICBF\nbnNlbWJsZUluZm8gZW5zZW1ibGVJbmZvID0gbmV3IEVuc2VtYmxlSW5mbyhu\nZXdFbnNlbWJsZSwgYm9va2llSW5kZXgsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRy\nKTsKICAgICAgICAgICAgICAgIHdyaXRlTGVkZ2VyQ29uZmlnKG5ldyBDaGFu\nZ2VFbnNlbWJsZUNiKGVuc2VtYmxlSW5mbykpOwogICAgICAgICAgICB9IGNh\ndGNoIChCS0V4Y2VwdGlvbi5CS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3QgZ2V0\nIGFkZGl0aW9uYWwgYm9va2llIHRvICIKICAgICAgICAgICAgICAgICAgICAg\nICAgICArICJyZW1ha2UgZW5zZW1ibGUsIGNsb3NpbmcgbGVkZ2VyOiAiICsg\nbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgaGFuZGxlVW5yZWNvdmVyYWJs\nZUVycm9yRHVyaW5nQWRkKGUuZ2V0Q29kZSgpKTsKICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nLyBDb250YWlucyBuZXdseSByZWZvcm1lZCBlbnNlbWJsZSwgYm9va2llSW5k\nZXgsIGZhaWxlZEJvb2tpZUFkZHJlc3MKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIGNsYXNzIEVuc2VtYmxlSW5mbyB7CiAgICAgICAgcHJpdmF0ZSBmaW5h\nbCBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IG5ld0Vuc2VtYmxlOwog\nICAgICAgIHByaXZhdGUgZmluYWwgaW50IGJvb2tpZUluZGV4OwogICAgICAg\nIHByaXZhdGUgZmluYWwgSW5ldFNvY2tldEFkZHJlc3MgYWRkcjsKCiAgICAg\nICAgcHVibGljIEVuc2VtYmxlSW5mbyhBcnJheUxpc3Q8SW5ldFNvY2tldEFk\nZHJlc3M+IG5ld0Vuc2VtYmxlLAogICAgICAgICAgICAgICAgaW50IGJvb2tp\nZUluZGV4LCBJbmV0U29ja2V0QWRkcmVzcyBhZGRyKSB7CiAgICAgICAgICAg\nIHRoaXMubmV3RW5zZW1ibGUgPSBuZXdFbnNlbWJsZTsKICAgICAgICAgICAg\ndGhpcy5ib29raWVJbmRleCA9IGJvb2tpZUluZGV4OwogICAgICAgICAgICB0\naGlzLmFkZHIgPSBhZGRyOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIENhbGxiYWNrIHdoaWNoIGlzIHVwZGF0aW5nIHRoZSBsZWRnZXJNZXRh\nZGF0YSBpbiB6ayB3aXRoIHRoZSBuZXdseQogICAgICogcmVmb3JtZWQgZW5z\nZW1ibGUuIE9uIE1ldGFkYXRhVmVyc2lvbkV4Y2VwdGlvbiwgd2lsbCByZXJl\nYWQgbGF0ZXN0CiAgICAgKiBsZWRnZXJNZXRhZGF0YSBhbmQgYWN0IHVwb24u\nCiAgICAgKi8KICAgIHByaXZhdGUgZmluYWwgY2xhc3MgQ2hhbmdlRW5zZW1i\nbGVDYiBleHRlbmRzIE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrPFZvaWQ+\nIHsKICAgICAgICBwcml2YXRlIGZpbmFsIEVuc2VtYmxlSW5mbyBlbnNlbWJs\nZUluZm87CgogICAgICAgIENoYW5nZUVuc2VtYmxlQ2IoRW5zZW1ibGVJbmZv\nIGVuc2VtYmxlSW5mbykgewogICAgICAgICAgICBzdXBlcihiay5tYWluV29y\na2VyUG9vbCwgbGVkZ2VySWQpOwogICAgICAgICAgICB0aGlzLmVuc2VtYmxl\nSW5mbyA9IGVuc2VtYmxlSW5mbzsKICAgICAgICB9CgogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHNhZmVPcGVyYXRpb25Db21wbGV0\nZShmaW5hbCBpbnQgcmMsIFZvaWQgcmVzdWx0KSB7CiAgICAgICAgICAgIGlm\nIChyYyA9PSBCS0V4Y2VwdGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4Y2Vw\ndGlvbikgewogICAgICAgICAgICAgICAgcmVyZWFkTWV0YWRhdGEobmV3IFJl\nUmVhZExlZGdlck1ldGFkYXRhQ2IocmMsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGVuc2VtYmxlSW5mbykpOwogICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICB9IGVsc2UgaWYgKHJjICE9IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiQ291bGQgbm90IHBlcnNpc3QgbGVkZ2VyIG1ldGFkYXRhIHdoaWxlICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICArICJjaGFuZ2luZyBlbnNlbWJs\nZSB0bzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICsgZW5zZW1ibGVJ\nbmZvLm5ld0Vuc2VtYmxlCiAgICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nICwgY2xvc2luZyBsZWRnZXIiKTsKICAgICAgICAgICAgICAgIGhhbmRsZVVu\ncmVjb3ZlcmFibGVFcnJvckR1cmluZ0FkZChyYyk7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYmxvY2tBZGRD\nb21wbGV0aW9ucy5kZWNyZW1lbnRBbmRHZXQoKTsKCiAgICAgICAgICAgIC8v\nIHRoZSBmYWlsZWQgYm9va2llIGhhcyBiZWVuIHJlcGxhY2VkCiAgICAgICAg\nICAgIHVuc2V0U3VjY2Vzc0FuZFNlbmRXcml0ZVJlcXVlc3QoZW5zZW1ibGVJ\nbmZvLmJvb2tpZUluZGV4KTsKICAgICAgICB9CiAgICB9OwoKICAgIC8qKgog\nICAgICogQ2FsbGJhY2sgd2hpY2ggaXMgcmVhZGluZyB0aGUgbGVkZ2VyTWV0\nYWRhdGEgcHJlc2VudCBpbiB6ay4gVGhpcyB3aWxsIHRyeQogICAgICogdG8g\ncmVzb2x2ZSB0aGUgdmVyc2lvbiBjb25mbGljdHMuCiAgICAgKi8KICAgIHBy\naXZhdGUgZmluYWwgY2xhc3MgUmVSZWFkTGVkZ2VyTWV0YWRhdGFDYiBleHRl\nbmRzIE9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrPExlZGdlck1ldGFkYXRh\nPiB7CiAgICAgICAgcHJpdmF0ZSBmaW5hbCBpbnQgcmM7CiAgICAgICAgcHJp\ndmF0ZSBmaW5hbCBFbnNlbWJsZUluZm8gZW5zZW1ibGVJbmZvOwoKICAgICAg\nICBSZVJlYWRMZWRnZXJNZXRhZGF0YUNiKGludCByYywgRW5zZW1ibGVJbmZv\nIGVuc2VtYmxlSW5mbykgewogICAgICAgICAgICBzdXBlcihiay5tYWluV29y\na2VyUG9vbCwgbGVkZ2VySWQpOwogICAgICAgICAgICB0aGlzLnJjID0gcmM7\nCiAgICAgICAgICAgIHRoaXMuZW5zZW1ibGVJbmZvID0gZW5zZW1ibGVJbmZv\nOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIHZvaWQgc2FmZU9wZXJhdGlvbkNvbXBsZXRlKGludCBuZXdyYywgTGVkZ2Vy\nTWV0YWRhdGEgbmV3TWV0YSkgewogICAgICAgICAgICBpZiAobmV3cmMgIT0g\nQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgTE9HLmVy\ncm9yKCJFcnJvciByZWFkaW5nIG5ldyBtZXRhZGF0YSBmcm9tIGxlZGdlciAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICsgImFmdGVyIGNoYW5naW5nIGVu\nc2VtYmxlLCBjb2RlPSIgKyBuZXdyYyk7CiAgICAgICAgICAgICAgICBoYW5k\nbGVVbnJlY292ZXJhYmxlRXJyb3JEdXJpbmdBZGQocmMpOwogICAgICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKCFyZXNvbHZlQ29uZmxp\nY3QobmV3TWV0YSkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkNvdWxkIG5vdCByZXNvbHZlIGxlZGdlciBtZXRhZGF0YSBjb25mbGljdCAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArICJ3aGlsZSBjaGFuZ2lu\nZyBlbnNlbWJsZSB0bzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyBlbnNlbWJsZUluZm8ubmV3RW5zZW1ibGUKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgIiwgb2xkIG1ldGEgZGF0YSBpcyBcbiIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICsgbmV3IFN0cmluZyhtZXRhZGF0YS5zZXJp\nYWxpemUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIlxuLCBu\nZXcgbWV0YSBkYXRhIGlzIFxuIgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyBuZXcgU3RyaW5nKG5ld01ldGEuc2VyaWFsaXplKCkpCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArICJcbiAsY2xvc2luZyBsZWRnZXIiKTsK\nICAgICAgICAgICAgICAgICAgICBoYW5kbGVVbnJlY292ZXJhYmxlRXJyb3JE\ndXJpbmdBZGQocmMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAgICAgKiBTcGVjaWZpYyBy\nZXNvbHZlIGNvbmZsaWN0cyBoYXBwZW5lZCB3aGVuIG11bHRpcGxlIGJvb2tp\nZXMgZmFpbHVyZXMgaW4gc2FtZSBlbnNlbWJsZS4KICAgICAgICAgKiA8cD4K\nICAgICAgICAgKiBSZXNvbHZpbmcgdGhlIHZlcnNpb24gY29uZmxpY3RzIGJl\ndHdlZW4gbG9jYWwgbGVkZ2VyTWV0YWRhdGEgYW5kIHprCiAgICAgICAgICog\nbGVkZ2VyTWV0YWRhdGEuIFRoaXMgd2lsbCBkbyB0aGUgZm9sbG93aW5nOgog\nICAgICAgICAqIDx1bD4KICAgICAgICAgKiA8bGk+CiAgICAgICAgICogY2hl\nY2sgd2hldGhlciBsZWRnZXJNZXRhZGF0YSBzdGF0ZSBtYXRjaGVzIG9mIGxv\nY2FsIGFuZCB6azwvbGk+CiAgICAgICAgICogPGxpPgogICAgICAgICAqIGlm\nIHRoZSB6ayBsZWRnZXJNZXRhZGF0YSBzdGlsbCBjb250YWlucyB0aGUgZmFp\nbGVkIGJvb2tpZSwgdGhlbgogICAgICAgICAqIHVwZGF0ZSB6b29rZWVwZXIg\nd2l0aCB0aGUgbmV3Qm9va2llIG90aGVyd2lzZSBzZW5kIHdyaXRlIHJlcXVl\nc3Q8L2xpPgogICAgICAgICAqIDwvdWw+CiAgICAgICAgICogPC9wPgogICAg\nICAgICAqLwogICAgICAgIHByaXZhdGUgYm9vbGVhbiByZXNvbHZlQ29uZmxp\nY3QoTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkgewogICAgICAgICAgICAvLyBt\nYWtlIHN1cmUgdGhlIGxlZGdlciBpc24ndCBjbG9zZWQgYnkgb3RoZXIgb25l\ncy4KICAgICAgICAgICAgaWYgKG1ldGFkYXRhLmdldFN0YXRlKCkgIT0gbmV3\nTWV0YS5nZXRTdGF0ZSgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFdlIHNob3VsZCBj\naGVjayBudW1iZXIgb2YgZW5zZW1ibGVzIHNpbmNlIHRoZXJlIGFyZSB0d28g\na2luZHMgb2YgbWV0YWRhdGEgY29uZmxpY3RzOgogICAgICAgICAgICAvLyAt\nIENhc2UgMTogTXVsdGlwbGUgYm9va2llcyBpbnZvbHZlZCBpbiBlbnNlbWJs\nZSBjaGFuZ2UuCiAgICAgICAgICAgIC8vICAgICAgICAgICBOdW1iZXIgb2Yg\nZW5zZW1ibGVzIHNob3VsZCBiZSBzYW1lIGluIHRoaXMgY2FzZS4KICAgICAg\nICAgICAgLy8gLSBDYXNlIDI6IFJlY292ZXJ5IChBdXRvL01hbnVhbGx5KSBy\nZXBsYWNlZCBlbnNlbWJsZSBhbmQgZW5zZW1ibGUgY2hhbmdlZC4KICAgICAg\nICAgICAgLy8gICAgICAgICAgIFRoZSBtZXRhZGF0YSBjaGFuZ2VkIGR1ZSB0\nbyBlbnNlbWJsZSBjaGFuZ2Ugd291bGQgaGF2ZSBvbmUgbW9yZSBlbnNlbWJs\nZQogICAgICAgICAgICAvLyAgICAgICAgICAgdGhhbiB0aGUgbWV0YWRhdGEg\nY2hhbmdlZCBieSByZWNvdmVyeS4KICAgICAgICAgICAgaW50IGRpZmYgPSBu\nZXdNZXRhLmdldEVuc2VtYmxlcygpLnNpemUoKSAtIG1ldGFkYXRhLmdldEVu\nc2VtYmxlcygpLnNpemUoKTsKICAgICAgICAgICAgaWYgKDAgIT0gZGlmZikg\newogICAgICAgICAgICAgICAgaWYgKC0xID09IGRpZmYpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBDYXNlIDE6IG1ldGFkYXRhIGlzIGNoYW5nZWQgYnkg\nb3RoZXIgb25lcyAoZS5nLiBSZWNvdmVyeSkKICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gdXBkYXRlTWV0YWRhdGFJZlBvc3NpYmxlKG5ld01ldGEpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNl\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLwogICAgICAgICAgICAv\nLyBDYXNlIDI6CiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIElmIHRo\nZSBmYWlsZWQgdGhlIGJvb2tpZSBpcyBzdGlsbCBleGlzdGVkIGluIHRoZSBt\nZXRhZGF0YSAoaW4gem9va2VlcGVyKSwgaXQgbWVhbnMgdGhhdAogICAgICAg\nICAgICAvLyB0aGUgZW5zZW1ibGUgY2hhbmdlIG9mIHRoZSBmYWlsZWQgYm9v\na2llIGlzIGZhaWxlZCBkdWUgdG8gbWV0YWRhdGEgY29uZmxpY3RzLiBzbyB0\ncnkgdG8KICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBlbnNlbWJsZSBjaGFu\nZ2UgbWV0YWRhdGEgYWdhaW4uIE90aGVyd2lzZSwgaXQgbWVhbnMgdGhhdCB0\naGUgZW5zZW1ibGUgY2hhbmdlCiAgICAgICAgICAgIC8vIGlzIGFscmVhZHkg\nc3VjY2VlZCwgdW5zZXQgdGhlIHN1Y2Nlc3MgYW5kIHJlLWFkZGluZyBlbnRy\naWVzLgogICAgICAgICAgICBpZiAobmV3TWV0YS5jdXJyZW50RW5zZW1ibGUu\nZ2V0KGVuc2VtYmxlSW5mby5ib29raWVJbmRleCkuZXF1YWxzKAogICAgICAg\nICAgICAgICAgICAgIGVuc2VtYmxlSW5mby5hZGRyKSkgewogICAgICAgICAg\nICAgICAgLy8gSWYgdGhlIGluLW1lbW9yeSBkYXRhIGRvZXNuJ3QgY29udGFp\nbnMgdGhlIGZhaWxlZCBib29raWUsIGl0IG1lYW5zIHRoZSBlbnNlbWJsZSBj\naGFuZ2UKICAgICAgICAgICAgICAgIC8vIGRpZG4ndCBmaW5pc2gsIHNvIHRy\neSB0byByZXNvbHZlIGNvbmZsaWN0cyB3aXRoIHRoZSBtZXRhZGF0YSByZWFk\nIGZyb20gem9va2VlcGVyIGFuZAogICAgICAgICAgICAgICAgLy8gdXBkYXRl\nIGVuc2VtYmxlIGNoYW5nZWQgbWV0YWRhdGEgYWdhaW4uCiAgICAgICAgICAg\nICAgICBpZiAoIW1ldGFkYXRhLmN1cnJlbnRFbnNlbWJsZS5nZXQoZW5zZW1i\nbGVJbmZvLmJvb2tpZUluZGV4KQogICAgICAgICAgICAgICAgICAgICAgICAu\nZXF1YWxzKGVuc2VtYmxlSW5mby5hZGRyKSkgewogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB1cGRhdGVNZXRhZGF0YUlmUG9zc2libGUobmV3TWV0YSk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAvLyB0aGUgZmFpbGVkIGJvb2tpZSBoYXMgYmVlbiByZXBs\nYWNlZAogICAgICAgICAgICAgICAgYmxvY2tBZGRDb21wbGV0aW9ucy5kZWNy\nZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgICAgIHVuc2V0U3VjY2Vzc0Fu\nZFNlbmRXcml0ZVJlcXVlc3QoZW5zZW1ibGVJbmZvLmJvb2tpZUluZGV4KTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAg\nICB9CgogICAgICAgIHByaXZhdGUgYm9vbGVhbiB1cGRhdGVNZXRhZGF0YUlm\nUG9zc2libGUoTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkgewogICAgICAgICAg\nICAvLyBpZiB0aGUgbG9jYWwgbWV0YWRhdGEgaXMgbmV3ZXIgdGhhbiB6b29r\nZWVwZXIgbWV0YWRhdGEsIGl0IG1lYW5zIHRoYXQgbWV0YWRhdGEgaXMgdXBk\nYXRlZAogICAgICAgICAgICAvLyBhZ2FpbiB3aGVuIGl0IHdhcyB0cnlpbmcg\ncmUtcmVhZGluZyB0aGUgbWV0YXRhZGEsIHJlLWtpY2sgdGhlIHJlcmVhZCBh\nZ2FpbgogICAgICAgICAgICBpZiAobWV0YWRhdGEuaXNOZXdlclRoYW4obmV3\nTWV0YSkpIHsKICAgICAgICAgICAgICAgIHJlcmVhZE1ldGFkYXRhKHRoaXMp\nOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBtZXRhZGF0YSBkb2Vzbid0\nIGNoYW5nZWQgYnkgb3RoZXIgb25lcy4KICAgICAgICAgICAgaWYgKG1ldGFk\nYXRhLmlzQ29uZmxpY3RXaXRoKG5ld01ldGEpKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgTE9H\nLmluZm8oIlJlc29sdmUgbGVkZ2VyIG1ldGFkYXRhIGNvbmZsaWN0IHdoaWxl\nIGNoYW5naW5nIGVuc2VtYmxlIHRvOiB7fSwiCiAgICAgICAgICAgICAgICAg\nICAgKyAiIG9sZCBtZXRhIGRhdGEgaXMgXG4ge30gXG4sIG5ldyBtZXRhIGRh\ndGEgaXMgXG4ge30uIiwgbmV3IE9iamVjdFtdIHsKICAgICAgICAgICAgICAg\nICAgICBlbnNlbWJsZUluZm8ubmV3RW5zZW1ibGUsIG1ldGFkYXRhLCBuZXdN\nZXRhIH0pOwogICAgICAgICAgICAvLyB1cGRhdGUgem5vZGUgdmVyc2lvbgog\nICAgICAgICAgICBtZXRhZGF0YS5zZXRWZXJzaW9uKG5ld01ldGEuZ2V0VmVy\nc2lvbigpKTsKICAgICAgICAgICAgLy8gbWVyZ2UgZW5zZW1ibGUgaW5mb3Mg\nZnJvbSBuZXcgbWV0YSBleGNlcHQgbGFzdCBlbnNlbWJsZQogICAgICAgICAg\nICAvLyBzaW5jZSB0aGV5IG1pZ2h0IGJlIG1vZGlmaWVkIGJ5IHJlY292ZXJ5\nIHRvb2wuCiAgICAgICAgICAgIG1ldGFkYXRhLm1lcmdlRW5zZW1ibGVzKG5l\nd01ldGEuZ2V0RW5zZW1ibGVzKCkpOwogICAgICAgICAgICB3cml0ZUxlZGdl\nckNvbmZpZyhuZXcgQ2hhbmdlRW5zZW1ibGVDYihlbnNlbWJsZUluZm8pKTsK\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgIH07Cgog\nICAgdm9pZCB1bnNldFN1Y2Nlc3NBbmRTZW5kV3JpdGVSZXF1ZXN0KGZpbmFs\nIGludCBib29raWVJbmRleCkgewogICAgICAgIGZvciAoUGVuZGluZ0FkZE9w\nIHBlbmRpbmdBZGRPcCA6IHBlbmRpbmdBZGRPcHMpIHsKICAgICAgICAgICAg\ncGVuZGluZ0FkZE9wLnVuc2V0U3VjY2Vzc0FuZFNlbmRXcml0ZVJlcXVlc3Qo\nYm9va2llSW5kZXgpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIHJlcmVh\nZE1ldGFkYXRhKGZpbmFsIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0\nYT4gY2IpIHsKICAgICAgICBiay5nZXRMZWRnZXJNYW5hZ2VyKCkucmVhZExl\nZGdlck1ldGFkYXRhKGxlZGdlcklkLCBjYik7CiAgICB9CgogICAgdm9pZCBy\nZWNvdmVyKGZpbmFsIEdlbmVyaWNDYWxsYmFjazxWb2lkPiBjYikgewogICAg\nICAgIGJvb2xlYW4gd2FzQ2xvc2VkID0gZmFsc2U7CiAgICAgICAgYm9vbGVh\nbiB3YXNJblJlY292ZXJ5ID0gZmFsc2U7CgogICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICBpZiAobWV0YWRhdGEuaXNDbG9zZWQo\nKSkgewogICAgICAgICAgICAgICAgbGFzdEFkZENvbmZpcm1lZCA9IGxhc3RB\nZGRQdXNoZWQgPSBtZXRhZGF0YS5nZXRMYXN0RW50cnlJZCgpOwogICAgICAg\nICAgICAgICAgbGVuZ3RoID0gbWV0YWRhdGEuZ2V0TGVuZ3RoKCk7CiAgICAg\nICAgICAgICAgICB3YXNDbG9zZWQgPSB0cnVlOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgd2FzQ2xvc2VkID0gZmFsc2U7CiAgICAg\nICAgICAgICAgICBpZiAobWV0YWRhdGEuaXNJblJlY292ZXJ5KCkpIHsKICAg\nICAgICAgICAgICAgICAgICB3YXNJblJlY292ZXJ5ID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgd2FzSW5S\nZWNvdmVyeSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIG1ldGFkYXRh\nLm1hcmtMZWRnZXJJblJlY292ZXJ5KCk7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICh3YXNDbG9zZWQp\nIHsKICAgICAgICAgICAgLy8gV2UgYXJlIGFscmVhZHkgY2xvc2VkLCBub3Ro\naW5nIHRvIGRvCiAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKEJL\nRXhjZXB0aW9uLkNvZGUuT0ssIG51bGwpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQoKICAgICAgICBpZiAod2FzSW5SZWNvdmVyeSkgewogICAg\nICAgICAgICAvLyBpZiBtZXRhZGF0YSBpcyBhbHJlYWR5IGluIHJlY292ZXIs\nIGRvbnQgdHJ5IHRvIHdyaXRlIGFnYWluLAogICAgICAgICAgICAvLyBqdXN0\nIGRvIHRoZSByZWNvdmVyeSBmcm9tIHRoZSBzdGFydGluZyBwb2ludAogICAg\nICAgICAgICBuZXcgTGVkZ2VyUmVjb3ZlcnlPcChMZWRnZXJIYW5kbGUudGhp\ncywgY2IpLmluaXRpYXRlKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIHdyaXRlTGVkZ2VyQ29uZmlnKG5ldyBPcmRlcmVkU2Fm\nZUdlbmVyaWNDYWxsYmFjazxWb2lkPihiay5tYWluV29ya2VyUG9vbCwgbGVk\nZ2VySWQpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNhZmVPcGVyYXRpb25Db21wbGV0ZShmaW5hbCBpbnQgcmMs\nIFZvaWQgcmVzdWx0KSB7CiAgICAgICAgICAgICAgICBpZiAocmMgPT0gQktF\neGNlcHRpb24uQ29kZS5NZXRhZGF0YVZlcnNpb25FeGNlcHRpb24pIHsKICAg\nICAgICAgICAgICAgICAgICByZXJlYWRNZXRhZGF0YShuZXcgT3JkZXJlZFNh\nZmVHZW5lcmljQ2FsbGJhY2s8TGVkZ2VyTWV0YWRhdGE+KGJrLm1haW5Xb3Jr\nZXJQb29sLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbGVkZ2VySWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVPcGVy\nYXRpb25Db21wbGV0ZShpbnQgcmMsIExlZGdlck1ldGFkYXRhIG5ld01ldGEp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4\nY2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY2Iub3BlcmF0aW9uQ29tcGxldGUocmMsIG51bGwpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBtZXRhZGF0YSA9IG5ld01ldGE7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcmVjb3ZlcihjYik7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAg\nICAgICAgICAgICAgIG5ldyBMZWRnZXJSZWNvdmVyeU9wKExlZGdlckhhbmRs\nZS50aGlzLCBjYikuaW5pdGlhdGUoKTsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciB3cml0\naW5nIGxlZGdlciBjb25maWcgIiArIHJjICsgIiBvZiBsZWRnZXIgIiArIGxl\nZGdlcklkKTsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25Db21w\nbGV0ZShyYywgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBzdGF0aWMgY2xhc3MgTm9vcENs\nb3NlQ2FsbGJhY2sgaW1wbGVtZW50cyBDbG9zZUNhbGxiYWNrIHsKICAgICAg\nICBzdGF0aWMgTm9vcENsb3NlQ2FsbGJhY2sgaW5zdGFuY2UgPSBuZXcgTm9v\ncENsb3NlQ2FsbGJhY2soKTsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgY2xvc2VDb21wbGV0ZShpbnQgcmMsIExlZGdlckhhbmRs\nZSBsaCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBpZiAocmMgIT0gQktF\neGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgTE9HLndhcm4o\nIkNsb3NlIGZhaWxlZDogIiArIEJLRXhjZXB0aW9uLmdldE1lc3NhZ2UocmMp\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBub29wCiAgICAgICAg\nfQogICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTeW5jUmVh\nZENhbGxiYWNrIGltcGxlbWVudHMgUmVhZENhbGxiYWNrIHsKICAgICAgICAv\nKioKICAgICAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiBjYWxsYmFjayBpbnRl\ncmZhY2UgZm9yIHN5bmNocm9ub3VzIHJlYWQgbWV0aG9kLgogICAgICAgICAq\nCiAgICAgICAgICogQHBhcmFtIHJjCiAgICAgICAgICogICAgICAgICAgcmV0\ndXJuIGNvZGUKICAgICAgICAgKiBAcGFyYW0gbGVkZXIKICAgICAgICAgKiAg\nICAgICAgICBsZWRnZXIgaWRlbnRpZmllcgogICAgICAgICAqIEBwYXJhbSBz\nZXEKICAgICAgICAgKiAgICAgICAgICBzZXF1ZW5jZSBvZiBlbnRyaWVzCiAg\nICAgICAgICogQHBhcmFtIGN0eAogICAgICAgICAqICAgICAgICAgIGNvbnRy\nb2wgb2JqZWN0CiAgICAgICAgICovCiAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgcHVibGljIHZvaWQgcmVhZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFu\nZGxlIGxoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBFbnVt\nZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmplY3QgY3R4KSB7CiAgICAg\nICAgICAgIAogICAgICAgICAgICBTeW5jQ291bnRlciBjb3VudGVyID0gKFN5\nbmNDb3VudGVyKSBjdHg7CiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoY291\nbnRlcikgewogICAgICAgICAgICAgICAgY291bnRlci5zZXRTZXF1ZW5jZShz\nZXEpOwogICAgICAgICAgICAgICAgY291bnRlci5zZXRyYyhyYyk7CiAgICAg\nICAgICAgICAgICBjb3VudGVyLmRlYygpOwogICAgICAgICAgICAgICAgY291\nbnRlci5ub3RpZnkoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBTeW5jQWRkQ2FsbGJhY2sgaW1w\nbGVtZW50cyBBZGRDYWxsYmFjayB7CiAgICAgICAgbG9uZyBlbnRyeUlkID0g\nLTE7CgogICAgICAgIC8qKgogICAgICAgICAqIEltcGxlbWVudGF0aW9uIG9m\nIGNhbGxiYWNrIGludGVyZmFjZSBmb3Igc3luY2hyb25vdXMgcmVhZCBtZXRo\nb2QuCiAgICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gcmMKICAgICAgICAg\nKiAgICAgICAgICByZXR1cm4gY29kZQogICAgICAgICAqIEBwYXJhbSBsZWRl\ncgogICAgICAgICAqICAgICAgICAgIGxlZGdlciBpZGVudGlmaWVyCiAgICAg\nICAgICogQHBhcmFtIGVudHJ5CiAgICAgICAgICogICAgICAgICAgZW50cnkg\naWRlbnRpZmllcgogICAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICAgKiAg\nICAgICAgICBjb250cm9sIG9iamVjdAogICAgICAgICAqLwogICAgICAgIEBP\ndmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIGFkZENvbXBsZXRlKGludCBy\nYywgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVudHJ5LCBPYmplY3QgY3R4KSB7\nCiAgICAgICAgICAgIFN5bmNDb3VudGVyIGNvdW50ZXIgPSAoU3luY0NvdW50\nZXIpIGN0eDsKCiAgICAgICAgICAgIHRoaXMuZW50cnlJZCA9IGVudHJ5Owog\nICAgICAgICAgICBjb3VudGVyLnNldHJjKHJjKTsKICAgICAgICAgICAgY291\nbnRlci5kZWMoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgY2xhc3MgU3luY1JlYWRMYXN0Q29uZmlybWVkQ2FsbGJhY2sgaW1wbGVt\nZW50cyBSZWFkTGFzdENvbmZpcm1lZENhbGxiYWNrIHsKICAgICAgICAvKioK\nICAgICAgICAgKiBJbXBsZW1lbnRhdGlvbiBvZiAgY2FsbGJhY2sgaW50ZXJm\nYWNlIGZvciBzeW5jaHJvbm91cyByZWFkIGxhc3QgY29uZmlybWVkIG1ldGhv\nZC4KICAgICAgICAgKi8KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCByZWFkTGFzdENvbmZpcm1lZENvbXBsZXRlKGludCByYywgbG9u\nZyBsYXN0Q29uZmlybWVkLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIExh\nc3RDb25maXJtZWRDdHggbGNDdHggPSAoTGFzdENvbmZpcm1lZEN0eCkgY3R4\nOwogICAgICAgICAgICAKICAgICAgICAgICAgc3luY2hyb25pemVkKGxjQ3R4\nKSB7CiAgICAgICAgICAgICAgICBsY0N0eC5zZXRSQyhyYyk7CiAgICAgICAg\nICAgICAgICBsY0N0eC5zZXRMYXN0Q29uZmlybWVkKGxhc3RDb25maXJtZWQp\nOwogICAgICAgICAgICAgICAgbGNDdHgubm90aWZ5KCk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3Mg\nU3luY0Nsb3NlQ2FsbGJhY2sgaW1wbGVtZW50cyBDbG9zZUNhbGxiYWNrIHsK\nICAgICAgICAvKioKICAgICAgICAgKiBDbG9zZSBjYWxsYmFjayBtZXRob2QK\nICAgICAgICAgKgogICAgICAgICAqIEBwYXJhbSByYwogICAgICAgICAqIEBw\nYXJhbSBsaAogICAgICAgICAqIEBwYXJhbSBjdHgKICAgICAgICAgKi8KICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBjbG9zZUNvbXBs\nZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgICAgIFN5bmNDb3VudGVyIGNvdW50ZXIgPSAoU3luY0NvdW50ZXIp\nIGN0eDsKICAgICAgICAgICAgY291bnRlci5zZXRyYyhyYyk7CiAgICAgICAg\nICAgIHN5bmNocm9uaXplZCAoY291bnRlcikgewogICAgICAgICAgICAgICAg\nY291bnRlci5kZWMoKTsKICAgICAgICAgICAgICAgIGNvdW50ZXIubm90aWZ5\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

