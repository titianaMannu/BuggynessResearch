{"sha":"322560bc310eb45d5685d77fb2aae9fe0b1d4725","node_id":"MDQ6QmxvYjE1NzU5NTY6MzIyNTYwYmMzMTBlYjQ1ZDU2ODVkNzdmYjJhYWU5ZmUwYjFkNDcyNQ==","size":6837,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/322560bc310eb45d5685d77fb2aae9fe0b1d4725","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7Cgpp\nbXBvcnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEuc2VjdXJpdHku\nR2VuZXJhbFNlY3VyaXR5RXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5PcGVuQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2Fs\nbGJhY2suUmVhZExhc3RDb25maXJtZWRDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBl\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVw\nZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5lcmljQ2FsbGJhY2s7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5PcmRlcmVkU2FmZUV4ZWN1dG9y\nLk9yZGVyZWRTYWZlR2VuZXJpY0NhbGxiYWNrOwoKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8q\nKgogKiBFbmNhcHN1bGF0ZXMgdGhlIGxlZGdlciBvcGVuIG9wZXJhdGlvbgog\nKgogKi8KY2xhc3MgTGVkZ2VyT3Blbk9wIGltcGxlbWVudHMgR2VuZXJpY0Nh\nbGxiYWNrPExlZGdlck1ldGFkYXRhPiB7CiAgICBzdGF0aWMgZmluYWwgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKExlZGdlck9wZW5P\ncC5jbGFzcyk7CgogICAgZmluYWwgQm9va0tlZXBlciBiazsKICAgIGZpbmFs\nIGxvbmcgbGVkZ2VySWQ7CiAgICBmaW5hbCBPcGVuQ2FsbGJhY2sgY2I7CiAg\nICBmaW5hbCBPYmplY3QgY3R4OwogICAgTGVkZ2VySGFuZGxlIGxoOwogICAg\nZmluYWwgYnl0ZVtdIHBhc3N3ZDsKICAgIGZpbmFsIERpZ2VzdFR5cGUgZGln\nZXN0VHlwZTsKICAgIGJvb2xlYW4gZG9SZWNvdmVyeSA9IHRydWU7CiAgICBi\nb29sZWFuIGFkbWluaXN0cmF0aXZlT3BlbiA9IGZhbHNlOwoKICAgIC8qKgog\nICAgICogQ29uc3RydWN0b3IuCiAgICAgKgogICAgICogQHBhcmFtIGJrCiAg\nICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAqIEBwYXJhbSBkaWdlc3RUeXBl\nCiAgICAgKiBAcGFyYW0gcGFzc3dkCiAgICAgKiBAcGFyYW0gY2IKICAgICAq\nIEBwYXJhbSBjdHgKICAgICAqLwogICAgcHVibGljIExlZGdlck9wZW5PcChC\nb29rS2VlcGVyIGJrLCBsb25nIGxlZGdlcklkLCBEaWdlc3RUeXBlIGRpZ2Vz\ndFR5cGUsIGJ5dGVbXSBwYXNzd2QsCiAgICAgICAgICAgICAgICAgICAgICAg\nIE9wZW5DYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgIHRoaXMu\nYmsgPSBiazsKICAgICAgICB0aGlzLmxlZGdlcklkID0gbGVkZ2VySWQ7CiAg\nICAgICAgdGhpcy5wYXNzd2QgPSBwYXNzd2Q7CiAgICAgICAgdGhpcy5jYiA9\nIGNiOwogICAgICAgIHRoaXMuY3R4ID0gY3R4OwogICAgICAgIHRoaXMuZGln\nZXN0VHlwZSA9IGRpZ2VzdFR5cGU7CiAgICB9CgogICAgcHVibGljIExlZGdl\nck9wZW5PcChCb29rS2VlcGVyIGJrLCBsb25nIGxlZGdlcklkLCBPcGVuQ2Fs\nbGJhY2sgY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICB0aGlzLmJrID0gYms7\nCiAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAgICAgIHRo\naXMuY2IgPSBjYjsKICAgICAgICB0aGlzLmN0eCA9IGN0eDsKCiAgICAgICAg\ndGhpcy5wYXNzd2QgPSBiay5nZXRDb25mKCkuZ2V0Qm9va2llUmVjb3ZlcnlQ\nYXNzd2QoKTsKICAgICAgICB0aGlzLmRpZ2VzdFR5cGUgPSBiay5nZXRDb25m\nKCkuZ2V0Qm9va2llUmVjb3ZlcnlEaWdlc3RUeXBlKCk7CiAgICAgICAgdGhp\ncy5hZG1pbmlzdHJhdGl2ZU9wZW4gPSB0cnVlOwogICAgfQoKICAgIC8qKgog\nICAgICogSW5pdGl0YXRlcyB0aGUgbGVkZ2VyIG9wZW4gb3BlcmF0aW9uCiAg\nICAgKi8KICAgIHB1YmxpYyB2b2lkIGluaXRpYXRlKCkgewogICAgICAgIC8q\nKgogICAgICAgICAqIEFzeW5jaHJvbm91c2x5IHJlYWQgdGhlIGxlZGdlciBt\nZXRhZGF0YSBub2RlLgogICAgICAgICAqLwogICAgICAgIGJrLmdldExlZGdl\nck1hbmFnZXIoKS5yZWFkTGVkZ2VyTWV0YWRhdGEobGVkZ2VySWQsIHRoaXMp\nOwogICAgfQoKICAgIC8qKgogICAgICogSW5pdGl0YXRlcyB0aGUgbGVkZ2Vy\nIG9wZW4gb3BlcmF0aW9uIHdpdGhvdXQgcmVjb3ZlcnkKICAgICAqLwogICAg\ncHVibGljIHZvaWQgaW5pdGlhdGVXaXRob3V0UmVjb3ZlcnkoKSB7CiAgICAg\nICAgdGhpcy5kb1JlY292ZXJ5ID0gZmFsc2U7CiAgICAgICAgaW5pdGlhdGUo\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEltcGxlbWVudHMgT3BlbiBMZWRn\nZXIgQ2FsbGJhY2suCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkNvbXBsZXRlKGludCByYywgTGVkZ2VyTWV0YWRhdGEgbWV0YWRhdGEpIHsK\nICAgICAgICBpZiAoQktFeGNlcHRpb24uQ29kZS5PSyAhPSByYykgewogICAg\nICAgICAgICAvLyBvcGVuIGxlZGdlciBmYWlsZWQuCiAgICAgICAgICAgIGNi\nLm9wZW5Db21wbGV0ZShyYywgbnVsbCwgdGhpcy5jdHgpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBmaW5hbCBieXRlW10gcGFz\nc3dkOwogICAgICAgIGZpbmFsIERpZ2VzdFR5cGUgZGlnZXN0VHlwZTsKCiAg\nICAgICAgLyogRm9yIGFuIGFkbWluaXN0cmF0aXZlIG9wZW4sIHRoZSBkZWZh\ndWx0IHBhc3N3b3JkcwogICAgICAgICAqIGFyZSByZWFkIGZyb20gdGhlIGNv\nbmZpZ3VyYXRpb24sIGJ1dCBpZiB0aGUgbWV0YWRhdGEKICAgICAgICAgKiBh\nbHJlYWR5IGNvbnRhaW5zIHBhc3N3b3JkcywgdXNlIHRoZXNlIGluc3RlYWQu\nICovCiAgICAgICAgaWYgKGFkbWluaXN0cmF0aXZlT3BlbiAmJiBtZXRhZGF0\nYS5oYXNQYXNzd29yZCgpKSB7CiAgICAgICAgICAgIHBhc3N3ZCA9IG1ldGFk\nYXRhLmdldFBhc3N3b3JkKCk7CiAgICAgICAgICAgIGRpZ2VzdFR5cGUgPSBt\nZXRhZGF0YS5nZXREaWdlc3RUeXBlKCk7CiAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgcGFzc3dkID0gdGhpcy5wYXNzd2Q7CiAgICAgICAgICAgIGRp\nZ2VzdFR5cGUgPSB0aGlzLmRpZ2VzdFR5cGU7CgogICAgICAgICAgICBpZiAo\nbWV0YWRhdGEuaGFzUGFzc3dvcmQoKSkgewogICAgICAgICAgICAgICAgaWYg\nKCFBcnJheXMuZXF1YWxzKHBhc3N3ZCwgbWV0YWRhdGEuZ2V0UGFzc3dvcmQo\nKSkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlByb3ZpZGVk\nIHBhc3N3ZCBkb2VzIG5vdCBtYXRjaCB0aGF0IGluIG1ldGFkYXRhIik7CiAg\nICAgICAgICAgICAgICAgICAgY2Iub3BlbkNvbXBsZXRlKEJLRXhjZXB0aW9u\nLkNvZGUuVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9uLCBudWxsLCB0aGlz\nLmN0eCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGRpZ2VzdFR5cGUgIT0gbWV0\nYWRhdGEuZ2V0RGlnZXN0VHlwZSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nTE9HLmVycm9yKCJQcm92aWRlZCBkaWdlc3QgZG9lcyBub3QgbWF0Y2ggdGhh\ndCBpbiBtZXRhZGF0YSIpOwogICAgICAgICAgICAgICAgICAgIGNiLm9wZW5D\nb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLkRpZ2VzdE1hdGNoRXhjZXB0aW9u\nLCBudWxsLCB0aGlzLmN0eCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICAvLyBnZXQgdGhlIGxlZGdlciBtZXRhZGF0YSBiYWNrCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgbGggPSBuZXcgUmVhZE9ubHlMZWRnZXJI\nYW5kbGUoYmssIGxlZGdlcklkLCBtZXRhZGF0YSwgZGlnZXN0VHlwZSwgcGFz\nc3dkLCAhZG9SZWNvdmVyeSk7CiAgICAgICAgfSBjYXRjaCAoR2VuZXJhbFNl\nY3VyaXR5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJT\nZWN1cml0eSBleGNlcHRpb24gd2hpbGUgb3BlbmluZyBsZWRnZXI6ICIgKyBs\nZWRnZXJJZCwgZSk7CiAgICAgICAgICAgIGNiLm9wZW5Db21wbGV0ZShCS0V4\nY2VwdGlvbi5Db2RlLkRpZ2VzdE5vdEluaXRpYWxpemVkRXhjZXB0aW9uLCBu\ndWxsLCB0aGlzLmN0eCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9\nIGNhdGNoIChOdW1iZXJGb3JtYXRFeGNlcHRpb24gZSkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIkluY29ycmVjdGx5IGVudGVyZWQgcGFyYW1ldGVyIHRo\ncm90dGxlOiAiICsgYmsuZ2V0Q29uZigpLmdldFRocm90dGxlVmFsdWUoKSwg\nZSk7CiAgICAgICAgICAgIGNiLm9wZW5Db21wbGV0ZShCS0V4Y2VwdGlvbi5D\nb2RlLkluY29ycmVjdFBhcmFtZXRlckV4Y2VwdGlvbiwgbnVsbCwgdGhpcy5j\ndHgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBp\nZiAobWV0YWRhdGEuaXNDbG9zZWQoKSkgewogICAgICAgICAgICAvLyBMZWRn\nZXIgd2FzIGNsb3NlZCBwcm9wZXJseQogICAgICAgICAgICBjYi5vcGVuQ29t\ncGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgbGgsIHRoaXMuY3R4KTsKICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGRvUmVj\nb3ZlcnkpIHsKICAgICAgICAgICAgbGgucmVjb3ZlcihuZXcgT3JkZXJlZFNh\nZmVHZW5lcmljQ2FsbGJhY2s8Vm9pZD4oYmsubWFpbldvcmtlclBvb2wsIGxl\nZGdlcklkKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZXJhdGlvbkNvbXBs\nZXRlKGludCByYywgVm9pZCByZXN1bHQpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZW5Db21wbGV0ZShCS0V4Y2Vw\ndGlvbi5Db2RlLk9LLCBsaCwgTGVkZ2VyT3Blbk9wLnRoaXMuY3R4KTsKICAg\nICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyYyA9PSBCS0V4Y2Vw\ndGlvbi5Db2RlLlVuYXV0aG9yaXplZEFjY2Vzc0V4Y2VwdGlvbikgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlbkNvbXBsZXRlKEJLRXhj\nZXB0aW9uLkNvZGUuVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9uLCBudWxs\nLCBMZWRnZXJPcGVuT3AudGhpcy5jdHgpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iu\nb3BlbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuTGVkZ2VyUmVjb3ZlcnlF\neGNlcHRpb24sIG51bGwsIExlZGdlck9wZW5PcC50aGlzLmN0eCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nICBsaC5hc3luY1JlYWRMYXN0Q29uZmlybWVkKG5ldyBSZWFkTGFzdENvbmZp\ncm1lZENhbGxiYWNrKCkgewoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcmVhZExhc3RDb25maXJtZWRD\nb21wbGV0ZShpbnQgcmMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvbmcg\nbGFzdENvbmZpcm1lZCwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAg\nICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNiLm9wZW5Db21wbGV0ZShCS0V4Y2VwdGlvbi5D\nb2RlLlJlYWRFeGNlcHRpb24sIG51bGwsIExlZGdlck9wZW5PcC50aGlzLmN0\neCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgbGgubGFzdEFkZENvbmZpcm1lZCA9IGxoLmxhc3RBZGRQ\ndXNoZWQgPSBsYXN0Q29uZmlybWVkOwogICAgICAgICAgICAgICAgICAgICAg\nICBjYi5vcGVuQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywgbGgsIExl\nZGdlck9wZW5PcC50aGlzLmN0eCk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAg\nIH0sIG51bGwpOwogICAgICAgICAgICAKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

