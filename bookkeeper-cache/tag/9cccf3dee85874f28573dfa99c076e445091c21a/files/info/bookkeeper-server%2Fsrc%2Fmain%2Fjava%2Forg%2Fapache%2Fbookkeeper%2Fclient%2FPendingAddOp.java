{"sha":"de4452499a9a15830eb10e903d07d095ef3e3d7c","node_id":"MDQ6QmxvYjE1NzU5NTY6ZGU0NDUyNDk5YTlhMTU4MzBlYjEwZTkwM2QwN2QwOTVlZjNlM2Q3Yw==","size":7347,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/de4452499a9a15830eb10e903d07d095ef3e3d7c","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKaW1wb3J0IGph\ndmEudXRpbC5IYXNoU2V0OwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0\nIGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLkFkZENhbGxiYWNr\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVBy\nb3RvY29sOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNhbGxiYWNrOwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVyOwppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJG\nYWN0b3J5OwoKLyoqCiAqIFRoaXMgcmVwcmVzZW50cyBhIHBlbmRpbmcgYWRk\nIG9wZXJhdGlvbi4gV2hlbiBpdCBoYXMgZ290IHN1Y2Nlc3MgZnJvbSBhbGwK\nICogYm9va2llcywgaXQgc2VlcyBpZiBpdHMgYXQgdGhlIGhlYWQgb2YgdGhl\nIHBlbmRpbmcgYWRkcyBxdWV1ZSwgYW5kIGlmIHllcywKICogc2VuZHMgYWNr\nIGJhY2sgdG8gdGhlIGFwcGxpY2F0aW9uLiBJZiBhIGJvb2tpZSBmYWlscywg\nYSByZXBsYWNlbWVudCBpcyBtYWRlCiAqIGFuZCBwbGFjZWQgYXQgdGhlIHNh\nbWUgcG9zaXRpb24gaW4gdGhlIGVuc2VtYmxlLiBUaGUgcGVuZGluZyBhZGRz\nIGFyZSB0aGVuCiAqIHJlcmVwbGljYXRlZC4KICoKICoKICovCmNsYXNzIFBl\nbmRpbmdBZGRPcCBpbXBsZW1lbnRzIFdyaXRlQ2FsbGJhY2sgewogICAgZmlu\nYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihQZW5kaW5nQWRkT3AuY2xhc3MpOwoKICAgIENoYW5uZWxCdWZmZXIgdG9T\nZW5kOwogICAgQWRkQ2FsbGJhY2sgY2I7CiAgICBPYmplY3QgY3R4OwogICAg\nbG9uZyBlbnRyeUlkOwogICAgaW50IGVudHJ5TGVuZ3RoOwogICAgU2V0PElu\ndGVnZXI+IHdyaXRlU2V0OwoKICAgIERpc3RyaWJ1dGlvblNjaGVkdWxlLkFj\na1NldCBhY2tTZXQ7CiAgICBib29sZWFuIGNvbXBsZXRlZCA9IGZhbHNlOwoK\nICAgIExlZGdlckhhbmRsZSBsaDsKICAgIGJvb2xlYW4gaXNSZWNvdmVyeUFk\nZCA9IGZhbHNlOwoKICAgIFBlbmRpbmdBZGRPcChMZWRnZXJIYW5kbGUgbGgs\nIEFkZENhbGxiYWNrIGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAgdGhpcy5s\naCA9IGxoOwogICAgICAgIHRoaXMuY2IgPSBjYjsKICAgICAgICB0aGlzLmN0\neCA9IGN0eDsKICAgICAgICB0aGlzLmVudHJ5SWQgPSBMZWRnZXJIYW5kbGUu\nSU5WQUxJRF9FTlRSWV9JRDsKICAgICAgICAKICAgICAgICBhY2tTZXQgPSBs\naC5kaXN0cmlidXRpb25TY2hlZHVsZS5nZXRBY2tTZXQoKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIEVuYWJsZSB0aGUgcmVjb3ZlcnkgYWRkIGZsYWcgZm9y\nIHRoaXMgb3BlcmF0aW9uLgogICAgICogQHNlZSBMZWRnZXJIYW5kbGUjYXN5\nbmNSZWNvdmVyeUFkZEVudHJ5CiAgICAgKi8KICAgIFBlbmRpbmdBZGRPcCBl\nbmFibGVSZWNvdmVyeUFkZCgpIHsKICAgICAgICBpc1JlY292ZXJ5QWRkID0g\ndHJ1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH0KCiAgICB2b2lkIHNl\ndEVudHJ5SWQobG9uZyBlbnRyeUlkKSB7CiAgICAgICAgdGhpcy5lbnRyeUlk\nID0gZW50cnlJZDsKICAgICAgICB3cml0ZVNldCA9IG5ldyBIYXNoU2V0PElu\ndGVnZXI+KGxoLmRpc3RyaWJ1dGlvblNjaGVkdWxlLmdldFdyaXRlU2V0KGVu\ndHJ5SWQpKTsKICAgIH0KCiAgICB2b2lkIHNlbmRXcml0ZVJlcXVlc3QoaW50\nIGJvb2tpZUluZGV4KSB7CiAgICAgICAgaW50IGZsYWdzID0gaXNSZWNvdmVy\neUFkZCA/IEJvb2tpZVByb3RvY29sLkZMQUdfUkVDT1ZFUllfQUREIDogQm9v\na2llUHJvdG9jb2wuRkxBR19OT05FOwoKICAgICAgICBsaC5iay5ib29raWVD\nbGllbnQuYWRkRW50cnkobGgubWV0YWRhdGEuY3VycmVudEVuc2VtYmxlLmdl\ndChib29raWVJbmRleCksIGxoLmxlZGdlcklkLCBsaC5sZWRnZXJLZXksIGVu\ndHJ5SWQsIHRvU2VuZCwKICAgICAgICAgICAgICAgIHRoaXMsIGJvb2tpZUlu\nZGV4LCBmbGFncyk7CiAgICB9CgogICAgdm9pZCB1bnNldFN1Y2Nlc3NBbmRT\nZW5kV3JpdGVSZXF1ZXN0KGludCBib29raWVJbmRleCkgewogICAgICAgIGlm\nICh0b1NlbmQgPT0gbnVsbCkgewogICAgICAgICAgICAvLyB0aGlzIGFkZE9w\nIGhhc24ndCB5ZXQgaGFkIGl0cyBtYWMgY29tcHV0ZWQuIFdoZW4gdGhlIG1h\nYyBpcwogICAgICAgICAgICAvLyBjb21wdXRlZCwgaXRzIHdyaXRlIHJlcXVl\nc3RzIHdpbGwgYmUgc2VudCwgc28gbm8gbmVlZCB0byBzZW5kIGl0CiAgICAg\nICAgICAgIC8vIG5vdwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQog\nICAgICAgIC8vIFN1cHBvc2UgdGhhdCB1bnNldCBkb2Vzbid0IGhhcHBlbiBv\nbiB0aGUgd3JpdGUgc2V0IG9mIGFuIGVudHJ5LiBJbiB0aGlzCiAgICAgICAg\nLy8gY2FzZSB3ZSBkb24ndCBuZWVkIHRvIHJlc2VuZCB0aGUgd3JpdGUgcmVx\ndWVzdCB1cG9uIGFuIGVuc2VtYmxlIGNoYW5nZS4KICAgICAgICAvLyBXZSBk\nbyBuZWVkIHRvIGludm9rZSAjc2VuZEFkZFN1Y2Nlc3NDYWxsYmFja3MoKSBm\nb3Igc3VjaCBlbnRyaWVzIGJlY2F1c2UKICAgICAgICAvLyB0aGV5IG1heSBo\nYXZlIGFscmVhZHkgY29tcGxldGVkLCBidXQgdGhleSBhcmUganVzdCB3YWl0\naW5nIGZvciB0aGUgZW5zZW1ibGUKICAgICAgICAvLyB0byBjaGFuZ2UuCiAg\nICAgICAgLy8gRS5nLgogICAgICAgIC8vIGVuc2VtYmxlIChBLCBCLCBDLCBE\nKSwgZW50cnkgayBpcyB3cml0dGVuIHRvIChBLCBCLCBEKS4gQW4gZW5zZW1i\nbGUgY2hhbmdlCiAgICAgICAgLy8gaGFwcGVucyB0byByZXBsYWNlIEMgd2l0\naCBFLiBFbnRyeSBrIGRvZXMgbm90IGNvbXBsZXRlIHVudGlsIEMgaXMKICAg\nICAgICAvLyByZXBsYWNlZCB3aXRoIEUgc3VjY2Vzc2Z1bGx5LiBXaGVuIHRo\nZSBlbnNlbWJsZSBjaGFuZ2UgY29tcGxldGVzLCBpdCB0cmllcwogICAgICAg\nIC8vIHRvIHVuc2V0IGVudHJ5IGsuIEMgaG93ZXZlciBpcyBub3QgaW4gaydz\nIHdyaXRlIHNldCwgc28gbm8gZW50cnkgaXMgd3JpdHRlbgogICAgICAgIC8v\nIGFnYWluLCBhbmQgbm8gb25lIHRyaWdnZXJzICNzZW5kQWRkU3VjY2Vzc0Nh\nbGxiYWNrcy4gQ29uc2VxdWVudGx5LCBrIG5ldmVyCiAgICAgICAgLy8gY29t\ncGxldGVzLgogICAgICAgIC8vCiAgICAgICAgLy8gV2UgY2FsbCBzZW5kQWRk\nU3VjY2Vzc0NhbGxiYWNrIHdoZW4gdW5zZXR0aW5nIHQgY292ZXIgdGhpcyBj\nYXNlLgogICAgICAgIGlmICghd3JpdGVTZXQuY29udGFpbnMoYm9va2llSW5k\nZXgpKSB7CiAgICAgICAgICAgIGxoLnNlbmRBZGRTdWNjZXNzQ2FsbGJhY2tz\nKCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlm\nIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cuZGVi\ndWcoIlVuc2V0dGluZyBzdWNjZXNzIGZvciBsZWRnZXI6ICIgKyBsaC5sZWRn\nZXJJZCArICIgZW50cnk6ICIgKyBlbnRyeUlkICsgIiBib29raWUgaW5kZXg6\nICIKICAgICAgICAgICAgICAgICAgICAgICsgYm9va2llSW5kZXgpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gaWYgd2UgaGFkIGFscmVhZHkgaGVhcmQgYSBz\ndWNjZXNzIGZyb20gdGhpcyBhcnJheSBpbmRleCwgbmVlZCB0bwogICAgICAg\nIC8vIGluY3JlbWVudCBvdXIgbnVtYmVyIG9mIHJlc3BvbnNlcyB0aGF0IGFy\nZSBwZW5kaW5nLCBzaW5jZSB3ZSBhcmUKICAgICAgICAvLyBnb2luZyB0byB1\nbnNldCB0aGlzIHN1Y2Nlc3MKICAgICAgICBhY2tTZXQucmVtb3ZlQm9va2ll\nKGJvb2tpZUluZGV4KTsKICAgICAgICBjb21wbGV0ZWQgPSBmYWxzZTsKCiAg\nICAgICAgc2VuZFdyaXRlUmVxdWVzdChib29raWVJbmRleCk7CiAgICB9Cgog\nICAgdm9pZCBpbml0aWF0ZShDaGFubmVsQnVmZmVyIHRvU2VuZCwgaW50IGVu\ndHJ5TGVuZ3RoKSB7CiAgICAgICAgdGhpcy50b1NlbmQgPSB0b1NlbmQ7CiAg\nICAgICAgdGhpcy5lbnRyeUxlbmd0aCA9IGVudHJ5TGVuZ3RoOwogICAgICAg\nIGZvciAoaW50IGJvb2tpZUluZGV4IDogd3JpdGVTZXQpIHsKICAgICAgICAg\nICAgc2VuZFdyaXRlUmVxdWVzdChib29raWVJbmRleCk7CiAgICAgICAgfQog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgd3JpdGVDb21w\nbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCwgSW5l\ndFNvY2tldEFkZHJlc3MgYWRkciwgT2JqZWN0IGN0eCkgewogICAgICAgIGlu\ndCBib29raWVJbmRleCA9IChJbnRlZ2VyKSBjdHg7CgogICAgICAgIGlmIChj\nb21wbGV0ZWQpIHsKICAgICAgICAgICAgLy8gSSBhbSBhbHJlYWR5IGZpbmlz\naGVkLCBpZ25vcmUgaW5jb21pbmcgcmVzcG9uc2VzLgogICAgICAgICAgICAv\nLyBvdGhlcndpc2UsIHdlIG1pZ2h0IGhpdCB0aGUgZm9sbG93aW5nIGVycm9y\nIGhhbmRsaW5nIGxvZ2ljLCB3aGljaCBtaWdodCBjYXVzZSBiYWQgdGhpbmdz\nLgogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzd2l0\nY2ggKHJjKSB7CiAgICAgICAgY2FzZSBCS0V4Y2VwdGlvbi5Db2RlLk9LOgog\nICAgICAgICAgICAvLyBjb250aW51ZQogICAgICAgICAgICBicmVhazsKICAg\nICAgICBjYXNlIEJLRXhjZXB0aW9uLkNvZGUuTGVkZ2VyRmVuY2VkRXhjZXB0\naW9uOgogICAgICAgICAgICBMT0cud2FybigiRmVuY2luZyBleGNlcHRpb24g\nb24gd3JpdGU6IEx7fSBFe30gb24ge30iLAogICAgICAgICAgICAgICAgICAg\nICBuZXcgT2JqZWN0W10geyBsZWRnZXJJZCwgZW50cnlJZCwgYWRkciB9KTsK\nICAgICAgICAgICAgbGguaGFuZGxlVW5yZWNvdmVyYWJsZUVycm9yRHVyaW5n\nQWRkKHJjKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGNhc2UgQktF\neGNlcHRpb24uQ29kZS5VbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb246CiAg\nICAgICAgICAgIExPRy53YXJuKCJVbmF1dGhvcml6ZWQgYWNjZXNzIGV4Y2Vw\ndGlvbiBvbiB3cml0ZTogTHt9IEV7fSBvbiB7fSIsCiAgICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXSB7IGxlZGdlcklkLCBlbnRyeUlkLCBhZGRy\nIH0pOwogICAgICAgICAgICBsaC5oYW5kbGVVbnJlY292ZXJhYmxlRXJyb3JE\ndXJpbmdBZGQocmMpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgZGVm\nYXVsdDoKICAgICAgICAgICAgTE9HLndhcm4oIldyaXRlIGRpZCBub3Qgc3Vj\nY2VlZDogTHt9IEV7fSBvbiB7fSIsCiAgICAgICAgICAgICAgICAgICAgIG5l\ndyBPYmplY3RbXSB7IGxlZGdlcklkLCBlbnRyeUlkLCBhZGRyIH0pOwogICAg\nICAgICAgICBsaC5oYW5kbGVCb29raWVGYWlsdXJlKGFkZHIsIGJvb2tpZUlu\nZGV4KTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAg\naWYgKCF3cml0ZVNldC5jb250YWlucyhib29raWVJbmRleCkpIHsKICAgICAg\nICAgICAgTE9HLndhcm4oIlJlY2VpdmVkIGEgcmVzcG9uc2UgZm9yIChsaWQ6\ne30sIGVpZDp7fSkgZnJvbSB7fUB7fSwgYnV0IGl0IGRvZXNuJ3QgYmVsb25n\nIHRvIHt9LiIsCiAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7\nIGxlZGdlcklkLCBlbnRyeUlkLCBhZGRyLCBib29raWVJbmRleCwgd3JpdGVT\nZXQgfSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAg\nIGlmIChhY2tTZXQuYWRkQm9va2llQW5kQ2hlY2soYm9va2llSW5kZXgpICYm\nICFjb21wbGV0ZWQpIHsKICAgICAgICAgICAgY29tcGxldGVkID0gdHJ1ZTsK\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiQ29tcGxldGUgKGxpZDp7fSwgZWlk\nOnt9KS4iLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgICAgIC8vIHdo\nZW4gY29tcGxldGVkIGFuIGVudHJ5LCB0cnkgdG8gc2VuZCBzdWNjZXNzIGFk\nZCBjYWxsYmFja3MgaW4gb3JkZXIKICAgICAgICAgICAgbGguc2VuZEFkZFN1\nY2Nlc3NDYWxsYmFja3MoKTsKICAgICAgICB9CiAgICB9CgogICAgdm9pZCBz\ndWJtaXRDYWxsYmFjayhmaW5hbCBpbnQgcmMpIHsKICAgICAgICBpZiAocmMg\nIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICBMT0cuZXJy\nb3IoIldyaXRlIG9mIGxlZGdlciBlbnRyeSB0byBxdW9ydW0gZmFpbGVkOiBM\ne30gRXt9IiwKICAgICAgICAgICAgICAgICAgICAgIGxoLmdldElkKCksIGVu\ndHJ5SWQpOwogICAgICAgIH0KCiAgICAgICAgY2IuYWRkQ29tcGxldGUocmMs\nIGxoLCBlbnRyeUlkLCBjdHgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAgICAgICBTdHJpbmdCdWls\nZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5hcHBl\nbmQoIlBlbmRpbmdBZGRPcChsaWQ6IikuYXBwZW5kKGxoLmxlZGdlcklkKQog\nICAgICAgICAgLmFwcGVuZCgiLCBlaWQ6IikuYXBwZW5kKGVudHJ5SWQpLmFw\ncGVuZCgiLCBjb21wbGV0ZWQ6IikKICAgICAgICAgIC5hcHBlbmQoY29tcGxl\ndGVkKS5hcHBlbmQoIikiKTsKICAgICAgICByZXR1cm4gc2IudG9TdHJpbmco\nKTsKICAgIH0KCn0K\n","encoding":"base64"}

