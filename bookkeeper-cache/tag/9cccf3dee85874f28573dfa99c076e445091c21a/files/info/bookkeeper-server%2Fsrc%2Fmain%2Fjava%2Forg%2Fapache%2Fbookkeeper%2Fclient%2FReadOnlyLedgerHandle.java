{"sha":"b34de583e4d4e0c1957ea0f08646d915b2d7e689","node_id":"MDQ6QmxvYjE1NzU5NTY6YjM0ZGU1ODNlNGQ0ZTBjMTk1N2VhMGYwODY0NmQ5MTViMmQ3ZTY4OQ==","size":6565,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/b34de583e4d4e0c1957ea0f08646d915b2d7e689","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudDsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJh\nY2suQWRkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkFzeW5jQ2FsbGJhY2suQ2xvc2VDYWxsYmFjazsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RU\neXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tr\nZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5MZWRnZXJNZXRhZGF0YUxpc3RlbmVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuU2FmZVJ1bm5h\nYmxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcu\nVmVyc2lvbjsKCmltcG9ydCBqYXZhLnNlY3VyaXR5LkdlbmVyYWxTZWN1cml0\neUV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNz\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuUmVqZWN0ZWRFeGVjdXRp\nb25FeGNlcHRpb247CgovKioKICogUmVhZCBvbmx5IGxlZGdlciBoYW5kbGUu\nIFRoaXMgbGVkZ2VyIGhhbmRsZSBhbGxvd3MgeW91IHRvCiAqIHJlYWQgZnJv\nbSBhIGxlZGdlciBidXQgbm90IHRvIHdyaXRlIHRvIGl0LiBJdCBvdmVycmlk\nZXMgYWxsCiAqIHRoZSBwdWJsaWMgd3JpdGUgb3BlcmF0aW9ucyBmcm9tIExl\nZGdlckhhbmRsZS4KICogSXQgc2hvdWxkIGJlIHJldHVybmVkIGZvciBCb29r\nS2VlcGVyI29wZW5MZWRnZXIgb3BlcmF0aW9ucy4KICovCmNsYXNzIFJlYWRP\nbmx5TGVkZ2VySGFuZGxlIGV4dGVuZHMgTGVkZ2VySGFuZGxlIGltcGxlbWVu\ndHMgTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lciB7CgogICAgY2xhc3MgTWV0YWRh\ndGFVcGRhdGVyIGV4dGVuZHMgU2FmZVJ1bm5hYmxlIHsKCiAgICAgICAgZmlu\nYWwgTGVkZ2VyTWV0YWRhdGEgbTsKCiAgICAgICAgTWV0YWRhdGFVcGRhdGVy\nKExlZGdlck1ldGFkYXRhIG1ldGFkYXRhKSB7CiAgICAgICAgICAgIHRoaXMu\nbSA9IG1ldGFkYXRhOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigpIHsKICAgICAgICAgICAgVmVy\nc2lvbi5PY2N1cnJlZCBvY2N1cnJlZCA9CiAgICAgICAgICAgICAgICAgICAg\nUmVhZE9ubHlMZWRnZXJIYW5kbGUudGhpcy5tZXRhZGF0YS5nZXRWZXJzaW9u\nKCkuY29tcGFyZSh0aGlzLm0uZ2V0VmVyc2lvbigpKTsKICAgICAgICAgICAg\naWYgKFZlcnNpb24uT2NjdXJyZWQuQkVGT1JFID09IG9jY3VycmVkKSB7CiAg\nICAgICAgICAgICAgICBMT0cuaW5mbygiVXBkYXRlZCBsZWRnZXIgbWV0YWRh\ndGEgZm9yIGxlZGdlciB7fSB0byB7fS4iLCBsZWRnZXJJZCwgdGhpcy5tKTsK\nICAgICAgICAgICAgICAgIFJlYWRPbmx5TGVkZ2VySGFuZGxlLnRoaXMubWV0\nYWRhdGEgPSB0aGlzLm07CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9\nCgogICAgUmVhZE9ubHlMZWRnZXJIYW5kbGUoQm9va0tlZXBlciBiaywgbG9u\nZyBsZWRnZXJJZCwgTGVkZ2VyTWV0YWRhdGEgbWV0YWRhdGEsCiAgICAgICAg\nICAgICAgICAgICAgICAgICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUsIGJ5dGVb\nXSBwYXNzd29yZCwgYm9vbGVhbiB3YXRjaCkKICAgICAgICAgICAgdGhyb3dz\nIEdlbmVyYWxTZWN1cml0eUV4Y2VwdGlvbiwgTnVtYmVyRm9ybWF0RXhjZXB0\naW9uIHsKICAgICAgICBzdXBlcihiaywgbGVkZ2VySWQsIG1ldGFkYXRhLCBk\naWdlc3RUeXBlLCBwYXNzd29yZCk7CiAgICAgICAgaWYgKHdhdGNoKSB7CiAg\nICAgICAgICAgIGJrLmdldExlZGdlck1hbmFnZXIoKS5yZWdpc3RlckxlZGdl\nck1ldGFkYXRhTGlzdGVuZXIobGVkZ2VySWQsIHRoaXMpOwogICAgICAgIH0K\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkK\nICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4\nY2VwdGlvbiB7CiAgICAgICAgYmsuZ2V0TGVkZ2VyTWFuYWdlcigpLnVucmVn\naXN0ZXJMZWRnZXJNZXRhZGF0YUxpc3RlbmVyKGxlZGdlcklkLCB0aGlzKTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGFzeW5jQ2xv\nc2UoQ2xvc2VDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgIGJr\nLmdldExlZGdlck1hbmFnZXIoKS51bnJlZ2lzdGVyTGVkZ2VyTWV0YWRhdGFM\naXN0ZW5lcihsZWRnZXJJZCwgdGhpcyk7CiAgICAgICAgY2IuY2xvc2VDb21w\nbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9LLCB0aGlzLCBjdHgpOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIGxvbmcgYWRkRW50cnkoYnl0ZVtd\nIGRhdGEpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRp\nb24gewogICAgICAgIHJldHVybiBhZGRFbnRyeShkYXRhLCAwLCBkYXRhLmxl\nbmd0aCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgbG9uZyBh\nZGRFbnRyeShieXRlW10gZGF0YSwgaW50IG9mZnNldCwgaW50IGxlbmd0aCkK\nICAgICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4\nY2VwdGlvbiB7CiAgICAgICAgTE9HLmVycm9yKCJUcmllZCB0byBhZGQgZW50\ncnkgb24gYSBSZWFkLU9ubHkgbGVkZ2VyIGhhbmRsZSwgbGVkZ2VyaWQ9IiAr\nIGxlZGdlcklkKTsKICAgICAgICB0aHJvdyBCS0V4Y2VwdGlvbi5jcmVhdGUo\nQktFeGNlcHRpb24uQ29kZS5JbGxlZ2FsT3BFeGNlcHRpb24pOwogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgYXN5bmNBZGRFbnRyeShm\naW5hbCBieXRlW10gZGF0YSwgZmluYWwgQWRkQ2FsbGJhY2sgY2IsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBhc3luY0FkZEVudHJ5KGRhdGEsIDAsIGRhdGEubGVuZ3RoLCBj\nYiwgY3R4KTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lk\nIGFzeW5jQWRkRW50cnkoZmluYWwgYnl0ZVtdIGRhdGEsIGZpbmFsIGludCBv\nZmZzZXQsIGZpbmFsIGludCBsZW5ndGgsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZpbmFsIEFkZENhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgTE9HLmVycm9yKCJUcmllZCB0byBhZGQgZW50cnkg\nb24gYSBSZWFkLU9ubHkgbGVkZ2VyIGhhbmRsZSwgbGVkZ2VyaWQ9IiArIGxl\nZGdlcklkKTsKICAgICAgICBjYi5hZGRDb21wbGV0ZShCS0V4Y2VwdGlvbi5D\nb2RlLklsbGVnYWxPcEV4Y2VwdGlvbiwgdGhpcywKICAgICAgICAgICAgICAg\nICAgICAgICBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9JRCwgY3R4KTsK\nICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHZvaWQgaGFuZGxlQm9va2llRmFp\nbHVyZShmaW5hbCBJbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBmaW5hbCBpbnQg\nYm9va2llSW5kZXgpIHsKICAgICAgICBibG9ja0FkZENvbXBsZXRpb25zLmlu\nY3JlbWVudEFuZEdldCgpOwogICAgICAgIHN5bmNocm9uaXplZCAobWV0YWRh\ndGEpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmICgh\nbWV0YWRhdGEuY3VycmVudEVuc2VtYmxlLmdldChib29raWVJbmRleCkuZXF1\nYWxzKGFkZHIpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZW5zZW1ibGUg\naGFzIGFscmVhZHkgY2hhbmdlZCwgZmFpbHVyZSBvZiB0aGlzIGFkZHIgaXMg\naW1tYXRlcmlhbAogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiV3Jp\ndGUgZGlkIG5vdCBzdWNjZWVkIHRvIHt9LCBib29raWVJbmRleCB7fSwiCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsiIGJ1dCB3ZSBoYXZlIGFs\ncmVhZHkgZml4ZWQgaXQuIiwgYWRkciwgYm9va2llSW5kZXgpOwogICAgICAg\nICAgICAgICAgICAgIGJsb2NrQWRkQ29tcGxldGlvbnMuZGVjcmVtZW50QW5k\nR2V0KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIHJlcGxhY2VCb29raWVJbk1ldGFk\nYXRhKGFkZHIsIGJvb2tpZUluZGV4KTsKCiAgICAgICAgICAgICAgICBibG9j\na0FkZENvbXBsZXRpb25zLmRlY3JlbWVudEFuZEdldCgpOwogICAgICAgICAg\nICAgICAgLy8gdGhlIGZhaWxlZCBib29raWUgaGFzIGJlZW4gcmVwbGFjZWQK\nICAgICAgICAgICAgICAgIHVuc2V0U3VjY2Vzc0FuZFNlbmRXcml0ZVJlcXVl\nc3QoYm9va2llSW5kZXgpOwogICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2Vw\ndGlvbi5CS05vdEVub3VnaEJvb2tpZXNFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3QgZ2V0IGFkZGl0aW9uYWwg\nYm9va2llIHRvICIKICAgICAgICAgICAgICAgICAgICAgICAgICArICJyZW1h\na2UgZW5zZW1ibGUsIGNsb3NpbmcgbGVkZ2VyOiAiICsgbGVkZ2VySWQpOwog\nICAgICAgICAgICAgICAgaGFuZGxlVW5yZWNvdmVyYWJsZUVycm9yRHVyaW5n\nQWRkKGUuZ2V0Q29kZSgpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIG9uQ2hhbmdlZChsb25nIGxpZCwgTGVkZ2VyTWV0YWRh\ndGEgbmV3TWV0YWRhdGEpIHsKICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRlYnVnKCJSZWNlaXZlZCBsZWRn\nZXIgbWV0YWRhdGEgdXBkYXRlIG9uIHt9IDoge30iLCBsaWQsIG5ld01ldGFk\nYXRhKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMubGVkZ2VySWQgIT0g\nbGlkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAg\naWYgKG51bGwgPT0gbmV3TWV0YWRhdGEpIHsKICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgIH0KICAgICAgICBWZXJzaW9uLk9jY3VycmVkIG9jY3VycmVk\nID0KICAgICAgICAgICAgICAgIHRoaXMubWV0YWRhdGEuZ2V0VmVyc2lvbigp\nLmNvbXBhcmUobmV3TWV0YWRhdGEuZ2V0VmVyc2lvbigpKTsKICAgICAgICBp\nZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRl\nYnVnKCJUcnkgdG8gdXBkYXRlIG1ldGFkYXRhIGZyb20ge30gdG8ge30gOiB7\nfSIsCiAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgdGhpcy5t\nZXRhZGF0YSwgbmV3TWV0YWRhdGEsIG9jY3VycmVkIH0pOwogICAgICAgIH0K\nICAgICAgICBpZiAoVmVyc2lvbi5PY2N1cnJlZC5CRUZPUkUgPT0gb2NjdXJy\nZWQpIHsgLy8gdGhlIG1ldGFkYXRhIGlzIHVwZGF0ZWQKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIGJrLm1haW5Xb3JrZXJQb29sLnN1Ym1p\ndE9yZGVyZWQobGVkZ2VySWQsIG5ldyBNZXRhZGF0YVVwZGF0ZXIobmV3TWV0\nYWRhdGEpKTsKICAgICAgICAgICAgfSBjYXRjaCAoUmVqZWN0ZWRFeGVjdXRp\nb25FeGNlcHRpb24gcmVlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkZhaWxlZCBvbiBzdWJtaXR0aW5nIHVwZGF0ZXIgdG8gdXBkYXRlIGxlZGdl\nciBtZXRhZGF0YSBvbiBsZWRnZXIge30gOiB7fSIsCiAgICAgICAgICAgICAg\nICAgICAgICAgIGxlZGdlcklkLCBuZXdNZXRhZGF0YSk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\nU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgIHJldHVybiBTdHJpbmcuZm9y\nbWF0KCJSZWFkT25seUxlZGdlckhhbmRsZShsaWQgPSAlZCwgaWQgPSAlZCki\nLCBsZWRnZXJJZCwgc3VwZXIuaGFzaENvZGUoKSk7CiAgICB9Cgp9Cg==\n","encoding":"base64"}

