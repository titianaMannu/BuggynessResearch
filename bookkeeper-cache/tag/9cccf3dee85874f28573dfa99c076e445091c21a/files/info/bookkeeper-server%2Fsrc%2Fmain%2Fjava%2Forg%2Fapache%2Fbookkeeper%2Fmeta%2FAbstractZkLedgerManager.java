{"sha":"ab11a85f9829fbcf49b67fb3b8d6946ee736f530","node_id":"MDQ6QmxvYjE1NzU5NTY6YWIxMWE4NWY5ODI5ZmJjZjQ5YjY3ZmIzYjhkNjk0NmVlNzM2ZjUzMA==","size":20366,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ab11a85f9829fbcf49b67fb3b8d6946ee736f530","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YTsKCmltcG9ydCBqYXZh\nLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7Cmlt\ncG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5OYXZpZ2Fi\nbGVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGls\nLlRyZWVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJy\nZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1\ncnJlbnRNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRv\ncnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TY2hlZHVsZWRFeGVj\ndXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1l\nVW5pdDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJL\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5MZWRnZXJNZXRhZGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jb25mLkFic3RyYWN0Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5MZWRnZXJN\nZXRhZGF0YUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5NdWx0aUNhbGxi\nYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tr\nZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Qcm9jZXNzb3I7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuWmtVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZlcnNpb247\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQXN5bmNDYWxsYmFjay5EYXRh\nQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0Nh\nbGxiYWNrLlN0YXRDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLkFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9uLkNvZGU7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuZGF0YS5TdGF0OwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29nbGUu\nY29tbW9uLnV0aWwuY29uY3VycmVudC5UaHJlYWRGYWN0b3J5QnVpbGRlcjsK\nCi8qKgogKiBBYnN0cmFjdCBsZWRnZXIgbWFuYWdlciBiYXNlZCBvbiB6b29r\nZWVwZXIsIHdoaWNoIHByb3ZpZGVzIGNvbW1vbiBtZXRob2RzIHN1Y2ggYXMg\ncXVlcnkgemsgbm9kZXMuCiAqLwphYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFpr\nTGVkZ2VyTWFuYWdlciBpbXBsZW1lbnRzIExlZGdlck1hbmFnZXIsIFdhdGNo\nZXIgewoKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5n\nZXRMb2dnZXIoQWJzdHJhY3Raa0xlZGdlck1hbmFnZXIuY2xhc3MpOwoKICAg\nIHN0YXRpYyBpbnQgWktfQ09OTkVDVF9CQUNLT0ZGX01TID0gMjAwOwoKICAg\nIHByb3RlY3RlZCBmaW5hbCBBYnN0cmFjdENvbmZpZ3VyYXRpb24gY29uZjsK\nICAgIHByb3RlY3RlZCBmaW5hbCBab29LZWVwZXIgems7CiAgICBwcm90ZWN0\nZWQgZmluYWwgU3RyaW5nIGxlZGdlclJvb3RQYXRoOwoKICAgIC8vIGxlZGdl\nciBtZXRhZGF0YSBsaXN0ZW5lcnMKICAgIHByb3RlY3RlZCBmaW5hbCBDb25j\ndXJyZW50TWFwPExvbmcsIFNldDxMZWRnZXJNZXRhZGF0YUxpc3RlbmVyPj4g\nbGlzdGVuZXJzID0KICAgICAgICAgICAgbmV3IENvbmN1cnJlbnRIYXNoTWFw\nPExvbmcsIFNldDxMZWRnZXJNZXRhZGF0YUxpc3RlbmVyPj4oKTsKICAgIC8v\nIHdlIHVzZSB0aGlzIHRvIHByZXZlbnQgbG9uZyBzdGFjayBjaGFpbnMgZnJv\nbSBidWlsZGluZyB1cCBpbiBjYWxsYmFja3MKICAgIHByb3RlY3RlZCBTY2hl\nZHVsZWRFeGVjdXRvclNlcnZpY2Ugc2NoZWR1bGVyOwoKICAgIHByb3RlY3Rl\nZCBjbGFzcyBSZWFkTGVkZ2VyTWV0YWRhdGFUYXNrIGltcGxlbWVudHMgUnVu\nbmFibGUsIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4gewoKICAg\nICAgICBmaW5hbCBsb25nIGxlZGdlcklkOwoKICAgICAgICBSZWFkTGVkZ2Vy\nTWV0YWRhdGFUYXNrKGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICAgICAgdGhp\ncy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICBpZiAobnVsbCAhPSBsaXN0ZW5lcnMuZ2V0KGxlZGdlcklkKSkgewogICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJSZS1yZWFkIGxlZGdlciBtZXRhZGF0\nYSBmb3Ige30uIiwgbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgcmVhZExl\nZGdlck1ldGFkYXRhKGxlZGdlcklkLCB0aGlzLCBBYnN0cmFjdFprTGVkZ2Vy\nTWFuYWdlci50aGlzKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiTGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVyIGZv\nciBsZWRnZXIge30gaXMgYWxyZWFkeSByZW1vdmVkLiIsIGxlZGdlcklkKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBm\naW5hbCBMZWRnZXJNZXRhZGF0YSByZXN1bHQpIHsKICAgICAgICAgICAgaWYg\nKEJLRXhjZXB0aW9uLkNvZGUuT0sgPT0gcmMpIHsKICAgICAgICAgICAgICAg\nIGZpbmFsIFNldDxMZWRnZXJNZXRhZGF0YUxpc3RlbmVyPiBsaXN0ZW5lclNl\ndCA9IGxpc3RlbmVycy5nZXQobGVkZ2VySWQpOwogICAgICAgICAgICAgICAg\naWYgKG51bGwgIT0gbGlzdGVuZXJTZXQpIHsKICAgICAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIkxlZGdlciBtZXRhZGF0YSBpcyBjaGFuZ2VkIGZvciB7\nfSA6IHt9LiIsIGxlZGdlcklkLCByZXN1bHQpOwogICAgICAgICAgICAgICAg\nICAgIHNjaGVkdWxlci5zdWJtaXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAg\nICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgc3luY2hyb25pemVkKGxpc3RlbmVyU2V0KSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChMZWRnZXJNZXRhZGF0YUxp\nc3RlbmVyIGxpc3RlbmVyIDogbGlzdGVuZXJTZXQpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXIub25DaGFuZ2VkKGxl\nZGdlcklkLCByZXN1bHQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKEJLRXhjZXB0\naW9uLkNvZGUuTm9TdWNoTGVkZ2VyRXhpc3RzRXhjZXB0aW9uID09IHJjKSB7\nCiAgICAgICAgICAgICAgICAvLyB0aGUgbGVkZ2VyIGlzIHJlbW92ZWQsIGRv\nIG5vdGhpbmcKICAgICAgICAgICAgICAgIFNldDxMZWRnZXJNZXRhZGF0YUxp\nc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxpc3RlbmVycy5yZW1vdmUobGVkZ2Vy\nSWQpOwogICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gbGlzdGVuZXJTZXQp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlJlbW92ZWQgbGVk\nZ2VyIG1ldGFkYXRhIGxpc3RlbmVyIHNldCBvbiBsZWRnZXIge30gYXMgaXRz\nIGxlZGdlciBpcyBkZWxldGVkIDoge30iLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbGVkZ2VySWQsIGxpc3RlbmVyU2V0LnNpemUoKSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBMT0cud2FybigiRmFpbGVkIG9uIHJlYWQgbGVkZ2VyIG1ldGFkYXRh\nIG9mIGxlZGdlciB7fSA6IHt9IiwgbGVkZ2VySWQsIHJjKTsKICAgICAgICAg\nICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZSh0aGlzLCBaS19DT05ORUNUX0JB\nQ0tPRkZfTVMsIFRpbWVVbml0Lk1JTExJU0VDT05EUyk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CgoKICAgIC8qKgogICAgICogWm9vS2VlcGVy\nLWJhc2VkIExlZGdlciBNYW5hZ2VyIENvbnN0cnVjdG9yCiAgICAgKgogICAg\nICogQHBhcmFtIGNvbmYKICAgICAqICAgICAgICAgIENvbmZpZ3VyYXRpb24g\nb2JqZWN0CiAgICAgKiBAcGFyYW0gemsKICAgICAqICAgICAgICAgIFpvb0tl\nZXBlciBDbGllbnQgSGFuZGxlCiAgICAgKi8KICAgIHByb3RlY3RlZCBBYnN0\ncmFjdFprTGVkZ2VyTWFuYWdlcihBYnN0cmFjdENvbmZpZ3VyYXRpb24gY29u\nZiwgWm9vS2VlcGVyIHprKSB7CiAgICAgICAgdGhpcy5jb25mID0gY29uZjsK\nICAgICAgICB0aGlzLnprID0gems7CiAgICAgICAgdGhpcy5sZWRnZXJSb290\nUGF0aCA9IGNvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKTsKICAgICAgICB0\naGlzLnNjaGVkdWxlciA9IEV4ZWN1dG9ycy5uZXdTaW5nbGVUaHJlYWRTY2hl\nZHVsZWRFeGVjdXRvcigpOwogICAgICAgIFRocmVhZEZhY3RvcnlCdWlsZGVy\nIHRmYiA9IG5ldyBUaHJlYWRGYWN0b3J5QnVpbGRlcigpLnNldE5hbWVGb3Jt\nYXQoCiAgICAgICAgICAgICAgICAiWmtMZWRnZXJNYW5hZ2VyU2NoZWR1bGVy\nLSVkIik7CiAgICAgICAgdGhpcy5zY2hlZHVsZXIgPSBFeGVjdXRvcnMKICAg\nICAgICAgICAgICAgIC5uZXdTaW5nbGVUaHJlYWRTY2hlZHVsZWRFeGVjdXRv\ncih0ZmIuYnVpbGQoKSk7CiAgICAgICAgTE9HLmRlYnVnKCJVc2luZyBBYnN0\ncmFjdFprTGVkZ2VyTWFuYWdlciB3aXRoIHJvb3QgcGF0aCA6IHt9IiwgbGVk\nZ2VyUm9vdFBhdGgpOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IHRoZSB6\nbm9kZSBwYXRoIHRoYXQgaXMgdXNlZCB0byBzdG9yZSBsZWRnZXIgbWV0YWRh\ndGEKICAgICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAqICAgICAg\nICAgIExlZGdlciBJRAogICAgICogQHJldHVybiBsZWRnZXIgbm9kZSBwYXRo\nCiAgICAgKi8KICAgIHByb3RlY3RlZCBhYnN0cmFjdCBTdHJpbmcgZ2V0TGVk\nZ2VyUGF0aChsb25nIGxlZGdlcklkKTsKCiAgICAvKioKICAgICAqIEdldCBs\nZWRnZXIgaWQgZnJvbSBpdHMgem5vZGUgbGVkZ2VyIHBhdGgKICAgICAqCiAg\nICAgKiBAcGFyYW0gbGVkZ2VyUGF0aAogICAgICogICAgICAgICAgTGVkZ2Vy\nIHBhdGggdG8gc3RvcmUgbWV0YWRhdGEKICAgICAqIEByZXR1cm4gbGVkZ2Vy\nIGlkCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uIHdoZW4gdGhlIGxlZGdl\nciBwYXRoIGlzIGludmFsaWQKICAgICAqLwogICAgcHJvdGVjdGVkIGFic3Ry\nYWN0IGxvbmcgZ2V0TGVkZ2VySWQoU3RyaW5nIGxlZGdlclBhdGgpIHRocm93\ncyBJT0V4Y2VwdGlvbjsKCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lk\nIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgTE9HLmlu\nZm8oIlJlY2VpdmVkIHdhdGNoZWQgZXZlbnQge30gZnJvbSB6b29rZWVwZXIg\nYmFzZWQgbGVkZ2VyIG1hbmFnZXIuIiwgZXZlbnQpOwogICAgICAgIGlmIChF\ndmVudC5FdmVudFR5cGUuTm9uZSA9PSBldmVudC5nZXRUeXBlKCkpIHsKICAg\nICAgICAgICAgLyoqIFRPRE86IEJPT0tLRUVQRVItNTM3IHRvIGhhbmRsZSBl\neHBpcmUgZXZlbnRzLgogICAgICAgICAgICBpZiAoRXZlbnQuS2VlcGVyU3Rh\ndGUuRXhwaXJlZCA9PSBldmVudC5nZXRTdGF0ZSgpKSB7CiAgICAgICAgICAg\nICAgICBMT0cuaW5mbygiWm9vS2VlcGVyIGNsaWVudCBleHBpcmVkIG9uIGxl\nZGdlciBtYW5hZ2VyLiIpOwogICAgICAgICAgICAgICAgU2V0PExvbmc+IGtl\neVNldCA9IG5ldyBIYXNoU2V0PExvbmc+KGxpc3RlbmVycy5rZXlTZXQoKSk7\nCiAgICAgICAgICAgICAgICBmb3IgKExvbmcgbGlkIDoga2V5U2V0KSB7CiAg\nICAgICAgICAgICAgICAgICAgc2NoZWR1bGVyLnN1Ym1pdChuZXcgUmVhZExl\nZGdlck1ldGFkYXRhVGFzayhsaWQpKTsKICAgICAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiUmUtcmVhZCBsZWRnZXIgbWV0YWRhdGEgZm9yIHt9IGFmdGVy\nIHpvb2tlZXBlciBzZXNzaW9uIGV4cGlyZWQuIiwgbGlkKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAqKi8KICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBTdHJpbmcgcGF0aCA9\nIGV2ZW50LmdldFBhdGgoKTsKICAgICAgICBpZiAobnVsbCA9PSBwYXRoKSB7\nCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgZmluYWwg\nbG9uZyBsZWRnZXJJZDsKICAgICAgICB0cnkgewogICAgICAgICAgICBsZWRn\nZXJJZCA9IGdldExlZGdlcklkKGV2ZW50LmdldFBhdGgoKSk7CiAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIExPRy5p\nbmZvKCJSZWNlaXZlZCBpbnZhbGlkIGxlZGdlciBwYXRoIHt9IDogIiwgZXZl\nbnQuZ2V0UGF0aCgpLCBpb2UpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQogICAgICAgIHN3aXRjaCAoZXZlbnQuZ2V0VHlwZSgpKSB7CiAgICAg\nICAgY2FzZSBOb2RlRGVsZXRlZDoKICAgICAgICAgICAgU2V0PExlZGdlck1l\ndGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0ID0gbGlzdGVuZXJzLmdldChs\nZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChudWxsICE9IGxpc3RlbmVyU2V0\nKSB7CiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQobGlzdGVuZXJTZXQp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlJlbW92ZWQgbGVk\nZ2VyIG1ldGFkYXRhIGxpc3RlbmVycyBvbiBsZWRnZXIge30gOiB7fSIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZCwgbGlzdGVuZXJT\nZXQpOwogICAgICAgICAgICAgICAgICAgIGZvcihMZWRnZXJNZXRhZGF0YUxp\nc3RlbmVyIGwgOiBsaXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAgICAg\nICAgICB1bnJlZ2lzdGVyTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcihsZWRnZXJJ\nZCwgbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGwub25DaGFuZ2VkKCBs\nZWRnZXJJZCwgbnVsbCApOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIExPRy5kZWJ1ZygiTm8gbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVycyB0\nbyByZW1vdmUgZnJvbSBsZWRnZXIge30gYWZ0ZXIgaXQncyBkZWxldGVkLiIs\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcklkKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIE5vZGVEYXRh\nQ2hhbmdlZDoKICAgICAgICAgICAgbmV3IFJlYWRMZWRnZXJNZXRhZGF0YVRh\nc2sobGVkZ2VySWQpLnJ1bigpOwogICAgICAgICAgICBicmVhazsKICAgICAg\nICBkZWZhdWx0OgogICAgICAgICAgICBMT0cuZGVidWcoIlJlY2VpdmVkIGV2\nZW50IHt9IG9uIHt9LiIsIGV2ZW50LmdldFR5cGUoKSwgZXZlbnQuZ2V0UGF0\naCgpKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQoKICAg\nIC8qKgogICAgICogUmVtb3ZlcyBsZWRnZXIgbWV0YWRhdGEgZnJvbSBab29L\nZWVwZXIgaWYgdmVyc2lvbiBtYXRjaGVzLgogICAgICoKICAgICAqIEBwYXJh\nbSAgIGxlZGdlcklkICAgIGxlZGdlciBpZGVudGlmaWVyCiAgICAgKiBAcGFy\nYW0gICB2ZXJzaW9uICAgICBsb2NhbCB2ZXJzaW9uIG9mIG1ldGFkYXRhIHpu\nb2RlCiAgICAgKiBAcGFyYW0gICBjYiAgICAgICAgICBjYWxsYmFjayBvYmpl\nY3QKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCByZW1v\ndmVMZWRnZXJNZXRhZGF0YShmaW5hbCBsb25nIGxlZGdlcklkLCBmaW5hbCBW\nZXJzaW9uIHZlcnNpb24sCiAgICAgICAgICAgIGZpbmFsIEdlbmVyaWNDYWxs\nYmFjazxWb2lkPiBjYikgewogICAgICAgIGludCB6bm9kZVZlcnNpb24gPSAt\nMTsKICAgICAgICBpZiAoVmVyc2lvbi5ORVcgPT0gdmVyc2lvbikgewogICAg\nICAgICAgICBMT0cuZXJyb3IoIlJlcXVlc3QgdG8gZGVsZXRlIGxlZGdlciB7\nfSBtZXRhZGF0YSB3aXRoIHZlcnNpb24gc2V0IHRvIHRoZSBpbml0aWFsIG9u\nZSIsIGxlZGdlcklkKTsKICAgICAgICAgICAgY2Iub3BlcmF0aW9uQ29tcGxl\ndGUoQktFeGNlcHRpb24uQ29kZS5NZXRhZGF0YVZlcnNpb25FeGNlcHRpb24s\nIChWb2lkKW51bGwpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfSBl\nbHNlIGlmIChWZXJzaW9uLkFOWSAhPSB2ZXJzaW9uKSB7CiAgICAgICAgICAg\nIGlmICghKHZlcnNpb24gaW5zdGFuY2VvZiBaa1ZlcnNpb24pKSB7CiAgICAg\nICAgICAgICAgICBMT0cuaW5mbygiTm90IGFuIGluc3RhbmNlIG9mIFpLVmVy\nc2lvbjoge30iLCBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICBjYi5vcGVy\nYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lv\nbkV4Y2VwdGlvbiwgKFZvaWQpbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB6bm9k\nZVZlcnNpb24gPSAoKFprVmVyc2lvbil2ZXJzaW9uKS5nZXRabm9kZVZlcnNp\nb24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgemsuZGVs\nZXRlKGdldExlZGdlclBhdGgobGVkZ2VySWQpLCB6bm9kZVZlcnNpb24sIG5l\ndyBWb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGludCByYywgU3Ry\naW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgIGludCBi\na1JjOwogICAgICAgICAgICAgICAgaWYgKHJjID09IEtlZXBlckV4Y2VwdGlv\nbi5Db2RlLk5PTk9ERS5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgTE9HLndhcm4oIkxlZGdlciBub2RlIGRvZXMgbm90IGV4aXN0IGluIFpv\nb0tlZXBlcjogbGVkZ2VySWQ9e30iLCBsZWRnZXJJZCk7CiAgICAgICAgICAg\nICAgICAgICAgYmtSYyA9IEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNoTGVkZ2Vy\nRXhpc3RzRXhjZXB0aW9uOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChy\nYyA9PSBLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAg\nICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlZCBsaXN0ZW5lciBvbiBsZWRn\nZXJJZAogICAgICAgICAgICAgICAgICAgIFNldDxMZWRnZXJNZXRhZGF0YUxp\nc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxpc3RlbmVycy5yZW1vdmUobGVkZ2Vy\nSWQpOwogICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGxpc3RlbmVy\nU2V0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiUmVt\nb3ZlIHJlZ2lzdGVyZWQgbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVycyBvbiBs\nZWRnZXIge30gYWZ0ZXIgbGVkZ2VyIGlzIGRlbGV0ZWQuIiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZCwgbGlzdGVuZXJTZXQp\nOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIExPRy5kZWJ1ZygiTm8gbGVkZ2VyIG1ldGFkYXRhIGxpc3Rl\nbmVycyB0byByZW1vdmUgZnJvbSBsZWRnZXIge30gd2hlbiBpdCdzIGJlaW5n\nIGRlbGV0ZWQuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIGJrUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBia1JjID0gQktF\neGNlcHRpb24uQ29kZS5aS0V4Y2VwdGlvbjsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKGJrUmMsIChW\nb2lkKW51bGwpOwogICAgICAgICAgICB9CiAgICAgICAgfSwgbnVsbCk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCByZWdpc3Rlckxl\nZGdlck1ldGFkYXRhTGlzdGVuZXIobG9uZyBsZWRnZXJJZCwgTGVkZ2VyTWV0\nYWRhdGFMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIGlmIChudWxsICE9\nIGxpc3RlbmVyKSB7CiAgICAgICAgICAgIExPRy5pbmZvKCJSZWdpc3RlcmVk\nIGxlZGdlciBtZXRhZGF0YSBsaXN0ZW5lciB7fSBvbiBsZWRnZXIge30uIiwg\nbGlzdGVuZXIsIGxlZGdlcklkKTsKICAgICAgICAgICAgU2V0PExlZGdlck1l\ndGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0ID0gbGlzdGVuZXJzLmdldChs\nZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChsaXN0ZW5lclNldCA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBTZXQ8TGVkZ2VyTWV0YWRhdGFMaXN0ZW5l\ncj4gbmV3TGlzdGVuZXJTZXQgPSBuZXcgSGFzaFNldDxMZWRnZXJNZXRhZGF0\nYUxpc3RlbmVyPigpOwogICAgICAgICAgICAgICAgU2V0PExlZGdlck1ldGFk\nYXRhTGlzdGVuZXI+IG9sZExpc3RlbmVyU2V0ID0gbGlzdGVuZXJzLnB1dElm\nQWJzZW50KGxlZGdlcklkLCBuZXdMaXN0ZW5lclNldCk7CiAgICAgICAgICAg\nICAgICBpZiAobnVsbCAhPSBvbGRMaXN0ZW5lclNldCkgewogICAgICAgICAg\nICAgICAgICAgIGxpc3RlbmVyU2V0ID0gb2xkTGlzdGVuZXJTZXQ7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIGxpc3Rl\nbmVyU2V0ID0gbmV3TGlzdGVuZXJTZXQ7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgc3luY2hyb25pemVkIChsaXN0ZW5l\nclNldCkgewogICAgICAgICAgICAgICAgbGlzdGVuZXJTZXQuYWRkKGxpc3Rl\nbmVyKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBuZXcgUmVhZExlZGdl\nck1ldGFkYXRhVGFzayhsZWRnZXJJZCkucnVuKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdW5yZWdpc3Rlckxl\nZGdlck1ldGFkYXRhTGlzdGVuZXIobG9uZyBsZWRnZXJJZCwgTGVkZ2VyTWV0\nYWRhdGFMaXN0ZW5lciBsaXN0ZW5lcikgewogICAgICAgIFNldDxMZWRnZXJN\nZXRhZGF0YUxpc3RlbmVyPiBsaXN0ZW5lclNldCA9IGxpc3RlbmVycy5nZXQo\nbGVkZ2VySWQpOwogICAgICAgIGlmIChsaXN0ZW5lclNldCAhPSBudWxsKSB7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAobGlzdGVuZXJTZXQpIHsKICAg\nICAgICAgICAgICAgIGlmIChsaXN0ZW5lclNldC5yZW1vdmUobGlzdGVuZXIp\nKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlVucmVnaXN0ZXJl\nZCBsZWRnZXIgbWV0YWRhdGEgbGlzdGVuZXIge30gb24gbGVkZ2VyIHt9LiIs\nIGxpc3RlbmVyLCBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICBpZiAobGlzdGVuZXJTZXQuaXNFbXB0eSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgbGlzdGVuZXJzLnJlbW92ZShsZWRnZXJJZCwgbGlz\ndGVuZXJTZXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\ncmVhZExlZGdlck1ldGFkYXRhKGZpbmFsIGxvbmcgbGVkZ2VySWQsIGZpbmFs\nIEdlbmVyaWNDYWxsYmFjazxMZWRnZXJNZXRhZGF0YT4gcmVhZENiKSB7CiAg\nICAgICAgcmVhZExlZGdlck1ldGFkYXRhKGxlZGdlcklkLCByZWFkQ2IsIG51\nbGwpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHJlYWRMZWRnZXJNZXRh\nZGF0YShmaW5hbCBsb25nIGxlZGdlcklkLCBmaW5hbCBHZW5lcmljQ2FsbGJh\nY2s8TGVkZ2VyTWV0YWRhdGE+IHJlYWRDYiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBXYXRjaGVyIHdhdGNoZXIpIHsKICAgICAg\nICB6ay5nZXREYXRhKGdldExlZGdlclBhdGgobGVkZ2VySWQpLCB3YXRjaGVy\nLCBuZXcgRGF0YUNhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMs\nIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBieXRlW10gZGF0YSwgU3RhdCBz\ndGF0KSB7CiAgICAgICAgICAgICAgICBpZiAocmMgPT0gS2VlcGVyRXhjZXB0\naW9uLkNvZGUuTk9OT0RFLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAg\nICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCJObyBzdWNoIGxlZGdlcjogIiArIGxl\nZGdlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2Vl\ncGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNlcHRpb24uQ29kZS5nZXQo\ncmMpLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIHJlYWRDYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlv\nbi5Db2RlLk5vU3VjaExlZGdlckV4aXN0c0V4Y2VwdGlvbiwgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgaWYgKHJjICE9IEtlZXBlckV4Y2VwdGlvbi5Db2Rl\nLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkNvdWxkIG5vdCByZWFkIG1ldGFkYXRhIGZvciBsZWRnZXI6ICIgKyBs\nZWRnZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgS2VlcGVy\nRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNlcHRpb24uQ29kZS5nZXQocmMp\nLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAgICAgcmVhZENiLm9wZXJhdGlv\nbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuWktFeGNlcHRpb24sIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICBMZWRnZXJNZXRhZGF0YSBtZXRhZGF0YTsK\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgbWV0\nYWRhdGEgPSBMZWRnZXJNZXRhZGF0YS5wYXJzZUNvbmZpZyhkYXRhLCBuZXcg\nWmtWZXJzaW9uKHN0YXQuZ2V0VmVyc2lvbigpKSk7CiAgICAgICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJDb3VsZCBub3QgcGFyc2UgbGVkZ2VyIG1ldGFkYXRh\nIGZvciBsZWRnZXI6ICIgKyBsZWRnZXJJZCwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgcmVhZENiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNv\nZGUuWktFeGNlcHRpb24sIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlYWRD\nYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9LLCBtZXRh\nZGF0YSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCBudWxsKTsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHdyaXRlTGVkZ2VyTWV0\nYWRhdGEoZmluYWwgbG9uZyBsZWRnZXJJZCwgZmluYWwgTGVkZ2VyTWV0YWRh\ndGEgbWV0YWRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxWb2lkPiBjYikgewogICAgICAg\nIFZlcnNpb24gdiA9IG1ldGFkYXRhLmdldFZlcnNpb24oKTsKICAgICAgICBp\nZiAoVmVyc2lvbi5ORVcgPT0gdiB8fCAhKHYgaW5zdGFuY2VvZiBaa1ZlcnNp\nb24pKSB7CiAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhj\nZXB0aW9uLkNvZGUuTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uLCBudWxsKTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBmaW5hbCBa\na1ZlcnNpb24genYgPSAoWmtWZXJzaW9uKSB2OwogICAgICAgIHprLnNldERh\ndGEoZ2V0TGVkZ2VyUGF0aChsZWRnZXJJZCksCiAgICAgICAgICAgICAgICAg\nICBtZXRhZGF0YS5zZXJpYWxpemUoKSwgenYuZ2V0Wm5vZGVWZXJzaW9uKCks\nCiAgICAgICAgICAgICAgICAgICBuZXcgU3RhdENhbGxiYWNrKCkgewogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJv\nY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBT\ndGF0IHN0YXQpIHsKICAgICAgICAgICAgICAgIGlmIChLZWVwZXJFeGNlcHRp\nb24uQ29kZS5CYWRWZXJzaW9uID09IHJjKSB7CiAgICAgICAgICAgICAgICAg\nICAgY2Iub3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5NZXRh\nZGF0YVZlcnNpb25FeGNlcHRpb24sIG51bGwpOwogICAgICAgICAgICAgICAg\nfSBlbHNlIGlmIChLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgp\nID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIG1ldGFk\nYXRhIHZlcnNpb24KICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5zZXRW\nZXJzaW9uKHp2LnNldFpub2RlVmVyc2lvbihzdGF0LmdldFZlcnNpb24oKSkp\nOwogICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkNvbXBsZXRlKEJL\nRXhjZXB0aW9uLkNvZGUuT0ssIG51bGwpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQ29uZGl0aW9u\nYWwgdXBkYXRlIGxlZGdlciBtZXRhZGF0YSBmYWlsZWQ6ICIsIEtlZXBlckV4\nY2VwdGlvbi5Db2RlLmdldChyYykpOwogICAgICAgICAgICAgICAgICAgIGNi\nLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuWktFeGNlcHRp\nb24sIG51bGwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAg\nICAgICAgfSwgbnVsbCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNz\nIGxlZGdlcnMgaW4gYSBzaW5nbGUgemsgbm9kZS4KICAgICAqCiAgICAgKiA8\ncD4KICAgICAqIGZvciBlYWNoIGxlZGdlciBmb3VuZCBpbiB0aGlzIHprIG5v\nZGUsIHByb2Nlc3NvciNwcm9jZXNzKGxlZGdlcklkKSB3aWxsIGJlIHRyaWdn\nZXJyZWQKICAgICAqIHRvIHByb2Nlc3MgYSBzcGVjaWZpYyBsZWRnZXIuIGFm\ndGVyIGFsbCBsZWRnZXJzIGhhcyBiZWVuIHByb2Nlc3NlZCwgdGhlIGZpbmFs\nQ2Igd2lsbAogICAgICogYmUgY2FsbGVkIHdpdGggcHJvdmlkZWQgY29udGV4\ndCBvYmplY3QuIFRoZSBSQyBwYXNzZWQgdG8gZmluYWxDYiBpcyBkZWNpZGVk\nIGJ5IDoKICAgICAqIDx1bD4KICAgICAqIDxsaT4gQWxsIGxlZGdlcnMgYXJl\nIHByb2Nlc3NlZCBzdWNjZXNzZnVsbHksIHN1Y2Nlc3NSYyB3aWxsIGJlIHBh\nc3NlZC4KICAgICAqIDxsaT4gRWl0aGVyIGxlZGdlciBpcyBwcm9jZXNzZWQg\nZmFpbGVkLCBmYWlsdXJlUmMgd2lsbCBiZSBwYXNzZWQuCiAgICAgKiA8L3Vs\nPgogICAgICogPC9wPgogICAgICoKICAgICAqIEBwYXJhbSBwYXRoCiAgICAg\nKiAgICAgICAgICBaayBub2RlIHBhdGggdG8gc3RvcmUgbGVkZ2VycwogICAg\nICogQHBhcmFtIHByb2Nlc3NvcgogICAgICogICAgICAgICAgUHJvY2Vzc29y\nIHByb3ZpZGVkIHRvIHByb2Nlc3MgbGVkZ2VyCiAgICAgKiBAcGFyYW0gZmlu\nYWxDYgogICAgICogICAgICAgICAgQ2FsbGJhY2sgb2JqZWN0IHdoZW4gYWxs\nIGxlZGdlcnMgYXJlIHByb2Nlc3NlZAogICAgICogQHBhcmFtIGN0eAogICAg\nICogICAgICAgICAgQ29udGV4dCBvYmplY3QgcGFzc2VkIHRvIGZpbmFsQ2IK\nICAgICAqIEBwYXJhbSBzdWNjZXNzUmMKICAgICAqICAgICAgICAgIFJDIHBh\nc3NlZCB0byBmaW5hbENiIHdoZW4gYWxsIGxlZGdlcnMgYXJlIHByb2Nlc3Nl\nZCBzdWNjZXNzZnVsbHkKICAgICAqIEBwYXJhbSBmYWlsdXJlUmMKICAgICAq\nICAgICAgICAgIFJDIHBhc3NlZCB0byBmaW5hbENiIHdoZW4gZWl0aGVyIGxl\nZGdlciBpcyBwcm9jZXNzZWQgZmFpbGVkCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIGFzeW5jUHJvY2Vzc0xlZGdlcnNJblNpbmdsZU5vZGUoCiAgICAg\nICAgICAgIGZpbmFsIFN0cmluZyBwYXRoLCBmaW5hbCBQcm9jZXNzb3I8TG9u\nZz4gcHJvY2Vzc29yLAogICAgICAgICAgICBmaW5hbCBBc3luY0NhbGxiYWNr\nLlZvaWRDYWxsYmFjayBmaW5hbENiLCBmaW5hbCBPYmplY3QgY3R4LAogICAg\nICAgICAgICBmaW5hbCBpbnQgc3VjY2Vzc1JjLCBmaW5hbCBpbnQgZmFpbHVy\nZVJjKSB7CiAgICAgICAgWmtVdGlscy5nZXRDaGlsZHJlbkluU2luZ2xlTm9k\nZSh6aywgcGF0aCwgbmV3IEdlbmVyaWNDYWxsYmFjazxMaXN0PFN0cmluZz4+\nKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBMaXN0PFN0cmluZz4g\nbGVkZ2VyTm9kZXMpIHsKICAgICAgICAgICAgICAgIGlmIChDb2RlLk9LLmlu\ndFZhbHVlKCkgIT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICBmaW5hbENi\nLnByb2Nlc3NSZXN1bHQoZmFpbHVyZVJjLCBudWxsLCBjdHgpOwogICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgICAgICBTZXQ8TG9uZz4gemtBY3RpdmVMZWRnZXJzID0gbGVkZ2Vy\nTGlzdFRvU2V0KGxlZGdlck5vZGVzLCBwYXRoKTsKICAgICAgICAgICAgICAg\nIExPRy5kZWJ1ZygiUHJvY2Vzc2luZyBsZWRnZXJzOiB7fSIsIHprQWN0aXZl\nTGVkZ2Vycyk7CgogICAgICAgICAgICAgICAgLy8gbm8gbGVkZ2VycyBmb3Vu\nZCwgcmV0dXJuIGRpcmVjdGx5CiAgICAgICAgICAgICAgICBpZiAoemtBY3Rp\ndmVMZWRnZXJzLnNpemUoKSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAg\nZmluYWxDYi5wcm9jZXNzUmVzdWx0KHN1Y2Nlc3NSYywgbnVsbCwgY3R4KTsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgTXVsdGlDYWxsYmFjayBtY2IgPSBuZXcgTXVs\ndGlDYWxsYmFjayh6a0FjdGl2ZUxlZGdlcnMuc2l6ZSgpLCBmaW5hbENiLCBj\ndHgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHN1Y2Nlc3NSYywgZmFpbHVyZVJjKTsKICAgICAgICAg\nICAgICAgIC8vIHN0YXJ0IGxvb3Agb3ZlciBhbGwgbGVkZ2VycwogICAgICAg\nICAgICAgICAgZm9yIChMb25nIGxlZGdlciA6IHprQWN0aXZlTGVkZ2Vycykg\newogICAgICAgICAgICAgICAgICAgIHByb2Nlc3Nvci5wcm9jZXNzKGxlZGdl\nciwgbWNiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogV2hldGhlciB0aGUgem5v\nZGUgYSBzcGVjaWFsIHpub2RlCiAgICAgKgogICAgICogQHBhcmFtIHpub2Rl\nCiAgICAgKiAgICAgICAgICBabm9kZSBOYW1lCiAgICAgKiBAcmV0dXJuIHRy\ndWUgIGlmIHRoZSB6bm9kZSBpcyBhIHNwZWNpYWwgem5vZGUgb3RoZXJ3aXNl\nIGZhbHNlCiAgICAgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGlzU3BlY2lh\nbFpub2RlKFN0cmluZyB6bm9kZSkgewogICAgICAgIGlmIChCb29rS2VlcGVy\nQ29uc3RhbnRzLkFWQUlMQUJMRV9OT0RFLmVxdWFscyh6bm9kZSkKICAgICAg\nICAgICAgICAgIHx8IEJvb2tLZWVwZXJDb25zdGFudHMuQ09PS0lFX05PREUu\nZXF1YWxzKHpub2RlKQogICAgICAgICAgICAgICAgfHwgQm9va0tlZXBlckNv\nbnN0YW50cy5MQVlPVVRfWk5PREUuZXF1YWxzKHpub2RlKQogICAgICAgICAg\nICAgICAgfHwgQm9va0tlZXBlckNvbnN0YW50cy5JTlNUQU5DRUlELmVxdWFs\ncyh6bm9kZSkKICAgICAgICAgICAgICAgIHx8IEJvb2tLZWVwZXJDb25zdGFu\ndHMuVU5ERVJfUkVQTElDQVRJT05fTk9ERS5lcXVhbHMoem5vZGUpKSB7CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb252ZXJ0IHRoZSBa\nSyByZXRyaWV2ZWQgbGVkZ2VyIG5vZGVzIHRvIGEgSGFzaFNldCBmb3IgZWFz\naWVyIGNvbXBhcmlzb25zLgogICAgICoKICAgICAqIEBwYXJhbSBsZWRnZXJO\nb2RlcwogICAgICogICAgICAgICAgemsgbGVkZ2VyIG5vZGVzCiAgICAgKiBA\ncGFyYW0gcGF0aAogICAgICogICAgICAgICAgdGhlIHByZWZpeCBwYXRoIG9m\nIHRoZSBsZWRnZXIgbm9kZXMKICAgICAqIEByZXR1cm4gbGVkZ2VyIGlkIGhh\nc2ggc2V0CiAgICAgKi8KICAgIHByb3RlY3RlZCBOYXZpZ2FibGVTZXQ8TG9u\nZz4gbGVkZ2VyTGlzdFRvU2V0KExpc3Q8U3RyaW5nPiBsZWRnZXJOb2Rlcywg\nU3RyaW5nIHBhdGgpIHsKICAgICAgICBOYXZpZ2FibGVTZXQ8TG9uZz4gemtB\nY3RpdmVMZWRnZXJzID0gbmV3IFRyZWVTZXQ8TG9uZz4oKTsKICAgICAgICBm\nb3IgKFN0cmluZyBsZWRnZXJOb2RlIDogbGVkZ2VyTm9kZXMpIHsKICAgICAg\nICAgICAgaWYgKGlzU3BlY2lhbFpub2RlKGxlZGdlck5vZGUpKSB7CiAgICAg\nICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgLy8gY29udmVydCB0aGUgbm9kZSBw\nYXRoIHRvIGxlZGdlciBpZCBhY2NvcmRpbmcgdG8gZGlmZmVyZW50IGxlZGdl\nciBtYW5hZ2VyIGltcGxlbWVudGF0aW9uCiAgICAgICAgICAgICAgICB6a0Fj\ndGl2ZUxlZGdlcnMuYWRkKGdldExlZGdlcklkKHBhdGggKyAiLyIgKyBsZWRn\nZXJOb2RlKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIExPRy53YXJuKCJFcnJvciBleHRyYWN0aW5n\nIGxlZGdlcklkIGZyb20gWksgbGVkZ2VyIG5vZGU6ICIgKyBsZWRnZXJOb2Rl\nKTsKICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgYSBwcmV0dHkgYmFkIGVy\ncm9yIGFzIGl0IGluZGljYXRlcyBhIGxlZGdlciBub2RlIGluIFpLCiAgICAg\nICAgICAgICAgICAvLyBoYXMgYW4gaW5jb3JyZWN0IGZvcm1hdC4gRm9yIG5v\ndyBqdXN0IGNvbnRpbnVlIGFuZCBjb25zaWRlcgogICAgICAgICAgICAgICAg\nLy8gdGhpcyBhcyBhIG5vbi1leGlzdGVudCBsZWRnZXIuCiAgICAgICAgICAg\nICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICByZXR1cm4gemtBY3RpdmVMZWRnZXJzOwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgc2NoZWR1bGVyLnNodXRkb3duKCk7CiAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLndhcm4oIkVycm9y\nIHdoZW4gY2xvc2luZyB6b29rZWVwZXIgYmFzZWQgbGVkZ2VyIG1hbmFnZXI6\nICIsIGUpOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

