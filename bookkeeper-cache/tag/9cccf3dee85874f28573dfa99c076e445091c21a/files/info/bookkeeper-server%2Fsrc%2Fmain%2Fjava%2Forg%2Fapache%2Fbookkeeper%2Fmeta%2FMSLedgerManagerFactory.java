{"sha":"5863619a976ed9014755f313eec55aff060803a9","node_id":"MDQ6QmxvYjE1NzU5NTY6NTg2MzYxOWE5NzZlZDkwMTQ3NTVmMzEzZWVjNTVhZmYwNjA4MDNhOQ==","size":32458,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/5863619a976ed9014755f313eec55aff060803a9","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YTsKCmltcG9ydCBzdGF0\naWMgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVU\nYWJsZS5BTExfRklFTERTOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlVGFibGUuTk9OX0ZJRUxEUzsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGls\nLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSXRlcmF0b3I7CmltcG9ydCBq\nYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLlNvcnRlZFNldDsKaW1w\nb3J0IGphdmEudXRpbC5UcmVlU2V0OwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5Db25jdXJyZW50TWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuRXhlY3V0b3JzOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkJLRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5MZWRnZXJNZXRhZGF0YTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jb25mLkFic3RyYWN0Q29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkFic3RyYWN0WmtMZWRn\nZXJNYW5hZ2VyLlJlYWRMZWRnZXJNZXRhZGF0YVRhc2s7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlLk1TRXhjZXB0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU1dhdGNoZWRF\ndmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhc3RvcmUu\nTWV0YVN0b3JlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFz\ndG9yZS5NZXRhc3RvcmVDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlQ3Vyc29yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVDdXJzb3Iu\nUmVhZEVudHJpZXNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlRXhjZXB0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVGYWN0b3J5\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRh\nc3RvcmVTY2FubmFibGVUYWJsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5tZXRhc3RvcmUuTWV0YXN0b3JlVGFibGVJdGVtOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NZXRhc3RvcmVXYXRjaGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU1dh\ndGNoZWRFdmVudC5FdmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubWV0YXN0b3JlLlZhbHVlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5HZW5l\ncmljQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkxlZGdlck1ldGFkYXRh\nTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8u\nQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLlByb2Nlc3NvcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlv\nbkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci51dGls\nLlN0cmluZ1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0\naWwuWmtVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJz\naW9uaW5nLlZlcnNpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ndmVyc2lvbmluZy5WZXJzaW9uZWQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tl\nZXBlci5Bc3luY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuQXN5bmNDYWxsYmFjay5TdHJpbmdDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5ab29EZWZzLklkczsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7Cmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBNZXRhU3Rv\ncmUgQmFzZWQgTGVkZ2VyIE1hbmFnZXIgRmFjdG9yeQogKi8KcHVibGljIGNs\nYXNzIE1TTGVkZ2VyTWFuYWdlckZhY3RvcnkgZXh0ZW5kcyBMZWRnZXJNYW5h\nZ2VyRmFjdG9yeSB7CgogICAgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihNU0xlZGdlck1hbmFnZXJGYWN0b3J5LmNsYXNz\nKTsKCiAgICBzdGF0aWMgaW50IE1TX0NPTk5FQ1RfQkFDS09GRl9NUyA9IDIw\nMDsKCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBDVVJfVkVSU0lPTiA9\nIDE7CgogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcgVEFCTEVfTkFN\nRSA9ICJMRURHRVIiOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBTdHJpbmcg\nTUVUQV9GSUVMRCA9ICIuTUVUQSI7CgogICAgQWJzdHJhY3RDb25maWd1cmF0\naW9uIGNvbmY7CiAgICBab29LZWVwZXIgems7CiAgICBNZXRhU3RvcmUgbWV0\nYXN0b3JlOwoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGludCBnZXRDdXJy\nZW50VmVyc2lvbigpIHsKICAgICAgICByZXR1cm4gQ1VSX1ZFUlNJT047CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgTGVkZ2VyTWFuYWdlckZh\nY3RvcnkgaW5pdGlhbGl6ZShmaW5hbCBBYnN0cmFjdENvbmZpZ3VyYXRpb24g\nY29uZiwgZmluYWwgWm9vS2VlcGVyIHprLAogICAgICAgICAgICBmaW5hbCBp\nbnQgZmFjdG9yeVZlcnNpb24pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKENVUl9WRVJTSU9OICE9IGZhY3RvcnlWZXJzaW9uKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiSW5jb21wYXRpYmxlIGxh\neW91dCB2ZXJzaW9uIGZvdW5kIDogIiArIGZhY3RvcnlWZXJzaW9uKTsKICAg\nICAgICB9CiAgICAgICAgdGhpcy5jb25mID0gY29uZjsKICAgICAgICB0aGlz\nLnprID0gems7CgogICAgICAgIC8vIGxvYWQgbWV0YWRhdGEgc3RvcmUKICAg\nICAgICBTdHJpbmcgbXNOYW1lID0gY29uZi5nZXRNZXRhc3RvcmVJbXBsQ2xh\nc3MoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBtZXRhc3RvcmUgPSBN\nZXRhc3RvcmVGYWN0b3J5LmNyZWF0ZU1ldGFTdG9yZShtc05hbWUpOwoKICAg\nICAgICAgICAgLy8gVE9ETzogc2hvdWxkIHJlY29yZCB2ZXJzaW9uIGluIHNv\nbWV3aGVyZS4gZS5nLiBab29LZWVwZXIKICAgICAgICAgICAgaW50IG1zVmVy\nc2lvbiA9IG1ldGFzdG9yZS5nZXRWZXJzaW9uKCk7CiAgICAgICAgICAgIG1l\ndGFzdG9yZS5pbml0KGNvbmYsIG1zVmVyc2lvbik7CiAgICAgICAgfSBjYXRj\naCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBtZXRhc3RvcmUgIiArIG1z\nTmFtZSArICIgOiAiLCB0KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0\naGlzOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdW5p\nbml0aWFsaXplKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBtZXRh\nc3RvcmUuY2xvc2UoKTsKICAgIH0KCiAgICBzdGF0aWMgTG9uZyBrZXkyTGVk\nZ2VySWQoU3RyaW5nIGtleSkgewogICAgICAgIHJldHVybiBudWxsID09IGtl\neSA/IG51bGwgOiBMb25nLnBhcnNlTG9uZyhrZXksIDEwKTsKICAgIH0KCiAg\nICBzdGF0aWMgU3RyaW5nIGxlZGdlcklkMktleShMb25nIGxpZCkgewogICAg\nICAgIHJldHVybiBudWxsID09IGxpZCA/IG51bGwgOiBTdHJpbmdVdGlscy5n\nZXRaS1N0cmluZ0lkKGxpZCk7CiAgICB9CgogICAgc3RhdGljIFN0cmluZyBy\nYW5nZVRvU3RyaW5nKExvbmcgZmlyc3RMZWRnZXIsIGJvb2xlYW4gZmlyc3RJ\nbmNsdXNpdmUsIExvbmcgbGFzdExlZGdlciwgYm9vbGVhbiBsYXN0SW5jbHVz\naXZlKSB7CiAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdC\ndWlsZGVyKCk7CiAgICAgICAgc2IuYXBwZW5kKGZpcnN0SW5jbHVzaXZlID8g\nIlsgIiA6ICIoICIpLmFwcGVuZChmaXJzdExlZGdlcikuYXBwZW5kKCIgfiAi\nKS5hcHBlbmQobGFzdExlZGdlcikKICAgICAgICAgICAgICAgIC5hcHBlbmQo\nbGFzdEluY2x1c2l2ZSA/ICIgXSIgOiAiICkiKTsKICAgICAgICByZXR1cm4g\nc2IudG9TdHJpbmcoKTsKICAgIH0KCiAgICBzdGF0aWMgU29ydGVkU2V0PExv\nbmc+IGVudHJpZXMyTGVkZ2VycyhJdGVyYXRvcjxNZXRhc3RvcmVUYWJsZUl0\nZW0+IGVudHJpZXMpIHsKICAgICAgICBTb3J0ZWRTZXQ8TG9uZz4gbGVkZ2Vy\ncyA9IG5ldyBUcmVlU2V0PExvbmc+KCk7CiAgICAgICAgd2hpbGUgKGVudHJp\nZXMuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIE1ldGFzdG9yZVRhYmxlSXRl\nbSBpdGVtID0gZW50cmllcy5uZXh0KCk7CiAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICBsZWRnZXJzLmFkZChrZXkyTGVkZ2VySWQoaXRlbS5n\nZXRLZXkoKSkpOwogICAgICAgICAgICB9IGNhdGNoIChOdW1iZXJGb3JtYXRF\neGNlcHRpb24gbmZlKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRm91\nbmQgaW52YWxpZCBsZWRnZXIga2V5IHt9IiwgaXRlbS5nZXRLZXkoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxlZGdlcnM7\nCiAgICB9CgogICAgc3RhdGljIGNsYXNzIFN5bmNSZXN1bHQ8VD4gewogICAg\nICAgIFQgdmFsdWU7CiAgICAgICAgaW50IHJjOwogICAgICAgIGJvb2xlYW4g\nZmluaXNoZWQgPSBmYWxzZTsKCiAgICAgICAgcHVibGljIHN5bmNocm9uaXpl\nZCB2b2lkIGNvbXBsZXRlKGludCByYywgVCB2YWx1ZSkgewogICAgICAgICAg\nICB0aGlzLnJjID0gcmM7CiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWx1\nZTsKICAgICAgICAgICAgZmluaXNoZWQgPSB0cnVlOwoKICAgICAgICAgICAg\nbm90aWZ5KCk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25p\nemVkIHZvaWQgYmxvY2soKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICB3aGlsZSAoIWZpbmlzaGVkKSB7CiAgICAgICAgICAgICAgICAg\nICAgd2FpdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIGludCBn\nZXRSZXRDb2RlKCkgewogICAgICAgICAgICByZXR1cm4gcmM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgc3luY2hyb25pemVkIFQgZ2V0UmVzdWx0KCkg\newogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgfQogICAgfQoK\nICAgIHN0YXRpYyBjbGFzcyBNc0xlZGdlck1hbmFnZXIgaW1wbGVtZW50cyBM\nZWRnZXJNYW5hZ2VyLCBNZXRhc3RvcmVXYXRjaGVyIHsKICAgICAgICBmaW5h\nbCBab29LZWVwZXIgems7CiAgICAgICAgZmluYWwgQWJzdHJhY3RDb25maWd1\ncmF0aW9uIGNvbmY7CgogICAgICAgIGZpbmFsIE1ldGFTdG9yZSBtZXRhc3Rv\ncmU7CiAgICAgICAgZmluYWwgTWV0YXN0b3JlU2Nhbm5hYmxlVGFibGUgbGVk\nZ2VyVGFibGU7CiAgICAgICAgZmluYWwgaW50IG1heEVudHJpZXNQZXJTY2Fu\nOwoKICAgICAgICBzdGF0aWMgZmluYWwgU3RyaW5nIElER0VOX1pOT0RFID0g\nIm1zLWlkZ2VuIjsKICAgICAgICBzdGF0aWMgZmluYWwgU3RyaW5nIElER0VO\nRVJBVElPTl9QUkVGSVggPSAiLyIgKyBJREdFTl9aTk9ERSArICIvSUQtIjsK\nCiAgICAgICAgLy8gbGVkZ2VyIG1ldGFkYXRhIGxpc3RlbmVycwogICAgICAg\nIHByb3RlY3RlZCBmaW5hbCBDb25jdXJyZW50TWFwPExvbmcsIFNldDxMZWRn\nZXJNZXRhZGF0YUxpc3RlbmVyPj4gbGlzdGVuZXJzID0KICAgICAgICAgICAg\nICAgIG5ldyBDb25jdXJyZW50SGFzaE1hcDxMb25nLCBTZXQ8TGVkZ2VyTWV0\nYWRhdGFMaXN0ZW5lcj4+KCk7CgogICAgICAgIC8vIFBhdGggdG8gZ2VuZXJh\ndGUgZ2xvYmFsIGlkCiAgICAgICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgaWRH\nZW5QYXRoOwoKICAgICAgICAvLyB3ZSB1c2UgdGhpcyB0byBwcmV2ZW50IGxv\nbmcgc3RhY2sgY2hhaW5zIGZyb20gYnVpbGRpbmcgdXAgaW4KICAgICAgICAv\nLyBjYWxsYmFja3MKICAgICAgICBTY2hlZHVsZWRFeGVjdXRvclNlcnZpY2Ug\nc2NoZWR1bGVyOwoKICAgICAgICBwcm90ZWN0ZWQgY2xhc3MgUmVhZExlZGdl\nck1ldGFkYXRhVGFzayBpbXBsZW1lbnRzIFJ1bm5hYmxlLCBHZW5lcmljQ2Fs\nbGJhY2s8TGVkZ2VyTWV0YWRhdGE+IHsKCiAgICAgICAgICAgIGZpbmFsIGxv\nbmcgbGVkZ2VySWQ7CgogICAgICAgICAgICBSZWFkTGVkZ2VyTWV0YWRhdGFU\nYXNrKGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICAgICAgICAgIHRoaXMubGVk\nZ2VySWQgPSBsZWRnZXJJZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAg\nICAgICAgICAgICAgIGlmIChudWxsICE9IGxpc3RlbmVycy5nZXQobGVkZ2Vy\nSWQpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJSZS1yZWFk\nIGxlZGdlciBtZXRhZGF0YSBmb3Ige30uIiwgbGVkZ2VySWQpOwogICAgICAg\nICAgICAgICAgICAgIHJlYWRMZWRnZXJNZXRhZGF0YShsZWRnZXJJZCwgUmVh\nZExlZGdlck1ldGFkYXRhVGFzay50aGlzKTsKICAgICAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJMZWRnZXIg\nbWV0YWRhdGEgbGlzdGVuZXIgZm9yIGxlZGdlciB7fSBpcyBhbHJlYWR5IHJl\nbW92ZWQuIiwgbGVkZ2VySWQpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoaW50IHJjLCBmaW5hbCBMZWRn\nZXJNZXRhZGF0YSByZXN1bHQpIHsKICAgICAgICAgICAgICAgIGlmIChCS0V4\nY2VwdGlvbi5Db2RlLk9LID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAg\nZmluYWwgU2V0PExlZGdlck1ldGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0\nID0gbGlzdGVuZXJzLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAg\nICAgaWYgKG51bGwgIT0gbGlzdGVuZXJTZXQpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgTE9HLmRlYnVnKCJMZWRnZXIgbWV0YWRhdGEgaXMgY2hhbmdl\nZCBmb3Ige30gOiB7fS4iLCBsZWRnZXJJZCwgcmVzdWx0KTsKICAgICAgICAg\nICAgICAgICAgICAgICAgc2NoZWR1bGVyLnN1Ym1pdChuZXcgUnVubmFibGUo\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQo\nbGlzdGVuZXJTZXQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmb3IgKExlZGdlck1ldGFkYXRhTGlzdGVuZXIgbGlzdGVuZXIgOiBs\naXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbGlzdGVuZXIub25DaGFuZ2VkKGxlZGdlcklkLCByZXN1bHQp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNoTGVkZ2VyRXhpc3RzRXhjZXB0aW9u\nID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhlIGxlZGdlciBp\ncyByZW1vdmVkLCBkbyBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgU2V0\nPExlZGdlck1ldGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0ID0gbGlzdGVu\nZXJzLnJlbW92ZShsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKG51bGwgIT0gbGlzdGVuZXJTZXQpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLmRlYnVnKCJSZW1vdmVkIGxlZGdlciBtZXRhZGF0YSBsaXN0ZW5l\nciBzZXQgb24gbGVkZ2VyIHt9IGFzIGl0cyBsZWRnZXIgaXMgZGVsZXRlZCA6\nIHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJ\nZCwgbGlzdGVuZXJTZXQuc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nIExPRy53YXJuKCJGYWlsZWQgb24gcmVhZCBsZWRnZXIgbWV0YWRhdGEgb2Yg\nbGVkZ2VyIHt9IDoge30iLCBsZWRnZXJJZCwgcmMpOwogICAgICAgICAgICAg\nICAgICAgIHNjaGVkdWxlci5zY2hlZHVsZSh0aGlzLCBNU19DT05ORUNUX0JB\nQ0tPRkZfTVMsIFRpbWVVbml0Lk1JTExJU0VDT05EUyk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIE1zTGVk\nZ2VyTWFuYWdlcihmaW5hbCBBYnN0cmFjdENvbmZpZ3VyYXRpb24gY29uZiwg\nZmluYWwgWm9vS2VlcGVyIHprLCBmaW5hbCBNZXRhU3RvcmUgbWV0YXN0b3Jl\nKSB7CiAgICAgICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAgICAgICAg\nIHRoaXMuemsgPSB6azsKICAgICAgICAgICAgdGhpcy5tZXRhc3RvcmUgPSBt\nZXRhc3RvcmU7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nbGVkZ2VyVGFibGUgPSBtZXRhc3RvcmUuY3JlYXRlU2Nhbm5hYmxlVGFibGUo\nVEFCTEVfTkFNRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKE1ldGFzdG9yZUV4\nY2VwdGlvbiBtc2UpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRmFp\nbGVkIHRvIGluc3RhbnRpYXRlIHRhYmxlICIgKyBUQUJMRV9OQU1FICsgIiBp\nbiBtZXRhc3RvcmUgIiArIG1ldGFzdG9yZS5nZXROYW1lKCkpOwogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oIkZhaWxlZCB0\nbyBpbnN0YW50aWF0ZSB0YWJsZSAiICsgVEFCTEVfTkFNRSArICIgaW4gbWV0\nYXN0b3JlICIKICAgICAgICAgICAgICAgICAgICAgICAgKyBtZXRhc3RvcmUu\nZ2V0TmFtZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBjb25m\naWd1cmF0aW9uIHNldHRpbmdzCiAgICAgICAgICAgIG1heEVudHJpZXNQZXJT\nY2FuID0gY29uZi5nZXRNZXRhc3RvcmVNYXhFbnRyaWVzUGVyU2NhbigpOwoK\nICAgICAgICAgICAgdGhpcy5pZEdlblBhdGggPSBjb25mLmdldFprTGVkZ2Vy\nc1Jvb3RQYXRoKCkgKyBJREdFTkVSQVRJT05fUFJFRklYOwogICAgICAgICAg\nICB0aGlzLnNjaGVkdWxlciA9IEV4ZWN1dG9ycy5uZXdTaW5nbGVUaHJlYWRT\nY2hlZHVsZWRFeGVjdXRvcigpOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhNU1dhdGNoZWRFdmVu\ndCBlKXsKICAgICAgICAgICAgbG9uZyBsZWRnZXJJZCA9IGtleTJMZWRnZXJJ\nZChlLmdldEtleSgpKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHN3aXRj\naChlLmdldFR5cGUoKSkgewogICAgICAgICAgICBjYXNlIENIQU5HRUQ6CiAg\nICAgICAgICAgICAgICBuZXcgUmVhZExlZGdlck1ldGFkYXRhVGFzayhrZXky\nTGVkZ2VySWQoZS5nZXRLZXkoKSkpLnJ1bigpOwoKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICBjYXNlIFJFTU9WRUQ6CiAgICAgICAgICAg\nICAgICBTZXQ8TGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcj4gbGlzdGVuZXJTZXQg\nPSBsaXN0ZW5lcnMuZ2V0KGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIGlm\nIChsaXN0ZW5lclNldCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nc3luY2hyb25pemVkIChsaXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBmb3IoTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lciBsIDogbGlzdGVu\nZXJTZXQpewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5yZWdpc3Rl\nckxlZGdlck1ldGFkYXRhTGlzdGVuZXIobGVkZ2VySWQsIGwpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbC5vbkNoYW5nZWQoIGxlZGdlcklkLCBu\ndWxsICk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAg\nYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBM\nT0cud2FybigiVW5rbm93biB0eXBlOiB7fSIsIGUuZ2V0VHlwZSgpKTsKICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIAogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIHJlZ2lzdGVyTGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcihsb25nIGxlZGdlcklk\nLCBMZWRnZXJNZXRhZGF0YUxpc3RlbmVyIGxpc3RlbmVyKSB7CiAgICAgICAg\nICAgIGlmIChudWxsICE9IGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiUmVnaXN0ZXJlZCBsZWRnZXIgbWV0YWRhdGEgbGlzdGVuZXIg\ne30gb24gbGVkZ2VyIHt9LiIsIGxpc3RlbmVyLCBsZWRnZXJJZCk7CiAgICAg\nICAgICAgICAgICBTZXQ8TGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcj4gbGlzdGVu\nZXJTZXQgPSBsaXN0ZW5lcnMuZ2V0KGxlZGdlcklkKTsKICAgICAgICAgICAg\nICAgIGlmIChsaXN0ZW5lclNldCA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICAgICAgU2V0PExlZGdlck1ldGFkYXRhTGlzdGVuZXI+IG5ld0xpc3RlbmVy\nU2V0ID0gbmV3IEhhc2hTZXQ8TGVkZ2VyTWV0YWRhdGFMaXN0ZW5lcj4oKTsK\nICAgICAgICAgICAgICAgICAgICBTZXQ8TGVkZ2VyTWV0YWRhdGFMaXN0ZW5l\ncj4gb2xkTGlzdGVuZXJTZXQgPSBsaXN0ZW5lcnMucHV0SWZBYnNlbnQobGVk\nZ2VySWQsIG5ld0xpc3RlbmVyU2V0KTsKICAgICAgICAgICAgICAgICAgICBp\nZiAobnVsbCAhPSBvbGRMaXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAg\nICAgICAgICBsaXN0ZW5lclNldCA9IG9sZExpc3RlbmVyU2V0OwogICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGxpc3RlbmVyU2V0ID0gbmV3TGlzdGVuZXJTZXQ7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3lu\nY2hyb25pemVkIChsaXN0ZW5lclNldCkgewogICAgICAgICAgICAgICAgICAg\nIGxpc3RlbmVyU2V0LmFkZChsaXN0ZW5lcik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBuZXcgUmVhZExlZGdlck1ldGFkYXRhVGFzayhs\nZWRnZXJJZCkucnVuKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHVucmVnaXN0ZXJM\nZWRnZXJNZXRhZGF0YUxpc3RlbmVyKGxvbmcgbGVkZ2VySWQsIExlZGdlck1l\ndGFkYXRhTGlzdGVuZXIgbGlzdGVuZXIpIHsKICAgICAgICAgICAgU2V0PExl\nZGdlck1ldGFkYXRhTGlzdGVuZXI+IGxpc3RlbmVyU2V0ID0gbGlzdGVuZXJz\nLmdldChsZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChsaXN0ZW5lclNldCAh\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKGxpc3Rl\nbmVyU2V0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3RlbmVyU2V0\nLnJlbW92ZShsaXN0ZW5lcikpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLmluZm8oIlVucmVnaXN0ZXJlZCBsZWRnZXIgbWV0YWRhdGEgbGlzdGVu\nZXIge30gb24gbGVkZ2VyIHt9LiIsIGxpc3RlbmVyLCBsZWRnZXJJZCk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGlmIChs\naXN0ZW5lclNldC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgbGlzdGVuZXJzLnJlbW92ZShsZWRnZXJJZCwgbGlzdGVuZXJTZXQpOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBzY2hlZHVsZXIuc2h1dGRvd24oKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIExPRy53\nYXJuKCJFcnJvciB3aGVuIGNsb3NpbmcgTXNMZWRnZXJNYW5hZ2VyIDogIiwg\nZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGVkZ2VyVGFibGUuY2xv\nc2UoKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyB2b2lkIGNyZWF0ZUxlZGdlcihmaW5hbCBMZWRnZXJNZXRhZGF0YSBt\nZXRhZGF0YSwgZmluYWwgR2VuZXJpY0NhbGxiYWNrPExvbmc+IGxlZGdlckNi\nKSB7CiAgICAgICAgICAgIFprVXRpbHMuYXN5bmNDcmVhdGVGdWxsUGF0aE9w\ndGltaXN0aWMoemssIGlkR2VuUGF0aCwgbmV3IGJ5dGVbMF0sIElkcy5PUEVO\nX0FDTF9VTlNBRkUsCiAgICAgICAgICAgICAgICAgICAgQ3JlYXRlTW9kZS5F\nUEhFTUVSQUxfU0VRVUVOVElBTCwgbmV3IFN0cmluZ0NhbGxiYWNrKCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMs\nIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBmaW5hbCBTdHJpbmcgaWRQYXRo\nTmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9\nIEtlZXBlckV4Y2VwdGlvbi5Db2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5v\ndCBnZW5lcmF0ZSBuZXcgbGVkZ2VyIGlkIiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUo\nS2VlcGVyRXhjZXB0aW9uLkNvZGUuZ2V0KHJjKSwgcGF0aCkpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckNiLm9wZXJhdGlvbkNv\nbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuWktFeGNlcHRpb24sIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBFeHRy\nYWN0IGxlZGdlciBpZCBmcm9tIGdlbiBwYXRoCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxv\nbmcgbGVkZ2VySWQ7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlcklkID0g\nZ2V0TGVkZ2VySWRGcm9tR2VuUGF0aChpZFBhdGhOYW1lKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNv\ndWxkIG5vdCBleHRyYWN0IGxlZGdlci1pZCBmcm9tIGlkIGdlbiBwYXRoOiIg\nKyBwYXRoLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\nZWRnZXJDYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLlpL\nRXhjZXB0aW9uLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgbG9uZyBsaWQgPSBs\nZWRnZXJJZDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1ldGFzdG9y\nZUNhbGxiYWNrPFZlcnNpb24+IG1zQ2FsbGJhY2sgPSBuZXcgTWV0YXN0b3Jl\nQ2FsbGJhY2s8VmVyc2lvbj4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgY29tcGxldGUoaW50IHJjLCBWZXJzaW9uIHZl\ncnNpb24sIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKE1TRXhjZXB0aW9uLkNvZGUuQmFkVmVyc2lvbi5n\nZXRDb2RlKCkgPT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGxlZGdlckNiLm9wZXJhdGlvbkNvbXBsZXRlKEJLRXhj\nZXB0aW9uLkNvZGUuTWV0YWRhdGFWZXJzaW9uRXhjZXB0aW9uLCBudWxsKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoTVNFeGNlcHRp\nb24uQ29kZS5PSy5nZXRDb2RlKCkgIT0gcmMpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckNiLm9wZXJhdGlvbkNv\nbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuTWV0YVN0b3JlRXhjZXB0aW9uLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZGVi\ndWcoIkNyZWF0ZSBsZWRnZXIge30gd2l0aCB2ZXJzaW9uIHt9IHN1Y2Nlc3Nm\ndWx5LiIsIG5ldyBPYmplY3RbXSB7IGxpZCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uIH0pOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgdmVyc2lv\nbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhZGF0\nYS5zZXRWZXJzaW9uKHZlcnNpb24pOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsZWRnZXJDYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4\nY2VwdGlvbi5Db2RlLk9LLCBsaWQpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07Cgog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyVGFibGUucHV0KGxl\nZGdlcklkMktleShsaWQpLCBuZXcgVmFsdWUoKS5zZXRGaWVsZChNRVRBX0ZJ\nRUxELCBtZXRhZGF0YS5zZXJpYWxpemUoKSksCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIFZlcnNpb24uTkVXLCBtc0NhbGxiYWNrLCBu\ndWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHprLmRlbGV0ZShp\nZFBhdGhOYW1lLCAtMSwgbmV3IEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNr\nKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0\neCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAo\ncmMgIT0gS2VlcGVyRXhjZXB0aW9uLkNvZGUuT0suaW50VmFsdWUoKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndh\ncm4oIkV4Y2VwdGlvbiBkdXJpbmcgZGVsZXRpbmcgem5vZGUgZm9yIGlkIGdl\nbmVyYXRpb24gOiAiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBLZWVwZXJFeGNlcHRpb24uY3JlYXRlKEtlZXBl\nckV4Y2VwdGlvbi5Db2RlLmdldChyYyksIHBhdGgpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRGVsZXRp\nbmcgem5vZGUgZm9yIGlkIGdlbmVyYXRpb24gOiB7fSIsIGlkUGF0aE5hbWUp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfSwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICB9Cgog\nICAgICAgIC8vIGdldCBsZWRnZXIgaWQgZnJvbSBnZW5lcmF0aW9uIHBhdGgK\nICAgICAgICBwcml2YXRlIGxvbmcgZ2V0TGVkZ2VySWRGcm9tR2VuUGF0aChT\ndHJpbmcgbm9kZU5hbWUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\nICAgIGxvbmcgbGVkZ2VySWQ7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBTdHJpbmcgcGFydHNbXSA9IG5vZGVOYW1lLnNwbGl0KElER0VO\nRVJBVElPTl9QUkVGSVgpOwogICAgICAgICAgICAgICAgbGVkZ2VySWQgPSBM\nb25nLnBhcnNlTG9uZyhwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXSk7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oZSk7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGxlZGdlcklkOwogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcmVt\nb3ZlTGVkZ2VyTWV0YWRhdGEoZmluYWwgbG9uZyBsZWRnZXJJZCwgZmluYWwg\nVmVyc2lvbiB2ZXJzaW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGZpbmFsIEdlbmVyaWNDYWxsYmFjazxWb2lkPiBjYikg\newogICAgICAgICAgICBNZXRhc3RvcmVDYWxsYmFjazxWb2lkPiBtc0NhbGxi\nYWNrID0gbmV3IE1ldGFzdG9yZUNhbGxiYWNrPFZvaWQ+KCkgewogICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBjb21wbGV0ZShpbnQgcmMsIFZvaWQgdmFsdWUsIE9iamVjdCBjdHgpIHsK\nICAgICAgICAgICAgICAgICAgICBpbnQgYmtSYzsKICAgICAgICAgICAgICAg\nICAgICBpZiAoTVNFeGNlcHRpb24uQ29kZS5Ob0tleS5nZXRDb2RlKCkgPT0g\ncmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkxlZGdl\nciBlbnRyeSBkb2VzIG5vdCBleGlzdCBpbiBtZXRhIHRhYmxlOiBsZWRnZXJJ\nZD17fSIsIGxlZGdlcklkKTsKICAgICAgICAgICAgICAgICAgICAgICAgYmtS\nYyA9IEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNoTGVkZ2VyRXhpc3RzRXhjZXB0\naW9uOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoTVNFeGNlcHRp\nb24uQ29kZS5PSy5nZXRDb2RlKCkgPT0gcmMpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgYmtSYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7CiAgICAgICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nYmtSYyA9IEJLRXhjZXB0aW9uLkNvZGUuTWV0YVN0b3JlRXhjZXB0aW9uOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjYi5v\ncGVyYXRpb25Db21wbGV0ZShia1JjLCAoVm9pZCkgbnVsbCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGxlZGdlclRh\nYmxlLnJlbW92ZShsZWRnZXJJZDJLZXkobGVkZ2VySWQpLCB2ZXJzaW9uLCBt\nc0NhbGxiYWNrLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHJlYWRMZWRnZXJNZXRhZGF0YShmaW5h\nbCBsb25nIGxlZGdlcklkLCBmaW5hbCBHZW5lcmljQ2FsbGJhY2s8TGVkZ2Vy\nTWV0YWRhdGE+IHJlYWRDYikgewogICAgICAgICAgICBmaW5hbCBTdHJpbmcg\na2V5ID0gbGVkZ2VySWQyS2V5KGxlZGdlcklkKTsKICAgICAgICAgICAgTWV0\nYXN0b3JlQ2FsbGJhY2s8VmVyc2lvbmVkPFZhbHVlPj4gbXNDYWxsYmFjayA9\nIG5ldyBNZXRhc3RvcmVDYWxsYmFjazxWZXJzaW9uZWQ8VmFsdWU+PigpIHsK\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgY29tcGxldGUoaW50IHJjLCBWZXJzaW9uZWQ8VmFsdWU+IHZh\nbHVlLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKE1T\nRXhjZXB0aW9uLkNvZGUuTm9LZXkuZ2V0Q29kZSgpID09IHJjKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiTm8gbGVkZ2VyIG1ldGFk\nYXRhIGZvdW5kIGZvciBsZWRnZXIgIiArIGxlZGdlcklkICsgIiA6ICIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTVNFeGNlcHRpb24uY3Jl\nYXRlKE1TRXhjZXB0aW9uLkNvZGUuZ2V0KHJjKSwgIk5vIGtleSAiICsga2V5\nICsgIiBmb3VuZC4iKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRD\nYi5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk5vU3VjaExl\nZGdlckV4aXN0c0V4Y2VwdGlvbiwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgaWYgKE1TRXhjZXB0aW9uLkNvZGUuT0suZ2V0Q29kZSgp\nICE9IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigi\nQ291bGQgbm90IHJlYWQgbWV0YWRhdGEgZm9yIGxlZGdlciAiICsgbGVkZ2Vy\nSWQgKyAiIDogIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBN\nU0V4Y2VwdGlvbi5jcmVhdGUoTVNFeGNlcHRpb24uQ29kZS5nZXQocmMpLCAi\nRmFpbGVkIHRvIGdldCBrZXkgIiArIGtleSkpOwogICAgICAgICAgICAgICAg\nICAgICAgICByZWFkQ2Iub3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24u\nQ29kZS5NZXRhU3RvcmVFeGNlcHRpb24sIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIExlZGdlck1ldGFkYXRhIG1ldGFkYXRhOwogICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIG1ldGFkYXRhID0gTGVkZ2VyTWV0YWRhdGEKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAucGFyc2VDb25maWcodmFsdWUuZ2V0VmFsdWUoKS5n\nZXRGaWVsZChNRVRBX0ZJRUxEKSwgdmFsdWUuZ2V0VmVyc2lvbigpKTsKICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ291bGQgbm90IHBh\ncnNlIGxlZGdlciBtZXRhZGF0YSBmb3IgbGVkZ2VyICIgKyBsZWRnZXJJZCAr\nICIgOiAiLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZENiLm9w\nZXJhdGlvbkNvbXBsZXRlKEJLRXhjZXB0aW9uLkNvZGUuTWV0YVN0b3JlRXhj\nZXB0aW9uLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBy\nZWFkQ2Iub3BlcmF0aW9uQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5PSywg\nbWV0YWRhdGEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9Owog\nICAgICAgICAgICBsZWRnZXJUYWJsZS5nZXQoa2V5LCB0aGlzLCBtc0NhbGxi\nYWNrLCBBTExfRklFTERTKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHdyaXRlTGVkZ2VyTWV0YWRhdGEoZmlu\nYWwgbG9uZyBsZWRnZXJJZCwgZmluYWwgTGVkZ2VyTWV0YWRhdGEgbWV0YWRh\ndGEsCiAgICAgICAgICAgICAgICBmaW5hbCBHZW5lcmljQ2FsbGJhY2s8Vm9p\nZD4gY2IpIHsKICAgICAgICAgICAgVmFsdWUgZGF0YSA9IG5ldyBWYWx1ZSgp\nLnNldEZpZWxkKE1FVEFfRklFTEQsIG1ldGFkYXRhLnNlcmlhbGl6ZSgpKTsK\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiV3JpdGluZyBsZWRnZXIge30gbWV0\nYWRhdGEsIHZlcnNpb24ge30iLCBuZXcgT2JqZWN0W10geyBsZWRnZXJJZCwg\nbWV0YWRhdGEuZ2V0VmVyc2lvbigpIH0pOwoKICAgICAgICAgICAgZmluYWwg\nU3RyaW5nIGtleSA9IGxlZGdlcklkMktleShsZWRnZXJJZCk7CiAgICAgICAg\nICAgIE1ldGFzdG9yZUNhbGxiYWNrPFZlcnNpb24+IG1zQ2FsbGJhY2sgPSBu\nZXcgTWV0YXN0b3JlQ2FsbGJhY2s8VmVyc2lvbj4oKSB7CiAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNv\nbXBsZXRlKGludCByYywgVmVyc2lvbiB2ZXJzaW9uLCBPYmplY3QgY3R4KSB7\nCiAgICAgICAgICAgICAgICAgICAgaW50IGJrUmM7CiAgICAgICAgICAgICAg\nICAgICAgaWYgKE1TRXhjZXB0aW9uLkNvZGUuQmFkVmVyc2lvbi5nZXRDb2Rl\nKCkgPT0gcmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8o\nIkJhZCB2ZXJzaW9uIHByb3ZpZGVkIHRvIHVwZGF0IG1ldGFkYXRhIGZvciBs\nZWRnZXIge30iLCBsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGJrUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk1ldGFkYXRhVmVyc2lvbkV4Y2Vw\ndGlvbjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKE1TRXhjZXB0\naW9uLkNvZGUuTm9LZXkuZ2V0Q29kZSgpID09IHJjKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIExPRy53YXJuKCJMZWRnZXIge30gZG9lc24ndCBleGlz\ndCB3aGVuIHdyaXRpbmcgaXRzIGxlZGdlciBtZXRhZGF0YS4iLCBsZWRnZXJJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJrUmMgPSBCS0V4Y2VwdGlv\nbi5Db2RlLk5vU3VjaExlZGdlckV4aXN0c0V4Y2VwdGlvbjsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKE1TRXhjZXB0aW9uLkNvZGUuT0suZ2V0\nQ29kZSgpID09IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFk\nYXRhLnNldFZlcnNpb24odmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJrUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgICAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy53\nYXJuKCJDb25kaXRpb25hbCB1cGRhdGUgbGVkZ2VyIG1ldGFkYXRhIGZhaWxl\nZDogIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNU0V4Y2Vw\ndGlvbi5jcmVhdGUoTVNFeGNlcHRpb24uQ29kZS5nZXQocmMpLCAiRmFpbGVk\nIHRvIHB1dCBrZXkgIiArIGtleSkpOwogICAgICAgICAgICAgICAgICAgICAg\nICBia1JjID0gQktFeGNlcHRpb24uQ29kZS5NZXRhU3RvcmVFeGNlcHRpb247\nCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBj\nYi5vcGVyYXRpb25Db21wbGV0ZShia1JjLCBudWxsKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgbGVkZ2VyVGFibGUu\ncHV0KGtleSwgZGF0YSwgbWV0YWRhdGEuZ2V0VmVyc2lvbigpLCBtc0NhbGxi\nYWNrLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyB2b2lkIGFzeW5jUHJvY2Vzc0xlZGdlcnMoZmluYWwgUHJv\nY2Vzc29yPExvbmc+IHByb2Nlc3NvciwgZmluYWwgQXN5bmNDYWxsYmFjay5W\nb2lkQ2FsbGJhY2sgZmluYWxDYiwKICAgICAgICAgICAgICAgIGZpbmFsIE9i\namVjdCBjb250ZXh0LCBmaW5hbCBpbnQgc3VjY2Vzc1JjLCBmaW5hbCBpbnQg\nZmFpbHVyZVJjKSB7CiAgICAgICAgICAgIE1ldGFzdG9yZUNhbGxiYWNrPE1l\ndGFzdG9yZUN1cnNvcj4gb3BlbkN1cnNvckNiID0gbmV3IE1ldGFzdG9yZUNh\nbGxiYWNrPE1ldGFzdG9yZUN1cnNvcj4oKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGNvbXBsZXRl\nKGludCByYywgTWV0YXN0b3JlQ3Vyc29yIGN1cnNvciwgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICAgICAgICAgIGlmIChNU0V4Y2VwdGlvbi5Db2RlLk9L\nLmdldENvZGUoKSAhPSByYykgewogICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbENiLnByb2Nlc3NSZXN1bHQoZmFpbHVyZVJjLCBudWxsLCBjb250ZXh0\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoIWN1cnNvci5o\nYXNNb3JlRW50cmllcygpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZp\nbmFsQ2IucHJvY2Vzc1Jlc3VsdChzdWNjZXNzUmMsIG51bGwsIGNvbnRleHQp\nOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGFzeW5jUHJvY2Vzc0xl\nZGdlcnMoY3Vyc29yLCBwcm9jZXNzb3IsIGZpbmFsQ2IsIGNvbnRleHQsIHN1\nY2Nlc3NSYywgZmFpbHVyZVJjKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfTsKICAgICAgICAgICAgbGVkZ2VyVGFibGUub3BlbkN1cnNvcihO\nT05fRklFTERTLCBvcGVuQ3Vyc29yQ2IsIG51bGwpOwogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBhc3luY1Byb2Nlc3NMZWRnZXJzKGZpbmFsIE1ldGFzdG9y\nZUN1cnNvciBjdXJzb3IsIGZpbmFsIFByb2Nlc3NvcjxMb25nPiBwcm9jZXNz\nb3IsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIEFz\neW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrIGZpbmFsQ2IsIGZpbmFsIE9iamVj\ndCBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbCBpbnQgc3VjY2Vzc1JjLCBmaW5hbCBpbnQgZmFpbHVyZVJjKSB7CiAg\nICAgICAgICAgIHNjaGVkdWxlci5zdWJtaXQobmV3IFJ1bm5hYmxlKCkgewog\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgZG9Bc3luY1By\nb2Nlc3NMZWRnZXJzKGN1cnNvciwgcHJvY2Vzc29yLCBmaW5hbENiLCBjb250\nZXh0LCBzdWNjZXNzUmMsIGZhaWx1cmVSYyk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBkb0Fz\neW5jUHJvY2Vzc0xlZGdlcnMoZmluYWwgTWV0YXN0b3JlQ3Vyc29yIGN1cnNv\nciwgZmluYWwgUHJvY2Vzc29yPExvbmc+IHByb2Nlc3NvciwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBBc3luY0NhbGxiYWNr\nLlZvaWRDYWxsYmFjayBmaW5hbENiLCBmaW5hbCBPYmplY3QgY29udGV4dCwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBpbnQg\nc3VjY2Vzc1JjLCBmaW5hbCBpbnQgZmFpbHVyZVJjKSB7CiAgICAgICAgICAg\nIC8vIG5vIGVudHJpZXMgbm93CiAgICAgICAgICAgIGlmICghY3Vyc29yLmhh\nc01vcmVFbnRyaWVzKCkpIHsKICAgICAgICAgICAgICAgIGZpbmFsQ2IucHJv\nY2Vzc1Jlc3VsdChzdWNjZXNzUmMsIG51bGwsIGNvbnRleHQpOwogICAgICAg\nICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFJl\nYWRFbnRyaWVzQ2FsbGJhY2sgbXNDYWxsYmFjayA9IG5ldyBSZWFkRW50cmll\nc0NhbGxiYWNrKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBjb21wbGV0ZShpbnQgcmMsIEl0ZXJh\ndG9yPE1ldGFzdG9yZVRhYmxlSXRlbT4gZW50cmllcywgT2JqZWN0IGN0eCkg\newogICAgICAgICAgICAgICAgICAgIGlmIChNU0V4Y2VwdGlvbi5Db2RlLk9L\nLmdldENvZGUoKSAhPSByYykgewogICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbENiLnByb2Nlc3NSZXN1bHQoZmFpbHVyZVJjLCBudWxsLCBjb250ZXh0\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgU29ydGVkU2V0PExv\nbmc+IGxlZGdlcnMgPSBuZXcgVHJlZVNldDxMb25nPigpOwogICAgICAgICAg\nICAgICAgICAgIHdoaWxlIChlbnRyaWVzLmhhc05leHQoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBNZXRhc3RvcmVUYWJsZUl0ZW0gaXRlbSA9IGVu\ndHJpZXMubmV4dCgpOwogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2Vycy5hZGQoa2V5Mkxl\nZGdlcklkKGl0ZW0uZ2V0S2V5KCkpKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfSBjYXRjaCAoTnVtYmVyRm9ybWF0RXhjZXB0aW9uIG5mZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIkZvdW5kIGludmFs\naWQgbGVkZ2VyIGtleSB7fSIsIGl0ZW0uZ2V0S2V5KCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgICAgICBpZiAoMCA9PSBsZWRnZXJzLnNpemUoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAvLyBwcm9jZXNzIG5leHQgYmF0Y2ggb2Yg\nbGVkZ2VycwogICAgICAgICAgICAgICAgICAgICAgICBhc3luY1Byb2Nlc3NM\nZWRnZXJzKGN1cnNvciwgcHJvY2Vzc29yLCBmaW5hbENiLCBjb250ZXh0LCBz\ndWNjZXNzUmMsIGZhaWx1cmVSYyk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgICAgIGZpbmFsIGxvbmcgc3RhcnRMZWRnZXIgPSBsZWRnZXJzLmZpcnN0\nKCk7CiAgICAgICAgICAgICAgICAgICAgZmluYWwgbG9uZyBlbmRMZWRnZXIg\nPSBsZWRnZXJzLmxhc3QoKTsKCiAgICAgICAgICAgICAgICAgICAgQXN5bmNT\nZXRQcm9jZXNzb3I8TG9uZz4gc2V0UHJvY2Vzc29yID0gbmV3IEFzeW5jU2V0\nUHJvY2Vzc29yPExvbmc+KHNjaGVkdWxlcik7CiAgICAgICAgICAgICAgICAg\nICAgLy8gcHJvY2VzcyBzZXQKICAgICAgICAgICAgICAgICAgICBzZXRQcm9j\nZXNzb3IucHJvY2VzcyhsZWRnZXJzLCBwcm9jZXNzb3IsIG5ldyBBc3luY0Nh\nbGxiYWNrLlZvaWRDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0\nIGN0eCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Y2Nl\nc3NSYyAhPSByYykgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRmFpbGVkIHdoZW4gcHJvY2Vzc2luZyByYW5nZSAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHJhbmdl\nVG9TdHJpbmcoc3RhcnRMZWRnZXIsIHRydWUsIGVuZExlZGdlciwgdHJ1ZSkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsQ2IucHJv\nY2Vzc1Jlc3VsdChmYWlsdXJlUmMsIG51bGwsIGNvbnRleHQpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIHByb2Nlc3MgbmV4dCBiYXRjaCBvZiBsZWRnZXJzCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBhc3luY1Byb2Nlc3NMZWRnZXJzKGN1cnNvciwg\ncHJvY2Vzc29yLCBmaW5hbENiLCBjb250ZXh0LCBzdWNjZXNzUmMsIGZhaWx1\ncmVSYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9LCBjb250ZXh0LCBzdWNjZXNzUmMsIGZhaWx1cmVSYyk7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGN1\ncnNvci5hc3luY1JlYWRFbnRyaWVzKG1heEVudHJpZXNQZXJTY2FuLCBtc0Nh\nbGxiYWNrLCBudWxsKTsKICAgICAgICB9CgogICAgICAgIGNsYXNzIE1TTGVk\nZ2VyUmFuZ2VJdGVyYXRvciBpbXBsZW1lbnRzIExlZGdlclJhbmdlSXRlcmF0\nb3IgewogICAgICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBvcGVuQ3Vy\nc29yTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgICAg\nIE1ldGFzdG9yZUN1cnNvciBjdXJzb3IgPSBudWxsOwogICAgICAgICAgICAv\nLyBsYXN0IGxlZGdlciBpZCBpbiBwcmV2aW91cyByYW5nZQoKICAgICAgICAg\nICAgTVNMZWRnZXJSYW5nZUl0ZXJhdG9yKCkgewogICAgICAgICAgICAgICAg\nTWV0YXN0b3JlQ2FsbGJhY2s8TWV0YXN0b3JlQ3Vyc29yPiBvcGVuQ3Vyc29y\nQ2IgPSBuZXcgTWV0YXN0b3JlQ2FsbGJhY2s8TWV0YXN0b3JlQ3Vyc29yPigp\nIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBjb21wbGV0ZShpbnQgcmMsIE1ldGFzdG9y\nZUN1cnNvciBuZXdDdXJzb3IsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKE1TRXhjZXB0aW9uLkNvZGUuT0suZ2V0Q29kZSgp\nICE9IHJjKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkVycm9yIG9wZW5pbmcgY3Vyc29yIGZvciBsZWRnZXIgcmFuZ2UgaXRl\ncmF0b3Ige30iLCByYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJzb3IgPSBuZXdD\ndXJzb3I7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAgICAgb3BlbkN1cnNvckxhdGNoLmNvdW50RG93bigpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAg\nICAgICAgICBsZWRnZXJUYWJsZS5vcGVuQ3Vyc29yKE5PTl9GSUVMRFMsIG9w\nZW5DdXJzb3JDYiwgbnVsbCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNOZXh0\nKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgb3BlbkN1cnNvckxhdGNoLmF3YWl0KCk7\nCiAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiBpZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJy\ndXB0ZWQgd2FpdGluZyBmb3IgY3Vyc29yIHRvIG9wZW4iLCBpZSk7CiAgICAg\nICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1\ncHQoKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRp\nb24oIkludGVycnVwdGVkIHdhaXRpbmcgdG8gcmVhZCByYW5nZSIsIGllKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChjdXJzb3Ig\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbigiRmFpbGVkIHRvIG9wZW4gbGVkZ2VyIHJhbmdlIGN1cnNvciwg\nY2hlY2sgbG9ncyIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgcmV0dXJuIGN1cnNvci5oYXNNb3JlRW50cmllcygpOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGlj\nIExlZGdlclJhbmdlIG5leHQoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBTb3J0ZWRT\nZXQ8TG9uZz4gbGVkZ2VySWRzID0gbmV3IFRyZWVTZXQ8TG9uZz4oKTsKICAg\nICAgICAgICAgICAgICAgICBJdGVyYXRvcjxNZXRhc3RvcmVUYWJsZUl0ZW0+\nIGl0ZXIgPSBjdXJzb3IucmVhZEVudHJpZXMobWF4RW50cmllc1BlclNjYW4p\nOwogICAgICAgICAgICAgICAgICAgIHdoaWxlIChpdGVyLmhhc05leHQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBsZWRnZXJJZHMuYWRkKGtleTJM\nZWRnZXJJZChpdGVyLm5leHQoKS5nZXRLZXkoKSkpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExlZGdl\nclJhbmdlKGxlZGdlcklkcyk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChN\nU0V4Y2VwdGlvbiBtc2UpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkV4Y2VwdGlvbiBvY2N1cnJlZCByZWFkaW5nIGZyb20gbWV0YXN0b3Jl\nIiwgbXNlKTsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNl\ncHRpb24oIkNvdWxkbid0IHJlYWQgZnJvbSBtZXRhc3RvcmUiLCBtc2UpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgTGVkZ2VyUmFuZ2VJdGVy\nYXRvciBnZXRMZWRnZXJSYW5nZXMoKSB7CiAgICAgICAgICAgIHJldHVybiBu\nZXcgTVNMZWRnZXJSYW5nZUl0ZXJhdG9yKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIEBPdmVycmlkZQogICAgcHVibGljIExlZGdlck1hbmFnZXIgbmV3TGVk\nZ2VyTWFuYWdlcigpIHsKICAgICAgICByZXR1cm4gbmV3IE1zTGVkZ2VyTWFu\nYWdlcihjb25mLCB6aywgbWV0YXN0b3JlKTsKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBu\nZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpIHRocm93cyBLZWVw\nZXJFeGNlcHRpb24sCiAgICAgICAgICAgIEludGVycnVwdGVkRXhjZXB0aW9u\nLCBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5Db21wYXRpYmlsaXR5RXhjZXB0aW9u\nIHsKICAgICAgICAvLyBUT0RPOiBjdXJyZW50bHkganVzdCB1c2UgemsgbGVk\nZ2VyIHVuZGVycmVwbGljYXRpb24gbWFuYWdlcgogICAgICAgIHJldHVybiBu\nZXcgWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcihjb25mLCB6ayk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNzIHNldCBvbmUgYnkgb25l\nIGluIGFzeW5jaHJvbml6ZSB3YXkuIFByb2Nlc3Mgd2lsbCBiZSBzdG9wcGVk\nCiAgICAgKiBpbW1lZGlhdGVseSB3aGVuIGVycm9yIG9jY3VycmVkLgogICAg\nICovCiAgICBwcml2YXRlIHN0YXRpYyBjbGFzcyBBc3luY1NldFByb2Nlc3Nv\ncjxUPiB7CiAgICAgICAgLy8gdXNlIHRoaXMgdG8gcHJldmVudCBsb25nIHN0\nYWNrIGNoYWlucyBmcm9tIGJ1aWxkaW5nIHVwIGluIGNhbGxiYWNrcwogICAg\nICAgIFNjaGVkdWxlZEV4ZWN1dG9yU2VydmljZSBzY2hlZHVsZXI7CgogICAg\nICAgIC8qKgogICAgICAgICAqIENvbnN0cnVjdG9yCiAgICAgICAgICoKICAg\nICAgICAgKiBAcGFyYW0gc2NoZWR1bGVyCiAgICAgICAgICogICAgICAgICAg\nICBFeGVjdXRvciB1c2VkIHRvIHByZXZlbnQgbG9uZyBzdGFjayBjaGFpbnMK\nICAgICAgICAgKi8KICAgICAgICBwdWJsaWMgQXN5bmNTZXRQcm9jZXNzb3Io\nU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxlcikgewogICAgICAg\nICAgICB0aGlzLnNjaGVkdWxlciA9IHNjaGVkdWxlcjsKICAgICAgICB9Cgog\nICAgICAgIC8qKgogICAgICAgICAqIFByb2Nlc3Mgc2V0IG9mIGl0ZW1zCiAg\nICAgICAgICoKICAgICAgICAgKiBAcGFyYW0gZGF0YQogICAgICAgICAqICAg\nICAgICAgICAgU2V0IG9mIGRhdGEgdG8gcHJvY2VzcwogICAgICAgICAqIEBw\nYXJhbSBwcm9jZXNzb3IKICAgICAgICAgKiAgICAgICAgICAgIENhbGxiYWNr\nIHRvIHByb2Nlc3MgZWxlbWVudCBvZiBsaXN0IHdoZW4gc3VjY2VzcwogICAg\nICAgICAqIEBwYXJhbSBmaW5hbENiCiAgICAgICAgICogICAgICAgICAgICBG\naW5hbCBjYWxsYmFjayB0byBiZSBjYWxsZWQgYWZ0ZXIgYWxsIGVsZW1lbnRz\nIGluIHRoZSBsaXN0CiAgICAgICAgICogICAgICAgICAgICBhcmUgcHJvY2Vz\nc2VkCiAgICAgICAgICogQHBhcmFtIGNvbnR4dAogICAgICAgICAqICAgICAg\nICAgICAgQ29udGV4dCBvZiBmaW5hbCBjYWxsYmFjawogICAgICAgICAqIEBw\nYXJhbSBzdWNjZXNzUmMKICAgICAgICAgKiAgICAgICAgICAgIFJDIHBhc3Nl\nZCB0byBmaW5hbCBjYWxsYmFjayBvbiBzdWNjZXNzCiAgICAgICAgICogQHBh\ncmFtIGZhaWx1cmVSYwogICAgICAgICAqICAgICAgICAgICAgUkMgcGFzc2Vk\nIHRvIGZpbmFsIGNhbGxiYWNrIG9uIGZhaWx1cmUKICAgICAgICAgKi8KICAg\nICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKGZpbmFsIFNldDxUPiBkYXRhLCBm\naW5hbCBQcm9jZXNzb3I8VD4gcHJvY2Vzc29yLCBmaW5hbCBBc3luY0NhbGxi\nYWNrLlZvaWRDYWxsYmFjayBmaW5hbENiLAogICAgICAgICAgICAgICAgZmlu\nYWwgT2JqZWN0IGNvbnRleHQsIGZpbmFsIGludCBzdWNjZXNzUmMsIGZpbmFs\nIGludCBmYWlsdXJlUmMpIHsKICAgICAgICAgICAgaWYgKGRhdGEgPT0gbnVs\nbCB8fCBkYXRhLnNpemUoKSA9PSAwKSB7CiAgICAgICAgICAgICAgICBmaW5h\nbENiLnByb2Nlc3NSZXN1bHQoc3VjY2Vzc1JjLCBudWxsLCBjb250ZXh0KTsK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBmaW5hbCBJdGVyYXRvcjxUPiBpdGVyID0gZGF0YS5pdGVyYXRvcigp\nOwogICAgICAgICAgICBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBzdHVi\nQ2FsbGJhY2sgPSBuZXcgQXN5bmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7\nCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwg\nT2JqZWN0IGN0eCkgewogICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBz\ndWNjZXNzUmMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGVybWlu\nYWwgaW1tZWRpYXRlbHkKICAgICAgICAgICAgICAgICAgICAgICAgZmluYWxD\nYi5wcm9jZXNzUmVzdWx0KGZhaWx1cmVSYywgbnVsbCwgY29udGV4dCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFpdGVyLmhhc05leHQo\nKSkgeyAvLyByZWFjaCB0aGUgZW5kIG9mIGxpc3QKICAgICAgICAgICAgICAg\nICAgICAgICAgZmluYWxDYi5wcm9jZXNzUmVzdWx0KHN1Y2Nlc3NSYywgbnVs\nbCwgY29udGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8g\ncHJvY2VzcyBuZXh0IGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICBmaW5h\nbCBUIGRhdGFUb1Byb2Nlc3MgPSBpdGVyLm5leHQoKTsKICAgICAgICAgICAg\nICAgICAgICBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBzdHVi\nID0gdGhpczsKICAgICAgICAgICAgICAgICAgICBzY2hlZHVsZXIuc3VibWl0\nKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyBmaW5hbCB2\nb2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nl\nc3Nvci5wcm9jZXNzKGRhdGFUb1Byb2Nlc3MsIHN0dWIpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIFQgZmly\nc3RFbGVtZW50ID0gaXRlci5uZXh0KCk7CiAgICAgICAgICAgIHByb2Nlc3Nv\nci5wcm9jZXNzKGZpcnN0RWxlbWVudCwgc3R1YkNhbGxiYWNrKTsKICAgICAg\nICB9CiAgICB9Cgp9Cg==\n","encoding":"base64"}

