{"sha":"f0d78d9ca7e2067e424d36b2b63f704c7e1763bb","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjBkNzhkOWNhN2UyMDY3ZTQyNGQzNmIyYjYzZjcwNGM3ZTE3NjNiYg==","size":27078,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f0d78d9ca7e2067e424d36b2b63f704c7e1763bb","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGE7CgppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJlcGxpY2F0aW9uRW5h\nYmxlQ2I7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRp\nb24uUmVwbGljYXRpb25FeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNlcHRpb24uVW5h\ndmFpbGFibGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnV0aWwuWmtVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5uZXQuRE5TOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJp\nY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3Rv\nLkRhdGFGb3JtYXRzLkxlZGdlclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXQ7\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uRGF0YUZvcm1h\ndHMuVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0OwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRzLkxvY2tEYXRhRm9y\nbWF0OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQWJzdHJh\nY3RDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hl\nZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5kYXRhLlN0YXQ7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5ab29EZWZzLklkczsKCmltcG9ydCBjb20uZ29v\nZ2xlLmNvbW1vbi5hbm5vdGF0aW9ucy5WaXNpYmxlRm9yVGVzdGluZzsKaW1w\nb3J0IGNvbS5nb29nbGUucHJvdG9idWYuVGV4dEZvcm1hdDsKaW1wb3J0IGNv\nbS5nb29nbGUuY29tbW9uLmJhc2UuSm9pbmVyOwppbXBvcnQgc3RhdGljIGNv\nbS5nb29nbGUuY29tbW9uLmJhc2UuQ2hhcnNldHMuVVRGXzg7CgppbXBvcnQg\namF2YS5uZXQuVW5rbm93bkhvc3RFeGNlcHRpb247CgppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7Cmlt\ncG9ydCBqYXZhLnV0aWwuRGVxdWU7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlE\nZXF1ZTsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEu\ndXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLlF1ZXVlOwppbXBv\ncnQgamF2YS51dGlsLkFycmF5TGlzdDsKCmltcG9ydCBqYXZhLnV0aWwucmVn\nZXguUGF0dGVybjsKaW1wb3J0IGphdmEudXRpbC5yZWdleC5NYXRjaGVyOwoK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyRmFjdG9yeTsKCi8qKgogKiBab29LZWVwZXIgaW1wbGVtZW50YXRpb24g\nb2YgdW5kZXJyZXBsaWNhdGlvbiBtYW5hZ2VyLgogKiBUaGlzIGlzIGltcGxl\nbWVudGVkIGluIGEgaGVpcmFyY2hpY2FsIGZhc2hpb24sIHNvIGl0J2xsIHdv\ncmsgd2l0aAogKiBGbGF0TGVkZ2VyTWFuYWdlckZhY3RvcnkgYW5kIEhpZXJh\ncmNoaWNhbExlZGdlck1hbmFnZXJGYWN0b3J5LgogKgogKiBMYXlvdXQgaXM6\nCiAqIC9yb290L3VuZGVycmVwbGljYXRpb24vIExBWU9VVAogKiAgICAgICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJzLyhoaWVyYXJjaGljYWxwYXRoKS91\nckwobGVkZ2VySWQpCiAqICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2tz\nLyhsZWRnZXJJZCkKICoKICogVGhlIGhpZXJhcmNoaWNhbCBwYXRoIGlzIGNy\nZWF0ZWQgYnkgc3BsaXR0aW5nIHRoZSBsZWRnZXIgaW50byA0IDJieXRlCiAq\nIHNlZ21lbnRzIHdoaWNoIGFyZSByZXByZXNlbnRlZCBpbiBoZXhpZGVjaW1h\nbC4KICogZS5nLiBGb3IgbGVkZ2VyIGlkIDB4Y2FmZWJlZWYwMDAwZmVlZCwg\ndGhlIHBhdGggaXMKICogIGNhZmUvYmVlZi8wMDAwL2ZlZWQvCiAqLwpwdWJs\naWMgY2xhc3MgWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBpbXBs\nZW1lbnRzIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIHsKICAgIHN0\nYXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dn\nZXIoWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlci5jbGFzcyk7CiAg\nICBzdGF0aWMgZmluYWwgU3RyaW5nIExBWU9VVD0iQkFTSUMiOwogICAgc3Rh\ndGljIGZpbmFsIGludCBMQVlPVVRfVkVSU0lPTj0xOwoKICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIExvY2sgewogICAgICAgIHByaXZhdGUgZmluYWwgU3Ry\naW5nIGxvY2taTm9kZTsKICAgICAgICBwcml2YXRlIGZpbmFsIGludCBsZWRn\nZXJaTm9kZVZlcnNpb247CgogICAgICAgIExvY2soU3RyaW5nIGxvY2taTm9k\nZSwgaW50IGxlZGdlclpOb2RlVmVyc2lvbikgewogICAgICAgICAgICB0aGlz\nLmxvY2taTm9kZSA9IGxvY2taTm9kZTsKICAgICAgICAgICAgdGhpcy5sZWRn\nZXJaTm9kZVZlcnNpb24gPSBsZWRnZXJaTm9kZVZlcnNpb247CiAgICAgICAg\nfQoKICAgICAgICBTdHJpbmcgZ2V0TG9ja1pOb2RlKCkgeyByZXR1cm4gbG9j\na1pOb2RlOyB9CiAgICAgICAgaW50IGdldExlZGdlclpOb2RlVmVyc2lvbigp\nIHsgcmV0dXJuIGxlZGdlclpOb2RlVmVyc2lvbjsgfQogICAgfTsKICAgIHBy\naXZhdGUgZmluYWwgTWFwPExvbmcsIExvY2s+IGhlbGRMb2NrcyA9IG5ldyBD\nb25jdXJyZW50SGFzaE1hcDxMb25nLCBMb2NrPigpOwogICAgcHJpdmF0ZSBm\naW5hbCBQYXR0ZXJuIGlkRXh0cmFjdGlvblBhdHRlcm47CgogICAgcHJpdmF0\nZSBmaW5hbCBTdHJpbmcgYmFzZVBhdGg7CiAgICBwcml2YXRlIGZpbmFsIFN0\ncmluZyB1ckxlZGdlclBhdGg7CiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyB1\nckxvY2tQYXRoOwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgbGF5b3V0Wk5v\nZGU7CiAgICBwcml2YXRlIGZpbmFsIExvY2tEYXRhRm9ybWF0IGxvY2tEYXRh\nOwoKICAgIHByaXZhdGUgZmluYWwgWm9vS2VlcGVyIHprYzsKCiAgICBwdWJs\naWMgWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcihBYnN0cmFjdENv\nbmZpZ3VyYXRpb24gY29uZiwgWm9vS2VlcGVyIHprYykKICAgICAgICAgICAg\ndGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24s\nIFJlcGxpY2F0aW9uRXhjZXB0aW9uLkNvbXBhdGliaWxpdHlFeGNlcHRpb24g\newogICAgICAgIGJhc2VQYXRoID0gY29uZi5nZXRaa0xlZGdlcnNSb290UGF0\naCgpICsgJy8nCiAgICAgICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFu\ndHMuVU5ERVJfUkVQTElDQVRJT05fTk9ERTsKICAgICAgICBsYXlvdXRaTm9k\nZSA9IGJhc2VQYXRoICsgJy8nICsgQm9va0tlZXBlckNvbnN0YW50cy5MQVlP\nVVRfWk5PREU7CiAgICAgICAgdXJMZWRnZXJQYXRoID0gYmFzZVBhdGgKICAg\nICAgICAgICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5ERUZBVUxUX1pL\nX0xFREdFUlNfUk9PVF9QQVRIOwogICAgICAgIHVyTG9ja1BhdGggPSBiYXNl\nUGF0aCArICIvbG9ja3MiOwoKICAgICAgICBpZEV4dHJhY3Rpb25QYXR0ZXJu\nID0gUGF0dGVybi5jb21waWxlKCJ1ckwoXFxkKykkIik7CiAgICAgICAgdGhp\ncy56a2MgPSB6a2M7CgogICAgICAgIExvY2tEYXRhRm9ybWF0LkJ1aWxkZXIg\nbG9ja0RhdGFCdWlsZGVyID0gTG9ja0RhdGFGb3JtYXQubmV3QnVpbGRlcigp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvY2tEYXRhQnVpbGRlci5z\nZXRCb29raWVJZChETlMuZ2V0RGVmYXVsdEhvc3QoImRlZmF1bHQiKSk7CiAg\nICAgICAgfSBjYXRjaCAoVW5rbm93bkhvc3RFeGNlcHRpb24gdWhlKSB7CiAg\nICAgICAgICAgIC8vIGlmIHdlIGNhbnQgZ2V0IHRoZSBhZGRyZXNzLCBpZ25v\ncmUuIGl0J3Mgb3B0aW9uYWwKICAgICAgICAgICAgLy8gaW4gdGhlIGRhdGEg\nc3RydWN0dXJlIGluIGFueSBjYXNlCiAgICAgICAgfQogICAgICAgIGxvY2tE\nYXRhID0gbG9ja0RhdGFCdWlsZGVyLmJ1aWxkKCk7CgogICAgICAgIGNoZWNr\nTGF5b3V0KCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNoZWNrTGF5b3V0\nKCkKICAgICAgICAgICAgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIFJlcGxpY2F0aW9uRXhjZXB0aW9uLkNvbXBhdGli\naWxpdHlFeGNlcHRpb24gewogICAgICAgIGlmICh6a2MuZXhpc3RzKGJhc2VQ\nYXRoLCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgemtjLmNyZWF0ZShiYXNlUGF0aCwgbmV3IGJ5dGVbMF0s\nIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1vZGUuUEVSU0lTVEVOVCk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob2RlRXhp\nc3RzRXhjZXB0aW9uIG5lZSkgewogICAgICAgICAgICAgICAgLy8gZG8gbm90\naGluZywgc29tZW9uZSBlYWNoIGNvdWxkIGhhdmUgY3JlYXRlZCBpdAogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHdoaWxlICh0cnVlKSB7CiAg\nICAgICAgICAgIGlmICh6a2MuZXhpc3RzKGxheW91dFpOb2RlLCBmYWxzZSkg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgTGVkZ2VyUmVyZXBsaWNhdGlv\nbkxheW91dEZvcm1hdC5CdWlsZGVyIGJ1aWxkZXIKICAgICAgICAgICAgICAg\nICAgICA9IExlZGdlclJlcmVwbGljYXRpb25MYXlvdXRGb3JtYXQubmV3QnVp\nbGRlcigpOwogICAgICAgICAgICAgICAgYnVpbGRlci5zZXRUeXBlKExBWU9V\nVCkuc2V0VmVyc2lvbihMQVlPVVRfVkVSU0lPTik7CiAgICAgICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgICAgIHprYy5jcmVhdGUobGF5b3V0\nWk5vZGUsIFRleHRGb3JtYXQucHJpbnRUb1N0cmluZyhidWlsZGVyLmJ1aWxk\nKCkpLmdldEJ5dGVzKFVURl84KSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1vZGUuUEVSU0lT\nVEVOVCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRp\nb24uTm9kZUV4aXN0c0V4Y2VwdGlvbiBubmUpIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBzb21lb25lIGVsc2UgbWFuYWdlZCB0byBjcmVhdGUgaXQKICAg\nICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGJ5dGVbXSBs\nYXlvdXREYXRhID0gemtjLmdldERhdGEobGF5b3V0Wk5vZGUsIGZhbHNlLCBu\ndWxsKTsKCiAgICAgICAgICAgICAgICBMZWRnZXJSZXJlcGxpY2F0aW9uTGF5\nb3V0Rm9ybWF0LkJ1aWxkZXIgYnVpbGRlcgogICAgICAgICAgICAgICAgICAg\nID0gTGVkZ2VyUmVyZXBsaWNhdGlvbkxheW91dEZvcm1hdC5uZXdCdWlsZGVy\nKCk7CgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBUZXh0Rm9ybWF0Lm1lcmdlKG5ldyBTdHJpbmcobGF5b3V0RGF0YSwgVVRG\nXzgpLCBidWlsZGVyKTsKICAgICAgICAgICAgICAgICAgICBMZWRnZXJSZXJl\ncGxpY2F0aW9uTGF5b3V0Rm9ybWF0IGxheW91dCA9IGJ1aWxkZXIuYnVpbGQo\nKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIWxheW91dC5nZXRUeXBlKCku\nZXF1YWxzKExBWU9VVCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8\nIGxheW91dC5nZXRWZXJzaW9uKCkgIT0gTEFZT1VUX1ZFUlNJT04pIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJlcGxpY2F0aW9uRXhj\nZXB0aW9uLkNvbXBhdGliaWxpdHlFeGNlcHRpb24oCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIkluY29tcGF0aWJsZSBsYXlvdXQgZm91bmQg\nKCIgKyBMQVlPVVQgKyAiOiIgKyBMQVlPVVRfVkVSU0lPTiArICIpIik7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nVGV4dEZvcm1hdC5QYXJzZUV4Y2VwdGlvbiBwZSkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IG5ldyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5Db21wYXRp\nYmlsaXR5RXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIkludmFsaWQgZGF0YSBmb3VuZCIsIHBlKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIGlmICh6a2MuZXhpc3RzKHVyTGVkZ2VyUGF0aCwgZmFsc2Up\nID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIHprYy5jcmVhdGUodXJMZWRnZXJQYXRoLCBuZXcgYnl0ZVswXSwgSWRzLk9Q\nRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJTSVNURU5UKTsKICAgICAg\nICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vZGVFeGlzdHNFeGNl\ncHRpb24gbmVlKSB7CiAgICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nLCBz\nb21lb25lIGVhY2ggY291bGQgaGF2ZSBjcmVhdGVkIGl0CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICAgICAgaWYgKHprYy5leGlzdHModXJMb2NrUGF0\naCwgZmFsc2UpID09IG51bGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIHprYy5jcmVhdGUodXJMb2NrUGF0aCwgbmV3IGJ5dGVbMF0s\nIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1vZGUuUEVSU0lTVEVOVCk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob2RlRXhp\nc3RzRXhjZXB0aW9uIG5lZSkgewogICAgICAgICAgICAgICAgLy8gZG8gbm90\naGluZywgc29tZW9uZSBlYWNoIGNvdWxkIGhhdmUgY3JlYXRlZCBpdAogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgbG9uZyBn\nZXRMZWRnZXJJZChTdHJpbmcgcGF0aCkgdGhyb3dzIE51bWJlckZvcm1hdEV4\nY2VwdGlvbiB7CiAgICAgICAgTWF0Y2hlciBtID0gaWRFeHRyYWN0aW9uUGF0\ndGVybi5tYXRjaGVyKHBhdGgpOwogICAgICAgIGlmIChtLmZpbmQoKSkgewog\nICAgICAgICAgICByZXR1cm4gTG9uZy52YWx1ZU9mKG0uZ3JvdXAoMSkpOwog\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRocm93IG5ldyBOdW1iZXJG\nb3JtYXRFeGNlcHRpb24oIkNvdWxkbid0IGZpbmQgbGVkZ2VyaWQgaW4gcGF0\naCIpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIFN0cmlu\nZyBnZXRQYXJlbnRabm9kZVBhdGgoU3RyaW5nIGJhc2UsIGxvbmcgbGVkZ2Vy\nSWQpIHsKICAgICAgICBTdHJpbmcgc3ViZGlyMSA9IFN0cmluZy5mb3JtYXQo\nIiUwNHgiLCBsZWRnZXJJZCA+PiA0OCAmIDB4ZmZmZik7CiAgICAgICAgU3Ry\naW5nIHN1YmRpcjIgPSBTdHJpbmcuZm9ybWF0KCIlMDR4IiwgbGVkZ2VySWQg\nPj4gMzIgJiAweGZmZmYpOwogICAgICAgIFN0cmluZyBzdWJkaXIzID0gU3Ry\naW5nLmZvcm1hdCgiJTA0eCIsIGxlZGdlcklkID4+IDE2ICYgMHhmZmZmKTsK\nICAgICAgICBTdHJpbmcgc3ViZGlyNCA9IFN0cmluZy5mb3JtYXQoIiUwNHgi\nLCBsZWRnZXJJZCAmIDB4ZmZmZik7CgogICAgICAgIHJldHVybiBTdHJpbmcu\nZm9ybWF0KCIlcy8lcy8lcy8lcy8lcyIsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYmFzZSwgc3ViZGlyMSwgc3ViZGlyMiwgc3ViZGlyMywgc3Vi\nZGlyNCk7CiAgICB9CgogICAgcHVibGljIHN0YXRpYyBTdHJpbmcgZ2V0VXJM\nZWRnZXJabm9kZShTdHJpbmcgYmFzZSwgbG9uZyBsZWRnZXJJZCkgewogICAg\nICAgIHJldHVybiBTdHJpbmcuZm9ybWF0KCIlcy91ckwlMDEwZCIsIGdldFBh\ncmVudFpub2RlUGF0aChiYXNlLCBsZWRnZXJJZCksIGxlZGdlcklkKTsKICAg\nIH0KCiAgICBwcml2YXRlIFN0cmluZyBnZXRVckxlZGdlclpub2RlKGxvbmcg\nbGVkZ2VySWQpIHsKICAgICAgICByZXR1cm4gZ2V0VXJMZWRnZXJabm9kZSh1\nckxlZGdlclBhdGgsIGxlZGdlcklkKTsKICAgIH0KCiAgICBAVmlzaWJsZUZv\nclRlc3RpbmcKICAgIHB1YmxpYyBVbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3Jt\nYXQgZ2V0TGVkZ2VyVW5yZXBsaWNhdGlvbkluZm8obG9uZyBsZWRnZXJJZCkK\nICAgICAgICAgICAgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgVGV4dEZvcm1h\ndC5QYXJzZUV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAg\nICAgIFN0cmluZyB6bm9kZSA9IGdldFVyTGVkZ2VyWm5vZGUobGVkZ2VySWQp\nOwogICAgICAgIFVuZGVycmVwbGljYXRlZExlZGdlckZvcm1hdC5CdWlsZGVy\nIGJ1aWxkZXIgPSBVbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQubmV3QnVp\nbGRlcigpOwogICAgICAgIGJ5dGVbXSBkYXRhID0gemtjLmdldERhdGEoem5v\nZGUsIGZhbHNlLCBudWxsKTsKICAgICAgICBUZXh0Rm9ybWF0Lm1lcmdlKG5l\ndyBTdHJpbmcoZGF0YSwgVVRGXzgpLCBidWlsZGVyKTsKICAgICAgICByZXR1\ncm4gYnVpbGRlci5idWlsZCgpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgbWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsb25nIGxl\nZGdlcklkLCBTdHJpbmcgbWlzc2luZ1JlcGxpY2EpCiAgICAgICAgICAgIHRo\ncm93cyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlv\nbiB7CiAgICAgICAgTE9HLmRlYnVnKCJtYXJrTGVkZ2VyVW5kZXJyZXBsaWNh\ndGVkKGxlZGdlcklkPXt9LCBtaXNzaW5nUmVwbGljYT17fSkiLCBsZWRnZXJJ\nZCwgbWlzc2luZ1JlcGxpY2EpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIFN0cmluZyB6bm9kZSA9IGdldFVyTGVkZ2VyWm5vZGUobGVkZ2VySWQpOwog\nICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgVW5k\nZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0LkJ1aWxkZXIgYnVpbGRlciA9IFVu\nZGVycmVwbGljYXRlZExlZGdlckZvcm1hdC5uZXdCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIu\nYWRkUmVwbGljYShtaXNzaW5nUmVwbGljYSk7CiAgICAgICAgICAgICAgICAg\nICAgWmtVdGlscy5jcmVhdGVGdWxsUGF0aE9wdGltaXN0aWMoemtjLCB6bm9k\nZSwgVGV4dEZvcm1hdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnBy\naW50VG9TdHJpbmcoYnVpbGRlci5idWlsZCgpKS5nZXRCeXRlcyhVVEZfOCks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBJZHMuT1BFTl9BQ0xfVU5T\nQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vZGVFeGlzdHNFeGNlcHRpb24g\nbmVlKSB7CiAgICAgICAgICAgICAgICAgICAgU3RhdCBzID0gemtjLmV4aXN0\ncyh6bm9kZSwgZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGlmIChzID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGJ5dGVbXSBieXRlcyA9IHprYy5n\nZXREYXRhKHpub2RlLCBmYWxzZSwgcyk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJ1aWxkZXIuY2xlYXIoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nVGV4dEZvcm1hdC5tZXJnZShuZXcgU3RyaW5nKGJ5dGVzLCBVVEZfOCksIGJ1\naWxkZXIpOwogICAgICAgICAgICAgICAgICAgICAgICBVbmRlcnJlcGxpY2F0\nZWRMZWRnZXJGb3JtYXQgZGF0YSA9IGJ1aWxkZXIuYnVpbGQoKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGRhdGEuZ2V0UmVwbGljYUxpc3QoKS5j\nb250YWlucyhtaXNzaW5nUmVwbGljYSkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsgLy8gbm90aGluZyB0byBhZGQKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBidWls\nZGVyLmFkZFJlcGxpY2EobWlzc2luZ1JlcGxpY2EpOwogICAgICAgICAgICAg\nICAgICAgICAgICB6a2Muc2V0RGF0YSh6bm9kZSwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgVGV4dEZvcm1hdC5wcmludFRvU3RyaW5n\nKGJ1aWxkZXIuYnVpbGQoKSkuZ2V0Qnl0ZXMoVVRGXzgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBzLmdldFZlcnNpb24oKSk7CiAg\nICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5v\nTm9kZUV4Y2VwdGlvbiBubmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVy\nRXhjZXB0aW9uLkJhZFZlcnNpb25FeGNlcHRpb24gYnZlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKFRleHRGb3JtYXQuUGFyc2VFeGNlcHRpb24gcGUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFJlcGxpY2F0aW9uRXhj\nZXB0aW9uLlVuYXZhaWxhYmxlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICJJbnZhbGlkIGRhdGEgZm91bmQiLCBwZSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNo\nIChLZWVwZXJFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIFJlcGxpY2F0aW9uRXhjZXB0aW9uLlVuYXZhaWxhYmxlRXhjZXB0aW9uKCJF\ncnJvciBjb250YWN0aW5nIHpvb2tlZXBlciIsIGtlKTsKICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICBU\naHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAg\nICB0aHJvdyBuZXcgUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVF\neGNlcHRpb24oIkludGVycnVwdGVkIHdoaWxlIGNvbnRhY3Rpbmcgem9va2Vl\ncGVyIiwgaWUpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyB2b2lkIG1hcmtMZWRnZXJSZXBsaWNhdGVkKGxvbmcgbGVkZ2Vy\nSWQpIHRocm93cyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4\nY2VwdGlvbiB7CiAgICAgICAgTE9HLmRlYnVnKCJtYXJrTGVkZ2VyUmVwbGlj\nYXRlZChsZWRnZXJJZD17fSkiLCBsZWRnZXJJZCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgTG9jayBsID0gaGVsZExvY2tzLmdldChsZWRnZXJJZCk7\nCiAgICAgICAgICAgIGlmIChsICE9IG51bGwpIHsKICAgICAgICAgICAgICAg\nIHprYy5kZWxldGUoZ2V0VXJMZWRnZXJabm9kZShsZWRnZXJJZCksIGwuZ2V0\nTGVkZ2VyWk5vZGVWZXJzaW9uKCkpOwoKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gY2xlYW4gdXAgdGhlIGhpZXJhcmNo\neQogICAgICAgICAgICAgICAgICAgIFN0cmluZyBwYXJ0c1tdID0gZ2V0VXJM\nZWRnZXJabm9kZShsZWRnZXJJZCkuc3BsaXQoIi8iKTsKICAgICAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMTsgaSA8PSA0OyBpKyspIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgU3RyaW5nIHBbXSA9IEFycmF5cy5jb3B5T2Yo\ncGFydHMsIHBhcnRzLmxlbmd0aCAtIGkpOwogICAgICAgICAgICAgICAgICAg\nICAgICBTdHJpbmcgcGF0aCA9IEpvaW5lci5vbigiLyIpLmpvaW4ocCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIFN0YXQgcyA9IHprYy5leGlzdHMocGF0\naCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHprYy5kZWxldGUo\ncGF0aCwgcy5nZXRWZXJzaW9uKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBj\nYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vdEVtcHR5RXhjZXB0aW9uIG5lZSkg\newogICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgY2FuIGhhcHBlbiB3aGVu\nIGNsZWFuaW5nIHVwIHRoZSBoaWVyYXJjaHkuCiAgICAgICAgICAgICAgICAg\nICAgLy8gSXQncyBzYWZlIHRvIGlnbm9yZSwgaXQgc2ltcGx5IG1lYW5zIGFu\nb3RoZXIKICAgICAgICAgICAgICAgICAgICAvLyBsZWRnZXIgaW4gdGhlIHNh\nbWUgaGllcmFyY2h5IGhhcyBiZWVuIG1hcmtlZCBhcwogICAgICAgICAgICAg\nICAgICAgIC8vIHVuZGVycmVwbGljYXRlZC4KICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlv\nbi5Ob05vZGVFeGNlcHRpb24gbm5lKSB7CiAgICAgICAgICAgIC8vIHRoaXMg\naXMgb2sKICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24uQmFkVmVy\nc2lvbkV4Y2VwdGlvbiBidmUpIHsKICAgICAgICAgICAgLy8gaWYgdGhpcyBp\ncyB0aGUgY2FzZSwgc29tZSBoYXMgbWFya2VkIHRoZSBsZWRnZXIKICAgICAg\nICAgICAgLy8gZm9yIHJlcmVwbGljYXRpb24gYWdhaW4uIExlYXZlIHRoZSB1\nbmRlcnJlcGxpY2F0ZWQKICAgICAgICAgICAgLy8gem5vZGUgaW4gcGxhY2Us\nIHNvIHRoZSBsZWRnZXIgaXMgY2hlY2tlZC4KICAgICAgICB9IGNhdGNoIChL\nZWVwZXJFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJF\ncnJvciBkZWxldGluZyB1bmRlcnJlcGxpY2F0ZWQgbGVkZ2VyIHpub2RlIiwg\na2UpOwogICAgICAgICAgICB0aHJvdyBuZXcgUmVwbGljYXRpb25FeGNlcHRp\nb24uVW5hdmFpbGFibGVFeGNlcHRpb24oIkVycm9yIGNvbnRhY3Rpbmcgem9v\na2VlcGVyIiwga2UpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhj\nZXB0aW9uIGllKSB7CiAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFk\nKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIHRocm93IG5ldyBSZXBsaWNh\ndGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbigiSW50ZXJydXB0\nZWQgd2hpbGUgY29udGFjdGluZyB6b29rZWVwZXIiLCBpZSk7CiAgICAgICAg\nfSBmaW5hbGx5IHsKICAgICAgICAgICAgcmVsZWFzZVVuZGVycmVwbGljYXRl\nZExlZGdlcihsZWRnZXJJZCk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIEl0ZXJhdG9yPExvbmc+IGxpc3RMZWRnZXJzVG9S\nZXJlcGxpY2F0ZSgpIHsKICAgICAgICBmaW5hbCBRdWV1ZTxTdHJpbmc+IHF1\nZXVlID0gbmV3IExpbmtlZExpc3Q8U3RyaW5nPigpOwogICAgICAgIHF1ZXVl\nLmFkZCh1ckxlZGdlclBhdGgpOwoKICAgICAgICByZXR1cm4gbmV3IEl0ZXJh\ndG9yPExvbmc+KCkgewogICAgICAgICAgICBmaW5hbCBRdWV1ZTxMb25nPiBj\ndXJCYXRjaCA9IG5ldyBMaW5rZWRMaXN0PExvbmc+KCk7CgogICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcmVtb3ZlKCkg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuc3VwcG9ydGVkT3BlcmF0\naW9uRXhjZXB0aW9uKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBoYXNOZXh0KCkg\newogICAgICAgICAgICAgICAgaWYgKGN1ckJhdGNoLnNpemUoKSA+IDApIHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICB3aGlsZSAocXVldWUuc2l6ZSgpID4g\nMCAmJiBjdXJCYXRjaC5zaXplKCkgPT0gMCkgewogICAgICAgICAgICAgICAg\nICAgIFN0cmluZyBwYXJlbnQgPSBxdWV1ZS5yZW1vdmUoKTsKICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3Ig\nKFN0cmluZyBjIDogemtjLmdldENoaWxkcmVuKHBhcmVudCxmYWxzZSkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBjaGlsZCA9IHBh\ncmVudCArICIvIiArIGM7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoYy5zdGFydHNXaXRoKCJ1ckwiKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGN1ckJhdGNoLmFkZChnZXRMZWRnZXJJZChjaGlsZCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBxdWV1ZS5hZGQoY2hpbGQpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJy\ndXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNlcHRpb24g\nbm5lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZQogICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9u\nKCJFcnJvciByZWFkaW5nIGxpc3QiLCBlKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4g\nY3VyQmF0Y2guc2l6ZSgpID4gMDsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBMb25nIG5leHQoKSB7\nCiAgICAgICAgICAgICAgICBhc3NlcnQgY3VyQmF0Y2guc2l6ZSgpID4gMDsK\nICAgICAgICAgICAgICAgIHJldHVybiBjdXJCYXRjaC5yZW1vdmUoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH07CiAgICB9CgogICAgcHJpdmF0ZSBsb25n\nIGdldExlZGdlclRvUmVyZXBsaWNhdGVGcm9tSGllcmFyY2h5KFN0cmluZyBw\nYXJlbnQsIGxvbmcgZGVwdGgsIFdhdGNoZXIgdykKICAgICAgICAgICAgdGhy\nb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24gewog\nICAgICAgIGlmIChkZXB0aCA9PSA0KSB7CiAgICAgICAgICAgIExpc3Q8U3Ry\naW5nPiBjaGlsZHJlbjsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIGNoaWxkcmVuID0gemtjLmdldENoaWxkcmVuKHBhcmVudCwgdyk7CiAg\nICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNl\ncHRpb24gbm5lKSB7CiAgICAgICAgICAgICAgICAvLyBjYW4gb2NjdXIgaWYg\nYW5vdGhlciB1bmRlcnJlcGxpY2F0ZWQgbGVkZ2VyJ3MKICAgICAgICAgICAg\nICAgIC8vIGhpZXJhcmNoeSBpcyBiZWluZyBjbGVhbmVkIHVwCiAgICAgICAg\nICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nIENvbGxlY3Rpb25zLnNodWZmbGUoY2hpbGRyZW4pOwoKICAgICAgICAgICAg\nd2hpbGUgKGNoaWxkcmVuLnNpemUoKSA+IDApIHsKICAgICAgICAgICAgICAg\nIFN0cmluZyB0cnlDaGlsZCA9IGNoaWxkcmVuLmdldCgwKTsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGxvY2tQ\nYXRoID0gdXJMb2NrUGF0aCArICIvIiArIHRyeUNoaWxkOwogICAgICAgICAg\nICAgICAgICAgIGlmICh6a2MuZXhpc3RzKGxvY2tQYXRoLCB3KSAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnJlbW92ZSh0\ncnlDaGlsZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwog\nICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgU3Rh\ndCBzdGF0ID0gemtjLmV4aXN0cyhwYXJlbnQgKyAiLyIgKyB0cnlDaGlsZCwg\nZmFsc2UpOwogICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ID09IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJ7fS97fSBk\nb2Vzbid0IGV4aXN0IiwgcGFyZW50LCB0cnlDaGlsZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNoaWxkcmVuLnJlbW92ZSh0cnlDaGlsZCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbG9uZyBsZWRnZXJJZCA9IGdl\ndExlZGdlcklkKHRyeUNoaWxkKTsKICAgICAgICAgICAgICAgICAgICB6a2Mu\nY3JlYXRlKGxvY2tQYXRoLCBUZXh0Rm9ybWF0LnByaW50VG9TdHJpbmcobG9j\na0RhdGEpLmdldEJ5dGVzKFVURl84KSwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1vZGUuRVBI\nRU1FUkFMKTsKICAgICAgICAgICAgICAgICAgICBoZWxkTG9ja3MucHV0KGxl\nZGdlcklkLCBuZXcgTG9jayhsb2NrUGF0aCwgc3RhdC5nZXRWZXJzaW9uKCkp\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGVkZ2VySWQ7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24uTm9kZUV4aXN0\nc0V4Y2VwdGlvbiBuZWUpIHsKICAgICAgICAgICAgICAgICAgICBjaGlsZHJl\nbi5yZW1vdmUodHJ5Q2hpbGQpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAo\nTnVtYmVyRm9ybWF0RXhjZXB0aW9uIG5mZSkgewogICAgICAgICAgICAgICAg\nICAgIGNoaWxkcmVuLnJlbW92ZSh0cnlDaGlsZCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIC0xOwogICAg\nICAgIH0KCiAgICAgICAgTGlzdDxTdHJpbmc+IGNoaWxkcmVuOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGNoaWxkcmVuID0gemtjLmdldENoaWxkcmVu\nKHBhcmVudCwgdyk7CiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9u\nLk5vTm9kZUV4Y2VwdGlvbiBubmUpIHsKICAgICAgICAgICAgLy8gY2FuIG9j\nY3VyIGlmIGFub3RoZXIgdW5kZXJyZXBsaWNhdGVkIGxlZGdlcidzCiAgICAg\nICAgICAgIC8vIGhpZXJhcmNoeSBpcyBiZWluZyBjbGVhbmVkIHVwCiAgICAg\nICAgICAgIHJldHVybiAtMTsKICAgICAgICB9CgogICAgICAgIENvbGxlY3Rp\nb25zLnNodWZmbGUoY2hpbGRyZW4pOwoKICAgICAgICB3aGlsZSAoY2hpbGRy\nZW4uc2l6ZSgpID4gMCkgewogICAgICAgICAgICBTdHJpbmcgdHJ5Q2hpbGQg\nPSBjaGlsZHJlbi5nZXQoMCk7CiAgICAgICAgICAgIFN0cmluZyB0cnlQYXRo\nID0gcGFyZW50ICsgIi8iICsgdHJ5Q2hpbGQ7CiAgICAgICAgICAgIGxvbmcg\nbGVkZ2VyID0gZ2V0TGVkZ2VyVG9SZXJlcGxpY2F0ZUZyb21IaWVyYXJjaHko\ndHJ5UGF0aCwgZGVwdGggKyAxLCB3KTsKICAgICAgICAgICAgaWYgKGxlZGdl\nciAhPSAtMSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGxlZGdlcjsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBjaGlsZHJlbi5yZW1vdmUodHJ5Q2hp\nbGQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gLTE7CiAgICB9CgoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIGxvbmcgcG9sbExlZGdlclRvUmVyZXBs\naWNhdGUoKSB0aHJvd3MgUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFi\nbGVFeGNlcHRpb24gewogICAgICAgIExPRy5kZWJ1ZygicG9sbExlZGdlclRv\nUmVyZXBsaWNhdGUoKSIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIFdh\ndGNoZXIgdyA9IG5ldyBXYXRjaGVyKCkgewogICAgICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGUpIHsgLy8gZG8g\nbm90aGluZwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH07CiAgICAgICAgICAgIHJldHVybiBnZXRMZWRnZXJUb1JlcmVwbGljYXRl\nRnJvbUhpZXJhcmNoeSh1ckxlZGdlclBhdGgsIDAsIHcpOwogICAgICAgIH0g\nY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRp\nb24oIkVycm9yIGNvbnRhY3Rpbmcgem9va2VlcGVyIiwga2UpOwogICAgICAg\nIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAg\nICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAg\nICAgICAgIHRocm93IG5ldyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWls\nYWJsZUV4Y2VwdGlvbigiSW50ZXJydXB0ZWQgd2hpbGUgY29ubmVjdGluZyB6\nb29rZWVwZXIiLCBpZSk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgcHVibGljIGxvbmcgZ2V0TGVkZ2VyVG9SZXJlcGxpY2F0ZSgpIHRo\ncm93cyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlv\nbiB7CiAgICAgICAgTE9HLmRlYnVnKCJnZXRMZWRnZXJUb1JlcmVwbGljYXRl\nKCkiKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAodHJ1ZSkg\newogICAgICAgICAgICAgICAgd2FpdElmTGVkZ2VyUmVwbGljYXRpb25EaXNh\nYmxlZCgpOwogICAgICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2gg\nY2hhbmdlZExhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAg\nICAgICAgICAgV2F0Y2hlciB3ID0gbmV3IFdhdGNoZXIoKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2\nZW50IGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLmdl\ndFR5cGUoKSA9PSBXYXRjaGVyLkV2ZW50LkV2ZW50VHlwZS5Ob2RlQ2hpbGRy\nZW5DaGFuZ2VkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwg\nZS5nZXRUeXBlKCkgPT0gV2F0Y2hlci5FdmVudC5FdmVudFR5cGUuTm9kZURl\nbGV0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBlLmdl\ndFR5cGUoKSA9PSBXYXRjaGVyLkV2ZW50LkV2ZW50VHlwZS5Ob2RlQ3JlYXRl\nZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IGUuZ2V0U3Rh\ndGUoKSA9PSBXYXRjaGVyLkV2ZW50LktlZXBlclN0YXRlLkV4cGlyZWQKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBlLmdldFN0YXRlKCkg\nPT0gV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZS5EaXNjb25uZWN0ZWQpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGFuZ2VkTGF0Y2gu\nY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9\nOwogICAgICAgICAgICAgICAgbG9uZyBsZWRnZXIgPSBnZXRMZWRnZXJUb1Jl\ncmVwbGljYXRlRnJvbUhpZXJhcmNoeSh1ckxlZGdlclBhdGgsIDAsIHcpOwog\nICAgICAgICAgICAgICAgaWYgKGxlZGdlciAhPSAtMSkgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybiBsZWRnZXI7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAvLyBub3RoaW5nIGZvdW5kLCB3YWl0IGZvciBhIHdh\ndGNoZXIgdG8gdHJpZ2dlcgogICAgICAgICAgICAgICAgY2hhbmdlZExhdGNo\nLmF3YWl0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChLZWVw\nZXJFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IFJlcGxp\nY2F0aW9uRXhjZXB0aW9uLlVuYXZhaWxhYmxlRXhjZXB0aW9uKCJFcnJvciBj\nb250YWN0aW5nIHpvb2tlZXBlciIsIGtlKTsKICAgICAgICB9IGNhdGNoIChJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICBUaHJlYWQu\nY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICB0aHJv\ndyBuZXcgUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRp\nb24oIkludGVycnVwdGVkIHdoaWxlIGNvbm5lY3Rpbmcgem9va2VlcGVyIiwg\naWUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd2FpdElm\nTGVkZ2VyUmVwbGljYXRpb25EaXNhYmxlZCgpIHRocm93cyBVbmF2YWlsYWJs\nZUV4Y2VwdGlvbiwKICAgICAgICAgICAgSW50ZXJydXB0ZWRFeGNlcHRpb24g\newogICAgICAgIFJlcGxpY2F0aW9uRW5hYmxlQ2IgY2IgPSBuZXcgUmVwbGlj\nYXRpb25FbmFibGVDYigpOwogICAgICAgIGlmICghdGhpcy5pc0xlZGdlclJl\ncGxpY2F0aW9uRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIHRoaXMubm90aWZ5\nTGVkZ2VyUmVwbGljYXRpb25FbmFibGVkKGNiKTsKICAgICAgICAgICAgY2Iu\nYXdhaXQoKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCByZWxlYXNlVW5kZXJyZXBsaWNhdGVkTGVkZ2VyKGxvbmcg\nbGVkZ2VySWQpIHRocm93cyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWls\nYWJsZUV4Y2VwdGlvbiB7CiAgICAgICAgTE9HLmRlYnVnKCJyZWxlYXNlTGVk\nZ2VyKGxlZGdlcklkPXt9KSIsIGxlZGdlcklkKTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBMb2NrIGwgPSBoZWxkTG9ja3MucmVtb3ZlKGxlZGdlcklk\nKTsKICAgICAgICAgICAgaWYgKGwgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgemtjLmRlbGV0ZShsLmdldExvY2taTm9kZSgpLCAtMSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGNhdGNoIChLZWVwZXJFeGNlcHRpb24uTm9Ob2Rl\nRXhjZXB0aW9uIG5uZSkgewogICAgICAgICAgICAvLyB0aGlzIGlzIG9rCiAg\nICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIExPRy5lcnJvcigiRXJyb3IgZGVsZXRpbmcgdW5kZXJyZXBsaWNhdGVk\nIGxlZGdlciBsb2NrIiwga2UpOwogICAgICAgICAgICB0aHJvdyBuZXcgUmVw\nbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRpb24oIkVycm9y\nIGNvbnRhY3Rpbmcgem9va2VlcGVyIiwga2UpOwogICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIFRocmVh\nZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2Vw\ndGlvbigiSW50ZXJydXB0ZWQgd2hpbGUgY29ubmVjdGluZyB6b29rZWVwZXIi\nLCBpZSk7CiAgICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgUmVwbGljYXRpb25FeGNlcHRpb24u\nVW5hdmFpbGFibGVFeGNlcHRpb24gewogICAgICAgIExPRy5kZWJ1ZygiY2xv\nc2UoKSIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoTWFwLkVu\ndHJ5PExvbmcsIExvY2s+IGUgOiBoZWxkTG9ja3MuZW50cnlTZXQoKSkgewog\nICAgICAgICAgICAgICAgemtjLmRlbGV0ZShlLmdldFZhbHVlKCkuZ2V0TG9j\na1pOb2RlKCksIC0xKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2gg\nKEtlZXBlckV4Y2VwdGlvbi5Ob05vZGVFeGNlcHRpb24gbm5lKSB7CiAgICAg\nICAgICAgIC8vIHRoaXMgaXMgb2sKICAgICAgICB9IGNhdGNoIChLZWVwZXJF\neGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBk\nZWxldGluZyB1bmRlcnJlcGxpY2F0ZWQgbGVkZ2VyIGxvY2siLCBrZSk7CiAg\nICAgICAgICAgIHRocm93IG5ldyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2\nYWlsYWJsZUV4Y2VwdGlvbigiRXJyb3IgY29udGFjdGluZyB6b29rZWVwZXIi\nLCBrZSk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24g\naWUpIHsKICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRl\ncnJ1cHQoKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFJlcGxpY2F0aW9uRXhj\nZXB0aW9uLlVuYXZhaWxhYmxlRXhjZXB0aW9uKCJJbnRlcnJ1cHRlZCB3aGls\nZSBjb25uZWN0aW5nIHpvb2tlZXBlciIsIGllKTsKICAgICAgICB9CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBkaXNhYmxlTGVkZ2Vy\nUmVwbGljYXRpb24oKQogICAgICAgICAgICB0aHJvd3MgUmVwbGljYXRpb25F\neGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRpb24gewogICAgICAgIExPRy5k\nZWJ1ZygiZGlzYWJsZUxlZGVnZXJSZXBsaWNhdGlvbigpIik7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgU3RyaW5nIHpub2RlID0gYmFzZVBhdGggKyAn\nLycgKyBCb29rS2VlcGVyQ29uc3RhbnRzLkRJU0FCTEVfTk9ERTsKICAgICAg\nICAgICAgemtjLmNyZWF0ZSh6bm9kZSwgIiIuZ2V0Qnl0ZXMoVVRGXzgpLCBJ\nZHMuT1BFTl9BQ0xfVU5TQUZFLCBDcmVhdGVNb2RlLlBFUlNJU1RFTlQpOwog\nICAgICAgICAgICBMT0cuaW5mbygiQXV0byBsZWRnZXIgcmUtcmVwbGljYXRp\nb24gaXMgZGlzYWJsZWQhIik7CiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhj\nZXB0aW9uLk5vZGVFeGlzdHNFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAg\nTE9HLndhcm4oIkF1dG9SZWNvdmVyeSBpcyBhbHJlYWR5IGRpc2FibGVkISIs\nIGtlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFJlcGxpY2F0aW9uRXhjZXB0\naW9uLlVuYXZhaWxhYmxlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAg\nICJBdXRvUmVjb3ZlcnkgaXMgYWxyZWFkeSBkaXNhYmxlZCEiLCBrZSk7CiAg\nICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAg\nICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHN0b3BwaW5nIGF1dG8g\nbGVkZ2VyIHJlLXJlcGxpY2F0aW9uIiwga2UpOwogICAgICAgICAgICB0aHJv\ndyBuZXcgUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRp\nb24oCiAgICAgICAgICAgICAgICAgICAgIkV4Y2VwdGlvbiB3aGlsZSBzdG9w\ncGluZyBhdXRvIGxlZGdlciByZS1yZXBsaWNhdGlvbiIsIGtlKTsKICAgICAg\nICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAg\nICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAg\nICAgICAgICB0aHJvdyBuZXcgUmVwbGljYXRpb25FeGNlcHRpb24uVW5hdmFp\nbGFibGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgIkludGVycnVw\ndGVkIHdoaWxlIHN0b3BwaW5nIGF1dG8gbGVkZ2VyIHJlLXJlcGxpY2F0aW9u\nIiwgaWUpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIGVuYWJsZUxlZGdlclJlcGxpY2F0aW9uKCkKICAgICAgICAg\nICAgdGhyb3dzIFJlcGxpY2F0aW9uRXhjZXB0aW9uLlVuYXZhaWxhYmxlRXhj\nZXB0aW9uIHsKICAgICAgICBMT0cuZGVidWcoImVuYWJsZUxlZGVnZXJSZXBs\naWNhdGlvbigpIik7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgemtjLmRl\nbGV0ZShiYXNlUGF0aCArICcvJyArIEJvb2tLZWVwZXJDb25zdGFudHMuRElT\nQUJMRV9OT0RFLCAtMSk7CiAgICAgICAgICAgIExPRy5pbmZvKCJSZXN1bWlu\nZyBhdXRvbWF0aWMgbGVkZ2VyIHJlLXJlcGxpY2F0aW9uIik7CiAgICAgICAg\nfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vTm9kZUV4Y2VwdGlvbiBrZSkg\newogICAgICAgICAgICBMT0cud2FybigiQXV0b1JlY292ZXJ5IGlzIGFscmVh\nZHkgZW5hYmxlZCEiLCBrZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBSZXBs\naWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbigKICAgICAg\nICAgICAgICAgICAgICAiQXV0b1JlY292ZXJ5IGlzIGFscmVhZHkgZW5hYmxl\nZCEiLCBrZSk7CiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGtl\nKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHJl\nc3VtaW5nIGxlZGdlciByZXBsaWNhdGlvbiIsIGtlKTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IFJlcGxpY2F0aW9uRXhjZXB0aW9uLlVuYXZhaWxhYmxlRXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICJFeGNlcHRpb24gd2hpbGUg\ncmVzdW1pbmcgYXV0byBsZWRnZXIgcmUtcmVwbGljYXRpb24iLCBrZSk7CiAg\nICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAg\nICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsK\nICAgICAgICAgICAgdGhyb3cgbmV3IFJlcGxpY2F0aW9uRXhjZXB0aW9uLlVu\nYXZhaWxhYmxlRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICJJbnRl\ncnJ1cHRlZCB3aGlsZSByZXN1bWluZyBhdXRvIGxlZGdlciByZS1yZXBsaWNh\ndGlvbiIsIGllKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBwdWJsaWMgYm9vbGVhbiBpc0xlZGdlclJlcGxpY2F0aW9uRW5hYmxlZCgp\nCiAgICAgICAgICAgIHRocm93cyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2\nYWlsYWJsZUV4Y2VwdGlvbiB7CiAgICAgICAgTE9HLmRlYnVnKCJpc0xlZGdl\nclJlcGxpY2F0aW9uRW5hYmxlZCgpIik7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaWYgKG51bGwgIT0gemtjLmV4aXN0cyhiYXNlUGF0aCArICcvJwog\nICAgICAgICAgICAgICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5ESVNB\nQkxFX05PREUsIGZhbHNlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICBMT0cuZXJyb3IoIkVycm9yIHdoaWxlIGNoZWNraW5nIHRoZSBzdGF0\nZSBvZiAiCiAgICAgICAgICAgICAgICAgICAgKyAibGVkZ2VyIHJlLXJlcGxp\nY2F0aW9uIiwga2UpOwogICAgICAgICAgICB0aHJvdyBuZXcgUmVwbGljYXRp\nb25FeGNlcHRpb24uVW5hdmFpbGFibGVFeGNlcHRpb24oCiAgICAgICAgICAg\nICAgICAgICAgIkVycm9yIGNvbnRhY3Rpbmcgem9va2VlcGVyIiwga2UpOwog\nICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAg\nICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7\nCiAgICAgICAgICAgIHRocm93IG5ldyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5V\nbmF2YWlsYWJsZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAiSW50\nZXJydXB0ZWQgd2hpbGUgY29udGFjdGluZyB6b29rZWVwZXIiLCBpZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQg\nbm90aWZ5TGVkZ2VyUmVwbGljYXRpb25FbmFibGVkKGZpbmFsIEdlbmVyaWND\nYWxsYmFjazxWb2lkPiBjYikKICAgICAgICAgICAgdGhyb3dzIFJlcGxpY2F0\naW9uRXhjZXB0aW9uLlVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAgICAgICBM\nT0cuZGVidWcoIm5vdGlmeUxlZGdlclJlcGxpY2F0aW9uRW5hYmxlZCgpIik7\nCiAgICAgICAgV2F0Y2hlciB3ID0gbmV3IFdhdGNoZXIoKSB7CiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGUpIHsKICAg\nICAgICAgICAgICAgIGlmIChlLmdldFR5cGUoKSA9PSBXYXRjaGVyLkV2ZW50\nLkV2ZW50VHlwZS5Ob2RlRGVsZXRlZCkgewogICAgICAgICAgICAgICAgICAg\nIGNiLm9wZXJhdGlvbkNvbXBsZXRlKDAsIG51bGwpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBpZiAobnVsbCA9PSB6a2MuZXhpc3RzKGJhc2VQYXRoICsg\nJy8nCiAgICAgICAgICAgICAgICAgICAgKyBCb29rS2VlcGVyQ29uc3RhbnRz\nLkRJU0FCTEVfTk9ERSwgdykpIHsKICAgICAgICAgICAgICAgIGNiLm9wZXJh\ndGlvbkNvbXBsZXRlKDAsIG51bGwpOwogICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0\naW9uIGtlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Igd2hpbGUg\nY2hlY2tpbmcgdGhlIHN0YXRlIG9mICIKICAgICAgICAgICAgICAgICAgICAr\nICJsZWRnZXIgcmUtcmVwbGljYXRpb24iLCBrZSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBSZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICAiRXJyb3IgY29udGFjdGluZyB6\nb29rZWVwZXIiLCBrZSk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJl\nYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgdGhyb3cgbmV3IFJlcGxp\nY2F0aW9uRXhjZXB0aW9uLlVuYXZhaWxhYmxlRXhjZXB0aW9uKAogICAgICAg\nICAgICAgICAgICAgICJJbnRlcnJ1cHRlZCB3aGlsZSBjb250YWN0aW5nIHpv\nb2tlZXBlciIsIGllKTsKICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

