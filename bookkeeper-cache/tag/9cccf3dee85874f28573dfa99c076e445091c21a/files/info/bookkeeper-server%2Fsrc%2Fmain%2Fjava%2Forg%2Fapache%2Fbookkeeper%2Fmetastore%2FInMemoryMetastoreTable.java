{"sha":"008ec2372b78829d40a9a2cad0357c20d3734129","node_id":"MDQ6QmxvYjE1NzU5NTY6MDA4ZWMyMzcyYjc4ODI5ZDQwYTlhMmNhZDAzNTdjMjBkMzczNDEyOQ==","size":13285,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/008ec2372b78829d40a9a2cad0357c20d3734129","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YXN0b3JlOwoKaW1wb3J0\nIGphdmEudXRpbC5OYXZpZ2FibGVNYXA7CmltcG9ydCBqYXZhLnV0aWwuU2V0\nOwppbXBvcnQgamF2YS51dGlsLlRyZWVNYXA7CmltcG9ydCBqYXZhLnV0aWwu\nY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5NU0V4Y2VwdGlvbi5Db2RlOwpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnZlcnNpb25pbmcuVmVyc2lv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci52ZXJzaW9uaW5nLlZl\ncnNpb25lZDsKCnB1YmxpYyBjbGFzcyBJbk1lbW9yeU1ldGFzdG9yZVRhYmxl\nIGltcGxlbWVudHMgTWV0YXN0b3JlU2Nhbm5hYmxlVGFibGUgewoKICAgIHB1\nYmxpYyBzdGF0aWMgY2xhc3MgTWV0YWRhdGFWZXJzaW9uIGltcGxlbWVudHMg\nVmVyc2lvbiB7CiAgICAgICAgaW50IHZlcnNpb247CgogICAgICAgIHB1Ymxp\nYyBNZXRhZGF0YVZlcnNpb24oaW50IHYpIHsKICAgICAgICAgICAgdGhpcy52\nZXJzaW9uID0gdjsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBNZXRhZGF0\nYVZlcnNpb24oTWV0YWRhdGFWZXJzaW9uIHYpIHsKICAgICAgICAgICAgdGhp\ncy52ZXJzaW9uID0gdi52ZXJzaW9uOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIHN5bmNocm9uaXplZCBNZXRhZGF0YVZlcnNpb24gaW5jcmVtZW50VmVy\nc2lvbigpIHsKICAgICAgICAgICAgKyt2ZXJzaW9uOwogICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAg\nICAgIHB1YmxpYyBPY2N1cnJlZCBjb21wYXJlKFZlcnNpb24gdikgewogICAg\nICAgICAgICBpZiAobnVsbCA9PSB2KSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oIlZlcnNpb24gaXMgbm90IGFs\nbG93ZWQgdG8gYmUgbnVsbC4iKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAodiA9PSBWZXJzaW9uLk5FVykgewogICAgICAgICAgICAgICAgcmV0\ndXJuIE9jY3VycmVkLkFGVEVSOwogICAgICAgICAgICB9IGVsc2UgaWYgKHYg\nPT0gVmVyc2lvbi5BTlkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBPY2N1\ncnJlZC5DT05DVVJSRU5UTFk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoISh2\nIGluc3RhbmNlb2YgTWV0YWRhdGFWZXJzaW9uKSkgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigiSW52YWxp\nZCB2ZXJzaW9uIHR5cGUiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBN\nZXRhZGF0YVZlcnNpb24gbXYgPSAoTWV0YWRhdGFWZXJzaW9uKXY7CiAgICAg\nICAgICAgIGludCByZXMgPSB2ZXJzaW9uIC0gbXYudmVyc2lvbjsKICAgICAg\nICAgICAgaWYgKHJlcyA9PSAwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4g\nT2NjdXJyZWQuQ09OQ1VSUkVOVExZOwogICAgICAgICAgICB9IGVsc2UgaWYg\nKHJlcyA8IDApIHsKICAgICAgICAgICAgICAgIHJldHVybiBPY2N1cnJlZC5C\nRUZPUkU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm4gT2NjdXJyZWQuQUZURVI7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGVx\ndWFscyhPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIGlmIChudWxsID09IG9i\naiB8fAogICAgICAgICAgICAgICAgIShvYmogaW5zdGFuY2VvZiBNZXRhZGF0\nYVZlcnNpb24pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgTWV0YWRhdGFWZXJzaW9uIHYgPSAo\nTWV0YWRhdGFWZXJzaW9uKW9iajsKICAgICAgICAgICAgcmV0dXJuIDAgPT0g\nKHZlcnNpb24gLSB2LnZlcnNpb24pOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygpIHsKICAg\nICAgICAgICAgcmV0dXJuICJ2ZXJzaW9uPSIgKyB2ZXJzaW9uOwogICAgICAg\nIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBoYXNo\nQ29kZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHZlcnNpb247CiAgICAgICAg\nfQogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIG5hbWU7CiAgICBwcml2YXRl\nIFRyZWVNYXA8U3RyaW5nLCBWZXJzaW9uZWQ8VmFsdWU+PiBtYXAgPSBudWxs\nOwogICAgcHJpdmF0ZSBUcmVlTWFwPFN0cmluZywgTWV0YXN0b3JlV2F0Y2hl\ncj4gd2F0Y2hlck1hcCA9IG51bGw7CiAgICBwcml2YXRlIFNjaGVkdWxlZEV4\nZWN1dG9yU2VydmljZSBzY2hlZHVsZXI7CgogICAgcHVibGljIEluTWVtb3J5\nTWV0YXN0b3JlVGFibGUoSW5NZW1vcnlNZXRhU3RvcmUgbWV0YXN0b3JlLCBT\ndHJpbmcgbmFtZSkgewogICAgICAgIHRoaXMubWFwID0gbmV3IFRyZWVNYXA8\nU3RyaW5nLCBWZXJzaW9uZWQ8VmFsdWU+PigpOwogICAgICAgIHRoaXMud2F0\nY2hlck1hcCA9IG5ldyBUcmVlTWFwPFN0cmluZyxNZXRhc3RvcmVXYXRjaGVy\nPigpOwogICAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgICAgdGhpcy5z\nY2hlZHVsZXIgPSBFeGVjdXRvcnMubmV3U2luZ2xlVGhyZWFkU2NoZWR1bGVk\nRXhlY3V0b3IoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBT\ndHJpbmcgZ2V0TmFtZSAoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMubmFtZTsK\nICAgIH0KCiAgICBzdGF0aWMgVmVyc2lvbmVkPFZhbHVlPiBjbG9uZVZhbHVl\nKFZhbHVlIHZhbHVlLCBWZXJzaW9uIHZlcnNpb24sIFNldDxTdHJpbmc+IGZp\nZWxkcykgewogICAgICAgIGlmIChudWxsICE9IHZhbHVlKSB7CiAgICAgICAg\nICAgIFZhbHVlIG5ld1ZhbHVlID0gbmV3IFZhbHVlKCk7CiAgICAgICAgICAg\nIGlmIChBTExfRklFTERTID09IGZpZWxkcykgewogICAgICAgICAgICAgICAg\nZmllbGRzID0gdmFsdWUuZ2V0RmllbGRzKCk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZm9yIChTdHJpbmcgZiA6IGZpZWxkcykgewogICAgICAgICAg\nICAgICAgbmV3VmFsdWUuc2V0RmllbGQoZiwgdmFsdWUuZ2V0RmllbGQoZikp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhbHVlID0gbmV3VmFsdWU7\nCiAgICAgICAgfQoKICAgICAgICBpZiAobnVsbCA9PSB2ZXJzaW9uKSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigiVmVy\nc2lvbiBpc24ndCBhbGxvd2VkIHRvIGJlIG51bGwuIik7CiAgICAgICAgfQog\nICAgICAgIGlmIChWZXJzaW9uLkFOWSAhPSB2ZXJzaW9uICYmIFZlcnNpb24u\nTkVXICE9IHZlcnNpb24pIHsKICAgICAgICAgICAgaWYgKHZlcnNpb24gaW5z\ndGFuY2VvZiBNZXRhZGF0YVZlcnNpb24pIHsKICAgICAgICAgICAgICAgIHZl\ncnNpb24gPSBuZXcgTWV0YWRhdGFWZXJzaW9uKCgoTWV0YWRhdGFWZXJzaW9u\nKXZlcnNpb24pLnZlcnNpb24pOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigi\nV3JvbmcgdmVyc2lvbiB0eXBlLiIpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBuZXcgVmVyc2lvbmVkPFZhbHVlPih2YWx1ZSwg\ndmVyc2lvbik7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9p\nZCBnZXQoZmluYWwgU3RyaW5nIGtleSwgZmluYWwgTWV0YXN0b3JlQ2FsbGJh\nY2s8VmVyc2lvbmVkPFZhbHVlPj4gY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBzY2hlZHVsZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1\nbigpIHsKICAgICAgICAgICAgICAgIHNjaGVkdWxlR2V0KGtleSwgQUxMX0ZJ\nRUxEUywgY2IsIGN0eCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAg\nIH0KICAgIAogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBnZXQoZmlu\nYWwgU3RyaW5nIGtleSwgZmluYWwgTWV0YXN0b3JlV2F0Y2hlciB3YXRjaGVy\nLCBmaW5hbCBNZXRhc3RvcmVDYWxsYmFjazxWZXJzaW9uZWQ8VmFsdWU+PiBj\nYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIHNjaGVkdWxlci5zdWJt\naXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAg\nc2NoZWR1bGVHZXQoa2V5LCBBTExfRklFTERTLCBjYiwgY3R4KTsKICAgICAg\nICAgICAgICAgIHN5bmNocm9uaXplZCh3YXRjaGVyTWFwKSB7CiAgICAgICAg\nICAgICAgICAgICAgd2F0Y2hlck1hcC5wdXQoIGtleSwgd2F0Y2hlciApOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBnZXQoZmluYWwg\nU3RyaW5nIGtleSwgZmluYWwgU2V0PFN0cmluZz4gZmllbGRzLCBmaW5hbCBN\nZXRhc3RvcmVDYWxsYmFjazxWZXJzaW9uZWQ8VmFsdWU+PiBjYiwKICAgICAg\nICAgICAgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIHNjaGVkdWxlci5z\ndWJtaXQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAg\nICAgc2NoZWR1bGVHZXQoa2V5LCBmaWVsZHMsIGNiLCBjdHgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfSk7CiAgICB9CgogICAgcHVibGljIHN5bmNocm9u\naXplZCB2b2lkIHNjaGVkdWxlR2V0KFN0cmluZyBrZXksIFNldDxTdHJpbmc+\nIGZpZWxkcywgTWV0YXN0b3JlQ2FsbGJhY2s8VmVyc2lvbmVkPFZhbHVlPj4g\nY2IsCiAgICAgICAgICAgIE9iamVjdCBjdHgpIHsKICAgICAgICBpZiAobnVs\nbCA9PSBrZXkpIHsKICAgICAgICAgICAgY2IuY29tcGxldGUoQ29kZS5JbGxl\nZ2FsT3AuZ2V0Q29kZSgpLCBudWxsLCBjdHgpOwogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQogICAgICAgIFZlcnNpb25lZDxWYWx1ZT4gdnYgPSBn\nZXQoa2V5KTsKICAgICAgICBpbnQgcmMgPSBudWxsID09IHZ2ID8gQ29kZS5O\nb0tleS5nZXRDb2RlKCkgOiBDb2RlLk9LLmdldENvZGUoKTsKICAgICAgICBp\nZiAodnYgIT0gbnVsbCkgewogICAgICAgICAgICB2diA9IGNsb25lVmFsdWUo\ndnYuZ2V0VmFsdWUoKSwgdnYuZ2V0VmVyc2lvbigpLCBmaWVsZHMpOwogICAg\nICAgIH0KICAgICAgICBjYi5jb21wbGV0ZShyYywgdnYsIGN0eCk7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBwdXQoZmluYWwgU3Ry\naW5nIGtleSwgZmluYWwgVmFsdWUgdmFsdWUsIGZpbmFsIFZlcnNpb24gdmVy\nc2lvbiwgZmluYWwgTWV0YXN0b3JlQ2FsbGJhY2s8VmVyc2lvbj4gY2IsCiAg\nICAgICAgICAgIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBzY2hlZHVs\nZXIuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAg\nICAgICAgIGlmIChudWxsID09IGtleSB8fCBudWxsID09IHZhbHVlIHx8IG51\nbGwgPT0gdmVyc2lvbikgewogICAgICAgICAgICAgICAgICAgIGNiLmNvbXBs\nZXRlKENvZGUuSWxsZWdhbE9wLmdldENvZGUoKSwgbnVsbCwgY3R4KTsKICAg\nICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBSZXN1bHQ8VmVyc2lvbj4gcmVzdWx0ID0gcHV0KGtl\neSwgdmFsdWUsIHZlcnNpb24pOwogICAgICAgICAgICAgICAgY2IuY29tcGxl\ndGUocmVzdWx0LmNvZGUuZ2V0Q29kZSgpLCByZXN1bHQudmFsdWUsIGN0eCk7\nCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8qCiAgICAgICAg\nICAgICAgICAgKiBJZiB0aGVyZSBpcyBhIHdhdGNoZXIgc2V0IGZvciB0aGlz\nIGtleSwgd2UgbmVlZAogICAgICAgICAgICAgICAgICogdG8gdHJpZ2dlciBp\ndC4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaWYocmVz\ndWx0LmNvZGUgPT0gTVNFeGNlcHRpb24uQ29kZS5PSyl7CiAgICAgICAgICAg\nICAgICAgICAgdHJpZ2dlcldhdGNoKGtleSwgTVNXYXRjaGVkRXZlbnQuRXZl\nbnRUeXBlLkNIQU5HRUQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfSk7CiAgICB9CiAgICAKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgcmVtb3ZlKGZpbmFsIFN0cmluZyBrZXksIGZpbmFsIFZl\ncnNpb24gdmVyc2lvbiwgZmluYWwgTWV0YXN0b3JlQ2FsbGJhY2s8Vm9pZD4g\nY2IsIGZpbmFsIE9iamVjdCBjdHgpIHsKICAgICAgICBzY2hlZHVsZXIuc3Vi\nbWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAg\nIGlmIChudWxsID09IGtleSB8fCBudWxsID09IHZlcnNpb24pIHsKICAgICAg\nICAgICAgICAgICAgICBjYi5jb21wbGV0ZShDb2RlLklsbGVnYWxPcC5nZXRD\nb2RlKCksIG51bGwsIGN0eCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgQ29kZSBjb2Rl\nID0gcmVtb3ZlKGtleSwgdmVyc2lvbik7CiAgICAgICAgICAgICAgICBjYi5j\nb21wbGV0ZShjb2RlLmdldENvZGUoKSwgbnVsbCwgY3R4KTsKICAgICAgICAg\nICAgICAgIAogICAgICAgICAgICAgICAgaWYoY29kZSA9PSBNU0V4Y2VwdGlv\nbi5Db2RlLk9LKXsKICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyV2F0Y2go\na2V5LCBNU1dhdGNoZWRFdmVudC5FdmVudFR5cGUuUkVNT1ZFRCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0K\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIG9wZW5DdXJzb3IoTWV0\nYXN0b3JlQ2FsbGJhY2s8TWV0YXN0b3JlQ3Vyc29yPiBjYiwgT2JqZWN0IGN0\neCkgewogICAgICAgIG9wZW5DdXJzb3IoRU1QVFlfU1RBUlRfS0VZLCB0cnVl\nLCBFTVBUWV9FTkRfS0VZLCB0cnVlLCBPcmRlci5BU0MsCiAgICAgICAgICAg\nICAgICAgICBBTExfRklFTERTLCBjYiwgY3R4KTsKICAgIH0KCiAgICBAT3Zl\ncnJpZGUKICAgIHB1YmxpYyB2b2lkIG9wZW5DdXJzb3IoU2V0PFN0cmluZz4g\nZmllbGRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICBNZXRhc3RvcmVD\nYWxsYmFjazxNZXRhc3RvcmVDdXJzb3I+IGNiLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgb3BlbkN1cnNvcihFTVBUWV9TVEFSVF9LRVksIHRydWUsIEVNUFRZ\nX0VORF9LRVksIHRydWUsIE9yZGVyLkFTQywKICAgICAgICAgICAgICAgICAg\nIGZpZWxkcywgY2IsIGN0eCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBvcGVuQ3Vyc29yKFN0cmluZyBmaXJzdEtleSwgYm9vbGVh\nbiBmaXJzdEluY2x1c2l2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nU3RyaW5nIGxhc3RLZXksIGJvb2xlYW4gbGFzdEluY2x1c2l2ZSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgT3JkZXIgb3JkZXIsIE1ldGFzdG9yZUNh\nbGxiYWNrPE1ldGFzdG9yZUN1cnNvcj4gY2IsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgIE9iamVjdCBjdHgpIHsKICAgICAgICBvcGVuQ3Vyc29yKGZp\ncnN0S2V5LCBmaXJzdEluY2x1c2l2ZSwgbGFzdEtleSwgbGFzdEluY2x1c2l2\nZSwKICAgICAgICAgICAgICAgICAgIG9yZGVyLCBBTExfRklFTERTLCBjYiwg\nY3R4KTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIG9w\nZW5DdXJzb3IoZmluYWwgU3RyaW5nIGZpcnN0S2V5LCBmaW5hbCBib29sZWFu\nIGZpcnN0SW5jbHVzaXZlLAogICAgICAgICAgICAgICAgICAgICAgICAgICBm\naW5hbCBTdHJpbmcgbGFzdEtleSwgZmluYWwgYm9vbGVhbiBsYXN0SW5jbHVz\naXZlLAogICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBPcmRlciBv\ncmRlciwgZmluYWwgU2V0PFN0cmluZz4gZmllbGRzLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICBmaW5hbCBNZXRhc3RvcmVDYWxsYmFjazxNZXRhc3Rv\ncmVDdXJzb3I+IGNiLCBmaW5hbCBPYmplY3QgY3R4KSB7CiAgICAgICAgc2No\nZWR1bGVyLnN1Ym1pdChuZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAg\nICAgICAgICAgICBSZXN1bHQ8TWV0YXN0b3JlQ3Vyc29yPiByZXN1bHQgPSBv\ncGVuQ3Vyc29yKGZpcnN0S2V5LCBmaXJzdEluY2x1c2l2ZSwgbGFzdEtleSwg\nbGFzdEluY2x1c2l2ZSwKICAgICAgICAgICAgICAgICAgICAgICAgb3JkZXIs\nIGZpZWxkcyk7CiAgICAgICAgICAgICAgICBjYi5jb21wbGV0ZShyZXN1bHQu\nY29kZS5nZXRDb2RlKCksIHJlc3VsdC52YWx1ZSwgY3R4KTsKICAgICAgICAg\nICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB0cmln\nZ2VyV2F0Y2goU3RyaW5nIGtleSwgTVNXYXRjaGVkRXZlbnQuRXZlbnRUeXBl\nIHR5cGUpIHsKICAgICAgICBzeW5jaHJvbml6ZWQod2F0Y2hlck1hcCl7CiAg\nICAgICAgICAgIGlmKHdhdGNoZXJNYXAuY29udGFpbnNLZXkoIGtleSApKSB7\nCiAgICAgICAgICAgICAgICBNU1dhdGNoZWRFdmVudCBldmVudCA9IG5ldyBN\nU1dhdGNoZWRFdmVudChrZXksIHR5cGUpOwogICAgICAgICAgICAgICAgd2F0\nY2hlck1hcC5nZXQoIGtleSApLnByb2Nlc3MoIGV2ZW50ICk7CiAgICAgICAg\nICAgICAgICB3YXRjaGVyTWFwLnJlbW92ZSgga2V5ICk7CiAgICAgICAgICAg\nIH0KICAgICAgICB9CiAgICB9CiAgICAKICAgIHByaXZhdGUgc3luY2hyb25p\nemVkIFZlcnNpb25lZDxWYWx1ZT4gZ2V0KFN0cmluZyBrZXkpIHsKICAgICAg\nICByZXR1cm4gbWFwLmdldChrZXkpOwogICAgfQoKICAgIHByaXZhdGUgc3lu\nY2hyb25pemVkIENvZGUgcmVtb3ZlKFN0cmluZyBrZXksIFZlcnNpb24gdmVy\nc2lvbikgewogICAgICAgIFZlcnNpb25lZDxWYWx1ZT4gdnYgPSBtYXAuZ2V0\nKGtleSk7CiAgICAgICAgaWYgKG51bGwgPT0gdnYpIHsKICAgICAgICAgICAg\ncmV0dXJuIENvZGUuTm9LZXk7CiAgICAgICAgfQogICAgICAgIGlmIChWZXJz\naW9uLk9jY3VycmVkLkNPTkNVUlJFTlRMWSAhPSB2di5nZXRWZXJzaW9uKCku\nY29tcGFyZSh2ZXJzaW9uKSkgewogICAgICAgICAgICByZXR1cm4gQ29kZS5C\nYWRWZXJzaW9uOwogICAgICAgIH0KICAgICAgICBtYXAucmVtb3ZlKGtleSk7\nCiAgICAgICAgcmV0dXJuIENvZGUuT0s7CiAgICB9CgogICAgc3RhdGljIGNs\nYXNzIFJlc3VsdDxUPiB7CiAgICAgICAgQ29kZSBjb2RlOwogICAgICAgIFQg\ndmFsdWU7CgogICAgICAgIHB1YmxpYyBSZXN1bHQoQ29kZSBjb2RlLCBUIHZh\nbHVlKSB7CiAgICAgICAgICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgICAgICAg\nICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICB9CiAgICB9CgogICAg\ncHJpdmF0ZSBzeW5jaHJvbml6ZWQgUmVzdWx0PFZlcnNpb24+IHB1dChTdHJp\nbmcga2V5LCBWYWx1ZSB2YWx1ZSwgVmVyc2lvbiB2ZXJzaW9uKSB7CiAgICAg\nICAgVmVyc2lvbmVkPFZhbHVlPiB2diA9IG1hcC5nZXQoa2V5KTsKICAgICAg\nICBpZiAodnYgPT0gbnVsbCkgewogICAgICAgICAgICBpZiAoVmVyc2lvbi5O\nRVcgIT0gdmVyc2lvbikgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBS\nZXN1bHQ8VmVyc2lvbj4oQ29kZS5Ob0tleSwgbnVsbCk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgdnYgPSBjbG9uZVZhbHVlKHZhbHVlLCB2ZXJzaW9u\nLCBBTExfRklFTERTKTsKICAgICAgICAgICAgdnYuc2V0VmVyc2lvbihuZXcg\nTWV0YWRhdGFWZXJzaW9uKDApKTsKICAgICAgICAgICAgbWFwLnB1dChrZXks\nIHZ2KTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQ8VmVyc2lvbj4o\nQ29kZS5PSywgbmV3IE1ldGFkYXRhVmVyc2lvbigwKSk7CiAgICAgICAgfQog\nICAgICAgIGlmIChWZXJzaW9uLk5FVyA9PSB2ZXJzaW9uKSB7CiAgICAgICAg\nICAgIHJldHVybiBuZXcgUmVzdWx0PFZlcnNpb24+KENvZGUuS2V5RXhpc3Rz\nLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgaWYgKFZlcnNpb24uT2NjdXJy\nZWQuQ09OQ1VSUkVOVExZICE9IHZ2LmdldFZlcnNpb24oKS5jb21wYXJlKHZl\ncnNpb24pKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzdWx0PFZlcnNp\nb24+KENvZGUuQmFkVmVyc2lvbiwgbnVsbCk7CiAgICAgICAgfQogICAgICAg\nIHZ2LnNldFZlcnNpb24oKChNZXRhZGF0YVZlcnNpb24pdnYuZ2V0VmVyc2lv\nbigpKS5pbmNyZW1lbnRWZXJzaW9uKCkpOwogICAgICAgIHZ2LnNldFZhbHVl\nKHZ2LmdldFZhbHVlKCkubWVyZ2UodmFsdWUpKTsKICAgICAgICByZXR1cm4g\nbmV3IFJlc3VsdDxWZXJzaW9uPihDb2RlLk9LLCBuZXcgTWV0YWRhdGFWZXJz\naW9uKChNZXRhZGF0YVZlcnNpb24pdnYuZ2V0VmVyc2lvbigpKSk7CiAgICB9\nCgogICAgcHJpdmF0ZSBzeW5jaHJvbml6ZWQgUmVzdWx0PE1ldGFzdG9yZUN1\ncnNvcj4gb3BlbkN1cnNvcigKICAgICAgICAgICAgU3RyaW5nIGZpcnN0S2V5\nLCBib29sZWFuIGZpcnN0SW5jbHVzaXZlLAogICAgICAgICAgICBTdHJpbmcg\nbGFzdEtleSwgYm9vbGVhbiBsYXN0SW5jbHVzaXZlLAogICAgICAgICAgICBP\ncmRlciBvcmRlciwgU2V0PFN0cmluZz4gZmllbGRzKSB7CiAgICAgICAgaWYg\nKDAgPT0gbWFwLnNpemUoKSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFJl\nc3VsdDxNZXRhc3RvcmVDdXJzb3I+KENvZGUuT0ssIE1ldGFzdG9yZUN1cnNv\nci5FTVBUWV9DVVJTT1IpOwogICAgICAgIH0KCiAgICAgICAgYm9vbGVhbiBp\nc0xlZ2FsQ3Vyc29yID0gZmFsc2U7CiAgICAgICAgTmF2aWdhYmxlTWFwPFN0\ncmluZywgVmVyc2lvbmVkPFZhbHVlPj4gbXlNYXAgPSBudWxsOwogICAgICAg\nIGlmIChPcmRlci5BU0MgPT0gb3JkZXIpIHsKICAgICAgICAgICAgbXlNYXAg\nPSBtYXA7CiAgICAgICAgICAgIGlmIChFTVBUWV9FTkRfS0VZID09IGxhc3RL\nZXkgfHwKICAgICAgICAgICAgICAgIGxhc3RLZXkuY29tcGFyZVRvKG15TWFw\nLmxhc3RLZXkoKSkgPiAwKSB7CiAgICAgICAgICAgICAgICBsYXN0S2V5ID0g\nbXlNYXAubGFzdEtleSgpOwogICAgICAgICAgICAgICAgbGFzdEluY2x1c2l2\nZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKEVNUFRZ\nX1NUQVJUX0tFWSA9PSBmaXJzdEtleSB8fAogICAgICAgICAgICAgICAgZmly\nc3RLZXkuY29tcGFyZVRvKG15TWFwLmZpcnN0S2V5KCkpIDwgMCkgewogICAg\nICAgICAgICAgICAgZmlyc3RLZXkgPSBteU1hcC5maXJzdEtleSgpOwogICAg\nICAgICAgICAgICAgZmlyc3RJbmNsdXNpdmUgPSB0cnVlOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGlmIChmaXJzdEtleS5jb21wYXJlVG8obGFzdEtl\neSkgPD0gMCkgewogICAgICAgICAgICAgICAgaXNMZWdhbEN1cnNvciA9IHRy\ndWU7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKE9yZGVyLkRF\nU0MgPT0gb3JkZXIpIHsKICAgICAgICAgICAgbXlNYXAgPSBtYXAuZGVzY2Vu\nZGluZ01hcCgpOwogICAgICAgICAgICBpZiAoRU1QVFlfU1RBUlRfS0VZID09\nIGxhc3RLZXkgfHwKICAgICAgICAgICAgICAgIGxhc3RLZXkuY29tcGFyZVRv\nKG15TWFwLmxhc3RLZXkoKSkgPCAwKSB7CiAgICAgICAgICAgICAgICBsYXN0\nS2V5ID0gbXlNYXAubGFzdEtleSgpOwogICAgICAgICAgICAgICAgbGFzdElu\nY2x1c2l2ZSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKEVNUFRZX0VORF9LRVkgPT0gZmlyc3RLZXkgfHwKICAgICAgICAgICAgICAg\nIGZpcnN0S2V5LmNvbXBhcmVUbyhteU1hcC5maXJzdEtleSgpKSA+IDApIHsK\nICAgICAgICAgICAgICAgIGZpcnN0S2V5ID0gbXlNYXAuZmlyc3RLZXkoKTsK\nICAgICAgICAgICAgICAgIGZpcnN0SW5jbHVzaXZlID0gdHJ1ZTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBpZiAoZmlyc3RLZXkuY29tcGFyZVRvKGxh\nc3RLZXkpID49IDApIHsKICAgICAgICAgICAgICAgIGlzTGVnYWxDdXJzb3Ig\nPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAo\nIWlzTGVnYWxDdXJzb3IgfHwgbnVsbCA9PSBteU1hcCkgewogICAgICAgICAg\nICByZXR1cm4gbmV3IFJlc3VsdDxNZXRhc3RvcmVDdXJzb3I+KENvZGUuSWxs\nZWdhbE9wLCBudWxsKTsKICAgICAgICB9CiAgICAgICAgTWV0YXN0b3JlQ3Vy\nc29yIGN1cnNvciA9IG5ldyBJbk1lbW9yeU1ldGFzdG9yZUN1cnNvcigKICAg\nICAgICAgICAgICAgIG15TWFwLnN1Yk1hcChmaXJzdEtleSwgZmlyc3RJbmNs\ndXNpdmUsIGxhc3RLZXksIGxhc3RJbmNsdXNpdmUpLCBmaWVsZHMsIHNjaGVk\ndWxlcik7CiAgICAgICAgcmV0dXJuIG5ldyBSZXN1bHQ8TWV0YXN0b3JlQ3Vy\nc29yPihDb2RlLk9LLCBjdXJzb3IpOwogICAgfQoKICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgY2xvc2UoKSB7CiAgICAgICAgLy8gZG8gbm90aGlu\nZwogICAgfQp9Cg==\n","encoding":"base64"}

