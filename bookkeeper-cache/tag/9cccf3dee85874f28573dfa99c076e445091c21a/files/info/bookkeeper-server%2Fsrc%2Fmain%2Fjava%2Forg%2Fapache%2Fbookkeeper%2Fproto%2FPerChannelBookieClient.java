{"sha":"df48c9758dac4c7830cf2a104fae655d9ecb4959","node_id":"MDQ6QmxvYjE1NzU5NTY6ZGY0OGM5NzU4ZGFjNGM3ODMwY2YyYTEwNGZhZTY1NWQ5ZWNiNDk1OQ==","size":33742,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/df48c9758dac4c7830cf2a104fae655d9ecb4959","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG87CgppbXBvcnQgamF2\nYS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRB\nZGRyZXNzOwppbXBvcnQgamF2YS5uaW8uY2hhbm5lbHMuQ2xvc2VkQ2hhbm5l\nbEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5BcnJheURlcXVlOwppbXBv\ncnQgamF2YS51dGlsLlF1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJl\nbnQuQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5TY2hlZHVsZWRFeGVjdXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNMb25nOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVByb3RvY29s\nLlBhY2tldEhlYWRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuR2VuZXJpY0NhbGxi\nYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tr\nZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5SZWFkRW50cnlDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50\nZXJuYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci51dGlsLk1hdGhVdGlsczsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci51dGlsLk9yZGVyZWRTYWZlRXhlY3V0b3I7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5TYWZlUnVubmFibGU7Cmlt\ncG9ydCBvcmcuamJvc3MubmV0dHkuYm9vdHN0cmFwLkNsaWVudEJvb3RzdHJh\ncDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZl\ncjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZl\ncnM7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsOwpp\nbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbEZ1dHVyZTsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxGdXR1cmVM\naXN0ZW5lcjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5u\nZWxIYW5kbGVyQ29udGV4dDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFu\nbmVsLkNoYW5uZWxQaXBlbGluZTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5j\naGFubmVsLkNoYW5uZWxQaXBlbGluZUNvdmVyYWdlOwppbXBvcnQgb3JnLmpi\nb3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbFBpcGVsaW5lRmFjdG9yeTsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxTdGF0ZUV2ZW50\nOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbHM7Cmlt\ncG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5FeGNlcHRpb25FdmVudDsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLk1lc3NhZ2VFdmVudDsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLlNpbXBsZUNoYW5uZWxI\nYW5kbGVyOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuc29ja2V0\nLkNsaWVudFNvY2tldENoYW5uZWxGYWN0b3J5OwppbXBvcnQgb3JnLmpib3Nz\nLm5ldHR5LmhhbmRsZXIuY29kZWMuZnJhbWUuQ29ycnVwdGVkRnJhbWVFeGNl\ncHRpb247CmltcG9ydCBvcmcuamJvc3MubmV0dHkuaGFuZGxlci5jb2RlYy5m\ncmFtZS5MZW5ndGhGaWVsZEJhc2VkRnJhbWVEZWNvZGVyOwppbXBvcnQgb3Jn\nLmpib3NzLm5ldHR5LmhhbmRsZXIuY29kZWMuZnJhbWUuVG9vTG9uZ0ZyYW1l\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmhhbmRsZXIudGlt\nZW91dC5SZWFkVGltZW91dEhhbmRsZXI7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICog\nVGhpcyBjbGFzcyBtYW5hZ2VzIGFsbCBkZXRhaWxzIG9mIGNvbm5lY3Rpb24g\ndG8gYSBwYXJ0aWN1bGFyIGJvb2tpZS4gSXQgYWxzbwogKiBoYXMgcmVjb25u\nZWN0IGxvZ2ljIGlmIGEgY29ubmVjdGlvbiB0byBhIGJvb2tpZSBmYWlscy4K\nICoKICovCgpAQ2hhbm5lbFBpcGVsaW5lQ292ZXJhZ2UoIm9uZSIpCnB1Ymxp\nYyBjbGFzcyBQZXJDaGFubmVsQm9va2llQ2xpZW50IGV4dGVuZHMgU2ltcGxl\nQ2hhbm5lbEhhbmRsZXIgaW1wbGVtZW50cyBDaGFubmVsUGlwZWxpbmVGYWN0\nb3J5IHsKCiAgICBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9IExvZ2dlckZh\nY3RvcnkuZ2V0TG9nZ2VyKFBlckNoYW5uZWxCb29raWVDbGllbnQuY2xhc3Mp\nOwoKICAgIHN0YXRpYyBmaW5hbCBsb25nIG1heE1lbW9yeSA9IFJ1bnRpbWUu\nZ2V0UnVudGltZSgpLm1heE1lbW9yeSgpIC8gNTsKICAgIHB1YmxpYyBzdGF0\naWMgZmluYWwgaW50IE1BWF9GUkFNRV9MRU5HVEggPSAyICogMTAyNCAqIDEw\nMjQ7IC8vIDJNCgogICAgSW5ldFNvY2tldEFkZHJlc3MgYWRkcjsKICAgIEF0\nb21pY0xvbmcgdG90YWxCeXRlc091dHN0YW5kaW5nOwogICAgQ2xpZW50U29j\na2V0Q2hhbm5lbEZhY3RvcnkgY2hhbm5lbEZhY3Rvcnk7CiAgICBPcmRlcmVk\nU2FmZUV4ZWN1dG9yIGV4ZWN1dG9yOwogICAgU2NoZWR1bGVkRXhlY3V0b3JT\nZXJ2aWNlIHRpbWVvdXRFeGVjdXRvcjsKCiAgICBDb25jdXJyZW50SGFzaE1h\ncDxDb21wbGV0aW9uS2V5LCBBZGRDb21wbGV0aW9uPiBhZGRDb21wbGV0aW9u\ncyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBBZGRD\nb21wbGV0aW9uPigpOwogICAgQ29uY3VycmVudEhhc2hNYXA8Q29tcGxldGlv\nbktleSwgUmVhZENvbXBsZXRpb24+IHJlYWRDb21wbGV0aW9ucyA9IG5ldyBD\nb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBSZWFkQ29tcGxldGlv\nbj4oKTsKCiAgICAvKioKICAgICAqIFRoZSBmb2xsb3dpbmcgbWVtYmVyIHZh\ncmlhYmxlcyBkbyBub3QgbmVlZCB0byBiZSBjb25jdXJyZW50LCBvciB2b2xh\ndGlsZQogICAgICogYmVjYXVzZSB0aGV5IGFyZSBhbHdheXMgdXBkYXRlZCB1\nbmRlciBhIGxvY2sKICAgICAqLwogICAgUXVldWU8R2VuZXJpY0NhbGxiYWNr\nPFZvaWQ+PiBwZW5kaW5nT3BzID0gbmV3IEFycmF5RGVxdWU8R2VuZXJpY0Nh\nbGxiYWNrPFZvaWQ+PigpOwogICAgdm9sYXRpbGUgQ2hhbm5lbCBjaGFubmVs\nID0gbnVsbDsKCiAgICBwcml2YXRlIGNsYXNzIFRpbWVvdXRUYXNrIGltcGxl\nbWVudHMgUnVubmFibGUgewogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1\nYmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgZXJyb3JPdXRUaW1lZE91\ndEVudHJpZXMoKTsKICAgICAgICB9CiAgICB9CgogICAgZW51bSBDb25uZWN0\naW9uU3RhdGUgewogICAgICAgIERJU0NPTk5FQ1RFRCwgQ09OTkVDVElORywg\nQ09OTkVDVEVELCBDTE9TRUQKICAgIH07CgogICAgdm9sYXRpbGUgQ29ubmVj\ndGlvblN0YXRlIHN0YXRlOwogICAgcHJpdmF0ZSBmaW5hbCBDbGllbnRDb25m\naWd1cmF0aW9uIGNvbmY7CgogICAgLyoqCiAgICAgKiBFcnJvciBvdXQgYW55\nIGVudHJpZXMgdGhhdCBoYXZlIHRpbWVkIG91dC4KICAgICAqLwogICAgcHJp\ndmF0ZSB2b2lkIGVycm9yT3V0VGltZWRPdXRFbnRyaWVzKCkgewogICAgICAg\nIGludCBudW1BZGQgPSAwLCBudW1SZWFkID0gMDsKICAgICAgICBpbnQgdG90\nYWwgPSAwOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvciAoQ29tcGxl\ndGlvbktleSBrZXkgOiBhZGRDb21wbGV0aW9ucy5rZXlTZXQoKSkgewogICAg\nICAgICAgICAgICAgdG90YWwrKzsKICAgICAgICAgICAgICAgIGlmIChrZXku\nc2hvdWxkVGltZW91dChjb25mLmdldEFkZEVudHJ5VGltZW91dCgpICogMTAw\nMCkpIHsKICAgICAgICAgICAgICAgICAgICBlcnJvck91dEFkZEtleShrZXkp\nOwogICAgICAgICAgICAgICAgICAgIG51bUFkZCsrOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoQ29tcGxldGlv\nbktleSBrZXkgOiByZWFkQ29tcGxldGlvbnMua2V5U2V0KCkpIHsKICAgICAg\nICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgICAgICBpZiAoa2V5LnNo\nb3VsZFRpbWVvdXQoY29uZi5nZXRSZWFkRW50cnlUaW1lb3V0KCkgKiAxMDAw\nKSkgewogICAgICAgICAgICAgICAgICAgIGVycm9yT3V0UmVhZEtleShrZXkp\nOwogICAgICAgICAgICAgICAgICAgIG51bVJlYWQrKzsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFRocm93YWJs\nZSB0KSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiQ2F1Z2h0IFJ1bnRpbWVF\neGNlcHRpb24gd2hpbGUgZXJyb3Jpbmcgb3V0IHRpbWVkIG91dCBlbnRyaWVz\nIDogIiwgdCk7CiAgICAgICAgfQogICAgICAgIGlmIChudW1BZGQgKyBudW1S\nZWFkID4gMCkgewogICAgICAgICAgICBMT0cuaW5mbygiVGltZW91dCB0YXNr\nIGl0ZXJhdGVkIHRocm91Z2ggYSB0b3RhbCBvZiB7fSBrZXlzLiIsIHRvdGFs\nKTsKICAgICAgICAgICAgTE9HLmluZm8oIlRpbWVvdXQgVGFzayBlcnJvcmVk\nIG91dCB7fSBhZGQgZW50cnkgcmVxdWVzdHMuIiwgbnVtQWRkKTsKICAgICAg\nICAgICAgTE9HLmluZm8oIlRpbWVvdXQgVGFzayBlcnJvcmVkIG91dCB7fSBy\nZWFkIGVudHJ5IHJlcXVlc3RzLiIsIG51bVJlYWQpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgUGVyQ2hhbm5lbEJvb2tpZUNsaWVudChPcmRlcmVk\nU2FmZUV4ZWN1dG9yIGV4ZWN1dG9yLCBDbGllbnRTb2NrZXRDaGFubmVsRmFj\ndG9yeSBjaGFubmVsRmFjdG9yeSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIEF0b21pY0xvbmcg\ndG90YWxCeXRlc091dHN0YW5kaW5nLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHRpbWVvdXRF\neGVjdXRvcikgewogICAgICAgIHRoaXMobmV3IENsaWVudENvbmZpZ3VyYXRp\nb24oKSwgZXhlY3V0b3IsIGNoYW5uZWxGYWN0b3J5LCBhZGRyLCB0b3RhbEJ5\ndGVzT3V0c3RhbmRpbmcsIHRpbWVvdXRFeGVjdXRvcik7CiAgICB9CgogICAg\ncHVibGljIFBlckNoYW5uZWxCb29raWVDbGllbnQoT3JkZXJlZFNhZmVFeGVj\ndXRvciBleGVjdXRvciwgQ2xpZW50U29ja2V0Q2hhbm5lbEZhY3RvcnkgY2hh\nbm5lbEZhY3RvcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBJbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBBdG9taWNMb25nIHRvdGFsQnl0\nZXNPdXRzdGFuZGluZykgewogICAgICAgIHRoaXMobmV3IENsaWVudENvbmZp\nZ3VyYXRpb24oKSwgZXhlY3V0b3IsIGNoYW5uZWxGYWN0b3J5LCBhZGRyLCB0\nb3RhbEJ5dGVzT3V0c3RhbmRpbmcsIG51bGwpOwogICAgfQoKICAgIHB1Ymxp\nYyBQZXJDaGFubmVsQm9va2llQ2xpZW50KENsaWVudENvbmZpZ3VyYXRpb24g\nY29uZiwgT3JkZXJlZFNhZmVFeGVjdXRvciBleGVjdXRvciwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIENsaWVudFNvY2tldENoYW5uZWxG\nYWN0b3J5IGNoYW5uZWxGYWN0b3J5LCBJbmV0U29ja2V0QWRkcmVzcyBhZGRy\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQXRvbWljTG9u\nZyB0b3RhbEJ5dGVzT3V0c3RhbmRpbmcsIFNjaGVkdWxlZEV4ZWN1dG9yU2Vy\ndmljZSB0aW1lb3V0RXhlY3V0b3IpIHsKICAgICAgICB0aGlzLmNvbmYgPSBj\nb25mOwogICAgICAgIHRoaXMuYWRkciA9IGFkZHI7CiAgICAgICAgdGhpcy5l\neGVjdXRvciA9IGV4ZWN1dG9yOwogICAgICAgIHRoaXMudG90YWxCeXRlc091\ndHN0YW5kaW5nID0gdG90YWxCeXRlc091dHN0YW5kaW5nOwogICAgICAgIHRo\naXMuY2hhbm5lbEZhY3RvcnkgPSBjaGFubmVsRmFjdG9yeTsKICAgICAgICB0\naGlzLnN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkRJU0NPTk5FQ1RFRDsKICAg\nICAgICB0aGlzLnRpbWVvdXRFeGVjdXRvciA9IHRpbWVvdXRFeGVjdXRvcjsK\nICAgICAgICAvLyBzY2hldWRsZSB0aGUgdGltZW91dCB0YXNrCiAgICAgICAg\naWYgKG51bGwgIT0gdGhpcy50aW1lb3V0RXhlY3V0b3IpIHsKICAgICAgICAg\nICAgdGhpcy50aW1lb3V0RXhlY3V0b3Iuc2NoZWR1bGVXaXRoRml4ZWREZWxh\neShuZXcgVGltZW91dFRhc2soKSwgY29uZi5nZXRUaW1lb3V0VGFza0ludGVy\ndmFsTWlsbGlzKCksCiAgICAgICAgICAgICAgICAgICAgY29uZi5nZXRUaW1l\nb3V0VGFza0ludGVydmFsTWlsbGlzKCksIFRpbWVVbml0Lk1JTExJU0VDT05E\nUyk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBjb25uZWN0\nKCkgewogICAgICAgIExPRy5pbmZvKCJDb25uZWN0aW5nIHRvIGJvb2tpZTog\ne30iLCBhZGRyKTsKCiAgICAgICAgLy8gU2V0IHVwIHRoZSBDbGllbnRCb290\nU3RyYXAgc28gd2UgY2FuIGNyZWF0ZSBhIG5ldyBDaGFubmVsIGNvbm5lY3Rp\nb24KICAgICAgICAvLyB0byB0aGUgYm9va2llLgogICAgICAgIENsaWVudEJv\nb3RzdHJhcCBib290c3RyYXAgPSBuZXcgQ2xpZW50Qm9vdHN0cmFwKGNoYW5u\nZWxGYWN0b3J5KTsKICAgICAgICBib290c3RyYXAuc2V0UGlwZWxpbmVGYWN0\nb3J5KHRoaXMpOwogICAgICAgIGJvb3RzdHJhcC5zZXRPcHRpb24oInRjcE5v\nRGVsYXkiLCBjb25mLmdldENsaWVudFRjcE5vRGVsYXkoKSk7CiAgICAgICAg\nYm9vdHN0cmFwLnNldE9wdGlvbigia2VlcEFsaXZlIiwgdHJ1ZSk7CgogICAg\nICAgIENoYW5uZWxGdXR1cmUgZnV0dXJlID0gYm9vdHN0cmFwLmNvbm5lY3Qo\nYWRkcik7CiAgICAgICAgZnV0dXJlLmFkZExpc3RlbmVyKG5ldyBDaGFubmVs\nRnV0dXJlTGlzdGVuZXIoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21wbGV0ZShDaGFubmVs\nRnV0dXJlIGZ1dHVyZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAg\nICAgICBMT0cuZGVidWcoIkNoYW5uZWwgY29ubmVjdGVkICh7fSkge30iLCBm\ndXR1cmUuaXNTdWNjZXNzKCksIGZ1dHVyZS5nZXRDaGFubmVsKCkpOwogICAg\nICAgICAgICAgICAgaW50IHJjOwogICAgICAgICAgICAgICAgUXVldWU8R2Vu\nZXJpY0NhbGxiYWNrPFZvaWQ+PiBvbGRQZW5kaW5nT3BzOwoKICAgICAgICAg\nICAgICAgIHN5bmNocm9uaXplZCAoUGVyQ2hhbm5lbEJvb2tpZUNsaWVudC50\naGlzKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZ1dHVyZS5pc1N1Y2Nl\nc3MoKSAmJiBzdGF0ZSA9PSBDb25uZWN0aW9uU3RhdGUuQ09OTkVDVElORykg\newogICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiU3VjY2Vzc2Z1\nbGx5IGNvbm5lY3RlZCB0byBib29raWU6IHt9IiwgZnV0dXJlLmdldENoYW5u\nZWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJjID0gQktFeGNlcHRp\nb24uQ29kZS5PSzsKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbCA9\nIGZ1dHVyZS5nZXRDaGFubmVsKCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkNPTk5FQ1RFRDsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKGZ1dHVyZS5pc1N1Y2Nlc3MoKSAmJiAo\nc3RhdGUgPT0gQ29ubmVjdGlvblN0YXRlLkNMT1NFRAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCBz\ndGF0ZSA9PSBDb25uZWN0aW9uU3RhdGUuRElTQ09OTkVDVEVEKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQ2xvc2VkIGJlZm9yZSBj\nb25uZWN0aW9uIGNvbXBsZXRlZCwgY2xlYW4gdXA6IHt9LCBjdXJyZW50IHN0\nYXRlIHt9IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnV0\ndXJlLmdldENoYW5uZWwoKSwgc3RhdGUpOwogICAgICAgICAgICAgICAgICAg\nICAgICBjbG9zZUNoYW5uZWwoZnV0dXJlLmdldENoYW5uZWwoKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5Cb29r\naWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb247CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNoYW5uZWwgPSBudWxsOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSBpZiAoZnV0dXJlLmlzU3VjY2VzcygpICYmIHN0YXRlID09IENv\nbm5lY3Rpb25TdGF0ZS5DT05ORUNURUQpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgTE9HLmRlYnVnKCJBbHJlYWR5IGNvbm5lY3RlZCB3aXRoIGFub3Ro\nZXIgY2hhbm5lbCh7fSksIHNvIGNsb3NlIHRoZSBuZXcgY2hhbm5lbCh7fSki\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhbm5lbCwg\nZnV0dXJlLmdldENoYW5uZWwoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNsb3NlQ2hhbm5lbChmdXR1cmUuZ2V0Q2hhbm5lbCgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOyAvLyBwZW5kaW5nT3BzIHNob3VsZCBo\nYXZlIGJlZW4gY29tcGxldGVkIHdoZW4gb3RoZXIgY2hhbm5lbCBjb25uZWN0\nZWQKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCBjb25uZWN0IHRvIGJv\nb2tpZToge30ve30sIGN1cnJlbnQgc3RhdGUge30gOiAiLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgZnV0dXJl\nLmdldENoYW5uZWwoKSwgYWRkciwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLCBmdXR1cmUuZ2V0Q2F1\nc2UoKSB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgcmMgPSBCS0V4Y2Vw\ndGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2YWlsYWJsZUV4Y2VwdGlvbjsK\nICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VDaGFubmVsKGZ1dHVyZS5n\nZXRDaGFubmVsKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVs\nID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlICE9\nIENvbm5lY3Rpb25TdGF0ZS5DTE9TRUQpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIHN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkRJU0NPTk5FQ1RF\nRDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAgICAgLy8gdHJpY2sgdG8gbm90IGRv\nIG9wZXJhdGlvbnMgdW5kZXIgdGhlIGxvY2ssIHRha2UgdGhlIGxpc3QKICAg\nICAgICAgICAgICAgICAgICAvLyBvZiBwZW5kaW5nIG9wcyBhbmQgYXNzaWdu\nIGl0IHRvIGEgbmV3IHZhcmlhYmxlLCB3aGlsZQogICAgICAgICAgICAgICAg\nICAgIC8vIGVtcHR5aW5nIHRoZSBwZW5kaW5nIG9wcyBieSBqdXN0IGFzc2ln\nbmluZyBpdCB0byBhIG5ldwogICAgICAgICAgICAgICAgICAgIC8vIGxpc3QK\nICAgICAgICAgICAgICAgICAgICBvbGRQZW5kaW5nT3BzID0gcGVuZGluZ09w\nczsKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nT3BzID0gbmV3IEFycmF5\nRGVxdWU8R2VuZXJpY0NhbGxiYWNrPFZvaWQ+PigpOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIGZvciAoR2VuZXJpY0NhbGxiYWNrPFZv\naWQ+IHBlbmRpbmdPcCA6IG9sZFBlbmRpbmdPcHMpIHsKICAgICAgICAgICAg\nICAgICAgICBwZW5kaW5nT3Aub3BlcmF0aW9uQ29tcGxldGUocmMsIG51bGwp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7\nCiAgICB9CgogICAgdm9pZCBjb25uZWN0SWZOZWVkZWRBbmREb09wKEdlbmVy\naWNDYWxsYmFjazxWb2lkPiBvcCkgewogICAgICAgIGJvb2xlYW4gY29tcGxl\ndGVPcE5vdyA9IGZhbHNlOwogICAgICAgIGludCBvcFJjID0gQktFeGNlcHRp\nb24uQ29kZS5PSzsKICAgICAgICAvLyBjb21tb24gY2FzZSB3aXRob3V0IGxv\nY2sgZmlyc3QKICAgICAgICBpZiAoY2hhbm5lbCAhPSBudWxsICYmIHN0YXRl\nID09IENvbm5lY3Rpb25TdGF0ZS5DT05ORUNURUQpIHsKICAgICAgICAgICAg\nY29tcGxldGVPcE5vdyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKCiAgICAg\nICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICAgICAg\nLy8gY2hlY2sgdGhlIGNoYW5uZWwgc3RhdHVzIGFnYWluIHVuZGVyIGxvY2sK\nICAgICAgICAgICAgICAgIGlmIChjaGFubmVsICE9IG51bGwgJiYgc3RhdGUg\nPT0gQ29ubmVjdGlvblN0YXRlLkNPTk5FQ1RFRCkgewogICAgICAgICAgICAg\nICAgICAgIGNvbXBsZXRlT3BOb3cgPSB0cnVlOwogICAgICAgICAgICAgICAg\nICAgIG9wUmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgICAgICAg\nICAgfSBlbHNlIGlmIChzdGF0ZSA9PSBDb25uZWN0aW9uU3RhdGUuQ0xPU0VE\nKSB7CiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVPcE5vdyA9IHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgb3BSYyA9IEJLRXhjZXB0aW9uLkNvZGUu\nQm9va2llSGFuZGxlTm90QXZhaWxhYmxlRXhjZXB0aW9uOwogICAgICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBjaGFubmVs\nIGlzIGVpdGhlciBudWxsIChmaXJzdCBjb25uZWN0aW9uIGF0dGVtcHQpLCBv\nciB0aGUKICAgICAgICAgICAgICAgICAgICAvLyBjaGFubmVsIGlzIGRpc2Nv\nbm5lY3RlZC4gQ29ubmVjdGlvbiBhdHRlbXB0IGlzIHN0aWxsIGluCiAgICAg\nICAgICAgICAgICAgICAgLy8gcHJvZ3Jlc3MsIHF1ZXVlIHVwIHRoaXMgb3Au\nIE9wIHdpbGwgYmUgZXhlY3V0ZWQgd2hlbgogICAgICAgICAgICAgICAgICAg\nIC8vIGNvbm5lY3Rpb24gYXR0ZW1wdCBlaXRoZXIgZmFpbHMgb3Igc3VjY2Vl\nZHMKICAgICAgICAgICAgICAgICAgICBwZW5kaW5nT3BzLmFkZChvcCk7Cgog\nICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZSA9PSBDb25uZWN0aW9uU3Rh\ndGUuQ09OTkVDVElORykgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBq\ndXN0IHJldHVybiBhcyBjb25uZWN0aW9uIHJlcXVlc3QgaGFzIGFscmVhZHkg\nc2VuZAogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgd2FpdGluZyBm\nb3IgdGhlIHJlc3BvbnNlLgogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIC8vIHN3aXRjaCBzdGF0ZSB0byBjb25uZWN0aW5nIGFuZCBkbyBjb25uZWN0\naW9uIGF0dGVtcHQKICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IENvbm5l\nY3Rpb25TdGF0ZS5DT05ORUNUSU5HOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGlmICghY29tcGxldGVPcE5vdykgewog\nICAgICAgICAgICAgICAgLy8gU3RhcnQgY29ubmVjdGlvbiBhdHRlbXB0IHRv\nIHRoZSBpbnB1dCBzZXJ2ZXIgaG9zdC4KICAgICAgICAgICAgICAgIGNvbm5l\nY3QoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGNv\nbXBsZXRlT3BOb3cpIHsKICAgICAgICAgICAgb3Aub3BlcmF0aW9uQ29tcGxl\ndGUob3BSYywgbnVsbCk7CiAgICAgICAgfQoKICAgIH0KCiAgICAvKioKICAg\nICAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSBjYWxsZWQgb25seSBhZnRlciBj\nb25uZWN0aW9uIGhhcyBiZWVuIGNoZWNrZWQgZm9yCiAgICAgKiB7QGxpbmsg\nI2Nvbm5lY3RJZk5lZWRlZEFuZERvT3AoR2VuZXJpY0NhbGxiYWNrKX0KICAg\nICAqCiAgICAgKiBAcGFyYW0gbGVkZ2VySWQKICAgICAqIEBwYXJhbSBtYXN0\nZXJLZXkKICAgICAqIEBwYXJhbSBlbnRyeUlkCiAgICAgKiBAcGFyYW0gdG9T\nZW5kCiAgICAgKiBAcGFyYW0gY2IKICAgICAqIEBwYXJhbSBjdHgKICAgICAq\nIEBwYXJhbSBvcHRpb25zCiAgICAgKi8KICAgIHZvaWQgYWRkRW50cnkoZmlu\nYWwgbG9uZyBsZWRnZXJJZCwgYnl0ZVtdIG1hc3RlcktleSwgZmluYWwgbG9u\nZyBlbnRyeUlkLCBDaGFubmVsQnVmZmVyIHRvU2VuZCwgV3JpdGVDYWxsYmFj\nayBjYiwKICAgICAgICAgICAgICAgICAgT2JqZWN0IGN0eCwgZmluYWwgaW50\nIG9wdGlvbnMpIHsKICAgICAgICBmaW5hbCBpbnQgZW50cnlTaXplID0gdG9T\nZW5kLnJlYWRhYmxlQnl0ZXMoKTsKCiAgICAgICAgZmluYWwgQ29tcGxldGlv\nbktleSBjb21wbGV0aW9uS2V5ID0gbmV3IENvbXBsZXRpb25LZXkobGVkZ2Vy\nSWQsIGVudHJ5SWQpOwoKICAgICAgICBhZGRDb21wbGV0aW9ucy5wdXQoY29t\ncGxldGlvbktleSwgbmV3IEFkZENvbXBsZXRpb24oY2IsIGVudHJ5U2l6ZSwg\nY3R4KSk7CgogICAgICAgIGludCB0b3RhbEhlYWRlclNpemUgPSA0IC8vIGZv\nciB0aGUgbGVuZ3RoIG9mIHRoZSBwYWNrZXQKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyA0IC8vIGZvciB0aGUgdHlwZSBvZiByZXF1ZXN0CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgQm9va2llUHJvdG9jb2wu\nTUFTVEVSX0tFWV9MRU5HVEg7IC8vIGZvciB0aGUgbWFzdGVyIGtleQoKICAg\nICAgICB0cnl7CiAgICAgICAgICAgIENoYW5uZWxCdWZmZXIgaGVhZGVyID0g\nY2hhbm5lbC5nZXRDb25maWcoKS5nZXRCdWZmZXJGYWN0b3J5KCkuZ2V0QnVm\nZmVyKHRvdGFsSGVhZGVyU2l6ZSk7CgogICAgICAgICAgICBoZWFkZXIud3Jp\ndGVJbnQodG90YWxIZWFkZXJTaXplIC0gNCArIGVudHJ5U2l6ZSk7CiAgICAg\nICAgICAgIGhlYWRlci53cml0ZUludChuZXcgUGFja2V0SGVhZGVyKEJvb2tp\nZVByb3RvY29sLkNVUlJFTlRfUFJPVE9DT0xfVkVSU0lPTiwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQm9va2llUHJv\ndG9jb2wuQURERU5UUlksIChzaG9ydClvcHRpb25zKS50b0ludCgpKTsKICAg\nICAgICAgICAgaGVhZGVyLndyaXRlQnl0ZXMobWFzdGVyS2V5LCAwLCBCb29r\naWVQcm90b2NvbC5NQVNURVJfS0VZX0xFTkdUSCk7CgogICAgICAgICAgICBD\naGFubmVsQnVmZmVyIHdyYXBwZWRCdWZmZXIgPSBDaGFubmVsQnVmZmVycy53\ncmFwcGVkQnVmZmVyKGhlYWRlciwgdG9TZW5kKTsKCiAgICAgICAgICAgIGZp\nbmFsIENoYW5uZWwgYyA9IGNoYW5uZWw7CiAgICAgICAgICAgIGlmIChjID09\nIG51bGwpIHsKICAgICAgICAgICAgICAgIGVycm9yT3V0UmVhZEtleShjb21w\nbGV0aW9uS2V5KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBDaGFubmVsRnV0dXJlIGZ1dHVyZSA9IGMud3Jp\ndGUod3JhcHBlZEJ1ZmZlcik7CiAgICAgICAgICAgIGZ1dHVyZS5hZGRMaXN0\nZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyKCkgewogICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBv\ncGVyYXRpb25Db21wbGV0ZShDaGFubmVsRnV0dXJlIGZ1dHVyZSkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZ1dHVyZS5p\nc1N1Y2Nlc3MoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTE9H\nLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy5kZWJ1ZygiU3VjY2Vzc2Z1bGx5IHdyb3RlIHJlcXVlc3QgZm9y\nIGFkZGluZyBlbnRyeTogIiArIGVudHJ5SWQgKyAiIGxlZGdlci1pZDogIiAr\nIGxlZGdlcklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBib29raWU6ICIgKyBjLmdl\ndFJlbW90ZUFkZHJlc3MoKSArICIgZW50cnkgbGVuZ3RoOiAiICsgZW50cnlT\naXplKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICAvLyB0b3RhbEJ5dGVzT3V0c3RhbmRpbmcuYWRkQW5kR2V0\nKGVudHJ5U2l6ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKCEoZnV0dXJlLmdldENhdXNlKCkg\naW5zdGFuY2VvZiBDbG9zZWRDaGFubmVsRXhjZXB0aW9uKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLndhcm4oIldyaXRpbmcgYWRkRW50\ncnkobGlkPXt9LCBlaWQ9e30pIHRvIGNoYW5uZWwge30gZmFpbGVkIDogIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVj\ndFtdIHsgbGVkZ2VySWQsIGVudHJ5SWQsIGMsIGZ1dHVyZS5nZXRDYXVzZSgp\nIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIGVycm9yT3V0QWRkS2V5KGNvbXBsZXRpb25LZXkpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSk7CiAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIGUpIHsKICAgICAg\nICAgICAgTE9HLndhcm4oIkFkZCBlbnRyeSBvcGVyYXRpb24gZmFpbGVkIiwg\nZSk7CiAgICAgICAgICAgIGVycm9yT3V0QWRkS2V5KGNvbXBsZXRpb25LZXkp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWFkRW50cnlB\nbmRGZW5jZUxlZGdlcihmaW5hbCBsb25nIGxlZGdlcklkLCBieXRlW10gbWFz\ndGVyS2V5LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgZmluYWwgbG9uZyBlbnRyeUlkLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgUmVhZEVudHJ5Q2FsbGJhY2sgY2IsIE9iamVj\ndCBjdHgpIHsKICAgICAgICBmaW5hbCBDb21wbGV0aW9uS2V5IGtleSA9IG5l\ndyBDb21wbGV0aW9uS2V5KGxlZGdlcklkLCBlbnRyeUlkKTsKICAgICAgICBy\nZWFkQ29tcGxldGlvbnMucHV0KGtleSwgbmV3IFJlYWRDb21wbGV0aW9uKGNi\nLCBjdHgpKTsKCiAgICAgICAgaW50IHRvdGFsSGVhZGVyU2l6ZSA9IDQgLy8g\nZm9yIHRoZSBsZW5ndGggb2YgdGhlIHBhY2tldAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICArIDQgLy8gZm9yIHJlcXVlc3QgdHlwZQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIDggLy8gZm9yIGxlZGdlcklkCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgOCAvLyBmb3IgZW50cnlJ\nZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIEJvb2tpZVByb3Rv\nY29sLk1BU1RFUl9LRVlfTEVOR1RIOyAvLyBmb3IgbWFzdGVyS2V5CgogICAg\nICAgIENoYW5uZWxCdWZmZXIgdG1wRW50cnkgPSBjaGFubmVsLmdldENvbmZp\nZygpLmdldEJ1ZmZlckZhY3RvcnkoKS5nZXRCdWZmZXIodG90YWxIZWFkZXJT\naXplKTsKICAgICAgICB0bXBFbnRyeS53cml0ZUludCh0b3RhbEhlYWRlclNp\nemUgLSA0KTsKCiAgICAgICAgdG1wRW50cnkud3JpdGVJbnQobmV3IFBhY2tl\ndEhlYWRlcihCb29raWVQcm90b2NvbC5DVVJSRU5UX1BST1RPQ09MX1ZFUlNJ\nT04sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBCb29raWVQcm90b2NvbC5SRUFERU5UUlksCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBCb29raWVQcm90b2NvbC5GTEFH\nX0RPX0ZFTkNJTkcpLnRvSW50KCkpOwogICAgICAgIHRtcEVudHJ5LndyaXRl\nTG9uZyhsZWRnZXJJZCk7CiAgICAgICAgdG1wRW50cnkud3JpdGVMb25nKGVu\ndHJ5SWQpOwogICAgICAgIHRtcEVudHJ5LndyaXRlQnl0ZXMobWFzdGVyS2V5\nLCAwLCBCb29raWVQcm90b2NvbC5NQVNURVJfS0VZX0xFTkdUSCk7CgogICAg\nICAgIGZpbmFsIENoYW5uZWwgYyA9IGNoYW5uZWw7CiAgICAgICAgaWYgKGMg\nPT0gbnVsbCkgewogICAgICAgICAgICBlcnJvck91dFJlYWRLZXkoa2V5KTsK\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBDaGFubmVs\nRnV0dXJlIGZ1dHVyZSA9IGMud3JpdGUodG1wRW50cnkpOwogICAgICAgIGZ1\ndHVyZS5hZGRMaXN0ZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyKCkg\newogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZv\naWQgb3BlcmF0aW9uQ29tcGxldGUoQ2hhbm5lbEZ1dHVyZSBmdXR1cmUpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaWYgKGZ1dHVyZS5p\nc1N1Y2Nlc3MoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChMT0cuaXNE\nZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cu\nZGVidWcoIlN1Y2Nlc3NmdWxseSB3cm90ZSByZXF1ZXN0IGZvciByZWFkaW5n\nIGVudHJ5OiAiICsgZW50cnlJZCArICIgbGVkZ2VyLWlkOiAiCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIGxlZGdlcklkICsgIiBib29r\naWU6ICIgKyBjLmdldFJlbW90ZUFkZHJlc3MoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoIShmdXR1cmUuZ2V0Q2F1c2UoKSBpbnN0YW5jZW9mIENs\nb3NlZENoYW5uZWxFeGNlcHRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy53YXJuKCJXcml0aW5nIHJlYWRFbnRyeUFuZEZlbmNlTGVkZ2Vy\nKGxpZD17fSwgZWlkPXt9KSB0byBjaGFubmVsIHt9IGZhaWxlZCA6ICIsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsg\nbGVkZ2VySWQsIGVudHJ5SWQsIGMsIGZ1dHVyZS5nZXRDYXVzZSgpIH0pOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBlcnJv\nck91dFJlYWRLZXkoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRF\nbnRyeShmaW5hbCBsb25nIGxlZGdlcklkLCBmaW5hbCBsb25nIGVudHJ5SWQs\nIFJlYWRFbnRyeUNhbGxiYWNrIGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nZmluYWwgQ29tcGxldGlvbktleSBrZXkgPSBuZXcgQ29tcGxldGlvbktleShs\nZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgcmVhZENvbXBsZXRpb25zLnB1\ndChrZXksIG5ldyBSZWFkQ29tcGxldGlvbihjYiwgY3R4KSk7CgogICAgICAg\nIGludCB0b3RhbEhlYWRlclNpemUgPSA0IC8vIGZvciB0aGUgbGVuZ3RoIG9m\nIHRoZSBwYWNrZXQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyA0\nIC8vIGZvciByZXF1ZXN0IHR5cGUKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyA4IC8vIGZvciBsZWRnZXJJZAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIDg7IC8vIGZvciBlbnRyeUlkCgogICAgICAgIHRyeXsK\nICAgICAgICAgICAgQ2hhbm5lbEJ1ZmZlciB0bXBFbnRyeSA9IGNoYW5uZWwu\nZ2V0Q29uZmlnKCkuZ2V0QnVmZmVyRmFjdG9yeSgpLmdldEJ1ZmZlcih0b3Rh\nbEhlYWRlclNpemUpOwogICAgICAgICAgICB0bXBFbnRyeS53cml0ZUludCh0\nb3RhbEhlYWRlclNpemUgLSA0KTsKCiAgICAgICAgICAgIHRtcEVudHJ5Lndy\naXRlSW50KG5ldyBQYWNrZXRIZWFkZXIoQm9va2llUHJvdG9jb2wuQ1VSUkVO\nVF9QUk9UT0NPTF9WRVJTSU9OLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIEJvb2tpZVByb3RvY29sLlJFQURFTlRS\nWSwgQm9va2llUHJvdG9jb2wuRkxBR19OT05FKS50b0ludCgpKTsKICAgICAg\nICAgICAgdG1wRW50cnkud3JpdGVMb25nKGxlZGdlcklkKTsKICAgICAgICAg\nICAgdG1wRW50cnkud3JpdGVMb25nKGVudHJ5SWQpOwoKICAgICAgICAgICAg\nZmluYWwgQ2hhbm5lbCBjID0gY2hhbm5lbDsKICAgICAgICAgICAgaWYgKGMg\nPT0gbnVsbCkgewogICAgICAgICAgICAgICAgZXJyb3JPdXRSZWFkS2V5KGtl\neSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgQ2hhbm5lbEZ1dHVyZSBmdXR1cmUgPSBjLndyaXRlKHRtcEVu\ndHJ5KTsKICAgICAgICAgICAgZnV0dXJlLmFkZExpc3RlbmVyKG5ldyBDaGFu\nbmVsRnV0dXJlTGlzdGVuZXIoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBs\nZXRlKENoYW5uZWxGdXR1cmUgZnV0dXJlKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZnV0dXJlLmlzU3VjY2VzcygpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJs\nZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVn\nKCJTdWNjZXNzZnVsbHkgd3JvdGUgcmVxdWVzdCBmb3IgcmVhZGluZyBlbnRy\neTogIiArIGVudHJ5SWQgKyAiIGxlZGdlci1pZDogIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIGxlZGdlcklkICsgIiBib29raWU6ICIgKyBjLmdldFJlbW90ZUFkZHJl\nc3MoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAo\nIShmdXR1cmUuZ2V0Q2F1c2UoKSBpbnN0YW5jZW9mIENsb3NlZENoYW5uZWxF\neGNlcHRpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cu\nd2FybigiV3JpdGluZyByZWFkRW50cnkobGlkPXt9LCBlaWQ9e30pIHRvIGNo\nYW5uZWwge30gZmFpbGVkIDogIiwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbmV3IE9iamVjdFtdIHsgbGVkZ2VySWQsIGVudHJ5SWQs\nIGMsIGZ1dHVyZS5nZXRDYXVzZSgpIH0pOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yT3V0UmVhZEtl\neShrZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgfSBjYXRjaChUaHJvd2FibGUg\nZSkgewogICAgICAgICAgICBMT0cud2FybigiUmVhZCBlbnRyeSBvcGVyYXRp\nb24gZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGVycm9yT3V0UmVhZEtleShr\nZXkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIERpc2Nvbm5l\nY3RzIHRoZSBib29raWUgY2xpZW50LiBJdCBjYW4gYmUgcmV1c2VkLgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCBkaXNjb25uZWN0KCkgewogICAgICAgIGNs\nb3NlSW50ZXJuYWwoZmFsc2UpOwogICAgfQoKICAgIC8qKgogICAgICogQ2xv\nc2VzIHRoZSBib29raWUgY2xpZW50IHBlcm1hbmVudGx5LiBJdCBjYW5ub3Qg\nYmUgcmV1c2VkLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBjbG9zZSgpIHsK\nICAgICAgICBjbG9zZUludGVybmFsKHRydWUpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBjbG9zZUludGVybmFsKGJvb2xlYW4gcGVybWFuZW50KSB7CiAg\nICAgICAgQ2hhbm5lbCB0b0Nsb3NlID0gbnVsbDsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYgKHBlcm1hbmVudCkgewog\nICAgICAgICAgICAgICAgc3RhdGUgPSBDb25uZWN0aW9uU3RhdGUuQ0xPU0VE\nOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlICE9IENvbm5lY3Rpb25T\ndGF0ZS5DTE9TRUQpIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gQ29ubmVj\ndGlvblN0YXRlLkRJU0NPTk5FQ1RFRDsKICAgICAgICAgICAgfQogICAgICAg\nICAgICB0b0Nsb3NlID0gY2hhbm5lbDsKICAgICAgICAgICAgY2hhbm5lbCA9\nIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0b0Nsb3NlICE9IG51bGwp\nIHsKICAgICAgICAgICAgY2xvc2VDaGFubmVsKHRvQ2xvc2UpLmF3YWl0VW5p\nbnRlcnJ1cHRpYmx5KCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUg\nQ2hhbm5lbEZ1dHVyZSBjbG9zZUNoYW5uZWwoQ2hhbm5lbCBjKSB7CiAgICAg\nICAgTE9HLmRlYnVnKCJDbG9zaW5nIGNoYW5uZWwge30iLCBjKTsKICAgICAg\nICBSZWFkVGltZW91dEhhbmRsZXIgdGltZW91dCA9IGMuZ2V0UGlwZWxpbmUo\nKS5nZXQoUmVhZFRpbWVvdXRIYW5kbGVyLmNsYXNzKTsKICAgICAgICBpZiAo\ndGltZW91dCAhPSBudWxsKSB7CiAgICAgICAgICAgIHRpbWVvdXQucmVsZWFz\nZUV4dGVybmFsUmVzb3VyY2VzKCk7CiAgICAgICAgfQogICAgICAgIHJldHVy\nbiBjLmNsb3NlKCk7CiAgICB9CgogICAgdm9pZCBlcnJvck91dFJlYWRLZXko\nZmluYWwgQ29tcGxldGlvbktleSBrZXkpIHsKICAgICAgICBleGVjdXRvci5z\ndWJtaXRPcmRlcmVkKGtleS5sZWRnZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgp\nIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHNhZmVSdW4oKSB7CgogICAgICAgICAgICAgICAgUmVhZENvbXBsZXRp\nb24gcmVhZENvbXBsZXRpb24gPSByZWFkQ29tcGxldGlvbnMucmVtb3ZlKGtl\neSk7CiAgICAgICAgICAgICAgICBTdHJpbmcgYkFkZHJlc3MgPSAibnVsbCI7\nCiAgICAgICAgICAgICAgICBDaGFubmVsIGMgPSBjaGFubmVsOwogICAgICAg\nICAgICAgICAgaWYoYyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nYkFkZHJlc3MgPSBjLmdldFJlbW90ZUFkZHJlc3MoKS50b1N0cmluZygpOwog\nICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZWFkQ29t\ncGxldGlvbiAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJDb3VsZCBub3Qgd3JpdGUgcmVxdWVzdCBmb3IgcmVhZGluZyBlbnRy\neToge30iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBsZWRn\nZXItaWQ6IHt9IGJvb2tpZToge30iLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBuZXcgT2JqZWN0W10geyBrZXkuZW50cnlJZCwga2V5LmxlZGdl\ncklkLCBiQWRkcmVzcyB9KTsKCiAgICAgICAgICAgICAgICAgICAgcmVhZENv\nbXBsZXRpb24uY2IucmVhZEVudHJ5Q29tcGxldGUoQktFeGNlcHRpb24uQ29k\nZS5Cb29raWVIYW5kbGVOb3RBdmFpbGFibGVFeGNlcHRpb24sCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAga2V5LmxlZGdlcklkLCBrZXkuZW50cnlJZCwgbnVsbCwgcmVhZENvbXBs\nZXRpb24uY3R4KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoK\nICAgICAgICB9KTsKICAgIH0KCiAgICB2b2lkIGVycm9yT3V0QWRkS2V5KGZp\nbmFsIENvbXBsZXRpb25LZXkga2V5KSB7CiAgICAgICAgZXhlY3V0b3Iuc3Vi\nbWl0T3JkZXJlZChrZXkubGVkZ2VySWQsIG5ldyBTYWZlUnVubmFibGUoKSB7\nCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzYWZlUnVuKCkgewoKICAgICAgICAgICAgICAgIEFkZENvbXBsZXRpb24g\nYWRkQ29tcGxldGlvbiA9IGFkZENvbXBsZXRpb25zLnJlbW92ZShrZXkpOwoK\nICAgICAgICAgICAgICAgIGlmIChhZGRDb21wbGV0aW9uICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICBTdHJpbmcgYkFkZHJlc3MgPSAibnVsbCI7\nCiAgICAgICAgICAgICAgICAgICAgQ2hhbm5lbCBjID0gY2hhbm5lbDsKICAg\nICAgICAgICAgICAgICAgICBpZihjICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgYkFkZHJlc3MgPSBjLmdldFJlbW90ZUFkZHJlc3MoKS50\nb1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIkNvdWxkIG5vdCB3cml0ZSByZXF1ZXN0IGZv\nciBhZGRpbmcgZW50cnk6IHt9IGxlZGdlci1pZDoge30gYm9va2llOiB7fSIs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBPYmplY3RbXSB7\nIGtleS5lbnRyeUlkLCBrZXkubGVkZ2VySWQsIGJBZGRyZXNzIH0pOwoKICAg\nICAgICAgICAgICAgICAgICBhZGRDb21wbGV0aW9uLmNiLndyaXRlQ29tcGxl\ndGUoQktFeGNlcHRpb24uQ29kZS5Cb29raWVIYW5kbGVOb3RBdmFpbGFibGVF\neGNlcHRpb24sIGtleS5sZWRnZXJJZCwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga2V5LmVudHJ5SWQsIGFk\nZHIsIGFkZENvbXBsZXRpb24uY3R4KTsKICAgICAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoIkludm9rZWQgY2FsbGJhY2sgbWV0aG9kOiB7fSIsIGtleS5l\nbnRyeUlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAg\nICAgICB9KTsKCiAgICB9CgogICAgLyoqCiAgICAgKiBFcnJvcnMgb3V0IHBl\nbmRpbmcgZW50cmllcy4gV2UgY2FsbCB0aGlzIG1ldGhvZCBmcm9tIG9uZSB0\naHJlYWQgdG8gYXZvaWQKICAgICAqIGNvbmN1cnJlbnQgZXhlY3V0aW9ucyB0\nbyBRdW9ydW1PcE1vbml0b3IgKGltcGxlbWVudHMgY2FsbGJhY2tzKS4gSXQg\nc2VlbXMKICAgICAqIHNpbXBsZXIgdG8gY2FsbCBpdCBmcm9tIEJvb2tpZUhh\nbmRsZSBpbnN0ZWFkIG9mIGNhbGxpbmcgZGlyZWN0bHkgZnJvbQogICAgICog\naGVyZS4KICAgICAqLwoKICAgIHZvaWQgZXJyb3JPdXRPdXRzdGFuZGluZ0Vu\ndHJpZXMoKSB7CgogICAgICAgIC8vIERPIE5PVCByZXdyaXRlIHRoZXNlIHVz\naW5nIE1hcC5FbnRyeSBpdGVyYXRpb25zLiBXZSB3YW50IHRvIGl0ZXJhdGUK\nICAgICAgICAvLyBvbiBrZXlzIGFuZCBzZWUgaWYgd2UgYXJlIHN1Y2Nlc3Nm\ndWxseSBhYmxlIHRvIHJlbW92ZSB0aGUga2V5IGZyb20KICAgICAgICAvLyB0\naGUgbWFwLiBCZWNhdXNlIHRoZSBhZGQgYW5kIHRoZSByZWFkIG1ldGhvZHMg\nYWxzbyBkbyB0aGUgc2FtZSB0aGluZwogICAgICAgIC8vIGluIGNhc2UgdGhl\neSBnZXQgYSB3cml0ZSBmYWlsdXJlIG9uIHRoZSBzb2NrZXQuIFRoZSBvbmUg\nd2hvCiAgICAgICAgLy8gc3VjY2Vzc2Z1bGx5IHJlbW92ZXMgdGhlIGtleSBm\ncm9tIHRoZSBtYXAgaXMgdGhlIG9uZSByZXNwb25zaWJsZSBmb3IKICAgICAg\nICAvLyBjYWxsaW5nIHRoZSBhcHBsaWNhdGlvbiBjYWxsYmFjay4KCiAgICAg\nICAgZm9yIChDb21wbGV0aW9uS2V5IGtleSA6IGFkZENvbXBsZXRpb25zLmtl\neVNldCgpKSB7CiAgICAgICAgICAgIGVycm9yT3V0QWRkS2V5KGtleSk7CiAg\nICAgICAgfQoKICAgICAgICBmb3IgKENvbXBsZXRpb25LZXkga2V5IDogcmVh\nZENvbXBsZXRpb25zLmtleVNldCgpKSB7CiAgICAgICAgICAgIGVycm9yT3V0\nUmVhZEtleShrZXkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAq\nIEluIHRoZSBuZXR0eSBwaXBlbGluZSwgd2UgbmVlZCB0byBzcGxpdCBwYWNr\nZXRzIGJhc2VkIG9uIGxlbmd0aCwgc28gd2UKICAgICAqIHVzZSB0aGUge0Bs\naW5rIExlbmd0aEZpZWxkQmFzZWRGcmFtZURlY29kZXJ9LiBPdGhlciB0aGFu\nIHRoYXQgYWxsIGFjdGlvbnMKICAgICAqIGFyZSBjYXJyaWVkIG91dCBpbiB0\naGlzIGNsYXNzLCBlLmcuLCBtYWtpbmcgc2Vuc2Ugb2YgcmVjZWl2ZWQgbWVz\nc2FnZXMsCiAgICAgKiBwcmVwZW5kaW5nIHRoZSBsZW5ndGggdG8gb3V0Z29p\nbmcgcGFja2V0cyBldGMuCiAgICAgKi8KICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIENoYW5uZWxQaXBlbGluZSBnZXRQaXBlbGluZSgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIENoYW5uZWxQaXBlbGluZSBwaXBlbGluZSA9IENo\nYW5uZWxzLnBpcGVsaW5lKCk7CgogICAgICAgIHBpcGVsaW5lLmFkZExhc3Qo\nImxlbmd0aGJhc2VkZnJhbWVkZWNvZGVyIiwgbmV3IExlbmd0aEZpZWxkQmFz\nZWRGcmFtZURlY29kZXIoTUFYX0ZSQU1FX0xFTkdUSCwgMCwgNCwgMCwgNCkp\nOwogICAgICAgIHBpcGVsaW5lLmFkZExhc3QoIm1haW5oYW5kbGVyIiwgdGhp\ncyk7CiAgICAgICAgcmV0dXJuIHBpcGVsaW5lOwogICAgfQoKICAgIC8qKgog\nICAgICogSWYgb3VyIGNoYW5uZWwgaGFzIGRpc2Nvbm5lY3RlZCwgd2UganVz\ndCBlcnJvciBvdXQgdGhlIHBlbmRpbmcgZW50cmllcwogICAgICovCiAgICBA\nT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGNoYW5uZWxEaXNjb25uZWN0ZWQo\nQ2hhbm5lbEhhbmRsZXJDb250ZXh0IGN0eCwgQ2hhbm5lbFN0YXRlRXZlbnQg\nZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQ2hhbm5lbCBjID0gY3R4\nLmdldENoYW5uZWwoKTsKICAgICAgICBMT0cuaW5mbygiRGlzY29ubmVjdGVk\nIGZyb20gYm9va2llIGNoYW5uZWwge30iLCBjKTsKICAgICAgICBpZiAoYyAh\nPSBudWxsKSB7CiAgICAgICAgICAgIGNsb3NlQ2hhbm5lbChjKTsKICAgICAg\nICB9CgogICAgICAgIGVycm9yT3V0T3V0c3RhbmRpbmdFbnRyaWVzKCk7Cgog\nICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAgICBpZiAo\ndGhpcy5jaGFubmVsID09IGMKICAgICAgICAgICAgICAgICYmIHN0YXRlICE9\nIENvbm5lY3Rpb25TdGF0ZS5DTE9TRUQpIHsKICAgICAgICAgICAgICAgIHN0\nYXRlID0gQ29ubmVjdGlvblN0YXRlLkRJU0NPTk5FQ1RFRDsKICAgICAgICAg\nICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gd2UgZG9uJ3Qgd2FudCB0byBy\nZWNvbm5lY3QgcmlnaHQgYXdheS4gSWYgc29tZW9uZSBzZW5kcyBhIHJlcXVl\nc3QgdG8KICAgICAgICAvLyB0aGlzIGFkZHJlc3MsIHdlIHdpbGwgcmVjb25u\nZWN0LgogICAgfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IG5ldHR5IHdo\nZW4gYW4gZXhjZXB0aW9uIGhhcHBlbnMgaW4gb25lIG9mIHRoZSBuZXR0eSB0\naHJlYWRzCiAgICAgKiAobW9zdGx5IGR1ZSB0byB3aGF0IHdlIGRvIGluIHRo\nZSBuZXR0eSB0aHJlYWRzKQogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1\nYmxpYyB2b2lkIGV4Y2VwdGlvbkNhdWdodChDaGFubmVsSGFuZGxlckNvbnRl\neHQgY3R4LCBFeGNlcHRpb25FdmVudCBlKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBUaHJvd2FibGUgdCA9IGUuZ2V0Q2F1c2UoKTsKICAgICAgICBp\nZiAodCBpbnN0YW5jZW9mIENvcnJ1cHRlZEZyYW1lRXhjZXB0aW9uIHx8IHQg\naW5zdGFuY2VvZiBUb29Mb25nRnJhbWVFeGNlcHRpb24pIHsKICAgICAgICAg\nICAgTE9HLmVycm9yKCJDb3JydXB0ZWQgZnJhbWUgcmVjZWl2ZWQgZnJvbSBi\nb29raWU6IHt9IiwKICAgICAgICAgICAgICAgICAgICAgIGUuZ2V0Q2hhbm5l\nbCgpLmdldFJlbW90ZUFkZHJlc3MoKSk7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIGlmICh0IGluc3RhbmNlb2YgSU9FeGNlcHRp\nb24pIHsKICAgICAgICAgICAgLy8gdGhlc2UgYXJlIHRocm93biB3aGVuIGEg\nYm9va2llIGZhaWxzLCBsb2dnaW5nIHRoZW0ganVzdCBwb2xsdXRlcwogICAg\nICAgICAgICAvLyB0aGUgbG9ncyAodGhlIGZhaWx1cmUgaXMgbG9nZ2VkIGZy\nb20gdGhlIGxpc3RlbmVycyBvbiB0aGUgd3JpdGUKICAgICAgICAgICAgLy8g\nb3BlcmF0aW9uKSwgc28gSSdsbCBqdXN0IGlnbm9yZSBpdCBoZXJlLgogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBzeW5jaHJvbml6\nZWQgKHRoaXMpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09IENvbm5lY3Rp\nb25TdGF0ZS5DTE9TRUQpIHsKICAgICAgICAgICAgICAgIExPRy5kZWJ1Zygi\nVW5leHBlY3RlZCBleGNlcHRpb24gY2F1Z2h0IGJ5IGJvb2tpZSBjbGllbnQg\nY2hhbm5lbCBoYW5kbGVyLCAiCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiYnV0IHRoZSBjbGllbnQgaXMgY2xvc2VkLCBzbyBpdCBpc24ndCBpbXBv\ncnRhbnQiLCB0KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiVW5leHBlY3RlZCBleGNlcHRpb24gY2F1Z2h0IGJ5\nIGJvb2tpZSBjbGllbnQgY2hhbm5lbCBoYW5kbGVyIiwgdCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgLy8gU2luY2Ugd2UgYXJlIGEgbGli\ncmFyeSwgY2FudCB0ZXJtaW5hdGUgQXBwIGhlcmUsIGNhbiB3ZT8KICAgIH0K\nCiAgICAvKioKICAgICAqIENhbGxlZCBieSBuZXR0eSB3aGVuIGEgbWVzc2Fn\nZSBpcyByZWNlaXZlZCBvbiBhIGNoYW5uZWwKICAgICAqLwogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBtZXNzYWdlUmVjZWl2ZWQoQ2hhbm5lbEhh\nbmRsZXJDb250ZXh0IGN0eCwgTWVzc2FnZUV2ZW50IGUpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIGlmICghKGUuZ2V0TWVzc2FnZSgpIGluc3RhbmNl\nb2YgQ2hhbm5lbEJ1ZmZlcikpIHsKICAgICAgICAgICAgY3R4LnNlbmRVcHN0\ncmVhbShlKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgZmluYWwgQ2hhbm5lbEJ1ZmZlciBidWZmZXIgPSAoQ2hhbm5lbEJ1ZmZl\ncikgZS5nZXRNZXNzYWdlKCk7CiAgICAgICAgZmluYWwgaW50IHJjOwogICAg\nICAgIGZpbmFsIGxvbmcgbGVkZ2VySWQsIGVudHJ5SWQ7CiAgICAgICAgZmlu\nYWwgUGFja2V0SGVhZGVyIGhlYWRlcjsKCiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaGVhZGVyID0gUGFja2V0SGVhZGVyLmZyb21JbnQoYnVmZmVyLnJl\nYWRJbnQoKSk7CiAgICAgICAgICAgIHJjID0gYnVmZmVyLnJlYWRJbnQoKTsK\nICAgICAgICAgICAgbGVkZ2VySWQgPSBidWZmZXIucmVhZExvbmcoKTsKICAg\nICAgICAgICAgZW50cnlJZCA9IGJ1ZmZlci5yZWFkTG9uZygpOwogICAgICAg\nIH0gY2F0Y2ggKEluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24gZXgpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJVbnBhcnNlYWJsZSByZXNwb25zZSBmcm9t\nIGJvb2tpZTogIiArIGFkZHIsIGV4KTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgZXhlY3V0b3Iuc3VibWl0T3JkZXJlZChsZWRn\nZXJJZCwgbmV3IFNhZmVSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVSdW4oKSB7CiAgICAg\nICAgICAgICAgICBzd2l0Y2ggKGhlYWRlci5nZXRPcENvZGUoKSkgewogICAg\nICAgICAgICAgICAgY2FzZSBCb29raWVQcm90b2NvbC5BRERFTlRSWToKICAg\nICAgICAgICAgICAgICAgICBoYW5kbGVBZGRSZXNwb25zZShsZWRnZXJJZCwg\nZW50cnlJZCwgcmMpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICAgICAgY2FzZSBCb29raWVQcm90b2NvbC5SRUFERU5UUlk6CiAg\nICAgICAgICAgICAgICAgICAgaGFuZGxlUmVhZFJlc3BvbnNlKGxlZGdlcklk\nLCBlbnRyeUlkLCByYywgYnVmZmVyKTsKICAgICAgICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAg\nICAgICAgTE9HLmVycm9yKCJVbmV4cGVjdGVkIHJlc3BvbnNlLCB0eXBlOiAi\nICsgaGVhZGVyLmdldE9wQ29kZSgpIAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArICIgcmVjZWl2ZWQgZnJvbSBib29raWU6ICIgKyBhZGRyICsg\nIiAsIGlnbm9yaW5nIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9KTsKICAgIH0KCiAgICB2b2lkIGhhbmRsZUFkZFJlc3Bv\nbnNlKGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCwgaW50IHJjKSB7CiAg\nICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAg\nIExPRy5kZWJ1ZygiR290IHJlc3BvbnNlIGZvciBhZGQgcmVxdWVzdCBmcm9t\nIGJvb2tpZToge30gZm9yIGxlZGdlcjoge30gZW50cnk6IHt9IgogICAgICAg\nICAgICAgICAgICAgICAgKyAiIHJjOiB7fSIsIG5ldyBPYmplY3RbXSB7IGFk\nZHIsIGxlZGdlcklkLCBlbnRyeUlkLCByYyB9KTsKICAgICAgICB9CgogICAg\nICAgIC8vIGNvbnZlcnQgdG8gQktFeGNlcHRpb24gY29kZSBiZWNhdXNlIHRo\nYXRzIHdoYXQgdGhlIHVwcHBlcgogICAgICAgIC8vIGxheWVycyBleHBlY3Qu\nIFRoaXMgaXMgVUdMWSwgdGhlcmUgc2hvdWxkIGp1c3QgYmUgb25lIHNldCBv\nZgogICAgICAgIC8vIGVycm9yIGNvZGVzLgogICAgICAgIHN3aXRjaCAocmMp\nIHsKICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkVPSzoKICAgICAgICAg\nICAgcmMgPSBCS0V4Y2VwdGlvbi5Db2RlLk9LOwogICAgICAgICAgICBicmVh\nazsKICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkVCQURWRVJTSU9OOgog\nICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuUHJvdG9jb2xWZXJz\naW9uRXhjZXB0aW9uOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNl\nIEJvb2tpZVByb3RvY29sLkVGRU5DRUQ6CiAgICAgICAgICAgIHJjID0gQktF\neGNlcHRpb24uQ29kZS5MZWRnZXJGZW5jZWRFeGNlcHRpb247CiAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgIGNhc2UgQm9va2llUHJvdG9jb2wuRVVBOgog\nICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuVW5hdXRob3JpemVk\nQWNjZXNzRXhjZXB0aW9uOwogICAgICAgICAgICBicmVhazsKICAgICAgICBj\nYXNlIEJvb2tpZVByb3RvY29sLkVSRUFET05MWToKICAgICAgICAgICAgcmMg\nPSBCS0V4Y2VwdGlvbi5Db2RlLldyaXRlT25SZWFkT25seUJvb2tpZUV4Y2Vw\ndGlvbjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAg\nICAgICAgICAgTE9HLndhcm4oIkFkZCBmb3IgbGVkZ2VyOiB7fSwgZW50cnk6\nIHt9IGZhaWxlZCBvbiBib29raWU6IHt9IgogICAgICAgICAgICAgICAgICAg\nICsgIiB3aXRoIHVua25vd24gY29kZToge30iLCBuZXcgT2JqZWN0W10geyBs\nZWRnZXJJZCwgZW50cnlJZCwgYWRkciwgcmMgfSk7CiAgICAgICAgICAgIHJj\nID0gQktFeGNlcHRpb24uQ29kZS5Xcml0ZUV4Y2VwdGlvbjsKICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBBZGRDb21wbGV0aW9uIGFj\nOwogICAgICAgIGFjID0gYWRkQ29tcGxldGlvbnMucmVtb3ZlKG5ldyBDb21w\nbGV0aW9uS2V5KGxlZGdlcklkLCBlbnRyeUlkKSk7CiAgICAgICAgaWYgKGFj\nID09IG51bGwpIHsKICAgICAgICAgICAgTE9HLmRlYnVnKCJVbmV4cGVjdGVk\nIGFkZCByZXNwb25zZSByZWNlaXZlZCBmcm9tIGJvb2tpZToge30gZm9yIGxl\nZGdlcjoge30iCiAgICAgICAgICAgICAgICAgICAgKyAiLCBlbnRyeToge30s\nIGlnbm9yaW5nIiwgbmV3IE9iamVjdFtdIHsgYWRkciwgIGxlZGdlcklkLCBl\nbnRyeUlkIH0pOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAg\nICAgICAvLyB0b3RhbEJ5dGVzT3V0c3RhbmRpbmcuYWRkQW5kR2V0KC1hYy5z\naXplKTsKCiAgICAgICAgYWMuY2Iud3JpdGVDb21wbGV0ZShyYywgbGVkZ2Vy\nSWQsIGVudHJ5SWQsIGFkZHIsIGFjLmN0eCk7CgogICAgfQoKICAgIHZvaWQg\naGFuZGxlUmVhZFJlc3BvbnNlKGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJ\nZCwgaW50IHJjLCBDaGFubmVsQnVmZmVyIGJ1ZmZlcikgewogICAgICAgIGlm\nIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cuZGVi\ndWcoIkdvdCByZXNwb25zZSBmb3IgcmVhZCByZXF1ZXN0IGZyb20gYm9va2ll\nOiB7fSBmb3IgbGVkZ2VyOiB7fSBlbnRyeToge30iCiAgICAgICAgICAgICAg\nICAgICAgKyAiIHJjOiB7fSBlbnRyeSBsZW5ndGg6IHt9IiwKICAgICAgICAg\nICAgICAgICAgICBuZXcgT2JqZWN0W10geyBhZGRyLCBsZWRnZXJJZCwgZW50\ncnlJZCwgcmMsIGJ1ZmZlci5yZWFkYWJsZUJ5dGVzKCkgfSk7CiAgICAgICAg\nfQoKICAgICAgICAvLyBjb252ZXJ0IHRvIEJLRXhjZXB0aW9uIGNvZGUgYmVj\nYXVzZSB0aGF0cyB3aGF0IHRoZSB1cHBwZXIKICAgICAgICAvLyBsYXllcnMg\nZXhwZWN0LiBUaGlzIGlzIFVHTFksIHRoZXJlIHNob3VsZCBqdXN0IGJlIG9u\nZSBzZXQgb2YKICAgICAgICAvLyBlcnJvciBjb2Rlcy4KICAgICAgICBpZiAo\ncmMgPT0gQm9va2llUHJvdG9jb2wuRU9LKSB7CiAgICAgICAgICAgIHJjID0g\nQktFeGNlcHRpb24uQ29kZS5PSzsKICAgICAgICB9IGVsc2UgaWYgKHJjID09\nIEJvb2tpZVByb3RvY29sLkVOT0VOVFJZIHx8IHJjID09IEJvb2tpZVByb3Rv\nY29sLkVOT0xFREdFUikgewogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9u\nLkNvZGUuTm9TdWNoRW50cnlFeGNlcHRpb247CiAgICAgICAgfSBlbHNlIGlm\nIChyYyA9PSBCb29raWVQcm90b2NvbC5FQkFEVkVSU0lPTikgewogICAgICAg\nICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuUHJvdG9jb2xWZXJzaW9uRXhj\nZXB0aW9uOwogICAgICAgIH0gZWxzZSBpZiAocmMgPT0gQm9va2llUHJvdG9j\nb2wuRVVBKSB7CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5V\nbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb247CiAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgTE9HLndhcm4oIlJlYWQgZm9yIGxlZGdlcjoge30sIGVu\ndHJ5OiB7fSBmYWlsZWQgb24gYm9va2llOiB7fSIKICAgICAgICAgICAgICAg\nICAgICArICIgd2l0aCB1bmtub3duIGNvZGU6IHt9IiwgbmV3IE9iamVjdFtd\nIHsgbGVkZ2VySWQsIGVudHJ5SWQsIGFkZHIsIHJjIH0pOwogICAgICAgICAg\nICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuUmVhZEV4Y2VwdGlvbjsKICAgICAg\nICB9CgogICAgICAgIENvbXBsZXRpb25LZXkga2V5ID0gbmV3IENvbXBsZXRp\nb25LZXkobGVkZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIFJlYWRDb21wbGV0\naW9uIHJlYWRDb21wbGV0aW9uID0gcmVhZENvbXBsZXRpb25zLnJlbW92ZShr\nZXkpOwoKICAgICAgICBpZiAocmVhZENvbXBsZXRpb24gPT0gbnVsbCkgewog\nICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBUaGlzIGlzIGEgc3BlY2lh\nbCBjYXNlLiBXaGVuIHJlY292ZXJpbmcgYSBsZWRnZXIsIGEgY2xpZW50CiAg\nICAgICAgICAgICAqIHN1Ym1pdHMgYSByZWFkIHJlcXVlc3Qgd2l0aCBpZCAt\nMSwgYW5kIHJlY2VpdmVzIGEgcmVzcG9uc2Ugd2l0aCBhCiAgICAgICAgICAg\nICAqIGRpZmZlcmVudCBlbnRyeSBpZC4KICAgICAgICAgICAgICovCiAgICAg\nICAgICAgIAogICAgICAgICAgICByZWFkQ29tcGxldGlvbiA9IHJlYWRDb21w\nbGV0aW9ucy5yZW1vdmUobmV3IENvbXBsZXRpb25LZXkobGVkZ2VySWQsIEJv\nb2tpZVByb3RvY29sLkxBU1RfQUREX0NPTkZJUk1FRCkpOwogICAgICAgIH0K\nCiAgICAgICAgaWYgKHJlYWRDb21wbGV0aW9uID09IG51bGwpIHsKICAgICAg\nICAgICAgTE9HLmRlYnVnKCJVbmV4cGVjdGVkIHJlYWQgcmVzcG9uc2UgcmVj\nZWl2ZWQgZnJvbSBib29raWU6IHt9IGZvciBsZWRnZXI6IHt9IgogICAgICAg\nICAgICAgICAgICAgICsgIiwgZW50cnk6IHt9ICwgaWdub3JpbmciLCBuZXcg\nT2JqZWN0W10geyBhZGRyLCBsZWRnZXJJZCwgZW50cnlJZCB9KTsKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmVhZENvbXBsZXRp\nb24uY2IucmVhZEVudHJ5Q29tcGxldGUocmMsIGxlZGdlcklkLCBlbnRyeUlk\nLCBidWZmZXIuc2xpY2UoKSwgcmVhZENvbXBsZXRpb24uY3R4KTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEJvaWxlci1wbGF0ZSB3cmFwcGVyIGNsYXNzZXMg\nZm9sbG93CiAgICAgKgogICAgICovCiAgICAvLyB2aXNpYmxlIGZvciB0ZXN0\naW5nCiAgICBzdGF0aWMgY2xhc3MgUmVhZENvbXBsZXRpb24gewogICAgICAg\nIGZpbmFsIFJlYWRFbnRyeUNhbGxiYWNrIGNiOwogICAgICAgIGZpbmFsIE9i\namVjdCBjdHg7CgogICAgICAgIHB1YmxpYyBSZWFkQ29tcGxldGlvbihSZWFk\nRW50cnlDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICB0\naGlzLmNiID0gY2I7CiAgICAgICAgICAgIHRoaXMuY3R4ID0gY3R4OwogICAg\nICAgIH0KICAgIH0KCiAgICAvLyB2aXNpYmxlIGZvciB0ZXN0aW5nCiAgICBz\ndGF0aWMgY2xhc3MgQWRkQ29tcGxldGlvbiB7CiAgICAgICAgZmluYWwgV3Jp\ndGVDYWxsYmFjayBjYjsKICAgICAgICAvL2ZpbmFsIGxvbmcgc2l6ZTsKICAg\nICAgICBmaW5hbCBPYmplY3QgY3R4OwoKICAgICAgICBwdWJsaWMgQWRkQ29t\ncGxldGlvbihXcml0ZUNhbGxiYWNrIGNiLCBsb25nIHNpemUsIE9iamVjdCBj\ndHgpIHsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAgICAgICAgICAv\nL3RoaXMuc2l6ZSA9IHNpemU7CiAgICAgICAgICAgIHRoaXMuY3R4ID0gY3R4\nOwogICAgICAgIH0KICAgIH0KCiAgICAvLyB2aXNhYmxlIGZvciB0ZXN0aW5n\nCiAgICBDb21wbGV0aW9uS2V5IG5ld0NvbXBsZXRpb25LZXkobG9uZyBsZWRn\nZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgcmV0dXJuIG5ldyBDb21w\nbGV0aW9uS2V5KGxlZGdlcklkLCBlbnRyeUlkKTsKICAgIH0KCiAgICAvLyB2\naXNhYmxlIGZvciB0ZXN0aW5nCiAgICBzdGF0aWMgY2xhc3MgQ29tcGxldGlv\nbktleSB7CiAgICAgICAgbG9uZyBsZWRnZXJJZDsKICAgICAgICBsb25nIGVu\ndHJ5SWQ7CiAgICAgICAgZmluYWwgbG9uZyByZXF1ZXN0QXQ7CgogICAgICAg\nIENvbXBsZXRpb25LZXkobG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkKSB7\nCiAgICAgICAgICAgIHRoaXMubGVkZ2VySWQgPSBsZWRnZXJJZDsKICAgICAg\nICAgICAgdGhpcy5lbnRyeUlkID0gZW50cnlJZDsKICAgICAgICAgICAgdGhp\ncy5yZXF1ZXN0QXQgPSBNYXRoVXRpbHMubm93SW5OYW5vKCk7CiAgICAgICAg\nfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBl\ncXVhbHMoT2JqZWN0IG9iaikgewogICAgICAgICAgICBpZiAoIShvYmogaW5z\ndGFuY2VvZiBDb21wbGV0aW9uS2V5KSB8fCBvYmogPT0gbnVsbCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIENvbXBsZXRpb25LZXkgdGhhdCA9IChDb21wbGV0aW9uS2V5KSBv\nYmo7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmxlZGdlcklkID09IHRoYXQu\nbGVkZ2VySWQgJiYgdGhpcy5lbnRyeUlkID09IHRoYXQuZW50cnlJZDsKICAg\nICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBpbnQg\naGFzaENvZGUoKSB7CiAgICAgICAgICAgIHJldHVybiAoKGludCkgbGVkZ2Vy\nSWQgPDwgMTYpIF4gKChpbnQpIGVudHJ5SWQpOwogICAgICAgIH0KCiAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIFN0cmluZyB0b1N0cmluZygp\nIHsKICAgICAgICAgICAgcmV0dXJuIFN0cmluZy5mb3JtYXQoIkxlZGdlckVu\ndHJ5KCVkLCAlZCkiLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAgICAgICAgfQoK\nICAgICAgICBwdWJsaWMgYm9vbGVhbiBzaG91bGRUaW1lb3V0KGxvbmcgdGlt\nZW91dCkgewogICAgICAgICAgICByZXR1cm4gZWxhcHNlZFRpbWUoKSA+PSB0\naW1lb3V0OwogICAgICAgIH0KCiAgICAgICAgcHVibGljIGxvbmcgZWxhcHNl\nZFRpbWUoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoVXRpbHMuZWxhcHNl\nZE1TZWMocmVxdWVzdEF0KTsKICAgICAgICB9CiAgICB9Cgp9Cg==\n","encoding":"base64"}

