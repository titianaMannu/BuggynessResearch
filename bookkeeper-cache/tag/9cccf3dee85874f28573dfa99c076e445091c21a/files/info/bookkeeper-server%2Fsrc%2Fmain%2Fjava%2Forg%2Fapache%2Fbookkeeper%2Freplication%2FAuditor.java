{"sha":"2c62996d37fff8c2673b5354438ede62e3e3693d","node_id":"MDQ6QmxvYjE1NzU5NTY6MmM2Mjk5NmQzN2ZmZjhjMjY3M2I1MzU0NDM4ZWRlNjJlM2UzNjkzZA==","size":24242,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/2c62996d37fff8c2673b5354438ede62e3e3693d","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkNvbGxlY3Rpb247CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwpp\nbXBvcnQgamF2YS51dGlsLlNldDsKCmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5GdXR1cmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1l\nVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkV4ZWN1dG9yczsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlNjaGVkdWxlZEV4ZWN1dG9y\nU2VydmljZTsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRocmVhZEZh\nY3Rvcnk7CgppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7Cgpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdl\ncjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNs\naWVudC5Cb29rS2VlcGVyQWRtaW47CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkJvb2tLZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckNoZWNrZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckZyYWdtZW50\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29raWVz\nTGlzdGVuZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRpbC5T\ndHJpbmdVdGlsczsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudXRp\nbC5aa1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnpvb2tl\nZXBlci5ab29LZWVwZXJXYXRjaGVyQmFzZTsKCmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdlckZhY3Rv\ncnk7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJN\nYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuTGVk\nZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tz\nLkdlbmVyaWNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFja3MuUHJvY2Vzc29y\nOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5S\nZXBsaWNhdGlvbkV4Y2VwdGlvbi5CS0F1ZGl0RXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJlcGxpY2F0aW9u\nRXhjZXB0aW9uLkNvbXBhdGliaWxpdHlFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNl\ncHRpb24uVW5hdmFpbGFibGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMuY29sbGVjdGlvbnMuQ29sbGVjdGlvblV0aWxzOwppbXBvcnQg\nY29tLmdvb2dsZS5jb21tb24uY29sbGVjdC5TZXRzOwppbXBvcnQgY29tLmdv\nb2dsZS5jb21tb24uYW5ub3RhdGlvbnMuVmlzaWJsZUZvclRlc3Rpbmc7Cmlt\ncG9ydCBjb20uZ29vZ2xlLmNvbW1vbi51dGlsLmNvbmN1cnJlbnQuU2V0dGFi\nbGVGdXR1cmU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJF\neGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVk\nRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5Bc3luY0NhbGxiYWNrOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXJGYWN0b3J5OwoKLyoqCiAqIEF1ZGl0b3IgaXMgYSBzaW5nbGUgZW50aXR5\nIGluIHRoZSBlbnRpcmUgQm9va2llIGNsdXN0ZXIgYW5kIHdpbGwgYmUgd2F0\nY2hpbmcKICogYWxsIHRoZSBib29raWVzIHVuZGVyICdsZWRnZXJyb290cGF0\naC9hdmFpbGFibGUnIHprcGF0aC4gV2hlbiBhbnkgb2YgdGhlCiAqIGJvb2tp\nZSBmYWlsZWQgb3IgZGlzY29ubmVjdGVkIGZyb20gemssIGhlIHdpbGwgc3Rh\ncnQgaW5pdGlhdGluZyB0aGUKICogcmUtcmVwbGljYXRpb24gYWN0aXZpdGll\ncyBieSBrZWVwaW5nIGFsbCB0aGUgY29ycmVzcG9uZGluZyBsZWRnZXJzIG9m\nIHRoZQogKiBmYWlsZWQgYm9va2llIGFzIHVuZGVycmVwbGljYXRlZCB6bm9k\nZSBpbiB6ay4KICovCnB1YmxpYyBjbGFzcyBBdWRpdG9yIGltcGxlbWVudHMg\nQm9va2llc0xpc3RlbmVyIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExv\nZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihBdWRpdG9yLmNs\nYXNzKTsKICAgIHByaXZhdGUgZmluYWwgU2VydmVyQ29uZmlndXJhdGlvbiBj\nb25mOwogICAgcHJpdmF0ZSBCb29rS2VlcGVyIGJrYzsKICAgIHByaXZhdGUg\nQm9va0tlZXBlckFkbWluIGFkbWluOwogICAgcHJpdmF0ZSBCb29raWVMZWRn\nZXJJbmRleGVyIGJvb2tpZUxlZGdlckluZGV4ZXI7CiAgICBwcml2YXRlIExl\nZGdlck1hbmFnZXIgbGVkZ2VyTWFuYWdlcjsKICAgIHByaXZhdGUgTGVkZ2Vy\nVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgbGVkZ2VyVW5kZXJyZXBsaWNhdGlv\nbk1hbmFnZXI7CiAgICBwcml2YXRlIGZpbmFsIFNjaGVkdWxlZEV4ZWN1dG9y\nU2VydmljZSBleGVjdXRvcjsKICAgIHByaXZhdGUgTGlzdDxTdHJpbmc+IGtu\nb3duQm9va2llcyA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgcHJp\ndmF0ZSBmaW5hbCBTdHJpbmcgYm9va2llSWRlbnRpZmllcjsKCiAgICBwdWJs\naWMgQXVkaXRvcihmaW5hbCBTdHJpbmcgYm9va2llSWRlbnRpZmllciwgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgICAgICAgICAgICAgWm9v\nS2VlcGVyIHprYykgdGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAg\nICAgICB0aGlzLmNvbmYgPSBjb25mOwogICAgICAgIHRoaXMuYm9va2llSWRl\nbnRpZmllciA9IGJvb2tpZUlkZW50aWZpZXI7CgogICAgICAgIGluaXRpYWxp\nemUoY29uZiwgemtjKTsKCiAgICAgICAgZXhlY3V0b3IgPSBFeGVjdXRvcnMu\nbmV3U2luZ2xlVGhyZWFkU2NoZWR1bGVkRXhlY3V0b3IobmV3IFRocmVhZEZh\nY3RvcnkoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgIHB1YmxpYyBUaHJlYWQgbmV3VGhyZWFkKFJ1bm5hYmxlIHIpIHsK\nICAgICAgICAgICAgICAgICAgICBUaHJlYWQgdCA9IG5ldyBUaHJlYWQociwg\nIkF1ZGl0b3JCb29raWUtIiArIGJvb2tpZUlkZW50aWZpZXIpOwogICAgICAg\nICAgICAgICAgICAgIHQuc2V0RGFlbW9uKHRydWUpOwogICAgICAgICAgICAg\nICAgICAgIHJldHVybiB0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9KTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgaW5pdGlhbGl6ZShTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYsIFpvb0tlZXBlciB6a2MpCiAgICAgICAg\nICAgIHRocm93cyBVbmF2YWlsYWJsZUV4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbGVkZ2VyTWFu\nYWdlckZhY3RvcnkgPSBMZWRnZXJNYW5hZ2VyRmFjdG9yeQogICAgICAgICAg\nICAgICAgICAgIC5uZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeShjb25mLCB6a2Mp\nOwogICAgICAgICAgICBsZWRnZXJNYW5hZ2VyID0gbGVkZ2VyTWFuYWdlckZh\nY3RvcnkubmV3TGVkZ2VyTWFuYWdlcigpOwogICAgICAgICAgICB0aGlzLmJv\nb2tpZUxlZGdlckluZGV4ZXIgPSBuZXcgQm9va2llTGVkZ2VySW5kZXhlcihs\nZWRnZXJNYW5hZ2VyKTsKCiAgICAgICAgICAgIHRoaXMubGVkZ2VyVW5kZXJy\nZXBsaWNhdGlvbk1hbmFnZXIgPSBsZWRnZXJNYW5hZ2VyRmFjdG9yeQogICAg\nICAgICAgICAgICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFu\nYWdlcigpOwoKICAgICAgICAgICAgdGhpcy5ia2MgPSBuZXcgQm9va0tlZXBl\ncihuZXcgQ2xpZW50Q29uZmlndXJhdGlvbihjb25mKSwgemtjKTsKICAgICAg\nICAgICAgdGhpcy5hZG1pbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYmtjKTsK\nCiAgICAgICAgfSBjYXRjaCAoQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbiBjZSkg\newogICAgICAgICAgICB0aHJvdyBuZXcgVW5hdmFpbGFibGVFeGNlcHRpb24o\nCiAgICAgICAgICAgICAgICAgICAgIkNvbXBhdGliaWxpdHlFeGNlcHRpb24g\nd2hpbGUgaW5pdGlhbGl6aW5nIEF1ZGl0b3IiLCBjZSk7CiAgICAgICAgfSBj\nYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBVbmF2YWlsYWJsZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAi\nSU9FeGNlcHRpb24gd2hpbGUgaW5pdGlhbGl6aW5nIEF1ZGl0b3IiLCBpb2Up\nOwogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5hdmFpbGFibGVFeGNlcHRpb24oCiAgICAg\nICAgICAgICAgICAgICAgIktlZXBlckV4Y2VwdGlvbiB3aGlsZSBpbml0aWFs\naXppbmcgQXVkaXRvciIsIGtlKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgVW5h\ndmFpbGFibGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgIkludGVy\ncnVwdGVkIHdoaWxlIGluaXRpYWxpemluZyBBdWRpdG9yIiwgaWUpOwogICAg\nICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgc3VibWl0U2h1dGRvd25U\nYXNrKCkgewogICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAg\nICAgICBpZiAoZXhlY3V0b3IuaXNTaHV0ZG93bigpKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZXhlY3V0\nb3Iuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIHN5bmNocm9uaXplZCAoQXVkaXRvci50aGlzKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBleGVjdXRvci5zaHV0ZG93bigpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfQoKICAgIEBWaXNpYmxlRm9y\nVGVzdGluZwogICAgc3luY2hyb25pemVkIEZ1dHVyZTw/PiBzdWJtaXRBdWRp\ndFRhc2soKSB7CiAgICAgICAgaWYgKGV4ZWN1dG9yLmlzU2h1dGRvd24oKSkg\newogICAgICAgICAgICBTZXR0YWJsZUZ1dHVyZTxWb2lkPiBmID0gU2V0dGFi\nbGVGdXR1cmUuPFZvaWQ+Y3JlYXRlKCk7CiAgICAgICAgICAgIGYuc2V0RXhj\nZXB0aW9uKG5ldyBCS0F1ZGl0RXhjZXB0aW9uKCJBdWRpdG9yIHNodXR0aW5n\nIGRvd24iKSk7CiAgICAgICAgICAgIHJldHVybiBmOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gZXhlY3V0b3Iuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICB3YWl0\nSWZMZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVkKCk7CgogICAgICAgICAgICAg\nICAgICAgICAgICBMaXN0PFN0cmluZz4gYXZhaWxhYmxlQm9va2llcyA9IGdl\ndEF2YWlsYWJsZUJvb2tpZXMoKTsKCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGNhc3RpbmcgdG8gU3RyaW5nLCBhcyBrbm93bkJvb2tpZXMgYW5kIGF2\nYWlsYWJsZUJvb2tpZXMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29u\ndGFpbnMgb25seSBTdHJpbmcgdmFsdWVzCiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGZpbmQgbmV3IGJvb2tpZXMoaWYgYW55KSBhbmQgdXBkYXRlIHRo\nZSBrbm93biBib29raWUgbGlzdAogICAgICAgICAgICAgICAgICAgICAgICBD\nb2xsZWN0aW9uPFN0cmluZz4gbmV3Qm9va2llcyA9IENvbGxlY3Rpb25VdGls\ncy5zdWJ0cmFjdCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBh\ndmFpbGFibGVCb29raWVzLCBrbm93bkJvb2tpZXMpOwogICAgICAgICAgICAg\nICAgICAgICAgICBrbm93bkJvb2tpZXMuYWRkQWxsKG5ld0Jvb2tpZXMpOwoK\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmluZCBsb3N0IGJvb2tpZXMo\naWYgYW55KQogICAgICAgICAgICAgICAgICAgICAgICBDb2xsZWN0aW9uPFN0\ncmluZz4gbG9zdEJvb2tpZXMgPSBDb2xsZWN0aW9uVXRpbHMuc3VidHJhY3Qo\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAga25vd25Cb29raWVz\nLCBhdmFpbGFibGVCb29raWVzKTsKCiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChsb3N0Qm9va2llcy5zaXplKCkgPiAwKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBrbm93bkJvb2tpZXMucmVtb3ZlQWxsKGxvc3RCb29r\naWVzKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpdEJvb2tp\nZXMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGJrZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBnZXR0aW5nIGJv\nb2tpZSBsaXN0IiwgYmtlKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNo\nIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkludGVycnVwdGVk\nIHdoaWxlIHdhdGNoaW5nIGF2YWlsYWJsZSBib29raWVzICIsIGllKTsKICAg\nICAgICAgICAgICAgICAgICB9IGNhdGNoIChCS0F1ZGl0RXhjZXB0aW9uIGJr\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2Vw\ndGlvbiB3aGlsZSB3YXRjaGluZyBhdmFpbGFibGUgYm9va2llcyIsIGJrZSk7\nCiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoVW5hdmFpbGFibGVFeGNl\ncHRpb24gdWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9y\nKCJFeGNlcHRpb24gd2hpbGUgd2F0Y2hpbmcgYXZhaWxhYmxlIGJvb2tpZXMi\nLCB1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhj\nZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiRXhjZXB0aW9uIHJlYWRpbmcgYm9va2llIGxpc3QiLCBrZSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9KTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydCgpIHsKICAgICAg\nICBMT0cuaW5mbygiSSdtIHN0YXJ0aW5nIGFzIEF1ZGl0b3IgQm9va2llLiBJ\nRDoge30iLCBib29raWVJZGVudGlmaWVyKTsKICAgICAgICAvLyBvbiBzdGFy\ndHVwIHdhdGNoaW5nIGF2YWlsYWJsZSBib29raWUgYW5kIGJhc2VkIG9uIHRo\nZQogICAgICAgIC8vIGF2YWlsYWJsZSBib29raWVzIGRldGVybWluaW5nIHRo\nZSBib29raWUgZmFpbHVyZXMuCiAgICAgICAgc3luY2hyb25pemVkICh0aGlz\nKSB7CiAgICAgICAgICAgIGlmIChleGVjdXRvci5pc1NodXRkb3duKCkpIHsK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgbG9uZyBpbnRlcnZhbCA9IGNvbmYuZ2V0QXVkaXRvclBlcmlvZGlj\nQ2hlY2tJbnRlcnZhbCgpOwoKICAgICAgICAgICAgaWYgKGludGVydmFsID4g\nMCkgewogICAgICAgICAgICAgICAgTE9HLmluZm8oIkF1ZGl0b3IgcGVyaW9k\naWMgbGVkZ2VyIGNoZWNraW5nIGVuYWJsZWQiCiAgICAgICAgICAgICAgICAg\nICAgICAgICArICIgJ2F1ZGl0b3JQZXJpb2RpY0NoZWNrSW50ZXJ2YWwnIHt9\nIHNlY29uZHMiLCBpbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBleGVjdXRv\nci5zY2hlZHVsZUF0Rml4ZWRSYXRlKG5ldyBSdW5uYWJsZSgpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlJ1bm5pbmcgcGVyaW9k\naWMgY2hlY2siKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghbGVkZ2Vy\nVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIuaXNMZWRnZXJSZXBsaWNhdGlvbkVu\nYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBMT0cuaW5mbygiTGVkZ2VyIHJlcGxpY2F0aW9uIGRpc2FibGVkLCBza2lw\ncGluZyIpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja0FsbExlZGdlcnMo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBl\nckV4Y2VwdGlvbiBrZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHJ1bm5pbmcgcGVyaW9k\naWMgY2hlY2siLCBrZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhyZWFkKCku\naW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nTE9HLmVycm9yKCJJbnRlcnJ1cHRlZCB3aGlsZSBydW5uaW5nIHBlcmlvZGlj\nIGNoZWNrIiwgaWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoQktBdWRpdEV4Y2VwdGlvbiBia2FlKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gd2hpbGUg\ncnVubmluZyBwZXJpb2RpYyBjaGVjayIsIGJrYWUpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gYmtlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNl\ncHRpb24gcnVubmluZyBwZXJpb2RpYyBjaGVjayIsIGJrZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2Up\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3Io\nIkkvTyBleGNlcHRpb24gcnVubmluZyBwZXJpb2RpYyBjaGVjayIsIGlvZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChSZXBsaWNh\ndGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbiB1ZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiVW5kZXJy\nZXBsaWNhdGlvbiBtYW5hZ2VyIHVuYXZhaWxhYmxlICIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyJydW5uaW5nIHBlcmlv\nZGljIGNoZWNrIiwgdWUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfSwgaW50ZXJ2YWwsIGludGVydmFsLCBUaW1lVW5pdC5TRUNPTkRTKTsK\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIExPRy5pbmZv\nKCJQZXJpb2RpYyBjaGVja2luZyBkaXNhYmxlZCIpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBrbm93bkJvb2tp\nZXMgPSBnZXRBdmFpbGFibGVCb29raWVzKCk7CiAgICAgICAgICAgIH0gY2F0\nY2ggKEJLRXhjZXB0aW9uIGJrZSkgewogICAgICAgICAgICAgICAgTE9HLmVy\ncm9yKCJDb3VsZG4ndCBnZXQgYm9va2llIGxpc3QsIGV4aXRpbmciLCBia2Up\nOwogICAgICAgICAgICAgICAgc3VibWl0U2h1dGRvd25UYXNrKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIGxvbmcgYm9va2llQ2hlY2tJbnRlcnZh\nbCA9IGNvbmYuZ2V0QXVkaXRvclBlcmlvZGljQm9va2llQ2hlY2tJbnRlcnZh\nbCgpOwogICAgICAgICAgICBpZiAoYm9va2llQ2hlY2tJbnRlcnZhbCA9PSAw\nKSB7CiAgICAgICAgICAgICAgICBMT0cuaW5mbygiQXVkaXRvciBwZXJpb2Rp\nYyBib29raWUgY2hlY2tpbmcgZGlzYWJsZWQsIHJ1bm5pbmcgb25jZSBjaGVj\nayBub3cgYW55aG93Iik7CiAgICAgICAgICAgICAgICBleGVjdXRvci5zdWJt\naXQoQk9PS0lFX0NIRUNLKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIExPRy5pbmZvKCJBdWRpdG9yIHBlcmlvZGljIGJvb2tpZSBj\naGVja2luZyBlbmFibGVkIgogICAgICAgICAgICAgICAgICAgICAgICAgKyAi\nICdhdWRpdG9yUGVyaW9kaWNCb29raWVDaGVja0ludGVydmFsJyB7fSBzZWNv\nbmRzIiwgYm9va2llQ2hlY2tJbnRlcnZhbCk7CiAgICAgICAgICAgICAgICBl\neGVjdXRvci5zY2hlZHVsZUF0Rml4ZWRSYXRlKEJPT0tJRV9DSEVDSywgMCwg\nYm9va2llQ2hlY2tJbnRlcnZhbCwgVGltZVVuaXQuU0VDT05EUyk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHdh\naXRJZkxlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQoKSB0aHJvd3MgVW5hdmFp\nbGFibGVFeGNlcHRpb24sCiAgICAgICAgICAgIEludGVycnVwdGVkRXhjZXB0\naW9uIHsKICAgICAgICBSZXBsaWNhdGlvbkVuYWJsZUNiIGNiID0gbmV3IFJl\ncGxpY2F0aW9uRW5hYmxlQ2IoKTsKICAgICAgICBpZiAoIWxlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyLmlzTGVkZ2VyUmVwbGljYXRpb25FbmFibGVk\nKCkpIHsKICAgICAgICAgICAgbGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFn\nZXIubm90aWZ5TGVkZ2VyUmVwbGljYXRpb25FbmFibGVkKGNiKTsKICAgICAg\nICAgICAgY2IuYXdhaXQoKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0\nZSBMaXN0PFN0cmluZz4gZ2V0QXZhaWxhYmxlQm9va2llcygpIHRocm93cyBC\nS0V4Y2VwdGlvbiB7CiAgICAgICAgLy8gR2V0IHRoZSBhdmFpbGFibGUgYm9v\na2llcywgYWxzbyB3YXRjaCBmb3IgZnVydGhlciBjaGFuZ2VzCiAgICAgICAg\nLy8gV2F0Y2hpbmcgb24gb25seSBhdmFpbGFibGUgYm9va2llcyBpcyBzdWZm\naWNpZW50LCBhcyBjaGFuZ2VzIGluIHJlYWRvbmx5IGJvb2tpZXMgYWxzbyBj\naGFuZ2VzIGluIGF2YWlsYWJsZQogICAgICAgIC8vIGJvb2tpZXMKICAgICAg\nICBhZG1pbi5ub3RpZnlCb29raWVzQ2hhbmdlZCh0aGlzKTsKICAgICAgICBD\nb2xsZWN0aW9uPEluZXRTb2NrZXRBZGRyZXNzPiBhdmFpbGFibGVCa0FkZHJl\nc3NlcyA9IGFkbWluLmdldEF2YWlsYWJsZUJvb2tpZXMoKTsKICAgICAgICBD\nb2xsZWN0aW9uPEluZXRTb2NrZXRBZGRyZXNzPiByZWFkT25seUJrQWRkcmVz\nc2VzID0gYWRtaW4uZ2V0UmVhZE9ubHlCb29raWVzKCk7CiAgICAgICAgYXZh\naWxhYmxlQmtBZGRyZXNzZXMuYWRkQWxsKHJlYWRPbmx5QmtBZGRyZXNzZXMp\nOwoKICAgICAgICBMaXN0PFN0cmluZz4gYXZhaWxhYmxlQm9va2llcyA9IG5l\ndyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgIGZvciAoSW5ldFNvY2tl\ndEFkZHJlc3MgYWRkciA6IGF2YWlsYWJsZUJrQWRkcmVzc2VzKSB7CiAgICAg\nICAgICAgIGF2YWlsYWJsZUJvb2tpZXMuYWRkKFN0cmluZ1V0aWxzLmFkZHJU\nb1N0cmluZyhhZGRyKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhdmFp\nbGFibGVCb29raWVzOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1\nbmNoZWNrZWQiKQogICAgcHJpdmF0ZSB2b2lkIGF1ZGl0Qm9va2llcygpCiAg\nICAgICAgICAgIHRocm93cyBCS0F1ZGl0RXhjZXB0aW9uLCBLZWVwZXJFeGNl\ncHRpb24sCiAgICAgICAgICAgIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4\nY2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgd2FpdElmTGVk\nZ2VyUmVwbGljYXRpb25EaXNhYmxlZCgpOwogICAgICAgIH0gY2F0Y2ggKFVu\nYXZhaWxhYmxlRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiVW5kZXJyZXBsaWNhdGlvbiB1bmF2YWlsYWJsZSwgc2tpcHBpbmcgYXVk\naXQuIgogICAgICAgICAgICAgICAgICAgICAgKyAiV2lsbCByZXRyeSBhZnRl\nciBhIHBlcmlvZCIpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoK\nICAgICAgICAvLyBwdXQgZXhpdCBjYXNlcyBoZXJlCiAgICAgICAgTWFwPFN0\ncmluZywgU2V0PExvbmc+PiBsZWRnZXJEZXRhaWxzID0gZ2VuZXJhdGVCb29r\naWUyTGVkZ2Vyc0luZGV4KCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naWYgKCFsZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlci5pc0xlZGdlclJl\ncGxpY2F0aW9uRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAvLyBoYXMg\nYmVlbiBkaXNhYmxlZCB3aGlsZSB3ZSB3ZXJlIGdlbmVyYXRpbmcgdGhlIGlu\nZGV4CiAgICAgICAgICAgICAgICAvLyBkaXNjYXJkIHRoaXMgcnVuLCBhbmQg\nc2NoZWR1bGUgYSBuZXcgb25lCiAgICAgICAgICAgICAgICBleGVjdXRvci5z\ndWJtaXQoQk9PS0lFX0NIRUNLKTsKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhj\nZXB0aW9uIHVlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVW5kZXJyZXBs\naWNhdGlvbiB1bmF2YWlsYWJsZSwgc2tpcHBpbmcgYXVkaXQuIgogICAgICAg\nICAgICAgICAgICAgICAgKyAiV2lsbCByZXRyeSBhZnRlciBhIHBlcmlvZCIp\nOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBMaXN0\nPFN0cmluZz4gYXZhaWxhYmxlQm9va2llcyA9IGdldEF2YWlsYWJsZUJvb2tp\nZXMoKTsKICAgICAgICAvLyBmaW5kIGxvc3QgYm9va2llcwogICAgICAgIFNl\ndDxTdHJpbmc+IGtub3duQm9va2llcyA9IGxlZGdlckRldGFpbHMua2V5U2V0\nKCk7CiAgICAgICAgQ29sbGVjdGlvbjxTdHJpbmc+IGxvc3RCb29raWVzID0g\nQ29sbGVjdGlvblV0aWxzLnN1YnRyYWN0KGtub3duQm9va2llcywKICAgICAg\nICAgICAgICAgIGF2YWlsYWJsZUJvb2tpZXMpOwoKICAgICAgICBpZiAobG9z\ndEJvb2tpZXMuc2l6ZSgpID4gMCkKICAgICAgICAgICAgaGFuZGxlTG9zdEJv\nb2tpZXMobG9zdEJvb2tpZXMsIGxlZGdlckRldGFpbHMpOwogICAgfQoKICAg\nIHByaXZhdGUgTWFwPFN0cmluZywgU2V0PExvbmc+PiBnZW5lcmF0ZUJvb2tp\nZTJMZWRnZXJzSW5kZXgoKQogICAgICAgICAgICB0aHJvd3MgQktBdWRpdEV4\nY2VwdGlvbiB7CiAgICAgICAgcmV0dXJuIGJvb2tpZUxlZGdlckluZGV4ZXIu\nZ2V0Qm9va2llVG9MZWRnZXJJbmRleCgpOwogICAgfQoKICAgIHByaXZhdGUg\ndm9pZCBoYW5kbGVMb3N0Qm9va2llcyhDb2xsZWN0aW9uPFN0cmluZz4gbG9z\ndEJvb2tpZXMsCiAgICAgICAgICAgIE1hcDxTdHJpbmcsIFNldDxMb25nPj4g\nbGVkZ2VyRGV0YWlscykgdGhyb3dzIEJLQXVkaXRFeGNlcHRpb24gewogICAg\nICAgIExPRy5pbmZvKCJGb2xsb3dpbmcgYXJlIHRoZSBmYWlsZWQgYm9va2ll\nczogIiArIGxvc3RCb29raWVzCiAgICAgICAgICAgICAgICArICIgYW5kIHNl\nYXJjaGluZyBpdHMgbGVkZ2VycyBmb3IgcmUtcmVwbGljYXRpb24iKTsKCiAg\nICAgICAgZm9yIChTdHJpbmcgYm9va2llSVAgOiBsb3N0Qm9va2llcykgewog\nICAgICAgICAgICAvLyBpZGVudGlmeSBhbGwgdGhlIGxlZGdlcnMgaW4gYm9v\na2llSVAgYW5kIHB1Ymxpc2hpbmcgdGhlc2UgbGVkZ2VycwogICAgICAgICAg\nICAvLyBhcyB1bmRlci1yZXBsaWNhdGVkLgogICAgICAgICAgICBwdWJsaXNo\nU3VzcGVjdGVkTGVkZ2Vycyhib29raWVJUCwgbGVkZ2VyRGV0YWlscy5nZXQo\nYm9va2llSVApKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIHB1Ymxpc2hTdXNwZWN0ZWRMZWRnZXJzKFN0cmluZyBib29raWVJUCwgU2V0\nPExvbmc+IGxlZGdlcnMpCiAgICAgICAgICAgIHRocm93cyBCS0F1ZGl0RXhj\nZXB0aW9uIHsKICAgICAgICBpZiAobnVsbCA9PSBsZWRnZXJzIHx8IGxlZGdl\ncnMuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgLy8gdGhlcmUgaXMgbm8g\nbGVkZ2VycyBhdmFpbGFibGUgZm9yIHRoaXMgYm9va2llIGFuZCBqdXN0CiAg\nICAgICAgICAgIC8vIGlnbm9yaW5nIHRoZSBib29raWUgZmFpbHVyZXMKICAg\nICAgICAgICAgTE9HLmluZm8oIlRoZXJlIGlzIG5vIGxlZGdlcnMgZm9yIHRo\nZSBmYWlsZWQgYm9va2llOiAiICsgYm9va2llSVApOwogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQogICAgICAgIExPRy5pbmZvKCJGb2xsb3dpbmcg\nbGVkZ2VyczogIiArIGxlZGdlcnMgKyAiIG9mIGJvb2tpZTogIiArIGJvb2tp\nZUlQCiAgICAgICAgICAgICAgICArICIgYXJlIGlkZW50aWZpZWQgYXMgdW5k\nZXJyZXBsaWNhdGVkIik7CiAgICAgICAgZm9yIChMb25nIGxlZGdlcklkIDog\nbGVkZ2VycykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nbGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdlclVuZGVy\ncmVwbGljYXRlZCgKICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VySWQs\nIGJvb2tpZUlQKTsKICAgICAgICAgICAgfSBjYXRjaCAoVW5hdmFpbGFibGVF\neGNlcHRpb24gdWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBCS0F1\nZGl0RXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAiRmFpbGVk\nIHRvIHB1Ymxpc2ggdW5kZXJyZXBsaWNhdGVkIGxlZGdlcjogIiArIGxlZGdl\ncklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIG9mIGJv\nb2tpZTogIiArIGJvb2tpZUlQLCB1ZSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBQcm9jZXNzIHRoZSByZXN1bHQg\ncmV0dXJuZWQgZnJvbSBjaGVja2luZyBhIGxlZGdlcgogICAgICovCiAgICBw\ncml2YXRlIGNsYXNzIFByb2Nlc3NMb3N0RnJhZ21lbnRzQ2IgaW1wbGVtZW50\ncyBHZW5lcmljQ2FsbGJhY2s8U2V0PExlZGdlckZyYWdtZW50Pj4gewogICAg\nICAgIGZpbmFsIExlZGdlckhhbmRsZSBsaDsKICAgICAgICBmaW5hbCBBc3lu\nY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBjYWxsYmFjazsKCiAgICAgICAgUHJv\nY2Vzc0xvc3RGcmFnbWVudHNDYihMZWRnZXJIYW5kbGUgbGgsIEFzeW5jQ2Fs\nbGJhY2suVm9pZENhbGxiYWNrIGNhbGxiYWNrKSB7CiAgICAgICAgICAgIHRo\naXMubGggPSBsaDsKICAgICAgICAgICAgdGhpcy5jYWxsYmFjayA9IGNhbGxi\nYWNrOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9u\nQ29tcGxldGUoaW50IHJjLCBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IGZyYWdtZW50\ncykgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKHJj\nID09IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAg\nICBTZXQ8SW5ldFNvY2tldEFkZHJlc3M+IGJvb2tpZXMgPSBTZXRzLm5ld0hh\nc2hTZXQoKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKExlZGdlckZyYWdt\nZW50IGYgOiBmcmFnbWVudHMpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nYm9va2llcy5hZGQoZi5nZXRBZGRyZXNzKCkpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBmb3IgKEluZXRTb2NrZXRBZGRy\nZXNzIGJvb2tpZSA6IGJvb2tpZXMpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgcHVibGlzaFN1c3BlY3RlZExlZGdlcnMoU3RyaW5nVXRpbHMuYWRkclRv\nU3RyaW5nKGJvb2tpZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIFNldHMubmV3SGFzaFNldChsaC5nZXRJZCgp\nKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRj\naCAoQktFeGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJy\nb3IoIkVycm9yIGNsb3NpbmcgbGgiLCBia2UpOwogICAgICAgICAgICAgICAg\naWYgKHJjID09IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAg\nICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuUmVwbGljYXRpb25FeGNl\ncHRpb247CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkludGVycnVwdGVkIHB1Ymxpc2hpbmcgc3VzcGVjdGVkIGxl\nZGdlciIsIGllKTsKICAgICAgICAgICAgICAgIFRocmVhZC5jdXJyZW50VGhy\nZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAgICBpZiAocmMgPT0g\nQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAgICAgICAgIHJj\nID0gQktFeGNlcHRpb24uQ29kZS5JbnRlcnJ1cHRlZEV4Y2VwdGlvbjsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoQktBdWRpdEV4\nY2VwdGlvbiBia2FlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkF1\nZGl0b3IgZXhjZXB0aW9uIHB1Ymxpc2hpbmcgc3VzcGVjdGVkIGxlZGdlciIs\nIGJrYWUpOwogICAgICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9u\nLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICByYyA9IEJLRXhjZXB0\naW9uLkNvZGUuUmVwbGljYXRpb25FeGNlcHRpb247CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNhbGxiYWNrLnByb2Nl\nc3NSZXN1bHQocmMsIG51bGwsIG51bGwpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIExpc3QgYWxsIHRoZSBsZWRnZXJzIGFuZCBjaGVjayB0\naGVtIGluZGl2aWR1YWxseS4gVGhpcyBzaG91bGQgbm90CiAgICAgKiBiZSBy\ndW4gdmVyeSBvZnRlbi4KICAgICAqLwogICAgdm9pZCBjaGVja0FsbExlZGdl\ncnMoKSB0aHJvd3MgQktBdWRpdEV4Y2VwdGlvbiwgQktFeGNlcHRpb24sCiAg\nICAgICAgICAgIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwg\nS2VlcGVyRXhjZXB0aW9uIHsKICAgICAgICBab29LZWVwZXJXYXRjaGVyQmFz\nZSB3ID0gbmV3IFpvb0tlZXBlcldhdGNoZXJCYXNlKGNvbmYuZ2V0WmtUaW1l\nb3V0KCkpOwogICAgICAgIFpvb0tlZXBlciBuZXd6ayA9IFprVXRpbHMuY3Jl\nYXRlQ29ubmVjdGVkWm9va2VlcGVyQ2xpZW50KGNvbmYuZ2V0WmtTZXJ2ZXJz\nKCksIHcpOwoKICAgICAgICBmaW5hbCBCb29rS2VlcGVyIGNsaWVudCA9IG5l\ndyBCb29rS2VlcGVyKG5ldyBDbGllbnRDb25maWd1cmF0aW9uKGNvbmYpLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgbmV3emspOwogICAgICAgIGZpbmFsIEJvb2tLZWVwZXJBZG1pbiBhZG1p\nbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oY2xpZW50KTsKCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgZmluYWwgTGVkZ2VyQ2hlY2tlciBjaGVja2VyID0g\nbmV3IExlZGdlckNoZWNrZXIoY2xpZW50KTsKCiAgICAgICAgICAgIGZpbmFs\nIEF0b21pY0ludGVnZXIgcmV0dXJuQ29kZSA9IG5ldyBBdG9taWNJbnRlZ2Vy\nKEJLRXhjZXB0aW9uLkNvZGUuT0spOwogICAgICAgICAgICBmaW5hbCBDb3Vu\ndERvd25MYXRjaCBwcm9jZXNzRG9uZSA9IG5ldyBDb3VudERvd25MYXRjaCgx\nKTsKCiAgICAgICAgICAgIFByb2Nlc3NvcjxMb25nPiBjaGVja0xlZGdlcnNQ\ncm9jZXNzb3IgPSBuZXcgUHJvY2Vzc29yPExvbmc+KCkgewogICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBw\ncm9jZXNzKGZpbmFsIExvbmcgbGVkZ2VySWQsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9pZENh\nbGxiYWNrIGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFsZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlci5pc0xlZGdlclJlcGxpY2F0aW9uRW5hYmxlZCgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2Vy\nIHJlcmVwbGljYXRpb24gaGFzIGJlZW4gZGlzYWJsZWQsIGFib3J0aW5nIHBl\ncmlvZGljIGNoZWNrIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBw\ncm9jZXNzRG9uZS5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKFJlcGxpY2F0aW9uRXhjZXB0aW9u\nLlVuYXZhaWxhYmxlRXhjZXB0aW9uIHVlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIExPRy5lcnJvcigiVW5kZXJyZXBsaWNhdGlvbiBtYW5hZ2VyIHVu\nYXZhaWxhYmxlICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsicnVubmluZyBwZXJpb2RpYyBjaGVjayIsIHVlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgcHJvY2Vzc0RvbmUuY291bnREb3duKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgICAgIExlZGdlckhhbmRsZSBsaCA9IG51bGw7\nCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgbGggPSBhZG1pbi5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrZXIuY2hlY2tMZWRn\nZXIobGgsIG5ldyBQcm9jZXNzTG9zdEZyYWdtZW50c0NiKGxoLCBjYWxsYmFj\naykpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9u\nLkJLTm9TdWNoTGVkZ2VyRXhpc3RzRXhjZXB0aW9uIGJrbnNsZSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkxlZGdlciB3YXMgZGVs\nZXRlZCBiZWZvcmUgd2UgY291bGQgY2hlY2sgaXQiLCBia25zbGUpOwogICAg\nICAgICAgICAgICAgICAgICAgICBjYWxsYmFjay5wcm9jZXNzUmVzdWx0KEJL\nRXhjZXB0aW9uLkNvZGUuT0ssCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJDb3VsZG4ndCBvcGVuIGxlZGdlciAiICsgbGVkZ2Vy\nSWQsIGJrZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLnBy\nb2Nlc3NSZXN1bHQoQktFeGNlcHRpb24uQ29kZS5Cb29raWVIYW5kbGVOb3RB\ndmFpbGFibGVFeGNlcHRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJ\nbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBMT0cuZXJyb3IoIkludGVycnVwdGVkIG9wZW5pbmcgbGVkZ2VyIiwg\naWUpOwogICAgICAgICAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRo\ncmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAgICAgICAgICBj\nYWxsYmFjay5wcm9jZXNzUmVzdWx0KEJLRXhjZXB0aW9uLkNvZGUuSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfSBmaW5hbGx5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxoICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGJrZSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJDb3Vs\nZG4ndCBjbG9zZSBsZWRnZXIgIiArIGxlZGdlcklkLCBia2UpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNl\ncHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBM\nT0cud2FybigiSW50ZXJydXB0ZWQgY2xvc2luZyBsZWRnZXIgIiArIGxlZGdl\ncklkLCBpZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGhy\nZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfTsKCiAgICAgICAgICAgIGxlZGdlck1hbmFnZXIuYXN5bmNQcm9j\nZXNzTGVkZ2VycyhjaGVja0xlZGdlcnNQcm9jZXNzb3IsCiAgICAgICAgICAg\nICAgICAgICAgbmV3IEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNrKCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMs\nIFN0cmluZyBzLCBPYmplY3Qgb2JqKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICByZXR1cm5Db2RlLnNldChyYyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBwcm9jZXNzRG9uZS5jb3VudERvd24oKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0sIG51bGws\nIEJLRXhjZXB0aW9uLkNvZGUuT0ssIEJLRXhjZXB0aW9uLkNvZGUuUmVhZEV4\nY2VwdGlvbik7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBw\ncm9jZXNzRG9uZS5hd2FpdCgpOwogICAgICAgICAgICB9IGNhdGNoIChJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBUaHJlYWQu\nY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICAgICAg\ndGhyb3cgbmV3IEJLQXVkaXRFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgICJFeGNlcHRpb24gd2hpbGUgY2hlY2tpbmcgbGVkZ2VycyIsIGUp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXR1cm5Db2RlLmdl\ndCgpICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAg\nIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShyZXR1cm5Db2RlLmdldCgpKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAg\nIGFkbWluLmNsb3NlKCk7CiAgICAgICAgICAgIGNsaWVudC5jbG9zZSgpOwog\nICAgICAgICAgICBuZXd6ay5jbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAg\nICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIGF2YWlsYWJsZUJvb2tpZXND\naGFuZ2VkKCkgewogICAgICAgIHN1Ym1pdEF1ZGl0VGFzaygpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2h1dGRvd24gdGhlIGF1ZGl0b3IKICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2h1dGRvd24oKSB7CiAgICAgICAgTE9HLmluZm8o\nIlNodXR0aW5nIGRvd24gYXVkaXRvciIpOwogICAgICAgIHN1Ym1pdFNodXRk\nb3duVGFzaygpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICB3aGlsZSAo\nIWV4ZWN1dG9yLmF3YWl0VGVybWluYXRpb24oMzAsIFRpbWVVbml0LlNFQ09O\nRFMpKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRXhlY3V0b3Igbm90\nIHNodXR0aW5nIGRvd24sIGludGVycnVwdGluZyIpOwogICAgICAgICAgICAg\nICAgZXhlY3V0b3Iuc2h1dGRvd25Ob3coKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBhZG1pbi5jbG9zZSgpOwogICAgICAgICAgICBia2MuY2xvc2Uo\nKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkg\newogICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVw\ndCgpOwogICAgICAgICAgICBMT0cud2FybigiSW50ZXJydXB0ZWQgd2hpbGUg\nc2h1dHRpbmcgZG93biBhdWRpdG9yIGJvb2tpZSIsIGllKTsKICAgICAgICB9\nIGNhdGNoIChCS0V4Y2VwdGlvbiBia2UpIHsKICAgICAgICAgICAgTE9HLndh\ncm4oIkV4Y2VwdGlvbiB3aGlsZSBzaHV0dGluZyBkb3duIGF1ZGl0b3IgYm9v\na2llIiwgYmtlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBS\nZXR1cm4gdHJ1ZSBpZiBhdWRpdG9yIGlzIHJ1bm5pbmcgb3RoZXJ3aXNlIHJl\ndHVybiBmYWxzZQogICAgICogCiAgICAgKiBAcmV0dXJuIGF1ZGl0b3Igc3Rh\ndHVzCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzUnVubmluZygpIHsK\nICAgICAgICByZXR1cm4gIWV4ZWN1dG9yLmlzU2h1dGRvd24oKTsKICAgIH0K\nCiAgICBwcml2YXRlIGZpbmFsIFJ1bm5hYmxlIEJPT0tJRV9DSEVDSyA9IG5l\ndyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkg\newogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBh\ndWRpdEJvb2tpZXMoKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhj\nZXB0aW9uIGJrZSkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigi\nQ291bGRuJ3QgZ2V0IGJvb2tpZSBsaXN0LCBleGl0aW5nIiwgYmtlKTsKICAg\nICAgICAgICAgICAgICAgICBzdWJtaXRTaHV0ZG93blRhc2soKTsKICAgICAg\nICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoaWxlIHdh\ndGNoaW5nIGF2YWlsYWJsZSBib29raWVzIiwga2UpOwogICAgICAgICAgICAg\nICAgICAgIHN1Ym1pdFNodXRkb3duVGFzaygpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAg\nICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgp\nOwogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJydXB0ZWQg\nd2hpbGUgd2F0Y2hpbmcgYXZhaWxhYmxlIGJvb2tpZXMgIiwgaWUpOwogICAg\nICAgICAgICAgICAgICAgIHN1Ym1pdFNodXRkb3duVGFzaygpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoQktBdWRpdEV4Y2VwdGlvbiBia2UpIHsKICAg\nICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSB3\nYXRjaGluZyBhdmFpbGFibGUgYm9va2llcyIsIGJrZSk7CiAgICAgICAgICAg\nICAgICAgICAgc3VibWl0U2h1dGRvd25UYXNrKCk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9OwoKfQo=\n","encoding":"base64"}

