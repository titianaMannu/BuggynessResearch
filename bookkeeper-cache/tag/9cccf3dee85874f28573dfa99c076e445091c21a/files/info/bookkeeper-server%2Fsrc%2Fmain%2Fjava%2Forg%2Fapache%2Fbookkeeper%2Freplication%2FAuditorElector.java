{"sha":"3f5e16431d8a6a2281293aaa53ec64985169408b","node_id":"MDQ6QmxvYjE1NzU5NTY6M2Y1ZTE2NDMxZDhhNmEyMjgxMjkzYWFhNTNlYzY0OTg1MTY5NDA4Yg==","size":14369,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3f5e16431d8a6a2281293aaa53ec64985169408b","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZh\nLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBv\ncnQgamF2YS5pby5TZXJpYWxpemFibGU7CmltcG9ydCBqYXZhLmlvLklPRXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkRhdGFGb3JtYXRz\nLkF1ZGl0b3JWb3RlRm9ybWF0OwppbXBvcnQgY29tLmdvb2dsZS5jb21tb24u\nYW5ub3RhdGlvbnMuVmlzaWJsZUZvclRlc3Rpbmc7CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5FeGVjdXRvclNlcnZpY2U7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaHJlYWRGYWN0b3J5OwppbXBvcnQgamF2YS51dGlsLmNvbmN1\ncnJlbnQuYXRvbWljLkF0b21pY0Jvb2xlYW47CgppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlv\nbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci51dGlsLkJvb2tLZWVwZXJDb25zdGFudHM7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdVdGlsczsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuV2F0Y2hlci5FdmVudC5FdmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5XYXRjaGVyLkV2ZW50LktlZXBlclN0YXRlOwppbXBvcnQg\nb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBjb20u\nZ29vZ2xlLnByb3RvYnVmLlRleHRGb3JtYXQ7CmltcG9ydCBzdGF0aWMgY29t\nLmdvb2dsZS5jb21tb24uYmFzZS5DaGFyc2V0cy5VVEZfODsKCmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rv\ncnk7CgovKioKICogUGVyZm9ybWluZyBhdWRpdG9yIGVsZWN0aW9uIHVzaW5n\nIEFwYWNoZSBab29LZWVwZXIuIFVzaW5nIFpvb0tlZXBlciBhcyBhCiAqIGNv\nb3JkaW5hdGlvbiBzZXJ2aWNlLCB3aGVuIGEgYm9va2llIGJpZHMgZm9yIGF1\nZGl0b3IsIGl0IGNyZWF0ZXMgYW4gZXBoZW1lcmFsCiAqIHNlcXVlbnRpYWwg\nZmlsZSAoem5vZGUpIG9uIFpvb0tlZXBlciBhbmQgY29uc2lkZXJlZCBhcyB0\naGVpciB2b3RlLiBWb3RlCiAqIGZvcm1hdCBpcyAnVl9zZXF1ZW5jZW51bWJl\ncicuIEVsZWN0aW9uIHdpbGwgYmUgZG9uZSBieSBjb21wYXJpbmcgdGhlCiAq\nIGVwaGVtZXJhbCBzZXF1ZW50aWFsIG51bWJlcnMgYW5kIHRoZSBib29raWUg\nd2hpY2ggaGFzIGNyZWF0ZWQgdGhlIGxlYXN0IHpub2RlCiAqIHdpbGwgYmUg\nZWxlY3RlZCBhcyBBdWRpdG9yLiBBbGwgdGhlIG90aGVyIGJvb2tpZXMgd2ls\nbCBiZSB3YXRjaGluZyBvbiB0aGVpcgogKiBwcmVkZWNlc3NvciB6bm9kZSBh\nY2NvcmRpbmcgdG8gdGhlIGVwaGVtZXJhbCBzZXF1ZW5jZSBudW1iZXJzLgog\nKi8KcHVibGljIGNsYXNzIEF1ZGl0b3JFbGVjdG9yIHsKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAg\nICAgICAgIC5nZXRMb2dnZXIoQXVkaXRvckVsZWN0b3IuY2xhc3MpOwogICAg\nLy8gUmVwcmVzZW50cyB0aGUgaW5kZXggb2YgdGhlIGF1ZGl0b3Igbm9kZQog\nICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IEFVRElUT1JfSU5ERVggPSAw\nOwogICAgLy8gUmVwcmVzZW50cyB2b3RlIHByZWZpeAogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgU3RyaW5nIFZPVEVfUFJFRklYID0gIlZfIjsKICAgIC8v\nIFJlcHJlc2VudHMgcGF0aCBTZXBhcmF0b3IKICAgIHByaXZhdGUgc3RhdGlj\nIGZpbmFsIFN0cmluZyBQQVRIX1NFUEFSQVRPUiA9ICIvIjsKICAgIHByaXZh\ndGUgc3RhdGljIGZpbmFsIFN0cmluZyBFTEVDVElPTl9aTk9ERSA9ICJhdWRp\ndG9yZWxlY3Rpb24iOwogICAgLy8gUmVwcmVzZW50cyB1ckxlZGdlciBwYXRo\nIGluIHprCiAgICBwcml2YXRlIGZpbmFsIFN0cmluZyBiYXNlUGF0aDsKICAg\nIC8vIFJlcHJlc2VudHMgYXVkaXRvciBlbGVjdGlvbiBwYXRoIGluIHprCiAg\nICBwcml2YXRlIGZpbmFsIFN0cmluZyBlbGVjdGlvblBhdGg7CgogICAgcHJp\ndmF0ZSBmaW5hbCBTdHJpbmcgYm9va2llSWQ7CiAgICBwcml2YXRlIGZpbmFs\nIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjsKICAgIHByaXZhdGUgZmluYWwg\nWm9vS2VlcGVyIHprYzsKICAgIHByaXZhdGUgZmluYWwgRXhlY3V0b3JTZXJ2\naWNlIGV4ZWN1dG9yOwoKICAgIHByaXZhdGUgU3RyaW5nIG15Vm90ZTsKICAg\nIEF1ZGl0b3IgYXVkaXRvcjsKICAgIHByaXZhdGUgQXRvbWljQm9vbGVhbiBy\ndW5uaW5nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwoKCiAgICAvKioK\nICAgICAqIEF1ZGl0b3JFbGVjdG9yIGZvciBwZXJmb3JtaW5nIHRoZSBhdWRp\ndG9yIGVsZWN0aW9uCiAgICAgKiAKICAgICAqIEBwYXJhbSBib29raWVJZAog\nICAgICogICAgICAgICAgICAtIGJvb2tpZSBpZGVudGlmaWVyLCBjb21wcmlz\nZXMgSG9zdEFkZHJlc3M6UG9ydAogICAgICogQHBhcmFtIGNvbmYKICAgICAq\nICAgICAgICAgICAgLSBjb25maWd1cmF0aW9uCiAgICAgKiBAcGFyYW0gemtj\nCiAgICAgKiAgICAgICAgICAgIC0gWksgaW5zdGFuY2UKICAgICAqIEB0aHJv\nd3MgVW5hdmFpbGFibGVFeGNlcHRpb24KICAgICAqICAgICAgICAgICAgIHRo\ncm93cyB1bmF2YWlsYWJsZSBleGNlcHRpb24gd2hpbGUgaW5pdGlhbGl6aW5n\nIHRoZSBlbGVjdG9yCiAgICAgKi8KICAgIHB1YmxpYyBBdWRpdG9yRWxlY3Rv\ncihmaW5hbCBTdHJpbmcgYm9va2llSWQsIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiwKICAgICAgICAgICAgICAgICAgICAgICAgICBab29LZWVwZXIgemtj\nKSB0aHJvd3MgVW5hdmFpbGFibGVFeGNlcHRpb24gewogICAgICAgIHRoaXMu\nYm9va2llSWQgPSBib29raWVJZDsKICAgICAgICB0aGlzLmNvbmYgPSBjb25m\nOwogICAgICAgIHRoaXMuemtjID0gemtjOwogICAgICAgIGJhc2VQYXRoID0g\nY29uZi5nZXRaa0xlZGdlcnNSb290UGF0aCgpICsgJy8nCiAgICAgICAgICAg\nICAgICArIEJvb2tLZWVwZXJDb25zdGFudHMuVU5ERVJfUkVQTElDQVRJT05f\nTk9ERTsKICAgICAgICBlbGVjdGlvblBhdGggPSBiYXNlUGF0aCArICcvJyAr\nIEVMRUNUSU9OX1pOT0RFOwogICAgICAgIGNyZWF0ZUVsZWN0b3JQYXRoKCk7\nCiAgICAgICAgZXhlY3V0b3IgPSBFeGVjdXRvcnMubmV3U2luZ2xlVGhyZWFk\nRXhlY3V0b3IobmV3IFRocmVhZEZhY3RvcnkoKSB7CiAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBUaHJlYWQgbmV3\nVGhyZWFkKFJ1bm5hYmxlIHIpIHsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gbmV3IFRocmVhZChyLCAiQXVkaXRvckVsZWN0b3ItIitib29raWVJZCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgfQoKCgog\nICAgcHJpdmF0ZSB2b2lkIGNyZWF0ZU15Vm90ZSgpIHRocm93cyBLZWVwZXJF\neGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nbnVsbCA9PSBteVZvdGUgfHwgbnVsbCA9PSB6a2MuZXhpc3RzKG15Vm90ZSwg\nZmFsc2UpKSB7CiAgICAgICAgICAgIEF1ZGl0b3JWb3RlRm9ybWF0LkJ1aWxk\nZXIgYnVpbGRlciA9IEF1ZGl0b3JWb3RlRm9ybWF0Lm5ld0J1aWxkZXIoKQog\nICAgICAgICAgICAgICAgLnNldEJvb2tpZUlkKGJvb2tpZUlkKTsKICAgICAg\nICAgICAgbXlWb3RlID0gemtjLmNyZWF0ZShnZXRWb3RlUGF0aChQQVRIX1NF\nUEFSQVRPUiArIFZPVEVfUFJFRklYKSwKICAgICAgICAgICAgICAgICAgICBU\nZXh0Rm9ybWF0LnByaW50VG9TdHJpbmcoYnVpbGRlci5idWlsZCgpKS5nZXRC\neXRlcyhVVEZfOCksIElkcy5PUEVOX0FDTF9VTlNBRkUsCiAgICAgICAgICAg\nICAgICAgICAgQ3JlYXRlTW9kZS5FUEhFTUVSQUxfU0VRVUVOVElBTCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgU3RyaW5nIGdldFZvdGVQYXRo\nKFN0cmluZyB2b3RlKSB7CiAgICAgICAgcmV0dXJuIGVsZWN0aW9uUGF0aCAr\nIHZvdGU7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIGNyZWF0ZUVsZWN0b3JQ\nYXRoKCkgdGhyb3dzIFVuYXZhaWxhYmxlRXhjZXB0aW9uIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoemtjLmV4aXN0cyhiYXNlUGF0aCwgZmFs\nc2UpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICAgICAgemtjLmNyZWF0ZShiYXNlUGF0aCwgbmV3IGJ5dGVbMF0s\nIElkcy5PUEVOX0FDTF9VTlNBRkUsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBDcmVhdGVNb2RlLlBFUlNJU1RFTlQpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLk5vZGVFeGlzdHNFeGNlcHRpb24g\nbmVlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZywgc29t\nZW9uZSBlbHNlIGNvdWxkIGhhdmUgY3JlYXRlZCBpdAogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh6a2MuZXhpc3Rz\nKGdldFZvdGVQYXRoKCIiKSwgZmFsc2UpID09IG51bGwpIHsKICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgemtjLmNyZWF0ZShn\nZXRWb3RlUGF0aCgiIiksIG5ldyBieXRlWzBdLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgSWRzLk9QRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5Q\nRVJTSVNURU5UKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4\nY2VwdGlvbi5Ob2RlRXhpc3RzRXhjZXB0aW9uIG5lZSkgewogICAgICAgICAg\nICAgICAgICAgIC8vIGRvIG5vdGhpbmcsIHNvbWVvbmUgZWxzZSBjb3VsZCBo\nYXZlIGNyZWF0ZWQgaXQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAg\nICAgICAgICB0aHJvdyBuZXcgVW5hdmFpbGFibGVFeGNlcHRpb24oCiAgICAg\nICAgICAgICAgICAgICAgIkZhaWxlZCB0byBpbml0aWFsaXplIEF1ZGl0b3Ig\nRWxlY3RvciIsIGtlKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBpZSkgewogICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVh\nZCgpLmludGVycnVwdCgpOwogICAgICAgICAgICB0aHJvdyBuZXcgVW5hdmFp\nbGFibGVFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0\nbyBpbml0aWFsaXplIEF1ZGl0b3IgRWxlY3RvciIsIGllKTsKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXYXRjaGluZyB0aGUgcHJlZGVjZXNz\nb3IgYm9va2llcyBhbmQgd2lsbCBkbyBlbGVjdGlvbiBvbiBwcmVkZWNlc3Nv\nciBub2RlCiAgICAgKiBkZWxldGlvbiBvciBleHBpcmF0aW9uLgogICAgICov\nCiAgICBwcml2YXRlIGNsYXNzIEVsZWN0aW9uV2F0Y2hlciBpbXBsZW1lbnRz\nIFdhdGNoZXIgewogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2\nb2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAg\nIGlmIChldmVudC5nZXRTdGF0ZSgpID09IEtlZXBlclN0YXRlLkV4cGlyZWQp\nIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiTG9zdCBaSyBjb25uZWN0\naW9uLCBzaHV0dGluZyBkb3duIik7CiAgICAgICAgICAgICAgICBzdWJtaXRT\naHV0ZG93blRhc2soKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChldmVudC5n\nZXRUeXBlKCkgPT0gRXZlbnRUeXBlLk5vZGVEZWxldGVkKSB7CiAgICAgICAg\nICAgICAgICBzdWJtaXRFbGVjdGlvblRhc2soKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzdGFydCgpIHsKICAg\nICAgICBydW5uaW5nLnNldCh0cnVlKTsKICAgICAgICBzdWJtaXRFbGVjdGlv\nblRhc2soKTsKICAgIH0KCiAgICAvKioKICAgICAqIFJ1biBjbGVhbnVwIG9w\nZXJhdGlvbnMgZm9yIHRoZSBhdWRpdG9yIGVsZWN0b3IuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBzdWJtaXRTaHV0ZG93blRhc2soKSB7CiAgICAgICAg\nZXhlY3V0b3Iuc3VibWl0KG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICBp\nZiAoIXJ1bm5pbmcuY29tcGFyZUFuZFNldCh0cnVlLCBmYWxzZSkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiU2h1dHRpbmcg\nZG93biBBdWRpdG9yRWxlY3RvciIpOwogICAgICAgICAgICAgICAgICAgIGlm\nIChteVZvdGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgemtjLmRlbGV0ZSht\neVZvdGUsIC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIExPRy53YXJuKCJJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB3aGls\nZSBkZWxldGluZyBteVZvdGU6ICIgKyBteVZvdGUsCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBpZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBrZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gd2hp\nbGUgZGVsZXRpbmcgbXlWb3RlOiIgKyBteVZvdGUsIGtlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBQZXJmb3JtaW5nIHRoZSBhdWRpdG9yIGVsZWN0aW9uIHVzaW5nIHRo\nZSBab29LZWVwZXIgZXBoZW1lcmFsIHNlcXVlbnRpYWwKICAgICAqIHpub2Rl\nLiBUaGUgYm9va2llIHdoaWNoIGhhcyBjcmVhdGVkIHRoZSBsZWFzdCBzZXF1\nZW50aWFsIHdpbGwgYmUgZWxlY3QgYXMKICAgICAqIEF1ZGl0b3IuCiAgICAg\nKi8KICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgdm9pZCBzdWJtaXRFbGVj\ndGlvblRhc2soKSB7CgogICAgICAgIFJ1bm5hYmxlIHIgPSBuZXcgUnVubmFi\nbGUoKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKCFydW5uaW5nLmdldCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gY3JlYXRpbmcgbXkgdm90ZSBpbiB6ay4gVm90ZSBmb3Jt\nYXQgaXMgJ1ZfbnVtZXJpYycKICAgICAgICAgICAgICAgICAgICAgICAgY3Jl\nYXRlTXlWb3RlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIExpc3Q8U3Ry\naW5nPiBjaGlsZHJlbiA9IHprYy5nZXRDaGlsZHJlbihnZXRWb3RlUGF0aCgi\nIiksIGZhbHNlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgwID49\nIGNoaWxkcmVuLnNpemUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkF0bGVhc3Qgb25lIGJv\nb2tpZSBzZXJ2ZXIgc2hvdWxkIHByZXNlbnQgdG8gZWxlY3QgdGhlIEF1ZGl0\nb3IhIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIHNvcnRpbmcgaW4gYXNjZW5kaW5nIG9yZGVyIG9m\nIHNlcXVlbnRpYWwgbnVtYmVyCiAgICAgICAgICAgICAgICAgICAgICAgIENv\nbGxlY3Rpb25zLnNvcnQoY2hpbGRyZW4sIG5ldyBFbGVjdGlvbkNvbXBhcmF0\nb3IoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyB2b3RlTm9k\nZSA9IFN0cmluZ1V0aWxzLnN1YnN0cmluZ0FmdGVyTGFzdChteVZvdGUsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBQQVRIX1NFUEFSQVRPUik7Cgog\nICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGFydGluZyBBdWRpdGluZyBz\nZXJ2aWNlCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZHJlbi5n\nZXQoQVVESVRPUl9JTkRFWCkuZXF1YWxzKHZvdGVOb2RlKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBhdWRpdG9yIGJv\nb2tpZSBpZCBpbiB0aGUgZWxlY3Rpb24gcGF0aC4gVGhpcyBpcwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gZG9uZSBmb3IgZGVidWdnaW5nIHB1\ncnBvc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEF1ZGl0b3JWb3Rl\nRm9ybWF0LkJ1aWxkZXIgYnVpbGRlciA9IEF1ZGl0b3JWb3RlRm9ybWF0Lm5l\nd0J1aWxkZXIoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5z\nZXRCb29raWVJZChib29raWVJZCk7CgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgemtjLnNldERhdGEoZ2V0Vm90ZVBhdGgoIiIpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVGV4dEZvcm1hdC5wcmlu\ndFRvU3RyaW5nKGJ1aWxkZXIuYnVpbGQoKSkuZ2V0Qnl0ZXMoVVRGXzgpLCAt\nMSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdWRpdG9yID0gbmV3\nIEF1ZGl0b3IoYm9va2llSWQsIGNvbmYsIHprYyk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBhdWRpdG9yLnN0YXJ0KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyBJZiBub3QgYW4gYXVkaXRvciwgd2lsbCBiZSB3YXRjaGluZyB0byBt\neSBwcmVkZWNlc3NvciBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGxvb2tpbmcgdGhlIHByZXZpb3VzIG5vZGUgZGVsZXRpb24uCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBXYXRjaGVyIGVsZWN0aW9uV2F0Y2hl\nciA9IG5ldyBFbGVjdGlvbldhdGNoZXIoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGludCBteUluZGV4ID0gY2hpbGRyZW4uaW5kZXhPZih2b3Rl\nTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgcHJldk5v\nZGVJbmRleCA9IG15SW5kZXggLSAxOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKG51bGwgPT0gemtjLmV4aXN0cyhnZXRWb3RlUGF0aChQQVRI\nX1NFUEFSQVRPUikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyBjaGlsZHJlbi5nZXQocHJldk5vZGVJbmRl\neCksIGVsZWN0aW9uV2F0Y2hlcikpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAvLyBXaGlsZSBhZGRpbmcsIHRoZSBwcmV2aW91cyB6bm9k\nZSBkb2Vzbid0IGV4aXN0cy4KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBBZ2FpbiBnb2luZyB0byBlbGVjdGlvbi4KICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzdWJtaXRFbGVjdGlvblRhc2soKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiRXhjZXB0aW9uIHdoaWxlIHBlcmZvcm1pbmcgYXVkaXRvciBlbGVjdGlv\nbiIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRTaHV0ZG93\nblRhc2soKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiSW50ZXJydXB0ZWQgd2hpbGUgcGVyZm9ybWluZyBhdWRpdG9y\nIGVsZWN0aW9uIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIFRocmVh\nZC5jdXJyZW50VGhyZWFkKCkuaW50ZXJydXB0KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHN1Ym1pdFNodXRkb3duVGFzaygpOwogICAgICAgICAgICAg\nICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJMZWRnZXIgdW5kZXJy\nZXBsaWNhdGlvbiBtYW5hZ2VyIHVuYXZhaWxhYmxlIGR1cmluZyBlbGVjdGlv\nbiIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXRTaHV0ZG93\nblRhc2soKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH07CiAgICAgICAgZXhlY3V0b3Iuc3VibWl0KHIp\nOwogICAgfQoKICAgIEBWaXNpYmxlRm9yVGVzdGluZwogICAgQXVkaXRvciBn\nZXRBdWRpdG9yKCkgewogICAgICAgIHJldHVybiBhdWRpdG9yOwogICAgfQoK\nICAgIC8qKgogICAgICogUXVlcnkgem9va2VlcGVyIGZvciB0aGUgY3VycmVu\ndGx5IGVsZWN0ZWQgYXVkaXRvcgogICAgICogQHJldHVybiB0aGUgYm9va2ll\nIGlkIG9mIHRoZSBjdXJyZW50IGF1ZGl0b3IKICAgICAqLwogICAgcHVibGlj\nIHN0YXRpYyBJbmV0U29ja2V0QWRkcmVzcyBnZXRDdXJyZW50QXVkaXRvcihT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYsIFpvb0tlZXBlciB6aykKICAgICAg\nICAgICAgdGhyb3dzIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNl\ncHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgZWxlY3Rpb25S\nb290ID0gY29uZi5nZXRaa0xlZGdlcnNSb290UGF0aCgpICsgJy8nCiAgICAg\nICAgICAgICsgQm9va0tlZXBlckNvbnN0YW50cy5VTkRFUl9SRVBMSUNBVElP\nTl9OT0RFICsgJy8nICsgRUxFQ1RJT05fWk5PREU7CgogICAgICAgIExpc3Q8\nU3RyaW5nPiBjaGlsZHJlbiA9IHprLmdldENoaWxkcmVuKGVsZWN0aW9uUm9v\ndCwgZmFsc2UpOwogICAgICAgIENvbGxlY3Rpb25zLnNvcnQoY2hpbGRyZW4s\nIG5ldyBBdWRpdG9yRWxlY3Rvci5FbGVjdGlvbkNvbXBhcmF0b3IoKSk7CiAg\nICAgICAgaWYgKGNoaWxkcmVuLnNpemUoKSA8IDEpIHsKICAgICAgICAgICAg\ncmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIFN0cmluZyBsZWRnZXIg\nPSBlbGVjdGlvblJvb3QgKyAiLyIgKyBjaGlsZHJlbi5nZXQoQVVESVRPUl9J\nTkRFWCk7CiAgICAgICAgYnl0ZVtdIGRhdGEgPSB6ay5nZXREYXRhKGxlZGdl\nciwgZmFsc2UsIG51bGwpOwoKICAgICAgICBBdWRpdG9yVm90ZUZvcm1hdC5C\ndWlsZGVyIGJ1aWxkZXIgPSBBdWRpdG9yVm90ZUZvcm1hdC5uZXdCdWlsZGVy\nKCk7CiAgICAgICAgVGV4dEZvcm1hdC5tZXJnZShuZXcgU3RyaW5nKGRhdGEs\nIFVURl84KSwgYnVpbGRlcik7CiAgICAgICAgQXVkaXRvclZvdGVGb3JtYXQg\ndiA9IGJ1aWxkZXIuYnVpbGQoKTsKICAgICAgICBTdHJpbmdbXSBwYXJ0cyA9\nIHYuZ2V0Qm9va2llSWQoKS5zcGxpdCgiOiIpOwogICAgICAgIHJldHVybiBu\nZXcgSW5ldFNvY2tldEFkZHJlc3MocGFydHNbMF0sCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIEludGVnZXIudmFsdWVPZihwYXJ0\nc1sxXSkpOwogICAgfQoKICAgIC8qKgogICAgICogU2h1dHRpbmcgZG93biBB\ndWRpdG9yRWxlY3RvcgogICAgICovCiAgICBwdWJsaWMgdm9pZCBzaHV0ZG93\nbigpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgIGlmIChleGVjdXRvci5p\nc1NodXRkb3duKCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBzdWJtaXRTaHV0ZG93blRhc2soKTsKICAg\nICAgICAgICAgZXhlY3V0b3Iuc2h1dGRvd24oKTsKICAgICAgICB9CgogICAg\nICAgIGlmIChhdWRpdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgYXVkaXRv\nci5zaHV0ZG93bigpOwogICAgICAgICAgICBhdWRpdG9yID0gbnVsbDsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJZiBjdXJyZW50IGJvb2tp\nZSBpcyBydW5uaW5nIGFzIGF1ZGl0b3IsIHJldHVybiB0aGUgc3RhdHVzIG9m\nIHRoZQogICAgICogYXVkaXRvci4gT3RoZXJ3aXNlIHJldHVybiB0aGUgc3Rh\ndHVzIG9mIGVsZWN0b3IuCiAgICAgKiAKICAgICAqIEByZXR1cm4KICAgICAq\nLwogICAgcHVibGljIGJvb2xlYW4gaXNSdW5uaW5nKCkgewogICAgICAgIGlm\nIChhdWRpdG9yICE9IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGF1ZGl0\nb3IuaXNSdW5uaW5nKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBydW5u\naW5nLmdldCgpOwogICAgfQoKICAgIC8qKgogICAgICogQ29tcGFyZSB0aGUg\ndm90ZXMgaW4gdGhlIGFzY2VuZGluZyBvcmRlciBvZiB0aGUgc2VxdWVuY2Ug\nbnVtYmVyLiBWb3RlCiAgICAgKiBmb3JtYXQgaXMgJ1Zfc2VxdWVuY2VudW1i\nZXInLCBjb21wYXJhdG9yIHdpbGwgZG8gc29ydGluZyBiYXNlZCBvbiB0aGUK\nICAgICAqIG51bWVyaWMgc2VxdWVuY2UgdmFsdWUuCiAgICAgKi8KICAgIHBy\naXZhdGUgc3RhdGljIGNsYXNzIEVsZWN0aW9uQ29tcGFyYXRvcgogICAgICAg\nIGltcGxlbWVudHMgQ29tcGFyYXRvcjxTdHJpbmc+LCBTZXJpYWxpemFibGUg\newogICAgICAgIC8qKgogICAgICAgICAqIFJldHVybiAtMSBpZiB0aGUgZmly\nc3Qgdm90ZSBpcyBsZXNzIHRoYW4gc2Vjb25kLiBSZXR1cm4gMSBpZiB0aGUK\nICAgICAgICAgKiBmaXJzdCB2b3RlIGlzIGdyZWF0ZXIgdGhhbiBzZWNvbmQu\nIFJldHVybiAwIGlmIHRoZSB2b3RlcyBhcmUgZXF1YWwuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIGludCBjb21wYXJlKFN0cmluZyB2b3RlMSwgU3Ry\naW5nIHZvdGUyKSB7CiAgICAgICAgICAgIGxvbmcgdm90ZVNlcUlkMSA9IGdl\ndFZvdGVTZXF1ZW5jZUlkKHZvdGUxKTsKICAgICAgICAgICAgbG9uZyB2b3Rl\nU2VxSWQyID0gZ2V0Vm90ZVNlcXVlbmNlSWQodm90ZTIpOwogICAgICAgICAg\nICBpbnQgcmVzdWx0ID0gdm90ZVNlcUlkMSA8IHZvdGVTZXFJZDIgPyAtMQog\nICAgICAgICAgICAgICAgICAgIDogKHZvdGVTZXFJZDEgPiB2b3RlU2VxSWQy\nID8gMSA6IDApOwogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAg\nIH0KCiAgICAgICAgcHJpdmF0ZSBsb25nIGdldFZvdGVTZXF1ZW5jZUlkKFN0\ncmluZyB2b3RlKSB7CiAgICAgICAgICAgIFN0cmluZyB2b3RlSWQgPSBTdHJp\nbmdVdGlscy5zdWJzdHJpbmdBZnRlcih2b3RlLCBWT1RFX1BSRUZJWCk7CiAg\nICAgICAgICAgIHJldHVybiBMb25nLnBhcnNlTG9uZyh2b3RlSWQpOwogICAg\nICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

