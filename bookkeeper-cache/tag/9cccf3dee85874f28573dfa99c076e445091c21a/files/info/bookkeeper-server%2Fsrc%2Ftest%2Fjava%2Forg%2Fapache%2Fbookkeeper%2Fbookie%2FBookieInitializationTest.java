{"sha":"d05bf49b6e0fd0da958afda23cab2ec081bd8caf","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDA1YmY0OWI2ZTBmZDBkYTk1OGFmZGEyM2NhYjJlYzA4MWJkOGNhZg==","size":13461,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d05bf49b6e0fd0da958afda23cab2ec081bd8caf","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuZmFpbDsKCmltcG9ydCBq\nYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uZXQuQmluZEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRBZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnRE\nb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5p\ndDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuQXNzZXJ0OwoKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2llOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWVFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRDb25maWd1\ncmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2Vy\ndmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQm9va0tlZXBlckFkbWluOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci50ZXN0Llpvb0tlZXBlclV0aWw7CmltcG9ydCBvcmcu\nYXBhY2hlLmNvbW1vbnMuaW8uRmlsZVV0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLmRhdGEu\nU3RhdDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5p\ndC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\nCi8qKgogKiBUZXN0aW5nIGJvb2tpZSBpbml0aWFsaXphdGlvbiBjYXNlcwog\nKi8KcHVibGljIGNsYXNzIEJvb2tpZUluaXRpYWxpemF0aW9uVGVzdCB7CiAg\nICBwcml2YXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFj\ndG9yeQogICAgICAgICAgICAuZ2V0TG9nZ2VyKEJvb2tpZUluaXRpYWxpemF0\naW9uVGVzdC5jbGFzcyk7CiAgICBab29LZWVwZXJVdGlsIHprdXRpbDsKICAg\nIFpvb0tlZXBlciB6a2MgPSBudWxsOwogICAgWm9vS2VlcGVyIG5ld3prID0g\nbnVsbDsKCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBzZXR1cFpvb0tl\nZXBlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHprdXRpbCA9IG5l\ndyBab29LZWVwZXJVdGlsKCk7CiAgICAgICAgemt1dGlsLnN0YXJ0U2VydmVy\nKCk7CiAgICAgICAgemtjID0gemt1dGlsLmdldFpvb0tlZXBlckNsaWVudCgp\nOwogICAgfQoKICAgIEBBZnRlcgogICAgcHVibGljIHZvaWQgdGVhckRvd25a\nb29LZWVwZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAobmV3\nemsgIT0gbnVsbCkgewogICAgICAgICAgICBuZXd6ay5jbG9zZSgpOwogICAg\nICAgIH0KICAgICAgICB6a3V0aWwua2lsbFNlcnZlcigpOwogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIGNsYXNzIE1vY2tCb29raWUgZXh0ZW5kcyBCb29r\naWUgewogICAgICAgIE1vY2tCb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBj\nb25mKSB0aHJvd3MgSU9FeGNlcHRpb24sCiAgICAgICAgICAgICAgICBLZWVw\nZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNl\ncHRpb24gewogICAgICAgICAgICBzdXBlcihjb25mKTsKICAgICAgICB9Cgog\nICAgICAgIHZvaWQgdGVzdFJlZ2lzdGVyQm9va2llKFNlcnZlckNvbmZpZ3Vy\nYXRpb24gY29uZikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nc3VwZXIucmVnaXN0ZXJCb29raWUoY29uZik7CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVmVyaWZ5IHRoZSBib29raWUgc2VydmVyIGV4aXQg\nY29kZS4gT24gWm9vS2VlcGVyIGV4Y2VwdGlvbiwgc2hvdWxkIHJldHVybgog\nICAgICogZXhpdCBjb2RlIFpLX1JFR19GQUlMID0gNAogICAgICovCiAgICBA\nVGVzdCh0aW1lb3V0ID0gMjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RXhp\ndENvZGVaS19SRUdfRkFJTCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIEZpbGUgdG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwg\nInRlc3QiKTsKICAgICAgICB0bXBEaXIuZGVsZXRlKCk7CiAgICAgICAgdG1w\nRGlyLm1rZGlyKCk7CgogICAgICAgIGZpbmFsIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAg\nICAgLnNldFprU2VydmVycyhudWxsKS5zZXRKb3VybmFsRGlyTmFtZSh0bXBE\naXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0QWxsb3dMb29wYmFjayh0\ncnVlKS5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyB0bXBEaXIu\nZ2V0UGF0aCgpIH0pOwoKICAgICAgICAvLyBzaW11bGF0aW5nIFpvb0tlZXBl\nciBleGNlcHRpb24gYnkgYXNzaWduaW5nIGEgY2xvc2VkIHprIGNsaWVudCB0\nbyBiawogICAgICAgIEJvb2tpZVNlcnZlciBia1NlcnZlciA9IG5ldyBCb29r\naWVTZXJ2ZXIoY29uZikgewogICAgICAgICAgICBwcm90ZWN0ZWQgQm9va2ll\nIG5ld0Jvb2tpZShTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAg\nICAgICAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uLCBLZWVwZXJFeGNlcHRp\nb24sIEludGVycnVwdGVkRXhjZXB0aW9uLAogICAgICAgICAgICAgICAgICAg\nIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICBNb2NrQm9va2ll\nIGJvb2tpZSA9IG5ldyBNb2NrQm9va2llKGNvbmYpOwogICAgICAgICAgICAg\nICAgYm9va2llLnprID0gemtjOwogICAgICAgICAgICAgICAgemtjLmNsb3Nl\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gYm9va2llOwogICAgICAgICAg\nICB9OwogICAgICAgIH07CgogICAgICAgIGJrU2VydmVyLnN0YXJ0KCk7CiAg\nICAgICAgYmtTZXJ2ZXIuam9pbigpOwogICAgICAgIEFzc2VydC5hc3NlcnRF\ncXVhbHMoIkZhaWxlZCB0byByZXR1cm4gRXhpdENvZGUuWktfUkVHX0ZBSUwi\nLAogICAgICAgICAgICAgICAgRXhpdENvZGUuWktfUkVHX0ZBSUwsIGJrU2Vy\ndmVyLmdldEV4aXRDb2RlKCkpOwogICAgfQoKICAgIC8qKgogICAgICogVmVy\naWZ5IHRoZSBib29raWUgcmVnLiBSZXN0YXJ0aW5nIGJvb2tpZSBzZXJ2ZXIg\nd2lsbCB3YWl0IGZvciB0aGUgc2Vzc2lvbgogICAgICogdGltZW91dCB3aGVu\nIHByZXZpb3VzIHJlZyBub2RlIGV4aXN0cyBpbiB6ay4gT24gek5vZGUgZGVs\nZXRlIGV2ZW50LAogICAgICogc2hvdWxkIGNvbnRpbnVlIHN0YXJ0dXAKICAg\nICAqLwogICAgQFRlc3QodGltZW91dCA9IDIwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEJvb2tpZVJlZ2lzdHJhdGlvbigpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIEZpbGUgdG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgi\nYm9va2llIiwgInRlc3QiKTsKICAgICAgICB0bXBEaXIuZGVsZXRlKCk7CiAg\nICAgICAgdG1wRGlyLm1rZGlyKCk7CgogICAgICAgIGZpbmFsIFNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkK\nICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxsKS5zZXRKb3VybmFsRGly\nTmFtZSh0bXBEaXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0QWxsb3dM\nb29wYmFjayh0cnVlKS5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10g\neyB0bXBEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBmaW5hbCBTdHJpbmcg\nYmtSZWdQYXRoID0gY29uZi5nZXRaa0F2YWlsYWJsZUJvb2tpZXNQYXRoKCkg\nKyAiLyIKICAgICAgICAgICAgICAgICsgSW5ldEFkZHJlc3MuZ2V0TG9jYWxI\nb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSArICI6IgogICAgICAgICAgICAgICAg\nKyBjb25mLmdldEJvb2tpZVBvcnQoKTsKCiAgICAgICAgTW9ja0Jvb2tpZSBi\nID0gbmV3IE1vY2tCb29raWUoY29uZik7CiAgICAgICAgYi56ayA9IHprYzsK\nICAgICAgICBiLnRlc3RSZWdpc3RlckJvb2tpZShjb25mKTsKICAgICAgICBT\ndGF0IGJrUmVnTm9kZTEgPSB6a2MuZXhpc3RzKGJrUmVnUGF0aCwgZmFsc2Up\nOwogICAgICAgIEFzc2VydC5hc3NlcnROb3ROdWxsKCJCb29raWUgcmVnaXN0\ncmF0aW9uIG5vZGUgZG9lc24ndCBleGlzdHMhIiwKICAgICAgICAgICAgICAg\nIGJrUmVnTm9kZTEpOwoKICAgICAgICAvLyBzaW11bGF0aW5nIGJvb2tpZSBy\nZXN0YXJ0LCBvbiByZXN0YXJ0IGJvb2tpZSB3aWxsIGNyZWF0ZSBuZXcKICAg\nICAgICAvLyB6a2NsaWVudCBhbmQgZG9pbmcgdGhlIHJlZ2lzdHJhdGlvbi4K\nICAgICAgICBjcmVhdGVOZXdaS0NsaWVudCgpOwogICAgICAgIGIuemsgPSBu\nZXd6azsKCiAgICAgICAgLy8gZGVsZXRpbmcgdGhlIHpub2RlLCBzbyB0aGF0\nIHRoZSBib29raWUgcmVnaXN0cmF0aW9uIHNob3VsZAogICAgICAgIC8vIGNv\nbnRpbnVlIHN1Y2Nlc3NmdWxseSBvbiBOb2RlRGVsZXRlZCBldmVudAogICAg\nICAgIG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcChjb25mLmdl\ndFprVGltZW91dCgpIC8gMyk7CiAgICAgICAgICAgICAgICAgICAgemtjLmRl\nbGV0ZShia1JlZ1BhdGgsIC0xKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gTm90IGhh\nbmRsaW5nLCBzaW5jZSB0aGUgdGVzdFJlZ2lzdGVyQm9va2llIHdpbGwgZmFp\nbAogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRmFpbGVkIHRvIGRl\nbGV0ZSB0aGUgem5vZGUgOiIgKyBia1JlZ1BhdGgsIGUpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfS5zdGFydCgpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGIudGVzdFJlZ2lzdGVyQm9va2llKGNv\nbmYpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgVGhyb3dhYmxlIHQgPSBlLmdldENhdXNlKCk7CiAgICAgICAgICAg\nIGlmICh0IGluc3RhbmNlb2YgS2VlcGVyRXhjZXB0aW9uKSB7CiAgICAgICAg\nICAgICAgICBLZWVwZXJFeGNlcHRpb24ga2UgPSAoS2VlcGVyRXhjZXB0aW9u\nKSB0OwogICAgICAgICAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUoIkVycm9y\nQ29kZToiICsga2UuY29kZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICsg\nIiwgUmVnaXN0cmF0aW9uIG5vZGUgZXhpc3RzIiwKICAgICAgICAgICAgICAg\nICAgICAgICAga2UuY29kZSgpICE9IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk5P\nREVFWElTVFMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IGU7\nCiAgICAgICAgfQoKICAgICAgICAvLyB2ZXJpZnkgZXBoZW1lcmFsIG93bmVy\nIG9mIHRoZSBia1JlZyB6bm9kZQogICAgICAgIFN0YXQgYmtSZWdOb2RlMiA9\nIG5ld3prLmV4aXN0cyhia1JlZ1BhdGgsIGZhbHNlKTsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0Tm90TnVsbCgiQm9va2llIHJlZ2lzdHJhdGlvbiBoYXMgYmVl\nbiBmYWlsZWQiLCBia1JlZ05vZGUyKTsKICAgICAgICBBc3NlcnQuYXNzZXJ0\nVHJ1ZSgiQm9va2llIGlzIHJlZmVycmluZyB0byBvbGQgcmVnaXN0cmF0aW9u\nIHpub2RlOiIKICAgICAgICAgICAgICAgICsgYmtSZWdOb2RlMSArICIsIE5l\ndyBaTm9kZToiICsgYmtSZWdOb2RlMiwgYmtSZWdOb2RlMQogICAgICAgICAg\nICAgICAgLmdldEVwaGVtZXJhbE93bmVyKCkgIT0gYmtSZWdOb2RlMi5nZXRF\ncGhlbWVyYWxPd25lcigpKTsKICAgIH0KCiAgICAvKioKICAgICAqIFZlcmlm\neSB0aGUgYm9va2llIHJlZ2lzdHJhdGlvbiwgaXQgc2hvdWxkIHRocm93CiAg\nICAgKiBLZWVwZXJFeGNlcHRpb24uTm9kZUV4aXN0c0V4Y2VwdGlvbiBpZiB0\naGUgem5vZGUgc3RpbGwgZXhpc3RzIGV2ZW4gYWZ0ZXIKICAgICAqIHRoZSB6\nayBzZXNzaW9uIHRpbWVvdXQuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQg\nPSAzMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWdOb2RlRXhpc3RzQWZ0\nZXJTZXNzaW9uVGltZU91dCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIEZpbGUgdG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwg\nInRlc3QiKTsKICAgICAgICB0bXBEaXIuZGVsZXRlKCk7CiAgICAgICAgdG1w\nRGlyLm1rZGlyKCk7CgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29u\nZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkuc2V0WmtTZXJ2ZXJzKG51\nbGwpCiAgICAgICAgICAgIC5zZXRBbGxvd0xvb3BiYWNrKHRydWUpCiAgICAg\nICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZSh0bXBEaXIuZ2V0UGF0aCgpKQog\nICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsg\ndG1wRGlyLmdldFBhdGgoKSB9KTsKCiAgICAgICAgU3RyaW5nIGJrUmVnUGF0\naCA9IGNvbmYuZ2V0WmtBdmFpbGFibGVCb29raWVzUGF0aCgpICsgIi8iCiAg\nICAgICAgICAgICAgICArIEluZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdl\ndEhvc3RBZGRyZXNzKCkgKyAiOiIKICAgICAgICAgICAgICAgICsgY29uZi5n\nZXRCb29raWVQb3J0KCk7CgogICAgICAgIE1vY2tCb29raWUgYiA9IG5ldyBN\nb2NrQm9va2llKGNvbmYpOwogICAgICAgIGIuemsgPSB6a2M7CiAgICAgICAg\nYi50ZXN0UmVnaXN0ZXJCb29raWUoY29uZik7CiAgICAgICAgU3RhdCBia1Jl\nZ05vZGUxID0gemtjLmV4aXN0cyhia1JlZ1BhdGgsIGZhbHNlKTsKICAgICAg\nICBBc3NlcnQuYXNzZXJ0Tm90TnVsbCgiQm9va2llIHJlZ2lzdHJhdGlvbiBu\nb2RlIGRvZXNuJ3QgZXhpc3RzISIsCiAgICAgICAgICAgICAgICBia1JlZ05v\nZGUxKTsKCiAgICAgICAgLy8gc2ltdWxhdGluZyBib29raWUgcmVzdGFydCwg\nb24gcmVzdGFydCBib29raWUgd2lsbCBjcmVhdGUgbmV3CiAgICAgICAgLy8g\nemtjbGllbnQgYW5kIGRvaW5nIHRoZSByZWdpc3RyYXRpb24uCiAgICAgICAg\nY3JlYXRlTmV3WktDbGllbnQoKTsKICAgICAgICBiLnprID0gbmV3ems7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgYi50ZXN0UmVnaXN0ZXJCb29raWUo\nY29uZik7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCB0aHJvdyBOb2RlRXhp\nc3RzRXhjZXB0aW9uIGFzIHRoZSB6bm9kZSBpcyBub3QgZ2V0dGluZyBleHBp\ncmVkIik7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAg\nICAgICAgICBUaHJvd2FibGUgdCA9IGUuZ2V0Q2F1c2UoKTsKICAgICAgICAg\nICAgaWYgKHQgaW5zdGFuY2VvZiBLZWVwZXJFeGNlcHRpb24pIHsKICAgICAg\nICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBrZSA9IChLZWVwZXJFeGNlcHRp\nb24pIHQ7CiAgICAgICAgICAgICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZSgiRXJy\nb3JDb2RlOiIgKyBrZS5jb2RlKCkKICAgICAgICAgICAgICAgICAgICAgICAg\nKyAiLCBSZWdpc3RyYXRpb24gbm9kZSBkb2Vzbid0IGV4aXN0cyIsCiAgICAg\nICAgICAgICAgICAgICAgICAgIGtlLmNvZGUoKSA9PSBLZWVwZXJFeGNlcHRp\nb24uQ29kZS5OT0RFRVhJU1RTKTsKCiAgICAgICAgICAgICAgICAvLyB2ZXJp\nZnkgZXBoZW1lcmFsIG93bmVyIG9mIHRoZSBia1JlZyB6bm9kZQogICAgICAg\nICAgICAgICAgU3RhdCBia1JlZ05vZGUyID0gbmV3emsuZXhpc3RzKGJrUmVn\nUGF0aCwgZmFsc2UpOwogICAgICAgICAgICAgICAgQXNzZXJ0LmFzc2VydE5v\ndE51bGwoIkJvb2tpZSByZWdpc3RyYXRpb24gaGFzIGJlZW4gZmFpbGVkIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgYmtSZWdOb2RlMik7CiAgICAgICAg\nICAgICAgICBBc3NlcnQuYXNzZXJ0VHJ1ZSgKICAgICAgICAgICAgICAgICAg\nICAgICAgIkJvb2tpZSB3cm9uZ2x5IHJlZ2lzdGVyZWQuIE9sZCByZWdpc3Ry\nYXRpb24gem5vZGU6IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgYmtSZWdOb2RlMSArICIsIE5ldyB6bm9kZToiICsgYmtSZWdOb2RlMiwK\nICAgICAgICAgICAgICAgICAgICAgICAgYmtSZWdOb2RlMS5nZXRFcGhlbWVy\nYWxPd25lcigpID09IGJrUmVnTm9kZTIKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuZ2V0RXBoZW1lcmFsT3duZXIoKSk7CiAgICAgICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhyb3cg\nZTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBWZXJpZnkgZHVw\nbGljYXRlIGJvb2tpZSBzZXJ2ZXIgc3RhcnR1cC4gU2hvdWxkIHRocm93CiAg\nICAgKiBqYXZhLm5ldC5CaW5kRXhjZXB0aW9uIGlmIGFscmVhZHkgQksgc2Vy\ndmVyIGlzIHJ1bm5pbmcKICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDIw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdER1cGxpY2F0ZUJvb2tpZVNlcnZl\nclN0YXJ0dXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIHRt\ncERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJ0ZXN0Iik7\nCiAgICAgICAgdG1wRGlyLmRlbGV0ZSgpOwogICAgICAgIHRtcERpci5ta2Rp\ncigpOwoKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcg\nU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgIGludCBwb3J0ID0gMTI1\nNTU7CiAgICAgICAgY29uZi5zZXRaa1NlcnZlcnMobnVsbCkuc2V0Qm9va2ll\nUG9ydChwb3J0KQogICAgICAgICAgICAuc2V0QWxsb3dMb29wYmFjayh0cnVl\nKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUodG1wRGlyLmdldFBh\ndGgoKSkKICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJp\nbmdbXSB7IHRtcERpci5nZXRQYXRoKCkgfSk7CiAgICAgICAgQm9va2llU2Vy\ndmVyIGJzMSA9IG5ldyBCb29raWVTZXJ2ZXIoY29uZik7CiAgICAgICAgYnMx\nLnN0YXJ0KCk7CgogICAgICAgIC8vIHN0YXJ0aW5nIGJrIHNlcnZlciB3aXRo\nIHNhbWUgY29uZgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2tpZVNl\ncnZlciBiczIgPSBuZXcgQm9va2llU2VydmVyKGNvbmYpOwogICAgICAgICAg\nICBiczIuc3RhcnQoKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIHRocm93\nIEJpbmRFeGNlcHRpb24sIGFzIHRoZSBiayBzZXJ2ZXIgaXMgYWxyZWFkeSBy\ndW5uaW5nISIpOwogICAgICAgIH0gY2F0Y2ggKEJpbmRFeGNlcHRpb24gYmUp\nIHsKICAgICAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUoIkJLU2VydmVyIGFs\nbG93ZWQgZHVwbGljYXRlIHN0YXJ0dXBzISIsIGJlCiAgICAgICAgICAgICAg\nICAgICAgLmdldE1lc3NhZ2UoKS5jb250YWlucygiQWRkcmVzcyBhbHJlYWR5\nIGluIHVzZSIpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBW\nZXJpZnkgYm9va2llIHN0YXJ0IGJlaGF2aW91ciB3aGVuIFpLIFNlcnZlciBp\ncyBub3QgcnVubmluZy4KICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDIw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFN0YXJ0Qm9va2llV2l0aG91dFpL\nU2VydmVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgemt1dGlsLmtp\nbGxTZXJ2ZXIoKTsKCiAgICAgICAgRmlsZSB0bXBEaXIgPSBGaWxlLmNyZWF0\nZVRlbXBGaWxlKCJib29raWUiLCAidGVzdCIpOwogICAgICAgIHRtcERpci5k\nZWxldGUoKTsKICAgICAgICB0bXBEaXIubWtkaXIoKTsKCiAgICAgICAgZmlu\nYWwgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZp\nZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5n\nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5zZXRa\na1RpbWVvdXQoNTAwMCkuc2V0Sm91cm5hbERpck5hbWUodG1wRGlyLmdldFBh\ndGgoKSkKICAgICAgICAgICAgLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkuc2V0\nTGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgdG1wRGlyLmdldFBhdGgo\nKSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAgICBuZXcgQm9va2llKGNv\nbmYpOwogICAgICAgICAgICBmYWlsKCJTaG91bGQgdGhyb3cgQ29ubmVjdGlv\nbkxvc3NFeGNlcHRpb24gYXMgWktTZXJ2ZXIgaXMgbm90IHJ1bm5pbmchIik7\nCiAgICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uLkNvbm5lY3Rpb25M\nb3NzRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gZXhwZWN0ZWQgYmVo\nYXZpb3VyCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgRmlsZVV0\naWxzLmRlbGV0ZURpcmVjdG9yeSh0bXBEaXIpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFZlcmlmeSB0aGF0IGlmIEkgdHJ5IHRvIHN0YXJ0\nIGEgYm9va2llIHdpdGhvdXQgemsgaW5pdGlhbGl6ZWQsIGl0IHdvbid0CiAg\nICAgKiBwcmV2ZW50IG1lIGZyb20gc3RhcnRpbmcgdGhlIGJvb2tpZSB3aGVu\nIHprIGlzIGluaXRpYWxpemVkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQg\nPSAyMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTdGFydEJvb2tpZVdpdGhv\ndXRaS0luaXRpYWxpemVkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nRmlsZSB0bXBEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAi\ndGVzdCIpOwogICAgICAgIHRtcERpci5kZWxldGUoKTsKICAgICAgICB0bXBE\naXIubWtkaXIoKTsKICAgICAgICBmaW5hbCBTdHJpbmcgWktfUk9PVCA9ICIv\nbGVkZ2VyczIiOwoKICAgICAgICBmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9u\nIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAg\nIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJp\nbmcoKSkKICAgICAgICAgICAgLnNldFprVGltZW91dCg1MDAwKS5zZXRKb3Vy\nbmFsRGlyTmFtZSh0bXBEaXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0\nQWxsb3dMb29wYmFjayh0cnVlKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGly\nTmFtZXMobmV3IFN0cmluZ1tdIHsgdG1wRGlyLmdldFBhdGgoKSB9KTsKICAg\nICAgICBjb25mLnNldFprTGVkZ2Vyc1Jvb3RQYXRoKFpLX1JPT1QpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBu\nZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICAgICAgZmFpbCgiU2hvdWxk\nIHRocm93IE5vTm9kZUV4Y2VwdGlvbiIpOwogICAgICAgICAgICB9IGNhdGNo\nIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgLy8gc2hvdWxkbid0\nIGJlIGFibGUgdG8gc3RhcnQKICAgICAgICAgICAgfQogICAgICAgICAgICBD\nbGllbnRDb25maWd1cmF0aW9uIGNsaWVudENvbmYgPSBuZXcgQ2xpZW50Q29u\nZmlndXJhdGlvbigpOwogICAgICAgICAgICBjbGllbnRDb25mLnNldFprU2Vy\ndmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKTsKICAg\nICAgICAgICAgY2xpZW50Q29uZi5zZXRaa0xlZGdlcnNSb290UGF0aChaS19S\nT09UKTsKICAgICAgICAgICAgQm9va0tlZXBlckFkbWluLmZvcm1hdChjbGll\nbnRDb25mLCBmYWxzZSwgZmFsc2UpOwoKICAgICAgICAgICAgQm9va2llIGIg\nPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBiLnNodXRkb3duKCk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgRmlsZVV0aWxzLmRl\nbGV0ZURpcmVjdG9yeSh0bXBEaXIpOwogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgY3JlYXRlTmV3WktDbGllbnQoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAvLyBjcmVhdGUgYSB6b29rZWVwZXIgY2xpZW50CiAg\nICAgICAgTE9HLmRlYnVnKCJJbnN0YW50aWF0ZSBaSyBDbGllbnQiKTsKICAg\nICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBDb3VudERv\nd25MYXRjaCgxKTsKICAgICAgICBuZXd6ayA9IG5ldyBab29LZWVwZXIoemt1\ndGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSwgMTAwMDAsCiAgICAg\nICAgICAgICAgICBuZXcgV2F0Y2hlcigpIHsKICAgICAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBw\ncm9jZXNzKFdhdGNoZWRFdmVudCBldmVudCkgewogICAgICAgICAgICAgICAg\nICAgICAgICAvLyBoYW5kbGUgc2Vzc2lvbiBkaXNjb25uZWN0cyBhbmQgZXhw\naXJlcwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZ2V0U3Rh\ndGUoKS5lcXVhbHMoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZS5TeW5jQ29ubmVjdGVkKSkgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICBpZiAoIWxhdGNoLmF3\nYWl0KDEwMDAwLCBUaW1lVW5pdC5NSUxMSVNFQ09ORFMpKSB7CiAgICAgICAg\nICAgIG5ld3prLmNsb3NlKCk7CiAgICAgICAgICAgIGZhaWwoIkNvdWxkIG5v\ndCBjb25uZWN0IHRvIHpvb2tlZXBlciBzZXJ2ZXIiKTsKICAgICAgICB9CiAg\nICB9Cn0K\n","encoding":"base64"}

