{"sha":"71482bc337888c8493f87347f290a52697215397","node_id":"MDQ6QmxvYjE1NzU5NTY6NzE0ODJiYzMzNzg4OGM4NDkzZjg3MzQ3ZjI5MGE1MjY5NzIxNTM5Nw==","size":21477,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/71482bc337888c8493f87347f290a52697215397","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5SYW5kb21BY2Nl\nc3NGaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5G\naWxlQ2hhbm5lbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuUmFu\nZG9tOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2Vy\ndmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXJUZXN0\nQ2xpZW50OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5M\nZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQ2xpZW50VXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdl\nc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLldhdGNoZXI7CmltcG9ydCBvcmcuanVuaXQuQmVmb3JlOwppbXBvcnQg\nb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2Vy\ndC4qOwoKcHVibGljIGNsYXNzIEJvb2tpZUpvdXJuYWxUZXN0IHsKICAgIHN0\nYXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9v\na2llSm91cm5hbFRlc3QuY2xhc3MpOwoKICAgIGZpbmFsIFJhbmRvbSByID0g\nbmV3IFJhbmRvbShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CgogICAg\ncHJpdmF0ZSB2b2lkIHdyaXRlSW5kZXhGaWxlRm9yTGVkZ2VyKEZpbGUgaW5k\nZXhEaXIsIGxvbmcgbGVkZ2VySWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYnl0ZVtdIG1hc3RlcktleSkKICAgICAgICAg\nICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBmbiA9IG5ldyBG\naWxlKGluZGV4RGlyLCBMZWRnZXJDYWNoZUltcGwuZ2V0TGVkZ2VyTmFtZShs\nZWRnZXJJZCkpOwogICAgICAgIGZuLmdldFBhcmVudEZpbGUoKS5ta2RpcnMo\nKTsKICAgICAgICBGaWxlSW5mbyBmaSA9IG5ldyBGaWxlSW5mbyhmbiwgbWFz\ndGVyS2V5KTsKICAgICAgICAvLyBmb3JjZSBjcmVhdGlvbiBvZiBpbmRleCBm\naWxlCiAgICAgICAgZmkud3JpdGUobmV3IEJ5dGVCdWZmZXJbXXsgQnl0ZUJ1\nZmZlci5hbGxvY2F0ZSgwKSB9LCAwKTsKICAgICAgICBmaS5jbG9zZSh0cnVl\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVQYXJ0aWFsSW5kZXhG\naWxlRm9yTGVkZ2VyKEZpbGUgaW5kZXhEaXIsIGxvbmcgbGVkZ2VySWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGJ5dGVbXSBtYXN0ZXJLZXksIGJvb2xlYW4gdHJ1bmNhdGVUb01hc3Rlcktl\neSkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmls\nZSBmbiA9IG5ldyBGaWxlKGluZGV4RGlyLCBMZWRnZXJDYWNoZUltcGwuZ2V0\nTGVkZ2VyTmFtZShsZWRnZXJJZCkpOwogICAgICAgIGZuLmdldFBhcmVudEZp\nbGUoKS5ta2RpcnMoKTsKICAgICAgICBGaWxlSW5mbyBmaSA9IG5ldyBGaWxl\nSW5mbyhmbiwgbWFzdGVyS2V5KTsKICAgICAgICAvLyBmb3JjZSBjcmVhdGlv\nbiBvZiBpbmRleCBmaWxlCiAgICAgICAgZmkud3JpdGUobmV3IEJ5dGVCdWZm\nZXJbXXsgQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgwKSB9LCAwKTsKICAgICAgICBm\naS5jbG9zZSh0cnVlKTsKICAgICAgICAvLyBmaWxlIGluZm8gaGVhZGVyCiAg\nICAgICAgaW50IGhlYWRlckxlbiA9IDggKyA0ICsgbWFzdGVyS2V5Lmxlbmd0\naDsKICAgICAgICAvLyB0cnVuY2F0ZSB0aGUgaW5kZXggZmlsZQogICAgICAg\nIGludCBsZWZ0U2l6ZTsKICAgICAgICBpZiAodHJ1bmNhdGVUb01hc3Rlcktl\neSkgewogICAgICAgICAgICBsZWZ0U2l6ZSA9IHIubmV4dEludChoZWFkZXJM\nZW4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlZnRTaXplID0g\naGVhZGVyTGVuICsgci5uZXh0SW50KDEwMjQgLSBoZWFkZXJMZW4pOwogICAg\nICAgIH0KICAgICAgICBGaWxlQ2hhbm5lbCBmYyA9IG5ldyBSYW5kb21BY2Nl\nc3NGaWxlKGZuLCAicnciKS5nZXRDaGFubmVsKCk7CiAgICAgICAgZmMudHJ1\nbmNhdGUobGVmdFNpemUpOwogICAgICAgIGZjLmNsb3NlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBtZXRhIGVudHJ5IHdpdGggZ2l2ZW4g\nbWFzdGVyIGtleQogICAgICovCiAgICBwcml2YXRlIEJ5dGVCdWZmZXIgZ2Vu\nZXJhdGVNZXRhRW50cnkobG9uZyBsZWRnZXJJZCwgYnl0ZVtdIG1hc3Rlcktl\neSkgewogICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9j\nYXRlKDggKyA4ICsgNCArIG1hc3RlcktleS5sZW5ndGgpOwogICAgICAgIGJi\nLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgIGJiLnB1dExvbmcoQm9va2ll\nLk1FVEFFTlRSWV9JRF9MRURHRVJfS0VZKTsKICAgICAgICBiYi5wdXRJbnQo\nbWFzdGVyS2V5Lmxlbmd0aCk7CiAgICAgICAgYmIucHV0KG1hc3RlcktleSk7\nCiAgICAgICAgYmIuZmxpcCgpOwogICAgICAgIHJldHVybiBiYjsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgd3JpdGVKdW5rSm91cm5hbChGaWxlIGpvdXJu\nYWxEaXIpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxvbmcgbG9nSWQg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICBGaWxlIGZu\nID0gbmV3IEZpbGUoam91cm5hbERpciwgTG9uZy50b0hleFN0cmluZyhsb2dJ\nZCkgKyAiLnR4biIpOwoKICAgICAgICBGaWxlQ2hhbm5lbCBmYyA9IG5ldyBS\nYW5kb21BY2Nlc3NGaWxlKGZuLCAicnciKS5nZXRDaGFubmVsKCk7CgogICAg\nICAgIEJ5dGVCdWZmZXIgemVyb3MgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDUx\nMik7CiAgICAgICAgZmMud3JpdGUoemVyb3MsIDQqMTAyNCoxMDI0KTsKICAg\nICAgICBmYy5wb3NpdGlvbigwKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDE7\nIGkgPD0gMTA7IGkrKykgewogICAgICAgICAgICBmYy53cml0ZShCeXRlQnVm\nZmVyLndyYXAoIkp1bmtKdW5rSnVuayIuZ2V0Qnl0ZXMoKSkpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVQcmVWMkpvdXJuYWwo\nRmlsZSBqb3VybmFsRGlyLCBpbnQgbnVtRW50cmllcykgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgIEZpbGUgZm4gPSBuZXcgRmlsZShqb3VybmFs\nRGlyLCBMb25nLnRvSGV4U3RyaW5nKGxvZ0lkKSArICIudHhuIik7CgogICAg\nICAgIEZpbGVDaGFubmVsIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUoZm4s\nICJydyIpLmdldENoYW5uZWwoKTsKCiAgICAgICAgQnl0ZUJ1ZmZlciB6ZXJv\ncyA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNTEyKTsKICAgICAgICBmYy53cml0\nZSh6ZXJvcywgNCoxMDI0KjEwMjQpOwogICAgICAgIGZjLnBvc2l0aW9uKDAp\nOwoKICAgICAgICBieXRlW10gZGF0YSA9ICJKb3VybmFsVGVzdERhdGEiLmdl\ndEJ5dGVzKCk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gTGVkZ2Vy\nSGFuZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDE7IGkgPD0gbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgcGFja2V0ID0gQ2xpZW50VXRpbC5nZW5lcmF0ZVBhY2tldCgxLCBp\nLCBsYXN0Q29uZmlybWVkLCBpKmRhdGEubGVuZ3RoLCBkYXRhKS50b0J5dGVC\ndWZmZXIoKTsKICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IGk7CiAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50KHBhY2tldC5yZW1h\naW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwoKICAgICAg\nICAgICAgZmMud3JpdGUobGVuQnVmZik7CiAgICAgICAgICAgIGZjLndyaXRl\nKHBhY2tldCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgSm91cm5h\nbENoYW5uZWwgd3JpdGVQb3N0VjJKb3VybmFsKEZpbGUgam91cm5hbERpciwg\naW50IG51bUVudHJpZXMpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxv\nbmcgbG9nSWQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAg\nICBKb3VybmFsQ2hhbm5lbCBqYyA9IG5ldyBKb3VybmFsQ2hhbm5lbChqb3Vy\nbmFsRGlyLCBsb2dJZCk7CgogICAgICAgIEJ1ZmZlcmVkQ2hhbm5lbCBiYyA9\nIGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpOwoKICAgICAgICBieXRlW10gZGF0\nYSA9IG5ldyBieXRlWzEwMjRdOwogICAgICAgIEFycmF5cy5maWxsKGRhdGEs\nIChieXRlKSdYJyk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gTGVk\nZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgZm9yIChpbnQg\naSA9IDE7IGkgPD0gbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIEJ5\ndGVCdWZmZXIgcGFja2V0ID0gQ2xpZW50VXRpbC5nZW5lcmF0ZVBhY2tldCgx\nLCBpLCBsYXN0Q29uZmlybWVkLCBpKmRhdGEubGVuZ3RoLCBkYXRhKS50b0J5\ndGVCdWZmZXIoKTsKICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IGk7CiAg\nICAgICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50KHBhY2tldC5y\nZW1haW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwoKICAg\nICAgICAgICAgYmMud3JpdGUobGVuQnVmZik7CiAgICAgICAgICAgIGJjLndy\naXRlKHBhY2tldCk7CiAgICAgICAgfQogICAgICAgIGJjLmZsdXNoKHRydWUp\nOwoKICAgICAgICByZXR1cm4gamM7CiAgICB9CgogICAgcHJpdmF0ZSBKb3Vy\nbmFsQ2hhbm5lbCB3cml0ZVBvc3RWM0pvdXJuYWwoRmlsZSBqb3VybmFsRGly\nLCBpbnQgbnVtRW50cmllcywgYnl0ZVtdIG1hc3RlcktleSkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gbmV3\nIEpvdXJuYWxDaGFubmVsKGpvdXJuYWxEaXIsIGxvZ0lkKTsKCiAgICAgICAg\nQnVmZmVyZWRDaGFubmVsIGJjID0gamMuZ2V0QnVmZmVyZWRDaGFubmVsKCk7\nCgogICAgICAgIGJ5dGVbXSBkYXRhID0gbmV3IGJ5dGVbMTAyNF07CiAgICAg\nICAgQXJyYXlzLmZpbGwoZGF0YSwgKGJ5dGUpJ1gnKTsKICAgICAgICBsb25n\nIGxhc3RDb25maXJtZWQgPSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9J\nRDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8PSBudW1FbnRyaWVzOyBp\nKyspIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBwYWNrZXQ7CiAgICAgICAg\nICAgIGlmIChpID09IDApIHsKICAgICAgICAgICAgICAgIHBhY2tldCA9IGdl\nbmVyYXRlTWV0YUVudHJ5KDEsIG1hc3RlcktleSk7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBwYWNrZXQgPSBDbGllbnRVdGlsLmdl\nbmVyYXRlUGFja2V0KDEsIGksIGxhc3RDb25maXJtZWQsIGkqZGF0YS5sZW5n\ndGgsIGRhdGEpLnRvQnl0ZUJ1ZmZlcigpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGxhc3RDb25maXJtZWQgPSBpOwogICAgICAgICAgICBCeXRlQnVm\nZmVyIGxlbkJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAg\nICAgICBsZW5CdWZmLnB1dEludChwYWNrZXQucmVtYWluaW5nKCkpOwogICAg\nICAgICAgICBsZW5CdWZmLmZsaXAoKTsKCiAgICAgICAgICAgIGJjLndyaXRl\nKGxlbkJ1ZmYpOwogICAgICAgICAgICBiYy53cml0ZShwYWNrZXQpOwogICAg\nICAgIH0KICAgICAgICBiYy5mbHVzaCh0cnVlKTsKCiAgICAgICAgcmV0dXJu\nIGpjOwogICAgfQoKICAgIC8qKgogICAgICogdGVzdCB0aGF0IHdlIGNhbiBv\ncGVuIGEgam91cm5hbCB3cml0dGVuIHdpdGhvdXQgdGhlIG1hZ2ljCiAgICAg\nKiB3b3JkIGF0IHRoZSBzdGFydC4gVGhpcyBpcyBmb3IgdmVyc2lvbnMgb2Yg\nYm9va2tlZXBlciBiZWZvcmUKICAgICAqIHRoZSBtYWdpYyB3b3JkIHdhcyBp\nbnRyb2R1Y2VkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0UHJlVjJKb3VybmFsKCkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVU\nZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFs\nRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAg\nICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdl\ndEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxl\nIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJs\nZWRnZXIiKTsKICAgICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAg\nbGVkZ2VyRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0\nb3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdl\nckRpcikpOwoKICAgICAgICB3cml0ZVByZVYySm91cm5hbChCb29raWUuZ2V0\nQ3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSwgMTAwKTsKICAgICAgICB3\ncml0ZUluZGV4RmlsZUZvckxlZGdlcihCb29raWUuZ2V0Q3VycmVudERpcmVj\ndG9yeShsZWRnZXJEaXIpLCAxLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7\nCgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2\nZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldEFsbG93TG9vcGJh\nY2sodHJ1ZSkKICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAg\nICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRo\nKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5n\nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBCb29raWUg\nYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgYi5yZWFkSm91cm5hbCgp\nOwoKICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIGIucmVhZEVudHJ5KDEsIDEwMSk7CiAgICAgICAgICAg\nIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEwMSIpOwogICAg\nICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CgogICAg\nICAgIGIuc2h1dGRvd24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3Qg\ndGhhdCBpZiB0aGUgam91cm5hbCBpcyBhbGwgam91cm5hbCwgd2UgY2FuIG5v\ndAogICAgICogc3RhcnQgdGhlIGJvb2tpZS4gQW4gYWRtaW4gc2hvdWxkIGxv\nb2sgdG8gc2VlIHdoYXQgaGFzCiAgICAgKiBoYXBwZW5lZCBpbiB0aGlzIGNh\nc2UKICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RBbGxKdW5rSm91cm5hbCgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVtcEZp\nbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5hbERpci5k\nZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAgICAg\nQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJy\nZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBsZWRn\nZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVkZ2Vy\nIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxlZGdl\nckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0\ncnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJEaXIp\nKTsKCiAgICAgICAgd3JpdGVKdW5rSm91cm5hbChCb29raWUuZ2V0Q3VycmVu\ndERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAg\nICAgICAgICAgLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkKICAgICAgICAgICAg\nLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERp\nck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRM\nZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0\naCgpIH0pOwogICAgICAgIEJvb2tpZSBiID0gbnVsbDsKICAgICAgICB0cnkg\newogICAgICAgICAgICBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAg\nICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgYmVlbiBhYmxlIHRvIHN0YXJ0IHdp\ndGhvdXQgYWRtaW4iKTsKICAgICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkg\newogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0g\nZmluYWxseSB7CiAgICAgICAgICAgIGlmIChiICE9IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGIuc2h1dGRvd24oKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCB3ZSBjYW4gc3Rh\ncnQgd2l0aCBhbiBlbXB0eSBqb3VybmFsLgogICAgICogVGhpcyBjYW4gaGFw\ncGVuIGlmIHRoZSBib29raWUgY3Jhc2hlcyBiZXR3ZWVuIGNyZWF0aW5nIHRo\nZQogICAgICogam91cm5hbCBhbmQgd3JpdGluZyB0aGUgbWFnaWMgd29yZC4g\nSXQgY291bGQgYWxzbyBoYXBwZW4gYmVmb3JlCiAgICAgKiB0aGUgbWFnaWMg\nd29yZCBleGlzdGVkLCBpZiB0aGUgYm9va2llIHN0YXJ0ZWQgYnV0IG5vdGhp\nbmcgd2FzCiAgICAgKiBldmVyIHdyaXR0ZW4uCiAgICAgKi8KICAgIEBUZXN0\nKHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0RW1wdHlKb3Vy\nbmFsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBqb3VybmFs\nRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImpvdXJuYWwi\nKTsKICAgICAgICBqb3VybmFsRGlyLmRlbGV0ZSgpOwogICAgICAgIGpvdXJu\nYWxEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlT\ndHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3Rvcnkoam91cm5hbERp\ncikpOwoKICAgICAgICBGaWxlIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVt\ncEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsKICAgICAgICBsZWRnZXJEaXIu\nZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGlyKCk7CiAgICAgICAg\nQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJy\nZW50RGlyZWN0b3J5KGxlZGdlckRpcikpOwoKICAgICAgICB3cml0ZVByZVYy\nSm91cm5hbChCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShqb3VybmFsRGly\nKSwgMCk7CgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5l\ndyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldEFsbG93\nTG9vcGJhY2sodHJ1ZSkKICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxs\nKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5n\nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcg\nU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBC\nb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUZXN0IHRoYXQgYSBqb3VybmFsIGNhbiBsb2FkIGlmIG9ubHkgdGhl\nIG1hZ2ljIHdvcmQgYW5kCiAgICAgKiB2ZXJzaW9uIGFyZSB0aGVyZS4KICAg\nICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RIZWFkZXJPbmx5Sm91cm5hbCgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUo\nImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5hbERpci5kZWxl\ndGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAgICAgQm9v\na2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50\nRGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJE\naXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7\nCiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRp\nci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVj\ndHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJEaXIpKTsK\nCiAgICAgICAgd3JpdGVQb3N0VjJKb3VybmFsKEJvb2tpZS5nZXRDdXJyZW50\nRGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAwKTsKCiAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQog\nICAgICAgICAgICAuc2V0QWxsb3dMb29wYmFjayh0cnVlKQogICAgICAgICAg\nICAuc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3VybmFs\nRGlyTmFtZShqb3VybmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNl\ndExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQ\nYXRoKCkgfSk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25m\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBhIGpvdXJu\nYWwgaGFzIGp1bmsgYXQgdGhlIGVuZCwgaXQgZG9lcyBub3QgbG9hZC4KICAg\nICAqIElmIHRoZSBqb3VybmFsIGlzIGNvcnJ1cHQgbGlrZSB0aGlzLCBhZG1p\nbiBpbnRlcnZlbnRpb24gaXMgbmVlZGVkCiAgICAgKi8KICAgIEBUZXN0KHRp\nbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0SnVua0VuZGVkSm91\ncm5hbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5h\nbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFs\nIik7CiAgICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3Vy\nbmFsRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5\nU3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxE\naXIpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGly\nLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwogICAgICAg\nIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3Vy\ncmVudERpcmVjdG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgSm91cm5hbENo\nYW5uZWwgamMgPSB3cml0ZVBvc3RWMkpvdXJuYWwoQm9va2llLmdldEN1cnJl\nbnREaXJlY3Rvcnkoam91cm5hbERpciksIDApOwogICAgICAgIGpjLmdldEJ1\nZmZlcmVkQ2hhbm5lbCgpLndyaXRlKEJ5dGVCdWZmZXIud3JhcCgiSnVua0p1\nbmtKdW5rIi5nZXRCeXRlcygpKSk7CiAgICAgICAgamMuZ2V0QnVmZmVyZWRD\naGFubmVsKCkuZmx1c2godHJ1ZSk7CgogICAgICAgIHdyaXRlSW5kZXhGaWxl\nRm9yTGVkZ2VyKGxlZGdlckRpciwgMSwgInRlc3RQYXNzd2QiLmdldEJ5dGVz\nKCkpOwoKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcg\nU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRBbGxvd0xv\nb3BiYWNrKHRydWUpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkK\nICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0\nUGF0aCgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0\ncmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsKCiAgICAgICAgQm9v\na2llIGIgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGIgPSBu\nZXcgQm9va2llKGNvbmYpOwogICAgICAgIH0gY2F0Y2ggKFRocm93YWJsZSB0\nKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIHRoZSBib29r\naWUgY3Jhc2hlcyB3aGlsZSB3cml0aW5nIHRoZSBsZW5ndGgKICAgICAqIG9m\nIGFuIGVudHJ5LCB0aGF0IHdlIGNhbiByZWNvdmVyLgogICAgICoKICAgICAq\nIFRoaXMgaXMgY3VycmVudGx5IG5vdCB0aGUgY2FzZSwgd2hpY2ggaXMgYmFk\nIGFzIHJlY292ZXJ5CiAgICAgKiBzaG91bGQgYmUgZmluZSBoZXJlLiBUaGUg\nYm9va2llIGhhcyBjcmFzaGVkIHdoaWxlIHdyaXRpbmcKICAgICAqIGJ1dCBz\nbyB0aGUgY2xpZW50IGhhcyBub3QgYmUgbm90aWZpZWQgb2Ygc3VjY2Vzcy4K\nICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2\nb2lkIHRlc3RUcnVuY2F0ZWRJbkxlbkpvdXJuYWwoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxE\naXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAg\nICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0\nQ3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUg\nbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxl\nZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBs\nZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3Rv\ncnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2Vy\nRGlyKSk7CgogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gd3JpdGVQb3N0\nVjJKb3VybmFsKAogICAgICAgICAgICAgICAgQm9va2llLmdldEN1cnJlbnRE\naXJlY3Rvcnkoam91cm5hbERpciksIDEwMCk7CiAgICAgICAgQnl0ZUJ1ZmZl\nciB6ZXJvcyA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMjA0OCk7CgogICAgICAg\nIGpjLmZjLnBvc2l0aW9uKGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpLnBvc2l0\naW9uKCkgLSAweDQyOSk7CiAgICAgICAgamMuZmMud3JpdGUoemVyb3MpOwog\nICAgICAgIGpjLmZjLmZvcmNlKGZhbHNlKTsKCiAgICAgICAgd3JpdGVJbmRl\neEZpbGVGb3JMZWRnZXIoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVk\nZ2VyRGlyKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLCAi\ndGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAg\nICAgICAgICAgLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkKICAgICAgICAgICAg\nLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERp\nck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRM\nZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0\naCgpIH0pOwoKICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7\nCiAgICAgICAgYi5yZWFkSm91cm5hbCgpOwoKICAgICAgICBiLnJlYWRFbnRy\neSgxLCA5OSk7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGIucmVhZEVu\ndHJ5KDEsIDEwMCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZl\nIGZvdW5kIGVudHJ5IDEwMCIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5O\nb0VudHJ5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBi\nZWhhdmlvdXIKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0\nIHRoYXQgaWYgdGhlIGJvb2tpZSBjcmFzaGVzIGluIHRoZSBtaWRkbGUgb2Yg\nd3JpdGluZwogICAgICogdGhlIGFjdHVhbCBlbnRyeSBpdCBjYW4gcmVjb3Zl\nci4KICAgICAqIEluIHRoaXMgY2FzZSB0aGUgZW50cnkgd2lsbCBiZSBhdmFp\nbGFibGUsIGJ1dCBpdCB3aWxsIGNvcnJ1cHQuCiAgICAgKiBUaGlzIGlzIG9r\nLCBhcyB0aGUgY2xpZW50IHdpbGwgZGlzcmVnYXJkIHRoZSBlbnRyeSBhZnRl\nciBsb29raW5nCiAgICAgKiBhdCBpdHMgY2hlY2tzdW0uCiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0VHJ1\nbmNhdGVkSW5FbnRyeUpvdXJuYWwoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJi\nb29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxEaXIuZGVsZXRl\nKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAgICAgIEJvb2tp\nZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERp\ncmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUgbGVkZ2VyRGly\nID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxlZGdlciIpOwog\nICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBsZWRnZXJEaXIu\nbWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1\ncmUoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKSk7Cgog\nICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gd3JpdGVQb3N0VjJKb3VybmFs\nKAogICAgICAgICAgICAgICAgQm9va2llLmdldEN1cnJlbnREaXJlY3Rvcnko\nam91cm5hbERpciksIDEwMCk7CiAgICAgICAgQnl0ZUJ1ZmZlciB6ZXJvcyA9\nIEJ5dGVCdWZmZXIuYWxsb2NhdGUoMjA0OCk7CgogICAgICAgIGpjLmZjLnBv\nc2l0aW9uKGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpLnBvc2l0aW9uKCkgLSAw\neDMwMCk7CiAgICAgICAgamMuZmMud3JpdGUoemVyb3MpOwogICAgICAgIGpj\nLmZjLmZvcmNlKGZhbHNlKTsKCiAgICAgICAgd3JpdGVJbmRleEZpbGVGb3JM\nZWRnZXIoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLCAidGVzdFBhc3N3\nZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAg\nLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkKICAgICAgICAgICAgLnNldFprU2Vy\ndmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91\ncm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJO\nYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoK\nICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAg\nYi5yZWFkSm91cm5hbCgpOwogICAgICAgIGIucmVhZEVudHJ5KDEsIDk5KTsK\nCiAgICAgICAgLy8gc3RpbGwgYWJsZSB0byByZWFkIGxhc3QgZW50cnksIGJ1\ndCBpdCdzIGp1bmsKICAgICAgICBCeXRlQnVmZmVyIGJ1ZiA9IGIucmVhZEVu\ndHJ5KDEsIDEwMCk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJMZWRnZXIgSWQg\naXMgd3JvbmciLCBidWYuZ2V0TG9uZygpLCAxKTsKICAgICAgICBhc3NlcnRF\ncXVhbHMoIkVudHJ5IElkIGlzIHdyb25nIiwgYnVmLmdldExvbmcoKSwgMTAw\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkxhc3QgY29uZmlybWVkIGlzIHdy\nb25nIiwgYnVmLmdldExvbmcoKSwgOTkpOwogICAgICAgIGFzc2VydEVxdWFs\ncygiTGVuZ3RoIGlzIHdyb25nIiwgYnVmLmdldExvbmcoKSwgMTAwKjEwMjQp\nOwogICAgICAgIGJ1Zi5nZXRMb25nKCk7IC8vIHNraXAgY2hlY2tzdW0KICAg\nICAgICBib29sZWFuIGFsbFggPSB0cnVlOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgMTAyNDsgaSsrKSB7CiAgICAgICAgICAgIGJ5dGUgeCA9IGJ1\nZi5nZXQoKTsKICAgICAgICAgICAgYWxsWCA9IGFsbFggJiYgeCA9PSAoYnl0\nZSknWCc7CiAgICAgICAgfQogICAgICAgIGFzc2VydEZhbHNlKCJTb21lIG9m\nIGJ1ZmZlciBzaG91bGQgaGF2ZSBiZWVuIHplcm9lZCIsIGFsbFgpOwoKICAg\nICAgICB0cnkgewogICAgICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDEpOwog\nICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3QgaGF2ZSBmb3VuZCBlbnRyeSAx\nMDEiKTsKICAgICAgICB9IGNhdGNoIChCb29raWUuTm9FbnRyeUV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAg\nICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4\nICh0cnVuY2F0ZSBtYXN0ZXIga2V5KSB3aXRoIHByZS12MyBqb3VybmFscwog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFBhcnRpYWxGaWxlSW5mb1ByZVYzSm91cm5hbDEoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICB0ZXN0UGFydGlhbEZpbGVJbmZvUHJlVjNK\nb3VybmFsKHRydWUpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBwYXJ0\naWFsIGluZGV4IHdpdGggcHJlLXYzIGpvdXJuYWxzCiAgICAgKi8KICAgIEBU\nZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0UGFydGlh\nbEZpbGVJbmZvUHJlVjNKb3VybmFsMigpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIHRlc3RQYXJ0aWFsRmlsZUluZm9QcmVWM0pvdXJuYWwoZmFsc2Up\nOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4IGZp\nbGUgd2l0aCBwcmUtdjMgam91cm5hbHMuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCB0ZXN0UGFydGlhbEZpbGVJbmZvUHJlVjNKb3VybmFsKGJvb2xlYW4g\ndHJ1bmNhdGVNYXN0ZXJLZXkpCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVUZW1wRmls\nZSgiYm9va2llIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFsRGlyLmRl\nbGV0ZSgpOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAgICAgICBC\nb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJl\nbnREaXJlY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxlIGxlZGdl\nckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIi\nKTsKICAgICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2Vy\nRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3Ry\ndWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIp\nKTsKCiAgICAgICAgd3JpdGVQcmVWMkpvdXJuYWwoQm9va2llLmdldEN1cnJl\nbnREaXJlY3Rvcnkoam91cm5hbERpciksIDEwMCk7CiAgICAgICAgd3JpdGVQ\nYXJ0aWFsSW5kZXhGaWxlRm9yTGVkZ2VyKEJvb2tpZS5nZXRDdXJyZW50RGly\nZWN0b3J5KGxlZGdlckRpciksCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIDEsICJ0ZXN0UGFzc3dkIi5nZXRCeXRlcygpLCB0cnVu\nY2F0ZU1hc3RlcktleSk7CgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAg\nLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkKICAgICAgICAgICAgLnNldFprU2Vy\ndmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91\ncm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJO\nYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoK\nICAgICAgICBpZiAodHJ1bmNhdGVNYXN0ZXJLZXkpIHsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShj\nb25mKTsKICAgICAgICAgICAgICAgIGIucmVhZEpvdXJuYWwoKTsKICAgICAg\nICAgICAgICAgIGZhaWwoIlNob3VsZCBub3QgcmVhY2ggaGVyZSEiKTsKICAg\nICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaWUpIHsKICAgICAgICAg\nICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIEJvb2tpZSBiID0g\nbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAgYi5yZWFkSm91cm5hbCgp\nOwogICAgICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgYi5yZWFkRW50cnkoMSwgMTAxKTsK\nICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVu\ndHJ5IDEwMSIpOwogICAgICAgICAgICB9IGNhdGNoIChCb29raWUuTm9FbnRy\neUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBjb3JyZWN0IGJl\naGF2aW91cgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4ICh0cnVuY2F0ZSBtYXN0ZXIg\na2V5KSB3aXRoIHBvc3QtdjMgam91cm5hbHMKICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RQYXJ0aWFsRmls\nZUluZm9Qb3N0VjNKb3VybmFsMSgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIHRlc3RQYXJ0aWFsRmlsZUluZm9Qb3N0VjNKb3VybmFsKHRydWUpOwog\nICAgfQoKICAgIC8qKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4IHdpdGgg\ncG9zdC12MyBqb3VybmFscwogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFBhcnRpYWxGaWxlSW5mb1Bvc3RW\nM0pvdXJuYWwyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdGVzdFBh\ncnRpYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwoZmFsc2UpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4IGZpbGUgd2l0aCBwb3N0\nLXYzIGpvdXJuYWxzLgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdGVzdFBh\ncnRpYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwoYm9vbGVhbiB0cnVuY2F0ZU1h\nc3RlcktleSkKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBG\naWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUi\nLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxEaXIuZGVsZXRlKCk7CiAg\nICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVj\na0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9y\neShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUgbGVkZ2VyRGlyID0gRmls\nZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxlZGdlciIpOwogICAgICAg\nIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBsZWRnZXJEaXIubWtkaXIo\nKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9v\na2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKSk7CgogICAgICAg\nIGJ5dGVbXSBtYXN0ZXJLZXkgPSAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKTsK\nCiAgICAgICAgd3JpdGVQb3N0VjNKb3VybmFsKEJvb2tpZS5nZXRDdXJyZW50\nRGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAxMDAsIG1hc3RlcktleSk7CiAgICAg\nICAgd3JpdGVQYXJ0aWFsSW5kZXhGaWxlRm9yTGVkZ2VyKEJvb2tpZS5nZXRD\ndXJyZW50RGlyZWN0b3J5KGxlZGdlckRpciksIDEsIG1hc3RlcktleSwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ1bmNhdGVN\nYXN0ZXJLZXkpOwoKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRB\nbGxvd0xvb3BiYWNrKHRydWUpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMo\nbnVsbCkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxE\naXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMo\nbmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsKCiAgICAg\nICAgQm9va2llIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgIGIucmVh\nZEpvdXJuYWwoKTsKICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGIucmVhZEVudHJ5KDEsIDEwMSk7CiAg\nICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEw\nMSIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICB9CiAgICB9Cn0K\n","encoding":"base64"}

