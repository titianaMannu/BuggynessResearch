{"sha":"5cdb57638385e8428f56730926aaf3f272d5eddf","node_id":"MDQ6QmxvYjE1NzU5NTY6NWNkYjU3NjM4Mzg1ZTg0MjhmNTY3MzA5MjZhYWYzZjI3MmQ1ZWRkZg==","size":13117,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/5cdb57638385e8428f56730926aaf3f272d5eddf","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmlvLkZpbGVVdGlsczsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlckFkbWlu\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIudGVzdC5ab29LZWVwZXJVdGlsOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnRlc3QuUG9ydE1hbmFnZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5ab29LZWVwZXI7CgppbXBvcnQgamF2YS5pby5GaWxlOwpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKCmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5p\ndC5CZWZvcmU7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC4qOwoK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLlVw\nZ3JhZGVUZXN0Lio7CgpwdWJsaWMgY2xhc3MgQ29va2llVGVzdCB7CiAgICBa\nb29LZWVwZXJVdGlsIHprdXRpbDsKICAgIFpvb0tlZXBlciB6a2MgPSBudWxs\nOwogICAgZmluYWwgaW50IGJvb2tpZVBvcnQgPSBQb3J0TWFuYWdlci5uZXh0\nRnJlZVBvcnQoKTsKCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBzZXR1\ncFpvb0tlZXBlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHprdXRp\nbCA9IG5ldyBab29LZWVwZXJVdGlsKCk7CiAgICAgICAgemt1dGlsLnN0YXJ0\nU2VydmVyKCk7CiAgICAgICAgemtjID0gemt1dGlsLmdldFpvb0tlZXBlckNs\naWVudCgpOwogICAgfQoKICAgIEBBZnRlcgogICAgcHVibGljIHZvaWQgdGVh\nckRvd25ab29LZWVwZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB6\na3V0aWwua2lsbFNlcnZlcigpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIFN0cmluZyBuZXdEaXJlY3RvcnkoKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIHJldHVybiBuZXdEaXJlY3RvcnkodHJ1ZSk7CiAgICB9CgogICAg\ncHJpdmF0ZSBzdGF0aWMgU3RyaW5nIG5ld0RpcmVjdG9yeShib29sZWFuIGNy\nZWF0ZUN1ckRpcikgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxl\nIGQgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAidG1wZGlyIik7\nCiAgICAgICAgZC5kZWxldGUoKTsKICAgICAgICBkLm1rZGlycygpOwogICAg\nICAgIGlmIChjcmVhdGVDdXJEaXIpIHsKICAgICAgICAgICAgbmV3IEZpbGUo\nZCwgImN1cnJlbnQiKS5ta2RpcnMoKTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGQuZ2V0UGF0aCgpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBz\ndGFydGluZyBib29raWUgd2l0aCBjbGVhbiBzdGF0ZS4KICAgICAqLwogICAg\nQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RDbGVh\nblN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQog\nICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFt\nZShuZXdEaXJlY3RvcnkoZmFsc2UpKQogICAgICAgICAgICAuc2V0QWxsb3dM\nb29wYmFjayh0cnVlKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMo\nbmV3IFN0cmluZ1tdIHsgbmV3RGlyZWN0b3J5KGZhbHNlKSB9KQogICAgICAg\nICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0KTsKICAgICAgICB0cnkg\newogICAgICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgZmFp\nbCgiU2hvdWxkIG5vdCByZWFjaCBoZXJlLiIpOwogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBhIHpvb2tlZXBlciBjb29r\naWUKICAgICAqIGlzIGRpZmZlcmVudCB0byBhIGxvY2FsIGNvb2tpZSwgdGhl\nIGJvb2tpZQogICAgICogd2lsbCBmYWlsIHRvIHN0YXJ0CiAgICAgKi8KICAg\nIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0QmFk\nSm91cm5hbENvb2tpZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZjEgPSBuZXcgU2VydmVyQ29uZmlndXJh\ndGlvbigpCiAgICAgICAgICAgIC5zZXRBbGxvd0xvb3BiYWNrKHRydWUpCiAg\nICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShuZXdEaXJlY3RvcnkoKSkK\nICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7\nIG5ld0RpcmVjdG9yeSgpIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0\nKGJvb2tpZVBvcnQpOwogICAgICAgIENvb2tpZSBjID0gQ29va2llLmdlbmVy\nYXRlQ29va2llKGNvbmYxKTsKICAgICAgICBjLndyaXRlVG9ab29LZWVwZXIo\nemtjLCBjb25mMSk7CgogICAgICAgIFN0cmluZyBqb3VybmFsRGlyID0gbmV3\nRGlyZWN0b3J5KCk7CiAgICAgICAgU3RyaW5nIGxlZGdlckRpciA9IG5ld0Rp\ncmVjdG9yeSgpOwogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjIg\nPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRB\nbGxvd0xvb3BiYWNrKHRydWUpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMo\nemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAg\nICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIpCiAgICAgICAgICAg\nIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIg\nfSkKICAgICAgICAgICAgLnNldEJvb2tpZVBvcnQoYm9va2llUG9ydCk7CiAg\nICAgICAgQ29va2llIGMyID0gQ29va2llLmdlbmVyYXRlQ29va2llKGNvbmYy\nKTsKICAgICAgICBjMi53cml0ZVRvRGlyZWN0b3J5KG5ldyBGaWxlKGpvdXJu\nYWxEaXIsICJjdXJyZW50IikpOwogICAgICAgIGMyLndyaXRlVG9EaXJlY3Rv\ncnkobmV3IEZpbGUobGVkZ2VyRGlyLCAiY3VycmVudCIpKTsKCiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgQm9va2llIGIgPSBuZXcgQm9va2llKGNvbmYy\nKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgYmVlbiBhYmxl\nIHRvIHN0YXJ0Iik7CiAgICAgICAgfSBjYXRjaCAoQm9va2llRXhjZXB0aW9u\nLkludmFsaWRDb29raWVFeGNlcHRpb24gaWNlKSB7CiAgICAgICAgICAgIC8v\nIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVGVzdCB0aGF0IGlmIGEgZGlyZWN0b3J5IGlzIHJlbW92ZWQgZnJv\nbQogICAgICogdGhlIGNvbmZpZ3VyYXRpb24sIHRoZSBib29raWUgd2lsbCBm\nYWlsIHRvCiAgICAgKiBzdGFydAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdERpcmVjdG9yeU1pc3Npbmco\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdbXSBsZWRnZXJE\naXJzID0gbmV3IFN0cmluZ1tdIHsKICAgICAgICAgICAgbmV3RGlyZWN0b3J5\nKCksIG5ld0RpcmVjdG9yeSgpLCBuZXdEaXJlY3RvcnkoKSB9OwogICAgICAg\nIFN0cmluZyBqb3VybmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAg\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3Vy\nYXRpb24oKQogICAgICAgICAgICAuc2V0QWxsb3dMb29wYmFjayh0cnVlKQog\nICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFt\nZShqb3VybmFsRGlyKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMo\nbGVkZ2VyRGlycykKICAgICAgICAgICAgLnNldEJvb2tpZVBvcnQoYm9va2ll\nUG9ydCk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsg\nLy8gc2hvdWxkIHdvcmsgZmluZQogICAgICAgIGIuc3RhcnQoKTsKICAgICAg\nICBiLnNodXRkb3duKCk7CgogICAgICAgIGNvbmYuc2V0TGVkZ2VyRGlyTmFt\nZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyc1swXSwgbGVkZ2VyRGlyc1sx\nXSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29raWUgYjIgPSBu\nZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRuJ3Qg\naGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAgICAgICB9IGNhdGNoIChC\nb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlvbiBpY2UpIHsK\nICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9Cgog\nICAgICAgIGNvbmYuc2V0Sm91cm5hbERpck5hbWUobmV3RGlyZWN0b3J5KCkp\nLnNldExlZGdlckRpck5hbWVzKGxlZGdlckRpcnMpOwogICAgICAgIHRyeSB7\nCiAgICAgICAgICAgIEJvb2tpZSBiMiA9IG5ldyBCb29raWUoY29uZik7CiAg\nICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0byBz\ndGFydCIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5JbnZh\nbGlkQ29va2llRXhjZXB0aW9uIGljZSkgewogICAgICAgICAgICAvLyBjb3Jy\nZWN0IGJlaGF2aW91cgogICAgICAgIH0KCiAgICAgICAgY29uZi5zZXRKb3Vy\nbmFsRGlyTmFtZShqb3VybmFsRGlyKTsKICAgICAgICBiID0gbmV3IEJvb2tp\nZShjb25mKTsKICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93\nbigpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIGEgZGly\nZWN0b3J5IGlzIGFkZGVkIHRvIGEKICAgICAqIHByZWV4aXN0aW5nIGJvb2tp\nZSwgdGhlIGJvb2tpZSB3aWxsIGZhaWwKICAgICAqIHRvIHN0YXJ0CiAgICAg\nKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0\nZXN0RGlyZWN0b3J5QWRkZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBTdHJpbmcgbGVkZ2VyRGlyMCA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAg\nIFN0cmluZyBqb3VybmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAg\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3Vy\nYXRpb24oKQogICAgICAgICAgICAuc2V0QWxsb3dMb29wYmFjayh0cnVlKQog\nICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFt\nZShqb3VybmFsRGlyKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMo\nbmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyMCB9KQogICAgICAgICAgICAuc2V0\nQm9va2llUG9ydChib29raWVQb3J0KTsKCiAgICAgICAgQm9va2llIGIgPSBu\nZXcgQm9va2llKGNvbmYpOyAvLyBzaG91bGQgd29yayBmaW5lCiAgICAgICAg\nYi5zdGFydCgpOwogICAgICAgIGIuc2h1dGRvd24oKTsKCiAgICAgICAgY29u\nZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIw\nLCBuZXdEaXJlY3RvcnkoKSB9KTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBCb29raWUgYjIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBm\nYWlsKCJTaG91bGRuJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAg\nICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4\nY2VwdGlvbiBpY2UpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlv\ndXIKICAgICAgICB9CgogICAgICAgIGNvbmYuc2V0TGVkZ2VyRGlyTmFtZXMo\nbmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyMCB9KTsKICAgICAgICBiID0gbmV3\nIEJvb2tpZShjb25mKTsKICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5z\naHV0ZG93bigpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlm\nIGEgZGlyZWN0b3J5J3MgY29udGVudHMKICAgICAqIGFyZSBlbXB0aWVkLCB0\naGUgYm9va2llIHdpbGwgZmFpbCB0byBzdGFydAogICAgICovCiAgICBAVGVz\ndCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdERpcmVjdG9y\neUNsZWFyZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcg\nbGVkZ2VyRGlyMCA9IG5ld0RpcmVjdG9yeSgpOwogICAgICAgIFN0cmluZyBq\nb3VybmFsRGlyID0gbmV3RGlyZWN0b3J5KCk7CiAgICAgICAgU2VydmVyQ29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQog\nICAgICAgICAgICAuc2V0QWxsb3dMb29wYmFjayh0cnVlKQogICAgICAgICAg\nICAuc2V0WmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3Ry\naW5nKCkpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFs\nRGlyKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmlu\nZ1tdIHsgbGVkZ2VyRGlyMCAsIG5ld0RpcmVjdG9yeSgpIH0pCiAgICAgICAg\nICAgIC5zZXRCb29raWVQb3J0KGJvb2tpZVBvcnQpOwoKICAgICAgICBCb29r\naWUgYiA9IG5ldyBCb29raWUoY29uZik7IC8vIHNob3VsZCB3b3JrIGZpbmUK\nICAgICAgICBiLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93bigpOwoKICAg\nICAgICBGaWxlVXRpbHMuZGVsZXRlRGlyZWN0b3J5KG5ldyBGaWxlKGxlZGdl\nckRpcjApKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBCb29raWUgYjIg\nPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgICAgICBmYWlsKCJTaG91bGRu\nJ3QgaGF2ZSBiZWVuIGFibGUgdG8gc3RhcnQiKTsKICAgICAgICB9IGNhdGNo\nIChCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlvbiBpY2Up\nIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9\nCiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgaWYgYSBib29raWUn\ncyBwb3J0IGlzIGNoYW5nZWQKICAgICAqIHRoZSBib29raWUgd2lsbCBmYWls\nIHRvIHN0YXJ0CiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0Qm9va2llUG9ydENoYW5nZWQoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRB\nbGxvd0xvb3BiYWNrKHRydWUpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMo\nemt1dGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkKICAgICAgICAg\nICAgLnNldEpvdXJuYWxEaXJOYW1lKG5ld0RpcmVjdG9yeSgpKQogICAgICAg\nICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbmV3RGly\nZWN0b3J5KCkgLCBuZXdEaXJlY3RvcnkoKSB9KQogICAgICAgICAgICAuc2V0\nQm9va2llUG9ydChib29raWVQb3J0KTsKICAgICAgICBCb29raWUgYiA9IG5l\ndyBCb29raWUoY29uZik7IC8vIHNob3VsZCB3b3JrIGZpbmUKICAgICAgICBi\nLnN0YXJ0KCk7CiAgICAgICAgYi5zaHV0ZG93bigpOwoKICAgICAgICBjb25m\nLnNldEJvb2tpZVBvcnQoMzE4Mik7CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgICAgIGZhaWwoIlNo\nb3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0byBzdGFydCIpOwogICAgICAgIH0g\nY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9u\nIGljZSkgewogICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAg\nICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBhIGJv\nb2tpZSB0cmllcyB0byBzdGFydAogICAgICogd2l0aCB0aGUgYWRkcmVzcyBv\nZiBhIGJvb2tpZSB3aGljaCBoYXMgYWxyZWFkeQogICAgICogZXhpc3RlZCBp\nbiB0aGUgc3lzdGVtLCB0aGVuIHRoZSBib29raWUgd2lsbCBmYWlsCiAgICAg\nKiB0byBzdGFydAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdE5ld0Jvb2tpZVN0YXJ0aW5nV2l0aEFub3Ro\nZXJCb29raWVzUG9ydCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0\naW9uKCkKICAgICAgICAgICAgLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkKICAg\nICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUo\nbmV3RGlyZWN0b3J5KCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1l\ncyhuZXcgU3RyaW5nW10geyBuZXdEaXJlY3RvcnkoKSAsIG5ld0RpcmVjdG9y\neSgpIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0KGJvb2tpZVBvcnQp\nOwogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tpZShjb25mKTsgLy8gc2hv\ndWxkIHdvcmsgZmluZQogICAgICAgIGIuc3RhcnQoKTsKICAgICAgICBiLnNo\ndXRkb3duKCk7CgogICAgICAgIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJh\ndGlvbigpCiAgICAgICAgICAgIC5zZXRBbGxvd0xvb3BiYWNrKHRydWUpCiAg\nICAgICAgICAgIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNv\nbm5lY3RTdHJpbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1l\nKG5ld0RpcmVjdG9yeSgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFt\nZXMobmV3IFN0cmluZ1tdIHsgbmV3RGlyZWN0b3J5KCkgLCBuZXdEaXJlY3Rv\ncnkoKSB9KQogICAgICAgICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBiID0gbmV3IEJvb2tpZShj\nb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgYmVlbiBh\nYmxlIHRvIHN0YXJ0Iik7CiAgICAgICAgfSBjYXRjaCAoQm9va2llRXhjZXB0\naW9uLkludmFsaWRDb29raWVFeGNlcHRpb24gaWNlKSB7CiAgICAgICAgICAg\nIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoKICAgIC8q\nCiAgICAgKiBUZXN0IENvb2tpZSB2ZXJpZmljYXRpb24gd2l0aCBmb3JtYXQu\nCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0VmVyaWZ5Q29va2llV2l0aEZvcm1hdCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIENsaWVudENvbmZpZ3VyYXRpb24gYWRtaW5Db25m\nID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0\nWmtTZXJ2ZXJzKHprdXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkp\nOwoKICAgICAgICBhZG1pbkNvbmYuc2V0UHJvcGVydHkoImJvb2trZWVwZXIu\nZm9ybWF0IiwgdHJ1ZSk7CiAgICAgICAgLy8gRm9ybWF0IHRoZSBCSyBNZXRh\nZGF0YSBhbmQgZ2VuZXJhdGUgSU5TVEFOQ0VJRAogICAgICAgIEJvb2tLZWVw\nZXJBZG1pbi5mb3JtYXQoYWRtaW5Db25mLCBmYWxzZSwgdHJ1ZSk7CgogICAg\nICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gYm9va2llQ29uZiA9IG5ldyBTZXJ2\nZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldEFsbG93TG9vcGJh\nY2sodHJ1ZSkKICAgICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0\nWm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKQogICAgICAgICAgICAuc2V0Sm91\ncm5hbERpck5hbWUobmV3RGlyZWN0b3J5KGZhbHNlKSkKICAgICAgICAgICAg\nLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IG5ld0RpcmVjdG9y\neShmYWxzZSkgfSkKICAgICAgICAgICAgLnNldEJvb2tpZVBvcnQoYm9va2ll\nUG9ydCk7CiAgICAgICAgLy8gQm9va2llIHNob3VsZCBzdGFydCBzdWNjZXNz\nZnVsbHkgZm9yIGZyZXNoIGVudi4KICAgICAgICBuZXcgQm9va2llKGJvb2tp\nZUNvbmYpOwoKICAgICAgICAvLyBGb3JtYXQgbWV0YWRhdGEgb25lIG1vcmUg\ndGltZS4KICAgICAgICBCb29rS2VlcGVyQWRtaW4uZm9ybWF0KGFkbWluQ29u\nZiwgZmFsc2UsIHRydWUpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIG5l\ndyBCb29raWUoYm9va2llQ29uZik7CiAgICAgICAgICAgIGZhaWwoIkJvb2tp\nZSBzaG91bGQgbm90IHN0YXJ0IHdpdGggcHJldmlvdXMgaW5zdGFuY2UgaWQu\nIik7CiAgICAgICAgfSBjYXRjaCAoQm9va2llRXhjZXB0aW9uLkludmFsaWRD\nb29raWVFeGNlcHRpb24gZSkgewogICAgICAgICAgICBhc3NlcnRUcnVlKAog\nICAgICAgICAgICAgICAgICAgICJCb29raWUgc3RhcnR1cCBzaG91bGQgZmFp\nbCBiZWNhdXNlIG9mIGludmFsaWQgaW5zdGFuY2UgaWQiLAogICAgICAgICAg\nICAgICAgICAgIGUuZ2V0TWVzc2FnZSgpLmNvbnRhaW5zKCJpbnN0YW5jZUlk\nIikpOwogICAgICAgIH0KCiAgICAgICAgLy8gTm93IGZvcm1hdCB0aGUgQm9v\na2llIGFuZCByZXN0YXJ0LgogICAgICAgIEJvb2tpZS5mb3JtYXQoYm9va2ll\nQ29uZiwgZmFsc2UsIHRydWUpOwogICAgICAgIC8vIEFmdGVyIGJvb2tpZSBm\nb3JtYXQgYm9va2llIHNob3VsZCBiZSBhYmxlIHRvIHN0YXJ0IGFnYWluLgog\nICAgICAgIG5ldyBCb29raWUoYm9va2llQ29uZik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUZXN0IHRoYXQgaWYgYSBib29raWUgaXMgc3RhcnRlZCB3aXRo\nIGRpcmVjdG9yaWVzIHdpdGgKICAgICAqIHZlcnNpb24gMiBkYXRhLCB0aGF0\nIGl0IHdpbGwgZmFpbCB0byBzdGFydCAoaXQgbmVlZHMgdXBncmFkZSkKICAg\nICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lk\nIHRlc3RWMmRhdGEoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlv\nbigpCiAgICAgICAgICAgIC5zZXRBbGxvd0xvb3BiYWNrKHRydWUpCiAgICAg\nICAgICAgIC5zZXRaa1NlcnZlcnMoemt1dGlsLmdldFpvb0tlZXBlckNvbm5l\nY3RTdHJpbmcoKSkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKG5l\nd1YySm91cm5hbERpcmVjdG9yeSgpKQogICAgICAgICAgICAuc2V0TGVkZ2Vy\nRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbmV3VjJMZWRnZXJEaXJlY3Rvcnko\nKSB9KQogICAgICAgICAgICAuc2V0Qm9va2llUG9ydChib29raWVQb3J0KTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBCb29raWUgYiA9IG5ldyBCb29r\naWUoY29uZik7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGJl\nZW4gYWJsZSB0byBzdGFydCIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4\nY2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0aW9uIGljZSkgewogICAgICAg\nICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJ3cm9uZyBleGNlcHRpb24iLCBpY2UuZ2V0Q2F1c2UoKS5nZXRNZXNz\nYWdlKCkuY29udGFpbnMoInVwZ3JhZGUgbmVlZGVkIikpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBhIGJvb2tpZSBp\ncyBzdGFydGVkIHdpdGggZGlyZWN0b3JpZXMgd2l0aAogICAgICogdmVyc2lv\nbiAxIGRhdGEsIHRoYXQgaXQgd2lsbCBmYWlsIHRvIHN0YXJ0IChpdCBuZWVk\ncyB1cGdyYWRlKQogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdFYxZGF0YSgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2\nZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldEFsbG93TG9vcGJh\nY2sodHJ1ZSkKICAgICAgICAgICAgLnNldFprU2VydmVycyh6a3V0aWwuZ2V0\nWm9vS2VlcGVyQ29ubmVjdFN0cmluZygpKQogICAgICAgICAgICAuc2V0Sm91\ncm5hbERpck5hbWUobmV3VjFKb3VybmFsRGlyZWN0b3J5KCkpCiAgICAgICAg\nICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBuZXdWMUxl\nZGdlckRpcmVjdG9yeSgpIH0pCiAgICAgICAgICAgIC5zZXRCb29raWVQb3J0\nKGJvb2tpZVBvcnQpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIEJvb2tp\nZSBiID0gbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hv\ndWxkbid0IGhhdmUgYmVlbiBhYmxlIHRvIHN0YXJ0Iik7CiAgICAgICAgfSBj\nYXRjaCAoQm9va2llRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNlcHRpb24g\naWNlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAg\nICAgICAgIGFzc2VydFRydWUoIndyb25nIGV4Y2VwdGlvbiIsIGljZS5nZXRD\nYXVzZSgpLmdldE1lc3NhZ2UoKS5jb250YWlucygidXBncmFkZSBuZWVkZWQi\nKSk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

