{"sha":"0ed1af75bb0792d843019876a67d3013953dbb61","node_id":"MDQ6QmxvYjE1NzU5NTY6MGVkMWFmNzViYjA3OTJkODQzMDE5ODc2YTY3ZDMwMTM5NTNkYmI2MQ==","size":19326,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0ed1af75bb0792d843019876a67d3013953dbb61","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CgppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5Cb29raWUuTm9MZWRnZXJFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1l\ndGEuTGVkZ2VyTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQgb3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuU25hcHNob3RNYXA7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkxpbmtlZEJsb2NraW5nUXVldWU7\nCgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmlvLkZpbGVVdGlsczsKaW1w\nb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5Bc3NlcnQ7\nCmltcG9ydCBvcmcuanVuaXQuQmVmb3JlOwppbXBvcnQgb3JnLmp1bml0LlRl\nc3Q7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0\nQ2FzZTsKCi8qKgogKiBMZWRnZXJDYWNoZSByZWxhdGVkIHRlc3QgY2FzZXMK\nICovCnB1YmxpYyBjbGFzcyBMZWRnZXJDYWNoZVRlc3QgZXh0ZW5kcyBUZXN0\nQ2FzZSB7CiAgICBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3Rvcnku\nZ2V0TG9nZ2VyKExlZGdlckNhY2hlVGVzdC5jbGFzcyk7CgogICAgU25hcHNo\nb3RNYXA8TG9uZywgQm9vbGVhbj4gYWN0aXZlTGVkZ2VyczsKICAgIExlZGdl\nck1hbmFnZXJGYWN0b3J5IGxlZGdlck1hbmFnZXJGYWN0b3J5OwogICAgTGVk\nZ2VyQ2FjaGUgbGVkZ2VyQ2FjaGU7CiAgICBUaHJlYWQgZmx1c2hUaHJlYWQ7\nCiAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CiAgICBGaWxlIHR4bkRp\nciwgbGVkZ2VyRGlyOwoKICAgIHByaXZhdGUgQm9va2llIGJvb2tpZTsKCiAg\nICBAT3ZlcnJpZGUKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldFVw\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdHhuRGlyID0gRmlsZS5j\ncmVhdGVUZW1wRmlsZSgibGVkZ2VyY2FjaGUiLCAidHhuIik7CiAgICAgICAg\ndHhuRGlyLmRlbGV0ZSgpOwogICAgICAgIHR4bkRpci5ta2RpcigpOwogICAg\nICAgIGxlZGdlckRpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImxlZGdlcmNh\nY2hlIiwgImxlZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsK\nICAgICAgICBsZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICAvLyBjcmVhdGUg\nY3VycmVudCBkaXIKICAgICAgICBuZXcgRmlsZShsZWRnZXJEaXIsIEJvb2tL\nZWVwZXJDb25zdGFudHMuQ1VSUkVOVF9ESVIpLm1rZGlyKCk7CgogICAgICAg\nIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwogICAgICAgIGNv\nbmYuc2V0WmtTZXJ2ZXJzKG51bGwpOwogICAgICAgIGNvbmYuc2V0QWxsb3dM\nb29wYmFjayh0cnVlKTsKICAgICAgICBjb25mLnNldEpvdXJuYWxEaXJOYW1l\nKHR4bkRpci5nZXRQYXRoKCkpOwogICAgICAgIGNvbmYuc2V0TGVkZ2VyRGly\nTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsK\nICAgICAgICBib29raWUgPSBuZXcgQm9va2llKGNvbmYpOwoKICAgICAgICBs\nZWRnZXJNYW5hZ2VyRmFjdG9yeSA9CiAgICAgICAgICAgIExlZGdlck1hbmFn\nZXJGYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGNvbmYsIG51bGwp\nOwogICAgICAgIGFjdGl2ZUxlZGdlcnMgPSBuZXcgU25hcHNob3RNYXA8TG9u\nZywgQm9vbGVhbj4oKTsKICAgICAgICBsZWRnZXJDYWNoZSA9ICgoSW50ZXJs\nZWF2ZWRMZWRnZXJTdG9yYWdlKSBib29raWUubGVkZ2VyU3RvcmFnZSkubGVk\nZ2VyQ2FjaGU7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBAQWZ0ZXIKICAg\nIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKGZsdXNoVGhyZWFkICE9IG51bGwpIHsKICAgICAgICAgICAg\nZmx1c2hUaHJlYWQuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIGZsdXNoVGhy\nZWFkLmpvaW4oKTsKICAgICAgICB9CiAgICAgICAgYm9va2llLmxlZGdlclN0\nb3JhZ2Uuc2h1dGRvd24oKTsKICAgICAgICBsZWRnZXJNYW5hZ2VyRmFjdG9y\neS51bmluaXRpYWxpemUoKTsKICAgICAgICBGaWxlVXRpbHMuZGVsZXRlRGly\nZWN0b3J5KHR4bkRpcik7CiAgICAgICAgRmlsZVV0aWxzLmRlbGV0ZURpcmVj\ndG9yeShsZWRnZXJEaXIpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBuZXdM\nZWRnZXJDYWNoZSgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKGxlZGdlckNhY2hlICE9IG51bGwpIHsKICAgICAgICAgICAgbGVkZ2VyQ2Fj\naGUuY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgbGVkZ2VyQ2FjaGUgPSAo\nKEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZSkgYm9va2llLmxlZGdlclN0b3Jh\nZ2UpLmxlZGdlckNhY2hlID0gbmV3IExlZGdlckNhY2hlSW1wbCgKICAgICAg\nICAgICAgICAgIGNvbmYsIGFjdGl2ZUxlZGdlcnMsIGJvb2tpZS5nZXRMZWRn\nZXJEaXJzTWFuYWdlcigpKTsKICAgICAgICBmbHVzaFRocmVhZCA9IG5ldyBU\naHJlYWQoKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7\nCiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHNsZWVwKGNvbmYuZ2V0Rmx1c2hJbnRlcnZhbCgpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2VyKHRy\ndWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8ga2lsbGVkIGJ5IHRlYXJkb3duCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4g\nZmx1c2ggdGhyZWFkIiwgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH07CiAgICAgICAgZmx1c2hUaHJlYWQuc3RhcnQoKTsKICAgIH0K\nCiAgICBAVGVzdCh0aW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndEFkZEVudHJ5RXhjZXB0aW9uKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBzZXQgcGFnZSBsaW1pdGF0aW9uCiAgICAgICAgY29uZi5zZXRQ\nYWdlTGltaXQoMTApOwogICAgICAgIC8vIGNyZWF0ZSBhIGxlZGdlciBjYWNo\nZQogICAgICAgIG5ld0xlZGdlckNhY2hlKCk7CiAgICAgICAgLyoKICAgICAg\nICAgKiBQb3B1bGF0ZSBsZWRnZXIgY2FjaGUuCiAgICAgICAgICovCiAgICAg\nICAgdHJ5IHsKICAgICAgICAgICAgYnl0ZVtdIG1hc3RlcktleSA9ICJibGFo\nIi5nZXRCeXRlcygpOwogICAgICAgICAgICBmb3IoIGludCBpID0gMDsgaSA8\nIDEwMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5zZXRN\nYXN0ZXJLZXkoKGxvbmcpaSwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAg\nIGxlZGdlckNhY2hlLnB1dEVudHJ5T2Zmc2V0KGksIDAsIGkqOCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiR290IElPRXhjZXB0aW9uLiIsIGUpOwog\nICAgICAgICAgICBmYWlsKCJGYWlsZWQgdG8gYWRkIGVudHJ5LiIpOwogICAg\nICAgIH0KICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTMwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdExlZGdlckV2aWN0aW9uKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgaW50IG51bUVudHJpZXMgPSAxMDsKICAgICAgICAvLyBs\naW1pdCBvcGVuIGZpbGVzICYgcGFnZXMKICAgICAgICBjb25mLnNldE9wZW5G\naWxlTGltaXQoMSkuc2V0UGFnZUxpbWl0KDIpCiAgICAgICAgICAgIC5zZXRQ\nYWdlU2l6ZSg4ICogbnVtRW50cmllcyk7CiAgICAgICAgLy8gY3JlYXRlIGxl\nZGdlciBjYWNoZQogICAgICAgIG5ld0xlZGdlckNhY2hlKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAgICAg\nICAgICBieXRlW10gbWFzdGVyS2V5ID0gImJsYWgiLmdldEJ5dGVzKCk7CiAg\nICAgICAgICAgIGZvciAoaW50IGk9MTsgaTw9bnVtTGVkZ2VyczsgaSsrKSB7\nCiAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5zZXRNYXN0ZXJLZXkoKGxv\nbmcpaSwgbWFzdGVyS2V5KTsKICAgICAgICAgICAgICAgIGZvciAoaW50IGo9\nMDsgajxudW1FbnRyaWVzOyBqKyspIHsKICAgICAgICAgICAgICAgICAgICBs\nZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNldChpLCBqLCBpICogbnVtRW50cmll\ncyArIGopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVy\ncm9yKCJHb3QgRXhjZXB0aW9uLiIsIGUpOwogICAgICAgICAgICBmYWlsKCJG\nYWlsZWQgdG8gYWRkIGVudHJ5LiIpOwogICAgICAgIH0KICAgIH0KCiAgICBA\nVGVzdCh0aW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdERlbGV0\nZUxlZGdlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBudW1F\nbnRyaWVzID0gMTA7CiAgICAgICAgLy8gbGltaXQgb3BlbiBmaWxlcyAmIHBh\nZ2VzCiAgICAgICAgY29uZi5zZXRPcGVuRmlsZUxpbWl0KDk5OSkuc2V0UGFn\nZUxpbWl0KDIpCiAgICAgICAgICAgIC5zZXRQYWdlU2l6ZSg4ICogbnVtRW50\ncmllcyk7CiAgICAgICAgLy8gY3JlYXRlIGxlZGdlciBjYWNoZQogICAgICAg\nIG5ld0xlZGdlckNhY2hlKCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\naW50IG51bUxlZGdlcnMgPSAyOwogICAgICAgICAgICBieXRlW10gbWFzdGVy\nS2V5ID0gImJsYWgiLmdldEJ5dGVzKCk7CiAgICAgICAgICAgIGZvciAoaW50\nIGk9MTsgaTw9bnVtTGVkZ2VyczsgaSsrKSB7CiAgICAgICAgICAgICAgICBs\nZWRnZXJDYWNoZS5zZXRNYXN0ZXJLZXkoKGxvbmcpaSwgbWFzdGVyS2V5KTsK\nICAgICAgICAgICAgICAgIGZvciAoaW50IGo9MDsgajxudW1FbnRyaWVzOyBq\nKyspIHsKICAgICAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5wdXRFbnRy\neU9mZnNldChpLCBqLCBpKm51bUVudHJpZXMgKyBqKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBsZWRnZXIgY2Fj\naGUgaXMgZXhoYXVzdGVkCiAgICAgICAgICAgIC8vIGRlbGV0ZSBsZWRnZXJz\nCiAgICAgICAgICAgIGZvciAoaW50IGk9MTsgaTw9bnVtTGVkZ2VyczsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5kZWxldGVMZWRnZXIo\nKGxvbmcpaSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgLy8gY3JlYXRl\nIG51bSBsZWRnZXJzIHRvIGFkZCBlbnRyaWVzCiAgICAgICAgICAgIGZvciAo\naW50IGk9bnVtTGVkZ2VycysxOyBpPD0yKm51bUxlZGdlcnM7IGkrKykgewog\nICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuc2V0TWFzdGVyS2V5KChsb25n\nKWksIG1hc3RlcktleSk7CiAgICAgICAgICAgICAgICBmb3IgKGludCBqPTA7\nIGo8bnVtRW50cmllczsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgbGVk\nZ2VyQ2FjaGUucHV0RW50cnlPZmZzZXQoaSwgaiwgaSpudW1FbnRyaWVzICsg\naik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIkdvdCBFeGNlcHRpb24uIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIkZhaWxl\nZCB0byBhZGQgZW50cnkuIik7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogVGVzdCBzaW11bGF0aW5nIHJhY2UgY29uZGl0aW9uIGJldHdlZW4g\nd2hlbiBhIGxlZGdlciBpcyBkZWxldGluZyBhbmQgYW4KICAgICAqIGV2aWN0\naW9uIGZyb20gTGVkZ2VyQ2FjaGUgc2ltdWx0YW5lb3VzbHkKICAgICAqLwog\nICAgQFRlc3QodGltZW91dCA9IDYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndFBhZ2VFdmljdGlvbldoaWxlRGVsZXRlTGVkZ2VySW5Qcm9ncmVzcygpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgbGVkZ2VyRGlyMSA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJrVGVzdCIsICIuZGlyIik7CiAgICAgICAg\nbGVkZ2VyRGlyMS5kZWxldGUoKTsKICAgICAgICBGaWxlIGxlZGdlckRpcjIg\nPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJia1Rlc3QiLCAiLmRpciIpOwogICAg\nICAgIGxlZGdlckRpcjIuZGVsZXRlKCk7CiAgICAgICAgU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKTsKICAg\nICAgICBjb25mLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxl\nZGdlckRpcjEuZ2V0QWJzb2x1dGVQYXRoKCksCiAgICAgICAgICAgICAgICBs\nZWRnZXJEaXIyLmdldEFic29sdXRlUGF0aCgpIH0pOwogICAgICAgIGNvbmYu\nc2V0T3BlbkZpbGVMaW1pdCgxKTsKICAgICAgICBjb25mLnNldEFsbG93TG9v\ncGJhY2sodHJ1ZSk7CgogICAgICAgIEJvb2tpZSBib29raWUgPSBuZXcgQm9v\na2llKGNvbmYpOwogICAgICAgIEludGVybGVhdmVkTGVkZ2VyU3RvcmFnZSBs\nZWRnZXJTdG9yYWdlID0gKChJbnRlcmxlYXZlZExlZGdlclN0b3JhZ2UpIGJv\nb2tpZS5sZWRnZXJTdG9yYWdlKTsKICAgICAgICBmaW5hbCBMZWRnZXJDYWNo\nZUltcGwgbGVkZ2VyQ2FjaGUgPSAoTGVkZ2VyQ2FjaGVJbXBsKSBsZWRnZXJT\ndG9yYWdlLmxlZGdlckNhY2hlOwogICAgICAgIC8vIENyZWF0ZSBsZWRnZXIg\naW5kZXgKICAgICAgICBmaW5hbCBpbnQgbGVkZ2VyQ291bnQgPSAyOwogICAg\nICAgIHB1dExlZGdlcihsZWRnZXJDYWNoZSwgbGVkZ2VyQ291bnQpOwogICAg\nICAgIGZvciAoaW50IGlkID0gMDsgaWQgPCBsZWRnZXJDb3VudDsgaWQrKykg\newogICAgICAgICAgICBMT0cuaW5mbygiRGVsZXRpbmcgbGVkZ2VyIGlkIHt9\nIiwgaWQpOwogICAgICAgICAgICBsZWRnZXJDYWNoZS5kZWxldGVMZWRnZXIo\naWQpOwogICAgICAgIH0KICAgICAgICAvLyBBZGRpbmcgbGVkZ2VycyBiYWNr\nIHRvIHRoZSBvcGVuTGVkZ2VycyBkYXRhIHN0cnVjdHVyZS4gVGhpcyBpcyBk\nb25lCiAgICAgICAgLy8gdG8gc2ltdWxhdGUgdGhlIGNhc2UgLSBkdXJpbmcg\nbGVkZ2VyIGV2aWN0aW9uIGl0IHdvdWxkIGJlIGRlbGV0ZWQKICAgICAgICAv\nLyBmcm9tIGZpbGVJbmZvQ2FjaGUgYW5kIGV4aXN0cyBvbmx5IGluIG9wZW5M\nZWRnZXJzIGxpc3QsIGFzIHRoZXNlIHR3bwogICAgICAgIC8vIGFyZSBub3Qg\nYXRvbWljIG9wZXJhdGlvbnMKICAgICAgICBsZWRnZXJDYWNoZS5vcGVuTGVk\nZ2Vycy5hZGQoTG9uZy52YWx1ZU9mKDApKTsKICAgICAgICBsZWRnZXJDYWNo\nZS5vcGVuTGVkZ2Vycy5hZGQoTG9uZy52YWx1ZU9mKDEpKTsKICAgICAgICBm\nb3IgKGludCBpZCA9IDA7IGlkIDwgbGVkZ2VyQ291bnQ7IGlkKyspIHsKICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIExPRy5pbmZvKCJSZWFk\naW5nIGxlZGdlciBpZCB7fSIsIGlkKTsKICAgICAgICAgICAgICAgIGxlZGdl\nckNhY2hlLmdldEZpbGVJbmZvKExvbmcudmFsdWVPZihpZCksICJrZXkiLmdl\ndEJ5dGVzKCkpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgTE9HLmluZm8oIkV4Y2VwdGlvbiBvY2N1cmVk\nIHdoaWxlIGdldHRpbmcgdGhlIGxlZGdlciBpbmZvISIsIGUpOwogICAgICAg\nICAgICAgICAgQXNzZXJ0LmZhaWwoIkV4Y2VwdGlvbiBvY2N1cmVkIHdoaWxl\nIGdldHRpbmcgdGhlIGxlZGdlciBpZCAiCiAgICAgICAgICAgICAgICAgICAg\nICAgICsgaWQpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgdm9pZCBwdXRMZWRnZXIoTGVkZ2VyQ2FjaGVJbXBsIGxlZGdl\nckNhY2hlLCBpbnQgY291bnQpCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgZm9yIChpbnQgaWQgPSAwOyBpZCA8IGNvdW50OyBp\nZCsrKSB7CiAgICAgICAgICAgIGxlZGdlckNhY2hlLmdldEZpbGVJbmZvKExv\nbmcudmFsdWVPZihpZCksICJrZXkiLmdldEJ5dGVzKCkpOwogICAgICAgIH0K\nICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdFBhZ2VFdmljdGlvbigpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGludCBudW1MZWRnZXJzID0gMTA7CiAgICAgICAgYnl0ZVtdIG1hc3Rl\ncktleSA9ICJibGFoIi5nZXRCeXRlcygpOwogICAgICAgIC8vIGxpbWl0IHBh\nZ2UgY291bnQKICAgICAgICBjb25mLnNldE9wZW5GaWxlTGltaXQoOTk5OTk5\nKS5zZXRQYWdlTGltaXQoMyk7CiAgICAgICAgLy8gY3JlYXRlIGxlZGdlciBj\nYWNoZQogICAgICAgIG5ld0xlZGdlckNhY2hlKCk7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgLy8gY3JlYXRlIHNlcnZlcmFsIGxlZGdlcnMKICAgICAg\nICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRnZXJzOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGxlZGdlckNhY2hlLnNldE1hc3RlcktleSgobG9uZylp\nLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUucHV0\nRW50cnlPZmZzZXQoaSwgMCwgaSo4KTsKICAgICAgICAgICAgICAgIGxlZGdl\nckNhY2hlLnB1dEVudHJ5T2Zmc2V0KGksIDEsIGkqOCk7CiAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgIC8vIGZsdXNoIGFsbCBmaXJzdCB0byBjbGVhbiBw\ncmV2aW91cyBkaXJ0eSBsZWRnZXJzCiAgICAgICAgICAgIGxlZGdlckNhY2hl\nLmZsdXNoTGVkZ2VyKHRydWUpOwogICAgICAgICAgICAvLyBmbHVzaCBhbGwg\nCiAgICAgICAgICAgIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2VyKHRydWUpOwoK\nICAgICAgICAgICAgLy8gZGVsZXRlIHNlcnZlcmFsIGxlZGdlcnMKICAgICAg\nICAgICAgZm9yIChpbnQgaT0xOyBpPD1udW1MZWRnZXJzLzI7IGkrKykgewog\nICAgICAgICAgICAgICAgbGVkZ2VyQ2FjaGUuZGVsZXRlTGVkZ2VyKGkpOwog\nICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBib29raWUgcmVzdGFydHMK\nICAgICAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsKCiAgICAgICAgICAgIC8v\nIHNpbXVsYXRlIHJlcGxheWluZyBqb3VybmFscyB0byBhZGQgZW50cmllcyBh\nZ2FpbgogICAgICAgICAgICBmb3IgKGludCBpPTE7IGk8PW51bUxlZGdlcnM7\nIGkrKykgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBsZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNldChpLCAxLCBpKjgpOwog\nICAgICAgICAgICAgICAgfSBjYXRjaCAoTm9MZWRnZXJFeGNlcHRpb24gbnNs\nZSkgewogICAgICAgICAgICAgICAgICAgIGlmIChpPD1udW1MZWRnZXJzLzIp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaXQgaXMgb2sKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBMT0cuZXJyb3IoIkVycm9yIHB1dCBlbnRyeSBvZmZzZXQgOiAiLCBuc2xl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmFpbCgiU2hvdWxkIG5vdCBy\nZWFjaCBoZXJlLiIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiR290IEV4Y2VwdGlv\nbi4iLCBlKTsKICAgICAgICAgICAgZmFpbCgiRmFpbGVkIHRvIGFkZCBlbnRy\neS4iKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IExl\nZGdlciBDYWNoZSBmbHVzaCBmYWlsdXJlCiAgICAgKi8KICAgIEBUZXN0KHRp\nbWVvdXQ9MzAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0TGVkZ2VyQ2FjaGVG\nbHVzaEZhaWx1cmVPbkRpc2tGdWxsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgRmlsZSBsZWRnZXJEaXIxID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgi\nYmtUZXN0IiwgIi5kaXIiKTsKICAgICAgICBsZWRnZXJEaXIxLmRlbGV0ZSgp\nOwogICAgICAgIEZpbGUgbGVkZ2VyRGlyMiA9IEZpbGUuY3JlYXRlVGVtcEZp\nbGUoImJrVGVzdCIsICIuZGlyIik7CiAgICAgICAgbGVkZ2VyRGlyMi5kZWxl\ndGUoKTsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcg\nU2VydmVyQ29uZmlndXJhdGlvbigpLnNldEFsbG93TG9vcGJhY2sodHJ1ZSk7\nCiAgICAgICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10g\neyBsZWRnZXJEaXIxLmdldEFic29sdXRlUGF0aCgpLCBsZWRnZXJEaXIyLmdl\ndEFic29sdXRlUGF0aCgpIH0pOwoKICAgICAgICBCb29raWUgYm9va2llID0g\nbmV3IEJvb2tpZShjb25mKTsKICAgICAgICBJbnRlcmxlYXZlZExlZGdlclN0\nb3JhZ2UgbGVkZ2VyU3RvcmFnZSA9ICgoSW50ZXJsZWF2ZWRMZWRnZXJTdG9y\nYWdlKSBib29raWUubGVkZ2VyU3RvcmFnZSk7CiAgICAgICAgTGVkZ2VyQ2Fj\naGVJbXBsIGxlZGdlckNhY2hlID0gKExlZGdlckNhY2hlSW1wbCkgbGVkZ2Vy\nU3RvcmFnZS5sZWRnZXJDYWNoZTsKICAgICAgICAvLyBDcmVhdGUgbGVkZ2Vy\nIGluZGV4IGZpbGUKICAgICAgICBsZWRnZXJTdG9yYWdlLnNldE1hc3Rlcktl\neSgxLCAia2V5Ii5nZXRCeXRlcygpKTsKCiAgICAgICAgRmlsZUluZm8gZmls\nZUluZm8gPSBsZWRnZXJDYWNoZS5nZXRGaWxlSW5mbyhMb25nLnZhbHVlT2Yo\nMSksIG51bGwpOwoKICAgICAgICAvLyBTaW11bGF0ZSB0aGUgZmx1c2ggZmFp\nbHVyZQogICAgICAgIEZpbGVJbmZvIG5ld0ZpbGVJbmZvID0gbmV3IEZpbGVJ\nbmZvKGZpbGVJbmZvLmdldExmKCksIGZpbGVJbmZvLmdldE1hc3RlcktleSgp\nKTsKICAgICAgICBsZWRnZXJDYWNoZS5maWxlSW5mb0NhY2hlLnB1dChMb25n\nLnZhbHVlT2YoMSksIG5ld0ZpbGVJbmZvKTsKICAgICAgICAvLyBBZGQgZW50\ncmllcwogICAgICAgIGxlZGdlclN0b3JhZ2UuYWRkRW50cnkoZ2VuZXJhdGVF\nbnRyeSgxLCAxKSk7CiAgICAgICAgbGVkZ2VyU3RvcmFnZS5hZGRFbnRyeShn\nZW5lcmF0ZUVudHJ5KDEsIDIpKTsKICAgICAgICBsZWRnZXJTdG9yYWdlLmZs\ndXNoKCk7CgogICAgICAgIGxlZGdlclN0b3JhZ2UuYWRkRW50cnkoZ2VuZXJh\ndGVFbnRyeSgxLCAzKSk7CiAgICAgICAgLy8gYWRkIHRoZSBkaXIgdG8gZmFp\nbGVkIGRpcnMKICAgICAgICBib29raWUuZ2V0TGVkZ2VyRGlyc01hbmFnZXIo\nKS5hZGRUb0ZpbGxlZERpcnMoCiAgICAgICAgICAgICAgICBuZXdGaWxlSW5m\nby5nZXRMZigpLmdldFBhcmVudEZpbGUoKS5nZXRQYXJlbnRGaWxlKCkuZ2V0\nUGFyZW50RmlsZSgpKTsKICAgICAgICBGaWxlIGJlZm9yZSA9IG5ld0ZpbGVJ\nbmZvLmdldExmKCk7CiAgICAgICAgLy8gZmx1c2ggYWZ0ZXIgZGlzayBpcyBh\nZGRlZCBhcyBmYWlsZWQuCiAgICAgICAgbGVkZ2VyU3RvcmFnZS5mbHVzaCgp\nOwogICAgICAgIEZpbGUgYWZ0ZXIgPSBuZXdGaWxlSW5mby5nZXRMZigpOwoK\nICAgICAgICBhc3NlcnRFcXVhbHMoIlJlZmVyZW5jZSBjb3VudGluZyBmb3Ig\ndGhlIGZpbGUgaW5mbyBzaG91bGQgYmUgemVyby4iLCAwLCBuZXdGaWxlSW5m\nby5nZXRVc2VDb3VudCgpKTsKCiAgICAgICAgYXNzZXJ0RmFsc2UoIkFmdGVy\nIGZsdXNoIGluZGV4IGZpbGUgc2hvdWxkIGJlIGNoYW5nZWQiLCBiZWZvcmUu\nZXF1YWxzKGFmdGVyKSk7CiAgICAgICAgLy8gVmVyaWZ5IHdyaXR0ZW4gZW50\ncmllcwogICAgICAgIEFzc2VydC5hc3NlcnRBcnJheUVxdWFscyhnZW5lcmF0\nZUVudHJ5KDEsIDEpLmFycmF5KCksIGxlZGdlclN0b3JhZ2UuZ2V0RW50cnko\nMSwgMSkuYXJyYXkoKSk7CiAgICAgICAgQXNzZXJ0LmFzc2VydEFycmF5RXF1\nYWxzKGdlbmVyYXRlRW50cnkoMSwgMikuYXJyYXkoKSwgbGVkZ2VyU3RvcmFn\nZS5nZXRFbnRyeSgxLCAyKS5hcnJheSgpKTsKICAgICAgICBBc3NlcnQuYXNz\nZXJ0QXJyYXlFcXVhbHMoZ2VuZXJhdGVFbnRyeSgxLCAzKS5hcnJheSgpLCBs\nZWRnZXJTdG9yYWdlLmdldEVudHJ5KDEsIDMpLmFycmF5KCkpOwogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlmIHdlIGFyZSB3cml0aW5nIHRv\nIG1vcmUgbGVkZ2VycyB0aGFuIHRoZXJlCiAgICAgKiBhcmUgcGFnZXMsIHRo\nZW4gd2Ugd2lsbCBub3QgZmx1c2ggdGhlIGluZGV4IGJlZm9yZSB0aGUKICAg\nICAqIGVudHJpZXMgaW4gdGhlIGVudHJ5bG9nZ2VyIGhhdmUgYmVlbiBwZXJz\naXN0ZWQgdG8gZGlzay4KICAgICAqIHtAbGluayBodHRwczovL2lzc3Vlcy5h\ncGFjaGUub3JnL2ppcmEvYnJvd3NlL0JPT0tLRUVQRVItNDQ3fQogICAgICov\nCiAgICBAVGVzdCh0aW1lb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndEluZGV4UGFnZUV2aWN0aW9uV3JpdGVPcmRlcigpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGZpbmFsIGludCBudW1MZWRnZXJzID0gMTA7CiAgICAg\nICAgRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9v\na2llIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFsRGlyLmRlbGV0ZSgp\nOwogICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUu\nY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJl\nY3Rvcnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxlIGxlZGdlckRpciA9\nIEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsKICAg\nICAgICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1r\nZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJl\nKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpcikpOwoKICAg\nICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29u\nZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkK\nICAgICAgICAgICAgLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkKICAgICAgICAg\nICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQog\nICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsg\nbGVkZ2VyRGlyLmdldFBhdGgoKSB9KQogICAgICAgICAgICAuc2V0Rmx1c2hJ\nbnRlcnZhbCgxMDAwKQogICAgICAgICAgICAuc2V0UGFnZUxpbWl0KDEpOwoK\nICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAg\nYi5zdGFydCgpOwogICAgICAgIGZvciAoaW50IGkgPSAxOyBpIDw9IG51bUxl\nZGdlcnM7IGkrKykgewogICAgICAgICAgICBCeXRlQnVmZmVyIHBhY2tldCA9\nIGdlbmVyYXRlRW50cnkoaSwgMSk7CiAgICAgICAgICAgIGIuYWRkRW50cnko\ncGFja2V0LCBuZXcgQm9va2llLk5vcFdyaXRlQ2FsbGJhY2soKSwgbnVsbCwg\nInBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICBjb25m\nID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAgICAgICAgICAuc2V0\nQWxsb3dMb29wYmFjayh0cnVlKQogICAgICAgICAgICAuc2V0WmtTZXJ2ZXJz\nKG51bGwpCiAgICAgICAgICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFs\nRGlyLmdldFBhdGgoKSkKICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVz\nKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRpci5nZXRQYXRoKCkgfSk7CgogICAg\nICAgIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgIGZvciAoaW50IGkg\nPSAxOyBpIDw9IG51bUxlZGdlcnM7IGkrKykgewogICAgICAgICAgICB0cnkg\newogICAgICAgICAgICAgICAgYi5yZWFkRW50cnkoaSwgMSk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0xlZGdlckV4Y2VwdGlvbiBubGUpIHsK\nICAgICAgICAgICAgICAgIC8vIHRoaXMgaXMgZmluZSwgbWVhbnMgdGhlIGxl\nZGdlciB3YXMgbmV2ZXIgd3JpdHRlbiB0byB0aGUgaW5kZXggY2FjaGUKICAg\nICAgICAgICAgICAgIGFzc2VydEVxdWFscygiTm8gbGVkZ2VyIHNob3VsZCBv\nbmx5IGhhcHBlbiBmb3IgdGhlIGxhc3QgbGVkZ2VyIiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBpLCBudW1MZWRnZXJzKTsKICAgICAgICAgICAg\nfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNlcHRpb24gbmVlKSB7CiAgICAg\nICAgICAgICAgICAvLyB0aGlzIGlzIGZpbmUsIG1lYW5zIHRoZSBsZWRnZXIg\nd2FzIHdyaXR0ZW4gdG8gdGhlIGluZGV4IGNhY2hlLCBidXQgbm90CiAgICAg\nICAgICAgICAgICAvLyB0aGUgZW50cnkgbG9nCiAgICAgICAgICAgIH0gY2F0\nY2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIlNob3VsZG4ndCBoYXZlIHJlY2VpdmVkIElPRXhjZXB0aW9uIiwgaW9l\nKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCB0aHJvdyBJT0V4\nY2VwdGlvbiwgc2hvdWxkIHNheSB0aGF0IGVudHJ5IGlzIG5vdCBmb3VuZCIp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKCiAgICAvKioKICAg\nICAqIHtAbGluayBodHRwczovL2lzc3Vlcy5hcGFjaGUub3JnL2ppcmEvYnJv\nd3NlL0JPT0tLRUVQRVItNTI0fQogICAgICogQ2hlY2tzIHRoYXQgZ2V0TGVk\nZ2VyRW50cnlQYWdlIGRvZXMgbm90IHRocm93IGFuIE5QRSBpbiB0aGUKICAg\nICAqIGNhc2UgZ2V0RnJvbVRhYmxlIHJldHVybnMgYSBudWxsIGxlZGdlciBl\nbnRyeSBwYWdlIHJlZmVyZW5jZS4KICAgICAqIFRoaXMgTlBFIG1pZ2h0IGtp\nbGwgdGhlIHN5bmMgdGhyZWFkIGxlYXZpbmcgYSBib29raWUgd2l0aCBubwog\nICAgICogc3luYyB0aHJlYWQgcnVubmluZy4KICAgICAqCiAgICAgKiBAdGhy\nb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9MzAw\nMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY1RocmVhZE5QRSgpIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbmV3TGVkZ2VyQ2FjaGUoKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICAoKExlZGdlckNhY2hlSW1wbCkgbGVk\nZ2VyQ2FjaGUpLmdldExlZGdlckVudHJ5UGFnZSgwTCwgMEwsIHRydWUpOwog\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiRXhjZXB0aW9uIHdoZW4gdHJ5aW5nIHRvIGdldCBhIGxlZGdl\nciBlbnRyeSBwYWdlIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4n\ndCBoYXZlIHRocm93biBhbiBleGNlcHRpb24iKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBSYWNlIHdoZXJlIGEgZmx1c2ggd291bGQgZmFp\nbCBiZWNhdXNlIGEgZ2FyYmFnZSBjb2xsZWN0aW9uIG9jY3VycmVkIGF0CiAg\nICAgKiB0aGUgd3JvbmcgdGltZS4KICAgICAqIHtAbGluayBodHRwczovL2lz\nc3Vlcy5hcGFjaGUub3JnL2ppcmEvYnJvd3NlL0JPT0tLRUVQRVItNjA0fQog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZv\naWQgdGVzdEZsdXNoRGVsZXRlUmFjZSgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIG5ld0xlZGdlckNhY2hlKCk7CiAgICAgICAgZmluYWwgQXRvbWlj\nSW50ZWdlciByYyA9IG5ldyBBdG9taWNJbnRlZ2VyKDApOwogICAgICAgIGZp\nbmFsIExpbmtlZEJsb2NraW5nUXVldWU8TG9uZz4gbGVkZ2VyUSA9IG5ldyBM\naW5rZWRCbG9ja2luZ1F1ZXVlPExvbmc+KDEpOwogICAgICAgIGZpbmFsIGJ5\ndGVbXSBtYXN0ZXJLZXkgPSAibWFzdGVyS2V5Ii5nZXRCeXRlcygpOwogICAg\nICAgIFRocmVhZCBuZXdMZWRnZXJUaHJlYWQgPSBuZXcgVGhyZWFkKCkgewog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgMTAwMCAmJiByYy5nZXQoKSA9PSAwOyBpKyspIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZGdlckNhY2hlLnNldE1h\nc3RlcktleShpLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgbGVkZ2VyUS5wdXQoKGxvbmcpaSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICByYy5zZXQoLTEpOwog\nICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBp\nbiBuZXcgbGVkZ2VyIHRocmVhZCIsIGUpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICBu\nZXdMZWRnZXJUaHJlYWQuc3RhcnQoKTsKCiAgICAgICAgVGhyZWFkIGZsdXNo\nVGhyZWFkID0gbmV3IFRocmVhZCgpIHsKICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgTG9uZyBpZCA9IGxlZGdlclEucGVlaygpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIExPRy5pbmZvKCJQdXQgZW50cnkgZm9yIHt9IiwgaWQpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNl\ndCgobG9uZylpZCwgMSwgMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9IGNhdGNoIChCb29raWUuTm9MZWRnZXJFeGNlcHRpb24gbmxlKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9pZ25vcmUKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2VyKHRydWUpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmMu\nc2V0KC0xKTsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJF\neGNlcHRpb24gaW4gZmx1c2ggdGhyZWFkIiwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAg\nICAgIGZsdXNoVGhyZWFkLnN0YXJ0KCk7CgogICAgICAgIFRocmVhZCBkZWxl\ndGVUaHJlYWQgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsb25nIGlkID0gbGVkZ2VyUS50YWtlKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiRGVsZXRp\nbmcge30iLCBpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZWRn\nZXJDYWNoZS5kZWxldGVMZWRnZXIoaWQpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmMuc2V0KC0xKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4g\nZGVsZXRlIHRocmVhZCIsIGUpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICBkZWxldGVU\naHJlYWQuc3RhcnQoKTsKCiAgICAgICAgbmV3TGVkZ2VyVGhyZWFkLmpvaW4o\nKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBoYXZlIGJlZW4gbm8g\nZXJyb3JzIiwgcmMuZ2V0KCksIDApOwoKICAgICAgICBkZWxldGVUaHJlYWQu\naW50ZXJydXB0KCk7CiAgICAgICAgZmx1c2hUaHJlYWQuaW50ZXJydXB0KCk7\nCiAgICB9CgogICAgcHJpdmF0ZSBCeXRlQnVmZmVyIGdlbmVyYXRlRW50cnko\nbG9uZyBsZWRnZXIsIGxvbmcgZW50cnkpIHsKICAgICAgICBieXRlW10gZGF0\nYSA9ICgibGVkZ2VyLSIgKyBsZWRnZXIgKyAiLSIgKyBlbnRyeSkuZ2V0Qnl0\nZXMoKTsKICAgICAgICBCeXRlQnVmZmVyIGJiID0gQnl0ZUJ1ZmZlci53cmFw\nKG5ldyBieXRlWzggKyA4ICsgZGF0YS5sZW5ndGhdKTsKICAgICAgICBiYi5w\ndXRMb25nKGxlZGdlcik7CiAgICAgICAgYmIucHV0TG9uZyhlbnRyeSk7CiAg\nICAgICAgYmIucHV0KGRhdGEpOwogICAgICAgIGJiLmZsaXAoKTsKICAgICAg\nICByZXR1cm4gYmI7CiAgICB9Cn0K\n","encoding":"base64"}

