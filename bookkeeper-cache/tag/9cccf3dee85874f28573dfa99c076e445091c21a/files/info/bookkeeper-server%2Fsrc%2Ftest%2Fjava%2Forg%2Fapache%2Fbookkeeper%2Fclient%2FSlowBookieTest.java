{"sha":"0e2f2711b1541808c6eaa15ac4ecbda2346c87ea","node_id":"MDQ6QmxvYjE1NzU5NTY6MGUyZjI3MTFiMTU0MTgwOGM2ZWFhMTVhYzRlY2JkYTIzNDZjODdlYQ==","size":7947,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0e2f2711b1541808c6eaa15ac4ecbda2346c87ea","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQ7Cgpp\nbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0ludGVn\nZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWlj\nQm9vbGVhbjsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRBZGRyZXNzOwpp\nbXBvcnQgb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0\nLkFzc2VydC4qOwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0Q2FzZTsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9n\nZ2VyRmFjdG9yeTsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJv\ndG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LkJvb2tLZWVw\nZXJDbHVzdGVyVGVzdENhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwoKQFN1cHByZXNzV2Fybmlu\nZ3MoImRlcHJlY2F0aW9uIikKcHVibGljIGNsYXNzIFNsb3dCb29raWVUZXN0\nIGV4dGVuZHMgQm9va0tlZXBlckNsdXN0ZXJUZXN0Q2FzZSB7CiAgICBzdGF0\naWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFNsb3dC\nb29raWVUZXN0LmNsYXNzKTsKCiAgICBwdWJsaWMgU2xvd0Jvb2tpZVRlc3Qo\nKSB7CiAgICAgICAgc3VwZXIoNCk7CiAgICB9CgogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTbG93Qm9va2llKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xpZW50Q29uZmlndXJhdGlvbiBj\nb25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsKICAgICAgICBjb25m\nLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmlu\nZygpKS5zZXRSZWFkVGltZW91dCgzNjApOwoKICAgICAgICBCb29rS2VlcGVy\nIGJrYyA9IG5ldyBCb29rS2VlcGVyKGNvbmYpOwoKICAgICAgICBMZWRnZXJI\nYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDQsIDMsIDIsIEJvb2tLZWVw\nZXIuRGlnZXN0VHlwZS5DUkMzMiwgbmV3IGJ5dGVbXSB7fSk7CgogICAgICAg\nIGJ5dGVbXSBlbnRyeSA9ICJUZXN0IEVudHJ5Ii5nZXRCeXRlcygpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAg\nICBsaC5hZGRFbnRyeShlbnRyeSk7CiAgICAgICAgfQogICAgICAgIGZpbmFs\nIENvdW50RG93bkxhdGNoIGIwbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2go\nMSk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggYjFsYXRjaCA9IG5l\ndyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBMaXN0PEluZXRTb2NrZXRB\nZGRyZXNzPiBjdXJFbnMgPSBsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmN1cnJl\nbnRFbnNlbWJsZTsKICAgICAgICB0cnkgewogICAgICAgICAgICBzbGVlcEJv\nb2tpZShjdXJFbnMuZ2V0KDApLCBiMGxhdGNoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgICAgICBs\naC5hZGRFbnRyeShlbnRyeSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nc2xlZXBCb29raWUoY3VyRW5zLmdldCgyKSwgYjFsYXRjaCk7IC8vIHNob3Vs\nZCBjb3ZlciBhbGwgcXVvcnVtcwoKICAgICAgICAgICAgZmluYWwgQXRvbWlj\nSW50ZWdlciBpID0gbmV3IEF0b21pY0ludGVnZXIoMHhkZWFkYmVlZik7CiAg\nICAgICAgICAgIEFzeW5jQ2FsbGJhY2suQWRkQ2FsbGJhY2sgY2IgPSBuZXcg\nQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBhZGRDb21wbGV0ZShpbnQgcmMsIExlZGdlckhh\nbmRsZSBsaCwgbG9uZyBlbnRyeUlkLCBPYmplY3QgY3R4KSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIGkuc2V0KHJjKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICBsaC5hc3luY0Fk\nZEVudHJ5KGVudHJ5LCBjYiwgbnVsbCk7CgogICAgICAgICAgICBUaHJlYWQu\nc2xlZXAoMTAwMCk7IC8vIHNsZWVwIGEgc2Vjb25kIHRvIGFsbG93IHRpbWUg\ndG8gY29tcGxldGUKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKGkuZ2V0KCks\nIDB4ZGVhZGJlZWYpOwogICAgICAgICAgICBiMGxhdGNoLmNvdW50RG93bigp\nOwogICAgICAgICAgICBiMWxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAg\nICBUaHJlYWQuc2xlZXAoMjAwMCk7CiAgICAgICAgICAgIGFzc2VydEVxdWFs\ncyhpLmdldCgpLCBCS0V4Y2VwdGlvbi5Db2RlLk9LKTsKICAgICAgICB9IGZp\nbmFsbHkgewogICAgICAgICAgICBiMGxhdGNoLmNvdW50RG93bigpOwogICAg\nICAgICAgICBiMWxhdGNoLmNvdW50RG93bigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndEJvb2tpZUZhaWx1cmVXaXRoU2xvd0Jvb2tpZSgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIENsaWVudENvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBD\nbGllbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgY29uZi5zZXRaa1NlcnZl\ncnMoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSkuc2V0UmVh\nZFRpbWVvdXQoNSk7CgogICAgICAgIEJvb2tLZWVwZXIgYmtjID0gbmV3IEJv\nb2tLZWVwZXIoY29uZik7CgogICAgICAgIGJ5dGVbXSBwd2QgPSBuZXcgYnl0\nZVtdIHt9OwogICAgICAgIGZpbmFsIExlZGdlckhhbmRsZSBsaCA9IGJrYy5j\ncmVhdGVMZWRnZXIoNCwgMywgMiwgQm9va0tlZXBlci5EaWdlc3RUeXBlLkNS\nQzMyLCBwd2QpOwogICAgICAgIGxvbmcgbGlkID0gbGguZ2V0SWQoKTsKICAg\nICAgICBmaW5hbCBBdG9taWNCb29sZWFuIGZpbmlzaGVkID0gbmV3IEF0b21p\nY0Jvb2xlYW4oZmFsc2UpOwogICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4g\nZmFpbFRlc3QgPSBuZXcgQXRvbWljQm9vbGVhbihmYWxzZSk7CiAgICAgICAg\nZmluYWwgYnl0ZVtdIGVudHJ5ID0gIlRlc3QgRW50cnkiLmdldEJ5dGVzKCk7\nCiAgICAgICAgVGhyZWFkIHQgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAg\nICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdoaWxlICghZmluaXNo\nZWQuZ2V0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxoLmFk\nZEVudHJ5KGVudHJ5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIGFk\nZCBlbnRyeSB0aHJlYWQiLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nZmFpbFRlc3Quc2V0KHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICB0LnN0YXJ0\nKCk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggYjBsYXRjaCA9IG5l\ndyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBzdGFydE5ld0Jvb2tpZSgp\nOwogICAgICAgIHNsZWVwQm9va2llKGdldEJvb2tpZSgwKSwgYjBsYXRjaCk7\nCiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDAwKTsKICAgICAgICBiMGxhdGNo\nLmNvdW50RG93bigpOwogICAgICAgIGZpbmlzaGVkLnNldCh0cnVlKTsKICAg\nICAgICB0LmpvaW4oKTsKCiAgICAgICAgYXNzZXJ0RmFsc2UoZmFpbFRlc3Qu\nZ2V0KCkpOwoKICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICBMZWRnZXJI\nYW5kbGUgbGgyID0gYmtjLm9wZW5MZWRnZXIobGguZ2V0SWQoKSwgQm9va0tl\nZXBlci5EaWdlc3RUeXBlLkNSQzMyLCBwd2QpOwogICAgICAgIExlZGdlckNo\nZWNrZXIgbGMgPSBuZXcgTGVkZ2VyQ2hlY2tlcihia2MpOwogICAgICAgIGZp\nbmFsIENvdW50RG93bkxhdGNoIGNoZWNrbGF0Y2ggPSBuZXcgQ291bnREb3du\nTGF0Y2goMSk7CiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBudW1GcmFn\nbWVudHMgPSBuZXcgQXRvbWljSW50ZWdlcigtMSk7CiAgICAgICAgbGMuY2hl\nY2tMZWRnZXIobGgyLCBuZXcgR2VuZXJpY0NhbGxiYWNrPFNldDxMZWRnZXJG\ncmFnbWVudD4+KCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uQ29tcGxldGUoaW50IHJjLCBTZXQ8TGVkZ2VyRnJhZ21lbnQ+IGZy\nYWdtZW50cykgewogICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiQ2hl\nY2tlZCBsZWRnZXJzIHJldHVybmVkIHt9IHt9IiwgcmMsIGZyYWdtZW50cyk7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJLRXhjZXB0aW9uLkNv\nZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgbnVtRnJhZ21lbnRz\nLnNldChmcmFnbWVudHMuc2l6ZSgpKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgY2hlY2tsYXRjaC5jb3VudERvd24oKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgY2hl\nY2tsYXRjaC5hd2FpdCgpOwogICAgICAgIGFzc2VydEVxdWFscygiVGhlcmUg\nc2hvdWxkIGJlIG5vIG1pc3NpbmcgZnJhZ21lbnRzIiwgMCwgbnVtRnJhZ21l\nbnRzLmdldCgpKTsKICAgIH0KCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQog\nICAgcHVibGljIHZvaWQgdGVzdE1hbnlCb29raWVGYWlsdXJlV2l0aFNsb3dC\nb29raWVzKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xpZW50Q29u\nZmlndXJhdGlvbiBjb25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBjb25mLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVy\nQ29ubmVjdFN0cmluZygpKS5zZXRSZWFkVGltZW91dCg1KTsKCiAgICAgICAg\nQm9va0tlZXBlciBia2MgPSBuZXcgQm9va0tlZXBlcihjb25mKTsKCiAgICAg\nICAgYnl0ZVtdIHB3ZCA9IG5ldyBieXRlW10ge307CiAgICAgICAgZmluYWwg\nTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0ZUxlZGdlcig0LCAzLCAxLCBC\nb29rS2VlcGVyLkRpZ2VzdFR5cGUuQ1JDMzIsIHB3ZCk7CiAgICAgICAgbG9u\nZyBsaWQgPSBsaC5nZXRJZCgpOwogICAgICAgIGZpbmFsIEF0b21pY0Jvb2xl\nYW4gZmluaXNoZWQgPSBuZXcgQXRvbWljQm9vbGVhbihmYWxzZSk7CiAgICAg\nICAgZmluYWwgQXRvbWljQm9vbGVhbiBmYWlsVGVzdCA9IG5ldyBBdG9taWNC\nb29sZWFuKGZhbHNlKTsKICAgICAgICBmaW5hbCBieXRlW10gZW50cnkgPSAi\nVGVzdCBFbnRyeSIuZ2V0Qnl0ZXMoKTsKICAgICAgICBUaHJlYWQgdCA9IG5l\ndyBUaHJlYWQoKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4o\nKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICAgICAgd2hpbGUgKCFmaW5pc2hlZC5nZXQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbGguYWRkRW50cnkoZW50cnkpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJFeGNlcHRpb24gaW4gYWRkIGVudHJ5IHRocmVhZCIsIGUpOwog\nICAgICAgICAgICAgICAgICAgICAgICBmYWlsVGVzdC5zZXQodHJ1ZSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9OwogICAgICAgIHQuc3RhcnQoKTsKICAgICAgICBmaW5hbCBDb3Vu\ndERvd25MYXRjaCBiMGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwog\nICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGIxbGF0Y2ggPSBuZXcgQ291\nbnREb3duTGF0Y2goMSk7CgogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAg\nICAgICAgc3RhcnROZXdCb29raWUoKTsKCiAgICAgICAgc2xlZXBCb29raWUo\nZ2V0Qm9va2llKDApLCBiMGxhdGNoKTsKICAgICAgICBzbGVlcEJvb2tpZShn\nZXRCb29raWUoMSksIGIxbGF0Y2gpOwoKICAgICAgICBUaHJlYWQuc2xlZXAo\nMTAwMDApOwogICAgICAgIGIwbGF0Y2guY291bnREb3duKCk7CiAgICAgICAg\nYjFsYXRjaC5jb3VudERvd24oKTsKICAgICAgICBmaW5pc2hlZC5zZXQodHJ1\nZSk7CiAgICAgICAgdC5qb2luKCk7CgogICAgICAgIGFzc2VydEZhbHNlKGZh\naWxUZXN0LmdldCgpKTsKCiAgICAgICAgbGguY2xvc2UoKTsKCiAgICAgICAg\nTGVkZ2VySGFuZGxlIGxoMiA9IGJrYy5vcGVuTGVkZ2VyKGxoLmdldElkKCks\nIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwgcHdkKTsKICAgICAgICBM\nZWRnZXJDaGVja2VyIGxjID0gbmV3IExlZGdlckNoZWNrZXIoYmtjKTsKICAg\nICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBjaGVja2xhdGNoID0gbmV3IENv\ndW50RG93bkxhdGNoKDEpOwogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIg\nbnVtRnJhZ21lbnRzID0gbmV3IEF0b21pY0ludGVnZXIoLTEpOwogICAgICAg\nIGxjLmNoZWNrTGVkZ2VyKGxoMiwgbmV3IEdlbmVyaWNDYWxsYmFjazxTZXQ8\nTGVkZ2VyRnJhZ21lbnQ+PigpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIG9wZXJhdGlvbkNvbXBsZXRlKGludCByYywgU2V0PExlZGdlckZyYWdt\nZW50PiBmcmFnbWVudHMpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVi\ndWcoIkNoZWNrZWQgbGVkZ2VycyByZXR1cm5lZCB7fSB7fSIsIHJjLCBmcmFn\nbWVudHMpOwogICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBCS0V4Y2Vw\ndGlvbi5Db2RlLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG51bUZy\nYWdtZW50cy5zZXQoZnJhZ21lbnRzLnNpemUoKSk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIGNoZWNrbGF0Y2guY291bnRE\nb3duKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAg\nICAgIGNoZWNrbGF0Y2guYXdhaXQoKTsKICAgICAgICBhc3NlcnRFcXVhbHMo\nIlRoZXJlIHNob3VsZCBiZSBubyBtaXNzaW5nIGZyYWdtZW50cyIsIDAsIG51\nbUZyYWdtZW50cy5nZXQoKSk7CiAgICB9Cn0K\n","encoding":"base64"}

