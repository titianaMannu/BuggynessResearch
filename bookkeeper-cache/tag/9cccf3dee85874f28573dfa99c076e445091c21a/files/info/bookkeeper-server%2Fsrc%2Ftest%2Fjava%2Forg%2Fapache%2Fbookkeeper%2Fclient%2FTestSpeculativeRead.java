{"sha":"bf20b21d37c91cf8076b878a3220b5b13665e33d","node_id":"MDQ6QmxvYjE1NzU5NTY6YmYyMGIyMWQzN2M5MWNmODA3NmI4NzhhMzIyMGI1YjEzNjY1ZTMzZA==","size":13604,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/bf20b21d37c91cf8076b878a3220b5b13665e33d","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgb3JnLmp1bml0Lio7CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuU2V0OwppbXBvcnQgamF2YS51dGlsLkhhc2hTZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLkNvdW50RG93bkxhdGNoOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJh\nY2suUmVhZENhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIudGVzdC5CYXNlVGVzdENhc2U7CgppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5\nOwoKLyoqCiAqIFRoaXMgdW5pdCB0ZXN0IHRlc3RzIGxlZGdlciBmZW5jaW5n\nOwogKgogKi8KcHVibGljIGNsYXNzIFRlc3RTcGVjdWxhdGl2ZVJlYWQgZXh0\nZW5kcyBCYXNlVGVzdENhc2UgewogICAgc3RhdGljIExvZ2dlciBMT0cgPSBM\nb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZXN0U3BlY3VsYXRpdmVSZWFkLmNs\nYXNzKTsKCiAgICBEaWdlc3RUeXBlIGRpZ2VzdFR5cGU7CiAgICBieXRlW10g\ncGFzc3dkID0gInNwZWNQVyIuZ2V0Qnl0ZXMoKTsKCiAgICBwdWJsaWMgVGVz\ndFNwZWN1bGF0aXZlUmVhZChEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHsKICAg\nICAgICBzdXBlcigxMCk7CiAgICAgICAgdGhpcy5kaWdlc3RUeXBlID0gZGln\nZXN0VHlwZTsKICAgIH0KCiAgICBsb25nIGdldExlZGdlclRvUmVhZChpbnQg\nZW5zZW1ibGUsIGludCBxdW9ydW0pIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGJ5dGVbXSBkYXRhID0gIkRhdGEgZm9yIHRlc3QiLmdldEJ5dGVzKCk7\nCiAgICAgICAgTGVkZ2VySGFuZGxlIGwgPSBia2MuY3JlYXRlTGVkZ2VyKGVu\nc2VtYmxlLCBxdW9ydW0sIGRpZ2VzdFR5cGUsIHBhc3N3ZCk7CiAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIGwu\nYWRkRW50cnkoZGF0YSk7CiAgICAgICAgfQogICAgICAgIGwuY2xvc2UoKTsK\nCiAgICAgICAgcmV0dXJuIGwuZ2V0SWQoKTsKICAgIH0KCiAgICBAU3VwcHJl\nc3NXYXJuaW5ncygiZGVwcmVjYXRpb24iKQogICAgQm9va0tlZXBlciBjcmVh\ndGVDbGllbnQoaW50IHNwZWNUaW1lb3V0KSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBDbGllbnRDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgQ2xpZW50\nQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRTcGVjdWxhdGl2ZVJl\nYWRUaW1lb3V0KHNwZWNUaW1lb3V0KQogICAgICAgICAgICAuc2V0UmVhZFRp\nbWVvdXQoMzAwMDApOwogICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKHprVXRp\nbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCkpOwogICAgICAgIHJldHVy\nbiBuZXcgQm9va0tlZXBlcihjb25mKTsKICAgIH0KCiAgICBjbGFzcyBMYXRj\naENhbGxiYWNrIGltcGxlbWVudHMgUmVhZENhbGxiYWNrIHsKICAgICAgICBD\nb3VudERvd25MYXRjaCBsID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAg\nICAgIGJvb2xlYW4gc3VjY2VzcyA9IGZhbHNlOwogICAgICAgIGxvbmcgc3Rh\ncnRNaWxsaXMgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAg\nICBsb25nIGVuZE1pbGxpcyA9IExvbmcuTUFYX1ZBTFVFOwoKICAgICAgICBw\ndWJsaWMgdm9pZCByZWFkQ29tcGxldGUoaW50IHJjLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBMZWRnZXJIYW5kbGUgbGgsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVu\ndHJ5PiBzZXEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE9i\namVjdCBjdHgpIHsKICAgICAgICAgICAgZW5kTWlsbGlzID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiR290\nIHJlc3BvbnNlIHt9IHt9IiwgcmMsIGdldER1cmF0aW9uKCkpOwogICAgICAg\nICAgICBzdWNjZXNzID0gcmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSzsKICAg\nICAgICAgICAgbC5jb3VudERvd24oKTsKICAgICAgICB9CgogICAgICAgIGxv\nbmcgZ2V0RHVyYXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBlbmRNaWxs\naXMgLSBzdGFydE1pbGxpczsKICAgICAgICB9CgogICAgICAgIHZvaWQgZXhw\nZWN0U3VjY2VzcyhpbnQgbWlsbGlzZWNvbmRzKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShsLmF3YWl0KG1pbGxpc2Vjb25k\ncywgVGltZVVuaXQuTUlMTElTRUNPTkRTKSk7CiAgICAgICAgICAgIGFzc2Vy\ndFRydWUoc3VjY2Vzcyk7CiAgICAgICAgfQoKICAgICAgICB2b2lkIGV4cGVj\ndEZhaWwoaW50IG1pbGxpc2Vjb25kcykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIGFzc2VydFRydWUobC5hd2FpdChtaWxsaXNlY29uZHMsIFRp\nbWVVbml0Lk1JTExJU0VDT05EUykpOwogICAgICAgICAgICBhc3NlcnRGYWxz\nZShzdWNjZXNzKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgZXhwZWN0VGlt\nZW91dChpbnQgbWlsbGlzZWNvbmRzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgYXNzZXJ0RmFsc2UobC5hd2FpdChtaWxsaXNlY29uZHMsIFRp\nbWVVbml0Lk1JTExJU0VDT05EUykpOwogICAgICAgIH0KICAgIH0KCiAgICAv\nKioKICAgICAqIFRlc3QgYmFzaWMgc3BlY3VsYXRpdmUgZnVuY3Rpb25hbGl0\neS4KICAgICAqIC0gQ3JlYXRlIDIgY2xpZW50cyB3aXRoIHJlYWQgdGltZW91\ndCBkaXNhYmxlZCwgb25lIHdpdGggc3BlYwogICAgICogICByZWFkIGVuYWJs\nZWQsIHRoZSBvdGhlciBub3QuCiAgICAgKiAtIGNyZWF0ZSBsZWRnZXIKICAg\nICAqIC0gc2xlZXAgc2Vjb25kIGJvb2tpZSBpbiBlbnNlbWJsZQogICAgICog\nLSByZWFkIGZpcnN0IGVudHJ5LCBib3RoIHNob3VsZCBmaW5kIG9uIGZpcnN0\nIGJvb2tpZS4KICAgICAqIC0gcmVhZCBzZWNvbmQgYm9va2llLCBzcGVjIGNs\naWVudCBzaG91bGQgZmluZCBvbiBib29raWUgdGhyZWUsCiAgICAgKiAgIG5v\nbiBzcGVjIGNsaWVudCBzaG91bGQgaGFuZy4KICAgICAqLwogICAgQFRlc3Qo\ndGltZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTcGVjdWxhdGl2\nZVJlYWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGlkID0g\nZ2V0TGVkZ2VyVG9SZWFkKDMsMik7CiAgICAgICAgQm9va0tlZXBlciBia25v\nc3BlYyA9IGNyZWF0ZUNsaWVudCgwKTsgLy8gZGlzYWJsZWQKICAgICAgICBC\nb29rS2VlcGVyIGJrc3BlYyA9IGNyZWF0ZUNsaWVudCgyMDAwKTsKCiAgICAg\nICAgTGVkZ2VySGFuZGxlIGxub3NwZWMgPSBia25vc3BlYy5vcGVuTGVkZ2Vy\nKGlkLCBkaWdlc3RUeXBlLCBwYXNzd2QpOwogICAgICAgIExlZGdlckhhbmRs\nZSBsc3BlYyA9IGJrc3BlYy5vcGVuTGVkZ2VyKGlkLCBkaWdlc3RUeXBlLCBw\nYXNzd2QpOwoKICAgICAgICAvLyBzbGVlcCBzZWNvbmQgYm9va2llCiAgICAg\nICAgQ291bnREb3duTGF0Y2ggc2xlZXBMYXRjaCA9IG5ldyBDb3VudERvd25M\nYXRjaCgxKTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBzZWNvbmQgPSBs\nbm9zcGVjLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkuZ2V0\nKDBMKS5nZXQoMSk7CiAgICAgICAgc2xlZXBCb29raWUoc2Vjb25kLCBzbGVl\ncExhdGNoKTsKCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gcmVhZCBm\naXJzdCBlbnRyeSwgYm90aCBnbyB0byBmaXJzdCBib29raWUsIHNob3VsZCBi\nZSBmaW5lCiAgICAgICAgICAgIExhdGNoQ2FsbGJhY2sgbm9zcGVjY2IgPSBu\nZXcgTGF0Y2hDYWxsYmFjaygpOwogICAgICAgICAgICBMYXRjaENhbGxiYWNr\nIHNwZWNjYiA9IG5ldyBMYXRjaENhbGxiYWNrKCk7CiAgICAgICAgICAgIGxu\nb3NwZWMuYXN5bmNSZWFkRW50cmllcygwLCAwLCBub3NwZWNjYiwgbnVsbCk7\nCiAgICAgICAgICAgIGxzcGVjLmFzeW5jUmVhZEVudHJpZXMoMCwgMCwgc3Bl\nY2NiLCBudWxsKTsKICAgICAgICAgICAgbm9zcGVjY2IuZXhwZWN0U3VjY2Vz\ncygyMDAwKTsKICAgICAgICAgICAgc3BlY2NiLmV4cGVjdFN1Y2Nlc3MoMjAw\nMCk7CgogICAgICAgICAgICAvLyByZWFkIHNlY29uZCBlbnRyeSwgYm90aCBs\nb29rIGZvciBzZWNvbmQgYm9vaywgc3BlYyByZWFkIGNsaWVudAogICAgICAg\nICAgICAvLyB0cmllcyB0aGlyZCBib29raWUsIG5vbnNwZWMgY2xpZW50IGhh\nbmdzIGFzIHJlYWQgdGltZW91dCBpcyB2ZXJ5IGxvbmcuCiAgICAgICAgICAg\nIG5vc3BlY2NiID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAgICAgICAgICAg\nc3BlY2NiID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAgICAgICAgICAgbG5v\nc3BlYy5hc3luY1JlYWRFbnRyaWVzKDEsIDEsIG5vc3BlY2NiLCBudWxsKTsK\nICAgICAgICAgICAgbHNwZWMuYXN5bmNSZWFkRW50cmllcygxLCAxLCBzcGVj\nY2IsIG51bGwpOwogICAgICAgICAgICBzcGVjY2IuZXhwZWN0U3VjY2Vzcyg0\nMDAwKTsKICAgICAgICAgICAgbm9zcGVjY2IuZXhwZWN0VGltZW91dCg0MDAw\nKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBzbGVlcExhdGNo\nLmNvdW50RG93bigpOwogICAgICAgICAgICBsc3BlYy5jbG9zZSgpOwogICAg\nICAgICAgICBsbm9zcGVjLmNsb3NlKCk7CiAgICAgICAgICAgIGJrc3BlYy5j\nbG9zZSgpOwogICAgICAgICAgICBia25vc3BlYy5jbG9zZSgpOwogICAgICAg\nIH0KICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiBtb3JlIHRo\nYW4gb25lIHJlcGxpY2EgaXMgZG93biwgd2UgY2FuIHN0aWxsIHJlYWQsIGFz\nIGxvbmcgYXMgdGhlIHF1b3J1bQogICAgICogc2l6ZSBpcyBsYXJnZXIgdGhh\nbiB0aGUgbnVtYmVyIG9mIGRvd24gcmVwbGljYXMuCiAgICAgKi8KICAgIEBU\nZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0U3BlY3Vs\nYXRpdmVSZWFkTXVsdGlwbGVSZXBsaWNhc0Rvd24oKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBsb25nIGlkID0gZ2V0TGVkZ2VyVG9SZWFkKDUsNSk7\nCiAgICAgICAgaW50IHRpbWVvdXQgPSA1MDAwOwogICAgICAgIEJvb2tLZWVw\nZXIgYmtzcGVjID0gY3JlYXRlQ2xpZW50KHRpbWVvdXQpOwoKICAgICAgICBM\nZWRnZXJIYW5kbGUgbCA9IGJrc3BlYy5vcGVuTGVkZ2VyKGlkLCBkaWdlc3RU\neXBlLCBwYXNzd2QpOwoKICAgICAgICAvLyBzbGVlcCBib29raWUgMSwgMiAm\nIDQKICAgICAgICBDb3VudERvd25MYXRjaCBzbGVlcExhdGNoID0gbmV3IENv\ndW50RG93bkxhdGNoKDEpOwogICAgICAgIHNsZWVwQm9va2llKGwuZ2V0TGVk\nZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgxKSwg\nc2xlZXBMYXRjaCk7CiAgICAgICAgc2xlZXBCb29raWUobC5nZXRMZWRnZXJN\nZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0KDIpLCBzbGVl\ncExhdGNoKTsKICAgICAgICBzbGVlcEJvb2tpZShsLmdldExlZGdlck1ldGFk\nYXRhKCkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQoNCksIHNsZWVwTGF0\nY2gpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyByZWFkIGZpcnN0\nIGVudHJ5LCBzaG91bGQgY29tcGxldGUgZmFzdGVyIHRoYW4gdGltZW91dAog\nICAgICAgICAgICAvLyBhcyBib29raWUgMCBoYXMgdGhlIGVudHJ5CiAgICAg\nICAgICAgIExhdGNoQ2FsbGJhY2sgbGF0Y2gwID0gbmV3IExhdGNoQ2FsbGJh\nY2soKTsKICAgICAgICAgICAgbC5hc3luY1JlYWRFbnRyaWVzKDAsIDAsIGxh\ndGNoMCwgbnVsbCk7CiAgICAgICAgICAgIGxhdGNoMC5leHBlY3RTdWNjZXNz\nKHRpbWVvdXQvMik7CgogICAgICAgICAgICAvLyBzZWNvbmQgc2hvdWxkIGhh\ndmUgdG8gaGl0IHR3byB0aW1lb3V0cyAoYm9va2llIDEgJiAyKQogICAgICAg\nICAgICAvLyBib29raWUgMyBoYXMgdGhlIGVudHJ5CiAgICAgICAgICAgIExh\ndGNoQ2FsbGJhY2sgbGF0Y2gxID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAg\nICAgICAgICAgbC5hc3luY1JlYWRFbnRyaWVzKDEsIDEsIGxhdGNoMSwgbnVs\nbCk7CiAgICAgICAgICAgIGxhdGNoMS5leHBlY3RUaW1lb3V0KHRpbWVvdXQp\nOwogICAgICAgICAgICBsYXRjaDEuZXhwZWN0U3VjY2Vzcyh0aW1lb3V0KjIp\nOwogICAgICAgICAgICBMT0cuaW5mbygiVGltZW91dCB7fSBsYXRjaDEgZHVy\nYXRpb24ge30iLCB0aW1lb3V0LCBsYXRjaDEuZ2V0RHVyYXRpb24oKSk7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoInNob3VsZCBoYXZlIHRha2VuIGxvbmdl\nciB0aGFuIHR3byB0aW1lb3V0cywgYnV0IGxlc3MgdGhhbiAzIiwKICAgICAg\nICAgICAgICAgICAgICAgICBsYXRjaDEuZ2V0RHVyYXRpb24oKSA+PSB0aW1l\nb3V0KjIKICAgICAgICAgICAgICAgICAgICAgICAmJiBsYXRjaDEuZ2V0RHVy\nYXRpb24oKSA8IHRpbWVvdXQqMyk7CgogICAgICAgICAgICAvLyB0aGlyZCBz\naG91bGQgaGF2ZSB0byBoaXQgb25lIHRpbWVvdXRzIChib29raWUgMikKICAg\nICAgICAgICAgLy8gYm9va2llIDMgaGFzIHRoZSBlbnRyeQogICAgICAgICAg\nICBMYXRjaENhbGxiYWNrIGxhdGNoMiA9IG5ldyBMYXRjaENhbGxiYWNrKCk7\nCiAgICAgICAgICAgIGwuYXN5bmNSZWFkRW50cmllcygyLCAyLCBsYXRjaDIs\nIG51bGwpOwogICAgICAgICAgICBsYXRjaDIuZXhwZWN0VGltZW91dCh0aW1l\nb3V0LzIpOwogICAgICAgICAgICBsYXRjaDIuZXhwZWN0U3VjY2Vzcyh0aW1l\nb3V0KTsKICAgICAgICAgICAgTE9HLmluZm8oIlRpbWVvdXQge30gbGF0Y2gy\nIGR1cmF0aW9uIHt9IiwgdGltZW91dCwgbGF0Y2gyLmdldER1cmF0aW9uKCkp\nOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJzaG91bGQgaGF2ZSB0YWtlbiBs\nb25nZXIgdGhhbiBvbmUgdGltZW91dCwgYnV0IGxlc3MgdGhhbiAyIiwKICAg\nICAgICAgICAgICAgICAgICAgICBsYXRjaDIuZ2V0RHVyYXRpb24oKSA+PSB0\naW1lb3V0CiAgICAgICAgICAgICAgICAgICAgICAgJiYgbGF0Y2gyLmdldER1\ncmF0aW9uKCkgPCB0aW1lb3V0KjIpOwoKICAgICAgICAgICAgLy8gZm91cnRo\nIHNob3VsZCBoYXZlIG5vIHRpbWVvdXQKICAgICAgICAgICAgLy8gYm9va2ll\nIDMgaGFzIHRoZSBlbnRyeQogICAgICAgICAgICBMYXRjaENhbGxiYWNrIGxh\ndGNoMyA9IG5ldyBMYXRjaENhbGxiYWNrKCk7CiAgICAgICAgICAgIGwuYXN5\nbmNSZWFkRW50cmllcygzLCAzLCBsYXRjaDMsIG51bGwpOwogICAgICAgICAg\nICBsYXRjaDMuZXhwZWN0U3VjY2Vzcyh0aW1lb3V0LzIpOwoKICAgICAgICAg\nICAgLy8gZmlmdGggc2hvdWxkIGhpdCBvbmUgdGltZW91dCwgKGJvb2tpZSA0\nKQogICAgICAgICAgICAvLyBib29raWUgMCBoYXMgdGhlIGVudHJ5CiAgICAg\nICAgICAgIExhdGNoQ2FsbGJhY2sgbGF0Y2g0ID0gbmV3IExhdGNoQ2FsbGJh\nY2soKTsKICAgICAgICAgICAgbC5hc3luY1JlYWRFbnRyaWVzKDQsIDQsIGxh\ndGNoNCwgbnVsbCk7CiAgICAgICAgICAgIGxhdGNoNC5leHBlY3RUaW1lb3V0\nKHRpbWVvdXQvMik7CiAgICAgICAgICAgIGxhdGNoNC5leHBlY3RTdWNjZXNz\nKHRpbWVvdXQpOwogICAgICAgICAgICBMT0cuaW5mbygiVGltZW91dCB7fSBs\nYXRjaDQgZHVyYXRpb24ge30iLCB0aW1lb3V0LCBsYXRjaDQuZ2V0RHVyYXRp\nb24oKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoInNob3VsZCBoYXZlIHRh\na2VuIGxvbmdlciB0aGFuIG9uZSB0aW1lb3V0LCBidXQgbGVzcyB0aGFuIDIi\nLAogICAgICAgICAgICAgICAgICAgICAgIGxhdGNoNC5nZXREdXJhdGlvbigp\nID49IHRpbWVvdXQKICAgICAgICAgICAgICAgICAgICAgICAmJiBsYXRjaDQu\nZ2V0RHVyYXRpb24oKSA8IHRpbWVvdXQqMik7CgogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHNsZWVwTGF0Y2guY291bnREb3duKCk7CiAgICAg\nICAgICAgIGwuY2xvc2UoKTsKICAgICAgICAgICAgYmtzcGVjLmNsb3NlKCk7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlm\nIGFmdGVyIGEgc3BlY3VsYXRpdmUgcmVhZCBpcyBraWNrZWQgb2ZmLCB0aGUg\nb3JpZ2luYWwgcmVhZCBjb21wbGV0ZXMKICAgICAqIG5vdGhpbmcgYmFkIGhh\ncHBlbnMuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0U3BlY3VsYXRpdmVSZWFkRmlyc3RSZWFkQ29tcGxl\ndGVJc09rKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBpZCA9\nIGdldExlZGdlclRvUmVhZCgyLDIpOwogICAgICAgIGludCB0aW1lb3V0ID0g\nMTAwMDsKICAgICAgICBCb29rS2VlcGVyIGJrc3BlYyA9IGNyZWF0ZUNsaWVu\ndCh0aW1lb3V0KTsKCiAgICAgICAgTGVkZ2VySGFuZGxlIGwgPSBia3NwZWMu\nb3BlbkxlZGdlcihpZCwgZGlnZXN0VHlwZSwgcGFzc3dkKTsKCiAgICAgICAg\nLy8gc2xlZXAgYm9va2llcwogICAgICAgIENvdW50RG93bkxhdGNoIHNsZWVw\nTGF0Y2gwID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIENvdW50\nRG93bkxhdGNoIHNsZWVwTGF0Y2gxID0gbmV3IENvdW50RG93bkxhdGNoKDEp\nOwogICAgICAgIHNsZWVwQm9va2llKGwuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5n\nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgwKSwgc2xlZXBMYXRjaDApOwog\nICAgICAgIHNsZWVwQm9va2llKGwuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRF\nbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgxKSwgc2xlZXBMYXRjaDEpOwoKICAg\nICAgICB0cnkgewogICAgICAgICAgICAvLyByZWFkIGdvZXMgdG8gZmlyc3Qg\nYm9va2llLCBzcGVjIHJlYWQgdGltZW91dCBvY2N1cnMsCiAgICAgICAgICAg\nIC8vIGdvZXMgdG8gc2Vjb25kCiAgICAgICAgICAgIExhdGNoQ2FsbGJhY2sg\nbGF0Y2gwID0gbmV3IExhdGNoQ2FsbGJhY2soKTsKICAgICAgICAgICAgbC5h\nc3luY1JlYWRFbnRyaWVzKDAsIDAsIGxhdGNoMCwgbnVsbCk7CiAgICAgICAg\nICAgIGxhdGNoMC5leHBlY3RUaW1lb3V0KHRpbWVvdXQpOwoKICAgICAgICAg\nICAgLy8gd2FrZSB1cCBmaXJzdCBib29raWUKICAgICAgICAgICAgc2xlZXBM\nYXRjaDAuY291bnREb3duKCk7CiAgICAgICAgICAgIGxhdGNoMC5leHBlY3RT\ndWNjZXNzKHRpbWVvdXQvMik7CgogICAgICAgICAgICBzbGVlcExhdGNoMS5j\nb3VudERvd24oKTsKCiAgICAgICAgICAgIC8vIGNoZWNrIHdlIGNhbiByZWFk\nIG5leHQgZW50cnkgd2l0aG91dCBpc3N1ZQogICAgICAgICAgICBMYXRjaENh\nbGxiYWNrIGxhdGNoMSA9IG5ldyBMYXRjaENhbGxiYWNrKCk7CiAgICAgICAg\nICAgIGwuYXN5bmNSZWFkRW50cmllcygxLCAxLCBsYXRjaDEsIG51bGwpOwog\nICAgICAgICAgICBsYXRjaDEuZXhwZWN0U3VjY2Vzcyh0aW1lb3V0LzIpOwoK\nICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBzbGVlcExhdGNoMC5j\nb3VudERvd24oKTsKICAgICAgICAgICAgc2xlZXBMYXRjaDEuY291bnREb3du\nKCk7CiAgICAgICAgICAgIGwuY2xvc2UoKTsKICAgICAgICAgICAgYmtzcGVj\nLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVW5p\ndCB0ZXN0IGZvciB0aGUgc3BlY3VsYXRpdmUgcmVhZCBzY2hlZHVsaW5nIG1l\ndGhvZAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdFNwZWN1bGF0aXZlUmVhZFNjaGVkdWxpbmcoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICBsb25nIGlkID0gZ2V0TGVkZ2VyVG9S\nZWFkKDMsMik7CiAgICAgICAgaW50IHRpbWVvdXQgPSAxMDAwOwogICAgICAg\nIEJvb2tLZWVwZXIgYmtzcGVjID0gY3JlYXRlQ2xpZW50KHRpbWVvdXQpOwoK\nICAgICAgICBMZWRnZXJIYW5kbGUgbCA9IGJrc3BlYy5vcGVuTGVkZ2VyKGlk\nLCBkaWdlc3RUeXBlLCBwYXNzd2QpOwoKICAgICAgICBBcnJheUxpc3Q8SW5l\ndFNvY2tldEFkZHJlc3M+IGVuc2VtYmxlID0gbC5nZXRMZWRnZXJNZXRhZGF0\nYSgpLmdldEVuc2VtYmxlcygpLmdldCgwTCk7CiAgICAgICAgU2V0PEluZXRT\nb2NrZXRBZGRyZXNzPiBhbGxIb3N0cyA9IG5ldyBIYXNoU2V0KGVuc2VtYmxl\nKTsKICAgICAgICBTZXQ8SW5ldFNvY2tldEFkZHJlc3M+IG5vSG9zdCA9IG5l\ndyBIYXNoU2V0KCk7CiAgICAgICAgU2V0PEluZXRTb2NrZXRBZGRyZXNzPiBz\nZWNvbmRIb3N0T25seSA9IG5ldyBIYXNoU2V0KCk7CiAgICAgICAgc2Vjb25k\nSG9zdE9ubHkuYWRkKGVuc2VtYmxlLmdldCgxKSk7CiAgICAgICAgUGVuZGlu\nZ1JlYWRPcC5MZWRnZXJFbnRyeVJlcXVlc3QgcmVxMCA9IG51bGwsIHJlcTIg\nPSBudWxsLCByZXE0ID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBMYXRjaENhbGxiYWNrIGxhdGNoMCA9IG5ldyBMYXRjaENhbGxiYWNrKCk7\nCiAgICAgICAgICAgIFBlbmRpbmdSZWFkT3Agb3AgPSBuZXcgUGVuZGluZ1Jl\nYWRPcChsLCBia3NwZWMuc2NoZWR1bGVyLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgMCwgNSwgbGF0Y2gwLCBu\ndWxsKTsKCiAgICAgICAgICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgaGVhcmQg\nZnJvbSBhbGwgaG9zdHMsCiAgICAgICAgICAgIC8vIHdlIG9ubHkgc2VuZCB0\naGUgaW5pdGlhbCByZWFkCiAgICAgICAgICAgIHJlcTAgPSBvcC5uZXcgTGVk\nZ2VyRW50cnlSZXF1ZXN0KGVuc2VtYmxlLCBsLmdldElkKCksIDApOwogICAg\nICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgaGF2ZSBzZW50IHRvIGZpcnN0\nIiwKICAgICAgICAgICAgICAgICAgICAgICByZXEwLm1heWJlU2VuZFNwZWN1\nbGF0aXZlUmVhZChhbGxIb3N0cykuZXF1YWxzKGVuc2VtYmxlLmdldCgwKSkp\nOwogICAgICAgICAgICBhc3NlcnROdWxsKCJTaG91bGQgbm90IGhhdmUgc2Vu\ndCBhbm90aGVyIiwKICAgICAgICAgICAgICAgICAgICAgICByZXEwLm1heWJl\nU2VuZFNwZWN1bGF0aXZlUmVhZChhbGxIb3N0cykpOwoKICAgICAgICAgICAg\nLy8gaWYgd2UgaGF2ZSBoZWFyZCBmcm9tIHNvbWUgaG9zdHMsIGJ1dCBub3Qg\nb25lIHdlIGhhdmUgc2VudCB0bwogICAgICAgICAgICAvLyBzZW5kIGFnYWlu\nCiAgICAgICAgICAgIHJlcTIgPSBvcC5uZXcgTGVkZ2VyRW50cnlSZXF1ZXN0\nKGVuc2VtYmxlLCBsLmdldElkKCksIDIpOwogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJTaG91bGQgaGF2ZSBzZW50IHRvIHRoaXJkIiwKICAgICAgICAgICAg\nICAgICAgICAgICByZXEyLm1heWJlU2VuZFNwZWN1bGF0aXZlUmVhZChub0hv\nc3QpLmVxdWFscyhlbnNlbWJsZS5nZXQoMikpKTsKICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZSgiU2hvdWxkIGhhdmUgc2VudCB0byBmaXJzdCIsCiAgICAgICAg\nICAgICAgICAgICAgICAgcmVxMi5tYXliZVNlbmRTcGVjdWxhdGl2ZVJlYWQo\nc2Vjb25kSG9zdE9ubHkpLmVxdWFscyhlbnNlbWJsZS5nZXQoMCkpKTsKCiAg\nICAgICAgICAgIC8vIGlmIHdlIGhhdmUgaGVhcmQgZnJvbSBzb21lIGhvc3Rz\nLCB3aGljaCBpbmNsdWRlcyBvbmUgd2Ugc2VudCB0bwogICAgICAgICAgICAv\nLyBkbyBub3QgcmVhZCBhZ2FpbgogICAgICAgICAgICByZXE0ID0gb3AubmV3\nIExlZGdlckVudHJ5UmVxdWVzdChlbnNlbWJsZSwgbC5nZXRJZCgpLCA0KTsK\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiU2hvdWxkIGhhdmUgc2VudCB0byBz\nZWNvbmQiLAogICAgICAgICAgICAgICAgICAgICAgIHJlcTQubWF5YmVTZW5k\nU3BlY3VsYXRpdmVSZWFkKG5vSG9zdCkuZXF1YWxzKGVuc2VtYmxlLmdldCgx\nKSkpOwogICAgICAgICAgICBhc3NlcnROdWxsKCJTaG91bGQgbm90IGhhdmUg\nc2VudCBhbm90aGVyIiwKICAgICAgICAgICAgICAgICAgICAgICByZXE0Lm1h\neWJlU2VuZFNwZWN1bGF0aXZlUmVhZChzZWNvbmRIb3N0T25seSkpOwogICAg\nICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGZvciAoUGVuZGluZ1JlYWRP\ncC5MZWRnZXJFbnRyeVJlcXVlc3QgcmVxCiAgICAgICAgICAgICAgICAgICAg\nIDogbmV3IFBlbmRpbmdSZWFkT3AuTGVkZ2VyRW50cnlSZXF1ZXN0W10geyBy\nZXEwLCByZXEyLCByZXE0IH0pIHsKICAgICAgICAgICAgICAgIGlmIChyZXEg\nIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGludCBpID0gMDsKICAg\nICAgICAgICAgICAgICAgICB3aGlsZSAoIXJlcS5pc0NvbXBsZXRlKCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkrKyA+IDEwKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gd2FpdCBmb3IgdXAg\ndG8gMTAgc2Vjb25kcwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0VHJ1\nZSgiUmVxdWVzdCBzaG91bGQgYmUgZG9uZSIsIHJlcTAuaXNDb21wbGV0ZSgp\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgbC5jbG9zZSgpOwogICAgICAgICAgICBia3NwZWMuY2xvc2UoKTsKICAg\nICAgICB9CiAgICB9Cn0=\n","encoding":"base64"}

