{"sha":"7bd03d96fc456eddb7395755376977c75b2e5627","node_id":"MDQ6QmxvYjE1NzU5NTY6N2JkMDNkOTZmYzQ1NmVkZGI3Mzk1NzU1Mzc2OTc3Yzc1YjJlNTYyNw==","size":12374,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7bd03d96fc456eddb7395755376977c75b2e5627","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlv\nbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdC5Cb29rS2Vl\ncGVyQ2x1c3RlclRlc3RDYXNlOwoKaW1wb3J0IGphdmEudXRpbC5jb25jdXJy\nZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuYXRvbWljLkF0b21pY0Jvb2xlYW47CmltcG9ydCBqYXZhLnV0\naWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0\nIGphdmEuaW8uRmlsZU91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uRmls\nZW5hbWVGaWx0ZXI7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuYm9va2llLkJvb2tpZUFjY2Vzc29yOwppbXBvcnQgb3JnLmFw\nYWNoZS5ib29ra2VlcGVyLnV0aWwuU3RyaW5nVXRpbHM7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIuem9va2VlcGVyLlpvb0tlZXBlcldhdGNoZXJC\nYXNlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyRmFjdG9yeTsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci51dGlsLlprVXRpbHM7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuTGVkZ2VyQ2FjaGVJbXBsOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsK\naW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0\nOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1YWxz\nOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBUaGlzIHRlc3QgdmVyaWZpZXMgdGhh\ndCB0aGUgcGVyaW9kIGNoZWNrIG9uIHRoZSBhdWRpdG9yCiAqIHdpbGwgcGlj\nayB1cCBvbiBtaXNzaW5nIGRhdGEgaW4gdGhlIGNsaWVudAogKi8KcHVibGlj\nIGNsYXNzIEF1ZGl0b3JQZXJpb2RpY0NoZWNrVGVzdCBleHRlbmRzIEJvb2tL\nZWVwZXJDbHVzdGVyVGVzdENhc2UgewogICAgcHJpdmF0ZSBmaW5hbCBzdGF0\naWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkKICAgICAgICAgICAgLmdl\ndExvZ2dlcihBdWRpdG9yUGVyaW9kaWNDaGVja1Rlc3QuY2xhc3MpOwoKICAg\nIHByaXZhdGUgSGFzaE1hcDxTdHJpbmcsIEF1ZGl0b3JFbGVjdG9yPiBhdWRp\ndG9yRWxlY3RvcnMgPSBuZXcgSGFzaE1hcDxTdHJpbmcsIEF1ZGl0b3JFbGVj\ndG9yPigpOwogICAgcHJpdmF0ZSBMaXN0PFpvb0tlZXBlcj4gemtDbGllbnRz\nID0gbmV3IExpbmtlZExpc3Q8Wm9vS2VlcGVyPigpOwoKICAgIHByaXZhdGUg\nZmluYWwgc3RhdGljIGludCBDSEVDS19JTlRFUlZBTCA9IDE7IC8vIHJ1biBl\ndmVyeSBzZWNvbmQKCiAgICBwdWJsaWMgQXVkaXRvclBlcmlvZGljQ2hlY2tU\nZXN0KCkgewogICAgICAgIHN1cGVyKDMpOwogICAgICAgIGJhc2VDb25mLnNl\ndFBhZ2VMaW1pdCgxKTsgLy8gdG8gbWFrZSBpdCBlYXN5IHRvIHB1c2ggbGVk\nZ2VyIG91dCBvZiBjYWNoZQogICAgfQoKICAgIEBCZWZvcmUKICAgIEBPdmVy\ncmlkZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBzdXBlci5zZXRVcCgpOwoKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IG51bUJvb2tpZXM7IGkrKykgewogICAgICAgICAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlv\nbihic0NvbmZzLmdldChpKSk7CiAgICAgICAgICAgIGNvbmYuc2V0QXVkaXRv\nclBlcmlvZGljQ2hlY2tJbnRlcnZhbChDSEVDS19JTlRFUlZBTCk7CgogICAg\nICAgICAgICBTdHJpbmcgYWRkciA9IFN0cmluZ1V0aWxzLmFkZHJUb1N0cmlu\nZyhicy5nZXQoaSkuZ2V0TG9jYWxBZGRyZXNzKCkpOwoKICAgICAgICAgICAg\nWm9vS2VlcGVyV2F0Y2hlckJhc2UgdyA9IG5ldyBab29LZWVwZXJXYXRjaGVy\nQmFzZSgxMDAwMCk7CiAgICAgICAgICAgIFpvb0tlZXBlciB6ayA9IFprVXRp\nbHMuY3JlYXRlQ29ubmVjdGVkWm9va2VlcGVyQ2xpZW50KAogICAgICAgICAg\nICAgICAgICAgIHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCks\nIHcpOwogICAgICAgICAgICB6a0NsaWVudHMuYWRkKHprKTsKCiAgICAgICAg\nICAgIEF1ZGl0b3JFbGVjdG9yIGF1ZGl0b3JFbGVjdG9yID0gbmV3IEF1ZGl0\nb3JFbGVjdG9yKGFkZHIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmYsIHprKTsK\nICAgICAgICAgICAgYXVkaXRvckVsZWN0b3JzLnB1dChhZGRyLCBhdWRpdG9y\nRWxlY3Rvcik7CiAgICAgICAgICAgIGF1ZGl0b3JFbGVjdG9yLnN0YXJ0KCk7\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiU3RhcnRpbmcgQXVkaXRvciBFbGVj\ndG9yIik7CiAgICAgICAgfQogICAgfQoKICAgIEBBZnRlcgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGZvciAoQXVkaXRvckVsZWN0b3IgZSA6IGF1ZGl0b3JF\nbGVjdG9ycy52YWx1ZXMoKSkgewogICAgICAgICAgICBlLnNodXRkb3duKCk7\nCiAgICAgICAgfQogICAgICAgIGZvciAoWm9vS2VlcGVyIHprIDogemtDbGll\nbnRzKSB7CiAgICAgICAgICAgIHprLmNsb3NlKCk7CiAgICAgICAgfQogICAg\nICAgIHprQ2xpZW50cy5jbGVhcigpOwogICAgICAgIHN1cGVyLnRlYXJEb3du\nKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiB0ZXN0IHRoYXQgdGhlIHBlcmlv\nZGljIGNoZWNraW5nIHdpbGwgZGV0ZWN0IGNvcnJ1cHRpb25zIGluCiAgICAg\nKiB0aGUgYm9va2llIGVudHJ5IGxvZwogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0PTMwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEVudHJ5TG9nQ29ycnVw\ndGlvbigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExlZGdlck1hbmFn\nZXJGYWN0b3J5IG1GYWN0b3J5ID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3\nTGVkZ2VyTWFuYWdlckZhY3RvcnkoYnNDb25mcy5nZXQoMCksIHprYyk7CiAg\nICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgdW5kZXJSZXBs\naWNhdGlvbk1hbmFnZXIgPSBtRmFjdG9yeS5uZXdMZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlcigpOwogICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5h\nZ2VyLmRpc2FibGVMZWRnZXJSZXBsaWNhdGlvbigpOwoKICAgICAgICBMZWRn\nZXJIYW5kbGUgbGggPSBia2MuY3JlYXRlTGVkZ2VyKDMsIDMsIERpZ2VzdFR5\ncGUuQ1JDMzIsICJwYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAgIGxvbmcg\nbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgIGZvciAoaW50IGkgPSAw\nOyBpIDwgMTAwOyBpKyspIHsKICAgICAgICAgICAgbGguYWRkRW50cnkoInRl\nc3RkYXRhIi5nZXRCeXRlcygpKTsKICAgICAgICB9CiAgICAgICAgbGguY2xv\nc2UoKTsKCiAgICAgICAgQm9va2llQWNjZXNzb3IuZm9yY2VGbHVzaChicy5n\nZXQoMCkuZ2V0Qm9va2llKCkpOwoKCiAgICAgICAgRmlsZSBsZWRnZXJEaXIg\nPSBic0NvbmZzLmdldCgwKS5nZXRMZWRnZXJEaXJzKClbMF07CiAgICAgICAg\nbGVkZ2VyRGlyID0gQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2Vy\nRGlyKTsKICAgICAgICAvLyBjb3JydXB0IG9mIGVudHJ5TG9ncwogICAgICAg\nIEZpbGVbXSBlbnRyeUxvZ3MgPSBsZWRnZXJEaXIubGlzdEZpbGVzKG5ldyBG\naWxlbmFtZUZpbHRlcigpIHsKICAgICAgICAgICAgICAgIHB1YmxpYyBib29s\nZWFuIGFjY2VwdChGaWxlIGRpciwgU3RyaW5nIG5hbWUpIHsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gbmFtZS5lbmRzV2l0aCgiLmxvZyIpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICBCeXRlQnVm\nZmVyIGp1bmsgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDEwMjQqMTAyNCk7CiAg\nICAgICAgZm9yIChGaWxlIGYgOiBlbnRyeUxvZ3MpIHsKICAgICAgICAgICAg\nRmlsZU91dHB1dFN0cmVhbSBvdXQgPSBuZXcgRmlsZU91dHB1dFN0cmVhbShm\nKTsKICAgICAgICAgICAgb3V0LmdldENoYW5uZWwoKS53cml0ZShqdW5rKTsK\nICAgICAgICAgICAgb3V0LmNsb3NlKCk7CiAgICAgICAgfQogICAgICAgIHJl\nc3RhcnRCb29raWVzKCk7IC8vIHJlc3RhcnQgdG8gY2xlYXIgcmVhZCBidWZm\nZXJzCgogICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLmVuYWJsZUxl\nZGdlclJlcGxpY2F0aW9uKCk7CiAgICAgICAgbG9uZyB1bmRlclJlcGxpY2F0\nZWRMZWRnZXIgPSAtMTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDEw\nOyBpKyspIHsKICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGVkTGVkZ2VyID0g\ndW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIucG9sbExlZGdlclRvUmVyZXBsaWNh\ndGUoKTsKICAgICAgICAgICAgaWYgKHVuZGVyUmVwbGljYXRlZExlZGdlciAh\nPSAtMSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgVGhyZWFkLnNsZWVwKENIRUNLX0lOVEVSVkFMICogMTAw\nMCk7CiAgICAgICAgfQogICAgICAgIGFzc2VydEVxdWFscygiTGVkZ2VyIHNo\nb3VsZCBiZSB1bmRlciByZXBsaWNhdGVkIiwgbGVkZ2VySWQsIHVuZGVyUmVw\nbGljYXRlZExlZGdlcik7CiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFn\nZXIuY2xvc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIHRlc3QgdGhhdCB0\naGUgcGVyaW9kIGNoZWNrZXIgd2lsbCBkZXRlY3QgY29ycnVwdGlvbnMgaW4K\nICAgICAqIHRoZSBib29raWUgaW5kZXggZmlsZXMKICAgICAqLwogICAgQFRl\nc3QodGltZW91dD0zMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RJbmRleENv\ncnJ1cHRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJN\nYW5hZ2VyRmFjdG9yeSBtRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0b3J5\nLm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGJzQ29uZnMuZ2V0KDApLCB6a2Mp\nOwogICAgICAgIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIHVuZGVy\nUmVwbGljYXRpb25NYW5hZ2VyID0gbUZhY3RvcnkubmV3TGVkZ2VyVW5kZXJy\nZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAgTGVkZ2VySGFuZGxlIGxo\nID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBEaWdlc3RUeXBlLkNSQzMyLCAi\ncGFzc3dkIi5nZXRCeXRlcygpKTsKICAgICAgICBsb25nIGxlZGdlclRvQ29y\ncnVwdCA9IGxoLmdldElkKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCAxMDA7IGkrKykgewogICAgICAgICAgICBsaC5hZGRFbnRyeSgidGVzdGRh\ndGEiLmdldEJ5dGVzKCkpOwogICAgICAgIH0KICAgICAgICBsaC5jbG9zZSgp\nOwoKICAgICAgICAvLyBwdXNoIGxlZGdlclRvQ29ycnVwdCBvdXQgb2YgcGFn\nZSBjYWNoZSAoYm9va2llIGlzIGNvbmZpZ3VyZWQgdG8gb25seSB1c2UgMSBw\nYWdlKQogICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBEaWdl\nc3RUeXBlLkNSQzMyLCAicGFzc3dkIi5nZXRCeXRlcygpKTsKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7CiAgICAgICAgICAgIGxo\nLmFkZEVudHJ5KCJ0ZXN0ZGF0YSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQog\nICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgIEJvb2tpZUFjY2Vzc29yLmZv\ncmNlRmx1c2goYnMuZ2V0KDApLmdldEJvb2tpZSgpKTsKCiAgICAgICAgRmls\nZSBsZWRnZXJEaXIgPSBic0NvbmZzLmdldCgwKS5nZXRMZWRnZXJEaXJzKClb\nMF07CiAgICAgICAgbGVkZ2VyRGlyID0gQm9va2llLmdldEN1cnJlbnREaXJl\nY3RvcnkobGVkZ2VyRGlyKTsKCiAgICAgICAgLy8gY29ycnVwdCBvZiBlbnRy\neUxvZ3MKICAgICAgICBGaWxlIGluZGV4ID0gbmV3IEZpbGUobGVkZ2VyRGly\nLCBMZWRnZXJDYWNoZUltcGwuZ2V0TGVkZ2VyTmFtZShsZWRnZXJUb0NvcnJ1\ncHQpKTsKICAgICAgICBMT0cuaW5mbygiZmlsZSB0byBjb3JydXB0e30iICwg\naW5kZXgpOwogICAgICAgIEJ5dGVCdWZmZXIganVuayA9IEJ5dGVCdWZmZXIu\nYWxsb2NhdGUoMTAyNCoxMDI0KTsKICAgICAgICBGaWxlT3V0cHV0U3RyZWFt\nIG91dCA9IG5ldyBGaWxlT3V0cHV0U3RyZWFtKGluZGV4KTsKICAgICAgICBv\ndXQuZ2V0Q2hhbm5lbCgpLndyaXRlKGp1bmspOwogICAgICAgIG91dC5jbG9z\nZSgpOwoKICAgICAgICBsb25nIHVuZGVyUmVwbGljYXRlZExlZGdlciA9IC0x\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAg\nICAgICAgICB1bmRlclJlcGxpY2F0ZWRMZWRnZXIgPSB1bmRlclJlcGxpY2F0\naW9uTWFuYWdlci5wb2xsTGVkZ2VyVG9SZXJlcGxpY2F0ZSgpOwogICAgICAg\nICAgICBpZiAodW5kZXJSZXBsaWNhdGVkTGVkZ2VyICE9IC0xKSB7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBU\naHJlYWQuc2xlZXAoQ0hFQ0tfSU5URVJWQUwgKiAxMDAwKTsKICAgICAgICB9\nCiAgICAgICAgYXNzZXJ0RXF1YWxzKCJMZWRnZXIgc2hvdWxkIGJlIHVuZGVy\nIHJlcGxpY2F0ZWQiLCBsZWRnZXJUb0NvcnJ1cHQsIHVuZGVyUmVwbGljYXRl\nZExlZGdlcik7CiAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIuY2xv\nc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCB0aGUgcGVy\naW9kIGNoZWNrZXIgd2lsbCBub3QgcnVuIHdoZW4gYXV0byByZXBsaWNhdGlv\nbiBoYXMgYmVlbiBkaXNhYmxlZAogICAgICovCiAgICBAVGVzdCh0aW1lb3V0\nPTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdFBlcmlvZGljQ2hlY2tXaGVu\nRGlzYWJsZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJN\nYW5hZ2VyRmFjdG9yeSBtRmFjdG9yeSA9IExlZGdlck1hbmFnZXJGYWN0b3J5\nLm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGJzQ29uZnMuZ2V0KDApLCB6a2Mp\nOwogICAgICAgIGZpbmFsIExlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2Vy\nIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyID0gbUZhY3RvcnkubmV3TGVkZ2Vy\nVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAgICAgICBmaW5hbCBpbnQg\nbnVtTGVkZ2VycyA9IDEwMDsKCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBudW1MZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgTGVkZ2VySGFuZGxl\nIGxoID0gYmtjLmNyZWF0ZUxlZGdlcigzLCAzLCBEaWdlc3RUeXBlLkNSQzMy\nLCAicGFzc3dkIi5nZXRCeXRlcygpKTsKCiAgICAgICAgICAgIGZvciAoaW50\nIGogPSAwOyBqIDwgMTAwOyBqKyspIHsKICAgICAgICAgICAgICAgIGxoLmFk\nZEVudHJ5KCJ0ZXN0ZGF0YSIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICB9CiAgICAgICAgdW5k\nZXJSZXBsaWNhdGlvbk1hbmFnZXIuZGlzYWJsZUxlZGdlclJlcGxpY2F0aW9u\nKCk7CgogICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgbnVtUmVhZHMgPSBu\nZXcgQXRvbWljSW50ZWdlcigwKTsKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYgPSBraWxsQm9va2llKDApOwoKICAgICAgICBCb29raWUgZGVh\nZEJvb2tpZSA9IG5ldyBCb29raWUoY29uZikgewogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIEJ5dGVCdWZmZXIgcmVhZEVudHJ5\nKGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCkKICAgICAgICAgICAgICAg\nICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIE5vTGVkZ2VyRXhjZXB0aW9uIHsK\nICAgICAgICAgICAgICAgIC8vIHdlIHdhbnQgdG8gZGlzYWJsZSBkdXJpbmcg\nY2hlY2tpbmcKICAgICAgICAgICAgICAgIG51bVJlYWRzLmluY3JlbWVudEFu\nZEdldCgpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9u\nKCJGYWtlIEkvTyBleGNlcHRpb24iKTsKICAgICAgICAgICAgfQogICAgICAg\nIH07CiAgICAgICAgYnNDb25mcy5hZGQoY29uZik7CiAgICAgICAgYnMuYWRk\nKHN0YXJ0Qm9va2llKGNvbmYsIGRlYWRCb29raWUpKTsKCiAgICAgICAgVGhy\nZWFkLnNsZWVwKENIRUNLX0lOVEVSVkFMICogMjAwMCk7CiAgICAgICAgYXNz\nZXJ0RXF1YWxzKCJOb3RoaW5nIHNob3VsZCBoYXZlIHRyaWVkIHRvIHJlYWQi\nLCAwLCBudW1SZWFkcy5nZXQoKSk7CiAgICAgICAgdW5kZXJSZXBsaWNhdGlv\nbk1hbmFnZXIuZW5hYmxlTGVkZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICBU\naHJlYWQuc2xlZXAoQ0hFQ0tfSU5URVJWQUwgKiAyMDAwKTsgLy8gZ2l2ZSBp\ndCB0aW1lIHRvIHJ1bgoKICAgICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdl\nci5kaXNhYmxlTGVkZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICAvLyBnaXZl\nIGl0IHRpbWUgdG8gc3RvcCwgZnJvbSB0aGlzIHBvaW50IG5vdGhpbmcgbmV3\nIHNob3VsZCBiZSBtYXJrZWQKICAgICAgICBUaHJlYWQuc2xlZXAoQ0hFQ0tf\nSU5URVJWQUwgKiAyMDAwKTsKCiAgICAgICAgaW50IG51bVVuZGVycmVwbGlj\nYXRlZCA9IDA7CiAgICAgICAgbG9uZyB1bmRlclJlcGxpY2F0ZWRMZWRnZXIg\nPSAtMTsKICAgICAgICBkbyB7CiAgICAgICAgICAgIHVuZGVyUmVwbGljYXRl\nZExlZGdlciA9IHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyLnBvbGxMZWRnZXJU\nb1JlcmVwbGljYXRlKCk7CiAgICAgICAgICAgIGlmICh1bmRlclJlcGxpY2F0\nZWRMZWRnZXIgPT0gLTEpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIG51bVVuZGVycmVwbGljYXRlZCsrOwoK\nICAgICAgICAgICAgdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIubWFya0xlZGdl\nclJlcGxpY2F0ZWQodW5kZXJSZXBsaWNhdGVkTGVkZ2VyKTsKICAgICAgICB9\nIHdoaWxlICh1bmRlclJlcGxpY2F0ZWRMZWRnZXIgIT0gLTEpOwoKICAgICAg\nICBUaHJlYWQuc2xlZXAoQ0hFQ0tfSU5URVJWQUwgKiAyMDAwKTsgLy8gZ2l2\nZSBhIGNoYW5jZSB0byBydW4gYWdhaW4gKGl0IHNob3VsZG4ndCwgaXQncyBk\naXNhYmxlZCkKCiAgICAgICAgLy8gZW5zdXJlIHRoYXQgbm90aGluZyBpcyBt\nYXJrZWQgYXMgdW5kZXJyZXBsaWNhdGVkCiAgICAgICAgdW5kZXJSZXBsaWNh\ndGVkTGVkZ2VyID0gdW5kZXJSZXBsaWNhdGlvbk1hbmFnZXIucG9sbExlZGdl\nclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIlRoZXJl\nIHNob3VsZCBiZSBubyB1bmRlcnJlcGxpY2F0ZWQgbGVkZ2VycyIsIC0xLCB1\nbmRlclJlcGxpY2F0ZWRMZWRnZXIpOwoKICAgICAgICBMT0cuaW5mbygie30g\nb2Yge30gbGVkZ2VycyB1bmRlcnJlcGxpY2F0ZWQiLCBudW1VbmRlcnJlcGxp\nY2F0ZWQsIG51bVVuZGVycmVwbGljYXRlZCk7CiAgICAgICAgYXNzZXJ0VHJ1\nZSgiQWxsIHNob3VsZCBiZSB1bmRlcnJlcGxpY2F0ZWQiLAogICAgICAgICAg\nICAgICAgbnVtVW5kZXJyZXBsaWNhdGVkIDw9IG51bUxlZGdlcnMgJiYgbnVt\nVW5kZXJyZXBsaWNhdGVkID4gMCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBU\nZXN0IHRoYXQgdGhlIHBlcmlvZCBjaGVjayB3aWxsIHN1Y2NlZWQgaWYgYSBs\nZWRnZXIgaXMgZGVsZXRlZCBtaWR3YXkKICAgICAqLwogICAgQFRlc3QodGlt\nZW91dD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RQZXJpb2RpY0NoZWNr\nV2hlbkxlZGdlckRlbGV0ZWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBmb3IgKEF1ZGl0b3JFbGVjdG9yIGUgOiBhdWRpdG9yRWxlY3RvcnMudmFs\ndWVzKCkpIHsKICAgICAgICAgICAgZS5zaHV0ZG93bigpOwogICAgICAgIH0K\nCiAgICAgICAgZmluYWwgaW50IG51bUxlZGdlcnMgPSAxMDA7CiAgICAgICAg\nTGlzdDxMb25nPiBpZHMgPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtTGVkZ2VyczsgaSsrKSB7CiAg\nICAgICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVMZWRnZXIo\nMywgMywgRGlnZXN0VHlwZS5DUkMzMiwgInBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7\nCiAgICAgICAgICAgIGlkcy5hZGQobGguZ2V0SWQoKSk7CiAgICAgICAgICAg\nIGZvciAoaW50IGogPSAwOyBqIDwgMTA7IGorKykgewogICAgICAgICAgICAg\nICAgbGguYWRkRW50cnkoInRlc3RkYXRhIi5nZXRCeXRlcygpKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0KICAg\nICAgICBmaW5hbCBBdWRpdG9yIGF1ZGl0b3IgPSBuZXcgQXVkaXRvcigKICAg\nICAgICAgICAgICAgIFN0cmluZ1V0aWxzLmFkZHJUb1N0cmluZyhCb29raWUu\nZ2V0Qm9va2llQWRkcmVzcyhic0NvbmZzLmdldCgwKSkpLAogICAgICAgICAg\nICAgICAgYnNDb25mcy5nZXQoMCksIHprYyk7CiAgICAgICAgZmluYWwgQXRv\nbWljQm9vbGVhbiBleGNlcHRpb25DYXVnaHQgPSBuZXcgQXRvbWljQm9vbGVh\nbihmYWxzZSk7CiAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggbGF0Y2gg\nPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgVGhyZWFkIHQgPSBu\nZXcgVGhyZWFkKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVu\nKCkgewogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUxlZGdlcnM7IGkrKykg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaXRvci5jaGVja0Fs\nbExlZGdlcnMoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ2F1Z2h0IGV4Y2VwdGlvbiB3\naGlsZSBjaGVja2luZyBhbGwgbGVkZ2VycyIsIGUpOwogICAgICAgICAgICAg\nICAgICAgICAgICBleGNlcHRpb25DYXVnaHQuc2V0KHRydWUpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfTsKICAgICAgICB0LnN0YXJ0KCk7CiAgICAgICAgbGF0Y2guYXdhaXQoKTsK\nICAgICAgICBmb3IgKExvbmcgaWQgOiBpZHMpIHsKICAgICAgICAgICAgYmtj\nLmRlbGV0ZUxlZGdlcihpZCk7CiAgICAgICAgfQogICAgICAgIHQuam9pbigp\nOwogICAgICAgIGFzc2VydEZhbHNlKCJTaG91bGRuJ3QgaGF2ZSB0aHJvd24g\nZXhjZXB0aW9uIiwgZXhjZXB0aW9uQ2F1Z2h0LmdldCgpKTsKICAgIH0KfQo=\n","encoding":"base64"}

