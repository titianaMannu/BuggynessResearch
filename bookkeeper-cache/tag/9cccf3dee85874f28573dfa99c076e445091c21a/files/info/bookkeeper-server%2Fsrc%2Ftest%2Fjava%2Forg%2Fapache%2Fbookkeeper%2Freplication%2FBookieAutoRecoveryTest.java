{"sha":"4c34c53af3d64f05e7dba5aee3b80243c5909f34","node_id":"MDQ6QmxvYjE1NzU5NTY6NGMzNGM1M2FmM2Q2NGYwNWU3ZGJhNWFlZTNiODAyNDNjNTkwOWYzNA==","size":19659,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/4c34c53af3d64f05e7dba5aee3b80243c5909f34","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNo\nZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVp\ncmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5n\nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBp\ncyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VU\nIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0\naGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3Ig\ndGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9u\ncyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAq\nLwpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbjsK\nCmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uZXQu\nSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0\nOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuU29y\ndGVkTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3du\nTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsK\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlQWRhcHRlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdlck1hbmFnZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdl\nclVuZGVycmVwbGljYXRpb25NYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLm1ldGEuWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVT\nZXJ2ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRp\nb24uUmVwbGljYXRpb25FeGNlcHRpb24uQ29tcGF0aWJpbGl0eUV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5S\nZXBsaWNhdGlvbkV4Y2VwdGlvbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LkJvb2tLZWVwZXJDbHVz\ndGVyVGVzdENhc2U7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVw\nZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRj\naGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlci5FdmVudC5F\ndmVudFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5kYXRhLlN0\nYXQ7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgog\nKiBJbnRlZ3JhdGlvbiB0ZXN0cyB2ZXJpZmllcyB0aGUgY29tcGxldGUgZnVu\nY3Rpb25hbGl0eSBvZiB0aGUKICogQXVkaXRvci1yZXJlcGxpY2F0aW9uIHBy\nb2Nlc3M6IEF1ZGl0b3Igd2lsbCBwdWJsaXNoIHRoZSBib29raWUgZmFpbHVy\nZXMsCiAqIGNvbnNlcXVlbnRseSBSZXBsaWNhdGlvbldvcmtlciB3aWxsIGdl\ndCB0aGUgbm90aWZpY2F0aW9ucyBhbmQgYWN0IG9uIGl0LgogKi8KcHVibGlj\nIGNsYXNzIEJvb2tpZUF1dG9SZWNvdmVyeVRlc3QgZXh0ZW5kcyBCb29rS2Vl\ncGVyQ2x1c3RlclRlc3RDYXNlIHsKICAgIHByaXZhdGUgc3RhdGljIGZpbmFs\nIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5CiAgICAgICAgICAgIC5nZXRM\nb2dnZXIoQm9va2llQXV0b1JlY292ZXJ5VGVzdC5jbGFzcyk7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBieXRlW10gUEFTU1dEID0gImFkbWluIi5nZXRC\neXRlcygpOwogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgYnl0ZVtdIGRhdGEg\nPSAiVEVTVERBVEEiLmdldEJ5dGVzKCk7CiAgICBwcml2YXRlIHN0YXRpYyBm\naW5hbCBTdHJpbmcgb3BlbkxlZGdlclJlcmVwbGljYXRpb25HcmFjZVBlcmlv\nZCA9ICIzMDAwIjsgLy8gbWlsbGlzZWNvbmRzCgogICAgcHJpdmF0ZSBEaWdl\nc3RUeXBlIGRpZ2VzdFR5cGU7CiAgICBwcml2YXRlIExlZGdlck1hbmFnZXJG\nYWN0b3J5IG1GYWN0b3J5OwogICAgcHJpdmF0ZSBMZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlciB1bmRlclJlcGxpY2F0aW9uTWFuYWdlcjsKICAgIHBy\naXZhdGUgTGVkZ2VyTWFuYWdlciBsZWRnZXJNYW5hZ2VyOwoKICAgIHByaXZh\ndGUgZmluYWwgU3RyaW5nIFVOREVSUkVQTElDQVRFRF9QQVRIID0gYmFzZUNs\naWVudENvbmYKICAgICAgICAgICAgLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkg\nKyAiL3VuZGVycmVwbGljYXRpb24vbGVkZ2VycyI7CgogICAgcHVibGljIEJv\nb2tpZUF1dG9SZWNvdmVyeVRlc3QoKSB0aHJvd3MgSU9FeGNlcHRpb24sIEtl\nZXBlckV4Y2VwdGlvbiwKICAgICAgICAgICAgSW50ZXJydXB0ZWRFeGNlcHRp\nb24sIFVuYXZhaWxhYmxlRXhjZXB0aW9uLCBDb21wYXRpYmlsaXR5RXhjZXB0\naW9uIHsKICAgICAgICBzdXBlcigzKTsKCiAgICAgICAgYmFzZUNvbmYuc2V0\nTGVkZ2VyTWFuYWdlckZhY3RvcnlDbGFzc05hbWUoCiAgICAgICAgICAgICAg\nICAib3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGEuSGllcmFyY2hpY2FsTGVk\nZ2VyTWFuYWdlckZhY3RvcnkiKTsKICAgICAgICBiYXNlQ29uZi5zZXRPcGVu\nTGVkZ2VyUmVyZXBsaWNhdGlvbkdyYWNlUGVyaW9kKG9wZW5MZWRnZXJSZXJl\ncGxpY2F0aW9uR3JhY2VQZXJpb2QpOwogICAgICAgIGJhc2VDbGllbnRDb25m\nLnNldExlZGdlck1hbmFnZXJGYWN0b3J5Q2xhc3NOYW1lKAogICAgICAgICAg\nICAgICAgIm9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkhpZXJhcmNoaWNh\nbExlZGdlck1hbmFnZXJGYWN0b3J5Iik7CiAgICAgICAgdGhpcy5kaWdlc3RU\neXBlID0gRGlnZXN0VHlwZS5NQUM7CiAgICAgICAgc2V0QXV0b1JlY292ZXJ5\nRW5hYmxlZCh0cnVlKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIHNldFVwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3Vw\nZXIuc2V0VXAoKTsKICAgICAgICBiYXNlQ29uZi5zZXRaa1NlcnZlcnMoemtV\ndGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAgLy8g\naW5pdGlhbGl6ZSB1clJlcGxpY2F0aW9uTWFuYWdlcgogICAgICAgIG1GYWN0\nb3J5ID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2VyTWFuYWdlckZh\nY3RvcnkoYmFzZUNsaWVudENvbmYsCiAgICAgICAgICAgICAgICB6a2MpOwog\nICAgICAgIHVuZGVyUmVwbGljYXRpb25NYW5hZ2VyID0gbUZhY3RvcnkubmV3\nTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAgICAgICBMZWRn\nZXJNYW5hZ2VyRmFjdG9yeSBuZXdMZWRnZXJNYW5hZ2VyRmFjdG9yeSA9IExl\nZGdlck1hbmFnZXJGYWN0b3J5CiAgICAgICAgICAgICAgICAubmV3TGVkZ2Vy\nTWFuYWdlckZhY3RvcnkoYmFzZUNsaWVudENvbmYsIHprYyk7CiAgICAgICAg\nbGVkZ2VyTWFuYWdlciA9IG5ld0xlZGdlck1hbmFnZXJGYWN0b3J5Lm5ld0xl\nZGdlck1hbmFnZXIoKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nc3VwZXIudGVhckRvd24oKTsKICAgICAgICBpZiAobnVsbCAhPSBtRmFjdG9y\neSkgewogICAgICAgICAgICBtRmFjdG9yeS51bmluaXRpYWxpemUoKTsKICAg\nICAgICAgICAgbUZhY3RvcnkgPSBudWxsOwogICAgICAgIH0KICAgICAgICBp\nZiAobnVsbCAhPSB1bmRlclJlcGxpY2F0aW9uTWFuYWdlcikgewogICAgICAg\nICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlci5jbG9zZSgpOwogICAgICAg\nICAgICB1bmRlclJlcGxpY2F0aW9uTWFuYWdlciA9IG51bGw7CiAgICAgICAg\nfQogICAgICAgIGlmIChudWxsICE9IGxlZGdlck1hbmFnZXIpIHsKICAgICAg\nICAgICAgbGVkZ2VyTWFuYWdlci5jbG9zZSgpOwogICAgICAgICAgICBsZWRn\nZXJNYW5hZ2VyID0gbnVsbDsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUZXN0IHZlcmlmaWVzIHB1Ymxpc2ggdXJMZWRnZXIgYnkgQXVkaXRv\nciBhbmQgcmVwbGljYXRpb24gd29ya2VyIGlzCiAgICAgKiBwaWNraW5nIHVw\nIHRoZSBlbnRyaWVzIGFuZCBmaW5pc2hpbmcgdGhlIHJlcmVwbGljYXRpb24g\nb2Ygb3BlbiBsZWRnZXIKICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDkw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE9wZW5MZWRnZXJzKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxpc3RP\nZkxlZGdlckhhbmRsZSA9IGNyZWF0ZUxlZGdlcnNBbmRBZGRFbnRyaWVzKDEs\nIDUpOwogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGxpc3RPZkxlZGdlckhh\nbmRsZS5nZXQoMCk7CiAgICAgICAgaW50IGxlZGdlclJlcGxpY2FJbmRleCA9\nIDA7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbEFk\nZHIgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0\nTGVkZ2VyTWV0YWRhdGEobGgpLmdldEVuc2VtYmxlcygpLmdldCgwTCkuZ2V0\nKDApOwoKICAgICAgICBmaW5hbCBTdHJpbmcgdXJMZWRnZXJaTm9kZSA9IGdl\ndFVyTGVkZ2VyWk5vZGUobGgpOwogICAgICAgIGxlZGdlclJlcGxpY2FJbmRl\neCA9IGdldFJlcGxpY2FJbmRleEluTGVkZ2VyKGxoLCByZXBsaWNhVG9LaWxs\nQWRkcik7CgogICAgICAgIENvdW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENv\ndW50RG93bkxhdGNoKDEpOwogICAgICAgIGFzc2VydE51bGwoIlVyTGVkZ2Vy\nIGFscmVhZHkgZXhpc3RzISIsCiAgICAgICAgICAgICAgICB3YXRjaFVyTGVk\nZ2VyTm9kZSh1ckxlZGdlclpOb2RlLCBsYXRjaCkpOwoKICAgICAgICBMT0cu\naW5mbygiS2lsbGluZyBCb29raWUgOiIgKyByZXBsaWNhVG9LaWxsQWRkcik7\nCiAgICAgICAga2lsbEJvb2tpZShyZXBsaWNhVG9LaWxsQWRkcik7CgogICAg\nICAgIC8vIHdhaXRpbmcgdG8gcHVibGlzaCB1ckxlZGdlciB6bm9kZSBieSBB\ndWRpdG9yCiAgICAgICAgbGF0Y2guYXdhaXQoKTsKICAgICAgICBsYXRjaCA9\nIG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBMT0cuaW5mbygiV2F0\nY2hpbmcgb24gdXJMZWRnZXJQYXRoOiIgKyB1ckxlZGdlclpOb2RlCiAgICAg\nICAgICAgICAgICArICIgdG8ga25vdyB0aGUgc3RhdHVzIG9mIHJlcmVwbGlj\nYXRpb24gcHJvY2VzcyIpOwogICAgICAgIGFzc2VydE5vdE51bGwoIlVyTGVk\nZ2VyIGRvZXNuJ3QgZXhpc3RzISIsCiAgICAgICAgICAgICAgICB3YXRjaFVy\nTGVkZ2VyTm9kZSh1ckxlZGdlclpOb2RlLCBsYXRjaCkpOwoKICAgICAgICAv\nLyBzdGFydGluZyB0aGUgcmVwbGljYXRpb24gc2VydmljZSwgc28gdGhhdCBo\nZSB3aWxsIGJlIGFibGUgdG8gYWN0IGFzCiAgICAgICAgLy8gdGFyZ2V0IGJv\nb2tpZQogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgaW50IG5l\nd0Jvb2tpZUluZGV4ID0gYnMuc2l6ZSgpIC0gMTsKICAgICAgICBCb29raWVT\nZXJ2ZXIgbmV3Qm9va2llU2VydmVyID0gYnMuZ2V0KG5ld0Jvb2tpZUluZGV4\nKTsKCiAgICAgICAgTE9HLmRlYnVnKCJXYWl0aW5nIHRvIGZpbmlzaCB0aGUg\ncmVwbGljYXRpb24gb2YgZmFpbGVkIGJvb2tpZSA6ICIKICAgICAgICAgICAg\nICAgICsgcmVwbGljYVRvS2lsbEFkZHIpOwogICAgICAgIGxhdGNoLmF3YWl0\nKCk7CgogICAgICAgIC8vIGdyYWNlIHBlcmlvZCB0byB1cGRhdGUgdGhlIHVy\nbGVkZ2VyIG1ldGFkYXRhIGluIHpvb2tlZXBlcgogICAgICAgIExPRy5pbmZv\nKCJXYWl0aW5nIHRvIHVwZGF0ZSB0aGUgdXJsZWRnZXIgbWV0YWRhdGEgaW4g\nem9va2VlcGVyIik7CgogICAgICAgIHZlcmlmeUxlZGdlckVuc2VtYmxlTWV0\nYWRhdGFBZnRlclJlcGxpY2F0aW9uKG5ld0Jvb2tpZVNlcnZlciwKICAgICAg\nICAgICAgICAgIGxpc3RPZkxlZGdlckhhbmRsZS5nZXQoMCksIGxlZGdlclJl\ncGxpY2FJbmRleCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHZlcmlm\naWVzIHB1Ymxpc2ggdXJMZWRnZXIgYnkgQXVkaXRvciBhbmQgcmVwbGljYXRp\nb24gd29ya2VyIGlzCiAgICAgKiBwaWNraW5nIHVwIHRoZSBlbnRyaWVzIGFu\nZCBmaW5pc2hpbmcgdGhlIHJlcmVwbGljYXRpb24gb2YgY2xvc2VkIGxlZGdl\ncnMKICAgICAqLwogICAgQFRlc3QodGltZW91dCA9IDkwMDAwKQogICAgcHVi\nbGljIHZvaWQgdGVzdENsb3NlZExlZGdlcnMoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBMaXN0PEludGVnZXI+IGxpc3RPZlJlcGxpY2FJbmRleCA9\nIG5ldyBBcnJheUxpc3Q8SW50ZWdlcj4oKTsKICAgICAgICBMaXN0PExlZGdl\nckhhbmRsZT4gbGlzdE9mTGVkZ2VySGFuZGxlID0gY3JlYXRlTGVkZ2Vyc0Fu\nZEFkZEVudHJpZXMoMSwgNSk7CiAgICAgICAgY2xvc2VMZWRnZXJzKGxpc3RP\nZkxlZGdlckhhbmRsZSk7CiAgICAgICAgTGVkZ2VySGFuZGxlIGxoYW5kbGUg\nPSBsaXN0T2ZMZWRnZXJIYW5kbGUuZ2V0KDApOwogICAgICAgIGludCBsZWRn\nZXJSZXBsaWNhSW5kZXggPSAwOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNz\nIHJlcGxpY2FUb0tpbGxBZGRyID0gTGVkZ2VySGFuZGxlQWRhcHRlcgogICAg\nICAgICAgICAgICAgLmdldExlZGdlck1ldGFkYXRhKGxoYW5kbGUpLmdldEVu\nc2VtYmxlcygpLmdldCgwTCkuZ2V0KDApOwoKICAgICAgICBDb3VudERvd25M\nYXRjaCBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaChsaXN0T2ZMZWRnZXJI\nYW5kbGUuc2l6ZSgpKTsKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6\nIGxpc3RPZkxlZGdlckhhbmRsZSkgewogICAgICAgICAgICBsZWRnZXJSZXBs\naWNhSW5kZXggPSBnZXRSZXBsaWNhSW5kZXhJbkxlZGdlcihsaCwgcmVwbGlj\nYVRvS2lsbEFkZHIpOwogICAgICAgICAgICBsaXN0T2ZSZXBsaWNhSW5kZXgu\nYWRkKGxlZGdlclJlcGxpY2FJbmRleCk7CiAgICAgICAgICAgIGFzc2VydE51\nbGwoIlVyTGVkZ2VyIGFscmVhZHkgZXhpc3RzISIsCiAgICAgICAgICAgICAg\nICAgICAgd2F0Y2hVckxlZGdlck5vZGUoZ2V0VXJMZWRnZXJaTm9kZShsaCks\nIGxhdGNoKSk7CiAgICAgICAgfQoKICAgICAgICBMT0cuaW5mbygiS2lsbGlu\nZyBCb29raWUgOiIgKyByZXBsaWNhVG9LaWxsQWRkcik7CiAgICAgICAga2ls\nbEJvb2tpZShyZXBsaWNhVG9LaWxsQWRkcik7CgogICAgICAgIC8vIHdhaXRp\nbmcgdG8gcHVibGlzaCB1ckxlZGdlciB6bm9kZSBieSBBdWRpdG9yCiAgICAg\nICAgbGF0Y2guYXdhaXQoKTsKCiAgICAgICAgLy8gQWdhaW4gd2F0Y2hpbmcg\ndGhlIHVyTGVkZ2VyIHpub2RlIHRvIGtub3cgdGhlIHJlcGxpY2F0aW9uIHN0\nYXR1cwogICAgICAgIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKGxpc3RP\nZkxlZGdlckhhbmRsZS5zaXplKCkpOwogICAgICAgIGZvciAoTGVkZ2VySGFu\nZGxlIGxoIDogbGlzdE9mTGVkZ2VySGFuZGxlKSB7CiAgICAgICAgICAgIFN0\ncmluZyB1ckxlZGdlclpOb2RlID0gZ2V0VXJMZWRnZXJaTm9kZShsaCk7CiAg\nICAgICAgICAgIExPRy5pbmZvKCJXYXRjaGluZyBvbiB1ckxlZGdlclBhdGg6\nIiArIHVyTGVkZ2VyWk5vZGUKICAgICAgICAgICAgICAgICAgICArICIgdG8g\na25vdyB0aGUgc3RhdHVzIG9mIHJlcmVwbGljYXRpb24gcHJvY2VzcyIpOwog\nICAgICAgICAgICBhc3NlcnROb3ROdWxsKCJVckxlZGdlciBkb2Vzbid0IGV4\naXN0cyEiLAogICAgICAgICAgICAgICAgICAgIHdhdGNoVXJMZWRnZXJOb2Rl\nKHVyTGVkZ2VyWk5vZGUsIGxhdGNoKSk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBzdGFydGluZyB0aGUgcmVwbGljYXRpb24gc2VydmljZSwgc28gdGhhdCBo\nZSB3aWxsIGJlIGFibGUgdG8gYWN0IGFzCiAgICAgICAgLy8gdGFyZ2V0IGJv\nb2tpZQogICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAgaW50IG5l\nd0Jvb2tpZUluZGV4ID0gYnMuc2l6ZSgpIC0gMTsKICAgICAgICBCb29raWVT\nZXJ2ZXIgbmV3Qm9va2llU2VydmVyID0gYnMuZ2V0KG5ld0Jvb2tpZUluZGV4\nKTsKCiAgICAgICAgTE9HLmRlYnVnKCJXYWl0aW5nIHRvIGZpbmlzaCB0aGUg\ncmVwbGljYXRpb24gb2YgZmFpbGVkIGJvb2tpZSA6ICIKICAgICAgICAgICAg\nICAgICsgcmVwbGljYVRvS2lsbEFkZHIpOwoKICAgICAgICAvLyB3YWl0aW5n\nIHRvIGZpbmlzaCByZXBsaWNhdGlvbgogICAgICAgIGxhdGNoLmF3YWl0KCk7\nCgogICAgICAgIC8vIGdyYWNlIHBlcmlvZCB0byB1cGRhdGUgdGhlIHVybGVk\nZ2VyIG1ldGFkYXRhIGluIHpvb2tlZXBlcgogICAgICAgIExPRy5pbmZvKCJX\nYWl0aW5nIHRvIHVwZGF0ZSB0aGUgdXJsZWRnZXIgbWV0YWRhdGEgaW4gem9v\na2VlcGVyIik7CgogICAgICAgIGZvciAoaW50IGluZGV4ID0gMDsgaW5kZXgg\nPCBsaXN0T2ZMZWRnZXJIYW5kbGUuc2l6ZSgpOyBpbmRleCsrKSB7CiAgICAg\nICAgICAgIHZlcmlmeUxlZGdlckVuc2VtYmxlTWV0YWRhdGFBZnRlclJlcGxp\nY2F0aW9uKG5ld0Jvb2tpZVNlcnZlciwKICAgICAgICAgICAgICAgICAgICBs\naXN0T2ZMZWRnZXJIYW5kbGUuZ2V0KGluZGV4KSwKICAgICAgICAgICAgICAg\nICAgICBsaXN0T2ZSZXBsaWNhSW5kZXguZ2V0KGluZGV4KSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBzdG9wcGluZyByZXBsaWNh\nIHNlcnZpY2Ugd2hpbGUgcmVwbGljYXRpb24gaW4gcHJvZ3Jlc3MuIENvbnNp\nZGVyaW5nCiAgICAgKiB3aGVuIHRoZXJlIGlzIGFuIGV4Y2VwdGlvbiB3aWxs\nIHNodXRkb3duIEF1ZGl0b3IgYW5kIFJXIHByb2Nlc3Nlcy4gQWZ0ZXIKICAg\nICAqIHJlc3RhcnRpbmcgc2hvdWxkIGJlIGFibGUgdG8gZmluaXNoIHRoZSBy\nZS1yZXBsaWNhdGlvbiBhY3Rpdml0aWVzCiAgICAgKi8KICAgIEBUZXN0KHRp\nbWVvdXQgPSA5MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTdG9wV2hpbGVS\nZXBsaWNhdGlvbkluUHJvZ3Jlc3MoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBpbnQgbnVtYmVyT2ZMZWRnZXJzID0gMjsKICAgICAgICBMaXN0PElu\ndGVnZXI+IGxpc3RPZlJlcGxpY2FJbmRleCA9IG5ldyBBcnJheUxpc3Q8SW50\nZWdlcj4oKTsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGlzdE9mTGVk\nZ2VySGFuZGxlID0gY3JlYXRlTGVkZ2Vyc0FuZEFkZEVudHJpZXMoCiAgICAg\nICAgICAgICAgICBudW1iZXJPZkxlZGdlcnMsIDUpOwogICAgICAgIGNsb3Nl\nTGVkZ2VycyhsaXN0T2ZMZWRnZXJIYW5kbGUpOwogICAgICAgIExlZGdlckhh\nbmRsZSBoYW5kbGUgPSBsaXN0T2ZMZWRnZXJIYW5kbGUuZ2V0KDApOwogICAg\nICAgIEluZXRTb2NrZXRBZGRyZXNzIHJlcGxpY2FUb0tpbGxBZGRyID0gTGVk\nZ2VySGFuZGxlQWRhcHRlcgogICAgICAgICAgICAgICAgLmdldExlZGdlck1l\ndGFkYXRhKGhhbmRsZSkuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKS5nZXQoMCk7\nCiAgICAgICAgTE9HLmluZm8oIktpbGxpbmcgQm9va2llOiIgKyByZXBsaWNh\nVG9LaWxsQWRkcik7CgogICAgICAgIC8vIEVhY2ggbGVkZ2VyLCB0aGVyZSB3\naWxsIGJlIHR3byBldmVudHMgOiBjcmVhdGUgdXJMZWRnZXIgYW5kIGFmdGVy\nCiAgICAgICAgLy8gcmVyZXBsaWNhdGlvbiBkZWxldGUgdXJMZWRnZXIKICAg\nICAgICBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRj\naChsaXN0T2ZMZWRnZXJIYW5kbGUuc2l6ZSgpKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGxpc3RPZkxlZGdlckhhbmRsZS5zaXplKCk7IGkrKykg\newogICAgICAgICAgICBmaW5hbCBTdHJpbmcgdXJMZWRnZXJaTm9kZSA9IGdl\ndFVyTGVkZ2VyWk5vZGUobGlzdE9mTGVkZ2VySGFuZGxlCiAgICAgICAgICAg\nICAgICAgICAgLmdldChpKSk7CiAgICAgICAgICAgIGFzc2VydE51bGwoIlVy\nTGVkZ2VyIGFscmVhZHkgZXhpc3RzISIsCiAgICAgICAgICAgICAgICAgICAg\nd2F0Y2hVckxlZGdlck5vZGUodXJMZWRnZXJaTm9kZSwgbGF0Y2gpKTsKICAg\nICAgICAgICAgaW50IHJlcGxpY2FJbmRleEluTGVkZ2VyID0gZ2V0UmVwbGlj\nYUluZGV4SW5MZWRnZXIoCiAgICAgICAgICAgICAgICAgICAgbGlzdE9mTGVk\nZ2VySGFuZGxlLmdldChpKSwgcmVwbGljYVRvS2lsbEFkZHIpOwogICAgICAg\nICAgICBsaXN0T2ZSZXBsaWNhSW5kZXguYWRkKHJlcGxpY2FJbmRleEluTGVk\nZ2VyKTsKICAgICAgICB9CgogICAgICAgIExPRy5pbmZvKCJLaWxsaW5nIEJv\nb2tpZSA6IiArIHJlcGxpY2FUb0tpbGxBZGRyKTsKICAgICAgICBraWxsQm9v\na2llKHJlcGxpY2FUb0tpbGxBZGRyKTsKCiAgICAgICAgLy8gd2FpdGluZyB0\nbyBwdWJsaXNoIHVyTGVkZ2VyIHpub2RlIGJ5IEF1ZGl0b3IKICAgICAgICBs\nYXRjaC5hd2FpdCgpOwoKICAgICAgICAvLyBBZ2FpbiB3YXRjaGluZyB0aGUg\ndXJMZWRnZXIgem5vZGUgdG8ga25vdyB0aGUgcmVwbGljYXRpb24gc3RhdHVz\nCiAgICAgICAgbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2gobGlzdE9mTGVk\nZ2VySGFuZGxlLnNpemUoKSk7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUg\nbGggOiBsaXN0T2ZMZWRnZXJIYW5kbGUpIHsKICAgICAgICAgICAgU3RyaW5n\nIHVyTGVkZ2VyWk5vZGUgPSBnZXRVckxlZGdlclpOb2RlKGxoKTsKICAgICAg\nICAgICAgTE9HLmluZm8oIldhdGNoaW5nIG9uIHVyTGVkZ2VyUGF0aDoiICsg\ndXJMZWRnZXJaTm9kZQogICAgICAgICAgICAgICAgICAgICsgIiB0byBrbm93\nIHRoZSBzdGF0dXMgb2YgcmVyZXBsaWNhdGlvbiBwcm9jZXNzIik7CiAgICAg\nICAgICAgIGFzc2VydE5vdE51bGwoIlVyTGVkZ2VyIGRvZXNuJ3QgZXhpc3Rz\nISIsCiAgICAgICAgICAgICAgICAgICAgd2F0Y2hVckxlZGdlck5vZGUodXJM\nZWRnZXJaTm9kZSwgbGF0Y2gpKTsKICAgICAgICB9CgogICAgICAgIC8vIHN0\nYXJ0aW5nIHRoZSByZXBsaWNhdGlvbiBzZXJ2aWNlLCBzbyB0aGF0IGhlIHdp\nbGwgYmUgYWJsZSB0byBhY3QgYXMKICAgICAgICAvLyB0YXJnZXQgYm9va2ll\nCiAgICAgICAgc3RhcnROZXdCb29raWUoKTsKICAgICAgICBpbnQgbmV3Qm9v\na2llSW5kZXggPSBicy5zaXplKCkgLSAxOwogICAgICAgIEJvb2tpZVNlcnZl\nciBuZXdCb29raWVTZXJ2ZXIgPSBicy5nZXQobmV3Qm9va2llSW5kZXgpOwoK\nICAgICAgICBMT0cuZGVidWcoIldhaXRpbmcgdG8gZmluaXNoIHRoZSByZXBs\naWNhdGlvbiBvZiBmYWlsZWQgYm9va2llIDogIgogICAgICAgICAgICAgICAg\nKyByZXBsaWNhVG9LaWxsQWRkcik7CiAgICAgICAgd2hpbGUgKHRydWUpIHsK\nICAgICAgICAgICAgaWYgKGxhdGNoLmdldENvdW50KCkgPCBudW1iZXJPZkxl\nZGdlcnMgfHwgbGF0Y2guZ2V0Q291bnQoKSA8PSAwKSB7CiAgICAgICAgICAg\nICAgICBzdG9wUmVwbGljYXRpb25TZXJ2aWNlKCk7CiAgICAgICAgICAgICAg\nICBMT0cuaW5mbygiTGF0Y2ggQ291bnQgaXM6IiArIGxhdGNoLmdldENvdW50\nKCkpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgLy8gZ3JhY2UgcGVyaW9kIHRvIHRha2UgYnJlYXRoCiAgICAg\nICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAgICB9CgogICAgICAg\nIHN0YXJ0UmVwbGljYXRpb25TZXJ2aWNlKCk7CgogICAgICAgIExPRy5pbmZv\nKCJXYWl0aW5nIHRvIGZpbmlzaCByZXJlcGxpY2F0aW9uIHByb2Nlc3NlcyIp\nOwogICAgICAgIGxhdGNoLmF3YWl0KCk7CgogICAgICAgIC8vIGdyYWNlIHBl\ncmlvZCB0byB1cGRhdGUgdGhlIHVybGVkZ2VyIG1ldGFkYXRhIGluIHpvb2tl\nZXBlcgogICAgICAgIExPRy5pbmZvKCJXYWl0aW5nIHRvIHVwZGF0ZSB0aGUg\ndXJsZWRnZXIgbWV0YWRhdGEgaW4gem9va2VlcGVyIik7CgogICAgICAgIGZv\nciAoaW50IGluZGV4ID0gMDsgaW5kZXggPCBsaXN0T2ZMZWRnZXJIYW5kbGUu\nc2l6ZSgpOyBpbmRleCsrKSB7CiAgICAgICAgICAgIHZlcmlmeUxlZGdlckVu\nc2VtYmxlTWV0YWRhdGFBZnRlclJlcGxpY2F0aW9uKG5ld0Jvb2tpZVNlcnZl\nciwKICAgICAgICAgICAgICAgICAgICBsaXN0T2ZMZWRnZXJIYW5kbGUuZ2V0\nKGluZGV4KSwKICAgICAgICAgICAgICAgICAgICBsaXN0T2ZSZXBsaWNhSW5k\nZXguZ2V0KGluZGV4KSk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogVmVyaWZ5IHRoZSBwdWJsaXNoZWQgdXJsZWRnZXJzIG9mIGRlbGV0ZWQg\nbGVkZ2Vycyh0aG9zZSBsZWRnZXJzIHdoZXJlCiAgICAgKiBkZWxldGVkIGFm\ndGVyIHB1Ymxpc2hpbmcgYXMgdXJsZWRnZXJzIGJ5IEF1ZGl0b3IpIHNob3Vs\nZCBiZSBjbGVhcmVkIG9mZgogICAgICogYnkgdGhlIG5ld2x5IHNlbGVjdGVk\nIHJlcGxpY2EgYm9va2llCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSAz\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3ROb1N1Y2hMZWRnZXJFeGlzdHMo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMaXN0PExlZGdlckhhbmRs\nZT4gbGlzdE9mTGVkZ2VySGFuZGxlID0gY3JlYXRlTGVkZ2Vyc0FuZEFkZEVu\ndHJpZXMoMiwgNSk7CiAgICAgICAgQ291bnREb3duTGF0Y2ggbGF0Y2ggPSBu\nZXcgQ291bnREb3duTGF0Y2gobGlzdE9mTGVkZ2VySGFuZGxlLnNpemUoKSk7\nCiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaXN0T2ZMZWRnZXJI\nYW5kbGUpIHsKICAgICAgICAgICAgYXNzZXJ0TnVsbCgiVXJMZWRnZXIgYWxy\nZWFkeSBleGlzdHMhIiwKICAgICAgICAgICAgICAgICAgICB3YXRjaFVyTGVk\nZ2VyTm9kZShnZXRVckxlZGdlclpOb2RlKGxoKSwgbGF0Y2gpKTsKICAgICAg\nICB9CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2lsbEFk\nZHIgPSBMZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0\nTGVkZ2VyTWV0YWRhdGEobGlzdE9mTGVkZ2VySGFuZGxlLmdldCgwKSkuZ2V0\nRW5zZW1ibGVzKCkKICAgICAgICAgICAgICAgIC5nZXQoMEwpLmdldCgwKTsK\nICAgICAgICBraWxsQm9va2llKHJlcGxpY2FUb0tpbGxBZGRyKTsKICAgICAg\nICByZXBsaWNhVG9LaWxsQWRkciA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAg\nICAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaXN0T2ZMZWRnZXJI\nYW5kbGUuZ2V0KDApKS5nZXRFbnNlbWJsZXMoKQogICAgICAgICAgICAgICAg\nLmdldCgwTCkuZ2V0KDApOwogICAgICAgIGtpbGxCb29raWUocmVwbGljYVRv\nS2lsbEFkZHIpOwogICAgICAgIC8vIHdhaXRpbmcgdG8gcHVibGlzaCB1ckxl\nZGdlciB6bm9kZSBieSBBdWRpdG9yCiAgICAgICAgbGF0Y2guYXdhaXQoKTsK\nCiAgICAgICAgbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2gobGlzdE9mTGVk\nZ2VySGFuZGxlLnNpemUoKSk7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUg\nbGggOiBsaXN0T2ZMZWRnZXJIYW5kbGUpIHsKICAgICAgICAgICAgYXNzZXJ0\nTm90TnVsbCgiVXJMZWRnZXIgZG9lc24ndCBleGlzdHMhIiwKICAgICAgICAg\nICAgICAgICAgICB3YXRjaFVyTGVkZ2VyTm9kZShnZXRVckxlZGdlclpOb2Rl\nKGxoKSwgbGF0Y2gpKTsKICAgICAgICB9CgogICAgICAgIC8vIGRlbGV0ZSBs\nZWRnZXJzCiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaXN0T2ZM\nZWRnZXJIYW5kbGUpIHsKICAgICAgICAgICAgYmtjLmRlbGV0ZUxlZGdlcihs\naC5nZXRJZCgpKTsKICAgICAgICB9CiAgICAgICAgc3RhcnROZXdCb29raWUo\nKTsKCiAgICAgICAgLy8gd2FpdGluZyB0byBkZWxldGUgcHVibGlzaGVkIHVy\nbGVkZ2Vycywgc2luY2UgaXQgZG9lc24ndCBleGlzdHMKICAgICAgICBsYXRj\naC5hd2FpdCgpOwoKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBsaCA6IGxp\nc3RPZkxlZGdlckhhbmRsZSkgewogICAgICAgICAgICBhc3NlcnROdWxsKCJV\nckxlZGdlciBzdGlsbCBleGlzdHMgYWZ0ZXIgcmVyZXBsaWNhdGlvbiIsCiAg\nICAgICAgICAgICAgICAgICAgd2F0Y2hVckxlZGdlck5vZGUoZ2V0VXJMZWRn\nZXJaTm9kZShsaCksIGxhdGNoKSk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVGVzdCB0aGF0IGlmIGEgZW1wdHkgbGVkZ2VyIGxvc2VzIHRo\nZSBib29raWUgbm90IGluIHRoZSBxdW9ydW0gZm9yIGVudHJ5IDAsIGl0IHdp\nbGwKICAgICAqIHN0aWxsIGJlIG9wZW5hYmxlIHdoZW4gaXQgbG9zZXMgZW5v\ndWdoIGJvb2tpZXMgdG8gbG9zZSBhIHdob2xlIHF1b3J1bS4KICAgICAqLwog\nICAgQFRlc3QodGltZW91dD0xMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RF\nbXB0eUxlZGdlckxvc2VzUXVvcnVtRXZlbnR1YWxseSgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIExlZGdlckhhbmRsZSBsaCA9IGJrYy5jcmVhdGVM\nZWRnZXIoMywgMiwgMiwgRGlnZXN0VHlwZS5DUkMzMiwgUEFTU1dEKTsKICAg\nICAgICBDb3VudERvd25MYXRjaCBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRj\naCgxKTsKICAgICAgICBTdHJpbmcgdXJaTm9kZSA9IGdldFVyTGVkZ2VyWk5v\nZGUobGgpOwogICAgICAgIHdhdGNoVXJMZWRnZXJOb2RlKHVyWk5vZGUsIGxh\ndGNoKTsKCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgcmVwbGljYVRvS2ls\nbCA9IExlZGdlckhhbmRsZUFkYXB0ZXIKICAgICAgICAgICAgLmdldExlZGdl\nck1ldGFkYXRhKGxoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwpLmdldCgyKTsK\nICAgICAgICBMT0cuaW5mbygiS2lsbGluZyBsYXN0IGJvb2tpZSwge30sIGlu\nIGVuc2VtYmxlIHt9IiwgcmVwbGljYVRvS2lsbCwKICAgICAgICAgICAgICAg\nICBMZWRnZXJIYW5kbGVBZGFwdGVyLmdldExlZGdlck1ldGFkYXRhKGxoKS5n\nZXRFbnNlbWJsZXMoKS5nZXQoMEwpKTsKICAgICAgICBraWxsQm9va2llKHJl\ncGxpY2FUb0tpbGwpOwoKICAgICAgICBnZXRBdWRpdG9yKDEwLCBUaW1lVW5p\ndC5TRUNPTkRTKS5zdWJtaXRBdWRpdFRhc2soKS5nZXQoKTsgLy8gZW5zdXJl\nIGF1ZGl0b3IgcnVucwoKICAgICAgICBhc3NlcnRUcnVlKCJTaG91bGQgYmUg\nbWFya2VkIGFzIHVuZGVycmVwbGljYXRlZCIsIGxhdGNoLmF3YWl0KDUsIFRp\nbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICBsYXRjaCA9IG5ldyBDb3VudERv\nd25MYXRjaCgxKTsKICAgICAgICBTdGF0IHMgPSB3YXRjaFVyTGVkZ2VyTm9k\nZSh1clpOb2RlLCBsYXRjaCk7IC8vIHNob3VsZCBiZSBtYXJrZWQgYXMgcmVw\nbGljYXRlZAogICAgICAgIGlmIChzICE9IG51bGwpIHsKICAgICAgICAgICAg\nYXNzZXJ0VHJ1ZSgiU2hvdWxkIGJlIG1hcmtlZCBhcyByZXBsaWNhdGVkIiwg\nbGF0Y2guYXdhaXQoMTAsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgICAgICB9\nCgogICAgICAgIHJlcGxpY2FUb0tpbGwgPSBMZWRnZXJIYW5kbGVBZGFwdGVy\nCiAgICAgICAgICAgIC5nZXRMZWRnZXJNZXRhZGF0YShsaCkuZ2V0RW5zZW1i\nbGVzKCkuZ2V0KDBMKS5nZXQoMSk7CiAgICAgICAgTE9HLmluZm8oIktpbGxp\nbmcgc2Vjb25kIGJvb2tpZSwge30sIGluIGVuc2VtYmxlIHt9IiwgcmVwbGlj\nYVRvS2lsbCwKICAgICAgICAgICAgICAgICBMZWRnZXJIYW5kbGVBZGFwdGVy\nLmdldExlZGdlck1ldGFkYXRhKGxoKS5nZXRFbnNlbWJsZXMoKS5nZXQoMEwp\nKTsKICAgICAgICBraWxsQm9va2llKHJlcGxpY2FUb0tpbGwpOwoKICAgICAg\nICBnZXRBdWRpdG9yKDEwLCBUaW1lVW5pdC5TRUNPTkRTKS5zdWJtaXRBdWRp\ndFRhc2soKS5nZXQoKTsgLy8gZW5zdXJlIGF1ZGl0b3IgcnVucwoKICAgICAg\nICBhc3NlcnRUcnVlKCJTaG91bGQgYmUgbWFya2VkIGFzIHVuZGVycmVwbGlj\nYXRlZCIsIGxhdGNoLmF3YWl0KDUsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAg\nICAgICBsYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAgICAgICBz\nID0gd2F0Y2hVckxlZGdlck5vZGUodXJaTm9kZSwgbGF0Y2gpOyAvLyBzaG91\nbGQgYmUgbWFya2VkIGFzIHJlcGxpY2F0ZWQKICAgICAgICBpZiAocyAhPSBu\ndWxsKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlNob3VsZCBiZSBtYXJr\nZWQgYXMgcmVwbGljYXRlZCIsIGxhdGNoLmF3YWl0KDUsIFRpbWVVbml0LlNF\nQ09ORFMpKTsKICAgICAgICB9CgogICAgICAgIC8vIHNob3VsZCBiZSBhYmxl\nIHRvIG9wZW4gbGVkZ2VyIHdpdGhvdXQgaXNzdWUKICAgICAgICBia2Mub3Bl\nbkxlZGdlcihsaC5nZXRJZCgpLCBEaWdlc3RUeXBlLkNSQzMyLCBQQVNTV0Qp\nOwogICAgfQoKICAgIHByaXZhdGUgaW50IGdldFJlcGxpY2FJbmRleEluTGVk\nZ2VyKExlZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgSW5ldFNvY2tldEFk\nZHJlc3MgcmVwbGljYVRvS2lsbCkgewogICAgICAgIFNvcnRlZE1hcDxMb25n\nLCBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+PiBlbnNlbWJsZXMgPSBM\nZWRnZXJIYW5kbGVBZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2Vy\nTWV0YWRhdGEobGgpLmdldEVuc2VtYmxlcygpOwogICAgICAgIGludCBsZWRn\nZXJSZXBsaWNhSW5kZXggPSAtMTsKICAgICAgICBmb3IgKEluZXRTb2NrZXRB\nZGRyZXNzIGFkZHIgOiBlbnNlbWJsZXMuZ2V0KDBMKSkgewogICAgICAgICAg\nICArK2xlZGdlclJlcGxpY2FJbmRleDsKICAgICAgICAgICAgaWYgKGFkZHIu\nZXF1YWxzKHJlcGxpY2FUb0tpbGwpKSB7CiAgICAgICAgICAgICAgICBicmVh\nazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbGVk\nZ2VyUmVwbGljYUluZGV4OwogICAgfQoKICAgIHByaXZhdGUgdm9pZCB2ZXJp\nZnlMZWRnZXJFbnNlbWJsZU1ldGFkYXRhQWZ0ZXJSZXBsaWNhdGlvbigKICAg\nICAgICAgICAgQm9va2llU2VydmVyIG5ld0Jvb2tpZVNlcnZlciwgTGVkZ2Vy\nSGFuZGxlIGxoLAogICAgICAgICAgICBpbnQgbGVkZ2VyUmVwbGljYUluZGV4\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMZWRnZXJIYW5kbGUgb3Bl\nbkxlZGdlciA9IGJrYwogICAgICAgICAgICAgICAgLm9wZW5MZWRnZXIobGgu\nZ2V0SWQoKSwgZGlnZXN0VHlwZSwgUEFTU1dEKTsKCiAgICAgICAgSW5ldFNv\nY2tldEFkZHJlc3MgaW5ldFNvY2tldEFkZHJlc3MgPSBMZWRnZXJIYW5kbGVB\nZGFwdGVyCiAgICAgICAgICAgICAgICAuZ2V0TGVkZ2VyTWV0YWRhdGEob3Bl\nbkxlZGdlcikuZ2V0RW5zZW1ibGVzKCkuZ2V0KDBMKQogICAgICAgICAgICAg\nICAgLmdldChsZWRnZXJSZXBsaWNhSW5kZXgpOwogICAgICAgIGFzc2VydEVx\ndWFscygiUmVyZXBsaWNhdGlvbiBoYXMgYmVlbiBmYWlsZWQgYW5kIGxlZGdl\nclJlcGxpY2FJbmRleCA6IgogICAgICAgICAgICAgICAgKyBsZWRnZXJSZXBs\naWNhSW5kZXgsIG5ld0Jvb2tpZVNlcnZlci5nZXRMb2NhbEFkZHJlc3MoKSwK\nICAgICAgICAgICAgICAgIGluZXRTb2NrZXRBZGRyZXNzKTsKICAgIH0KCiAg\nICBwcml2YXRlIHZvaWQgY2xvc2VMZWRnZXJzKExpc3Q8TGVkZ2VySGFuZGxl\nPiBsaXN0T2ZMZWRnZXJIYW5kbGUpCiAgICAgICAgICAgIHRocm93cyBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIGZvciAo\nTGVkZ2VySGFuZGxlIGxoIDogbGlzdE9mTGVkZ2VySGFuZGxlKSB7CiAgICAg\nICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZh\ndGUgTGlzdDxMZWRnZXJIYW5kbGU+IGNyZWF0ZUxlZGdlcnNBbmRBZGRFbnRy\naWVzKGludCBudW1iZXJPZkxlZGdlcnMsCiAgICAgICAgICAgIGludCBudW1i\nZXJPZkVudHJpZXMpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiwgQktF\neGNlcHRpb24gewogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaXN0T2ZM\nZWRnZXJIYW5kbGUgPSBuZXcgQXJyYXlMaXN0PExlZGdlckhhbmRsZT4oCiAg\nICAgICAgICAgICAgICBudW1iZXJPZkxlZGdlcnMpOwogICAgICAgIGZvciAo\naW50IGluZGV4ID0gMDsgaW5kZXggPCBudW1iZXJPZkxlZGdlcnM7IGluZGV4\nKyspIHsKICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoID0gYmtjLmNyZWF0\nZUxlZGdlcigzLCAzLCBkaWdlc3RUeXBlLCBQQVNTV0QpOwogICAgICAgICAg\nICBsaXN0T2ZMZWRnZXJIYW5kbGUuYWRkKGxoKTsKICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBudW1iZXJPZkVudHJpZXM7IGkrKykgewogICAg\nICAgICAgICAgICAgbGguYWRkRW50cnkoZGF0YSk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxpc3RPZkxlZGdlckhhbmRsZTsK\nICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBnZXRVckxlZGdlclpOb2RlKExl\nZGdlckhhbmRsZSBsaCkgewogICAgICAgIHJldHVybiBaa0xlZGdlclVuZGVy\ncmVwbGljYXRpb25NYW5hZ2VyLmdldFVyTGVkZ2VyWm5vZGUoCiAgICAgICAg\nICAgICAgICBVTkRFUlJFUExJQ0FURURfUEFUSCwgbGguZ2V0SWQoKSk7CiAg\nICB9CgogICAgcHJpdmF0ZSBTdGF0IHdhdGNoVXJMZWRnZXJOb2RlKGZpbmFs\nIFN0cmluZyB6bm9kZSwKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0\nY2ggbGF0Y2gpIHRocm93cyBLZWVwZXJFeGNlcHRpb24sCiAgICAgICAgICAg\nIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gemtjLmV4\naXN0cyh6bm9kZSwgbmV3IFdhdGNoZXIoKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRF\ndmVudCBldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFR5\ncGUoKSA9PSBFdmVudFR5cGUuTm9kZURlbGV0ZWQpIHsKICAgICAgICAgICAg\nICAgICAgICBMT0cuaW5mbygiUmVjaWV2ZWQgTGVkZ2VyIHJlcmVwbGljYXRp\nb24gY29tcGxldGlvbiBldmVudCA6IgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyBldmVudC5nZXRUeXBlKCkpOwogICAgICAgICAgICAgICAgICAg\nIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKSA9PSBFdmVudFR5cGUuTm9k\nZUNyZWF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiUmVj\naWV2ZWQgdXJMZWRnZXIgcHVibGlzaGluZyBldmVudCA6IgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyBldmVudC5nZXRUeXBlKCkpOwogICAgICAg\nICAgICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0K\n","encoding":"base64"}

