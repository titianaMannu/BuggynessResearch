{"sha":"62548c6756b394bdd19da8c127a43f3aa3237cc0","node_id":"MDQ6QmxvYjE1NzU5NTY6NjI1NDhjNjc1NmIzOTRiZGQxOWRhOGMxMjdhNDNmM2FhMzIzN2NjMA==","size":29014,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/62548c6756b394bdd19da8c127a43f3aa3237cc0","content":"LyoqCiAqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91\nbmRhdGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRv\nciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAq\nIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGlu\nZm9ybWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAg\nVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRo\nZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5z\nZSIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21w\nbGlhbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBh\nIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFw\nYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJl\ncXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0\naW5nLAogKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5z\nZSBpcyBkaXN0cmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRI\nT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwg\nZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBm\nb3IgdGhlCiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNz\naW9ucyBhbmQgbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAq\nCiAqLwoKcGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRp\nb247CgppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RXF1\nYWxzOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuYXNzZXJ0RmFs\nc2U7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC5hc3NlcnRUcnVl\nOwppbXBvcnQgc3RhdGljIG9yZy5qdW5pdC5Bc3NlcnQuZmFpbDsKCmltcG9y\ndCBqYXZhLm5pby5jaGFyc2V0LkNoYXJzZXQ7CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247CmltcG9y\ndCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRv\ncjsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLlNl\ndDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNhbGxhYmxlOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvclNlcnZpY2U7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5FeGVjdXRvcnM7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5GdXR1cmU7CmltcG9ydCBqYXZhLnV0aWwuY29u\nY3VycmVudC5UaW1lVW5pdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50\nLlRpbWVvdXRFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5hdG9taWMuQXRvbWljQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNJbnRlZ2VyOwoKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhLkxlZGdl\nclVuZGVycmVwbGljYXRpb25NYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLm1ldGEuWmtMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5EYXRhRm9y\nbWF0cy5VbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQ7CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNl\ncHRpb24uQ29tcGF0aWJpbGl0eUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5SZXBsaWNhdGlvbkV4Y2VwdGlv\nbi5VbmF2YWlsYWJsZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci50ZXN0Llpvb0tlZXBlclV0aWw7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIudXRpbC5Cb29rS2VlcGVyQ29uc3RhbnRzOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuWmtVdGlsczsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci56b29rZWVwZXIuWm9vS2VlcGVyV2F0Y2hl\nckJhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMubGFuZy5TdHJpbmdV\ndGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVu\ndDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyLkV2ZW50LkV2ZW50VHlwZTsKaW1w\nb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7\nCmltcG9ydCBvcmcuanVuaXQuVGVzdDsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBj\nb20uZ29vZ2xlLnByb3RvYnVmLlRleHRGb3JtYXQ7CgovKioKICogVGVzdCB0\naGUgem9va2VlcGVyIGltcGxlbWVudGF0aW9uIG9mIHRoZSBsZWRnZXIgcmVw\nbGljYXRpb24gbWFuYWdlcgogKi8KcHVibGljIGNsYXNzIFRlc3RMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlciB7CiAgICBzdGF0aWMgZmluYWwgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlc3RMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlci5jbGFzcyk7CgogICAgWm9vS2VlcGVy\nVXRpbCB6a1V0aWwgPSBudWxsOwoKICAgIFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiA9IG51bGw7CiAgICBFeGVjdXRvclNlcnZpY2UgZXhlY3V0b3IgPSBu\ndWxsOwogICAgTGVkZ2VyTWFuYWdlckZhY3RvcnkgbG1mMSA9IG51bGw7CiAg\nICBMZWRnZXJNYW5hZ2VyRmFjdG9yeSBsbWYyID0gbnVsbDsKICAgIFpvb0tl\nZXBlciB6a2MxID0gbnVsbDsKICAgIFpvb0tlZXBlciB6a2MyID0gbnVsbDsK\nCiAgICBTdHJpbmcgYmFzZVBhdGg7CiAgICBTdHJpbmcgdXJMZWRnZXJQYXRo\nOwogICAgYm9vbGVhbiBpc0xlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQgPSB0\ncnVlOwoKICAgIEBCZWZvcmUKICAgIHB1YmxpYyB2b2lkIHNldHVwWm9vS2Vl\ncGVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgemtVdGlsID0gbmV3\nIFpvb0tlZXBlclV0aWwoKTsKICAgICAgICB6a1V0aWwuc3RhcnRTZXJ2ZXIo\nKTsKCiAgICAgICAgY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkK\nICAgICAgICAgICAgLnNldEFsbG93TG9vcGJhY2sodHJ1ZSkKICAgICAgICAg\nICAgLnNldFprU2VydmVycyh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0\ncmluZygpKTsKCiAgICAgICAgZXhlY3V0b3IgPSBFeGVjdXRvcnMubmV3Q2Fj\naGVkVGhyZWFkUG9vbCgpOwoKICAgICAgICBab29LZWVwZXJXYXRjaGVyQmFz\nZSB3ID0gbmV3IFpvb0tlZXBlcldhdGNoZXJCYXNlKDEwMDAwKTsKICAgICAg\nICB6a2MxID0gWmtVdGlscy5jcmVhdGVDb25uZWN0ZWRab29rZWVwZXJDbGll\nbnQoCiAgICAgICAgICAgICAgICB6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVj\ndFN0cmluZygpLCB3KTsKICAgICAgICB3ID0gbmV3IFpvb0tlZXBlcldhdGNo\nZXJCYXNlKDEwMDAwKTsKICAgICAgICB6a2MyID0gWmtVdGlscy5jcmVhdGVD\nb25uZWN0ZWRab29rZWVwZXJDbGllbnQoCiAgICAgICAgICAgICAgICB6a1V0\naWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLCB3KTsKICAgICAgICBs\nbWYxID0gTGVkZ2VyTWFuYWdlckZhY3RvcnkubmV3TGVkZ2VyTWFuYWdlckZh\nY3RvcnkoY29uZiwgemtjMSk7CiAgICAgICAgbG1mMiA9IExlZGdlck1hbmFn\nZXJGYWN0b3J5Lm5ld0xlZGdlck1hbmFnZXJGYWN0b3J5KGNvbmYsIHprYzIp\nOwogICAgICAgIGJhc2VQYXRoID0gY29uZi5nZXRaa0xlZGdlcnNSb290UGF0\naCgpICsgJy8nCiAgICAgICAgICAgICAgICArIEJvb2tLZWVwZXJDb25zdGFu\ndHMuVU5ERVJfUkVQTElDQVRJT05fTk9ERTsKICAgICAgICB1ckxlZGdlclBh\ndGggPSBiYXNlUGF0aAogICAgICAgICAgICAgICAgKyBCb29rS2VlcGVyQ29u\nc3RhbnRzLkRFRkFVTFRfWktfTEVER0VSU19ST09UX1BBVEg7CiAgICB9Cgog\nICAgQEFmdGVyCiAgICBwdWJsaWMgdm9pZCB0ZWFyZG93blpvb0tlZXBlcigp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGlmICh6a1V0aWwgIT0gbnVs\nbCkgewogICAgICAgICAgICB6a1V0aWwua2lsbFNlcnZlcigpOwogICAgICAg\nICAgICB6a1V0aWwgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoZXhl\nY3V0b3IgIT0gbnVsbCkgewogICAgICAgICAgICBleGVjdXRvciA9IG51bGw7\nCiAgICAgICAgfQogICAgICAgIGlmICh6a2MxICE9IG51bGwpIHsKICAgICAg\nICAgICAgemtjMS5jbG9zZSgpOwogICAgICAgICAgICB6a2MxID0gbnVsbDsK\nICAgICAgICB9CiAgICAgICAgaWYgKHprYzIgIT0gbnVsbCkgewogICAgICAg\nICAgICB6a2MyLmNsb3NlKCk7CiAgICAgICAgICAgIHprYzIgPSBudWxsOwog\nICAgICAgIH0KICAgICAgICBpZiAobG1mMSAhPSBudWxsKSB7CiAgICAgICAg\nICAgIGxtZjEudW5pbml0aWFsaXplKCk7CiAgICAgICAgICAgIGxtZjEgPSBu\ndWxsOwogICAgICAgIH0KICAgICAgICBpZiAobG1mMiAhPSBudWxsKSB7CiAg\nICAgICAgICAgIGxtZjIudW5pbml0aWFsaXplKCk7CiAgICAgICAgICAgIGxt\nZjIgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIEZ1dHVy\nZTxMb25nPiBnZXRMZWRnZXJUb1JlcGxpY2F0ZShmaW5hbCBMZWRnZXJVbmRl\ncnJlcGxpY2F0aW9uTWFuYWdlciBtKSB7CiAgICAgICAgcmV0dXJuIGV4ZWN1\ndG9yLnN1Ym1pdChuZXcgQ2FsbGFibGU8TG9uZz4oKSB7CiAgICAgICAgICAg\nICAgICBwdWJsaWMgTG9uZyBjYWxsKCkgewogICAgICAgICAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBtLmdldExl\nZGdlclRvUmVyZXBsaWNhdGUoKTsKICAgICAgICAgICAgICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkVycm9yIGdldHRpbmcgbGVkZ2VyIGlkIiwgZSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybiAtMUw7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAg\nIH0KCiAgICAvKioKICAgICAqIFRlc3QgYmFzaWMgaW50ZXJhY3Rpb25zIHdp\ndGggdGhlIGxlZGdlciB1bmRlcnJlcGxpY2F0aW9uCiAgICAgKiBtYW5hZ2Vy\nLgogICAgICogTWFyayBzb21lIGxlZGdlcnMgYXMgdW5kZXJyZXBsaWNhdGVk\nLgogICAgICogRW5zdXJlIHRoYXQgZ2V0TGVkZ2VyVG9SZXBsaWNhdGUgd2ls\nbCBibG9jayB1bnRpbCBpdCBhIGxlZGdlcgogICAgICogYmVjb21lcyBhdmFp\nbGFibGUuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBw\ndWJsaWMgdm9pZCB0ZXN0QmFzaWNJbnRlcmFjdGlvbigpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIFNldDxMb25nPiBsZWRnZXJzID0gbmV3IEhhc2hT\nZXQ8TG9uZz4oKTsKICAgICAgICBsZWRnZXJzLmFkZCgweGRlYWRiZWVmTCk7\nCiAgICAgICAgbGVkZ2Vycy5hZGQoMHhiZWVmY2FmZUwpOwogICAgICAgIGxl\nZGdlcnMuYWRkKDB4ZmZmZmJlZWZMKTsKICAgICAgICBsZWRnZXJzLmFkZCgw\neGZhY2ViZWVmTCk7CiAgICAgICAgU3RyaW5nIG1pc3NpbmdSZXBsaWNhID0g\nImxvY2FsaG9zdDozMTgxIjsKCiAgICAgICAgaW50IGNvdW50ID0gMDsKICAg\nICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtID0gbG1mMS5u\nZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwogICAgICAgIEl0\nZXJhdG9yPExvbmc+IGl0ZXIgPSBsZWRnZXJzLml0ZXJhdG9yKCk7CiAgICAg\nICAgd2hpbGUgKGl0ZXIuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgIG0ubWFy\na0xlZGdlclVuZGVycmVwbGljYXRlZChpdGVyLm5leHQoKSwgbWlzc2luZ1Jl\ncGxpY2EpOwogICAgICAgICAgICBjb3VudCsrOwogICAgICAgIH0KCiAgICAg\nICAgTGlzdDxGdXR1cmU8TG9uZz4+IGZ1dHVyZXMgPSBuZXcgQXJyYXlMaXN0\nPEZ1dHVyZTxMb25nPj4oKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGNvdW50OyBpKyspIHsKICAgICAgICAgICAgZnV0dXJlcy5hZGQoZ2V0TGVk\nZ2VyVG9SZXBsaWNhdGUobSkpOwogICAgICAgIH0KCiAgICAgICAgZm9yIChG\ndXR1cmU8TG9uZz4gZiA6IGZ1dHVyZXMpIHsKICAgICAgICAgICAgTG9uZyBs\nID0gZi5nZXQoNSwgVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgICAgIGFz\nc2VydFRydWUobGVkZ2Vycy5yZW1vdmUobCkpOwogICAgICAgIH0KCiAgICAg\nICAgRnV0dXJlPExvbmc+IGYgPSBnZXRMZWRnZXJUb1JlcGxpY2F0ZShtKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICBmLmdldCg1LCBUaW1lVW5pdC5T\nRUNPTkRTKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUg\ndG8gZmluZCBhIGxlZGdlciB0byByZXBsaWNhdGUiKTsKICAgICAgICB9IGNh\ndGNoIChUaW1lb3V0RXhjZXB0aW9uIHRlKSB7CiAgICAgICAgICAgIC8vIGNv\ncnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgICAgIExvbmcgbmV3bCA9\nIDB4ZmVmZWZlZmVmZWZlTDsKICAgICAgICBtLm1hcmtMZWRnZXJVbmRlcnJl\ncGxpY2F0ZWQobmV3bCwgbWlzc2luZ1JlcGxpY2EpOwogICAgICAgIGFzc2Vy\ndEVxdWFscygiU2hvdWxkIGhhdmUgZ290IHRoZSBvbmUganVzdCBhZGRlZCIs\nIG5ld2wsIGYuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgbG9ja2luZyBmb3IgbGVkZ2VyIHVucmVwbGlj\nYXRpb24gbWFuYWdlci4KICAgICAqIElmIHRoZXJlJ3Mgb25seSBvbmUgbGVk\nZ2VyIG1hcmtlZCBmb3IgcmVyZXBsaWNhdGlvbiwKICAgICAqIGFuZCBvbmUg\nY2xpZW50IGhhcyBpdCwgaXQgc2hvdWxkIGJlIGxvY2tlZDsgYW5vdGhlcgog\nICAgICogY2xpZW50IHNob3VsZG4ndCBiZSBhYmxlIHRvIGdldCBpdC4gSWYg\ndGhlIGZpcnN0IGNsaWVudCBkaWVzCiAgICAgKiBob3dldmVyLCB0aGUgc2Vj\nb25kIGNsaWVudCBzaG91bGQgYmUgYWJsZSB0byBnZXQgaXQuCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9pZCB0ZXN0\nTG9ja2luZygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBt\naXNzaW5nUmVwbGljYSA9ICJsb2NhbGhvc3Q6MzE4MSI7CgogICAgICAgIExl\nZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyIG0xID0gbG1mMS5uZXdMZWRn\nZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwogICAgICAgIExlZGdlclVu\nZGVycmVwbGljYXRpb25NYW5hZ2VyIG0yID0gbG1mMi5uZXdMZWRnZXJVbmRl\ncnJlcGxpY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICBMb25nIGxlZGdlciA9\nIDB4ZmVhZGVlZmRhY0w7CiAgICAgICAgbTEubWFya0xlZGdlclVuZGVycmVw\nbGljYXRlZChsZWRnZXIsIG1pc3NpbmdSZXBsaWNhKTsKICAgICAgICBGdXR1\ncmU8TG9uZz4gZiA9IGdldExlZGdlclRvUmVwbGljYXRlKG0xKTsKICAgICAg\nICBMb25nIGwgPSBmLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAg\nICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSB0aGUgbGVkZ2VyIEkganVzdCBt\nYXJrZWQiLCBsZWRnZXIsIGwpOwoKICAgICAgICBmID0gZ2V0TGVkZ2VyVG9S\nZXBsaWNhdGUobTIpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGYuZ2V0\nKDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgICAgICBmYWlsKCJTaG91\nbGRuJ3QgYmUgYWJsZSB0byBmaW5kIGEgbGVkZ2VyIHRvIHJlcGxpY2F0ZSIp\nOwogICAgICAgIH0gY2F0Y2ggKFRpbWVvdXRFeGNlcHRpb24gdGUpIHsKICAg\nICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CiAgICAg\nICAgemtjMS5jbG9zZSgpOyAvLyBzaG91bGQga2lsbCB0aGUgbG9jawogICAg\nICAgIHprYzEgPSBudWxsOwoKICAgICAgICBsID0gZi5nZXQoNSwgVGltZVVu\naXQuU0VDT05EUyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91bGQgYmUg\ndGhlIGxlZGdlciBJIG1hcmtlZCIsIGxlZGdlciwgbCk7CiAgICB9CgoKICAg\nIC8qKgogICAgICogVGVzdCB0aGF0IHdoZW4gYSBsZWRnZXIgaGFzIGJlZW4g\nbWFya2VkIGFzIHJlcGxpY2F0ZWQsIGl0CiAgICAgKiB3aWxsIG5vdCBiZSBv\nZmZlcmVkIHRvIGFudGhlciBjbGllbnQuCiAgICAgKiBUaGlzIHRlc3QgY2hl\nY2tlZCB0aGF0IGJ5IG1hcmtpbmcgdHdvIGxlZGdlcnMsIGFuZCBhY3F1aXJp\nbmcKICAgICAqIHRoZW0gb24gYSBzaW5nbGUgY2xpZW50LiBJdCBtYXJrcyBv\nbmUgYXMgcmVwbGljYXRlZCBhbmQgdGhlbgogICAgICogdGhlIGNsaWVudCBp\ncyBraWxsZWQuIFdlIHRoZW4gY2hlY2sgdGhhdCBhbm90aGVyIGNsaWVudCBj\nYW4KICAgICAqIGFjcXVpcmUgYSBsZWRnZXIsIGFuZCB0aGF0IGl0J3Mgbm90\nIHRoZSBvbmUgdGhhdCB3YXMgcHJldmlvdXNseQogICAgICogbWFya2VkIGFz\nIHJlcGxpY2F0ZWQuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDAp\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0TWFya2luZ0FzUmVwbGljYXRlZCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtaXNzaW5nUmVwbGlj\nYSA9ICJsb2NhbGhvc3Q6MzE4MSI7CgogICAgICAgIExlZGdlclVuZGVycmVw\nbGljYXRpb25NYW5hZ2VyIG0xID0gbG1mMS5uZXdMZWRnZXJVbmRlcnJlcGxp\nY2F0aW9uTWFuYWdlcigpOwogICAgICAgIExlZGdlclVuZGVycmVwbGljYXRp\nb25NYW5hZ2VyIG0yID0gbG1mMi5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9u\nTWFuYWdlcigpOwoKICAgICAgICBMb25nIGxlZGdlckEgPSAweGZlYWRlZWZk\nYWNMOwogICAgICAgIExvbmcgbGVkZ2VyQiA9IDB4ZGVmYWRlYkw7CiAgICAg\nICAgbTEubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsZWRnZXJBLCBtaXNz\naW5nUmVwbGljYSk7CiAgICAgICAgbTEubWFya0xlZGdlclVuZGVycmVwbGlj\nYXRlZChsZWRnZXJCLCBtaXNzaW5nUmVwbGljYSk7CgogICAgICAgIEZ1dHVy\nZTxMb25nPiBmQSA9IGdldExlZGdlclRvUmVwbGljYXRlKG0xKTsKICAgICAg\nICBGdXR1cmU8TG9uZz4gZkIgPSBnZXRMZWRnZXJUb1JlcGxpY2F0ZShtMSk7\nCgogICAgICAgIExvbmcgbEEgPSBmQS5nZXQoNSwgVGltZVVuaXQuU0VDT05E\nUyk7CiAgICAgICAgTG9uZyBsQiA9IGZCLmdldCg1LCBUaW1lVW5pdC5TRUNP\nTkRTKTsKCiAgICAgICAgYXNzZXJ0VHJ1ZSgiU2hvdWxkIGJlIHRoZSBsZWRn\nZXJzIEkganVzdCBtYXJrZWQiLAogICAgICAgICAgICAgICAgICAgKGxBLmVx\ndWFscyhsZWRnZXJBKSAmJiBsQi5lcXVhbHMobGVkZ2VyQikpCiAgICAgICAg\nICAgICAgICAgICB8fCAobEEuZXF1YWxzKGxlZGdlckIpICYmIGxCLmVxdWFs\ncyhsZWRnZXJBKSkpOwoKICAgICAgICBGdXR1cmU8TG9uZz4gZiA9IGdldExl\nZGdlclRvUmVwbGljYXRlKG0yKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBmLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgZmFp\nbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gZmluZCBhIGxlZGdlciB0byByZXBs\naWNhdGUiKTsKICAgICAgICB9IGNhdGNoIChUaW1lb3V0RXhjZXB0aW9uIHRl\nKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAg\nfQogICAgICAgIG0xLm1hcmtMZWRnZXJSZXBsaWNhdGVkKGxBKTsKICAgICAg\nICB6a2MxLmNsb3NlKCk7IC8vIHNob3VsZCBraWxsIHRoZSBsb2NrCiAgICAg\nICAgemtjMSA9IG51bGw7CgogICAgICAgIExvbmcgbCA9IGYuZ2V0KDUsIFRp\nbWVVbml0LlNFQ09ORFMpOwogICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxk\nIGJlIHRoZSBsZWRnZXIgSSBtYXJrZWQiLCBsQiwgbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUZXN0IHJlbGVhc2luZyBvZiBhIGxlZGdlcgogICAgICog\nQSBsZWRnZXIgaXMgcmVsZWFzZWQgd2hlbiBhIGNsaWVudCBkZWNpZGVzIGl0\nIGRvZXMgbm90IHdhbnQKICAgICAqIHRvIHJlcGxpY2F0ZSBpdCAob3IgY2Fu\nbm90IGF0IHRoZSBtb21lbnQpLgogICAgICogV2hlbiBhIGNsaWVudCByZWxl\nYXNlcyBhIHByZXZpb3VzbHkgYWNxdWlyZWQgbGVkZ2VyLCBhbm90aGVyCiAg\nICAgKiBjbGllbnQgc2hvdWxkIHRoZW4gYmUgYWJsZSB0byBhY3F1aXJlIGl0\nLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGlj\nIHZvaWQgdGVzdFJlbGVhc2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBTdHJpbmcgbWlzc2luZ1JlcGxpY2EgPSAibG9jYWxob3N0OjMxODEiOwoK\nICAgICAgICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtMSA9IGxt\nZjEubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAgICAg\nICBMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtMiA9IGxtZjIubmV3\nTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAgTG9u\nZyBsZWRnZXJBID0gMHhmZWFkZWVmZGFjTDsKICAgICAgICBMb25nIGxlZGdl\nckIgPSAweGRlZmFkZWJMOwogICAgICAgIG0xLm1hcmtMZWRnZXJVbmRlcnJl\ncGxpY2F0ZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2EpOwogICAgICAgIG0x\nLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGVkZ2VyQiwgbWlzc2luZ1Jl\ncGxpY2EpOwoKICAgICAgICBGdXR1cmU8TG9uZz4gZkEgPSBnZXRMZWRnZXJU\nb1JlcGxpY2F0ZShtMSk7CiAgICAgICAgRnV0dXJlPExvbmc+IGZCID0gZ2V0\nTGVkZ2VyVG9SZXBsaWNhdGUobTEpOwoKICAgICAgICBMb25nIGxBID0gZkEu\nZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwogICAgICAgIExvbmcgbEIgPSBm\nQi5nZXQoNSwgVGltZVVuaXQuU0VDT05EUyk7CgogICAgICAgIGFzc2VydFRy\ndWUoIlNob3VsZCBiZSB0aGUgbGVkZ2VycyBJIGp1c3QgbWFya2VkIiwKICAg\nICAgICAgICAgICAgICAgIChsQS5lcXVhbHMobGVkZ2VyQSkgJiYgbEIuZXF1\nYWxzKGxlZGdlckIpKQogICAgICAgICAgICAgICAgICAgfHwgKGxBLmVxdWFs\ncyhsZWRnZXJCKSAmJiBsQi5lcXVhbHMobGVkZ2VyQSkpKTsKCiAgICAgICAg\nRnV0dXJlPExvbmc+IGYgPSBnZXRMZWRnZXJUb1JlcGxpY2F0ZShtMik7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgZi5nZXQoNSwgVGltZVVuaXQuU0VD\nT05EUyk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRv\nIGZpbmQgYSBsZWRnZXIgdG8gcmVwbGljYXRlIik7CiAgICAgICAgfSBjYXRj\naCAoVGltZW91dEV4Y2VwdGlvbiB0ZSkgewogICAgICAgICAgICAvLyBjb3Jy\nZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAgICAgICBtMS5tYXJrTGVkZ2Vy\nUmVwbGljYXRlZChsQSk7CiAgICAgICAgbTEucmVsZWFzZVVuZGVycmVwbGlj\nYXRlZExlZGdlcihsQik7CgogICAgICAgIExvbmcgbCA9IGYuZ2V0KDUsIFRp\nbWVVbml0LlNFQ09ORFMpOwogICAgICAgIGFzc2VydEVxdWFscygiU2hvdWxk\nIGJlIHRoZSBsZWRnZXIgSSBtYXJrZWQiLCBsQiwgbCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUZXN0IHRoYXQgd2hlbiBhIGZhaWx1cmUgb2NjdXJzIG9u\nIGEgbGVkZ2VyLCB3aGlsZSB0aGUgbGVkZ2VyCiAgICAgKiBpcyBhbHJlYWR5\nIGJlaW5nIHJlcmVwbGljYXRlZCwgdGhlIGxlZGdlciB3aWxsIHN0aWxsIGJl\nIGluIHRoZQogICAgICogdW5kZXIgcmVwbGljYXRlZCBsZWRnZXIgbGlzdCB3\naGVuIGZpcnN0IHJlcmVwbGljYXRpbmcgY2xpZW50IG1hcmtzCiAgICAgKiBp\ndCBhcyByZXBsaWNhdGVkLgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYw\nMDAwKQogICAgcHVibGljIHZvaWQgdGVzdE1hbnlGYWlsdXJlcygpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIFN0cmluZyBtaXNzaW5nUmVwbGljYTEg\nPSAibG9jYWxob3N0OjMxODEiOwogICAgICAgIFN0cmluZyBtaXNzaW5nUmVw\nbGljYTIgPSAibG9jYWxob3N0OjMxODIiOwoKICAgICAgICBMZWRnZXJVbmRl\ncnJlcGxpY2F0aW9uTWFuYWdlciBtMSA9IGxtZjEubmV3TGVkZ2VyVW5kZXJy\nZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAgTG9uZyBsZWRnZXJBID0g\nMHhmZWFkZWVmZGFjTDsKICAgICAgICBtMS5tYXJrTGVkZ2VyVW5kZXJyZXBs\naWNhdGVkKGxlZGdlckEsIG1pc3NpbmdSZXBsaWNhMSk7CgogICAgICAgIEZ1\ndHVyZTxMb25nPiBmQSA9IGdldExlZGdlclRvUmVwbGljYXRlKG0xKTsKICAg\nICAgICBMb25nIGxBID0gZkEuZ2V0KDUsIFRpbWVVbml0LlNFQ09ORFMpOwoK\nICAgICAgICBtMS5tYXJrTGVkZ2VyVW5kZXJyZXBsaWNhdGVkKGxlZGdlckEs\nIG1pc3NpbmdSZXBsaWNhMik7CgogICAgICAgIGFzc2VydEVxdWFscygiU2hv\ndWxkIGJlIHRoZSBsZWRnZXIgSSBqdXN0IG1hcmtlZCIsCiAgICAgICAgICAg\nICAgICAgICAgIGxBLCBsZWRnZXJBKTsKICAgICAgICBtMS5tYXJrTGVkZ2Vy\nUmVwbGljYXRlZChsQSk7CgogICAgICAgIEZ1dHVyZTxMb25nPiBmID0gZ2V0\nTGVkZ2VyVG9SZXBsaWNhdGUobTEpOwogICAgICAgIGxBID0gZi5nZXQoNSwg\nVGltZVVuaXQuU0VDT05EUyk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJTaG91\nbGQgYmUgdGhlIGxlZGdlciBJIGhhZCBtYXJrZWQgcHJldmlvdXNseSIsCiAg\nICAgICAgICAgICAgICAgICAgIGxBLCBsZWRnZXJBKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRlc3QgdGhhdCB3aGVuIGEgbGVkZ2VyIGlzIG1hcmtlZCBh\ncyB1bmRlcnJlcGxpY2F0ZWQgd2l0aAogICAgICogdGhlIHNhbWUgbWlzc2lu\nZyByZXBsaWNhIHR3aWNlLCBvbmx5IG1hcmtpbmcgYXMgcmVwbGljYXRlZAog\nICAgICogd2lsbCBiZSBlbm91Z2ggdG8gcmVtb3ZlIGl0IGZyb20gdGhlIGxp\nc3QuCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0MnJlcG9ydFNhbWUoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBTdHJpbmcgbWlzc2luZ1JlcGxpY2ExID0gImxvY2FsaG9zdDoz\nMTgxIjsKCiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIg\nbTEgPSBsbWYxLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7\nCiAgICAgICAgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgbTIgPSBs\nbWYyLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7CgogICAg\nICAgIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVlZmRhY0w7CiAgICAgICAgbTEu\nbWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsZWRnZXJBLCBtaXNzaW5nUmVw\nbGljYTEpOwogICAgICAgIG0yLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQo\nbGVkZ2VyQSwgbWlzc2luZ1JlcGxpY2ExKTsKCiAgICAgICAgLy8gdmVyaWZ5\nIGR1cGxpY2F0ZSBtaXNzaW5nIHJlcGxpY2EKICAgICAgICBVbmRlcnJlcGxp\nY2F0ZWRMZWRnZXJGb3JtYXQuQnVpbGRlciBidWlsZGVyQSA9IFVuZGVycmVw\nbGljYXRlZExlZGdlckZvcm1hdAogICAgICAgICAgICAgICAgLm5ld0J1aWxk\nZXIoKTsKICAgICAgICBTdHJpbmcgem5vZGUgPSBnZXRVckxlZGdlclpub2Rl\nKGxlZGdlckEpOwogICAgICAgIGJ5dGVbXSBkYXRhID0gemtjMS5nZXREYXRh\nKHpub2RlLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgVGV4dEZvcm1hdC5tZXJn\nZShuZXcgU3RyaW5nKGRhdGEsIENoYXJzZXQuZm9yTmFtZSgiVVRGLTgiKSks\nIGJ1aWxkZXJBKTsKICAgICAgICBMaXN0PFN0cmluZz4gcmVwbGljYUxpc3Qg\nPSBidWlsZGVyQS5nZXRSZXBsaWNhTGlzdCgpOwogICAgICAgIGFzc2VydEVx\ndWFscygiUHVibGlzaGVkIGR1cGxpY2F0ZSBtaXNzaW5nIHJlcGxpY2EgOiAi\nICsgcmVwbGljYUxpc3QsIDEsCiAgICAgICAgICAgICAgICByZXBsaWNhTGlz\ndC5zaXplKCkpOwogICAgICAgIGFzc2VydFRydWUoIlB1Ymxpc2hlZCBkdXBs\naWNhdGUgbWlzc2luZyByZXBsaWNhIDogIiArIHJlcGxpY2FMaXN0LAogICAg\nICAgICAgICAgICAgcmVwbGljYUxpc3QuY29udGFpbnMobWlzc2luZ1JlcGxp\nY2ExKSk7CgogICAgICAgIEZ1dHVyZTxMb25nPiBmQSA9IGdldExlZGdlclRv\nUmVwbGljYXRlKG0xKTsKICAgICAgICBMb25nIGxBID0gZkEuZ2V0KDUsIFRp\nbWVVbml0LlNFQ09ORFMpOwoKICAgICAgICBhc3NlcnRFcXVhbHMoIlNob3Vs\nZCBiZSB0aGUgbGVkZ2VyIEkganVzdCBtYXJrZWQiLAogICAgICAgICAgICAg\nICAgICAgICBsQSwgbGVkZ2VyQSk7CiAgICAgICAgbTEubWFya0xlZGdlclJl\ncGxpY2F0ZWQobEEpOwoKICAgICAgICBGdXR1cmU8TG9uZz4gZiA9IGdldExl\nZGdlclRvUmVwbGljYXRlKG0yKTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBmLmdldCg1LCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgZmFp\nbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gZmluZCBhIGxlZGdlciB0byByZXBs\naWNhdGUiKTsKICAgICAgICB9IGNhdGNoIChUaW1lb3V0RXhjZXB0aW9uIHRl\nKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IG11bHRpcGxlIExl\nZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VycyBzaG91bGQgYmUgYWJsZSB0\nbyB0YWtlCiAgICAgKiBsb2NrIGFuZCByZWxlYXNlIGZvciBzYW1lIGxlZGdl\ncgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gMzAwMDApCiAgICBwdWJs\naWMgdm9pZCB0ZXN0TXVsdGlwbGVNYW5hZ2Vyc1Nob3VsZEJlQWJsZVRvVGFr\nZUFuZFJlbGVhc2VMb2NrKCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgU3RyaW5nIG1pc3NpbmdSZXBsaWNhMSA9ICJsb2NhbGhv\nc3Q6MzE4MSI7CiAgICAgICAgZmluYWwgTGVkZ2VyVW5kZXJyZXBsaWNhdGlv\nbk1hbmFnZXIgbTEgPSBsbWYxCiAgICAgICAgICAgICAgICAubmV3TGVkZ2Vy\nVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKICAgICAgICBmaW5hbCBMZWRn\nZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlciBtMiA9IGxtZjIKICAgICAgICAg\nICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwog\nICAgICAgIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVlZmRhY0w7CiAgICAgICAg\nbTEubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChsZWRnZXJBLCBtaXNzaW5n\nUmVwbGljYTEpOwogICAgICAgIGZpbmFsIGludCBpdGVyYXRpb25Db3VudCA9\nIDEwMDsKICAgICAgICBmaW5hbCBDb3VudERvd25MYXRjaCBsYXRjaDEgPSBu\nZXcgQ291bnREb3duTGF0Y2goaXRlcmF0aW9uQ291bnQpOwogICAgICAgIGZp\nbmFsIENvdW50RG93bkxhdGNoIGxhdGNoMiA9IG5ldyBDb3VudERvd25MYXRj\naChpdGVyYXRpb25Db3VudCk7CiAgICAgICAgVGhyZWFkIHRocmVhZDEgPSBu\nZXcgVGhyZWFkKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgdGFrZUxl\nZGdlckFuZFJlbGVhc2UobTEsIGxhdGNoMSwgaXRlcmF0aW9uQ291bnQpOwog\nICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgVGhyZWFkIHRocmVh\nZDIgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAg\ndGFrZUxlZGdlckFuZFJlbGVhc2UobTIsIGxhdGNoMiwgaXRlcmF0aW9uQ291\nbnQpOwogICAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB0aHJlYWQx\nLnN0YXJ0KCk7CiAgICAgICAgdGhyZWFkMi5zdGFydCgpOwoKICAgICAgICAv\nLyB3YWl0IHVudGlsIGF0IGxlYXN0IG9uZSB0aHJlYWQgY29tcGxldGVkCiAg\nICAgICAgd2hpbGUgKCFsYXRjaDEuYXdhaXQoNTAsIFRpbWVVbml0Lk1JTExJ\nU0VDT05EUykKICAgICAgICAgICAgICAgICYmICFsYXRjaDIuYXdhaXQoNTAs\nIFRpbWVVbml0Lk1JTExJU0VDT05EUykpIHsKICAgICAgICAgICAgVGhyZWFk\nLnNsZWVwKDUwKTsKICAgICAgICB9CgogICAgICAgIG0xLmNsb3NlKCk7CiAg\nICAgICAgbTIuY2xvc2UoKTsKCiAgICAgICAgLy8gQWZ0ZXIgY29tcGxldGlu\nZyAnbG9jayBhY3F1aXJlLHJlbGVhc2UnIGpvYiwgaXQgc2hvdWxkIG5vdGlm\neSBiZWxvdwogICAgICAgIC8vIHdhaXQKICAgICAgICBsYXRjaDEuYXdhaXQo\nKTsKICAgICAgICBsYXRjaDIuYXdhaXQoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgdmVyaWZpZXMgZmFpbHVyZXMgb2YgYm9va2llcyB3aGljaCBh\ncmUgcmVzZW1ibGluZyBlYWNoIG90aGVyLgogICAgICoKICAgICAqIEJLIHNl\ncnZlcnMgbmFtZWQgbGlrZSoqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqKgogICAgICogMS5jbHVzdGVyLmNvbSwgMi5jbHVz\ndGVyLmNvbSwgMTEuY2x1c3Rlci5jb20sIDEyLmNsdXN0ZXIuY29tCiAgICAg\nKiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqKioqKioqKioqCiAgICAgKgogICAgICogQktzZXJ2\nZXIgSVA6SE9TVCBsaWtlKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqCiAgICAgKiBsb2NhbGhvc3Q6MzE4MSwgbG9jYWxo\nb3N0OjMxOCwgbG9jYWxob3N0OjMxODEyCiAgICAgKiAqKioqKioqKioqKioq\nKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioq\nKioqKioqKioqCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAg\nICBwdWJsaWMgdm9pZCB0ZXN0TWFya1NpbWlsYXJNaXNzaW5nUmVwbGljYSgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExpc3Q8U3RyaW5nPiBtaXNz\naW5nUmVwbGljYSA9IG5ldyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAg\nIG1pc3NpbmdSZXBsaWNhLmFkZCgibG9jYWxob3N0OjMxODEiKTsKICAgICAg\nICBtaXNzaW5nUmVwbGljYS5hZGQoImxvY2FsaG9zdDozMTgiKTsKICAgICAg\nICBtaXNzaW5nUmVwbGljYS5hZGQoImxvY2FsaG9zdDozMTgxMiIpOwogICAg\nICAgIG1pc3NpbmdSZXBsaWNhLmFkZCgiMS5jbHVzdGVyLmNvbSIpOwogICAg\nICAgIG1pc3NpbmdSZXBsaWNhLmFkZCgiMi5jbHVzdGVyLmNvbSIpOwogICAg\nICAgIG1pc3NpbmdSZXBsaWNhLmFkZCgiMTEuY2x1c3Rlci5jb20iKTsKICAg\nICAgICBtaXNzaW5nUmVwbGljYS5hZGQoIjEyLmNsdXN0ZXIuY29tIik7CiAg\nICAgICAgdmVyaWZ5TWFya0xlZGdlclVuZGVycmVwbGljYXRlZChtaXNzaW5n\nUmVwbGljYSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IG11bHRpcGxl\nIGJvb2tpZSBmYWlsdXJlcyBmb3IgYSBsZWRnZXIgYW5kIG1hcmtlZCBhcyB1\nbmRlcnJlcGxpY2F0ZWQKICAgICAqIG9uZSBhZnRlciBhbm90aGVyLgogICAg\nICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQg\ndGVzdE1hbnlGYWlsdXJlc0luQW5FbnNlbWJsZSgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIExpc3Q8U3RyaW5nPiBtaXNzaW5nUmVwbGljYSA9IG5l\ndyBBcnJheUxpc3Q8U3RyaW5nPigpOwogICAgICAgIG1pc3NpbmdSZXBsaWNh\nLmFkZCgibG9jYWxob3N0OjMxODEiKTsKICAgICAgICBtaXNzaW5nUmVwbGlj\nYS5hZGQoImxvY2FsaG9zdDozMTgyIik7CiAgICAgICAgdmVyaWZ5TWFya0xl\nZGdlclVuZGVycmVwbGljYXRlZChtaXNzaW5nUmVwbGljYSk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUZXN0IGRpc2FibGluZyB0aGUgbGVkZ2VyIHJlLXJl\ncGxpY2F0aW9uLiBBZnRlciBkaXNhYmxpbmcsIGl0IHdpbGwgbm90IGJlCiAg\nICAgKiBhYmxlIHRvIGdldExlZGdlclRvUmVyZXBsaWNhdGUoKS4gVGhpcyBj\nYWxscyB3aWxsIGVudGVyIGludG8gaW5maW5pdGUKICAgICAqIHdhaXRpbmcg\ndW50aWwgZW5hYmxpbmcgcmVyZXBsaWNhdGlvbiBwcm9jZXNzCiAgICAgKi8K\nICAgIEBUZXN0KHRpbWVvdXQgPSAyMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRl\nc3REaXNhYmxlTGVkZWdlclJlcGxpY2F0aW9uKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgZmluYWwgTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFn\nZXIgcmVwbGljYU1nciA9IGxtZjEKICAgICAgICAgICAgICAgIC5uZXdMZWRn\nZXJVbmRlcnJlcGxpY2F0aW9uTWFuYWdlcigpOwoKICAgICAgICAvLyBzaW11\nbGF0ZSBmZXcgdXJMZWRnZXJzIGJlZm9yZSBkaXNhYmxpbmcKICAgICAgICBm\naW5hbCBMb25nIGxlZGdlckEgPSAweGZlYWRlZWZkYWNMOwogICAgICAgIGZp\nbmFsIFN0cmluZyBtaXNzaW5nUmVwbGljYSA9ICJsb2NhbGhvc3Q6MzE4MSI7\nCgogICAgICAgIC8vIGRpc2FibGluZyByZXBsaWNhdGlvbgogICAgICAgIHJl\ncGxpY2FNZ3IuZGlzYWJsZUxlZGdlclJlcGxpY2F0aW9uKCk7CiAgICAgICAg\nTE9HLmluZm8oIkRpc2FibGVkIExlZGVnZXIgUmVwbGljYXRpb24iKTsKCiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgcmVwbGljYU1nci5tYXJrTGVkZ2Vy\nVW5kZXJyZXBsaWNhdGVkKGxlZGdlckEsIG1pc3NpbmdSZXBsaWNhKTsKICAg\nICAgICB9IGNhdGNoIChVbmF2YWlsYWJsZUV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIExPRy5kZWJ1ZygiVW5leHBlY3RlZCBleGNlcHRpb24gd2hpbGUg\nbWFya2luZyB1ckxlZGdlciIsIGUpOwogICAgICAgICAgICBmYWlsKCJVbmV4\ncGVjdGVkIGV4Y2VwdGlvbiB3aGlsZSBtYXJraW5nIHVyTGVkZ2VyIiArIGUu\nZ2V0TWVzc2FnZSgpKTsKICAgICAgICB9CgogICAgICAgIEZ1dHVyZTxMb25n\nPiBmQSA9IGdldExlZGdlclRvUmVwbGljYXRlKHJlcGxpY2FNZ3IpOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGZBLmdldCg1LCBUaW1lVW5pdC5TRUNP\nTkRTKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8g\nZmluZCBhIGxlZGdlciB0byByZXBsaWNhdGUiKTsKICAgICAgICB9IGNhdGNo\nIChUaW1lb3V0RXhjZXB0aW9uIHRlKSB7CiAgICAgICAgICAgIC8vIGV4cGVj\ndGVkIGJlaGF2aW91ciwgYXMgdGhlIHJlcGxpY2F0aW9uIGlzIGRpc2FibGVk\nCiAgICAgICAgICAgIGlzTGVkZ2VyUmVwbGljYXRpb25EaXNhYmxlZCA9IGZh\nbHNlOwogICAgICAgIH0KCiAgICAgICAgYXNzZXJ0VHJ1ZSgiTGVkZ2VyIHJl\ncGxpY2F0aW9uIGlzIG5vdCBkaXNhYmxlZCEiLAogICAgICAgICAgICAgICAg\nIWlzTGVkZ2VyUmVwbGljYXRpb25EaXNhYmxlZCk7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUZXN0IGVuYWJsaW5nIHRoZSBsZWRnZXIgcmUtcmVwbGljYXRp\nb24uIEFmdGVyIGVuYWJsZUxlZGVnZXJSZXBsaWNhdGlvbiwKICAgICAqIHNo\nb3VsZCBjb250aW51ZSBnZXRMZWRnZXJUb1JlcmVwbGljYXRlKCkgdGFzawog\nICAgICovCiAgICBAVGVzdCh0aW1lb3V0ID0gMjAwMDApCiAgICBwdWJsaWMg\ndm9pZCB0ZXN0RW5hYmxlTGVkZWdlclJlcGxpY2F0aW9uKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgaXNMZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVk\nID0gdHJ1ZTsKICAgICAgICBmaW5hbCBMZWRnZXJVbmRlcnJlcGxpY2F0aW9u\nTWFuYWdlciByZXBsaWNhTWdyID0gbG1mMQogICAgICAgICAgICAgICAgLm5l\nd0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7CgogICAgICAgIC8v\nIHNpbXVsYXRlIGZldyB1ckxlZGdlcnMgYmVmb3JlIGRpc2FibGluZwogICAg\nICAgIGZpbmFsIExvbmcgbGVkZ2VyQSA9IDB4ZmVhZGVlZmRhY0w7CiAgICAg\nICAgZmluYWwgU3RyaW5nIG1pc3NpbmdSZXBsaWNhID0gImxvY2FsaG9zdDoz\nMTgxIjsKICAgICAgICB0cnkgewogICAgICAgICAgICByZXBsaWNhTWdyLm1h\ncmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobGVkZ2VyQSwgbWlzc2luZ1JlcGxp\nY2EpOwogICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmRlYnVnKCJVbmV4cGVjdGVkIGV4Y2VwdGlv\nbiB3aGlsZSBtYXJraW5nIHVyTGVkZ2VyIiwgZSk7CiAgICAgICAgICAgIGZh\naWwoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIHdoaWxlIG1hcmtpbmcgdXJMZWRn\nZXIiICsgZS5nZXRNZXNzYWdlKCkpOwogICAgICAgIH0KCiAgICAgICAgLy8g\nZGlzYWJsaW5nIHJlcGxpY2F0aW9uCiAgICAgICAgcmVwbGljYU1nci5kaXNh\nYmxlTGVkZ2VyUmVwbGljYXRpb24oKTsKICAgICAgICBMT0cuZGVidWcoIkRp\nc2FibGVkIExlZGVnZXIgUmVwbGljYXRpb24iKTsKCiAgICAgICAgU3RyaW5n\nIHpub2RlQSA9IGdldFVyTGVkZ2VyWm5vZGUobGVkZ2VyQSk7CiAgICAgICAg\nZmluYWwgQ291bnREb3duTGF0Y2ggem5vZGVMYXRjaCA9IG5ldyBDb3VudERv\nd25MYXRjaCgyKTsKICAgICAgICBTdHJpbmcgdXJsZWRnZXJBID0gU3RyaW5n\nVXRpbHMuc3Vic3RyaW5nQWZ0ZXJMYXN0KHpub2RlQSwgIi8iKTsKICAgICAg\nICBTdHJpbmcgdXJMb2NrTGVkZ2VyQSA9IGJhc2VQYXRoICsgIi9sb2Nrcy8i\nICsgdXJsZWRnZXJBOwogICAgICAgIHprYzEuZXhpc3RzKHVyTG9ja0xlZGdl\nckEsIG5ldyBXYXRjaGVyKCl7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAg\nICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBldmVu\ndCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKSA9PSBF\ndmVudFR5cGUuTm9kZUNyZWF0ZWQpIHsKICAgICAgICAgICAgICAgICAgICB6\nbm9kZUxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgIExP\nRy5kZWJ1ZygiUmVjaWV2ZWQgbm9kZSBjcmVhdGlvbiBldmVudCBmb3IgdGhl\nIHpOb2RlUGF0aDoiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICArIGV2\nZW50LmdldFBhdGgoKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAKICAgICAgICAgICAgfX0pOwogICAgICAgIC8vIGdldExlZGdlclRv\nUmVyZXBsaWNhdGUgaXMgd2FpdGluZyB1bnRpbCBlbmFibGUgcmVyZXBsaWNh\ndGlvbgogICAgICAgIFRocmVhZCB0aHJlYWQxID0gbmV3IFRocmVhZCgpIHsK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIHJ1bigpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgTG9uZyBsQSA9IHJlcGxpY2FNZ3IuZ2V0TGVkZ2VyVG9SZXJlcGxp\nY2F0ZSgpOwogICAgICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscygiU2hv\ndWxkIGJlIHRoZSBsZWRnZXIgSSBqdXN0IG1hcmtlZCIsIGxBLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyQSk7CiAgICAgICAgICAgICAg\nICAgICAgaXNMZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVkID0gZmFsc2U7CiAg\nICAgICAgICAgICAgICAgICAgem5vZGVMYXRjaC5jb3VudERvd24oKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKFVuYXZhaWxhYmxlRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlVuZXhwZWN0ZWQg\nZXhjZXB0aW9uIHdoaWxlIG1hcmtpbmcgdXJMZWRnZXIiLCBlKTsKICAgICAg\nICAgICAgICAgICAgICBpc0xlZGdlclJlcGxpY2F0aW9uRGlzYWJsZWQgPSBm\nYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH07CiAgICAgICAgdGhyZWFkMS5zdGFydCgpOwoKICAgICAgICB0cnkgewog\nICAgICAgICAgICB6bm9kZUxhdGNoLmF3YWl0KDUsIFRpbWVVbml0LlNFQ09O\nRFMpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJMZWRnZXIgcmVwbGljYXRp\nb24gaXMgbm90IGRpc2FibGVkISIsCiAgICAgICAgICAgICAgICAgICAgaXNM\nZWRnZXJSZXBsaWNhdGlvbkRpc2FibGVkKTsKICAgICAgICAgICAgYXNzZXJ0\nRXF1YWxzKCJGYWlsZWQgdG8gZGlzYWJsZSBsZWRnZXIgcmVwbGljYXRpb24h\nIiwgMiwgem5vZGVMYXRjaAogICAgICAgICAgICAgICAgICAgIC5nZXRDb3Vu\ndCgpKTsKCiAgICAgICAgICAgIHJlcGxpY2FNZ3IuZW5hYmxlTGVkZ2VyUmVw\nbGljYXRpb24oKTsKICAgICAgICAgICAgem5vZGVMYXRjaC5hd2FpdCg1LCBU\naW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJFbmFi\nbGVkIExlZGVnZXIgUmVwbGljYXRpb24iKTsKICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZSgiTGVkZ2VyIHJlcGxpY2F0aW9uIGlzIG5vdCBkaXNhYmxlZCEiLAog\nICAgICAgICAgICAgICAgICAgICFpc0xlZGdlclJlcGxpY2F0aW9uRGlzYWJs\nZWQpOwogICAgICAgICAgICBhc3NlcnRFcXVhbHMoIkZhaWxlZCB0byBkaXNh\nYmxlIGxlZGdlciByZXBsaWNhdGlvbiEiLCAwLCB6bm9kZUxhdGNoCiAgICAg\nICAgICAgICAgICAgICAgLmdldENvdW50KCkpOwogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHRocmVhZDEuaW50ZXJydXB0KCk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IHRoZSBoaWVyYXJj\naHkgZ2V0cyBjbGVhbmVkIHVwIGFzIGxlZGdlcnMKICAgICAqIGFyZSBtYXJr\nZWQgYXMgZnVsbHkgcmVwbGljYXRlZAogICAgICovCiAgICBAVGVzdCh0aW1l\nb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVzdEhpZXJhcmNoeUNsZWFu\ndXAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBmaW5hbCBMZWRnZXJV\nbmRlcnJlcGxpY2F0aW9uTWFuYWdlciByZXBsaWNhTWdyID0gbG1mMQogICAg\nICAgICAgICAubmV3TGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsK\nICAgICAgICAvLyA0IGxlZGdlcnMsIDIgaW4gdGhlIHNhbWUgaGllcmFyY2h5\nCiAgICAgICAgbG9uZ1tdIGxlZGdlcnMgPSB7IDB4MDAwMDAwMDBkZWFkYmVl\nZkwsIDB4MDAwMDAwMDBkZWFkYmVlZUwsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgIDB4MDAwMDAwMDBiZWVmY2FmZUwsIDB4MDAwMDAwMDBjYWZlZDAw\nZEwgfTsKCiAgICAgICAgZm9yIChsb25nIGwgOiBsZWRnZXJzKSB7CiAgICAg\nICAgICAgIHJlcGxpY2FNZ3IubWFya0xlZGdlclVuZGVycmVwbGljYXRlZChs\nLCAibG9jYWxob3N0OjMxODEiKTsKICAgICAgICB9CiAgICAgICAgLy8gY2Fu\nJ3Qgc2ltcGx5IHRlc3QgdG9wIGxldmVsIGFzIHdlIGFyZSBsaW1pdGVkIHRv\nIGxlZGdlcgogICAgICAgIC8vIGlkcyBubyBsYXJnZXIgdGhhbiBhbiBpbnQK\nICAgICAgICBTdHJpbmcgdGVzdFBhdGggPSB1ckxlZGdlclBhdGggKyAiLzAw\nMDAvMDAwMCI7CiAgICAgICAgTGlzdDxTdHJpbmc+IGNoaWxkcmVuID0gemtj\nMS5nZXRDaGlsZHJlbih0ZXN0UGF0aCwgZmFsc2UpOwogICAgICAgIGFzc2Vy\ndEVxdWFscygiV3JvbmcgbnVtYmVyIG9mIGhpZXJhcmNoaWVzIiwgMywgY2hp\nbGRyZW4uc2l6ZSgpKTsKCiAgICAgICAgaW50IG1hcmtlZCA9IDA7CiAgICAg\nICAgd2hpbGUgKG1hcmtlZCA8IDMpIHsKICAgICAgICAgICAgbG9uZyBsID0g\ncmVwbGljYU1nci5nZXRMZWRnZXJUb1JlcmVwbGljYXRlKCk7CiAgICAgICAg\nICAgIGlmIChsICE9IGxlZGdlcnNbMF0pIHsKICAgICAgICAgICAgICAgIHJl\ncGxpY2FNZ3IubWFya0xlZGdlclJlcGxpY2F0ZWQobCk7CiAgICAgICAgICAg\nICAgICBtYXJrZWQrKzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAg\nICAgICAgIHJlcGxpY2FNZ3IucmVsZWFzZVVuZGVycmVwbGljYXRlZExlZGdl\ncihsKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjaGlsZHJl\nbiA9IHprYzEuZ2V0Q2hpbGRyZW4odGVzdFBhdGgsIGZhbHNlKTsKICAgICAg\nICBhc3NlcnRFcXVhbHMoIldyb25nIG51bWJlciBvZiBoaWVyYXJjaGllcyIs\nIDEsIGNoaWxkcmVuLnNpemUoKSk7CgogICAgICAgIGxvbmcgbCA9IHJlcGxp\nY2FNZ3IuZ2V0TGVkZ2VyVG9SZXJlcGxpY2F0ZSgpOwogICAgICAgIGFzc2Vy\ndEVxdWFscygiR290IHdyb25nIGxlZGdlciIsIGxlZGdlcnNbMF0sIGwpOwog\nICAgICAgIHJlcGxpY2FNZ3IubWFya0xlZGdlclJlcGxpY2F0ZWQobCk7Cgog\nICAgICAgIGNoaWxkcmVuID0gemtjMS5nZXRDaGlsZHJlbih1ckxlZGdlclBh\ndGgsIGZhbHNlKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkFsbCBoaWVyYXJj\naGllcyBzaG91bGQgYmUgY2xlYW5lZCB1cCIsIDAsIGNoaWxkcmVuLnNpemUo\nKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgYXMgdGhlIGhp\nZXJhcmNoeSBnZXRzIGNsZWFuZWQgdXAsIGl0IGRvZXNuJ3QgaW50ZXJmZXJl\nCiAgICAgKiB3aXRoIHRoZSBtYXJraW5nIG9mIG90aGVyIGxlZGdlcnMgYXMg\ndW5kZXJyZXBsaWNhdGVkCiAgICAgKi8KICAgIEBUZXN0KHRpbWVvdXQgPSA5\nMDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RIaWVyYXJjaHlDbGVhbnVwSW50\nZXJmZXJlbmNlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgZmluYWwg\nTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgcmVwbGljYU1ncjEgPSBs\nbWYxCiAgICAgICAgICAgIC5uZXdMZWRnZXJVbmRlcnJlcGxpY2F0aW9uTWFu\nYWdlcigpOwogICAgICAgIGZpbmFsIExlZGdlclVuZGVycmVwbGljYXRpb25N\nYW5hZ2VyIHJlcGxpY2FNZ3IyID0gbG1mMgogICAgICAgICAgICAubmV3TGVk\nZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIoKTsKCiAgICAgICAgZmluYWwg\naW50IGl0ZXJhdGlvbnMgPSAxMDAwOwogICAgICAgIGZpbmFsIEF0b21pY0Jv\nb2xlYW4gdGhyZWFkRmFpbGVkID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2Up\nOwogICAgICAgIFRocmVhZCBtYXJrVW5kZXIgPSBuZXcgVGhyZWFkKCkgewog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICAgICAgICAgIGxvbmcgbCA9IDE7CiAgICAgICAgICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBpdGVyYXRpb25zOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHJlcGxpY2FNZ3IxLm1hcmtMZWRnZXJVbmRlcnJlcGxpY2F0ZWQobCwg\nImxvY2FsaG9zdDozMTgxIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsICs9IDEwMDAwOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJtYXJrVW5kZXIgVGhyZWFk\nIGZhaWxlZCB3aXRoIGV4Y2VwdGlvbiIsIGUpOwogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJlYWRGYWlsZWQuc2V0KHRydWUpOwogICAgICAgICAgICAg\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIGZpbmFsIEF0\nb21pY0ludGVnZXIgcHJvY2Vzc2VkID0gbmV3IEF0b21pY0ludGVnZXIoMCk7\nCiAgICAgICAgVGhyZWFkIG1hcmtSZXBsID0gbmV3IFRocmVhZCgpIHsKICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGl0ZXJhdGlvbnM7IGkrKykgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9uZyBsID0gcmVwbGljYU1ncjIuZ2V0TGVkZ2Vy\nVG9SZXJlcGxpY2F0ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ncmVwbGljYU1ncjIubWFya0xlZGdlclJlcGxpY2F0ZWQobCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQuaW5jcmVtZW50QW5kR2V0\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICBMT0cuZXJyb3IoIm1hcmtSZXBsIFRocmVhZCBmYWlsZWQgd2l0\naCBleGNlcHRpb24iLCBlKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhy\nZWFkRmFpbGVkLnNldCh0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfTsKICAgICAgICBtYXJrUmVwbC5zZXREYWVtb24o\ndHJ1ZSk7CiAgICAgICAgbWFya1VuZGVyLnNldERhZW1vbih0cnVlKTsKCiAg\nICAgICAgbWFya1JlcGwuc3RhcnQoKTsKICAgICAgICBtYXJrVW5kZXIuc3Rh\ncnQoKTsKICAgICAgICBtYXJrVW5kZXIuam9pbigpOwogICAgICAgIGFzc2Vy\ndEZhbHNlKCJUaHJlYWQgZmFpbGVkIHRvIGNvbXBsZXRlIiwgdGhyZWFkRmFp\nbGVkLmdldCgpKTsKCiAgICAgICAgaW50IGxhc3RQcm9jZXNzZWQgPSAwOwog\nICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIG1hcmtSZXBsLmpv\naW4oMTAwMDApOwogICAgICAgICAgICBpZiAoIW1hcmtSZXBsLmlzQWxpdmUo\nKSkgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgYXNzZXJ0RmFsc2UoIm1hcmtSZXBsIHRocmVhZCBub3QgcHJv\nZ3Jlc3NpbmciLCBsYXN0UHJvY2Vzc2VkID09IHByb2Nlc3NlZC5nZXQoKSk7\nCiAgICAgICAgfQogICAgICAgIGFzc2VydEZhbHNlKCJUaHJlYWQgZmFpbGVk\nIHRvIGNvbXBsZXRlIiwgdGhyZWFkRmFpbGVkLmdldCgpKTsKCiAgICAgICAg\nTGlzdDxTdHJpbmc+IGNoaWxkcmVuID0gemtjMS5nZXRDaGlsZHJlbih1ckxl\nZGdlclBhdGgsIGZhbHNlKTsKICAgICAgICBmb3IgKFN0cmluZyBzIDogY2hp\nbGRyZW4pIHsKICAgICAgICAgICAgTE9HLmluZm8oInM6IHt9Iiwgcyk7CiAg\nICAgICAgfQogICAgICAgIGFzc2VydEVxdWFscygiQWxsIGhpZXJhcmNoaWVz\nIHNob3VsZCBiZSBjbGVhbmVkIHVwIiwgMCwgY2hpbGRyZW4uc2l6ZSgpKTsK\nICAgIH0KCiAgICBwcml2YXRlIHZvaWQgdmVyaWZ5TWFya0xlZGdlclVuZGVy\ncmVwbGljYXRlZChDb2xsZWN0aW9uPFN0cmluZz4gbWlzc2luZ1JlcGxpY2Ep\nCiAgICAgICAgICAgIHRocm93cyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVw\ndGVkRXhjZXB0aW9uLAogICAgICAgICAgICBDb21wYXRpYmlsaXR5RXhjZXB0\naW9uLCBVbmF2YWlsYWJsZUV4Y2VwdGlvbiB7CiAgICAgICAgTG9uZyBsZWRn\nZXJBID0gMHhmZWFkZWVmZGFjTDsKICAgICAgICBTdHJpbmcgem5vZGVBID0g\nZ2V0VXJMZWRnZXJabm9kZShsZWRnZXJBKTsKICAgICAgICBMZWRnZXJVbmRl\ncnJlcGxpY2F0aW9uTWFuYWdlciByZXBsaWNhTWdyID0gbG1mMQogICAgICAg\nICAgICAgICAgLm5ld0xlZGdlclVuZGVycmVwbGljYXRpb25NYW5hZ2VyKCk7\nCiAgICAgICAgZm9yIChTdHJpbmcgcmVwbGljYSA6IG1pc3NpbmdSZXBsaWNh\nKSB7CiAgICAgICAgICAgIHJlcGxpY2FNZ3IubWFya0xlZGdlclVuZGVycmVw\nbGljYXRlZChsZWRnZXJBLCByZXBsaWNhKTsKICAgICAgICB9CgogICAgICAg\nIFN0cmluZyB1ckxlZGdlckEgPSBnZXREYXRhKHpub2RlQSk7CiAgICAgICAg\nVW5kZXJyZXBsaWNhdGVkTGVkZ2VyRm9ybWF0LkJ1aWxkZXIgYnVpbGRlckEg\nPSBVbmRlcnJlcGxpY2F0ZWRMZWRnZXJGb3JtYXQKICAgICAgICAgICAgICAg\nIC5uZXdCdWlsZGVyKCk7CiAgICAgICAgZm9yIChTdHJpbmcgcmVwbGljYSA6\nIG1pc3NpbmdSZXBsaWNhKSB7CiAgICAgICAgICAgIGJ1aWxkZXJBLmFkZFJl\ncGxpY2EocmVwbGljYSk7CiAgICAgICAgfQogICAgICAgIExpc3Q8U3RyaW5n\nPiByZXBsaWNhTGlzdCA9IGJ1aWxkZXJBLmdldFJlcGxpY2FMaXN0KCk7Cgog\nICAgICAgIGZvciAoU3RyaW5nIHJlcGxpY2EgOiBtaXNzaW5nUmVwbGljYSkg\newogICAgICAgICAgICBhc3NlcnRUcnVlKCJVckxlZGdlcjoiICsgdXJMZWRn\nZXJBCiAgICAgICAgICAgICAgICAgICAgKyAiIGRvZXNuJ3QgY29udGFpbiBm\nYWlsZWQgYm9va2llIDoiICsgcmVwbGljYSwgcmVwbGljYUxpc3QKICAgICAg\nICAgICAgICAgICAgICAuY29udGFpbnMocmVwbGljYSkpOwogICAgICAgIH0K\nICAgIH0KCiAgICBwcml2YXRlIFN0cmluZyBnZXREYXRhKFN0cmluZyB6bm9k\nZSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJ5dGVbXSBkYXRhID0g\nemtjMS5nZXREYXRhKHpub2RlLCBmYWxzZSwgbnVsbCk7CiAgICAgICAgICAg\nIHJldHVybiBuZXcgU3RyaW5nKGRhdGEpOwogICAgICAgIH0gY2F0Y2ggKEtl\nZXBlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXhj\nZXB0aW9uIHdoaWxlIHJlYWRpbmcgZGF0YSBmcm9tIHpub2RlIDoiICsgem5v\nZGUpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gd2hpbGUgcmVh\nZGluZyBkYXRhIGZyb20gem5vZGUgOiIgKyB6bm9kZSk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiAiIjsKCiAgICB9CgogICAgcHJpdmF0ZSBTdHJpbmcg\nZ2V0VXJMZWRnZXJabm9kZShsb25nIGxlZGdlcklkKSB7CiAgICAgICAgcmV0\ndXJuIFprTGVkZ2VyVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIuZ2V0VXJMZWRn\nZXJabm9kZSh1ckxlZGdlclBhdGgsIGxlZGdlcklkKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgdGFrZUxlZGdlckFuZFJlbGVhc2UoZmluYWwgTGVkZ2Vy\nVW5kZXJyZXBsaWNhdGlvbk1hbmFnZXIgbSwKICAgICAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggbGF0Y2gsIGludCBudW1iZXJPZkl0ZXJhdGlvbnMp\nIHsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bWJlck9mSXRlcmF0\naW9uczsgaSsrKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBsb25nIGxlZGdlclRvUmVyZXBsaWNhdGUgPSBtLmdldExlZGdlclRvUmVy\nZXBsaWNhdGUoKTsKICAgICAgICAgICAgICAgIG0ucmVsZWFzZVVuZGVycmVw\nbGljYXRlZExlZGdlcihsZWRnZXJUb1JlcmVwbGljYXRlKTsKICAgICAgICAg\nICAgfSBjYXRjaCAoVW5hdmFpbGFibGVFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJVbmF2YWlsYWJsZUV4Y2VwdGlvbiB3aGVu\nICIKICAgICAgICAgICAgICAgICAgICAgICAgKyAidGFraW5nIG9yIHJlbGVh\nc2luZyBsb2NrIiwgZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGF0\nY2guY291bnREb3duKCk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

