{"sha":"a6c3307f49daff62357d35f665a2de96c0cf91d7","node_id":"MDQ6QmxvYjE1NzU5NTY6YTZjMzMwN2Y0OWRhZmY2MjM1N2QzNWY2NjVhMmRlOTZjMGNmOTFkNw==","size":18701,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a6c3307f49daff62357d35f665a2de96c0cf91d7","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0\nLkluZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7\nCmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRp\nbC5NYXAuRW50cnk7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3Vu\ndERvd25MYXRjaDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVV\nbml0OwoKaW1wb3J0IGp1bml0LmZyYW1ld29yay5UZXN0Q2FzZTsKCmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuQm9va2llRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2Vl\ncGVyVGVzdENsaWVudDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nb25mLkFic3RyYWN0Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLm1ldGFzdG9yZS5Jbk1l\nbW9yeU1ldGFTdG9yZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5Cb29raWVTZXJ2ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIucmVwbGljYXRpb24uQXV0b1JlY292ZXJ5TWFpbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5yZXBsaWNhdGlvbi5BdWRpdG9yOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLnJlcGxpY2F0aW9uLlJlcGxpY2F0aW9u\nRXhjZXB0aW9uLkNvbXBhdGliaWxpdHlFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmJvb2trZWVwZXIucmVwbGljYXRpb24uUmVwbGljYXRpb25FeGNl\ncHRpb24uVW5hdmFpbGFibGVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLmNvbW1vbnMuaW8uRmlsZVV0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuS2VlcGVyRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmp1bml0LkFmdGVyOwppbXBv\ncnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgogKiBBIGNs\nYXNzIHJ1bnMgc2V2ZXJhbCBib29raWUgc2VydmVycyBmb3IgdGVzdGluZy4K\nICovCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBCb29rS2VlcGVyQ2x1c3RlclRl\nc3RDYXNlIGV4dGVuZHMgVGVzdENhc2UgewoKICAgIHN0YXRpYyBmaW5hbCBM\nb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va0tlZXBl\nckNsdXN0ZXJUZXN0Q2FzZS5jbGFzcyk7CgogICAgLy8gWm9vS2VlcGVyIHJl\nbGF0ZWQgdmFyaWFibGVzCiAgICBwcm90ZWN0ZWQgWm9vS2VlcGVyVXRpbCB6\na1V0aWwgPSBuZXcgWm9vS2VlcGVyVXRpbCgpOwogICAgcHJvdGVjdGVkIFpv\nb0tlZXBlciB6a2M7CgogICAgLy8gQm9va0tlZXBlciByZWxhdGVkIHZhcmlh\nYmxlcwogICAgcHJvdGVjdGVkIExpc3Q8RmlsZT4gdG1wRGlycyA9IG5ldyBM\naW5rZWRMaXN0PEZpbGU+KCk7CiAgICBwcm90ZWN0ZWQgTGlzdDxCb29raWVT\nZXJ2ZXI+IGJzID0gbmV3IExpbmtlZExpc3Q8Qm9va2llU2VydmVyPigpOwog\nICAgcHJvdGVjdGVkIExpc3Q8U2VydmVyQ29uZmlndXJhdGlvbj4gYnNDb25m\ncyA9IG5ldyBMaW5rZWRMaXN0PFNlcnZlckNvbmZpZ3VyYXRpb24+KCk7CiAg\nICBwcm90ZWN0ZWQgaW50IG51bUJvb2tpZXM7CiAgICBwcm90ZWN0ZWQgQm9v\na0tlZXBlclRlc3RDbGllbnQgYmtjOwoKICAgIHByb3RlY3RlZCBTZXJ2ZXJD\nb25maWd1cmF0aW9uIGJhc2VDb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRp\nb24oKTsKICAgIHByb3RlY3RlZCBDbGllbnRDb25maWd1cmF0aW9uIGJhc2VD\nbGllbnRDb25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oKTsKCiAgICBw\ncml2YXRlIE1hcDxCb29raWVTZXJ2ZXIsIEF1dG9SZWNvdmVyeU1haW4+IGF1\ndG9SZWNvdmVyeVByb2Nlc3NlcyA9IG5ldyBIYXNoTWFwPEJvb2tpZVNlcnZl\nciwgQXV0b1JlY292ZXJ5TWFpbj4oKTsKCiAgICBwcml2YXRlIGJvb2xlYW4g\naXNBdXRvUmVjb3ZlcnlFbmFibGVkOwoKICAgIHB1YmxpYyBCb29rS2VlcGVy\nQ2x1c3RlclRlc3RDYXNlKGludCBudW1Cb29raWVzKSB7CiAgICAgICAgdGhp\ncy5udW1Cb29raWVzID0gbnVtQm9va2llczsKICAgIH0KCiAgICBAQmVmb3Jl\nCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHNldFVwKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgTE9HLmluZm8oIlNldHRpbmcgdXAgdGVz\ndCB7fSIsIGdldE5hbWUoKSk7CiAgICAgICAgSW5NZW1vcnlNZXRhU3RvcmUu\ncmVzZXQoKTsKICAgICAgICBzZXRNZXRhc3RvcmVJbXBsQ2xhc3MoYmFzZUNv\nbmYpOwogICAgICAgIHNldE1ldGFzdG9yZUltcGxDbGFzcyhiYXNlQ2xpZW50\nQ29uZik7CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIHN0YXJ0IHpv\nb2tlZXBlciBzZXJ2aWNlCiAgICAgICAgICAgIHN0YXJ0WktDbHVzdGVyKCk7\nCiAgICAgICAgICAgIC8vIHN0YXJ0IGJvb2trZWVwZXIgc2VydmljZQogICAg\nICAgICAgICBzdGFydEJLQ2x1c3RlcigpOwogICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3Igc2V0\ndGluZyB1cCIsIGUpOwogICAgICAgICAgICB0aHJvdyBlOwogICAgICAgIH0K\nICAgIH0KCiAgICBAQWZ0ZXIKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZv\naWQgdGVhckRvd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMT0cu\naW5mbygiVGVhckRvd24iKTsKICAgICAgICAvLyBzdG9wIGJvb2trZWVwZXIg\nc2VydmljZQogICAgICAgIHN0b3BCS0NsdXN0ZXIoKTsKICAgICAgICAvLyBz\ndG9wIHpvb2tlZXBlciBzZXJ2aWNlCiAgICAgICAgc3RvcFpLQ2x1c3Rlcigp\nOwogICAgICAgIExPRy5pbmZvKCJUZWFyaW5nIGRvd24gdGVzdCB7fSIsIGdl\ndE5hbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBTdGFydCB6b29rZWVw\nZXIgY2x1c3RlcgogICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAg\nICAgKi8KICAgIHByb3RlY3RlZCB2b2lkIHN0YXJ0WktDbHVzdGVyKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgemtVdGlsLnN0YXJ0U2VydmVyKCk7\nCiAgICAgICAgemtjID0gemtVdGlsLmdldFpvb0tlZXBlckNsaWVudCgpOwog\nICAgfQoKICAgIC8qKgogICAgICogU3RvcCB6b29rZWVwZXIgY2x1c3Rlcgog\nICAgICoKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCB2b2lkIHN0b3BaS0NsdXN0ZXIoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICB6a1V0aWwua2lsbFNlcnZlcigpOwogICAgfQoKICAgIC8q\nKgogICAgICogU3RhcnQgY2x1c3Rlci4gQWxzbywgc3RhcnRzIHRoZSBhdXRv\nIHJlY292ZXJ5IHByb2Nlc3MgZm9yIGVhY2ggYm9va2llLCBpZgogICAgICog\naXNBdXRvUmVjb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAgICAgKgogICAgICog\nQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQg\nc3RhcnRCS0NsdXN0ZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBi\nYXNlQ2xpZW50Q29uZi5zZXRaa1NlcnZlcnMoemtVdGlsLmdldFpvb0tlZXBl\nckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAgaWYgKG51bUJvb2tpZXMgPiAw\nKSB7CiAgICAgICAgICAgIGJrYyA9IG5ldyBCb29rS2VlcGVyVGVzdENsaWVu\ndChiYXNlQ2xpZW50Q29uZik7CiAgICAgICAgfQoKICAgICAgICAvLyBDcmVh\ndGUgQm9va2llIFNlcnZlcnMgKEIxLCBCMiwgQjMpCiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBudW1Cb29raWVzOyBpKyspIHsKICAgICAgICAgICAg\nc3RhcnROZXdCb29raWUoKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBTdG9wIGNsdXN0ZXIuIEFsc28sIHN0b3BzIGFsbCB0aGUgYXV0byBy\nZWNvdmVyeSBwcm9jZXNzZXMgZm9yIHRoZSBib29raWUKICAgICAqIGNsdXN0\nZXIsIGlmIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBpcyB0cnVlLgogICAgICoK\nICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAgKi8KICAgIHByb3RlY3Rl\nZCB2b2lkIHN0b3BCS0NsdXN0ZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAoYmtjICE9IG51bGwpIHsKICAgICAgICAgICAgYmtjLmNsb3Nl\nKCk7OwogICAgICAgIH0KCiAgICAgICAgZm9yIChCb29raWVTZXJ2ZXIgc2Vy\ndmVyIDogYnMpIHsKICAgICAgICAgICAgc2VydmVyLnNodXRkb3duKCk7CiAg\nICAgICAgICAgIEF1dG9SZWNvdmVyeU1haW4gYXV0b1JlY292ZXJ5ID0gYXV0\nb1JlY292ZXJ5UHJvY2Vzc2VzLmdldChzZXJ2ZXIpOwogICAgICAgICAgICBp\nZiAoYXV0b1JlY292ZXJ5ICE9IG51bGwgJiYgaXNBdXRvUmVjb3ZlcnlFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgICAgIGF1dG9SZWNvdmVyeS5zaHV0ZG93\nbigpOwogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJTaHV0ZG93biBhdXRv\nIHJlY292ZXJ5IGZvciBib29raWVzZXJ2ZXI6IgogICAgICAgICAgICAgICAg\nICAgICAgICArIHNlcnZlci5nZXRMb2NhbEFkZHJlc3MoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICAgICAgYnMuY2xlYXIoKTsKICAgICAgICBm\nb3IgKEZpbGUgZiA6IHRtcERpcnMpIHsKICAgICAgICAgICAgRmlsZVV0aWxz\nLmRlbGV0ZURpcmVjdG9yeShmKTsKICAgICAgICB9CiAgICB9CgogICAgcHJv\ndGVjdGVkIFNlcnZlckNvbmZpZ3VyYXRpb24gbmV3U2VydmVyQ29uZmlndXJh\ndGlvbigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgZiA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJ0ZXN0Iik7CiAgICAgICAg\ndG1wRGlycy5hZGQoZik7CiAgICAgICAgZi5kZWxldGUoKTsKICAgICAgICBm\nLm1rZGlyKCk7CgogICAgICAgIGludCBwb3J0ID0gUG9ydE1hbmFnZXIubmV4\ndEZyZWVQb3J0KCk7CiAgICAgICAgcmV0dXJuIG5ld1NlcnZlckNvbmZpZ3Vy\nYXRpb24ocG9ydCwgemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmco\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLCBu\nZXcgRmlsZVtdIHsgZiB9KTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgU2VydmVy\nQ29uZmlndXJhdGlvbiBuZXdTZXJ2ZXJDb25maWd1cmF0aW9uKGludCBwb3J0\nLCBTdHJpbmcgemtTZXJ2ZXJzLCBGaWxlIGpvdXJuYWxEaXIsIEZpbGVbXSBs\nZWRnZXJEaXJzKSB7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlvbiBjb25m\nID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oYmFzZUNvbmYpOwogICAgICAg\nIGNvbmYuc2V0Qm9va2llUG9ydChwb3J0KTsKICAgICAgICBjb25mLnNldFpr\nU2VydmVycyh6a1NlcnZlcnMpOwogICAgICAgIGNvbmYuc2V0Sm91cm5hbERp\nck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpOwogICAgICAgIGNvbmYuc2V0\nQWxsb3dMb29wYmFjayh0cnVlKTsKICAgICAgICBTdHJpbmdbXSBsZWRnZXJE\naXJOYW1lcyA9IG5ldyBTdHJpbmdbbGVkZ2VyRGlycy5sZW5ndGhdOwogICAg\nICAgIGZvciAoaW50IGk9MDsgaTxsZWRnZXJEaXJzLmxlbmd0aDsgaSsrKSB7\nCiAgICAgICAgICAgIGxlZGdlckRpck5hbWVzW2ldID0gbGVkZ2VyRGlyc1tp\nXS5nZXRQYXRoKCk7CiAgICAgICAgfQogICAgICAgIGNvbmYuc2V0TGVkZ2Vy\nRGlyTmFtZXMobGVkZ2VyRGlyTmFtZXMpOwogICAgICAgIHJldHVybiBjb25m\nOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IGJvb2tpZSBhZGRyZXNzIGZv\nciBib29raWUgYXQgaW5kZXgKICAgICAqLwogICAgcHVibGljIEluZXRTb2Nr\nZXRBZGRyZXNzIGdldEJvb2tpZShpbnQgaW5kZXgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIGlmIChicy5zaXplKCkgPD0gaW5kZXggfHwgaW5kZXgg\nPCAwKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24oIkludmFsaWQgaW5kZXgsIHRoZXJlIGFyZSBvbmx5ICIgKyBi\ncy5zaXplKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICIgYm9va2llcy4gQXNrZWQgZm9yICIgKyBpbmRleCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBicy5nZXQoaW5kZXgpLmdldExv\nY2FsQWRkcmVzcygpOwogICAgfQoKICAgIC8qKgogICAgICogS2lsbCBhIGJv\nb2tpZSBieSBpdHMgc29ja2V0IGFkZHJlc3MuIEFsc28sIHN0b3BzIHRoZSBh\ndXRvcmVjb3ZlcnkgcHJvY2VzcwogICAgICogZm9yIHRoZSBjb3JyZXNwb25k\naW5nIGJvb2tpZSBzZXJ2ZXIsIGlmIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBp\ncyB0cnVlLgogICAgICoKICAgICAqIEBwYXJhbSBhZGRyCiAgICAgKiAgICAg\nICAgICAgIFNvY2tldCBBZGRyZXNzCiAgICAgKiBAcmV0dXJuIHRoZSBjb25m\naWd1cmF0aW9uIG9mIGtpbGxlZCBib29raWUKICAgICAqIEB0aHJvd3MgSW50\nZXJydXB0ZWRFeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIFNlcnZlckNv\nbmZpZ3VyYXRpb24ga2lsbEJvb2tpZShJbmV0U29ja2V0QWRkcmVzcyBhZGRy\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCb29raWVTZXJ2ZXIgdG9S\nZW1vdmUgPSBudWxsOwogICAgICAgIGludCB0b1JlbW92ZUluZGV4ID0gMDsK\nICAgICAgICBmb3IgKEJvb2tpZVNlcnZlciBzZXJ2ZXIgOiBicykgewogICAg\nICAgICAgICBpZiAoc2VydmVyLmdldExvY2FsQWRkcmVzcygpLmVxdWFscyhh\nZGRyKSkgewogICAgICAgICAgICAgICAgc2VydmVyLnNodXRkb3duKCk7CiAg\nICAgICAgICAgICAgICB0b1JlbW92ZSA9IHNlcnZlcjsKICAgICAgICAgICAg\nICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICsrdG9SZW1v\ndmVJbmRleDsKICAgICAgICB9CiAgICAgICAgaWYgKHRvUmVtb3ZlICE9IG51\nbGwpIHsKICAgICAgICAgICAgc3RvcEF1dG9SZWNvdmVyeVNlcnZpY2UodG9S\nZW1vdmUpOwogICAgICAgICAgICBicy5yZW1vdmUodG9SZW1vdmUpOwogICAg\nICAgICAgICByZXR1cm4gYnNDb25mcy5yZW1vdmUodG9SZW1vdmVJbmRleCk7\nCiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIC8q\nKgogICAgICogS2lsbCBhIGJvb2tpZSBieSBpbmRleC4gQWxzbywgc3RvcHMg\ndGhlIHJlc3BlY3RpdmUgYXV0byByZWNvdmVyeSBwcm9jZXNzCiAgICAgKiBm\nb3IgdGhpcyBib29raWUsIGlmIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBpcyB0\ncnVlLgogICAgICoKICAgICAqIEBwYXJhbSBpbmRleAogICAgICogICAgICAg\nICAgICBCb29raWUgSW5kZXgKICAgICAqIEByZXR1cm4gdGhlIGNvbmZpZ3Vy\nYXRpb24gb2Yga2lsbGVkIGJvb2tpZQogICAgICogQHRocm93cyBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbgogICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAg\nICovCiAgICBwdWJsaWMgU2VydmVyQ29uZmlndXJhdGlvbiBraWxsQm9va2ll\nKGludCBpbmRleCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGlu\nZGV4ID49IGJzLnNpemUoKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9F\neGNlcHRpb24oIkJvb2tpZSBkb2VzIG5vdCBleGlzdCIpOwogICAgICAgIH0K\nICAgICAgICBCb29raWVTZXJ2ZXIgc2VydmVyID0gYnMuZ2V0KGluZGV4KTsK\nICAgICAgICBzZXJ2ZXIuc2h1dGRvd24oKTsKICAgICAgICBzdG9wQXV0b1Jl\nY292ZXJ5U2VydmljZShzZXJ2ZXIpOwogICAgICAgIGJzLnJlbW92ZShzZXJ2\nZXIpOwogICAgICAgIHJldHVybiBic0NvbmZzLnJlbW92ZShpbmRleCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBTbGVlcCBhIGJvb2tpZQogICAgICoKICAg\nICAqIEBwYXJhbSBhZGRyCiAgICAgKiAgICAgICAgICBTb2NrZXQgQWRkcmVz\ncwogICAgICogQHBhcmFtIHNlY29uZHMKICAgICAqICAgICAgICAgIFNsZWVw\nIHNlY29uZHMKICAgICAqIEByZXR1cm4gQ291bnQgRG93biBsYXRjaCB3aGlj\naCB3aWxsIGJlIGNvdW50ZWQgZG93biB3aGVuIHNsZWVwIGZpbmlzaGVzCiAg\nICAgKiBAdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhy\nb3dzIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyBDb3VudERvd25M\nYXRjaCBzbGVlcEJvb2tpZShJbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBmaW5h\nbCBpbnQgc2Vjb25kcykKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgZm9yIChmaW5hbCBCb29raWVTZXJ2ZXIgYm9va2llIDogYnMp\nIHsKICAgICAgICAgICAgaWYgKGJvb2tpZS5nZXRMb2NhbEFkZHJlc3MoKS5l\ncXVhbHMoYWRkcikpIHsKICAgICAgICAgICAgICAgIGZpbmFsIENvdW50RG93\nbkxhdGNoIGwgPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgICAg\nICAgICBUaHJlYWQgc2xlZXBlciA9IG5ldyBUaHJlYWQoKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGJvb2tpZS5zdXNwZW5kUHJvY2Vzc2luZygpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGwuY291bnREb3duKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKHNlY29uZHMqMTAwMCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9va2llLnJlc3Vt\nZVByb2Nlc3NpbmcoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBzdXNwZW5kaW5nIGJvb2tpZSIs\nIGUpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfTsKICAgICAg\nICAgICAgICAgIHNsZWVwZXIuc3RhcnQoKTsKICAgICAgICAgICAgICAgIHJl\ndHVybiBsOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbigiQm9va2llIG5vdCBmb3VuZCIpOwogICAgfQoK\nICAgIC8qKgogICAgICogU2xlZXAgYSBib29raWUgdW50aWwgSSBjb3VudCBk\nb3duIHRoZSBsYXRjaAogICAgICoKICAgICAqIEBwYXJhbSBhZGRyCiAgICAg\nKiAgICAgICAgICBTb2NrZXQgQWRkcmVzcwogICAgICogQHBhcmFtIGxhdGNo\nCiAgICAgKiAgICAgICAgICBMYXRjaCB0byB3YWl0IG9uCiAgICAgKiBAdGhy\nb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIElPRXhj\nZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNsZWVwQm9va2llKElu\nZXRTb2NrZXRBZGRyZXNzIGFkZHIsIGZpbmFsIENvdW50RG93bkxhdGNoIGwp\nCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZvciAo\nZmluYWwgQm9va2llU2VydmVyIGJvb2tpZSA6IGJzKSB7CiAgICAgICAgICAg\nIGlmIChib29raWUuZ2V0TG9jYWxBZGRyZXNzKCkuZXF1YWxzKGFkZHIpKSB7\nCiAgICAgICAgICAgICAgICBUaHJlYWQgc2xlZXBlciA9IG5ldyBUaHJlYWQo\nKSB7CiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgYm9va2llLnN1c3BlbmRQcm9jZXNzaW5nKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBsLmF3YWl0KCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBib29raWUucmVzdW1lUHJvY2Vzc2luZygpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJv\nciBzdXNwZW5kaW5nIGJvb2tpZSIsIGUpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nfTsKICAgICAgICAgICAgICAgIHNsZWVwZXIuc3RhcnQoKTsKICAgICAgICAg\nICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkJvb2tpZSBub3QgZm91bmQiKTsK\nICAgIH0KCiAgICAvKioKICAgICAqIFJlc3RhcnQgYm9va2llIHNlcnZlcnMu\nIEFsc28gcmVzdGFydHMgYWxsIHRoZSByZXNwZWN0aXZlIGF1dG8gcmVjb3Zl\ncnkKICAgICAqIHByb2Nlc3MsIGlmIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBp\ncyB0cnVlLgogICAgICoKICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNl\ncHRpb24KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqIEB0aHJv\nd3MgS2VlcGVyRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIEJvb2tpZUV4Y2Vw\ndGlvbgogICAgICovCiAgICBwdWJsaWMgdm9pZCByZXN0YXJ0Qm9va2llcygp\nCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHJlc3Rh\ncnRCb29raWVzKG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogUmVzdGFy\ndCBib29raWUgc2VydmVycyB1c2luZyBuZXcgY29uZmlndXJhdGlvbiBzZXR0\naW5ncy4gQWxzbyByZXN0YXJ0IHRoZQogICAgICogcmVzcGVjdGl2ZSBhdXRv\nIHJlY292ZXJ5IHByb2Nlc3MsIGlmIGlzQXV0b1JlY292ZXJ5RW5hYmxlZCBp\ncyB0cnVlLgogICAgICoKICAgICAqIEBwYXJhbSBuZXdDb25mCiAgICAgKiAg\nICAgICAgICAgIE5ldyBDb25maWd1cmF0aW9uIFNldHRpbmdzCiAgICAgKiBA\ndGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIElP\nRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIEtlZXBlckV4Y2VwdGlvbgogICAg\nICogQHRocm93cyBCb29raWVFeGNlcHRpb24KICAgICAqLwogICAgcHVibGlj\nIHZvaWQgcmVzdGFydEJvb2tpZXMoU2VydmVyQ29uZmlndXJhdGlvbiBuZXdD\nb25mKQogICAgICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAv\nLyBzaHV0IGRvd24gYm9va2llIHNlcnZlcgogICAgICAgIGZvciAoQm9va2ll\nU2VydmVyIHNlcnZlciA6IGJzKSB7CiAgICAgICAgICAgIHNlcnZlci5zaHV0\nZG93bigpOwogICAgICAgICAgICBzdG9wQXV0b1JlY292ZXJ5U2VydmljZShz\nZXJ2ZXIpOwogICAgICAgIH0KICAgICAgICBicy5jbGVhcigpOwogICAgICAg\nIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAgICAvLyByZXN0YXJ0IHRoZW0g\ndG8gZW5zdXJlIHdlIGNhbid0CiAgICAgICAgaW50IGogPSAwOwogICAgICAg\nIGZvciAoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mIDogYnNDb25mcykgewog\nICAgICAgICAgICBpZiAobnVsbCAhPSBuZXdDb25mKSB7CiAgICAgICAgICAg\nICAgICBjb25mLmxvYWRDb25mKG5ld0NvbmYpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGJzLmFkZChzdGFydEJvb2tpZShjb25mKSk7CiAgICAgICAg\nICAgIGorKzsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxw\nZXIgbWV0aG9kIHRvIHN0YXJ0dXAgYSBuZXcgYm9va2llIHNlcnZlciB3aXRo\nIHRoZSBpbmRpY2F0ZWQgcG9ydAogICAgICogbnVtYmVyLiBBbHNvLCBzdGFy\ndHMgdGhlIGF1dG8gcmVjb3ZlcnkgcHJvY2VzcywgaWYgdGhlCiAgICAgKiBp\nc0F1dG9SZWNvdmVyeUVuYWJsZWQgaXMgc2V0IHRydWUuCiAgICAgKgogICAg\nICogQHBhcmFtIHBvcnQKICAgICAqICAgICAgICAgICAgUG9ydCB0byBzdGFy\ndCB0aGUgbmV3IGJvb2tpZSBzZXJ2ZXIgb24KICAgICAqIEB0aHJvd3MgSU9F\neGNlcHRpb24KICAgICAqLwogICAgcHVibGljIGludCBzdGFydE5ld0Jvb2tp\nZSgpCiAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ld1NlcnZlckNvbmZpZ3VyYXRp\nb24oKTsKICAgICAgICBic0NvbmZzLmFkZChjb25mKTsKICAgICAgICBicy5h\nZGQoc3RhcnRCb29raWUoY29uZikpOwoKICAgICAgICByZXR1cm4gY29uZi5n\nZXRCb29raWVQb3J0KCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIg\nbWV0aG9kIHRvIHN0YXJ0dXAgYSBib29raWUgc2VydmVyIHVzaW5nIGEgY29u\nZmlndXJhdGlvbiBvYmplY3QuCiAgICAgKiBBbHNvLCBzdGFydHMgdGhlIGF1\ndG8gcmVjb3ZlcnkgcHJvY2VzcyBpZiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQg\naXMgdHJ1ZS4KICAgICAqCiAgICAgKiBAcGFyYW0gY29uZgogICAgICogICAg\nICAgICAgICBTZXJ2ZXIgQ29uZmlndXJhdGlvbiBPYmplY3QKICAgICAqCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBCb29raWVTZXJ2ZXIgc3RhcnRCb29raWUo\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAgICB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBCb29raWVTZXJ2ZXIgc2VydmVyID0gbmV3\nIEJvb2tpZVNlcnZlcihjb25mKTsKICAgICAgICBzZXJ2ZXIuc3RhcnQoKTsK\nCiAgICAgICAgaW50IHBvcnQgPSBjb25mLmdldEJvb2tpZVBvcnQoKTsKICAg\nICAgICB3aGlsZShia2MuZ2V0WmtIYW5kbGUoKS5leGlzdHMoIi9sZWRnZXJz\nL2F2YWlsYWJsZS8iICsgSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0\nSG9zdEFkZHJlc3MoKSArICI6IiArIHBvcnQsIGZhbHNlKSA9PSBudWxsKSB7\nCiAgICAgICAgICAgIFRocmVhZC5zbGVlcCg1MDApOwogICAgICAgIH0KCiAg\nICAgICAgYmtjLnJlYWRCb29raWVzQmxvY2tpbmcoKTsKICAgICAgICBMT0cu\naW5mbygiTmV3IGJvb2tpZSBvbiBwb3J0ICIgKyBwb3J0ICsgIiBoYXMgYmVl\nbiBjcmVhdGVkLiIpOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBzdGFy\ndEF1dG9SZWNvdmVyeShzZXJ2ZXIsIGNvbmYpOwogICAgICAgIH0gY2F0Y2gg\nKENvbXBhdGliaWxpdHlFeGNlcHRpb24gY2UpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJFeGNlcHRpb24gd2hpbGUgc3RhcnRpbmcgQXV0b1JlY292ZXJ5\nISIsIGNlKTsKICAgICAgICB9IGNhdGNoIChVbmF2YWlsYWJsZUV4Y2VwdGlv\nbiB1ZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiB3aGls\nZSBzdGFydGluZyBBdXRvUmVjb3ZlcnkhIiwgdWUpOwogICAgICAgIH0KICAg\nICAgICByZXR1cm4gc2VydmVyOwogICAgfQoKICAgIC8qKgogICAgICogU3Rh\ncnQgYSBib29raWUgd2l0aCB0aGUgZ2l2ZW4gYm9va2llIGluc3RhbmNlLiBB\nbHNvLCBzdGFydHMgdGhlIGF1dG8KICAgICAqIHJlY292ZXJ5IGZvciB0aGlz\nIGJvb2tpZSwgaWYgaXNBdXRvUmVjb3ZlcnlFbmFibGVkIGlzIHRydWUuCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBCb29raWVTZXJ2ZXIgc3RhcnRCb29raWUo\nU2VydmVyQ29uZmlndXJhdGlvbiBjb25mLCBmaW5hbCBCb29raWUgYikKICAg\nICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQm9va2llU2Vy\ndmVyIHNlcnZlciA9IG5ldyBCb29raWVTZXJ2ZXIoY29uZikgewogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHJvdGVjdGVkIEJvb2tpZSBu\nZXdCb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gYjsKICAgICAgICAgICAgfQogICAgICAgIH07CiAg\nICAgICAgc2VydmVyLnN0YXJ0KCk7CgogICAgICAgIGludCBwb3J0ID0gY29u\nZi5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgd2hpbGUoYmtjLmdldFprSGFu\nZGxlKCkuZXhpc3RzKCIvbGVkZ2Vycy9hdmFpbGFibGUvIiArIEluZXRBZGRy\nZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCkgKyAiOiIgKyBw\nb3J0LCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAgICAgICBUaHJlYWQuc2xl\nZXAoNTAwKTsKICAgICAgICB9CgogICAgICAgIGJrYy5yZWFkQm9va2llc0Js\nb2NraW5nKCk7CiAgICAgICAgTE9HLmluZm8oIk5ldyBib29raWUgb24gcG9y\ndCAiICsgcG9ydCArICIgaGFzIGJlZW4gY3JlYXRlZC4iKTsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBzdGFydEF1dG9SZWNvdmVyeShzZXJ2ZXIsIGNv\nbmYpOwogICAgICAgIH0gY2F0Y2ggKENvbXBhdGliaWxpdHlFeGNlcHRpb24g\nY2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gd2hpbGUg\nc3RhcnRpbmcgQXV0b1JlY292ZXJ5ISIsIGNlKTsKICAgICAgICB9IGNhdGNo\nIChVbmF2YWlsYWJsZUV4Y2VwdGlvbiB1ZSkgewogICAgICAgICAgICBMT0cu\nZXJyb3IoIkV4Y2VwdGlvbiB3aGlsZSBzdGFydGluZyBBdXRvUmVjb3Zlcnkh\nIiwgdWUpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gc2VydmVyOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHNldE1ldGFzdG9yZUltcGxDbGFzcyhBYnN0\ncmFjdENvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgIGNvbmYuc2V0TWV0\nYXN0b3JlSW1wbENsYXNzKEluTWVtb3J5TWV0YVN0b3JlLmNsYXNzLmdldE5h\nbWUoKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBGbGFncyB1c2VkIHRvIGVu\nYWJsZS9kaXNhYmxlIHRoZSBhdXRvIHJlY292ZXJ5IHByb2Nlc3MuIElmIGl0\nIGlzIGVuYWJsZWQsCiAgICAgKiBzdGFydGluZyB0aGUgYm9va2llIHNlcnZl\nciB3aWxsIHN0YXJ0cyB0aGUgYXV0byByZWNvdmVyeSBwcm9jZXNzIGZvciB0\naGF0CiAgICAgKiBib29raWUuIEFsc28sIHN0b3BwaW5nIGJvb2tpZSB3aWxs\nIHN0b3BzIHRoZSByZXNwZWN0aXZlIGF1dG8gcmVjb3ZlcnkKICAgICAqIHBy\nb2Nlc3MuCiAgICAgKgogICAgICogQHBhcmFtIGlzQXV0b1JlY292ZXJ5RW5h\nYmxlZAogICAgICogICAgICAgICAgICBWYWx1ZSB0cnVlIHdpbGwgZW5hYmxl\nIHRoZSBhdXRvIHJlY292ZXJ5IHByb2Nlc3MuIFZhbHVlIGZhbHNlCiAgICAg\nKiAgICAgICAgICAgIHdpbGwgZGlzYWJsZSB0aGUgYXV0byByZWNvdmVyeSBw\ncm9jZXNzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNldEF1dG9SZWNvdmVy\neUVuYWJsZWQoYm9vbGVhbiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQpIHsKICAg\nICAgICB0aGlzLmlzQXV0b1JlY292ZXJ5RW5hYmxlZCA9IGlzQXV0b1JlY292\nZXJ5RW5hYmxlZDsKICAgIH0KCiAgICAvKioKICAgICAqIEZsYWcgdXNlZCB0\nbyBjaGVjayB3aGV0aGVyIGF1dG8gcmVjb3ZlcnkgcHJvY2VzcyBpcyBlbmFi\nbGVkL2Rpc2FibGVkLiBCeQogICAgICogZGVmYXVsdCB0aGUgZmxhZyBpcyBm\nYWxzZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUsIGlmIHRoZSBhdXRv\nIHJlY292ZXJ5IGlzIGVuYWJsZWQuIE90aGVyd2lzZSByZXR1cm4gZmFsc2Uu\nCiAgICAgKi8KICAgIHB1YmxpYyBib29sZWFuIGlzQXV0b1JlY292ZXJ5RW5h\nYmxlZCgpIHsKICAgICAgICByZXR1cm4gaXNBdXRvUmVjb3ZlcnlFbmFibGVk\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzdGFydEF1dG9SZWNvdmVyeShC\nb29raWVTZXJ2ZXIgYnNlcnZlciwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIGlmIChpc0F1dG9SZWNvdmVyeUVuYWJsZWQo\nKSkgewogICAgICAgICAgICBBdXRvUmVjb3ZlcnlNYWluIGF1dG9SZWNvdmVy\neVByb2Nlc3MgPSBuZXcgQXV0b1JlY292ZXJ5TWFpbihjb25mKTsKICAgICAg\nICAgICAgYXV0b1JlY292ZXJ5UHJvY2Vzcy5zdGFydCgpOwogICAgICAgICAg\nICBhdXRvUmVjb3ZlcnlQcm9jZXNzZXMucHV0KGJzZXJ2ZXIsIGF1dG9SZWNv\ndmVyeVByb2Nlc3MpOwogICAgICAgICAgICBMT0cuZGVidWcoIlN0YXJ0aW5n\nIEF1ZGl0b3IgUmVjb3ZlcnkgZm9yIHRoZSBib29raWU6IgogICAgICAgICAg\nICAgICAgICAgICsgYnNlcnZlci5nZXRMb2NhbEFkZHJlc3MoKSk7CiAgICAg\nICAgfQogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzdG9wQXV0b1JlY292ZXJ5\nU2VydmljZShCb29raWVTZXJ2ZXIgdG9SZW1vdmUpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIEF1dG9SZWNvdmVyeU1haW4gYXV0b1JlY292ZXJ5TWFp\nbiA9IGF1dG9SZWNvdmVyeVByb2Nlc3NlcwogICAgICAgICAgICAgICAgLnJl\nbW92ZSh0b1JlbW92ZSk7CiAgICAgICAgaWYgKG51bGwgIT0gYXV0b1JlY292\nZXJ5TWFpbiAmJiBpc0F1dG9SZWNvdmVyeUVuYWJsZWQoKSkgewogICAgICAg\nICAgICBhdXRvUmVjb3ZlcnlNYWluLnNodXRkb3duKCk7CiAgICAgICAgICAg\nIExPRy5kZWJ1ZygiU2h1dGRvd24gYXV0byByZWNvdmVyeSBmb3IgYm9va2ll\nc2VydmVyOiIKICAgICAgICAgICAgICAgICAgICArIHRvUmVtb3ZlLmdldExv\nY2FsQWRkcmVzcygpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBXaWxsIHN0YXJ0cyB0aGUgYXV0byByZWNvdmVyeSBwcm9jZXNzIGZvciB0\naGUgYm9va2llIHNlcnZlcnMuIE9uZSBhdXRvCiAgICAgKiByZWNvdmVyeSBw\ncm9jZXNzIHBlciBlYWNoIGJvb2tpZSBzZXJ2ZXIsIGlmIGlzQXV0b1JlY292\nZXJ5RW5hYmxlZCBpcwogICAgICogZW5hYmxlZC4KICAgICAqLwogICAgcHVi\nbGljIHZvaWQgc3RhcnRSZXBsaWNhdGlvblNlcnZpY2UoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBpbnQgaW5kZXggPSAtMTsKICAgICAgICBmb3Ig\nKEJvb2tpZVNlcnZlciBic2VydmVyIDogYnMpIHsKICAgICAgICAgICAgc3Rh\ncnRBdXRvUmVjb3ZlcnkoYnNlcnZlciwgYnNDb25mcy5nZXQoKytpbmRleCkp\nOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFdpbGwgc3RvcHMg\nYWxsIHRoZSBhdXRvIHJlY292ZXJ5IHByb2Nlc3NlcyBmb3IgdGhlIGJvb2tp\nZSBjbHVzdGVyLCBpZgogICAgICogaXNBdXRvUmVjb3ZlcnlFbmFibGVkIGlz\nIHRydWUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHN0b3BSZXBsaWNhdGlv\nblNlcnZpY2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZihmYWxz\nZSA9PSBpc0F1dG9SZWNvdmVyeUVuYWJsZWQoKSl7CiAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICB9CiAgICAgICAgZm9yIChFbnRyeTxCb29raWVTZXJ2\nZXIsIEF1dG9SZWNvdmVyeU1haW4+IGF1dG9SZWNvdmVyeVByb2Nlc3MgOiBh\ndXRvUmVjb3ZlcnlQcm9jZXNzZXMKICAgICAgICAgICAgICAgIC5lbnRyeVNl\ndCgpKSB7CiAgICAgICAgICAgIGF1dG9SZWNvdmVyeVByb2Nlc3MuZ2V0VmFs\ndWUoKS5zaHV0ZG93bigpOwogICAgICAgICAgICBMT0cuZGVidWcoIlNodXRk\nb3duIEF1ZGl0b3IgUmVjb3ZlcnkgZm9yIHRoZSBib29raWU6IgogICAgICAg\nICAgICAgICAgICAgICsgYXV0b1JlY292ZXJ5UHJvY2Vzcy5nZXRLZXkoKS5n\nZXRMb2NhbEFkZHJlc3MoKSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1Ymxp\nYyBBdWRpdG9yIGdldEF1ZGl0b3IoaW50IHRpbWVvdXQsIFRpbWVVbml0IHVu\naXQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGZpbmFsIGxvbmcgdGlt\nZW91dEF0ID0gU3lzdGVtLm5hbm9UaW1lKCkgKyBUaW1lVW5pdC5OQU5PU0VD\nT05EUy5jb252ZXJ0KHRpbWVvdXQsIHVuaXQpOwogICAgICAgIHdoaWxlIChT\neXN0ZW0ubmFub1RpbWUoKSA8IHRpbWVvdXRBdCkgewogICAgICAgICAgICBm\nb3IgKEF1dG9SZWNvdmVyeU1haW4gcCA6IGF1dG9SZWNvdmVyeVByb2Nlc3Nl\ncy52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgQXVkaXRvciBhID0gcC5n\nZXRBdWRpdG9yKCk7CiAgICAgICAgICAgICAgICBpZiAoYSAhPSBudWxsKSB7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGE7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEw\nMCk7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oIk5v\nIGF1ZGl0b3IgZm91bmQiKTsKICAgIH0KfQo=\n","encoding":"base64"}

