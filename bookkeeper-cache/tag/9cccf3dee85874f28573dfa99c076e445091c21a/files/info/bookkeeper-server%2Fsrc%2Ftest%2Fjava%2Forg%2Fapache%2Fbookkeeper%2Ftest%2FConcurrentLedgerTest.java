{"sha":"7db8e76d6a188a511d7f9cb2dde98557f708e767","node_id":"MDQ6QmxvYjE1NzU5NTY6N2RiOGU3NmQ2YTE4OGE1MTFkN2Y5Y2IyZGRlOTg1NTdmNzA4ZTc2Nw==","size":6689,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7db8e76d6a188a511d7f9cb2dde98557f708e767","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5qdW5pdC5BZnRl\ncjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdENhc2U7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZh\nY3Rvcnk7CgovKioKICogVGVzdHMgd3JpdGluZyB0byBjb25jdXJyZW50IGxl\nZGdlcnMKICovCnB1YmxpYyBjbGFzcyBDb25jdXJyZW50TGVkZ2VyVGVzdCBl\neHRlbmRzIFRlc3RDYXNlIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQ29uY3VycmVudExlZGdlclRlc3QuY2xh\nc3MpOwoKICAgIEJvb2tpZSBib29raWU7CiAgICBGaWxlIHR4bkRpciwgbGVk\nZ2VyRGlyOwogICAgaW50IHJlY3ZUaW1lb3V0ID0gMTAwMDA7CiAgICBTZW1h\ncGhvcmUgdGhyb3R0bGU7CiAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7\nCgogICAgQE92ZXJyaWRlCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBz\nZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIFN0cmluZyB0eG5E\naXJOYW1lID0gU3lzdGVtLmdldFByb3BlcnR5KCJ0eG5EaXIiKTsKICAgICAg\nICBpZiAodHhuRGlyTmFtZSAhPSBudWxsKSB7CiAgICAgICAgICAgIHR4bkRp\nciA9IG5ldyBGaWxlKHR4bkRpck5hbWUpOwogICAgICAgIH0KICAgICAgICBT\ndHJpbmcgbGVkZ2VyRGlyTmFtZSA9IFN5c3RlbS5nZXRQcm9wZXJ0eSgibGVk\nZ2VyRGlyIik7CiAgICAgICAgaWYgKGxlZGdlckRpck5hbWUgIT0gbnVsbCkg\newogICAgICAgICAgICBsZWRnZXJEaXIgPSBuZXcgRmlsZShsZWRnZXJEaXJO\nYW1lKTsKICAgICAgICB9CiAgICAgICAgRmlsZSB0bXBGaWxlID0gRmlsZS5j\ncmVhdGVUZW1wRmlsZSgiYm9vayIsICIudHhuIiwgdHhuRGlyKTsKICAgICAg\nICB0bXBGaWxlLmRlbGV0ZSgpOwogICAgICAgIHR4bkRpciA9IG5ldyBGaWxl\nKHRtcEZpbGUuZ2V0UGFyZW50KCksIHRtcEZpbGUuZ2V0TmFtZSgpKyIuZGly\nIik7CiAgICAgICAgdHhuRGlyLm1rZGlycygpOwogICAgICAgIHRtcEZpbGUg\nPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29rIiwgIi5sZWRnZXIiLCBsZWRn\nZXJEaXIpOwogICAgICAgIGxlZGdlckRpciA9IG5ldyBGaWxlKHRtcEZpbGUu\nZ2V0UGFyZW50KCksIHRtcEZpbGUuZ2V0TmFtZSgpKyIuZGlyIik7CiAgICAg\nICAgbGVkZ2VyRGlyLm1rZGlycygpOwoKICAgICAgICBjb25mID0gbmV3IFNl\ncnZlckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICBjb25mLnNldEFsbG93TG9v\ncGJhY2sodHJ1ZSk7CiAgICAgICAgY29uZi5zZXRCb29raWVQb3J0KDUwMDAp\nOwogICAgICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKG51bGwpOwogICAgICAgIGNv\nbmYuc2V0Sm91cm5hbERpck5hbWUodHhuRGlyLmdldFBhdGgoKSk7CiAgICAg\nICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRn\nZXJEaXIuZ2V0UGF0aCgpIH0pOwogICAgICAgIGJvb2tpZSA9IG5ldyBCb29r\naWUoY29uZik7CiAgICAgICAgYm9va2llLnN0YXJ0KCk7CiAgICB9CgogICAg\nc3RhdGljIHZvaWQgcmVjdXJzaXZlRGVsZXRlKEZpbGUgZikgewogICAgICAg\nIGlmIChmLmlzRmlsZSgpKSB7CiAgICAgICAgICAgIGYuZGVsZXRlKCk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yKEZpbGUgaTogZi5saXN0\nRmlsZXMoKSkgewogICAgICAgICAgICAgICAgcmVjdXJzaXZlRGVsZXRlKGkp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGYuZGVsZXRlKCk7CiAgICAg\nICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgQEFmdGVyCiAgICBwdWJs\naWMgdm9pZCB0ZWFyRG93bigpIHsKICAgICAgICBib29raWUuc2h1dGRvd24o\nKTsKICAgICAgICByZWN1cnNpdmVEZWxldGUodHhuRGlyKTsKICAgICAgICBy\nZWN1cnNpdmVEZWxldGUobGVkZ2VyRGlyKTsKICAgIH0KCiAgICBieXRlIHpl\ncm9zW10gPSBuZXcgYnl0ZVsxNl07CgogICAgaW50IGl0ZXJhdGlvbnMgPSA1\nMTsKICAgIHsKICAgICAgICBTdHJpbmcgaXRlcmF0aW9uc1N0cmluZyA9IFN5\nc3RlbS5nZXRQcm9wZXJ0eSgiaXRlcmF0aW9ucyIpOwogICAgICAgIGlmIChp\ndGVyYXRpb25zU3RyaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0\naW9ucyA9IEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9uc1N0cmluZyk7CiAg\nICAgICAgfQogICAgfQogICAgaW50IGl0ZXJhdGlvblN0ZXAgPSAyNTsKICAg\nIHsKICAgICAgICBTdHJpbmcgaXRlcmF0aW9uc1N0cmluZyA9IFN5c3RlbS5n\nZXRQcm9wZXJ0eSgiaXRlcmF0aW9uU3RlcCIpOwogICAgICAgIGlmIChpdGVy\nYXRpb25zU3RyaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0aW9u\nU3RlcCA9IEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9uc1N0cmluZyk7CiAg\nICAgICAgfQogICAgfQogICAgQFRlc3QodGltZW91dD02MDAwMCkKICAgIHB1\nYmxpYyB2b2lkIHRlc3RDb25jdXJyZW50V3JpdGUoKSB0aHJvd3MgSU9FeGNl\ncHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24g\newogICAgICAgIGludCBzaXplID0gMTAyNDsKICAgICAgICBpbnQgdG90YWx3\ncml0ZXMgPSAxMjg7CiAgICAgICAgaWYgKFN5c3RlbS5nZXRQcm9wZXJ0eSgi\ndG90YWx3cml0ZXMiKSAhPSBudWxsKSB7CiAgICAgICAgICAgIHRvdGFsd3Jp\ndGVzID0gSW50ZWdlci5wYXJzZUludChTeXN0ZW0uZ2V0UHJvcGVydHkoInRv\ndGFsd3JpdGVzIikpOwogICAgICAgIH0KICAgICAgICBMT0cuaW5mbygiUnVu\nbmluZyB1cCB0byAiICsgaXRlcmF0aW9ucyArICIgaXRlcmF0aW9ucyIpOwog\nICAgICAgIExPRy5pbmZvKCJUb3RhbCB3cml0ZXMgPSAiICsgdG90YWx3cml0\nZXMpOwogICAgICAgIGludCBsZWRnZXJzOwogICAgICAgIGZvcihsZWRnZXJz\nID0gMTsgbGVkZ2VycyA8PSBpdGVyYXRpb25zOyBsZWRnZXJzICs9IGl0ZXJh\ndGlvblN0ZXApIHsKICAgICAgICAgICAgbG9uZyBkdXJhdGlvbiA9IGRvV3Jp\ndGVzKGxlZGdlcnMsIHNpemUsIHRvdGFsd3JpdGVzKTsKICAgICAgICAgICAg\nTE9HLmluZm8odG90YWx3cml0ZXMgKyAiIG9uICIgKyBsZWRnZXJzICsgIiB0\nb29rICIgKyBkdXJhdGlvbiArICIgbXMiKTsKICAgICAgICB9CiAgICAgICAg\nTE9HLmluZm8oImxlZGdlcnMgIiArIGxlZGdlcnMpOwogICAgICAgIGZvcihs\nZWRnZXJzID0gMTsgbGVkZ2VycyA8PSBpdGVyYXRpb25zOyBsZWRnZXJzICs9\nIGl0ZXJhdGlvblN0ZXApIHsKICAgICAgICAgICAgbG9uZyBkdXJhdGlvbiA9\nIGRvUmVhZHMobGVkZ2Vycywgc2l6ZSwgdG90YWx3cml0ZXMpOwogICAgICAg\nICAgICBMT0cuaW5mbyhsZWRnZXJzICsgIiByZWFkICIgKyBkdXJhdGlvbiAr\nICIgbXMiKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBsb25nIGRv\nUmVhZHMoaW50IGxlZGdlcnMsIGludCBzaXplLCBpbnQgdG90YWx3cml0ZXMp\nCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRF\neGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9uZyBzdGFy\ndCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgIGZvcihp\nbnQgaSA9IDE7IGkgPD0gdG90YWx3cml0ZXMvbGVkZ2VyczsgaSsrKSB7CiAg\nICAgICAgICAgIGZvcihpbnQgaiA9IDE7IGogPD0gbGVkZ2VyczsgaisrKSB7\nCiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIGVudHJ5ID0gYm9va2llLnJl\nYWRFbnRyeShqLCBpKTsKICAgICAgICAgICAgICAgIC8vIHNraXAgdGhlIGxl\nZGdlciBpZCBhbmQgdGhlIGVudHJ5IGlkCiAgICAgICAgICAgICAgICBlbnRy\neS5nZXRMb25nKCk7CiAgICAgICAgICAgICAgICBlbnRyeS5nZXRMb25nKCk7\nCiAgICAgICAgICAgICAgICBhc3NlcnRFcXVhbHMoaiArICJAIiArIGksIGor\nMiwgZW50cnkuZ2V0TG9uZygpKTsKICAgICAgICAgICAgICAgIGFzc2VydEVx\ndWFscyhqICsgIkAiICsgaSwgaSszLCBlbnRyeS5nZXRMb25nKCkpOwogICAg\nICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGxvbmcgZmluaXNoID0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgcmV0dXJuIGZpbmlz\naCAtIHN0YXJ0OwogICAgfQogICAgcHJpdmF0ZSBsb25nIGRvV3JpdGVzKGlu\ndCBsZWRnZXJzLCBpbnQgc2l6ZSwgaW50IHRvdGFsd3JpdGVzKQogICAgICAg\nICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHRocm90dGxlID0gbmV3IFNl\nbWFwaG9yZSgxMDAwMCk7CiAgICAgICAgV3JpdGVDYWxsYmFjayBjYiA9IG5l\ndyBXcml0ZUNhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgd3JpdGVDb21wbGV0ZShpbnQgcmMsIGxv\nbmcgbGVkZ2VySWQsIGxvbmcgZW50cnlJZCwKICAgICAgICAgICAgSW5ldFNv\nY2tldEFkZHJlc3MgYWRkciwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICAg\nICAgQXRvbWljSW50ZWdlciBjb3VudGVyID0gKEF0b21pY0ludGVnZXIpY3R4\nOwogICAgICAgICAgICAgICAgY291bnRlci5nZXRBbmRJbmNyZW1lbnQoKTsK\nICAgICAgICAgICAgICAgIHRocm90dGxlLnJlbGVhc2UoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH07CiAgICAgICAgQXRvbWljSW50ZWdlciBjb3VudGVy\nID0gbmV3IEF0b21pY0ludGVnZXIoKTsKICAgICAgICBsb25nIHN0YXJ0ID0g\nU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgZm9yKGludCBp\nID0gMTsgaSA8PSB0b3RhbHdyaXRlcy9sZWRnZXJzOyBpKyspIHsKICAgICAg\nICAgICAgZm9yKGludCBqID0gMTsgaiA8PSBsZWRnZXJzOyBqKyspIHsKICAg\nICAgICAgICAgICAgIEJ5dGVCdWZmZXIgYnl0ZXMgPSBCeXRlQnVmZmVyLmFs\nbG9jYXRlKHNpemUpOwogICAgICAgICAgICAgICAgYnl0ZXMucHV0TG9uZyhq\nKTsKICAgICAgICAgICAgICAgIGJ5dGVzLnB1dExvbmcoaSk7CiAgICAgICAg\nICAgICAgICBieXRlcy5wdXRMb25nKGorMik7CiAgICAgICAgICAgICAgICBi\neXRlcy5wdXRMb25nKGkrMyk7CiAgICAgICAgICAgICAgICBieXRlcy5wdXQo\nKCJUaGlzIGlzIGxlZGdlciAiICsgaiArICIgZW50cnkgIiArIGkpLmdldEJ5\ndGVzKCkpOwogICAgICAgICAgICAgICAgYnl0ZXMucG9zaXRpb24oMCk7CiAg\nICAgICAgICAgICAgICBieXRlcy5saW1pdChieXRlcy5jYXBhY2l0eSgpKTsK\nICAgICAgICAgICAgICAgIHRocm90dGxlLmFjcXVpcmUoKTsKICAgICAgICAg\nICAgICAgIGJvb2tpZS5hZGRFbnRyeShieXRlcywgY2IsIGNvdW50ZXIsIHpl\ncm9zKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsb25nIGZp\nbmlzaCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgIHJl\ndHVybiBmaW5pc2ggLSBzdGFydDsKICAgIH0KfQo=\n","encoding":"base64"}

