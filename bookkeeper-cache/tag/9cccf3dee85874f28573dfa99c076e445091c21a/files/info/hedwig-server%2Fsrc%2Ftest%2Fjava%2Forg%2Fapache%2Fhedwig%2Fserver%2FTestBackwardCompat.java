{"sha":"fc1ed9efec2b3e717730d6665b3e19e226f7dce9","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmMxZWQ5ZWZlYzJiM2U3MTc3MzBkNjY2NWIzZTE5ZTIyNmY3ZGNlOQ==","size":49270,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/fc1ed9efec2b3e717730d6665b3e19e226f7dce9","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXI7CgppbXBvcnQgamF2YS5u\nZXQuSW5ldEFkZHJlc3M7CmltcG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBq\nYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExp\nc3Q7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5hdG9taWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmc7CgppbXBvcnQganVuaXQuZnJhbWV3b3JrLlRl\nc3RDYXNlOwoKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgc3RhdGlj\nIG9yZy5qdW5pdC5Bc3NlcnQuKjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIudGVzdC5ab29LZWVwZXJVdGlsOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnRlc3QuUG9ydE1hbmFnZXI7CgppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcudXRpbC5IZWR3aWdTb2NrZXRBZGRyZXNzOwoKaW1wb3J0IG9y\nZy5hcGFjaGUuY29tbW9ucy5jb25maWd1cmF0aW9uLkNvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY29uZmlndXJhdGlvbi5Db25m\naWd1cmF0aW9uRXhjZXB0aW9uOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsK\naW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIFRlc3Qg\nQmFja3dhcmQgQ29tcGF0YWJpbGl0eSBiZXR3ZWVuIGRpZmZlcmVudCB2ZXJz\naW9ucwogKi8KcHVibGljIGNsYXNzIFRlc3RCYWNrd2FyZENvbXBhdCBleHRl\nbmRzIFRlc3RDYXNlIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgbG9n\nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoVGVzdEJhY2t3YXJkQ29t\ncGF0LmNsYXNzKTsKCiAgICBzdGF0aWMgZmluYWwgaW50IENPTlNVTUVJTlRF\nUlZBTCA9IDU7CiAgICBzdGF0aWMgWm9vS2VlcGVyVXRpbCB6a1V0aWwgPSBu\nZXcgWm9vS2VlcGVyVXRpbCgpOwoKICAgIHN0YXRpYyBjbGFzcyBCb29rS2Vl\ncGVyQ2x1c3RlcjQwMCB7CgogICAgICAgIGludCBudW1Cb29raWVzOwogICAg\nICAgIExpc3Q8b3JnLmFwYWNoZS5od192NF8wXzAuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb24+IGJrQ29uZnM7CiAgICAgICAgTGlzdDxv\ncmcuYXBhY2hlLmh3X3Y0XzBfMC5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVNl\ncnZlcj4gYmtzOwoKICAgICAgICBCb29rS2VlcGVyQ2x1c3RlcjQwMChpbnQg\nbnVtQm9va2llcykgewogICAgICAgICAgICB0aGlzLm51bUJvb2tpZXMgPSBu\ndW1Cb29raWVzOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3Rh\ncnQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgemtVdGlsLnN0\nYXJ0U2VydmVyKCk7CgogICAgICAgICAgICBia3MgPSBuZXcgTGlua2VkTGlz\ndDxvcmcuYXBhY2hlLmh3X3Y0XzBfMC5ib29ra2VlcGVyLnByb3RvLkJvb2tp\nZVNlcnZlcj4oKTsKICAgICAgICAgICAgYmtDb25mcyA9IG5ldyBMaW5rZWRM\naXN0PG9yZy5hcGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIuY29uZi5TZXJ2\nZXJDb25maWd1cmF0aW9uPigpOwoKICAgICAgICAgICAgZm9yIChpbnQgaT0w\nOyBpPG51bUJvb2tpZXM7IGkrKykgewogICAgICAgICAgICAgICAgc3RhcnRC\nb29raWVTZXJ2ZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgcHVibGljIHZvaWQgc3RvcCgpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBmb3IgKG9yZy5hcGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIu\ncHJvdG8uQm9va2llU2VydmVyIGJzIDogYmtzKSB7CiAgICAgICAgICAgICAg\nICBicy5zaHV0ZG93bigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJr\ncy5jbGVhcigpOwoKICAgICAgICAgICAgemtVdGlsLmtpbGxTZXJ2ZXIoKTsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIHN0YXJ0Qm9va2ll\nU2VydmVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGludCBw\nb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7CiAgICAgICAgICAg\nIEZpbGUgdG1wRGlyID0gb3JnLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLnV0\naWwuRmlsZVV0aWxzLmNyZWF0ZVRlbXBEaXJlY3RvcnkoCiAgICAgICAgICAg\nICAgICBnZXRDbGFzcygpLmdldE5hbWUoKSArIHBvcnQsICJ0ZXN0Iik7CiAg\nICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIuY29u\nZi5TZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXdTZXJ2ZXJDb25maWd1\ncmF0aW9uKAogICAgICAgICAgICAgICAgcG9ydCwgemtVdGlsLmdldFpvb0tl\nZXBlckNvbm5lY3RTdHJpbmcoKSwgdG1wRGlyLCBuZXcgRmlsZVtdIHsgdG1w\nRGlyIH0pOwogICAgICAgICAgICBia3MuYWRkKHN0YXJ0Qm9va2llKGNvbmYp\nKTsKICAgICAgICAgICAgYmtDb25mcy5hZGQoY29uZik7CiAgICAgICAgfQoK\nICAgICAgICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5od192NF8wXzAuYm9va2tl\nZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24gbmV3U2VydmVyQ29uZmln\ndXJhdGlvbigKICAgICAgICAgICAgaW50IHBvcnQsIFN0cmluZyB6a1NlcnZl\ncnMsIEZpbGUgam91cm5hbERpciwgRmlsZVtdIGxlZGdlckRpcnMpIHsKICAg\nICAgICAgICAgb3JnLmFwYWNoZS5od192NF8wXzAuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9CiAgICAgICAgICAgICAgICBu\nZXcgb3JnLmFwYWNoZS5od192NF8wXzAuYm9va2tlZXBlci5jb25mLlNlcnZl\nckNvbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgY29uZi5zZXRCb29raWVQ\nb3J0KHBvcnQpOwogICAgICAgICAgICBjb25mLnNldFprU2VydmVycyh6a1Nl\ncnZlcnMpOwogICAgICAgICAgICBjb25mLnNldEpvdXJuYWxEaXJOYW1lKGpv\ndXJuYWxEaXIuZ2V0UGF0aCgpKTsKICAgICAgICAgICAgU3RyaW5nW10gbGVk\nZ2VyRGlyTmFtZXMgPSBuZXcgU3RyaW5nW2xlZGdlckRpcnMubGVuZ3RoXTsK\nICAgICAgICAgICAgZm9yIChpbnQgaT0wOyBpPGxlZGdlckRpcnMubGVuZ3Ro\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckRpck5hbWVzW2ldID0g\nbGVkZ2VyRGlyc1tpXS5nZXRQYXRoKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhsZWRnZXJEaXJOYW1lcyk7\nCiAgICAgICAgICAgIHJldHVybiBjb25mOwogICAgICAgIH0KCiAgICAgICAg\ncHJvdGVjdGVkIG9yZy5hcGFjaGUuaHdfdjRfMF8wLmJvb2trZWVwZXIucHJv\ndG8uQm9va2llU2VydmVyIHN0YXJ0Qm9va2llKAogICAgICAgICAgICBvcmcu\nYXBhY2hlLmh3X3Y0XzBfMC5ib29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\nb3JnLmFwYWNoZS5od192NF8wXzAuYm9va2tlZXBlci5wcm90by5Cb29raWVT\nZXJ2ZXIgc2VydmVyCiAgICAgICAgICAgICAgICA9IG5ldyBvcmcuYXBhY2hl\nLmh3X3Y0XzBfMC5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlcihjb25m\nKTsKICAgICAgICAgICAgc2VydmVyLnN0YXJ0KCk7CgogICAgICAgICAgICBp\nbnQgcG9ydCA9IGNvbmYuZ2V0Qm9va2llUG9ydCgpOwogICAgICAgICAgICB3\naGlsZSAoemtVdGlsLmdldFpvb0tlZXBlckNsaWVudCgpLmV4aXN0cygKICAg\nICAgICAgICAgICAgICAgICAiL2xlZGdlcnMvYXZhaWxhYmxlLyIgKyBJbmV0\nQWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpICsgIjoi\nICsgcG9ydCwKICAgICAgICAgICAgICAgICAgICBmYWxzZSkgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDUwMCk7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgcmV0dXJuIHNlcnZlcjsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBWZXJzaW9uIDQuMC4wIGNsYXNzZXMKICAg\nICAqLwogICAgc3RhdGljIGNsYXNzIFNlcnZlcjQwMCB7CiAgICAgICAgb3Jn\nLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVy\nQ29uZmlndXJhdGlvbiBjb25mOwogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRf\nMF8wLmhlZHdpZy5zZXJ2ZXIubmV0dHkuUHViU3ViU2VydmVyIHNlcnZlcjsK\nCiAgICAgICAgU2VydmVyNDAwKGZpbmFsIFN0cmluZyB6a0hvc3RzLCBmaW5h\nbCBpbnQgcG9ydCwgZmluYWwgaW50IHNzbFBvcnQpIHsKICAgICAgICAgICAg\nY29uZiA9IG5ldyBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcuc2VydmVy\nLmNvbW1vbi5TZXJ2ZXJDb25maWd1cmF0aW9uKCkgewogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgU3RyaW5nIGdl\ndFprSG9zdCgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gemtIb3N0\nczsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0U2VydmVyUG9ydCgp\nIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9ydDsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgIHB1YmxpYyBpbnQgZ2V0U1NMU2VydmVyUG9ydCgpIHsKICAgICAg\nICAgICAgICAgICAgICByZXR1cm4gc3NsUG9ydDsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfTsKICAgICAgICB9CgogICAgICAgIHZvaWQgc3Rh\ncnQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgc2VydmVyID0g\nbmV3IG9yZy5hcGFjaGUuaHdfdjRfMF8wLmhlZHdpZy5zZXJ2ZXIubmV0dHku\nUHViU3ViU2VydmVyKGNvbmYpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBz\ndG9wKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChudWxs\nICE9IHNlcnZlcikgewogICAgICAgICAgICAgICAgc2VydmVyLnNodXRkb3du\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgc3RhdGlj\nIGNsYXNzIENsaWVudDQwMCB7CiAgICAgICAgb3JnLmFwYWNoZS5od192NF8w\nXzAuaGVkd2lnLmNsaWVudC5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24gY29u\nZjsKICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcuY2xpZW50\nLmFwaS5DbGllbnQgY2xpZW50OwogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRf\nMF8wLmhlZHdpZy5jbGllbnQuYXBpLlB1Ymxpc2hlciBwdWJsaXNoZXI7CiAg\nICAgICAgb3JnLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLmNsaWVudC5hcGku\nU3Vic2NyaWJlciBzdWJzY3JpYmVyOwoKICAgICAgICBDbGllbnQ0MDAoZmlu\nYWwgU3RyaW5nIGNvbm5lY3RTdHJpbmcpIHsKICAgICAgICAgICAgY29uZiA9\nIG5ldyBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcuY2xpZW50LmNvbmYu\nQ2xpZW50Q29uZmlndXJhdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwcm90ZWN0ZWQgb3JnLmFw\nYWNoZS5od192NF8wXzAuaGVkd2lnLnV0aWwuSGVkd2lnU29ja2V0QWRkcmVz\ncwogICAgICAgICAgICAgICAgICAgICAgICBnZXREZWZhdWx0U2VydmVySGVk\nd2lnU29ja2V0QWRkcmVzcygpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIG5ldyBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcudXRpbC5I\nZWR3aWdTb2NrZXRBZGRyZXNzKGNvbm5lY3RTdHJpbmcpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNs\naWVudCA9IG5ldyBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcuY2xpZW50\nLkhlZHdpZ0NsaWVudChjb25mKTsKICAgICAgICAgICAgcHVibGlzaGVyID0g\nY2xpZW50LmdldFB1Ymxpc2hlcigpOwogICAgICAgICAgICBzdWJzY3JpYmVy\nID0gY2xpZW50LmdldFN1YnNjcmliZXIoKTsKICAgICAgICB9CgogICAgICAg\nIHZvaWQgY2xvc2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAg\naWYgKG51bGwgIT0gY2xpZW50KSB7CiAgICAgICAgICAgICAgICBjbGllbnQu\nY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgb3Jn\nLmFwYWNoZS5od192NF8wXzAuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZCBwdWJsaXNoKAogICAgICAgICAgICBCeXRlU3Ry\naW5nIHRvcGljLCBCeXRlU3RyaW5nIGRhdGEpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzBfMC5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBtZXNzYWdlID0KICAgICAg\nICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMF8wLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLm5ld0J1aWxkZXIoKQogICAgICAg\nICAgICAgICAgICAgIC5zZXRCb2R5KGRhdGEpLmJ1aWxkKCk7CiAgICAgICAg\nICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRvcGljLCBtZXNzYWdlKTsKICAgICAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgfQoKICAgIHN0YXRp\nYyBjbGFzcyBCb29rS2VlcGVyQ2x1c3RlcjQxMCB7CgogICAgICAgIGludCBu\ndW1Cb29raWVzOwogICAgICAgIExpc3Q8b3JnLmFwYWNoZS5od192NF8xXzAu\nYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24+IGJrQ29uZnM7\nCiAgICAgICAgTGlzdDxvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29ra2VlcGVy\nLnByb3RvLkJvb2tpZVNlcnZlcj4gYmtzOwoKICAgICAgICBCb29rS2VlcGVy\nQ2x1c3RlcjQxMChpbnQgbnVtQm9va2llcykgewogICAgICAgICAgICB0aGlz\nLm51bUJvb2tpZXMgPSBudW1Cb29raWVzOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIHZvaWQgc3RhcnQoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgemtVdGlsLnN0YXJ0U2VydmVyKCk7CgogICAgICAgICAgICBia3Mg\nPSBuZXcgTGlua2VkTGlzdDxvcmcuYXBhY2hlLmh3X3Y0XzFfMC5ib29ra2Vl\ncGVyLnByb3RvLkJvb2tpZVNlcnZlcj4oKTsKICAgICAgICAgICAgYmtDb25m\ncyA9IG5ldyBMaW5rZWRMaXN0PG9yZy5hcGFjaGUuaHdfdjRfMV8wLmJvb2tr\nZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uPigpOwoKICAgICAgICAg\nICAgZm9yIChpbnQgaT0wOyBpPG51bUJvb2tpZXM7IGkrKykgewogICAgICAg\nICAgICAgICAgc3RhcnRCb29raWVTZXJ2ZXIoKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc3RvcCgpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgICAgICBmb3IgKG9yZy5hcGFjaGUuaHdfdjRf\nMV8wLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyIGJzIDogYmtzKSB7\nCiAgICAgICAgICAgICAgICBicy5zaHV0ZG93bigpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGJrcy5jbGVhcigpOwoKICAgICAgICAgICAgemtVdGls\nLmtpbGxTZXJ2ZXIoKTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2\nb2lkIHN0YXJ0Qm9va2llU2VydmVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgICAgIGludCBwb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0\nKCk7CiAgICAgICAgICAgIEZpbGUgdG1wRGlyID0gb3JnLmFwYWNoZS5od192\nNF8xXzAuaGVkd2lnLnV0aWwuRmlsZVV0aWxzLmNyZWF0ZVRlbXBEaXJlY3Rv\ncnkoCiAgICAgICAgICAgICAgICBnZXRDbGFzcygpLmdldE5hbWUoKSArIHBv\ncnQsICJ0ZXN0Iik7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8w\nLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBu\nZXdTZXJ2ZXJDb25maWd1cmF0aW9uKAogICAgICAgICAgICAgICAgICAgIHBv\ncnQsIHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHRtcERp\nciwgbmV3IEZpbGVbXSB7IHRtcERpciB9KTsKICAgICAgICAgICAgYmtzLmFk\nZChzdGFydEJvb2tpZShjb25mKSk7CiAgICAgICAgICAgIGJrQ29uZnMuYWRk\nKGNvbmYpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVjdGVkIG9yZy5hcGFj\naGUuaHdfdjRfMV8wLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0\naW9uIG5ld1NlcnZlckNvbmZpZ3VyYXRpb24oCiAgICAgICAgICAgIGludCBw\nb3J0LCBTdHJpbmcgemtTZXJ2ZXJzLCBGaWxlIGpvdXJuYWxEaXIsIEZpbGVb\nXSBsZWRnZXJEaXJzKSB7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRf\nMV8wLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPQogICAgICAgICAgICAgICAgbmV3IG9yZy5hcGFjaGUuaHdfdjRfMV8wLmJv\nb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAg\nICAgIGNvbmYuc2V0Qm9va2llUG9ydChwb3J0KTsKICAgICAgICAgICAgY29u\nZi5zZXRaa1NlcnZlcnMoemtTZXJ2ZXJzKTsKICAgICAgICAgICAgY29uZi5z\nZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGlyLmdldFBhdGgoKSk7CiAgICAg\nICAgICAgIFN0cmluZ1tdIGxlZGdlckRpck5hbWVzID0gbmV3IFN0cmluZ1ts\nZWRnZXJEaXJzLmxlbmd0aF07CiAgICAgICAgICAgIGZvciAoaW50IGk9MDsg\naTxsZWRnZXJEaXJzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBs\nZWRnZXJEaXJOYW1lc1tpXSA9IGxlZGdlckRpcnNbaV0uZ2V0UGF0aCgpOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbmYuc2V0TGVkZ2VyRGlyTmFt\nZXMobGVkZ2VyRGlyTmFtZXMpOwogICAgICAgICAgICByZXR1cm4gY29uZjsK\nICAgICAgICB9CgogICAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmh3X3Y0\nXzFfMC5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlciBzdGFydEJvb2tp\nZSgKICAgICAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAuYm9va2tlZXBl\nci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24gY29uZikgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmJvb2tr\nZWVwZXIucHJvdG8uQm9va2llU2VydmVyIHNlcnZlcgogICAgICAgICAgICAg\nICAgPSBuZXcgb3JnLmFwYWNoZS5od192NF8xXzAuYm9va2tlZXBlci5wcm90\nby5Cb29raWVTZXJ2ZXIoY29uZik7CiAgICAgICAgICAgIHNlcnZlci5zdGFy\ndCgpOwoKICAgICAgICAgICAgaW50IHBvcnQgPSBjb25mLmdldEJvb2tpZVBv\ncnQoKTsKICAgICAgICAgICAgd2hpbGUgKHprVXRpbC5nZXRab29LZWVwZXJD\nbGllbnQoKS5leGlzdHMoCiAgICAgICAgICAgICAgICAgICAgIi9sZWRnZXJz\nL2F2YWlsYWJsZS8iICsgSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0\nSG9zdEFkZHJlc3MoKSArICI6IiArIHBvcnQsCiAgICAgICAgICAgICAgICAg\nICAgZmFsc2UpID09IG51bGwpIHsKICAgICAgICAgICAgICAgIFRocmVhZC5z\nbGVlcCg1MDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBz\nZXJ2ZXI7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVmVyc2lv\nbiA0LjEuMCBjbGFzc2VzCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBTZXJ2\nZXI0MTAgewogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5z\nZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjsKICAgICAg\nICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcuc2VydmVyLm5ldHR5LlB1\nYlN1YlNlcnZlciBzZXJ2ZXI7CgogICAgICAgIFNlcnZlcjQxMChmaW5hbCBT\ndHJpbmcgemtIb3N0cywgZmluYWwgaW50IHBvcnQsIGZpbmFsIGludCBzc2xQ\nb3J0KSB7CiAgICAgICAgICAgIGNvbmYgPSBuZXcgb3JnLmFwYWNoZS5od192\nNF8xXzAuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlv\nbigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIGludCBnZXRDb25zdW1lSW50ZXJ2YWwoKSB7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIENPTlNVTUVJTlRFUlZBTDsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgcHVibGljIFN0cmluZyBnZXRaa0hvc3QoKSB7CiAgICAgICAgICAg\nICAgICAgICAgcmV0dXJuIHprSG9zdHM7CiAgICAgICAgICAgICAgICB9Cgog\nICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJs\naWMgaW50IGdldFNlcnZlclBvcnQoKSB7CiAgICAgICAgICAgICAgICAgICAg\ncmV0dXJuIHBvcnQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgaW50IGdldFNT\nTFNlcnZlclBvcnQoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNz\nbFBvcnQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAg\nICAgfQoKICAgICAgICB2b2lkIHN0YXJ0KCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHNlcnZlciA9IG5ldyBvcmcuYXBhY2hlLmh3X3Y0XzFf\nMC5oZWR3aWcuc2VydmVyLm5ldHR5LlB1YlN1YlNlcnZlcihjb25mKTsKICAg\nICAgICAgICAgc2VydmVyLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICB2\nb2lkIHN0b3AoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYg\nKG51bGwgIT0gc2VydmVyKSB7CiAgICAgICAgICAgICAgICBzZXJ2ZXIuc2h1\ndGRvd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBz\ndGF0aWMgY2xhc3MgQ2xpZW50NDEwIHsKICAgICAgICBvcmcuYXBhY2hlLmh3\nX3Y0XzFfMC5oZWR3aWcuY2xpZW50LmNvbmYuQ2xpZW50Q29uZmlndXJhdGlv\nbiBjb25mOwogICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5j\nbGllbnQuYXBpLkNsaWVudCBjbGllbnQ7CiAgICAgICAgb3JnLmFwYWNoZS5o\nd192NF8xXzAuaGVkd2lnLmNsaWVudC5hcGkuUHVibGlzaGVyIHB1Ymxpc2hl\ncjsKICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcuY2xpZW50\nLmFwaS5TdWJzY3JpYmVyIHN1YnNjcmliZXI7CgogICAgICAgIGNsYXNzIElu\ndE1lc3NhZ2VIYW5kbGVyIGltcGxlbWVudHMgb3JnLmFwYWNoZS5od192NF8x\nXzAuaGVkd2lnLmNsaWVudC5hcGkuTWVzc2FnZUhhbmRsZXIgewogICAgICAg\nICAgICBCeXRlU3RyaW5nIHRvcGljOwogICAgICAgICAgICBCeXRlU3RyaW5n\nIHN1YklkOwogICAgICAgICAgICBpbnQgbmV4dDsKCiAgICAgICAgICAgIENv\ndW50RG93bkxhdGNoIGxhdGNoOwoKICAgICAgICAgICAgSW50TWVzc2FnZUhh\nbmRsZXIoQnl0ZVN0cmluZyB0LCBCeXRlU3RyaW5nIHMsIGludCBzdGFydCwg\naW50IG51bSkgewogICAgICAgICAgICAgICAgdGhpcy50b3BpYyA9IHQ7CiAg\nICAgICAgICAgICAgICB0aGlzLnN1YklkID0gczsKICAgICAgICAgICAgICAg\nIHRoaXMubmV4dCA9IHN0YXJ0OwogICAgICAgICAgICAgICAgdGhpcy5sYXRj\naCA9IG5ldyBDb3VudERvd25MYXRjaChudW0pOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\nZGVsaXZlcihCeXRlU3RyaW5nIHQsIEJ5dGVTdHJpbmcgcywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBtc2csCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5od192\nNF8xXzAuaGVkd2lnLnV0aWwuQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9i\namVjdCBjb250ZXh0KSB7CiAgICAgICAgICAgICAgICBpZiAoIXQuZXF1YWxz\nKHRvcGljKSB8fCAhcy5lcXVhbHMoc3ViSWQpKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgaW50IG51bSA9IEludGVnZXIucGFyc2VJbnQobXNnLmdldEJvZHkoKS50\nb1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgICAgICBpZiAobnVtID09IG5l\neHQpIHsKICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsK\nICAgICAgICAgICAgICAgICAgICArK25leHQ7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChj\nb250ZXh0LCBudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcHVi\nbGljIGJvb2xlYW4gYXdhaXQobG9uZyB0aW1lb3V0LCBUaW1lVW5pdCB1bml0\nKQogICAgICAgICAgICB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgcmV0dXJuIGxhdGNoLmF3YWl0KHRpbWVvdXQsIHVu\naXQpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBDbGllbnQ0\nMTAoZmluYWwgU3RyaW5nIGNvbm5lY3RTdHJpbmcpIHsKICAgICAgICAgICAg\nY29uZiA9IG5ldyBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcuY2xpZW50\nLmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbigpIHsKICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gaXNB\ndXRvU2VuZENvbnN1bWVNZXNzYWdlRW5hYmxlZCgpIHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIGlu\ndCBnZXRDb25zdW1lZE1lc3NhZ2VzQnVmZmVyU2l6ZSgpIHsKICAgICAgICAg\nICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHJvdGVjdGVk\nIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tl\ndEFkZHJlc3MKICAgICAgICAgICAgICAgICAgICBnZXREZWZhdWx0U2VydmVy\nSGVkd2lnU29ja2V0QWRkcmVzcygpIHsKICAgICAgICAgICAgICAgICAgICBy\nZXR1cm4gbmV3IG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy51dGlsLkhl\nZHdpZ1NvY2tldEFkZHJlc3MoY29ubmVjdFN0cmluZyk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGNsaWVudCA9IG5l\ndyBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcuY2xpZW50LkhlZHdpZ0Ns\naWVudChjb25mKTsKICAgICAgICAgICAgcHVibGlzaGVyID0gY2xpZW50Lmdl\ndFB1Ymxpc2hlcigpOwogICAgICAgICAgICBzdWJzY3JpYmVyID0gY2xpZW50\nLmdldFN1YnNjcmliZXIoKTsKICAgICAgICB9CgogICAgICAgIHZvaWQgY2xv\nc2UoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKG51bGwg\nIT0gY2xpZW50KSB7CiAgICAgICAgICAgICAgICBjbGllbnQuY2xvc2UoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgb3JnLmFwYWNoZS5o\nd192NF8xXzAuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZCBwdWJsaXNoKAogICAgICAgICAgICBCeXRlU3RyaW5nIHRvcGlj\nLCBCeXRlU3RyaW5nIGRhdGEpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZSBtZXNzYWdlID0KICAgICAgICAgICAgICAg\nIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5NZXNzYWdlLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAgICAg\nICAgIC5zZXRCb2R5KGRhdGEpLmJ1aWxkKCk7CiAgICAgICAgICAgIHB1Ymxp\nc2hlci5wdWJsaXNoKHRvcGljLCBtZXNzYWdlKTsKICAgICAgICAgICAgcmV0\ndXJuIG51bGw7CiAgICAgICAgfQoKICAgICAgICB2b2lkIHB1Ymxpc2hJbnRz\nKEJ5dGVTdHJpbmcgdG9waWMsIGludCBzdGFydCwgaW50IG51bSkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGZvciAoaW50IGk9MDsgaTxudW07\nIGkrKykgewogICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgbXNnID0K\nICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVy\nKCkuc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiIiArIChzdGFy\ndCtpKSkpLmJ1aWxkKCk7CiAgICAgICAgICAgICAgICBwdWJsaXNoZXIucHVi\nbGlzaCh0b3BpYywgbXNnKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBzZW5kWEV4cGVjdExhc3RZKEJ5dGVTdHJpbmcgdG9waWMs\nIEJ5dGVTdHJpbmcgc3ViaWQsIGZpbmFsIGludCB4LCBmaW5hbCBpbnQgeSkK\nICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgZm9yIChp\nbnQgaT0wOyBpPHg7IGkrKykgewogICAgICAgICAgICAgICAgcHVibGlzaGVy\nLnB1Ymxpc2godG9waWMsIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLm5ld0J1aWxkZXIoKS5z\nZXRCb2R5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KFN0cmluZy52YWx1ZU9mKGkp\nKSkuYnVpbGQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3Vic2Ny\naWJlci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcmcuYXBhY2hlLmh3X3Y0\nXzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVxdWVzdC5DcmVhdGVPckF0dGFjaC5BVFRBQ0gpOwoKICAgICAgICAgICAg\nZmluYWwgQXRvbWljSW50ZWdlciBleHBlY3RlZCA9IG5ldyBBdG9taWNJbnRl\nZ2VyKHggLSB5KTsKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2gg\nbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgICAgIHN1\nYnNjcmliZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3ViaWQsIG5ldyBvcmcu\nYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcuY2xpZW50LmFwaS5NZXNzYWdlSGFu\nZGxlcigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIGRlbGl2ZXIoQnl0ZVN0\ncmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcmcu\nYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZSBtc2csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3\naWcudXRpbC5DYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGNvbnRl\neHQpIHsKICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICBpbnQgdmFsdWUgPSBJbnRlZ2VyLnZhbHVlT2YobXNnLmdl\ndEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmICh2YWx1ZSA9PSBleHBlY3RlZC5nZXQoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQuaW5jcmVtZW50QW5kR2V0KCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkRpZCBub3QgcmVjZWl2\nZSBleHBlY3RlZCB2YWx1ZSwgZXhwZWN0ZWQge30sIGdvdCB7fSIsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQu\nZ2V0KCksIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4\ncGVjdGVkLnNldCgwKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxh\ndGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChleHBlY3RlZC5nZXQoKSA9PSB4\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjb250ZXh0\nLCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3Io\nIlJlY2VpdmVkIGJhZCBtZXNzYWdlIiwgZSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAg\nICAgIGFzc2VydFRydWUoIlRpbWVkIG91dCB3YWl0aW5nIGZvciBtZXNzYWdl\ncyBZIGlzICIgKyB5ICsgIiBleHBlY3RlZCBpcyBjdXJyZW50bHkgIgogICAg\nICAgICAgICAgICAgICAgICAgICsgZXhwZWN0ZWQuZ2V0KCksIGxhdGNoLmF3\nYWl0KDEwLCBUaW1lVW5pdC5TRUNPTkRTKSk7CiAgICAgICAgICAgIGFzc2Vy\ndEVxdWFscygiU2hvdWxkIGJlIGV4cGVjdGVkIG1lc3NhZ2Ugd2l0aCAiICsg\neCwgeCwgZXhwZWN0ZWQuZ2V0KCkpOwogICAgICAgICAgICBzdWJzY3JpYmVy\nLnN0b3BEZWxpdmVyeSh0b3BpYywgc3ViaWQpOwogICAgICAgICAgICBzdWJz\nY3JpYmVyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJpZCk7CiAgICAg\nICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsgLy8gZ2l2ZSBzZXJ2ZXIgdGlt\nZSB0byBydW4gZGlzY29ubmVjdCBsb2dpYyAoQk9PS0tFRVBFUi01MTMpCiAg\nICAgICAgfQoKICAgICAgICB2b2lkIHN1YnNjcmliZShCeXRlU3RyaW5nIHRv\ncGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaHdfdjRfMV8wLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIG9w\ndGlvbnMgPQogICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9w\ndGlvbnMubmV3QnVpbGRlcigpCiAgICAgICAgICAgICAgICAuc2V0Q3JlYXRl\nT3JBdHRhY2gob3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRh\nY2guQ1JFQVRFX09SX0FUVEFDSCkuYnVpbGQoKTsKICAgICAgICAgICAgc3Vi\nc2NyaWJlKHRvcGljLCBzdWJzY3JpYmVySWQsIG9wdGlvbnMpOwogICAgICAg\nIH0KCiAgICAgICAgdm9pZCBzdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywg\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0aW9ucykgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJl\nKHRvcGljLCBzdWJzY3JpYmVySWQsIG9wdGlvbnMpOwogICAgICAgIH0KCiAg\nICAgICAgdm9pZCBjbG9zZVN1YnNjcmlwdGlvbihCeXRlU3RyaW5nIHRvcGlj\nLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIHN1YnNjcmliZXIuY2xvc2VTdWJzY3JpcHRpb24odG9w\naWMsIHN1YnNjcmliZXJJZCk7CiAgICAgICAgICAgIFRocmVhZC5zbGVlcCgx\nMDAwKTsgLy8gZ2l2ZSBzZXJ2ZXIgdGltZSB0byBydW4gZGlzY29ubmVjdCBs\nb2dpYyAoQk9PS0tFRVBFUi01MTMpCiAgICAgICAgfQoKICAgICAgICB2b2lk\nIHJlY2VpdmVJbnRzKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vi\nc2NyaWJlcklkLCBpbnQgc3RhcnQsIGludCBudW0pIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICBJbnRNZXNzYWdlSGFuZGxlciBtc2dIYW5kbGVy\nID0gbmV3IEludE1lc3NhZ2VIYW5kbGVyKHRvcGljLCBzdWJzY3JpYmVySWQs\nIHN0YXJ0LCBudW0pOwogICAgICAgICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVs\naXZlcnkodG9waWMsIHN1YnNjcmliZXJJZCwgbXNnSGFuZGxlcik7CiAgICAg\nICAgICAgIG1zZ0hhbmRsZXIuYXdhaXQobnVtLCBUaW1lVW5pdC5TRUNPTkRT\nKTsKICAgICAgICAgICAgc3Vic2NyaWJlci5zdG9wRGVsaXZlcnkodG9waWMs\nIHN1YnNjcmliZXJJZCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAg\nICogQ3VycmVudCBWZXJzaW9uCiAgICAgKi8KICAgIHN0YXRpYyBjbGFzcyBC\nb29rS2VlcGVyQ2x1c3RlckN1cnJlbnQgewoKICAgICAgICBpbnQgbnVtQm9v\na2llczsKICAgICAgICBMaXN0PG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb24+IGJrQ29uZnM7CiAgICAgICAgTGlzdDxv\ncmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyPiBia3M7\nCgoKICAgICAgICBCb29rS2VlcGVyQ2x1c3RlckN1cnJlbnQoaW50IG51bUJv\nb2tpZXMpIHsKICAgICAgICAgICAgdGhpcy5udW1Cb29raWVzID0gbnVtQm9v\na2llczsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0YXJ0KCkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHprVXRpbC5zdGFydFNl\ncnZlcigpOwoKICAgICAgICAgICAgYmtzID0gbmV3IExpbmtlZExpc3Q8b3Jn\nLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlcj4oKTsKICAg\nICAgICAgICAgYmtDb25mcyA9IG5ldyBMaW5rZWRMaXN0PG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24+KCk7CgogICAg\nICAgICAgICBmb3IgKGludCBpPTA7IGk8bnVtQm9va2llczsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBzdGFydEJvb2tpZVNlcnZlcigpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdG9wKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGZvciAob3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkJvb2tpZVNlcnZlciBicyA6IGJrcykgewogICAg\nICAgICAgICAgICAgYnMuc2h1dGRvd24oKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBia3MuY2xlYXIoKTsKCiAgICAgICAgICAgIHprVXRpbC5raWxs\nU2VydmVyKCk7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9pZCBz\ndGFydEJvb2tpZVNlcnZlcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nICAgICBpbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwog\nICAgICAgICAgICBGaWxlIHRtcERpciA9IG9yZy5hcGFjaGUuaGVkd2lnLnV0\naWwuRmlsZVV0aWxzLmNyZWF0ZVRlbXBEaXJlY3RvcnkoCiAgICAgICAgICAg\nICAgICBnZXRDbGFzcygpLmdldE5hbWUoKSArIHBvcnQsICJ0ZXN0Iik7CiAg\nICAgICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNv\nbmZpZ3VyYXRpb24gY29uZiA9IG5ld1NlcnZlckNvbmZpZ3VyYXRpb24oCiAg\nICAgICAgICAgICAgICBwb3J0LCB6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVj\ndFN0cmluZygpLCB0bXBEaXIsIG5ldyBGaWxlW10geyB0bXBEaXIgfSk7CiAg\nICAgICAgICAgIGNvbmYuc2V0QWxsb3dMb29wYmFjayh0cnVlKTsKICAgICAg\nICAgICAgYmtzLmFkZChzdGFydEJvb2tpZShjb25mKSk7CiAgICAgICAgICAg\nIGJrQ29uZnMuYWRkKGNvbmYpOwogICAgICAgIH0KCiAgICAgICAgcHJvdGVj\ndGVkIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3Vy\nYXRpb24gbmV3U2VydmVyQ29uZmlndXJhdGlvbigKICAgICAgICAgICAgaW50\nIHBvcnQsIFN0cmluZyB6a1NlcnZlcnMsIEZpbGUgam91cm5hbERpciwgRmls\nZVtdIGxlZGdlckRpcnMpIHsKICAgICAgICAgICAgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbiBjb25mID0KICAgICAg\nICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2\nZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAgICAgIGNvbmYuc2V0QWxsb3dM\nb29wYmFjayh0cnVlKTsKICAgICAgICAgICAgY29uZi5zZXRCb29raWVQb3J0\nKHBvcnQpOwogICAgICAgICAgICBjb25mLnNldFprU2VydmVycyh6a1NlcnZl\ncnMpOwogICAgICAgICAgICBjb25mLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJu\nYWxEaXIuZ2V0UGF0aCgpKTsKICAgICAgICAgICAgU3RyaW5nW10gbGVkZ2Vy\nRGlyTmFtZXMgPSBuZXcgU3RyaW5nW2xlZGdlckRpcnMubGVuZ3RoXTsKICAg\nICAgICAgICAgZm9yIChpbnQgaT0wOyBpPGxlZGdlckRpcnMubGVuZ3RoOyBp\nKyspIHsKICAgICAgICAgICAgICAgIGxlZGdlckRpck5hbWVzW2ldID0gbGVk\nZ2VyRGlyc1tpXS5nZXRQYXRoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgY29uZi5zZXRMZWRnZXJEaXJOYW1lcyhsZWRnZXJEaXJOYW1lcyk7CiAg\nICAgICAgICAgIHJldHVybiBjb25mOwogICAgICAgIH0KCiAgICAgICAgcHJv\ndGVjdGVkIG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVTZXJ2\nZXIgc3RhcnRCb29raWUoCiAgICAgICAgICAgIG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb24gY29uZikgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuYm9va2tlZXBlci5w\ncm90by5Cb29raWVTZXJ2ZXIgc2VydmVyCiAgICAgICAgICAgICAgICA9IG5l\ndyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2llU2VydmVyKGNv\nbmYpOwogICAgICAgICAgICBzZXJ2ZXIuc3RhcnQoKTsKCiAgICAgICAgICAg\nIGludCBwb3J0ID0gY29uZi5nZXRCb29raWVQb3J0KCk7CiAgICAgICAgICAg\nIHdoaWxlICh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ2xpZW50KCkuZXhpc3RzKAog\nICAgICAgICAgICAgICAgICAgICIvbGVkZ2Vycy9hdmFpbGFibGUvIiArIElu\nZXRBZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCkgKyAi\nOiIgKyBwb3J0LAogICAgICAgICAgICAgICAgICAgIGZhbHNlKSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICBUaHJlYWQuc2xlZXAoNTAwKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gc2VydmVyOwogICAgICAgIH0K\nICAgIH0KCiAgICBzdGF0aWMgY2xhc3MgU2VydmVyQ3VycmVudCB7CiAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLmNvbW1vbi5TZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmY7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcuc2Vy\ndmVyLm5ldHR5LlB1YlN1YlNlcnZlciBzZXJ2ZXI7CgogICAgICAgIFNlcnZl\nckN1cnJlbnQoZmluYWwgU3RyaW5nIHprSG9zdHMsIGZpbmFsIGludCBwb3J0\nLCBmaW5hbCBpbnQgc3NsUG9ydCkgewogICAgICAgICAgICBjb25mID0gbmV3\nIG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmln\ndXJhdGlvbigpIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICAgICAgcHVibGljIGludCBnZXRDb25zdW1lSW50ZXJ2YWwoKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIENPTlNVTUVJTlRFUlZBTDsKICAg\nICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgIHB1YmxpYyBTdHJpbmcgZ2V0WmtIb3N0KCkgewogICAg\nICAgICAgICAgICAgICAgIHJldHVybiB6a0hvc3RzOwogICAgICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAg\nICAgcHVibGljIGludCBnZXRTZXJ2ZXJQb3J0KCkgewogICAgICAgICAgICAg\nICAgICAgIHJldHVybiBwb3J0OwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgcHVibGljIGlu\ndCBnZXRTU0xTZXJ2ZXJQb3J0KCkgewogICAgICAgICAgICAgICAgICAgIHJl\ndHVybiBzc2xQb3J0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBzdGFydCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgICAgICBzZXJ2ZXIgPSBuZXcgb3JnLmFwYWNoZS5o\nZWR3aWcuc2VydmVyLm5ldHR5LlB1YlN1YlNlcnZlcihjb25mKTsKICAgICAg\nICAgICAgc2VydmVyLnN0YXJ0KCk7CiAgICAgICAgfQoKICAgICAgICB2b2lk\nIHN0b3AoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKG51\nbGwgIT0gc2VydmVyKSB7CiAgICAgICAgICAgICAgICBzZXJ2ZXIuc2h1dGRv\nd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBzdGF0\naWMgY2xhc3MgQ2xpZW50Q3VycmVudCB7CiAgICAgICAgb3JnLmFwYWNoZS5o\nZWR3aWcuY2xpZW50LmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mOwog\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuQ2xpZW50IGNs\naWVudDsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYXBpLlB1\nYmxpc2hlciBwdWJsaXNoZXI7CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\nY2xpZW50LmFwaS5TdWJzY3JpYmVyIHN1YnNjcmliZXI7CgogICAgICAgIGNs\nYXNzIEludE1lc3NhZ2VIYW5kbGVyIGltcGxlbWVudHMgb3JnLmFwYWNoZS5o\nZWR3aWcuY2xpZW50LmFwaS5NZXNzYWdlSGFuZGxlciB7CiAgICAgICAgICAg\nIEJ5dGVTdHJpbmcgdG9waWM7CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgc3Vi\nSWQ7CiAgICAgICAgICAgIGludCBuZXh0OwoKICAgICAgICAgICAgQ291bnRE\nb3duTGF0Y2ggbGF0Y2g7CgogICAgICAgICAgICBJbnRNZXNzYWdlSGFuZGxl\ncihCeXRlU3RyaW5nIHQsIEJ5dGVTdHJpbmcgcywgaW50IHN0YXJ0LCBpbnQg\nbnVtKSB7CiAgICAgICAgICAgICAgICB0aGlzLnRvcGljID0gdDsKICAgICAg\nICAgICAgICAgIHRoaXMuc3ViSWQgPSBzOwogICAgICAgICAgICAgICAgdGhp\ncy5uZXh0ID0gc3RhcnQ7CiAgICAgICAgICAgICAgICB0aGlzLmxhdGNoID0g\nbmV3IENvdW50RG93bkxhdGNoKG51bSk7CiAgICAgICAgICAgIH0KCiAgICAg\nICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBkZWxp\ndmVyKEJ5dGVTdHJpbmcgdCwgQnl0ZVN0cmluZyBzLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgbXNnLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJh\nY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjb250ZXh0KSB7CiAgICAgICAg\nICAgICAgICBpZiAoIXQuZXF1YWxzKHRvcGljKSB8fCAhcy5lcXVhbHMoc3Vi\nSWQpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgaW50IG51bSA9IEludGVnZXIucGFy\nc2VJbnQobXNnLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAg\nICAgICAgICBpZiAobnVtID09IG5leHQpIHsKICAgICAgICAgICAgICAgICAg\nICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAgICArK25l\neHQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjYWxsYmFj\nay5vcGVyYXRpb25GaW5pc2hlZChjb250ZXh0LCBudWxsKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgcHVibGljIGJvb2xlYW4gYXdhaXQobG9uZyB0\naW1lb3V0LCBUaW1lVW5pdCB1bml0KQogICAgICAgICAgICB0aHJvd3MgSW50\nZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICAgICAgcmV0dXJuIGxh\ndGNoLmF3YWl0KHRpbWVvdXQsIHVuaXQpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQoKICAgICAgICBDbGllbnRDdXJyZW50KGZpbmFsIFN0cmluZyBjb25u\nZWN0U3RyaW5nKSB7CiAgICAgICAgICAgIHRoaXModHJ1ZSwgY29ubmVjdFN0\ncmluZyk7CiAgICAgICAgfQoKICAgICAgICBDbGllbnRDdXJyZW50KGZpbmFs\nIGJvb2xlYW4gYXV0b0NvbnN1bWVFbmFibGVkLCBmaW5hbCBTdHJpbmcgY29u\nbmVjdFN0cmluZykgewogICAgICAgICAgICBjb25mID0gbmV3IG9yZy5hcGFj\naGUuaGVkd2lnLmNsaWVudC5jb25mLkNsaWVudENvbmZpZ3VyYXRpb24oKSB7\nCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1\nYmxpYyBib29sZWFuIGlzQXV0b1NlbmRDb25zdW1lTWVzc2FnZUVuYWJsZWQo\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF1dG9Db25zdW1lRW5h\nYmxlZDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIGludCBnZXRDb25zdW1lZE1l\nc3NhZ2VzQnVmZmVyU2l6ZSgpIHsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm4gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHJvdGVjdGVkIEhlZHdpZ1NvY2tldEFk\nZHJlc3MgZ2V0RGVmYXVsdFNlcnZlckhlZHdpZ1NvY2tldEFkZHJlc3MoKSB7\nCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBIZWR3aWdTb2NrZXRB\nZGRyZXNzKGNvbm5lY3RTdHJpbmcpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9OwogICAgICAgICAgICBjbGllbnQgPSBuZXcgb3JnLmFwYWNo\nZS5oZWR3aWcuY2xpZW50LkhlZHdpZ0NsaWVudChjb25mKTsKICAgICAgICAg\nICAgcHVibGlzaGVyID0gY2xpZW50LmdldFB1Ymxpc2hlcigpOwogICAgICAg\nICAgICBzdWJzY3JpYmVyID0gY2xpZW50LmdldFN1YnNjcmliZXIoKTsKICAg\nICAgICB9CgogICAgICAgIHZvaWQgY2xvc2UoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgaWYgKG51bGwgIT0gY2xpZW50KSB7CiAgICAgICAg\nICAgICAgICBjbGllbnQuY2xvc2UoKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KCiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHB1Ymxpc2goCiAgICAgICAgICAgIEJ5\ndGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgZGF0YSkgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgbWVzc2FnZSA9CiAgICAgICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAgICAgICAgIC5z\nZXRCb2R5KGRhdGEpLmJ1aWxkKCk7CiAgICAgICAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXNwb25z\nZSByZXNwID0KICAgICAgICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRv\ncGljLCBtZXNzYWdlKTsKICAgICAgICAgICAgaWYgKG51bGwgPT0gcmVzcCkg\newogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIHJlc3AuZ2V0UHVibGlzaGVkTXNnSWQoKTsK\nICAgICAgICB9CgogICAgICAgIHZvaWQgcHVibGlzaEludHMoQnl0ZVN0cmlu\nZyB0b3BpYywgaW50IHN0YXJ0LCBpbnQgbnVtKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgZm9yIChpbnQgaT0wOyBpPG51bTsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlIG1zZyA9CiAgICAgICAgICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keShCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOCgiIiArIChzdGFydCtpKSkpLmJ1aWxkKCk7CiAgICAgICAgICAgICAg\nICBwdWJsaXNoZXIucHVibGlzaCh0b3BpYywgbXNnKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgdm9pZCBzZW5kWEV4cGVjdExhc3RZKEJ5\ndGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3ViaWQsIGZpbmFsIGludCB4\nLCBmaW5hbCBpbnQgeSkKICAgICAgICB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgZm9yIChpbnQgaT0wOyBpPHg7IGkrKykgewogICAgICAgICAg\nICAgICAgcHVibGlzaGVyLnB1Ymxpc2godG9waWMsIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UubmV3QnVpbGRl\ncigpLnNldEJvZHkoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoU3RyaW5nLnZhbHVl\nT2YoaSkpKS5idWlsZCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBz\ndWJzY3JpYmVyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVl\nc3QuQ3JlYXRlT3JBdHRhY2guQVRUQUNIKTsKCiAgICAgICAgICAgIGZpbmFs\nIEF0b21pY0ludGVnZXIgZXhwZWN0ZWQgPSBuZXcgQXRvbWljSW50ZWdlcih4\nIC0geSk7CiAgICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNo\nID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgICAgICBzdWJzY3Jp\nYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YmlkLCBuZXcgb3JnLmFwYWNo\nZS5oZWR3aWcuY2xpZW50LmFwaS5NZXNzYWdlSGFuZGxlcigpIHsKICAgICAg\nICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgc3luY2hyb25p\nemVkIHB1YmxpYyB2b2lkIGRlbGl2ZXIoQnl0ZVN0cmluZyB0b3BpYywgQnl0\nZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIG1zZywKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9i\namVjdCBjb250ZXh0KSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaW50IHZhbHVlID0gSW50ZWdlci52YWx1\nZU9mKG1zZy5nZXRCb2R5KCkudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAg\nICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gZXhwZWN0ZWQuZ2V0KCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLmluY3JlbWVu\ndEFuZEdldCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJEaWQg\nbm90IHJlY2VpdmUgZXhwZWN0ZWQgdmFsdWUsIGV4cGVjdGVkIHt9LCBnb3Qg\ne30iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGV4cGVjdGVkLmdldCgpLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBleHBlY3RlZC5zZXQoMCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWQu\nZ2V0KCkgPT0geCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0\nY2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNo\nZWQoY29udGV4dCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJSZWNlaXZlZCBiYWQgbWVzc2FnZSIsIGUpOwogICAgICAg\nICAgICAgICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0p\nOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJUaW1lZCBvdXQgd2FpdGluZyBm\nb3IgbWVzc2FnZXMgWSBpcyAiICsgeSArICIgZXhwZWN0ZWQgaXMgY3VycmVu\ndGx5ICIKICAgICAgICAgICAgICAgICAgICAgICArIGV4cGVjdGVkLmdldCgp\nLCBsYXRjaC5hd2FpdCgxMCwgVGltZVVuaXQuU0VDT05EUykpOwogICAgICAg\nICAgICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBleHBlY3RlZCBtZXNzYWdl\nIHdpdGggIiArIHgsIHgsIGV4cGVjdGVkLmdldCgpKTsKICAgICAgICAgICAg\nc3Vic2NyaWJlci5zdG9wRGVsaXZlcnkodG9waWMsIHN1YmlkKTsKICAgICAg\nICAgICAgc3Vic2NyaWJlci5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3Vi\naWQpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCByZWNlaXZlTnVtTW9kTShm\naW5hbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBCeXRlU3RyaW5nIHN1Ymlk\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50IHN0YXJ0\nLCBmaW5hbCBpbnQgbnVtLCBmaW5hbCBpbnQgTSkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLmZpbHRlci5TZXJ2\nZXJNZXNzYWdlRmlsdGVyIGZpbHRlciA9CiAgICAgICAgICAgICAgICBuZXcg\nb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVyLlNlcnZlck1lc3NhZ2VGaWx0ZXIo\nKSB7CgogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVyLlNlcnZlck1lc3Nh\nZ2VGaWx0ZXIKICAgICAgICAgICAgICAgICAgICBpbml0aWFsaXplKENvbmZp\nZ3VyYXRpb24gY29uZikgewogICAgICAgICAgICAgICAgICAgIC8vIGRvIG5v\ndGhpbmcKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHVuaW5pdGlhbGl6ZSgpIHsKICAgICAg\nICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nOwogICAgICAgICAgICAgICAg\nfQoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLmZpbHRlci5NZXNzYWdlRmlsdGVy\nQmFzZQogICAgICAgICAgICAgICAgICAgIHNldFN1YnNjcmlwdGlvblByZWZl\ncmVuY2VzKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkLAogICAgICAgICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblByZWZlcmVuY2Vz\nIHByZWZlcmVuY2VzKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90\naGluZzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyBib29sZWFuIHRlc3RNZXNzYWdlKG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgbXNn\nKSB7CiAgICAgICAgICAgICAgICAgICAgaW50IHZhbHVlID0gSW50ZWdlci52\nYWx1ZU9mKG1zZy5nZXRCb2R5KCkudG9TdHJpbmdVdGY4KCkpOwogICAgICAg\nICAgICAgICAgICAgIHJldHVybiAwID09IHZhbHVlICUgTTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfTsKICAgICAgICAgICAgZmlsdGVyLmlu\naXRpYWxpemUoY29uZi5nZXRDb25mKCkpOwoKICAgICAgICAgICAgc3Vic2Ny\naWJlci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNy\nZWF0ZU9yQXR0YWNoLkFUVEFDSCk7CiAgICAgICAgICAgIGZpbmFsIGludCBi\nYXNlID0gc3RhcnQgKyBNIC0gc3RhcnQgJSBNOwogICAgICAgICAgICBmaW5h\nbCBBdG9taWNJbnRlZ2VyIGV4cGVjdGVkID0gbmV3IEF0b21pY0ludGVnZXIo\nYmFzZSk7CiAgICAgICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGxhdGNo\nID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgICAgICBzdWJzY3Jp\nYmVyLnN0YXJ0RGVsaXZlcnlXaXRoRmlsdGVyKHRvcGljLCBzdWJpZCwgbmV3\nIG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuTWVzc2FnZUhhbmRsZXIo\nKSB7CiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQg\nZGVsaXZlcihCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmli\nZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2UgbXNnLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcudXRp\nbC5DYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGNvbnRleHQpIHsK\nICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAg\nICAgICBpbnQgdmFsdWUgPSBJbnRlZ2VyLnZhbHVlT2YobXNnLmdldEJvZHko\nKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIGR1cGxpY2F0ZWQgbWVzc2FnZXMgcmVjZWl2ZWQsIGlnbm9yZSB0aGVtCiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA+IHN0YXJ0KSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gZXhwZWN0\nZWQuZ2V0KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBl\neHBlY3RlZC5hZGRBbmRHZXQoTSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZ2dlci5lcnJvcigiRGlkIG5vdCByZWNlaXZlIGV4cGVjdGVkIHZhbHVl\nLCBleHBlY3RlZCB7fSwgZ290IHt9IiwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQuZ2V0KCksIHZhbHVl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZC5z\nZXQoMCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF0Y2gu\nY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhwZWN0ZWQuZ2V0KCkg\nPT0gKGJhc2UgKyBudW0gKiBNKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVk\nKGNvbnRleHQsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dl\nci5lcnJvcigiUmVjZWl2ZWQgYmFkIG1lc3NhZ2UiLCBlKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAo\nb3JnLmFwYWNoZS5oZWR3aWcuZmlsdGVyLkNsaWVudE1lc3NhZ2VGaWx0ZXIp\nIGZpbHRlcik7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlRpbWVkIG91dCB3\nYWl0aW5nIGZvciBtZXNzYWdlcyBtb2QgIiArIE0gKyAiIGV4cGVjdGVkIGlz\nICIgKyBleHBlY3RlZC5nZXQoKSwKICAgICAgICAgICAgICAgICAgICAgICBs\nYXRjaC5hd2FpdCgxMCwgVGltZVVuaXQuU0VDT05EUykpOwogICAgICAgICAg\nICBhc3NlcnRFcXVhbHMoIlNob3VsZCBiZSBleHBlY3RlZCBtZXNzYWdlIHdp\ndGggIiArIChiYXNlICsgbnVtICogTSksIChiYXNlICsgbnVtKk0pLCBleHBl\nY3RlZC5nZXQoKSk7CiAgICAgICAgICAgIHN1YnNjcmliZXIuc3RvcERlbGl2\nZXJ5KHRvcGljLCBzdWJpZCk7CiAgICAgICAgICAgIGZpbHRlci51bmluaXRp\nYWxpemUoKTsKICAgICAgICAgICAgc3Vic2NyaWJlci5jbG9zZVN1YnNjcmlw\ndGlvbih0b3BpYywgc3ViaWQpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBz\ndWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3Jp\nYmVySWQpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25PcHRpb25zIG9wdGlvbnMgPQogICAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9u\nT3B0aW9ucy5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgICAgIC5zZXRDcmVh\ndGVPckF0dGFjaChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkNSRUFU\nRV9PUl9BVFRBQ0gpLmJ1aWxkKCk7CiAgICAgICAgICAgIHN1YnNjcmliZSh0\nb3BpYywgc3Vic2NyaWJlcklkLCBvcHRpb25zKTsKICAgICAgICB9CgogICAg\nICAgIHZvaWQgc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJp\nbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvbk9wdGlvbnMgb3B0aW9ucykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKHRvcGljLCBzdWJzY3JpYmVy\nSWQsIG9wdGlvbnMpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBjbG9zZVN1\nYnNjcmlwdGlvbihCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNj\ncmliZXJJZCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIHN1YnNj\ncmliZXIuY2xvc2VTdWJzY3JpcHRpb24odG9waWMsIHN1YnNjcmliZXJJZCk7\nCiAgICAgICAgfQoKICAgICAgICB2b2lkIHJlY2VpdmVJbnRzKEJ5dGVTdHJp\nbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBpbnQgc3RhcnQs\nIGludCBudW0pIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBJbnRN\nZXNzYWdlSGFuZGxlciBtc2dIYW5kbGVyID0gbmV3IEludE1lc3NhZ2VIYW5k\nbGVyKHRvcGljLCBzdWJzY3JpYmVySWQsIHN0YXJ0LCBudW0pOwogICAgICAg\nICAgICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YnNjcmli\nZXJJZCwgbXNnSGFuZGxlcik7CiAgICAgICAgICAgIG1zZ0hhbmRsZXIuYXdh\naXQobnVtLCBUaW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgc3Vic2Ny\naWJlci5zdG9wRGVsaXZlcnkodG9waWMsIHN1YnNjcmliZXJJZCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyB0aHJvdHRsZSBkb2Vzbid0IHdvcmsgdGFsa2lu\nZyB3aXRoIDQxIHNlcnZlcgogICAgICAgIHZvaWQgdGhyb3R0bGVYNDEoQnl0\nZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJpZCwgZmluYWwgaW50IFgp\nCiAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvbk9wdGlvbnMgb3B0aW9ucyA9CiAgICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRp\nb25PcHRpb25zLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAgICAgLnNldENy\nZWF0ZU9yQXR0YWNoKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2guQ1JF\nQVRFX09SX0FUVEFDSCkKICAgICAgICAgICAgICAgIC5zZXRNZXNzYWdlV2lu\nZG93U2l6ZShYKSAuYnVpbGQoKTsKICAgICAgICAgICAgc3Vic2NyaWJlKHRv\ncGljLCBzdWJpZCwgb3B0aW9ucyk7CiAgICAgICAgICAgIGNsb3NlU3Vic2Ny\naXB0aW9uKHRvcGljLCBzdWJpZCk7CiAgICAgICAgICAgIHB1Ymxpc2hJbnRz\nKHRvcGljLCAxLCAzKlgpOwogICAgICAgICAgICBzdWJzY3JpYmUodG9waWMs\nIHN1YmlkKTsKCiAgICAgICAgICAgIGZpbmFsIEF0b21pY0ludGVnZXIgZXhw\nZWN0ZWQgPSBuZXcgQXRvbWljSW50ZWdlcigxKTsKICAgICAgICAgICAgZmlu\nYWwgQ291bnREb3duTGF0Y2ggdGhyb3R0bGVMYXRjaCA9IG5ldyBDb3VudERv\nd25MYXRjaCgxKTsKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2gg\nbm9uVGhyb3R0bGVMYXRjaCA9IG5ldyBDb3VudERvd25MYXRjaCgxKTsKICAg\nICAgICAgICAgc3Vic2NyaWJlci5zdGFydERlbGl2ZXJ5KHRvcGljLCBzdWJp\nZCwgbmV3IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuTWVzc2FnZUhh\nbmRsZXIoKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBkZWxpdmVyKEJ5dGVT\ndHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZSBtc2csCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrPFZv\naWQ+IGNhbGxiYWNrLCBPYmplY3QgY29udGV4dCkgewogICAgICAgICAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGludCB2YWx1\nZSA9IEludGVnZXIudmFsdWVPZihtc2cuZ2V0Qm9keSgpLnRvU3RyaW5nVXRm\nOCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJS\nZWNlaXZlZCBtZXNzYWdlIHt9LCIsIHZhbHVlKTsKCiAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICh2YWx1ZSA9PSBleHBlY3RlZC5nZXQoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQuaW5jcmVtZW50QW5k\nR2V0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAvLyBlcnJvciBjb25kaXRpb24KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiRGlkIG5v\ndCByZWNlaXZlIGV4cGVjdGVkIHZhbHVlLCBleHBlY3RlZCB7fSwgZ290IHt9\nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBl\neHBlY3RlZC5nZXQoKSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZXhwZWN0ZWQuc2V0KDApOwogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdGhyb3R0bGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIG5vblRocm90dGxlTGF0Y2guY291bnREb3duKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgaWYgKGV4cGVjdGVkLmdldCgpID4gWCsxKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvdHRsZUxhdGNoLmNvdW50RG93bigpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChleHBlY3RlZC5nZXQoKSA9PSAoMyAqIFggKyAxKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbm9uVGhyb3R0bGVMYXRjaC5jb3Vu\ndERvd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChjb250\nZXh0LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJy\nb3IoIlJlY2VpdmVkIGJhZCBtZXNzYWdlIiwgZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHRocm90dGxlTGF0Y2guY291bnREb3duKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIG5vblRocm90dGxlTGF0Y2guY291bnREb3duKCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9KTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiU2hvdWxkIFJl\nY2VpdmUgbW9yZSBtZXNzYWdlcyB0aGFuIHRocm90dGxlIHZhbHVlICIgKyBY\nLAogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdHRsZUxhdGNoLmF3YWl0\nKDEwLCBUaW1lVW5pdC5TRUNPTkRTKSk7CgogICAgICAgICAgICBhc3NlcnRU\ncnVlKCJUaW1lZCBvdXQgd2FpdGluZyBmb3IgbWVzc2FnZXMgIiArICgzKlgg\nKyAxKSwKICAgICAgICAgICAgICAgICAgICAgICBub25UaHJvdHRsZUxhdGNo\nLmF3YWl0KDEwLCBUaW1lVW5pdC5TRUNPTkRTKSk7CiAgICAgICAgICAgIGFz\nc2VydEVxdWFscygiU2hvdWxkIGJlIGV4cGVjdGVkIG1lc3NhZ2Ugd2l0aCAi\nICsgKDMqWCArIDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgMypYICsg\nMSwgZXhwZWN0ZWQuZ2V0KCkpOwoKICAgICAgICAgICAgc3Vic2NyaWJlci5z\ndG9wRGVsaXZlcnkodG9waWMsIHN1YmlkKTsKICAgICAgICAgICAgY2xvc2VT\ndWJzY3JpcHRpb24odG9waWMsIHN1YmlkKTsKICAgICAgICB9CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBUZXN0IGNvbXBhdGFiaWxpdHkgb2YgbWVzc2FnZSBi\nb3VuZCBiZXR3ZWVuIHZlcnNpb24gNC4wLjAgYW5kCiAgICAgKiBjdXJyZW50\nIHZlcnNpb24uCiAgICAgKgogICAgICogMSkgbWVzc2FnZSBib3VuZCBkb2Vz\nbid0IHRha2UgZWZmZWN0cyBvbiA0LjAuMCBzZXJ2ZXIuCiAgICAgKiAyKSBt\nZXNzYWdlIGJvdW5kIHRha2UgZWZmZWN0cyBvbiBib3RoIDQuMS4wIGFuZCBj\ndXJyZW50IHNlcnZlcgogICAgICovCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAw\nKQogICAgcHVibGljIHZvaWQgdGVzdE1lc3NhZ2VCb3VuZENvbXBhdCgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBC\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgidGVzdE1lc3NhZ2VCb3VuZENvbXBh\ndCIpOwogICAgICAgIEJ5dGVTdHJpbmcgc3ViaWQgPSBCeXRlU3RyaW5nLmNv\ncHlGcm9tVXRmOCgibXlzdWIiKTsKCiAgICAgICAgaW50IHBvcnQgPSBQb3J0\nTWFuYWdlci5uZXh0RnJlZVBvcnQoKTsKICAgICAgICBpbnQgc3NsUG9ydCA9\nIFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwoKICAgICAgICAvLyBzdGFy\ndCBib29ra2VlcGVyIDQwMAogICAgICAgIEJvb2tLZWVwZXJDbHVzdGVyNDAw\nIGJrYzQwMCA9IG5ldyBCb29rS2VlcGVyQ2x1c3RlcjQwMCgzKTsKICAgICAg\nICBia2M0MDAuc3RhcnQoKTsKCiAgICAgICAgLy8gc3RhcnQgNDAwIHNlcnZl\ncgogICAgICAgIFNlcnZlcjQwMCBzNDAwID0gbmV3IFNlcnZlcjQwMCh6a1V0\naWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLCBwb3J0LCBzc2xQb3J0\nKTsKICAgICAgICBzNDAwLnN0YXJ0KCk7CgogICAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9w\ndGlvbnMgb3B0aW9uczVjdXIgPQogICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRp\nb25zLm5ld0J1aWxkZXIoKQogICAgICAgICAgICAuc2V0Q3JlYXRlT3JBdHRh\nY2gob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRU\nQUNIKQogICAgICAgICAgICAuc2V0TWVzc2FnZUJvdW5kKDUpLmJ1aWxkKCk7\nCgogICAgICAgIENsaWVudEN1cnJlbnQgY2N1ciA9IG5ldyBDbGllbnRDdXJy\nZW50KCJsb2NhbGhvc3Q6IiArIHBvcnQgKyAiOiIgKyBzc2xQb3J0KTsKICAg\nICAgICBjY3VyLnN1YnNjcmliZSh0b3BpYywgc3ViaWQsIG9wdGlvbnM1Y3Vy\nKTsKICAgICAgICBjY3VyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJp\nZCk7CiAgICAgICAgY2N1ci5zZW5kWEV4cGVjdExhc3RZKHRvcGljLCBzdWJp\nZCwgNTAsIDUwKTsKCiAgICAgICAgLy8gc3RvcCA0MDAgc2VydmVycwogICAg\nICAgIHM0MDAuc3RvcCgpOwogICAgICAgIGJrYzQwMC5zdG9wKCk7CgogICAg\nICAgIC8vIHN0YXJ0IGJvb2trZWVwZXIgNDEwCiAgICAgICAgQm9va0tlZXBl\nckNsdXN0ZXI0MTAgYmtjNDEwID0gbmV3IEJvb2tLZWVwZXJDbHVzdGVyNDEw\nKDMpOwogICAgICAgIGJrYzQxMC5zdGFydCgpOwoKICAgICAgICAvLyBzdGFy\ndCA0MTAgc2VydmVyCiAgICAgICAgU2VydmVyNDEwIHM0MTAgPSBuZXcgU2Vy\ndmVyNDEwKHprVXRpbC5nZXRab29LZWVwZXJDb25uZWN0U3RyaW5nKCksIHBv\ncnQsIHNzbFBvcnQpOwogICAgICAgIHM0MTAuc3RhcnQoKTsKCiAgICAgICAg\nY2N1ci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRpb25zNWN1cik7CiAg\nICAgICAgY2N1ci5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQpOwog\nICAgICAgIGNjdXIuc2VuZFhFeHBlY3RMYXN0WSh0b3BpYywgc3ViaWQsIDUw\nLCA1KTsKCiAgICAgICAgLy8gc3RvcCA0MTAgc2VydmVycwogICAgICAgIHM0\nMTAuc3RvcCgpOwogICAgICAgIGJrYzQxMC5zdG9wKCk7CgogICAgICAgIC8v\nIHN0YXJ0IGJvb2trZWVwZXIgY3VycmVudAogICAgICAgIEJvb2tLZWVwZXJD\nbHVzdGVyQ3VycmVudCBia2NjdXIgPSBuZXcgQm9va0tlZXBlckNsdXN0ZXJD\ndXJyZW50KDMpOwogICAgICAgIGJrY2N1ci5zdGFydCgpOwoKICAgICAgICAv\nLyBzdGFydCBjdXJyZW50IHNlcnZlcgogICAgICAgIFNlcnZlckN1cnJlbnQg\nc2N1ciA9IG5ldyBTZXJ2ZXJDdXJyZW50KHprVXRpbC5nZXRab29LZWVwZXJD\nb25uZWN0U3RyaW5nKCksIHBvcnQsIHNzbFBvcnQpOwogICAgICAgIHNjdXIu\nc3RhcnQoKTsKCiAgICAgICAgY2N1ci5zdWJzY3JpYmUodG9waWMsIHN1Ymlk\nLCBvcHRpb25zNWN1cik7CiAgICAgICAgY2N1ci5jbG9zZVN1YnNjcmlwdGlv\nbih0b3BpYywgc3ViaWQpOwogICAgICAgIGNjdXIuc2VuZFhFeHBlY3RMYXN0\nWSh0b3BpYywgc3ViaWQsIDUwLCA1KTsKCiAgICAgICAgLy8gc3RvcCBjdXJy\nZW50IHNlcnZlcnMKICAgICAgICBzY3VyLnN0b3AoKTsKICAgICAgICBia2Nj\ndXIuc3RvcCgpOwoKICAgICAgICBjY3VyLmNsb3NlKCk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUZXN0IGNvbXBhdGFiaWxpdHkgb2YgcHVibGlzaCBpbnRl\ncmZhY2UgYmV0d2VlbiB2ZXJzaW9uIDQuMS4wCiAgICAgKiBhbmQgY3VycmVu\ndCB2ZXJpc29uLgogICAgICoKICAgICAqIDEpIDQuMS4wIGNsaWVudCBjb3Vs\nZCB0YWxrIHdpdGggY3VycmVudCBzZXJ2ZXIuCiAgICAgKiAyKSBjdXJyZW50\nIGNsaWVudCBjb3VsZCB0YWxrIHdpdGggNC4xLjAgc2VydmVyLAogICAgICog\nICAgYnV0IG5vIG1lc3NhZ2Ugc2VxIGlkIHdvdWxkIGJlIHJldHVybmVkCiAg\nICAgKi8KICAgIEBUZXN0KHRpbWVvdXQ9NjAwMDApCiAgICBwdWJsaWMgdm9p\nZCB0ZXN0UHVibGlzaENvbXBhdDQxMCgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOCgiVGVzdFB1Ymxpc2hDb21wYXQ0MTAiKTsKICAgICAgICBCeXRlU3Ry\naW5nIGRhdGEgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgidGVzdGRhdGEi\nKTsKCiAgICAgICAgLy8gc3RhcnQgYm9va2tlZXBlciA0MTAKICAgICAgICBC\nb29rS2VlcGVyQ2x1c3RlcjQxMCBia2M0MTAgPSBuZXcgQm9va0tlZXBlckNs\ndXN0ZXI0MTAoMyk7CiAgICAgICAgYmtjNDEwLnN0YXJ0KCk7CgogICAgICAg\nIGludCBwb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7CiAgICAg\nICAgaW50IHNzbFBvcnQgPSBQb3J0TWFuYWdlci5uZXh0RnJlZVBvcnQoKTsK\nCiAgICAgICAgLy8gc3RhcnQgNDEwIHNlcnZlcgogICAgICAgIFNlcnZlcjQx\nMCBzNDEwID0gbmV3IFNlcnZlcjQxMCh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpLCBwb3J0LCBzc2xQb3J0KTsKICAgICAgICBzNDEwLnN0\nYXJ0KCk7CgogICAgICAgIENsaWVudEN1cnJlbnQgY2N1ciA9IG5ldyBDbGll\nbnRDdXJyZW50KCJsb2NhbGhvc3Q6Iitwb3J0KyI6Iitzc2xQb3J0KTsKICAg\nICAgICBDbGllbnQ0MTAgYzQxMCA9IG5ldyBDbGllbnQ0MTAoImxvY2FsaG9z\ndDoiK3BvcnQrIjoiK3NzbFBvcnQpOwoKICAgICAgICAvLyBjbGllbnQgYzQx\nMCBjb3VsZCBwdWJsaXNoIG1lc3NhZ2UgdG8gNDEwIHNlcnZlcgogICAgICAg\nIGFzc2VydE51bGwoYzQxMC5wdWJsaXNoKHRvcGljLCBkYXRhKSk7CiAgICAg\nICAgLy8gY2xpZW50IGNjdXIgY291bGQgcHVibGlzaCBtZXNzYWdlIHRvIDQx\nMCBzZXJ2ZXIKICAgICAgICAvLyBidXQgbm8gbWVzc2FnZSBzZXEgaWQgd291\nbGQgYmUgcmV0dXJuZWQKICAgICAgICBhc3NlcnROdWxsKGNjdXIucHVibGlz\naCh0b3BpYywgZGF0YSkpOwoKICAgICAgICAvLyBzdG9wIDQxMCBzZXJ2ZXIK\nICAgICAgICBzNDEwLnN0b3AoKTsKCiAgICAgICAgLy8gc3RhcnQgY3VycmVu\ndCBzZXJ2ZXIKICAgICAgICBTZXJ2ZXJDdXJyZW50IHNjdXIgPSBuZXcgU2Vy\ndmVyQ3VycmVudCh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygp\nLCBwb3J0LCBzc2xQb3J0KTsKICAgICAgICBzY3VyLnN0YXJ0KCk7CgogICAg\nICAgIC8vIGNsaWVudCBjNDEwIGNvdWxkIHB1Ymxpc2ggbWVzc2FnZSB0byA0\nMTAgc2VydmVyCiAgICAgICAgLy8gYnV0IG5vIG1lc3NhZ2Ugc2VxIGlkIHdv\ndWxkIGJlIHJldHVybmVkCiAgICAgICAgYXNzZXJ0TnVsbChjNDEwLnB1Ymxp\nc2godG9waWMsIGRhdGEpKTsKICAgICAgICAvLyBjbGllbnQgY2N1ciBjb3Vs\nZCBwdWJsaXNoIG1lc3NhZ2UgdG8gY3VycmVudCBzZXJ2ZXIKICAgICAgICBh\nc3NlcnROb3ROdWxsKGNjdXIucHVibGlzaCh0b3BpYywgZGF0YSkpOwoKICAg\nICAgICBjY3VyLmNsb3NlKCk7CiAgICAgICAgYzQxMC5jbG9zZSgpOwoKICAg\nICAgICAvLyBzdG9wIGN1cnJlbnQgc2VydmVyCiAgICAgICAgc2N1ci5zdG9w\nKCk7CiAgICAgICAgYmtjNDEwLnN0b3AoKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIFRlc3QgY29tcGF0YWJpbGl0eSBiZXR3ZWVuIHZlcnNpb24gNC4xLjAg\nYW5kIHRoZSBjdXJyZW50IHZlcnNpb24uCiAgICAgKgogICAgICogQSBjdXJy\nZW50IHNlcnZlciBjb3VsZCByZWFkIHN1YnNjcmlwdGlvbiBkYXRhIHJlY29y\nZGVkIGJ5IDQuMS4wIHNlcnZlci4KICAgICAqLwogICAgQFRlc3QodGltZW91\ndD02MDAwMCkKICAgIHB1YmxpYyB2b2lkIHRlc3RTdWJzY3JpcHRpb25EYXRh\nQ29tcGF0NDEwKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZVN0\ncmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJUZXN0Q29t\ncGF0NDEwIik7CiAgICAgICAgQnl0ZVN0cmluZyBzdWI0MTAgPSBCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOCgic3ViNDEwIik7CiAgICAgICAgQnl0ZVN0cmlu\nZyBzdWJjdXIgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgic3ViY3VyIik7\nCgogICAgICAgIC8vIHN0YXJ0IGJvb2trZWVwZXIgNDEwCiAgICAgICAgQm9v\na0tlZXBlckNsdXN0ZXI0MTAgYmtjNDEwID0gbmV3IEJvb2tLZWVwZXJDbHVz\ndGVyNDEwKDMpOwogICAgICAgIGJrYzQxMC5zdGFydCgpOwoKICAgICAgICBp\nbnQgcG9ydCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAg\nIGludCBzc2xQb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7Cgog\nICAgICAgIC8vIHN0YXJ0IDQxMCBzZXJ2ZXIKICAgICAgICBTZXJ2ZXI0MTAg\nczQxMCA9IG5ldyBTZXJ2ZXI0MTAoemtVdGlsLmdldFpvb0tlZXBlckNvbm5l\nY3RTdHJpbmcoKSwgcG9ydCwgc3NsUG9ydCk7CiAgICAgICAgczQxMC5zdGFy\ndCgpOwoKICAgICAgICBDbGllbnQ0MTAgYzQxMCA9IG5ldyBDbGllbnQ0MTAo\nImxvY2FsaG9zdDoiK3BvcnQrIjoiK3NzbFBvcnQpOwogICAgICAgIGM0MTAu\nc3Vic2NyaWJlKHRvcGljLCBzdWI0MTApOwogICAgICAgIGM0MTAuY2xvc2VT\ndWJzY3JpcHRpb24odG9waWMsIHN1YjQxMCk7CiAgICAgICAgVGhyZWFkLnNs\nZWVwKDEwMDApOyAvLyBnaXZlIHNlcnZlciB0aW1lIHRvIHJ1biBkaXNjb25u\nZWN0IGxvZ2ljIChCT09LS0VFUEVSLTUxMykKCiAgICAgICAgQ2xpZW50Q3Vy\ncmVudCBjY3VyID0gbmV3IENsaWVudEN1cnJlbnQoImxvY2FsaG9zdDoiK3Bv\ncnQrIjoiK3NzbFBvcnQpOwogICAgICAgIGNjdXIuc3Vic2NyaWJlKHRvcGlj\nLCBzdWJjdXIpOwogICAgICAgIGNjdXIuY2xvc2VTdWJzY3JpcHRpb24odG9w\naWMsIHN1YmN1cik7CgogICAgICAgIC8vIHB1Ymxpc2ggbWVzc2FnZXMgdXNp\nbmcgb2xkIGNsaWVudAogICAgICAgIGM0MTAucHVibGlzaEludHModG9waWMs\nIDAsIDEwKTsKICAgICAgICAvLyBzdG9wIDQxMCBzZXJ2ZXIKICAgICAgICBz\nNDEwLnN0b3AoKTsKCiAgICAgICAgLy8gc3RhcnQgY3VycmVudCBzZXJ2ZXIK\nICAgICAgICBTZXJ2ZXJDdXJyZW50IHNjdXIgPSBuZXcgU2VydmVyQ3VycmVu\ndCh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29ubmVjdFN0cmluZygpLAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvcnQs\nIHNzbFBvcnQpOwogICAgICAgIHNjdXIuc3RhcnQoKTsKCiAgICAgICAgYzQx\nMC5zdWJzY3JpYmUodG9waWMsIHN1YjQxMCk7CiAgICAgICAgYzQxMC5yZWNl\naXZlSW50cyh0b3BpYywgc3ViNDEwLCAwLCAxMCk7CgogICAgICAgIGNjdXIu\nc3Vic2NyaWJlKHRvcGljLCBzdWJjdXIpOwogICAgICAgIGNjdXIucmVjZWl2\nZUludHModG9waWMsIHN1YmN1ciwgMCwgMTApOwoKICAgICAgICAvLyBwdWJs\naXNoIG1lc3NhZ2VzIHVzaW5nIGN1cnJlbnQgY2xpZW50CiAgICAgICAgY2N1\nci5wdWJsaXNoSW50cyh0b3BpYywgMTAsIDEwKTsKCiAgICAgICAgYzQxMC5y\nZWNlaXZlSW50cyh0b3BpYywgc3ViNDEwLCAxMCwgMTApOwogICAgICAgIGNj\ndXIucmVjZWl2ZUludHModG9waWMsIHN1YmN1ciwgMTAsIDEwKTsKCiAgICAg\nICAgLy8gc3RvcCBjdXJyZW50IHNlcnZlcgogICAgICAgIHNjdXIuc3RvcCgp\nOwoKICAgICAgICBjNDEwLmNsb3NlKCk7CiAgICAgICAgY2N1ci5jbG9zZSgp\nOwoKICAgICAgICAvLyBzdG9wIGJvb2trZWVwZXIgY2x1c3RlcgogICAgICAg\nIGJrYzQxMC5zdG9wKCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IGNv\nbXBhdGFiaWxpdHkgYmV0d2VlbiB2ZXJzaW9uIDQuMS4wIGFuZCB0aGUgY3Vy\ncmVudCB2ZXJzaW9uLgogICAgICoKICAgICAqIEEgNC4xLjAgY2xpZW50IGNv\ndWxkIG5vdCB1cGRhdGUgbWVzc2FnZSBib3VuZCwgd2hpbGUgY3VycmVudCBj\nb3VsZCBkbyBpdC4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RVcGRhdGVNZXNzYWdlQm91bmRDb21wYXQ0\nMTAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRv\ncGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIlRlc3RVcGRhdGVNZXNz\nYWdlQm91bmRDb21wYXQ0MTAiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1Ymlk\nID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15c3ViIik7CgogICAgICAg\nIC8vIHN0YXJ0IGJvb2trZWVwZXIKICAgICAgICBCb29rS2VlcGVyQ2x1c3Rl\nckN1cnJlbnQgYmtjY3VyPSBuZXcgQm9va0tlZXBlckNsdXN0ZXJDdXJyZW50\nKDMpOwogICAgICAgIGJrY2N1ci5zdGFydCgpOwoKICAgICAgICBpbnQgcG9y\ndCA9IFBvcnRNYW5hZ2VyLm5leHRGcmVlUG9ydCgpOwogICAgICAgIGludCBz\nc2xQb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7CgogICAgICAg\nIC8vIHN0YXJ0IGh1YiBzZXJ2ZXIKICAgICAgICBTZXJ2ZXJDdXJyZW50IHNj\ndXIgPSBuZXcgU2VydmVyQ3VycmVudCh6a1V0aWwuZ2V0Wm9vS2VlcGVyQ29u\nbmVjdFN0cmluZygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHBvcnQsIHNzbFBvcnQpOwogICAgICAgIHNjdXIu\nc3RhcnQoKTsKCiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zNWN1\nciA9CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRlcigp\nCiAgICAgICAgICAgIC5zZXRDcmVhdGVPckF0dGFjaChvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0\nLkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpCiAgICAgICAgICAg\nIC5zZXRNZXNzYWdlQm91bmQoNSkuYnVpbGQoKTsKICAgICAgICBvcmcuYXBh\nY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zNXY0MTAgPQogICAgICAgICAg\nICBvcmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdCdWlsZGVyKCkKICAg\nICAgICAgICAgLnNldENyZWF0ZU9yQXR0YWNoKG9yZy5hcGFjaGUuaHdfdjRf\nMV8wLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpCiAgICAg\nICAgICAgIC5zZXRNZXNzYWdlQm91bmQoNSkuYnVpbGQoKTsKICAgICAgICBv\ncmcuYXBhY2hlLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zMjB2NDEwID0KICAg\nICAgICAgICAgb3JnLmFwYWNoZS5od192NF8xXzAuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVpbGRl\ncigpCiAgICAgICAgICAgIC5zZXRDcmVhdGVPckF0dGFjaChvcmcuYXBhY2hl\nLmh3X3Y0XzFfMC5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNI\nKQogICAgICAgICAgICAuc2V0TWVzc2FnZUJvdW5kKDIwKS5idWlsZCgpOwoK\nICAgICAgICBDbGllbnQ0MTAgYzQxMCA9IG5ldyBDbGllbnQ0MTAoImxvY2Fs\naG9zdDoiK3BvcnQrIjoiK3NzbFBvcnQpOwogICAgICAgIGM0MTAuc3Vic2Ny\naWJlKHRvcGljLCBzdWJpZCwgb3B0aW9uczIwdjQxMCk7CiAgICAgICAgYzQx\nMC5jbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3ViaWQpOwogICAgICAgIFRo\ncmVhZC5zbGVlcCgxMDAwKTsgLy8gZ2l2ZSBzZXJ2ZXIgdGltZSB0byBydW4g\nZGlzY29ubmVjdCBsb2dpYyAoQk9PS0tFRVBFUi01MTMpCgogICAgICAgIGM0\nMTAuc2VuZFhFeHBlY3RMYXN0WSh0b3BpYywgc3ViaWQsIDUwLCAyMCk7Cgog\nICAgICAgIGM0MTAuc3Vic2NyaWJlKHRvcGljLCBzdWJpZCwgb3B0aW9uczV2\nNDEwKTsKICAgICAgICBjNDEwLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBz\ndWJpZCk7CiAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOyAvLyBnaXZlIHNl\ncnZlciB0aW1lIHRvIHJ1biBkaXNjb25uZWN0IGxvZ2ljIChCT09LS0VFUEVS\nLTUxMykKCiAgICAgICAgLy8gdGhlIG1lc3NhZ2UgYm91bmQgaXNuJ3QgdXBk\nYXRlZC4KICAgICAgICBjNDEwLnNlbmRYRXhwZWN0TGFzdFkodG9waWMsIHN1\nYmlkLCA1MCwgMjApOwoKICAgICAgICBDbGllbnRDdXJyZW50IGNjdXIgPSBu\nZXcgQ2xpZW50Q3VycmVudCgibG9jYWxob3N0OiIrcG9ydCsiOiIrc3NsUG9y\ndCk7CiAgICAgICAgY2N1ci5zdWJzY3JpYmUodG9waWMsIHN1YmlkLCBvcHRp\nb25zNWN1cik7CiAgICAgICAgY2N1ci5jbG9zZVN1YnNjcmlwdGlvbih0b3Bp\nYywgc3ViaWQpOwogICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsgLy8gZ2l2\nZSBzZXJ2ZXIgdGltZSB0byBydW4gZGlzY29ubmVjdCBsb2dpYyAoQk9PS0tF\nRVBFUi01MTMpCgogICAgICAgIC8vIHRoZSBtZXNzYWdlIGJvdW5kIHNob3Vs\nZCBiZSB1cGRhdGVkLgogICAgICAgIGM0MTAuc2VuZFhFeHBlY3RMYXN0WSh0\nb3BpYywgc3ViaWQsIDUwLCA1KTsKCiAgICAgICAgLy8gc3RvcCBjdXJyZW50\nIHNlcnZlcgogICAgICAgIHNjdXIuc3RvcCgpOwoKICAgICAgICBjNDEwLmNs\nb3NlKCk7CiAgICAgICAgY2N1ci5jbG9zZSgpOwoKICAgICAgICAvLyBzdG9w\nIGJvb2trZWVwZXIgY2x1c3RlcgogICAgICAgIGJrY2N1ci5zdG9wKCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUZXN0IGNvbXBhdGFiaWxpdHkgYmV0d2Vl\nbiB2ZXJzaW9uIDQuMS4wIGFuZCB0aGUgY3VycmVudCB2ZXJzaW9uLgogICAg\nICoKICAgICAqIEEgY3VycmVudCBjbGllbnQgcnVubmluZyBtZXNzYWdlIGZp\nbHRlciB3b3VsZCBmYWlsIG9uIDQuMS4wIGh1YiBzZXJ2ZXJzLgogICAgICov\nCiAgICBAVGVzdCh0aW1lb3V0PTYwMDAwKQogICAgcHVibGljIHZvaWQgdGVz\ndENsaWVudE1lc3NhZ2VGaWx0ZXJDb21wYXQ0MTAoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5j\nb3B5RnJvbVV0ZjgoIlRlc3RVcGRhdGVNZXNzYWdlQm91bmRDb21wYXQ0MTAi\nKTsKICAgICAgICBCeXRlU3RyaW5nIHN1YmlkID0gQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgoIm15c3ViIik7CgogICAgICAgIC8vIHN0YXJ0IGJvb2trZWVw\nZXIKICAgICAgICBCb29rS2VlcGVyQ2x1c3RlcjQxMCBia2M0MTAgPSBuZXcg\nQm9va0tlZXBlckNsdXN0ZXI0MTAoMyk7CiAgICAgICAgYmtjNDEwLnN0YXJ0\nKCk7CgogICAgICAgIGludCBwb3J0ID0gUG9ydE1hbmFnZXIubmV4dEZyZWVQ\nb3J0KCk7CiAgICAgICAgaW50IHNzbFBvcnQgPSBQb3J0TWFuYWdlci5uZXh0\nRnJlZVBvcnQoKTsKCiAgICAgICAgLy8gc3RhcnQgaHViIHNlcnZlciA0MTAK\nICAgICAgICBTZXJ2ZXI0MTAgczQxMCA9IG5ldyBTZXJ2ZXI0MTAoemtVdGls\nLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSwgcG9ydCwgc3NsUG9ydCk7\nCiAgICAgICAgczQxMC5zdGFydCgpOwoKICAgICAgICBDbGllbnRDdXJyZW50\nIGNjdXIgPSBuZXcgQ2xpZW50Q3VycmVudCgibG9jYWxob3N0OiIrcG9ydCsi\nOiIrc3NsUG9ydCk7CiAgICAgICAgY2N1ci5zdWJzY3JpYmUodG9waWMsIHN1\nYmlkKTsKICAgICAgICBjY3VyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBz\ndWJpZCk7CgogICAgICAgIGNjdXIucHVibGlzaEludHModG9waWMsIDAsIDEw\nMCk7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY2N1ci5yZWNlaXZlTnVt\nTW9kTSh0b3BpYywgc3ViaWQsIDAsIDUwLCAyKTsKICAgICAgICAgICAgZmFp\nbCgiY2xpZW50LXNpZGUgZmlsdGVyIGNvdWxkIG5vdCBydW4gb24gNC4xLjAg\naHViIHNlcnZlciIpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCJTaG91bGQgZmFpbCB0byBydW4g\nY2xpZW50LXNpZGUgbWVzc2FnZSBmaWx0ZXIgb24gNC4xLjAgaHViIHNlcnZl\nci4iLCBlKTsKICAgICAgICAgICAgY2N1ci5jbG9zZVN1YnNjcmlwdGlvbih0\nb3BpYywgc3ViaWQpOwogICAgICAgIH0KCiAgICAgICAgLy8gc3RvcCA0MTAg\nc2VydmVyCiAgICAgICAgczQxMC5zdG9wKCk7CiAgICAgICAgLy8gc3RvcCBi\nb29ra2VlcGVyIGNsdXN0ZXIKICAgICAgICBia2M0MTAuc3RvcCgpOwogICAg\nfQoKICAgIC8qKgogICAgICogVGVzdCBjb21wYXRhYmlsaXR5IGJldHdlZW4g\ndmVyc2lvbiA0LjEuMCBhbmQgdGhlIGN1cnJlbnQgdmVyc2lvbi4KICAgICAq\nCiAgICAgKiBTZXJ2ZXIgc2lkZSB0aHJvdHRsaW5nIGRvZXMndCB3b3JrIHdo\nZW4gY3VycmVudCBjbGllbnQgY29ubmVjdHMgdG8gb2xkIHZlcnNpb24KICAg\nICAqIHNlcnZlci4KICAgICAqLwogICAgQFRlc3QodGltZW91dD02MDAwMCkK\nICAgIHB1YmxpYyB2b2lkIHRlc3RTZXJ2ZXJTaWRlVGhyb3R0bGVDb21wYXQ0\nMTAoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRv\ncGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIlRlc3RTZXJ2ZXJTaWRl\nVGhyb3R0bGVDb21wYXQ0MTAiKTsKICAgICAgICBCeXRlU3RyaW5nIHN1Ymlk\nID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIm15c3ViIik7CgogICAgICAg\nIC8vIHN0YXJ0IGJvb2trZWVwZXIKICAgICAgICBCb29rS2VlcGVyQ2x1c3Rl\ncjQxMCBia2M0MTAgPSBuZXcgQm9va0tlZXBlckNsdXN0ZXI0MTAoMyk7CiAg\nICAgICAgYmtjNDEwLnN0YXJ0KCk7CgogICAgICAgIGludCBwb3J0ID0gUG9y\ndE1hbmFnZXIubmV4dEZyZWVQb3J0KCk7CiAgICAgICAgaW50IHNzbFBvcnQg\nPSBQb3J0TWFuYWdlci5uZXh0RnJlZVBvcnQoKTsKCiAgICAgICAgLy8gc3Rh\ncnQgaHViIHNlcnZlciA0MTAKICAgICAgICBTZXJ2ZXI0MTAgczQxMCA9IG5l\ndyBTZXJ2ZXI0MTAoemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmco\nKSwgcG9ydCwgc3NsUG9ydCk7CiAgICAgICAgczQxMC5zdGFydCgpOwoKICAg\nICAgICBDbGllbnRDdXJyZW50IGNjdXIgPSBuZXcgQ2xpZW50Q3VycmVudChm\nYWxzZSwgImxvY2FsaG9zdDoiK3BvcnQrIjoiK3NzbFBvcnQpOwogICAgICAg\nIGNjdXIudGhyb3R0bGVYNDEodG9waWMsIHN1YmlkLCAxMCk7CgogICAgICAg\nIGNjdXIuY2xvc2UoKTsKCiAgICAgICAgLy8gc3RvcCA0MTAgc2VydmVyCiAg\nICAgICAgczQxMC5zdG9wKCk7CiAgICAgICAgLy8gc3RvcCBib29ra2VlcGVy\nIGNsdXN0ZXIKICAgICAgICBia2M0MTAuc3RvcCgpOwogICAgfQp9Cg==\n","encoding":"base64"}

