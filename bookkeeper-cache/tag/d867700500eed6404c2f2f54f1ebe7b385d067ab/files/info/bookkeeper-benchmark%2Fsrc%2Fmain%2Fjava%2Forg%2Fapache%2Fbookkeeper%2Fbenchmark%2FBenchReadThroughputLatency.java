{"sha":"846b7c12b3aa6626268e1f636c8bd198a296cb8e","node_id":"MDQ6QmxvYjE1NzU5NTY6ODQ2YjdjMTJiM2FhNjYyNjI2OGUxZjYzNmM4YmQxOThhMjk2Y2I4ZQ==","size":11451,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/846b7c12b3aa6626268e1f636c8bd198a296cb8e","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0\naGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25z\nIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICov\nCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsKCmlt\ncG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuQ2xpZW50Q29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKCmlt\ncG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlci5FdmVudDsKCmltcG9ydCBqYXZhLnV0aWwuRW51\nbWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9y\ndCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaXN0\nOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1wb3J0IGphdmEudXRp\nbC5yZWdleC5QYXR0ZXJuOwppbXBvcnQgamF2YS51dGlsLnJlZ2V4Lk1hdGNo\nZXI7CgppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0\nY2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWlj\nSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkhlbHBG\nb3JtYXR0ZXI7CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9wdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuT3B0aW9uczsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQ29tbWFuZExpbmU7CmltcG9y\ndCBvcmcuYXBhY2hlLmNvbW1vbnMuY2xpLkNvbW1hbmRMaW5lUGFyc2VyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5Qb3NpeFBhcnNlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuUGFyc2VFeGNlcHRpb247Cgpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXJGYWN0b3J5OwoKcHVibGljIGNsYXNzIEJlbmNoUmVhZFRocm91Z2hwdXRM\nYXRlbmN5IHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9y\neS5nZXRMb2dnZXIoQmVuY2hSZWFkVGhyb3VnaHB1dExhdGVuY3kuY2xhc3Mp\nOwoKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFBhdHRlcm4gTEVER0VSX1BB\nVFRFUk4gPSBQYXR0ZXJuLmNvbXBpbGUoIkwoWzAtOV0rKSQiKTsKCiAgICBw\ncml2YXRlIHN0YXRpYyBmaW5hbCBDb21wYXJhdG9yPFN0cmluZz4gWktfTEVE\nR0VSX0NPTVBBUkUgPSBuZXcgQ29tcGFyYXRvcjxTdHJpbmc+KCkgewogICAg\nICAgIHB1YmxpYyBpbnQgY29tcGFyZShTdHJpbmcgbzEsIFN0cmluZyBvMikg\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgTWF0Y2hlciBt\nMSA9IExFREdFUl9QQVRURVJOLm1hdGNoZXIobzEpOwogICAgICAgICAgICAg\nICAgTWF0Y2hlciBtMiA9IExFREdFUl9QQVRURVJOLm1hdGNoZXIobzIpOwog\nICAgICAgICAgICAgICAgaWYgKG0xLmZpbmQoKSAmJiBtMi5maW5kKCkpIHsK\nICAgICAgICAgICAgICAgICAgICByZXR1cm4gSW50ZWdlci52YWx1ZU9mKG0x\nLmdyb3VwKDEpKQogICAgICAgICAgICAgICAgICAgICAgICAtIEludGVnZXIu\ndmFsdWVPZihtMi5ncm91cCgxKSk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIHJldHVybiBvMS5jb21wYXJlVG8obzIp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChUaHJv\nd2FibGUgdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG8xLmNvbXBhcmVU\nbyhvMik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9OwoKICAgIHBy\naXZhdGUgc3RhdGljIHZvaWQgcmVhZExlZGdlcihDbGllbnRDb25maWd1cmF0\naW9uIGNvbmYsIGxvbmcgbGVkZ2VySWQsIGJ5dGVbXSBwYXNzd2QpIHsKICAg\nICAgICBMT0cuaW5mbygiUmVhZGluZyBsZWRnZXIge30iLCBsZWRnZXJJZCk7\nCiAgICAgICAgQm9va0tlZXBlciBiayA9IG51bGw7CiAgICAgICAgbG9uZyB0\naW1lID0gMDsKICAgICAgICBsb25nIGVudHJpZXNSZWFkID0gMDsKICAgICAg\nICBsb25nIGxhc3RSZWFkID0gMDsKICAgICAgICBpbnQgbm9jaGFuZ2UgPSAw\nOwoKICAgICAgICBsb25nIGFic29sdXRlTGltaXQgPSA1MDAwMDAwOwogICAg\nICAgIExlZGdlckhhbmRsZSBsaCA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgYmsgPSBuZXcgQm9va0tlZXBlcihjb25mKTsKICAgICAgICAg\nICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgICAgICAgIGxoID0gYmsub3Bl\nbkxlZGdlck5vUmVjb3ZlcnkobGVkZ2VySWQsIEJvb2tLZWVwZXIuRGlnZXN0\nVHlwZS5DUkMzMiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHBhc3N3ZCk7CiAgICAgICAgICAgICAgICBsb25nIGxh\nc3RDb25maXJtZWQgPSBNYXRoLm1pbihsaC5nZXRMYXN0QWRkQ29uZmlybWVk\nKCksIGFic29sdXRlTGltaXQpOwogICAgICAgICAgICAgICAgaWYgKGxhc3RD\nb25maXJtZWQgPT0gbGFzdFJlYWQpIHsKICAgICAgICAgICAgICAgICAgICBu\nb2NoYW5nZSsrOwogICAgICAgICAgICAgICAgICAgIGlmIChub2NoYW5nZSA9\nPSAxMCkgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAg\nICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbm9jaGFuZ2UgPSAw\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbG9uZyBzdGFy\ndHRpbWUgPSBTeXN0ZW0ubmFub1RpbWUoKTsKCiAgICAgICAgICAgICAgICB3\naGlsZSAobGFzdFJlYWQgPCBsYXN0Q29uZmlybWVkKSB7CiAgICAgICAgICAg\nICAgICAgICAgbG9uZyBuZXh0TGltaXQgPSBsYXN0UmVhZCArIDEwMDAwMDsK\nICAgICAgICAgICAgICAgICAgICBsb25nIHJlYWRUbyA9IE1hdGgubWluKG5l\neHRMaW1pdCwgbGFzdENvbmZpcm1lZCk7CiAgICAgICAgICAgICAgICAgICAg\nRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGVudHJpZXMgPSBsaC5yZWFkRW50\ncmllcyhsYXN0UmVhZCsxLCByZWFkVG8pOwogICAgICAgICAgICAgICAgICAg\nIGxhc3RSZWFkID0gcmVhZFRvOwogICAgICAgICAgICAgICAgICAgIHdoaWxl\nIChlbnRyaWVzLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIExlZGdlckVudHJ5IGUgPSBlbnRyaWVzLm5leHRFbGVtZW50\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXNSZWFkKys7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmICgoZW50cmllc1JlYWQgJSAxMDAw\nMCkgPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmlu\nZm8oInt9IGVudHJpZXMgcmVhZCIsIGVudHJpZXNSZWFkKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGxvbmcgZW5kdGltZSA9IFN5\nc3RlbS5uYW5vVGltZSgpOwogICAgICAgICAgICAgICAgdGltZSArPSBlbmR0\naW1lIC0gc3RhcnR0aW1lOwoKICAgICAgICAgICAgICAgIGxoLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICBsaCA9IG51bGw7CiAgICAgICAgICAgICAgICBU\naHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAv\nLyBpZ25vcmUKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSApIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4gcmVhZGVyIiwgZSk7\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgTE9HLmluZm8oIlJl\nYWQge30gaW4ge31tcyIsIGVudHJpZXNSZWFkLCB0aW1lLzEwMDAvMTAwMCk7\nCgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaWYgKGxoICE9\nIG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBsaC5jbG9zZSgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGJrICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgICAgICBiay5jbG9zZSgpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gY2xvc2luZyBz\ndHVmZiIsIGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHByaXZhdGUgc3RhdGljIHZvaWQgdXNhZ2UoT3B0aW9ucyBvcHRpb25zKSB7\nCiAgICAgICAgSGVscEZvcm1hdHRlciBmb3JtYXR0ZXIgPSBuZXcgSGVscEZv\ncm1hdHRlcigpOwogICAgICAgIGZvcm1hdHRlci5wcmludEhlbHAoIkJlbmNo\nUmVhZFRocm91Z2hwdXRMYXRlbmN5IDxvcHRpb25zPiIsIG9wdGlvbnMpOwog\nICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFy\nZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIE9wdGlvbnMgb3B0aW9u\ncyA9IG5ldyBPcHRpb25zKCk7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24o\nImxlZGdlciIsIHRydWUsICJMZWRnZXIgdG8gcmVhZC4gSWYgZW1wdHksIHJl\nYWQgYWxsIGxlZGdlcnMgd2hpY2ggY29tZSBhdmFpbGFibGUuICIgCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiIENhbm5vdCBiZSB1c2VkIHdpdGgg\nLWxpc3RlbiIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJsaXN0ZW4i\nLCB0cnVlLCAiTGlzdGVuIGZvciBjcmVhdGlvbiBvZiA8YXJnPiBsZWRnZXJz\nLCBhbmQgcmVhZCBlYWNoIG9uZSBmdWxseSIpOwogICAgICAgIG9wdGlvbnMu\nYWRkT3B0aW9uKCJwYXNzd29yZCIsIHRydWUsICJQYXNzd29yZCB1c2VkIHRv\nIGFjY2VzcyBsZWRnZXJzIChkZWZhdWx0ICdiZW5jaFBhc3N3ZCcpIik7CiAg\nICAgICAgb3B0aW9ucy5hZGRPcHRpb24oInpvb2tlZXBlciIsIHRydWUsICJa\nb29rZWVwZXIgZW5zZW1ibGUsIGRlZmF1bHQgXCJsb2NhbGhvc3Q6MjE4MVwi\nIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oInNvY2tldHRpbWVvdXQi\nLCB0cnVlLCAiU29ja2V0IHRpbWVvdXQgZm9yIGJvb2trZWVwZXIgY2xpZW50\nLiBJbiBzZWNvbmRzLiBEZWZhdWx0IDUiKTsKICAgICAgICBvcHRpb25zLmFk\nZE9wdGlvbigiaGVscCIsIGZhbHNlLCAiVGhpcyBtZXNzYWdlIik7CgogICAg\nICAgIENvbW1hbmRMaW5lUGFyc2VyIHBhcnNlciA9IG5ldyBQb3NpeFBhcnNl\ncigpOwogICAgICAgIENvbW1hbmRMaW5lIGNtZCA9IHBhcnNlci5wYXJzZShv\ncHRpb25zLCBhcmdzKTsKCiAgICAgICAgaWYgKGNtZC5oYXNPcHRpb24oImhl\nbHAiKSkgewogICAgICAgICAgICB1c2FnZShvcHRpb25zKTsKICAgICAgICAg\nICAgU3lzdGVtLmV4aXQoLTEpOwogICAgICAgIH0KCiAgICAgICAgZmluYWwg\nU3RyaW5nIHNlcnZlcnMgPSBjbWQuZ2V0T3B0aW9uVmFsdWUoInpvb2tlZXBl\nciIsICJsb2NhbGhvc3Q6MjE4MSIpOwogICAgICAgIGZpbmFsIGJ5dGVbXSBw\nYXNzd2QgPSBjbWQuZ2V0T3B0aW9uVmFsdWUoInBhc3N3b3JkIiwgImJlbmNo\nUGFzc3dkIikuZ2V0Qnl0ZXMoKTsKICAgICAgICBmaW5hbCBpbnQgc29ja1Rp\nbWVvdXQgPSBJbnRlZ2VyLnZhbHVlT2YoY21kLmdldE9wdGlvblZhbHVlKCJz\nb2NrZXR0aW1lb3V0IiwgIjUiKSk7CiAgICAgICAgaWYgKGNtZC5oYXNPcHRp\nb24oImxlZGdlciIpICYmIGNtZC5oYXNPcHRpb24oImxpc3RlbiIpKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiQ2Fubm90IHVzZWQgLWxlZGdlciBhbmQg\nLWxpc3RlbiB0b2dldGhlciIpOwogICAgICAgICAgICB1c2FnZShvcHRpb25z\nKTsKICAgICAgICAgICAgU3lzdGVtLmV4aXQoLTEpOwogICAgICAgIH0KCiAg\nICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBsZWRnZXIgPSBuZXcgQXRvbWlj\nSW50ZWdlcigwKTsKICAgICAgICBmaW5hbCBBdG9taWNJbnRlZ2VyIG51bUxl\nZGdlcnMgPSBuZXcgQXRvbWljSW50ZWdlcigwKTsKICAgICAgICBpZiAoY21k\nLmhhc09wdGlvbigibGVkZ2VyIikpIHsKICAgICAgICAgICAgbGVkZ2VyLnNl\ndChJbnRlZ2VyLnZhbHVlT2YoY21kLmdldE9wdGlvblZhbHVlKCJsZWRnZXIi\nKSkpOwogICAgICAgIH0gZWxzZSBpZiAoY21kLmhhc09wdGlvbigibGlzdGVu\nIikpIHsKICAgICAgICAgICAgbnVtTGVkZ2Vycy5zZXQoSW50ZWdlci52YWx1\nZU9mKGNtZC5nZXRPcHRpb25WYWx1ZSgibGlzdGVuIikpKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICBMT0cuZXJyb3IoIllvdSBtdXN0IHVzZSAt\nbGVkZ2VyIG9yIC1saXN0ZW4iKTsKICAgICAgICAgICAgdXNhZ2Uob3B0aW9u\ncyk7CiAgICAgICAgICAgIFN5c3RlbS5leGl0KC0xKTsKICAgICAgICB9Cgog\nICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIHNodXRkb3duTGF0Y2ggPSBu\nZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAgZmluYWwgQ291bnREb3du\nTGF0Y2ggY29ubmVjdGVkTGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7\nCiAgICAgICAgZmluYWwgU3RyaW5nIG5vZGVwYXRoID0gU3RyaW5nLmZvcm1h\ndCgiL2xlZGdlcnMvTCUwMTBkIiwgbGVkZ2VyLmdldCgpKTsKCiAgICAgICAg\nZmluYWwgQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mID0gbmV3IENsaWVudENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICBjb25mLnNldFJlYWRUaW1lb3V0KHNv\nY2tUaW1lb3V0KS5zZXRaa1NlcnZlcnMoc2VydmVycyk7CgoKICAgICAgICBm\naW5hbCBab29LZWVwZXIgemsgPSBuZXcgWm9vS2VlcGVyKHNlcnZlcnMsIDMw\nMDAsIG5ldyBXYXRjaGVyKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZv\naWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAoZXZlbnQuZ2V0U3RhdGUoKSA9PSBFdmVudC5LZWVwZXJT\ndGF0ZS5TeW5jQ29ubmVjdGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAmJiBldmVudC5nZXRUeXBlKCkgPT0gRXZlbnQuRXZlbnRUeXBlLk5vbmUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdGVkTGF0Y2guY291\nbnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB0cnkgewogICAgICAgICAg\nICB6ay5yZWdpc3RlcihuZXcgV2F0Y2hlcigpIHsKICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRFdmVudCBldmVudCkg\newogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFN0YXRlKCkgPT0gRXZlbnQu\nS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZCAKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAmJiBldmVudC5nZXRUeXBlKCkgPT0gRXZlbnQuRXZl\nbnRUeXBlLk5vbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBjb25uZWN0ZWRMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZ2V0VHlwZSgpID09IEV2\nZW50LkV2ZW50VHlwZS5Ob2RlQ3JlYXRlZAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAmJiBldmVudC5nZXRQYXRoKCkuZXF1YWxz\nKG5vZGVwYXRoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJlYWRMZWRnZXIoY29uZiwgbGVkZ2VyLmdldCgpLCBwYXNzd2QpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNodXRkb3duTGF0Y2guY291\nbnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ug\naWYgKGV2ZW50LmdldFR5cGUoKSA9PSBFdmVudC5FdmVudFR5cGUuTm9kZUNo\naWxkcmVuQ2hhbmdlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGlmIChudW1MZWRnZXJzLmdldCgpIDwgMCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIExpc3Q8U3RyaW5nPiBjaGlsZHJlbiA9IHprLmdldENoaWxkcmVu\nKCIvbGVkZ2VycyIsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIExpc3Q8U3RyaW5nPiBsZWRnZXJzID0gbmV3IEFycmF5TGlzdDxT\ndHJpbmc+KCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9y\nIChTdHJpbmcgY2hpbGQgOiBjaGlsZHJlbikgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoTEVER0VSX1BBVFRFUk4ubWF0Y2hl\ncihjaGlsZCkuZmluZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsZWRnZXJzLmFkZChjaGlsZCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgQ29sbGVjdGlvbnMuc29ydChsZWRnZXJzLCBaS19MRURHRVJfQ09NUEFS\nRSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGxh\nc3QgPSBsZWRnZXJzLmdldChsZWRnZXJzLnNpemUoKSAtIDEpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIE1hdGNoZXIgbSA9IExF\nREdFUl9QQVRURVJOLm1hdGNoZXIobGFzdCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKG0uZmluZCgpKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGludCBsZWRnZXJzTGVmdCA9IG51bUxl\nZGdlcnMuZGVjcmVtZW50QW5kR2V0KCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIFRocmVhZCB0ID0gbmV3IFRocmVhZCgpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJlYWRMZWRnZXIoY29uZiwgTG9uZy52YWx1\nZU9mKG0uZ3JvdXAoMSkpLCBwYXNzd2QpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHQuc3RhcnQoKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGxlZGdlcnNMZWZ0IDw9IDApIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNodXRkb3du\nTGF0Y2guY291bnREb3duKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIkNhbnQgZmlsZSBsZWRnZXIgaWQgaW4ge30iLCBsYXN0KTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIExPRy53YXJuKCJVbmtub3duIGV2ZW50IHt9IiwgZXZl\nbnQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gaW4g\nd2F0Y2hlciIsIGUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAg\nICAgIGNvbm5lY3RlZExhdGNoLmF3YWl0KCk7CiAgICAgICAgICAgIGlmIChs\nZWRnZXIuZ2V0KCkgIT0gMCkgewogICAgICAgICAgICAgICAgaWYgKHprLmV4\naXN0cyhub2RlcGF0aCwgdHJ1ZSkgIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgICAgIHJlYWRMZWRnZXIoY29uZiwgbGVkZ2VyLmdldCgpLCBwYXNzd2Qp\nOwogICAgICAgICAgICAgICAgICAgIHNodXRkb3duTGF0Y2guY291bnREb3du\nKCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgIExPRy5pbmZvKCJXYXRjaGluZyBmb3IgY3JlYXRpb24gb2YiICsgbm9k\nZXBhdGgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgemsuZ2V0Q2hpbGRyZW4oIi9sZWRnZXJzIiwg\ndHJ1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2h1dGRvd25MYXRj\naC5hd2FpdCgpOwogICAgICAgICAgICBMT0cuaW5mbygiU2h1dHRpbmcgZG93\nbiIpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHprLmNsb3Nl\nKCk7CiAgICAgICAgfQogICAgfQp9\n","encoding":"base64"}

