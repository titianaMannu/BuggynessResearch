{"sha":"34d683c7841a3ffd6eda757e4107997478af7c9e","node_id":"MDQ6QmxvYjE1NzU5NTY6MzRkNjgzYzc4NDFhM2ZmZDZlZGE3NTdlNDEwNzk5NzQ3OGFmN2M5ZQ==","size":14854,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/34d683c7841a3ffd6eda757e4107997478af7c9e","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsK\nCmltcG9ydCBqYXZhLmlvLkZpbGVOb3RGb3VuZEV4Y2VwdGlvbjsKaW1wb3J0\nIGphdmEuaW8uRmlsZU91dHB1dFN0cmVhbTsKaW1wb3J0IGphdmEuaW8uSU9F\neGNlcHRpb247CmltcG9ydCBqYXZhLmlvLk91dHB1dFN0cmVhbTsKaW1wb3J0\nIGphdmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5IYXNo\nTWFwOwppbXBvcnQgamF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwu\nQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLlJhbmRvbTsKaW1wb3J0IGph\ndmEudXRpbC5UaW1lcjsKaW1wb3J0IGphdmEudXRpbC5UaW1lclRhc2s7Cgpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuRnV0dXJlOzsKaW1wb3J0IGph\ndmEudXRpbC5jb25jdXJyZW50LkNhbGxhYmxlOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuRXhlY3V0b3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGls\nLmNvbmN1cnJlbnQuRXhlY3V0aW9uRXhjZXB0aW9uOwppbXBvcnQgamF2YS51\ndGlsLmNvbmN1cnJlbnQuRXhlY3V0b3JzOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuVGltZVVuaXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5hdG9taWMuQXRvbWljQm9vbGVhbjsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LmF0b21pYy5BdG9taWNMb25nOwoKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGllbnRD\nb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNs\naWVudC5Cb29rS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5MZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZh\nY3Rvcnk7CgppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhj\nZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFjaGUuaGFkb29wLmNvbmYuQ29uZmln\ndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGFkb29wLmZzLkZpbGVTeXN0\nZW07CmltcG9ydCBvcmcuYXBhY2hlLmhhZG9vcC5mcy5GU0RhdGFPdXRwdXRT\ndHJlYW07CmltcG9ydCBvcmcuYXBhY2hlLmhhZG9vcC5mcy5QYXRoOwoKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuSGVscEZvcm1hdHRlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuT3B0aW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5jb21tb25zLmNsaS5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmNsaS5Db21tYW5kTGluZTsKaW1wb3J0IG9yZy5hcGFjaGUu\nY29tbW9ucy5jbGkuQ29tbWFuZExpbmVQYXJzZXI7CmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY2xpLlBvc2l4UGFyc2VyOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmNsaS5QYXJzZUV4Y2VwdGlvbjsKCgovKioKICogVGhpcyBp\ncyBhIHNpbXBsZSB0ZXN0IHByb2dyYW0gdG8gY29tcGFyZSB0aGUgcGVyZm9y\nbWFuY2Ugb2Ygd3JpdGluZyB0bwogKiBCb29rS2VlcGVyIGFuZCB0byB0aGUg\nbG9jYWwgZmlsZSBzeXN0ZW0uCiAqCiAqLwoKcHVibGljIGNsYXNzIFRlc3RD\nbGllbnQgewogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgTG9nZ2VyIExPRyA9\nIExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKFRlc3RDbGllbnQuY2xhc3MpOwoK\nICAgIC8qKgogICAgICogRmlyc3Qgc2F5cyBpZiBlbnRyaWVzIHNob3VsZCBi\nZSB3cml0dGVuIHRvIEJvb2tLZWVwZXIgKDApIG9yIHRvIHRoZSBsb2NhbAog\nICAgICogZGlzayAoMSkuIFNlY29uZCBwYXJhbWV0ZXIgaXMgYW4gaW50ZWdl\nciBkZWZpbmluZyB0aGUgbGVuZ3RoIG9mIGEgbGVkZ2VyIGVudHJ5LgogICAg\nICogVGhpcmQgcGFyYW1ldGVyIGlzIHRoZSBudW1iZXIgb2Ygd3JpdGVzLgog\nICAgICoKICAgICAqIEBwYXJhbSBhcmdzCiAgICAgKi8KICAgIHB1YmxpYyBz\ndGF0aWMgdm9pZCBtYWluKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBQYXJzZUV4\nY2VwdGlvbiB7CiAgICAgICAgT3B0aW9ucyBvcHRpb25zID0gbmV3IE9wdGlv\nbnMoKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigibGVuZ3RoIiwgdHJ1\nZSwgIkxlbmd0aCBvZiBwYWNrZXRzIGJlaW5nIHdyaXR0ZW4uIERlZmF1bHQg\nMTAyNCIpOwogICAgICAgIG9wdGlvbnMuYWRkT3B0aW9uKCJ0YXJnZXQiLCB0\ncnVlLCAiVGFyZ2V0IG1lZGl1bSB0byB3cml0ZSB0by4gT3B0aW9ucyBhcmUg\nYmssIGZzICYgaGRmcy4gRGVmYXVsdCBmcyIpOwogICAgICAgIG9wdGlvbnMu\nYWRkT3B0aW9uKCJydW5mb3IiLCB0cnVlLCAiTnVtYmVyIG9mIHNlY29uZHMg\ndG8gcnVuIGZvci4gRGVmYXVsdCA2MCIpOwogICAgICAgIG9wdGlvbnMuYWRk\nT3B0aW9uKCJwYXRoIiwgdHJ1ZSwgIlBhdGggdG8gd3JpdGUgdG8uIGZzICYg\naGRmcyBvbmx5LiBEZWZhdWx0IC9mb29iYXIiKTsKICAgICAgICBvcHRpb25z\nLmFkZE9wdGlvbigiemtzZXJ2ZXJzIiwgdHJ1ZSwgIlpvb0tlZXBlciBzZXJ2\nZXJzLCBjb21tYSBzZXBhcmF0ZWQuIGJrIG9ubHkuIERlZmF1bHQgbG9jYWxo\nb3N0OjIxODEuIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oImJrZW5z\nZW1ibGUiLCB0cnVlLCAiQm9va0tlZXBlciBsZWRnZXIgZW5zZW1ibGUgc2l6\nZS4gYmsgb25seS4gRGVmYXVsdCAzIik7CiAgICAgICAgb3B0aW9ucy5hZGRP\ncHRpb24oImJrcXVvcnVtIiwgdHJ1ZSwgIkJvb2tLZWVwZXIgbGVkZ2VyIHF1\nb3J1bSBzaXplLiBiayBvbmx5LiBEZWZhdWx0IDIiKTsKICAgICAgICBvcHRp\nb25zLmFkZE9wdGlvbigiYmt0aHJvdHRsZSIsIHRydWUsICJCb29rS2VlcGVy\nIHRocm90dGxlIHNpemUuIGJrIG9ubHkuIERlZmF1bHQgMTAwMDAiKTsKICAg\nICAgICBvcHRpb25zLmFkZE9wdGlvbigic3luYyIsIGZhbHNlLCAiVXNlIHN5\nbmNocm9ub3VzIHdyaXRlcyB3aXRoIEJvb2tLZWVwZXIuIGJrIG9ubHkuIik7\nCiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oIm51bWNvbmN1cnJlbnQiLCB0\ncnVlLCAiTnVtYmVyIG9mIGNvbmN1cnJlbnRseSBjbGllbnRzLiBEZWZhdWx0\nIDEiKTsKICAgICAgICBvcHRpb25zLmFkZE9wdGlvbigidGltZW91dCIsIHRy\ndWUsICJOdW1iZXIgb2Ygc2Vjb25kcyBhZnRlciB3aGljaCB0byBnaXZlIHVw\nIik7CiAgICAgICAgb3B0aW9ucy5hZGRPcHRpb24oImhlbHAiLCBmYWxzZSwg\nIlRoaXMgbWVzc2FnZSIpOwoKICAgICAgICBDb21tYW5kTGluZVBhcnNlciBw\nYXJzZXIgPSBuZXcgUG9zaXhQYXJzZXIoKTsKICAgICAgICBDb21tYW5kTGlu\nZSBjbWQgPSBwYXJzZXIucGFyc2Uob3B0aW9ucywgYXJncyk7CgogICAgICAg\nIGlmIChjbWQuaGFzT3B0aW9uKCJoZWxwIikpIHsKICAgICAgICAgICAgSGVs\ncEZvcm1hdHRlciBmb3JtYXR0ZXIgPSBuZXcgSGVscEZvcm1hdHRlcigpOwog\nICAgICAgICAgICBmb3JtYXR0ZXIucHJpbnRIZWxwKCJUZXN0Q2xpZW50IDxv\ncHRpb25zPiIsIG9wdGlvbnMpOwogICAgICAgICAgICBTeXN0ZW0uZXhpdCgt\nMSk7CiAgICAgICAgfQoKICAgICAgICBpbnQgbGVuZ3RoID0gSW50ZWdlci52\nYWx1ZU9mKGNtZC5nZXRPcHRpb25WYWx1ZSgibGVuZ3RoIiwgIjEwMjQiKSk7\nCiAgICAgICAgU3RyaW5nIHRhcmdldCA9IGNtZC5nZXRPcHRpb25WYWx1ZSgi\ndGFyZ2V0IiwgImZzIik7CiAgICAgICAgbG9uZyBydW5mb3IgPSBMb25nLnZh\nbHVlT2YoY21kLmdldE9wdGlvblZhbHVlKCJydW5mb3IiLCAiNjAiKSkgKiAx\nMDAwOwoKICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1\naWxkZXIoKTsKICAgICAgICB3aGlsZShsZW5ndGgtLSA+IDApIHsKICAgICAg\nICAgICAgc2IuYXBwZW5kKCdhJyk7CiAgICAgICAgfQoKICAgICAgICBUaW1l\nciB0aW1lb3V0ZXIgPSBuZXcgVGltZXIoKTsKICAgICAgICBpZiAoY21kLmhh\nc09wdGlvbigidGltZW91dCIpKSB7CiAgICAgICAgICAgIGZpbmFsIGxvbmcg\ndGltZW91dCA9IExvbmcudmFsdWVPZihjbWQuZ2V0T3B0aW9uVmFsdWUoInRp\nbWVvdXQiLCAiMzYwIikpICogMTAwMDsKCiAgICAgICAgICAgIHRpbWVvdXRl\nci5zY2hlZHVsZShuZXcgVGltZXJUYXNrKCkgewogICAgICAgICAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgU3lzdGVtLmVyci5wcmludGxuKCJUaW1pbmcgb3V0IGJlbmNobWFyayBh\nZnRlciAiICsgdGltZW91dCArICJtcyIpOwogICAgICAgICAgICAgICAgICAg\nICAgICBTeXN0ZW0uZXhpdCgtMSk7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgfSwgdGltZW91dCk7CiAgICAgICAgfQoKICAgICAg\nICBCb29rS2VlcGVyIGJrYyA9IG51bGw7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgaW50IG51bUZpbGVzID0gSW50ZWdlci52YWx1ZU9mKGNtZC5nZXRP\ncHRpb25WYWx1ZSgibnVtY29uY3VycmVudCIsICIxIikpOwogICAgICAgICAg\nICBpbnQgbnVtVGhyZWFkcyA9IE1hdGgubWluKG51bUZpbGVzLCAxMDAwKTsK\nICAgICAgICAgICAgYnl0ZVtdIGRhdGEgPSBzYi50b1N0cmluZygpLmdldEJ5\ndGVzKCk7CiAgICAgICAgICAgIGxvbmcgcnVuaWQgPSBTeXN0ZW0uY3VycmVu\ndFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgTGlzdDxDYWxsYWJsZTxMb25n\nPj4gY2xpZW50cyA9IG5ldyBBcnJheUxpc3Q8Q2FsbGFibGU8TG9uZz4+KCk7\nCgogICAgICAgICAgICBpZiAodGFyZ2V0LmVxdWFscygiYmsiKSkgewogICAg\nICAgICAgICAgICAgU3RyaW5nIHprc2VydmVycyA9IGNtZC5nZXRPcHRpb25W\nYWx1ZSgiemtzZXJ2ZXJzIiwgImxvY2FsaG9zdDoyMTgxIik7CiAgICAgICAg\nICAgICAgICBpbnQgYmtlbnNlbWJsZSA9IEludGVnZXIudmFsdWVPZihjbWQu\nZ2V0T3B0aW9uVmFsdWUoImJrZW5zZW1ibGUiLCAiMyIpKTsKICAgICAgICAg\nICAgICAgIGludCBia3F1b3J1bSA9IEludGVnZXIudmFsdWVPZihjbWQuZ2V0\nT3B0aW9uVmFsdWUoImJrcXVvcnVtIiwgIjIiKSk7CiAgICAgICAgICAgICAg\nICBpbnQgYmt0aHJvdHRsZSA9IEludGVnZXIudmFsdWVPZihjbWQuZ2V0T3B0\naW9uVmFsdWUoImJrdGhyb3R0bGUiLCAiMTAwMDAiKSk7CgogICAgICAgICAg\nICAgICAgQ2xpZW50Q29uZmlndXJhdGlvbiBjb25mID0gbmV3IENsaWVudENv\nbmZpZ3VyYXRpb24oKTsKICAgICAgICAgICAgICAgIGNvbmYuc2V0VGhyb3R0\nbGVWYWx1ZShia3Rocm90dGxlKTsKICAgICAgICAgICAgICAgIGNvbmYuc2V0\nWmtTZXJ2ZXJzKHprc2VydmVycyk7CgogICAgICAgICAgICAgICAgYmtjID0g\nbmV3IEJvb2tLZWVwZXIoY29uZik7CiAgICAgICAgICAgICAgICBMaXN0PExl\nZGdlckhhbmRsZT4gaGFuZGxlcyA9IG5ldyBBcnJheUxpc3Q8TGVkZ2VySGFu\nZGxlPigpOwogICAgICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBu\ndW1GaWxlczsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcy5h\nZGQoYmtjLmNyZWF0ZUxlZGdlcihia2Vuc2VtYmxlLCBia3F1b3J1bSwgRGln\nZXN0VHlwZS5DUkMzMiwgbmV3IGJ5dGVbXSB7J2EnLCAnYid9KSk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBmb3IgKGludCBpID0gMDsg\naSA8IG51bUZpbGVzOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBjbGll\nbnRzLmFkZChuZXcgQktDbGllbnQoaGFuZGxlcywgZGF0YSwgcnVuZm9yLCBj\nbWQuaGFzT3B0aW9uKCJzeW5jIikpKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQuZXF1YWxzKCJoZGZzIikpIHsK\nICAgICAgICAgICAgICAgIEZpbGVTeXN0ZW0gZnMgPSBGaWxlU3lzdGVtLmdl\ndChuZXcgQ29uZmlndXJhdGlvbigpKTsKICAgICAgICAgICAgICAgIExPRy5p\nbmZvKCJEZWZhdWx0IHJlcGxpY2F0aW9uIGZvciBIREZTOiB7fSIsIGZzLmdl\ndERlZmF1bHRSZXBsaWNhdGlvbigpKTsKCiAgICAgICAgICAgICAgICBMaXN0\nPEZTRGF0YU91dHB1dFN0cmVhbT4gc3RyZWFtcyA9IG5ldyBBcnJheUxpc3Q8\nRlNEYXRhT3V0cHV0U3RyZWFtPigpOwogICAgICAgICAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBudW1GaWxlczsgaSsrKSB7CiAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nIHBhdGggPSBjbWQuZ2V0T3B0aW9uVmFsdWUoInBhdGgi\nLCAiL2Zvb2JhciIpOwogICAgICAgICAgICAgICAgICAgIHN0cmVhbXMuYWRk\nKGZzLmNyZWF0ZShuZXcgUGF0aChwYXRoICsgcnVuaWQgKyAiXyIgKyBpKSkp\nOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbnVtVGhyZWFkczsgaSsrKSB7CiAgICAgICAgICAgICAg\nICAgICAgY2xpZW50cy5hZGQobmV3IEhERlNDbGllbnQoc3RyZWFtcywgZGF0\nYSwgcnVuZm9yKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0g\nZWxzZSBpZiAodGFyZ2V0LmVxdWFscygiZnMiKSkgewogICAgICAgICAgICAg\nICAgTGlzdDxGaWxlT3V0cHV0U3RyZWFtPiBzdHJlYW1zID0gbmV3IEFycmF5\nTGlzdDxGaWxlT3V0cHV0U3RyZWFtPigpOwogICAgICAgICAgICAgICAgZm9y\nIChpbnQgaSA9IDA7IGkgPCBudW1GaWxlczsgaSsrKSB7CiAgICAgICAgICAg\nICAgICAgICAgU3RyaW5nIHBhdGggPSBjbWQuZ2V0T3B0aW9uVmFsdWUoInBh\ndGgiLCAiL2Zvb2JhciAiICsgaSk7CiAgICAgICAgICAgICAgICAgICAgc3Ry\nZWFtcy5hZGQobmV3IEZpbGVPdXRwdXRTdHJlYW0ocGF0aCArIHJ1bmlkICsg\nIl8iICsgaSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtVGhyZWFkczsgaSsrKSB7CiAgICAg\nICAgICAgICAgICAgICAgY2xpZW50cy5hZGQobmV3IEZpbGVDbGllbnQoc3Ry\nZWFtcywgZGF0YSwgcnVuZm9yKSk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlVu\na25vd24gb3B0aW9uOiAiICsgdGFyZ2V0KTsKICAgICAgICAgICAgICAgIHRo\ncm93IG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oIlVua25vd24gdGFy\nZ2V0ICIgKyB0YXJnZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBF\neGVjdXRvclNlcnZpY2UgZXhlY3V0b3IgPSBFeGVjdXRvcnMubmV3Rml4ZWRU\naHJlYWRQb29sKG51bVRocmVhZHMpOwogICAgICAgICAgICBsb25nIHN0YXJ0\nID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CgogICAgICAgICAgICBM\naXN0PEZ1dHVyZTxMb25nPj4gcmVzdWx0cyA9IGV4ZWN1dG9yLmludm9rZUFs\nbChjbGllbnRzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAxMCwgVGltZVVuaXQuTUlOVVRF\nUyk7CiAgICAgICAgICAgIGxvbmcgZW5kID0gU3lzdGVtLmN1cnJlbnRUaW1l\nTWlsbGlzKCk7CiAgICAgICAgICAgIGxvbmcgY291bnQgPSAwOwogICAgICAg\nICAgICBmb3IgKEZ1dHVyZTxMb25nPiByIDogcmVzdWx0cykgewogICAgICAg\nICAgICAgICAgaWYgKCFyLmlzRG9uZSgpKSB7CiAgICAgICAgICAgICAgICAg\nICAgTE9HLndhcm4oIkpvYiBkaWRuJ3QgY29tcGxldGUiKTsKICAgICAgICAg\nICAgICAgICAgICBTeXN0ZW0uZXhpdCgyKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGxvbmcgYyA9IHIuZ2V0KCk7CiAgICAgICAgICAg\nICAgICBpZiAoYyA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLndh\ncm4oIlRhc2sgZGlkbid0IGNvbXBsZXRlIik7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBjb3VudCArPSBjOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGxvbmcgdGltZSA9IGVuZC1zdGFydDsKICAgICAgICAgICAg\nTE9HLmluZm8oIkZpbmlzaGVkIHByb2Nlc3Npbmcgd3JpdGVzIChtcyk6IHt9\nIFRQVDoge30gb3AvcyIsCiAgICAgICAgICAgICAgICAgICAgIHRpbWUsIGNv\ndW50LygoZG91YmxlKXRpbWUvMTAwMCkpOwogICAgICAgICAgICBleGVjdXRv\nci5zaHV0ZG93bigpOwogICAgICAgIH0gY2F0Y2ggKEV4ZWN1dGlvbkV4Y2Vw\ndGlvbiBlZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBp\nbiB3b3JrZXIiLCBlZSk7CiAgICAgICAgfSAgY2F0Y2ggKEtlZXBlckV4Y2Vw\ndGlvbiBrZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGFjY2Vz\nc2luZyB6b29rZWVwZXIiLCBrZSk7CiAgICAgICAgfSBjYXRjaCAoQktFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGFjY2Vz\nc2luZyBib29ra2VlcGVyIiwgZSk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNl\ncHRpb24gaW9lKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiSS9PIGV4Y2Vw\ndGlvbiBkdXJpbmcgYmVuY2htYXJrIiwgaW9lKTsKICAgICAgICB9IGNhdGNo\nIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICBMT0cu\nZXJyb3IoIkJlbmNobWFyayBpbnRlcnJ1cHRlZCIsIGllKTsKICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBpZiAoYmtjICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgYmtjLmNs\nb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBi\na2UpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIGNs\nb3NpbmcgYm9va2tlZXBlciBjbGllbnQiLCBia2UpOwogICAgICAgICAgICAg\nICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAg\nICAgICAgICAgICAgICBMT0cud2FybigiSW50ZXJydXB0ZWQgY2xvc2luZyBi\nb29ra2VlcGVyIGNsaWVudCIsIGllKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgICB0aW1lb3V0ZXIuY2FuY2Vs\nKCk7CiAgICB9CgogICAgc3RhdGljIGNsYXNzIEhERlNDbGllbnQgaW1wbGVt\nZW50cyBDYWxsYWJsZTxMb25nPiB7CiAgICAgICAgZmluYWwgTGlzdDxGU0Rh\ndGFPdXRwdXRTdHJlYW0+IHN0cmVhbXM7CiAgICAgICAgZmluYWwgYnl0ZVtd\nIGRhdGE7CiAgICAgICAgZmluYWwgbG9uZyB0aW1lOwogICAgICAgIGZpbmFs\nIFJhbmRvbSByOwoKICAgICAgICBIREZTQ2xpZW50KExpc3Q8RlNEYXRhT3V0\ncHV0U3RyZWFtPiBzdHJlYW1zLCBieXRlW10gZGF0YSwgbG9uZyB0aW1lKSB7\nCiAgICAgICAgICAgIHRoaXMuc3RyZWFtcyA9IHN0cmVhbXM7CiAgICAgICAg\nICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgIHRoaXMudGltZSA9\nIHRpbWU7CiAgICAgICAgICAgIHRoaXMuciA9IG5ldyBSYW5kb20oU3lzdGVt\nLmlkZW50aXR5SGFzaENvZGUodGhpcykpOwogICAgICAgIH0KCiAgICAgICAg\ncHVibGljIExvbmcgY2FsbCgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgIGxvbmcgY291bnQgPSAwOwogICAgICAgICAgICAgICAgbG9u\nZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAg\nICAgICAgICAgbG9uZyBzdG9wYXQgPSBzdGFydCArIHRpbWU7CiAgICAgICAg\nICAgICAgICB3aGlsZShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSA8IHN0\nb3BhdCkgewogICAgICAgICAgICAgICAgICAgIEZTRGF0YU91dHB1dFN0cmVh\nbSBzdHJlYW0gPSBzdHJlYW1zLmdldChyLm5leHRJbnQoc3RyZWFtcy5zaXpl\nKCkpKTsKICAgICAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQoc3RyZWFt\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbS53cml0ZShkYXRh\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmZsdXNoKCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbS5oZmx1c2goKTsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgY291bnQrKzsK\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBsb25nIHRpbWUg\nPSAoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydCk7CiAgICAg\nICAgICAgICAgICBMT0cuaW5mbygiV29ya2VyIGZpbmlzaGVkIHByb2Nlc3Np\nbmcgd3JpdGVzIChtcyk6IHt9IFRQVDoge30gb3AvcyIsCiAgICAgICAgICAg\nICAgICAgICAgICAgICB0aW1lLCBjb3VudC8oKGRvdWJsZSl0aW1lLzEwMDAp\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICAgICAg\nfSBjYXRjaChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiRXhjZXB0aW9uIGluIHdvcmtlciB0aHJlYWQiLCBpb2UpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIDBMOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgfQoKICAgIHN0YXRpYyBjbGFzcyBGaWxlQ2xpZW50IGltcGxl\nbWVudHMgQ2FsbGFibGU8TG9uZz4gewogICAgICAgIGZpbmFsIExpc3Q8Rmls\nZU91dHB1dFN0cmVhbT4gc3RyZWFtczsKICAgICAgICBmaW5hbCBieXRlW10g\nZGF0YTsKICAgICAgICBmaW5hbCBsb25nIHRpbWU7CiAgICAgICAgZmluYWwg\nUmFuZG9tIHI7CgogICAgICAgIEZpbGVDbGllbnQoTGlzdDxGaWxlT3V0cHV0\nU3RyZWFtPiBzdHJlYW1zLCBieXRlW10gZGF0YSwgbG9uZyB0aW1lKSB7CiAg\nICAgICAgICAgIHRoaXMuc3RyZWFtcyA9IHN0cmVhbXM7CiAgICAgICAgICAg\nIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgIHRoaXMudGltZSA9IHRp\nbWU7CiAgICAgICAgICAgIHRoaXMuciA9IG5ldyBSYW5kb20oU3lzdGVtLmlk\nZW50aXR5SGFzaENvZGUodGhpcykpOwogICAgICAgIH0KCiAgICAgICAgcHVi\nbGljIExvbmcgY2FsbCgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIGxvbmcgY291bnQgPSAwOwogICAgICAgICAgICAgICAgbG9uZyBz\ndGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwoKICAgICAgICAg\nICAgICAgIGxvbmcgc3RvcGF0ID0gc3RhcnQgKyB0aW1lOwogICAgICAgICAg\nICAgICAgd2hpbGUoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgPCBzdG9w\nYXQpIHsKICAgICAgICAgICAgICAgICAgICBGaWxlT3V0cHV0U3RyZWFtIHN0\ncmVhbSA9IHN0cmVhbXMuZ2V0KHIubmV4dEludChzdHJlYW1zLnNpemUoKSkp\nOwogICAgICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZChzdHJlYW0pIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgc3RyZWFtLndyaXRlKGRhdGEpOwog\nICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uZmx1c2goKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgc3RyZWFtLmdldENoYW5uZWwoKS5mb3JjZShm\nYWxzZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIGNvdW50Kys7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgbG9uZyB0aW1lID0gKFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpIC0g\nc3RhcnQpOwogICAgICAgICAgICAgICAgTE9HLmluZm8oIldvcmtlciBmaW5p\nc2hlZCBwcm9jZXNzaW5nIHdyaXRlcyAobXMpOiB7fSBUUFQ6IHt9IG9wL3Mi\nLCB0aW1lLCBjb3VudC8oKGRvdWJsZSl0aW1lLzEwMDApKTsKICAgICAgICAg\nICAgICAgIHJldHVybiBjb3VudDsKICAgICAgICAgICAgfSBjYXRjaChJT0V4\nY2VwdGlvbiBpb2UpIHsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXhj\nZXB0aW9uIGluIHdvcmtlciB0aHJlYWQiLCBpb2UpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIDBMOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIHN0YXRpYyBjbGFzcyBCS0NsaWVudCBpbXBsZW1lbnRzIENhbGxhYmxl\nPExvbmc+LCBBZGRDYWxsYmFjayB7CiAgICAgICAgZmluYWwgTGlzdDxMZWRn\nZXJIYW5kbGU+IGhhbmRsZXM7CiAgICAgICAgZmluYWwgYnl0ZVtdIGRhdGE7\nCiAgICAgICAgZmluYWwgbG9uZyB0aW1lOwogICAgICAgIGZpbmFsIFJhbmRv\nbSByOwogICAgICAgIGZpbmFsIGJvb2xlYW4gc3luYzsKICAgICAgICBmaW5h\nbCBBdG9taWNMb25nIHN1Y2Nlc3MgPSBuZXcgQXRvbWljTG9uZygwKTsKICAg\nICAgICBmaW5hbCBBdG9taWNMb25nIG91dHN0YW5kaW5nID0gbmV3IEF0b21p\nY0xvbmcoMCk7CgogICAgICAgIEJLQ2xpZW50KExpc3Q8TGVkZ2VySGFuZGxl\nPiBoYW5kbGVzLCBieXRlW10gZGF0YSwgbG9uZyB0aW1lLCBib29sZWFuIHN5\nbmMpIHsKICAgICAgICAgICAgdGhpcy5oYW5kbGVzID0gaGFuZGxlczsKICAg\nICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgICAgICAgdGhpcy50\naW1lID0gdGltZTsKICAgICAgICAgICAgdGhpcy5yID0gbmV3IFJhbmRvbShT\neXN0ZW0uaWRlbnRpdHlIYXNoQ29kZSh0aGlzKSk7CiAgICAgICAgICAgIHRo\naXMuc3luYyA9IHN5bmM7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgTG9u\nZyBjYWxsKCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAg\nbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwoKICAg\nICAgICAgICAgICAgIGxvbmcgc3RvcGF0ID0gc3RhcnQgKyB0aW1lOwogICAg\nICAgICAgICAgICAgd2hpbGUoU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkg\nPCBzdG9wYXQpIHsKICAgICAgICAgICAgICAgICAgICBMZWRnZXJIYW5kbGUg\nbGggPSBoYW5kbGVzLmdldChyLm5leHRJbnQoaGFuZGxlcy5zaXplKCkpKTsK\nICAgICAgICAgICAgICAgICAgICBpZiAoc3luYykgewogICAgICAgICAgICAg\nICAgICAgICAgICBsaC5hZGRFbnRyeShkYXRhKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgc3VjY2Vzcy5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBs\naC5hc3luY0FkZEVudHJ5KGRhdGEsIHRoaXMsIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgICAgICBvdXRzdGFuZGluZy5pbmNyZW1lbnRBbmRHZXQoKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAg\nICAgICAgICAgICAgaW50IHRpY2tzID0gMTA7IC8vIGRvbid0IHdhaXQgZm9y\nIG1vcmUgdGhhbiAxMCBzZWNvbmRzCiAgICAgICAgICAgICAgICB3aGlsZSAo\nb3V0c3RhbmRpbmcuZ2V0KCkgPiAwICYmIHRpY2tzLS0gPiAwKSB7CiAgICAg\nICAgICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwKTsKICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICBsb25nIHRpbWUgPSAoU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydCk7CiAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiV29ya2VyIGZpbmlzaGVkIHByb2Nlc3Npbmcgd3JpdGVzICht\ncyk6IHt9IFRQVDoge30gb3AvcyIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICB0aW1lLCBzdWNjZXNzLmdldCgpLygoZG91YmxlKXRpbWUvMTAwMCkpOwog\nICAgICAgICAgICAgICAgcmV0dXJuIHN1Y2Nlc3MuZ2V0KCk7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIHdvcmtlciB0aHJlYWQiLCBlKTsK\nICAgICAgICAgICAgICAgIHJldHVybiAwTDsKICAgICAgICAgICAgfSBjYXRj\naCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRXhjZXB0aW9uIGluIHdvcmtlciB0aHJlYWQiLCBpZSk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gMEw7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIGFkZENvbXBsZXRlKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBsb25nIGVu\ndHJ5SWQsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgaWYgKHJjID09IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgIHN1Y2Nlc3Mu\naW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nb3V0c3RhbmRpbmcuZGVjcmVtZW50QW5kR2V0KCk7CiAgICAgICAgfQogICAg\nfQp9Cg==\n","encoding":"base64"}

