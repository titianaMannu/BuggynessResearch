{"sha":"02e40ba7fb77b024be98f0112bd48fa258ec7edd","node_id":"MDQ6QmxvYjE1NzU5NTY6MDJlNDBiYTdmYjc3YjAyNGJlOThmMDExMmJkNDhmYTI1OGVjN2VkZA==","size":7433,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/02e40ba7fb77b024be98f0112bd48fa258ec7edd","content":"LyoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0\naW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxp\nY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlz\ndHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3Jt\nYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUg\nQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFw\nYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7\nIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFu\nY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29w\neSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hl\nLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWly\nZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcs\nCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlz\nIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQg\nV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0\naGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25z\nIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICov\nCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJlbmNobWFyazsKCmlt\ncG9ydCBvcmcuanVuaXQuQmVmb3JlQ2xhc3M7CmltcG9ydCBvcmcuanVuaXQu\nQWZ0ZXJDbGFzczsKaW1wb3J0IG9yZy5qdW5pdC5UZXN0OwppbXBvcnQgb3Jn\nLmp1bml0LkFzc2VydDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkJvb2tLZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci51dGlsLkxvY2FsQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5zbGY0\nai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LlRpbWVVbml0OwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuYXRvbWljLkF0b21pY0Jvb2xlYW47CgppbXBv\ncnQgamF2YS51dGlsLkFycmF5czsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwoK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5XYXRjaGVyLkV2ZW50LkV2ZW50VHlwZTsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLldhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGU7\nCgpwdWJsaWMgY2xhc3MgVGVzdEJlbmNobWFyayB7CiAgICBwcm90ZWN0ZWQg\nc3RhdGljIGZpbmFsIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExv\nZ2dlcihUZXN0QmVuY2htYXJrLmNsYXNzKTsKCiAgICBwcml2YXRlIHN0YXRp\nYyBUaHJlYWQgZW5zZW1ibGVUaHJlYWQgPSBudWxsOwogICAgcHJpdmF0ZSBm\naW5hbCBzdGF0aWMgU3RyaW5nIHprU3RyaW5nID0gImxvY2FsaG9zdDoyMTgx\nIjsKICAgIHByaXZhdGUgc3RhdGljIExpc3Q8U3RyaW5nPiBib29raWVzID0g\nbnVsbDsKCiAgICBAQmVmb3JlQ2xhc3MKICAgIHB1YmxpYyBzdGF0aWMgdm9p\nZCBzdGFydEVuc2VtYmxlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nZmluYWwgaW50IG51bUJvb2tpZXMgPSA1OwoKICAgICAgICBlbnNlbWJsZVRo\ncmVhZCA9IG5ldyBUaHJlYWQoKSB7CiAgICAgICAgICAgICAgICBwdWJsaWMg\ndm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgTG9jYWxCb29rS2VlcGVyLm1haW4obmV3IFN0\ncmluZ1tde1N0cmluZy52YWx1ZU9mKG51bUJvb2tpZXMpfSk7CiAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlNodXR0aW5n\nIGRvd24gZW5zZW1ibGUgdGhyZWFkIik7CiAgICAgICAgICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJFcnJvciBydW5uaW5nIGJvb2trZWVwZXIgZW5zZW1i\nbGUiLCBlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH07CiAgICAgICAgZW5zZW1ibGVUaHJlYWQuc3Rh\ncnQoKTsKCiAgICAgICAgaWYgKCFMb2NhbEJvb2tLZWVwZXIud2FpdEZvclNl\ncnZlclVwKHprU3RyaW5nLCA1MDAwKSkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgRXhjZXB0aW9uKCJGYWlsZWQgdG8gc3RhcnQgem9va2VlcGVyIik7CiAg\nICAgICAgfQogICAgICAgIFpvb0tlZXBlciB6ayA9IG51bGw7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggY29ubmVj\ndExhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwoKICAgICAgICAgICAg\nemsgPSBuZXcgWm9vS2VlcGVyKHprU3RyaW5nLCAxNTAwMCwgbmV3IFdhdGNo\nZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQg\nZXZlbnQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Lmdl\ndFN0YXRlKCkgPT0gS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgY29ubmVjdExhdGNoLmNvdW50RG93\nbigpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgfX0pOwogICAgICAgICAgICBpZiAoIWNvbm5lY3RMYXRjaC5hd2Fp\ndCgxMCwgVGltZVVuaXQuU0VDT05EUykpIHsKICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiQ291bGRuJ3QgY29ubmVjdCB0byB6b29rZWVwZXIgYXQgIiAr\nIHprU3RyaW5nKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJvb2tp\nZXMgPSB6ay5nZXRDaGlsZHJlbigiL2xlZGdlcnMvYXZhaWxhYmxlIiwgZmFs\nc2UpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoemsuZ2V0Q2hpbGRy\nZW4oIi9sZWRnZXJzL2F2YWlsYWJsZSIsIGZhbHNlKS5zaXplKCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgID09IG51bUJvb2tpZXMpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhp\nbmcKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbigiTm90IGVub3VnaCBib29r\naWVzIHN0YXJ0ZWQiKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIHprLmNsb3NlKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIEBBZnRlckNsYXNzCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgc3RvcEVu\nc2VtYmxlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGVuc2Vt\nYmxlVGhyZWFkICE9IG51bGwpIHsKICAgICAgICAgICAgZW5zZW1ibGVUaHJl\nYWQuaW50ZXJydXB0KCk7CiAgICAgICAgICAgIGVuc2VtYmxlVGhyZWFkLmpv\naW4oKTsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3QKICAgIHB1YmxpYyB2\nb2lkIHRlc3RUaHJvdWdocHV0TGF0ZW5jeSgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIEJlbmNoVGhyb3VnaHB1dExhdGVuY3kubWFpbihuZXcgU3Ry\naW5nW10gewogICAgICAgICAgICAgICAgIi0tdGltZSIsICIxMCIsCiAgICAg\nICAgICAgICAgICAiLS1za2lwd2FybXVwIiwKICAgICAgICAgICAgICAgICIt\nLXRocm90dGxlIiwgIjEiLAogICAgICAgICAgICAgICAgIi0tc2VuZGxpbWl0\nIiwgIjEwMDAwIgogICAgICAgICAgICB9KTsKICAgIH0KCiAgICBAVGVzdAog\nICAgcHVibGljIHZvaWQgdGVzdEJvb2tpZSgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIFN0cmluZyBib29raWUgPSBib29raWVzLmdldCgwKTsKICAg\nICAgICBTdHJpbmdbXSBwYXJ0cyA9IGJvb2tpZS5zcGxpdCgiOiIpOwogICAg\nICAgIEJlbmNoQm9va2llLm1haW4obmV3IFN0cmluZ1tdIHsKICAgICAgICAg\nICAgICAgICItLWhvc3QiLCBwYXJ0c1swXSwKICAgICAgICAgICAgICAgICIt\nLXBvcnQiLCBwYXJ0c1sxXSwKICAgICAgICAgICAgICAgICItLXpvb2tlZXBl\nciIsIHprU3RyaW5nCiAgICAgICAgICAgICAgICB9KTsKICAgIH0KCiAgICBA\nVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFJlYWRUaHJvdWdocHV0TGF0ZW5j\neSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEF0b21pY0Jvb2xlYW4g\ndGhyZXdFeGNlcHRpb24gPSBuZXcgQXRvbWljQm9vbGVhbihmYWxzZSk7CiAg\nICAgICAgVGhyZWFkIHQgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJlbmNoUmVhZFRocm91Z2hw\ndXRMYXRlbmN5Lm1haW4obmV3IFN0cmluZ1tdIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAiLS1saXN0ZW4iLCAiMTAifSk7CiAgICAgICAg\nICAgICAgICAgICAgfSBjYXRjaCAoVGhyb3dhYmxlIHQpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciByZWFkaW5nIiwgdCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9OwogICAgICAgIHQuc3RhcnQoKTsKCiAgICAgICAgVGhyZWFk\nLnNsZWVwKDEwMDAwKTsKICAgICAgICBieXRlIGRhdGFbXSA9IG5ldyBieXRl\nWzEwMjRdOwogICAgICAgIEFycmF5cy5maWxsKGRhdGEsIChieXRlKSd4Jyk7\nCgogICAgICAgIGxvbmcgbGFzdExlZGdlcklkID0gMDsKICAgICAgICBBc3Nl\ncnQuYXNzZXJ0VHJ1ZSgiVGhyZWFkIHNob3VsZCBiZSBydW5uaW5nIiwgdC5p\nc0FsaXZlKCkpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkr\nKykgewogICAgICAgICAgICBCb29rS2VlcGVyIGJrID0gbmV3IEJvb2tLZWVw\nZXIoemtTdHJpbmcpOwogICAgICAgICAgICBMZWRnZXJIYW5kbGUgbGggPSBi\nay5jcmVhdGVMZWRnZXIoQm9va0tlZXBlci5EaWdlc3RUeXBlLkNSQzMyLCAi\nYmVuY2hQYXNzd2QiLmdldEJ5dGVzKCkpOwogICAgICAgICAgICBsYXN0TGVk\nZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCAxMDA7IGorKykgewogICAg\nICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KGRhdGEpOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgICAgIGJrLmNsb3NlKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCA2MDsgaSsrKSB7CiAgICAgICAgICAgIGlmICghdC5pc0FsaXZlKCkp\nIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsgLy8gd2FpdCBmb3IgMTAgc2Vj\nb25kcyBmb3IgcmVhZGluZyB0byBmaW5pc2gKICAgICAgICB9CgogICAgICAg\nIEFzc2VydC5hc3NlcnRGYWxzZSgiVGhyZWFkIHNob3VsZCBiZSBmaW5pc2hl\nZCIsIHQuaXNBbGl2ZSgpKTsKCiAgICAgICAgQmVuY2hSZWFkVGhyb3VnaHB1\ndExhdGVuY3kubWFpbihuZXcgU3RyaW5nW10gewogICAgICAgICAgICAgICAg\nIi0tbGVkZ2VyIiwgU3RyaW5nLnZhbHVlT2YobGFzdExlZGdlcklkKX0pOwoK\nICAgICAgICBmaW5hbCBsb25nIG5leHRMZWRnZXJJZCA9IGxhc3RMZWRnZXJJ\nZCsxOwogICAgICAgIHQgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAgICAg\nICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAgICAgICAgIHRy\neSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJlbmNoUmVhZFRocm91Z2hw\ndXRMYXRlbmN5Lm1haW4obmV3IFN0cmluZ1tdIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAiLS1sZWRnZXIiLCBTdHJpbmcudmFsdWVPZihu\nZXh0TGVkZ2VySWQpfSk7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nVGhyb3dhYmxlIHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVy\ncm9yKCJFcnJvciByZWFkaW5nIiwgdCk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwogICAgICAgIHQu\nc3RhcnQoKTsKCiAgICAgICAgQXNzZXJ0LmFzc2VydFRydWUoIlRocmVhZCBz\naG91bGQgYmUgcnVubmluZyIsIHQuaXNBbGl2ZSgpKTsKICAgICAgICBCb29r\nS2VlcGVyIGJrID0gbmV3IEJvb2tLZWVwZXIoemtTdHJpbmcpOwogICAgICAg\nIExlZGdlckhhbmRsZSBsaCA9IGJrLmNyZWF0ZUxlZGdlcihCb29rS2VlcGVy\nLkRpZ2VzdFR5cGUuQ1JDMzIsICJiZW5jaFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGog\nPCAxMDA7IGorKykgewogICAgICAgICAgICAgICAgbGguYWRkRW50cnkoZGF0\nYSk7CiAgICAgICAgICAgIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAg\nICAgICBsaC5jbG9zZSgpOwogICAgICAgICAgICBiay5jbG9zZSgpOwogICAg\nICAgIH0KICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDYwOyBpKyspIHsK\nICAgICAgICAgICAgaWYgKCF0LmlzQWxpdmUoKSkgewogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgVGhyZWFkLnNs\nZWVwKDEwMDApOyAvLyB3YWl0IGZvciAxMCBzZWNvbmRzIGZvciByZWFkaW5n\nIHRvIGZpbmlzaAogICAgICAgIH0KICAgICAgICBBc3NlcnQuYXNzZXJ0RmFs\nc2UoIlRocmVhZCBzaG91bGQgYmUgZmluaXNoZWQiLCB0LmlzQWxpdmUoKSk7\nCiAgICB9Cn0=\n","encoding":"base64"}

