{"sha":"eae08a330c227013c401b9693903ae1814ba30e4","node_id":"MDQ6QmxvYjE1NzU5NTY6ZWFlMDhhMzMwYzIyNzAxM2M0MDFiOTY5MzkwM2FlMTgxNGJhMzBlNA==","size":29474,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/eae08a330c227013c401b9693903ae1814ba30e4","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5GaWxlTm90Rm91\nbmRFeGNlcHRpb247CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBv\ncnQgamF2YS5pby5GaWxlbmFtZUZpbHRlcjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRBZGRyZXNzOwppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7\nCmltcG9ydCBqYXZhLm5ldC5Vbmtub3duSG9zdEV4Y2VwdGlvbjsKaW1wb3J0\nIGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlM\naXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQgamF2\nYS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5IYXNoTWFwOwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5h\ndG9taWMuQXRvbWljQm9vbGVhbjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdlckZhY3Rvcnk7CmltcG9ydCBv\ncmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZUV4Y2VwdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWUuSm91cm5hbC5K\nb3VybmFsU2Nhbm5lcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nb25mLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuam14LkJLTUJlYW5JbmZvOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmpteC5CS01CZWFuUmVnaXN0cnk7CmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJh\nY2tzLldyaXRlQ2FsbGJhY2s7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5DcmVhdGVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS56\nb29rZWVwZXIuV2F0Y2hlZEV2ZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29r\nZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpv\nb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0RlZnMu\nSWRzOwoKLyoqCiAqIEltcGxlbWVudHMgYSBib29raWUuCiAqCiAqLwoKcHVi\nbGljIGNsYXNzIEJvb2tpZSBleHRlbmRzIFRocmVhZCB7CiAgICBzdGF0aWMg\nTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEJvb2tpZS5j\nbGFzcyk7CgogICAgZmluYWwgRmlsZSBqb3VybmFsRGlyZWN0b3J5OwogICAg\nZmluYWwgRmlsZSBsZWRnZXJEaXJlY3Rvcmllc1tdOwogICAgZmluYWwgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mOwoKICAgIGZpbmFsIFN5bmNUaHJlYWQg\nc3luY1RocmVhZDsKICAgIGZpbmFsIExlZGdlck1hbmFnZXIgbGVkZ2VyTWFu\nYWdlcjsKICAgIGZpbmFsIExlZGdlclN0b3JhZ2UgbGVkZ2VyU3RvcmFnZTsK\nICAgIGZpbmFsIEpvdXJuYWwgam91cm5hbDsKICAgIGZpbmFsIEhhbmRsZUZh\nY3RvcnkgaGFuZGxlczsKCiAgICBzdGF0aWMgZmluYWwgbG9uZyBNRVRBRU5U\nUllfSURfTEVER0VSX0tFWSA9IC0weDEwMDA7CgogICAgLy8gWksgcmVnaXN0\ncmF0aW9uIHBhdGggZm9yIHRoaXMgYm9va2llCiAgICBwcml2YXRlIGZpbmFs\nIFN0cmluZyBib29raWVSZWdpc3RyYXRpb25QYXRoOwogICAgc3RhdGljIGZp\nbmFsIFN0cmluZyBDVVJSRU5UX0RJUiA9ICJjdXJyZW50IjsKCiAgICAvLyBa\nb29LZWVwZXIgY2xpZW50IGluc3RhbmNlIGZvciB0aGUgQm9va2llCiAgICBa\nb29LZWVwZXIgems7CiAgICBwcml2YXRlIHZvbGF0aWxlIGJvb2xlYW4gaXNa\na0V4cGlyZWQgPSB0cnVlOwoKICAgIC8vIFJ1bm5pbmcgZmxhZwogICAgcHJp\ndmF0ZSB2b2xhdGlsZSBib29sZWFuIHJ1bm5pbmcgPSBmYWxzZTsKICAgIC8v\nIEZsYWcgaWRlbnRpZnkgd2hldGhlciBpdCBpcyBpbiBzaHV0dGluZyBkb3du\nIHByb2dyZXNzCiAgICBwcml2YXRlIHZvbGF0aWxlIGJvb2xlYW4gc2h1dHRp\nbmdkb3duID0gZmFsc2U7CgogICAgcHJpdmF0ZSBpbnQgZXhpdENvZGUgPSBF\neGl0Q29kZS5PSzsKCiAgICAvLyBqbXggcmVsYXRlZCBiZWFucwogICAgQm9v\na2llQmVhbiBqbXhCb29raWVCZWFuOwogICAgQktNQmVhbkluZm8gam14TGVk\nZ2VyU3RvcmFnZUJlYW47CgogICAgTWFwPExvbmcsIGJ5dGVbXT4gbWFzdGVy\nS2V5Q2FjaGUgPSBDb2xsZWN0aW9ucy5zeW5jaHJvbml6ZWRNYXAobmV3IEhh\nc2hNYXA8TG9uZywgYnl0ZVtdPigpKTsKCiAgICBwdWJsaWMgc3RhdGljIGNs\nYXNzIE5vTGVkZ2VyRXhjZXB0aW9uIGV4dGVuZHMgSU9FeGNlcHRpb24gewog\nICAgICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGxvbmcgc2VyaWFsVmVyc2lv\nblVJRCA9IDFMOwogICAgICAgIHByaXZhdGUgbG9uZyBsZWRnZXJJZDsKICAg\nICAgICBwdWJsaWMgTm9MZWRnZXJFeGNlcHRpb24obG9uZyBsZWRnZXJJZCkg\newogICAgICAgICAgICBzdXBlcigiTGVkZ2VyICIgKyBsZWRnZXJJZCArICIg\nbm90IGZvdW5kIik7CiAgICAgICAgICAgIHRoaXMubGVkZ2VySWQgPSBsZWRn\nZXJJZDsKICAgICAgICB9CiAgICAgICAgcHVibGljIGxvbmcgZ2V0TGVkZ2Vy\nSWQoKSB7CiAgICAgICAgICAgIHJldHVybiBsZWRnZXJJZDsKICAgICAgICB9\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIGNsYXNzIE5vRW50cnlFeGNlcHRp\nb24gZXh0ZW5kcyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgcHJpdmF0ZSBzdGF0\naWMgZmluYWwgbG9uZyBzZXJpYWxWZXJzaW9uVUlEID0gMUw7CiAgICAgICAg\ncHJpdmF0ZSBsb25nIGxlZGdlcklkOwogICAgICAgIHByaXZhdGUgbG9uZyBl\nbnRyeUlkOwogICAgICAgIHB1YmxpYyBOb0VudHJ5RXhjZXB0aW9uKGxvbmcg\nbGVkZ2VySWQsIGxvbmcgZW50cnlJZCkgewogICAgICAgICAgICBzdXBlcigi\nRW50cnkgIiArIGVudHJ5SWQgKyAiIG5vdCBmb3VuZCBpbiAiICsgbGVkZ2Vy\nSWQpOwogICAgICAgICAgICB0aGlzLmxlZGdlcklkID0gbGVkZ2VySWQ7CiAg\nICAgICAgICAgIHRoaXMuZW50cnlJZCA9IGVudHJ5SWQ7CiAgICAgICAgfQog\nICAgICAgIHB1YmxpYyBsb25nIGdldExlZGdlcigpIHsKICAgICAgICAgICAg\ncmV0dXJuIGxlZGdlcklkOwogICAgICAgIH0KICAgICAgICBwdWJsaWMgbG9u\nZyBnZXRFbnRyeSgpIHsKICAgICAgICAgICAgcmV0dXJuIGVudHJ5SWQ7CiAg\nICAgICAgfQogICAgfQoKICAgIC8vIFdyaXRlIENhbGxiYWNrIGRvIG5vdGhp\nbmcKICAgIHN0YXRpYyBjbGFzcyBOb3BXcml0ZUNhbGxiYWNrIGltcGxlbWVu\ndHMgV3JpdGVDYWxsYmFjayB7CiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgd3JpdGVDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2Vy\nSWQsIGxvbmcgZW50cnlJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIE9iamVjdCBjdHgpIHsK\nICAgICAgICAgICAgTE9HLmRlYnVnKCJGaW5pc2hlZCB3cml0aW5nIGVudHJ5\nIHt9IEAgbGVkZ2VyIHt9IGZvciB7fSA6IHt9IiwKICAgICAgICAgICAgICAg\nICAgICAgIG5ldyBPYmplY3RbXSB7IGVudHJ5SWQsIGxlZGdlcklkLCBhZGRy\nLCByYyB9KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBTeW5j\nVGhyZWFkIGlzIGEgYmFja2dyb3VuZCB0aHJlYWQgd2hpY2ggZmx1c2hlcyBs\nZWRnZXIgaW5kZXggcGFnZXMgcGVyaW9kaWNhbGx5LgogICAgICogQWxzbyBp\ndCB0YWtlcyByZXNwb25zaWJpbGl0eSBvZiBnYXJiYWdlIGNvbGxlY3Rpbmcg\nam91cm5hbCBmaWxlcy4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIEJlZm9y\nZSBmbHVzaGluZywgU3luY1RocmVhZCBmaXJzdCByZWNvcmRzIGEgbG9nIG1h\ncmtlciB7am91cm5hbElkLCBqb3VybmFsUG9zfSBpbiBtZW1vcnksCiAgICAg\nKiB3aGljaCBpbmRpY2F0ZXMgZW50cmllcyBiZWZvcmUgdGhpcyBsb2cgbWFy\na2VyIHdvdWxkIGJlIHBlcnNpc3RlZCB0byBsZWRnZXIgZmlsZXMuCiAgICAg\nKiBUaGVuIHN5bmMgdGhyZWFkIGJlZ2lucyBmbHVzaGluZyBsZWRnZXIgaW5k\nZXggcGFnZXMgdG8gbGVkZ2VyIGluZGV4IGZpbGVzLCBmbHVzaCBlbnRyeQog\nICAgICogbG9nZ2VyIHRvIGVuc3VyZSBhbGwgZW50cmllcyBwZXJzaXN0ZWQg\ndG8gZW50cnkgbG9nZ2VycyBmb3IgZnV0dXJlIHJlYWRzLgogICAgICogPC9w\nPgogICAgICogPHA+CiAgICAgKiBBZnRlciBhbGwgZGF0YSBoYXMgYmVlbiBw\nZXJzaXN0ZWQgdG8gbGVkZ2VyIGluZGV4IGZpbGVzIGFuZCBlbnRyeSBsb2dn\nZXJzLCBpdCBpcyBzYWZlCiAgICAgKiB0byBwZXJzaXN0IHRoZSBsb2cgbWFy\na2VyIHRvIGRpc2suIElmIGJvb2tpZSBmYWlsZWQgYWZ0ZXIgcGVyc2lzdCBs\nb2cgbWFyaywKICAgICAqIGJvb2tpZSBpcyBhYmxlIHRvIHJlbGF5IGpvdXJu\nYWwgZW50cmllcyBzdGFydGVkIGZyb20gbGFzdCBsb2cgbWFyayB3aXRob3V0\nIGxvc2luZwogICAgICogYW55IGVudHJpZXMuCiAgICAgKiA8L3A+CiAgICAg\nKiA8cD4KICAgICAqIFRob3NlIGpvdXJuYWwgZmlsZXMgd2hvc2UgaWQgYXJl\nIGxlc3MgdGhhbiB0aGUgbG9nIGlkIGluIGxhc3QgbG9nIG1hcmssIGNvdWxk\nIGJlCiAgICAgKiByZW1vdmVkIHNhZmVseSBhZnRlciBwZXJzaXN0aW5nIGxh\nc3QgbG9nIG1hcmsuIFdlIHByb3ZpZGUgYSBzZXR0aW5nIHRvIGxldCB1c2Vy\nIGtlZXBpbmcKICAgICAqIG51bWJlciBvZiBvbGQgam91cm5hbCBmaWxlcyB3\naGljaCBtYXkgYmUgdXNlZCBmb3IgbWFudWFsIHJlY292ZXJ5IGluIGNyaXRp\nY2FsIGRpc2FzdGVyLgogICAgICogPC9wPgogICAgICovCiAgICBjbGFzcyBT\neW5jVGhyZWFkIGV4dGVuZHMgVGhyZWFkIHsKICAgICAgICB2b2xhdGlsZSBi\nb29sZWFuIHJ1bm5pbmcgPSB0cnVlOwogICAgICAgIC8vIGZsYWcgdG8gZW5z\ndXJlIHN5bmMgdGhyZWFkIHdpbGwgbm90IGJlIGludGVycnVwdGVkIGR1cmlu\nZyBmbHVzaAogICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gZmx1c2hpbmcg\nPSBuZXcgQXRvbWljQm9vbGVhbihmYWxzZSk7CiAgICAgICAgLy8gbWFrZSBm\nbHVzaCBpbnRlcnZhbCBhcyBhIHBhcmFtZXRlcgogICAgICAgIGZpbmFsIGlu\ndCBmbHVzaEludGVydmFsOwogICAgICAgIHB1YmxpYyBTeW5jVGhyZWFkKFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZikgewogICAgICAgICAgICBzdXBlcigi\nU3luY1RocmVhZCIpOwogICAgICAgICAgICBmbHVzaEludGVydmFsID0gY29u\nZi5nZXRGbHVzaEludGVydmFsKCk7CiAgICAgICAgICAgIGlmIChMT0cuaXNE\nZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJG\nbHVzaCBJbnRlcnZhbCA6ICIgKyBmbHVzaEludGVydmFsKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIHdoaWxlKHJ1bm5pbmcpIHsK\nICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAg\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgd2Fp\ndChmbHVzaEludGVydmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYg\nKCFsZWRnZXJTdG9yYWdlLmlzRmx1c2hSZXF1aXJlZCgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVy\ncnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1cHQoKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIHRyeSB0\nbyBtYXJrIGZsdXNoaW5nIGZsYWcgdG8gbWFrZSBzdXJlIGl0IHdvdWxkIG5v\ndCBiZSBpbnRlcnJ1cHRlZAogICAgICAgICAgICAgICAgLy8gYnkgc2h1dGRv\nd24gZHVyaW5nIGZsdXNoaW5nLiBvdGhlcndpc2UgaXQgd2lsbCByZWNlaXZl\nCiAgICAgICAgICAgICAgICAvLyBDbG9zZWRCeUludGVycnVwdEV4Y2VwdGlv\nbiB3aGljaCBtYXkgY2F1c2UgaW5kZXggZmlsZSAmIGVudHJ5IGxvZ2dlcgog\nICAgICAgICAgICAgICAgLy8gY2xvc2VkIGFuZCBjb3JydXB0ZWQuCiAgICAg\nICAgICAgICAgICBpZiAoIWZsdXNoaW5nLmNvbXBhcmVBbmRTZXQoZmFsc2Us\nIHRydWUpKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IGZsdXNoaW5n\nIGZsYWcgZmFpbGVkLCBtZWFucyBmbHVzaGluZyBpcyB0cnVlIG5vdwogICAg\nICAgICAgICAgICAgICAgIC8vIGluZGljYXRlcyBhbm90aGVyIHRocmVhZCB3\nYW50cyB0byBpbnRlcnJ1cHQgc3luYyB0aHJlYWQgdG8gZXhpdAogICAgICAg\nICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgICAgIC8vIGpvdXJuYWwgbWFyayBsb2cKICAgICAgICAgICAgICAg\nIGpvdXJuYWwubWFya0xvZygpOwoKICAgICAgICAgICAgICAgIGJvb2xlYW4g\nZmx1c2hGYWlsZWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgbGVkZ2VyU3RvcmFnZS5mbHVzaCgpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIGZsdXNoaW5nIExl\nZGdlciIsIGUpOwogICAgICAgICAgICAgICAgICAgIGZsdXNoRmFpbGVkID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyBp\nZiBmbHVzaCBmYWlsZWQsIHdlIHNob3VsZCBub3Qgcm9sbCBsYXN0IG1hcmss\nIG90aGVyd2lzZSB3ZSB3b3VsZAogICAgICAgICAgICAgICAgLy8gaGF2ZSBz\nb21lIGxlZGdlcnMgYXJlIG5vdCBmbHVzaGVkIGFuZCB0aGVpciBqb3VybmFs\nIGVudHJpZXMgd2VyZSBsb3N0CiAgICAgICAgICAgICAgICBpZiAoIWZsdXNo\nRmFpbGVkKSB7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5yb2xsTG9n\nKCk7CiAgICAgICAgICAgICAgICAgICAgam91cm5hbC5nY0pvdXJuYWxzKCk7\nCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgLy8gY2xlYXIg\nZmx1c2hpbmcgZmxhZwogICAgICAgICAgICAgICAgZmx1c2hpbmcuc2V0KGZh\nbHNlKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8gc2h1\ndGRvd24gc3luYyB0aHJlYWQKICAgICAgICB2b2lkIHNodXRkb3duKCkgdGhy\nb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICAgICAgcnVubmlu\nZyA9IGZhbHNlOwogICAgICAgICAgICBpZiAoZmx1c2hpbmcuY29tcGFyZUFu\nZFNldChmYWxzZSwgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHNl\ndHRpbmcgZmx1c2hpbmcgZmxhZyBzdWNjZWVkLCBtZWFucyBzeW5jVGhyZWFk\nIGlzIG5vdCBmbHVzaGluZyBub3cKICAgICAgICAgICAgICAgIC8vIGl0IGlz\nIHNhZmUgdG8gaW50ZXJydXB0IGl0c2VsZiBub3cgCiAgICAgICAgICAgICAg\nICB0aGlzLmludGVycnVwdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAg\nIHRoaXMuam9pbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgY2hlY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoRmlsZSBkaXIpIHRo\ncm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFkaXIuZXhpc3RzKCkp\nIHsKICAgICAgICAgICAgRmlsZSBwYXJlbnQgPSBkaXIuZ2V0UGFyZW50Rmls\nZSgpOwogICAgICAgICAgICBGaWxlIHByZVYzdmVyc2lvbkZpbGUgPSBuZXcg\nRmlsZShkaXIuZ2V0UGFyZW50KCksIENvb2tpZS5WRVJTSU9OX0ZJTEVOQU1F\nKTsKCiAgICAgICAgICAgIGZpbmFsIEF0b21pY0Jvb2xlYW4gb2xkRGF0YUV4\naXN0cyA9IG5ldyBBdG9taWNCb29sZWFuKGZhbHNlKTsKICAgICAgICAgICAg\ncGFyZW50Lmxpc3QobmV3IEZpbGVuYW1lRmlsdGVyKCkgewogICAgICAgICAg\nICAgICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChGaWxlIGRpciwgU3Ry\naW5nIG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUu\nZW5kc1dpdGgoIi50eG4iKSB8fCBuYW1lLmVuZHNXaXRoKCIuaWR4IikgfHwg\nbmFtZS5lbmRzV2l0aCgiLmxvZyIpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBvbGREYXRhRXhpc3RzLnNldCh0cnVlKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4g\ndHJ1ZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9\nKTsKICAgICAgICAgICAgaWYgKHByZVYzdmVyc2lvbkZpbGUuZXhpc3RzKCkg\nfHwgb2xkRGF0YUV4aXN0cy5nZXQoKSkgewogICAgICAgICAgICAgICAgU3Ry\naW5nIGVyciA9ICJEaXJlY3RvcnkgbGF5b3V0IHZlcnNpb24gaXMgbGVzcyB0\naGFuIDMsIHVwZ3JhZGUgbmVlZGVkIjsKICAgICAgICAgICAgICAgIExPRy5l\ncnJvcihlcnIpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0\naW9uKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCFkaXIu\nbWtkaXJzKCkpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBlcnIgPSAiVW5h\nYmxlIHRvIGNyZWF0ZSBkaXJlY3RvcnkgIiArIGRpcjsKICAgICAgICAgICAg\nICAgIExPRy5lcnJvcihlcnIpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIElPRXhjZXB0aW9uKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBDaGVjayB0aGF0IHRoZSBlbnZpcm9ubWVu\ndCBmb3IgdGhlIGJvb2tpZSBpcyBjb3JyZWN0LgogICAgICogVGhpcyBtZWFu\ncyB0aGF0IHRoZSBjb25maWd1cmF0aW9uIGhhcyBzdGF5ZWQgdGhlIHNhbWUg\nYXMgdGhlCiAgICAgKiBmaXJzdCBydW4gYW5kIHRoZSBmaWxlc3lzdGVtIHN0\ncnVjdHVyZSBpcyB1cCB0byBkYXRlLgogICAgICovCiAgICBwcml2YXRlIHZv\naWQgY2hlY2tFbnZpcm9ubWVudChab29LZWVwZXIgemspIHRocm93cyBCb29r\naWVFeGNlcHRpb24sIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoemsgPT0g\nbnVsbCkgeyAvLyBleGlzdHMgb25seSBmb3IgdGVzdGluZywganVzdCBtYWtl\nIHN1cmUgZGlyZWN0b3JpZXMgYXJlIGNvcnJlY3QKICAgICAgICAgICAgY2hl\nY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoam91cm5hbERpcmVjdG9yeSk7CiAgICAg\nICAgICAgIGZvciAoRmlsZSBkaXIgOiBsZWRnZXJEaXJlY3Rvcmllcykgewog\nICAgICAgICAgICAgICAgICAgIGNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKGRp\ncik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuOwogICAgICAg\nIH0KICAgICAgICB0cnkgewogICAgICAgICAgICBib29sZWFuIG5ld0VudiA9\nIGZhbHNlOwogICAgICAgICAgICBDb29raWUgbWFzdGVyQ29va2llID0gQ29v\na2llLmdlbmVyYXRlQ29va2llKGNvbmYpOwogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgQ29va2llIHprQ29va2llID0gQ29va2llLnJlYWRG\ncm9tWm9vS2VlcGVyKHprLCBjb25mKTsKICAgICAgICAgICAgICAgIG1hc3Rl\nckNvb2tpZS52ZXJpZnkoemtDb29raWUpOwogICAgICAgICAgICB9IGNhdGNo\nIChLZWVwZXJFeGNlcHRpb24uTm9Ob2RlRXhjZXB0aW9uIG5uZSkgewogICAg\nICAgICAgICAgICAgbmV3RW52ID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBMaXN0PEZpbGU+IG1pc3NlZENvb2tpZURpcnMgPSBuZXcgQXJy\nYXlMaXN0PEZpbGU+KCk7CiAgICAgICAgICAgIGNoZWNrRGlyZWN0b3J5U3Ry\ndWN0dXJlKGpvdXJuYWxEaXJlY3RvcnkpOwoKICAgICAgICAgICAgLy8gdHJ5\nIHRvIHJlYWQgY29va2llIGZyb20gam91cm5hbCBkaXJlY3RvcnkKICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIENvb2tpZSBqb3VybmFsQ29v\na2llID0gQ29va2llLnJlYWRGcm9tRGlyZWN0b3J5KGpvdXJuYWxEaXJlY3Rv\ncnkpOwogICAgICAgICAgICAgICAgam91cm5hbENvb2tpZS52ZXJpZnkobWFz\ndGVyQ29va2llKTsKICAgICAgICAgICAgfSBjYXRjaCAoRmlsZU5vdEZvdW5k\nRXhjZXB0aW9uIGZuZikgewogICAgICAgICAgICAgICAgbWlzc2VkQ29va2ll\nRGlycy5hZGQoam91cm5hbERpcmVjdG9yeSk7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgZm9yIChGaWxlIGRpciA6IGxlZGdlckRpcmVjdG9yaWVzKSB7\nCiAgICAgICAgICAgICAgICBjaGVja0RpcmVjdG9yeVN0cnVjdHVyZShkaXIp\nOwogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICBD\nb29raWUgYyA9IENvb2tpZS5yZWFkRnJvbURpcmVjdG9yeShkaXIpOwogICAg\nICAgICAgICAgICAgICAgIGMudmVyaWZ5KG1hc3RlckNvb2tpZSk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChGaWxlTm90Rm91bmRFeGNlcHRpb24gZm5m\nKSB7CiAgICAgICAgICAgICAgICAgICAgbWlzc2VkQ29va2llRGlycy5hZGQo\nZGlyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKCFuZXdFbnYgJiYgbWlzc2VkQ29va2llRGlycy5zaXplKCkg\nPiAwKXsKICAgICAgICAgICAgICAgIExPRy5lcnJvcigiQ29va2llIGV4aXN0\ncyBpbiB6b29rZWVwZXIsIGJ1dCBub3QgaW4gYWxsIGxvY2FsIGRpcmVjdG9y\naWVzLiAiCiAgICAgICAgICAgICAgICAgICAgICAgICsgIiBEaXJlY3Rvcmll\ncyBtaXNzaW5nIGNvb2tpZSBmaWxlIGFyZSAiICsgbWlzc2VkQ29va2llRGly\ncyk7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9u\nLkludmFsaWRDb29raWVFeGNlcHRpb24oKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBpZiAobmV3RW52KSB7CiAgICAgICAgICAgICAgICBpZiAobWlz\nc2VkQ29va2llRGlycy5zaXplKCkgPiAwKSB7CiAgICAgICAgICAgICAgICAg\nICAgTE9HLmRlYnVnKCJEaXJlY3RvcmllcyBtaXNzaW5nIGNvb2tpZSBmaWxl\nIGFyZSB7fSIsIG1pc3NlZENvb2tpZURpcnMpOwogICAgICAgICAgICAgICAg\nICAgIG1hc3RlckNvb2tpZS53cml0ZVRvRGlyZWN0b3J5KGpvdXJuYWxEaXJl\nY3RvcnkpOwogICAgICAgICAgICAgICAgICAgIGZvciAoRmlsZSBkaXIgOiBs\nZWRnZXJEaXJlY3RvcmllcykgewogICAgICAgICAgICAgICAgICAgICAgICBt\nYXN0ZXJDb29raWUud3JpdGVUb0RpcmVjdG9yeShkaXIpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIG1hc3RlckNvb2tpZS53cml0ZVRvWm9vS2VlcGVyKHprLCBjb25mKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEtlZXBlckV4Y2VwdGlvbiBr\nZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkbid0IGFjY2VzcyBj\nb29raWUgaW4gem9va2VlcGVyIiwga2UpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgQm9va2llRXhjZXB0aW9uLkludmFsaWRDb29raWVFeGNlcHRpb24oa2Up\nOwogICAgICAgIH0gY2F0Y2ggKFVua25vd25Ib3N0RXhjZXB0aW9uIHVoZSkg\newogICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkbid0IGNoZWNrIGNvb2tp\nZXMsIG5ldHdvcmtpbmcgaXMgYnJva2VuIiwgdWhlKTsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5JbnZhbGlkQ29va2llRXhjZXB0\naW9uKHVoZSk7CiAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7\nCiAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgYWNjZXNzaW5nIGNvb2tp\nZSBvbiBkaXNrcyIsIGlvZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBCb29r\naWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlvbihpb2UpOwogICAg\nICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGllKSB7CiAgICAg\nICAgICAgIExPRy5lcnJvcigiVGhyZWFkIGludGVycnVwdGVkIHdoaWxlIGNo\nZWNraW5nIGNvb2tpZXMsIGV4aXRpbmciLCBpZSk7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tpZUV4Y2VwdGlv\nbihpZSk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgRmls\nZSBnZXRDdXJyZW50RGlyZWN0b3J5KEZpbGUgZGlyKSB7CiAgICAgICAgcmV0\ndXJuIG5ldyBGaWxlKGRpciwgQ1VSUkVOVF9ESVIpOwogICAgfQoKICAgIHB1\nYmxpYyBzdGF0aWMgRmlsZVtdIGdldEN1cnJlbnREaXJlY3RvcmllcyhGaWxl\nW10gZGlycykgewogICAgICAgIEZpbGVbXSBjdXJyZW50RGlycyA9IG5ldyBG\naWxlW2RpcnMubGVuZ3RoXTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGRpcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgY3VycmVudERpcnNb\naV0gPSBnZXRDdXJyZW50RGlyZWN0b3J5KGRpcnNbaV0pOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gY3VycmVudERpcnM7CiAgICB9CgoKICAgIHB1Ymxp\nYyBCb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAgICAg\nICB0aHJvd3MgSU9FeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgc3Vw\nZXIoIkJvb2tpZS0iICsgY29uZi5nZXRCb29raWVQb3J0KCkpOwogICAgICAg\nIHRoaXMuYm9va2llUmVnaXN0cmF0aW9uUGF0aCA9IGNvbmYuZ2V0WmtBdmFp\nbGFibGVCb29raWVzUGF0aCgpICsgIi8iOwogICAgICAgIHRoaXMuY29uZiA9\nIGNvbmY7CiAgICAgICAgdGhpcy5qb3VybmFsRGlyZWN0b3J5ID0gZ2V0Q3Vy\ncmVudERpcmVjdG9yeShjb25mLmdldEpvdXJuYWxEaXIoKSk7CiAgICAgICAg\ndGhpcy5sZWRnZXJEaXJlY3RvcmllcyA9IGdldEN1cnJlbnREaXJlY3Rvcmll\ncyhjb25mLmdldExlZGdlckRpcnMoKSk7CgogICAgICAgIC8vIGluc3RhbnRp\nYXRlIHpvb2tlZXBlciBjbGllbnQgdG8gaW5pdGlhbGl6ZSBsZWRnZXIgbWFu\nYWdlcgogICAgICAgIHRoaXMuemsgPSBpbnN0YW50aWF0ZVpvb2tlZXBlckNs\naWVudChjb25mKTsKICAgICAgICBjaGVja0Vudmlyb25tZW50KHRoaXMuemsp\nOwoKICAgICAgICBsZWRnZXJNYW5hZ2VyID0gTGVkZ2VyTWFuYWdlckZhY3Rv\ncnkubmV3TGVkZ2VyTWFuYWdlcihjb25mLCB0aGlzLnprKTsKCiAgICAgICAg\nc3luY1RocmVhZCA9IG5ldyBTeW5jVGhyZWFkKGNvbmYpOwogICAgICAgIGxl\nZGdlclN0b3JhZ2UgPSBuZXcgSW50ZXJsZWF2ZWRMZWRnZXJTdG9yYWdlKGNv\nbmYsIGxlZGdlck1hbmFnZXIpOwogICAgICAgIGhhbmRsZXMgPSBuZXcgSGFu\nZGxlRmFjdG9yeUltcGwobGVkZ2VyU3RvcmFnZSk7CiAgICAgICAgLy8gaW5z\ndGFudGlhdGUgdGhlIGpvdXJuYWwKICAgICAgICBqb3VybmFsID0gbmV3IEpv\ndXJuYWwoY29uZik7CgogICAgICAgIC8vIHJlcGxheSBqb3VybmFscwogICAg\nICAgIHJlYWRKb3VybmFsKCk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHJl\nYWRKb3VybmFsKCkgdGhyb3dzIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRp\nb24gewogICAgICAgIGpvdXJuYWwucmVwbGF5KG5ldyBKb3VybmFsU2Nhbm5l\ncigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHByb2Nlc3MoaW50IGpvdXJuYWxWZXJzaW9uLCBsb25nIG9mZnNl\ndCwgQnl0ZUJ1ZmZlciByZWNCdWZmKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgICAgICAgICAgbG9uZyBsZWRnZXJJZCA9IHJlY0J1ZmYuZ2V0TG9u\nZygpOwogICAgICAgICAgICAgICAgbG9uZyBlbnRyeUlkID0gcmVjQnVmZi5n\nZXRMb25nKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIExPRy5kZWJ1ZygiUmVwbGF5IGpvdXJuYWwgLSBsZWRnZXIgaWQg\nOiB7fSwgZW50cnkgaWQgOiB7fS4iLCBsZWRnZXJJZCwgZW50cnlJZCk7CiAg\nICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5SWQgPT0gTUVUQUVOVFJZX0lE\nX0xFREdFUl9LRVkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGpv\ndXJuYWxWZXJzaW9uID49IDMpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGludCBtYXN0ZXJLZXlMZW4gPSByZWNCdWZmLmdldEludCgpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgYnl0ZVtdIG1hc3RlcktleSA9IG5l\ndyBieXRlW21hc3RlcktleUxlbl07CgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgcmVjQnVmZi5nZXQobWFzdGVyS2V5KTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIG1hc3RlcktleUNhY2hlLnB1dChsZWRnZXJJZCwgbWFz\ndGVyS2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlv\nbigiSW52YWxpZCBqb3VybmFsLiBDb250YWlucyBqb3VybmFsS2V5ICIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGJ1dCBsYXlv\ndXQgdmVyc2lvbiAoIiArIGpvdXJuYWxWZXJzaW9uCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgIikgaXMgdG9vIG9sZCB0byBob2xk\nIHRoaXMiKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJ5\ndGVbXSBrZXkgPSBtYXN0ZXJLZXlDYWNoZS5nZXQobGVkZ2VySWQpOwogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoa2V5ID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGtleSA9IGxlZGdlclN0b3JhZ2UucmVh\nZE1hc3RlcktleShsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBo\nYW5kbGUgPSBoYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJZCwga2V5KTsKCiAg\nICAgICAgICAgICAgICAgICAgICAgIHJlY0J1ZmYucmV3aW5kKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGhhbmRsZS5hZGRFbnRyeShyZWNCdWZmKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNo\nIChOb0xlZGdlckV4Y2VwdGlvbiBuc2xlKSB7CiAgICAgICAgICAgICAgICAg\nICAgTE9HLmRlYnVnKCJTa2lwIHJlcGxheWluZyBlbnRyaWVzIG9mIGxlZGdl\nciB7fSBzaW5jZSBpdCB3YXMgZGVsZXRlZC4iLCBsZWRnZXJJZCk7CiAgICAg\nICAgICAgICAgICB9IGNhdGNoIChCb29raWVFeGNlcHRpb24gYmUpIHsKICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oYmUpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAg\nICB9CgogICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHN0YXJ0KCkgewog\nICAgICAgIHNldERhZW1vbih0cnVlKTsKICAgICAgICBMT0cuZGVidWcoIkkn\nbSBzdGFydGluZyBhIGJvb2tpZSB3aXRoIGpvdXJuYWwgZGlyZWN0b3J5ICIg\nKyBqb3VybmFsRGlyZWN0b3J5LmdldE5hbWUoKSk7CiAgICAgICAgLy8gc3Rh\ncnQgYm9va2llIHRocmVhZAogICAgICAgIHN1cGVyLnN0YXJ0KCk7CiAgICAg\nICAgc3luY1RocmVhZC5zdGFydCgpOwoKICAgICAgICBsZWRnZXJTdG9yYWdl\nLnN0YXJ0KCk7CiAgICAgICAgLy8gc2V0IHJ1bm5pbmcgaGVyZS4KICAgICAg\nICAvLyBzaW5jZSBib29raWUgc2VydmVyIHVzZSBydW5uaW5nIGFzIGEgZmxh\nZyB0byB0ZWxsIGJvb2tpZSBzZXJ2ZXIgd2hldGhlciBpdCBpcyBhbGl2ZQog\nICAgICAgIC8vIGlmIHNldHRpbmcgaXQgaW4gYm9va2llIHRocmVhZCwgdGhl\nIHdhdGNoZXIgbWlnaHQgcnVuIGJlZm9yZSBib29raWUgdGhyZWFkLgogICAg\nICAgIHJ1bm5pbmcgPSB0cnVlOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIHJlZ2lzdGVyQm9va2llKGNvbmYuZ2V0Qm9va2llUG9ydCgpKTsKICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5l\ncnJvcigiQ291bGRuJ3QgcmVnaXN0ZXIgYm9va2llIHdpdGggem9va2VlcGVy\nLCBzaHV0dGluZyBkb3duIiwgZSk7CiAgICAgICAgICAgIHNodXRkb3duKEV4\naXRDb2RlLlpLX1JFR19GQUlMKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBSZWdpc3RlciBqbXggd2l0aCBwYXJlbnQKICAgICAqCiAgICAg\nKiBAcGFyYW0gcGFyZW50IHBhcmVudCBiayBtYmVhbiBpbmZvCiAgICAgKi8K\nICAgIHB1YmxpYyB2b2lkIHJlZ2lzdGVySk1YKEJLTUJlYW5JbmZvIHBhcmVu\ndCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGpteEJvb2tpZUJlYW4g\nPSBuZXcgQm9va2llQmVhbih0aGlzKTsKICAgICAgICAgICAgQktNQmVhblJl\nZ2lzdHJ5LmdldEluc3RhbmNlKCkucmVnaXN0ZXIoam14Qm9va2llQmVhbiwg\ncGFyZW50KTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBq\nbXhMZWRnZXJTdG9yYWdlQmVhbiA9IHRoaXMubGVkZ2VyU3RvcmFnZS5nZXRK\nTVhCZWFuKCk7CiAgICAgICAgICAgICAgICBCS01CZWFuUmVnaXN0cnkuZ2V0\nSW5zdGFuY2UoKS5yZWdpc3RlcihqbXhMZWRnZXJTdG9yYWdlQmVhbiwgam14\nQm9va2llQmVhbik7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICBMT0cud2FybigiRmFpbGVkIHRvIHJlZ2lz\ndGVyIHdpdGggSk1YIGZvciBsZWRnZXIgY2FjaGUiLCBlKTsKICAgICAgICAg\nICAgICAgIGpteExlZGdlclN0b3JhZ2VCZWFuID0gbnVsbDsKICAgICAgICAg\nICAgfQogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgIExPRy53YXJuKCJGYWlsZWQgdG8gcmVnaXN0ZXIgd2l0aCBKTVgiLCBl\nKTsKICAgICAgICAgICAgam14Qm9va2llQmVhbiA9IG51bGw7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVW5yZWdpc3RlciBqbXgKICAgICAq\nLwogICAgcHVibGljIHZvaWQgdW5yZWdpc3RlckpNWCgpIHsKICAgICAgICB0\ncnkgewogICAgICAgICAgICBpZiAoam14TGVkZ2VyU3RvcmFnZUJlYW4gIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgQktNQmVhblJlZ2lzdHJ5LmdldElu\nc3RhbmNlKCkudW5yZWdpc3RlcihqbXhMZWRnZXJTdG9yYWdlQmVhbik7CiAg\nICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBMT0cud2FybigiRmFpbGVkIHRvIHVucmVnaXN0ZXIgd2l0\naCBKTVgiLCBlKTsKICAgICAgICB9CiAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgaWYgKGpteEJvb2tpZUJlYW4gIT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgQktNQmVhblJlZ2lzdHJ5LmdldEluc3RhbmNlKCkudW5yZWdpc3Rlcihq\nbXhCb29raWVCZWFuKTsKICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJGYWlsZWQg\ndG8gdW5yZWdpc3RlciB3aXRoIEpNWCIsIGUpOwogICAgICAgIH0KICAgICAg\nICBqbXhCb29raWVCZWFuID0gbnVsbDsKICAgICAgICBqbXhMZWRnZXJTdG9y\nYWdlQmVhbiA9IG51bGw7CiAgICB9CgoKICAgIC8qKgogICAgICogSW5zdGFu\ndGlhdGUgdGhlIFpvb0tlZXBlciBjbGllbnQgZm9yIHRoZSBCb29raWUuCiAg\nICAgKi8KICAgIHByaXZhdGUgWm9vS2VlcGVyIGluc3RhbnRpYXRlWm9va2Vl\ncGVyQ2xpZW50KFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZikgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICBpZiAoY29uZi5nZXRaa1NlcnZlcnMoKSA9\nPSBudWxsKSB7CiAgICAgICAgICAgIExPRy53YXJuKCJObyBaSyBzZXJ2ZXJz\nIHBhc3NlZCB0byBCb29raWUgY29uc3RydWN0b3Igc28gQm9va0tlZXBlciBj\nbGllbnRzIHdvbid0IGtub3cgYWJvdXQgdGhpcyBzZXJ2ZXIhIik7CiAgICAg\nICAgICAgIGlzWmtFeHBpcmVkID0gZmFsc2U7CiAgICAgICAgICAgIHJldHVy\nbiBudWxsOwogICAgICAgIH0KICAgICAgICAvLyBDcmVhdGUgdGhlIFpvb0tl\nZXBlciBjbGllbnQgaW5zdGFuY2UKICAgICAgICByZXR1cm4gbmV3Wm9va2Vl\ncGVyKGNvbmYuZ2V0WmtTZXJ2ZXJzKCksIGNvbmYuZ2V0WmtUaW1lb3V0KCkp\nOwogICAgfQoKICAgIC8qKgogICAgICogUmVnaXN0ZXIgYXMgYW4gYXZhaWxh\nYmxlIGJvb2tpZQogICAgICovCiAgICBwcml2YXRlIHZvaWQgcmVnaXN0ZXJC\nb29raWUoaW50IHBvcnQpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKG51bGwgPT0gemspIHsKICAgICAgICAgICAgLy8gem9va2VlcGVyIGlu\nc3RhbmNlIGlzIG51bGwsIG1lYW5zIG5vdCByZWdpc3RlciBpdHNlbGYgdG8g\nemsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICAvLyBD\ncmVhdGUgdGhlIFpLIGVwaGVtZXJhbCBub2RlIGZvciB0aGlzIEJvb2tpZS4K\nICAgICAgICB0cnkgewogICAgICAgICAgICB6ay5jcmVhdGUodGhpcy5ib29r\naWVSZWdpc3RyYXRpb25QYXRoICsgSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0\nKCkuZ2V0SG9zdEFkZHJlc3MoKSArICI6IiArIHBvcnQsIG5ldyBieXRlWzBd\nLAogICAgICAgICAgICAgICAgICAgICAgSWRzLk9QRU5fQUNMX1VOU0FGRSwg\nQ3JlYXRlTW9kZS5FUEhFTUVSQUwpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiWksgZXhjZXB0aW9u\nIHJlZ2lzdGVyaW5nIGVwaGVtZXJhbCBabm9kZSBmb3IgQm9va2llISIsIGUp\nOwogICAgICAgICAgICAvLyBUaHJvdyBhbiBJT0V4Y2VwdGlvbiBiYWNrIHVw\nLiBUaGlzIHdpbGwgY2F1c2UgdGhlIEJvb2tpZQogICAgICAgICAgICAvLyBj\nb25zdHJ1Y3RvciB0byBlcnJvciBvdXQuIEFsdGVybmF0aXZlbHksIHdlIGNv\ndWxkIGRvIGEgU3lzdGVtCiAgICAgICAgICAgIC8vIGV4aXQgaGVyZSBhcyB0\naGlzIGlzIGEgZmF0YWwgZXJyb3IuCiAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBuZXcgem9va2VlcGVyIGNsaWVudCB0byB6ayBjbHVzdGVy\nLgogICAgICoKICAgICAqIDxwPgogICAgICogQm9va2llIFNlcnZlciBqdXN0\nIHVzZWQgemsgY2xpZW50IHdoZW4gc3luY2luZyBsZWRnZXJzIGZvciBnYXJi\nYWdlIGNvbGxlY3Rpb24uCiAgICAgKiBTbyB3aGVuIHprIGNsaWVudCBpcyBl\neHBpcmVkLCBpdCBtZWFucyB0aGlzIGJvb2tpZSBzZXJ2ZXIgaXMgbm90IGF2\nYWlsYWJsZSBpbgogICAgICogYm9va2llIHNlcnZlciBsaXN0LiBUaGUgYm9v\na2llIGNsaWVudCB3aWxsIGJlIG5vdGlmaWVkIGZvciBpdHMgZXhwaXJhdGlv\nbi4gTm8KICAgICAqIG1vcmUgYm9va2llIHJlcXVlc3Qgd2lsbCBiZSBzZW50\nIHRvIHRoaXMgc2VydmVyLiBTbyBpdCdzIGJldHRlciB0byBleGl0IHdoZW4g\nemsKICAgICAqIGV4cGlyZWQuCiAgICAgKiA8L3A+CiAgICAgKiA8cD4KICAg\nICAqIFNpbmNlIHRoZXJlIGFyZSBsb3RzIG9mIGJrIG9wZXJhdGlvbnMgY2Fj\naGVkIGluIHF1ZXVlLCBzbyB3ZSB3YWl0IGZvciBhbGwgdGhlIG9wZXJhdGlv\nbnMKICAgICAqIGFyZSBwcm9jZXNzZWQgYW5kIHF1aXQuIEl0IGlzIGRvbmUg\nYnkgY2FsbGluZyA8Yj5zaHV0ZG93bjwvYj4uCiAgICAgKiA8L3A+CiAgICAg\nKgogICAgICogQHBhcmFtIHprU2VydmVycyB0aGUgcXVvcnVtIGxpc3Qgb2Yg\nemsgc2VydmVycwogICAgICogQHBhcmFtIHNlc3Npb25UaW1lb3V0IHNlc3Np\nb24gdGltZW91dCBvZiB6ayBjb25uZWN0aW9uCiAgICAgKgogICAgICogQHJl\ndHVybiB6ayBjbGllbnQgaW5zdGFuY2UKICAgICAqLwogICAgcHJpdmF0ZSBa\nb29LZWVwZXIgbmV3Wm9va2VlcGVyKGZpbmFsIFN0cmluZyB6a1NlcnZlcnMs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgaW50\nIHNlc3Npb25UaW1lb3V0KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIFpvb0tlZXBlciBuZXdaayA9IG5ldyBab29LZWVwZXIoemtTZXJ2ZXJzLCBz\nZXNzaW9uVGltZW91dCwKICAgICAgICBuZXcgV2F0Y2hlcigpIHsKICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHByb2Nl\nc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgICAgICAgICAvLyBo\nYW5kbGUgc2Vzc2lvbiBkaXNjb25uZWN0cyBhbmQgZXhwaXJlcwogICAgICAg\nICAgICAgICAgaWYgKGV2ZW50LmdldFR5cGUoKQogICAgICAgICAgICAgICAg\nLmVxdWFscyhXYXRjaGVyLkV2ZW50LkV2ZW50VHlwZS5Ob25lKSkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChldmVudC5nZXRTdGF0ZSgpLmVxdWFscygK\nICAgICAgICAgICAgICAgICAgICBXYXRjaGVyLkV2ZW50LktlZXBlclN0YXRl\nLkRpc2Nvbm5lY3RlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLndhcm4oIlpLIGNsaWVudCBoYXMgYmVlbiBkaXNjb25uZWN0ZWQgdG8gdGhl\nIFpLIHNlcnZlciEiKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKAogICAgICAgICAgICAgICAgICAg\nIFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIlpLIGNsaWVudCBo\nYXMgYmVlbiByZWNvbm5lY3RlZCB0byB0aGUgWksgc2VydmVyISIpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIC8vIENoZWNrIGZvciBleHBpcmVkIGNvbm5lY3Rpb24uCiAgICAg\nICAgICAgICAgICBpZiAoZXZlbnQuZ2V0U3RhdGUoKS5lcXVhbHMoCiAgICAg\nICAgICAgICAgICBXYXRjaGVyLkV2ZW50LktlZXBlclN0YXRlLkV4cGlyZWQp\nKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJaSyBjbGllbnQg\nY29ubmVjdGlvbiB0byB0aGUgWksgc2VydmVyIGhhcyBleHBpcmVkISIpOwog\nICAgICAgICAgICAgICAgICAgIGlzWmtFeHBpcmVkID0gdHJ1ZTsKICAgICAg\nICAgICAgICAgICAgICBzaHV0ZG93bihFeGl0Q29kZS5aS19FWFBJUkVEKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwog\nICAgICAgIGlzWmtFeHBpcmVkID0gZmFsc2U7CiAgICAgICAgcmV0dXJuIG5l\nd1prOwogICAgfQoKICAgIHB1YmxpYyBib29sZWFuIGlzUnVubmluZygpIHsK\nICAgICAgICByZXR1cm4gcnVubmluZzsKICAgIH0KCiAgICBAT3ZlcnJpZGUK\nICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAvLyBib29raWUgdGhy\nZWFkIHdhaXQgZm9yIGpvdXJuYWwgdGhyZWFkCiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgLy8gc3RhcnQgam91cm5hbAogICAgICAgICAgICBqb3VybmFs\nLnN0YXJ0KCk7CiAgICAgICAgICAgIC8vIHdhaXQgdW50aWwgam91cm5hbCBx\ndWl0cwogICAgICAgICAgICBqb3VybmFsLmpvaW4oKTsKICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkgewogICAgICAgIH0KICAg\nICAgICAvLyBpZiB0aGUgam91cm5hbCB0aHJlYWQgcXVpdHMgZHVlIHRvIHNo\ndXR0aW5nIGRvd24sIGl0IGlzIG9rCiAgICAgICAgaWYgKCFzaHV0dGluZ2Rv\nd24pIHsKICAgICAgICAgICAgLy8gc29tZSBlcnJvciBmb3VuZCBpbiBqb3Vy\nbmFsIHRocmVhZCBhbmQgaXQgcXVpdHMKICAgICAgICAgICAgLy8gZm9sbG93\naW5nIGFkZCBvcGVyYXRpb25zIHRvIGl0IHdvdWxkIGhhbmcgdW5pdCBjbGll\nbnQgdGltZW91dAogICAgICAgICAgICAvLyBzbyB3ZSBzaG91bGQgbGV0IGJv\nb2tpZSBzZXJ2ZXIgZXhpc3RzCiAgICAgICAgICAgIExPRy5lcnJvcigiSm91\ncm5hbCBtYW5hZ2VyIHF1aXRzIHVuZXhwZWN0ZWRseS4iKTsKICAgICAgICAg\nICAgc2h1dGRvd24oRXhpdENvZGUuQk9PS0lFX0VYQ0VQVElPTik7CiAgICAg\nICAgfQogICAgfQoKICAgIC8vIHByb3ZpZGVkIGEgcHVibGljIHNodXRkb3du\nIG1ldGhvZCBmb3Igb3RoZXIgY2FsbGVyCiAgICAvLyB0byBzaHV0IGRvd24g\nYm9va2llIGdyYWNlZnVsbHkKICAgIHB1YmxpYyBpbnQgc2h1dGRvd24oKSB7\nCiAgICAgICAgcmV0dXJuIHNodXRkb3duKEV4aXRDb2RlLk9LKTsKICAgIH0K\nCiAgICAvLyBpbnRlcm5hbCBzaHV0ZG93biBtZXRob2QgdG8gbGV0IHNodXRk\nb3duIGJvb2tpZSBncmFjZWZ1bGx5CiAgICAvLyB3aGVuIGVuY291bnRlcmlu\nZyBleGNlcHRpb24KICAgIHN5bmNocm9uaXplZCBpbnQgc2h1dGRvd24oaW50\nIGV4aXRDb2RlKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaWYgKHJ1\nbm5pbmcpIHsgLy8gYXZvaWQgc2h1dGRvd24gdHdpY2UKICAgICAgICAgICAg\nICAgIC8vIHRoZSBleGl0Q29kZSBvbmx5IHNldCB3aGVuIGZpcnN0IHNodXRk\nb3duIHVzdWFsbHkgZHVlIHRvIGV4Y2VwdGlvbiBmb3VuZAogICAgICAgICAg\nICAgICAgdGhpcy5leGl0Q29kZSA9IGV4aXRDb2RlOwogICAgICAgICAgICAg\nICAgLy8gbWFyayBib29raWUgYXMgaW4gc2h1dHRpbmcgZG93biBwcm9ncmVz\ncwogICAgICAgICAgICAgICAgc2h1dHRpbmdkb3duID0gdHJ1ZTsKCiAgICAg\nICAgICAgICAgICAvLyBTaHV0ZG93biB0aGUgRW50cnlMb2dnZXIgd2hpY2gg\naGFzIHRoZSBHYXJiYWdlQ29sbGVjdG9yIFRocmVhZCBydW5uaW5nCiAgICAg\nICAgICAgICAgICBsZWRnZXJTdG9yYWdlLnNodXRkb3duKCk7CgogICAgICAg\nICAgICAgICAgLy8gU2h1dGRvd24gdGhlIFpLIGNsaWVudAogICAgICAgICAg\nICAgICAgaWYoemsgIT0gbnVsbCkgemsuY2xvc2UoKTsKICAgICAgICAgICAg\nICAgIC8vIFNodXRkb3duIGpvdXJuYWwKICAgICAgICAgICAgICAgIGpvdXJu\nYWwuc2h1dGRvd24oKTsKICAgICAgICAgICAgICAgIHRoaXMuam9pbigpOwog\nICAgICAgICAgICAgICAgc3luY1RocmVhZC5zaHV0ZG93bigpOwoKICAgICAg\nICAgICAgICAgIC8vIGNsb3NlIExlZGdlciBNYW5hZ2VyCiAgICAgICAgICAg\nICAgICBsZWRnZXJNYW5hZ2VyLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAv\nLyBzZXR0aW5nIHJ1bm5pbmcgdG8gZmFsc2UgaGVyZSwgc28gd2F0Y2ggdGhy\nZWFkIGluIGJvb2tpZSBzZXJ2ZXIga25vdyBpdCBvbmx5IGFmdGVyIGJvb2tp\nZSBzaHV0IGRvd24KICAgICAgICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTsK\nICAgICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhj\nZXB0aW9uIGllKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiSW50ZXJydXB0\nZWQgZHVyaW5nIHNodXR0aW5nIGRvd24gYm9va2llIDogIiwgaWUpOwogICAg\nICAgIH0KICAgICAgICByZXR1cm4gdGhpcy5leGl0Q29kZTsKICAgIH0KCiAg\nICAvKiogCiAgICAgKiBSZXRyaWV2ZSB0aGUgbGVkZ2VyIGRlc2NyaXB0b3Ig\nZm9yIHRoZSBsZWRnZXIgd2hpY2ggZW50cnkgc2hvdWxkIGJlIGFkZGVkIHRv\nLgogICAgICogVGhlIExlZGdlckRlc2NyaXB0b3IgcmV0dXJuZWQgZnJvbSB0\naGlzIG1ldGhvZCBzaG91bGQgYmUgZXZlbnR1YWxseSBmcmVlZCB3aXRoIAog\nICAgICogI3B1dEhhbmRsZSgpLgogICAgICoKICAgICAqIEB0aHJvd3MgQm9v\na2llRXhjZXB0aW9uIGlmIG1hc3RlcktleSBkb2VzIG5vdCBtYXRjaCB0aGUg\nbWFzdGVyIGtleSBvZiB0aGUgbGVkZ2VyCiAgICAgKi8KICAgIHByaXZhdGUg\nTGVkZ2VyRGVzY3JpcHRvciBnZXRMZWRnZXJGb3JFbnRyeShCeXRlQnVmZmVy\nIGVudHJ5LCBieXRlW10gbWFzdGVyS2V5KSAKICAgICAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIGxvbmcg\nbGVkZ2VySWQgPSBlbnRyeS5nZXRMb25nKCk7CiAgICAgICAgTGVkZ2VyRGVz\nY3JpcHRvciBsID0gaGFuZGxlcy5nZXRIYW5kbGUobGVkZ2VySWQsIG1hc3Rl\ncktleSk7CiAgICAgICAgaWYgKCFtYXN0ZXJLZXlDYWNoZS5jb250YWluc0tl\neShsZWRnZXJJZCkpIHsKICAgICAgICAgICAgLy8gbmV3IGhhbmRsZSwgd2Ug\nc2hvdWxkIGFkZCB0aGUga2V5IHRvIGpvdXJuYWwgZW5zdXJlIHdlIGNhbiBy\nZWJ1aWxkCiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVy\nLmFsbG9jYXRlKDggKyA4ICsgNCArIG1hc3RlcktleS5sZW5ndGgpOwogICAg\nICAgICAgICBiYi5wdXRMb25nKGxlZGdlcklkKTsKICAgICAgICAgICAgYmIu\ncHV0TG9uZyhNRVRBRU5UUllfSURfTEVER0VSX0tFWSk7CiAgICAgICAgICAg\nIGJiLnB1dEludChtYXN0ZXJLZXkubGVuZ3RoKTsKICAgICAgICAgICAgYmIu\ncHV0KG1hc3RlcktleSk7CiAgICAgICAgICAgIGJiLmZsaXAoKTsKCiAgICAg\nICAgICAgIGpvdXJuYWwubG9nQWRkRW50cnkoYmIsIG5ldyBOb3BXcml0ZUNh\nbGxiYWNrKCksIG51bGwpOwogICAgICAgICAgICBtYXN0ZXJLZXlDYWNoZS5w\ndXQobGVkZ2VySWQsIG1hc3RlcktleSk7CiAgICAgICAgfQogICAgICAgIHJl\ndHVybiBsOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIGFkZEVudHJ5QnlM\nZWRnZXJJZChsb25nIGxlZGdlcklkLCBCeXRlQnVmZmVyIGVudHJ5KQogICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAg\nICAgICBieXRlW10ga2V5ID0gbGVkZ2VyU3RvcmFnZS5yZWFkTWFzdGVyS2V5\nKGxlZGdlcklkKTsKICAgICAgICBMZWRnZXJEZXNjcmlwdG9yIGhhbmRsZSA9\nIGhhbmRsZXMuZ2V0SGFuZGxlKGxlZGdlcklkLCBrZXkpOwogICAgICAgIGhh\nbmRsZS5hZGRFbnRyeShlbnRyeSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBB\nZGQgYW4gZW50cnkgdG8gYSBsZWRnZXIgYXMgc3BlY2lmaWVkIGJ5IGhhbmRs\nZS4gCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBhZGRFbnRyeUludGVybmFs\nKExlZGdlckRlc2NyaXB0b3IgaGFuZGxlLCBCeXRlQnVmZmVyIGVudHJ5LCBX\ncml0ZUNhbGxiYWNrIGNiLCBPYmplY3QgY3R4KQogICAgICAgICAgICB0aHJv\nd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgbG9u\nZyBsZWRnZXJJZCA9IGhhbmRsZS5nZXRMZWRnZXJJZCgpOwogICAgICAgIGVu\ndHJ5LnJld2luZCgpOwogICAgICAgIGxvbmcgZW50cnlJZCA9IGhhbmRsZS5h\nZGRFbnRyeShlbnRyeSk7CgogICAgICAgIGVudHJ5LnJld2luZCgpOwogICAg\nICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBM\nT0cudHJhY2UoIkFkZGluZyAiICsgZW50cnlJZCArICJAIiArIGxlZGdlcklk\nKTsKICAgICAgICB9CiAgICAgICAgam91cm5hbC5sb2dBZGRFbnRyeShlbnRy\neSwgY2IsIGN0eCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBZGQgZW50cnkg\ndG8gYSBsZWRnZXIsIGV2ZW4gaWYgdGhlIGxlZGdlciBoYXMgcHJldmlvdXMg\nYmVlbiBmZW5jZWQuIFRoaXMgc2hvdWxkIG9ubHkKICAgICAqIGhhcHBlbiBp\nbiBib29raWUgcmVjb3Zlcnkgb3IgbGVkZ2VyIHJlY292ZXJ5IGNhc2VzLCB3\naGVyZSBlbnRyaWVzIGFyZSBiZWluZyByZXBsaWNhdGVzIAogICAgICogc28g\ndGhhdCB0aGV5IGV4aXN0IG9uIGEgcXVvcnVtIG9mIGJvb2tpZXMuIFRoZSBj\nb3JyZXNwb25kaW5nIGNsaWVudCBzaWRlIGNhbGwgZm9yIHRoaXMKICAgICAq\nIGlzIG5vdCBleHBvc2VkIHRvIHVzZXJzLgogICAgICovCiAgICBwdWJsaWMg\ndm9pZCByZWNvdmVyeUFkZEVudHJ5KEJ5dGVCdWZmZXIgZW50cnksIFdyaXRl\nQ2FsbGJhY2sgY2IsIE9iamVjdCBjdHgsIGJ5dGVbXSBtYXN0ZXJLZXkpIAog\nICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4Y2VwdGlv\nbiB7CiAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUgPSBnZXRMZWRn\nZXJGb3JFbnRyeShlbnRyeSwgbWFzdGVyS2V5KTsKICAgICAgICBzeW5jaHJv\nbml6ZWQgKGhhbmRsZSkgewogICAgICAgICAgICBhZGRFbnRyeUludGVybmFs\nKGhhbmRsZSwgZW50cnksIGNiLCBjdHgpOwogICAgICAgIH0KICAgIH0KICAg\nIAogICAgLyoqIAogICAgICogQWRkIGVudHJ5IHRvIGEgbGVkZ2VyLgogICAg\nICogQHRocm93cyBCb29raWVFeGNlcHRpb24uTGVkZ2VyRmVuY2VkRXhjZXB0\naW9uIGlmIHRoZSBsZWRnZXIgaXMgZmVuY2VkCiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIGFkZEVudHJ5KEJ5dGVCdWZmZXIgZW50cnksIFdyaXRlQ2FsbGJh\nY2sgY2IsIE9iamVjdCBjdHgsIGJ5dGVbXSBtYXN0ZXJLZXkpCiAgICAgICAg\nICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgQm9va2llRXhjZXB0aW9uIHsKICAg\nICAgICBMZWRnZXJEZXNjcmlwdG9yIGhhbmRsZSA9IGdldExlZGdlckZvckVu\ndHJ5KGVudHJ5LCBtYXN0ZXJLZXkpOwogICAgICAgIHN5bmNocm9uaXplZCAo\naGFuZGxlKSB7CiAgICAgICAgICAgIGlmIChoYW5kbGUuaXNGZW5jZWQoKSkg\newogICAgICAgICAgICAgICAgdGhyb3cgQm9va2llRXhjZXB0aW9uLmNyZWF0\nZShCb29raWVFeGNlcHRpb24uQ29kZS5MZWRnZXJGZW5jZWRFeGNlcHRpb24p\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBhZGRFbnRyeUludGVybmFs\nKGhhbmRsZSwgZW50cnksIGNiLCBjdHgpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIEZlbmNlcyBhIGxlZGdlci4gRnJvbSB0aGlzIHBvaW50\nIG9uLCBjbGllbnRzIHdpbGwgYmUgdW5hYmxlIHRvCiAgICAgKiB3cml0ZSB0\nbyB0aGlzIGxlZGdlci4gT25seSByZWNvdmVyeUFkZEVudHJ5IHdpbGwgYmUK\nICAgICAqIGFibGUgdG8gYWRkIGVudHJpZXMgdG8gdGhlIGxlZGdlci4KICAg\nICAqIFRoaXMgbWV0aG9kIGlzIGlkZW1wb3RlbnQuIE9uY2UgYSBsZWRnZXIg\naXMgZmVuY2VkLCBpdCBjYW4KICAgICAqIG5ldmVyIGJlIHVuZmVuY2VkLiBG\nZW5jaW5nIGEgZmVuY2VkIGxlZGdlciBoYXMgbm8gZWZmZWN0LgogICAgICov\nCiAgICBwdWJsaWMgdm9pZCBmZW5jZUxlZGdlcihsb25nIGxlZGdlcklkLCBi\neXRlW10gbWFzdGVyS2V5KSB0aHJvd3MgSU9FeGNlcHRpb24sIEJvb2tpZUV4\nY2VwdGlvbiB7CiAgICAgICAgTGVkZ2VyRGVzY3JpcHRvciBoYW5kbGUgPSBo\nYW5kbGVzLmdldEhhbmRsZShsZWRnZXJJZCwgbWFzdGVyS2V5KTsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKGhhbmRsZSkgewogICAgICAgICAgICBoYW5kbGUu\nc2V0RmVuY2VkKCk7CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyBCeXRl\nQnVmZmVyIHJlYWRFbnRyeShsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQp\nCiAgICAgICAgICAgIHRocm93cyBJT0V4Y2VwdGlvbiwgTm9MZWRnZXJFeGNl\ncHRpb24gewogICAgICAgIExlZGdlckRlc2NyaXB0b3IgaGFuZGxlID0gaGFu\nZGxlcy5nZXRSZWFkT25seUhhbmRsZShsZWRnZXJJZCk7CiAgICAgICAgaWYg\nKExPRy5pc1RyYWNlRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIExPRy50cmFj\nZSgiUmVhZGluZyAiICsgZW50cnlJZCArICJAIiArIGxlZGdlcklkKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGhhbmRsZS5yZWFkRW50cnkoZW50cnlJ\nZCk7CiAgICB9CgogICAgLy8gVGhlIHJlc3Qgb2YgdGhlIGNvZGUgaXMgdGVz\ndCBzdHVmZgogICAgc3RhdGljIGNsYXNzIENvdW50ZXJDYWxsYmFjayBpbXBs\nZW1lbnRzIFdyaXRlQ2FsbGJhY2sgewogICAgICAgIGludCBjb3VudDsKCiAg\nICAgICAgc3luY2hyb25pemVkIHB1YmxpYyB2b2lkIHdyaXRlQ29tcGxldGUo\naW50IHJjLCBsb25nIGwsIGxvbmcgZSwgSW5ldFNvY2tldEFkZHJlc3MgYWRk\nciwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBjb3VudC0tOwogICAgICAg\nICAgICBpZiAoY291bnQgPT0gMCkgewogICAgICAgICAgICAgICAgbm90aWZ5\nQWxsKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHN5bmNo\ncm9uaXplZCBwdWJsaWMgdm9pZCBpbmNDb3VudCgpIHsKICAgICAgICAgICAg\nY291bnQrKzsKICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCBwdWJs\naWMgdm9pZCB3YWl0WmVybygpIHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiB7CiAgICAgICAgICAgIHdoaWxlIChjb3VudCA+IDApIHsKICAgICAgICAg\nICAgICAgIHdhaXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIEBwYXJhbSBhcmdzCiAgICAgKiBAdGhyb3dzIElP\nRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9u\nCiAgICAgKi8KICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmluZ1td\nIGFyZ3MpIAogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVy\ncnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24sIEtlZXBlckV4Y2Vw\ndGlvbiB7CiAgICAgICAgQm9va2llIGIgPSBuZXcgQm9va2llKG5ldyBTZXJ2\nZXJDb25maWd1cmF0aW9uKCkpOwogICAgICAgIGIuc3RhcnQoKTsKICAgICAg\nICBDb3VudGVyQ2FsbGJhY2sgY2IgPSBuZXcgQ291bnRlckNhbGxiYWNrKCk7\nCiAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTAwMDAwOyBpKysp\nIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBidWZmID0gQnl0ZUJ1ZmZlci5h\nbGxvY2F0ZSgxMDI0KTsKICAgICAgICAgICAgYnVmZi5wdXRMb25nKDEpOwog\nICAgICAgICAgICBidWZmLnB1dExvbmcoaSk7CiAgICAgICAgICAgIGJ1ZmYu\nbGltaXQoMTAyNCk7CiAgICAgICAgICAgIGJ1ZmYucG9zaXRpb24oMCk7CiAg\nICAgICAgICAgIGNiLmluY0NvdW50KCk7CiAgICAgICAgICAgIGIuYWRkRW50\ncnkoYnVmZiwgY2IsIG51bGwsIG5ldyBieXRlWzBdKTsKICAgICAgICB9CiAg\nICAgICAgY2Iud2FpdFplcm8oKTsKICAgICAgICBsb25nIGVuZCA9IFN5c3Rl\nbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAgICAgIFN5c3RlbS5vdXQucHJp\nbnRsbigiVG9vayAiICsgKGVuZC1zdGFydCkgKyAibXMiKTsKICAgIH0KfQo=\n","encoding":"base64"}

