{"sha":"3024ff9706ae9396663fedbc79b428a474870863","node_id":"MDQ6QmxvYjE1NzU5NTY6MzAyNGZmOTcwNmFlOTM5NjY2M2ZlZGJjNzliNDI4YTQ3NDg3MDg2Mw==","size":7294,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3024ff9706ae9396663fedbc79b428a474870863","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCnBhY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZTsKCmlt\ncG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLkZpbGVPdXRwdXRT\ndHJlYW07CmltcG9ydCBqYXZhLmlvLk91dHB1dFN0cmVhbVdyaXRlcjsKaW1w\nb3J0IGphdmEuaW8uQnVmZmVyZWRXcml0ZXI7CmltcG9ydCBqYXZhLmlvLklP\nRXhjZXB0aW9uOwppbXBvcnQgamF2YS51dGlsLlNjYW5uZXI7CgppbXBvcnQg\namF2YS5uZXQuSW5ldEFkZHJlc3M7CmltcG9ydCBqYXZhLm5ldC5Vbmtub3du\nSG9zdEV4Y2VwdGlvbjsKCmltcG9ydCBqYXZhLm5pby5CeXRlQnVmZmVyOwoK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLmRhdGEuU3RhdDsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5ab29EZWZzLklkczsKCmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwoKaW1wb3J0IG9y\nZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9y\neTsKCi8qKgogKiBXaGVuIGEgYm9va2llIHN0YXJ0cyBmb3IgdGhlIGZpcnN0\nIHRpbWUgaXQgZ2VuZXJhdGVzICBhIGNvb2tpZSwgYW5kIHN0b3JlcwogKiB0\naGUgY29va2llIGluIHpvb2tlZXBlciBhcyB3ZWxsIGFzIGluIHRoZSBlYWNo\nIG9mIHRoZSBsb2NhbCBmaWxlc3lzdGVtCiAqIGRpcmVjdG9yaWVzIGl0IHVz\nZXMuIFRoaXMgY29va2llIGlzIHVzZWQgdG8gZW5zdXJlIHRoYXQgZm9yIHRo\nZSBsaWZlIG9mIHRoZQogKiBib29raWUsIGl0cyBjb25maWd1cmF0aW9uIHN0\nYXlzIHRoZSBzYW1lLiBJZiBhbnkgb2YgdGhlIGJvb2tpZSBkaXJlY3Rvcmll\ncwogKiBiZWNvbWVzIHVuYXZhaWxhYmxlLCB0aGUgYm9va2llIGJlY29tZXMg\ndW5hdmFpbGFibGUuIElmIHRoZSBib29raWUgY2hhbmdlcwogKiBwb3J0LCBp\ndCBtdXN0IGFsc28gcmVzZXQgYWxsIG9mIGl0cyBkYXRhLgogKgogKiBUaGlz\nIGlzIGRvbmUgdG8gZW5zdXJlIGRhdGEgaW50ZWdyaXR5LiBXaXRob3V0IHRo\nZSBjb29raWUgYSBib29raWUgY291bGQKICogc3RhcnQgd2l0aCBvbmUgb2Yg\naXRzIGxlZGdlciBkaXJlY3RvcmllcyBtaXNzaW5nLCBzbyBkYXRhIHdvdWxk\nIGJlIG1pc3NpbmcsCiAqIGJ1dCB0aGUgYm9va2llIHdvdWxkIGJlIHVwLCBz\nbyB0aGUgY2xpZW50IHdvdWxkIHRoaW5rIHRoYXQgZXZlcnl0aGluZyBpcyBv\nawogKiB3aXRoIHRoZSBjbHVzdGVyLiBJdCdzIGJldHRlciB0byBmYWlsIGVh\ncmx5IGFuZCBvYnZpb3VzbHkuCiAqLwpjbGFzcyBDb29raWUgewogICAgc3Rh\ndGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihDb29r\naWUuY2xhc3MpOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQgQ1VSUkVOVF9DT09L\nSUVfTEFZT1VUX1ZFUlNJT04gPSAzOwogICAgc3RhdGljIGZpbmFsIFN0cmlu\nZyBDT09LSUVfTk9ERSA9ICJjb29raWVzIjsKICAgIHN0YXRpYyBmaW5hbCBT\ndHJpbmcgVkVSU0lPTl9GSUxFTkFNRSA9ICJWRVJTSU9OIjsKICAgIHByaXZh\ndGUgaW50IGxheW91dFZlcnNpb24gPSAwOwogICAgcHJpdmF0ZSBTdHJpbmcg\nYm9va2llSG9zdCA9IG51bGw7CiAgICBwcml2YXRlIFN0cmluZyBqb3VybmFs\nRGlyID0gbnVsbDsKICAgIHByaXZhdGUgU3RyaW5nIGxlZGdlckRpcnMgPSBu\ndWxsOwogICAgcHJpdmF0ZSBpbnQgem5vZGVWZXJzaW9uID0gLTE7CgogICAg\ncHJpdmF0ZSBDb29raWUoKSB7CiAgICB9CgogICAgcHVibGljIHZvaWQgdmVy\naWZ5KENvb2tpZSBjKQogICAgICAgICAgICB0aHJvd3MgQm9va2llRXhjZXB0\naW9uLkludmFsaWRDb29raWVFeGNlcHRpb24gewogICAgICAgIGlmICghKGMu\nbGF5b3V0VmVyc2lvbiA9PSBsYXlvdXRWZXJzaW9uCiAgICAgICAgICAgICAg\nJiYgYy5sYXlvdXRWZXJzaW9uID49IDMKICAgICAgICAgICAgICAmJiBjLmJv\nb2tpZUhvc3QuZXF1YWxzKGJvb2tpZUhvc3QpCiAgICAgICAgICAgICAgJiYg\nYy5qb3VybmFsRGlyLmVxdWFscyhqb3VybmFsRGlyKQogICAgICAgICAgICAg\nICYmIGMubGVkZ2VyRGlycy5lcXVhbHMobGVkZ2VyRGlycykpKSB7CiAgICAg\nICAgICAgIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uSW52YWxpZENvb2tp\nZUV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgU3Ry\naW5nIHRvU3RyaW5nKCkgewogICAgICAgIFN0cmluZ0J1aWxkZXIgYiA9IG5l\ndyBTdHJpbmdCdWlsZGVyKCk7CiAgICAgICAgYi5hcHBlbmQoQ1VSUkVOVF9D\nT09LSUVfTEFZT1VUX1ZFUlNJT04pLmFwcGVuZCgiXG4iKQogICAgICAgICAg\nICAuYXBwZW5kKGJvb2tpZUhvc3QpLmFwcGVuZCgiXG4iKQogICAgICAgICAg\nICAuYXBwZW5kKGpvdXJuYWxEaXIpLmFwcGVuZCgiXG4iKQogICAgICAgICAg\nICAuYXBwZW5kKGxlZGdlckRpcnMpLmFwcGVuZCgiXG4iKTsKICAgICAgICBy\nZXR1cm4gYi50b1N0cmluZygpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIENvb2tpZSBwYXJzZShTY2FubmVyIHMpIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgQ29va2llIGMgID0gbmV3IENvb2tpZSgpOwogICAgICAgIGlm\nICghcy5oYXNOZXh0SW50KCkpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IElP\nRXhjZXB0aW9uKCJJbnZhbGlkIHN0cmluZywgY2Fubm90IHBhcnNlIGNvb2tp\nZS4iKTsKICAgICAgICB9CiAgICAgICAgYy5sYXlvdXRWZXJzaW9uID0gcy5u\nZXh0SW50KCk7CiAgICAgICAgaWYgKGMubGF5b3V0VmVyc2lvbiA+PSAzKSB7\nCiAgICAgICAgICAgIHMubmV4dExpbmUoKTsKICAgICAgICAgICAgYy5ib29r\naWVIb3N0ID0gcy5uZXh0TGluZSgpOwogICAgICAgICAgICBjLmpvdXJuYWxE\naXIgPSBzLm5leHRMaW5lKCk7CiAgICAgICAgICAgIGMubGVkZ2VyRGlycyA9\nIHMubmV4dExpbmUoKTsKICAgICAgICB9CiAgICAgICAgcy5jbG9zZSgpOwog\nICAgICAgIHJldHVybiBjOwogICAgfQoKICAgIHZvaWQgd3JpdGVUb0RpcmVj\ndG9yeShGaWxlIGRpcmVjdG9yeSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBGaWxlIHZlcnNpb25GaWxlID0gbmV3IEZpbGUoZGlyZWN0b3J5LCBW\nRVJTSU9OX0ZJTEVOQU1FKTsKCiAgICAgICAgRmlsZU91dHB1dFN0cmVhbSBm\nb3MgPSBuZXcgRmlsZU91dHB1dFN0cmVhbSh2ZXJzaW9uRmlsZSk7CiAgICAg\nICAgQnVmZmVyZWRXcml0ZXIgYncgPSBudWxsOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGJ3ID0gbmV3IEJ1ZmZlcmVkV3JpdGVyKG5ldyBPdXRwdXRT\ndHJlYW1Xcml0ZXIoZm9zKSk7CiAgICAgICAgICAgIGJ3LndyaXRlKHRvU3Ry\naW5nKCkpOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIGlmIChi\ndyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBidy5jbG9zZSgpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGZvcy5jbG9zZSgpOwogICAgICAgIH0K\nICAgIH0KCiAgICB2b2lkIHdyaXRlVG9ab29LZWVwZXIoWm9vS2VlcGVyIHpr\nLCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAgICAgIHRocm93\ncyBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBVbmtu\nb3duSG9zdEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIGJvb2tpZUNvb2tp\nZVBhdGggPSBjb25mLmdldFprTGVkZ2Vyc1Jvb3RQYXRoKCkgKyAiLyIgKyBD\nT09LSUVfTk9ERTsKICAgICAgICBTdHJpbmcgemtQYXRoID0gZ2V0WmtQYXRo\nKGNvbmYpOwogICAgICAgIGJ5dGVbXSBkYXRhID0gdG9TdHJpbmcoKS5nZXRC\neXRlcygpOwogICAgICAgIGlmICh6bm9kZVZlcnNpb24gIT0gLTEpIHsKICAg\nICAgICAgICAgemsuc2V0RGF0YSh6a1BhdGgsIGRhdGEsIHpub2RlVmVyc2lv\nbik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHprLmV4aXN0\ncyhib29raWVDb29raWVQYXRoLCBmYWxzZSkgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICB6ay5jcmVhdGUo\nYm9va2llQ29va2llUGF0aCwgbmV3IGJ5dGVbMF0sCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIElkcy5PUEVOX0FDTF9VTlNBRkUsIENyZWF0ZU1v\nZGUuUEVSU0lTVEVOVCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChLZWVw\nZXJFeGNlcHRpb24uTm9kZUV4aXN0c0V4Y2VwdGlvbiBubmUpIHsKICAgICAg\nICAgICAgICAgICAgICBMT0cuaW5mbygiTW9yZSB0aGFuIG9uZSBib29raWUg\ndHJpZWQgdG8gY3JlYXRlIHt9IGF0IG9uY2UuIFNhZmUgdG8gaWdub3JlIiwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib29raWVDb29raWVQYXRo\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAg\nICB6ay5jcmVhdGUoemtQYXRoLCBkYXRhLAogICAgICAgICAgICAgICAgICAg\nICAgSWRzLk9QRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJTSVNURU5U\nKTsKICAgICAgICAgICAgU3RhdCBzdGF0ID0gemsuZXhpc3RzKHprUGF0aCwg\nZmFsc2UpOwogICAgICAgICAgICB0aGlzLnpub2RlVmVyc2lvbiA9IHN0YXQu\nZ2V0VmVyc2lvbigpOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIGRlbGV0\nZUZyb21ab29LZWVwZXIoWm9vS2VlcGVyIHprLCBTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYpCiAgICAgICAgICAgIHRocm93cyBLZWVwZXJFeGNlcHRpb24s\nIEludGVycnVwdGVkRXhjZXB0aW9uLCBVbmtub3duSG9zdEV4Y2VwdGlvbiB7\nCiAgICAgICAgU3RyaW5nIHprUGF0aCA9IGdldFprUGF0aChjb25mKTsKICAg\nICAgICBpZiAoem5vZGVWZXJzaW9uICE9IC0xKSB7CiAgICAgICAgICAgIHpr\nLmRlbGV0ZSh6a1BhdGgsIHpub2RlVmVyc2lvbik7CiAgICAgICAgfQogICAg\nICAgIHpub2RlVmVyc2lvbiA9IC0xOwogICAgfQoKICAgIHN0YXRpYyBDb29r\naWUgZ2VuZXJhdGVDb29raWUoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQog\nICAgICAgICAgICB0aHJvd3MgVW5rbm93bkhvc3RFeGNlcHRpb24gewogICAg\nICAgIENvb2tpZSBjID0gbmV3IENvb2tpZSgpOwogICAgICAgIGMubGF5b3V0\nVmVyc2lvbiA9IENVUlJFTlRfQ09PS0lFX0xBWU9VVF9WRVJTSU9OOwogICAg\nICAgIGMuYm9va2llSG9zdCA9IEluZXRBZGRyZXNzLmdldExvY2FsSG9zdCgp\nLmdldEhvc3RBZGRyZXNzKCkgKyAiOiIgKyBjb25mLmdldEJvb2tpZVBvcnQo\nKTsKICAgICAgICBjLmpvdXJuYWxEaXIgPSBjb25mLmdldEpvdXJuYWxEaXJO\nYW1lKCk7CiAgICAgICAgU3RyaW5nQnVpbGRlciBiID0gbmV3IFN0cmluZ0J1\naWxkZXIoKTsKICAgICAgICBTdHJpbmdbXSBkaXJzID0gY29uZi5nZXRMZWRn\nZXJEaXJOYW1lcygpOwogICAgICAgIGIuYXBwZW5kKGRpcnMubGVuZ3RoKTsK\nICAgICAgICBmb3IgKFN0cmluZyBkIDogZGlycykgewogICAgICAgICAgICBi\nLmFwcGVuZCgiXHQiKS5hcHBlbmQoZCk7CiAgICAgICAgfQogICAgICAgIGMu\nbGVkZ2VyRGlycyA9IGIudG9TdHJpbmcoKTsKICAgICAgICByZXR1cm4gYzsK\nICAgIH0KCiAgICBzdGF0aWMgQ29va2llIHJlYWRGcm9tWm9vS2VlcGVyKFpv\nb0tlZXBlciB6aywgU2VydmVyQ29uZmlndXJhdGlvbiBjb25mKQogICAgICAg\nICAgICB0aHJvd3MgS2VlcGVyRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiwgSU9FeGNlcHRpb24sIFVua25vd25Ib3N0RXhjZXB0aW9uIHsKICAg\nICAgICBTdHJpbmcgemtQYXRoID0gZ2V0WmtQYXRoKGNvbmYpOwoKICAgICAg\nICBTdGF0IHN0YXQgPSB6ay5leGlzdHMoemtQYXRoLCBmYWxzZSk7CiAgICAg\nICAgYnl0ZVtdIGRhdGEgPSB6ay5nZXREYXRhKHprUGF0aCwgZmFsc2UsIHN0\nYXQpOwogICAgICAgIENvb2tpZSBjID0gcGFyc2UobmV3IFNjYW5uZXIobmV3\nIFN0cmluZyhkYXRhKSkpOwogICAgICAgIGMuem5vZGVWZXJzaW9uID0gc3Rh\ndC5nZXRWZXJzaW9uKCk7CiAgICAgICAgcmV0dXJuIGM7CiAgICB9CgogICAg\nc3RhdGljIENvb2tpZSByZWFkRnJvbURpcmVjdG9yeShGaWxlIGRpcmVjdG9y\neSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBGaWxlIHZlcnNpb25G\naWxlID0gbmV3IEZpbGUoZGlyZWN0b3J5LCBWRVJTSU9OX0ZJTEVOQU1FKTsK\nICAgICAgICByZXR1cm4gcGFyc2UobmV3IFNjYW5uZXIodmVyc2lvbkZpbGUp\nKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRpYyBTdHJpbmcgZ2V0WmtQYXRo\nKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZikKICAgICAgICAgICAgdGhyb3dz\nIFVua25vd25Ib3N0RXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmcgYm9va2ll\nQ29va2llUGF0aCA9IGNvbmYuZ2V0WmtMZWRnZXJzUm9vdFBhdGgoKSArICIv\nIiArIENPT0tJRV9OT0RFOwogICAgICAgIHJldHVybiBib29raWVDb29raWVQ\nYXRoICsgIi8iICsgSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9z\ndEFkZHJlc3MoKSArICI6IiArIGNvbmYuZ2V0Qm9va2llUG9ydCgpOwogICAg\nfQp9Cg==\n","encoding":"base64"}

