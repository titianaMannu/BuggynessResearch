{"sha":"ab5405839915076809a1b1d2e04a5371ff81fbbf","node_id":"MDQ6QmxvYjE1NzU5NTY6YWI1NDA1ODM5OTE1MDc2ODA5YTFiMWQyZTA0YTUzNzFmZjgxZmJiZg==","size":7940,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/ab5405839915076809a1b1d2e04a5371ff81fbbf","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEuaW8uUmFuZG9tQWNjZXNzRmlsZTsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5CdWZmZXJVbmRl\ncmZsb3dFeGNlcHRpb247CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5GaWxl\nQ2hhbm5lbDsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3Jn\nLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgovKioKICogVGhpcyBpcyB0aGUgZmls\nZSBoYW5kbGUgZm9yIGEgbGVkZ2VyJ3MgaW5kZXggZmlsZSB0aGF0IG1hcHMg\nZW50cnkgaWRzIHRvIGxvY2F0aW9uLgogKiBJdCBpcyB1c2VkIGJ5IExlZGdl\nckNhY2hlLgogKgogKiA8cD4KICogTGVkZ2VyIGluZGV4IGZpbGUgaXMgbWFk\nZSBvZiBhIGhlYWRlciBhbmQgc2V2ZXJhbCBmaXhlZC1sZW5ndGggaW5kZXgg\ncGFnZXMsIHdoaWNoIHJlY29yZHMgdGhlIG9mZnNldHMgb2YgZGF0YSBzdG9y\nZWQgaW4gZW50cnkgbG9nZ2VycwogKiA8cHJlPiZsdDtoZWFkZXImZ3Q7Jmx0\nO2luZGV4IHBhZ2VzJmd0OzwvcHJlPgogKiA8Yj5IZWFkZXI8L2I+IGlzIGZv\ncm1hdGVkIGFzIGJlbG93OgogKiA8cHJlPiZsdDttYWdpYyBieXRlcyZndDsm\nbHQ7bGVuIG9mIG1hc3RlciBrZXkmZ3Q7Jmx0O21hc3RlciBrZXkmZ3Q7PC9w\ncmU+CiAqIDx1bD4KICogPGxpPm1hZ2ljIGJ5dGVzOiA0IGJ5dGVzLCAnQktM\nRScsIHZlcnNpb246IDQgYnl0ZXMKICogPGxpPmxlbiBvZiBtYXN0ZXIga2V5\nOiBpbmRpY2F0ZXMgbGVuZ3RoIG9mIG1hc3RlciBrZXkuIC0xIG1lYW5zIG5v\nIG1hc3RlciBrZXkgc3RvcmVkIGluIGhlYWRlci4KICogPGxpPm1hc3RlciBr\nZXk6IG1hc3RlciBrZXkKICogPC91bD4KICogPGI+SW5kZXggcGFnZTwvYj4g\naXMgYSBmaXhlZC1sZW5ndGggcGFnZSwgd2hpY2ggY29udGFpbnMgc2VydmVy\nYWwgZW50cmllcyB3aGljaCBwb2ludCB0byB0aGUgb2Zmc2V0cyBvZiBkYXRh\nIHN0b3JlZCBpbiBlbnRyeSBsb2dnZXJzLgogKiA8L3A+CiAqLwpjbGFzcyBG\naWxlSW5mbyB7CiAgICBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3Rv\ncnkuZ2V0TG9nZ2VyKEZpbGVJbmZvLmNsYXNzKTsKCiAgICBzdGF0aWMgZmlu\nYWwgaW50IE5PX01BU1RFUl9LRVkgPSAtMTsKCiAgICBwcml2YXRlIEZpbGVD\naGFubmVsIGZjOwogICAgcHJpdmF0ZSBmaW5hbCBGaWxlIGxmOwogICAgYnl0\nZVtdIG1hc3RlcktleTsKCiAgICAvKioKICAgICAqIFRoZSBmaW5nZXJwcmlu\ndCBvZiBhIGxlZGdlciBpbmRleCBmaWxlCiAgICAgKi8KICAgIHN0YXRpYyBm\naW5hbCBwdWJsaWMgaW50IHNpZ25hdHVyZSA9IEJ5dGVCdWZmZXIud3JhcCgi\nQktMRSIuZ2V0Qnl0ZXMoKSkuZ2V0SW50KCk7CiAgICBzdGF0aWMgZmluYWwg\ncHVibGljIGludCBoZWFkZXJWZXJzaW9uID0gMDsKCiAgICBzdGF0aWMgZmlu\nYWwgbG9uZyBTVEFSVF9PRl9EQVRBID0gMTAyNDsKICAgIHByaXZhdGUgbG9u\nZyBzaXplOwogICAgcHJpdmF0ZSBpbnQgdXNlQ291bnQ7CiAgICBwcml2YXRl\nIGJvb2xlYW4gaXNDbG9zZWQ7CgogICAgcHVibGljIEZpbGVJbmZvKEZpbGUg\nbGYsIGJ5dGVbXSBtYXN0ZXJLZXkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAg\nICAgICAgdGhpcy5sZiA9IGxmOwoKICAgICAgICB0aGlzLm1hc3RlcktleSA9\nIG1hc3RlcktleTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIHZv\naWQgcmVhZEhlYWRlcigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAg\naWYgKGxmLmV4aXN0cygpKSB7CiAgICAgICAgICAgIGlmIChmYyAhPSBudWxs\nKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUobGYsICJydyIp\nLmdldENoYW5uZWwoKTsKICAgICAgICAgICAgc2l6ZSA9IGZjLnNpemUoKTsK\nCiAgICAgICAgICAgIC8vIGF2b2lkIGhhbmcgb24gcmVhZGluZyBwYXJ0aWFs\nIGluZGV4CiAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVy\nLmFsbG9jYXRlKChpbnQpKE1hdGgubWluKHNpemUsIFNUQVJUX09GX0RBVEEp\nKSk7CiAgICAgICAgICAgIHdoaWxlKGJiLmhhc1JlbWFpbmluZygpKSB7CiAg\nICAgICAgICAgICAgICBmYy5yZWFkKGJiKTsKICAgICAgICAgICAgfQogICAg\nICAgICAgICBiYi5mbGlwKCk7CiAgICAgICAgICAgIGlmIChiYi5nZXRJbnQo\nKSAhPSBzaWduYXR1cmUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbigiTWlzc2luZyBsZWRnZXIgc2lnbmF0dXJlIik7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgaW50IHZlcnNpb24gPSBiYi5nZXRJbnQo\nKTsKICAgICAgICAgICAgaWYgKHZlcnNpb24gIT0gaGVhZGVyVmVyc2lvbikg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJJbmNv\nbXBhdGlibGUgbGVkZ2VyIHZlcnNpb24gIiArIHZlcnNpb24pOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGludCBsZW5ndGggPSBiYi5nZXRJbnQoKTsK\nICAgICAgICAgICAgaWYgKGxlbmd0aCA8IDApIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiTGVuZ3RoICIgKyBsZW5ndGggKyAi\nIGlzIGludmFsaWQiKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChsZW5ndGgg\nPiBiYi5yZW1haW5pbmcoKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3\nIEJ1ZmZlclVuZGVyZmxvd0V4Y2VwdGlvbigpOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIG1hc3RlcktleSA9IG5ldyBieXRlW2xlbmd0aF07CiAgICAg\nICAgICAgIGJiLmdldChtYXN0ZXJLZXkpOwogICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiTGVkZ2VyIGluZGV4\nIGZpbGUgZG9lcyBub3QgZXhpc3QiKTsKICAgICAgICB9CiAgICB9CgogICAg\nc3luY2hyb25pemVkIHByaXZhdGUgdm9pZCBjaGVja09wZW4oYm9vbGVhbiBj\ncmVhdGUpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGZjICE9\nIG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAg\nICBib29sZWFuIGV4aXN0cyA9IGxmLmV4aXN0cygpOwogICAgICAgIGlmICht\nYXN0ZXJLZXkgPT0gbnVsbCAmJiAhZXhpc3RzKSB7CiAgICAgICAgICAgIHRo\ncm93IG5ldyBJT0V4Y2VwdGlvbihsZiArICIgbm90IGZvdW5kIik7CiAgICAg\nICAgfQoKICAgICAgICBpZiAoIWV4aXN0cykgeyAKICAgICAgICAgICAgaWYg\nKGNyZWF0ZSkgewogICAgICAgICAgICAgICAgLy8gZGVsYXllZCB0aGUgY3Jl\nYXRpb24gb2YgcGFyZW50cyBkaXJlY3RvcmllcwogICAgICAgICAgICAgICAg\nY2hlY2tQYXJlbnRzKGxmKTsKICAgICAgICAgICAgICAgIGZjID0gbmV3IFJh\nbmRvbUFjY2Vzc0ZpbGUobGYsICJydyIpLmdldENoYW5uZWwoKTsKICAgICAg\nICAgICAgICAgIHNpemUgPSBmYy5zaXplKCk7CiAgICAgICAgICAgICAgICBp\nZiAoc2l6ZSA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgd3JpdGVIZWFk\nZXIoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBy\nZWFkSGVhZGVyKCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJ1ZmZlclVuZGVy\nZmxvd0V4Y2VwdGlvbiBidWYpIHsKICAgICAgICAgICAgICAgIExPRy53YXJu\nKCJFeGNlcHRpb24gd2hlbiByZWFkaW5nIGhlYWRlciBvZiB7fSA6IHt9Iiwg\nbGYsIGJ1Zik7CiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBtYXN0ZXJL\nZXkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cud2FybigiQXR0ZW1wdGlu\nZyB0byB3cml0ZSBoZWFkZXIgb2Yge30gYWdhaW4uIiwgbGYpOwogICAgICAg\nICAgICAgICAgICAgIHdyaXRlSGVhZGVyKCk7CiAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbigiRXJyb3IgcmVhZGluZyBoZWFkZXIgIiArIGxmKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgd3JpdGVIZWFkZXIoKSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9jYXRl\nKChpbnQpU1RBUlRfT0ZfREFUQSk7CiAgICAgICAgYmIucHV0SW50KHNpZ25h\ndHVyZSk7CiAgICAgICAgYmIucHV0SW50KGhlYWRlclZlcnNpb24pOwogICAg\nICAgIGJiLnB1dEludChtYXN0ZXJLZXkubGVuZ3RoKTsKICAgICAgICBiYi5w\ndXQobWFzdGVyS2V5KTsKICAgICAgICBiYi5yZXdpbmQoKTsKICAgICAgICBm\nYy5wb3NpdGlvbigwKTsKICAgICAgICBmYy53cml0ZShiYik7CiAgICB9Cgog\nICAgc3luY2hyb25pemVkIHB1YmxpYyBsb25nIHNpemUoKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGNoZWNrT3BlbihmYWxzZSk7CiAgICAgICAg\nbG9uZyByYyA9IHNpemUtU1RBUlRfT0ZfREFUQTsKICAgICAgICBpZiAocmMg\nPCAwKSB7CiAgICAgICAgICAgIHJjID0gMDsKICAgICAgICB9CiAgICAgICAg\ncmV0dXJuIHJjOwogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJsaWMgaW50\nIHJlYWQoQnl0ZUJ1ZmZlciBiYiwgbG9uZyBwb3NpdGlvbikgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICByZXR1cm4gcmVhZEFic29sdXRlKGJiLCBw\nb3NpdGlvbiArIFNUQVJUX09GX0RBVEEpOwogICAgfQoKICAgIHByaXZhdGUg\naW50IHJlYWRBYnNvbHV0ZShCeXRlQnVmZmVyIGJiLCBsb25nIHN0YXJ0KSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGNoZWNrT3BlbihmYWxzZSk7\nCiAgICAgICAgaW50IHRvdGFsID0gMDsKICAgICAgICB3aGlsZShiYi5yZW1h\naW5pbmcoKSA+IDApIHsKICAgICAgICAgICAgaW50IHJjID0gZmMucmVhZChi\nYiwgc3RhcnQpOwogICAgICAgICAgICBpZiAocmMgPD0gMCkgewogICAgICAg\nICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJTaG9ydCByZWFkIik7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdG90YWwgKz0gcmM7CiAgICAg\nICAgICAgIC8vIHNob3VsZCBtb3ZlIHJlYWQgcG9zaXRpb24KICAgICAgICAg\nICAgc3RhcnQgKz0gcmM7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0b3Rh\nbDsKICAgIH0KCiAgICAvKioKICAgICAqIENsb3NlIGEgZmlsZSBpbmZvCiAg\nICAgKgogICAgICogQHBhcmFtIGZvcmNlCiAgICAgKiAgICAgICAgICBpZiBz\nZXQgdG8gdHJ1ZSwgdGhlIGluZGV4IGlzIGZvcmNlZCB0byBjcmVhdGUgYmVm\nb3JlIGNsb3NlZCwKICAgICAqICAgICAgICAgIGlmIHNldCB0byBmYWxzZSwg\ndGhlIGluZGV4IGlzIG5vdCBmb3JjZWQgdG8gY3JlYXRlLgogICAgICovCiAg\nICBzeW5jaHJvbml6ZWQgcHVibGljIHZvaWQgY2xvc2UoYm9vbGVhbiBmb3Jj\nZSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpc0Nsb3NlZCA9IHRy\ndWU7CiAgICAgICAgY2hlY2tPcGVuKGZvcmNlKTsKICAgICAgICBpZiAodXNl\nQ291bnQgPT0gMCAmJiBmYyAhPSBudWxsKSB7CiAgICAgICAgICAgIGZjLmNs\nb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIHN5bmNocm9uaXplZCBwdWJs\naWMgbG9uZyB3cml0ZShCeXRlQnVmZmVyW10gYnVmZnMsIGxvbmcgcG9zaXRp\nb24pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgY2hlY2tPcGVuKHRy\ndWUpOwogICAgICAgIGxvbmcgdG90YWwgPSAwOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGZjLnBvc2l0aW9uKHBvc2l0aW9uK1NUQVJUX09GX0RBVEEp\nOwogICAgICAgICAgICB3aGlsZShidWZmc1tidWZmcy5sZW5ndGgtMV0ucmVt\nYWluaW5nKCkgPiAwKSB7CiAgICAgICAgICAgICAgICBsb25nIHJjID0gZmMu\nd3JpdGUoYnVmZnMpOwogICAgICAgICAgICAgICAgaWYgKHJjIDw9IDApIHsK\nICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlNo\nb3J0IHdyaXRlIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB0b3RhbCArPSByYzsKICAgICAgICAgICAgfQogICAgICAgIH0gZmluYWxs\neSB7CiAgICAgICAgICAgIGZjLmZvcmNlKHRydWUpOwogICAgICAgICAgICBs\nb25nIG5ld3NpemUgPSBwb3NpdGlvbitTVEFSVF9PRl9EQVRBK3RvdGFsOwog\nICAgICAgICAgICBpZiAobmV3c2l6ZSA+IHNpemUpIHsKICAgICAgICAgICAg\nICAgIHNpemUgPSBuZXdzaXplOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIHJldHVybiB0b3RhbDsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQg\ncHVibGljIGJ5dGVbXSBnZXRNYXN0ZXJLZXkoKSB0aHJvd3MgSU9FeGNlcHRp\nb24gewogICAgICAgIGNoZWNrT3BlbihmYWxzZSk7CiAgICAgICAgcmV0dXJu\nIG1hc3RlcktleTsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHVibGljIHZv\naWQgdXNlKCkgewogICAgICAgIHVzZUNvdW50Kys7CiAgICB9CgogICAgc3lu\nY2hyb25pemVkIHB1YmxpYyB2b2lkIHJlbGVhc2UoKSB7CiAgICAgICAgdXNl\nQ291bnQtLTsKICAgICAgICBpZiAoaXNDbG9zZWQgJiYgdXNlQ291bnQgPT0g\nMCAmJiBmYyAhPSBudWxsKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICBmYy5jbG9zZSgpOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9y\nIGNsb3NpbmcgZmlsZSBjaGFubmVsIiwgZSk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICB9CgogICAgcHVibGljIGJvb2xlYW4gZGVsZXRlKCkgewog\nICAgICAgIHJldHVybiBsZi5kZWxldGUoKTsKICAgIH0KCiAgICBzdGF0aWMg\nZmluYWwgcHJpdmF0ZSB2b2lkIGNoZWNrUGFyZW50cyhGaWxlIGYpIHRocm93\ncyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBwYXJlbnQgPSBmLmdldFBh\ncmVudEZpbGUoKTsKICAgICAgICBpZiAocGFyZW50LmV4aXN0cygpKSB7CiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaWYgKHBhcmVu\ndC5ta2RpcnMoKSA9PSBmYWxzZSkgewogICAgICAgICAgICB0aHJvdyBuZXcg\nSU9FeGNlcHRpb24oIkNvdW5sZG4ndCBta2RpcnMgZm9yICIgKyBwYXJlbnQp\nOwogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

