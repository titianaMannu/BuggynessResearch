{"sha":"7ca3104a136ea0cb46109d3a20f116129555befc","node_id":"MDQ6QmxvYjE1NzU5NTY6N2NhMzEwNGExMzZlYTBjYjQ2MTA5ZDNhMjBmMTE2MTI5NTU1YmVmYw==","size":15074,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/7ca3104a136ea0cb46109d3a20f116129555befc","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnV0aWwuSGFyZExpbms7Cgpp\nbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmlvLkZpbGVVdGlsczsKaW1wb3J0\nIG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuQmFzaWNQYXJzZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLmNvbW1vbnMuY2xpLk9wdGlvbnM7CmltcG9ydCBvcmcuYXBh\nY2hlLmNvbW1vbnMuY2xpLkNvbW1hbmRMaW5lOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmNsaS5IZWxwRm9ybWF0dGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5jb21tb25zLmNsaS5QYXJzZUV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuc2xm\nNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5GaWxlbmFtZUZp\nbHRlcjsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CgppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5UaW1lVW5pdDsKCmltcG9ydCBqYXZhLnV0aWwu\nTWFwOwppbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuU2Nhbm5lcjsKaW1wb3J0IGphdmEudXRpbC5Ob1N1Y2hFbGVt\nZW50RXhjZXB0aW9uOwoKaW1wb3J0IGphdmEubmV0Lk1hbGZvcm1lZFVSTEV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNl\ncnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1vbnMu\nY29uZmlndXJhdGlvbi5Db25maWd1cmF0aW9uRXhjZXB0aW9uOwoKaW1wb3J0\nIG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpv\nb2tlZXBlci5XYXRjaGVkRXZlbnQ7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tl\nZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuY29uY3Vy\ncmVudC5hdG9taWMuQXRvbWljQm9vbGVhbjsKCi8qKgogKiBBcHBsaWNhdGlv\nbiBmb3IgdXBncmFkaW5nIHRoZSBib29ra2VlcGVyIGZpbGVzeXN0ZW0KICog\nYmV0d2VlbiB2ZXJzaW9ucwogKi8KcHVibGljIGNsYXNzIEZpbGVTeXN0ZW1V\ncGdyYWRlIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9y\neS5nZXRMb2dnZXIoRmlsZVN5c3RlbVVwZ3JhZGUuY2xhc3MpOwoKICAgIHN0\nYXRpYyBGaWxlbmFtZUZpbHRlciBCT09LSUVfRklMRVNfRklMVEVSID0gbmV3\nIEZpbGVuYW1lRmlsdGVyKCkgewogICAgICAgICAgICBwcml2YXRlIGJvb2xl\nYW4gY29udGFpbnNJbmRleEZpbGVzKEZpbGUgZGlyLCBTdHJpbmcgbmFtZSkg\newogICAgICAgICAgICAgICAgaWYgKG5hbWUuZW5kc1dpdGgoIi5pZHgiKSkg\newogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgTG9uZy5wYXJzZUxvbmcobmFtZSwgMTYpOwogICAgICAgICAgICAg\nICAgICAgIEZpbGUgZCA9IG5ldyBGaWxlKGRpciwgbmFtZSk7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKGQuaXNEaXJlY3RvcnkoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBTdHJpbmdbXSBmaWxlcyA9IGQubGlzdCgpOwogICAg\nICAgICAgICAgICAgICAgICAgICBmb3IgKFN0cmluZyBmIDogZmlsZXMpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb250YWluc0luZGV4\nRmlsZXMoZCwgZikpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE51bWJlckZvcm1hdEV4Y2Vw\ndGlvbiBuZmUpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHB1YmxpYyBib29sZWFu\nIGFjY2VwdChGaWxlIGRpciwgU3RyaW5nIG5hbWUpIHsKICAgICAgICAgICAg\nICAgIGlmIChuYW1lLmVuZHNXaXRoKCIudHhuIikgfHwgbmFtZS5lbmRzV2l0\naCgiLmxvZyIpCiAgICAgICAgICAgICAgICAgICAgfHwgbmFtZS5lcXVhbHMo\nImxhc3RJZCIpIHx8IG5hbWUuZXF1YWxzKCJsYXN0TWFyayIpKSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICBpZiAoY29udGFpbnNJbmRleEZpbGVzKGRpciwg\nbmFtZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgfQogICAgICAgIH07CgogICAgcHJpdmF0ZSBzdGF0aWMg\nTGlzdDxGaWxlPiBnZXRBbGxEaXJlY3RvcmllcyhTZXJ2ZXJDb25maWd1cmF0\naW9uIGNvbmYpIHsKICAgICAgICBMaXN0PEZpbGU+IGRpcnMgPSBuZXcgQXJy\nYXlMaXN0PEZpbGU+KCk7CiAgICAgICAgZGlycy5hZGQoY29uZi5nZXRKb3Vy\nbmFsRGlyKCkpOwogICAgICAgIGZvciAoRmlsZSBkOiBjb25mLmdldExlZGdl\nckRpcnMoKSkgewogICAgICAgICAgICBkaXJzLmFkZChkKTsKICAgICAgICB9\nCiAgICAgICAgcmV0dXJuIGRpcnM7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0\naWMgaW50IGRldGVjdFByZXZpb3VzVmVyc2lvbihGaWxlIGRpcmVjdG9yeSkg\ndGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBTdHJpbmdbXSBmaWxlcyA9\nIGRpcmVjdG9yeS5saXN0KEJPT0tJRV9GSUxFU19GSUxURVIpOwogICAgICAg\nIEZpbGUgdjJ2ZXJzaW9uRmlsZSA9IG5ldyBGaWxlKGRpcmVjdG9yeSwgQ29v\na2llLlZFUlNJT05fRklMRU5BTUUpOwogICAgICAgIGlmIChmaWxlcy5sZW5n\ndGggPT0gMCAmJiAhdjJ2ZXJzaW9uRmlsZS5leGlzdHMoKSkgeyAvLyBubyBv\nbGQgZGF0YSwgc28gd2UncmUgb2sKICAgICAgICAgICAgcmV0dXJuIENvb2tp\nZS5DVVJSRU5UX0NPT0tJRV9MQVlPVVRfVkVSU0lPTjsKICAgICAgICB9Cgog\nICAgICAgIGlmICghdjJ2ZXJzaW9uRmlsZS5leGlzdHMoKSkgewogICAgICAg\nICAgICByZXR1cm4gMTsKICAgICAgICB9CiAgICAgICAgU2Nhbm5lciBzID0g\nbmV3IFNjYW5uZXIodjJ2ZXJzaW9uRmlsZSk7CiAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgcmV0dXJuIHMubmV4dEludCgpOwogICAgICAgIH0gY2F0Y2gg\nKE5vU3VjaEVsZW1lbnRFeGNlcHRpb24gbnNlKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiQ291bGRuJ3QgcGFyc2UgdmVyc2lvbiBmaWxlICIgKyB2MnZl\ncnNpb25GaWxlICwgbnNlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhj\nZXB0aW9uKCJDb3VsZG4ndCBwYXJzZSB2ZXJzaW9uIGZpbGUiLCBuc2UpOwog\nICAgICAgIH0gY2F0Y2ggKElsbGVnYWxTdGF0ZUV4Y2VwdGlvbiBpc2UpIHsK\nICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciByZWFkaW5nIGZpbGUgIiAr\nIHYydmVyc2lvbkZpbGUsIGlzZSk7CiAgICAgICAgICAgIHRocm93IG5ldyBJ\nT0V4Y2VwdGlvbigiRXJyb3IgcmVhZGluZyB2ZXJzaW9uIGZpbGUiLCBpc2Up\nOwogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHMuY2xvc2UoKTsK\nICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgWm9vS2VlcGVy\nIG5ld1pvb2tlZXBlcihmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYp\nCiAgICAgICAgICAgIHRocm93cyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4\nY2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgZmluYWwgQ291\nbnREb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAg\nICAgICAgICAgIFpvb0tlZXBlciB6ayA9IG5ldyBab29LZWVwZXIoY29uZi5n\nZXRaa1NlcnZlcnMoKSwgY29uZi5nZXRaa1RpbWVvdXQoKSwKICAgICAgICAg\nICAgICAgICAgICBuZXcgV2F0Y2hlcigpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAvLyBoYW5kbGUgc2Vzc2lvbiBkaXNjb25u\nZWN0cyBhbmQgZXhwaXJlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\naWYgKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2Vl\ncGVyU3RhdGUuU3luY0Nvbm5lY3RlZCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoIWxhdGNo\nLmF3YWl0KGNvbmYuZ2V0WmtUaW1lb3V0KCkqMiwgVGltZVVuaXQuTUlMTElT\nRUNPTkRTKSkgewogICAgICAgICAgICAgICAgemsuY2xvc2UoKTsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4\nY2VwdGlvbigiQ291bGRuJ3QgY29ubmVjdCB0byB6b29rZWVwZXIiKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gems7CiAgICAgICAgfSBj\nYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAg\ndGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGll\nKTsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpb2UpIHsKICAgICAg\nICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0\naW9uKGlvZSk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgc3RhdGlj\nIHZvaWQgbGlua0luZGV4RGlyZWN0b3JpZXMoRmlsZSBzcmNQYXRoLCBGaWxl\nIHRhcmdldFBhdGgpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgU3Ry\naW5nW10gZmlsZXMgPSBzcmNQYXRoLmxpc3QoKTsKCiAgICAgICAgZm9yIChT\ndHJpbmcgZiA6IGZpbGVzKSB7CiAgICAgICAgICAgIGlmIChmLmVuZHNXaXRo\nKCIuaWR4IikpIHsgLy8gdGhpcyBpcyBhbiBpbmRleCBkaXIsIGNyZWF0ZSB0\naGUgbGlua3MKICAgICAgICAgICAgICAgIGlmICghdGFyZ2V0UGF0aC5ta2Rp\ncnMoKSkgewogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2Vw\ndGlvbigiQ291bGQgbm90IGNyZWF0ZSB0YXJnZXQgcGF0aCBbIit0YXJnZXRQ\nYXRoKyJdIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBI\nYXJkTGluay5jcmVhdGVIYXJkTGlua011bHQoc3JjUGF0aCwgZmlsZXMsIHRh\ncmdldFBhdGgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIEZpbGUgbmV3U3JjUGF0aCA9IG5ldyBGaWxlKHNy\nY1BhdGgsIGYpOwogICAgICAgICAgICBpZiAobmV3U3JjUGF0aC5pc0RpcmVj\ndG9yeSgpKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgIExvbmcucGFyc2VMb25nKGYsIDE2KTsKICAgICAgICAgICAgICAg\nICAgICBsaW5rSW5kZXhEaXJlY3RvcmllcyhuZXdTcmNQYXRoLCBuZXcgRmls\nZSh0YXJnZXRQYXRoLCBmKSk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChO\ndW1iZXJGb3JtYXRFeGNlcHRpb24gbmZlKSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gZmlsZW5hbWUgZG9lcyBub3QgcGFyc2UgdG8gYSBoZXggTG9uZywg\nc28KICAgICAgICAgICAgICAgICAgICAvLyBpdCB3aWxsIG5vdCBjb250YWlu\nIGlkeCBmaWxlcy4gSWdub3JpbmcKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIHZv\naWQgdXBncmFkZShTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAg\nICAgIHRocm93cyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbiwg\nSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgIExPRy5pbmZvKCJVcGdy\nYWRpbmcuLi4iKTsKCiAgICAgICAgWm9vS2VlcGVyIHprID0gbmV3Wm9va2Vl\ncGVyKGNvbmYpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIE1hcDxGaWxl\nLEZpbGU+IGRlZmVycmVkTW92ZXMgPSBuZXcgSGFzaE1hcDxGaWxlLCBGaWxl\nPigpOwogICAgICAgICAgICBDb29raWUgYyA9IENvb2tpZS5nZW5lcmF0ZUNv\nb2tpZShjb25mKTsKICAgICAgICAgICAgZm9yIChGaWxlIGQgOiBnZXRBbGxE\naXJlY3Rvcmllcyhjb25mKSkgewogICAgICAgICAgICAgICAgTE9HLmluZm8o\nIlVwZ3JhZGluZyB7fSIsIGQpOwogICAgICAgICAgICAgICAgaW50IHZlcnNp\nb24gPSBkZXRlY3RQcmV2aW91c1ZlcnNpb24oZCk7CiAgICAgICAgICAgICAg\nICBpZiAodmVyc2lvbiA9PSBDb29raWUuQ1VSUkVOVF9DT09LSUVfTEFZT1VU\nX1ZFUlNJT04pIHsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiRGly\nZWN0b3J5IGlzIGN1cnJlbnQsIG5vIG5lZWQgdG8gdXBncmFkZSIpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgICAgICBGaWxlIGN1ckRpciA9IG5ldyBGaWxlKGQsIEJvb2tpZS5D\nVVJSRU5UX0RJUik7CiAgICAgICAgICAgICAgICAgICAgRmlsZSB0bXBEaXIg\nPSBuZXcgRmlsZShkLCAidXBncmFkZVRtcC4iICsgU3lzdGVtLm5hbm9UaW1l\nKCkpOwogICAgICAgICAgICAgICAgICAgIGRlZmVycmVkTW92ZXMucHV0KGN1\nckRpciwgdG1wRGlyKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIXRtcERp\nci5ta2RpcnMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24oIkNvdWxkIG5v\ndCBjcmVhdGUgdGVtcG9yYXJ5IGRpcmVjdG9yeSAiICsgdG1wRGlyKTsKICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgYy53cml0\nZVRvRGlyZWN0b3J5KHRtcERpcik7CgogICAgICAgICAgICAgICAgICAgIFN0\ncmluZ1tdIGZpbGVzID0gZC5saXN0KG5ldyBGaWxlbmFtZUZpbHRlcigpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyBib29sZWFuIGFj\nY2VwdChGaWxlIGRpciwgU3RyaW5nIG5hbWUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXR1cm4gQk9PS0lFX0ZJTEVTX0ZJTFRFUi5h\nY2NlcHQoZGlyLCBuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAmJiAhKG5ldyBGaWxlKGRpciwgbmFtZSkuaXNEaXJlY3Rvcnko\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIEhhcmRMaW5r\nLmNyZWF0ZUhhcmRMaW5rTXVsdChkLCBmaWxlcywgdG1wRGlyKTsKCiAgICAg\nICAgICAgICAgICAgICAgbGlua0luZGV4RGlyZWN0b3JpZXMoZCwgdG1wRGly\nKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkg\newogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgdXBncmFk\naW5nIHt9IiwgZCk7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJv\nb2tpZUV4Y2VwdGlvbi5VcGdyYWRlRXhjZXB0aW9uKGlvZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoTWFw\nLkVudHJ5PEZpbGUsRmlsZT4gZSA6IGRlZmVycmVkTW92ZXMuZW50cnlTZXQo\nKSkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICBGaWxlVXRpbHMubW92ZURpcmVjdG9yeShlLmdldFZhbHVlKCksIGUuZ2V0\nS2V5KCkpOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g\naW9lKSB7CiAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGVyciA9IFN0cmlu\nZy5mb3JtYXQoIkVycm9yIG1vdmluZyB1cGdyYWRlZCBkaXJlY3RvcmllcyBp\nbnRvIHBsYWNlICVzIC0+ICVzICIsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZS5nZXRWYWx1ZSgpLCBlLmdldEtl\neSgpKTsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoZXJyLCBpb2Up\nOwogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBCb29raWVFeGNlcHRp\nb24uVXBncmFkZUV4Y2VwdGlvbihpb2UpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBjLndyaXRlVG9ab29LZWVwZXIoemssIGNvbmYpOwogICAgICAgICAgICB9\nIGNhdGNoIChLZWVwZXJFeGNlcHRpb24ga2UpIHsKICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiRXJyb3Igd3JpdGluZyBjb29raWUgdG8gem9va2VlcGVy\nIik7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9u\nLlVwZ3JhZGVFeGNlcHRpb24oa2UpOwogICAgICAgICAgICB9CiAgICAgICAg\nfSBjYXRjaCAoSU9FeGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgIHRocm93\nIG5ldyBCb29raWVFeGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbihpb2UpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIHprLmNsb3NlKCk7CiAg\nICAgICAgfQogICAgICAgIExPRy5pbmZvKCJEb25lIik7CiAgICB9CgogICAg\ncHVibGljIHN0YXRpYyB2b2lkIGZpbmFsaXplVXBncmFkZShTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYpCiAgICAgICAgICAgIHRocm93cyBCb29raWVFeGNl\ncHRpb24uVXBncmFkZUV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24g\newogICAgICAgIExPRy5pbmZvKCJGaW5hbGl6aW5nIHVwZ3JhZGUuLi4iKTsK\nICAgICAgICAvLyB2ZXJpZnkgdGhhdCB1cGdyYWRlIGlzIGNvcnJlY3QKICAg\nICAgICBmb3IgKEZpbGUgZCA6IGdldEFsbERpcmVjdG9yaWVzKGNvbmYpKSB7\nCiAgICAgICAgICAgIExPRy5pbmZvKCJGaW5hbGl6aW5nIHt9IiwgZCk7CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpbnQgdmVyc2lvbiA9\nIGRldGVjdFByZXZpb3VzVmVyc2lvbihkKTsKICAgICAgICAgICAgICAgIGlm\nICh2ZXJzaW9uIDwgMykgewogICAgICAgICAgICAgICAgICAgIGlmICh2ZXJz\naW9uID09IDIpIHsKICAgICAgICAgICAgICAgICAgICAgICAgRmlsZSB2MnZl\ncnNpb25GaWxlID0gbmV3IEZpbGUoZCwgQ29va2llLlZFUlNJT05fRklMRU5B\nTUUpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXYydmVyc2lvbkZp\nbGUuZGVsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy53YXJuKCJDb3VsZCBub3QgZGVsZXRlIG9sZCB2ZXJzaW9uIGZpbGUge30i\nLCB2MnZlcnNpb25GaWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBGaWxl\nW10gZmlsZXMgPSBkLmxpc3RGaWxlcyhCT09LSUVfRklMRVNfRklMVEVSKTsK\nICAgICAgICAgICAgICAgICAgICBmb3IgKEZpbGUgZiA6IGZpbGVzKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChmLmlzRGlyZWN0b3J5KCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZpbGVVdGlscy5kZWxldGVE\naXJlY3RvcnkoZik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZXsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZi5kZWxldGUoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy53YXJuKCJD\nb3VsZCBub3QgZGVsZXRlIHt9IiwgZik7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0g\nY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewogICAgICAgICAgICAgICAgTE9H\nLmVycm9yKCJFcnJvciBmaW5hbGl6aW5nIHt9IiwgZCk7CiAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRp\nb24oaW9lKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBu\nb29wIGF0IHRoZSBtb21lbnQKICAgICAgICBMT0cuaW5mbygiRG9uZSIpOwog\nICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCByb2xsYmFjayhTZXJ2ZXJD\nb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAgICAgIHRocm93cyBCb29raWVF\neGNlcHRpb24uVXBncmFkZUV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRp\nb24gewogICAgICAgIExPRy5pbmZvKCJSb2xsaW5nIGJhY2sgdXBncmFkZS4u\nLiIpOwogICAgICAgIFpvb0tlZXBlciB6ayA9IG5ld1pvb2tlZXBlcihjb25m\nKTsKICAgICAgICB0cnkgewogICAgICAgICAgICBmb3IgKEZpbGUgZCA6IGdl\ndEFsbERpcmVjdG9yaWVzKGNvbmYpKSB7CiAgICAgICAgICAgICAgICBMT0cu\naW5mbygiUm9sbGluZyBiYWNrIHt9IiwgZCk7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIC8vIGVuc3VyZSB0aGVyZSBpcyBh\nIHByZXZpb3VzIHZlcnNpb24gYmVmb3JlIHJvbGxiYWNrCiAgICAgICAgICAg\nICAgICAgICAgaW50IHZlcnNpb24gPSBkZXRlY3RQcmV2aW91c1ZlcnNpb24o\nZCk7CgogICAgICAgICAgICAgICAgICAgIGlmICh2ZXJzaW9uIDw9IENvb2tp\nZS5DVVJSRU5UX0NPT0tJRV9MQVlPVVRfVkVSU0lPTikgewogICAgICAgICAg\nICAgICAgICAgICAgICBGaWxlIGN1ckRpciA9IG5ldyBGaWxlKGQsIEJvb2tp\nZS5DVVJSRU5UX0RJUik7CiAgICAgICAgICAgICAgICAgICAgICAgIEZpbGVV\ndGlscy5kZWxldGVEaXJlY3RvcnkoY3VyRGlyKTsKICAgICAgICAgICAgICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24oCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIkNhbm5vdCByb2xsYmFjayBhcyBw\ncmV2aW91cyBkYXRhIGRvZXMgbm90IGV4aXN0Iik7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g\naW9lKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciBy\nb2xsaW5nIGJhY2sge30iLCBkKTsKICAgICAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgQm9va2llRXhjZXB0aW9uLlVwZ3JhZGVFeGNlcHRpb24oaW9lKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgQ29va2llIGMgPSBDb29raWUucmVhZEZy\nb21ab29LZWVwZXIoemssIGNvbmYpOwogICAgICAgICAgICAgICAgYy5kZWxl\ndGVGcm9tWm9vS2VlcGVyKHprLCBjb25mKTsKICAgICAgICAgICAgfSBjYXRj\naCAoS2VlcGVyRXhjZXB0aW9uIGtlKSB7CiAgICAgICAgICAgICAgICBMT0cu\nZXJyb3IoIkVycm9yIGRlbGV0aW5nIGNvb2tpZSBmcm9tIFpvb0tlZXBlciIp\nOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEJvb2tpZUV4Y2VwdGlvbi5V\ncGdyYWRlRXhjZXB0aW9uKGtlKTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9F\neGNlcHRpb24gaW9lKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkkv\nTyBFcnJvciBkZWxldGluZyBjb29raWUgZnJvbSBab29LZWVwZXIiKTsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBCb29raWVFeGNlcHRpb24uVXBncmFk\nZUV4Y2VwdGlvbihpb2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSBmaW5h\nbGx5IHsKICAgICAgICAgICAgemsuY2xvc2UoKTsKICAgICAgICB9CiAgICAg\nICAgTE9HLmluZm8oIkRvbmUiKTsKICAgIH0KCiAgICBwcml2YXRlIHN0YXRp\nYyB2b2lkIHByaW50SGVscChPcHRpb25zIG9wdHMpIHsKICAgICAgICBIZWxw\nRm9ybWF0dGVyIGhmID0gbmV3IEhlbHBGb3JtYXR0ZXIoKTsKICAgICAgICBo\nZi5wcmludEhlbHAoIkZpbGVTeXN0ZW1VcGdyYWRlIFtvcHRpb25zXSIsIG9w\ndHMpOwogICAgfQoKICAgIHB1YmxpYyBzdGF0aWMgdm9pZCBtYWluKFN0cmlu\nZ1tdIGFyZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIG9yZy5hcGFj\naGUubG9nNGouTG9nZ2VyIHJvb3QgPSBvcmcuYXBhY2hlLmxvZzRqLkxvZ2dl\nci5nZXRSb290TG9nZ2VyKCk7CiAgICAgICAgcm9vdC5hZGRBcHBlbmRlcihu\nZXcgb3JnLmFwYWNoZS5sb2c0ai5Db25zb2xlQXBwZW5kZXIoCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLmxvZzRq\nLlBhdHRlcm5MYXlvdXQoIiUtNXAgWyV0XTogJW0lbiIpKSk7CiAgICAgICAg\ncm9vdC5zZXRMZXZlbChvcmcuYXBhY2hlLmxvZzRqLkxldmVsLkVSUk9SKTsK\nICAgICAgICByb290LmdldExvZ2dlcihGaWxlU3lzdGVtVXBncmFkZS5jbGFz\ncykuc2V0TGV2ZWwob3JnLmFwYWNoZS5sb2c0ai5MZXZlbC5JTkZPKTsKCiAg\nICAgICAgZmluYWwgT3B0aW9ucyBvcHRzID0gbmV3IE9wdGlvbnMoKTsKICAg\nICAgICBvcHRzLmFkZE9wdGlvbigiYyIsICJjb25mIiwgdHJ1ZSwgIkNvbmZp\nZ3VyYXRpb24gZm9yIEJvb2tpZSIpOwogICAgICAgIG9wdHMuYWRkT3B0aW9u\nKCJ1IiwgInVwZ3JhZGUiLCBmYWxzZSwgIlVwZ3JhZGUgYm9va2llIGRpcmVj\ndG9yaWVzIik7CiAgICAgICAgb3B0cy5hZGRPcHRpb24oImYiLCAiZmluYWxp\nemUiLCBmYWxzZSwgIkZpbmFsaXplIHVwZ3JhZGUiKTsKICAgICAgICBvcHRz\nLmFkZE9wdGlvbigiciIsICJyb2xsYmFjayIsIGZhbHNlLCAiUm9sbGJhY2sg\ndXBncmFkZSIpOwogICAgICAgIG9wdHMuYWRkT3B0aW9uKCJoIiwgImhlbHAi\nLCBmYWxzZSwgIlByaW50IGhlbHAgbWVzc2FnZSIpOwoKICAgICAgICBCYXNp\nY1BhcnNlciBwYXJzZXIgPSBuZXcgQmFzaWNQYXJzZXIoKTsKICAgICAgICBD\nb21tYW5kTGluZSBjbWRMaW5lID0gcGFyc2VyLnBhcnNlKG9wdHMsIGFyZ3Mp\nOwogICAgICAgIGlmIChjbWRMaW5lLmhhc09wdGlvbigiaCIpKSB7CiAgICAg\nICAgICAgIHByaW50SGVscChvcHRzKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgaWYgKCFjbWRMaW5lLmhhc09wdGlvbigiYyIp\nKSB7CiAgICAgICAgICAgIFN0cmluZyBlcnIgPSAiQ2Fubm90IHVwZ3JhZGUg\nd2l0aG91dCBjb25maWd1cmF0aW9uIjsKICAgICAgICAgICAgTE9HLmVycm9y\nKGVycik7CiAgICAgICAgICAgIHByaW50SGVscChvcHRzKTsKICAgICAgICAg\nICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbihlcnIpOwog\nICAgICAgIH0KCiAgICAgICAgU3RyaW5nIGNvbmZGaWxlID0gY21kTGluZS5n\nZXRPcHRpb25WYWx1ZSgiYyIpOwogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCk7CiAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgY29uZi5sb2FkQ29uZihuZXcgRmlsZShjb25m\nRmlsZSkudG9VUkkoKS50b1VSTCgpKTsKICAgICAgICB9IGNhdGNoIChNYWxm\nb3JtZWRVUkxFeGNlcHRpb24gbXVlKSB7CiAgICAgICAgICAgIExPRy5lcnJv\ncigiQ291bGQgbm90IG9wZW4gY29uZmlndXJhdGlvbiBmaWxlICIgKyBjb25m\nRmlsZSwgbXVlKTsKICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1\nbWVudEV4Y2VwdGlvbigpOwogICAgICAgIH0gY2F0Y2ggKENvbmZpZ3VyYXRp\nb25FeGNlcHRpb24gY2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJbnZh\nbGlkIGNvbmZpZ3VyYXRpb24gZmlsZSAiICsgY29uZkZpbGUsIGNlKTsKICAg\nICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigp\nOwogICAgICAgIH0KCiAgICAgICAgaWYgKGNtZExpbmUuaGFzT3B0aW9uKCJ1\nIikpIHsKICAgICAgICAgICAgdXBncmFkZShjb25mKTsKICAgICAgICB9IGVs\nc2UgaWYgKGNtZExpbmUuaGFzT3B0aW9uKCJyIikpIHsKICAgICAgICAgICAg\ncm9sbGJhY2soY29uZik7CiAgICAgICAgfSBlbHNlIGlmIChjbWRMaW5lLmhh\nc09wdGlvbigiZiIpKSB7CiAgICAgICAgICAgIGZpbmFsaXplVXBncmFkZShj\nb25mKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTdHJpbmcgZXJy\nID0gIk11c3Qgc3BlY2lmeSAtdXBncmFkZSwgLWZpbmFsaXplIG9yIC1yb2xs\nYmFjayI7CiAgICAgICAgICAgIExPRy5lcnJvcihlcnIpOwogICAgICAgICAg\nICBwcmludEhlbHAob3B0cyk7CiAgICAgICAgICAgIHRocm93IG5ldyBJbGxl\nZ2FsQXJndW1lbnRFeGNlcHRpb24oZXJyKTsKICAgICAgICB9CiAgICB9Cn0=\n","encoding":"base64"}

