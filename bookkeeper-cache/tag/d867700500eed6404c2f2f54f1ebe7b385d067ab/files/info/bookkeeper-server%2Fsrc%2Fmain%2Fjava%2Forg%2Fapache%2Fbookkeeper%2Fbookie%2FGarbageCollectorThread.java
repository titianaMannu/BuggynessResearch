{"sha":"139e1c3590722e5919f8481525aeb46fc87ccb95","node_id":"MDQ6QmxvYjE1NzU5NTY6MTM5ZTFjMzU5MDcyMmU1OTE5Zjg0ODE1MjVhZWI0NmZjODdjY2I5NQ==","size":18990,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/139e1c3590722e5919f8481525aeb46fc87ccb95","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmlvLkJ5\ndGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuQ29tcGFyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuQ29sbGVj\ndGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGls\nLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5Db25jdXJyZW50\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5B\ndG9taWNCb29sZWFuOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuYm9va2llLkVudHJ5TG9nZ2VyLkVudHJ5TG9nU2Nhbm5l\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNv\nbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIubWV0\nYS5MZWRnZXJNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIu\nWm9vS2VlcGVyOwoKLyoqCiAqIFRoaXMgaXMgdGhlIGdhcmJhZ2UgY29sbGVj\ndG9yIHRocmVhZCB0aGF0IHJ1bnMgaW4gdGhlIGJhY2tncm91bmQgdG8KICog\ncmVtb3ZlIGFueSBlbnRyeSBsb2cgZmlsZXMgdGhhdCBubyBsb25nZXIgY29u\ndGFpbnMgYW55IGFjdGl2ZSBsZWRnZXIuCiAqLwpwdWJsaWMgY2xhc3MgR2Fy\nYmFnZUNvbGxlY3RvclRocmVhZCBleHRlbmRzIFRocmVhZCB7CiAgICBwcml2\nYXRlIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5n\nZXRMb2dnZXIoR2FyYmFnZUNvbGxlY3RvclRocmVhZC5jbGFzcyk7CgogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgaW50IFNFQ09ORCA9IDEwMDA7CgogICAg\nLy8gTWFwcyBlbnRyeSBsb2cgZmlsZXMgdG8gdGhlIHNldCBvZiBsZWRnZXJz\nIHRoYXQgY29tcHJpc2UgdGhlIGZpbGUgYW5kIHRoZSBzaXplIHVzYWdlIHBl\nciBsZWRnZXIKICAgIHByaXZhdGUgTWFwPExvbmcsIEVudHJ5TG9nTWV0YWRh\ndGE+IGVudHJ5TG9nTWV0YU1hcCA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxM\nb25nLCBFbnRyeUxvZ01ldGFkYXRhPigpOwoKICAgIC8vIFRoaXMgaXMgaG93\nIG9mdGVuIHdlIHdhbnQgdG8gcnVuIHRoZSBHYXJiYWdlIENvbGxlY3RvciBU\naHJlYWQgKGluIG1pbGxpc2Vjb25kcykuCiAgICBmaW5hbCBsb25nIGdjV2Fp\ndFRpbWU7CgogICAgLy8gQ29tcGFjdGlvbiBwYXJhbWV0ZXJzCiAgICBib29s\nZWFuIGVuYWJsZU1pbm9yQ29tcGFjdGlvbiA9IGZhbHNlOwogICAgZmluYWwg\nZG91YmxlIG1pbm9yQ29tcGFjdGlvblRocmVzaG9sZDsKICAgIGZpbmFsIGxv\nbmcgbWlub3JDb21wYWN0aW9uSW50ZXJ2YWw7CgogICAgYm9vbGVhbiBlbmFi\nbGVNYWpvckNvbXBhY3Rpb24gPSBmYWxzZTsKICAgIGZpbmFsIGRvdWJsZSBt\nYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQ7CiAgICBmaW5hbCBsb25nIG1ham9y\nQ29tcGFjdGlvbkludGVydmFsOwoKICAgIGxvbmcgbGFzdE1pbm9yQ29tcGFj\ndGlvblRpbWU7CiAgICBsb25nIGxhc3RNYWpvckNvbXBhY3Rpb25UaW1lOwoK\nICAgIC8vIEVudHJ5IExvZ2dlciBIYW5kbGUKICAgIGZpbmFsIEVudHJ5TG9n\nZ2VyIGVudHJ5TG9nZ2VyOwogICAgZmluYWwgRW50cnlMb2dTY2FubmVyIHNj\nYW5uZXI7CgogICAgLy8gTGVkZ2VyIENhY2hlIEhhbmRsZQogICAgZmluYWwg\nTGVkZ2VyQ2FjaGUgbGVkZ2VyQ2FjaGU7CgogICAgZmluYWwgTGVkZ2VyTWFu\nYWdlciBsZWRnZXJNYW5hZ2VyOwoKICAgIC8vIGZsYWcgdG8gZW5zdXJlIGdj\nIHRocmVhZCB3aWxsIG5vdCBiZSBpbnRlcnJ1cHRlZCBkdXJpbmcgY29tcGFj\ndGlvbgogICAgLy8gdG8gcmVkdWNlIHRoZSByaXNrIGdldHRpbmcgZW50cnkg\nbG9nIGNvcnJ1cHRlZAogICAgZmluYWwgQXRvbWljQm9vbGVhbiBjb21wYWN0\naW5nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwoKICAgIHZvbGF0aWxl\nIGJvb2xlYW4gcnVubmluZyA9IHRydWU7CgogICAgLy8gdHJhY2sgdGhlIGxh\nc3Qgc2Nhbm5lZCBzdWNjZXNzZnVsbHkgbG9nIGlkCiAgICBsb25nIHNjYW5u\nZWRMb2dJZCA9IDA7CgogICAgLyoqCiAgICAgKiBBIHNjYW5uZXIgd3JhcHBl\nciB0byBjaGVjayB3aGV0aGVyIGEgbGVkZ2VyIGlzIGFsaXZlIGluIGFuIGVu\ndHJ5IGxvZyBmaWxlCiAgICAgKi8KICAgIGNsYXNzIENvbXBhY3Rpb25TY2Fu\nbmVyIGltcGxlbWVudHMgRW50cnlMb2dTY2FubmVyIHsKICAgICAgICBFbnRy\neUxvZ01ldGFkYXRhIG1ldGE7CgogICAgICAgIHB1YmxpYyBDb21wYWN0aW9u\nU2Nhbm5lcihFbnRyeUxvZ01ldGFkYXRhIG1ldGEpIHsKICAgICAgICAgICAg\ndGhpcy5tZXRhID0gbWV0YTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChsb25nIGxlZGdlcklk\nKSB7CiAgICAgICAgICAgIHJldHVybiBtZXRhLmNvbnRhaW5zTGVkZ2VyKGxl\nZGdlcklkKSAmJiBzY2FubmVyLmFjY2VwdChsZWRnZXJJZCk7CiAgICAgICAg\nfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBwcm9j\nZXNzKGxvbmcgbGVkZ2VySWQsIEJ5dGVCdWZmZXIgZW50cnkpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgICAgIHNjYW5uZXIucHJvY2VzcyhsZWRn\nZXJJZCwgZW50cnkpOwogICAgICAgIH0KICAgIH0KCgogICAgLyoqCiAgICAg\nKiBDcmVhdGUgYSBnYXJiYWdlIGNvbGxlY3RvciB0aHJlYWQuCiAgICAgKgog\nICAgICogQHBhcmFtIGNvbmYKICAgICAqICAgICAgICAgIFNlcnZlciBDb25m\naWd1cmF0aW9uIE9iamVjdC4KICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24K\nICAgICAqLwogICAgcHVibGljIEdhcmJhZ2VDb2xsZWN0b3JUaHJlYWQoU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgTGVkZ2VyQ2FjaGUgbGVkZ2VyQ2FjaGUsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBFbnRyeUxvZ2dlciBlbnRyeUxv\nZ2dlciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZGdl\nck1hbmFnZXIgbGVkZ2VyTWFuYWdlciwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIEVudHJ5TG9nU2Nhbm5lciBzY2FubmVyKQogICAgICAg\nIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgc3VwZXIoIkdhcmJhZ2VD\nb2xsZWN0b3JUaHJlYWQiKTsKCiAgICAgICAgdGhpcy5sZWRnZXJDYWNoZSA9\nIGxlZGdlckNhY2hlOwogICAgICAgIHRoaXMuZW50cnlMb2dnZXIgPSBlbnRy\neUxvZ2dlcjsKICAgICAgICB0aGlzLmxlZGdlck1hbmFnZXIgPSBsZWRnZXJN\nYW5hZ2VyOwogICAgICAgIHRoaXMuc2Nhbm5lciA9IHNjYW5uZXI7CgogICAg\nICAgIHRoaXMuZ2NXYWl0VGltZSA9IGNvbmYuZ2V0R2NXYWl0VGltZSgpOwog\nICAgICAgIC8vIGNvbXBhY3Rpb24gcGFyYW1ldGVycwogICAgICAgIG1pbm9y\nQ29tcGFjdGlvblRocmVzaG9sZCA9IGNvbmYuZ2V0TWlub3JDb21wYWN0aW9u\nVGhyZXNob2xkKCk7CiAgICAgICAgbWlub3JDb21wYWN0aW9uSW50ZXJ2YWwg\nPSBjb25mLmdldE1pbm9yQ29tcGFjdGlvbkludGVydmFsKCkgKiBTRUNPTkQ7\nCiAgICAgICAgbWFqb3JDb21wYWN0aW9uVGhyZXNob2xkID0gY29uZi5nZXRN\nYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQoKTsKICAgICAgICBtYWpvckNvbXBh\nY3Rpb25JbnRlcnZhbCA9IGNvbmYuZ2V0TWFqb3JDb21wYWN0aW9uSW50ZXJ2\nYWwoKSAqIFNFQ09ORDsKCiAgICAgICAgaWYgKG1pbm9yQ29tcGFjdGlvbklu\ndGVydmFsID4gMCAmJiBtaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQgPiAwKSB7\nCiAgICAgICAgICAgIGlmIChtaW5vckNvbXBhY3Rpb25UaHJlc2hvbGQgPiAx\nLjBmKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24o\nIkludmFsaWQgbWlub3IgY29tcGFjdGlvbiB0aHJlc2hvbGQgIgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIG1pbm9yQ29tcGFjdGlv\nblRocmVzaG9sZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1p\nbm9yQ29tcGFjdGlvbkludGVydmFsIDw9IGdjV2FpdFRpbWUpIHsKICAgICAg\nICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiVG9vIHNob3J0IG1p\nbm9yIGNvbXBhY3Rpb24gaW50ZXJ2YWwgOiAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICsgbWlub3JDb21wYWN0aW9uSW50ZXJ2YWwp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVuYWJsZU1pbm9yQ29tcGFj\ndGlvbiA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICBpZiAobWFqb3JDb21w\nYWN0aW9uSW50ZXJ2YWwgPiAwICYmIG1ham9yQ29tcGFjdGlvblRocmVzaG9s\nZCA+IDApIHsKICAgICAgICAgICAgaWYgKG1ham9yQ29tcGFjdGlvblRocmVz\naG9sZCA+IDEuMGYpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4\nY2VwdGlvbigiSW52YWxpZCBtYWpvciBjb21wYWN0aW9uIHRocmVzaG9sZCAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbWFqb3JD\nb21wYWN0aW9uVGhyZXNob2xkKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAobWFqb3JDb21wYWN0aW9uSW50ZXJ2YWwgPD0gZ2NXYWl0VGltZSkg\newogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJUb28g\nc2hvcnQgbWFqb3IgY29tcGFjdGlvbiBpbnRlcnZhbCA6ICIKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBtYWpvckNvbXBhY3Rpb25J\nbnRlcnZhbCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZW5hYmxlTWFq\nb3JDb21wYWN0aW9uID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmIChl\nbmFibGVNaW5vckNvbXBhY3Rpb24gJiYgZW5hYmxlTWFqb3JDb21wYWN0aW9u\nKSB7CiAgICAgICAgICAgIGlmIChtaW5vckNvbXBhY3Rpb25JbnRlcnZhbCA+\nPSBtYWpvckNvbXBhY3Rpb25JbnRlcnZhbCB8fAogICAgICAgICAgICAgICAg\nbWlub3JDb21wYWN0aW9uVGhyZXNob2xkID49IG1ham9yQ29tcGFjdGlvblRo\ncmVzaG9sZCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0\naW9uKCJJbnZhbGlkIG1pbm9yL21ham9yIGNvbXBhY3Rpb24gc2V0dGluZ3Mg\nOiBtaW5vciAoIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIG1pbm9yQ29tcGFjdGlvblRocmVzaG9sZCArICIsICIgKyBtaW5vckNv\nbXBhY3Rpb25JbnRlcnZhbAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArICIpLCBtYWpvciAoIiArIG1ham9yQ29tcGFjdGlvblRocmVz\naG9sZCArICIsICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyBtYWpvckNvbXBhY3Rpb25JbnRlcnZhbCArICIpIik7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIExPRy5pbmZvKCJNaW5vciBDb21w\nYWN0aW9uIDogZW5hYmxlZD0iICsgZW5hYmxlTWlub3JDb21wYWN0aW9uICsg\nIiwgdGhyZXNob2xkPSIKICAgICAgICAgICAgICAgKyBtaW5vckNvbXBhY3Rp\nb25UaHJlc2hvbGQgKyAiLCBpbnRlcnZhbD0iICsgbWlub3JDb21wYWN0aW9u\nSW50ZXJ2YWwpOwogICAgICAgIExPRy5pbmZvKCJNYWpvciBDb21wYWN0aW9u\nIDogZW5hYmxlZD0iICsgZW5hYmxlTWFqb3JDb21wYWN0aW9uICsgIiwgdGhy\nZXNob2xkPSIKICAgICAgICAgICAgICAgKyBtYWpvckNvbXBhY3Rpb25UaHJl\nc2hvbGQgKyAiLCBpbnRlcnZhbD0iICsgbWFqb3JDb21wYWN0aW9uSW50ZXJ2\nYWwpOwoKICAgICAgICBsYXN0TWlub3JDb21wYWN0aW9uVGltZSA9IGxhc3RN\nYWpvckNvbXBhY3Rpb25UaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBydW4o\nKSB7CiAgICAgICAgd2hpbGUgKHJ1bm5pbmcpIHsKICAgICAgICAgICAgc3lu\nY2hyb25pemVkICh0aGlzKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAg\nICAgICAgICAgICAgICAgIHdhaXQoZ2NXYWl0VGltZSk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQoKS5pbnRlcnJ1\ncHQoKTsKICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gRXh0cmFj\ndCBhbGwgb2YgdGhlIGxlZGdlciBJRCdzIHRoYXQgY29tcHJpc2UgYWxsIG9m\nIHRoZSBlbnRyeSBsb2dzCiAgICAgICAgICAgIC8vIChleGNlcHQgZm9yIHRo\nZSBjdXJyZW50IG5ldyBvbmUgd2hpY2ggaXMgc3RpbGwgYmVpbmcgd3JpdHRl\nbiB0bykuCiAgICAgICAgICAgIGVudHJ5TG9nTWV0YU1hcCA9IGV4dHJhY3RN\nZXRhRnJvbUVudHJ5TG9ncyhlbnRyeUxvZ01ldGFNYXApOwoKICAgICAgICAg\nICAgLy8gZ2MgaW5hY3RpdmUvZGVsZXRlZCBsZWRnZXJzCiAgICAgICAgICAg\nIGRvR2NMZWRnZXJzKCk7CgogICAgICAgICAgICAvLyBnYyBlbnRyeSBsb2dz\nCiAgICAgICAgICAgIGRvR2NFbnRyeUxvZ3MoKTsKCiAgICAgICAgICAgIGxv\nbmcgY3VyVGltZSA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwogICAg\nICAgICAgICBpZiAoZW5hYmxlTWFqb3JDb21wYWN0aW9uICYmCiAgICAgICAg\nICAgICAgICBjdXJUaW1lIC0gbGFzdE1ham9yQ29tcGFjdGlvblRpbWUgPiBt\nYWpvckNvbXBhY3Rpb25JbnRlcnZhbCkgewogICAgICAgICAgICAgICAgLy8g\nZW50ZXIgbWFqb3IgY29tcGFjdGlvbgogICAgICAgICAgICAgICAgTE9HLmlu\nZm8oIkVudGVyIG1ham9yIGNvbXBhY3Rpb24iKTsKICAgICAgICAgICAgICAg\nIGRvQ29tcGFjdEVudHJ5TG9ncyhtYWpvckNvbXBhY3Rpb25UaHJlc2hvbGQp\nOwogICAgICAgICAgICAgICAgbGFzdE1ham9yQ29tcGFjdGlvblRpbWUgPSBT\neXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICAgICAgICAgIC8v\nIGFsc28gbW92ZSBtaW5vciBjb21wYWN0aW9uIHRpbWUKICAgICAgICAgICAg\nICAgIGxhc3RNaW5vckNvbXBhY3Rpb25UaW1lID0gbGFzdE1ham9yQ29tcGFj\ndGlvblRpbWU7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgaWYgKGVuYWJsZU1pbm9yQ29tcGFjdGlvbiAm\nJgogICAgICAgICAgICAgICAgY3VyVGltZSAtIGxhc3RNaW5vckNvbXBhY3Rp\nb25UaW1lID4gbWlub3JDb21wYWN0aW9uSW50ZXJ2YWwpIHsKICAgICAgICAg\nICAgICAgIC8vIGVudGVyIG1pbm9yIGNvbXBhY3Rpb24KICAgICAgICAgICAg\nICAgIExPRy5pbmZvKCJFbnRlciBtaW5vciBjb21wYWN0aW9uIik7CiAgICAg\nICAgICAgICAgICBkb0NvbXBhY3RFbnRyeUxvZ3MobWlub3JDb21wYWN0aW9u\nVGhyZXNob2xkKTsKICAgICAgICAgICAgICAgIGxhc3RNaW5vckNvbXBhY3Rp\nb25UaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBEbyBnYXJi\nYWdlIGNvbGxlY3Rpb24gbGVkZ2VyIGluZGV4IGZpbGVzCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCBkb0djTGVkZ2VycygpIHsKICAgICAgICBsZWRnZXJN\nYW5hZ2VyLmdhcmJhZ2VDb2xsZWN0TGVkZ2VycygKICAgICAgICBuZXcgTGVk\nZ2VyTWFuYWdlci5HYXJiYWdlQ29sbGVjdG9yKCkgewogICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgZ2MobG9uZyBsZWRn\nZXJJZCkgewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nICAgICBsZWRnZXJDYWNoZS5kZWxldGVMZWRnZXIobGVkZ2VySWQpOwogICAg\nICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAg\nICAgICAgICAgICAgIExPRy5lcnJvcigiRXhjZXB0aW9uIHdoZW4gZGVsZXRp\nbmcgdGhlIGxlZGdlciBpbmRleCBmaWxlIG9uIHRoZSBCb29raWU6ICIsIGUp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBHYXJiYWdlIGNvbGxlY3QgdGhvc2Ug\nZW50cnkgbG9nZ2VycyB3aGljaCBhcmUgbm90IGFzc29jaWF0ZWQgd2l0aCBh\nbnkgYWN0aXZlIGxlZGdlcnMKICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIGRv\nR2NFbnRyeUxvZ3MoKSB7CiAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGFsbCBv\nZiB0aGUgZW50cnkgbG9ncyBhbmQgcmVtb3ZlIHRoZSBub24tYWN0aXZlIGxl\nZGdlcnMuCiAgICAgICAgZm9yIChMb25nIGVudHJ5TG9nSWQgOiBlbnRyeUxv\nZ01ldGFNYXAua2V5U2V0KCkpIHsKICAgICAgICAgICAgRW50cnlMb2dNZXRh\nZGF0YSBtZXRhID0gZW50cnlMb2dNZXRhTWFwLmdldChlbnRyeUxvZ0lkKTsK\nICAgICAgICAgICAgZm9yIChMb25nIGVudHJ5TG9nTGVkZ2VyIDogbWV0YS5s\nZWRnZXJzTWFwLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICAvLyBSZW1v\ndmUgdGhlIGVudHJ5IGxvZyBsZWRnZXIgZnJvbSB0aGUgc2V0IGlmIGl0IGlz\nbid0IGFjdGl2ZS4KICAgICAgICAgICAgICAgIGlmICghbGVkZ2VyTWFuYWdl\nci5jb250YWluc0FjdGl2ZUxlZGdlcihlbnRyeUxvZ0xlZGdlcikpIHsKICAg\nICAgICAgICAgICAgICAgICBtZXRhLnJlbW92ZUxlZGdlcihlbnRyeUxvZ0xl\nZGdlcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgaWYgKG1ldGEuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAv\nLyBUaGlzIG1lYW5zIHRoZSBlbnRyeSBsb2cgaXMgbm90IGFzc29jaWF0ZWQg\nd2l0aCBhbnkgYWN0aXZlIGxlZGdlcnMgYW55bW9yZS4KICAgICAgICAgICAg\nICAgIC8vIFdlIGNhbiByZW1vdmUgdGhpcyBlbnRyeSBsb2cgZmlsZSBub3cu\nCiAgICAgICAgICAgICAgICBMT0cuaW5mbygiRGVsZXRpbmcgZW50cnlMb2dJ\nZCAiICsgZW50cnlMb2dJZCArICIgYXMgaXQgaGFzIG5vIGFjdGl2ZSBsZWRn\nZXJzISIpOwogICAgICAgICAgICAgICAgcmVtb3ZlRW50cnlMb2coZW50cnlM\nb2dJZCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb21wYWN0IGVudHJ5IGxvZ3MgaWYgbmVjZXNzYXJ5LgogICAg\nICoKICAgICAqIDxwPgogICAgICogQ29tcGFjdGlvbiB3aWxsIGJlIGV4ZWN1\ndGVkIGZyb20gbG93IHVudXNlZCBzcGFjZSB0byBoaWdoIHVudXNlZCBzcGFj\nZS4KICAgICAqIFRob3NlIGVudHJ5IGxvZyBmaWxlcyB3aG9zZSByZW1haW5p\nbmcgc2l6ZSBwZXJjZW50YWdlIGlzIGhpZ2hlciB0aGFuIHRocmVzaG9sZAog\nICAgICogd291bGQgbm90IGJlIGNvbXBhY3RlZC4KICAgICAqIDwvcD4KICAg\nICAqLwogICAgcHJpdmF0ZSB2b2lkIGRvQ29tcGFjdEVudHJ5TG9ncyhkb3Vi\nbGUgdGhyZXNob2xkKSB7CiAgICAgICAgTE9HLmluZm8oIkRvIGNvbXBhY3Rp\nb24gdG8gY29tcGFjdCB0aG9zZSBmaWxlcyBsb3dlciB0aGFuICIgKyB0aHJl\nc2hvbGQpOwogICAgICAgIC8vIHNvcnQgdGhlIGxlZGdlciBtZXRhIGJ5IG9j\nY3VwaWVkIHVudXNlZCBzcGFjZQogICAgICAgIENvbXBhcmF0b3I8RW50cnlM\nb2dNZXRhZGF0YT4gc2l6ZUNvbXBhcmF0b3IgPSBuZXcgQ29tcGFyYXRvcjxF\nbnRyeUxvZ01ldGFkYXRhPigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyBpbnQgY29tcGFyZShFbnRyeUxvZ01ldGFkYXRh\nIG0xLCBFbnRyeUxvZ01ldGFkYXRhIG0yKSB7CiAgICAgICAgICAgICAgICBs\nb25nIHVudXNlZFNpemUxID0gbTEudG90YWxTaXplIC0gbTEucmVtYWluaW5n\nU2l6ZTsKICAgICAgICAgICAgICAgIGxvbmcgdW51c2VkU2l6ZTIgPSBtMi50\nb3RhbFNpemUgLSBtMi5yZW1haW5pbmdTaXplOwogICAgICAgICAgICAgICAg\naWYgKHVudXNlZFNpemUxID4gdW51c2VkU2l6ZTIpIHsKICAgICAgICAgICAg\nICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYg\nKHVudXNlZFNpemUxIDwgdW51c2VkU2l6ZTIpIHsKICAgICAgICAgICAgICAg\nICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIExpc3Q8RW50cnlMb2dN\nZXRhZGF0YT4gbG9nc1RvQ29tcGFjdCA9IG5ldyBBcnJheUxpc3QoKTsKICAg\nICAgICBsb2dzVG9Db21wYWN0LmFkZEFsbChlbnRyeUxvZ01ldGFNYXAudmFs\ndWVzKCkpOwogICAgICAgIENvbGxlY3Rpb25zLnNvcnQobG9nc1RvQ29tcGFj\ndCwgc2l6ZUNvbXBhcmF0b3IpOwogICAgICAgIGZvciAoRW50cnlMb2dNZXRh\nZGF0YSBtZXRhIDogbG9nc1RvQ29tcGFjdCkgewogICAgICAgICAgICBpZiAo\nbWV0YS5nZXRVc2FnZSgpID49IHRocmVzaG9sZCkgewogICAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKExPRy5p\nc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIkNvbXBhY3RpbmcgZW50cnkgbG9nICIgKyBtZXRhLmVudHJ5TG9nSWQgKyAi\nIGJlbG93IHRocmVzaG9sZCAiCiAgICAgICAgICAgICAgICAgICAgICAgICsg\ndGhyZXNob2xkICsgIi4iKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBj\nb21wYWN0RW50cnlMb2cobWV0YS5lbnRyeUxvZ0lkKTsKICAgICAgICAgICAg\naWYgKCFydW5uaW5nKSB7IC8vIGlmIGdjIHRocmVhZCBpcyBub3QgcnVubmlu\nZywgc3RvcCBjb21wYWN0aW9uCiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBT\naHV0ZG93biB0aGUgZ2FyYmFnZSBjb2xsZWN0b3IgdGhyZWFkLgogICAgICoK\nICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gaWYgdGhlcmUg\naXMgYW4gZXhjZXB0aW9uIHN0b3BwaW5nIGdjIHRocmVhZC4KICAgICAqLwog\nICAgcHVibGljIHZvaWQgc2h1dGRvd24oKSB0aHJvd3MgSW50ZXJydXB0ZWRF\neGNlcHRpb24gewogICAgICAgIHRoaXMucnVubmluZyA9IGZhbHNlOwogICAg\nICAgIGlmIChjb21wYWN0aW5nLmNvbXBhcmVBbmRTZXQoZmFsc2UsIHRydWUp\nKSB7CiAgICAgICAgICAgIC8vIGlmIHNldHRpbmcgY29tcGFjdGluZyBmbGFn\nIHN1Y2NlZWQsIG1lYW5zIGdjVGhyZWFkIGlzIG5vdCBjb21wYWN0aW5nIG5v\ndwogICAgICAgICAgICAvLyBpdCBpcyBzYWZlIHRvIGludGVycnVwdCBpdHNl\nbGYgbm93CiAgICAgICAgICAgIHRoaXMuaW50ZXJydXB0KCk7CiAgICAgICAg\nfQogICAgICAgIHRoaXMuam9pbigpOwogICAgfQoKICAgIC8qKgogICAgICog\nUmVtb3ZlIGVudHJ5IGxvZy4KICAgICAqCiAgICAgKiBAcGFyYW0gZW50cnlM\nb2dJZAogICAgICogICAgICAgICAgRW50cnkgTG9nIEZpbGUgSWQKICAgICAq\nLwogICAgcHJpdmF0ZSB2b2lkIHJlbW92ZUVudHJ5TG9nKGxvbmcgZW50cnlM\nb2dJZCkgewogICAgICAgIC8vIHJlbW92ZSBlbnRyeSBsb2cgZmlsZSBzdWNj\nZXNzZnVsbHkKICAgICAgICBpZiAoZW50cnlMb2dnZXIucmVtb3ZlRW50cnlM\nb2coZW50cnlMb2dJZCkpIHsKICAgICAgICAgICAgZW50cnlMb2dNZXRhTWFw\nLnJlbW92ZShlbnRyeUxvZ0lkKTsKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBDb21wYWN0IGFuIGVudHJ5IGxvZy4KICAgICAqCiAgICAgKiBA\ncGFyYW0gZW50cnlMb2dJZAogICAgICogICAgICAgICAgRW50cnkgTG9nIEZp\nbGUgSWQKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgY29tcGFjdEVudHJ5\nTG9nKGxvbmcgZW50cnlMb2dJZCkgewogICAgICAgIEVudHJ5TG9nTWV0YWRh\ndGEgZW50cnlMb2dNZXRhID0gZW50cnlMb2dNZXRhTWFwLmdldChlbnRyeUxv\nZ0lkKTsKICAgICAgICBpZiAobnVsbCA9PSBlbnRyeUxvZ01ldGEpIHsKICAg\nICAgICAgICAgTE9HLndhcm4oIkNhbid0IGdldCBlbnRyeSBsb2cgbWV0YSB3\naGVuIGNvbXBhY3RpbmcgZW50cnkgbG9nICIgKyBlbnRyeUxvZ0lkICsgIi4i\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgLy8g\nU2ltaWxhciB3aXRoIFN5bmMgVGhyZWFkCiAgICAgICAgLy8gdHJ5IHRvIG1h\ncmsgY29tcGFjdGluZyBmbGFnIHRvIG1ha2Ugc3VyZSBpdCB3b3VsZCBub3Qg\nYmUgaW50ZXJydXB0ZWQKICAgICAgICAvLyBieSBzaHV0ZG93biBkdXJpbmcg\nY29tcGFjdGlvbi4gb3RoZXJ3aXNlIGl0IHdpbGwgcmVjZWl2ZQogICAgICAg\nIC8vIENsb3NlZEJ5SW50ZXJydXB0RXhjZXB0aW9uIHdoaWNoIG1heSBjYXVz\nZSBpbmRleCBmaWxlICYgZW50cnkgbG9nZ2VyCiAgICAgICAgLy8gY2xvc2Vk\nIGFuZCBjb3JydXB0ZWQuCiAgICAgICAgaWYgKCFjb21wYWN0aW5nLmNvbXBh\ncmVBbmRTZXQoZmFsc2UsIHRydWUpKSB7CiAgICAgICAgICAgIC8vIHNldCBj\nb21wYWN0aW5nIGZsYWcgZmFpbGVkLCBtZWFucyBjb21wYWN0aW5nIGlzIHRy\ndWUgbm93CiAgICAgICAgICAgIC8vIGluZGljYXRlcyBhbm90aGVyIHRocmVh\nZCB3YW50cyB0byBpbnRlcnJ1cHQgZ2MgdGhyZWFkIHRvIGV4aXQKICAgICAg\nICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgTE9HLmluZm8oIkNv\nbXBhY3RpbmcgZW50cnkgbG9nIDogIiArIGVudHJ5TG9nSWQpOwoKICAgICAg\nICB0cnkgewogICAgICAgICAgICBlbnRyeUxvZ2dlci5zY2FuRW50cnlMb2co\nZW50cnlMb2dJZCwgbmV3IENvbXBhY3Rpb25TY2FubmVyKGVudHJ5TG9nTWV0\nYSkpOwogICAgICAgICAgICAvLyBhZnRlciBtb3ZpbmcgZW50cmllcyB0byBu\nZXcgZW50cnkgbG9nLCByZW1vdmUgdGhpcyBvbGQgb25lCiAgICAgICAgICAg\nIHJlbW92ZUVudHJ5TG9nKGVudHJ5TG9nSWQpOwogICAgICAgIH0gY2F0Y2gg\nKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmluZm8oIlByZW1h\ndHVyZSBleGNlcHRpb24gd2hlbiBjb21wYWN0aW5nICIgKyBlbnRyeUxvZ0lk\nLCBlKTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAvLyBjbGVh\nciBjb21wYWN0aW5nIGZsYWcKICAgICAgICAgICAgY29tcGFjdGluZy5zZXQo\nZmFsc2UpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFJlY29y\nZHMgdGhlIHRvdGFsIHNpemUsIHJlbWFpbmluZyBzaXplIGFuZCB0aGUgc2V0\nIG9mIGxlZGdlcnMgdGhhdCBjb21wcmlzZSBhIGVudHJ5IGxvZy4KICAgICAq\nLwogICAgc3RhdGljIGNsYXNzIEVudHJ5TG9nTWV0YWRhdGEgewogICAgICAg\nIGxvbmcgZW50cnlMb2dJZDsKICAgICAgICBsb25nIHRvdGFsU2l6ZTsKICAg\nICAgICBsb25nIHJlbWFpbmluZ1NpemU7CiAgICAgICAgQ29uY3VycmVudEhh\nc2hNYXA8TG9uZywgTG9uZz4gbGVkZ2Vyc01hcDsKCiAgICAgICAgcHVibGlj\nIEVudHJ5TG9nTWV0YWRhdGEobG9uZyBsb2dJZCkgewogICAgICAgICAgICB0\naGlzLmVudHJ5TG9nSWQgPSBsb2dJZDsKCiAgICAgICAgICAgIHRvdGFsU2l6\nZSA9IHJlbWFpbmluZ1NpemUgPSAwOwogICAgICAgICAgICBsZWRnZXJzTWFw\nID0gbmV3IENvbmN1cnJlbnRIYXNoTWFwPExvbmcsIExvbmc+KCk7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBhZGRMZWRnZXJTaXplKGxvbmcg\nbGVkZ2VySWQsIGxvbmcgc2l6ZSkgewogICAgICAgICAgICB0b3RhbFNpemUg\nKz0gc2l6ZTsKICAgICAgICAgICAgcmVtYWluaW5nU2l6ZSArPSBzaXplOwog\nICAgICAgICAgICBMb25nIGxlZGdlclNpemUgPSBsZWRnZXJzTWFwLmdldChs\nZWRnZXJJZCk7CiAgICAgICAgICAgIGlmIChudWxsID09IGxlZGdlclNpemUp\nIHsKICAgICAgICAgICAgICAgIGxlZGdlclNpemUgPSAwTDsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBsZWRnZXJTaXplICs9IHNpemU7CiAgICAgICAg\nICAgIGxlZGdlcnNNYXAucHV0KGxlZGdlcklkLCBsZWRnZXJTaXplKTsKICAg\nICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHJlbW92ZUxlZGdlcihsb25n\nIGxlZGdlcklkKSB7CiAgICAgICAgICAgIExvbmcgc2l6ZSA9IGxlZGdlcnNN\nYXAucmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICAgICAgaWYgKG51bGwgPT0g\nc2l6ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJlbWFpbmluZ1NpemUgLT0gc2l6ZTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyBib29sZWFuIGNvbnRhaW5zTGVkZ2VyKGxvbmcg\nbGVkZ2VySWQpIHsKICAgICAgICAgICAgcmV0dXJuIGxlZGdlcnNNYXAuY29u\ndGFpbnNLZXkobGVkZ2VySWQpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIGRvdWJsZSBnZXRVc2FnZSgpIHsKICAgICAgICAgICAgaWYgKHRvdGFsU2l6\nZSA9PSAwTCkgewogICAgICAgICAgICAgICAgcmV0dXJuIDAuMGY7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChkb3VibGUpcmVtYWluaW5n\nU2l6ZSAvIHRvdGFsU2l6ZTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBi\nb29sZWFuIGlzRW1wdHkoKSB7CiAgICAgICAgICAgIHJldHVybiBsZWRnZXJz\nTWFwLmlzRW1wdHkoKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAg\nIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAg\nICAgICAgICBzYi5hcHBlbmQoInsgdG90YWxTaXplID0gIikuYXBwZW5kKHRv\ndGFsU2l6ZSkuYXBwZW5kKCIsIHJlbWFpbmluZ1NpemUgPSAiKQogICAgICAg\nICAgICAgIC5hcHBlbmQocmVtYWluaW5nU2l6ZSkuYXBwZW5kKCIsIGxlZGdl\ncnNNYXAgPSAiKS5hcHBlbmQobGVkZ2Vyc01hcCkuYXBwZW5kKCIgfSIpOwog\nICAgICAgICAgICByZXR1cm4gc2IudG9TdHJpbmcoKTsKICAgICAgICB9CiAg\nICB9CgogICAgLyoqCiAgICAgKiBBIHNjYW5uZXIgdXNlZCB0byBleHRyYWN0\nIGVudHJ5IGxvZyBtZXRhIGZyb20gZW50cnkgbG9nIGZpbGVzLgogICAgICov\nCiAgICBzdGF0aWMgY2xhc3MgRXh0cmFjdGlvblNjYW5uZXIgaW1wbGVtZW50\ncyBFbnRyeUxvZ1NjYW5uZXIgewogICAgICAgIEVudHJ5TG9nTWV0YWRhdGEg\nbWV0YTsKCiAgICAgICAgcHVibGljIEV4dHJhY3Rpb25TY2FubmVyKEVudHJ5\nTG9nTWV0YWRhdGEgbWV0YSkgewogICAgICAgICAgICB0aGlzLm1ldGEgPSBt\nZXRhOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIGJvb2xlYW4gYWNjZXB0KGxvbmcgbGVkZ2VySWQpIHsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3MobG9uZyBsZWRnZXJJZCwgQnl0\nZUJ1ZmZlciBlbnRyeSkgewogICAgICAgICAgICAvLyBhZGQgbmV3IGVudHJ5\nIHNpemUgb2YgYSBsZWRnZXIgdG8gZW50cnkgbG9nIG1ldGEKICAgICAgICAg\nICAgbWV0YS5hZGRMZWRnZXJTaXplKGxlZGdlcklkLCBlbnRyeS5saW1pdCgp\nICsgNCk7CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogTWV0aG9k\nIHRvIHJlYWQgaW4gYWxsIG9mIHRoZSBlbnRyeSBsb2dzICh0aG9zZSB0aGF0\nIHdlIGhhdmVuJ3QgZG9uZSBzbyB5ZXQpLAogICAgICogYW5kIGZpbmQgdGhl\nIHNldCBvZiBsZWRnZXIgSUQncyB0aGF0IG1ha2UgdXAgZWFjaCBlbnRyeSBs\nb2cgZmlsZS4KICAgICAqCiAgICAgKiBAcGFyYW0gZW50cnlMb2dNZXRhTWFw\nCiAgICAgKiAgICAgICAgICBFeGlzdGluZyBFbnRyeUxvZ3MgdG8gTWV0YQog\nICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAgICovCiAgICBwcm90ZWN0\nZWQgTWFwPExvbmcsIEVudHJ5TG9nTWV0YWRhdGE+IGV4dHJhY3RNZXRhRnJv\nbUVudHJ5TG9ncyhNYXA8TG9uZywgRW50cnlMb2dNZXRhZGF0YT4gZW50cnlM\nb2dNZXRhTWFwKSB7CiAgICAgICAgLy8gRXh0cmFjdCBpdCBmb3IgZXZlcnkg\nZW50cnkgbG9nIGV4Y2VwdCBmb3IgdGhlIGN1cnJlbnQgb25lLgogICAgICAg\nIC8vIEVudHJ5IExvZyBJRCdzIGFyZSBqdXN0IGEgbG9uZyB2YWx1ZSB0aGF0\nIHN0YXJ0cyBhdCAwIGFuZCBpbmNyZW1lbnRzCiAgICAgICAgLy8gYnkgMSB3\naGVuIHRoZSBsb2cgZmlsbHMgdXAgYW5kIHdlIHJvbGwgdG8gYSBuZXcgb25l\nLgogICAgICAgIGxvbmcgY3VyTG9nSWQgPSBlbnRyeUxvZ2dlci5nZXRDdXJy\nZW50TG9nSWQoKTsKICAgICAgICBib29sZWFuIGhhc0V4Y2VwdGlvbldoZW5T\nY2FuID0gZmFsc2U7CiAgICAgICAgZm9yIChsb25nIGVudHJ5TG9nSWQgPSBz\nY2FubmVkTG9nSWQ7IGVudHJ5TG9nSWQgPCBjdXJMb2dJZDsgZW50cnlMb2dJ\nZCsrKSB7CiAgICAgICAgICAgIC8vIENvbWIgdGhlIGN1cnJlbnQgZW50cnkg\nbG9nIGZpbGUgaWYgaXQgaGFzIG5vdCBhbHJlYWR5IGJlZW4gZXh0cmFjdGVk\nLgogICAgICAgICAgICBpZiAoZW50cnlMb2dNZXRhTWFwLmNvbnRhaW5zS2V5\nKGVudHJ5TG9nSWQpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgLy8gY2hlY2sgd2hldGhlciBsb2cg\nZmlsZSBleGlzdHMgb3Igbm90CiAgICAgICAgICAgIC8vIGlmIGl0IGRvZXNu\nJ3QgZXhpc3QsIHRoaXMgbG9nIGZpbGUgbWlnaHQgaGF2ZSBiZWVuIGdhcmJh\nZ2UgY29sbGVjdGVkLgogICAgICAgICAgICBpZiAoIWVudHJ5TG9nZ2VyLmxv\nZ0V4aXN0cyhlbnRyeUxvZ0lkKSkgewogICAgICAgICAgICAgICAgY29udGlu\ndWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5pbmZvKCJFeHRy\nYWN0aW5nIGVudHJ5IGxvZyBtZXRhIGZyb20gZW50cnlMb2dJZDogIiArIGVu\ndHJ5TG9nSWQpOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAg\nIC8vIFJlYWQgdGhyb3VnaCB0aGUgZW50cnkgbG9nIGZpbGUgYW5kIGV4dHJh\nY3QgdGhlIGVudHJ5IGxvZyBtZXRhCiAgICAgICAgICAgICAgICBFbnRyeUxv\nZ01ldGFkYXRhIGVudHJ5TG9nTWV0YSA9IGV4dHJhY3RNZXRhRnJvbUVudHJ5\nTG9nKGVudHJ5TG9nZ2VyLCBlbnRyeUxvZ0lkKTsKICAgICAgICAgICAgICAg\nIGVudHJ5TG9nTWV0YU1hcC5wdXQoZW50cnlMb2dJZCwgZW50cnlMb2dNZXRh\nKTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgaGFzRXhjZXB0aW9uV2hlblNjYW4gPSB0cnVlOwogICAg\nICAgICAgICAgICAgTE9HLndhcm4oIlByZW1hdHVyZSBleGNlcHRpb24gd2hl\nbiBwcm9jZXNzaW5nICIgKyBlbnRyeUxvZ0lkICsKICAgICAgICAgICAgICAg\nICAgICAgICAgICJyZWNvdmVyeSB3aWxsIHRha2UgY2FyZSBvZiB0aGUgcHJv\nYmxlbSIsIGUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBpZiBz\nY2FuIGZhaWxlZCBvbiBzb21lIGVudHJ5IGxvZywgd2UgZG9uJ3QgbW92ZSAn\nc2Nhbm5lZExvZ0lkJyB0byBuZXh0IGlkCiAgICAgICAgICAgIC8vIGlmIHNj\nYW4gc3VjY2VlZCwgd2UgZG9uJ3QgbmVlZCB0byBzY2FuIGl0IGFnYWluIGR1\ncmluZyBuZXh0IGdjIHJ1biwKICAgICAgICAgICAgLy8gd2UgbW92ZSAnc2Nh\nbm5lZExvZ0lkJyB0byBuZXh0IGlkCiAgICAgICAgICAgIGlmICghaGFzRXhj\nZXB0aW9uV2hlblNjYW4pIHsKICAgICAgICAgICAgICAgICsrc2Nhbm5lZExv\nZ0lkOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBl\nbnRyeUxvZ01ldGFNYXA7CiAgICB9CgogICAgc3RhdGljIEVudHJ5TG9nTWV0\nYWRhdGEgZXh0cmFjdE1ldGFGcm9tRW50cnlMb2coRW50cnlMb2dnZXIgZW50\ncnlMb2dnZXIsIGxvbmcgZW50cnlMb2dJZCkKICAgICAgICAgICAgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICBFbnRyeUxvZ01ldGFkYXRhIGVudHJ5\nTG9nTWV0YSA9IG5ldyBFbnRyeUxvZ01ldGFkYXRhKGVudHJ5TG9nSWQpOwog\nICAgICAgIEV4dHJhY3Rpb25TY2FubmVyIHNjYW5uZXIgPSBuZXcgRXh0cmFj\ndGlvblNjYW5uZXIoZW50cnlMb2dNZXRhKTsKICAgICAgICAvLyBSZWFkIHRo\ncm91Z2ggdGhlIGVudHJ5IGxvZyBmaWxlIGFuZCBleHRyYWN0IHRoZSBlbnRy\neSBsb2cgbWV0YQogICAgICAgIGVudHJ5TG9nZ2VyLnNjYW5FbnRyeUxvZyhl\nbnRyeUxvZ0lkLCBzY2FubmVyKTsKICAgICAgICBMT0cuaW5mbygiUmV0cmll\ndmVkIGVudHJ5IGxvZyBtZXRhIGRhdGEgZW50cnlMb2dJZDogIgogICAgICAg\nICAgICAgICAgICsgZW50cnlMb2dJZCArICIsIG1ldGE6ICIgKyBlbnRyeUxv\nZ01ldGEpOwogICAgICAgIHJldHVybiBlbnRyeUxvZ01ldGE7CiAgICB9Cn0K\n","encoding":"base64"}

