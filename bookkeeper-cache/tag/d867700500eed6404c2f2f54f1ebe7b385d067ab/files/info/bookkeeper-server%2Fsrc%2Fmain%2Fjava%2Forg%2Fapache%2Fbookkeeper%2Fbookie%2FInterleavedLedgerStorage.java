{"sha":"3c4f339778a6a9f72dfdda68dac668d7866ab061","node_id":"MDQ6QmxvYjE1NzU5NTY6M2M0ZjMzOTc3OGE2YTlmNzJkZmRkYTY4ZGFjNjY4ZDc4NjZhYjA2MQ==","size":5837,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3c4f339778a6a9f72dfdda68dac668d7866ab061","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKaW1wb3J0IGphdmEuaW8uSU9F\neGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmpteC5C\nS01CZWFuSW5mbzsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIubWV0YS5MZWRnZXJNYW5hZ2VyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnByb3RvLkJvb2tpZVByb3RvY29sOwoKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsK\nCi8qKgogKiBJbnRlcmxlYXZlIGxlZGdlciBzdG9yYWdlCiAqIFRoaXMgbGVk\nZ2VyIHN0b3JhZ2UgaW1wbGVtZW50YXRpb24gc3RvcmVzIGFsbCBlbnRyaWVz\nIGluIGEgc2luZ2xlCiAqIGZpbGUgYW5kIG1haW50YWlucyBhbiBpbmRleCBm\naWxlIGZvciBlYWNoIGxlZGdlci4KICovCmNsYXNzIEludGVybGVhdmVkTGVk\nZ2VyU3RvcmFnZSBpbXBsZW1lbnRzIExlZGdlclN0b3JhZ2UgewogICAgZmlu\nYWwgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dl\ncihJbnRlcmxlYXZlZExlZGdlclN0b3JhZ2UuY2xhc3MpOwoKICAgIHByaXZh\ndGUgRW50cnlMb2dnZXIgZW50cnlMb2dnZXI7CiAgICBwcml2YXRlIExlZGdl\nckNhY2hlIGxlZGdlckNhY2hlOwogICAgLy8gVGhpcyBpcyB0aGUgdGhyZWFk\nIHRoYXQgZ2FyYmFnZSBjb2xsZWN0cyB0aGUgZW50cnkgbG9ncyB0aGF0IGRv\nIG5vdAogICAgLy8gY29udGFpbiBhbnkgYWN0aXZlIGxlZGdlcnMgaW4gdGhl\nbTsgYW5kIGNvbXBhY3RzIHRoZSBlbnRyeSBsb2dzIHRoYXQKICAgIC8vIGhh\ncyBsb3dlciByZW1haW5pbmcgcGVyY2VudGFnZSB0byByZWNsYWltIGRpc2sg\nc3BhY2UuCiAgICBmaW5hbCBHYXJiYWdlQ29sbGVjdG9yVGhyZWFkIGdjVGhy\nZWFkOwoKICAgIC8vIHRoaXMgaW5kaWNhdGVzIHRoYXQgYSB3cml0ZSBoYXMg\naGFwcGVuZWQgc2luY2UgdGhlIGxhc3QgZmx1c2gKICAgIHByaXZhdGUgdm9s\nYXRpbGUgYm9vbGVhbiBzb21ldGhpbmdXcml0dGVuID0gZmFsc2U7CgogICAg\nSW50ZXJsZWF2ZWRMZWRnZXJTdG9yYWdlKFNlcnZlckNvbmZpZ3VyYXRpb24g\nY29uZiwgTGVkZ2VyTWFuYWdlciBsZWRnZXJNYW5hZ2VyKQogICAgICAgICAg\nICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGVudHJ5TG9nZ2VyID0g\nbmV3IEVudHJ5TG9nZ2VyKGNvbmYpOwogICAgICAgIGxlZGdlckNhY2hlID0g\nbmV3IExlZGdlckNhY2hlSW1wbChjb25mLCBsZWRnZXJNYW5hZ2VyKTsKICAg\nICAgICBnY1RocmVhZCA9IG5ldyBHYXJiYWdlQ29sbGVjdG9yVGhyZWFkKGNv\nbmYsIGxlZGdlckNhY2hlLCBlbnRyeUxvZ2dlciwKICAgICAgICAgICAgICAg\nIGxlZGdlck1hbmFnZXIsIG5ldyBFbnRyeUxvZ0NvbXBhY3Rpb25TY2FubmVy\nKCkpOwogICAgfQoKICAgIEBPdmVycmlkZSAgICAKICAgIHB1YmxpYyB2b2lk\nIHN0YXJ0KCkgewogICAgICAgIGdjVGhyZWFkLnN0YXJ0KCk7CiAgICB9Cgog\nICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzaHV0ZG93bigpIHRocm93\ncyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gc2h1dCBkb3du\nIGdjIHRocmVhZCwgd2hpY2ggZGVwZW5kcyBvbiB6b29rZWVwZXIgY2xpZW50\nCiAgICAgICAgLy8gYWxzbyBjb21wYWN0aW9uIHdpbGwgd3JpdGUgZW50cmll\ncyBhZ2FpbiB0byBlbnRyeSBsb2cgZmlsZQogICAgICAgIGdjVGhyZWFkLnNo\ndXRkb3duKCk7CiAgICAgICAgZW50cnlMb2dnZXIuc2h1dGRvd24oKTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBsZWRnZXJDYWNoZS5jbG9zZSgpOwog\nICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJFcnJvciB3aGlsZSBjbG9zaW5nIHRoZSBsZWRnZXIgY2Fj\naGUiLCBlKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBzZXRNYXN0ZXJLZXkobG9uZyBsZWRnZXJJZCwgYnl0ZVtd\nIG1hc3RlcktleSkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBsZWRn\nZXJDYWNoZS5zZXRNYXN0ZXJLZXkobGVkZ2VySWQsIG1hc3RlcktleSk7CiAg\nICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYnl0ZVtdIHJlYWRNYXN0\nZXJLZXkobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uLCBCb29r\naWVFeGNlcHRpb24gewogICAgICAgIHJldHVybiBsZWRnZXJDYWNoZS5yZWFk\nTWFzdGVyS2V5KGxlZGdlcklkKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBib29sZWFuIGxlZGdlckV4aXN0cyhsb25nIGxlZGdlcklkKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIHJldHVybiBsZWRnZXJDYWNo\nZS5sZWRnZXJFeGlzdHMobGVkZ2VySWQpOwogICAgfQoKICAgIEBPdmVycmlk\nZQogICAgc3luY2hyb25pemVkIHB1YmxpYyBsb25nIGFkZEVudHJ5KEJ5dGVC\ndWZmZXIgZW50cnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgbG9u\nZyBsZWRnZXJJZCA9IGVudHJ5LmdldExvbmcoKTsKICAgICAgICBsb25nIGVu\ndHJ5SWQgPSBlbnRyeS5nZXRMb25nKCk7CiAgICAgICAgZW50cnkucmV3aW5k\nKCk7CiAgICAgICAgCiAgICAgICAgLyoKICAgICAgICAgKiBMb2cgdGhlIGVu\ndHJ5CiAgICAgICAgICovCiAgICAgICAgbG9uZyBwb3MgPSBlbnRyeUxvZ2dl\nci5hZGRFbnRyeShsZWRnZXJJZCwgZW50cnkpOwogICAgICAgIAogICAgICAg\nIAogICAgICAgIC8qCiAgICAgICAgICogU2V0IG9mZnNldCBvZiBlbnRyeSBp\nZCB0byBiZSB0aGUgY3VycmVudCBsZWRnZXIgcG9zaXRpb24KICAgICAgICAg\nKi8KICAgICAgICBsZWRnZXJDYWNoZS5wdXRFbnRyeU9mZnNldChsZWRnZXJJ\nZCwgZW50cnlJZCwgcG9zKTsKCiAgICAgICAgc29tZXRoaW5nV3JpdHRlbiA9\nIHRydWU7CgogICAgICAgIHJldHVybiBlbnRyeUlkOwogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIEJ5dGVCdWZmZXIgZ2V0RW50cnkobG9uZyBs\nZWRnZXJJZCwgbG9uZyBlbnRyeUlkKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIGxvbmcgb2Zmc2V0OwogICAgICAgIC8qCiAgICAgICAgICogSWYg\nZW50cnlJZCBpcyBCb29raWVQcm90b2NvbC5MQVNUX0FERF9DT05GSVJNRUQs\nIHRoZW4gcmV0dXJuIHRoZSBsYXN0IHdyaXR0ZW4uCiAgICAgICAgICovCiAg\nICAgICAgaWYgKGVudHJ5SWQgPT0gQm9va2llUHJvdG9jb2wuTEFTVF9BRERf\nQ09ORklSTUVEKSB7CiAgICAgICAgICAgIGVudHJ5SWQgPSBsZWRnZXJDYWNo\nZS5nZXRMYXN0RW50cnkobGVkZ2VySWQpOwogICAgICAgIH0KCiAgICAgICAg\nb2Zmc2V0ID0gbGVkZ2VyQ2FjaGUuZ2V0RW50cnlPZmZzZXQobGVkZ2VySWQs\nIGVudHJ5SWQpOwogICAgICAgIGlmIChvZmZzZXQgPT0gMCkgewogICAgICAg\nICAgICB0aHJvdyBuZXcgQm9va2llLk5vRW50cnlFeGNlcHRpb24obGVkZ2Vy\nSWQsIGVudHJ5SWQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gQnl0ZUJ1\nZmZlci53cmFwKGVudHJ5TG9nZ2VyLnJlYWRFbnRyeShsZWRnZXJJZCwgZW50\ncnlJZCwgb2Zmc2V0KSk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJs\naWMgYm9vbGVhbiBpc0ZsdXNoUmVxdWlyZWQoKSB7CiAgICAgICAgcmV0dXJu\nIHNvbWV0aGluZ1dyaXR0ZW47CiAgICB9OwoKICAgIEBPdmVycmlkZQogICAg\ncHVibGljIHZvaWQgZmx1c2goKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIGlmICghc29tZXRoaW5nV3JpdHRlbikgewogICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgfQogICAgICAgIHNvbWV0aGluZ1dyaXR0ZW4gPSBmYWxz\nZTsKICAgICAgICBib29sZWFuIGZsdXNoRmFpbGVkID0gZmFsc2U7CgogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGxlZGdlckNhY2hlLmZsdXNoTGVkZ2Vy\nKHRydWUpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9uIGlvZSkgewog\nICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBmbHVzaGluZyBMZWRn\nZXIgY2FjaGUiLCBpb2UpOwogICAgICAgICAgICBmbHVzaEZhaWxlZCA9IHRy\ndWU7CiAgICAgICAgfQoKICAgICAgICB0cnkgewogICAgICAgICAgICBlbnRy\neUxvZ2dlci5mbHVzaCgpOwogICAgICAgIH0gY2F0Y2ggKElPRXhjZXB0aW9u\nIGlvZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBmbHVz\naGluZyBMZWRnZXIiLCBpb2UpOwogICAgICAgICAgICBmbHVzaEZhaWxlZCA9\nIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChmbHVzaEZhaWxlZCkgewog\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkZsdXNoaW5nIHRv\nIHN0b3JhZ2UgZmFpbGVkLCBjaGVjayBsb2dzIik7CiAgICAgICAgfQogICAg\nfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIEJLTUJlYW5JbmZvIGdldEpN\nWEJlYW4oKSB7CiAgICAgICAgcmV0dXJuIGxlZGdlckNhY2hlLmdldEpNWEJl\nYW4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFNjYW5uZXIgdXNlZCB0byBk\nbyBlbnRyeSBsb2cgY29tcGFjdGlvbgogICAgICovCiAgICBjbGFzcyBFbnRy\neUxvZ0NvbXBhY3Rpb25TY2FubmVyIGltcGxlbWVudHMgRW50cnlMb2dnZXIu\nRW50cnlMb2dTY2FubmVyIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgYm9vbGVhbiBhY2NlcHQobG9uZyBsZWRnZXJJZCkgewogICAgICAg\nICAgICAvLyBib29raWUgaGFzIG5vIGtub3dsZWRnZSBhYm91dCB3aGljaCBs\nZWRnZXIgaXMgZGVsZXRlZAogICAgICAgICAgICAvLyBzbyBqdXN0IGFjY2Vw\ndCBhbGwgbGVkZ2Vycy4KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBw\ncm9jZXNzKGxvbmcgbGVkZ2VySWQsIEJ5dGVCdWZmZXIgYnVmZmVyKQogICAg\nICAgICAgICB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgICAgICBhZGRF\nbnRyeShidWZmZXIpOwogICAgICAgIH0KICAgIH0KCn0=\n","encoding":"base64"}

