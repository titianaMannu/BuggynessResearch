{"sha":"409e2fc8c95eff1fdac6cf6befa49c9b70f4825c","node_id":"MDQ6QmxvYjE1NzU5NTY6NDA5ZTJmYzhjOTVlZmYxZmRhYzZjZjZiZWZhNDljOWI3MGY0ODI1Yw==","size":19410,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/409e2fc8c95eff1fdac6cf6befa49c9b70f4825c","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5GaWxlSW5wdXRT\ndHJlYW07CmltcG9ydCBqYXZhLmlvLkZpbGVPdXRwdXRTdHJlYW07CmltcG9y\ndCBqYXZhLmlvLklPRXhjZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1\nZmZlcjsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZh\nLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuTGlua2VkTGlz\ndDsKaW1wb3J0IGphdmEudXRpbC5MaXN0OwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuTGlua2VkQmxvY2tpbmdRdWV1ZTsKCmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuY29uZi5TZXJ2ZXJDb25maWd1cmF0aW9uOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2trZWVwZXJJbnRl\ncm5hbENhbGxiYWNrcy5Xcml0ZUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnV0aWwuSU9VdGlsczsKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCi8qKgog\nKiBQcm92aWRlIGpvdXJuYWwgcmVsYXRlZCBtYW5hZ2VtZW50LgogKi8KY2xh\nc3MgSm91cm5hbCBleHRlbmRzIFRocmVhZCB7CgogICAgc3RhdGljIExvZ2dl\nciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihKb3VybmFsLmNsYXNz\nKTsKCiAgICAvKioKICAgICAqIEZpbHRlciB0byBwaWNrdXAgam91cm5hbHMK\nICAgICAqLwogICAgcHJpdmF0ZSBzdGF0aWMgaW50ZXJmYWNlIEpvdXJuYWxJ\nZEZpbHRlciB7CiAgICAgICAgcHVibGljIGJvb2xlYW4gYWNjZXB0KGxvbmcg\nam91cm5hbElkKTsKICAgIH0KCiAgICAvKioKICAgICAqIExpc3QgYWxsIGpv\ndXJuYWwgaWRzIGJ5IGEgc3BlY2lmaWVkIGpvdXJuYWwgaWQgZmlsZXIKICAg\nICAqCiAgICAgKiBAcGFyYW0gam91cm5hbERpciBqb3VybmFsIGRpcgogICAg\nICogQHBhcmFtIGZpbHRlciBqb3VybmFsIGlkIGZpbHRlcgogICAgICogQHJl\ndHVybiBsaXN0IG9mIGZpbHRlcmVkIGlkcwogICAgICovCiAgICBwcml2YXRl\nIHN0YXRpYyBMaXN0PExvbmc+IGxpc3RKb3VybmFsSWRzKEZpbGUgam91cm5h\nbERpciwgSm91cm5hbElkRmlsdGVyIGZpbHRlcikgewogICAgICAgIEZpbGUg\nbG9nRmlsZXNbXSA9IGpvdXJuYWxEaXIubGlzdEZpbGVzKCk7CiAgICAgICAg\nTGlzdDxMb25nPiBsb2dzID0gbmV3IEFycmF5TGlzdDxMb25nPigpOwogICAg\nICAgIGZvcihGaWxlIGY6IGxvZ0ZpbGVzKSB7CiAgICAgICAgICAgIFN0cmlu\nZyBuYW1lID0gZi5nZXROYW1lKCk7CiAgICAgICAgICAgIGlmICghbmFtZS5l\nbmRzV2l0aCgiLnR4biIpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBTdHJpbmcgaWRTdHJpbmcgPSBu\nYW1lLnNwbGl0KCJcXC4iKVswXTsKICAgICAgICAgICAgbG9uZyBpZCA9IExv\nbmcucGFyc2VMb25nKGlkU3RyaW5nLCAxNik7CiAgICAgICAgICAgIGlmIChm\naWx0ZXIgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgaWYgKGZpbHRlci5h\nY2NlcHQoaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9ncy5hZGQoaWQp\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgbG9ncy5hZGQoaWQpOwogICAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICAgIENvbGxlY3Rpb25zLnNvcnQobG9ncyk7CiAgICAgICAg\ncmV0dXJuIGxvZ3M7CiAgICB9CgogICAgLyoqCiAgICAgKiBMYXN0IExvZyBN\nYXJrCiAgICAgKi8KICAgIGNsYXNzIExhc3RMb2dNYXJrIHsKICAgICAgICBs\nb25nIHR4bkxvZ0lkOwogICAgICAgIGxvbmcgdHhuTG9nUG9zaXRpb247CiAg\nICAgICAgTGFzdExvZ01hcmsgbGFzdE1hcms7CiAgICAgICAgTGFzdExvZ01h\ncmsobG9uZyBsb2dJZCwgbG9uZyBsb2dQb3NpdGlvbikgewogICAgICAgICAg\nICB0aGlzLnR4bkxvZ0lkID0gbG9nSWQ7CiAgICAgICAgICAgIHRoaXMudHhu\nTG9nUG9zaXRpb24gPSBsb2dQb3NpdGlvbjsKICAgICAgICB9CiAgICAgICAg\nc3luY2hyb25pemVkIHZvaWQgc2V0TGFzdExvZ01hcmsobG9uZyBsb2dJZCwg\nbG9uZyBsb2dQb3NpdGlvbikgewogICAgICAgICAgICB0eG5Mb2dJZCA9IGxv\nZ0lkOwogICAgICAgICAgICB0eG5Mb2dQb3NpdGlvbiA9IGxvZ1Bvc2l0aW9u\nOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6ZWQgdm9pZCBtYXJrTG9n\nKCkgewogICAgICAgICAgICBsYXN0TWFyayA9IG5ldyBMYXN0TG9nTWFyayh0\neG5Mb2dJZCwgdHhuTG9nUG9zaXRpb24pOwogICAgICAgIH0KCiAgICAgICAg\nc3luY2hyb25pemVkIExhc3RMb2dNYXJrIGdldExhc3RNYXJrKCkgewogICAg\nICAgICAgICByZXR1cm4gbGFzdE1hcms7CiAgICAgICAgfQogICAgICAgIHN5\nbmNocm9uaXplZCBsb25nIGdldFR4bkxvZ0lkKCkgewogICAgICAgICAgICBy\nZXR1cm4gdHhuTG9nSWQ7CiAgICAgICAgfQogICAgICAgIHN5bmNocm9uaXpl\nZCBsb25nIGdldFR4bkxvZ1Bvc2l0aW9uKCkgewogICAgICAgICAgICByZXR1\ncm4gdHhuTG9nUG9zaXRpb247CiAgICAgICAgfQoKICAgICAgICBzeW5jaHJv\nbml6ZWQgdm9pZCByb2xsTG9nKCkgewogICAgICAgICAgICBieXRlIGJ1ZmZb\nXSA9IG5ldyBieXRlWzE2XTsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBiYiA9\nIEJ5dGVCdWZmZXIud3JhcChidWZmKTsKICAgICAgICAgICAgLy8gd2Ugc2hv\ndWxkIHJlY29yZCA8bG9nSWQsIGxvZ1Bvc2l0aW9uPiBtYXJrZWQgaW4gbWFy\na0xvZwogICAgICAgICAgICAvLyB3aGljaCBpcyBzYWZlIHNpbmNlIHJlY29y\nZHMgYmVmb3JlIGxhc3RNYXJrIGhhdmUgYmVlbgogICAgICAgICAgICAvLyBw\nZXJzaXN0ZWQgdG8gZGlzayAoYm90aCBpbmRleCAmIGVudHJ5IGxvZ2dlcikK\nICAgICAgICAgICAgYmIucHV0TG9uZyhsYXN0TWFyay5nZXRUeG5Mb2dJZCgp\nKTsKICAgICAgICAgICAgYmIucHV0TG9uZyhsYXN0TWFyay5nZXRUeG5Mb2dQ\nb3NpdGlvbigpKTsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxl\nZCgpKSB7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlJvbGxMb2cgdG8g\ncGVyc2lzdCBsYXN0IG1hcmtlZCBsb2cgOiAiICsgbGFzdE1hcmspOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGZvcihGaWxlIGRpcjogbGVkZ2VyRGly\nZWN0b3JpZXMpIHsKICAgICAgICAgICAgICAgIEZpbGUgZmlsZSA9IG5ldyBG\naWxlKGRpciwgImxhc3RNYXJrIik7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIEZpbGVPdXRwdXRTdHJlYW0gZm9zID0gbmV3\nIEZpbGVPdXRwdXRTdHJlYW0oZmlsZSk7CiAgICAgICAgICAgICAgICAgICAg\nZm9zLndyaXRlKGJ1ZmYpOwogICAgICAgICAgICAgICAgICAgIGZvcy5nZXRD\naGFubmVsKCkuZm9yY2UodHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgZm9z\nLmNsb3NlKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJQcm9ibGVt\ncyB3cml0aW5nIHRvICIgKyBmaWxlLCBlKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAg\nICogUmVhZCBsYXN0IG1hcmsgZnJvbSBsYXN0TWFyayBmaWxlLgogICAgICAg\nICAqIFRoZSBsYXN0IG1hcmsgc2hvdWxkIGZpcnN0IGJlIG1heCBqb3VybmFs\nIGxvZyBpZCwKICAgICAgICAgKiBhbmQgdGhlbiBtYXggbG9nIHBvc2l0aW9u\nIGluIG1heCBqb3VybmFsIGxvZy4KICAgICAgICAgKi8KICAgICAgICBzeW5j\naHJvbml6ZWQgdm9pZCByZWFkTG9nKCkgewogICAgICAgICAgICBieXRlIGJ1\nZmZbXSA9IG5ldyBieXRlWzE2XTsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBi\nYiA9IEJ5dGVCdWZmZXIud3JhcChidWZmKTsKICAgICAgICAgICAgZm9yKEZp\nbGUgZGlyOiBsZWRnZXJEaXJlY3RvcmllcykgewogICAgICAgICAgICAgICAg\nRmlsZSBmaWxlID0gbmV3IEZpbGUoZGlyLCAibGFzdE1hcmsiKTsKICAgICAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgRmlsZUlucHV0\nU3RyZWFtIGZpcyA9IG5ldyBGaWxlSW5wdXRTdHJlYW0oZmlsZSk7CiAgICAg\nICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAg\naW50IGJ5dGVzUmVhZCA9IGZpcy5yZWFkKGJ1ZmYpOwogICAgICAgICAgICAg\nICAgICAgICAgICBpZiAoYnl0ZXNSZWFkICE9IDE2KSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkNvdWxk\nbid0IHJlYWQgZW5vdWdoIGJ5dGVzIGZyb20gbGFzdE1hcmsuIgogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsg\nIiBXYW50ZWQgIiArIDE2ICsgIiwgZ290ICIgKyBieXRlc1JlYWQpOwogICAg\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBm\naW5hbGx5IHsKICAgICAgICAgICAgICAgICAgICAgICAgZmlzLmNsb3NlKCk7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJi\nLmNsZWFyKCk7CiAgICAgICAgICAgICAgICAgICAgbG9uZyBpID0gYmIuZ2V0\nTG9uZygpOwogICAgICAgICAgICAgICAgICAgIGxvbmcgcCA9IGJiLmdldExv\nbmcoKTsKICAgICAgICAgICAgICAgICAgICBpZiAoaSA+IHR4bkxvZ0lkKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIHR4bkxvZ0lkID0gaTsKICAgICAg\nICAgICAgICAgICAgICAgICAgaWYocCA+IHR4bkxvZ1Bvc2l0aW9uKSB7CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgdHhuTG9nUG9zaXRpb24gPSBwOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigiUHJvYmxlbXMgcmVhZGlu\nZyBmcm9tICIgKyBmaWxlICsgIiAodGhpcyBpcyBva2F5IGlmIGl0IGlzIHRo\nZSBmaXJzdCB0aW1lIHN0YXJ0aW5nIHRoaXMgYm9va2llIik7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIEBP\ndmVycmlkZQogICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAg\nICAgICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcgU3RyaW5nQnVpbGRl\ncigpOwoKICAgICAgICAgICAgc2IuYXBwZW5kKCJMYXN0TWFyazogbG9nSWQg\nLSAiKS5hcHBlbmQodHhuTG9nSWQpCiAgICAgICAgICAgICAgLmFwcGVuZCgi\nICwgcG9zaXRpb24gLSAiKS5hcHBlbmQodHhuTG9nUG9zaXRpb24pOwoKICAg\nICAgICAgICAgcmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICAgICAgfQogICAg\nfQoKICAgIC8qKgogICAgICogRmlsdGVyIHRvIHJldHVybiBsaXN0IG9mIGpv\ndXJuYWxzIGZvciByb2xsaW5nCiAgICAgKi8KICAgIHByaXZhdGUgY2xhc3Mg\nSm91cm5hbFJvbGxpbmdGaWx0ZXIgaW1wbGVtZW50cyBKb3VybmFsSWRGaWx0\nZXIgewogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFu\nIGFjY2VwdChsb25nIGpvdXJuYWxJZCkgewogICAgICAgICAgICBpZiAoam91\ncm5hbElkIDwgbGFzdExvZ01hcmsuZ2V0TGFzdE1hcmsoKS5nZXRUeG5Mb2dJ\nZCgpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIFNj\nYW5uZXIgdXNlZCB0byBzY2FuIGEgam91cm5hbAogICAgICovCiAgICBwdWJs\naWMgc3RhdGljIGludGVyZmFjZSBKb3VybmFsU2Nhbm5lciB7CiAgICAgICAg\nLyoqCiAgICAgICAgICogUHJvY2VzcyBhIGpvdXJuYWwgZW50cnkuCiAgICAg\nICAgICoKICAgICAgICAgKiBAcGFyYW0gam91cm5hbFZlcnNpb24KICAgICAg\nICAgKiAgICAgICAgICBKb3VybmFsIFZlcnNpb24KICAgICAgICAgKiBAcGFy\nYW0gb2Zmc2V0CiAgICAgICAgICogICAgICAgICAgRmlsZSBvZmZzZXQgb2Yg\ndGhlIGpvdXJuYWwgZW50cnkKICAgICAgICAgKiBAcGFyYW0gZW50cnkKICAg\nICAgICAgKiAgICAgICAgICBKb3VybmFsIEVudHJ5CiAgICAgICAgICogQHRo\ncm93cyBJT0V4Y2VwdGlvbgogICAgICAgICAqLwogICAgICAgIHB1YmxpYyB2\nb2lkIHByb2Nlc3MoaW50IGpvdXJuYWxWZXJzaW9uLCBsb25nIG9mZnNldCwg\nQnl0ZUJ1ZmZlciBlbnRyeSkgdGhyb3dzIElPRXhjZXB0aW9uOwogICAgfQoK\nICAgIC8qKgogICAgICogSm91cm5hbCBFbnRyeSB0byBSZWNvcmQKICAgICAq\nLwogICAgcHJpdmF0ZSBzdGF0aWMgY2xhc3MgUXVldWVFbnRyeSB7CiAgICAg\nICAgUXVldWVFbnRyeShCeXRlQnVmZmVyIGVudHJ5LCBsb25nIGxlZGdlcklk\nLCBsb25nIGVudHJ5SWQsCiAgICAgICAgICAgICAgICAgICBXcml0ZUNhbGxi\nYWNrIGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHRoaXMuZW50cnkg\nPSBlbnRyeS5kdXBsaWNhdGUoKTsKICAgICAgICAgICAgdGhpcy5jYiA9IGNi\nOwogICAgICAgICAgICB0aGlzLmN0eCA9IGN0eDsKICAgICAgICAgICAgdGhp\ncy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAgICAgICAgICB0aGlzLmVudHJ5\nSWQgPSBlbnRyeUlkOwogICAgICAgIH0KCiAgICAgICAgQnl0ZUJ1ZmZlciBl\nbnRyeTsKCiAgICAgICAgbG9uZyBsZWRnZXJJZDsKCiAgICAgICAgbG9uZyBl\nbnRyeUlkOwoKICAgICAgICBXcml0ZUNhbGxiYWNrIGNiOwoKICAgICAgICBP\nYmplY3QgY3R4OwogICAgfQoKICAgIGZpbmFsIHN0YXRpYyBsb25nIE1CID0g\nMTAyNCAqIDEwMjRMOwogICAgLy8gbWF4IGpvdXJuYWwgZmlsZSBzaXplCiAg\nICBmaW5hbCBsb25nIG1heEpvdXJuYWxTaXplOwogICAgLy8gbnVtYmVyIGpv\ndXJuYWwgZmlsZXMga2VwdCBiZWZvcmUgbWFya2VkIGpvdXJuYWwKICAgIGZp\nbmFsIGludCBtYXhCYWNrdXBKb3VybmFsczsKCiAgICBmaW5hbCBGaWxlIGpv\ndXJuYWxEaXJlY3Rvcnk7CiAgICBmaW5hbCBGaWxlIGxlZGdlckRpcmVjdG9y\naWVzW107CiAgICBmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7Cgog\nICAgcHJpdmF0ZSBMYXN0TG9nTWFyayBsYXN0TG9nTWFyayA9IG5ldyBMYXN0\nTG9nTWFyaygwLCAwKTsKCiAgICAvLyBqb3VybmFsIGVudHJ5IHF1ZXVlIHRv\nIGNvbW1pdAogICAgTGlua2VkQmxvY2tpbmdRdWV1ZTxRdWV1ZUVudHJ5PiBx\ndWV1ZSA9IG5ldyBMaW5rZWRCbG9ja2luZ1F1ZXVlPFF1ZXVlRW50cnk+KCk7\nCgogICAgdm9sYXRpbGUgYm9vbGVhbiBydW5uaW5nID0gdHJ1ZTsKCiAgICBw\ndWJsaWMgSm91cm5hbChTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpIHsKICAg\nICAgICBzdXBlcigiQm9va2llSm91cm5hbC0iICsgY29uZi5nZXRCb29raWVQ\nb3J0KCkpOwogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAgICAgICAgdGhp\ncy5qb3VybmFsRGlyZWN0b3J5ID0gQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoY29uZi5nZXRKb3VybmFsRGlyKCkpOwogICAgICAgIHRoaXMubGVkZ2Vy\nRGlyZWN0b3JpZXMgPSBCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yaWVzKGNv\nbmYuZ2V0TGVkZ2VyRGlycygpKTsKICAgICAgICB0aGlzLm1heEpvdXJuYWxT\naXplID0gY29uZi5nZXRNYXhKb3VybmFsU2l6ZSgpICogTUI7CiAgICAgICAg\ndGhpcy5tYXhCYWNrdXBKb3VybmFscyA9IGNvbmYuZ2V0TWF4QmFja3VwSm91\ncm5hbHMoKTsKCiAgICAgICAgLy8gcmVhZCBsYXN0IGxvZyBtYXJrCiAgICAg\nICAgbGFzdExvZ01hcmsucmVhZExvZygpOwogICAgICAgIGlmIChMT0cuaXNE\nZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cuZGVidWcoIkxhc3Qg\nTG9nIE1hcmsgOiAiICsgbGFzdExvZ01hcmspOwogICAgICAgIH0KICAgIH0K\nCiAgICBMYXN0TG9nTWFyayBnZXRMYXN0TG9nTWFyaygpIHsKICAgICAgICBy\nZXR1cm4gbGFzdExvZ01hcms7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWNv\ncmRzIGEgPGk+TGFzdExvZ01hcms8L2k+IGluIG1lbW9yeS4KICAgICAqCiAg\nICAgKiA8cD4KICAgICAqIFRoZSA8aT5MYXN0TG9nTWFyazwvaT4gY29udGFp\nbnMgdHdvIHBhcnRzOiBmaXJzdCBvbmUgaXMgPGk+dHhuTG9nSWQ8L2k+CiAg\nICAgKiAoZmlsZSBpZCBvZiBhIGpvdXJuYWwpIGFuZCB0aGUgc2Vjb25kIG9u\nZSBpcyA8aT50eG5Mb2dQb3M8L2k+IChvZmZzZXQgaW4KICAgICAqICBhIGpv\ndXJuYWwpLiBUaGUgPGk+TGFzdExvZ01hcms8L2k+IGluZGljYXRlcyB0aGF0\nIHRob3NlIGVudHJpZXMgYmVmb3JlCiAgICAgKiBpdCBoYXZlIGJlZW4gcGVy\nc2lzdGVkIHRvIGJvdGggaW5kZXggYW5kIGVudHJ5IGxvZyBmaWxlcy4KICAg\nICAqIDwvcD4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIFRoaXMgbWV0aG9k\nIGlzIGNhbGxlZCBiZWZvcmUgZmx1c2hpbmcgZW50cnkgbG9nIGZpbGVzIGFu\nZCBsZWRnZXIgY2FjaGUuCiAgICAgKiA8L3A+CiAgICAgKi8KICAgIHB1Ymxp\nYyB2b2lkIG1hcmtMb2coKSB7CiAgICAgICAgbGFzdExvZ01hcmsubWFya0xv\nZygpOwogICAgfQoKICAgIC8qKgogICAgICogUGVyc2lzdHMgdGhlIDxpPkxh\nc3RMb2dNYXJrPC9pPiBtYXJrZWQgYnkgI21hcmtMb2coKSB0byBkaXNrLgog\nICAgICoKICAgICAqIDxwPgogICAgICogVGhpcyBhY3Rpb24gbWVhbnMgZW50\ncmllcyBhZGRlZCBiZWZvcmUgPGk+TGFzdExvZ01hcms8L2k+IHdob3NlIGVu\ndHJ5IGRhdGEKICAgICAqIGFuZCBpbmRleCBwYWdlcyB3ZXJlIGFscmVhZHkg\ncGVyc2lzdGVkIHRvIGRpc2suIEl0IGlzIHRoZSB0aW1lIHRvIHNhZmVseQog\nICAgICogcmVtb3ZlIGpvdXJuYWwgZmlsZXMgY3JlYXRlZCBlYXJsaWVyIHRo\nYW4gPGk+TGFzdExvZ01hcmsudHhuTG9nSWQ8L2k+LgogICAgICogPC9wPgog\nICAgICogPHA+CiAgICAgKiBJZiB0aGUgYm9va2llIGhhcyBjcmFzaGVkIGJl\nZm9yZSBwZXJzaXN0aW5nIDxpPkxhc3RMb2dNYXJrPC9pPiB0byBkaXNrLAog\nICAgICogaXQgc3RpbGwgaGFzIGpvdXJuYWwgZmlsZXMgY29udGFpbnMgZW50\ncmllcyBmb3Igd2hpY2ggaW5kZXggcGFnZXMgbWF5IG5vdAogICAgICogaGF2\nZSBiZWVuIHBlcnNpc3RlZC4gQ29uc2VxdWVudGx5LCB3aGVuIHRoZSBib29r\naWUgcmVzdGFydHMsIGl0IGluc3BlY3RzCiAgICAgKiBqb3VybmFsIGZpbGVz\nIHRvIHJlc3RvcmUgdGhvc2UgZW50cmllczsgZGF0YSBpc24ndCBsb3N0Lgog\nICAgICogPC9wPgogICAgICogPHA+CiAgICAgKiBUaGlzIG1ldGhvZCBpcyBj\nYWxsZWQgYWZ0ZXIgZmx1c2hpbmcgZW50cnkgbG9nIGZpbGVzIGFuZCBsZWRn\nZXIgY2FjaGUgc3VjY2Vzc2Z1bGx5LCB3aGljaCBpcyB0byBlbnN1cmUgPGk+\nTGFzdExvZ01hcms8L2k+IGlzIHBlc2lzdGVkLgogICAgICogPC9wPgogICAg\nICogQHNlZSAjbWFya0xvZygpCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHJv\nbGxMb2coKSB7CiAgICAgICAgbGFzdExvZ01hcmsucm9sbExvZygpOwogICAg\nfQoKICAgIC8qKgogICAgICogR2FyYmFnZSBjb2xsZWN0IG9sZGVyIGpvdXJu\nYWxzCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGdjSm91cm5hbHMoKSB7CiAg\nICAgICAgLy8gbGlzdCB0aGUgam91cm5hbHMgdGhhdCBoYXZlIGJlZW4gbWFy\na2VkCiAgICAgICAgTGlzdDxMb25nPiBsb2dzID0gbGlzdEpvdXJuYWxJZHMo\nam91cm5hbERpcmVjdG9yeSwgbmV3IEpvdXJuYWxSb2xsaW5nRmlsdGVyKCkp\nOwogICAgICAgIC8vIGtlZXAgTUFYX0JBQ0tVUF9KT1VSTkFMUyBqb3VybmFs\nIGZpbGVzIGJlZm9yZSBtYXJrZWQgam91cm5hbAogICAgICAgIGlmIChsb2dz\nLnNpemUoKSA+PSBtYXhCYWNrdXBKb3VybmFscykgewogICAgICAgICAgICBp\nbnQgbWF4SWR4ID0gbG9ncy5zaXplKCkgLSBtYXhCYWNrdXBKb3VybmFsczsK\nICAgICAgICAgICAgZm9yIChpbnQgaT0wOyBpPG1heElkeDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBsb25nIGlkID0gbG9ncy5nZXQoaSk7CiAgICAgICAg\nICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGpvdXJuYWwgaWQgaXMgc21hbGxl\nciB0aGFuIG1hcmtlZCBqb3VybmFsIGlkCiAgICAgICAgICAgICAgICBpZiAo\naWQgPCBsYXN0TG9nTWFyay5nZXRMYXN0TWFyaygpLmdldFR4bkxvZ0lkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBGaWxlIGpvdXJuYWxGaWxlID0gbmV3\nIEZpbGUoam91cm5hbERpcmVjdG9yeSwgTG9uZy50b0hleFN0cmluZyhpZCkg\nKyAiLnR4biIpOwogICAgICAgICAgICAgICAgICAgIGlmICgham91cm5hbEZp\nbGUuZGVsZXRlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLndh\ncm4oIkNvdWxkIG5vdCBkZWxldGUgb2xkIGpvdXJuYWwgZmlsZSB7fSIsIGpv\ndXJuYWxGaWxlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgTE9HLmluZm8oImdhcmJhZ2UgY29sbGVjdGVkIGpvdXJuYWwg\nIiArIGpvdXJuYWxGaWxlLmdldE5hbWUoKSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTY2FuIHRoZSBqb3VybmFsCiAgICAgKgogICAgICogQHBhcmFtIGpvdXJu\nYWxJZAogICAgICogICAgICAgICAgSm91cm5hbCBMb2cgSWQKICAgICAqIEBw\nYXJhbSBqb3VybmFsUG9zCiAgICAgKiAgICAgICAgICBPZmZzZXQgdG8gc3Rh\ncnQgc2Nhbm5pbmcKICAgICAqIEBwYXJhbSBzY2FubmVyCiAgICAgKiAgICAg\nICAgICBTY2FubmVyIHRvIGhhbmRsZSBlbnRyaWVzCiAgICAgKiBAdGhyb3dz\nIElPRXhjZXB0aW9uCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIHNjYW5Kb3Vy\nbmFsKGxvbmcgam91cm5hbElkLCBsb25nIGpvdXJuYWxQb3MsIEpvdXJuYWxT\nY2FubmVyIHNjYW5uZXIpCiAgICAgICAgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBKb3VybmFsQ2hhbm5lbCByZWNMb2c7CiAgICAgICAgaWYgKGpv\ndXJuYWxQb3MgPD0gMCkgewogICAgICAgICAgICByZWNMb2cgPSBuZXcgSm91\ncm5hbENoYW5uZWwoam91cm5hbERpcmVjdG9yeSwgam91cm5hbElkKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgICByZWNMb2cgPSBuZXcgSm91cm5h\nbENoYW5uZWwoam91cm5hbERpcmVjdG9yeSwgam91cm5hbElkLCBqb3VybmFs\nUG9zKTsKICAgICAgICB9CiAgICAgICAgaW50IGpvdXJuYWxWZXJzaW9uID0g\ncmVjTG9nLmdldEZvcm1hdFZlcnNpb24oKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBCeXRlQnVmZmVyIGxlbkJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9j\nYXRlKDQpOwogICAgICAgICAgICBCeXRlQnVmZmVyIHJlY0J1ZmYgPSBCeXRl\nQnVmZmVyLmFsbG9jYXRlKDY0KjEwMjQpOwogICAgICAgICAgICB3aGlsZSh0\ncnVlKSB7CiAgICAgICAgICAgICAgICAvLyBlbnRyeSBzdGFydCBvZmZzZXQK\nICAgICAgICAgICAgICAgIGxvbmcgb2Zmc2V0ID0gcmVjTG9nLmZjLnBvc2l0\naW9uKCk7CiAgICAgICAgICAgICAgICAvLyBzdGFydCByZWFkaW5nIGVudHJ5\nCiAgICAgICAgICAgICAgICBsZW5CdWZmLmNsZWFyKCk7CiAgICAgICAgICAg\nICAgICBmdWxsUmVhZChyZWNMb2csIGxlbkJ1ZmYpOwogICAgICAgICAgICAg\nICAgaWYgKGxlbkJ1ZmYucmVtYWluaW5nKCkgIT0gMCkgewogICAgICAgICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgbGVuQnVmZi5mbGlwKCk7CiAgICAgICAgICAgICAgICBpbnQgbGVu\nID0gbGVuQnVmZi5nZXRJbnQoKTsKICAgICAgICAgICAgICAgIGlmIChsZW4g\nPT0gMCkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgcmVjQnVmZi5jbGVhcigpOwogICAg\nICAgICAgICAgICAgaWYgKHJlY0J1ZmYucmVtYWluaW5nKCkgPCBsZW4pIHsK\nICAgICAgICAgICAgICAgICAgICByZWNCdWZmID0gQnl0ZUJ1ZmZlci5hbGxv\nY2F0ZShsZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\ncmVjQnVmZi5saW1pdChsZW4pOwogICAgICAgICAgICAgICAgaWYgKGZ1bGxS\nZWFkKHJlY0xvZywgcmVjQnVmZikgIT0gbGVuKSB7CiAgICAgICAgICAgICAg\nICAgICAgLy8gVGhpcyBzZWVtcyBzY2FyeSwgYnV0IGl0IGp1c3QgbWVhbnMg\ndGhhdCB0aGlzIGlzIHdoZXJlIHdlCiAgICAgICAgICAgICAgICAgICAgLy8g\nbGVmdCBvZmYgd3JpdGluZwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmVjQnVmZi5mbGlw\nKCk7CiAgICAgICAgICAgICAgICBzY2FubmVyLnByb2Nlc3Moam91cm5hbFZl\ncnNpb24sIG9mZnNldCwgcmVjQnVmZik7CiAgICAgICAgICAgIH0KICAgICAg\nICB9IGZpbmFsbHkgewogICAgICAgICAgICByZWNMb2cuY2xvc2UoKTsKICAg\nICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBSZXBsYXkgam91cm5hbCBm\naWxlcwogICAgICoKICAgICAqIEBwYXJhbSBzY2FubmVyCiAgICAgKiAgICAg\nICAgICBTY2FubmVyIHRvIHByb2Nlc3MgcmVwbGF5ZWQgZW50cmllcy4KICAg\nICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqLwogICAgcHVibGljIHZv\naWQgcmVwbGF5KEpvdXJuYWxTY2FubmVyIHNjYW5uZXIpIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgZmluYWwgbG9uZyBtYXJrZWRMb2dJZCA9IGxh\nc3RMb2dNYXJrLmdldFR4bkxvZ0lkKCk7CiAgICAgICAgTGlzdDxMb25nPiBs\nb2dzID0gbGlzdEpvdXJuYWxJZHMoam91cm5hbERpcmVjdG9yeSwgbmV3IEpv\ndXJuYWxJZEZpbHRlcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgIHB1YmxpYyBib29sZWFuIGFjY2VwdChsb25nIGpvdXJuYWxJZCkg\newogICAgICAgICAgICAgICAgaWYgKGpvdXJuYWxJZCA8IG1hcmtlZExvZ0lk\nKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAg\nICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICAvLyBsYXN0IGxvZyBtYXJr\nIG1heSBiZSBtaXNzZWQgZHVlIHRvIG5vIHN5bmMgdXAgYmVmb3JlCiAgICAg\nICAgLy8gdmFsaWRhdGUgZmlsdGVyZWQgbG9nIGlkcyBvbmx5IHdoZW4gd2Ug\naGF2ZSBtYXJrZWRMb2dJZAogICAgICAgIGlmIChtYXJrZWRMb2dJZCA+IDAp\nIHsKICAgICAgICAgICAgaWYgKGxvZ3Muc2l6ZSgpID09IDAgfHwgbG9ncy5n\nZXQoMCkgIT0gbWFya2VkTG9nSWQpIHsKICAgICAgICAgICAgICAgIHRocm93\nIG5ldyBJT0V4Y2VwdGlvbigiUmVjb3ZlcnkgbG9nICIgKyBtYXJrZWRMb2dJ\nZCArICIgaXMgbWlzc2luZyIpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGlmIChMT0cuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAg\nICBMT0cuZGVidWcoIlRyeSB0byByZWxheSBqb3VybmFsIGxvZ3MgOiAiICsg\nbG9ncyk7CiAgICAgICAgfQogICAgICAgIC8vIFRPRE86IFdoZW4gcmVhZGlu\nZyBpbiB0aGUgam91cm5hbCBsb2dzIHRoYXQgbmVlZCB0byBiZSBzeW5jZWQs\nIHdlCiAgICAgICAgLy8gc2hvdWxkIHVzZSBCdWZmZXJlZENoYW5uZWxzIGlu\nc3RlYWQgdG8gbWluaW1pemUgdGhlIGFtb3VudCBvZgogICAgICAgIC8vIHN5\nc3RlbSBjYWxscyBkb25lLgogICAgICAgIGZvcihMb25nIGlkOiBsb2dzKSB7\nCiAgICAgICAgICAgIGxvbmcgbG9nUG9zaXRpb24gPSAwTDsKICAgICAgICAg\nICAgaWYoaWQgPT0gbWFya2VkTG9nSWQpIHsKICAgICAgICAgICAgICAgIGxv\nZ1Bvc2l0aW9uID0gbGFzdExvZ01hcmsuZ2V0VHhuTG9nUG9zaXRpb24oKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBzY2FuSm91cm5hbChpZCwgbG9n\nUG9zaXRpb24sIHNjYW5uZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIHJlY29yZCBhbiBhZGQgZW50cnkgb3BlcmF0aW9uIGluIGpvdXJu\nYWwKICAgICAqLwogICAgcHVibGljIHZvaWQgbG9nQWRkRW50cnkoQnl0ZUJ1\nZmZlciBlbnRyeSwgV3JpdGVDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewog\nICAgICAgIGxvbmcgbGVkZ2VySWQgPSBlbnRyeS5nZXRMb25nKCk7CiAgICAg\nICAgbG9uZyBlbnRyeUlkID0gZW50cnkuZ2V0TG9uZygpOwogICAgICAgIGVu\ndHJ5LnJld2luZCgpOwogICAgICAgIHF1ZXVlLmFkZChuZXcgUXVldWVFbnRy\neShlbnRyeSwgbGVkZ2VySWQsIGVudHJ5SWQsIGNiLCBjdHgpKTsKICAgIH0K\nCiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIGpvdXJuYWwgZW50\ncmllcyBxdWV1ZS4KICAgICAqCiAgICAgKiBAcmV0dXJuIGxlbmd0aCBvZiBq\nb3VybmFsIGVudHJ5IHF1ZXVlLgogICAgICovCiAgICBwdWJsaWMgaW50IGdl\ndEpvdXJuYWxRdWV1ZUxlbmd0aCgpIHsKICAgICAgICByZXR1cm4gcXVldWUu\nc2l6ZSgpOwogICAgfQoKICAgIC8qKgogICAgICogQSB0aHJlYWQgdXNlZCBm\nb3IgcGVyc2lzdGluZyBqb3VybmFsIGVudHJpZXMgdG8gam91cm5hbCBmaWxl\ncy4KICAgICAqCiAgICAgKiA8cD4KICAgICAqIEJlc2lkZXMgcGVyc2lzdGlu\nZyBqb3VybmFsIGVudHJpZXMsIGl0IGFsc28gdGFrZXMgcmVzcG9uc2liaWxp\ndHkgb2YKICAgICAqIHJvbGxpbmcgam91cm5hbCBmaWxlcyB3aGVuIGEgam91\ncm5hbCBmaWxlIHJlYWNoZXMgam91cm5hbCBmaWxlIHNpemUKICAgICAqIGxp\nbWl0YXRpb24uCiAgICAgKiA8L3A+CiAgICAgKiA8cD4KICAgICAqIER1cmlu\nZyBqb3VybmFsIHJvbGxpbmcsIGl0IGZpcnN0IGNsb3NlcyB0aGUgd3JpdGlu\nZyBqb3VybmFsLCBnZW5lcmF0ZXMKICAgICAqIG5ldyBqb3VybmFsIGZpbGUg\ndXNpbmcgY3VycmVudCB0aW1lc3RhbXAsIGFuZCBjb250aW51ZSBwZXJzaXN0\nZW5jZSBsb2dpYy4KICAgICAqIFRob3NlIGpvdXJuYWxzIHdpbGwgYmUgZ2Fy\nYmFnZSBjb2xsZWN0ZWQgaW4gU3luY1RocmVhZC4KICAgICAqIDwvcD4KICAg\nICAqIEBzZWUgQm9va2llI1N5bmNUaHJlYWQKICAgICAqLwogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgTGlua2VkTGlz\ndDxRdWV1ZUVudHJ5PiB0b0ZsdXNoID0gbmV3IExpbmtlZExpc3Q8UXVldWVF\nbnRyeT4oKTsKICAgICAgICBCeXRlQnVmZmVyIGxlbkJ1ZmYgPSBCeXRlQnVm\nZmVyLmFsbG9jYXRlKDQpOwogICAgICAgIEpvdXJuYWxDaGFubmVsIGxvZ0Zp\nbGUgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGxvbmcgbG9n\nSWQgPSAwOwogICAgICAgICAgICBCdWZmZXJlZENoYW5uZWwgYmMgPSBudWxs\nOwogICAgICAgICAgICBsb25nIGxhc3RGbHVzaFBvc2l0aW9uID0gMDsKCiAg\nICAgICAgICAgIFF1ZXVlRW50cnkgcWUgPSBudWxsOwogICAgICAgICAgICB3\naGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgLy8gbmV3IGpvdXJuYWwg\nZmlsZSB0byB3cml0ZQogICAgICAgICAgICAgICAgaWYgKG51bGwgPT0gbG9n\nRmlsZSkgewogICAgICAgICAgICAgICAgICAgIGxvZ0lkID0gU3lzdGVtLmN1\ncnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICAgICAgbG9nRmls\nZSA9IG5ldyBKb3VybmFsQ2hhbm5lbChqb3VybmFsRGlyZWN0b3J5LCBsb2dJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgYmMgPSBsb2dGaWxlLmdldEJ1ZmZl\ncmVkQ2hhbm5lbCgpOwoKICAgICAgICAgICAgICAgICAgICBsYXN0Rmx1c2hQ\nb3NpdGlvbiA9IDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAg\nICAgaWYgKHFlID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAo\ndG9GbHVzaC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\ncWUgPSBxdWV1ZS50YWtlKCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgcWUgPSBxdWV1ZS5wb2xsKCk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxZSA9PSBudWxsIHx8IGJj\nLnBvc2l0aW9uKCkgPiBsYXN0Rmx1c2hQb3NpdGlvbiArIDUxMioxMDI0KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL2xvZ0ZpbGUuZm9yY2Uo\nZmFsc2UpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgYmMuZmx1c2go\ndHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0Rmx1c2hQ\nb3NpdGlvbiA9IGJjLnBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsYXN0TG9nTWFyay5zZXRMYXN0TG9nTWFyayhsb2dJZCwgbGFz\ndEZsdXNoUG9zaXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nZm9yIChRdWV1ZUVudHJ5IGUgOiB0b0ZsdXNoKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZS5jYi53cml0ZUNvbXBsZXRlKDAsIGUubGVk\nZ2VySWQsIGUuZW50cnlJZCwgbnVsbCwgZS5jdHgpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndG9GbHVzaC5jbGVhcigpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIGNoZWNrIHdoZXRoZXIgam91cm5hbCBmaWxlIGlzIG92ZXIgZmlsZSBs\naW1pdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJjLnBvc2l0\naW9uKCkgPiBtYXhKb3VybmFsU2l6ZSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGxvZ0ZpbGUuY2xvc2UoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBsb2dGaWxlID0gbnVsbDsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICBpZiAoIXJ1bm5pbmcpIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiSm91cm5hbCBNYW5hZ2VyIGlzIGFza2VkIHRvIHNodXQgZG93\nbiwgcXVpdC4iKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocWUgPT0gbnVsbCkg\neyAvLyBubyBtb3JlIHF1ZXVlIGVudHJ5CiAgICAgICAgICAgICAgICAgICAg\nY29udGludWU7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBs\nZW5CdWZmLmNsZWFyKCk7CiAgICAgICAgICAgICAgICBsZW5CdWZmLnB1dElu\ndChxZS5lbnRyeS5yZW1haW5pbmcoKSk7CiAgICAgICAgICAgICAgICBsZW5C\ndWZmLmZsaXAoKTsKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAg\nICAvLyB3ZSBzaG91bGQgYmUgZG9pbmcgdGhlIGZvbGxvd2luZywgYnV0IHRo\nZW4gd2UgcnVuIG91dCBvZgogICAgICAgICAgICAgICAgLy8gZGlyZWN0IGJ5\ndGUgYnVmZmVycwogICAgICAgICAgICAgICAgLy8gbG9nRmlsZS53cml0ZShu\nZXcgQnl0ZUJ1ZmZlcltdIHsgbGVuQnVmZiwgcWUuZW50cnkgfSk7CiAgICAg\nICAgICAgICAgICBiYy53cml0ZShsZW5CdWZmKTsKICAgICAgICAgICAgICAg\nIGJjLndyaXRlKHFlLmVudHJ5KTsKCiAgICAgICAgICAgICAgICBsb2dGaWxl\nLnByZUFsbG9jSWZOZWVkZWQoKTsKCiAgICAgICAgICAgICAgICB0b0ZsdXNo\nLmFkZChxZSk7CiAgICAgICAgICAgICAgICBxZSA9IG51bGw7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgbG9nRmlsZS5jbG9zZSgpOwogICAgICAgICAg\nICBsb2dGaWxlID0gbnVsbDsKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlv\nbiBpb2UpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJJL08gZXhjZXB0aW9u\nIGluIEpvdXJuYWwgdGhyZWFkISIsIGlvZSk7CiAgICAgICAgfSBjYXRjaCAo\nSW50ZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgTE9HLndh\ncm4oIkpvdXJuYWwgZXhpdHMgd2hlbiBzaHV0dGluZyBkb3duIiwgaWUpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIElPVXRpbHMuY2xvc2Uo\nTE9HLCBsb2dGaWxlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBTaHV0cyBkb3duIHRoZSBqb3VybmFsLgogICAgICovCiAgICBwdWJsaWMg\nc3luY2hyb25pemVkIHZvaWQgc2h1dGRvd24oKSB7CiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgaWYgKCFydW5uaW5nKSB7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcnVubmluZyA9IGZh\nbHNlOwogICAgICAgICAgICB0aGlzLmludGVycnVwdCgpOwogICAgICAgICAg\nICB0aGlzLmpvaW4oKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4\nY2VwdGlvbiBpZSkgewogICAgICAgICAgICBMT0cud2FybigiSW50ZXJydXB0\nZWQgZHVyaW5nIHNodXR0aW5nIGRvd24gam91cm5hbCA6ICIsIGllKTsKICAg\nICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgaW50IGZ1bGxSZWFk\nKEpvdXJuYWxDaGFubmVsIGZjLCBCeXRlQnVmZmVyIGJiKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIGludCB0b3RhbCA9IDA7CiAgICAgICAgd2hp\nbGUoYmIucmVtYWluaW5nKCkgPiAwKSB7CiAgICAgICAgICAgIGludCByYyA9\nIGZjLnJlYWQoYmIpOwogICAgICAgICAgICBpZiAocmMgPD0gMCkgewogICAg\nICAgICAgICAgICAgcmV0dXJuIHRvdGFsOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHRvdGFsICs9IHJjOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\ndG90YWw7CiAgICB9Cn0K\n","encoding":"base64"}

