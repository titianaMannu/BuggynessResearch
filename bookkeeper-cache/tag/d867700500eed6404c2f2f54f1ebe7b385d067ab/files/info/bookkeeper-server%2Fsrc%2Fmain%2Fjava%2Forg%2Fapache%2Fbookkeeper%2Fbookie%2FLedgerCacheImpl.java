{"sha":"c0b8121ae6a9709dc942b6b5a40b1a3e65588f35","node_id":"MDQ6QmxvYjE1NzU5NTY6YzBiODEyMWFlNmE5NzA5ZGM5NDJiNmI1YTQwYjFhM2U2NTU4OGYzNQ==","size":28207,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c0b8121ae6a9709dc942b6b5a40b1a3e65588f35","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5ib29raWU7Cgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0\naWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwpp\nbXBvcnQgamF2YS51dGlsLkNvbXBhcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwu\nSGFzaE1hcDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGph\ndmEudXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLkxpc3Q7Cmlt\ncG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2YS51dGlsLlJhbmRvbTsK\naW1wb3J0IGphdmEudXRpbC5NYXAuRW50cnk7CgppbXBvcnQgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLm1ldGEuTGVkZ2VyTWFuYWdlcjsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRpb247Cmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\nckZhY3Rvcnk7CgovKioKICogSW1wbGVtZW50YXRpb24gb2YgTGVkZ2VyQ2Fj\naGUgaW50ZXJmYWNlLgogKiBUaGlzIGNsYXNzIHNlcnZlcyB0d28gcHVycG9z\nZXMuCiAqLwpwdWJsaWMgY2xhc3MgTGVkZ2VyQ2FjaGVJbXBsIGltcGxlbWVu\ndHMgTGVkZ2VyQ2FjaGUgewogICAgcHJpdmF0ZSBmaW5hbCBzdGF0aWMgTG9n\nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKExlZGdlckRlc2Ny\naXB0b3IuY2xhc3MpOwoKICAgIGZpbmFsIEZpbGUgbGVkZ2VyRGlyZWN0b3Jp\nZXNbXTsKCiAgICBwdWJsaWMgTGVkZ2VyQ2FjaGVJbXBsKFNlcnZlckNvbmZp\nZ3VyYXRpb24gY29uZiwgTGVkZ2VyTWFuYWdlciBhbG0pIHsKICAgICAgICB0\naGlzLmxlZGdlckRpcmVjdG9yaWVzID0gQm9va2llLmdldEN1cnJlbnREaXJl\nY3Rvcmllcyhjb25mLmdldExlZGdlckRpcnMoKSk7CiAgICAgICAgdGhpcy5v\ncGVuRmlsZUxpbWl0ID0gY29uZi5nZXRPcGVuRmlsZUxpbWl0KCk7CiAgICAg\nICAgdGhpcy5wYWdlU2l6ZSA9IGNvbmYuZ2V0UGFnZVNpemUoKTsKICAgICAg\nICB0aGlzLmVudHJpZXNQZXJQYWdlID0gcGFnZVNpemUgLyA4OwoKICAgICAg\nICBpZiAoY29uZi5nZXRQYWdlTGltaXQoKSA8PSAwKSB7CiAgICAgICAgICAg\nIC8vIGFsbG9jYXRlIGhhbGYgb2YgdGhlIG1lbW9yeSB0byB0aGUgcGFnZSBj\nYWNoZQogICAgICAgICAgICB0aGlzLnBhZ2VMaW1pdCA9IChpbnQpKChSdW50\naW1lLmdldFJ1bnRpbWUoKS5tYXhNZW1vcnkoKSAvIDMpIC8gdGhpcy5wYWdl\nU2l6ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5wYWdl\nTGltaXQgPSBjb25mLmdldFBhZ2VMaW1pdCgpOwogICAgICAgIH0KICAgICAg\nICBMT0cuaW5mbygibWF4TWVtb3J5ID0gIiArIFJ1bnRpbWUuZ2V0UnVudGlt\nZSgpLm1heE1lbW9yeSgpKTsKICAgICAgICBMT0cuaW5mbygib3BlbkZpbGVM\naW1pdCBpcyAiICsgb3BlbkZpbGVMaW1pdCArICIsIHBhZ2VTaXplIGlzICIg\nKyBwYWdlU2l6ZSArICIsIHBhZ2VMaW1pdCBpcyAiICsgcGFnZUxpbWl0KTsK\nICAgICAgICBhY3RpdmVMZWRnZXJNYW5hZ2VyID0gYWxtOwogICAgICAgIC8v\nIFJldHJpZXZlIGFsbCBvZiB0aGUgYWN0aXZlIGxlZGdlcnMuCiAgICAgICAg\nZ2V0QWN0aXZlTGVkZ2VycygpOwogICAgfQogICAgLyoqCiAgICAgKiB0aGUg\nbGlzdCBvZiBwb3RlbnRpYWxseSBjbGVhbiBsZWRnZXJzCiAgICAgKi8KICAg\nIExpbmtlZExpc3Q8TG9uZz4gY2xlYW5MZWRnZXJzID0gbmV3IExpbmtlZExp\nc3Q8TG9uZz4oKTsKCiAgICAvKioKICAgICAqIHRoZSBsaXN0IG9mIHBvdGVu\ndGlhbGx5IGRpcnR5IGxlZGdlcnMKICAgICAqLwogICAgTGlua2VkTGlzdDxM\nb25nPiBkaXJ0eUxlZGdlcnMgPSBuZXcgTGlua2VkTGlzdDxMb25nPigpOwoK\nICAgIEhhc2hNYXA8TG9uZywgRmlsZUluZm8+IGZpbGVJbmZvQ2FjaGUgPSBu\nZXcgSGFzaE1hcDxMb25nLCBGaWxlSW5mbz4oKTsKCiAgICBMaW5rZWRMaXN0\nPExvbmc+IG9wZW5MZWRnZXJzID0gbmV3IExpbmtlZExpc3Q8TG9uZz4oKTsK\nCiAgICAvLyBNYW5hZ2UgYWxsIGFjdGl2ZSBsZWRnZXJzIGluIExlZGdlck1h\nbmFnZXIKICAgIC8vIHNvIExlZGdlck1hbmFnZXIgaGFzIGtub3dsZWRnZSB0\nbyBnYXJiYWdlIGNvbGxlY3QgaW5hY3RpdmUvZGVsZXRlZCBsZWRnZXJzCiAg\nICBmaW5hbCBMZWRnZXJNYW5hZ2VyIGFjdGl2ZUxlZGdlck1hbmFnZXI7Cgog\nICAgZmluYWwgaW50IG9wZW5GaWxlTGltaXQ7CiAgICBmaW5hbCBpbnQgcGFn\nZVNpemU7CiAgICBmaW5hbCBpbnQgcGFnZUxpbWl0OwogICAgZmluYWwgaW50\nIGVudHJpZXNQZXJQYWdlOwoKICAgIC8qKgogICAgICogQHJldHVybiBwYWdl\nIHNpemUgdXNlZCBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRQYWdlU2l6ZSgpIHsKICAgICAgICByZXR1cm4gcGFnZVNpemU7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIGVudHJpZXMgcGVyIHBh\nZ2UgdXNlZCBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwogICAgcHVibGljIGlu\ndCBnZXRFbnRyaWVzUGVyUGFnZSgpIHsKICAgICAgICByZXR1cm4gZW50cmll\nc1BlclBhZ2U7CiAgICB9CgogICAgLyoqCiAgICAgKiBAcmV0dXJuIHBhZ2Ug\nbGltaXRhdGlvbiBpbiBsZWRnZXIgY2FjaGUKICAgICAqLwogICAgcHVibGlj\nIGludCBnZXRQYWdlTGltaXQoKSB7CiAgICAgICAgcmV0dXJuIHBhZ2VMaW1p\ndDsKICAgIH0KCiAgICAvLyBUaGUgbnVtYmVyIG9mIHBhZ2VzIHRoYXQgaGF2\nZSBhY3R1YWxseSBiZWVuIHVzZWQKICAgIHByaXZhdGUgaW50IHBhZ2VDb3Vu\ndCA9IDA7CiAgICBIYXNoTWFwPExvbmcsIEhhc2hNYXA8TG9uZyxMZWRnZXJF\nbnRyeVBhZ2U+PiBwYWdlcyA9IG5ldyBIYXNoTWFwPExvbmcsIEhhc2hNYXA8\nTG9uZyxMZWRnZXJFbnRyeVBhZ2U+PigpOwoKICAgIC8qKgogICAgICogQHJl\ndHVybiBudW1iZXIgb2YgcGFnZSB1c2VkIGluIGxlZGdlciBjYWNoZQogICAg\nICovCiAgICBwdWJsaWMgaW50IGdldE51bVVzZWRQYWdlcygpIHsKICAgICAg\nICByZXR1cm4gcGFnZUNvdW50OwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBw\ndXRJbnRvVGFibGUoSGFzaE1hcDxMb25nLCBIYXNoTWFwPExvbmcsTGVkZ2Vy\nRW50cnlQYWdlPj4gdGFibGUsIExlZGdlckVudHJ5UGFnZSBsZXApIHsKICAg\nICAgICBIYXNoTWFwPExvbmcsIExlZGdlckVudHJ5UGFnZT4gbWFwID0gdGFi\nbGUuZ2V0KGxlcC5nZXRMZWRnZXIoKSk7CiAgICAgICAgaWYgKG1hcCA9PSBu\ndWxsKSB7CiAgICAgICAgICAgIG1hcCA9IG5ldyBIYXNoTWFwPExvbmcsIExl\nZGdlckVudHJ5UGFnZT4oKTsKICAgICAgICAgICAgdGFibGUucHV0KGxlcC5n\nZXRMZWRnZXIoKSwgbWFwKTsKICAgICAgICB9CiAgICAgICAgbWFwLnB1dChs\nZXAuZ2V0Rmlyc3RFbnRyeSgpLCBsZXApOwogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIExlZGdlckVudHJ5UGFnZSBnZXRGcm9tVGFibGUoSGFzaE1hcDxM\nb25nLCBIYXNoTWFwPExvbmcsTGVkZ2VyRW50cnlQYWdlPj4gdGFibGUsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExvbmcgbGVkZ2VyLCBMb25nIGZpcnN0RW50cnkpIHsKICAgICAgICBIYXNo\nTWFwPExvbmcsIExlZGdlckVudHJ5UGFnZT4gbWFwID0gdGFibGUuZ2V0KGxl\nZGdlcik7CiAgICAgICAgaWYgKG1hcCAhPSBudWxsKSB7CiAgICAgICAgICAg\nIHJldHVybiBtYXAuZ2V0KGZpcnN0RW50cnkpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gbnVsbDsKICAgIH0KCiAgICBzeW5jaHJvbml6ZWQgcHJpdmF0\nZSBMZWRnZXJFbnRyeVBhZ2UgZ2V0TGVkZ2VyRW50cnlQYWdlKExvbmcgbGVk\nZ2VyLCBMb25nIGZpcnN0RW50cnksIGJvb2xlYW4gb25seURpcnR5KSB7CiAg\nICAgICAgTGVkZ2VyRW50cnlQYWdlIGxlcCA9IGdldEZyb21UYWJsZShwYWdl\ncywgbGVkZ2VyLCBmaXJzdEVudHJ5KTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAob25seURpcnR5ICYmIGxlcC5pc0NsZWFuKCkpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIHJldHVybiBsZXA7CiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAg\nICAgaWYgKGxlcCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBsZXAudXNl\nUGFnZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKiAKICAgICAqIEdyYWIgbGVkZ2VyIGVudHJ5IHBhZ2Ugd2hvc2UgZmlyc3Qg\nZW50cnkgaXMgPGNvZGU+cGFnZUVudHJ5PC9jb2RlPi4KICAgICAqCiAgICAg\nKiBJZiB0aGUgcGFnZSBkb2Vzbid0IGV4aXN0ZWQgYmVmb3JlLCB3ZSBhbGxv\nY2F0ZSBhIG1lbW9yeSBwYWdlLgogICAgICogT3RoZXJ3aXNlLCB3ZSBncmFi\nIGEgY2xlYW4gcGFnZSBhbmQgcmVhZCBpdCBmcm9tIGRpc2suCiAgICAgKgog\nICAgICogQHBhcmFtIGxlZGdlcgogICAgICogICAgICAgICAgTGVkZ2VyIElk\nCiAgICAgKiBAcGFyYW0gcGFnZUVudHJ5CiAgICAgKiAgICAgICAgICBTdGFy\ndCBlbnRyeSBvZiB0aGlzIGVudHJ5IHBhZ2UuCiAgICAgKi8KICAgIHByaXZh\ndGUgTGVkZ2VyRW50cnlQYWdlIGdyYWJMZWRnZXJFbnRyeVBhZ2UobG9uZyBs\nZWRnZXIsIGxvbmcgcGFnZUVudHJ5KSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBncmFiQ2xlYW5QYWdlKGxl\nZGdlciwgcGFnZUVudHJ5KTsKICAgICAgICB0cnkgewogICAgICAgICAgICAv\nLyBzaG91bGQgdXBkYXRlIHBhZ2UgYmVmb3JlIHdlIHB1dCBpdCBpbnRvIHRh\nYmxlCiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB3ZSB3b3VsZCBwdXQgYW4g\nZW1wdHkgcGFnZSBpbiBpdAogICAgICAgICAgICB1cGRhdGVQYWdlKGxlcCk7\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAg\nICAgICBwdXRJbnRvVGFibGUocGFnZXMsIGxlcCk7CiAgICAgICAgICAgIH0g\nICAKICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpZSkgewogICAgICAg\nICAgICAvLyBpZiB3ZSBncmFiIGEgY2xlYW4gcGFnZSwgYnV0IGZhaWxlZCB0\nbyB1cGRhdGUgdGhlIHBhZ2UKICAgICAgICAgICAgLy8gd2UgYXJlIGV4aGF1\nc3RpbmcgdGhlIGNvdW50IG9mIGxlZGdlciBlbnRyeSBwYWdlcy4KICAgICAg\nICAgICAgLy8gc2luY2UgdGhpcyBwYWdlIHdpbGwgYmUgbmV2ZXIgdXNlZCwg\nc28gd2UgbmVlZCB0byBkZWNyZW1lbnQKICAgICAgICAgICAgLy8gcGFnZSBj\nb3VudCBvZiBsZWRnZXIgY2FjaGUuCiAgICAgICAgICAgIGxlcC5yZWxlYXNl\nUGFnZSgpOwogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAg\nICAgICAgICAgICAgIC0tcGFnZUNvdW50OwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHRocm93IGllOyAKICAgICAgICB9ICAgCiAgICAgICAgcmV0dXJu\nIGxlcDsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHB1\ndEVudHJ5T2Zmc2V0KGxvbmcgbGVkZ2VyLCBsb25nIGVudHJ5LCBsb25nIG9m\nZnNldCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpbnQgb2Zmc2V0\nSW5QYWdlID0gKGludCkgKGVudHJ5ICUgZW50cmllc1BlclBhZ2UpOwogICAg\nICAgIC8vIGZpbmQgdGhlIGlkIG9mIHRoZSBmaXJzdCBlbnRyeSBvZiB0aGUg\ncGFnZSB0aGF0IGhhcyB0aGUgZW50cnkKICAgICAgICAvLyB3ZSBhcmUgbG9v\na2luZyBmb3IKICAgICAgICBsb25nIHBhZ2VFbnRyeSA9IGVudHJ5LW9mZnNl\ndEluUGFnZTsKICAgICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gZ2V0TGVk\nZ2VyRW50cnlQYWdlKGxlZGdlciwgcGFnZUVudHJ5LCBmYWxzZSk7CiAgICAg\nICAgaWYgKGxlcCA9PSBudWxsKSB7CiAgICAgICAgICAgIGxlcCA9IGdyYWJM\nZWRnZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50cnkpOyAKICAgICAgICB9\nCiAgICAgICAgaWYgKGxlcCAhPSBudWxsKSB7CiAgICAgICAgICAgIGxlcC5z\nZXRPZmZzZXQob2Zmc2V0LCBvZmZzZXRJblBhZ2UqOCk7CiAgICAgICAgICAg\nIGxlcC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIGxvbmcgZ2V0\nRW50cnlPZmZzZXQobG9uZyBsZWRnZXIsIGxvbmcgZW50cnkpIHRocm93cyBJ\nT0V4Y2VwdGlvbiB7CiAgICAgICAgaW50IG9mZnNldEluUGFnZSA9IChpbnQp\nIChlbnRyeSVlbnRyaWVzUGVyUGFnZSk7CiAgICAgICAgLy8gZmluZCB0aGUg\naWQgb2YgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBwYWdlIHRoYXQgaGFzIHRo\nZSBlbnRyeQogICAgICAgIC8vIHdlIGFyZSBsb29raW5nIGZvcgogICAgICAg\nIGxvbmcgcGFnZUVudHJ5ID0gZW50cnktb2Zmc2V0SW5QYWdlOwogICAgICAg\nIExlZGdlckVudHJ5UGFnZSBsZXAgPSBnZXRMZWRnZXJFbnRyeVBhZ2UobGVk\nZ2VyLCBwYWdlRW50cnksIGZhbHNlKTsKICAgICAgICB0cnkgewogICAgICAg\nICAgICBpZiAobGVwID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxlcCA9\nIGdyYWJMZWRnZXJFbnRyeVBhZ2UobGVkZ2VyLCBwYWdlRW50cnkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBsZXAuZ2V0T2Zmc2V0KG9m\nZnNldEluUGFnZSo4KTsKICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAg\nICBpZiAobGVwICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGxlcC5yZWxl\nYXNlUGFnZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIHN0YXRpYyBmaW5hbCBTdHJpbmcgZ2V0TGVkZ2VyTmFtZShsb25nIGxlZGdl\ncklkKSB7CiAgICAgICAgaW50IHBhcmVudCA9IChpbnQpIChsZWRnZXJJZCAm\nIDB4ZmYpOwogICAgICAgIGludCBncmFuZFBhcmVudCA9IChpbnQpICgobGVk\nZ2VySWQgJiAweGZmMDApID4+IDgpOwogICAgICAgIFN0cmluZ0J1aWxkZXIg\nc2IgPSBuZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIHNiLmFwcGVuZChJ\nbnRlZ2VyLnRvSGV4U3RyaW5nKGdyYW5kUGFyZW50KSk7CiAgICAgICAgc2Iu\nYXBwZW5kKCcvJyk7CiAgICAgICAgc2IuYXBwZW5kKEludGVnZXIudG9IZXhT\ndHJpbmcocGFyZW50KSk7CiAgICAgICAgc2IuYXBwZW5kKCcvJyk7CiAgICAg\nICAgc2IuYXBwZW5kKExvbmcudG9IZXhTdHJpbmcobGVkZ2VySWQpKTsKICAg\nICAgICBzYi5hcHBlbmQoIi5pZHgiKTsKICAgICAgICByZXR1cm4gc2IudG9T\ndHJpbmcoKTsKICAgIH0KCiAgICBzdGF0aWMgZmluYWwgcHJpdmF0ZSBSYW5k\nb20gcmFuZCA9IG5ldyBSYW5kb20oKTsKCiAgICBzdGF0aWMgZmluYWwgcHJp\ndmF0ZSBGaWxlIHBpY2tEaXJzKEZpbGUgZGlyc1tdKSB7CiAgICAgICAgcmV0\ndXJuIGRpcnNbcmFuZC5uZXh0SW50KGRpcnMubGVuZ3RoKV07CiAgICB9Cgog\nICAgRmlsZUluZm8gZ2V0RmlsZUluZm8oTG9uZyBsZWRnZXIsIGJ5dGUgbWFz\ndGVyS2V5W10pIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgc3luY2hy\nb25pemVkKGZpbGVJbmZvQ2FjaGUpIHsKICAgICAgICAgICAgRmlsZUluZm8g\nZmkgPSBmaWxlSW5mb0NhY2hlLmdldChsZWRnZXIpOwogICAgICAgICAgICBp\nZiAoZmkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgRmlsZSBsZiA9IGZp\nbmRJbmRleEZpbGUobGVkZ2VyKTsKICAgICAgICAgICAgICAgIGlmIChsZiA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1hc3RlcktleSA9\nPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBC\nb29raWUuTm9MZWRnZXJFeGNlcHRpb24obGVkZ2VyKTsKICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgRmlsZSBkaXIgPSBwaWNr\nRGlycyhsZWRnZXJEaXJlY3Rvcmllcyk7CiAgICAgICAgICAgICAgICAgICAg\nU3RyaW5nIGxlZGdlck5hbWUgPSBnZXRMZWRnZXJOYW1lKGxlZGdlcik7CiAg\nICAgICAgICAgICAgICAgICAgbGYgPSBuZXcgRmlsZShkaXIsIGxlZGdlck5h\nbWUpOwogICAgICAgICAgICAgICAgICAgIC8vIEEgbmV3IGxlZGdlciBpbmRl\neCBmaWxlIGhhcyBiZWVuIGNyZWF0ZWQgZm9yIHRoaXMgQm9va2llLgogICAg\nICAgICAgICAgICAgICAgIC8vIEFkZCB0aGlzIG5ldyBsZWRnZXIgdG8gdGhl\nIHNldCBvZiBhY3RpdmUgbGVkZ2Vycy4KICAgICAgICAgICAgICAgICAgICBp\nZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgTE9HLmRlYnVnKCJOZXcgbGVkZ2VyIGluZGV4IGZpbGUgY3JlYXRl\nZCBmb3IgbGVkZ2VySWQ6ICIgKyBsZWRnZXIpOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICBhY3RpdmVMZWRnZXJNYW5hZ2Vy\nLmFkZEFjdGl2ZUxlZGdlcihsZWRnZXIsIHRydWUpOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgZXZpY3RGaWxlSW5mb0lmTmVjZXNzYXJ5\nKCk7CiAgICAgICAgICAgICAgICBmaSA9IG5ldyBGaWxlSW5mbyhsZiwgbWFz\ndGVyS2V5KTsKICAgICAgICAgICAgICAgIGZpbGVJbmZvQ2FjaGUucHV0KGxl\nZGdlciwgZmkpOwogICAgICAgICAgICAgICAgb3BlbkxlZGdlcnMuYWRkKGxl\nZGdlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGZpLnVzZSgpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIHJldHVybiBmaTsKICAgICAgICB9CiAgICB9CiAgICBw\ncml2YXRlIHZvaWQgdXBkYXRlUGFnZShMZWRnZXJFbnRyeVBhZ2UgbGVwKSB0\naHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmICghbGVwLmlzQ2xlYW4o\nKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlRyeWlu\nZyB0byB1cGRhdGUgYSBkaXJ0eSBwYWdlIik7CiAgICAgICAgfQogICAgICAg\nIEZpbGVJbmZvIGZpID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAg\nICBmaSA9IGdldEZpbGVJbmZvKGxlcC5nZXRMZWRnZXIoKSwgbnVsbCk7CiAg\nICAgICAgICAgIGxvbmcgcG9zID0gbGVwLmdldEZpcnN0RW50cnkoKSo4Owog\nICAgICAgICAgICBpZiAocG9zID49IGZpLnNpemUoKSkgewogICAgICAgICAg\nICAgICAgbGVwLnplcm9QYWdlKCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAg\nICAgICAgICAgICAgICBsZXAucmVhZFBhZ2UoZmkpOwogICAgICAgICAgICB9\nCiAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgaWYgKGZpICE9IG51\nbGwpIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIGZsdXNoTGVkZ2VyKGJvb2xlYW4gZG9BbGwpIHRocm93cyBJT0V4\nY2VwdGlvbiB7CiAgICAgICAgc3luY2hyb25pemVkKGRpcnR5TGVkZ2Vycykg\newogICAgICAgICAgICBpZiAoZGlydHlMZWRnZXJzLmlzRW1wdHkoKSkgewog\nICAgICAgICAgICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAg\nICAgICAgICAgICBmb3IoTG9uZyBsOiBwYWdlcy5rZXlTZXQoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExPRy50cmFjZSgiQWRk\naW5nICIgKyBMb25nLnRvSGV4U3RyaW5nKGwpICsgIiB0byBkaXJ0eSBwYWdl\ncyIpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIGRpcnR5TGVkZ2Vycy5hZGQobCk7CiAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGlmIChkaXJ0eUxlZGdlcnMuaXNFbXB0eSgpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgd2hp\nbGUoIWRpcnR5TGVkZ2Vycy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAg\nIExvbmcgbCA9IGRpcnR5TGVkZ2Vycy5yZW1vdmVGaXJzdCgpOwoKICAgICAg\nICAgICAgICAgIGZsdXNoTGVkZ2VyKGwpOwoKICAgICAgICAgICAgICAgIGlm\nICghZG9BbGwpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIFlpZWxkLiBpZiB3ZSBh\ncmUgZG9pbmcgYWxsIHRoZSBsZWRnZXJzIHdlIGRvbid0IHdhbnQgdG8gYmxv\nY2sgb3RoZXIgZmx1c2hlcyB0aGF0CiAgICAgICAgICAgICAgICAvLyBuZWVk\nIHRvIGhhcHBlbgogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgICAgICBkaXJ0eUxlZGdlcnMud2FpdCgxKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBqdXN0IHBhc3MgaXQgb24KICAgICAgICAgICAgICAg\nICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogRmx1c2ggYSBzcGVjaWZpZWQgbGVkZ2VyCiAgICAg\nKgogICAgICogQHBhcmFtIGwKICAgICAqICAgICAgICAgIExlZGdlciBJZAog\nICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRl\nIHZvaWQgZmx1c2hMZWRnZXIobG9uZyBsKSB0aHJvd3MgSU9FeGNlcHRpb24g\newogICAgICAgIExpbmtlZExpc3Q8TG9uZz4gZmlyc3RFbnRyeUxpc3Q7CiAg\nICAgICAgc3luY2hyb25pemVkKHRoaXMpIHsKICAgICAgICAgICAgSGFzaE1h\ncDxMb25nLCBMZWRnZXJFbnRyeVBhZ2U+IHBhZ2VNYXAgPSBwYWdlcy5nZXQo\nbCk7CiAgICAgICAgICAgIGlmIChwYWdlTWFwID09IG51bGwgfHwgcGFnZU1h\ncC5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBmaXJzdEVudHJ5TGlzdCA9IG5ldyBMaW5r\nZWRMaXN0PExvbmc+KCk7CiAgICAgICAgICAgIGZvcihNYXAuRW50cnk8TG9u\nZywgTGVkZ2VyRW50cnlQYWdlPiBlbnRyeTogcGFnZU1hcC5lbnRyeVNldCgp\nKSB7CiAgICAgICAgICAgICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gZW50\ncnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChsZXAuaXNDbGVh\nbigpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKExPRy5pc1RyYWNlRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy50cmFjZSgi\nUGFnZSBpcyBjbGVhbiAiICsgbGVwKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBmaXJzdEVudHJ5TGlzdC5hZGQobGVwLmdl\ndEZpcnN0RW50cnkoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIGlmIChmaXJzdEVudHJ5TGlzdC5zaXplKCkgPT0gMCkgewogICAgICAg\nICAgICBMT0cuZGVidWcoIk5vdGhpbmcgdG8gZmx1c2ggZm9yIGxlZGdlciB7\nfS4iLCBsKTsKICAgICAgICAgICAgLy8gbm90aGluZyB0byBkbwogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBOb3cgZmx1c2gg\nYWxsIHRoZSBwYWdlcyBvZiBhIGxlZGdlcgogICAgICAgIExpc3Q8TGVkZ2Vy\nRW50cnlQYWdlPiBlbnRyaWVzID0gbmV3IEFycmF5TGlzdDxMZWRnZXJFbnRy\neVBhZ2U+KGZpcnN0RW50cnlMaXN0LnNpemUoKSk7CiAgICAgICAgRmlsZUlu\nZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZvcihM\nb25nIGZpcnN0RW50cnk6IGZpcnN0RW50cnlMaXN0KSB7CiAgICAgICAgICAg\nICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gZ2V0TGVkZ2VyRW50cnlQYWdl\nKGwsIGZpcnN0RW50cnksIHRydWUpOwogICAgICAgICAgICAgICAgaWYgKGxl\ncCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgZW50cmllcy5hZGQo\nbGVwKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAg\nICAgICBDb2xsZWN0aW9ucy5zb3J0KGVudHJpZXMsIG5ldyBDb21wYXJhdG9y\nPExlZGdlckVudHJ5UGFnZT4oKSB7CiAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIGludCBjb21wYXJl\nKExlZGdlckVudHJ5UGFnZSBvMSwgTGVkZ2VyRW50cnlQYWdlIG8yKSB7CiAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuIChpbnQpKG8xLmdldEZpcnN0RW50\ncnkoKS1vMi5nZXRGaXJzdEVudHJ5KCkpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgQXJyYXlM\naXN0PEludGVnZXI+IHZlcnNpb25zID0gbmV3IEFycmF5TGlzdDxJbnRlZ2Vy\nPihlbnRyaWVzLnNpemUoKSk7CiAgICAgICAgICAgIGZpID0gZ2V0RmlsZUlu\nZm8obCwgbnVsbCk7CiAgICAgICAgICAgIGludCBzdGFydCA9IDA7CiAgICAg\nICAgICAgIGxvbmcgbGFzdE9mZnNldCA9IC0xOwogICAgICAgICAgICBmb3Io\naW50IGkgPSAwOyBpIDwgZW50cmllcy5zaXplKCk7IGkrKykgewogICAgICAg\nICAgICAgICAgdmVyc2lvbnMuYWRkKGksIGVudHJpZXMuZ2V0KGkpLmdldFZl\ncnNpb24oKSk7CiAgICAgICAgICAgICAgICBpZiAobGFzdE9mZnNldCAhPSAt\nMSAmJiAoZW50cmllcy5nZXQoaSkuZ2V0Rmlyc3RFbnRyeSgpIC0gbGFzdE9m\nZnNldCkgIT0gZW50cmllc1BlclBhZ2UpIHsKICAgICAgICAgICAgICAgICAg\nICAvLyBzZW5kIHVwIGEgc2VxdWVudGlhbCBsaXN0CiAgICAgICAgICAgICAg\nICAgICAgaW50IGNvdW50ID0gaSAtIHN0YXJ0OwogICAgICAgICAgICAgICAg\nICAgIGlmIChjb3VudCA9PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy53YXJuKCJDb3VudCBjYW5ub3QgcG9zc2libHkgYmUgemVybyEiKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgd3Jp\ndGVCdWZmZXJzKGwsIGVudHJpZXMsIGZpLCBzdGFydCwgY291bnQpOwogICAg\nICAgICAgICAgICAgICAgIHN0YXJ0ID0gaTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIGxhc3RPZmZzZXQgPSBlbnRyaWVzLmdldChpKS5n\nZXRGaXJzdEVudHJ5KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYg\nKGVudHJpZXMuc2l6ZSgpLXN0YXJ0ID09IDAgJiYgZW50cmllcy5zaXplKCkg\nIT0gMCkgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIk5vdGhpbmcgdG8g\nd3JpdGUsIGJ1dCB0aGVyZSB3ZXJlIGVudHJpZXMhIik7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgd3JpdGVCdWZmZXJzKGwsIGVudHJpZXMsIGZpLCBz\ndGFydCwgZW50cmllcy5zaXplKCktc3RhcnQpOwogICAgICAgICAgICBzeW5j\naHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgZm9yKGludCBpID0g\nMDsgaSA8IGVudHJpZXMuc2l6ZSgpOyBpKyspIHsKICAgICAgICAgICAgICAg\nICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVwID0gZW50cmllcy5nZXQoaSk7CiAg\nICAgICAgICAgICAgICAgICAgbGVwLnNldENsZWFuKHZlcnNpb25zLmdldChp\nKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICBmb3IoTGVkZ2VyRW50cnlQYWdlIGxl\ncDogZW50cmllcykgewogICAgICAgICAgICAgICAgbGVwLnJlbGVhc2VQYWdl\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpICE9IG51bGwp\nIHsKICAgICAgICAgICAgICAgIGZpLnJlbGVhc2UoKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVCdWZm\nZXJzKExvbmcgbGVkZ2VyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBMaXN0PExlZGdlckVudHJ5UGFnZT4gZW50cmllcywgRmlsZUluZm8gZmks\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGludCBzdGFydCwgaW50\nIGNvdW50KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlmIChMT0cu\naXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cudHJhY2UoIldy\naXRpbmcgIiArIGNvdW50ICsgIiBidWZmZXJzIG9mICIgKyBMb25nLnRvSGV4\nU3RyaW5nKGxlZGdlcikpOwogICAgICAgIH0KICAgICAgICBpZiAoY291bnQg\nPT0gMCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAg\nIEJ5dGVCdWZmZXIgYnVmZnNbXSA9IG5ldyBCeXRlQnVmZmVyW2NvdW50XTsK\nICAgICAgICBmb3IoaW50IGogPSAwOyBqIDwgY291bnQ7IGorKykgewogICAg\nICAgICAgICBidWZmc1tqXSA9IGVudHJpZXMuZ2V0KHN0YXJ0K2opLmdldFBh\nZ2VUb1dyaXRlKCk7CiAgICAgICAgICAgIGlmIChlbnRyaWVzLmdldChzdGFy\ndCtqKS5nZXRMZWRnZXIoKSAhPSBsZWRnZXIpIHsKICAgICAgICAgICAgICAg\nIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiV3JpdGluZyB0byAiICsgbGVkZ2Vy\nICsgIiBidXQgcGFnZSBiZWxvbmdzIHRvICIKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIGVudHJpZXMuZ2V0KHN0YXJ0K2opLmdl\ndExlZGdlcigpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBs\nb25nIHRvdGFsV3JpdHRlbiA9IDA7CiAgICAgICAgd2hpbGUoYnVmZnNbYnVm\nZnMubGVuZ3RoLTFdLnJlbWFpbmluZygpID4gMCkgewogICAgICAgICAgICBs\nb25nIHJjID0gZmkud3JpdGUoYnVmZnMsIGVudHJpZXMuZ2V0KHN0YXJ0KzAp\nLmdldEZpcnN0RW50cnkoKSo4KTsKICAgICAgICAgICAgaWYgKHJjIDw9IDAp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiU2hv\ncnQgd3JpdGUgdG8gbGVkZ2VyICIgKyBsZWRnZXIgKyAiIHJjID0gIiArIHJj\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0b3RhbFdyaXR0ZW4gKz0g\ncmM7CiAgICAgICAgfQogICAgICAgIGlmICh0b3RhbFdyaXR0ZW4gIT0gKGxv\nbmcpY291bnQgKiAobG9uZylwYWdlU2l6ZSkgewogICAgICAgICAgICB0aHJv\ndyBuZXcgSU9FeGNlcHRpb24oIlNob3J0IHdyaXRlIHRvIGxlZGdlciAiICsg\nbGVkZ2VyICsgIiB3cm90ZSAiICsgdG90YWxXcml0dGVuCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArICIgZXhwZWN0ZWQgIiArIGNvdW50\nICogcGFnZVNpemUpOwogICAgICAgIH0KICAgIH0KICAgIHByaXZhdGUgTGVk\nZ2VyRW50cnlQYWdlIGdyYWJDbGVhblBhZ2UobG9uZyBsZWRnZXIsIGxvbmcg\nZW50cnkpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGVudHJ5\nICUgZW50cmllc1BlclBhZ2UgIT0gMCkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKGVudHJ5ICsgIiBpcyBub3Qg\nYSBtdWx0aXBsZSBvZiAiICsgZW50cmllc1BlclBhZ2UpOwogICAgICAgIH0K\nICAgICAgICBvdXRlckxvb3A6CiAgICAgICAgd2hpbGUodHJ1ZSkgewogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAg\naWYgKHBhZ2VDb3VudCAgPCBwYWdlTGltaXQpIHsKICAgICAgICAgICAgICAg\nICAgICAvLyBsZXQncyBzZWUgaWYgd2UgY2FuIGFsbG9jYXRlIHNvbWV0aGlu\nZwogICAgICAgICAgICAgICAgICAgIExlZGdlckVudHJ5UGFnZSBsZXAgPSBu\nZXcgTGVkZ2VyRW50cnlQYWdlKHBhZ2VTaXplLCBlbnRyaWVzUGVyUGFnZSk7\nCiAgICAgICAgICAgICAgICAgICAgbGVwLnNldExlZGdlcihsZWRnZXIpOwog\nICAgICAgICAgICAgICAgICAgIGxlcC5zZXRGaXJzdEVudHJ5KGVudHJ5KTsK\nCiAgICAgICAgICAgICAgICAgICAgLy8gbm90ZSwgdGhpcyB3aWxsIG5vdCBi\nbG9jayBzaW5jZSBpdCBpcyBhIG5ldyBwYWdlCiAgICAgICAgICAgICAgICAg\nICAgbGVwLnVzZVBhZ2UoKTsKICAgICAgICAgICAgICAgICAgICBwYWdlQ291\nbnQrKzsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbGVwOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBzeW5jaHJv\nbml6ZWQoY2xlYW5MZWRnZXJzKSB7CiAgICAgICAgICAgICAgICBpZiAoY2xl\nYW5MZWRnZXJzLmlzRW1wdHkoKSkgewogICAgICAgICAgICAgICAgICAgIGZs\ndXNoTGVkZ2VyKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgICBzeW5jaHJv\nbml6ZWQodGhpcykgewogICAgICAgICAgICAgICAgICAgICAgICBmb3IoTG9u\nZyBsOiBwYWdlcy5rZXlTZXQoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgY2xlYW5MZWRnZXJzLmFkZChsKTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAg\nICAgICAgICAgICAgICAgLy8gaWYgbGVkZ2VycyBkZWxldGVkIGJldHdlZW4g\nY2hlY2tpbmcgcGFnZUNvdW50IGFuZCBwdXR0aW5nCiAgICAgICAgICAgICAg\nICAgICAgLy8gbGVkZ2VycyBpbnRvIGNsZWFuTGVkZ2VycyBsaXN0LCB0aGUg\nY2xlYW5MZWRnZXJzIGxpc3Qgd291bGQgYmUgZW1wdHkuCiAgICAgICAgICAg\nICAgICAgICAgLy8gc28gZ2l2ZSBpdCBhIGNoYW5jZSB0byBnbyBiYWNrIHRv\nIGNoZWNrIHBhZ2VDb3VudCBhZ2FpbiBiZWNhdXNlCiAgICAgICAgICAgICAg\nICAgICAgLy8gZGVsZXRlTGVkZ2VyIHdvdWxkIGRlY3JlbWVudCBwYWdlQ291\nbnQgdG8gcmV0dXJuIHRoZSBudW1iZXIgb2YgcGFnZXMKICAgICAgICAgICAg\nICAgICAgICAvLyBvY2N1cGllZCBieSBkZWxldGVkIGxlZGdlcnMuCiAgICAg\nICAgICAgICAgICAgICAgaWYgKGNsZWFuTGVkZ2Vycy5pc0VtcHR5KCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUgb3V0ZXJMb29wOwog\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBMb25n\nIGNsZWFuTGVkZ2VyID0gY2xlYW5MZWRnZXJzLmdldEZpcnN0KCk7CiAgICAg\nICAgICAgICAgICAgICAgTWFwPExvbmcsIExlZGdlckVudHJ5UGFnZT4gbWFw\nID0gcGFnZXMuZ2V0KGNsZWFuTGVkZ2VyKTsKICAgICAgICAgICAgICAgICAg\nICB3aGlsZSAobWFwID09IG51bGwgfHwgbWFwLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBjbGVhbkxlZGdlcnMucmVtb3ZlRmlyc3Qo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNsZWFuTGVkZ2Vycy5p\nc0VtcHR5KCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlIG91dGVyTG9vcDsgCiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgY2xlYW5MZWRnZXIgPSBjbGVhbkxlZGdl\ncnMuZ2V0Rmlyc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWFwID0g\ncGFnZXMuZ2V0KGNsZWFuTGVkZ2VyKTsKICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgSXRlcmF0b3I8TWFwLkVudHJ5PExvbmcs\nIExlZGdlckVudHJ5UGFnZT4+IGl0ID0gbWFwLmVudHJ5U2V0KCkuaXRlcmF0\nb3IoKTsKICAgICAgICAgICAgICAgICAgICBMZWRnZXJFbnRyeVBhZ2UgbGVw\nID0gaXQubmV4dCgpLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAg\nd2hpbGUoKGxlcC5pblVzZSgpIHx8ICFsZXAuaXNDbGVhbigpKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICBpZiAoIWl0Lmhhc05leHQoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm8gY2xlYW4gcGFnZSBmb3Vu\nZCBpbiB0aGlzIGxlZGdlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nY2xlYW5MZWRnZXJzLnJlbW92ZUZpcnN0KCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBjb250aW51ZSBvdXRlckxvb3A7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgbGVwID0gaXQu\nbmV4dCgpLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIGl0LnJlbW92ZSgpOwogICAgICAgICAgICAgICAg\nICAgIGlmIChtYXAuaXNFbXB0eSgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHBhZ2VzLnJlbW92ZShsZXAuZ2V0TGVkZ2VyKCkpOwogICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBsZXAudXNlUGFnZSgp\nOwogICAgICAgICAgICAgICAgICAgIGxlcC56ZXJvUGFnZSgpOwogICAgICAg\nICAgICAgICAgICAgIGxlcC5zZXRMZWRnZXIobGVkZ2VyKTsKICAgICAgICAg\nICAgICAgICAgICBsZXAuc2V0Rmlyc3RFbnRyeShlbnRyeSk7CiAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuIGxlcDsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAg\nIHB1YmxpYyBsb25nIGdldExhc3RFbnRyeShsb25nIGxlZGdlcklkKSB0aHJv\nd3MgSU9FeGNlcHRpb24gewogICAgICAgIGxvbmcgbGFzdEVudHJ5ID0gMDsK\nICAgICAgICAvLyBGaW5kIHRoZSBsYXN0IGVudHJ5IGluIHRoZSBjYWNoZQog\nICAgICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAgIE1hcDxM\nb25nLCBMZWRnZXJFbnRyeVBhZ2U+IG1hcCA9IHBhZ2VzLmdldChsZWRnZXJJ\nZCk7CiAgICAgICAgICAgIGlmIChtYXAgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgZm9yKExlZGdlckVudHJ5UGFnZSBsZXA6IG1hcC52YWx1ZXMoKSkg\newogICAgICAgICAgICAgICAgICAgIGlmIChsZXAuZ2V0Rmlyc3RFbnRyeSgp\nICsgZW50cmllc1BlclBhZ2UgPCBsYXN0RW50cnkpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgIGxlcC51c2VQYWdlKCk7CiAgICAgICAgICAg\nICAgICAgICAgbG9uZyBoaWdoZXN0ID0gbGVwLmdldExhc3RFbnRyeSgpOwog\nICAgICAgICAgICAgICAgICAgIGlmIChoaWdoZXN0ID4gbGFzdEVudHJ5KSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RFbnRyeSA9IGhpZ2hlc3Q7\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxl\ncC5yZWxlYXNlUGFnZSgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBGaWxlSW5mbyBmaSA9IG51bGw7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgZmkgPSBnZXRGaWxlSW5mbyhsZWRn\nZXJJZCwgbnVsbCk7CiAgICAgICAgICAgIGxvbmcgc2l6ZSA9IGZpLnNpemUo\nKTsKICAgICAgICAgICAgLy8gbWFrZSBzdXJlIHRoZSBmaWxlIHNpemUgaXMg\nYWxpZ25lZCB3aXRoIGluZGV4IGVudHJ5IHNpemUKICAgICAgICAgICAgLy8g\nb3RoZXJ3aXNlIHdlIG1heSByZWFkIGluY29ycmV0IGRhdGEKICAgICAgICAg\nICAgaWYgKDAgIT0gc2l6ZSAlIDgpIHsKICAgICAgICAgICAgICAgIExPRy53\nYXJuKCJJbmRleCBmaWxlIG9mIGxlZGdlciB7fSBpcyBub3QgYWxpZ25lZCB3\naXRoIGluZGV4IGVudHJ5IHNpemUuIiwgbGVkZ2VySWQpOwogICAgICAgICAg\nICAgICAgc2l6ZSA9IHNpemUgLSBzaXplICUgODsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAvLyB3ZSBtYXkgbm90IGhhdmUgdGhlIGxhc3QgZW50cnkg\naW4gdGhlIGNhY2hlCiAgICAgICAgICAgIGlmIChzaXplID4gbGFzdEVudHJ5\nKjgpIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVm\nZmVyLmFsbG9jYXRlKGdldFBhZ2VTaXplKCkpOwogICAgICAgICAgICAgICAg\nbG9uZyBwb3NpdGlvbiA9IHNpemUgLSBnZXRQYWdlU2l6ZSgpOwogICAgICAg\nICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewogICAgICAgICAgICAgICAg\nICAgIHBvc2l0aW9uID0gMDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGZpLnJlYWQoYmIsIHBvc2l0aW9uKTsKICAgICAgICAgICAgICAg\nIGJiLmZsaXAoKTsKICAgICAgICAgICAgICAgIGxvbmcgc3RhcnRpbmdFbnRy\neUlkID0gcG9zaXRpb24vODsKICAgICAgICAgICAgICAgIGZvcihpbnQgaSA9\nIGdldEVudHJpZXNQZXJQYWdlKCktMTsgaSA+PSAwOyBpLS0pIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAoYmIuZ2V0TG9uZyhpKjgpICE9IDApIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgaWYgKGxhc3RFbnRyeSA8IHN0YXJ0aW5n\nRW50cnlJZCtpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0\nRW50cnkgPSBzdGFydGluZ0VudHJ5SWQraTsKICAgICAgICAgICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICBpZiAoZmkgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgZmkucmVsZWFzZSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbGFzdEVudHJ5Owog\nICAgfQoKICAgIC8qKgogICAgICogVGhpcyBtZXRob2Qgd2lsbCBsb29rIHdp\ndGhpbiB0aGUgbGVkZ2VyIGRpcmVjdG9yaWVzIGZvciB0aGUgbGVkZ2VyIGlu\nZGV4CiAgICAgKiBmaWxlcy4gVGhhdCB3aWxsIGNvbXByaXNlIHRoZSBzZXQg\nb2YgYWN0aXZlIGxlZGdlcnMgdGhpcyBwYXJ0aWN1bGFyCiAgICAgKiBCb29r\naWVTZXJ2ZXIga25vd3MgYWJvdXQgdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBk\nZWxldGVkIGJ5IHRoZSBCb29rS2VlcGVyCiAgICAgKiBDbGllbnQuIFRoaXMg\naXMgY2FsbGVkIG9ubHkgb25jZSBkdXJpbmcgaW5pdGlhbGl6YXRpb24uCiAg\nICAgKi8KICAgIHByaXZhdGUgdm9pZCBnZXRBY3RpdmVMZWRnZXJzKCkgewog\nICAgICAgIC8vIExlZGdlciBpbmRleCBmaWxlcyBhcmUgc3RvcmVkIGluIGEg\nZmlsZSBoaWVyYXJjaHkgd2l0aCBhIHBhcmVudCBhbmQKICAgICAgICAvLyBn\ncmFuZFBhcmVudCBkaXJlY3RvcnkuIFdlJ2xsIGhhdmUgdG8gZ28gdHdvIGxl\ndmVscyBkZWVwIGludG8gdGhlc2UKICAgICAgICAvLyBkaXJlY3RvcmllcyB0\nbyBmaW5kIHRoZSBpbmRleCBmaWxlcy4KICAgICAgICBmb3IgKEZpbGUgbGVk\nZ2VyRGlyZWN0b3J5IDogbGVkZ2VyRGlyZWN0b3JpZXMpIHsKICAgICAgICAg\nICAgZm9yIChGaWxlIGdyYW5kUGFyZW50IDogbGVkZ2VyRGlyZWN0b3J5Lmxp\nc3RGaWxlcygpKSB7CiAgICAgICAgICAgICAgICBpZiAoZ3JhbmRQYXJlbnQu\naXNEaXJlY3RvcnkoKSkgewogICAgICAgICAgICAgICAgICAgIGZvciAoRmls\nZSBwYXJlbnQgOiBncmFuZFBhcmVudC5saXN0RmlsZXMoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAocGFyZW50LmlzRGlyZWN0b3J5KCkpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoRmlsZSBpbmRleCA6\nIHBhcmVudC5saXN0RmlsZXMoKSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGlmICghaW5kZXguaXNGaWxlKCkgfHwgIWluZGV4LmdldE5h\nbWUoKS5lbmRzV2l0aCgiLmlkeCIpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyBXZSd2ZSBmb3VuZCBhIGxlZGdlciBpbmRleCBmaWxlLiBUaGUgZmls\nZSBuYW1lIGlzIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIEhleFN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGUgbGVkZ2VySWQu\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nIGxlZGdl\ncklkSW5IZXggPSBpbmRleC5nZXROYW1lKCkuc3Vic3RyaW5nKDAsIGluZGV4\nLmdldE5hbWUoKS5sZW5ndGgoKSAtIDQpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGFjdGl2ZUxlZGdlck1hbmFnZXIuYWRkQWN0aXZlTGVk\nZ2VyKExvbmcucGFyc2VMb25nKGxlZGdlcklkSW5IZXgsIDE2KSwgdHJ1ZSk7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiBUaGlzIG1ldGhvZCBpcyBjYWxsZWQgd2hlbmV2ZXIgYSBsZWRn\nZXIgaXMgZGVsZXRlZCBieSB0aGUgQm9va0tlZXBlciBDbGllbnQKICAgICAq\nIGFuZCB3ZSB3YW50IHRvIHJlbW92ZSBhbGwgcmVsZXZhbnQgZGF0YSBmb3Ig\naXQgc3RvcmVkIGluIHRoZSBMZWRnZXJDYWNoZS4KICAgICAqLwogICAgQE92\nZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBkZWxldGVMZWRnZXIobG9uZyBsZWRn\nZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICBpZiAoTE9HLmlz\nRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAgIExPRy5kZWJ1ZygiRGVsZXRp\nbmcgbGVkZ2VySWQ6ICIgKyBsZWRnZXJJZCk7CgogICAgICAgIC8vIHJlbW92\nZSBwYWdlcyBmaXJzdCB0byBhdm9pZCBwYWdlIGZsdXNoZWQgd2hlbiBkZWxl\ndGluZyBmaWxlIGluZm8KICAgICAgICBzeW5jaHJvbml6ZWQodGhpcykgewog\nICAgICAgICAgICBNYXA8TG9uZywgTGVkZ2VyRW50cnlQYWdlPiBscGFnZXMg\nPSBwYWdlcy5yZW1vdmUobGVkZ2VySWQpOwogICAgICAgICAgICBpZiAobnVs\nbCAhPSBscGFnZXMpIHsKICAgICAgICAgICAgICAgIHBhZ2VDb3VudCAtPSBs\ncGFnZXMuc2l6ZSgpOwogICAgICAgICAgICAgICAgaWYgKHBhZ2VDb3VudCA8\nIDApIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlBhZ2UgY291\nbnQgb2YgbGVkZ2VyIGNhY2hlIGhhcyBiZWVuIGRlY3JlbWVudGVkIHRvIGJl\nIGxlc3MgdGhhbiB6ZXJvLiIpOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CiAgICAgICAgfQogICAgICAgIC8vIERlbGV0ZSB0aGUgbGVkZ2Vy\nJ3MgaW5kZXggZmlsZSBhbmQgY2xvc2UgdGhlIEZpbGVJbmZvCiAgICAgICAg\nRmlsZUluZm8gZmkgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGZpID0gZ2V0RmlsZUluZm8obGVkZ2VySWQsIG51bGwpOwogICAgICAgICAg\nICBmaS5jbG9zZShmYWxzZSk7CiAgICAgICAgICAgIGZpLmRlbGV0ZSgpOwog\nICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgIC8vIHNob3VsZCByZWxl\nYXNlIHVzZSBjb3VudAogICAgICAgICAgICAvLyBvdGhlcndpc2UgdGhlIGZp\nbGUgY2hhbm5lbCB3b3VsZCBub3QgYmUgY2xvc2VkLgogICAgICAgICAgICBp\nZiAobnVsbCAhPSBmaSkgewogICAgICAgICAgICAgICAgZmkucmVsZWFzZSgp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBSZW1vdmUg\naXQgZnJvbSB0aGUgYWN0aXZlIGxlZGdlciBtYW5hZ2VyCiAgICAgICAgYWN0\naXZlTGVkZ2VyTWFuYWdlci5yZW1vdmVBY3RpdmVMZWRnZXIobGVkZ2VySWQp\nOwoKICAgICAgICAvLyBOb3cgcmVtb3ZlIGl0IGZyb20gYWxsIHRoZSBvdGhl\nciBsaXN0cyBhbmQgbWFwcy4KICAgICAgICAvLyBUaGVzZSBkYXRhIHN0cnVj\ndHVyZXMgbmVlZCB0byBiZSBzeW5jaHJvbml6ZWQgZmlyc3QgYmVmb3JlIHJl\nbW92aW5nIGVudHJpZXMuCiAgICAgICAgc3luY2hyb25pemVkKGZpbGVJbmZv\nQ2FjaGUpIHsKICAgICAgICAgICAgZmlsZUluZm9DYWNoZS5yZW1vdmUobGVk\nZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6ZWQoY2xlYW5M\nZWRnZXJzKSB7CiAgICAgICAgICAgIGNsZWFuTGVkZ2Vycy5yZW1vdmUobGVk\nZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6ZWQoZGlydHlM\nZWRnZXJzKSB7CiAgICAgICAgICAgIGRpcnR5TGVkZ2Vycy5yZW1vdmUobGVk\nZ2VySWQpOwogICAgICAgIH0KICAgICAgICBzeW5jaHJvbml6ZWQob3Blbkxl\nZGdlcnMpIHsKICAgICAgICAgICAgb3BlbkxlZGdlcnMucmVtb3ZlKGxlZGdl\ncklkKTsKICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBGaWxlIGZpbmRJ\nbmRleEZpbGUobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBTdHJpbmcgbGVkZ2VyTmFtZSA9IGdldExlZGdlck5hbWUobGVk\nZ2VySWQpOwogICAgICAgIGZvcihGaWxlIGQ6IGxlZGdlckRpcmVjdG9yaWVz\nKSB7CiAgICAgICAgICAgIEZpbGUgbGYgPSBuZXcgRmlsZShkLCBsZWRnZXJO\nYW1lKTsKICAgICAgICAgICAgaWYgKGxmLmV4aXN0cygpKSB7CiAgICAgICAg\nICAgICAgICByZXR1cm4gbGY7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgYnl0ZVtdIHJlYWRNYXN0ZXJLZXkobG9uZyBsZWRnZXJJZCkgdGhy\nb3dzIElPRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHN5\nbmNocm9uaXplZChmaWxlSW5mb0NhY2hlKSB7CiAgICAgICAgICAgIEZpbGVJ\nbmZvIGZpID0gZmlsZUluZm9DYWNoZS5nZXQobGVkZ2VySWQpOwogICAgICAg\nICAgICBpZiAoZmkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgRmlsZSBs\nZiA9IGZpbmRJbmRleEZpbGUobGVkZ2VySWQpOwogICAgICAgICAgICAgICAg\naWYgKGxmID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgQm9va2llLk5vTGVkZ2VyRXhjZXB0aW9uKGxlZGdlcklkKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGV2aWN0RmlsZUluZm9JZk5l\nY2Vzc2FyeSgpOyAgICAgICAgCiAgICAgICAgICAgICAgICBmaSA9IG5ldyBG\naWxlSW5mbyhsZiwgbnVsbCk7CiAgICAgICAgICAgICAgICBieXRlW10ga2V5\nID0gZmkuZ2V0TWFzdGVyS2V5KCk7CiAgICAgICAgICAgICAgICBmaWxlSW5m\nb0NhY2hlLnB1dChsZWRnZXJJZCwgZmkpOwogICAgICAgICAgICAgICAgb3Bl\nbkxlZGdlcnMuYWRkKGxlZGdlcklkKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBrZXk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZpLmdl\ndE1hc3RlcktleSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvLyBldmljdCBm\naWxlIGluZm8gaWYgbmVjZXNzYXJ5CiAgICBwcml2YXRlIHZvaWQgZXZpY3RG\naWxlSW5mb0lmTmVjZXNzYXJ5KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAg\nICAgICBpZiAob3BlbkxlZGdlcnMuc2l6ZSgpID4gb3BlbkZpbGVMaW1pdCkg\newogICAgICAgICAgICBsb25nIGxlZGdlclRvUmVtb3ZlID0gb3BlbkxlZGdl\ncnMucmVtb3ZlRmlyc3QoKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdl\nciB7fSBpcyBldmljdGVkIGZyb20gZmlsZSBpbmZvIGNhY2hlLiIsCiAgICAg\nICAgICAgICAgICAgICAgIGxlZGdlclRvUmVtb3ZlKTsKICAgICAgICAgICAg\nZmlsZUluZm9DYWNoZS5yZW1vdmUobGVkZ2VyVG9SZW1vdmUpLmNsb3NlKHRy\ndWUpOwogICAgICAgIH0KICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIHNldE1hc3RlcktleShsb25nIGxlZGdlcklkLCBieXRlW10gbWFz\ndGVyS2V5KSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIEZpbGVJbmZv\nIGZpID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBmaSA9IGdl\ndEZpbGVJbmZvKGxlZGdlcklkLCBtYXN0ZXJLZXkpOwogICAgICAgIH0gZmlu\nYWxseSB7CiAgICAgICAgICAgIGlmIChudWxsICE9IGZpKSB7CiAgICAgICAg\nICAgICAgICBmaS5yZWxlYXNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgYm9vbGVhbiBsZWRn\nZXJFeGlzdHMobG9uZyBsZWRnZXJJZCkgdGhyb3dzIElPRXhjZXB0aW9uIHsK\nICAgICAgICBzeW5jaHJvbml6ZWQoZmlsZUluZm9DYWNoZSkgewogICAgICAg\nICAgICBGaWxlSW5mbyBmaSA9IGZpbGVJbmZvQ2FjaGUuZ2V0KGxlZGdlcklk\nKTsKICAgICAgICAgICAgaWYgKGZpID09IG51bGwpIHsKICAgICAgICAgICAg\nICAgIEZpbGUgbGYgPSBmaW5kSW5kZXhGaWxlKGxlZGdlcklkKTsKICAgICAg\nICAgICAgICAgIGlmIChsZiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIExlZGdlckNhY2hlQmVhbiBnZXRKTVhC\nZWFuKCkgewogICAgICAgIHJldHVybiBuZXcgTGVkZ2VyQ2FjaGVCZWFuKCkg\newogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIFN0\ncmluZyBnZXROYW1lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICJMZWRn\nZXJDYWNoZSI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgYm9vbGVhbiBpc0hpZGRlbigpIHsKICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0\nUGFnZUNvdW50KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIExlZGdlckNh\nY2hlSW1wbC50aGlzLmdldE51bVVzZWRQYWdlcygpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGlu\ndCBnZXRQYWdlU2l6ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBMZWRn\nZXJDYWNoZUltcGwudGhpcy5nZXRQYWdlU2l6ZSgpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIGlu\ndCBnZXRPcGVuRmlsZUxpbWl0KCkgewogICAgICAgICAgICAgICAgcmV0dXJu\nIG9wZW5GaWxlTGltaXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBP\ndmVycmlkZQogICAgICAgICAgICBwdWJsaWMgaW50IGdldFBhZ2VMaW1pdCgp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBMZWRnZXJDYWNoZUltcGwudGhp\ncy5nZXRQYWdlTGltaXQoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyBpbnQgZ2V0TnVtQ2xlYW5M\nZWRnZXJzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGNsZWFuTGVkZ2Vy\ncy5zaXplKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlk\nZQogICAgICAgICAgICBwdWJsaWMgaW50IGdldE51bURpcnR5TGVkZ2Vycygp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBkaXJ0eUxlZGdlcnMuc2l6ZSgp\nOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIGludCBnZXROdW1PcGVuTGVkZ2VycygpIHsKICAgICAg\nICAgICAgICAgIHJldHVybiBvcGVuTGVkZ2Vycy5zaXplKCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9OwogICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVi\nbGljIHZvaWQgY2xvc2UoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAg\nIGZvciAoRW50cnk8TG9uZywgRmlsZUluZm8+IGZpbGVJbmZvIDogZmlsZUlu\nZm9DYWNoZS5lbnRyeVNldCgpKSB7CiAgICAgICAgICAgIEZpbGVJbmZvIHZh\nbHVlID0gZmlsZUluZm8uZ2V0VmFsdWUoKTsKICAgICAgICAgICAgaWYgKHZh\nbHVlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHZhbHVlLmNsb3NlKHRy\ndWUpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

