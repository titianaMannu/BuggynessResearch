{"sha":"8423de9b38d8845e9d2a07c1884ccb0ff9e12f4d","node_id":"MDQ6QmxvYjE1NzU5NTY6ODQyM2RlOWIzOGQ4ODQ1ZTlkMmEwN2MxODg0Y2NiMGZmOWUxMmY0ZA==","size":37683,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8423de9b38d8845e9d2a07c1884ccb0ff9e12f4d","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0Lklu\nZXRTb2NrZXRBZGRyZXNzOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsK\naW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRp\nbC5IYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9y\ndCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJl\nbnQuQ291bnREb3duTGF0Y2g7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5UaW1lVW5pdDsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29u\nZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLk9wZW5DYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFj\nay5SZWFkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkFzeW5jQ2FsbGJhY2suUmVjb3ZlckNhbGxiYWNrOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29rS2VlcGVyLkRpZ2Vz\ndFR5cGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9v\na2tlZXBlckludGVybmFsQ2FsbGJhY2tzLkdlbmVyaWNDYWxsYmFjazsKaW1w\nb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50\nZXJuYWxDYWxsYmFja3MuTXVsdGlDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuUHJvY2Vzc29yOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnBy\nb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNhbGxiYWNr\nOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVBy\nb3RvY29sOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5z\nbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVw\nZXIuQXN5bmNDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVy\nLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLldh\ndGNoZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb24u\nQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLmRhdGEuU3RhdDsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcjsK\nCi8qKgogKiBBZG1pbiBjbGllbnQgZm9yIEJvb2tLZWVwZXIgY2x1c3RlcnMK\nICovCnB1YmxpYyBjbGFzcyBCb29rS2VlcGVyQWRtaW4gewogICAgcHJpdmF0\nZSBzdGF0aWMgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2Vy\nKEJvb2tLZWVwZXJBZG1pbi5jbGFzcyk7CgogICAgc3RhdGljIGZpbmFsIFN0\ncmluZyBDT0xPTiA9ICI6IjsKCiAgICAvLyBaSyBjbGllbnQgaW5zdGFuY2UK\nICAgIHByaXZhdGUgWm9vS2VlcGVyIHprOwogICAgLy8gWksgbGVkZ2VycyBy\nZWxhdGVkIFN0cmluZyBjb25zdGFudHMKICAgIHByaXZhdGUgZmluYWwgU3Ry\naW5nIGJvb2tpZXNQYXRoOwoKICAgIC8vIEJvb2tLZWVwZXIgY2xpZW50IGlu\nc3RhbmNlCiAgICBwcml2YXRlIEJvb2tLZWVwZXIgYmtjOwoKICAgIC8qCiAg\nICAgKiBSYW5kb20gbnVtYmVyIGdlbmVyYXRvciB1c2VkIHRvIGNob29zZSBh\nbiBhdmFpbGFibGUgYm9va2llIHNlcnZlciB0bwogICAgICogcmVwbGljYXRl\nIGRhdGEgZnJvbSBhIGRlYWQgYm9va2llLgogICAgICovCiAgICBwcml2YXRl\nIFJhbmRvbSByYW5kID0gbmV3IFJhbmRvbSgpOwoKICAgIC8qCiAgICAgKiBG\nb3Igbm93LCBhc3N1bWUgdGhhdCBhbGwgbGVkZ2VycyB3ZXJlIGNyZWF0ZWQg\nd2l0aCB0aGUgc2FtZSBEaWdlc3RUeXBlCiAgICAgKiBhbmQgcGFzc3dvcmQu\nIEluIHRoZSBmdXR1cmUsIHRoaXMgYWRtaW4gdG9vbCB3aWxsIG5lZWQgdG8g\na25vdyBmb3IgZWFjaAogICAgICogbGVkZ2VyLCB3aGF0IHdhcyB0aGUgRGln\nZXN0VHlwZSBhbmQgcGFzc3dvcmQgdXNlZCB0byBjcmVhdGUgaXQgYmVmb3Jl\nIGl0CiAgICAgKiBjYW4gb3BlbiBpdC4gVGhlc2UgdmFsdWVzIHdpbGwgY29t\nZSBmcm9tIFN5c3RlbSBwcm9wZXJ0aWVzLCB0aG91Z2ggaGFyZAogICAgICog\nY29kZWQgZGVmYXVsdHMgYXJlIGRlZmluZWQgaGVyZS4KICAgICAqLwogICAg\ncHJpdmF0ZSBEaWdlc3RUeXBlIERJR0VTVF9UWVBFOwogICAgcHJpdmF0ZSBi\neXRlW10gUEFTU1dEOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IgdGhh\ndCB0YWtlcyBpbiBhIFpvb0tlZXBlciBzZXJ2ZXJzIGNvbm5lY3Qgc3RyaW5n\nIHNvIHdlIGtub3cKICAgICAqIGhvdyB0byBjb25uZWN0IHRvIFpvb0tlZXBl\nciB0byByZXRyaWV2ZSBpbmZvcm1hdGlvbiBhYm91dCB0aGUgQm9va0tlZXBl\ncgogICAgICogY2x1c3Rlci4gV2UgbmVlZCB0aGlzIGJlZm9yZSB3ZSBjYW4g\nZG8gYW55IHR5cGUgb2YgYWRtaW4gb3BlcmF0aW9ucyBvbgogICAgICogdGhl\nIEJvb2tLZWVwZXIgY2x1c3Rlci4KICAgICAqCiAgICAgKiBAcGFyYW0gemtT\nZXJ2ZXJzCiAgICAgKiAgICAgICAgICAgIENvbW1hIHNlcGFyYXRlZCBsaXN0\nIG9mIGhvc3RuYW1lOnBvcnQgcGFpcnMgZm9yIHRoZSBab29LZWVwZXIKICAg\nICAqICAgICAgICAgICAgc2VydmVycyBjbHVzdGVyLgogICAgICogQHRocm93\ncyBJT0V4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgdGhyb3dzIHRoaXMg\nZXhjZXB0aW9uIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluc3RhbnRpYXRpbmcg\ndGhlCiAgICAgKiAgICAgICAgICAgICBab29LZWVwZXIgY2xpZW50LgogICAg\nICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgogICAgICogICAgICAg\nICAgICAgVGhyb3dzIHRoaXMgZXhjZXB0aW9uIGlmIHRoZXJlIGlzIGFuIGVy\ncm9yIGluc3RhbnRpYXRpbmcgdGhlCiAgICAgKiAgICAgICAgICAgICBCb29r\nS2VlcGVyIGNsaWVudC4KICAgICAqIEB0aHJvd3MgS2VlcGVyRXhjZXB0aW9u\nCiAgICAgKiAgICAgICAgICAgICBUaHJvd3MgdGhpcyBleGNlcHRpb24gaWYg\ndGhlcmUgaXMgYW4gZXJyb3IgaW5zdGFudGlhdGluZyB0aGUKICAgICAqICAg\nICAgICAgICAgIEJvb2tLZWVwZXIgY2xpZW50LgogICAgICovCiAgICBwdWJs\naWMgQm9va0tlZXBlckFkbWluKFN0cmluZyB6a1NlcnZlcnMpIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEtlZXBlckV4Y2Vw\ndGlvbiB7CiAgICAgICAgdGhpcyhuZXcgQ2xpZW50Q29uZmlndXJhdGlvbigp\nLnNldFprU2VydmVycyh6a1NlcnZlcnMpKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIENvbnN0cnVjdG9yIHRoYXQgdGFrZXMgaW4gYSBjb25maWd1cmF0aW9u\nIG9iamVjdCBzbyB3ZSBrbm93CiAgICAgKiBob3cgdG8gY29ubmVjdCB0byBa\nb29LZWVwZXIgdG8gcmV0cmlldmUgaW5mb3JtYXRpb24gYWJvdXQgdGhlIEJv\nb2tLZWVwZXIKICAgICAqIGNsdXN0ZXIuIFdlIG5lZWQgdGhpcyBiZWZvcmUg\nd2UgY2FuIGRvIGFueSB0eXBlIG9mIGFkbWluIG9wZXJhdGlvbnMgb24KICAg\nICAqIHRoZSBCb29rS2VlcGVyIGNsdXN0ZXIuCiAgICAgKgogICAgICogQHBh\ncmFtIGNvbmYKICAgICAqICAgICAgICAgICBDbGllbnQgQ29uZmlndXJhdGlv\nbiBPYmplY3QKICAgICAqIEB0aHJvd3MgSU9FeGNlcHRpb24KICAgICAqICAg\nICAgICAgICAgIHRocm93cyB0aGlzIGV4Y2VwdGlvbiBpZiB0aGVyZSBpcyBh\nbiBlcnJvciBpbnN0YW50aWF0aW5nIHRoZQogICAgICogICAgICAgICAgICAg\nWm9vS2VlcGVyIGNsaWVudC4KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0ZWRF\neGNlcHRpb24KICAgICAqICAgICAgICAgICAgIFRocm93cyB0aGlzIGV4Y2Vw\ndGlvbiBpZiB0aGVyZSBpcyBhbiBlcnJvciBpbnN0YW50aWF0aW5nIHRoZQog\nICAgICogICAgICAgICAgICAgQm9va0tlZXBlciBjbGllbnQuCiAgICAgKiBA\ndGhyb3dzIEtlZXBlckV4Y2VwdGlvbgogICAgICogICAgICAgICAgICAgVGhy\nb3dzIHRoaXMgZXhjZXB0aW9uIGlmIHRoZXJlIGlzIGFuIGVycm9yIGluc3Rh\nbnRpYXRpbmcgdGhlCiAgICAgKiAgICAgICAgICAgICBCb29rS2VlcGVyIGNs\naWVudC4KICAgICAqLwogICAgcHVibGljIEJvb2tLZWVwZXJBZG1pbihDbGll\nbnRDb25maWd1cmF0aW9uIGNvbmYpIHRocm93cyBJT0V4Y2VwdGlvbiwgSW50\nZXJydXB0ZWRFeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAg\nLy8gQ3JlYXRlIHRoZSBab29LZWVwZXIgY2xpZW50IGluc3RhbmNlCiAgICAg\nICAgZmluYWwgQ291bnREb3duTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3du\nTGF0Y2goMSk7CiAgICAgICAgemsgPSBuZXcgWm9vS2VlcGVyKGNvbmYuZ2V0\nWmtTZXJ2ZXJzKCksIGNvbmYuZ2V0WmtUaW1lb3V0KCksIG5ldyBXYXRjaGVy\nKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAg\nICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICAgICAgaWYg\nKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAg\nTE9HLmRlYnVnKCJQcm9jZXNzOiAiICsgZXZlbnQuZ2V0VHlwZSgpICsgIiAi\nICsgZXZlbnQuZ2V0UGF0aCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmICghbGF0Y2guYXdhaXQo\nY29uZi5nZXRaa1RpbWVvdXQoKSwgVGltZVVuaXQuTUlMTElTRUNPTkRTKQog\nICAgICAgICAgICB8fCAhemsuZ2V0U3RhdGUoKS5pc0Nvbm5lY3RlZCgpKSB7\nCiAgICAgICAgICAgIHRocm93IEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoS2Vl\ncGVyRXhjZXB0aW9uLkNvZGUuQ09OTkVDVElPTkxPU1MpOwogICAgICAgIH0K\nICAgICAgICAvLyBDcmVhdGUgdGhlIGJvb2tpZSBwYXRoCiAgICAgICAgYm9v\na2llc1BhdGggPSBjb25mLmdldFprQXZhaWxhYmxlQm9va2llc1BhdGgoKTsK\nICAgICAgICAvLyBDcmVhdGUgdGhlIEJvb2tLZWVwZXIgY2xpZW50IGluc3Rh\nbmNlCiAgICAgICAgYmtjID0gbmV3IEJvb2tLZWVwZXIoY29uZiwgemspOwoK\nICAgICAgICBESUdFU1RfVFlQRSA9IGNvbmYuZ2V0Qm9va2llUmVjb3ZlcnlE\naWdlc3RUeXBlKCk7CiAgICAgICAgUEFTU1dEID0gY29uZi5nZXRCb29raWVS\nZWNvdmVyeVBhc3N3ZCgpOwogICAgfQoKICAgIC8qKgogICAgICogR3JhY2Vm\ndWxseSByZWxlYXNlIHJlc291cmNlcyB0aGF0IHRoaXMgY2xpZW50IHVzZXMu\nCiAgICAgKgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgog\nICAgICogICAgICAgICAgICAgaWYgdGhlcmUgaXMgYW4gZXJyb3Igc2h1dHRp\nbmcgZG93biB0aGUgY2xpZW50cyB0aGF0IHRoaXMKICAgICAqICAgICAgICAg\nICAgIGNsYXNzIHVzZXMuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNsb3Nl\nKCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBCS0V4Y2VwdGlvbiB7\nCiAgICAgICAgYmtjLmNsb3NlKCk7CiAgICAgICAgemsuY2xvc2UoKTsKICAg\nIH0KCiAgICAvKioKICAgICAqIE1ldGhvZCB0byBnZXQgdGhlIGlucHV0IGxl\nZGdlcidzIGRpZ2VzdCB0eXBlLiBGb3Igbm93LCB0aGlzIGlzIGp1c3QgYQog\nICAgICogcGxhY2Vob2xkZXIgZnVuY3Rpb24gc2luY2UgdGhlcmUgaXMgbm8g\nd2F5IHdlIGNhbiBnZXQgdGhpcyBpbmZvcm1hdGlvbgogICAgICogZWFzaWx5\nLiBJbiB0aGUgZnV0dXJlLCBCb29rS2VlcGVyIHNob3VsZCBzdG9yZSB0aGlz\nIGxlZGdlciBtZXRhZGF0YQogICAgICogc29tZXdoZXJlIHN1Y2ggdGhhdCBh\nbiBhZG1pbiB0b29sIGNhbiBhY2Nlc3MgaXQuCiAgICAgKgogICAgICogQHBh\ncmFtIGxlZGdlcklkCiAgICAgKiAgICAgICAgICAgIExlZGdlcklkIHdlIGFy\nZSByZXRyaWV2aW5nIHRoZSBkaWdlc3RUeXBlIGZvci4KICAgICAqIEByZXR1\ncm4gRGlnZXN0VHlwZSBmb3IgdGhlIGlucHV0IGxlZGdlcgogICAgICovCiAg\nICBwcml2YXRlIERpZ2VzdFR5cGUgZ2V0TGVkZ2VyRGlnZXN0VHlwZShsb25n\nIGxlZGdlcklkKSB7CiAgICAgICAgcmV0dXJuIERJR0VTVF9UWVBFOwogICAg\nfQoKICAgIC8qKgogICAgICogTWV0aG9kIHRvIGdldCB0aGUgaW5wdXQgbGVk\nZ2VyJ3MgcGFzc3dvcmQuIEZvciBub3csIHRoaXMgaXMganVzdCBhCiAgICAg\nKiBwbGFjZWhvbGRlciBmdW5jdGlvbiBzaW5jZSB0aGVyZSBpcyBubyB3YXkg\nd2UgY2FuIGdldCB0aGlzIGluZm9ybWF0aW9uCiAgICAgKiBlYXNpbHkuIElu\nIHRoZSBmdXR1cmUsIEJvb2tLZWVwZXIgc2hvdWxkIHN0b3JlIHRoaXMgbGVk\nZ2VyIG1ldGFkYXRhCiAgICAgKiBzb21ld2hlcmUgc3VjaCB0aGF0IGFuIGFk\nbWluIHRvb2wgY2FuIGFjY2VzcyBpdC4KICAgICAqCiAgICAgKiBAcGFyYW0g\nbGVkZ2VySWQKICAgICAqICAgICAgICAgICAgTGVkZ2VySWQgd2UgYXJlIHJl\ndHJpZXZpbmcgdGhlIHBhc3N3b3JkIGZvci4KICAgICAqIEByZXR1cm4gUGFz\nc3dvcmQgZm9yIHRoZSBpbnB1dCBsZWRnZXIKICAgICAqLwogICAgcHJpdmF0\nZSBieXRlW10gZ2V0TGVkZ2VyUGFzc3dkKGxvbmcgbGVkZ2VySWQpIHsKICAg\nICAgICByZXR1cm4gUEFTU1dEOwogICAgfQoKICAgIC8vIE9iamVjdCB1c2Vk\nIGZvciBjYWxsaW5nIGFzeW5jIG1ldGhvZHMgYW5kIHdhaXRpbmcgZm9yIHRo\nZW0gdG8gY29tcGxldGUuCiAgICBzdGF0aWMgY2xhc3MgU3luY09iamVjdCB7\nCiAgICAgICAgYm9vbGVhbiB2YWx1ZTsKICAgICAgICBpbnQgcmM7CgogICAg\nICAgIHB1YmxpYyBTeW5jT2JqZWN0KCkgewogICAgICAgICAgICB2YWx1ZSA9\nIGZhbHNlOwogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuT0s7\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogU3luY2hyb25vdXMg\nbWV0aG9kIHRvIHJlYnVpbGQgYW5kIHJlY292ZXIgdGhlIGxlZGdlciBmcmFn\nbWVudHMgZGF0YSB0aGF0CiAgICAgKiB3YXMgc3RvcmVkIG9uIHRoZSBzb3Vy\nY2UgYm9va2llLiBUaGF0IGJvb2tpZSBjb3VsZCBoYXZlIGZhaWxlZCBjb21w\nbGV0ZWx5CiAgICAgKiBhbmQgbm93IHRoZSBsZWRnZXIgZGF0YSB0aGF0IHdh\ncyBzdG9yZWQgb24gaXQgaXMgdW5kZXIgcmVwbGljYXRlZC4gQW4KICAgICAq\nIG9wdGlvbmFsIGRlc3RpbmF0aW9uIGJvb2tpZSBzZXJ2ZXIgY291bGQgYmUg\nZ2l2ZW4gaWYgd2Ugd2FudCB0byBjb3B5IGFsbAogICAgICogb2YgdGhlIGxl\nZGdlciBmcmFnbWVudHMgZGF0YSBvbiB0aGUgZmFpbGVkIHNvdXJjZSBib29r\naWUgdG8gaXQuCiAgICAgKiBPdGhlcndpc2UsIHdlIHdpbGwganVzdCByYW5k\nb21seSBkaXN0cmlidXRlIHRoZSBsZWRnZXIgZnJhZ21lbnRzIHRvIHRoZQog\nICAgICogYWN0aXZlIHNldCBvZiBib29raWVzLCBwZXJoYXBzIGJhc2VkIG9u\nIGxvYWQuIEFsbCBab29LZWVwZXIgbGVkZ2VyCiAgICAgKiBtZXRhZGF0YSB3\naWxsIGJlIHVwZGF0ZWQgdG8gcG9pbnQgdG8gdGhlIG5ldyBib29raWUocykg\ndGhhdCBjb250YWluIHRoZQogICAgICogcmVwbGljYXRlZCBsZWRnZXIgZnJh\nZ21lbnRzLgogICAgICoKICAgICAqIEBwYXJhbSBib29raWVTcmMKICAgICAq\nICAgICAgICAgICAgU291cmNlIGJvb2tpZSB0aGF0IGhhZCBhIGZhaWx1cmUu\nIFdlIHdhbnQgdG8gcmVwbGljYXRlIHRoZQogICAgICogICAgICAgICAgICBs\nZWRnZXIgZnJhZ21lbnRzIHRoYXQgd2VyZSBzdG9yZWQgdGhlcmUuCiAgICAg\nKiBAcGFyYW0gYm9va2llRGVzdAogICAgICogICAgICAgICAgICBPcHRpb25h\nbCBkZXN0aW5hdGlvbiBib29raWUgdGhhdCBpZiBwYXNzZWQsIHdlIHdpbGwg\nY29weSBhbGwKICAgICAqICAgICAgICAgICAgb2YgdGhlIGxlZGdlciBmcmFn\nbWVudHMgZnJvbSB0aGUgc291cmNlIGJvb2tpZSBvdmVyIHRvIGl0LgogICAg\nICovCiAgICBwdWJsaWMgdm9pZCByZWNvdmVyQm9va2llRGF0YShmaW5hbCBJ\nbmV0U29ja2V0QWRkcmVzcyBib29raWVTcmMsIGZpbmFsIEluZXRTb2NrZXRB\nZGRyZXNzIGJvb2tpZURlc3QpCiAgICAgICAgICAgIHRocm93cyBJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiwgQktFeGNlcHRpb24gewogICAgICAgIFN5bmNPYmpl\nY3Qgc3luYyA9IG5ldyBTeW5jT2JqZWN0KCk7CiAgICAgICAgLy8gQ2FsbCB0\naGUgYXN5bmMgbWV0aG9kIHRvIHJlY292ZXIgYm9va2llIGRhdGEuCiAgICAg\nICAgYXN5bmNSZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIGJvb2tpZURl\nc3QsIG5ldyBSZWNvdmVyQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCByZWNvdmVyQ29tcGxldGUo\naW50IHJjLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICBMT0cuaW5m\nbygiUmVjb3ZlciBib29raWUgb3BlcmF0aW9uIGNvbXBsZXRlZCB3aXRoIHJj\nOiAiICsgcmMpOwogICAgICAgICAgICAgICAgU3luY09iamVjdCBzeW5jT2Jq\nID0gKFN5bmNPYmplY3QpIGN0eDsKICAgICAgICAgICAgICAgIHN5bmNocm9u\naXplZCAoc3luY09iaikgewogICAgICAgICAgICAgICAgICAgIHN5bmNPYmou\ncmMgPSByYzsKICAgICAgICAgICAgICAgICAgICBzeW5jT2JqLnZhbHVlID0g\ndHJ1ZTsKICAgICAgICAgICAgICAgICAgICBzeW5jT2JqLm5vdGlmeSgpOwog\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwgc3lu\nYyk7CgogICAgICAgIC8vIFdhaXQgZm9yIHRoZSBhc3luYyBtZXRob2QgdG8g\nY29tcGxldGUuCiAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAg\nICAgICAgIHdoaWxlIChzeW5jLnZhbHVlID09IGZhbHNlKSB7CiAgICAgICAg\nICAgICAgICBzeW5jLndhaXQoKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgICAgICBpZiAoc3luYy5yYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSB7\nCiAgICAgICAgICAgIHRocm93IEJLRXhjZXB0aW9uLmNyZWF0ZShzeW5jLnJj\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBBc3luYyBtZXRo\nb2QgdG8gcmVidWlsZCBhbmQgcmVjb3ZlciB0aGUgbGVkZ2VyIGZyYWdtZW50\ncyBkYXRhIHRoYXQgd2FzCiAgICAgKiBzdG9yZWQgb24gdGhlIHNvdXJjZSBi\nb29raWUuIFRoYXQgYm9va2llIGNvdWxkIGhhdmUgZmFpbGVkIGNvbXBsZXRl\nbHkgYW5kCiAgICAgKiBub3cgdGhlIGxlZGdlciBkYXRhIHRoYXQgd2FzIHN0\nb3JlZCBvbiBpdCBpcyB1bmRlciByZXBsaWNhdGVkLiBBbgogICAgICogb3B0\naW9uYWwgZGVzdGluYXRpb24gYm9va2llIHNlcnZlciBjb3VsZCBiZSBnaXZl\nbiBpZiB3ZSB3YW50IHRvIGNvcHkgYWxsCiAgICAgKiBvZiB0aGUgbGVkZ2Vy\nIGZyYWdtZW50cyBkYXRhIG9uIHRoZSBmYWlsZWQgc291cmNlIGJvb2tpZSB0\nbyBpdC4KICAgICAqIE90aGVyd2lzZSwgd2Ugd2lsbCBqdXN0IHJhbmRvbWx5\nIGRpc3RyaWJ1dGUgdGhlIGxlZGdlciBmcmFnbWVudHMgdG8gdGhlCiAgICAg\nKiBhY3RpdmUgc2V0IG9mIGJvb2tpZXMsIHBlcmhhcHMgYmFzZWQgb24gbG9h\nZC4gQWxsIFpvb0tlZXBlciBsZWRnZXIKICAgICAqIG1ldGFkYXRhIHdpbGwg\nYmUgdXBkYXRlZCB0byBwb2ludCB0byB0aGUgbmV3IGJvb2tpZShzKSB0aGF0\nIGNvbnRhaW4gdGhlCiAgICAgKiByZXBsaWNhdGVkIGxlZGdlciBmcmFnbWVu\ndHMuCiAgICAgKgogICAgICogQHBhcmFtIGJvb2tpZVNyYwogICAgICogICAg\nICAgICAgICBTb3VyY2UgYm9va2llIHRoYXQgaGFkIGEgZmFpbHVyZS4gV2Ug\nd2FudCB0byByZXBsaWNhdGUgdGhlCiAgICAgKiAgICAgICAgICAgIGxlZGdl\nciBmcmFnbWVudHMgdGhhdCB3ZXJlIHN0b3JlZCB0aGVyZS4KICAgICAqIEBw\nYXJhbSBib29raWVEZXN0CiAgICAgKiAgICAgICAgICAgIE9wdGlvbmFsIGRl\nc3RpbmF0aW9uIGJvb2tpZSB0aGF0IGlmIHBhc3NlZCwgd2Ugd2lsbCBjb3B5\nIGFsbAogICAgICogICAgICAgICAgICBvZiB0aGUgbGVkZ2VyIGZyYWdtZW50\ncyBmcm9tIHRoZSBzb3VyY2UgYm9va2llIG92ZXIgdG8gaXQuCiAgICAgKiBA\ncGFyYW0gY2IKICAgICAqICAgICAgICAgICAgUmVjb3ZlckNhbGxiYWNrIHRv\nIGludm9rZSBvbmNlIGFsbCBvZiB0aGUgZGF0YSBvbiB0aGUgZGVhZAogICAg\nICogICAgICAgICAgICBib29raWUgaGFzIGJlZW4gcmVjb3ZlcmVkIGFuZCBy\nZXBsaWNhdGVkLgogICAgICogQHBhcmFtIGNvbnRleHQKICAgICAqICAgICAg\nICAgICAgQ29udGV4dCBmb3IgdGhlIFJlY292ZXJDYWxsYmFjayB0byBjYWxs\nLgogICAgICovCiAgICBwdWJsaWMgdm9pZCBhc3luY1JlY292ZXJCb29raWVE\nYXRhKGZpbmFsIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZVNyYywgZmluYWwg\nSW5ldFNvY2tldEFkZHJlc3MgYm9va2llRGVzdCwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgUmVjb3ZlckNhbGxiYWNr\nIGNiLCBmaW5hbCBPYmplY3QgY29udGV4dCkgewogICAgICAgIC8vIFN5bmMg\nWksgdG8gbWFrZSBzdXJlIHdlJ3JlIHJlYWRpbmcgdGhlIGxhdGVzdCBib29r\naWUgZGF0YS4KICAgICAgICB6ay5zeW5jKGJvb2tpZXNQYXRoLCBuZXcgQXN5\nbmNDYWxsYmFjay5Wb2lkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUmVzdWx0KGlu\ndCByYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAg\nICAgIGlmIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIlpLIGVycm9yIHN5bmNpbmc6ICIsIEtl\nZXBlckV4Y2VwdGlvbi5jcmVhdGUoS2VlcGVyRXhjZXB0aW9uLkNvZGUuZ2V0\nKHJjKSwgcGF0aCkpOwogICAgICAgICAgICAgICAgICAgIGNiLnJlY292ZXJD\nb21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLlpLRXhjZXB0aW9uLCBjb250ZXh0\nKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICBnZXRBdmFpbGFibGVCb29raWVzKGJvb2tp\nZVNyYywgYm9va2llRGVzdCwgY2IsIGNvbnRleHQpOwogICAgICAgICAgICB9\nOwogICAgICAgIH0sIG51bGwpOwogICAgfQoKICAgIC8qKgogICAgICogVGhp\ncyBtZXRob2QgYXN5bmNocm9ub3VzbHkgZ2V0cyB0aGUgc2V0IG9mIGF2YWls\nYWJsZSBCb29raWVzIHRoYXQgdGhlCiAgICAgKiBkZWFkIGlucHV0IGJvb2tp\nZSdzIGRhdGEgd2lsbCBiZSBjb3BpZWQgb3ZlciBpbnRvLiBJZiB0aGUgdXNl\nciBwYXNzZWQgaW4KICAgICAqIGEgc3BlY2lmaWMgZGVzdGluYXRpb24gYm9v\na2llLCB0aGVuIGp1c3QgdXNlIHRoYXQgb25lLiBPdGhlcndpc2UsIHdlJ2xs\nCiAgICAgKiByYW5kb21seSBwaWNrIG9uZSBvZiB0aGUgb3RoZXIgYXZhaWxh\nYmxlIGJvb2tpZXMgdG8gdXNlIGZvciBlYWNoIGxlZGdlcgogICAgICogZnJh\nZ21lbnQgd2UgYXJlIHJlcGxpY2F0aW5nLgogICAgICoKICAgICAqIEBwYXJh\nbSBib29raWVTcmMKICAgICAqICAgICAgICAgICAgU291cmNlIGJvb2tpZSB0\naGF0IGhhZCBhIGZhaWx1cmUuIFdlIHdhbnQgdG8gcmVwbGljYXRlIHRoZQog\nICAgICogICAgICAgICAgICBsZWRnZXIgZnJhZ21lbnRzIHRoYXQgd2VyZSBz\ndG9yZWQgdGhlcmUuCiAgICAgKiBAcGFyYW0gYm9va2llRGVzdAogICAgICog\nICAgICAgICAgICBPcHRpb25hbCBkZXN0aW5hdGlvbiBib29raWUgdGhhdCBp\nZiBwYXNzZWQsIHdlIHdpbGwgY29weSBhbGwKICAgICAqICAgICAgICAgICAg\nb2YgdGhlIGxlZGdlciBmcmFnbWVudHMgZnJvbSB0aGUgc291cmNlIGJvb2tp\nZSBvdmVyIHRvIGl0LgogICAgICogQHBhcmFtIGNiCiAgICAgKiAgICAgICAg\nICAgIFJlY292ZXJDYWxsYmFjayB0byBpbnZva2Ugb25jZSBhbGwgb2YgdGhl\nIGRhdGEgb24gdGhlIGRlYWQKICAgICAqICAgICAgICAgICAgYm9va2llIGhh\ncyBiZWVuIHJlY292ZXJlZCBhbmQgcmVwbGljYXRlZC4KICAgICAqIEBwYXJh\nbSBjb250ZXh0CiAgICAgKiAgICAgICAgICAgIENvbnRleHQgZm9yIHRoZSBS\nZWNvdmVyQ2FsbGJhY2sgdG8gY2FsbC4KICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGdldEF2YWlsYWJsZUJvb2tpZXMoZmluYWwgSW5ldFNvY2tldEFkZHJl\nc3MgYm9va2llU3JjLCBmaW5hbCBJbmV0U29ja2V0QWRkcmVzcyBib29raWVE\nZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlu\nYWwgUmVjb3ZlckNhbGxiYWNrIGNiLCBmaW5hbCBPYmplY3QgY29udGV4dCkg\newogICAgICAgIGZpbmFsIExpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGF2YWls\nYWJsZUJvb2tpZXMgPSBuZXcgTGlua2VkTGlzdDxJbmV0U29ja2V0QWRkcmVz\ncz4oKTsKICAgICAgICBpZiAoYm9va2llRGVzdCAhPSBudWxsKSB7CiAgICAg\nICAgICAgIGF2YWlsYWJsZUJvb2tpZXMuYWRkKGJvb2tpZURlc3QpOwogICAg\nICAgICAgICAvLyBOb3cgcG9sbCBaSyB0byBnZXQgdGhlIGFjdGl2ZSBsZWRn\nZXJzCiAgICAgICAgICAgIGdldEFjdGl2ZUxlZGdlcnMoYm9va2llU3JjLCBi\nb29raWVEZXN0LCBjYiwgY29udGV4dCwgYXZhaWxhYmxlQm9va2llcyk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgemsuZ2V0Q2hpbGRyZW4oYm9v\na2llc1BhdGgsIG51bGwsIG5ldyBBc3luY0NhbGxiYWNrLkNoaWxkcmVuQ2Fs\nbGJhY2soKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJp\nbmcgcGF0aCwgT2JqZWN0IGN0eCwgTGlzdDxTdHJpbmc+IGNoaWxkcmVuKSB7\nCiAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFs\ndWUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlpL\nIGVycm9yIGdldHRpbmcgYm9va2llIG5vZGVzOiAiLCBLZWVwZXJFeGNlcHRp\nb24uY3JlYXRlKEtlZXBlckV4Y2VwdGlvbi5Db2RlCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAuZ2V0KHJjKSwgcGF0aCkpOwogICAgICAg\nICAgICAgICAgICAgICAgICBjYi5yZWNvdmVyQ29tcGxldGUoQktFeGNlcHRp\nb24uQ29kZS5aS0V4Y2VwdGlvbiwgY29udGV4dCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgZm9yIChTdHJpbmcgYm9va2llTm9kZSA6IGNoaWxk\ncmVuKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBwYXJ0c1td\nID0gYm9va2llTm9kZS5zcGxpdChDT0xPTik7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIkJvb2tpZSBOb2RlIHJldHJpZXZl\nZCBmcm9tIFpLIGhhcyBpbnZhbGlkIG5hbWUgZm9ybWF0OiAiICsgYm9va2ll\nTm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5yZWNvdmVy\nQ29tcGxldGUoQktFeGNlcHRpb24uQ29kZS5aS0V4Y2VwdGlvbiwgY29udGV4\ndCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nYXZhaWxhYmxlQm9va2llcy5hZGQobmV3IEluZXRTb2NrZXRBZGRyZXNzKHBh\ncnRzWzBdLCBJbnRlZ2VyLnBhcnNlSW50KHBhcnRzWzFdKSkpOwogICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBOb3cgcG9s\nbCBaSyB0byBnZXQgdGhlIGFjdGl2ZSBsZWRnZXJzCiAgICAgICAgICAgICAg\nICAgICAgZ2V0QWN0aXZlTGVkZ2Vycyhib29raWVTcmMsIG51bGwsIGNiLCBj\nb250ZXh0LCBhdmFpbGFibGVCb29raWVzKTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfSwgbnVsbCk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVGhpcyBtZXRob2QgYXN5bmNocm9ub3VzbHkgcG9sbHMgWksg\ndG8gZ2V0IHRoZSBjdXJyZW50IHNldCBvZiBhY3RpdmUKICAgICAqIGxlZGdl\ncnMuIEZyb20gdGhpcywgd2UgY2FuIG9wZW4gZWFjaCBsZWRnZXIgYW5kIGxv\nb2sgYXQgdGhlIG1ldGFkYXRhIHRvCiAgICAgKiBkZXRlcm1pbmUgaWYgYW55\nIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnRzIGZvciBpdCB3ZXJlIHN0b3JlZCBh\ndCB0aGUgZGVhZAogICAgICogaW5wdXQgYm9va2llLgogICAgICoKICAgICAq\nIEBwYXJhbSBib29raWVTcmMKICAgICAqICAgICAgICAgICAgU291cmNlIGJv\nb2tpZSB0aGF0IGhhZCBhIGZhaWx1cmUuIFdlIHdhbnQgdG8gcmVwbGljYXRl\nIHRoZQogICAgICogICAgICAgICAgICBsZWRnZXIgZnJhZ21lbnRzIHRoYXQg\nd2VyZSBzdG9yZWQgdGhlcmUuCiAgICAgKiBAcGFyYW0gYm9va2llRGVzdAog\nICAgICogICAgICAgICAgICBPcHRpb25hbCBkZXN0aW5hdGlvbiBib29raWUg\ndGhhdCBpZiBwYXNzZWQsIHdlIHdpbGwgY29weSBhbGwKICAgICAqICAgICAg\nICAgICAgb2YgdGhlIGxlZGdlciBmcmFnbWVudHMgZnJvbSB0aGUgc291cmNl\nIGJvb2tpZSBvdmVyIHRvIGl0LgogICAgICogQHBhcmFtIGNiCiAgICAgKiAg\nICAgICAgICAgIFJlY292ZXJDYWxsYmFjayB0byBpbnZva2Ugb25jZSBhbGwg\nb2YgdGhlIGRhdGEgb24gdGhlIGRlYWQKICAgICAqICAgICAgICAgICAgYm9v\na2llIGhhcyBiZWVuIHJlY292ZXJlZCBhbmQgcmVwbGljYXRlZC4KICAgICAq\nIEBwYXJhbSBjb250ZXh0CiAgICAgKiAgICAgICAgICAgIENvbnRleHQgZm9y\nIHRoZSBSZWNvdmVyQ2FsbGJhY2sgdG8gY2FsbC4KICAgICAqIEBwYXJhbSBh\ndmFpbGFibGVCb29raWVzCiAgICAgKiAgICAgICAgICAgIExpc3Qgb2YgQm9v\na2llIFNlcnZlcnMgdGhhdCBhcmUgYXZhaWxhYmxlIHRvIHVzZSBmb3IKICAg\nICAqICAgICAgICAgICAgcmVwbGljYXRpbmcgZGF0YSBvbiB0aGUgZmFpbGVk\nIGJvb2tpZS4gVGhpcyBjb3VsZCBjb250YWluIGEKICAgICAqICAgICAgICAg\nICAgc2luZ2xlIGJvb2tpZSBzZXJ2ZXIgaWYgdGhlIHVzZXIgZXhwbGljaXRs\neSBjaG9zZSBhIGJvb2tpZQogICAgICogICAgICAgICAgICBzZXJ2ZXIgdG8g\ncmVwbGljYXRlIGRhdGEgdG8uCiAgICAgKi8KICAgIHByaXZhdGUgdm9pZCBn\nZXRBY3RpdmVMZWRnZXJzKGZpbmFsIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tp\nZVNyYywgZmluYWwgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llRGVzdCwKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIFJlY292ZXJD\nYWxsYmFjayBjYiwgZmluYWwgT2JqZWN0IGNvbnRleHQsIGZpbmFsIExpc3Q8\nSW5ldFNvY2tldEFkZHJlc3M+IGF2YWlsYWJsZUJvb2tpZXMpIHsKICAgICAg\nICAvLyBXcmFwcGVyIGNsYXNzIGFyb3VuZCB0aGUgUmVjb3ZlckNhbGxiYWNr\nIHNvIGl0IGNhbiBiZSB1c2VkCiAgICAgICAgLy8gYXMgdGhlIGZpbmFsIFZv\naWRDYWxsYmFjayB0byBwcm9jZXNzIGxlZGdlcnMKICAgICAgICBjbGFzcyBS\nZWNvdmVyQ2FsbGJhY2tXcmFwcGVyIGltcGxlbWVudHMgQXN5bmNDYWxsYmFj\nay5Wb2lkQ2FsbGJhY2sgewogICAgICAgICAgICBmaW5hbCBSZWNvdmVyQ2Fs\nbGJhY2sgY2I7CgogICAgICAgICAgICBSZWNvdmVyQ2FsbGJhY2tXcmFwcGVy\nKFJlY292ZXJDYWxsYmFjayBjYikgewogICAgICAgICAgICAgICAgdGhpcy5j\nYiA9IGNiOwogICAgICAgICAgICB9CgogICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQgcmMs\nIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICBj\nYi5yZWNvdmVyQ29tcGxldGUocmMsIGN0eCk7CiAgICAgICAgICAgIH0KICAg\nICAgICB9CgogICAgICAgIFByb2Nlc3NvcjxMb25nPiBsZWRnZXJQcm9jZXNz\nb3IgPSBuZXcgUHJvY2Vzc29yPExvbmc+KCkgewogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2VzcyhMb25nIGxl\nZGdlcklkLCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBpdGVyQ2FsbGJh\nY2spIHsKICAgICAgICAgICAgICAgIHJlY292ZXJMZWRnZXIoYm9va2llU3Jj\nLCBsZWRnZXJJZCwgaXRlckNhbGxiYWNrLCBhdmFpbGFibGVCb29raWVzKTsK\nICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgYmtjLmdldExlZGdl\nck1hbmFnZXIoKS5hc3luY1Byb2Nlc3NMZWRnZXJzKAogICAgICAgICAgICBs\nZWRnZXJQcm9jZXNzb3IsIG5ldyBSZWNvdmVyQ2FsbGJhY2tXcmFwcGVyKGNi\nKSwKICAgICAgICAgICAgY29udGV4dCwgQktFeGNlcHRpb24uQ29kZS5PSywg\nQktFeGNlcHRpb24uQ29kZS5MZWRnZXJSZWNvdmVyeUV4Y2VwdGlvbik7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBHZXQgYSBuZXcgcmFuZG9tIGJvb2tpZSwg\nYnV0IGVuc3VyZSB0aGF0IGl0IGlzbid0IG9uZSB0aGF0IGlzIGFscmVhZHkK\nICAgICAqIGluIHRoZSBlbnNlbWJsZSBmb3IgdGhlIGxlZGdlci4KICAgICAq\nLwogICAgcHJpdmF0ZSBJbmV0U29ja2V0QWRkcmVzcyBnZXROZXdCb29raWUo\nZmluYWwgTGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gYm9va2llc0FscmVhZHlJ\nbkVuc2VtYmxlLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGZpbmFsIExpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGF2YWls\nYWJsZUJvb2tpZXMpIAogICAgICAgICAgICB0aHJvd3MgQktFeGNlcHRpb24u\nQktOb3RFbm91Z2hCb29raWVzRXhjZXB0aW9uIHsKICAgICAgICBBcnJheUxp\nc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGNhbmRpZGF0ZXMgPSBuZXcgQXJyYXlM\naXN0PEluZXRTb2NrZXRBZGRyZXNzPigpOwogICAgICAgIGNhbmRpZGF0ZXMu\nYWRkQWxsKGF2YWlsYWJsZUJvb2tpZXMpOwogICAgICAgIGNhbmRpZGF0ZXMu\ncmVtb3ZlQWxsKGJvb2tpZXNBbHJlYWR5SW5FbnNlbWJsZSk7CiAgICAgICAg\naWYgKGNhbmRpZGF0ZXMuc2l6ZSgpID09IDApIHsKICAgICAgICAgICAgdGhy\nb3cgbmV3IEJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlv\nbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gY2FuZGlkYXRlcy5nZXQo\ncmFuZC5uZXh0SW50KGNhbmRpZGF0ZXMuc2l6ZSgpKSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBhc3luY2hyb25vdXNseSByZWNvdmVy\ncyBhIGdpdmVuIGxlZGdlciBpZiBhbnkgb2YgdGhlIGxlZGdlcgogICAgICog\nZW50cmllcyB3ZXJlIHN0b3JlZCBvbiB0aGUgZmFpbGVkIGJvb2tpZS4KICAg\nICAqCiAgICAgKiBAcGFyYW0gYm9va2llU3JjCiAgICAgKiAgICAgICAgICAg\nIFNvdXJjZSBib29raWUgdGhhdCBoYWQgYSBmYWlsdXJlLiBXZSB3YW50IHRv\nIHJlcGxpY2F0ZSB0aGUKICAgICAqICAgICAgICAgICAgbGVkZ2VyIGZyYWdt\nZW50cyB0aGF0IHdlcmUgc3RvcmVkIHRoZXJlLgogICAgICogQHBhcmFtIGxJ\nZAogICAgICogICAgICAgICAgICBMZWRnZXIgaWQgd2Ugd2FudCB0byByZWNv\ndmVyLgogICAgICogQHBhcmFtIGxlZGdlckl0ZXJDYgogICAgICogICAgICAg\nICAgICBJdGVyYXRpb25DYWxsYmFjayB0byBpbnZva2Ugb25jZSB3ZSd2ZSBy\nZWNvdmVyZWQgdGhlIGN1cnJlbnQKICAgICAqICAgICAgICAgICAgbGVkZ2Vy\nLgogICAgICogQHBhcmFtIGF2YWlsYWJsZUJvb2tpZXMKICAgICAqICAgICAg\nICAgICAgTGlzdCBvZiBCb29raWUgU2VydmVycyB0aGF0IGFyZSBhdmFpbGFi\nbGUgdG8gdXNlIGZvcgogICAgICogICAgICAgICAgICByZXBsaWNhdGluZyBk\nYXRhIG9uIHRoZSBmYWlsZWQgYm9va2llLiBUaGlzIGNvdWxkIGNvbnRhaW4g\nYQogICAgICogICAgICAgICAgICBzaW5nbGUgYm9va2llIHNlcnZlciBpZiB0\naGUgdXNlciBleHBsaWNpdGx5IGNob3NlIGEgYm9va2llCiAgICAgKiAgICAg\nICAgICAgIHNlcnZlciB0byByZXBsaWNhdGUgZGF0YSB0by4KICAgICAqLwog\nICAgcHJpdmF0ZSB2b2lkIHJlY292ZXJMZWRnZXIoZmluYWwgSW5ldFNvY2tl\ndEFkZHJlc3MgYm9va2llU3JjLCBmaW5hbCBsb25nIGxJZCwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIEFzeW5jQ2FsbGJhY2suVm9p\nZENhbGxiYWNrIGxlZGdlckl0ZXJDYiwgZmluYWwgTGlzdDxJbmV0U29ja2V0\nQWRkcmVzcz4gYXZhaWxhYmxlQm9va2llcykgewogICAgICAgIGlmIChMT0cu\naXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICBMT0cuZGVidWcoIlJl\nY292ZXJpbmcgbGVkZ2VyIDogIiArIGxJZCk7CiAgICAgICAgfQogICAgICAg\nIC8qCiAgICAgICAgICogRm9yIHRoZSBjdXJyZW50IGxlZGdlciwgb3BlbiBp\ndCB0byByZXRyaWV2ZSB0aGUgTGVkZ2VySGFuZGxlLiBUaGlzCiAgICAgICAg\nICogd2lsbCBjb250YWluIHRoZSBMZWRnZXJNZXRhZGF0YSBpbmRpY2F0aW5n\nIHdoaWNoIGJvb2tpZSBzZXJ2ZXJzIHRoZQogICAgICAgICAqIGxlZGdlciBm\ncmFnbWVudHMgYXJlIHN0b3JlZCBvbi4gQ2hlY2sgaWYgYW55IG9mIHRoZSBs\nZWRnZXIgZnJhZ21lbnRzCiAgICAgICAgICogZm9yIHRoZSBjdXJyZW50IGxl\nZGdlciBhcmUgc3RvcmVkIG9uIHRoZSBpbnB1dCBkZWFkIGJvb2tpZS4KICAg\nICAgICAgKi8KICAgICAgICBmaW5hbCBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUg\nPSBnZXRMZWRnZXJEaWdlc3RUeXBlKGxJZCk7CiAgICAgICAgZmluYWwgYnl0\nZVtdIHBhc3N3ZCA9IGdldExlZGdlclBhc3N3ZChsSWQpOwogICAgICAgIGJr\nYy5hc3luY09wZW5MZWRnZXJOb1JlY292ZXJ5KGxJZCwgZGlnZXN0VHlwZSwg\ncGFzc3dkLCBuZXcgT3BlbkNhbGxiYWNrKCkgewogICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlbkNvbXBsZXRlKGlu\ndCByYywgZmluYWwgTGVkZ2VySGFuZGxlIGxoLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJCSyBlcnJvciBvcGVu\naW5nIGxlZGdlcjogIiArIGxJZCwgQktFeGNlcHRpb24uY3JlYXRlKHJjKSk7\nCiAgICAgICAgICAgICAgICAgICAgbGVkZ2VySXRlckNiLnByb2Nlc3NSZXN1\nbHQocmMsIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBMZWRnZXJN\nZXRhZGF0YSBsbSA9IGxoLmdldExlZGdlck1ldGFkYXRhKCk7CiAgICAgICAg\nICAgICAgICBpZiAoIWxtLmlzQ2xvc2VkKCkgJiYKICAgICAgICAgICAgICAg\nICAgICBsbS5nZXRFbnNlbWJsZXMoKS5zaXplKCkgPiAwKSB7CiAgICAgICAg\nICAgICAgICAgICAgTG9uZyBsYXN0S2V5ID0gbG0uZ2V0RW5zZW1ibGVzKCku\nbGFzdEtleSgpOwogICAgICAgICAgICAgICAgICAgIEFycmF5TGlzdDxJbmV0\nU29ja2V0QWRkcmVzcz4gbGFzdEVuc2VtYmxlID0gbG0uZ2V0RW5zZW1ibGVz\nKCkuZ2V0KGxhc3RLZXkpOwogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBv\ncmlnaW5hbCB3cml0ZSBoYXMgbm90IHJlbW92ZWQgZmF1bHR5IGJvb2tpZSBm\ncm9tCiAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudCBsZWRnZXIgZW5z\nZW1ibGUuIHRvIGF2b2lkIGRhdGEgbG9zcyBpc3N1ZSBpbgogICAgICAgICAg\nICAgICAgICAgIC8vIHRoZSBjYXNlIG9mIGNvbmN1cnJlbnQgdXBkYXRlcyB0\nbyB0aGUgZW5zZW1ibGUgY29tcG9zaXRpb24sCiAgICAgICAgICAgICAgICAg\nICAgLy8gdGhlIHJlY292ZXJ5IHRvb2wgc2hvdWxkIGZpcnN0IGNsb3NlIHRo\nZSBsZWRnZXIKICAgICAgICAgICAgICAgICAgICBpZiAobGFzdEVuc2VtYmxl\nLmNvbnRhaW5zKGJvb2tpZVNyYykpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gY2xvc2Ugb3BlbmVkIG5vbiByZWNvdmVyeSBsZWRnZXIgaGFuZGxl\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIExPRy53YXJuKCJFcnJvciBjbG9zaW5nIG5vbiByZWNv\ndmVyeSBsZWRnZXIgaGFuZGxlIGZvciBsZWRnZXIgIiArIGxJZCwgaWUpOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAg\nICAgIGJrYy5hc3luY09wZW5MZWRnZXIobElkLCBkaWdlc3RUeXBlLCBwYXNz\nd2QsIG5ldyBPcGVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIG9wZW5Db21wbGV0ZShpbnQgbmV3cmMsIGZpbmFsIExl\nZGdlckhhbmRsZSBuZXdsaCwgT2JqZWN0IG5ld2N0eCkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdyYyAhPSBDb2RlLk9LLmlu\ndFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLmVycm9yKCJCSyBlcnJvciBjbG9zZSBsZWRnZXI6ICIgKyBsSWQs\nIEJLRXhjZXB0aW9uLmNyZWF0ZShuZXdyYykpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBsZWRnZXJJdGVyQ2IucHJvY2Vzc1Jlc3Vs\ndChuZXdyYywgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nZG8gcmVjb3ZlcnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBy\nZWNvdmVyTGVkZ2VyKGJvb2tpZVNyYywgbElkLCBsZWRnZXJJdGVyQ2IsIGF2\nYWlsYWJsZUJvb2tpZXMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvKgogICAgICAg\nICAgICAgICAgICogVGhpcyBMaXN0IHN0b3JlcyB0aGUgbGVkZ2VyIGZyYWdt\nZW50cyB0byByZWNvdmVyIGluZGV4ZWQgYnkKICAgICAgICAgICAgICAgICAq\nIHRoZSBzdGFydCBlbnRyeSBJRCBmb3IgdGhlIHJhbmdlLiBUaGUgZW5zZW1i\nbGVzIFRyZWVNYXAgaXMKICAgICAgICAgICAgICAgICAqIGtleWVkIG9mZiB0\naGlzLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBmaW5h\nbCBMaXN0PExvbmc+IGxlZGdlckZyYWdtZW50c1RvUmVjb3ZlciA9IG5ldyBM\naW5rZWRMaXN0PExvbmc+KCk7CiAgICAgICAgICAgICAgICAvKgogICAgICAg\nICAgICAgICAgICogVGhpcyBNYXAgd2lsbCBzdG9yZSB0aGUgc3RhcnQgYW5k\nIGVuZCBlbnRyeSBJRCB2YWx1ZXMgZm9yCiAgICAgICAgICAgICAgICAgKiBl\nYWNoIG9mIHRoZSBsZWRnZXIgZnJhZ21lbnQgcmFuZ2VzLiBUaGUgb25seSBl\neGNlcHRpb24gaXMgdGhlCiAgICAgICAgICAgICAgICAgKiBjdXJyZW50IGFj\ndGl2ZSBmcmFnbWVudCBzaW5jZSBpdCBoYXMgbm8gZW5kIHlldC4gSW4gdGhl\nIGV2ZW50CiAgICAgICAgICAgICAgICAgKiBvZiBhIGJvb2tpZSBmYWlsdXJl\nLCBhIG5ldyBlbnNlbWJsZSBpcyBjcmVhdGVkIHNvIHRoZSBjdXJyZW50CiAg\nICAgICAgICAgICAgICAgKiBlbnNlbWJsZSBzaG91bGQgbm90IGNvbnRhaW4g\ndGhlIGRlYWQgYm9va2llIHdlIGFyZSB0cnlpbmcgdG8KICAgICAgICAgICAg\nICAgICAqIHJlY292ZXIuCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAg\nICAgICAgIE1hcDxMb25nLCBMb25nPiBsZWRnZXJGcmFnbWVudHNSYW5nZSA9\nIG5ldyBIYXNoTWFwPExvbmcsIExvbmc+KCk7CiAgICAgICAgICAgICAgICBM\nb25nIGN1ckVudHJ5SWQgPSBudWxsOwogICAgICAgICAgICAgICAgZm9yIChN\nYXAuRW50cnk8TG9uZywgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPj4g\nZW50cnkgOiBsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygp\nCiAgICAgICAgICAgICAgICAgICAgICAgICAuZW50cnlTZXQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChjdXJFbnRyeUlkICE9IG51bGwpCiAgICAg\nICAgICAgICAgICAgICAgICAgIGxlZGdlckZyYWdtZW50c1JhbmdlLnB1dChj\ndXJFbnRyeUlkLCBlbnRyeS5nZXRLZXkoKSAtIDEpOwogICAgICAgICAgICAg\nICAgICAgIGN1ckVudHJ5SWQgPSBlbnRyeS5nZXRLZXkoKTsKICAgICAgICAg\nICAgICAgICAgICBpZiAoZW50cnkuZ2V0VmFsdWUoKS5jb250YWlucyhib29r\naWVTcmMpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAg\nICAgICAgICAgICAgICAgICAqIEN1cnJlbnQgbGVkZ2VyIGZyYWdtZW50IGhh\ncyBlbnRyaWVzIHN0b3JlZCBvbiB0aGUKICAgICAgICAgICAgICAgICAgICAg\nICAgICogZGVhZCBib29raWUgc28gd2UnbGwgbmVlZCB0byByZWNvdmVyIHRo\nZW0uCiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAg\nICAgICAgICAgICBsZWRnZXJGcmFnbWVudHNUb1JlY292ZXIuYWRkKGVudHJ5\nLmdldEtleSgpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAvLyBhZGQgbGFzdCBlbnNlbWJsZSBv\ndGhlcndpc2UgaWYgdGhlIGZhaWxlZCBib29raWUgZXhpc3RlZCBpbgogICAg\nICAgICAgICAgICAgLy8gdGhlIGxhc3QgZW5zZW1ibGUgb2YgYSBjbG9zZWQg\nbGVkZ2VyLiB0aGUgZW50cmllcyBiZWxvbmdlZCB0bwogICAgICAgICAgICAg\nICAgLy8gbGFzdCBlbnNlbWJsZSB3b3VsZCBub3QgYmUgcmVwbGljYXRlZC4K\nICAgICAgICAgICAgICAgIGlmIChjdXJFbnRyeUlkICE9IG51bGwpIHsKICAg\nICAgICAgICAgICAgICAgICBsZWRnZXJGcmFnbWVudHNSYW5nZS5wdXQoY3Vy\nRW50cnlJZCwgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAg\nKiBTZWUgaWYgdGhpcyBjdXJyZW50IGxlZGdlciBjb250YWlucyBhbnkgbGVk\nZ2VyIGZyYWdtZW50IHRoYXQKICAgICAgICAgICAgICAgICAqIG5lZWRzIHRv\nIGJlIHJlLXJlcGxpY2F0ZWQuIElmIG5vdCwgdGhlbiBqdXN0IGludm9rZSB0\naGUKICAgICAgICAgICAgICAgICAqIG11bHRpQ2FsbGJhY2sgYW5kIHJldHVy\nbi4KICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgaWYgKGxl\nZGdlckZyYWdtZW50c1RvUmVjb3Zlci5zaXplKCkgPT0gMCkgewogICAgICAg\nICAgICAgICAgICAgIGxlZGdlckl0ZXJDYi5wcm9jZXNzUmVzdWx0KEJLRXhj\nZXB0aW9uLkNvZGUuT0ssIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICAvKgogICAgICAgICAgICAgICAgICogTXVsdGljYWxsYmFjayBmb3IgbGVk\nZ2VyLiBPbmNlIGFsbCBmcmFnbWVudHMgZm9yIHRoZSBsZWRnZXIgaGF2ZSBi\nZWVuIHJlY292ZXJlZAogICAgICAgICAgICAgICAgICogdHJpZ2dlciB0aGUg\nbGVkZ2VySXRlckNiCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAg\nICAgIE11bHRpQ2FsbGJhY2sgbGVkZ2VyRnJhZ21lbnRzTWNiCiAgICAgICAg\nICAgICAgICAgICAgPSBuZXcgTXVsdGlDYWxsYmFjayhsZWRnZXJGcmFnbWVu\ndHNUb1JlY292ZXIuc2l6ZSgpLCBsZWRnZXJJdGVyQ2IsIG51bGwsCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlv\nbi5Db2RlLk9LLCBCS0V4Y2VwdGlvbi5Db2RlLkxlZGdlclJlY292ZXJ5RXhj\nZXB0aW9uKTsKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAg\nKiBOb3cgcmVjb3ZlciBhbGwgb2YgdGhlIG5lY2Vzc2FyeSBsZWRnZXIgZnJh\nZ21lbnRzCiAgICAgICAgICAgICAgICAgKiBhc3luY2hyb25vdXNseSB1c2lu\nZyBhIE11bHRpQ2FsbGJhY2sgZm9yIGV2ZXJ5IGZyYWdtZW50LgogICAgICAg\nICAgICAgICAgICovCiAgICAgICAgICAgICAgICBmb3IgKGZpbmFsIExvbmcg\nc3RhcnRFbnRyeUlkIDogbGVkZ2VyRnJhZ21lbnRzVG9SZWNvdmVyKSB7CiAg\nICAgICAgICAgICAgICAgICAgTG9uZyBlbmRFbnRyeUlkID0gbGVkZ2VyRnJh\nZ21lbnRzUmFuZ2UuZ2V0KHN0YXJ0RW50cnlJZCk7CiAgICAgICAgICAgICAg\nICAgICAgSW5ldFNvY2tldEFkZHJlc3MgbmV3Qm9va2llID0gbnVsbDsKICAg\nICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAg\nICBuZXdCb29raWUgPSBnZXROZXdCb29raWUobGguZ2V0TGVkZ2VyTWV0YWRh\ndGEoKS5nZXRFbnNlbWJsZXMoKS5nZXQoc3RhcnRFbnRyeUlkKSwKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF2\nYWlsYWJsZUJvb2tpZXMpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKEJLRXhjZXB0aW9uLkJLTm90RW5vdWdoQm9va2llc0V4Y2VwdGlvbiBia2Up\nIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRzTWNi\nLnByb2Nlc3NSZXN1bHQoQktFeGNlcHRpb24uQ29kZS5Ob3RFbm91Z2hCb29r\naWVzRXhjZXB0aW9uLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCwgbnVsbCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAg\nICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgTE9HLmRlYnVnKCJSZXBsaWNhdGluZyBmcmFnbWVudCBmcm9t\nIFsiICsgc3RhcnRFbnRyeUlkIAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyAiLCIgKyBlbmRFbnRyeUlkICsgIl0gb2YgbGVkZ2VyICIg\nKyBsaC5nZXRJZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArICIgdG8gIiArIG5ld0Jvb2tpZSk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIFNpbmdsZUZyYWdtZW50Q2FsbGJhY2sgY2IgPSBuZXcgU2luZ2xl\nRnJhZ21lbnRDYWxsYmFjaygKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxlZGdlckZyYWdtZW50c01jYiwgbGgsIHN0YXJ0RW50cnlJZCwg\nYm9va2llU3JjLCBuZXdCb29raWUpOwogICAgICAgICAgICAgICAgICAgICAg\nICByZWNvdmVyTGVkZ2VyRnJhZ21lbnQoYm9va2llU3JjLCBsaCwgc3RhcnRF\nbnRyeUlkLCBlbmRFbnRyeUlkLCBjYiwgbmV3Qm9va2llKTsKICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgVGhyZWFkLmN1cnJlbnRUaHJlYWQo\nKS5pbnRlcnJ1cHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJu\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgICAgICB9LCBudWxsKTsKICAgIH0KCiAgICAv\nKioKICAgICAqIFRoaXMgbWV0aG9kIGFzeW5jaHJvbm91c2x5IHJlY292ZXJz\nIGEgbGVkZ2VyIGZyYWdtZW50IHdoaWNoIGlzIGEKICAgICAqIGNvbnRpZ3Vv\ndXMgcG9ydGlvbiBvZiBhIGxlZGdlciB0aGF0IHdhcyBzdG9yZWQgaW4gYW4g\nZW5zZW1ibGUgdGhhdAogICAgICogaW5jbHVkZWQgdGhlIGZhaWxlZCBib29r\naWUuCiAgICAgKgogICAgICogQHBhcmFtIGJvb2tpZVNyYwogICAgICogICAg\nICAgICAgICBTb3VyY2UgYm9va2llIHRoYXQgaGFkIGEgZmFpbHVyZS4gV2Ug\nd2FudCB0byByZXBsaWNhdGUgdGhlCiAgICAgKiAgICAgICAgICAgIGxlZGdl\nciBmcmFnbWVudHMgdGhhdCB3ZXJlIHN0b3JlZCB0aGVyZS4KICAgICAqIEBw\nYXJhbSBsaAogICAgICogICAgICAgICAgICBMZWRnZXJIYW5kbGUgZm9yIHRo\nZSBsZWRnZXIKICAgICAqIEBwYXJhbSBzdGFydEVudHJ5SWQKICAgICAqICAg\nICAgICAgICAgU3RhcnQgZW50cnkgSWQgZm9yIHRoZSBsZWRnZXIgZnJhZ21l\nbnQKICAgICAqIEBwYXJhbSBlbmRFbnRyeUlkCiAgICAgKiAgICAgICAgICAg\nIEVuZCBlbnRyeSBJZCBmb3IgdGhlIGxlZGdlciBmcmFnbWVudAogICAgICog\nQHBhcmFtIGxlZGdlckZyYWdtZW50TWNiCiAgICAgKiAgICAgICAgICAgIE11\nbHRpQ2FsbGJhY2sgdG8gaW52b2tlIG9uY2Ugd2UndmUgcmVjb3ZlcmVkIHRo\nZSBjdXJyZW50CiAgICAgKiAgICAgICAgICAgIGxlZGdlciBmcmFnbWVudC4K\nICAgICAqIEBwYXJhbSBuZXdCb29raWUKICAgICAqICAgICAgICAgICAgTmV3\nIGJvb2tpZSB3ZSB3YW50IHRvIHVzZSB0byByZWNvdmVyIGFuZCByZXBsaWNh\ndGUgdGhlIGxlZGdlcgogICAgICogICAgICAgICAgICBlbnRyaWVzIHRoYXQg\nd2VyZSBzdG9yZWQgb24gdGhlIGZhaWxlZCBib29raWUuCiAgICAgKi8KICAg\nIHByaXZhdGUgdm9pZCByZWNvdmVyTGVkZ2VyRnJhZ21lbnQoZmluYWwgSW5l\ndFNvY2tldEFkZHJlc3MgYm9va2llU3JjLCBmaW5hbCBMZWRnZXJIYW5kbGUg\nbGgsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZp\nbmFsIExvbmcgc3RhcnRFbnRyeUlkLCBmaW5hbCBMb25nIGVuZEVudHJ5SWQs\nIGZpbmFsIFNpbmdsZUZyYWdtZW50Q2FsbGJhY2sgY2IsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIEluZXRTb2NrZXRB\nZGRyZXNzIG5ld0Jvb2tpZSkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoZW5kRW50cnlJZCA9PSBudWxsKSB7CiAgICAgICAg\nICAgIC8qCiAgICAgICAgICAgICAqIElkZWFsbHkgdGhpcyBzaG91bGQgbmV2\nZXIgaGFwcGVuIGlmIGJvb2tpZSBmYWlsdXJlIGlzIHRha2VuIGNhcmUKICAg\nICAgICAgICAgICogb2YgcHJvcGVybHkuIE5vdGhpbmcgd2UgY2FuIGRvIHRo\nb3VnaCBpbiB0aGlzIGNhc2UuCiAgICAgICAgICAgICAqLwogICAgICAgICAg\nICBMT0cud2FybigiRGVhZCBib29raWUgKCIgKyBib29raWVTcmMgKyAiKSBp\ncyBzdGlsbCBwYXJ0IG9mIHRoZSBjdXJyZW50IGFjdGl2ZSBlbnNlbWJsZSBm\nb3IgbGVkZ2VySWQ6ICIKICAgICAgICAgICAgICAgICAgICAgKyBsaC5nZXRJ\nZCgpKTsKICAgICAgICAgICAgY2IucHJvY2Vzc1Jlc3VsdChCS0V4Y2VwdGlv\nbi5Db2RlLk9LLCBudWxsLCBudWxsKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KICAgICAgICBpZiAoc3RhcnRFbnRyeUlkID4gZW5kRW50cnlJ\nZCkgewogICAgICAgICAgICAvLyBmb3Igb3BlbiBsZWRnZXIgd2hpY2ggdGhl\ncmUgaXMgbm8gZW50cnksIHRoZSBzdGFydCBlbnRyeSBpZCBpcyAwLCB0aGUg\nZW5kIGVudHJ5IGlkIGlzIC0xLgogICAgICAgICAgICAvLyB3ZSBjYW4gcmV0\ndXJuIGltbWVkaWF0ZWx5IHRvIHRyaWdnZXIgZm9yd2FyZCByZWFkCiAgICAg\nICAgICAgIGNiLnByb2Nlc3NSZXN1bHQoQktFeGNlcHRpb24uQ29kZS5PSywg\nbnVsbCwgbnVsbCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9Cgog\nICAgICAgIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVzcz4gY3VyRW5zZW1i\nbGUgPSBsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlcygpLmdl\ndChzdGFydEVudHJ5SWQpOwogICAgICAgIGludCBib29raWVJbmRleCA9IDA7\nCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBjdXJFbnNlbWJsZS5zaXpl\nKCk7IGkrKykgewogICAgICAgICAgICBpZiAoY3VyRW5zZW1ibGUuZ2V0KGkp\nLmVxdWFscyhib29raWVTcmMpKSB7CiAgICAgICAgICAgICAgICBib29raWVJ\nbmRleCA9IGk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICAvKgogICAgICAgICAqIExvb3AgdGhyb3Vn\naCBhbGwgZW50cmllcyBpbiB0aGUgY3VycmVudCBsZWRnZXIgZnJhZ21lbnQg\ncmFuZ2UgYW5kCiAgICAgICAgICogZmluZCB0aGUgb25lcyB0aGF0IHdlcmUg\nc3RvcmVkIG9uIHRoZSBkZWFkIGJvb2tpZS4KICAgICAgICAgKi8KICAgICAg\nICBMaXN0PExvbmc+IGVudHJpZXNUb1JlcGxpY2F0ZSA9IG5ldyBMaW5rZWRM\naXN0PExvbmc+KCk7CiAgICAgICAgZm9yIChsb25nIGkgPSBzdGFydEVudHJ5\nSWQ7IGkgPD0gZW5kRW50cnlJZDsgaSsrKSB7CiAgICAgICAgICAgIGlmIChs\naC5nZXREaXN0cmlidXRpb25TY2hlZHVsZSgpLmdldFJlcGxpY2FJbmRleChp\nLCBib29raWVJbmRleCkgPj0gMCkgewogICAgICAgICAgICAgICAgLyoKICAg\nICAgICAgICAgICAgICAqIEN1cnJlbnQgZW50cnkgaXMgc3RvcmVkIG9uIHRo\nZSBkZWFkIGJvb2tpZSBzbyB3ZSdsbCBuZWVkIHRvCiAgICAgICAgICAgICAg\nICAgKiByZWFkIGl0IGFuZCByZXBsaWNhdGUgaXQgdG8gYSBuZXcgYm9va2ll\nLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBlbnRyaWVz\nVG9SZXBsaWNhdGUuYWRkKGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIC8qCiAgICAgICAgICogTm93IGFzeW5jaHJvbm91c2x5IHJlcGxp\nY2F0ZSBhbGwgb2YgdGhlIGVudHJpZXMgZm9yIHRoZSBsZWRnZXIKICAgICAg\nICAgKiBmcmFnbWVudCB0aGF0IHdlcmUgb24gdGhlIGRlYWQgYm9va2llLgog\nICAgICAgICAqLwogICAgICAgIE11bHRpQ2FsbGJhY2sgbGVkZ2VyRnJhZ21l\nbnRFbnRyeU1jYiA9CiAgICAgICAgICAgIG5ldyBNdWx0aUNhbGxiYWNrKGVu\ndHJpZXNUb1JlcGxpY2F0ZS5zaXplKCksIGNiLCBudWxsLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBCS0V4Y2VwdGlvbi5Db2RlLk9LLCBCS0V4\nY2VwdGlvbi5Db2RlLkxlZGdlclJlY292ZXJ5RXhjZXB0aW9uKTsKICAgICAg\nICBmb3IgKGZpbmFsIExvbmcgZW50cnlJZCA6IGVudHJpZXNUb1JlcGxpY2F0\nZSkgewogICAgICAgICAgICByZWNvdmVyTGVkZ2VyRnJhZ21lbnRFbnRyeShl\nbnRyeUlkLCBsaCwgbGVkZ2VyRnJhZ21lbnRFbnRyeU1jYiwgbmV3Qm9va2ll\nKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhv\nZCBhc3luY2hyb25vdXNseSByZWNvdmVycyBhIHNwZWNpZmljIGxlZGdlciBl\nbnRyeSBieSByZWFkaW5nCiAgICAgKiB0aGUgdmFsdWVzIHZpYSB0aGUgQm9v\na0tlZXBlciBDbGllbnQgKHdoaWNoIHdvdWxkIHJlYWQgaXQgZnJvbSB0aGUg\nb3RoZXIKICAgICAqIHJlcGxpY2FzKSBhbmQgdGhlbiB3cml0aW5nIGl0IHRv\nIHRoZSBjaG9zZW4gbmV3IGJvb2tpZS4KICAgICAqCiAgICAgKiBAcGFyYW0g\nZW50cnlJZAogICAgICogICAgICAgICAgICBMZWRnZXIgRW50cnkgSUQgdG8g\ncmVjb3Zlci4KICAgICAqIEBwYXJhbSBsaAogICAgICogICAgICAgICAgICBM\nZWRnZXJIYW5kbGUgZm9yIHRoZSBsZWRnZXIKICAgICAqIEBwYXJhbSBsZWRn\nZXJGcmFnbWVudEVudHJ5TWNiCiAgICAgKiAgICAgICAgICAgIE11bHRpQ2Fs\nbGJhY2sgdG8gaW52b2tlIG9uY2Ugd2UndmUgcmVjb3ZlcmVkIHRoZSBjdXJy\nZW50CiAgICAgKiAgICAgICAgICAgIGxlZGdlciBlbnRyeS4KICAgICAqIEBw\nYXJhbSBuZXdCb29raWUKICAgICAqICAgICAgICAgICAgTmV3IGJvb2tpZSB3\nZSB3YW50IHRvIHVzZSB0byByZWNvdmVyIGFuZCByZXBsaWNhdGUgdGhlIGxl\nZGdlcgogICAgICogICAgICAgICAgICBlbnRyaWVzIHRoYXQgd2VyZSBzdG9y\nZWQgb24gdGhlIGZhaWxlZCBib29raWUuCiAgICAgKi8KICAgIHByaXZhdGUg\ndm9pZCByZWNvdmVyTGVkZ2VyRnJhZ21lbnRFbnRyeShmaW5hbCBMb25nIGVu\ndHJ5SWQsIGZpbmFsIExlZGdlckhhbmRsZSBsaCwKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBBc3luY0NhbGxi\nYWNrLlZvaWRDYWxsYmFjayBsZWRnZXJGcmFnbWVudEVudHJ5TWNiLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFs\nIEluZXRTb2NrZXRBZGRyZXNzIG5ld0Jvb2tpZSkgdGhyb3dzIEludGVycnVw\ndGVkRXhjZXB0aW9uIHsKICAgICAgICAvKgogICAgICAgICAqIFJlYWQgdGhl\nIGxlZGdlciBlbnRyeSB1c2luZyB0aGUgTGVkZ2VySGFuZGxlLiBUaGlzIHdp\nbGwgYWxsb3cgdXMgdG8KICAgICAgICAgKiByZWFkIHRoZSBlbnRyeSBmcm9t\nIG9uZSBvZiB0aGUgb3RoZXIgcmVwbGljYXRlZCBib29raWVzIG90aGVyIHRo\nYW4KICAgICAgICAgKiB0aGUgZGVhZCBvbmUuCiAgICAgICAgICovCiAgICAg\nICAgbGguYXN5bmNSZWFkRW50cmllcyhlbnRyeUlkLCBlbnRyeUlkLCBuZXcg\nUmVhZENhbGxiYWNrKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgcHVibGljIHZvaWQgcmVhZENvbXBsZXRlKGludCByYywgTGVkZ2Vy\nSGFuZGxlIGxoLCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gc2VxLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29kZS5PSy5p\nbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJC\nSyBlcnJvciByZWFkaW5nIGxlZGdlciBlbnRyeTogIiArIGVudHJ5SWQsIEJL\nRXhjZXB0aW9uLmNyZWF0ZShyYykpOwogICAgICAgICAgICAgICAgICAgIGxl\nZGdlckZyYWdtZW50RW50cnlNY2IucHJvY2Vzc1Jlc3VsdChyYywgbnVsbCwg\nbnVsbCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAq\nIE5vdyB0aGF0IHdlJ3ZlIHJlYWQgdGhlIGxlZGdlciBlbnRyeSwgd3JpdGUg\naXQgdG8gdGhlIG5ldwogICAgICAgICAgICAgICAgICogYm9va2llIHdlJ3Zl\nIHNlbGVjdGVkLgogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAg\nICBMZWRnZXJFbnRyeSBlbnRyeSA9IHNlcS5uZXh0RWxlbWVudCgpOwogICAg\nICAgICAgICAgICAgYnl0ZVtdIGRhdGEgPSBlbnRyeS5nZXRFbnRyeSgpOwog\nICAgICAgICAgICAgICAgQ2hhbm5lbEJ1ZmZlciB0b1NlbmQgPSBsaC5nZXRE\naWdlc3RNYW5hZ2VyKCkuY29tcHV0ZURpZ2VzdEFuZFBhY2thZ2VGb3JTZW5k\naW5nKGVudHJ5SWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxoLmdldExhc3RBZGRDb25maXJtZWQoKSwgZW50cnkuZ2V0TGVu\nZ3RoKCksIGRhdGEsIDAsIGRhdGEubGVuZ3RoKTsKICAgICAgICAgICAgICAg\nIGJrYy5nZXRCb29raWVDbGllbnQoKS5hZGRFbnRyeShuZXdCb29raWUsIGxo\nLmdldElkKCksIGxoLmdldExlZGdlcktleSgpLCBlbnRyeUlkLCB0b1NlbmQs\nCiAgICAgICAgICAgICAgICBuZXcgV3JpdGVDYWxsYmFjaygpIHsKICAgICAg\nICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCB3cml0ZUNvbXBsZXRlKGludCByYywgbG9uZyBsZWRnZXJJ\nZCwgbG9uZyBlbnRyeUlkLCBJbmV0U29ja2V0QWRkcmVzcyBhZGRyLAogICAg\nICAgICAgICAgICAgICAgIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHJjICE9IENvZGUuT0suaW50VmFsdWUoKSkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJCSyBlcnJvciB3\ncml0aW5nIGVudHJ5IGZvciBsZWRnZXJJZDogIiArIGxlZGdlcklkICsgIiwg\nZW50cnlJZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICsgZW50cnlJZCArICIsIGJvb2tpZTogIiArIGFkZHIsIEJLRXhjZXB0\naW9uLmNyZWF0ZShyYykpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKExPRy5pc0Rl\nYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgTE9HLmRlYnVnKCJTdWNjZXNzIHdyaXRpbmcgbGVkZ2VyIGlkICIgK2xl\nZGdlcklkICsgIiwgZW50cnkgaWQgIgogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArIGVudHJ5SWQgKyAiIHRvIGEgbmV3IGJv\nb2tpZSAiICsgYWRkciArICIhIik7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAgICAgICAgICogUGFz\ncyB0aGUgcmV0dXJuIGNvZGUgcmVzdWx0IHVwIHRoZSBjaGFpbiB3aXRoCiAg\nICAgICAgICAgICAgICAgICAgICAgICAqIHRoZSBwYXJlbnQgY2FsbGJhY2su\nCiAgICAgICAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAg\nICAgICAgICBsZWRnZXJGcmFnbWVudEVudHJ5TWNiLnByb2Nlc3NSZXN1bHQo\ncmMsIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgIH0sIG51bGwsIEJvb2tpZVByb3RvY29sLkZMQUdfUkVDT1ZF\nUllfQUREKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIG51bGwpOwogICAg\nfQoKICAgIC8qCiAgICAgKiBDYWxsYmFjayBmb3IgcmVjb3Zlcnkgb2YgYSBz\naW5nbGUgbGVkZ2VyIGZyYWdtZW50LgogICAgICogT25jZSB0aGUgZnJhZ21l\nbnQgaGFzIGhhZCBhbGwgZW50cmllcyByZXBsaWNhdGVkLCB1cGRhdGUgdGhl\nIGVuc2VtYmxlIAogICAgICogaW4gem9va2VlcGVyLgogICAgICogT25jZSBm\naW5pc2hlZCBwcm9wb2dhdGUgY2FsbGJhY2sgdXAgdG8gbGVkZ2VyRnJhZ21l\nbnRzTWNiIHdoaWNoIHNob3VsZAogICAgICogYmUgYSBtdWx0aWNhbGxiYWNr\nIHJlc3BvbnNpYmxlIGZvciBhbGwgZnJhZ21lbnRzIGluIGEgc2luZ2xlIGxl\nZGdlcgogICAgICovCiAgICBzdGF0aWMgY2xhc3MgU2luZ2xlRnJhZ21lbnRD\nYWxsYmFjayBpbXBsZW1lbnRzIEFzeW5jQ2FsbGJhY2suVm9pZENhbGxiYWNr\nIHsKICAgICAgICBmaW5hbCBBc3luY0NhbGxiYWNrLlZvaWRDYWxsYmFjayBs\nZWRnZXJGcmFnbWVudHNNY2I7CiAgICAgICAgZmluYWwgTGVkZ2VySGFuZGxl\nIGxoOwogICAgICAgIGZpbmFsIGxvbmcgZnJhZ21lbnRTdGFydElkOwogICAg\nICAgIGZpbmFsIEluZXRTb2NrZXRBZGRyZXNzIG9sZEJvb2tpZTsKICAgICAg\nICBmaW5hbCBJbmV0U29ja2V0QWRkcmVzcyBuZXdCb29raWU7CgogICAgICAg\nIFNpbmdsZUZyYWdtZW50Q2FsbGJhY2soQXN5bmNDYWxsYmFjay5Wb2lkQ2Fs\nbGJhY2sgbGVkZ2VyRnJhZ21lbnRzTWNiLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9uZyBmcmFnbWVudFN0YXJ0SWQsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBvbGRC\nb29raWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBJbmV0U29j\na2V0QWRkcmVzcyBuZXdCb29raWUpIHsKICAgICAgICAgICAgdGhpcy5sZWRn\nZXJGcmFnbWVudHNNY2IgPSBsZWRnZXJGcmFnbWVudHNNY2I7CiAgICAgICAg\nICAgIHRoaXMubGggPSBsaDsKICAgICAgICAgICAgdGhpcy5mcmFnbWVudFN0\nYXJ0SWQgPSBmcmFnbWVudFN0YXJ0SWQ7CiAgICAgICAgICAgIHRoaXMubmV3\nQm9va2llID0gbmV3Qm9va2llOwogICAgICAgICAgICB0aGlzLm9sZEJvb2tp\nZSA9IG9sZEJvb2tpZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQg\ncmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIGlm\nIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiQksgZXJyb3IgcmVwbGljYXRpbmcgbGVkZ2VyIGZyYWdt\nZW50cyBmb3IgbGVkZ2VyOiAiICsgbGguZ2V0SWQoKSwgCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgQktFeGNlcHRpb24uY3JlYXRlKHJjKSk7CiAgICAg\nICAgICAgICAgICBsZWRnZXJGcmFnbWVudHNNY2IucHJvY2Vzc1Jlc3VsdChy\nYywgbnVsbCwgbnVsbCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgd3JpdGVMZWRnZXJDb25maWcoKTsKICAg\nICAgICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIHdyaXRlTGVkZ2VyQ29u\nZmlnKCkgewogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBVcGRhdGUg\ndGhlIGxlZGdlciBtZXRhZGF0YSdzIGVuc2VtYmxlIGluZm8gdG8gcG9pbnQK\nICAgICAgICAgICAgICogdG8gdGhlIG5ldyBib29raWUuCiAgICAgICAgICAg\nICAqLwogICAgICAgICAgICBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+\nIGVuc2VtYmxlID0gbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJs\nZXMoKS5nZXQoCiAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnRTdGFydElk\nKTsKICAgICAgICAgICAgaW50IGRlYWRCb29raWVJbmRleCA9IGVuc2VtYmxl\nLmluZGV4T2Yob2xkQm9va2llKTsKICAgICAgICAgICAgZW5zZW1ibGUucmVt\nb3ZlKGRlYWRCb29raWVJbmRleCk7CiAgICAgICAgICAgIGVuc2VtYmxlLmFk\nZChkZWFkQm9va2llSW5kZXgsIG5ld0Jvb2tpZSk7CgogICAgICAgICAgICBs\naC53cml0ZUxlZGdlckNvbmZpZyhuZXcgV3JpdGVDYigpLCBudWxsKTsKICAg\nICAgICB9CiAgICAgICAgCiAgICAgICAgcHJpdmF0ZSBjbGFzcyBXcml0ZUNi\nIGltcGxlbWVudHMgQXN5bmNDYWxsYmFjay5TdGF0Q2FsbGJhY2sgewogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcHJv\nY2Vzc1Jlc3VsdChpbnQgcmMsIGZpbmFsIFN0cmluZyBwYXRoLCBPYmplY3Qg\nY3R4LCBTdGF0IHN0YXQpIHsKICAgICAgICAgICAgICAgIGlmIChyYyA9PSBD\nb2RlLkJBRFZFUlNJT04uaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAg\nICAgIExPRy53YXJuKCJUd28gZnJhZ21lbnRzIGF0dGVtcHRlZCB1cGRhdGUg\nYXQgb25jZTsgbGVkZ2VyIGlkOiAiICsgbGguZ2V0SWQoKSAKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICArICIgc3RhcnRpZDogIiArIGZyYWdtZW50\nU3RhcnRJZCk7CiAgICAgICAgICAgICAgICAgICAgLy8gdHJ5IGFnYWluLCB0\naGUgcHJldmlvdXMgc3VjY2VzcyAod2l0aCB3aGljaCB0aGlzIGhhcyBjb25m\nbGljdGVkKQogICAgICAgICAgICAgICAgICAgIC8vIHdpbGwgaGF2ZSB1cGRh\ndGVkIHRoZSBzdGF0CiAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXIgb3Bl\ncmF0aW9ucyBzdWNoIGFzIChhZGRFbnNlbWJsZSkgd291bGQgdXBkYXRlIGl0\nIHRvby4KICAgICAgICAgICAgICAgICAgICBsaC5yZXJlYWRNZXRhZGF0YShu\nZXcgR2VuZXJpY0NhbGxiYWNrPExlZGdlck1ldGFkYXRhPigpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKGludCByYywg\nTGVkZ2VyTWV0YWRhdGEgbmV3TWV0YSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9y\nIHJlYWRpbmcgdXBkYXRlZCBsZWRnZXIgbWV0YWRhdGEgZm9yIGxlZGdlciAi\nICsgbGguZ2V0SWQoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uLmNyZWF0ZShLZWVwZXJFeGNl\ncHRpb24uQ29kZS5nZXQocmMpLCBwYXRoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRzTWNiLnByb2Nlc3NSZXN1\nbHQocmMsIG51bGwsIG51bGwpOwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBs\naC5tZXRhZGF0YSA9IG5ld01ldGE7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgd3JpdGVMZWRnZXJDb25maWcoKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmMgIT0gQ29kZS5PSy5p\nbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJa\nSyBlcnJvciB1cGRhdGluZyBsZWRnZXIgY29uZmlnIG1ldGFkYXRhIGZvciBs\nZWRnZXJJZDogIiArIGxoLmdldElkKCksCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbi5jcmVhdGUoS2VlcGVyRXhjZXB0\naW9uLkNvZGUuZ2V0KHJjKSwgcGF0aCkpOwogICAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgICAgICBsaC5nZXRMZWRnZXJNZXRhZGF0\nYSgpLnVwZGF0ZVpub2RlU3RhdHVzKHN0YXQpOwogICAgICAgICAgICAgICAg\nICAgIExPRy5pbmZvKCJVcGRhdGVkIFpLIGZvciBsZWRnZXJJZDogKCIgKyBs\naC5nZXRJZCgpICsgIiA6ICIgKyBmcmFnbWVudFN0YXJ0SWQgCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiKSB0byBwb2ludCBsZWRnZXIgZnJh\nZ21lbnRzIGZyb20gb2xkIGRlYWQgYm9va2llOiAoIiArIG9sZEJvb2tpZQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIikgdG8gbmV3IGJvb2tp\nZTogKCIgKyBuZXdCb29raWUgKyAiKSIpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIFBhc3MgdGhl\nIHJldHVybiBjb2RlIHJlc3VsdCB1cCB0aGUgY2hhaW4gd2l0aAogICAgICAg\nICAgICAgICAgICogdGhlIHBhcmVudCBjYWxsYmFjay4KICAgICAgICAgICAg\nICAgICAqLwogICAgICAgICAgICAgICAgbGVkZ2VyRnJhZ21lbnRzTWNiLnBy\nb2Nlc3NSZXN1bHQocmMsIG51bGwsIG51bGwpOwogICAgICAgICAgICB9CiAg\nICAgICAgfTsKICAgIH0KCn0K\n","encoding":"base64"}

