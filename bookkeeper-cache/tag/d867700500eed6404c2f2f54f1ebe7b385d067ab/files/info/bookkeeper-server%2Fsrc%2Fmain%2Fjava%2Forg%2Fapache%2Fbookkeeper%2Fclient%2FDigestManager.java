{"sha":"99d8f679a53e11c4753ba9e0be987f1687e3bb94","node_id":"MDQ6QmxvYjE1NzU5NTY6OTlkOGY2NzlhNTNlMTFjNDc1M2JhOWUwYmU5ODdmMTY4N2UzYmI5NA==","size":6658,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/99d8f679a53e11c4753ba9e0be987f1687e3bb94","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNv\nZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhw\ncmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBz\ncGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq\nIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmltcG9ydCBq\nYXZhLm5pby5CeXRlQnVmZmVyOwppbXBvcnQgamF2YS5zZWN1cml0eS5HZW5l\ncmFsU2VjdXJpdHlFeGNlcHRpb247CgppbXBvcnQgb3JnLmFwYWNoZS5ib29r\na2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbi5CS0RpZ2VzdE1hdGNoRXhjZXB0\naW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5Cb29r\nS2VlcGVyLkRpZ2VzdFR5cGU7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXI7CmltcG9ydCBvcmcuamJv\nc3MubmV0dHkuYnVmZmVyLkNoYW5uZWxCdWZmZXJJbnB1dFN0cmVhbTsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1ZmZlcnM7Cgov\nKioKICogVGhpcyBjbGFzcyB0YWtlcyBhbiBlbnRyeSwgYXR0YWNoZXMgYSBk\naWdlc3QgdG8gaXQgYW5kIHBhY2thZ2VzIGl0IHdpdGggcmVsZXZhbnQKICog\nZGF0YSBzbyB0aGF0IGl0IGNhbiBiZSBzaGlwcGVkIHRvIHRoZSBib29raWUu\nIE9uIHRoZSByZXR1cm4gc2lkZSwgaXQgYWxzbwogKiBnZXRzIGEgcGFja2V0\nLCBjaGVja3MgdGhhdCB0aGUgZGlnZXN0IG1hdGNoZXMsIGFuZCBleHRyYWN0\ncyB0aGUgb3JpZ2luYWwgZW50cnkKICogZm9yIHRoZSBwYWNrZXQuIEN1cnJl\nbnRseSAyIHR5cGVzIG9mIGRpZ2VzdHMgYXJlIHN1cHBvcnRlZDogTUFDIChi\nYXNlZCBvbiBTSEEtMSkgYW5kIENSQzMyCiAqLwoKYWJzdHJhY3QgY2xhc3Mg\nRGlnZXN0TWFuYWdlciB7CiAgICBzdGF0aWMgZmluYWwgTG9nZ2VyIGxvZ2dl\nciA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKERpZ2VzdE1hbmFnZXIuY2xh\nc3MpOwoKICAgIHN0YXRpYyBmaW5hbCBpbnQgTUVUQURBVEFfTEVOR1RIID0g\nMzI7CgogICAgbG9uZyBsZWRnZXJJZDsKCiAgICBhYnN0cmFjdCBpbnQgZ2V0\nTWFjQ29kZUxlbmd0aCgpOwoKICAgIHZvaWQgdXBkYXRlKGJ5dGVbXSBkYXRh\nKSB7CiAgICAgICAgdXBkYXRlKGRhdGEsIDAsIGRhdGEubGVuZ3RoKTsKICAg\nIH0KCiAgICBhYnN0cmFjdCB2b2lkIHVwZGF0ZShieXRlW10gZGF0YSwgaW50\nIG9mZnNldCwgaW50IGxlbmd0aCk7CiAgICBhYnN0cmFjdCBieXRlW10gZ2V0\nVmFsdWVBbmRSZXNldCgpOwoKICAgIGZpbmFsIGludCBtYWNDb2RlTGVuZ3Ro\nOwoKICAgIHB1YmxpYyBEaWdlc3RNYW5hZ2VyKGxvbmcgbGVkZ2VySWQpIHsK\nICAgICAgICB0aGlzLmxlZGdlcklkID0gbGVkZ2VySWQ7CiAgICAgICAgbWFj\nQ29kZUxlbmd0aCA9IGdldE1hY0NvZGVMZW5ndGgoKTsKICAgIH0KCiAgICBz\ndGF0aWMgRGlnZXN0TWFuYWdlciBpbnN0YW50aWF0ZShsb25nIGxlZGdlcklk\nLCBieXRlW10gcGFzc3dkLCBEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHRocm93\ncyBHZW5lcmFsU2VjdXJpdHlFeGNlcHRpb24gewogICAgICAgIHN3aXRjaChk\naWdlc3RUeXBlKSB7CiAgICAgICAgY2FzZSBNQUM6CiAgICAgICAgICAgIHJl\ndHVybiBuZXcgTWFjRGlnZXN0TWFuYWdlcihsZWRnZXJJZCwgcGFzc3dkKTsK\nICAgICAgICBjYXNlIENSQzMyOgogICAgICAgICAgICByZXR1cm4gbmV3IENS\nQzMyRGlnZXN0TWFuYWdlcihsZWRnZXJJZCk7CiAgICAgICAgZGVmYXVsdDoK\nICAgICAgICAgICAgdGhyb3cgbmV3IEdlbmVyYWxTZWN1cml0eUV4Y2VwdGlv\nbigiVW5rbm93biBjaGVja3N1bSB0eXBlOiAiICsgZGlnZXN0VHlwZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGRp\nZ2VzdCBmb3IgYW4gZW50cnkgYW5kIHB1dCBieXRlcyB0b2dldGhlciBmb3Ig\nc2VuZGluZy4KICAgICAqCiAgICAgKiBAcGFyYW0gZW50cnlJZAogICAgICog\nQHBhcmFtIGxhc3RBZGRDb25maXJtZWQKICAgICAqIEBwYXJhbSBsZW5ndGgK\nICAgICAqIEBwYXJhbSBkYXRhCiAgICAgKiBAcmV0dXJuCiAgICAgKi8KCiAg\nICBwdWJsaWMgQ2hhbm5lbEJ1ZmZlciBjb21wdXRlRGlnZXN0QW5kUGFja2Fn\nZUZvclNlbmRpbmcobG9uZyBlbnRyeUlkLCBsb25nIGxhc3RBZGRDb25maXJt\nZWQsIGxvbmcgbGVuZ3RoLCBieXRlW10gZGF0YSwgaW50IGRvZmZzZXQsIGlu\ndCBkbGVuZ3RoKSB7CgogICAgICAgIGJ5dGVbXSBidWZmZXJBcnJheSA9IG5l\ndyBieXRlW01FVEFEQVRBX0xFTkdUSCArIG1hY0NvZGVMZW5ndGhdOwogICAg\nICAgIEJ5dGVCdWZmZXIgYnVmZmVyID0gQnl0ZUJ1ZmZlci53cmFwKGJ1ZmZl\nckFycmF5KTsKICAgICAgICBidWZmZXIucHV0TG9uZyhsZWRnZXJJZCk7CiAg\nICAgICAgYnVmZmVyLnB1dExvbmcoZW50cnlJZCk7CiAgICAgICAgYnVmZmVy\nLnB1dExvbmcobGFzdEFkZENvbmZpcm1lZCk7CiAgICAgICAgYnVmZmVyLnB1\ndExvbmcobGVuZ3RoKTsKICAgICAgICBidWZmZXIuZmxpcCgpOwoKICAgICAg\nICB1cGRhdGUoYnVmZmVyLmFycmF5KCksIDAsIE1FVEFEQVRBX0xFTkdUSCk7\nCiAgICAgICAgdXBkYXRlKGRhdGEsIGRvZmZzZXQsIGRsZW5ndGgpOwogICAg\nICAgIGJ5dGVbXSBkaWdlc3QgPSBnZXRWYWx1ZUFuZFJlc2V0KCk7CgogICAg\nICAgIGJ1ZmZlci5saW1pdChidWZmZXIuY2FwYWNpdHkoKSk7CiAgICAgICAg\nYnVmZmVyLnBvc2l0aW9uKE1FVEFEQVRBX0xFTkdUSCk7CiAgICAgICAgYnVm\nZmVyLnB1dChkaWdlc3QpOwogICAgICAgIGJ1ZmZlci5mbGlwKCk7CgogICAg\nICAgIHJldHVybiBDaGFubmVsQnVmZmVycy53cmFwcGVkQnVmZmVyKENoYW5u\nZWxCdWZmZXJzLndyYXBwZWRCdWZmZXIoYnVmZmVyKSwgQ2hhbm5lbEJ1ZmZl\ncnMud3JhcHBlZEJ1ZmZlcihkYXRhLCBkb2Zmc2V0LCBkbGVuZ3RoKSk7CiAg\nICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlmeURpZ2VzdChDaGFubmVsQnVm\nZmVyIGRhdGFSZWNlaXZlZCkgdGhyb3dzIEJLRGlnZXN0TWF0Y2hFeGNlcHRp\nb24gewogICAgICAgIHZlcmlmeURpZ2VzdChMZWRnZXJIYW5kbGUuSU5WQUxJ\nRF9FTlRSWV9JRCwgZGF0YVJlY2VpdmVkLCB0cnVlKTsKICAgIH0KCiAgICBw\ncml2YXRlIHZvaWQgdmVyaWZ5RGlnZXN0KGxvbmcgZW50cnlJZCwgQ2hhbm5l\nbEJ1ZmZlciBkYXRhUmVjZWl2ZWQpIHRocm93cyBCS0RpZ2VzdE1hdGNoRXhj\nZXB0aW9uIHsKICAgICAgICB2ZXJpZnlEaWdlc3QoZW50cnlJZCwgZGF0YVJl\nY2VpdmVkLCBmYWxzZSk7CiAgICB9CgogICAgcHJpdmF0ZSB2b2lkIHZlcmlm\neURpZ2VzdChsb25nIGVudHJ5SWQsIENoYW5uZWxCdWZmZXIgZGF0YVJlY2Vp\ndmVkLCBib29sZWFuIHNraXBFbnRyeUlkQ2hlY2spCiAgICAgICAgICAgIHRo\ncm93cyBCS0RpZ2VzdE1hdGNoRXhjZXB0aW9uIHsKCiAgICAgICAgQnl0ZUJ1\nZmZlciBkYXRhUmVjZWl2ZWRCdWZmZXIgPSBkYXRhUmVjZWl2ZWQudG9CeXRl\nQnVmZmVyKCk7CiAgICAgICAgYnl0ZVtdIGRpZ2VzdDsKCiAgICAgICAgdXBk\nYXRlKGRhdGFSZWNlaXZlZEJ1ZmZlci5hcnJheSgpLCBkYXRhUmVjZWl2ZWRC\ndWZmZXIucG9zaXRpb24oKSwgTUVUQURBVEFfTEVOR1RIKTsKCiAgICAgICAg\naW50IG9mZnNldCA9IE1FVEFEQVRBX0xFTkdUSCArIG1hY0NvZGVMZW5ndGg7\nCiAgICAgICAgdXBkYXRlKGRhdGFSZWNlaXZlZEJ1ZmZlci5hcnJheSgpLCBk\nYXRhUmVjZWl2ZWRCdWZmZXIucG9zaXRpb24oKSArIG9mZnNldCwgZGF0YVJl\nY2VpdmVkLnJlYWRhYmxlQnl0ZXMoKSAtIG9mZnNldCk7CiAgICAgICAgZGln\nZXN0ID0gZ2V0VmFsdWVBbmRSZXNldCgpOwoKICAgICAgICBmb3IgKGludCBp\nID0gMDsgaSA8IGRpZ2VzdC5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBp\nZiAoZGlnZXN0W2ldICE9IGRhdGFSZWNlaXZlZC5nZXRCeXRlKE1FVEFEQVRB\nX0xFTkdUSCArIGkpKSB7CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3Io\nIk1hYyBtaXNtYXRjaCBmb3IgbGVkZ2VyLWlkOiAiICsgbGVkZ2VySWQgKyAi\nLCBlbnRyeS1pZDogIiArIGVudHJ5SWQpOwogICAgICAgICAgICAgICAgdGhy\nb3cgbmV3IEJLRGlnZXN0TWF0Y2hFeGNlcHRpb24oKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KCiAgICAgICAgbG9uZyBhY3R1YWxMZWRnZXJJZCA9IGRh\ndGFSZWNlaXZlZC5yZWFkTG9uZygpOwogICAgICAgIGxvbmcgYWN0dWFsRW50\ncnlJZCA9IGRhdGFSZWNlaXZlZC5yZWFkTG9uZygpOwoKICAgICAgICBpZiAo\nYWN0dWFsTGVkZ2VySWQgIT0gbGVkZ2VySWQpIHsKICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJMZWRnZXItaWQgbWlzbWF0Y2ggaW4gYXV0aGVudGljYXRl\nZCBtZXNzYWdlLCBleHBlY3RlZDogIiArIGxlZGdlcklkICsgIiAsIGFjdHVh\nbDogIgogICAgICAgICAgICAgICAgICAgICAgICAgKyBhY3R1YWxMZWRnZXJJ\nZCk7CiAgICAgICAgICAgIHRocm93IG5ldyBCS0RpZ2VzdE1hdGNoRXhjZXB0\naW9uKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXNraXBFbnRyeUlkQ2hl\nY2sgJiYgYWN0dWFsRW50cnlJZCAhPSBlbnRyeUlkKSB7CiAgICAgICAgICAg\nIGxvZ2dlci5lcnJvcigiRW50cnktaWQgbWlzbWF0Y2ggaW4gYXV0aGVudGlj\nYXRlZCBtZXNzYWdlLCBleHBlY3RlZDogIiArIGVudHJ5SWQgKyAiICwgYWN0\ndWFsOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICArIGFjdHVhbEVudHJ5\nSWQpOwogICAgICAgICAgICB0aHJvdyBuZXcgQktEaWdlc3RNYXRjaEV4Y2Vw\ndGlvbigpOwogICAgICAgIH0KCiAgICB9CgogICAgLyoqCiAgICAgKiBWZXJp\nZnkgdGhhdCB0aGUgZGlnZXN0IG1hdGNoZXMgYW5kIHJldHVybnMgdGhlIGRh\ndGEgaW4gdGhlIGVudHJ5LgogICAgICoKICAgICAqIEBwYXJhbSBlbnRyeUlk\nCiAgICAgKiBAcGFyYW0gZGF0YVJlY2VpdmVkCiAgICAgKiBAcmV0dXJuCiAg\nICAgKiBAdGhyb3dzIEJLRGlnZXN0TWF0Y2hFeGNlcHRpb24KICAgICAqLwog\nICAgQ2hhbm5lbEJ1ZmZlcklucHV0U3RyZWFtIHZlcmlmeURpZ2VzdEFuZFJl\ndHVybkRhdGEobG9uZyBlbnRyeUlkLCBDaGFubmVsQnVmZmVyIGRhdGFSZWNl\naXZlZCkKICAgICAgICAgICAgdGhyb3dzIEJLRGlnZXN0TWF0Y2hFeGNlcHRp\nb24gewogICAgICAgIHZlcmlmeURpZ2VzdChlbnRyeUlkLCBkYXRhUmVjZWl2\nZWQpOwogICAgICAgIGRhdGFSZWNlaXZlZC5yZWFkZXJJbmRleChNRVRBREFU\nQV9MRU5HVEggKyBtYWNDb2RlTGVuZ3RoKTsKICAgICAgICByZXR1cm4gbmV3\nIENoYW5uZWxCdWZmZXJJbnB1dFN0cmVhbShkYXRhUmVjZWl2ZWQpOwogICAg\nfQoKICAgIHN0YXRpYyBjbGFzcyBSZWNvdmVyeURhdGEgewogICAgICAgIGxv\nbmcgbGFzdEFkZENvbmZpcm1lZDsKICAgICAgICBsb25nIGxlbmd0aDsKCiAg\nICAgICAgcHVibGljIFJlY292ZXJ5RGF0YShsb25nIGxhc3RBZGRDb25maXJt\nZWQsIGxvbmcgbGVuZ3RoKSB7CiAgICAgICAgICAgIHRoaXMubGFzdEFkZENv\nbmZpcm1lZCA9IGxhc3RBZGRDb25maXJtZWQ7CiAgICAgICAgICAgIHRoaXMu\nbGVuZ3RoID0gbGVuZ3RoOwogICAgICAgIH0KCiAgICB9CgogICAgUmVjb3Zl\ncnlEYXRhIHZlcmlmeURpZ2VzdEFuZFJldHVybkxhc3RDb25maXJtZWQoQ2hh\nbm5lbEJ1ZmZlciBkYXRhUmVjZWl2ZWQpIHRocm93cyBCS0RpZ2VzdE1hdGNo\nRXhjZXB0aW9uIHsKICAgICAgICB2ZXJpZnlEaWdlc3QoZGF0YVJlY2VpdmVk\nKTsKICAgICAgICBkYXRhUmVjZWl2ZWQucmVhZGVySW5kZXgoOCk7CgogICAg\nICAgIGRhdGFSZWNlaXZlZC5yZWFkTG9uZygpOyAvLyBza2lwIHVudXNlZCBl\nbnRyeUlkCiAgICAgICAgbG9uZyBsYXN0QWRkQ29uZmlybWVkID0gZGF0YVJl\nY2VpdmVkLnJlYWRMb25nKCk7CiAgICAgICAgbG9uZyBsZW5ndGggPSBkYXRh\nUmVjZWl2ZWQucmVhZExvbmcoKTsKICAgICAgICByZXR1cm4gbmV3IFJlY292\nZXJ5RGF0YShsYXN0QWRkQ29uZmlybWVkLCBsZW5ndGgpOwogICAgfQp9Cg==\n","encoding":"base64"}

