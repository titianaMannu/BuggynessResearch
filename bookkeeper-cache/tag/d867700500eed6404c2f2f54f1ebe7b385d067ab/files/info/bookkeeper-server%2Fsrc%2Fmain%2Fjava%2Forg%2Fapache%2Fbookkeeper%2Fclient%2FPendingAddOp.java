{"sha":"d61000eb991f70e92f541956abdb883a1f113134","node_id":"MDQ6QmxvYjE1NzU5NTY6ZDYxMDAwZWI5OTFmNzBlOTJmNTQxOTU2YWJkYjg4M2ExZjExMzEzNA==","size":6120,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/d61000eb991f70e92f541956abdb883a1f113134","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNv\nZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhw\ncmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBz\ncGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAq\nIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCmltcG9ydCBq\nYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVy\nSW50ZXJuYWxDYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29raWVQcm90b2NvbDsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5idWZmZXIuQ2hhbm5lbEJ1\nZmZlcjsKCi8qKgogKiBUaGlzIHJlcHJlc2VudHMgYSBwZW5kaW5nIGFkZCBv\ncGVyYXRpb24uIFdoZW4gaXQgaGFzIGdvdCBzdWNjZXNzIGZyb20gYWxsCiAq\nIGJvb2tpZXMsIGl0IHNlZXMgaWYgaXRzIGF0IHRoZSBoZWFkIG9mIHRoZSBw\nZW5kaW5nIGFkZHMgcXVldWUsIGFuZCBpZiB5ZXMsCiAqIHNlbmRzIGFjayBi\nYWNrIHRvIHRoZSBhcHBsaWNhdGlvbi4gSWYgYSBib29raWUgZmFpbHMsIGEg\ncmVwbGFjZW1lbnQgaXMgbWFkZQogKiBhbmQgcGxhY2VkIGF0IHRoZSBzYW1l\nIHBvc2l0aW9uIGluIHRoZSBlbnNlbWJsZS4gVGhlIHBlbmRpbmcgYWRkcyBh\ncmUgdGhlbgogKiByZXJlcGxpY2F0ZWQuCiAqCiAqCiAqLwpjbGFzcyBQZW5k\naW5nQWRkT3AgaW1wbGVtZW50cyBXcml0ZUNhbGxiYWNrIHsKICAgIGZpbmFs\nIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIo\nUGVuZGluZ0FkZE9wLmNsYXNzKTsKCiAgICBDaGFubmVsQnVmZmVyIHRvU2Vu\nZDsKICAgIEFkZENhbGxiYWNrIGNiOwogICAgT2JqZWN0IGN0eDsKICAgIGxv\nbmcgZW50cnlJZDsKICAgIGJvb2xlYW5bXSBzdWNjZXNzZXNTb0ZhcjsKICAg\nIGludCBudW1SZXNwb25zZXNQZW5kaW5nOwogICAgTGVkZ2VySGFuZGxlIGxo\nOwogICAgYm9vbGVhbiBpc1JlY292ZXJ5QWRkID0gZmFsc2U7CgogICAgUGVu\nZGluZ0FkZE9wKExlZGdlckhhbmRsZSBsaCwgQWRkQ2FsbGJhY2sgY2IsIE9i\namVjdCBjdHgpIHsKICAgICAgICB0aGlzLmxoID0gbGg7CiAgICAgICAgdGhp\ncy5jYiA9IGNiOwogICAgICAgIHRoaXMuY3R4ID0gY3R4OwogICAgICAgIHRo\naXMuZW50cnlJZCA9IExlZGdlckhhbmRsZS5JTlZBTElEX0VOVFJZX0lEOwog\nICAgICAgIAogICAgICAgIHN1Y2Nlc3Nlc1NvRmFyID0gbmV3IGJvb2xlYW5b\nbGgubWV0YWRhdGEucXVvcnVtU2l6ZV07CiAgICAgICAgbnVtUmVzcG9uc2Vz\nUGVuZGluZyA9IHN1Y2Nlc3Nlc1NvRmFyLmxlbmd0aDsKICAgIH0KCiAgICAv\nKiogCiAgICAgKiBFbmFibGUgdGhlIHJlY292ZXJ5IGFkZCBmbGFnIGZvciB0\naGlzIG9wZXJhdGlvbi4KICAgICAqIEBzZWUgTGVkZ2VySGFuZGxlI2FzeW5j\nUmVjb3ZlcnlBZGRFbnRyeQogICAgICovCiAgICBQZW5kaW5nQWRkT3AgZW5h\nYmxlUmVjb3ZlcnlBZGQoKSB7CiAgICAgICAgaXNSZWNvdmVyeUFkZCA9IHRy\ndWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgdm9pZCBzZXRF\nbnRyeUlkKGxvbmcgZW50cnlJZCkgewogICAgICAgIHRoaXMuZW50cnlJZCA9\nIGVudHJ5SWQ7CiAgICB9CgogICAgdm9pZCBzZW5kV3JpdGVSZXF1ZXN0KGlu\ndCBib29raWVJbmRleCwgaW50IGFycmF5SW5kZXgpIHsKICAgICAgICBpbnQg\nZmxhZ3MgPSBpc1JlY292ZXJ5QWRkID8gQm9va2llUHJvdG9jb2wuRkxBR19S\nRUNPVkVSWV9BREQgOiBCb29raWVQcm90b2NvbC5GTEFHX05PTkU7CgogICAg\nICAgIGxoLmJrLmJvb2tpZUNsaWVudC5hZGRFbnRyeShsaC5tZXRhZGF0YS5j\ndXJyZW50RW5zZW1ibGUuZ2V0KGJvb2tpZUluZGV4KSwgbGgubGVkZ2VySWQs\nIGxoLmxlZGdlcktleSwgZW50cnlJZCwgdG9TZW5kLAogICAgICAgICAgICAg\nICAgdGhpcywgYXJyYXlJbmRleCwgZmxhZ3MpOwogICAgfQoKICAgIHZvaWQg\ndW5zZXRTdWNjZXNzQW5kU2VuZFdyaXRlUmVxdWVzdChpbnQgYm9va2llSW5k\nZXgpIHsKICAgICAgICBpZiAodG9TZW5kID09IG51bGwpIHsKICAgICAgICAg\nICAgLy8gdGhpcyBhZGRPcCBoYXNuJ3QgeWV0IGhhZCBpdHMgbWFjIGNvbXB1\ndGVkLiBXaGVuIHRoZSBtYWMgaXMKICAgICAgICAgICAgLy8gY29tcHV0ZWQs\nIGl0cyB3cml0ZSByZXF1ZXN0cyB3aWxsIGJlIHNlbnQsIHNvIG5vIG5lZWQg\ndG8gc2VuZCBpdAogICAgICAgICAgICAvLyBub3cKICAgICAgICAgICAgcmV0\ndXJuOwogICAgICAgIH0KCiAgICAgICAgaW50IHJlcGxpY2FJbmRleCA9IGxo\nLmRpc3RyaWJ1dGlvblNjaGVkdWxlLmdldFJlcGxpY2FJbmRleChlbnRyeUlk\nLCBib29raWVJbmRleCk7CiAgICAgICAgaWYgKHJlcGxpY2FJbmRleCA8IDAp\nIHsKICAgICAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICBMT0cuZGVidWcoIkxlYXZpbmcgdW5jaGFuZ2VkLCBs\nZWRnZXI6ICIgKyBsaC5sZWRnZXJJZCArICIgZW50cnk6ICIgKyBlbnRyeUlk\nICsgIiBib29raWUgaW5kZXg6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICArIGJvb2tpZUluZGV4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFi\nbGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRlYnVnKCJVbnNldHRpbmcgc3Vj\nY2VzcyBmb3IgbGVkZ2VyOiAiICsgbGgubGVkZ2VySWQgKyAiIGVudHJ5OiAi\nICsgZW50cnlJZCArICIgYm9va2llIGluZGV4OiAiCiAgICAgICAgICAgICAg\nICAgICAgICArIGJvb2tpZUluZGV4KTsKICAgICAgICB9CgogICAgICAgIC8v\nIGlmIHdlIGhhZCBhbHJlYWR5IGhlYXJkIGEgc3VjY2VzcyBmcm9tIHRoaXMg\nYXJyYXkgaW5kZXgsIG5lZWQgdG8KICAgICAgICAvLyBpbmNyZW1lbnQgb3Vy\nIG51bWJlciBvZiByZXNwb25zZXMgdGhhdCBhcmUgcGVuZGluZywgc2luY2Ug\nd2UgYXJlCiAgICAgICAgLy8gZ29pbmcgdG8gdW5zZXQgdGhpcyBzdWNjZXNz\nCiAgICAgICAgaWYgKHN1Y2Nlc3Nlc1NvRmFyW3JlcGxpY2FJbmRleF0pIHsK\nICAgICAgICAgICAgc3VjY2Vzc2VzU29GYXJbcmVwbGljYUluZGV4XSA9IGZh\nbHNlOwogICAgICAgICAgICBudW1SZXNwb25zZXNQZW5kaW5nKys7CiAgICAg\nICAgfQoKICAgICAgICBzZW5kV3JpdGVSZXF1ZXN0KGJvb2tpZUluZGV4LCBy\nZXBsaWNhSW5kZXgpOwogICAgfQoKICAgIHZvaWQgaW5pdGlhdGUoQ2hhbm5l\nbEJ1ZmZlciB0b1NlbmQpIHsKICAgICAgICB0aGlzLnRvU2VuZCA9IHRvU2Vu\nZDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IHN1Y2Nlc3Nlc1NvRmFy\nLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGludCBib29raWVJbmRleCA9\nIGxoLmRpc3RyaWJ1dGlvblNjaGVkdWxlLmdldEJvb2tpZUluZGV4KGVudHJ5\nSWQsIGkpOwogICAgICAgICAgICBzZW5kV3JpdGVSZXF1ZXN0KGJvb2tpZUlu\nZGV4LCBpKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCB3cml0ZUNvbXBsZXRlKGludCByYywgbG9uZyBsZWRnZXJJ\nZCwgbG9uZyBlbnRyeUlkLCBJbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBPYmpl\nY3QgY3R4KSB7CgogICAgICAgIEludGVnZXIgcmVwbGljYUluZGV4ID0gKElu\ndGVnZXIpIGN0eDsKICAgICAgICBpbnQgYm9va2llSW5kZXggPSBsaC5kaXN0\ncmlidXRpb25TY2hlZHVsZS5nZXRCb29raWVJbmRleChlbnRyeUlkLCByZXBs\naWNhSW5kZXgpOwoKICAgICAgICBpZiAoIWxoLm1ldGFkYXRhLmN1cnJlbnRF\nbnNlbWJsZS5nZXQoYm9va2llSW5kZXgpLmVxdWFscyhhZGRyKSkgewogICAg\nICAgICAgICAvLyBlbnNlbWJsZSBoYXMgYWxyZWFkeSBjaGFuZ2VkLCBmYWls\ndXJlIG9mIHRoaXMgYWRkciBpcyBpbW1hdGVyaWFsCiAgICAgICAgICAgIExP\nRy53YXJuKCJXcml0ZSBkaWQgbm90IHN1Y2NlZWQ6ICIgKyBsZWRnZXJJZCAr\nICIsICIgKyBlbnRyeUlkICsgIi4gQnV0IHdlIGhhdmUgYWxyZWFkeSBmaXhl\nZCBpdC4iKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAg\nICAgc3dpdGNoIChyYykgewogICAgICAgIGNhc2UgQktFeGNlcHRpb24uQ29k\nZS5PSzoKICAgICAgICAgICAgLy8gY29udGludWUKICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgY2FzZSBCS0V4Y2VwdGlvbi5Db2RlLkxlZGdlckZlbmNl\nZEV4Y2VwdGlvbjoKICAgICAgICAgICAgTE9HLndhcm4oIkZlbmNpbmcgZXhj\nZXB0aW9uIG9uIHdyaXRlOiAiICsgbGVkZ2VySWQgKyAiLCAiICsgZW50cnlJ\nZCk7CiAgICAgICAgICAgIGxoLmhhbmRsZVVucmVjb3ZlcmFibGVFcnJvckR1\ncmluZ0FkZChyYyk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICBjYXNl\nIEJLRXhjZXB0aW9uLkNvZGUuVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9u\nOgogICAgICAgICAgICBMT0cud2FybigiVW5hdXRob3JpemVkIGFjY2VzcyBl\neGNlcHRpb24gb24gd3JpdGU6ICIgKyBsZWRnZXJJZCArICIsICIgKyBlbnRy\neUlkKTsKICAgICAgICAgICAgbGguaGFuZGxlVW5yZWNvdmVyYWJsZUVycm9y\nRHVyaW5nQWRkKHJjKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGRl\nZmF1bHQ6CiAgICAgICAgICAgIExPRy53YXJuKCJXcml0ZSBkaWQgbm90IHN1\nY2NlZWQ6ICIgKyBsZWRnZXJJZCArICIsICIgKyBlbnRyeUlkKTsKICAgICAg\nICAgICAgbGguaGFuZGxlQm9va2llRmFpbHVyZShhZGRyLCBib29raWVJbmRl\neCk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgoKICAgICAgICBp\nZiAoIXN1Y2Nlc3Nlc1NvRmFyW3JlcGxpY2FJbmRleF0pIHsKICAgICAgICAg\nICAgc3VjY2Vzc2VzU29GYXJbcmVwbGljYUluZGV4XSA9IHRydWU7CiAgICAg\nICAgICAgIG51bVJlc3BvbnNlc1BlbmRpbmctLTsKCiAgICAgICAgICAgIC8v\nIGRvIHNvbWUgcXVpY2sgY2hlY2tzIHRvIHNlZSBpZiBzb21lIGFkZHMgbWF5\nIGhhdmUgZmluaXNoZWQuIEFsbAogICAgICAgICAgICAvLyB0aGlzIHdpbGwg\nYmUgY2hlY2tlZCB1bmRlciBsb2NrcyBhZ2FpbgogICAgICAgICAgICBpZiAo\nbnVtUmVzcG9uc2VzUGVuZGluZyA9PSAwICYmIGxoLnBlbmRpbmdBZGRPcHMu\ncGVlaygpID09IHRoaXMpIHsKICAgICAgICAgICAgICAgIGxoLnNlbmRBZGRT\ndWNjZXNzQ2FsbGJhY2tzKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgdm9pZCBzdWJtaXRDYWxsYmFjayhmaW5hbCBpbnQgcmMpIHsK\nICAgICAgICBjYi5hZGRDb21wbGV0ZShyYywgbGgsIGVudHJ5SWQsIGN0eCk7\nCiAgICAgICAgbGgub3BDb3VudGVyU2VtLnJlbGVhc2UoKTsKICAgIH0KCn0K\n","encoding":"base64"}

