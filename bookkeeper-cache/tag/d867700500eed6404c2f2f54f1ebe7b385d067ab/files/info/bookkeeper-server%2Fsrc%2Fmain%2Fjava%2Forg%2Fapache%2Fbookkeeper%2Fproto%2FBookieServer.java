{"sha":"125b3fa4ed4d5c3b0b8a9c79cba0f3cbfe9c779e","node_id":"MDQ6QmxvYjE1NzU5NTY6MTI1YjNmYTRlZDRkNWMzYjBiOGE5Yzc5Y2JhMGYzY2JmZTljNzc5ZQ==","size":18797,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/125b3fa4ed4d5c3b0b8a9c79cba0f3cbfe9c779e","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG87CgovKgogKgog\nKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24g\nKEFTRikgdW5kZXIgb25lCiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5z\nZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZQogKiBkaXN0cmli\ndXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlv\nbgogKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0Yg\nbGljZW5zZXMgdGhpcyBmaWxlCiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hl\nIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUKICogIkxpY2Vuc2UiKTsgeW91\nIG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZQog\nKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9m\nIHRoZSBMaWNlbnNlIGF0CiAqCiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3Jn\nL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBi\neSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywKICog\nc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlz\ndHJpYnV0ZWQgb24gYW4KICogIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJS\nQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZCiAqIEtJTkQsIGVpdGhlciBl\neHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZQog\nKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5k\nIGxpbWl0YXRpb25zCiAqIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKi8KCmlt\ncG9ydCBqYXZhLmlvLkZpbGU7CmltcG9ydCBqYXZhLmlvLklPRXhjZXB0aW9u\nOwppbXBvcnQgamF2YS5uZXQuSW5ldEFkZHJlc3M7CmltcG9ydCBqYXZhLm5l\ndC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0Lk1hbGZvcm1l\nZFVSTEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEubmV0LlVua25vd25Ib3N0RXhj\nZXB0aW9uOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1ZmZlcjsKCmltcG9ydCBq\nYXZheC5tYW5hZ2VtZW50LkpNRXhjZXB0aW9uOwoKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKCmltcG9ydCBvcmcuYXBh\nY2hlLmJvb2trZWVwZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5ib29ra2VlcGVyLmJvb2tpZS5FeGl0Q29kZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLlNlcnZlckNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuam14LkJLTUJlYW5S\nZWdpc3RyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5O\nSU9TZXJ2ZXJGYWN0b3J5LkNueG47CmltcG9ydCBzdGF0aWMgb3JnLmFwYWNo\nZS5ib29ra2VlcGVyLnByb3RvLkJvb2tpZVByb3RvY29sLlBhY2tldEhlYWRl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jb25maWd1cmF0aW9uLkNv\nbmZpZ3VyYXRpb25FeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmNvbW1v\nbnMuY2xpLkJhc2ljUGFyc2VyOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25z\nLmNsaS5PcHRpb25zOwppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25zLmNsaS5D\nb21tYW5kTGluZTsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuSGVs\ncEZvcm1hdHRlcjsKaW1wb3J0IG9yZy5hcGFjaGUuY29tbW9ucy5jbGkuUGFy\nc2VFeGNlcHRpb247CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIEltcGxlbWVudHMg\ndGhlIHNlcnZlci1zaWRlIHBhcnQgb2YgdGhlIEJvb2tLZWVwZXIgcHJvdG9j\nb2wuCiAqCiAqLwpwdWJsaWMgY2xhc3MgQm9va2llU2VydmVyIGltcGxlbWVu\ndHMgTklPU2VydmVyRmFjdG9yeS5QYWNrZXRQcm9jZXNzb3IsIEJvb2trZWVw\nZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNhbGxiYWNrIHsKICAgIGZpbmFs\nIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZjsKICAgIE5JT1NlcnZlckZhY3Rv\ncnkgbmlvU2VydmVyRmFjdG9yeTsKICAgIHByaXZhdGUgdm9sYXRpbGUgYm9v\nbGVhbiBydW5uaW5nID0gZmFsc2U7CiAgICBCb29raWUgYm9va2llOwogICAg\nRGVhdGhXYXRjaGVyIGRlYXRoV2F0Y2hlcjsKICAgIHN0YXRpYyBMb2dnZXIg\nTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9va2llU2VydmVyLmNs\nYXNzKTsKCiAgICBpbnQgZXhpdENvZGUgPSBFeGl0Q29kZS5PSzsKCiAgICAv\nLyBvcGVyYXRpb24gc3RhdHMKICAgIGZpbmFsIEJLU3RhdHMgYmtTdGF0cyA9\nIEJLU3RhdHMuZ2V0SW5zdGFuY2UoKTsKICAgIGZpbmFsIGJvb2xlYW4gaXNT\ndGF0c0VuYWJsZWQ7CiAgICBwcm90ZWN0ZWQgQm9va2llU2VydmVyQmVhbiBq\nbXhCa1NlcnZlckJlYW47CgogICAgcHVibGljIEJvb2tpZVNlcnZlcihTZXJ2\nZXJDb25maWd1cmF0aW9uIGNvbmYpIAogICAgICAgICAgICB0aHJvd3MgSU9F\neGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRp\nb24sIEJvb2tpZUV4Y2VwdGlvbiB7CiAgICAgICAgdGhpcy5jb25mID0gY29u\nZjsKICAgICAgICB0aGlzLmJvb2tpZSA9IG5ld0Jvb2tpZShjb25mKTsKCiAg\nICAgICAgaXNTdGF0c0VuYWJsZWQgPSBjb25mLmlzU3RhdGlzdGljc0VuYWJs\nZWQoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgQm9va2llIG5ld0Jvb2tpZShT\nZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYpCiAgICAgICAgdGhyb3dzIElPRXhj\nZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIHJldHVybiBuZXcgQm9va2ll\nKGNvbmYpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0KCkgdGhyb3dz\nIElPRXhjZXB0aW9uIHsKICAgICAgICB0aGlzLmJvb2tpZS5zdGFydCgpOwoK\nICAgICAgICBuaW9TZXJ2ZXJGYWN0b3J5ID0gbmV3IE5JT1NlcnZlckZhY3Rv\ncnkoY29uZiwgdGhpcyk7CiAgICAgICAgbmlvU2VydmVyRmFjdG9yeS5zdGFy\ndCgpOwogICAgICAgIHJ1bm5pbmcgPSB0cnVlOwogICAgICAgIGRlYXRoV2F0\nY2hlciA9IG5ldyBEZWF0aFdhdGNoZXIoY29uZik7CiAgICAgICAgZGVhdGhX\nYXRjaGVyLnN0YXJ0KCk7CgogICAgICAgIC8vIHJlZ2lzdGVyIGpteAogICAg\nICAgIHJlZ2lzdGVySk1YKCk7CiAgICB9CgogICAgcHVibGljIEluZXRTb2Nr\nZXRBZGRyZXNzIGdldExvY2FsQWRkcmVzcygpIHsKICAgICAgICB0cnkgewog\nICAgICAgICAgICByZXR1cm4gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRB\nZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIGNvbmYu\nZ2V0Qm9va2llUG9ydCgpKTsKICAgICAgICB9IGNhdGNoIChVbmtub3duSG9z\ndEV4Y2VwdGlvbiB1aGUpIHsKICAgICAgICAgICAgcmV0dXJuIG5pb1NlcnZl\nckZhY3RvcnkuZ2V0TG9jYWxBZGRyZXNzKCk7CiAgICAgICAgfQogICAgfQoK\nICAgIHB1YmxpYyBzeW5jaHJvbml6ZWQgdm9pZCBzaHV0ZG93bigpIHsKICAg\nICAgICBpZiAoIXJ1bm5pbmcpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KICAgICAgICBuaW9TZXJ2ZXJGYWN0b3J5LnNodXRkb3duKCk7CiAg\nICAgICAgZXhpdENvZGUgPSBib29raWUuc2h1dGRvd24oKTsKICAgICAgICBy\ndW5uaW5nID0gZmFsc2U7CgogICAgICAgIC8vIHVucmVnaXN0ZXIgSk1YCiAg\nICAgICAgdW5yZWdpc3RlckpNWCgpOwogICAgfQoKICAgIHByb3RlY3RlZCB2\nb2lkIHJlZ2lzdGVySk1YKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGpteEJrU2VydmVyQmVhbiA9IG5ldyBCb29raWVTZXJ2ZXJCZWFuKGNvbmYs\nIHRoaXMpOwogICAgICAgICAgICBCS01CZWFuUmVnaXN0cnkuZ2V0SW5zdGFu\nY2UoKS5yZWdpc3RlcihqbXhCa1NlcnZlckJlYW4sIG51bGwpOwoKICAgICAg\nICAgICAgYm9va2llLnJlZ2lzdGVySk1YKGpteEJrU2VydmVyQmVhbik7CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLndhcm4oIkZhaWxlZCB0byByZWdpc3RlciB3aXRoIEpNWCIsIGUpOwogICAg\nICAgICAgICBqbXhCa1NlcnZlckJlYW4gPSBudWxsOwogICAgICAgIH0KICAg\nIH0KCiAgICBwcm90ZWN0ZWQgdm9pZCB1bnJlZ2lzdGVySk1YKCkgewogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGJvb2tpZS51bnJlZ2lzdGVySk1YKCk7\nCiAgICAgICAgICAgIGlmIChqbXhCa1NlcnZlckJlYW4gIT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgQktNQmVhblJlZ2lzdHJ5LmdldEluc3RhbmNlKCku\ndW5yZWdpc3RlcihqbXhCa1NlcnZlckJlYW4pOwogICAgICAgICAgICB9CiAg\nICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLndhcm4oIkZhaWxlZCB0byB1bnJlZ2lzdGVyIHdpdGggSk1YIiwgZSk7CiAg\nICAgICAgfQogICAgICAgIGpteEJrU2VydmVyQmVhbiA9IG51bGw7CiAgICB9\nCgogICAgcHVibGljIGJvb2xlYW4gaXNSdW5uaW5nKCkgewogICAgICAgIHJl\ndHVybiBib29raWUuaXNSdW5uaW5nKCkgJiYgbmlvU2VydmVyRmFjdG9yeS5p\nc1J1bm5pbmcoKSAmJiBydW5uaW5nOwogICAgfQoKICAgIC8qKgogICAgICog\nV2hldGhlciBib29raWUgaXMgcnVubmluZz8KICAgICAqCiAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgYm9va2llIGlzIHJ1bm5pbmcsIG90aGVyd2lzZSByZXR1\ncm4gZmFsc2UKICAgICAqLwogICAgcHVibGljIGJvb2xlYW4gaXNCb29raWVS\ndW5uaW5nKCkgewogICAgICAgIHJldHVybiBib29raWUuaXNSdW5uaW5nKCk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBXaGV0aGVyIG5pbyBzZXJ2ZXIgaXMg\ncnVubmluZz8KICAgICAqCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgbmlvIHNl\ncnZlciBpcyBydW5uaW5nLCBvdGhlcndpc2UgcmV0dXJuIGZhbHNlCiAgICAg\nKi8KICAgIHB1YmxpYyBib29sZWFuIGlzTmlvU2VydmVyUnVubmluZygpIHsK\nICAgICAgICByZXR1cm4gbmlvU2VydmVyRmFjdG9yeS5pc1J1bm5pbmcoKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBqb2luKCkgdGhyb3dzIEludGVycnVw\ndGVkRXhjZXB0aW9uIHsKICAgICAgICBuaW9TZXJ2ZXJGYWN0b3J5LmpvaW4o\nKTsKICAgIH0KCiAgICBwdWJsaWMgaW50IGdldEV4aXRDb2RlKCkgewogICAg\nICAgIHJldHVybiBleGl0Q29kZTsKICAgIH0KCiAgICAvKioKICAgICAqIEEg\ndGhyZWFkIHRvIHdhdGNoIHdoZXRoZXIgYm9va2llICYgbmlvc2VydmVyIGlz\nIHN0aWxsIGFsaXZlCiAgICAgKi8KICAgIGNsYXNzIERlYXRoV2F0Y2hlciBl\neHRlbmRzIFRocmVhZCB7CgogICAgICAgIGZpbmFsIGludCB3YXRjaEludGVy\ndmFsOwoKICAgICAgICBEZWF0aFdhdGNoZXIoU2VydmVyQ29uZmlndXJhdGlv\nbiBjb25mKSB7CiAgICAgICAgICAgIHdhdGNoSW50ZXJ2YWwgPSBjb25mLmdl\ndERlYXRoV2F0Y2hJbnRlcnZhbCgpOwogICAgICAgIH0KCiAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAg\nICB3aGlsZSh0cnVlKSB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIFRocmVhZC5zbGVlcCh3YXRjaEludGVydmFsKTsKICAg\nICAgICAgICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGll\nKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90aGluZwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKCFpc0Jvb2tpZVJ1bm5p\nbmcoKSB8fCAhaXNOaW9TZXJ2ZXJSdW5uaW5nKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBzaHV0ZG93bigpOwogICAgICAgICAgICAgICAgICAgIGJyZWFr\nOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgfQoKICAgIHN0YXRpYyBmaW5hbCBPcHRpb25zIGJrT3B0cyA9IG5ldyBP\ncHRpb25zKCk7CiAgICBzdGF0aWMgewogICAgICAgIGJrT3B0cy5hZGRPcHRp\nb24oImMiLCAiY29uZiIsIHRydWUsICJDb25maWd1cmF0aW9uIGZvciBCb29r\naWUgU2VydmVyIik7CiAgICAgICAgYmtPcHRzLmFkZE9wdGlvbigiaCIsICJo\nZWxwIiwgZmFsc2UsICJQcmludCBoZWxwIG1lc3NhZ2UiKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFByaW50IHVzYWdlCiAgICAgKi8KICAgIHByaXZhdGUg\nc3RhdGljIHZvaWQgcHJpbnRVc2FnZSgpIHsKICAgICAgICBIZWxwRm9ybWF0\ndGVyIGhmID0gbmV3IEhlbHBGb3JtYXR0ZXIoKTsKICAgICAgICBoZi5wcmlu\ndEhlbHAoIkJvb2tpZVNlcnZlciBbb3B0aW9uc11cblx0b3JcbiIKICAgICAg\nICAgICAgICAgICAgICsgIkJvb2tpZVNlcnZlciA8Ym9va2llX3BvcnQ+IDx6\na19zZXJ2ZXJzPiA8am91cm5hbF9kaXI+IDxsZWRnZXJfZGlyIFtsZWRnZXJf\nZGlyXT4iLCBia09wdHMpOwogICAgfQoKICAgIHByaXZhdGUgc3RhdGljIHZv\naWQgbG9hZENvbmZGaWxlKFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiwgU3Ry\naW5nIGNvbmZGaWxlKQogICAgICAgIHRocm93cyBJbGxlZ2FsQXJndW1lbnRF\neGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbmYubG9h\nZENvbmYobmV3IEZpbGUoY29uZkZpbGUpLnRvVVJJKCkudG9VUkwoKSk7CiAg\nICAgICAgfSBjYXRjaCAoTWFsZm9ybWVkVVJMRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgTE9HLmVycm9yKCJDb3VsZCBub3Qgb3BlbiBjb25maWd1cmF0\naW9uIGZpbGU6ICIgKyBjb25mRmlsZSwgZSk7CiAgICAgICAgICAgIHRocm93\nIG5ldyBJbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oKTsKICAgICAgICB9IGNh\ndGNoIChDb25maWd1cmF0aW9uRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJNYWxmb3JtZWQgY29uZmlndXJhdGlvbiBmaWxlOiAiICsg\nY29uZkZpbGUsIGUpOwogICAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFy\nZ3VtZW50RXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIExPRy5pbmZv\nKCJVc2luZyBjb25maWd1cmF0aW9uIGZpbGUgIiArIGNvbmZGaWxlKTsKICAg\nIH0KCiAgICBwcml2YXRlIHN0YXRpYyBTZXJ2ZXJDb25maWd1cmF0aW9uIHBh\ncnNlQXJncyhTdHJpbmdbXSBhcmdzKQogICAgICAgIHRocm93cyBJbGxlZ2Fs\nQXJndW1lbnRFeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIEJhc2ljUGFyc2VyIHBhcnNlciA9IG5ldyBCYXNpY1BhcnNlcigpOwogICAg\nICAgICAgICBDb21tYW5kTGluZSBjbWRMaW5lID0gcGFyc2VyLnBhcnNlKGJr\nT3B0cywgYXJncyk7CgogICAgICAgICAgICBpZiAoY21kTGluZS5oYXNPcHRp\nb24oJ2gnKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxB\ncmd1bWVudEV4Y2VwdGlvbigpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmln\ndXJhdGlvbigpOwogICAgICAgICAgICBTdHJpbmdbXSBsZWZ0QXJncyA9IGNt\nZExpbmUuZ2V0QXJncygpOwoKICAgICAgICAgICAgaWYgKGNtZExpbmUuaGFz\nT3B0aW9uKCdjJykpIHsKICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGxl\nZnRBcmdzICYmIGxlZnRBcmdzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCk7\nCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBTdHJpbmcgY29u\nZkZpbGUgPSBjbWRMaW5lLmdldE9wdGlvblZhbHVlKCJjIik7CiAgICAgICAg\nICAgICAgICBsb2FkQ29uZkZpbGUoY29uZiwgY29uZkZpbGUpOwogICAgICAg\nICAgICAgICAgcmV0dXJuIGNvbmY7CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIGlmIChsZWZ0QXJncy5sZW5ndGggPCA0KSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKCk7CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIGNvbW1hbmQgbGluZSBhcmd1bWVu\ndHMgb3ZlcndyaXRlIHNldHRpbmdzIGluIGNvbmZpZ3VyYXRpb24gZmlsZQog\nICAgICAgICAgICBjb25mLnNldEJvb2tpZVBvcnQoSW50ZWdlci5wYXJzZUlu\ndChsZWZ0QXJnc1swXSkpOwogICAgICAgICAgICBjb25mLnNldFprU2VydmVy\ncyhsZWZ0QXJnc1sxXSk7CiAgICAgICAgICAgIGNvbmYuc2V0Sm91cm5hbERp\nck5hbWUobGVmdEFyZ3NbMl0pOwogICAgICAgICAgICBTdHJpbmdbXSBsZWRn\nZXJEaXJOYW1lcyA9IG5ldyBTdHJpbmdbbGVmdEFyZ3MubGVuZ3RoIC0gM107\nCiAgICAgICAgICAgIFN5c3RlbS5hcnJheWNvcHkobGVmdEFyZ3MsIDMsIGxl\nZGdlckRpck5hbWVzLCAwLCBsZWRnZXJEaXJOYW1lcy5sZW5ndGgpOwogICAg\nICAgICAgICBjb25mLnNldExlZGdlckRpck5hbWVzKGxlZGdlckRpck5hbWVz\nKTsKCiAgICAgICAgICAgIHJldHVybiBjb25mOwogICAgICAgIH0gY2F0Y2gg\nKFBhcnNlRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJF\ncnJvciBwYXJzaW5nIGNvbW1hbmQgbGluZSBhcmd1bWVudHMgOiAiLCBlKTsK\nICAgICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxBcmd1bWVudEV4Y2VwdGlv\nbihlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBAcGFyYW0g\nYXJncwogICAgICogQHRocm93cyBJT0V4Y2VwdGlvbgogICAgICogQHRocm93\ncyBJbnRlcnJ1cHRlZEV4Y2VwdGlvbgogICAgICovCiAgICBwdWJsaWMgc3Rh\ndGljIHZvaWQgbWFpbihTdHJpbmdbXSBhcmdzKSB7CiAgICAgICAgU2VydmVy\nQ29uZmlndXJhdGlvbiBjb25mID0gbnVsbDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBjb25mID0gcGFyc2VBcmdzKGFyZ3MpOwogICAgICAgIH0gY2F0\nY2ggKElsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbiBpYWUpIHsKICAgICAgICAg\nICAgTE9HLmVycm9yKCJFcnJvciBwYXJzaW5nIGNvbW1hbmQgbGluZSBhcmd1\nbWVudHMgOiAiLCBpYWUpOwogICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50\nbG4oaWFlLmdldE1lc3NhZ2UoKSk7CiAgICAgICAgICAgIHByaW50VXNhZ2Uo\nKTsKICAgICAgICAgICAgU3lzdGVtLmV4aXQoRXhpdENvZGUuSU5WQUxJRF9D\nT05GKTsKICAgICAgICB9CgogICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBu\nZXcgU3RyaW5nQnVpbGRlcigpOwogICAgICAgIFN0cmluZ1tdIGxlZGdlckRp\nck5hbWVzID0gY29uZi5nZXRMZWRnZXJEaXJOYW1lcygpOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbGVkZ2VyRGlyTmFtZXMubGVuZ3RoOyBpKysp\nIHsKICAgICAgICAgICAgaWYgKGkgIT0gMCkgewogICAgICAgICAgICAgICAg\nc2IuYXBwZW5kKCcsJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc2Iu\nYXBwZW5kKGxlZGdlckRpck5hbWVzW2ldKTsKICAgICAgICB9CgogICAgICAg\nIFN0cmluZyBoZWxsbyA9IFN0cmluZy5mb3JtYXQoCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICJIZWxsbywgSSdtIHlvdXIgYm9va2llLCBsaXN0ZW5p\nbmcgb24gcG9ydCAlMSRzLiBaS1NlcnZlcnMgYXJlIG9uICUyJHMuIEpvdXJu\nYWxzIGFyZSBpbiAlMyRzLiBMZWRnZXJzIGFyZSBzdG9yZWQgaW4gJTQkcy4i\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICBjb25mLmdldEJvb2tpZVBv\ncnQoKSwgY29uZi5nZXRaa1NlcnZlcnMoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgY29uZi5nZXRKb3VybmFsRGlyTmFtZSgpLCBzYik7CiAgICAg\nICAgTE9HLmluZm8oaGVsbG8pOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGZpbmFsIEJvb2tpZVNlcnZlciBicyA9IG5ldyBCb29raWVTZXJ2ZXIoY29u\nZik7CiAgICAgICAgICAgIGJzLnN0YXJ0KCk7CiAgICAgICAgICAgIFJ1bnRp\nbWUuZ2V0UnVudGltZSgpLmFkZFNodXRkb3duSG9vayhuZXcgVGhyZWFkKCkg\newogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICAgICAgYnMuc2h1\ndGRvd24oKTsKICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygiU2h1dCBk\nb3duIGJvb2tpZSBzZXJ2ZXIgc3VjY2Vzc2Z1bGx5Iik7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBMT0cuaW5mbygi\nUmVnaXN0ZXIgc2h1dGRvd24gaG9vayBzdWNjZXNzZnVsbHkiKTsKICAgICAg\nICAgICAgYnMuam9pbigpOwoKICAgICAgICAgICAgU3lzdGVtLmV4aXQoYnMu\nZ2V0RXhpdENvZGUoKSk7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJFeGNlcHRpb24gcnVubmluZyBi\nb29raWUgc2VydmVyIDogIiwgZSk7CiAgICAgICAgICAgIFN5c3RlbS5leGl0\nKEV4aXRDb2RlLlNFUlZFUl9FWENFUFRJT04pOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCBwcm9jZXNzUGFja2V0KEJ5dGVCdWZmZXIgcGFj\na2V0LCBDbnhuIHNyYykgewogICAgICAgIFBhY2tldEhlYWRlciBoID0gUGFj\na2V0SGVhZGVyLmZyb21JbnQocGFja2V0LmdldEludCgpKTsKCiAgICAgICAg\nYm9vbGVhbiBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgaW50IHN0YXRUeXBl\nID0gQktTdGF0cy5TVEFUU19VTktOT1dOOwogICAgICAgIGxvbmcgc3RhcnRU\naW1lID0gMDsKICAgICAgICBpZiAoaXNTdGF0c0VuYWJsZWQpIHsKICAgICAg\nICAgICAgc3RhcnRUaW1lID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBwYWNrZXQgZm9ybWF0IGlzIGRpZmZl\ncmVudCBiZXR3ZWVuIEFEREVOVFJZIGFuZCBSRUFERU5UUlkKICAgICAgICBs\nb25nIGxlZGdlcklkID0gLTE7CiAgICAgICAgbG9uZyBlbnRyeUlkID0gQm9v\na2llUHJvdG9jb2wuSU5WQUxJRF9FTlRSWV9JRDsKICAgICAgICBieXRlW10g\nbWFzdGVyS2V5ID0gbnVsbDsKICAgICAgICBzd2l0Y2ggKGguZ2V0T3BDb2Rl\nKCkpIHsKICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkFEREVOVFJZOgog\nICAgICAgICAgICAvLyBmaXJzdCByZWFkIG1hc3RlciBrZXkKICAgICAgICAg\nICAgbWFzdGVyS2V5ID0gbmV3IGJ5dGVbQm9va2llUHJvdG9jb2wuTUFTVEVS\nX0tFWV9MRU5HVEhdOwogICAgICAgICAgICBwYWNrZXQuZ2V0KG1hc3Rlcktl\neSwgMCwgQm9va2llUHJvdG9jb2wuTUFTVEVSX0tFWV9MRU5HVEgpOwogICAg\nICAgICAgICBCeXRlQnVmZmVyIGJiID0gcGFja2V0LmR1cGxpY2F0ZSgpOwog\nICAgICAgICAgICBsZWRnZXJJZCA9IGJiLmdldExvbmcoKTsKICAgICAgICAg\nICAgZW50cnlJZCA9IGJiLmdldExvbmcoKTsKICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgY2FzZSBCb29raWVQcm90b2NvbC5SRUFERU5UUlk6CiAgICAg\nICAgICAgIGxlZGdlcklkID0gcGFja2V0LmdldExvbmcoKTsKICAgICAgICAg\nICAgZW50cnlJZCA9IHBhY2tldC5nZXRMb25nKCk7CiAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgIH0KCiAgICAgICAgaWYgKGguZ2V0VmVyc2lvbigpIDwg\nQm9va2llUHJvdG9jb2wuTE9XRVNUX0NPTVBBVF9QUk9UT0NPTF9WRVJTSU9O\nCiAgICAgICAgICAgIHx8IGguZ2V0VmVyc2lvbigpID4gQm9va2llUHJvdG9j\nb2wuQ1VSUkVOVF9QUk9UT0NPTF9WRVJTSU9OKSB7CiAgICAgICAgICAgIExP\nRy5lcnJvcigiSW52YWxpZCBwcm90b2NvbCB2ZXJzaW9uLCBleHBlY3RlZCBz\nb21ldGhpbmcgYmV0d2VlbiAiCiAgICAgICAgICAgICAgICAgICAgICArIEJv\nb2tpZVByb3RvY29sLkxPV0VTVF9DT01QQVRfUFJPVE9DT0xfVkVSU0lPTiAK\nICAgICAgICAgICAgICAgICAgICAgICsgIiAmICIgKyBCb29raWVQcm90b2Nv\nbC5DVVJSRU5UX1BST1RPQ09MX1ZFUlNJT04KICAgICAgICAgICAgICAgICAg\nICArICIuIGdvdCAiICsgaC5nZXRWZXJzaW9uKCkpOwogICAgICAgICAgICBz\ncmMuc2VuZFJlc3BvbnNlKGJ1aWxkUmVzcG9uc2UoQm9va2llUHJvdG9jb2wu\nRUJBRFZFUlNJT04sIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgaC5nZXRWZXJzaW9uKCksIGguZ2V0T3BDb2RlKCksIGxl\nZGdlcklkLCBlbnRyeUlkKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CiAgICAgICAgc2hvcnQgZmxhZ3MgPSBoLmdldEZsYWdzKCk7CiAgICAg\nICAgc3dpdGNoIChoLmdldE9wQ29kZSgpKSB7CiAgICAgICAgY2FzZSBCb29r\naWVQcm90b2NvbC5BRERFTlRSWToKICAgICAgICAgICAgc3RhdFR5cGUgPSBC\nS1N0YXRzLlNUQVRTX0FERDsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIFRpbWVkQ254biB0c3JjID0gbmV3IFRpbWVkQ254bihzcmMsIHN0\nYXJ0VGltZSk7CiAgICAgICAgICAgICAgICAvLyBMT0cuZGVidWcoIk1hc3Rl\nciBrZXk6ICIgKyBuZXcgU3RyaW5nKG1hc3RlcktleSkpOwogICAgICAgICAg\nICAgICAgaWYgKChmbGFncyAmIEJvb2tpZVByb3RvY29sLkZMQUdfUkVDT1ZF\nUllfQUREKSA9PSBCb29raWVQcm90b2NvbC5GTEFHX1JFQ09WRVJZX0FERCkg\newogICAgICAgICAgICAgICAgICAgIGJvb2tpZS5yZWNvdmVyeUFkZEVudHJ5\nKHBhY2tldC5zbGljZSgpLCB0aGlzLCB0c3JjLCBtYXN0ZXJLZXkpOwogICAg\nICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBib29r\naWUuYWRkRW50cnkocGFja2V0LnNsaWNlKCksIHRoaXMsIHRzcmMsIG1hc3Rl\ncktleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBzdWNj\nZXNzID0gdHJ1ZTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJFcnJvciB3cml0aW5n\nICIgKyBlbnRyeUlkICsgIkAiICsgbGVkZ2VySWQsIGUpOwogICAgICAgICAg\nICAgICAgc3JjLnNlbmRSZXNwb25zZShidWlsZFJlc3BvbnNlKEJvb2tpZVBy\nb3RvY29sLkVJTywgaC5nZXRWZXJzaW9uKCksIGguZ2V0T3BDb2RlKCksIGxl\nZGdlcklkLCBlbnRyeUlkKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJvb2tp\nZUV4Y2VwdGlvbi5MZWRnZXJGZW5jZWRFeGNlcHRpb24gbGZlKSB7CiAgICAg\nICAgICAgICAgICBMT0cuZXJyb3IoIkF0dGVtcHQgdG8gd3JpdGUgdG8gZmVu\nY2VkIGxlZGdlciIsIGxmZSk7CiAgICAgICAgICAgICAgICBzcmMuc2VuZFJl\nc3BvbnNlKGJ1aWxkUmVzcG9uc2UoQm9va2llUHJvdG9jb2wuRUZFTkNFRCwg\naC5nZXRWZXJzaW9uKCksIGguZ2V0T3BDb2RlKCksIGxlZGdlcklkLCBlbnRy\neUlkKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlVuYXV0aG9yaXplZCBh\nY2Nlc3MgdG8gbGVkZ2VyICIgKyBsZWRnZXJJZCwgZSk7CiAgICAgICAgICAg\nICAgICBzcmMuc2VuZFJlc3BvbnNlKGJ1aWxkUmVzcG9uc2UoQm9va2llUHJv\ndG9jb2wuRVVBLCBoLmdldFZlcnNpb24oKSwgaC5nZXRPcENvZGUoKSwgbGVk\nZ2VySWQsIGVudHJ5SWQpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBi\ncmVhazsKICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLlJFQURFTlRSWToK\nICAgICAgICAgICAgc3RhdFR5cGUgPSBCS1N0YXRzLlNUQVRTX1JFQUQ7CiAg\nICAgICAgICAgIEJ5dGVCdWZmZXJbXSByc3AgPSBuZXcgQnl0ZUJ1ZmZlclsy\nXTsKICAgICAgICAgICAgTE9HLmRlYnVnKCJSZWNlaXZlZCBuZXcgcmVhZCBy\nZXF1ZXN0OiAiICsgbGVkZ2VySWQgKyAiLCAiICsgZW50cnlJZCk7CiAgICAg\nICAgICAgIGludCBlcnJvckNvZGUgPSBCb29raWVQcm90b2NvbC5FSU87CiAg\nICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBpZiAoKGZsYWdzICYg\nQm9va2llUHJvdG9jb2wuRkxBR19ET19GRU5DSU5HKSA9PSBCb29raWVQcm90\nb2NvbC5GTEFHX0RPX0ZFTkNJTkcpIHsKICAgICAgICAgICAgICAgICAgICBM\nT0cud2FybigiTGVkZ2VyICIgKyBsZWRnZXJJZCArICIgZmVuY2VkIGJ5ICIg\nKyBzcmMuZ2V0UGVlck5hbWUoKSk7CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGguZ2V0VmVyc2lvbigpID49IDIpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgbWFzdGVyS2V5ID0gbmV3IGJ5dGVbQm9va2llUHJvdG9jb2wuTUFTVEVS\nX0tFWV9MRU5HVEhdOwogICAgICAgICAgICAgICAgICAgICAgICBwYWNrZXQu\nZ2V0KG1hc3RlcktleSwgMCwgQm9va2llUHJvdG9jb2wuTUFTVEVSX0tFWV9M\nRU5HVEgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgYm9va2llLmZlbmNl\nTGVkZ2VyKGxlZGdlcklkLCBtYXN0ZXJLZXkpOwogICAgICAgICAgICAgICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIExPRy5lcnJv\ncigiUGFzc3dvcmQgbm90IHByb3ZpZGVkLCBOb3Qgc2FmZSB0byBmZW5jZSB7\nfSIsIGxlZGdlcklkKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cg\nQm9va2llRXhjZXB0aW9uLmNyZWF0ZShCb29raWVFeGNlcHRpb24uQ29kZS5V\nbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb24pOwogICAgICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJzcFsx\nXSA9IGJvb2tpZS5yZWFkRW50cnkobGVkZ2VySWQsIGVudHJ5SWQpOwogICAg\nICAgICAgICAgICAgTE9HLmRlYnVnKCIjIyMjIyBSZWFkIGVudHJ5ICMjIyMj\nICIgKyByc3BbMV0ucmVtYWluaW5nKCkpOwogICAgICAgICAgICAgICAgZXJy\nb3JDb2RlID0gQm9va2llUHJvdG9jb2wuRU9LOwogICAgICAgICAgICAgICAg\nc3VjY2VzcyA9IHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5O\nb0xlZGdlckV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBpZiAoTE9H\nLmlzVHJhY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICBMT0cu\nZXJyb3IoIkVycm9yIHJlYWRpbmcgIiArIGVudHJ5SWQgKyAiQCIgKyBsZWRn\nZXJJZCwgZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBl\ncnJvckNvZGUgPSBCb29raWVQcm90b2NvbC5FTk9MRURHRVI7CiAgICAgICAg\nICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgICAgIExPRy5lcnJvcigiRXJyb3IgcmVhZGluZyAiICsg\nZW50cnlJZCArICJAIiArIGxlZGdlcklkLCBlKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgIGVycm9yQ29kZSA9IEJvb2tpZVByb3RvY29s\nLkVOT0VOVFJZOwogICAgICAgICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgICAgICBpZiAoTE9HLmlzVHJhY2VFbmFibGVkKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkVycm9yIHJlYWRp\nbmcgIiArIGVudHJ5SWQgKyAiQCIgKyBsZWRnZXJJZCwgZSk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBlcnJvckNvZGUgPSBCb29raWVQ\ncm90b2NvbC5FSU87CiAgICAgICAgICAgIH0gY2F0Y2ggKEJvb2tpZUV4Y2Vw\ndGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIlVuYXV0aG9y\naXplZCBhY2Nlc3MgdG8gbGVkZ2VyICIgKyBsZWRnZXJJZCwgZSk7CiAgICAg\nICAgICAgICAgICBlcnJvckNvZGUgPSBCb29raWVQcm90b2NvbC5FVUE7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgcnNwWzBdID0gYnVpbGRSZXNwb25z\nZShlcnJvckNvZGUsIGguZ2V0VmVyc2lvbigpLCBoLmdldE9wQ29kZSgpLCBs\nZWRnZXJJZCwgZW50cnlJZCk7CgogICAgICAgICAgICBpZiAoTE9HLmlzVHJh\nY2VFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIExPRy50cmFjZSgiUmVh\nZCBlbnRyeSByYyA9ICIgKyBlcnJvckNvZGUgKyAiIGZvciAiICsgZW50cnlJ\nZCArICJAIiArIGxlZGdlcklkKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBpZiAocnNwWzFdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIFdl\nIGhhdmVuJ3QgZmlsbGVkIGluIGVudHJ5IGRhdGEsIHNvIHdlIGhhdmUgdG8g\nc2VuZCBiYWNrCiAgICAgICAgICAgICAgICAvLyB0aGUgbGVkZ2VyIGFuZCBl\nbnRyeSBpZHMgaGVyZQogICAgICAgICAgICAgICAgcnNwWzFdID0gQnl0ZUJ1\nZmZlci5hbGxvY2F0ZSgxNik7CiAgICAgICAgICAgICAgICByc3BbMV0ucHV0\nTG9uZyhsZWRnZXJJZCk7CiAgICAgICAgICAgICAgICByc3BbMV0ucHV0TG9u\nZyhlbnRyeUlkKTsKICAgICAgICAgICAgICAgIHJzcFsxXS5mbGlwKCk7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgTE9HLmRlYnVnKCJTZW5kaW5nIHJl\nc3BvbnNlIGZvcjogIiArIGVudHJ5SWQgKyAiLCAiICsgbmV3IFN0cmluZyhy\nc3BbMV0uYXJyYXkoKSkpOwogICAgICAgICAgICBzcmMuc2VuZFJlc3BvbnNl\nKHJzcCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAg\nICAgICAgICAgIHNyYy5zZW5kUmVzcG9uc2UoYnVpbGRSZXNwb25zZShCb29r\naWVQcm90b2NvbC5FQkFEUkVRLCBoLmdldFZlcnNpb24oKSwgaC5nZXRPcENv\nZGUoKSwgbGVkZ2VySWQsIGVudHJ5SWQpKTsKICAgICAgICB9CiAgICAgICAg\naWYgKGlzU3RhdHNFbmFibGVkKSB7CiAgICAgICAgICAgIGlmIChzdWNjZXNz\nKSB7CiAgICAgICAgICAgICAgICAvLyBmb3IgYWRkIG9wZXJhdGlvbnMsIHdl\nIGNvbXB1dGUgbGF0ZW5jeSBpbiB3cml0ZUNvbXBsZXRlIGNhbGxiYWNrcy4K\nICAgICAgICAgICAgICAgIGlmIChzdGF0VHlwZSAhPSBCS1N0YXRzLlNUQVRT\nX0FERCkgewogICAgICAgICAgICAgICAgICAgIGxvbmcgZWxhcHNlZFRpbWUg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0VGltZTsKICAg\nICAgICAgICAgICAgICAgICBia1N0YXRzLmdldE9wU3RhdHMoc3RhdFR5cGUp\nLnVwZGF0ZUxhdGVuY3koZWxhcHNlZFRpbWUpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgYmtTdGF0\ncy5nZXRPcFN0YXRzKHN0YXRUeXBlKS5pbmNyZW1lbnRGYWlsZWRPcHMoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIEJ5\ndGVCdWZmZXIgYnVpbGRSZXNwb25zZShpbnQgZXJyb3JDb2RlLCBieXRlIHZl\ncnNpb24sIGJ5dGUgb3BDb2RlLCBsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5\nSWQpIHsKICAgICAgICBCeXRlQnVmZmVyIHJzcCA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoMjQpOwogICAgICAgIHJzcC5wdXRJbnQobmV3IFBhY2tldEhlYWRl\ncih2ZXJzaW9uLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgb3BDb2RlLCAoc2hvcnQpMCkudG9JbnQoKSk7CiAgICAgICAgcnNwLnB1\ndEludChlcnJvckNvZGUpOwogICAgICAgIHJzcC5wdXRMb25nKGxlZGdlcklk\nKTsKICAgICAgICByc3AucHV0TG9uZyhlbnRyeUlkKTsKCiAgICAgICAgcnNw\nLmZsaXAoKTsKICAgICAgICByZXR1cm4gcnNwOwogICAgfQoKICAgIHB1Ymxp\nYyB2b2lkIHdyaXRlQ29tcGxldGUoaW50IHJjLCBsb25nIGxlZGdlcklkLCBs\nb25nIGVudHJ5SWQsIEluZXRTb2NrZXRBZGRyZXNzIGFkZHIsIE9iamVjdCBj\ndHgpIHsKICAgICAgICBUaW1lZENueG4gdGNueG4gPSAoVGltZWRDbnhuKSBj\ndHg7CiAgICAgICAgQ254biBzcmMgPSB0Y254bi5jbnhuOwogICAgICAgIGxv\nbmcgc3RhcnRUaW1lID0gdGNueG4udGltZTsKICAgICAgICBCeXRlQnVmZmVy\nIGJiID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgyNCk7CiAgICAgICAgYmIucHV0\nSW50KG5ldyBQYWNrZXRIZWFkZXIoQm9va2llUHJvdG9jb2wuQ1VSUkVOVF9Q\nUk9UT0NPTF9WRVJTSU9OLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBCb29raWVQcm90b2NvbC5BRERFTlRSWSwgKHNob3J0KTApLnRv\nSW50KCkpOwogICAgICAgIGJiLnB1dEludChyYyk7CiAgICAgICAgYmIucHV0\nTG9uZyhsZWRnZXJJZCk7CiAgICAgICAgYmIucHV0TG9uZyhlbnRyeUlkKTsK\nICAgICAgICBiYi5mbGlwKCk7CiAgICAgICAgaWYgKExPRy5pc1RyYWNlRW5h\nYmxlZCgpKSB7CiAgICAgICAgICAgIExPRy50cmFjZSgiQWRkIGVudHJ5IHJj\nID0gIiArIHJjICsgIiBmb3IgIiArIGVudHJ5SWQgKyAiQCIgKyBsZWRnZXJJ\nZCk7CiAgICAgICAgfQogICAgICAgIHNyYy5zZW5kUmVzcG9uc2UobmV3IEJ5\ndGVCdWZmZXJbXSB7IGJiIH0pOwogICAgICAgIGlmIChpc1N0YXRzRW5hYmxl\nZCkgewogICAgICAgICAgICAvLyBjb21wdXRlIHRoZSBsYXRlbmN5CiAgICAg\nICAgICAgIGlmICgwID09IHJjKSB7CiAgICAgICAgICAgICAgICAvLyBmb3Ig\nYWRkIG9wZXJhdGlvbnMsIHdlIGNvbXB1dGUgbGF0ZW5jeSBpbiB3cml0ZUNv\nbXBsZXRlIGNhbGxiYWNrcy4KICAgICAgICAgICAgICAgIGxvbmcgZWxhcHNl\nZFRpbWUgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0VGlt\nZTsKICAgICAgICAgICAgICAgIGJrU3RhdHMuZ2V0T3BTdGF0cyhCS1N0YXRz\nLlNUQVRTX0FERCkudXBkYXRlTGF0ZW5jeShlbGFwc2VkVGltZSk7CiAgICAg\nICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBia1N0YXRzLmdldE9w\nU3RhdHMoQktTdGF0cy5TVEFUU19BREQpLmluY3JlbWVudEZhaWxlZE9wcygp\nOyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIEEgY254biB3cmFwcGVyIGZvciB0aW1lCiAg\nICAgKi8KICAgIHN0YXRpYyBjbGFzcyBUaW1lZENueG4gewogICAgICAgIENu\neG4gY254bjsKICAgICAgICBsb25nIHRpbWU7CgogICAgICAgIHB1YmxpYyBU\naW1lZENueG4oQ254biBjbnhuLCBsb25nIHN0YXJ0VGltZSkgewogICAgICAg\nICAgICB0aGlzLmNueG4gPSBjbnhuOwogICAgICAgICAgICB0aGlzLnRpbWUg\nPSBzdGFydFRpbWU7CiAgICAgICAgfQogICAgfQoKfQo=\n","encoding":"base64"}

