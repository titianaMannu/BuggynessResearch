{"sha":"56dc6e6dec09e6b4d19303159af01a5566d43792","node_id":"MDQ6QmxvYjE1NzU5NTY6NTZkYzZlNmRlYzA5ZTZiNGQxOTMwMzE1OWFmMDFhNTU2NmQ0Mzc5Mg==","size":18907,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/56dc6e6dec09e6b4d19303159af01a5566d43792","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvOwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBq\nYXZhLm5pby5jaGFubmVscy5DYW5jZWxsZWRLZXlFeGNlcHRpb247CmltcG9y\ndCBqYXZhLm5pby5jaGFubmVscy5DaGFubmVsOwppbXBvcnQgamF2YS5uaW8u\nY2hhbm5lbHMuU2VsZWN0aW9uS2V5OwppbXBvcnQgamF2YS5uaW8uY2hhbm5l\nbHMuU2VsZWN0b3I7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5TZXJ2ZXJT\nb2NrZXRDaGFubmVsOwppbXBvcnQgamF2YS5uaW8uY2hhbm5lbHMuU29ja2V0\nQ2hhbm5lbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBq\nYXZhLnV0aWwuQ29sbGVjdGlvbnM7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNl\ndDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRp\nbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5MaW5rZWRCbG9j\na2luZ1F1ZXVlOwoKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jb25m\nLlNlcnZlckNvbmZpZ3VyYXRpb247CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\ncjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKLyoqCiAqIFRo\naXMgY2xhc3MgaGFuZGxlcyBjb21tdW5pY2F0aW9uIHdpdGggY2xpZW50cyB1\nc2luZyBOSU8uIFRoZXJlIGlzIG9uZSBDbnhuCiAqIHBlciBjbGllbnQsIGJ1\ndCBvbmx5IG9uZSB0aHJlYWQgZG9pbmcgdGhlIGNvbW11bmljYXRpb24uCiAq\nLwpwdWJsaWMgY2xhc3MgTklPU2VydmVyRmFjdG9yeSBleHRlbmRzIFRocmVh\nZCB7CgogICAgcHVibGljIGludGVyZmFjZSBQYWNrZXRQcm9jZXNzb3Igewog\nICAgICAgIHB1YmxpYyB2b2lkIHByb2Nlc3NQYWNrZXQoQnl0ZUJ1ZmZlciBw\nYWNrZXQsIENueG4gc3JjKTsKICAgIH0KCiAgICBTZXJ2ZXJTdGF0cyBzdGF0\ncyA9IG5ldyBTZXJ2ZXJTdGF0cygpOwoKICAgIExvZ2dlciBMT0cgPSBMb2dn\nZXJGYWN0b3J5LmdldExvZ2dlcihOSU9TZXJ2ZXJGYWN0b3J5LmNsYXNzKTsK\nCiAgICBTZXJ2ZXJTb2NrZXRDaGFubmVsIHNzOwoKICAgIFNlbGVjdG9yIHNl\nbGVjdG9yID0gU2VsZWN0b3Iub3BlbigpOwoKICAgIC8qKgogICAgICogV2Ug\ndXNlIHRoaXMgYnVmZmVyIHRvIGRvIGVmZmljaWVudCBzb2NrZXQgSS9PLiBT\naW5jZSB0aGVyZSBpcyBhIHNpbmdsZQogICAgICogc2VuZGVyIHRocmVhZCBw\nZXIgTklPU2VydmVyQ254biBpbnN0YW5jZSwgd2UgY2FuIHVzZSBhIG1lbWJl\nciB2YXJpYWJsZSB0bwogICAgICogb25seSBhbGxvY2F0ZSBpdCBvbmNlLgog\nICAgICovCiAgICBCeXRlQnVmZmVyIGRpcmVjdEJ1ZmZlciA9IEJ5dGVCdWZm\nZXIuYWxsb2NhdGVEaXJlY3QoNjQgKiAxMDI0KTsKCiAgICBIYXNoU2V0PENu\neG4+IGNueG5zID0gbmV3IEhhc2hTZXQ8Q254bj4oKTsKCiAgICBpbnQgb3V0\nc3RhbmRpbmdMaW1pdCA9IDIwMDA7CgogICAgUGFja2V0UHJvY2Vzc29yIHBy\nb2Nlc3NvcjsKCiAgICBsb25nIG1pbkxhdGVuY3kgPSA5OTk5OTk5OTsKCiAg\nICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmY7CgogICAgcHVibGljIE5JT1Nl\ncnZlckZhY3RvcnkoU2VydmVyQ29uZmlndXJhdGlvbiBjb25mLCBQYWNrZXRQ\ncm9jZXNzb3IgcHJvY2Vzc29yKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIHN1cGVyKCJOSU9TZXJ2ZXJGYWN0b3J5LSIgKyBjb25mLmdldEJvb2tp\nZVBvcnQoKSk7CiAgICAgICAgc2V0RGFlbW9uKHRydWUpOwogICAgICAgIHRo\naXMucHJvY2Vzc29yID0gcHJvY2Vzc29yOwogICAgICAgIHRoaXMuY29uZiA9\nIGNvbmY7CiAgICAgICAgdGhpcy5zcyA9IFNlcnZlclNvY2tldENoYW5uZWwu\nb3BlbigpOwogICAgICAgIHNzLnNvY2tldCgpLmJpbmQobmV3IEluZXRTb2Nr\nZXRBZGRyZXNzKGNvbmYuZ2V0Qm9va2llUG9ydCgpKSk7CiAgICAgICAgc3Mu\nY29uZmlndXJlQmxvY2tpbmcoZmFsc2UpOwogICAgICAgIHNzLnJlZ2lzdGVy\nKHNlbGVjdG9yLCBTZWxlY3Rpb25LZXkuT1BfQUNDRVBUKTsKICAgIH0KCiAg\nICBwdWJsaWMgSW5ldFNvY2tldEFkZHJlc3MgZ2V0TG9jYWxBZGRyZXNzKCkg\newogICAgICAgIHJldHVybiAoSW5ldFNvY2tldEFkZHJlc3MpIHNzLnNvY2tl\ndCgpLmdldExvY2FsU29ja2V0QWRkcmVzcygpOwogICAgfQoKICAgIHByaXZh\ndGUgdm9pZCBhZGRDbnhuKENueG4gY254bikgewogICAgICAgIHN5bmNocm9u\naXplZCAoY254bnMpIHsKICAgICAgICAgICAgY254bnMuYWRkKGNueG4pOwog\nICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBpc1J1bm5pbmco\nKSB7CiAgICAgICAgcmV0dXJuICFzcy5zb2NrZXQoKS5pc0Nsb3NlZCgpOwog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgIHdoaWxlICghc3Muc29ja2V0KCkuaXNDbG9zZWQoKSkgewogICAg\nICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgc2VsZWN0b3Iuc2VsZWN0\nKDEwMDApOwogICAgICAgICAgICAgICAgU2V0PFNlbGVjdGlvbktleT4gc2Vs\nZWN0ZWQ7CiAgICAgICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsK\nICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZCA9IHNlbGVjdG9yLnNlbGVj\ndGVkS2V5cygpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nQXJyYXlMaXN0PFNlbGVjdGlvbktleT4gc2VsZWN0ZWRMaXN0ID0gbmV3IEFy\ncmF5TGlzdDxTZWxlY3Rpb25LZXk+KHNlbGVjdGVkKTsKICAgICAgICAgICAg\nICAgIENvbGxlY3Rpb25zLnNodWZmbGUoc2VsZWN0ZWRMaXN0KTsKICAgICAg\nICAgICAgICAgIGZvciAoU2VsZWN0aW9uS2V5IGsgOiBzZWxlY3RlZExpc3Qp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAoKGsucmVhZHlPcHMoKSAmIFNl\nbGVjdGlvbktleS5PUF9BQ0NFUFQpICE9IDApIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgU29ja2V0Q2hhbm5lbCBzYyA9ICgoU2VydmVyU29ja2V0Q2hh\nbm5lbCkgay5jaGFubmVsKCkpLmFjY2VwdCgpOwogICAgICAgICAgICAgICAg\nICAgICAgICBzYy5jb25maWd1cmVCbG9ja2luZyhmYWxzZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIFNlbGVjdGlvbktleSBzayA9IHNjLnJlZ2lzdGVy\nKHNlbGVjdG9yLCBTZWxlY3Rpb25LZXkuT1BfUkVBRCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgIENueG4gY254biA9IG5ldyBDbnhuKHNjLCBzayk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHNrLmF0dGFjaChjbnhuKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgYWRkQ254bihjbnhuKTsKICAgICAgICAgICAg\nICAgICAgICB9IGVsc2UgaWYgKChrLnJlYWR5T3BzKCkgJiAoU2VsZWN0aW9u\nS2V5Lk9QX1JFQUQgfCBTZWxlY3Rpb25LZXkuT1BfV1JJVEUpKSAhPSAwKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIENueG4gYyA9IChDbnhuKSBrLmF0\ndGFjaG1lbnQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgYy5kb0lPKGsp\nOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIHNlbGVjdGVkLmNsZWFyKCk7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBMT0cud2Fy\nbigiRXhjZXB0aW9uIGluIHNlcnZlciBzb2NrZXQgbG9vcDogIiArIHNzLnNv\nY2tldCgpLmdldEluZXRBZGRyZXNzKCksIGUpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICAgIExPRy5pbmZvKCJOSU9TZXJ2ZXJDbnhuIGZhY3Rv\ncnkgZXhpdGVkbG9vcC4iKTsKICAgICAgICBjbGVhcigpOwogICAgfQoKICAg\nIC8qKgogICAgICogY2xlYXIgYWxsIHRoZSBjb25uZWN0aW9ucyBpbiB0aGUg\nc2VsZWN0b3IKICAgICAqCiAgICAgKi8KICAgIHN5bmNocm9uaXplZCBwdWJs\naWMgdm9pZCBjbGVhcigpIHsKICAgICAgICBzZWxlY3Rvci53YWtldXAoKTsK\nICAgICAgICBzeW5jaHJvbml6ZWQgKGNueG5zKSB7CiAgICAgICAgICAgIC8v\nIGdvdCB0byBjbGVhciBhbGwgdGhlIGNvbm5lY3Rpb25zIHRoYXQgd2UgaGF2\nZSBpbiB0aGUgc2VsZWN0b3IKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxD\nbnhuPiBpdCA9IGNueG5zLml0ZXJhdG9yKCk7IGl0Lmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgIENueG4gY254biA9IGl0Lm5leHQoKTsKICAgICAg\nICAgICAgICAgIGl0LnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgICAgICAgICBjbnhuLmNsb3NlKCk7CiAgICAgICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nICAgIC8vIERvIG5vdGhpbmcuCiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNodXRk\nb3duKCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHNzLmNsb3NlKCk7\nCiAgICAgICAgICAgIGNsZWFyKCk7CiAgICAgICAgICAgIHRoaXMuaW50ZXJy\ndXB0KCk7CiAgICAgICAgICAgIHRoaXMuam9pbigpOwogICAgICAgIH0gY2F0\nY2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLndhcm4oIkludGVycnVwdGVkIiwgZSk7CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJVbmV4cGVjdGVk\nIGV4Y2VwdGlvbiIsIGUpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAg\nICAqIFRoZSBidWZmZXIgd2lsbCBjYXVzZSB0aGUgY29ubmVjdGlvbiB0byBi\nZSBjbG9zZSB3aGVuIHdlIGRvIGEgc2VuZC4KICAgICAqLwogICAgc3RhdGlj\nIGZpbmFsIEJ5dGVCdWZmZXIgY2xvc2VDb25uID0gQnl0ZUJ1ZmZlci5hbGxv\nY2F0ZSgwKTsKCiAgICBwdWJsaWMgY2xhc3MgQ254biB7CgogICAgICAgIHBy\naXZhdGUgU29ja2V0Q2hhbm5lbCBzb2NrOwoKICAgICAgICBwcml2YXRlIFNl\nbGVjdGlvbktleSBzazsKCiAgICAgICAgYm9vbGVhbiBpbml0aWFsaXplZDsK\nCiAgICAgICAgQnl0ZUJ1ZmZlciBsZW5CdWZmZXIgPSBCeXRlQnVmZmVyLmFs\nbG9jYXRlKDQpOwoKICAgICAgICBCeXRlQnVmZmVyIGluY29taW5nQnVmZmVy\nID0gbGVuQnVmZmVyOwoKICAgICAgICBMaW5rZWRCbG9ja2luZ1F1ZXVlPEJ5\ndGVCdWZmZXI+IG91dGdvaW5nQnVmZmVycyA9IG5ldyBMaW5rZWRCbG9ja2lu\nZ1F1ZXVlPEJ5dGVCdWZmZXI+KCk7CgogICAgICAgIGludCBzZXNzaW9uVGlt\nZW91dDsKCiAgICAgICAgdm9pZCBkb0lPKFNlbGVjdGlvbktleSBrKSB0aHJv\nd3MgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgaWYgKHNvY2sgPT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIGlmIChrLmlzUmVhZGFibGUoKSkgewogICAgICAgICAgICAgICAg\nICAgIGludCByYyA9IHNvY2sucmVhZChpbmNvbWluZ0J1ZmZlcik7CiAgICAg\nICAgICAgICAgICAgICAgaWYgKHJjIDwgMCkgewogICAgICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlJlYWQgZXJyb3IiKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYg\nKGluY29taW5nQnVmZmVyLnJlbWFpbmluZygpID09IDApIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgaW5jb21pbmdCdWZmZXIuZmxpcCgpOwogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAoaW5jb21pbmdCdWZmZXIgPT0gbGVuQnVm\nZmVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkTGVuZ3Ro\nKGspOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgY254blN0YXRzLnBhY2tldHNSZWNlaXZl\nZCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgU2VydmVyU3RhdHMu\nZ2V0SW5zdGFuY2UoKS5pbmNyZW1lbnRQYWNrZXRzUmVjZWl2ZWQoKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgcmVhZFJlcXVlc3QoKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbGVuQnVmZmVyLmNsZWFyKCk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgaW5jb21pbmdCdWZmZXIgPSBsZW5CdWZm\nZXI7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoay5pc1dyaXRhYmxlKCkp\nIHsKICAgICAgICAgICAgICAgICAgICBpZiAob3V0Z29pbmdCdWZmZXJzLnNp\nemUoKSA+IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gWm9vTG9n\nLmxvZ1RyYWNlTWVzc2FnZShMT0csCiAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIFpvb0xvZy5DTElFTlRfREFUQV9QQUNLRVRfVFJBQ0VfTUFTSywKICAg\nICAgICAgICAgICAgICAgICAgICAgLy8gInNrICIgKyBrICsgIiBpcyB2YWxp\nZDogIiArCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGsuaXNWYWxpZCgp\nKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAg\nICAgICAgICAgICAqIFRoaXMgaXMgZ29pbmcgdG8gcmVzZXQgdGhlIGJ1ZmZl\nciBwb3NpdGlvbiB0byAwIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAg\nKiB0aGUgbGltaXQgdG8gdGhlIHNpemUgb2YgdGhlIGJ1ZmZlciwgc28gdGhh\ndCB3ZSBjYW4KICAgICAgICAgICAgICAgICAgICAgICAgICogZmlsbCBpdCB3\naXRoIGRhdGEgZnJvbSB0aGUgbm9uLWRpcmVjdCBidWZmZXJzIHRoYXQgd2UK\nICAgICAgICAgICAgICAgICAgICAgICAgICogbmVlZCB0byBzZW5kLgogICAg\nICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAg\nICAgZGlyZWN0QnVmZmVyLmNsZWFyKCk7CgogICAgICAgICAgICAgICAgICAg\nICAgICBmb3IgKEJ5dGVCdWZmZXIgYiA6IG91dGdvaW5nQnVmZmVycykgewog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRpcmVjdEJ1ZmZlci5y\nZW1haW5pbmcoKSA8IGIucmVtYWluaW5nKCkpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAqIFdoZW4gd2UgY2FsbCBwdXQgbGF0ZXIsIGlmIHRoZSBkaXJl\nY3RCdWZmZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBp\ncyB0byBzbWFsbCB0byBob2xkIGV2ZXJ5dGhpbmcsIG5vdGhpbmcgd2lsbAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIGJlIGNvcGllZCwg\nc28gd2UndmUgZ290IHRvIHNsaWNlIHRoZSBidWZmZXIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKiBpZiBpdCdzIHRvbyBiaWcuCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYiA9IChCeXRlQnVmZmVyKSBiLnNsaWNlKCku\nbGltaXQoZGlyZWN0QnVmZmVyLnJlbWFpbmluZygpKTsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8qCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBwdXQoKSBpcyBn\nb2luZyB0byBtb2RpZnkgdGhlIHBvc2l0aW9ucyBvZiBib3RoCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKiBidWZmZXJzLCBwdXQgd2UgZG9uJ3Qg\nd2FudCB0byBjaGFuZ2UgdGhlIHBvc2l0aW9uCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKiBvZiB0aGUgc291cmNlIGJ1ZmZlcnMgKHdlJ2xsIGRv\nIHRoYXQgYWZ0ZXIgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nKiBzZW5kLCBpZiBuZWVkZWQpLCBzbyB3ZSBzYXZlIGFuZCByZXNldCB0aGUK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHBvc2l0aW9uIGFmdGVy\nIHRoZSBjb3B5CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGludCBwID0gYi5wb3NpdGlvbigp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyZWN0QnVmZmVyLnB1\ndChiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIucG9zaXRpb24o\ncCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZGlyZWN0QnVm\nZmVyLnJlbWFpbmluZygpID09IDApIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICAvKgogICAgICAgICAgICAgICAgICAgICAgICAgKiBEbyB0aGUg\nZmxpcDogbGltaXQgYmVjb21lcyBwb3NpdGlvbiwgcG9zaXRpb24gZ2V0cwog\nICAgICAgICAgICAgICAgICAgICAgICAgKiBzZXQgdG8gMC4gVGhpcyBzZXRz\nIHVzIHVwIGZvciB0aGUgd3JpdGUuCiAgICAgICAgICAgICAgICAgICAgICAg\nICAqLwogICAgICAgICAgICAgICAgICAgICAgICBkaXJlY3RCdWZmZXIuZmxp\ncCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgaW50IHNlbnQgPSBzb2Nr\nLndyaXRlKGRpcmVjdEJ1ZmZlcik7CiAgICAgICAgICAgICAgICAgICAgICAg\nIEJ5dGVCdWZmZXIgYmI7CgogICAgICAgICAgICAgICAgICAgICAgICAvLyBS\nZW1vdmUgdGhlIGJ1ZmZlcnMgdGhhdCB3ZSBoYXZlIHNlbnQKICAgICAgICAg\nICAgICAgICAgICAgICAgd2hpbGUgKG91dGdvaW5nQnVmZmVycy5zaXplKCkg\nPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYiA9IG91dGdv\naW5nQnVmZmVycy5wZWVrKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoYmIgPT0gY2xvc2VDb25uKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJjbG9zaW5nIik7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpbnQgbGVmdCA9IGJiLnJlbWFpbmluZygpIC0gc2Vu\ndDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsZWZ0ID4gMCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICogV2Ugb25seSBwYXJ0aWFsbHkg\nc2VudCB0aGlzIGJ1ZmZlciwgc28gd2UKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKiB1cGRhdGUgdGhlIHBvc2l0aW9uIGFuZCBleGl0IHRo\nZSBsb29wLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqLwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJiLnBvc2l0aW9uKGJi\nLnBvc2l0aW9uKCkgKyBzZW50KTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNueG5TdGF0cy5wYWNrZXRz\nU2VudCsrOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogV2UndmUg\nc2VudCB0aGUgd2hvbGUgYnVmZmVyLCBzbyBkcm9wIHRoZSBidWZmZXIgKi8K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbnQgLT0gYmIucmVtYWlu\naW5nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXJ2ZXJTdGF0\ncy5nZXRJbnN0YW5jZSgpLmluY3JlbWVudFBhY2tldHNTZW50KCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBvdXRnb2luZ0J1ZmZlcnMucmVtb3Zl\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gWm9vTG9nLmxvZ1RyYWNlTWVzc2FnZShMT0csCiAgICAg\nICAgICAgICAgICAgICAgICAgIC8vIFpvb0xvZy5DTElFTlRfREFUQV9QQUNL\nRVRfVFJBQ0VfTUFTSywgImFmdGVyIHNlbmQsCiAgICAgICAgICAgICAgICAg\nICAgICAgIC8vIG91dGdvaW5nQnVmZmVycy5zaXplKCkgPSAiICsgb3V0Z29p\nbmdCdWZmZXJzLnNpemUoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAg\nICAgICAgICAgICAgICAgICBpZiAob3V0Z29pbmdCdWZmZXJzLnNpemUoKSA9\nPSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWluaXRp\nYWxpemVkICYmIChzay5pbnRlcmVzdE9wcygpICYgU2VsZWN0aW9uS2V5Lk9Q\nX1JFQUQpID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIlJlc3BvbmRlZCB0byBpbmZvIHBy\nb2JlIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBzay5pbnRlcmVzdE9wcyhzay5pbnRlcmVz\ndE9wcygpICYgKH5TZWxlY3Rpb25LZXkuT1BfV1JJVEUpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHNrLmludGVyZXN0T3BzKHNrLmludGVyZXN0T3BzKCkgfCBTZWxl\nY3Rpb25LZXkuT1BfV1JJVEUpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9IGNhdGNoIChDYW5jZWxsZWRLZXlFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgLy8gTE9HLmVycm9y\nKCJGSVhNU0ciLGUpOwogICAgICAgICAgICAgICAgY2xvc2UoKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHJlYWRS\nZXF1ZXN0KCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAgICAgICAgaW5j\nb21pbmdCdWZmZXIgPSBpbmNvbWluZ0J1ZmZlci5zbGljZSgpOwogICAgICAg\nICAgICBwcm9jZXNzb3IucHJvY2Vzc1BhY2tldChpbmNvbWluZ0J1ZmZlciwg\ndGhpcyk7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBkaXNhYmxl\nUmVjdigpIHsKICAgICAgICAgICAgc2suaW50ZXJlc3RPcHMoc2suaW50ZXJl\nc3RPcHMoKSAmICh+U2VsZWN0aW9uS2V5Lk9QX1JFQUQpKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIGVuYWJsZVJlY3YoKSB7CiAgICAgICAg\nICAgIGlmIChzay5pc1ZhbGlkKCkpIHsKICAgICAgICAgICAgICAgIGludCBp\nbnRlcmVzdCA9IHNrLmludGVyZXN0T3BzKCk7CiAgICAgICAgICAgICAgICBp\nZiAoKGludGVyZXN0ICYgU2VsZWN0aW9uS2V5Lk9QX1JFQUQpID09IDApIHsK\nICAgICAgICAgICAgICAgICAgICBzay5pbnRlcmVzdE9wcyhpbnRlcmVzdCB8\nIFNlbGVjdGlvbktleS5PUF9SRUFEKTsKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHJl\nYWRMZW5ndGgoU2VsZWN0aW9uS2V5IGspIHRocm93cyBJT0V4Y2VwdGlvbiB7\nCiAgICAgICAgICAgIC8vIFJlYWQgdGhlIGxlbmd0aCwgbm93IGdldCB0aGUg\nYnVmZmVyCiAgICAgICAgICAgIGludCBsZW4gPSBsZW5CdWZmZXIuZ2V0SW50\nKCk7CiAgICAgICAgICAgIGlmIChsZW4gPCAwIHx8IGxlbiA+IDB4ZmZmZmYp\nIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiTGVu\nIGVycm9yICIgKyBsZW4pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlu\nY29taW5nQnVmZmVyID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZShsZW4pOwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVGhlIG51bWJlciBvZiBy\nZXF1ZXN0cyB0aGF0IGhhdmUgYmVlbiBzdWJtaXR0ZWQgYnV0IG5vdCB5ZXQg\ncmVzcG9uZGVkCiAgICAgICAgICogdG8uCiAgICAgICAgICovCiAgICAgICAg\naW50IG91dHN0YW5kaW5nUmVxdWVzdHM7CgogICAgICAgIC8qCiAgICAgICAg\nICogKG5vbi1KYXZhZG9jKQogICAgICAgICAqCiAgICAgICAgICogQHNlZSBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5zZXJ2ZXIuU2VydmVyQ254bklmYWNlI2dl\ndFNlc3Npb25UaW1lb3V0KCkKICAgICAgICAgKi8KICAgICAgICBwdWJsaWMg\naW50IGdldFNlc3Npb25UaW1lb3V0KCkgewogICAgICAgICAgICByZXR1cm4g\nc2Vzc2lvblRpbWVvdXQ7CiAgICAgICAgfQoKICAgICAgICBTdHJpbmcgcGVl\nck5hbWUgPSBudWxsOwoKICAgICAgICBwdWJsaWMgQ254bihTb2NrZXRDaGFu\nbmVsIHNvY2ssIFNlbGVjdGlvbktleSBzaykgdGhyb3dzIElPRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgdGhpcy5zb2NrID0gc29jazsKICAgICAgICAgICAg\ndGhpcy5zayA9IHNrOwogICAgICAgICAgICBzb2NrLnNvY2tldCgpLnNldFRj\ncE5vRGVsYXkoY29uZi5nZXRTZXJ2ZXJUY3BOb0RlbGF5KCkpOwogICAgICAg\nICAgICBzb2NrLnNvY2tldCgpLnNldFNvTGluZ2VyKHRydWUsIDIpOwogICAg\nICAgICAgICBzay5pbnRlcmVzdE9wcyhTZWxlY3Rpb25LZXkuT1BfUkVBRCk7\nCiAgICAgICAgICAgIGlmIChMT0cuaXNUcmFjZUVuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgcGVlck5hbWUgPSBzb2NrLnNvY2tldCgpLnRvU3RyaW5n\nKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxlbkJ1ZmZlci5jbGVh\ncigpOwogICAgICAgICAgICBpbmNvbWluZ0J1ZmZlciA9IGxlbkJ1ZmZlcjsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBT\ndHJpbmcgdG9TdHJpbmcoKSB7CiAgICAgICAgICAgIHJldHVybiAiTklPU2Vy\ndmVyQ254biBvYmplY3Qgd2l0aCBzb2NrID0gIiArIHNvY2sgKyAiIGFuZCBz\nayA9ICIgKyBzazsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcg\nZ2V0UGVlck5hbWUoKSB7CiAgICAgICAgICAgIGlmIChwZWVyTmFtZSA9PSBu\ndWxsKSB7CiAgICAgICAgICAgICAgICBwZWVyTmFtZSA9IHNvY2suc29ja2V0\nKCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1\ncm4gcGVlck5hbWU7CiAgICAgICAgfQoKICAgICAgICBib29sZWFuIGNsb3Nl\nZDsKCiAgICAgICAgLyoKICAgICAgICAgKiAobm9uLUphdmFkb2MpCiAgICAg\nICAgICoKICAgICAgICAgKiBAc2VlIG9yZy5hcGFjaGUuem9va2VlcGVyLnNl\ncnZlci5TZXJ2ZXJDbnhuSWZhY2UjY2xvc2UoKQogICAgICAgICAqLwogICAg\nICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgICAgICBpZiAoY2xv\nc2VkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgY2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgc3luY2hy\nb25pemVkIChjbnhucykgewogICAgICAgICAgICAgICAgY254bnMucmVtb3Zl\nKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIExPRy5kZWJ1Zygi\nY2xvc2UgIE5JT1NlcnZlckNueG46ICIgKyBzb2NrKTsKICAgICAgICAgICAg\ndHJ5IHsKICAgICAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAgICAgKiBU\naGUgZm9sbG93aW5nIHNlcXVlbmNlIG9mIGNvZGUgaXMgc3R1cGlkISBZb3Ug\nd291bGQgdGhpbmsKICAgICAgICAgICAgICAgICAqIHRoYXQgb25seSBzb2Nr\nLmNsb3NlKCkgaXMgbmVlZGVkLCBidXQgYWxhcywgaXQgZG9lc24ndCB3b3Jr\nCiAgICAgICAgICAgICAgICAgKiB0aGF0IHdheS4gSWYgeW91IGp1c3QgZG8g\nc29jay5jbG9zZSgpIHRoZXJlIGFyZSBjYXNlcyB3aGVyZQogICAgICAgICAg\nICAgICAgICogdGhlIHNvY2tldCBkb2Vzbid0IGFjdHVhbGx5IGNsb3NlLi4u\nCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIHNvY2suc29j\na2V0KCkuc2h1dGRvd25PdXRwdXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAo\nSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBh\nIHJlbGF0aXZlbHkgY29tbW9uIGV4Y2VwdGlvbiB0aGF0IHdlIGNhbid0IGF2\nb2lkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHNvY2suc29ja2V0KCkuc2h1dGRvd25JbnB1dCgpOwogICAgICAg\nICAgICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHNvY2suc29ja2V0\nKCkuY2xvc2UoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJGSVhNU0ciLCBlKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgc29jay5jbG9zZSgpOwogICAgICAgICAgICAgICAgLy8gWFhYIFRoZSBu\nZXh0IGxpbmUgZG9lc24ndCBzZWVtIHRvIGJlIG5lZWRlZCwgYnV0IHNvbWUg\ncG9zdHMKICAgICAgICAgICAgICAgIC8vIHRvIGZvcnVtcyBzdWdnZXN0IHRo\nYXQgaXQgaXMgbmVlZGVkLiBLZWVwIGluIG1pbmQgaWYgZXJyb3JzCiAgICAg\nICAgICAgICAgICAvLyBpbgogICAgICAgICAgICAgICAgLy8gdGhpcyBzZWN0\naW9uIGFyaXNlLgogICAgICAgICAgICAgICAgLy8gZmFjdG9yeS5zZWxlY3Rv\nci53YWtldXAoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSU9FeGNlcHRpb24g\nZSkgewogICAgICAgICAgICAgICAgTE9HLmVycm9yKCJGSVhNU0ciLCBlKTsK\nICAgICAgICAgICAgfQogICAgICAgICAgICBzb2NrID0gbnVsbDsKICAgICAg\nICAgICAgaWYgKHNrICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICAgICAgLy8gbmVlZCB0byBjYW5jZWwgdGhpcyBz\nZWxlY3Rpb24ga2V5IGZyb20gdGhlIHNlbGVjdG9yCiAgICAgICAgICAgICAg\nICAgICAgc2suY2FuY2VsKCk7CiAgICAgICAgICAgICAgICB9IGNhdGNoIChF\neGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZvaWQgbWFrZVdyaXRhYmxl\nKFNlbGVjdGlvbktleSBzaykgewogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgc2VsZWN0b3Iud2FrZXVwKCk7CiAgICAgICAgICAgICAgICBp\nZiAoc2suaXNWYWxpZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgc2suaW50\nZXJlc3RPcHMoc2suaW50ZXJlc3RPcHMoKSB8IFNlbGVjdGlvbktleS5PUF9X\nUklURSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2gg\nKFJ1bnRpbWVFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmVy\ncm9yKCJQcm9ibGVtIHNldHRpbmcgd3JpdGFibGUiLCBlKTsKICAgICAgICAg\nICAgICAgIHRocm93IGU7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIHByaXZhdGUgdm9pZCBzZW5kQnVmZmVycyhCeXRlQnVmZmVyIGJiW10p\nIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBsZW4gPSBCeXRlQnVmZmVyLmFs\nbG9jYXRlKDQpOwogICAgICAgICAgICBpbnQgdG90YWwgPSAwOwogICAgICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJiLmxlbmd0aDsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBpZiAoYmJbaV0gIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIHRvdGFsICs9IGJiW2ldLnJlbWFpbmluZygpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChMT0cu\naXNUcmFjZUVuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgTE9HLmRlYnVn\nKCJTZW5kaW5nIHJlc3BvbnNlIG9mIHNpemUgIiArIHRvdGFsICsgIiB0byAi\nICsgcGVlck5hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxlbi5w\ndXRJbnQodG90YWwpOwogICAgICAgICAgICBsZW4uZmxpcCgpOwogICAgICAg\nICAgICBvdXRnb2luZ0J1ZmZlcnMuYWRkKGxlbik7CiAgICAgICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgYmIubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIGlmIChiYltpXSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAg\nICAgb3V0Z29pbmdCdWZmZXJzLmFkZChiYltpXSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFrZVdyaXRhYmxlKHNr\nKTsKICAgICAgICB9CgogICAgICAgIHN5bmNocm9uaXplZCBwdWJsaWMgdm9p\nZCBzZW5kUmVzcG9uc2UoQnl0ZUJ1ZmZlci4uLiBiYikgewogICAgICAgICAg\nICBpZiAoY2xvc2VkKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgc2VuZEJ1ZmZlcnMoYmIpOwogICAgICAg\nICAgICBzeW5jaHJvbml6ZWQgKE5JT1NlcnZlckZhY3RvcnkudGhpcykgewog\nICAgICAgICAgICAgICAgb3V0c3RhbmRpbmdSZXF1ZXN0cy0tOwogICAgICAg\nICAgICAgICAgLy8gY2hlY2sgdGhyb3R0bGluZwogICAgICAgICAgICAgICAg\naWYgKG91dHN0YW5kaW5nUmVxdWVzdHMgPCBvdXRzdGFuZGluZ0xpbWl0KSB7\nCiAgICAgICAgICAgICAgICAgICAgc2suc2VsZWN0b3IoKS53YWtldXAoKTsK\nICAgICAgICAgICAgICAgICAgICBlbmFibGVSZWN2KCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1Ymxp\nYyBJbmV0U29ja2V0QWRkcmVzcyBnZXRSZW1vdGVBZGRyZXNzKCkgewogICAg\nICAgICAgICByZXR1cm4gKEluZXRTb2NrZXRBZGRyZXNzKSBzb2NrLnNvY2tl\ndCgpLmdldFJlbW90ZVNvY2tldEFkZHJlc3MoKTsKICAgICAgICB9CgogICAg\nICAgIHByaXZhdGUgY2xhc3MgQ254blN0YXRzIHsKICAgICAgICAgICAgbG9u\nZyBwYWNrZXRzU2VudCA9IDA7CiAgICAgICAgICAgIGxvbmcgcGFja2V0c1Jl\nY2VpdmVkID0gMDsKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBU\naGUgbnVtYmVyIG9mIHJlcXVlc3RzIHRoYXQgaGF2ZSBiZWVuIHN1Ym1pdHRl\nZCBidXQgbm90IHlldAogICAgICAgICAgICAgKiByZXNwb25kZWQgdG8uCiAg\nICAgICAgICAgICAqLwogICAgICAgICAgICBwdWJsaWMgbG9uZyBnZXRPdXRz\ndGFuZGluZ1JlcXVlc3RzKCkgewogICAgICAgICAgICAgICAgc3luY2hyb25p\nemVkKENueG4udGhpcykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBv\ndXRzdGFuZGluZ1JlcXVlc3RzOwogICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICB9CgogICAgICAgICAgICBwdWJsaWMgbG9uZyBnZXRQYWNrZXRzUmVj\nZWl2ZWQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFja2V0c1JlY2Vp\ndmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwdWJsaWMgbG9uZyBn\nZXRQYWNrZXRzU2VudCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBwYWNr\nZXRzU2VudDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgIHB1YmxpYyBTdHJpbmcgdG9TdHJpbmcoKSB7CiAgICAg\nICAgICAgICAgICBTdHJpbmdCdWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxk\nZXIoKTsKICAgICAgICAgICAgICAgIENoYW5uZWwgY2hhbm5lbCA9IHNrLmNo\nYW5uZWwoKTsKICAgICAgICAgICAgICAgIGlmIChjaGFubmVsIGluc3RhbmNl\nb2YgU29ja2V0Q2hhbm5lbCkgewogICAgICAgICAgICAgICAgICAgIHNiLmFw\ncGVuZCgiICIpLmFwcGVuZCgoKFNvY2tldENoYW5uZWwpIGNoYW5uZWwpLnNv\nY2tldCgpLmdldFJlbW90ZVNvY2tldEFkZHJlc3MoKSkuYXBwZW5kKCJbIikK\nICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKEludGVnZXIudG9IZXhTdHJp\nbmcoc2suaW50ZXJlc3RPcHMoKSkpLmFwcGVuZCgiXShxdWV1ZWQ9IikuYXBw\nZW5kKAogICAgICAgICAgICAgICAgICAgICAgICBnZXRPdXRzdGFuZGluZ1Jl\ncXVlc3RzKCkpLmFwcGVuZCgiLHJlY3ZlZD0iKS5hcHBlbmQoZ2V0UGFja2V0\nc1JlY2VpdmVkKCkpLmFwcGVuZCgKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICIsc2VudD0iKS5hcHBlbmQoZ2V0UGFja2V0c1NlbnQoKSkuYXBwZW5k\nKCIpXG4iKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJl\ndHVybiBzYi50b1N0cmluZygpOwogICAgICAgICAgICB9CiAgICAgICAgfQoK\nICAgICAgICBwcml2YXRlIENueG5TdGF0cyBjbnhuU3RhdHMgPSBuZXcgQ254\nblN0YXRzKCk7CgogICAgICAgIHB1YmxpYyBDbnhuU3RhdHMgZ2V0U3RhdHMo\nKSB7CiAgICAgICAgICAgIHJldHVybiBjbnhuU3RhdHM7CiAgICAgICAgfQog\nICAgfQp9Cg==\n","encoding":"base64"}

