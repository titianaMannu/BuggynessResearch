{"sha":"36ddcf053d11586babb4c0b4961a2e52dc83607f","node_id":"MDQ6QmxvYjE1NzU5NTY6MzZkZGNmMDUzZDExNTg2YmFiYjRjMGI0OTYxYTJlNTJkYzgzNjA3Zg==","size":27550,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/36ddcf053d11586babb4c0b4961a2e52dc83607f","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG87CgovKioKICog\nTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChB\nU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2Ug\nYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJpYnV0\nZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24K\nICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxp\nY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBM\naWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlvdSBt\nYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UKICog\nd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0\naGUgTGljZW5zZSBhdAogKgogKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3Jn\nL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAqCiAqIFVubGVzcyByZXF1aXJlZCBi\neSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29m\ndHdhcmUKICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlz\ndHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKICogV0lUSE9VVCBXQVJS\nQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHBy\nZXNzIG9yIGltcGxpZWQuCiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNw\nZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQKICog\nbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAqLwoKaW1wb3J0IGph\ndmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEudXRpbC5BcnJheURlcXVlOwppbXBvcnQg\namF2YS51dGlsLlF1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQu\nQ29uY3VycmVudEhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljTG9uZzsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY29uZi5DbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxDYWxsYmFj\na3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLnByb3RvLkJvb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5Xcml0ZUNh\nbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2trZWVwZXJJbnRlcm5hbENhbGxiYWNrcy5SZWFkRW50cnlDYWxsYmFjazsK\naW1wb3J0IHN0YXRpYyBvcmcuYXBhY2hlLmJvb2trZWVwZXIucHJvdG8uQm9v\na2llUHJvdG9jb2wuUGFja2V0SGVhZGVyOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLnV0aWwuT3JkZXJlZFNhZmVFeGVjdXRvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci51dGlsLlNhZmVSdW5uYWJsZTsKaW1wb3J0\nIG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFj\ndG9yeTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS51dGlsLlRpbWVyOwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LnV0aWwuSGFzaGVkV2hlZWxUaW1lcjsKaW1w\nb3J0IG9yZy5qYm9zcy5uZXR0eS5ib290c3RyYXAuQ2xpZW50Qm9vdHN0cmFw\nOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVy\nOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmJ1ZmZlci5DaGFubmVsQnVmZmVy\nczsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWw7Cmlt\ncG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsRmFjdG9yeTsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxGdXR1cmU7\nCmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsRnV0dXJl\nTGlzdGVuZXI7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFu\nbmVsSGFuZGxlckNvbnRleHQ7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hh\nbm5lbC5DaGFubmVsUGlwZWxpbmU7CmltcG9ydCBvcmcuamJvc3MubmV0dHku\nY2hhbm5lbC5DaGFubmVsUGlwZWxpbmVDb3ZlcmFnZTsKaW1wb3J0IG9yZy5q\nYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxQaXBlbGluZUZhY3Rvcnk7Cmlt\ncG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsU3RhdGVFdmVu\ndDsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxzOwpp\nbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuRXhjZXB0aW9uRXZlbnQ7\nCmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5NZXNzYWdlRXZlbnQ7\nCmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5TaW1wbGVDaGFubmVs\nSGFuZGxlcjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLnNvY2tl\ndC5DbGllbnRTb2NrZXRDaGFubmVsRmFjdG9yeTsKaW1wb3J0IG9yZy5qYm9z\ncy5uZXR0eS5oYW5kbGVyLmNvZGVjLmZyYW1lLkNvcnJ1cHRlZEZyYW1lRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmhhbmRsZXIuY29kZWMu\nZnJhbWUuTGVuZ3RoRmllbGRCYXNlZEZyYW1lRGVjb2RlcjsKaW1wb3J0IG9y\nZy5qYm9zcy5uZXR0eS5oYW5kbGVyLmNvZGVjLmZyYW1lLlRvb0xvbmdGcmFt\nZUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5oYW5kbGVyLnRp\nbWVvdXQuUmVhZFRpbWVvdXRIYW5kbGVyOwppbXBvcnQgb3JnLmpib3NzLm5l\ndHR5LmhhbmRsZXIudGltZW91dC5SZWFkVGltZW91dEV4Y2VwdGlvbjsKCi8q\nKgogKiBUaGlzIGNsYXNzIG1hbmFnZXMgYWxsIGRldGFpbHMgb2YgY29ubmVj\ndGlvbiB0byBhIHBhcnRpY3VsYXIgYm9va2llLiBJdCBhbHNvCiAqIGhhcyBy\nZWNvbm5lY3QgbG9naWMgaWYgYSBjb25uZWN0aW9uIHRvIGEgYm9va2llIGZh\naWxzLgogKgogKi8KCkBDaGFubmVsUGlwZWxpbmVDb3ZlcmFnZSgib25lIikK\ncHVibGljIGNsYXNzIFBlckNoYW5uZWxCb29raWVDbGllbnQgZXh0ZW5kcyBT\naW1wbGVDaGFubmVsSGFuZGxlciBpbXBsZW1lbnRzIENoYW5uZWxQaXBlbGlu\nZUZhY3RvcnkgewoKICAgIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoUGVyQ2hhbm5lbEJvb2tpZUNsaWVudC5j\nbGFzcyk7CgogICAgc3RhdGljIGZpbmFsIGxvbmcgbWF4TWVtb3J5ID0gUnVu\ndGltZS5nZXRSdW50aW1lKCkubWF4TWVtb3J5KCkgLyA1OwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgTUFYX0ZSQU1FX0xFTkdUSCA9IDIgKiAxMDI0\nICogMTAyNDsgLy8gMk0KCiAgICBJbmV0U29ja2V0QWRkcmVzcyBhZGRyOwog\nICAgU2VtYXBob3JlIG9wQ291bnRlclNlbSA9IG5ldyBTZW1hcGhvcmUoMjAw\nMCk7CiAgICBBdG9taWNMb25nIHRvdGFsQnl0ZXNPdXRzdGFuZGluZzsKICAg\nIENsaWVudFNvY2tldENoYW5uZWxGYWN0b3J5IGNoYW5uZWxGYWN0b3J5Owog\nICAgT3JkZXJlZFNhZmVFeGVjdXRvciBleGVjdXRvcjsKICAgIHByaXZhdGUg\nVGltZXIgcmVhZFRpbWVvdXRUaW1lcjsKCiAgICBDb25jdXJyZW50SGFzaE1h\ncDxDb21wbGV0aW9uS2V5LCBBZGRDb21wbGV0aW9uPiBhZGRDb21wbGV0aW9u\ncyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBBZGRD\nb21wbGV0aW9uPigpOwogICAgQ29uY3VycmVudEhhc2hNYXA8Q29tcGxldGlv\nbktleSwgUmVhZENvbXBsZXRpb24+IHJlYWRDb21wbGV0aW9ucyA9IG5ldyBD\nb25jdXJyZW50SGFzaE1hcDxDb21wbGV0aW9uS2V5LCBSZWFkQ29tcGxldGlv\nbj4oKTsKCiAgICAvKioKICAgICAqIFRoZSBmb2xsb3dpbmcgbWVtYmVyIHZh\ncmlhYmxlcyBkbyBub3QgbmVlZCB0byBiZSBjb25jdXJyZW50LCBvciB2b2xh\ndGlsZQogICAgICogYmVjYXVzZSB0aGV5IGFyZSBhbHdheXMgdXBkYXRlZCB1\nbmRlciBhIGxvY2sKICAgICAqLwogICAgUXVldWU8R2VuZXJpY0NhbGxiYWNr\nPFZvaWQ+PiBwZW5kaW5nT3BzID0gbmV3IEFycmF5RGVxdWU8R2VuZXJpY0Nh\nbGxiYWNrPFZvaWQ+PigpOwogICAgdm9sYXRpbGUgQ2hhbm5lbCBjaGFubmVs\nID0gbnVsbDsKCiAgICBwcml2YXRlIGVudW0gQ29ubmVjdGlvblN0YXRlIHsK\nICAgICAgICBESVNDT05ORUNURUQsIENPTk5FQ1RJTkcsIENPTk5FQ1RFRAog\nICAgICAgICAgICB9OwoKICAgIHByaXZhdGUgdm9sYXRpbGUgQ29ubmVjdGlv\nblN0YXRlIHN0YXRlOwogICAgcHJpdmF0ZSBmaW5hbCBDbGllbnRDb25maWd1\ncmF0aW9uIGNvbmY7CgogICAgcHVibGljIFBlckNoYW5uZWxCb29raWVDbGll\nbnQoT3JkZXJlZFNhZmVFeGVjdXRvciBleGVjdXRvciwgQ2xpZW50U29ja2V0\nQ2hhbm5lbEZhY3RvcnkgY2hhbm5lbEZhY3RvcnksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBB\ndG9taWNMb25nIHRvdGFsQnl0ZXNPdXRzdGFuZGluZykgewogICAgICAgIHRo\naXMobmV3IENsaWVudENvbmZpZ3VyYXRpb24oKSwgZXhlY3V0b3IsIGNoYW5u\nZWxGYWN0b3J5LCBhZGRyLCB0b3RhbEJ5dGVzT3V0c3RhbmRpbmcpOwogICAg\nfQogICAgICAgICAgICAKICAgIHB1YmxpYyBQZXJDaGFubmVsQm9va2llQ2xp\nZW50KENsaWVudENvbmZpZ3VyYXRpb24gY29uZiwgT3JkZXJlZFNhZmVFeGVj\ndXRvciBleGVjdXRvciwgQ2xpZW50U29ja2V0Q2hhbm5lbEZhY3RvcnkgY2hh\nbm5lbEZhY3RvcnksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBJbmV0U29ja2V0QWRkcmVzcyBhZGRyLCBBdG9taWNMb25nIHRvdGFsQnl0\nZXNPdXRzdGFuZGluZykgewogICAgICAgIHRoaXMuY29uZiA9IGNvbmY7CiAg\nICAgICAgdGhpcy5hZGRyID0gYWRkcjsKICAgICAgICB0aGlzLmV4ZWN1dG9y\nID0gZXhlY3V0b3I7CiAgICAgICAgdGhpcy50b3RhbEJ5dGVzT3V0c3RhbmRp\nbmcgPSB0b3RhbEJ5dGVzT3V0c3RhbmRpbmc7CiAgICAgICAgdGhpcy5jaGFu\nbmVsRmFjdG9yeSA9IGNoYW5uZWxGYWN0b3J5OwogICAgICAgIHRoaXMuc3Rh\ndGUgPSBDb25uZWN0aW9uU3RhdGUuRElTQ09OTkVDVEVEOwogICAgICAgIHRo\naXMucmVhZFRpbWVvdXRUaW1lciA9IG51bGw7CiAgICB9CgogICAgc3luY2hy\nb25pemVkIHByaXZhdGUgdm9pZCBjb25uZWN0KCkgewogICAgICAgIGlmIChz\ndGF0ZSA9PSBDb25uZWN0aW9uU3RhdGUuQ09OTkVDVElORykgewogICAgICAg\nICAgICByZXR1cm47CiAgICAgICAgfSAKICAgICAgICAvLyBTdGFydCB0aGUg\nY29ubmVjdGlvbiBhdHRlbXB0IHRvIHRoZSBpbnB1dCBzZXJ2ZXIgaG9zdC4K\nICAgICAgICBzdGF0ZSA9IENvbm5lY3Rpb25TdGF0ZS5DT05ORUNUSU5HOwoK\nICAgICAgICBpZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAg\nIExPRy5kZWJ1ZygiQ29ubmVjdGluZyB0byBib29raWU6ICIgKyBhZGRyKTsK\nCiAgICAgICAgLy8gU2V0IHVwIHRoZSBDbGllbnRCb290U3RyYXAgc28gd2Ug\nY2FuIGNyZWF0ZSBhIG5ldyBDaGFubmVsIGNvbm5lY3Rpb24KICAgICAgICAv\nLyB0byB0aGUgYm9va2llLgogICAgICAgIENsaWVudEJvb3RzdHJhcCBib290\nc3RyYXAgPSBuZXcgQ2xpZW50Qm9vdHN0cmFwKGNoYW5uZWxGYWN0b3J5KTsK\nICAgICAgICBib290c3RyYXAuc2V0UGlwZWxpbmVGYWN0b3J5KHRoaXMpOwog\nICAgICAgIGJvb3RzdHJhcC5zZXRPcHRpb24oInRjcE5vRGVsYXkiLCBjb25m\nLmdldENsaWVudFRjcE5vRGVsYXkoKSk7CiAgICAgICAgYm9vdHN0cmFwLnNl\ndE9wdGlvbigia2VlcEFsaXZlIiwgdHJ1ZSk7CgogICAgICAgIENoYW5uZWxG\ndXR1cmUgZnV0dXJlID0gYm9vdHN0cmFwLmNvbm5lY3QoYWRkcik7CgogICAg\nICAgIGZ1dHVyZS5hZGRMaXN0ZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3Rl\nbmVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uQ29tcGxldGUoQ2hhbm5lbEZ1dHVyZSBmdXR1\ncmUpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICAgICAgaW50IHJj\nOwogICAgICAgICAgICAgICAgUXVldWU8R2VuZXJpY0NhbGxiYWNrPFZvaWQ+\nPiBvbGRQZW5kaW5nT3BzOwoKICAgICAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAoUGVyQ2hhbm5lbEJvb2tpZUNsaWVudC50aGlzKSB7CgogICAgICAgICAg\nICAgICAgICAgIGlmIChmdXR1cmUuaXNTdWNjZXNzKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgTE9HLmluZm8oIlN1Y2Nlc3NmdWxseSBjb25uZWN0\nZWQgdG8gYm9va2llOiAiICsgYWRkcik7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5PSzsKICAgICAgICAgICAgICAg\nICAgICAgICAgY2hhbm5lbCA9IGZ1dHVyZS5nZXRDaGFubmVsKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIHN0YXRlID0gQ29ubmVjdGlvblN0YXRlLkNP\nTk5FQ1RFRDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCBjb25uZWN0\nIHRvIGJvb2tpZTogIiArIGFkZHIpOwogICAgICAgICAgICAgICAgICAgICAg\nICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuQm9va2llSGFuZGxlTm90QXZhaWxh\nYmxlRXhjZXB0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICBjaGFubmVs\nID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBDb25u\nZWN0aW9uU3RhdGUuRElTQ09OTkVDVEVEOwogICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgUGVyQ2hhbm5lbEJvb2tpZUNsaWVu\ndC50aGlzLmNoYW5uZWwgPSBjaGFubmVsOwoKICAgICAgICAgICAgICAgICAg\nICAvLyB0cmljayB0byBub3QgZG8gb3BlcmF0aW9ucyB1bmRlciB0aGUgbG9j\naywgdGFrZSB0aGUgbGlzdAogICAgICAgICAgICAgICAgICAgIC8vIG9mIHBl\nbmRpbmcgb3BzIGFuZCBhc3NpZ24gaXQgdG8gYSBuZXcgdmFyaWFibGUsIHdo\naWxlCiAgICAgICAgICAgICAgICAgICAgLy8gZW1wdHlpbmcgdGhlIHBlbmRp\nbmcgb3BzIGJ5IGp1c3QgYXNzaWduaW5nIGl0IHRvIGEgbmV3CiAgICAgICAg\nICAgICAgICAgICAgLy8gbGlzdAogICAgICAgICAgICAgICAgICAgIG9sZFBl\nbmRpbmdPcHMgPSBwZW5kaW5nT3BzOwogICAgICAgICAgICAgICAgICAgIHBl\nbmRpbmdPcHMgPSBuZXcgQXJyYXlEZXF1ZTxHZW5lcmljQ2FsbGJhY2s8Vm9p\nZD4+KCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZm9y\nIChHZW5lcmljQ2FsbGJhY2s8Vm9pZD4gcGVuZGluZ09wIDogb2xkUGVuZGlu\nZ09wcykgewogICAgICAgICAgICAgICAgICAgIHBlbmRpbmdPcC5vcGVyYXRp\nb25Db21wbGV0ZShyYywgbnVsbCk7CiAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICB2b2lkIGNvbm5lY3RJ\nZk5lZWRlZEFuZERvT3AoR2VuZXJpY0NhbGxiYWNrPFZvaWQ+IG9wKSB7CiAg\nICAgICAgYm9vbGVhbiBkb09wTm93OwoKICAgICAgICAvLyBjb21tb24gY2Fz\nZSB3aXRob3V0IGxvY2sgZmlyc3QKICAgICAgICBpZiAoY2hhbm5lbCAhPSBu\ndWxsICYmIHN0YXRlID09IENvbm5lY3Rpb25TdGF0ZS5DT05ORUNURUQpIHsK\nICAgICAgICAgICAgZG9PcE5vdyA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsK\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAodGhpcykgewogICAgICAgICAg\nICAgICAgLy8gY2hlY2sgYWdhaW4gdW5kZXIgbG9jawogICAgICAgICAgICAg\nICAgaWYgKGNoYW5uZWwgIT0gbnVsbCAmJiBzdGF0ZSA9PSBDb25uZWN0aW9u\nU3RhdGUuQ09OTkVDVEVEKSB7CiAgICAgICAgICAgICAgICAgICAgZG9PcE5v\ndyA9IHRydWU7CiAgICAgICAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAg\nICAgICAgICAgICAvLyBpZiByZWFjaGVkIGhlcmUsIGNoYW5uZWwgaXMgZWl0\naGVyIG51bGwgKGZpcnN0IGNvbm5lY3Rpb24KICAgICAgICAgICAgICAgICAg\nICAvLyBhdHRlbXB0KSwKICAgICAgICAgICAgICAgICAgICAvLyBvciB0aGUg\nY2hhbm5lbCBpcyBkaXNjb25uZWN0ZWQKICAgICAgICAgICAgICAgICAgICBk\nb09wTm93ID0gZmFsc2U7CgogICAgICAgICAgICAgICAgICAgIC8vIGNvbm5l\nY3Rpb24gYXR0ZW1wdCBpcyBzdGlsbCBpbiBwcm9ncmVzcywgcXVldWUgdXAg\ndGhpcwogICAgICAgICAgICAgICAgICAgIC8vIG9wLiBPcCB3aWxsIGJlIGV4\nZWN1dGVkIHdoZW4gY29ubmVjdGlvbiBhdHRlbXB0IGVpdGhlcgogICAgICAg\nICAgICAgICAgICAgIC8vIGZhaWxzCiAgICAgICAgICAgICAgICAgICAgLy8g\nb3IKICAgICAgICAgICAgICAgICAgICAvLyBzdWNjZWVkcwogICAgICAgICAg\nICAgICAgICAgIHBlbmRpbmdPcHMuYWRkKG9wKTsKCiAgICAgICAgICAgICAg\nICAgICAgY29ubmVjdCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZG9PcE5vdykgewogICAgICAg\nICAgICBvcC5vcGVyYXRpb25Db21wbGV0ZShCS0V4Y2VwdGlvbi5Db2RlLk9L\nLCBudWxsKTsKICAgICAgICB9CgogICAgfQoKICAgIC8qKgogICAgICogVGhp\ncyBtZXRob2Qgc2hvdWxkIGJlIGNhbGxlZCBvbmx5IGFmdGVyIGNvbm5lY3Rp\nb24gaGFzIGJlZW4gY2hlY2tlZCBmb3IKICAgICAqIHtAbGluayAjY29ubmVj\ndElmTmVlZGVkQW5kRG9PcChHZW5lcmljQ2FsbGJhY2spfQogICAgICoKICAg\nICAqIEBwYXJhbSBsZWRnZXJJZAogICAgICogQHBhcmFtIG1hc3RlcktleQog\nICAgICogQHBhcmFtIGVudHJ5SWQKICAgICAqIEBwYXJhbSBsYXN0Q29uZmly\nbWVkCiAgICAgKiBAcGFyYW0gbWFjQ29kZQogICAgICogQHBhcmFtIGRhdGEK\nICAgICAqIEBwYXJhbSBjYgogICAgICogQHBhcmFtIGN0eAogICAgICovCiAg\nICB2b2lkIGFkZEVudHJ5KGZpbmFsIGxvbmcgbGVkZ2VySWQsIGJ5dGVbXSBt\nYXN0ZXJLZXksIGZpbmFsIGxvbmcgZW50cnlJZCwgQ2hhbm5lbEJ1ZmZlciB0\nb1NlbmQsIFdyaXRlQ2FsbGJhY2sgY2IsCiAgICAgICAgICAgICAgICAgIE9i\namVjdCBjdHgsIGZpbmFsIGludCBvcHRpb25zKSB7CiAgICAgICAgZmluYWwg\naW50IGVudHJ5U2l6ZSA9IHRvU2VuZC5yZWFkYWJsZUJ5dGVzKCk7CgogICAg\nICAgIGZpbmFsIENvbXBsZXRpb25LZXkgY29tcGxldGlvbktleSA9IG5ldyBD\nb21wbGV0aW9uS2V5KGxlZGdlcklkLCBlbnRyeUlkKTsKCiAgICAgICAgYWRk\nQ29tcGxldGlvbnMucHV0KGNvbXBsZXRpb25LZXksIG5ldyBBZGRDb21wbGV0\naW9uKGNiLCBlbnRyeVNpemUsIGN0eCkpOwoKICAgICAgICBpbnQgdG90YWxI\nZWFkZXJTaXplID0gNCAvLyBmb3IgdGhlIGxlbmd0aCBvZiB0aGUgcGFja2V0\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgNCAvLyBmb3IgdGhl\nIHR5cGUgb2YgcmVxdWVzdAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIEJvb2tpZVByb3RvY29sLk1BU1RFUl9LRVlfTEVOR1RIOyAvLyBmb3Ig\ndGhlIG1hc3RlciBrZXkKCiAgICAgICAgdHJ5ewogICAgICAgICAgICBDaGFu\nbmVsQnVmZmVyIGhlYWRlciA9IGNoYW5uZWwuZ2V0Q29uZmlnKCkuZ2V0QnVm\nZmVyRmFjdG9yeSgpLmdldEJ1ZmZlcih0b3RhbEhlYWRlclNpemUpOwoKICAg\nICAgICAgICAgaGVhZGVyLndyaXRlSW50KHRvdGFsSGVhZGVyU2l6ZSAtIDQg\nKyBlbnRyeVNpemUpOwogICAgICAgICAgICBoZWFkZXIud3JpdGVJbnQobmV3\nIFBhY2tldEhlYWRlcihCb29raWVQcm90b2NvbC5DVVJSRU5UX1BST1RPQ09M\nX1ZFUlNJT04sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIEJvb2tpZVByb3RvY29sLkFEREVOVFJZLCAoc2hvcnQpb3B0\naW9ucykudG9JbnQoKSk7CiAgICAgICAgICAgIGhlYWRlci53cml0ZUJ5dGVz\nKG1hc3RlcktleSwgMCwgQm9va2llUHJvdG9jb2wuTUFTVEVSX0tFWV9MRU5H\nVEgpOwoKICAgICAgICAgICAgQ2hhbm5lbEJ1ZmZlciB3cmFwcGVkQnVmZmVy\nID0gQ2hhbm5lbEJ1ZmZlcnMud3JhcHBlZEJ1ZmZlcihoZWFkZXIsIHRvU2Vu\nZCk7CgogICAgICAgICAgICBDaGFubmVsRnV0dXJlIGZ1dHVyZSA9IGNoYW5u\nZWwud3JpdGUod3JhcHBlZEJ1ZmZlcik7CiAgICAgICAgICAgIGZ1dHVyZS5h\nZGRMaXN0ZW5lcihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyKCkgewogICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMg\ndm9pZCBvcGVyYXRpb25Db21wbGV0ZShDaGFubmVsRnV0dXJlIGZ1dHVyZSkg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZ1\ndHVyZS5pc1N1Y2Nlc3MoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBp\nZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIExPRy5kZWJ1ZygiU3VjY2Vzc2Z1bGx5IHdyb3RlIHJlcXVl\nc3QgZm9yIGFkZGluZyBlbnRyeTogIiArIGVudHJ5SWQgKyAiIGxlZGdlci1p\nZDogIiArIGxlZGdlcklkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBib29raWU6ICIg\nKyBjaGFubmVsLmdldFJlbW90ZUFkZHJlc3MoKSArICIgZW50cnkgbGVuZ3Ro\nOiAiICsgZW50cnlTaXplKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICAgICAgICAgICAgICAvLyB0b3RhbEJ5dGVzT3V0c3RhbmRp\nbmcuYWRkQW5kR2V0KGVudHJ5U2l6ZSk7CiAgICAgICAgICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JPdXRBZGRL\nZXkoY29tcGxldGlvbktleSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNo\nIChUaHJvd2FibGUgZSkgewogICAgICAgICAgICBMT0cud2FybigiQWRkIGVu\ndHJ5IG9wZXJhdGlvbiBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZXJyb3JP\ndXRBZGRLZXkoY29tcGxldGlvbktleSk7CiAgICAgICAgfQogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHJlYWRFbnRyeUFuZEZlbmNlTGVkZ2VyKGZpbmFsIGxv\nbmcgbGVkZ2VySWQsIGJ5dGVbXSBtYXN0ZXJLZXksCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBsb25nIGVudHJ5SWQs\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBSZWFk\nRW50cnlDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewogICAgICAgIGZpbmFs\nIENvbXBsZXRpb25LZXkga2V5ID0gbmV3IENvbXBsZXRpb25LZXkobGVkZ2Vy\nSWQsIGVudHJ5SWQpOwogICAgICAgIHJlYWRDb21wbGV0aW9ucy5wdXQoa2V5\nLCBuZXcgUmVhZENvbXBsZXRpb24oY2IsIGN0eCkpOwoKICAgICAgICBpbnQg\ndG90YWxIZWFkZXJTaXplID0gNCAvLyBmb3IgdGhlIGxlbmd0aCBvZiB0aGUg\ncGFja2V0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgNCAvLyBm\nb3IgcmVxdWVzdCB0eXBlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgOCAvLyBmb3IgbGVkZ2VySWQKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyA4IC8vIGZvciBlbnRyeUlkCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgQm9va2llUHJvdG9jb2wuTUFTVEVSX0tFWV9MRU5HVEg7\nIC8vIGZvciBtYXN0ZXJLZXkKCiAgICAgICAgQ2hhbm5lbEJ1ZmZlciB0bXBF\nbnRyeSA9IGNoYW5uZWwuZ2V0Q29uZmlnKCkuZ2V0QnVmZmVyRmFjdG9yeSgp\nLmdldEJ1ZmZlcih0b3RhbEhlYWRlclNpemUpOwogICAgICAgIHRtcEVudHJ5\nLndyaXRlSW50KHRvdGFsSGVhZGVyU2l6ZSAtIDQpOwoKICAgICAgICB0bXBF\nbnRyeS53cml0ZUludChuZXcgUGFja2V0SGVhZGVyKEJvb2tpZVByb3RvY29s\nLkNVUlJFTlRfUFJPVE9DT0xfVkVSU0lPTiwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIEJvb2tpZVByb3RvY29sLlJFQURF\nTlRSWSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIEJvb2tpZVByb3RvY29sLkZMQUdfRE9fRkVOQ0lORykudG9JbnQoKSk7\nCiAgICAgICAgdG1wRW50cnkud3JpdGVMb25nKGxlZGdlcklkKTsKICAgICAg\nICB0bXBFbnRyeS53cml0ZUxvbmcoZW50cnlJZCk7CiAgICAgICAgdG1wRW50\ncnkud3JpdGVCeXRlcyhtYXN0ZXJLZXksIDAsIEJvb2tpZVByb3RvY29sLk1B\nU1RFUl9LRVlfTEVOR1RIKTsKCiAgICAgICAgQ2hhbm5lbEZ1dHVyZSBmdXR1\ncmUgPSBjaGFubmVsLndyaXRlKHRtcEVudHJ5KTsKICAgICAgICBmdXR1cmUu\nYWRkTGlzdGVuZXIobmV3IENoYW5uZWxGdXR1cmVMaXN0ZW5lcigpIHsKICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9w\nZXJhdGlvbkNvbXBsZXRlKENoYW5uZWxGdXR1cmUgZnV0dXJlKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmIChmdXR1cmUuaXNTdWNj\nZXNzKCkpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoTE9HLmlzRGVidWdF\nbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVn\nKCJTdWNjZXNzZnVsbHkgd3JvdGUgcmVxdWVzdCBmb3IgcmVhZGluZyBlbnRy\neTogIiArIGVudHJ5SWQgKyAiIGxlZGdlci1pZDogIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgKyBsZWRnZXJJZCArICIgYm9va2llOiAi\nICsgY2hhbm5lbC5nZXRSZW1vdGVBZGRyZXNzKCkpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgZXJyb3JPdXRSZWFkS2V5KGtleSk7CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCByZWFkRW50cnkoZmluYWwgbG9uZyBsZWRnZXJJZCwgZmluYWwg\nbG9uZyBlbnRyeUlkLCBSZWFkRW50cnlDYWxsYmFjayBjYiwgT2JqZWN0IGN0\neCkgewogICAgICAgIGZpbmFsIENvbXBsZXRpb25LZXkga2V5ID0gbmV3IENv\nbXBsZXRpb25LZXkobGVkZ2VySWQsIGVudHJ5SWQpOwogICAgICAgIHJlYWRD\nb21wbGV0aW9ucy5wdXQoa2V5LCBuZXcgUmVhZENvbXBsZXRpb24oY2IsIGN0\neCkpOwoKICAgICAgICBpbnQgdG90YWxIZWFkZXJTaXplID0gNCAvLyBmb3Ig\ndGhlIGxlbmd0aCBvZiB0aGUgcGFja2V0CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgNCAvLyBmb3IgcmVxdWVzdCB0eXBlCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICsgOCAvLyBmb3IgbGVkZ2VySWQKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgKyA4OyAvLyBmb3IgZW50cnlJZAoK\nICAgICAgICB0cnl7CiAgICAgICAgICAgIENoYW5uZWxCdWZmZXIgdG1wRW50\ncnkgPSBjaGFubmVsLmdldENvbmZpZygpLmdldEJ1ZmZlckZhY3RvcnkoKS5n\nZXRCdWZmZXIodG90YWxIZWFkZXJTaXplKTsKICAgICAgICAgICAgdG1wRW50\ncnkud3JpdGVJbnQodG90YWxIZWFkZXJTaXplIC0gNCk7CgogICAgICAgICAg\nICB0bXBFbnRyeS53cml0ZUludChuZXcgUGFja2V0SGVhZGVyKEJvb2tpZVBy\nb3RvY29sLkNVUlJFTlRfUFJPVE9DT0xfVkVSU0lPTiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCb29raWVQcm90\nb2NvbC5SRUFERU5UUlksIEJvb2tpZVByb3RvY29sLkZMQUdfTk9ORSkudG9J\nbnQoKSk7CiAgICAgICAgICAgIHRtcEVudHJ5LndyaXRlTG9uZyhsZWRnZXJJ\nZCk7CiAgICAgICAgICAgIHRtcEVudHJ5LndyaXRlTG9uZyhlbnRyeUlkKTsK\nCiAgICAgICAgICAgIENoYW5uZWxGdXR1cmUgZnV0dXJlID0gY2hhbm5lbC53\ncml0ZSh0bXBFbnRyeSk7CiAgICAgICAgICAgIGZ1dHVyZS5hZGRMaXN0ZW5l\ncihuZXcgQ2hhbm5lbEZ1dHVyZUxpc3RlbmVyKCkgewogICAgICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25Db21wbGV0ZShDaGFubmVsRnV0dXJlIGZ1dHVyZSkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGZ1dHVyZS5pc1N1\nY2Nlc3MoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoTE9HLmlz\nRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5kZWJ1ZygiU3VjY2Vzc2Z1bGx5IHdyb3RlIHJlcXVlc3QgZm9yIHJl\nYWRpbmcgZW50cnk6ICIgKyBlbnRyeUlkICsgIiBsZWRnZXItaWQ6ICIKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyBsZWRnZXJJZCArICIgYm9va2llOiAiICsgY2hhbm5l\nbC5nZXRSZW1vdGVBZGRyZXNzKCkpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgZXJyb3JPdXRSZWFkS2V5KGtleSk7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsK\nICAgICAgICB9IGNhdGNoKFRocm93YWJsZSBlKSB7CiAgICAgICAgICAgIExP\nRy53YXJuKCJSZWFkIGVudHJ5IG9wZXJhdGlvbiBmYWlsZWQiLCBlKTsKICAg\nICAgICAgICAgZXJyb3JPdXRSZWFkS2V5KGtleSk7CiAgICAgICAgfQogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlKCkgewogICAgICAgIGlmIChjaGFu\nbmVsICE9IG51bGwpIHsKICAgICAgICAgICAgY2hhbm5lbC5jbG9zZSgpLmF3\nYWl0VW5pbnRlcnJ1cHRpYmx5KCk7CiAgICAgICAgfQogICAgICAgIGlmIChy\nZWFkVGltZW91dFRpbWVyICE9IG51bGwpIHsKICAgICAgICAgICAgcmVhZFRp\nbWVvdXRUaW1lci5zdG9wKCk7CiAgICAgICAgICAgIHJlYWRUaW1lb3V0VGlt\nZXIgPSBudWxsOwogICAgICAgIH0KICAgIH0KCiAgICB2b2lkIGVycm9yT3V0\nUmVhZEtleShmaW5hbCBDb21wbGV0aW9uS2V5IGtleSkgewogICAgICAgIGV4\nZWN1dG9yLnN1Ym1pdE9yZGVyZWQoa2V5LmxlZGdlcklkLCBuZXcgU2FmZVJ1\nbm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2FmZVJ1bigpIHsKCiAgICAgICAgICAgICAgICBSZWFk\nQ29tcGxldGlvbiByZWFkQ29tcGxldGlvbiA9IHJlYWRDb21wbGV0aW9ucy5y\nZW1vdmUoa2V5KTsKCiAgICAgICAgICAgICAgICBpZiAocmVhZENvbXBsZXRp\nb24gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIExPRy5lcnJvcigi\nQ291bGQgbm90IHdyaXRlICByZXF1ZXN0IGZvciByZWFkaW5nIGVudHJ5OiAi\nICsga2V5LmVudHJ5SWQgKyAiIGxlZGdlci1pZDogIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICArIGtleS5sZWRnZXJJZCArICIgYm9va2llOiAi\nICsgY2hhbm5lbC5nZXRSZW1vdGVBZGRyZXNzKCkpOwoKICAgICAgICAgICAg\nICAgICAgICByZWFkQ29tcGxldGlvbi5jYi5yZWFkRW50cnlDb21wbGV0ZShC\nS0V4Y2VwdGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2YWlsYWJsZUV4Y2Vw\ndGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBrZXkubGVkZ2VySWQsIGtleS5lbnRyeUlkLCBu\ndWxsLCByZWFkQ29tcGxldGlvbi5jdHgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CgogICAgICAgIH0pOwogICAgfQoKICAgIHZvaWQgZXJy\nb3JPdXRBZGRLZXkoZmluYWwgQ29tcGxldGlvbktleSBrZXkpIHsKICAgICAg\nICBleGVjdXRvci5zdWJtaXRPcmRlcmVkKGtleS5sZWRnZXJJZCwgbmV3IFNh\nZmVSdW5uYWJsZSgpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\nICAgIHB1YmxpYyB2b2lkIHNhZmVSdW4oKSB7CgogICAgICAgICAgICAgICAg\nQWRkQ29tcGxldGlvbiBhZGRDb21wbGV0aW9uID0gYWRkQ29tcGxldGlvbnMu\ncmVtb3ZlKGtleSk7CgogICAgICAgICAgICAgICAgaWYgKGFkZENvbXBsZXRp\nb24gIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBiQWRk\ncmVzcyA9ICJudWxsIjsKICAgICAgICAgICAgICAgICAgICBpZihjaGFubmVs\nICE9IG51bGwpCiAgICAgICAgICAgICAgICAgICAgICAgIGJBZGRyZXNzID0g\nY2hhbm5lbC5nZXRSZW1vdGVBZGRyZXNzKCkudG9TdHJpbmcoKTsKICAgICAg\nICAgICAgICAgICAgICBMT0cuZXJyb3IoIkNvdWxkIG5vdCB3cml0ZSByZXF1\nZXN0IGZvciBhZGRpbmcgZW50cnk6ICIgKyBrZXkuZW50cnlJZCArICIgbGVk\nZ2VyLWlkOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsga2V5\nLmxlZGdlcklkICsgIiBib29raWU6ICIgKyBiQWRkcmVzcyk7CgogICAgICAg\nICAgICAgICAgICAgIGFkZENvbXBsZXRpb24uY2Iud3JpdGVDb21wbGV0ZShC\nS0V4Y2VwdGlvbi5Db2RlLkJvb2tpZUhhbmRsZU5vdEF2YWlsYWJsZUV4Y2Vw\ndGlvbiwga2V5LmxlZGdlcklkLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBrZXkuZW50cnlJZCwgYWRkciwg\nYWRkQ29tcGxldGlvbi5jdHgpOwogICAgICAgICAgICAgICAgICAgIExPRy5l\ncnJvcigiSW52b2tlZCBjYWxsYmFjayBtZXRob2Q6ICIgKyBrZXkuZW50cnlJ\nZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nfSk7CgogICAgfQoKICAgIC8qKgogICAgICogRXJyb3JzIG91dCBwZW5kaW5n\nIGVudHJpZXMuIFdlIGNhbGwgdGhpcyBtZXRob2QgZnJvbSBvbmUgdGhyZWFk\nIHRvIGF2b2lkCiAgICAgKiBjb25jdXJyZW50IGV4ZWN1dGlvbnMgdG8gUXVv\ncnVtT3BNb25pdG9yIChpbXBsZW1lbnRzIGNhbGxiYWNrcykuIEl0IHNlZW1z\nCiAgICAgKiBzaW1wbGVyIHRvIGNhbGwgaXQgZnJvbSBCb29raWVIYW5kbGUg\naW5zdGVhZCBvZiBjYWxsaW5nIGRpcmVjdGx5IGZyb20KICAgICAqIGhlcmUu\nCiAgICAgKi8KCiAgICB2b2lkIGVycm9yT3V0T3V0c3RhbmRpbmdFbnRyaWVz\nKCkgewoKICAgICAgICAvLyBETyBOT1QgcmV3cml0ZSB0aGVzZSB1c2luZyBN\nYXAuRW50cnkgaXRlcmF0aW9ucy4gV2Ugd2FudCB0byBpdGVyYXRlCiAgICAg\nICAgLy8gb24ga2V5cyBhbmQgc2VlIGlmIHdlIGFyZSBzdWNjZXNzZnVsbHkg\nYWJsZSB0byByZW1vdmUgdGhlIGtleSBmcm9tCiAgICAgICAgLy8gdGhlIG1h\ncC4gQmVjYXVzZSB0aGUgYWRkIGFuZCB0aGUgcmVhZCBtZXRob2RzIGFsc28g\nZG8gdGhlIHNhbWUgdGhpbmcKICAgICAgICAvLyBpbiBjYXNlIHRoZXkgZ2V0\nIGEgd3JpdGUgZmFpbHVyZSBvbiB0aGUgc29ja2V0LiBUaGUgb25lIHdobwog\nICAgICAgIC8vIHN1Y2Nlc3NmdWxseSByZW1vdmVzIHRoZSBrZXkgZnJvbSB0\naGUgbWFwIGlzIHRoZSBvbmUgcmVzcG9uc2libGUgZm9yCiAgICAgICAgLy8g\nY2FsbGluZyB0aGUgYXBwbGljYXRpb24gY2FsbGJhY2suCgogICAgICAgIGZv\nciAoQ29tcGxldGlvbktleSBrZXkgOiBhZGRDb21wbGV0aW9ucy5rZXlTZXQo\nKSkgewogICAgICAgICAgICBlcnJvck91dEFkZEtleShrZXkpOwogICAgICAg\nIH0KCiAgICAgICAgZm9yIChDb21wbGV0aW9uS2V5IGtleSA6IHJlYWRDb21w\nbGV0aW9ucy5rZXlTZXQoKSkgewogICAgICAgICAgICBlcnJvck91dFJlYWRL\nZXkoa2V5KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBJbiB0\naGUgbmV0dHkgcGlwZWxpbmUsIHdlIG5lZWQgdG8gc3BsaXQgcGFja2V0cyBi\nYXNlZCBvbiBsZW5ndGgsIHNvIHdlCiAgICAgKiB1c2UgdGhlIHtAbGluayBM\nZW5ndGhGaWVsZEJhc2VkRnJhbWVEZWNvZGVyfS4gT3RoZXIgdGhhbiB0aGF0\nIGFsbCBhY3Rpb25zCiAgICAgKiBhcmUgY2FycmllZCBvdXQgaW4gdGhpcyBj\nbGFzcywgZS5nLiwgbWFraW5nIHNlbnNlIG9mIHJlY2VpdmVkIG1lc3NhZ2Vz\nLAogICAgICogcHJlcGVuZGluZyB0aGUgbGVuZ3RoIHRvIG91dGdvaW5nIHBh\nY2tldHMgZXRjLgogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyBD\naGFubmVsUGlwZWxpbmUgZ2V0UGlwZWxpbmUoKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICBDaGFubmVsUGlwZWxpbmUgcGlwZWxpbmUgPSBDaGFubmVs\ncy5waXBlbGluZSgpOwoKICAgICAgICBpZiAocmVhZFRpbWVvdXRUaW1lciA9\nPSBudWxsKSB7CiAgICAgICAgICAgIHJlYWRUaW1lb3V0VGltZXIgPSBuZXcg\nSGFzaGVkV2hlZWxUaW1lcigpOwogICAgICAgIH0KCiAgICAgICAgcGlwZWxp\nbmUuYWRkTGFzdCgicmVhZFRpbWVvdXQiLCBuZXcgUmVhZFRpbWVvdXRIYW5k\nbGVyKHJlYWRUaW1lb3V0VGltZXIsIAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25m\nLmdldFJlYWRUaW1lb3V0KCkpKTsKICAgICAgICBwaXBlbGluZS5hZGRMYXN0\nKCJsZW5ndGhiYXNlZGZyYW1lZGVjb2RlciIsIG5ldyBMZW5ndGhGaWVsZEJh\nc2VkRnJhbWVEZWNvZGVyKE1BWF9GUkFNRV9MRU5HVEgsIDAsIDQsIDAsIDQp\nKTsKICAgICAgICBwaXBlbGluZS5hZGRMYXN0KCJtYWluaGFuZGxlciIsIHRo\naXMpOwogICAgICAgIHJldHVybiBwaXBlbGluZTsKICAgIH0KCiAgICAvKioK\nICAgICAqIElmIG91ciBjaGFubmVsIGhhcyBkaXNjb25uZWN0ZWQsIHdlIGp1\nc3QgZXJyb3Igb3V0IHRoZSBwZW5kaW5nIGVudHJpZXMKICAgICAqLwogICAg\nQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBjaGFubmVsRGlzY29ubmVjdGVk\nKENoYW5uZWxIYW5kbGVyQ29udGV4dCBjdHgsIENoYW5uZWxTdGF0ZUV2ZW50\nIGUpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExPRy5pbmZvKCJEaXNj\nb25uZWN0ZWQgZnJvbSBib29raWU6ICIgKyBhZGRyKTsKICAgICAgICBlcnJv\nck91dE91dHN0YW5kaW5nRW50cmllcygpOwogICAgICAgIGNoYW5uZWwuY2xv\nc2UoKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHRoaXMpIHsKICAgICAgICAg\nICAgc3RhdGUgPSBDb25uZWN0aW9uU3RhdGUuRElTQ09OTkVDVEVEOwogICAg\nICAgIH0KCiAgICAgICAgLy8gd2UgZG9uJ3Qgd2FudCB0byByZWNvbm5lY3Qg\ncmlnaHQgYXdheS4gSWYgc29tZW9uZSBzZW5kcyBhIHJlcXVlc3QgdG8KICAg\nICAgICAvLyB0aGlzIGFkZHJlc3MsIHdlIHdpbGwgcmVjb25uZWN0LgogICAg\nfQoKICAgIC8qKgogICAgICogQ2FsbGVkIGJ5IG5ldHR5IHdoZW4gYW4gZXhj\nZXB0aW9uIGhhcHBlbnMgaW4gb25lIG9mIHRoZSBuZXR0eSB0aHJlYWRzCiAg\nICAgKiAobW9zdGx5IGR1ZSB0byB3aGF0IHdlIGRvIGluIHRoZSBuZXR0eSB0\naHJlYWRzKQogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lk\nIGV4Y2VwdGlvbkNhdWdodChDaGFubmVsSGFuZGxlckNvbnRleHQgY3R4LCBF\neGNlcHRpb25FdmVudCBlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBU\naHJvd2FibGUgdCA9IGUuZ2V0Q2F1c2UoKTsKICAgICAgICBpZiAodCBpbnN0\nYW5jZW9mIENvcnJ1cHRlZEZyYW1lRXhjZXB0aW9uIHx8IHQgaW5zdGFuY2Vv\nZiBUb29Mb25nRnJhbWVFeGNlcHRpb24pIHsKICAgICAgICAgICAgTE9HLmVy\ncm9yKCJDb3JydXB0ZWQgZnJhbSByZWNlaXZlZCBmcm9tIGJvb2tpZTogIgog\nICAgICAgICAgICAgICAgICAgICAgKyBlLmdldENoYW5uZWwoKS5nZXRSZW1v\ndGVBZGRyZXNzKCkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQog\nICAgICAgIGlmICh0IGluc3RhbmNlb2YgUmVhZFRpbWVvdXRFeGNlcHRpb24p\nIHsKICAgICAgICAgICAgZm9yIChDb21wbGV0aW9uS2V5IGtleSA6IGFkZENv\nbXBsZXRpb25zLmtleVNldCgpKSB7CiAgICAgICAgICAgICAgICBpZiAoa2V5\nLnNob3VsZFRpbWVvdXQoKSkgewogICAgICAgICAgICAgICAgICAgIGVycm9y\nT3V0QWRkS2V5KGtleSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgZm9yIChDb21wbGV0aW9uS2V5IGtleSA6IHJlYWRD\nb21wbGV0aW9ucy5rZXlTZXQoKSkgewogICAgICAgICAgICAgICAgaWYgKGtl\neS5zaG91bGRUaW1lb3V0KCkpIHsKICAgICAgICAgICAgICAgICAgICBlcnJv\nck91dFJlYWRLZXkoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBp\nZiAodCBpbnN0YW5jZW9mIElPRXhjZXB0aW9uKSB7CiAgICAgICAgICAgIC8v\nIHRoZXNlIGFyZSB0aHJvd24gd2hlbiBhIGJvb2tpZSBmYWlscywgbG9nZ2lu\nZyB0aGVtIGp1c3QgcG9sbHV0ZXMKICAgICAgICAgICAgLy8gdGhlIGxvZ3Mg\nKHRoZSBmYWlsdXJlIGlzIGxvZ2dlZCBmcm9tIHRoZSBsaXN0ZW5lcnMgb24g\ndGhlIHdyaXRlCiAgICAgICAgICAgIC8vIG9wZXJhdGlvbiksIHNvIEknbGwg\nanVzdCBpZ25vcmUgaXQgaGVyZS4KICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgIH0KCiAgICAgICAgTE9HLmVycm9yKCJVbmV4cGVjdGVkIGV4Y2VwdGlv\nbiBjYXVnaHQgYnkgYm9va2llIGNsaWVudCBjaGFubmVsIGhhbmRsZXIiLCB0\nKTsKICAgICAgICAvLyBTaW5jZSB3ZSBhcmUgYSBsaWJyYXJ5LCBjYW50IHRl\ncm1pbmF0ZSBBcHAgaGVyZSwgY2FuIHdlPwogICAgfQoKICAgIC8qKgogICAg\nICogQ2FsbGVkIGJ5IG5ldHR5IHdoZW4gYSBtZXNzYWdlIGlzIHJlY2VpdmVk\nIG9uIGEgY2hhbm5lbAogICAgICovCiAgICBAT3ZlcnJpZGUKICAgIHB1Ymxp\nYyB2b2lkIG1lc3NhZ2VSZWNlaXZlZChDaGFubmVsSGFuZGxlckNvbnRleHQg\nY3R4LCBNZXNzYWdlRXZlbnQgZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKCEoZS5nZXRNZXNzYWdlKCkgaW5zdGFuY2VvZiBDaGFubmVsQnVm\nZmVyKSkgewogICAgICAgICAgICBjdHguc2VuZFVwc3RyZWFtKGUpOwogICAg\nICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBmaW5hbCBDaGFu\nbmVsQnVmZmVyIGJ1ZmZlciA9IChDaGFubmVsQnVmZmVyKSBlLmdldE1lc3Nh\nZ2UoKTsKICAgICAgICBmaW5hbCBpbnQgdHlwZSwgcmM7CiAgICAgICAgZmlu\nYWwgbG9uZyBsZWRnZXJJZCwgZW50cnlJZDsKICAgICAgICBmaW5hbCBQYWNr\nZXRIZWFkZXIgaGVhZGVyOwoKICAgICAgICB0cnkgewogICAgICAgICAgICBo\nZWFkZXIgPSBQYWNrZXRIZWFkZXIuZnJvbUludChidWZmZXIucmVhZEludCgp\nKTsKICAgICAgICAgICAgcmMgPSBidWZmZXIucmVhZEludCgpOwogICAgICAg\nICAgICBsZWRnZXJJZCA9IGJ1ZmZlci5yZWFkTG9uZygpOwogICAgICAgICAg\nICBlbnRyeUlkID0gYnVmZmVyLnJlYWRMb25nKCk7CiAgICAgICAgfSBjYXRj\naCAoSW5kZXhPdXRPZkJvdW5kc0V4Y2VwdGlvbiBleCkgewogICAgICAgICAg\nICBMT0cuZXJyb3IoIlVucGFyc2VhYmxlIHJlc3BvbnNlIGZyb20gYm9va2ll\nOiAiICsgYWRkciwgZXgpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nfQoKICAgICAgICBleGVjdXRvci5zdWJtaXRPcmRlcmVkKGxlZGdlcklkLCBu\nZXcgU2FmZVJ1bm5hYmxlKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgc2FmZVJ1bigpIHsKICAgICAgICAgICAg\nICAgIHN3aXRjaCAoaGVhZGVyLmdldE9wQ29kZSgpKSB7CiAgICAgICAgICAg\nICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkFEREVOVFJZOgogICAgICAgICAg\nICAgICAgICAgIGhhbmRsZUFkZFJlc3BvbnNlKGxlZGdlcklkLCBlbnRyeUlk\nLCByYyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nICAgICBjYXNlIEJvb2tpZVByb3RvY29sLlJFQURFTlRSWToKICAgICAgICAg\nICAgICAgICAgICBoYW5kbGVSZWFkUmVzcG9uc2UobGVkZ2VySWQsIGVudHJ5\nSWQsIHJjLCBidWZmZXIpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgICAgICBM\nT0cuZXJyb3IoIlVuZXhwZWN0ZWQgcmVzcG9uc2UsIHR5cGU6ICIgKyBoZWFk\nZXIuZ2V0T3BDb2RlKCkgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgIiByZWNlaXZlZCBmcm9tIGJvb2tpZTogIiArIGFkZHIgKyAiICwgaWdu\nb3JpbmciKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0pOwogICAgfQoKICAgIHZvaWQgaGFuZGxlQWRkUmVzcG9uc2UobG9u\nZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLCBpbnQgcmMpIHsKICAgICAgICBp\nZiAoTE9HLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgTE9HLmRl\nYnVnKCJHb3QgcmVzcG9uc2UgZm9yIGFkZCByZXF1ZXN0IGZyb20gYm9va2ll\nOiAiICsgYWRkciArICIgZm9yIGxlZGdlcjogIiArIGxlZGdlcklkICsgIiBl\nbnRyeTogIgogICAgICAgICAgICAgICAgICAgICAgKyBlbnRyeUlkICsgIiBy\nYzogIiArIHJjKTsKICAgICAgICB9CgogICAgICAgIC8vIGNvbnZlcnQgdG8g\nQktFeGNlcHRpb24gY29kZSBiZWNhdXNlIHRoYXRzIHdoYXQgdGhlIHVwcHBl\ncgogICAgICAgIC8vIGxheWVycyBleHBlY3QuIFRoaXMgaXMgVUdMWSwgdGhl\ncmUgc2hvdWxkIGp1c3QgYmUgb25lIHNldCBvZgogICAgICAgIC8vIGVycm9y\nIGNvZGVzLgogICAgICAgIHN3aXRjaCAocmMpIHsKICAgICAgICBjYXNlIEJv\nb2tpZVByb3RvY29sLkVPSzoKICAgICAgICAgICAgcmMgPSBCS0V4Y2VwdGlv\nbi5Db2RlLk9LOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEJv\nb2tpZVByb3RvY29sLkVCQURWRVJTSU9OOgogICAgICAgICAgICByYyA9IEJL\nRXhjZXB0aW9uLkNvZGUuUHJvdG9jb2xWZXJzaW9uRXhjZXB0aW9uOwogICAg\nICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEJvb2tpZVByb3RvY29sLkVG\nRU5DRUQ6CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5MZWRn\nZXJGZW5jZWRFeGNlcHRpb247CiAgICAgICAgICAgIGJyZWFrOwogICAgICAg\nIGNhc2UgQm9va2llUHJvdG9jb2wuRVVBOgogICAgICAgICAgICByYyA9IEJL\nRXhjZXB0aW9uLkNvZGUuVW5hdXRob3JpemVkQWNjZXNzRXhjZXB0aW9uOwog\nICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAg\nICBMT0cuZXJyb3IoIkFkZCBmb3IgbGVkZ2VyOiAiICsgbGVkZ2VySWQgKyAi\nLCBlbnRyeTogIiArIGVudHJ5SWQgKyAiIGZhaWxlZCBvbiBib29raWU6ICIg\nKyBhZGRyCiAgICAgICAgICAgICAgICAgICAgICArICIgd2l0aCBjb2RlOiAi\nICsgcmMpOwogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuV3Jp\ndGVFeGNlcHRpb247CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KCiAg\nICAgICAgQWRkQ29tcGxldGlvbiBhYzsKICAgICAgICBhYyA9IGFkZENvbXBs\nZXRpb25zLnJlbW92ZShuZXcgQ29tcGxldGlvbktleShsZWRnZXJJZCwgZW50\ncnlJZCkpOwogICAgICAgIGlmIChhYyA9PSBudWxsKSB7CiAgICAgICAgICAg\nIExPRy5lcnJvcigiVW5leHBlY3RlZCBhZGQgcmVzcG9uc2UgcmVjZWl2ZWQg\nZnJvbSBib29raWU6ICIgKyBhZGRyICsgIiBmb3IgbGVkZ2VyOiAiICsgbGVk\nZ2VySWQKICAgICAgICAgICAgICAgICAgICAgICsgIiwgZW50cnk6ICIgKyBl\nbnRyeUlkICsgIiAsIGlnbm9yaW5nIik7CiAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICB9CgogICAgICAgIC8vIHRvdGFsQnl0ZXNPdXRzdGFuZGluZy5h\nZGRBbmRHZXQoLWFjLnNpemUpOwoKICAgICAgICBhYy5jYi53cml0ZUNvbXBs\nZXRlKHJjLCBsZWRnZXJJZCwgZW50cnlJZCwgYWRkciwgYWMuY3R4KTsKCiAg\nICB9CgogICAgdm9pZCBoYW5kbGVSZWFkUmVzcG9uc2UobG9uZyBsZWRnZXJJ\nZCwgbG9uZyBlbnRyeUlkLCBpbnQgcmMsIENoYW5uZWxCdWZmZXIgYnVmZmVy\nKSB7CiAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAg\nICAgICAgIExPRy5kZWJ1ZygiR290IHJlc3BvbnNlIGZvciByZWFkIHJlcXVl\nc3QgZnJvbSBib29raWU6ICIgKyBhZGRyICsgIiBmb3IgbGVkZ2VyOiAiICsg\nbGVkZ2VySWQgKyAiIGVudHJ5OiAiCiAgICAgICAgICAgICAgICAgICAgICAr\nIGVudHJ5SWQgKyAiIHJjOiAiICsgcmMgKyAiZW50cnkgbGVuZ3RoOiAiICsg\nYnVmZmVyLnJlYWRhYmxlQnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICAv\nLyBjb252ZXJ0IHRvIEJLRXhjZXB0aW9uIGNvZGUgYmVjYXVzZSB0aGF0cyB3\naGF0IHRoZSB1cHBwZXIKICAgICAgICAvLyBsYXllcnMgZXhwZWN0LiBUaGlz\nIGlzIFVHTFksIHRoZXJlIHNob3VsZCBqdXN0IGJlIG9uZSBzZXQgb2YKICAg\nICAgICAvLyBlcnJvciBjb2Rlcy4KICAgICAgICBpZiAocmMgPT0gQm9va2ll\nUHJvdG9jb2wuRU9LKSB7CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24u\nQ29kZS5PSzsKICAgICAgICB9IGVsc2UgaWYgKHJjID09IEJvb2tpZVByb3Rv\nY29sLkVOT0VOVFJZIHx8IHJjID09IEJvb2tpZVByb3RvY29sLkVOT0xFREdF\nUikgewogICAgICAgICAgICByYyA9IEJLRXhjZXB0aW9uLkNvZGUuTm9TdWNo\nRW50cnlFeGNlcHRpb247CiAgICAgICAgfSBlbHNlIGlmIChyYyA9PSBCb29r\naWVQcm90b2NvbC5FQkFEVkVSU0lPTikgewogICAgICAgICAgICByYyA9IEJL\nRXhjZXB0aW9uLkNvZGUuUHJvdG9jb2xWZXJzaW9uRXhjZXB0aW9uOwogICAg\nICAgIH0gZWxzZSBpZiAocmMgPT0gQm9va2llUHJvdG9jb2wuRVVBKSB7CiAg\nICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5VbmF1dGhvcml6ZWRB\nY2Nlc3NFeGNlcHRpb247CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJSZWFkIGZvciBsZWRnZXI6ICIgKyBsZWRnZXJJZCArICIs\nIGVudHJ5OiAiICsgZW50cnlJZCArICIgZmFpbGVkIG9uIGJvb2tpZTogIiAr\nIGFkZHIKICAgICAgICAgICAgICAgICAgICAgICsgIiB3aXRoIGNvZGU6ICIg\nKyByYyk7CiAgICAgICAgICAgIHJjID0gQktFeGNlcHRpb24uQ29kZS5SZWFk\nRXhjZXB0aW9uOwogICAgICAgIH0KCiAgICAgICAgQ29tcGxldGlvbktleSBr\nZXkgPSBuZXcgQ29tcGxldGlvbktleShsZWRnZXJJZCwgZW50cnlJZCk7CiAg\nICAgICAgUmVhZENvbXBsZXRpb24gcmVhZENvbXBsZXRpb24gPSByZWFkQ29t\ncGxldGlvbnMucmVtb3ZlKGtleSk7CgogICAgICAgIGlmIChyZWFkQ29tcGxl\ndGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgIC8qCiAgICAgICAgICAgICAq\nIFRoaXMgaXMgYSBzcGVjaWFsIGNhc2UuIFdoZW4gcmVjb3ZlcmluZyBhIGxl\nZGdlciwgYSBjbGllbnQKICAgICAgICAgICAgICogc3VibWl0cyBhIHJlYWQg\ncmVxdWVzdCB3aXRoIGlkIC0xLCBhbmQgcmVjZWl2ZXMgYSByZXNwb25zZSB3\naXRoIGEKICAgICAgICAgICAgICogZGlmZmVyZW50IGVudHJ5IGlkLgogICAg\nICAgICAgICAgKi8KICAgICAgICAgICAgCiAgICAgICAgICAgIHJlYWRDb21w\nbGV0aW9uID0gcmVhZENvbXBsZXRpb25zLnJlbW92ZShuZXcgQ29tcGxldGlv\nbktleShsZWRnZXJJZCwgQm9va2llUHJvdG9jb2wuTEFTVF9BRERfQ09ORklS\nTUVEKSk7CiAgICAgICAgfQoKICAgICAgICBpZiAocmVhZENvbXBsZXRpb24g\nPT0gbnVsbCkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlVuZXhwZWN0ZWQg\ncmVhZCByZXNwb25zZSByZWNlaXZlZCBmcm9tIGJvb2tpZTogIiArIGFkZHIg\nKyAiIGZvciBsZWRnZXI6ICIgKyBsZWRnZXJJZAogICAgICAgICAgICAgICAg\nICAgICAgKyAiLCBlbnRyeTogIiArIGVudHJ5SWQgKyAiICwgaWdub3Jpbmci\nKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmVh\nZENvbXBsZXRpb24uY2IucmVhZEVudHJ5Q29tcGxldGUocmMsIGxlZGdlcklk\nLCBlbnRyeUlkLCBidWZmZXIuc2xpY2UoKSwgcmVhZENvbXBsZXRpb24uY3R4\nKTsKICAgIH0KCiAgICAvKioKICAgICAqIEJvaWxlci1wbGF0ZSB3cmFwcGVy\nIGNsYXNzZXMgZm9sbG93CiAgICAgKgogICAgICovCiAgICAvLyB2aXNpYmxl\nIGZvciB0ZXN0aW5nCiAgICBzdGF0aWMgY2xhc3MgUmVhZENvbXBsZXRpb24g\newogICAgICAgIGZpbmFsIFJlYWRFbnRyeUNhbGxiYWNrIGNiOwogICAgICAg\nIGZpbmFsIE9iamVjdCBjdHg7CgogICAgICAgIHB1YmxpYyBSZWFkQ29tcGxl\ndGlvbihSZWFkRW50cnlDYWxsYmFjayBjYiwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICB0aGlzLmNiID0gY2I7CiAgICAgICAgICAgIHRoaXMuY3R4ID0g\nY3R4OwogICAgICAgIH0KICAgIH0KCiAgICAvLyB2aXNpYmxlIGZvciB0ZXN0\naW5nCiAgICBzdGF0aWMgY2xhc3MgQWRkQ29tcGxldGlvbiB7CiAgICAgICAg\nZmluYWwgV3JpdGVDYWxsYmFjayBjYjsKICAgICAgICAvL2ZpbmFsIGxvbmcg\nc2l6ZTsKICAgICAgICBmaW5hbCBPYmplY3QgY3R4OwoKICAgICAgICBwdWJs\naWMgQWRkQ29tcGxldGlvbihXcml0ZUNhbGxiYWNrIGNiLCBsb25nIHNpemUs\nIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgdGhpcy5jYiA9IGNiOwogICAg\nICAgICAgICAvL3RoaXMuc2l6ZSA9IHNpemU7CiAgICAgICAgICAgIHRoaXMu\nY3R4ID0gY3R4OwogICAgICAgIH0KICAgIH0KCiAgICAvLyB2aXNhYmxlIGZv\nciB0ZXN0aW5nCiAgICBDb21wbGV0aW9uS2V5IG5ld0NvbXBsZXRpb25LZXko\nbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkKSB7CiAgICAgICAgcmV0dXJu\nIG5ldyBDb21wbGV0aW9uS2V5KGxlZGdlcklkLCBlbnRyeUlkKTsKICAgIH0K\nCiAgICAvLyB2aXNhYmxlIGZvciB0ZXN0aW5nCiAgICBjbGFzcyBDb21wbGV0\naW9uS2V5IHsKICAgICAgICBsb25nIGxlZGdlcklkOwogICAgICAgIGxvbmcg\nZW50cnlJZDsKICAgICAgICBmaW5hbCBsb25nIHRpbWVvdXRBdDsKCiAgICAg\nICAgQ29tcGxldGlvbktleShsb25nIGxlZGdlcklkLCBsb25nIGVudHJ5SWQp\nIHsKICAgICAgICAgICAgdGhpcy5sZWRnZXJJZCA9IGxlZGdlcklkOwogICAg\nICAgICAgICB0aGlzLmVudHJ5SWQgPSBlbnRyeUlkOwogICAgICAgICAgICB0\naGlzLnRpbWVvdXRBdCA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpICsg\nKGNvbmYuZ2V0UmVhZFRpbWVvdXQoKSoxMDAwKTsKICAgICAgICB9CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGVxdWFscyhP\nYmplY3Qgb2JqKSB7CiAgICAgICAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9m\nIENvbXBsZXRpb25LZXkpIHx8IG9iaiA9PSBudWxsKSB7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nQ29tcGxldGlvbktleSB0aGF0ID0gKENvbXBsZXRpb25LZXkpIG9iajsKICAg\nICAgICAgICAgcmV0dXJuIHRoaXMubGVkZ2VySWQgPT0gdGhhdC5sZWRnZXJJ\nZCAmJiB0aGlzLmVudHJ5SWQgPT0gdGhhdC5lbnRyeUlkOwogICAgICAgIH0K\nCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBoYXNoQ29k\nZSgpIHsKICAgICAgICAgICAgcmV0dXJuICgoaW50KSBsZWRnZXJJZCA8PCAx\nNikgXiAoKGludCkgZW50cnlJZCk7CiAgICAgICAgfQoKICAgICAgICBwdWJs\naWMgU3RyaW5nIHRvU3RyaW5nKCkgewogICAgICAgICAgICByZXR1cm4gU3Ry\naW5nLmZvcm1hdCgiTGVkZ2VyRW50cnkoJWQsICVkKSIsIGxlZGdlcklkLCBl\nbnRyeUlkKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBib29sZWFuIHNo\nb3VsZFRpbWVvdXQoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRpbWVv\ndXRBdCA8PSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICB9\nCiAgICB9Cgp9Cg==\n","encoding":"base64"}

