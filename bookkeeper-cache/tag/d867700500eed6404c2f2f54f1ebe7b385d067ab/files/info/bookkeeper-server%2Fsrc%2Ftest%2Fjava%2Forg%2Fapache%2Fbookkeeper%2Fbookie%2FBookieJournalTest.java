{"sha":"3c6d99b6d5670eb023699c7402b89c0b2a24ba2d","node_id":"MDQ6QmxvYjE1NzU5NTY6M2M2ZDk5YjZkNTY3MGViMDIzNjk5Yzc0MDJiODljMGIyYTI0YmEyZA==","size":20847,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3c6d99b6d5670eb023699c7402b89c0b2a24ba2d","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuYm9va2llOwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5SYW5kb21BY2Nl\nc3NGaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLm5pby5jaGFubmVscy5G\naWxlQ2hhbm5lbDsKaW1wb3J0IGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9y\ndCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwuUmFu\nZG9tOwppbXBvcnQgamF2YS51dGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5B\ncnJheXM7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNvbmYuU2Vy\ndmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFjazsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXJUZXN0\nQ2xpZW50OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5M\nZWRnZXJFbnRyeTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGll\nbnQuQ2xpZW50VXRpbDsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5j\nbGllbnQuTGVkZ2VySGFuZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5Bc3luY0NhbGxiYWNrLlJlYWRDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdl\nc3RUeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJv\nb2tpZVNlcnZlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBv\ncmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9v\na2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2Vl\ncGVyLldhdGNoZXI7CmltcG9ydCBvcmcuanVuaXQuQmVmb3JlOwppbXBvcnQg\nb3JnLmp1bml0LlRlc3Q7CmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2Vy\ndC4qOwoKcHVibGljIGNsYXNzIEJvb2tpZUpvdXJuYWxUZXN0IHsKICAgIHN0\nYXRpYyBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQm9v\na2llSm91cm5hbFRlc3QuY2xhc3MpOwoKICAgIGZpbmFsIFJhbmRvbSByID0g\nbmV3IFJhbmRvbShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CgogICAg\ncHJpdmF0ZSB2b2lkIHdyaXRlSW5kZXhGaWxlRm9yTGVkZ2VyKEZpbGUgaW5k\nZXhEaXIsIGxvbmcgbGVkZ2VySWQsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgYnl0ZVtdIG1hc3RlcktleSkKICAgICAgICAg\nICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmlsZSBmbiA9IG5ldyBG\naWxlKGluZGV4RGlyLCBMZWRnZXJDYWNoZUltcGwuZ2V0TGVkZ2VyTmFtZShs\nZWRnZXJJZCkpOwogICAgICAgIGZuLmdldFBhcmVudEZpbGUoKS5ta2RpcnMo\nKTsKICAgICAgICBGaWxlSW5mbyBmaSA9IG5ldyBGaWxlSW5mbyhmbiwgbWFz\ndGVyS2V5KTsKICAgICAgICAvLyBmb3JjZSBjcmVhdGlvbiBvZiBpbmRleCBm\naWxlCiAgICAgICAgZmkud3JpdGUobmV3IEJ5dGVCdWZmZXJbXXsgQnl0ZUJ1\nZmZlci5hbGxvY2F0ZSgwKSB9LCAwKTsKICAgICAgICBmaS5jbG9zZSh0cnVl\nKTsKICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVQYXJ0aWFsSW5kZXhG\naWxlRm9yTGVkZ2VyKEZpbGUgaW5kZXhEaXIsIGxvbmcgbGVkZ2VySWQsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGJ5dGVbXSBtYXN0ZXJLZXksIGJvb2xlYW4gdHJ1bmNhdGVUb01hc3Rlcktl\neSkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgRmls\nZSBmbiA9IG5ldyBGaWxlKGluZGV4RGlyLCBMZWRnZXJDYWNoZUltcGwuZ2V0\nTGVkZ2VyTmFtZShsZWRnZXJJZCkpOwogICAgICAgIGZuLmdldFBhcmVudEZp\nbGUoKS5ta2RpcnMoKTsKICAgICAgICBGaWxlSW5mbyBmaSA9IG5ldyBGaWxl\nSW5mbyhmbiwgbWFzdGVyS2V5KTsKICAgICAgICAvLyBmb3JjZSBjcmVhdGlv\nbiBvZiBpbmRleCBmaWxlCiAgICAgICAgZmkud3JpdGUobmV3IEJ5dGVCdWZm\nZXJbXXsgQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgwKSB9LCAwKTsKICAgICAgICBm\naS5jbG9zZSh0cnVlKTsKICAgICAgICAvLyBmaWxlIGluZm8gaGVhZGVyCiAg\nICAgICAgaW50IGhlYWRlckxlbiA9IDggKyA0ICsgbWFzdGVyS2V5Lmxlbmd0\naDsKICAgICAgICAvLyB0cnVuY2F0ZSB0aGUgaW5kZXggZmlsZQogICAgICAg\nIGludCBsZWZ0U2l6ZTsKICAgICAgICBpZiAodHJ1bmNhdGVUb01hc3Rlcktl\neSkgewogICAgICAgICAgICBsZWZ0U2l6ZSA9IHIubmV4dEludChoZWFkZXJM\nZW4pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlZnRTaXplID0g\naGVhZGVyTGVuICsgci5uZXh0SW50KDEwMjQgLSBoZWFkZXJMZW4pOwogICAg\nICAgIH0KICAgICAgICBGaWxlQ2hhbm5lbCBmYyA9IG5ldyBSYW5kb21BY2Nl\nc3NGaWxlKGZuLCAicnciKS5nZXRDaGFubmVsKCk7CiAgICAgICAgZmMudHJ1\nbmNhdGUobGVmdFNpemUpOwogICAgICAgIGZjLmNsb3NlKCk7CiAgICB9Cgog\nICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBtZXRhIGVudHJ5IHdpdGggZ2l2ZW4g\nbWFzdGVyIGtleQogICAgICovCiAgICBwcml2YXRlIEJ5dGVCdWZmZXIgZ2Vu\nZXJhdGVNZXRhRW50cnkobG9uZyBsZWRnZXJJZCwgYnl0ZVtdIG1hc3Rlcktl\neSkgewogICAgICAgIEJ5dGVCdWZmZXIgYmIgPSBCeXRlQnVmZmVyLmFsbG9j\nYXRlKDggKyA4ICsgNCArIG1hc3RlcktleS5sZW5ndGgpOwogICAgICAgIGJi\nLnB1dExvbmcobGVkZ2VySWQpOwogICAgICAgIGJiLnB1dExvbmcoQm9va2ll\nLk1FVEFFTlRSWV9JRF9MRURHRVJfS0VZKTsKICAgICAgICBiYi5wdXRJbnQo\nbWFzdGVyS2V5Lmxlbmd0aCk7CiAgICAgICAgYmIucHV0KG1hc3RlcktleSk7\nCiAgICAgICAgYmIuZmxpcCgpOwogICAgICAgIHJldHVybiBiYjsKICAgIH0K\nCiAgICBwcml2YXRlIHZvaWQgd3JpdGVKdW5rSm91cm5hbChGaWxlIGpvdXJu\nYWxEaXIpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxvbmcgbG9nSWQg\nPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAgICBGaWxlIGZu\nID0gbmV3IEZpbGUoam91cm5hbERpciwgTG9uZy50b0hleFN0cmluZyhsb2dJ\nZCkgKyAiLnR4biIpOwoKICAgICAgICBGaWxlQ2hhbm5lbCBmYyA9IG5ldyBS\nYW5kb21BY2Nlc3NGaWxlKGZuLCAicnciKS5nZXRDaGFubmVsKCk7CgogICAg\nICAgIEJ5dGVCdWZmZXIgemVyb3MgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDUx\nMik7CiAgICAgICAgZmMud3JpdGUoemVyb3MsIDQqMTAyNCoxMDI0KTsKICAg\nICAgICBmYy5wb3NpdGlvbigwKTsKCiAgICAgICAgZm9yIChpbnQgaSA9IDE7\nIGkgPD0gMTA7IGkrKykgewogICAgICAgICAgICBmYy53cml0ZShCeXRlQnVm\nZmVyLndyYXAoIkp1bmtKdW5rSnVuayIuZ2V0Qnl0ZXMoKSkpOwogICAgICAg\nIH0KICAgIH0KCiAgICBwcml2YXRlIHZvaWQgd3JpdGVQcmVWMkpvdXJuYWwo\nRmlsZSBqb3VybmFsRGlyLCBpbnQgbnVtRW50cmllcykgdGhyb3dzIEV4Y2Vw\ndGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgIEZpbGUgZm4gPSBuZXcgRmlsZShqb3VybmFs\nRGlyLCBMb25nLnRvSGV4U3RyaW5nKGxvZ0lkKSArICIudHhuIik7CgogICAg\nICAgIEZpbGVDaGFubmVsIGZjID0gbmV3IFJhbmRvbUFjY2Vzc0ZpbGUoZm4s\nICJydyIpLmdldENoYW5uZWwoKTsKCiAgICAgICAgQnl0ZUJ1ZmZlciB6ZXJv\ncyA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNTEyKTsKICAgICAgICBmYy53cml0\nZSh6ZXJvcywgNCoxMDI0KjEwMjQpOwogICAgICAgIGZjLnBvc2l0aW9uKDAp\nOwoKICAgICAgICBieXRlW10gZGF0YSA9ICJKb3VybmFsVGVzdERhdGEiLmdl\ndEJ5dGVzKCk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gTGVkZ2Vy\nSGFuZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDE7IGkgPD0gbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgcGFja2V0ID0gQ2xpZW50VXRpbC5nZW5lcmF0ZVBhY2tldCgxLCBp\nLCBsYXN0Q29uZmlybWVkLCBpKmRhdGEubGVuZ3RoLCBkYXRhKS50b0J5dGVC\ndWZmZXIoKTsKICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IGk7CiAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50KHBhY2tldC5yZW1h\naW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwoKICAgICAg\nICAgICAgZmMud3JpdGUobGVuQnVmZik7CiAgICAgICAgICAgIGZjLndyaXRl\nKHBhY2tldCk7CiAgICAgICAgfQogICAgfQoKICAgIHByaXZhdGUgSm91cm5h\nbENoYW5uZWwgd3JpdGVQb3N0VjJKb3VybmFsKEZpbGUgam91cm5hbERpciwg\naW50IG51bUVudHJpZXMpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGxv\nbmcgbG9nSWQgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKTsKICAgICAg\nICBKb3VybmFsQ2hhbm5lbCBqYyA9IG5ldyBKb3VybmFsQ2hhbm5lbChqb3Vy\nbmFsRGlyLCBsb2dJZCk7CgogICAgICAgIEJ1ZmZlcmVkQ2hhbm5lbCBiYyA9\nIGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpOwoKICAgICAgICBieXRlW10gZGF0\nYSA9IG5ldyBieXRlWzEwMjRdOwogICAgICAgIEFycmF5cy5maWxsKGRhdGEs\nIChieXRlKSdYJyk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gTGVk\nZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQ7CiAgICAgICAgZm9yIChpbnQg\naSA9IDE7IGkgPD0gbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAgICAgIEJ5\ndGVCdWZmZXIgcGFja2V0ID0gQ2xpZW50VXRpbC5nZW5lcmF0ZVBhY2tldCgx\nLCBpLCBsYXN0Q29uZmlybWVkLCBpKmRhdGEubGVuZ3RoLCBkYXRhKS50b0J5\ndGVCdWZmZXIoKTsKICAgICAgICAgICAgbGFzdENvbmZpcm1lZCA9IGk7CiAg\nICAgICAgICAgIEJ5dGVCdWZmZXIgbGVuQnVmZiA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoNCk7CiAgICAgICAgICAgIGxlbkJ1ZmYucHV0SW50KHBhY2tldC5y\nZW1haW5pbmcoKSk7CiAgICAgICAgICAgIGxlbkJ1ZmYuZmxpcCgpOwoKICAg\nICAgICAgICAgYmMud3JpdGUobGVuQnVmZik7CiAgICAgICAgICAgIGJjLndy\naXRlKHBhY2tldCk7CiAgICAgICAgfQogICAgICAgIGJjLmZsdXNoKHRydWUp\nOwoKICAgICAgICByZXR1cm4gamM7CiAgICB9CgogICAgcHJpdmF0ZSBKb3Vy\nbmFsQ2hhbm5lbCB3cml0ZVBvc3RWM0pvdXJuYWwoRmlsZSBqb3VybmFsRGly\nLCBpbnQgbnVtRW50cmllcywgYnl0ZVtdIG1hc3RlcktleSkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgbG9uZyBsb2dJZCA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gbmV3\nIEpvdXJuYWxDaGFubmVsKGpvdXJuYWxEaXIsIGxvZ0lkKTsKCiAgICAgICAg\nQnVmZmVyZWRDaGFubmVsIGJjID0gamMuZ2V0QnVmZmVyZWRDaGFubmVsKCk7\nCgogICAgICAgIGJ5dGVbXSBkYXRhID0gbmV3IGJ5dGVbMTAyNF07CiAgICAg\nICAgQXJyYXlzLmZpbGwoZGF0YSwgKGJ5dGUpJ1gnKTsKICAgICAgICBsb25n\nIGxhc3RDb25maXJtZWQgPSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9J\nRDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8PSBudW1FbnRyaWVzOyBp\nKyspIHsKICAgICAgICAgICAgQnl0ZUJ1ZmZlciBwYWNrZXQ7CiAgICAgICAg\nICAgIGlmIChpID09IDApIHsKICAgICAgICAgICAgICAgIHBhY2tldCA9IGdl\nbmVyYXRlTWV0YUVudHJ5KDEsIG1hc3RlcktleSk7CiAgICAgICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgICAgICBwYWNrZXQgPSBDbGllbnRVdGlsLmdl\nbmVyYXRlUGFja2V0KDEsIGksIGxhc3RDb25maXJtZWQsIGkqZGF0YS5sZW5n\ndGgsIGRhdGEpLnRvQnl0ZUJ1ZmZlcigpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIGxhc3RDb25maXJtZWQgPSBpOwogICAgICAgICAgICBCeXRlQnVm\nZmVyIGxlbkJ1ZmYgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAg\nICAgICBsZW5CdWZmLnB1dEludChwYWNrZXQucmVtYWluaW5nKCkpOwogICAg\nICAgICAgICBsZW5CdWZmLmZsaXAoKTsKCiAgICAgICAgICAgIGJjLndyaXRl\nKGxlbkJ1ZmYpOwogICAgICAgICAgICBiYy53cml0ZShwYWNrZXQpOwogICAg\nICAgIH0KICAgICAgICBiYy5mbHVzaCh0cnVlKTsKCiAgICAgICAgcmV0dXJu\nIGpjOwogICAgfQoKICAgIC8qKgogICAgICogdGVzdCB0aGF0IHdlIGNhbiBv\ncGVuIGEgam91cm5hbCB3cml0dGVuIHdpdGhvdXQgdGhlIG1hZ2ljCiAgICAg\nKiB3b3JkIGF0IHRoZSBzdGFydC4gVGhpcyBpcyBmb3IgdmVyc2lvbnMgb2Yg\nYm9va2tlZXBlciBiZWZvcmUKICAgICAqIHRoZSBtYWdpYyB3b3JkIHdhcyBp\nbnRyb2R1Y2VkCiAgICAgKi8KICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0\nZXN0UHJlVjJKb3VybmFsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2ll\nIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFsRGlyLmRlbGV0ZSgpOwog\nICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hl\nY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxlIGxlZGdlckRpciA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsKICAgICAg\nICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGly\nKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJv\nb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpcikpOwoKICAgICAg\nICB3cml0ZVByZVYySm91cm5hbChCb29raWUuZ2V0Q3VycmVudERpcmVjdG9y\neShqb3VybmFsRGlyKSwgMTAwKTsKICAgICAgICB3cml0ZUluZGV4RmlsZUZv\nckxlZGdlcihCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJEaXIp\nLCAxLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFNlcnZl\nckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9u\nKCkKICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAg\nICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAg\nICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBs\nZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwoKICAgICAgICBCb29raWUgYiA9IG5l\ndyBCb29raWUoY29uZik7CiAgICAgICAgYi5zdGFydCgpOwoKICAgICAgICBi\nLnJlYWRFbnRyeSgxLCAxMDApOwogICAgICAgIHRyeSB7CiAgICAgICAgICAg\nIGIucmVhZEVudHJ5KDEsIDEwMSk7CiAgICAgICAgICAgIGZhaWwoIlNob3Vs\nZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEwMSIpOwogICAgICAgIH0gY2F0Y2gg\nKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgLy8g\nY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9CgogICAgICAgIGIuc2h1dGRv\nd24oKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiB0aGUg\nam91cm5hbCBpcyBhbGwgam91cm5hbCwgd2UgY2FuIG5vdAogICAgICogc3Rh\ncnQgdGhlIGJvb2tpZS4gQW4gYWRtaW4gc2hvdWxkIGxvb2sgdG8gc2VlIHdo\nYXQgaGFzCiAgICAgKiBoYXBwZW5lZCBpbiB0aGlzIGNhc2UKICAgICAqLwog\nICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RBbGxKdW5rSm91cm5hbCgp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9\nIEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAg\nICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGly\nLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0\ndXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsK\nCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxl\nKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0\nZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tp\nZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERp\ncmVjdG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgd3JpdGVKdW5rSm91cm5h\nbChCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7Cgog\nICAgICAgIFNlcnZlckNvbmZpZ3VyYXRpb24gY29uZiA9IG5ldyBTZXJ2ZXJD\nb25maWd1cmF0aW9uKCkKICAgICAgICAgICAgLnNldFprU2VydmVycyhudWxs\nKQogICAgICAgICAgICAuc2V0Sm91cm5hbERpck5hbWUoam91cm5hbERpci5n\nZXRQYXRoKCkpCiAgICAgICAgICAgIC5zZXRMZWRnZXJEaXJOYW1lcyhuZXcg\nU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0UGF0aCgpIH0pOwogICAgICAgIEJv\nb2tpZSBiID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgICBiID0g\nbmV3IEJvb2tpZShjb25mKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0\nIGhhdmUgYmVlbiBhYmxlIHRvIHN0YXJ0IHdpdGhvdXQgYWRtaW4iKTsKICAg\nICAgICB9IGNhdGNoIChUaHJvd2FibGUgdCkgewogICAgICAgICAgICAvLyBj\nb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0gZmluYWxseSB7CiAgICAgICAg\nICAgIGlmIChiICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIGIuc2h1dGRv\nd24oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIFRlc3QgdGhhdCB3ZSBjYW4gc3RhcnQgd2l0aCBhbiBlbXB0eSBq\nb3VybmFsLgogICAgICogVGhpcyBjYW4gaGFwcGVuIGlmIHRoZSBib29raWUg\nY3Jhc2hlcyBiZXR3ZWVuIGNyZWF0aW5nIHRoZQogICAgICogam91cm5hbCBh\nbmQgd3JpdGluZyB0aGUgbWFnaWMgd29yZC4gSXQgY291bGQgYWxzbyBoYXBw\nZW4gYmVmb3JlCiAgICAgKiB0aGUgbWFnaWMgd29yZCBleGlzdGVkLCBpZiB0\naGUgYm9va2llIHN0YXJ0ZWQgYnV0IG5vdGhpbmcgd2FzCiAgICAgKiBldmVy\nIHdyaXR0ZW4uCiAgICAgKi8KICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0\nZXN0RW1wdHlKb3VybmFsKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nRmlsZSBqb3VybmFsRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2ll\nIiwgImpvdXJuYWwiKTsKICAgICAgICBqb3VybmFsRGlyLmRlbGV0ZSgpOwog\nICAgICAgIGpvdXJuYWxEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hl\nY2tEaXJlY3RvcnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoam91cm5hbERpcikpOwoKICAgICAgICBGaWxlIGxlZGdlckRpciA9IEZp\nbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJsZWRnZXIiKTsKICAgICAg\nICBsZWRnZXJEaXIuZGVsZXRlKCk7CiAgICAgICAgbGVkZ2VyRGlyLm1rZGly\nKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJv\nb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpcikpOwoKICAgICAg\nICB3cml0ZVByZVYySm91cm5hbChCb29raWUuZ2V0Q3VycmVudERpcmVjdG9y\neShqb3VybmFsRGlyKSwgMCk7CgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAg\nICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5h\nbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5z\nZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0\nUGF0aCgpIH0pOwoKICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29u\nZik7CiAgICB9CgogICAgLyoqCiAgICAgKiBUZXN0IHRoYXQgYSBqb3VybmFs\nIGNhbiBsb2FkIGlmIG9ubHkgdGhlIG1hZ2ljIHdvcmQgYW5kCiAgICAgKiB2\nZXJzaW9uIGFyZSB0aGVyZS4KICAgICAqLwogICAgQFRlc3QKICAgIHB1Ymxp\nYyB2b2lkIHRlc3RIZWFkZXJPbmx5Sm91cm5hbCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVt\ncEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5hbERp\nci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAg\nICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRD\ndXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBs\nZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVk\nZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxl\nZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9y\neVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJE\naXIpKTsKCiAgICAgICAgd3JpdGVQb3N0VjJKb3VybmFsKEJvb2tpZS5nZXRD\ndXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAwKTsKCiAgICAgICAgU2Vy\ndmVyQ29uZmlndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRp\nb24oKQogICAgICAgICAgICAuc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAg\nICAgIC5zZXRKb3VybmFsRGlyTmFtZShqb3VybmFsRGlyLmdldFBhdGgoKSkK\nICAgICAgICAgICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7\nIGxlZGdlckRpci5nZXRQYXRoKCkgfSk7CgogICAgICAgIEJvb2tpZSBiID0g\nbmV3IEJvb2tpZShjb25mKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3Qg\ndGhhdCBpZiBhIGpvdXJuYWwgaGFzIGp1bmsgYXQgdGhlIGVuZCwgaXQgZG9l\ncyBub3QgbG9hZC4KICAgICAqIElmIHRoZSBqb3VybmFsIGlzIGNvcnJ1cHQg\nbGlrZSB0aGlzLCBhZG1pbiBpbnRlcnZlbnRpb24gaXMgbmVlZGVkCiAgICAg\nKi8KICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0SnVua0VuZGVkSm91\ncm5hbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEZpbGUgam91cm5h\nbERpciA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFs\nIik7CiAgICAgICAgam91cm5hbERpci5kZWxldGUoKTsKICAgICAgICBqb3Vy\nbmFsRGlyLm1rZGlyKCk7CiAgICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5\nU3RydWN0dXJlKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxE\naXIpKTsKCiAgICAgICAgRmlsZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAibGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGly\nLmRlbGV0ZSgpOwogICAgICAgIGxlZGdlckRpci5ta2RpcigpOwogICAgICAg\nIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3Vy\ncmVudERpcmVjdG9yeShsZWRnZXJEaXIpKTsKCiAgICAgICAgSm91cm5hbENo\nYW5uZWwgamMgPSB3cml0ZVBvc3RWMkpvdXJuYWwoQm9va2llLmdldEN1cnJl\nbnREaXJlY3Rvcnkoam91cm5hbERpciksIDApOwogICAgICAgIGpjLmdldEJ1\nZmZlcmVkQ2hhbm5lbCgpLndyaXRlKEJ5dGVCdWZmZXIud3JhcCgiSnVua0p1\nbmtKdW5rIi5nZXRCeXRlcygpKSk7CiAgICAgICAgamMuZ2V0QnVmZmVyZWRD\naGFubmVsKCkuZmx1c2godHJ1ZSk7CgogICAgICAgIHdyaXRlSW5kZXhGaWxl\nRm9yTGVkZ2VyKGxlZGdlckRpciwgMSwgInRlc3RQYXNzd2QiLmdldEJ5dGVz\nKCkpOwoKICAgICAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYgPSBuZXcg\nU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAgICAgICAgIC5zZXRaa1NlcnZl\ncnMobnVsbCkKICAgICAgICAgICAgLnNldEpvdXJuYWxEaXJOYW1lKGpvdXJu\nYWxEaXIuZ2V0UGF0aCgpKQogICAgICAgICAgICAuc2V0TGVkZ2VyRGlyTmFt\nZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGlyLmdldFBhdGgoKSB9KTsKCiAg\nICAgICAgQm9va2llIGIgPSBudWxsOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIGIgPSBuZXcgQm9va2llKGNvbmYpOwogICAgICAgIH0gY2F0Y2ggKFRo\ncm93YWJsZSB0KSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3Vy\nCiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogVGVzdCB0aGF0IGlm\nIHRoZSBib29raWUgY3Jhc2hlcyB3aGlsZSB3cml0aW5nIHRoZSBsZW5ndGgK\nICAgICAqIG9mIGFuIGVudHJ5LCB0aGF0IHdlIGNhbiByZWNvdmVyLgogICAg\nICoKICAgICAqIFRoaXMgaXMgY3VycmVudGx5IG5vdCB0aGUgY2FzZSwgd2hp\nY2ggaXMgYmFkIGFzIHJlY292ZXJ5CiAgICAgKiBzaG91bGQgYmUgZmluZSBo\nZXJlLiBUaGUgYm9va2llIGhhcyBjcmFzaGVkIHdoaWxlIHdyaXRpbmcKICAg\nICAqIGJ1dCBzbyB0aGUgY2xpZW50IGhhcyBub3QgYmUgbm90aWZpZWQgb2Yg\nc3VjY2Vzcy4KICAgICAqLwogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRl\nc3RUcnVuY2F0ZWRJbkxlbkpvdXJuYWwoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxl\nKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxEaXIuZGVs\nZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAgICAgIEJv\nb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVu\ndERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUgbGVkZ2Vy\nRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxlZGdlciIp\nOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBsZWRnZXJE\naXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3RvcnlTdHJ1\nY3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGlyKSk7\nCgogICAgICAgIEpvdXJuYWxDaGFubmVsIGpjID0gd3JpdGVQb3N0VjJKb3Vy\nbmFsKAogICAgICAgICAgICAgICAgQm9va2llLmdldEN1cnJlbnREaXJlY3Rv\ncnkoam91cm5hbERpciksIDEwMCk7CiAgICAgICAgQnl0ZUJ1ZmZlciB6ZXJv\ncyA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoMjA0OCk7CgogICAgICAgIGpjLmZj\nLnBvc2l0aW9uKGpjLmdldEJ1ZmZlcmVkQ2hhbm5lbCgpLnBvc2l0aW9uKCkg\nLSAweDQyOSk7CiAgICAgICAgamMuZmMud3JpdGUoemVyb3MpOwogICAgICAg\nIGpjLmZjLmZvcmNlKGZhbHNlKTsKCiAgICAgICAgd3JpdGVJbmRleEZpbGVG\nb3JMZWRnZXIoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2VyRGly\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxLCAidGVzdFBh\nc3N3ZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFNlcnZlckNvbmZpZ3VyYXRp\nb24gY29uZiA9IG5ldyBTZXJ2ZXJDb25maWd1cmF0aW9uKCkKICAgICAgICAg\nICAgLnNldFprU2VydmVycyhudWxsKQogICAgICAgICAgICAuc2V0Sm91cm5h\nbERpck5hbWUoam91cm5hbERpci5nZXRQYXRoKCkpCiAgICAgICAgICAgIC5z\nZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIuZ2V0\nUGF0aCgpIH0pOwoKICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29u\nZik7CgogICAgICAgIGIucmVhZEVudHJ5KDEsIDk5KTsKCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYi5yZWFkRW50cnkoMSwgMTAwKTsKICAgICAgICAg\nICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgZm91bmQgZW50cnkgMTAwIik7CiAg\nICAgICAgfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFRlc3QgdGhhdCBpZiB0aGUgYm9va2llIGNy\nYXNoZXMgaW4gdGhlIG1pZGRsZSBvZiB3cml0aW5nCiAgICAgKiB0aGUgYWN0\ndWFsIGVudHJ5IGl0IGNhbiByZWNvdmVyLgogICAgICogSW4gdGhpcyBjYXNl\nIHRoZSBlbnRyeSB3aWxsIGJlIGF2YWlsYWJsZSwgYnV0IGl0IHdpbGwgY29y\ncnVwdC4KICAgICAqIFRoaXMgaXMgb2ssIGFzIHRoZSBjbGllbnQgd2lsbCBk\naXNyZWdhcmQgdGhlIGVudHJ5IGFmdGVyIGxvb2tpbmcKICAgICAqIGF0IGl0\ncyBjaGVja3N1bS4KICAgICAqLwogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lk\nIHRlc3RUcnVuY2F0ZWRJbkVudHJ5Sm91cm5hbCgpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRlVGVt\ncEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5hbERp\nci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAgICAg\nICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5nZXRD\ndXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgRmlsZSBs\nZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAibGVk\nZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAgIGxl\nZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVjdG9y\neVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRnZXJE\naXIpKTsKCiAgICAgICAgSm91cm5hbENoYW5uZWwgamMgPSB3cml0ZVBvc3RW\nMkpvdXJuYWwoCiAgICAgICAgICAgICAgICBCb29raWUuZ2V0Q3VycmVudERp\ncmVjdG9yeShqb3VybmFsRGlyKSwgMTAwKTsKICAgICAgICBCeXRlQnVmZmVy\nIHplcm9zID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSgyMDQ4KTsKCiAgICAgICAg\namMuZmMucG9zaXRpb24oamMuZ2V0QnVmZmVyZWRDaGFubmVsKCkucG9zaXRp\nb24oKSAtIDB4MzAwKTsKICAgICAgICBqYy5mYy53cml0ZSh6ZXJvcyk7CiAg\nICAgICAgamMuZmMuZm9yY2UoZmFsc2UpOwoKICAgICAgICB3cml0ZUluZGV4\nRmlsZUZvckxlZGdlcihCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShsZWRn\nZXJEaXIpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDEsICJ0\nZXN0UGFzc3dkIi5nZXRCeXRlcygpKTsKCiAgICAgICAgU2VydmVyQ29uZmln\ndXJhdGlvbiBjb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKQogICAg\nICAgICAgICAuc2V0WmtTZXJ2ZXJzKG51bGwpCiAgICAgICAgICAgIC5zZXRK\nb3VybmFsRGlyTmFtZShqb3VybmFsRGlyLmdldFBhdGgoKSkKICAgICAgICAg\nICAgLnNldExlZGdlckRpck5hbWVzKG5ldyBTdHJpbmdbXSB7IGxlZGdlckRp\nci5nZXRQYXRoKCkgfSk7CgogICAgICAgIEJvb2tpZSBiID0gbmV3IEJvb2tp\nZShjb25mKTsKICAgICAgICBiLnJlYWRFbnRyeSgxLCA5OSk7CgogICAgICAg\nIC8vIHN0aWxsIGFibGUgdG8gcmVhZCBsYXN0IGVudHJ5LCBidXQgaXQncyBq\ndW5rCiAgICAgICAgQnl0ZUJ1ZmZlciBidWYgPSBiLnJlYWRFbnRyeSgxLCAx\nMDApOwogICAgICAgIGFzc2VydEVxdWFscygiTGVkZ2VyIElkIGlzIHdyb25n\nIiwgYnVmLmdldExvbmcoKSwgMSk7CiAgICAgICAgYXNzZXJ0RXF1YWxzKCJF\nbnRyeSBJZCBpcyB3cm9uZyIsIGJ1Zi5nZXRMb25nKCksIDEwMCk7CiAgICAg\nICAgYXNzZXJ0RXF1YWxzKCJMYXN0IGNvbmZpcm1lZCBpcyB3cm9uZyIsIGJ1\nZi5nZXRMb25nKCksIDk5KTsKICAgICAgICBhc3NlcnRFcXVhbHMoIkxlbmd0\naCBpcyB3cm9uZyIsIGJ1Zi5nZXRMb25nKCksIDEwMCoxMDI0KTsKICAgICAg\nICBidWYuZ2V0TG9uZygpOyAvLyBza2lwIGNoZWNrc3VtCiAgICAgICAgYm9v\nbGVhbiBhbGxYID0gdHJ1ZTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIDEwMjQ7IGkrKykgewogICAgICAgICAgICBieXRlIHggPSBidWYuZ2V0KCk7\nCiAgICAgICAgICAgIGFsbFggPSBhbGxYICYmIHggPT0gKGJ5dGUpJ1gnOwog\nICAgICAgIH0KICAgICAgICBhc3NlcnRGYWxzZSgiU29tZSBvZiBidWZmZXIg\nc2hvdWxkIGhhdmUgYmVlbiB6ZXJvZWQiLCBhbGxYKTsKCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgYi5yZWFkRW50cnkoMSwgMTAxKTsKICAgICAgICAg\nICAgZmFpbCgiU2hvdWxkbid0IGhhdmUgZm91bmQgZW50cnkgMTAxIik7CiAg\nICAgICAgfSBjYXRjaCAoQm9va2llLk5vRW50cnlFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICAvLyBjb3JyZWN0IGJlaGF2aW91cgogICAgICAgIH0KICAg\nIH0KCiAgICAvKioKICAgICAqIFRlc3QgcGFydGlhbCBpbmRleCAodHJ1bmNh\ndGUgbWFzdGVyIGtleSkgd2l0aCBwcmUtdjMgam91cm5hbHMKICAgICAqLwog\nICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RQYXJ0aWFsRmlsZUluZm9Q\ncmVWM0pvdXJuYWwxKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgdGVz\ndFBhcnRpYWxGaWxlSW5mb1ByZVYzSm91cm5hbCh0cnVlKTsKICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgcGFydGlhbCBpbmRleCB3aXRoIHByZS12MyBq\nb3VybmFscwogICAgICovCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVz\ndFBhcnRpYWxGaWxlSW5mb1ByZVYzSm91cm5hbDIoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICB0ZXN0UGFydGlhbEZpbGVJbmZvUHJlVjNKb3VybmFs\nKGZhbHNlKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgcGFydGlhbCBp\nbmRleCBmaWxlIHdpdGggcHJlLXYzIGpvdXJuYWxzLgogICAgICovCiAgICBw\ncml2YXRlIHZvaWQgdGVzdFBhcnRpYWxGaWxlSW5mb1ByZVYzSm91cm5hbChi\nb29sZWFuIHRydW5jYXRlTWFzdGVyS2V5KQogICAgICAgIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIEZpbGUgam91cm5hbERpciA9IEZpbGUuY3JlYXRl\nVGVtcEZpbGUoImJvb2tpZSIsICJqb3VybmFsIik7CiAgICAgICAgam91cm5h\nbERpci5kZWxldGUoKTsKICAgICAgICBqb3VybmFsRGlyLm1rZGlyKCk7CiAg\nICAgICAgQm9va2llLmNoZWNrRGlyZWN0b3J5U3RydWN0dXJlKEJvb2tpZS5n\nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpKTsKCiAgICAgICAgRmls\nZSBsZWRnZXJEaXIgPSBGaWxlLmNyZWF0ZVRlbXBGaWxlKCJib29raWUiLCAi\nbGVkZ2VyIik7CiAgICAgICAgbGVkZ2VyRGlyLmRlbGV0ZSgpOwogICAgICAg\nIGxlZGdlckRpci5ta2RpcigpOwogICAgICAgIEJvb2tpZS5jaGVja0RpcmVj\ndG9yeVN0cnVjdHVyZShCb29raWUuZ2V0Q3VycmVudERpcmVjdG9yeShqb3Vy\nbmFsRGlyKSk7CgogICAgICAgIHdyaXRlUHJlVjJKb3VybmFsKEJvb2tpZS5n\nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAxMDApOwogICAgICAg\nIHdyaXRlUGFydGlhbEluZGV4RmlsZUZvckxlZGdlcihCb29raWUuZ2V0Q3Vy\ncmVudERpcmVjdG9yeShsZWRnZXJEaXIpLAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAxLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMo\nKSwgdHJ1bmNhdGVNYXN0ZXJLZXkpOwoKICAgICAgICBTZXJ2ZXJDb25maWd1\ncmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAgICAg\nICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkKICAgICAgICAgICAgLnNldEpv\ndXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQogICAgICAgICAg\nICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2VyRGly\nLmdldFBhdGgoKSB9KTsKCiAgICAgICAgaWYgKHRydW5jYXRlTWFzdGVyS2V5\nKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBCb29raWUg\nYiA9IG5ldyBCb29raWUoY29uZik7CiAgICAgICAgICAgICAgICBmYWlsKCJT\naG91bGQgbm90IHJlYWNoIGhlcmUhIik7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKElPRXhjZXB0aW9uIGllKSB7CiAgICAgICAgICAgIH0KICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICBCb29raWUgYiA9IG5ldyBCb29raWUoY29uZik7\nCgogICAgICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAgICAgICAg\nICB0cnkgewogICAgICAgICAgICAgICAgYi5yZWFkRW50cnkoMSwgMTAxKTsK\nICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVu\ndHJ5IDEwMSIpOwogICAgICAgICAgICB9IGNhdGNoIChCb29raWUuTm9FbnRy\neUV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAvLyBjb3JyZWN0IGJl\naGF2aW91cgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4ICh0cnVuY2F0ZSBtYXN0ZXIg\na2V5KSB3aXRoIHBvc3QtdjMgam91cm5hbHMKICAgICAqLwogICAgQFRlc3QK\nICAgIHB1YmxpYyB2b2lkIHRlc3RQYXJ0aWFsRmlsZUluZm9Qb3N0VjNKb3Vy\nbmFsMSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHRlc3RQYXJ0aWFs\nRmlsZUluZm9Qb3N0VjNKb3VybmFsKHRydWUpOwogICAgfQoKICAgIC8qKgog\nICAgICogVGVzdCBwYXJ0aWFsIGluZGV4IHdpdGggcG9zdC12MyBqb3VybmFs\ncwogICAgICovCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFBhcnRp\nYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgdGVzdFBhcnRpYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwoZmFs\nc2UpOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCBwYXJ0aWFsIGluZGV4\nIGZpbGUgd2l0aCBwb3N0LXYzIGpvdXJuYWxzLgogICAgICovCiAgICBwcml2\nYXRlIHZvaWQgdGVzdFBhcnRpYWxGaWxlSW5mb1Bvc3RWM0pvdXJuYWwoYm9v\nbGVhbiB0cnVuY2F0ZU1hc3RlcktleSkKICAgICAgICB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBGaWxlIGpvdXJuYWxEaXIgPSBGaWxlLmNyZWF0ZVRl\nbXBGaWxlKCJib29raWUiLCAiam91cm5hbCIpOwogICAgICAgIGpvdXJuYWxE\naXIuZGVsZXRlKCk7CiAgICAgICAgam91cm5hbERpci5ta2RpcigpOwogICAg\nICAgIEJvb2tpZS5jaGVja0RpcmVjdG9yeVN0cnVjdHVyZShCb29raWUuZ2V0\nQ3VycmVudERpcmVjdG9yeShqb3VybmFsRGlyKSk7CgogICAgICAgIEZpbGUg\nbGVkZ2VyRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgiYm9va2llIiwgImxl\nZGdlciIpOwogICAgICAgIGxlZGdlckRpci5kZWxldGUoKTsKICAgICAgICBs\nZWRnZXJEaXIubWtkaXIoKTsKICAgICAgICBCb29raWUuY2hlY2tEaXJlY3Rv\ncnlTdHJ1Y3R1cmUoQm9va2llLmdldEN1cnJlbnREaXJlY3RvcnkobGVkZ2Vy\nRGlyKSk7CgogICAgICAgIGJ5dGVbXSBtYXN0ZXJLZXkgPSAidGVzdFBhc3N3\nZCIuZ2V0Qnl0ZXMoKTsKCiAgICAgICAgd3JpdGVQb3N0VjNKb3VybmFsKEJv\nb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGpvdXJuYWxEaXIpLCAxMDAsIG1h\nc3RlcktleSk7CiAgICAgICAgd3JpdGVQYXJ0aWFsSW5kZXhGaWxlRm9yTGVk\nZ2VyKEJvb2tpZS5nZXRDdXJyZW50RGlyZWN0b3J5KGxlZGdlckRpciksIDEs\nIG1hc3RlcktleSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgdHJ1bmNhdGVNYXN0ZXJLZXkpOwoKICAgICAgICBTZXJ2ZXJDb25m\naWd1cmF0aW9uIGNvbmYgPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpCiAg\nICAgICAgICAgIC5zZXRaa1NlcnZlcnMobnVsbCkKICAgICAgICAgICAgLnNl\ndEpvdXJuYWxEaXJOYW1lKGpvdXJuYWxEaXIuZ2V0UGF0aCgpKQogICAgICAg\nICAgICAuc2V0TGVkZ2VyRGlyTmFtZXMobmV3IFN0cmluZ1tdIHsgbGVkZ2Vy\nRGlyLmdldFBhdGgoKSB9KTsKCiAgICAgICAgQm9va2llIGIgPSBuZXcgQm9v\na2llKGNvbmYpOwoKICAgICAgICBiLnJlYWRFbnRyeSgxLCAxMDApOwogICAg\nICAgIHRyeSB7CiAgICAgICAgICAgIGIucmVhZEVudHJ5KDEsIDEwMSk7CiAg\nICAgICAgICAgIGZhaWwoIlNob3VsZG4ndCBoYXZlIGZvdW5kIGVudHJ5IDEw\nMSIpOwogICAgICAgIH0gY2F0Y2ggKEJvb2tpZS5Ob0VudHJ5RXhjZXB0aW9u\nIGUpIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAg\nICB9CiAgICB9Cn0K\n","encoding":"base64"}

