{"sha":"8bd3f6b94aa7e4f1ac40001e538e68e7571023b0","node_id":"MDQ6QmxvYjE1NzU5NTY6OGJkM2Y2Yjk0YWE3ZTRmMWFjNDAwMDFlNTM4ZTY4ZTc1NzEwMjNiMA==","size":28877,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/8bd3f6b94aa7e4f1ac40001e538e68e7571023b0","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgamF2YS5pby5GaWxlOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlv\nbjsKaW1wb3J0IGphdmEubmV0LkluZXRBZGRyZXNzOwppbXBvcnQgamF2YS5u\nZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwuQXJyYXlM\naXN0OwppbXBvcnQgamF2YS51dGlsLkVudW1lcmF0aW9uOwppbXBvcnQgamF2\nYS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuTWFwOwppbXBvcnQgamF2\nYS51dGlsLkhhc2hTZXQ7CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1w\nb3J0IGphdmEudXRpbC5Db2xsZWN0aW9uczsKaW1wb3J0IGphdmEudXRpbC5S\nYW5kb207CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRv\nbWljSW50ZWdlcjsKCmltcG9ydCBvcmcuamJvc3MubmV0dHkuYnVmZmVyLkNo\nYW5uZWxCdWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljTG9uZzsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNv\ndW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGlt\nZVVuaXQ7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdC5CYXNl\nVGVzdENhc2U7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5D\nbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQktFeGNl\ncHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50Lkxl\nZGdlckVudHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVu\ndC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\ncHJvdG8uQm9va2llUHJvdG9jb2w7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIucHJvdG8uQm9va2tlZXBlckludGVybmFsQ2FsbGJhY2tzLlJlYWRF\nbnRyeUNhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNs\naWVudC5Bc3luY0NhbGxiYWNrLlJlY292ZXJDYWxsYmFjazsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RU\neXBlOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLnByb3RvLkJvb2tp\nZVNlcnZlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQm9va0tlZXBlckFkbWluOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmJvb2tpZS5Cb29raWVFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLnpv\nb2tlZXBlci5kYXRhLlN0YXQ7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwpp\nbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb24uQ29kZTsKaW1wb3J0IG9y\nZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9y\ndCBvcmcuanVuaXQuVGVzdDsKCi8qKgogKiBUaGlzIGNsYXNzIHRlc3RzIHRo\nZSBib29raWUgcmVjb3ZlcnkgYWRtaW4gZnVuY3Rpb25hbGl0eS4KICovCnB1\nYmxpYyBjbGFzcyBCb29raWVSZWNvdmVyeVRlc3QgZXh0ZW5kcyBCYXNlVGVz\ndENhc2UgewogICAgc3RhdGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5\nLmdldExvZ2dlcihCb29raWVSZWNvdmVyeVRlc3QuY2xhc3MpOwoKICAgIC8v\nIE9iamVjdCB1c2VkIGZvciBzeW5jaHJvbml6aW5nIGFzeW5jIG1ldGhvZCBj\nYWxscwogICAgY2xhc3MgU3luY09iamVjdCB7CiAgICAgICAgYm9vbGVhbiB2\nYWx1ZTsKCiAgICAgICAgcHVibGljIFN5bmNPYmplY3QoKSB7CiAgICAgICAg\nICAgIHZhbHVlID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIC8vIE9i\namVjdCB1c2VkIGZvciBpbXBsZW1lbnRpbmcgdGhlIEJvb2tpZSBSZWNvdmVy\nQ2FsbGJhY2sgZm9yIHRoaXMgalVuaXQKICAgIC8vIHRlc3QuIFRoaXMgdmVy\naWZpZXMgdGhhdCB0aGUgb3BlcmF0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVs\nbHkuCiAgICBjbGFzcyBCb29raWVSZWNvdmVyQ2FsbGJhY2sgaW1wbGVtZW50\ncyBSZWNvdmVyQ2FsbGJhY2sgewogICAgICAgIGJvb2xlYW4gc3VjY2VzcyA9\nIGZhbHNlOwogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lk\nIHJlY292ZXJDb21wbGV0ZShpbnQgcmMsIE9iamVjdCBjdHgpIHsKICAgICAg\nICAgICAgTE9HLmluZm8oIlJlY292ZXJlZCBib29raWUgb3BlcmF0aW9uIGNv\nbXBsZXRlZCB3aXRoIHJjOiAiICsgcmMpOwogICAgICAgICAgICBzdWNjZXNz\nID0gcmMgPT0gQ29kZS5PSy5pbnRWYWx1ZSgpOwogICAgICAgICAgICBTeW5j\nT2JqZWN0IHN5bmMgPSAoU3luY09iamVjdCkgY3R4OwogICAgICAgICAgICBz\neW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAgIHN5bmMudmFs\ndWUgPSB0cnVlOwogICAgICAgICAgICAgICAgc3luYy5ub3RpZnkoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAvLyBPYmplY3RzIHRv\nIHVzZSBmb3IgdGhpcyBqVW5pdCB0ZXN0LgogICAgRGlnZXN0VHlwZSBkaWdl\nc3RUeXBlOwogICAgU3luY09iamVjdCBzeW5jOwogICAgQm9va2llUmVjb3Zl\nckNhbGxiYWNrIGJvb2tpZVJlY292ZXJDYjsKICAgIEJvb2tLZWVwZXJBZG1p\nbiBia0FkbWluOwoKICAgIC8vIENvbnN0cnVjdG9yCiAgICBwdWJsaWMgQm9v\na2llUmVjb3ZlcnlUZXN0KERpZ2VzdFR5cGUgZGlnZXN0VHlwZSkgewogICAg\nICAgIHN1cGVyKDMpOwogICAgICAgIHRoaXMuZGlnZXN0VHlwZSA9IGRpZ2Vz\ndFR5cGU7CiAgICB9CgogICAgQEJlZm9yZQogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAg\nIC8vIFNldCB1cCB0aGUgY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzIG5lZWRl\nZC4KICAgICAgICBiYXNlQ2xpZW50Q29uZi5zZXRCb29raWVSZWNvdmVyeURp\nZ2VzdFR5cGUoZGlnZXN0VHlwZSk7CiAgICAgICAgYmFzZUNsaWVudENvbmYu\nc2V0Qm9va2llUmVjb3ZlcnlQYXNzd2QoIiIuZ2V0Qnl0ZXMoKSk7CiAgICAg\nICAgc3VwZXIuc2V0VXAoKTsKCiAgICAgICAgc3luYyA9IG5ldyBTeW5jT2Jq\nZWN0KCk7CiAgICAgICAgYm9va2llUmVjb3ZlckNiID0gbmV3IEJvb2tpZVJl\nY292ZXJDYWxsYmFjaygpOwogICAgICAgIENsaWVudENvbmZpZ3VyYXRpb24g\nYWRtaW5Db25mID0gbmV3IENsaWVudENvbmZpZ3VyYXRpb24oYmFzZUNsaWVu\ndENvbmYpOwogICAgICAgIGFkbWluQ29uZi5zZXRaa1NlcnZlcnMoemtVdGls\nLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CiAgICAgICAgYmtBZG1p\nbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oYWRtaW5Db25mKTsKICAgIH0KCiAg\nICBAQWZ0ZXIKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdGVhckRv\nd24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBSZWxlYXNlIGFu\neSByZXNvdXJjZXMgdXNlZCBieSB0aGUgQm9va0tlZXBlclRvb2xzIGluc3Rh\nbmNlLgogICAgICAgIGJrQWRtaW4uY2xvc2UoKTsKICAgICAgICBzdXBlci50\nZWFyRG93bigpOwogICAgfQoKICAgIC8qKgogICAgICogSGVscGVyIG1ldGhv\nZCB0byBjcmVhdGUgYSBudW1iZXIgb2YgbGVkZ2VycwogICAgICoKICAgICAq\nIEBwYXJhbSBudW1MZWRnZXJzCiAgICAgKiAgICAgICAgICAgIE51bWJlciBv\nZiBsZWRnZXJzIHRvIGNyZWF0ZQogICAgICogQHJldHVybiBMaXN0IG9mIExl\nZGdlckhhbmRsZXMgZm9yIGVhY2ggb2YgdGhlIGxlZGdlcnMgY3JlYXRlZAog\nICAgICovCiAgICBwcml2YXRlIExpc3Q8TGVkZ2VySGFuZGxlPiBjcmVhdGVM\nZWRnZXJzKGludCBudW1MZWRnZXJzKSAKICAgICAgICAgICAgdGhyb3dzIEJL\nRXhjZXB0aW9uLCBLZWVwZXJFeGNlcHRpb24sIElPRXhjZXB0aW9uLCBJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiAKICAgIHsKICAgICAgICByZXR1cm4gY3JlYXRl\nTGVkZ2VycyhudW1MZWRnZXJzLCAzLCAyKTsKICAgIH0KCiAgICAvKioKICAg\nICAqIEhlbHBlciBtZXRob2QgdG8gY3JlYXRlIGEgbnVtYmVyIG9mIGxlZGdl\ncnMKICAgICAqCiAgICAgKiBAcGFyYW0gbnVtTGVkZ2VycwogICAgICogICAg\nICAgICAgICBOdW1iZXIgb2YgbGVkZ2VycyB0byBjcmVhdGUKICAgICAqIEBw\nYXJhbSBlbnNlbWJsZSBFbnNlbWJsZSBzaXplIGZvciBsZWRnZXJzCiAgICAg\nKiBAcGFyYW0gcXVvcnVtIFF1b3J1bSBzaXplIGZvciBsZWRnZXJzCiAgICAg\nKiBAcmV0dXJuIExpc3Qgb2YgTGVkZ2VySGFuZGxlcyBmb3IgZWFjaCBvZiB0\naGUgbGVkZ2VycyBjcmVhdGVkCiAgICAgKi8KICAgIHByaXZhdGUgTGlzdDxM\nZWRnZXJIYW5kbGU+IGNyZWF0ZUxlZGdlcnMoaW50IG51bUxlZGdlcnMsIGlu\ndCBlbnNlbWJsZSwgaW50IHF1b3J1bSkgCiAgICAgICAgICAgIHRocm93cyBC\nS0V4Y2VwdGlvbiwgS2VlcGVyRXhjZXB0aW9uLCBJT0V4Y2VwdGlvbiwKICAg\nICAgICBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgTGlzdDxMZWRn\nZXJIYW5kbGU+IGxocyA9IG5ldyBBcnJheUxpc3Q8TGVkZ2VySGFuZGxlPigp\nOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtTGVkZ2VyczsgaSsr\nKSB7CiAgICAgICAgICAgIGxocy5hZGQoYmtjLmNyZWF0ZUxlZGdlcihlbnNl\nbWJsZSwgcXVvcnVtLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGRpZ2VzdFR5cGUsIGJhc2VDbGllbnRDb25mLmdldEJvb2tpZVJl\nY292ZXJ5UGFzc3dkKCkpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGxo\nczsKICAgIH0KCiAgICBwcml2YXRlIExpc3Q8TGVkZ2VySGFuZGxlPiBvcGVu\nTGVkZ2VycyhMaXN0PExlZGdlckhhbmRsZT4gb2xkTGhzKQogICAgICAgICAg\nICB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBMaXN0PExlZGdlckhhbmRs\nZT4gbmV3TGhzID0gbmV3IEFycmF5TGlzdDxMZWRnZXJIYW5kbGU+KCk7CiAg\nICAgICAgZm9yIChMZWRnZXJIYW5kbGUgb2xkTGggOiBvbGRMaHMpIHsKICAg\nICAgICAgICAgbmV3TGhzLmFkZChia2Mub3BlbkxlZGdlcihvbGRMaC5nZXRJ\nZCgpLCBkaWdlc3RUeXBlLCBiYXNlQ2xpZW50Q29uZi5nZXRCb29raWVSZWNv\ndmVyeVBhc3N3ZCgpKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXdM\naHM7CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIHdy\naXRlIGR1bW15IGxlZGdlciBlbnRyaWVzIHRvIGFsbCBvZiB0aGUgbGVkZ2Vy\ncyBwYXNzZWQuCiAgICAgKgogICAgICogQHBhcmFtIG51bUVudHJpZXMKICAg\nICAqICAgICAgICAgICAgTnVtYmVyIG9mIGxlZGdlciBlbnRyaWVzIHRvIHdy\naXRlIGZvciBlYWNoIGxlZGdlcgogICAgICogQHBhcmFtIHN0YXJ0RW50cnlJ\nZAogICAgICogICAgICAgICAgICBUaGUgZmlyc3QgZW50cnkgSWQgd2UncmUg\nZXhwZWN0aW5nIHRvIHdyaXRlIGZvciBlYWNoIGxlZGdlcgogICAgICogQHBh\ncmFtIGxocwogICAgICogICAgICAgICAgICBMaXN0IG9mIExlZGdlckhhbmRs\nZXMgZm9yIGFsbCBsZWRnZXJzIHRvIHdyaXRlIGVudHJpZXMgdG8KICAgICAq\nIEB0aHJvd3MgQktFeGNlcHRpb24KICAgICAqIEB0aHJvd3MgSW50ZXJydXB0\nZWRFeGNlcHRpb24KICAgICAqLwogICAgcHJpdmF0ZSB2b2lkIHdyaXRlRW50\ncmllc3RvTGVkZ2VycyhpbnQgbnVtRW50cmllcywgbG9uZyBzdGFydEVudHJ5\nSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExp\nc3Q8TGVkZ2VySGFuZGxlPiBsaHMpCiAgICAgICAgdGhyb3dzIEJLRXhjZXB0\naW9uLCBJbnRlcnJ1cHRlZEV4Y2VwdGlvbiB7CiAgICAgICAgZm9yIChMZWRn\nZXJIYW5kbGUgbGggOiBsaHMpIHsKICAgICAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgICAgIGxo\nLmFkZEVudHJ5KCgiTGVkZ2VySWQ6ICIgKyBsaC5nZXRJZCgpICsgIiwgRW50\ncnlJZDogIiArIChzdGFydEVudHJ5SWQgKyBpKSkuZ2V0Qnl0ZXMoKSk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSB2b2lk\nIGNsb3NlTGVkZ2VycyhMaXN0PExlZGdlckhhbmRsZT4gbGhzKSB0aHJvd3Mg\nQktFeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBm\nb3IgKExlZGdlckhhbmRsZSBsaCA6IGxocykgewogICAgICAgICAgICBsaC5j\nbG9zZSgpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEhlbHBl\nciBtZXRob2QgdG8gdmVyaWZ5IHRoYXQgd2UgY2FuIHJlYWQgdGhlIHJlY292\nZXJlZCBsZWRnZXIgZW50cmllcy4KICAgICAqCiAgICAgKiBAcGFyYW0gb2xk\nTGhzCiAgICAgKiAgICAgICAgICAgIE9sZCBMZWRnZXIgSGFuZGxlcwogICAg\nICogQHBhcmFtIHN0YXJ0RW50cnlJZAogICAgICogICAgICAgICAgICBTdGFy\ndCBFbnRyeSBJZCB0byByZWFkCiAgICAgKiBAcGFyYW0gZW5kRW50cnlJZAog\nICAgICogICAgICAgICAgICBFbmQgRW50cnkgSWQgdG8gcmVhZAogICAgICog\nQHRocm93cyBCS0V4Y2VwdGlvbgogICAgICogQHRocm93cyBJbnRlcnJ1cHRl\nZEV4Y2VwdGlvbgogICAgICovCiAgICBwcml2YXRlIHZvaWQgdmVyaWZ5UmVj\nb3ZlcmVkTGVkZ2VycyhMaXN0PExlZGdlckhhbmRsZT4gb2xkTGhzLCBsb25n\nIHN0YXJ0RW50cnlJZCwgbG9uZyBlbmRFbnRyeUlkKSB0aHJvd3MgQktFeGNl\ncHRpb24sCiAgICAgICAgSW50ZXJydXB0ZWRFeGNlcHRpb24gewogICAgICAg\nIC8vIEdldCBhIHNldCBvZiBMZWRnZXJIYW5kbGVzIGZvciBhbGwgb2YgdGhl\nIGxlZGdlcnMgdG8gdmVyaWZ5CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+\nIGxocyA9IG5ldyBBcnJheUxpc3Q8TGVkZ2VySGFuZGxlPigpOwogICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgb2xkTGhzLnNpemUoKTsgaSsrKSB7CiAg\nICAgICAgICAgIGxocy5hZGQoYmtjLm9wZW5MZWRnZXIob2xkTGhzLmdldChp\nKS5nZXRJZCgpLCBkaWdlc3RUeXBlLCBiYXNlQ2xpZW50Q29uZi5nZXRCb29r\naWVSZWNvdmVyeVBhc3N3ZCgpKSk7CiAgICAgICAgfQogICAgICAgIC8vIFJl\nYWQgdGhlIGxlZGdlciBlbnRyaWVzIHRvIHZlcmlmeSB0aGF0IHRoZXkgYXJl\nIGFsbCBwcmVzZW50IGFuZAogICAgICAgIC8vIGNvcnJlY3QgaW4gdGhlIG5l\ndyBib29raWUuCiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBsaHMp\nIHsKICAgICAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IGVudHJp\nZXMgPSBsaC5yZWFkRW50cmllcyhzdGFydEVudHJ5SWQsIGVuZEVudHJ5SWQp\nOwogICAgICAgICAgICB3aGlsZSAoZW50cmllcy5oYXNNb3JlRWxlbWVudHMo\nKSkgewogICAgICAgICAgICAgICAgTGVkZ2VyRW50cnkgZW50cnkgPSBlbnRy\naWVzLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICBhc3NlcnRUcnVl\nKG5ldyBTdHJpbmcoZW50cnkuZ2V0RW50cnkoKSkuZXF1YWxzKCJMZWRnZXJJ\nZDogIiArIGVudHJ5LmdldExlZGdlcklkKCkgKyAiLCBFbnRyeUlkOiAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICsgZW50cnkuZ2V0RW50cnlJZCgp\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgfQoKICAgIC8qKgog\nICAgICogVGhpcyB0ZXN0cyB0aGUgYXN5bmNocm9ub3VzIGJvb2tpZSByZWNv\ndmVyeSBmdW5jdGlvbmFsaXR5IGJ5IHdyaXRpbmcKICAgICAqIGVudHJpZXMg\naW50byAzIGJvb2tpZXMsIGtpbGxpbmcgb25lIGJvb2tpZSwgc3RhcnRpbmcg\ndXAgYSBuZXcgb25lIHRvCiAgICAgKiByZXBsYWNlIGl0LCBhbmQgdGhlbiBy\nZWNvdmVyaW5nIHRoZSBsZWRnZXIgZW50cmllcyBmcm9tIHRoZSBraWxsZWQg\nYm9va2llCiAgICAgKiBvbnRvIHRoZSBuZXcgb25lLiBXZSdsbCB2ZXJpZnkg\ndGhhdCB0aGUgZW50cmllcyBzdG9yZWQgb24gdGhlIGtpbGxlZAogICAgICog\nYm9va2llIGFyZSBwcm9wZXJseSBjb3BpZWQgb3ZlciBhbmQgcmVzdG9yZWQg\nb250byB0aGUgbmV3IG9uZS4KICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2Vw\ndGlvbgogICAgICovCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEFz\neW5jQm9va2llUmVjb3ZlcnlUb1NwZWNpZmljQm9va2llKCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAg\nICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAgICAgIExpc3Q8TGVkZ2VySGFu\nZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMpOwoKICAgICAg\nICAvLyBXcml0ZSB0aGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBk\ndW1teSB2YWx1ZXMuCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAgICAg\nICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAg\nICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAg\nICAgICBMT0cuaW5mbygiRmluaXNoZWQgd3JpdGluZyBhbGwgbGVkZ2VyIGVu\ndHJpZXMgc28gc2h1dGRvd24gb25lIG9mIHRoZSBib29raWVzLiIpOwogICAg\nICAgIGJzLmdldCgwKS5zaHV0ZG93bigpOwogICAgICAgIGJzLnJlbW92ZSgw\nKTsKCiAgICAgICAgLy8gU3RhcnR1cCBhIG5ldyBib29raWUgc2VydmVyCiAg\nICAgICAgaW50IG5ld0Jvb2tpZVBvcnQgPSBzdGFydE5ld0Jvb2tpZSgpOwoK\nICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcyBmb3IgdGhlIGxl\nZGdlcnMgc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBiZQogICAgICAgIC8vIGNy\nZWF0ZWQgZm9yIHRoZW0uCiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJz\nKG51bU1zZ3MsIDEwLCBsaHMpOwoKICAgICAgICAvLyBDYWxsIHRoZSBhc3lu\nYyByZWNvdmVyIGJvb2tpZSBtZXRob2QuCiAgICAgICAgSW5ldFNvY2tldEFk\nZHJlc3MgYm9va2llU3JjID0gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRB\nZGRyZXNzLmdldExvY2FsSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIGluaXRp\nYWxQb3J0KTsKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVEZXN0\nID0gbmV3IEluZXRTb2NrZXRBZGRyZXNzKEluZXRBZGRyZXNzLmdldExvY2Fs\nSG9zdCgpLmdldEhvc3RBZGRyZXNzKCksIG5ld0Jvb2tpZVBvcnQpOwogICAg\nICAgIExPRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUgZGF0YSBvbiB0aGUga2ls\nbGVkIGJvb2tpZSAoIiArIGJvb2tpZVNyYyArICIpIGFuZCByZXBsaWNhdGUg\naXQgdG8gdGhlIG5ldyBvbmUgKCIKICAgICAgICAgICAgICAgICArIGJvb2tp\nZURlc3QgKyAiKSIpOwogICAgICAgIC8vIEluaXRpYXRlIHRoZSBzeW5jIG9i\namVjdAogICAgICAgIHN5bmMudmFsdWUgPSBmYWxzZTsKICAgICAgICBia0Fk\nbWluLmFzeW5jUmVjb3ZlckJvb2tpZURhdGEoYm9va2llU3JjLCBib29raWVE\nZXN0LCBib29raWVSZWNvdmVyQ2IsIHN5bmMpOwoKICAgICAgICAvLyBXYWl0\nIGZvciB0aGUgYXN5bmMgbWV0aG9kIHRvIGNvbXBsZXRlLgogICAgICAgIHN5\nbmNocm9uaXplZCAoc3luYykgewogICAgICAgICAgICB3aGlsZSAoc3luYy52\nYWx1ZSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgc3luYy53YWl0KCk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXNzZXJ0VHJ1ZShib29raWVS\nZWNvdmVyQ2Iuc3VjY2Vzcyk7CiAgICAgICAgfQoKICAgICAgICAvLyBWZXJp\nZnkgdGhlIHJlY292ZXJlZCBsZWRnZXIgZW50cmllcyBhcmUgb2theS4KICAg\nICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRnZXJzKGxocywgMCwgMiAqIG51bU1z\nZ3MgLSAxKTsKICAgIH0KCiAgICAvKioKICAgICAqIFRoaXMgdGVzdHMgdGhl\nIGFzeW5jaHJvbm91cyBib29raWUgcmVjb3ZlcnkgZnVuY3Rpb25hbGl0eSBi\neSB3cml0aW5nCiAgICAgKiBlbnRyaWVzIGludG8gMyBib29raWVzLCBraWxs\naW5nIG9uZSBib29raWUsIHN0YXJ0aW5nIHVwIGEgZmV3IG5ldwogICAgICog\nYm9va2llcywgYW5kIHRoZW4gcmVjb3ZlcmluZyB0aGUgbGVkZ2VyIGVudHJp\nZXMgZnJvbSB0aGUga2lsbGVkIGJvb2tpZQogICAgICogb250byByYW5kb20g\nYXZhaWxhYmxlIGJvb2tpZSBzZXJ2ZXJzLiBXZSdsbCB2ZXJpZnkgdGhhdCB0\naGUgZW50cmllcwogICAgICogc3RvcmVkIG9uIHRoZSBraWxsZWQgYm9va2ll\nIGFyZSBwcm9wZXJseSBjb3BpZWQgb3ZlciBhbmQgcmVzdG9yZWQgb250bwog\nICAgICogdGhlIG90aGVyIGJvb2tpZXMuCiAgICAgKgogICAgICogQHRocm93\ncyBFeGNlcHRpb24KICAgICAqLwogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lk\nIHRlc3RBc3luY0Jvb2tpZVJlY292ZXJ5VG9SYW5kb21Cb29raWVzKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBsZWRnZXJz\nCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAzOwogICAgICAgIExpc3Q8TGVk\nZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxlZGdlcnMpOwoK\nICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMg\nd2l0aCBkdW1teSB2YWx1ZXMuCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsK\nICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhz\nKTsKCiAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2\nZXIKICAgICAgICBMT0cuaW5mbygiRmluaXNoZWQgd3JpdGluZyBhbGwgbGVk\nZ2VyIGVudHJpZXMgc28gc2h1dGRvd24gb25lIG9mIHRoZSBib29raWVzLiIp\nOwogICAgICAgIGJzLmdldCgwKS5zaHV0ZG93bigpOwogICAgICAgIGJzLnJl\nbW92ZSgwKTsKCiAgICAgICAgLy8gU3RhcnR1cCB0aHJlZSBuZXcgYm9va2ll\nIHNlcnZlcnMKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IDM7IGkrKykg\newogICAgICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gV3JpdGUgc29tZSBtb3JlIGVudHJpZXMgZm9yIHRoZSBsZWRn\nZXJzIHNvIGEgbmV3IGVuc2VtYmxlIHdpbGwgYmUKICAgICAgICAvLyBjcmVh\ndGVkIGZvciB0aGVtLgogICAgICAgIHdyaXRlRW50cmllc3RvTGVkZ2Vycyhu\ndW1Nc2dzLCAxMCwgbGhzKTsKCiAgICAgICAgLy8gQ2FsbCB0aGUgYXN5bmMg\ncmVjb3ZlciBib29raWUgbWV0aG9kLgogICAgICAgIEluZXRTb2NrZXRBZGRy\nZXNzIGJvb2tpZVNyYyA9IG5ldyBJbmV0U29ja2V0QWRkcmVzcyhJbmV0QWRk\ncmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0QWRkcmVzcygpLCBpbml0aWFs\nUG9ydCk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llRGVzdCA9\nIG51bGw7CiAgICAgICAgTE9HLmluZm8oIk5vdyByZWNvdmVyIHRoZSBkYXRh\nIG9uIHRoZSBraWxsZWQgYm9va2llICgiICsgYm9va2llU3JjCiAgICAgICAg\nICAgICAgICAgKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIGEgcmFuZG9tIGF2\nYWlsYWJsZSBvbmUiKTsKICAgICAgICAvLyBJbml0aWF0ZSB0aGUgc3luYyBv\nYmplY3QKICAgICAgICBzeW5jLnZhbHVlID0gZmFsc2U7CiAgICAgICAgYmtB\nZG1pbi5hc3luY1JlY292ZXJCb29raWVEYXRhKGJvb2tpZVNyYywgYm9va2ll\nRGVzdCwgYm9va2llUmVjb3ZlckNiLCBzeW5jKTsKCiAgICAgICAgLy8gV2Fp\ndCBmb3IgdGhlIGFzeW5jIG1ldGhvZCB0byBjb21wbGV0ZS4KICAgICAgICBz\neW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgd2hpbGUgKHN5bmMu\ndmFsdWUgPT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHN5bmMud2FpdCgp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2VydFRydWUoYm9va2ll\nUmVjb3ZlckNiLnN1Y2Nlc3MpOwogICAgICAgIH0KCiAgICAgICAgLy8gVmVy\naWZ5IHRoZSByZWNvdmVyZWQgbGVkZ2VyIGVudHJpZXMgYXJlIG9rYXkuCiAg\nICAgICAgdmVyaWZ5UmVjb3ZlcmVkTGVkZ2VycyhsaHMsIDAsIDIgKiBudW1N\nc2dzIC0gMSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIHRlc3RzIHRo\nZSBzeW5jaHJvbm91cyBib29raWUgcmVjb3ZlcnkgZnVuY3Rpb25hbGl0eSBi\neSB3cml0aW5nCiAgICAgKiBlbnRyaWVzIGludG8gMyBib29raWVzLCBraWxs\naW5nIG9uZSBib29raWUsIHN0YXJ0aW5nIHVwIGEgbmV3IG9uZSB0bwogICAg\nICogcmVwbGFjZSBpdCwgYW5kIHRoZW4gcmVjb3ZlcmluZyB0aGUgbGVkZ2Vy\nIGVudHJpZXMgZnJvbSB0aGUga2lsbGVkIGJvb2tpZQogICAgICogb250byB0\naGUgbmV3IG9uZS4gV2UnbGwgdmVyaWZ5IHRoYXQgdGhlIGVudHJpZXMgc3Rv\ncmVkIG9uIHRoZSBraWxsZWQKICAgICAqIGJvb2tpZSBhcmUgcHJvcGVybHkg\nY29waWVkIG92ZXIgYW5kIHJlc3RvcmVkIG9udG8gdGhlIG5ldyBvbmUuCiAg\nICAgKgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgQFRl\nc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RTeW5jQm9va2llUmVjb3ZlcnlUb1Nw\nZWNpZmljQm9va2llKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgLy8g\nQ3JlYXRlIHRoZSBsZWRnZXJzCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAz\nOwogICAgICAgIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRn\nZXJzKG51bUxlZGdlcnMpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmll\ncyBmb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMuCiAgICAgICAg\naW50IG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdl\ncnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAgLy8gU2h1dGRvd24gdGhl\nIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBMT0cuaW5mbygiRmluaXNo\nZWQgd3JpdGluZyBhbGwgbGVkZ2VyIGVudHJpZXMgc28gc2h1dGRvd24gb25l\nIG9mIHRoZSBib29raWVzLiIpOwogICAgICAgIGJzLmdldCgwKS5zaHV0ZG93\nbigpOwogICAgICAgIGJzLnJlbW92ZSgwKTsKCiAgICAgICAgLy8gU3RhcnR1\ncCBhIG5ldyBib29raWUgc2VydmVyCiAgICAgICAgaW50IG5ld0Jvb2tpZVBv\ncnQgPSBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICAvLyBXcml0ZSBzb21l\nIG1vcmUgZW50cmllcyBmb3IgdGhlIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1i\nbGUgd2lsbCBiZQogICAgICAgIC8vIGNyZWF0ZWQgZm9yIHRoZW0uCiAgICAg\nICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDEwLCBsaHMpOwoK\nICAgICAgICAvLyBDYWxsIHRoZSBzeW5jIHJlY292ZXIgYm9va2llIG1ldGhv\nZC4KICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVTcmMgPSBuZXcg\nSW5ldFNvY2tldEFkZHJlc3MoSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCku\nZ2V0SG9zdEFkZHJlc3MoKSwgaW5pdGlhbFBvcnQpOwogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIGJvb2tpZURlc3QgPSBuZXcgSW5ldFNvY2tldEFkZHJl\nc3MoSW5ldEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3Mo\nKSwgbmV3Qm9va2llUG9ydCk7CiAgICAgICAgTE9HLmluZm8oIk5vdyByZWNv\ndmVyIHRoZSBkYXRhIG9uIHRoZSBraWxsZWQgYm9va2llICgiICsgYm9va2ll\nU3JjICsgIikgYW5kIHJlcGxpY2F0ZSBpdCB0byB0aGUgbmV3IG9uZSAoIgog\nICAgICAgICAgICAgICAgICsgYm9va2llRGVzdCArICIpIik7CiAgICAgICAg\nYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29raWVTcmMsIGJvb2tpZURl\nc3QpOwoKICAgICAgICAvLyBWZXJpZnkgdGhlIHJlY292ZXJlZCBsZWRnZXIg\nZW50cmllcyBhcmUgb2theS4KICAgICAgICB2ZXJpZnlSZWNvdmVyZWRMZWRn\nZXJzKGxocywgMCwgMiAqIG51bU1zZ3MgLSAxKTsKICAgIH0KCiAgICAvKioK\nICAgICAqIFRoaXMgdGVzdHMgdGhlIHN5bmNocm9ub3VzIGJvb2tpZSByZWNv\ndmVyeSBmdW5jdGlvbmFsaXR5IGJ5IHdyaXRpbmcKICAgICAqIGVudHJpZXMg\naW50byAzIGJvb2tpZXMsIGtpbGxpbmcgb25lIGJvb2tpZSwgc3RhcnRpbmcg\ndXAgYSBmZXcgbmV3CiAgICAgKiBib29raWVzLCBhbmQgdGhlbiByZWNvdmVy\naW5nIHRoZSBsZWRnZXIgZW50cmllcyBmcm9tIHRoZSBraWxsZWQgYm9va2ll\nCiAgICAgKiBvbnRvIHJhbmRvbSBhdmFpbGFibGUgYm9va2llIHNlcnZlcnMu\nIFdlJ2xsIHZlcmlmeSB0aGF0IHRoZSBlbnRyaWVzCiAgICAgKiBzdG9yZWQg\nb24gdGhlIGtpbGxlZCBib29raWUgYXJlIHByb3Blcmx5IGNvcGllZCBvdmVy\nIGFuZCByZXN0b3JlZCBvbnRvCiAgICAgKiB0aGUgb3RoZXIgYm9va2llcy4K\nICAgICAqCiAgICAgKiBAdGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBA\nVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFN5bmNCb29raWVSZWNvdmVyeVRv\nUmFuZG9tQm9va2llcygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8v\nIENyZWF0ZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBudW1MZWRnZXJzID0g\nMzsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzID0gY3JlYXRlTGVk\nZ2VycyhudW1MZWRnZXJzKTsKCiAgICAgICAgLy8gV3JpdGUgdGhlIGVudHJp\nZXMgZm9yIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFsdWVzLgogICAgICAg\nIGludCBudW1Nc2dzID0gMTA7CiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRn\nZXJzKG51bU1zZ3MsIDAsIGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIHRo\nZSBmaXJzdCBib29raWUgc2VydmVyCiAgICAgICAgTE9HLmluZm8oIkZpbmlz\naGVkIHdyaXRpbmcgYWxsIGxlZGdlciBlbnRyaWVzIHNvIHNodXRkb3duIG9u\nZSBvZiB0aGUgYm9va2llcy4iKTsKICAgICAgICBicy5nZXQoMCkuc2h1dGRv\nd24oKTsKICAgICAgICBicy5yZW1vdmUoMCk7CgogICAgICAgIC8vIFN0YXJ0\ndXAgdGhyZWUgbmV3IGJvb2tpZSBzZXJ2ZXJzCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgICAgICAgc3RhcnROZXdCb29r\naWUoKTsKICAgICAgICB9CgogICAgICAgIC8vIFdyaXRlIHNvbWUgbW9yZSBl\nbnRyaWVzIGZvciB0aGUgbGVkZ2VycyBzbyBhIG5ldyBlbnNlbWJsZSB3aWxs\nIGJlCiAgICAgICAgLy8gY3JlYXRlZCBmb3IgdGhlbS4KICAgICAgICB3cml0\nZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMTAsIGxocyk7CgogICAgICAg\nIC8vIENhbGwgdGhlIHN5bmMgcmVjb3ZlciBib29raWUgbWV0aG9kLgogICAg\nICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZVNyYyA9IG5ldyBJbmV0U29j\na2V0QWRkcmVzcyhJbmV0QWRkcmVzcy5nZXRMb2NhbEhvc3QoKS5nZXRIb3N0\nQWRkcmVzcygpLCBpbml0aWFsUG9ydCk7CiAgICAgICAgSW5ldFNvY2tldEFk\nZHJlc3MgYm9va2llRGVzdCA9IG51bGw7CiAgICAgICAgTE9HLmluZm8oIk5v\ndyByZWNvdmVyIHRoZSBkYXRhIG9uIHRoZSBraWxsZWQgYm9va2llICgiICsg\nYm9va2llU3JjCiAgICAgICAgICAgICAgICAgKyAiKSBhbmQgcmVwbGljYXRl\nIGl0IHRvIGEgcmFuZG9tIGF2YWlsYWJsZSBvbmUiKTsKICAgICAgICBia0Fk\nbWluLnJlY292ZXJCb29raWVEYXRhKGJvb2tpZVNyYywgYm9va2llRGVzdCk7\nCgogICAgICAgIC8vIFZlcmlmeSB0aGUgcmVjb3ZlcmVkIGxlZGdlciBlbnRy\naWVzIGFyZSBva2F5LgogICAgICAgIHZlcmlmeVJlY292ZXJlZExlZGdlcnMo\nbGhzLCAwLCAyICogbnVtTXNncyAtIDEpOwogICAgfQoKICAgIHByaXZhdGUg\nc3RhdGljIGNsYXNzIFJlcGxpY2F0aW9uVmVyaWZpY2F0aW9uQ2FsbGJhY2sg\naW1wbGVtZW50cyBSZWFkRW50cnlDYWxsYmFjayB7CiAgICAgICAgZmluYWwg\nQ291bnREb3duTGF0Y2ggbGF0Y2g7CiAgICAgICAgZmluYWwgQXRvbWljTG9u\nZyBudW1TdWNjZXNzOwoKICAgICAgICBSZXBsaWNhdGlvblZlcmlmaWNhdGlv\nbkNhbGxiYWNrKGludCBudW1SZXF1ZXN0cykgewogICAgICAgICAgICBsYXRj\naCA9IG5ldyBDb3VudERvd25MYXRjaChudW1SZXF1ZXN0cyk7CiAgICAgICAg\nICAgIG51bVN1Y2Nlc3MgPSBuZXcgQXRvbWljTG9uZygwKTsKICAgICAgICB9\nCgogICAgICAgIHB1YmxpYyB2b2lkIHJlYWRFbnRyeUNvbXBsZXRlKGludCBy\nYywgbG9uZyBsZWRnZXJJZCwgbG9uZyBlbnRyeUlkLCBDaGFubmVsQnVmZmVy\nIGJ1ZmZlciwgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBpZiAoTE9HLmlz\nRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIEluZXRTb2NrZXRB\nZGRyZXNzIGFkZHIgPSAoSW5ldFNvY2tldEFkZHJlc3MpY3R4OwogICAgICAg\nICAgICAgICAgTE9HLmRlYnVnKCJHb3QgIiArIHJjICsgIiBmb3IgbGVkZ2Vy\nICIgKyBsZWRnZXJJZCArICIgZW50cnkgIiArIGVudHJ5SWQgKyAiIGZyb20g\nIiArIGN0eCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJjID09\nIEJLRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgIG51bVN1\nY2Nlc3MuaW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgbGF0Y2guY291bnREb3duKCk7CiAgICAgICAgfQoKICAgICAgICBs\nb25nIGF3YWl0KCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgaWYgKGxhdGNoLmF3YWl0KDYwLCBUaW1lVW5pdC5TRUNPTkRT\nKSA9PSBmYWxzZSkgewogICAgICAgICAgICAgICAgTE9HLndhcm4oIkRpZG4n\ndCBnZXQgYWxsIHJlc3BvbnNlcyBpbiB2ZXJpZmljYXRpb24iKTsKICAgICAg\nICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgcmV0dXJuIG51bVN1Y2Nlc3MuZ2V0KCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJpdmF0ZSBib29sZWFuIHZl\ncmlmeUZ1bGx5UmVwbGljYXRlZChMZWRnZXJIYW5kbGUgbGgsIGxvbmcgdW50\naWxFbnRyeSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgU3RyaW5nIHpu\nb2RlcGF0aCA9IGJrYy5nZXRMZWRnZXJNYW5hZ2VyKCkuZ2V0TGVkZ2VyUGF0\naChsaC5nZXRJZCgpKTsKICAgICAgICBTdGF0IHN0YXQgPSBia2MuZ2V0WmtI\nYW5kbGUoKS5leGlzdHMoem5vZGVwYXRoLCBmYWxzZSk7CiAgICAgICAgYXNz\nZXJ0Tm90TnVsbChzdGF0KTsKICAgICAgICBieXRlW10gbWRieXRlcyA9IGJr\nYy5nZXRaa0hhbmRsZSgpLmdldERhdGEoem5vZGVwYXRoLCBmYWxzZSwgc3Rh\ndCk7IAogICAgICAgIExlZGdlck1ldGFkYXRhIG1kID0gTGVkZ2VyTWV0YWRh\ndGEucGFyc2VDb25maWcobWRieXRlcywgc3RhdC5nZXRWZXJzaW9uKCkpOyAK\nCiAgICAgICAgTWFwPExvbmcsIEFycmF5TGlzdDxJbmV0U29ja2V0QWRkcmVz\ncz4+IGVuc2VtYmxlcyA9IG1kLmdldEVuc2VtYmxlcygpOwoKICAgICAgICBI\nYXNoTWFwPExvbmcsIExvbmc+IHJhbmdlcyA9IG5ldyBIYXNoTWFwPExvbmcs\nIExvbmc+KCk7CiAgICAgICAgQXJyYXlMaXN0PExvbmc+IGtleUxpc3QgPSBD\nb2xsZWN0aW9ucy5saXN0KAogICAgICAgICAgICAgICAgQ29sbGVjdGlvbnMu\nZW51bWVyYXRpb24oZW5zZW1ibGVzLmtleVNldCgpKSk7CiAgICAgICAgQ29s\nbGVjdGlvbnMuc29ydChrZXlMaXN0KTsKICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGtleUxpc3Quc2l6ZSgpIC0gMTsgaSsrKSB7CiAgICAgICAgICAg\nIHJhbmdlcy5wdXQoa2V5TGlzdC5nZXQoaSksIGtleUxpc3QuZ2V0KGkrMSkp\nOwogICAgICAgIH0KICAgICAgICByYW5nZXMucHV0KGtleUxpc3QuZ2V0KGtl\neUxpc3Quc2l6ZSgpLTEpLCB1bnRpbEVudHJ5KTsKICAgICAgICAKICAgICAg\nICBmb3IgKE1hcC5FbnRyeTxMb25nLCBBcnJheUxpc3Q8SW5ldFNvY2tldEFk\nZHJlc3M+PiBlIDogZW5zZW1ibGVzLmVudHJ5U2V0KCkpIHsKICAgICAgICAg\nICAgaW50IHF1b3J1bSA9IG1kLnF1b3J1bVNpemU7CiAgICAgICAgICAgIGxv\nbmcgc3RhcnRFbnRyeUlkID0gZS5nZXRLZXkoKTsKICAgICAgICAgICAgbG9u\nZyBlbmRFbnRyeUlkID0gcmFuZ2VzLmdldChzdGFydEVudHJ5SWQpOwogICAg\nICAgICAgICBsb25nIGV4cGVjdGVkU3VjY2VzcyA9IHF1b3J1bSooZW5kRW50\ncnlJZC1zdGFydEVudHJ5SWQpOwogICAgICAgICAgICBpbnQgbnVtUmVxdWVz\ndHMgPSBlLmdldFZhbHVlKCkuc2l6ZSgpKigoaW50KShlbmRFbnRyeUlkLXN0\nYXJ0RW50cnlJZCkpOwoKICAgICAgICAgICAgUmVwbGljYXRpb25WZXJpZmlj\nYXRpb25DYWxsYmFjayBjYiA9IG5ldyBSZXBsaWNhdGlvblZlcmlmaWNhdGlv\nbkNhbGxiYWNrKG51bVJlcXVlc3RzKTsKICAgICAgICAgICAgZm9yIChsb25n\nIGkgPSBzdGFydEVudHJ5SWQ7IGkgPCBlbmRFbnRyeUlkOyBpKyspIHsKICAg\nICAgICAgICAgICAgIGZvciAoSW5ldFNvY2tldEFkZHJlc3MgYWRkciA6IGUu\nZ2V0VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgIGJrYy5ib29raWVD\nbGllbnQucmVhZEVudHJ5KGFkZHIsIGxoLmdldElkKCksIGksIGNiLCBhZGRy\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgbG9uZyBudW1TdWNjZXNzID0gY2IuYXdhaXQoKTsKICAgICAgICAgICAg\naWYgKG51bVN1Y2Nlc3MgPCBleHBlY3RlZFN1Y2Nlc3MpIHsKICAgICAgICAg\nICAgICAgIExPRy53YXJuKCJGcmFnbWVudCBub3QgZnVsbHkgcmVwbGljYXRl\nZCBsZWRnZXJJZCA9ICIgKyBsaC5nZXRJZCgpCiAgICAgICAgICAgICAgICAg\nICAgICAgICArICIgc3RhcnRFbnRyeUlkID0gIiArIHN0YXJ0RW50cnlJZAog\nICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGVuZEVudHJ5SWQgPSAiICsg\nZW5kRW50cnlJZCAKICAgICAgICAgICAgICAgICAgICAgICAgICsgIiBleHBl\nY3RlZFN1Y2Nlc3MgPSAiICsgZXhwZWN0ZWRTdWNjZXNzCiAgICAgICAgICAg\nICAgICAgICAgICAgICArICIgZ290U3VjY2VzcyA9ICIgKyBudW1TdWNjZXNz\nKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBw\ncml2YXRlIGJvb2xlYW4gZmluZER1cGVzSW5FbnNlbWJsZXMoTGlzdDxMZWRn\nZXJIYW5kbGU+IGxocykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgbG9u\nZyBudW1EdXBlcyA9IDA7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGgg\nOiBsaHMpIHsKICAgICAgICAgICAgU3RyaW5nIHpub2RlcGF0aCA9IGJrYy5n\nZXRMZWRnZXJNYW5hZ2VyKCkuZ2V0TGVkZ2VyUGF0aChsaC5nZXRJZCgpKTsK\nICAgICAgICAgICAgU3RhdCBzdGF0ID0gYmtjLmdldFprSGFuZGxlKCkuZXhp\nc3RzKHpub2RlcGF0aCwgZmFsc2UpOwogICAgICAgICAgICBhc3NlcnROb3RO\ndWxsKHN0YXQpOwogICAgICAgICAgICBieXRlW10gbWRieXRlcyA9IGJrYy5n\nZXRaa0hhbmRsZSgpLmdldERhdGEoem5vZGVwYXRoLCBmYWxzZSwgc3RhdCk7\nIAogICAgICAgICAgICBMZWRnZXJNZXRhZGF0YSBtZCA9IExlZGdlck1ldGFk\nYXRhLnBhcnNlQ29uZmlnKG1kYnl0ZXMsIHN0YXQuZ2V0VmVyc2lvbigpKTsg\nCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgKE1hcC5FbnRyeTxMb25n\nLCBBcnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+PiBlIDogbWQuZ2V0RW5z\nZW1ibGVzKCkuZW50cnlTZXQoKSkgewogICAgICAgICAgICAgICAgSGFzaFNl\ndDxJbmV0U29ja2V0QWRkcmVzcz4gc2V0ID0gbmV3IEhhc2hTZXQ8SW5ldFNv\nY2tldEFkZHJlc3M+KCk7CiAgICAgICAgICAgICAgICBsb25nIGZyYWdtZW50\nID0gZS5nZXRLZXkoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAg\nICAgZm9yIChJbmV0U29ja2V0QWRkcmVzcyBhZGRyIDogZS5nZXRWYWx1ZSgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHNldC5jb250YWlucyhhZGRy\nKSkgewogICAgICAgICAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkR1cGUg\nIiArIGFkZHIgKyAiIGZvdW5kIGluIGVuc2VtYmxlIGZvciBmcmFnbWVudCAi\nICsgZnJhZ21lbnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nICIgb2YgbGVkZ2VyICIgKyBsaC5nZXRJZCgpKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgbnVtRHVwZXMrKzsKICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgc2V0LmFkZChhZGRyKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4g\nbnVtRHVwZXMgPiAwOwogICAgfQoKICAgIC8qKgogICAgICogVGVzdCByZWNv\ndmVyeWluZyB0aGUgY2xvc2VkIGxlZGdlcnMgd2hlbiB0aGUgZmFpbGVkIGJv\nb2tpZSBzZXJ2ZXIgaXMgaW4gdGhlIGxhc3QgZW5zZW1ibGUKICAgICAqLwog\nICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RCb29raWVSZWNvdmVyeU9u\nQ2xvc2VkTGVkZ2VycygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8v\nIENyZWF0ZSB0aGUgbGVkZ2VycwogICAgICAgIGludCBudW1MZWRnZXJzID0g\nMzsKICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhzID0gY3JlYXRlTGVk\nZ2VycyhudW1MZWRnZXJzLCBudW1Cb29raWVzLCAyKTsKCiAgICAgICAgLy8g\nV3JpdGUgdGhlIGVudHJpZXMgZm9yIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkg\ndmFsdWVzCiAgICAgICAgaW50IG51bU1zZ3MgPSAxMDsKICAgICAgICB3cml0\nZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAg\nY2xvc2VMZWRnZXJzKGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIGxhc3Qg\nYm9va2llIHNlcnZlciBpbiBsYXN0IGVuc2VtYmxlCiAgICAgICAgQXJyYXlM\naXN0PEluZXRTb2NrZXRBZGRyZXNzPiBsYXN0RW5zZW1ibGUgPSBsaHMuZ2V0\nKDApLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1ibGVzKCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC5lbnRyeVNldCgpLml0ZXJhdG9yKCkubmV4dCgpLmdldFZhbHVlKCk7\nCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llVG9LaWxsID0gbGFz\ndEVuc2VtYmxlLmdldChsYXN0RW5zZW1ibGUuc2l6ZSgpIC0gMSk7CiAgICAg\nICAga2lsbEJvb2tpZShib29raWVUb0tpbGwpOwoKICAgICAgICAvLyBzdGFy\ndCBhIG5ldyBib29raWUKICAgICAgICBzdGFydE5ld0Jvb2tpZSgpOwoKICAg\nICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVEZXN0ID0gbnVsbDsKICAg\nICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRhdGEgb24gdGhlIGtp\nbGxlZCBib29raWUgKCIgKyBib29raWVUb0tpbGwKICAgICAgICAgICAgICAg\nKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIGEgcmFuZG9tIGF2YWlsYWJsZSBv\nbmUiKTsKCiAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9va2llRGF0YShib29r\naWVUb0tpbGwsIGJvb2tpZURlc3QpOwogICAgICAgIGZvciAoTGVkZ2VySGFu\nZGxlIGxoIDogbGhzKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUoIk5vdCBm\ndWxseSByZXBsaWNhdGVkIiwgdmVyaWZ5RnVsbHlSZXBsaWNhdGVkKGxoLCBu\ndW1Nc2dzKSk7CiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0Qm9va2llUmVj\nb3ZlcnlPbk9wZW5lZExlZGdlcnMoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAgICAgICBpbnQgbnVtTGVk\nZ2VycyA9IDM7CiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IGxocyA9IGNy\nZWF0ZUxlZGdlcnMobnVtTGVkZ2VycywgbnVtQm9va2llcywgMik7CgogICAg\nICAgIC8vIFdyaXRlIHRoZSBlbnRyaWVzIGZvciB0aGUgbGVkZ2VycyB3aXRo\nIGR1bW15IHZhbHVlcwogICAgICAgIGludCBudW1Nc2dzID0gMTA7CiAgICAg\nICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51bU1zZ3MsIDAsIGxocyk7Cgog\nICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJzdCBib29raWUgc2VydmVyCiAg\nICAgICAgQXJyYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPiBsYXN0RW5zZW1i\nbGUgPSBsaHMuZ2V0KDApLmdldExlZGdlck1ldGFkYXRhKCkuZ2V0RW5zZW1i\nbGVzKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC5lbnRyeVNldCgpLml0ZXJhdG9yKCkubmV4dCgp\nLmdldFZhbHVlKCk7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2ll\nVG9LaWxsID0gbGFzdEVuc2VtYmxlLmdldChsYXN0RW5zZW1ibGUuc2l6ZSgp\nIC0gMSk7CiAgICAgICAga2lsbEJvb2tpZShib29raWVUb0tpbGwpOwoKICAg\nICAgICAvLyBzdGFydCBhIG5ldyBib29raWUKICAgICAgICBzdGFydE5ld0Jv\nb2tpZSgpOwoKICAgICAgICBJbmV0U29ja2V0QWRkcmVzcyBib29raWVEZXN0\nID0gbnVsbDsKICAgICAgICBMT0cuaW5mbygiTm93IHJlY292ZXIgdGhlIGRh\ndGEgb24gdGhlIGtpbGxlZCBib29raWUgKCIgKyBib29raWVUb0tpbGwKICAg\nICAgICAgICAgICAgKyAiKSBhbmQgcmVwbGljYXRlIGl0IHRvIGEgcmFuZG9t\nIGF2YWlsYWJsZSBvbmUiKTsKCiAgICAgICAgYmtBZG1pbi5yZWNvdmVyQm9v\na2llRGF0YShib29raWVUb0tpbGwsIGJvb2tpZURlc3QpOwoKICAgICAgICBm\nb3IgKExlZGdlckhhbmRsZSBsaCA6IGxocykgewogICAgICAgICAgICBhc3Nl\ncnRUcnVlKCJOb3QgZnVsbHkgcmVwbGljYXRlZCIsIHZlcmlmeUZ1bGx5UmVw\nbGljYXRlZChsaCwgbnVtTXNncykpOwogICAgICAgIH0KCiAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgLy8gd2UgY2FuJ3Qgd3JpdGUgZW50cmllcwogICAg\nICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhz\nKTsKICAgICAgICAgICAgZmFpbCgic2hvdWxkIG5vdCByZWFjaCBoZXJlIik7\nCiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICB9CiAg\nICB9CgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RCb29raWVSZWNv\ndmVyeU9uSW5SZWNvdmVyeUxlZGdlcigpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIGludCBudW1Nc2dzID0gMTA7CiAgICAgICAgLy8gQ3JlYXRlIHRo\nZSBsZWRnZXJzCiAgICAgICAgaW50IG51bUxlZGdlcnMgPSAxOwogICAgICAg\nIExpc3Q8TGVkZ2VySGFuZGxlPiBsaHMgPSBjcmVhdGVMZWRnZXJzKG51bUxl\nZGdlcnMsIDIsIDIpOwoKICAgICAgICAvLyBXcml0ZSB0aGUgZW50cmllcyBm\nb3IgdGhlIGxlZGdlcnMgd2l0aCBkdW1teSB2YWx1ZXMKICAgICAgICB3cml0\nZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgMCwgbGhzKTsKCiAgICAgICAg\nLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIKICAgICAgICBB\ncnJheUxpc3Q8SW5ldFNvY2tldEFkZHJlc3M+IGxhc3RFbnNlbWJsZSA9IGxo\ncy5nZXQoMCkuZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMoKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLmVudHJ5U2V0KCkuaXRlcmF0b3IoKS5uZXh0KCkuZ2V0VmFs\ndWUoKTsKICAgICAgICAvLyByZW1vdmVkIGJvb2tpZQogICAgICAgIEluZXRT\nb2NrZXRBZGRyZXNzIGJvb2tpZVRvS2lsbCA9IGxhc3RFbnNlbWJsZS5nZXQo\nMCk7CiAgICAgICAga2lsbEJvb2tpZShib29raWVUb0tpbGwpOwogICAgICAg\nIC8vIHRlbXAgZmFpbHVyZQogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJv\nb2tpZVRvS2lsbDIgPSBsYXN0RW5zZW1ibGUuZ2V0KDEpOwogICAgICAgIFNl\ncnZlckNvbmZpZ3VyYXRpb24gY29uZjIgPSBraWxsQm9va2llKGJvb2tpZVRv\nS2lsbDIpOwoKICAgICAgICAvLyBzdGFydCBhIG5ldyBib29raWUKICAgICAg\nICBzdGFydE5ld0Jvb2tpZSgpOwoKICAgICAgICAvLyBvcGVuIHRoZXNlIGxl\nZGdlcnMKICAgICAgICBmb3IgKExlZGdlckhhbmRsZSBvbGRMaCA6IGxocykg\newogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgYmtjLm9wZW5M\nZWRnZXIob2xkTGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgYmFzZUNsaWVudENv\nbmYuZ2V0Qm9va2llUmVjb3ZlcnlQYXNzd2QoKSk7CiAgICAgICAgICAgICAg\nICBmYWlsKCJTaG91bGQgaGF2ZSB0aHJvd24gZXhjZXB0aW9uIik7CiAgICAg\nICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIH0K\nICAgICAgICB9CgogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGJrQWRtaW4u\ncmVjb3ZlckJvb2tpZURhdGEoYm9va2llVG9LaWxsLCBudWxsKTsKICAgICAg\nICAgICAgZmFpbCgiU2hvdWxkIGhhdmUgdGhyb3duIGV4Y2VwdGlvbiIpOwog\nICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTGVkZ2VyUmVjb3ZlcnlF\neGNlcHRpb24gYmtlKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZp\nb3VyCiAgICAgICAgfQoKICAgICAgICAvLyByZXN0YXJ0IGZhaWxlZCBib29r\naWUKICAgICAgICBicy5hZGQoc3RhcnRCb29raWUoY29uZjIpKTsKICAgICAg\nICBic0NvbmZzLmFkZChjb25mMik7CgogICAgICAgIC8vIHJlY292ZXIgdGhl\nbQogICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tpZURhdGEoYm9va2llVG9L\naWxsLCBudWxsKTsKCiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbGggOiBs\naHMpIHsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiTm90IGZ1bGx5IHJlcGxp\nY2F0ZWQiLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQobGgsIG51bU1zZ3MpKTsK\nICAgICAgICB9CgogICAgICAgIC8vIG9wZW4gbGVkZ2VycyB0byByZWFkIG1l\ndGFkYXRhCiAgICAgICAgTGlzdDxMZWRnZXJIYW5kbGU+IG5ld0xocyA9IG9w\nZW5MZWRnZXJzKGxocyk7CiAgICAgICAgZm9yIChMZWRnZXJIYW5kbGUgbmV3\nTGggOiBuZXdMaHMpIHsKICAgICAgICAgICAgLy8gZmlyc3QgZW5zZW1ibGUg\nc2hvdWxkIGNvbnRhaW5zIGJvb2tpZVRvS2lsbDIgYW5kIG5vdCBjb250YWlu\nIGJvb2tpZVRvS2lsbAogICAgICAgICAgICBNYXAuRW50cnk8TG9uZywgQXJy\nYXlMaXN0PEluZXRTb2NrZXRBZGRyZXNzPj4gZW50cnkgPQogICAgICAgICAg\nICAgICAgbmV3TGguZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNlbWJsZXMo\nKS5lbnRyeVNldCgpLml0ZXJhdG9yKCkubmV4dCgpOwogICAgICAgICAgICBh\nc3NlcnRGYWxzZShlbnRyeS5nZXRWYWx1ZSgpLmNvbnRhaW5zKGJvb2tpZVRv\nS2lsbCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKGVudHJ5LmdldFZhbHVl\nKCkuY29udGFpbnMoYm9va2llVG9LaWxsMikpOwogICAgICAgIH0KCiAgICB9\nCgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RBc3luY0Jvb2tpZVJl\nY292ZXJ5VG9SYW5kb21Cb29raWVzTm90RW5vdWdoQm9va2llcygpIHRocm93\ncyBFeGNlcHRpb24gewogICAgICAgIC8vIENyZWF0ZSB0aGUgbGVkZ2Vycwog\nICAgICAgIGludCBudW1MZWRnZXJzID0gMzsKICAgICAgICBMaXN0PExlZGdl\nckhhbmRsZT4gbGhzID0gY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJzLCBudW1C\nb29raWVzLCAyKTsKCiAgICAgICAgLy8gV3JpdGUgdGhlIGVudHJpZXMgZm9y\nIHRoZSBsZWRnZXJzIHdpdGggZHVtbXkgdmFsdWVzLgogICAgICAgIGludCBu\ndW1Nc2dzID0gMTA7CiAgICAgICAgd3JpdGVFbnRyaWVzdG9MZWRnZXJzKG51\nbU1zZ3MsIDAsIGxocyk7CgogICAgICAgIC8vIFNodXRkb3duIHRoZSBmaXJz\ndCBib29raWUgc2VydmVyCiAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIHdy\naXRpbmcgYWxsIGxlZGdlciBlbnRyaWVzIHNvIHNodXRkb3duIG9uZSBvZiB0\naGUgYm9va2llcy4iKTsKICAgICAgICBicy5nZXQoMCkuc2h1dGRvd24oKTsK\nICAgICAgICBicy5yZW1vdmUoMCk7CgogICAgICAgIC8vIENhbGwgdGhlIGFz\neW5jIHJlY292ZXIgYm9va2llIG1ldGhvZC4KICAgICAgICBJbmV0U29ja2V0\nQWRkcmVzcyBib29raWVTcmMgPSBuZXcgSW5ldFNvY2tldEFkZHJlc3MoSW5l\ndEFkZHJlc3MuZ2V0TG9jYWxIb3N0KCkuZ2V0SG9zdEFkZHJlc3MoKSwgaW5p\ndGlhbFBvcnQpOwogICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tpZURl\nc3QgPSBudWxsOwogICAgICAgIExPRy5pbmZvKCJOb3cgcmVjb3ZlciB0aGUg\nZGF0YSBvbiB0aGUga2lsbGVkIGJvb2tpZSAoIiArIGJvb2tpZVNyYwogICAg\nICAgICAgICAgICAgICsgIikgYW5kIHJlcGxpY2F0ZSBpdCB0byBhIHJhbmRv\nbSBhdmFpbGFibGUgb25lIik7CiAgICAgICAgLy8gSW5pdGlhdGUgdGhlIHN5\nbmMgb2JqZWN0CiAgICAgICAgc3luYy52YWx1ZSA9IGZhbHNlOwogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGJrQWRtaW4ucmVjb3ZlckJvb2tpZURhdGEo\nYm9va2llU3JjLCBudWxsKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGhh\ndmUgdGhyb3duIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhj\nZXB0aW9uLkJLTGVkZ2VyUmVjb3ZlcnlFeGNlcHRpb24gYmtlKSB7CiAgICAg\nICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoK\nICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0U3luY0Jvb2tpZVJlY292\nZXJ5VG9SYW5kb21Cb29raWVzQ2hlY2tGb3JEdXBlcygpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIFJhbmRvbSByID0gbmV3IFJhbmRvbSgpOwogICAg\nICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAg\nICAvLyBDcmVhdGUgdGhlIGxlZGdlcnMKICAgICAgICAgICAgaW50IG51bUxl\nZGdlcnMgPSAzOwogICAgICAgICAgICBMaXN0PExlZGdlckhhbmRsZT4gbGhz\nID0gY3JlYXRlTGVkZ2VycyhudW1MZWRnZXJzLCBudW1Cb29raWVzLCAyKTsK\nICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFdyaXRlIHRoZSBlbnRyaWVz\nIGZvciB0aGUgbGVkZ2VycyB3aXRoIGR1bW15IHZhbHVlcy4KICAgICAgICAg\nICAgaW50IG51bU1zZ3MgPSAxMDA7CiAgICAgICAgICAgIHdyaXRlRW50cmll\nc3RvTGVkZ2VycyhudW1Nc2dzLCAwLCBsaHMpOwogICAgICAgICAgICAKICAg\nICAgICAgICAgLy8gU2h1dGRvd24gdGhlIGZpcnN0IGJvb2tpZSBzZXJ2ZXIK\nICAgICAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVkIHdyaXRpbmcgYWxsIGxl\nZGdlciBlbnRyaWVzIHNvIHNodXRkb3duIG9uZSBvZiB0aGUgYm9va2llcy4i\nKTsKICAgICAgICAgICAgaW50IHJlbW92ZUluZGV4ID0gci5uZXh0SW50KGJz\nLnNpemUoKSk7CiAgICAgICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGJvb2tp\nZVNyYyA9IGJzLmdldChyZW1vdmVJbmRleCkuZ2V0TG9jYWxBZGRyZXNzKCk7\nCiAgICAgICAgICAgIGJzLmdldChyZW1vdmVJbmRleCkuc2h1dGRvd24oKTsK\nICAgICAgICAgICAgYnMucmVtb3ZlKHJlbW92ZUluZGV4KTsKICAgICAgICAg\nICAgCiAgICAgICAgICAgIC8vIFN0YXJ0dXAgdGhyZWUgbmV3IGJvb2tpZSBz\nZXJ2ZXJzCiAgICAgICAgICAgIHN0YXJ0TmV3Qm9va2llKCk7CiAgICAgICAg\nICAgIAogICAgICAgICAgICAvLyBXcml0ZSBzb21lIG1vcmUgZW50cmllcyBm\nb3IgdGhlIGxlZGdlcnMgc28gYSBuZXcgZW5zZW1ibGUgd2lsbCBiZQogICAg\nICAgICAgICAvLyBjcmVhdGVkIGZvciB0aGVtLgogICAgICAgICAgICB3cml0\nZUVudHJpZXN0b0xlZGdlcnMobnVtTXNncywgbnVtTXNncywgbGhzKTsKICAg\nICAgICAgICAgCiAgICAgICAgICAgIC8vIENhbGwgdGhlIGFzeW5jIHJlY292\nZXIgYm9va2llIG1ldGhvZC4KICAgICAgICAgICAgTE9HLmluZm8oIk5vdyBy\nZWNvdmVyIHRoZSBkYXRhIG9uIHRoZSBraWxsZWQgYm9va2llICgiICsgYm9v\na2llU3JjCiAgICAgICAgICAgICAgICAgICAgICsgIikgYW5kIHJlcGxpY2F0\nZSBpdCB0byBhIHJhbmRvbSBhdmFpbGFibGUgb25lIik7CiAgICAgICAgICAg\nIC8vIEluaXRpYXRlIHRoZSBzeW5jIG9iamVjdAogICAgICAgICAgICBzeW5j\nLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIGJrQWRtaW4ucmVjb3ZlckJv\nb2tpZURhdGEoYm9va2llU3JjLCBudWxsKTsKICAgICAgICAgICAgYXNzZXJ0\nRmFsc2UoIkR1cGVzIGV4aXN0IGluIGVuc2VtYmxlcyIsIGZpbmREdXBlc0lu\nRW5zZW1ibGVzKGxocykpOwoKICAgICAgICAgICAgLy8gV3JpdGUgc29tZSBt\nb3JlIGVudHJpZXMgdG8gZW5zdXJlIGZlbmNpbmcgaGFzbid0IGJyb2tlbiBz\ndHVmZgogICAgICAgICAgICB3cml0ZUVudHJpZXN0b0xlZGdlcnMobnVtTXNn\ncywgbnVtTXNncyoyLCBsaHMpOwogICAgICAgICAgICBmb3IgKExlZGdlckhh\nbmRsZSBsaCA6IGxocykgewogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgi\nTm90IGZ1bGx5IHJlcGxpY2F0ZWQiLCB2ZXJpZnlGdWxseVJlcGxpY2F0ZWQo\nbGgsIG51bU1zZ3MqMykpOwogICAgICAgICAgICAgICAgbGguY2xvc2UoKTsK\nICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KfQo=\n","encoding":"base64"}

