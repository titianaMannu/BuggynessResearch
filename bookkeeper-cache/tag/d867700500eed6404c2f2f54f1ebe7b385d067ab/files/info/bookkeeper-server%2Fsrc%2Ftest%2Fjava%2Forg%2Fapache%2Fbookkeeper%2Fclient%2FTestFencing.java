{"sha":"1c109a28741df7bebdd9675fa5dddf7db35d05b1","node_id":"MDQ6QmxvYjE1NzU5NTY6MWMxMDlhMjg3NDFkZjdiZWJkZDk2NzVmYTVkZGRmN2RiMzVkMDViMQ==","size":12921,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/1c109a28741df7bebdd9675fa5dddf7db35d05b1","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50OwoKLyoKICoK\nICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9u\nIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vu\nc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICogZGlzdHJp\nYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRp\nb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNG\nIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNo\nZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNlIik7IHlv\ndSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2UK\nICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBv\nZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9y\nZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQg\nYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsCiAq\nIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRp\nc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhPVVQgV0FS\nUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBlaXRoZXIg\nZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUK\nICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFu\nZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoKICovCgpp\nbXBvcnQgb3JnLmp1bml0Lio7CmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0\nQWRkcmVzczsKaW1wb3J0IGphdmEudXRpbC5FbnVtZXJhdGlvbjsKaW1wb3J0\nIGphdmEudXRpbC5jb25jdXJyZW50LkN5Y2xpY0JhcnJpZXI7CmltcG9ydCBq\nYXZhLnV0aWwuY29uY3VycmVudC5Db3VudERvd25MYXRjaDsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5jb25mLkNsaWVudENvbmZpZ3VyYXRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhh\nbmRsZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVk\nZ2VyRW50cnk7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50\nLkJvb2tLZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tLZWVwZXJBZG1pbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0LkJhc2VUZXN0Q2FzZTsKCmlt\ncG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dl\nckZhY3Rvcnk7CgovKioKICogVGhpcyB1bml0IHRlc3QgdGVzdHMgbGVkZ2Vy\nIGZlbmNpbmc7CiAqCiAqLwpwdWJsaWMgY2xhc3MgVGVzdEZlbmNpbmcgZXh0\nZW5kcyBCYXNlVGVzdENhc2UgewogICAgc3RhdGljIExvZ2dlciBMT0cgPSBM\nb2dnZXJGYWN0b3J5LmdldExvZ2dlcihUZXN0RmVuY2luZy5jbGFzcyk7Cgog\nICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwoKICAgIHB1YmxpYyBUZXN0RmVu\nY2luZyhEaWdlc3RUeXBlIGRpZ2VzdFR5cGUpIHsKICAgICAgICBzdXBlcigx\nMCk7CiAgICAgICAgdGhpcy5kaWdlc3RUeXBlID0gZGlnZXN0VHlwZTsKICAg\nIH0KCiAgICAvKioKICAgICAqIEJhc2ljIGZlbmNpbmcgdGVzdC4gQ3JlYXRl\nIGxlZGdlciwgd3JpdGUgdG8gaXQsCiAgICAgKiBvcGVuIGxlZGdlciwgd3Jp\ndGUgYWdhaW4gKHNob3VsZCBmYWlsKS4KICAgICAqLwogICAgQFRlc3QKICAg\nIHB1YmxpYyB2b2lkIHRlc3RCYXNpY0ZlbmNpbmcoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAvKgogICAgICAgICAqIENyZWF0ZSBsZWRnZXIuCiAg\nICAgICAgICovCiAgICAgICAgTGVkZ2VySGFuZGxlIHdyaXRlbGggPSBudWxs\nOwogICAgICAgIHdyaXRlbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5\ncGUsICJwYXNzd29yZCIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIFN0cmluZyB0\nbXAgPSAiQm9va0tlZXBlciBpcyBjb29sISI7CiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCAxMDsgaSsrKSB7CiAgICAgICAgICAgIHdyaXRlbGguYWRk\nRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAgIH0KCiAgICAgICAgLyoK\nICAgICAgICAgKiBUcnkgdG8gb3BlbiBsZWRnZXIuCiAgICAgICAgICovCiAg\nICAgICAgTGVkZ2VySGFuZGxlIHJlYWRsaCA9IGJrYy5vcGVuTGVkZ2VyKHdy\naXRlbGguZ2V0SWQoKSwgZGlnZXN0VHlwZSwgInBhc3N3b3JkIi5nZXRCeXRl\ncygpKTsKICAgICAgICAvLyBzaG91bGQgaGF2ZSB0cmlnZ2VyZWQgcmVjb3Zl\ncnkgYW5kIGZlbmNpbmcKICAgICAgICAKICAgICAgICB0cnkgewogICAgICAg\nICAgICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAg\nICAgICAgTE9HLmVycm9yKCJTaG91bGQgaGF2ZSB0aHJvd24gYW4gZXhjZXB0\naW9uIik7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBoYXZlIHRocm93biBh\nbiBleGNlcHRpb24gd2hlbiB0cnlpbmcgdG8gd3JpdGUiKTsKICAgICAgICB9\nIGNhdGNoIChCS0V4Y2VwdGlvbi5CS0xlZGdlckZlbmNlZEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAg\nfQogICAgICAgICAgICAgICAgCiAgICAgICAgLyoKICAgICAgICAgKiBDaGVj\nayBpZiBoYXMgcmVjb3ZlcmVkIHByb3Blcmx5LgogICAgICAgICAqLwogICAg\nICAgIGFzc2VydFRydWUoIkhhcyBub3QgcmVjb3ZlcmVkIGNvcnJlY3RseTog\nIiArIHJlYWRsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgCiAgICAgICAgICAg\nICAgICAgICArICIgb3JpZ2luYWwgIiArIHdyaXRlbGguZ2V0TGFzdEFkZENv\nbmZpcm1lZCgpLAogICAgICAgICAgICAgICAgICAgcmVhZGxoLmdldExhc3RB\nZGRDb25maXJtZWQoKSA9PSB3cml0ZWxoLmdldExhc3RBZGRDb25maXJtZWQo\nKSk7CiAgICB9CgogICAgcHJpdmF0ZSBzdGF0aWMgaW50IHRocmVhZENvdW50\nID0gMDsKCiAgICBjbGFzcyBMZWRnZXJPcGVuVGhyZWFkIGV4dGVuZHMgVGhy\nZWFkIHsKICAgICAgICBwcml2YXRlIGZpbmFsIGxvbmcgbGVkZ2VySWQ7CiAg\nICAgICAgcHJpdmF0ZSBsb25nIGxhc3RDb25maXJtZWRFbnRyeSA9IDA7Cgog\nICAgICAgIAogICAgICAgIHByaXZhdGUgZmluYWwgRGlnZXN0VHlwZSBkaWdl\nc3RUeXBlOwogICAgICAgIHByaXZhdGUgZmluYWwgQ3ljbGljQmFycmllciBi\nYXJyaWVyOwoKICAgICAgICBMZWRnZXJPcGVuVGhyZWFkIChEaWdlc3RUeXBl\nIGRpZ2VzdFR5cGUsIGxvbmcgbGVkZ2VySWQsIEN5Y2xpY0JhcnJpZXIgYmFy\ncmllcikKICAgICAgICAgICAgICAgIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgICAgICBzdXBlcigiVGVzdEZlbmNpbmctTGVkZ2VyT3BlblRocmVhZC0i\nICsgdGhyZWFkQ291bnQrKyk7CiAgICAgICAgICAgIHRoaXMubGVkZ2VySWQg\nPSBsZWRnZXJJZDsKICAgICAgICAgICAgdGhpcy5kaWdlc3RUeXBlID0gZGln\nZXN0VHlwZTsKICAgICAgICAgICAgdGhpcy5iYXJyaWVyID0gYmFycmllcjsK\nICAgICAgICB9CiAgICAgICAgCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAg\ncHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICBMZWRnZXJIYW5kbGUg\nbGggPSBudWxsOwogICAgICAgICAgICBCb29rS2VlcGVyIGJrID0gbnVsbDsK\nICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGJhcnJpZXIuYXdh\naXQoKTsKICAgICAgICAgICAgICAgIHdoaWxlKHRydWUpIHsKICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBiayA9\nIG5ldyBCb29rS2VlcGVyKG5ldyBDbGllbnRDb25maWd1cmF0aW9uKGJhc2VD\nbGllbnRDb25mKSwgYmtjLmdldFprSGFuZGxlKCkpOwogICAgICAgICAgICAg\nICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgbGggPSBiay5v\ncGVuTGVkZ2VyKGxlZGdlcklkLCAKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICBsYXN0Q29uZmlybWVkRW50cnkg\nPSBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9u\nLlpLRXhjZXB0aW9uIHprZSkgewogICAgICAgICAgICAgICAgICAgICAgICBM\nT0cuaW5mbygiQ29udGVudGlvbiB3aXRoIHNvbWVvbmUgZWxzZSByZWNvdmVy\naW5nIik7CiAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRp\nb24uQktMZWRnZXJSZWNvdmVyeUV4Y2VwdGlvbiBia3JlKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIExPRy5pbmZvKCJDb250ZW50aW9uIHdpdGggc29t\nZW9uZSBlbHNlIHJlY292ZXJpbmciKTsKICAgICAgICAgICAgICAgICAgICB9\nIGZpbmFsbHkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAobGggIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGguY2xvc2Uo\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgICAgICBpZiAoYmsgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgYmsuY2xvc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGJrID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgIC8v\nIGp1c3QgZXhpdCwgdGVzdCBzaG91bGQgc3BvdCBiYWQgbGFzdCBhZGQgY29u\nZmlybWVkCiAgICAgICAgICAgICAgICBMT0cuZXJyb3IoIkV4Y2VwdGlvbiBv\nY2N1cnJlZCAiLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBMT0cu\naW5mbygiVGhyZWFkIGV4aXRpbmcsIGxhc3RDb25maXJtZWRFbnRyeSA9ICIg\nKyBsYXN0Q29uZmlybWVkRW50cnkpOwogICAgICAgIH0KCiAgICAgICAgbG9u\nZyBnZXRMYXN0Q29uZmlybWVkRW50cnkoKSB7CiAgICAgICAgICAgIHJldHVy\nbiBsYXN0Q29uZmlybWVkRW50cnk7CiAgICAgICAgfQogICAgfQoKICAgIC8q\nKgogICAgICogVHJ5IHRvIG9wZW4gYSBsZWRnZXIgbWFueSB0aW1lcyBpbiBw\nYXJhbGxlbC4KICAgICAqIEFsbCBvcGVucyBzaG91bGQgcmVzdWx0IGluIGEg\nbGVkZ2VyIHdpdGggYW4gZXF1YWxzIG51bWJlciBvZiAKICAgICAqIGVudHJp\nZXMuCiAgICAgKi8KICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0TWFu\neU9wZW5QYXJhbGxlbCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIC8q\nCiAgICAgICAgICogQ3JlYXRlIGxlZGdlci4KICAgICAgICAgKi8KICAgICAg\nICBmaW5hbCBMZWRnZXJIYW5kbGUgd3JpdGVsaCA9IGJrYy5jcmVhdGVMZWRn\nZXIoZGlnZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CgogICAgICAgIGZpbmFs\nIGludCBudW1SZWNvdmVyeSA9IDEwOwoKICAgICAgICBmaW5hbCBTdHJpbmcg\ndG1wID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZpbmFsIENv\ndW50RG93bkxhdGNoIGxhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKG51bVJl\nY292ZXJ5KTsKICAgICAgICBUaHJlYWQgd3JpdGV0aHJlYWQgPSBuZXcgVGhy\nZWFkKCkgewogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewog\nICAgICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGxhdGNoLmNvdW50RG93bigpOwogICAgICAg\nICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSBjYXRj\naCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9H\nLmluZm8oIkV4Y2VwdGlvbiBhZGRpbmcgZW50cnkiLCBlKTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07\nCiAgICAgICAgd3JpdGV0aHJlYWQuc3RhcnQoKTsKCgogICAgICAgIEN5Y2xp\nY0JhcnJpZXIgYmFycmllciA9IG5ldyBDeWNsaWNCYXJyaWVyKG51bVJlY292\nZXJ5KzEpOwogICAgICAgIExlZGdlck9wZW5UaHJlYWQgdGhyZWFkc1tdID0g\nbmV3IExlZGdlck9wZW5UaHJlYWRbbnVtUmVjb3ZlcnldOwogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbnVtUmVjb3Zlcnk7IGkrKykgewogICAgICAg\nICAgICB0aHJlYWRzW2ldID0gbmV3IExlZGdlck9wZW5UaHJlYWQoZGlnZXN0\nVHlwZSwgd3JpdGVsaC5nZXRJZCgpLCBiYXJyaWVyKTsKICAgICAgICAgICAg\ndGhyZWFkc1tpXS5zdGFydCgpOwogICAgICAgIH0KICAgICAgICBsYXRjaC5h\nd2FpdCgpOwogICAgICAgIGJhcnJpZXIuYXdhaXQoKTsgLy8gc2hvdWxkIHRy\naWdnZXIgdGhyZWFkcyB0byBnbwoKICAgICAgICB3cml0ZXRocmVhZC5qb2lu\nKCk7CiAgICAgICAgbG9uZyBsYXN0Q29uZmlybWVkID0gd3JpdGVsaC5nZXRM\nYXN0QWRkQ29uZmlybWVkKCk7CiAgICAgICAgCiAgICAgICAgZm9yIChpbnQg\naSA9IDA7IGkgPCBudW1SZWNvdmVyeTsgaSsrKSB7CiAgICAgICAgICAgIHRo\ncmVhZHNbaV0uam9pbigpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJBZGRl\nZCBjb25maXJtZWQgaXMgaW5jb3JyZWN0IiwgCiAgICAgICAgICAgICAgICAg\nICAgICAgbGFzdENvbmZpcm1lZCA8PSB0aHJlYWRzW2ldLmdldExhc3RDb25m\naXJtZWRFbnRyeSgpKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBUZXN0IHRoYXQgb3BlbmluZyBhIGxlZGdlciBpbiBub3JlY292ZXJ5IG1v\nZGUKICAgICAqIGRvZXNuJ3QgZmVuY2Ugb2ZmIGEgbGVkZ2VyCiAgICAgKi8K\nICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0Tm9SZWNvdmVyeU9wZW4o\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvKgogICAgICAgICAqIENy\nZWF0ZSBsZWRnZXIuCiAgICAgICAgICovCiAgICAgICAgTGVkZ2VySGFuZGxl\nIHdyaXRlbGggPSBudWxsOwogICAgICAgIHdyaXRlbGggPSBia2MuY3JlYXRl\nTGVkZ2VyKGRpZ2VzdFR5cGUsICIiLmdldEJ5dGVzKCkpOwoKICAgICAgICBT\ndHJpbmcgdG1wID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZp\nbmFsIGludCBudW1FbnRyaWVzID0gMTA7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgd3JpdGVs\naC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAg\nICAvKgogICAgICAgICAqIFRyeSB0byBvcGVuIGxlZGdlci4KICAgICAgICAg\nKi8KICAgICAgICBMZWRnZXJIYW5kbGUgcmVhZGxoID0gYmtjLm9wZW5MZWRn\nZXJOb1JlY292ZXJ5KHdyaXRlbGguZ2V0SWQoKSwgCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGln\nZXN0VHlwZSwgIiIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgLy8gc2hvdWxkIG5v\ndCBoYXZlIHRyaWdnZXJlZCByZWNvdmVyeSBhbmQgZmVuY2luZwogICAgICAg\nIAogICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwog\nICAgICAgIGxvbmcgbnVtUmVhZGFibGUgPSByZWFkbGguZ2V0TGFzdEFkZENv\nbmZpcm1lZCgpOwogICAgICAgIExPRy5lcnJvcigibnVtUmVhZCAiICsgbnVt\nUmVhZGFibGUpOwogICAgICAgIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiBl\nbnRyaWVzID0gcmVhZGxoLnJlYWRFbnRyaWVzKDEsIG51bVJlYWRhYmxlKTsK\nICAgICAgICB0cnkgewogICAgICAgICAgICByZWFkbGgucmVhZEVudHJpZXMo\nbnVtUmVhZGFibGUrMSwgbnVtUmVhZGFibGUrMSk7CiAgICAgICAgICAgIGZh\naWwoIlNob3VsZG4ndCBoYXZlIGJlZW4gYWJsZSB0byByZWFkIHRoaXMgZmFy\nIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24uQktSZWFkRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgLy8gYWxsIGlzIGdvb2QKICAgICAgICB9\nCgogICAgICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwog\nICAgICAgIGxvbmcgbnVtUmVhZGFibGUyID0gcmVhZGxoLmdldExhc3RBZGRD\nb25maXJtZWQoKTsKICAgICAgICBhc3NlcnRFcXVhbHMoIk51bWJlciBvZiBy\nZWFkYWJsZSBlbnRyaWVzIGhhc24ndCBjaGFuZ2VkIiwgbnVtUmVhZGFibGUy\nLCBudW1SZWFkYWJsZSk7CiAgICAgICAgcmVhZGxoLmNsb3NlKCk7CgogICAg\nICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAg\nIHdyaXRlbGguY2xvc2UoKTsKICAgIH0KCiAgICAvKioKICAgICAqIGNyZWF0\nZSBhIGxlZGdlciBhbmQgd3JpdGUgZW50cmllcy4gCiAgICAgKiBraWxsIGEg\nYm9va2llIGluIHRoZSBlbnNlbWJsZS4gUmVjb3Zlci4KICAgICAqIEZlbmNl\nIHRoZSBsZWRnZXIuIEtpbGwgYW5vdGhlciBib29raWUuIFJlY292ZXIuCiAg\nICAgKi8KICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0RmVuY2luZ0lu\ndGVyYWN0aW9uV2l0aEJvb2tpZVJlY292ZXJ5KCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgU3lzdGVtLnNldFByb3BlcnR5KCJkaWdlc3RUeXBlIiwg\nZGlnZXN0VHlwZS50b1N0cmluZygpKTsKICAgICAgICBTeXN0ZW0uc2V0UHJv\ncGVydHkoInBhc3N3ZCIsICJ0ZXN0UGFzc3dkIik7CgogICAgICAgIEJvb2tL\nZWVwZXJBZG1pbiBhZG1pbiA9IG5ldyBCb29rS2VlcGVyQWRtaW4oemtVdGls\nLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CgogICAgICAgIExlZGdl\nckhhbmRsZSB3cml0ZWxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBl\nLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgCiAgICAgICAg\nU3RyaW5nIHRtcCA9ICJGb29iYXIiOwogICAgICAgIAogICAgICAgIGZpbmFs\nIGludCBudW1FbnRyaWVzID0gMTA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7\nIGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAgd3JpdGVsaC5h\nZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoKICAgICAgICBJ\nbmV0U29ja2V0QWRkcmVzcyBib29raWVUb0tpbGwgCiAgICAgICAgICAgID0g\nd3JpdGVsaC5nZXRMZWRnZXJNZXRhZGF0YSgpLmdldEVuc2VtYmxlKG51bUVu\ndHJpZXMpLmdldCgwKTsKICAgICAgICBraWxsQm9va2llKGJvb2tpZVRvS2ls\nbCk7CgogICAgICAgIC8vIHdyaXRlIGVudHJpZXMgdG8gY2hhbmdlIGVuc2Vt\nYmxlCiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBp\nKyspIHsKICAgICAgICAgICAgd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0\nZXMoKSk7CiAgICAgICAgfQoKICAgICAgICBhZG1pbi5yZWNvdmVyQm9va2ll\nRGF0YShib29raWVUb0tpbGwsIG51bGwpOwogICAgICAgIAogICAgICAgIGZv\nciAoaW50IGkgPSAwOyBpIDwgbnVtRW50cmllczsgaSsrKSB7CiAgICAgICAg\nICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAg\nIH0KCiAgICAgICAgTGVkZ2VySGFuZGxlIHJlYWRsaCA9IGJrYy5vcGVuTGVk\nZ2VyKHdyaXRlbGguZ2V0SWQoKSwgCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIGRpZ2VzdFR5cGUsICJ0ZXN0UGFzc3dk\nIi5nZXRCeXRlcygpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3cml0\nZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJTaG91bGQgaGF2ZSB0aHJvd24gYW4gZXhjZXB0aW9uIik7CiAg\nICAgICAgICAgIGZhaWwoIlNob3VsZCBoYXZlIHRocm93biBhbiBleGNlcHRp\nb24gd2hlbiB0cnlpbmcgdG8gd3JpdGUiKTsKICAgICAgICB9IGNhdGNoIChC\nS0V4Y2VwdGlvbi5CS0xlZGdlckZlbmNlZEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQoKICAgICAg\nICByZWFkbGguY2xvc2UoKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB3\ncml0ZWxoLmNsb3NlKCk7CiAgICAgICAgICAgIGZhaWwoIlNob3VsZCBmYWls\nIHRyeWluZyB0byB1cGRhdGUgbWV0YWRhdGEiKTsKICAgICAgICB9IGNhdGNo\nIChCS0V4Y2VwdGlvbi5aS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIC8v\nIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoKICAgIC8qKgog\nICAgICogY3JlYXRlIGEgbGVkZ2VyIGFuZCB3cml0ZSBlbnRyaWVzLiAKICAg\nICAqIEZlbmNlIHRoZSBsZWRnZXIuIEtpbGwgYSBib29raWUuIFJlY292ZXIu\nCiAgICAgKiBFbnN1cmUgdGhhdCByZWNvdmVyIGRvZXNuJ3QgcmVhbGxvdyBh\nZGRpbmcKICAgICAqLwogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RG\nZW5jaW5nSW50ZXJhY3Rpb25XaXRoQm9va2llUmVjb3ZlcnkyKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgU3lzdGVtLnNldFByb3BlcnR5KCJkaWdl\nc3RUeXBlIiwgZGlnZXN0VHlwZS50b1N0cmluZygpKTsKICAgICAgICBTeXN0\nZW0uc2V0UHJvcGVydHkoInBhc3N3ZCIsICJ0ZXN0UGFzc3dkIik7CgogICAg\nICAgIEJvb2tLZWVwZXJBZG1pbiBhZG1pbiA9IG5ldyBCb29rS2VlcGVyQWRt\naW4oemtVdGlsLmdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmcoKSk7CgogICAg\nICAgIExlZGdlckhhbmRsZSB3cml0ZWxoID0gYmtjLmNyZWF0ZUxlZGdlcihk\naWdlc3RUeXBlLCAidGVzdFBhc3N3ZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAg\nCiAgICAgICAgU3RyaW5nIHRtcCA9ICJGb29iYXIiOwogICAgICAgIAogICAg\nICAgIGZpbmFsIGludCBudW1FbnRyaWVzID0gMTA7CiAgICAgICAgZm9yIChp\nbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzOyBpKyspIHsKICAgICAgICAgICAg\nd3JpdGVsaC5hZGRFbnRyeSh0bXAuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgfQoK\nICAgICAgICBMZWRnZXJIYW5kbGUgcmVhZGxoID0gYmtjLm9wZW5MZWRnZXIo\nd3JpdGVsaC5nZXRJZCgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZGlnZXN0VHlwZSwgInRlc3RQYXNzd2QiLmdl\ndEJ5dGVzKCkpOwogICAgICAgIC8vIHNob3VsZCBiZSBmZW5jZWQgYnkgbm93\nCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYm9va2llVG9LaWxsIAogICAg\nICAgICAgICA9IHdyaXRlbGguZ2V0TGVkZ2VyTWV0YWRhdGEoKS5nZXRFbnNl\nbWJsZShudW1FbnRyaWVzKS5nZXQoMCk7CiAgICAgICAga2lsbEJvb2tpZShi\nb29raWVUb0tpbGwpOwogICAgICAgIGFkbWluLnJlY292ZXJCb29raWVEYXRh\nKGJvb2tpZVRvS2lsbCwgbnVsbCk7CgogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIHdyaXRlbGguYWRkRW50cnkodG1wLmdldEJ5dGVzKCkpOwogICAgICAg\nICAgICBMT0cuZXJyb3IoIlNob3VsZCBoYXZlIHRocm93biBhbiBleGNlcHRp\nb24iKTsKICAgICAgICAgICAgZmFpbCgiU2hvdWxkIGhhdmUgdGhyb3duIGFu\nIGV4Y2VwdGlvbiB3aGVuIHRyeWluZyB0byB3cml0ZSIpOwogICAgICAgIH0g\nY2F0Y2ggKEJLRXhjZXB0aW9uLkJLTGVkZ2VyRmVuY2VkRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgLy8gY29ycmVjdCBiZWhhdmlvdXIKICAgICAgICB9\nCgogICAgICAgIHJlYWRsaC5jbG9zZSgpOwoKICAgICAgICB0cnkgewogICAg\nICAgICAgICB3cml0ZWxoLmNsb3NlKCk7CiAgICAgICAgICAgIGZhaWwoIlNo\nb3VsZCBmYWlsIHRyeWluZyB0byB1cGRhdGUgbWV0YWRhdGEiKTsKICAgICAg\nICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5aS0V4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgfQoK\nICAgIC8qKgogICAgICogVGVzdCB0aGF0IGZlbmNpbmcgZG9lc24ndCB3b3Jr\nIHdpdGggYSBiYWQgcGFzc3dvcmQKICAgICAqLwogICAgQFRlc3QKICAgIHB1\nYmxpYyB2b2lkIHRlc3RGZW5jaW5nQmFkUGFzc3dvcmQoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICAvKgogICAgICAgICAqIENyZWF0ZSBsZWRnZXIu\nCiAgICAgICAgICovCiAgICAgICAgTGVkZ2VySGFuZGxlIHdyaXRlbGggPSBu\ndWxsOwogICAgICAgIHdyaXRlbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2Vz\ndFR5cGUsICJwYXNzd29yZDEiLmdldEJ5dGVzKCkpOwoKICAgICAgICBTdHJp\nbmcgdG1wID0gIkJvb2tLZWVwZXIgaXMgY29vbCEiOwogICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgMTA7IGkrKykgewogICAgICAgICAgICB3cml0ZWxo\nLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAgICAgICB9CgogICAgICAg\nIC8qCiAgICAgICAgICogVHJ5IHRvIG9wZW4gbGVkZ2VyLgogICAgICAgICAq\nLwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIExlZGdlckhhbmRsZSByZWFk\nbGggPSBia2Mub3BlbkxlZGdlcih3cml0ZWxoLmdldElkKCksIGRpZ2VzdFR5\ncGUsICJiYWRQYXNzd29yZCIuZ2V0Qnl0ZXMoKSk7CiAgICAgICAgICAgIGZh\naWwoIlNob3VsZCBub3QgaGF2ZSBiZWVuIGFibGUgdG8gb3BlbiB3aXRoIGEg\nYmFkIHBhc3N3b3JkIik7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24u\nQktVbmF1dGhvcml6ZWRBY2Nlc3NFeGNlcHRpb24gdXVlKSB7CiAgICAgICAg\nICAgIC8vIGNvcnJlY3QgYmVoYXZpb3VyCiAgICAgICAgfQogICAgICAgIC8v\nIHNob3VsZCBoYXZlIHRyaWdnZXJlZCByZWNvdmVyeSBhbmQgZmVuY2luZwoK\nICAgICAgICB3cml0ZWxoLmFkZEVudHJ5KHRtcC5nZXRCeXRlcygpKTsKICAg\nIH0KCn0K\n","encoding":"base64"}

