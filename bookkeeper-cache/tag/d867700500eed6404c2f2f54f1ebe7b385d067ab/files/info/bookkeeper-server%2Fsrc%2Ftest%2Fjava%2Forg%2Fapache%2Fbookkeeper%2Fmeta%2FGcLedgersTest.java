{"sha":"12c1b5a2abe22bf26cb52b24f66842d1b71f5582","node_id":"MDQ6QmxvYjE1NzU5NTY6MTJjMWI1YTJhYmUyMmJmMjZjYjUyYjI0ZjY2ODQyZDFiNzFmNTU4Mg==","size":5920,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/12c1b5a2abe22bf26cb52b24f66842d1b71f5582","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci5tZXRhOwoKaW1w\nb3J0IGphdmEuaW8uSU9FeGNlcHRpb247CmltcG9ydCBqYXZhLnV0aWwuQXJy\nYXlMaXN0OwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb25zOwppbXBvcnQg\namF2YS51dGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5SYW5kb207CmltcG9ydCBqYXZhLnV0aWwuU2V0Owpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ291bnREb3duTGF0Y2g7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdl\ncjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xpZW50LkJLRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5M\nZWRnZXJNZXRhZGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5t\nZXRhLkxlZGdlck1hbmFnZXIuR2FyYmFnZUNvbGxlY3RvcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuR2VuZXJpY0NhbGxiYWNrOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0\nIG9yZy5qdW5pdC5UZXN0OwoKLyoqCiAqIFRlc3QgZ2FyYmFnZSBjb2xsZWN0\naW9uIGxlZGdlcnMgaW4gbGVkZ2VyIG1hbmFnZXIKICovCnB1YmxpYyBjbGFz\ncyBHY0xlZGdlcnNUZXN0IGV4dGVuZHMgTGVkZ2VyTWFuYWdlclRlc3RDYXNl\nIHsKICAgIHN0YXRpYyBmaW5hbCBMb2dnZXIgTE9HID0gTG9nZ2VyRmFjdG9y\neS5nZXRMb2dnZXIoR2NMZWRnZXJzVGVzdC5jbGFzcyk7CgogICAgcHVibGlj\nIEdjTGVkZ2Vyc1Rlc3QoU3RyaW5nIGxlZGdlck1hbmFnZXJUeXBlKSB7CiAg\nICAgICAgc3VwZXIobGVkZ2VyTWFuYWdlclR5cGUpOwogICAgfQoKICAgIC8q\nKgogICAgICogQ3JlYXRlIGxlZGdlcnMKICAgICAqLwogICAgcHJpdmF0ZSB2\nb2lkIGNyZWF0ZUxlZGdlcnMoaW50IG51bUxlZGdlcnMsIGZpbmFsIFNldDxM\nb25nPiBjcmVhdGVkTGVkZ2VycykgewogICAgICAgIGZpbmFsIEF0b21pY0lu\ndGVnZXIgZXhwZWN0ZWQgPSBuZXcgQXRvbWljSW50ZWdlcihudW1MZWRnZXJz\nKTsKICAgICAgICBmb3IgKGludCBpPTA7IGk8bnVtTGVkZ2VyczsgaSsrKSB7\nCiAgICAgICAgICAgIGxlZGdlck1hbmFnZXIubmV3TGVkZ2VyUGF0aChuZXcg\nR2VuZXJpY0NhbGxiYWNrPFN0cmluZz4oKSB7CiAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkNvbXBsZXRlKGludCByYywgU3RyaW5nIGxlZGdlclBhdGgpIHsKICAgICAg\nICAgICAgICAgICAgICBpZiAocmMgPT0gQktFeGNlcHRpb24uQ29kZS5PSykg\newogICAgICAgICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9uZyBsZWRnZXJJZCA9IGxlZGdlck1hbmFnZXIu\nZ2V0TGVkZ2VySWQobGVkZ2VyUGF0aCk7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICBsZWRnZXJNYW5hZ2VyLmFkZEFjdGl2ZUxlZGdlcihsZWRnZXJJ\nZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVk\nTGVkZ2Vycy5hZGQobGVkZ2VySWQpOwogICAgICAgICAgICAgICAgICAgICAg\nICB9IGNhdGNoIChJT0V4Y2VwdGlvbiBpZSkgewogICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgIHN5bmNocm9uaXplZCAoZXhwZWN0ZWQpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgaW50IG51bSA9IGV4cGVjdGVkLmRlY3JlbWVudEFuZEdl\ndCgpOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtID09IDApIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGVjdGVkLm5vdGlmeSgp\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBuZXcgTGVk\nZ2VyTWV0YWRhdGEoMSwgMSkpOwogICAgICAgIH0KICAgICAgICBzeW5jaHJv\nbml6ZWQgKGV4cGVjdGVkKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICB3aGlsZSAoZXhwZWN0ZWQuZ2V0KCkgPiAwKSB7CiAgICAgICAg\nICAgICAgICAgICAgZXhwZWN0ZWQud2FpdCgxMDApOwogICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlv\nbiBpZSkgewogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIEBU\nZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0R2FyYmFnZUNvbGxlY3RMZWRnZXJz\nKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaW50IG51bUxlZGdlcnMg\nPSAxMDA7CiAgICAgICAgaW50IG51bVJlbW92ZWRMZWRnZXJzID0gMTA7Cgog\nICAgICAgIGZpbmFsIFNldDxMb25nPiBjcmVhdGVkTGVkZ2VycyA9IG5ldyBI\nYXNoU2V0PExvbmc+KCk7CiAgICAgICAgZmluYWwgU2V0PExvbmc+IHJlbW92\nZWRMZWRnZXJzID0gbmV3IEhhc2hTZXQ8TG9uZz4oKTsKCiAgICAgICAgLy8g\nY3JlYXRlIDEwMCBsZWRnZXJzCiAgICAgICAgY3JlYXRlTGVkZ2VycyhudW1M\nZWRnZXJzLCBjcmVhdGVkTGVkZ2Vycyk7CgogICAgICAgIFJhbmRvbSByID0g\nbmV3IFJhbmRvbShTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAgICAg\nICAgZmluYWwgTGlzdDxMb25nPiB0bXBMaXN0ID0gbmV3IEFycmF5TGlzdDxM\nb25nPigpOwogICAgICAgIHRtcExpc3QuYWRkQWxsKGNyZWF0ZWRMZWRnZXJz\nKTsKICAgICAgICBDb2xsZWN0aW9ucy5zaHVmZmxlKHRtcExpc3QsIHIpOwog\nICAgICAgIC8vIHJhbmRvbSByZW1vdmUgc2V2ZXJhbCBsZWRnZXJzCiAgICAg\nICAgZm9yIChpbnQgaT0wOyBpPG51bVJlbW92ZWRMZWRnZXJzOyBpKyspIHsK\nICAgICAgICAgICAgbG9uZyBsZWRnZXJJZCA9IHRtcExpc3QuZ2V0KGkpOwog\nICAgICAgICAgICB6a2MuZGVsZXRlKGxlZGdlck1hbmFnZXIuZ2V0TGVkZ2Vy\nUGF0aChsZWRnZXJJZCksIC0xKTsKICAgICAgICAgICAgcmVtb3ZlZExlZGdl\ncnMuYWRkKGxlZGdlcklkKTsKICAgICAgICAgICAgY3JlYXRlZExlZGdlcnMu\ncmVtb3ZlKGxlZGdlcklkKTsKICAgICAgICB9CiAgICAgICAgZmluYWwgQ291\nbnREb3duTGF0Y2ggaW5HY1Byb2dyZXNzID0gbmV3IENvdW50RG93bkxhdGNo\nKDEpOwogICAgICAgIGZpbmFsIENvdW50RG93bkxhdGNoIGNyZWF0ZUxhdGNo\nID0gbmV3IENvdW50RG93bkxhdGNoKDEpOwogICAgICAgIGZpbmFsIENvdW50\nRG93bkxhdGNoIGVuZExhdGNoID0gbmV3IENvdW50RG93bkxhdGNoKDIpOwoK\nICAgICAgICBUaHJlYWQgZ2NUaHJlYWQgPSBuZXcgVGhyZWFkKCkgewogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgcnVu\nKCkgewogICAgICAgICAgICAgICAgbGVkZ2VyTWFuYWdlci5nYXJiYWdlQ29s\nbGVjdExlZGdlcnMobmV3IEdhcmJhZ2VDb2xsZWN0b3IoKSB7CiAgICAgICAg\nICAgICAgICAgICAgYm9vbGVhbiBwYXVzZWQgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICBwdWJs\naWMgdm9pZCBnYyhsb25nIGxlZGdlcklkKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmICghcGF1c2VkKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBpbkdjUHJvZ3Jlc3MuY291bnREb3duKCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGNyZWF0ZUxhdGNoLmF3YWl0KCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBpZSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcGF1c2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBMT0cuaW5mbygi\nR2FyYmFnZSBDb2xsZWN0ZWQgbGVkZ2VyIHt9IiwgbGVkZ2VySWQpOwogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAg\nICAgICAgICAgTE9HLmluZm8oIkdjIFRocmVhZCBxdWl0cy4iKTsKICAgICAg\nICAgICAgICAgIGVuZExhdGNoLmNvdW50RG93bigpOwogICAgICAgICAgICB9\nCiAgICAgICAgfTsKCiAgICAgICAgVGhyZWFkIGNyZWF0ZVRocmVhZCA9IG5l\ndyBUaHJlYWQoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAg\nICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIGluR2NQcm9ncmVzcy5hd2FpdCgpOwogICAg\nICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSAxMCBtb3JlIGxlZGdlcnMKICAg\nICAgICAgICAgICAgICAgICBjcmVhdGVMZWRnZXJzKDEwLCBjcmVhdGVkTGVk\nZ2Vycyk7CiAgICAgICAgICAgICAgICAgICAgTE9HLmluZm8oIkZpbmlzaGVk\nIGNyZWF0aW5nIDEwIG1vcmUgbGVkZ2Vycy4iKTsKICAgICAgICAgICAgICAg\nICAgICBjcmVhdGVMYXRjaC5jb3VudERvd24oKTsKICAgICAgICAgICAgICAg\nIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICBMT0cuaW5mbygiQ3JlYXRlIFRocmVhZCBxdWl0cy4i\nKTsKICAgICAgICAgICAgICAgIGVuZExhdGNoLmNvdW50RG93bigpOwogICAg\nICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgY3JlYXRlVGhyZWFkLnN0\nYXJ0KCk7CiAgICAgICAgZ2NUaHJlYWQuc3RhcnQoKTsKCiAgICAgICAgZW5k\nTGF0Y2guYXdhaXQoKTsKCiAgICAgICAgLy8gdGVzdCBsZWRnZXJzCiAgICAg\nICAgZm9yIChMb25nIGxlZGdlciA6IHJlbW92ZWRMZWRnZXJzKSB7CiAgICAg\nICAgICAgIGFzc2VydEZhbHNlKGxlZGdlck1hbmFnZXIuY29udGFpbnNBY3Rp\ndmVMZWRnZXIobGVkZ2VyKSk7CiAgICAgICAgfQogICAgICAgIGZvciAoTG9u\nZyBsZWRnZXIgOiBjcmVhdGVkTGVkZ2VycykgewogICAgICAgICAgICBhc3Nl\ncnRUcnVlKGxlZGdlck1hbmFnZXIuY29udGFpbnNBY3RpdmVMZWRnZXIobGVk\nZ2VyKSk7CiAgICAgICAgfQogICAgfQp9Cg==\n","encoding":"base64"}

