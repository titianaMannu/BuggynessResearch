{"sha":"384cc3b65ac925470692c7fbc43a4073a0900169","node_id":"MDQ6QmxvYjE1NzU5NTY6Mzg0Y2MzYjY1YWM5MjU0NzA2OTJjN2ZiYzQzYTQwNzNhMDkwMDE2OQ==","size":44687,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/384cc3b65ac925470692c7fbc43a4073a0900169","content":"cGFja2FnZSBvcmcuYXBhY2hlLmJvb2trZWVwZXIudGVzdDsKCi8qCiAqCiAq\nIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAo\nQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNl\nIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRpc3RyaWJ1\ndGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9u\nCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBs\naWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUg\nTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIpOyB5b3Ug\nbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlCiAq\nIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2Yg\ndGhlIExpY2Vuc2UgYXQKICoKICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcv\nbGljZW5zZXMvTElDRU5TRS0yLjAKICoKICogVW5sZXNzIHJlcXVpcmVkIGJ5\nIGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLAogKiBz\nb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0\ncmlidXRlZCBvbiBhbgogKiAiQVMgSVMiIEJBU0lTLCBXSVRIT1VUIFdBUlJB\nTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkKICogS0lORCwgZWl0aGVyIGV4\ncHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAq\nIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQg\nbGltaXRhdGlvbnMKICogdW5kZXIgdGhlIExpY2Vuc2UuCiAqCiAqLwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLmxhbmcuTm9TdWNoRmllbGRFeGNlcHRpb247CmltcG9y\ndCBqYXZhLmxhbmcuSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbjsKaW1wb3J0IGph\ndmEubGFuZy5yZWZsZWN0LkZpZWxkOwppbXBvcnQgamF2YS5uaW8uQnl0ZUJ1\nZmZlcjsKaW1wb3J0IGphdmEubmlvLmNoYXJzZXQuQ2hhcnNldDsKaW1wb3J0\nIGphdmEudXRpbC5BcnJheUxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVy\nYXRpb247CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2YS51\ndGlsLlNldDsKaW1wb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZh\nLnV0aWwuY29uY3VycmVudC5TZW1hcGhvcmU7CgoKaW1wb3J0IG9yZy5hcGFj\naGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmNDYWxsYmFjay5BZGRDYWxsYmFj\nazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuQXN5bmND\nYWxsYmFjay5SZWFkQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2tr\nZWVwZXIuY2xpZW50LkFzeW5jQ2FsbGJhY2suUmVhZExhc3RDb25maXJtZWRD\nYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQu\nQktFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY2xp\nZW50LkJvb2tLZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIu\nY2xpZW50LkxlZGdlckVudHJ5OwppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5MZWRnZXJIYW5kbGU7CmltcG9ydCBvcmcuYXBhY2hlLmJv\nb2trZWVwZXIuY2xpZW50LkJvb2tLZWVwZXIuRGlnZXN0VHlwZTsKaW1wb3J0\nIG9yZy5hcGFjaGUuYm9va2tlZXBlci5zdHJlYW1pbmcuTGVkZ2VySW5wdXRT\ndHJlYW07CmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVwZXIuc3RyZWFtaW5n\nLkxlZGdlck91dHB1dFN0cmVhbTsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5h\ncGFjaGUuem9va2VlcGVyLldhdGNoZWRFdmVudDsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLldhdGNoZXI7CmltcG9ydCBvcmcuanVuaXQuQXNzZXJ0\nOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5pdC5U\nZXN0OwoKLyoqCiAqIFRoaXMgdGVzdCB0ZXN0cyByZWFkIGFuZCB3cml0ZSwg\nc3luY2hyb25vdXMgYW5kIGFzeW5jaHJvbm91cywgc3RyaW5ncyBhbmQKICog\naW50ZWdlcnMgZm9yIGEgQm9va0tlZXBlciBjbGllbnQuIFRoZSB0ZXN0IGRl\ncGxveW1lbnQgdXNlcyBhIFpvb0tlZXBlciBzZXJ2ZXIKICogYW5kIHRocmVl\nIEJvb2tLZWVwZXJzLgogKgogKi8KCnB1YmxpYyBjbGFzcyBCb29raWVSZWFk\nV3JpdGVUZXN0IGV4dGVuZHMgQmFzZVRlc3RDYXNlCiAgICBpbXBsZW1lbnRz\nIEFkZENhbGxiYWNrLCBSZWFkQ2FsbGJhY2ssIFJlYWRMYXN0Q29uZmlybWVk\nQ2FsbGJhY2sgewoKICAgIC8vIERlcGVuZGluZyBvbiB0aGUgdGFzdGUsIHNl\nbGVjdCB0aGUgYW1vdW50IG9mIGxvZ2dpbmcKICAgIC8vIGJ5IGRlY29tbWVu\ndGluZyBvbmUgb2YgdGhlIHR3byBsaW5lcyBiZWxvdwogICAgLy8gc3RhdGlj\nIExvZ2dlciBMT0cgPSBMb2dnZXIuZ2V0Um9vdExvZ2dlcigpOwogICAgc3Rh\ndGljIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihCb29r\naWVSZWFkV3JpdGVUZXN0LmNsYXNzKTsKCiAgICBieXRlW10gbGVkZ2VyUGFz\nc3dvcmQgPSAiYWFhIi5nZXRCeXRlcygpOwogICAgTGVkZ2VySGFuZGxlIGxo\nLCBsaDI7CiAgICBsb25nIGxlZGdlcklkOwogICAgRW51bWVyYXRpb248TGVk\nZ2VyRW50cnk+IGxzOwoKICAgIC8vIHRlc3QgcmVsYXRlZCB2YXJpYWJsZXMK\nICAgIGludCBudW1FbnRyaWVzVG9Xcml0ZSA9IDIwMDsKICAgIGludCBtYXhJ\nbnQgPSAyMTQ3NDgzNjQ3OwogICAgUmFuZG9tIHJuZzsgLy8gUmFuZG9tIE51\nbWJlciBHZW5lcmF0b3IKICAgIEFycmF5TGlzdDxieXRlW10+IGVudHJpZXM7\nIC8vIGdlbmVyYXRlZCBlbnRyaWVzCiAgICBBcnJheUxpc3Q8SW50ZWdlcj4g\nZW50cmllc1NpemU7CgogICAgRGlnZXN0VHlwZSBkaWdlc3RUeXBlOwoKICAg\nIHB1YmxpYyBCb29raWVSZWFkV3JpdGVUZXN0KERpZ2VzdFR5cGUgZGlnZXN0\nVHlwZSkgewogICAgICAgIHN1cGVyKDMpOwogICAgICAgIHRoaXMuZGlnZXN0\nVHlwZSA9IGRpZ2VzdFR5cGU7CiAgICB9CiAgICAvLyBTeW5jaHJvbml6YXRp\nb24KICAgIFN5bmNPYmogc3luYzsKICAgIFNldDxPYmplY3Q+IHN5bmNPYmpz\nOwoKICAgIGNsYXNzIFN5bmNPYmogewogICAgICAgIGxvbmcgbGFzdENvbmZp\ncm1lZDsKICAgICAgICB2b2xhdGlsZSBpbnQgY291bnRlcjsKICAgICAgICBi\nb29sZWFuIHZhbHVlOwoKICAgICAgICBwdWJsaWMgU3luY09iaigpIHsKICAg\nICAgICAgICAgY291bnRlciA9IDA7CiAgICAgICAgICAgIGxhc3RDb25maXJt\nZWQgPSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9JRDsKICAgICAgICAg\nICAgdmFsdWUgPSBmYWxzZTsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3QK\nICAgIHB1YmxpYyB2b2lkIHRlc3RPcGVuRXhjZXB0aW9uKCkgdGhyb3dzIEtl\nZXBlckV4Y2VwdGlvbiwgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0\naW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBsaCA9IGJrYy5vcGVu\nTGVkZ2VyKDAsIGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAg\nICAgICAgZmFpbCgiSGF2ZW4ndCB0aHJvd24gZXhjZXB0aW9uIik7CiAgICAg\nICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cu\nd2FybigiU3VjY2Vzc2Z1bGx5IHRocm93biBhbmQgY2F1Z2h0IGV4Y2VwdGlv\nbjoiLCBlKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAgKiB0ZXN0\nIHRoZSBzdHJlYW1pbmcgYXBpIGZvciByZWFkaW5nIGFuZCB3cml0aW5nCiAg\nICAgKgogICAgICogQHRocm93cyB7QGxpbmsgSU9FeGNlcHRpb259LCB7QGxp\nbmsgS2VlcGVyRXhjZXB0aW9ufQogICAgICovCiAgICBAVGVzdAogICAgcHVi\nbGljIHZvaWQgdGVzdFN0cmVhbWluZ0NsaWVudHMoKSB0aHJvd3MgSU9FeGNl\ncHRpb24sIEtlZXBlckV4Y2VwdGlvbiwgQktFeGNlcHRpb24sIEludGVycnVw\ndGVkRXhjZXB0aW9uIHsKICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIo\nZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgIC8vIHdyaXRl\nIGEgc3RyaW5nIHNvIHRoYXQgd2UgY25hCiAgICAgICAgLy8gY3JlYXRlIGEg\nYnVmZmVyIG9mIGEgc2luZ2xlIGJ5dGVzCiAgICAgICAgLy8gYW5kIGNoZWNr\nIGZvciBjb3JuZXIgY2FzZXMKICAgICAgICBTdHJpbmcgdG9Xcml0ZSA9ICJ3\nZSBuZWVkIHRvIGNoZWNrIGZvciB0aGlzIHN0cmluZyB0byBtYXRjaCAiICsg\nImFuZCBmb3IgdGhlIHJlY29yZCBtYWhhZGV2IGlzIHRoZSBiZXN0IjsKICAg\nICAgICBMZWRnZXJPdXRwdXRTdHJlYW0gbG91dCA9IG5ldyBMZWRnZXJPdXRw\ndXRTdHJlYW0obGgsIDEpOwogICAgICAgIGJ5dGVbXSBiID0gdG9Xcml0ZS5n\nZXRCeXRlcygpOwogICAgICAgIGxvdXQud3JpdGUoYik7CiAgICAgICAgbG91\ndC5jbG9zZSgpOwogICAgICAgIGxvbmcgbElkID0gbGguZ2V0SWQoKTsKICAg\nICAgICBsaC5jbG9zZSgpOwogICAgICAgIC8vIGNoZWNrIGZvciBzYW5pdHkK\nICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxJZCwgZGlnZXN0VHlwZSwg\nbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgIExlZGdlcklucHV0U3RyZWFtIGxp\nbiA9IG5ldyBMZWRnZXJJbnB1dFN0cmVhbShsaCwgMSk7CiAgICAgICAgYnl0\nZVtdIGJyZWFkID0gbmV3IGJ5dGVbYi5sZW5ndGhdOwogICAgICAgIGludCBy\nZWFkID0gMDsKICAgICAgICB3aGlsZSAocmVhZCA8IGIubGVuZ3RoKSB7CiAg\nICAgICAgICAgIHJlYWQgPSByZWFkICsgbGluLnJlYWQoYnJlYWQsIHJlYWQs\nIGIubGVuZ3RoKTsKICAgICAgICB9CgogICAgICAgIFN0cmluZyBuZXdTdHJp\nbmcgPSBuZXcgU3RyaW5nKGJyZWFkKTsKICAgICAgICBhc3NlcnRUcnVlKCJ0\naGVzZSB0d28gc2hvdWxkIHNhbWUiLCB0b1dyaXRlLmVxdWFscyhuZXdTdHJp\nbmcpKTsKICAgICAgICBsaW4uY2xvc2UoKTsKICAgICAgICBsaC5jbG9zZSgp\nOwogICAgICAgIC8vIGNyZWF0ZSBhbm90aGVyIGxlZGdlciB0byB3cml0ZSBv\nbmUgYnl0ZSBhdCBhIHRpbWUKICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRn\nZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgIGxvdXQg\nPSBuZXcgTGVkZ2VyT3V0cHV0U3RyZWFtKGxoKTsKICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IGIubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgbG91\ndC53cml0ZShiW2ldKTsKICAgICAgICB9CiAgICAgICAgbG91dC5jbG9zZSgp\nOwogICAgICAgIGxJZCA9IGxoLmdldElkKCk7CiAgICAgICAgbGguY2xvc2Uo\nKTsKICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxJZCwgZGlnZXN0VHlw\nZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgIGxpbiA9IG5ldyBMZWRnZXJJ\nbnB1dFN0cmVhbShsaCk7CiAgICAgICAgYnJlYWQgPSBuZXcgYnl0ZVtiLmxl\nbmd0aF07CiAgICAgICAgcmVhZCA9IDA7CiAgICAgICAgd2hpbGUgKHJlYWQg\nPCBiLmxlbmd0aCkgewogICAgICAgICAgICByZWFkID0gcmVhZCArIGxpbi5y\nZWFkKGJyZWFkLCByZWFkLCBiLmxlbmd0aCk7CiAgICAgICAgfQogICAgICAg\nIG5ld1N0cmluZyA9IG5ldyBTdHJpbmcoYnJlYWQpOwogICAgICAgIGFzc2Vy\ndFRydWUoInRoZXNlIHR3byBzaG91bGQgYmUgc2FtZSAiLCB0b1dyaXRlLmVx\ndWFscyhuZXdTdHJpbmcpKTsKICAgICAgICBsaW4uY2xvc2UoKTsKICAgICAg\nICBsaC5jbG9zZSgpOwogICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9p\nZCB0ZXN0UmVhZFdyaXRlQXN5bmNTaW5nbGVDbGllbnQoKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENyZWF0\nZSBhIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIo\nZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBi\na2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVk\nZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVk\nZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAg\nICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGUoNCk7CiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJ\nbnQobWF4SW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigw\nKTsKCiAgICAgICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgp\nKTsKICAgICAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5hcnJh\neSgpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5hc3luY0FkZEVudHJ5\nKGVudHJ5LmFycmF5KCksIHRoaXMsIHN5bmMpOwogICAgICAgICAgICB9Cgog\nICAgICAgICAgICAvLyB3YWl0IGZvciBhbGwgZW50cmllcyB0byBiZSBhY2tu\nb3dsZWRnZWQKICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAg\nICAgICAgICAgICAgICB3aGlsZSAoc3luYy5jb3VudGVyIDwgbnVtRW50cmll\nc1RvV3JpdGUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkVu\ndHJpZXMgY291bnRlciA9ICIgKyBzeW5jLmNvdW50ZXIpOwogICAgICAgICAg\nICAgICAgICAgIHN5bmMud2FpdCgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBMT0cuZGVidWcoIioqKiBXUklURSBD\nT01QTEVURSAqKioiKTsKICAgICAgICAgICAgLy8gY2xvc2UgbGVkZ2VyCiAg\nICAgICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgICAgICAvLyAqKiogV1JJ\nVElORyBQQVJUIENPTVBMRVRFIC8vIFJFQUQgUEFSVCBCRUdJTlMgKioqCgog\nICAgICAgICAgICAvLyBvcGVuIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJr\nYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNz\nd29yZCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiTnVtYmVyIG9mIGVudHJp\nZXMgd3JpdHRlbjogIiArIChsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgKyAx\nKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZlcmlmeWluZyBudW1iZXIg\nb2YgZW50cmllcyB3cml0dGVuIiwgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgp\nID09IChudW1FbnRyaWVzVG9Xcml0ZSAtIDEpKTsKCiAgICAgICAgICAgIC8v\nIHJlYWQgZW50cmllcwogICAgICAgICAgICBsaC5hc3luY1JlYWRFbnRyaWVz\nKDAsIG51bUVudHJpZXNUb1dyaXRlIC0gMSwgdGhpcywgKE9iamVjdCkgc3lu\nYyk7CgogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAg\nICAgICAgICAgIHdoaWxlIChzeW5jLnZhbHVlID09IGZhbHNlKSB7CiAgICAg\nICAgICAgICAgICAgICAgc3luYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFJF\nQUQgQ09NUExFVEUgKioqIik7CgogICAgICAgICAgICAvLyBhdCB0aGlzIHBv\naW50LCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMgaXMgZmlsbGVkIHdp\ndGggdGhlIHJldHVybmVkCiAgICAgICAgICAgIC8vIHZhbHVlcwogICAgICAg\nICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxlIChscy5oYXNNb3Jl\nRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBvcmln\nYmIgPSBCeXRlQnVmZmVyLndyYXAoZW50cmllcy5nZXQoaSkpOwogICAgICAg\nICAgICAgICAgSW50ZWdlciBvcmlnRW50cnkgPSBvcmlnYmIuZ2V0SW50KCk7\nCiAgICAgICAgICAgICAgICBieXRlW10gZW50cnkgPSBscy5uZXh0RWxlbWVu\ndCgpLmdldEVudHJ5KCk7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIHJl\nc3VsdCA9IEJ5dGVCdWZmZXIud3JhcChlbnRyeSk7CiAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIkxlbmd0aCBvZiByZXN1bHQ6ICIgKyByZXN1bHQuY2Fw\nYWNpdHkoKSk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIk9yaWdpbmFs\nIGVudHJ5OiAiICsgb3JpZ0VudHJ5KTsKCiAgICAgICAgICAgICAgICBJbnRl\nZ2VyIHJldHJFbnRyeSA9IHJlc3VsdC5nZXRJbnQoKTsKICAgICAgICAgICAg\nICAgIExPRy5kZWJ1ZygiUmV0cmlldmVkIGVudHJ5OiAiICsgcmV0ckVudHJ5\nKTsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIGVudHJ5\nICIgKyBpICsgIiBmb3IgZXF1YWxpdHkiLCBvcmlnRW50cnkuZXF1YWxzKHJl\ndHJFbnRyeSkpOwogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiQ2hlY2tp\nbmcgZW50cnkgIiArIGkgKyAiIGZvciBzaXplIiwgZW50cnkubGVuZ3RoID09\nIGVudHJpZXNTaXplLmdldChpKS5pbnRWYWx1ZSgpKTsKICAgICAgICAgICAg\nICAgIGkrKzsKICAgICAgICAgICAgfQogICAgICAgICAgICBhc3NlcnRUcnVl\nKCJDaGVja2luZyBudW1iZXIgb2YgcmVhZCBlbnRyaWVzIiwgaSA9PSBudW1F\nbnRyaWVzVG9Xcml0ZSk7CgogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAg\nICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJU\nZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAg\nICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAg\nICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwog\nICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIENoZWNrIHRoYXQgdGhl\nIGFkZCBhcGkgd2l0aCBvZmZzZXQgYW5kIGxlbmd0aCB3b3JrIGNvcnJlY3Rs\neS4KICAgICAqIEZpcnN0IHRyeSB2YXJ5aW5nIHRoZSBvZmZzZXQuIFRoZW4g\ndGhlIGxlbmd0aCB3aXRoIGEgZml4ZWQgbm9uLXplcm8KICAgICAqIG9mZnNl\ndC4KICAgICAqLwogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFk\nV3JpdGVSYW5nZUFzeW5jU2luZ2xlQ2xpZW50KCkgdGhyb3dzIElPRXhjZXB0\naW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBs\nZWRnZXIKICAgICAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2Vz\ndFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgLy8gYmtjLmlu\naXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAgICAgICAgICAgIGxlZGdlcklk\nID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxlZGdlciBJ\nRDogIiArIGxoLmdldElkKCkpOwogICAgICAgICAgICBieXRlIGJ5dGVzW10g\nPSB7J2EnLCdiJywnYycsJ2QnLCdlJywnZicsJ2cnLCdoJywnaSd9OwoKICAg\nICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywgMCwgYnl0ZXMubGVu\nZ3RoLCB0aGlzLCBzeW5jKTsKICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRy\neShieXRlcywgMCwgNCwgdGhpcywgc3luYyk7IC8vIGFiY2QKICAgICAgICAg\nICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywgMywgNCwgdGhpcywgc3luYyk7\nIC8vIGRlZmcKICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywg\nMywgKGJ5dGVzLmxlbmd0aC0zKSwgdGhpcywgc3luYyk7IC8vIGRlZmdoaQog\nICAgICAgICAgICBpbnQgbnVtRW50cmllcyA9IDQ7CgogICAgICAgICAgICAv\nLyB3YWl0IGZvciBhbGwgZW50cmllcyB0byBiZSBhY2tub3dsZWRnZWQKICAg\nICAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAg\nICB3aGlsZSAoc3luYy5jb3VudGVyIDwgbnVtRW50cmllcykgewogICAgICAg\nICAgICAgICAgICAgIExPRy5kZWJ1ZygiRW50cmllcyBjb3VudGVyID0gIiAr\nIHN5bmMuY291bnRlcik7CiAgICAgICAgICAgICAgICAgICAgc3luYy53YWl0\nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIHRyeSB7CiAgICAgICAgICAgICAgICBsaC5hc3luY0FkZEVudHJ5KGJ5\ndGVzLCAtMSwgYnl0ZXMubGVuZ3RoLCB0aGlzLCBzeW5jKTsKICAgICAgICAg\nICAgICAgIGZhaWwoIlNob3VsZG4ndCBiZSBhYmxlIHRvIHVzZSBuZWdhdGl2\nZSBvZmZzZXQiKTsKICAgICAgICAgICAgfSBjYXRjaCAoQXJyYXlJbmRleE91\ndE9mQm91bmRzRXhjZXB0aW9uIGFpb2IpIHsKICAgICAgICAgICAgICAgIC8v\nIGV4cGVjdGVkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5IHsKICAg\nICAgICAgICAgICAgIGxoLmFzeW5jQWRkRW50cnkoYnl0ZXMsIDAsIGJ5dGVz\nLmxlbmd0aCsxLCB0aGlzLCBzeW5jKTsKICAgICAgICAgICAgICAgIGZhaWwo\nIlNob3VsZG4ndCBiZSBhYmxlIHRvIHVzZSB0aGF0IG11Y2ggbGVuZ3RoIik7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEFycmF5SW5kZXhPdXRPZkJvdW5kc0V4\nY2VwdGlvbiBhaW9iKSB7CiAgICAgICAgICAgICAgICAvLyBleHBlY3RlZAog\nICAgICAgICAgICB9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAg\nICBsaC5hc3luY0FkZEVudHJ5KGJ5dGVzLCAtMSwgYnl0ZXMubGVuZ3RoKzIs\nIHRoaXMsIHN5bmMpOwogICAgICAgICAgICAgICAgZmFpbCgiU2hvdWxkbid0\nIGJlIGFibGUgdG8gdXNlIG5lZ2F0aXZlIG9mZnNldCAiCiAgICAgICAgICAg\nICAgICAgICAgICsgIndpdGggdGhhdCBtdWNoIGxlbmd0aCIpOwogICAgICAg\nICAgICB9IGNhdGNoIChBcnJheUluZGV4T3V0T2ZCb3VuZHNFeGNlcHRpb24g\nYWlvYikgewogICAgICAgICAgICAgICAgLy8gZXhwZWN0ZWQKICAgICAgICAg\nICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgbGguYXN5\nbmNBZGRFbnRyeShieXRlcywgNCwgLTMsIHRoaXMsIHN5bmMpOwogICAgICAg\nICAgICAgICAgZmFpbCgiU2hvdWxkbid0IGJlIGFibGUgdG8gdXNlIG5lZ2F0\naXZlIGxlbmd0aCIpOwogICAgICAgICAgICB9IGNhdGNoIChBcnJheUluZGV4\nT3V0T2ZCb3VuZHNFeGNlcHRpb24gYWlvYikgewogICAgICAgICAgICAgICAg\nLy8gZXhwZWN0ZWQKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShieXRlcywgLTQsIC0z\nLCB0aGlzLCBzeW5jKTsKICAgICAgICAgICAgICAgIGZhaWwoIlNob3VsZG4n\ndCBiZSBhYmxlIHRvIHVzZSBuZWdhdGl2ZSBvZmZzZXQgJiBsZW5ndGgiKTsK\nICAgICAgICAgICAgfSBjYXRjaCAoQXJyYXlJbmRleE91dE9mQm91bmRzRXhj\nZXB0aW9uIGFpb2IpIHsKICAgICAgICAgICAgICAgIC8vIGV4cGVjdGVkCiAg\nICAgICAgICAgIH0KCgogICAgICAgICAgICBMT0cuZGVidWcoIioqKiBXUklU\nRSBDT01QTEVURSAqKioiKTsKICAgICAgICAgICAgLy8gY2xvc2UgbGVkZ2Vy\nCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CgogICAgICAgICAgICAvLyAqKiog\nV1JJVElORyBQQVJUIENPTVBMRVRFIC8vIFJFQUQgUEFSVCBCRUdJTlMgKioq\nCgogICAgICAgICAgICAvLyBvcGVuIGxlZGdlcgogICAgICAgICAgICBsaCA9\nIGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQ\nYXNzd29yZCk7CiAgICAgICAgICAgIExPRy5kZWJ1ZygiTnVtYmVyIG9mIGVu\ndHJpZXMgd3JpdHRlbjogIiArIChsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkg\nKyAxKSk7CiAgICAgICAgICAgIGFzc2VydFRydWUoIlZlcmlmeWluZyBudW1i\nZXIgb2YgZW50cmllcyB3cml0dGVuIiwKICAgICAgICAgICAgICAgICAgICAg\nICBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgPT0gKG51bUVudHJpZXMgLSAx\nKSk7CgogICAgICAgICAgICAvLyByZWFkIGVudHJpZXMKICAgICAgICAgICAg\nbGguYXN5bmNSZWFkRW50cmllcygwLCBudW1FbnRyaWVzIC0gMSwgdGhpcywg\nKE9iamVjdCkgc3luYyk7CgogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5\nbmMpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChzeW5jLnZhbHVlID09IGZh\nbHNlKSB7CiAgICAgICAgICAgICAgICAgICAgc3luYy53YWl0KCk7CiAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIExPRy5k\nZWJ1ZygiKioqIFJFQUQgQ09NUExFVEUgKioqIik7CgogICAgICAgICAgICAv\nLyBhdCB0aGlzIHBvaW50LCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMg\naXMgZmlsbGVkIHdpdGggdGhlIHJldHVybmVkCiAgICAgICAgICAgIC8vIHZh\nbHVlcwogICAgICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxl\nIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgYnl0\nZVtdIGV4cGVjdGVkID0gbnVsbDsKICAgICAgICAgICAgICAgIGJ5dGVbXSBl\nbnRyeSA9IGxzLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKTsKCiAgICAgICAg\nICAgICAgICBzd2l0Y2ggKGkpIHsKICAgICAgICAgICAgICAgIGNhc2UgMDoK\nICAgICAgICAgICAgICAgICAgICBleHBlY3RlZCA9IEFycmF5cy5jb3B5T2ZS\nYW5nZShieXRlcywgMCwgYnl0ZXMubGVuZ3RoKTsKICAgICAgICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAg\nICAgICAgICAgICBleHBlY3RlZCA9IEFycmF5cy5jb3B5T2ZSYW5nZShieXRl\ncywgMCwgNCk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQg\nPSBBcnJheXMuY29weU9mUmFuZ2UoYnl0ZXMsIDMsIDMrNCk7CiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICBjYXNlIDM6CiAg\nICAgICAgICAgICAgICAgICAgZXhwZWN0ZWQgPSBBcnJheXMuY29weU9mUmFu\nZ2UoYnl0ZXMsIDMsIDMrKGJ5dGVzLmxlbmd0aC0zKSk7CiAgICAgICAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICBhc3NlcnROb3ROdWxsKCJUaGVyZSBhcmUgbW9yZSBjaGVja3MgdGhh\nbiB3cml0ZXMiLCBleHBlY3RlZCk7CgogICAgICAgICAgICAgICAgU3RyaW5n\nIG1lc3NhZ2UgPSAiQ2hlY2tpbmcgZW50cnkgIiArIGkgKyAiIGZvciBlcXVh\nbGl0eSBbIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIG5l\ndyBTdHJpbmcoZW50cnksICJVVEYtOCIpICsgIiwiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICsgbmV3IFN0cmluZyhleHBlY3RlZCwgIlVU\nRi04IikgKyAiXSI7CiAgICAgICAgICAgICAgICBhc3NlcnRUcnVlKG1lc3Nh\nZ2UsIEFycmF5cy5lcXVhbHMoZW50cnksIGV4cGVjdGVkKSk7CgogICAgICAg\nICAgICAgICAgaSsrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2Vy\ndFRydWUoIkNoZWNraW5nIG51bWJlciBvZiByZWFkIGVudHJpZXMiLCBpID09\nIG51bUVudHJpZXMpOwoKICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAg\nICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5l\ncnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVz\ndCBmYWlsZWQgZHVlIHRvIEJvb2tLZWVwZXIgZXhjZXB0aW9uIik7CiAgICAg\nICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAg\nICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAg\nIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBpbnRlcnJ1cHRpb24iKTsKICAg\nICAgICB9CiAgICB9CgogICAgY2xhc3MgVGhyb3R0bGVUZXN0Q2FsbGJhY2sg\naW1wbGVtZW50cyBSZWFkQ2FsbGJhY2sgewogICAgICAgIGludCB0aHJvdHRs\nZTsKCiAgICAgICAgVGhyb3R0bGVUZXN0Q2FsbGJhY2soaW50IHRocmVzaG9s\nZCkgewogICAgICAgICAgICB0aGlzLnRocm90dGxlID0gdGhyZXNob2xkOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcmVhZENvbXBsZXRlKGlu\ndCByYywgTGVkZ2VySGFuZGxlIGxoLCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRy\neT4gc2VxLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIGlmKHJjICE9IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgIGZhaWwoIlJl\ndHVybiBjb2RlIGlzIG5vdCBPSzogIiArIHJjKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgbHMgPSBzZXE7CiAgICAgICAgICAgIHN5bmNocm9uaXpl\nZChzeW5jKSB7CiAgICAgICAgICAgICAgICBzeW5jLmNvdW50ZXIgKz0gdGhy\nb3R0bGU7CiAgICAgICAgICAgICAgICBzeW5jLm5vdGlmeSgpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIExPRy5pbmZvKCJDdXJyZW50IGNvdW50ZXI6\nICIgKyBzeW5jLmNvdW50ZXIpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIE1ldGhvZCBmb3Igb2J0YWluaW5nIHRoZSBhdmFpbGFibGUgcGVy\nbWl0cyBvZiBhIGxlZGdlciBoYW5kbGUKICAgICAqIHVzaW5nIHJlZmxlY3Rp\nb24gdG8gYXZvaWQgYWRkaW5nIGEgbmV3IHB1YmxpYyBtZXRob2QgdG8gdGhl\nCiAgICAgKiBjbGFzcy4KICAgICAqCiAgICAgKiBAcGFyYW0gbGgKICAgICAq\nIEByZXR1cm4KICAgICAqLwogICAgQFN1cHByZXNzV2FybmluZ3MoInVuY2hl\nY2tlZCIpCiAgICBpbnQgZ2V0QXZhaWxhYmxlUGVybWl0cyhMZWRnZXJIYW5k\nbGUgbGgpIHRocm93cwogICAgICAgIE5vU3VjaEZpZWxkRXhjZXB0aW9uLCBJ\nbGxlZ2FsQWNjZXNzRXhjZXB0aW9uCiAgICB7CiAgICAgICAgRmllbGQgZmll\nbGQgPSBMZWRnZXJIYW5kbGUuY2xhc3MuZ2V0RGVjbGFyZWRGaWVsZCgib3BD\nb3VudGVyU2VtIik7CiAgICAgICAgZmllbGQuc2V0QWNjZXNzaWJsZSh0cnVl\nKTsKICAgICAgICByZXR1cm4gKChTZW1hcGhvcmUpZmllbGQuZ2V0KGxoKSku\nYXZhaWxhYmxlUGVybWl0cygpOwogICAgfQoKICAgIEBUZXN0CiAgICBwdWJs\naWMgdm9pZCB0ZXN0UmVhZFdyaXRlQXN5bmNTaW5nbGVDbGllbnRUaHJvdHRs\nZSgpIHRocm93cwogICAgICAgIElPRXhjZXB0aW9uLCBOb1N1Y2hGaWVsZEV4\nY2VwdGlvbiwgSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbiB7CiAgICAgICAgdHJ5\nIHsKCiAgICAgICAgICAgIEludGVnZXIgdGhyb3R0bGUgPSAxMDA7CiAgICAg\nICAgICAgIFRocm90dGxlVGVzdENhbGxiYWNrIHRjYiA9IG5ldyBUaHJvdHRs\nZVRlc3RDYWxsYmFjayh0aHJvdHRsZSk7CiAgICAgICAgICAgIC8vIENyZWF0\nZSBhIGxlZGdlcgogICAgICAgICAgICBia2MuZ2V0Q29uZigpLnNldFRocm90\ndGxlVmFsdWUodGhyb3R0bGUpOwogICAgICAgICAgICBsaCA9IGJrYy5jcmVh\ndGVMZWRnZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAg\nICAgICAvLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAg\nICAgICAgbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cu\naW5mbygiTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CgogICAgICAgICAg\nICBudW1FbnRyaWVzVG9Xcml0ZSA9IDgwMDA7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgKG51bUVudHJpZXNUb1dyaXRlIC0gMjAwMCk7IGkr\nKykgewogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVC\ndWZmZXIuYWxsb2NhdGUoNCk7CiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJ\nbnQocm5nLm5leHRJbnQobWF4SW50KSk7CiAgICAgICAgICAgICAgICBlbnRy\neS5wb3NpdGlvbigwKTsKCiAgICAgICAgICAgICAgICBlbnRyaWVzLmFkZChl\nbnRyeS5hcnJheSgpKTsKICAgICAgICAgICAgICAgIGVudHJpZXNTaXplLmFk\nZChlbnRyeS5hcnJheSgpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5h\nc3luY0FkZEVudHJ5KGVudHJ5LmFycmF5KCksIHRoaXMsIHN5bmMpOwogICAg\nICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIENoZWNrIHRoYXQg\ndGhlIGRpZmZlcmVuY2UgaXMgbm8gbGFyZ2VyIHRoYW4gdGhlIHRocm90dGxp\nbmcgdGhyZXNob2xkCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAg\nICAgIGludCB0ZXN0VmFsdWUgPSBnZXRBdmFpbGFibGVQZXJtaXRzKGxoKTsK\nICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIkRpZmZlcmVuY2UgaXMgaW5j\nb3JyZWN0IDogIiArIGkgKyAiLCAiICsgc3luYy5jb3VudGVyICsgIiwgIiAr\nIHRlc3RWYWx1ZSwgdGVzdFZhbHVlIDw9IHRocm90dGxlKTsKICAgICAgICAg\nICAgfQoKCiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgMjAwMDsg\naSsrKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIGVudHJ5ID0gQnl0\nZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICAgICAgICAgIGVudHJ5LnB1\ndEludChybmcubmV4dEludChtYXhJbnQpKTsKICAgICAgICAgICAgICAgIGVu\ndHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAgICAgICAgIGVudHJpZXMuYWRk\nKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICAgICAgZW50cmllc1NpemUu\nYWRkKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGxo\nLmFzeW5jQWRkRW50cnkoZW50cnkuYXJyYXkoKSwgdGhpcywgc3luYyk7Cgog\nICAgICAgICAgICAgICAgLyoKICAgICAgICAgICAgICAgICAqIENoZWNrIHRo\nYXQgdGhlIGRpZmZlcmVuY2UgaXMgbm8gbGFyZ2VyIHRoYW4gdGhlIHRocm90\ndGxpbmcgdGhyZXNob2xkCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAg\nICAgICAgIGludCB0ZXN0VmFsdWUgPSBnZXRBdmFpbGFibGVQZXJtaXRzKGxo\nKTsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIkRpZmZlcmVuY2UgaXMg\naW5jb3JyZWN0IDogIiArIGkgKyAiLCAiICsgc3luYy5jb3VudGVyICsgIiwg\nIiArIHRlc3RWYWx1ZSwgdGVzdFZhbHVlIDw9IHRocm90dGxlKTsKICAgICAg\nICAgICAgfQoKICAgICAgICAgICAgLy8gd2FpdCBmb3IgYWxsIGVudHJpZXMg\ndG8gYmUgYWNrbm93bGVkZ2VkCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAo\nc3luYykgewogICAgICAgICAgICAgICAgd2hpbGUgKHN5bmMuY291bnRlciA8\nIG51bUVudHJpZXNUb1dyaXRlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9H\nLmRlYnVnKCJFbnRyaWVzIGNvdW50ZXIgPSAiICsgc3luYy5jb3VudGVyKTsK\nICAgICAgICAgICAgICAgICAgICBzeW5jLndhaXQoKTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgTE9HLmRlYnVnKCIq\nKiogV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAgICAgICAgIC8vIGNsb3Nl\nIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgpOwoKICAgICAgICAgICAg\nLy8gKioqIFdSSVRJTkcgUEFSVCBDT01QTEVURSAvLyBSRUFEIFBBUlQgQkVH\nSU5TICoqKgoKICAgICAgICAgICAgLy8gb3BlbiBsZWRnZXIKICAgICAgICAg\nICAgbGggPSBia2Mub3BlbkxlZGdlcihsZWRnZXJJZCwgZGlnZXN0VHlwZSwg\nbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICBMT0cuZGVidWcoIk51bWJl\nciBvZiBlbnRyaWVzIHdyaXR0ZW46ICIgKyAobGguZ2V0TGFzdEFkZENvbmZp\ncm1lZCgpICsgMSkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJWZXJpZnlp\nbmcgbnVtYmVyIG9mIGVudHJpZXMgd3JpdHRlbiIsIGxoLmdldExhc3RBZGRD\nb25maXJtZWQoKSA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAxKSk7CgogICAg\nICAgICAgICAvLyByZWFkIGVudHJpZXMKICAgICAgICAgICAgc3luYy5jb3Vu\ndGVyID0gMDsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1F\nbnRyaWVzVG9Xcml0ZTsgaSs9dGhyb3R0bGUpIHsKICAgICAgICAgICAgICAg\nIGxoLmFzeW5jUmVhZEVudHJpZXMoaSwgaSArIHRocm90dGxlIC0gMSwgdGNi\nLCAoT2JqZWN0KSBzeW5jKTsKICAgICAgICAgICAgICAgIGludCB0ZXN0VmFs\ndWUgPSBnZXRBdmFpbGFibGVQZXJtaXRzKGxoKTsKICAgICAgICAgICAgICAg\nIGFzc2VydFRydWUoIkRpZmZlcmVuY2UgaXMgaW5jb3JyZWN0IDogIiArIGkg\nKyAiLCAiICsgc3luYy5jb3VudGVyICsgIiwgIiArIHRlc3RWYWx1ZSwgdGVz\ndFZhbHVlIDw9IHRocm90dGxlKTsKICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgc3luY2hyb25pemVkIChzeW5jKSB7CiAgICAgICAgICAgICAgICB3aGls\nZSAoc3luYy5jb3VudGVyIDwgbnVtRW50cmllc1RvV3JpdGUpIHsKICAgICAg\nICAgICAgICAgICAgICBMT0cuaW5mbygiRW50cmllcyBjb3VudGVyID0gIiAr\nIHN5bmMuY291bnRlcik7CiAgICAgICAgICAgICAgICAgICAgc3luYy53YWl0\nKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIExPRy5kZWJ1ZygiKioqIFJFQUQgQ09NUExFVEUgKioqIik7CgogICAg\nICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIs\nIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9v\na0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1\ncHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVz\ndCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQg\nZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAgIH0KCiAgICBA\nVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFN5bmNSZWFkQXN5bmNXcml0ZVN0\ncmluZ3NTaW5nbGVDbGllbnQoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIExPRy5pbmZvKCJURVNUIFJFQUQgV1JJVEUgU1RSSU5HUyBNSVhFRCBT\nSU5HTEUgQ0xJRU5UIik7CiAgICAgICAgU3RyaW5nIGNoYXJzZXQgPSAidXRm\nLTgiOwogICAgICAgIExPRy5kZWJ1ZygiRGVmYXVsdCBjaGFyc2V0OiAiICsg\nQ2hhcnNldC5kZWZhdWx0Q2hhcnNldCgpKTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBi\na2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsK\nICAgICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7\nCiAgICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAg\nICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdldElkKCkpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJpZXNUb1dyaXRl\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGludCByYW5kb21JbnQgPSBybmcu\nbmV4dEludChtYXhJbnQpOwogICAgICAgICAgICAgICAgYnl0ZVtdIGVudHJ5\nID0gbmV3IFN0cmluZyhJbnRlZ2VyLnRvU3RyaW5nKHJhbmRvbUludCkpLmdl\ndEJ5dGVzKGNoYXJzZXQpOwogICAgICAgICAgICAgICAgZW50cmllcy5hZGQo\nZW50cnkpOwogICAgICAgICAgICAgICAgbGguYXN5bmNBZGRFbnRyeShlbnRy\neSwgdGhpcywgc3luYyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8v\nIHdhaXQgZm9yIGFsbCBlbnRyaWVzIHRvIGJlIGFja25vd2xlZGdlZAogICAg\nICAgICAgICBzeW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgICAg\nIHdoaWxlIChzeW5jLmNvdW50ZXIgPCBudW1FbnRyaWVzVG9Xcml0ZSkgewog\nICAgICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiRW50cmllcyBjb3VudGVy\nID0gIiArIHN5bmMuY291bnRlcik7CiAgICAgICAgICAgICAgICAgICAgc3lu\nYy53YWl0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIExPRy5kZWJ1ZygiKioqIEFTWU5DIFdSSVRFIENPTVBMRVRF\nICoqKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAg\nICAgbGguY2xvc2UoKTsKCiAgICAgICAgICAgIC8vICoqKiBXUklUSU5HIFBB\nUlQgQ09NUExFVEVEIC8vIFJFQUQgUEFSVCBCRUdJTlMgKioqCgogICAgICAg\nICAgICAvLyBvcGVuIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5vcGVu\nTGVkZ2VyKGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7\nCiAgICAgICAgICAgIExPRy5kZWJ1ZygiTnVtYmVyIG9mIGVudHJpZXMgd3Jp\ndHRlbjogIiArIChsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkgKyAxKSk7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoIlZlcmlmeWluZyBudW1iZXIgb2YgZW50\ncmllcyB3cml0dGVuIiwgbGguZ2V0TGFzdEFkZENvbmZpcm1lZCgpID09IChu\ndW1FbnRyaWVzVG9Xcml0ZSAtIDEpKTsKCiAgICAgICAgICAgIC8vIHJlYWQg\nZW50cmllcwogICAgICAgICAgICBscyA9IGxoLnJlYWRFbnRyaWVzKDAsIG51\nbUVudHJpZXNUb1dyaXRlIC0gMSk7CgogICAgICAgICAgICBMT0cuZGVidWco\nIioqKiBTWU5DIFJFQUQgQ09NUExFVEUgKioqIik7CgogICAgICAgICAgICAv\nLyBhdCB0aGlzIHBvaW50LCBFbnVtZXJhdGlvbjxMZWRnZXJFbnRyeT4gbHMg\naXMgZmlsbGVkIHdpdGggdGhlIHJldHVybmVkCiAgICAgICAgICAgIC8vIHZh\nbHVlcwogICAgICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxl\nIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgYnl0\nZVtdIG9yaWdFbnRyeUJ5dGVzID0gZW50cmllcy5nZXQoaSsrKTsKICAgICAg\nICAgICAgICAgIGJ5dGVbXSByZXRyRW50cnlCeXRlcyA9IGxzLm5leHRFbGVt\nZW50KCkuZ2V0RW50cnkoKTsKCiAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIk9yaWdpbmFsIGJ5dGUgZW50cnkgc2l6ZTogIiArIG9yaWdFbnRyeUJ5dGVz\nLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBMT0cuZGVidWcoIlNhdmVkIGJ5\ndGUgZW50cnkgc2l6ZTogIiArIHJldHJFbnRyeUJ5dGVzLmxlbmd0aCk7Cgog\nICAgICAgICAgICAgICAgU3RyaW5nIG9yaWdFbnRyeSA9IG5ldyBTdHJpbmco\nb3JpZ0VudHJ5Qnl0ZXMsIGNoYXJzZXQpOwogICAgICAgICAgICAgICAgU3Ry\naW5nIHJldHJFbnRyeSA9IG5ldyBTdHJpbmcocmV0ckVudHJ5Qnl0ZXMsIGNo\nYXJzZXQpOwoKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiT3JpZ2luYWwg\nZW50cnk6ICIgKyBvcmlnRW50cnkpOwogICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJSZXRyaWV2ZWQgZW50cnk6ICIgKyByZXRyRW50cnkpOwoKICAgICAg\nICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIGVudHJ5ICIgKyBpICsg\nIiBmb3IgZXF1YWxpdHkiLCBvcmlnRW50cnkuZXF1YWxzKHJldHJFbnRyeSkp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNr\naW5nIG51bWJlciBvZiByZWFkIGVudHJpZXMiLCBpID09IG51bUVudHJpZXNU\nb1dyaXRlKTsKCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfSBj\nYXRjaCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3Io\nIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFp\nbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0g\nY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWls\nKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAg\nfQoKICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFJlYWRX\ncml0ZVN5bmNTaW5nbGVDbGllbnQoKSB0aHJvd3MgSU9FeGNlcHRpb24gewog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENyZWF0ZSBhIGxlZGdlcgog\nICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIoZGlnZXN0VHlwZSwg\nbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBia2MuaW5pdE1lc3Nh\nZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVkZ2VySWQgPSBsaC5n\nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVkZ2VyIElEOiAiICsg\nbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAgICAgICAgQnl0\nZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAg\nICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJbnQobWF4SW50KSk7\nCiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigwKTsKICAgICAgICAg\nICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAg\nICAgICAgbGguYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgbGggPSBi\na2Mub3BlbkxlZGdlcihsZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFz\nc3dvcmQpOwogICAgICAgICAgICBMT0cuZGVidWcoIk51bWJlciBvZiBlbnRy\naWVzIHdyaXR0ZW46ICIgKyBsaC5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwog\nICAgICAgICAgICBhc3NlcnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVu\ndHJpZXMgd3JpdHRlbiIsIGxoLmdldExhc3RBZGRDb25maXJtZWQoKSA9PSAo\nbnVtRW50cmllc1RvV3JpdGUgLSAxKSk7CgogICAgICAgICAgICBscyA9IGxo\nLnJlYWRFbnRyaWVzKDAsIG51bUVudHJpZXNUb1dyaXRlIC0gMSk7CiAgICAg\nICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAgd2hpbGUgKGxzLmhhc01v\ncmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIG9y\naWdiYiA9IEJ5dGVCdWZmZXIud3JhcChlbnRyaWVzLmdldChpKyspKTsKICAg\nICAgICAgICAgICAgIEludGVnZXIgb3JpZ0VudHJ5ID0gb3JpZ2JiLmdldElu\ndCgpOwogICAgICAgICAgICAgICAgQnl0ZUJ1ZmZlciByZXN1bHQgPSBCeXRl\nQnVmZmVyLndyYXAobHMubmV4dEVsZW1lbnQoKS5nZXRFbnRyeSgpKTsKICAg\nICAgICAgICAgICAgIExPRy5kZWJ1ZygiTGVuZ3RoIG9mIHJlc3VsdDogIiAr\nIHJlc3VsdC5jYXBhY2l0eSgpKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1\nZygiT3JpZ2luYWwgZW50cnk6ICIgKyBvcmlnRW50cnkpOwoKICAgICAgICAg\nICAgICAgIEludGVnZXIgcmV0ckVudHJ5ID0gcmVzdWx0LmdldEludCgpOwog\nICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJSZXRyaWV2ZWQgZW50cnk6ICIg\nKyByZXRyRW50cnkpOwogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiQ2hl\nY2tpbmcgZW50cnkgIiArIGkgKyAiIGZvciBlcXVhbGl0eSIsIG9yaWdFbnRy\neS5lcXVhbHMocmV0ckVudHJ5KSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgbGguY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsK\nICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIEJvb2tLZWVw\nZXIgZXhjZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFp\nbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0\nbyBpbnRlcnJ1cHRpb24iKTsKICAgICAgICB9CiAgICB9CgogICAgQFRlc3QK\nICAgIHB1YmxpYyB2b2lkIHRlc3RSZWFkV3JpdGVaZXJvKCkgdGhyb3dzIElP\nRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAgICAgICAvLyBDcmVh\ndGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2Vy\nKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgLy8g\nYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAgICAgICAgICAgIGxl\nZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAgTE9HLmluZm8oIkxl\nZGdlciBJRDogIiArIGxoLmdldElkKCkpOwogICAgICAgICAgICBmb3IgKGlu\ndCBpID0gMDsgaSA8IG51bUVudHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGxoLmFkZEVudHJ5KG5ldyBieXRlWzBdKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLyoKICAgICAgICAgICAgICogV3JpdGUgYSBu\nb24temVybyBlbnRyeQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgQnl0\nZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2NhdGUoNCk7CiAgICAg\nICAgICAgIGVudHJ5LnB1dEludChybmcubmV4dEludChtYXhJbnQpKTsKICAg\nICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CiAgICAgICAgICAgIGVudHJp\nZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICBsaC5hZGRFbnRy\neShlbnRyeS5hcnJheSgpKTsKCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAg\nICAgICAgICAgIGxoID0gYmtjLm9wZW5MZWRnZXIobGVkZ2VySWQsIGRpZ2Vz\ndFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAgICAgICAgICAgTE9HLmRlYnVn\nKCJOdW1iZXIgb2YgZW50cmllcyB3cml0dGVuOiAiICsgbGguZ2V0TGFzdEFk\nZENvbmZpcm1lZCgpKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiVmVyaWZ5\naW5nIG51bWJlciBvZiBlbnRyaWVzIHdyaXR0ZW4iLCBsaC5nZXRMYXN0QWRk\nQ29uZmlybWVkKCkgPT0gbnVtRW50cmllc1RvV3JpdGUpOwoKICAgICAgICAg\nICAgbHMgPSBsaC5yZWFkRW50cmllcygwLCBudW1FbnRyaWVzVG9Xcml0ZSAt\nIDEpOwogICAgICAgICAgICBpbnQgaSA9IDA7CiAgICAgICAgICAgIHdoaWxl\nIChscy5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgQnl0\nZUJ1ZmZlciByZXN1bHQgPSBCeXRlQnVmZmVyLndyYXAobHMubmV4dEVsZW1l\nbnQoKS5nZXRFbnRyeSgpKTsKICAgICAgICAgICAgICAgIExPRy5kZWJ1Zygi\nTGVuZ3RoIG9mIHJlc3VsdDogIiArIHJlc3VsdC5jYXBhY2l0eSgpKTsKCiAg\nICAgICAgICAgICAgICBhc3NlcnRUcnVlKCJDaGVja2luZyBpZiBlbnRyeSAi\nICsgaSArICIgaGFzIHplcm8gYnl0ZXMiLCByZXN1bHQuY2FwYWNpdHkoKSA9\nPSAwKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBsaC5jbG9zZSgpOwog\nICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWls\nKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsK\nICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAg\nICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIp\nOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQg\ndGVzdE11bHRpTGVkZ2VyKCkgdGhyb3dzIElPRXhjZXB0aW9uIHsKICAgICAg\nICB0cnkgewogICAgICAgICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAg\nICAgICAgbGggPSBia2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdl\nclBhc3N3b3JkKTsKICAgICAgICAgICAgbGgyID0gYmtjLmNyZWF0ZUxlZGdl\ncihkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CgogICAgICAgICAgICBs\nb25nIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAgbG9uZyBs\nZWRnZXJJZDIgPSBsaDIuZ2V0SWQoKTsKCiAgICAgICAgICAgIC8vIGJrYy5p\nbml0TWVzc2FnZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBMT0cuaW5m\nbygiTGVkZ2VyIElEIDE6ICIgKyBsaC5nZXRJZCgpICsgIiwgTGVkZ2VyIElE\nIDI6ICIgKyBsaDIuZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAgICAg\nICAgICAgbGguYWRkRW50cnkobmV3IGJ5dGVbMF0pOwogICAgICAgICAgICAg\nICAgbGgyLmFkZEVudHJ5KG5ldyBieXRlWzBdKTsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgbGgyLmNsb3Nl\nKCk7CgogICAgICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklk\nLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIGxo\nMiA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkMiwgZGlnZXN0VHlwZSwgbGVk\nZ2VyUGFzc3dvcmQpOwoKICAgICAgICAgICAgTE9HLmRlYnVnKCJOdW1iZXIg\nb2YgZW50cmllcyB3cml0dGVuOiAiICsgbGguZ2V0TGFzdEFkZENvbmZpcm1l\nZCgpICsgIiwgIiArIGxoMi5nZXRMYXN0QWRkQ29uZmlybWVkKCkpOwogICAg\nICAgICAgICBhc3NlcnRUcnVlKCJWZXJpZnlpbmcgbnVtYmVyIG9mIGVudHJp\nZXMgd3JpdHRlbiBsaCAoIiArIGxoLmdldExhc3RBZGRDb25maXJtZWQoKSAr\nICIpIiwgbGgKICAgICAgICAgICAgICAgICAgICAgICAuZ2V0TGFzdEFkZENv\nbmZpcm1lZCgpID09IChudW1FbnRyaWVzVG9Xcml0ZSAtIDEpKTsKICAgICAg\nICAgICAgYXNzZXJ0VHJ1ZSgiVmVyaWZ5aW5nIG51bWJlciBvZiBlbnRyaWVz\nIHdyaXR0ZW4gbGgyICgiICsgbGgyLmdldExhc3RBZGRDb25maXJtZWQoKSAr\nICIpIiwgbGgyCiAgICAgICAgICAgICAgICAgICAgICAgLmdldExhc3RBZGRD\nb25maXJtZWQoKSA9PSAobnVtRW50cmllc1RvV3JpdGUgLSAxKSk7CgogICAg\nICAgICAgICBscyA9IGxoLnJlYWRFbnRyaWVzKDAsIG51bUVudHJpZXNUb1dy\naXRlIC0gMSk7CiAgICAgICAgICAgIGludCBpID0gMDsKICAgICAgICAgICAg\nd2hpbGUgKGxzLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAg\nICBCeXRlQnVmZmVyIHJlc3VsdCA9IEJ5dGVCdWZmZXIud3JhcChscy5uZXh0\nRWxlbWVudCgpLmdldEVudHJ5KCkpOwogICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJMZW5ndGggb2YgcmVzdWx0OiAiICsgcmVzdWx0LmNhcGFjaXR5KCkp\nOwoKICAgICAgICAgICAgICAgIGFzc2VydFRydWUoIkNoZWNraW5nIGlmIGVu\ndHJ5ICIgKyBpICsgIiBoYXMgemVybyBieXRlcyIsIHJlc3VsdC5jYXBhY2l0\neSgpID09IDApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxoLmNsb3Nl\nKCk7CiAgICAgICAgICAgIGxzID0gbGgyLnJlYWRFbnRyaWVzKDAsIG51bUVu\ndHJpZXNUb1dyaXRlIC0gMSk7CiAgICAgICAgICAgIGkgPSAwOwogICAgICAg\nICAgICB3aGlsZSAobHMuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAg\nICAgICAgIEJ5dGVCdWZmZXIgcmVzdWx0ID0gQnl0ZUJ1ZmZlci53cmFwKGxz\nLm5leHRFbGVtZW50KCkuZ2V0RW50cnkoKSk7CiAgICAgICAgICAgICAgICBM\nT0cuZGVidWcoIkxlbmd0aCBvZiByZXN1bHQ6ICIgKyByZXN1bHQuY2FwYWNp\ndHkoKSk7CgogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiQ2hlY2tpbmcg\naWYgZW50cnkgIiArIGkgKyAiIGhhcyB6ZXJvIGJ5dGVzIiwgcmVzdWx0LmNh\ncGFjaXR5KCkgPT0gMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGgy\nLmNsb3NlKCk7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gZSkgewog\nICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7CiAgICAg\nICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29rS2VlcGVyIGV4\nY2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVkRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIs\nIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gaW50\nZXJydXB0aW9uIik7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0CiAgICBw\ndWJsaWMgdm9pZCB0ZXN0UmVhZFdyaXRlQXN5bmNMZW5ndGgoKSB0aHJvd3Mg\nSU9FeGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENy\nZWF0ZSBhIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRn\nZXIoZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAv\nLyBia2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAg\nbGVkZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygi\nTGVkZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAo\naW50IGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAg\nICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoNCk7CiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5l\neHRJbnQobWF4SW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlv\nbigwKTsKCiAgICAgICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJh\neSgpKTsKICAgICAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5h\ncnJheSgpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5hc3luY0FkZEVu\ndHJ5KGVudHJ5LmFycmF5KCksIHRoaXMsIHN5bmMpOwogICAgICAgICAgICB9\nCgogICAgICAgICAgICAvLyB3YWl0IGZvciBhbGwgZW50cmllcyB0byBiZSBh\nY2tub3dsZWRnZWQKICAgICAgICAgICAgc3luY2hyb25pemVkIChzeW5jKSB7\nCiAgICAgICAgICAgICAgICB3aGlsZSAoc3luYy5jb3VudGVyIDwgbnVtRW50\ncmllc1RvV3JpdGUpIHsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWco\nIkVudHJpZXMgY291bnRlciA9ICIgKyBzeW5jLmNvdW50ZXIpOwogICAgICAg\nICAgICAgICAgICAgIHN5bmMud2FpdCgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGxvbmcgbGVuZ3RoID0gbnVtRW50\ncmllc1RvV3JpdGUgKiA0OwogICAgICAgICAgICBhc3NlcnRUcnVlKCJMZWRn\nZXIgbGVuZ3RoIGJlZm9yZSBjbG9zaW5nOiAiICsgbGguZ2V0TGVuZ3RoKCks\nIGxoLmdldExlbmd0aCgpID09IGxlbmd0aCk7CgogICAgICAgICAgICBMT0cu\nZGVidWcoIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAgICAgICAgICAg\nLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CgogICAg\nICAgICAgICAvLyAqKiogV1JJVElORyBQQVJUIENPTVBMRVRFIC8vIFJFQUQg\nUEFSVCBCRUdJTlMgKioqCgogICAgICAgICAgICAvLyBvcGVuIGxlZGdlcgog\nICAgICAgICAgICBsaCA9IGJrYy5vcGVuTGVkZ2VyKGxlZGdlcklkLCBkaWdl\nc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIGFzc2VydFRy\ndWUoIkxlZGdlciBsZW5ndGggYWZ0ZXIgb3BlbmluZzogIiArIGxoLmdldExl\nbmd0aCgpLCBsaC5nZXRMZW5ndGgoKSA9PSBsZW5ndGgpOwoKCiAgICAgICAg\nICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwgZSk7\nCiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29rS2Vl\ncGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVwdGVk\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0IGZh\naWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUg\ndG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0U2h1dGRvd24oKSB0aHJvd3MgSU9FeGNl\ncHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGludCBudW1MZWRn\nZXJzID0gMTAwMDA7CiAgICAgICAgICAgIGludCB0aHJvdHRsZSA9ICgoKERv\ndWJsZSkgTWF0aC5tYXgoMS4wLCAoKGRvdWJsZSkgMTAwMDAvbnVtTGVkZ2Vy\ncykpKS5pbnRWYWx1ZSgpKTsKICAgICAgICAgICAgYmtjLmdldENvbmYoKS5z\nZXRUaHJvdHRsZVZhbHVlKHRocm90dGxlKTsKICAgICAgICAgICAgTGVkZ2Vy\nSGFuZGxlW10gbGhBcnJheSA9IG5ldyBMZWRnZXJIYW5kbGVbbnVtTGVkZ2Vy\nc107CiAgICAgICAgICAgIGZvcihpbnQgaSA9IDA7IGkgPCBudW1MZWRnZXJz\nOyBpKyspIHsKICAgICAgICAgICAgICAgIGxoQXJyYXlbaV0gPSBia2MuY3Jl\nYXRlTGVkZ2VyKDMsIDIsIEJvb2tLZWVwZXIuRGlnZXN0VHlwZS5DUkMzMiwg\nbmV3IGJ5dGVbXSB7J2EnLCAnYid9KTsKICAgICAgICAgICAgICAgIExPRy5k\nZWJ1ZygiTGVkZ2VyIGhhbmRsZTogIiArIGxoQXJyYXlbaV0uZ2V0SWQoKSk7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTE9HLmluZm8oIkRvbmUgY3Jl\nYXRpbmcgbGVkZ2Vycy4iKTsKICAgICAgICAgICAgUmFuZG9tIHIgPSBuZXcg\nUmFuZG9tKCk7CgogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51\nbUVudHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVC\ndWZmZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAg\nICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwog\nICAgICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CgogICAgICAgICAg\nICAgICAgZW50cmllcy5hZGQoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAg\nICAgICBlbnRyaWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwoK\nICAgICAgICAgICAgICAgIGludCBuZXh0TGggPSByLm5leHRJbnQobnVtTGVk\nZ2Vycyk7CiAgICAgICAgICAgICAgICBsaEFycmF5W25leHRMaF0uYXN5bmNB\nZGRFbnRyeShlbnRyeS5hcnJheSgpLCB0aGlzLCBzeW5jKTsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gd2FpdCBmb3IgYWxsIGVudHJpZXMgdG8g\nYmUgYWNrbm93bGVkZ2VkCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc3lu\nYykgewogICAgICAgICAgICAgICAgd2hpbGUgKHN5bmMuY291bnRlciA8IG51\nbUVudHJpZXNUb1dyaXRlKSB7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJFbnRyaWVzIGNvdW50ZXIgPSAiICsgc3luYy5jb3VudGVyKTsKICAg\nICAgICAgICAgICAgICAgICBzeW5jLndhaXQoKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgTE9HLmRlYnVnKCIqKiog\nV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAgICAgICAgIC8vIGNsb3NlIGxl\nZGdlcgogICAgICAgICAgICBmb3IoaW50IGkgPSAwOyBpIDwgbGhBcnJheS5s\nZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgbGhBcnJheVtpXS5jbG9z\nZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwg\nZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBCb29r\nS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0Y2ggKEludGVycnVw\ndGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0\nIGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBk\ndWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAgfQogICAgfQogICAgCiAg\nICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFJlYWRGcm9tT3BlbkxlZGdl\ncigpIHRocm93cyBJT0V4Y2VwdGlvbiB7CiAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAgICAgICAgICAgIGxoID0gYmtj\nLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7CiAg\nICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2FnZURpZ2VzdCgiU0hBMSIpOwog\nICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdldElkKCk7CiAgICAgICAgICAg\nIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBsaC5nZXRJZCgpKTsKICAgICAg\nICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBudW1FbnRyaWVzVG9Xcml0ZTsg\naSsrKSB7CiAgICAgICAgICAgICAgICBCeXRlQnVmZmVyIGVudHJ5ID0gQnl0\nZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICAgICAgICAgIGVudHJ5LnB1\ndEludChybmcubmV4dEludChtYXhJbnQpKTsKICAgICAgICAgICAgICAgIGVu\ndHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAgICAgICAgIGVudHJpZXMuYWRk\nKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICAgICAgZW50cmllc1NpemUu\nYWRkKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGxo\nLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICAgICAgaWYo\naSA9PSBudW1FbnRyaWVzVG9Xcml0ZS8yKSB7CiAgICAgICAgICAgICAgICAg\nICAgTGVkZ2VySGFuZGxlIGxoT3BlbiA9IGJrYy5vcGVuTGVkZ2VyTm9SZWNv\ndmVyeShsZWRnZXJJZCwgZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwog\nICAgICAgICAgICAgICAgICAgIC8vIG5vIHJlY292ZXJ5IG9wZW5lZCBsZWRn\nZXIgJ3MgbGFzdCBjb25maXJtZWQgZW50cnkgaWQgaXMgbGVzcyB0aGFuIHdy\naXR0ZW4KICAgICAgICAgICAgICAgICAgICAvLyBhbmQgaXQganVzdCBjYW4g\ncmVhZCB1bnRpbCAoaS0xKQogICAgICAgICAgICAgICAgICAgIGludCB0b1Jl\nYWQgPSBpIC0gMTsKICAgICAgICAgICAgICAgICAgICBFbnVtZXJhdGlvbjxM\nZWRnZXJFbnRyeT4gcmVhZEVudHJ5ID0gbGhPcGVuLnJlYWRFbnRyaWVzKHRv\nUmVhZCwgdG9SZWFkKTsKICAgICAgICAgICAgICAgICAgICBhc3NlcnRUcnVl\nKCJFbnVtZXJhdGlvbiBvZiBsZWRnZXIgZW50cmllcyBoYXMgbm8gZWxlbWVu\ndCIsIHJlYWRFbnRyeS5oYXNNb3JlRWxlbWVudHMoKSA9PSB0cnVlKTsKICAg\nICAgICAgICAgICAgICAgICBMZWRnZXJFbnRyeSBlID0gcmVhZEVudHJ5Lm5l\neHRFbGVtZW50KCk7CiAgICAgICAgICAgICAgICAgICAgYXNzZXJ0RXF1YWxz\nKHRvUmVhZCwgZS5nZXRFbnRyeUlkKCkpOwogICAgICAgICAgICAgICAgICAg\nIEFzc2VydC5hc3NlcnRBcnJheUVxdWFscyhlbnRyaWVzLmdldCh0b1JlYWQp\nLCBlLmdldEVudHJ5KCkpOwogICAgICAgICAgICAgICAgICAgIC8vIHNob3Vs\nZCBub3Qgd3JpdHRlbiB0byBhIHJlYWQgb25seSBsZWRnZXIKICAgICAgICAg\nICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAgICBsaE9w\nZW4uYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGZhaWwoIlNob3VsZCBoYXZlIHRocm93biBhbiBleGNlcHRpb24g\naGVyZSIpOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0\naW9uLkJLSWxsZWdhbE9wRXhjZXB0aW9uIGJraW9lKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIHRoaXMgaXMgdGhlIGNvcnJlY3QgcmVzcG9uc2UK\nICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZXgpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmVycm9yKCJVbmV4cGVjdGVk\nIGV4Y2VwdGlvbiIsIGV4KTsKICAgICAgICAgICAgICAgICAgICAgICAgZmFp\nbCgiVW5leHBlY3RlZCBleGNlcHRpb24iKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgcmVhZCBvbmx5IGxl\nZGdlciBzaG91bGQgbm90IGNoYW5nZSBtZXRhZGF0YQogICAgICAgICAgICAg\nICAgICAgIGxoT3Blbi5jbG9zZSgpOwogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9CgogICAgICAgICAgICBsb25nIGxhc3QgPSBsaC5yZWFkTGFz\ndENvbmZpcm1lZCgpOwogICAgICAgICAgICBhc3NlcnRUcnVlKCJMYXN0IGNv\nbmZpcm1lZCBhZGQ6ICIgKyBsYXN0LCBsYXN0ID09IChudW1FbnRyaWVzVG9X\ncml0ZSAtIDIpKTsKCiAgICAgICAgICAgIExPRy5kZWJ1ZygiKioqIFdSSVRF\nIENPTVBMRVRFICoqKiIpOwogICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIK\nICAgICAgICAgICAgbGguY2xvc2UoKTsKICAgICAgICAgICAgLyoKICAgICAg\nICAgICAgICogQXN5bmNocm9ub3VzIGNhbGwgdG8gcmVhZCBsYXN0IGNvbmZp\ncm1lZCBlbnRyeQogICAgICAgICAgICAgKi8KICAgICAgICAgICAgbGggPSBi\na2MuY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsK\nICAgICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7\nCiAgICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAg\nICAgTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdldElkKCkpOwogICAg\nICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG51bUVudHJpZXNUb1dyaXRl\nOyBpKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZmZXIgZW50cnkgPSBC\neXRlQnVmZmVyLmFsbG9jYXRlKDQpOwogICAgICAgICAgICAgICAgZW50cnku\ncHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAgICAgICAgICAgICAg\nZW50cnkucG9zaXRpb24oMCk7CgogICAgICAgICAgICAgICAgZW50cmllcy5h\nZGQoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgICAgICBlbnRyaWVzU2l6\nZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAgICAgICAgICAgICAg\nbGguYWRkRW50cnkoZW50cnkuYXJyYXkoKSk7CiAgICAgICAgICAgIH0KCgog\nICAgICAgICAgICBTeW5jT2JqIHN5bmMgPSBuZXcgU3luY09iaigpOwogICAg\nICAgICAgICBsaC5hc3luY1JlYWRMYXN0Q29uZmlybWVkKHRoaXMsIHN5bmMp\nOwoKICAgICAgICAgICAgLy8gV2FpdCBmb3IgZm9yIGxhc3QgY29uZmlybWVk\nCiAgICAgICAgICAgIHN5bmNocm9uaXplZCAoc3luYykgewogICAgICAgICAg\nICAgICAgd2hpbGUgKHN5bmMubGFzdENvbmZpcm1lZCA9PSAtMSkgewogICAg\nICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiQ291bnRlciA9ICIgKyBzeW5j\nLmxhc3RDb25maXJtZWQpOwogICAgICAgICAgICAgICAgICAgIHN5bmMud2Fp\ndCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAg\nICAgICBhc3NlcnRUcnVlKCJMYXN0IGNvbmZpcm1lZCBhZGQ6ICIgKyBzeW5j\nLmxhc3RDb25maXJtZWQsIHN5bmMubGFzdENvbmZpcm1lZCA9PSAobnVtRW50\ncmllc1RvV3JpdGUgLSAyKSk7CgogICAgICAgICAgICBMT0cuZGVidWcoIioq\nKiBXUklURSBDT01QTEVURSAqKioiKTsKICAgICAgICAgICAgLy8gY2xvc2Ug\nbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAgICAgfSBjYXRj\naCAoQktFeGNlcHRpb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRl\nc3QgZmFpbGVkIiwgZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVk\nIGR1ZSB0byBCb29rS2VlcGVyIGV4Y2VwdGlvbiIpOwogICAgICAgIH0gY2F0\nY2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9H\nLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJU\nZXN0IGZhaWxlZCBkdWUgdG8gaW50ZXJydXB0aW9uIik7CiAgICAgICAgfQog\nICAgfQogICAgCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFJlYWRG\ncm9tT3BlbkxlZGdlck9wZW5PbmNlKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbGVkZ2VyCiAg\nICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBs\nZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2Fn\nZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdl\ndElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBs\naC5nZXRJZCgpKTsKICAgICAgICAgICAgTGVkZ2VySGFuZGxlIGxoT3BlbiA9\nIGJrYy5vcGVuTGVkZ2VyTm9SZWNvdmVyeShsZWRnZXJJZCwgZGlnZXN0VHlw\nZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IG51bUVudHJpZXNUb1dyaXRlOyBpKyspIHsKICAgICAgICAgICAg\nICAgIEJ5dGVCdWZmZXIgZW50cnkgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKDQp\nOwogICAgICAgICAgICAgICAgZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1h\neEludCkpOwogICAgICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CiAg\nICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVudHJpZXMuYWRkKGVu\ndHJ5LmFycmF5KCkpOwogICAgICAgICAgICAgICAgZW50cmllc1NpemUuYWRk\nKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsKICAgICAgICAgICAgICAgIGxoLmFk\nZEVudHJ5KGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICAgICAgaWYgKGkg\nPT0gbnVtRW50cmllc1RvV3JpdGUgLyAyKSB7CiAgICAgICAgICAgICAgICAg\nICAgLy8gbm8gcmVjb3Zlcnkgb3BlbmVkIGxlZGdlciAncyBsYXN0IGNvbmZp\ncm1lZCBlbnRyeSBpZCBpcwogICAgICAgICAgICAgICAgICAgIC8vIGxlc3Mg\ndGhhbiB3cml0dGVuCiAgICAgICAgICAgICAgICAgICAgLy8gYW5kIGl0IGp1\nc3QgY2FuIHJlYWQgdW50aWwgKGktMSkKICAgICAgICAgICAgICAgICAgICBp\nbnQgdG9SZWFkID0gaSAtIDE7CiAgICAgICAgICAgICAgICAgICAgCiAgICAg\nICAgICAgICAgICAgICAgbG9uZyByZWFkTGFzdENvbmZpcm1lZCA9IGxoT3Bl\nbi5yZWFkTGFzdENvbmZpcm1lZCgpOwogICAgICAgICAgICAgICAgICAgIGFz\nc2VydFRydWUocmVhZExhc3RDb25maXJtZWQgIT0gMCk7CiAgICAgICAgICAg\nICAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHJlYWRFbnRyeSA9\nIGxoT3Blbi5yZWFkRW50cmllcyh0b1JlYWQsIHRvUmVhZCk7CiAgICAgICAg\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgiRW51bWVyYXRpb24gb2YgbGVkZ2Vy\nIGVudHJpZXMgaGFzIG5vIGVsZW1lbnQiLCByZWFkRW50cnkuaGFzTW9yZUVs\nZW1lbnRzKCkgPT0gdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgTGVkZ2Vy\nRW50cnkgZSA9IHJlYWRFbnRyeS5uZXh0RWxlbWVudCgpOwogICAgICAgICAg\nICAgICAgICAgIGFzc2VydEVxdWFscyh0b1JlYWQsIGUuZ2V0RW50cnlJZCgp\nKTsKICAgICAgICAgICAgICAgICAgICBBc3NlcnQuYXNzZXJ0QXJyYXlFcXVh\nbHMoZW50cmllcy5nZXQodG9SZWFkKSwgZS5nZXRFbnRyeSgpKTsKICAgICAg\nICAgICAgICAgICAgICAvLyBzaG91bGQgbm90IHdyaXR0ZW4gdG8gYSByZWFk\nIG9ubHkgbGVkZ2VyCiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgbGhPcGVuLmFkZEVudHJ5KGVudHJ5LmFycmF5\nKCkpOwogICAgICAgICAgICAgICAgICAgICAgICBmYWlsKCJTaG91bGQgaGF2\nZSB0aHJvd24gYW4gZXhjZXB0aW9uIGhlcmUiKTsKICAgICAgICAgICAgICAg\nICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbi5CS0lsbGVnYWxPcEV4Y2VwdGlv\nbiBia2lvZSkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGlzIGlz\nIHRoZSBjb3JyZWN0IHJlc3BvbnNlCiAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoRXhjZXB0aW9uIGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIExPRy5lcnJvcigiVW5leHBlY3RlZCBleGNlcHRpb24iLCBleCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIGZhaWwoIlVuZXhwZWN0ZWQgZXhjZXB0aW9u\nIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAg\nIAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAg\nIGxvbmcgbGFzdCA9IGxoLnJlYWRMYXN0Q29uZmlybWVkKCk7CiAgICAgICAg\nICAgIGFzc2VydFRydWUoIkxhc3QgY29uZmlybWVkIGFkZDogIiArIGxhc3Qs\nIGxhc3QgPT0gKG51bUVudHJpZXNUb1dyaXRlIC0gMikpOwogICAgCiAgICAg\nICAgICAgIExPRy5kZWJ1ZygiKioqIFdSSVRFIENPTVBMRVRFICoqKiIpOwog\nICAgICAgICAgICAvLyBjbG9zZSBsZWRnZXIKICAgICAgICAgICAgbGguY2xv\nc2UoKTsKICAgICAgICAgICAgLy8gY2xvc2UgcmVhZCBvbmx5IGxlZGdlciBz\naG91bGQgbm90IGNoYW5nZSBtZXRhZGF0YQogICAgICAgICAgICBsaE9wZW4u\nY2xvc2UoKTsKICAgICAgICB9IGNhdGNoIChCS0V4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAg\nICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIEJvb2tLZWVwZXIgZXhj\nZXB0aW9uIik7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICBMT0cuZXJyb3IoIlRlc3QgZmFpbGVkIiwg\nZSk7CiAgICAgICAgICAgIGZhaWwoIlRlc3QgZmFpbGVkIGR1ZSB0byBpbnRl\ncnJ1cHRpb24iKTsKICAgICAgICB9IAogICAgfQogICAgCiAgICBAVGVzdAog\nICAgcHVibGljIHZvaWQgdGVzdFJlYWRGcm9tT3BlbkxlZGdlclplcm9BbmRP\nbmUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICB0cnkgewogICAgICAg\nICAgICAvLyBDcmVhdGUgYSBsZWRnZXIKICAgICAgICAgICAgbGggPSBia2Mu\nY3JlYXRlTGVkZ2VyKGRpZ2VzdFR5cGUsIGxlZGdlclBhc3N3b3JkKTsKICAg\nICAgICAgICAgLy8gYmtjLmluaXRNZXNzYWdlRGlnZXN0KCJTSEExIik7CiAg\nICAgICAgICAgIGxlZGdlcklkID0gbGguZ2V0SWQoKTsKICAgICAgICAgICAg\nTE9HLmluZm8oIkxlZGdlciBJRDogIiArIGxoLmdldElkKCkpOwogICAgICAg\nICAgICBMZWRnZXJIYW5kbGUgbGhPcGVuID0gYmtjLm9wZW5MZWRnZXJOb1Jl\nY292ZXJ5KGxlZGdlcklkLCBkaWdlc3RUeXBlLCBsZWRnZXJQYXNzd29yZCk7\nCiAgICAgICAgICAgIAogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBX\nZSBoYXZlbid0IHdyaXR0ZW4gYW55dGhpbmcsIHNvIGl0IHNob3VsZCBiZSBl\nbXB0eS4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIExPRy5kZWJ1Zygi\nQ2hlY2tpbmcgdGhhdCBpdCBpcyBlbXB0eSIpOwogICAgICAgICAgICBsb25n\nIHJlYWRMYXN0Q29uZmlybWVkID0gbGhPcGVuLnJlYWRMYXN0Q29uZmlybWVk\nKCk7CiAgICAgICAgICAgIGFzc2VydFRydWUoIkxhc3QgY29uZmlybWVkIGhh\ncyB0aGUgd3JvbmcgdmFsdWUiLAogICAgICAgICAgICAgICAgICAgICAgIHJl\nYWRMYXN0Q29uZmlybWVkID09IExlZGdlckhhbmRsZS5JTlZBTElEX0VOVFJZ\nX0lEKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8qCiAgICAgICAgICAg\nICAqIFdyaXRpbmcgb25lIGVudHJ5LgogICAgICAgICAgICAgKi8KICAgICAg\nICAgICAgTE9HLmRlYnVnKCJHb2luZyB0byB3cml0ZSBvbmUgZW50cnkiKTsK\nICAgICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxs\nb2NhdGUoNCk7CiAgICAgICAgICAgIGVudHJ5LnB1dEludChybmcubmV4dElu\ndChtYXhJbnQpKTsKICAgICAgICAgICAgZW50cnkucG9zaXRpb24oMCk7CiAg\nICAgICAgICAgIAogICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJh\neSgpKTsKICAgICAgICAgICAgZW50cmllc1NpemUuYWRkKGVudHJ5LmFycmF5\nKCkubGVuZ3RoKTsKICAgICAgICAgICAgbGguYWRkRW50cnkoZW50cnkuYXJy\nYXkoKSk7CgogICAgICAgICAgICAvKgogICAgICAgICAgICAgKiBUaGUgaGlu\ndCBzaG91bGQgc3RpbGwgaW5kaWNhdGUgdGhhdCB0aGVyZSBpcyBubyBjb25m\naXJtZWQKICAgICAgICAgICAgICogYWRkLgogICAgICAgICAgICAgKi8KICAg\nICAgICAgICAgTE9HLmRlYnVnKCJDaGVja2luZyB0aGF0IGl0IGlzIHN0aWxs\nIGVtcHR5IGV2ZW4gYWZ0ZXIgd3JpdGluZyBvbmUgZW50cnkiKTsKICAgICAg\nICAgICAgcmVhZExhc3RDb25maXJtZWQgPSBsaE9wZW4ucmVhZExhc3RDb25m\naXJtZWQoKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShyZWFkTGFzdENvbmZp\ncm1lZCA9PSBMZWRnZXJIYW5kbGUuSU5WQUxJRF9FTlRSWV9JRCk7CgogICAg\nICAgICAgICAvKgogICAgICAgICAgICAgKiBBZGRpbmcgb25lIG1vcmUsIGFu\nZCB0aGlzIHRpbWUgd2Ugc2hvdWxkIGV4cGVjdCB0byAKICAgICAgICAgICAg\nICogc2VlIG9uZSBlbnRyeS4KICAgICAgICAgICAgICovCiAgICAgICAgICAg\nIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAgICAgICAg\nZW50cnkucHV0SW50KHJuZy5uZXh0SW50KG1heEludCkpOwogICAgICAgICAg\nICBlbnRyeS5wb3NpdGlvbigwKTsKICAgICAgICAgICAgCiAgICAgICAgICAg\nIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAgICBlbnRy\naWVzU2l6ZS5hZGQoZW50cnkuYXJyYXkoKS5sZW5ndGgpOwogICAgICAgICAg\nICBsaC5hZGRFbnRyeShlbnRyeS5hcnJheSgpKTsKCiAgICAgICAgICAgIExP\nRy5pbmZvKCJDaGVja2luZyB0aGF0IGl0IGhhcyBhbiBlbnRyeSIpOwogICAg\nICAgICAgICByZWFkTGFzdENvbmZpcm1lZCA9IGxoT3Blbi5yZWFkTGFzdENv\nbmZpcm1lZCgpOwogICAgICAgICAgICBhc3NlcnRUcnVlKHJlYWRMYXN0Q29u\nZmlybWVkID09IDBMKTsKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAg\nICAgICAgIC8vIGNsb3NlIGxlZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgp\nOwogICAgICAgICAgICAvLyBjbG9zZSByZWFkIG9ubHkgbGVkZ2VyIHNob3Vs\nZCBub3QgY2hhbmdlIG1ldGFkYXRhCiAgICAgICAgICAgIGxoT3Blbi5jbG9z\nZSgpOwogICAgICAgIH0gY2F0Y2ggKEJLRXhjZXB0aW9uIGUpIHsKICAgICAg\nICAgICAgTE9HLmVycm9yKCJUZXN0IGZhaWxlZCIsIGUpOwogICAgICAgICAg\nICBmYWlsKCJUZXN0IGZhaWxlZCBkdWUgdG8gQm9va0tlZXBlciBleGNlcHRp\nb24iKTsKICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIExPRy5lcnJvcigiVGVzdCBmYWlsZWQiLCBlKTsK\nICAgICAgICAgICAgZmFpbCgiVGVzdCBmYWlsZWQgZHVlIHRvIGludGVycnVw\ndGlvbiIpOwogICAgICAgIH0gCiAgICB9CiAgICAKCiAgICBAVGVzdAogICAg\ncHVibGljIHZvaWQgdGVzdExhc3RDb25maXJtZWRBZGQoKSB0aHJvd3MgSU9F\neGNlcHRpb24gewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIC8vIENyZWF0\nZSBhIGxlZGdlcgogICAgICAgICAgICBsaCA9IGJrYy5jcmVhdGVMZWRnZXIo\nZGlnZXN0VHlwZSwgbGVkZ2VyUGFzc3dvcmQpOwogICAgICAgICAgICAvLyBi\na2MuaW5pdE1lc3NhZ2VEaWdlc3QoIlNIQTEiKTsKICAgICAgICAgICAgbGVk\nZ2VySWQgPSBsaC5nZXRJZCgpOwogICAgICAgICAgICBMT0cuaW5mbygiTGVk\nZ2VyIElEOiAiICsgbGguZ2V0SWQoKSk7CiAgICAgICAgICAgIGZvciAoaW50\nIGkgPSAwOyBpIDwgbnVtRW50cmllc1RvV3JpdGU7IGkrKykgewogICAgICAg\nICAgICAgICAgQnl0ZUJ1ZmZlciBlbnRyeSA9IEJ5dGVCdWZmZXIuYWxsb2Nh\ndGUoNCk7CiAgICAgICAgICAgICAgICBlbnRyeS5wdXRJbnQocm5nLm5leHRJ\nbnQobWF4SW50KSk7CiAgICAgICAgICAgICAgICBlbnRyeS5wb3NpdGlvbigw\nKTsKCiAgICAgICAgICAgICAgICBlbnRyaWVzLmFkZChlbnRyeS5hcnJheSgp\nKTsKICAgICAgICAgICAgICAgIGVudHJpZXNTaXplLmFkZChlbnRyeS5hcnJh\neSgpLmxlbmd0aCk7CiAgICAgICAgICAgICAgICBsaC5hZGRFbnRyeShlbnRy\neS5hcnJheSgpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbG9uZyBs\nYXN0ID0gbGgucmVhZExhc3RDb25maXJtZWQoKTsKICAgICAgICAgICAgYXNz\nZXJ0VHJ1ZSgiTGFzdCBjb25maXJtZWQgYWRkOiAiICsgbGFzdCwgbGFzdCA9\nPSAobnVtRW50cmllc1RvV3JpdGUgLSAyKSk7CgogICAgICAgICAgICBMT0cu\nZGVidWcoIioqKiBXUklURSBDT01QTEVURSAqKioiKTsKICAgICAgICAgICAg\nLy8gY2xvc2UgbGVkZ2VyCiAgICAgICAgICAgIGxoLmNsb3NlKCk7CiAgICAg\nICAgICAgIC8qCiAgICAgICAgICAgICAqIEFzeW5jaHJvbm91cyBjYWxsIHRv\nIHJlYWQgbGFzdCBjb25maXJtZWQgZW50cnkKICAgICAgICAgICAgICovCiAg\nICAgICAgICAgIGxoID0gYmtjLmNyZWF0ZUxlZGdlcihkaWdlc3RUeXBlLCBs\nZWRnZXJQYXNzd29yZCk7CiAgICAgICAgICAgIC8vIGJrYy5pbml0TWVzc2Fn\nZURpZ2VzdCgiU0hBMSIpOwogICAgICAgICAgICBsZWRnZXJJZCA9IGxoLmdl\ndElkKCk7CiAgICAgICAgICAgIExPRy5pbmZvKCJMZWRnZXIgSUQ6ICIgKyBs\naC5nZXRJZCgpKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBu\ndW1FbnRyaWVzVG9Xcml0ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBCeXRl\nQnVmZmVyIGVudHJ5ID0gQnl0ZUJ1ZmZlci5hbGxvY2F0ZSg0KTsKICAgICAg\nICAgICAgICAgIGVudHJ5LnB1dEludChybmcubmV4dEludChtYXhJbnQpKTsK\nICAgICAgICAgICAgICAgIGVudHJ5LnBvc2l0aW9uKDApOwoKICAgICAgICAg\nICAgICAgIGVudHJpZXMuYWRkKGVudHJ5LmFycmF5KCkpOwogICAgICAgICAg\nICAgICAgZW50cmllc1NpemUuYWRkKGVudHJ5LmFycmF5KCkubGVuZ3RoKTsK\nICAgICAgICAgICAgICAgIGxoLmFkZEVudHJ5KGVudHJ5LmFycmF5KCkpOwog\nICAgICAgICAgICB9CgoKICAgICAgICAgICAgU3luY09iaiBzeW5jID0gbmV3\nIFN5bmNPYmooKTsKICAgICAgICAgICAgbGguYXN5bmNSZWFkTGFzdENvbmZp\ncm1lZCh0aGlzLCBzeW5jKTsKCiAgICAgICAgICAgIC8vIFdhaXQgZm9yIGZv\nciBsYXN0IGNvbmZpcm1lZAogICAgICAgICAgICBzeW5jaHJvbml6ZWQgKHN5\nbmMpIHsKICAgICAgICAgICAgICAgIHdoaWxlIChzeW5jLmxhc3RDb25maXJt\nZWQgPT0gTGVkZ2VySGFuZGxlLklOVkFMSURfRU5UUllfSUQpIHsKICAgICAg\nICAgICAgICAgICAgICBMT0cuZGVidWcoIkNvdW50ZXIgPSAiICsgc3luYy5s\nYXN0Q29uZmlybWVkKTsKICAgICAgICAgICAgICAgICAgICBzeW5jLndhaXQo\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZSgiTGFzdCBjb25maXJtZWQgYWRkOiAiICsgc3luYy5s\nYXN0Q29uZmlybWVkLCBzeW5jLmxhc3RDb25maXJtZWQgPT0gKG51bUVudHJp\nZXNUb1dyaXRlIC0gMikpOwoKICAgICAgICAgICAgTE9HLmRlYnVnKCIqKiog\nV1JJVEUgQ09NUExFVEUgKioqIik7CiAgICAgICAgICAgIC8vIGNsb3NlIGxl\nZGdlcgogICAgICAgICAgICBsaC5jbG9zZSgpOwogICAgICAgIH0gY2F0Y2gg\nKEJLRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgTE9HLmVycm9yKCJUZXN0\nIGZhaWxlZCIsIGUpOwogICAgICAgICAgICBmYWlsKCJUZXN0IGZhaWxlZCBk\ndWUgdG8gQm9va0tlZXBlciBleGNlcHRpb24iKTsKICAgICAgICB9IGNhdGNo\nIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIExPRy5l\ncnJvcigiVGVzdCBmYWlsZWQiLCBlKTsKICAgICAgICAgICAgZmFpbCgiVGVz\ndCBmYWlsZWQgZHVlIHRvIGludGVycnVwdGlvbiIpOwogICAgICAgIH0KICAg\nIH0KCgogICAgcHVibGljIHZvaWQgYWRkQ29tcGxldGUoaW50IHJjLCBMZWRn\nZXJIYW5kbGUgbGgsIGxvbmcgZW50cnlJZCwgT2JqZWN0IGN0eCkgewogICAg\nICAgIGlmKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0spIGZhaWwoIlJldHVy\nbiBjb2RlIGlzIG5vdCBPSzogIiArIHJjKTsKCiAgICAgICAgU3luY09iaiB4\nID0gKFN5bmNPYmopIGN0eDsKCiAgICAgICAgc3luY2hyb25pemVkICh4KSB7\nCiAgICAgICAgICAgIHguY291bnRlcisrOwogICAgICAgICAgICB4Lm5vdGlm\neSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZWFkQ29t\ncGxldGUoaW50IHJjLCBMZWRnZXJIYW5kbGUgbGgsIEVudW1lcmF0aW9uPExl\nZGdlckVudHJ5PiBzZXEsIE9iamVjdCBjdHgpIHsKICAgICAgICBpZihyYyAh\nPSBCS0V4Y2VwdGlvbi5Db2RlLk9LKSBmYWlsKCJSZXR1cm4gY29kZSBpcyBu\nb3QgT0s6ICIgKyByYyk7CgogICAgICAgIGxzID0gc2VxOwoKICAgICAgICBz\neW5jaHJvbml6ZWQgKHN5bmMpIHsKICAgICAgICAgICAgc3luYy52YWx1ZSA9\nIHRydWU7CiAgICAgICAgICAgIHN5bmMubm90aWZ5KCk7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHJlYWRMYXN0Q29uZmlybWVkQ29tcGxl\ndGUoaW50IHJjLCBsb25nIGxhc3RDb25maXJtZWQsIE9iamVjdCBjdHgpIHsK\nICAgICAgICBTeW5jT2JqIHN5bmMgPSAoU3luY09iaikgY3R4OwoKICAgICAg\nICBzeW5jaHJvbml6ZWQoc3luYykgewogICAgICAgICAgICBzeW5jLmxhc3RD\nb25maXJtZWQgPSBsYXN0Q29uZmlybWVkOwogICAgICAgICAgICBzeW5jLm5v\ndGlmeSgpOwogICAgICAgIH0KICAgIH0KCiAgICBAQmVmb3JlCiAgICBwdWJs\naWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHN1\ncGVyLnNldFVwKCk7CiAgICAgICAgcm5nID0gbmV3IFJhbmRvbShTeXN0ZW0u\nY3VycmVudFRpbWVNaWxsaXMoKSk7IC8vIEluaXRpYWxpemUgdGhlIFJhbmRv\nbQogICAgICAgIC8vIE51bWJlciBHZW5lcmF0b3IKICAgICAgICBlbnRyaWVz\nID0gbmV3IEFycmF5TGlzdDxieXRlW10+KCk7IC8vIGluaXRpYWxpemUgdGhl\nIGVudHJpZXMgbGlzdAogICAgICAgIGVudHJpZXNTaXplID0gbmV3IEFycmF5\nTGlzdDxJbnRlZ2VyPigpOwogICAgICAgIHN5bmMgPSBuZXcgU3luY09iaigp\nOyAvLyBpbml0aWFsaXplIHRoZSBzeW5jaHJvbml6YXRpb24gZGF0YSBzdHJ1\nY3R1cmUKCiAgICB9CgogICAgLyogQ2xlYW4gdXAgYSBkaXJlY3RvcnkgcmVj\ndXJzaXZlbHkgKi8KICAgIHByb3RlY3RlZCBib29sZWFuIGNsZWFuVXBEaXIo\nRmlsZSBkaXIpIHsKICAgICAgICBpZiAoZGlyLmlzRGlyZWN0b3J5KCkpIHsK\nICAgICAgICAgICAgTE9HLmluZm8oIkNsZWFuaW5nIHVwICIgKyBkaXIuZ2V0\nTmFtZSgpKTsKICAgICAgICAgICAgU3RyaW5nW10gY2hpbGRyZW4gPSBkaXIu\nbGlzdCgpOwogICAgICAgICAgICBmb3IgKFN0cmluZyBzdHJpbmcgOiBjaGls\nZHJlbikgewogICAgICAgICAgICAgICAgYm9vbGVhbiBzdWNjZXNzID0gY2xl\nYW5VcERpcihuZXcgRmlsZShkaXIsIHN0cmluZykpOwogICAgICAgICAgICAg\nICAgaWYgKCFzdWNjZXNzKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICAvLyBUaGUg\nZGlyZWN0b3J5IGlzIG5vdyBlbXB0eSBzbyBkZWxldGUgaXQKICAgICAgICBy\nZXR1cm4gZGlyLmRlbGV0ZSgpOwogICAgfQoKICAgIC8qIFVzZXIgZm9yIHRl\nc3RpbmcgcHVycG9zZXMsIHZvaWQgKi8KICAgIGNsYXNzIGVtcHR5V2F0Y2hl\nciBpbXBsZW1lbnRzIFdhdGNoZXIgewogICAgICAgIHB1YmxpYyB2b2lkIHBy\nb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAgICAgfQogICAgfQoK\nfQo=\n","encoding":"base64"}

