{"sha":"e4477390dfcfa1a0f3b73bc2ae121beb7b1a7e70","node_id":"MDQ6QmxvYjE1NzU5NTY6ZTQ0NzczOTBkZmNmYTFhMGYzYjczYmMyYWUxMjFiZWI3YjFhN2U3MA==","size":6623,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/e4477390dfcfa1a0f3b73bc2ae121beb7b1a7e70","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCmltcG9ydCBqYXZhLm5ldC5JbmV0U29ja2V0QWRkcmVzczsKaW1wb3J0IGph\ndmEubmlvLkJ5dGVCdWZmZXI7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVu\ndC5TZW1hcGhvcmU7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9t\naWMuQXRvbWljSW50ZWdlcjsKCmltcG9ydCBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuYm9va2llLkJvb2tpZTsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBl\nci5ib29raWUuQm9va2llRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5i\nb29ra2VlcGVyLmNvbmYuU2VydmVyQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9y\nZy5hcGFjaGUuYm9va2tlZXBlci5wcm90by5Cb29ra2VlcGVySW50ZXJuYWxD\nYWxsYmFja3MuV3JpdGVDYWxsYmFjazsKaW1wb3J0IG9yZy5qdW5pdC5BZnRl\ncjsKaW1wb3J0IG9yZy5qdW5pdC5CZWZvcmU7CmltcG9ydCBvcmcuanVuaXQu\nVGVzdDsKCmltcG9ydCBqdW5pdC5mcmFtZXdvcmsuVGVzdENhc2U7CmltcG9y\ndCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlckZh\nY3Rvcnk7CgovKioKICogVGVzdHMgd3JpdGluZyB0byBjb25jdXJyZW50IGxl\nZGdlcnMKICovCnB1YmxpYyBjbGFzcyBDb25jdXJyZW50TGVkZ2VyVGVzdCBl\neHRlbmRzIFRlc3RDYXNlIHsKICAgIHN0YXRpYyBMb2dnZXIgTE9HID0gTG9n\nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoQ29uY3VycmVudExlZGdlclRlc3QuY2xh\nc3MpOwoKICAgIEJvb2tpZSBib29raWU7CiAgICBGaWxlIHR4bkRpciwgbGVk\nZ2VyRGlyOwogICAgaW50IHJlY3ZUaW1lb3V0ID0gMTAwMDA7CiAgICBTZW1h\ncGhvcmUgdGhyb3R0bGU7CiAgICBTZXJ2ZXJDb25maWd1cmF0aW9uIGNvbmYg\nPSBuZXcgU2VydmVyQ29uZmlndXJhdGlvbigpOwoKICAgIEBPdmVycmlkZQog\nICAgQEJlZm9yZQogICAgcHVibGljIHZvaWQgc2V0VXAoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBTdHJpbmcgdHhuRGlyTmFtZSA9IFN5c3RlbS5n\nZXRQcm9wZXJ0eSgidHhuRGlyIik7CiAgICAgICAgaWYgKHR4bkRpck5hbWUg\nIT0gbnVsbCkgewogICAgICAgICAgICB0eG5EaXIgPSBuZXcgRmlsZSh0eG5E\naXJOYW1lKTsKICAgICAgICB9CiAgICAgICAgU3RyaW5nIGxlZGdlckRpck5h\nbWUgPSBTeXN0ZW0uZ2V0UHJvcGVydHkoImxlZGdlckRpciIpOwogICAgICAg\nIGlmIChsZWRnZXJEaXJOYW1lICE9IG51bGwpIHsKICAgICAgICAgICAgbGVk\nZ2VyRGlyID0gbmV3IEZpbGUobGVkZ2VyRGlyTmFtZSk7CiAgICAgICAgfQog\nICAgICAgIEZpbGUgdG1wRmlsZSA9IEZpbGUuY3JlYXRlVGVtcEZpbGUoImJv\nb2siLCAiLnR4biIsIHR4bkRpcik7CiAgICAgICAgdG1wRmlsZS5kZWxldGUo\nKTsKICAgICAgICB0eG5EaXIgPSBuZXcgRmlsZSh0bXBGaWxlLmdldFBhcmVu\ndCgpLCB0bXBGaWxlLmdldE5hbWUoKSsiLmRpciIpOwogICAgICAgIHR4bkRp\nci5ta2RpcnMoKTsKICAgICAgICB0bXBGaWxlID0gRmlsZS5jcmVhdGVUZW1w\nRmlsZSgiYm9vayIsICIubGVkZ2VyIiwgbGVkZ2VyRGlyKTsKICAgICAgICBs\nZWRnZXJEaXIgPSBuZXcgRmlsZSh0bXBGaWxlLmdldFBhcmVudCgpLCB0bXBG\naWxlLmdldE5hbWUoKSsiLmRpciIpOwogICAgICAgIGxlZGdlckRpci5ta2Rp\ncnMoKTsKCiAgICAgICAgY29uZi5zZXRCb29raWVQb3J0KDUwMDApOwogICAg\nICAgIGNvbmYuc2V0WmtTZXJ2ZXJzKG51bGwpOwogICAgICAgIGNvbmYuc2V0\nSm91cm5hbERpck5hbWUodHhuRGlyLmdldFBhdGgoKSk7CiAgICAgICAgY29u\nZi5zZXRMZWRnZXJEaXJOYW1lcyhuZXcgU3RyaW5nW10geyBsZWRnZXJEaXIu\nZ2V0UGF0aCgpIH0pOwogICAgICAgIGJvb2tpZSA9IG5ldyBCb29raWUoY29u\nZik7CiAgICAgICAgYm9va2llLnN0YXJ0KCk7CiAgICB9CgogICAgc3RhdGlj\nIHZvaWQgcmVjdXJzaXZlRGVsZXRlKEZpbGUgZikgewogICAgICAgIGlmIChm\nLmlzRmlsZSgpKSB7CiAgICAgICAgICAgIGYuZGVsZXRlKCk7CiAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgZm9yKEZpbGUgaTogZi5saXN0RmlsZXMo\nKSkgewogICAgICAgICAgICAgICAgcmVjdXJzaXZlRGVsZXRlKGkpOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGYuZGVsZXRlKCk7CiAgICAgICAgfQog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgQEFmdGVyCiAgICBwdWJsaWMgdm9p\nZCB0ZWFyRG93bigpIHsKICAgICAgICBib29raWUuc2h1dGRvd24oKTsKICAg\nICAgICByZWN1cnNpdmVEZWxldGUodHhuRGlyKTsKICAgICAgICByZWN1cnNp\ndmVEZWxldGUobGVkZ2VyRGlyKTsKICAgIH0KCiAgICBieXRlIHplcm9zW10g\nPSBuZXcgYnl0ZVsxNl07CgogICAgaW50IGl0ZXJhdGlvbnMgPSA1MTsKICAg\nIHsKICAgICAgICBTdHJpbmcgaXRlcmF0aW9uc1N0cmluZyA9IFN5c3RlbS5n\nZXRQcm9wZXJ0eSgiaXRlcmF0aW9ucyIpOwogICAgICAgIGlmIChpdGVyYXRp\nb25zU3RyaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0aW9ucyA9\nIEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9uc1N0cmluZyk7CiAgICAgICAg\nfQogICAgfQogICAgaW50IGl0ZXJhdGlvblN0ZXAgPSAyNTsKICAgIHsKICAg\nICAgICBTdHJpbmcgaXRlcmF0aW9uc1N0cmluZyA9IFN5c3RlbS5nZXRQcm9w\nZXJ0eSgiaXRlcmF0aW9uU3RlcCIpOwogICAgICAgIGlmIChpdGVyYXRpb25z\nU3RyaW5nICE9IG51bGwpIHsKICAgICAgICAgICAgaXRlcmF0aW9uU3RlcCA9\nIEludGVnZXIucGFyc2VJbnQoaXRlcmF0aW9uc1N0cmluZyk7CiAgICAgICAg\nfQogICAgfQogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RDb25jdXJy\nZW50V3JpdGUoKSB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhj\nZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewogICAgICAgIGludCBzaXplID0g\nMTAyNDsKICAgICAgICBpbnQgdG90YWx3cml0ZXMgPSAxMjg7CiAgICAgICAg\naWYgKFN5c3RlbS5nZXRQcm9wZXJ0eSgidG90YWx3cml0ZXMiKSAhPSBudWxs\nKSB7CiAgICAgICAgICAgIHRvdGFsd3JpdGVzID0gSW50ZWdlci5wYXJzZUlu\ndChTeXN0ZW0uZ2V0UHJvcGVydHkoInRvdGFsd3JpdGVzIikpOwogICAgICAg\nIH0KICAgICAgICBMT0cuaW5mbygiUnVubmluZyB1cCB0byAiICsgaXRlcmF0\naW9ucyArICIgaXRlcmF0aW9ucyIpOwogICAgICAgIExPRy5pbmZvKCJUb3Rh\nbCB3cml0ZXMgPSAiICsgdG90YWx3cml0ZXMpOwogICAgICAgIGludCBsZWRn\nZXJzOwogICAgICAgIGZvcihsZWRnZXJzID0gMTsgbGVkZ2VycyA8PSBpdGVy\nYXRpb25zOyBsZWRnZXJzICs9IGl0ZXJhdGlvblN0ZXApIHsKICAgICAgICAg\nICAgbG9uZyBkdXJhdGlvbiA9IGRvV3JpdGVzKGxlZGdlcnMsIHNpemUsIHRv\ndGFsd3JpdGVzKTsKICAgICAgICAgICAgTE9HLmluZm8odG90YWx3cml0ZXMg\nKyAiIG9uICIgKyBsZWRnZXJzICsgIiB0b29rICIgKyBkdXJhdGlvbiArICIg\nbXMiKTsKICAgICAgICB9CiAgICAgICAgTE9HLmluZm8oImxlZGdlcnMgIiAr\nIGxlZGdlcnMpOwogICAgICAgIGZvcihsZWRnZXJzID0gMTsgbGVkZ2VycyA8\nPSBpdGVyYXRpb25zOyBsZWRnZXJzICs9IGl0ZXJhdGlvblN0ZXApIHsKICAg\nICAgICAgICAgbG9uZyBkdXJhdGlvbiA9IGRvUmVhZHMobGVkZ2Vycywgc2l6\nZSwgdG90YWx3cml0ZXMpOwogICAgICAgICAgICBMT0cuaW5mbyhsZWRnZXJz\nICsgIiByZWFkICIgKyBkdXJhdGlvbiArICIgbXMiKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJpdmF0ZSBsb25nIGRvUmVhZHMoaW50IGxlZGdlcnMsIGlu\ndCBzaXplLCBpbnQgdG90YWx3cml0ZXMpCiAgICAgICAgICAgIHRocm93cyBJ\nT0V4Y2VwdGlvbiwgSW50ZXJydXB0ZWRFeGNlcHRpb24sIEJvb2tpZUV4Y2Vw\ndGlvbiB7CiAgICAgICAgbG9uZyBzdGFydCA9IFN5c3RlbS5jdXJyZW50VGlt\nZU1pbGxpcygpOwogICAgICAgIGZvcihpbnQgaSA9IDE7IGkgPD0gdG90YWx3\ncml0ZXMvbGVkZ2VyczsgaSsrKSB7CiAgICAgICAgICAgIGZvcihpbnQgaiA9\nIDE7IGogPD0gbGVkZ2VyczsgaisrKSB7CiAgICAgICAgICAgICAgICBCeXRl\nQnVmZmVyIGVudHJ5ID0gYm9va2llLnJlYWRFbnRyeShqLCBpKTsKICAgICAg\nICAgICAgICAgIC8vIHNraXAgdGhlIGxlZGdlciBpZCBhbmQgdGhlIGVudHJ5\nIGlkCiAgICAgICAgICAgICAgICBlbnRyeS5nZXRMb25nKCk7CiAgICAgICAg\nICAgICAgICBlbnRyeS5nZXRMb25nKCk7CiAgICAgICAgICAgICAgICBhc3Nl\ncnRFcXVhbHMoaiArICJAIiArIGksIGorMiwgZW50cnkuZ2V0TG9uZygpKTsK\nICAgICAgICAgICAgICAgIGFzc2VydEVxdWFscyhqICsgIkAiICsgaSwgaSsz\nLCBlbnRyeS5nZXRMb25nKCkpOwogICAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICAgIGxvbmcgZmluaXNoID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlz\nKCk7CiAgICAgICAgcmV0dXJuIGZpbmlzaCAtIHN0YXJ0OwogICAgfQogICAg\ncHJpdmF0ZSBsb25nIGRvV3JpdGVzKGludCBsZWRnZXJzLCBpbnQgc2l6ZSwg\naW50IHRvdGFsd3JpdGVzKQogICAgICAgICAgICB0aHJvd3MgSU9FeGNlcHRp\nb24sIEludGVycnVwdGVkRXhjZXB0aW9uLCBCb29raWVFeGNlcHRpb24gewog\nICAgICAgIHRocm90dGxlID0gbmV3IFNlbWFwaG9yZSgxMDAwMCk7CiAgICAg\nICAgV3JpdGVDYWxsYmFjayBjYiA9IG5ldyBXcml0ZUNhbGxiYWNrKCkgewog\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQg\nd3JpdGVDb21wbGV0ZShpbnQgcmMsIGxvbmcgbGVkZ2VySWQsIGxvbmcgZW50\ncnlJZCwKICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgYWRkciwgT2Jq\nZWN0IGN0eCkgewogICAgICAgICAgICAgICAgQXRvbWljSW50ZWdlciBjb3Vu\ndGVyID0gKEF0b21pY0ludGVnZXIpY3R4OwogICAgICAgICAgICAgICAgY291\nbnRlci5nZXRBbmRJbmNyZW1lbnQoKTsKICAgICAgICAgICAgICAgIHRocm90\ndGxlLnJlbGVhc2UoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAg\nICAgQXRvbWljSW50ZWdlciBjb3VudGVyID0gbmV3IEF0b21pY0ludGVnZXIo\nKTsKICAgICAgICBsb25nIHN0YXJ0ID0gU3lzdGVtLmN1cnJlbnRUaW1lTWls\nbGlzKCk7CiAgICAgICAgZm9yKGludCBpID0gMTsgaSA8PSB0b3RhbHdyaXRl\ncy9sZWRnZXJzOyBpKyspIHsKICAgICAgICAgICAgZm9yKGludCBqID0gMTsg\naiA8PSBsZWRnZXJzOyBqKyspIHsKICAgICAgICAgICAgICAgIEJ5dGVCdWZm\nZXIgYnl0ZXMgPSBCeXRlQnVmZmVyLmFsbG9jYXRlKHNpemUpOwogICAgICAg\nICAgICAgICAgYnl0ZXMucHV0TG9uZyhqKTsKICAgICAgICAgICAgICAgIGJ5\ndGVzLnB1dExvbmcoaSk7CiAgICAgICAgICAgICAgICBieXRlcy5wdXRMb25n\nKGorMik7CiAgICAgICAgICAgICAgICBieXRlcy5wdXRMb25nKGkrMyk7CiAg\nICAgICAgICAgICAgICBieXRlcy5wdXQoKCJUaGlzIGlzIGxlZGdlciAiICsg\naiArICIgZW50cnkgIiArIGkpLmdldEJ5dGVzKCkpOwogICAgICAgICAgICAg\nICAgYnl0ZXMucG9zaXRpb24oMCk7CiAgICAgICAgICAgICAgICBieXRlcy5s\naW1pdChieXRlcy5jYXBhY2l0eSgpKTsKICAgICAgICAgICAgICAgIHRocm90\ndGxlLmFjcXVpcmUoKTsKICAgICAgICAgICAgICAgIGJvb2tpZS5hZGRFbnRy\neShieXRlcywgY2IsIGNvdW50ZXIsIHplcm9zKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgICBsb25nIGZpbmlzaCA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwogICAgICAgIHJldHVybiBmaW5pc2ggLSBzdGFydDsK\nICAgIH0KfQo=\n","encoding":"base64"}

