{"sha":"905ab6dead6526afe63225cb5402c55a555cfa5c","node_id":"MDQ6QmxvYjE1NzU5NTY6OTA1YWI2ZGVhZDY1MjZhZmU2MzIyNWNiNTQwMmM1NWE1NTVjZmE1Yw==","size":5817,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/905ab6dead6526afe63225cb5402c55a555cfa5c","content":"LyoKICoKICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3Vu\nZGF0aW9uIChBU0YpIHVuZGVyIG9uZQogKiBvciBtb3JlIGNvbnRyaWJ1dG9y\nIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGUKICog\nZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5m\nb3JtYXRpb24KICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBU\naGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZQogKiB0byB5b3UgdW5kZXIgdGhl\nIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlCiAqICJMaWNlbnNl\nIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBs\naWFuY2UKICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEg\nY29weSBvZiB0aGUgTGljZW5zZSBhdAogKgogKiAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsCiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuCiAqICJBUyBJUyIgQkFTSVMsIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogKiBLSU5ELCBl\naXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZv\nciB0aGUKICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Np\nb25zIGFuZCBsaW1pdGF0aW9ucwogKiB1bmRlciB0aGUgTGljZW5zZS4KICoK\nICovCgpwYWNrYWdlIG9yZy5hcGFjaGUuYm9va2tlZXBlci50ZXN0OwoKaW1w\nb3J0IGphdmEuaW8uRmlsZTsKaW1wb3J0IGphdmEuaW8uSU9FeGNlcHRpb247\nCgppbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CgppbXBvcnQg\nb3JnLmFwYWNoZS5jb21tb25zLmlvLkZpbGVVdGlsczsKCmltcG9ydCBqYXZh\nLm5ldC5JbmV0QWRkcmVzczsKaW1wb3J0IGphdmEubmV0LkluZXRTb2NrZXRB\nZGRyZXNzOwoKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvdW50RG93\nbkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuVGltZVVuaXQ7\nCgppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2ZW50Owpp\nbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFj\naGUuem9va2VlcGVyLkNyZWF0ZU1vZGU7CmltcG9ydCBvcmcuYXBhY2hlLnpv\nb2tlZXBlci5ab29EZWZzLklkczsKCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tl\nZXBlci5zZXJ2ZXIuTklPU2VydmVyQ254bkZhY3Rvcnk7CmltcG9ydCBvcmcu\nYXBhY2hlLnpvb2tlZXBlci5zZXJ2ZXIuWm9vS2VlcGVyU2VydmVyOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIudGVzdC5DbGllbnRCYXNlOwoKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2Vy\nRmFjdG9yeTsKCmltcG9ydCBzdGF0aWMgb3JnLmp1bml0LkFzc2VydC4qOwoK\ncHVibGljIGNsYXNzIFpvb0tlZXBlclV0aWwgewogICAgc3RhdGljIGZpbmFs\nIExvZ2dlciBMT0cgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlcihab29LZWVw\nZXJVdGlsLmNsYXNzKTsKCiAgICAvLyBab29LZWVwZXIgcmVsYXRlZCB2YXJp\nYWJsZXMKICAgIHByb3RlY3RlZCBzdGF0aWMgSW50ZWdlciBab29LZWVwZXJE\nZWZhdWx0UG9ydCA9IDIxODE7CiAgICBwcml2YXRlIGZpbmFsIEluZXRTb2Nr\nZXRBZGRyZXNzIHprYWRkcjsKCiAgICBwcm90ZWN0ZWQgWm9vS2VlcGVyU2Vy\ndmVyIHprczsKICAgIHByb3RlY3RlZCBab29LZWVwZXIgemtjOyAvLyB6b29r\nZWVwZXIgY2xpZW50CiAgICBwcm90ZWN0ZWQgTklPU2VydmVyQ254bkZhY3Rv\ncnkgc2VydmVyRmFjdG9yeTsKICAgIHByb3RlY3RlZCBGaWxlIFprVG1wRGly\nOwogICAgcHJpdmF0ZSBmaW5hbCBTdHJpbmcgY29ubmVjdFN0cmluZzsKCiAg\nICBwdWJsaWMgWm9vS2VlcGVyVXRpbCgpIHsKICAgICAgICB6a2FkZHIgPSBu\nZXcgSW5ldFNvY2tldEFkZHJlc3MoWm9vS2VlcGVyRGVmYXVsdFBvcnQpOwog\nICAgICAgIGNvbm5lY3RTdHJpbmc9ICJsb2NhbGhvc3Q6IiArIFpvb0tlZXBl\nckRlZmF1bHRQb3J0OwogICAgfQoKICAgIHB1YmxpYyBab29LZWVwZXIgZ2V0\nWm9vS2VlcGVyQ2xpZW50KCkgewogICAgICAgIHJldHVybiB6a2M7CiAgICB9\nCgogICAgcHVibGljIFN0cmluZyBnZXRab29LZWVwZXJDb25uZWN0U3RyaW5n\nKCkgewogICAgICAgIHJldHVybiBjb25uZWN0U3RyaW5nOwogICAgfQoKICAg\nIHB1YmxpYyB2b2lkIHN0YXJ0U2VydmVyKCkgdGhyb3dzIEV4Y2VwdGlvbiB7\nCiAgICAgICAgLy8gY3JlYXRlIGEgWm9vS2VlcGVyIHNlcnZlcihkYXRhRGly\nLCBkYXRhTG9nRGlyLCBwb3J0KQogICAgICAgIExPRy5kZWJ1ZygiUnVubmlu\nZyBaSyBzZXJ2ZXIiKTsKICAgICAgICAvLyBTZXJ2ZXJTdGF0cy5yZWdpc3Rl\nckFzQ29uY3JldGUoKTsKICAgICAgICBDbGllbnRCYXNlLnNldHVwVGVzdEVu\ndigpOwogICAgICAgIFprVG1wRGlyID0gRmlsZS5jcmVhdGVUZW1wRmlsZSgi\nem9va2VlcGVyIiwgInRlc3QiKTsKICAgICAgICBaa1RtcERpci5kZWxldGUo\nKTsKICAgICAgICBaa1RtcERpci5ta2RpcigpOwoKICAgICAgICB6a3MgPSBu\nZXcgWm9vS2VlcGVyU2VydmVyKFprVG1wRGlyLCBaa1RtcERpciwgWm9vS2Vl\ncGVyRGVmYXVsdFBvcnQpOwogICAgICAgIHNlcnZlckZhY3RvcnkgPSBuZXcg\nTklPU2VydmVyQ254bkZhY3RvcnkoKTsKICAgICAgICBzZXJ2ZXJGYWN0b3J5\nLmNvbmZpZ3VyZSh6a2FkZHIsIDEwMCk7CiAgICAgICAgc2VydmVyRmFjdG9y\neS5zdGFydHVwKHprcyk7CgogICAgICAgIGJvb2xlYW4gYiA9IENsaWVudEJh\nc2Uud2FpdEZvclNlcnZlclVwKGdldFpvb0tlZXBlckNvbm5lY3RTdHJpbmco\nKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBDbGllbnRCYXNlLkNPTk5FQ1RJT05fVElNRU9VVCk7CiAgICAgICAg\nTE9HLmRlYnVnKCJTZXJ2ZXIgdXA6ICIgKyBiKTsKCiAgICAgICAgLy8gY3Jl\nYXRlIGEgem9va2VlcGVyIGNsaWVudAogICAgICAgIExPRy5kZWJ1ZygiSW5z\ndGFudGlhdGUgWksgQ2xpZW50Iik7CiAgICAgICAgZmluYWwgQ291bnREb3du\nTGF0Y2ggbGF0Y2ggPSBuZXcgQ291bnREb3duTGF0Y2goMSk7CiAgICAgICAg\nemtjID0gbmV3IFpvb0tlZXBlcihnZXRab29LZWVwZXJDb25uZWN0U3RyaW5n\nKCksIDEwMDAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFdh\ndGNoZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgcHJvY2VzcyhXYXRjaGVkRXZlbnQgZXZlbnQpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaGFuZGxlIHNlc3Npb24g\nZGlzY29ubmVjdHMgYW5kIGV4cGlyZXMKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKFdh\ndGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5lY3RlZCkpIHsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGNoLmNv\ndW50RG93bigpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgaWYgKCFsYXRjaC5h\nd2FpdCgxMDAwMCwgVGltZVVuaXQuTUlMTElTRUNPTkRTKSkgewogICAgICAg\nICAgICB6a2MuY2xvc2UoKTsKICAgICAgICAgICAgZmFpbCgiQ291bGQgbm90\nIGNvbm5lY3QgdG8gem9va2VlcGVyIHNlcnZlciIpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgemsgY2xpZW50IHdpdGggdmFsdWVz\nCiAgICAgICAgemtjLmNyZWF0ZSgiL2xlZGdlcnMiLCBuZXcgYnl0ZVswXSwg\nSWRzLk9QRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJTSVNURU5UKTsK\nICAgICAgICB6a2MuY3JlYXRlKCIvbGVkZ2Vycy9hdmFpbGFibGUiLCBuZXcg\nYnl0ZVswXSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwgQ3JlYXRlTW9kZS5QRVJT\nSVNURU5UKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzbGVlcFNlcnZlcihm\naW5hbCBpbnQgc2Vjb25kcywgZmluYWwgQ291bnREb3duTGF0Y2ggbCkKICAg\nICAgICAgICAgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uLCBJT0V4Y2Vw\ndGlvbiB7CiAgICAgICAgVGhyZWFkW10gYWxsdGhyZWFkcyA9IG5ldyBUaHJl\nYWRbVGhyZWFkLmFjdGl2ZUNvdW50KCldOwogICAgICAgIFRocmVhZC5lbnVt\nZXJhdGUoYWxsdGhyZWFkcyk7CiAgICAgICAgZm9yIChmaW5hbCBUaHJlYWQg\ndCA6IGFsbHRocmVhZHMpIHsKICAgICAgICAgICAgaWYgKHQuZ2V0TmFtZSgp\nLmNvbnRhaW5zKCJTeW5jVGhyZWFkOjAiKSkgewogICAgICAgICAgICAgICAg\nVGhyZWFkIHNsZWVwZXIgPSBuZXcgVGhyZWFkKCkgewogICAgICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHQuc3Vz\ncGVuZCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbC5jb3VudERv\nd24oKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRocmVhZC5zbGVl\ncChzZWNvbmRzKjEwMDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndC5yZXN1bWUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAo\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExP\nRy5lcnJvcigiRXJyb3Igc3VzcGVuZGluZyB0aHJlYWQiLCBlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBzbGVlcGVyLnN0YXJ0\nKCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAg\nICAgICB9CiAgICAgICAgdGhyb3cgbmV3IElPRXhjZXB0aW9uKCJab29LZWVw\nZXIgdGhyZWFkIG5vdCBmb3VuZCIpOwogICAgfQoKICAgIHB1YmxpYyB2b2lk\nIGtpbGxTZXJ2ZXIoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nemtjICE9IG51bGwpIHsKICAgICAgICAgICAgemtjLmNsb3NlKCk7CiAgICAg\nICAgfQoKICAgICAgICAvLyBzaHV0ZG93biBaSyBzZXJ2ZXIKICAgICAgICBp\nZiAoc2VydmVyRmFjdG9yeSAhPSBudWxsKSB7CiAgICAgICAgICAgIHNlcnZl\nckZhY3Rvcnkuc2h1dGRvd24oKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZSgi\nd2FpdGluZyBmb3Igc2VydmVyIGRvd24iLAogICAgICAgICAgICAgICAgICAg\nICAgIENsaWVudEJhc2Uud2FpdEZvclNlcnZlckRvd24oZ2V0Wm9vS2VlcGVy\nQ29ubmVjdFN0cmluZygpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgQ2xpZW50QmFzZS5DT05ORUNUSU9O\nX1RJTUVPVVQpKTsKICAgICAgICB9CiAgICAgICAgaWYgKHprcyAhPSBudWxs\nKSB7CiAgICAgICAgICAgIHprcy5nZXRUeG5Mb2dGYWN0b3J5KCkuY2xvc2Uo\nKTsKICAgICAgICB9CiAgICAgICAgLy8gU2VydmVyU3RhdHMudW5yZWdpc3Rl\ncigpOwogICAgICAgIEZpbGVVdGlscy5kZWxldGVEaXJlY3RvcnkoWmtUbXBE\naXIpOwogICAgfQp9\n","encoding":"base64"}

