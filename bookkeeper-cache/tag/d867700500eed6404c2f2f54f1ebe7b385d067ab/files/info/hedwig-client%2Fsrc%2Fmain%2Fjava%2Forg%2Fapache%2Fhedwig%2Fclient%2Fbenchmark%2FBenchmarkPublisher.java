{"sha":"3bc167bfebad9c968094b5b7a1e057bdc5a74254","node_id":"MDQ6QmxvYjE1NzU5NTY6M2JjMTY3YmZlYmFkOWM5NjgwOTRiNWI3YTFlMDU3YmRjNWE3NDI1NA==","size":5505,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3bc167bfebad9c968094b5b7a1e057bdc5a74254","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrOwoKaW1w\nb3J0IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuTWVzc2FnZUhhbmRsZXI7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYXBpLlB1Ymxpc2hlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuU3Vic2NyaWJl\ncjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5iZW5jaG1hcmsu\nQmVuY2htYXJrVXRpbHMuQmVuY2htYXJrQ2FsbGJhY2s7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrLkJlbmNobWFya1V0aWxz\nLlRocm91Z2hwdXRMYXRlbmN5QWdncmVnYXRvcjsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2U7Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcudXRpbC5DYWxsYmFjazsKCnB1YmxpYyBjbGFzcyBC\nZW5jaG1hcmtQdWJsaXNoZXIgZXh0ZW5kcyBCZW5jaG1hcmtXb3JrZXIgewog\nICAgUHVibGlzaGVyIHB1Ymxpc2hlcjsKICAgIFN1YnNjcmliZXIgc3Vic2Ny\naWJlcjsKICAgIGludCBtc2dTaXplOwogICAgaW50IG5QYXJhbGxlbDsKICAg\nIGRvdWJsZSByYXRlOwoKICAgIHB1YmxpYyBCZW5jaG1hcmtQdWJsaXNoZXIo\naW50IG51bVRvcGljcywgaW50IG51bU1lc3NhZ2VzLCBpbnQgbnVtUmVnaW9u\ncywgaW50IHN0YXJ0VG9waWNMYWJlbCwgaW50IHBhcnRpdGlvbkluZGV4LAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnQgbnVtUGFydGl0aW9u\ncywgUHVibGlzaGVyIHB1Ymxpc2hlciwgU3Vic2NyaWJlciBzdWJzY3JpYmVy\nLCBpbnQgbXNnU2l6ZSwgaW50IG5QYXJhbGxlbCwgaW50IHJhdGUpIHsKICAg\nICAgICBzdXBlcihudW1Ub3BpY3MsIG51bU1lc3NhZ2VzLCBudW1SZWdpb25z\nLCBzdGFydFRvcGljTGFiZWwsIHBhcnRpdGlvbkluZGV4LCBudW1QYXJ0aXRp\nb25zKTsKICAgICAgICB0aGlzLnB1Ymxpc2hlciA9IHB1Ymxpc2hlcjsKICAg\nICAgICB0aGlzLm1zZ1NpemUgPSBtc2dTaXplOwogICAgICAgIHRoaXMuc3Vi\nc2NyaWJlciA9IHN1YnNjcmliZXI7CiAgICAgICAgdGhpcy5uUGFyYWxsZWwg\nPSBuUGFyYWxsZWw7CgogICAgICAgIHRoaXMucmF0ZSA9IHJhdGUgLyAobnVt\nUmVnaW9ucyAqIG51bVBhcnRpdGlvbnMgKyAwLjApOwogICAgfQoKICAgIHB1\nYmxpYyB2b2lkIHdhcm11cChpbnQgbldhcm11cCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29w\neUZyb21VdGY4KCJ3YXJtdXAiICsgcGFydGl0aW9uSW5kZXgpOwogICAgICAg\nIEJ5dGVTdHJpbmcgc3ViSWQgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgi\nc3ViIik7CiAgICAgICAgc3Vic2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1\nYklkLCBDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIKTsKCiAgICAg\nICAgc3Vic2NyaWJlci5zdGFydERlbGl2ZXJ5KHRvcGljLCBzdWJJZCwgbmV3\nIE1lc3NhZ2VIYW5kbGVyKCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgcHVibGljIHZvaWQgZGVsaXZlcihCeXRlU3RyaW5nIHRvcGlj\nLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgTWVzc2FnZSBtc2csIENhbGxi\nYWNrPFZvaWQ+IGNhbGxiYWNrLAogICAgICAgICAgICBPYmplY3QgY29udGV4\ndCkgewogICAgICAgICAgICAgICAgLy8gbm9vcAogICAgICAgICAgICAgICAg\nY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4dCwgbnVsbCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgLy8gcGlja2luZyBj\nb25zdGFudHMgYXJiaXRhcmlseSBmb3Igd2FybXVwIHBoYXNlCiAgICAgICAg\nVGhyb3VnaHB1dExhdGVuY3lBZ2dyZWdhdG9yIGFnZyA9IG5ldyBUaHJvdWdo\ncHV0TGF0ZW5jeUFnZ3JlZ2F0b3IoImFja2VkIHB1YnMiLCBuV2FybXVwLCAx\nMDApOwogICAgICAgIGFnZy5zdGFydFByb2dyZXNzKCk7CgogICAgICAgIE1l\nc3NhZ2UgbXNnID0gZ2V0TXNnKDEwMjQpOwogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgbldhcm11cDsgaSsrKSB7CiAgICAgICAgICAgIHB1Ymxpc2hl\nci5hc3luY1B1Ymxpc2godG9waWMsIG1zZywgbmV3IEJlbmNobWFya0NhbGxi\nYWNrKGFnZyksIG51bGwpOwogICAgICAgIH0KCiAgICAgICAgaWYgKGFnZy50\ncEFnZy5xdWV1ZS50YWtlKCkgPiAwKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBSdW50aW1lRXhjZXB0aW9uKCJXYXJtdXAgcHVibGlzaGVzIGZhaWxlZCEi\nKTsKICAgICAgICB9CgogICAgfQoKICAgIHB1YmxpYyBNZXNzYWdlIGdldE1z\nZyhpbnQgc2l6ZSkgewogICAgICAgIFN0cmluZ0J1aWxkZXIgc2IgPSBuZXcg\nU3RyaW5nQnVpbGRlcigpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nc2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHNiLmFwcGVuZCgnYScpOwogICAg\nICAgIH0KICAgICAgICBmaW5hbCBCeXRlU3RyaW5nIGJvZHkgPSBCeXRlU3Ry\naW5nLmNvcHlGcm9tVXRmOChzYi50b1N0cmluZygpKTsKICAgICAgICBNZXNz\nYWdlIG1zZyA9IE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkoYm9keSku\nYnVpbGQoKTsKICAgICAgICByZXR1cm4gbXNnOwogICAgfQoKICAgIHB1Ymxp\nYyBWb2lkIGNhbGwoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBNZXNz\nYWdlIG1zZyA9IGdldE1zZyhtc2dTaXplKTsKCiAgICAgICAgLy8gU2luZ2xl\nIHdhcm11cCBmb3IgZXZlcnkgdG9waWMKICAgICAgICBpbnQgbXlQdWJsaXNo\nQ291bnQgPSAwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVtVG9w\naWNzOyBpKyspIHsKICAgICAgICAgICAgaWYgKCFIZWR3aWdCZW5jaG1hcmsu\nYW1JUmVzcG9uc2libGVGb3JUb3BpYyhzdGFydFRvcGljTGFiZWwgKyBpLCBw\nYXJ0aXRpb25JbmRleCwgbnVtUGFydGl0aW9ucykpIHsKICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIEJ5dGVT\ndHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChIZWR3aWdC\nZW5jaG1hcmsuVE9QSUNfUFJFRklYICsgKHN0YXJ0VG9waWNMYWJlbCArIGkp\nKTsKICAgICAgICAgICAgcHVibGlzaGVyLnB1Ymxpc2godG9waWMsIG1zZyk7\nCiAgICAgICAgICAgIG15UHVibGlzaENvdW50Kys7CiAgICAgICAgfQoKICAg\nICAgICBsb25nIHN0YXJ0VGltZSA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxp\ncygpOwogICAgICAgIGludCBteVB1Ymxpc2hMaW1pdCA9IG51bU1lc3NhZ2Vz\nIC8gbnVtUmVnaW9ucyAvIG51bVBhcnRpdGlvbnMgLSBteVB1Ymxpc2hDb3Vu\ndDsKICAgICAgICBteVB1Ymxpc2hDb3VudCA9IDA7CiAgICAgICAgVGhyb3Vn\naHB1dExhdGVuY3lBZ2dyZWdhdG9yIGFnZyA9IG5ldyBUaHJvdWdocHV0TGF0\nZW5jeUFnZ3JlZ2F0b3IoImFja2VkIHB1YnMiLCBteVB1Ymxpc2hMaW1pdCwg\nblBhcmFsbGVsKTsKICAgICAgICBhZ2cuc3RhcnRQcm9ncmVzcygpOwoKICAg\nICAgICBpbnQgdG9waWNMYWJlbCA9IDA7CgogICAgICAgIHdoaWxlIChteVB1\nYmxpc2hDb3VudCA8IG15UHVibGlzaExpbWl0KSB7CiAgICAgICAgICAgIGlu\ndCB0b3BpY051bSA9IHN0YXJ0VG9waWNMYWJlbCArIHRvcGljTGFiZWw7CiAg\nICAgICAgICAgIHRvcGljTGFiZWwgPSAodG9waWNMYWJlbCArIDEpICUgbnVt\nVG9waWNzOwoKICAgICAgICAgICAgaWYgKCFIZWR3aWdCZW5jaG1hcmsuYW1J\nUmVzcG9uc2libGVGb3JUb3BpYyh0b3BpY051bSwgcGFydGl0aW9uSW5kZXgs\nIG51bVBhcnRpdGlvbnMpKSB7CiAgICAgICAgICAgICAgICBjb250aW51ZTsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9\nIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KEhlZHdpZ0JlbmNobWFyay5UT1BJ\nQ19QUkVGSVggKyB0b3BpY051bSk7CgogICAgICAgICAgICBpZiAocmF0ZSA+\nIDApIHsKICAgICAgICAgICAgICAgIGxvbmcgZGVsYXkgPSBzdGFydFRpbWUg\nKyAobG9uZykgKDEwMDAgKiBteVB1Ymxpc2hDb3VudCAvIHJhdGUpIC0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgICAgICAgICBpZiAo\nZGVsYXkgPiAwKQogICAgICAgICAgICAgICAgICAgIFRocmVhZC5zbGVlcChk\nZWxheSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcHVibGlzaGVyLmFz\neW5jUHVibGlzaCh0b3BpYywgbXNnLCBuZXcgQmVuY2htYXJrQ2FsbGJhY2so\nYWdnKSwgbnVsbCk7CiAgICAgICAgICAgIG15UHVibGlzaENvdW50Kys7CiAg\nICAgICAgfQoKICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkZpbmlzaGVk\nIHVuYWNrZWQgcHViczogdHB1dCA9ICIgKyBCZW5jaG1hcmtVdGlscy5jYWxj\nVHAobXlQdWJsaXNoTGltaXQsIHN0YXJ0VGltZSkKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyAiIG9wcy9zIik7CiAgICAgICAgLy8gV2FpdCB0aWxs\nIHRoZSBiZW5jaG1hcmsgdGVzdCBoYXMgY29tcGxldGVkCiAgICAgICAgYWdn\nLnRwQWdnLnF1ZXVlLnRha2UoKTsKICAgICAgICBTeXN0ZW0ub3V0LnByaW50\nbG4oYWdnLnN1bW1hcml6ZShzdGFydFRpbWUpKTsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgIH0KCn0K\n","encoding":"base64"}

