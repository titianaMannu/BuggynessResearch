{"sha":"64899235d73fe77adc258450f740493342d1190f","node_id":"MDQ6QmxvYjE1NzU5NTY6NjQ4OTkyMzVkNzNmZTc3YWRjMjU4NDUwZjc0MDQ5MzM0MmQxMTkwZg==","size":7028,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/64899235d73fe77adc258450f740493342d1190f","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYmVuY2htYXJrOwoKaW1w\nb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkxpbmtlZEJsb2NraW5nUXVldWU7\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TZW1hcGhvcmU7CmltcG9y\ndCBqYXZhLnV0aWwuY29uY3VycmVudC5hdG9taWMuQXRvbWljSW50ZWdlcjsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LmF0b21pYy5BdG9taWNMb25n\nOwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXI7CmltcG9ydCBvcmcuc2xmNGou\nTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5leGNl\ncHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnV0aWwuQ2FsbGJhY2s7CgpwdWJsaWMgY2xhc3MgQmVuY2htYXJrVXRp\nbHMgewogICAgc3RhdGljIGZpbmFsIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJG\nYWN0b3J5LmdldExvZ2dlcihCZW5jaG1hcmtVdGlscy5jbGFzcyk7CgogICAg\ncHVibGljIHN0YXRpYyBkb3VibGUgY2FsY1RwKGZpbmFsIGludCBjb3VudCwg\nbG9uZyBzdGFydFRpbWUpIHsKICAgICAgICByZXR1cm4gMTAwMC4gKiBjb3Vu\ndCAvIChTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSAtIHN0YXJ0VGltZSk7\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdGF0cyBhZ2dyZWdhdG9yIGZvciBj\nYWxsYmFjayAocm91bmQtdHJpcCkgb3BlcmF0aW9ucy4gTWVhc3VyZXMgYm90\naAogICAgICogdGhyb3VnaHB1dCBhbmQgbGF0ZW5jeS4KICAgICAqLwogICAg\ncHVibGljIHN0YXRpYyBjbGFzcyBUaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0\nb3IgewogICAgICAgIGludCBudW1CdWNrZXRzOwogICAgICAgIGZpbmFsIFRo\ncm91Z2hwdXRBZ2dyZWdhdG9yIHRwQWdnOwogICAgICAgIGZpbmFsIFNlbWFw\naG9yZSBvdXRzdGFuZGluZzsKICAgICAgICBmaW5hbCBBdG9taWNMb25nIHN1\nbSA9IG5ldyBBdG9taWNMb25nKCk7CgogICAgICAgIGZpbmFsIEF0b21pY0xv\nbmdbXSBsYXRlbmN5QnVja2V0czsKCiAgICAgICAgLy8gYnVja2V0W2ldIGlz\nIGNvdW50IG9mIG51bWJlciBvZiBvcGVyYXRpb25zIHRoYXQgdG9vayA+PSBp\nIG1zIGFuZCA8CiAgICAgICAgLy8gKGkrMSkgbXMuCgogICAgICAgIHB1Ymxp\nYyBUaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0b3IoU3RyaW5nIGxhYmVsLCBp\nbnQgY291bnQsIGludCBsaW1pdCkgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0\naW9uIHsKICAgICAgICAgICAgbnVtQnVja2V0cyA9IEludGVnZXIuZ2V0SW50\nZWdlcigibnVtQnVja2V0cyIsIDEwMSk7CiAgICAgICAgICAgIGxhdGVuY3lC\ndWNrZXRzID0gbmV3IEF0b21pY0xvbmdbbnVtQnVja2V0c107CiAgICAgICAg\nICAgIHRwQWdnID0gbmV3IFRocm91Z2hwdXRBZ2dyZWdhdG9yKGxhYmVsLCBj\nb3VudCk7CiAgICAgICAgICAgIG91dHN0YW5kaW5nID0gbmV3IFNlbWFwaG9y\nZShsaW1pdCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbnVt\nQnVja2V0czsgaSsrKSB7CiAgICAgICAgICAgICAgICBsYXRlbmN5QnVja2V0\nc1tpXSA9IG5ldyBBdG9taWNMb25nKCk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyB2b2lkIHN0YXJ0UHJvZ3Jlc3MoKSB7CiAg\nICAgICAgICAgIHRwQWdnLnN0YXJ0UHJvZ3Jlc3MoKTsKICAgICAgICB9Cgog\nICAgICAgIHB1YmxpYyB2b2lkIHJlcG9ydExhdGVuY3kobG9uZyBsYXRlbmN5\nKSB7CiAgICAgICAgICAgIHN1bS5hZGRBbmRHZXQobGF0ZW5jeSk7CgogICAg\nICAgICAgICBpbnQgYnVja2V0SW5kZXg7CiAgICAgICAgICAgIGlmIChsYXRl\nbmN5ID49IG51bUJ1Y2tldHMpIHsKICAgICAgICAgICAgICAgIGJ1Y2tldElu\nZGV4ID0gKGludCkgbnVtQnVja2V0cyAtIDE7CiAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICBidWNrZXRJbmRleCA9IChpbnQpIGxhdGVu\nY3k7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGF0ZW5jeUJ1Y2tldHNb\nYnVja2V0SW5kZXhdLmluY3JlbWVudEFuZEdldCgpOwogICAgICAgIH0KCiAg\nICAgICAgcHJpdmF0ZSBTdHJpbmcgZ2V0UGVyY2VudGlsZShkb3VibGUgcGVy\nY2VudGlsZSkgewogICAgICAgICAgICBpbnQgbnVtSW5saWVyc05lZWRlZCA9\nIChpbnQpIChwZXJjZW50aWxlIC8gMTAwICogdHBBZ2cuY291bnQpOwogICAg\nICAgICAgICBpbnQgbnVtSW5saWVyc0ZvdW5kID0gMDsKICAgICAgICAgICAg\nZm9yIChpbnQgaSA9IDA7IGkgPCBudW1CdWNrZXRzIC0gMTsgaSsrKSB7CiAg\nICAgICAgICAgICAgICBudW1JbmxpZXJzRm91bmQgKz0gbGF0ZW5jeUJ1Y2tl\ndHNbaV0uaW50VmFsdWUoKTsKICAgICAgICAgICAgICAgIGlmIChudW1Jbmxp\nZXJzRm91bmQgPiBudW1JbmxpZXJzTmVlZGVkKSB7CiAgICAgICAgICAgICAg\nICAgICAgcmV0dXJuIGkgKyAiIjsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgICAgICByZXR1cm4gIiA+PSAiICsgKG51bUJ1Y2tl\ndHMgLSAxKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmcgc3Vt\nbWFyaXplKGxvbmcgc3RhcnRUaW1lKSB7CiAgICAgICAgICAgIGRvdWJsZSBw\nZXJjZW50aWxlID0gRG91YmxlLnBhcnNlRG91YmxlKFN5c3RlbS5nZXRQcm9w\nZXJ0eSgicGVyY2VudGlsZSIsICI5OS45IikpOwogICAgICAgICAgICByZXR1\ncm4gdHBBZ2cuc3VtbWFyaXplKHN0YXJ0VGltZSkgKyAiLCBhdmcgbGF0ZW5j\neSA9ICIgKyBzdW0uZ2V0KCkgLyB0cEFnZy5jb3VudCArICIsICIgKyBwZXJj\nZW50aWxlCiAgICAgICAgICAgICAgICAgICArICIlaWxlIGxhdGVuY3kgPSAi\nICsgZ2V0UGVyY2VudGlsZShwZXJjZW50aWxlKTsKICAgICAgICB9CiAgICB9\nCgogICAgLyoqCiAgICAgKiBTdGF0cyBhZ2dyZWdhdG9yIGZvciBub24tY2Fs\nbGJhY2sgKHNpbmdsZS1zaG90KSBvcGVyYXRpb25zLiBNZWFzdXJlcyBqdXN0\nCiAgICAgKiB0aHJvdWdocHV0LgogICAgICovCiAgICBwdWJsaWMgc3RhdGlj\nIGNsYXNzIFRocm91Z2hwdXRBZ2dyZWdhdG9yIHsKICAgICAgICBmaW5hbCBT\ndHJpbmcgbGFiZWw7CiAgICAgICAgZmluYWwgaW50IGNvdW50OwogICAgICAg\nIGZpbmFsIEF0b21pY0ludGVnZXIgZG9uZSA9IG5ldyBBdG9taWNJbnRlZ2Vy\nKCk7CiAgICAgICAgZmluYWwgQXRvbWljTG9uZyBlYXJsaWVzdCA9IG5ldyBB\ndG9taWNMb25nKCk7CiAgICAgICAgZmluYWwgQXRvbWljSW50ZWdlciBudW1G\nYWlsZWQgPSBuZXcgQXRvbWljSW50ZWdlcigpOwogICAgICAgIGZpbmFsIFRo\ncmVhZCBwcm9ncmVzc1RocmVhZDsKICAgICAgICBmaW5hbCBMaW5rZWRCbG9j\na2luZ1F1ZXVlPEludGVnZXI+IHF1ZXVlID0gbmV3IExpbmtlZEJsb2NraW5n\nUXVldWU8SW50ZWdlcj4oKTsKCiAgICAgICAgcHVibGljIFRocm91Z2hwdXRB\nZ2dyZWdhdG9yKGZpbmFsIFN0cmluZyBsYWJlbCwgZmluYWwgaW50IGNvdW50\nKSB7CiAgICAgICAgICAgIHRoaXMubGFiZWwgPSBsYWJlbDsKICAgICAgICAg\nICAgdGhpcy5jb3VudCA9IGNvdW50OwogICAgICAgICAgICBpZiAoY291bnQg\nPT0gMCkKICAgICAgICAgICAgICAgIHF1ZXVlLmFkZCgwKTsKICAgICAgICAg\nICAgaWYgKEJvb2xlYW4uZ2V0Qm9vbGVhbigicHJvZ3Jlc3MiKSkgewogICAg\nICAgICAgICAgICAgcHJvZ3Jlc3NUaHJlYWQgPSBuZXcgVGhyZWFkKG5ldyBS\ndW5uYWJsZSgpIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBmb3IgKGludCBkb25lU25hcCA9IDAsIHByZXYgPSAwOyBkb25lU25h\ncCA8IGNvdW50OyBwcmV2ID0gZG9uZVNuYXAsIGRvbmVTbmFwID0gZG9uZS5n\nZXQoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChk\nb25lU25hcCA+IHByZXYpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKGxhYmVsICsgIiBwcm9ncmVz\nczogIiArIGRvbmVTbmFwICsgIiBvZiAiICsgY291bnQpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBUaHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0\nY2ggKEV4Y2VwdGlvbiBleCkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IFJ1bnRpbWVFeGNlcHRpb24oZXgpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAg\nICAgICAgICAgcHJvZ3Jlc3NUaHJlYWQgPSBudWxsOwogICAgICAgICAgICB9\nCiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzdGFydFByb2dyZXNz\nKCkgewogICAgICAgICAgICBpZiAocHJvZ3Jlc3NUaHJlYWQgIT0gbnVsbCkg\newogICAgICAgICAgICAgICAgcHJvZ3Jlc3NUaHJlYWQuc3RhcnQoKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgZGlu\nZyhib29sZWFuIGZhaWxlZCkgewogICAgICAgICAgICBpbnQgc25hcERvbmUg\nPSBkb25lLmluY3JlbWVudEFuZEdldCgpOwogICAgICAgICAgICBlYXJsaWVz\ndC5jb21wYXJlQW5kU2V0KDAsIFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygp\nKTsKICAgICAgICAgICAgaWYgKGZhaWxlZCkKICAgICAgICAgICAgICAgIG51\nbUZhaWxlZC5pbmNyZW1lbnRBbmRHZXQoKTsKICAgICAgICAgICAgaWYgKGxv\nZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nZ2Vy\nLmRlYnVnKGxhYmVsICsgIiAiICsgKGZhaWxlZCA/ICJmYWlsZWQiIDogInN1\nY2NlZWRlZCIpICsgIiwgZG9uZSBzbyBmYXIgPSAiICsgc25hcERvbmUpOwog\nICAgICAgICAgICBpZiAoc25hcERvbmUgPT0gY291bnQpIHsKICAgICAgICAg\nICAgICAgIHF1ZXVlLmFkZChudW1GYWlsZWQuZ2V0KCkpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIHN1bW1hcml6\nZShsb25nIHN0YXJ0VGltZSkgewogICAgICAgICAgICByZXR1cm4gIkZpbmlz\naGVkICIgKyBsYWJlbCArICI6IGNvdW50ID0gIiArIGRvbmUuZ2V0KCkgKyAi\nLCB0cHV0ID0gIiArIGNhbGNUcChjb3VudCwgc3RhcnRUaW1lKQogICAgICAg\nICAgICAgICAgICAgKyAiIG9wcy9zLCBudW1GYWlsZWQgPSAiICsgbnVtRmFp\nbGVkOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIGNsYXNz\nIEJlbmNobWFya0NhbGxiYWNrIGltcGxlbWVudHMgQ2FsbGJhY2s8Vm9pZD4g\newoKICAgICAgICBmaW5hbCBUaHJvdWdocHV0TGF0ZW5jeUFnZ3JlZ2F0b3Ig\nYWdnOwogICAgICAgIGZpbmFsIGxvbmcgc3RhcnRUaW1lOwoKICAgICAgICBw\ndWJsaWMgQmVuY2htYXJrQ2FsbGJhY2soVGhyb3VnaHB1dExhdGVuY3lBZ2dy\nZWdhdG9yIGFnZykgdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgdGhpcy5hZ2cgPSBhZ2c7CiAgICAgICAgICAgIGFnZy5vdXRz\ndGFuZGluZy5hY3F1aXJlKCk7CiAgICAgICAgICAgIC8vIE11c3Qgc2V0IHRo\nZSBzdGFydCB0aW1lICphZnRlciogdGFraW5nIGFjcXVpcmluZyBvbiBvdXRz\ndGFuZGluZy4KICAgICAgICAgICAgc3RhcnRUaW1lID0gU3lzdGVtLmN1cnJl\nbnRUaW1lTWlsbGlzKCk7CiAgICAgICAgfQoKICAgICAgICBwcml2YXRlIHZv\naWQgZmluaXNoKGJvb2xlYW4gZmFpbGVkKSB7CiAgICAgICAgICAgIGFnZy5y\nZXBvcnRMYXRlbmN5KFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpIC0gc3Rh\ncnRUaW1lKTsKICAgICAgICAgICAgYWdnLnRwQWdnLmRpbmcoZmFpbGVkKTsK\nICAgICAgICAgICAgYWdnLm91dHN0YW5kaW5nLnJlbGVhc2UoKTsKICAgICAg\nICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9w\nZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVy\nYXRpb24pIHsKICAgICAgICAgICAgZmluaXNoKGZhbHNlKTsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0\naW9uKSB7CiAgICAgICAgICAgIGZpbmlzaCh0cnVlKTsKICAgICAgICB9CiAg\nICB9OwoKfQo=\n","encoding":"base64"}

