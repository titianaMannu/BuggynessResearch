{"sha":"fac5b443150729ea2f5fd7c207b06cb6a3b25ad6","node_id":"MDQ6QmxvYjE1NzU5NTY6ZmFjNWI0NDMxNTA3MjllYTJmNWZkN2MyMDdiMDZjYjZhM2IyNWFkNg==","size":12368,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/fac5b443150729ea2f5fd7c207b06cb6a3b25ad6","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHk7CgppbXBvcnQg\namF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwu\nY29uY3VycmVudC5Db25jdXJyZW50SGFzaE1hcDsKaW1wb3J0IGphdmEudXRp\nbC5jb25jdXJyZW50LkNvbmN1cnJlbnRNYXA7CgppbXBvcnQgb3JnLnNsZjRq\nLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwppbXBv\ncnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbDsKaW1wb3J0IG9y\nZy5qYm9zcy5uZXR0eS5jaGFubmVsLkNoYW5uZWxGdXR1cmU7CgppbXBvcnQg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5QdWJsaXNoZXI7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5jbGllbnQuY29uZi5DbGllbnRDb25maWd1cmF0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmRhdGEuUHViU3Vi\nRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5oYW5kbGVy\ncy5QdWJTdWJDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4\nY2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb24uQ291bGROb3RDb25u\nZWN0RXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhjZXB0\naW9ucy5QdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZTsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVy\nc2lvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1YlN1YlJlcXVlc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdDsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s7CgovKioK\nICogVGhpcyBpcyB0aGUgSGVkd2lnIE5ldHR5IHNwZWNpZmljIGltcGxlbWVu\ndGF0aW9uIG9mIHRoZSBQdWJsaXNoZXIgaW50ZXJmYWNlLgogKgogKi8KcHVi\nbGljIGNsYXNzIEhlZHdpZ1B1Ymxpc2hlciBpbXBsZW1lbnRzIFB1Ymxpc2hl\nciB7CgogICAgcHJpdmF0ZSBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dl\nckZhY3RvcnkuZ2V0TG9nZ2VyKEhlZHdpZ1B1Ymxpc2hlci5jbGFzcyk7Cgog\nICAgLy8gQ29uY3VycmVudCBNYXAgdG8gc3RvcmUgdGhlIG1hcHBpbmdzIGZv\nciBhIGdpdmVuIEhvc3QgKEhvc3RuYW1lOlBvcnQpIHRvCiAgICAvLyB0aGUg\nQ2hhbm5lbCB0aGF0IGhhcyBiZWVuIGVzdGFibGlzaGVkIGZvciBpdCBwcmV2\naW91c2x5LiBUaGlzIGNoYW5uZWwKICAgIC8vIHdpbGwgYmUgdXNlZCB3aGVu\nZXZlciB3ZSBwdWJsaXNoIG9uIGEgdG9waWMgdGhhdCB0aGUgc2VydmVyIGlz\nIHRoZSBtYXN0ZXIKICAgIC8vIG9mIGN1cnJlbnRseS4gVGhlIGNoYW5uZWxz\nIHVzZWQgaGVyZSB3aWxsIG9ubHkgYmUgdXNlZCBmb3IgcHVibGlzaCBhbmQK\nICAgIC8vIHVuc3Vic2NyaWJlIHJlcXVlc3RzLgogICAgcHJvdGVjdGVkIGZp\nbmFsIENvbmN1cnJlbnRNYXA8SW5ldFNvY2tldEFkZHJlc3MsIENoYW5uZWw+\nIGhvc3QyQ2hhbm5lbCA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxJbmV0U29j\na2V0QWRkcmVzcywgQ2hhbm5lbD4oKTsKCiAgICBwcml2YXRlIGZpbmFsIEhl\nZHdpZ0NsaWVudEltcGwgY2xpZW50OwogICAgcHJpdmF0ZSBmaW5hbCBDbGll\nbnRDb25maWd1cmF0aW9uIGNmZzsKICAgIHByaXZhdGUgYm9vbGVhbiBjbG9z\nZWQgPSBmYWxzZTsKCiAgICBwcm90ZWN0ZWQgSGVkd2lnUHVibGlzaGVyKEhl\nZHdpZ0NsaWVudEltcGwgY2xpZW50KSB7CiAgICAgICAgdGhpcy5jbGllbnQg\nPSBjbGllbnQ7CiAgICAgICAgdGhpcy5jZmcgPSBjbGllbnQuZ2V0Q29uZmln\ndXJhdGlvbigpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHB1Ymxpc2goQnl0\nZVN0cmluZyB0b3BpYywgTWVzc2FnZSBtc2cpIHRocm93cyBDb3VsZE5vdENv\nbm5lY3RFeGNlcHRpb24sIFNlcnZpY2VEb3duRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAgIGxv\nZ2dlci5kZWJ1ZygiQ2FsbGluZyBhIHN5bmMgcHVibGlzaCBmb3IgdG9waWM6\nICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIG1zZzogIiArIG1zZyk7\nCiAgICAgICAgUHViU3ViRGF0YSBwdWJTdWJEYXRhID0gbmV3IFB1YlN1YkRh\ndGEodG9waWMsIG1zZywgbnVsbCwgT3BlcmF0aW9uVHlwZS5QVUJMSVNILCBu\ndWxsLCBudWxsLCBudWxsKTsKICAgICAgICBzeW5jaHJvbml6ZWQgKHB1YlN1\nYkRhdGEpIHsKICAgICAgICAgICAgUHViU3ViQ2FsbGJhY2sgcHViU3ViQ2Fs\nbGJhY2sgPSBuZXcgUHViU3ViQ2FsbGJhY2socHViU3ViRGF0YSk7CiAgICAg\nICAgICAgIGFzeW5jUHVibGlzaCh0b3BpYywgbXNnLCBwdWJTdWJDYWxsYmFj\naywgbnVsbCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB3\naGlsZSAoIXB1YlN1YkRhdGEuaXNEb25lKQogICAgICAgICAgICAgICAgICAg\nIHB1YlN1YkRhdGEud2FpdCgpOwogICAgICAgICAgICB9IGNhdGNoIChJbnRl\ncnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBu\nZXcgU2VydmljZURvd25FeGNlcHRpb24oIkludGVycnVwdGVkIEV4Y2VwdGlv\nbiB3aGlsZSB3YWl0aW5nIGZvciBhc3luYyBwdWJsaXNoIGNhbGwiKTsKICAg\nICAgICAgICAgfQogICAgICAgICAgICAvLyBDaGVjayBmcm9tIHRoZSBQdWJT\ndWJDYWxsYmFjayBpZiBpdCB3YXMgc3VjY2Vzc2Z1bCBvciBub3QuCiAgICAg\nICAgICAgIGlmICghcHViU3ViQ2FsbGJhY2suZ2V0SXNDYWxsU3VjY2Vzc2Z1\nbCgpKSB7CiAgICAgICAgICAgICAgICAvLyBTZWUgd2hhdCB0aGUgZXhjZXB0\naW9uIHdhcyB0aGF0IHdhcyB0aHJvd24gd2hlbiB0aGUgb3BlcmF0aW9uCiAg\nICAgICAgICAgICAgICAvLyBmYWlsZWQuCiAgICAgICAgICAgICAgICBQdWJT\ndWJFeGNlcHRpb24gZmFpbHVyZUV4Y2VwdGlvbiA9IHB1YlN1YkNhbGxiYWNr\nLmdldEZhaWx1cmVFeGNlcHRpb24oKTsKICAgICAgICAgICAgICAgIGlmIChm\nYWlsdXJlRXhjZXB0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAg\nICAvLyBUaGlzIHNob3VsZCBub3QgaGFwcGVuIGFzIHRoZSBvcGVyYXRpb24g\nZmFpbGVkIGJ1dCBhIG51bGwKICAgICAgICAgICAgICAgICAgICAvLyBQdWJT\ndWJFeGNlcHRpb24gd2FzIHBhc3NlZC4gTG9nIGEgd2FybmluZyBtZXNzYWdl\nIGJ1dAogICAgICAgICAgICAgICAgICAgIC8vIHRocm93IGEgZ2VuZXJpYyBT\nZXJ2aWNlRG93bkV4Y2VwdGlvbi4KICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZXJyb3IoIlN5bmMgUHVibGlzaCBvcGVyYXRpb24gZmFpbGVkIGJ1dCBu\nbyBQdWJTdWJFeGNlcHRpb24gd2FzIHBhc3NlZCEiKTsKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyBuZXcgU2VydmljZURvd25FeGNlcHRpb24oIlNlcnZl\nciBhY2sgcmVzcG9uc2UgdG8gcHVibGlzaCByZXF1ZXN0IGlzIG5vdCBzdWNj\nZXNzZnVsIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAv\nLyBGb3IgdGhlIGV4cGVjdGVkIGV4Y2VwdGlvbnMgdGhhdCBjb3VsZCBvY2N1\nciwganVzdCByZXRocm93CiAgICAgICAgICAgICAgICAvLyB0aGVtLgogICAg\nICAgICAgICAgICAgZWxzZSBpZiAoZmFpbHVyZUV4Y2VwdGlvbiBpbnN0YW5j\nZW9mIENvdWxkTm90Q29ubmVjdEV4Y2VwdGlvbikgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IChDb3VsZE5vdENvbm5lY3RFeGNlcHRpb24pIGZhaWx1\ncmVFeGNlcHRpb247CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZhaWx1\ncmVFeGNlcHRpb24gaW5zdGFuY2VvZiBTZXJ2aWNlRG93bkV4Y2VwdGlvbikg\newogICAgICAgICAgICAgICAgICAgIHRocm93IChTZXJ2aWNlRG93bkV4Y2Vw\ndGlvbikgZmFpbHVyZUV4Y2VwdGlvbjsKICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIG90aGVyIHR5cGVzIG9m\nIFB1YlN1YkV4Y2VwdGlvbnMsIGp1c3QgdGhyb3cgYSBnZW5lcmljCiAgICAg\nICAgICAgICAgICAgICAgLy8gU2VydmljZURvd25FeGNlcHRpb24gYnV0IGxv\nZyBhIHdhcm5pbmcgbWVzc2FnZS4KICAgICAgICAgICAgICAgICAgICBsb2dn\nZXIuZXJyb3IoIlVuZXhwZWN0ZWQgZXhjZXB0aW9uIHR5cGUgd2hlbiBhIHN5\nbmMgcHVibGlzaCBvcGVyYXRpb24gZmFpbGVkOiAiICsgZmFpbHVyZUV4Y2Vw\ndGlvbik7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNlcnZpY2VE\nb3duRXhjZXB0aW9uKCJTZXJ2ZXIgYWNrIHJlc3BvbnNlIHRvIHB1Ymxpc2gg\ncmVxdWVzdCBpcyBub3Qgc3VjY2Vzc2Z1bCIpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2\nb2lkIGFzeW5jUHVibGlzaChCeXRlU3RyaW5nIHRvcGljLCBNZXNzYWdlIG1z\nZywgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIE9iamVjdCBjb250ZXh0KSB7\nCiAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQogICAgICAg\nICAgICBsb2dnZXIuZGVidWcoIkNhbGxpbmcgYW4gYXN5bmMgcHVibGlzaCBm\nb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIG1zZzog\nIiArIG1zZyk7CiAgICAgICAgLy8gQ2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZl\nIGEgQ2hhbm5lbCBjb25uZWN0aW9uIHNldCB1cCB0byB0aGUgc2VydmVyCiAg\nICAgICAgLy8gZm9yIHRoZSBnaXZlbiBUb3BpYy4KICAgICAgICBQdWJTdWJE\nYXRhIHB1YlN1YkRhdGEgPSBuZXcgUHViU3ViRGF0YSh0b3BpYywgbXNnLCBu\ndWxsLCBPcGVyYXRpb25UeXBlLlBVQkxJU0gsIG51bGwsIGNhbGxiYWNrLCBj\nb250ZXh0KTsKICAgICAgICBpZiAoY2xpZW50LnRvcGljMkhvc3QuY29udGFp\nbnNLZXkodG9waWMpKSB7CiAgICAgICAgICAgIEluZXRTb2NrZXRBZGRyZXNz\nIGhvc3QgPSBjbGllbnQudG9waWMySG9zdC5nZXQodG9waWMpOwogICAgICAg\nICAgICBpZiAoaG9zdDJDaGFubmVsLmNvbnRhaW5zS2V5KGhvc3QpKSB7CiAg\nICAgICAgICAgICAgICAvLyBXZSBhbHJlYWR5IGhhdmUgdGhlIENoYW5uZWwg\nY29ubmVjdGlvbiBmb3IgdGhlIHNlcnZlciBob3N0IHNvCiAgICAgICAgICAg\nICAgICAvLyBkbyB0aGUgcHVibGlzaCBkaXJlY3RseS4gV2Ugd2lsbCBkZWFs\nIHdpdGggcmVkaXJlY3QgbG9naWMKICAgICAgICAgICAgICAgIC8vIGxhdGVy\nIG9uIGlmIHRoYXQgc2VydmVyIGlzIG5vIGxvbmdlciB0aGUgY3VycmVudCBo\nb3N0IGZvcgogICAgICAgICAgICAgICAgLy8gdGhlIHRvcGljLgogICAgICAg\nICAgICAgICAgZG9QdWJsaXNoKHB1YlN1YkRhdGEsIGhvc3QyQ2hhbm5lbC5n\nZXQoaG9zdCkpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgLy8gV2UgaGF2ZSBhIG1hcHBpbmcgZm9yIHRoZSB0b3BpYyB0byBob3N0\nIGJ1dCBkb24ndCBoYXZlIGEKICAgICAgICAgICAgICAgIC8vIENoYW5uZWwg\nZm9yIHRoYXQgc2VydmVyLiBUaGlzIGNhbiBoYXBwZW4gaWYgdGhlIENoYW5u\nZWwKICAgICAgICAgICAgICAgIC8vIGlzIGRpc2Nvbm5lY3RlZCBmb3Igc29t\nZSByZWFzb24uIERvIHRoZSBjb25uZWN0IHRoZW4gdG8KICAgICAgICAgICAg\nICAgIC8vIHRoZSBzcGVjaWZpZWQgc2VydmVyIGhvc3QgdG8gY3JlYXRlIGEg\nbmV3IENoYW5uZWwgY29ubmVjdGlvbi4KICAgICAgICAgICAgICAgIGNsaWVu\ndC5kb0Nvbm5lY3QocHViU3ViRGF0YSwgaG9zdCk7CiAgICAgICAgICAgIH0K\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTZXJ2ZXIgaG9zdCBm\nb3IgdGhlIGdpdmVuIHRvcGljIGlzIG5vdCBrbm93biB5ZXQgc28gdXNlIHRo\nZQogICAgICAgICAgICAvLyBkZWZhdWx0IHNlcnZlciBob3N0L3BvcnQgYXMg\nZGVmaW5lZCBpbiB0aGUgY29uZmlncy4gVGhpcyBzaG91bGQKICAgICAgICAg\nICAgLy8gcG9pbnQgdG8gdGhlIHNlcnZlciBWSVAgd2hpY2ggd291bGQgcmVk\naXJlY3QgdG8gYSByYW5kb20gc2VydmVyCiAgICAgICAgICAgIC8vICh3aGlj\naCBtaWdodCBub3QgYmUgdGhlIHNlcnZlciBob3N0aW5nIHRoZSB0b3BpYyku\nCiAgICAgICAgICAgIEluZXRTb2NrZXRBZGRyZXNzIGhvc3QgPSBjZmcuZ2V0\nRGVmYXVsdFNlcnZlckhvc3QoKTsKICAgICAgICAgICAgaWYgKGhvc3QyQ2hh\nbm5lbC5jb250YWluc0tleShob3N0KSkgewogICAgICAgICAgICAgICAgLy8g\naWYgdGhlcmUgaXMgYSBjaGFubmVsIHRvIGRlZmF1bHQgc2VydmVyLCB1c2Ug\naXQhCiAgICAgICAgICAgICAgICBkb1B1Ymxpc2gocHViU3ViRGF0YSwgaG9z\ndDJDaGFubmVsLmdldChob3N0KSk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2xpZW50LmRvQ29ubmVjdChw\ndWJTdWJEYXRhLCBob3N0KTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAg\nICAgKiBUaGlzIGlzIGEgaGVscGVyIG1ldGhvZCB0byB3cml0ZSB0aGUgYWN0\ndWFsIHB1Ymxpc2ggbWVzc2FnZSBvbmNlIHRoZQogICAgICogY2xpZW50IGlz\nIGNvbm5lY3RlZCB0byB0aGUgc2VydmVyIGFuZCBhIENoYW5uZWwgaXMgYXZh\naWxhYmxlLgogICAgICoKICAgICAqIEBwYXJhbSBwdWJTdWJEYXRhCiAgICAg\nKiAgICAgICAgICAgIFB1Ymxpc2ggY2FsbCdzIGRhdGEgd3JhcHBlciBvYmpl\nY3QKICAgICAqIEBwYXJhbSBjaGFubmVsCiAgICAgKiAgICAgICAgICAgIE5l\ndHR5IEkvTyBjaGFubmVsIGZvciBjb21tdW5pY2F0aW9uIGJldHdlZW4gdGhl\nIGNsaWVudCBhbmQKICAgICAqICAgICAgICAgICAgc2VydmVyCiAgICAgKi8K\nICAgIHByb3RlY3RlZCB2b2lkIGRvUHVibGlzaChQdWJTdWJEYXRhIHB1YlN1\nYkRhdGEsIENoYW5uZWwgY2hhbm5lbCkgewogICAgICAgIC8vIENyZWF0ZSBh\nIFB1YlN1YlJlcXVlc3QKICAgICAgICBQdWJTdWJSZXF1ZXN0LkJ1aWxkZXIg\ncHVic3ViUmVxdWVzdEJ1aWxkZXIgPSBQdWJTdWJSZXF1ZXN0Lm5ld0J1aWxk\nZXIoKTsKICAgICAgICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5zZXRQcm90b2Nv\nbFZlcnNpb24oUHJvdG9jb2xWZXJzaW9uLlZFUlNJT05fT05FKTsKICAgICAg\nICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5zZXRUeXBlKE9wZXJhdGlvblR5cGUu\nUFVCTElTSCk7CiAgICAgICAgaWYgKHB1YlN1YkRhdGEudHJpZWRTZXJ2ZXJz\nICE9IG51bGwgJiYgcHViU3ViRGF0YS50cmllZFNlcnZlcnMuc2l6ZSgpID4g\nMCkgewogICAgICAgICAgICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5hZGRBbGxU\ncmllZFNlcnZlcnMocHViU3ViRGF0YS50cmllZFNlcnZlcnMpOwogICAgICAg\nIH0KICAgICAgICBsb25nIHR4bklkID0gY2xpZW50Lmdsb2JhbENvdW50ZXIu\naW5jcmVtZW50QW5kR2V0KCk7CiAgICAgICAgcHVic3ViUmVxdWVzdEJ1aWxk\nZXIuc2V0VHhuSWQodHhuSWQpOwogICAgICAgIHB1YnN1YlJlcXVlc3RCdWls\nZGVyLnNldFNob3VsZENsYWltKHB1YlN1YkRhdGEuc2hvdWxkQ2xhaW0pOwog\nICAgICAgIHB1YnN1YlJlcXVlc3RCdWlsZGVyLnNldFRvcGljKHB1YlN1YkRh\ndGEudG9waWMpOwoKICAgICAgICAvLyBOb3cgY3JlYXRlIHRoZSBQdWJsaXNo\nUmVxdWVzdAogICAgICAgIFB1Ymxpc2hSZXF1ZXN0LkJ1aWxkZXIgcHVibGlz\naFJlcXVlc3RCdWlsZGVyID0gUHVibGlzaFJlcXVlc3QubmV3QnVpbGRlcigp\nOwoKICAgICAgICBwdWJsaXNoUmVxdWVzdEJ1aWxkZXIuc2V0TXNnKHB1YlN1\nYkRhdGEubXNnKTsKCiAgICAgICAgLy8gU2V0IHRoZSBQdWJsaXNoUmVxdWVz\ndCBpbnRvIHRoZSBvdXRlciBQdWJTdWJSZXF1ZXN0CiAgICAgICAgcHVic3Vi\nUmVxdWVzdEJ1aWxkZXIuc2V0UHVibGlzaFJlcXVlc3QocHVibGlzaFJlcXVl\nc3RCdWlsZGVyKTsKCiAgICAgICAgLy8gVXBkYXRlIHRoZSBQdWJTdWJEYXRh\nIHdpdGggdGhlIHR4bklkIGFuZCB0aGUgcmVxdWVzdFdyaXRlVGltZQogICAg\nICAgIHB1YlN1YkRhdGEudHhuSWQgPSB0eG5JZDsKICAgICAgICBwdWJTdWJE\nYXRhLnJlcXVlc3RXcml0ZVRpbWUgPSBTeXN0ZW0uY3VycmVudFRpbWVNaWxs\naXMoKTsKCiAgICAgICAgLy8gQmVmb3JlIHdlIGRvIHRoZSB3cml0ZSwgc3Rv\ncmUgdGhpcyBpbmZvcm1hdGlvbiBpbnRvIHRoZQogICAgICAgIC8vIFJlc3Bv\nbnNlSGFuZGxlciBzbyB3aGVuIHRoZSBzZXJ2ZXIgcmVzcG9uZHMsIHdlIGtu\nb3cgd2hhdAogICAgICAgIC8vIGFwcHJvcHJpYXRlIENhbGxiYWNrIERhdGEg\ndG8gaW52b2tlIGZvciB0aGUgZ2l2ZW4gdHhuIElELgogICAgICAgIEhlZHdp\nZ0NsaWVudEltcGwuZ2V0UmVzcG9uc2VIYW5kbGVyRnJvbUNoYW5uZWwoY2hh\nbm5lbCkudHhuMlB1YlN1YkRhdGEucHV0KHR4bklkLCBwdWJTdWJEYXRhKTsK\nCiAgICAgICAgLy8gRmluYWxseSwgd3JpdGUgdGhlIFB1Ymxpc2ggcmVxdWVz\ndCB0aHJvdWdoIHRoZSBDaGFubmVsLgogICAgICAgIGlmIChsb2dnZXIuaXNE\nZWJ1Z0VuYWJsZWQoKSkKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJXcml0\naW5nIGEgUHVibGlzaCByZXF1ZXN0IHRvIGhvc3Q6ICIgKyBIZWR3aWdDbGll\nbnRJbXBsLmdldEhvc3RGcm9tQ2hhbm5lbChjaGFubmVsKQogICAgICAgICAg\nICAgICAgICAgICAgICAgKyAiIGZvciBwdWJTdWJEYXRhOiAiICsgcHViU3Vi\nRGF0YSk7CiAgICAgICAgQ2hhbm5lbEZ1dHVyZSBmdXR1cmUgPSBjaGFubmVs\nLndyaXRlKHB1YnN1YlJlcXVlc3RCdWlsZGVyLmJ1aWxkKCkpOwogICAgICAg\nIGZ1dHVyZS5hZGRMaXN0ZW5lcihuZXcgV3JpdGVDYWxsYmFjayhwdWJTdWJE\nYXRhLCBjbGllbnQpKTsKICAgIH0KCiAgICAvLyBTeW5jaHJvbml6ZWQgbWV0\naG9kIHRvIHN0b3JlIHRoZSBob3N0MkNoYW5uZWwgbWFwcGluZyAoaWYgaXQg\nZG9lc24ndAogICAgLy8gZXhpc3QgeWV0KS4gUmV0cmlldmUgdGhlIGhvc3Ru\nYW1lIGluZm8gZnJvbSB0aGUgQ2hhbm5lbCBjcmVhdGVkIHZpYSB0aGUKICAg\nIC8vIFJlbW90ZUFkZHJlc3MgdGllZCB0byBpdC4KICAgIHByb3RlY3RlZCBz\neW5jaHJvbml6ZWQgdm9pZCBzdG9yZUhvc3QyQ2hhbm5lbE1hcHBpbmcoQ2hh\nbm5lbCBjaGFubmVsKSB7CiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgaG9z\ndCA9IEhlZHdpZ0NsaWVudEltcGwuZ2V0SG9zdEZyb21DaGFubmVsKGNoYW5u\nZWwpOwogICAgICAgIGlmICghY2xvc2VkICYmICFob3N0MkNoYW5uZWwuY29u\ndGFpbnNLZXkoaG9zdCkpIHsKICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0Rl\nYnVnRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJT\ndG9yaW5nIGEgbmV3IENoYW5uZWwgbWFwcGluZyBmb3IgaG9zdDogIiArIGhv\nc3QpOwogICAgICAgICAgICBob3N0MkNoYW5uZWwucHV0KGhvc3QsIGNoYW5u\nZWwpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIElmIHdlJ3Zl\nIHJlYWNoZWQgaGVyZSwgdGhhdCBtZWFucyB3ZSBhbHJlYWR5IGhhdmUgYSBD\naGFubmVsCiAgICAgICAgICAgIC8vIG1hcHBpbmcgZm9yIHRoZSBnaXZlbiBo\nb3N0LiBUaGlzIHNob3VsZCBpZGVhbGx5IG5vdCBoYXBwZW4KICAgICAgICAg\nICAgLy8gYW5kIGl0IG1lYW5zIHdlIGFyZSBjcmVhdGluZyBhbm90aGVyIENo\nYW5uZWwgdG8gYSBzZXJ2ZXIgaG9zdAogICAgICAgICAgICAvLyB0byBwdWJs\naXNoIG9uIHdoZW4gd2UgY291bGQgaGF2ZSB1c2VkIGFuIGV4aXN0aW5nIG9u\nZS4gVGhpcyBjb3VsZAogICAgICAgICAgICAvLyBoYXBwZW4gZHVlIHRvIGEg\ncmFjZSBjb25kaXRpb24gaWYgaW5pdGlhbGx5IG11bHRpcGxlIGNvbmN1cnJl\nbnQKICAgICAgICAgICAgLy8gdGhyZWFkcyBhcmUgcHVibGlzaGluZyBvbiB0\naGUgc2FtZSB0b3BpYyBhbmQgbm8gQ2hhbm5lbCBleGlzdHMKICAgICAgICAg\nICAgLy8gY3VycmVudGx5IHRvIHRoZSBzZXJ2ZXIuIFdlIGFyZSBub3Qgc3lu\nY2hyb25pemluZyB0aGlzIGluaXRpYWwKICAgICAgICAgICAgLy8gY3JlYXRp\nb24gb2YgQ2hhbm5lbHMgdG8gYSBnaXZlbiBob3N0IGZvciBwZXJmb3JtYW5j\nZS4KICAgICAgICAgICAgLy8gQW5vdGhlciBwb3NzaWJsZSB3YXkgdG8gaGF2\nZSByZWR1bmRhbnQgQ2hhbm5lbHMgY3JlYXRlZCBpcyBpZgogICAgICAgICAg\nICAvLyBhIG5ldyB0b3BpYyBpcyBiZWluZyBwdWJsaXNoZWQgdG8sIHdlIGNv\nbm5lY3QgdG8gdGhlIGRlZmF1bHQKICAgICAgICAgICAgLy8gc2VydmVyIGhv\nc3Qgd2hpY2ggc2hvdWxkIGJlIGEgVklQIHRoYXQgcmVkaXJlY3RzIHRvIGEg\nInJlYWwiCiAgICAgICAgICAgIC8vIHNlcnZlciBob3N0LiBTaW5jZSB3ZSBk\nb24ndCBrbm93IGJlZm9yZWhhbmQgd2hhdCBpcyB0aGUgZnVsbAogICAgICAg\nICAgICAvLyBzZXQgb2Ygc2VydmVyIGhvc3RzLCB3ZSBjb3VsZCBiZSByZWRp\ncmVjdGVkIHRvIGEgc2VydmVyIHRoYXQKICAgICAgICAgICAgLy8gd2UgYWxy\nZWFkeSBoYXZlIGEgY2hhbm5lbCBjb25uZWN0aW9uIHRvIGZyb20gYSBwcmlv\nciBleGlzdGluZwogICAgICAgICAgICAvLyB0b3BpYy4gQ2xvc2UgdGhlc2Ug\ncmVkdW5kYW50IGNoYW5uZWxzIGFzIHRoZXkgd29uJ3QgYmUgdXNlZC4KICAg\nICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQogICAgICAg\nICAgICAgICAgbG9nZ2VyLmRlYnVnKCJDaGFubmVsIG1hcHBpbmcgdG8gaG9z\ndDogIiArIGhvc3QgKyAiIGFscmVhZHkgZXhpc3RzIHNvIG5vIG5lZWQgdG8g\nc3RvcmUgaXQuIik7CiAgICAgICAgICAgIEhlZHdpZ0NsaWVudEltcGwuZ2V0\nUmVzcG9uc2VIYW5kbGVyRnJvbUNoYW5uZWwoY2hhbm5lbCkuY2hhbm5lbENs\nb3NlZEV4cGxpY2l0bHkgPSB0cnVlOwogICAgICAgICAgICBjaGFubmVsLmNs\nb3NlKCk7CiAgICAgICAgfQogICAgfQoKICAgIC8vIFB1YmxpYyBnZXR0ZXIg\nZm9yIGVudHJpZXMgaW4gdGhlIGhvc3QyQ2hhbm5lbCBNYXAuCiAgICAvLyBU\naGlzIGlzIHVzZWQgZm9yIGNsYXNzZXMgdGhhdCBuZWVkIHRoaXMgaW5mb3Jt\nYXRpb24gYnV0IGFyZSBub3QgaW4gdGhlCiAgICAvLyBzYW1lIGNsYXNzcGF0\naC4KICAgIHB1YmxpYyBDaGFubmVsIGdldENoYW5uZWxGb3JIb3N0KEluZXRT\nb2NrZXRBZGRyZXNzIGhvc3QpIHsKICAgICAgICByZXR1cm4gaG9zdDJDaGFu\nbmVsLmdldChob3N0KTsKICAgIH0KCiAgICB2b2lkIGNsb3NlKCkgewogICAg\nICAgIHN5bmNocm9uaXplZCh0aGlzKSB7CiAgICAgICAgICAgIGNsb3NlZCA9\nIHRydWU7CiAgICAgICAgfQogICAgICAgIGZvciAoQ2hhbm5lbCBjaGFubmVs\nIDogaG9zdDJDaGFubmVsLnZhbHVlcygpKSB7CiAgICAgICAgICAgIGNsaWVu\ndC5nZXRSZXNwb25zZUhhbmRsZXJGcm9tQ2hhbm5lbChjaGFubmVsKS5jaGFu\nbmVsQ2xvc2VkRXhwbGljaXRseSA9IHRydWU7CiAgICAgICAgICAgIGNoYW5u\nZWwuY2xvc2UoKS5hd2FpdFVuaW50ZXJydXB0aWJseSgpOwogICAgICAgIH0K\nICAgICAgICBob3N0MkNoYW5uZWwuY2xlYXIoKTsKICAgIH0KfQo=\n","encoding":"base64"}

