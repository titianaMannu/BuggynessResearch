{"sha":"e77e4211929afc299ab7c222a26596eff10cf6f0","node_id":"MDQ6QmxvYjE1NzU5NTY6ZTc3ZTQyMTE5MjlhZmMyOTlhYjdjMjIyYTI2NTk2ZWZmMTBjZjZmMA==","size":37767,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/e77e4211929afc299ab7c222a26596eff10cf6f0","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHk7CgppbXBvcnQg\namF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwu\nTGlzdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRI\nYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVu\ndE1hcDsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNs\nZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuY2hh\nbm5lbC5DaGFubmVsOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwu\nQ2hhbm5lbEZ1dHVyZTsKaW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVs\nLkNoYW5uZWxGdXR1cmVMaXN0ZW5lcjsKCmltcG9ydCBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5j\nbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuY2xpZW50LmFwaS5TdWJzY3JpYmVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuY2xpZW50LmNvbmYuQ2xpZW50Q29uZmlndXJhdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5kYXRhLlB1YlN1YkRhdGE7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuZGF0YS5Ub3BpY1N1\nYnNjcmliZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuZXhj\nZXB0aW9ucy5BbHJlYWR5U3RhcnREZWxpdmVyeUV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5leGNlcHRpb25zLkludmFsaWRT\ndWJzY3JpYmVySWRFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5jbGllbnQuaGFuZGxlcnMuUHViU3ViQ2FsbGJhY2s7CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbjsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0\naW9uLkNsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb24u\nQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLkNvdWxkTm90\nQ29ubmVjdEV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4\nY2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9u\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuQ29uc3VtZVJlcXVlc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5P\ncGVyYXRpb25UeXBlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3Vi\nUmVxdWVzdDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Q7CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmli\nZVJlcXVlc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvZXh0ZW5zaW9ucy5TdWJzY3JpcHRpb25TdGF0ZVV0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5DYWxsYmFjazsKCi8q\nKgogKiBUaGlzIGlzIHRoZSBIZWR3aWcgTmV0dHkgc3BlY2lmaWMgaW1wbGVt\nZW50YXRpb24gb2YgdGhlIFN1YnNjcmliZXIgaW50ZXJmYWNlLgogKgogKi8K\ncHVibGljIGNsYXNzIEhlZHdpZ1N1YnNjcmliZXIgaW1wbGVtZW50cyBTdWJz\nY3JpYmVyIHsKCiAgICBwcml2YXRlIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0g\nTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoSGVkd2lnU3Vic2NyaWJlci5jbGFz\ncyk7CgogICAgLy8gQ29uY3VycmVudCBNYXAgdG8gc3RvcmUgdGhlIGNhY2hl\nZCBDaGFubmVsIGNvbm5lY3Rpb25zIG9uIHRoZSBjbGllbnQgc2lkZQogICAg\nLy8gdG8gYSBzZXJ2ZXIgaG9zdCBmb3IgYSBnaXZlbiBUb3BpYyArIFN1YnNj\ncmliZXJJZCBjb21iaW5hdGlvbi4gRm9yIGVhY2gKICAgIC8vIFRvcGljU3Vi\nc2NyaWJlciwgd2Ugd2FudCBhIHVuaXF1ZSBDaGFubmVsIGNvbm5lY3Rpb24g\ndG8gdGhlIHNlcnZlciBmb3IKICAgIC8vIGl0LiBXZSBjYW4gYWxzbyBnZXQg\ndGhlIFJlc3BvbnNlSGFuZGxlciB0aWVkIHRvIHRoZSBDaGFubmVsIHZpYSB0\naGUKICAgIC8vIENoYW5uZWwgUGlwZWxpbmUuCiAgICBwcm90ZWN0ZWQgZmlu\nYWwgQ29uY3VycmVudE1hcDxUb3BpY1N1YnNjcmliZXIsIENoYW5uZWw+IHRv\ncGljU3Vic2NyaWJlcjJDaGFubmVsID0gbmV3IENvbmN1cnJlbnRIYXNoTWFw\nPFRvcGljU3Vic2NyaWJlciwgQ2hhbm5lbD4oKTsKCiAgICAvLyBDb25jdXJy\nZW50IE1hcCB0byBzdG9yZSBNZXNzYWdlIGhhbmRsZXIgZm9yIGVhY2ggdG9w\naWMgKyBzdWIgaWQgY29tYmluYXRpb24uCiAgICAvLyBTdG9yZSBpdCBoZXJl\nIGluc3RlYWQgb2YgaW4gU3Vic2NyaWJlclJlc3BvbnNlSGFuZGxlciBhcyB3\nZSBkb24ndCB3YW50IHRvIGxvc2UgdGhlIGhhbmRsZXIKICAgIC8vIHVzZXIg\nc2V0IHdoZW4gY29ubmVjdGlvbiBpcyByZWNvdmVyZWQKICAgIHByb3RlY3Rl\nZCBmaW5hbCBDb25jdXJyZW50TWFwPFRvcGljU3Vic2NyaWJlciwgTWVzc2Fn\nZUhhbmRsZXI+IHRvcGljU3Vic2NyaWJlcjJNZXNzYWdlSGFuZGxlcj0gbmV3\nIENvbmN1cnJlbnRIYXNoTWFwPFRvcGljU3Vic2NyaWJlciwgTWVzc2FnZUhh\nbmRsZXI+KCk7CgogICAgcHJvdGVjdGVkIGZpbmFsIEhlZHdpZ0NsaWVudElt\ncGwgY2xpZW50OwogICAgcHJvdGVjdGVkIGZpbmFsIENsaWVudENvbmZpZ3Vy\nYXRpb24gY2ZnOwogICAgcHJpdmF0ZSBPYmplY3QgY2xvc2VMb2NrID0gbmV3\nIE9iamVjdCgpOwogICAgcHJpdmF0ZSBib29sZWFuIGNsb3NlZCA9IGZhbHNl\nOwoKICAgIHB1YmxpYyBIZWR3aWdTdWJzY3JpYmVyKEhlZHdpZ0NsaWVudElt\ncGwgY2xpZW50KSB7CiAgICAgICAgdGhpcy5jbGllbnQgPSBjbGllbnQ7CiAg\nICAgICAgdGhpcy5jZmcgPSBjbGllbnQuZ2V0Q29uZmlndXJhdGlvbigpOwog\nICAgfQoKICAgIC8vIFByaXZhdGUgbWV0aG9kIHRoYXQgaG9sZHMgdGhlIGNv\nbW1vbiBsb2dpYyBmb3IgZG9pbmcgc3luY2hyb25vdXMKICAgIC8vIFN1YnNj\ncmliZSBvciBVbnN1YnNjcmliZSByZXF1ZXN0cy4gVGhpcyBpcyBmb3IgY29k\nZSByZXVzZSBzaW5jZSB0aGVzZQogICAgLy8gdHdvIGZsb3dzIGFyZSB2ZXJ5\nIHNpbWlsYXIuIFRoZSBhc3N1bXB0aW9uIGlzIHRoYXQgdGhlIGlucHV0CiAg\nICAvLyBPcGVyYXRpb25UeXBlIGlzIGVpdGhlciBTVUJTQ1JJQkUgb3IgVU5T\nVUJTQ1JJQkUuCiAgICBwcml2YXRlIHZvaWQgc3ViVW5zdWIoQnl0ZVN0cmlu\nZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIE9wZXJhdGlvblR5\ncGUgb3BlcmF0aW9uVHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgICBT\ndWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnMpCiAgICAgICAgICAgIHRocm93\ncyBDb3VsZE5vdENvbm5lY3RFeGNlcHRpb24sIENsaWVudEFscmVhZHlTdWJz\nY3JpYmVkRXhjZXB0aW9uLAogICAgICAgIENsaWVudE5vdFN1YnNjcmliZWRF\neGNlcHRpb24sIFNlcnZpY2VEb3duRXhjZXB0aW9uIHsKICAgICAgICBpZiAo\nbG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgU3RyaW5n\nQnVpbGRlciBkZWJ1Z01zZyA9IG5ldyBTdHJpbmdCdWlsZGVyKCkuYXBwZW5k\nKCJDYWxsaW5nIGEgc3luYyBzdWJVbnN1YiByZXF1ZXN0IGZvciB0b3BpYzog\nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBl\nbmQodG9waWMudG9TdHJpbmdVdGY4KCkpLmFwcGVuZCgiLCBzdWJzY3JpYmVy\nSWQ6ICIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAu\nYXBwZW5kKHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKSkuYXBwZW5kKCIs\nIG9wZXJhdGlvblR5cGU6ICIpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAuYXBwZW5kKG9wZXJhdGlvblR5cGUpOwogICAgICAgICAg\nICBpZiAobnVsbCAhPSBvcHRpb25zKSB7CiAgICAgICAgICAgICAgICBkZWJ1\nZ01zZy5hcHBlbmQoIiwgY3JlYXRlT3JBdHRhY2g6ICIpLmFwcGVuZChvcHRp\nb25zLmdldENyZWF0ZU9yQXR0YWNoKCkpCiAgICAgICAgICAgICAgICAgICAg\nICAgIC5hcHBlbmQoIiwgbWVzc2FnZUJvdW5kOiAiKS5hcHBlbmQob3B0aW9u\ncy5nZXRNZXNzYWdlQm91bmQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgbG9nZ2VyLmRlYnVnKGRlYnVnTXNnLnRvU3RyaW5nKCkpOwogICAgICAg\nIH0KICAgICAgICBQdWJTdWJEYXRhIHB1YlN1YkRhdGEgPSBuZXcgUHViU3Vi\nRGF0YSh0b3BpYywgbnVsbCwgc3Vic2NyaWJlcklkLCBvcGVyYXRpb25UeXBl\nLCBvcHRpb25zLCBudWxsLCBudWxsKTsKICAgICAgICBzeW5jaHJvbml6ZWQg\nKHB1YlN1YkRhdGEpIHsKICAgICAgICAgICAgUHViU3ViQ2FsbGJhY2sgcHVi\nU3ViQ2FsbGJhY2sgPSBuZXcgUHViU3ViQ2FsbGJhY2socHViU3ViRGF0YSk7\nCiAgICAgICAgICAgIGFzeW5jU3ViVW5zdWIodG9waWMsIHN1YnNjcmliZXJJ\nZCwgcHViU3ViQ2FsbGJhY2ssIG51bGwsIG9wZXJhdGlvblR5cGUsIG9wdGlv\nbnMpOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgd2hpbGUg\nKCFwdWJTdWJEYXRhLmlzRG9uZSkKICAgICAgICAgICAgICAgICAgICBwdWJT\ndWJEYXRhLndhaXQoKTsKICAgICAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0\nZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNl\ncnZpY2VEb3duRXhjZXB0aW9uKCJJbnRlcnJ1cHRlZCBFeGNlcHRpb24gd2hp\nbGUgd2FpdGluZyBmb3IgYXN5bmMgc3ViVW5zdWIgY2FsbCIpOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIC8vIENoZWNrIGZyb20gdGhlIFB1YlN1YkNh\nbGxiYWNrIGlmIGl0IHdhcyBzdWNjZXNzZnVsIG9yIG5vdC4KICAgICAgICAg\nICAgaWYgKCFwdWJTdWJDYWxsYmFjay5nZXRJc0NhbGxTdWNjZXNzZnVsKCkp\nIHsKICAgICAgICAgICAgICAgIC8vIFNlZSB3aGF0IHRoZSBleGNlcHRpb24g\nd2FzIHRoYXQgd2FzIHRocm93biB3aGVuIHRoZSBvcGVyYXRpb24KICAgICAg\nICAgICAgICAgIC8vIGZhaWxlZC4KICAgICAgICAgICAgICAgIFB1YlN1YkV4\nY2VwdGlvbiBmYWlsdXJlRXhjZXB0aW9uID0gcHViU3ViQ2FsbGJhY2suZ2V0\nRmFpbHVyZUV4Y2VwdGlvbigpOwogICAgICAgICAgICAgICAgaWYgKGZhaWx1\ncmVFeGNlcHRpb24gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIC8v\nIFRoaXMgc2hvdWxkIG5vdCBoYXBwZW4gYXMgdGhlIG9wZXJhdGlvbiBmYWls\nZWQgYnV0IGEgbnVsbAogICAgICAgICAgICAgICAgICAgIC8vIFB1YlN1YkV4\nY2VwdGlvbiB3YXMgcGFzc2VkLiBMb2cgYSB3YXJuaW5nIG1lc3NhZ2UgYnV0\nCiAgICAgICAgICAgICAgICAgICAgLy8gdGhyb3cgYSBnZW5lcmljIFNlcnZp\nY2VEb3duRXhjZXB0aW9uLgogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5l\ncnJvcigiU3luYyBTdWJVbnN1YiBvcGVyYXRpb24gZmFpbGVkIGJ1dCBubyBQ\ndWJTdWJFeGNlcHRpb24gd2FzIHBhc3NlZCEiKTsKICAgICAgICAgICAgICAg\nICAgICB0aHJvdyBuZXcgU2VydmljZURvd25FeGNlcHRpb24oIlNlcnZlciBh\nY2sgcmVzcG9uc2UgdG8gU3ViVW5zdWIgcmVxdWVzdCBpcyBub3Qgc3VjY2Vz\nc2Z1bCIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8g\nRm9yIHRoZSBleHBlY3RlZCBleGNlcHRpb25zIHRoYXQgY291bGQgb2NjdXIs\nIGp1c3QgcmV0aHJvdwogICAgICAgICAgICAgICAgLy8gdGhlbS4KICAgICAg\nICAgICAgICAgIGVsc2UgaWYgKGZhaWx1cmVFeGNlcHRpb24gaW5zdGFuY2Vv\nZiBDb3VsZE5vdENvbm5lY3RFeGNlcHRpb24pCiAgICAgICAgICAgICAgICAg\nICAgdGhyb3cgKENvdWxkTm90Q29ubmVjdEV4Y2VwdGlvbikgZmFpbHVyZUV4\nY2VwdGlvbjsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZhaWx1cmVFeGNl\ncHRpb24gaW5zdGFuY2VvZiBDbGllbnRBbHJlYWR5U3Vic2NyaWJlZEV4Y2Vw\ndGlvbikKICAgICAgICAgICAgICAgICAgICB0aHJvdyAoQ2xpZW50QWxyZWFk\neVN1YnNjcmliZWRFeGNlcHRpb24pIGZhaWx1cmVFeGNlcHRpb247CiAgICAg\nICAgICAgICAgICBlbHNlIGlmIChmYWlsdXJlRXhjZXB0aW9uIGluc3RhbmNl\nb2YgQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbikKICAgICAgICAgICAg\nICAgICAgICB0aHJvdyAoQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbikg\nZmFpbHVyZUV4Y2VwdGlvbjsKICAgICAgICAgICAgICAgIGVsc2UgaWYgKGZh\naWx1cmVFeGNlcHRpb24gaW5zdGFuY2VvZiBTZXJ2aWNlRG93bkV4Y2VwdGlv\nbikKICAgICAgICAgICAgICAgICAgICB0aHJvdyAoU2VydmljZURvd25FeGNl\ncHRpb24pIGZhaWx1cmVFeGNlcHRpb247CiAgICAgICAgICAgICAgICBlbHNl\nIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlVuZXhwZWN0\nZWQgUHViU3ViRXhjZXB0aW9uIHRocm93bjogIiArIGZhaWx1cmVFeGNlcHRp\nb24udG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gVGhyb3cg\nYSBnZW5lcmljIFNlcnZpY2VEb3duRXhjZXB0aW9uIGJ1dCB3cmFwIHRoZQog\nICAgICAgICAgICAgICAgICAgIC8vIG9yaWdpbmFsIFB1YlN1YkV4Y2VwdGlv\nbiB3aXRoaW4gaXQuCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFNl\ncnZpY2VEb3duRXhjZXB0aW9uKGZhaWx1cmVFeGNlcHRpb24pOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAg\nIC8vIFByaXZhdGUgbWV0aG9kIHRoYXQgaG9sZHMgdGhlIGNvbW1vbiBsb2dp\nYyBmb3IgZG9pbmcgYXN5bmNocm9ub3VzCiAgICAvLyBTdWJzY3JpYmUgb3Ig\nVW5zdWJzY3JpYmUgcmVxdWVzdHMuIFRoaXMgaXMgZm9yIGNvZGUgcmV1c2Ug\nc2luY2UgdGhlc2UgdHdvCiAgICAvLyBmbG93cyBhcmUgdmVyeSBzaW1pbGFy\nLiBUaGUgYXNzdW1wdGlvbiBpcyB0aGF0IHRoZSBpbnB1dCBPcGVyYXRpb25U\neXBlIGlzCiAgICAvLyBlaXRoZXIgU1VCU0NSSUJFIG9yIFVOU1VCU0NSSUJF\nLgogICAgcHJpdmF0ZSB2b2lkIGFzeW5jU3ViVW5zdWIoQnl0ZVN0cmluZyB0\nb3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIENhbGxiYWNrPFZvaWQ+\nIGNhbGxiYWNrLCBPYmplY3QgY29udGV4dCwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIE9wZXJhdGlvblR5cGUgb3BlcmF0aW9uVHlwZSwgU3Vi\nc2NyaXB0aW9uT3B0aW9ucyBvcHRpb25zKSB7CiAgICAgICAgaWYgKGxvZ2dl\nci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIFN0cmluZ0J1aWxk\nZXIgZGVidWdNc2cgPSBuZXcgU3RyaW5nQnVpbGRlcigpLmFwcGVuZCgiQ2Fs\nbGluZyBhIGFzeW5jIHN1YlVuc3ViIHJlcXVlc3QgZm9yIHRvcGljOiAiKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCh0\nb3BpYy50b1N0cmluZ1V0ZjgoKSkuYXBwZW5kKCIsIHN1YnNjcmliZXJJZDog\nIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBl\nbmQoc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpKS5hcHBlbmQoIiwgb3Bl\ncmF0aW9uVHlwZTogIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC5hcHBlbmQob3BlcmF0aW9uVHlwZSk7CiAgICAgICAgICAgIGlm\nIChudWxsICE9IG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGRlYnVnTXNn\nLmFwcGVuZCgiLCBjcmVhdGVPckF0dGFjaDogIikuYXBwZW5kKG9wdGlvbnMu\nZ2V0Q3JlYXRlT3JBdHRhY2goKSkKICAgICAgICAgICAgICAgICAgICAgICAg\nLmFwcGVuZCgiLCBtZXNzYWdlQm91bmQ6ICIpLmFwcGVuZChvcHRpb25zLmdl\ndE1lc3NhZ2VCb3VuZCgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBs\nb2dnZXIuZGVidWcoZGVidWdNc2cudG9TdHJpbmcoKSk7CiAgICAgICAgfQog\nICAgICAgIC8vIENoZWNrIGlmIHdlIGtub3cgd2hpY2ggc2VydmVyIGhvc3Qg\naXMgdGhlIG1hc3RlciBmb3IgdGhlIHRvcGljIHdlIGFyZQogICAgICAgIC8v\nIHN1YnNjcmliaW5nIHRvLgogICAgICAgIFB1YlN1YkRhdGEgcHViU3ViRGF0\nYSA9IG5ldyBQdWJTdWJEYXRhKHRvcGljLCBudWxsLCBzdWJzY3JpYmVySWQs\nIG9wZXJhdGlvblR5cGUsIG9wdGlvbnMsIGNhbGxiYWNrLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQp\nOwogICAgICAgIGlmIChjbGllbnQudG9waWMySG9zdC5jb250YWluc0tleSh0\nb3BpYykpIHsKICAgICAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgaG9zdCA9\nIGNsaWVudC50b3BpYzJIb3N0LmdldCh0b3BpYyk7CiAgICAgICAgICAgIGlm\nIChvcGVyYXRpb25UeXBlLmVxdWFscyhPcGVyYXRpb25UeXBlLlVOU1VCU0NS\nSUJFKSAmJiBjbGllbnQuZ2V0UHVibGlzaGVyKCkuaG9zdDJDaGFubmVsLmNv\nbnRhaW5zS2V5KGhvc3QpKSB7CiAgICAgICAgICAgICAgICAvLyBGb3IgdW5z\ndWJzY3JpYmVzLCB3ZSBjYW4gcmV1c2UgdGhlIGNoYW5uZWwgY29ubmVjdGlv\nbnMgdG8gdGhlCiAgICAgICAgICAgICAgICAvLyBzZXJ2ZXIgaG9zdCB0aGF0\nIGFyZSBjYWNoZWQgZm9yIHB1Ymxpc2hlcy4gRm9yIHB1Ymxpc2ggYW5kCiAg\nICAgICAgICAgICAgICAvLyB1bnN1YnNjcmliZSBmbG93cywgd2Ugd2lsbCB0\naHVzIHVzZSB0aGUgc2FtZSBDaGFubmVscyBhbmQKICAgICAgICAgICAgICAg\nIC8vIHdpbGwgY2FjaGUgYW5kIHN0b3JlIHRoZW0gZHVyaW5nIHRoZSBDb25u\nZWN0Q2FsbGJhY2suCiAgICAgICAgICAgICAgICBkb1N1YlVuc3ViKHB1YlN1\nYkRhdGEsIGNsaWVudC5nZXRQdWJsaXNoZXIoKS5ob3N0MkNoYW5uZWwuZ2V0\nKGhvc3QpKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAg\nIC8vIFdlIGtub3cgd2hpY2ggc2VydmVyIGhvc3QgaXMgdGhlIG1hc3RlciBm\nb3IgdGhlIHRvcGljIHNvCiAgICAgICAgICAgICAgICAvLyBjb25uZWN0IHRv\nIHRoYXQgZmlyc3QuIEZvciBzdWJzY3JpYmVzLCB3ZSB3YW50IGEgbmV3IGNo\nYW5uZWwKICAgICAgICAgICAgICAgIC8vIGNvbm5lY3Rpb24gZWFjaCB0aW1l\nIGZvciB0aGUgVG9waWNTdWJzY3JpYmVyLiBJZiB0aGUKICAgICAgICAgICAg\nICAgIC8vIFRvcGljU3Vic2NyaWJlciBpcyBhbHJlYWR5IGNvbm5lY3RlZCBh\nbmQgc3Vic2NyaWJlZCwKICAgICAgICAgICAgICAgIC8vIHdlIGFzc3VtZSB0\naGUgc2VydmVyIHdpbGwgcmVzcG9uZCB3aXRoIGFuIGFwcHJvcHJpYXRlIHN0\nYXR1cwogICAgICAgICAgICAgICAgLy8gaW5kaWNhdGluZyB0aGlzLiBGb3Ig\ndW5zdWJzY3JpYmVzLCBpdCBpcyBwb3NzaWJsZSB0aGF0IHRoZQogICAgICAg\nICAgICAgICAgLy8gY2xpZW50IGlzIHN1YnNjcmliZWQgdG8gdGhlIHRvcGlj\nIGFscmVhZHkgYnV0IGRvZXMgbm90CiAgICAgICAgICAgICAgICAvLyBoYXZl\nIGEgQ2hhbm5lbCBjb25uZWN0aW9uIHlldCB0byB0aGUgc2VydmVyIGhvc3Qu\nIGUuZy4gQ2xpZW50CiAgICAgICAgICAgICAgICAvLyBnb2VzIGRvd24gYW5k\nIGNvbWVzIGJhY2sgdXAgYnV0IGNsaWVudCBzaWRlIHNvZnQgc3RhdGUgbWVt\nb3J5CiAgICAgICAgICAgICAgICAvLyBkb2VzIG5vdCBoYXZlIHRoZSBuZXR0\neSBDaGFubmVsIGNvbm5lY3Rpb24gYW55bW9yZS4KICAgICAgICAgICAgICAg\nIGNsaWVudC5kb0Nvbm5lY3QocHViU3ViRGF0YSwgaG9zdCk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBTZXJ2ZXIg\naG9zdCBmb3IgdGhlIGdpdmVuIHRvcGljIGlzIG5vdCBrbm93biB5ZXQgc28g\ndXNlIHRoZQogICAgICAgICAgICAvLyBkZWZhdWx0IHNlcnZlciBob3N0L3Bv\ncnQgYXMgZGVmaW5lZCBpbiB0aGUgY29uZmlncy4gVGhpcyBzaG91bGQKICAg\nICAgICAgICAgLy8gcG9pbnQgdG8gdGhlIHNlcnZlciBWSVAgd2hpY2ggd291\nbGQgcmVkaXJlY3QgdG8gYSByYW5kb20gc2VydmVyCiAgICAgICAgICAgIC8v\nICh3aGljaCBtaWdodCBub3QgYmUgdGhlIHNlcnZlciBob3N0aW5nIHRoZSB0\nb3BpYykuCiAgICAgICAgICAgIGNsaWVudC5kb0Nvbm5lY3QocHViU3ViRGF0\nYSwgY2ZnLmdldERlZmF1bHRTZXJ2ZXJIb3N0KCkpOwogICAgICAgIH0KICAg\nIH0KCiAgICBwdWJsaWMgdm9pZCBzdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3Bp\nYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0YWNoIG1v\nZGUpCiAgICAgICAgICAgIHRocm93cyBDb3VsZE5vdENvbm5lY3RFeGNlcHRp\nb24sIENsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uLCBTZXJ2aWNl\nRG93bkV4Y2VwdGlvbiwKICAgICAgICBJbnZhbGlkU3Vic2NyaWJlcklkRXhj\nZXB0aW9uIHsKICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnMg\nPSBTdWJzY3JpcHRpb25PcHRpb25zLm5ld0J1aWxkZXIoKS5zZXRDcmVhdGVP\nckF0dGFjaChtb2RlKS5idWlsZCgpOwogICAgICAgIHN1YnNjcmliZSh0b3Bp\nYywgc3Vic2NyaWJlcklkLCBvcHRpb25zLCBmYWxzZSk7CiAgICB9CgogICAg\ncHVibGljIHZvaWQgc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVT\ndHJpbmcgc3Vic2NyaWJlcklkLCBTdWJzY3JpcHRpb25PcHRpb25zIG9wdGlv\nbnMpCiAgICAgICAgICAgIHRocm93cyBDb3VsZE5vdENvbm5lY3RFeGNlcHRp\nb24sIENsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uLCBTZXJ2aWNl\nRG93bkV4Y2VwdGlvbiwKICAgICAgICAgSW52YWxpZFN1YnNjcmliZXJJZEV4\nY2VwdGlvbiB7CiAgICAgICAgc3Vic2NyaWJlKHRvcGljLCBzdWJzY3JpYmVy\nSWQsIG9wdGlvbnMsIGZhbHNlKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgdm9p\nZCBzdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJz\nY3JpYmVySWQsIFN1YnNjcmlwdGlvbk9wdGlvbnMgb3B0aW9ucywgYm9vbGVh\nbiBpc0h1YikKICAgICAgICAgICAgdGhyb3dzIENvdWxkTm90Q29ubmVjdEV4\nY2VwdGlvbiwgQ2xpZW50QWxyZWFkeVN1YnNjcmliZWRFeGNlcHRpb24sIFNl\ncnZpY2VEb3duRXhjZXB0aW9uLAogICAgICAgIEludmFsaWRTdWJzY3JpYmVy\nSWRFeGNlcHRpb24gewogICAgICAgIC8vIFZhbGlkYXRlIHRoYXQgdGhlIGZv\ncm1hdCBvZiB0aGUgc3Vic2NyaWJlcklkIGlzIHZhbGlkIGVpdGhlciBhcyBh\nCiAgICAgICAgLy8gbG9jYWwgb3IgaHViIHN1YnNjcmliZXIuCiAgICAgICAg\naWYgKCFpc1ZhbGlkU3Vic2NyaWJlcklkKHN1YnNjcmliZXJJZCwgaXNIdWIp\nKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZhbGlkU3Vic2NyaWJlcklk\nRXhjZXB0aW9uKCJTdWJzY3JpYmVySWQgcGFzc2VkIGlzIG5vdCB2YWxpZDog\nIiArIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIsIGlz\nSHViOiAiICsgaXNIdWIpOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAg\nICAgICAgICBzdWJVbnN1Yih0b3BpYywgc3Vic2NyaWJlcklkLCBPcGVyYXRp\nb25UeXBlLlNVQlNDUklCRSwgb3B0aW9ucyk7CiAgICAgICAgfSBjYXRjaCAo\nQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAg\nIGxvZ2dlci5lcnJvcigiVW5leHBlY3RlZCBFeGNlcHRpb24gdGhyb3duOiAi\nICsgZS50b1N0cmluZygpKTsKICAgICAgICAgICAgLy8gVGhpcyBleGNlcHRp\nb24gc2hvdWxkIG5ldmVyIGJlIHRocm93biBoZXJlLiBCdXQganVzdCBpbiBj\nYXNlLAogICAgICAgICAgICAvLyB0aHJvdyBhIGdlbmVyaWMgU2VydmljZURv\nd25FeGNlcHRpb24gYnV0IHdyYXAgdGhlIG9yaWdpbmFsCiAgICAgICAgICAg\nIC8vIEV4Y2VwdGlvbiB3aXRoaW4gaXQuCiAgICAgICAgICAgIHRocm93IG5l\ndyBTZXJ2aWNlRG93bkV4Y2VwdGlvbihlKTsKICAgICAgICB9CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYXN5bmNTdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3Bp\nYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0YWNoIG1v\nZGUsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBTdWJz\nY3JpcHRpb25PcHRpb25zIG9wdGlvbnMgPSBTdWJzY3JpcHRpb25PcHRpb25z\nLm5ld0J1aWxkZXIoKS5zZXRDcmVhdGVPckF0dGFjaChtb2RlKS5idWlsZCgp\nOwogICAgICAgIGFzeW5jU3Vic2NyaWJlKHRvcGljLCBzdWJzY3JpYmVySWQs\nIG9wdGlvbnMsIGNhbGxiYWNrLCBjb250ZXh0LCBmYWxzZSk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgYXN5bmNTdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3Bp\nYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsIFN1YnNjcmlwdGlvbk9wdGlv\nbnMgb3B0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIENh\nbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY29udGV4dCkgewogICAg\nICAgIGFzeW5jU3Vic2NyaWJlKHRvcGljLCBzdWJzY3JpYmVySWQsIG9wdGlv\nbnMsIGNhbGxiYWNrLCBjb250ZXh0LCBmYWxzZSk7CiAgICB9CgogICAgcHJv\ndGVjdGVkIHZvaWQgYXN5bmNTdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywg\nQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBTdWJzY3JpcHRpb25PcHRpb25zIG9wdGlvbnMsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lk\nPiBjYWxsYmFjaywgT2JqZWN0IGNvbnRleHQsIGJvb2xlYW4gaXNIdWIpIHsK\nICAgICAgICAvLyBWYWxpZGF0ZSB0aGF0IHRoZSBmb3JtYXQgb2YgdGhlIHN1\nYnNjcmliZXJJZCBpcyB2YWxpZCBlaXRoZXIgYXMgYQogICAgICAgIC8vIGxv\nY2FsIG9yIGh1YiBzdWJzY3JpYmVyLgogICAgICAgIGlmICghaXNWYWxpZFN1\nYnNjcmliZXJJZChzdWJzY3JpYmVySWQsIGlzSHViKSkgewogICAgICAgICAg\nICBjYWxsYmFjay5vcGVyYXRpb25GYWlsZWQoY29udGV4dCwgbmV3IFNlcnZp\nY2VEb3duRXhjZXB0aW9uKG5ldyBJbnZhbGlkU3Vic2NyaWJlcklkRXhjZXB0\naW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICJTdWJzY3JpYmVySWQgcGFzc2VkIGlzIG5vdCB2YWxpZDogIiArIHN1YnNj\ncmliZXJJZC50b1N0cmluZ1V0ZjgoKSArICIsIGlzSHViOiAiICsgaXNIdWIp\nKSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgYXN5\nbmNTdWJVbnN1Yih0b3BpYywgc3Vic2NyaWJlcklkLCBjYWxsYmFjaywgY29u\ndGV4dCwgT3BlcmF0aW9uVHlwZS5TVUJTQ1JJQkUsIG9wdGlvbnMpOwogICAg\nfQoKICAgIHB1YmxpYyB2b2lkIHVuc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9w\naWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3MgQ291bGROb3RD\nb25uZWN0RXhjZXB0aW9uLAogICAgICAgIENsaWVudE5vdFN1YnNjcmliZWRF\neGNlcHRpb24sIFNlcnZpY2VEb3duRXhjZXB0aW9uLCBJbnZhbGlkU3Vic2Ny\naWJlcklkRXhjZXB0aW9uIHsKICAgICAgICB1bnN1YnNjcmliZSh0b3BpYywg\nc3Vic2NyaWJlcklkLCBmYWxzZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZv\naWQgdW5zdWJzY3JpYmUoQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBz\ndWJzY3JpYmVySWQsIGJvb2xlYW4gaXNIdWIpCiAgICAgICAgICAgIHRocm93\ncyBDb3VsZE5vdENvbm5lY3RFeGNlcHRpb24sIENsaWVudE5vdFN1YnNjcmli\nZWRFeGNlcHRpb24sIFNlcnZpY2VEb3duRXhjZXB0aW9uLAogICAgICAgIElu\ndmFsaWRTdWJzY3JpYmVySWRFeGNlcHRpb24gewogICAgICAgIC8vIFZhbGlk\nYXRlIHRoYXQgdGhlIGZvcm1hdCBvZiB0aGUgc3Vic2NyaWJlcklkIGlzIHZh\nbGlkIGVpdGhlciBhcyBhCiAgICAgICAgLy8gbG9jYWwgb3IgaHViIHN1YnNj\ncmliZXIuCiAgICAgICAgaWYgKCFpc1ZhbGlkU3Vic2NyaWJlcklkKHN1YnNj\ncmliZXJJZCwgaXNIdWIpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBJbnZh\nbGlkU3Vic2NyaWJlcklkRXhjZXB0aW9uKCJTdWJzY3JpYmVySWQgcGFzc2Vk\nIGlzIG5vdCB2YWxpZDogIiArIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0Zjgo\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArICIsIGlzSHViOiAiICsgaXNIdWIpOwogICAgICAgIH0KICAg\nICAgICAvLyBTeW5jaHJvbm91c2x5IGNsb3NlIHRoZSBzdWJzY3JpcHRpb24g\nb24gdGhlIGNsaWVudCBzaWRlLiBFdmVuCiAgICAgICAgLy8gaWYgdGhlIHVu\nc3Vic2NyaWJlIHJlcXVlc3QgdG8gdGhlIHNlcnZlciBlcnJvcnMgb3V0LCB3\nZSB3b24ndCBiZQogICAgICAgIC8vIGRlbGl2ZXJpbmcgbWVzc2FnZXMgZm9y\nIHRoaXMgc3Vic2NyaXB0aW9uIHRvIHRoZSBjbGllbnQuIFRoZSBjbGllbnQK\nICAgICAgICAvLyBjYW4gbGF0ZXIgcmV0cnkgdGhlIHVuc3Vic2NyaWJlIHJl\ncXVlc3QgdG8gdGhlIHNlcnZlciBzbyB0aGV5IGFyZQogICAgICAgIC8vICJm\ndWxseSIgdW5zdWJzY3JpYmVkIGZyb20gdGhlIGdpdmVuIHRvcGljLgogICAg\nICAgIGNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWJzY3JpYmVySWQpOwog\nICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN1YlVuc3ViKHRvcGljLCBzdWJz\nY3JpYmVySWQsIE9wZXJhdGlvblR5cGUuVU5TVUJTQ1JJQkUsIG51bGwpOwog\nICAgICAgIH0gY2F0Y2ggKENsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJVbmV4cGVjdGVk\nIEV4Y2VwdGlvbiB0aHJvd246ICIgKyBlLnRvU3RyaW5nKCkpOwogICAgICAg\nICAgICAvLyBUaGlzIGV4Y2VwdGlvbiBzaG91bGQgbmV2ZXIgYmUgdGhyb3du\nIGhlcmUuIEJ1dCBqdXN0IGluIGNhc2UsCiAgICAgICAgICAgIC8vIHRocm93\nIGEgZ2VuZXJpYyBTZXJ2aWNlRG93bkV4Y2VwdGlvbiBidXQgd3JhcCB0aGUg\nb3JpZ2luYWwKICAgICAgICAgICAgLy8gRXhjZXB0aW9uIHdpdGhpbiBpdC4K\nICAgICAgICAgICAgdGhyb3cgbmV3IFNlcnZpY2VEb3duRXhjZXB0aW9uKGUp\nOwogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3luY1Vuc3Vi\nc2NyaWJlKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJp\nbmcgc3Vic2NyaWJlcklkLCBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYWxsYmFj\naywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmluYWwgT2Jq\nZWN0IGNvbnRleHQpIHsKICAgICAgICBhc3luY1Vuc3Vic2NyaWJlKHRvcGlj\nLCBzdWJzY3JpYmVySWQsIGNhbGxiYWNrLCBjb250ZXh0LCBmYWxzZSk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgYXN5bmNVbnN1YnNjcmliZShmaW5h\nbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBCeXRlU3RyaW5nIHN1YnNjcmli\nZXJJZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlu\nYWwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ssIGZpbmFsIE9iamVjdCBjb250\nZXh0LCBib29sZWFuIGlzSHViKSB7CiAgICAgICAgLy8gVmFsaWRhdGUgdGhh\ndCB0aGUgZm9ybWF0IG9mIHRoZSBzdWJzY3JpYmVySWQgaXMgdmFsaWQgZWl0\naGVyIGFzIGEKICAgICAgICAvLyBsb2NhbCBvciBodWIgc3Vic2NyaWJlci4K\nICAgICAgICBpZiAoIWlzVmFsaWRTdWJzY3JpYmVySWQoc3Vic2NyaWJlcklk\nLCBpc0h1YikpIHsKICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmFp\nbGVkKGNvbnRleHQsIG5ldyBTZXJ2aWNlRG93bkV4Y2VwdGlvbihuZXcgSW52\nYWxpZFN1YnNjcmliZXJJZEV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAiU3Vic2NyaWJlcklkIHBhc3NlZCBp\ncyBub3QgdmFsaWQ6ICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkg\nKyAiLCBpc0h1YjogIiArIGlzSHViKSkpOwogICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgfQogICAgICAgIC8vIEFzeW5jaHJvbm91c2x5IGNsb3NlIHRo\nZSBzdWJzY3JpcHRpb24uIE9uIHRoZSBjYWxsYmFjayB0byB0aGF0CiAgICAg\nICAgLy8gb3BlcmF0aW9uIG9uY2UgaXQgY29tcGxldGVzLCBwb3N0IHRoZSBh\nc3luYyB1bnN1YnNjcmliZSByZXF1ZXN0LgogICAgICAgIGFzeW5jQ2xvc2VT\ndWJzY3JpcHRpb24odG9waWMsIHN1YnNjcmliZXJJZCwgbmV3IENhbGxiYWNr\nPFZvaWQ+KCkgewogICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\ncHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9p\nZCByZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgYXN5bmNT\ndWJVbnN1Yih0b3BpYywgc3Vic2NyaWJlcklkLCBjYWxsYmFjaywgY29udGV4\ndCwgT3BlcmF0aW9uVHlwZS5VTlNVQlNDUklCRSwgbnVsbCk7CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJs\naWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhj\nZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgY2FsbGJhY2su\nb3BlcmF0aW9uRmFpbGVkKGNvbnRleHQsIGV4Y2VwdGlvbik7CiAgICAgICAg\nICAgIH0KICAgICAgICB9LCBudWxsKTsKICAgIH0KCiAgICAvLyBUaGlzIGlz\nIGEgaGVscGVyIG1ldGhvZCB0byBkZXRlcm1pbmUgaWYgYSBzdWJzY3JpYmVy\nSWQgaXMgdmFsaWQgYXMgZWl0aGVyCiAgICAvLyBhIGh1YiBvciBsb2NhbCBz\ndWJzY3JpYmVyCiAgICBwcml2YXRlIGJvb2xlYW4gaXNWYWxpZFN1YnNjcmli\nZXJJZChCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgYm9vbGVhbiBpc0h1Yikg\newogICAgICAgIGlmICgoaXNIdWIgJiYgIVN1YnNjcmlwdGlvblN0YXRlVXRp\nbHMuaXNIdWJTdWJzY3JpYmVyKHN1YnNjcmliZXJJZCkpCiAgICAgICAgICAg\nICAgICB8fCAoIWlzSHViICYmIFN1YnNjcmlwdGlvblN0YXRlVXRpbHMuaXNI\ndWJTdWJzY3JpYmVyKHN1YnNjcmliZXJJZCkpKQogICAgICAgICAgICByZXR1\ncm4gZmFsc2U7CiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gdHJ1\nZTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjb25zdW1lKEJ5dGVTdHJpbmcg\ndG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBNZXNzYWdlU2VxSWQg\nbWVzc2FnZVNlcUlkKQogICAgICAgICAgICB0aHJvd3MgQ2xpZW50Tm90U3Vi\nc2NyaWJlZEV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVn\nRW5hYmxlZCgpKQogICAgICAgICAgICBsb2dnZXIuZGVidWcoIkNhbGxpbmcg\nY29uc3VtZSBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSAr\nICIsIHN1YnNjcmliZXJJZDogIgogICAgICAgICAgICAgICAgICAgICAgICAg\nKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkgKyAiLCBtZXNzYWdlU2Vx\nSWQ6ICIgKyBtZXNzYWdlU2VxSWQpOwogICAgICAgIFRvcGljU3Vic2NyaWJl\nciB0b3BpY1N1YnNjcmliZXIgPSBuZXcgVG9waWNTdWJzY3JpYmVyKHRvcGlj\nLCBzdWJzY3JpYmVySWQpOwogICAgICAgIC8vIENoZWNrIHRoYXQgdGhpcyB0\nb3BpYyBzdWJzY3JpcHRpb24gb24gdGhlIGNsaWVudCBzaWRlIGV4aXN0cy4K\nICAgICAgICBpZiAoIXRvcGljU3Vic2NyaWJlcjJDaGFubmVsLmNvbnRhaW5z\nS2V5KHRvcGljU3Vic2NyaWJlcikpIHsKICAgICAgICAgICAgdGhyb3cgbmV3\nIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24oCiAgICAgICAgICAgICAg\nICAiQ2Fubm90IHNlbmQgY29uc3VtZSBtZXNzYWdlIHNpbmNlIGNsaWVudCBp\ncyBub3Qgc3Vic2NyaWJlZCB0byB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5n\nVXRmOCgpCiAgICAgICAgICAgICAgICArICIsIHN1YnNjcmliZXJJZDogIiAr\nIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgfQogICAg\nICAgIFB1YlN1YkRhdGEgcHViU3ViRGF0YSA9IG5ldyBQdWJTdWJEYXRhKHRv\ncGljLCBudWxsLCBzdWJzY3JpYmVySWQsIE9wZXJhdGlvblR5cGUuQ09OU1VN\nRSwgbnVsbCwgbnVsbCwgbnVsbCk7CiAgICAgICAgLy8gU2VuZCB0aGUgY29u\nc3VtZSBtZXNzYWdlIHRvIHRoZSBzZXJ2ZXIgdXNpbmcgdGhlIHNhbWUgc3Vi\nc2NyaWJlCiAgICAgICAgLy8gY2hhbm5lbCB0aGF0IHRoZSB0b3BpYyBzdWJz\nY3JpcHRpb24gdXNlcy4KICAgICAgICBkb0NvbnN1bWUocHViU3ViRGF0YSwg\ndG9waWNTdWJzY3JpYmVyMkNoYW5uZWwuZ2V0KHRvcGljU3Vic2NyaWJlciks\nIG1lc3NhZ2VTZXFJZCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIGlz\nIGEgaGVscGVyIG1ldGhvZCB0byB3cml0ZSB0aGUgYWN0dWFsIHN1YnNjcmli\nZS91bnN1YnNjcmliZSBtZXNzYWdlCiAgICAgKiBvbmNlIHRoZSBjbGllbnQg\naXMgY29ubmVjdGVkIHRvIHRoZSBzZXJ2ZXIgYW5kIGEgQ2hhbm5lbCBpcyBh\ndmFpbGFibGUuCiAgICAgKgogICAgICogQHBhcmFtIHB1YlN1YkRhdGEKICAg\nICAqICAgICAgICAgICAgU3Vic2NyaWJlL1Vuc3Vic2NyaWJlIGNhbGwncyBk\nYXRhIHdyYXBwZXIgb2JqZWN0LiBXZSBhc3N1bWUKICAgICAqICAgICAgICAg\nICAgdGhhdCB0aGUgb3BlcmF0aW9uVHlwZSBmaWVsZCBpcyBlaXRoZXIgU1VC\nU0NSSUJFIG9yCiAgICAgKiAgICAgICAgICAgIFVOU1VCU0NSSUJFLgogICAg\nICogQHBhcmFtIGNoYW5uZWwKICAgICAqICAgICAgICAgICAgTmV0dHkgSS9P\nIGNoYW5uZWwgZm9yIGNvbW11bmljYXRpb24gYmV0d2VlbiB0aGUgY2xpZW50\nIGFuZAogICAgICogICAgICAgICAgICBzZXJ2ZXIKICAgICAqLwogICAgcHJv\ndGVjdGVkIHZvaWQgZG9TdWJVbnN1YihQdWJTdWJEYXRhIHB1YlN1YkRhdGEs\nIENoYW5uZWwgY2hhbm5lbCkgewogICAgICAgIC8vIENyZWF0ZSBhIFB1YlN1\nYlJlcXVlc3QKICAgICAgICBQdWJTdWJSZXF1ZXN0LkJ1aWxkZXIgcHVic3Vi\nUmVxdWVzdEJ1aWxkZXIgPSBQdWJTdWJSZXF1ZXN0Lm5ld0J1aWxkZXIoKTsK\nICAgICAgICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5zZXRQcm90b2NvbFZlcnNp\nb24oUHJvdG9jb2xWZXJzaW9uLlZFUlNJT05fT05FKTsKICAgICAgICBwdWJz\ndWJSZXF1ZXN0QnVpbGRlci5zZXRUeXBlKHB1YlN1YkRhdGEub3BlcmF0aW9u\nVHlwZSk7CiAgICAgICAgaWYgKHB1YlN1YkRhdGEudHJpZWRTZXJ2ZXJzICE9\nIG51bGwgJiYgcHViU3ViRGF0YS50cmllZFNlcnZlcnMuc2l6ZSgpID4gMCkg\newogICAgICAgICAgICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5hZGRBbGxUcmll\nZFNlcnZlcnMocHViU3ViRGF0YS50cmllZFNlcnZlcnMpOwogICAgICAgIH0K\nICAgICAgICBsb25nIHR4bklkID0gY2xpZW50Lmdsb2JhbENvdW50ZXIuaW5j\ncmVtZW50QW5kR2V0KCk7CiAgICAgICAgcHVic3ViUmVxdWVzdEJ1aWxkZXIu\nc2V0VHhuSWQodHhuSWQpOwogICAgICAgIHB1YnN1YlJlcXVlc3RCdWlsZGVy\nLnNldFNob3VsZENsYWltKHB1YlN1YkRhdGEuc2hvdWxkQ2xhaW0pOwogICAg\nICAgIHB1YnN1YlJlcXVlc3RCdWlsZGVyLnNldFRvcGljKHB1YlN1YkRhdGEu\ndG9waWMpOwoKICAgICAgICAvLyBDcmVhdGUgZWl0aGVyIHRoZSBTdWJzY3Jp\nYmUgb3IgVW5zdWJzY3JpYmUgUmVxdWVzdAogICAgICAgIGlmIChwdWJTdWJE\nYXRhLm9wZXJhdGlvblR5cGUuZXF1YWxzKE9wZXJhdGlvblR5cGUuU1VCU0NS\nSUJFKSkgewogICAgICAgICAgICAvLyBDcmVhdGUgdGhlIFN1YnNjcmliZVJl\ncXVlc3QKICAgICAgICAgICAgU3Vic2NyaWJlUmVxdWVzdC5CdWlsZGVyIHN1\nYnNjcmliZVJlcXVlc3RCdWlsZGVyID0gU3Vic2NyaWJlUmVxdWVzdC5uZXdC\ndWlsZGVyKCk7CiAgICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWlsZGVy\nLnNldFN1YnNjcmliZXJJZChwdWJTdWJEYXRhLnN1YnNjcmliZXJJZCk7CiAg\nICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWlsZGVyLnNldENyZWF0ZU9y\nQXR0YWNoKHB1YlN1YkRhdGEub3B0aW9ucy5nZXRDcmVhdGVPckF0dGFjaCgp\nKTsKICAgICAgICAgICAgLy8gRm9yIG5vdywgYWxsIHN1YnNjcmliZXMgc2hv\ndWxkIHdhaXQgZm9yIGFsbCBjcm9zcy1yZWdpb25hbAogICAgICAgICAgICAv\nLyBzdWJzY3JpcHRpb25zIHRvIGJlIGVzdGFibGlzaGVkIGJlZm9yZSByZXR1\ncm5pbmcuCiAgICAgICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWlsZGVyLnNl\ndFN5bmNocm9ub3VzKHRydWUpOwoKICAgICAgICAgICAgaWYgKHB1YlN1YkRh\ndGEub3B0aW9ucy5nZXRNZXNzYWdlQm91bmQoKSA+IDApIHsKICAgICAgICAg\nICAgICAgIHN1YnNjcmliZVJlcXVlc3RCdWlsZGVyLnNldE1lc3NhZ2VCb3Vu\nZChwdWJTdWJEYXRhLm9wdGlvbnMuZ2V0TWVzc2FnZUJvdW5kKCkpOwogICAg\nICAgICAgICB9IGVsc2UgaWYgKGNmZy5nZXRTdWJzY3JpcHRpb25NZXNzYWdl\nQm91bmQoKSA+IDApIHsKICAgICAgICAgICAgICAgIHN1YnNjcmliZVJlcXVl\nc3RCdWlsZGVyLnNldE1lc3NhZ2VCb3VuZChjZmcuZ2V0U3Vic2NyaXB0aW9u\nTWVzc2FnZUJvdW5kKCkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAv\nLyBTZXQgdGhlIFN1YnNjcmliZVJlcXVlc3QgaW50byB0aGUgb3V0ZXIgUHVi\nU3ViUmVxdWVzdAogICAgICAgICAgICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5z\nZXRTdWJzY3JpYmVSZXF1ZXN0KHN1YnNjcmliZVJlcXVlc3RCdWlsZGVyKTsK\nICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBDcmVhdGUgdGhlIFVu\nU3Vic2NyaWJlUmVxdWVzdAogICAgICAgICAgICBVbnN1YnNjcmliZVJlcXVl\nc3QuQnVpbGRlciB1bnN1YnNjcmliZVJlcXVlc3RCdWlsZGVyID0gVW5zdWJz\nY3JpYmVSZXF1ZXN0Lm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgdW5zdWJz\nY3JpYmVSZXF1ZXN0QnVpbGRlci5zZXRTdWJzY3JpYmVySWQocHViU3ViRGF0\nYS5zdWJzY3JpYmVySWQpOwoKICAgICAgICAgICAgLy8gU2V0IHRoZSBVbnN1\nYnNjcmliZVJlcXVlc3QgaW50byB0aGUgb3V0ZXIgUHViU3ViUmVxdWVzdAog\nICAgICAgICAgICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5zZXRVbnN1YnNjcmli\nZVJlcXVlc3QodW5zdWJzY3JpYmVSZXF1ZXN0QnVpbGRlcik7CiAgICAgICAg\nfQoKICAgICAgICAvLyBVcGRhdGUgdGhlIFB1YlN1YkRhdGEgd2l0aCB0aGUg\ndHhuSWQgYW5kIHRoZSByZXF1ZXN0V3JpdGVUaW1lCiAgICAgICAgcHViU3Vi\nRGF0YS50eG5JZCA9IHR4bklkOwogICAgICAgIHB1YlN1YkRhdGEucmVxdWVz\ndFdyaXRlVGltZSA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpOwoKICAg\nICAgICAvLyBCZWZvcmUgd2UgZG8gdGhlIHdyaXRlLCBzdG9yZSB0aGlzIGlu\nZm9ybWF0aW9uIGludG8gdGhlCiAgICAgICAgLy8gUmVzcG9uc2VIYW5kbGVy\nIHNvIHdoZW4gdGhlIHNlcnZlciByZXNwb25kcywgd2Uga25vdyB3aGF0CiAg\nICAgICAgLy8gYXBwcm9wcmlhdGUgQ2FsbGJhY2sgRGF0YSB0byBpbnZva2Ug\nZm9yIHRoZSBnaXZlbiB0eG4gSUQuCiAgICAgICAgSGVkd2lnQ2xpZW50SW1w\nbC5nZXRSZXNwb25zZUhhbmRsZXJGcm9tQ2hhbm5lbChjaGFubmVsKS50eG4y\nUHViU3ViRGF0YS5wdXQodHhuSWQsIHB1YlN1YkRhdGEpOwoKICAgICAgICAv\nLyBGaW5hbGx5LCB3cml0ZSB0aGUgU3Vic2NyaWJlIHJlcXVlc3QgdGhyb3Vn\naCB0aGUgQ2hhbm5lbC4KICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFi\nbGVkKCkpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiV3JpdGluZyBhIFN1\nYlVuc3ViIHJlcXVlc3QgdG8gaG9zdDogIiArIEhlZHdpZ0NsaWVudEltcGwu\nZ2V0SG9zdEZyb21DaGFubmVsKGNoYW5uZWwpCiAgICAgICAgICAgICAgICAg\nICAgICAgICArICIgZm9yIHB1YlN1YkRhdGE6ICIgKyBwdWJTdWJEYXRhKTsK\nICAgICAgICBDaGFubmVsRnV0dXJlIGZ1dHVyZSA9IGNoYW5uZWwud3JpdGUo\ncHVic3ViUmVxdWVzdEJ1aWxkZXIuYnVpbGQoKSk7CiAgICAgICAgZnV0dXJl\nLmFkZExpc3RlbmVyKG5ldyBXcml0ZUNhbGxiYWNrKHB1YlN1YkRhdGEsIGNs\naWVudCkpOwogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBpcyBhIGhlbHBl\nciBtZXRob2QgdG8gd3JpdGUgYSBjb25zdW1lIG1lc3NhZ2UgdG8gdGhlIHNl\ncnZlciBhZnRlciBhCiAgICAgKiBzdWJzY3JpYmUgQ2hhbm5lbCBjb25uZWN0\naW9uIGlzIG1hZGUgdG8gdGhlIHNlcnZlciBhbmQgbWVzc2FnZXMgYXJlIGJl\naW5nCiAgICAgKiBjb25zdW1lZCBieSB0aGUgY2xpZW50LgogICAgICoKICAg\nICAqIEBwYXJhbSBwdWJTdWJEYXRhCiAgICAgKiAgICAgICAgICAgIENvbnN1\nbWUgY2FsbCdzIGRhdGEgd3JhcHBlciBvYmplY3QuIFdlIGFzc3VtZSB0aGF0\nIHRoZQogICAgICogICAgICAgICAgICBvcGVyYXRpb25UeXBlIGZpZWxkIGlz\nIENPTlNVTUUuCiAgICAgKiBAcGFyYW0gY2hhbm5lbAogICAgICogICAgICAg\nICAgICBOZXR0eSBJL08gY2hhbm5lbCBmb3IgY29tbXVuaWNhdGlvbiBiZXR3\nZWVuIHRoZSBjbGllbnQgYW5kCiAgICAgKiAgICAgICAgICAgIHNlcnZlcgog\nICAgICogQHBhcmFtIG1lc3NhZ2VTZXFJZAogICAgICogICAgICAgICAgICBN\nZXNzYWdlIFNlcSBJRCBmb3IgdGhlIGxhdGVzdC9sYXN0IG1lc3NhZ2UgdGhl\nIGNsaWVudCBoYXMKICAgICAqICAgICAgICAgICAgY29uc3VtZWQuCiAgICAg\nKi8KICAgIHB1YmxpYyB2b2lkIGRvQ29uc3VtZShmaW5hbCBQdWJTdWJEYXRh\nIHB1YlN1YkRhdGEsIGZpbmFsIENoYW5uZWwgY2hhbm5lbCwgZmluYWwgTWVz\nc2FnZVNlcUlkIG1lc3NhZ2VTZXFJZCkgewogICAgICAgIC8vIENyZWF0ZSBh\nIFB1YlN1YlJlcXVlc3QKICAgICAgICBQdWJTdWJSZXF1ZXN0LkJ1aWxkZXIg\ncHVic3ViUmVxdWVzdEJ1aWxkZXIgPSBQdWJTdWJSZXF1ZXN0Lm5ld0J1aWxk\nZXIoKTsKICAgICAgICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5zZXRQcm90b2Nv\nbFZlcnNpb24oUHJvdG9jb2xWZXJzaW9uLlZFUlNJT05fT05FKTsKICAgICAg\nICBwdWJzdWJSZXF1ZXN0QnVpbGRlci5zZXRUeXBlKE9wZXJhdGlvblR5cGUu\nQ09OU1VNRSk7CiAgICAgICAgbG9uZyB0eG5JZCA9IGNsaWVudC5nbG9iYWxD\nb3VudGVyLmluY3JlbWVudEFuZEdldCgpOwogICAgICAgIHB1YnN1YlJlcXVl\nc3RCdWlsZGVyLnNldFR4bklkKHR4bklkKTsKICAgICAgICBwdWJzdWJSZXF1\nZXN0QnVpbGRlci5zZXRUb3BpYyhwdWJTdWJEYXRhLnRvcGljKTsKCiAgICAg\nICAgLy8gQ3JlYXRlIHRoZSBDb25zdW1lUmVxdWVzdAogICAgICAgIENvbnN1\nbWVSZXF1ZXN0LkJ1aWxkZXIgY29uc3VtZVJlcXVlc3RCdWlsZGVyID0gQ29u\nc3VtZVJlcXVlc3QubmV3QnVpbGRlcigpOwogICAgICAgIGNvbnN1bWVSZXF1\nZXN0QnVpbGRlci5zZXRTdWJzY3JpYmVySWQocHViU3ViRGF0YS5zdWJzY3Jp\nYmVySWQpOwogICAgICAgIGNvbnN1bWVSZXF1ZXN0QnVpbGRlci5zZXRNc2dJ\nZChtZXNzYWdlU2VxSWQpOwoKICAgICAgICAvLyBTZXQgdGhlIENvbnN1bWVS\nZXF1ZXN0IGludG8gdGhlIG91dGVyIFB1YlN1YlJlcXVlc3QKICAgICAgICBw\ndWJzdWJSZXF1ZXN0QnVpbGRlci5zZXRDb25zdW1lUmVxdWVzdChjb25zdW1l\nUmVxdWVzdEJ1aWxkZXIpOwoKICAgICAgICAvLyBGb3IgQ29uc3VtZSByZXF1\nZXN0cywgd2Ugd2lsbCBzZW5kIHRoZW0gZnJvbSB0aGUgY2xpZW50IGluIGEg\nZmlyZSBhbmQKICAgICAgICAvLyBmb3JnZXQgbWFubmVyLiBXZSBhcmUgbm90\nIGV4cGVjdGluZyB0aGUgc2VydmVyIHRvIHNlbmQgYmFjayBhbiBhY2sKICAg\nICAgICAvLyByZXNwb25zZSBzbyBubyBuZWVkIHRvIHJlZ2lzdGVyIHRoaXMg\naW4gdGhlIFJlc3BvbnNlSGFuZGxlci4gVGhlcmUKICAgICAgICAvLyBhcmUg\nbm8gY2FsbGJhY2tzIHRvIGludm9rZSBzaW5jZSB0aGlzIGlzbid0IGEgY2xp\nZW50IGluaXRpYXRlZAogICAgICAgIC8vIGFjdGlvbi4gSW5zdGVhZCwganVz\ndCBoYXZlIGEgZnV0dXJlIGxpc3RlbmVyIHRoYXQgd2lsbCBsb2cgYW4gZXJy\nb3IKICAgICAgICAvLyBtZXNzYWdlIGlmIHRoZXJlIHdhcyBhIHByb2JsZW0g\nd3JpdGluZyB0aGUgY29uc3VtZSByZXF1ZXN0LgogICAgICAgIGlmIChsb2dn\nZXIuaXNEZWJ1Z0VuYWJsZWQoKSkKICAgICAgICAgICAgbG9nZ2VyLmRlYnVn\nKCJXcml0aW5nIGEgQ29uc3VtZSByZXF1ZXN0IHRvIGhvc3Q6ICIgKyBIZWR3\naWdDbGllbnRJbXBsLmdldEhvc3RGcm9tQ2hhbm5lbChjaGFubmVsKQogICAg\nICAgICAgICAgICAgICAgICAgICAgKyAiIHdpdGggbWVzc2FnZVNlcUlkOiAi\nICsgbWVzc2FnZVNlcUlkICsgIiBmb3IgcHViU3ViRGF0YTogIiArIHB1YlN1\nYkRhdGEpOwogICAgICAgIENoYW5uZWxGdXR1cmUgZnV0dXJlID0gY2hhbm5l\nbC53cml0ZShwdWJzdWJSZXF1ZXN0QnVpbGRlci5idWlsZCgpKTsKICAgICAg\nICBmdXR1cmUuYWRkTGlzdGVuZXIobmV3IENoYW5uZWxGdXR1cmVMaXN0ZW5l\ncigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1Ymxp\nYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKENoYW5uZWxGdXR1cmUgZnV0dXJl\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmICghZnV0\ndXJlLmlzU3VjY2VzcygpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2Vy\nLmVycm9yKCJFcnJvciB3cml0aW5nIGEgQ29uc3VtZSByZXF1ZXN0IHRvIGhv\nc3Q6ICIgKyBIZWR3aWdDbGllbnRJbXBsLmdldEhvc3RGcm9tQ2hhbm5lbChj\naGFubmVsKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIg\nd2l0aCBtZXNzYWdlU2VxSWQ6ICIgKyBtZXNzYWdlU2VxSWQgKyAiIGZvciBw\ndWJTdWJEYXRhOiAiICsgcHViU3ViRGF0YSk7CiAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICB9CgogICAgcHVibGlj\nIGJvb2xlYW4gaGFzU3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcgdG9waWMsIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3MgQ291bGROb3RDb25uZWN0\nRXhjZXB0aW9uLAogICAgICAgIFNlcnZpY2VEb3duRXhjZXB0aW9uIHsKICAg\nICAgICAvLyBUaGUgc3Vic2NyaXB0aW9uIHR5cGUgb2YgaW5mbyBzaG91bGQg\nYmUgc3RvcmVkIG9uIHRoZSBzZXJ2ZXIgZW5kLCBub3QKICAgICAgICAvLyB0\naGUgY2xpZW50IHNpZGUuIEV2ZW50dWFsbHksIHRoZSBzZXJ2ZXIgd2lsbCBo\nYXZlIHRoZSBTdWJzY3JpcHRpb24KICAgICAgICAvLyBNYW5hZ2VyIHBhcnQg\ndGhhdCB0aWVzIGludG8gWm9va2VlcGVyIHRvIG1hbmFnZSB0aGlzIGluZm8u\nCiAgICAgICAgLy8gQ29tbWVudGluZyBvdXQgdGhlc2UgdHlwZSBvZiBBUEkn\ncyByZWxhdGVkIHRvIHRoYXQgaGVyZSBmb3Igbm93IHVudGlsCiAgICAgICAg\nLy8gdGhpcyBkYXRhIGlzIGF2YWlsYWJsZSBvbiB0aGUgc2VydmVyLiBXaWxs\nIGZpZ3VyZSBvdXQgd2hhdCB0aGUKICAgICAgICAvLyBjb3JyZWN0IHdheSB0\nbyBjb250YWN0IHRoZSBzZXJ2ZXIgdG8gZ2V0IHRoaXMgaW5mbyBpcyB0aGVu\nLgogICAgICAgIC8vIFRoZSBjbGllbnQgc2lkZSBqdXN0IGhhcyBzb2Z0IG1l\nbW9yeSBzdGF0ZSBmb3IgY2xpZW50IHN1YnNjcmlwdGlvbgogICAgICAgIC8v\nIGluZm9ybWF0aW9uLgogICAgICAgIHJldHVybiB0b3BpY1N1YnNjcmliZXIy\nQ2hhbm5lbC5jb250YWluc0tleShuZXcgVG9waWNTdWJzY3JpYmVyKHRvcGlj\nLCBzdWJzY3JpYmVySWQpKTsKICAgIH0KCiAgICBwdWJsaWMgTGlzdDxCeXRl\nU3RyaW5nPiBnZXRTdWJzY3JpcHRpb25MaXN0KEJ5dGVTdHJpbmcgc3Vic2Ny\naWJlcklkKSB0aHJvd3MgQ291bGROb3RDb25uZWN0RXhjZXB0aW9uLAogICAg\nICAgIFNlcnZpY2VEb3duRXhjZXB0aW9uIHsKICAgICAgICAvLyBTYW1lIGFz\nIHRoZSBwcmV2aW91cyBoYXNTdWJzY3JpcHRpb24gbWV0aG9kLCB0aGlzIGRh\ndGEgc2hvdWxkIHJlc2lkZQogICAgICAgIC8vIG9uIHRoZSBzZXJ2ZXIgZW5k\nLCBub3QgdGhlIGNsaWVudCBzaWRlLgogICAgICAgIHJldHVybiBudWxsOwog\nICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0YXJ0RGVsaXZlcnkoZmluYWwgQnl0\nZVN0cmluZyB0b3BpYywgZmluYWwgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQs\nIE1lc3NhZ2VIYW5kbGVyIG1lc3NhZ2VIYW5kbGVyKQogICAgICAgICAgICB0\naHJvd3MgQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbiwgQWxyZWFkeVN0\nYXJ0RGVsaXZlcnlFeGNlcHRpb24gewogICAgICAgIHN0YXJ0RGVsaXZlcnko\ndG9waWMsIHN1YnNjcmliZXJJZCwgbWVzc2FnZUhhbmRsZXIsIGZhbHNlKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCByZXN0YXJ0RGVsaXZlcnkoZmluYWwg\nQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgQnl0ZVN0cmluZyBzdWJzY3JpYmVy\nSWQpCiAgICAgICAgdGhyb3dzIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRp\nb24sIEFscmVhZHlTdGFydERlbGl2ZXJ5RXhjZXB0aW9uIHsKICAgICAgICBz\ndGFydERlbGl2ZXJ5KHRvcGljLCBzdWJzY3JpYmVySWQsIG51bGwsIHRydWUp\nOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBzdGFydERlbGl2ZXJ5KGZpbmFs\nIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZUhh\nbmRsZXIgbWVzc2FnZUhhbmRsZXIsIGJvb2xlYW4gcmVzdGFydCkKICAgICAg\nICB0aHJvd3MgQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbiwgQWxyZWFk\neVN0YXJ0RGVsaXZlcnlFeGNlcHRpb24gewogICAgICAgIGlmIChsb2dnZXIu\naXNEZWJ1Z0VuYWJsZWQoKSkKICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJT\ndGFydGluZyBkZWxpdmVyeSBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSArICIsIHN1YnNjcmliZXJJZDogIgogICAgICAgICAgICAgICAg\nICAgICAgICAgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkpOwogICAg\nICAgIFRvcGljU3Vic2NyaWJlciB0b3BpY1N1YnNjcmliZXIgPSBuZXcgVG9w\naWNTdWJzY3JpYmVyKHRvcGljLCBzdWJzY3JpYmVySWQpOwogICAgICAgIC8v\nIE1ha2Ugc3VyZSB3ZSBrbm93IGFib3V0IHRoaXMgdG9waWMgc3Vic2NyaXB0\naW9uIG9uIHRoZSBjbGllbnQgc2lkZQogICAgICAgIC8vIGV4aXN0cy4gVGhl\nIGFzc3VtcHRpb24gaXMgdGhhdCB0aGUgY2xpZW50IHNob3VsZCBoYXZlIGlu\nIG1lbW9yeSB0aGUKICAgICAgICAvLyBDaGFubmVsIGNyZWF0ZWQgZm9yIHRo\nZSBUb3BpY1N1YnNjcmliZXIgb25jZSB0aGUgc2VydmVyIGhhcyBzZW50CiAg\nICAgICAgLy8gYW4gYWNrIHJlc3BvbnNlIHRvIHRoZSBpbml0aWFsIHN1YnNj\ncmliZSByZXF1ZXN0LgogICAgICAgIGlmICghdG9waWNTdWJzY3JpYmVyMkNo\nYW5uZWwuY29udGFpbnNLZXkodG9waWNTdWJzY3JpYmVyKSkgewogICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIkNsaWVudCBpcyBub3QgeWV0IHN1YnNjcmli\nZWQgdG8gdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIHN1\nYnNjcmliZXJJZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgKyBzdWJz\nY3JpYmVySWQudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICB0aHJvdyBu\nZXcgQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbigiQ2xpZW50IGlzIG5v\ndCB5ZXQgc3Vic2NyaWJlZCB0byB0b3BpYzogIiArIHRvcGljLnRvU3RyaW5n\nVXRmOCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICsgIiwgc3Vic2NyaWJlcklkOiAiICsgc3Vic2NyaWJl\ncklkLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIFJl\nZ2lzdGVyIHRoZSBNZXNzYWdlSGFuZGxlciB3aXRoIHRoZSBzdWJzY3JpYmUg\nQ2hhbm5lbCdzCiAgICAgICAgLy8gUmVzcG9uc2UgSGFuZGxlci4KICAgICAg\nICBDaGFubmVsIHRvcGljU3Vic2NyaWJlckNoYW5uZWwgPSB0b3BpY1N1YnNj\ncmliZXIyQ2hhbm5lbC5nZXQodG9waWNTdWJzY3JpYmVyKTsKCiAgICAgICAg\nLy8gTmVlZCB0byBlbnN1cmUgdGhlIHNldHRpbmcgb2YgaGFuZGxlciBhbmQg\ndGhlIHJlYWRhYmlsaXR5IG9mIGNoYW5uZWwgaXMgaW4gc3luYwogICAgICAg\nIC8vIGFzIHRoZXJlJ3MgYSByYWNlIGNvbmRpdGlvbiB0aGF0IGNvbm5lY3Rp\nb24gcmVjb3ZlcnkgYW5kIHVzZXIgbWlnaHQgY2FsbCB0aGlzIGF0IHRoZSBz\nYW1lIHRpbWUKCiAgICAgICAgTWVzc2FnZUhhbmRsZXIgZXhpc3RlZE1zZ0hh\nbmRsZXIgPSB0b3BpY1N1YnNjcmliZXIyTWVzc2FnZUhhbmRsZXIuZ2V0KHRv\ncGljU3Vic2NyaWJlcik7CiAgICAgICAgaWYgKHJlc3RhcnQpIHsKICAgICAg\nICAgICAgLy8gcmVzdGFydCB1c2luZyBleGlzdGluZyBtc2cgaGFuZGxlciAK\nICAgICAgICAgICAgbWVzc2FnZUhhbmRsZXIgPSBleGlzdGVkTXNnSGFuZGxl\ncjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBzb21lIGhhcyBz\ndGFydGVkIGRlbGl2ZXJ5IGJ1dCBub3Qgc3RvcCBpdAogICAgICAgICAgICBp\nZiAobnVsbCAhPSBleGlzdGVkTXNnSGFuZGxlcikgewogICAgICAgICAgICAg\nICAgdGhyb3cgbmV3IEFscmVhZHlTdGFydERlbGl2ZXJ5RXhjZXB0aW9uKCJB\nIG1lc3NhZ2UgaGFuZGxlciBoYXMgYmVlbiBzdGFydGVkIGZvciB0b3BpYyBz\ndWJzY3JpYmVyICIgKyB0b3BpY1N1YnNjcmliZXIpOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIGlmIChtZXNzYWdlSGFuZGxlciAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICBpZiAobnVsbCAhPSB0b3BpY1N1YnNjcmliZXIyTWVz\nc2FnZUhhbmRsZXIucHV0SWZBYnNlbnQodG9waWNTdWJzY3JpYmVyLCBtZXNz\nYWdlSGFuZGxlcikpIHsKICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nQWxyZWFkeVN0YXJ0RGVsaXZlcnlFeGNlcHRpb24oIlNvbWVvbmUgaXMgYWxz\nbyBzdGFydGluZyBkZWxpdmVyeSBmb3IgdG9waWMgc3Vic2NyaWJlciAiICsg\ndG9waWNTdWJzY3JpYmVyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgfQogICAgICAgIH0KICAgICAgICBIZWR3aWdDbGllbnRJbXBsLmdldFJl\nc3BvbnNlSGFuZGxlckZyb21DaGFubmVsKHRvcGljU3Vic2NyaWJlckNoYW5u\nZWwpLmdldFN1YnNjcmliZVJlc3BvbnNlSGFuZGxlcigpCiAgICAgICAgLnNl\ndE1lc3NhZ2VIYW5kbGVyKG1lc3NhZ2VIYW5kbGVyKTsKICAgICAgICAvLyBO\nb3cgbWFrZSB0aGUgVG9waWNTdWJzY3JpYmVyIENoYW5uZWwgcmVhZGFibGUg\nKGl0IGlzIHNldCB0byBub3QgYmUKICAgICAgICAvLyByZWFkYWJsZSB3aGVu\nIHRoZSBpbml0aWFsIHN1YnNjcmlwdGlvbiBpcyBkb25lKS4gTm90ZSB0aGF0\nIHRoaXMgaXMgYW4KICAgICAgICAvLyBhc3luY2hyb25vdXMgY2FsbC4gSWYg\ndGhpcyBmYWlscyAobm90IGxpa2VseSksIHRoZSBmdXR1cmVMaXN0ZW5lcgog\nICAgICAgIC8vIHdpbGwganVzdCBsb2cgYW4gZXJyb3IgbWVzc2FnZSBmb3Ig\nbm93LgogICAgICAgIENoYW5uZWxGdXR1cmUgZnV0dXJlID0gdG9waWNTdWJz\nY3JpYmVyQ2hhbm5lbC5zZXRSZWFkYWJsZSh0cnVlKTsKICAgICAgICBmdXR1\ncmUuYWRkTGlzdGVuZXIobmV3IENoYW5uZWxGdXR1cmVMaXN0ZW5lcigpIHsK\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIG9wZXJhdGlvbkNvbXBsZXRlKENoYW5uZWxGdXR1cmUgZnV0dXJlKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmICghZnV0dXJlLmlz\nU3VjY2VzcygpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9y\nKCJVbmFibGUgdG8gbWFrZSBzdWJzY3JpYmVyIENoYW5uZWwgcmVhZGFibGUg\naW4gc3RhcnREZWxpdmVyeSBjYWxsIGZvciB0b3BpYzogIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRmOCgp\nICsgIiwgc3Vic2NyaWJlcklkOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5n\nVXRmOCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAg\nICAgIH0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHN0b3BEZWxpdmVyeShm\naW5hbCBCeXRlU3RyaW5nIHRvcGljLCBmaW5hbCBCeXRlU3RyaW5nIHN1YnNj\ncmliZXJJZCkgdGhyb3dzIENsaWVudE5vdFN1YnNjcmliZWRFeGNlcHRpb24g\newogICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkKICAgICAg\nICAgICAgbG9nZ2VyLmRlYnVnKCJTdG9wcGluZyBkZWxpdmVyeSBmb3IgdG9w\naWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIHN1YnNjcmliZXJJ\nZDogIgogICAgICAgICAgICAgICAgICAgICAgICAgKyBzdWJzY3JpYmVySWQu\ndG9TdHJpbmdVdGY4KCkpOwogICAgICAgIFRvcGljU3Vic2NyaWJlciB0b3Bp\nY1N1YnNjcmliZXIgPSBuZXcgVG9waWNTdWJzY3JpYmVyKHRvcGljLCBzdWJz\nY3JpYmVySWQpOwogICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBrbm93IHRoYXQg\ndGhpcyB0b3BpYyBzdWJzY3JpcHRpb24gb24gdGhlIGNsaWVudCBzaWRlCiAg\nICAgICAgLy8gZXhpc3RzLiBUaGUgYXNzdW1wdGlvbiBpcyB0aGF0IHRoZSBj\nbGllbnQgc2hvdWxkIGhhdmUgaW4gbWVtb3J5IHRoZQogICAgICAgIC8vIENo\nYW5uZWwgY3JlYXRlZCBmb3IgdGhlIFRvcGljU3Vic2NyaWJlciBvbmNlIHRo\nZSBzZXJ2ZXIgaGFzIHNlbnQKICAgICAgICAvLyBhbiBhY2sgcmVzcG9uc2Ug\ndG8gdGhlIGluaXRpYWwgc3Vic2NyaWJlIHJlcXVlc3QuCiAgICAgICAgaWYg\nKCF0b3BpY1N1YnNjcmliZXIyQ2hhbm5lbC5jb250YWluc0tleSh0b3BpY1N1\nYnNjcmliZXIpKSB7CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiQ2xpZW50\nIGlzIG5vdCB5ZXQgc3Vic2NyaWJlZCB0byB0b3BpYzogIiArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpICsgIiwgc3Vic2NyaWJlcklkOiAiCiAgICAgICAgICAg\nICAgICAgICAgICAgICArIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0ZjgoKSk7\nCiAgICAgICAgICAgIHRocm93IG5ldyBDbGllbnROb3RTdWJzY3JpYmVkRXhj\nZXB0aW9uKCJDbGllbnQgaXMgbm90IHlldCBzdWJzY3JpYmVkIHRvIHRvcGlj\nOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBzdWJzY3Jp\nYmVySWQ6ICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkpOwogICAg\nICAgIH0KCiAgICAgICAgLy8gVW5yZWdpc3RlciB0aGUgTWVzc2FnZUhhbmRs\nZXIgZm9yIHRoZSBzdWJzY3JpYmUgQ2hhbm5lbCdzCiAgICAgICAgLy8gUmVz\ncG9uc2UgSGFuZGxlci4KICAgICAgICBDaGFubmVsIHRvcGljU3Vic2NyaWJl\nckNoYW5uZWwgPSB0b3BpY1N1YnNjcmliZXIyQ2hhbm5lbC5nZXQodG9waWNT\ndWJzY3JpYmVyKTsKICAgICAgICBIZWR3aWdDbGllbnRJbXBsLmdldFJlc3Bv\nbnNlSGFuZGxlckZyb21DaGFubmVsKHRvcGljU3Vic2NyaWJlckNoYW5uZWwp\nLmdldFN1YnNjcmliZVJlc3BvbnNlSGFuZGxlcigpCiAgICAgICAgLnNldE1l\nc3NhZ2VIYW5kbGVyKG51bGwpOwogICAgICAgIHRoaXMudG9waWNTdWJzY3Jp\nYmVyMk1lc3NhZ2VIYW5kbGVyLnJlbW92ZSh0b3BpY1N1YnNjcmliZXIpOwog\nICAgICAgIC8vIE5vdyBtYWtlIHRoZSBUb3BpY1N1YnNjcmliZXIgY2hhbm5l\nbCBub3QtcmVhZGFibGUuIFRoaXMgd2lsbCBidWZmZXIKICAgICAgICAvLyB1\ncCBtZXNzYWdlcyBpZiBhbnkgYXJlIHNlbnQgZnJvbSB0aGUgc2VydmVyLiBO\nb3RlIHRoYXQgdGhpcyBpcyBhbgogICAgICAgIC8vIGFzeW5jaHJvbm91cyBj\nYWxsLiBJZiB0aGlzIGZhaWxzIChub3QgbGlrZWx5KSwgdGhlIGZ1dHVyZUxp\nc3RlbmVyCiAgICAgICAgLy8gd2lsbCBqdXN0IGxvZyBhbiBlcnJvciBtZXNz\nYWdlIGZvciBub3cuCiAgICAgICAgQ2hhbm5lbEZ1dHVyZSBmdXR1cmUgPSB0\nb3BpY1N1YnNjcmliZXJDaGFubmVsLnNldFJlYWRhYmxlKGZhbHNlKTsKICAg\nICAgICBmdXR1cmUuYWRkTGlzdGVuZXIobmV3IENoYW5uZWxGdXR1cmVMaXN0\nZW5lcigpIHsKICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkNvbXBsZXRlKENoYW5uZWxGdXR1cmUgZnV0\ndXJlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgICAgIGlmICgh\nZnV0dXJlLmlzU3VjY2VzcygpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJVbmFibGUgdG8gbWFrZSBzdWJzY3JpYmVyIENoYW5uZWwg\nbm90IHJlYWRhYmxlIGluIHN0b3BEZWxpdmVyeSBjYWxsIGZvciB0b3BpYzog\nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpICsgIiwgc3Vic2NyaWJlcklkOiAiICsgc3Vic2NyaWJl\ncklkLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfQogICAgICAgIH0pOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNs\nb3NlU3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcg\nc3Vic2NyaWJlcklkKSB0aHJvd3MgU2VydmljZURvd25FeGNlcHRpb24gewog\nICAgICAgIFB1YlN1YkRhdGEgcHViU3ViRGF0YSA9IG5ldyBQdWJTdWJEYXRh\nKHRvcGljLCBudWxsLCBzdWJzY3JpYmVySWQsIG51bGwsIG51bGwsIG51bGws\nIG51bGwpOwogICAgICAgIHN5bmNocm9uaXplZCAocHViU3ViRGF0YSkgewog\nICAgICAgICAgICBQdWJTdWJDYWxsYmFjayBwdWJTdWJDYWxsYmFjayA9IG5l\ndyBQdWJTdWJDYWxsYmFjayhwdWJTdWJEYXRhKTsKICAgICAgICAgICAgYXN5\nbmNDbG9zZVN1YnNjcmlwdGlvbih0b3BpYywgc3Vic2NyaWJlcklkLCBwdWJT\ndWJDYWxsYmFjaywgbnVsbCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAg\nICAgICAgICB3aGlsZSAoIXB1YlN1YkRhdGEuaXNEb25lKQogICAgICAgICAg\nICAgICAgICAgIHB1YlN1YkRhdGEud2FpdCgpOwogICAgICAgICAgICB9IGNh\ndGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAg\nICB0aHJvdyBuZXcgU2VydmljZURvd25FeGNlcHRpb24oIkludGVycnVwdGVk\nIEV4Y2VwdGlvbiB3aGlsZSB3YWl0aW5nIGZvciBhc3luY0Nsb3NlU3Vic2Ny\naXB0aW9uIGNhbGwiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBD\naGVjayBmcm9tIHRoZSBQdWJTdWJDYWxsYmFjayBpZiBpdCB3YXMgc3VjY2Vz\nc2Z1bCBvciBub3QuCiAgICAgICAgICAgIGlmICghcHViU3ViQ2FsbGJhY2su\nZ2V0SXNDYWxsU3VjY2Vzc2Z1bCgpKSB7CiAgICAgICAgICAgICAgICB0aHJv\ndyBuZXcgU2VydmljZURvd25FeGNlcHRpb24oIkV4Y2VwdGlvbiB3aGlsZSB0\ncnlpbmcgdG8gY2xvc2UgdGhlIHN1YnNjcmlwdGlvbiBmb3IgdG9waWM6ICIK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiwgc3Vic2NyaWJlcklkOiAi\nICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBhc3luY0Nsb3Nl\nU3Vic2NyaXB0aW9uKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZpbmFsIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYWxsYmFj\naywgZmluYWwgT2JqZWN0IGNvbnRleHQpIHsKICAgICAgICBpZiAobG9nZ2Vy\nLmlzRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygi\nQ2xvc2luZyBzdWJzY3JpcHRpb24gYXN5bmNocm9ub3VzbHkgZm9yIHRvcGlj\nOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAiLCBzdWJzY3JpYmVySWQ6\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICsgc3Vic2NyaWJlcklkLnRv\nU3RyaW5nVXRmOCgpKTsKICAgICAgICBUb3BpY1N1YnNjcmliZXIgdG9waWNT\ndWJzY3JpYmVyID0gbmV3IFRvcGljU3Vic2NyaWJlcih0b3BpYywgc3Vic2Ny\naWJlcklkKTsKICAgICAgICBpZiAodG9waWNTdWJzY3JpYmVyMkNoYW5uZWwu\nY29udGFpbnNLZXkodG9waWNTdWJzY3JpYmVyKSkgewogICAgICAgICAgICAv\nLyBSZW1vdmUgYWxsIGNhY2hlZCByZWZlcmVuY2VzIGZvciB0aGUgVG9waWNT\ndWJzY3JpYmVyCiAgICAgICAgICAgIENoYW5uZWwgY2hhbm5lbCA9IHRvcGlj\nU3Vic2NyaWJlcjJDaGFubmVsLmdldCh0b3BpY1N1YnNjcmliZXIpOwogICAg\nICAgICAgICB0b3BpY1N1YnNjcmliZXIyQ2hhbm5lbC5yZW1vdmUodG9waWNT\ndWJzY3JpYmVyKTsKICAgICAgICAgICAgLy8gQ2xvc2UgdGhlIHN1YnNjcmli\nZSBjaGFubmVsIGFzeW5jaHJvbm91c2x5LgogICAgICAgICAgICBIZWR3aWdD\nbGllbnRJbXBsLmdldFJlc3BvbnNlSGFuZGxlckZyb21DaGFubmVsKGNoYW5u\nZWwpLmNoYW5uZWxDbG9zZWRFeHBsaWNpdGx5ID0gdHJ1ZTsKICAgICAgICAg\nICAgQ2hhbm5lbEZ1dHVyZSBmdXR1cmUgPSBjaGFubmVsLmNsb3NlKCk7CiAg\nICAgICAgICAgIGZ1dHVyZS5hZGRMaXN0ZW5lcihuZXcgQ2hhbm5lbEZ1dHVy\nZUxpc3RlbmVyKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAg\nICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25Db21wbGV0ZShDaGFu\nbmVsRnV0dXJlIGZ1dHVyZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAg\nICAgICAgICAgICAgaWYgKCFmdXR1cmUuaXNTdWNjZXNzKCkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gY2xv\nc2UgdGhlIHN1YnNjcmlwdGlvbiBjaGFubmVsIGZvciB0b3BpYzogIiArIHRv\ncGljLnRvU3RyaW5nVXRmOCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArICIsIHN1YnNjcmliZXJJZDogIiArIHN1YnNjcmliZXJJ\nZC50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNh\nbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChjb250ZXh0LCBuZXcgU2VydmljZURv\nd25FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0byBjbG9zZSB0aGUgc3Vi\nc2NyaXB0aW9uIGNoYW5uZWwgZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJp\nbmdVdGY4KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICArICIsIHN1YnNjcmliZXJJZDogIiArIHN1YnNj\ncmliZXJJZC50b1N0cmluZ1V0ZjgoKSkpOwogICAgICAgICAgICAgICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9w\nZXJhdGlvbkZpbmlzaGVkKGNvbnRleHQsIG51bGwpOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgbG9nZ2VyLndhcm4oIlRyeWlu\nZyB0byBjbG9zZSBhIHN1YnNjcmlwdGlvbiB3aGVuIHdlIGRvbid0IGhhdmUg\nYSBzdWJzY3JpYmUgY2hhbm5lbCBjYWNoZWQgZm9yIHRvcGljOiAiCiAgICAg\nICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAi\nLCBzdWJzY3JpYmVySWQ6ICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4\nKCkpOwogICAgICAgICAgICBjYWxsYmFjay5vcGVyYXRpb25GaW5pc2hlZChj\nb250ZXh0LCBudWxsKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gUHVibGlj\nIGdldHRlciBhbmQgc2V0dGVycyBmb3IgZW50cmllcyBpbiB0aGUgdG9waWMy\nSG9zdCBNYXAuCiAgICAvLyBUaGlzIGlzIHVzZWQgZm9yIGNsYXNzZXMgdGhh\ndCBuZWVkIHRoaXMgaW5mb3JtYXRpb24gYnV0IGFyZSBub3QgaW4gdGhlCiAg\nICAvLyBzYW1lIGNsYXNzcGF0aC4KICAgIHB1YmxpYyBDaGFubmVsIGdldENo\nYW5uZWxGb3JUb3BpYyhUb3BpY1N1YnNjcmliZXIgdG9waWMpIHsKICAgICAg\nICByZXR1cm4gdG9waWNTdWJzY3JpYmVyMkNoYW5uZWwuZ2V0KHRvcGljKTsK\nICAgIH0KCiAgICBwdWJsaWMgdm9pZCBzZXRDaGFubmVsRm9yVG9waWMoVG9w\naWNTdWJzY3JpYmVyIHRvcGljLCBDaGFubmVsIGNoYW5uZWwpIHsKICAgICAg\nICBzeW5jaHJvbml6ZWQgKGNsb3NlTG9jaykgewogICAgICAgICAgICBpZiAo\nY2xvc2VkKSB7CiAgICAgICAgICAgICAgICBjaGFubmVsLmNsb3NlKCk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgQ2hhbm5lbCBvbGRjID0gdG9waWNTdWJzY3JpYmVyMkNoYW5uZWwucHV0\nSWZBYnNlbnQodG9waWMsIGNoYW5uZWwpOwogICAgICAgICAgICBpZiAob2xk\nYyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICBjaGFubmVsLmNsb3NlKCk7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgcmVtb3ZlQ2hhbm5lbEZvclRvcGljKFRvcGljU3Vic2NyaWJlciB0b3Bp\nYykgewogICAgICAgIHRvcGljU3Vic2NyaWJlcjJDaGFubmVsLnJlbW92ZSh0\nb3BpYyk7CiAgICB9CgogICAgdm9pZCBjbG9zZSgpIHsKICAgICAgICBzeW5j\naHJvbml6ZWQgKGNsb3NlTG9jaykgewogICAgICAgICAgICBjbG9zZWQgPSB0\ncnVlOwogICAgICAgIH0KCiAgICAgICAgLy8gQ2xvc2UgYWxsIG9mIHRoZSBv\ncGVuIENoYW5uZWxzLgogICAgICAgIGZvciAoQ2hhbm5lbCBjaGFubmVsIDog\ndG9waWNTdWJzY3JpYmVyMkNoYW5uZWwudmFsdWVzKCkpIHsKICAgICAgICAg\nICAgY2xpZW50LmdldFJlc3BvbnNlSGFuZGxlckZyb21DaGFubmVsKGNoYW5u\nZWwpLmNoYW5uZWxDbG9zZWRFeHBsaWNpdGx5ID0gdHJ1ZTsKICAgICAgICAg\nICAgY2hhbm5lbC5jbG9zZSgpLmF3YWl0VW5pbnRlcnJ1cHRpYmx5KCk7CiAg\nICAgICAgfQogICAgICAgIHRvcGljU3Vic2NyaWJlcjJDaGFubmVsLmNsZWFy\nKCk7CiAgICB9Cn0K\n","encoding":"base64"}

