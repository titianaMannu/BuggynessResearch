{"sha":"c4affafa12bf0e334a4a2fba4b0df5c31ccacb79","node_id":"MDQ6QmxvYjE1NzU5NTY6YzRhZmZhZmExMmJmMGUzMzRhNGEyZmJhNGIwZGY1YzMxY2NhY2I3OQ==","size":18783,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c4affafa12bf0e334a4a2fba4b0df5c31ccacb79","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQubmV0dHk7CgppbXBvcnQg\namF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZhLnV0aWwu\nTGlua2VkTGlzdDsKaW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1\ncnJlbnRIYXNoTWFwOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29u\nY3VycmVudE1hcDsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQg\nb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuamJvc3MubmV0\ndHkuY2hhbm5lbC5DaGFubmVsOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNo\nYW5uZWwuQ2hhbm5lbEhhbmRsZXJDb250ZXh0OwppbXBvcnQgb3JnLmpib3Nz\nLm5ldHR5LmNoYW5uZWwuQ2hhbm5lbFBpcGVsaW5lQ292ZXJhZ2U7CmltcG9y\ndCBvcmcuamJvc3MubmV0dHkuY2hhbm5lbC5DaGFubmVsU3RhdGVFdmVudDsK\naW1wb3J0IG9yZy5qYm9zcy5uZXR0eS5jaGFubmVsLkV4Y2VwdGlvbkV2ZW50\nOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuTWVzc2FnZUV2ZW50\nOwppbXBvcnQgb3JnLmpib3NzLm5ldHR5LmNoYW5uZWwuU2ltcGxlQ2hhbm5l\nbEhhbmRsZXI7CmltcG9ydCBvcmcuamJvc3MubmV0dHkuaGFuZGxlci5zc2wu\nU3NsSGFuZGxlcjsKCmltcG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmc7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuY29uZi5D\nbGllbnRDb25maWd1cmF0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\nY2xpZW50LmRhdGEuUHViU3ViRGF0YTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLmNsaWVudC5leGNlcHRpb25zLlNlcnZlclJlZGlyZWN0TG9vcEV4Y2Vw\ndGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5leGNlcHRp\nb25zLlRvb01hbnlTZXJ2ZXJSZWRpcmVjdHNFeGNlcHRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuaGFuZGxlcnMuUHVibGlzaFJlc3Bv\nbnNlSGFuZGxlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5o\nYW5kbGVycy5TdWJzY3JpYmVSZWNvbm5lY3RDYWxsYmFjazsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5oYW5kbGVycy5TdWJzY3JpYmVSZXNw\nb25zZUhhbmRsZXI7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQu\naGFuZGxlcnMuVW5zdWJzY3JpYmVSZXNwb25zZUhhbmRsZXI7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbi5T\nZXJ2aWNlRG93bkV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uLlVuY2VydGFpblN0YXRlRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlwZTsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNl\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RhdHVzQ29kZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0\naWwuSGVkd2lnU29ja2V0QWRkcmVzczsKCkBDaGFubmVsUGlwZWxpbmVDb3Zl\ncmFnZSgiYWxsIikKcHVibGljIGNsYXNzIFJlc3BvbnNlSGFuZGxlciBleHRl\nbmRzIFNpbXBsZUNoYW5uZWxIYW5kbGVyIHsKCiAgICBwcml2YXRlIHN0YXRp\nYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFjdG9yeS5nZXRMb2dnZXIoUmVz\ncG9uc2VIYW5kbGVyLmNsYXNzKTsKCiAgICAvLyBDb25jdXJyZW50IE1hcCB0\nbyBzdG9yZSBmb3IgZWFjaCBhc3luYyBQdWJTdWIgcmVxdWVzdCwgdGhlIHR4\nbiBJRAogICAgLy8gYW5kIHRoZSBjb3JyZXNwb25kaW5nIFB1YlN1YiBjYWxs\nJ3MgZGF0YSB3aGljaCBzdG9yZXMgdGhlIFZvaWRDYWxsYmFjayB0bwogICAg\nLy8gaW52b2tlIHdoZW4gd2UgcmVjZWl2ZSBhIFB1YlN1YiBhY2sgcmVzcG9u\nc2UgZnJvbSB0aGUgc2VydmVyLgogICAgLy8gVGhpcyBpcyBzcGVjaWZpYyB0\nbyB0aGlzIGluc3RhbmNlIG9mIHRoZSBSZXNwb25zZUhhbmRsZXIgd2hpY2gg\naXMKICAgIC8vIHRpZWQgdG8gYSBzcGVjaWZpYyBuZXR0eSBDaGFubmVsIFBp\ncGVsaW5lLgogICAgcHJvdGVjdGVkIGZpbmFsIENvbmN1cnJlbnRNYXA8TG9u\nZywgUHViU3ViRGF0YT4gdHhuMlB1YlN1YkRhdGEgPSBuZXcgQ29uY3VycmVu\ndEhhc2hNYXA8TG9uZywgUHViU3ViRGF0YT4oKTsKCiAgICAvLyBCb29sZWFu\nIGluZGljYXRpbmcgaWYgd2UgY2xvc2VkIHRoZSBjaGFubmVsIHRoaXMgUmVz\ncG9uc2VIYW5kbGVyIGlzCiAgICAvLyBhdHRhY2hlZCB0byBleHBsaWNpdGx5\nIG9yIG5vdC4gSWYgc28sIHdlIGRvIG5vdCBuZWVkIHRvIGRvIHRoZQogICAg\nLy8gY2hhbm5lbCBkaXNjb25uZWN0ZWQgbG9naWMgaGVyZS4KICAgIHB1Ymxp\nYyBib29sZWFuIGNoYW5uZWxDbG9zZWRFeHBsaWNpdGx5ID0gZmFsc2U7Cgog\nICAgcHJpdmF0ZSBmaW5hbCBIZWR3aWdDbGllbnRJbXBsIGNsaWVudDsKICAg\nIHByaXZhdGUgZmluYWwgSGVkd2lnUHVibGlzaGVyIHB1YjsKICAgIHByaXZh\ndGUgZmluYWwgSGVkd2lnU3Vic2NyaWJlciBzdWI7CiAgICBwcml2YXRlIGZp\nbmFsIENsaWVudENvbmZpZ3VyYXRpb24gY2ZnOwoKICAgIHByaXZhdGUgZmlu\nYWwgUHVibGlzaFJlc3BvbnNlSGFuZGxlciBwdWJIYW5kbGVyOwogICAgcHJp\ndmF0ZSBmaW5hbCBTdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIgc3ViSGFuZGxl\ncjsKICAgIHByaXZhdGUgZmluYWwgVW5zdWJzY3JpYmVSZXNwb25zZUhhbmRs\nZXIgdW5zdWJIYW5kbGVyOwoKICAgIHB1YmxpYyBSZXNwb25zZUhhbmRsZXIo\nSGVkd2lnQ2xpZW50SW1wbCBjbGllbnQpIHsKICAgICAgICB0aGlzLmNsaWVu\ndCA9IGNsaWVudDsKICAgICAgICB0aGlzLnN1YiA9IGNsaWVudC5nZXRTdWJz\nY3JpYmVyKCk7CiAgICAgICAgdGhpcy5wdWIgPSBjbGllbnQuZ2V0UHVibGlz\naGVyKCk7CiAgICAgICAgdGhpcy5jZmcgPSBjbGllbnQuZ2V0Q29uZmlndXJh\ndGlvbigpOwogICAgICAgIHRoaXMucHViSGFuZGxlciA9IG5ldyBQdWJsaXNo\nUmVzcG9uc2VIYW5kbGVyKHRoaXMpOwogICAgICAgIHRoaXMuc3ViSGFuZGxl\nciA9IG5ldyBTdWJzY3JpYmVSZXNwb25zZUhhbmRsZXIodGhpcyk7CiAgICAg\nICAgdGhpcy51bnN1YkhhbmRsZXIgPSBuZXcgVW5zdWJzY3JpYmVSZXNwb25z\nZUhhbmRsZXIodGhpcyk7CiAgICB9CgogICAgLy8gUHVibGljIGdldHRlcnMg\nbmVlZGVkIGZvciB0aGUgcHJpdmF0ZSBtZW1iZXJzCiAgICBwdWJsaWMgSGVk\nd2lnQ2xpZW50SW1wbCBnZXRDbGllbnQoKSB7CiAgICAgICAgcmV0dXJuIGNs\naWVudDsKICAgIH0KCiAgICBwdWJsaWMgSGVkd2lnU3Vic2NyaWJlciBnZXRT\ndWJzY3JpYmVyKCkgewogICAgICAgIHJldHVybiBzdWI7CiAgICB9CgogICAg\ncHVibGljIENsaWVudENvbmZpZ3VyYXRpb24gZ2V0Q29uZmlndXJhdGlvbigp\nIHsKICAgICAgICByZXR1cm4gY2ZnOwogICAgfQoKICAgIHB1YmxpYyBTdWJz\nY3JpYmVSZXNwb25zZUhhbmRsZXIgZ2V0U3Vic2NyaWJlUmVzcG9uc2VIYW5k\nbGVyKCkgewogICAgICAgIHJldHVybiBzdWJIYW5kbGVyOwogICAgfQoKICAg\nIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgbWVzc2FnZVJlY2VpdmVkKENo\nYW5uZWxIYW5kbGVyQ29udGV4dCBjdHgsIE1lc3NhZ2VFdmVudCBlKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBJZiB0aGUgTWVzc2FnZSBpcyBu\nb3QgYSBQdWJTdWJSZXNwb25zZSwganVzdCBzZW5kIGl0IHVwc3RyZWFtIGFu\nZCBsZXQKICAgICAgICAvLyBzb21ldGhpbmcgZWxzZSBoYW5kbGUgaXQuCiAg\nICAgICAgaWYgKCEoZS5nZXRNZXNzYWdlKCkgaW5zdGFuY2VvZiBQdWJTdWJS\nZXNwb25zZSkpIHsKICAgICAgICAgICAgY3R4LnNlbmRVcHN0cmVhbShlKTsK\nICAgICAgICB9CiAgICAgICAgLy8gUmV0cmlldmUgdGhlIFB1YlN1YlJlc3Bv\nbnNlIGZyb20gdGhlIE1lc3NhZ2UgdGhhdCB3YXMgc2VudCBieSB0aGUKICAg\nICAgICAvLyBzZXJ2ZXIuCiAgICAgICAgUHViU3ViUmVzcG9uc2UgcmVzcG9u\nc2UgPSAoUHViU3ViUmVzcG9uc2UpIGUuZ2V0TWVzc2FnZSgpOwogICAgICAg\nIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkKICAgICAgICAgICAgbG9n\nZ2VyLmRlYnVnKCJSZXNwb25zZSByZWNlaXZlZCBmcm9tIGhvc3Q6ICIgKyBI\nZWR3aWdDbGllbnRJbXBsLmdldEhvc3RGcm9tQ2hhbm5lbChjdHguZ2V0Q2hh\nbm5lbCgpKQogICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCByZXNwb25z\nZTogIiArIHJlc3BvbnNlKTsKCiAgICAgICAgLy8gRGV0ZXJtaW5lIGlmIHRo\naXMgUHViU3ViUmVzcG9uc2UgaXMgYW4gYWNrIHJlc3BvbnNlIGZvciBhIFB1\nYlN1YgogICAgICAgIC8vIFJlcXVlc3Qgb3IgaWYgaXQgaXMgYSBtZXNzYWdl\nIGJlaW5nIHB1c2hlZCB0byB0aGUgY2xpZW50IHN1YnNjcmliZXIuCiAgICAg\nICAgaWYgKHJlc3BvbnNlLmhhc01lc3NhZ2UoKSkgewogICAgICAgICAgICAv\nLyBTdWJzY3JpYmVkIG1lc3NhZ2VzIGJlaW5nIHB1c2hlZCB0byB0aGUgY2xp\nZW50IHNvIGhhbmRsZS9jb25zdW1lCiAgICAgICAgICAgIC8vIGl0IGFuZCBy\nZXR1cm4uCiAgICAgICAgICAgIHN1YkhhbmRsZXIuaGFuZGxlU3Vic2NyaWJl\nTWVzc2FnZShyZXNwb25zZSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICB9CgogICAgICAgIC8vIFJlc3BvbnNlIGlzIGFuIGFjayB0byBhIHByaW9y\nIFB1YlN1YlJlcXVlc3Qgc28gZmlyc3QgcmV0cmlldmUgdGhlCiAgICAgICAg\nLy8gUHViU3ViIGRhdGEgZm9yIHRoaXMgdHhuLgogICAgICAgIFB1YlN1YkRh\ndGEgcHViU3ViRGF0YSA9IHR4bjJQdWJTdWJEYXRhLmNvbnRhaW5zS2V5KHJl\nc3BvbnNlLmdldFR4bklkKCkpID8gdHhuMlB1YlN1YkRhdGEuZ2V0KHJlc3Bv\nbnNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmdldFR4bklk\nKCkpIDogbnVsbDsKICAgICAgICAvLyBWYWxpZGF0ZSB0aGF0IHRoZSBQdWJT\ndWIgZGF0YSBmb3IgdGhpcyB0eG4gaXMgc3RvcmVkLiBJZiBub3QsIGp1c3QK\nICAgICAgICAvLyBsb2cgYW4gZXJyb3IgbWVzc2FnZSBhbmQgcmV0dXJuIHNp\nbmNlIHdlIGRvbid0IGtub3cgaG93IHRvIGhhbmRsZQogICAgICAgIC8vIHRo\naXMuCiAgICAgICAgaWYgKHB1YlN1YkRhdGEgPT0gbnVsbCkgewogICAgICAg\nICAgICBsb2dnZXIuZXJyb3IoIlB1YlN1YiBEYXRhIHdhcyBub3QgZm91bmQg\nZm9yIFB1YlN1YlJlc3BvbnNlOiAiICsgcmVzcG9uc2UpOwogICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBOb3cgdGhhdCB3ZSd2\nZSByZXRyaWV2ZWQgdGhlIFB1YlN1YkRhdGEgZm9yIHRoaXMgc3BlY2lmaWMg\nVHhuIElELCB3ZQogICAgICAgIC8vIGNhbiByZW1vdmUgaXQgZnJvbSB0aGUg\nTWFwLgogICAgICAgIHR4bjJQdWJTdWJEYXRhLnJlbW92ZShyZXNwb25zZS5n\nZXRUeG5JZCgpKTsKCiAgICAgICAgLy8gU3RvcmUgdGhlIHRvcGljMkhvc3Qg\nbWFwcGluZyBpZiB0aGlzIHdhc24ndCBhIHNlcnZlciByZWRpcmVjdC4gV2Un\nbGwKICAgICAgICAvLyBhc3N1bWUgdGhhdCBpZiB0aGUgc2VydmVyIHdhcyBh\nYmxlIHRvIGhhdmUgYW4gb3BlbiBDaGFubmVsIGNvbm5lY3Rpb24KICAgICAg\nICAvLyB0byB0aGUgY2xpZW50LCBhbmQgcmVzcG9uZGVkIHdpdGggYW4gYWNr\nIG1lc3NhZ2Ugb3RoZXIgdGhhbiB0aGUKICAgICAgICAvLyBOT1RfUkVTUE9O\nU0lCTEVfRk9SX1RPUElDIG9uZSwgaXQgaXMgdGhlIGNvcnJlY3QgdG9waWMg\nbWFzdGVyLgogICAgICAgIGlmICghcmVzcG9uc2UuZ2V0U3RhdHVzQ29kZSgp\nLmVxdWFscyhTdGF0dXNDb2RlLk5PVF9SRVNQT05TSUJMRV9GT1JfVE9QSUMp\nKSB7CiAgICAgICAgICAgIGNsaWVudC5zdG9yZVRvcGljMkhvc3RNYXBwaW5n\nKHB1YlN1YkRhdGEsIGN0eC5nZXRDaGFubmVsKCkpOwogICAgICAgIH0KCiAg\nICAgICAgLy8gRGVwZW5kaW5nIG9uIHRoZSBvcGVyYXRpb24gdHlwZSwgY2Fs\nbCB0aGUgYXBwcm9wcmlhdGUgaGFuZGxlci4KICAgICAgICBzd2l0Y2ggKHB1\nYlN1YkRhdGEub3BlcmF0aW9uVHlwZSkgewogICAgICAgIGNhc2UgUFVCTElT\nSDoKICAgICAgICAgICAgcHViSGFuZGxlci5oYW5kbGVQdWJsaXNoUmVzcG9u\nc2UocmVzcG9uc2UsIHB1YlN1YkRhdGEsIGN0eC5nZXRDaGFubmVsKCkpOwog\nICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFNVQlNDUklCRToKICAg\nICAgICAgICAgc3ViSGFuZGxlci5oYW5kbGVTdWJzY3JpYmVSZXNwb25zZShy\nZXNwb25zZSwgcHViU3ViRGF0YSwgY3R4LmdldENoYW5uZWwoKSk7CiAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgVU5TVUJTQ1JJQkU6CiAgICAg\nICAgICAgIHVuc3ViSGFuZGxlci5oYW5kbGVVbnN1YnNjcmliZVJlc3BvbnNl\nKHJlc3BvbnNlLCBwdWJTdWJEYXRhLCBjdHguZ2V0Q2hhbm5lbCgpKTsKICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAg\nLy8gVGhlIGFib3ZlIGFyZSB0aGUgb25seSBleHBlY3RlZCBQdWJTdWJSZXNw\nb25zZSBtZXNzYWdlcyByZWNlaXZlZAogICAgICAgICAgICAvLyBmcm9tIHRo\nZSBzZXJ2ZXIgZm9yIHRoZSB2YXJpb3VzIGNsaWVudCBzaWRlIHJlcXVlc3Rz\nIG1hZGUuCiAgICAgICAgICAgIGxvZ2dlci5lcnJvcigiUmVzcG9uc2UgcmVj\nZWl2ZWQgZnJvbSBzZXJ2ZXIgaXMgZm9yIGFuIHVuaGFuZGxlZCBvcGVyYXRp\nb24gdHlwZSwgdHhuSWQ6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICsg\ncmVzcG9uc2UuZ2V0VHhuSWQoKSArICIsIG9wZXJhdGlvblR5cGU6ICIgKyBw\ndWJTdWJEYXRhLm9wZXJhdGlvblR5cGUpOwogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIExvZ2ljIHRvIHJlcG9zdCBhIFB1YlN1YlJlcXVlc3Qg\nd2hlbiB0aGUgc2VydmVyIHJlc3BvbmRzIHdpdGggYSByZWRpcmVjdAogICAg\nICogaW5kaWNhdGluZyB0aGV5IGFyZSBub3QgdGhlIHRvcGljIG1hc3Rlci4K\nICAgICAqCiAgICAgKiBAcGFyYW0gcmVzcG9uc2UKICAgICAqICAgICAgICAg\nICAgUHViU3ViUmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyIGZvciB0aGUgcmVk\naXJlY3QKICAgICAqIEBwYXJhbSBwdWJTdWJEYXRhCiAgICAgKiAgICAgICAg\nICAgIFB1YlN1YkRhdGEgZm9yIHRoZSBvcmlnaW5hbCBQdWJTdWJSZXF1ZXN0\nIG1hZGUKICAgICAqIEBwYXJhbSBjaGFubmVsCiAgICAgKiAgICAgICAgICAg\nIENoYW5uZWwgQ2hhbm5lbCB3ZSB1c2VkIHRvIG1ha2UgdGhlIG9yaWdpbmFs\nIFB1YlN1YlJlcXVlc3QKICAgICAqIEB0aHJvd3MgRXhjZXB0aW9uCiAgICAg\nKiAgICAgICAgICAgICBUaHJvd3MgYW4gZXhjZXB0aW9uIGlmIHRoZXJlIHdh\ncyBhbiBlcnJvciBpbiBkb2luZyB0aGUKICAgICAqICAgICAgICAgICAgIHJl\nZGlyZWN0IHJlcG9zdCBvZiB0aGUgUHViU3ViUmVxdWVzdAogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBoYW5kbGVSZWRpcmVjdFJlc3BvbnNlKFB1YlN1YlJl\nc3BvbnNlIHJlc3BvbnNlLCBQdWJTdWJEYXRhIHB1YlN1YkRhdGEsIENoYW5u\nZWwgY2hhbm5lbCkKICAgICAgICAgICAgdGhyb3dzIEV4Y2VwdGlvbiB7CiAg\nICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQogICAgICAgICAg\nICBsb2dnZXIuZGVidWcoIkhhbmRsaW5nIGEgcmVkaXJlY3QgZnJvbSBob3N0\nOiAiICsgSGVkd2lnQ2xpZW50SW1wbC5nZXRIb3N0RnJvbUNoYW5uZWwoY2hh\nbm5lbCkgKyAiLCByZXNwb25zZTogIgogICAgICAgICAgICAgICAgICAgICAg\nICAgKyByZXNwb25zZSArICIsIHB1YlN1YkRhdGE6ICIgKyBwdWJTdWJEYXRh\nKTsKICAgICAgICAvLyBJbiB0aGlzIGNhc2UsIHRoZSBQdWJTdWIgcmVxdWVz\ndCB3YXMgZG9uZSB0byBhIHNlcnZlciB0aGF0IGlzIG5vdAogICAgICAgIC8v\nIHJlc3BvbnNpYmxlIGZvciB0aGUgdG9waWMuIEZpcnN0IG1ha2Ugc3VyZSB0\naGF0IHdlIGhhdmVuJ3QKICAgICAgICAvLyBleGNlZWRlZCB0aGUgbWF4aW11\nbSBudW1iZXIgb2Ygc2VydmVyIHJlZGlyZWN0cy4KICAgICAgICBpbnQgY3Vy\nTnVtU2VydmVyUmVkaXJlY3RzID0gKHB1YlN1YkRhdGEudHJpZWRTZXJ2ZXJz\nID09IG51bGwpID8gMCA6IHB1YlN1YkRhdGEudHJpZWRTZXJ2ZXJzLnNpemUo\nKTsKICAgICAgICBpZiAoY3VyTnVtU2VydmVyUmVkaXJlY3RzID49IGNmZy5n\nZXRNYXhpbXVtU2VydmVyUmVkaXJlY3RzKCkpIHsKICAgICAgICAgICAgLy8g\nV2UndmUgYWxyZWFkeSBleGNlZWRlZCB0aGUgbWF4aW11bSBudW1iZXIgb2Yg\nc2VydmVyIHJlZGlyZWN0cwogICAgICAgICAgICAvLyBzbyBjb25zaWRlciB0\naGlzIGFzIGFuIGVycm9yIGNvbmRpdGlvbiBmb3IgdGhlIGNsaWVudC4KICAg\nICAgICAgICAgLy8gSW52b2tlIHRoZSBvcGVyYXRpb25GYWlsZWQgY2FsbGJh\nY2sgYW5kIGp1c3QgcmV0dXJuLgogICAgICAgICAgICBpZiAobG9nZ2VyLmlz\nRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWco\nIkV4Y2VlZGVkIHRoZSBudW1iZXIgb2Ygc2VydmVyIHJlZGlyZWN0cyAoIiAr\nIGN1ck51bVNlcnZlclJlZGlyZWN0cyArICIpIHNvIGVycm9yIG91dC4iKTsK\nICAgICAgICAgICAgcHViU3ViRGF0YS5jYWxsYmFjay5vcGVyYXRpb25GYWls\nZWQocHViU3ViRGF0YS5jb250ZXh0LCBuZXcgU2VydmljZURvd25FeGNlcHRp\nb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgVG9vTWFueVNlcnZlclJlZGlyZWN0c0V4Y2VwdGlv\nbigiQWxyZWFkeSByZWFjaGVkIG1heCBudW1iZXIgb2YgcmVkaXJlY3RzOiAi\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgY3VyTnVtU2VydmVyUmVkaXJlY3RzKSkpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICAvLyBXZSB3\naWxsIHJlZGlyZWN0IGFuZCB0cnkgdG8gY29ubmVjdCB0byB0aGUgY29ycmVj\ndCBzZXJ2ZXIKICAgICAgICAvLyBzdG9yZWQgaW4gdGhlIFN0YXR1c01zZyBv\nZiB0aGUgcmVzcG9uc2UuIEZpcnN0IHN0b3JlIHRoZQogICAgICAgIC8vIHNl\ncnZlciB0aGF0IHdlIHNlbnQgdGhlIFB1YlN1YiByZXF1ZXN0IHRvIGZvciB0\naGUgdG9waWMuCiAgICAgICAgQnl0ZVN0cmluZyB0cmllZFNlcnZlciA9IEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KEhlZHdpZ1NvY2tldEFkZHJlc3Muc29j\na0FkZHJTdHIoSGVkd2lnQ2xpZW50SW1wbAogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAuZ2V0SG9zdEZyb21DaGFubmVsKGNoYW5uZWwpKSk7\nCiAgICAgICAgaWYgKHB1YlN1YkRhdGEudHJpZWRTZXJ2ZXJzID09IG51bGwp\nCiAgICAgICAgICAgIHB1YlN1YkRhdGEudHJpZWRTZXJ2ZXJzID0gbmV3IExp\nbmtlZExpc3Q8Qnl0ZVN0cmluZz4oKTsKICAgICAgICBwdWJTdWJEYXRhLnNo\nb3VsZENsYWltID0gdHJ1ZTsKICAgICAgICBwdWJTdWJEYXRhLnRyaWVkU2Vy\ndmVycy5hZGQodHJpZWRTZXJ2ZXIpOwoKICAgICAgICAvLyBOb3cgZ2V0IHRo\nZSByZWRpcmVjdGVkIHNlcnZlciBob3N0IChleHBlY3RlZCBmb3JtYXQgaXMK\nICAgICAgICAvLyBIb3N0bmFtZTpQb3J0OlNTTFBvcnQpIGZyb20gdGhlIHNl\ncnZlcidzIHJlc3BvbnNlIG1lc3NhZ2UuIElmIG9uZSBpcwogICAgICAgIC8v\nIG5vdCBnaXZlbiBmb3Igc29tZSByZWFzb24sIHRoZW4gcmVkaXJlY3QgdG8g\ndGhlIGRlZmF1bHQgc2VydmVyCiAgICAgICAgLy8gaG9zdC9WSVAgdG8gcmVw\nb3N0IHRoZSByZXF1ZXN0LgogICAgICAgIFN0cmluZyBzdGF0dXNNc2cgPSBy\nZXNwb25zZS5nZXRTdGF0dXNNc2coKTsKICAgICAgICBJbmV0U29ja2V0QWRk\ncmVzcyByZWRpcmVjdGVkSG9zdDsKICAgICAgICBpZiAoc3RhdHVzTXNnICE9\nIG51bGwgJiYgc3RhdHVzTXNnLmxlbmd0aCgpID4gMCkgewogICAgICAgICAg\nICBpZiAoY2ZnLmlzU1NMRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICBy\nZWRpcmVjdGVkSG9zdCA9IG5ldyBIZWR3aWdTb2NrZXRBZGRyZXNzKHN0YXR1\nc01zZykuZ2V0U1NMU29ja2V0QWRkcmVzcygpOwogICAgICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgICAgICAgcmVkaXJlY3RlZEhvc3QgPSBuZXcgSGVk\nd2lnU29ja2V0QWRkcmVzcyhzdGF0dXNNc2cpLmdldFNvY2tldEFkZHJlc3Mo\nKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nIHJlZGlyZWN0ZWRIb3N0ID0gY2ZnLmdldERlZmF1bHRTZXJ2ZXJIb3N0KCk7\nCiAgICAgICAgfQoKICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIHJlZGlyZWN0\nZWQgc2VydmVyIGlzIG5vdCBvbmUgd2UndmUgYWxyZWFkeSBhdHRlbXB0ZWQK\nICAgICAgICAvLyBhbHJlYWR5IGJlZm9yZSBpbiB0aGlzIFB1YlN1YiByZXF1\nZXN0LgogICAgICAgIGlmIChwdWJTdWJEYXRhLnRyaWVkU2VydmVycy5jb250\nYWlucyhCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChIZWR3aWdTb2NrZXRBZGRy\nZXNzLnNvY2tBZGRyU3RyKHJlZGlyZWN0ZWRIb3N0KSkpKSB7CiAgICAgICAg\nICAgIGxvZ2dlci5lcnJvcigiV2UndmUgYWxyZWFkeSBzZW50IHRoaXMgUHVi\nU3ViUmVxdWVzdCBiZWZvcmUgdG8gcmVkaXJlY3RlZEhvc3Q6ICIgKyByZWRp\ncmVjdGVkSG9zdAogICAgICAgICAgICAgICAgICAgICAgICAgKyAiLCBwdWJT\ndWJEYXRhOiAiICsgcHViU3ViRGF0YSk7CiAgICAgICAgICAgIHB1YlN1YkRh\ndGEuY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKHB1YlN1YkRhdGEuY29udGV4\ndCwgbmV3IFNlcnZpY2VEb3duRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFNlcnZl\nclJlZGlyZWN0TG9vcEV4Y2VwdGlvbigiQWxyZWFkeSBtYWRlIHRoZSByZXF1\nZXN0IGJlZm9yZSB0byByZWRpcmVjdGVkIGhvc3Q6ICIKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyByZWRpcmVjdGVkSG9zdCkpKTsKICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgIH0KCiAgICAgICAgLy8gQ2hlY2sgaWYgd2UgYWxyZWFkeSBoYXZl\nIGEgQ2hhbm5lbCBvcGVuIHRvIHRoZSByZWRpcmVjdGVkIHNlcnZlcgogICAg\nICAgIC8vIGhvc3QuCiAgICAgICAgYm9vbGVhbiByZWRpcmVjdGVkSG9zdENo\nYW5uZWxFeGlzdHMgPSBwdWIuaG9zdDJDaGFubmVsLmNvbnRhaW5zS2V5KHJl\nZGlyZWN0ZWRIb3N0KSA/IHRydWUgOiBmYWxzZTsKICAgICAgICBpZiAocHVi\nU3ViRGF0YS5vcGVyYXRpb25UeXBlLmVxdWFscyhPcGVyYXRpb25UeXBlLlNV\nQlNDUklCRSkgfHwgIXJlZGlyZWN0ZWRIb3N0Q2hhbm5lbEV4aXN0cykgewog\nICAgICAgICAgICAvLyBXZSBkb24ndCBoYXZlIGFuIGV4aXN0aW5nIGNoYW5u\nZWwgdG8gdGhlIHJlZGlyZWN0ZWQgaG9zdCBPUiB0aGlzCiAgICAgICAgICAg\nIC8vIGlzIGEgcmVkaXJlY3RlZCBTdWJzY3JpYmUgcmVxdWVzdC4gRm9yIFN1\nYnNjcmliZSByZXF1ZXN0cywgd2UKICAgICAgICAgICAgLy8gYWx3YXlzIHdh\nbnQgdG8gY3JlYXRlIGEgbmV3IHVuaXF1ZSBDaGFubmVsIGNvbm5lY3Rpb24g\ndG8gdGhlCiAgICAgICAgICAgIC8vIHRvcGljIG1hc3RlciBzZXJ2ZXIgZm9y\nIHRoZSBUb3BpY1N1YnNjcmliZXIuCiAgICAgICAgICAgIGNsaWVudC5kb0Nv\nbm5lY3QocHViU3ViRGF0YSwgcmVkaXJlY3RlZEhvc3QpOwogICAgICAgIH0g\nZWxzZSB7CiAgICAgICAgICAgIC8vIEZvciBQdWJsaXNoIGFuZCBVbnN1YnNj\ncmliZSByZXF1ZXN0cywgd2UgY2FuIGp1c3QgcG9zdCB0aGUKICAgICAgICAg\nICAgLy8gcmVxdWVzdCBhZ2FpbiBkaXJlY3RseSBvbiB0aGUgZXhpc3Rpbmcg\nY2FjaGVkIHJlZGlyZWN0ZWQgaG9zdAogICAgICAgICAgICAvLyBjaGFubmVs\nLgogICAgICAgICAgICBpZiAocHViU3ViRGF0YS5vcGVyYXRpb25UeXBlLmVx\ndWFscyhPcGVyYXRpb25UeXBlLlBVQkxJU0gpKSB7CiAgICAgICAgICAgICAg\nICBwdWIuZG9QdWJsaXNoKHB1YlN1YkRhdGEsIHB1Yi5ob3N0MkNoYW5uZWwu\nZ2V0KHJlZGlyZWN0ZWRIb3N0KSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAo\ncHViU3ViRGF0YS5vcGVyYXRpb25UeXBlLmVxdWFscyhPcGVyYXRpb25UeXBl\nLlVOU1VCU0NSSUJFKSkgewogICAgICAgICAgICAgICAgc3ViLmRvU3ViVW5z\ndWIocHViU3ViRGF0YSwgcHViLmhvc3QyQ2hhbm5lbC5nZXQocmVkaXJlY3Rl\nZEhvc3QpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICAv\nLyBMb2dpYyB0byBkZWFsIHdpdGggd2hhdCBoYXBwZW5zIHdoZW4gYSBDaGFu\nbmVsIHRvIGEgc2VydmVyIGhvc3QgaXMKICAgIC8vIGRpc2Nvbm5lY3RlZC4K\nICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgY2hhbm5lbERpc2Nvbm5l\nY3RlZChDaGFubmVsSGFuZGxlckNvbnRleHQgY3R4LCBDaGFubmVsU3RhdGVF\ndmVudCBlKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAvLyBJZiB0aGlz\nIGNoYW5uZWwgd2FzIGNsb3NlZCBleHBsaWNpdGx5IGJ5IHRoZSBjbGllbnQg\nY29kZSwKICAgICAgICAvLyB3ZSBkbyBub3QgbmVlZCB0byBkbyBhbnkgb2Yg\ndGhpcyBsb2dpYy4gVGhpcyBjb3VsZCBoYXBwZW4KICAgICAgICAvLyBmb3Ig\ncmVkdW5kYW50IFB1Ymxpc2ggY2hhbm5lbHMgY3JlYXRlZCBvciByZWRpcmVj\ndGVkIHN1YnNjcmliZQogICAgICAgIC8vIGNoYW5uZWxzIHRoYXQgYXJlIG5v\ndCB1c2VkIGFueW1vcmUgb3Igd2hlbiB3ZSBzaHV0ZG93biB0aGUKICAgICAg\nICAvLyBjbGllbnQgYW5kIG1hbnVhbGx5IGNsb3NlIGFsbCBvZiB0aGUgb3Bl\nbiBjaGFubmVscy4KICAgICAgICAvLyBBbHNvIGRvbid0IGRvIGFueSBvZiB0\naGUgZGlzY29ubmVjdCBsb2dpYyBpZiB0aGUgY2xpZW50IGhhcyBzdG9wcGVk\nLgogICAgICAgIGlmIChjaGFubmVsQ2xvc2VkRXhwbGljaXRseSB8fCBjbGll\nbnQuaGFzU3RvcHBlZCgpKQogICAgICAgICAgICByZXR1cm47CgogICAgICAg\nIC8vIE1ha2Ugc3VyZSB0aGUgaG9zdCByZXRyaWV2ZWQgaXMgbm90IG51bGwg\nYXMgdGhlcmUgY291bGQgYmUgc29tZSB3ZWlyZAogICAgICAgIC8vIGNoYW5u\nZWwgZGlzY29ubmVjdCBldmVudHMgaGFwcGVuaW5nIGR1cmluZyBhIGNsaWVu\ndCBzaHV0ZG93bi4KICAgICAgICAvLyBJZiBpdCBpcywganVzdCByZXR1cm4g\nYXMgdGhlcmUgc2hvdWxkbid0IGJlIGFueXRoaW5nIHdlIG5lZWQgdG8gZG8u\nCiAgICAgICAgSW5ldFNvY2tldEFkZHJlc3MgaG9zdCA9IEhlZHdpZ0NsaWVu\ndEltcGwuZ2V0SG9zdEZyb21DaGFubmVsKGN0eC5nZXRDaGFubmVsKCkpOwog\nICAgICAgIGxvZ2dlci53YXJuKCJDaGFubmVsIHdhcyBkaXNjb25uZWN0ZWQg\ndG8gaG9zdDogIiArIGhvc3QpOwogICAgICAgIGlmIChob3N0ID09IG51bGwp\nCiAgICAgICAgICAgIHJldHVybjsKCiAgICAgICAgLy8gSWYgdGhpcyBDaGFu\nbmVsIHdhcyB1c2VkIGZvciBQdWJsaXNoIGFuZCBVbnN1YnNjcmliZSBmbG93\ncywganVzdAogICAgICAgIC8vIHJlbW92ZSBpdCBmcm9tIHRoZSBIZXdkaWdQ\ndWJsaXNoZXIncyBob3N0MkNoYW5uZWwgbWFwLiBXZSB3aWxsCiAgICAgICAg\nLy8gcmUtZXN0YWJsaXNoIGEgQ2hhbm5lbCBjb25uZWN0aW9uIHRvIHRoYXQg\nc2VydmVyIHdoZW4gdGhlIG5leHQKICAgICAgICAvLyBwdWJsaXNoL3Vuc3Vi\nc2NyaWJlIHJlcXVlc3QgdG8gYSB0b3BpYyB0aGF0IHRoZSBzZXJ2ZXIgb3du\ncyBvY2N1cnMuCiAgICAgICAgUHViU3ViRGF0YSBvcmlnU3ViRGF0YSA9IHN1\nYkhhbmRsZXIuZ2V0T3JpZ1N1YkRhdGEoKTsKCiAgICAgICAgLy8gTm93IGRl\ndGVybWluZSB3aGF0IHR5cGUgb2Ygb3BlcmF0aW9uIHRoaXMgY2hhbm5lbCB3\nYXMgdXNlZCBmb3IuCiAgICAgICAgaWYgKG9yaWdTdWJEYXRhID09IG51bGwp\nIHsKICAgICAgICAgICAgLy8gT25seSByZW1vdmUgdGhlIENoYW5uZWwgZnJv\nbSB0aGUgbWFwcGluZyBpZiB0aGlzIGN1cnJlbnQKICAgICAgICAgICAgLy8g\nZGlzY29ubmVjdGVkIGNoYW5uZWwgaXMgdGhlIHNhbWUgYXMgdGhlIGNhY2hl\nZCBlbnRyeS4KICAgICAgICAgICAgLy8gRHVlIHRvIHJhY2UgY29uY3VycmVu\nY3kgc2l0dWF0aW9ucywgaXQgaXMgcG9zc2libGUgdG8KICAgICAgICAgICAg\nLy8gY3JlYXRlIG11bHRpcGxlIGNoYW5uZWxzIHRvIHRoZSBzYW1lIGhvc3Qg\nZm9yIHB1Ymxpc2gKICAgICAgICAgICAgLy8gYW5kIHVuc3Vic2NyaWJlIHJl\ncXVlc3RzLgogICAgICAgICAgICBpZiAocHViLmhvc3QyQ2hhbm5lbC5jb250\nYWluc0tleShob3N0KSAmJiBwdWIuaG9zdDJDaGFubmVsLmdldChob3N0KS5l\ncXVhbHMoY3R4LmdldENoYW5uZWwoKSkpIHsKICAgICAgICAgICAgICAgIGlm\nIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkKICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuZGVidWcoIkRpc2Nvbm5lY3RlZCBjaGFubmVsIGZvciBob3N0\nOiAiICsgaG9zdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nICIgd2FzIGZvciBQdWJsaXNoL1Vuc3Vic2NyaWJlIHJlcXVlc3RzIHNvIHJl\nbW92ZSBhbGwgcmVmZXJlbmNlcyB0byBpdC4iKTsKICAgICAgICAgICAgICAg\nIHB1Yi5ob3N0MkNoYW5uZWwucmVtb3ZlKGhvc3QpOwogICAgICAgICAgICAg\nICAgY2xpZW50LmNsZWFyQWxsVG9waWNzRm9ySG9zdChob3N0KTsKICAgICAg\nICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN1YnNj\ncmliZSBjaGFubmVsIGRpc2Nvbm5lY3RlZCBzbyBmaXJzdCBjbG9zZSBhbmQg\nY2xlYXIgYWxsCiAgICAgICAgICAgIC8vIGNhY2hlZCBDaGFubmVsIGRhdGEg\nc2V0IHVwIGZvciB0aGlzIHRvcGljIHN1YnNjcmlwdGlvbi4KICAgICAgICAg\nICAgc3ViLmNsb3NlU3Vic2NyaXB0aW9uKG9yaWdTdWJEYXRhLnRvcGljLCBv\ncmlnU3ViRGF0YS5zdWJzY3JpYmVySWQpOwogICAgICAgICAgICBjbGllbnQu\nY2xlYXJBbGxUb3BpY3NGb3JIb3N0KGhvc3QpOwogICAgICAgICAgICAvLyBT\naW5jZSB0aGUgY29ubmVjdGlvbiB0byB0aGUgc2VydmVyIGhvc3QgdGhhdCB3\nYXMgcmVzcG9uc2libGUKICAgICAgICAgICAgLy8gZm9yIHRoZSB0b3BpYyBk\naWVkLCB3ZSBhcmUgbm90IHN1cmUgYWJvdXQgdGhlIHN0YXRlIG9mIHRoYXQK\nICAgICAgICAgICAgLy8gc2VydmVyLiBSZXNlbmQgdGhlIG9yaWdpbmFsIHN1\nYnNjcmliZSByZXF1ZXN0IGRhdGEgdG8gdGhlIGRlZmF1bHQKICAgICAgICAg\nICAgLy8gc2VydmVyIGhvc3QvVklQLiBBbHNvIGNsZWFyIG91dCBhbGwgb2Yg\ndGhlIHNlcnZlcnMgd2UndmUKICAgICAgICAgICAgLy8gY29udGFjdGVkIG9y\nIGF0dGVtcHRlZCB0byBmcm9tIHRoaXMgcmVxdWVzdCBhcyB3ZSBhcmUgc3Rh\ncnRpbmcgYQogICAgICAgICAgICAvLyAiZnJlc2giIHN1YnNjcmliZSByZXF1\nZXN0LgogICAgICAgICAgICBvcmlnU3ViRGF0YS5jbGVhclNlcnZlcnNMaXN0\nKCk7CiAgICAgICAgICAgIC8vIFNldCBhIG5ldyB0eXBlIG9mIFZvaWRDYWxs\nYmFjayBmb3IgdGhpcyBhc3luYyBjYWxsLiBXZSBuZWVkIHRoaXMKICAgICAg\nICAgICAgLy8gaG9vayBzbyBhZnRlciB0aGUgc3Vic2NyaWJlIHJlY29ubmVj\ndCBoYXMgY29tcGxldGVkLCBkZWxpdmVyeSBmb3IKICAgICAgICAgICAgLy8g\ndGhhdCB0b3BpYyBzdWJzY3JpYmVyIHNob3VsZCBhbHNvIGJlIHJlc3RhcnRl\nZCAoaWYgaXQgd2FzIHRoYXQKICAgICAgICAgICAgLy8gY2FzZSBiZWZvcmUg\ndGhlIGNoYW5uZWwgZGlzY29ubmVjdCkuCiAgICAgICAgICAgIG9yaWdTdWJE\nYXRhLmNhbGxiYWNrID0gbmV3IFN1YnNjcmliZVJlY29ubmVjdENhbGxiYWNr\nKG9yaWdTdWJEYXRhLCBjbGllbnQpOwogICAgICAgICAgICBvcmlnU3ViRGF0\nYS5jb250ZXh0ID0gbnVsbDsKICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0Rl\nYnVnRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJE\naXNjb25uZWN0ZWQgc3Vic2NyaWJlIGNoYW5uZWwgc28gcmVjb25uZWN0IHdp\ndGggb3JpZ1N1YkRhdGE6ICIgKyBvcmlnU3ViRGF0YSk7CiAgICAgICAgICAg\nIGNsaWVudC5kb0Nvbm5lY3Qob3JpZ1N1YkRhdGEsIGNmZy5nZXREZWZhdWx0\nU2VydmVySG9zdCgpKTsKICAgICAgICB9CgogICAgICAgIC8vIEZpbmFsbHks\nIGFsbCBvZiB0aGUgUHViU3ViUmVxdWVzdHMgdGhhdCBhcmUgc3RpbGwgd2Fp\ndGluZyBmb3IgYW4gYWNrCiAgICAgICAgLy8gcmVzcG9uc2UgZnJvbSB0aGUg\nc2VydmVyIG5lZWQgdG8gYmUgcmVtb3ZlZCBhbmQgdGltZWQgb3V0LiBJbnZv\na2UgdGhlCiAgICAgICAgLy8gb3BlcmF0aW9uRmFpbGVkIGNhbGxiYWNrcyBv\nbiBhbGwgb2YgdGhlbS4gVXNlIHRoZQogICAgICAgIC8vIFVuY2VydGFpblN0\nYXRlRXhjZXB0aW9uIHNpbmNlIHRoZSBzZXJ2ZXIgZGlkIHJlY2VpdmUgdGhl\nIHJlcXVlc3QgYnV0CiAgICAgICAgLy8gd2UncmUgbm90IHN1cmUgb2YgdGhl\nIHN0YXRlIG9mIHRoZSByZXF1ZXN0IHNpbmNlIHRoZSBhY2sgcmVzcG9uc2Ug\nd2FzCiAgICAgICAgLy8gbmV2ZXIgcmVjZWl2ZWQuCiAgICAgICAgZm9yIChQ\ndWJTdWJEYXRhIHB1YlN1YkRhdGEgOiB0eG4yUHViU3ViRGF0YS52YWx1ZXMo\nKSkgewogICAgICAgICAgICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkp\nCiAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkNoYW5uZWwgZGlzY29u\nbmVjdGVkIHNvIGludm9raW5nIHRoZSBvcGVyYXRpb25GYWlsZWQgY2FsbGJh\nY2sgZm9yIHB1YlN1YkRhdGE6ICIKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArIHB1YlN1YkRhdGEpOwogICAgICAgICAgICBwdWJTdWJEYXRhLmNh\nbGxiYWNrLm9wZXJhdGlvbkZhaWxlZChwdWJTdWJEYXRhLmNvbnRleHQsIG5l\ndyBVbmNlcnRhaW5TdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJTZXJ2ZXIgYWNr\nIHJlc3BvbnNlIG5ldmVyIHJlY2VpdmVkIGJlZm9yZSBzZXJ2ZXIgY29ubmVj\ndGlvbiBkaXNjb25uZWN0ZWQhIikpOwogICAgICAgIH0KICAgICAgICB0eG4y\nUHViU3ViRGF0YS5jbGVhcigpOwogICAgfQoKICAgIC8vIExvZ2ljIHRvIGRl\nYWwgd2l0aCB3aGF0IGhhcHBlbnMgd2hlbiBhIENoYW5uZWwgdG8gYSBzZXJ2\nZXIgaG9zdCBpcwogICAgLy8gY29ubmVjdGVkLiBUaGlzIGlzIG5lZWRlZCBp\nZiB0aGUgY2xpZW50IGlzIHVzaW5nIGFuIFNTTCBwb3J0IHRvCiAgICAvLyBj\nb21tdW5pY2F0ZSB3aXRoIHRoZSBzZXJ2ZXIuIElmIHNvLCB3ZSBuZWVkIHRv\nIGRvIHRoZSBTU0wgaGFuZHNoYWtlIGhlcmUKICAgIC8vIHdoZW4gdGhlIGNo\nYW5uZWwgaXMgZmlyc3QgY29ubmVjdGVkLgogICAgQE92ZXJyaWRlCiAgICBw\ndWJsaWMgdm9pZCBjaGFubmVsQ29ubmVjdGVkKENoYW5uZWxIYW5kbGVyQ29u\ndGV4dCBjdHgsIENoYW5uZWxTdGF0ZUV2ZW50IGUpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgIC8vIE5vIG5lZWQgdG8gaW5pdGlhdGUgdGhlIFNTTCBo\nYW5kc2hha2UgaWYgd2UgYXJlIGNsb3NpbmcgdGhpcyBjaGFubmVsCiAgICAg\nICAgLy8gZXhwbGljaXRseSBvciB0aGUgY2xpZW50IGhhcyBiZWVuIHN0b3Bw\nZWQuCiAgICAgICAgaWYgKGNmZy5pc1NTTEVuYWJsZWQoKSAmJiAhY2hhbm5l\nbENsb3NlZEV4cGxpY2l0bHkgJiYgIWNsaWVudC5oYXNTdG9wcGVkKCkpIHsK\nICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoIkluaXRpYXRpbmcgdGhlIFNT\nTCBoYW5kc2hha2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdHgu\nZ2V0UGlwZWxpbmUoKS5nZXQoU3NsSGFuZGxlci5jbGFzcykuaGFuZHNoYWtl\nKGUuZ2V0Q2hhbm5lbCgpKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJy\naWRlCiAgICBwdWJsaWMgdm9pZCBleGNlcHRpb25DYXVnaHQoQ2hhbm5lbEhh\nbmRsZXJDb250ZXh0IGN0eCwgRXhjZXB0aW9uRXZlbnQgZSkgewogICAgICAg\nIGxvZ2dlci5lcnJvcigiRXhjZXB0aW9uIGNhdWdodCBvbiBjbGllbnQgY2hh\nbm5lbCIsIGUuZ2V0Q2F1c2UoKSk7CiAgICAgICAgZS5nZXRDaGFubmVsKCku\nY2xvc2UoKTsKICAgIH0KCn0K\n","encoding":"base64"}

