{"sha":"92f409d30e95f60512e764df8294005239ca1eda","node_id":"MDQ6QmxvYjE1NzU5NTY6OTJmNDA5ZDMwZTk1ZjYwNTEyZTc2NGRmODI5NDAwNTIzOWNhMWVkYQ==","size":260161,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/92f409d30e95f60512e764df8294005239ca1eda","content":"Ly8gR2VuZXJhdGVkIGJ5IHRoZSBwcm90b2NvbCBidWZmZXIgY29tcGlsZXIu\nICBETyBOT1QgRURJVCEKLy8gc291cmNlOiBzcmMvbWFpbi9wcm90b2J1Zi9Q\ndWJTdWJQcm90b2NvbC5wcm90bwoKcGFja2FnZSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbDsKCnB1YmxpYyBmaW5hbCBjbGFzcyBQdWJTdWJQcm90b2Nv\nbCB7CiAgcHJpdmF0ZSBQdWJTdWJQcm90b2NvbCgpIHt9CiAgcHVibGljIHN0\nYXRpYyB2b2lkIHJlZ2lzdGVyQWxsRXh0ZW5zaW9ucygKICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeSByZWdpc3RyeSkgewog\nIH0KICBwdWJsaWMgZW51bSBQcm90b2NvbFZlcnNpb24KICAgICAgaW1wbGVt\nZW50cyBjb20uZ29vZ2xlLnByb3RvYnVmLlByb3RvY29sTWVzc2FnZUVudW0g\newogICAgVkVSU0lPTl9PTkUoMCwgMSksCiAgICA7CiAgICAKICAgIAogICAg\ncHVibGljIGZpbmFsIGludCBnZXROdW1iZXIoKSB7IHJldHVybiB2YWx1ZTsg\nfQogICAgCiAgICBwdWJsaWMgc3RhdGljIFByb3RvY29sVmVyc2lvbiB2YWx1\nZU9mKGludCB2YWx1ZSkgewogICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAg\nICAgY2FzZSAxOiByZXR1cm4gVkVSU0lPTl9PTkU7CiAgICAgICAgZGVmYXVs\ndDogcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGlj\nIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRl\nTWFwPFByb3RvY29sVmVyc2lvbj4KICAgICAgICBpbnRlcm5hbEdldFZhbHVl\nTWFwKCkgewogICAgICByZXR1cm4gaW50ZXJuYWxWYWx1ZU1hcDsKICAgIH0K\nICAgIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuSW50ZXJu\nYWwuRW51bUxpdGVNYXA8UHJvdG9jb2xWZXJzaW9uPgogICAgICAgIGludGVy\nbmFsVmFsdWVNYXAgPQogICAgICAgICAgbmV3IGNvbS5nb29nbGUucHJvdG9i\ndWYuSW50ZXJuYWwuRW51bUxpdGVNYXA8UHJvdG9jb2xWZXJzaW9uPigpIHsK\nICAgICAgICAgICAgcHVibGljIFByb3RvY29sVmVyc2lvbiBmaW5kVmFsdWVC\neU51bWJlcihpbnQgbnVtYmVyKSB7CiAgICAgICAgICAgICAgcmV0dXJuIFBy\nb3RvY29sVmVyc2lvbi52YWx1ZU9mKG51bWJlcikKICAgIDsgICAgICAgIH0K\nICAgICAgICAgIH07CiAgICAKICAgIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkVudW1WYWx1ZURlc2NyaXB0b3IKICAg\nICAgICBnZXRWYWx1ZURlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBnZXRE\nZXNjcmlwdG9yKCkuZ2V0VmFsdWVzKCkuZ2V0KGluZGV4KTsKICAgIH0KICAg\nIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3Jz\nLkVudW1EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUo\nKSB7CiAgICAgIHJldHVybiBnZXREZXNjcmlwdG9yKCk7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3Jp\ncHRvcnMuRW51bURlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkg\newogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuZ2V0RGVzY3JpcHRvcigpLmdldEVudW1UeXBlcygpLmdl\ndCgwKTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMgZmluYWwgUHJv\ndG9jb2xWZXJzaW9uW10gVkFMVUVTID0gewogICAgICBWRVJTSU9OX09ORSwg\nCiAgICB9OwogICAgcHVibGljIHN0YXRpYyBQcm90b2NvbFZlcnNpb24gdmFs\ndWVPZigKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3Jz\nLkVudW1WYWx1ZURlc2NyaXB0b3IgZGVzYykgewogICAgICBpZiAoZGVzYy5n\nZXRUeXBlKCkgIT0gZ2V0RGVzY3JpcHRvcigpKSB7CiAgICAgICAgdGhyb3cg\nbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJndW1lbnRFeGNlcHRpb24oCiAgICAg\nICAgICAiRW51bVZhbHVlRGVzY3JpcHRvciBpcyBub3QgZm9yIHRoaXMgdHlw\nZS4iKTsKICAgICAgfQogICAgICByZXR1cm4gVkFMVUVTW2Rlc2MuZ2V0SW5k\nZXgoKV07CiAgICB9CiAgICBwcml2YXRlIGZpbmFsIGludCBpbmRleDsKICAg\nIHByaXZhdGUgZmluYWwgaW50IHZhbHVlOwogICAgcHJpdmF0ZSBQcm90b2Nv\nbFZlcnNpb24oaW50IGluZGV4LCBpbnQgdmFsdWUpIHsKICAgICAgdGhpcy5p\nbmRleCA9IGluZGV4OwogICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9\nCiAgICAKICAgIHN0YXRpYyB7CiAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLmdldERlc2NyaXB0b3IoKTsKICAgIH0K\nICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGVudW1fc2Nv\ncGU6SGVkd2lnLlByb3RvY29sVmVyc2lvbikKICB9CiAgCiAgcHVibGljIGVu\ndW0gT3BlcmF0aW9uVHlwZQogICAgICBpbXBsZW1lbnRzIGNvbS5nb29nbGUu\ncHJvdG9idWYuUHJvdG9jb2xNZXNzYWdlRW51bSB7CiAgICBQVUJMSVNIKDAs\nIDApLAogICAgU1VCU0NSSUJFKDEsIDEpLAogICAgQ09OU1VNRSgyLCAyKSwK\nICAgIFVOU1VCU0NSSUJFKDMsIDMpLAogICAgU1RBUlRfREVMSVZFUlkoNCwg\nNCksCiAgICBTVE9QX0RFTElWRVJZKDUsIDUpLAogICAgOwogICAgCiAgICAK\nICAgIHB1YmxpYyBmaW5hbCBpbnQgZ2V0TnVtYmVyKCkgeyByZXR1cm4gdmFs\ndWU7IH0KICAgIAogICAgcHVibGljIHN0YXRpYyBPcGVyYXRpb25UeXBlIHZh\nbHVlT2YoaW50IHZhbHVlKSB7CiAgICAgIHN3aXRjaCAodmFsdWUpIHsKICAg\nICAgICBjYXNlIDA6IHJldHVybiBQVUJMSVNIOwogICAgICAgIGNhc2UgMTog\ncmV0dXJuIFNVQlNDUklCRTsKICAgICAgICBjYXNlIDI6IHJldHVybiBDT05T\nVU1FOwogICAgICAgIGNhc2UgMzogcmV0dXJuIFVOU1VCU0NSSUJFOwogICAg\nICAgIGNhc2UgNDogcmV0dXJuIFNUQVJUX0RFTElWRVJZOwogICAgICAgIGNh\nc2UgNTogcmV0dXJuIFNUT1BfREVMSVZFUlk7CiAgICAgICAgZGVmYXVsdDog\ncmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIAogICAgcHVibGljIHN0\nYXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFw\nPE9wZXJhdGlvblR5cGU+CiAgICAgICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgp\nIHsKICAgICAgcmV0dXJuIGludGVybmFsVmFsdWVNYXA7CiAgICB9CiAgICBw\ncml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVu\ndW1MaXRlTWFwPE9wZXJhdGlvblR5cGU+CiAgICAgICAgaW50ZXJuYWxWYWx1\nZU1hcCA9CiAgICAgICAgICBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnRl\ncm5hbC5FbnVtTGl0ZU1hcDxPcGVyYXRpb25UeXBlPigpIHsKICAgICAgICAg\nICAgcHVibGljIE9wZXJhdGlvblR5cGUgZmluZFZhbHVlQnlOdW1iZXIoaW50\nIG51bWJlcikgewogICAgICAgICAgICAgIHJldHVybiBPcGVyYXRpb25UeXBl\nLnZhbHVlT2YobnVtYmVyKQogICAgOyAgICAgICAgfQogICAgICAgICAgfTsK\nICAgIAogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVz\nY3JpcHRvcnMuRW51bVZhbHVlRGVzY3JpcHRvcgogICAgICAgIGdldFZhbHVl\nRGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKS5n\nZXRWYWx1ZXMoKS5nZXQoaW5kZXgpOwogICAgfQogICAgcHVibGljIGZpbmFs\nIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bURlc2NyaXB0\nb3IKICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgcmV0\ndXJuIGdldERlc2NyaXB0b3IoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5FbnVtRGVz\nY3JpcHRvcgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5n\nZXREZXNjcmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDEpOwogICAgfQog\nICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBPcGVyYXRpb25UeXBlW10g\nVkFMVUVTID0gewogICAgICBQVUJMSVNILCBTVUJTQ1JJQkUsIENPTlNVTUUs\nIFVOU1VCU0NSSUJFLCBTVEFSVF9ERUxJVkVSWSwgU1RPUF9ERUxJVkVSWSwg\nCiAgICB9OwogICAgcHVibGljIHN0YXRpYyBPcGVyYXRpb25UeXBlIHZhbHVl\nT2YoCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5F\nbnVtVmFsdWVEZXNjcmlwdG9yIGRlc2MpIHsKICAgICAgaWYgKGRlc2MuZ2V0\nVHlwZSgpICE9IGdldERlc2NyaXB0b3IoKSkgewogICAgICAgIHRocm93IG5l\ndyBqYXZhLmxhbmcuSWxsZWdhbEFyZ3VtZW50RXhjZXB0aW9uKAogICAgICAg\nICAgIkVudW1WYWx1ZURlc2NyaXB0b3IgaXMgbm90IGZvciB0aGlzIHR5cGUu\nIik7CiAgICAgIH0KICAgICAgcmV0dXJuIFZBTFVFU1tkZXNjLmdldEluZGV4\nKCldOwogICAgfQogICAgcHJpdmF0ZSBmaW5hbCBpbnQgaW5kZXg7CiAgICBw\ncml2YXRlIGZpbmFsIGludCB2YWx1ZTsKICAgIHByaXZhdGUgT3BlcmF0aW9u\nVHlwZShpbnQgaW5kZXgsIGludCB2YWx1ZSkgewogICAgICB0aGlzLmluZGV4\nID0gaW5kZXg7CiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgIH0KICAg\nIAogICAgc3RhdGljIHsKICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuZ2V0RGVzY3JpcHRvcigpOwogICAgfQogICAg\nCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoZW51bV9zY29wZTpI\nZWR3aWcuT3BlcmF0aW9uVHlwZSkKICB9CiAgCiAgcHVibGljIGVudW0gU3Rh\ndHVzQ29kZQogICAgICBpbXBsZW1lbnRzIGNvbS5nb29nbGUucHJvdG9idWYu\nUHJvdG9jb2xNZXNzYWdlRW51bSB7CiAgICBTVUNDRVNTKDAsIDApLAogICAg\nTUFMRk9STUVEX1JFUVVFU1QoMSwgNDAxKSwKICAgIE5PX1NVQ0hfVE9QSUMo\nMiwgNDAyKSwKICAgIENMSUVOVF9BTFJFQURZX1NVQlNDUklCRUQoMywgNDAz\nKSwKICAgIENMSUVOVF9OT1RfU1VCU0NSSUJFRCg0LCA0MDQpLAogICAgQ09V\nTERfTk9UX0NPTk5FQ1QoNSwgNDA1KSwKICAgIFRPUElDX0JVU1koNiwgNDA2\nKSwKICAgIE5PVF9SRVNQT05TSUJMRV9GT1JfVE9QSUMoNywgNTAxKSwKICAg\nIFNFUlZJQ0VfRE9XTig4LCA1MDIpLAogICAgVU5DRVJUQUlOX1NUQVRFKDks\nIDUwMyksCiAgICBVTkVYUEVDVEVEX0NPTkRJVElPTigxMCwgNjAwKSwKICAg\nIENPTVBPU0lURSgxMSwgNzAwKSwKICAgIDsKICAgIAogICAgCiAgICBwdWJs\naWMgZmluYWwgaW50IGdldE51bWJlcigpIHsgcmV0dXJuIHZhbHVlOyB9CiAg\nICAKICAgIHB1YmxpYyBzdGF0aWMgU3RhdHVzQ29kZSB2YWx1ZU9mKGludCB2\nYWx1ZSkgewogICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgY2FzZSAw\nOiByZXR1cm4gU1VDQ0VTUzsKICAgICAgICBjYXNlIDQwMTogcmV0dXJuIE1B\nTEZPUk1FRF9SRVFVRVNUOwogICAgICAgIGNhc2UgNDAyOiByZXR1cm4gTk9f\nU1VDSF9UT1BJQzsKICAgICAgICBjYXNlIDQwMzogcmV0dXJuIENMSUVOVF9B\nTFJFQURZX1NVQlNDUklCRUQ7CiAgICAgICAgY2FzZSA0MDQ6IHJldHVybiBD\nTElFTlRfTk9UX1NVQlNDUklCRUQ7CiAgICAgICAgY2FzZSA0MDU6IHJldHVy\nbiBDT1VMRF9OT1RfQ09OTkVDVDsKICAgICAgICBjYXNlIDQwNjogcmV0dXJu\nIFRPUElDX0JVU1k7CiAgICAgICAgY2FzZSA1MDE6IHJldHVybiBOT1RfUkVT\nUE9OU0lCTEVfRk9SX1RPUElDOwogICAgICAgIGNhc2UgNTAyOiByZXR1cm4g\nU0VSVklDRV9ET1dOOwogICAgICAgIGNhc2UgNTAzOiByZXR1cm4gVU5DRVJU\nQUlOX1NUQVRFOwogICAgICAgIGNhc2UgNjAwOiByZXR1cm4gVU5FWFBFQ1RF\nRF9DT05ESVRJT047CiAgICAgICAgY2FzZSA3MDA6IHJldHVybiBDT01QT1NJ\nVEU7CiAgICAgICAgZGVmYXVsdDogcmV0dXJuIG51bGw7CiAgICAgIH0KICAg\nIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludGVybmFsLkVudW1MaXRlTWFwPFN0YXR1c0NvZGU+CiAgICAgICAgaW50\nZXJuYWxHZXRWYWx1ZU1hcCgpIHsKICAgICAgcmV0dXJuIGludGVybmFsVmFs\ndWVNYXA7CiAgICB9CiAgICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPFN0YXR1c0NvZGU+CiAgICAg\nICAgaW50ZXJuYWxWYWx1ZU1hcCA9CiAgICAgICAgICBuZXcgY29tLmdvb2ds\nZS5wcm90b2J1Zi5JbnRlcm5hbC5FbnVtTGl0ZU1hcDxTdGF0dXNDb2RlPigp\nIHsKICAgICAgICAgICAgcHVibGljIFN0YXR1c0NvZGUgZmluZFZhbHVlQnlO\ndW1iZXIoaW50IG51bWJlcikgewogICAgICAgICAgICAgIHJldHVybiBTdGF0\ndXNDb2RlLnZhbHVlT2YobnVtYmVyKQogICAgOyAgICAgICAgfQogICAgICAg\nICAgfTsKICAgIAogICAgcHVibGljIGZpbmFsIGNvbS5nb29nbGUucHJvdG9i\ndWYuRGVzY3JpcHRvcnMuRW51bVZhbHVlRGVzY3JpcHRvcgogICAgICAgIGdl\ndFZhbHVlRGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIGdldERlc2NyaXB0\nb3IoKS5nZXRWYWx1ZXMoKS5nZXQoaW5kZXgpOwogICAgfQogICAgcHVibGlj\nIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRW51bURl\nc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAg\nICAgcmV0dXJuIGdldERlc2NyaXB0b3IoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5F\nbnVtRGVzY3JpcHRvcgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5nZXREZXNjcmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDIpOwog\nICAgfQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdGF0dXNDb2Rl\nW10gVkFMVUVTID0gewogICAgICBTVUNDRVNTLCBNQUxGT1JNRURfUkVRVUVT\nVCwgTk9fU1VDSF9UT1BJQywgQ0xJRU5UX0FMUkVBRFlfU1VCU0NSSUJFRCwg\nQ0xJRU5UX05PVF9TVUJTQ1JJQkVELCBDT1VMRF9OT1RfQ09OTkVDVCwgVE9Q\nSUNfQlVTWSwgTk9UX1JFU1BPTlNJQkxFX0ZPUl9UT1BJQywgU0VSVklDRV9E\nT1dOLCBVTkNFUlRBSU5fU1RBVEUsIFVORVhQRUNURURfQ09ORElUSU9OLCBD\nT01QT1NJVEUsIAogICAgfTsKICAgIHB1YmxpYyBzdGF0aWMgU3RhdHVzQ29k\nZSB2YWx1ZU9mKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3Jp\ncHRvcnMuRW51bVZhbHVlRGVzY3JpcHRvciBkZXNjKSB7CiAgICAgIGlmIChk\nZXNjLmdldFR5cGUoKSAhPSBnZXREZXNjcmlwdG9yKCkpIHsKICAgICAgICB0\naHJvdyBuZXcgamF2YS5sYW5nLklsbGVnYWxBcmd1bWVudEV4Y2VwdGlvbigK\nICAgICAgICAgICJFbnVtVmFsdWVEZXNjcmlwdG9yIGlzIG5vdCBmb3IgdGhp\ncyB0eXBlLiIpOwogICAgICB9CiAgICAgIHJldHVybiBWQUxVRVNbZGVzYy5n\nZXRJbmRleCgpXTsKICAgIH0KICAgIHByaXZhdGUgZmluYWwgaW50IGluZGV4\nOwogICAgcHJpdmF0ZSBmaW5hbCBpbnQgdmFsdWU7CiAgICBwcml2YXRlIFN0\nYXR1c0NvZGUoaW50IGluZGV4LCBpbnQgdmFsdWUpIHsKICAgICAgdGhpcy5p\nbmRleCA9IGluZGV4OwogICAgICB0aGlzLnZhbHVlID0gdmFsdWU7CiAgICB9\nCiAgICAKICAgIHN0YXRpYyB7CiAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLmdldERlc2NyaXB0b3IoKTsKICAgIH0K\nICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGVudW1fc2Nv\ncGU6SGVkd2lnLlN0YXR1c0NvZGUpCiAgfQogIAogIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY2xhc3MgTWVzc2FnZSBleHRlbmRzCiAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAvLyBVc2UgTWVzc2Fn\nZS5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJpdmF0ZSBNZXNz\nYWdlKCkgewogICAgICBpbml0RmllbGRzKCk7CiAgICB9CiAgICBwcml2YXRl\nIE1lc3NhZ2UoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUg\nc3RhdGljIGZpbmFsIE1lc3NhZ2UgZGVmYXVsdEluc3RhbmNlOwogICAgcHVi\nbGljIHN0YXRpYyBNZXNzYWdlIGdldERlZmF1bHRJbnN0YW5jZSgpIHsKICAg\nICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVi\nbGljIE1lc3NhZ2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAg\nICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAg\nICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNzYWdlX2Rlc2NyaXB0\nb3I7CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAg\nICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJl\ndHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VfZmllbGRBY2Nlc3Nv\nclRhYmxlOwogICAgfQogICAgCiAgICAvLyByZXF1aXJlZCBieXRlcyBib2R5\nID0gMTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEJPRFlfRklFTERf\nTlVNQkVSID0gMTsKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNCb2R5OwogICAg\ncHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgYm9keV8g\nPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICBw\ndWJsaWMgYm9vbGVhbiBoYXNCb2R5KCkgeyByZXR1cm4gaGFzQm9keTsgfQog\nICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRC\nb2R5KCkgeyByZXR1cm4gYm9keV87IH0KICAgIAogICAgLy8gb3B0aW9uYWwg\nYnl0ZXMgc3JjUmVnaW9uID0gMjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwg\naW50IFNSQ1JFR0lPTl9GSUVMRF9OVU1CRVIgPSAyOwogICAgcHJpdmF0ZSBi\nb29sZWFuIGhhc1NyY1JlZ2lvbjsKICAgIHByaXZhdGUgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIHNyY1JlZ2lvbl8gPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNTcmNSZWdpb24oKSB7IHJldHVybiBoYXNTcmNSZWdpb247IH0KICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3JjUmVn\naW9uKCkgeyByZXR1cm4gc3JjUmVnaW9uXzsgfQogICAgCiAgICAvLyBvcHRp\nb25hbCAuSGVkd2lnLk1lc3NhZ2VTZXFJZCBtc2dJZCA9IDM7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBNU0dJRF9GSUVMRF9OVU1CRVIgPSAzOwog\nICAgcHJpdmF0ZSBib29sZWFuIGhhc01zZ0lkOwogICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQgbXNnSWRfOwogICAgcHVibGljIGJvb2xlYW4gaGFzTXNnSWQoKSB7\nIHJldHVybiBoYXNNc2dJZDsgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRN\nc2dJZCgpIHsgcmV0dXJuIG1zZ0lkXzsgfQogICAgCiAgICBwcml2YXRlIHZv\naWQgaW5pdEZpZWxkcygpIHsKICAgICAgbXNnSWRfID0gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdl\ndERlZmF1bHRJbnN0YW5jZSgpOwogICAgfQogICAgcHVibGljIGZpbmFsIGJv\nb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgaWYgKCFoYXNCb2R5KSBy\nZXR1cm4gZmFsc2U7CiAgICAgIGlmIChoYXNNc2dJZCgpKSB7CiAgICAgICAg\naWYgKCFnZXRNc2dJZCgpLmlzSW5pdGlhbGl6ZWQoKSkgcmV0dXJuIGZhbHNl\nOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBw\ndWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRP\ndXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6\nZWRTaXplKCk7CiAgICAgIGlmIChoYXNCb2R5KCkpIHsKICAgICAgICBvdXRw\ndXQud3JpdGVCeXRlcygxLCBnZXRCb2R5KCkpOwogICAgICB9CiAgICAgIGlm\nIChoYXNTcmNSZWdpb24oKSkgewogICAgICAgIG91dHB1dC53cml0ZUJ5dGVz\nKDIsIGdldFNyY1JlZ2lvbigpKTsKICAgICAgfQogICAgICBpZiAoaGFzTXNn\nSWQoKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMywgZ2V0TXNn\nSWQoKSk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRl\nVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgbWVtb2l6\nZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBnZXRTZXJp\nYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlh\nbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7\nCiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmIChoYXNCb2R5KCkpIHsK\nICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDEsIGdldEJv\nZHkoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1NyY1JlZ2lvbigpKSB7CiAg\nICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0\nU3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSgyLCBnZXRTcmNS\nZWdpb24oKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc01zZ0lkKCkpIHsKICAg\nICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0KICAgICAgICAgIC5jb21wdXRlTWVzc2FnZVNpemUoMywgZ2V0TXNn\nSWQoKSk7CiAgICAgIH0KICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRz\nKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxp\nemVkU2l6ZSA9IHNpemU7CiAgICAgIHJldHVybiBzaXplOwogICAgfQogICAg\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRo\ncm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZSBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dz\nIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\nZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZSBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIHBhcnNlRnJvbShqYXZhLmlvLklu\ncHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\naW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2UgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0g\naW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25S\nZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAg\nICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBl\nbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAg\nICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBp\nZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lv\nblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFy\nc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAg\nICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBwYXJzZUZyb20o\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcGFy\nc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1\ndFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1\ncm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3\nQnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAg\nIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcHJvdG90\neXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHBy\nb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIo\nKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIHB1Ymxp\nYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8\nQnVpbGRlcj4gewogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcmVzdWx0OwogICAgICAK\nICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UubmV3QnVpbGRlcigpCiAg\nICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CiAgICAgIAogICAgICBwcml2YXRl\nIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBCdWlsZGVyIGJ1\naWxkZXIgPSBuZXcgQnVpbGRlcigpOwogICAgICAgIGJ1aWxkZXIucmVzdWx0\nID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2UoKTsKICAgICAgICByZXR1cm4gYnVpbGRlcjsKICAgICAg\nfQogICAgICAKICAgICAgcHJvdGVjdGVkIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgaW50ZXJuYWxHZXRSZXN1\nbHQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAgaWYgKHJl\nc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0\nYXRlRXhjZXB0aW9uKAogICAgICAgICAgICAiQ2Fubm90IGNhbGwgY2xlYXIo\nKSBhZnRlciBidWlsZCgpLiIpOwogICAgICAgIH0KICAgICAgICByZXN1bHQg\nPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICBy\nZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBl\nKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgZ2V0RGVmYXVsdEluc3Rh\nbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0\nSW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGJvb2xl\nYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmlz\nSW5pdGlhbGl6ZWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBidWls\nZCgpIHsKICAgICAgICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlh\nbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1l\nc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAgICAgICB9CiAgICAgICAgcmV0\ndXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICB9CiAgICAgIAogICAgICBwcml2\nYXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2UgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAg\ndGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAg\nICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRp\nb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgp\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZSBidWlsZFBhcnRp\nYWwoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAg\nICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1\naWxkZXIuIik7CiAgICAgICAgfQogICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UgcmV0dXJuTWUgPSBy\nZXN1bHQ7CiAgICAgICAgcmVzdWx0ID0gbnVsbDsKICAgICAgICByZXR1cm4g\ncmV0dXJuTWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIp\nIHsKICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlKSB7CiAgICAg\nICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlKW90aGVyKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2Ugb3RoZXIpIHsK\nICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2Uo\nKSkgcmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKG90aGVyLmhhc0JvZHkoKSkg\newogICAgICAgICAgc2V0Qm9keShvdGhlci5nZXRCb2R5KCkpOwogICAgICAg\nIH0KICAgICAgICBpZiAob3RoZXIuaGFzU3JjUmVnaW9uKCkpIHsKICAgICAg\nICAgIHNldFNyY1JlZ2lvbihvdGhlci5nZXRTcmNSZWdpb24oKSk7CiAgICAg\nICAgfQogICAgICAgIGlmIChvdGhlci5oYXNNc2dJZCgpKSB7CiAgICAgICAg\nICBtZXJnZU1zZ0lkKG90aGVyLmdldE1zZ0lkKCkpOwogICAgICAgIH0KICAg\nICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci5nZXRVbmtub3du\nRmllbGRzKCkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3\nQnVpbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkp\nOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0g\naW5wdXQucmVhZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAg\nICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93\nbkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAg\nICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZp\nZWxkcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4\ndGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICB0aGlz\nLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAg\nICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBj\nYXNlIDEwOiB7CiAgICAgICAgICAgICAgc2V0Qm9keShpbnB1dC5yZWFkQnl0\nZXMoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgY2FzZSAxODogewogICAgICAgICAgICAgIHNldFNyY1JlZ2lv\nbihpbnB1dC5yZWFkQnl0ZXMoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSAyNjogewogICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZC5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQu\nbmV3QnVpbGRlcigpOwogICAgICAgICAgICAgIGlmIChoYXNNc2dJZCgpKSB7\nCiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRNc2dJ\nZCgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaW5wdXQucmVh\nZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAg\nICAgICAgICAgIHNldE1zZ0lkKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICAKICAgICAgLy8g\ncmVxdWlyZWQgYnl0ZXMgYm9keSA9IDE7CiAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc0JvZHkoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNCb2R5KCk7\nCiAgICAgIH0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0\nZVN0cmluZyBnZXRCb2R5KCkgewogICAgICAgIHJldHVybiByZXN1bHQuZ2V0\nQm9keSgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldEJvZHko\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAg\nICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9p\nbnRlckV4Y2VwdGlvbigpOwogIH0KICByZXN1bHQuaGFzQm9keSA9IHRydWU7\nCiAgICAgICAgcmVzdWx0LmJvZHlfID0gdmFsdWU7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJCb2R5\nKCkgewogICAgICAgIHJlc3VsdC5oYXNCb2R5ID0gZmFsc2U7CiAgICAgICAg\ncmVzdWx0LmJvZHlfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0Qm9keSgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAv\nLyBvcHRpb25hbCBieXRlcyBzcmNSZWdpb24gPSAyOwogICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNTcmNSZWdpb24oKSB7CiAgICAgICAgcmV0dXJuIHJlc3Vs\ndC5oYXNTcmNSZWdpb24oKTsKICAgICAgfQogICAgICBwdWJsaWMgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFNyY1JlZ2lvbigpIHsKICAg\nICAgICByZXR1cm4gcmVzdWx0LmdldFNyY1JlZ2lvbigpOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIHNldFNyY1JlZ2lvbihjb20uZ29vZ2xlLnBy\nb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUg\nPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9u\nKCk7CiAgfQogIHJlc3VsdC5oYXNTcmNSZWdpb24gPSB0cnVlOwogICAgICAg\nIHJlc3VsdC5zcmNSZWdpb25fID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTcmNSZWdp\nb24oKSB7CiAgICAgICAgcmVzdWx0Lmhhc1NyY1JlZ2lvbiA9IGZhbHNlOwog\nICAgICAgIHJlc3VsdC5zcmNSZWdpb25fID0gZ2V0RGVmYXVsdEluc3RhbmNl\nKCkuZ2V0U3JjUmVnaW9uKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuTWVzc2FnZVNl\ncUlkIG1zZ0lkID0gMzsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzTXNnSWQo\nKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNNc2dJZCgpOwogICAgICB9\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgZ2V0TXNnSWQoKSB7CiAgICAgICAg\ncmV0dXJuIHJlc3VsdC5nZXRNc2dJZCgpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIHNldE1zZ0lkKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2YWx1ZSkgewogICAgICAg\nIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgTnVs\nbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0\nLmhhc01zZ0lkID0gdHJ1ZTsKICAgICAgICByZXN1bHQubXNnSWRfID0gdmFs\ndWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGlj\nIEJ1aWxkZXIgc2V0TXNnSWQob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxkZXIgYnVpbGRlckZv\nclZhbHVlKSB7CiAgICAgICAgcmVzdWx0Lmhhc01zZ0lkID0gdHJ1ZTsKICAg\nICAgICByZXN1bHQubXNnSWRfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxkKCk7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VNc2dJZChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgdmFsdWUpIHsKICAgICAgICBp\nZiAocmVzdWx0Lmhhc01zZ0lkKCkgJiYKICAgICAgICAgICAgcmVzdWx0Lm1z\nZ0lkXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAg\nICAgICAgIHJlc3VsdC5tc2dJZF8gPQogICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQu\nbmV3QnVpbGRlcihyZXN1bHQubXNnSWRfKS5tZXJnZUZyb20odmFsdWUpLmJ1\naWxkUGFydGlhbCgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1\nbHQubXNnSWRfID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5o\nYXNNc2dJZCA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNc2dJZCgpIHsKICAgICAgICBy\nZXN1bHQuaGFzTXNnSWQgPSBmYWxzZTsKICAgICAgICByZXN1bHQubXNnSWRf\nID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBAQHByb3RvY19p\nbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3aWcuTWVzc2FnZSkK\nICAgIH0KICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNl\nID0gbmV3IE1lc3NhZ2UodHJ1ZSk7CiAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9yY2VJbml0KCk7\nCiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAgICB9CiAg\nICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29w\nZTpIZWR3aWcuTWVzc2FnZSkKICB9CiAgCiAgcHVibGljIHN0YXRpYyBmaW5h\nbCBjbGFzcyBSZWdpb25TcGVjaWZpY1NlcUlkIGV4dGVuZHMKICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlIHsKICAgIC8vIFVz\nZSBSZWdpb25TcGVjaWZpY1NlcUlkLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1\nY3QuCiAgICBwcml2YXRlIFJlZ2lvblNwZWNpZmljU2VxSWQoKSB7CiAgICAg\nIGluaXRGaWVsZHMoKTsKICAgIH0KICAgIHByaXZhdGUgUmVnaW9uU3BlY2lm\naWNTZXFJZChib29sZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJpdmF0ZSBz\ndGF0aWMgZmluYWwgUmVnaW9uU3BlY2lmaWNTZXFJZCBkZWZhdWx0SW5zdGFu\nY2U7CiAgICBwdWJsaWMgc3RhdGljIFJlZ2lvblNwZWNpZmljU2VxSWQgZ2V0\nRGVmYXVsdEluc3RhbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3Rh\nbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgUmVnaW9uU3BlY2lmaWNTZXFJ\nZCBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4g\nZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3Jp\ncHRvcgogICAgICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX1JlZ2lvblNwZWNpZmljU2VxSWRfZGVzY3Jp\ncHRvcjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJv\ndG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAg\nICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAg\ncmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfUmVnaW9uU3BlY2lmaWNTZXFJ\nZF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAgICAKICAgIC8vIHJlcXVp\ncmVkIGJ5dGVzIHJlZ2lvbiA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBSRUdJT05fRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgYm9v\nbGVhbiBoYXNSZWdpb247CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyByZWdpb25fID0gY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nLkVNUFRZOwogICAgcHVibGljIGJvb2xlYW4gaGFzUmVnaW9u\nKCkgeyByZXR1cm4gaGFzUmVnaW9uOyB9CiAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFJlZ2lvbigpIHsgcmV0dXJuIHJl\nZ2lvbl87IH0KICAgIAogICAgLy8gcmVxdWlyZWQgdWludDY0IHNlcUlkID0g\nMjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNFUUlEX0ZJRUxEX05V\nTUJFUiA9IDI7CiAgICBwcml2YXRlIGJvb2xlYW4gaGFzU2VxSWQ7CiAgICBw\ncml2YXRlIGxvbmcgc2VxSWRfID0gMEw7CiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNTZXFJZCgpIHsgcmV0dXJuIGhhc1NlcUlkOyB9CiAgICBwdWJsaWMgbG9u\nZyBnZXRTZXFJZCgpIHsgcmV0dXJuIHNlcUlkXzsgfQogICAgCiAgICBwcml2\nYXRlIHZvaWQgaW5pdEZpZWxkcygpIHsKICAgIH0KICAgIHB1YmxpYyBmaW5h\nbCBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgIGlmICghaGFzUmVn\naW9uKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghaGFzU2VxSWQpIHJldHVy\nbiBmYWxzZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXpl\nZFNpemUoKTsKICAgICAgaWYgKGhhc1JlZ2lvbigpKSB7CiAgICAgICAgb3V0\ncHV0LndyaXRlQnl0ZXMoMSwgZ2V0UmVnaW9uKCkpOwogICAgICB9CiAgICAg\nIGlmIChoYXNTZXFJZCgpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlVUludDY0\nKDIsIGdldFNlcUlkKCkpOwogICAgICB9CiAgICAgIGdldFVua25vd25GaWVs\nZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUg\naW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBp\nbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXplID0gbWVt\nb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJl\ndHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBpZiAoaGFz\nUmVnaW9uKCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9i\ndWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNT\naXplKDEsIGdldFJlZ2lvbigpKTsKICAgICAgfQogICAgICBpZiAoaGFzU2Vx\nSWQoKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVVSW50NjRTaXpl\nKDIsIGdldFNlcUlkKCkpOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5r\nbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9p\nemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBh\ncnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmcgZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lv\nblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJv\nd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJF\neGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJv\nbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNp\nZmljU2VxSWQgcGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93\ncyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJl\nZ2lvblNwZWNpZmljU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBk\nYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNT\nZXFJZCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBh\ncnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlM\naXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAg\nICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9u\nU3BlY2lmaWNTZXFJZCBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1\ndFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2Vw\ndGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsK\nICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkg\newogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCBwYXJzZURlbGlt\naXRlZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1\naWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9t\nKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1cm4g\nYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAg\nIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJl\nZ2lvblNwZWNpZmljU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIHBhcnNlRnJv\nbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJl\nYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgCiAgICBw\ndWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0dXJuIEJ1\naWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVyIG5ld0J1aWxk\nZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9CiAgICBwdWJs\naWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nIHByb3RvdHlwZSkgewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShwcm90b3R5cGUpOwogICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9C\ndWlsZGVyKCkgeyByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAg\nICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5C\ndWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkIHJlc3VsdDsKICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdp\nb25TcGVjaWZpY1NlcUlkLm5ld0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1\naWxkZXIoKSB7fQogICAgICAKICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRl\nciBjcmVhdGUoKSB7CiAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1\naWxkZXIoKTsKICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVj\naWZpY1NlcUlkKCk7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAgIH0K\nICAgICAgCiAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIGludGVy\nbmFsR2V0UmVzdWx0KCkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAg\nIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAg\nICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3\nIElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgIkNhbm5vdCBj\nYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICB9CiAgICAg\nICAgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQoKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZSgpLm1lcmdlRnJv\nbShyZXN1bHQpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgY29tLmdv\nb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAg\nICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9u\nU3BlY2lmaWNTZXFJZC5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIGdldERlZmF1bHRJbnN0\nYW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2Vx\nSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgcmV0\ndXJuIHJlc3VsdC5pc0luaXRpYWxpemVkKCk7CiAgICAgIH0KICAgICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlJlZ2lvblNwZWNpZmljU2VxSWQgYnVpbGQoKSB7CiAgICAgICAgaWYgKHJl\nc3VsdCAhPSBudWxsICYmICFpc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAg\nIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3Vs\ndCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsK\nICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nIGJ1aWxkUGFyc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKCFpc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5l\nd1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICBy\nZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQgYnVpbGRQ\nYXJ0aWFsKCkgewogICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgewogICAg\nICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAg\nICAgICAgImJ1aWxkKCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQgb24gdGhp\ncyBCdWlsZGVyLiIpOwogICAgICAgIH0KICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkIHJldHVybk1lID0gcmVzdWx0OwogICAgICAgIHJlc3VsdCA9IG51bGw7\nCiAgICAgICAgcmV0dXJuIHJldHVybk1lOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2dsZS5wcm90b2J1\nZi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNl\nb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUmVnaW9uU3BlY2lmaWNTZXFJZCkgewogICAgICAgICAgcmV0dXJuIG1lcmdl\nRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUmVnaW9uU3BlY2lmaWNTZXFJZClvdGhlcik7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkIG90\naGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQu\nZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlm\nIChvdGhlci5oYXNSZWdpb24oKSkgewogICAgICAgICAgc2V0UmVnaW9uKG90\naGVyLmdldFJlZ2lvbigpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVy\nLmhhc1NlcUlkKCkpIHsKICAgICAgICAgIHNldFNlcUlkKG90aGVyLmdldFNl\ncUlkKCkpOwogICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZp\nZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBt\nZXJnZUZyb20oCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVy\nIHVua25vd25GaWVsZHMgPQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgdGhp\ncy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHdoaWxlICh0cnVlKSB7\nCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAg\nICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAg\nICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1\naWxkKCkpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25G\naWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7\nCiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93\nbkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBjYXNlIDEwOiB7CiAgICAgICAgICAgICAg\nc2V0UmVnaW9uKGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDE2OiB7CiAg\nICAgICAgICAgICAgc2V0U2VxSWQoaW5wdXQucmVhZFVJbnQ2NCgpKTsKICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgCiAgICAgIC8vIHJlcXVp\ncmVkIGJ5dGVzIHJlZ2lvbiA9IDE7CiAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc1JlZ2lvbigpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1JlZ2lvbigp\nOwogICAgICB9CiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZ2V0UmVnaW9uKCkgewogICAgICAgIHJldHVybiByZXN1bHQu\nZ2V0UmVnaW9uKCk7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0\nUmVnaW9uKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkg\newogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcg\nTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICB9CiAgcmVzdWx0Lmhhc1JlZ2lv\nbiA9IHRydWU7CiAgICAgICAgcmVzdWx0LnJlZ2lvbl8gPSB2YWx1ZTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBjbGVhclJlZ2lvbigpIHsKICAgICAgICByZXN1bHQuaGFzUmVnaW9uID0g\nZmFsc2U7CiAgICAgICAgcmVzdWx0LnJlZ2lvbl8gPSBnZXREZWZhdWx0SW5z\ndGFuY2UoKS5nZXRSZWdpb24oKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICAKICAgICAgLy8gcmVxdWlyZWQgdWludDY0IHNlcUlkID0g\nMjsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzU2VxSWQoKSB7CiAgICAgICAg\ncmV0dXJuIHJlc3VsdC5oYXNTZXFJZCgpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBsb25nIGdldFNlcUlkKCkgewogICAgICAgIHJldHVybiByZXN1bHQuZ2V0\nU2VxSWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTZXFJ\nZChsb25nIHZhbHVlKSB7CiAgICAgICAgcmVzdWx0Lmhhc1NlcUlkID0gdHJ1\nZTsKICAgICAgICByZXN1bHQuc2VxSWRfID0gdmFsdWU7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJT\nZXFJZCgpIHsKICAgICAgICByZXN1bHQuaGFzU2VxSWQgPSBmYWxzZTsKICAg\nICAgICByZXN1bHQuc2VxSWRfID0gMEw7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9w\nb2ludChidWlsZGVyX3Njb3BlOkhlZHdpZy5SZWdpb25TcGVjaWZpY1NlcUlk\nKQogICAgfQogICAgCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFu\nY2UgPSBuZXcgUmVnaW9uU3BlY2lmaWNTZXFJZCh0cnVlKTsKICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxGb3JjZUluaXQoKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVs\nZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3Bv\naW50KGNsYXNzX3Njb3BlOkhlZHdpZy5SZWdpb25TcGVjaWZpY1NlcUlkKQog\nIH0KICAKICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIE1lc3NhZ2VTZXFJ\nZCBleHRlbmRzCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZSB7CiAgICAvLyBVc2UgTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIo\nKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIE1lc3NhZ2VTZXFJZCgpIHsK\nICAgICAgaW5pdEZpZWxkcygpOwogICAgfQogICAgcHJpdmF0ZSBNZXNzYWdl\nU2VxSWQoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIE1lc3NhZ2VTZXFJZCBkZWZhdWx0SW5zdGFuY2U7CiAgICBw\ndWJsaWMgc3RhdGljIE1lc3NhZ2VTZXFJZCBnZXREZWZhdWx0SW5zdGFuY2Uo\nKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBNZXNzYWdlU2VxSWQgZ2V0RGVmYXVsdEluc3RhbmNlRm9y\nVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0K\nICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlw\ndG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNz\nYWdlU2VxSWRfZGVzY3JpcHRvcjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVk\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JU\nYWJsZSgpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfTWVz\nc2FnZVNlcUlkX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0KICAgIAogICAg\nLy8gb3B0aW9uYWwgdWludDY0IGxvY2FsQ29tcG9uZW50ID0gMTsKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgaW50IExPQ0FMQ09NUE9ORU5UX0ZJRUxEX05V\nTUJFUiA9IDE7CiAgICBwcml2YXRlIGJvb2xlYW4gaGFzTG9jYWxDb21wb25l\nbnQ7CiAgICBwcml2YXRlIGxvbmcgbG9jYWxDb21wb25lbnRfID0gMEw7CiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNMb2NhbENvbXBvbmVudCgpIHsgcmV0dXJu\nIGhhc0xvY2FsQ29tcG9uZW50OyB9CiAgICBwdWJsaWMgbG9uZyBnZXRMb2Nh\nbENvbXBvbmVudCgpIHsgcmV0dXJuIGxvY2FsQ29tcG9uZW50XzsgfQogICAg\nCiAgICAvLyByZXBlYXRlZCAuSGVkd2lnLlJlZ2lvblNwZWNpZmljU2VxSWQg\ncmVtb3RlQ29tcG9uZW50cyA9IDI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBSRU1PVEVDT01QT05FTlRTX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBw\ncml2YXRlIGphdmEudXRpbC5MaXN0PG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQ+IHJlbW90\nZUNvbXBvbmVudHNfID0KICAgICAgamF2YS51dGlsLkNvbGxlY3Rpb25zLmVt\ncHR5TGlzdCgpOwogICAgcHVibGljIGphdmEudXRpbC5MaXN0PG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNp\nZmljU2VxSWQ+IGdldFJlbW90ZUNvbXBvbmVudHNMaXN0KCkgewogICAgICBy\nZXR1cm4gcmVtb3RlQ29tcG9uZW50c187CiAgICB9CiAgICBwdWJsaWMgaW50\nIGdldFJlbW90ZUNvbXBvbmVudHNDb3VudCgpIHsgcmV0dXJuIHJlbW90ZUNv\nbXBvbmVudHNfLnNpemUoKTsgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2Vx\nSWQgZ2V0UmVtb3RlQ29tcG9uZW50cyhpbnQgaW5kZXgpIHsKICAgICAgcmV0\ndXJuIHJlbW90ZUNvbXBvbmVudHNfLmdldChpbmRleCk7CiAgICB9CiAgICAK\nICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgfQogICAgcHVi\nbGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgZm9y\nIChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5S\nZWdpb25TcGVjaWZpY1NlcUlkIGVsZW1lbnQgOiBnZXRSZW1vdGVDb21wb25l\nbnRzTGlzdCgpKSB7CiAgICAgICAgaWYgKCFlbGVtZW50LmlzSW5pdGlhbGl6\nZWQoKSkgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVl\nOwogICAgfQogICAgCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29n\nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAg\nICAgICAgICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIGlmIChoYXNMb2Nh\nbENvbXBvbmVudCgpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlVUludDY0KDEs\nIGdldExvY2FsQ29tcG9uZW50KCkpOwogICAgICB9CiAgICAgIGZvciAob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9u\nU3BlY2lmaWNTZXFJZCBlbGVtZW50IDogZ2V0UmVtb3RlQ29tcG9uZW50c0xp\nc3QoKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoMiwgZWxlbWVu\ndCk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8o\nb3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRT\nZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBnZXRTZXJpYWxp\nemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlhbGl6\nZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7CiAg\nICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmIChoYXNMb2NhbENvbXBvbmVu\ndCgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZVVJbnQ2NFNpemUo\nMSwgZ2V0TG9jYWxDb21wb25lbnQoKSk7CiAgICAgIH0KICAgICAgZm9yIChv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdp\nb25TcGVjaWZpY1NlcUlkIGVsZW1lbnQgOiBnZXRSZW1vdGVDb21wb25lbnRz\nTGlzdCgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVm\nLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VT\naXplKDIsIGVsZW1lbnQpOwogICAgICB9CiAgICAgIHNpemUgKz0gZ2V0VW5r\nbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIG1lbW9p\nemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4gc2l6ZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VG\ncm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBk\nYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBwYXJzZUZyb20oCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VGcm9tKGJ5\ndGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBwYXJzZUZyb20o\nCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0g\naW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVp\nbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlk\nIHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0\nLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0\ncnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAg\nICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAg\nICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBl\nbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgcGFyc2VEZWxpbWl0ZWRGcm9tKAog\nICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAg\nICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0\nZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVp\nbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVs\nbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQg\ncGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJ\nbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlU2VxSWQgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdC\ndWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVi\nbGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdC\ndWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWls\nZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLk1lc3NhZ2VTZXFJZCBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1Ymxp\nYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhp\ncyk7IH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWls\nZGVyIGV4dGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPiB7CiAgICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVz\nc2FnZVNlcUlkIHJlc3VsdDsKICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1\nc2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVp\nbGRlcigpIHt9CiAgICAgIAogICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVy\nIGNyZWF0ZSgpIHsKICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVp\nbGRlcigpOwogICAgICAgIGJ1aWxkZXIucmVzdWx0ID0gbmV3IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJ\nZCgpOwogICAgICAgIHJldHVybiBidWlsZGVyOwogICAgICB9CiAgICAgIAog\nICAgICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIGludGVybmFsR2V0UmVzdWx0KCkg\newogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIGlmIChyZXN1bHQg\nPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4\nY2VwdGlvbigKICAgICAgICAgICAgIkNhbm5vdCBjYWxsIGNsZWFyKCkgYWZ0\nZXIgYnVpbGQoKS4iKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0ID0gbmV3\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICBy\nZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBl\nKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVzY3JpcHRvcigp\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIGdldERl\nZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VT\nZXFJZC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICBy\nZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgfQogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkIGJ1aWxkKCkgewogICAgICAgIGlmIChyZXN1bHQg\nIT0gbnVsbCAmJiAhaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJv\ndyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwog\nICAgICAgIH0KICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAg\nIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIGJ1aWxkUGFyc2Vk\nKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFpc0lu\naXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6\nZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICByZXN1bHQpLmFzSW52\nYWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLk1lc3NhZ2VTZXFJZCBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAg\naWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAiYnVpbGQoKSBoYXMg\nYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAg\nICAgfQogICAgICAgIGlmIChyZXN1bHQucmVtb3RlQ29tcG9uZW50c18gIT0g\namF2YS51dGlsLkNvbGxlY3Rpb25zLkVNUFRZX0xJU1QpIHsKICAgICAgICAg\nIHJlc3VsdC5yZW1vdGVDb21wb25lbnRzXyA9CiAgICAgICAgICAgIGphdmEu\ndXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0KHJlc3VsdC5yZW1v\ndGVDb21wb25lbnRzXyk7CiAgICAgICAgfQogICAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBy\nZXR1cm5NZSA9IHJlc3VsdDsKICAgICAgICByZXN1bHQgPSBudWxsOwogICAg\nICAgIHJldHVybiByZXR1cm5NZTsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVz\nc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3Nh\nZ2VTZXFJZCkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkKW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIu\nbWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVy\nZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlz\nOwogICAgICAgIGlmIChvdGhlci5oYXNMb2NhbENvbXBvbmVudCgpKSB7CiAg\nICAgICAgICBzZXRMb2NhbENvbXBvbmVudChvdGhlci5nZXRMb2NhbENvbXBv\nbmVudCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFvdGhlci5yZW1vdGVD\nb21wb25lbnRzXy5pc0VtcHR5KCkpIHsKICAgICAgICAgIGlmIChyZXN1bHQu\ncmVtb3RlQ29tcG9uZW50c18uaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIHJl\nc3VsdC5yZW1vdGVDb21wb25lbnRzXyA9IG5ldyBqYXZhLnV0aWwuQXJyYXlM\naXN0PG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlJlZ2lvblNwZWNpZmljU2VxSWQ+KCk7CiAgICAgICAgICB9CiAgICAgICAg\nICByZXN1bHQucmVtb3RlQ29tcG9uZW50c18uYWRkQWxsKG90aGVyLnJlbW90\nZUNvbXBvbmVudHNfKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tZXJnZVVu\na25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1\naWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQu\nQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAg\nICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAo\ndHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsK\nICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoK\nICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZp\nZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgIGlmICghcGFyc2VV\nbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25SZWdpc3RyeSwg\ndGFnKSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRz\nKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA4OiB7CiAgICAgICAg\nICAgICAgc2V0TG9jYWxDb21wb25lbnQoaW5wdXQucmVhZFVJbnQ2NCgpKTsK\nICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAg\nICBjYXNlIDE4OiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZC5C\ndWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkLm5ld0J1aWxk\nZXIoKTsKICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWls\nZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgYWRkUmVt\nb3RlQ29tcG9uZW50cyhzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQog\nICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgCiAgICAgIC8vIG9wdGlv\nbmFsIHVpbnQ2NCBsb2NhbENvbXBvbmVudCA9IDE7CiAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc0xvY2FsQ29tcG9uZW50KCkgewogICAgICAgIHJldHVybiBy\nZXN1bHQuaGFzTG9jYWxDb21wb25lbnQoKTsKICAgICAgfQogICAgICBwdWJs\naWMgbG9uZyBnZXRMb2NhbENvbXBvbmVudCgpIHsKICAgICAgICByZXR1cm4g\ncmVzdWx0LmdldExvY2FsQ29tcG9uZW50KCk7CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgc2V0TG9jYWxDb21wb25lbnQobG9uZyB2YWx1ZSkgewog\nICAgICAgIHJlc3VsdC5oYXNMb2NhbENvbXBvbmVudCA9IHRydWU7CiAgICAg\nICAgcmVzdWx0LmxvY2FsQ29tcG9uZW50XyA9IHZhbHVlOwogICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFy\nTG9jYWxDb21wb25lbnQoKSB7CiAgICAgICAgcmVzdWx0Lmhhc0xvY2FsQ29t\ncG9uZW50ID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LmxvY2FsQ29tcG9uZW50\nXyA9IDBMOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICAvLyByZXBlYXRlZCAuSGVkd2lnLlJlZ2lvblNwZWNpZmljU2VxSWQg\ncmVtb3RlQ29tcG9uZW50cyA9IDI7CiAgICAgIHB1YmxpYyBqYXZhLnV0aWwu\nTGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5SZWdpb25TcGVjaWZpY1NlcUlkPiBnZXRSZW1vdGVDb21wb25lbnRzTGlz\ndCgpIHsKICAgICAgICByZXR1cm4gamF2YS51dGlsLkNvbGxlY3Rpb25zLnVu\nbW9kaWZpYWJsZUxpc3QocmVzdWx0LnJlbW90ZUNvbXBvbmVudHNfKTsKICAg\nICAgfQogICAgICBwdWJsaWMgaW50IGdldFJlbW90ZUNvbXBvbmVudHNDb3Vu\ndCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmdldFJlbW90ZUNvbXBvbmVu\ndHNDb3VudCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkIGdldFJlbW90ZUNvbXBvbmVudHMoaW50IGluZGV4KSB7CiAgICAgICAg\ncmV0dXJuIHJlc3VsdC5nZXRSZW1vdGVDb21wb25lbnRzKGluZGV4KTsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRSZW1vdGVDb21wb25lbnRz\nKGludCBpbmRleCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNTZXFJZCB2YWx1ZSkgewogICAgICAg\nIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgTnVs\nbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0\nLnJlbW90ZUNvbXBvbmVudHNfLnNldChpbmRleCwgdmFsdWUpOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndFJlbW90ZUNvbXBvbmVudHMoaW50IGluZGV4LCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlk\nLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgcmVzdWx0LnJl\nbW90ZUNvbXBvbmVudHNfLnNldChpbmRleCwgYnVpbGRlckZvclZhbHVlLmJ1\naWxkKCkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIGFkZFJlbW90ZUNvbXBvbmVudHMob3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lmaWNT\nZXFJZCB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAg\nICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKHJlc3VsdC5yZW1vdGVDb21wb25lbnRzXy5p\nc0VtcHR5KCkpIHsKICAgICAgICAgIHJlc3VsdC5yZW1vdGVDb21wb25lbnRz\nXyA9IG5ldyBqYXZhLnV0aWwuQXJyYXlMaXN0PG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lvblNwZWNpZmljU2VxSWQ+\nKCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5yZW1vdGVDb21wb25lbnRz\nXy5hZGQodmFsdWUpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGFkZFJlbW90ZUNvbXBvbmVudHMob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3Bl\nY2lmaWNTZXFJZC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAg\nIGlmIChyZXN1bHQucmVtb3RlQ29tcG9uZW50c18uaXNFbXB0eSgpKSB7CiAg\nICAgICAgICByZXN1bHQucmVtb3RlQ29tcG9uZW50c18gPSBuZXcgamF2YS51\ndGlsLkFycmF5TGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1NlcUlkPigpOwogICAgICAgIH0K\nICAgICAgICByZXN1bHQucmVtb3RlQ29tcG9uZW50c18uYWRkKGJ1aWxkZXJG\nb3JWYWx1ZS5idWlsZCgpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBhZGRBbGxSZW1vdGVDb21wb25lbnRz\nKAogICAgICAgICAgamF2YS5sYW5nLkl0ZXJhYmxlPD8gZXh0ZW5kcyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25T\ncGVjaWZpY1NlcUlkPiB2YWx1ZXMpIHsKICAgICAgICBpZiAocmVzdWx0LnJl\nbW90ZUNvbXBvbmVudHNfLmlzRW1wdHkoKSkgewogICAgICAgICAgcmVzdWx0\nLnJlbW90ZUNvbXBvbmVudHNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVn\naW9uU3BlY2lmaWNTZXFJZD4oKTsKICAgICAgICB9CiAgICAgICAgc3VwZXIu\nYWRkQWxsKHZhbHVlcywgcmVzdWx0LnJlbW90ZUNvbXBvbmVudHNfKTsKICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRl\nciBjbGVhclJlbW90ZUNvbXBvbmVudHMoKSB7CiAgICAgICAgcmVzdWx0LnJl\nbW90ZUNvbXBvbmVudHNfID0gamF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5\nTGlzdCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29w\nZTpIZWR3aWcuTWVzc2FnZVNlcUlkKQogICAgfQogICAgCiAgICBzdGF0aWMg\newogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgTWVzc2FnZVNlcUlkKHRy\ndWUpOwogICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5pbnRlcm5hbEZvcmNlSW5pdCgpOwogICAgICBkZWZhdWx0SW5z\ndGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAgICAvLyBAQHByb3Rv\nY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLk1lc3NhZ2VT\nZXFJZCkKICB9CiAgCiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBQdWJT\ndWJSZXF1ZXN0IGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlIHsKICAgIC8vIFVzZSBQdWJTdWJSZXF1ZXN0Lm5l\nd0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBwcml2YXRlIFB1YlN1YlJl\ncXVlc3QoKSB7CiAgICAgIGluaXRGaWVsZHMoKTsKICAgIH0KICAgIHByaXZh\ndGUgUHViU3ViUmVxdWVzdChib29sZWFuIG5vSW5pdCkge30KICAgIAogICAg\ncHJpdmF0ZSBzdGF0aWMgZmluYWwgUHViU3ViUmVxdWVzdCBkZWZhdWx0SW5z\ndGFuY2U7CiAgICBwdWJsaWMgc3RhdGljIFB1YlN1YlJlcXVlc3QgZ2V0RGVm\nYXVsdEluc3RhbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNl\nOwogICAgfQogICAgCiAgICBwdWJsaWMgUHViU3ViUmVxdWVzdCBnZXREZWZh\ndWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdElu\nc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNv\nbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAg\nICAgIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1B1YlN1YlJlcXVlc3RfZGVzY3JpcHRvcjsKICAgIH0KICAg\nIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBpbnRlcm5hbEdl\ndEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0\nYXRpY19IZWR3aWdfUHViU3ViUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7\nCiAgICB9CiAgICAKICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcuUHJvdG9jb2xW\nZXJzaW9uIHByb3RvY29sVmVyc2lvbiA9IDE7CiAgICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGludCBQUk9UT0NPTFZFUlNJT05fRklFTERfTlVNQkVSID0gMTsK\nICAgIHByaXZhdGUgYm9vbGVhbiBoYXNQcm90b2NvbFZlcnNpb247CiAgICBw\ncml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlByb3RvY29sVmVyc2lvbiBwcm90b2NvbFZlcnNpb25fOwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzUHJvdG9jb2xWZXJzaW9uKCkgeyByZXR1cm4gaGFz\nUHJvdG9jb2xWZXJzaW9uOyB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uIGdl\ndFByb3RvY29sVmVyc2lvbigpIHsgcmV0dXJuIHByb3RvY29sVmVyc2lvbl87\nIH0KICAgIAogICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5PcGVyYXRpb25UeXBl\nIHR5cGUgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgVFlQRV9G\nSUVMRF9OVU1CRVIgPSAyOwogICAgcHJpdmF0ZSBib29sZWFuIGhhc1R5cGU7\nCiAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk9wZXJhdGlvblR5cGUgdHlwZV87CiAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNUeXBlKCkgeyByZXR1cm4gaGFzVHlwZTsgfQogICAgcHVibGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk9w\nZXJhdGlvblR5cGUgZ2V0VHlwZSgpIHsgcmV0dXJuIHR5cGVfOyB9CiAgICAK\nICAgIC8vIHJlcGVhdGVkIGJ5dGVzIHRyaWVkU2VydmVycyA9IDM7CiAgICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGludCBUUklFRFNFUlZFUlNfRklFTERfTlVN\nQkVSID0gMzsKICAgIHByaXZhdGUgamF2YS51dGlsLkxpc3Q8Y29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nPiB0cmllZFNlcnZlcnNfID0KICAgICAg\namF2YS51dGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwogICAgcHVibGlj\nIGphdmEudXRpbC5MaXN0PGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZz4gZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpIHsKICAgICAgcmV0dXJuIHRyaWVk\nU2VydmVyc187CiAgICB9CiAgICBwdWJsaWMgaW50IGdldFRyaWVkU2VydmVy\nc0NvdW50KCkgeyByZXR1cm4gdHJpZWRTZXJ2ZXJzXy5zaXplKCk7IH0KICAg\nIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0VHJp\nZWRTZXJ2ZXJzKGludCBpbmRleCkgewogICAgICByZXR1cm4gdHJpZWRTZXJ2\nZXJzXy5nZXQoaW5kZXgpOwogICAgfQogICAgCiAgICAvLyByZXF1aXJlZCB1\naW50NjQgdHhuSWQgPSA0OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQg\nVFhOSURfRklFTERfTlVNQkVSID0gNDsKICAgIHByaXZhdGUgYm9vbGVhbiBo\nYXNUeG5JZDsKICAgIHByaXZhdGUgbG9uZyB0eG5JZF8gPSAwTDsKICAgIHB1\nYmxpYyBib29sZWFuIGhhc1R4bklkKCkgeyByZXR1cm4gaGFzVHhuSWQ7IH0K\nICAgIHB1YmxpYyBsb25nIGdldFR4bklkKCkgeyByZXR1cm4gdHhuSWRfOyB9\nCiAgICAKICAgIC8vIG9wdGlvbmFsIGJvb2wgc2hvdWxkQ2xhaW0gPSA1Owog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU0hPVUxEQ0xBSU1fRklFTERf\nTlVNQkVSID0gNTsKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNTaG91bGRDbGFp\nbTsKICAgIHByaXZhdGUgYm9vbGVhbiBzaG91bGRDbGFpbV8gPSBmYWxzZTsK\nICAgIHB1YmxpYyBib29sZWFuIGhhc1Nob3VsZENsYWltKCkgeyByZXR1cm4g\naGFzU2hvdWxkQ2xhaW07IH0KICAgIHB1YmxpYyBib29sZWFuIGdldFNob3Vs\nZENsYWltKCkgeyByZXR1cm4gc2hvdWxkQ2xhaW1fOyB9CiAgICAKICAgIC8v\nIHJlcXVpcmVkIGJ5dGVzIHRvcGljID0gNjsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IFRPUElDX0ZJRUxEX05VTUJFUiA9IDY7CiAgICBwcml2YXRl\nIGJvb2xlYW4gaGFzVG9waWM7CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyB0b3BpY18gPSBjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcuRU1QVFk7CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNUb3Bp\nYygpIHsgcmV0dXJuIGhhc1RvcGljOyB9CiAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFRvcGljKCkgeyByZXR1cm4gdG9w\naWNfOyB9CiAgICAKICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuUHVibGlzaFJl\ncXVlc3QgcHVibGlzaFJlcXVlc3QgPSA1MjsKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgaW50IFBVQkxJU0hSRVFVRVNUX0ZJRUxEX05VTUJFUiA9IDUyOwog\nICAgcHJpdmF0ZSBib29sZWFuIGhhc1B1Ymxpc2hSZXF1ZXN0OwogICAgcHJp\ndmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJsaXNoUmVxdWVzdCBwdWJsaXNoUmVxdWVzdF87CiAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNQdWJsaXNoUmVxdWVzdCgpIHsgcmV0dXJuIGhhc1B1Ymxp\nc2hSZXF1ZXN0OyB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgZ2V0UHVibGlz\naFJlcXVlc3QoKSB7IHJldHVybiBwdWJsaXNoUmVxdWVzdF87IH0KICAgIAog\nICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0IHN1YnNj\ncmliZVJlcXVlc3QgPSA1MzsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50\nIFNVQlNDUklCRVJFUVVFU1RfRklFTERfTlVNQkVSID0gNTM7CiAgICBwcml2\nYXRlIGJvb2xlYW4gaGFzU3Vic2NyaWJlUmVxdWVzdDsKICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaWJlUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0XzsKICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1N1YnNjcmliZVJlcXVlc3QoKSB7IHJldHVybiBoYXNTdWJz\nY3JpYmVSZXF1ZXN0OyB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBnZXRT\ndWJzY3JpYmVSZXF1ZXN0KCkgeyByZXR1cm4gc3Vic2NyaWJlUmVxdWVzdF87\nIH0KICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5Db25zdW1lUmVxdWVz\ndCBjb25zdW1lUmVxdWVzdCA9IDU0OwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgQ09OU1VNRVJFUVVFU1RfRklFTERfTlVNQkVSID0gNTQ7CiAgICBw\ncml2YXRlIGJvb2xlYW4gaGFzQ29uc3VtZVJlcXVlc3Q7CiAgICBwcml2YXRl\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNv\nbnN1bWVSZXF1ZXN0IGNvbnN1bWVSZXF1ZXN0XzsKICAgIHB1YmxpYyBib29s\nZWFuIGhhc0NvbnN1bWVSZXF1ZXN0KCkgeyByZXR1cm4gaGFzQ29uc3VtZVJl\ncXVlc3Q7IH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBnZXRDb25zdW1lUmVx\ndWVzdCgpIHsgcmV0dXJuIGNvbnN1bWVSZXF1ZXN0XzsgfQogICAgCiAgICAv\nLyBvcHRpb25hbCAuSGVkd2lnLlVuc3Vic2NyaWJlUmVxdWVzdCB1bnN1YnNj\ncmliZVJlcXVlc3QgPSA1NTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50\nIFVOU1VCU0NSSUJFUkVRVUVTVF9GSUVMRF9OVU1CRVIgPSA1NTsKICAgIHBy\naXZhdGUgYm9vbGVhbiBoYXNVbnN1YnNjcmliZVJlcXVlc3Q7CiAgICBwcml2\nYXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlVuc3Vic2NyaWJlUmVxdWVzdCB1bnN1YnNjcmliZVJlcXVlc3RfOwogICAg\ncHVibGljIGJvb2xlYW4gaGFzVW5zdWJzY3JpYmVSZXF1ZXN0KCkgeyByZXR1\ncm4gaGFzVW5zdWJzY3JpYmVSZXF1ZXN0OyB9CiAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3Jp\nYmVSZXF1ZXN0IGdldFVuc3Vic2NyaWJlUmVxdWVzdCgpIHsgcmV0dXJuIHVu\nc3Vic2NyaWJlUmVxdWVzdF87IH0KICAgIAogICAgLy8gb3B0aW9uYWwgLkhl\nZHdpZy5TdG9wRGVsaXZlcnlSZXF1ZXN0IHN0b3BEZWxpdmVyeVJlcXVlc3Qg\nPSA1NjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNUT1BERUxJVkVS\nWVJFUVVFU1RfRklFTERfTlVNQkVSID0gNTY7CiAgICBwcml2YXRlIGJvb2xl\nYW4gaGFzU3RvcERlbGl2ZXJ5UmVxdWVzdDsKICAgIHByaXZhdGUgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2\nZXJ5UmVxdWVzdCBzdG9wRGVsaXZlcnlSZXF1ZXN0XzsKICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1N0b3BEZWxpdmVyeVJlcXVlc3QoKSB7IHJldHVybiBoYXNT\ndG9wRGVsaXZlcnlSZXF1ZXN0OyB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVx\ndWVzdCBnZXRTdG9wRGVsaXZlcnlSZXF1ZXN0KCkgeyByZXR1cm4gc3RvcERl\nbGl2ZXJ5UmVxdWVzdF87IH0KICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdp\nZy5TdGFydERlbGl2ZXJ5UmVxdWVzdCBzdGFydERlbGl2ZXJ5UmVxdWVzdCA9\nIDU3OwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RBUlRERUxJVkVS\nWVJFUVVFU1RfRklFTERfTlVNQkVSID0gNTc7CiAgICBwcml2YXRlIGJvb2xl\nYW4gaGFzU3RhcnREZWxpdmVyeVJlcXVlc3Q7CiAgICBwcml2YXRlIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0IHN0YXJ0RGVsaXZlcnlSZXF1ZXN0XzsKICAgIHB1Ymxp\nYyBib29sZWFuIGhhc1N0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkgeyByZXR1cm4g\naGFzU3RhcnREZWxpdmVyeVJlcXVlc3Q7IH0KICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2\nZXJ5UmVxdWVzdCBnZXRTdGFydERlbGl2ZXJ5UmVxdWVzdCgpIHsgcmV0dXJu\nIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0XzsgfQogICAgCiAgICBwcml2YXRlIHZv\naWQgaW5pdEZpZWxkcygpIHsKICAgICAgcHJvdG9jb2xWZXJzaW9uXyA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3Rv\nY29sVmVyc2lvbi5WRVJTSU9OX09ORTsKICAgICAgdHlwZV8gPSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5PcGVyYXRpb25U\neXBlLlBVQkxJU0g7CiAgICAgIHB1Ymxpc2hSZXF1ZXN0XyA9IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1\nZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBzdWJzY3JpYmVSZXF1\nZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmliZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAg\nICAgIGNvbnN1bWVSZXF1ZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LmdldERlZmF1bHRJ\nbnN0YW5jZSgpOwogICAgICB1bnN1YnNjcmliZVJlcXVlc3RfID0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3Jp\nYmVSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICBzdG9wRGVs\naXZlcnlSZXF1ZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QuZ2V0RGVmYXVsdElu\nc3RhbmNlKCk7CiAgICAgIHN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyA9IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVs\naXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgfQogICAg\ncHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAg\naWYgKCFoYXNQcm90b2NvbFZlcnNpb24pIHJldHVybiBmYWxzZTsKICAgICAg\naWYgKCFoYXNUeXBlKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghaGFzVHhu\nSWQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKCFoYXNUb3BpYykgcmV0dXJu\nIGZhbHNlOwogICAgICBpZiAoaGFzUHVibGlzaFJlcXVlc3QoKSkgewogICAg\nICAgIGlmICghZ2V0UHVibGlzaFJlcXVlc3QoKS5pc0luaXRpYWxpemVkKCkp\nIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoaGFzU3Vic2NyaWJl\nUmVxdWVzdCgpKSB7CiAgICAgICAgaWYgKCFnZXRTdWJzY3JpYmVSZXF1ZXN0\nKCkuaXNJbml0aWFsaXplZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAg\nICAgaWYgKGhhc0NvbnN1bWVSZXF1ZXN0KCkpIHsKICAgICAgICBpZiAoIWdl\ndENvbnN1bWVSZXF1ZXN0KCkuaXNJbml0aWFsaXplZCgpKSByZXR1cm4gZmFs\nc2U7CiAgICAgIH0KICAgICAgaWYgKGhhc1Vuc3Vic2NyaWJlUmVxdWVzdCgp\nKSB7CiAgICAgICAgaWYgKCFnZXRVbnN1YnNjcmliZVJlcXVlc3QoKS5pc0lu\naXRpYWxpemVkKCkpIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAo\naGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAgICAgaWYgKCFnZXRT\ndG9wRGVsaXZlcnlSZXF1ZXN0KCkuaXNJbml0aWFsaXplZCgpKSByZXR1cm4g\nZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKGhhc1N0YXJ0RGVsaXZlcnlSZXF1\nZXN0KCkpIHsKICAgICAgICBpZiAoIWdldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nKCkuaXNJbml0aWFsaXplZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHdy\naXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBv\ndXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAg\nICAgaWYgKGhhc1Byb3RvY29sVmVyc2lvbigpKSB7CiAgICAgICAgb3V0cHV0\nLndyaXRlRW51bSgxLCBnZXRQcm90b2NvbFZlcnNpb24oKS5nZXROdW1iZXIo\nKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1R5cGUoKSkgewogICAgICAgIG91\ndHB1dC53cml0ZUVudW0oMiwgZ2V0VHlwZSgpLmdldE51bWJlcigpKTsKICAg\nICAgfQogICAgICBmb3IgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBlbGVtZW50IDogZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpKSB7CiAgICAgICAg\nb3V0cHV0LndyaXRlQnl0ZXMoMywgZWxlbWVudCk7CiAgICAgIH0KICAgICAg\naWYgKGhhc1R4bklkKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQo\nNCwgZ2V0VHhuSWQoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1Nob3VsZENs\nYWltKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCb29sKDUsIGdldFNob3Vs\nZENsYWltKCkpOwogICAgICB9CiAgICAgIGlmIChoYXNUb3BpYygpKSB7CiAg\nICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoNiwgZ2V0VG9waWMoKSk7CiAgICAg\nIH0KICAgICAgaWYgKGhhc1B1Ymxpc2hSZXF1ZXN0KCkpIHsKICAgICAgICBv\ndXRwdXQud3JpdGVNZXNzYWdlKDUyLCBnZXRQdWJsaXNoUmVxdWVzdCgpKTsK\nICAgICAgfQogICAgICBpZiAoaGFzU3Vic2NyaWJlUmVxdWVzdCgpKSB7CiAg\nICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSg1MywgZ2V0U3Vic2NyaWJlUmVx\ndWVzdCgpKTsKICAgICAgfQogICAgICBpZiAoaGFzQ29uc3VtZVJlcXVlc3Qo\nKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNTQsIGdldENvbnN1\nbWVSZXF1ZXN0KCkpOwogICAgICB9CiAgICAgIGlmIChoYXNVbnN1YnNjcmli\nZVJlcXVlc3QoKSkgewogICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNTUs\nIGdldFVuc3Vic2NyaWJlUmVxdWVzdCgpKTsKICAgICAgfQogICAgICBpZiAo\naGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAgICAgb3V0cHV0Lndy\naXRlTWVzc2FnZSg1NiwgZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdCgpKTsKICAg\nICAgfQogICAgICBpZiAoaGFzU3RhcnREZWxpdmVyeVJlcXVlc3QoKSkgewog\nICAgICAgIG91dHB1dC53cml0ZU1lc3NhZ2UoNTcsIGdldFN0YXJ0RGVsaXZl\ncnlSZXF1ZXN0KCkpOwogICAgICB9CiAgICAgIGdldFVua25vd25GaWVsZHMo\nKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50\nIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQg\nZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXplID0gbWVtb2l6\nZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVy\nbiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBpZiAoaGFzUHJv\ndG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRl\nRW51bVNpemUoMSwgZ2V0UHJvdG9jb2xWZXJzaW9uKCkuZ2V0TnVtYmVyKCkp\nOwogICAgICB9CiAgICAgIGlmIChoYXNUeXBlKCkpIHsKICAgICAgICBzaXpl\nICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAg\nICAgICAgIC5jb21wdXRlRW51bVNpemUoMiwgZ2V0VHlwZSgpLmdldE51bWJl\ncigpKTsKICAgICAgfQogICAgICB7CiAgICAgICAgaW50IGRhdGFTaXplID0g\nMDsKICAgICAgICBmb3IgKGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBlbGVtZW50IDogZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpKSB7CiAgICAgICAg\nICBkYXRhU2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0\nU3RyZWFtCiAgICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplTm9UYWcoZWxl\nbWVudCk7CiAgICAgICAgfQogICAgICAgIHNpemUgKz0gZGF0YVNpemU7CiAg\nICAgICAgc2l6ZSArPSAxICogZ2V0VHJpZWRTZXJ2ZXJzTGlzdCgpLnNpemUo\nKTsKICAgICAgfQogICAgICBpZiAoaGFzVHhuSWQoKSkgewogICAgICAgIHNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgLmNvbXB1dGVVSW50NjRTaXplKDQsIGdldFR4bklkKCkpOwog\nICAgICB9CiAgICAgIGlmIChoYXNTaG91bGRDbGFpbSgpKSB7CiAgICAgICAg\nc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nCiAgICAgICAgICAuY29tcHV0ZUJvb2xTaXplKDUsIGdldFNob3VsZENsYWlt\nKCkpOwogICAgICB9CiAgICAgIGlmIChoYXNUb3BpYygpKSB7CiAgICAgICAg\nc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFt\nCiAgICAgICAgICAuY29tcHV0ZUJ5dGVzU2l6ZSg2LCBnZXRUb3BpYygpKTsK\nICAgICAgfQogICAgICBpZiAoaGFzUHVibGlzaFJlcXVlc3QoKSkgewogICAg\nICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0\ncmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSg1MiwgZ2V0UHVi\nbGlzaFJlcXVlc3QoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1N1YnNjcmli\nZVJlcXVlc3QoKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90\nb2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNz\nYWdlU2l6ZSg1MywgZ2V0U3Vic2NyaWJlUmVxdWVzdCgpKTsKICAgICAgfQog\nICAgICBpZiAoaGFzQ29uc3VtZVJlcXVlc3QoKSkgewogICAgICAgIHNpemUg\nKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAg\nICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSg1NCwgZ2V0Q29uc3VtZVJlcXVl\nc3QoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1Vuc3Vic2NyaWJlUmVxdWVz\ndCgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXpl\nKDU1LCBnZXRVbnN1YnNjcmliZVJlcXVlc3QoKSk7CiAgICAgIH0KICAgICAg\naWYgKGhhc1N0b3BEZWxpdmVyeVJlcXVlc3QoKSkgewogICAgICAgIHNpemUg\nKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAg\nICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSg1NiwgZ2V0U3RvcERlbGl2ZXJ5\nUmVxdWVzdCgpKTsKICAgICAgfQogICAgICBpZiAoaGFzU3RhcnREZWxpdmVy\neVJlcXVlc3QoKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90\nb2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNz\nYWdlU2l6ZSg1NywgZ2V0U3RhcnREZWxpdmVyeVJlcXVlc3QoKSk7CiAgICAg\nIH0KICAgICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFs\naXplZFNpemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNp\nemU7CiAgICAgIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwdWJsaWMg\nc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlB1YlN1YlJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1\nYlJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHViU3ViUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHViU3ViUmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRh\ndGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdp\nc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0\nYSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBh\ncnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcGFyc2VGcm9tKAogICAg\nICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNl\nZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0IHBhcnNl\nRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRl\nciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5t\nZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1\naWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBy\nZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJT\ndWJSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVp\nbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRl\nci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5\nKSkgewogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAg\nICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAg\nIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdCBwYXJzZUZyb20oCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlu\ncHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3Qg\ncGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJ\nbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdp\nc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgeyBy\nZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxkZXIg\nbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0K\nICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVl\nc3QgcHJvdG90eXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0\nb0J1aWxkZXIoKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRz\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLkJ1aWxkZXI8QnVpbGRlcj4gewogICAgICBwcml2YXRlIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3Qg\ncmVzdWx0OwogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJl\ncXVlc3QubmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9\nCiAgICAgIAogICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgp\nIHsKICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcigpOwog\nICAgICAgIGJ1aWxkZXIucmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QoKTsKICAg\nICAgICByZXR1cm4gYnVpbGRlcjsKICAgICAgfQogICAgICAKICAgICAgcHJv\ndGVjdGVkIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlB1YlN1YlJlcXVlc3QgaW50ZXJuYWxHZXRSZXN1bHQoKSB7CiAgICAg\nICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGlj\nIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxs\nKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9u\nKAogICAgICAgICAgICAiQ2Fubm90IGNhbGwgY2xlYXIoKSBhZnRlciBidWls\nZCgpLiIpOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSBuZXcgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVx\ndWVzdCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4g\nY3JlYXRlKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRl\nc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewog\nICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgZ2V0RGVmYXVs\ndEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVz\ndC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICByZXR1\ncm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgfQogICAgICBwdWJs\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHViU3ViUmVxdWVzdCBidWlsZCgpIHsKICAgICAgICBpZiAocmVzdWx0ICE9\nIG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cg\nbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICB9\nCiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgYnVpbGRQYXJzZWQo\nKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxp\nZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWlzSW5p\ndGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXpl\nZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJlc3VsdCkuYXNJbnZh\nbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAg\nICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUHViU3ViUmVxdWVzdCBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAg\naWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxs\nZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAiYnVpbGQoKSBoYXMg\nYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAg\nICAgfQogICAgICAgIGlmIChyZXN1bHQudHJpZWRTZXJ2ZXJzXyAhPSBqYXZh\nLnV0aWwuQ29sbGVjdGlvbnMuRU1QVFlfTElTVCkgewogICAgICAgICAgcmVz\ndWx0LnRyaWVkU2VydmVyc18gPQogICAgICAgICAgICBqYXZhLnV0aWwuQ29s\nbGVjdGlvbnMudW5tb2RpZmlhYmxlTGlzdChyZXN1bHQudHJpZWRTZXJ2ZXJz\nXyk7CiAgICAgICAgfQogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlcXVlc3QgcmV0dXJuTWUgPSBy\nZXN1bHQ7CiAgICAgICAgcmVzdWx0ID0gbnVsbDsKICAgICAgICByZXR1cm4g\ncmV0dXJuTWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIp\nIHsKICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0KSB7\nCiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0KW90aGVy\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9t\nKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1\nYlJlcXVlc3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVx\ndWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7CiAgICAg\nICAgaWYgKG90aGVyLmhhc1Byb3RvY29sVmVyc2lvbigpKSB7CiAgICAgICAg\nICBzZXRQcm90b2NvbFZlcnNpb24ob3RoZXIuZ2V0UHJvdG9jb2xWZXJzaW9u\nKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzVHlwZSgpKSB7\nCiAgICAgICAgICBzZXRUeXBlKG90aGVyLmdldFR5cGUoKSk7CiAgICAgICAg\nfQogICAgICAgIGlmICghb3RoZXIudHJpZWRTZXJ2ZXJzXy5pc0VtcHR5KCkp\nIHsKICAgICAgICAgIGlmIChyZXN1bHQudHJpZWRTZXJ2ZXJzXy5pc0VtcHR5\nKCkpIHsKICAgICAgICAgICAgcmVzdWx0LnRyaWVkU2VydmVyc18gPSBuZXcg\namF2YS51dGlsLkFycmF5TGlzdDxjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmc+KCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHQudHJpZWRT\nZXJ2ZXJzXy5hZGRBbGwob3RoZXIudHJpZWRTZXJ2ZXJzXyk7CiAgICAgICAg\nfQogICAgICAgIGlmIChvdGhlci5oYXNUeG5JZCgpKSB7CiAgICAgICAgICBz\nZXRUeG5JZChvdGhlci5nZXRUeG5JZCgpKTsKICAgICAgICB9CiAgICAgICAg\naWYgKG90aGVyLmhhc1Nob3VsZENsYWltKCkpIHsKICAgICAgICAgIHNldFNo\nb3VsZENsYWltKG90aGVyLmdldFNob3VsZENsYWltKCkpOwogICAgICAgIH0K\nICAgICAgICBpZiAob3RoZXIuaGFzVG9waWMoKSkgewogICAgICAgICAgc2V0\nVG9waWMob3RoZXIuZ2V0VG9waWMoKSk7CiAgICAgICAgfQogICAgICAgIGlm\nIChvdGhlci5oYXNQdWJsaXNoUmVxdWVzdCgpKSB7CiAgICAgICAgICBtZXJn\nZVB1Ymxpc2hSZXF1ZXN0KG90aGVyLmdldFB1Ymxpc2hSZXF1ZXN0KCkpOwog\nICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzU3Vic2NyaWJlUmVxdWVz\ndCgpKSB7CiAgICAgICAgICBtZXJnZVN1YnNjcmliZVJlcXVlc3Qob3RoZXIu\nZ2V0U3Vic2NyaWJlUmVxdWVzdCgpKTsKICAgICAgICB9CiAgICAgICAgaWYg\nKG90aGVyLmhhc0NvbnN1bWVSZXF1ZXN0KCkpIHsKICAgICAgICAgIG1lcmdl\nQ29uc3VtZVJlcXVlc3Qob3RoZXIuZ2V0Q29uc3VtZVJlcXVlc3QoKSk7CiAg\nICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNVbnN1YnNjcmliZVJlcXVl\nc3QoKSkgewogICAgICAgICAgbWVyZ2VVbnN1YnNjcmliZVJlcXVlc3Qob3Ro\nZXIuZ2V0VW5zdWJzY3JpYmVSZXF1ZXN0KCkpOwogICAgICAgIH0KICAgICAg\nICBpZiAob3RoZXIuaGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAg\nICAgICBtZXJnZVN0b3BEZWxpdmVyeVJlcXVlc3Qob3RoZXIuZ2V0U3RvcERl\nbGl2ZXJ5UmVxdWVzdCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVy\nLmhhc1N0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkpIHsKICAgICAgICAgIG1lcmdl\nU3RhcnREZWxpdmVyeVJlcXVlc3Qob3RoZXIuZ2V0U3RhcnREZWxpdmVyeVJl\ncXVlc3QoKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVyZ2VVbmtub3du\nRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1aWxk\nZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAgICB0\naGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRydWUp\nIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAgICAg\nICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAgICAg\nICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMu\nYnVpbGQoKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAg\nICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5rbm93\nbkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRhZykp\nIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtu\nb3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgODogewogICAgICAgICAgICAg\nIGludCByYXdWYWx1ZSA9IGlucHV0LnJlYWRFbnVtKCk7CiAgICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nUHJvdG9jb2xWZXJzaW9uIHZhbHVlID0gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uLnZhbHVlT2Yo\ncmF3VmFsdWUpOwogICAgICAgICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7\nCiAgICAgICAgICAgICAgICB1bmtub3duRmllbGRzLm1lcmdlVmFyaW50Rmll\nbGQoMSwgcmF3VmFsdWUpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBzZXRQcm90b2NvbFZlcnNpb24odmFsdWUpOwogICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBjYXNlIDE2OiB7CiAgICAgICAgICAgICAgaW50IHJhd1Zh\nbHVlID0gaW5wdXQucmVhZEVudW0oKTsKICAgICAgICAgICAgICBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5PcGVyYXRpb25U\neXBlIHZhbHVlID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuT3BlcmF0aW9uVHlwZS52YWx1ZU9mKHJhd1ZhbHVlKTsKICAg\nICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAg\nICAgdW5rbm93bkZpZWxkcy5tZXJnZVZhcmludEZpZWxkKDIsIHJhd1ZhbHVl\nKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc2V0\nVHlwZSh2YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMjY6IHsKICAg\nICAgICAgICAgICBhZGRUcmllZFNlcnZlcnMoaW5wdXQucmVhZEJ5dGVzKCkp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIGNhc2UgMzI6IHsKICAgICAgICAgICAgICBzZXRUeG5JZChpbnB1dC5y\nZWFkVUludDY0KCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAg\nICB9CiAgICAgICAgICAgIGNhc2UgNDA6IHsKICAgICAgICAgICAgICBzZXRT\naG91bGRDbGFpbShpbnB1dC5yZWFkQm9vbCgpKTsKICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDUwOiB7CiAg\nICAgICAgICAgICAgc2V0VG9waWMoaW5wdXQucmVhZEJ5dGVzKCkpOwogICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNh\nc2UgNDE4OiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QuQnVpbGRlciBz\ndWJCdWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QubmV3QnVpbGRlcigpOwogICAgICAg\nICAgICAgIGlmIChoYXNQdWJsaXNoUmVxdWVzdCgpKSB7CiAgICAgICAgICAg\nICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRQdWJsaXNoUmVxdWVzdCgp\nKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaW5wdXQucmVhZE1l\nc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwogICAgICAg\nICAgICAgIHNldFB1Ymxpc2hSZXF1ZXN0KHN1YkJ1aWxkZXIuYnVpbGRQYXJ0\naWFsKCkpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAg\nICAgICAgICAgIGNhc2UgNDI2OiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVx\ndWVzdC5CdWlsZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0Lm5ld0J1\naWxkZXIoKTsKICAgICAgICAgICAgICBpZiAoaGFzU3Vic2NyaWJlUmVxdWVz\ndCgpKSB7CiAgICAgICAgICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShn\nZXRTdWJzY3JpYmVSZXF1ZXN0KCkpOwogICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNp\nb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0U3Vic2NyaWJlUmVxdWVz\ndChzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDQzNDogewog\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LkJ1aWxkZXIgc3ViQnVpbGRlciA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNv\nbnN1bWVSZXF1ZXN0Lm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICBpZiAo\naGFzQ29uc3VtZVJlcXVlc3QoKSkgewogICAgICAgICAgICAgICAgc3ViQnVp\nbGRlci5tZXJnZUZyb20oZ2V0Q29uc3VtZVJlcXVlc3QoKSk7CiAgICAgICAg\nICAgICAgfQogICAgICAgICAgICAgIGlucHV0LnJlYWRNZXNzYWdlKHN1YkJ1\naWxkZXIsIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAgICAgICAgICAgICBzZXRD\nb25zdW1lUmVxdWVzdChzdWJCdWlsZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBj\nYXNlIDQ0MjogewogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdC5CdWls\nZGVyIHN1YkJ1aWxkZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QubmV3QnVpbGRlcigp\nOwogICAgICAgICAgICAgIGlmIChoYXNVbnN1YnNjcmliZVJlcXVlc3QoKSkg\newogICAgICAgICAgICAgICAgc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0VW5z\ndWJzY3JpYmVSZXF1ZXN0KCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25S\nZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0VW5zdWJzY3JpYmVSZXF1ZXN0\nKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAgICAgICAgICAgIGJy\nZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgNDUwOiB7CiAg\nICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdC5CdWlsZGVyIHN1YkJ1aWxk\nZXIgPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdG9wRGVsaXZlcnlSZXF1ZXN0Lm5ld0J1aWxkZXIoKTsKICAgICAgICAg\nICAgICBpZiAoaGFzU3RvcERlbGl2ZXJ5UmVxdWVzdCgpKSB7CiAgICAgICAg\nICAgICAgICBzdWJCdWlsZGVyLm1lcmdlRnJvbShnZXRTdG9wRGVsaXZlcnlS\nZXF1ZXN0KCkpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpbnB1\ndC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7\nCiAgICAgICAgICAgICAgc2V0U3RvcERlbGl2ZXJ5UmVxdWVzdChzdWJCdWls\nZGVyLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDQ1ODogewogICAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0\nRGVsaXZlcnlSZXF1ZXN0Lm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgICBp\nZiAoaGFzU3RhcnREZWxpdmVyeVJlcXVlc3QoKSkgewogICAgICAgICAgICAg\nICAgc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0U3RhcnREZWxpdmVyeVJlcXVl\nc3QoKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlucHV0LnJl\nYWRNZXNzYWdlKHN1YkJ1aWxkZXIsIGV4dGVuc2lvblJlZ2lzdHJ5KTsKICAg\nICAgICAgICAgICBzZXRTdGFydERlbGl2ZXJ5UmVxdWVzdChzdWJCdWlsZGVy\nLmJ1aWxkUGFydGlhbCgpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAK\nICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcuUHJvdG9jb2xWZXJz\naW9uIHByb3RvY29sVmVyc2lvbiA9IDE7CiAgICAgIHB1YmxpYyBib29sZWFu\nIGhhc1Byb3RvY29sVmVyc2lvbigpIHsKICAgICAgICByZXR1cm4gcmVzdWx0\nLmhhc1Byb3RvY29sVmVyc2lvbigpOwogICAgICB9CiAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90\nb2NvbFZlcnNpb24gZ2V0UHJvdG9jb2xWZXJzaW9uKCkgewogICAgICAgIHJl\ndHVybiByZXN1bHQuZ2V0UHJvdG9jb2xWZXJzaW9uKCk7CiAgICAgIH0KICAg\nICAgcHVibGljIEJ1aWxkZXIgc2V0UHJvdG9jb2xWZXJzaW9uKG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVy\nc2lvbiB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAg\nICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgcmVzdWx0Lmhhc1Byb3RvY29sVmVyc2lvbiA9IHRy\ndWU7CiAgICAgICAgcmVzdWx0LnByb3RvY29sVmVyc2lvbl8gPSB2YWx1ZTsK\nICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBjbGVhclByb3RvY29sVmVyc2lvbigpIHsKICAgICAgICByZXN1bHQu\naGFzUHJvdG9jb2xWZXJzaW9uID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LnBy\nb3RvY29sVmVyc2lvbl8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNpb24uVkVSU0lPTl9PTkU7CiAg\nICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIHJl\ncXVpcmVkIC5IZWR3aWcuT3BlcmF0aW9uVHlwZSB0eXBlID0gMjsKICAgICAg\ncHVibGljIGJvb2xlYW4gaGFzVHlwZSgpIHsKICAgICAgICByZXR1cm4gcmVz\ndWx0Lmhhc1R5cGUoKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9uVHlw\nZSBnZXRUeXBlKCkgewogICAgICAgIHJldHVybiByZXN1bHQuZ2V0VHlwZSgp\nOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFR5cGUob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuT3BlcmF0aW9u\nVHlwZSB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAg\nICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgcmVzdWx0Lmhhc1R5cGUgPSB0cnVlOwogICAgICAg\nIHJlc3VsdC50eXBlXyA9IHZhbHVlOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVHlwZSgpIHsKICAg\nICAgICByZXN1bHQuaGFzVHlwZSA9IGZhbHNlOwogICAgICAgIHJlc3VsdC50\neXBlXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk9wZXJhdGlvblR5cGUuUFVCTElTSDsKICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICAKICAgICAgLy8gcmVwZWF0ZWQgYnl0ZXMgdHJp\nZWRTZXJ2ZXJzID0gMzsKICAgICAgcHVibGljIGphdmEudXRpbC5MaXN0PGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZz4gZ2V0VHJpZWRTZXJ2ZXJz\nTGlzdCgpIHsKICAgICAgICByZXR1cm4gamF2YS51dGlsLkNvbGxlY3Rpb25z\nLnVubW9kaWZpYWJsZUxpc3QocmVzdWx0LnRyaWVkU2VydmVyc18pOwogICAg\nICB9CiAgICAgIHB1YmxpYyBpbnQgZ2V0VHJpZWRTZXJ2ZXJzQ291bnQoKSB7\nCiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRUcmllZFNlcnZlcnNDb3VudCgp\nOwogICAgICB9CiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZ2V0VHJpZWRTZXJ2ZXJzKGludCBpbmRleCkgewogICAgICAg\nIHJldHVybiByZXN1bHQuZ2V0VHJpZWRTZXJ2ZXJzKGluZGV4KTsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRUcmllZFNlcnZlcnMoaW50IGlu\nZGV4LCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsK\nICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51\nbGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIHJlc3VsdC50cmllZFNlcnZl\ncnNfLnNldChpbmRleCwgdmFsdWUpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZFRyaWVkU2VydmVycyhj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAg\nICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2lu\ndGVyRXhjZXB0aW9uKCk7CiAgfQogIGlmIChyZXN1bHQudHJpZWRTZXJ2ZXJz\nXy5pc0VtcHR5KCkpIHsKICAgICAgICAgIHJlc3VsdC50cmllZFNlcnZlcnNf\nID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8Y29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nPigpOwogICAgICAgIH0KICAgICAgICByZXN1bHQudHJp\nZWRTZXJ2ZXJzXy5hZGQodmFsdWUpOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGFkZEFsbFRyaWVkU2VydmVy\ncygKICAgICAgICAgIGphdmEubGFuZy5JdGVyYWJsZTw/IGV4dGVuZHMgY29t\nLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nPiB2YWx1ZXMpIHsKICAgICAg\nICBpZiAocmVzdWx0LnRyaWVkU2VydmVyc18uaXNFbXB0eSgpKSB7CiAgICAg\nICAgICByZXN1bHQudHJpZWRTZXJ2ZXJzXyA9IG5ldyBqYXZhLnV0aWwuQXJy\nYXlMaXN0PGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZz4oKTsKICAg\nICAgICB9CiAgICAgICAgc3VwZXIuYWRkQWxsKHZhbHVlcywgcmVzdWx0LnRy\naWVkU2VydmVyc18pOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyVHJpZWRTZXJ2ZXJzKCkgewogICAg\nICAgIHJlc3VsdC50cmllZFNlcnZlcnNfID0gamF2YS51dGlsLkNvbGxlY3Rp\nb25zLmVtcHR5TGlzdCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIAogICAgICAvLyByZXF1aXJlZCB1aW50NjQgdHhuSWQgPSA0Owog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNUeG5JZCgpIHsKICAgICAgICByZXR1\ncm4gcmVzdWx0Lmhhc1R4bklkKCk7CiAgICAgIH0KICAgICAgcHVibGljIGxv\nbmcgZ2V0VHhuSWQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRUeG5J\nZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFR4bklkKGxv\nbmcgdmFsdWUpIHsKICAgICAgICByZXN1bHQuaGFzVHhuSWQgPSB0cnVlOwog\nICAgICAgIHJlc3VsdC50eG5JZF8gPSB2YWx1ZTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclR4bklk\nKCkgewogICAgICAgIHJlc3VsdC5oYXNUeG5JZCA9IGZhbHNlOwogICAgICAg\nIHJlc3VsdC50eG5JZF8gPSAwTDsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgYm9vbCBzaG91bGRDbGFp\nbSA9IDU7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1Nob3VsZENsYWltKCkg\newogICAgICAgIHJldHVybiByZXN1bHQuaGFzU2hvdWxkQ2xhaW0oKTsKICAg\nICAgfQogICAgICBwdWJsaWMgYm9vbGVhbiBnZXRTaG91bGRDbGFpbSgpIHsK\nICAgICAgICByZXR1cm4gcmVzdWx0LmdldFNob3VsZENsYWltKCk7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0U2hvdWxkQ2xhaW0oYm9vbGVh\nbiB2YWx1ZSkgewogICAgICAgIHJlc3VsdC5oYXNTaG91bGRDbGFpbSA9IHRy\ndWU7CiAgICAgICAgcmVzdWx0LnNob3VsZENsYWltXyA9IHZhbHVlOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIGNsZWFyU2hvdWxkQ2xhaW0oKSB7CiAgICAgICAgcmVzdWx0Lmhhc1Nob3Vs\nZENsYWltID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LnNob3VsZENsYWltXyA9\nIGZhbHNlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICAvLyByZXF1aXJlZCBieXRlcyB0b3BpYyA9IDY7CiAgICAgIHB1Ymxp\nYyBib29sZWFuIGhhc1RvcGljKCkgewogICAgICAgIHJldHVybiByZXN1bHQu\naGFzVG9waWMoKTsKICAgICAgfQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5w\ncm90b2J1Zi5CeXRlU3RyaW5nIGdldFRvcGljKCkgewogICAgICAgIHJldHVy\nbiByZXN1bHQuZ2V0VG9waWMoKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRUb3BpYyhjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\ndmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhy\nb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIHJlc3VsdC5o\nYXNUb3BpYyA9IHRydWU7CiAgICAgICAgcmVzdWx0LnRvcGljXyA9IHZhbHVl\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyVG9waWMoKSB7CiAgICAgICAgcmVzdWx0Lmhhc1RvcGlj\nID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LnRvcGljXyA9IGdldERlZmF1bHRJ\nbnN0YW5jZSgpLmdldFRvcGljKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuUHVibGlz\naFJlcXVlc3QgcHVibGlzaFJlcXVlc3QgPSA1MjsKICAgICAgcHVibGljIGJv\nb2xlYW4gaGFzUHVibGlzaFJlcXVlc3QoKSB7CiAgICAgICAgcmV0dXJuIHJl\nc3VsdC5oYXNQdWJsaXNoUmVxdWVzdCgpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJsaXNoUmVxdWVzdCBnZXRQdWJsaXNoUmVxdWVzdCgpIHsKICAgICAgICBy\nZXR1cm4gcmVzdWx0LmdldFB1Ymxpc2hSZXF1ZXN0KCk7CiAgICAgIH0KICAg\nICAgcHVibGljIEJ1aWxkZXIgc2V0UHVibGlzaFJlcXVlc3Qob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVl\nc3QgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAg\nICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAg\nICAgfQogICAgICAgIHJlc3VsdC5oYXNQdWJsaXNoUmVxdWVzdCA9IHRydWU7\nCiAgICAgICAgcmVzdWx0LnB1Ymxpc2hSZXF1ZXN0XyA9IHZhbHVlOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIHNldFB1Ymxpc2hSZXF1ZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0LkJ1aWxkZXIgYnVpbGRl\nckZvclZhbHVlKSB7CiAgICAgICAgcmVzdWx0Lmhhc1B1Ymxpc2hSZXF1ZXN0\nID0gdHJ1ZTsKICAgICAgICByZXN1bHQucHVibGlzaFJlcXVlc3RfID0gYnVp\nbGRlckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VQdWJsaXNoUmVxdWVz\ndChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJsaXNoUmVxdWVzdCB2YWx1ZSkgewogICAgICAgIGlmIChyZXN1bHQuaGFz\nUHVibGlzaFJlcXVlc3QoKSAmJgogICAgICAgICAgICByZXN1bHQucHVibGlz\naFJlcXVlc3RfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgp\nKSB7CiAgICAgICAgICByZXN1bHQucHVibGlzaFJlcXVlc3RfID0KICAgICAg\nICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuUHVibGlzaFJlcXVlc3QubmV3QnVpbGRlcihyZXN1bHQucHVibGlzaFJl\ncXVlc3RfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQucHVibGlzaFJlcXVlc3Rf\nID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5oYXNQdWJsaXNo\nUmVxdWVzdCA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJQdWJsaXNoUmVxdWVzdCgpIHsK\nICAgICAgICByZXN1bHQuaGFzUHVibGlzaFJlcXVlc3QgPSBmYWxzZTsKICAg\nICAgICByZXN1bHQucHVibGlzaFJlcXVlc3RfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2NyaWJl\nUmVxdWVzdCBzdWJzY3JpYmVSZXF1ZXN0ID0gNTM7CiAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1N1YnNjcmliZVJlcXVlc3QoKSB7CiAgICAgICAgcmV0dXJu\nIHJlc3VsdC5oYXNTdWJzY3JpYmVSZXF1ZXN0KCk7CiAgICAgIH0KICAgICAg\ncHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN1YnNjcmliZVJlcXVlc3QgZ2V0U3Vic2NyaWJlUmVxdWVzdCgpIHsK\nICAgICAgICByZXR1cm4gcmVzdWx0LmdldFN1YnNjcmliZVJlcXVlc3QoKTsK\nICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdWJzY3JpYmVSZXF1\nZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN1YnNjcmliZVJlcXVlc3QgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUg\nPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhj\nZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5oYXNTdWJzY3Jp\nYmVSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICByZXN1bHQuc3Vic2NyaWJlUmVx\ndWVzdF8gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdWJzY3JpYmVSZXF1ZXN0KG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmli\nZVJlcXVlc3QuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICBy\nZXN1bHQuaGFzU3Vic2NyaWJlUmVxdWVzdCA9IHRydWU7CiAgICAgICAgcmVz\ndWx0LnN1YnNjcmliZVJlcXVlc3RfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxk\nKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGlj\nIEJ1aWxkZXIgbWVyZ2VTdWJzY3JpYmVSZXF1ZXN0KG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Qg\ndmFsdWUpIHsKICAgICAgICBpZiAocmVzdWx0Lmhhc1N1YnNjcmliZVJlcXVl\nc3QoKSAmJgogICAgICAgICAgICByZXN1bHQuc3Vic2NyaWJlUmVxdWVzdF8g\nIT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAg\nICAgICAgcmVzdWx0LnN1YnNjcmliZVJlcXVlc3RfID0KICAgICAgICAgICAg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaWJlUmVxdWVzdC5uZXdCdWlsZGVyKHJlc3VsdC5zdWJzY3JpYmVSZXF1\nZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAgICAg\nICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0LnN1YnNjcmliZVJlcXVlc3Rf\nID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5oYXNTdWJzY3Jp\nYmVSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN1YnNjcmliZVJlcXVlc3Qo\nKSB7CiAgICAgICAgcmVzdWx0Lmhhc1N1YnNjcmliZVJlcXVlc3QgPSBmYWxz\nZTsKICAgICAgICByZXN1bHQuc3Vic2NyaWJlUmVxdWVzdF8gPSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2ln\nLkNvbnN1bWVSZXF1ZXN0IGNvbnN1bWVSZXF1ZXN0ID0gNTQ7CiAgICAgIHB1\nYmxpYyBib29sZWFuIGhhc0NvbnN1bWVSZXF1ZXN0KCkgewogICAgICAgIHJl\ndHVybiByZXN1bHQuaGFzQ29uc3VtZVJlcXVlc3QoKTsKICAgICAgfQogICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuQ29uc3VtZVJlcXVlc3QgZ2V0Q29uc3VtZVJlcXVlc3QoKSB7CiAg\nICAgICAgcmV0dXJuIHJlc3VsdC5nZXRDb25zdW1lUmVxdWVzdCgpOwogICAg\nICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldENvbnN1bWVSZXF1ZXN0KG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1\nbWVSZXF1ZXN0IHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwp\nIHsKICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigp\nOwogICAgICAgIH0KICAgICAgICByZXN1bHQuaGFzQ29uc3VtZVJlcXVlc3Qg\nPSB0cnVlOwogICAgICAgIHJlc3VsdC5jb25zdW1lUmVxdWVzdF8gPSB2YWx1\nZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRDb25zdW1lUmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdC5CdWlsZGVy\nIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAgIHJlc3VsdC5oYXNDb25zdW1l\nUmVxdWVzdCA9IHRydWU7CiAgICAgICAgcmVzdWx0LmNvbnN1bWVSZXF1ZXN0\nXyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlQ29uc3Vt\nZVJlcXVlc3Qob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuQ29uc3VtZVJlcXVlc3QgdmFsdWUpIHsKICAgICAgICBpZiAocmVz\ndWx0Lmhhc0NvbnN1bWVSZXF1ZXN0KCkgJiYKICAgICAgICAgICAgcmVzdWx0\nLmNvbnN1bWVSZXF1ZXN0XyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdC5nZXREZWZhdWx0SW5z\ndGFuY2UoKSkgewogICAgICAgICAgcmVzdWx0LmNvbnN1bWVSZXF1ZXN0XyA9\nCiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0Lm5ld0J1aWxkZXIocmVzdWx0LmNv\nbnN1bWVSZXF1ZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0LmNvbnN1bWVS\nZXF1ZXN0XyA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXN1bHQuaGFz\nQ29uc3VtZVJlcXVlc3QgPSB0cnVlOwogICAgICAgIHJldHVybiB0aGlzOwog\nICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyQ29uc3VtZVJlcXVl\nc3QoKSB7CiAgICAgICAgcmVzdWx0Lmhhc0NvbnN1bWVSZXF1ZXN0ID0gZmFs\nc2U7CiAgICAgICAgcmVzdWx0LmNvbnN1bWVSZXF1ZXN0XyA9IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1\nZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlVu\nc3Vic2NyaWJlUmVxdWVzdCB1bnN1YnNjcmliZVJlcXVlc3QgPSA1NTsKICAg\nICAgcHVibGljIGJvb2xlYW4gaGFzVW5zdWJzY3JpYmVSZXF1ZXN0KCkgewog\nICAgICAgIHJldHVybiByZXN1bHQuaGFzVW5zdWJzY3JpYmVSZXF1ZXN0KCk7\nCiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBnZXRVbnN1\nYnNjcmliZVJlcXVlc3QoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRV\nbnN1YnNjcmliZVJlcXVlc3QoKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVp\nbGRlciBzZXRVbnN1YnNjcmliZVJlcXVlc3Qob3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IHZh\nbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAg\nIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgIH0K\nICAgICAgICByZXN1bHQuaGFzVW5zdWJzY3JpYmVSZXF1ZXN0ID0gdHJ1ZTsK\nICAgICAgICByZXN1bHQudW5zdWJzY3JpYmVSZXF1ZXN0XyA9IHZhbHVlOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIHNldFVuc3Vic2NyaWJlUmVxdWVzdChvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QuQnVp\nbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICByZXN1bHQuaGFzVW5z\ndWJzY3JpYmVSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICByZXN1bHQudW5zdWJz\nY3JpYmVSZXF1ZXN0XyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIG1lcmdlVW5zdWJzY3JpYmVSZXF1ZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCB2YWx1\nZSkgewogICAgICAgIGlmIChyZXN1bHQuaGFzVW5zdWJzY3JpYmVSZXF1ZXN0\nKCkgJiYKICAgICAgICAgICAgcmVzdWx0LnVuc3Vic2NyaWJlUmVxdWVzdF8g\nIT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nVW5zdWJzY3JpYmVSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSB7CiAg\nICAgICAgICByZXN1bHQudW5zdWJzY3JpYmVSZXF1ZXN0XyA9CiAgICAgICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlVuc3Vic2NyaWJlUmVxdWVzdC5uZXdCdWlsZGVyKHJlc3VsdC51bnN1YnNj\ncmliZVJlcXVlc3RfKS5tZXJnZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXN1bHQudW5zdWJzY3Jp\nYmVSZXF1ZXN0XyA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXN1bHQu\naGFzVW5zdWJzY3JpYmVSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclVuc3Vi\nc2NyaWJlUmVxdWVzdCgpIHsKICAgICAgICByZXN1bHQuaGFzVW5zdWJzY3Jp\nYmVSZXF1ZXN0ID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LnVuc3Vic2NyaWJl\nUmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNl\nKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAg\nIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3RvcERlbGl2ZXJ5UmVxdWVzdCBzdG9w\nRGVsaXZlcnlSZXF1ZXN0ID0gNTY7CiAgICAgIHB1YmxpYyBib29sZWFuIGhh\nc1N0b3BEZWxpdmVyeVJlcXVlc3QoKSB7CiAgICAgICAgcmV0dXJuIHJlc3Vs\ndC5oYXNTdG9wRGVsaXZlcnlSZXF1ZXN0KCk7CiAgICAgIH0KICAgICAgcHVi\nbGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0b3BEZWxpdmVyeVJlcXVlc3QgZ2V0U3RvcERlbGl2ZXJ5UmVxdWVzdCgp\nIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmdldFN0b3BEZWxpdmVyeVJlcXVl\nc3QoKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdG9wRGVs\naXZlcnlSZXF1ZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QgdmFsdWUpIHsKICAgICAg\nICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IE51\nbGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAgICAgIHJlc3Vs\ndC5oYXNTdG9wRGVsaXZlcnlSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICByZXN1\nbHQuc3RvcERlbGl2ZXJ5UmVxdWVzdF8gPSB2YWx1ZTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdG9w\nRGVsaXZlcnlSZXF1ZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QuQnVpbGRlciBidWls\nZGVyRm9yVmFsdWUpIHsKICAgICAgICByZXN1bHQuaGFzU3RvcERlbGl2ZXJ5\nUmVxdWVzdCA9IHRydWU7CiAgICAgICAgcmVzdWx0LnN0b3BEZWxpdmVyeVJl\ncXVlc3RfID0gYnVpbGRlckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VT\ndG9wRGVsaXZlcnlSZXF1ZXN0KG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QgdmFsdWUpIHsK\nICAgICAgICBpZiAocmVzdWx0Lmhhc1N0b3BEZWxpdmVyeVJlcXVlc3QoKSAm\nJgogICAgICAgICAgICByZXN1bHQuc3RvcERlbGl2ZXJ5UmVxdWVzdF8gIT0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Rv\ncERlbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAg\nICAgICAgcmVzdWx0LnN0b3BEZWxpdmVyeVJlcXVlc3RfID0KICAgICAgICAg\nICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RvcERlbGl2ZXJ5UmVxdWVzdC5uZXdCdWlsZGVyKHJlc3VsdC5zdG9wRGVs\naXZlcnlSZXF1ZXN0XykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwo\nKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0LnN0b3BEZWxp\ndmVyeVJlcXVlc3RfID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJlc3Vs\ndC5oYXNTdG9wRGVsaXZlcnlSZXF1ZXN0ID0gdHJ1ZTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN0\nb3BEZWxpdmVyeVJlcXVlc3QoKSB7CiAgICAgICAgcmVzdWx0Lmhhc1N0b3BE\nZWxpdmVyeVJlcXVlc3QgPSBmYWxzZTsKICAgICAgICByZXN1bHQuc3RvcERl\nbGl2ZXJ5UmVxdWVzdF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJ\nbnN0YW5jZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIAogICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN0YXJ0RGVsaXZlcnlSZXF1\nZXN0IHN0YXJ0RGVsaXZlcnlSZXF1ZXN0ID0gNTc7CiAgICAgIHB1YmxpYyBi\nb29sZWFuIGhhc1N0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkgewogICAgICAgIHJl\ndHVybiByZXN1bHQuaGFzU3RhcnREZWxpdmVyeVJlcXVlc3QoKTsKICAgICAg\nfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgZ2V0U3RhcnREZWxp\ndmVyeVJlcXVlc3QoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTdGFy\ndERlbGl2ZXJ5UmVxdWVzdCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIHNldFN0YXJ0RGVsaXZlcnlSZXF1ZXN0KG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAg\nICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAg\nIH0KICAgICAgICByZXN1bHQuaGFzU3RhcnREZWxpdmVyeVJlcXVlc3QgPSB0\ncnVlOwogICAgICAgIHJlc3VsdC5zdGFydERlbGl2ZXJ5UmVxdWVzdF8gPSB2\nYWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBzZXRTdGFydERlbGl2ZXJ5UmVxdWVzdChvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5\nUmVxdWVzdC5CdWlsZGVyIGJ1aWxkZXJGb3JWYWx1ZSkgewogICAgICAgIHJl\nc3VsdC5oYXNTdGFydERlbGl2ZXJ5UmVxdWVzdCA9IHRydWU7CiAgICAgICAg\ncmVzdWx0LnN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyA9IGJ1aWxkZXJGb3JWYWx1\nZS5idWlsZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAg\nIHB1YmxpYyBCdWlsZGVyIG1lcmdlU3RhcnREZWxpdmVyeVJlcXVlc3Qob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnRE\nZWxpdmVyeVJlcXVlc3QgdmFsdWUpIHsKICAgICAgICBpZiAocmVzdWx0Lmhh\nc1N0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkgJiYKICAgICAgICAgICAgcmVzdWx0\nLnN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5n\nZXREZWZhdWx0SW5zdGFuY2UoKSkgewogICAgICAgICAgcmVzdWx0LnN0YXJ0\nRGVsaXZlcnlSZXF1ZXN0XyA9CiAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1\nZXN0Lm5ld0J1aWxkZXIocmVzdWx0LnN0YXJ0RGVsaXZlcnlSZXF1ZXN0Xyku\nbWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgcmVzdWx0LnN0YXJ0RGVsaXZlcnlSZXF1ZXN0XyA9\nIHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXN1bHQuaGFzU3RhcnREZWxp\ndmVyeVJlcXVlc3QgPSB0cnVlOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyU3RhcnREZWxpdmVyeVJl\ncXVlc3QoKSB7CiAgICAgICAgcmVzdWx0Lmhhc1N0YXJ0RGVsaXZlcnlSZXF1\nZXN0ID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LnN0YXJ0RGVsaXZlcnlSZXF1\nZXN0XyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAv\nLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3\naWcuUHViU3ViUmVxdWVzdCkKICAgIH0KICAgIAogICAgc3RhdGljIHsKICAg\nICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFB1YlN1YlJlcXVlc3QodHJ1ZSk7\nCiAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLmludGVybmFsRm9yY2VJbml0KCk7CiAgICAgIGRlZmF1bHRJbnN0YW5j\nZS5pbml0RmllbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2lu\nc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuUHViU3ViUmVxdWVz\ndCkKICB9CiAgCiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBQdWJsaXNo\nUmVxdWVzdCBleHRlbmRzCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZSB7CiAgICAvLyBVc2UgUHVibGlzaFJlcXVlc3QubmV3\nQnVpbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgUHVibGlzaFJl\ncXVlc3QoKSB7CiAgICAgIGluaXRGaWVsZHMoKTsKICAgIH0KICAgIHByaXZh\ndGUgUHVibGlzaFJlcXVlc3QoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAg\nIHByaXZhdGUgc3RhdGljIGZpbmFsIFB1Ymxpc2hSZXF1ZXN0IGRlZmF1bHRJ\nbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgUHVibGlzaFJlcXVlc3QgZ2V0\nRGVmYXVsdEluc3RhbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3Rh\nbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgUHVibGlzaFJlcXVlc3QgZ2V0\nRGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1\nbHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IK\nICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxf\nc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVzdF9kZXNjcmlwdG9yOwogICAg\nfQogICAgCiAgICBwcm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVy\nbmFsR2V0RmllbGRBY2Nlc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVzdF9maWVsZEFjY2Vzc29y\nVGFibGU7CiAgICB9CiAgICAKICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcuTWVz\nc2FnZSBtc2cgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgTVNH\nX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRlIGJvb2xlYW4gaGFzTXNn\nOwogICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlIG1zZ187CiAgICBwdWJsaWMgYm9vbGVhbiBo\nYXNNc2coKSB7IHJldHVybiBoYXNNc2c7IH0KICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIGdl\ndE1zZygpIHsgcmV0dXJuIG1zZ187IH0KICAgIAogICAgcHJpdmF0ZSB2b2lk\nIGluaXRGaWVsZHMoKSB7CiAgICAgIG1zZ18gPSBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERlZmF1bHRJ\nbnN0YW5jZSgpOwogICAgfQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJ\nbml0aWFsaXplZCgpIHsKICAgICAgaWYgKCFoYXNNc2cpIHJldHVybiBmYWxz\nZTsKICAgICAgaWYgKCFnZXRNc2coKS5pc0luaXRpYWxpemVkKCkpIHJldHVy\nbiBmYWxzZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXpl\nZFNpemUoKTsKICAgICAgaWYgKGhhc01zZygpKSB7CiAgICAgICAgb3V0cHV0\nLndyaXRlTWVzc2FnZSgyLCBnZXRNc2coKSk7CiAgICAgIH0KICAgICAgZ2V0\nVW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAog\nICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwog\nICAgcHVibGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50\nIHNpemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6\nZSAhPSAtMSkgcmV0dXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAg\nICAgIGlmIChoYXNNc2coKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1\ndGVNZXNzYWdlU2l6ZSgyLCBnZXRNc2coKSk7CiAgICAgIH0KICAgICAgc2l6\nZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsK\nICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgIHJl\ndHVybiBzaXplOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkJ5dGVTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5w\ncm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCBw\nYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVy\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5i\ndWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVx\ndWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0\nYSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRl\nIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgcGFyc2VGcm9t\nKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGph\ndmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCBwYXJzZURlbGlt\naXRlZEZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0\naHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVp\nbGRlciA9IG5ld0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VE\nZWxpbWl0ZWRGcm9tKGlucHV0KSkgewogICAgICAgIHJldHVybiBidWlsZGVy\nLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJl\ncXVlc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgIGphdmEuaW8uSW5w\ndXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVy\nIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1l\ncmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7\nCiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAg\nfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCBwYXJzZUZyb20oCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0\nKQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IHBh\ncnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5w\ndXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAg\nCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcigpIHsgcmV0\ndXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1YmxpYyBCdWlsZGVyIG5l\nd0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3QnVpbGRlcigpOyB9CiAg\nICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVpbGRlcihvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVz\ndCBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1YmxpYyBCdWlsZGVyIHRv\nQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7IH0KICAgIAog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2Uu\nQnVpbGRlcjxCdWlsZGVyPiB7CiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3Qg\ncmVzdWx0OwogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hS\nZXF1ZXN0Lm5ld0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxkZXIoKSB7\nfQogICAgICAKICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBjcmVhdGUo\nKSB7CiAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxkZXIoKTsK\nICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCgpOwog\nICAgICAgIHJldHVybiBidWlsZGVyOwogICAgICB9CiAgICAgIAogICAgICBw\ncm90ZWN0ZWQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuUHVibGlzaFJlcXVlc3QgaW50ZXJuYWxHZXRSZXN1bHQoKSB7CiAg\nICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBu\ndWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uKAogICAgICAgICAgICAiQ2Fubm90IGNhbGwgY2xlYXIoKSBhZnRlciBi\ndWlsZCgpLiIpOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSBuZXcgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlcXVlc3QoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0\ndXJuIGNyZWF0ZSgpLm1lcmdlRnJvbShyZXN1bHQpOwogICAgICB9CiAgICAg\nIAogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgp\nIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QuZ2V0RGVzY3JpcHRvcigp\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgZ2V0\nRGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlz\naFJlcXVlc3QuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAg\nICAgcmV0dXJuIHJlc3VsdC5pc0luaXRpYWxpemVkKCk7CiAgICAgIH0KICAg\nICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlB1Ymxpc2hSZXF1ZXN0IGJ1aWxkKCkgewogICAgICAgIGlmIChy\nZXN1bHQgIT0gbnVsbCAmJiAhaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAg\nICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1\nbHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgYnVp\nbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBp\nZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5p\nbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJlc3Vs\ndCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAg\nICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHVibGlzaFJlcXVlc3QgYnVpbGRQYXJ0aWFsKCkg\newogICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgewogICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgImJ1\naWxkKCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQgb24gdGhpcyBCdWlsZGVy\nLiIpOwogICAgICAgIH0KICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdCByZXR1cm5NZSA9\nIHJlc3VsdDsKICAgICAgICByZXN1bHQgPSBudWxsOwogICAgICAgIHJldHVy\nbiByZXR1cm5NZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhl\ncikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1Ymxpc2hSZXF1ZXN0\nKSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdClv\ndGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN1cGVyLm1lcmdl\nRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICB9\nCiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJv\nbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Q\ndWJsaXNoUmVxdWVzdCBvdGhlcikgewogICAgICAgIGlmIChvdGhlciA9PSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJs\naXNoUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7\nCiAgICAgICAgaWYgKG90aGVyLmhhc01zZygpKSB7CiAgICAgICAgICBtZXJn\nZU1zZyhvdGhlci5nZXRNc2coKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMu\nbWVyZ2VVbmtub3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7\nCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBCdWlsZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZp\nZWxkU2V0LkJ1aWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAog\nICAgICAgICAgICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAg\nd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFk\nVGFnKCk7CiAgICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBj\nYXNlIDA6CiAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVu\na25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAo\nIXBhcnNlVW5rbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVn\naXN0cnksIHRhZykpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93\nbkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMTg6IHsK\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlLkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2Uu\nbmV3QnVpbGRlcigpOwogICAgICAgICAgICAgIGlmIChoYXNNc2coKSkgewog\nICAgICAgICAgICAgICAgc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0TXNnKCkp\nOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVz\nc2FnZShzdWJCdWlsZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAg\nICAgICAgc2V0TXNnKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICB9CiAgICAgIAogICAgICAKICAgICAgLy8gcmVxdWly\nZWQgLkhlZHdpZy5NZXNzYWdlIG1zZyA9IDI7CiAgICAgIHB1YmxpYyBib29s\nZWFuIGhhc01zZygpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc01zZygp\nOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIGdldE1zZygpIHsKICAgICAg\nICByZXR1cm4gcmVzdWx0LmdldE1zZygpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIHNldE1zZyhvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlIHZhbHVlKSB7CiAgICAgICAgaWYgKHZh\nbHVlID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBOdWxsUG9pbnRl\nckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXN1bHQuaGFzTXNn\nID0gdHJ1ZTsKICAgICAgICByZXN1bHQubXNnXyA9IHZhbHVlOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndE1zZyhvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlLkJ1aWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAg\ncmVzdWx0Lmhhc01zZyA9IHRydWU7CiAgICAgICAgcmVzdWx0Lm1zZ18gPSBi\ndWlsZGVyRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZU1zZyhvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIHZh\nbHVlKSB7CiAgICAgICAgaWYgKHJlc3VsdC5oYXNNc2coKSAmJgogICAgICAg\nICAgICByZXN1bHQubXNnXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERlZmF1bHRJbnN0YW5jZSgp\nKSB7CiAgICAgICAgICByZXN1bHQubXNnXyA9CiAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2Uu\nbmV3QnVpbGRlcihyZXN1bHQubXNnXykubWVyZ2VGcm9tKHZhbHVlKS5idWls\nZFBhcnRpYWwoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0\nLm1zZ18gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0Lmhhc01z\nZyA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgY2xlYXJNc2coKSB7CiAgICAgICAgcmVzdWx0Lmhh\nc01zZyA9IGZhbHNlOwogICAgICAgIHJlc3VsdC5tc2dfID0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZS5nZXRE\nZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICAKICAgICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGJ1\naWxkZXJfc2NvcGU6SGVkd2lnLlB1Ymxpc2hSZXF1ZXN0KQogICAgfQogICAg\nCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgUHVi\nbGlzaFJlcXVlc3QodHJ1ZSk7CiAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9yY2VJbml0KCk7CiAg\nICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAgICB9CiAgICAK\nICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpI\nZWR3aWcuUHVibGlzaFJlcXVlc3QpCiAgfQogIAogIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY2xhc3MgU3Vic2NyaWJlUmVxdWVzdCBleHRlbmRzCiAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAvLyBV\nc2UgU3Vic2NyaWJlUmVxdWVzdC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0\nLgogICAgcHJpdmF0ZSBTdWJzY3JpYmVSZXF1ZXN0KCkgewogICAgICBpbml0\nRmllbGRzKCk7CiAgICB9CiAgICBwcml2YXRlIFN1YnNjcmliZVJlcXVlc3Qo\nYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZp\nbmFsIFN1YnNjcmliZVJlcXVlc3QgZGVmYXVsdEluc3RhbmNlOwogICAgcHVi\nbGljIHN0YXRpYyBTdWJzY3JpYmVSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5j\nZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAg\nIAogICAgcHVibGljIFN1YnNjcmliZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3Rh\nbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXRE\nZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19TdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICB9CiAgICAKICAg\nIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVs\nZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX1N1YnNjcmliZVJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOwog\nICAgfQogICAgCiAgICBwdWJsaWMgZW51bSBDcmVhdGVPckF0dGFjaAogICAg\nICAgIGltcGxlbWVudHMgY29tLmdvb2dsZS5wcm90b2J1Zi5Qcm90b2NvbE1l\nc3NhZ2VFbnVtIHsKICAgICAgQ1JFQVRFKDAsIDApLAogICAgICBBVFRBQ0go\nMSwgMSksCiAgICAgIENSRUFURV9PUl9BVFRBQ0goMiwgMiksCiAgICAgIDsK\nICAgICAgCiAgICAgIAogICAgICBwdWJsaWMgZmluYWwgaW50IGdldE51bWJl\ncigpIHsgcmV0dXJuIHZhbHVlOyB9CiAgICAgIAogICAgICBwdWJsaWMgc3Rh\ndGljIENyZWF0ZU9yQXR0YWNoIHZhbHVlT2YoaW50IHZhbHVlKSB7CiAgICAg\nICAgc3dpdGNoICh2YWx1ZSkgewogICAgICAgICAgY2FzZSAwOiByZXR1cm4g\nQ1JFQVRFOwogICAgICAgICAgY2FzZSAxOiByZXR1cm4gQVRUQUNIOwogICAg\nICAgICAgY2FzZSAyOiByZXR1cm4gQ1JFQVRFX09SX0FUVEFDSDsKICAgICAg\nICAgIGRlZmF1bHQ6IHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludGVybmFsLkVudW1MaXRlTWFwPENyZWF0ZU9yQXR0YWNoPgogICAgICAg\nICAgaW50ZXJuYWxHZXRWYWx1ZU1hcCgpIHsKICAgICAgICByZXR1cm4gaW50\nZXJuYWxWYWx1ZU1hcDsKICAgICAgfQogICAgICBwcml2YXRlIHN0YXRpYyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1MaXRlTWFwPENyZWF0\nZU9yQXR0YWNoPgogICAgICAgICAgaW50ZXJuYWxWYWx1ZU1hcCA9CiAgICAg\nICAgICAgIG5ldyBjb20uZ29vZ2xlLnByb3RvYnVmLkludGVybmFsLkVudW1M\naXRlTWFwPENyZWF0ZU9yQXR0YWNoPigpIHsKICAgICAgICAgICAgICBwdWJs\naWMgQ3JlYXRlT3JBdHRhY2ggZmluZFZhbHVlQnlOdW1iZXIoaW50IG51bWJl\ncikgewogICAgICAgICAgICAgICAgcmV0dXJuIENyZWF0ZU9yQXR0YWNoLnZh\nbHVlT2YobnVtYmVyKQogICAgICA7ICAgICAgICB9CiAgICAgICAgICAgIH07\nCiAgICAgIAogICAgICBwdWJsaWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5FbnVtVmFsdWVEZXNjcmlwdG9yCiAgICAgICAgICBn\nZXRWYWx1ZURlc2NyaXB0b3IoKSB7CiAgICAgICAgcmV0dXJuIGdldERlc2Ny\naXB0b3IoKS5nZXRWYWx1ZXMoKS5nZXQoaW5kZXgpOwogICAgICB9CiAgICAg\nIHB1YmxpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3Jz\nLkVudW1EZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlw\nZSgpIHsKICAgICAgICByZXR1cm4gZ2V0RGVzY3JpcHRvcigpOwogICAgICB9\nCiAgICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1\nZi5EZXNjcmlwdG9ycy5FbnVtRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXRE\nZXNjcmlwdG9yKCkuZ2V0RW51bVR5cGVzKCkuZ2V0KDApOwogICAgICB9CiAg\nICAgIAogICAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBDcmVhdGVPckF0dGFj\naFtdIFZBTFVFUyA9IHsKICAgICAgICBDUkVBVEUsIEFUVEFDSCwgQ1JFQVRF\nX09SX0FUVEFDSCwgCiAgICAgIH07CiAgICAgIHB1YmxpYyBzdGF0aWMgQ3Jl\nYXRlT3JBdHRhY2ggdmFsdWVPZigKICAgICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuRGVzY3JpcHRvcnMuRW51bVZhbHVlRGVzY3JpcHRvciBkZXNjKSB7\nCiAgICAgICAgaWYgKGRlc2MuZ2V0VHlwZSgpICE9IGdldERlc2NyaXB0b3Io\nKSkgewogICAgICAgICAgdGhyb3cgbmV3IGphdmEubGFuZy5JbGxlZ2FsQXJn\ndW1lbnRFeGNlcHRpb24oCiAgICAgICAgICAgICJFbnVtVmFsdWVEZXNjcmlw\ndG9yIGlzIG5vdCBmb3IgdGhpcyB0eXBlLiIpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gVkFMVUVTW2Rlc2MuZ2V0SW5kZXgoKV07CiAgICAgIH0KICAg\nICAgcHJpdmF0ZSBmaW5hbCBpbnQgaW5kZXg7CiAgICAgIHByaXZhdGUgZmlu\nYWwgaW50IHZhbHVlOwogICAgICBwcml2YXRlIENyZWF0ZU9yQXR0YWNoKGlu\ndCBpbmRleCwgaW50IHZhbHVlKSB7CiAgICAgICAgdGhpcy5pbmRleCA9IGlu\nZGV4OwogICAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgfQogICAg\nICAKICAgICAgc3RhdGljIHsKICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5nZXREZXNjcmlwdG9yKCk7CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChl\nbnVtX3Njb3BlOkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0\nYWNoKQogICAgfQogICAgCiAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJzY3Jp\nYmVySWQgPSAyOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1VCU0NS\nSUJFUklEX0ZJRUxEX05VTUJFUiA9IDI7CiAgICBwcml2YXRlIGJvb2xlYW4g\naGFzU3Vic2NyaWJlcklkOwogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkXyA9IGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAgIHB1YmxpYyBib29sZWFuIGhh\nc1N1YnNjcmliZXJJZCgpIHsgcmV0dXJuIGhhc1N1YnNjcmliZXJJZDsgfQog\nICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRT\ndWJzY3JpYmVySWQoKSB7IHJldHVybiBzdWJzY3JpYmVySWRfOyB9CiAgICAK\nICAgIC8vIG9wdGlvbmFsIC5IZWR3aWcuU3Vic2NyaWJlUmVxdWVzdC5DcmVh\ndGVPckF0dGFjaCBjcmVhdGVPckF0dGFjaCA9IDMgW2RlZmF1bHQgPSBDUkVB\nVEVfT1JfQVRUQUNIXTsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IENS\nRUFURU9SQVRUQUNIX0ZJRUxEX05VTUJFUiA9IDM7CiAgICBwcml2YXRlIGJv\nb2xlYW4gaGFzQ3JlYXRlT3JBdHRhY2g7CiAgICBwcml2YXRlIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJl\ncXVlc3QuQ3JlYXRlT3JBdHRhY2ggY3JlYXRlT3JBdHRhY2hfOwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzQ3JlYXRlT3JBdHRhY2goKSB7IHJldHVybiBoYXND\ncmVhdGVPckF0dGFjaDsgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3Jl\nYXRlT3JBdHRhY2ggZ2V0Q3JlYXRlT3JBdHRhY2goKSB7IHJldHVybiBjcmVh\ndGVPckF0dGFjaF87IH0KICAgIAogICAgLy8gb3B0aW9uYWwgYm9vbCBzeW5j\naHJvbm91cyA9IDQgW2RlZmF1bHQgPSBmYWxzZV07CiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGludCBTWU5DSFJPTk9VU19GSUVMRF9OVU1CRVIgPSA0Owog\nICAgcHJpdmF0ZSBib29sZWFuIGhhc1N5bmNocm9ub3VzOwogICAgcHJpdmF0\nZSBib29sZWFuIHN5bmNocm9ub3VzXyA9IGZhbHNlOwogICAgcHVibGljIGJv\nb2xlYW4gaGFzU3luY2hyb25vdXMoKSB7IHJldHVybiBoYXNTeW5jaHJvbm91\nczsgfQogICAgcHVibGljIGJvb2xlYW4gZ2V0U3luY2hyb25vdXMoKSB7IHJl\ndHVybiBzeW5jaHJvbm91c187IH0KICAgIAogICAgLy8gb3B0aW9uYWwgdWlu\ndDMyIG1lc3NhZ2VCb3VuZCA9IDU7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFs\nIGludCBNRVNTQUdFQk9VTkRfRklFTERfTlVNQkVSID0gNTsKICAgIHByaXZh\ndGUgYm9vbGVhbiBoYXNNZXNzYWdlQm91bmQ7CiAgICBwcml2YXRlIGludCBt\nZXNzYWdlQm91bmRfID0gMDsKICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3Nh\nZ2VCb3VuZCgpIHsgcmV0dXJuIGhhc01lc3NhZ2VCb3VuZDsgfQogICAgcHVi\nbGljIGludCBnZXRNZXNzYWdlQm91bmQoKSB7IHJldHVybiBtZXNzYWdlQm91\nbmRfOyB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewog\nICAgICBjcmVhdGVPckF0dGFjaF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9y\nQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0g7CiAgICB9CiAgICBwdWJsaWMgZmlu\nYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBpZiAoIWhhc1N1\nYnNjcmliZXJJZCkgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gdHJ1ZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xl\nLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAg\nICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoaGFzU3Vic2Ny\naWJlcklkKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBnZXRT\ndWJzY3JpYmVySWQoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc0NyZWF0ZU9y\nQXR0YWNoKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVFbnVtKDMsIGdldENy\nZWF0ZU9yQXR0YWNoKCkuZ2V0TnVtYmVyKCkpOwogICAgICB9CiAgICAgIGlm\nIChoYXNTeW5jaHJvbm91cygpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlQm9v\nbCg0LCBnZXRTeW5jaHJvbm91cygpKTsKICAgICAgfQogICAgICBpZiAoaGFz\nTWVzc2FnZUJvdW5kKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVVSW50MzIo\nNSwgZ2V0TWVzc2FnZUJvdW5kKCkpOwogICAgICB9CiAgICAgIGdldFVua25v\nd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHBy\naXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1\nYmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXpl\nID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0g\nLTEpIHJldHVybiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBp\nZiAoaGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICBzaXplICs9IGNvbS5n\nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5j\nb21wdXRlQnl0ZXNTaXplKDIsIGdldFN1YnNjcmliZXJJZCgpKTsKICAgICAg\nfQogICAgICBpZiAoaGFzQ3JlYXRlT3JBdHRhY2goKSkgewogICAgICAgIHNp\nemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQog\nICAgICAgICAgLmNvbXB1dGVFbnVtU2l6ZSgzLCBnZXRDcmVhdGVPckF0dGFj\naCgpLmdldE51bWJlcigpKTsKICAgICAgfQogICAgICBpZiAoaGFzU3luY2hy\nb25vdXMoKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVCb29sU2l6\nZSg0LCBnZXRTeW5jaHJvbm91cygpKTsKICAgICAgfQogICAgICBpZiAoaGFz\nTWVzc2FnZUJvdW5kKCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRl\nVUludDMyU2l6ZSg1LCBnZXRNZXNzYWdlQm91bmQoKSk7CiAgICAgIH0KICAg\nICAgc2l6ZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNp\nemUoKTsKICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAg\nICAgIHJldHVybiBzaXplOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1\nYnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEp\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmli\nZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAg\nICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgYnl0\nZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVy\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5i\ndWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVS\nZXF1ZXN0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQog\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2Vk\nKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFy\nc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAg\nIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\nYmVSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAg\nICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBl\nbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJv\nbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0LAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4\ndGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigp\nOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQs\nIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAgICAgIHJldHVybiBidWlsZGVy\nLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJu\nIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZElucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJs\naWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAg\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUo\nKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7\nIHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVp\nbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcHJvdG90eXBlKSB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7\nCiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVy\nbiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4g\newogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcmVzdWx0OwogICAgICAK\nICAgICAgLy8gQ29uc3RydWN0IHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QubmV3QnVp\nbGRlcigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CiAgICAgIAogICAg\nICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBC\ndWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcigpOwogICAgICAgIGJ1aWxk\nZXIucmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QoKTsKICAgICAgICByZXR1\ncm4gYnVpbGRlcjsKICAgICAgfQogICAgICAKICAgICAgcHJvdGVjdGVkIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmliZVJlcXVlc3QgaW50ZXJuYWxHZXRSZXN1bHQoKSB7CiAgICAgICAgcmV0\ndXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgY2xlYXIoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAg\nICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAg\nICAgICAgICAiQ2Fubm90IGNhbGwgY2xlYXIoKSBhZnRlciBidWlsZCgpLiIp\nOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3Jl\nYXRlKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2Ny\naXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAg\nICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgZ2V0RGVm\nYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAg\nICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgfQogICAg\nICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBidWlsZCgpIHsKICAgICAgICBpZiAo\ncmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAg\nICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVz\ndWx0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgp\nOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Qg\nYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJv\ndG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhyb3cgbmV3\nVW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAgICAgICAgICAgIHJl\nc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24oKTsKICAg\nICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAgICB9\nCiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdCBidWlsZFBhcnRp\nYWwoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAg\nICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1\naWxkZXIuIik7CiAgICAgICAgfQogICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QgcmV0\ndXJuTWUgPSByZXN1bHQ7CiAgICAgICAgcmVzdWx0ID0gbnVsbDsKICAgICAg\nICByZXR1cm4gcmV0dXJuTWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3Nh\nZ2Ugb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\nYmVSZXF1ZXN0KSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VGcm9tKChvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\nYmVSZXF1ZXN0KW90aGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAg\nc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxk\nZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3Qgb3RoZXIpIHsKICAgICAgICBp\nZiAob3RoZXIgPT0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2Uo\nKSkgcmV0dXJuIHRoaXM7CiAgICAgICAgaWYgKG90aGVyLmhhc1N1YnNjcmli\nZXJJZCgpKSB7CiAgICAgICAgICBzZXRTdWJzY3JpYmVySWQob3RoZXIuZ2V0\nU3Vic2NyaWJlcklkKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIu\naGFzQ3JlYXRlT3JBdHRhY2goKSkgewogICAgICAgICAgc2V0Q3JlYXRlT3JB\ndHRhY2gob3RoZXIuZ2V0Q3JlYXRlT3JBdHRhY2goKSk7CiAgICAgICAgfQog\nICAgICAgIGlmIChvdGhlci5oYXNTeW5jaHJvbm91cygpKSB7CiAgICAgICAg\nICBzZXRTeW5jaHJvbm91cyhvdGhlci5nZXRTeW5jaHJvbm91cygpKTsKICAg\nICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc01lc3NhZ2VCb3VuZCgpKSB7\nCiAgICAgICAgICBzZXRNZXNzYWdlQm91bmQob3RoZXIuZ2V0TWVzc2FnZUJv\ndW5kKCkpOwogICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZp\nZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBt\nZXJnZUZyb20oCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVy\nIHVua25vd25GaWVsZHMgPQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgdGhp\ncy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHdoaWxlICh0cnVlKSB7\nCiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAg\nICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAg\nICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1\naWxkKCkpOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAg\nICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25G\naWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7\nCiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93\nbkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBjYXNlIDE4OiB7CiAgICAgICAgICAgICAg\nc2V0U3Vic2NyaWJlcklkKGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDI0\nOiB7CiAgICAgICAgICAgICAgaW50IHJhd1ZhbHVlID0gaW5wdXQucmVhZEVu\ndW0oKTsKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0\nYWNoIHZhbHVlID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaC52YWx1\nZU9mKHJhd1ZhbHVlKTsKICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgdW5rbm93bkZpZWxkcy5tZXJnZVZhcmlu\ndEZpZWxkKDMsIHJhd1ZhbHVlKTsKICAgICAgICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICAgICAgc2V0Q3JlYXRlT3JBdHRhY2godmFsdWUpOwogICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBjYXNlIDMyOiB7CiAgICAgICAgICAgICAgc2V0U3lu\nY2hyb25vdXMoaW5wdXQucmVhZEJvb2woKSk7CiAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA0MDogewogICAg\nICAgICAgICAgIHNldE1lc3NhZ2VCb3VuZChpbnB1dC5yZWFkVUludDMyKCkp\nOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAg\nICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIAogICAgICAKICAgICAgLy8g\ncmVxdWlyZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0gMjsKICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkKCkgewogICAgICAgIHJldHVybiBy\nZXN1bHQuaGFzU3Vic2NyaWJlcklkKCk7CiAgICAgIH0KICAgICAgcHVibGlj\nIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTdWJzY3JpYmVy\nSWQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTdWJzY3JpYmVySWQo\nKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdWJzY3JpYmVy\nSWQoY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAg\nICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxs\nUG9pbnRlckV4Y2VwdGlvbigpOwogIH0KICByZXN1bHQuaGFzU3Vic2NyaWJl\ncklkID0gdHJ1ZTsKICAgICAgICByZXN1bHQuc3Vic2NyaWJlcklkXyA9IHZh\nbHVlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIGNsZWFyU3Vic2NyaWJlcklkKCkgewogICAgICAgIHJlc3Vs\ndC5oYXNTdWJzY3JpYmVySWQgPSBmYWxzZTsKICAgICAgICByZXN1bHQuc3Vi\nc2NyaWJlcklkXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFN1YnNjcmli\nZXJJZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICAvLyBvcHRpb25hbCAuSGVkd2lnLlN1YnNjcmliZVJlcXVlc3QuQ3Jl\nYXRlT3JBdHRhY2ggY3JlYXRlT3JBdHRhY2ggPSAzIFtkZWZhdWx0ID0gQ1JF\nQVRFX09SX0FUVEFDSF07CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc0NyZWF0\nZU9yQXR0YWNoKCkgewogICAgICAgIHJldHVybiByZXN1bHQuaGFzQ3JlYXRl\nT3JBdHRhY2goKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndC5DcmVhdGVPckF0dGFjaCBnZXRDcmVhdGVPckF0dGFjaCgpIHsKICAgICAg\nICByZXR1cm4gcmVzdWx0LmdldENyZWF0ZU9yQXR0YWNoKCk7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgc2V0Q3JlYXRlT3JBdHRhY2gob3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJl\nUmVxdWVzdC5DcmVhdGVPckF0dGFjaCB2YWx1ZSkgewogICAgICAgIGlmICh2\nYWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50\nZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0Lmhhc0Ny\nZWF0ZU9yQXR0YWNoID0gdHJ1ZTsKICAgICAgICByZXN1bHQuY3JlYXRlT3JB\ndHRhY2hfID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJDcmVhdGVPckF0dGFjaCgpIHsK\nICAgICAgICByZXN1bHQuaGFzQ3JlYXRlT3JBdHRhY2ggPSBmYWxzZTsKICAg\nICAgICByZXN1bHQuY3JlYXRlT3JBdHRhY2hfID0gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5D\ncmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIOwogICAgICAgIHJldHVy\nbiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAvLyBvcHRpb25hbCBib29s\nIHN5bmNocm9ub3VzID0gNCBbZGVmYXVsdCA9IGZhbHNlXTsKICAgICAgcHVi\nbGljIGJvb2xlYW4gaGFzU3luY2hyb25vdXMoKSB7CiAgICAgICAgcmV0dXJu\nIHJlc3VsdC5oYXNTeW5jaHJvbm91cygpOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBib29sZWFuIGdldFN5bmNocm9ub3VzKCkgewogICAgICAgIHJldHVybiBy\nZXN1bHQuZ2V0U3luY2hyb25vdXMoKTsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBzZXRTeW5jaHJvbm91cyhib29sZWFuIHZhbHVlKSB7CiAgICAg\nICAgcmVzdWx0Lmhhc1N5bmNocm9ub3VzID0gdHJ1ZTsKICAgICAgICByZXN1\nbHQuc3luY2hyb25vdXNfID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTeW5jaHJvbm91\ncygpIHsKICAgICAgICByZXN1bHQuaGFzU3luY2hyb25vdXMgPSBmYWxzZTsK\nICAgICAgICByZXN1bHQuc3luY2hyb25vdXNfID0gZmFsc2U7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFs\nIHVpbnQzMiBtZXNzYWdlQm91bmQgPSA1OwogICAgICBwdWJsaWMgYm9vbGVh\nbiBoYXNNZXNzYWdlQm91bmQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5o\nYXNNZXNzYWdlQm91bmQoKTsKICAgICAgfQogICAgICBwdWJsaWMgaW50IGdl\ndE1lc3NhZ2VCb3VuZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmdldE1l\nc3NhZ2VCb3VuZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndE1lc3NhZ2VCb3VuZChpbnQgdmFsdWUpIHsKICAgICAgICByZXN1bHQuaGFz\nTWVzc2FnZUJvdW5kID0gdHJ1ZTsKICAgICAgICByZXN1bHQubWVzc2FnZUJv\ndW5kXyA9IHZhbHVlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWVzc2FnZUJvdW5kKCkgewogICAg\nICAgIHJlc3VsdC5oYXNNZXNzYWdlQm91bmQgPSBmYWxzZTsKICAgICAgICBy\nZXN1bHQubWVzc2FnZUJvdW5kXyA9IDA7CiAgICAgICAgcmV0dXJuIHRoaXM7\nCiAgICAgIH0KICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9w\nb2ludChidWlsZGVyX3Njb3BlOkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0KQog\nICAgfQogICAgCiAgICBzdGF0aWMgewogICAgICBkZWZhdWx0SW5zdGFuY2Ug\nPSBuZXcgU3Vic2NyaWJlUmVxdWVzdCh0cnVlKTsKICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxGb3Jj\nZUluaXQoKTsKICAgICAgZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsK\nICAgIH0KICAgIAogICAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNs\nYXNzX3Njb3BlOkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0KQogIH0KICAKICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFN1YnNjcmlwdGlvbk9wdGlvbnMg\nZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UgewogICAgLy8gVXNlIFN1YnNjcmlwdGlvbk9wdGlvbnMubmV3QnVp\nbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgU3Vic2NyaXB0aW9u\nT3B0aW9ucygpIHsKICAgICAgaW5pdEZpZWxkcygpOwogICAgfQogICAgcHJp\ndmF0ZSBTdWJzY3JpcHRpb25PcHRpb25zKGJvb2xlYW4gbm9Jbml0KSB7fQog\nICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdWJzY3JpcHRpb25PcHRp\nb25zIGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgU3Vic2Ny\naXB0aW9uT3B0aW9ucyBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJl\ndHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBT\ndWJzY3JpcHRpb25PcHRpb25zIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUo\nKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigp\nIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0\naW9uT3B0aW9uc19kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0\nZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3Nv\nclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19T\ndWJzY3JpcHRpb25PcHRpb25zX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0K\nICAgIAogICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0\nLkNyZWF0ZU9yQXR0YWNoIGNyZWF0ZU9yQXR0YWNoID0gMiBbZGVmYXVsdCA9\nIENSRUFURV9PUl9BVFRBQ0hdOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgQ1JFQVRFT1JBVFRBQ0hfRklFTERfTlVNQkVSID0gMjsKICAgIHByaXZh\ndGUgYm9vbGVhbiBoYXNDcmVhdGVPckF0dGFjaDsKICAgIHByaXZhdGUgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2Ny\naWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaCBjcmVhdGVPckF0dGFjaF87CiAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNDcmVhdGVPckF0dGFjaCgpIHsgcmV0dXJu\nIGhhc0NyZWF0ZU9yQXR0YWNoOyB9CiAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVz\ndC5DcmVhdGVPckF0dGFjaCBnZXRDcmVhdGVPckF0dGFjaCgpIHsgcmV0dXJu\nIGNyZWF0ZU9yQXR0YWNoXzsgfQogICAgCiAgICAvLyBvcHRpb25hbCB1aW50\nMzIgbWVzc2FnZUJvdW5kID0gMyBbZGVmYXVsdCA9IDBdOwogICAgcHVibGlj\nIHN0YXRpYyBmaW5hbCBpbnQgTUVTU0FHRUJPVU5EX0ZJRUxEX05VTUJFUiA9\nIDM7CiAgICBwcml2YXRlIGJvb2xlYW4gaGFzTWVzc2FnZUJvdW5kOwogICAg\ncHJpdmF0ZSBpbnQgbWVzc2FnZUJvdW5kXyA9IDA7CiAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNNZXNzYWdlQm91bmQoKSB7IHJldHVybiBoYXNNZXNzYWdlQm91\nbmQ7IH0KICAgIHB1YmxpYyBpbnQgZ2V0TWVzc2FnZUJvdW5kKCkgeyByZXR1\ncm4gbWVzc2FnZUJvdW5kXzsgfQogICAgCiAgICBwcml2YXRlIHZvaWQgaW5p\ndEZpZWxkcygpIHsKICAgICAgY3JlYXRlT3JBdHRhY2hfID0gb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVx\ndWVzdC5DcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIOwogICAgfQog\nICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHdy\naXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBv\ndXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAg\nICAgaWYgKGhhc0NyZWF0ZU9yQXR0YWNoKCkpIHsKICAgICAgICBvdXRwdXQu\nd3JpdGVFbnVtKDIsIGdldENyZWF0ZU9yQXR0YWNoKCkuZ2V0TnVtYmVyKCkp\nOwogICAgICB9CiAgICAgIGlmIChoYXNNZXNzYWdlQm91bmQoKSkgewogICAg\nICAgIG91dHB1dC53cml0ZVVJbnQzMigzLCBnZXRNZXNzYWdlQm91bmQoKSk7\nCiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygpLndyaXRlVG8ob3V0\ncHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQgbWVtb2l6ZWRTZXJp\nYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBnZXRTZXJpYWxpemVk\nU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXplZFNlcmlhbGl6ZWRT\naXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJuIHNpemU7CiAgICAK\nICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmIChoYXNDcmVhdGVPckF0dGFjaCgp\nKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVk\nT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUVudW1TaXplKDIsIGdl\ndENyZWF0ZU9yQXR0YWNoKCkuZ2V0TnVtYmVyKCkpOwogICAgICB9CiAgICAg\nIGlmIChoYXNNZXNzYWdlQm91bmQoKSkgewogICAgICAgIHNpemUgKz0gY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAg\nLmNvbXB1dGVVSW50MzJTaXplKDMsIGdldE1lc3NhZ2VCb3VuZCgpKTsKICAg\nICAgfQogICAgICBzaXplICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJp\nYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0g\nc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBwYXJzZUZyb20oCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEpCiAgICAgICAg\ndGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVm\nZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBwYXJzZUZyb20oCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5z\naW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQog\nICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIHBhcnNlRnJvbShi\neXRlW10gZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1\nZi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1\ncm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIHBh\ncnNlRnJvbSgKICAgICAgICBieXRlW10gZGF0YSwKICAgICAgICBjb20uZ29v\nZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5J\nbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMgcGFyc2VGcm9tKGphdmEu\naW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8u\nSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBwYXJzZUZyb20oCiAgICAgICAgamF2\nYS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMgcGFyc2VE\nZWxpbWl0ZWRGcm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVy\nIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1l\ncmdlRGVsaW1pdGVkRnJvbShpbnB1dCkpIHsKICAgICAgICByZXR1cm4gYnVp\nbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJl\ndHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvbk9wdGlvbnMgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgIGph\ndmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0\ncnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAg\nICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChi\ndWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVn\naXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQo\nKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAg\nfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zIHBh\ncnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5w\ndXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShp\nbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vi\nc2NyaXB0aW9uT3B0aW9ucyBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVu\nc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5w\ndXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBCdWlsZGVy\nIG5ld0J1aWxkZXIoKSB7IHJldHVybiBCdWlsZGVyLmNyZWF0ZSgpOyB9CiAg\nICBwdWJsaWMgQnVpbGRlciBuZXdCdWlsZGVyRm9yVHlwZSgpIHsgcmV0dXJu\nIG5ld0J1aWxkZXIoKTsgfQogICAgcHVibGljIHN0YXRpYyBCdWlsZGVyIG5l\nd0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBwcm90b3R5cGUpIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAg\nIH0KICAgIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5l\nd0J1aWxkZXIodGhpcyk7IH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBjbGFzcyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPiB7CiAg\nICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyByZXN1bHQ7CiAgICAgIAog\nICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucy5uZXdC\ndWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkge30KICAgICAgCiAg\nICAgIHByaXZhdGUgc3RhdGljIEJ1aWxkZXIgY3JlYXRlKCkgewogICAgICAg\nIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7CiAgICAgICAgYnVp\nbGRlci5yZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucygpOwogICAgICAg\nIHJldHVybiBidWlsZGVyOwogICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0\nZWQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaXB0aW9uT3B0aW9ucyBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAg\nICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAgICBpZiAocmVzdWx0ID09IG51\nbGwpIHsKICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24oCiAgICAgICAgICAgICJDYW5ub3QgY2FsbCBjbGVhcigpIGFmdGVyIGJ1\naWxkKCkuIik7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IG5ldyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25PcHRpb25zKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAg\nIHJldHVybiBjcmVhdGUoKS5tZXJnZUZyb20ocmVzdWx0KTsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3Jp\ncHRvcnMuRGVzY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5\ncGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMuZ2V0RGVz\nY3JpcHRvcigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uT3B0aW9ucyBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAg\nICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zLmdldERlZmF1bHRJbnN0YW5j\nZSgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgYm9vbGVhbiBpc0lu\naXRpYWxpemVkKCkgewogICAgICAgIHJldHVybiByZXN1bHQuaXNJbml0aWFs\naXplZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25z\nIGJ1aWxkKCkgewogICAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCAmJiAhaXNJ\nbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxp\nemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0KICAgICAg\nICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgIH0KICAgICAgCiAgICAg\nIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBidWlsZFBhcnNlZCgpCiAgICAg\nICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24gewogICAgICAgIGlmICghaXNJbml0aWFsaXpl\nZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2Fn\nZUV4Y2VwdGlvbigKICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1\ncm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpcHRpb25PcHRpb25zIGJ1aWxkUGFydGlhbCgpIHsKICAgICAgICBp\nZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBJbGxl\nZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICJidWlsZCgpIGhhcyBh\nbHJlYWR5IGJlZW4gY2FsbGVkIG9uIHRoaXMgQnVpbGRlci4iKTsKICAgICAg\nICB9CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyByZXR1cm5NZSA9IHJlc3Vs\ndDsKICAgICAgICByZXN1bHQgPSBudWxsOwogICAgICAgIHJldHVybiByZXR1\ncm5NZTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVy\nZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewog\nICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlvbnMp\nIHsKICAgICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvbk9wdGlv\nbnMpb3RoZXIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdXBlci5t\nZXJnZUZyb20ob3RoZXIpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgfQogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJn\nZUZyb20ob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3Vic2NyaXB0aW9uT3B0aW9ucyBvdGhlcikgewogICAgICAgIGlmIChv\ndGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdWJzY3JpcHRpb25PcHRpb25zLmdldERlZmF1bHRJbnN0YW5jZSgp\nKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIuaGFzQ3JlYXRlT3JB\ndHRhY2goKSkgewogICAgICAgICAgc2V0Q3JlYXRlT3JBdHRhY2gob3RoZXIu\nZ2V0Q3JlYXRlT3JBdHRhY2goKSk7CiAgICAgICAgfQogICAgICAgIGlmIChv\ndGhlci5oYXNNZXNzYWdlQm91bmQoKSkgewogICAgICAgICAgc2V0TWVzc2Fn\nZUJvdW5kKG90aGVyLmdldE1lc3NhZ2VCb3VuZCgpKTsKICAgICAgICB9CiAg\nICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93\nbkZpZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAog\nICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAg\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5l\nd0J1aWxkZXIoCiAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygp\nKTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9\nIGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAg\nICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnNldFVua25v\nd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAg\nICAgICAgIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25G\naWVsZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBl\neHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgdGhp\ncy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAg\nICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\nY2FzZSAxNjogewogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlucHV0\nLnJlYWRFbnVtKCk7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVh\ndGVPckF0dGFjaCB2YWx1ZSA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRh\nY2gudmFsdWVPZihyYXdWYWx1ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbHVl\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHVua25vd25GaWVsZHMubWVy\nZ2VWYXJpbnRGaWVsZCgyLCByYXdWYWx1ZSk7CiAgICAgICAgICAgICAgfSBl\nbHNlIHsKICAgICAgICAgICAgICAgIHNldENyZWF0ZU9yQXR0YWNoKHZhbHVl\nKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgY2FzZSAyNDogewogICAgICAgICAgICAg\nIHNldE1lc3NhZ2VCb3VuZChpbnB1dC5yZWFkVUludDMyKCkpOwogICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICB9CiAgICAgIAogICAgICAKICAgICAgLy8gb3B0aW9uYWwg\nLkhlZHdpZy5TdWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoIGNyZWF0\nZU9yQXR0YWNoID0gMiBbZGVmYXVsdCA9IENSRUFURV9PUl9BVFRBQ0hdOwog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNDcmVhdGVPckF0dGFjaCgpIHsKICAg\nICAgICByZXR1cm4gcmVzdWx0Lmhhc0NyZWF0ZU9yQXR0YWNoKCk7CiAgICAg\nIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2gg\nZ2V0Q3JlYXRlT3JBdHRhY2goKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5n\nZXRDcmVhdGVPckF0dGFjaCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIHNldENyZWF0ZU9yQXR0YWNoKG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JB\ndHRhY2ggdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewog\nICAgICAgICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIHJlc3VsdC5oYXNDcmVhdGVPckF0dGFjaCA9IHRy\ndWU7CiAgICAgICAgcmVzdWx0LmNyZWF0ZU9yQXR0YWNoXyA9IHZhbHVlOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsZWFyQ3JlYXRlT3JBdHRhY2goKSB7CiAgICAgICAgcmVzdWx0Lmhh\nc0NyZWF0ZU9yQXR0YWNoID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LmNyZWF0\nZU9yQXR0YWNoXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmliZVJlcXVlc3QuQ3JlYXRlT3JBdHRhY2guQ1JF\nQVRFX09SX0FUVEFDSDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICAKICAgICAgLy8gb3B0aW9uYWwgdWludDMyIG1lc3NhZ2VCb3VuZCA9\nIDMgW2RlZmF1bHQgPSAwXTsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzTWVz\nc2FnZUJvdW5kKCkgewogICAgICAgIHJldHVybiByZXN1bHQuaGFzTWVzc2Fn\nZUJvdW5kKCk7CiAgICAgIH0KICAgICAgcHVibGljIGludCBnZXRNZXNzYWdl\nQm91bmQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRNZXNzYWdlQm91\nbmQoKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNZXNzYWdl\nQm91bmQoaW50IHZhbHVlKSB7CiAgICAgICAgcmVzdWx0Lmhhc01lc3NhZ2VC\nb3VuZCA9IHRydWU7CiAgICAgICAgcmVzdWx0Lm1lc3NhZ2VCb3VuZF8gPSB2\nYWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhck1lc3NhZ2VCb3VuZCgpIHsKICAgICAgICByZXN1\nbHQuaGFzTWVzc2FnZUJvdW5kID0gZmFsc2U7CiAgICAgICAgcmVzdWx0Lm1l\nc3NhZ2VCb3VuZF8gPSAwOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9\nCiAgICAgIAogICAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVp\nbGRlcl9zY29wZTpIZWR3aWcuU3Vic2NyaXB0aW9uT3B0aW9ucykKICAgIH0K\nICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3\nIFN1YnNjcmlwdGlvbk9wdGlvbnModHJ1ZSk7CiAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9yY2VJ\nbml0KCk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAg\nICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFz\nc19zY29wZTpIZWR3aWcuU3Vic2NyaXB0aW9uT3B0aW9ucykKICB9CiAgCiAg\ncHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBDb25zdW1lUmVxdWVzdCBleHRl\nbmRzCiAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZSB7CiAgICAvLyBVc2UgQ29uc3VtZVJlcXVlc3QubmV3QnVpbGRlcigpIHRv\nIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgQ29uc3VtZVJlcXVlc3QoKSB7CiAg\nICAgIGluaXRGaWVsZHMoKTsKICAgIH0KICAgIHByaXZhdGUgQ29uc3VtZVJl\ncXVlc3QoYm9vbGVhbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3Rh\ndGljIGZpbmFsIENvbnN1bWVSZXF1ZXN0IGRlZmF1bHRJbnN0YW5jZTsKICAg\nIHB1YmxpYyBzdGF0aWMgQ29uc3VtZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3Rh\nbmNlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQog\nICAgCiAgICBwdWJsaWMgQ29uc3VtZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3Rh\nbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsK\nICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xl\nLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXRE\nZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19Db25zdW1lUmVxdWVzdF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBw\ncm90ZWN0ZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdl\nLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRB\nY2Nlc3NvclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19Db25zdW1lUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9\nCiAgICAKICAgIC8vIHJlcXVpcmVkIGJ5dGVzIHN1YnNjcmliZXJJZCA9IDI7\nCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVUJTQ1JJQkVSSURfRklF\nTERfTlVNQkVSID0gMjsKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNTdWJzY3Jp\nYmVySWQ7CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZyBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nLkVNUFRZOwogICAgcHVibGljIGJvb2xlYW4gaGFzU3Vic2NyaWJl\ncklkKCkgeyByZXR1cm4gaGFzU3Vic2NyaWJlcklkOyB9CiAgICBwdWJsaWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1YnNjcmliZXJJ\nZCgpIHsgcmV0dXJuIHN1YnNjcmliZXJJZF87IH0KICAgIAogICAgLy8gcmVx\ndWlyZWQgLkhlZHdpZy5NZXNzYWdlU2VxSWQgbXNnSWQgPSAzOwogICAgcHVi\nbGljIHN0YXRpYyBmaW5hbCBpbnQgTVNHSURfRklFTERfTlVNQkVSID0gMzsK\nICAgIHByaXZhdGUgYm9vbGVhbiBoYXNNc2dJZDsKICAgIHByaXZhdGUgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2Fn\nZVNlcUlkIG1zZ0lkXzsKICAgIHB1YmxpYyBib29sZWFuIGhhc01zZ0lkKCkg\neyByZXR1cm4gaGFzTXNnSWQ7IH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgZ2V0\nTXNnSWQoKSB7IHJldHVybiBtc2dJZF87IH0KICAgIAogICAgcHJpdmF0ZSB2\nb2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIG1zZ0lkXyA9IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5n\nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgIH0KICAgIHB1YmxpYyBmaW5hbCBi\nb29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgIGlmICghaGFzU3Vic2Ny\naWJlcklkKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghaGFzTXNnSWQpIHJl\ndHVybiBmYWxzZTsKICAgICAgaWYgKCFnZXRNc2dJZCgpLmlzSW5pdGlhbGl6\nZWQoKSkgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0K\nICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAgICAgICAgICAgICAg\nICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBn\nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoaGFzU3Vic2NyaWJlcklk\nKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygyLCBnZXRTdWJzY3Jp\nYmVySWQoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc01zZ0lkKCkpIHsKICAg\nICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDMsIGdldE1zZ0lkKCkpOwogICAg\nICB9CiAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7\nCiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXpl\nZFNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUo\nKSB7CiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsK\nICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAgICAg\nIHNpemUgPSAwOwogICAgICBpZiAoaGFzU3Vic2NyaWJlcklkKCkpIHsKICAg\nICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDIsIGdldFN1YnNj\ncmliZXJJZCgpKTsKICAgICAgfQogICAgICBpZiAoaGFzTXNnSWQoKSkgewog\nICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1\ndFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVNZXNzYWdlU2l6ZSgzLCBnZXRN\nc2dJZCgpKTsKICAgICAgfQogICAgICBzaXplICs9IGdldFVua25vd25GaWVs\nZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNlcmlh\nbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgcGFyc2VGcm9tKAog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBw\ndWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZGF0YSwKICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICBy\nZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IHBhcnNlRnJvbShieXRl\nW10gZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5J\nbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwog\nICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBwYXJzZUZyb20o\nCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5Db25zdW1lUmVxdWVzdCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVh\nbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5i\ndWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVx\ndWVzdCBwYXJzZUZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBp\nbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3Mg\namF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkNvbnN1bWVSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklu\ncHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigp\nOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQp\nKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAg\nICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCBwYXJzZURlbGltaXRl\nZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxk\nZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlu\ncHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1cm4gYnVp\nbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJl\ndHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1\nbWVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAg\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUo\nKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7\nIHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVp\nbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IHByb3RvdHlwZSkgewogICAg\nICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5cGUpOwog\nICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4g\nbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsK\nICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCByZXN1bHQ7CiAgICAgIAogICAg\nICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QubmV3QnVpbGRlcigp\nCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CiAgICAgIAogICAgICBwcml2\nYXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBCdWlsZGVy\nIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcigpOwogICAgICAgIGJ1aWxkZXIucmVz\ndWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkNvbnN1bWVSZXF1ZXN0KCk7CiAgICAgICAgcmV0dXJuIGJ1aWxk\nZXI7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVz\ndCBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhcigp\nIHsKICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgIHRo\ncm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICJD\nYW5ub3QgY2FsbCBjbGVhcigpIGFmdGVyIGJ1aWxkKCkuIik7CiAgICAgICAg\nfQogICAgICAgIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdCgpOwogICAgICAg\nIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVp\nbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VG\ncm9tKHJlc3VsdCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAg\nICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25z\ndW1lUmVxdWVzdC5nZXREZXNjcmlwdG9yKCk7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2VGb3JU\neXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5Db25zdW1lUmVxdWVzdC5nZXREZWZhdWx0\nSW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIGJvb2xl\nYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmlz\nSW5pdGlhbGl6ZWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVl\nc3QgYnVpbGQoKSB7CiAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsICYmICFp\nc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlh\nbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAg\nICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAgfQogICAgICAKICAg\nICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdCBidWlsZFBhcnNlZCgpCiAgICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICAgIGlmICghaXNJbml0aWFsaXplZCgp\nKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4\nY2VwdGlvbigKICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2Nv\nbEJ1ZmZlckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4g\nYnVpbGRQYXJ0aWFsKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25z\ndW1lUmVxdWVzdCBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgaWYgKHJlc3Vs\ndCA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uKAogICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBi\nZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAgfQogICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkNvbnN1bWVSZXF1ZXN0IHJldHVybk1lID0gcmVzdWx0OwogICAgICAgIHJl\nc3VsdCA9IG51bGw7CiAgICAgICAgcmV0dXJuIHJldHVybk1lOwogICAgICB9\nCiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdv\nb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90\naGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuQ29uc3VtZVJlcXVlc3QpIHsKICAgICAgICAgIHJldHVy\nbiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0KW90aGVyKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0IG90aGVy\nKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkNvbnN1bWVSZXF1ZXN0LmdldERlZmF1\nbHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIu\naGFzU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICAgIHNldFN1YnNjcmliZXJJ\nZChvdGhlci5nZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgICAgfQogICAgICAg\nIGlmIChvdGhlci5oYXNNc2dJZCgpKSB7CiAgICAgICAgICBtZXJnZU1zZ0lk\nKG90aGVyLmdldE1zZ0lkKCkpOwogICAgICAgIH0KICAgICAgICB0aGlzLm1l\ncmdlVW5rbm93bkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmllbGRzKCkpOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNp\nb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0\naW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVs\nZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVpbGRlcigKICAg\nICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHdo\naWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRh\nZygpOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICAgICAgY2Fz\nZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtu\nb3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgIHJldHVybiB0aGlz\nOwogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFw\nYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lz\ndHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25G\naWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICAg\nIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDE4OiB7CiAg\nICAgICAgICAgICAgc2V0U3Vic2NyaWJlcklkKGlucHV0LnJlYWRCeXRlcygp\nKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjYXNlIDI2OiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxk\nZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgaWYgKGhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIHN1\nYkJ1aWxkZXIubWVyZ2VGcm9tKGdldE1zZ0lkKCkpOwogICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVy\nLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0TXNnSWQo\nc3ViQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJl\nYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAg\nIH0KICAgICAgCiAgICAgIAogICAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJz\nY3JpYmVySWQgPSAyOwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3Jp\nYmVySWQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNTdWJzY3JpYmVy\nSWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1\nZi5CeXRlU3RyaW5nIGdldFN1YnNjcmliZXJJZCgpIHsKICAgICAgICByZXR1\ncm4gcmVzdWx0LmdldFN1YnNjcmliZXJJZCgpOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIHNldFN1YnNjcmliZXJJZChjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgdmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0g\nbnVsbCkgewogICAgdGhyb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7\nCiAgfQogIHJlc3VsdC5oYXNTdWJzY3JpYmVySWQgPSB0cnVlOwogICAgICAg\nIHJlc3VsdC5zdWJzY3JpYmVySWRfID0gdmFsdWU7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdWJz\nY3JpYmVySWQoKSB7CiAgICAgICAgcmVzdWx0Lmhhc1N1YnNjcmliZXJJZCA9\nIGZhbHNlOwogICAgICAgIHJlc3VsdC5zdWJzY3JpYmVySWRfID0gZ2V0RGVm\nYXVsdEluc3RhbmNlKCkuZ2V0U3Vic2NyaWJlcklkKCk7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIC5I\nZWR3aWcuTWVzc2FnZVNlcUlkIG1zZ0lkID0gMzsKICAgICAgcHVibGljIGJv\nb2xlYW4gaGFzTXNnSWQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNN\nc2dJZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgZ2V0TXNn\nSWQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRNc2dJZCgpOwogICAg\nICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldE1zZ0lkKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2\nYWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAg\nICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICB9\nCiAgICAgICAgcmVzdWx0Lmhhc01zZ0lkID0gdHJ1ZTsKICAgICAgICByZXN1\nbHQubXNnSWRfID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TXNnSWQob3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1\naWxkZXIgYnVpbGRlckZvclZhbHVlKSB7CiAgICAgICAgcmVzdWx0Lmhhc01z\nZ0lkID0gdHJ1ZTsKICAgICAgICByZXN1bHQubXNnSWRfID0gYnVpbGRlckZv\nclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VNc2dJZChvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgdmFs\ndWUpIHsKICAgICAgICBpZiAocmVzdWx0Lmhhc01zZ0lkKCkgJiYKICAgICAg\nICAgICAgcmVzdWx0Lm1zZ0lkXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdElu\nc3RhbmNlKCkpIHsKICAgICAgICAgIHJlc3VsdC5tc2dJZF8gPQogICAgICAg\nICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5NZXNzYWdlU2VxSWQubmV3QnVpbGRlcihyZXN1bHQubXNnSWRfKS5tZXJn\nZUZyb20odmFsdWUpLmJ1aWxkUGFydGlhbCgpOwogICAgICAgIH0gZWxzZSB7\nCiAgICAgICAgICByZXN1bHQubXNnSWRfID0gdmFsdWU7CiAgICAgICAgfQog\nICAgICAgIHJlc3VsdC5oYXNNc2dJZCA9IHRydWU7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNc2dJ\nZCgpIHsKICAgICAgICByZXN1bHQuaGFzTXNnSWQgPSBmYWxzZTsKICAgICAg\nICByZXN1bHQubXNnSWRfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5j\nZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAg\nICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpI\nZWR3aWcuQ29uc3VtZVJlcXVlc3QpCiAgICB9CiAgICAKICAgIHN0YXRpYyB7\nCiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBDb25zdW1lUmVxdWVzdCh0\ncnVlKTsKICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuaW50ZXJuYWxGb3JjZUluaXQoKTsKICAgICAgZGVmYXVsdElu\nc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAgLy8gQEBwcm90\nb2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdpZy5Db25zdW1l\nUmVxdWVzdCkKICB9CiAgCiAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBV\nbnN1YnNjcmliZVJlcXVlc3QgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UgewogICAgLy8gVXNlIFVuc3Vic2Ny\naWJlUmVxdWVzdC5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJp\ndmF0ZSBVbnN1YnNjcmliZVJlcXVlc3QoKSB7CiAgICAgIGluaXRGaWVsZHMo\nKTsKICAgIH0KICAgIHByaXZhdGUgVW5zdWJzY3JpYmVSZXF1ZXN0KGJvb2xl\nYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBV\nbnN1YnNjcmliZVJlcXVlc3QgZGVmYXVsdEluc3RhbmNlOwogICAgcHVibGlj\nIHN0YXRpYyBVbnN1YnNjcmliZVJlcXVlc3QgZ2V0RGVmYXVsdEluc3RhbmNl\nKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAg\nCiAgICBwdWJsaWMgVW5zdWJzY3JpYmVSZXF1ZXN0IGdldERlZmF1bHRJbnN0\nYW5jZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7\nCiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2ds\nZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0\nRGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3\naWdfVW5zdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgICB9CiAgICAK\nICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRG\naWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1Vuc3Vic2NyaWJlUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFi\nbGU7CiAgICB9CiAgICAKICAgIC8vIHJlcXVpcmVkIGJ5dGVzIHN1YnNjcmli\nZXJJZCA9IDI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBTVUJTQ1JJ\nQkVSSURfRklFTERfTlVNQkVSID0gMjsKICAgIHByaXZhdGUgYm9vbGVhbiBo\nYXNTdWJzY3JpYmVySWQ7CiAgICBwcml2YXRlIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBzdWJzY3JpYmVySWRfID0gY29tLmdvb2dsZS5wcm90\nb2J1Zi5CeXRlU3RyaW5nLkVNUFRZOwogICAgcHVibGljIGJvb2xlYW4gaGFz\nU3Vic2NyaWJlcklkKCkgeyByZXR1cm4gaGFzU3Vic2NyaWJlcklkOyB9CiAg\nICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1\nYnNjcmliZXJJZCgpIHsgcmV0dXJuIHN1YnNjcmliZXJJZF87IH0KICAgIAog\nICAgcHJpdmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICB9CiAgICBwdWJs\naWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBpZiAo\nIWhhc1N1YnNjcmliZXJJZCkgcmV0dXJuIGZhbHNlOwogICAgICByZXR1cm4g\ndHJ1ZTsKICAgIH0KICAgIAogICAgcHVibGljIHZvaWQgd3JpdGVUbyhjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtIG91dHB1dCkKICAg\nICAgICAgICAgICAgICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICBnZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBpZiAoaGFz\nU3Vic2NyaWJlcklkKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVCeXRlcygy\nLCBnZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93\nbkZpZWxkcygpLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJp\ndmF0ZSBpbnQgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVi\nbGljIGludCBnZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUg\nPSBtZW1vaXplZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAt\nMSkgcmV0dXJuIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlm\nIChoYXNTdWJzY3JpYmVySWQoKSkgewogICAgICAgIHNpemUgKz0gY29tLmdv\nb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNv\nbXB1dGVCeXRlc1NpemUoMiwgZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICB9\nCiAgICAgIHNpemUgKz0gZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6\nZWRTaXplKCk7CiAgICAgIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXpl\nOwogICAgICByZXR1cm4gc2l6ZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5VbnN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93\ncyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4\nY2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVu\nc3Vic2NyaWJlUmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEsCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52\nYWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKGJ5dGVbXSBk\nYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFs\naWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdC\ndWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBwYXJzZUZyb20o\nCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90\nb2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFBy\nb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5VbnN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1\ndCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJz\nY3JpYmVSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0\nU3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0\nZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJv\nbShqYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBq\nYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0g\nbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRl\nZEZyb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQ\nYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsK\nICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVl\nc3QgcGFyc2VEZWxpbWl0ZWRGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRl\nbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAg\ndGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1\naWxkZXIgPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdl\nRGVsaW1pdGVkRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBl\nbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QgcGFyc2VGcm9tKAogICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1\ndCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVl\nc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkg\neyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxk\nZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7\nIH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2Ny\naWJlUmVxdWVzdCBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1YmxpYyBC\ndWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhpcyk7\nIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWlsZGVy\nIGV4dGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRl\nZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPiB7CiAgICAgIHByaXZhdGUgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJz\nY3JpYmVSZXF1ZXN0IHJlc3VsdDsKICAgICAgCiAgICAgIC8vIENvbnN0cnVj\ndCB1c2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5VbnN1YnNjcmliZVJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAgIHBy\naXZhdGUgQnVpbGRlcigpIHt9CiAgICAgIAogICAgICBwcml2YXRlIHN0YXRp\nYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXcgQnVpbGRlcigpOwogICAgICAgIGJ1aWxkZXIucmVzdWx0ID0gbmV3\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVu\nc3Vic2NyaWJlUmVxdWVzdCgpOwogICAgICAgIHJldHVybiBidWlsZGVyOwog\nICAgICB9CiAgICAgIAogICAgICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0\nIGludGVybmFsR2V0UmVzdWx0KCkgewogICAgICAgIHJldHVybiByZXN1bHQ7\nCiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkg\newogICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkgewogICAgICAgICAgdGhy\nb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgIkNh\nbm5vdCBjYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICB9\nCiAgICAgICAgcmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCgpOwogICAg\nICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRlKCkubWVy\nZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAg\nICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAgIHJldHVy\nbiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5V\nbnN1YnNjcmliZVJlcXVlc3QuZ2V0RGVzY3JpcHRvcigpOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IGdldERlZmF1bHRJ\nbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVx\ndWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgICBy\nZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgfQogICAgICBw\ndWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuVW5zdWJzY3JpYmVSZXF1ZXN0IGJ1aWxkKCkgewogICAgICAgIGlmIChy\nZXN1bHQgIT0gbnVsbCAmJiAhaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAg\nICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1\nbHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0\nIGJ1aWxkUGFyc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAg\nICAgaWYgKCFpc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5l\nd1VuaW5pdGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICBy\nZXN1bHQpLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAg\nICAgICAgfQogICAgICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBidWlsZFBh\ncnRpYWwoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAg\nICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAg\nICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlz\nIEJ1aWxkZXIuIik7CiAgICAgICAgfQogICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVz\ndCByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAgICByZXN1bHQgPSBudWxsOwog\nICAgICAgIHJldHVybiByZXR1cm5NZTsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUucHJvdG9idWYu\nTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBpbnN0YW5jZW9m\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlVu\nc3Vic2NyaWJlUmVxdWVzdCkgewogICAgICAgICAgcmV0dXJuIG1lcmdlRnJv\nbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nVW5zdWJzY3JpYmVSZXF1ZXN0KW90aGVyKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdCBvdGhlcikg\newogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5VbnN1YnNjcmliZVJlcXVlc3QuZ2V0RGVm\nYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlmIChvdGhl\nci5oYXNTdWJzY3JpYmVySWQoKSkgewogICAgICAgICAgc2V0U3Vic2NyaWJl\ncklkKG90aGVyLmdldFN1YnNjcmliZXJJZCgpKTsKICAgICAgICB9CiAgICAg\nICAgdGhpcy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZp\nZWxkcygpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAg\nICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxp\ndGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5V\nbmtub3duRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAg\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1\naWxkZXIoCiAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsK\nICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9IGlu\ncHV0LnJlYWRUYWcoKTsKICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAg\nICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25G\naWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAg\nICAgIGlmICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVs\nZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRl\nbnNpb25SZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgdGhpcy5z\nZXRVbmtub3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAg\nICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2Fz\nZSAxODogewogICAgICAgICAgICAgIHNldFN1YnNjcmliZXJJZChpbnB1dC5y\nZWFkQnl0ZXMoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAg\nIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAg\nIAogICAgICAvLyByZXF1aXJlZCBieXRlcyBzdWJzY3JpYmVySWQgPSAyOwog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQoKSB7CiAgICAg\nICAgcmV0dXJuIHJlc3VsdC5oYXNTdWJzY3JpYmVySWQoKTsKICAgICAgfQog\nICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdl\ndFN1YnNjcmliZXJJZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmdldFN1\nYnNjcmliZXJJZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNl\ndFN1YnNjcmliZXJJZChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\ndmFsdWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhy\nb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIHJlc3VsdC5o\nYXNTdWJzY3JpYmVySWQgPSB0cnVlOwogICAgICAgIHJlc3VsdC5zdWJzY3Jp\nYmVySWRfID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVySWQoKSB7CiAg\nICAgICAgcmVzdWx0Lmhhc1N1YnNjcmliZXJJZCA9IGZhbHNlOwogICAgICAg\nIHJlc3VsdC5zdWJzY3JpYmVySWRfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCku\nZ2V0U3Vic2NyaWJlcklkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChi\ndWlsZGVyX3Njb3BlOkhlZHdpZy5VbnN1YnNjcmliZVJlcXVlc3QpCiAgICB9\nCiAgICAKICAgIHN0YXRpYyB7CiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5l\ndyBVbnN1YnNjcmliZVJlcXVlc3QodHJ1ZSk7CiAgICAgIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVybmFsRm9yY2VJ\nbml0KCk7CiAgICAgIGRlZmF1bHRJbnN0YW5jZS5pbml0RmllbGRzKCk7CiAg\nICB9CiAgICAKICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChjbGFz\nc19zY29wZTpIZWR3aWcuVW5zdWJzY3JpYmVSZXF1ZXN0KQogIH0KICAKICBw\ndWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIFN0b3BEZWxpdmVyeVJlcXVlc3Qg\nZXh0ZW5kcwogICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UgewogICAgLy8gVXNlIFN0b3BEZWxpdmVyeVJlcXVlc3QubmV3QnVp\nbGRlcigpIHRvIGNvbnN0cnVjdC4KICAgIHByaXZhdGUgU3RvcERlbGl2ZXJ5\nUmVxdWVzdCgpIHsKICAgICAgaW5pdEZpZWxkcygpOwogICAgfQogICAgcHJp\ndmF0ZSBTdG9wRGVsaXZlcnlSZXF1ZXN0KGJvb2xlYW4gbm9Jbml0KSB7fQog\nICAgCiAgICBwcml2YXRlIHN0YXRpYyBmaW5hbCBTdG9wRGVsaXZlcnlSZXF1\nZXN0IGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0aWMgU3RvcERl\nbGl2ZXJ5UmVxdWVzdCBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJl\ndHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBT\ndG9wRGVsaXZlcnlSZXF1ZXN0IGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUo\nKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5E\nZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigp\nIHsKICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2\nZXJ5UmVxdWVzdF9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0\nZWQgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3Nv\nclRhYmxlKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19T\ndG9wRGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0K\nICAgIAogICAgLy8gcmVxdWlyZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0gMjsK\nICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IFNVQlNDUklCRVJJRF9GSUVM\nRF9OVU1CRVIgPSAyOwogICAgcHJpdmF0ZSBib29sZWFuIGhhc1N1YnNjcmli\nZXJJZDsKICAgIHByaXZhdGUgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nIHN1YnNjcmliZXJJZF8gPSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVT\ndHJpbmcuRU1QVFk7CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVy\nSWQoKSB7IHJldHVybiBoYXNTdWJzY3JpYmVySWQ7IH0KICAgIHB1YmxpYyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklk\nKCkgeyByZXR1cm4gc3Vic2NyaWJlcklkXzsgfQogICAgCiAgICBwcml2YXRl\nIHZvaWQgaW5pdEZpZWxkcygpIHsKICAgIH0KICAgIHB1YmxpYyBmaW5hbCBi\nb29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgIGlmICghaGFzU3Vic2Ny\naWJlcklkKSByZXR1cm4gZmFsc2U7CiAgICAgIHJldHVybiB0cnVlOwogICAg\nfQogICAgCiAgICBwdWJsaWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJv\ndG9idWYuQ29kZWRPdXRwdXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAg\nICAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAg\nIGdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAgIGlmIChoYXNTdWJzY3JpYmVy\nSWQoKSkgewogICAgICAgIG91dHB1dC53cml0ZUJ5dGVzKDIsIGdldFN1YnNj\ncmliZXJJZCgpKTsKICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCku\nd3JpdGVUbyhvdXRwdXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBt\nZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdl\ndFNlcmlhbGl6ZWRTaXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVk\nU2VyaWFsaXplZFNpemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4g\nc2l6ZTsKICAgIAogICAgICBzaXplID0gMDsKICAgICAgaWYgKGhhc1N1YnNj\ncmliZXJJZCgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZUJ5dGVz\nU2l6ZSgyLCBnZXRTdWJzY3JpYmVySWQoKSk7CiAgICAgIH0KICAgICAgc2l6\nZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsK\nICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgIHJl\ndHVybiBzaXplOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxp\ndmVyeVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVy\neVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBkYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90\nb2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVy\nKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAg\nICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0\naWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oYnl0ZVtdIGRhdGEpCiAg\nICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3Rv\nY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIo\nKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oCiAgICAg\nICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5F\neHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5t\nZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAg\nICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9w\nRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbShqYXZhLmlvLklucHV0U3RyZWFt\nIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsK\nICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVy\neVJlcXVlc3QgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJl\nYW0gaW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNp\nb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhy\nb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVp\nbGRlcigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbShq\nYXZhLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZh\nLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3\nQnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZy\nb20oaW5wdXQpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJz\nZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAg\nICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0\nIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWls\nZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURl\nbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0\nKQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAg\ncmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQpLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVl\nc3QgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkK\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJl\ndHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkg\neyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxk\nZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7\nIH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxp\ndmVyeVJlcXVlc3QgcHJvdG90eXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWls\nZGVyKCkubWVyZ2VGcm9tKHByb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMg\nQnVpbGRlciB0b0J1aWxkZXIoKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMp\nOyB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRl\nciBleHRlbmRzCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkJ1aWxkZXI8QnVpbGRlcj4gewogICAgICBwcml2YXRlIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BE\nZWxpdmVyeVJlcXVlc3QgcmVzdWx0OwogICAgICAKICAgICAgLy8gQ29uc3Ry\ndWN0IHVzaW5nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAg\nIHByaXZhdGUgQnVpbGRlcigpIHt9CiAgICAgIAogICAgICBwcml2YXRlIHN0\nYXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBCdWlsZGVyIGJ1aWxk\nZXIgPSBuZXcgQnVpbGRlcigpOwogICAgICAgIGJ1aWxkZXIucmVzdWx0ID0g\nbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0b3BEZWxpdmVyeVJlcXVlc3QoKTsKICAgICAgICByZXR1cm4gYnVpbGRl\ncjsKICAgICAgfQogICAgICAKICAgICAgcHJvdGVjdGVkIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJl\ncXVlc3QgaW50ZXJuYWxHZXRSZXN1bHQoKSB7CiAgICAgICAgcmV0dXJuIHJl\nc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgY2xl\nYXIoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAg\nICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAg\nICAiQ2Fubm90IGNhbGwgY2xlYXIoKSBhZnRlciBidWlsZCgpLiIpOwogICAg\nICAgIH0KICAgICAgICByZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRl\nKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0LmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVyeVJlcXVlc3QgZ2V0\nRGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERl\nbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsK\nICAgICAgICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAg\nfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdCBidWlsZCgpIHsKICAg\nICAgICBpZiAocmVzdWx0ICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkg\newogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNl\ncHRpb24ocmVzdWx0KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxk\nUGFydGlhbCgpOwogICAgICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxp\ndmVyeVJlcXVlc3QgYnVpbGRQYXJzZWQoKQogICAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAg\nICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24oCiAg\nICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlh\nbCgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2ZXJ5UmVx\ndWVzdCBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBu\ndWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uKAogICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNh\nbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAgfQogICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BE\nZWxpdmVyeVJlcXVlc3QgcmV0dXJuTWUgPSByZXN1bHQ7CiAgICAgICAgcmVz\ndWx0ID0gbnVsbDsKICAgICAgICByZXR1cm4gcmV0dXJuTWU7CiAgICAgIH0K\nICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1lcmdlRnJvbShjb20uZ29v\nZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsKICAgICAgICBpZiAob3Ro\nZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0KSB7CiAgICAgICAgICBy\nZXR1cm4gbWVyZ2VGcm9tKChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5TdG9wRGVsaXZlcnlSZXF1ZXN0KW90aGVyKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVy\nKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQog\nICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxpdmVy\neVJlcXVlc3Qgb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RvcERlbGl2\nZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0dXJuIHRoaXM7\nCiAgICAgICAgaWYgKG90aGVyLmhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAg\nICAgICBzZXRTdWJzY3JpYmVySWQob3RoZXIuZ2V0U3Vic2NyaWJlcklkKCkp\nOwogICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhv\ndGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZy\nb20oCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRT\ndHJlYW0gaW5wdXQsCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25v\nd25GaWVsZHMgPQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtu\nb3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRV\nbmtub3duRmllbGRzKCkpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAg\nICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgc3dp\ndGNoICh0YWcpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAg\nIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkp\nOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICBkZWZh\ndWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZChp\nbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAg\nICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxk\ncy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBjYXNlIDE4OiB7CiAgICAgICAgICAgICAgc2V0U3Vi\nc2NyaWJlcklkKGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAgICAgICBi\ncmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgfQogICAgICAKICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIGJ5dGVzIHN1\nYnNjcmliZXJJZCA9IDI7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNj\ncmliZXJJZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1N1YnNjcmli\nZXJJZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkJ5dGVTdHJpbmcgZ2V0U3Vic2NyaWJlcklkKCkgewogICAgICAgIHJl\ndHVybiByZXN1bHQuZ2V0U3Vic2NyaWJlcklkKCk7CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgc2V0U3Vic2NyaWJlcklkKGNvbS5nb29nbGUucHJv\ndG9idWYuQnl0ZVN0cmluZyB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1ZSA9\nPSBudWxsKSB7CiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24o\nKTsKICB9CiAgcmVzdWx0Lmhhc1N1YnNjcmliZXJJZCA9IHRydWU7CiAgICAg\nICAgcmVzdWx0LnN1YnNjcmliZXJJZF8gPSB2YWx1ZTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN1\nYnNjcmliZXJJZCgpIHsKICAgICAgICByZXN1bHQuaGFzU3Vic2NyaWJlcklk\nID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LnN1YnNjcmliZXJJZF8gPSBnZXRE\nZWZhdWx0SW5zdGFuY2UoKS5nZXRTdWJzY3JpYmVySWQoKTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gQEBwcm90b2Nf\naW5zZXJ0aW9uX3BvaW50KGJ1aWxkZXJfc2NvcGU6SGVkd2lnLlN0b3BEZWxp\ndmVyeVJlcXVlc3QpCiAgICB9CiAgICAKICAgIHN0YXRpYyB7CiAgICAgIGRl\nZmF1bHRJbnN0YW5jZSA9IG5ldyBTdG9wRGVsaXZlcnlSZXF1ZXN0KHRydWUp\nOwogICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5pbnRlcm5hbEZvcmNlSW5pdCgpOwogICAgICBkZWZhdWx0SW5zdGFu\nY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAgICAvLyBAQHByb3RvY19p\nbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlN0b3BEZWxpdmVy\neVJlcXVlc3QpCiAgfQogIAogIHB1YmxpYyBzdGF0aWMgZmluYWwgY2xhc3Mg\nU3RhcnREZWxpdmVyeVJlcXVlc3QgZXh0ZW5kcwogICAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UgewogICAgLy8gVXNlIFN0YXJ0\nRGVsaXZlcnlSZXF1ZXN0Lm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAg\nICBwcml2YXRlIFN0YXJ0RGVsaXZlcnlSZXF1ZXN0KCkgewogICAgICBpbml0\nRmllbGRzKCk7CiAgICB9CiAgICBwcml2YXRlIFN0YXJ0RGVsaXZlcnlSZXF1\nZXN0KGJvb2xlYW4gbm9Jbml0KSB7fQogICAgCiAgICBwcml2YXRlIHN0YXRp\nYyBmaW5hbCBTdGFydERlbGl2ZXJ5UmVxdWVzdCBkZWZhdWx0SW5zdGFuY2U7\nCiAgICBwdWJsaWMgc3RhdGljIFN0YXJ0RGVsaXZlcnlSZXF1ZXN0IGdldERl\nZmF1bHRJbnN0YW5jZSgpIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5j\nZTsKICAgIH0KICAgIAogICAgcHVibGljIFN0YXJ0RGVsaXZlcnlSZXF1ZXN0\nIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgIHJldHVybiBk\nZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMg\nZmluYWwgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlw\ndG9yCiAgICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAgICAgcmV0dXJuIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmludGVy\nbmFsX3N0YXRpY19IZWR3aWdfU3RhcnREZWxpdmVyeVJlcXVlc3RfZGVzY3Jp\ncHRvcjsKICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJv\ndG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAg\nICAgICBpbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAg\ncmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLmludGVybmFsX3N0YXRpY19IZWR3aWdfU3RhcnREZWxpdmVyeVJlcXVl\nc3RfZmllbGRBY2Nlc3NvclRhYmxlOwogICAgfQogICAgCiAgICAvLyByZXF1\naXJlZCBieXRlcyBzdWJzY3JpYmVySWQgPSAyOwogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBpbnQgU1VCU0NSSUJFUklEX0ZJRUxEX05VTUJFUiA9IDI7CiAg\nICBwcml2YXRlIGJvb2xlYW4gaGFzU3Vic2NyaWJlcklkOwogICAgcHJpdmF0\nZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgc3Vic2NyaWJlcklk\nXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZy5FTVBUWTsKICAg\nIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZXJJZCgpIHsgcmV0dXJuIGhh\nc1N1YnNjcmliZXJJZDsgfQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBnZXRTdWJzY3JpYmVySWQoKSB7IHJldHVybiBzdWJz\nY3JpYmVySWRfOyB9CiAgICAKICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRz\nKCkgewogICAgfQogICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFs\naXplZCgpIHsKICAgICAgaWYgKCFoYXNTdWJzY3JpYmVySWQpIHJldHVybiBm\nYWxzZTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1Ymxp\nYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1\ndFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXplZFNp\nemUoKTsKICAgICAgaWYgKGhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAgICAg\nb3V0cHV0LndyaXRlQnl0ZXMoMiwgZ2V0U3Vic2NyaWJlcklkKCkpOwogICAg\nICB9CiAgICAgIGdldFVua25vd25GaWVsZHMoKS53cml0ZVRvKG91dHB1dCk7\nCiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50IG1lbW9pemVkU2VyaWFsaXpl\nZFNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQgZ2V0U2VyaWFsaXplZFNpemUo\nKSB7CiAgICAgIGludCBzaXplID0gbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZTsK\nICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVybiBzaXplOwogICAgCiAgICAg\nIHNpemUgPSAwOwogICAgICBpZiAoaGFzU3Vic2NyaWJlcklkKCkpIHsKICAg\nICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDIsIGdldFN1YnNj\ncmliZXJJZCgpKTsKICAgICAgfQogICAgICBzaXplICs9IGdldFVua25vd25G\naWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwogICAgICBtZW1vaXplZFNl\ncmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgcmV0dXJuIHNpemU7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgcGFy\nc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmlu\nZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7CiAg\nICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHBhcnNl\nRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcg\nZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJl\nZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlS\nZXF1ZXN0IHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShk\nYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFy\ndERlbGl2ZXJ5UmVxdWVzdCBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtdIGRh\ndGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdp\nc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0\nYSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVx\ndWVzdCBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBw\nYXJzZUZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0\nRGVsaXZlcnlSZXF1ZXN0IHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklu\ncHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigp\nOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQp\nKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAg\nICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBwYXJzZURl\nbGltaXRlZEZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1\ndCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lz\ndHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2\nYS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5l\nd0J1aWxkZXIoKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRG\ncm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1\ncm4gYnVpbGRlci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAg\nICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHBhcnNlRnJvbSgKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAg\nICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4g\nbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsK\nICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgcGFy\nc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1\ndFN0cmVhbSBpbnB1dCwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3Ry\neSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAK\nICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1\ncm4gQnVpbGRlci5jcmVhdGUoKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3\nQnVpbGRlckZvclR5cGUoKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAg\nIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlS\nZXF1ZXN0IHByb3RvdHlwZSkgewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShwcm90b3R5cGUpOwogICAgfQogICAgcHVibGljIEJ1aWxk\nZXIgdG9CdWlsZGVyKCkgeyByZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsgfQog\nICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0\nZW5kcwogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5CdWlsZGVyPEJ1aWxkZXI+IHsKICAgICAgcHJpdmF0ZSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2\nZXJ5UmVxdWVzdCByZXN1bHQ7CiAgICAgIAogICAgICAvLyBDb25zdHJ1Y3Qg\ndXNpbmcgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QubmV3QnVpbGRlcigpCiAgICAgIHBy\naXZhdGUgQnVpbGRlcigpIHt9CiAgICAgIAogICAgICBwcml2YXRlIHN0YXRp\nYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXcgQnVpbGRlcigpOwogICAgICAgIGJ1aWxkZXIucmVzdWx0ID0gbmV3\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0\nYXJ0RGVsaXZlcnlSZXF1ZXN0KCk7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXI7\nCiAgICAgIH0KICAgICAgCiAgICAgIHByb3RlY3RlZCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVx\ndWVzdCBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAgICAgICByZXR1cm4gcmVz\ndWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbGVh\ncigpIHsKICAgICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAg\nIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAg\nICJDYW5ub3QgY2FsbCBjbGVhcigpIGFmdGVyIGJ1aWxkKCkuIik7CiAgICAg\nICAgfQogICAgICAgIHJlc3VsdCA9IG5ldyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICBw\ndWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gY3JlYXRl\nKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1\nYmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0\nb3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBlKCkgewogICAgICAg\nIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdC5nZXREZXNjcmlwdG9yKCk7CiAg\nICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdCBn\nZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICAgIHJldHVybiBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFy\ndERlbGl2ZXJ5UmVxdWVzdC5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nfQogICAgICAKICAgICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXplZCgp\nIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAg\nICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QgYnVpbGQoKSB7\nCiAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsICYmICFpc0luaXRpYWxpemVk\nKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdl\nRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBi\ndWlsZFBhcnRpYWwoKTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFy\ndERlbGl2ZXJ5UmVxdWVzdCBidWlsZFBhcnNlZCgpCiAgICAgICAgICB0aHJv\nd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJF\neGNlcHRpb24gewogICAgICAgIGlmICghaXNJbml0aWFsaXplZCgpKSB7CiAg\nICAgICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlv\nbigKICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZl\nckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVpbGRQ\nYXJ0aWFsKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdGFydERlbGl2\nZXJ5UmVxdWVzdCBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgaWYgKHJlc3Vs\ndCA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRl\nRXhjZXB0aW9uKAogICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBi\nZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAgfQogICAg\nICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0IHJldHVybk1lID0gcmVzdWx0OwogICAg\nICAgIHJlc3VsdCA9IG51bGw7CiAgICAgICAgcmV0dXJuIHJldHVybk1lOwog\nICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20o\nY29tLmdvb2dsZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAg\naWYgKG90aGVyIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVyeVJlcXVlc3QpIHsKICAg\nICAgICAgIHJldHVybiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0KW90\naGVyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VG\ncm9tKG90aGVyKTsKICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0K\nICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9t\nKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0\nYXJ0RGVsaXZlcnlSZXF1ZXN0IG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVy\nID09IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlN0YXJ0RGVsaXZlcnlSZXF1ZXN0LmdldERlZmF1bHRJbnN0YW5jZSgpKSBy\nZXR1cm4gdGhpczsKICAgICAgICBpZiAob3RoZXIuaGFzU3Vic2NyaWJlcklk\nKCkpIHsKICAgICAgICAgIHNldFN1YnNjcmliZXJJZChvdGhlci5nZXRTdWJz\nY3JpYmVySWQoKSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubWVyZ2VVbmtu\nb3duRmllbGRzKG90aGVyLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAg\ncmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWls\nZGVyIG1lcmdlRnJvbSgKICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lz\ndHJ5KQogICAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24gewog\nICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0LkJ1\naWxkZXIgdW5rbm93bkZpZWxkcyA9CiAgICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLlVua25vd25GaWVsZFNldC5uZXdCdWlsZGVyKAogICAgICAgICAg\nICB0aGlzLmdldFVua25vd25GaWVsZHMoKSk7CiAgICAgICAgd2hpbGUgKHRy\ndWUpIHsKICAgICAgICAgIGludCB0YWcgPSBpbnB1dC5yZWFkVGFnKCk7CiAg\nICAgICAgICBzd2l0Y2ggKHRhZykgewogICAgICAgICAgICBjYXNlIDA6CiAg\nICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25GaWVs\nZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nICAgICAgIGRlZmF1bHQ6IHsKICAgICAgICAgICAgICBpZiAoIXBhcnNlVW5r\nbm93bkZpZWxkKGlucHV0LCB1bmtub3duRmllbGRzLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZW5zaW9uUmVnaXN0cnksIHRh\nZykpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1\nbmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwog\nICAgICAgICAgICB9CiAgICAgICAgICAgIGNhc2UgMTg6IHsKICAgICAgICAg\nICAgICBzZXRTdWJzY3JpYmVySWQoaW5wdXQucmVhZEJ5dGVzKCkpOwogICAg\nICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAg\nICAgICAgfQogICAgICB9CiAgICAgIAogICAgICAKICAgICAgLy8gcmVxdWly\nZWQgYnl0ZXMgc3Vic2NyaWJlcklkID0gMjsKICAgICAgcHVibGljIGJvb2xl\nYW4gaGFzU3Vic2NyaWJlcklkKCkgewogICAgICAgIHJldHVybiByZXN1bHQu\naGFzU3Vic2NyaWJlcklkKCk7CiAgICAgIH0KICAgICAgcHVibGljIGNvbS5n\nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTdWJzY3JpYmVySWQoKSB7\nCiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTdWJzY3JpYmVySWQoKTsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdWJzY3JpYmVySWQoY29t\nLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAgICAg\naWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9pbnRl\nckV4Y2VwdGlvbigpOwogIH0KICByZXN1bHQuaGFzU3Vic2NyaWJlcklkID0g\ndHJ1ZTsKICAgICAgICByZXN1bHQuc3Vic2NyaWJlcklkXyA9IHZhbHVlOwog\nICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWls\nZGVyIGNsZWFyU3Vic2NyaWJlcklkKCkgewogICAgICAgIHJlc3VsdC5oYXNT\ndWJzY3JpYmVySWQgPSBmYWxzZTsKICAgICAgICByZXN1bHQuc3Vic2NyaWJl\ncklkXyA9IGdldERlZmF1bHRJbnN0YW5jZSgpLmdldFN1YnNjcmliZXJJZCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAogICAgICAv\nLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoYnVpbGRlcl9zY29wZTpIZWR3\naWcuU3RhcnREZWxpdmVyeVJlcXVlc3QpCiAgICB9CiAgICAKICAgIHN0YXRp\nYyB7CiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBTdGFydERlbGl2ZXJ5\nUmVxdWVzdCh0cnVlKTsKICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxGb3JjZUluaXQoKTsKICAgICAg\nZGVmYXVsdEluc3RhbmNlLmluaXRGaWVsZHMoKTsKICAgIH0KICAgIAogICAg\nLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KGNsYXNzX3Njb3BlOkhlZHdp\nZy5TdGFydERlbGl2ZXJ5UmVxdWVzdCkKICB9CiAgCiAgcHVibGljIHN0YXRp\nYyBmaW5hbCBjbGFzcyBQdWJTdWJSZXNwb25zZSBleHRlbmRzCiAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAvLyBV\nc2UgUHViU3ViUmVzcG9uc2UubmV3QnVpbGRlcigpIHRvIGNvbnN0cnVjdC4K\nICAgIHByaXZhdGUgUHViU3ViUmVzcG9uc2UoKSB7CiAgICAgIGluaXRGaWVs\nZHMoKTsKICAgIH0KICAgIHByaXZhdGUgUHViU3ViUmVzcG9uc2UoYm9vbGVh\nbiBub0luaXQpIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIFB1\nYlN1YlJlc3BvbnNlIGRlZmF1bHRJbnN0YW5jZTsKICAgIHB1YmxpYyBzdGF0\naWMgUHViU3ViUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlKCkgewogICAg\nICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAgfQogICAgCiAgICBwdWJs\naWMgUHViU3ViUmVzcG9uc2UgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgp\nIHsKICAgICAgcmV0dXJuIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkg\newogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJTdWJSZXNw\nb25zZV9kZXNjcmlwdG9yOwogICAgfQogICAgCiAgICBwcm90ZWN0ZWQgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZQogICAgICAgIGludGVybmFsR2V0RmllbGRBY2Nlc3NvclRhYmxl\nKCkgewogICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJTdWJS\nZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgICB9CiAgICAKICAgIC8v\nIHJlcXVpcmVkIC5IZWR3aWcuUHJvdG9jb2xWZXJzaW9uIHByb3RvY29sVmVy\nc2lvbiA9IDE7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBQUk9UT0NP\nTFZFUlNJT05fRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBoYXNQcm90b2NvbFZlcnNpb247CiAgICBwcml2YXRlIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lv\nbiBwcm90b2NvbFZlcnNpb25fOwogICAgcHVibGljIGJvb2xlYW4gaGFzUHJv\ndG9jb2xWZXJzaW9uKCkgeyByZXR1cm4gaGFzUHJvdG9jb2xWZXJzaW9uOyB9\nCiAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHJvdG9jb2xWZXJzaW9uIGdldFByb3RvY29sVmVyc2lvbigp\nIHsgcmV0dXJuIHByb3RvY29sVmVyc2lvbl87IH0KICAgIAogICAgLy8gcmVx\ndWlyZWQgLkhlZHdpZy5TdGF0dXNDb2RlIHN0YXR1c0NvZGUgPSAyOwogICAg\ncHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1RBVFVTQ09ERV9GSUVMRF9OVU1C\nRVIgPSAyOwogICAgcHJpdmF0ZSBib29sZWFuIGhhc1N0YXR1c0NvZGU7CiAg\nICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXR1c0NvZGUgc3RhdHVzQ29kZV87CiAgICBwdWJsaWMgYm9v\nbGVhbiBoYXNTdGF0dXNDb2RlKCkgeyByZXR1cm4gaGFzU3RhdHVzQ29kZTsg\nfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN0YXR1c0NvZGUgZ2V0U3RhdHVzQ29kZSgpIHsgcmV0dXJu\nIHN0YXR1c0NvZGVfOyB9CiAgICAKICAgIC8vIHJlcXVpcmVkIHVpbnQ2NCB0\neG5JZCA9IDM7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBUWE5JRF9G\nSUVMRF9OVU1CRVIgPSAzOwogICAgcHJpdmF0ZSBib29sZWFuIGhhc1R4bklk\nOwogICAgcHJpdmF0ZSBsb25nIHR4bklkXyA9IDBMOwogICAgcHVibGljIGJv\nb2xlYW4gaGFzVHhuSWQoKSB7IHJldHVybiBoYXNUeG5JZDsgfQogICAgcHVi\nbGljIGxvbmcgZ2V0VHhuSWQoKSB7IHJldHVybiB0eG5JZF87IH0KICAgIAog\nICAgLy8gb3B0aW9uYWwgc3RyaW5nIHN0YXR1c01zZyA9IDQ7CiAgICBwdWJs\naWMgc3RhdGljIGZpbmFsIGludCBTVEFUVVNNU0dfRklFTERfTlVNQkVSID0g\nNDsKICAgIHByaXZhdGUgYm9vbGVhbiBoYXNTdGF0dXNNc2c7CiAgICBwcml2\nYXRlIGphdmEubGFuZy5TdHJpbmcgc3RhdHVzTXNnXyA9ICIiOwogICAgcHVi\nbGljIGJvb2xlYW4gaGFzU3RhdHVzTXNnKCkgeyByZXR1cm4gaGFzU3RhdHVz\nTXNnOyB9CiAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRTdGF0dXNN\nc2coKSB7IHJldHVybiBzdGF0dXNNc2dfOyB9CiAgICAKICAgIC8vIG9wdGlv\nbmFsIC5IZWR3aWcuTWVzc2FnZSBtZXNzYWdlID0gNTsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IE1FU1NBR0VfRklFTERfTlVNQkVSID0gNTsKICAg\nIHByaXZhdGUgYm9vbGVhbiBoYXNNZXNzYWdlOwogICAgcHJpdmF0ZSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nIG1lc3NhZ2VfOwogICAgcHVibGljIGJvb2xlYW4gaGFzTWVzc2FnZSgpIHsg\ncmV0dXJuIGhhc01lc3NhZ2U7IH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIGdldE1lc3Nh\nZ2UoKSB7IHJldHVybiBtZXNzYWdlXzsgfQogICAgCiAgICAvLyBvcHRpb25h\nbCBieXRlcyB0b3BpYyA9IDY7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGlu\ndCBUT1BJQ19GSUVMRF9OVU1CRVIgPSA2OwogICAgcHJpdmF0ZSBib29sZWFu\nIGhhc1RvcGljOwogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgdG9waWNfID0gY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3Ry\naW5nLkVNUFRZOwogICAgcHVibGljIGJvb2xlYW4gaGFzVG9waWMoKSB7IHJl\ndHVybiBoYXNUb3BpYzsgfQogICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBnZXRUb3BpYygpIHsgcmV0dXJuIHRvcGljXzsgfQog\nICAgCiAgICAvLyBvcHRpb25hbCBieXRlcyBzdWJzY3JpYmVySWQgPSA3Owog\nICAgcHVibGljIHN0YXRpYyBmaW5hbCBpbnQgU1VCU0NSSUJFUklEX0ZJRUxE\nX05VTUJFUiA9IDc7CiAgICBwcml2YXRlIGJvb2xlYW4gaGFzU3Vic2NyaWJl\ncklkOwogICAgcHJpdmF0ZSBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJp\nbmcgc3Vic2NyaWJlcklkXyA9IGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZy5FTVBUWTsKICAgIHB1YmxpYyBib29sZWFuIGhhc1N1YnNjcmliZXJJ\nZCgpIHsgcmV0dXJuIGhhc1N1YnNjcmliZXJJZDsgfQogICAgcHVibGljIGNv\nbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBnZXRTdWJzY3JpYmVySWQo\nKSB7IHJldHVybiBzdWJzY3JpYmVySWRfOyB9CiAgICAKICAgIHByaXZhdGUg\ndm9pZCBpbml0RmllbGRzKCkgewogICAgICBwcm90b2NvbFZlcnNpb25fID0g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHJv\ndG9jb2xWZXJzaW9uLlZFUlNJT05fT05FOwogICAgICBzdGF0dXNDb2RlXyA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0\nYXR1c0NvZGUuU1VDQ0VTUzsKICAgICAgbWVzc2FnZV8gPSBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmdldERl\nZmF1bHRJbnN0YW5jZSgpOwogICAgfQogICAgcHVibGljIGZpbmFsIGJvb2xl\nYW4gaXNJbml0aWFsaXplZCgpIHsKICAgICAgaWYgKCFoYXNQcm90b2NvbFZl\ncnNpb24pIHJldHVybiBmYWxzZTsKICAgICAgaWYgKCFoYXNTdGF0dXNDb2Rl\nKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghaGFzVHhuSWQpIHJldHVybiBm\nYWxzZTsKICAgICAgaWYgKGhhc01lc3NhZ2UoKSkgewogICAgICAgIGlmICgh\nZ2V0TWVzc2FnZSgpLmlzSW5pdGlhbGl6ZWQoKSkgcmV0dXJuIGZhbHNlOwog\nICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgCiAgICBwdWJs\naWMgdm9pZCB3cml0ZVRvKGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRw\ndXRTdHJlYW0gb3V0cHV0KQogICAgICAgICAgICAgICAgICAgICAgICB0aHJv\nd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIGdldFNlcmlhbGl6ZWRT\naXplKCk7CiAgICAgIGlmIChoYXNQcm90b2NvbFZlcnNpb24oKSkgewogICAg\nICAgIG91dHB1dC53cml0ZUVudW0oMSwgZ2V0UHJvdG9jb2xWZXJzaW9uKCku\nZ2V0TnVtYmVyKCkpOwogICAgICB9CiAgICAgIGlmIChoYXNTdGF0dXNDb2Rl\nKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVFbnVtKDIsIGdldFN0YXR1c0Nv\nZGUoKS5nZXROdW1iZXIoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1R4bklk\nKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVVSW50NjQoMywgZ2V0VHhuSWQo\nKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1N0YXR1c01zZygpKSB7CiAgICAg\nICAgb3V0cHV0LndyaXRlU3RyaW5nKDQsIGdldFN0YXR1c01zZygpKTsKICAg\nICAgfQogICAgICBpZiAoaGFzTWVzc2FnZSgpKSB7CiAgICAgICAgb3V0cHV0\nLndyaXRlTWVzc2FnZSg1LCBnZXRNZXNzYWdlKCkpOwogICAgICB9CiAgICAg\nIGlmIChoYXNUb3BpYygpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMo\nNiwgZ2V0VG9waWMoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1N1YnNjcmli\nZXJJZCgpKSB7CiAgICAgICAgb3V0cHV0LndyaXRlQnl0ZXMoNywgZ2V0U3Vi\nc2NyaWJlcklkKCkpOwogICAgICB9CiAgICAgIGdldFVua25vd25GaWVsZHMo\nKS53cml0ZVRvKG91dHB1dCk7CiAgICB9CiAgICAKICAgIHByaXZhdGUgaW50\nIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSAtMTsKICAgIHB1YmxpYyBpbnQg\nZ2V0U2VyaWFsaXplZFNpemUoKSB7CiAgICAgIGludCBzaXplID0gbWVtb2l6\nZWRTZXJpYWxpemVkU2l6ZTsKICAgICAgaWYgKHNpemUgIT0gLTEpIHJldHVy\nbiBzaXplOwogICAgCiAgICAgIHNpemUgPSAwOwogICAgICBpZiAoaGFzUHJv\ndG9jb2xWZXJzaW9uKCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUu\ncHJvdG9idWYuQ29kZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRl\nRW51bVNpemUoMSwgZ2V0UHJvdG9jb2xWZXJzaW9uKCkuZ2V0TnVtYmVyKCkp\nOwogICAgICB9CiAgICAgIGlmIChoYXNTdGF0dXNDb2RlKCkpIHsKICAgICAg\nICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRTdHJl\nYW0KICAgICAgICAgIC5jb21wdXRlRW51bVNpemUoMiwgZ2V0U3RhdHVzQ29k\nZSgpLmdldE51bWJlcigpKTsKICAgICAgfQogICAgICBpZiAoaGFzVHhuSWQo\nKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVVSW50NjRTaXplKDMs\nIGdldFR4bklkKCkpOwogICAgICB9CiAgICAgIGlmIChoYXNTdGF0dXNNc2co\nKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVTdHJpbmdTaXplKDQs\nIGdldFN0YXR1c01zZygpKTsKICAgICAgfQogICAgICBpZiAoaGFzTWVzc2Fn\nZSgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXpl\nKDUsIGdldE1lc3NhZ2UoKSk7CiAgICAgIH0KICAgICAgaWYgKGhhc1RvcGlj\nKCkpIHsKICAgICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29k\nZWRPdXRwdXRTdHJlYW0KICAgICAgICAgIC5jb21wdXRlQnl0ZXNTaXplKDYs\nIGdldFRvcGljKCkpOwogICAgICB9CiAgICAgIGlmIChoYXNTdWJzY3JpYmVy\nSWQoKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1Zi5D\nb2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVCeXRlc1NpemUo\nNywgZ2V0U3Vic2NyaWJlcklkKCkpOwogICAgICB9CiAgICAgIHNpemUgKz0g\nZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAg\nIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4g\nc2l6ZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25z\nZSBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRl\nU3RyaW5nIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9i\ndWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQYXJzZWQo\nKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcGFyc2VG\ncm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0cmluZyBk\nYXRhLAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVn\naXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93cyBj\nb20uZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRh\ndGEsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2Ug\ncGFyc2VGcm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7\nCiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1\naWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3Bv\nbnNlIHBhcnNlRnJvbSgKICAgICAgICBieXRlW10gZGF0YSwKICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICBy\nZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhLCBleHRlbnNpb25S\nZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9\nCiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIHBhcnNlRnJvbShqYXZh\nLmlvLklucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJn\nZUZyb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMg\nc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLlB1YlN1YlJlc3BvbnNlIHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlv\nLklucHV0U3RyZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0\ndXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcGFyc2VEZWxpbWl0ZWRG\ncm9tKGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIg\nPSBuZXdCdWlsZGVyKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1p\ndGVkRnJvbShpbnB1dCkpIHsKICAgICAgICByZXR1cm4gYnVpbGRlci5idWls\nZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBudWxs\nOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNl\nIHBhcnNlRGVsaW1pdGVkRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWls\nZGVyID0gbmV3QnVpbGRlcigpOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURl\nbGltaXRlZEZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KSkgewogICAg\nICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAgIH0gZWxz\nZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcGFyc2VGcm9tKAogICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSBwYXJzZUZy\nb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElucHV0U3Ry\nZWFtIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5z\naW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQog\nICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIAogICAg\ncHVibGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIoKSB7IHJldHVybiBC\ndWlsZGVyLmNyZWF0ZSgpOyB9CiAgICBwdWJsaWMgQnVpbGRlciBuZXdCdWls\nZGVyRm9yVHlwZSgpIHsgcmV0dXJuIG5ld0J1aWxkZXIoKTsgfQogICAgcHVi\nbGljIHN0YXRpYyBCdWlsZGVyIG5ld0J1aWxkZXIob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcHJv\ndG90eXBlKSB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9t\nKHByb3RvdHlwZSk7CiAgICB9CiAgICBwdWJsaWMgQnVpbGRlciB0b0J1aWxk\nZXIoKSB7IHJldHVybiBuZXdCdWlsZGVyKHRoaXMpOyB9CiAgICAKICAgIHB1\nYmxpYyBzdGF0aWMgZmluYWwgY2xhc3MgQnVpbGRlciBleHRlbmRzCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkJ1aWxk\nZXI8QnVpbGRlcj4gewogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIHJlc3Vs\ndDsKICAgICAgCiAgICAgIC8vIENvbnN0cnVjdCB1c2luZyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25z\nZS5uZXdCdWlsZGVyKCkKICAgICAgcHJpdmF0ZSBCdWlsZGVyKCkge30KICAg\nICAgCiAgICAgIHByaXZhdGUgc3RhdGljIEJ1aWxkZXIgY3JlYXRlKCkgewog\nICAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ldyBCdWlsZGVyKCk7CiAgICAg\nICAgYnVpbGRlci5yZXN1bHQgPSBuZXcgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UoKTsKICAgICAg\nICByZXR1cm4gYnVpbGRlcjsKICAgICAgfQogICAgICAKICAgICAgcHJvdGVj\ndGVkIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLlB1YlN1YlJlc3BvbnNlIGludGVybmFsR2V0UmVzdWx0KCkgewogICAgICAg\nIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIGNsZWFyKCkgewogICAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkg\newogICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgIkNhbm5vdCBjYWxsIGNsZWFyKCkgYWZ0ZXIgYnVpbGQo\nKS4iKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0ID0gbmV3IG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3Bv\nbnNlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAg\nICAgIHB1YmxpYyBCdWlsZGVyIGNsb25lKCkgewogICAgICAgIHJldHVybiBj\ncmVhdGUoKS5tZXJnZUZyb20ocmVzdWx0KTsKICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVz\nY3JpcHRvcgogICAgICAgICAgZ2V0RGVzY3JpcHRvckZvclR5cGUoKSB7CiAg\nICAgICAgcmV0dXJuIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1YlN1YlJlc3BvbnNlLmdldERlc2NyaXB0b3IoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIGdldERlZmF1\nbHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJuIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3Bv\nbnNlLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgICB9CiAgICAgIAogICAg\nICBwdWJsaWMgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICAgIHJl\ndHVybiByZXN1bHQuaXNJbml0aWFsaXplZCgpOwogICAgICB9CiAgICAgIHB1\nYmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5QdWJTdWJSZXNwb25zZSBidWlsZCgpIHsKICAgICAgICBpZiAocmVzdWx0\nICE9IG51bGwgJiYgIWlzSW5pdGlhbGl6ZWQoKSkgewogICAgICAgICAgdGhy\nb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VFeGNlcHRpb24ocmVzdWx0KTsK\nICAgICAgICB9CiAgICAgICAgcmV0dXJuIGJ1aWxkUGFydGlhbCgpOwogICAg\nICB9CiAgICAgIAogICAgICBwcml2YXRlIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIGJ1aWxkUGFy\nc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgaWYgKCFp\nc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlh\nbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICByZXN1bHQpLmFz\nSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQog\nICAgICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlB1YlN1YlJlc3BvbnNlIGJ1aWxkUGFydGlhbCgpIHsKICAg\nICAgICBpZiAocmVzdWx0ID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5l\ndyBJbGxlZ2FsU3RhdGVFeGNlcHRpb24oCiAgICAgICAgICAgICJidWlsZCgp\nIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkIG9uIHRoaXMgQnVpbGRlci4iKTsK\nICAgICAgICB9CiAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2UgcmV0dXJuTWUgPSByZXN1\nbHQ7CiAgICAgICAgcmVzdWx0ID0gbnVsbDsKICAgICAgICByZXR1cm4gcmV0\ndXJuTWU7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBCdWlsZGVyIG1l\ncmdlRnJvbShjb20uZ29vZ2xlLnByb3RvYnVmLk1lc3NhZ2Ugb3RoZXIpIHsK\nICAgICAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZSkgewog\nICAgICAgICAgcmV0dXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVzcG9uc2Upb3RoZXIp\nOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdXBlci5tZXJnZUZyb20o\nb3RoZXIpOwogICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20ob3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3Vi\nUmVzcG9uc2Ugb3RoZXIpIHsKICAgICAgICBpZiAob3RoZXIgPT0gb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVz\ncG9uc2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAg\nICAgIGlmIChvdGhlci5oYXNQcm90b2NvbFZlcnNpb24oKSkgewogICAgICAg\nICAgc2V0UHJvdG9jb2xWZXJzaW9uKG90aGVyLmdldFByb3RvY29sVmVyc2lv\nbigpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc1N0YXR1c0Nv\nZGUoKSkgewogICAgICAgICAgc2V0U3RhdHVzQ29kZShvdGhlci5nZXRTdGF0\ndXNDb2RlKCkpOwogICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzVHhu\nSWQoKSkgewogICAgICAgICAgc2V0VHhuSWQob3RoZXIuZ2V0VHhuSWQoKSk7\nCiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNTdGF0dXNNc2coKSkg\newogICAgICAgICAgc2V0U3RhdHVzTXNnKG90aGVyLmdldFN0YXR1c01zZygp\nKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVyLmhhc01lc3NhZ2UoKSkg\newogICAgICAgICAgbWVyZ2VNZXNzYWdlKG90aGVyLmdldE1lc3NhZ2UoKSk7\nCiAgICAgICAgfQogICAgICAgIGlmIChvdGhlci5oYXNUb3BpYygpKSB7CiAg\nICAgICAgICBzZXRUb3BpYyhvdGhlci5nZXRUb3BpYygpKTsKICAgICAgICB9\nCiAgICAgICAgaWYgKG90aGVyLmhhc1N1YnNjcmliZXJJZCgpKSB7CiAgICAg\nICAgICBzZXRTdWJzY3JpYmVySWQob3RoZXIuZ2V0U3Vic2NyaWJlcklkKCkp\nOwogICAgICAgIH0KICAgICAgICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhv\ndGhlci5nZXRVbmtub3duRmllbGRzKCkpOwogICAgICAgIHJldHVybiB0aGlz\nOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZy\nb20oCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRT\ndHJlYW0gaW5wdXQsCiAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLlVua25vd25GaWVsZFNldC5CdWlsZGVyIHVua25v\nd25GaWVsZHMgPQogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtu\nb3duRmllbGRTZXQubmV3QnVpbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRV\nbmtub3duRmllbGRzKCkpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAg\nICAgICBpbnQgdGFnID0gaW5wdXQucmVhZFRhZygpOwogICAgICAgICAgc3dp\ndGNoICh0YWcpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAg\nIHRoaXMuc2V0VW5rbm93bkZpZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkp\nOwogICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICBkZWZh\ndWx0OiB7CiAgICAgICAgICAgICAgaWYgKCFwYXJzZVVua25vd25GaWVsZChp\nbnB1dCwgdW5rbm93bkZpZWxkcywKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGV4dGVuc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAg\nICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxk\ncy5idWlsZCgpKTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAg\nfQogICAgICAgICAgICBjYXNlIDg6IHsKICAgICAgICAgICAgICBpbnQgcmF3\nVmFsdWUgPSBpbnB1dC5yZWFkRW51bSgpOwogICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29s\nVmVyc2lvbiB2YWx1ZSA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbi52YWx1ZU9mKHJhd1ZhbHVl\nKTsKICAgICAgICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAg\nICAgICAgICAgdW5rbm93bkZpZWxkcy5tZXJnZVZhcmludEZpZWxkKDEsIHJh\nd1ZhbHVlKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAg\nICAgc2V0UHJvdG9jb2xWZXJzaW9uKHZhbHVlKTsKICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgY2FzZSAxNjogewogICAgICAgICAgICAgIGludCByYXdWYWx1ZSA9IGlu\ncHV0LnJlYWRFbnVtKCk7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhdHVzQ29kZSB2YWx1ZSA9\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0\nYXR1c0NvZGUudmFsdWVPZihyYXdWYWx1ZSk7CiAgICAgICAgICAgICAgaWYg\nKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHVua25vd25GaWVs\nZHMubWVyZ2VWYXJpbnRGaWVsZCgyLCByYXdWYWx1ZSk7CiAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNldFN0YXR1c0NvZGUodmFs\ndWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAg\nICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDI0OiB7CiAgICAgICAgICAg\nICAgc2V0VHhuSWQoaW5wdXQucmVhZFVJbnQ2NCgpKTsKICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDM0OiB7\nCiAgICAgICAgICAgICAgc2V0U3RhdHVzTXNnKGlucHV0LnJlYWRTdHJpbmco\nKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgY2FzZSA0MjogewogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UuQnVpbGRlciBz\ndWJCdWlsZGVyID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZS5uZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAg\naWYgKGhhc01lc3NhZ2UoKSkgewogICAgICAgICAgICAgICAgc3ViQnVpbGRl\nci5tZXJnZUZyb20oZ2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgaW5wdXQucmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0\nZW5zaW9uUmVnaXN0cnkpOwogICAgICAgICAgICAgIHNldE1lc3NhZ2Uoc3Vi\nQnVpbGRlci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7\nCiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA1MDogewogICAgICAg\nICAgICAgIHNldFRvcGljKGlucHV0LnJlYWRCeXRlcygpKTsKICAgICAgICAg\nICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNlIDU4\nOiB7CiAgICAgICAgICAgICAgc2V0U3Vic2NyaWJlcklkKGlucHV0LnJlYWRC\neXRlcygpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQog\nICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICAKICAgICAgCiAg\nICAgIC8vIHJlcXVpcmVkIC5IZWR3aWcuUHJvdG9jb2xWZXJzaW9uIHByb3Rv\nY29sVmVyc2lvbiA9IDE7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc1Byb3Rv\nY29sVmVyc2lvbigpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1Byb3Rv\nY29sVmVyc2lvbigpOwogICAgICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90b2NvbFZlcnNp\nb24gZ2V0UHJvdG9jb2xWZXJzaW9uKCkgewogICAgICAgIHJldHVybiByZXN1\nbHQuZ2V0UHJvdG9jb2xWZXJzaW9uKCk7CiAgICAgIH0KICAgICAgcHVibGlj\nIEJ1aWxkZXIgc2V0UHJvdG9jb2xWZXJzaW9uKG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlByb3RvY29sVmVyc2lvbiB2YWx1\nZSkgewogICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0\naHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAg\nICAgICAgcmVzdWx0Lmhhc1Byb3RvY29sVmVyc2lvbiA9IHRydWU7CiAgICAg\nICAgcmVzdWx0LnByb3RvY29sVmVyc2lvbl8gPSB2YWx1ZTsKICAgICAgICBy\nZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVh\nclByb3RvY29sVmVyc2lvbigpIHsKICAgICAgICByZXN1bHQuaGFzUHJvdG9j\nb2xWZXJzaW9uID0gZmFsc2U7CiAgICAgICAgcmVzdWx0LnByb3RvY29sVmVy\nc2lvbl8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5Qcm90b2NvbFZlcnNpb24uVkVSU0lPTl9PTkU7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIHJlcXVpcmVkIC5I\nZWR3aWcuU3RhdHVzQ29kZSBzdGF0dXNDb2RlID0gMjsKICAgICAgcHVibGlj\nIGJvb2xlYW4gaGFzU3RhdHVzQ29kZSgpIHsKICAgICAgICByZXR1cm4gcmVz\ndWx0Lmhhc1N0YXR1c0NvZGUoKTsKICAgICAgfQogICAgICBwdWJsaWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhdHVz\nQ29kZSBnZXRTdGF0dXNDb2RlKCkgewogICAgICAgIHJldHVybiByZXN1bHQu\nZ2V0U3RhdHVzQ29kZSgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIHNldFN0YXR1c0NvZGUob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuU3RhdHVzQ29kZSB2YWx1ZSkgewogICAgICAgIGlmICh2\nYWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgTnVsbFBvaW50\nZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0Lmhhc1N0\nYXR1c0NvZGUgPSB0cnVlOwogICAgICAgIHJlc3VsdC5zdGF0dXNDb2RlXyA9\nIHZhbHVlOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIGNsZWFyU3RhdHVzQ29kZSgpIHsKICAgICAgICByZXN1\nbHQuaGFzU3RhdHVzQ29kZSA9IGZhbHNlOwogICAgICAgIHJlc3VsdC5zdGF0\ndXNDb2RlXyA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLlN0YXR1c0NvZGUuU1VDQ0VTUzsKICAgICAgICByZXR1cm4gdGhp\nczsKICAgICAgfQogICAgICAKICAgICAgLy8gcmVxdWlyZWQgdWludDY0IHR4\nbklkID0gMzsKICAgICAgcHVibGljIGJvb2xlYW4gaGFzVHhuSWQoKSB7CiAg\nICAgICAgcmV0dXJuIHJlc3VsdC5oYXNUeG5JZCgpOwogICAgICB9CiAgICAg\nIHB1YmxpYyBsb25nIGdldFR4bklkKCkgewogICAgICAgIHJldHVybiByZXN1\nbHQuZ2V0VHhuSWQoKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBz\nZXRUeG5JZChsb25nIHZhbHVlKSB7CiAgICAgICAgcmVzdWx0Lmhhc1R4bklk\nID0gdHJ1ZTsKICAgICAgICByZXN1bHQudHhuSWRfID0gdmFsdWU7CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIg\nY2xlYXJUeG5JZCgpIHsKICAgICAgICByZXN1bHQuaGFzVHhuSWQgPSBmYWxz\nZTsKICAgICAgICByZXN1bHQudHhuSWRfID0gMEw7CiAgICAgICAgcmV0dXJu\nIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIG9wdGlvbmFsIHN0cmlu\nZyBzdGF0dXNNc2cgPSA0OwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNTdGF0\ndXNNc2coKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNTdGF0dXNNc2co\nKTsKICAgICAgfQogICAgICBwdWJsaWMgamF2YS5sYW5nLlN0cmluZyBnZXRT\ndGF0dXNNc2coKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5nZXRTdGF0dXNN\nc2coKTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRTdGF0dXNN\nc2coamF2YS5sYW5nLlN0cmluZyB2YWx1ZSkgewogICAgICAgIGlmICh2YWx1\nZSA9PSBudWxsKSB7CiAgICB0aHJvdyBuZXcgTnVsbFBvaW50ZXJFeGNlcHRp\nb24oKTsKICB9CiAgcmVzdWx0Lmhhc1N0YXR1c01zZyA9IHRydWU7CiAgICAg\nICAgcmVzdWx0LnN0YXR1c01zZ18gPSB2YWx1ZTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclN0YXR1\nc01zZygpIHsKICAgICAgICByZXN1bHQuaGFzU3RhdHVzTXNnID0gZmFsc2U7\nCiAgICAgICAgcmVzdWx0LnN0YXR1c01zZ18gPSBnZXREZWZhdWx0SW5zdGFu\nY2UoKS5nZXRTdGF0dXNNc2coKTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICAKICAgICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5NZXNzYWdl\nIG1lc3NhZ2UgPSA1OwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNNZXNzYWdl\nKCkgewogICAgICAgIHJldHVybiByZXN1bHQuaGFzTWVzc2FnZSgpOwogICAg\nICB9CiAgICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5NZXNzYWdlIGdldE1lc3NhZ2UoKSB7CiAgICAgICAg\ncmV0dXJuIHJlc3VsdC5nZXRNZXNzYWdlKCk7CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgc2V0TWVzc2FnZShvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIHZhbHVlKSB7CiAgICAgICAg\naWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgIHRocm93IG5ldyBOdWxs\nUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXN1bHQu\naGFzTWVzc2FnZSA9IHRydWU7CiAgICAgICAgcmVzdWx0Lm1lc3NhZ2VfID0g\ndmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVi\nbGljIEJ1aWxkZXIgc2V0TWVzc2FnZShvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLkJ1aWxkZXIgYnVpbGRlckZv\nclZhbHVlKSB7CiAgICAgICAgcmVzdWx0Lmhhc01lc3NhZ2UgPSB0cnVlOwog\nICAgICAgIHJlc3VsdC5tZXNzYWdlXyA9IGJ1aWxkZXJGb3JWYWx1ZS5idWls\nZCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIHB1Ymxp\nYyBCdWlsZGVyIG1lcmdlTWVzc2FnZShvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlIHZhbHVlKSB7CiAgICAgICAg\naWYgKHJlc3VsdC5oYXNNZXNzYWdlKCkgJiYKICAgICAgICAgICAgcmVzdWx0\nLm1lc3NhZ2VfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLk1lc3NhZ2UuZ2V0RGVmYXVsdEluc3RhbmNlKCkpIHsKICAg\nICAgICAgIHJlc3VsdC5tZXNzYWdlXyA9CiAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2UubmV3\nQnVpbGRlcihyZXN1bHQubWVzc2FnZV8pLm1lcmdlRnJvbSh2YWx1ZSkuYnVp\nbGRQYXJ0aWFsKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc3Vs\ndC5tZXNzYWdlXyA9IHZhbHVlOwogICAgICAgIH0KICAgICAgICByZXN1bHQu\naGFzTWVzc2FnZSA9IHRydWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJNZXNzYWdlKCkgewogICAg\nICAgIHJlc3VsdC5oYXNNZXNzYWdlID0gZmFsc2U7CiAgICAgICAgcmVzdWx0\nLm1lc3NhZ2VfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTWVzc2FnZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAg\nICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAgLy8gb3B0aW9u\nYWwgYnl0ZXMgdG9waWMgPSA2OwogICAgICBwdWJsaWMgYm9vbGVhbiBoYXNU\nb3BpYygpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmhhc1RvcGljKCk7CiAg\nICAgIH0KICAgICAgcHVibGljIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZyBnZXRUb3BpYygpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmdldFRv\ncGljKCk7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0VG9waWMo\nY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIHZhbHVlKSB7CiAgICAg\nICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHRocm93IG5ldyBOdWxsUG9p\nbnRlckV4Y2VwdGlvbigpOwogIH0KICByZXN1bHQuaGFzVG9waWMgPSB0cnVl\nOwogICAgICAgIHJlc3VsdC50b3BpY18gPSB2YWx1ZTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhclRv\ncGljKCkgewogICAgICAgIHJlc3VsdC5oYXNUb3BpYyA9IGZhbHNlOwogICAg\nICAgIHJlc3VsdC50b3BpY18gPSBnZXREZWZhdWx0SW5zdGFuY2UoKS5nZXRU\nb3BpYygpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICAvLyBvcHRpb25hbCBieXRlcyBzdWJzY3JpYmVySWQgPSA3OwogICAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNTdWJzY3JpYmVySWQoKSB7CiAgICAgICAg\ncmV0dXJuIHJlc3VsdC5oYXNTdWJzY3JpYmVySWQoKTsKICAgICAgfQogICAg\nICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGdldFN1\nYnNjcmliZXJJZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmdldFN1YnNj\ncmliZXJJZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIHNldFN1\nYnNjcmliZXJJZChjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmcgdmFs\ndWUpIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgdGhyb3cg\nbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgfQogIHJlc3VsdC5oYXNT\ndWJzY3JpYmVySWQgPSB0cnVlOwogICAgICAgIHJlc3VsdC5zdWJzY3JpYmVy\nSWRfID0gdmFsdWU7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAg\nICAgcHVibGljIEJ1aWxkZXIgY2xlYXJTdWJzY3JpYmVySWQoKSB7CiAgICAg\nICAgcmVzdWx0Lmhhc1N1YnNjcmliZXJJZCA9IGZhbHNlOwogICAgICAgIHJl\nc3VsdC5zdWJzY3JpYmVySWRfID0gZ2V0RGVmYXVsdEluc3RhbmNlKCkuZ2V0\nU3Vic2NyaWJlcklkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWls\nZGVyX3Njb3BlOkhlZHdpZy5QdWJTdWJSZXNwb25zZSkKICAgIH0KICAgIAog\nICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0gbmV3IFB1YlN1\nYlJlc3BvbnNlKHRydWUpOwogICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbEZvcmNlSW5pdCgpOwogICAg\nICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAg\nICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVk\nd2lnLlB1YlN1YlJlc3BvbnNlKQogIH0KICAKICBwdWJsaWMgc3RhdGljIGZp\nbmFsIGNsYXNzIFN1YnNjcmlwdGlvblN0YXRlIGV4dGVuZHMKICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlIHsKICAgIC8vIFVz\nZSBTdWJzY3JpcHRpb25TdGF0ZS5uZXdCdWlsZGVyKCkgdG8gY29uc3RydWN0\nLgogICAgcHJpdmF0ZSBTdWJzY3JpcHRpb25TdGF0ZSgpIHsKICAgICAgaW5p\ndEZpZWxkcygpOwogICAgfQogICAgcHJpdmF0ZSBTdWJzY3JpcHRpb25TdGF0\nZShib29sZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJpdmF0ZSBzdGF0aWMg\nZmluYWwgU3Vic2NyaXB0aW9uU3RhdGUgZGVmYXVsdEluc3RhbmNlOwogICAg\ncHVibGljIHN0YXRpYyBTdWJzY3JpcHRpb25TdGF0ZSBnZXREZWZhdWx0SW5z\ndGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9\nCiAgICAKICAgIHB1YmxpYyBTdWJzY3JpcHRpb25TdGF0ZSBnZXREZWZhdWx0\nSW5zdGFuY2VGb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3Rh\nbmNlOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5n\nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAg\nIGdldERlc2NyaXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX1N1YnNjcmlwdGlvblN0YXRlX2Rlc2NyaXB0b3I7CiAgICB9CiAg\nICAKICAgIHByb3RlY3RlZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRl\nZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxH\nZXRGaWVsZEFjY2Vzc29yVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1N1YnNjcmlwdGlvblN0YXRlX2ZpZWxkQWNjZXNzb3JU\nYWJsZTsKICAgIH0KICAgIAogICAgLy8gcmVxdWlyZWQgLkhlZHdpZy5NZXNz\nYWdlU2VxSWQgbXNnSWQgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5hbCBp\nbnQgTVNHSURfRklFTERfTlVNQkVSID0gMTsKICAgIHByaXZhdGUgYm9vbGVh\nbiBoYXNNc2dJZDsKICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIG1zZ0lkXzsKICAg\nIHB1YmxpYyBib29sZWFuIGhhc01zZ0lkKCkgeyByZXR1cm4gaGFzTXNnSWQ7\nIH0KICAgIHB1YmxpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQgZ2V0TXNnSWQoKSB7IHJldHVybiBt\nc2dJZF87IH0KICAgIAogICAgLy8gb3B0aW9uYWwgdWludDMyIG1lc3NhZ2VC\nb3VuZCA9IDI7CiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGludCBNRVNTQUdF\nQk9VTkRfRklFTERfTlVNQkVSID0gMjsKICAgIHByaXZhdGUgYm9vbGVhbiBo\nYXNNZXNzYWdlQm91bmQ7CiAgICBwcml2YXRlIGludCBtZXNzYWdlQm91bmRf\nID0gMDsKICAgIHB1YmxpYyBib29sZWFuIGhhc01lc3NhZ2VCb3VuZCgpIHsg\ncmV0dXJuIGhhc01lc3NhZ2VCb3VuZDsgfQogICAgcHVibGljIGludCBnZXRN\nZXNzYWdlQm91bmQoKSB7IHJldHVybiBtZXNzYWdlQm91bmRfOyB9CiAgICAK\nICAgIHByaXZhdGUgdm9pZCBpbml0RmllbGRzKCkgewogICAgICBtc2dJZF8g\nPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5N\nZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICB9CiAgICBw\ndWJsaWMgZmluYWwgYm9vbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBp\nZiAoIWhhc01zZ0lkKSByZXR1cm4gZmFsc2U7CiAgICAgIGlmICghZ2V0TXNn\nSWQoKS5pc0luaXRpYWxpemVkKCkpIHJldHVybiBmYWxzZTsKICAgICAgcmV0\ndXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHdyaXRlVG8o\nY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBvdXRwdXQp\nCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAgICAgaWYg\nKGhhc01zZ0lkKCkpIHsKICAgICAgICBvdXRwdXQud3JpdGVNZXNzYWdlKDEs\nIGdldE1zZ0lkKCkpOwogICAgICB9CiAgICAgIGlmIChoYXNNZXNzYWdlQm91\nbmQoKSkgewogICAgICAgIG91dHB1dC53cml0ZVVJbnQzMigyLCBnZXRNZXNz\nYWdlQm91bmQoKSk7CiAgICAgIH0KICAgICAgZ2V0VW5rbm93bkZpZWxkcygp\nLndyaXRlVG8ob3V0cHV0KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSBpbnQg\nbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IC0xOwogICAgcHVibGljIGludCBn\nZXRTZXJpYWxpemVkU2l6ZSgpIHsKICAgICAgaW50IHNpemUgPSBtZW1vaXpl\nZFNlcmlhbGl6ZWRTaXplOwogICAgICBpZiAoc2l6ZSAhPSAtMSkgcmV0dXJu\nIHNpemU7CiAgICAKICAgICAgc2l6ZSA9IDA7CiAgICAgIGlmIChoYXNNc2dJ\nZCgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXpl\nKDEsIGdldE1zZ0lkKCkpOwogICAgICB9CiAgICAgIGlmIChoYXNNZXNzYWdl\nQm91bmQoKSkgewogICAgICAgIHNpemUgKz0gY29tLmdvb2dsZS5wcm90b2J1\nZi5Db2RlZE91dHB1dFN0cmVhbQogICAgICAgICAgLmNvbXB1dGVVSW50MzJT\naXplKDIsIGdldE1lc3NhZ2VCb3VuZCgpKTsKICAgICAgfQogICAgICBzaXpl\nICs9IGdldFVua25vd25GaWVsZHMoKS5nZXRTZXJpYWxpemVkU2l6ZSgpOwog\nICAgICBtZW1vaXplZFNlcmlhbGl6ZWRTaXplID0gc2l6ZTsKICAgICAgcmV0\ndXJuIHNpemU7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uU3RhdGUgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuQnl0ZVN0cmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xl\nLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAg\nICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0\nYXRlIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZGF0YSwKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4\ndGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAg\nICB0aHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xC\ndWZmZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1l\ncmdlRnJvbShkYXRhLCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblN0YXRlIHBhcnNlRnJvbShieXRlW10gZGF0YSkKICAgICAgICB0\naHJvd3MgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZm\nZXJFeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdl\nRnJvbShkYXRhKS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25TdGF0ZSBwYXJzZUZyb20oCiAgICAgICAgYnl0ZVtd\nIGRhdGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25S\nZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dz\nIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhj\nZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20o\nZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWls\nZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25T\ndGF0ZSBwYXJzZUZyb20oamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCkKICAg\nICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgp\nOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBwYXJz\nZUZyb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5J\nT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VG\ncm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAg\nLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblN0YXRlIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklucHV0U3Ry\nZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhjZXB0aW9u\nIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigpOwogICAg\nICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQpKSB7CiAg\nICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBl\nbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAg\ncHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSBwYXJzZURlbGltaXRlZEZy\nb20oCiAgICAgICAgamF2YS5pby5JbnB1dFN0cmVhbSBpbnB1dCwKICAgICAg\nICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBl\neHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIo\nKTsKICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0\nLCBleHRlbnNpb25SZWdpc3RyeSkpIHsKICAgICAgICByZXR1cm4gYnVpbGRl\nci5idWlsZFBhcnNlZCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVy\nbiBudWxsOwogICAgICB9CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlw\ndGlvblN0YXRlIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGph\ndmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigp\nLm1lcmdlRnJvbShpbnB1dCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgcGFyc2VGcm9tKAogICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwK\nICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5\nTGl0ZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAg\nICAgLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0\naWMgQnVpbGRlciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVh\ndGUoKTsgfQogICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUo\nKSB7IHJldHVybiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMg\nQnVpbGRlciBuZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlIHByb3RvdHlwZSkg\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShwcm90b3R5\ncGUpOwogICAgfQogICAgcHVibGljIEJ1aWxkZXIgdG9CdWlsZGVyKCkgeyBy\nZXR1cm4gbmV3QnVpbGRlcih0aGlzKTsgfQogICAgCiAgICBwdWJsaWMgc3Rh\ndGljIGZpbmFsIGNsYXNzIEJ1aWxkZXIgZXh0ZW5kcwogICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5CdWlsZGVyPEJ1aWxk\nZXI+IHsKICAgICAgcHJpdmF0ZSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZSByZXN1bHQ7CiAg\nICAgIAogICAgICAvLyBDb25zdHJ1Y3QgdXNpbmcgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUu\nbmV3QnVpbGRlcigpCiAgICAgIHByaXZhdGUgQnVpbGRlcigpIHt9CiAgICAg\nIAogICAgICBwcml2YXRlIHN0YXRpYyBCdWlsZGVyIGNyZWF0ZSgpIHsKICAg\nICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXcgQnVpbGRlcigpOwogICAgICAg\nIGJ1aWxkZXIucmVzdWx0ID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlKCk7CiAgICAg\nICAgcmV0dXJuIGJ1aWxkZXI7CiAgICAgIH0KICAgICAgCiAgICAgIHByb3Rl\nY3RlZCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25TdGF0ZSBpbnRlcm5hbEdldFJlc3VsdCgpIHsKICAg\nICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIAogICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhcigpIHsKICAgICAgICBpZiAocmVzdWx0ID09IG51\nbGwpIHsKICAgICAgICAgIHRocm93IG5ldyBJbGxlZ2FsU3RhdGVFeGNlcHRp\nb24oCiAgICAgICAgICAgICJDYW5ub3QgY2FsbCBjbGVhcigpIGFmdGVyIGJ1\naWxkKCkuIik7CiAgICAgICAgfQogICAgICAgIHJlc3VsdCA9IG5ldyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3Jp\ncHRpb25TdGF0ZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAgICAgICBy\nZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAgIH0KICAg\nICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0\nb3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JGb3JUeXBl\nKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25TdGF0ZS5nZXREZXNjcmlw\ndG9yKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25T\ndGF0ZSBnZXREZWZhdWx0SW5zdGFuY2VGb3JUeXBlKCkgewogICAgICAgIHJl\ndHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5TdWJzY3JpcHRpb25TdGF0ZS5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXpl\nZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsK\nICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUgYnVpbGQoKSB7\nCiAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsICYmICFpc0luaXRpYWxpemVk\nKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5pdGlhbGl6ZWRNZXNzYWdl\nRXhjZXB0aW9uKHJlc3VsdCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBi\ndWlsZFBhcnRpYWwoKTsKICAgICAgfQogICAgICAKICAgICAgcHJpdmF0ZSBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJz\nY3JpcHRpb25TdGF0ZSBidWlsZFBhcnNlZCgpCiAgICAgICAgICB0aHJvd3Mg\nY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNl\ncHRpb24gewogICAgICAgIGlmICghaXNJbml0aWFsaXplZCgpKSB7CiAgICAg\nICAgICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbigK\nICAgICAgICAgICAgcmVzdWx0KS5hc0ludmFsaWRQcm90b2NvbEJ1ZmZlckV4\nY2VwdGlvbigpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVpbGRQYXJ0\naWFsKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25T\ndGF0ZSBidWlsZFBhcnRpYWwoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBu\ndWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uKAogICAgICAgICAgICAiYnVpbGQoKSBoYXMgYWxyZWFkeSBiZWVuIGNh\nbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7CiAgICAgICAgfQogICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNj\ncmlwdGlvblN0YXRlIHJldHVybk1lID0gcmVzdWx0OwogICAgICAgIHJlc3Vs\ndCA9IG51bGw7CiAgICAgICAgcmV0dXJuIHJldHVybk1lOwogICAgICB9CiAg\nICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oY29tLmdvb2ds\nZS5wcm90b2J1Zi5NZXNzYWdlIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVy\nIGluc3RhbmNlb2Ygb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGUpIHsKICAgICAgICAgIHJldHVy\nbiBtZXJnZUZyb20oKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlKW90aGVyKTsKICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAg\nICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRl\nIG90aGVyKSB7CiAgICAgICAgaWYgKG90aGVyID09IG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRl\nLmdldERlZmF1bHRJbnN0YW5jZSgpKSByZXR1cm4gdGhpczsKICAgICAgICBp\nZiAob3RoZXIuaGFzTXNnSWQoKSkgewogICAgICAgICAgbWVyZ2VNc2dJZChv\ndGhlci5nZXRNc2dJZCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG90aGVy\nLmhhc01lc3NhZ2VCb3VuZCgpKSB7CiAgICAgICAgICBzZXRNZXNzYWdlQm91\nbmQob3RoZXIuZ2V0TWVzc2FnZUJvdW5kKCkpOwogICAgICAgIH0KICAgICAg\nICB0aGlzLm1lcmdlVW5rbm93bkZpZWxkcyhvdGhlci5nZXRVbmtub3duRmll\nbGRzKCkpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZUZyb20oCiAgICAgICAgICBjb20u\nZ29vZ2xlLnByb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAg\nICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0\nZSBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLlVu\na25vd25GaWVsZFNldC5CdWlsZGVyIHVua25vd25GaWVsZHMgPQogICAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQubmV3QnVp\nbGRlcigKICAgICAgICAgICAgdGhpcy5nZXRVbmtub3duRmllbGRzKCkpOwog\nICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBpbnQgdGFnID0gaW5w\ndXQucmVhZFRhZygpOwogICAgICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAg\nICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIHRoaXMuc2V0VW5rbm93bkZp\nZWxkcyh1bmtub3duRmllbGRzLmJ1aWxkKCkpOwogICAgICAgICAgICAgIHJl\ndHVybiB0aGlzOwogICAgICAgICAgICBkZWZhdWx0OiB7CiAgICAgICAgICAg\nICAgaWYgKCFwYXJzZVVua25vd25GaWVsZChpbnB1dCwgdW5rbm93bkZpZWxk\ncywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dGVu\nc2lvblJlZ2lzdHJ5LCB0YWcpKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNl\ndFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAg\nICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXNl\nIDEwOiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxkZXIgc3ViQnVp\nbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCk7CiAgICAgICAgICAgICAg\naWYgKGhhc01zZ0lkKCkpIHsKICAgICAgICAgICAgICAgIHN1YkJ1aWxkZXIu\nbWVyZ2VGcm9tKGdldE1zZ0lkKCkpOwogICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWlsZGVyLCBleHRlbnNp\nb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgc2V0TXNnSWQoc3ViQnVpbGRl\nci5idWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgY2FzZSAxNjogewogICAgICAgICAgICAg\nIHNldE1lc3NhZ2VCb3VuZChpbnB1dC5yZWFkVUludDMyKCkpOwogICAgICAg\nICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAg\nICAgfQogICAgICB9CiAgICAgIAogICAgICAKICAgICAgLy8gcmVxdWlyZWQg\nLkhlZHdpZy5NZXNzYWdlU2VxSWQgbXNnSWQgPSAxOwogICAgICBwdWJsaWMg\nYm9vbGVhbiBoYXNNc2dJZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0Lmhh\nc01zZ0lkKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRN\nc2dJZCgpIHsKICAgICAgICByZXR1cm4gcmVzdWx0LmdldE1zZ0lkKCk7CiAg\nICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0TXNnSWQob3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlk\nIHZhbHVlKSB7CiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAg\nICAgIHRocm93IG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAg\nIH0KICAgICAgICByZXN1bHQuaGFzTXNnSWQgPSB0cnVlOwogICAgICAgIHJl\nc3VsdC5tc2dJZF8gPSB2YWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBzZXRNc2dJZChvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQu\nQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsKICAgICAgICByZXN1bHQuaGFz\nTXNnSWQgPSB0cnVlOwogICAgICAgIHJlc3VsdC5tc2dJZF8gPSBidWlsZGVy\nRm9yVmFsdWUuYnVpbGQoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAg\nfQogICAgICBwdWJsaWMgQnVpbGRlciBtZXJnZU1zZ0lkKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCB2\nYWx1ZSkgewogICAgICAgIGlmIChyZXN1bHQuaGFzTXNnSWQoKSAmJgogICAg\nICAgICAgICByZXN1bHQubXNnSWRfICE9IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5nZXREZWZhdWx0\nSW5zdGFuY2UoKSkgewogICAgICAgICAgcmVzdWx0Lm1zZ0lkXyA9CiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKHJlc3VsdC5tc2dJZF8pLm1l\ncmdlRnJvbSh2YWx1ZSkuYnVpbGRQYXJ0aWFsKCk7CiAgICAgICAgfSBlbHNl\nIHsKICAgICAgICAgIHJlc3VsdC5tc2dJZF8gPSB2YWx1ZTsKICAgICAgICB9\nCiAgICAgICAgcmVzdWx0Lmhhc01zZ0lkID0gdHJ1ZTsKICAgICAgICByZXR1\ncm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhck1z\nZ0lkKCkgewogICAgICAgIHJlc3VsdC5oYXNNc2dJZCA9IGZhbHNlOwogICAg\nICAgIHJlc3VsdC5tc2dJZF8gPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3Rh\nbmNlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAg\nICAgIC8vIG9wdGlvbmFsIHVpbnQzMiBtZXNzYWdlQm91bmQgPSAyOwogICAg\nICBwdWJsaWMgYm9vbGVhbiBoYXNNZXNzYWdlQm91bmQoKSB7CiAgICAgICAg\ncmV0dXJuIHJlc3VsdC5oYXNNZXNzYWdlQm91bmQoKTsKICAgICAgfQogICAg\nICBwdWJsaWMgaW50IGdldE1lc3NhZ2VCb3VuZCgpIHsKICAgICAgICByZXR1\ncm4gcmVzdWx0LmdldE1lc3NhZ2VCb3VuZCgpOwogICAgICB9CiAgICAgIHB1\nYmxpYyBCdWlsZGVyIHNldE1lc3NhZ2VCb3VuZChpbnQgdmFsdWUpIHsKICAg\nICAgICByZXN1bHQuaGFzTWVzc2FnZUJvdW5kID0gdHJ1ZTsKICAgICAgICBy\nZXN1bHQubWVzc2FnZUJvdW5kXyA9IHZhbHVlOwogICAgICAgIHJldHVybiB0\naGlzOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyTWVzc2Fn\nZUJvdW5kKCkgewogICAgICAgIHJlc3VsdC5oYXNNZXNzYWdlQm91bmQgPSBm\nYWxzZTsKICAgICAgICByZXN1bHQubWVzc2FnZUJvdW5kXyA9IDA7CiAgICAg\nICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIEBAcHJv\ndG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3BlOkhlZHdpZy5TdWJz\nY3JpcHRpb25TdGF0ZSkKICAgIH0KICAgIAogICAgc3RhdGljIHsKICAgICAg\nZGVmYXVsdEluc3RhbmNlID0gbmV3IFN1YnNjcmlwdGlvblN0YXRlKHRydWUp\nOwogICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5pbnRlcm5hbEZvcmNlSW5pdCgpOwogICAgICBkZWZhdWx0SW5zdGFu\nY2UuaW5pdEZpZWxkcygpOwogICAgfQogICAgCiAgICAvLyBAQHByb3RvY19p\nbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2NvcGU6SGVkd2lnLlN1YnNjcmlwdGlv\nblN0YXRlKQogIH0KICAKICBwdWJsaWMgc3RhdGljIGZpbmFsIGNsYXNzIExl\nZGdlclJhbmdlIGV4dGVuZHMKICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5H\nZW5lcmF0ZWRNZXNzYWdlIHsKICAgIC8vIFVzZSBMZWRnZXJSYW5nZS5uZXdC\ndWlsZGVyKCkgdG8gY29uc3RydWN0LgogICAgcHJpdmF0ZSBMZWRnZXJSYW5n\nZSgpIHsKICAgICAgaW5pdEZpZWxkcygpOwogICAgfQogICAgcHJpdmF0ZSBM\nZWRnZXJSYW5nZShib29sZWFuIG5vSW5pdCkge30KICAgIAogICAgcHJpdmF0\nZSBzdGF0aWMgZmluYWwgTGVkZ2VyUmFuZ2UgZGVmYXVsdEluc3RhbmNlOwog\nICAgcHVibGljIHN0YXRpYyBMZWRnZXJSYW5nZSBnZXREZWZhdWx0SW5zdGFu\nY2UoKSB7CiAgICAgIHJldHVybiBkZWZhdWx0SW5zdGFuY2U7CiAgICB9CiAg\nICAKICAgIHB1YmxpYyBMZWRnZXJSYW5nZSBnZXREZWZhdWx0SW5zdGFuY2VG\nb3JUeXBlKCkgewogICAgICByZXR1cm4gZGVmYXVsdEluc3RhbmNlOwogICAg\nfQogICAgCiAgICBwdWJsaWMgc3RhdGljIGZpbmFsIGNvbS5nb29nbGUucHJv\ndG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgICAgIGdldERlc2Ny\naXB0b3IoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0xl\nZGdlclJhbmdlX2Rlc2NyaXB0b3I7CiAgICB9CiAgICAKICAgIHByb3RlY3Rl\nZCBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRB\nY2Nlc3NvclRhYmxlCiAgICAgICAgaW50ZXJuYWxHZXRGaWVsZEFjY2Vzc29y\nVGFibGUoKSB7CiAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0xl\nZGdlclJhbmdlX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAgIH0KICAgIAogICAg\nLy8gcmVxdWlyZWQgdWludDY0IGxlZGdlcklkID0gMTsKICAgIHB1YmxpYyBz\ndGF0aWMgZmluYWwgaW50IExFREdFUklEX0ZJRUxEX05VTUJFUiA9IDE7CiAg\nICBwcml2YXRlIGJvb2xlYW4gaGFzTGVkZ2VySWQ7CiAgICBwcml2YXRlIGxv\nbmcgbGVkZ2VySWRfID0gMEw7CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNMZWRn\nZXJJZCgpIHsgcmV0dXJuIGhhc0xlZGdlcklkOyB9CiAgICBwdWJsaWMgbG9u\nZyBnZXRMZWRnZXJJZCgpIHsgcmV0dXJuIGxlZGdlcklkXzsgfQogICAgCiAg\nICAvLyBvcHRpb25hbCAuSGVkd2lnLk1lc3NhZ2VTZXFJZCBlbmRTZXFJZElu\nY2x1ZGVkID0gMjsKICAgIHB1YmxpYyBzdGF0aWMgZmluYWwgaW50IEVORFNF\nUUlESU5DTFVERURfRklFTERfTlVNQkVSID0gMjsKICAgIHByaXZhdGUgYm9v\nbGVhbiBoYXNFbmRTZXFJZEluY2x1ZGVkOwogICAgcHJpdmF0ZSBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2Vx\nSWQgZW5kU2VxSWRJbmNsdWRlZF87CiAgICBwdWJsaWMgYm9vbGVhbiBoYXNF\nbmRTZXFJZEluY2x1ZGVkKCkgeyByZXR1cm4gaGFzRW5kU2VxSWRJbmNsdWRl\nZDsgfQogICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBnZXRFbmRTZXFJZEluY2x1ZGVk\nKCkgeyByZXR1cm4gZW5kU2VxSWRJbmNsdWRlZF87IH0KICAgIAogICAgcHJp\ndmF0ZSB2b2lkIGluaXRGaWVsZHMoKSB7CiAgICAgIGVuZFNlcUlkSW5jbHVk\nZWRfID0gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTWVzc2FnZVNlcUlkLmdldERlZmF1bHRJbnN0YW5jZSgpOwogICAgfQog\nICAgcHVibGljIGZpbmFsIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAg\nICAgaWYgKCFoYXNMZWRnZXJJZCkgcmV0dXJuIGZhbHNlOwogICAgICBpZiAo\naGFzRW5kU2VxSWRJbmNsdWRlZCgpKSB7CiAgICAgICAgaWYgKCFnZXRFbmRT\nZXFJZEluY2x1ZGVkKCkuaXNJbml0aWFsaXplZCgpKSByZXR1cm4gZmFsc2U7\nCiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1\nYmxpYyB2b2lkIHdyaXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91\ndHB1dFN0cmVhbSBvdXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRo\ncm93cyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXpl\nZFNpemUoKTsKICAgICAgaWYgKGhhc0xlZGdlcklkKCkpIHsKICAgICAgICBv\ndXRwdXQud3JpdGVVSW50NjQoMSwgZ2V0TGVkZ2VySWQoKSk7CiAgICAgIH0K\nICAgICAgaWYgKGhhc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAgIG91\ndHB1dC53cml0ZU1lc3NhZ2UoMiwgZ2V0RW5kU2VxSWRJbmNsdWRlZCgpKTsK\nICAgICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhvdXRw\ndXQpOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBtZW1vaXplZFNlcmlh\nbGl6ZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRT\naXplKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNp\nemU7CiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKICAgIAog\nICAgICBzaXplID0gMDsKICAgICAgaWYgKGhhc0xlZGdlcklkKCkpIHsKICAg\nICAgICBzaXplICs9IGNvbS5nb29nbGUucHJvdG9idWYuQ29kZWRPdXRwdXRT\ndHJlYW0KICAgICAgICAgIC5jb21wdXRlVUludDY0U2l6ZSgxLCBnZXRMZWRn\nZXJJZCgpKTsKICAgICAgfQogICAgICBpZiAoaGFzRW5kU2VxSWRJbmNsdWRl\nZCgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnByb3RvYnVmLkNv\nZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1lc3NhZ2VTaXpl\nKDIsIGdldEVuZFNlcUlkSW5jbHVkZWQoKSk7CiAgICAgIH0KICAgICAgc2l6\nZSArPSBnZXRVbmtub3duRmllbGRzKCkuZ2V0U2VyaWFsaXplZFNpemUoKTsK\nICAgICAgbWVtb2l6ZWRTZXJpYWxpemVkU2l6ZSA9IHNpemU7CiAgICAgIHJl\ndHVybiBzaXplOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJh\nbmdlIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5\ndGVTdHJpbmcgZGF0YSkKICAgICAgICB0aHJvd3MgY29tLmdvb2dsZS5wcm90\nb2J1Zi5JbnZhbGlkUHJvdG9jb2xCdWZmZXJFeGNlcHRpb24gewogICAgICBy\nZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShkYXRhKS5idWlsZFBhcnNl\nZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBwYXJzZUZy\nb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRh\ndGEsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdp\nc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNv\nbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0\naW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0\nYSwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBh\ncnNlZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBwYXJz\nZUZyb20oYnl0ZVtdIGRhdGEpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUu\ncHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAg\nICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSkuYnVpbGRQ\nYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgcGFy\nc2VGcm9tKAogICAgICAgIGJ5dGVbXSBkYXRhLAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuRXh0ZW5zaW9uUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJl\nZ2lzdHJ5KQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVmLklu\ndmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBu\nZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEsIGV4dGVuc2lvblJlZ2lzdHJ5\nKQogICAgICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1\nYmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1\ndCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2Vy\nUmFuZ2UgcGFyc2VGcm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0g\naW5wdXQsCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25S\nZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dz\nIGphdmEuaW8uSU9FeGNlcHRpb24gewogICAgICByZXR1cm4gbmV3QnVpbGRl\ncigpLm1lcmdlRnJvbShpbnB1dCwgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAg\nICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGljIHN0\nYXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5MZWRnZXJSYW5nZSBwYXJzZURlbGltaXRlZEZyb20oamF2YS5pby5JbnB1\ndFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2Vw\ndGlvbiB7CiAgICAgIEJ1aWxkZXIgYnVpbGRlciA9IG5ld0J1aWxkZXIoKTsK\nICAgICAgaWYgKGJ1aWxkZXIubWVyZ2VEZWxpbWl0ZWRGcm9tKGlucHV0KSkg\newogICAgICAgIHJldHVybiBidWlsZGVyLmJ1aWxkUGFyc2VkKCk7CiAgICAg\nIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0K\nICAgIHB1YmxpYyBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wu\nUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgcGFyc2VEZWxpbWl0ZWRGcm9t\nKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNl\ncHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVyKCk7\nCiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1dCwg\nZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIu\nYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4g\nbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBh\nY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5n\nZSBwYXJzZUZyb20oCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2Rl\nZElucHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklP\nRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZy\nb20oaW5wdXQpLmJ1aWxkUGFyc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3Rh\ndGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkxlZGdlclJhbmdlIHBhcnNlRnJvbSgKICAgICAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAgICAgY29tLmdv\nb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9u\nUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRpb24g\newogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1dCwg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNl\nZCgpOwogICAgfQogICAgCiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3\nQnVpbGRlcigpIHsgcmV0dXJuIEJ1aWxkZXIuY3JlYXRlKCk7IH0KICAgIHB1\nYmxpYyBCdWlsZGVyIG5ld0J1aWxkZXJGb3JUeXBlKCkgeyByZXR1cm4gbmV3\nQnVpbGRlcigpOyB9CiAgICBwdWJsaWMgc3RhdGljIEJ1aWxkZXIgbmV3QnVp\nbGRlcihvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5MZWRnZXJSYW5nZSBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJuIG5ld0J1\naWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAgIHB1Ymxp\nYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxkZXIodGhp\ncyk7IH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFzcyBCdWls\nZGVyIGV4dGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVy\nYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPiB7CiAgICAgIHByaXZhdGUg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2UgcmVzdWx0OwogICAgICAKICAgICAgLy8gQ29uc3RydWN0IHVz\naW5nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29s\nLkxlZGdlclJhbmdlLm5ld0J1aWxkZXIoKQogICAgICBwcml2YXRlIEJ1aWxk\nZXIoKSB7fQogICAgICAKICAgICAgcHJpdmF0ZSBzdGF0aWMgQnVpbGRlciBj\ncmVhdGUoKSB7CiAgICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3IEJ1aWxk\nZXIoKTsKICAgICAgICBidWlsZGVyLnJlc3VsdCA9IG5ldyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSgp\nOwogICAgICAgIHJldHVybiBidWlsZGVyOwogICAgICB9CiAgICAgIAogICAg\nICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgaW50ZXJuYWxHZXRSZXN1bHQoKSB7CiAg\nICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICAKICAgICAgcHVi\nbGljIEJ1aWxkZXIgY2xlYXIoKSB7CiAgICAgICAgaWYgKHJlc3VsdCA9PSBu\ndWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgSWxsZWdhbFN0YXRlRXhjZXB0\naW9uKAogICAgICAgICAgICAiQ2Fubm90IGNhbGwgY2xlYXIoKSBhZnRlciBi\ndWlsZCgpLiIpOwogICAgICAgIH0KICAgICAgICByZXN1bHQgPSBuZXcgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2Vy\nUmFuZ2UoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAK\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJu\nIGNyZWF0ZSgpLm1lcmdlRnJvbShyZXN1bHQpOwogICAgICB9CiAgICAgIAog\nICAgICBwdWJsaWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5E\nZXNjcmlwdG9yCiAgICAgICAgICBnZXREZXNjcmlwdG9yRm9yVHlwZSgpIHsK\nICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UuZ2V0RGVzY3JpcHRvcigpOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJv\ndG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgZ2V0RGVmYXVsdElu\nc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgICByZXR1cm4gb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UuZ2V0\nRGVmYXVsdEluc3RhbmNlKCk7CiAgICAgIH0KICAgICAgCiAgICAgIHB1Ymxp\nYyBib29sZWFuIGlzSW5pdGlhbGl6ZWQoKSB7CiAgICAgICAgcmV0dXJuIHJl\nc3VsdC5pc0luaXRpYWxpemVkKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlIGJ1aWxkKCkgewogICAgICAgIGlmIChyZXN1bHQgIT0gbnVsbCAm\nJiAhaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAgICB0aHJvdyBuZXdVbmlu\naXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1bHQpOwogICAgICAgIH0K\nICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7CiAgICAgIH0KICAgICAg\nCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgYnVpbGRQYXJzZWQoKQogICAgICAg\nICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29s\nQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgICBpZiAoIWlzSW5pdGlhbGl6ZWQo\nKSkgewogICAgICAgICAgdGhyb3cgbmV3VW5pbml0aWFsaXplZE1lc3NhZ2VF\neGNlcHRpb24oCiAgICAgICAgICAgIHJlc3VsdCkuYXNJbnZhbGlkUHJvdG9j\nb2xCdWZmZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJu\nIGJ1aWxkUGFydGlhbCgpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMg\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVk\nZ2VyUmFuZ2UgYnVpbGRQYXJ0aWFsKCkgewogICAgICAgIGlmIChyZXN1bHQg\nPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxTdGF0ZUV4\nY2VwdGlvbigKICAgICAgICAgICAgImJ1aWxkKCkgaGFzIGFscmVhZHkgYmVl\nbiBjYWxsZWQgb24gdGhpcyBCdWlsZGVyLiIpOwogICAgICAgIH0KICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5M\nZWRnZXJSYW5nZSByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAgICByZXN1bHQg\nPSBudWxsOwogICAgICAgIHJldHVybiByZXR1cm5NZTsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNvbS5nb29nbGUu\ncHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlmIChvdGhlciBp\nbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkxlZGdlclJhbmdlKSB7CiAgICAgICAgICByZXR1cm4gbWVyZ2VG\ncm9tKChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2Nv\nbC5MZWRnZXJSYW5nZSlvdGhlcik7CiAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgIHN1cGVyLm1lcmdlRnJvbShvdGhlcik7CiAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICB9CiAgICAgIH0KICAgICAgCiAgICAgIHB1YmxpYyBC\ndWlsZGVyIG1lcmdlRnJvbShvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZS5nZXREZWZhdWx0SW5zdGFuY2UoKSkgcmV0\ndXJuIHRoaXM7CiAgICAgICAgaWYgKG90aGVyLmhhc0xlZGdlcklkKCkpIHsK\nICAgICAgICAgIHNldExlZGdlcklkKG90aGVyLmdldExlZGdlcklkKCkpOwog\nICAgICAgIH0KICAgICAgICBpZiAob3RoZXIuaGFzRW5kU2VxSWRJbmNsdWRl\nZCgpKSB7CiAgICAgICAgICBtZXJnZUVuZFNlcUlkSW5jbHVkZWQob3RoZXIu\nZ2V0RW5kU2VxSWRJbmNsdWRlZCgpKTsKICAgICAgICB9CiAgICAgICAgdGhp\ncy5tZXJnZVVua25vd25GaWVsZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygp\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAgICAg\ncHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5Db2RlZElucHV0U3RyZWFtIGlucHV0LAogICAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0\nZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4\nY2VwdGlvbiB7CiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3du\nRmllbGRTZXQuQnVpbGRlciB1bmtub3duRmllbGRzID0KICAgICAgICAgIGNv\nbS5nb29nbGUucHJvdG9idWYuVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIo\nCiAgICAgICAgICAgIHRoaXMuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAg\nICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJl\nYWRUYWcoKTsKICAgICAgICAgIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAg\nIGNhc2UgMDoKICAgICAgICAgICAgICB0aGlzLnNldFVua25vd25GaWVsZHMo\ndW5rbm93bkZpZWxkcy5idWlsZCgpKTsKICAgICAgICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgICAgICAgZGVmYXVsdDogewogICAgICAgICAgICAgIGlm\nICghcGFyc2VVbmtub3duRmllbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHRlbnNpb25S\nZWdpc3RyeSwgdGFnKSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtu\nb3duRmllbGRzKHVua25vd25GaWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAg\nICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2FzZSA4OiB7\nCiAgICAgICAgICAgICAgc2V0TGVkZ2VySWQoaW5wdXQucmVhZFVJbnQ2NCgp\nKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAg\nICAgICBjYXNlIDE4OiB7CiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkLkJ1aWxk\nZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCk7CiAgICAg\nICAgICAgICAgaWYgKGhhc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAgICAg\nICAgICAgICAgc3ViQnVpbGRlci5tZXJnZUZyb20oZ2V0RW5kU2VxSWRJbmNs\ndWRlZCgpKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaW5wdXQu\ncmVhZE1lc3NhZ2Uoc3ViQnVpbGRlciwgZXh0ZW5zaW9uUmVnaXN0cnkpOwog\nICAgICAgICAgICAgIHNldEVuZFNlcUlkSW5jbHVkZWQoc3ViQnVpbGRlci5i\ndWlsZFBhcnRpYWwoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgCiAg\nICAgIAogICAgICAvLyByZXF1aXJlZCB1aW50NjQgbGVkZ2VySWQgPSAxOwog\nICAgICBwdWJsaWMgYm9vbGVhbiBoYXNMZWRnZXJJZCgpIHsKICAgICAgICBy\nZXR1cm4gcmVzdWx0Lmhhc0xlZGdlcklkKCk7CiAgICAgIH0KICAgICAgcHVi\nbGljIGxvbmcgZ2V0TGVkZ2VySWQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3Vs\ndC5nZXRMZWRnZXJJZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBCdWlsZGVy\nIHNldExlZGdlcklkKGxvbmcgdmFsdWUpIHsKICAgICAgICByZXN1bHQuaGFz\nTGVkZ2VySWQgPSB0cnVlOwogICAgICAgIHJlc3VsdC5sZWRnZXJJZF8gPSB2\nYWx1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJs\naWMgQnVpbGRlciBjbGVhckxlZGdlcklkKCkgewogICAgICAgIHJlc3VsdC5o\nYXNMZWRnZXJJZCA9IGZhbHNlOwogICAgICAgIHJlc3VsdC5sZWRnZXJJZF8g\nPSAwTDsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICAKICAg\nICAgLy8gb3B0aW9uYWwgLkhlZHdpZy5NZXNzYWdlU2VxSWQgZW5kU2VxSWRJ\nbmNsdWRlZCA9IDI7CiAgICAgIHB1YmxpYyBib29sZWFuIGhhc0VuZFNlcUlk\nSW5jbHVkZWQoKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5oYXNFbmRTZXFJ\nZEluY2x1ZGVkKCk7CiAgICAgIH0KICAgICAgcHVibGljIG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZCBn\nZXRFbmRTZXFJZEluY2x1ZGVkKCkgewogICAgICAgIHJldHVybiByZXN1bHQu\nZ2V0RW5kU2VxSWRJbmNsdWRlZCgpOwogICAgICB9CiAgICAgIHB1YmxpYyBC\ndWlsZGVyIHNldEVuZFNlcUlkSW5jbHVkZWQob3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNlcUlkIHZhbHVlKSB7\nCiAgICAgICAgaWYgKHZhbHVlID09IG51bGwpIHsKICAgICAgICAgIHRocm93\nIG5ldyBOdWxsUG9pbnRlckV4Y2VwdGlvbigpOwogICAgICAgIH0KICAgICAg\nICByZXN1bHQuaGFzRW5kU2VxSWRJbmNsdWRlZCA9IHRydWU7CiAgICAgICAg\ncmVzdWx0LmVuZFNlcUlkSW5jbHVkZWRfID0gdmFsdWU7CiAgICAgICAgcmV0\ndXJuIHRoaXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0RW5k\nU2VxSWRJbmNsdWRlZChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRlciBidWlsZGVyRm9yVmFs\ndWUpIHsKICAgICAgICByZXN1bHQuaGFzRW5kU2VxSWRJbmNsdWRlZCA9IHRy\ndWU7CiAgICAgICAgcmVzdWx0LmVuZFNlcUlkSW5jbHVkZWRfID0gYnVpbGRl\nckZvclZhbHVlLmJ1aWxkKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAg\nIH0KICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VFbmRTZXFJZEluY2x1ZGVk\nKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2VTZXFJZCB2YWx1ZSkgewogICAgICAgIGlmIChyZXN1bHQuaGFzRW5k\nU2VxSWRJbmNsdWRlZCgpICYmCiAgICAgICAgICAgIHJlc3VsdC5lbmRTZXFJ\nZEluY2x1ZGVkXyAhPSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCkp\nIHsKICAgICAgICAgIHJlc3VsdC5lbmRTZXFJZEluY2x1ZGVkXyA9CiAgICAg\nICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKHJlc3VsdC5lbmRTZXFJZElu\nY2x1ZGVkXykubWVyZ2VGcm9tKHZhbHVlKS5idWlsZFBhcnRpYWwoKTsKICAg\nICAgICB9IGVsc2UgewogICAgICAgICAgcmVzdWx0LmVuZFNlcUlkSW5jbHVk\nZWRfID0gdmFsdWU7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5oYXNFbmRT\nZXFJZEluY2x1ZGVkID0gdHJ1ZTsKICAgICAgICByZXR1cm4gdGhpczsKICAg\nICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBjbGVhckVuZFNlcUlkSW5jbHVk\nZWQoKSB7CiAgICAgICAgcmVzdWx0Lmhhc0VuZFNlcUlkSW5jbHVkZWQgPSBm\nYWxzZTsKICAgICAgICByZXN1bHQuZW5kU2VxSWRJbmNsdWRlZF8gPSBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdl\nU2VxSWQuZ2V0RGVmYXVsdEluc3RhbmNlKCk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgCiAgICAgIC8vIEBAcHJvdG9jX2luc2VydGlv\nbl9wb2ludChidWlsZGVyX3Njb3BlOkhlZHdpZy5MZWRnZXJSYW5nZSkKICAg\nIH0KICAgIAogICAgc3RhdGljIHsKICAgICAgZGVmYXVsdEluc3RhbmNlID0g\nbmV3IExlZGdlclJhbmdlKHRydWUpOwogICAgICBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5pbnRlcm5hbEZvcmNlSW5pdCgp\nOwogICAgICBkZWZhdWx0SW5zdGFuY2UuaW5pdEZpZWxkcygpOwogICAgfQog\nICAgCiAgICAvLyBAQHByb3RvY19pbnNlcnRpb25fcG9pbnQoY2xhc3Nfc2Nv\ncGU6SGVkd2lnLkxlZGdlclJhbmdlKQogIH0KICAKICBwdWJsaWMgc3RhdGlj\nIGZpbmFsIGNsYXNzIExlZGdlclJhbmdlcyBleHRlbmRzCiAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZSB7CiAgICAvLyBVc2Ug\nTGVkZ2VyUmFuZ2VzLm5ld0J1aWxkZXIoKSB0byBjb25zdHJ1Y3QuCiAgICBw\ncml2YXRlIExlZGdlclJhbmdlcygpIHsKICAgICAgaW5pdEZpZWxkcygpOwog\nICAgfQogICAgcHJpdmF0ZSBMZWRnZXJSYW5nZXMoYm9vbGVhbiBub0luaXQp\nIHt9CiAgICAKICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIExlZGdlclJhbmdl\ncyBkZWZhdWx0SW5zdGFuY2U7CiAgICBwdWJsaWMgc3RhdGljIExlZGdlclJh\nbmdlcyBnZXREZWZhdWx0SW5zdGFuY2UoKSB7CiAgICAgIHJldHVybiBkZWZh\ndWx0SW5zdGFuY2U7CiAgICB9CiAgICAKICAgIHB1YmxpYyBMZWRnZXJSYW5n\nZXMgZ2V0RGVmYXVsdEluc3RhbmNlRm9yVHlwZSgpIHsKICAgICAgcmV0dXJu\nIGRlZmF1bHRJbnN0YW5jZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRp\nYyBmaW5hbCBjb20uZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2Ny\naXB0b3IKICAgICAgICBnZXREZXNjcmlwdG9yKCkgewogICAgICByZXR1cm4g\nb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZXNfZGVzY3JpcHRvcjsK\nICAgIH0KICAgIAogICAgcHJvdGVjdGVkIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgICBp\nbnRlcm5hbEdldEZpZWxkQWNjZXNzb3JUYWJsZSgpIHsKICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLmlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfTGVkZ2VyUmFuZ2VzX2ZpZWxkQWNjZXNz\nb3JUYWJsZTsKICAgIH0KICAgIAogICAgLy8gcmVwZWF0ZWQgLkhlZHdpZy5M\nZWRnZXJSYW5nZSByYW5nZXMgPSAxOwogICAgcHVibGljIHN0YXRpYyBmaW5h\nbCBpbnQgUkFOR0VTX0ZJRUxEX05VTUJFUiA9IDE7CiAgICBwcml2YXRlIGph\ndmEudXRpbC5MaXN0PG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlPiByYW5nZXNfID0KICAgICAgamF2YS51\ndGlsLkNvbGxlY3Rpb25zLmVtcHR5TGlzdCgpOwogICAgcHVibGljIGphdmEu\ndXRpbC5MaXN0PG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkxlZGdlclJhbmdlPiBnZXRSYW5nZXNMaXN0KCkgewogICAgICBy\nZXR1cm4gcmFuZ2VzXzsKICAgIH0KICAgIHB1YmxpYyBpbnQgZ2V0UmFuZ2Vz\nQ291bnQoKSB7IHJldHVybiByYW5nZXNfLnNpemUoKTsgfQogICAgcHVibGlj\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxl\nZGdlclJhbmdlIGdldFJhbmdlcyhpbnQgaW5kZXgpIHsKICAgICAgcmV0dXJu\nIHJhbmdlc18uZ2V0KGluZGV4KTsKICAgIH0KICAgIAogICAgcHJpdmF0ZSB2\nb2lkIGluaXRGaWVsZHMoKSB7CiAgICB9CiAgICBwdWJsaWMgZmluYWwgYm9v\nbGVhbiBpc0luaXRpYWxpemVkKCkgewogICAgICBmb3IgKG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlIGVs\nZW1lbnQgOiBnZXRSYW5nZXNMaXN0KCkpIHsKICAgICAgICBpZiAoIWVsZW1l\nbnQuaXNJbml0aWFsaXplZCgpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAg\nICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAKICAgIHB1YmxpYyB2b2lkIHdy\naXRlVG8oY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZE91dHB1dFN0cmVhbSBv\ndXRwdXQpCiAgICAgICAgICAgICAgICAgICAgICAgIHRocm93cyBqYXZhLmlv\nLklPRXhjZXB0aW9uIHsKICAgICAgZ2V0U2VyaWFsaXplZFNpemUoKTsKICAg\nICAgZm9yIChvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZSBlbGVtZW50IDogZ2V0UmFuZ2VzTGlzdCgpKSB7\nCiAgICAgICAgb3V0cHV0LndyaXRlTWVzc2FnZSgxLCBlbGVtZW50KTsKICAg\nICAgfQogICAgICBnZXRVbmtub3duRmllbGRzKCkud3JpdGVUbyhvdXRwdXQp\nOwogICAgfQogICAgCiAgICBwcml2YXRlIGludCBtZW1vaXplZFNlcmlhbGl6\nZWRTaXplID0gLTE7CiAgICBwdWJsaWMgaW50IGdldFNlcmlhbGl6ZWRTaXpl\nKCkgewogICAgICBpbnQgc2l6ZSA9IG1lbW9pemVkU2VyaWFsaXplZFNpemU7\nCiAgICAgIGlmIChzaXplICE9IC0xKSByZXR1cm4gc2l6ZTsKICAgIAogICAg\nICBzaXplID0gMDsKICAgICAgZm9yIChvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSBlbGVtZW50IDogZ2V0\nUmFuZ2VzTGlzdCgpKSB7CiAgICAgICAgc2l6ZSArPSBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkNvZGVkT3V0cHV0U3RyZWFtCiAgICAgICAgICAuY29tcHV0ZU1l\nc3NhZ2VTaXplKDEsIGVsZW1lbnQpOwogICAgICB9CiAgICAgIHNpemUgKz0g\nZ2V0VW5rbm93bkZpZWxkcygpLmdldFNlcmlhbGl6ZWRTaXplKCk7CiAgICAg\nIG1lbW9pemVkU2VyaWFsaXplZFNpemUgPSBzaXplOwogICAgICByZXR1cm4g\nc2l6ZTsKICAgIH0KICAgIAogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMg\ncGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuQnl0ZVN0\ncmluZyBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgIHJldHVy\nbiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFyc2VkKCk7\nCiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBwYXJzZUZyb20o\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nIGRhdGEs\nCiAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3Ry\neUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5n\nb29nbGUucHJvdG9idWYuSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9u\nIHsKICAgICAgcmV0dXJuIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNl\nZCgpOwogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VG\ncm9tKGJ5dGVbXSBkYXRhKQogICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAg\nIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGRhdGEpLmJ1aWxkUGFy\nc2VkKCk7CiAgICB9CiAgICBwdWJsaWMgc3RhdGljIG9yZy5hcGFjaGUuaGVk\nd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBwYXJz\nZUZyb20oCiAgICAgICAgYnl0ZVtdIGRhdGEsCiAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVn\naXN0cnkpCiAgICAgICAgdGhyb3dzIGNvbS5nb29nbGUucHJvdG9idWYuSW52\nYWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5l\nd0J1aWxkZXIoKS5tZXJnZUZyb20oZGF0YSwgZXh0ZW5zaW9uUmVnaXN0cnkp\nCiAgICAgICAgICAgICAgIC5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVi\nbGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VGcm9tKGphdmEuaW8uSW5wdXRT\ndHJlYW0gaW5wdXQpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9FeGNlcHRp\nb24gewogICAgICByZXR1cm4gbmV3QnVpbGRlcigpLm1lcmdlRnJvbShpbnB1\ndCkuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBzdGF0aWMgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2Vy\nUmFuZ2VzIHBhcnNlRnJvbSgKICAgICAgICBqYXZhLmlvLklucHV0U3RyZWFt\nIGlucHV0LAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuRXh0ZW5zaW9u\nUmVnaXN0cnlMaXRlIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAgICAgIHRocm93\ncyBqYXZhLmlvLklPRXhjZXB0aW9uIHsKICAgICAgcmV0dXJuIG5ld0J1aWxk\nZXIoKS5tZXJnZUZyb20oaW5wdXQsIGV4dGVuc2lvblJlZ2lzdHJ5KQogICAg\nICAgICAgICAgICAuYnVpbGRQYXJzZWQoKTsKICAgIH0KICAgIHB1YmxpYyBz\ndGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTGVkZ2VyUmFuZ2VzIHBhcnNlRGVsaW1pdGVkRnJvbShqYXZhLmlvLklu\ncHV0U3RyZWFtIGlucHV0KQogICAgICAgIHRocm93cyBqYXZhLmlvLklPRXhj\nZXB0aW9uIHsKICAgICAgQnVpbGRlciBidWlsZGVyID0gbmV3QnVpbGRlcigp\nOwogICAgICBpZiAoYnVpbGRlci5tZXJnZURlbGltaXRlZEZyb20oaW5wdXQp\nKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxkZXIuYnVpbGRQYXJzZWQoKTsKICAg\nICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAg\nfQogICAgcHVibGljIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VEZWxpbWl0ZWRG\ncm9tKAogICAgICAgIGphdmEuaW8uSW5wdXRTdHJlYW0gaW5wdXQsCiAgICAg\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeUxpdGUg\nZXh0ZW5zaW9uUmVnaXN0cnkpCiAgICAgICAgdGhyb3dzIGphdmEuaW8uSU9F\neGNlcHRpb24gewogICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBuZXdCdWlsZGVy\nKCk7CiAgICAgIGlmIChidWlsZGVyLm1lcmdlRGVsaW1pdGVkRnJvbShpbnB1\ndCwgZXh0ZW5zaW9uUmVnaXN0cnkpKSB7CiAgICAgICAgcmV0dXJuIGJ1aWxk\nZXIuYnVpbGRQYXJzZWQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1\ncm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcHVibGljIHN0YXRpYyBvcmcu\nYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJS\nYW5nZXMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCkKICAgICAgICB0aHJvd3MgamF2YS5p\nby5JT0V4Y2VwdGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVy\nZ2VGcm9tKGlucHV0KS5idWlsZFBhcnNlZCgpOwogICAgfQogICAgcHVibGlj\nIHN0YXRpYyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90\nb2NvbC5MZWRnZXJSYW5nZXMgcGFyc2VGcm9tKAogICAgICAgIGNvbS5nb29n\nbGUucHJvdG9idWYuQ29kZWRJbnB1dFN0cmVhbSBpbnB1dCwKICAgICAgICBj\nb20uZ29vZ2xlLnByb3RvYnVmLkV4dGVuc2lvblJlZ2lzdHJ5TGl0ZSBleHRl\nbnNpb25SZWdpc3RyeSkKICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2Vw\ndGlvbiB7CiAgICAgIHJldHVybiBuZXdCdWlsZGVyKCkubWVyZ2VGcm9tKGlu\ncHV0LCBleHRlbnNpb25SZWdpc3RyeSkKICAgICAgICAgICAgICAgLmJ1aWxk\nUGFyc2VkKCk7CiAgICB9CiAgICAKICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRl\nciBuZXdCdWlsZGVyKCkgeyByZXR1cm4gQnVpbGRlci5jcmVhdGUoKTsgfQog\nICAgcHVibGljIEJ1aWxkZXIgbmV3QnVpbGRlckZvclR5cGUoKSB7IHJldHVy\nbiBuZXdCdWlsZGVyKCk7IH0KICAgIHB1YmxpYyBzdGF0aWMgQnVpbGRlciBu\nZXdCdWlsZGVyKG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkxlZGdlclJhbmdlcyBwcm90b3R5cGUpIHsKICAgICAgcmV0dXJu\nIG5ld0J1aWxkZXIoKS5tZXJnZUZyb20ocHJvdG90eXBlKTsKICAgIH0KICAg\nIHB1YmxpYyBCdWlsZGVyIHRvQnVpbGRlcigpIHsgcmV0dXJuIG5ld0J1aWxk\nZXIodGhpcyk7IH0KICAgIAogICAgcHVibGljIHN0YXRpYyBmaW5hbCBjbGFz\ncyBCdWlsZGVyIGV4dGVuZHMKICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVm\nLkdlbmVyYXRlZE1lc3NhZ2UuQnVpbGRlcjxCdWlsZGVyPiB7CiAgICAgIHBy\naXZhdGUgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9j\nb2wuTGVkZ2VyUmFuZ2VzIHJlc3VsdDsKICAgICAgCiAgICAgIC8vIENvbnN0\ncnVjdCB1c2luZyBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZXMubmV3QnVpbGRlcigpCiAgICAgIHByaXZh\ndGUgQnVpbGRlcigpIHt9CiAgICAgIAogICAgICBwcml2YXRlIHN0YXRpYyBC\ndWlsZGVyIGNyZWF0ZSgpIHsKICAgICAgICBCdWlsZGVyIGJ1aWxkZXIgPSBu\nZXcgQnVpbGRlcigpOwogICAgICAgIGJ1aWxkZXIucmVzdWx0ID0gbmV3IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlcygpOwogICAgICAgIHJldHVybiBidWlsZGVyOwogICAgICB9CiAg\nICAgIAogICAgICBwcm90ZWN0ZWQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9j\nb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzIGludGVybmFsR2V0UmVz\ndWx0KCkgewogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgIH0KICAgICAg\nCiAgICAgIHB1YmxpYyBCdWlsZGVyIGNsZWFyKCkgewogICAgICAgIGlmIChy\nZXN1bHQgPT0gbnVsbCkgewogICAgICAgICAgdGhyb3cgbmV3IElsbGVnYWxT\ndGF0ZUV4Y2VwdGlvbigKICAgICAgICAgICAgIkNhbm5vdCBjYWxsIGNsZWFy\nKCkgYWZ0ZXIgYnVpbGQoKS4iKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0\nID0gbmV3IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLkxlZGdlclJhbmdlcygpOwogICAgICAgIHJldHVybiB0aGlzOwogICAg\nICB9CiAgICAgIAogICAgICBwdWJsaWMgQnVpbGRlciBjbG9uZSgpIHsKICAg\nICAgICByZXR1cm4gY3JlYXRlKCkubWVyZ2VGcm9tKHJlc3VsdCk7CiAgICAg\nIH0KICAgICAgCiAgICAgIHB1YmxpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgICAgICAgIGdldERlc2NyaXB0b3JG\nb3JUeXBlKCkgewogICAgICAgIHJldHVybiBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMuZ2V0RGVzY3Jp\ncHRvcigpOwogICAgICB9CiAgICAgIAogICAgICBwdWJsaWMgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Vz\nIGdldERlZmF1bHRJbnN0YW5jZUZvclR5cGUoKSB7CiAgICAgICAgcmV0dXJu\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxl\nZGdlclJhbmdlcy5nZXREZWZhdWx0SW5zdGFuY2UoKTsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIGJvb2xlYW4gaXNJbml0aWFsaXplZCgpIHsKICAg\nICAgICByZXR1cm4gcmVzdWx0LmlzSW5pdGlhbGl6ZWQoKTsKICAgICAgfQog\nICAgICBwdWJsaWMgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzIGJ1aWxkKCkgewogICAgICAgIGlmIChy\nZXN1bHQgIT0gbnVsbCAmJiAhaXNJbml0aWFsaXplZCgpKSB7CiAgICAgICAg\nICB0aHJvdyBuZXdVbmluaXRpYWxpemVkTWVzc2FnZUV4Y2VwdGlvbihyZXN1\nbHQpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gYnVpbGRQYXJ0aWFsKCk7\nCiAgICAgIH0KICAgICAgCiAgICAgIHByaXZhdGUgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzIGJ1aWxk\nUGFyc2VkKCkKICAgICAgICAgIHRocm93cyBjb20uZ29vZ2xlLnByb3RvYnVm\nLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKCFpc0luaXRpYWxpemVkKCkpIHsKICAgICAgICAgIHRocm93IG5ld1VuaW5p\ndGlhbGl6ZWRNZXNzYWdlRXhjZXB0aW9uKAogICAgICAgICAgICByZXN1bHQp\nLmFzSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uKCk7CiAgICAgICAg\nfQogICAgICAgIHJldHVybiBidWlsZFBhcnRpYWwoKTsKICAgICAgfQogICAg\nICAKICAgICAgcHVibGljIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBidWlsZFBhcnRpYWwoKSB7CiAg\nICAgICAgaWYgKHJlc3VsdCA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBu\nZXcgSWxsZWdhbFN0YXRlRXhjZXB0aW9uKAogICAgICAgICAgICAiYnVpbGQo\nKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCBvbiB0aGlzIEJ1aWxkZXIuIik7\nCiAgICAgICAgfQogICAgICAgIGlmIChyZXN1bHQucmFuZ2VzXyAhPSBqYXZh\nLnV0aWwuQ29sbGVjdGlvbnMuRU1QVFlfTElTVCkgewogICAgICAgICAgcmVz\ndWx0LnJhbmdlc18gPQogICAgICAgICAgICBqYXZhLnV0aWwuQ29sbGVjdGlv\nbnMudW5tb2RpZmlhYmxlTGlzdChyZXN1bHQucmFuZ2VzXyk7CiAgICAgICAg\nfQogICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLkxlZGdlclJhbmdlcyByZXR1cm5NZSA9IHJlc3VsdDsKICAgICAg\nICByZXN1bHQgPSBudWxsOwogICAgICAgIHJldHVybiByZXR1cm5NZTsKICAg\nICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKGNv\nbS5nb29nbGUucHJvdG9idWYuTWVzc2FnZSBvdGhlcikgewogICAgICAgIGlm\nIChvdGhlciBpbnN0YW5jZW9mIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcykgewogICAgICAgICAgcmV0\ndXJuIG1lcmdlRnJvbSgob3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHVi\nU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzKW90aGVyKTsKICAgICAgICB9IGVs\nc2UgewogICAgICAgICAgc3VwZXIubWVyZ2VGcm9tKG90aGVyKTsKICAgICAg\nICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgfQogICAgICAKICAg\nICAgcHVibGljIEJ1aWxkZXIgbWVyZ2VGcm9tKG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlcyBvdGhlcikg\newogICAgICAgIGlmIChvdGhlciA9PSBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZXMuZ2V0RGVmYXVsdElu\nc3RhbmNlKCkpIHJldHVybiB0aGlzOwogICAgICAgIGlmICghb3RoZXIucmFu\nZ2VzXy5pc0VtcHR5KCkpIHsKICAgICAgICAgIGlmIChyZXN1bHQucmFuZ2Vz\nXy5pc0VtcHR5KCkpIHsKICAgICAgICAgICAgcmVzdWx0LnJhbmdlc18gPSBu\nZXcgamF2YS51dGlsLkFycmF5TGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZT4oKTsKICAgICAgICAg\nIH0KICAgICAgICAgIHJlc3VsdC5yYW5nZXNfLmFkZEFsbChvdGhlci5yYW5n\nZXNfKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5tZXJnZVVua25vd25GaWVs\nZHMob3RoZXIuZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICByZXR1cm4g\ndGhpczsKICAgICAgfQogICAgICAKICAgICAgcHVibGljIEJ1aWxkZXIgbWVy\nZ2VGcm9tKAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5Db2RlZElu\ncHV0U3RyZWFtIGlucHV0LAogICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1\nZi5FeHRlbnNpb25SZWdpc3RyeUxpdGUgZXh0ZW5zaW9uUmVnaXN0cnkpCiAg\nICAgICAgICB0aHJvd3MgamF2YS5pby5JT0V4Y2VwdGlvbiB7CiAgICAgICAg\nY29tLmdvb2dsZS5wcm90b2J1Zi5Vbmtub3duRmllbGRTZXQuQnVpbGRlciB1\nbmtub3duRmllbGRzID0KICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nVW5rbm93bkZpZWxkU2V0Lm5ld0J1aWxkZXIoCiAgICAgICAgICAgIHRoaXMu\nZ2V0VW5rbm93bkZpZWxkcygpKTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewog\nICAgICAgICAgaW50IHRhZyA9IGlucHV0LnJlYWRUYWcoKTsKICAgICAgICAg\nIHN3aXRjaCAodGFnKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAg\nICAgICB0aGlzLnNldFVua25vd25GaWVsZHModW5rbm93bkZpZWxkcy5idWls\nZCgpKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAg\nZGVmYXVsdDogewogICAgICAgICAgICAgIGlmICghcGFyc2VVbmtub3duRmll\nbGQoaW5wdXQsIHVua25vd25GaWVsZHMsCiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBleHRlbnNpb25SZWdpc3RyeSwgdGFnKSkgewog\nICAgICAgICAgICAgICAgdGhpcy5zZXRVbmtub3duRmllbGRzKHVua25vd25G\naWVsZHMuYnVpbGQoKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsK\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAg\nICAgIH0KICAgICAgICAgICAgY2FzZSAxMDogewogICAgICAgICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlLkJ1aWxkZXIgc3ViQnVpbGRlciA9IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlLm5ld0J1aWxk\nZXIoKTsKICAgICAgICAgICAgICBpbnB1dC5yZWFkTWVzc2FnZShzdWJCdWls\nZGVyLCBleHRlbnNpb25SZWdpc3RyeSk7CiAgICAgICAgICAgICAgYWRkUmFu\nZ2VzKHN1YkJ1aWxkZXIuYnVpbGRQYXJ0aWFsKCkpOwogICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQog\nICAgICB9CiAgICAgIAogICAgICAKICAgICAgLy8gcmVwZWF0ZWQgLkhlZHdp\nZy5MZWRnZXJSYW5nZSByYW5nZXMgPSAxOwogICAgICBwdWJsaWMgamF2YS51\ndGlsLkxpc3Q8b3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTGVkZ2VyUmFuZ2U+IGdldFJhbmdlc0xpc3QoKSB7CiAgICAgICAg\ncmV0dXJuIGphdmEudXRpbC5Db2xsZWN0aW9ucy51bm1vZGlmaWFibGVMaXN0\nKHJlc3VsdC5yYW5nZXNfKTsKICAgICAgfQogICAgICBwdWJsaWMgaW50IGdl\ndFJhbmdlc0NvdW50KCkgewogICAgICAgIHJldHVybiByZXN1bHQuZ2V0UmFu\nZ2VzQ291bnQoKTsKICAgICAgfQogICAgICBwdWJsaWMgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgZ2V0\nUmFuZ2VzKGludCBpbmRleCkgewogICAgICAgIHJldHVybiByZXN1bHQuZ2V0\nUmFuZ2VzKGluZGV4KTsKICAgICAgfQogICAgICBwdWJsaWMgQnVpbGRlciBz\nZXRSYW5nZXMoaW50IGluZGV4LCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZSB2YWx1ZSkgewogICAgICAg\nIGlmICh2YWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICB0aHJvdyBuZXcgTnVs\nbFBvaW50ZXJFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0\nLnJhbmdlc18uc2V0KGluZGV4LCB2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRo\naXM7CiAgICAgIH0KICAgICAgcHVibGljIEJ1aWxkZXIgc2V0UmFuZ2VzKGlu\ndCBpbmRleCwgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTGVkZ2VyUmFuZ2UuQnVpbGRlciBidWlsZGVyRm9yVmFsdWUpIHsK\nICAgICAgICByZXN1bHQucmFuZ2VzXy5zZXQoaW5kZXgsIGJ1aWxkZXJGb3JW\nYWx1ZS5idWlsZCgpKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQog\nICAgICBwdWJsaWMgQnVpbGRlciBhZGRSYW5nZXMob3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2UgdmFsdWUp\nIHsKICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgdGhy\nb3cgbmV3IE51bGxQb2ludGVyRXhjZXB0aW9uKCk7CiAgICAgICAgfQogICAg\nICAgIGlmIChyZXN1bHQucmFuZ2VzXy5pc0VtcHR5KCkpIHsKICAgICAgICAg\nIHJlc3VsdC5yYW5nZXNfID0gbmV3IGphdmEudXRpbC5BcnJheUxpc3Q8b3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2Vy\nUmFuZ2U+KCk7CiAgICAgICAgfQogICAgICAgIHJlc3VsdC5yYW5nZXNfLmFk\nZCh2YWx1ZSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAg\ncHVibGljIEJ1aWxkZXIgYWRkUmFuZ2VzKG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlLkJ1aWxkZXIgYnVp\nbGRlckZvclZhbHVlKSB7CiAgICAgICAgaWYgKHJlc3VsdC5yYW5nZXNfLmlz\nRW1wdHkoKSkgewogICAgICAgICAgcmVzdWx0LnJhbmdlc18gPSBuZXcgamF2\nYS51dGlsLkFycmF5TGlzdDxvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZT4oKTsKICAgICAgICB9CiAgICAg\nICAgcmVzdWx0LnJhbmdlc18uYWRkKGJ1aWxkZXJGb3JWYWx1ZS5idWlsZCgp\nKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgICBwdWJsaWMg\nQnVpbGRlciBhZGRBbGxSYW5nZXMoCiAgICAgICAgICBqYXZhLmxhbmcuSXRl\ncmFibGU8PyBleHRlbmRzIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLkxlZGdlclJhbmdlPiB2YWx1ZXMpIHsKICAgICAgICBp\nZiAocmVzdWx0LnJhbmdlc18uaXNFbXB0eSgpKSB7CiAgICAgICAgICByZXN1\nbHQucmFuZ2VzXyA9IG5ldyBqYXZhLnV0aWwuQXJyYXlMaXN0PG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdl\nPigpOwogICAgICAgIH0KICAgICAgICBzdXBlci5hZGRBbGwodmFsdWVzLCBy\nZXN1bHQucmFuZ2VzXyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0K\nICAgICAgcHVibGljIEJ1aWxkZXIgY2xlYXJSYW5nZXMoKSB7CiAgICAgICAg\ncmVzdWx0LnJhbmdlc18gPSBqYXZhLnV0aWwuQ29sbGVjdGlvbnMuZW1wdHlM\naXN0KCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgCiAg\nICAgIC8vIEBAcHJvdG9jX2luc2VydGlvbl9wb2ludChidWlsZGVyX3Njb3Bl\nOkhlZHdpZy5MZWRnZXJSYW5nZXMpCiAgICB9CiAgICAKICAgIHN0YXRpYyB7\nCiAgICAgIGRlZmF1bHRJbnN0YW5jZSA9IG5ldyBMZWRnZXJSYW5nZXModHJ1\nZSk7CiAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlBy\nb3RvY29sLmludGVybmFsRm9yY2VJbml0KCk7CiAgICAgIGRlZmF1bHRJbnN0\nYW5jZS5pbml0RmllbGRzKCk7CiAgICB9CiAgICAKICAgIC8vIEBAcHJvdG9j\nX2luc2VydGlvbl9wb2ludChjbGFzc19zY29wZTpIZWR3aWcuTGVkZ2VyUmFu\nZ2VzKQogIH0KICAKICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRp\nY19IZWR3aWdfTWVzc2FnZV9kZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGlj\nCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmll\nbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdf\nTWVzc2FnZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMg\nY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAg\nICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1JlZ2lvblNwZWNpZmljU2VxSWRf\nZGVzY3JpcHRvcjsKICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2dsZS5w\ncm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQog\nICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1JlZ2lvblNwZWNpZmljU2Vx\nSWRfZmllbGRBY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3RhdGljIGNvbS5n\nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNzYWdlU2VxSWRfZGVzY3JpcHRvcjsK\nICBwcml2YXRlIHN0YXRpYwogICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5l\ncmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZQogICAgICBpbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VTZXFJZF9maWVsZEFjY2Vzc29yVGFi\nbGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNj\ncmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1B1YlN1YlJlcXVlc3RfZGVzY3JpcHRvcjsKICBwcml2YXRlIHN0YXRpYwog\nICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxk\nQWNjZXNzb3JUYWJsZQogICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1\nYlN1YlJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3Rh\ndGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRv\ncgogICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVzdF9k\nZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnBy\nb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAg\nICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHVibGlzaFJlcXVlc3RfZmll\nbGRBY2Nlc3NvclRhYmxlOwogIHByaXZhdGUgc3RhdGljIGNvbS5nb29nbGUu\ncHJvdG9idWYuRGVzY3JpcHRvcnMuRGVzY3JpcHRvcgogICAgaW50ZXJuYWxf\nc3RhdGljX0hlZHdpZ19TdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAg\ncHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxf\nc3RhdGljX0hlZHdpZ19TdWJzY3JpYmVSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JU\nYWJsZTsKICBwcml2YXRlIHN0YXRpYyBjb20uZ29vZ2xlLnByb3RvYnVmLkRl\nc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfU3Vic2NyaXB0aW9uT3B0aW9uc19kZXNjcmlwdG9yOwogIHByaXZhdGUg\nc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1lc3Nh\nZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRpY19I\nZWR3aWdfU3Vic2NyaXB0aW9uT3B0aW9uc19maWVsZEFjY2Vzc29yVGFibGU7\nCiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlw\ndG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0Nv\nbnN1bWVSZXF1ZXN0X2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19Db25z\ndW1lUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0\naWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9y\nCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1Vuc3Vic2NyaWJlUmVxdWVz\ndF9kZXNjcmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29vZ2xl\nLnByb3RvYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxl\nCiAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfVW5zdWJzY3JpYmVSZXF1\nZXN0X2ZpZWxkQWNjZXNzb3JUYWJsZTsKICBwcml2YXRlIHN0YXRpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkRlc2NyaXB0b3IKICAgIGlu\ndGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2ZXJ5UmVxdWVzdF9kZXNj\ncmlwdG9yOwogIHByaXZhdGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3Rv\nYnVmLkdlbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2ZXJ5UmVxdWVzdF9m\naWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5h\nbF9zdGF0aWNfSGVkd2lnX1N0YXJ0RGVsaXZlcnlSZXF1ZXN0X2Rlc2NyaXB0\nb3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYu\nR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50\nZXJuYWxfc3RhdGljX0hlZHdpZ19TdGFydERlbGl2ZXJ5UmVxdWVzdF9maWVs\nZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5w\ncm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1B1YlN1YlJlc3BvbnNlX2Rlc2NyaXB0b3I7CiAgcHJp\ndmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVk\nTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3Rh\ndGljX0hlZHdpZ19QdWJTdWJSZXNwb25zZV9maWVsZEFjY2Vzc29yVGFibGU7\nCiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlw\ndG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1\nYnNjcmlwdGlvblN0YXRlX2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMK\nICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVs\nZEFjY2Vzc29yVGFibGUKICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19T\ndWJzY3JpcHRpb25TdGF0ZV9maWVsZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0\nZSBzdGF0aWMgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNj\ncmlwdG9yCiAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX0xlZGdlclJhbmdl\nX2Rlc2NyaXB0b3I7CiAgcHJpdmF0ZSBzdGF0aWMKICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUK\nICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZV9maWVs\nZEFjY2Vzc29yVGFibGU7CiAgcHJpdmF0ZSBzdGF0aWMgY29tLmdvb2dsZS5w\ncm90b2J1Zi5EZXNjcmlwdG9ycy5EZXNjcmlwdG9yCiAgICBpbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX0xlZGdlclJhbmdlc19kZXNjcmlwdG9yOwogIHByaXZh\ndGUgc3RhdGljCiAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlCiAgICAgIGludGVybmFsX3N0YXRp\nY19IZWR3aWdfTGVkZ2VyUmFuZ2VzX2ZpZWxkQWNjZXNzb3JUYWJsZTsKICAK\nICBwdWJsaWMgc3RhdGljIGNvbS5nb29nbGUucHJvdG9idWYuRGVzY3JpcHRv\ncnMuRmlsZURlc2NyaXB0b3IKICAgICAgZ2V0RGVzY3JpcHRvcigpIHsKICAg\nIHJldHVybiBkZXNjcmlwdG9yOwogIH0KICBwcml2YXRlIHN0YXRpYyBjb20u\nZ29vZ2xlLnByb3RvYnVmLkRlc2NyaXB0b3JzLkZpbGVEZXNjcmlwdG9yCiAg\nICAgIGRlc2NyaXB0b3I7CiAgc3RhdGljIHsKICAgIGphdmEubGFuZy5TdHJp\nbmdbXSBkZXNjcmlwdG9yRGF0YSA9IHsKICAgICAgIlxuJnNyYy9tYWluL3By\nb3RvYnVmL1B1YlN1YlByb3RvY29sLnByb3RvIiArCiAgICAgICJcMDIyXDAw\nNkhlZHdpZ1wiT1xuXDAwN01lc3NhZ2VcMDIyXDAxNFxuXDAwNGJvZHlcMDMw\nXDAwMSBcMDAyKFwwMTRcMDIyXDAyMVxuXHRzcmMiICsKICAgICAgIlJlZ2lv\nblwwMzBcMDAyIFwwMDEoXDAxNFwwMjIjXG5cMDA1bXNnSWRcMDMwXDAwMyBc\nMDAxKFwwMTMyXDAyNC5IZWR3aWcuTWVzIiArCiAgICAgICJzYWdlU2VxSWRc\nIjRcblwwMjNSZWdpb25TcGVjaWZpY1NlcUlkXDAyMlwwMTZcblwwMDZyZWdp\nIiArCiAgICAgICJvblwwMzBcMDAxIFwwMDIoXDAxNFwwMjJcclxuXDAwNXNl\ncUlkXDAzMFwwMDIgXDAwMihcMDA0XCJdXG5cMDE0TWVzc2FnZVNlcUlkXDAy\nMiIgKwogICAgICAiXDAyNlxuXDAxNmxvY2FsQ29tcG9uZW50XDAzMFwwMDEg\nXDAwMShcMDA0XDAyMjVcblwwMjByZW1vdGVDb21wb25lIiArCiAgICAgICJu\ndHNcMDMwXDAwMiBcMDAzKFwwMTMyXDAzMy5IZWR3aWcuUmVnaW9uU3BlY2lm\naWNTZXFJZFwiXDM2MSIgKwogICAgICAiXDAwM1xuXHJQdWJTdWJSZXF1ZXN0\nXDAyMjBcblwwMTdwcm90b2NvbFZlcnNpb25cMDMwXDAwMSBcMDAyKCIgKwog\nICAgICAiXDAxNjJcMDI3LkhlZHdpZy5Qcm90b2NvbFZlcnNpb25cMDIyI1xu\nXDAwNHR5cGVcMDMwXDAwMiBcMDAyKFwwMTYiICsKICAgICAgIjJcMDI1Lkhl\nZHdpZy5PcGVyYXRpb25UeXBlXDAyMlwwMjRcblwwMTR0cmllZFNlcnZlcnNc\nMDMwIiwKICAgICAgIlwwMDMgXDAwMyhcMDE0XDAyMlxyXG5cMDA1dHhuSWRc\nMDMwXDAwNCBcMDAyKFwwMDRcMDIyXDAyM1xuXDAxM3Nob3VsZENsYWltXDAz\nMFwwMDUgXDAwMSgiICsKICAgICAgIlwwMTBcMDIyXHJcblwwMDV0b3BpY1ww\nMzBcMDA2IFwwMDIoXDAxNFwwMjIuXG5cMDE2cHVibGlzaFJlcXVlc3RcMDMw\nNCBcMDAxKFwwMTMiICsKICAgICAgIjJcMDI2LkhlZHdpZy5QdWJsaXNoUmVx\ndWVzdFwwMjIyXG5cMDIwc3Vic2NyaWJlUmVxIiArCiAgICAgICJ1ZXN0XDAz\nMDUgXDAwMShcMDEzMlwwMzAuSGVkd2lnLlN1YnNjcmliZVJlcXVlc3RcMDIy\nLlxuXDAxNiIgKwogICAgICAiY29uc3VtZVJlcXVlc3RcMDMwNiBcMDAxKFww\nMTMyXDAyNi5IZWR3aWcuQ29uc3VtZVJlcSIgKwogICAgICAidWVzdFwwMjI2\nXG5cMDIydW5zdWJzY3JpYmVSZXF1ZXN0XDAzMDcgXDAwMShcMDEzMlwwMzIu\nSGVkd2kiICsKICAgICAgImcuVW5zdWJzY3JpYmVSZXF1ZXN0XDAyMjhcblww\nMjNzdG9wRGVsaXZlcnlSZXF1IiArCiAgICAgICJlc3RcMDMwOCBcMDAxKFww\nMTMyXDAzMy5IZWR3aWcuU3RvcERlbGl2ZXJ5UmVxdWVzdFwwMjI6IiArCiAg\nICAgICJcblwwMjRzdGFydERlbGl2ZXJ5UmVxdWVzdFwwMzA5IFwwMDEoXDAx\nMzJcMDM0LkhlZHdpZy5TdCIgKwogICAgICAiYXJ0RGVsaXZlcnlSZXF1ZXN0\nXCIuXG5cMDE2UHVibGlzaFJlcXVlc3RcMDIyXDAzNFxuXDAwMyIsCiAgICAg\nICJtc2dcMDMwXDAwMiBcMDAyKFwwMTMyXDAxNy5IZWR3aWcuTWVzc2FnZVwi\nXDM1NVwwMDFcblwwMjBTdWJzY3JpYmUiICsKICAgICAgIlJlcXVlc3RcMDIy\nXDAyNFxuXDAxNHN1YnNjcmliZXJJZFwwMzBcMDAyIFwwMDIoXDAxNFwwMjJR\nXG5cMDE2Y3JlYXRlTyIgKwogICAgICAickF0dGFjaFwwMzBcMDAzIFwwMDEo\nXDAxNjJcJy5IZWR3aWcuU3Vic2NyaWJlUmVxdWVzdC4iICsKICAgICAgIkNy\nZWF0ZU9yQXR0YWNoOlwwMjBDUkVBVEVfT1JfQVRUQUNIXDAyMlwwMzJcblww\nMTNzeW5jIiArCiAgICAgICJocm9ub3VzXDAzMFwwMDQgXDAwMShcMDEwOlww\nMDVmYWxzZVwwMjJcMDI0XG5cMDE0bWVzc2FnZUJvdW5kXDAzMFwwMDUgXDAw\nMSIgKwogICAgICAiKFxyXCI+XG5cMDE2Q3JlYXRlT3JBdHRhY2hcMDIyXG5c\nblwwMDZDUkVBVEVcMDIwXDAwMFwwMjJcblxuXDAwNkFUVEEiICsKICAgICAg\nIkNIXDAyMFwwMDFcMDIyXDAyNFxuXDAyMENSRUFURV9PUl9BVFRBQ0hcMDIw\nXDAwMlwiXDIwMVwwMDFcblwwMjNTdWJzY3JpcHQiICsKICAgICAgImlvbk9w\ndGlvbnNcMDIyUVxuXDAxNmNyZWF0ZU9yQXR0YWNoXDAzMFwwMDIgXDAwMShc\nMDE2MlwnLkhlZCIgKwogICAgICAid2lnLlN1YnNjcmliZVJlcXVlc3QuQ3Jl\nYXRlT3JBdHRhY2g6XDAyMENSRSIgKwogICAgICAiQVRFX09SX0FUVEFDSFww\nMjJcMDI3XG5cMDE0bWVzc2FnZUJvdW5kXDAzMFwwMDMgXDAwMShccjpcMDAx\nMFwiSyIsCiAgICAgICJcblwwMTZDb25zdW1lUmVxdWVzdFwwMjJcMDI0XG5c\nMDE0c3Vic2NyaWJlcklkXDAzMFwwMDIgXDAwMihcMDE0XDAyMiMiICsKICAg\nICAgIlxuXDAwNW1zZ0lkXDAzMFwwMDMgXDAwMihcMDEzMlwwMjQuSGVkd2ln\nLk1lc3NhZ2VTZXFJZFwiKlxuXDAyMlUiICsKICAgICAgIm5zdWJzY3JpYmVS\nZXF1ZXN0XDAyMlwwMjRcblwwMTRzdWJzY3JpYmVySWRcMDMwXDAwMiBcMDAy\nKFwwMTRcIiIgKwogICAgICAiK1xuXDAyM1N0b3BEZWxpdmVyeVJlcXVlc3Rc\nMDIyXDAyNFxuXDAxNHN1YnNjcmliZXJJZFwwMzBcMDAyIiArCiAgICAgICIg\nXDAwMihcMDE0XCIsXG5cMDI0U3RhcnREZWxpdmVyeVJlcXVlc3RcMDIyXDAy\nNFxuXDAxNHN1YnNjcmliIiArCiAgICAgICJlcklkXDAzMFwwMDIgXDAwMihc\nMDE0XCJcMzIzXDAwMVxuXDAxNlB1YlN1YlJlc3BvbnNlXDAyMjBcblwwMTdw\ncm90b2NvIiArCiAgICAgICJsVmVyc2lvblwwMzBcMDAxIFwwMDIoXDAxNjJc\nMDI3LkhlZHdpZy5Qcm90b2NvbFZlcnNpb25cMDIyIiArCiAgICAgICImXG5c\nbnN0YXR1c0NvZGVcMDMwXDAwMiBcMDAyKFwwMTYyXDAyMi5IZWR3aWcuU3Rh\ndHVzQ29kZVwwMjIiICsKICAgICAgIlxyXG5cMDA1dHhuSWRcMDMwXDAwMyBc\nMDAyKFwwMDRcMDIyXDAyMVxuXHRzdGF0dXNNc2dcMDMwXDAwNCBcMDAxKFx0\nXDAyMiBcblwwMDdtZXMiICsKICAgICAgInNhZ2VcMDMwXDAwNSBcMDAxKFww\nMTMyXDAxNy5IZWR3aWcuTWVzc2FnZVwwMjJcclxuXDAwNXRvcGljXDAzMFww\nMDYgXDAwMSIsCiAgICAgICIoXDAxNFwwMjJcMDI0XG5cMDE0c3Vic2NyaWJl\ncklkXDAzMFwwMDcgXDAwMShcMDE0XCJOXG5cMDIxU3Vic2NyaXB0aW9uIiAr\nCiAgICAgICJTdGF0ZVwwMjIjXG5cMDA1bXNnSWRcMDMwXDAwMSBcMDAyKFww\nMTMyXDAyNC5IZWR3aWcuTWVzc2FnZVNlcSIgKwogICAgICAiSWRcMDIyXDAy\nNFxuXDAxNG1lc3NhZ2VCb3VuZFwwMzBcMDAyIFwwMDEoXHJcIk9cblwwMTNM\nZWRnZXJSYW5nZVwwMjIiICsKICAgICAgIlwwMjBcblwwMTBsZWRnZXJJZFww\nMzBcMDAxIFwwMDIoXDAwNFwwMjIuXG5cMDIwZW5kU2VxSWRJbmNsdWRlZFww\nMzBcMDAyICIgKwogICAgICAiXDAwMShcMDEzMlwwMjQuSGVkd2lnLk1lc3Nh\nZ2VTZXFJZFwiM1xuXDAxNExlZGdlclJhbmdlIiArCiAgICAgICJzXDAyMiNc\nblwwMDZyYW5nZXNcMDMwXDAwMSBcMDAzKFwwMTMyXDAyMy5IZWR3aWcuTGVk\nZ2VyUmFuZ2UqXCIiICsKICAgICAgIlxuXDAxN1Byb3RvY29sVmVyc2lvblww\nMjJcMDE3XG5cMDEzVkVSU0lPTl9PTkVcMDIwXDAwMSpwXG5cck9wIiArCiAg\nICAgICJlcmF0aW9uVHlwZVwwMjJcMDEzXG5cMDA3UFVCTElTSFwwMjBcMDAw\nXDAyMlxyXG5cdFNVQlNDUklCRVwwMjBcMDAxXDAyMiIgKwogICAgICAiXDAx\nM1xuXDAwN0NPTlNVTUVcMDIwXDAwMlwwMjJcMDE3XG5cMDEzVU5TVUJTQ1JJ\nQkVcMDIwXDAwM1wwMjJcMDIyXG5cMDE2U1RBUlRfRCIgKwogICAgICAiRUxJ\nVkVSWVwwMjBcMDA0XDAyMlwwMjFcblxyU1RPUF9ERUxJVkVSWVwwMjBcMDA1\nKlwyMzZcMDAyXG5cblN0YXR1c0MiLAogICAgICAib2RlXDAyMlwwMTNcblww\nMDdTVUNDRVNTXDAyMFwwMDBcMDIyXDAyNlxuXDAyMU1BTEZPUk1FRF9SRVFV\nRVNUXDAyMFwyMjFcMDAzIiArCiAgICAgICJcMDIyXDAyMlxuXHJOT19TVUNI\nX1RPUElDXDAyMFwyMjJcMDAzXDAyMlwwMzZcblwwMzFDTElFTlRfQUxSRUFE\nWV9TIiArCiAgICAgICJVQlNDUklCRURcMDIwXDIyM1wwMDNcMDIyXDAzMlxu\nXDAyNUNMSUVOVF9OT1RfU1VCU0NSSUJFRFwwMjBcMjI0XDAwMyIgKwogICAg\nICAiXDAyMlwwMjZcblwwMjFDT1VMRF9OT1RfQ09OTkVDVFwwMjBcMjI1XDAw\nM1wwMjJcMDE3XG5cblRPUElDX0JVU1lcMDIwXDIyNiIgKwogICAgICAiXDAw\nM1wwMjJcMDM2XG5cMDMxTk9UX1JFU1BPTlNJQkxFX0ZPUl9UT1BJQ1wwMjBc\nMzY1XDAwM1wwMjJcMDIxXG5cMDE0U0VSIiArCiAgICAgICJWSUNFX0RPV05c\nMDIwXDM2NlwwMDNcMDIyXDAyNFxuXDAxN1VOQ0VSVEFJTl9TVEFURVwwMjBc\nMzY3XDAwM1wwMjJcMDMxXG5cMDI0VU4iICsKICAgICAgIkVYUEVDVEVEX0NP\nTkRJVElPTlwwMjBcMzMwXDAwNFwwMjJcMDE2XG5cdENPTVBPU0lURVwwMjBc\nMjc0XDAwNUJcMDM2XG4iICsKICAgICAgIlwwMzJvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbEhcMDAxIgogICAgfTsKICAgIGNvbS5nb29nbGUucHJvdG9i\ndWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3IuSW50ZXJuYWxEZXNjcmlw\ndG9yQXNzaWduZXIgYXNzaWduZXIgPQogICAgICBuZXcgY29tLmdvb2dsZS5w\ncm90b2J1Zi5EZXNjcmlwdG9ycy5GaWxlRGVzY3JpcHRvci5JbnRlcm5hbERl\nc2NyaXB0b3JBc3NpZ25lcigpIHsKICAgICAgICBwdWJsaWMgY29tLmdvb2ds\nZS5wcm90b2J1Zi5FeHRlbnNpb25SZWdpc3RyeSBhc3NpZ25EZXNjcmlwdG9y\ncygKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlwdG9y\ncy5GaWxlRGVzY3JpcHRvciByb290KSB7CiAgICAgICAgICBkZXNjcmlwdG9y\nID0gcm9vdDsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfTWVz\nc2FnZV9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigp\nLmdldE1lc3NhZ2VUeXBlcygpLmdldCgwKTsKICAgICAgICAgIGludGVybmFs\nX3N0YXRpY19IZWR3aWdfTWVzc2FnZV9maWVsZEFjY2Vzc29yVGFibGUgPSBu\nZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRN\nZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRl\ncm5hbF9zdGF0aWNfSGVkd2lnX01lc3NhZ2VfZGVzY3JpcHRvciwKICAgICAg\nICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIkJvZHkiLCAiU3Jj\nUmVnaW9uIiwgIk1zZ0lkIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlLmNsYXNz\nLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2UuQnVpbGRlci5jbGFzcyk7CiAgICAgICAg\nICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1JlZ2lvblNwZWNpZmljU2VxSWRf\nZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRN\nZXNzYWdlVHlwZXMoKS5nZXQoMSk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1JlZ2lvblNwZWNpZmljU2VxSWRfZmllbGRBY2Nlc3NvclRh\nYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAg\nICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19SZWdpb25TcGVjaWZpY1NlcUlk\nX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJp\nbmdbXSB7ICJSZWdpb24iLCAiU2VxSWQiLCB9LAogICAgICAgICAgICAgIG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlJlZ2lv\nblNwZWNpZmljU2VxSWQuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUmVnaW9uU3BlY2lm\naWNTZXFJZC5CdWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0\nYXRpY19IZWR3aWdfTWVzc2FnZVNlcUlkX2Rlc2NyaXB0b3IgPQogICAgICAg\nICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0KDIp\nOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19NZXNzYWdlU2Vx\nSWRfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29y\nVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19N\nZXNzYWdlU2VxSWRfZGVzY3JpcHRvciwKICAgICAgICAgICAgICBuZXcgamF2\nYS5sYW5nLlN0cmluZ1tdIHsgIkxvY2FsQ29tcG9uZW50IiwgIlJlbW90ZUNv\nbXBvbmVudHMiLCB9LAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZC5jbGFzcywK\nICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQuQnVpbGRlci5jbGFzcyk7CiAgICAg\nICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1B1YlN1YlJlcXVlc3RfZGVz\nY3JpcHRvciA9CiAgICAgICAgICAgIGdldERlc2NyaXB0b3IoKS5nZXRNZXNz\nYWdlVHlwZXMoKS5nZXQoMyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNf\nSGVkd2lnX1B1YlN1YlJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3\nCiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVz\nc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19QdWJTdWJSZXF1ZXN0X2Rlc2NyaXB0b3IsCiAg\nICAgICAgICAgICAgbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJQcm90b2Nv\nbFZlcnNpb24iLCAiVHlwZSIsICJUcmllZFNlcnZlcnMiLCAiVHhuSWQiLCAi\nU2hvdWxkQ2xhaW0iLCAiVG9waWMiLCAiUHVibGlzaFJlcXVlc3QiLCAiU3Vi\nc2NyaWJlUmVxdWVzdCIsICJDb25zdW1lUmVxdWVzdCIsICJVbnN1YnNjcmli\nZVJlcXVlc3QiLCAiU3RvcERlbGl2ZXJ5UmVxdWVzdCIsICJTdGFydERlbGl2\nZXJ5UmVxdWVzdCIsIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3\naWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVxdWVzdC5jbGFz\ncywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5Q\ndWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOwog\nICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVz\ndF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigpLmdl\ndE1lc3NhZ2VUeXBlcygpLmdldCg0KTsKICAgICAgICAgIGludGVybmFsX3N0\nYXRpY19IZWR3aWdfUHVibGlzaFJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxl\nID0gbmV3CiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJh\ndGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAg\naW50ZXJuYWxfc3RhdGljX0hlZHdpZ19QdWJsaXNoUmVxdWVzdF9kZXNjcmlw\ndG9yLAogICAgICAgICAgICAgIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAi\nTXNnIiwgfSwKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90\nb2NvbC5QdWJTdWJQcm90b2NvbC5QdWJsaXNoUmVxdWVzdC5jbGFzcywKICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5QdWJsaXNoUmVxdWVzdC5CdWlsZGVyLmNsYXNzKTsKICAgICAg\nICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaWJlUmVxdWVzdF9k\nZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1l\nc3NhZ2VUeXBlcygpLmdldCg1KTsKICAgICAgICAgIGludGVybmFsX3N0YXRp\nY19IZWR3aWdfU3Vic2NyaWJlUmVxdWVzdF9maWVsZEFjY2Vzc29yVGFibGUg\nPSBuZXcKICAgICAgICAgICAgY29tLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0\nZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJsZSgKICAgICAgICAgICAgICBp\nbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N1YnNjcmliZVJlcXVlc3RfZGVzY3Jp\ncHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsg\nIlN1YnNjcmliZXJJZCIsICJDcmVhdGVPckF0dGFjaCIsICJTeW5jaHJvbm91\ncyIsICJNZXNzYWdlQm91bmQiLCB9LAogICAgICAgICAgICAgIG9yZy5hcGFj\naGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmliZVJl\ncXVlc3QuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5CdWls\nZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdf\nU3Vic2NyaXB0aW9uT3B0aW9uc19kZXNjcmlwdG9yID0KICAgICAgICAgICAg\nZ2V0RGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg2KTsKICAg\nICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3Vic2NyaXB0aW9uT3B0\naW9uc19maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1N1YnNjcmlwdGlvbk9wdGlvbnNfZGVzY3JpcHRvciwKICAgICAgICAgICAg\nICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIkNyZWF0ZU9yQXR0YWNoIiwg\nIk1lc3NhZ2VCb3VuZCIsIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5o\nZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0aW9uT3B0\naW9ucy5jbGFzcywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5TdWJzY3JpcHRpb25PcHRpb25zLkJ1\naWxkZXIuY2xhc3MpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdp\nZ19Db25zdW1lUmVxdWVzdF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0\nRGVzY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg3KTsKICAgICAg\nICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfQ29uc3VtZVJlcXVlc3RfZmll\nbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5nb29nbGUu\ncHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUo\nCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19Db25zdW1l\nUmVxdWVzdF9kZXNjcmlwdG9yLAogICAgICAgICAgICAgIG5ldyBqYXZhLmxh\nbmcuU3RyaW5nW10geyAiU3Vic2NyaWJlcklkIiwgIk1zZ0lkIiwgfSwKICAg\nICAgICAgICAgICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5Db25zdW1lUmVxdWVzdC5jbGFzcywKICAgICAgICAgICAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Db25z\ndW1lUmVxdWVzdC5CdWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFs\nX3N0YXRpY19IZWR3aWdfVW5zdWJzY3JpYmVSZXF1ZXN0X2Rlc2NyaXB0b3Ig\nPQogICAgICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVz\nKCkuZ2V0KDgpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19V\nbnN1YnNjcmliZVJlcXVlc3RfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAg\nICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2Fn\nZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxf\nc3RhdGljX0hlZHdpZ19VbnN1YnNjcmliZVJlcXVlc3RfZGVzY3JpcHRvciwK\nICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIlN1YnNj\ncmliZXJJZCIsIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuVW5zdWJzY3JpYmVSZXF1ZXN0LmNs\nYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLlVuc3Vic2NyaWJlUmVxdWVzdC5CdWlsZGVyLmNs\nYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERl\nbGl2ZXJ5UmVxdWVzdF9kZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVz\nY3JpcHRvcigpLmdldE1lc3NhZ2VUeXBlcygpLmdldCg5KTsKICAgICAgICAg\nIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RvcERlbGl2ZXJ5UmVxdWVzdF9m\naWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29tLmdvb2ds\nZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNzb3JUYWJs\nZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2lnX1N0b3BE\nZWxpdmVyeVJlcXVlc3RfZGVzY3JpcHRvciwKICAgICAgICAgICAgICBuZXcg\namF2YS5sYW5nLlN0cmluZ1tdIHsgIlN1YnNjcmliZXJJZCIsIH0sCiAgICAg\nICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuU3RvcERlbGl2ZXJ5UmVxdWVzdC5jbGFzcywKICAgICAgICAgICAg\nICBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndG9wRGVsaXZlcnlSZXF1ZXN0LkJ1aWxkZXIuY2xhc3MpOwogICAgICAgICAg\naW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdGFydERlbGl2ZXJ5UmVxdWVzdF9k\nZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1l\nc3NhZ2VUeXBlcygpLmdldCgxMCk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX1N0YXJ0RGVsaXZlcnlSZXF1ZXN0X2ZpZWxkQWNjZXNzb3JU\nYWJsZSA9IG5ldwogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdl\nbmVyYXRlZE1lc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAg\nICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfU3RhcnREZWxpdmVyeVJlcXVl\nc3RfZGVzY3JpcHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0\ncmluZ1tdIHsgIlN1YnNjcmliZXJJZCIsIH0sCiAgICAgICAgICAgICAgb3Jn\nLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnRE\nZWxpdmVyeVJlcXVlc3QuY2xhc3MsCiAgICAgICAgICAgICAgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3RhcnREZWxpdmVy\neVJlcXVlc3QuQnVpbGRlci5jbGFzcyk7CiAgICAgICAgICBpbnRlcm5hbF9z\ndGF0aWNfSGVkd2lnX1B1YlN1YlJlc3BvbnNlX2Rlc2NyaXB0b3IgPQogICAg\nICAgICAgICBnZXREZXNjcmlwdG9yKCkuZ2V0TWVzc2FnZVR5cGVzKCkuZ2V0\nKDExKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3aWdfUHViU3Vi\nUmVzcG9uc2VfZmllbGRBY2Nlc3NvclRhYmxlID0gbmV3CiAgICAgICAgICAg\nIGNvbS5nb29nbGUucHJvdG9idWYuR2VuZXJhdGVkTWVzc2FnZS5GaWVsZEFj\nY2Vzc29yVGFibGUoCiAgICAgICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hl\nZHdpZ19QdWJTdWJSZXNwb25zZV9kZXNjcmlwdG9yLAogICAgICAgICAgICAg\nIG5ldyBqYXZhLmxhbmcuU3RyaW5nW10geyAiUHJvdG9jb2xWZXJzaW9uIiwg\nIlN0YXR1c0NvZGUiLCAiVHhuSWQiLCAiU3RhdHVzTXNnIiwgIk1lc3NhZ2Ui\nLCAiVG9waWMiLCAiU3Vic2NyaWJlcklkIiwgfSwKICAgICAgICAgICAgICBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJT\ndWJSZXNwb25zZS5jbGFzcywKICAgICAgICAgICAgICBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXNwb25zZS5C\ndWlsZGVyLmNsYXNzKTsKICAgICAgICAgIGludGVybmFsX3N0YXRpY19IZWR3\naWdfU3Vic2NyaXB0aW9uU3RhdGVfZGVzY3JpcHRvciA9CiAgICAgICAgICAg\nIGdldERlc2NyaXB0b3IoKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTIpOwog\nICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19TdWJzY3JpcHRpb25T\ndGF0ZV9maWVsZEFjY2Vzc29yVGFibGUgPSBuZXcKICAgICAgICAgICAgY29t\nLmdvb2dsZS5wcm90b2J1Zi5HZW5lcmF0ZWRNZXNzYWdlLkZpZWxkQWNjZXNz\nb3JUYWJsZSgKICAgICAgICAgICAgICBpbnRlcm5hbF9zdGF0aWNfSGVkd2ln\nX1N1YnNjcmlwdGlvblN0YXRlX2Rlc2NyaXB0b3IsCiAgICAgICAgICAgICAg\nbmV3IGphdmEubGFuZy5TdHJpbmdbXSB7ICJNc2dJZCIsICJNZXNzYWdlQm91\nbmQiLCB9LAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlLmNsYXNzLAog\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLlN1YnNjcmlwdGlvblN0YXRlLkJ1aWxkZXIuY2xhc3MpOwog\nICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZV9k\nZXNjcmlwdG9yID0KICAgICAgICAgICAgZ2V0RGVzY3JpcHRvcigpLmdldE1l\nc3NhZ2VUeXBlcygpLmdldCgxMyk7CiAgICAgICAgICBpbnRlcm5hbF9zdGF0\naWNfSGVkd2lnX0xlZGdlclJhbmdlX2ZpZWxkQWNjZXNzb3JUYWJsZSA9IG5l\ndwogICAgICAgICAgICBjb20uZ29vZ2xlLnByb3RvYnVmLkdlbmVyYXRlZE1l\nc3NhZ2UuRmllbGRBY2Nlc3NvclRhYmxlKAogICAgICAgICAgICAgIGludGVy\nbmFsX3N0YXRpY19IZWR3aWdfTGVkZ2VyUmFuZ2VfZGVzY3JpcHRvciwKICAg\nICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsgIkxlZGdlcklk\nIiwgIkVuZFNlcUlkSW5jbHVkZWQiLCB9LAogICAgICAgICAgICAgIG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJh\nbmdlLmNsYXNzLAogICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlLkJ1aWxkZXIuY2xh\nc3MpOwogICAgICAgICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJS\nYW5nZXNfZGVzY3JpcHRvciA9CiAgICAgICAgICAgIGdldERlc2NyaXB0b3Io\nKS5nZXRNZXNzYWdlVHlwZXMoKS5nZXQoMTQpOwogICAgICAgICAgaW50ZXJu\nYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZXNfZmllbGRBY2Nlc3NvclRh\nYmxlID0gbmV3CiAgICAgICAgICAgIGNvbS5nb29nbGUucHJvdG9idWYuR2Vu\nZXJhdGVkTWVzc2FnZS5GaWVsZEFjY2Vzc29yVGFibGUoCiAgICAgICAgICAg\nICAgaW50ZXJuYWxfc3RhdGljX0hlZHdpZ19MZWRnZXJSYW5nZXNfZGVzY3Jp\ncHRvciwKICAgICAgICAgICAgICBuZXcgamF2YS5sYW5nLlN0cmluZ1tdIHsg\nIlJhbmdlcyIsIH0sCiAgICAgICAgICAgICAgb3JnLmFwYWNoZS5oZWR3aWcu\ncHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2VzLmNsYXNzLAog\nICAgICAgICAgICAgIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1\nYlByb3RvY29sLkxlZGdlclJhbmdlcy5CdWlsZGVyLmNsYXNzKTsKICAgICAg\nICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgfTsKICAgIGNvbS5n\nb29nbGUucHJvdG9idWYuRGVzY3JpcHRvcnMuRmlsZURlc2NyaXB0b3IKICAg\nICAgLmludGVybmFsQnVpbGRHZW5lcmF0ZWRGaWxlRnJvbShkZXNjcmlwdG9y\nRGF0YSwKICAgICAgICBuZXcgY29tLmdvb2dsZS5wcm90b2J1Zi5EZXNjcmlw\ndG9ycy5GaWxlRGVzY3JpcHRvcltdIHsKICAgICAgICB9LCBhc3NpZ25lcik7\nCiAgfQogIAogIHB1YmxpYyBzdGF0aWMgdm9pZCBpbnRlcm5hbEZvcmNlSW5p\ndCgpIHt9CiAgCiAgLy8gQEBwcm90b2NfaW5zZXJ0aW9uX3BvaW50KG91dGVy\nX2NsYXNzX3Njb3BlKQp9Cg==\n","encoding":"base64"}

