{"sha":"f3f7f974679fb9832bb5a464709b3c5998621720","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjNmN2Y5NzQ2NzlmYjk4MzJiYjVhNDY0NzA5YjNjNTk5ODYyMTcyMA==","size":37576,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f3f7f974679fb9832bb5a464709b3c5998621720","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW4uY29uc29sZTsKCmltcG9y\ndCBqYXZhLmlvLkJ1ZmZlcmVkUmVhZGVyOwppbXBvcnQgamF2YS5pby5GaWxl\nOwppbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEuaW8u\nSW5wdXRTdHJlYW1SZWFkZXI7CmltcG9ydCBqYXZhLmxhbmcucmVmbGVjdC5J\nbnZvY2F0aW9uVGFyZ2V0RXhjZXB0aW9uOwppbXBvcnQgamF2YS5sYW5nLnJl\nZmxlY3QuTWV0aG9kOwppbXBvcnQgamF2YS51dGlsLkFycmF5TGlzdDsKaW1w\nb3J0IGphdmEudXRpbC5BcnJheXM7CmltcG9ydCBqYXZhLnV0aWwuRW51bWVy\nYXRpb247CmltcG9ydCBqYXZhLnV0aWwuSGFzaE1hcDsKaW1wb3J0IGphdmEu\ndXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEudXRpbC5MaW5rZWRIYXNoTWFw\nOwppbXBvcnQgamF2YS51dGlsLkxpbmtlZExpc3Q7CmltcG9ydCBqYXZhLnV0\naWwuTGlzdDsKaW1wb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0\naWwuTm9TdWNoRWxlbWVudEV4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5j\nb25jdXJyZW50LkNvdW50RG93bkxhdGNoOwppbXBvcnQgamF2YS51dGlsLmNv\nbmN1cnJlbnQuVGltZVVuaXQ7CgppbXBvcnQgb3JnLmFwYWNoZS5jb21tb25z\nLmNvbmZpZ3VyYXRpb24uQ29uZmlndXJhdGlvbkV4Y2VwdGlvbjsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLmFkbWluLkhlZHdpZ0FkbWluOwppbXBvcnQg\nb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5NZXNzYWdlSGFuZGxlcjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVudC5hcGkuUHVibGlzaGVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3Jp\nYmVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmNvbmYuQ2xp\nZW50Q29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNs\naWVudC5IZWR3aWdDbGllbnQ7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5w\ncm90b2NvbC5QdWJTdWJQcm90b2NvbC5MZWRnZXJSYW5nZTsKaW1wb3J0IG9y\nZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdl\nclJhbmdlczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1\nYlN1YlByb3RvY29sLk1lc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5T\ndWJzY3JpYmVSZXF1ZXN0LkNyZWF0ZU9yQXR0YWNoOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaXB0\naW9uU3RhdGU7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2V4dGVu\nc2lvbnMuU3Vic2NyaXB0aW9uU3RhdGVVdGlsczsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3M7\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVkRXZlbnQ7Cmlt\ncG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5XYXRjaGVyOwppbXBvcnQgb3Jn\nLmFwYWNoZS56b29rZWVwZXIuWm9vS2VlcGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS56b29rZWVwZXIuZGF0YS5TdGF0OwoKaW1wb3J0IG9yZy5zbGY0ai5Mb2dn\nZXI7CmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyRmFjdG9yeTsKCmltcG9ydCBj\nb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBjb20uZ29v\nZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlvbjsK\nCmltcG9ydCBzdGF0aWMgb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW4uY29uc29s\nZS5IZWR3aWdDb21tYW5kcy4qOwppbXBvcnQgc3RhdGljIG9yZy5hcGFjaGUu\naGVkd2lnLmFkbWluLmNvbnNvbGUuSGVkd2lnQ29tbWFuZHMuQ09NTUFORC4q\nOwoKLyoqCiAqIENvbnNvbGUgQ2xpZW50IHRvIEhlZHdpZwogKi8KcHVibGlj\nIGNsYXNzIEhlZHdpZ0NvbnNvbGUgewogICAgcHJpdmF0ZSBzdGF0aWMgZmlu\nYWwgTG9nZ2VyIExPRyA9IExvZ2dlckZhY3RvcnkuZ2V0TG9nZ2VyKEhlZHdp\nZ0NvbnNvbGUuY2xhc3MpOwogICAgLy8gTk9URTogbm93IGl0IGlzIGZpeGVk\nIHBhc3N3ZCBpbiBib29ra2VlcGVyCiAgICBzdGF0aWMgYnl0ZVtdIHBhc3N3\nZCA9ICJzaWxseXNlY3JldCIuZ2V0Qnl0ZXMoKTsKCiAgICAvLyBoaXN0b3J5\nIGZpbGUgbmFtZQogICAgc3RhdGljIGZpbmFsIFN0cmluZyBIV19ISVNUT1JZ\nX0ZJTEUgPSAiLmh3X2hpc3RvcnkiOwoKICAgIHByb3RlY3RlZCBNeUNvbW1h\nbmRPcHRpb25zIGNsID0gbmV3IE15Q29tbWFuZE9wdGlvbnMoKTsKICAgIHBy\nb3RlY3RlZCBIYXNoTWFwPEludGVnZXIsIFN0cmluZz4gaGlzdG9yeSA9IG5l\ndyBMaW5rZWRIYXNoTWFwPEludGVnZXIsIFN0cmluZz4oKTsKICAgIHByb3Rl\nY3RlZCBpbnQgY29tbWFuZENvdW50ID0gMDsKICAgIHByb3RlY3RlZCBib29s\nZWFuIHByaW50V2F0Y2hlcyA9IHRydWU7CiAgICBwcm90ZWN0ZWQgTWFwPFN0\ncmluZywgTXlDb21tYW5kPiBteUNvbW1hbmRzOwoKICAgIHByb3RlY3RlZCBi\nb29sZWFuIGluQ29uc29sZSA9IHRydWU7CgogICAgcHJvdGVjdGVkIEhlZHdp\nZ0FkbWluIGFkbWluOwogICAgcHJvdGVjdGVkIEhlZHdpZ0NsaWVudCBodWJD\nbGllbnQ7CiAgICBwcm90ZWN0ZWQgUHVibGlzaGVyIHB1Ymxpc2hlcjsKICAg\nIHByb3RlY3RlZCBTdWJzY3JpYmVyIHN1YnNjcmliZXI7CiAgICBwcm90ZWN0\nZWQgQ29uc29sZU1lc3NhZ2VIYW5kbGVyIGNvbnNvbGVIYW5kbGVyID0KICAg\nICAgICAgICAgbmV3IENvbnNvbGVNZXNzYWdlSGFuZGxlcigpOwoKICAgIHBy\nb3RlY3RlZCBTdHJpbmcgbXlSZWdpb247CgogICAgaW50ZXJmYWNlIE15Q29t\nbWFuZCB7CiAgICAgICAgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10gYXJncykg\ndGhyb3dzIEV4Y2VwdGlvbjsKICAgIH0KCiAgICBzdGF0aWMgY2xhc3MgSGVs\ncENtZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdz\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgYm9vbGVhbiBwcmlu\ndFVzYWdlID0gdHJ1ZTsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID49\nIDIpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBjb21tYW5kID0gYXJnc1sx\nXTsKICAgICAgICAgICAgICAgIENPTU1BTkQgYyA9IGdldEhlZHdpZ0NvbW1h\nbmRzKCkuZ2V0KGNvbW1hbmQpOwogICAgICAgICAgICAgICAgaWYgKGMgIT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGMucHJpbnRVc2FnZSgpOwog\nICAgICAgICAgICAgICAgICAgIHByaW50VXNhZ2UgPSBmYWxzZTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAocHJp\nbnRVc2FnZSkgewogICAgICAgICAgICAgICAgdXNhZ2UoKTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICB9\nCgogICAgY2xhc3MgRXhpdENtZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7Cgog\nICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bkNt\nZChTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAg\nICAgcHJpbnRNZXNzYWdlKCJRdWl0dGluZyAuLi4iKTsKICAgICAgICAgICAg\naHViQ2xpZW50LmNsb3NlKCk7CiAgICAgICAgICAgIGFkbWluLmNsb3NlKCk7\nCiAgICAgICAgICAgIFJ1bnRpbWUuZ2V0UnVudGltZSgpLmV4aXQoMCk7CiAg\nICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICBj\nbGFzcyBSZWRvQ21kIGltcGxlbWVudHMgTXlDb21tYW5kIHsKCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gcnVuQ21kKFN0cmlu\nZ1tdIGFyZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpZiAo\nYXJncy5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFs\nc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGludCBpbmRleDsKICAg\nICAgICAgICAgaWYgKCIhIi5lcXVhbHMoYXJnc1sxXSkpIHsKICAgICAgICAg\nICAgICAgIGluZGV4ID0gY29tbWFuZENvdW50IC0gMTsKICAgICAgICAgICAg\nfSBlbHNlIHsKICAgICAgICAgICAgICAgIGluZGV4ID0gSW50ZWdlci5kZWNv\nZGUoYXJnc1sxXSk7CiAgICAgICAgICAgICAgICBpZiAoY29tbWFuZENvdW50\nIDw9IGluZGV4KSB7CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5w\ncmludGxuKCJDb21tYW5kIGluZGV4IG91dCBvZiByYW5nZSIpOwogICAgICAg\nICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgfQogICAgICAgICAgICBjbC5wYXJzZUNvbW1hbmQoaGlz\ndG9yeS5nZXQoaW5kZXgpKTsKICAgICAgICAgICAgaWYgKGNsLmdldENvbW1h\nbmQoKS5lcXVhbHMoInJlZG8iKSkgewogICAgICAgICAgICAgICAgU3lzdGVt\nLmVyci5wcmludGxuKCJObyByZWRvaW5nIHJlZG9zIik7CiAgICAgICAgICAg\nICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\naGlzdG9yeS5wdXQoY29tbWFuZENvdW50LCBoaXN0b3J5LmdldChpbmRleCkp\nOwogICAgICAgICAgICBwcm9jZXNzQ21kKGNsKTsKICAgICAgICAgICAgcmV0\ndXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIGNsYXNz\nIEhpc3RvcnlDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5n\nW10gYXJncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGZvciAo\naW50IGk9Y29tbWFuZENvdW50IC0gMTA7IGk8PWNvbW1hbmRDb3VudDsgKytp\nKSB7CiAgICAgICAgICAgICAgICBpZiAoaSA8IDApIHsKICAgICAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbihpICsgIiAtICIgKyBoaXN0b3J5\nLmdldChpKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRy\ndWU7CiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIGNsYXNzIFNldENt\nZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdzKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3Ro\nIDwgMyB8fCAhInByaW50d2F0Y2hlcyIuZXF1YWxzKGFyZ3NbMV0pKSB7CiAg\nICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0gZWxz\nZSBpZiAoYXJncy5sZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgU3lz\ndGVtLm91dC5wcmludGxuKCJwcmludHdhdGNoZXMgaXMgIiArIChwcmludFdh\ndGNoZXMgPyAib24iIDogIm9mZiIpKTsKICAgICAgICAgICAgfSBlbHNlIHsK\nICAgICAgICAgICAgICAgIHByaW50V2F0Y2hlcyA9IGFyZ3NbMl0uZXF1YWxz\nKCJvbiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVl\nOwogICAgICAgIH0KICAgICAgICAKICAgIH0KCiAgICBjbGFzcyBQdWJDbWQg\naW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10gYXJncykgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA8\nIDMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmlu\nZy5jb3B5RnJvbVV0ZjgoYXJnc1sxXSk7CgogICAgICAgICAgICBTdHJpbmdC\ndWlsZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAg\nZm9yIChpbnQgaT0yOyBpPGFyZ3MubGVuZ3RoOyBpKyspIHsKICAgICAgICAg\nICAgICAgIHNiLmFwcGVuZChhcmdzW2ldKTsKICAgICAgICAgICAgICAgIGlm\nIChpICE9IGFyZ3MubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgICAgICAg\nIHNiLmFwcGVuZCgnICcpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgbXNnQm9keSA9IEJ5dGVTdHJp\nbmcuY29weUZyb21VdGY4KHNiLnRvU3RyaW5nKCkpOwogICAgICAgICAgICBN\nZXNzYWdlIG1zZyA9IE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkobXNn\nQm9keSkuYnVpbGQoKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAg\nICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRvcGljLCBtc2cpOwogICAgICAgICAg\nICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJQVUIgRE9ORSIpOwogICAgICAg\nICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nU3lzdGVtLmVyci5wcmludGxuKCJQVUIgRkFJTEVEIik7CiAgICAgICAgICAg\nICAgICBlLnByaW50U3RhY2tUcmFjZSgpOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICAKICAgIH0K\nCiAgICBzdGF0aWMgY2xhc3MgQ29uc29sZU1lc3NhZ2VIYW5kbGVyIGltcGxl\nbWVudHMgTWVzc2FnZUhhbmRsZXIgewoKICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICBwdWJsaWMgdm9pZCBkZWxpdmVyKEJ5dGVTdHJpbmcgdG9waWMsIEJ5\ndGVTdHJpbmcgc3Vic2NyaWJlcklkLAogICAgICAgICAgICAgICAgTWVzc2Fn\nZSBtc2csIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY29udGV4\ndCkgewogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlJlY2VpdmVk\nIG1lc3NhZ2UgZnJvbSB0b3BpYyAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkg\nKyAKICAgICAgICAgICAgICAgICAgICAiIGZvciBzdWJzY3JpYmVyICIgKyBz\ndWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkgKyAiIDogIgogICAgICAgICAg\nICAgICAgICAgICsgbXNnLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAg\nICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZpbmlzaGVkKGNvbnRleHQs\nIG51bGwpOwogICAgICAgIH0KICAgICAgICAKICAgIH0KCiAgICBjbGFzcyBT\ndWJDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3RyaW5nW10gYXJn\ncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIENyZWF0ZU9yQXR0\nYWNoIG1vZGU7CiAgICAgICAgICAgIGJvb2xlYW4gcmVjZWl2ZSA9IHRydWU7\nCiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA8IDMpIHsKICAgICAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChh\ncmdzLmxlbmd0aCA9PSAzKSB7CiAgICAgICAgICAgICAgICBtb2RlID0gQ3Jl\nYXRlT3JBdHRhY2guQVRUQUNIOwogICAgICAgICAgICAgICAgcmVjZWl2ZSA9\nIHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0\ncnkgewogICAgICAgICAgICAgICAgICAgIG1vZGUgPSBDcmVhdGVPckF0dGFj\naC52YWx1ZU9mKEludGVnZXIucGFyc2VJbnQoYXJnc1szXSkpOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIlVua25vdyBtb2RlIDogIiAr\nIGFyZ3NbM10pOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChhcmdzLmxl\nbmd0aCA+PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmVjZWl2ZSA9IEJvb2xlYW4ucGFyc2VCb29s\nZWFuKGFyZ3NbNF0pOwogICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEV4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlY2VpdmUg\nPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG1vZGUgPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJVbmtu\nb3cgbW9kZSA6ICIgKyBhcmdzWzNdKTsKICAgICAgICAgICAgICAgIHJldHVy\nbiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBCeXRlU3RyaW5n\nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJnc1sxXSk7CiAg\nICAgICAgICAgIEJ5dGVTdHJpbmcgc3ViSWQgPSBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOChhcmdzWzJdKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKHRvcGljLCBzdWJJZCwgbW9k\nZSk7CiAgICAgICAgICAgICAgICBpZiAocmVjZWl2ZSkgewogICAgICAgICAg\nICAgICAgICAgIHN1YnNjcmliZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3Vi\nSWQsIGNvbnNvbGVIYW5kbGVyKTsKICAgICAgICAgICAgICAgICAgICBTeXN0\nZW0ub3V0LnByaW50bG4oIlNVQiBET05FIEFORCBSRUNFSVZFIik7CiAgICAg\nICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIFN5c3Rl\nbS5vdXQucHJpbnRsbigiU1VCIERPTkUgQlVUIE5PVCBSRUNFSVZFIik7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBlKSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIlNV\nQiBGQUlMRUQiKTsKICAgICAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNl\nKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAg\nICAgICAgfQogICAgfQoKICAgIGNsYXNzIFVuc3ViQ21kIGltcGxlbWVudHMg\nTXlDb21tYW5kIHsKCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGlj\nIGJvb2xlYW4gcnVuQ21kKFN0cmluZ1tdIGFyZ3MpIHRocm93cyBFeGNlcHRp\nb24gewogICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPCAzKSB7CiAgICAg\nICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21V\ndGY4KGFyZ3NbMV0pOwogICAgICAgICAgICBCeXRlU3RyaW5nIHN1YklkID0g\nQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJnc1syXSk7CiAgICAgICAgICAg\nIHRyeSB7CiAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLnN0b3BEZWxpdmVy\neSh0b3BpYywgc3ViSWQpOwogICAgICAgICAgICAgICAgc3Vic2NyaWJlci51\nbnN1YnNjcmliZSh0b3BpYywgc3ViSWQpOwogICAgICAgICAgICAgICAgU3lz\ndGVtLm91dC5wcmludGxuKCJVTlNVQiBET05FIik7CiAgICAgICAgICAgIH0g\nY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0u\nZXJyLnByaW50bG4oIlVOU1VCIEZBSUxFRCIpOwogICAgICAgICAgICAgICAg\nZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAg\nICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgCiAgICB9CgogICAg\nY2xhc3MgUm1zdWJDbWQgaW1wbGVtZW50cyBNeUNvbW1hbmQgewoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgYm9vbGVhbiBydW5DbWQoU3Ry\naW5nW10gYXJncykgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIGlm\nIChhcmdzLmxlbmd0aCA8IDcpIHsKICAgICAgICAgICAgICAgIHJldHVybiBm\nYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBTdHJpbmcgdG9waWNQ\ncmVmaXggPSBhcmdzWzFdOwogICAgICAgICAgICBpbnQgc3RhcnRUb3BpYyA9\nIEludGVnZXIucGFyc2VJbnQoYXJnc1syXSk7CiAgICAgICAgICAgIGludCBl\nbmRUb3BpYyA9IEludGVnZXIucGFyc2VJbnQoYXJnc1szXSk7CiAgICAgICAg\nICAgIFN0cmluZyBzdWJQcmVmaXggPSBhcmdzWzRdOwogICAgICAgICAgICBp\nbnQgc3RhcnRTdWIgPSBJbnRlZ2VyLnBhcnNlSW50KGFyZ3NbNV0pOwogICAg\nICAgICAgICBpbnQgZW5kU3ViID0gSW50ZWdlci5wYXJzZUludChhcmdzWzZd\nKTsKICAgICAgICAgICAgaWYgKHN0YXJ0VG9waWMgPiBlbmRUb3BpYyB8fCBl\nbmRTdWIgPCBzdGFydFN1YikgewogICAgICAgICAgICAgICAgcmV0dXJuIGZh\nbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaW50IGk9c3Rh\ncnRUb3BpYzsgaTw9ZW5kVG9waWM7IGkrKykgewogICAgICAgICAgICAgICAg\nQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KHRv\ncGljUHJlZml4ICsgaSk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgICAgIGZvciAoaW50IGo9c3RhcnRTdWI7IGo8PWVuZFN1Yjsg\naisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJ5dGVTdHJpbmcgc3Vi\nID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgoc3ViUHJlZml4ICsgaik7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuc3Vic2NyaWJlKHRv\ncGljLCBzdWIsIENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gpOwog\nICAgICAgICAgICAgICAgICAgICAgICBzdWJzY3JpYmVyLnVuc3Vic2NyaWJl\nKHRvcGljLCBzdWIpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlJNU1VCICIgKyB0b3Bp\nYy50b1N0cmluZ1V0ZjgoKSArICIgRE9ORSIpOwogICAgICAgICAgICAgICAg\nfSBjYXRjaCAoRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICBT\neXN0ZW0uZXJyLnByaW50bG4oIlJNU1VCICIgKyB0b3BpYy50b1N0cmluZ1V0\nZjgoKSArICIgRkFJTEVEIik7CiAgICAgICAgICAgICAgICAgICAgZS5wcmlu\ndFN0YWNrVHJhY2UoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAg\nfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgfQog\nICAgCiAgICBjbGFzcyBDbG9zZVN1YnNjcmlwdGlvbkNtZCBpbXBsZW1lbnRz\nIE15Q29tbWFuZCB7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyBib29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMykgewogICAg\nICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAg\nICAgICAgIEJ5dGVTdHJpbmcgdG9waWMgPSBCeXRlU3RyaW5nLmNvcHlGcm9t\nVXRmOChhcmdzWzFdKTsKICAgICAgICAgICAgQnl0ZVN0cmluZyBzdWRJZCA9\nIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KGFyZ3NbMl0pOwogICAgICAgICAg\nICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHN1YnNjcmli\nZXIuc3RvcERlbGl2ZXJ5KHRvcGljLCBzdWRJZCk7CiAgICAgICAgICAgICAg\nICBzdWJzY3JpYmVyLmNsb3NlU3Vic2NyaXB0aW9uKHRvcGljLCBzdWRJZCk7\nCiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAg\nICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkNMT1NFU1VCIEZBSUxFRCIp\nOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAg\nICAgIH0KICAgICAgICAKICAgIH0KICAgIAogICAgY2xhc3MgQ29uc3VtZVRv\nQ21kIGltcGxlbWVudHMgTXlDb21tYW5kIHsKCiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIGJvb2xlYW4gcnVuQ21kKFN0cmluZ1tdIGFyZ3Mp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoYXJncy5sZW5n\ndGggPCA0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgICAgIH0KICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5dGVT\ndHJpbmcuY29weUZyb21VdGY4KGFyZ3NbMV0pOwogICAgICAgICAgICBCeXRl\nU3RyaW5nIHN1YklkID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJnc1sy\nXSk7CiAgICAgICAgICAgIGxvbmcgbXNnSWQgPSBMb25nLnBhcnNlTG9uZyhh\ncmdzWzNdKTsKICAgICAgICAgICAgTWVzc2FnZVNlcUlkIGNvbnN1bWVJZCA9\nIE1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCkuc2V0TG9jYWxDb21wb25lbnQo\nbXNnSWQpLmJ1aWxkKCk7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAg\nICAgICBzdWJzY3JpYmVyLmNvbnN1bWUodG9waWMsIHN1YklkLCBjb25zdW1l\nSWQpOwogICAgICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAg\nICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJDT05TVU1FVE8gRkFJ\nTEVEIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQogICAgICAgIAogICAgfQogICAgCiAgICBjbGFzcyBDb25z\ndW1lQ21kIGltcGxlbWVudHMgTXlDb21tYW5kIHsKCiAgICAgICAgQE92ZXJy\naWRlCiAgICAgICAgcHVibGljIGJvb2xlYW4gcnVuQ21kKFN0cmluZ1tdIGFy\nZ3MpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBpZiAoYXJncy5s\nZW5ndGggPCA0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgbG9uZyBsYXN0Q29uc3VtZWRJZCA9\nIDA7CiAgICAgICAgICAgIFN1YnNjcmlwdGlvblN0YXRlIHN0YXRlID0gYWRt\naW4uZ2V0U3Vic2NyaXB0aW9uKEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KGFy\nZ3NbMV0pLCBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChhcmdzWzJdKSk7CiAg\nICAgICAgICAgIGlmIChudWxsID09IHN0YXRlKSB7CiAgICAgICAgICAgICAg\nICBTeXN0ZW0uZXJyLnByaW50bG4oIkZhaWxlZCB0byByZWFkIHN1YnNjcmlw\ndGlvbiBmb3IgdG9waWM6ICIgKyBhcmdzWzFdCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiBzdWJzY3JpYmVyOiAiICsgYXJnc1syXSk7\nCiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBsb25nIG51bU1lc3NhZ2VzVG9Db25zdW1lID0gTG9uZy5w\nYXJzZUxvbmcoYXJnc1szXSk7CiAgICAgICAgICAgIGxvbmcgaWRUb0NvbnN1\nbWVkID0gbGFzdENvbnN1bWVkSWQgKyBudW1NZXNzYWdlc1RvQ29uc3VtZTsK\nICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJUcnkgdG8gbW92ZSBz\ndWJzY3JpYmVyKCIgKyBhcmdzWzJdICsgIikgY29uc3VtZSBwdHIgb2YgdG9w\naWMoIiArIGFyZ3NbMV0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nICIpIGZyb20gIiArIGxhc3RDb25zdW1lZElkICsgIiB0byAiICsgaWRUb0Nv\nbnN1bWVkKTsKICAgICAgICAgICAgTWVzc2FnZVNlcUlkIGNvbnN1bWVJZCA9\nIE1lc3NhZ2VTZXFJZC5uZXdCdWlsZGVyKCkuc2V0TG9jYWxDb21wb25lbnQo\naWRUb0NvbnN1bWVkKS5idWlsZCgpOwogICAgICAgICAgICBCeXRlU3RyaW5n\nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJnc1sxXSk7CiAg\nICAgICAgICAgIEJ5dGVTdHJpbmcgc3ViSWQgPSBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOChhcmdzWzJdKTsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAg\nICAgICAgIHN1YnNjcmliZXIuY29uc3VtZSh0b3BpYywgc3ViSWQsIGNvbnN1\nbWVJZCk7CiAgICAgICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBlKSB7CiAg\nICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkNPTlNVTUUgRkFJ\nTEVEIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7\nCiAgICAgICAgfQogICAgICAgIAogICAgfQoKICAgIGNsYXNzIFB1YlN1YkNt\nZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBib29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdzKSB0\naHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3Ro\nIDwgNSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIGZpbmFsIGxvbmcgc3RhcnRUaW1lID0gU3lz\ndGVtLmN1cnJlbnRUaW1lTWlsbGlzKCk7CgogICAgICAgICAgICBmaW5hbCBC\neXRlU3RyaW5nIHRvcGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoYXJn\nc1sxXSk7CiAgICAgICAgICAgIGZpbmFsIEJ5dGVTdHJpbmcgc3ViSWQgPSBC\neXRlU3RyaW5nLmNvcHlGcm9tVXRmOChhcmdzWzJdICsgIi0iICsgc3RhcnRU\naW1lKTsKICAgICAgICAgICAgaW50IHRpbWVvdXRTZWNzID0gNjA7CiAgICAg\nICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICB0aW1lb3V0U2VjcyA9IElu\ndGVnZXIucGFyc2VJbnQoYXJnc1szXSk7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBuZmUpIHsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgU3RyaW5nQnVpbGRlciBzYiA9IG5ldyBTdHJpbmdCdWls\nZGVyKCk7CiAgICAgICAgICAgIGZvciAoaW50IGk9NDsgaTxhcmdzLmxlbmd0\naDsgaSsrKSB7CiAgICAgICAgICAgICAgICBzYi5hcHBlbmQoYXJnc1tpXSk7\nCiAgICAgICAgICAgICAgICBpZiAoaSAhPSBhcmdzLmxlbmd0aCAtIDEpIHsK\nICAgICAgICAgICAgICAgICAgICBzYi5hcHBlbmQoJyAnKTsKICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBhcHBlbmQg\nYSB0aW1lc3RhbXAgdGFnCiAgICAgICAgICAgIEJ5dGVTdHJpbmcgbXNnQm9k\neSA9IEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KHNiLnRvU3RyaW5nKCkgKyAi\nLSIgKyBzdGFydFRpbWUpOwogICAgICAgICAgICBmaW5hbCBNZXNzYWdlIG1z\nZyA9IE1lc3NhZ2UubmV3QnVpbGRlcigpLnNldEJvZHkobXNnQm9keSkuYnVp\nbGQoKTsKCiAgICAgICAgICAgIGJvb2xlYW4gc3Vic2NyaWJlZCA9IGZhbHNl\nOwogICAgICAgICAgICBib29sZWFuIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAg\nICAgICAgZmluYWwgQ291bnREb3duTGF0Y2ggaXNEb25lID0gbmV3IENvdW50\nRG93bkxhdGNoKDEpOwogICAgICAgICAgICBsb25nIGVsYXBzZWRUaW1lID0g\nMEw7CgogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlN0YXJ0aW5n\nIFBVQlNVQiB0ZXN0IC4uLiIpOwogICAgICAgICAgICB0cnkgewogICAgICAg\nICAgICAgICAgLy8gc3ViIHRoZSB0b3BpYwogICAgICAgICAgICAgICAgc3Vi\nc2NyaWJlci5zdWJzY3JpYmUodG9waWMsIHN1YklkLCBDcmVhdGVPckF0dGFj\naC5DUkVBVEVfT1JfQVRUQUNIKTsKICAgICAgICAgICAgICAgIHN1YnNjcmli\nZWQgPSB0cnVlOwoKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRs\nbigiU3ViIHRvcGljICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIHN1\nYnNjcmliZXIgaWQgIiArIHN1YklkLnRvU3RyaW5nVXRmOCgpKTsKCiAgICAg\nICAgICAgICAgICAKCiAgICAgICAgICAgICAgICAvLyBwdWIgdG9waWMKICAg\nICAgICAgICAgICAgIHB1Ymxpc2hlci5wdWJsaXNoKHRvcGljLCBtc2cpOwog\nICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJQdWIgdG9waWMg\nIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiA6ICIgKyBtc2cuZ2V0Qm9k\neSgpLnRvU3RyaW5nVXRmOCgpKTsKCiAgICAgICAgICAgICAgICAvLyBlbnN1\ncmUgc3Vic2NyaWJlciBmaXJzdCwgcHVibGlzaCBuZXh0LCB0aGVuIHdlIHN0\nYXJ0IGRlbGl2ZXJ5IHRvIHJlY2VpdmUgbWVzc2FnZQogICAgICAgICAgICAg\nICAgLy8gaWYgc3RhcnQgZGVsaXZlcnkgZmlyc3QgYmVmb3JlIHB1Ymxpc2gs\nIGlzRG9uZSBtYXkgbm90aWZ5IGJlZm9yZSB3YWl0CiAgICAgICAgICAgICAg\nICBzdWJzY3JpYmVyLnN0YXJ0RGVsaXZlcnkodG9waWMsIHN1YklkLCBuZXcg\nTWVzc2FnZUhhbmRsZXIoKSB7CgogICAgICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIGRlbGl2ZXIo\nQnl0ZVN0cmluZyB0aGlzVG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklk\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgTWVzc2FnZSBtZXNzYWdl\nLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGNvbnRleHQpIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXNUb3BpYy5lcXVhbHMo\ndG9waWMpICYmIHN1YnNjcmliZXJJZC5lcXVhbHMoc3ViSWQpICYmCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBtc2cuZ2V0Qm9keSgpLmVxdWFscyht\nZXNzYWdlLmdldEJvZHkoKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIFN5c3RlbS5vdXQucHJpbnRsbigiUmVjZWl2ZWQgbWVzc2FnZSA6ICIg\nKyBtZXNzYWdlLmdldEJvZHkoKS50b1N0cmluZ1V0ZjgoKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpc0RvbmUuY291bnREb3duKCk7CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY29udGV4dCwgbnVsbCk7CiAg\nICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0pOwoKICAg\nICAgICAgICAgICAgIC8vIHdhaXQgZm9yIHRoZSBtZXNzYWdlCiAgICAgICAg\nICAgICAgICBzdWNjZXNzID0gaXNEb25lLmF3YWl0KHRpbWVvdXRTZWNzLCBU\naW1lVW5pdC5TRUNPTkRTKTsKICAgICAgICAgICAgICAgIGVsYXBzZWRUaW1l\nID0gU3lzdGVtLmN1cnJlbnRUaW1lTWlsbGlzKCkgLSBzdGFydFRpbWU7CiAg\nICAgICAgICAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICB0cnkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChzdWJzY3JpYmVkKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHN1YnNjcmliZXIuc3RvcERlbGl2ZXJ5KHRvcGlj\nLCBzdWJJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXIu\ndW5zdWJzY3JpYmUodG9waWMsIHN1YklkKTsKICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAg\nICAgICAgIGlmIChzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIFN5c3RlbS5vdXQucHJpbnRsbigiUFVCU1VCIFNVQ0NFU1MuIFRJTUU6ICIg\nKyBlbGFwc2VkVGltZSArICIgTVMiKTsKICAgICAgICAgICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnBy\naW50bG4oIlBVQlNVQiBGQUlMRUQuICIpOwogICAgICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3VjY2VzczsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9CiAg\nICAKICAgIGNsYXNzIFJlYWRUb3BpY0NtZCBpbXBsZW1lbnRzIE15Q29tbWFu\nZCB7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFu\nIHJ1bkNtZChTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgICAgICAgICAg\nICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFJl\nYWRUb3BpYyBydDsKICAgICAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KGFyZ3NbMV0pOwogICAgICAgICAgICBp\nZiAoYXJncy5sZW5ndGggPT0gMikgewogICAgICAgICAgICAgICAgcnQgPSBu\nZXcgUmVhZFRvcGljKGFkbWluLCB0b3BpYywgaW5Db25zb2xlKTsKICAgICAg\nICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJ0ID0gbmV3IFJlYWRU\nb3BpYyhhZG1pbiwgdG9waWMsIExvbmcucGFyc2VMb25nKGFyZ3NbMl0pLCBp\nbkNvbnNvbGUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJ0LnJlYWRU\nb3BpYygpOwogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAg\nICAgICAgCiAgICB9CgogICAgY2xhc3MgU2hvd0NtZCBpbXBsZW1lbnRzIE15\nQ29tbWFuZCB7CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBi\nb29sZWFuIHJ1bkNtZChTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9u\nIHsKICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMikgewogICAgICAg\nICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIFN0cmluZyBlcnJvck1zZyA9IG51bGw7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBpZiAoSGVkd2lnQ29tbWFuZHMuU0hPV19IVUJT\nLmVxdWFscyhhcmdzWzFdKSkgewogICAgICAgICAgICAgICAgICAgIGVycm9y\nTXNnID0gIlVuYWJsZSB0byBmZXRjaCB0aGUgbGlzdCBvZiBodWIgc2VydmVy\ncyI7CiAgICAgICAgICAgICAgICAgICAgc2hvd0h1YnMoKTsKICAgICAgICAg\nICAgICAgIH0gZWxzZSBpZiAoSGVkd2lnQ29tbWFuZHMuU0hPV19UT1BJQ1Mu\nZXF1YWxzKGFyZ3NbMV0pKSB7CiAgICAgICAgICAgICAgICAgICAgZXJyb3JN\nc2cgPSAiVW5hYmxlIHRvIGZldGNoIHRoZSBsaXN0IG9mIHRvcGljcyI7CiAg\nICAgICAgICAgICAgICAgICAgc2hvd1RvcGljcygpOwogICAgICAgICAgICAg\nICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnBy\naW50bG4oIkVSUk9SOiBVbmtub3duIHNob3cgY29tbWFuZCAnIiArIGFyZ3Nb\nMV0gKyAiJyIpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgICAgIGlmIChudWxsICE9IGVycm9yTXNn\nKSB7CiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKGVy\ncm9yTXNnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGUu\ncHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBwcm90ZWN0ZWQgdm9p\nZCBzaG93SHVicygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgICAgICBN\nYXA8SGVkd2lnU29ja2V0QWRkcmVzcywgSW50ZWdlcj4gaHVicyA9IGFkbWlu\nLmdldEF2YWlsYWJsZUh1YnMoKTsKICAgICAgICAgICAgU3lzdGVtLm91dC5w\ncmludGxuKCJBdmFpbGFibGUgSHViIFNlcnZlcnM6Iik7CiAgICAgICAgICAg\nIGZvciAoTWFwLkVudHJ5PEhlZHdpZ1NvY2tldEFkZHJlc3MsIEludGVnZXI+\nIGVudHJ5IDogaHVicy5lbnRyeVNldCgpKSB7CiAgICAgICAgICAgICAgICBT\neXN0ZW0ub3V0LnByaW50bG4oIlx0IiArIGVudHJ5LmdldEtleSgpICsgIiA6\nXHQiICsgZW50cnkuZ2V0VmFsdWUoKSk7CiAgICAgICAgICAgIH0KICAgICAg\nICB9CgogICAgICAgIHByb3RlY3RlZCB2b2lkIHNob3dUb3BpY3MoKSB0aHJv\nd3MgRXhjZXB0aW9uIHsKICAgICAgICAgICAgTGlzdDxTdHJpbmc+IHRvcGlj\ncyA9IGFkbWluLmdldFRvcGljcygpOwogICAgICAgICAgICBTeXN0ZW0ub3V0\nLnByaW50bG4oIlRvcGljIExpc3Q6Iik7CiAgICAgICAgICAgIFN5c3RlbS5v\ndXQucHJpbnRsbih0b3BpY3MpOwogICAgICAgIH0KICAgICAgICAKICAgIH0K\nCiAgICBjbGFzcyBEZXNjcmliZUNtZCBpbXBsZW1lbnRzIE15Q29tbWFuZCB7\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIHJ1\nbkNtZChTdHJpbmdbXSBhcmdzKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMykgewogICAgICAgICAgICAgICAg\ncmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChI\nZWR3aWdDb21tYW5kcy5ERVNDUklCRV9UT1BJQy5lcXVhbHMoYXJnc1sxXSkp\nIHsKICAgICAgICAgICAgICAgIHJldHVybiBkZXNjcmliZVRvcGljKGFyZ3Nb\nMl0pOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0\ndXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBw\ncm90ZWN0ZWQgYm9vbGVhbiBkZXNjcmliZVRvcGljKFN0cmluZyB0b3BpYykg\ndGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgICAgIEJ5dGVTdHJpbmcgYnRv\ncGljID0gQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgodG9waWMpOwogICAgICAg\nICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIG93bmVyID0gYWRtaW4uZ2V0VG9w\naWNPd25lcihidG9waWMpOwogICAgICAgICAgICBMaXN0PExlZGdlclJhbmdl\nPiByYW5nZXMgPSBhZG1pbi5nZXRUb3BpY0xlZGdlcnMoYnRvcGljKTsKICAg\nICAgICAgICAgTWFwPEJ5dGVTdHJpbmcsIFN1YnNjcmlwdGlvblN0YXRlPiBz\ndGF0ZXMgPSBhZG1pbi5nZXRUb3BpY1N1YnNjcmlwdGlvbnMoYnRvcGljKTsK\nCiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiPT09PT0gVG9waWMg\nSW5mb3JtYXRpb24gOiAiICsgdG9waWMgKyAiID09PT09Iik7CiAgICAgICAg\nICAgIFN5c3RlbS5vdXQucHJpbnRsbigpOwogICAgICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oIk93bmVyIDogIiArIChvd25lciA9PSBudWxsID8gIk5V\nTEwiIDogb3duZXIpKTsKICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxu\nKCk7CgogICAgICAgICAgICAvLyBwcmludCBsZWRnZXJzCiAgICAgICAgICAg\nIHByaW50VG9waWNMZWRnZXJzKHJhbmdlcyk7CiAgICAgICAgICAgIC8vIHBy\naW50IHN1YnNjcmlwdGlvbnMKICAgICAgICAgICAgcHJpbnRUb3BpY1N1YnNj\ncmlwdGlvbnMoc3RhdGVzKTsKCiAgICAgICAgICAgIHJldHVybiB0cnVlOwog\nICAgICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHByaW50VG9waWNMZWRn\nZXJzKExpc3Q8TGVkZ2VyUmFuZ2U+IGxycykgewogICAgICAgICAgICBTeXN0\nZW0ub3V0LnByaW50bG4oIj4+PiBQZXJzaXN0ZW5jZSBJbmZvIDw8PCIpOwog\nICAgICAgICAgICBpZiAobnVsbCA9PSBscnMpIHsKICAgICAgICAgICAgICAg\nIFN5c3RlbS5vdXQucHJpbnRsbigiTi9BIik7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxycy5pc0Vt\ncHR5KCkpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigi\nTm8gTGVkZ2VyIHVzZWQuIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KICAgICAgICAgICAgSXRlcmF0b3I8TGVkZ2VyUmFuZ2U+\nIGxySXRlcmF0b3IgPSBscnMuaXRlcmF0b3IoKTsKICAgICAgICAgICAgbG9u\nZyBzdGFydE9mTGVkZ2VyID0gMTsKICAgICAgICAgICAgd2hpbGUgKGxySXRl\ncmF0b3IuaGFzTmV4dCgpKSB7CiAgICAgICAgICAgICAgICBMZWRnZXJSYW5n\nZSByYW5nZSA9IGxySXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgICAgICAg\nbG9uZyBlbmRPZkxlZGdlciA9IExvbmcuTUFYX1ZBTFVFOwogICAgICAgICAg\nICAgICAgaWYgKHJhbmdlLmhhc0VuZFNlcUlkSW5jbHVkZWQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGVuZE9mTGVkZ2VyID0gcmFuZ2UuZ2V0RW5kU2Vx\nSWRJbmNsdWRlZCgpLmdldExvY2FsQ29tcG9uZW50KCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIkxl\nZGdlciAiICsgcmFuZ2UuZ2V0TGVkZ2VySWQoKSArICIgWyAiICsgc3RhcnRP\nZkxlZGdlciArICIgfiAiICsgKGVuZE9mTGVkZ2VyID09IExvbmcuTUFYX1ZB\nTFVFID8gIiIgOiBlbmRPZkxlZGdlcikgKyAiIF0iKTsKCiAgICAgICAgICAg\nICAgICBzdGFydE9mTGVkZ2VyID0gZW5kT2ZMZWRnZXIgKyAxOwogICAgICAg\nICAgICB9CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigpOwogICAg\nICAgIH0KCiAgICAgICAgcHJpdmF0ZSB2b2lkIHByaW50VG9waWNTdWJzY3Jp\ncHRpb25zKE1hcDxCeXRlU3RyaW5nLCBTdWJzY3JpcHRpb25TdGF0ZT4gc3Rh\ndGVzKSB7CiAgICAgICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiPj4+IFN1\nYnNjcmlwdGlvbiBJbmZvIDw8PCIpOwogICAgICAgICAgICBpZiAoMCA9PSBz\ndGF0ZXMuc2l6ZSgpKSB7CiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnBy\naW50bG4oIk5vIHN1YnNjcmliZXIuIik7CiAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChNYXAuRW50cnk8\nQnl0ZVN0cmluZywgU3Vic2NyaXB0aW9uU3RhdGU+IGVudHJ5IDogc3RhdGVz\nLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJp\nbnRsbigiU3Vic2NyaWJlciAiICsgZW50cnkuZ2V0S2V5KCkudG9TdHJpbmdV\ndGY4KCkgKyAiIDogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIFN1YnNjcmlwdGlvblN0YXRlVXRpbHMudG9TdHJpbmcoZW50cnkuZ2V0\nVmFsdWUoKSkpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIFN5c3RlbS5v\ndXQucHJpbnRsbigpOwogICAgICAgIH0KCiAgICB9CgogICAgcHJvdGVjdGVk\nIE1hcDxTdHJpbmcsIE15Q29tbWFuZD4gYnVpbGRNeUNvbW1hbmRzKCkgewog\nICAgICAgIE1hcDxTdHJpbmcsIE15Q29tbWFuZD4gY21kcyA9CiAgICAgICAg\nICAgICAgICBuZXcgSGFzaE1hcDxTdHJpbmcsIE15Q29tbWFuZD4oKTsKCiAg\nICAgICAgRXhpdENtZCBleGl0Q21kID0gbmV3IEV4aXRDbWQoKTsKICAgICAg\nICBjbWRzLnB1dChFWElULCBleGl0Q21kKTsKICAgICAgICBjbWRzLnB1dChR\nVUlULCBleGl0Q21kKTsKICAgICAgICBjbWRzLnB1dChIRUxQLCBuZXcgSGVs\ncENtZCgpKTsKICAgICAgICBjbWRzLnB1dChISVNUT1JZLCBuZXcgSGlzdG9y\neUNtZCgpKTsKICAgICAgICBjbWRzLnB1dChSRURPLCBuZXcgUmVkb0NtZCgp\nKTsKICAgICAgICBjbWRzLnB1dChTRVQsIG5ldyBTZXRDbWQoKSk7CiAgICAg\nICAgY21kcy5wdXQoUFVCLCBuZXcgUHViQ21kKCkpOwogICAgICAgIGNtZHMu\ncHV0KFNVQiwgbmV3IFN1YkNtZCgpKTsKICAgICAgICBjbWRzLnB1dChQVUJT\nVUIsIG5ldyBQdWJTdWJDbWQoKSk7CiAgICAgICAgY21kcy5wdXQoQ0xPU0VT\nVUIsIG5ldyBDbG9zZVN1YnNjcmlwdGlvbkNtZCgpKTsKICAgICAgICBjbWRz\nLnB1dChVTlNVQiwgbmV3IFVuc3ViQ21kKCkpOwogICAgICAgIGNtZHMucHV0\nKFJNU1VCLCBuZXcgUm1zdWJDbWQoKSk7CiAgICAgICAgY21kcy5wdXQoQ09O\nU1VNRSwgbmV3IENvbnN1bWVDbWQoKSk7CiAgICAgICAgY21kcy5wdXQoQ09O\nU1VNRVRPLCBuZXcgQ29uc3VtZVRvQ21kKCkpOwogICAgICAgIGNtZHMucHV0\nKFNIT1csIG5ldyBTaG93Q21kKCkpOwogICAgICAgIGNtZHMucHV0KERFU0NS\nSUJFLCBuZXcgRGVzY3JpYmVDbWQoKSk7CiAgICAgICAgY21kcy5wdXQoUkVB\nRFRPUElDLCBuZXcgUmVhZFRvcGljQ21kKCkpOwoKICAgICAgICByZXR1cm4g\nY21kczsKICAgIH0KCiAgICBzdGF0aWMgdm9pZCB1c2FnZSgpIHsKICAgICAg\nICBTeXN0ZW0uZXJyLnByaW50bG4oIkhlZHdpZ0NvbnNvbGUgW29wdGlvbnNd\nIFtjb21tYW5kXSBbYXJnc10iKTsKICAgICAgICBTeXN0ZW0uZXJyLnByaW50\nbG4oKTsKICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIkF2YWlhYmxlIGNv\nbW1hbmRzOiIpOwogICAgICAgIGZvciAoU3RyaW5nIGNtZCA6IGdldEhlZHdp\nZ0NvbW1hbmRzKCkua2V5U2V0KCkpIHsKICAgICAgICAgICAgU3lzdGVtLmVy\nci5wcmludGxuKCJcdCIgKyBjbWQpOwogICAgICAgIH0KICAgICAgICBTeXN0\nZW0uZXJyLnByaW50bG4oKTsKICAgIH0KCiAgICAvKioKICAgICAqIEEgc3Rv\ncmFnZSBjbGFzcyBmb3IgYm90aCBjb21tYW5kIGxpbmUgb3B0aW9ucyBhbmQg\nc2hlbGwgY29tbWFuZHMuCiAgICAgKi8KICAgIHN0YXRpYyBwcml2YXRlIGNs\nYXNzIE15Q29tbWFuZE9wdGlvbnMgewoKICAgICAgICBwcml2YXRlIE1hcDxT\ndHJpbmcsU3RyaW5nPiBvcHRpb25zID0gbmV3IEhhc2hNYXA8U3RyaW5nLFN0\ncmluZz4oKTsKICAgICAgICBwcml2YXRlIExpc3Q8U3RyaW5nPiBjbWRBcmdz\nID0gbnVsbDsKICAgICAgICBwcml2YXRlIFN0cmluZyBjb21tYW5kID0gbnVs\nbDsKCiAgICAgICAgcHVibGljIE15Q29tbWFuZE9wdGlvbnMoKSB7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgU3RyaW5nIGdldE9wdGlvbihTdHJpbmcg\nb3B0KSB7CiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmdldChvcHQpOwog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIFN0cmluZyBnZXRDb21tYW5kKCAp\nIHsKICAgICAgICAgICAgcmV0dXJuIGNvbW1hbmQ7CiAgICAgICAgfQoKICAg\nICAgICBwdWJsaWMgU3RyaW5nIGdldENtZEFyZ3VtZW50KCBpbnQgaW5kZXgg\nKSB7CiAgICAgICAgICAgIHJldHVybiBjbWRBcmdzLmdldChpbmRleCk7CiAg\nICAgICAgfQoKICAgICAgICBwdWJsaWMgaW50IGdldE51bUFyZ3VtZW50cygg\nKSB7CiAgICAgICAgICAgIHJldHVybiBjbWRBcmdzLnNpemUoKTsKICAgICAg\nICB9CgogICAgICAgIHB1YmxpYyBTdHJpbmdbXSBnZXRBcmdBcnJheSgpIHsK\nICAgICAgICAgICAgcmV0dXJuIGNtZEFyZ3MudG9BcnJheShuZXcgU3RyaW5n\nWzBdKTsKICAgICAgICB9CgogICAgICAgIC8qKgogICAgICAgICAqIFBhcnNl\ncyBhIGNvbW1hbmQgbGluZSB0aGF0IG1heSBjb250YWluIG9uZSBvciBtb3Jl\nIGZsYWdzCiAgICAgICAgICogYmVmb3JlIGFuIG9wdGlvbmFsIGNvbW1hbmQg\nc3RyaW5nCiAgICAgICAgICogQHBhcmFtIGFyZ3MgY29tbWFuZCBsaW5lIGFy\nZ3VtZW50cwogICAgICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBwYXJzaW5nIHN1\nY2NlZWRlZCwgZmFsc2Ugb3RoZXJ3aXNlLgogICAgICAgICAqLwogICAgICAg\nIHB1YmxpYyBib29sZWFuIHBhcnNlT3B0aW9ucyhTdHJpbmdbXSBhcmdzKSB7\nCiAgICAgICAgICAgIExpc3Q8U3RyaW5nPiBhcmdMaXN0ID0gQXJyYXlzLmFz\nTGlzdChhcmdzKTsKICAgICAgICAgICAgSXRlcmF0b3I8U3RyaW5nPiBpdCA9\nIGFyZ0xpc3QuaXRlcmF0b3IoKTsKCiAgICAgICAgICAgIHdoaWxlIChpdC5o\nYXNOZXh0KCkpIHsKICAgICAgICAgICAgICAgIFN0cmluZyBvcHQgPSBpdC5u\nZXh0KCk7CiAgICAgICAgICAgICAgICBpZiAoIW9wdC5zdGFydHNXaXRoKCIt\nIikpIHsKICAgICAgICAgICAgICAgICAgICBjb21tYW5kID0gb3B0OwogICAg\nICAgICAgICAgICAgICAgIGNtZEFyZ3MgPSBuZXcgQXJyYXlMaXN0PFN0cmlu\nZz4oICk7CiAgICAgICAgICAgICAgICAgICAgY21kQXJncy5hZGQoIGNvbW1h\nbmQgKTsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAoaXQuaGFzTmV4dCgp\nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNtZEFyZ3MuYWRkKGl0Lm5l\neHQoKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAg\nICAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgICAg\nICBvcHRpb25zLnB1dChvcHQuc3Vic3RyaW5nKDEpLCBpdC5uZXh0KCkpOwog\nICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKE5vU3VjaEVsZW1lbnRFeGNl\ncHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAgICBTeXN0ZW0uZXJy\nLnByaW50bG4oIkVycm9yOiBubyBhcmd1bWVudCBmb3VuZCBmb3Igb3B0aW9u\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIG9wdCk7CiAg\nICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICAv\nKioKICAgICAgICAgKiBCcmVha3MgYSBzdHJpbmcgaW50byBjb21tYW5kICsg\nYXJndW1lbnRzLgogICAgICAgICAqIEBwYXJhbSBjbWRzdHJpbmcgc3RyaW5n\nIG9mIGZvcm0gImNtZCBhcmcxIGFyZzIuLmV0YyIKICAgICAgICAgKiBAcmV0\ndXJuIHRydWUgaWYgcGFyc2luZyBzdWNjZWVkZWQuCiAgICAgICAgICovCiAg\nICAgICAgcHVibGljIGJvb2xlYW4gcGFyc2VDb21tYW5kKCBTdHJpbmcgY21k\nc3RyaW5nICkgewogICAgICAgICAgICBTdHJpbmdbXSBhcmdzID0gY21kc3Ry\naW5nLnNwbGl0KCIgIik7CiAgICAgICAgICAgIGlmIChhcmdzLmxlbmd0aCA9\nPSAwKXsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAg\nICAgfQogICAgICAgICAgICBjb21tYW5kID0gYXJnc1swXTsKICAgICAgICAg\nICAgY21kQXJncyA9IEFycmF5cy5hc0xpc3QoYXJncyk7CiAgICAgICAgICAg\nIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICBwcml2YXRlIGNs\nYXNzIE15V2F0Y2hlciBpbXBsZW1lbnRzIFdhdGNoZXIgewogICAgICAgIHB1\nYmxpYyB2b2lkIHByb2Nlc3MoV2F0Y2hlZEV2ZW50IGV2ZW50KSB7CiAgICAg\nICAgICAgIGlmIChnZXRQcmludFdhdGNoZXMoKSkgewogICAgICAgICAgICAg\nICAgcHJpbnRNZXNzYWdlKCJXQVRDSEVSOjoiKTsKICAgICAgICAgICAgICAg\nIHByaW50TWVzc2FnZShldmVudC50b1N0cmluZygpKTsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgIH0KCiAgICBwdWJsaWMgdm9pZCBwcmludE1lc3Nh\nZ2UoU3RyaW5nIG1zZykgewogICAgICAgIGlmIChpbkNvbnNvbGUpIHsKICAg\nICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJcbiIrbXNnKTsKICAgICAg\nICB9CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWR3aWcgQ29uc29sZQogICAg\nICoKICAgICAqIEBwYXJhbSBhcmdzIGFyZ3VtZW50cwogICAgICogQHRocm93\ncyBJT0V4Y2VwdGlvbgogICAgICogQHRocm93cyBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiAKICAgICAqLwogICAgcHVibGljIEhlZHdpZ0NvbnNvbGUoU3RyaW5n\nW10gYXJncykgdGhyb3dzIElPRXhjZXB0aW9uLCBJbnRlcnJ1cHRlZEV4Y2Vw\ndGlvbiB7CiAgICAgICAgSGVkd2lnQ29tbWFuZHMuaW5pdCgpOwogICAgICAg\nIGNsLnBhcnNlT3B0aW9ucyhhcmdzKTsKCiAgICAgICAgaWYgKGNsLmdldENv\nbW1hbmQoKSA9PSBudWxsKSB7CiAgICAgICAgICAgIGluQ29uc29sZSA9IHRy\ndWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaW5Db25zb2xlID0g\nZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBvcmcuYXBhY2hlLmJvb2trZWVw\nZXIuY29uZi5DbGllbnRDb25maWd1cmF0aW9uIGJrQ2xpZW50Q29uZiA9CiAg\nICAgICAgICAgIG5ldyBvcmcuYXBhY2hlLmJvb2trZWVwZXIuY29uZi5DbGll\nbnRDb25maWd1cmF0aW9uKCk7CiAgICAgICAgU2VydmVyQ29uZmlndXJhdGlv\nbiBodWJTZXJ2ZXJDb25mID0gbmV3IFNlcnZlckNvbmZpZ3VyYXRpb24oKTsK\nICAgICAgICBTdHJpbmcgc2VydmVyQ2ZnRmlsZSA9IGNsLmdldE9wdGlvbigi\nc2VydmVyLWNmZyIpOwogICAgICAgIGlmIChzZXJ2ZXJDZmdGaWxlICE9IG51\nbGwpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGh1YlNl\ncnZlckNvbmYubG9hZENvbmYobmV3IEZpbGUoc2VydmVyQ2ZnRmlsZSkudG9V\nUkkoKS50b1VSTCgpKTsKICAgICAgICAgICAgfSBjYXRjaCAoQ29uZmlndXJh\ndGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcg\nSU9FeGNlcHRpb24oZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdHJ5\nIHsKICAgICAgICAgICAgICAgIGJrQ2xpZW50Q29uZi5sb2FkQ29uZihuZXcg\nRmlsZShzZXJ2ZXJDZmdGaWxlKS50b1VSSSgpLnRvVVJMKCkpOwogICAgICAg\nICAgICB9IGNhdGNoIChDb25maWd1cmF0aW9uRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbihlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0KCiAgICAgICAgQ2xpZW50Q29uZmlndXJhdGlv\nbiBodWJDbGllbnRDZmcgPSBuZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpOwog\nICAgICAgIFN0cmluZyBjbGllbnRDZmdGaWxlID0gY2wuZ2V0T3B0aW9uKCJj\nbGllbnQtY2ZnIik7CiAgICAgICAgaWYgKGNsaWVudENmZ0ZpbGUgIT0gbnVs\nbCkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgaHViQ2xp\nZW50Q2ZnLmxvYWRDb25mKG5ldyBGaWxlKGNsaWVudENmZ0ZpbGUpLnRvVVJJ\nKCkudG9VUkwoKSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKENvbmZpZ3VyYXRp\nb25FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IElP\nRXhjZXB0aW9uKGUpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKCgogICAg\nICAgIHByaW50TWVzc2FnZSgiQ29ubmVjdGluZyB0byB6b29rZWVwZXIvYm9v\na2tlZXBlciB1c2luZyBIZWR3aWdBZG1pbiIpOwogICAgICAgIHRyeSB7CiAg\nICAgICAgICAgIGFkbWluID0gbmV3IEhlZHdpZ0FkbWluKGJrQ2xpZW50Q29u\nZiwgaHViU2VydmVyQ29uZik7CiAgICAgICAgICAgIGFkbWluLmdldFprSGFu\nZGxlKCkucmVnaXN0ZXIobmV3IE15V2F0Y2hlcigpKTsKICAgICAgICB9IGNh\ndGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSU9F\neGNlcHRpb24oZSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHByaW50\nTWVzc2FnZSgiQ29ubmVjdGluZyB0byBkZWZhdWx0IGh1YiBzZXJ2ZXIgIiAr\nIGh1YkNsaWVudENmZy5nZXREZWZhdWx0U2VydmVySG9zdCgpKTsKICAgICAg\nICBodWJDbGllbnQgPSBuZXcgSGVkd2lnQ2xpZW50KGh1YkNsaWVudENmZyk7\nCiAgICAgICAgcHVibGlzaGVyID0gaHViQ2xpZW50LmdldFB1Ymxpc2hlcigp\nOwogICAgICAgIHN1YnNjcmliZXIgPSBodWJDbGllbnQuZ2V0U3Vic2NyaWJl\ncigpOwogICAgICAgIAogICAgICAgIC8vIG90aGVyIHBhcmFtZXRlcnMKICAg\nICAgICBteVJlZ2lvbiA9IGh1YlNlcnZlckNvbmYuZ2V0TXlSZWdpb24oKTsK\nICAgIH0KCiAgICBwdWJsaWMgYm9vbGVhbiBnZXRQcmludFdhdGNoZXMoKSB7\nCiAgICAgICAgcmV0dXJuIHByaW50V2F0Y2hlczsKICAgIH0KCiAgICBwcm90\nZWN0ZWQgU3RyaW5nIGdldFByb21wdCgpIHsKICAgICAgICBTdHJpbmdCdWls\nZGVyIHNiID0gbmV3IFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICBzYi5hcHBl\nbmQoIltoZWR3aWc6ICgiKS5hcHBlbmQobXlSZWdpb24pLmFwcGVuZCgiKSAi\nKS5hcHBlbmQoY29tbWFuZENvdW50KS5hcHBlbmQoIl0gIik7CiAgICAgICAg\ncmV0dXJuIHNiLnRvU3RyaW5nKCk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZv\naWQgYWRkVG9IaXN0b3J5KGludCBpLCBTdHJpbmcgY21kKSB7CiAgICAgICAg\naGlzdG9yeS5wdXQoaSwgY21kKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBl\neGVjdXRlTGluZShTdHJpbmcgbGluZSkgewogICAgICAgIGlmICghbGluZS5l\ncXVhbHMoIiIpKSB7CiAgICAgICAgICAgIGNsLnBhcnNlQ29tbWFuZChsaW5l\nKTsKICAgICAgICAgICAgYWRkVG9IaXN0b3J5KGNvbW1hbmRDb3VudCwgbGlu\nZSk7CiAgICAgICAgICAgIHByb2Nlc3NDbWQoY2wpOwogICAgICAgICAgICBj\nb21tYW5kQ291bnQrKzsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVk\nIGJvb2xlYW4gcHJvY2Vzc0NtZChNeUNvbW1hbmRPcHRpb25zIGNvKSB7CiAg\nICAgICAgU3RyaW5nW10gYXJncyA9IGNvLmdldEFyZ0FycmF5KCk7CiAgICAg\nICAgU3RyaW5nIGNtZCA9IGNvLmdldENvbW1hbmQoKTsKICAgICAgICBpZiAo\nYXJncy5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHVzYWdlKCk7CiAgICAg\nICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCFn\nZXRIZWR3aWdDb21tYW5kcygpLmNvbnRhaW5zS2V5KGNtZCkpIHsKICAgICAg\nICAgICAgdXNhZ2UoKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAg\nICAgIH0KCiAgICAgICAgaWYgKExPRy5pc0RlYnVnRW5hYmxlZCgpKSB7CiAg\nICAgICAgICAgIExPRy5kZWJ1ZygiUHJvY2Vzc2luZyAiICsgY21kKTsKICAg\nICAgICB9CgogICAgICAgIE15Q29tbWFuZCBteUNvbW1hbmQgPSBteUNvbW1h\nbmRzLmdldChjbWQpOwogICAgICAgIGlmIChteUNvbW1hbmQgPT0gbnVsbCkg\newogICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIk5vIENvbW1hbmQg\nUHJvY2Vzc29yIGZvdW5kIGZvciBjb21tYW5kICIgKyBjbWQpOwogICAgICAg\nICAgICB1c2FnZSgpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAg\nICAgfQoKICAgICAgICBsb25nIHN0YXJ0VGltZSA9IFN5c3RlbS5jdXJyZW50\nVGltZU1pbGxpcygpOwogICAgICAgIGJvb2xlYW4gc3VjY2VzcyA9IGZhbHNl\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN1Y2Nlc3MgPSBteUNvbW1h\nbmQucnVuQ21kKGFyZ3MpOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlvbiBl\nKSB7CiAgICAgICAgICAgIGUucHJpbnRTdGFja1RyYWNlKCk7CiAgICAgICAg\nICAgIHN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgbG9uZyBl\nbGFwc2VkVGltZSA9IFN5c3RlbS5jdXJyZW50VGltZU1pbGxpcygpIC0gc3Rh\ncnRUaW1lOwogICAgICAgIGlmIChpbkNvbnNvbGUpIHsKICAgICAgICAgICAg\naWYgKHN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgIFN5c3RlbS5vdXQucHJp\nbnRsbigiRmluaXNoZWQgIiArICgoZG91YmxlKWVsYXBzZWRUaW1lIC8gMTAw\nMCkgKyAiIHMuIik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICBDT01NQU5EIGMgPSBnZXRIZWR3aWdDb21tYW5kcygpLmdldChjbWQp\nOwogICAgICAgICAgICAgICAgaWYgKGMgIT0gbnVsbCkgewogICAgICAgICAg\nICAgICAgICAgIGMucHJpbnRVc2FnZSgpOwogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBzdWNjZXNz\nOwogICAgfQoKICAgIEBTdXBwcmVzc1dhcm5pbmdzKCJ1bmNoZWNrZWQiKQog\nICAgdm9pZCBydW4oKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAgICAgIGlu\nQ29uc29sZSA9IHRydWU7CiAgICAgICAgbXlDb21tYW5kcyA9IGJ1aWxkTXlD\nb21tYW5kcygpOwogICAgICAgIGlmIChjbC5nZXRDb21tYW5kKCkgPT0gbnVs\nbCkgewogICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIldlbGNvbWUg\ndG8gSGVkd2lnISIpOwoKICAgICAgICAgICAgYm9vbGVhbiBqbGluZW1pc3Np\nbmcgPSBmYWxzZTsKICAgICAgICAgICAgLy8gb25seSB1c2UgamxpbmUgaWYg\naXQncyBpbiB0aGUgY2xhc3NwYXRoCiAgICAgICAgICAgIHRyeSB7CiAgICAg\nICAgICAgICAgICBDbGFzcyBjb25zb2xlQyA9IENsYXNzLmZvck5hbWUoImps\naW5lLkNvbnNvbGVSZWFkZXIiKTsKICAgICAgICAgICAgICAgIENsYXNzIGNv\nbXBsZXRvckMgPQogICAgICAgICAgICAgICAgICAgIENsYXNzLmZvck5hbWUo\nIm9yZy5hcGFjaGUuaGVkd2lnLmFkbWluLmNvbnNvbGUuSkxpbmVIZWR3aWdD\nb21wbGV0b3IiKTsKCiAgICAgICAgICAgICAgICBTeXN0ZW0ub3V0LnByaW50\nbG4oIkpMaW5lIHN1cHBvcnQgaXMgZW5hYmxlZCIpOwoKICAgICAgICAgICAg\nICAgIE9iamVjdCBjb25zb2xlID0KICAgICAgICAgICAgICAgICAgICBjb25z\nb2xlQy5nZXRDb25zdHJ1Y3RvcigpLm5ld0luc3RhbmNlKCk7CgogICAgICAg\nICAgICAgICAgT2JqZWN0IGNvbXBsZXRvciA9CiAgICAgICAgICAgICAgICAg\nICAgY29tcGxldG9yQy5nZXRDb25zdHJ1Y3RvcihIZWR3aWdBZG1pbi5jbGFz\ncykubmV3SW5zdGFuY2UoYWRtaW4pOwogICAgICAgICAgICAgICAgTWV0aG9k\nIGFkZENvbXBsZXRvciA9IGNvbnNvbGVDLmdldE1ldGhvZCgiYWRkQ29tcGxl\ndG9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgQ2xhc3MuZm9yTmFtZSgi\namxpbmUuQ29tcGxldG9yIikpOwogICAgICAgICAgICAgICAgYWRkQ29tcGxl\ndG9yLmludm9rZShjb25zb2xlLCBjb21wbGV0b3IpOwoKICAgICAgICAgICAg\nICAgIC8vIGxvYWQgaGlzdG9yeSBmaWxlCiAgICAgICAgICAgICAgICBib29s\nZWFuIGhpc3RvcnlFbmFibGVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICBP\nYmplY3QgaGlzdG9yeSA9IG51bGw7CiAgICAgICAgICAgICAgICBNZXRob2Qg\nYWRkSGlzdG9yeSA9IG51bGw7CiAgICAgICAgICAgICAgICAvLyBNZXRob2Qg\nZmx1c2hIaXN0b3J5ID0gbnVsbDsKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgQ2xhc3MgaGlzdG9yeUMgPSBDbGFzcy5mb3JO\nYW1lKCJqbGluZS5IaXN0b3J5Iik7CiAgICAgICAgICAgICAgICAgICAgaGlz\ndG9yeSA9IGhpc3RvcnlDLmdldENvbnN0cnVjdG9yKCkubmV3SW5zdGFuY2Uo\nKTsKCiAgICAgICAgICAgICAgICAgICAgRmlsZSBmaWxlID0gbmV3IEZpbGUo\nU3lzdGVtLmdldFByb3BlcnR5KCJody5oaXN0b3J5IiwKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRmlsZShTeXN0ZW0u\nZ2V0UHJvcGVydHkoInVzZXIuaG9tZSIpLCBIV19ISVNUT1JZX0ZJTEUpLnRv\nU3RyaW5nKCkpKTsKICAgICAgICAgICAgICAgICAgICBpZiAoTE9HLmlzRGVi\ndWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJIaXN0b3J5IGZpbGUgaXMgIiArIGZpbGUudG9TdHJpbmcoKSk7CiAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIE1ldGhv\nZCBzZXRIaXN0b3J5RmlsZSA9IGhpc3RvcnlDLmdldE1ldGhvZCgic2V0SGlz\ndG9yeUZpbGUiLCBGaWxlLmNsYXNzKTsKICAgICAgICAgICAgICAgICAgICBz\nZXRIaXN0b3J5RmlsZS5pbnZva2UoaGlzdG9yeSwgZmlsZSk7CgogICAgICAg\nICAgICAgICAgICAgIC8vIHNldCBoaXN0b3J5IHRvIGNvbnNvbGUgcmVhZGVy\nCiAgICAgICAgICAgICAgICAgICAgTWV0aG9kIHNldEhpc3RvcnkgPSBjb25z\nb2xlQy5nZXRNZXRob2QoInNldEhpc3RvcnkiLCBoaXN0b3J5Qyk7CiAgICAg\nICAgICAgICAgICAgICAgc2V0SGlzdG9yeS5pbnZva2UoY29uc29sZSwgaGlz\ndG9yeSk7CgogICAgICAgICAgICAgICAgICAgIC8vIGxvYWQgaGlzdG9yeSBm\ncm9tIGhpc3RvcnkgZmlsZQogICAgICAgICAgICAgICAgICAgIE1ldGhvZCBt\nb3ZlVG9GaXJzdEVudHJ5ID0gaGlzdG9yeUMuZ2V0TWV0aG9kKCJtb3ZlVG9G\naXJzdEVudHJ5Iik7CiAgICAgICAgICAgICAgICAgICAgbW92ZVRvRmlyc3RF\nbnRyeS5pbnZva2UoaGlzdG9yeSk7CgogICAgICAgICAgICAgICAgICAgIGFk\nZEhpc3RvcnkgPSBoaXN0b3J5Qy5nZXRNZXRob2QoImFkZFRvSGlzdG9yeSIs\nIFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAgICAgICAgICAgLy8gZmx1c2hI\naXN0b3J5ID0gaGlzdG9yeUMuZ2V0TWV0aG9kKCJmbHVzaEJ1ZmZlciIpOwoK\nICAgICAgICAgICAgICAgICAgICBNZXRob2QgbmV4dEVudHJ5ID0gaGlzdG9y\neUMuZ2V0TWV0aG9kKCJuZXh0Iik7CiAgICAgICAgICAgICAgICAgICAgTWV0\naG9kIGN1cnJlbnQgPSBoaXN0b3J5Qy5nZXRNZXRob2QoImN1cnJlbnQiKTsK\nICAgICAgICAgICAgICAgICAgICB3aGlsZSAoKEJvb2xlYW4pKG5leHRFbnRy\neS5pbnZva2UoaGlzdG9yeSkpKSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIFN0cmluZyBlbnRyeSA9IChTdHJpbmcpY3VycmVudC5pbnZva2UoaGlzdG9y\neSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZW50cnkuZXF1YWxz\nKCIiKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkVG9IaXN0\nb3J5KGNvbW1hbmRDb3VudCwgZW50cnkpOwogICAgICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbW1hbmRDb3VudCsr\nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\naGlzdG9yeUVuYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIFN5\nc3RlbS5vdXQucHJpbnRsbigiSkxpbmUgaGlzdG9yeSBzdXBwb3J0IGlzIGVu\nYWJsZWQiKTsKICAgICAgICAgICAgICAgIH0gY2F0Y2ggKENsYXNzTm90Rm91\nbmRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgIFN5c3RlbS5v\ndXQucHJpbnRsbigiSkxpbmUgaGlzdG9yeSBzdXBwb3J0IGlzIGRpc2FibGVk\nIik7CiAgICAgICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJKTGluZSBoaXN0\nb3J5IGRpc2FibGVkIHdpdGggZXhjZXB0aW9uIiwgZSk7CiAgICAgICAgICAg\nICAgICAgICAgaGlzdG9yeUVuYWJsZWQgPSBmYWxzZTsKICAgICAgICAgICAg\nICAgIH0gY2F0Y2ggKE5vU3VjaE1ldGhvZEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJKTGluZSBoaXN0\nb3J5IHN1cHBvcnQgaXMgZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAg\nICBMT0cuZGVidWcoIkpMaW5lIGhpc3RvcnkgZGlzYWJsZWQgd2l0aCBleGNl\ncHRpb24iLCBlKTsKICAgICAgICAgICAgICAgICAgICBoaXN0b3J5RW5hYmxl\nZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW52b2NhdGlv\nblRhcmdldEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgU3lz\ndGVtLm91dC5wcmludGxuKCJKTGluZSBoaXN0b3J5IHN1cHBvcnQgaXMgZGlz\nYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkpMaW5l\nIGhpc3RvcnkgZGlzYWJsZWQgd2l0aCBleGNlcHRpb24iLCBlKTsKICAgICAg\nICAgICAgICAgICAgICBoaXN0b3J5RW5hYmxlZCA9IGZhbHNlOwogICAgICAg\nICAgICAgICAgfSBjYXRjaCAoSWxsZWdhbEFjY2Vzc0V4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJKTGlu\nZSBoaXN0b3J5IHN1cHBvcnQgaXMgZGlzYWJsZWQiKTsKICAgICAgICAgICAg\nICAgICAgICBMT0cuZGVidWcoIkpMaW5lIGhpc3RvcnkgZGlzYWJsZWQgd2l0\naCBleGNlcHRpb24iLCBlKTsKICAgICAgICAgICAgICAgICAgICBoaXN0b3J5\nRW5hYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoSW5z\ndGFudGlhdGlvbkV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAg\nU3lzdGVtLm91dC5wcmludGxuKCJKTGluZSBoaXN0b3J5IHN1cHBvcnQgaXMg\nZGlzYWJsZWQiKTsKICAgICAgICAgICAgICAgICAgICBMT0cuZGVidWcoIkpM\naW5lIGhpc3RvcnkgZGlzYWJsZWQgd2l0aCBleGNlcHRpb24iLCBlKTsKICAg\nICAgICAgICAgICAgICAgICBoaXN0b3J5RW5hYmxlZCA9IGZhbHNlOwogICAg\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIFN0cmluZyBsaW5lOwog\nICAgICAgICAgICAgICAgTWV0aG9kIHJlYWRMaW5lID0gY29uc29sZUMuZ2V0\nTWV0aG9kKCJyZWFkTGluZSIsIFN0cmluZy5jbGFzcyk7CiAgICAgICAgICAg\nICAgICB3aGlsZSAoKGxpbmUgPSAoU3RyaW5nKXJlYWRMaW5lLmludm9rZShj\nb25zb2xlLCBnZXRQcm9tcHQoKSkpICE9IG51bGwpIHsKICAgICAgICAgICAg\nICAgICAgICBleGVjdXRlTGluZShsaW5lKTsKICAgICAgICAgICAgICAgICAg\nICBpZiAoaGlzdG9yeUVuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgYWRkSGlzdG9yeS5pbnZva2UoaGlzdG9yeSwgbGluZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIGZsdXNoSGlzdG9yeS5pbnZva2UoaGlzdG9y\neSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQog\nICAgICAgICAgICB9IGNhdGNoIChDbGFzc05vdEZvdW5kRXhjZXB0aW9uIGUp\nIHsKICAgICAgICAgICAgICAgIExPRy5kZWJ1ZygiVW5hYmxlIHRvIHN0YXJ0\nIGpsaW5lIiwgZSk7CiAgICAgICAgICAgICAgICBqbGluZW1pc3NpbmcgPSB0\ncnVlOwogICAgICAgICAgICB9IGNhdGNoIChOb1N1Y2hNZXRob2RFeGNlcHRp\nb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJVbmFibGUgdG8g\nc3RhcnQgamxpbmUiLCBlKTsKICAgICAgICAgICAgICAgIGpsaW5lbWlzc2lu\nZyA9IHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKEludm9jYXRpb25UYXJn\nZXRFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmRlYnVnKCJV\nbmFibGUgdG8gc3RhcnQgamxpbmUiLCBlKTsKICAgICAgICAgICAgICAgIGps\naW5lbWlzc2luZyA9IHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2ggKElsbGVn\nYWxBY2Nlc3NFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgTE9HLmRl\nYnVnKCJVbmFibGUgdG8gc3RhcnQgamxpbmUiLCBlKTsKICAgICAgICAgICAg\nICAgIGpsaW5lbWlzc2luZyA9IHRydWU7CiAgICAgICAgICAgIH0gY2F0Y2gg\nKEluc3RhbnRpYXRpb25FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAg\nTE9HLmRlYnVnKCJVbmFibGUgdG8gc3RhcnQgamxpbmUiLCBlKTsKICAgICAg\nICAgICAgICAgIGpsaW5lbWlzc2luZyA9IHRydWU7CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmIChqbGluZW1pc3NpbmcpIHsKICAgICAgICAgICAg\nICAgIFN5c3RlbS5vdXQucHJpbnRsbigiSkxpbmUgc3VwcG9ydCBpcyBkaXNh\nYmxlZCIpOwogICAgICAgICAgICAgICAgQnVmZmVyZWRSZWFkZXIgYnIgPQog\nICAgICAgICAgICAgICAgICAgIG5ldyBCdWZmZXJlZFJlYWRlcihuZXcgSW5w\ndXRTdHJlYW1SZWFkZXIoU3lzdGVtLmluKSk7CgogICAgICAgICAgICAgICAg\nU3RyaW5nIGxpbmU7CiAgICAgICAgICAgICAgICB3aGlsZSAoKGxpbmUgPSBi\nci5yZWFkTGluZSgpKSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAg\nZXhlY3V0ZUxpbmUobGluZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIGluQ29uc29sZSA9IGZhbHNlOwog\nICAgICAgIHByb2Nlc3NDbWQoY2wpOwogICAgICAgIHRyeSB7CiAgICAgICAg\nICAgIG15Q29tbWFuZHMuZ2V0KEVYSVQpLnJ1bkNtZChuZXcgU3RyaW5nWzBd\nKTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgIH0K\nICAgIH0KCiAgICBwdWJsaWMgc3RhdGljIHZvaWQgbWFpbihTdHJpbmdbXSBh\ncmdzKSB0aHJvd3MgSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9u\nIHsKICAgICAgICBIZWR3aWdDb25zb2xlIGNvbnNvbGUgPSBuZXcgSGVkd2ln\nQ29uc29sZShhcmdzKTsKICAgICAgICBjb25zb2xlLnJ1bigpOwogICAgfQp9\nCg==\n","encoding":"base64"}

