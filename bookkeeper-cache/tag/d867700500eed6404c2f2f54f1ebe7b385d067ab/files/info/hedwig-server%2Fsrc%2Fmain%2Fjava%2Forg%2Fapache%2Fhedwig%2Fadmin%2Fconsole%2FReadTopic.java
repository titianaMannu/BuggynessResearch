{"sha":"a1481c7f32cf7989ac24795db820478c0954755e","node_id":"MDQ6QmxvYjE1NzU5NTY6YTE0ODFjN2YzMmNmNzk4OWFjMjQ3OTVkYjgyMDQ3OGMwOTU0NzU1ZQ==","size":13196,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/a1481c7f32cf7989ac24795db820478c0954755e","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KCnBh\nY2thZ2Ugb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW4uY29uc29sZTsKCmltcG9y\ndCBqYXZhLmlvLkJ1ZmZlcmVkUmVhZGVyOwppbXBvcnQgamF2YS5pby5JT0V4\nY2VwdGlvbjsKaW1wb3J0IGphdmEuaW8uSW5wdXRTdHJlYW1SZWFkZXI7Cmlt\ncG9ydCBqYXZhLnV0aWwuRW51bWVyYXRpb247CmltcG9ydCBqYXZhLnV0aWwu\nSXRlcmF0b3I7CmltcG9ydCBqYXZhLnV0aWwuTGlzdDsKaW1wb3J0IGphdmEu\ndXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQg\namF2YS51dGlsLlRyZWVNYXA7CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2Vl\ncGVyLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\nYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBlOwppbXBv\ncnQgb3JnLmFwYWNoZS5ib29ra2VlcGVyLmNsaWVudC5MZWRnZXJFbnRyeTsK\naW1wb3J0IG9yZy5hcGFjaGUuYm9va2tlZXBlci5jbGllbnQuTGVkZ2VySGFu\nZGxlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuYWRtaW4uSGVkd2lnQWRt\naW47CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQ\ncm90b2NvbC5MZWRnZXJSYW5nZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvY29sLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlczsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLk1l\nc3NhZ2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5NZXNzYWdlU2VxSWQ7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5SZWdpb25TcGVjaWZpY1Nl\ncUlkOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaXB0aW9uU3RhdGU7CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBhY2hl\nLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tl\nZXBlci5kYXRhLlN0YXQ7CgppbXBvcnQgY29tLmdvb2dsZS5wcm90b2J1Zi5C\neXRlU3RyaW5nOwppbXBvcnQgY29tLmdvb2dsZS5wcm90b2J1Zi5JbnZhbGlk\nUHJvdG9jb2xCdWZmZXJFeGNlcHRpb247CgovKioKICogQSB0b29sIHRvIHJl\nYWQgdG9waWMgbWVzc2FnZXMuCiAqCiAqIFRoaXMgdG9vbCA6CiAqIDEpIHJl\nYWQgcGVyc2lzdGVuY2UgaW5mbyBmcm9tIHpvb2tlZXBlcjogbGVkZ2VyIHJh\nbmdlcwogKiAyKSByZWFkIHN1YnNjcmlwdGlvbiBpbmZvciBmcm9tIHpvb2tl\nZXBlcjogd2UgY2FuIGtub3cgdGhlIGxlYXN0IG1lc3NhZ2UgaWQgKGxlZGdl\nciBpZCkgCiAqIDMpIHVzZSBiayBjbGllbnQgdG8gcmVhZCBtZXNzYWdlIHN0\nYXJ0aW5nIGZyb20gbGVhc3QgbWVzc2FnZSBpZAogKi8KcHVibGljIGNsYXNz\nIFJlYWRUb3BpYyB7CiAgICAKICAgIGZpbmFsIEhlZHdpZ0FkbWluIGFkbWlu\nOwogICAgZmluYWwgQnl0ZVN0cmluZyB0b3BpYzsKICAgIGxvbmcgc3RhcnRT\nZXFJZDsKICAgIGxvbmcgbGVhc3RDb25zdW1lZFNlcUlkID0gTG9uZy5NQVhf\nVkFMVUU7CiAgICBmaW5hbCBib29sZWFuIGluQ29uc29sZTsKCiAgICBzdGF0\naWMgZmluYWwgaW50IFJDX09LID0gMDsKICAgIHN0YXRpYyBmaW5hbCBpbnQg\nUkNfRVJST1IgPSAtMTsKICAgIHN0YXRpYyBmaW5hbCBpbnQgUkNfTk9UT1BJ\nQyA9IC0yOwogICAgc3RhdGljIGZpbmFsIGludCBSQ19OT0xFREdFUlMgPSAt\nMzsKICAgIHN0YXRpYyBmaW5hbCBpbnQgUkNfTk9TVUJTQ1JJQkVSUyA9IC00\nOwogICAgCiAgICBzdGF0aWMgZmluYWwgaW50IE5VTV9NRVNTQUdFU19UT19Q\nUklOVCA9IDE1OwoKICAgIFNvcnRlZE1hcDxMb25nLCBJbk1lbW9yeUxlZGdl\nclJhbmdlPiBsZWRnZXJzID0gbmV3IFRyZWVNYXA8TG9uZywgSW5NZW1vcnlM\nZWRnZXJSYW5nZT4oKTsKICAgIAogICAgc3RhdGljIGNsYXNzIEluTWVtb3J5\nTGVkZ2VyUmFuZ2UgewogICAgICAgIExlZGdlclJhbmdlIHJhbmdlOwogICAg\nICAgIGxvbmcgc3RhcnRTZXFJZEluY2x1ZGVkOwogICAgICAgIAogICAgICAg\nIHB1YmxpYyBJbk1lbW9yeUxlZGdlclJhbmdlKExlZGdlclJhbmdlIHJhbmdl\nLCBsb25nIHN0YXJ0U2VxSWQpIHsKICAgICAgICAgICAgdGhpcy5yYW5nZSA9\nIHJhbmdlOwogICAgICAgICAgICB0aGlzLnN0YXJ0U2VxSWRJbmNsdWRlZCA9\nIHN0YXJ0U2VxSWQ7CiAgICAgICAgfQogICAgfQogICAgCiAgICAvKioKICAg\nICAqIENvbnN0cnVjdG9yCiAgICAgKi8KICAgIHB1YmxpYyBSZWFkVG9waWMo\nSGVkd2lnQWRtaW4gYWRtaW4sIEJ5dGVTdHJpbmcgdG9waWMsIGJvb2xlYW4g\naW5Db25zb2xlKSB7CiAgICAgICAgdGhpcyhhZG1pbiwgdG9waWMsIDEsIGlu\nQ29uc29sZSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBDb25zdHJ1Y3Rvcgog\nICAgICovCiAgICBwdWJsaWMgUmVhZFRvcGljKEhlZHdpZ0FkbWluIGFkbWlu\nLCBCeXRlU3RyaW5nIHRvcGljLCBsb25nIG1zZ1NlcUlkLCBib29sZWFuIGlu\nQ29uc29sZSkgewogICAgICAgIHRoaXMuYWRtaW4gPSBhZG1pbjsKICAgICAg\nICB0aGlzLnRvcGljID0gdG9waWM7CiAgICAgICAgdGhpcy5zdGFydFNlcUlk\nID0gbXNnU2VxSWQ7CiAgICAgICAgdGhpcy5pbkNvbnNvbGUgPSBpbkNvbnNv\nbGU7CiAgICB9CiAgICAKICAgIC8qKgogICAgICogQ2hlY2sgd2hldGhlciB0\naGUgdG9waWMgZXhpc3RlZCBvciBub3QKICAgICAqCiAgICAgKiBAcmV0dXJu\nIFJDX09LIGlmIHRvcGljIGlzIGV4aXN0ZWQ7IFJDX05PVE9QSUMgaWYgbm90\nLgogICAgICogQHRocm93cyBFeGNlcHRpb24KICAgICAqLwogICAgcHJvdGVj\ndGVkIGludCBjaGVja1RvcGljKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAg\nICAgcmV0dXJuIGFkbWluLmhhc1RvcGljKHRvcGljKSA/IFJDX09LIDogUkNf\nTk9UT1BJQzsKICAgIH0KICAgIAogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxl\nZGdlcnMgdXNlZCBieSB0aGlzIHRvcGljIHRvIHN0b3JlIG1lc3NhZ2VzCiAg\nICAgKgogICAgICogQHJldHVybiBSQ19PSyBpZiB0b3BpYyBoYXMgbWVzc2Fn\nZXM7IFJDX05PTEVER0VSUyBpZiBub3QuCiAgICAgKiBAdGhyb3dzIEV4Y2Vw\ndGlvbgogICAgICovCiAgICBwcm90ZWN0ZWQgaW50IGdldFRvcGljTGVkZ2Vy\ncygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIExpc3Q8TGVkZ2VyUmFu\nZ2U+IHJhbmdlcyA9IGFkbWluLmdldFRvcGljTGVkZ2Vycyh0b3BpYyk7IAog\nICAgICAgIGlmIChudWxsID09IHJhbmdlcyB8fCByYW5nZXMuaXNFbXB0eSgp\nKSB7CiAgICAgICAgICAgIHJldHVybiBSQ19OT0xFREdFUlM7CiAgICAgICAg\nfQogICAgICAgIEl0ZXJhdG9yPExlZGdlclJhbmdlPiBsckl0ZXJhdG9yID0g\ncmFuZ2VzLml0ZXJhdG9yKCk7CiAgICAgICAgbG9uZyBzdGFydE9mTGVkZ2Vy\nID0gMTsKICAgICAgICB3aGlsZSAobHJJdGVyYXRvci5oYXNOZXh0KCkpIHsK\nICAgICAgICAgICAgTGVkZ2VyUmFuZ2UgcmFuZ2UgPSBsckl0ZXJhdG9yLm5l\neHQoKTsKICAgICAgICAgICAgaWYgKHJhbmdlLmhhc0VuZFNlcUlkSW5jbHVk\nZWQoKSkgewogICAgICAgICAgICAgICAgbG9uZyBlbmRPZkxlZGdlciA9IHJh\nbmdlLmdldEVuZFNlcUlkSW5jbHVkZWQoKS5nZXRMb2NhbENvbXBvbmVudCgp\nOwogICAgICAgICAgICAgICAgbGVkZ2Vycy5wdXQoZW5kT2ZMZWRnZXIsIG5l\ndyBJbk1lbW9yeUxlZGdlclJhbmdlKHJhbmdlLCBzdGFydE9mTGVkZ2VyKSk7\nCiAgICAgICAgICAgICAgICBzdGFydE9mTGVkZ2VyID0gZW5kT2ZMZWRnZXIg\nKyAxOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0K\nICAgICAgICAgICAgaWYgKGxySXRlcmF0b3IuaGFzTmV4dCgpKSB7CiAgICAg\nICAgICAgICAgICB0aHJvdyBuZXcgSU9FeGNlcHRpb24oIkxlZGdlci1pZDog\nIiArIHJhbmdlLmdldExlZGdlcklkKCkgKyAiIGZvciB0b3BpYzogIiArIHRv\ncGljCiAgICAgICAgICAgICAgICAgICAgICAgICsgIiBpcyBub3QgdGhlIGxh\nc3Qgb25lIGJ1dCBzdGlsbCBkb2VzIG5vdCBoYXZlIGFuIGVuZCBzZXEtaWQi\nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBhZG1pbiBoYXMgcmVh\nZCBsYXN0IGNvbmZpcm1lZCBlbnRyeSBvZiBsYXN0IGxlZGdlcgogICAgICAg\nICAgICAvLyBzbyB3ZSBkb24ndCBuZWVkIHRvIGhhbmRsZSBoZXJlCiAgICAg\nICAgfQogICAgICAgIHJldHVybiBSQ19PSzsKICAgIH0KICAgIAogICAgcHJv\ndGVjdGVkIGludCBnZXRMZWFzdFN1YnNjcmlwdGlvbigpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIE1hcDxCeXRlU3RyaW5nLCBTdWJzY3JpcHRpb25T\ndGF0ZT4gc3RhdGVzID0gYWRtaW4uZ2V0VG9waWNTdWJzY3JpcHRpb25zKHRv\ncGljKTsgCiAgICAgICAgaWYgKHN0YXRlcy5pc0VtcHR5KCkpIHsKICAgICAg\nICAgICAgcmV0dXJuIFJDX05PU1VCU0NSSUJFUlM7CiAgICAgICAgfQogICAg\nICAgIGZvciAoTWFwLkVudHJ5PEJ5dGVTdHJpbmcsIFN1YnNjcmlwdGlvblN0\nYXRlPiBlbnRyeSA6IHN0YXRlcy5lbnRyeVNldCgpKSB7CiAgICAgICAgICAg\nIFN1YnNjcmlwdGlvblN0YXRlIHN0YXRlID0gZW50cnkuZ2V0VmFsdWUoKTsK\nICAgICAgICAgICAgbG9uZyBsb2NhbE1zZ0lkID0gc3RhdGUuZ2V0TXNnSWQo\nKS5nZXRMb2NhbENvbXBvbmVudCgpOwogICAgICAgICAgICBpZiAobG9jYWxN\nc2dJZCA8IGxlYXN0Q29uc3VtZWRTZXFJZCkgewogICAgICAgICAgICAgICAg\nbGVhc3RDb25zdW1lZFNlcUlkID0gbG9jYWxNc2dJZDsKICAgICAgICAgICAg\nfQogICAgICAgIH0KICAgICAgICBpZiAobGVhc3RDb25zdW1lZFNlcUlkID09\nIExvbmcuTUFYX1ZBTFVFKSB7CiAgICAgICAgICAgIGxlYXN0Q29uc3VtZWRT\nZXFJZCA9IDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBSQ19PSzsKICAg\nIH0KICAgIAogICAgcHVibGljIHZvaWQgcmVhZFRvcGljKCkgewogICAgICAg\nIHRyeSB7CiAgICAgICAgICAgIGludCByYyA9IF9yZWFkVG9waWMoKTsKICAg\nICAgICAgICAgc3dpdGNoIChyYykgewogICAgICAgICAgICBjYXNlIFJDX05P\nVE9QSUM6CiAgICAgICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIk5v\nIHRvcGljICIgKyB0b3BpYyArICIgZm91bmQuIik7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgY2FzZSBSQ19OT0xFREdFUlM6CiAgICAg\nICAgICAgICAgICBTeXN0ZW0uZXJyLnByaW50bG4oIk5vIG1lc3NhZ2UgaXMg\ncHVibGlzaGVkIHRvIHRvcGljICIgKyB0b3BpYyk7CiAgICAgICAgICAgICAg\nICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAg\nIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0\naW9uIGUpIHsKICAgICAgICAgICAgU3lzdGVtLmVyci5wcmludGxuKCJFUlJP\nUjogcmVhZCBtZXNzYWdlcyBvZiB0b3BpYyAiICsgdG9waWMgKyAiIGZhaWxl\nZC4iKTsKICAgICAgICAgICAgZS5wcmludFN0YWNrVHJhY2UoKTsKICAgICAg\nICB9CiAgICB9CiAgICAKICAgIHByb3RlY3RlZCBpbnQgX3JlYWRUb3BpYygp\nIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCByYzsKICAgICAgICAv\nLyBjaGVjayB0b3BpYwogICAgICAgIHJjID0gY2hlY2tUb3BpYygpOwogICAg\nICAgIGlmIChSQ19PSyAhPSByYykgewogICAgICAgICAgICByZXR1cm4gcmM7\nCiAgICAgICAgfQogICAgICAgIC8vIGdldCB0b3BpYyBsZWRnZXJzCiAgICAg\nICAgcmMgPSBnZXRUb3BpY0xlZGdlcnMoKTsKICAgICAgICBpZiAoUkNfT0sg\nIT0gcmMpIHsKICAgICAgICAgICAgcmV0dXJuIHJjOwogICAgICAgIH0KICAg\nICAgICAvLyBnZXQgdG9waWMgc3Vic2NyaXB0aW9uIHRvIGZpbmQgdGhlIGxl\nYXN0IG9uZQogICAgICAgIHJjID0gZ2V0TGVhc3RTdWJzY3JpcHRpb24oKTsK\nICAgICAgICBpZiAoUkNfTk9TVUJTQ1JJQkVSUyA9PSByYykgewogICAgICAg\nICAgICBzdGFydFNlcUlkID0gMTsKICAgICAgICB9IGVsc2UgaWYgKFJDX09L\nID09IHJjKSB7CiAgICAgICAgICAgIGlmIChsZWFzdENvbnN1bWVkU2VxSWQg\nPiBzdGFydFNlcUlkKSB7CiAgICAgICAgICAgICAgICBzdGFydFNlcUlkID0g\nbGVhc3RDb25zdW1lZFNlcUlkICsgMTsKICAgICAgICAgICAgfQogICAgICAg\nIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiByYzsKICAgICAgICB9CiAg\nICAgICAgCiAgICAgICAgZm9yIChNYXAuRW50cnk8TG9uZywgSW5NZW1vcnlM\nZWRnZXJSYW5nZT4gZW50cnkgOiBsZWRnZXJzLmVudHJ5U2V0KCkpIHsKICAg\nICAgICAgICAgbG9uZyBlbmRTZXFJZCA9IGVudHJ5LmdldEtleSgpOwogICAg\nICAgICAgICBpZiAoZW5kU2VxSWQgPCBzdGFydFNlcUlkKSB7CiAgICAgICAg\nICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBi\nb29sZWFuIHRvQ29udGludWUgPSByZWFkTGVkZ2VyKGVudHJ5LmdldFZhbHVl\nKCksIGVuZFNlcUlkKTsKICAgICAgICAgICAgc3RhcnRTZXFJZCA9IGVuZFNl\ncUlkICsgMTsKICAgICAgICAgICAgaWYgKCF0b0NvbnRpbnVlKSB7CiAgICAg\nICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgIH0KICAg\nICAgICAKICAgICAgICByZXR1cm4gUkNfT0s7CiAgICB9CiAgICAKICAgIC8q\nKgogICAgICogUmVhZCBhIHNwZWNpZmljIGxlZGdlcgogICAgICoKICAgICAq\nIEBwYXJhbSBsZWRnZXIgaW4gbWVtb3J5IGxlZGdlciByYW5nZQogICAgICog\nQHBhcmFtIGVuZFNlcUlkIGVuZCBzZXEgaWQKICAgICAqIEByZXR1cm4gdHJ1\nZSBpZiBjb250aW51ZSwgb3RoZXJ3aXNlIGZhbHNlCiAgICAgKiBAdGhyb3dz\nIEJLRXhjZXB0aW9uCiAgICAgKiBAdGhyb3dzIElPRXhjZXB0aW9uCiAgICAg\nKiBAdGhyb3dzIEludGVycnVwdGVkRXhjZXB0aW9uCiAgICAgKi8KICAgIHBy\nb3RlY3RlZCBib29sZWFuIHJlYWRMZWRnZXIoSW5NZW1vcnlMZWRnZXJSYW5n\nZSBsZWRnZXIsIGxvbmcgZW5kU2VxSWQpIHRocm93cyBCS0V4Y2VwdGlvbiwg\nSU9FeGNlcHRpb24sIEludGVycnVwdGVkRXhjZXB0aW9uIHsKICAgICAgICBs\nb25nIHRFbmRTZXFJZCA9IGVuZFNlcUlkOwogICAgICAgIAogICAgICAgIGlm\nICh0RW5kU2VxSWQgPCB0aGlzLnN0YXJ0U2VxSWQpIHsKICAgICAgICAgICAg\ncmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIC8vIE9wZW4gTGVkZ2Vy\nIEhhbmRsZQogICAgICAgIGxvbmcgbGVkZ2VySWQgPSBsZWRnZXIucmFuZ2Uu\nZ2V0TGVkZ2VySWQoKTsKICAgICAgICBTeXN0ZW0ub3V0LnByaW50bG4oIlxu\nPj4+Pj4gTGVkZ2VyICIgKyBsZWRnZXJJZCArICIgWyAiICsgbGVkZ2VyLnN0\nYXJ0U2VxSWRJbmNsdWRlZCArICIgfiAiICsgKGVuZFNlcUlkID09IExvbmcu\nTUFYX1ZBTFVFID8gIiIgOiBlbmRTZXFJZCkgKyAiXSA8PDw8PFxuIik7CiAg\nICAgICAgTGVkZ2VySGFuZGxlIGxoID0gbnVsbDsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBsaCA9IGFkbWluLmdldEJrSGFuZGxlKCkub3BlbkxlZGdl\nck5vUmVjb3ZlcnkobGVkZ2VySWQsIGFkbWluLmdldEJrRGlnZXN0VHlwZSgp\nLCBhZG1pbi5nZXRCa1Bhc3N3ZCgpKTsKICAgICAgICB9IGNhdGNoIChCS0V4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigi\nRVJST1I6IE5vIGxlZGdlciAiICsgbGVkZ2VySWQgKyAiIGZvdW5kLiBtYXli\nZSBnYXJiYWdlIGNvbGxlY3RlZCBkdWUgdG8gdGhlIG1lc3NhZ2VzIGFyZSBj\nb25zdW1lZC4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKG51bGwgPT0gbGgp\nIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAg\nIGxvbmcgZXhwZWN0ZWRFbnRyeUlkID0gc3RhcnRTZXFJZCAtIGxlZGdlci5z\ndGFydFNlcUlkSW5jbHVkZWQ7CiAgICAgICAgCiAgICAgICAgbG9uZyBjb3Jy\nZWN0ZWRFbmRTZXFJZCA9IHRFbmRTZXFJZDsKICAgICAgICB0cnkgewogICAg\nICAgICAgICB3aGlsZSAoc3RhcnRTZXFJZCA8PSB0RW5kU2VxSWQpIHsKICAg\nICAgICAgICAgICAgIGNvcnJlY3RlZEVuZFNlcUlkID0gTWF0aC5taW4oc3Rh\ncnRTZXFJZCArIE5VTV9NRVNTQUdFU19UT19QUklOVCAtIDEsIHRFbmRTZXFJ\nZCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHRyeSB7CiAg\nICAgICAgICAgICAgICAgICAgRW51bWVyYXRpb248TGVkZ2VyRW50cnk+IHNl\ncSA9IGxoLnJlYWRFbnRyaWVzKHN0YXJ0U2VxSWQgLSBsZWRnZXIuc3RhcnRT\nZXFJZEluY2x1ZGVkLCBjb3JyZWN0ZWRFbmRTZXFJZCAtIGxlZGdlci5zdGFy\ndFNlcUlkSW5jbHVkZWQpOwogICAgICAgICAgICAgICAgICAgIExlZGdlckVu\ndHJ5IGVudHJ5ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICB3aGlsZSAo\nc2VxLmhhc01vcmVFbGVtZW50cygpKSB7CiAgICAgICAgICAgICAgICAgICAg\nICAgIGVudHJ5ID0gc2VxLm5leHRFbGVtZW50KCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIE1lc3NhZ2UgbWVzc2FnZTsKICAgICAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3Nh\nZ2UgPSBNZXNzYWdlLnBhcnNlRnJvbShlbnRyeS5nZXRFbnRyeUlucHV0U3Ry\nZWFtKCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChJT0V4\nY2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTeXN0\nZW0ub3V0LnByaW50bG4oIldBUk46IFVucmVhZGFibGUgbWVzc2FnZSBmb3Vu\nZFxuIik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZEVu\ndHJ5SWQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVl\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChleHBlY3RlZEVudHJ5SWQgIT0gZW50cnkuZ2V0RW50cnlJ\nZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB8fCAobWVzc2FnZS5n\nZXRNc2dJZCgpLmdldExvY2FsQ29tcG9uZW50KCkgLSBsZWRnZXIuc3RhcnRT\nZXFJZEluY2x1ZGVkKSAhPSBleHBlY3RlZEVudHJ5SWQpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBJT0V4Y2VwdGlvbigiRVJS\nT1I6IE1lc3NhZ2UgaWRzIGFyZSBvdXQgb2Ygb3JkZXIgOiBleHBlY3RlZCBl\nbnRyeSBpZCAiICsgZXhwZWN0ZWRFbnRyeUlkCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiwgY3VycmVudCBl\nbnRyeSBpZCAiICsgZW50cnkuZ2V0RW50cnlJZCgpICsgIiwgbXNnIHNlcSBp\nZCAiICsgbWVzc2FnZS5nZXRNc2dJZCgpLmdldExvY2FsQ29tcG9uZW50KCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAg\nICAgICAgIGV4cGVjdGVkRW50cnlJZCsrOwogICAgICAgICAgICAgICAgICAg\nICAgICBmb3JtYXRNZXNzYWdlKG1lc3NhZ2UpOwoKICAgICAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgICAgICAgICAgc3RhcnRTZXFJZCA9IGNvcnJl\nY3RlZEVuZFNlcUlkICsgMTsKICAgICAgICAgICAgICAgICAgICBpZiAoaW5D\nb25zb2xlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJlc3NL\nZXlUb0NvbnRpbnVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKEJL\nRXhjZXB0aW9uLkJLUmVhZEV4Y2VwdGlvbiBiZSkgewogICAgICAgICAgICAg\nICAgICAgIHRocm93IGJlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9CiAgICAgICAgfSBjYXRjaCAoQktFeGNlcHRpb24gYmtlKSB7CiAgICAg\nICAgICAgIGlmICh0RW5kU2VxSWQgIT0gTG9uZy5NQVhfVkFMVUUpIHsKICAg\nICAgICAgICAgICAgIFN5c3RlbS5lcnIucHJpbnRsbigiRVJST1I6IGxlZGdl\nciAiICsgbGVkZ2VySWQgKyAiIG1heSBiZSBjb3JydXB0ZWQsIHNpbmNlIHJl\nYWQgbWVzc2FnZXMgWyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyBzdGFydFNlcUlkICsgIiB+ICIgKyBjb3JyZWN0ZWRFbmRTZXFJZCAr\nICIgXSBmYWlsZWQgOiIpOwogICAgICAgICAgICAgICAgdGhyb3cgYmtlOwog\nICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIFN5c3RlbS5vdXQucHJp\nbnRsbigiXG4iKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIAog\nICAgcHJvdGVjdGVkIHZvaWQgZm9ybWF0TWVzc2FnZShNZXNzYWdlIG1lc3Nh\nZ2UpIHsKICAgICAgICAvLyBwcmludCBtc2cgaWQKICAgICAgICBTdHJpbmcg\nbXNnSWQ7CiAgICAgICAgaWYgKCFtZXNzYWdlLmhhc01zZ0lkKCkpIHsKICAg\nICAgICAgICAgbXNnSWQgPSAiTi9BIjsKICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICBNZXNzYWdlU2VxSWQgc2VxSWQgPSBtZXNzYWdlLmdldE1zZ0lk\nKCk7CiAgICAgICAgICAgIFN0cmluZ0J1aWxkZXIgaWRCdWlsZGVyID0gbmV3\nIFN0cmluZ0J1aWxkZXIoKTsKICAgICAgICAgICAgaWYgKHNlcUlkLmhhc0xv\nY2FsQ29tcG9uZW50KCkpIHsKICAgICAgICAgICAgICAgIGlkQnVpbGRlci5h\ncHBlbmQoIkxPQ0FMKCIpLmFwcGVuZChzZXFJZC5nZXRMb2NhbENvbXBvbmVu\ndCgpKS5hcHBlbmQoIikiKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAg\nICAgICAgICAgIExpc3Q8UmVnaW9uU3BlY2lmaWNTZXFJZD4gcmVtb3RlSWRz\nID0gc2VxSWQuZ2V0UmVtb3RlQ29tcG9uZW50c0xpc3QoKTsKICAgICAgICAg\nICAgICAgIGludCBpID0gMCwgbnVtUmVnaW9ucyA9IHJlbW90ZUlkcy5zaXpl\nKCk7CiAgICAgICAgICAgICAgICBpZEJ1aWxkZXIuYXBwZW5kKCJSRU1PVEUo\nIik7CiAgICAgICAgICAgICAgICBmb3IgKFJlZ2lvblNwZWNpZmljU2VxSWQg\ncnNzaWQgOiByZW1vdGVJZHMpIHsKICAgICAgICAgICAgICAgICAgICBpZEJ1\naWxkZXIuYXBwZW5kKHJzc2lkLmdldFJlZ2lvbigpLnRvU3RyaW5nVXRmOCgp\nKTsKICAgICAgICAgICAgICAgICAgICBpZEJ1aWxkZXIuYXBwZW5kKCJbIik7\nCiAgICAgICAgICAgICAgICAgICAgaWRCdWlsZGVyLmFwcGVuZChyc3NpZC5n\nZXRTZXFJZCgpKTsKICAgICAgICAgICAgICAgICAgICBpZEJ1aWxkZXIuYXBw\nZW5kKCJdIik7CiAgICAgICAgICAgICAgICAgICAgKytpOwogICAgICAgICAg\nICAgICAgICAgIGlmIChpIDwgbnVtUmVnaW9ucykgewogICAgICAgICAgICAg\nICAgICAgICAgICBpZEJ1aWxkZXIuYXBwZW5kKCIsIik7CiAgICAgICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\naWRCdWlsZGVyLmFwcGVuZCgiKSIpOwogICAgICAgICAgICB9CiAgICAgICAg\nICAgIG1zZ0lkID0gaWRCdWlsZGVyLnRvU3RyaW5nKCk7CiAgICAgICAgfQog\nICAgICAgIFN5c3RlbS5vdXQucHJpbnRsbigiLS0tLS0tLS0tLSBNU0dJRD0i\nICsgbXNnSWQgKyAiIC0tLS0tLS0tLS0iKTsKICAgICAgICBTeXN0ZW0ub3V0\nLnByaW50bG4oIk1zZ0lkOiAgICAgIiArIG1zZ0lkKTsKICAgICAgICAvLyBw\ncmludCBzb3VyY2UgcmVnaW9uCiAgICAgICAgaWYgKG1lc3NhZ2UuaGFzU3Jj\nUmVnaW9uKCkpIHsKICAgICAgICAgICAgU3lzdGVtLm91dC5wcmludGxuKCJT\ncmNSZWdpb246ICIgKyBtZXNzYWdlLmdldFNyY1JlZ2lvbigpLnRvU3RyaW5n\nVXRmOCgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBTeXN0ZW0u\nb3V0LnByaW50bG4oIlNyY1JlZ2lvbjogTi9BIik7CiAgICAgICAgfQogICAg\nICAgIC8vIHByaW50IG1lc3NhZ2UgYm9keQogICAgICAgIFN5c3RlbS5vdXQu\ncHJpbnRsbigiTWVzc2FnZToiKTsKICAgICAgICBTeXN0ZW0ub3V0LnByaW50\nbG4oKTsKICAgICAgICBpZiAobWVzc2FnZS5oYXNCb2R5KCkpIHsKICAgICAg\nICAgICAgU3lzdGVtLm91dC5wcmludGxuKG1lc3NhZ2UuZ2V0Qm9keSgpLnRv\nU3RyaW5nVXRmOCgpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBT\neXN0ZW0ub3V0LnByaW50bG4oIk4vQSIpOwogICAgICAgIH0KICAgICAgICBT\neXN0ZW0ub3V0LnByaW50bG4oKTsKICAgIH0KICAgIAogICAgYm9vbGVhbiBw\ncmVzc0tleVRvQ29udGludWUoKSB0aHJvd3MgSU9FeGNlcHRpb24gewogICAg\nICAgIFN5c3RlbS5vdXQucHJpbnRsbigiUHJlc3MgWSB0byBjb250aW51ZS4u\nLiIpOwogICAgICAgIEJ1ZmZlcmVkUmVhZGVyIHN0ZGluID0gbmV3IEJ1ZmZl\ncmVkUmVhZGVyKG5ldyBJbnB1dFN0cmVhbVJlYWRlcihTeXN0ZW0uaW4pKTsK\nICAgICAgICBpbnQgY2ggPSBzdGRpbi5yZWFkKCk7CiAgICAgICAgaWYgKGNo\nID09ICd5JyB8fAogICAgICAgICAgICBjaCA9PSAnWScpIHsKICAgICAgICAg\nICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxz\nZTsKICAgIH0KfQo=\n","encoding":"base64"}

