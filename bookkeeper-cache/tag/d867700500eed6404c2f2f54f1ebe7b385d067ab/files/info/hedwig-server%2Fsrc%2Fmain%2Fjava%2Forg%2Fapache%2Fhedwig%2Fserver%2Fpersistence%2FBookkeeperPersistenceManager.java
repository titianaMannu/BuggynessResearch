{"sha":"c8a936ac26bb3110e47a4716bcd102a9d4d7b65d","node_id":"MDQ6QmxvYjE1NzU5NTY6YzhhOTM2YWMyNmJiMzExMGU0N2E0NzE2YmNkMTAyYTlkNGQ3YjY1ZA==","size":40384,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/c8a936ac26bb3110e47a4716bcd102a9d4d7b65d","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgamF2YS5pby5JT0V4Y2VwdGlvbjsKaW1wb3J0IGphdmEudXRpbC5F\nbnVtZXJhdGlvbjsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0\nIGphdmEudXRpbC5TZXQ7CmltcG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1w\nb3J0IGphdmEudXRpbC5NYXA7CmltcG9ydCBqYXZhLnV0aWwuVHJlZU1hcDsK\naW1wb3J0IGphdmEudXRpbC5jb25jdXJyZW50LkNvbmN1cnJlbnRIYXNoTWFw\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0\nb3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWlj\nLkF0b21pY0Jvb2xlYW47CgppbXBvcnQgb3JnLmFwYWNoZS5ib29ra2VlcGVy\nLmNsaWVudC5CS0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9va2tl\nZXBlci5jbGllbnQuQm9va0tlZXBlcjsKaW1wb3J0IG9yZy5hcGFjaGUuYm9v\na2tlZXBlci5jbGllbnQuTGVkZ2VyRW50cnk7CmltcG9ydCBvcmcuYXBhY2hl\nLmJvb2trZWVwZXIuY2xpZW50LkxlZGdlckhhbmRsZTsKaW1wb3J0IG9yZy5h\ncGFjaGUuYm9va2tlZXBlci5jbGllbnQuQm9va0tlZXBlci5EaWdlc3RUeXBl\nOwppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1wb3J0IG9yZy5zbGY0ai5M\nb2dnZXJGYWN0b3J5OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuQ3Jl\nYXRlTW9kZTsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4\nY2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0RlZnM7\nCmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5ab29LZWVwZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLnpvb2tlZXBlci5LZWVwZXJFeGNlcHRpb24uQ29kZTsK\naW1wb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLmRhdGEuU3RhdDsKCmltcG9y\ndCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBjb20u\nZ29vZ2xlLnByb3RvYnVmLkludmFsaWRQcm90b2NvbEJ1ZmZlckV4Y2VwdGlv\nbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmV4Y2VwdGlvbnMuUHViU3Vi\nRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuZXhjZXB0aW9u\ncy5QdWJTdWJFeGNlcHRpb24uU2VydmVyTm90UmVzcG9uc2libGVGb3JUb3Bp\nY0V4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29s\nLlB1YlN1YlByb3RvY29sLkxlZGdlclJhbmdlOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTGVkZ2VyUmFuZ2Vz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJv\ndG9jb2wuTWVzc2FnZTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3Rv\nY29sLlB1YlN1YlByb3RvY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvZXh0ZW5zaW9ucy5NZXNzYWdlSWRVdGlsczsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVy\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZl\nci5jb21tb24uVG9waWNPcFF1ZXVlcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnNlcnZlci5jb21tb24uVW5leHBlY3RlZEVycm9yOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBlcnNpc3RlbmNlLlNjYW5DYWxsYmFj\nay5SZWFzb25Gb3JGaW5pc2g7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5z\nZXJ2ZXIudG9waWNzLlRvcGljTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnNlcnZlci50b3BpY3MuVG9waWNPd25lcnNoaXBDaGFuZ2VMaXN0\nZW5lcjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJhY2s7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy56b29rZWVwZXIuU2FmZUFzeW5C\nS0NhbGxiYWNrOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuem9va2VlcGVy\nLlNhZmVBc3luY1pLQ2FsbGJhY2s7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdp\nZy56b29rZWVwZXIuWmtVdGlsczsKCi8qKgogKiBUaGlzIHBlcnNpc3RlbmNl\nIG1hbmFnZXIgdXNlcyB6b29rZWVwZXIgYW5kIGJvb2trZWVwZXIgdG8gc3Rv\ncmUgbWVzc2FnZXMuCiAqCiAqIEluZm9ybWF0aW9uIGFib3V0IHRvcGljcyBh\ncmUgc3RvcmVkIGluIHpvb2tlZXBlciB3aXRoIGEgem5vZGUgbmFtZWQgYWZ0\nZXIgdGhlCiAqIHRvcGljIHRoYXQgY29udGFpbnMgYW4gQVNDSUkgZW5jb2Rl\nZCBsaXN0IHdpdGggcmVjb3JkcyBvZiB0aGUgZm9sbG93aW5nIGZvcm06CiAq\nCiAqIDxwcmU+CiAqIHN0YXJ0U2VxSWQoaW5jbHVkZWQpXHRsZWRnZXJJZFxu\nCiAqIDwvcHJlPgogKgogKi8KCnB1YmxpYyBjbGFzcyBCb29ra2VlcGVyUGVy\nc2lzdGVuY2VNYW5hZ2VyIGltcGxlbWVudHMgUGVyc2lzdGVuY2VNYW5hZ2Vy\nV2l0aFJhbmdlU2NhbiwgVG9waWNPd25lcnNoaXBDaGFuZ2VMaXN0ZW5lciB7\nCiAgICBzdGF0aWMgTG9nZ2VyIGxvZ2dlciA9IExvZ2dlckZhY3RvcnkuZ2V0\nTG9nZ2VyKEJvb2trZWVwZXJQZXJzaXN0ZW5jZU1hbmFnZXIuY2xhc3MpOwog\nICAgc3RhdGljIGJ5dGVbXSBwYXNzd2QgPSAic2lsbHlzZWNyZXQiLmdldEJ5\ndGVzKCk7CiAgICBwcml2YXRlIEJvb2tLZWVwZXIgYms7CiAgICBwcml2YXRl\nIFpvb0tlZXBlciB6azsKICAgIHByaXZhdGUgU2VydmVyQ29uZmlndXJhdGlv\nbiBjZmc7CiAgICBwcml2YXRlIFRvcGljTWFuYWdlciB0bTsKCiAgICBzdGF0\naWMgY2xhc3MgSW5NZW1vcnlMZWRnZXJSYW5nZSB7CiAgICAgICAgTGVkZ2Vy\nUmFuZ2UgcmFuZ2U7CiAgICAgICAgbG9uZyBzdGFydFNlcUlkSW5jbHVkZWQ7\nIC8vIGluY2x1ZGVkLCBmb3IgdGhlIHZlcnkgZmlyc3QgbGVkZ2VyLCB0aGlz\nCiAgICAgICAgLy8gdmFsdWUgaXMgMQogICAgICAgIExlZGdlckhhbmRsZSBo\nYW5kbGU7CgogICAgICAgIHB1YmxpYyBJbk1lbW9yeUxlZGdlclJhbmdlKExl\nZGdlclJhbmdlIHJhbmdlLCBsb25nIHN0YXJ0U2VxSWQsIExlZGdlckhhbmRs\nZSBoYW5kbGUpIHsKICAgICAgICAgICAgdGhpcy5yYW5nZSA9IHJhbmdlOwog\nICAgICAgICAgICB0aGlzLnN0YXJ0U2VxSWRJbmNsdWRlZCA9IHN0YXJ0U2Vx\nSWQ7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlID0gaGFuZGxlOwogICAgICAg\nIH0KCiAgICAgICAgcHVibGljIEluTWVtb3J5TGVkZ2VyUmFuZ2UoTGVkZ2Vy\nUmFuZ2UgcmFuZ2UsIGxvbmcgc3RhcnRTZXFJZCkgewogICAgICAgICAgICB0\naGlzKHJhbmdlLCBzdGFydFNlcUlkLCBudWxsKTsKICAgICAgICB9CgogICAg\nfQoKICAgIHN0YXRpYyBjbGFzcyBUb3BpY0luZm8gewogICAgICAgIC8qKgog\nICAgICAgICAqIHN0b3JlcyB0aGUgbGFzdCBtZXNzYWdlLXNlcS1pZCB2ZWN0\nb3IgdGhhdCBoYXMgYmVlbiBwdXNoZWQgdG8gQksgZm9yCiAgICAgICAgICog\ncGVyc2lzdGVuY2UgKGJ1dCBub3QgbmVjZXNzYXJpbHkgYWNrZWQgeWV0IGJ5\nIEJLKQogICAgICAgICAqCiAgICAgICAgICovCiAgICAgICAgTWVzc2FnZVNl\ncUlkIGxhc3RTZXFJZFB1c2hlZDsKCiAgICAgICAgLyoqCiAgICAgICAgICog\nc3RvcmVzIHRoZSBsYXN0IG1lc3NhZ2UtaWQgdGhhdCBoYXMgYmVlbiBhY2tl\nZCBieSBCSy4gVGhpcyBudW1iZXIgaXMKICAgICAgICAgKiBiYXNpY2FsbHkg\ndXNlZCBmb3IgbGltaXRpbmcgc2NhbnMgdG8gbm90IHJlYWQgcGFzdCB3aGF0\nIGhhcyBiZWVuCiAgICAgICAgICogcGVyc2lzdGVkIGJ5IEJLCiAgICAgICAg\nICovCiAgICAgICAgbG9uZyBsYXN0RW50cnlJZEFja2VkSW5DdXJyZW50TGVk\nZ2VyID0gLTE7IC8vIGJlY2F1c2UgQksgbGVkZ2VycyBzdGFydHMKICAgICAg\nICAvLyBhdCAwCgogICAgICAgIC8qKgogICAgICAgICAqIHN0b3JlcyBhIHNv\ncnRlZCBzdHJ1Y3R1cmUgb2YgdGhlIGxlZGdlcnMgZm9yIGEgdG9waWMsIG1h\ncHBpbmcgZnJvbQogICAgICAgICAqIHRoZSBlbmRTZXFJZEluY2x1ZGVkIHRv\nIHRoZSBsZWRnZXIgaW5mby4gVGhpcyBzdHJ1Y3R1cmUgZG9lcyBub3QKICAg\nICAgICAgKiBpbmNsdWRlIHRoZSBjdXJyZW50IGxlZGdlcgogICAgICAgICAq\nLwogICAgICAgIFRyZWVNYXA8TG9uZywgSW5NZW1vcnlMZWRnZXJSYW5nZT4g\nbGVkZ2VyUmFuZ2VzID0gbmV3IFRyZWVNYXA8TG9uZywgSW5NZW1vcnlMZWRn\nZXJSYW5nZT4oKTsKICAgICAgICBpbnQgbGVkZ2VyUmFuZ2VzWm5vZGVWZXJz\naW9uID0gLTE7CgogICAgICAgIC8qKgogICAgICAgICAqIFRoaXMgaXMgdGhl\nIGhhbmRsZSBvZiB0aGUgY3VycmVudCBsZWRnZXIgdGhhdCBpcyBiZWluZyB1\nc2VkIHRvIHdyaXRlCiAgICAgICAgICogbWVzc2FnZXMKICAgICAgICAgKi8K\nICAgICAgICBJbk1lbW9yeUxlZGdlclJhbmdlIGN1cnJlbnRMZWRnZXJSYW5n\nZTsKCiAgICAgICAgLyoqCiAgICAgICAgICogRmxhZyB0byByZWxlYXNlIHRv\ncGljIHdoZW4gZW5jb3VudGVyaW5nIHVucmVjb3ZlcmFibGUgZXhjZXB0aW9u\ncwogICAgICAgICAqLwogICAgICAgIEF0b21pY0Jvb2xlYW4gZG9SZWxlYXNl\nID0gbmV3IEF0b21pY0Jvb2xlYW4oZmFsc2UpOwoKICAgICAgICBmaW5hbCBz\ndGF0aWMgaW50IFVOTElNSVRFRCA9IDA7CiAgICAgICAgaW50IG1lc3NhZ2VC\nb3VuZCA9IFVOTElNSVRFRDsKICAgIH0KCiAgICBNYXA8Qnl0ZVN0cmluZywg\nVG9waWNJbmZvPiB0b3BpY0luZm9zID0gbmV3IENvbmN1cnJlbnRIYXNoTWFw\nPEJ5dGVTdHJpbmcsIFRvcGljSW5mbz4oKTsKCiAgICBUb3BpY09wUXVldWVy\nIHF1ZXVlcjsKCiAgICAvKioKICAgICAqIEluc3RhbnRpYXRlcyBhIEJvb2tL\nZWVwZXJQZXJzaXN0ZW5jZSBtYW5hZ2VyLgogICAgICoKICAgICAqIEBwYXJh\nbSBiawogICAgICogICAgICAgICAgICBhIHJlZmVyZW5jZSB0byBib29ra2Vl\ncGVyIHRvIHVzZS4KICAgICAqIEBwYXJhbSB6awogICAgICogICAgICAgICAg\nICBhIHpvb2tlZXBlciBoYW5kbGUgdG8gdXNlLgogICAgICogQHBhcmFtIHpr\nUHJlZml4CiAgICAgKiAgICAgICAgICAgIHRoZSB6b29rZWVwZXIgc3VidHJl\nZSB0aGF0IHN0b3JlcyB0aGUgdG9waWMgdG8gbGVkZ2VyCiAgICAgKiAgICAg\nICAgICAgIGluZm9ybWF0aW9uLiBpZiB0aGlzIHByZWZpeCBkb2VzIG5vdCBl\neGlzdCwgaXQgd2lsbCBiZQogICAgICogICAgICAgICAgICBjcmVhdGVkLgog\nICAgICovCiAgICBwdWJsaWMgQm9va2tlZXBlclBlcnNpc3RlbmNlTWFuYWdl\ncihCb29rS2VlcGVyIGJrLCBab29LZWVwZXIgemssIFRvcGljTWFuYWdlciB0\nbSwgU2VydmVyQ29uZmlndXJhdGlvbiBjZmcsCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZWRFeGVjdXRvclNlcnZp\nY2UgZXhlY3V0b3IpIHsKICAgICAgICB0aGlzLmJrID0gYms7CiAgICAgICAg\ndGhpcy56ayA9IHprOwogICAgICAgIHRoaXMuY2ZnID0gY2ZnOwogICAgICAg\nIHRoaXMudG0gPSB0bTsKICAgICAgICBxdWV1ZXIgPSBuZXcgVG9waWNPcFF1\nZXVlcihleGVjdXRvcik7CiAgICAgICAgdG0uYWRkVG9waWNPd25lcnNoaXBD\naGFuZ2VMaXN0ZW5lcih0aGlzKTsKICAgIH0KCiAgICBjbGFzcyBSYW5nZVNj\nYW5PcCBleHRlbmRzIFRvcGljT3BRdWV1ZXIuU3luY2hyb25vdXNPcCB7CiAg\nICAgICAgUmFuZ2VTY2FuUmVxdWVzdCByZXF1ZXN0OwogICAgICAgIGludCBu\ndW1NZXNzYWdlc1JlYWQgPSAwOwogICAgICAgIGxvbmcgdG90YWxTaXplUmVh\nZCA9IDA7CiAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbzsKICAgICAgICBs\nb25nIHN0YXJ0U2VxSWRUb1NjYW47CgogICAgICAgIHB1YmxpYyBSYW5nZVNj\nYW5PcChSYW5nZVNjYW5SZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICAgICAg\ndGhpcyhyZXF1ZXN0LCAtMUwpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIFJhbmdlU2Nhbk9wKFJhbmdlU2NhblJlcXVlc3QgcmVxdWVzdCwgbG9uZyBz\ndGFydFNlcUlkKSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcihyZXF1ZXN0\nLnRvcGljKTsKICAgICAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDsK\nICAgICAgICAgICAgdGhpcy5zdGFydFNlcUlkVG9TY2FuID0gc3RhcnRTZXFJ\nZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHByb3Rl\nY3RlZCB2b2lkIHJ1bkludGVybmFsKCkgewogICAgICAgICAgICB0b3BpY0lu\nZm8gPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAgICAgICBpZiAo\ndG9waWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJlcXVlc3Qu\nY2FsbGJhY2suc2NhbkZhaWxlZChyZXF1ZXN0LmN0eCwgbmV3IFB1YlN1YkV4\nY2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9u\nKCIiKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIC8vIGlmIHN0YXJ0U2VxSWRUb1NjYW4gaXMgbGVzcyB0\naGFuIHplcm8sIHdoaWNoIG1lYW5zIGl0IGlzIGFuIHVuZmluaXNoZWQgc2Nh\nbiByZXF1ZXN0CiAgICAgICAgICAgIC8vIHdlIGNvbnRpbnVlIHRoZSBzY2Fu\nIGZyb20gdGhlIHByb3ZpZGVkIHBvc2l0aW9uCiAgICAgICAgICAgIHN0YXJ0\nUmVhZGluZ0Zyb20oc3RhcnRTZXFJZFRvU2NhbiA8IDAgPyByZXF1ZXN0LnN0\nYXJ0U2VxSWQgOiBzdGFydFNlcUlkVG9TY2FuKTsKICAgICAgICB9CgogICAg\nICAgIHByb3RlY3RlZCB2b2lkIHJlYWQoZmluYWwgSW5NZW1vcnlMZWRnZXJS\nYW5nZSBpbWxyLCBmaW5hbCBsb25nIHN0YXJ0U2VxSWQsIGZpbmFsIGxvbmcg\nZW5kU2VxSWQpIHsKCiAgICAgICAgICAgIGlmIChpbWxyLmhhbmRsZSA9PSBu\ndWxsKSB7CgogICAgICAgICAgICAgICAgYmsuYXN5bmNPcGVuTGVkZ2VyKGlt\nbHIucmFuZ2UuZ2V0TGVkZ2VySWQoKSwgRGlnZXN0VHlwZS5DUkMzMiwgcGFz\nc3dkLAogICAgICAgICAgICAgICAgbmV3IFNhZmVBc3luQktDYWxsYmFjay5P\ncGVuQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZU9wZW5Db21w\nbGV0ZShpbnQgcmMsIExlZGdlckhhbmRsZSBsZWRnZXJIYW5kbGUsIE9iamVj\ndCBjdHgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IEJL\nRXhjZXB0aW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGltbHIuaGFuZGxlID0gbGVkZ2VySGFuZGxlOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgcmVhZChpbWxyLCBzdGFydFNlcUlkLCBlbmRTZXFJ\nZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAg\nQktFeGNlcHRpb24gYmtlID0gQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJDb3VsZCBub3Qg\nb3BlbiBsZWRnZXI6ICIgKyBpbWxyLnJhbmdlLmdldExlZGdlcklkKCkgKyAi\nIGZvciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyB0b3BpYyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVl\nc3QuY2FsbGJhY2suc2NhbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRp\nb24uU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICB9LCByZXF1ZXN0LmN0eCk7CiAgICAgICAgICAgICAgICBy\nZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIGxlZGdlciBo\nYW5kbGUgaXMgbm90IG51bGwsIHdlIGNhbiByZWFkIGZyb20gaXQKICAgICAg\nICAgICAgbG9uZyBjb3JyZWN0ZWRFbmRTZXFJZCA9IE1hdGgubWluKHN0YXJ0\nU2VxSWQgKyByZXF1ZXN0Lm1lc3NhZ2VMaW1pdCAtIG51bU1lc3NhZ2VzUmVh\nZCAtIDEsIGVuZFNlcUlkKTsKCiAgICAgICAgICAgIGlmIChsb2dnZXIuaXNE\nZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVn\nKCJJc3N1aW5nIGEgYmsgcmVhZCBmb3IgbGVkZ2VyOiAiICsgaW1sci5oYW5k\nbGUuZ2V0SWQoKSArICIgZnJvbSBlbnRyeS1pZDogIgogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgKHN0YXJ0U2VxSWQgLSBpbWxyLnN0YXJ0U2Vx\nSWRJbmNsdWRlZCkgKyAiIHRvIGVudHJ5LWlkOiAiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgKyAoY29ycmVjdGVkRW5kU2VxSWQgLSBpbWxyLnN0\nYXJ0U2VxSWRJbmNsdWRlZCkpOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBpbWxyLmhhbmRsZS5hc3luY1JlYWRFbnRyaWVzKHN0YXJ0U2VxSWQgLSBp\nbWxyLnN0YXJ0U2VxSWRJbmNsdWRlZCwgY29ycmVjdGVkRW5kU2VxSWQKICAg\nICAgICAgICAgLSBpbWxyLnN0YXJ0U2VxSWRJbmNsdWRlZCwgbmV3IFNhZmVB\nc3luQktDYWxsYmFjay5SZWFkQ2FsbGJhY2soKSB7CgogICAgICAgICAgICAg\nICAgbG9uZyBleHBlY3RlZEVudHJ5SWQgPSBzdGFydFNlcUlkIC0gaW1sci5z\ndGFydFNlcUlkSW5jbHVkZWQ7CgogICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUmVhZENvbXBsZXRl\nKGludCByYywgTGVkZ2VySGFuZGxlIGxoLCBFbnVtZXJhdGlvbjxMZWRnZXJF\nbnRyeT4gc2VxLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAg\naWYgKHJjICE9IEJLRXhjZXB0aW9uLkNvZGUuT0sgfHwgIXNlcS5oYXNNb3Jl\nRWxlbWVudHMoKSkgewogICAgICAgICAgICAgICAgICAgICAgICBCS0V4Y2Vw\ndGlvbiBia2UgPSBCS0V4Y2VwdGlvbi5jcmVhdGUocmMpOwogICAgICAgICAg\nICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoIkVycm9yIHdoaWxlIHJlYWRp\nbmcgZnJvbSBsZWRnZXI6ICIgKyBpbWxyLnJhbmdlLmdldExlZGdlcklkKCkg\nKyAiIGZvciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgYmtlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFjay5zY2FuRmFpbGVk\nKHJlcXVlc3QuY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3du\nRXhjZXB0aW9uKGJrZSkpOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAg\nICBMZWRnZXJFbnRyeSBlbnRyeSA9IG51bGw7CiAgICAgICAgICAgICAgICAg\nICAgd2hpbGUgKHNlcS5oYXNNb3JlRWxlbWVudHMoKSkgewogICAgICAgICAg\nICAgICAgICAgICAgICBlbnRyeSA9IHNlcS5uZXh0RWxlbWVudCgpOwogICAg\nICAgICAgICAgICAgICAgICAgICBNZXNzYWdlIG1lc3NhZ2U7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBtZXNzYWdlID0gTWVzc2FnZS5wYXJzZUZyb20oZW50cnkuZ2V0RW50\ncnlJbnB1dFN0cmVhbSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBj\nYXRjaCAoSU9FeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgU3RyaW5nIG1zZyA9ICJVbnJlYWRhYmxlIG1lc3NhZ2UgZm91bmQg\naW4gbGVkZ2VyOiAiICsgaW1sci5yYW5nZS5nZXRMZWRnZXJJZCgpCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGZvciB0\nb3BpYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1zZywgZSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNrLnNjYW5GYWls\nZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlVuZXhwZWN0ZWRDb25kaXRp\nb25FeGNlcHRpb24obXNnKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgICAgICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJS\nZWFkIHJlc3BvbnNlIGZyb20gbGVkZ2VyOiAiICsgbGguZ2V0SWQoKSArICIg\nZW50cnktaWQ6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICArIGVudHJ5LmdldEVudHJ5SWQoKSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2VydCBl\neHBlY3RlZEVudHJ5SWQgPT0gZW50cnkuZ2V0RW50cnlJZCgpIDogImV4cGVj\ndGVkRW50cnlJZCAoIiArIGV4cGVjdGVkRW50cnlJZAogICAgICAgICAgICAg\nICAgICAgICAgICArICIpICE9IGVudHJ5LmdldEVudHJ5SWQoKSAoIiArIGVu\ndHJ5LmdldEVudHJ5SWQoKSArICIpIjsKICAgICAgICAgICAgICAgICAgICAg\nICAgYXNzZXJ0IChtZXNzYWdlLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21wb25l\nbnQoKSAtIGltbHIuc3RhcnRTZXFJZEluY2x1ZGVkKSA9PSBleHBlY3RlZEVu\ndHJ5SWQ7CgogICAgICAgICAgICAgICAgICAgICAgICBleHBlY3RlZEVudHJ5\nSWQrKzsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFj\nay5tZXNzYWdlU2Nhbm5lZChjdHgsIG1lc3NhZ2UpOwogICAgICAgICAgICAg\nICAgICAgICAgICBudW1NZXNzYWdlc1JlYWQrKzsKICAgICAgICAgICAgICAg\nICAgICAgICAgdG90YWxTaXplUmVhZCArPSBtZXNzYWdlLmdldEJvZHkoKS5z\naXplKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVtTWVzc2Fn\nZXNSZWFkID49IHJlcXVlc3QubWVzc2FnZUxpbWl0KSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNrLnNjYW5GaW5pc2hl\nZChjdHgsIFJlYXNvbkZvckZpbmlzaC5OVU1fTUVTU0FHRVNfTElNSVRfRVhD\nRUVERUQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwog\nICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAg\nICAgICBpZiAodG90YWxTaXplUmVhZCA+PSByZXF1ZXN0LnNpemVMaW1pdCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFj\nay5zY2FuRmluaXNoZWQoY3R4LCBSZWFzb25Gb3JGaW5pc2guU0laRV9MSU1J\nVF9FWENFRURFRCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIGNvbnRpbnVlIHNjYW5u\naW5nIG1lc3NhZ2VzCiAgICAgICAgICAgICAgICAgICAgc2Nhbk1lc3NhZ2Vz\nKHJlcXVlc3QsIGltbHIuc3RhcnRTZXFJZEluY2x1ZGVkICsgZW50cnkuZ2V0\nRW50cnlJZCgpICsgMSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0sIHJlcXVlc3QuY3R4KTsKICAgICAgICB9CgogICAgICAgIHByb3RlY3Rl\nZCB2b2lkIHN0YXJ0UmVhZGluZ0Zyb20obG9uZyBzdGFydFNlcUlkKSB7Cgog\nICAgICAgICAgICBNYXAuRW50cnk8TG9uZywgSW5NZW1vcnlMZWRnZXJSYW5n\nZT4gZW50cnkgPSB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmNlaWxpbmdFbnRy\neShzdGFydFNlcUlkKTsKCiAgICAgICAgICAgIGlmIChlbnRyeSA9PSBudWxs\nKSB7CiAgICAgICAgICAgICAgICAvLyBOb25lIG9mIHRoZSBvbGQgbGVkZ2Vy\ncyBoYXZlIHRoaXMgc2VxLWlkLCB3ZSBtdXN0IHVzZSB0aGUKICAgICAgICAg\nICAgICAgIC8vIGN1cnJlbnQgbGVkZ2VyCiAgICAgICAgICAgICAgICBsb25n\nIGVuZFNlcUlkID0gdG9waWNJbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5zdGFy\ndFNlcUlkSW5jbHVkZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArIHRvcGljSW5mby5sYXN0RW50cnlJZEFja2VkSW5DdXJyZW50TGVkZ2Vy\nOwoKICAgICAgICAgICAgICAgIGlmIChlbmRTZXFJZCA8IHN0YXJ0U2VxSWQp\nIHsKICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LmNhbGxiYWNrLnNjYW5G\naW5pc2hlZChyZXF1ZXN0LmN0eCwgUmVhc29uRm9yRmluaXNoLk5PX01PUkVf\nTUVTU0FHRVMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZWFkKHRvcGljSW5mby5j\ndXJyZW50TGVkZ2VyUmFuZ2UsIHN0YXJ0U2VxSWQsIGVuZFNlcUlkKTsKICAg\nICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlYWQoZW50cnku\nZ2V0VmFsdWUoKSwgc3RhcnRTZXFJZCwgZW50cnkuZ2V0VmFsdWUoKS5yYW5n\nZS5nZXRFbmRTZXFJZEluY2x1ZGVkKCkuZ2V0TG9jYWxDb21wb25lbnQoKSk7\nCiAgICAgICAgICAgIH0KCiAgICAgICAgfQoKICAgIH0KCiAgICBAT3ZlcnJp\nZGUKICAgIHB1YmxpYyB2b2lkIHNjYW5NZXNzYWdlcyhSYW5nZVNjYW5SZXF1\nZXN0IHJlcXVlc3QpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVu\nKHJlcXVlc3QudG9waWMsIG5ldyBSYW5nZVNjYW5PcChyZXF1ZXN0KSk7CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgc2Nhbk1lc3NhZ2VzKFJhbmdlU2Nh\nblJlcXVlc3QgcmVxdWVzdCwgbG9uZyBzY2FuU2VxSWQpIHsKICAgICAgICBx\ndWV1ZXIucHVzaEFuZE1heWJlUnVuKHJlcXVlc3QudG9waWMsIG5ldyBSYW5n\nZVNjYW5PcChyZXF1ZXN0LCBzY2FuU2VxSWQpKTsKICAgIH0KCiAgICBwdWJs\naWMgdm9pZCBkZWxpdmVyZWRVbnRpbChCeXRlU3RyaW5nIHRvcGljLCBMb25n\nIHNlcUlkKSB7CiAgICAgICAgLy8gTm90aGluZyB0byBkbyBoZXJlLiB0aGlz\nIGlzIGp1c3QgYSBoaW50IHRoYXQgd2UgY2Fubm90IHVzZS4KICAgIH0KCiAg\nICBjbGFzcyBVcGRhdGVMZWRnZXJPcCBleHRlbmRzIFRvcGljT3BRdWV1ZXIu\nQXN5bmNocm9ub3VzT3A8Vm9pZD4gewogICAgICAgIHByaXZhdGUgbG9uZyBs\nZWRnZXJEZWxldGVkOwoKICAgICAgICBwdWJsaWMgVXBkYXRlTGVkZ2VyT3Ao\nQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgQ2FsbGJhY2s8Vm9pZD4gY2IsIGZp\nbmFsIE9iamVjdCBjdHgsIGZpbmFsIGxvbmcgbGVkZ2VyRGVsZXRlZCkgewog\nICAgICAgICAgICBxdWV1ZXIuc3VwZXIodG9waWMsIGNiLCBjdHgpOwogICAg\nICAgICAgICB0aGlzLmxlZGdlckRlbGV0ZWQgPSBsZWRnZXJEZWxldGVkOwog\nICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVibGljIHZv\naWQgcnVuKCkgewogICAgICAgICAgICBmaW5hbCBUb3BpY0luZm8gdG9waWNJ\nbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMpOwogICAgICAgICAgICBpZiAo\ndG9waWNJbmZvID09IG51bGwpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5l\ncnJvcigiU2VydmVyIGlzIG5vdCByZXNwb25zaWJsZSBmb3IgdG9waWMhIik7\nCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAg\nICAgICAgYm9vbGVhbiBuZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgICAgICAg\nICBMZWRnZXJSYW5nZXMuQnVpbGRlciBidWlsZGVyID0gTGVkZ2VyUmFuZ2Vz\nLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgZmluYWwgU2V0PExvbmc+IGtl\neXNUb1JlbW92ZSA9IG5ldyBIYXNoU2V0PExvbmc+KCk7CiAgICAgICAgICAg\nIGZvciAoTWFwLkVudHJ5PExvbmcsIEluTWVtb3J5TGVkZ2VyUmFuZ2U+IGUg\nOiB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmVudHJ5U2V0KCkpIHsKICAgICAg\nICAgICAgICAgIGlmIChlLmdldFZhbHVlKCkucmFuZ2UuZ2V0TGVkZ2VySWQo\nKSA9PSBsZWRnZXJEZWxldGVkKSB7CiAgICAgICAgICAgICAgICAgICAgbmVl\nZHNVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGtleXNUb1Jl\nbW92ZS5hZGQoZS5nZXRLZXkoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2Ug\newogICAgICAgICAgICAgICAgICAgIGJ1aWxkZXIuYWRkUmFuZ2VzKGUuZ2V0\nVmFsdWUoKS5yYW5nZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0KICAgICAgICAgICAgYnVpbGRlci5hZGRSYW5nZXModG9waWNJbmZvLmN1\ncnJlbnRMZWRnZXJSYW5nZS5yYW5nZSk7CgogICAgICAgICAgICBpZiAobmVl\nZHNVcGRhdGUpIHsKICAgICAgICAgICAgICAgIGZpbmFsIExlZGdlclJhbmdl\ncyBuZXdSYW5nZXMgPSBidWlsZGVyLmJ1aWxkKCk7CiAgICAgICAgICAgICAg\nICB1cGRhdGVMZWRnZXJSYW5nZXNOb2RlKHRvcGljLCBuZXdSYW5nZXMsIHRv\ncGljSW5mby5sZWRnZXJSYW5nZXNabm9kZVZlcnNpb24sCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBDYWxsYmFjazxJbnRl\nZ2VyPigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBj\ndHgsIEludGVnZXIgbmV3VmVyc2lvbikgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZpbmFsbHksIGFsbCBk\nb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgZm9yIChMb25nIGsgOiBrZXlzVG9SZW1vdmUpIHsKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9w\naWNJbmZvLmxlZGdlclJhbmdlcy5yZW1vdmUoayk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcGljSW5m\nby5sZWRnZXJSYW5nZXNabm9kZVZlcnNpb24gPSBuZXdWZXJzaW9uOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNi\nLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVy\nYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2Vw\ndGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGN0\neCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjYi5v\ncGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwogICAgICAgICAgICB9CiAg\nICAgICAgfQogICAgfQoKICAgIGNsYXNzIENvbnN1bWVVbnRpbE9wIGV4dGVu\nZHMgVG9waWNPcFF1ZXVlci5TeW5jaHJvbm91c09wIHsKICAgICAgICBwcml2\nYXRlIGZpbmFsIGxvbmcgc2VxSWQ7CgogICAgICAgIHB1YmxpYyBDb25zdW1l\nVW50aWxPcChCeXRlU3RyaW5nIHRvcGljLCBsb25nIHNlcUlkKSB7CiAgICAg\nICAgICAgIHF1ZXVlci5zdXBlcih0b3BpYyk7CiAgICAgICAgICAgIHRoaXMu\nc2VxSWQgPSBzZXFJZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyB2b2lkIHJ1bkludGVybmFsKCkgewogICAgICAgICAg\nICBUb3BpY0luZm8gdG9waWNJbmZvID0gdG9waWNJbmZvcy5nZXQodG9waWMp\nOwogICAgICAgICAgICBpZiAodG9waWNJbmZvID09IG51bGwpIHsKICAgICAg\nICAgICAgICAgIGxvZ2dlci5lcnJvcigiU2VydmVyIGlzIG5vdCByZXNwb25z\naWJsZSBmb3IgdG9waWMhIik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoTG9uZyBlbmRTZXFJZElu\nY2x1ZGVkIDogdG9waWNJbmZvLmxlZGdlclJhbmdlcy5rZXlTZXQoKSkgewog\nICAgICAgICAgICAgICAgaWYgKGVuZFNlcUlkSW5jbHVkZWQgPD0gc2VxSWQp\nIHsKICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIGxlZGdlcidzIG1lc3Nh\nZ2UgZW50cmllcyBoYXZlIGFsbCBiZWVuIGNvbnN1bWVkIGFscmVhZHkKICAg\nICAgICAgICAgICAgICAgICAvLyBzbyBpdCBpcyBzYWZlIHRvIGRlbGV0ZSBp\ndCBmcm9tIEJvb2tLZWVwZXIuCiAgICAgICAgICAgICAgICAgICAgbG9uZyBs\nZWRnZXJJZCA9IHRvcGljSW5mby5sZWRnZXJSYW5nZXMuZ2V0KGVuZFNlcUlk\nSW5jbHVkZWQpLnJhbmdlLmdldExlZGdlcklkKCk7CiAgICAgICAgICAgICAg\nICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgICAgICAgYmsuZGVsZXRl\nTGVkZ2VyKGxlZGdlcklkKTsKICAgICAgICAgICAgICAgICAgICAgICAgQ2Fs\nbGJhY2s8Vm9pZD4gY2IgPSBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25G\naW5pc2hlZChPYmplY3QgY3R4LCBWb2lkIHJlc3VsdCkgewogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdGhpbmcsIG9wIGlzIGFz\neW5jIHRvIHN0b3Agb3RoZXIgb3BzCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgLy8gb2NjdXJyaW5nIG9uIHRoZSB0b3BpYyBkdXJpbmcgdGhl\nIHVwZGF0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFp\nbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3Io\nIkZhaWxlZCB0byB1cGRhdGUgbGVkZ2VyIHpub2RlIiwgZXhjZXB0aW9uKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAg\nICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVyLnB1\nc2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IFVwZGF0ZUxlZGdlck9wKHRvcGlj\nLCBjYiwgbnVsbCwgbGVkZ2VySWQpKTsKICAgICAgICAgICAgICAgICAgICB9\nIGNhdGNoIChFeGNlcHRpb24gZSkgewogICAgICAgICAgICAgICAgICAgICAg\nICAvLyBGb3Igbm93LCBqdXN0IGxvZyBhbiBleGNlcHRpb24gZXJyb3IgbWVz\nc2FnZS4gSW4gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZ1dHVy\nZSwgd2UgY2FuIGhhdmUgbW9yZSBjb21wbGljYXRlZCByZXRyeSBsb2dpYyB0\nbwogICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgYSBjb25zdW1l\nZCBsZWRnZXIuIFRoZSBuZXh0IHRpbWUgdGhlIGxlZGdlcgogICAgICAgICAg\nICAgICAgICAgICAgICAvLyBnYXJiYWdlIGNvbGxlY3Rpb24gam9iIHJ1bnMs\nIHdlJ2xsIG9uY2UgYWdhaW4gdHJ5IHRvCiAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGRlbGV0ZSB0aGlzIGxlZGdlci4KICAgICAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLmVycm9yKCJFeGNlcHRpb24gd2hpbGUgZGVsZXRpbmcg\nY29uc3VtZWQgbGVkZ2VySWQ6ICIgKyBsZWRnZXJJZCwgZSk7CiAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlCiAgICAgICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY29uc3VtZWRVbnRpbChCeXRlU3RyaW5n\nIHRvcGljLCBMb25nIHNlcUlkKSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRN\nYXliZVJ1bih0b3BpYywgbmV3IENvbnN1bWVVbnRpbE9wKHRvcGljLCBNYXRo\nLm1heChzZXFJZCwgZ2V0TWluU2VxSWRGb3JUb3BpYyh0b3BpYykpKSk7CiAg\nICB9CgogICAgcHVibGljIHZvaWQgY29uc3VtZVRvQm91bmQoQnl0ZVN0cmlu\nZyB0b3BpYykgewogICAgICAgIFRvcGljSW5mbyB0b3BpY0luZm8gPSB0b3Bp\nY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAgIGlmICh0b3BpY0luZm8gPT0g\nbnVsbCB8fCB0b3BpY0luZm8ubWVzc2FnZUJvdW5kID09IHRvcGljSW5mby5V\nTkxJTUlURUQpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAg\nICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgQ29uc3Vt\nZVVudGlsT3AodG9waWMsIGdldE1pblNlcUlkRm9yVG9waWModG9waWMpKSk7\nCiAgICB9CgogICAgcHVibGljIGxvbmcgZ2V0TWluU2VxSWRGb3JUb3BpYyhC\neXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAgVG9waWNJbmZvIHRvcGljSW5m\nbyA9IHRvcGljSW5mb3MuZ2V0KHRvcGljKTsKCiAgICAgICAgaWYgKHRvcGlj\nSW5mbyA9PSBudWxsIHx8IHRvcGljSW5mby5tZXNzYWdlQm91bmQgPT0gdG9w\naWNJbmZvLlVOTElNSVRFRCkgewogICAgICAgICAgICByZXR1cm4gTG9uZy5N\nSU5fVkFMVUU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJu\nICh0b3BpY0luZm8ubGFzdFNlcUlkUHVzaGVkLmdldExvY2FsQ29tcG9uZW50\nKCkgLSB0b3BpY0luZm8ubWVzc2FnZUJvdW5kKSArIDE7CiAgICAgICAgfQog\nICAgfQoKICAgIHB1YmxpYyBNZXNzYWdlU2VxSWQgZ2V0Q3VycmVudFNlcUlk\nRm9yVG9waWMoQnl0ZVN0cmluZyB0b3BpYykgdGhyb3dzIFNlcnZlck5vdFJl\nc3BvbnNpYmxlRm9yVG9waWNFeGNlcHRpb24gewogICAgICAgIFRvcGljSW5m\nbyB0b3BpY0luZm8gPSB0b3BpY0luZm9zLmdldCh0b3BpYyk7CgogICAgICAg\nIGlmICh0b3BpY0luZm8gPT0gbnVsbCkgewogICAgICAgICAgICB0aHJvdyBu\nZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9w\naWNFeGNlcHRpb24oIiIpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRv\ncGljSW5mby5sYXN0U2VxSWRQdXNoZWQ7CiAgICB9CgogICAgcHVibGljIGxv\nbmcgZ2V0U2VxSWRBZnRlclNraXBwaW5nKEJ5dGVTdHJpbmcgdG9waWMsIGxv\nbmcgc2VxSWQsIGludCBza2lwQW1vdW50KSB7CiAgICAgICAgcmV0dXJuIE1h\ndGgubWF4KHNlcUlkICsgc2tpcEFtb3VudCwgZ2V0TWluU2VxSWRGb3JUb3Bp\nYyh0b3BpYykpOwogICAgfQoKICAgIHB1YmxpYyBjbGFzcyBQZXJzaXN0T3Ag\nZXh0ZW5kcyBUb3BpY09wUXVldWVyLlN5bmNocm9ub3VzT3AgewogICAgICAg\nIFBlcnNpc3RSZXF1ZXN0IHJlcXVlc3Q7CgogICAgICAgIHB1YmxpYyBQZXJz\naXN0T3AoUGVyc2lzdFJlcXVlc3QgcmVxdWVzdCkgewogICAgICAgICAgICBx\ndWV1ZXIuc3VwZXIocmVxdWVzdC50b3BpYyk7CiAgICAgICAgICAgIHRoaXMu\ncmVxdWVzdCA9IHJlcXVlc3Q7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW5JbnRlcm5hbCgpIHsKICAgICAg\nICAgICAgZmluYWwgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5mb3Mu\nZ2V0KHRvcGljKTsKCiAgICAgICAgICAgIGlmICh0b3BpY0luZm8gPT0gbnVs\nbCkgewogICAgICAgICAgICAgICAgcmVxdWVzdC5jYWxsYmFjay5vcGVyYXRp\nb25GYWlsZWQocmVxdWVzdC5jdHgsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHViU3ViRXhjZXB0aW9u\nLlNlcnZlck5vdFJlc3BvbnNpYmxlRm9yVG9waWNFeGNlcHRpb24oIiIpKTsK\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAg\nICAgICAgaWYgKHRvcGljSW5mby5kb1JlbGVhc2UuZ2V0KCkpIHsKICAgICAg\nICAgICAgICAgIHJlcXVlc3QuY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKHJl\ncXVlc3QuY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhj\nZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICJUaGUgb3duZXJzaGlwIG9m\nIHRoZSB0b3BpYyBpcyByZWxlYXNpbmcgZHVlIHRvIHVucmVjb3ZlcmFibGUg\naXNzdWUuIikpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICB9CgogICAgICAgICAgICBmaW5hbCBsb25nIGxvY2FsU2VxSWQgPSB0b3Bp\nY0luZm8ubGFzdFNlcUlkUHVzaGVkLmdldExvY2FsQ29tcG9uZW50KCkgKyAx\nOwogICAgICAgICAgICBNZXNzYWdlU2VxSWQuQnVpbGRlciBidWlsZGVyID0g\nTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIoKTsKICAgICAgICAgICAgaWYgKHJl\ncXVlc3QubWVzc2FnZS5oYXNNc2dJZCgpKSB7CiAgICAgICAgICAgICAgICBN\nZXNzYWdlSWRVdGlscy50YWtlUmVnaW9uTWF4aW11bShidWlsZGVyLCB0b3Bp\nY0luZm8ubGFzdFNlcUlkUHVzaGVkLCByZXF1ZXN0Lm1lc3NhZ2UuZ2V0TXNn\nSWQoKSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBi\ndWlsZGVyLmFkZEFsbFJlbW90ZUNvbXBvbmVudHModG9waWNJbmZvLmxhc3RT\nZXFJZFB1c2hlZC5nZXRSZW1vdGVDb21wb25lbnRzTGlzdCgpKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICBidWlsZGVyLnNldExvY2FsQ29tcG9uZW50\nKGxvY2FsU2VxSWQpOwoKICAgICAgICAgICAgdG9waWNJbmZvLmxhc3RTZXFJ\nZFB1c2hlZCA9IGJ1aWxkZXIuYnVpbGQoKTsKICAgICAgICAgICAgTWVzc2Fn\nZSBtc2dUb1NlcmlhbGl6ZSA9IE1lc3NhZ2UubmV3QnVpbGRlcihyZXF1ZXN0\nLm1lc3NhZ2UpLnNldE1zZ0lkKHRvcGljSW5mby5sYXN0U2VxSWRQdXNoZWQp\nLmJ1aWxkKCk7CgogICAgICAgICAgICB0b3BpY0luZm8uY3VycmVudExlZGdl\nclJhbmdlLmhhbmRsZS5hc3luY0FkZEVudHJ5KG1zZ1RvU2VyaWFsaXplLnRv\nQnl0ZUFycmF5KCksCiAgICAgICAgICAgIG5ldyBTYWZlQXN5bkJLQ2FsbGJh\nY2suQWRkQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVBZGRDb21wbGV0ZShp\nbnQgcmMsIExlZGdlckhhbmRsZSBsaCwgbG9uZyBlbnRyeUlkLCBPYmplY3Qg\nY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJjICE9IEJLRXhjZXB0\naW9uLkNvZGUuT0spIHsKICAgICAgICAgICAgICAgICAgICAgICAgQktFeGNl\ncHRpb24gYmtlID0gQktFeGNlcHRpb24uY3JlYXRlKHJjKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJFcnJvciB3aGlsZSBwZXJz\naXN0aW5nIGVudHJ5IHRvIGxlZGdlcjogIiArIGxoLmdldElkKCkgKyAiIGZv\nciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSwgYmtlKTsKCiAgICAgICAgICAg\nICAgICAgICAgICAgIC8vIFRvIHByZXNlcnZlIG9yZGVyaW5nIGd1YXJhbnRl\nZXMsIHdlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3VsZCBnaXZl\nIHVwIHRoZSB0b3BpYyBhbmQgbm90IGxldAogICAgICAgICAgICAgICAgICAg\nICAgICAvLyBvdGhlciBvcGVyYXRpb25zIHRocm91Z2gKICAgICAgICAgICAg\nICAgICAgICAgICAgaWYgKHRvcGljSW5mby5kb1JlbGVhc2UuY29tcGFyZUFu\nZFNldChmYWxzZSwgdHJ1ZSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIHRtLnJlbGVhc2VUb3BpYyhyZXF1ZXN0LnRvcGljLCBuZXcgQ2FsbGJh\nY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjdHgsIFB1YlN1YkV4\nY2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJFeGNlcHRpb24gZm91bmQgb24g\ncmVsZWFzaW5nIHRvcGljICIgKyByZXF1ZXN0LnRvcGljLnRvU3RyaW5nVXRm\nOCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiIHdoZW4gZW5jb3VudGVyaW5nIGV4Y2VwdGlvbiBmcm9tIGJv\nb2trZWVwZXI6IiwgZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVi\nbGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCBy\nZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBsb2dnZXIuZGVidWcoInN1Y2Nlc3NmdWxseSByZWxlYXNp\nbmcgdG9waWMge30gd2hlbiBlbmNvdW50ZXJpbmciCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIgZXhjZXB0\naW9uIGZyb20gYm9va2tlZXBlciIsIHJlcXVlc3QudG9waWMudG9TdHJpbmdV\ndGY4KCkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVl\nc3QuY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4\nY2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihia2UpKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5SWQgKyB0b3BpY0luZm8u\nY3VycmVudExlZGdlclJhbmdlLnN0YXJ0U2VxSWRJbmNsdWRlZCAhPSBsb2Nh\nbFNlcUlkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIFN0cmluZyBtc2cg\nPSAiRXhwZWN0ZWQgQksgdG8gYXNzaWduIGVudHJ5LWlkOiAiCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIChsb2NhbFNlcUlkIC0g\ndG9waWNJbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5zdGFydFNlcUlkSW5jbHVk\nZWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArICIg\nYnV0IGl0IGluc3RlYWQgYXNzaWduZWQgZW50cnktaWQ6ICIgKyBlbnRyeUlk\nICsgIiB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICJsZWRnZXI6ICIgKyBs\naC5nZXRJZCgpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJy\nb3IobXNnKTsKICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVu\nZXhwZWN0ZWRFcnJvcihtc2cpOwogICAgICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLmxhc3RFbnRyeUlkQWNrZWRJ\nbkN1cnJlbnRMZWRnZXIgPSBlbnRyeUlkOwogICAgICAgICAgICAgICAgICAg\nIHJlcXVlc3QuY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBsb2Nh\nbFNlcUlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgcmVx\ndWVzdC5jdHgpOwoKICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZvaWQg\ncGVyc2lzdE1lc3NhZ2UoUGVyc2lzdFJlcXVlc3QgcmVxdWVzdCkgewogICAg\nICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4ocmVxdWVzdC50b3BpYywgbmV3\nIFBlcnNpc3RPcChyZXF1ZXN0KSk7CiAgICB9CgogICAgcHVibGljIHZvaWQg\nc2NhblNpbmdsZU1lc3NhZ2UoU2NhblJlcXVlc3QgcmVxdWVzdCkgewogICAg\nICAgIHRocm93IG5ldyBSdW50aW1lRXhjZXB0aW9uKCJOb3QgaW1wbGVtZW50\nZWQiKTsKICAgIH0KCiAgICBzdGF0aWMgU2FmZUFzeW5CS0NhbGxiYWNrLkNs\nb3NlQ2FsbGJhY2sgbm9PcENsb3NlQ2FsbGJhY2sgPSBuZXcgU2FmZUFzeW5C\nS0NhbGxiYWNrLkNsb3NlQ2FsbGJhY2soKSB7CiAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgcHVibGljIHZvaWQgc2FmZUNsb3NlQ29tcGxldGUoaW50IHJj\nLCBMZWRnZXJIYW5kbGUgbGVkZ2VySGFuZGxlLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgfTsKICAgIH07CgogICAgU3RyaW5nIGxlZGdlcnNQYXRoKEJ5dGVT\ndHJpbmcgdG9waWMpIHsKICAgICAgICByZXR1cm4gY2ZnLmdldFprVG9waWNQ\nYXRoKG5ldyBTdHJpbmdCdWlsZGVyKCksIHRvcGljKS5hcHBlbmQoIi9sZWRn\nZXJzIikudG9TdHJpbmcoKTsKICAgIH0KCiAgICBjbGFzcyBBY3F1aXJlT3Ag\nZXh0ZW5kcyBUb3BpY09wUXVldWVyLkFzeW5jaHJvbm91c09wPFZvaWQ+IHsK\nICAgICAgICBwdWJsaWMgQWNxdWlyZU9wKEJ5dGVTdHJpbmcgdG9waWMsIENh\nbGxiYWNrPFZvaWQ+IGNiLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHF1\nZXVlci5zdXBlcih0b3BpYywgY2IsIGN0eCk7CiAgICAgICAgfQoKICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAg\nICAgICAgIGlmICh0b3BpY0luZm9zLmNvbnRhaW5zS2V5KHRvcGljKSkgewog\nICAgICAgICAgICAgICAgLy8gQWxyZWFkeSBhY3F1aXJlZCwgZG8gbm90aGlu\nZwogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBu\ndWxsKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQog\nICAgICAgICAgICAvLyByZWFkIHRvcGljIGxlZGdlcnMgbm9kZSBkYXRhCiAg\nICAgICAgICAgIGZpbmFsIFN0cmluZyB6Tm9kZVBhdGggPSBsZWRnZXJzUGF0\naCh0b3BpYyk7CgogICAgICAgICAgICB6ay5nZXREYXRhKHpOb2RlUGF0aCwg\nZmFsc2UsIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLkRhdGFDYWxsYmFjaygp\nIHsKICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAg\ncHVibGljIHZvaWQgc2FmZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcg\ncGF0aCwgT2JqZWN0IGN0eCwgYnl0ZVtdIGRhdGEsIFN0YXQgc3RhdCkgewog\nICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBDb2RlLk9LLmludFZhbHVl\nKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1RvcGljTGVk\nZ2Vyc05vZGVEYXRhKGRhdGEsIHN0YXQuZ2V0VmVyc2lvbigpKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHJjID09IENvZGUuTk9OT0RF\nLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3Jl\nYXRlIGl0CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbmFsIGJ5dGVbXSBp\nbml0aWFsRGF0YSA9IExlZGdlclJhbmdlcy5nZXREZWZhdWx0SW5zdGFuY2Uo\nKS50b0J5dGVBcnJheSgpOwogICAgICAgICAgICAgICAgICAgICAgICBaa1V0\naWxzLmNyZWF0ZUZ1bGxQYXRoT3B0aW1pc3RpYyh6aywgek5vZGVQYXRoLCBp\nbml0aWFsRGF0YSwgWm9vRGVmcy5JZHMuT1BFTl9BQ0xfVU5TQUZFLAogICAg\nICAgICAgICAgICAgICAgICAgICBDcmVhdGVNb2RlLlBFUlNJU1RFTlQsIG5l\ndyBTYWZlQXN5bmNaS0NhbGxiYWNrLlN0cmluZ0NhbGxiYWNrKCkgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3Vs\ndChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4LCBTdHJpbmcgbmFt\nZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyYyAh\nPSBDb2RlLk9LLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIGtlID0gWmtVdGlscy5s\nb2dFcnJvckFuZENyZWF0ZVpLRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIkNvdWxkIG5vdCBjcmVhdGUgbGVkZ2VycyBub2RlIGZvciB0b3BpYzogIiAr\nIHRvcGljLnRvU3RyaW5nVXRmOCgpLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCwg\ncmMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5v\ncGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZp\nY2VEb3duRXhjZXB0aW9uKGtlKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g\naW5pdGlhbCB2ZXJzaW9uIGlzIHZlcnNpb24gMQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIChndWVzc2luZykKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBwcm9jZXNzVG9waWNMZWRnZXJzTm9kZURhdGEo\naW5pdGlhbERhdGEsIDApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgICAgICAgICB9LCBjdHgpOwogICAgICAgICAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2Ugc29tZSBvdGhlciBl\ncnJvcgogICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBrZSA9\nIFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigiQ291bGQg\nbm90IHJlYWQgbGVkZ2VycyBub2RlIGZvciB0b3BpYzogIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9TdHJp\nbmdVdGY4KCksIHBhdGgsIHJjKTsKICAgICAgICAgICAgICAgICAgICBjYi5v\ncGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZp\nY2VEb3duRXhjZXB0aW9uKGtlKSk7CgogICAgICAgICAgICAgICAgfQogICAg\nICAgICAgICB9LCBjdHgpOwogICAgICAgIH0KCiAgICAgICAgdm9pZCBwcm9j\nZXNzVG9waWNMZWRnZXJzTm9kZURhdGEoYnl0ZVtdIGRhdGEsIGludCB2ZXJz\naW9uKSB7CgogICAgICAgICAgICBmaW5hbCBMZWRnZXJSYW5nZXMgcmFuZ2Vz\nOwogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgcmFuZ2VzID0g\nTGVkZ2VyUmFuZ2VzLnBhcnNlRnJvbShkYXRhKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoSW52YWxpZFByb3RvY29sQnVmZmVyRXhjZXB0aW9uIGUpIHsKICAg\nICAgICAgICAgICAgIFN0cmluZyBtc2cgPSAiTGVkZ2VyIHJhbmdlcyBmb3Ig\ndG9waWM6IiArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiBjb3VsZCBub3Qg\nYmUgZGVzZXJpYWxpemVkIjsKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJv\ncihtc2csIGUpOwogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVk\nKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5VbmV4cGVjdGVkQ29uZGl0aW9u\nRXhjZXB0aW9uKG1zZykpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICBJdGVyYXRvcjxMZWRnZXJSYW5nZT4g\nbHJJdGVyYXRvciA9IHJhbmdlcy5nZXRSYW5nZXNMaXN0KCkuaXRlcmF0b3Io\nKTsKICAgICAgICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IG5ldyBUb3Bp\nY0luZm8oKTsKCiAgICAgICAgICAgIGxvbmcgc3RhcnRPZkxlZGdlciA9IDE7\nCgogICAgICAgICAgICB3aGlsZSAobHJJdGVyYXRvci5oYXNOZXh0KCkpIHsK\nICAgICAgICAgICAgICAgIExlZGdlclJhbmdlIHJhbmdlID0gbHJJdGVyYXRv\nci5uZXh0KCk7CgogICAgICAgICAgICAgICAgaWYgKHJhbmdlLmhhc0VuZFNl\ncUlkSW5jbHVkZWQoKSkgewogICAgICAgICAgICAgICAgICAgIC8vIHRoaXMg\nbWVhbnMgaXQgd2FzIGEgdmFsaWQgYW5kIGNvbXBsZXRlbHkgY2xvc2VkIGxl\nZGdlcgogICAgICAgICAgICAgICAgICAgIGxvbmcgZW5kT2ZMZWRnZXIgPSBy\nYW5nZS5nZXRFbmRTZXFJZEluY2x1ZGVkKCkuZ2V0TG9jYWxDb21wb25lbnQo\nKTsKICAgICAgICAgICAgICAgICAgICB0b3BpY0luZm8ubGVkZ2VyUmFuZ2Vz\nLnB1dChlbmRPZkxlZGdlciwgbmV3IEluTWVtb3J5TGVkZ2VyUmFuZ2UocmFu\nZ2UsIHN0YXJ0T2ZMZWRnZXIpKTsKICAgICAgICAgICAgICAgICAgICBzdGFy\ndE9mTGVkZ2VyID0gZW5kT2ZMZWRnZXIgKyAxOwogICAgICAgICAgICAgICAg\nICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgIC8vIElmIGl0IGRvZXNuJ3QgaGF2ZSBhIHZhbGlkIGVuZCwgaXQgbXVz\ndCBiZSB0aGUgbGFzdCBsZWRnZXIKICAgICAgICAgICAgICAgIGlmIChsckl0\nZXJhdG9yLmhhc05leHQoKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmlu\nZyBtc2cgPSAiTGVkZ2VyLWlkOiAiICsgcmFuZ2UuZ2V0TGVkZ2VySWQoKSAr\nICIgZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGlzIG5vdCB0aGUgbGFz\ndCBvbmUgYnV0IHN0aWxsIGRvZXMgbm90IGhhdmUgYW4gZW5kIHNlcS1pZCI7\nCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1zZyk7CiAgICAg\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1\nYlN1YkV4Y2VwdGlvbi5VbmV4cGVjdGVkQ29uZGl0aW9uRXhjZXB0aW9uKG1z\nZykpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgICAgICAvLyBUaGUgbGFzdCBsZWRnZXIgZG9l\ncyBub3QgaGF2ZSBhIHZhbGlkIHNlcS1pZCwgbGV0cyB0cnkgdG8KICAgICAg\nICAgICAgICAgIC8vIGZpbmQgaXQgb3V0CiAgICAgICAgICAgICAgICByZWNv\ndmVyTGFzdFRvcGljTGVkZ2VyQW5kT3Blbk5ld09uZShyYW5nZS5nZXRMZWRn\nZXJJZCgpLCB2ZXJzaW9uLCB0b3BpY0luZm8pOwogICAgICAgICAgICAgICAg\ncmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBBbGwgbGVk\nZ2VycyB3ZXJlIGZvdW5kIHByb3Blcmx5IGNsb3NlZCwganVzdCBzdGFydCBh\nIG5ldyBvbmUKICAgICAgICAgICAgb3Blbk5ld1RvcGljTGVkZ2VyKHZlcnNp\nb24sIHRvcGljSW5mbyk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAgICAg\nICAgKiBSZWNvdmVycyB0aGUgbGFzdCBsZWRnZXIsIG9wZW5zIGEgbmV3IG9u\nZSwgYW5kIHBlcnNpc3RzIHRoZSBuZXcKICAgICAgICAgKiBpbmZvcm1hdGlv\nbiB0byBaSwogICAgICAgICAqCiAgICAgICAgICogQHBhcmFtIGxlZGdlcklk\nCiAgICAgICAgICogICAgICAgICAgICBMZWRnZXIgdG8gYmUgcmVjb3ZlcmVk\nCiAgICAgICAgICovCiAgICAgICAgcHJpdmF0ZSB2b2lkIHJlY292ZXJMYXN0\nVG9waWNMZWRnZXJBbmRPcGVuTmV3T25lKGZpbmFsIGxvbmcgbGVkZ2VySWQs\nIGZpbmFsIGludCBleHBlY3RlZFZlcnNpb25PZkxlZGdlck5vZGUsCiAgICAg\nICAgICAgICAgICBmaW5hbCBUb3BpY0luZm8gdG9waWNJbmZvKSB7CgogICAg\nICAgICAgICBiay5hc3luY09wZW5MZWRnZXIobGVkZ2VySWQsIERpZ2VzdFR5\ncGUuQ1JDMzIsIHBhc3N3ZCwgbmV3IFNhZmVBc3luQktDYWxsYmFjay5PcGVu\nQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVPcGVuQ29tcGxldGUoaW50IHJj\nLCBMZWRnZXJIYW5kbGUgbGVkZ2VySGFuZGxlLCBPYmplY3QgY3R4KSB7Cgog\nICAgICAgICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2Rl\nLk9LKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIEJLRXhjZXB0aW9uIGJr\nZSA9IEJLRXhjZXB0aW9uLmNyZWF0ZShyYyk7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGxvZ2dlci5lcnJvcigiV2hpbGUgYWNxdWlyaW5nIHRvcGljOiAi\nICsgdG9waWMudG9TdHJpbmdVdGY4KCkKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiwgY291bGQgbm90IG9wZW4gdW5yZWNvdmVy\nZWQgbGVkZ2VyOiAiICsgbGVkZ2VySWQsIGJrZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJF\neGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgICAgIGZpbmFsIGxvbmcgbnVtRW50cmllc0lu\nTGFzdExlZGdlciA9IGxlZGdlckhhbmRsZS5nZXRMYXN0QWRkQ29uZmlybWVk\nKCkgKyAxOwoKICAgICAgICAgICAgICAgICAgICBpZiAobnVtRW50cmllc0lu\nTGFzdExlZGdlciA8PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8v\nIHRoaXMgd2FzIGFuIGVtcHR5IGxlZGdlciB0aGF0IHNvbWVvbmUgY3JlYXRl\nZCBidXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY291bGRuJ3Qgd3Jp\ndGUgdG8sIHNvIGp1c3QgaWdub3JlIGl0CiAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZ2dlci5pbmZvKCJQcnVuaW5nIGVtcHR5IGxlZGdlcjogIiArIGxl\nZGdlcklkICsgIiBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlTGVkZ2VyKGxlZGdl\nckhhbmRsZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5OZXdUb3Bp\nY0xlZGdlcihleHBlY3RlZFZlcnNpb25PZkxlZGdlck5vZGUsIHRvcGljSW5m\nbyk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUg\ndG8gcmVhZCB0aGUgbGFzdCBlbnRyeSBvZiB0aGUgbGVkZ2VyIHRvIGZpbmQK\nICAgICAgICAgICAgICAgICAgICAvLyBvdXQgdGhlIGxhc3Qgc2VxLWlkCgog\nICAgICAgICAgICAgICAgICAgIGxlZGdlckhhbmRsZS5hc3luY1JlYWRFbnRy\naWVzKG51bUVudHJpZXNJbkxhc3RMZWRnZXIgLSAxLCBudW1FbnRyaWVzSW5M\nYXN0TGVkZ2VyIC0gMSwKICAgICAgICAgICAgICAgICAgICBuZXcgU2FmZUFz\neW5CS0NhbGxiYWNrLlJlYWRDYWxsYmFjaygpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHNhZmVSZWFkQ29tcGxldGUoaW50IHJjLCBMZWRnZXJIYW5k\nbGUgbGgsIEVudW1lcmF0aW9uPExlZGdlckVudHJ5PiBzZXEsCiAgICAgICAg\nICAgICAgICAgICAgICAgIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGlmIChyYyAhPSBCS0V4Y2VwdGlvbi5Db2RlLk9LIHx8\nICFzZXEuaGFzTW9yZUVsZW1lbnRzKCkpIHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBCS0V4Y2VwdGlvbiBia2UgPSBCS0V4Y2VwdGlvbi5j\ncmVhdGUocmMpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxv\nZ2dlci5lcnJvcigiV2hpbGUgcmVjb3ZlcmluZyBsZWRnZXI6ICIgKyBsZWRn\nZXJJZCArICIgZm9yIHRvcGljOiAiCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCkg\nKyAiLCBjb3VsZCBub3QgcmVhZCBsYXN0IGVudHJ5IiwgYmtlKTsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQo\nY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9u\nKGJrZSkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVy\nbjsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBNZXNzYWdlIGxhc3RNZXNzYWdlOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBsYXN0TWVzc2FnZSA9IE1lc3NhZ2UucGFyc2VGcm9t\nKHNlcS5uZXh0RWxlbWVudCgpLmdldEVudHJ5KCkpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgfSBjYXRjaCAoSW52YWxpZFByb3RvY29sQnVmZmVy\nRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBTdHJpbmcgbXNnID0gIldoaWxlIHJlY292ZXJpbmcgbGVkZ2VyOiAiICsg\nbGVkZ2VySWQgKyAiIGZvciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRm\nOCgpICsgIiwgY291bGQgbm90IGRlc2VyaWFsaXplIGxhc3QgbWVzc2FnZSI7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9y\nKG1zZywgZSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iu\nb3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5VbmV4\ncGVjdGVkQ29uZGl0aW9uRXhjZXB0aW9uKG1zZykpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb25n\nIHByZXZMZWRnZXJFbmQgPSB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmlzRW1w\ndHkoKSA/IDAgOiB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAubGFzdEtl\neSgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgTGVkZ2VyUmFuZ2Ug\nbHIgPSBMZWRnZXJSYW5nZS5uZXdCdWlsZGVyKCkuc2V0TGVkZ2VySWQobGVk\nZ2VySWQpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIC5zZXRFbmRTZXFJZEluY2x1ZGVkKGxhc3RNZXNzYWdlLmdldE1z\nZ0lkKCkpLmJ1aWxkKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0\nb3BpY0luZm8ubGVkZ2VyUmFuZ2VzLnB1dChsci5nZXRFbmRTZXFJZEluY2x1\nZGVkKCkuZ2V0TG9jYWxDb21wb25lbnQoKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgbmV3IEluTWVtb3J5TGVkZ2VyUmFuZ2UobHIs\nIHByZXZMZWRnZXJFbmQgKyAxLCBsaCkpOwoKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgIGxvZ2dlci5pbmZvKCJSZWNvdmVyZWQgdW5jbG9zZWQgbGVk\nZ2VyOiAiICsgbGVkZ2VySWQgKyAiIGZvciB0b3BpYzogIgogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0b3BpYy50b1N0cmlu\nZ1V0ZjgoKSArICIgd2l0aCAiICsgbnVtRW50cmllc0luTGFzdExlZGdlciAr\nICIgZW50cmllcyIpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9w\nZW5OZXdUb3BpY0xlZGdlcihleHBlY3RlZFZlcnNpb25PZkxlZGdlck5vZGUs\nIHRvcGljSW5mbyk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgICAgICAgICB9LCBjdHgpOwoKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIH0sIGN0eCk7CiAgICAgICAgfQoKICAgICAgICAvKioKICAg\nICAgICAgKgogICAgICAgICAqIEBwYXJhbSByZXF1aXJlZFZlcnNpb25PZkxl\nZGdlcnNOb2RlCiAgICAgICAgICogICAgICAgICAgICBUaGUgdmVyc2lvbiBv\nZiB0aGUgbGVkZ2VycyBub2RlIHdoZW4gd2UgcmVhZCBpdCwgc2hvdWxkIGJl\nCiAgICAgICAgICogICAgICAgICAgICB0aGUgc2FtZSB3aGVuIHdlIHRyeSB0\nbyB3cml0ZQogICAgICAgICAqLwogICAgICAgIHByaXZhdGUgdm9pZCBvcGVu\nTmV3VG9waWNMZWRnZXIoZmluYWwgaW50IGV4cGVjdGVkVmVyc2lvbk9mTGVk\nZ2Vyc05vZGUsIGZpbmFsIFRvcGljSW5mbyB0b3BpY0luZm8pIHsKICAgICAg\nICAgICAgYmsuYXN5bmNDcmVhdGVMZWRnZXIoY2ZnLmdldEJrRW5zZW1ibGVT\naXplKCksIGNmZy5nZXRCa1F1b3J1bVNpemUoKSwgRGlnZXN0VHlwZS5DUkMz\nMiwgcGFzc3dkLAogICAgICAgICAgICBuZXcgU2FmZUFzeW5CS0NhbGxiYWNr\nLkNyZWF0ZUNhbGxiYWNrKCkgewogICAgICAgICAgICAgICAgYm9vbGVhbiBw\ncm9jZXNzZWQgPSBmYWxzZTsKCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUK\nICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVDcmVhdGVDb21wbGV0\nZShpbnQgcmMsIExlZGdlckhhbmRsZSBsaCwgT2JqZWN0IGN0eCkgewogICAg\nICAgICAgICAgICAgICAgIGlmIChwcm9jZXNzZWQpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgIH0gZWxz\nZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZCA9IHRydWU7\nCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBp\nZiAocmMgIT0gQktFeGNlcHRpb24uQ29kZS5PSykgewogICAgICAgICAgICAg\nICAgICAgICAgICBCS0V4Y2VwdGlvbiBia2UgPSBCS0V4Y2VwdGlvbi5jcmVh\ndGUocmMpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3Io\nIkNvdWxkIG5vdCBjcmVhdGUgbmV3IGxlZGdlciB3aGlsZSBhY3F1aXJpbmcg\ndG9waWM6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgdG9waWMudG9TdHJpbmdVdGY4KCksIGJrZSk7CiAgICAgICAgICAgICAg\nICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJF\neGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oYmtlKSk7CiAgICAgICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9\nCgogICAgICAgICAgICAgICAgICAgIHRvcGljSW5mby5sYXN0U2VxSWRQdXNo\nZWQgPSB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmlzRW1wdHkoKSA/IE1lc3Nh\nZ2VTZXFJZC5uZXdCdWlsZGVyKCkKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgLnNldExvY2FsQ29tcG9uZW50KDAp\nLmJ1aWxkKCkgOiB0b3BpY0luZm8ubGVkZ2VyUmFuZ2VzLmxhc3RFbnRyeSgp\nLmdldFZhbHVlKCkucmFuZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgLmdldEVuZFNlcUlkSW5jbHVkZWQoKTsK\nCiAgICAgICAgICAgICAgICAgICAgTGVkZ2VyUmFuZ2UgbGFzdFJhbmdlID0g\nTGVkZ2VyUmFuZ2UubmV3QnVpbGRlcigpLnNldExlZGdlcklkKGxoLmdldElk\nKCkpLmJ1aWxkKCk7CiAgICAgICAgICAgICAgICAgICAgdG9waWNJbmZvLmN1\ncnJlbnRMZWRnZXJSYW5nZSA9IG5ldyBJbk1lbW9yeUxlZGdlclJhbmdlKGxh\nc3RSYW5nZSwgdG9waWNJbmZvLmxhc3RTZXFJZFB1c2hlZAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgLmdldExvY2FsQ29tcG9uZW50KCkgKyAxLCBs\naCk7CgogICAgICAgICAgICAgICAgICAgIC8vIFBlcnNpc3QgdGhlIGZhY3Qg\ndGhhdCB3ZSBzdGFydGVkIHRoaXMgbmV3CiAgICAgICAgICAgICAgICAgICAg\nLy8gbGVkZ2VyIHRvIFpLCgogICAgICAgICAgICAgICAgICAgIExlZGdlclJh\nbmdlcy5CdWlsZGVyIGJ1aWxkZXIgPSBMZWRnZXJSYW5nZXMubmV3QnVpbGRl\ncigpOwogICAgICAgICAgICAgICAgICAgIGZvciAoSW5NZW1vcnlMZWRnZXJS\nYW5nZSBpbWxyIDogdG9waWNJbmZvLmxlZGdlclJhbmdlcy52YWx1ZXMoKSkg\newogICAgICAgICAgICAgICAgICAgICAgICBidWlsZGVyLmFkZFJhbmdlcyhp\nbWxyLnJhbmdlKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgYnVpbGRlci5hZGRSYW5nZXMobGFzdFJhbmdlKTsKCiAgICAg\nICAgICAgICAgICAgICAgdXBkYXRlTGVkZ2VyUmFuZ2VzTm9kZSh0b3BpYywg\nYnVpbGRlci5idWlsZCgpLCBleHBlY3RlZFZlcnNpb25PZkxlZGdlcnNOb2Rl\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbmV3IENhbGxiYWNrPEludGVnZXI+KCkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIEludGVnZXIgbmV3VmVyc2lvbikg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAvLyBGaW5hbGx5LCBhbGwgZG9uZQogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3BpY0luZm8u\nbGVkZ2VyUmFuZ2VzWm5vZGVWZXJzaW9uID0gbmV3VmVyc2lvbjsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\ndG9waWNJbmZvcy5wdXQodG9waWMsIHRvcGljSW5mbyk7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9w\nZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lk\nIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24g\nZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4\nY2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIGN0eCk7CiAg\nICAgICAgfQogICAgfQoKICAgIHB1YmxpYyB2b2lkIHVwZGF0ZUxlZGdlclJh\nbmdlc05vZGUoZmluYWwgQnl0ZVN0cmluZyB0b3BpYywgTGVkZ2VyUmFuZ2Vz\nIHJhbmdlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaW50IHZlcnNpb24sIGZpbmFsIENhbGxiYWNrPEludGVnZXI+IGNhbGxi\nYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgZmluYWwgU3RyaW5nIHpOb2Rl\nUGF0aCA9IGxlZGdlcnNQYXRoKHRvcGljKTsKCiAgICAgICAgemsuc2V0RGF0\nYSh6Tm9kZVBhdGgsIHJhbmdlcy50b0J5dGVBcnJheSgpLCB2ZXJzaW9uLCBu\nZXcgU2FmZUFzeW5jWktDYWxsYmFjay5TdGF0Q2FsbGJhY2soKSB7CiAgICAg\nICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2\nb2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCByYywgU3RyaW5nIHBhdGgsIE9i\namVjdCBjdHgsIFN0YXQgc3RhdCkgewogICAgICAgICAgICAgICAgICAgIGlm\nIChyYyAhPSBLZWVwZXJFeGNlcHRpb24uQ29kZS5PSy5pbnRWYWx1ZSgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBrZSA9\nIFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAiQ291bGQgbm90IHdyaXRlIGxl\nZGdlcnMgbm9kZSBmb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSwgcGF0aCwgcmMpOwogICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFj\nay5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNl\ncnZpY2VEb3duRXhjZXB0aW9uKGtlKSk7CiAgICAgICAgICAgICAgICAgICAg\nICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBzdGF0\nLmdldFZlcnNpb24oKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAg\nIH0sIGN0eCk7CiAgICB9CgogICAgLyoqCiAgICAgKiBhY3F1aXJlIG93bmVy\nc2hpcCBvZiBhIHRvcGljLCBkb2luZyB3aGF0ZXZlciBpcyBuZWVkZWQgdG8g\nYmUgYWJsZSB0bwogICAgICogcGVyZm9ybSByZWFkcyBhbmQgd3JpdGVzIG9u\nIHRoYXQgdG9waWMgZnJvbSBoZXJlIG9uCiAgICAgKgogICAgICogQHBhcmFt\nIHRvcGljCiAgICAgKiBAcGFyYW0gY2FsbGJhY2sKICAgICAqIEBwYXJhbSBj\ndHgKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBhY3F1\naXJlZFRvcGljKEJ5dGVTdHJpbmcgdG9waWMsIENhbGxiYWNrPFZvaWQ+IGNh\nbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAgICAgICAgcXVldWVyLnB1c2hBbmRN\nYXliZVJ1bih0b3BpYywgbmV3IEFjcXVpcmVPcCh0b3BpYywgY2FsbGJhY2ss\nIGN0eCkpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIGNsb3NlTGVkZ2VyKExl\nZGdlckhhbmRsZSBsaCkgewogICAgICAgIC8vIHRyeSB7CiAgICAgICAgLy8g\nbGguYXN5bmNDbG9zZShub09wQ2xvc2VDYWxsYmFjaywgbnVsbCk7CiAgICAg\nICAgLy8gfSBjYXRjaCAoSW50ZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAg\nICAgIC8vIGxvZ2dlci5lcnJvcihlKTsKICAgICAgICAvLyBUaHJlYWQuY3Vy\ncmVudFRocmVhZCgpLmludGVycnVwdCgpOwogICAgICAgIC8vIH0KICAgIH0K\nCiAgICBjbGFzcyBSZWxlYXNlT3AgZXh0ZW5kcyBUb3BpY09wUXVldWVyLlN5\nbmNocm9ub3VzT3AgewoKICAgICAgICBwdWJsaWMgUmVsZWFzZU9wKEJ5dGVT\ndHJpbmcgdG9waWMpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVyKHRvcGlj\nKTsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1Ymxp\nYyB2b2lkIHJ1bkludGVybmFsKCkgewogICAgICAgICAgICBUb3BpY0luZm8g\ndG9waWNJbmZvID0gdG9waWNJbmZvcy5yZW1vdmUodG9waWMpOwoKICAgICAg\nICAgICAgaWYgKHRvcGljSW5mbyA9PSBudWxsKSB7CiAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoSW5N\nZW1vcnlMZWRnZXJSYW5nZSBpbWxyIDogdG9waWNJbmZvLmxlZGdlclJhbmdl\ncy52YWx1ZXMoKSkgewogICAgICAgICAgICAgICAgaWYgKGltbHIuaGFuZGxl\nICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICBjbG9zZUxlZGdlcihp\nbWxyLmhhbmRsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIGlmICh0b3BpY0luZm8uY3VycmVudExlZGdlclJhbmdl\nICE9IG51bGwgJiYgdG9waWNJbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5oYW5k\nbGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgY2xvc2VMZWRnZXIodG9w\naWNJbmZvLmN1cnJlbnRMZWRnZXJSYW5nZS5oYW5kbGUpOwogICAgICAgICAg\nICB9CiAgICAgICAgfQogICAgfQoKICAgIC8qKgogICAgICogUmVsZWFzZSBh\nbnkgcmVzb3VyY2VzIGZvciB0aGUgdG9waWMgdGhhdCBtaWdodCBiZSBjdXJy\nZW50bHkgaGVsZC4gVGhlcmUKICAgICAqIHdvbnQgYmUgYW55IHN1YnNlcXVl\nbnQgcmVhZHMgb3Igd3JpdGVzIG9uIHRoYXQgdG9waWMgY29taW5nCiAgICAg\nKgogICAgICogQHBhcmFtIHRvcGljCiAgICAgKi8KICAgIEBPdmVycmlkZQog\nICAgcHVibGljIHZvaWQgbG9zdFRvcGljKEJ5dGVTdHJpbmcgdG9waWMpIHsK\nICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBuZXcgUmVs\nZWFzZU9wKHRvcGljKSk7CiAgICB9CgogICAgY2xhc3MgU2V0TWVzc2FnZUJv\ndW5kT3AgZXh0ZW5kcyBUb3BpY09wUXVldWVyLlN5bmNocm9ub3VzT3Agewog\nICAgICAgIGZpbmFsIGludCBib3VuZDsKCiAgICAgICAgcHVibGljIFNldE1l\nc3NhZ2VCb3VuZE9wKEJ5dGVTdHJpbmcgdG9waWMsIGludCBib3VuZCkgewog\nICAgICAgICAgICBxdWV1ZXIuc3VwZXIodG9waWMpOwogICAgICAgICAgICB0\naGlzLmJvdW5kID0gYm91bmQ7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICBwdWJsaWMgdm9pZCBydW5JbnRlcm5hbCgpIHsKICAgICAg\nICAgICAgVG9waWNJbmZvIHRvcGljSW5mbyA9IHRvcGljSW5mb3MuZ2V0KHRv\ncGljKTsKICAgICAgICAgICAgaWYgKHRvcGljSW5mbyAhPSBudWxsKSB7CiAg\nICAgICAgICAgICAgICB0b3BpY0luZm8ubWVzc2FnZUJvdW5kID0gYm91bmQ7\nCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHVibGljIHZv\naWQgc2V0TWVzc2FnZUJvdW5kKEJ5dGVTdHJpbmcgdG9waWMsIEludGVnZXIg\nYm91bmQpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGlj\nLCBuZXcgU2V0TWVzc2FnZUJvdW5kT3AodG9waWMsIGJvdW5kKSk7CiAgICB9\nCgogICAgcHVibGljIHZvaWQgY2xlYXJNZXNzYWdlQm91bmQoQnl0ZVN0cmlu\nZyB0b3BpYykgewogICAgICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9w\naWMsIG5ldyBTZXRNZXNzYWdlQm91bmRPcCh0b3BpYywgVG9waWNJbmZvLlVO\nTElNSVRFRCkpOwogICAgfQp9Cg==\n","encoding":"base64"}

