{"sha":"3cca541a0d1228f0e05b3c04da468cc1aaeb5eb8","node_id":"MDQ6QmxvYjE1NzU5NTY6M2NjYTU0MWEwZDEyMjhmMGUwNWIzYzA0ZGE0NjhjYzFhYWViNWViOA==","size":28090,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3cca541a0d1228f0e05b3c04da468cc1aaeb5eb8","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2U7Cgpp\nbXBvcnQgamF2YS51dGlsLkhhc2hNYXA7CmltcG9ydCBqYXZhLnV0aWwuSGFz\naFNldDsKaW1wb3J0IGphdmEudXRpbC5JdGVyYXRvcjsKaW1wb3J0IGphdmEu\ndXRpbC5MaW5rZWRMaXN0OwppbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0\nIGphdmEudXRpbC5RdWV1ZTsKaW1wb3J0IGphdmEudXRpbC5TZXQ7CmltcG9y\ndCBqYXZhLnV0aWwuU29ydGVkTWFwOwppbXBvcnQgamF2YS51dGlsLlNvcnRl\nZFNldDsKaW1wb3J0IGphdmEudXRpbC5UcmVlTWFwOwppbXBvcnQgamF2YS51\ndGlsLlRyZWVTZXQ7CmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5CbG9j\na2luZ1F1ZXVlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuTGlua2Vk\nQmxvY2tpbmdRdWV1ZTsKCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBv\ncnQgb3JnLnNsZjRqLkxvZ2dlckZhY3Rvcnk7CgppbXBvcnQgY29tLmdvb2ds\nZS5wcm90b2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3\naWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9ydCBvcmcuYXBh\nY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlvbi5TZXJ2ZXJO\nb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZTsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvZXh0ZW5zaW9ucy5NZXNzYWdlSWRVdGlsczsKaW1wb3J0IG9yZy5hcGFj\naGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29uZmlndXJhdGlvbjsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uVW5leHBl\nY3RlZEVycm9yOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLmpt\neC5IZWR3aWdKTVhTZXJ2aWNlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcu\nc2VydmVyLmpteC5IZWR3aWdNQmVhbkluZm87CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5zZXJ2ZXIuam14LkhlZHdpZ01CZWFuUmVnaXN0cnk7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucGVyc2lzdGVuY2UuUmVhZEFo\nZWFkQ2FjaGVCZWFuOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5D\nYWxsYmFjazsKCnB1YmxpYyBjbGFzcyBSZWFkQWhlYWRDYWNoZSBpbXBsZW1l\nbnRzIFBlcnNpc3RlbmNlTWFuYWdlciwgUnVubmFibGUsIEhlZHdpZ0pNWFNl\ncnZpY2UgewoKICAgIHN0YXRpYyBMb2dnZXIgbG9nZ2VyID0gTG9nZ2VyRmFj\ndG9yeS5nZXRMb2dnZXIoUmVhZEFoZWFkQ2FjaGUuY2xhc3MpOwoKICAgIHBy\nb3RlY3RlZCBpbnRlcmZhY2UgQ2FjaGVSZXF1ZXN0IHsKICAgICAgICBwdWJs\naWMgdm9pZCBwZXJmb3JtUmVxdWVzdCgpOwogICAgfQoKICAgIC8qKgogICAg\nICogVGhlIHVuZGVybHlpbmcgcGVyc2lzdGVuY2UgbWFuYWdlciB0aGF0IHdp\nbGwgYmUgdXNlZCBmb3IgcGVyc2lzdGVuY2UgYW5kCiAgICAgKiBzY2Fubmlu\nZyBiZWxvdyB0aGUgY2FjaGUKICAgICAqLwogICAgcHJvdGVjdGVkIFBlcnNp\nc3RlbmNlTWFuYWdlcldpdGhSYW5nZVNjYW4gcmVhbFBlcnNpc3RlbmNlTWFu\nYWdlcjsKCiAgICAvKioKICAgICAqIFRoZSBzdHJ1Y3R1cmUgZm9yIHRoZSBj\nYWNoZQogICAgICovCiAgICBwcm90ZWN0ZWQgTWFwPENhY2hlS2V5LCBDYWNo\nZVZhbHVlPiBjYWNoZSA9IG5ldyBIYXNoTWFwPENhY2hlS2V5LCBDYWNoZVZh\nbHVlPigpOwoKICAgIC8qKgogICAgICogVG8gc2ltcGxpZnkgc3luY2hyb25p\nemF0aW9uLCB0aGUgY2FjaGUgd2lsbCBiZSBtYWludGFpbmVkIGJ5IGEgc2lu\nZ2xlCiAgICAgKiBjYWNoZSBtYWludGFpbmVyIHRocmVhZC4gVGhpcyBpcyB0\naGUgcXVldWUgdGhhdCB3aWxsIGhvbGQgcmVxdWVzdHMgdGhhdAogICAgICog\nbmVlZCB0byBiZSBzZXJ2ZWQgYnkgdGhpcyB0aHJlYWQKICAgICAqLwogICAg\ncHJvdGVjdGVkIEJsb2NraW5nUXVldWU8Q2FjaGVSZXF1ZXN0PiByZXF1ZXN0\nUXVldWUgPSBuZXcgTGlua2VkQmxvY2tpbmdRdWV1ZTxDYWNoZVJlcXVlc3Q+\nKCk7CgogICAgLyoqCiAgICAgKiBXZSB3YW50IHRvIGtlZXAgdHJhY2sgb2Yg\nd2hlbiBlbnRyaWVzIHdlcmUgYWRkZWQgaW4gdGhlIGNhY2hlLCBzbyB0aGF0\nIHdlCiAgICAgKiBjYW4gcmVtb3ZlIHRoZW0gaW4gYSBGSUZPIGZhc2hpb24K\nICAgICAqLwogICAgcHJvdGVjdGVkIFNvcnRlZE1hcDxMb25nLCBTZXQ8Q2Fj\naGVLZXk+PiB0aW1lSW5kZXhPZkFkZGl0aW9uID0gbmV3IFRyZWVNYXA8TG9u\nZywgU2V0PENhY2hlS2V5Pj4oKTsKCiAgICAvKioKICAgICAqIFdlIGFsc28g\nd2FudCB0byB0cmFjayB0aGUgZW50cmllcyBpbiBzZXEtaWQgb3JkZXIgc28g\ndGhhdCB3ZSBjYW4gY2xlYW4gdXAKICAgICAqIGVudHJpZXMgYWZ0ZXIgdGhl\nIGxhc3Qgc3Vic2NyaWJlcgogICAgICovCiAgICBwcm90ZWN0ZWQgTWFwPEJ5\ndGVTdHJpbmcsIFNvcnRlZFNldDxMb25nPj4gb3JkZXJlZEluZGV4T25TZXFJ\nZCA9IG5ldyBIYXNoTWFwPEJ5dGVTdHJpbmcsIFNvcnRlZFNldDxMb25nPj4o\nKTsKCiAgICAvKioKICAgICAqIFdlIG1haW50YWluIGFuIGVzdGltYXRlIG9m\nIHRoZSBjdXJyZW50IHNpemUgb2YgdGhlIGNhY2hlLCBzbyB0aGF0IHdlIGtu\nb3cKICAgICAqIHdoZW4gdG8gZXZpY3QgZW50cmllcy4KICAgICAqLwogICAg\ncHJvdGVjdGVkIGxvbmcgcHJlc2VudENhY2hlU2l6ZSA9IDA7CgogICAgLyoq\nCiAgICAgKiBPbmUgaW5zdGFuY2Ugb2YgYSBjYWxsYmFjayB0aGF0IHdlIHdp\nbGwgcGFzcyB0byB0aGUgdW5kZXJseWluZwogICAgICogcGVyc2lzdGVuY2Ug\nbWFuYWdlciB3aGVuIGFza2luZyBpdCB0byBwZXJzaXN0IG1lc3NhZ2VzCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBQZXJzaXN0Q2FsbGJhY2sgcGVyc2lzdENh\nbGxiYWNrSW5zdGFuY2UgPSBuZXcgUGVyc2lzdENhbGxiYWNrKCk7CgogICAg\nLyoqCiAgICAgKiAyIGtpbmRzIG9mIGV4Y2VwdGlvbnMgdGhhdCB3ZSB3aWxs\nIHVzZSB0byBzaWduYWwgZXJyb3IgZnJvbSByZWFkYWhlYWQKICAgICAqLwog\nICAgcHJvdGVjdGVkIE5vU3VjaFNlcUlkRXhjZXB0aW9uIG5vU3VjaFNlcUlk\nRXhjZXB0aW9uSW5zdGFuY2UgPSBuZXcgTm9TdWNoU2VxSWRFeGNlcHRpb24o\nKTsKICAgIHByb3RlY3RlZCBSZWFkQWhlYWRFeGNlcHRpb24gcmVhZEFoZWFk\nRXhjZXB0aW9uSW5zdGFuY2UgPSBuZXcgUmVhZEFoZWFkRXhjZXB0aW9uKCk7\nCgogICAgcHJvdGVjdGVkIFNlcnZlckNvbmZpZ3VyYXRpb24gY2ZnOwogICAg\ncHJvdGVjdGVkIFRocmVhZCBjYWNoZVRocmVhZDsKICAgIC8vIEJvb2xlYW4g\naW5kaWNhdGluZyBpZiB0aGlzIHRocmVhZCBzaG91bGQgY29udGludWUgcnVu\nbmluZy4gVGhpcyBpcyB1c2VkCiAgICAvLyB3aGVuIHdlIHdhbnQgdG8gc3Rv\ncCB0aGUgdGhyZWFkIGR1cmluZyBhIFB1YlN1YlNlcnZlciBzaHV0ZG93bi4K\nICAgIHByb3RlY3RlZCBib29sZWFuIGtlZXBSdW5uaW5nID0gdHJ1ZTsKCiAg\nICAvLyBKTVggQmVhbnMKICAgIFJlYWRBaGVhZENhY2hlQmVhbiBqbXhDYWNo\nZUJlYW4gPSBudWxsOwoKICAgIC8qKgogICAgICogQ29uc3RydWN0b3IuIFN0\nYXJ0cyB0aGUgY2FjaGUgbWFpbnRhaW5lciB0aHJlYWQKICAgICAqCiAgICAg\nKiBAcGFyYW0gcmVhbFBlcnNpc3RlbmNlTWFuYWdlcgogICAgICovCiAgICBw\ndWJsaWMgUmVhZEFoZWFkQ2FjaGUoUGVyc2lzdGVuY2VNYW5hZ2VyV2l0aFJh\nbmdlU2NhbiByZWFsUGVyc2lzdGVuY2VNYW5hZ2VyLCBTZXJ2ZXJDb25maWd1\ncmF0aW9uIGNmZykgewogICAgICAgIHRoaXMucmVhbFBlcnNpc3RlbmNlTWFu\nYWdlciA9IHJlYWxQZXJzaXN0ZW5jZU1hbmFnZXI7CiAgICAgICAgdGhpcy5j\nZmcgPSBjZmc7CiAgICAgICAgY2FjaGVUaHJlYWQgPSBuZXcgVGhyZWFkKHRo\naXMsICJDYWNoZVRocmVhZCIpOwogICAgfQoKICAgIHB1YmxpYyBSZWFkQWhl\nYWRDYWNoZSBzdGFydCgpIHsKICAgICAgICBjYWNoZVRocmVhZC5zdGFydCgp\nOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICAgIC8qKgogICAgICog\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgKiBNZXRob2RzIG9m\nIHtAbGluayBQZXJzaXN0ZW5jZU1hbmFnZXJ9IHRoYXQgd2Ugd2lsbCBwYXNz\nIHN0cmFpZ2h0IGRvd24gdG8KICAgICAqIHRoZSByZWFsIHBlcnNpc3RlbmNl\nIG1hbmFnZXIuCiAgICAgKi8KCiAgICBwdWJsaWMgbG9uZyBnZXRTZXFJZEFm\ndGVyU2tpcHBpbmcoQnl0ZVN0cmluZyB0b3BpYywgbG9uZyBzZXFJZCwgaW50\nIHNraXBBbW91bnQpIHsKICAgICAgICByZXR1cm4gcmVhbFBlcnNpc3RlbmNl\nTWFuYWdlci5nZXRTZXFJZEFmdGVyU2tpcHBpbmcodG9waWMsIHNlcUlkLCBz\na2lwQW1vdW50KTsKICAgIH0KCiAgICBwdWJsaWMgTWVzc2FnZVNlcUlkIGdl\ndEN1cnJlbnRTZXFJZEZvclRvcGljKEJ5dGVTdHJpbmcgdG9waWMpIHRocm93\ncyBTZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhjZXB0aW9uIHsKICAg\nICAgICByZXR1cm4gcmVhbFBlcnNpc3RlbmNlTWFuYWdlci5nZXRDdXJyZW50\nU2VxSWRGb3JUb3BpYyh0b3BpYyk7CiAgICB9CgogICAgLyoqCiAgICAgKiA9\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAqIE90aGVyIG1ldGhv\nZHMgb2Yge0BsaW5rIFBlcnNpc3RlbmNlTWFuYWdlcn0gdGhhdCB0aGUgY2Fj\naGUgbmVlZHMgdG8gdGFrZQogICAgICogc29tZSBhY3Rpb24gb24uCiAgICAg\nKgogICAgICogMS4gUGVyc2lzdDogV2UgcGFzcyBpdCB0aHJvdWdoIHRvIHRo\nZSByZWFsIHBlcnNpc3RlbmNlIG1hbmFnZXIgYnV0IGluc2VydAogICAgICog\nb3VyIGNhbGxiYWNrIG9uIHRoZSByZXR1cm4gcGF0aAogICAgICoKICAgICAq\nLwogICAgcHVibGljIHZvaWQgcGVyc2lzdE1lc3NhZ2UoUGVyc2lzdFJlcXVl\nc3QgcmVxdWVzdCkgewogICAgICAgIC8vIG1ha2UgYSBuZXcgUGVyc2lzdFJl\ncXVlc3Qgb2JqZWN0IHNvIHRoYXQgd2UgY2FuIGluc2VydCBvdXIgb3duCiAg\nICAgICAgLy8gY2FsbGJhY2sgaW4gdGhlIG1pZGRsZS4gQXNzaWduIHRoZSBv\ncmlnaW5hbCByZXF1ZXN0IGFzIHRoZSBjb250ZXh0CiAgICAgICAgLy8gZm9y\nIHRoZSBjYWxsYmFjay4KCiAgICAgICAgUGVyc2lzdFJlcXVlc3QgbmV3UmVx\ndWVzdCA9IG5ldyBQZXJzaXN0UmVxdWVzdChyZXF1ZXN0LmdldFRvcGljKCks\nIHJlcXVlc3QuZ2V0TWVzc2FnZSgpLAogICAgICAgICAgICAgICAgcGVyc2lz\ndENhbGxiYWNrSW5zdGFuY2UsIHJlcXVlc3QpOwogICAgICAgIHJlYWxQZXJz\naXN0ZW5jZU1hbmFnZXIucGVyc2lzdE1lc3NhZ2UobmV3UmVxdWVzdCk7CiAg\nICB9CgogICAgLyoqCiAgICAgKiBUaGUgY2FsbGJhY2sgdGhhdCB3ZSBpbnNl\ncnQgb24gdGhlIHBlcnNpc3QgcmVxdWVzdCByZXR1cm4gcGF0aC4gVGhlCiAg\nICAgKiBjYWxsYmFjayBzaW1wbHkgZm9ybXMgYSB7QGxpbmsgUGVyc2lzdFJl\nc3BvbnNlfSBvYmplY3QgYW5kIGluc2VydHMgaXQgaW4KICAgICAqIHRoZSBy\nZXF1ZXN0IHF1ZXVlIHRvIGJlIGhhbmRsZWQgc2VyaWFsbHkgYnkgdGhlIGNh\nY2hlIG1haW50YWluZXIgdGhyZWFkLgogICAgICoKICAgICAqLwogICAgcHVi\nbGljIGNsYXNzIFBlcnNpc3RDYWxsYmFjayBpbXBsZW1lbnRzIENhbGxiYWNr\nPExvbmc+IHsKCiAgICAgICAgLyoqCiAgICAgICAgICogSW4gY2FzZSB0aGVy\nZSBpcyBhIGZhaWx1cmUgaW4gcGVyc2lzdGluZywganVzdCBwYXNzIGl0IHRv\nIHRoZQogICAgICAgICAqIG9yaWdpbmFsIGNhbGxiYWNrCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBj\ndHgsIFB1YlN1YkV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAg\nUGVyc2lzdFJlcXVlc3Qgb3JpZ2luYWxSZXF1ZXN0ID0gKFBlcnNpc3RSZXF1\nZXN0KSBjdHg7CiAgICAgICAgICAgIENhbGxiYWNrPExvbmc+IG9yaWdpbmFs\nQ2FsbGJhY2sgPSBvcmlnaW5hbFJlcXVlc3QuZ2V0Q2FsbGJhY2soKTsKICAg\nICAgICAgICAgT2JqZWN0IG9yaWdpbmFsQ29udGV4dCA9IG9yaWdpbmFsUmVx\ndWVzdC5nZXRDdHgoKTsKICAgICAgICAgICAgb3JpZ2luYWxDYWxsYmFjay5v\ncGVyYXRpb25GYWlsZWQob3JpZ2luYWxDb250ZXh0LCBleGNlcHRpb24pOwog\nICAgICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogV2hlbiB0aGUgcGVy\nc2lzdCBmaW5pc2hlcywgd2UgZmlyc3Qgbm90aWZ5IHRoZSBvcmlnaW5hbCBj\nYWxsYmFjayBvZgogICAgICAgICAqIHN1Y2Nlc3MsIGFuZCB0aGVuIG9wcG9y\ndHVuaXN0aWNhbGx5IHRyZWF0IHRoZSBtZXNzYWdlIGFzIGlmIGl0IGp1c3QK\nICAgICAgICAgKiBjYW1lIGluIHRocm91Z2ggYSBzY2FuCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0aW9uRmluaXNoZWQoT2JqZWN0\nIGN0eCwgTG9uZyByZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAgICAgICBQ\nZXJzaXN0UmVxdWVzdCBvcmlnaW5hbFJlcXVlc3QgPSAoUGVyc2lzdFJlcXVl\nc3QpIGN0eDsKCiAgICAgICAgICAgIC8vIExldHMgY2FsbCB0aGUgb3JpZ2lu\nYWwgY2FsbGJhY2sgZmlyc3Qgc28gdGhhdCB0aGUgcHVibGlzaGVyIGNhbgog\nICAgICAgICAgICAvLyBoZWFyIHN1Y2Nlc3MKICAgICAgICAgICAgb3JpZ2lu\nYWxSZXF1ZXN0LmdldENhbGxiYWNrKCkub3BlcmF0aW9uRmluaXNoZWQob3Jp\nZ2luYWxSZXF1ZXN0LmdldEN0eCgpLCByZXN1bHRPZk9wZXJhdGlvbik7Cgog\nICAgICAgICAgICAvLyBPcmlnaW5hbCBtZXNzYWdlIHRoYXQgd2FzIHBlcnNp\nc3RlZCBkaWRuJ3QgaGF2ZSB0aGUgbG9jYWwgc2VxLWlkLgogICAgICAgICAg\nICAvLyBMZXRzIGFkZCB0aGF0IGluCiAgICAgICAgICAgIE1lc3NhZ2UgbWVz\nc2FnZVdpdGhMb2NhbFNlcUlkID0gTWVzc2FnZUlkVXRpbHMubWVyZ2VMb2Nh\nbFNlcUlkKG9yaWdpbmFsUmVxdWVzdC5nZXRNZXNzYWdlKCksCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0T2ZP\ncGVyYXRpb24pOwoKICAgICAgICAgICAgLy8gTm93IGVucXVldWUgYSByZXF1\nZXN0IHRvIGFkZCB0aGlzIG5ld2x5IHBlcnNpc3RlZCBtZXNzYWdlIHRvIG91\ncgogICAgICAgICAgICAvLyBjYWNoZQogICAgICAgICAgICBDYWNoZUtleSBj\nYWNoZUtleSA9IG5ldyBDYWNoZUtleShvcmlnaW5hbFJlcXVlc3QuZ2V0VG9w\naWMoKSwgcmVzdWx0T2ZPcGVyYXRpb24pOwoKICAgICAgICAgICAgZW5xdWV1\nZVdpdGhvdXRGYWlsdXJlKG5ldyBTY2FuUmVzcG9uc2UoY2FjaGVLZXksIG1l\nc3NhZ2VXaXRoTG9jYWxTZXFJZCkpOwogICAgICAgIH0KCiAgICB9CgogICAg\nLyoqCiAgICAgKiBUb28gY29tcGxpY2F0ZWQgdG8gZGVhbCB3aXRoIGVucXVl\ndWUgZmFpbHVyZXMgZnJvbSB0aGUgY29udGV4dCBvZiBvdXIKICAgICAqIGNh\nbGxiYWNrcy4gSXRzIGp1c3Qgc2ltcGxlciB0byBxdWl0IGFuZCByZXN0YXJ0\nIGFmcmVzaC4gTW9yZW92ZXIsIHRoaXMKICAgICAqIHNob3VsZCBub3QgaGFw\ncGVuIGFzIHRoZSByZXF1ZXN0IHF1ZXVlIGZvciB0aGUgY2FjaGUgbWFpbnRh\naW5lciBpcwogICAgICogdW5ib3VuZGVkLgogICAgICoKICAgICAqIEBwYXJh\nbSBvYmoKICAgICAqLwogICAgcHJvdGVjdGVkIHZvaWQgZW5xdWV1ZVdpdGhv\ndXRGYWlsdXJlKENhY2hlUmVxdWVzdCBvYmopIHsKICAgICAgICBpZiAoIXJl\ncXVlc3RRdWV1ZS5vZmZlcihvYmopKSB7CiAgICAgICAgICAgIHRocm93IG5l\ndyBVbmV4cGVjdGVkRXJyb3IoIkNvdWxkIG5vdCBlbnF1ZXVlIG9iamVjdDog\nIiArIG9iai50b1N0cmluZygpCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgKyAiIHRvIGNhY2hlIHJlcXVlc3QgcXVldWUuIEV4aXRp\nbmcuIik7CgogICAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICAqIEFub3Ro\nZXIgbWV0aG9kIGZyb20ge0BsaW5rIFBlcnNpc3RlbmNlTWFuYWdlcn0uCiAg\nICAgKgogICAgICogMi4gU2NhbiAtIFNpbmNlIHRoZSBzY2FuIG5lZWRzIHRv\nIHRvdWNoIHRoZSBjYWNoZSwgd2Ugd2lsbCBqdXN0IGVucXVldWUKICAgICAq\nIHRoZSBzY2FuIHJlcXVlc3QgYW5kIGxldCB0aGUgY2FjaGUgbWFpbnRhaW5l\nciB0aHJlYWQgaGFuZGxlIGl0LgogICAgICovCiAgICBwdWJsaWMgdm9pZCBz\nY2FuU2luZ2xlTWVzc2FnZShTY2FuUmVxdWVzdCByZXF1ZXN0KSB7CiAgICAg\nICAgLy8gTGV0IHRoZSBzY2FuIHJlcXVlc3RzIGJlIHNlcmlhbGl6ZWQgdGhy\nb3VnaCB0aGUgcXVldWUKICAgICAgICBlbnF1ZXVlV2l0aG91dEZhaWx1cmUo\nbmV3IFNjYW5SZXF1ZXN0V3JhcHBlcihyZXF1ZXN0KSk7CiAgICB9CgogICAg\nLyoqCiAgICAgKiBBbm90aGVyIG1ldGhvZCBmcm9tIHtAbGluayBQZXJzaXN0\nZW5jZU1hbmFnZXJ9LgogICAgICoKICAgICAqIDMuIEVucXVldWUgdGhlIHJl\ncXVlc3Qgc28gdGhhdCB0aGUgY2FjaGUgbWFpbnRhaW5lciB0aHJlYWQgY2Fu\nIGRlbGV0ZSBhbGwKICAgICAqIG1lc3NhZ2UtaWRzIG9sZGVyIHRoYW4gdGhl\nIG9uZSBzcGVjaWZpZWQKICAgICAqLwogICAgcHVibGljIHZvaWQgZGVsaXZl\ncmVkVW50aWwoQnl0ZVN0cmluZyB0b3BpYywgTG9uZyBzZXFJZCkgewogICAg\nICAgIGVucXVldWVXaXRob3V0RmFpbHVyZShuZXcgRGVsaXZlcmVkVW50aWwo\ndG9waWMsIHNlcUlkKSk7CiAgICB9CgogICAgLyoqCiAgICAgKiBBbm90aGVy\nIG1ldGhvZCBmcm9tIHtAbGluayBQZXJzaXN0ZW5jZU1hbmFnZXJ9LgogICAg\nICoKICAgICAqIFNpbmNlIHRoaXMgaXMgYSBjYWNoZSBsYXllciBvbiB0b3Ag\nb2YgYW4gdW5kZXJseWluZyBwZXJzaXN0ZW5jZSBtYW5hZ2VyLAogICAgICog\nd2UgY2FuIGp1c3QgY2FsbCB0aGUgY29uc3VtZWRVbnRpbCBtZXRob2QgdGhl\ncmUuIFRoZSBtZXNzYWdlcyBvbGRlciB0aGFuCiAgICAgKiB0aGUgbGF0ZXN0\nIG9uZSBwYXNzZWQgaGVyZSB3b24ndCBiZSBhY2Nlc3NlZCBhbnltb3JlIHNv\nIHRoZXkgc2hvdWxkIGp1c3QKICAgICAqIGdldCBhZ2VkIG91dCBvZiB0aGUg\nY2FjaGUgZXZlbnR1YWxseS4gRm9yIG5vdywgdGhlcmUgaXMgbm8gbmVlZCB0\nbwogICAgICogcHJvYWN0aXZlbHkgcmVtb3ZlIHRob3NlIGVudHJpZXMgZnJv\nbSB0aGUgY2FjaGUuCiAgICAgKi8KICAgIHB1YmxpYyB2b2lkIGNvbnN1bWVk\nVW50aWwoQnl0ZVN0cmluZyB0b3BpYywgTG9uZyBzZXFJZCkgewogICAgICAg\nIHJlYWxQZXJzaXN0ZW5jZU1hbmFnZXIuY29uc3VtZWRVbnRpbCh0b3BpYywg\nc2VxSWQpOwogICAgfQoKICAgIHB1YmxpYyB2b2lkIHNldE1lc3NhZ2VCb3Vu\nZChCeXRlU3RyaW5nIHRvcGljLCBJbnRlZ2VyIGJvdW5kKSB7CiAgICAgICAg\ncmVhbFBlcnNpc3RlbmNlTWFuYWdlci5zZXRNZXNzYWdlQm91bmQodG9waWMs\nIGJvdW5kKTsKICAgIH0KCiAgICBwdWJsaWMgdm9pZCBjbGVhck1lc3NhZ2VC\nb3VuZChCeXRlU3RyaW5nIHRvcGljKSB7CiAgICAgICAgcmVhbFBlcnNpc3Rl\nbmNlTWFuYWdlci5jbGVhck1lc3NhZ2VCb3VuZCh0b3BpYyk7CiAgICB9Cgog\nICAgcHVibGljIHZvaWQgY29uc3VtZVRvQm91bmQoQnl0ZVN0cmluZyB0b3Bp\nYykgewogICAgICAgIHJlYWxQZXJzaXN0ZW5jZU1hbmFnZXIuY29uc3VtZVRv\nQm91bmQodG9waWMpOwogICAgfQoKICAgIC8qKgogICAgICogPT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09CiAgICAgKiBCRUdJTk5JTkcgT0YgQ09ERSBG\nT1IgVEhFIENBQ0hFIE1BSU5UQUlORVIgVEhSRUFECiAgICAgKgogICAgICog\nMS4gVGhlIHJ1biBtZXRob2QuIEl0IHNpbXBseSBkZXF1ZXVlcyBmcm9tIHRo\nZSByZXF1ZXN0IHF1ZXVlLCBjaGVja3MgdGhlCiAgICAgKiB0eXBlIG9mIG9i\namVjdCBhbmQgYWN0cyBhY2NvcmRpbmdseQogICAgICovCiAgICBwdWJsaWMg\ndm9pZCBydW4oKSB7CiAgICAgICAgd2hpbGUgKGtlZXBSdW5uaW5nKSB7CiAg\nICAgICAgICAgIENhY2hlUmVxdWVzdCBvYmo7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBvYmogPSByZXF1ZXN0UXVldWUudGFrZSgpOwog\nICAgICAgICAgICB9IGNhdGNoIChJbnRlcnJ1cHRlZEV4Y2VwdGlvbiBlKSB7\nCiAgICAgICAgICAgICAgICBUaHJlYWQuY3VycmVudFRocmVhZCgpLmludGVy\ncnVwdCgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9\nCiAgICAgICAgICAgIG9iai5wZXJmb3JtUmVxdWVzdCgpOwogICAgICAgIH0K\nCiAgICB9CgogICAgLyoqCiAgICAgKiBTdG9wIG1ldGhvZCB3aGljaCB3aWxs\nIGVucXVldWUgYSBTaHV0ZG93bkNhY2hlUmVxdWVzdC4KICAgICAqLwogICAg\ncHVibGljIHZvaWQgc3RvcCgpIHsKICAgICAgICBlbnF1ZXVlV2l0aG91dEZh\naWx1cmUobmV3IFNodXRkb3duQ2FjaGVSZXF1ZXN0KCkpOwogICAgfQoKICAg\nIC8qKgogICAgICogVGhlIHJlYWRhaGVhZCBwb2xpY3kgaXMgc2ltcGxlOiBX\nZSBjaGVjayBpZiBhbiBlbnRyeSBhbHJlYWR5IGV4aXN0cyBmb3IKICAgICAq\nIHRoZSBtZXNzYWdlIGJlaW5nIHJlcXVlc3RlZC4gSWYgYW4gZW50cnkgZXhp\nc3RzLCBpdCBtZWFucyB0aGF0IGVpdGhlcgogICAgICogdGhhdCBtZXNzYWdl\nIGlzIGFscmVhZHkgaW4gdGhlIGNhY2hlLCBvciBhIHJlYWQgZm9yIHRoYXQg\nbWVzc2FnZSBpcwogICAgICogb3V0c3RhbmRpbmcuIEluIHRoYXQgY2FzZSwg\nd2UgbG9vayBhIGxpdHRsZSBhaGVhZCAoYnkgcmVhZEFoZWFkQ291bnQvMikK\nICAgICAqIGFuZCBpc3N1ZSBhIHJhbmdlIHJlYWQgb2YgcmVhZEFoZWFkQ291\nbnQvMiBtZXNzYWdlcy4gVGhlIGlkZWEgaXMgdG8KICAgICAqIGVuc3VyZSB0\naGF0IHRoZSBuZXh0IHJlYWRBaGVhZENvdW50IG1lc3NhZ2VzIGFyZSBhbHdh\neXMgYXZhaWxhYmxlLgogICAgICoKICAgICAqIEByZXR1cm4gdGhlIHJhbmdl\nIHNjYW4gdGhhdCBzaG91bGQgYmUgaXNzdWVkIGZvciByZWFkIGFoZWFkCiAg\nICAgKi8KICAgIHByb3RlY3RlZCBSYW5nZVNjYW5SZXF1ZXN0IGRvUmVhZEFo\nZWFkKFNjYW5SZXF1ZXN0IHJlcXVlc3QpIHsKICAgICAgICBCeXRlU3RyaW5n\nIHRvcGljID0gcmVxdWVzdC5nZXRUb3BpYygpOwogICAgICAgIExvbmcgc2Vx\nSWQgPSByZXF1ZXN0LmdldFN0YXJ0U2VxSWQoKTsKCiAgICAgICAgaW50IHJl\nYWRBaGVhZENvdW50ID0gY2ZnLmdldFJlYWRBaGVhZENvdW50KCk7CiAgICAg\nICAgLy8gVG8gcHJldmVudCB1cyBmcm9tIGdldHRpbmcgc2NyZXdlZCBieSBi\nYWQgY29uZmlndXJhdGlvbgogICAgICAgIHJlYWRBaGVhZENvdW50ID0gTWF0\naC5tYXgoMSwgcmVhZEFoZWFkQ291bnQpOwoKICAgICAgICBSYW5nZVNjYW5S\nZXF1ZXN0IHJlYWRBaGVhZFJlcXVlc3QgPSBkb1JlYWRBaGVhZFN0YXJ0aW5n\nRnJvbSh0b3BpYywgc2VxSWQsIHJlYWRBaGVhZENvdW50KTsKCiAgICAgICAg\naWYgKHJlYWRBaGVhZFJlcXVlc3QgIT0gbnVsbCkgewogICAgICAgICAgICBy\nZXR1cm4gcmVhZEFoZWFkUmVxdWVzdDsKICAgICAgICB9CgogICAgICAgIC8v\nIHN0YXJ0IGtleSB3YXMgYWxyZWFkeSB0aGVyZSBpbiB0aGUgY2FjaGUgc28g\nbm8gcmVhZGFoZWFkIGhhcHBlbmVkLAogICAgICAgIC8vIGxldHMgbG9vayBh\nIGxpdHRsZSBiZXlvbmQKICAgICAgICBzZXFJZCA9IHJlYWxQZXJzaXN0ZW5j\nZU1hbmFnZXIuZ2V0U2VxSWRBZnRlclNraXBwaW5nKHRvcGljLCBzZXFJZCwg\ncmVhZEFoZWFkQ291bnQgLyAyKTsKCiAgICAgICAgcmVhZEFoZWFkUmVxdWVz\ndCA9IGRvUmVhZEFoZWFkU3RhcnRpbmdGcm9tKHRvcGljLCBzZXFJZCwgcmVh\nZEFoZWFkQ291bnQgLyAyKTsKCiAgICAgICAgcmV0dXJuIHJlYWRBaGVhZFJl\ncXVlc3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBUaGlzIG1ldGhvZCBqdXN0\nIGNoZWNrcyBpZiB0aGUgcHJvdmlkZWQgc2VxLWlkIGFscmVhZHkgZXhpc3Rz\nIGluIHRoZQogICAgICogY2FjaGUuIElmIG5vdCwgYSByYW5nZSByZWFkIG9m\nIHRoZSBzcGVjaWZpZWQgYW1vdW50IGlzIGlzc3VlZC4KICAgICAqCiAgICAg\nKiBAcGFyYW0gdG9waWMKICAgICAqIEBwYXJhbSBzZXFJZAogICAgICogQHBh\ncmFtIHJlYWRBaGVhZENvdW50CiAgICAgKiBAcmV0dXJuIFRoZSByYW5nZSBy\nZWFkIHRoYXQgc2hvdWxkIGJlIGlzc3VlZAogICAgICovCiAgICBwcm90ZWN0\nZWQgUmFuZ2VTY2FuUmVxdWVzdCBkb1JlYWRBaGVhZFN0YXJ0aW5nRnJvbShC\neXRlU3RyaW5nIHRvcGljLCBsb25nIHNlcUlkLCBpbnQgcmVhZEFoZWFkQ291\nbnQpIHsKCiAgICAgICAgbG9uZyBzdGFydFNlcUlkID0gc2VxSWQ7CiAgICAg\nICAgUXVldWU8Q2FjaGVLZXk+IGluc3RhbGxlZFN0dWJzID0gbmV3IExpbmtl\nZExpc3Q8Q2FjaGVLZXk+KCk7CgogICAgICAgIGludCBpID0gMDsKCiAgICAg\nICAgZm9yICg7IGkgPCByZWFkQWhlYWRDb3VudDsgaSsrKSB7CiAgICAgICAg\nICAgIENhY2hlS2V5IGNhY2hlS2V5ID0gbmV3IENhY2hlS2V5KHRvcGljLCBz\nZXFJZCk7CgogICAgICAgICAgICAvLyBFdmVuIGlmIGEgc3R1YiBleGlzdHMs\nIGl0IG1lYW5zIHRoYXQgYSBzY2FuIGZvciB0aGF0IGlzCiAgICAgICAgICAg\nIC8vIG91dHN0YW5kaW5nCiAgICAgICAgICAgIGlmIChjYWNoZS5jb250YWlu\nc0tleShjYWNoZUtleSkpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAg\nICAgICAgICB9CiAgICAgICAgICAgIENhY2hlVmFsdWUgY2FjaGVWYWx1ZSA9\nIG5ldyBDYWNoZVZhbHVlKCk7CiAgICAgICAgICAgIGNhY2hlLnB1dChjYWNo\nZUtleSwgY2FjaGVWYWx1ZSk7CgogICAgICAgICAgICBpZiAobG9nZ2VyLmlz\nRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1\nZygiQWRkaW5nIHN0dWIgZm9yIHNlcS1pZDogIiArIHNlcUlkICsgIiB0b3Bp\nYzogIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpKTsKICAgICAgICAgICAgfQog\nICAgICAgICAgICBpbnN0YWxsZWRTdHVicy5hZGQoY2FjaGVLZXkpOwoKICAg\nICAgICAgICAgc2VxSWQgPSByZWFsUGVyc2lzdGVuY2VNYW5hZ2VyLmdldFNl\ncUlkQWZ0ZXJTa2lwcGluZyh0b3BpYywgc2VxSWQsIDEpOwogICAgICAgIH0K\nCiAgICAgICAgLy8gc28gaG93IG1hbnkgZGlkIHdlIGRlY2lkZSB0byByZWFk\nYWhlYWQKICAgICAgICBpZiAoaSA9PSAwKSB7CiAgICAgICAgICAgIC8vIG5v\nIHJlYWRhaGVhZCwgaGVuY2UgcmV0dXJuIGZhbHNlCiAgICAgICAgICAgIHJl\ndHVybiBudWxsOwogICAgICAgIH0KCiAgICAgICAgbG9uZyByZWFkQWhlYWRT\naXplTGltaXQgPSBjZmcuZ2V0UmVhZEFoZWFkU2l6ZUJ5dGVzKCk7CiAgICAg\nICAgUmVhZEFoZWFkU2NhbkNhbGxiYWNrIGNhbGxiYWNrID0gbmV3IFJlYWRB\naGVhZFNjYW5DYWxsYmFjayhpbnN0YWxsZWRTdHVicywgdG9waWMpOwogICAg\nICAgIFJhbmdlU2NhblJlcXVlc3QgcmFuZ2VTY2FuUmVxdWVzdCA9IG5ldyBS\nYW5nZVNjYW5SZXF1ZXN0KHRvcGljLCBzdGFydFNlcUlkLCBpLCByZWFkQWhl\nYWRTaXplTGltaXQsIGNhbGxiYWNrLAogICAgICAgICAgICAgICAgbnVsbCk7\nCgogICAgICAgIHJldHVybiByYW5nZVNjYW5SZXF1ZXN0OwoKICAgIH0KCiAg\nICAvKioKICAgICAqIFRoaXMgaXMgdGhlIGNhbGxiYWNrIHRoYXQgaXMgdXNl\nZCBmb3IgdGhlIHJhbmdlIHNjYW5zLgogICAgICovCiAgICBwcm90ZWN0ZWQg\nY2xhc3MgUmVhZEFoZWFkU2NhbkNhbGxiYWNrIGltcGxlbWVudHMgU2NhbkNh\nbGxiYWNrIHsKICAgICAgICBRdWV1ZTxDYWNoZUtleT4gaW5zdGFsbGVkU3R1\nYnM7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYzsKCiAgICAgICAgLyoqCiAg\nICAgICAgICogQ29uc3RydWN0b3IKICAgICAgICAgKgogICAgICAgICAqIEBw\nYXJhbSBpbnN0YWxsZWRTdHVicwogICAgICAgICAqICAgICAgICAgICAgVGhl\nIGxpc3Qgb2Ygc3R1YnMgdGhhdCB3ZXJlIGluc3RhbGxlZCBmb3IgdGhpcyBy\nYW5nZSBzY2FuCiAgICAgICAgICogQHBhcmFtIHRvcGljCiAgICAgICAgICov\nCiAgICAgICAgcHVibGljIFJlYWRBaGVhZFNjYW5DYWxsYmFjayhRdWV1ZTxD\nYWNoZUtleT4gaW5zdGFsbGVkU3R1YnMsIEJ5dGVTdHJpbmcgdG9waWMpIHsK\nICAgICAgICAgICAgdGhpcy5pbnN0YWxsZWRTdHVicyA9IGluc3RhbGxlZFN0\ndWJzOwogICAgICAgICAgICB0aGlzLnRvcGljID0gdG9waWM7CiAgICAgICAg\nfQoKICAgICAgICBwdWJsaWMgdm9pZCBtZXNzYWdlU2Nhbm5lZChPYmplY3Qg\nY3R4LCBNZXNzYWdlIG1lc3NhZ2UpIHsKCiAgICAgICAgICAgIC8vIEFueSBt\nZXNzYWdlIHdlIHJlYWQgaXMgcG90ZW50aWFsbHkgdXNlZnVsIGZvciB1cywg\nc28gbGV0cyBmaXJzdAogICAgICAgICAgICAvLyBlbnF1ZXVlIGl0CiAgICAg\nICAgICAgIENhY2hlS2V5IGNhY2hlS2V5ID0gbmV3IENhY2hlS2V5KHRvcGlj\nLCBtZXNzYWdlLmdldE1zZ0lkKCkuZ2V0TG9jYWxDb21wb25lbnQoKSk7CiAg\nICAgICAgICAgIGVucXVldWVXaXRob3V0RmFpbHVyZShuZXcgU2NhblJlc3Bv\nbnNlKGNhY2hlS2V5LCBtZXNzYWdlKSk7CgogICAgICAgICAgICAvLyBOb3cg\nbGV0cyBzZWUgaWYgdGhpcyBtZXNzYWdlIGlzIHRoZSBvbmUgd2Ugd2VyZSBl\neHBlY3RpbmcKICAgICAgICAgICAgQ2FjaGVLZXkgZXhwZWN0ZWRLZXkgPSBp\nbnN0YWxsZWRTdHVicy5wZWVrKCk7CgogICAgICAgICAgICBpZiAoZXhwZWN0\nZWRLZXkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgLy8gV2FzIG5vdCBl\neHBlY3RpbmcgYW55IG1vcmUgbWVzc2FnZXMgdG8gY29tZSBpbiwgYnV0IHRo\nZXkgY2FtZQogICAgICAgICAgICAgICAgLy8gaW4gc28gd2Ugd2lsbCBrZWVw\nIHRoZW0KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgaWYgKGV4cGVjdGVkS2V5LmVxdWFscyhjYWNoZUtleSkp\nIHsKICAgICAgICAgICAgICAgIC8vIHdoYXQgd2UgZ290IGlzIHdoYXQgd2Ug\nZXhwZWN0ZWQsIGRlcXVldWUgaXQgc28gd2UgZ2V0IHRoZQogICAgICAgICAg\nICAgICAgLy8gbmV4dCBleHBlY3RlZCBvbmUKICAgICAgICAgICAgICAgIGlu\nc3RhbGxlZFN0dWJzLnBvbGwoKTsKICAgICAgICAgICAgICAgIHJldHVybjsK\nICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gSWYgcmVhY2hlZCBoZXJl\nLCB3aGF0IHdlIHNjYW5uZWQgd2FzIG5vdCB3aGF0IHdlIHdlcmUgZXhwZWN0\naW5nLgogICAgICAgICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgd2UgaGF2ZSB3\ncm9uZyBzdHVicyBpbnN0YWxsZWQgaW4gdGhlIGNhY2hlLiBXZQogICAgICAg\nICAgICAvLyBzaG91bGQgcmVtb3ZlIHRoZW0sIHNvIHRoYXQgd2hvZXZlciBp\ncyB3YWl0aW5nIG9uIHRoZW0gY2FuIHJldHJ5LgogICAgICAgICAgICAvLyBU\naGlzIHNob3VsZG4ndCBiZSBoYXBwZW5pbmcgdXN1YWxseQogICAgICAgICAg\nICBsb2dnZXIud2FybigiVW5leHBlY3RlZCBtZXNzYWdlIHNlcS1pZDogIiAr\nIG1lc3NhZ2UuZ2V0TXNnSWQoKS5nZXRMb2NhbENvbXBvbmVudCgpICsgIiBv\nbiB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpICsgIiBmcm9tIHJlYWRhaGVhZCBzY2FuLCB3YXMgZXhw\nZWN0aW5nIHNlcS1pZDogIiArIGV4cGVjdGVkS2V5LnNlcUlkCiAgICAgICAg\nICAgICAgICAgICAgICAgICsgIiB0b3BpYzogIiArIGV4cGVjdGVkS2V5LnRv\ncGljLnRvU3RyaW5nVXRmOCgpICsgIiBpbnN0YWxsZWRTdHViczogIiArIGlu\nc3RhbGxlZFN0dWJzKTsKICAgICAgICAgICAgZW5xdWV1ZURlbGV0ZU9mUmVt\nYWluaW5nU3R1YnMobm9TdWNoU2VxSWRFeGNlcHRpb25JbnN0YW5jZSk7Cgog\nICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgc2NhbkZhaWxlZChPYmpl\nY3QgY3R4LCBFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgIGVu\ncXVldWVEZWxldGVPZlJlbWFpbmluZ1N0dWJzKGV4Y2VwdGlvbik7CiAgICAg\nICAgfQoKICAgICAgICBwdWJsaWMgdm9pZCBzY2FuRmluaXNoZWQoT2JqZWN0\nIGN0eCwgUmVhc29uRm9yRmluaXNoIHJlYXNvbikgewogICAgICAgICAgICAv\nLyBJZiB0aGUgc2NhbiBmaW5pc2hlZCBiZWNhdXNlIG5vIG1vcmUgbWVzc2Fn\nZXMgYXJlIHByZXNlbnQsIGl0cyBvawogICAgICAgICAgICAvLyB0byBsZWF2\nZSB0aGUgc3R1YnMgaW4gcGxhY2UgYmVjYXVzZSB0aGV5IHdpbGwgZ2V0IGZp\nbGxlZCBpbiBhcwogICAgICAgICAgICAvLyBuZXcgcHVibGlzaGVzIGhhcHBl\nbi4gSG93ZXZlciwgaWYgdGhlIHNjYW4gZmluaXNoZWQgZHVlIHRvIHNvbWUK\nICAgICAgICAgICAgLy8gb3RoZXIgcmVhc29uLCBlLmcuLCByZWFkIGFoZWFk\nIHNpemUgbGltaXQgd2FzIHJlYWNoZWQsIHdlIHdhbnQgdG8KICAgICAgICAg\nICAgLy8gZGVsZXRlIHRoZSBzdHVicywgc28gdGhhdCB3aGVuIHRoZSB0aW1l\nIGNvbWVzLCB3ZSBjYW4gc2NoZWR1bGUKICAgICAgICAgICAgLy8gYW5vdGhl\nciByZWFkYWhlYWQgcmVxdWVzdC4KICAgICAgICAgICAgaWYgKHJlYXNvbiAh\nPSBSZWFzb25Gb3JGaW5pc2guTk9fTU9SRV9NRVNTQUdFUykgewogICAgICAg\nICAgICAgICAgZW5xdWV1ZURlbGV0ZU9mUmVtYWluaW5nU3R1YnMocmVhZEFo\nZWFkRXhjZXB0aW9uSW5zdGFuY2UpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICBwcml2YXRlIHZvaWQgZW5xdWV1ZURlbGV0ZU9mUmVtYWlu\naW5nU3R1YnMoRXhjZXB0aW9uIHJlYXNvbikgewogICAgICAgICAgICBDYWNo\nZUtleSBpbnN0YWxsZWRTdHViOwogICAgICAgICAgICB3aGlsZSAoKGluc3Rh\nbGxlZFN0dWIgPSBpbnN0YWxsZWRTdHVicy5wb2xsKCkpICE9IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGVucXVldWVXaXRob3V0RmFpbHVyZShuZXcgRXhj\nZXB0aW9uT25DYWNoZUtleShpbnN0YWxsZWRTdHViLCByZWFzb24pKTsKICAg\nICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGNsYXNzIEhhc2hTZXRDYWNoZUtleUZhY3RvcnkgaW1wbGVtZW50cyBG\nYWN0b3J5PFNldDxDYWNoZUtleT4+IHsKICAgICAgICBwcm90ZWN0ZWQgZmlu\nYWwgc3RhdGljIEhhc2hTZXRDYWNoZUtleUZhY3RvcnkgaW5zdGFuY2UgPSBu\nZXcgSGFzaFNldENhY2hlS2V5RmFjdG9yeSgpOwoKICAgICAgICBwdWJsaWMg\nU2V0PENhY2hlS2V5PiBuZXdJbnN0YW5jZSgpIHsKICAgICAgICAgICAgcmV0\ndXJuIG5ldyBIYXNoU2V0PENhY2hlS2V5PigpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwcm90ZWN0ZWQgc3RhdGljIGNsYXNzIFRyZWVTZXRMb25nRmFjdG9y\neSBpbXBsZW1lbnRzIEZhY3Rvcnk8U29ydGVkU2V0PExvbmc+PiB7CiAgICAg\nICAgcHJvdGVjdGVkIGZpbmFsIHN0YXRpYyBUcmVlU2V0TG9uZ0ZhY3Rvcnkg\naW5zdGFuY2UgPSBuZXcgVHJlZVNldExvbmdGYWN0b3J5KCk7CgogICAgICAg\nIHB1YmxpYyBTb3J0ZWRTZXQ8TG9uZz4gbmV3SW5zdGFuY2UoKSB7CiAgICAg\nICAgICAgIHJldHVybiBuZXcgVHJlZVNldDxMb25nPigpOwogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIEZvciBhZGRpbmcgdGhlIG1lc3NhZ2Ug\ndG8gdGhlIGNhY2hlLCB3ZSBkbyBzb21lIGJvb2tlZXBpbmcgc3VjaCBhcyB0\naGUKICAgICAqIHRvdGFsIHNpemUgb2YgY2FjaGUsIG9yZGVyIGluIHdoaWNo\nIGVudHJpZXMgd2VyZSBhZGRlZCBldGMuIElmIHRoZSBzaXplCiAgICAgKiBv\nZiB0aGUgY2FjaGUgaGFzIGV4Y2VlZGVkIG91ciBidWRnZXQsIG9sZCBlbnRy\naWVzIGFyZSBjb2xsZWN0ZWQuCiAgICAgKgogICAgICogQHBhcmFtIGNhY2hl\nS2V5CiAgICAgKiBAcGFyYW0gbWVzc2FnZQogICAgICovCiAgICBwcm90ZWN0\nZWQgdm9pZCBhZGRNZXNzYWdlVG9DYWNoZShDYWNoZUtleSBjYWNoZUtleSwg\nTWVzc2FnZSBtZXNzYWdlLCBsb25nIGN1cnJUaW1lKSB7CiAgICAgICAgaWYg\nKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dl\nci5kZWJ1ZygiQWRkaW5nIG1zZyAodG9waWM6ICIgKyBjYWNoZUtleS5nZXRU\nb3BpYygpLnRvU3RyaW5nVXRmOCgpICsgIiwgc2VxLWlkOiAiCiAgICAgICAg\nICAgICAgICAgICAgICAgICArIG1lc3NhZ2UuZ2V0TXNnSWQoKS5nZXRMb2Nh\nbENvbXBvbmVudCgpICsgIikgdG8gcmVhZGFoZWFkIGNhY2hlIik7CiAgICAg\nICAgfQoKICAgICAgICBDYWNoZVZhbHVlIGNhY2hlVmFsdWU7CgogICAgICAg\nIGlmICgoY2FjaGVWYWx1ZSA9IGNhY2hlLmdldChjYWNoZUtleSkpID09IG51\nbGwpIHsKICAgICAgICAgICAgY2FjaGVWYWx1ZSA9IG5ldyBDYWNoZVZhbHVl\nKCk7CiAgICAgICAgICAgIGNhY2hlLnB1dChjYWNoZUtleSwgY2FjaGVWYWx1\nZSk7CiAgICAgICAgfQoKICAgICAgICAvLyB1cGRhdGUgdGhlIGNhY2hlIHNp\nemUKICAgICAgICBwcmVzZW50Q2FjaGVTaXplICs9IG1lc3NhZ2UuZ2V0Qm9k\neSgpLnNpemUoKTsKCiAgICAgICAgLy8gbWFpbnRhaW4gdGhlIHRpbWUgaW5k\nZXggb2YgYWRkaXRpb24KICAgICAgICBNYXBNZXRob2RzLmFkZFRvTXVsdGlN\nYXAodGltZUluZGV4T2ZBZGRpdGlvbiwgY3VyclRpbWUsIGNhY2hlS2V5LCBI\nYXNoU2V0Q2FjaGVLZXlGYWN0b3J5Lmluc3RhbmNlKTsKCiAgICAgICAgLy8g\nbWFpbnRhaW4gdGhlIGluZGV4IG9mIHNlcS1pZAogICAgICAgIE1hcE1ldGhv\nZHMuYWRkVG9NdWx0aU1hcChvcmRlcmVkSW5kZXhPblNlcUlkLCBjYWNoZUtl\neS5nZXRUb3BpYygpLCBjYWNoZUtleS5nZXRTZXFJZCgpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBUcmVlU2V0TG9uZ0ZhY3RvcnkuaW5z\ndGFuY2UpOwoKICAgICAgICAvLyBmaW5hbGx5IGFkZCB0aGUgbWVzc2FnZSB0\nbyB0aGUgY2FjaGUKICAgICAgICBjYWNoZVZhbHVlLnNldE1lc3NhZ2VBbmRJ\nbnZva2VDYWxsYmFja3MobWVzc2FnZSwgY3VyclRpbWUpOwoKICAgICAgICAv\nLyBpZiBvdmVyZ3Jvd24sIGNvbGxlY3Qgb2xkIGVudHJpZXMKICAgICAgICBj\nb2xsZWN0T2xkQ2FjaGVFbnRyaWVzKCk7CiAgICB9CgogICAgcHJvdGVjdGVk\nIHZvaWQgcmVtb3ZlTWVzc2FnZUZyb21DYWNoZShDYWNoZUtleSBjYWNoZUtl\neSwgRXhjZXB0aW9uIGV4Y2VwdGlvbiwgYm9vbGVhbiBtYWludGFpblRpbWVJ\nbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgYm9vbGVhbiBtYWludGFpblNlcUlkSW5kZXgpIHsKICAgICAgICBDYWNo\nZVZhbHVlIGNhY2hlVmFsdWUgPSBjYWNoZS5yZW1vdmUoY2FjaGVLZXkpOwoK\nICAgICAgICBpZiAoY2FjaGVWYWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAg\nIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChjYWNoZVZhbHVlLmlz\nU3R1YigpKSB7CiAgICAgICAgICAgIGNhY2hlVmFsdWUuc2V0RXJyb3JBbmRJ\nbnZva2VDYWxsYmFja3MoZXhjZXB0aW9uKTsKICAgICAgICAgICAgLy8gU3R1\nYnMgYXJlIG5vdCBwcmVzZW50IGluIHRoZSBpbmRleGVzLCBzbyBkb250IG5l\nZWQgdG8gbWFpbnRhaW4KICAgICAgICAgICAgLy8gaW5kZXhlcyBoZXJlCiAg\nICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHByZXNlbnRD\nYWNoZVNpemUgLT0gY2FjaGVWYWx1ZS5nZXRNZXNzYWdlKCkuZ2V0Qm9keSgp\nLnNpemUoKTsKCiAgICAgICAgLy8gbWFpbnRhaW4gdGhlIDIgaW5kZXhlcwog\nICAgICAgIC8vIFRPRE86IGNhbiB3ZSBtYWludGFpbiB0aGVzZSBsYXppbHk/\nCiAgICAgICAgaWYgKG1haW50YWluU2VxSWRJbmRleCkgewogICAgICAgICAg\nICBNYXBNZXRob2RzLnJlbW92ZUZyb21NdWx0aU1hcChvcmRlcmVkSW5kZXhP\nblNlcUlkLCBjYWNoZUtleS5nZXRUb3BpYygpLCBjYWNoZUtleS5nZXRTZXFJ\nZCgpKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1haW50YWluVGltZUluZGV4\nKSB7CiAgICAgICAgICAgIE1hcE1ldGhvZHMucmVtb3ZlRnJvbU11bHRpTWFw\nKHRpbWVJbmRleE9mQWRkaXRpb24sIGNhY2hlVmFsdWUuZ2V0VGltZU9mQWRk\naXRpb24oKSwgY2FjaGVLZXkpOwogICAgICAgIH0KICAgIH0KCiAgICAvKioK\nICAgICAqIENvbGxlY3Rpb24gb2Ygb2xkIGVudHJpZXMgaXMgc2ltcGxlLiBK\ndXN0IGNvbGxlY3QgaW4gaW5zZXJ0LXRpbWUgb3JkZXIsCiAgICAgKiBvbGRl\nc3QgdG8gbmV3ZXN0LgogICAgICovCiAgICBwcm90ZWN0ZWQgdm9pZCBjb2xs\nZWN0T2xkQ2FjaGVFbnRyaWVzKCkgewogICAgICAgIGxvbmcgbWF4Q2FjaGVT\naXplID0gY2ZnLmdldE1heGltdW1DYWNoZVNpemUoKTsKCiAgICAgICAgd2hp\nbGUgKHByZXNlbnRDYWNoZVNpemUgPiBtYXhDYWNoZVNpemUgJiYgIXRpbWVJ\nbmRleE9mQWRkaXRpb24uaXNFbXB0eSgpKSB7CiAgICAgICAgICAgIExvbmcg\nZWFybGllc3RUaW1lID0gdGltZUluZGV4T2ZBZGRpdGlvbi5maXJzdEtleSgp\nOwogICAgICAgICAgICBTZXQ8Q2FjaGVLZXk+IG9sZENhY2hlRW50cmllcyA9\nIHRpbWVJbmRleE9mQWRkaXRpb24uZ2V0KGVhcmxpZXN0VGltZSk7CgogICAg\nICAgICAgICAvLyBOb3RlOiBvbmx5IGNvbmNyZXRlIGNhY2hlIGVudHJpZXMs\nIGFuZCBub3Qgc3R1YnMgYXJlIGluIHRoZSB0aW1lCiAgICAgICAgICAgIC8v\nIGluZGV4LiBIZW5jZSB0aGVyZSBjYW4gYmUgbm8gY2FsbGJhY2tzIHBlbmRp\nbmcgb24gdGhlc2UgY2FjaGUKICAgICAgICAgICAgLy8gZW50cmllcy4gSGVu\nY2Ugc2FmZSB0byByZW1vdmUgdGhlbSBkaXJlY3RseS4KICAgICAgICAgICAg\nZm9yIChJdGVyYXRvcjxDYWNoZUtleT4gaXRlciA9IG9sZENhY2hlRW50cmll\ncy5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTspIHsKICAgICAgICAgICAg\nICAgIENhY2hlS2V5IGNhY2hlS2V5ID0gaXRlci5uZXh0KCk7CgogICAgICAg\nICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJSZW1vdmluZyB0b3BpYzog\nIiArIGNhY2hlS2V5LmdldFRvcGljKCkgKyAic2VxLWlkOiAiICsgY2FjaGVL\nZXkuZ2V0U2VxSWQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICArICIgZnJvbSBjYWNoZSBiZWNhdXNlIGl0cyB0aGUgb2xkZXN0Iik7CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZW1vdmVNZXNzYWdl\nRnJvbUNhY2hlKGNhY2hlS2V5LCByZWFkQWhlYWRFeGNlcHRpb25JbnN0YW5j\nZSwgLy8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nLy8gbWFpbnRhaW5UaW1lSW5kZXg9CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIGZhbHNlLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyBtYWludGFpblNlcUlkSW5kZXg9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRydWUpOwogICAg\nICAgICAgICB9CgogICAgICAgICAgICB0aW1lSW5kZXhPZkFkZGl0aW9uLnJl\nbW92ZShlYXJsaWVzdFRpbWUpOwoKICAgICAgICB9CiAgICB9CgogICAgLyoq\nCiAgICAgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09\nPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAqIFRo\nZSByZXN0IGlzIGp1c3Qgc2ltcGxlIHdyYXBwZXIgY2xhc3Nlcy4KICAgICAq\nCiAgICAgKi8KCiAgICBwcm90ZWN0ZWQgY2xhc3MgRXhjZXB0aW9uT25DYWNo\nZUtleSBpbXBsZW1lbnRzIENhY2hlUmVxdWVzdCB7CiAgICAgICAgQ2FjaGVL\nZXkgY2FjaGVLZXk7CiAgICAgICAgRXhjZXB0aW9uIGV4Y2VwdGlvbjsKCiAg\nICAgICAgcHVibGljIEV4Y2VwdGlvbk9uQ2FjaGVLZXkoQ2FjaGVLZXkgY2Fj\naGVLZXksIEV4Y2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgdGhp\ncy5jYWNoZUtleSA9IGNhY2hlS2V5OwogICAgICAgICAgICB0aGlzLmV4Y2Vw\ndGlvbiA9IGV4Y2VwdGlvbjsKICAgICAgICB9CgogICAgICAgIC8qKgogICAg\nICAgICAqIElmIGZvciBzb21lIHJlYXNvbiwgYW4gb3V0c3RhbmRpbmcgcmVh\nZCBvbiBhIGNhY2hlIHN0dWIgZmFpbHMsCiAgICAgICAgICogZXhjZXB0aW9u\nIGZvciB0aGF0IGtleSBpcyBlbnF1ZXVlZCBieSB0aGUKICAgICAgICAgKiB7\nQGxpbmsgUmVhZEFoZWFkU2NhbkNhbGxiYWNrfS4gVG8gaGFuZGxlIHRoaXMs\nIHdlIHNpbXBseSBzZW5kIGVycm9yCiAgICAgICAgICogb24gdGhlIGNhbGxi\nYWNrcyByZWdpc3RlcmVkIGZvciB0aGF0IHN0dWIsIGFuZCBkZWxldGUgdGhl\nIGVudHJ5IGZyb20KICAgICAgICAgKiB0aGUgY2FjaGUKICAgICAgICAgKi8K\nICAgICAgICBwdWJsaWMgdm9pZCBwZXJmb3JtUmVxdWVzdCgpIHsKICAgICAg\nICAgICAgcmVtb3ZlTWVzc2FnZUZyb21DYWNoZShjYWNoZUtleSwgZXhjZXB0\naW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1h\naW50YWluVGltZUluZGV4PQogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgLy8gbWFpbnRhaW5TZXFJZEluZGV4PQogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIHRydWUpOwogICAgICAgIH0KCiAgICB9CgogICAg\nQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIpCiAgICBwcm90ZWN0ZWQgc3Rh\ndGljIGNsYXNzIE5vU3VjaFNlcUlkRXhjZXB0aW9uIGV4dGVuZHMgRXhjZXB0\naW9uIHsKCiAgICAgICAgcHVibGljIE5vU3VjaFNlcUlkRXhjZXB0aW9uKCkg\newogICAgICAgICAgICBzdXBlcigiTm8gc3VjaCBzZXEtaWQiKTsKICAgICAg\nICB9CiAgICB9CgogICAgQFN1cHByZXNzV2FybmluZ3MoInNlcmlhbCIpCiAg\nICBwcm90ZWN0ZWQgc3RhdGljIGNsYXNzIFJlYWRBaGVhZEV4Y2VwdGlvbiBl\neHRlbmRzIEV4Y2VwdGlvbiB7CiAgICAgICAgcHVibGljIFJlYWRBaGVhZEV4\nY2VwdGlvbigpIHsKICAgICAgICAgICAgc3VwZXIoIlJlYWRhaGVhZCBmYWls\nZWQiKTsKICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGNsYXNzIFNj\nYW5SZXNwb25zZSBpbXBsZW1lbnRzIENhY2hlUmVxdWVzdCB7CiAgICAgICAg\nQ2FjaGVLZXkgY2FjaGVLZXk7CiAgICAgICAgTWVzc2FnZSBtZXNzYWdlOwoK\nICAgICAgICBwdWJsaWMgU2NhblJlc3BvbnNlKENhY2hlS2V5IGNhY2hlS2V5\nLCBNZXNzYWdlIG1lc3NhZ2UpIHsKICAgICAgICAgICAgdGhpcy5jYWNoZUtl\neSA9IGNhY2hlS2V5OwogICAgICAgICAgICB0aGlzLm1lc3NhZ2UgPSBtZXNz\nYWdlOwogICAgICAgIH0KCiAgICAgICAgcHVibGljIHZvaWQgcGVyZm9ybVJl\ncXVlc3QoKSB7CiAgICAgICAgICAgIGFkZE1lc3NhZ2VUb0NhY2hlKGNhY2hl\nS2V5LCBtZXNzYWdlLCBTeXN0ZW0uY3VycmVudFRpbWVNaWxsaXMoKSk7CiAg\nICAgICAgfQoKICAgIH0KCiAgICBwcm90ZWN0ZWQgY2xhc3MgRGVsaXZlcmVk\nVW50aWwgaW1wbGVtZW50cyBDYWNoZVJlcXVlc3QgewogICAgICAgIEJ5dGVT\ndHJpbmcgdG9waWM7CiAgICAgICAgTG9uZyBzZXFJZDsKCiAgICAgICAgcHVi\nbGljIERlbGl2ZXJlZFVudGlsKEJ5dGVTdHJpbmcgdG9waWMsIExvbmcgc2Vx\nSWQpIHsKICAgICAgICAgICAgdGhpcy50b3BpYyA9IHRvcGljOwogICAgICAg\nICAgICB0aGlzLnNlcUlkID0gc2VxSWQ7CiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBwZXJmb3JtUmVxdWVzdCgpIHsKICAgICAgICAgICAgU29y\ndGVkU2V0PExvbmc+IG9yZGVyZWRTZXFJZHMgPSBvcmRlcmVkSW5kZXhPblNl\ncUlkLmdldCh0b3BpYyk7CiAgICAgICAgICAgIGlmIChvcmRlcmVkU2VxSWRz\nID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgfQoKICAgICAgICAgICAgLy8gZm9jdXMgb24gdGhlIHNldCBvZiBtZXNz\nYWdlcyB3aXRoIHNlcS1pZHMgPD0gdGhlIG9uZSB0aGF0CiAgICAgICAgICAg\nIC8vIGhhcyBiZWVuIGRlbGl2ZXJlZCB1bnRpbAogICAgICAgICAgICBTb3J0\nZWRTZXQ8TG9uZz4gaGVhZFNldCA9IG9yZGVyZWRTZXFJZHMuaGVhZFNldChz\nZXFJZCArIDEpOwoKICAgICAgICAgICAgZm9yIChJdGVyYXRvcjxMb25nPiBp\ndGVyID0gaGVhZFNldC5pdGVyYXRvcigpOyBpdGVyLmhhc05leHQoKTspIHsK\nICAgICAgICAgICAgICAgIExvbmcgc2VxSWQgPSBpdGVyLm5leHQoKTsKICAg\nICAgICAgICAgICAgIENhY2hlS2V5IGNhY2hlS2V5ID0gbmV3IENhY2hlS2V5\nKHRvcGljLCBzZXFJZCk7CgogICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5p\nc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2Vy\nLmRlYnVnKCJSZW1vdmluZyBzZXEtaWQ6ICIgKyBjYWNoZUtleS5nZXRTZXFJ\nZCgpICsgIiB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICArIGNhY2hlS2V5LmdldFRvcGljKCkudG9TdHJpbmdVdGY4KCkKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGZyb20gY2FjaGUg\nYmVjYXVzZSBldmVyeSBzdWJzY3JpYmVyIGhhcyBtb3ZlZCBwYXN0Iik7CiAg\nICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmVtb3ZlTWVzc2Fn\nZUZyb21DYWNoZShjYWNoZUtleSwgcmVhZEFoZWFkRXhjZXB0aW9uSW5zdGFu\nY2UsIC8vCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIC8vIG1haW50YWluVGltZUluZGV4PQogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICB0cnVlLAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyBtYWludGFpblNlcUlkSW5kZXg9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlKTsKICAg\nICAgICAgICAgICAgIGl0ZXIucmVtb3ZlKCk7CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChvcmRlcmVkU2VxSWRzLmlzRW1wdHkoKSkgewogICAg\nICAgICAgICAgICAgb3JkZXJlZEluZGV4T25TZXFJZC5yZW1vdmUodG9waWMp\nOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3Rl\nZCBjbGFzcyBTY2FuUmVxdWVzdFdyYXBwZXIgaW1wbGVtZW50cyBDYWNoZVJl\ncXVlc3QgewogICAgICAgIFNjYW5SZXF1ZXN0IHJlcXVlc3Q7CgogICAgICAg\nIHB1YmxpYyBTY2FuUmVxdWVzdFdyYXBwZXIoU2NhblJlcXVlc3QgcmVxdWVz\ndCkgewogICAgICAgICAgICB0aGlzLnJlcXVlc3QgPSByZXF1ZXN0OwogICAg\nICAgIH0KCiAgICAgICAgLyoqCiAgICAgICAgICogVG8gaGFuZGxlIGEgc2Nh\nbiByZXF1ZXN0LCB3ZSBmaXJzdCB0cnkgdG8gZG8gcmVhZGFoZWFkICh3aGlj\naCBtaWdodAogICAgICAgICAqIGNhdXNlIGEgcmFuZ2UgcmVhZCB0byBiZSBp\nc3N1ZWQgdG8gdGhlIHVuZGVybHlpbmcgcGVyc2lzdGVuY2UKICAgICAgICAg\nKiBtYW5hZ2VyKS4gVGhlIHJlYWRhaGVhZCB3aWxsIHB1dCBhIHN0dWIgaW4g\ndGhlIGNhY2hlLCBpZiB0aGUgbWVzc2FnZQogICAgICAgICAqIGlzIG5vdCBh\nbHJlYWR5IHByZXNlbnQgaW4gdGhlIGNhY2hlLiBUaGUgc2NhbiBjYWxsYmFj\nayB0aGF0IGlzIHBhcnQKICAgICAgICAgKiBvZiB0aGUgc2NhbiByZXF1ZXN0\nIGlzIGFkZGVkIHRvIHRoaXMgc3R1YiwgYW5kIHdpbGwgYmUgY2FsbGVkIGxh\ndGVyCiAgICAgICAgICogd2hlbiB0aGUgbWVzc2FnZSBhcnJpdmVzIGFzIGEg\ncmVzdWx0IG9mIHRoZSByYW5nZSBzY2FuIGlzc3VlZCB0byB0aGUKICAgICAg\nICAgKiB1bmRlcmx5aW5nIHBlcnNpc3RlbmNlIG1hbmFnZXIuCiAgICAgICAg\nICovCgogICAgICAgIHB1YmxpYyB2b2lkIHBlcmZvcm1SZXF1ZXN0KCkgewoK\nICAgICAgICAgICAgUmFuZ2VTY2FuUmVxdWVzdCByZWFkQWhlYWRSZXF1ZXN0\nID0gZG9SZWFkQWhlYWQocmVxdWVzdCk7CgogICAgICAgICAgICAvLyBSZWFk\nIGFoZWFkIG11c3QgaGF2ZSBpbnN0YWxsZWQgYXQgbGVhc3QgYSBzdHViIGZv\nciB1cywgc28gdGhpcwogICAgICAgICAgICAvLyBjYW4ndCBiZSBudWxsCiAg\nICAgICAgICAgIENhY2hlVmFsdWUgY2FjaGVWYWx1ZSA9IGNhY2hlLmdldChu\nZXcgQ2FjaGVLZXkocmVxdWVzdC5nZXRUb3BpYygpLCByZXF1ZXN0LmdldFN0\nYXJ0U2VxSWQoKSkpOwoKICAgICAgICAgICAgLy8gQWRkIG91ciBjYWxsYmFj\nayB0byB0aGUgc3R1Yi4gSWYgdGhlIGNhY2hlIHZhbHVlIHdhcyBhbHJlYWR5\nIGEKICAgICAgICAgICAgLy8gY29uY3JldGUgbWVzc2FnZSwgdGhlIGNhbGxi\nYWNrIHdpbGwgYmUgY2FsbGVkIHJpZ2h0IGF3YXkKICAgICAgICAgICAgY2Fj\naGVWYWx1ZS5hZGRDYWxsYmFjayhyZXF1ZXN0LmdldENhbGxiYWNrKCksIHJl\ncXVlc3QuZ2V0Q3R4KCkpOwoKICAgICAgICAgICAgaWYgKHJlYWRBaGVhZFJl\ncXVlc3QgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmVhbFBlcnNpc3Rl\nbmNlTWFuYWdlci5zY2FuTWVzc2FnZXMocmVhZEFoZWFkUmVxdWVzdCk7CiAg\nICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgcHJvdGVjdGVkIGNs\nYXNzIFNodXRkb3duQ2FjaGVSZXF1ZXN0IGltcGxlbWVudHMgQ2FjaGVSZXF1\nZXN0IHsKICAgICAgICAvLyBUaGlzIGlzIGEgc2ltcGxlIHR5cGUgb2YgQ2Fj\naGVSZXF1ZXN0IHdlIHdpbGwgZW5xdWV1ZSB3aGVuCiAgICAgICAgLy8gdGhl\nIFB1YlN1YlNlcnZlciBpcyBzaHV0IGRvd24gYW5kIHdlIHdhbnQgdG8gc3Rv\ncCB0aGUgUmVhZEFoZWFkQ2FjaGUKICAgICAgICAvLyB0aHJlYWQuCiAgICAg\nICAgcHVibGljIHZvaWQgcGVyZm9ybVJlcXVlc3QoKSB7CiAgICAgICAgICAg\nIGtlZXBSdW5uaW5nID0gZmFsc2U7CiAgICAgICAgfQogICAgfQoKICAgIEBP\ndmVycmlkZQogICAgcHVibGljIHZvaWQgcmVnaXN0ZXJKTVgoSGVkd2lnTUJl\nYW5JbmZvIHBhcmVudCkgewogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGpt\neENhY2hlQmVhbiA9IG5ldyBSZWFkQWhlYWRDYWNoZUJlYW4odGhpcyk7CiAg\nICAgICAgICAgIEhlZHdpZ01CZWFuUmVnaXN0cnkuZ2V0SW5zdGFuY2UoKS5y\nZWdpc3RlcihqbXhDYWNoZUJlYW4sIG51bGwpOwogICAgICAgIH0gY2F0Y2gg\nKEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuKCJGYWls\nZWQgdG8gcmVnaXN0ZXIgcmVhZGFoZWFkIGNhY2hlIHdpdGggSk1YIiwgZSk7\nCiAgICAgICAgICAgIGpteENhY2hlQmVhbiA9IG51bGw7CiAgICAgICAgfQog\nICAgfQoKICAgIEBPdmVycmlkZQogICAgcHVibGljIHZvaWQgdW5yZWdpc3Rl\nckpNWCgpIHsKICAgICAgICB0cnkgewogICAgICAgICAgICBpZiAoam14Q2Fj\naGVCZWFuICE9IG51bGwpIHsKICAgICAgICAgICAgICAgIEhlZHdpZ01CZWFu\nUmVnaXN0cnkuZ2V0SW5zdGFuY2UoKS51bnJlZ2lzdGVyKGpteENhY2hlQmVh\nbik7CiAgICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChFeGNlcHRpb24g\nZSkgewogICAgICAgICAgICBsb2dnZXIud2FybigiRmFpbGVkIHRvIHVucmVn\naXN0ZXIgcmVhZGFoZWFkIGNhY2hlIHdpdGggSk1YIiwgZSk7CiAgICAgICAg\nfQogICAgfQp9Cg==\n","encoding":"base64"}

