{"sha":"3c2097683f4ff6a3eb6da41dc690416f5db11139","node_id":"MDQ6QmxvYjE1NzU5NTY6M2MyMDk3NjgzZjRmZjZhM2ViNmRhNDFkYzY5MDQxNmY1ZGIxMTEzOQ==","size":28199,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/3c2097683f4ff6a3eb6da41dc690416f5db11139","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuc3Vic2NyaXB0aW9uczsK\nCmltcG9ydCBqYXZhLnV0aWwuQXJyYXlMaXN0OwppbXBvcnQgamF2YS51dGls\nLk1hcDsKaW1wb3J0IGphdmEudXRpbC5NYXAuRW50cnk7CmltcG9ydCBqYXZh\nLnV0aWwuVGltZXI7CmltcG9ydCBqYXZhLnV0aWwuVGltZXJUYXNrOwppbXBv\ncnQgamF2YS51dGlsLmNvbmN1cnJlbnQuQ29uY3VycmVudEhhc2hNYXA7Cmlt\ncG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5MaW5rZWRCbG9ja2luZ1F1ZXVl\nOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0\nb3JTZXJ2aWNlOwppbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuYXRvbWlj\nLkF0b21pY0ludGVnZXI7CgppbXBvcnQgb3JnLnNsZjRqLkxvZ2dlcjsKaW1w\nb3J0IG9yZy5zbGY0ai5Mb2dnZXJGYWN0b3J5OwoKaW1wb3J0IGNvbS5nb29n\nbGUucHJvdG9idWYuQnl0ZVN0cmluZzsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLmV4Y2VwdGlvbnMuUHViU3ViRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZVNl\ncUlkOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdDsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN1YnNjcmlwdGlvblN0\nYXRlOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3Vi\nUHJvdG9jb2wuU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaDsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvZXh0ZW5zaW9ucy5NZXNzYWdl\nSWRVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvZXh0ZW5z\naW9ucy5TdWJzY3JpcHRpb25TdGF0ZVV0aWxzOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuc2VydmVyLmNvbW1vbi5TZXJ2ZXJDb25maWd1cmF0aW9uOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLmNvbW1vbi5Ub3BpY09w\nUXVldWVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLnBlcnNp\nc3RlbmNlLlBlcnNpc3RlbmNlTWFuYWdlcjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLnNlcnZlci50b3BpY3MuVG9waWNNYW5hZ2VyOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuc2VydmVyLnRvcGljcy5Ub3BpY093bmVyc2hpcENo\nYW5nZUxpc3RlbmVyOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5D\nYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ2FsbGJh\nY2tVdGlsczsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnV0aWwuQ29uY3Vy\ncmVuY3lVdGlsczsKCnB1YmxpYyBhYnN0cmFjdCBjbGFzcyBBYnN0cmFjdFN1\nYnNjcmlwdGlvbk1hbmFnZXIgaW1wbGVtZW50cyBTdWJzY3JpcHRpb25NYW5h\nZ2VyLCBUb3BpY093bmVyc2hpcENoYW5nZUxpc3RlbmVyIHsKCiAgICBTZXJ2\nZXJDb25maWd1cmF0aW9uIGNmZzsKICAgIENvbmN1cnJlbnRIYXNoTWFwPEJ5\ndGVTdHJpbmcsIE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1YnNjcmlwdGlv\nblN0YXRlPj4gdG9wMnN1YjJzZXEgPSBuZXcgQ29uY3VycmVudEhhc2hNYXA8\nQnl0ZVN0cmluZywgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0\naW9uU3RhdGU+PigpOwogICAgc3RhdGljIExvZ2dlciBsb2dnZXIgPSBMb2dn\nZXJGYWN0b3J5LmdldExvZ2dlcihBYnN0cmFjdFN1YnNjcmlwdGlvbk1hbmFn\nZXIuY2xhc3MpOwoKICAgIFRvcGljT3BRdWV1ZXIgcXVldWVyOwogICAgcHJp\ndmF0ZSBmaW5hbCBBcnJheUxpc3Q8U3Vic2NyaXB0aW9uRXZlbnRMaXN0ZW5l\ncj4gbGlzdGVuZXJzID0gbmV3IEFycmF5TGlzdDxTdWJzY3JpcHRpb25FdmVu\ndExpc3RlbmVyPigpOwogICAgcHJpdmF0ZSBmaW5hbCBDb25jdXJyZW50SGFz\naE1hcDxCeXRlU3RyaW5nLCBBdG9taWNJbnRlZ2VyPiB0b3BpYzJMb2NhbENv\ndW50cyA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxCeXRlU3RyaW5nLCBBdG9t\naWNJbnRlZ2VyPigpOwoKICAgIC8vIEhhbmRsZSB0byB0aGUgUGVyc2lzdGVu\nY2VNYW5hZ2VyIGZvciB0aGUgc2VydmVyIHNvIHdlIGNhbiBwYXNzIGFsb25n\nIHRoZQogICAgLy8gbWVzc2FnZSBjb25zdW1lIHBvaW50ZXJzIGZvciBlYWNo\nIHRvcGljLgogICAgcHJpdmF0ZSBmaW5hbCBQZXJzaXN0ZW5jZU1hbmFnZXIg\ncG07CiAgICAvLyBUaW1lciBmb3IgcnVubmluZyBhIHJlY3VycmluZyB0aHJl\nYWQgdGFzayB0byBnZXQgdGhlIG1pbmltdW0gbWVzc2FnZQogICAgLy8gc2Vx\ndWVuY2UgSUQgZm9yIGVhY2ggdG9waWMgdGhhdCBhbGwgc3Vic2NyaWJlcnMg\nZm9yIGl0IGhhdmUgY29uc3VtZWQKICAgIC8vIGFscmVhZHkuIFdpdGggdGhh\ndCBpbmZvcm1hdGlvbiwgd2UgY2FuIGNhbGwgdGhlIFBlcnNpc3RlbmNlTWFu\nYWdlciB0bwogICAgLy8gdXBkYXRlIGl0IG9uIHRoZSBtZXNzYWdlcyB0aGF0\nIGFyZSBzYWZlIHRvIGJlIGdhcmJhZ2UgY29sbGVjdGVkLgogICAgcHJpdmF0\nZSBmaW5hbCBUaW1lciB0aW1lciA9IG5ldyBUaW1lcih0cnVlKTsKICAgIC8v\nIEluIG1lbW9yeSBtYXBwaW5nIG9mIHRvcGljcyB0byB0aGUgbWluaW11bSBj\nb25zdW1lZCBtZXNzYWdlIHNlcXVlbmNlIElECiAgICAvLyBmb3IgYWxsIHN1\nYnNjcmliZXJzIHRvIHRoZSB0b3BpYy4KICAgIHByaXZhdGUgZmluYWwgQ29u\nY3VycmVudEhhc2hNYXA8Qnl0ZVN0cmluZywgTG9uZz4gdG9waWMyTWluQ29u\nc3VtZWRNZXNzYWdlc01hcCA9IG5ldyBDb25jdXJyZW50SGFzaE1hcDxCeXRl\nU3RyaW5nLCBMb25nPigpOwoKICAgIENhbGxiYWNrPFZvaWQ+IG5vb3BDYWxs\nYmFjayA9IG5ldyBOb29wQ2FsbGJhY2s8Vm9pZD4oKTsKCiAgICBzdGF0aWMg\nY2xhc3MgTm9vcENhbGxiYWNrPFQ+IGltcGxlbWVudHMgQ2FsbGJhY2s8VD4g\newogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZhaWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0\naW9uKSB7CiAgICAgICAgICAgIGxvZ2dlci53YXJuKCJFeGNlcHRpb24gZm91\nbmQgaW4gQWJzdHJhY3RTdWJzY3JpcHRpb25NYW5hZ2VyIDogIiwgZXhjZXB0\naW9uKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkZpbmlzaGVkKE9iamVjdCBjdHgsIFQgcmVzdWx0T2ZPcGVyYXRpb24pIHsK\nICAgICAgICB9OwogICAgfQoKICAgIHB1YmxpYyBBYnN0cmFjdFN1YnNjcmlw\ndGlvbk1hbmFnZXIoU2VydmVyQ29uZmlndXJhdGlvbiBjZmcsIFRvcGljTWFu\nYWdlciB0bSwgUGVyc2lzdGVuY2VNYW5hZ2VyIHBtLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICBTY2hlZHVsZWRFeGVjdXRvclNl\ncnZpY2Ugc2NoZWR1bGVyKSB7CiAgICAgICAgdGhpcy5jZmcgPSBjZmc7CiAg\nICAgICAgcXVldWVyID0gbmV3IFRvcGljT3BRdWV1ZXIoc2NoZWR1bGVyKTsK\nICAgICAgICB0bS5hZGRUb3BpY093bmVyc2hpcENoYW5nZUxpc3RlbmVyKHRo\naXMpOwogICAgICAgIHRoaXMucG0gPSBwbTsKICAgICAgICAvLyBTY2hlZHVs\nZSB0aGUgcmVjdXJyaW5nIE1lc3NhZ2VzQ29uc3VtZWRUYXNrIG9ubHkgaWYg\nYQogICAgICAgIC8vIFBlcnNpc3RlbmNlTWFuYWdlciBpcyBwYXNzZWQuCiAg\nICAgICAgaWYgKHBtICE9IG51bGwpIHsKICAgICAgICAgICAgdGltZXIuc2No\nZWR1bGUobmV3IE1lc3NhZ2VzQ29uc3VtZWRUYXNrKCksIDAsIGNmZy5nZXRN\nZXNzYWdlc0NvbnN1bWVkVGhyZWFkUnVuSW50ZXJ2YWwoKSk7CiAgICAgICAg\nfQogICAgfQoKICAgIC8qKgogICAgICogVGhpcyBpcyB0aGUgVGltZXIgVGFz\nayBmb3IgZmluZGluZyBvdXQgZm9yIGVhY2ggdG9waWMsIHdoYXQgdGhlIG1p\nbmltdW0KICAgICAqIGNvbnN1bWVkIG1lc3NhZ2UgYnkgdGhlIHN1YnNjcmli\nZXJzIGFyZS4gVGhpcyBpbmZvcm1hdGlvbiBpcyB1c2VkIHRvIHBhc3MKICAg\nICAqIGFsb25nIHRvIHRoZSBzZXJ2ZXIncyBQZXJzaXN0ZW5jZU1hbmFnZXIg\nc28gaXQgY2FuIGdhcmJhZ2UgY29sbGVjdCBvbGRlcgogICAgICogdG9waWMg\nbWVzc2FnZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIG5lZWRlZCBieSB0aGUgc3Vi\nc2NyaWJlcnMuCiAgICAgKi8KICAgIGNsYXNzIE1lc3NhZ2VzQ29uc3VtZWRU\nYXNrIGV4dGVuZHMgVGltZXJUYXNrIHsKICAgICAgICAvKioKICAgICAgICAg\nKiBJbXBsZW1lbnQgdGhlIFRpbWVyVGFzaydzIGFic3RyYWN0IHJ1biBtZXRo\nb2QuCiAgICAgICAgICovCiAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgcHVi\nbGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAvLyBXZSBhcmUgbG9vcGlu\nZyB0aHJvdWdoIHJlbGF0aXZlbHkgc21hbGwgaW4gbWVtb3J5IGRhdGEgc3Ry\ndWN0dXJlcwogICAgICAgICAgICAvLyBzbyBpdCBzaG91bGQgYmUgc2FmZSB0\nbyBydW4gdGhpcyBmYWlybHkgb2Z0ZW4uCiAgICAgICAgICAgIGZvciAoQnl0\nZVN0cmluZyB0b3BpYyA6IHRvcDJzdWIyc2VxLmtleVNldCgpKSB7CiAgICAg\nICAgICAgICAgICBmaW5hbCBNYXA8Qnl0ZVN0cmluZywgSW5NZW1vcnlTdWJz\nY3JpcHRpb25TdGF0ZT4gdG9waWNTdWJzY3JpcHRpb25zID0gdG9wMnN1YjJz\nZXEuZ2V0KHRvcGljKTsKICAgICAgICAgICAgICAgIGlmICh0b3BpY1N1YnNj\ncmlwdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGNvbnRp\nbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGxvbmcg\nbWluQ29uc3VtZWRNZXNzYWdlID0gTG9uZy5NQVhfVkFMVUU7CiAgICAgICAg\nICAgICAgICBib29sZWFuIGhhc0JvdW5kID0gdHJ1ZTsKICAgICAgICAgICAg\nICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgc3Vic2NyaWJlcnMgdG8gdGhlIGN1\ncnJlbnQgdG9waWMgdG8gZmluZCB0aGUKICAgICAgICAgICAgICAgIC8vIG1p\nbmltdW0gY29uc3VtZWQgbWVzc2FnZSBpZC4gVGhlIGNvbnN1bWUgcG9pbnRl\ncnMgYXJlCiAgICAgICAgICAgICAgICAvLyBwZXJzaXN0ZWQgbGF6aWx5IHNv\nIHdlJ2xsIHVzZSB0aGUgc3RhbGUgaW4tbWVtb3J5IHZhbHVlCiAgICAgICAg\nICAgICAgICAvLyBpbnN0ZWFkLiBUaGlzIGtlZXBzIHRoaW5ncyBjb25zaXN0\nZW50IGluIGNhc2Ugb2YgYSBzZXJ2ZXIKICAgICAgICAgICAgICAgIC8vIGNy\nYXNoLgogICAgICAgICAgICAgICAgZm9yIChJbk1lbW9yeVN1YnNjcmlwdGlv\nblN0YXRlIGN1clN1YnNjcmlwdGlvbiA6IHRvcGljU3Vic2NyaXB0aW9ucy52\nYWx1ZXMoKSkgewogICAgICAgICAgICAgICAgICAgIGlmIChjdXJTdWJzY3Jp\ncHRpb24uZ2V0U3Vic2NyaXB0aW9uU3RhdGUoKS5nZXRNc2dJZCgpLmdldExv\nY2FsQ29tcG9uZW50KCkgPCBtaW5Db25zdW1lZE1lc3NhZ2UpCiAgICAgICAg\nICAgICAgICAgICAgICAgIG1pbkNvbnN1bWVkTWVzc2FnZSA9IGN1clN1YnNj\ncmlwdGlvbi5nZXRTdWJzY3JpcHRpb25TdGF0ZSgpLmdldE1zZ0lkKCkuZ2V0\nTG9jYWxDb21wb25lbnQoKTsKICAgICAgICAgICAgICAgICAgICBoYXNCb3Vu\nZCA9IGhhc0JvdW5kICYmIGN1clN1YnNjcmlwdGlvbi5nZXRTdWJzY3JpcHRp\nb25TdGF0ZSgpLmhhc01lc3NhZ2VCb3VuZCgpOwogICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgYm9vbGVhbiBjYWxsUGVyc2lzdGVuY2VNYW5h\nZ2VyID0gdHJ1ZTsKICAgICAgICAgICAgICAgIC8vIERvbid0IGNhbGwgdGhl\nIFBlcnNpc3RlbmNlTWFuYWdlciBpZiBub2JvZHkgaXMgc3Vic2NyaWJlZCB0\nbwogICAgICAgICAgICAgICAgLy8gdGhlIHRvcGljIHlldCwgb3IgdGhlIGNv\nbnN1bWUgcG9pbnRlciBoYXMgbm90IGNoYW5nZWQgc2luY2UKICAgICAgICAg\nICAgICAgIC8vIHRoZSBsYXN0IHRpbWUsIG9yIGlmIHRoaXMgaXMgdGhlIGlu\naXRpYWwgc3Vic2NyaXB0aW9uLgogICAgICAgICAgICAgICAgTG9uZyBtaW5D\nb25zdW1lZEZyb21NYXAgPSB0b3BpYzJNaW5Db25zdW1lZE1lc3NhZ2VzTWFw\nLmdldCh0b3BpYyk7CiAgICAgICAgICAgICAgICBpZiAodG9waWNTdWJzY3Jp\ncHRpb25zLmlzRW1wdHkoKQogICAgICAgICAgICAgICAgICAgIHx8IChtaW5D\nb25zdW1lZEZyb21NYXAgIT0gbnVsbCAmJiBtaW5Db25zdW1lZEZyb21NYXAu\nZXF1YWxzKG1pbkNvbnN1bWVkTWVzc2FnZSkpCiAgICAgICAgICAgICAgICAg\nICAgfHwgbWluQ29uc3VtZWRNZXNzYWdlID09IDApIHsKICAgICAgICAgICAg\nICAgICAgICB0b3BpYzJNaW5Db25zdW1lZE1lc3NhZ2VzTWFwLnB1dCh0b3Bp\nYywgbWluQ29uc3VtZWRNZXNzYWdlKTsKICAgICAgICAgICAgICAgICAgICBw\nbS5jb25zdW1lZFVudGlsKHRvcGljLCBtaW5Db25zdW1lZE1lc3NhZ2UpOwog\nICAgICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNCb3VuZCkgewogICAgICAg\nICAgICAgICAgICAgIHBtLmNvbnN1bWVUb0JvdW5kKHRvcGljKTsKICAgICAg\nICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICBwcml2YXRlIGNsYXNzIEFjcXVpcmVPcCBleHRlbmRzIFRvcGljT3BRdWV1\nZXIuQXN5bmNocm9ub3VzT3A8Vm9pZD4gewogICAgICAgIHB1YmxpYyBBY3F1\naXJlT3AoQnl0ZVN0cmluZyB0b3BpYywgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJh\nY2ssIE9iamVjdCBjdHgpIHsKICAgICAgICAgICAgcXVldWVyLnN1cGVyKHRv\ncGljLCBjYWxsYmFjaywgY3R4KTsKICAgICAgICB9CgogICAgICAgIEBPdmVy\ncmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAg\naWYgKHRvcDJzdWIyc2VxLmNvbnRhaW5zS2V5KHRvcGljKSkgewogICAgICAg\nICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgcmVhZFN1YnNjcmlwdGlvbnModG9w\naWMsIG5ldyBDYWxsYmFjazxNYXA8Qnl0ZVN0cmluZywgSW5NZW1vcnlTdWJz\nY3JpcHRpb25TdGF0ZT4+KCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQo\nT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAg\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIGV4Y2Vw\ndGlvbik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25G\naW5pc2hlZChmaW5hbCBPYmplY3QgY3R4LAogICAgICAgICAgICAgICAgZmlu\nYWwgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+\nIHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgLy8g\nV2UndmUganVzdCBpbmhlcml0ZWQgYSBidW5jaCBvZiBzdWJzY3JpYmVyIGZv\nciB0aGlzCiAgICAgICAgICAgICAgICAgICAgLy8gdG9waWMsIHNvbWUgb2Yg\nd2hpY2ggbWF5IGJlIGxvY2FsLiBJZiB0aGV5IGFyZSwgdGhlbiB3ZQogICAg\nICAgICAgICAgICAgICAgIC8vIG5lZWQgdG8gKDEpIG5vdGlmeSBsaXN0ZW5l\ncnMgb2YgdGhpcyBhbmQgKDIpIHJlY29yZCB0aGUKICAgICAgICAgICAgICAg\nICAgICAvLyBudW1iZXIgZm9yIGJvb2trZWVwaW5nIHNvIHRoYXQgZnV0dXJl\nCiAgICAgICAgICAgICAgICAgICAgLy8gc3Vic2NyaWJlcy91bnN1YnNjcmli\nZXMgY2FuIGVmZmljaWVudGx5IG5vdGlmeSBsaXN0ZW5lcnMuCgogICAgICAg\nICAgICAgICAgICAgIC8vIENvdW50IHRoZSBudW1iZXIgb2YgbG9jYWwgc3Vi\nc2NyaWJlcnMgd2UganVzdCBpbmhlcml0ZWQuCiAgICAgICAgICAgICAgICAg\nICAgLy8gVGhpcyBsb29wIGlzIE9LIHNpbmNlIHRoZSBudW1iZXIgb2Ygc3Vi\nc2NyaWJlcnMgcGVyIHRvcGljCiAgICAgICAgICAgICAgICAgICAgLy8gaXMg\nZXhwZWN0ZWQgdG8gYmUgc21hbGwuCiAgICAgICAgICAgICAgICAgICAgaW50\nIGxvY2FsQ291bnQgPSAwOwogICAgICAgICAgICAgICAgICAgIGZvciAoQnl0\nZVN0cmluZyBzdWJzY3JpYmVySWQgOiByZXN1bHRPZk9wZXJhdGlvbi5rZXlT\nZXQoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFTdWJzY3JpcHRp\nb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJzY3JpYmVySWQpKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxDb3VudCsrOwogICAg\nICAgICAgICAgICAgICAgIHRvcGljMkxvY2FsQ291bnRzLnB1dCh0b3BpYywg\nbmV3IEF0b21pY0ludGVnZXIobG9jYWxDb3VudCkpOwoKICAgICAgICAgICAg\nICAgICAgICAvLyBUaGUgZmluYWwgImNvbW1pdCIgKGFuZCAiYWJvcnQiKSBv\ncGVyYXRpb25zLgogICAgICAgICAgICAgICAgICAgIGZpbmFsIENhbGxiYWNr\nPFZvaWQ+IGNiMiA9IG5ldyBDYWxsYmFjazxWb2lkPigpIHsKCiAgICAgICAg\nICAgICAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAg\nICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQoT2JqZWN0IGN0eCwg\nUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJTdWJzY3JpcHRpb24gbWFuYWdl\nciBmYWlsZWQgdG8gYWNxdWlyZWQgdG9waWMgIiArIHRvcGljLnRvU3RyaW5n\nVXRmOCgpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBj\nYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAg\nICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgQE92ZXJyaWRl\nCiAgICAgICAgICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlv\nbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQgdm9pZE9iaikgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdG9wMnN1YjJzZXEucHV0KHRvcGljLCBy\nZXN1bHRPZk9wZXJhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuaW5mbygiU3Vic2NyaXB0aW9uIG1hbmFnZXIgc3VjY2Vzc2Z1\nbGx5IGFjcXVpcmVkIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkp\nOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmlu\naXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoK\nICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAv\nLyBOb3RpZnkgbGlzdGVuZXJzIGlmIG5lY2Vzc2FyeS4KICAgICAgICAgICAg\nICAgICAgICBpZiAobG9jYWxDb3VudCA+IDApIHsKICAgICAgICAgICAgICAg\nICAgICAgICAgbm90aWZ5U3Vic2NyaWJlKHRvcGljLCBmYWxzZSwgY2IyLCBj\ndHgpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIGNiMi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwp\nOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAg\ndXBkYXRlTWVzc2FnZUJvdW5kKHRvcGljKTsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgIH0sIGN0eCk7CgogICAgICAgIH0KCiAgICB9CgogICAg\ncHJpdmF0ZSB2b2lkIG5vdGlmeVN1YnNjcmliZShCeXRlU3RyaW5nIHRvcGlj\nLCBib29sZWFuIHN5bmNocm9ub3VzLCBmaW5hbCBDYWxsYmFjazxWb2lkPiBj\nYiwgZmluYWwgT2JqZWN0IGN0eCkgewogICAgICAgIENhbGxiYWNrPFZvaWQ+\nIG1jYiA9IENhbGxiYWNrVXRpbHMubXVsdGlDYWxsYmFjayhsaXN0ZW5lcnMu\nc2l6ZSgpLCBjYiwgY3R4KTsKICAgICAgICBmb3IgKFN1YnNjcmlwdGlvbkV2\nZW50TGlzdGVuZXIgbGlzdGVuZXIgOiBsaXN0ZW5lcnMpIHsKICAgICAgICAg\nICAgbGlzdGVuZXIub25GaXJzdExvY2FsU3Vic2NyaWJlKHRvcGljLCBzeW5j\naHJvbm91cywgbWNiKTsKICAgICAgICB9CiAgICB9CgogICAgLyoqCiAgICAg\nKiBGaWd1cmUgb3V0IHdobyBpcyBzdWJzY3JpYmVkLiBEbyBub3RoaW5nIGlm\nIGFscmVhZHkgYWNxdWlyZWQuIElmIHRoZXJlJ3MKICAgICAqIGFuIGVycm9y\nIHJlYWRpbmcgdGhlIHN1YnNjcmliZXJzJyBzZXF1ZW5jZSBJRHMsIHRoZW4g\ndGhlIHRvcGljIGlzIG5vdAogICAgICogYWNxdWlyZWQuCiAgICAgKgogICAg\nICogQHBhcmFtIHRvcGljCiAgICAgKiBAcGFyYW0gY2FsbGJhY2sKICAgICAq\nIEBwYXJhbSBjdHgKICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCBhY3F1aXJlZFRvcGljKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsIGZp\nbmFsIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNrLCBPYmplY3QgY3R4KSB7CiAg\nICAgICAgcXVldWVyLnB1c2hBbmRNYXliZVJ1bih0b3BpYywgbmV3IEFjcXVp\ncmVPcCh0b3BpYywgY2FsbGJhY2ssIGN0eCkpOwogICAgfQoKICAgIGNsYXNz\nIFJlbGVhc2VPcCBleHRlbmRzIFRvcGljT3BRdWV1ZXIuQXN5bmNocm9ub3Vz\nT3A8Vm9pZD4gewoKICAgICAgICBwdWJsaWMgUmVsZWFzZU9wKGZpbmFsIEJ5\ndGVTdHJpbmcgdG9waWMsIGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNiLCBPYmpl\nY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0b3BpYywgY2Is\nIGN0eCk7CiAgICAgICAgfQoKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBw\ndWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgIENhbGxiYWNrPFZvaWQ+\nIGZpbmFsQ2IgPSBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9w\nZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVy\nYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICBmaW5pc2goKTsKICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3Qg\nY3R4LAogICAgICAgICAgICAgICAgICAgICAgICBQdWJTdWJFeGNlcHRpb24g\nZXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4o\nIkVycm9yIHdoZW4gcmVsZWFzaW5nIHRvcGljIDogIiArIHRvcGljLnRvU3Ry\naW5nVXRmOCgpLCBleGNlcHRpb24pOwogICAgICAgICAgICAgICAgICAgIGZp\nbmlzaCgpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHBy\naXZhdGUgdm9pZCBmaW5pc2goKSB7CiAgICAgICAgICAgICAgICAgICAgdG9w\naWMyTG9jYWxDb3VudHMucmVtb3ZlKHRvcGljKTsKICAgICAgICAgICAgICAg\nICAgICAvLyBTaW5jZSB3ZSBkZWNyZW1lbnQgbG9jYWwgY291bnQgd2hlbiBz\nb21lIG9mIHJlbW90ZSBzdWJzY3JpcHRpb25zIGZhaWxlZCwKICAgICAgICAg\nICAgICAgICAgICAvLyB3aGlsZSB3ZSBkb24ndCB1bnN1YnNjcmliZSB0aG9z\nZSBzdWNjZWVkIHN1YnNjcmlwdGlvbnMuIHNvIHdlIGNhbid0IGRlcGVuZHMK\nICAgICAgICAgICAgICAgICAgICAvLyBvbiBsb2NhbCBjb3VudCwganVzdCB0\ncnkgdG8gbm90aWZ5IHVuc3Vic2NyaWJlLgogICAgICAgICAgICAgICAgICAg\nIG5vdGlmeVVuc3ViY3JpYmUodG9waWMpOwogICAgICAgICAgICAgICAgICAg\nIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAg\nICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmIChsb2dnZXIu\naXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgbG9nZ2VyLmRl\nYnVnKCJUcnkgdG8gdXBkYXRlIHN1YnNjcmlwdGlvbiBzdGF0ZXMgd2hlbiBs\nb3NpbmcgdG9waWMgIiArIHRvcGljLnRvU3RyaW5nVXRmOCgpKTsKICAgICAg\nICAgICAgfQogICAgICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb25TdGF0ZXMo\ndG9waWMsIGZpbmFsQ2IsIGN0eCwgdHJ1ZSk7CiAgICAgICAgfQogICAgfQoK\nICAgIHZvaWQgdXBkYXRlU3Vic2NyaXB0aW9uU3RhdGVzKEJ5dGVTdHJpbmcg\ndG9waWMsIENhbGxiYWNrPFZvaWQ+IGZpbmFsQ2IsIE9iamVjdCBjdHgsIGJv\nb2xlYW4gcmVtb3ZlVG9waWMpIHsKICAgICAgICAvLyBUcnkgdG8gdXBkYXRl\nIHN1YnNjcmlwdGlvbiBzdGF0ZXMgb2YgYSBzcGVjaWZpZWQgdG9waWMKICAg\nICAgICBNYXA8Qnl0ZVN0cmluZywgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0\nZT4gc3RhdGVzOwogICAgICAgIGlmIChyZW1vdmVUb3BpYykgewogICAgICAg\nICAgICBzdGF0ZXMgPSB0b3Ayc3ViMnNlcS5yZW1vdmUodG9waWMpOwogICAg\nICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN0YXRlcyA9IHRvcDJzdWIyc2Vx\nLmdldCh0b3BpYyk7CiAgICAgICAgfQogICAgICAgIGlmIChudWxsID09IHN0\nYXRlcykgewogICAgICAgICAgICBmaW5hbENiLm9wZXJhdGlvbkZpbmlzaGVk\nKGN0eCwgbnVsbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgQ2Fs\nbGJhY2s8Vm9pZD4gbWNiID0gQ2FsbGJhY2tVdGlscy5tdWx0aUNhbGxiYWNr\nKHN0YXRlcy5zaXplKCksIGZpbmFsQ2IsIGN0eCk7CiAgICAgICAgICAgIGZv\nciAoRW50cnk8Qnl0ZVN0cmluZywgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0\nZT4gZW50cnkgOiBzdGF0ZXMuZW50cnlTZXQoKSkgewogICAgICAgICAgICAg\nICAgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSBtZW1TdGF0ZSA9IGVudHJ5\nLmdldFZhbHVlKCk7CiAgICAgICAgICAgICAgICBpZiAobWVtU3RhdGUuc2V0\nTGFzdENvbnN1bWVTZXFJZEltbWVkaWF0ZWx5KCkpIHsKICAgICAgICAgICAg\nICAgICAgICB1cGRhdGVTdWJzY3JpcHRpb25TdGF0ZSh0b3BpYywgZW50cnku\nZ2V0S2V5KCksIG1lbVN0YXRlLmdldFN1YnNjcmlwdGlvblN0YXRlKCksCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWNi\nLCBjdHgpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAg\nICAgICAgICBtY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAg\nICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0K\nCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgbG9jYWwgbWFwcGluZy4KICAg\nICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBsb3N0VG9waWMo\nQnl0ZVN0cmluZyB0b3BpYykgewogICAgICAgIHF1ZXVlci5wdXNoQW5kTWF5\nYmVSdW4odG9waWMsIG5ldyBSZWxlYXNlT3AodG9waWMsIG5vb3BDYWxsYmFj\naywgbnVsbCkpOwogICAgfQoKICAgIHByaXZhdGUgdm9pZCBub3RpZnlVbnN1\nYmNyaWJlKEJ5dGVTdHJpbmcgdG9waWMpIHsKICAgICAgICBmb3IgKFN1YnNj\ncmlwdGlvbkV2ZW50TGlzdGVuZXIgbGlzdGVuZXIgOiBsaXN0ZW5lcnMpCiAg\nICAgICAgICAgIGxpc3RlbmVyLm9uTGFzdExvY2FsVW5zdWJzY3JpYmUodG9w\naWMpOwogICAgfQoKICAgIHByb3RlY3RlZCBhYnN0cmFjdCB2b2lkIHJlYWRT\ndWJzY3JpcHRpb25zKGZpbmFsIEJ5dGVTdHJpbmcgdG9waWMsCiAgICAgICAg\nICAgIGZpbmFsIENhbGxiYWNrPE1hcDxCeXRlU3RyaW5nLCBJbk1lbW9yeVN1\nYnNjcmlwdGlvblN0YXRlPj4gY2IsIGZpbmFsIE9iamVjdCBjdHgpOwoKICAg\nIHByaXZhdGUgY2xhc3MgU3Vic2NyaWJlT3AgZXh0ZW5kcyBUb3BpY09wUXVl\ndWVyLkFzeW5jaHJvbm91c09wPE1lc3NhZ2VTZXFJZD4gewogICAgICAgIFN1\nYnNjcmliZVJlcXVlc3Qgc3ViUmVxdWVzdDsKICAgICAgICBNZXNzYWdlU2Vx\nSWQgY29uc3VtZVNlcUlkOwoKICAgICAgICBwdWJsaWMgU3Vic2NyaWJlT3Ao\nQnl0ZVN0cmluZyB0b3BpYywgU3Vic2NyaWJlUmVxdWVzdCBzdWJSZXF1ZXN0\nLCBNZXNzYWdlU2VxSWQgY29uc3VtZVNlcUlkLAogICAgICAgICAgICAgICAg\nICAgICAgICAgICBDYWxsYmFjazxNZXNzYWdlU2VxSWQ+IGNhbGxiYWNrLCBP\nYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0b3BpYywg\nY2FsbGJhY2ssIGN0eCk7CiAgICAgICAgICAgIHRoaXMuc3ViUmVxdWVzdCA9\nIHN1YlJlcXVlc3Q7CiAgICAgICAgICAgIHRoaXMuY29uc3VtZVNlcUlkID0g\nY29uc3VtZVNlcUlkOwogICAgICAgIH0KCiAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgcHVibGljIHZvaWQgcnVuKCkgewoKICAgICAgICAgICAgZmluYWwg\nTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHRv\ncGljU3Vic2NyaXB0aW9ucyA9IHRvcDJzdWIyc2VxLmdldCh0b3BpYyk7CiAg\nICAgICAgICAgIGlmICh0b3BpY1N1YnNjcmlwdGlvbnMgPT0gbnVsbCkgewog\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1\nYlN1YkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZvclRvcGljRXhj\nZXB0aW9uKCIiKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgIH0KCiAgICAgICAgICAgIGZpbmFsIEJ5dGVTdHJpbmcgc3Vic2NyaWJl\ncklkID0gc3ViUmVxdWVzdC5nZXRTdWJzY3JpYmVySWQoKTsKICAgICAgICAg\nICAgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZSBzdWJzY3JpcHRpb25TdGF0\nZSA9IHRvcGljU3Vic2NyaXB0aW9ucy5nZXQoc3Vic2NyaWJlcklkKTsKICAg\nICAgICAgICAgQ3JlYXRlT3JBdHRhY2ggY3JlYXRlT3JBdHRhY2ggPSBzdWJS\nZXF1ZXN0LmdldENyZWF0ZU9yQXR0YWNoKCk7CgogICAgICAgICAgICBpZiAo\nc3Vic2NyaXB0aW9uU3RhdGUgIT0gbnVsbCkgewoKICAgICAgICAgICAgICAg\nIGlmIChjcmVhdGVPckF0dGFjaC5lcXVhbHMoQ3JlYXRlT3JBdHRhY2guQ1JF\nQVRFKSkgewogICAgICAgICAgICAgICAgICAgIFN0cmluZyBtc2cgPSAiVG9w\naWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIgc3Vic2NyaWJlcklk\nOiAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpCiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICsgIiByZXF1ZXN0ZWQgY3JlYXRpbmcg\nYSBzdWJzY3JpcHRpb24gYnV0IGl0IGlzIGFscmVhZHkgc3Vic2NyaWJlZCB3\naXRoIHN0YXRlOiAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgU3Vic2NyaXB0aW9uU3RhdGVVdGlscy50b1N0cmluZyhzdWJzY3JpcHRp\nb25TdGF0ZS5nZXRTdWJzY3JpcHRpb25TdGF0ZSgpKTsKICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIuZGVidWcobXNnKTsKICAgICAgICAgICAgICAgICAg\nICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9u\nLkNsaWVudEFscmVhZHlTdWJzY3JpYmVkRXhjZXB0aW9uKG1zZykpOwogICAg\nICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgICAgICAvLyBvdGhlcndpc2UganVzdCBhdHRhY2gKICAgICAg\nICAgICAgICAgIGlmIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAg\nICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiVG9waWM6ICIgKyB0b3Bp\nYy50b1N0cmluZ1V0ZjgoKSArICIgc3Vic2NyaWJlcklkOiAiICsgc3Vic2Ny\naWJlcklkLnRvU3RyaW5nVXRmOCgpCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgIiBhdHRhY2hpbmcgdG8gc3Vic2NyaXB0aW9uIHdpdGgg\nc3RhdGU6ICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyBT\ndWJzY3JpcHRpb25TdGF0ZVV0aWxzLnRvU3RyaW5nKHN1YnNjcmlwdGlvblN0\nYXRlLmdldFN1YnNjcmlwdGlvblN0YXRlKCkpKTsKICAgICAgICAgICAgICAg\nIH0KCiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgs\nIHN1YnNjcmlwdGlvblN0YXRlLmdldExhc3RDb25zdW1lU2VxSWQoKSk7CiAg\nICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAg\nICAgIC8vIHdlIGRvbid0IGhhdmUgYSBtYXBwaW5nIGZvciB0aGlzIHN1YnNj\ncmliZXIKICAgICAgICAgICAgaWYgKGNyZWF0ZU9yQXR0YWNoLmVxdWFscyhD\ncmVhdGVPckF0dGFjaC5BVFRBQ0gpKSB7CiAgICAgICAgICAgICAgICBTdHJp\nbmcgbXNnID0gIlRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCkgKyAi\nIHN1YnNjcmliZXJJZDogIiArIHN1YnNjcmliZXJJZC50b1N0cmluZ1V0Zjgo\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgIiByZXF1ZXN0ZWQg\nYXR0YWNoaW5nIHRvIGFuIGV4aXN0aW5nIHN1YnNjcmlwdGlvbiBidXQgaXQg\naXMgbm90IHN1YnNjcmliZWQiOwogICAgICAgICAgICAgICAgbG9nZ2VyLmRl\nYnVnKG1zZyk7CiAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQo\nY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLkNsaWVudE5vdFN1YnNjcmliZWRF\neGNlcHRpb24obXNnKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgIC8vIG5vdyB0aGUgaGFyZCBjYXNlLCB0\naGlzIGlzIGEgYnJhbmQgbmV3IHN1YnNjcmlwdGlvbiwgbXVzdCByZWNvcmQK\nICAgICAgICAgICAgU3Vic2NyaXB0aW9uU3RhdGUuQnVpbGRlciBzdGF0ZUJ1\naWxkZXIgPSBTdWJzY3JpcHRpb25TdGF0ZS5uZXdCdWlsZGVyKCkuc2V0TXNn\nSWQoY29uc3VtZVNlcUlkKTsKICAgICAgICAgICAgaWYgKHN1YlJlcXVlc3Qu\naGFzTWVzc2FnZUJvdW5kKCkpIHsKICAgICAgICAgICAgICAgIHN0YXRlQnVp\nbGRlciA9IHN0YXRlQnVpbGRlci5zZXRNZXNzYWdlQm91bmQoc3ViUmVxdWVz\ndC5nZXRNZXNzYWdlQm91bmQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAg\nICAgZmluYWwgU3Vic2NyaXB0aW9uU3RhdGUgbmV3U3RhdGUgPSBzdGF0ZUJ1\naWxkZXIuYnVpbGQoKTsKCiAgICAgICAgICAgIGNyZWF0ZVN1YnNjcmlwdGlv\nblN0YXRlKHRvcGljLCBzdWJzY3JpYmVySWQsIG5ld1N0YXRlLCBuZXcgQ2Fs\nbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAg\nICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZhaWxlZChPYmpl\nY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAg\nICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgZXhjZXB0aW9u\nKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBAT3ZlcnJp\nZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlz\naGVkKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAg\nICAgICAgICAgICAgICAgICBDYWxsYmFjazxWb2lkPiBjYjIgPSBuZXcgQ2Fs\nbGJhY2s8Vm9pZD4oKSB7CgogICAgICAgICAgICAgICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3Bl\ncmF0aW9uRmFpbGVkKGZpbmFsIE9iamVjdCBjdHgsIGZpbmFsIFB1YlN1YkV4\nY2VwdGlvbiBleGNlcHRpb24pIHsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIGxvZ2dlci5lcnJvcigic3Vic2NyaXB0aW9uIGZvciBzdWJzY3JpYmVy\nICIgKyBzdWJzY3JpYmVySWQudG9TdHJpbmdVdGY4KCkgKyAiIHRvIHRvcGlj\nICIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAr\nIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiBmYWlsZWQgZHVlIHRvIGZhaWxl\nZCBsaXN0ZW5lciBjYWxsYmFjayIsIGV4Y2VwdGlvbik7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAvLyBzaG91bGQgcmVtb3ZlIHN1YnNjcmlwdGlv\nbiB3aGVuIHN5bmNocm9uaXplZCBjcm9zcy1yZWdpb24gc3Vic2NyaXB0aW9u\nIGZhaWxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlU3Vi\nc2NyaXB0aW9uU3RhdGUodG9waWMsIHN1YnNjcmliZXJJZCwgbmV3IENhbGxi\nYWNrPFZvaWQ+KCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIEBPdmVycmlkZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjb250ZXh0LAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVm9pZCBy\nZXN1bHRPZk9wZXJhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBmaW5pc2goKTsKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVibGlj\nIHZvaWQgb3BlcmF0aW9uRmFpbGVkKE9iamVjdCBjb250ZXh0LAogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUHViU3ViRXhjZXB0\naW9uIGV4KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZ2dlci5lcnJvcigiUmVtb3ZlIHN1YnNjcmlwdGlvbiBmb3Igc3Vic2Ny\naWJlciAiICsgc3Vic2NyaWJlcklkLnRvU3RyaW5nVXRmOCgpICsgIiB0byB0\nb3BpYyAiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICArIHRvcGljLnRvU3RyaW5nVXRmOCgpICsgIiBmYWlsZWQg\nOiAiLCBleCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIGZpbmlzaCgpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0K\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcml2YXRlIHZvaWQg\nZmluaXNoKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAvLyB3ZSBzaG91bGQgZGVjcmVtZW50IGxvY2FsIGNvdW50IHdoZW4gcmVt\nb3RlIHN1YnNjcmlwdGlvbiBmYWlsZWQKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKCFTdWJzY3JpcHRpb25TdGF0ZVV0aWxzLmlz\nSHViU3Vic2NyaWJlcihzdWJSZXF1ZXN0LmdldFN1YnNjcmliZXJJZCgpKSkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g\nc2luY2UgdGhlIHN1YnNjcmliZSBvcCBpcyBleGVjdXRlZCBvbmUgYnkgb25l\nIGluIHF1ZXVlIG9yZGVyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgLy8gc28gdGhlIGZvbGxvd2luZyBjb2RlcyBvbmx5IGhh\ncHBlbmVkIHdoZW4gcmVtb3RlIHN1YnNjcmlwdGlvbiBmYWlsZWQuCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpdCBpcyBz\nYWZlIHRvIGRlY3JlbWVudCB0aGUgbG9jYWwgY291bnQgc28gbmV4dCBzdWJz\nY3JpYmUgb3AKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIC8vIGNvdWxkIGhhdmUgdGhlIGNoYW5jZSB0byBzdWJzY3JpYmUgcmVt\nb3RlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nQXRvbWljSW50ZWdlciBjb3VudCA9IHRvcGljMkxvY2FsQ291bnRzLmdldCh0\nb3BpYyk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBpZiAoY291bnQgIT0gbnVsbCkgeyBjb3VudC5kZWNyZW1lbnRBbmRHZXQo\nKTsgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlv\nbkZhaWxlZChjdHgsIGV4Y2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwg\nY3R4KTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAg\nICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgICAg\nIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZv\naWQgcmVzdWx0T2ZPcGVyYXRpb24pIHsKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIHRvcGljU3Vic2NyaXB0aW9ucy5wdXQoc3Vic2NyaWJlcklkLCBu\nZXcgSW5NZW1vcnlTdWJzY3JpcHRpb25TdGF0ZShuZXdTdGF0ZSkpOwoKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZU1lc3NhZ2VCb3VuZCh0\nb3BpYyk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0\naW9uRmluaXNoZWQoY3R4LCBjb25zdW1lU2VxSWQpOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIH07CgogICAgICAg\nICAgICAgICAgICAgIEF0b21pY0ludGVnZXIgY291bnQgPSB0b3BpYzJMb2Nh\nbENvdW50cy5nZXQodG9waWMpOwogICAgICAgICAgICAgICAgICAgIGlmICgh\nU3Vic2NyaXB0aW9uU3RhdGVVdGlscy5pc0h1YlN1YnNjcmliZXIoc3ViUmVx\ndWVzdC5nZXRTdWJzY3JpYmVySWQoKSkKICAgICAgICAgICAgICAgICAgICAg\nICAgJiYgY291bnQgIT0gbnVsbAogICAgICAgICAgICAgICAgICAgICAgICAm\nJiBjb3VudC5pbmNyZW1lbnRBbmRHZXQoKSA9PSAxKQogICAgICAgICAgICAg\nICAgICAgICAgICBub3RpZnlTdWJzY3JpYmUodG9waWMsIHN1YlJlcXVlc3Qu\nZ2V0U3luY2hyb25vdXMoKSwgY2IyLCBjdHgpOwogICAgICAgICAgICAgICAg\nICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgY2IyLm9wZXJhdGlv\nbkZpbmlzaGVkKGN0eCwgcmVzdWx0T2ZPcGVyYXRpb24pOwogICAgICAgICAg\nICAgICAgfQogICAgICAgICAgICB9LCBjdHgpOwogICAgICAgIH0KICAgIH0K\nCiAgICBwdWJsaWMgdm9pZCB1cGRhdGVNZXNzYWdlQm91bmQoQnl0ZVN0cmlu\nZyB0b3BpYykgewogICAgICAgIGZpbmFsIE1hcDxCeXRlU3RyaW5nLCBJbk1l\nbW9yeVN1YnNjcmlwdGlvblN0YXRlPiB0b3BpY1N1YnNjcmlwdGlvbnMgPSB0\nb3Ayc3ViMnNlcS5nZXQodG9waWMpOwogICAgICAgIGlmICh0b3BpY1N1YnNj\ncmlwdGlvbnMgPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm47CiAgICAg\nICAgfQogICAgICAgIGludCBtYXhCb3VuZCA9IEludGVnZXIuTUlOX1ZBTFVF\nOwogICAgICAgIGZvciAoTWFwLkVudHJ5PEJ5dGVTdHJpbmcsIEluTWVtb3J5\nU3Vic2NyaXB0aW9uU3RhdGU+IGUgOiB0b3BpY1N1YnNjcmlwdGlvbnMuZW50\ncnlTZXQoKSkgewogICAgICAgICAgICBpZiAoIWUuZ2V0VmFsdWUoKS5nZXRT\ndWJzY3JpcHRpb25TdGF0ZSgpLmhhc01lc3NhZ2VCb3VuZCgpKSB7CiAgICAg\nICAgICAgICAgICBtYXhCb3VuZCA9IEludGVnZXIuTUlOX1ZBTFVFOwogICAg\nICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAg\nICAgICAgICAgICBtYXhCb3VuZCA9IE1hdGgubWF4KG1heEJvdW5kLCBlLmdl\ndFZhbHVlKCkuZ2V0U3Vic2NyaXB0aW9uU3RhdGUoKS5nZXRNZXNzYWdlQm91\nbmQoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKG1h\neEJvdW5kID09IEludGVnZXIuTUlOX1ZBTFVFKSB7CiAgICAgICAgICAgIHBt\nLmNsZWFyTWVzc2FnZUJvdW5kKHRvcGljKTsKICAgICAgICB9IGVsc2Ugewog\nICAgICAgICAgICBwbS5zZXRNZXNzYWdlQm91bmQodG9waWMsIG1heEJvdW5k\nKTsKICAgICAgICB9CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCBzZXJ2ZVN1YnNjcmliZVJlcXVlc3QoQnl0ZVN0cmluZyB0b3BpYywg\nU3Vic2NyaWJlUmVxdWVzdCBzdWJSZXF1ZXN0LCBNZXNzYWdlU2VxSWQgY29u\nc3VtZVNlcUlkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIENhbGxiYWNrPE1lc3NhZ2VTZXFJZD4gY2FsbGJhY2ssIE9iamVjdCBj\ndHgpIHsKICAgICAgICBxdWV1ZXIucHVzaEFuZE1heWJlUnVuKHRvcGljLCBu\nZXcgU3Vic2NyaWJlT3AodG9waWMsIHN1YlJlcXVlc3QsIGNvbnN1bWVTZXFJ\nZCwgY2FsbGJhY2ssIGN0eCkpOwogICAgfQoKICAgIHByaXZhdGUgY2xhc3Mg\nQ29uc3VtZU9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hyb25vdXNP\ncDxWb2lkPiB7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQ7CiAg\nICAgICAgTWVzc2FnZVNlcUlkIGNvbnN1bWVTZXFJZDsKCiAgICAgICAgcHVi\nbGljIENvbnN1bWVPcChCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1\nYnNjcmliZXJJZCwgTWVzc2FnZVNlcUlkIGNvbnN1bWVTZXFJZCwgQ2FsbGJh\nY2s8Vm9pZD4gY2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICBP\nYmplY3QgY3R4KSB7CiAgICAgICAgICAgIHF1ZXVlci5zdXBlcih0b3BpYywg\nY2FsbGJhY2ssIGN0eCk7CiAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlcklk\nID0gc3Vic2NyaWJlcklkOwogICAgICAgICAgICB0aGlzLmNvbnN1bWVTZXFJ\nZCA9IGNvbnN1bWVTZXFJZDsKICAgICAgICB9CgogICAgICAgIEBPdmVycmlk\nZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgTWFw\nPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9uU3RhdGU+IHRvcGlj\nU3VicyA9IHRvcDJzdWIyc2VxLmdldCh0b3BpYyk7CiAgICAgICAgICAgIGlm\nICh0b3BpY1N1YnMgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgY2Iub3Bl\ncmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgIHJl\ndHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgSW5NZW1vcnlTdWJz\nY3JpcHRpb25TdGF0ZSBzdWJTdGF0ZSA9IHRvcGljU3Vicy5nZXQoc3Vic2Ny\naWJlcklkKTsKICAgICAgICAgICAgaWYgKHN1YlN0YXRlID09IG51bGwpIHsK\nICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlzaGVkKGN0eCwgbnVs\nbCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAg\nICAgICAgICAgIGlmIChzdWJTdGF0ZS5zZXRMYXN0Q29uc3VtZVNlcUlkKGNv\nbnN1bWVTZXFJZCwgY2ZnLmdldENvbnN1bWVJbnRlcnZhbCgpKSkgewogICAg\nICAgICAgICAgICAgdXBkYXRlU3Vic2NyaXB0aW9uU3RhdGUodG9waWMsIHN1\nYnNjcmliZXJJZCwgc3ViU3RhdGUuZ2V0U3Vic2NyaXB0aW9uU3RhdGUoKSwg\nY2IsIGN0eCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAg\nICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAg\nICAgICAgICBsb2dnZXIuZGVidWcoIk9ubHkgYWR2YW5jZWQgY29uc3VtZSBw\nb2ludGVyIGluIG1lbW9yeSwgd2lsbCBwZXJzaXN0IGxhdGVyLCB0b3BpYzog\nIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpICsgIiBzdWJzY3JpYmVySWQ6ICIgKyBzdWJzY3JpYmVy\nSWQudG9TdHJpbmdVdGY4KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgKyAiIHBlcnNpc3RlbnRTdGF0ZTogIiArIFN1YnNjcmlwdGlvblN0\nYXRlVXRpbHMudG9TdHJpbmcoc3ViU3RhdGUuZ2V0U3Vic2NyaXB0aW9uU3Rh\ndGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyAiIGlu\nLW1lbW9yeSBjb25zdW1lLWlkOiAiCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgTWVzc2FnZUlkVXRpbHMubXNnSWRUb1JlYWRhYmxlU3Ry\naW5nKHN1YlN0YXRlLmdldExhc3RDb25zdW1lU2VxSWQoKSkpOwogICAgICAg\nICAgICAgICAgfQogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNo\nZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBzZXRDb25zdW1lU2Vx\nSWRGb3JTdWJzY3JpYmVyKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcg\nc3Vic2NyaWJlcklkLCBNZXNzYWdlU2VxSWQgY29uc3VtZVNlcUlkLAogICAg\nICAgICAgICBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkg\newogICAgICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBD\nb25zdW1lT3AodG9waWMsIHN1YnNjcmliZXJJZCwgY29uc3VtZVNlcUlkLCBj\nYWxsYmFjaywgY3R4KSk7CiAgICB9CgogICAgcHJpdmF0ZSBjbGFzcyBVbnN1\nYnNjcmliZU9wIGV4dGVuZHMgVG9waWNPcFF1ZXVlci5Bc3luY2hyb25vdXNP\ncDxWb2lkPiB7CiAgICAgICAgQnl0ZVN0cmluZyBzdWJzY3JpYmVySWQ7Cgog\nICAgICAgIHB1YmxpYyBVbnN1YnNjcmliZU9wKEJ5dGVTdHJpbmcgdG9waWMs\nIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkLCBDYWxsYmFjazxWb2lkPiBjYWxs\nYmFjaywgT2JqZWN0IGN0eCkgewogICAgICAgICAgICBxdWV1ZXIuc3VwZXIo\ndG9waWMsIGNhbGxiYWNrLCBjdHgpOwogICAgICAgICAgICB0aGlzLnN1YnNj\ncmliZXJJZCA9IHN1YnNjcmliZXJJZDsKICAgICAgICB9CgogICAgICAgIEBP\ndmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAg\nICAgZmluYWwgTWFwPEJ5dGVTdHJpbmcsIEluTWVtb3J5U3Vic2NyaXB0aW9u\nU3RhdGU+IHRvcGljU3Vic2NyaXB0aW9ucyA9IHRvcDJzdWIyc2VxLmdldCh0\nb3BpYyk7CiAgICAgICAgICAgIGlmICh0b3BpY1N1YnNjcmlwdGlvbnMgPT0g\nbnVsbCkgewogICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0\neCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2ZXJOb3RSZXNwb25zaWJsZUZv\nclRvcGljRXhjZXB0aW9uKCIiKSk7CiAgICAgICAgICAgICAgICByZXR1cm47\nCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdG9waWNTdWJzY3Jp\ncHRpb25zLmNvbnRhaW5zS2V5KHN1YnNjcmliZXJJZCkpIHsKICAgICAgICAg\nICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJTdWJFeGNl\ncHRpb24uQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbigiIikpOwogICAg\nICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAg\nICBkZWxldGVTdWJzY3JpcHRpb25TdGF0ZSh0b3BpYywgc3Vic2NyaWJlcklk\nLCBuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgICAgICBAT3Zl\ncnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJhdGlvbkZh\naWxlZChPYmplY3QgY3R4LCBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7\nCiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwg\nZXhjZXB0aW9uKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAg\nICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRp\nb24pIHsKICAgICAgICAgICAgICAgICAgICB0b3BpY1N1YnNjcmlwdGlvbnMu\ncmVtb3ZlKHN1YnNjcmliZXJJZCk7CiAgICAgICAgICAgICAgICAgICAgLy8g\nTm90aWZ5IGxpc3RlbmVycyBpZiBuZWNlc3NhcnkuCiAgICAgICAgICAgICAg\nICAgICAgQXRvbWljSW50ZWdlciBjb3VudCA9IHRvcGljMkxvY2FsQ291bnRz\nLmdldCh0b3BpYyk7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFTdWJzY3Jp\ncHRpb25TdGF0ZVV0aWxzLmlzSHViU3Vic2NyaWJlcihzdWJzY3JpYmVySWQp\nCiAgICAgICAgICAgICAgICAgICAgICAgICYmIGNvdW50ICE9IG51bGwgJiYg\nY291bnQuZGVjcmVtZW50QW5kR2V0KCkgPT0gMCkKICAgICAgICAgICAgICAg\nICAgICAgICAgbm90aWZ5VW5zdWJjcmliZSh0b3BpYyk7CgogICAgICAgICAg\nICAgICAgICAgIHVwZGF0ZU1lc3NhZ2VCb3VuZCh0b3BpYyk7CiAgICAgICAg\nICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmluaXNoZWQoY3R4LCBudWxsKTsK\nICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgY3R4KTsKCiAgICAg\nICAgfQoKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHB1YmxpYyB2b2lkIHVu\nc3Vic2NyaWJlKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2Ny\naWJlcklkLCBDYWxsYmFjazxWb2lkPiBjYWxsYmFjaywgT2JqZWN0IGN0eCkg\newogICAgICAgIHF1ZXVlci5wdXNoQW5kTWF5YmVSdW4odG9waWMsIG5ldyBV\nbnN1YnNjcmliZU9wKHRvcGljLCBzdWJzY3JpYmVySWQsIGNhbGxiYWNrLCBj\ndHgpKTsKICAgIH0KCiAgICAvKioKICAgICAqIE5vdCB0aHJlYWQtc2FmZS4K\nICAgICAqLwogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMgdm9pZCBhZGRMaXN0\nZW5lcihTdWJzY3JpcHRpb25FdmVudExpc3RlbmVyIGxpc3RlbmVyKSB7CiAg\nICAgICAgbGlzdGVuZXJzLmFkZChsaXN0ZW5lcik7CiAgICB9CgogICAgLyoq\nCiAgICAgKiBNZXRob2QgdG8gc3RvcCB0aGlzIGNsYXNzIGdyYWNlZnVsbHkg\naW5jbHVkaW5nIHJlbGVhc2luZyBhbnkgcmVzb3VyY2VzCiAgICAgKiB1c2Vk\nIGFuZCBzdG9wcGluZyBhbGwgdGhyZWFkcyBzcGF3bmVkLgogICAgICovCiAg\nICBwdWJsaWMgdm9pZCBzdG9wKCkgewogICAgICAgIHRpbWVyLmNhbmNlbCgp\nOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIGZpbmFsIExpbmtlZEJsb2Nr\naW5nUXVldWU8Qm9vbGVhbj4gcXVldWUgPSBuZXcgTGlua2VkQmxvY2tpbmdR\ndWV1ZTxCb29sZWFuPigpOwogICAgICAgICAgICAvLyB1cGRhdGUgZGlydHkg\nc3Vic2NyaXB0aW9ucwogICAgICAgICAgICBmb3IgKEJ5dGVTdHJpbmcgdG9w\naWMgOiB0b3Ayc3ViMnNlcS5rZXlTZXQoKSkgewogICAgICAgICAgICAgICAg\nQ2FsbGJhY2s8Vm9pZD4gZmluYWxDYiA9IG5ldyBDYWxsYmFjazxWb2lkPigp\nIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GaW5pc2hlZChPYmplY3Qg\nY3R4LCBWb2lkIHJlc3VsdE9mT3BlcmF0aW9uKSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KHF1ZXVlLCB0cnVlKTsK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgQE92\nZXJyaWRlCiAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0\naW9uRmFpbGVkKE9iamVjdCBjdHgsCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBQdWJTdWJFeGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KHF1ZXVlLCBmYWxz\nZSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsK\nICAgICAgICAgICAgICAgIHVwZGF0ZVN1YnNjcmlwdGlvblN0YXRlcyh0b3Bp\nYywgZmluYWxDYiwgbnVsbCwgZmFsc2UpOwogICAgICAgICAgICAgICAgcXVl\ndWUudGFrZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSBjYXRjaCAoSW50\nZXJydXB0ZWRFeGNlcHRpb24gaWUpIHsKICAgICAgICAgICAgbG9nZ2VyLndh\ncm4oIkVycm9yIGR1cmluZyB1cGRhdGluZyBzdWJzY3JpcHRpb24gc3RhdGVz\nIDogIiwgaWUpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgYWJz\ndHJhY3Qgdm9pZCBjcmVhdGVTdWJzY3JpcHRpb25TdGF0ZShmaW5hbCBCeXRl\nU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwKICAgICAg\nICAgICAgU3Vic2NyaXB0aW9uU3RhdGUgc3RhdGUsIENhbGxiYWNrPFZvaWQ+\nIGNhbGxiYWNrLCBPYmplY3QgY3R4KTsKCiAgICBwcm90ZWN0ZWQgYWJzdHJh\nY3Qgdm9pZCB1cGRhdGVTdWJzY3JpcHRpb25TdGF0ZShCeXRlU3RyaW5nIHRv\ncGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCwgU3Vic2NyaXB0aW9uU3Rh\ndGUgc3RhdGUsCiAgICAgICAgICAgIENhbGxiYWNrPFZvaWQ+IGNhbGxiYWNr\nLCBPYmplY3QgY3R4KTsKCiAgICBwcm90ZWN0ZWQgYWJzdHJhY3Qgdm9pZCBk\nZWxldGVTdWJzY3JpcHRpb25TdGF0ZShCeXRlU3RyaW5nIHRvcGljLCBCeXRl\nU3RyaW5nIHN1YnNjcmliZXJJZCwgQ2FsbGJhY2s8Vm9pZD4gY2FsbGJhY2ss\nCiAgICAgICAgICAgIE9iamVjdCBjdHgpOwoKfQo=\n","encoding":"base64"}

