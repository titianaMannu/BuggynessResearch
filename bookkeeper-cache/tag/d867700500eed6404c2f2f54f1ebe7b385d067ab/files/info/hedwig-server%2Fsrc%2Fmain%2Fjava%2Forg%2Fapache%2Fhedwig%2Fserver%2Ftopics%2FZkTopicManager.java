{"sha":"f92101a22338ac085c988412e94c6ca667bf208e","node_id":"MDQ6QmxvYjE1NzU5NTY6ZjkyMTAxYTIyMzM4YWMwODVjOTg4NDEyZTk0YzZjYTY2N2JmMjA4ZQ==","size":19537,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/f92101a22338ac085c988412e94c6ca667bf208e","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIudG9waWNzOwoKaW1wb3J0\nIGphdmEubmV0LlVua25vd25Ib3N0RXhjZXB0aW9uOwppbXBvcnQgamF2YS51\ndGlsLkxpc3Q7CmltcG9ydCBqYXZhLnV0aWwuUmFuZG9tOwppbXBvcnQgamF2\nYS51dGlsLmNvbmN1cnJlbnQuU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlOwpp\nbXBvcnQgamF2YS51dGlsLmNvbmN1cnJlbnQuU3luY2hyb25vdXNRdWV1ZTsK\nCmltcG9ydCBvcmcuc2xmNGouTG9nZ2VyOwppbXBvcnQgb3JnLnNsZjRqLkxv\nZ2dlckZhY3Rvcnk7CmltcG9ydCBvcmcuYXBhY2hlLnpvb2tlZXBlci5DcmVh\ndGVNb2RlOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuS2VlcGVyRXhj\nZXB0aW9uOwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlZEV2\nZW50OwppbXBvcnQgb3JnLmFwYWNoZS56b29rZWVwZXIuV2F0Y2hlcjsKaW1w\nb3J0IG9yZy5hcGFjaGUuem9va2VlcGVyLlpvb0tlZXBlcjsKaW1wb3J0IG9y\nZy5hcGFjaGUuem9va2VlcGVyLktlZXBlckV4Y2VwdGlvbi5Db2RlOwppbXBv\ncnQgb3JnLmFwYWNoZS56b29rZWVwZXIuWm9vRGVmcy5JZHM7CmltcG9ydCBv\ncmcuYXBhY2hlLnpvb2tlZXBlci5kYXRhLlN0YXQ7CgppbXBvcnQgY29tLmdv\nb2dsZS5wcm90b2J1Zi5CeXRlU3RyaW5nOwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9ydCBvcmcu\nYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuY29tbW9uLlNlcnZlckNvbmZpZ3VyYXRp\nb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5Db25jdXJyZW5jeVV0aWxz\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5FaXRoZXI7CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkhlZHdpZ1NvY2tldEFkZHJlc3M7\nCmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy56b29rZWVwZXIuU2FmZUFzeW5j\nWktDYWxsYmFjazsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnpvb2tlZXBl\nci5aa1V0aWxzOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuem9va2VlcGVy\nLlNhZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrOwppbXBvcnQgb3Jn\nLmFwYWNoZS5oZWR3aWcuem9va2VlcGVyLlNhZmVBc3luY1pLQ2FsbGJhY2su\nU3RhdENhbGxiYWNrOwoKLyoqCiAqIFRvcGljcyBhcmUgb3BlcmF0ZWQgb24g\naW4gcGFyYWxsZWwgYXMgdGhleSBhcmUgaW5kZXBlbmRlbnQuCiAqCiAqLwpw\ndWJsaWMgY2xhc3MgWmtUb3BpY01hbmFnZXIgZXh0ZW5kcyBBYnN0cmFjdFRv\ncGljTWFuYWdlciBpbXBsZW1lbnRzIFRvcGljTWFuYWdlciB7CgogICAgc3Rh\ndGljIExvZ2dlciBsb2dnZXIgPSBMb2dnZXJGYWN0b3J5LmdldExvZ2dlciha\na1RvcGljTWFuYWdlci5jbGFzcyk7CiAgICBSYW5kb20gcmFuZCA9IG5ldyBS\nYW5kb20oKTsKCiAgICAvKioKICAgICAqIFBlcnNpc3RlbnQgc3RvcmFnZSBm\nb3IgdG9waWMgbWV0YWRhdGEuCiAgICAgKi8KICAgIHByaXZhdGUgWm9vS2Vl\ncGVyIHprOwogICAgU3RyaW5nIGVwaGVtZXJhbE5vZGVQYXRoOwoKICAgIFN0\nYXRDYWxsYmFjayBsb2FkUmVwb3J0aW5nU3RhdENhbGxiYWNrID0gbmV3IFN0\nYXRDYWxsYmFjaygpIHsKICAgICAgICBAT3ZlcnJpZGUKICAgICAgICBwdWJs\naWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRo\nLCBPYmplY3QgY3R4LCBTdGF0IHN0YXQpIHsKICAgICAgICAgICAgaWYgKHJj\nICE9IEtlZXBlckV4Y2VwdGlvbi5Db2RlLk9LLmludFZhbHVlKCkpIHsKICAg\nICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJGYWlsZWQgdG8gdXBkYXRlIGxv\nYWQgaW5mb3JtYXRpb24gaW4gemsiKTsKICAgICAgICAgICAgfQogICAgICAg\nIH0KICAgIH07CgogICAgLy8gQm9vbGVhbiBmbGFnIGluZGljYXRpbmcgaWYg\nd2Ugc2hvdWxkIHN1c3BlbmQgYWN0aXZpdHkuIElmIHRoaXMgaXMgdHJ1ZSwK\nICAgIC8vIGFsbCBvZiB0aGUgT3BzIHB1dCBpbnRvIHRoZSBxdWV1ZXIgd2ls\nbCBmYWlsIGF1dG9tYXRpY2FsbHkuCiAgICBwcm90ZWN0ZWQgdm9sYXRpbGUg\nYm9vbGVhbiBpc1N1c3BlbmRlZCA9IGZhbHNlOwoKICAgIC8qKgogICAgICog\nQ3JlYXRlIGEgbmV3IHRvcGljIG1hbmFnZXIuIFBhc3MgaW4gYW4gYWN0aXZl\nIFpvb0tlZXBlciBjbGllbnQgb2JqZWN0LgogICAgICoKICAgICAqIEBwYXJh\nbSB6awogICAgICovCiAgICBwdWJsaWMgWmtUb3BpY01hbmFnZXIoZmluYWwg\nWm9vS2VlcGVyIHprLCBmaW5hbCBTZXJ2ZXJDb25maWd1cmF0aW9uIGNmZywg\nU2NoZWR1bGVkRXhlY3V0b3JTZXJ2aWNlIHNjaGVkdWxlcikKICAgICAgICAg\nICAgdGhyb3dzIFVua25vd25Ib3N0RXhjZXB0aW9uLCBQdWJTdWJFeGNlcHRp\nb24gewoKICAgICAgICBzdXBlcihjZmcsIHNjaGVkdWxlcik7CiAgICAgICAg\ndGhpcy56ayA9IHprOwogICAgICAgIHRoaXMuZXBoZW1lcmFsTm9kZVBhdGgg\nPSBjZmcuZ2V0WmtIb3N0c1ByZWZpeChuZXcgU3RyaW5nQnVpbGRlcigpKS5h\ncHBlbmQoIi8iKS5hcHBlbmQoYWRkcikudG9TdHJpbmcoKTsKCiAgICAgICAg\nemsucmVnaXN0ZXIobmV3IFdhdGNoZXIoKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBwcm9jZXNzKFdhdGNoZWRF\ndmVudCBldmVudCkgewogICAgICAgICAgICAgICAgaWYgKGV2ZW50LmdldFR5\ncGUoKS5lcXVhbHMoV2F0Y2hlci5FdmVudC5FdmVudFR5cGUuTm9uZSkpIHsK\nICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuZ2V0U3RhdGUoKS5lcXVh\nbHMoV2F0Y2hlci5FdmVudC5LZWVwZXJTdGF0ZS5EaXNjb25uZWN0ZWQpKSB7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuKCJaSyBjbGll\nbnQgaGFzIGJlZW4gZGlzY29ubmVjdGVkIHRvIHRoZSBaSyBzZXJ2ZXIhIik7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VzcGVuZGVkID0gdHJ1ZTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50LmdldFN0YXRl\nKCkuZXF1YWxzKFdhdGNoZXIuRXZlbnQuS2VlcGVyU3RhdGUuU3luY0Nvbm5l\nY3RlZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzU3VzcGVu\nZGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5m\nbygiWksgY2xpZW50IGhhcyBiZWVuIHJlY29ubmVjdGVkIHRvIHRoZSBaSyBz\nZXJ2ZXIhIik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAg\nICAgICAgICAgICAgICAgaXNTdXNwZW5kZWQgPSBmYWxzZTsKICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAvLyBDaGVjayBmb3IgZXhwaXJlZCBjb25uZWN0aW9uLgogICAgICAgICAg\nICAgICAgaWYgKGV2ZW50LmdldFN0YXRlKCkuZXF1YWxzKFdhdGNoZXIuRXZl\nbnQuS2VlcGVyU3RhdGUuRXhwaXJlZCkpIHsKICAgICAgICAgICAgICAgICAg\nICBsb2dnZXIuZXJyb3IoIlpLIGNsaWVudCBjb25uZWN0aW9uIHRvIHRoZSBa\nSyBzZXJ2ZXIgaGFzIGV4cGlyZWQhIik7CiAgICAgICAgICAgICAgICAgICAg\nUnVudGltZS5nZXRSdW50aW1lKCkuZXhpdCgxKTsKICAgICAgICAgICAgICAg\nIH0KICAgICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGZpbmFsIFN5\nbmNocm9ub3VzUXVldWU8RWl0aGVyPFZvaWQsIFB1YlN1YkV4Y2VwdGlvbj4+\nIHF1ZXVlID0gbmV3IFN5bmNocm9ub3VzUXVldWU8RWl0aGVyPFZvaWQsIFB1\nYlN1YkV4Y2VwdGlvbj4+KCk7CgogICAgICAgIHJlZ2lzdGVyV2l0aFpvb2tl\nZXBlcihuZXcgQ2FsbGJhY2s8Vm9pZD4oKSB7CiAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICBwdWJsaWMgdm9pZCBvcGVyYXRpb25GYWlsZWQo\nT2JqZWN0IGN0eCwgUHViU3ViRXhjZXB0aW9uIGV4Y2VwdGlvbikgewogICAg\nICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCJGYWlsZWQgdG8gcmVnaXN0ZXIg\naHViIHdpdGggem9va2VlcGVyIiwgZXhjZXB0aW9uKTsKICAgICAgICAgICAg\nICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KHF1ZXVlLCBFaXRoZXIub2YoKFZv\naWQpIG51bGwsIGV4Y2VwdGlvbikpOwogICAgICAgICAgICB9CgogICAgICAg\nICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgb3BlcmF0\naW9uRmluaXNoZWQoT2JqZWN0IGN0eCwgVm9pZCByZXN1bHRPZk9wZXJhdGlv\nbikgewogICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oIlN1Y2Nlc3NmdWxs\neSByZWdpc3RlcmVkIGh1YiB3aXRoIHpvb2tlZXBlciIpOwogICAgICAgICAg\nICAgICAgQ29uY3VycmVuY3lVdGlscy5wdXQocXVldWUsIEVpdGhlci5vZihy\nZXN1bHRPZk9wZXJhdGlvbiwgKFB1YlN1YkV4Y2VwdGlvbikgbnVsbCkpOwog\nICAgICAgICAgICB9CiAgICAgICAgfSwgbnVsbCk7CgogICAgICAgIFB1YlN1\nYkV4Y2VwdGlvbiBwc2UgPSBDb25jdXJyZW5jeVV0aWxzLnRha2UocXVldWUp\nLnJpZ2h0KCk7CgogICAgICAgIGlmIChwc2UgIT0gbnVsbCkgewogICAgICAg\nICAgICB0aHJvdyBwc2U7CiAgICAgICAgfQogICAgfQoKICAgIHZvaWQgcmVn\naXN0ZXJXaXRoWm9va2VlcGVyKGZpbmFsIENhbGxiYWNrPFZvaWQ+IGNhbGxi\nYWNrLCBPYmplY3QgY3R4KSB7CgogICAgICAgIFprVXRpbHMuY3JlYXRlRnVs\nbFBhdGhPcHRpbWlzdGljKHprLCBlcGhlbWVyYWxOb2RlUGF0aCwgZ2V0Q3Vy\ncmVudExvYWREYXRhKCksIElkcy5PUEVOX0FDTF9VTlNBRkUsCiAgICAgICAg\nQ3JlYXRlTW9kZS5FUEhFTUVSQUwsIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNr\nLlN0cmluZ0NhbGxiYWNrKCkgewoKICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgIHB1YmxpYyB2b2lkIHNhZmVQcm9jZXNzUmVzdWx0KGludCBy\nYywgU3RyaW5nIHBhdGgsIE9iamVjdCBjdHgsIFN0cmluZyBuYW1lKSB7CiAg\nICAgICAgICAgICAgICBpZiAocmMgPT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7\nCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmluaXNo\nZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAocmMgIT0gQ29k\nZS5OT0RFRVhJU1RTLmludFZhbHVlKCkpIHsKICAgICAgICAgICAgICAgICAg\nICBLZWVwZXJFeGNlcHRpb24ga2UgPSBaa1V0aWxzLmxvZ0Vycm9yQW5kQ3Jl\nYXRlWktFeGNlcHRpb24oCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICJDb3VsZCBub3QgY3JlYXRlIGVwaGVtZXJhbCBu\nb2RlIHRvIHJlZ2lzdGVyIGh1YiIsIGVwaGVtZXJhbE5vZGVQYXRoLCByYyk7\nCiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sub3BlcmF0aW9uRmFpbGVk\nKGN0eCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlv\nbihrZSkpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgIH0KCiAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygiRm91bmQg\nc3RhbGUgZXBoZW1lcmFsIG5vZGUgd2hpbGUgcmVnaXN0ZXJpbmcgaHViIHdp\ndGggWkssIGRlbGV0aW5nIGl0Iik7CgogICAgICAgICAgICAgICAgLy8gTm9k\nZSBleGlzdHMsIGxldHMgdHJ5IHRvIGRlbGV0ZSBpdCBhbmQgcmV0cnkKICAg\nICAgICAgICAgICAgIHprLmRlbGV0ZShlcGhlbWVyYWxOb2RlUGF0aCwgLTEs\nIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLlZvaWRDYWxsYmFjaygpIHsKICAg\nICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmlu\nZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAgICAgICAg\nIGlmIChyYyA9PSBDb2RlLk9LLmludFZhbHVlKCkgfHwgcmMgPT0gQ29kZS5O\nT05PREUuaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgcmVnaXN0ZXJXaXRoWm9va2VlcGVyKGNhbGxiYWNrLCBjdHgpOwogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIEtlZXBlckV4\nY2VwdGlvbiBrZSA9IFprVXRpbHMubG9nRXJyb3JBbmRDcmVhdGVaS0V4Y2Vw\ndGlvbigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICJDb3VsZCBub3QgZGVsZXRlIHN0YWxlIGVwaGVtZXJhbCBu\nb2RlIHRvIHJlZ2lzdGVyIGh1YiIsIGVwaGVtZXJhbE5vZGVQYXRoLCByYyk7\nCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrLm9wZXJhdGlvbkZh\naWxlZChjdHgsIG5ldyBQdWJTdWJFeGNlcHRpb24uU2VydmljZURvd25FeGNl\ncHRpb24oa2UpKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwoK\nICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCBjdHgp\nOwoKICAgICAgICAgICAgfQogICAgICAgIH0sIG51bGwpOwogICAgfQoKICAg\nIHZvaWQgdW5yZWdpc3RlcldpdGhab29rZWVwZXIoKSB0aHJvd3MgSW50ZXJy\ndXB0ZWRFeGNlcHRpb24sIEtlZXBlckV4Y2VwdGlvbiB7CiAgICAgICAgemsu\nZGVsZXRlKGVwaGVtZXJhbE5vZGVQYXRoLCAtMSk7CiAgICB9CgogICAgU3Ry\naW5nIGh1YlBhdGgoQnl0ZVN0cmluZyB0b3BpYykgewogICAgICAgIHJldHVy\nbiBjZmcuZ2V0WmtUb3BpY1BhdGgobmV3IFN0cmluZ0J1aWxkZXIoKSwgdG9w\naWMpLmFwcGVuZCgiL2h1YiIpLnRvU3RyaW5nKCk7CiAgICB9CgogICAgQE92\nZXJyaWRlCiAgICBwcm90ZWN0ZWQgdm9pZCByZWFsR2V0T3duZXIoZmluYWwg\nQnl0ZVN0cmluZyB0b3BpYywgZmluYWwgYm9vbGVhbiBzaG91bGRDbGFpbSwK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaW5hbCBDYWxsYmFj\nazxIZWR3aWdTb2NrZXRBZGRyZXNzPiBjYiwgZmluYWwgT2JqZWN0IGN0eCkg\newogICAgICAgIC8vIElmIG9wZXJhdGlvbnMgYXJlIHN1c3BlbmRlZCBkdWUg\ndG8gYSBaSyBjbGllbnQgZGlzY29ubmVjdCwganVzdCBlcnJvcgogICAgICAg\nIC8vIG91dCB0aGlzIGNhbGwgYW5kIHJldHVybi4KICAgICAgICBpZiAoaXNT\ndXNwZW5kZWQpIHsKICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0\neCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbigK\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiWktUb3BpY01h\nbmFnZXIgc2VydmljZSBpcyB0ZW1wb3JhcmlseSBzdXNwZW5kZWQhIikpOwog\nICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAodG9w\naWNzLmNvbnRhaW5zKHRvcGljKSkgewogICAgICAgICAgICBjYi5vcGVyYXRp\nb25GaW5pc2hlZChjdHgsIGFkZHIpOwogICAgICAgICAgICByZXR1cm47CiAg\nICAgICAgfQoKICAgICAgICBuZXcgWmtHZXRPd25lck9wKHRvcGljLCBzaG91\nbGRDbGFpbSwgY2IsIGN0eCkucmVhZCgpOwogICAgfQoKICAgIC8vIFJlY3Vy\nc2l2ZWx5IGNhbGwgZWFjaCBvdGhlci4KICAgIGNsYXNzIFprR2V0T3duZXJP\ncCB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYzsKICAgICAgICBib29sZWFu\nIHNob3VsZENsYWltOwogICAgICAgIENhbGxiYWNrPEhlZHdpZ1NvY2tldEFk\nZHJlc3M+IGNiOwogICAgICAgIE9iamVjdCBjdHg7CiAgICAgICAgU3RyaW5n\nIGh1YlBhdGg7CgogICAgICAgIHB1YmxpYyBaa0dldE93bmVyT3AoQnl0ZVN0\ncmluZyB0b3BpYywgYm9vbGVhbiBzaG91bGRDbGFpbSwgQ2FsbGJhY2s8SGVk\nd2lnU29ja2V0QWRkcmVzcz4gY2IsIE9iamVjdCBjdHgpIHsKICAgICAgICAg\nICAgdGhpcy50b3BpYyA9IHRvcGljOwogICAgICAgICAgICB0aGlzLnNob3Vs\nZENsYWltID0gc2hvdWxkQ2xhaW07CiAgICAgICAgICAgIHRoaXMuY2IgPSBj\nYjsKICAgICAgICAgICAgdGhpcy5jdHggPSBjdHg7CiAgICAgICAgICAgIGh1\nYlBhdGggPSBodWJQYXRoKHRvcGljKTsKCiAgICAgICAgfQoKICAgICAgICBw\ndWJsaWMgdm9pZCBjaG9vc2UoKSB7CiAgICAgICAgICAgIC8vIEdldCB0aGUg\nbGlzdCBvZiBleGlzdGluZyBob3N0cwogICAgICAgICAgICBTdHJpbmcgcmVn\naXN0ZXJlZEhvc3RzUGF0aCA9IGNmZy5nZXRaa0hvc3RzUHJlZml4KG5ldyBT\ndHJpbmdCdWlsZGVyKCkpLnRvU3RyaW5nKCk7CiAgICAgICAgICAgIHprLmdl\ndENoaWxkcmVuKHJlZ2lzdGVyZWRIb3N0c1BhdGgsIGZhbHNlLCBuZXcgU2Fm\nZUFzeW5jWktDYWxsYmFjay5DaGlsZHJlbkNhbGxiYWNrKCkgewogICAgICAg\nICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAgICBwdWJsaWMgdm9p\nZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmluZyBwYXRoLCBPYmpl\nY3QgY3R4LCBMaXN0PFN0cmluZz4gY2hpbGRyZW4pIHsKICAgICAgICAgICAg\nICAgICAgICBpZiAocmMgIT0gQ29kZS5PSy5pbnRWYWx1ZSgpKSB7CiAgICAg\nICAgICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBlID0gWmtVdGls\ncy5sb2dFcnJvckFuZENyZWF0ZVpLRXhjZXB0aW9uKAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ291bGQgbm90\nIGdldCBsaXN0IG9mIGF2YWlsYWJsZSBodWJzIiwgcGF0aCwgcmMpOwogICAg\nICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWlsZWQoY3R4LCBu\nZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0aW9uKGUpKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBjaG9vc2VMZWFzdExvYWRl\nZE5vZGUoY2hpbGRyZW4pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9LCBudWxsKTsKICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNo\nb29zZUxlYXN0TG9hZGVkTm9kZShmaW5hbCBMaXN0PFN0cmluZz4gY2hpbGRy\nZW4pIHsKICAgICAgICAgICAgRGF0YUNhbGxiYWNrIGRhdGFDYWxsYmFjayA9\nIG5ldyBEYXRhQ2FsbGJhY2soKSB7CiAgICAgICAgICAgICAgICBpbnQgbnVt\nUmVzcG9uc2VzID0gMDsKICAgICAgICAgICAgICAgIGludCBtaW5Mb2FkID0g\nSW50ZWdlci5NQVhfVkFMVUU7CiAgICAgICAgICAgICAgICBTdHJpbmcgbGVh\nc3RMb2FkZWQgPSBudWxsOwoKICAgICAgICAgICAgICAgIEBPdmVycmlkZQog\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVByb2Nlc3NSZXN1bHQo\naW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgYnl0ZVtdIGRhdGEs\nIFN0YXQgc3RhdCkgewogICAgICAgICAgICAgICAgICAgIHN5bmNocm9uaXpl\nZCAodGhpcykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0g\nS2VlcGVyRXhjZXB0aW9uLkNvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpbnQgbG9hZCA9IEludGVnZXIucGFyc2VJbnQobmV3\nIFN0cmluZyhkYXRhKSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiRm91bmQg\nc2VydmVyOiAiICsgY3R4ICsgIiB3aXRoIGxvYWQ6ICIgKyBsb2FkKTsKICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgaWYgKGxvYWQgPCBtaW5Mb2FkICB8fCAobG9h\nZCA9PSBtaW5Mb2FkICYmIHJhbmQubmV4dEJvb2xlYW4oKSkpIHsKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWluTG9hZCA9IGxvYWQ7\nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlYXN0TG9h\nZGVkID0gKFN0cmluZykgY3R4OwogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gg\nKE51bWJlckZvcm1hdEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgbG9nZ2VyLndhcm4oIkNvcnJ1cHRlZCBsb2FkIGlu\nZm9ybWF0aW9uIGZyb20gaHViOiIgKyBjdHgpOwogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIC8vIHNvbWUgY29ycnVwdGVkIGRhdGEsIHdlJ2xs\nIGp1c3QgaWdub3JlIHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAvLyBodWIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICBudW1SZXNwb25zZXMrKzsKCiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChudW1SZXNwb25zZXMgPT0gY2hpbGRyZW4uc2l6ZSgpKSB7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBpZiAobGVhc3RMb2FkZWQgPT0gbnVsbCkg\newogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlv\nbkZhaWxlZChaa0dldE93bmVyT3AudGhpcy5jdHgsIG5ldyBQdWJTdWJFeGNl\ncHRpb24uU2VydmljZURvd25FeGNlcHRpb24oCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiTm8gaHVi\nIGF2YWlsYWJsZSIpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICBIZWR3aWdTb2NrZXRBZGRyZXNzIG93\nbmVyID0gbmV3IEhlZHdpZ1NvY2tldEFkZHJlc3MobGVhc3RMb2FkZWQpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG93bmVyLmVxdWFscyhh\nZGRyKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYWlt\nKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZpbmlz\naGVkKFprR2V0T3duZXJPcC50aGlzLmN0eCwgb3duZXIpOwogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIH0KICAg\nICAgICAgICAgfTsKCiAgICAgICAgICAgIGZvciAoU3RyaW5nIGNoaWxkIDog\nY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgIHprLmdldERhdGEoY2ZnLmdl\ndFprSG9zdHNQcmVmaXgobmV3IFN0cmluZ0J1aWxkZXIoKSkuYXBwZW5kKCIv\nIikuYXBwZW5kKGNoaWxkKS50b1N0cmluZygpLCBmYWxzZSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgZGF0YUNhbGxiYWNrLCBjaGlsZCk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHB1YmxpYyB2b2lkIGNsYWlt\nT3JDaG9vc2UoKSB7CiAgICAgICAgICAgIGlmIChzaG91bGRDbGFpbSkKICAg\nICAgICAgICAgICAgIGNsYWltKCk7CiAgICAgICAgICAgIGVsc2UKICAgICAg\nICAgICAgICAgIGNob29zZSgpOwogICAgICAgIH0KCiAgICAgICAgcHVibGlj\nIHZvaWQgcmVhZCgpIHsKICAgICAgICAgICAgemsuZ2V0RGF0YShodWJQYXRo\nLCBmYWxzZSwgbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNr\nKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAgICAgICAgICAgICAg\nICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMsIFN0cmlu\nZyBwYXRoLCBPYmplY3QgY3R4LCBieXRlW10gZGF0YSwgU3RhdCBzdGF0KSB7\nCgogICAgICAgICAgICAgICAgICAgIGlmIChyYyA9PSBDb2RlLk5PTk9ERS5p\nbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNsYWltT3JD\naG9vc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAg\nICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgaWYgKHJj\nICE9IENvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICBLZWVwZXJFeGNlcHRpb24gZSA9IFprVXRpbHMubG9nRXJyb3JBbmRD\ncmVhdGVaS0V4Y2VwdGlvbigiQ291bGQgbm90IHJlYWQgb3duZXJzaGlwIGZv\nciB0b3BpYzogIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICsgdG9waWMudG9TdHJpbmdVdGY4KCksIHBhdGgsIHJjKTsK\nICAgICAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0\neCwgbmV3IFB1YlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihl\nKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAg\nICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3Nm\ndWxseSBkaWQgYSByZWFkCiAgICAgICAgICAgICAgICAgICAgSGVkd2lnU29j\na2V0QWRkcmVzcyBvd25lciA9IG5ldyBIZWR3aWdTb2NrZXRBZGRyZXNzKG5l\ndyBTdHJpbmcoZGF0YSkpOwogICAgICAgICAgICAgICAgICAgIGlmICghb3du\nZXIuZXF1YWxzKGFkZHIpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlm\nIChsb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCJ0b3BpYzogIiArIHRvcGljLnRv\nU3RyaW5nVXRmOCgpICsgIiBiZWxvbmdzIHRvIHNvbWVvbmUgZWxzZTogIiAr\nIG93bmVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG93bmVy\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8o\nIkRpc2NvdmVyZWQgc3RhbGUgc2VsZi1ub2RlIGZvciB0b3BpYzogIiArIHRv\ncGljLnRvU3RyaW5nVXRmOCgpICsgIiwgd2lsbCBkZWxldGUgaXQiKTsKCiAg\nICAgICAgICAgICAgICAgICAgLy8gd2UgbXVzdCBoYXZlIHByZXZpb3VzbHkg\nZmFpbGVkIGFuZCBsZWZ0IGEKICAgICAgICAgICAgICAgICAgICAvLyByZXNp\nZHVhbCBlcGhlbWVyYWwgbm9kZSBoZXJlLCBzbyB3ZSBtdXN0CiAgICAgICAg\nICAgICAgICAgICAgLy8gZGVsZXRlIGl0IChjbGVhbiBpdCB1cCkgYW5kIHRo\nZW4KICAgICAgICAgICAgICAgICAgICAvLyByZS1jcmVhdGUvcmUtYWNxdWly\nZSB0aGUgdG9waWMuCiAgICAgICAgICAgICAgICAgICAgemsuZGVsZXRlKGh1\nYlBhdGgsIHN0YXQuZ2V0VmVyc2lvbigpLCBuZXcgVm9pZENhbGxiYWNrKCkg\newogICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAg\nICAgICAgICAgICAgICAgcHVibGljIHZvaWQgcHJvY2Vzc1Jlc3VsdChpbnQg\ncmMsIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBpZiAoQ29kZS5PSy5pbnRWYWx1ZSgpID09IHJjIHx8\nIENvZGUuTk9OT0RFLmludFZhbHVlKCkgPT0gcmMpIHsKICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICBjbGFpbU9yQ2hvb3NlKCk7CiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgIEtlZXBlckV4Y2VwdGlvbiBlID0gWmtVdGlscy5s\nb2dFcnJvckFuZENyZWF0ZVpLRXhjZXB0aW9uKAogICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJDb3Vs\nZCBub3QgZGVsZXRlIHNlbGYgbm9kZSBmb3IgdG9waWM6ICIgKyB0b3BpYy50\nb1N0cmluZ1V0ZjgoKSwgcGF0aCwgcmMpOwogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgIGNiLm9wZXJhdGlvbkZhaWxlZChjdHgsIG5ldyBQdWJT\ndWJFeGNlcHRpb24uU2VydmljZURvd25FeGNlcHRpb24oZSkpOwogICAgICAg\nICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAg\nICB9CiAgICAgICAgICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICAgICAg\nICAgIH0KICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICB9CgogICAgICAg\nIHB1YmxpYyB2b2lkIGNsYWltKCkgewogICAgICAgICAgICBpZiAobG9nZ2Vy\nLmlzRGVidWdFbmFibGVkKCkpIHsKICAgICAgICAgICAgICAgIGxvZ2dlci5k\nZWJ1ZygiY2xhaW1pbmcgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0Zjgo\nKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIFprVXRpbHMuY3JlYXRl\nRnVsbFBhdGhPcHRpbWlzdGljKHprLCBodWJQYXRoLCBhZGRyLnRvU3RyaW5n\nKCkuZ2V0Qnl0ZXMoKSwgSWRzLk9QRU5fQUNMX1VOU0FGRSwKICAgICAgICAg\nICAgQ3JlYXRlTW9kZS5FUEhFTUVSQUwsIG5ldyBTYWZlQXN5bmNaS0NhbGxi\nYWNrLlN0cmluZ0NhbGxiYWNrKCkgewoKICAgICAgICAgICAgICAgIEBPdmVy\ncmlkZQogICAgICAgICAgICAgICAgcHVibGljIHZvaWQgc2FmZVByb2Nlc3NS\nZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0eCwgU3RyaW5n\nIG5hbWUpIHsKICAgICAgICAgICAgICAgICAgICBpZiAocmMgPT0gQ29kZS5P\nSy5pbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChs\nb2dnZXIuaXNEZWJ1Z0VuYWJsZWQoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbG9nZ2VyLmRlYnVnKCJjbGFpbWVkIHRvcGljOiAiICsgdG9w\naWMudG9TdHJpbmdVdGY4KCkpOwogICAgICAgICAgICAgICAgICAgICAgICB9\nCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmeUxpc3RlbmVyc0FuZEFk\nZFRvT3duZWRUb3BpY3ModG9waWMsIGNiLCBjdHgpOwogICAgICAgICAgICAg\nICAgICAgICAgICB1cGRhdGVMb2FkSW5mb3JtYXRpb24oKTsKICAgICAgICAg\nICAgICAgICAgICB9IGVsc2UgaWYgKHJjID09IENvZGUuTk9ERUVYSVNUUy5p\nbnRWYWx1ZSgpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWQoKTsK\nICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAg\nICAgICAgICBLZWVwZXJFeGNlcHRpb24gZSA9IFprVXRpbHMubG9nRXJyb3JB\nbmRDcmVhdGVaS0V4Y2VwdGlvbigKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIkZhaWxlZCB0byBjcmVhdGUgZXBo\nZW1lcmFsIG5vZGUgdG8gY2xhaW0gb3duZXJzaGlwIG9mIHRvcGljOiAiCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICsgdG9waWMudG9TdHJpbmdVdGY4KCksIHBhdGgsIHJjKTsKICAgICAgICAg\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1\nYlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAg\nICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAg\nICB9LCBjdHgpOwogICAgICAgIH0KCiAgICB9CgogICAgYnl0ZVtdIGdldEN1\ncnJlbnRMb2FkRGF0YSgpIHsKICAgICAgICAvLyBGb3Igbm93LCB1c2luZyB0\naGUgbnVtYmVyIG9mIHRvcGljcyBhcyBhbiBpbmRpY2F0b3Igb2YgbG9hZAog\nICAgICAgIC8vIGluZm9ybWF0aW9uCiAgICAgICAgcmV0dXJuICh0b3BpY3Mu\nc2l6ZSgpICsgIiIpLmdldEJ5dGVzKCk7CiAgICB9CgogICAgdm9pZCB1cGRh\ndGVMb2FkSW5mb3JtYXRpb24oKSB7CiAgICAgICAgYnl0ZVtdIGN1cnJlbnRM\nb2FkID0gZ2V0Q3VycmVudExvYWREYXRhKCk7CiAgICAgICAgaWYgKGxvZ2dl\nci5pc0RlYnVnRW5hYmxlZCgpKSB7CiAgICAgICAgICAgIGxvZ2dlci5kZWJ1\nZygiUmVwb3J0aW5nIGxvYWQgb2YgIiArIG5ldyBTdHJpbmcoY3VycmVudExv\nYWQpKTsKICAgICAgICB9CiAgICAgICAgemsuc2V0RGF0YShlcGhlbWVyYWxO\nb2RlUGF0aCwgY3VycmVudExvYWQsIC0xLCBsb2FkUmVwb3J0aW5nU3RhdENh\nbGxiYWNrLCBudWxsKTsKICAgIH0KCiAgICBAT3ZlcnJpZGUKICAgIHByb3Rl\nY3RlZCB2b2lkIHBvc3RSZWxlYXNlQ2xlYW51cChmaW5hbCBCeXRlU3RyaW5n\nIHRvcGljLCBmaW5hbCBDYWxsYmFjazxWb2lkPiBjYiwgT2JqZWN0IGN0eCkg\newoKICAgICAgICB6ay5nZXREYXRhKGh1YlBhdGgodG9waWMpLCBmYWxzZSwg\nbmV3IFNhZmVBc3luY1pLQ2FsbGJhY2suRGF0YUNhbGxiYWNrKCkgewogICAg\nICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgcHVibGljIHZvaWQgc2Fm\nZVByb2Nlc3NSZXN1bHQoaW50IHJjLCBTdHJpbmcgcGF0aCwgT2JqZWN0IGN0\neCwgYnl0ZVtdIGRhdGEsIFN0YXQgc3RhdCkgewogICAgICAgICAgICAgICAg\naWYgKHJjID09IENvZGUuTk9OT0RFLmludFZhbHVlKCkpIHsKICAgICAgICAg\nICAgICAgICAgICAvLyBOb2RlIGhhcyBzb21laG93IGRpc2FwcGVhcmVkIGZy\nb20gdW5kZXIgdXMsIGxpdmUgd2l0aCBpdAogICAgICAgICAgICAgICAgICAg\nIC8vIHNpbmNlIGl0cyBhIHRyYW5zaWVudCBub2RlCiAgICAgICAgICAgICAg\nICAgICAgbG9nZ2VyLndhcm4oIldoaWxlIGRlbGV0aW5nIHNlbGYtbm9kZSBm\nb3IgdG9waWM6ICIgKyB0b3BpYy50b1N0cmluZ1V0ZjgoKSArICIsIG5vZGUg\nbm90IGZvdW5kIik7CiAgICAgICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9u\nRmluaXNoZWQoY3R4LCBudWxsKTsKICAgICAgICAgICAgICAgICAgICByZXR1\ncm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJj\nICE9IENvZGUuT0suaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAg\nIEtlZXBlckV4Y2VwdGlvbiBlID0gWmtVdGlscy5sb2dFcnJvckFuZENyZWF0\nZVpLRXhjZXB0aW9uKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICJGYWlsZWQgdG8gZGVsZXRlIHNlbGYtb3duZXJzaGlw\nIG5vZGUgZm9yIHRvcGljOiAiICsgdG9waWMudG9TdHJpbmdVdGY4KCksIHBh\ndGgsIHJjKTsKICAgICAgICAgICAgICAgICAgICBjYi5vcGVyYXRpb25GYWls\nZWQoY3R4LCBuZXcgUHViU3ViRXhjZXB0aW9uLlNlcnZpY2VEb3duRXhjZXB0\naW9uKGUpKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAg\nICAgICAgICB9CgogICAgICAgICAgICAgICAgSGVkd2lnU29ja2V0QWRkcmVz\ncyBvd25lciA9IG5ldyBIZWR3aWdTb2NrZXRBZGRyZXNzKG5ldyBTdHJpbmco\nZGF0YSkpOwogICAgICAgICAgICAgICAgaWYgKCFvd25lci5lcXVhbHMoYWRk\ncikpIHsKICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybigiV2FudGVk\nIHRvIGRlbGV0ZSBzZWxmLW5vZGUgZm9yIHRvcGljOiAiICsgdG9waWMudG9T\ndHJpbmdVdGY4KCkgKyAiIGJ1dCBub2RlIGZvciAiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgKyBvd25lciArICIgZm91bmQsIGxlYXZpbmcg\ndW50b3VjaGVkIik7CiAgICAgICAgICAgICAgICAgICAgLy8gTm90IG91ciBu\nb2RlLCBzb21lb25lIGVsc2UncywgbGVhdmUgaXQgYWxvbmUKICAgICAgICAg\nICAgICAgICAgICBjYi5vcGVyYXRpb25GaW5pc2hlZChjdHgsIG51bGwpOwog\nICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0K\nCiAgICAgICAgICAgICAgICB6ay5kZWxldGUocGF0aCwgc3RhdC5nZXRWZXJz\naW9uKCksIG5ldyBTYWZlQXN5bmNaS0NhbGxiYWNrLlZvaWRDYWxsYmFjaygp\nIHsKICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICBwdWJsaWMgdm9pZCBzYWZlUHJvY2Vzc1Jlc3VsdChpbnQgcmMs\nIFN0cmluZyBwYXRoLCBPYmplY3QgY3R4KSB7CiAgICAgICAgICAgICAgICAg\nICAgICAgIGlmIChyYyAhPSBDb2RlLk9LLmludFZhbHVlKCkgJiYgcmMgIT0g\nQ29kZS5OT05PREUuaW50VmFsdWUoKSkgewogICAgICAgICAgICAgICAgICAg\nICAgICAgICAgS2VlcGVyRXhjZXB0aW9uIGUgPSBaa1V0aWxzCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5sb2dF\ncnJvckFuZENyZWF0ZVpLRXhjZXB0aW9uKCJGYWlsZWQgdG8gZGVsZXRlIHNl\nbGYtb3duZXJzaGlwIG5vZGUgZm9yIHRvcGljOiAiCiAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKyB0\nb3BpYy50b1N0cmluZ1V0ZjgoKSwgcGF0aCwgcmMpOwogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgY2Iub3BlcmF0aW9uRmFpbGVkKGN0eCwgbmV3IFB1\nYlN1YkV4Y2VwdGlvbi5TZXJ2aWNlRG93bkV4Y2VwdGlvbihlKSk7CiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAg\nICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIGNiLm9wZXJh\ndGlvbkZpbmlzaGVkKGN0eCwgbnVsbCk7CiAgICAgICAgICAgICAgICAgICAg\nfQogICAgICAgICAgICAgICAgfSwgY3R4KTsKICAgICAgICAgICAgfQogICAg\nICAgIH0sIGN0eCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBwdWJsaWMg\ndm9pZCBzdG9wKCkgewogICAgICAgIC8vIHdlIGp1c3QgdW5yZWdpc3RlciBp\ndCB3aXRoIHpvb2tlZXBlciB0byBtYWtlIGl0IHVuYXZhaWxhYmxlIGZyb20g\naHViIHNlcnZlcnMgbGlzdAogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHVu\ncmVnaXN0ZXJXaXRoWm9va2VlcGVyKCk7CiAgICAgICAgfSBjYXRjaCAoSW50\nZXJydXB0ZWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICBsb2dnZXIuZXJy\nb3IoIkVycm9yIHVucmVnaXN0ZXJpbmcgaHViIHNlcnZlciA6IiwgZSk7CiAg\nICAgICAgfSBjYXRjaCAoS2VlcGVyRXhjZXB0aW9uIGUpIHsKICAgICAgICAg\nICAgbG9nZ2VyLmVycm9yKCJFcnJvciB1bnJlZ2lzdGVyaW5nIGh1YiBzZXJ2\nZXIgOiIsIGUpOwogICAgICAgIH0KICAgICAgICBzdXBlci5zdG9wKCk7CiAg\nICB9Cgp9Cg==\n","encoding":"base64"}

