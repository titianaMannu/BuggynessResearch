{"sha":"02b45032ff4c1c18ae845f1681f2ae7c679b576c","node_id":"MDQ6QmxvYjE1NzU5NTY6MDJiNDUwMzJmZjRjMWMxOGFlODQ1ZjE2ODFmMmFlN2M2NzliNTc2Yw==","size":31427,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/02b45032ff4c1c18ae845f1681f2ae7c679b576c","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuaW50ZWdyYXRpb247Cgpp\nbXBvcnQgamF2YS5uZXQuSW5ldFNvY2tldEFkZHJlc3M7CmltcG9ydCBqYXZh\nLnV0aWwuQXJyYXlzOwppbXBvcnQgamF2YS51dGlsLkNvbGxlY3Rpb247Cmlt\ncG9ydCBqYXZhLnV0aWwuSGFzaFNldDsKaW1wb3J0IGphdmEudXRpbC5jb25j\ndXJyZW50LlN5bmNocm9ub3VzUXVldWU7CgppbXBvcnQgb3JnLmp1bml0LkFm\ndGVyOwppbXBvcnQgb3JnLmp1bml0LkJlZm9yZTsKaW1wb3J0IG9yZy5qdW5p\ndC5UZXN0OwppbXBvcnQgb3JnLmp1bml0LnJ1bm5lci5SdW5XaXRoOwppbXBv\ncnQgb3JnLmp1bml0LnJ1bm5lcnMuUGFyYW1ldGVyaXplZDsKaW1wb3J0IG9y\nZy5qdW5pdC5ydW5uZXJzLlBhcmFtZXRlcml6ZWQuUGFyYW1ldGVyczsKCmlt\ncG9ydCBjb20uZ29vZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuYXBpLk1lc3NhZ2VIYW5kbGVyOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3JpYmVy\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuY2xpZW50LmNvbmYuQ2xpZW50\nQ29uZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLmNsaWVu\ndC5leGNlcHRpb25zLkludmFsaWRTdWJzY3JpYmVySWRFeGNlcHRpb247Cmlt\ncG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5jbGllbnQuZXhjZXB0aW9ucy5BbHJl\nYWR5U3RhcnREZWxpdmVyeUV4Y2VwdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLmNsaWVudC5IZWR3aWdDbGllbnQ7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5jbGllbnQuYXBpLkNsaWVudDsKaW1wb3J0IG9yZy5hcGFjaGUu\naGVkd2lnLmNsaWVudC5hcGkuUHVibGlzaGVyOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcuY2xpZW50LmFwaS5TdWJzY3JpYmVyOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcuZXhjZXB0aW9ucy5QdWJTdWJFeGNlcHRpb247CmltcG9y\ndCBvcmcuYXBhY2hlLmhlZHdpZy5leGNlcHRpb25zLlB1YlN1YkV4Y2VwdGlv\nbi5DbGllbnROb3RTdWJzY3JpYmVkRXhjZXB0aW9uOwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuTWVzc2FnZTsK\naW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3Rv\nY29sLk1lc3NhZ2VTZXFJZDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnBy\nb3RvY29sLlB1YlN1YlByb3RvY29sLk9wZXJhdGlvblR5cGU7CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5Qcm90\nb2NvbFZlcnNpb247CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5QdWJTdWJSZXF1ZXN0OwppbXBvcnQgb3JnLmFw\nYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuUHViU3ViUmVz\ncG9uc2U7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2NvbC5QdWJT\ndWJQcm90b2NvbC5TdGFydERlbGl2ZXJ5UmVxdWVzdDsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnByb3RvY29sLlB1YlN1YlByb3RvY29sLlN0b3BEZWxp\ndmVyeVJlcXVlc3Q7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy5wcm90b2Nv\nbC5QdWJTdWJQcm90b2NvbC5TdGF0dXNDb2RlOwppbXBvcnQgb3JnLmFwYWNo\nZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wuU3Vic2NyaWJlUmVx\ndWVzdC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2ln\nLnByb3RvZXh0ZW5zaW9ucy5TdWJzY3JpcHRpb25TdGF0ZVV0aWxzOwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLkhlZHdpZ0h1YlRlc3RCYXNl\nOwppbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcuc2VydmVyLm5ldHR5LldyaXRl\nUmVjb3JkaW5nQ2hhbm5lbDsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNl\ncnZlci5wcm94eS5IZWR3aWdQcm94eTsKaW1wb3J0IG9yZy5hcGFjaGUuaGVk\nd2lnLnNlcnZlci5wcm94eS5Qcm94eUNvbmZpZ3VyYXRpb247CmltcG9ydCBv\ncmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIucmVnaW9ucy5IZWR3aWdIdWJDbGll\nbnQ7CmltcG9ydCBvcmcuYXBhY2hlLmhlZHdpZy51dGlsLkNhbGxiYWNrOwpp\nbXBvcnQgb3JnLmFwYWNoZS5oZWR3aWcudXRpbC5Db25jdXJyZW5jeVV0aWxz\nOwoKQFJ1bldpdGgoUGFyYW1ldGVyaXplZC5jbGFzcykKcHVibGljIGNsYXNz\nIFRlc3RIZWR3aWdIdWIgZXh0ZW5kcyBIZWR3aWdIdWJUZXN0QmFzZSB7Cgog\nICAgLy8gQ2xpZW50IHNpZGUgdmFyaWFibGVzCiAgICBwcm90ZWN0ZWQgSGVk\nd2lnQ2xpZW50IGNsaWVudDsKICAgIHByb3RlY3RlZCBQdWJsaXNoZXIgcHVi\nbGlzaGVyOwogICAgcHJvdGVjdGVkIFN1YnNjcmliZXIgc3Vic2NyaWJlcjsK\nCiAgICAvLyBDb21tb24gQnl0ZVN0cmluZ3MgdXNlZCBpbiB0ZXN0cy4KICAg\nIHByaXZhdGUgZmluYWwgQnl0ZVN0cmluZyBsb2NhbFN1YnNjcmliZXJJZCA9\nIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJMb2NhbFN1YnNjcmliZXIiKTsK\nICAgIHByaXZhdGUgZmluYWwgQnl0ZVN0cmluZyBodWJTdWJzY3JpYmVySWQg\nPSBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOChTdWJzY3JpcHRpb25TdGF0ZVV0\naWxzLkhVQl9TVUJTQ1JJQkVSX1BSRUZJWAogICAgICAgICAgICArICJIdWJT\ndWJjcmliZXIiKTsKCiAgICBlbnVtIE1vZGUgewogICAgICAgIFJFR1VMQVIs\nIFBST1hZLCBTU0wKICAgIH07CgogICAgQFBhcmFtZXRlcnMKICAgIHB1Ymxp\nYyBzdGF0aWMgQ29sbGVjdGlvbjxPYmplY3RbXT4gY29uZmlncygpIHsKICAg\nICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdChuZXcgT2JqZWN0W11bXSB7IHsg\nTW9kZS5QUk9YWSB9LCB7IE1vZGUuUkVHVUxBUiB9LCB7IE1vZGUuU1NMIH19\nKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgTW9kZSBtb2RlOwoKICAgIHB1Ymxp\nYyBUZXN0SGVkd2lnSHViKE1vZGUgbW9kZSkgewogICAgICAgIHRoaXMubW9k\nZSA9IG1vZGU7CiAgICB9CgogICAgcHJvdGVjdGVkIEhlZHdpZ1Byb3h5IHBy\nb3h5OwogICAgcHJvdGVjdGVkIFByb3h5Q29uZmlndXJhdGlvbiBwcm94eUNv\nbmYgPSBuZXcgUHJveHlDb25maWd1cmF0aW9uKCk7CgogICAgLy8gU3luY2hy\nb25vdXNRdWV1ZXMgdG8gdmVyaWZ5IGFzeW5jIGNhbGxzCiAgICBwcml2YXRl\nIGZpbmFsIFN5bmNocm9ub3VzUXVldWU8Qm9vbGVhbj4gcXVldWUgPSBuZXcg\nU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPigpOwogICAgcHJpdmF0ZSBmaW5h\nbCBTeW5jaHJvbm91c1F1ZXVlPEJvb2xlYW4+IGNvbnN1bWVRdWV1ZSA9IG5l\ndyBTeW5jaHJvbm91c1F1ZXVlPEJvb2xlYW4+KCk7CgogICAgLy8gVGVzdCBp\nbXBsZW1lbnRhdGlvbiBvZiBDYWxsYmFjayBmb3IgYXN5bmMgY2xpZW50IGFj\ndGlvbnMuCiAgICBzdGF0aWMgY2xhc3MgVGVzdENhbGxiYWNrIGltcGxlbWVu\ndHMgQ2FsbGJhY2s8Vm9pZD4gewogICAgICAgIHByaXZhdGUgZmluYWwgU3lu\nY2hyb25vdXNRdWV1ZTxCb29sZWFuPiBxdWV1ZTsKCiAgICAgICAgcHVibGlj\nIFRlc3RDYWxsYmFjayhTeW5jaHJvbm91c1F1ZXVlPEJvb2xlYW4+IHF1ZXVl\nKSB7CiAgICAgICAgICAgIHRoaXMucXVldWUgPSBxdWV1ZTsKICAgICAgICB9\nCgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2b2lkIG9wZXJh\ndGlvbkZpbmlzaGVkKE9iamVjdCBjdHgsIFZvaWQgcmVzdWx0T2ZPcGVyYXRp\nb24pIHsKICAgICAgICAgICAgbmV3IFRocmVhZChuZXcgUnVubmFibGUoKSB7\nCiAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAgICAgIHB1\nYmxpYyB2b2lkIHJ1bigpIHsKICAgICAgICAgICAgICAgICAgICBpZiAobG9n\nZ2VyLmlzRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAgICAgICAgICAgICAg\nIGxvZ2dlci5kZWJ1ZygiT3BlcmF0aW9uIGZpbmlzaGVkISIpOwogICAgICAg\nICAgICAgICAgICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KHF1ZXVlLCB0cnVl\nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkuc3RhcnQoKTsK\nICAgICAgICB9CgogICAgICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyB2\nb2lkIG9wZXJhdGlvbkZhaWxlZChPYmplY3QgY3R4LCBmaW5hbCBQdWJTdWJF\neGNlcHRpb24gZXhjZXB0aW9uKSB7CiAgICAgICAgICAgIG5ldyBUaHJlYWQo\nbmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICAgICAgQE92ZXJyaWRlCiAg\nICAgICAgICAgICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAg\nICAgICAgICAgbG9nZ2VyLmVycm9yKCJPcGVyYXRpb24gZmFpbGVkISIsIGV4\nY2VwdGlvbik7CiAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGls\ncy5wdXQocXVldWUsIGZhbHNlKTsKICAgICAgICAgICAgICAgIH0KICAgICAg\nICAgICAgfSkuc3RhcnQoKTsKICAgICAgICB9CiAgICB9CgogICAgLy8gVGVz\ndCBpbXBsZW1lbnRhdGlvbiBvZiBzdWJzY3JpYmVyJ3MgbWVzc2FnZSBoYW5k\nbGVyLgogICAgc3RhdGljIGNsYXNzIFRlc3RNZXNzYWdlSGFuZGxlciBpbXBs\nZW1lbnRzIE1lc3NhZ2VIYW5kbGVyIHsKICAgICAgICAvLyBGb3Igc3Vic2Ny\naWJlIHJlY29ubmVjdCB0ZXN0aW5nLCB0aGUgc2VydmVyIGNvdWxkIHNlbmQg\ndXMgYmFjawogICAgICAgIC8vIG1lc3NhZ2VzIHdlJ3ZlIGFscmVhZHkgcHJv\nY2Vzc2VkIGFuZCBjb25zdW1lZC4gV2UgbmVlZCB0byBrZWVwCiAgICAgICAg\nLy8gdHJhY2sgb2YgdGhlIG9uZXMgd2UndmUgZW5jb3VudGVyZWQgc28gd2Ug\nb25seSBzaWduYWwgYmFjayB0byB0aGUKICAgICAgICAvLyBjb25zdW1lUXVl\ndWUgb25jZS4KICAgICAgICBwcml2YXRlIEhhc2hTZXQ8TWVzc2FnZVNlcUlk\nPiBjb25zdW1lZE1lc3NhZ2VzID0gbmV3IEhhc2hTZXQ8TWVzc2FnZVNlcUlk\nPigpOwogICAgICAgIHByaXZhdGUgbG9uZyBsYXJnZXN0TXNnU2VxSWRDb25z\ndW1lZCA9IC0xOwogICAgICAgIHByaXZhdGUgZmluYWwgU3luY2hyb25vdXNR\ndWV1ZTxCb29sZWFuPiBjb25zdW1lUXVldWU7CgogICAgICAgIHB1YmxpYyBU\nZXN0TWVzc2FnZUhhbmRsZXIoU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPiBj\nb25zdW1lUXVldWUpIHsKICAgICAgICAgICAgdGhpcy5jb25zdW1lUXVldWUg\nPSBjb25zdW1lUXVldWU7CiAgICAgICAgfQoKICAgICAgICBwdWJsaWMgdm9p\nZCBkZWxpdmVyKEJ5dGVTdHJpbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2Ny\naWJlcklkLCBmaW5hbCBNZXNzYWdlIG1zZywgQ2FsbGJhY2s8Vm9pZD4gY2Fs\nbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QgY29u\ndGV4dCkgewogICAgICAgICAgICBpZiAoIWNvbnN1bWVkTWVzc2FnZXMuY29u\ndGFpbnMobXNnLmdldE1zZ0lkKCkpKSB7CiAgICAgICAgICAgICAgICAvLyBO\nZXcgbWVzc2FnZSB0byBjb25zdW1lLiBBZGQgaXQgdG8gdGhlIFNldCBvZiBj\nb25zdW1lZAogICAgICAgICAgICAgICAgLy8gbWVzc2FnZXMuCiAgICAgICAg\nICAgICAgICBjb25zdW1lZE1lc3NhZ2VzLmFkZChtc2cuZ2V0TXNnSWQoKSk7\nCiAgICAgICAgICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSBtc2cgc2VxIElE\nIGlzIGluY3JlbWVudGluZyBieSAxIGNvbXBhcmVkIHRvCiAgICAgICAgICAg\nICAgICAvLyB0aGUgbGFzdCBjb25zdW1lZCBtZXNzYWdlLiBEb24ndCBkbyB0\naGlzIGNoZWNrIGlmIHRoaXMgaXMgdGhlCiAgICAgICAgICAgICAgICAvLyBp\nbml0aWFsIG1lc3NhZ2UgYmVpbmcgY29uc3VtZWQuCiAgICAgICAgICAgICAg\nICBpZiAobGFyZ2VzdE1zZ1NlcUlkQ29uc3VtZWQgPj0gMCAmJiBtc2cuZ2V0\nTXNnSWQoKS5nZXRMb2NhbENvbXBvbmVudCgpICE9IGxhcmdlc3RNc2dTZXFJ\nZENvbnN1bWVkICsgMSkgewogICAgICAgICAgICAgICAgICAgIG5ldyBUaHJl\nYWQobmV3IFJ1bm5hYmxlKCkgewogICAgICAgICAgICAgICAgICAgICAgICBA\nT3ZlcnJpZGUKICAgICAgICAgICAgICAgICAgICAgICAgcHVibGljIHZvaWQg\ncnVuKCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvZ2dl\nci5pc0RlYnVnRW5hYmxlZCgpKQogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIGxvZ2dlci5kZWJ1ZygiQ29uc3VtaW5nIG1lc3NhZ2UgdGhhdCBp\ncyBvdXQgb2Ygb3JkZXIgZm9yIG1zZ0lkOiAiCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICsgbXNnLmdldE1zZ0lkKCku\nZ2V0TG9jYWxDb21wb25lbnQoKSk7CiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBDb25jdXJyZW5jeVV0aWxzLnB1dChjb25zdW1lUXVldWUsIGZhbHNl\nKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAg\nICAgIH0pLnN0YXJ0KCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAg\nICAgICAgICAgICAgICAgIG5ldyBUaHJlYWQobmV3IFJ1bm5hYmxlKCkgewog\nICAgICAgICAgICAgICAgICAgICAgICBAT3ZlcnJpZGUKICAgICAgICAgICAg\nICAgICAgICAgICAgcHVibGljIHZvaWQgcnVuKCkgewogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1Zygi\nQ29uc3VtZSBvcGVyYXRpb24gZmluaXNoZWQgc3VjY2Vzc2Z1bGx5ISIpOwog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgQ29uY3VycmVuY3lVdGlscy5w\ndXQoY29uc3VtZVF1ZXVlLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAg\nICAgfQogICAgICAgICAgICAgICAgICAgIH0pLnN0YXJ0KCk7CiAgICAgICAg\nICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBTdG9yZSB0aGUgY29uc3Vt\nZWQgbWVzc2FnZSBhcyB0aGUgbmV3IGxhc3QgbXNnIGlkIGNvbnN1bWVkLgog\nICAgICAgICAgICAgICAgbGFyZ2VzdE1zZ1NlcUlkQ29uc3VtZWQgPSBtc2cu\nZ2V0TXNnSWQoKS5nZXRMb2NhbENvbXBvbmVudCgpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGxvZ2dlci5pc0RlYnVnRW5h\nYmxlZCgpKQogICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygiQ29u\nc3VtZWQgYSBtZXNzYWdlIHRoYXQgd2UndmUgcHJvY2Vzc2VkIGFscmVhZHk6\nICIgKyBtc2cpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNhbGxiYWNr\nLm9wZXJhdGlvbkZpbmlzaGVkKGNvbnRleHQsIG51bGwpOwogICAgICAgIH0K\nICAgIH0KCiAgICBjbGFzcyBUZXN0Q2xpZW50Q29uZmlndXJhdGlvbiBleHRl\nbmRzIENsaWVudENvbmZpZ3VyYXRpb24gewogICAgICAgIEBPdmVycmlkZQog\nICAgICAgIHB1YmxpYyBJbmV0U29ja2V0QWRkcmVzcyBnZXREZWZhdWx0U2Vy\ndmVySG9zdCgpIHsKICAgICAgICAgICAgaWYgKG1vZGUgPT0gTW9kZS5QUk9Y\nWSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBJbmV0U29ja2V0QWRk\ncmVzcyhwcm94eUNvbmYuZ2V0UHJveHlQb3J0KCkpOwogICAgICAgICAgICB9\nIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyLmdldERlZmF1\nbHRTZXJ2ZXJIb3N0KCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIEBPdmVycmlkZQogICAgICAgIHB1YmxpYyBib29sZWFuIGlzU1NMRW5h\nYmxlZCgpIHsKICAgICAgICAgICAgaWYgKG1vZGUgPT0gTW9kZS5TU0wpCiAg\nICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZWxzZQog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgIH0K\nCiAgICAvLyBDbGllbnRDb25maWd1cmF0aW9uIHRvIHVzZSBmb3IgdGhpcyB0\nZXN0LgogICAgcHJvdGVjdGVkIENsaWVudENvbmZpZ3VyYXRpb24gZ2V0Q2xp\nZW50Q29uZmlndXJhdGlvbigpIHsKICAgICAgICByZXR1cm4gbmV3IFRlc3RD\nbGllbnRDb25maWd1cmF0aW9uKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAg\nICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBzZXRVcCgpIHRocm93cyBFeGNl\ncHRpb24gewogICAgICAgIG51bVNlcnZlcnMgPSAzOwogICAgICAgIHN1cGVy\nLnNldFVwKCk7CiAgICAgICAgaWYgKG1vZGUgPT0gTW9kZS5QUk9YWSkgewog\nICAgICAgICAgICBwcm94eSA9IG5ldyBIZWR3aWdQcm94eShwcm94eUNvbmYp\nOwogICAgICAgICAgICBwcm94eS5zdGFydCgpOwogICAgICAgIH0KICAgICAg\nICBjbGllbnQgPSBuZXcgSGVkd2lnQ2xpZW50KGdldENsaWVudENvbmZpZ3Vy\nYXRpb24oKSk7CiAgICAgICAgcHVibGlzaGVyID0gY2xpZW50LmdldFB1Ymxp\nc2hlcigpOwogICAgICAgIHN1YnNjcmliZXIgPSBjbGllbnQuZ2V0U3Vic2Ny\naWJlcigpOwogICAgfQoKICAgIEBPdmVycmlkZQogICAgQEFmdGVyCiAgICBw\ndWJsaWMgdm9pZCB0ZWFyRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAg\nICAgIGNsaWVudC5jbG9zZSgpOwogICAgICAgIGlmIChtb2RlID09IE1vZGUu\nUFJPWFkpIHsKICAgICAgICAgICAgcHJveHkuc2h1dGRvd24oKTsKICAgICAg\nICB9CiAgICAgICAgc3VwZXIudGVhckRvd24oKTsKCiAgICB9CgogICAgLy8g\nSGVscGVyIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIE1lc3NhZ2VzCiAgICBwcm90\nZWN0ZWQgTWVzc2FnZSBnZXRNc2coaW50IG1zZ051bSkgewogICAgICAgIHJl\ndHVybiBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5KEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJNZXNzYWdlIiArIG1zZ051bSkpLmJ1aWxkKCk7CiAg\nICB9CgogICAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIFRvcGlj\ncwogICAgcHJvdGVjdGVkIEJ5dGVTdHJpbmcgZ2V0VG9waWMoaW50IHRvcGlj\nTnVtKSB7CiAgICAgICAgcmV0dXJuIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4\nKCJUb3BpYyIgKyB0b3BpY051bSk7CiAgICB9CgogICAgcHJvdGVjdGVkIHZv\naWQgc3RhcnREZWxpdmVyeShCeXRlU3RyaW5nIHRvcGljLCBCeXRlU3RyaW5n\nIHN1YnNjcmliZXJJZCwgTWVzc2FnZUhhbmRsZXIgaGFuZGxlcikgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgc3RhcnREZWxpdmVyeShzdWJzY3JpYmVy\nLCB0b3BpYywgc3Vic2NyaWJlcklkLCBoYW5kbGVyKTsKICAgIH0KCiAgICBw\ncm90ZWN0ZWQgdm9pZCBzdGFydERlbGl2ZXJ5KFN1YnNjcmliZXIgc3Vic2Ny\naWJlciwgQnl0ZVN0cmluZyB0b3BpYywgQnl0ZVN0cmluZyBzdWJzY3JpYmVy\nSWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1lc3NhZ2VI\nYW5kbGVyIGhhbmRsZXIpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIHN1\nYnNjcmliZXIuc3RhcnREZWxpdmVyeSh0b3BpYywgc3Vic2NyaWJlcklkLCBo\nYW5kbGVyKTsKICAgICAgICBpZiAobW9kZSA9PSBNb2RlLlBST1hZKSB7CiAg\nICAgICAgICAgIFdyaXRlUmVjb3JkaW5nQ2hhbm5lbCBjaGFubmVsID0gbmV3\nIFdyaXRlUmVjb3JkaW5nQ2hhbm5lbCgpOwogICAgICAgICAgICBQdWJTdWJS\nZXF1ZXN0IHJlcXVlc3QgPSBQdWJTdWJSZXF1ZXN0Lm5ld0J1aWxkZXIoKS5z\nZXRQcm90b2NvbFZlcnNpb24oUHJvdG9jb2xWZXJzaW9uLlZFUlNJT05fT05F\nKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0VG9w\naWModG9waWMpLnNldFR4bklkKDApLnNldFR5cGUoT3BlcmF0aW9uVHlwZS5T\nVEFSVF9ERUxJVkVSWSkuc2V0U3RhcnREZWxpdmVyeVJlcXVlc3QoCiAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTdGFydERlbGl2\nZXJ5UmVxdWVzdC5uZXdCdWlsZGVyKCkuc2V0U3Vic2NyaWJlcklkKHN1YnNj\ncmliZXJJZCkpLmJ1aWxkKCk7CiAgICAgICAgICAgIHByb3h5LmdldFN0YXJ0\nRGVsaXZlcnlIYW5kbGVyKCkuaGFuZGxlUmVxdWVzdChyZXF1ZXN0LCBjaGFu\nbmVsKTsKICAgICAgICAgICAgYXNzZXJ0RXF1YWxzKFN0YXR1c0NvZGUuU1VD\nQ0VTUywgKChQdWJTdWJSZXNwb25zZSkgY2hhbm5lbC5nZXRNZXNzYWdlc1dy\naXR0ZW4oKS5nZXQoMCkpLmdldFN0YXR1c0NvZGUoKSk7CiAgICAgICAgfQog\nICAgfQoKICAgIHByb3RlY3RlZCB2b2lkIHN0b3BEZWxpdmVyeShCeXRlU3Ry\naW5nIHRvcGljLCBCeXRlU3RyaW5nIHN1YnNjcmliZXJJZCkgdGhyb3dzIEV4\nY2VwdGlvbiB7CiAgICAgICAgc3RvcERlbGl2ZXJ5KHN1YnNjcmliZXIsIHRv\ncGljLCBzdWJzY3JpYmVySWQpOwogICAgfQoKICAgIHByb3RlY3RlZCB2b2lk\nIHN0b3BEZWxpdmVyeShTdWJzY3JpYmVyIHN1YnNjcmliZXIsIEJ5dGVTdHJp\nbmcgdG9waWMsIEJ5dGVTdHJpbmcgc3Vic2NyaWJlcklkKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBzdWJzY3JpYmVyLnN0b3BEZWxpdmVyeSh0b3Bp\nYywgc3Vic2NyaWJlcklkKTsKICAgICAgICBpZiAobW9kZSA9PSBNb2RlLlBS\nT1hZKSB7CiAgICAgICAgICAgIFB1YlN1YlJlcXVlc3QgcmVxdWVzdCA9IFB1\nYlN1YlJlcXVlc3QubmV3QnVpbGRlcigpLnNldFByb3RvY29sVmVyc2lvbihQ\ncm90b2NvbFZlcnNpb24uVkVSU0lPTl9PTkUpCiAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC5zZXRUb3BpYyh0b3BpYykuc2V0VHhuSWQo\nMSkuc2V0VHlwZShPcGVyYXRpb25UeXBlLlNUT1BfREVMSVZFUlkpLnNldFN0\nb3BEZWxpdmVyeVJlcXVlc3QoCiAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICBTdG9wRGVsaXZlcnlSZXF1ZXN0Lm5ld0J1aWxkZXIo\nKS5zZXRTdWJzY3JpYmVySWQoc3Vic2NyaWJlcklkKSkuYnVpbGQoKTsKICAg\nICAgICAgICAgcHJveHkuZ2V0U3RvcERlbGl2ZXJ5SGFuZGxlcigpLmhhbmRs\nZVJlcXVlc3QocmVxdWVzdCwgcHJveHkuZ2V0Q2hhbm5lbFRyYWNrZXIoKS5n\nZXRDaGFubmVsKHRvcGljLCBzdWJzY3JpYmVySWQpKTsKICAgICAgICB9CiAg\nICB9CgogICAgcHJvdGVjdGVkIHZvaWQgcHVibGlzaEJhdGNoKGludCBiYXRj\naFNpemUsIGJvb2xlYW4gZXhwZWN0ZWQsIGJvb2xlYW4gbWVzc2FnZXNUb0Jl\nQ29uc3VtZWQsIGludCBsb29wKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAg\nICBpZiAobG9nZ2VyLmlzRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAgIGxv\nZ2dlci5kZWJ1ZygiUHVibGlzaGluZyAiICsgbG9vcCArICIgYmF0Y2ggb2Yg\nbWVzc2FnZXMuIik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXRj\naFNpemU7IGkrKykgewogICAgICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJs\naXNoKGdldFRvcGljKGkpLCBnZXRNc2coaSArIGxvb3AgKiBiYXRjaFNpemUp\nLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAgICAg\nIGFzc2VydFRydWUoZXhwZWN0ZWQgPT0gcXVldWUudGFrZSgpKTsKICAgICAg\nICAgICAgaWYgKG1lc3NhZ2VzVG9CZUNvbnN1bWVkKQogICAgICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgpKTsKICAgICAgICB9\nCiAgICB9CgogICAgcHJvdGVjdGVkIHZvaWQgc3Vic2NyaWJlVG9Ub3BpY3Mo\naW50IGJhdGNoU2l6ZSkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaWYg\nKGxvZ2dlci5pc0RlYnVnRW5hYmxlZCgpKQogICAgICAgICAgICBsb2dnZXIu\nZGVidWcoIlN1YnNjcmliaW5nIHRvIHRvcGljcyBhbmQgc3RhcnRpbmcgZGVs\naXZlcnkuIik7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXRjaFNp\nemU7IGkrKykgewogICAgICAgICAgICBzdWJzY3JpYmVyLmFzeW5jU3Vic2Ny\naWJlKGdldFRvcGljKGkpLCBsb2NhbFN1YnNjcmliZXJJZCwgQ3JlYXRlT3JB\ndHRhY2guQ1JFQVRFX09SX0FUVEFDSCwKICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVs\nbCk7CiAgICAgICAgICAgIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAg\nICAgICB9CgogICAgICAgIC8vIFN0YXJ0IGRlbGl2ZXJ5IGZvciB0aGUgc3Vi\nc2NyaWJlcgogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0Y2hTaXpl\nOyBpKyspIHsKICAgICAgICAgICAgc3RhcnREZWxpdmVyeShnZXRUb3BpYyhp\nKSwgbG9jYWxTdWJzY3JpYmVySWQsIG5ldyBUZXN0TWVzc2FnZUhhbmRsZXIo\nY29uc3VtZVF1ZXVlKSk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3Rl\nZCB2b2lkIHNodXREb3duTGFzdFNlcnZlcigpIHsKICAgICAgICBpZiAobG9n\nZ2VyLmlzRGVidWdFbmFibGVkKCkpCiAgICAgICAgICAgIGxvZ2dlci5kZWJ1\nZygiU2h1dHRpbmcgZG93biB0aGUgbGFzdCBzZXJ2ZXIgaW4gdGhlIEhlZHdp\nZyBodWIgY2x1c3Rlci4iKTsKICAgICAgICBzZXJ2ZXJzTGlzdC5nZXQoc2Vy\ndmVyc0xpc3Quc2l6ZSgpIC0gMSkuc2h1dGRvd24oKTsKICAgICAgICAvLyBE\ndWUgdG8gYSBwb3NzaWJsZSByYWNlIGNvbmRpdGlvbiwgYWZ0ZXIgd2UndmUg\nc2h1dGRvd24gdGhlIHNlcnZlciwKICAgICAgICAvLyB0aGUgY2xpZW50IGNv\ndWxkIHN0aWxsIGJlIGNhY2hpbmcgdGhlIGNoYW5uZWwgY29ubmVjdGlvbiB0\nbyB0aGF0CiAgICAgICAgLy8gc2VydmVyLiBJdCBpcyBwb3NzaWJsZSBmb3Ig\nYSBwdWJsaXNoIHJlcXVlc3QgdG8gZ28gdG8gdGhlIHNodXRkb3duCiAgICAg\nICAgLy8gc2VydmVyIHVzaW5nIHRoZSBjbG9zZWQvc2h1dGRvd24gY2hhbm5l\nbCBiZWZvcmUgdGhlIGNoYW5uZWwKICAgICAgICAvLyBkaXNjb25uZWN0IGxv\nZ2ljIGtpY2tzIGluLiBXaGF0IGNvdWxkIGhhcHBlbiBpcyB0aGF0IHRoZSBw\ndWJsaXNoCiAgICAgICAgLy8gaXMgZG9uZSBzdWNjZXNzZnVsbHkgb24gdGhl\nIGNoYW5uZWwgYnV0IHRoZSBzZXJ2ZXIgb24gdGhlIG90aGVyIGVuZAogICAg\nICAgIC8vIGNhbid0L3dvbid0IHJlYWQgaXQuIFRoaXMgcHVibGlzaCByZXF1\nZXN0IHdpbGwgdGltZSBvdXQgYW5kIHRoZQogICAgICAgIC8vIEp1bml0IHRl\nc3Qgd2lsbCBmYWlsLiBTaW5jZSB0aGF0IHBhcnRpY3VsYXIgc2NlbmFyaW8g\naXMgbm90IHdoYXQgaXMKICAgICAgICAvLyB0ZXN0ZWQgaGVyZSwgdXNlIGEg\nd29ya2Fyb3VuZCBvZiBzbGVlcGluZyBpbiB0aGlzIHRocmVhZCAoc28gdGhl\nCiAgICAgICAgLy8gY2hhbm5lbCBkaXNjb25uZWN0IGxvZ2ljIGNhbiBjb21w\nbGV0ZSkgYmVmb3JlIHdlIHB1Ymxpc2ggYWdhaW4uCiAgICAgICAgdHJ5IHsK\nICAgICAgICAgICAgVGhyZWFkLnNsZWVwKDEwMDApOwogICAgICAgIH0gY2F0\nY2ggKEludGVycnVwdGVkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgbG9n\nZ2VyLmVycm9yKCJUaHJlYWQgd2FzIGludGVycnVwdGVkIHdoaWxlIHNsZWVw\naW5nIGFmdGVyIHNodXR0aW5nIGRvd24gbGFzdCBzZXJ2ZXIhIiwgZSk7CiAg\nICAgICAgfQogICAgfQoKICAgIC8vIFRoaXMgdGVzdHMgb3V0IHRoZSBtYW51\nYWwgc2VuZGluZyBvZiBjb25zdW1lIG1lc3NhZ2VzIHRvIHRoZSBzZXJ2ZXIK\nICAgIC8vIGluc3RlYWQgb2YgcmVseWluZyBvbiB0aGUgYXV0b21hdGljIHNl\nbmRpbmcgYnkgdGhlIGNsaWVudCBsaWIgZm9yIGl0LgogICAgQFRlc3QKICAg\nIHB1YmxpYyB2b2lkIHRlc3RNYW51YWxDb25zdW1lQ2xpZW50KCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgSGVkd2lnQ2xpZW50IG15Q2xpZW50ID0g\nbmV3IEhlZHdpZ0NsaWVudChuZXcgVGVzdENsaWVudENvbmZpZ3VyYXRpb24o\nKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAgICAgICBwdWJsaWMg\nYm9vbGVhbiBpc0F1dG9TZW5kQ29uc3VtZU1lc3NhZ2VFbmFibGVkKCkgewog\nICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9Cgog\nICAgICAgIH0pOwogICAgICAgIFN1YnNjcmliZXIgbXlTdWJzY3JpYmVyID0g\nbXlDbGllbnQuZ2V0U3Vic2NyaWJlcigpOwogICAgICAgIFB1Ymxpc2hlciBt\neVB1Ymxpc2hlciA9IG15Q2xpZW50LmdldFB1Ymxpc2hlcigpOwogICAgICAg\nIEJ5dGVTdHJpbmcgbXlUb3BpYyA9IGdldFRvcGljKDApOwogICAgICAgIC8v\nIFN1YnNjcmliZSB0byBhIHRvcGljIGFuZCBzdGFydCBkZWxpdmVyeSBvbiBp\ndAogICAgICAgIG15U3Vic2NyaWJlci5hc3luY1N1YnNjcmliZShteVRvcGlj\nLCBsb2NhbFN1YnNjcmliZXJJZCwgQ3JlYXRlT3JBdHRhY2guQ1JFQVRFX09S\nX0FUVEFDSCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nbmV3IFRlc3RDYWxsYmFjayhxdWV1ZSksIG51bGwpOwogICAgICAgIGFzc2Vy\ndFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBzdGFydERlbGl2ZXJ5KG15\nU3Vic2NyaWJlciwgbXlUb3BpYywgbG9jYWxTdWJzY3JpYmVySWQsIG5ldyBU\nZXN0TWVzc2FnZUhhbmRsZXIoY29uc3VtZVF1ZXVlKSk7CiAgICAgICAgLy8g\nUHVibGlzaCBzb21lIG1lc3NhZ2VzCiAgICAgICAgaW50IGJhdGNoU2l6ZSA9\nIDEwOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0Y2hTaXplOyBp\nKyspIHsKICAgICAgICAgICAgbXlQdWJsaXNoZXIuYXN5bmNQdWJsaXNoKG15\nVG9waWMsIGdldE1zZyhpKSwgbmV3IFRlc3RDYWxsYmFjayhxdWV1ZSksIG51\nbGwpOwogICAgICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAg\nICAgICAgICAgIGFzc2VydFRydWUoY29uc3VtZVF1ZXVlLnRha2UoKSk7CiAg\nICAgICAgfQogICAgICAgIC8vIE5vdyBtYW51YWxseSBzZW5kIGEgY29uc3Vt\nZSBtZXNzYWdlIGZvciBlYWNoIG1lc3NhZ2UgcmVjZWl2ZWQKICAgICAgICBm\nb3IgKGludCBpID0gMDsgaSA8IGJhdGNoU2l6ZTsgaSsrKSB7CiAgICAgICAg\nICAgIGJvb2xlYW4gc3VjY2VzcyA9IHRydWU7CiAgICAgICAgICAgIHRyeSB7\nCiAgICAgICAgICAgICAgICBteVN1YnNjcmliZXIuY29uc3VtZShteVRvcGlj\nLCBsb2NhbFN1YnNjcmliZXJJZCwgTWVzc2FnZVNlcUlkLm5ld0J1aWxkZXIo\nKS5zZXRMb2NhbENvbXBvbmVudChpICsgMSkKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgIC5idWlsZCgpKTsKICAgICAgICAgICAgfSBj\nYXRjaCAoQ2xpZW50Tm90U3Vic2NyaWJlZEV4Y2VwdGlvbiBlKSB7CiAgICAg\nICAgICAgICAgICBzdWNjZXNzID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZShzdWNjZXNzKTsKICAgICAgICB9CiAgICAg\nICAgLy8gU2luY2UgdGhlIGNvbnN1bWUgY2FsbCBldmVudHVhbGx5IGRvZXMg\nYW4gYXN5bmMgd3JpdGUgdG8gdGhlIE5ldHR5CiAgICAgICAgLy8gY2hhbm5l\nbCwgdGhlIHdyaXRpbmcgb2YgdGhlIGNvbnN1bWUgcmVxdWVzdHMgbWF5IG5v\ndCBoYXZlIGNvbXBsZXRlZAogICAgICAgIC8vIHlldCBiZWZvcmUgd2Ugc3Rv\ncCB0aGUgY2xpZW50LiBTbGVlcCBhIGxpdHRsZSBiZWZvcmUgd2Ugc3RvcCB0\naGUKICAgICAgICAvLyBjbGllbnQganVzdCBzbyBlcnJvciBtZXNzYWdlcyBh\ncmUgbm90IGxvZ2dlZC4KICAgICAgICB0cnkgewogICAgICAgICAgICBUaHJl\nYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgfSBjYXRjaCAoSW50ZXJydXB0ZWRF\neGNlcHRpb24gZSkgewogICAgICAgICAgICBsb2dnZXIuZXJyb3IoIlRocmVh\nZCB3YXMgaW50ZXJydXB0ZWQgd2hpbGUgd2FpdGluZyB0byBzdG9wIGNsaWVu\ndCBmb3IgbWFudWFsIGNvbnN1bWUgdGVzdCEhIiwgZSk7CiAgICAgICAgfQog\nICAgICAgIG15Q2xpZW50LmNsb3NlKCk7CiAgICB9CgogICAgQFRlc3QKICAg\nIHB1YmxpYyB2b2lkIHRlc3RBdHRhY2hUb1N1YnNjcmlwdGlvblN1Y2Nlc3Mo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGlj\nID0gZ2V0VG9waWMoMCk7CiAgICAgICAgc3Vic2NyaWJlci5hc3luY1N1YnNj\ncmliZSh0b3BpYywgbG9jYWxTdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0YWNo\nLkNSRUFURV9PUl9BVFRBQ0gsIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAgICAg\nICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIC8vIENsb3Nl\nIHRoZSBzdWJzY3JpcHRpb24gYXN5bmNocm9ub3VzbHkKICAgICAgICBzdWJz\nY3JpYmVyLmFzeW5jQ2xvc2VTdWJzY3JpcHRpb24odG9waWMsIGxvY2FsU3Vi\nc2NyaWJlcklkLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAg\nICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIC8vIE5v\ndyB0cnkgdG8gYXR0YWNoIHRvIHRoZSBzdWJzY3JpcHRpb24KICAgICAgICBz\ndWJzY3JpYmVyLmFzeW5jU3Vic2NyaWJlKHRvcGljLCBsb2NhbFN1YnNjcmli\nZXJJZCwgQ3JlYXRlT3JBdHRhY2guQVRUQUNILCBuZXcgVGVzdENhbGxiYWNr\nKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtl\nKCkpOwogICAgICAgIC8vIFN0YXJ0IGRlbGl2ZXJ5IGFuZCBwdWJsaXNoIHNv\nbWUgbWVzc2FnZXMuIE1ha2Ugc3VyZSB0aGV5IGFyZSBjb25zdW1lZAogICAg\nICAgIC8vIGNvcnJlY3RseS4KICAgICAgICBzdGFydERlbGl2ZXJ5KHRvcGlj\nLCBsb2NhbFN1YnNjcmliZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcihj\nb25zdW1lUXVldWUpKTsKICAgICAgICBpbnQgYmF0Y2hTaXplID0gNTsKICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhdGNoU2l6ZTsgaSsrKSB7CiAg\nICAgICAgICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMsIGdldE1z\nZyhpKSwgbmV3IFRlc3RDYWxsYmFjayhxdWV1ZSksIG51bGwpOwogICAgICAg\nICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAgICAgIGFz\nc2VydFRydWUoY29uc3VtZVF1ZXVlLnRha2UoKSk7CiAgICAgICAgfQogICAg\nfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0U2VydmVyUmVkaXJl\nY3QoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgYmF0Y2hTaXpl\nID0gMTA7CiAgICAgICAgcHVibGlzaEJhdGNoKGJhdGNoU2l6ZSwgdHJ1ZSwg\nZmFsc2UsIDApOwogICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0\nZXN0U3Vic2NyaWJlQW5kQ29uc3VtZSgpIHRocm93cyBFeGNlcHRpb24gewog\nICAgICAgIGludCBiYXRjaFNpemUgPSAxMDsKICAgICAgICBzdWJzY3JpYmVU\nb1RvcGljcyhiYXRjaFNpemUpOwogICAgICAgIHB1Ymxpc2hCYXRjaChiYXRj\naFNpemUsIHRydWUsIHRydWUsIDApOwogICAgfQoKICAgIEBUZXN0CiAgICBw\ndWJsaWMgdm9pZCB0ZXN0U2VydmVyRmFpbG92ZXJQdWJsaXNoT25seSgpIHRo\ncm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBiYXRjaFNpemUgPSAxMDsK\nICAgICAgICBwdWJsaXNoQmF0Y2goYmF0Y2hTaXplLCB0cnVlLCBmYWxzZSwg\nMCk7CiAgICAgICAgc2h1dERvd25MYXN0U2VydmVyKCk7CiAgICAgICAgcHVi\nbGlzaEJhdGNoKGJhdGNoU2l6ZSwgdHJ1ZSwgZmFsc2UsIDEpOwogICAgfQoK\nICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0U2VydmVyRmFpbG92ZXIo\nKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBpbnQgYmF0Y2hTaXplID0g\nMTA7CiAgICAgICAgc3Vic2NyaWJlVG9Ub3BpY3MoYmF0Y2hTaXplKTsKICAg\nICAgICBwdWJsaXNoQmF0Y2goYmF0Y2hTaXplLCB0cnVlLCB0cnVlLCAwKTsK\nICAgICAgICBzaHV0RG93bkxhc3RTZXJ2ZXIoKTsKICAgICAgICBwdWJsaXNo\nQmF0Y2goYmF0Y2hTaXplLCB0cnVlLCB0cnVlLCAxKTsKICAgIH0KCiAgICBA\nVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFVuc3Vic2NyaWJlKCkgdGhyb3dz\nIEV4Y2VwdGlvbiB7CiAgICAgICAgQnl0ZVN0cmluZyB0b3BpYyA9IGdldFRv\ncGljKDApOwogICAgICAgIHN1YnNjcmliZXIuYXN5bmNTdWJzY3JpYmUodG9w\naWMsIGxvY2FsU3Vic2NyaWJlcklkLCBDcmVhdGVPckF0dGFjaC5DUkVBVEVf\nT1JfQVRUQUNILCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwKICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG51bGwpOwogICAgICAgIGFzc2Vy\ndFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBzdGFydERlbGl2ZXJ5KHRv\ncGljLCBsb2NhbFN1YnNjcmliZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxl\ncihjb25zdW1lUXVldWUpKTsKICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJs\naXNoKHRvcGljLCBnZXRNc2coMCksIG5ldyBUZXN0Q2FsbGJhY2socXVldWUp\nLCBudWxsKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAg\nICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgpKTsKICAgICAg\nICAvLyBTZW5kIGFuIFVuc3Vic2NyaWJlIHJlcXVlc3QKICAgICAgICBzdWJz\nY3JpYmVyLmFzeW5jVW5zdWJzY3JpYmUodG9waWMsIGxvY2FsU3Vic2NyaWJl\ncklkLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAg\nYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIC8vIE5vdyBwdWJs\naXNoIGEgbWVzc2FnZSBhbmQgbWFrZSBzdXJlIGl0IGlzIG5vdCBjb25zdW1l\nZCBieSB0aGUgY2xpZW50CiAgICAgICAgcHVibGlzaGVyLmFzeW5jUHVibGlz\naCh0b3BpYywgZ2V0TXNnKDEpLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwg\nbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAg\nICAgIC8vIFdhaXQgYSBsaXR0bGUgYml0IGp1c3QgaW4gY2FzZSB0aGUgbWVz\nc2FnZSBoYW5kbGVyIGlzIHN0aWxsIGFjdGl2ZSwKICAgICAgICAvLyBjb25z\ndW1pbmcgdGhlIG1lc3NhZ2UsIGFuZCB0aGVuIHB1dHRpbmcgYSB0cnVlIHZh\nbHVlIGluIHRoZQogICAgICAgIC8vIGNvbnN1bWVRdWV1ZS4KICAgICAgICBU\naHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgLy8gUHV0IGEgRmFsc2UgdmFs\ndWUgb24gdGhlIGNvbnN1bWVRdWV1ZSBzbyB3ZSBjYW4gdmVyaWZ5IHRoYXQg\naXQKICAgICAgICAvLyBpcyBub3QgYmxvY2tlZCBieSBhIG1lc3NhZ2UgY29u\nc3VtZSBhY3Rpb24gd2hpY2ggYWxyZWFkeSBwdXQgYSBUcnVlCiAgICAgICAg\nLy8gdmFsdWUgaW50byB0aGUgcXVldWUuCiAgICAgICAgbmV3IFRocmVhZChu\nZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBDb25j\ndXJyZW5jeVV0aWxzLnB1dChjb25zdW1lUXVldWUsIGZhbHNlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0pLnN0YXJ0KCk7CiAgICAgICAgYXNzZXJ0RmFs\nc2UoY29uc3VtZVF1ZXVlLnRha2UoKSk7CiAgICB9CgogICAgQFRlc3QKICAg\nIHB1YmxpYyB2b2lkIHRlc3RTeW5jVW5zdWJzY3JpYmVXaXRob3V0U3Vic2Ny\naXB0aW9uKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVhbiB1\nbnN1YnNjcmliZVN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB0cnkgewogICAg\nICAgICAgICBzdWJzY3JpYmVyLnVuc3Vic2NyaWJlKGdldFRvcGljKDApLCBs\nb2NhbFN1YnNjcmliZXJJZCk7CiAgICAgICAgfSBjYXRjaCAoQ2xpZW50Tm90\nU3Vic2NyaWJlZEV4Y2VwdGlvbiBlKSB7CiAgICAgICAgICAgIHVuc3Vic2Ny\naWJlU3VjY2VzcyA9IHRydWU7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9u\nIGV4KSB7CiAgICAgICAgICAgIHVuc3Vic2NyaWJlU3VjY2VzcyA9IGZhbHNl\nOwogICAgICAgIH0KICAgICAgICBhc3NlcnRUcnVlKHVuc3Vic2NyaWJlU3Vj\nY2Vzcyk7CiAgICB9CgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RB\nc3luY1Vuc3Vic2NyaWJlV2l0aG91dFN1YnNjcmlwdGlvbigpIHRocm93cyBF\neGNlcHRpb24gewogICAgICAgIHN1YnNjcmliZXIuYXN5bmNVbnN1YnNjcmli\nZShnZXRUb3BpYygwKSwgbG9jYWxTdWJzY3JpYmVySWQsIG5ldyBUZXN0Q2Fs\nbGJhY2socXVldWUpLCBudWxsKTsKICAgICAgICBhc3NlcnRGYWxzZShxdWV1\nZS50YWtlKCkpOwogICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0\nZXN0Q2xvc2VTdWJzY3JpcHRpb24oKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAg\nICAgICBCeXRlU3RyaW5nIHRvcGljID0gZ2V0VG9waWMoMCk7CiAgICAgICAg\nc3Vic2NyaWJlci5hc3luY1N1YnNjcmliZSh0b3BpYywgbG9jYWxTdWJzY3Jp\nYmVySWQsIENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gsIG5ldyBU\nZXN0Q2FsbGJhY2socXVldWUpLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtl\nKCkpOwogICAgICAgIHN0YXJ0RGVsaXZlcnkodG9waWMsIGxvY2FsU3Vic2Ny\naWJlcklkLCBuZXcgVGVzdE1lc3NhZ2VIYW5kbGVyKGNvbnN1bWVRdWV1ZSkp\nOwogICAgICAgIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2godG9waWMsIGdldE1z\nZygwKSwgbmV3IFRlc3RDYWxsYmFjayhxdWV1ZSksIG51bGwpOwogICAgICAg\nIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICBhc3NlcnRUcnVl\nKGNvbnN1bWVRdWV1ZS50YWtlKCkpOwogICAgICAgIC8vIENsb3NlIHRoZSBz\ndWJzY3JpcHRpb24gYXN5bmNocm9ub3VzbHkKICAgICAgICBzdWJzY3JpYmVy\nLmFzeW5jQ2xvc2VTdWJzY3JpcHRpb24odG9waWMsIGxvY2FsU3Vic2NyaWJl\ncklkLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAg\nYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIC8vIE5vdyBwdWJs\naXNoIGEgbWVzc2FnZSBhbmQgbWFrZSBzdXJlIGl0IGlzIG5vdCBjb25zdW1l\nZCBieSB0aGUgY2xpZW50CiAgICAgICAgcHVibGlzaGVyLmFzeW5jUHVibGlz\naCh0b3BpYywgZ2V0TXNnKDEpLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwg\nbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAg\nICAgIC8vIFdhaXQgYSBsaXR0bGUgYml0IGp1c3QgaW4gY2FzZSB0aGUgbWVz\nc2FnZSBoYW5kbGVyIGlzIHN0aWxsIGFjdGl2ZSwKICAgICAgICAvLyBjb25z\ndW1pbmcgdGhlIG1lc3NhZ2UsIGFuZCB0aGVuIHB1dHRpbmcgYSB0cnVlIHZh\nbHVlIGluIHRoZQogICAgICAgIC8vIGNvbnN1bWVRdWV1ZS4KICAgICAgICBU\naHJlYWQuc2xlZXAoMTAwMCk7CiAgICAgICAgLy8gUHV0IGEgRmFsc2UgdmFs\ndWUgb24gdGhlIGNvbnN1bWVRdWV1ZSBzbyB3ZSBjYW4gdmVyaWZ5IHRoYXQg\naXQKICAgICAgICAvLyBpcyBub3QgYmxvY2tlZCBieSBhIG1lc3NhZ2UgY29u\nc3VtZSBhY3Rpb24gd2hpY2ggYWxyZWFkeSBwdXQgYSBUcnVlCiAgICAgICAg\nLy8gdmFsdWUgaW50byB0aGUgcXVldWUuCiAgICAgICAgbmV3IFRocmVhZChu\nZXcgUnVubmFibGUoKSB7CiAgICAgICAgICAgIEBPdmVycmlkZQogICAgICAg\nICAgICBwdWJsaWMgdm9pZCBydW4oKSB7CiAgICAgICAgICAgICAgICBDb25j\ndXJyZW5jeVV0aWxzLnB1dChjb25zdW1lUXVldWUsIGZhbHNlKTsKICAgICAg\nICAgICAgfQogICAgICAgIH0pLnN0YXJ0KCk7CiAgICAgICAgYXNzZXJ0RmFs\nc2UoY29uc3VtZVF1ZXVlLnRha2UoKSk7CiAgICB9CgogICAgQFRlc3QKICAg\nIHB1YmxpYyB2b2lkIHRlc3RTdGFydERlbGl2ZXJ5VHdpY2UoKSB0aHJvd3Mg\nRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gZ2V0VG9w\naWMoMCk7CiAgICAgICAgc3Vic2NyaWJlci5hc3luY1N1YnNjcmliZSh0b3Bp\nYywgbG9jYWxTdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0YWNoLkNSRUFURV9P\nUl9BVFRBQ0gsIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLAogICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgYXNzZXJ0\nVHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIHN0YXJ0RGVsaXZlcnkodG9w\naWMsIGxvY2FsU3Vic2NyaWJlcklkLCBuZXcgVGVzdE1lc3NhZ2VIYW5kbGVy\nKGNvbnN1bWVRdWV1ZSkpOwogICAgICAgIHRyeSB7CiAgICAgICAgICAgIHN0\nYXJ0RGVsaXZlcnkodG9waWMsIGxvY2FsU3Vic2NyaWJlcklkLCBuZXcgVGVz\ndE1lc3NhZ2VIYW5kbGVyKGNvbnN1bWVRdWV1ZSkpOwogICAgICAgICAgICBm\nYWlsKCJTaG91bGQgbm90IHJlYWNoIGhlcmUhIik7CiAgICAgICAgfSBjYXRj\naCAoQWxyZWFkeVN0YXJ0RGVsaXZlcnlFeGNlcHRpb24gZSkgewogICAgICAg\nIH0KICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFN0b3BE\nZWxpdmVyeSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJp\nbmcgdG9waWMgPSBnZXRUb3BpYygwKTsKICAgICAgICBzdWJzY3JpYmVyLmFz\neW5jU3Vic2NyaWJlKHRvcGljLCBsb2NhbFN1YnNjcmliZXJJZCwgQ3JlYXRl\nT3JBdHRhY2guQ1JFQVRFX09SX0FUVEFDSCwgbmV3IFRlc3RDYWxsYmFjayhx\ndWV1ZSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxs\nKTsKICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAg\nc3RhcnREZWxpdmVyeSh0b3BpYywgbG9jYWxTdWJzY3JpYmVySWQsIG5ldyBU\nZXN0TWVzc2FnZUhhbmRsZXIoY29uc3VtZVF1ZXVlKSk7CiAgICAgICAgcHVi\nbGlzaGVyLmFzeW5jUHVibGlzaCh0b3BpYywgZ2V0TXNnKDApLCBuZXcgVGVz\ndENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1ZShx\ndWV1ZS50YWtlKCkpOwogICAgICAgIGFzc2VydFRydWUoY29uc3VtZVF1ZXVl\nLnRha2UoKSk7CiAgICAgICAgLy8gU3RvcCB0aGUgZGVsaXZlcnkgZm9yIHRo\naXMgc3Vic2NyaXB0aW9uCiAgICAgICAgc3RvcERlbGl2ZXJ5KHRvcGljLCBs\nb2NhbFN1YnNjcmliZXJJZCk7CiAgICAgICAgLy8gUHVibGlzaCBzb21lIG1v\ncmUgbWVzc2FnZXMgc28gdGhleSBhcmUgcXVldWVkIHVwIHRvIGJlIGRlbGl2\nZXJlZCB0bwogICAgICAgIC8vIHRoZSBjbGllbnQKICAgICAgICBpbnQgYmF0\nY2hTaXplID0gMTA7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXRj\naFNpemU7IGkrKykgewogICAgICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJs\naXNoKHRvcGljLCBnZXRNc2coaSArIDEpLCBuZXcgVGVzdENhbGxiYWNrKHF1\nZXVlKSwgbnVsbCk7CiAgICAgICAgICAgIGFzc2VydFRydWUocXVldWUudGFr\nZSgpKTsKICAgICAgICB9CiAgICAgICAgLy8gV2FpdCBhIGxpdHRsZSBiaXQg\nanVzdCBpbiBjYXNlIHRoZSBtZXNzYWdlIGhhbmRsZXIgaXMgc3RpbGwgYWN0\naXZlLAogICAgICAgIC8vIGNvbnN1bWluZyB0aGUgbWVzc2FnZSwgYW5kIHRo\nZW4gcHV0dGluZyBhIHRydWUgdmFsdWUgaW4gdGhlCiAgICAgICAgLy8gY29u\nc3VtZVF1ZXVlLgogICAgICAgIFRocmVhZC5zbGVlcCgxMDAwKTsKICAgICAg\nICAvLyBQdXQgYSBGYWxzZSB2YWx1ZSBvbiB0aGUgY29uc3VtZVF1ZXVlIHNv\nIHdlIGNhbiB2ZXJpZnkgdGhhdCBpdAogICAgICAgIC8vIGlzIG5vdCBibG9j\na2VkIGJ5IGEgbWVzc2FnZSBjb25zdW1lIGFjdGlvbiB3aGljaCBhbHJlYWR5\nIHB1dCBhIFRydWUKICAgICAgICAvLyB2YWx1ZSBpbnRvIHRoZSBxdWV1ZS4K\nICAgICAgICBuZXcgVGhyZWFkKG5ldyBSdW5uYWJsZSgpIHsKICAgICAgICAg\nICAgQE92ZXJyaWRlCiAgICAgICAgICAgIHB1YmxpYyB2b2lkIHJ1bigpIHsK\nICAgICAgICAgICAgICAgIENvbmN1cnJlbmN5VXRpbHMucHV0KGNvbnN1bWVR\ndWV1ZSwgZmFsc2UpOwogICAgICAgICAgICB9CiAgICAgICAgfSkuc3RhcnQo\nKTsKICAgICAgICBhc3NlcnRGYWxzZShjb25zdW1lUXVldWUudGFrZSgpKTsK\nICAgICAgICAvLyBOb3cgc3RhcnQgZGVsaXZlcnkgYWdhaW4gYW5kIHZlcmlm\neSB0aGF0IHRoZSBxdWV1ZWQgdXAgbWVzc2FnZXMgYXJlCiAgICAgICAgLy8g\nY29uc3VtZWQKICAgICAgICBzdGFydERlbGl2ZXJ5KHRvcGljLCBsb2NhbFN1\nYnNjcmliZXJJZCwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcihjb25zdW1lUXVl\ndWUpKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhdGNoU2l6ZTsg\naSsrKSB7CiAgICAgICAgICAgIGFzc2VydFRydWUoY29uc3VtZVF1ZXVlLnRh\na2UoKSk7CiAgICAgICAgfQogICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMg\ndm9pZCB0ZXN0Q29uc3VtZWRNZXNzYWdlc0luT3JkZXIoKSB0aHJvd3MgRXhj\nZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gZ2V0VG9waWMo\nMCk7CiAgICAgICAgc3Vic2NyaWJlci5hc3luY1N1YnNjcmliZSh0b3BpYywg\nbG9jYWxTdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9B\nVFRBQ0gsIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAgICAgICAgYXNzZXJ0VHJ1\nZShxdWV1ZS50YWtlKCkpOwogICAgICAgIHN0YXJ0RGVsaXZlcnkodG9waWMs\nIGxvY2FsU3Vic2NyaWJlcklkLCBuZXcgVGVzdE1lc3NhZ2VIYW5kbGVyKGNv\nbnN1bWVRdWV1ZSkpOwogICAgICAgIC8vIE5vdyBwdWJsaXNoIHNvbWUgbWVz\nc2FnZXMgYW5kIHZlcmlmeSB0aGF0IHRoZXkgYXJlIGRlbGl2ZXJlZCBpbiBv\ncmRlcgogICAgICAgIC8vIHRvIHRoZSBzdWJzY3JpYmVyCiAgICAgICAgaW50\nIGJhdGNoU2l6ZSA9IDEwMDsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8\nIGJhdGNoU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgIHB1Ymxpc2hlci5hc3lu\nY1B1Ymxpc2godG9waWMsIGdldE1zZyhpKSwgbmV3IFRlc3RDYWxsYmFjayhx\ndWV1ZSksIG51bGwpOwogICAgICAgIH0KICAgICAgICAvLyBXZSd2ZSBzZW50\nIG91dCBhbGwgb2YgdGhlIHB1Ymxpc2ggbWVzc2FnZXMgYXN5bmNocm9ub3Vz\nbHksCiAgICAgICAgLy8gbm93IHZlcmlmeSB0aGF0IHRoZXkgYXJlIGNvbnN1\nbWVkIGluIHRoZSBjb3JyZWN0IG9yZGVyLgogICAgICAgIGZvciAoaW50IGkg\nPSAwOyBpIDwgYmF0Y2hTaXplOyBpKyspIHsKICAgICAgICAgICAgYXNzZXJ0\nVHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgICAgICBhc3NlcnRUcnVlKGNv\nbnN1bWVRdWV1ZS50YWtlKCkpOwogICAgICAgIH0KICAgIH0KCiAgICBAVGVz\ndAogICAgcHVibGljIHZvaWQgdGVzdENyZWF0ZVN1YnNjcmlwdGlvbkZhaWx1\ncmUoKSB0aHJvd3MgRXhjZXB0aW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRv\ncGljID0gZ2V0VG9waWMoMCk7CiAgICAgICAgc3Vic2NyaWJlci5hc3luY1N1\nYnNjcmliZSh0b3BpYywgbG9jYWxTdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0\nYWNoLkNSRUFURV9PUl9BVFRBQ0gsIG5ldyBUZXN0Q2FsbGJhY2socXVldWUp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCk7CiAg\nICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIC8vIENs\nb3NlIHRoZSBzdWJzY3JpcHRpb24gYXN5bmNocm9ub3VzbHkKICAgICAgICBz\ndWJzY3JpYmVyLmFzeW5jQ2xvc2VTdWJzY3JpcHRpb24odG9waWMsIGxvY2Fs\nU3Vic2NyaWJlcklkLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7\nCiAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIC8v\nIE5vdyB0cnkgdG8gY3JlYXRlIHRoZSBzdWJzY3JpcHRpb24gd2hlbiBpdCBh\nbHJlYWR5IGV4aXN0cwogICAgICAgIHN1YnNjcmliZXIuYXN5bmNTdWJzY3Jp\nYmUodG9waWMsIGxvY2FsU3Vic2NyaWJlcklkLCBDcmVhdGVPckF0dGFjaC5D\nUkVBVEUsIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLCBudWxsKTsKICAgICAg\nICBhc3NlcnRGYWxzZShxdWV1ZS50YWtlKCkpOwogICAgfQoKICAgIEBUZXN0\nCiAgICBwdWJsaWMgdm9pZCB0ZXN0Q3JlYXRlU3Vic2NyaXB0aW9uU3VjY2Vz\ncygpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIEJ5dGVTdHJpbmcgdG9w\naWMgPSBnZXRUb3BpYygwKTsKICAgICAgICBzdWJzY3JpYmVyLmFzeW5jU3Vi\nc2NyaWJlKHRvcGljLCBsb2NhbFN1YnNjcmliZXJJZCwgQ3JlYXRlT3JBdHRh\nY2guQ1JFQVRFLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAg\nICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIHN0YXJ0\nRGVsaXZlcnkodG9waWMsIGxvY2FsU3Vic2NyaWJlcklkLCBuZXcgVGVzdE1l\nc3NhZ2VIYW5kbGVyKGNvbnN1bWVRdWV1ZSkpOwogICAgICAgIGludCBiYXRj\naFNpemUgPSA1OwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0Y2hT\naXplOyBpKyspIHsKICAgICAgICAgICAgcHVibGlzaGVyLmFzeW5jUHVibGlz\naCh0b3BpYywgZ2V0TXNnKGkpLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwg\nbnVsbCk7CiAgICAgICAgICAgIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsK\nICAgICAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVldWUudGFrZSgpKTsK\nICAgICAgICB9CiAgICB9CgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRl\nc3RBdHRhY2hUb1N1YnNjcmlwdGlvbkZhaWx1cmUoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBCeXRlU3RyaW5nIHRvcGljID0gZ2V0VG9waWMoMCk7\nCiAgICAgICAgc3Vic2NyaWJlci5hc3luY1N1YnNjcmliZSh0b3BpYywgbG9j\nYWxTdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0YWNoLkFUVEFDSCwgbmV3IFRl\nc3RDYWxsYmFjayhxdWV1ZSksIG51bGwpOwogICAgICAgIGFzc2VydEZhbHNl\nKHF1ZXVlLnRha2UoKSk7CiAgICB9CgogICAgLy8gVGhlIGZvbGxvd2luZyA0\nIHRlc3RzIGFyZSB0byBtYWtlIHN1cmUgdGhhdCB0aGUgc3Vic2NyaWJlcklk\nIHZhbGlkYXRpb24KICAgIC8vIHdvcmtzIHdoZW4gaXQgaXMgYSBsb2NhbCBz\ndWJzY3JpYmVyIGFuZCB3ZSdyZSBleHBlY3RpbmcgdGhlIHN1YnNjcmliZXJJ\nZAogICAgLy8gdG8gYmUgaW4gdGhlICJsb2NhbCIgc3BlY2lmaWMgZm9ybWF0\nLgogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RTeW5jU3Vic2NyaWJl\nV2l0aEludmFsaWRTdWJzY3JpYmVySWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBib29sZWFuIHN1YnNjcmliZVN1Y2Nlc3MgPSBmYWxzZTsKICAg\nICAgICB0cnkgewogICAgICAgICAgICBzdWJzY3JpYmVyLnN1YnNjcmliZShn\nZXRUb3BpYygwKSwgaHViU3Vic2NyaWJlcklkLCBDcmVhdGVPckF0dGFjaC5D\nUkVBVEVfT1JfQVRUQUNIKTsKICAgICAgICB9IGNhdGNoIChJbnZhbGlkU3Vi\nc2NyaWJlcklkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgc3Vic2NyaWJl\nU3VjY2VzcyA9IHRydWU7CiAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4\nKSB7CiAgICAgICAgICAgIHN1YnNjcmliZVN1Y2Nlc3MgPSBmYWxzZTsKICAg\nICAgICB9CiAgICAgICAgYXNzZXJ0VHJ1ZShzdWJzY3JpYmVTdWNjZXNzKTsK\nICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEFzeW5jU3Vi\nc2NyaWJlV2l0aEludmFsaWRTdWJzY3JpYmVySWQoKSB0aHJvd3MgRXhjZXB0\naW9uIHsKICAgICAgICBzdWJzY3JpYmVyLmFzeW5jU3Vic2NyaWJlKGdldFRv\ncGljKDApLCBodWJTdWJzY3JpYmVySWQsIENyZWF0ZU9yQXR0YWNoLkNSRUFU\nRV9PUl9BVFRBQ0gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAgYXNz\nZXJ0RmFsc2UocXVldWUudGFrZSgpKTsKICAgIH0KCiAgICBAVGVzdAogICAg\ncHVibGljIHZvaWQgdGVzdFN5bmNVbnN1YnNjcmliZVdpdGhJbnZhbGlkU3Vi\nc2NyaWJlcklkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgYm9vbGVh\nbiB1bnN1YnNjcmliZVN1Y2Nlc3MgPSBmYWxzZTsKICAgICAgICB0cnkgewog\nICAgICAgICAgICBzdWJzY3JpYmVyLnVuc3Vic2NyaWJlKGdldFRvcGljKDAp\nLCBodWJTdWJzY3JpYmVySWQpOwogICAgICAgIH0gY2F0Y2ggKEludmFsaWRT\ndWJzY3JpYmVySWRFeGNlcHRpb24gZSkgewogICAgICAgICAgICB1bnN1YnNj\ncmliZVN1Y2Nlc3MgPSB0cnVlOwogICAgICAgIH0gY2F0Y2ggKEV4Y2VwdGlv\nbiBleCkgewogICAgICAgICAgICB1bnN1YnNjcmliZVN1Y2Nlc3MgPSBmYWxz\nZTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0VHJ1ZSh1bnN1YnNjcmliZVN1\nY2Nlc3MpOwogICAgfQoKICAgIEBUZXN0CiAgICBwdWJsaWMgdm9pZCB0ZXN0\nQXN5bmNVbnN1YnNjcmliZVdpdGhJbnZhbGlkU3Vic2NyaWJlcklkKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgc3Vic2NyaWJlci5hc3luY1Vuc3Vi\nc2NyaWJlKGdldFRvcGljKDApLCBodWJTdWJzY3JpYmVySWQsIG5ldyBUZXN0\nQ2FsbGJhY2socXVldWUpLCBudWxsKTsKICAgICAgICBhc3NlcnRGYWxzZShx\ndWV1ZS50YWtlKCkpOwogICAgfQoKICAgIC8vIFRoZSBmb2xsb3dpbmcgNCB0\nZXN0cyBhcmUgdG8gbWFrZSBzdXJlIHRoYXQgdGhlIHN1YnNjcmliZXJJZCB2\nYWxpZGF0aW9uCiAgICAvLyBhbHNvIHdvcmtzIHdoZW4gaXQgaXMgYSBodWIg\nc3Vic2NyaWJlciBhbmQgd2UncmUgZXhwZWN0aW5nIHRoZQogICAgLy8gc3Vi\nc2NyaWJlcklkIHRvIGJlIGluIHRoZSAiaHViIiBzcGVjaWZpYyBmb3JtYXQu\nCiAgICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdFN5bmNIdWJTdWJzY3Jp\nYmVXaXRoSW52YWxpZFN1YnNjcmliZXJJZCgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIENsaWVudCBodWJDbGllbnQgPSBuZXcgSGVkd2lnSHViQ2xp\nZW50KG5ldyBDbGllbnRDb25maWd1cmF0aW9uKCkpOwogICAgICAgIFN1YnNj\ncmliZXIgaHViU3Vic2NyaWJlciA9IGh1YkNsaWVudC5nZXRTdWJzY3JpYmVy\nKCk7CiAgICAgICAgYm9vbGVhbiBzdWJzY3JpYmVTdWNjZXNzID0gZmFsc2U7\nCiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgaHViU3Vic2NyaWJlci5zdWJz\nY3JpYmUoZ2V0VG9waWMoMCksIGxvY2FsU3Vic2NyaWJlcklkLCBDcmVhdGVP\nckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNIKTsKICAgICAgICB9IGNhdGNoIChJ\nbnZhbGlkU3Vic2NyaWJlcklkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAg\nc3Vic2NyaWJlU3VjY2VzcyA9IHRydWU7CiAgICAgICAgfSBjYXRjaCAoRXhj\nZXB0aW9uIGV4KSB7CiAgICAgICAgICAgIHN1YnNjcmliZVN1Y2Nlc3MgPSBm\nYWxzZTsKICAgICAgICB9CiAgICAgICAgYXNzZXJ0VHJ1ZShzdWJzY3JpYmVT\ndWNjZXNzKTsKICAgICAgICBodWJDbGllbnQuY2xvc2UoKTsKICAgIH0KCiAg\nICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEFzeW5jSHViU3Vic2NyaWJl\nV2l0aEludmFsaWRTdWJzY3JpYmVySWQoKSB0aHJvd3MgRXhjZXB0aW9uIHsK\nICAgICAgICBDbGllbnQgaHViQ2xpZW50ID0gbmV3IEhlZHdpZ0h1YkNsaWVu\ndChuZXcgQ2xpZW50Q29uZmlndXJhdGlvbigpKTsKICAgICAgICBTdWJzY3Jp\nYmVyIGh1YlN1YnNjcmliZXIgPSBodWJDbGllbnQuZ2V0U3Vic2NyaWJlcigp\nOwogICAgICAgIGh1YlN1YnNjcmliZXIuYXN5bmNTdWJzY3JpYmUoZ2V0VG9w\naWMoMCksIGxvY2FsU3Vic2NyaWJlcklkLCBDcmVhdGVPckF0dGFjaC5DUkVB\nVEVfT1JfQVRUQUNILCBuZXcgVGVzdENhbGxiYWNrKAogICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlKSwgbnVsbCk7CiAg\nICAgICAgYXNzZXJ0RmFsc2UocXVldWUudGFrZSgpKTsKICAgICAgICBodWJD\nbGllbnQuY2xvc2UoKTsKICAgIH0KCiAgICBAVGVzdAogICAgcHVibGljIHZv\naWQgdGVzdFN5bmNIdWJVbnN1YnNjcmliZVdpdGhJbnZhbGlkU3Vic2NyaWJl\ncklkKCkgdGhyb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgQ2xpZW50IGh1YkNs\naWVudCA9IG5ldyBIZWR3aWdIdWJDbGllbnQobmV3IENsaWVudENvbmZpZ3Vy\nYXRpb24oKSk7CiAgICAgICAgU3Vic2NyaWJlciBodWJTdWJzY3JpYmVyID0g\naHViQ2xpZW50LmdldFN1YnNjcmliZXIoKTsKICAgICAgICBib29sZWFuIHVu\nc3Vic2NyaWJlU3VjY2VzcyA9IGZhbHNlOwogICAgICAgIHRyeSB7CiAgICAg\nICAgICAgIGh1YlN1YnNjcmliZXIudW5zdWJzY3JpYmUoZ2V0VG9waWMoMCks\nIGxvY2FsU3Vic2NyaWJlcklkKTsKICAgICAgICB9IGNhdGNoIChJbnZhbGlk\nU3Vic2NyaWJlcklkRXhjZXB0aW9uIGUpIHsKICAgICAgICAgICAgdW5zdWJz\nY3JpYmVTdWNjZXNzID0gdHJ1ZTsKICAgICAgICB9IGNhdGNoIChFeGNlcHRp\nb24gZXgpIHsKICAgICAgICAgICAgdW5zdWJzY3JpYmVTdWNjZXNzID0gZmFs\nc2U7CiAgICAgICAgfQogICAgICAgIGFzc2VydFRydWUodW5zdWJzY3JpYmVT\ndWNjZXNzKTsKICAgICAgICBodWJDbGllbnQuY2xvc2UoKTsKICAgIH0KCiAg\nICBAVGVzdAogICAgcHVibGljIHZvaWQgdGVzdEFzeW5jSHViVW5zdWJzY3Jp\nYmVXaXRoSW52YWxpZFN1YnNjcmliZXJJZCgpIHRocm93cyBFeGNlcHRpb24g\newogICAgICAgIENsaWVudCBodWJDbGllbnQgPSBuZXcgSGVkd2lnSHViQ2xp\nZW50KG5ldyBDbGllbnRDb25maWd1cmF0aW9uKCkpOwogICAgICAgIFN1YnNj\ncmliZXIgaHViU3Vic2NyaWJlciA9IGh1YkNsaWVudC5nZXRTdWJzY3JpYmVy\nKCk7CiAgICAgICAgaHViU3Vic2NyaWJlci5hc3luY1Vuc3Vic2NyaWJlKGdl\ndFRvcGljKDApLCBsb2NhbFN1YnNjcmliZXJJZCwgbmV3IFRlc3RDYWxsYmFj\nayhxdWV1ZSksIG51bGwpOwogICAgICAgIGFzc2VydEZhbHNlKHF1ZXVlLnRh\na2UoKSk7CiAgICAgICAgaHViQ2xpZW50LmNsb3NlKCk7CiAgICB9CgogICAg\nQFRlc3QKICAgIHB1YmxpYyB2b2lkIHRlc3RQdWJsaXNoV2l0aEJvb2tLZWVw\nZXJFcnJvcigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBiYXRj\naFNpemUgPSAxMDsKICAgICAgICBwdWJsaXNoQmF0Y2goYmF0Y2hTaXplLCB0\ncnVlLCBmYWxzZSwgMCk7CiAgICAgICAgLy8gc3RvcCBhbGwgYm9va2llIHNl\ncnZlcnMKICAgICAgICBia3RiLnN0b3BBbGxCb29raWVTZXJ2ZXJzKCk7CiAg\nICAgICAgLy8gZm9sbG93aW5nIHB1Ymxpc2ggd291bGQgZmFpbGVkIHdpdGgg\nTm90RW5vdWdoQm9va2llcwogICAgICAgIHB1Ymxpc2hCYXRjaChiYXRjaFNp\nemUsIGZhbHNlLCBmYWxzZSwgMSk7CiAgICAgICAgLy8gc3RhcnQgYWxsIGJv\nb2tpZSBzZXJ2ZXJzCiAgICAgICAgYmt0Yi5zdGFydEFsbEJvb2tpZVNlcnZl\ncnMoKTsKICAgICAgICAvLyBmb2xsb3dpbmcgcHVibGlzaCBzaG91bGQgc3Vj\nY2VlZAogICAgICAgIHB1Ymxpc2hCYXRjaChiYXRjaFNpemUsIHRydWUsIGZh\nbHNlLCAxKTsKICAgIH0KfQo=\n","encoding":"base64"}

