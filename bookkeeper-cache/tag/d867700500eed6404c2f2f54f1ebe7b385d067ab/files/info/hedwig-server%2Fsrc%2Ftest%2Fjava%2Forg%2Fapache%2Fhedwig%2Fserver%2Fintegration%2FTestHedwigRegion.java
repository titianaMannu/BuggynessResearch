{"sha":"0b1851ebbc5c6c80fa25a0fd62e1dfb2783ae947","node_id":"MDQ6QmxvYjE1NzU5NTY6MGIxODUxZWJiYzVjNmM4MGZhMjVhMGZkNjJlMWRmYjI3ODNhZTk0Nw==","size":11826,"url":"https://api.github.com/repos/apache/bookkeeper/git/blobs/0b1851ebbc5c6c80fa25a0fd62e1dfb2783ae947","content":"LyoqCiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRh\ndGlvbiAoQVNGKSB1bmRlciBvbmUKICogb3IgbW9yZSBjb250cmlidXRvciBs\naWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlCiAqIGRp\nc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9y\nbWF0aW9uCiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhl\nIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGUKICogdG8geW91IHVuZGVyIHRoZSBB\ncGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZQogKiAiTGljZW5zZSIp\nOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlh\nbmNlCiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNv\ncHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBh\nY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVx\ndWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRp\nbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNl\nIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhP\nVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRo\nZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9y\nIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMg\nYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKi8KcGFj\na2FnZSBvcmcuYXBhY2hlLmhlZHdpZy5zZXJ2ZXIuaW50ZWdyYXRpb247Cgpp\nbXBvcnQgamF2YS51dGlsLk1hcDsKaW1wb3J0IGphdmEudXRpbC5SYW5kb207\nCmltcG9ydCBqYXZhLnV0aWwuY29uY3VycmVudC5TeW5jaHJvbm91c1F1ZXVl\nOwoKaW1wb3J0IG9yZy5qdW5pdC5BZnRlcjsKaW1wb3J0IG9yZy5qdW5pdC5C\nZWZvcmU7CmltcG9ydCBvcmcuanVuaXQuVGVzdDsKCmltcG9ydCBjb20uZ29v\nZ2xlLnByb3RvYnVmLkJ5dGVTdHJpbmc7CmltcG9ydCBvcmcuYXBhY2hlLmhl\nZHdpZy5jbGllbnQuSGVkd2lnQ2xpZW50OwppbXBvcnQgb3JnLmFwYWNoZS5o\nZWR3aWcuY2xpZW50LmFwaS5QdWJsaXNoZXI7CmltcG9ydCBvcmcuYXBhY2hl\nLmhlZHdpZy5wcm90b2NvbC5QdWJTdWJQcm90b2NvbC5NZXNzYWdlOwppbXBv\ncnQgb3JnLmFwYWNoZS5oZWR3aWcucHJvdG9jb2wuUHViU3ViUHJvdG9jb2wu\nU3Vic2NyaWJlUmVxdWVzdC5DcmVhdGVPckF0dGFjaDsKaW1wb3J0IG9yZy5h\ncGFjaGUuaGVkd2lnLnNlcnZlci5IZWR3aWdSZWdpb25UZXN0QmFzZTsKaW1w\nb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5jb21tb24uU2VydmVyQ29u\nZmlndXJhdGlvbjsKaW1wb3J0IG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5p\nbnRlZ3JhdGlvbi5UZXN0SGVkd2lnSHViLlRlc3RDYWxsYmFjazsKaW1wb3J0\nIG9yZy5hcGFjaGUuaGVkd2lnLnNlcnZlci5pbnRlZ3JhdGlvbi5UZXN0SGVk\nd2lnSHViLlRlc3RNZXNzYWdlSGFuZGxlcjsKCnB1YmxpYyBjbGFzcyBUZXN0\nSGVkd2lnUmVnaW9uIGV4dGVuZHMgSGVkd2lnUmVnaW9uVGVzdEJhc2UgewoK\nICAgIC8vIFN5bmNocm9ub3VzUXVldWVzIHRvIHZlcmlmeSBhc3luYyBjYWxs\ncwogICAgcHJpdmF0ZSBmaW5hbCBTeW5jaHJvbm91c1F1ZXVlPEJvb2xlYW4+\nIHF1ZXVlID0gbmV3IFN5bmNocm9ub3VzUXVldWU8Qm9vbGVhbj4oKTsKICAg\nIHByaXZhdGUgZmluYWwgU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPiBjb25z\ndW1lUXVldWUgPSBuZXcgU3luY2hyb25vdXNRdWV1ZTxCb29sZWFuPigpOwoK\nICAgIHByaXZhdGUgc3RhdGljIGZpbmFsIGludCBURVNUX1JFVFJZX1JFTU9U\nRV9TVUJTQ1JJQkVfSU5URVJWQUxfVkFMVUUgPSAzMDAwOwoKICAgIHByb3Rl\nY3RlZCBjbGFzcyBOZXdSZWdpb25TZXJ2ZXJDb25maWd1cmF0aW9uIGV4dGVu\nZHMgUmVnaW9uU2VydmVyQ29uZmlndXJhdGlvbiB7CgogICAgICAgIHB1Ymxp\nYyBOZXdSZWdpb25TZXJ2ZXJDb25maWd1cmF0aW9uKGludCBzZXJ2ZXJQb3J0\nLCBpbnQgc3NsU2VydmVyUG9ydCwKICAgICAgICAgICAgICAgIFN0cmluZyBy\nZWdpb25OYW1lKSB7CiAgICAgICAgICAgIHN1cGVyKHNlcnZlclBvcnQsIHNz\nbFNlcnZlclBvcnQsIHJlZ2lvbk5hbWUpOwogICAgICAgIH0KCiAgICAgICAg\nQE92ZXJyaWRlCiAgICAgICAgcHVibGljIGludCBnZXRSZXRyeVJlbW90ZVN1\nYnNjcmliZVRocmVhZFJ1bkludGVydmFsKCkgewogICAgICAgICAgICByZXR1\ncm4gVEVTVF9SRVRSWV9SRU1PVEVfU1VCU0NSSUJFX0lOVEVSVkFMX1ZBTFVF\nOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgU2VydmVyQ29uZmln\ndXJhdGlvbiBnZXRTZXJ2ZXJDb25maWd1cmF0aW9uKGludCBzZXJ2ZXJQb3J0\nLCBpbnQgc3NsU2VydmVyUG9ydCwgU3RyaW5nIHJlZ2lvbk5hbWUpIHsKICAg\nICAgICByZXR1cm4gbmV3IE5ld1JlZ2lvblNlcnZlckNvbmZpZ3VyYXRpb24o\nc2VydmVyUG9ydCwgc3NsU2VydmVyUG9ydCwgcmVnaW9uTmFtZSk7CiAgICB9\nCgogICAgQE92ZXJyaWRlCiAgICBAQmVmb3JlCiAgICBwdWJsaWMgdm9pZCBz\nZXRVcCgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIG51bVJlZ2lvbnMg\nPSAzOwogICAgICAgIG51bVNlcnZlcnNQZXJSZWdpb24gPSA0OwogICAgICAg\nIHN1cGVyLnNldFVwKCk7CiAgICB9CgogICAgQE92ZXJyaWRlCiAgICBAQWZ0\nZXIKICAgIHB1YmxpYyB2b2lkIHRlYXJEb3duKCkgdGhyb3dzIEV4Y2VwdGlv\nbiB7CiAgICAgICAgc3VwZXIudGVhckRvd24oKTsKICAgIH0KCiAgICBAVGVz\ndAogICAgcHVibGljIHZvaWQgdGVzdE11bHRpUmVnaW9uU3Vic2NyaWJlQW5k\nQ29uc3VtZSgpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBiYXRj\naFNpemUgPSAxMDsKICAgICAgICAvLyBTdWJzY3JpYmUgdG8gdG9waWNzIGZv\nciBjbGllbnRzIGluIGFsbCByZWdpb25zCiAgICAgICAgZm9yIChIZWR3aWdD\nbGllbnQgY2xpZW50IDogcmVnaW9uQ2xpZW50c01hcC52YWx1ZXMoKSkgewog\nICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhdGNoU2l6ZTsgaSsr\nKSB7CiAgICAgICAgICAgICAgICBjbGllbnQuZ2V0U3Vic2NyaWJlcigpLmFz\neW5jU3Vic2NyaWJlKEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJUb3BpYyIg\nKyBpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIkxvY2Fs\nU3Vic2NyaWJlciIpLCBDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNI\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAg\nICAgICAgICAgICAgICBhc3NlcnRUcnVlKHF1ZXVlLnRha2UoKSk7CiAgICAg\nICAgICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIFN0YXJ0IGRlbGl2ZXJ5\nIGZvciB0aGUgbG9jYWwgc3Vic2NyaWJlcnMgaW4gYWxsIHJlZ2lvbnMKICAg\nICAgICBmb3IgKEhlZHdpZ0NsaWVudCBjbGllbnQgOiByZWdpb25DbGllbnRz\nTWFwLnZhbHVlcygpKSB7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBp\nIDwgYmF0Y2hTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNsaWVudC5n\nZXRTdWJzY3JpYmVyKCkuc3RhcnREZWxpdmVyeShCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOCgiVG9waWMiICsgaSksCiAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0cmluZy5jb3B5\nRnJvbVV0ZjgoIkxvY2FsU3Vic2NyaWJlciIpLCBuZXcgVGVzdE1lc3NhZ2VI\nYW5kbGVyKGNvbnN1bWVRdWV1ZSkpOwogICAgICAgICAgICB9CiAgICAgICAg\nfQoKICAgICAgICAvLyBOb3cgc3RhcnQgcHVibGlzaGluZyBtZXNzYWdlcyBm\nb3IgdGhlIHN1YnNjcmliZWQgdG9waWNzIGluIG9uZSBvZiB0aGUKICAgICAg\nICAvLyByZWdpb25zIGFuZCB2ZXJpZnkgdGhhdCBpdCBnZXRzIGRlbGl2ZXJl\nZCBhbmQgY29uc3VtZWQgaW4gYWxsIG9mIHRoZQogICAgICAgIC8vIG90aGVy\nIG9uZXMuCiAgICAgICAgUHVibGlzaGVyIHB1Ymxpc2hlciA9IHJlZ2lvbkNs\naWVudHNNYXAudmFsdWVzKCkuaXRlcmF0b3IoKS5uZXh0KCkuZ2V0UHVibGlz\naGVyKCk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBiYXRjaFNpemU7\nIGkrKykgewogICAgICAgICAgICBwdWJsaXNoZXIuYXN5bmNQdWJsaXNoKEJ5\ndGVTdHJpbmcuY29weUZyb21VdGY4KCJUb3BpYyIgKyBpKSwgTWVzc2FnZS5u\nZXdCdWlsZGVyKCkuc2V0Qm9keSgKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIk1lc3Nh\nZ2UiICsgaSkpLmJ1aWxkKCksIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLCBu\ndWxsKTsKICAgICAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwog\nICAgICAgIH0KICAgICAgICAvLyBNYWtlIHN1cmUgZWFjaCByZWdpb24gY29u\nc3VtZXMgdGhlIHNhbWUgc2V0IG9mIHB1Ymxpc2hlZCBtZXNzYWdlcy4KICAg\nICAgICBmb3IgKGludCBpID0gMDsgaSA8IHJlZ2lvbkNsaWVudHNNYXAuc2l6\nZSgpOyBpKyspIHsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBi\nYXRjaFNpemU7IGorKykgewogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZShj\nb25zdW1lUXVldWUudGFrZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0K\nICAgIH0KCiAgICAvKioKICAgICAqIFRlc3QgcmVnaW9uIHNodXRzIGRvd24g\nd2hlbiBmaXJzdCBzdWJzY3JpcHRpb24uCiAgICAgKgogICAgICogQHRocm93\ncyBFeGNlcHRpb24KICAgICAqLwogICAgQFRlc3QKICAgIHB1YmxpYyB2b2lk\nIHRlc3RTdWJzY3JpYmVBbmRDb25zdW1lV2hlbkFSZWdpb25Eb3duKCkgdGhy\nb3dzIEV4Y2VwdGlvbiB7CiAgICAgICAgaW50IGJhdGNoU2l6ZSA9IDEwOwoK\nICAgICAgICAvLyBmaXJzdCBzaHV0IGRvd24gYSByZWdpb24KICAgICAgICBS\nYW5kb20gciA9IG5ldyBSYW5kb20oKTsKICAgICAgICBpbnQgcmVnaW9uSWQg\nPSByLm5leHRJbnQobnVtUmVnaW9ucyk7CiAgICAgICAgc3RvcFJlZ2lvbihy\nZWdpb25JZCk7CiAgICAgICAgLy8gc3Vic2NyaWJlIHRvIHRvcGljcyB3aGVu\nIGEgcmVnaW9uIHNodXRzIGRvd24KICAgICAgICBmb3IgKEhlZHdpZ0NsaWVu\ndCBjbGllbnQgOiByZWdpb25DbGllbnRzTWFwLnZhbHVlcygpKSB7CiAgICAg\nICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0Y2hTaXplOyBpKyspIHsK\nICAgICAgICAgICAgICAgIGNsaWVudC5nZXRTdWJzY3JpYmVyKCkuYXN5bmNT\ndWJzY3JpYmUoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIlRvcGljIiArIGkp\nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiTG9jYWxTdWJz\nY3JpYmVyIiksIENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gsCiAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLCBudWxsKTsKICAgICAg\nICAgICAgICAgIGFzc2VydEZhbHNlKHF1ZXVlLnRha2UoKSk7CiAgICAgICAg\nICAgIH0KICAgICAgICB9CgogICAgICAgIC8vIHN0YXJ0IHJlZ2lvbiBnYWlu\nCiAgICAgICAgc3RhcnRSZWdpb24ocmVnaW9uSWQpOwoKICAgICAgICAvLyBz\ndWIgaXQgYWdhaW4KICAgICAgICBmb3IgKE1hcC5FbnRyeTxTdHJpbmcsIEhl\nZHdpZ0NsaWVudD4gZW50cnkgOiByZWdpb25DbGllbnRzTWFwLmVudHJ5U2V0\nKCkpIHsKICAgICAgICAgICAgSGVkd2lnQ2xpZW50IGNsaWVudCA9IGVudHJ5\nLmdldFZhbHVlKCk7CiAgICAgICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwg\nYmF0Y2hTaXplOyBpKyspIHsKICAgICAgICAgICAgICAgIGNsaWVudC5nZXRT\ndWJzY3JpYmVyKCkuYXN5bmNTdWJzY3JpYmUoQnl0ZVN0cmluZy5jb3B5RnJv\nbVV0ZjgoIlRvcGljIiArIGkpLAogICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOCgiTG9jYWxTdWJzY3JpYmVyIiksIENyZWF0ZU9yQXR0YWNoLkNS\nRUFURV9PUl9BVFRBQ0gsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBUZXN0Q2FsbGJhY2socXVl\ndWUpLCBudWxsKTsKICAgICAgICAgICAgICAgIGFzc2VydFRydWUocXVldWUu\ndGFrZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgLy8g\nU3RhcnQgZGVsaXZlcnkgZm9yIGxvY2FsIHN1YnNjcmliZXJzIGluIGFsbCBy\nZWdpb25zCiAgICAgICAgZm9yIChNYXAuRW50cnk8U3RyaW5nLCBIZWR3aWdD\nbGllbnQ+IGVudHJ5IDogcmVnaW9uQ2xpZW50c01hcC5lbnRyeVNldCgpKSB7\nCiAgICAgICAgICAgIEhlZHdpZ0NsaWVudCBjbGllbnQgPSBlbnRyeS5nZXRW\nYWx1ZSgpOwogICAgICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IGJhdGNo\nU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBjbGllbnQuZ2V0U3Vic2Ny\naWJlcigpLnN0YXJ0RGVsaXZlcnkoQnl0ZVN0cmluZy5jb3B5RnJvbVV0Zjgo\nIlRvcGljIiArIGkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4\nKCJMb2NhbFN1YnNjcmliZXIiKSwgbmV3IFRlc3RNZXNzYWdlSGFuZGxlcihj\nb25zdW1lUXVldWUpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAg\nICAgLy8gTm93IHN0YXJ0IHB1Ymxpc2hpbmcgbWVzc2FnZXMgZm9yIHRoZSBz\ndWJzY3JpYmVkIHRvcGljcyBpbiBvbmUgb2YgdGhlCiAgICAgICAgLy8gcmVn\naW9ucyBhbmQgdmVyaWZ5IHRoYXQgaXQgZ2V0cyBkZWxpdmVyZWQgYW5kIGNv\nbnN1bWVkIGluIGFsbCBvZiB0aGUKICAgICAgICAvLyBvdGhlciBvbmVzLgog\nICAgICAgIGludCByaWQgPSByLm5leHRJbnQobnVtUmVnaW9ucyk7CiAgICAg\nICAgU3RyaW5nIHJlZ2lvbk5hbWUgPSBSRUdJT05fUFJFRklYICsgcmlkOwog\nICAgICAgIFB1Ymxpc2hlciBwdWJsaXNoZXIgPSByZWdpb25DbGllbnRzTWFw\nLmdldChyZWdpb25OYW1lKS5nZXRQdWJsaXNoZXIoKTsKICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IGJhdGNoU2l6ZTsgaSsrKSB7CiAgICAgICAgICAg\nIHB1Ymxpc2hlci5hc3luY1B1Ymxpc2goQnl0ZVN0cmluZy5jb3B5RnJvbVV0\nZjgoIlRvcGljIiArIGkpLCBNZXNzYWdlLm5ld0J1aWxkZXIoKS5zZXRCb2R5\nKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJ5dGVTdHJp\nbmcuY29weUZyb21VdGY4KHJlZ2lvbk5hbWUgKyAiLU1lc3NhZ2UiICsgaSkp\nLmJ1aWxkKCksIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLCBudWxsKTsKICAg\nICAgICAgICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgIH0K\nICAgICAgICAvLyBNYWtlIHN1cmUgZWFjaCByZWdpb24gY29uc3VtZXMgdGhl\nIHNhbWUgc2V0IG9mIHB1Ymxpc2hlZCBtZXNzYWdlcy4KICAgICAgICBmb3Ig\nKGludCBpID0gMDsgaSA8IHJlZ2lvbkNsaWVudHNNYXAuc2l6ZSgpOyBpKysp\nIHsKICAgICAgICAgICAgZm9yIChpbnQgaiA9IDA7IGogPCBiYXRjaFNpemU7\nIGorKykgewogICAgICAgICAgICAgICAgYXNzZXJ0VHJ1ZShjb25zdW1lUXVl\ndWUudGFrZSgpKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0KCiAg\nICAvKioKICAgICAqIFRlc3QgcmVnaW9uIHNodXRzIGRvd24gd2hlbiBhdHRh\nY2hpbmcgZXhpc3Rpbmcgc3Vic2NyaXB0aW9ucy4KICAgICAqCiAgICAgKiBA\ndGhyb3dzIEV4Y2VwdGlvbgogICAgICovCiAgICBAVGVzdAogICAgcHVibGlj\nIHZvaWQgdGVzdEF0dGFjaEV4aXN0aW5nU3Vic2NyaXB0aW9uc1doZW5BUmVn\naW9uRG93bigpIHRocm93cyBFeGNlcHRpb24gewogICAgICAgIGludCBiYXRj\naFNpemUgPSAxMDsKICAgICAgICAKICAgICAgICAvLyBzdWIgaXQgcmVtb3Rl\nbHkgdG8gbWFrZSBzdWJzY3JpcHRpb25zIGV4aXN0ZWQKICAgICAgICBmb3Ig\nKE1hcC5FbnRyeTxTdHJpbmcsIEhlZHdpZ0NsaWVudD4gZW50cnkgOiByZWdp\nb25DbGllbnRzTWFwLmVudHJ5U2V0KCkpIHsKICAgICAgICAgICAgSGVkd2ln\nQ2xpZW50IGNsaWVudCA9IGVudHJ5LmdldFZhbHVlKCk7CiAgICAgICAgICAg\nIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0Y2hTaXplOyBpKyspIHsKICAgICAg\nICAgICAgICAgIGNsaWVudC5nZXRTdWJzY3JpYmVyKCkuYXN5bmNTdWJzY3Jp\nYmUoQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIlRvcGljIiArIGkpLAogICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICBCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiTG9jYWxTdWJzY3JpYmVy\nIiksIENyZWF0ZU9yQXR0YWNoLkNSRUFURV9PUl9BVFRBQ0gsCiAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLCBudWxsKTsKICAgICAgICAgICAg\nICAgIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICAgICAgfQog\nICAgICAgIH0KCiAgICAgICAgLy8gc3RvcCByZWdpb25zCiAgICAgICAgZm9y\nIChpbnQgaT0wOyBpPG51bVJlZ2lvbnM7IGkrKykgewogICAgICAgICAgICBz\ndG9wUmVnaW9uKGkpOwogICAgICAgIH0KICAgICAgICAvLyBzdGFydCByZWdp\nb25zIGFnYWluCiAgICAgICAgZm9yIChpbnQgaT0wOyBpPG51bVJlZ2lvbnM7\nIGkrKykgewogICAgICAgICAgICBzdGFydFJlZ2lvbihpKTsKICAgICAgICB9\nCgogICAgICAgIC8vIGZpcnN0IHNodXQgZG93biBhIHJlZ2lvbgogICAgICAg\nIFJhbmRvbSByID0gbmV3IFJhbmRvbSgpOwogICAgICAgIGludCByZWdpb25J\nZCA9IHIubmV4dEludChudW1SZWdpb25zKTsKICAgICAgICBzdG9wUmVnaW9u\nKHJlZ2lvbklkKTsKICAgICAgICAvLyBzdWJzY3JpYmUgdG8gdG9waWNzIHdo\nZW4gYSByZWdpb24gc2h1dHMgZG93bgogICAgICAgIC8vIGl0IHNob3VsZCBz\ndWNjZWVkIHNpbmNlIHRoZSBzdWJzY3JpcHRpb25zIGV4aXN0ZWQgYmVmb3Jl\nCiAgICAgICAgZm9yIChIZWR3aWdDbGllbnQgY2xpZW50IDogcmVnaW9uQ2xp\nZW50c01hcC52YWx1ZXMoKSkgewogICAgICAgICAgICBmb3IgKGludCBpID0g\nMDsgaSA8IGJhdGNoU2l6ZTsgaSsrKSB7CiAgICAgICAgICAgICAgICBjbGll\nbnQuZ2V0U3Vic2NyaWJlcigpLmFzeW5jU3Vic2NyaWJlKEJ5dGVTdHJpbmcu\nY29weUZyb21VdGY4KCJUb3BpYyIgKyBpKSwKICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQnl0ZVN0cmlu\nZy5jb3B5RnJvbVV0ZjgoIkxvY2FsU3Vic2NyaWJlciIpLCBDcmVhdGVPckF0\ndGFjaC5DUkVBVEVfT1JfQVRUQUNILAogICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVGVzdENhbGxi\nYWNrKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAgICAgICAgICBhc3NlcnRUcnVl\nKHF1ZXVlLnRha2UoKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAg\nICAgIC8vIFN0YXJ0IGRlbGl2ZXJ5IGZvciBsb2NhbCBzdWJzY3JpYmVycyBp\nbiBhbGwgcmVnaW9ucwogICAgICAgIGZvciAoTWFwLkVudHJ5PFN0cmluZywg\nSGVkd2lnQ2xpZW50PiBlbnRyeSA6IHJlZ2lvbkNsaWVudHNNYXAuZW50cnlT\nZXQoKSkgewogICAgICAgICAgICBIZWR3aWdDbGllbnQgY2xpZW50ID0gZW50\ncnkuZ2V0VmFsdWUoKTsKICAgICAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkg\nPCBiYXRjaFNpemU7IGkrKykgewogICAgICAgICAgICAgICAgY2xpZW50Lmdl\ndFN1YnNjcmliZXIoKS5zdGFydERlbGl2ZXJ5KEJ5dGVTdHJpbmcuY29weUZy\nb21VdGY4KCJUb3BpYyIgKyBpKSwKICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOCgiTG9jYWxTdWJzY3JpYmVyIiksIG5ldyBUZXN0TWVzc2FnZUhh\nbmRsZXIoY29uc3VtZVF1ZXVlKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9\nCgogICAgICAgIC8vIHN0YXJ0IHJlZ2lvbiBhZ2FpbgogICAgICAgIHN0YXJ0\nUmVnaW9uKHJlZ2lvbklkKTsKICAgICAgICAvLyB3YWl0IGZvciByZXRyeQog\nICAgICAgIFRocmVhZC5zbGVlcCgzICogVEVTVF9SRVRSWV9SRU1PVEVfU1VC\nU0NSSUJFX0lOVEVSVkFMX1ZBTFVFKTsKCiAgICAgICAgU3RyaW5nIHJlZ2lv\nbk5hbWUgPSBSRUdJT05fUFJFRklYICsgcmVnaW9uSWQ7CiAgICAgICAgSGVk\nd2lnQ2xpZW50IGNsaWVudCA9IHJlZ2lvbkNsaWVudHNNYXAuZ2V0KHJlZ2lv\nbk5hbWUpOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgYmF0Y2hTaXpl\nOyBpKyspIHsKICAgICAgICAgICAgY2xpZW50LmdldFN1YnNjcmliZXIoKS5h\nc3luY1N1YnNjcmliZShCeXRlU3RyaW5nLmNvcHlGcm9tVXRmOCgiVG9waWMi\nICsgaSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgICAgICAgICAgQnl0ZVN0cmluZy5jb3B5RnJvbVV0ZjgoIkxvY2FsU3Vi\nc2NyaWJlciIpLCBDcmVhdGVPckF0dGFjaC5DUkVBVEVfT1JfQVRUQUNILAog\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg\nICAgIG5ldyBUZXN0Q2FsbGJhY2socXVldWUpLCBudWxsKTsKICAgICAgICAg\nICAgYXNzZXJ0VHJ1ZShxdWV1ZS50YWtlKCkpOwogICAgICAgICAgICBjbGll\nbnQuZ2V0U3Vic2NyaWJlcigpLnN0YXJ0RGVsaXZlcnkoQnl0ZVN0cmluZy5j\nb3B5RnJvbVV0ZjgoIlRvcGljIiArIGkpLAogICAgICAgICAgICAgICAgICAg\nIEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJMb2NhbFN1YnNjcmliZXIiKSwg\nbmV3IFRlc3RNZXNzYWdlSGFuZGxlcihjb25zdW1lUXVldWUpKTsKICAgICAg\nICB9CgogICAgICAgIC8vIE5vdyBzdGFydCBwdWJsaXNoaW5nIG1lc3NhZ2Vz\nIGZvciB0aGUgc3Vic2NyaWJlZCB0b3BpY3MgaW4gb25lIG9mIHRoZQogICAg\nICAgIC8vIHJlZ2lvbnMgYW5kIHZlcmlmeSB0aGF0IGl0IGdldHMgZGVsaXZl\ncmVkIGFuZCBjb25zdW1lZCBpbiBhbGwgb2YgdGhlCiAgICAgICAgLy8gb3Ro\nZXIgb25lcy4gICAgICAgIAogICAgICAgIFB1Ymxpc2hlciBwdWJsaXNoZXIg\nPSBjbGllbnQuZ2V0UHVibGlzaGVyKCk7CiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCBiYXRjaFNpemU7IGkrKykgewogICAgICAgICAgICBwdWJsaXNo\nZXIuYXN5bmNQdWJsaXNoKEJ5dGVTdHJpbmcuY29weUZyb21VdGY4KCJUb3Bp\nYyIgKyBpKSwgTWVzc2FnZS5uZXdCdWlsZGVyKCkuc2V0Qm9keSgKICAgICAg\nICAgICAgICAgICAgICAgICAgICAgICAgICAgICBCeXRlU3RyaW5nLmNvcHlG\ncm9tVXRmOChyZWdpb25OYW1lICsgIi1NZXNzYWdlIiArIGkpKS5idWlsZCgp\nLCBuZXcgVGVzdENhbGxiYWNrKHF1ZXVlKSwgbnVsbCk7CiAgICAgICAgICAg\nIGFzc2VydFRydWUocXVldWUudGFrZSgpKTsKICAgICAgICB9CiAgICAgICAg\nLy8gTWFrZSBzdXJlIGVhY2ggcmVnaW9uIGNvbnN1bWVzIHRoZSBzYW1lIHNl\ndCBvZiBwdWJsaXNoZWQgbWVzc2FnZXMuCiAgICAgICAgZm9yIChpbnQgaSA9\nIDA7IGkgPCByZWdpb25DbGllbnRzTWFwLnNpemUoKTsgaSsrKSB7CiAgICAg\nICAgICAgIGZvciAoaW50IGogPSAwOyBqIDwgYmF0Y2hTaXplOyBqKyspIHsK\nICAgICAgICAgICAgICAgIGFzc2VydFRydWUoY29uc3VtZVF1ZXVlLnRha2Uo\nKSk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9Cn0K\n","encoding":"base64"}

