{"sha":"0010c931cf1aca125dfba3e1b581acdce934e1cf","node_id":"MDY6Q29tbWl0MjA2MzY0OjAwMTBjOTMxY2YxYWNhMTI1ZGZiYTNlMWI1ODFhY2RjZTkzNGUxY2Y=","commit":{"author":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2010-03-25T22:53:12Z"},"committer":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2010-03-25T22:53:12Z"},"message":"OPENJPA-1599 - Retain em method user input property map content from modifications.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@927629 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"b39af39bada2e20e4b4c61fa3bc7f95818bf08a3","url":"https://api.github.com/repos/apache/openjpa/git/trees/b39af39bada2e20e4b4c61fa3bc7f95818bf08a3"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/0010c931cf1aca125dfba3e1b581acdce934e1cf","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/0010c931cf1aca125dfba3e1b581acdce934e1cf","html_url":"https://github.com/apache/openjpa/commit/0010c931cf1aca125dfba3e1b581acdce934e1cf","comments_url":"https://api.github.com/repos/apache/openjpa/commits/0010c931cf1aca125dfba3e1b581acdce934e1cf/comments","author":null,"committer":null,"parents":[{"sha":"5835eb3b6e9a1b1dd7e848b28ea3c783a3295f8d","url":"https://api.github.com/repos/apache/openjpa/commits/5835eb3b6e9a1b1dd7e848b28ea3c783a3295f8d","html_url":"https://github.com/apache/openjpa/commit/5835eb3b6e9a1b1dd7e848b28ea3c783a3295f8d"}],"stats":{"total":10,"additions":10,"deletions":0},"files":[{"sha":"d26fb0194d338ec08f89f0f369216fb7b6c91322","filename":"openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","status":"modified","additions":10,"deletions":0,"changes":10,"blob_url":"https://github.com/apache/openjpa/blob/0010c931cf1aca125dfba3e1b581acdce934e1cf/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/0010c931cf1aca125dfba3e1b581acdce934e1cf/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence/src/main/java/org/apache/openjpa/persistence/EntityManagerImpl.java?ref=0010c931cf1aca125dfba3e1b581acdce934e1cf","patch":"@@ -33,6 +33,7 @@\n import java.util.Arrays;\n import java.util.Collection;\n import java.util.EnumSet;\n+import java.util.HashMap;\n import java.util.IdentityHashMap;\n import java.util.Map;\n import java.util.Set;\n@@ -487,6 +488,7 @@ public void setLifecycleListenerCallbackMode(int callbackMode) {\n     @SuppressWarnings(\"unchecked\")\n     public <T> T find(Class<T> cls, Object oid, LockModeType mode, Map<String, Object> properties) {\n         assertNotCloseInvoked();\n+        properties = cloneProperties(properties);\n         configureCurrentCacheModes(pushFetchPlan(), properties);\n         configureCurrentFetchPlan(getFetchPlan(), properties, mode, true);\n         try {\n@@ -1186,6 +1188,7 @@ public void lock(Object entity, LockModeType mode, Map<String, Object> propertie\n         assertNotCloseInvoked();\n         assertValidAttchedEntity(LOCK, entity);\n         _broker.assertActiveTransaction();\n+        properties = cloneProperties(properties);\n         configureCurrentCacheModes(pushFetchPlan(), properties);\n         configureCurrentFetchPlan(getFetchPlan(), properties, mode, false);\n         try {\n@@ -1808,4 +1811,11 @@ Object convertUserValue(String key, Object value, Class<?> targetType) {\n         }\n         return value;\n     }\n+\n+    private Map<String, Object> cloneProperties(Map<String, Object> properties) {\n+        if (properties != null) {\n+            properties = new HashMap<String, Object>(properties);\n+        }\n+        return properties;\n+    }\n }"}]}

