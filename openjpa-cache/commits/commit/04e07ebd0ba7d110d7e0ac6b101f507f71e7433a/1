{"sha":"04e07ebd0ba7d110d7e0ac6b101f507f71e7433a","node_id":"MDY6Q29tbWl0MjA2MzY0OjA0ZTA3ZWJkMGJhN2QxMTBkN2UwYWM2YjEwMWY1MDdmNzFlNzQzM2E=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-01-03T02:50:44Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-01-03T02:50:44Z"},"message":"adding forgotten new file for previous commit\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@492027 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"cb69e6f492f002b4d905a4404e92a0d165005d17","url":"https://api.github.com/repos/apache/openjpa/git/trees/cb69e6f492f002b4d905a4404e92a0d165005d17"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a","html_url":"https://github.com/apache/openjpa/commit/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a","comments_url":"https://api.github.com/repos/apache/openjpa/commits/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a/comments","author":null,"committer":null,"parents":[{"sha":"4bbf599c45d74f9b0cd6d9dd9901bcfd0259e2f1","url":"https://api.github.com/repos/apache/openjpa/commits/4bbf599c45d74f9b0cd6d9dd9901bcfd0259e2f1","html_url":"https://github.com/apache/openjpa/commit/4bbf599c45d74f9b0cd6d9dd9901bcfd0259e2f1"}],"stats":{"total":61,"additions":61,"deletions":0},"files":[{"sha":"69b136853490b9bd519d007781b4a94636e38bc0","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/TestMappingToolAutoDelete.java","status":"added","additions":61,"deletions":0,"changes":61,"blob_url":"https://github.com/apache/openjpa/blob/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/TestMappingToolAutoDelete.java","raw_url":"https://github.com/apache/openjpa/raw/04e07ebd0ba7d110d7e0ac6b101f507f71e7433a/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/TestMappingToolAutoDelete.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/jdbc/meta/TestMappingToolAutoDelete.java?ref=04e07ebd0ba7d110d7e0ac6b101f507f71e7433a","patch":"@@ -0,0 +1,61 @@\n+package org.apache.openjpa.jdbc.meta;\n+\n+import java.io.IOException;\n+import java.sql.SQLException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.persistence.EntityManager;\n+import javax.persistence.Persistence;\n+\n+import org.apache.openjpa.jdbc.conf.JDBCConfiguration;\n+import org.apache.openjpa.jdbc.schema.SchemaTool;\n+import org.apache.openjpa.persistence.OpenJPAEntityManagerFactory;\n+import org.apache.openjpa.persistence.OpenJPAPersistence;\n+import org.apache.openjpa.persistence.simple.AllFieldTypes;\n+\n+import junit.framework.TestCase;\n+\n+\n+public class TestMappingToolAutoDelete\n+    extends TestCase {\n+\n+    private JDBCConfiguration _conf;\n+    private OpenJPAEntityManagerFactory emf;\n+\n+    public void setUp() {\n+        Map props = new HashMap();\n+        props.put(\"openjpa.MetaDataFactory\",\n+            \"jpa(Types=\" + AllFieldTypes.class.getName() + \")\");\n+        emf = OpenJPAPersistence.cast( \n+            Persistence.createEntityManagerFactory(\"test\", props));\n+        _conf = (JDBCConfiguration) emf.getConfiguration();\n+        \n+        EntityManager em = emf.createEntityManager();\n+        em.getTransaction().begin();\n+        em.persist(new AllFieldTypes());\n+        em.getTransaction().commit();\n+        em.close();\n+    }\n+    \n+    public void tearDown() {\n+        emf.close();\n+    }\n+\n+    public void testMappingToolAutoDelete() \n+        throws IOException, SQLException {\n+        MappingTool.Flags flags = new MappingTool.Flags();\n+        \n+        // indirect validation that comma-separated schema actions work\n+        flags.schemaAction = SchemaTool.ACTION_ADD + \",\" \n+            + SchemaTool.ACTION_DELETE_TABLE_CONTENTS;\n+        \n+        MappingTool.run(_conf, new String[0], flags, null);\n+\n+        EntityManager em = emf.createEntityManager();\n+        assertEquals(Long.valueOf(0), \n+            em.createQuery(\"select count(o) from AllFieldTypes o\")\n+                .getSingleResult());\n+        em.close();\n+    }\n+}"}]}

