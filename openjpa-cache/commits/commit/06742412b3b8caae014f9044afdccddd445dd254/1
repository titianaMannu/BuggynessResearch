{"sha":"06742412b3b8caae014f9044afdccddd445dd254","node_id":"MDY6Q29tbWl0MjA2MzY0OjA2NzQyNDEyYjNiOGNhYWUwMTRmOTA0NGFmZGNjZGRkNDQ1ZGQyNTQ=","commit":{"author":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2012-04-04T17:15:50Z"},"committer":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2012-04-04T17:15:50Z"},"message":"OPENJPA-2131 - Commit contribution by Zilin Chen.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1309495 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"25e9f58348f53dd7013031127268184ea796710e","url":"https://api.github.com/repos/apache/openjpa/git/trees/25e9f58348f53dd7013031127268184ea796710e"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/06742412b3b8caae014f9044afdccddd445dd254","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/06742412b3b8caae014f9044afdccddd445dd254","html_url":"https://github.com/apache/openjpa/commit/06742412b3b8caae014f9044afdccddd445dd254","comments_url":"https://api.github.com/repos/apache/openjpa/commits/06742412b3b8caae014f9044afdccddd445dd254/comments","author":null,"committer":null,"parents":[{"sha":"8e445e03a1003390407670f72be58d37dfe27569","url":"https://api.github.com/repos/apache/openjpa/commits/8e445e03a1003390407670f72be58d37dfe27569","html_url":"https://github.com/apache/openjpa/commit/8e445e03a1003390407670f72be58d37dfe27569"}],"stats":{"total":37,"additions":24,"deletions":13},"files":[{"sha":"ec05e201e952caf7e9a2d17f37a1a21371f1eb4c","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/06742412b3b8caae014f9044afdccddd445dd254/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/06742412b3b8caae014f9044afdccddd445dd254/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/OracleDictionary.java?ref=06742412b3b8caae014f9044afdccddd445dd254","patch":"@@ -362,10 +362,12 @@ protected SQLBuffer getSelects(Select sel, boolean distinctIdentifiers,\n         for (Iterator itr = aliases.iterator(); itr.hasNext(); i++) {\n             alias = itr.next();\n             String asString = null;\n-            if (alias instanceof SQLBuffer)\n+            if (alias instanceof SQLBuffer) {\n                 asString = ((SQLBuffer) alias).getSQL();\n-            else\n+                selectSQL.appendParamOnly((SQLBuffer) alias);\n+            } else {\n                 asString = alias.toString();\n+            }\n             selectSQL.append(asString);\n             if (asString.indexOf(\" AS \") == -1)\n                 selectSQL.append(\" AS c\").append(String.valueOf(i));"},{"sha":"345877ffcb483659c362c77e7bf2a733b078632a","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java","status":"modified","additions":18,"deletions":9,"changes":27,"blob_url":"https://github.com/apache/openjpa/blob/06742412b3b8caae014f9044afdccddd445dd254/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java","raw_url":"https://github.com/apache/openjpa/raw/06742412b3b8caae014f9044afdccddd445dd254/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SQLBuffer.java?ref=06742412b3b8caae014f9044afdccddd445dd254","patch":"@@ -102,16 +102,23 @@ public boolean isEmpty() {\n      * Append all SQL and parameters of the given buffer.\n      */\n     public SQLBuffer append(SQLBuffer buf) {\n-        append(buf, _sql.length(), (_params == null) ? 0 : _params.size(),\n-            true);\n+        append(buf, _sql.length(), (_params == null) ? 0 : _params.size(), true, false);\n         return this;\n     }\n \n     /**\n-     * Append all SQL and parameters of the given buffer at the given positions.\n+     * Append parameters only if the given buffer at the given positions.\n+    */\n+    public SQLBuffer appendParamOnly(SQLBuffer buf) {\n+        append(buf, _sql.length(), (_params == null) ? 0 : _params.size(), true, true);\n+        return this;\n+    }\n+\n+    /**\n+     * Append parameters and/or SQL of the given buffer at the given positions.\n      */\n     private void append(SQLBuffer buf, int sqlIndex, int paramIndex,\n-        boolean subsels) {\n+        boolean subsels, boolean paramOnly) {\n         if (subsels) {\n             // only allow appending of buffers with subselects, not insertion\n             if (_subsels != null && !_subsels.isEmpty()\n@@ -128,10 +135,12 @@ private void append(SQLBuffer buf, int sqlIndex, int paramIndex,\n             }\n         }\n \n-        if (sqlIndex == _sql.length())\n-            _sql.append(buf._sql.toString());\n-        else\n-            _sql.insert(sqlIndex, buf._sql.toString());\n+        if (!paramOnly) {\n+            if (sqlIndex == _sql.length())\n+                _sql.append(buf._sql.toString());\n+            else\n+                _sql.insert(sqlIndex, buf._sql.toString());\n+        }\n \n         if (buf._params != null) {\n             if (_params == null)\n@@ -404,7 +413,7 @@ private void resolveSubselects() {\n             else\n                 buf = sub.select.toSelect(false, sub.fetch);\n             buf.resolveSubselects();\n-            append(buf, sub.sqlIndex, sub.paramIndex, false);\n+            append(buf, sub.sqlIndex, sub.paramIndex, false, false);\n         }\n         _subsels.clear();\n     }"},{"sha":"6f7f322142f13b4df9ce9f08fc58b3ed525fdb34","filename":"pom.xml","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/06742412b3b8caae014f9044afdccddd445dd254/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/06742412b3b8caae014f9044afdccddd445dd254/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/pom.xml?ref=06742412b3b8caae014f9044afdccddd445dd254","patch":"@@ -522,12 +522,12 @@\n             <dependency>\n                 <groupId>javax.xml.bind</groupId>\n                 <artifactId>jaxb-api</artifactId>\n-                <version>2.0</version>\n+                <version>2.2.1</version>\n             </dependency>\n             <dependency>\n                 <groupId>com.sun.xml.bind</groupId>\n                 <artifactId>jaxb-impl</artifactId>\n-                <version>2.0.5</version>\n+                <version>2.2.1</version>\n             </dependency>\n             <dependency>\n                 <groupId>hsqldb</groupId>"}]}

