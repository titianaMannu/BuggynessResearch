{"sha":"077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a","node_id":"MDY6Q29tbWl0MjA2MzY0OjA3N2Y5ZDdmODIzZGVkYzRkN2E0ZmNkYTk4OWI0YmUwZWJiMWYzMmE=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2010-08-12T22:05:27Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2010-08-12T22:05:27Z"},"message":"OPENJPA-1668: Allow custom sequence SQL strings for DB2 on z/os and iseries. \nSubmitted By: Heath Thomann\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/2.0.x@985013 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"57efd7d3ce648523c2d2428449f49122cb4b8e7c","url":"https://api.github.com/repos/apache/openjpa/git/trees/57efd7d3ce648523c2d2428449f49122cb4b8e7c"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a","html_url":"https://github.com/apache/openjpa/commit/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a","comments_url":"https://api.github.com/repos/apache/openjpa/commits/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"78fe423ce18137694431da7b29e2397bd9c65eec","url":"https://api.github.com/repos/apache/openjpa/commits/78fe423ce18137694431da7b29e2397bd9c65eec","html_url":"https://github.com/apache/openjpa/commit/78fe423ce18137694431da7b29e2397bd9c65eec"}],"stats":{"total":34,"additions":28,"deletions":6},"files":[{"sha":"49d7376855265dbfd00c139bfc86664872fac65b","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":20,"deletions":6,"changes":26,"blob_url":"https://github.com/apache/openjpa/blob/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a","patch":"@@ -84,6 +84,9 @@\n     protected static final String useKeepExclusiveLockClause\n         = \"USE AND KEEP EXCLUSIVE LOCKS\";\n     protected static final String forReadOnlyClause = \"FOR READ ONLY\";\n+    protected static final String defaultSequenceSQL \n+        = \"SELECT SEQSCHEMA AS SEQUENCE_SCHEMA, SEQNAME AS SEQUENCE_NAME FROM SYSCAT.SEQUENCES\";\n+\n     protected String databaseProductName = \"\";\n     protected String databaseProductVersion = \"\";\n     protected int maj = 0;\n@@ -99,8 +102,7 @@ public DB2Dictionary() {\n \n         nextSequenceQuery = \"VALUES NEXTVAL FOR {0}\";\n \n-        sequenceSQL = \"SELECT SEQSCHEMA AS SEQUENCE_SCHEMA, \"\n-            + \"SEQNAME AS SEQUENCE_NAME FROM SYSCAT.SEQUENCES\";\n+        sequenceSQL = defaultSequenceSQL;\n         sequenceSchemaSQL = \"SEQSCHEMA = ?\";\n         sequenceNameSQL = \"SEQNAME = ?\";\n         characterColumnSize = 254;\n@@ -355,8 +357,14 @@ else if (isDB2UDBV82OrLater())\n                 + \"SYSIBM.SYSDUMMY1\";\n             nextSequenceQuery = \"SELECT NEXTVAL FOR {0} FROM \"\n                 + \"SYSIBM.SYSDUMMY1\";\n-            sequenceSQL = \"SELECT SCHEMA AS SEQUENCE_SCHEMA, \"\n-                + \"NAME AS SEQUENCE_NAME FROM SYSIBM.SYSSEQUENCES\";\n+            // allow users to set a non default sequenceSQL. \n+            if (defaultSequenceSQL.equals(sequenceSQL)){            \t\n+\t            sequenceSQL = \"SELECT SCHEMA AS SEQUENCE_SCHEMA, \"\n+\t                + \"NAME AS SEQUENCE_NAME FROM SYSIBM.SYSSEQUENCES\";\n+\t            \n+                if (log.isTraceEnabled())\n+                    log.trace(_loc.get(\"sequencesql-override\", new Object[] {defaultSequenceSQL, sequenceSQL}));\n+            }\n             sequenceSchemaSQL = \"SCHEMA = ?\";\n             sequenceNameSQL = \"NAME = ?\";\n             if (maj == 8) {\n@@ -373,8 +381,14 @@ else if (isDB2UDBV82OrLater())\n                 + \"SYSIBM.SYSDUMMY1\";\n             validationSQL = \"SELECT DISTINCT(CURRENT TIMESTAMP) FROM \"\n                 + \"QSYS2.SYSTABLES\";\n-            sequenceSQL = \"SELECT SEQUENCE_SCHEMA, \"\n-                + \"SEQUENCE_NAME FROM QSYS2.SYSSEQUENCES\";\n+            // allow users to set a non default sequenceSQL.\n+            if (defaultSequenceSQL.equals(sequenceSQL)){            \n+\t            sequenceSQL = \"SELECT SEQUENCE_SCHEMA, \"\n+\t                + \"SEQUENCE_NAME FROM QSYS2.SYSSEQUENCES\";\n+\t            \n+                if (log.isTraceEnabled())\n+                    log.trace(_loc.get(\"sequencesql-override\", new Object[] {defaultSequenceSQL, sequenceSQL}));\n+            }\n             sequenceSchemaSQL = \"SEQUENCE_SCHEMA = ?\";\n             sequenceNameSQL = \"SEQUENCE_NAME = ?\";\n             break;"},{"sha":"4a4cbdf4c4e015a12922f6fc7ed1ade8a9eb4b4c","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","status":"modified","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/apache/openjpa/blob/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties?ref=077f9d7f823dedc4d7a4fcda989b4be0ebb1f32a","patch":"@@ -208,4 +208,12 @@ can_not_get_current_schema: Unable to get current schema. SQLException message i\n cannot-determine-identifier-base-case: Unable to determine the case to use for \\\n     identifiers.  The default value of \"{0}\" will be used.\n can-not-execute: Unable to execute {0}.\n+sequencesql-override: Going to override the DB2 specific default for the \\\n+    DBDictionary.sequenceSQL string, which is: \"{0}\" \\\n+    with the value of: \"{1}\", which is the default sequenceSQL string for DB2 on the give operating system.  \\\n+    If the user intends to use a value of: \"{0}\" by defining it as a DBDictionary property, \\\n+    please change the case of at least one of the charaters of the string defined in \\\n+    the property.  This will allow openJPA to detect a difference between the DB2 default \\\n+    string and the string set in the property and will further allow openJPA to use the \\\n+    string defined by the property rather than the default string for DB2.\n "}]}

