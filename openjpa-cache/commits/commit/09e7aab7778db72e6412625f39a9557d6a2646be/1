{"sha":"09e7aab7778db72e6412625f39a9557d6a2646be","node_id":"MDY6Q29tbWl0MjA2MzY0OjA5ZTdhYWI3Nzc4ZGI3MmU2NDEyNjI1ZjM5YTk1NTdkNmEyNjQ2YmU=","commit":{"author":{"name":"Srinivasa Segu","email":"ssegu@apache.org","date":"2007-02-20T02:00:50Z"},"committer":{"name":"Srinivasa Segu","email":"ssegu@apache.org","date":"2007-02-20T02:00:50Z"},"message":"Capture the version fields into the memento when setting the savepoint and restore the version information into the StateManagerImpl as a part of the rollbackToSavepoint call.\nFix addresses OPENJPA-154.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@509411 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"5267252de5b2b398d1daae0dd47a6e8927f55158","url":"https://api.github.com/repos/apache/openjpa/git/trees/5267252de5b2b398d1daae0dd47a6e8927f55158"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/09e7aab7778db72e6412625f39a9557d6a2646be","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/09e7aab7778db72e6412625f39a9557d6a2646be","html_url":"https://github.com/apache/openjpa/commit/09e7aab7778db72e6412625f39a9557d6a2646be","comments_url":"https://api.github.com/repos/apache/openjpa/commits/09e7aab7778db72e6412625f39a9557d6a2646be/comments","author":null,"committer":null,"parents":[{"sha":"8974a099084986706a14419fa3e2298541ee50e1","url":"https://api.github.com/repos/apache/openjpa/commits/8974a099084986706a14419fa3e2298541ee50e1","html_url":"https://github.com/apache/openjpa/commit/8974a099084986706a14419fa3e2298541ee50e1"}],"stats":{"total":20,"additions":20,"deletions":0},"files":[{"sha":"8066cc650c634ef797c769b8320070ecaff42371","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SavepointFieldManager.java","status":"modified","additions":14,"deletions":0,"changes":14,"blob_url":"https://github.com/apache/openjpa/blob/09e7aab7778db72e6412625f39a9557d6a2646be/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SavepointFieldManager.java","raw_url":"https://github.com/apache/openjpa/raw/09e7aab7778db72e6412625f39a9557d6a2646be/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SavepointFieldManager.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SavepointFieldManager.java?ref=09e7aab7778db72e6412625f39a9557d6a2646be","patch":"@@ -46,6 +46,9 @@\n     private final PCState _state;\n     private PersistenceCapable _copy;\n \n+    private final Object _version;\n+    private final Object _loadVersion;\n+\n     // used to track field value during store/fetch cycle\n     private Object _field = null;\n     private int[] _copyField = null;\n@@ -81,6 +84,9 @@ public SavepointFieldManager(StateManagerImpl sm, boolean copy) {\n         // we need to proxy the fields so that we can track future changes\n         // from this savepoint forward for PNew instances' mutable fields\n         _sm.proxyFields(false, false);\n+\n+        _version = _sm.getVersion ();\n+        _loadVersion = _sm.getLoadVersion ();\n     }\n \n     /**\n@@ -90,6 +96,14 @@ public StateManagerImpl getStateManager() {\n         return _sm;\n     }\n \n+    public Object getVersion() {\n+        return _version;\n+    }\n+\n+    public Object getLoadVersion() {\n+        return _loadVersion;\n+    }\n+\n     /**\n      * Return the persistence capable copy holding the savepoint field values.\n      */"},{"sha":"10edaad11784373a1a094aa63d46a71002fde438","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/09e7aab7778db72e6412625f39a9557d6a2646be/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/09e7aab7778db72e6412625f39a9557d6a2646be/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/StateManagerImpl.java?ref=09e7aab7778db72e6412625f39a9557d6a2646be","patch":"@@ -579,6 +579,10 @@ public void setVersion(Object version) {\n         assignVersionField(version);\n     }\n \n+    Object getLoadVersion() {\n+        return _loadVersion;\n+    }\n+\n     public void setNextVersion(Object version) {\n         assignVersionField(version);\n     }\n@@ -953,6 +957,8 @@ void rollbackToSavepoint(SavepointFieldManager savepoint) {\n         _loaded = loaded;\n         _dirty = savepoint.getDirty();\n         _flush = savepoint.getFlushed();\n+        _version = savepoint.getVersion();\n+        _loadVersion = savepoint.getLoadVersion();\n     }\n \n     /**"}]}

