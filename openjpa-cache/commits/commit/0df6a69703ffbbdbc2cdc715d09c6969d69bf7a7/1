{"sha":"0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7","node_id":"MDY6Q29tbWl0MjA2MzY0OjBkZjZhNjk3MDNmZmJiZGJjMmNkYzcxNWQwOWM2OTY5ZDY5YmY3YTc=","commit":{"author":{"name":"David J. Wisneski","email":"wisneskid@apache.org","date":"2007-04-18T21:26:20Z"},"committer":{"name":"David J. Wisneski","email":"wisneskid@apache.org","date":"2007-04-18T21:26:20Z"},"message":" fix for OPENJPA-222 .Update the getForUpdateClause, instead of overriding the toSelect\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@530163 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"cb988183c6d033e04019e5f0f7086965ab8c3e82","url":"https://api.github.com/repos/apache/openjpa/git/trees/cb988183c6d033e04019e5f0f7086965ab8c3e82"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7","html_url":"https://github.com/apache/openjpa/commit/0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7","comments_url":"https://api.github.com/repos/apache/openjpa/commits/0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7/comments","author":null,"committer":null,"parents":[{"sha":"1af9d83d1b590589d0552c51e674851ae418c834","url":"https://api.github.com/repos/apache/openjpa/commits/1af9d83d1b590589d0552c51e674851ae418c834","html_url":"https://github.com/apache/openjpa/commit/1af9d83d1b590589d0552c51e674851ae418c834"}],"stats":{"total":18,"additions":9,"deletions":9},"files":[{"sha":"60f33dbe647936a0b3ca7162386d06e1880b4a48","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":9,"deletions":9,"changes":18,"blob_url":"https://github.com/apache/openjpa/blob/0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=0df6a69703ffbbdbc2cdc715d09c6969d69bf7a7","patch":"@@ -245,11 +245,7 @@ protected String getForUpdateClause(JDBCFetchConfiguration fetch,\n             else\r\n                 isolationLevel = conf.getTransactionIsolationConstant();\r\n \r\n-            if (!forUpdate) {\r\n-                // This sql is not for update so add FOR Read Only clause\r\n-                forUpdateString.append(\" \").append(forReadOnlyClause)\r\n-                    .append(\" \");\r\n-            } else {\r\n+            if (forUpdate) {\r\n \r\n                 switch(db2ServerType) {\r\n                 case db2ISeriesV5R3AndEarlier:\r\n@@ -266,22 +262,26 @@ protected String getForUpdateClause(JDBCFetchConfiguration fetch,\n                 case db2ZOSV8x:\r\n                 case db2UDBV82AndLater:\r\n                     if (isolationLevel == Connection.TRANSACTION_SERIALIZABLE) {\r\n-                        forUpdateString.append(\" \").append(withRRClause)\r\n+                        forUpdateString.append(\" \").append(forReadOnlyClause)\r\n+                            .append(\" \").append(withRRClause)\r\n                             .append(\" \").append(useKeepUpdateLockClause)\r\n                             .append(\" \");\r\n                     } else {\r\n-                        forUpdateString.append(\" \").append(withRSClause)\r\n+                        forUpdateString.append(\" \").append(forReadOnlyClause)\r\n+                            .append(\" \").append(withRSClause)\r\n                             .append(\" \").append(useKeepUpdateLockClause)\r\n                             .append(\" \");\r\n                     }\r\n                     break;\r\n                 case db2ISeriesV5R4AndLater:\r\n                     if (isolationLevel == Connection.TRANSACTION_SERIALIZABLE) {\r\n-                        forUpdateString.append(\" \").append(withRRClause)\r\n+                        forUpdateString.append(\" \").append(forReadOnlyClause)\r\n+                            .append(\" \").append(withRRClause)\r\n                             .append(\" \").append(useKeepExclusiveLockClause)\r\n                             .append(\" \");\r\n                     } else {\r\n-                        forUpdateString.append(\" \").append(withRSClause)\r\n+                        forUpdateString.append(\" \").append(forReadOnlyClause)\r\n+                            .append(\" \").append(withRSClause)\r\n                             .append(\" \").append(useKeepExclusiveLockClause)\r\n                             .append(\" \");\r\n                     }\r"}]}

