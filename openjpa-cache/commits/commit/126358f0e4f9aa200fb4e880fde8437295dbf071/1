{"sha":"126358f0e4f9aa200fb4e880fde8437295dbf071","node_id":"MDY6Q29tbWl0MjA2MzY0OjEyNjM1OGYwZTRmOWFhMjAwZmI0ZTg4MGZkZTg0MzcyOTVkYmYwNzE=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-03-05T01:21:58Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-03-05T01:21:58Z"},"message":"Fix NPE reported on newsgroup.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@633739 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ede16b19c20ae034032a317f9fbcd43f29a099c6","url":"https://api.github.com/repos/apache/openjpa/git/trees/ede16b19c20ae034032a317f9fbcd43f29a099c6"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/126358f0e4f9aa200fb4e880fde8437295dbf071","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/126358f0e4f9aa200fb4e880fde8437295dbf071","html_url":"https://github.com/apache/openjpa/commit/126358f0e4f9aa200fb4e880fde8437295dbf071","comments_url":"https://api.github.com/repos/apache/openjpa/commits/126358f0e4f9aa200fb4e880fde8437295dbf071/comments","author":null,"committer":null,"parents":[{"sha":"f3dd4c039797ee3498d5bffeac16415474680216","url":"https://api.github.com/repos/apache/openjpa/commits/f3dd4c039797ee3498d5bffeac16415474680216","html_url":"https://github.com/apache/openjpa/commit/f3dd4c039797ee3498d5bffeac16415474680216"}],"stats":{"total":14,"additions":10,"deletions":4},"files":[{"sha":"130e97fa41df7d209e6c9feb67c3cbc906351eea","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/datacache/DataCachePCDataImpl.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/126358f0e4f9aa200fb4e880fde8437295dbf071/openjpa-kernel/src/main/java/org/apache/openjpa/datacache/DataCachePCDataImpl.java","raw_url":"https://github.com/apache/openjpa/raw/126358f0e4f9aa200fb4e880fde8437295dbf071/openjpa-kernel/src/main/java/org/apache/openjpa/datacache/DataCachePCDataImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/datacache/DataCachePCDataImpl.java?ref=126358f0e4f9aa200fb4e880fde8437295dbf071","patch":"@@ -168,7 +168,8 @@ protected void clearInverseRelationCache(OpenJPAStateManager sm,\n                     .indexOf(fmd.getName()) != -1) {\n                     DataCache cache = sm.getMetaData().getDataCache();\n                     Object oid = sm.getContext().getObjectId(sm.fetch(i));\n-                    DataCachePCData data = cache.get(oid);\n+                    DataCachePCData data = cache == null ? null\n+                        : cache.get(oid);\n                     if ((data != null) &&\n                         (data instanceof DataCachePCDataImpl)) {\n                         ((DataCachePCDataImpl) data)"},{"sha":"da65baa92cfdd6288c061eefdfdf33f746c3a05d","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/datacache/QueryCacheStoreQuery.java","status":"modified","additions":8,"deletions":3,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/126358f0e4f9aa200fb4e880fde8437295dbf071/openjpa-kernel/src/main/java/org/apache/openjpa/datacache/QueryCacheStoreQuery.java","raw_url":"https://github.com/apache/openjpa/raw/126358f0e4f9aa200fb4e880fde8437295dbf071/openjpa-kernel/src/main/java/org/apache/openjpa/datacache/QueryCacheStoreQuery.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/datacache/QueryCacheStoreQuery.java?ref=126358f0e4f9aa200fb4e880fde8437295dbf071","patch":"@@ -128,6 +128,9 @@ private List checkCache(QueryKey qk) {\n             // using it because of the individual by-oid lookups\n             ClassMetaData meta = _repos.getMetaData(getContext().\n                 getCandidateType(), _sctx.getClassLoader(), true);\n+            if (meta.getDataCache() == null)\n+                return null;\n+\n             BitSet idxs = meta.getDataCache().containsAll(res);\n \n             // eventually we should optimize this to figure out how many objects\n@@ -333,9 +336,11 @@ private void clearAccessPath(StoreQuery q) {\n                 (q.getContext(), classes));\n \n             // evict from the data cache\n-            for (int i = 0; i < cmd.length; i++)\n-                cmd[i].getDataCache().removeAll(\n-                    cmd[i].getDescribedType(), true);\n+            for (int i = 0; i < cmd.length; i++) {\n+                if (cmd[i].getDataCache() != null)\n+                    cmd[i].getDataCache().removeAll(\n+                        cmd[i].getDescribedType(), true);\n+            }\n         }\n \n         public Number executeDelete(StoreQuery q, Object[] params) {"}]}

