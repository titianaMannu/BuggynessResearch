{"sha":"1583426e01c38dd65d255a2eeb52cca475975fb7","node_id":"MDY6Q29tbWl0MjA2MzY0OjE1ODM0MjZlMDFjMzhkZDY1ZDI1NWEyZWViNTJjY2E0NzU5NzVmYjc=","commit":{"author":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2009-01-14T23:21:13Z"},"committer":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2009-01-14T23:21:13Z"},"message":"OPENJPA-836 after em.clear the datacache is inconsistent\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@734551 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"5e468b3aa4945339d471b92284e47106c2763380","url":"https://api.github.com/repos/apache/openjpa/git/trees/5e468b3aa4945339d471b92284e47106c2763380"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/1583426e01c38dd65d255a2eeb52cca475975fb7","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/1583426e01c38dd65d255a2eeb52cca475975fb7","html_url":"https://github.com/apache/openjpa/commit/1583426e01c38dd65d255a2eeb52cca475975fb7","comments_url":"https://api.github.com/repos/apache/openjpa/commits/1583426e01c38dd65d255a2eeb52cca475975fb7/comments","author":null,"committer":null,"parents":[{"sha":"b65b9b2471009fa3bd4b5da30286527a0b5172d5","url":"https://api.github.com/repos/apache/openjpa/commits/b65b9b2471009fa3bd4b5da30286527a0b5172d5","html_url":"https://github.com/apache/openjpa/commit/b65b9b2471009fa3bd4b5da30286527a0b5172d5"}],"stats":{"total":9,"additions":9,"deletions":0},"files":[{"sha":"1da2b8f7caeda8fcb91cbe547dc5c7195e64e5a4","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/PCDataImpl.java","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/1583426e01c38dd65d255a2eeb52cca475975fb7/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/PCDataImpl.java","raw_url":"https://github.com/apache/openjpa/raw/1583426e01c38dd65d255a2eeb52cca475975fb7/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/PCDataImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/PCDataImpl.java?ref=1583426e01c38dd65d255a2eeb52cca475975fb7","patch":"@@ -269,8 +269,17 @@ protected void storeField(OpenJPAStateManager sm, FieldMetaData fmd) {\n             return;\n \n         int index = fmd.getIndex();\n+        OpenJPAStateManager dsm = null;\n+        if (sm.getPersistenceCapable().pcIsDetached()) {\n+            dsm = (DetachedStateManager) sm.getPersistenceCapable().\n+                pcGetStateManager();\n+            sm.getPersistenceCapable().pcReplaceStateManager(sm);\n+        }\n+\n         Object val = toData(fmd, sm.fetchField(index, false),\n             sm.getContext());\n+        if (dsm != null)\n+            sm.getPersistenceCapable().pcReplaceStateManager(dsm);\n         if (val != NULL)\n             setData(index, val);\n         else // unable to store field value; clear out any old values"}]}

