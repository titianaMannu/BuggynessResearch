{"sha":"1b07ef0bc7f53a71b4301f242e6b04963b2a362a","node_id":"MDY6Q29tbWl0MjA2MzY0OjFiMDdlZjBiYzdmNTNhNzFiNDMwMWYyNDJlNmIwNDk2M2IyYTM2MmE=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2010-08-01T23:21:42Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2010-08-01T23:21:42Z"},"message":"resolve OPENJPA-1756.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@981340 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"dcd007778f3782407ca6b328d4287577665e6e16","url":"https://api.github.com/repos/apache/openjpa/git/trees/dcd007778f3782407ca6b328d4287577665e6e16"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/1b07ef0bc7f53a71b4301f242e6b04963b2a362a","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/1b07ef0bc7f53a71b4301f242e6b04963b2a362a","html_url":"https://github.com/apache/openjpa/commit/1b07ef0bc7f53a71b4301f242e6b04963b2a362a","comments_url":"https://api.github.com/repos/apache/openjpa/commits/1b07ef0bc7f53a71b4301f242e6b04963b2a362a/comments","author":null,"committer":null,"parents":[{"sha":"7d5c4f4dceb04499bdf1e31fb61ef538b8e40ba6","url":"https://api.github.com/repos/apache/openjpa/commits/7d5c4f4dceb04499bdf1e31fb61ef538b8e40ba6","html_url":"https://github.com/apache/openjpa/commit/7d5c4f4dceb04499bdf1e31fb61ef538b8e40ba6"}],"stats":{"total":18,"additions":15,"deletions":3},"files":[{"sha":"f15abe0ca2d1b20f291bc13fb6cc95847be1c234","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Localizer.java","status":"modified","additions":11,"deletions":1,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/1b07ef0bc7f53a71b4301f242e6b04963b2a362a/openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Localizer.java","raw_url":"https://github.com/apache/openjpa/raw/1b07ef0bc7f53a71b4301f242e6b04963b2a362a/openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Localizer.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/util/Localizer.java?ref=1b07ef0bc7f53a71b4301f242e6b04963b2a362a","patch":"@@ -247,6 +247,7 @@ public Message getFatal(String key, Object[] subs) {\n         private final String _key;\n         private final Object[] _subs;\n         private final String _localizedMessage;\n+        private boolean _localizedMessageFound;\n \n         private Message(String packageName, ResourceBundle bundle, String key,\n             Object[] subs, boolean fatal) {\n@@ -258,13 +259,16 @@ private Message(String packageName, ResourceBundle bundle, String key,\n             _subs = subs;\n             if (bundle == null) {\n                 _localizedMessage = key;\n+                _localizedMessageFound = false;\n             } else {\n                 String localized = null;\n                 try {\n                     localized = bundle.getString(key);\n+                    _localizedMessageFound = true;\n                 } catch (MissingResourceException mre) {\n                     if (fatal)\n                         throw mre;\n+                    _localizedMessageFound = false;\n                 }\n                 _localizedMessage = (localized == null) ? key : localized;\n             }\n@@ -274,7 +278,13 @@ private Message(String packageName, ResourceBundle bundle, String key,\n          * The localized message.\n          */\n         public String getMessage() {\n-            return MessageFormat.format(_localizedMessage, _subs);\n+            if (_localizedMessageFound)\n+                return MessageFormat.format(_localizedMessage, _subs);\n+            else if (_subs == null || _subs.length == 0)\n+                return \"localized message key: \" + _localizedMessage;\n+            else\n+                return \"localized message key: \" + _localizedMessage \n+                    + \"; substitutions: \" + Arrays.asList(_subs).toString();\n         }\n \n         /**"},{"sha":"637b5b44bfb92c4917dd3456cdf0cd8bc32554cb","filename":"openjpa-lib/src/test/java/org/apache/openjpa/lib/util/TestLocalizer.java","status":"modified","additions":4,"deletions":2,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/1b07ef0bc7f53a71b4301f242e6b04963b2a362a/openjpa-lib/src/test/java/org/apache/openjpa/lib/util/TestLocalizer.java","raw_url":"https://github.com/apache/openjpa/raw/1b07ef0bc7f53a71b4301f242e6b04963b2a362a/openjpa-lib/src/test/java/org/apache/openjpa/lib/util/TestLocalizer.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/test/java/org/apache/openjpa/lib/util/TestLocalizer.java?ref=1b07ef0bc7f53a71b4301f242e6b04963b2a362a","patch":"@@ -102,7 +102,8 @@ public void testMessageFormat() {\n      */\n     public void testMissingBundle() {\n         Localizer missing = Localizer.forPackage(String.class);\n-        assertEquals(\"foo.bar\", missing.get(\"foo.bar\"));\n+        assertEquals(\"localized message key: foo.bar\", missing.get(\"foo.bar\"));\n+        assertEquals(\"localized message key: foo.bar; substitutions: [baz, 1]\", missing.get(\"foo.bar\", \"baz\", 1));\n         try {\n             missing.getFatal(\"foo.bar\");\n             fail(\"No exception for fatal get on missing bundle.\");\n@@ -114,7 +115,8 @@ public void testMissingBundle() {\n      * Test that a {@link MissingResourceException} is thrown for missing keys.\n      */\n     public void testMissingKey() {\n-        assertEquals(\"foo.bar\", _locals.get(\"foo.bar\"));\n+        assertEquals(\"localized message key: foo.bar\", _locals.get(\"foo.bar\"));\n+        assertEquals(\"localized message key: foo.bar; substitutions: [baz, 1]\", _locals.get(\"foo.bar\", \"baz\", 1));\n         try {\n             _locals.getFatal(\"foo.bar\");\n             fail(\"No exception for fatal get on missing key.\");"}]}

