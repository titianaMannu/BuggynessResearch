{"sha":"1c0b264517c0f07ec91eeb9c94139d447c208c18","node_id":"MDY6Q29tbWl0MjA2MzY0OjFjMGIyNjQ1MTdjMGYwN2VjOTFlZWI5Yzk0MTM5ZDQ0N2MyMDhjMTg=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2008-02-15T04:56:23Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2008-02-15T04:56:23Z"},"message":"OPENJPA-515 clean up imports\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@627952 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"d8275e72f5034282b3a810d4bf5aeb088a61843a","url":"https://api.github.com/repos/apache/openjpa/git/trees/d8275e72f5034282b3a810d4bf5aeb088a61843a"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/1c0b264517c0f07ec91eeb9c94139d447c208c18","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/1c0b264517c0f07ec91eeb9c94139d447c208c18","html_url":"https://github.com/apache/openjpa/commit/1c0b264517c0f07ec91eeb9c94139d447c208c18","comments_url":"https://api.github.com/repos/apache/openjpa/commits/1c0b264517c0f07ec91eeb9c94139d447c208c18/comments","author":null,"committer":null,"parents":[{"sha":"3d2cbcb7a9eba556bb0dace51df0daba0843b148","url":"https://api.github.com/repos/apache/openjpa/commits/3d2cbcb7a9eba556bb0dace51df0daba0843b148","html_url":"https://github.com/apache/openjpa/commit/3d2cbcb7a9eba556bb0dace51df0daba0843b148"}],"stats":{"total":24,"additions":10,"deletions":14},"files":[{"sha":"0c430f48fd26dad77dc516113ff0f9501799dd3e","filename":"openjpa-slice/src/main/java/org/apache/openjpa/slice/jdbc/DistributedStoreManager.java","status":"modified","additions":10,"deletions":14,"changes":24,"blob_url":"https://github.com/apache/openjpa/blob/1c0b264517c0f07ec91eeb9c94139d447c208c18/openjpa-slice/src/main/java/org/apache/openjpa/slice/jdbc/DistributedStoreManager.java","raw_url":"https://github.com/apache/openjpa/raw/1c0b264517c0f07ec91eeb9c94139d447c208c18/openjpa-slice/src/main/java/org/apache/openjpa/slice/jdbc/DistributedStoreManager.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-slice/src/main/java/org/apache/openjpa/slice/jdbc/DistributedStoreManager.java?ref=1c0b264517c0f07ec91eeb9c94139d447c208c18","patch":"@@ -25,7 +25,6 @@\n import java.util.BitSet;\r\n import java.util.Collection;\r\n import java.util.HashMap;\r\n-import java.util.Iterator;\r\n import java.util.List;\r\n import java.util.Map;\r\n import java.util.concurrent.Callable;\r\n@@ -34,7 +33,6 @@\n import java.util.concurrent.Executors;\r\n import java.util.concurrent.Future;\r\n \r\n-import javax.naming.ConfigurationException;\r\n import javax.transaction.Transaction;\r\n import javax.transaction.TransactionManager;\r\n \r\n@@ -64,7 +62,6 @@\n import org.apache.openjpa.slice.DistributionPolicy;\r\n import org.apache.openjpa.slice.ProductDerivation;\r\n import org.apache.openjpa.slice.transaction.DistributedNaiveTransaction;\r\n-import org.apache.openjpa.slice.transaction.DistributedTransactionManager;\r\n import org.apache.openjpa.slice.transaction.NaiveTransactionManager;\r\n import org.apache.openjpa.util.InternalException;\r\n import org.apache.openjpa.util.StoreException;\r\n@@ -105,11 +102,12 @@ public DistributedStoreManager(DistributedJDBCConfiguration conf) {\n         _conf = conf;\r\n         _log = conf.getLog(OpenJPAConfiguration.LOG_RUNTIME);\r\n         _slices = new ArrayList<SliceStoreManager>();\r\n-        for (String name : conf.getActiveSliceNames()) {\r\n+        List<String> sliceNames = conf.getActiveSliceNames();\r\n+        for (String name : sliceNames) {\r\n             SliceStoreManager slice = new SliceStoreManager\r\n                 (conf.getSlice(name));\r\n             _slices.add(slice);\r\n-            if (slice.getName().equals(conf.getMaster().getName()))\r\n+            if (name.equals(conf.getMaster().getName()))\r\n                 _master = slice;\r\n         }\r\n     }\r\n@@ -140,15 +138,13 @@ private boolean hasSlice(OpenJPAStateManager sm) {\n     }\r\n \r\n     private String assignSlice(OpenJPAStateManager sm) {\r\n-        PersistenceCapable pc = sm.getPersistenceCapable();\r\n-        String slice =\r\n-                _conf.getDistributionPolicyInstance().distribute(pc,\r\n-                        _conf.getActiveSliceNames(), getContext());\r\n-        if (!_conf.getActiveSliceNames().contains(slice)) {\r\n+        Object pc = sm.getPersistenceCapable();\r\n+        DistributionPolicy policy = _conf.getDistributionPolicyInstance();\r\n+        List<String> sliceNames = _conf.getActiveSliceNames();\r\n+        String slice =policy.distribute(pc, sliceNames, getContext());\r\n+        if (!sliceNames.contains(slice)) {\r\n             throw new UserException(_loc.get(\"bad-policy-slice\", new Object[] {\r\n-                    _conf.getDistributionPolicyInstance().getClass().getName(),\r\n-                    slice, sm.getPersistenceCapable(), \r\n-                    _conf.getActiveSliceNames() }));\r\n+                    policy.getClass().getName(), slice, pc, sliceNames }));\r\n         }\r\n         sm.setImplData(slice, true);\r\n         return slice;\r\n@@ -275,9 +271,9 @@ public Object copyDataStoreId(Object oid, ClassMetaData meta) {\n \r\n     public ResultObjectProvider executeExtent(ClassMetaData meta,\r\n             boolean subclasses, FetchConfiguration fetch) {\r\n-        ResultObjectProvider[] tmp = new ResultObjectProvider[_slices.size()];\r\n         int i = 0;\r\n         List<SliceStoreManager> targets = getTargets(fetch);\r\n+        ResultObjectProvider[] tmp = new ResultObjectProvider[targets.size()];\r\n         for (SliceStoreManager slice : targets) {\r\n             tmp[i++] = slice.executeExtent(meta, subclasses, fetch);\r\n         }\r"}]}

