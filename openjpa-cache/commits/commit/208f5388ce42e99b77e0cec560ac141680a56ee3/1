{"sha":"208f5388ce42e99b77e0cec560ac141680a56ee3","node_id":"MDY6Q29tbWl0MjA2MzY0OjIwOGY1Mzg4Y2U0MmU5OWI3N2UwY2VjNTYwYWMxNDE2ODBhNTZlZTM=","commit":{"author":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2010-03-01T21:29:01Z"},"committer":{"name":"Jeremy Bauer","email":"jrbauer@apache.org","date":"2010-03-01T21:29:01Z"},"message":"OPENJPA-1540 Modified Informix dictionary to detect non-delimited identifier case for the Informix driver.  Also added missing method override.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@917727 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"b9fa3a034634f87a95da46abac3f5fe27d23e6e2","url":"https://api.github.com/repos/apache/openjpa/git/trees/b9fa3a034634f87a95da46abac3f5fe27d23e6e2"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/208f5388ce42e99b77e0cec560ac141680a56ee3","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/208f5388ce42e99b77e0cec560ac141680a56ee3","html_url":"https://github.com/apache/openjpa/commit/208f5388ce42e99b77e0cec560ac141680a56ee3","comments_url":"https://api.github.com/repos/apache/openjpa/commits/208f5388ce42e99b77e0cec560ac141680a56ee3/comments","author":null,"committer":null,"parents":[{"sha":"18a1a04c773dd5c3e2288173f64f58f822cefb50","url":"https://api.github.com/repos/apache/openjpa/commits/18a1a04c773dd5c3e2288173f64f58f822cefb50","html_url":"https://github.com/apache/openjpa/commit/18a1a04c773dd5c3e2288173f64f58f822cefb50"}],"stats":{"total":46,"additions":40,"deletions":6},"files":[{"sha":"e3ec490954856d6d410b44d5264e2d661261c3a6","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java","status":"modified","additions":37,"deletions":5,"changes":42,"blob_url":"https://github.com/apache/openjpa/blob/208f5388ce42e99b77e0cec560ac141680a56ee3/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/208f5388ce42e99b77e0cec560ac141680a56ee3/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java?ref=208f5388ce42e99b77e0cec560ac141680a56ee3","patch":"@@ -29,6 +29,7 @@\n import java.util.Collection;\n import java.util.Set;\n \n+import org.apache.openjpa.jdbc.identifier.DBIdentifier;\n import org.apache.openjpa.jdbc.identifier.DBIdentifier.DBIdentifierType;\n import org.apache.openjpa.jdbc.kernel.exps.FilterValue;\n import org.apache.openjpa.jdbc.schema.Column;\n@@ -167,11 +168,13 @@ public void connectedConfiguration(Connection conn)\n             { \n                 driverVendor = VENDOR_IBM;\n                 useJCC = true;\n-                try {\n-                    if (meta.storesLowerCaseIdentifiers()) \n-                        schemaCase = SCHEMA_CASE_LOWER;\n-                } catch (SQLException e) {}\n-            } else if (\"Informix\".equalsIgnoreCase(driverName))\n+                setIdentifierCase(meta);\n+            } \n+            else if (driverName.equals(\"IBM Informix JDBC Driver for IBM Informix Dynamic Server\")) {\n+                setIdentifierCase(meta);\n+                driverVendor = VENDOR_IBM;\n+            }\n+            else if (\"Informix\".equalsIgnoreCase(driverName))\n                 driverVendor = VENDOR_DATADIRECT;\n             else\n                 driverVendor = VENDOR_OTHER;\n@@ -186,11 +189,40 @@ public void connectedConfiguration(Connection conn)\n                     conn.getTransactionIsolation()}));\n         }\n     }\n+    \n+    private void setIdentifierCase(DatabaseMetaData meta) {\n+        try {\n+            // lower case identifiers is the default for the JCC and newer\n+            // Informix JDBC drivers\n+            if (meta.storesLowerCaseIdentifiers()) { \n+                schemaCase = SCHEMA_CASE_LOWER;\n+            }\n+            else if (meta.storesMixedCaseIdentifiers()) {\n+                schemaCase = SCHEMA_CASE_PRESERVE;\n+            }\n+            // otherwise, use the default (upper)\n+        }\n+        catch (SQLException e) {\n+            getLog().warn(\"cannot-determine-identifier-base-case\");\n+            if (getLog().isTraceEnabled()) {\n+                getLog().trace(e.toString(), e);\n+            }\n+        }\n+    }\n \n     @Override\n     public Column[] getColumns(DatabaseMetaData meta, String catalog,\n         String schemaName, String tableName, String columnName, Connection conn)\n         throws SQLException {\n+        return getColumns(meta, DBIdentifier.newCatalog(catalog), \n+            DBIdentifier.newSchema(schemaName),DBIdentifier.newTable(tableName),\n+            DBIdentifier.newColumn(columnName), conn);\n+    }\n+\n+    @Override\n+    public Column[] getColumns(DatabaseMetaData meta, DBIdentifier catalog,\n+        DBIdentifier schemaName, DBIdentifier tableName, DBIdentifier columnName, Connection conn)\n+        throws SQLException {\n         Column[] cols = super.getColumns(meta, catalog, schemaName, tableName,\n             columnName, conn);\n "},{"sha":"de0ace73d0ff689fe68c0566898f289784250851","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/208f5388ce42e99b77e0cec560ac141680a56ee3/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/208f5388ce42e99b77e0cec560ac141680a56ee3/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties?ref=208f5388ce42e99b77e0cec560ac141680a56ee3","patch":"@@ -204,4 +204,6 @@ cannot-determine-identifier-case: Unable to determine the case to use for delimi\n     identifiers.  The default value of \"preserve\" will be used.\n unknown-delim-support: Unable to determine whether delimited identifiers are supported. \\\n     The use of delimiters will not be supported.\n-can_not_get_current_schema: Unable to get current schema. SQLException message is \"{0}\".\n\\ No newline at end of file\n+can_not_get_current_schema: Unable to get current schema. SQLException message is \"{0}\".\n+cannot-determine-identifier-base-case: Unable to determine the case to use for \\\n+    identifiers.  The default value of \"{0}\" will be used."}]}

