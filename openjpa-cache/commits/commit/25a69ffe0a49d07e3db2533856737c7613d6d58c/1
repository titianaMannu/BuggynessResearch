{"sha":"25a69ffe0a49d07e3db2533856737c7613d6d58c","node_id":"MDY6Q29tbWl0MjA2MzY0OjI1YTY5ZmZlMGE0OWQwN2UzZGIyNTMzODU2NzM3Yzc2MTNkNmQ1OGM=","commit":{"author":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-07-02T03:51:05Z"},"committer":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-07-02T03:51:05Z"},"message":"OPENJPA-648 Table generator uses incorrect schema name\ncommit OPENJPA-648_1.2.0.patch provided by Jeremy Bauer\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@673267 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"957a32c4c49c54fe63037e6d1cfc68f8cc5594c4","url":"https://api.github.com/repos/apache/openjpa/git/trees/957a32c4c49c54fe63037e6d1cfc68f8cc5594c4"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/25a69ffe0a49d07e3db2533856737c7613d6d58c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/25a69ffe0a49d07e3db2533856737c7613d6d58c","html_url":"https://github.com/apache/openjpa/commit/25a69ffe0a49d07e3db2533856737c7613d6d58c","comments_url":"https://api.github.com/repos/apache/openjpa/commits/25a69ffe0a49d07e3db2533856737c7613d6d58c/comments","author":null,"committer":null,"parents":[{"sha":"de790be2adcdb631bc486f806ab42bef4e694ee0","url":"https://api.github.com/repos/apache/openjpa/commits/de790be2adcdb631bc486f806ab42bef4e694ee0","html_url":"https://github.com/apache/openjpa/commit/de790be2adcdb631bc486f806ab42bef4e694ee0"}],"stats":{"total":287,"additions":278,"deletions":9},"files":[{"sha":"8d0ff32c0c07186fb541d90e5c63c2a50ac6e4ea","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java","raw_url":"https://github.com/apache/openjpa/raw/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/TableJDBCSeq.java?ref=25a69ffe0a49d07e3db2533856737c7613d6d58c","patch":"@@ -595,6 +595,8 @@ public String resolveTableName(ClassMapping mapping, Table table) {\n         String tableName;\n         if (sName == null)\n             tableName = table.getFullName();\n+        else if (table.getSchemaName() != null)\n+            tableName = table.getFullName();\n         else\n             tableName = sName + \".\" + table.getName();\n         return tableName;"},{"sha":"83c2ad83a824f0d574a04cb259d94583d226a51c","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable3.java","status":"added","additions":87,"deletions":0,"changes":87,"blob_url":"https://github.com/apache/openjpa/blob/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable3.java","raw_url":"https://github.com/apache/openjpa/raw/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable3.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable3.java?ref=25a69ffe0a49d07e3db2533856737c7613d6d58c","patch":"@@ -0,0 +1,87 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ * http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+package org.apache.openjpa.persistence.generationtype;\r\n+\r\n+import java.io.*;\r\n+import javax.persistence.*;\r\n+\r\n+/**\r\n+ * Extension of Animal class illustrating inheritance.\r\n+ */\r\n+@Entity(name = \"DogTable3\")\r\n+@Table(name = \"DOGTABLES\", schema = \"SCHEMA3\")\r\n+public class DogTable3 implements Serializable\r\n+\r\n+{\r\n+    @Id\r\n+    @TableGenerator(name = \"Dog_Gen3\", table = \"ID_Gen3\", schema=\"SCHEMA3G\",\r\n+            pkColumnName = \"GEN_NAME\", valueColumnName = \"GEN_VAL\", \r\n+            pkColumnValue = \"ID2\", initialValue = 100, allocationSize = 10)\r\n+    @GeneratedValue(strategy = GenerationType.TABLE, generator = \"Dog_Gen3\")\r\n+    private int id2;\r\n+\r\n+    private String name;\r\n+\r\n+    private float price;\r\n+\r\n+    private boolean domestic;\r\n+\r\n+    public DogTable3() {\r\n+        super();\r\n+\r\n+    }\r\n+\r\n+    public DogTable3(String name) {\r\n+        this.name = name;\r\n+\r\n+    }\r\n+\r\n+    public int getId2() {\r\n+        return id2;\r\n+    }\r\n+\r\n+    public void setId2(int id) {\r\n+        this.id2 = id;\r\n+    }\r\n+\r\n+    public String getName() {\r\n+        return name;\r\n+    }\r\n+\r\n+    public void setName(String name) {\r\n+        this.name = name;\r\n+    }\r\n+\r\n+    public float getPrice() {\r\n+        return price;\r\n+    }\r\n+\r\n+    public void setPrice(float price) {\r\n+\r\n+        this.price = price;\r\n+    }\r\n+\r\n+    public boolean isDomestic() {\r\n+        return domestic;\r\n+    }\r\n+\r\n+    public void setDomestic(boolean domestic) {\r\n+        this.domestic = domestic;\r\n+    }\r\n+}\r"},{"sha":"8d08cd38825fbaa1ce251264d6fda9201df7fcde","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable4.java","status":"added","additions":87,"deletions":0,"changes":87,"blob_url":"https://github.com/apache/openjpa/blob/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable4.java","raw_url":"https://github.com/apache/openjpa/raw/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable4.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/DogTable4.java?ref=25a69ffe0a49d07e3db2533856737c7613d6d58c","patch":"@@ -0,0 +1,87 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ * http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+package org.apache.openjpa.persistence.generationtype;\r\n+\r\n+import java.io.*;\r\n+import javax.persistence.*;\r\n+\r\n+/**\r\n+ * Extension of Animal class illustrating inheritance.\r\n+ */\r\n+@Entity(name = \"DogTable4\")\r\n+@Table(name = \"DOGTABLES4\")\r\n+public class DogTable4 implements Serializable\r\n+\r\n+{\r\n+    @Id\r\n+    @TableGenerator(name = \"Dog_Gen4\", table = \"ID_Gen4\", schema=\"SCHEMA4G\",\r\n+            pkColumnName = \"GEN_NAME\", valueColumnName = \"GEN_VAL\", \r\n+            pkColumnValue = \"ID2\", initialValue = 100, allocationSize = 10)\r\n+    @GeneratedValue(strategy = GenerationType.TABLE, generator = \"Dog_Gen4\")\r\n+    private int id2;\r\n+\r\n+    private String name;\r\n+\r\n+    private float price;\r\n+\r\n+    private boolean domestic;\r\n+\r\n+    public DogTable4() {\r\n+        super();\r\n+\r\n+    }\r\n+\r\n+    public DogTable4(String name) {\r\n+        this.name = name;\r\n+\r\n+    }\r\n+\r\n+    public int getId2() {\r\n+        return id2;\r\n+    }\r\n+\r\n+    public void setId2(int id) {\r\n+        this.id2 = id;\r\n+    }\r\n+\r\n+    public String getName() {\r\n+        return name;\r\n+    }\r\n+\r\n+    public void setName(String name) {\r\n+        this.name = name;\r\n+    }\r\n+\r\n+    public float getPrice() {\r\n+        return price;\r\n+    }\r\n+\r\n+    public void setPrice(float price) {\r\n+\r\n+        this.price = price;\r\n+    }\r\n+\r\n+    public boolean isDomestic() {\r\n+        return domestic;\r\n+    }\r\n+\r\n+    public void setDomestic(boolean domestic) {\r\n+        this.domestic = domestic;\r\n+    }\r\n+}\r"},{"sha":"ba841886bb0ccfd310cd22cc9bd953f222df32cb","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/TestMultipleSchemaNames.java","status":"modified","additions":102,"deletions":9,"changes":111,"blob_url":"https://github.com/apache/openjpa/blob/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/TestMultipleSchemaNames.java","raw_url":"https://github.com/apache/openjpa/raw/25a69ffe0a49d07e3db2533856737c7613d6d58c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/TestMultipleSchemaNames.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/generationtype/TestMultipleSchemaNames.java?ref=25a69ffe0a49d07e3db2533856737c7613d6d58c","patch":"@@ -26,7 +26,8 @@\n \n public class TestMultipleSchemaNames extends SingleEMFTestCase {\n     public void setUp() {\n-        setUp(Dog1.class, Dog2.class, DogTable.class, DogTable2.class);\n+        setUp(Dog1.class, Dog2.class, DogTable.class, DogTable2.class,\n+                DogTable3.class, DogTable4.class);\n \n         EntityManager em = emf.createEntityManager();\n         em.getTransaction().begin();\n@@ -60,6 +61,22 @@ public void setUp() {\n             em.remove(Obj);\n         }\n \n+        Query qry5 = em.createQuery(\"select d from DogTable3 d\");\n+        List result5 = qry5.getResultList();\n+\n+        for (int index = 0; index < result5.size(); index++) {\n+            DogTable3 Obj = (DogTable3) result5.get(index);\n+            em.remove(Obj);\n+        }\n+\n+        Query qry6 = em.createQuery(\"select d from DogTable4 d\");\n+        List result6 = qry6.getResultList();\n+\n+        for (int index = 0; index < result6.size(); index++) {\n+            DogTable4 Obj = (DogTable4) result6.get(index);\n+            em.remove(Obj);\n+        }\n+\n         Query delschema1 = em\n                 .createNativeQuery(\"delete from schema1.openjpa_sequence_table\");\n         delschema1.executeUpdate();\n@@ -71,8 +88,15 @@ public void setUp() {\n         Query delgentable2 = em\n                 .createNativeQuery(\"delete from schema2.id_gen2\");\n         delgentable2.executeUpdate();\n+        Query delgentable3 = em\n+                .createNativeQuery(\"delete from schema3g.id_gen3\");\n+        delgentable3.executeUpdate();\n+        Query delgentable4 = em\n+                .createNativeQuery(\"delete from schema4g.id_gen4\");\n+        delgentable4.executeUpdate();\n \n         em.getTransaction().commit();\n+        em.close();\n \n     }\n \n@@ -177,8 +201,30 @@ public void testGeneratedTABLE() {\n         dog2a.setName(\"helloDog4\");\n         dog2a.setPrice(25000);\n         em.persist(dog2a);\n-        em.getTransaction().commit();\n \n+        // add dog3\n+        DogTable3 dog3 = new DogTable3();\n+        dog3.setName(\"helloDog5\");\n+        dog3.setPrice(15001);\n+        em.persist(dog3);\n+\n+        DogTable3 dog3a = new DogTable3();\n+        dog3a.setName(\"helloDog6\");\n+        dog3a.setPrice(25001);\n+        em.persist(dog3a);\n+\n+        // add dog4\n+        DogTable4 dog4 = new DogTable4();\n+        dog4.setName(\"helloDog7\");\n+        dog4.setPrice(15002);\n+        em.persist(dog4);\n+\n+        DogTable4 dog4a = new DogTable4();\n+        dog4a.setName(\"helloDog8\");\n+        dog4a.setPrice(25002);\n+        em.persist(dog4a);\n+        em.getTransaction().commit();        \n+        \n         DogTable dog1x = em.find(DogTable.class, kem.getObjectId(dog1));\n         assertTrue(dog1x.getId2() == 20 || dog1x.getId2() == 21);\n         assertEquals(dog1x.getName(), \"helloDog1\");\n@@ -189,28 +235,53 @@ public void testGeneratedTABLE() {\n         assertEquals(dog11.getName(), \"helloDog2\");\n         dog11.setName(\"Dog2\");\n         dog11.setDomestic(true);\n+        \n         // update dog2\n         DogTable2 dog2x = em.find(DogTable2.class, kem.getObjectId(dog2));\n         assertTrue(dog2x.getId2() == 100 || dog2x.getId2() == 101);\n         assertEquals(dog2x.getName(), \"helloDog3\");\n         dog2x.setName(\"Dog3\");\n         dog2x.setDomestic(true);\n         DogTable2 dog21 = em.find(DogTable2.class, kem.getObjectId(dog2a));\n-        assertTrue(dog2x.getId2() == 100 || dog2x.getId2() == 101);\n+        assertTrue(dog21.getId2() == 100 || dog21.getId2() == 101);\n         assertEquals(dog21.getName(), \"helloDog4\");\n         dog21.setName(\"Dog4\");\n         dog21.setDomestic(true);\n \n+        // update dog3\n+        DogTable3 dog3x = em.find(DogTable3.class, kem.getObjectId(dog3));\n+        assertTrue(dog3x.getId2() == 100 || dog3x.getId2() == 101);\n+        assertEquals(dog3x.getName(), \"helloDog5\");\n+        dog3x.setName(\"Dog5\");\n+        dog3x.setDomestic(true);\n+        DogTable3 dog31 = em.find(DogTable3.class, kem.getObjectId(dog3a));\n+        assertTrue(dog31.getId2() == 100 || dog31.getId2() == 101);\n+        assertEquals(dog31.getName(), \"helloDog6\");\n+        dog31.setName(\"Dog6\");\n+        dog31.setDomestic(true);\n+\n+        // update dog4\n+        DogTable4 dog4x = em.find(DogTable4.class, kem.getObjectId(dog4));\n+        assertTrue(dog4x.getId2() == 100 || dog4x.getId2() == 101);\n+        assertEquals(dog4x.getName(), \"helloDog7\");\n+        dog4x.setName(\"Dog7\");\n+        dog4x.setDomestic(true);\n+        DogTable4 dog41 = em.find(DogTable4.class, kem.getObjectId(dog4a));\n+        assertTrue(dog41.getId2() == 100 || dog41.getId2() == 101);\n+        assertEquals(dog41.getName(), \"helloDog8\");\n+        dog41.setName(\"Dog8\");\n+        dog41.setDomestic(true);\n+\n         // get the update dog name\n \n         em.getTransaction().begin();\n         Query qry1 = em.createQuery(\"select d from DogTable d order by d.name\");\n         List result1 = qry1.getResultList();\n         for (int index = 0; index < result1.size(); index++) {\n-            DogTable dog4 = (DogTable) result1.get(index);\n-            assertTrue(dog4.getId2() == 20 || dog4.getId2() == 21);\n+            DogTable dog1xx = (DogTable) result1.get(index);\n+            assertTrue(dog1xx.getId2() == 20 || dog1xx.getId2() == 21);\n             int j = index + 1;\n-            assertEquals(dog4.getName(), \"Dog\" + j);\n+            assertEquals(dog1xx.getName(), \"Dog\" + j);\n \n         }\n \n@@ -219,10 +290,32 @@ public void testGeneratedTABLE() {\n         List result2 = qry2.getResultList();\n \n         for (int index = 0; index < result2.size(); index++) {\n-            DogTable2 dog5 = (DogTable2) result2.get(index);\n-            assertTrue(dog5.getId2() == 100 || dog5.getId2() == 101);\n+            DogTable2 dog2xx = (DogTable2) result2.get(index);\n+            assertTrue(dog2xx.getId2() == 100 || dog2xx.getId2() == 101);\n             int j = index + 3;\n-            assertEquals(dog5.getName(), \"Dog\" + j);\n+            assertEquals(dog2xx.getName(), \"Dog\" + j);\n+        }\n+\n+        Query qry3 = em\n+                .createQuery(\"select d from DogTable3 d order by d.name\");\n+        List result3 = qry3.getResultList();\n+\n+        for (int index = 0; index < result3.size(); index++) {\n+            DogTable3 dog3xx = (DogTable3) result3.get(index);\n+            assertTrue(dog3xx.getId2() == 100 || dog3xx.getId2() == 101);\n+            int j = index + 5;\n+            assertEquals(dog3xx.getName(), \"Dog\" + j);\n+        }\n+\n+        Query qry4 = em\n+                .createQuery(\"select d from DogTable4 d order by d.name\");\n+        List result4 = qry4.getResultList();\n+\n+        for (int index = 0; index < result4.size(); index++) {\n+            DogTable4 dog4xx = (DogTable4) result4.get(index);\n+            assertTrue(dog4xx.getId2() == 100 || dog4xx.getId2() == 101);\n+            int j = index + 7;\n+            assertEquals(dog4xx.getName(), \"Dog\" + j);\n         }\n \n         em.getTransaction().commit();"}]}

