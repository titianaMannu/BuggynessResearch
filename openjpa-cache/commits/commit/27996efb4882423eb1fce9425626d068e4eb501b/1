{"sha":"27996efb4882423eb1fce9425626d068e4eb501b","node_id":"MDY6Q29tbWl0MjA2MzY0OjI3OTk2ZWZiNDg4MjQyM2ViMWZjZTk0MjU2MjZkMDY4ZTRlYjUwMWI=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-11-17T23:09:57Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-11-17T23:09:57Z"},"message":"OPENJPA-1384:\nTry current classloader when loading DBDictionary.\nSubmitted By: B.J. Reed\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@881613 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"eb10184215910814815e90e366426103d2a70c66","url":"https://api.github.com/repos/apache/openjpa/git/trees/eb10184215910814815e90e366426103d2a70c66"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/27996efb4882423eb1fce9425626d068e4eb501b","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/27996efb4882423eb1fce9425626d068e4eb501b","html_url":"https://github.com/apache/openjpa/commit/27996efb4882423eb1fce9425626d068e4eb501b","comments_url":"https://api.github.com/repos/apache/openjpa/commits/27996efb4882423eb1fce9425626d068e4eb501b/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"ee30b010dcbd58258c5d940d121e02f70b8160d9","url":"https://api.github.com/repos/apache/openjpa/commits/ee30b010dcbd58258c5d940d121e02f70b8160d9","html_url":"https://github.com/apache/openjpa/commit/ee30b010dcbd58258c5d940d121e02f70b8160d9"}],"stats":{"total":12,"additions":12,"deletions":0},"files":[{"sha":"7da4db0ba0e640016da329d2584f17d688e3a159","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java","status":"modified","additions":12,"deletions":0,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/27996efb4882423eb1fce9425626d068e4eb501b/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java","raw_url":"https://github.com/apache/openjpa/raw/27996efb4882423eb1fce9425626d068e4eb501b/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionaryFactory.java?ref=27996efb4882423eb1fce9425626d068e4eb501b","patch":"@@ -154,6 +154,18 @@ private static DBDictionary newDBDictionary(JDBCConfiguration conf,\n                         DBDictionary.class)));\n             dict = (DBDictionary) AccessController.doPrivileged(\n                 J2DoPrivHelper.newInstanceAction(c));\n+        } catch (ClassNotFoundException cnfe) {\n+            // if the dictionary was not found, make another attempt\n+            // at loading the dictionary using the current thread.\n+            try {\n+                Class c = Thread.currentThread().getContextClassLoader().loadClass(dclass);\n+                dict = (DBDictionary) AccessController.doPrivileged(\n+                        J2DoPrivHelper.newInstanceAction(c));\n+            } catch (Exception e) {\n+                if (e instanceof PrivilegedActionException)\n+                    e = ((PrivilegedActionException) e).getException();\n+                throw new UserException(e).setFatal(true);\n+            }\n         } catch (Exception e) {\n             if (e instanceof PrivilegedActionException)\n                 e = ((PrivilegedActionException) e).getException();"}]}

