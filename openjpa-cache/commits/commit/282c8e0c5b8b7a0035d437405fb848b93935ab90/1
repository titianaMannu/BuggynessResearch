{"sha":"282c8e0c5b8b7a0035d437405fb848b93935ab90","node_id":"MDY6Q29tbWl0MjA2MzY0OjI4MmM4ZTBjNWI4YjdhMDAzNWQ0Mzc0MDVmYjg0OGI5MzkzNWFiOTA=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-03-11T18:29:19Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-03-11T18:29:19Z"},"message":"Improve product derivation debugging; add test case.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@636052 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"ba775a8a10ef91b43650a8fd936f52fc4b1566c5","url":"https://api.github.com/repos/apache/openjpa/git/trees/ba775a8a10ef91b43650a8fd936f52fc4b1566c5"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/282c8e0c5b8b7a0035d437405fb848b93935ab90","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/282c8e0c5b8b7a0035d437405fb848b93935ab90","html_url":"https://github.com/apache/openjpa/commit/282c8e0c5b8b7a0035d437405fb848b93935ab90","comments_url":"https://api.github.com/repos/apache/openjpa/commits/282c8e0c5b8b7a0035d437405fb848b93935ab90/comments","author":null,"committer":null,"parents":[{"sha":"ba5d11b43b0d6182812998c347a94d4af768c6fe","url":"https://api.github.com/repos/apache/openjpa/commits/ba5d11b43b0d6182812998c347a94d4af768c6fe","html_url":"https://github.com/apache/openjpa/commit/ba5d11b43b0d6182812998c347a94d4af768c6fe"}],"stats":{"total":110,"additions":106,"deletions":4},"files":[{"sha":"c72f91b26a36a114fa7c43985ce31ab5f1adadae","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java","status":"modified","additions":6,"deletions":4,"changes":10,"blob_url":"https://github.com/apache/openjpa/blob/282c8e0c5b8b7a0035d437405fb848b93935ab90/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java","raw_url":"https://github.com/apache/openjpa/raw/282c8e0c5b8b7a0035d437405fb848b93935ab90/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ProductDerivations.java?ref=282c8e0c5b8b7a0035d437405fb848b93935ab90","patch":"@@ -268,9 +268,10 @@ public static ConfigurationProvider load(String resource, String anchor,\n             }\n         }\n         reportErrors(errs, resource, err);\n+        String rsrc = resource + \"#\" + anchor;\n         throw (MissingResourceException) JavaVersions.initCause\n-            (new MissingResourceException(resource,\n-                ProductDerivations.class.getName(), resource), err);\n+            (new MissingResourceException(rsrc,\n+                ProductDerivations.class.getName(), rsrc), err);\n     }\n \n     /**\n@@ -304,9 +305,10 @@ public static ConfigurationProvider load(File file, String anchor,\n         String aPath = (String) AccessController.doPrivileged(\n             J2DoPrivHelper.getAbsolutePathAction(file));\n         reportErrors(errs, aPath, err);\n+        String rsrc = aPath + \"#\" + anchor;\n         throw (MissingResourceException) JavaVersions.initCause\n-            (new MissingResourceException(aPath,\n-                ProductDerivations.class.getName(), aPath), err);\n+            (new MissingResourceException(rsrc,\n+                ProductDerivations.class.getName(), rsrc), err);\n     }\n    \n     /**"},{"sha":"0b97ff2d87088a96f85e1d1bcfa0330fb5d87e4e","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/lib/conf/TestAnchorParsing.java","status":"modified","additions":92,"deletions":0,"changes":92,"blob_url":"https://github.com/apache/openjpa/blob/282c8e0c5b8b7a0035d437405fb848b93935ab90/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/lib/conf/TestAnchorParsing.java","raw_url":"https://github.com/apache/openjpa/raw/282c8e0c5b8b7a0035d437405fb848b93935ab90/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/lib/conf/TestAnchorParsing.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/lib/conf/TestAnchorParsing.java?ref=282c8e0c5b8b7a0035d437405fb848b93935ab90","patch":"@@ -19,6 +19,12 @@\n package org.apache.openjpa.lib.conf;\r\n \r\n import java.util.List;\r\n+import java.util.MissingResourceException;\r\n+import java.io.File;\r\n+import java.io.InputStream;\r\n+import java.io.IOException;\r\n+import java.io.FileOutputStream;\r\n+import java.io.OutputStream;\r\n \r\n import junit.framework.TestCase;\r\n import org.apache.openjpa.lib.util.Options;\r\n@@ -60,4 +66,90 @@ private void allHelper(String resource) {\n             \"META-INF/persistence.xml#third-persistence-unit\"));\r\n         assertTrue(locs.contains(\"META-INF/persistence.xml#invalid\"));\r\n     }\r\n+\r\n+    public void testProductDerivationsLoadResource() {\r\n+        ProductDerivations.load(\r\n+            \"org/apache/openjpa/lib/conf/product-derivations-load.xml\",\r\n+            \"foo\", null);\r\n+\r\n+        ProductDerivations.load(\r\n+            \"org/apache/openjpa/lib/conf/product-derivations-load.xml\",\r\n+            null, null);\r\n+\r\n+        try {\r\n+            ProductDerivations.load(\r\n+                \"org/apache/openjpa/lib/conf/product-derivations-load.xml\",\r\n+                \"nonexistant\", null);\r\n+            fail(\"pu 'nonexistant' does not exist\");\r\n+        } catch (MissingResourceException mre) {\r\n+            // expected\r\n+        }\r\n+\r\n+        try {\r\n+            ProductDerivations.load(\r\n+                \"org/apache/openjpa/lib/conf/product-derivations-load.xml\",\r\n+                \"\", null);\r\n+            fail(\"pu '' does not exist\");\r\n+        } catch (MissingResourceException mre) {\r\n+            // expected\r\n+        }\r\n+    }\r\n+\r\n+    public void testNonexistantResourceLoad() {\r\n+        try {\r\n+            ProductDerivations.load(\"nonexistant-resource\", null, null);\r\n+            fail(\"resource 'nonexistant-resource' should not exist\");\r\n+        } catch (MissingResourceException e) {\r\n+            // expected\r\n+        }\r\n+    }\r\n+\r\n+    public void testProductDerivationsLoadFile() throws IOException {\r\n+        File validFile = resourceToTemporaryFile(\r\n+            \"org/apache/openjpa/lib/conf/product-derivations-load.xml\");\r\n+\r\n+        ProductDerivations.load(validFile, \"foo\", null);\r\n+\r\n+        ProductDerivations.load(validFile, null, null);\r\n+\r\n+        try {\r\n+            ProductDerivations.load(validFile, \"nonexistant\", null);\r\n+            fail(\"pu 'nonexistant' does not exist\");\r\n+        } catch (MissingResourceException mre) {\r\n+            // expected\r\n+        }\r\n+\r\n+        try {\r\n+            ProductDerivations.load(validFile, \"\", null);\r\n+            fail(\"pu '' does not exist\");\r\n+        } catch (MissingResourceException mre) {\r\n+            // expected\r\n+        }\r\n+    }\r\n+\r\n+    public void testNonexistantFileLoad() {\r\n+        File f = new File(\"this-should-not-exist\");\r\n+        assertFalse(f.exists());\r\n+        try {\r\n+            ProductDerivations.load(f, null, null);\r\n+            fail(f.getName() + \" does not exist\");\r\n+        } catch (MissingResourceException e) {\r\n+            // expected\r\n+        }\r\n+    }\r\n+\r\n+    private File resourceToTemporaryFile(String s) throws IOException {\r\n+        InputStream in = getClass().getClassLoader().getResourceAsStream(s);\r\n+        File f = File.createTempFile(\"TestAnchorParsing\", \".xml\");\r\n+        OutputStream out = new FileOutputStream(f);\r\n+        byte[] bytes = new byte[1024];\r\n+        while (true) {\r\n+            int count = in.read(bytes);\r\n+            if (count < 0)\r\n+                break;\r\n+            out.write(bytes, 0, count);\r\n+        }\r\n+        f.deleteOnExit();\r\n+        return f;\r\n+    }\r\n }\r"},{"sha":"bd8927b04fee76b72d3aa4f5a888d53963506e97","filename":"openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/lib/conf/product-derivations-load.xml","status":"added","additions":8,"deletions":0,"changes":8,"blob_url":"https://github.com/apache/openjpa/blob/282c8e0c5b8b7a0035d437405fb848b93935ab90/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/lib/conf/product-derivations-load.xml","raw_url":"https://github.com/apache/openjpa/raw/282c8e0c5b8b7a0035d437405fb848b93935ab90/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/lib/conf/product-derivations-load.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/org/apache/openjpa/lib/conf/product-derivations-load.xml?ref=282c8e0c5b8b7a0035d437405fb848b93935ab90","patch":"@@ -0,0 +1,8 @@\n+<persistence xmlns=\"http://java.sun.com/xml/ns/persistence\"\r\n+             xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n+             xsi:schemaLocation=\"http://java.sun.com/xml/ns/persistence\r\n+    http://java.sun.com/xml/ns/persistence/persistence_1_0.xsd\"\r\n+             version=\"1.0\">\r\n+\r\n+    <persistence-unit name=\"foo\"/>\r\n+</persistence>\n\\ No newline at end of file"}]}

