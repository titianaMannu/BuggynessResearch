{"sha":"2e9f4187ccf0bfc07629e062a0af745806440761","node_id":"MDY6Q29tbWl0MjA2MzY0OjJlOWY0MTg3Y2NmMGJmYzA3NjI5ZTA2MmEwYWY3NDU4MDY0NDA3NjE=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-05-26T19:12:40Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-05-26T19:12:40Z"},"message":"OPENJPA-1067. Merely log SQLException from setQueryTimeout for DB2 on Z/OS\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@778852 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"d89c2d31f32288e41eca273620d4320795c48494","url":"https://api.github.com/repos/apache/openjpa/git/trees/d89c2d31f32288e41eca273620d4320795c48494"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/2e9f4187ccf0bfc07629e062a0af745806440761","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/2e9f4187ccf0bfc07629e062a0af745806440761","html_url":"https://github.com/apache/openjpa/commit/2e9f4187ccf0bfc07629e062a0af745806440761","comments_url":"https://api.github.com/repos/apache/openjpa/commits/2e9f4187ccf0bfc07629e062a0af745806440761/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"5b536156091c505a90c0dc108da66aa0cd437ad0","url":"https://api.github.com/repos/apache/openjpa/commits/5b536156091c505a90c0dc108da66aa0cd437ad0","html_url":"https://github.com/apache/openjpa/commit/5b536156091c505a90c0dc108da66aa0cd437ad0"}],"stats":{"total":35,"additions":33,"deletions":2},"files":[{"sha":"d79d61c881b7ff2320e712e2686753dbfdd482af","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":28,"deletions":2,"changes":30,"blob_url":"https://github.com/apache/openjpa/blob/2e9f4187ccf0bfc07629e062a0af745806440761/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/2e9f4187ccf0bfc07629e062a0af745806440761/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=2e9f4187ccf0bfc07629e062a0af745806440761","patch":"@@ -21,6 +21,7 @@\n import java.lang.reflect.Method;\n import java.sql.Connection;\n import java.sql.DatabaseMetaData;\n+import java.sql.PreparedStatement;\n import java.sql.SQLException;\n import java.sql.Types;\n import java.util.Arrays;\n@@ -86,7 +87,7 @@\n     \n     private EnumSet<DBIdentifiers> unsupportedDelimitedIds =\n         EnumSet.of(DBIdentifiers.COLUMN_COLUMN_DEFINITION); \n-\n+    \n     public DB2Dictionary() {\n         platform = \"DB2\";\n         validationSQL = \"SELECT DISTINCT(CURRENT TIMESTAMP) FROM \"\n@@ -324,10 +325,11 @@ else if (isDB2UDBV82OrLater())\n                 + \"NAME AS SEQUENCE_NAME FROM SYSIBM.SYSSEQUENCES\";\n             sequenceSchemaSQL = \"SCHEMA = ?\";\n             sequenceNameSQL = \"NAME = ?\";\n-            if (maj == 8)\n+            if (maj == 8) {\n                 // DB2 Z/OS Version 8: no bigint support, hence map Java\n                 // long to decimal\n                 bigintTypeName = \"DECIMAL(31,0)\";\n+            }\n             break;\n         case db2ISeriesV5R3OrEarlier:\n         case db2ISeriesV5R4OrLater:\n@@ -885,4 +887,28 @@ protected Boolean matchErrorState(int subtype, Set<String> errorStates,\n     protected void setDelimitedCase(DatabaseMetaData metaData) {\n         delimitedCase = SCHEMA_CASE_PRESERVE;\n     }\n+    \n+    /**\n+     * The Type 2 JDBC Driver may throw an SQLException when provided a non-\n+     * zero timeout if we're connected to Z/OS. The SQLException should be\n+     * logged but not thrown.\n+     */\n+    @Override\n+    public void setQueryTimeout(PreparedStatement stmnt, int timeout)\n+        throws SQLException {\n+        if(isDB2ZOSV8xOrLater()) { \n+            try { \n+                super.setQueryTimeout(stmnt, timeout);\n+            }\n+            catch (SQLException e) {\n+                if (log.isTraceEnabled()) {\n+                    log.trace(_loc.get(\"error-setting-query-timeout\", timeout,\n+                        e.getMessage()), e);\n+                }\n+            }\n+        }\n+        else { \n+            super.setQueryTimeout(stmnt, timeout);\n+        }\n+    }\n }"},{"sha":"1f44bcdef9491e9fd7b3fa3bf472900face0a188","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/2e9f4187ccf0bfc07629e062a0af745806440761/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/2e9f4187ccf0bfc07629e062a0af745806440761/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/sql/localizer.properties?ref=2e9f4187ccf0bfc07629e062a0af745806440761","patch":"@@ -189,3 +189,8 @@ null-blob-in-not-nullable: Can not set null value on column \"{0}\" \\\n \tbecause the corresponding field is set to be non-nullable.\n invalid-timeout: An invalid timeout of {0} milliseconds was ignored.  \\\n         Expected a value that is greater than or equal to zero.\n+error-setting-query-timeout: A SQLException was thrown when trying to set the \\\n+\tqueryTimeout to {0}. We believe the exception is not fatal and will \\\n+    continue processing. If this is a benign error you may disable it entirely \\\n+\tby setting the supportsQueryTimeout attribute on the DBDictionary to false.\\\n+\tThe exception thrown was {1}."}]}

