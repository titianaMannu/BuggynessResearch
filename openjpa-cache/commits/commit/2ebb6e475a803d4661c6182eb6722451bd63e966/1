{"sha":"2ebb6e475a803d4661c6182eb6722451bd63e966","node_id":"MDY6Q29tbWl0MjA2MzY0OjJlYmI2ZTQ3NWE4MDNkNDY2MWM2MTgyZWI2NzIyNDUxYmQ2M2U5NjY=","commit":{"author":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2010-03-18T04:38:57Z"},"committer":{"name":"Pinaki Poddar","email":"ppoddar@apache.org","date":"2010-03-18T04:38:57Z"},"message":"Better error message for multi-valued object path traversal\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@924633 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"63ac918d1afec7e7f843d8727f996152609a37da","url":"https://api.github.com/repos/apache/openjpa/git/trees/63ac918d1afec7e7f843d8727f996152609a37da"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/2ebb6e475a803d4661c6182eb6722451bd63e966","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/2ebb6e475a803d4661c6182eb6722451bd63e966","html_url":"https://github.com/apache/openjpa/commit/2ebb6e475a803d4661c6182eb6722451bd63e966","comments_url":"https://api.github.com/repos/apache/openjpa/commits/2ebb6e475a803d4661c6182eb6722451bd63e966/comments","author":null,"committer":null,"parents":[{"sha":"1b20902b507ca7e7209132297266968a92e0d472","url":"https://api.github.com/repos/apache/openjpa/commits/1b20902b507ca7e7209132297266968a92e0d472","html_url":"https://github.com/apache/openjpa/commit/1b20902b507ca7e7209132297266968a92e0d472"}],"stats":{"total":15,"additions":15,"deletions":0},"files":[{"sha":"470e7745a267fb4c5e7a35dfb18facbad4320ab3","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/exps/AbstractExpressionBuilder.java","status":"modified","additions":12,"deletions":0,"changes":12,"blob_url":"https://github.com/apache/openjpa/blob/2ebb6e475a803d4661c6182eb6722451bd63e966/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/exps/AbstractExpressionBuilder.java","raw_url":"https://github.com/apache/openjpa/raw/2ebb6e475a803d4661c6182eb6722451bd63e966/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/exps/AbstractExpressionBuilder.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/exps/AbstractExpressionBuilder.java?ref=2ebb6e475a803d4661c6182eb6722451bd63e966","patch":"@@ -288,6 +288,9 @@ protected Value traversePath(Path path, String field, boolean pcOnly,\n         if (fmd == null) {\n             Object val = traverseStaticField(meta.getDescribedType(), field);\n             if (val == null) {\n+                if (isMultiValuedTraversalAttempt(path, field)) {\n+                    throw parseException(EX_USER, \"multi-valued-travesal\", new Object[]{field, path.last()}, null);\n+                }\n             \tString[] all = meta.getFieldNames();\n             \tClass<?> cls = meta.getDescribedType();\n                 throw parseException(EX_USER, \"no-field\",\n@@ -333,6 +336,15 @@ protected Object traverseStaticField(Class<?> cls, String field) {\n             return null;\n         }\n     }\n+    \n+    private boolean isMultiValuedTraversalAttempt(Path path, String field) {\n+        if (path == null) return false;\n+        if (path.last() == null) return false;\n+        if (path.last().getElement() == null) return false;\n+        if (path.last().getElement().getDeclaredTypeMetaData() == null) return false;\n+        if (path.last().getElement().getDeclaredTypeMetaData().getField(field) == null) return false;\n+        return true;\n+    }\n \n     /**\n      * Returns the type of the named variable if it has been declared."},{"sha":"6f224da48cdc806d7998db4e37b973c40ca8dcea","filename":"openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/2ebb6e475a803d4661c6182eb6722451bd63e966/openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/2ebb6e475a803d4661c6182eb6722451bd63e966/openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/resources/org/apache/openjpa/kernel/jpql/localizer.properties?ref=2ebb6e475a803d4661c6182eb6722451bd63e966","patch":"@@ -30,6 +30,9 @@ cant-resolve-type: The entity \"{0}\" cannot be resolved; please ensure that \\\n not-identifer: The specified node (\"{0}\") is not a valid identifier.\n no-field: No field named \"{0}\" in \"{1}\". Did you mean \"{2}\"? Expected one of \\\n \tthe available field names in \"{3}\": \"{4}\".\n+multi-valued-travesal: Attempt to navigate to relation field \"{0}\" via multi-valued \\\n+\tassociation \"{1}\". JPQL does not allow traversal through multi-valued \\\n+\trelation path. Try join instead.   \t\n unaccessible-field: The field named \"{1}\" in class \"{0}\" could not be accessed.\n multi-children: Expression \"{0}\" does not allow multiple children (\"{1}\").\n no-children: Expression \"{0}\" requires at least one child."}]}

