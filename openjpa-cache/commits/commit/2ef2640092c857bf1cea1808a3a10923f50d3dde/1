{"sha":"2ef2640092c857bf1cea1808a3a10923f50d3dde","node_id":"MDY6Q29tbWl0MjA2MzY0OjJlZjI2NDAwOTJjODU3YmYxY2VhMTgwOGEzYTEwOTIzZjUwZDNkZGU=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-11-30T00:02:46Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-11-30T00:02:46Z"},"message":"OPENJPA-1893: The test case exposes a reserved-word column name problem for Oracle and Sybase with SchemaAction='drop,add'\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1040350 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"6bcf96893c54c83c05746f2ec246f44f38eb808a","url":"https://api.github.com/repos/apache/openjpa/git/trees/6bcf96893c54c83c05746f2ec246f44f38eb808a"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/2ef2640092c857bf1cea1808a3a10923f50d3dde","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/2ef2640092c857bf1cea1808a3a10923f50d3dde","html_url":"https://github.com/apache/openjpa/commit/2ef2640092c857bf1cea1808a3a10923f50d3dde","comments_url":"https://api.github.com/repos/apache/openjpa/commits/2ef2640092c857bf1cea1808a3a10923f50d3dde/comments","author":null,"committer":null,"parents":[{"sha":"f56cba97778b781d9fdc3e0c3c1a0057498a331a","url":"https://api.github.com/repos/apache/openjpa/commits/f56cba97778b781d9fdc3e0c3c1a0057498a331a","html_url":"https://github.com/apache/openjpa/commit/f56cba97778b781d9fdc3e0c3c1a0057498a331a"}],"stats":{"total":33,"additions":30,"deletions":3},"files":[{"sha":"dd1b197d8b44eb0d08798d4e959042b7a10ae4ae","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java","status":"modified","additions":4,"deletions":3,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java","raw_url":"https://github.com/apache/openjpa/raw/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/SchemaTool.java?ref=2ef2640092c857bf1cea1808a3a10923f50d3dde","patch":"@@ -807,10 +807,11 @@ private void drop(SchemaGroup db, SchemaGroup repos)\n                     continue;\n \n                 dbCols = dbTable.getColumns();\n-                for (int k = 0; k < dbCols.length; k++)\n-                    if (tabs[j].getColumn(dbCols[k].getIdentifier()) == null)\n+                for (int k = 0; k < dbCols.length; k++) {\n+                    if (!dbCols[k].getIdentifier().getName().equals(_dict.getIdentityColumnName()) &&\n+                        !tabs[j].containsColumn(dbCols[k]))\n                         continue tables;\n-\n+                }\n                 drops.add(tabs[j]);\n             }\n         }"},{"sha":"10188fc5a0272386defdfc1b1f0d2902ba493b55","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/Table.java","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/apache/openjpa/blob/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/Table.java","raw_url":"https://github.com/apache/openjpa/raw/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/Table.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/schema/Table.java?ref=2ef2640092c857bf1cea1808a3a10923f50d3dde","patch":"@@ -364,6 +364,21 @@ public boolean containsColumn(DBIdentifier name, DBDictionary dict) {\n         return _colMap.containsKey(sName);\n     }\n \n+    public boolean containsColumn(Column col) {\n+        DBIdentifier colName = col.getIdentifier();\n+        if (DBIdentifier.isNull(colName) || _colMap == null) {\n+            return false;\n+        }\n+        DBIdentifier sName = DBIdentifier.toUpper(colName);\n+        Collection<Column> coll = _colMap.values();\n+        for (Column column : coll) {\n+            if (column.getIdentifier().equals(sName))\n+                return true; \n+        }\n+        \n+        return false;\n+    }\n+\n     /**\n      * Add a column to the table.\n      * @deprecated"},{"sha":"6e6342bc231f87da3ddf29b9cd6d7f0b3987cdb0","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=2ef2640092c857bf1cea1808a3a10923f50d3dde","patch":"@@ -5460,4 +5460,9 @@ public String getIsNullSQL(String colAlias, int colType)  {\n     public String getIsNotNullSQL(String colAlias, int colType) { \n         return String.format(\"%s IS NOT NULL\", colAlias);\n     }\n+    \n+    public String getIdentityColumnName() {\n+        return null;       \n+    }\n+\n }"},{"sha":"ca4f9682824e5b8cfe392c923e1adbac112cc85d","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/2ef2640092c857bf1cea1808a3a10923f50d3dde/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java?ref=2ef2640092c857bf1cea1808a3a10923f50d3dde","patch":"@@ -479,4 +479,10 @@ public String getIsNotNullSQL(String colAlias, int colType) {\n         }\n         return super.getIsNotNullSQL(colAlias, colType);\n     }\n+\n+    @Override\n+    public String getIdentityColumnName() {\n+        return identityColumnName;       \n+    }\n+\n }"}]}

