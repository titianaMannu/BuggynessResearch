{"sha":"35205c46acdd25acd7370837bb72baab900f5bcd","node_id":"MDY6Q29tbWl0MjA2MzY0OjM1MjA1YzQ2YWNkZDI1YWNkNzM3MDgzN2JiNzJiYWFiOTAwZjViY2Q=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-09-09T22:35:19Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-09-09T22:35:19Z"},"message":"OPENJPA-1784: clean up fix\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@995596 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a93a31904c842b4ff4be147716cb4fd150ba88c1","url":"https://api.github.com/repos/apache/openjpa/git/trees/a93a31904c842b4ff4be147716cb4fd150ba88c1"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/35205c46acdd25acd7370837bb72baab900f5bcd","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/35205c46acdd25acd7370837bb72baab900f5bcd","html_url":"https://github.com/apache/openjpa/commit/35205c46acdd25acd7370837bb72baab900f5bcd","comments_url":"https://api.github.com/repos/apache/openjpa/commits/35205c46acdd25acd7370837bb72baab900f5bcd/comments","author":null,"committer":null,"parents":[{"sha":"d3ca8f3cc4db0b262bff377fc1259afa7f70e999","url":"https://api.github.com/repos/apache/openjpa/commits/d3ca8f3cc4db0b262bff377fc1259afa7f70e999","html_url":"https://github.com/apache/openjpa/commit/d3ca8f3cc4db0b262bff377fc1259afa7f70e999"}],"stats":{"total":15,"additions":6,"deletions":9},"files":[{"sha":"9dd20858362d65148431489f5975f1bed20753d8","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java","status":"modified","additions":1,"deletions":5,"changes":6,"blob_url":"https://github.com/apache/openjpa/blob/35205c46acdd25acd7370837bb72baab900f5bcd/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/35205c46acdd25acd7370837bb72baab900f5bcd/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java?ref=35205c46acdd25acd7370837bb72baab900f5bcd","patch":"@@ -21,7 +21,6 @@\n import java.sql.*;\n import java.util.*;\n \n-import org.apache.openjpa.enhance.PersistenceCapable;\n import org.apache.openjpa.jdbc.identifier.DBIdentifier;\n import org.apache.openjpa.jdbc.kernel.*;\n import org.apache.openjpa.jdbc.meta.*;\n@@ -215,11 +214,8 @@ public void update(OpenJPAStateManager sm, JDBCStore store, RowManager rm)\n \n             for (Iterator itr = change.iterator(); itr.hasNext();) {\n                 mkey = itr.next();\n-                Object mval = map.get(mkey);\n-                if ((mval instanceof PersistenceCapable) && !((PersistenceCapable)mval).pcIsDirty())\n-                    continue;   \n                 HandlerStrategies.where(key, mkey, store, changeRow, _kcols);\n-                HandlerStrategies.set(val, mval, store, changeRow,\n+                HandlerStrategies.set(val, map.get(mkey), store, changeRow,\n                     _vcols, _vio, true);\n                 rm.flushSecondaryRow(changeRow);\n             }"},{"sha":"8fe46ab3645db4a7d3f15cb0ee15e008d6360732","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/util/ProxyMaps.java","status":"modified","additions":5,"deletions":4,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/35205c46acdd25acd7370837bb72baab900f5bcd/openjpa-kernel/src/main/java/org/apache/openjpa/util/ProxyMaps.java","raw_url":"https://github.com/apache/openjpa/raw/35205c46acdd25acd7370837bb72baab900f5bcd/openjpa-kernel/src/main/java/org/apache/openjpa/util/ProxyMaps.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/util/ProxyMaps.java?ref=35205c46acdd25acd7370837bb72baab900f5bcd","patch":"@@ -26,8 +26,6 @@\n import java.util.Iterator;\n import java.util.Set;\n \n-import org.apache.openjpa.enhance.PersistenceCapable;\n-\n /**\n  * Utility methods used by map proxies.\n  *\n@@ -85,6 +83,9 @@ public static boolean beforeGet(ProxyMap map, Object key) {\n \n     /**\n      * Call after invoking {@link Map#get} on super.\n+     * The potential change is tracked when the get method is called. This change\n+     * will not translated to an update statement if the retrieved value \n+     * is not dirty. \n      *\n      * @param ret the return value from the super's method\n      * @param before the return value from {@link #beforeGet}\n@@ -93,10 +94,10 @@ public static boolean beforeGet(ProxyMap map, Object key) {\n     public static Object afterGet(ProxyMap map, Object key,\n         Object ret, boolean before) {\n         if (before) {\n-            if (map.getChangeTracker() != null && (ret instanceof PersistenceCapable))\n+            if (map.getChangeTracker() != null)\n                 ((MapChangeTracker) map.getChangeTracker()).changed(key, ret, \n                     ret);\n-        } \n+        }\n         return ret;\n     }\n "}]}

