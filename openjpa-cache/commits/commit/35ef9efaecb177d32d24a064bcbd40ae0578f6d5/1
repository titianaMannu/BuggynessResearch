{"sha":"35ef9efaecb177d32d24a064bcbd40ae0578f6d5","node_id":"MDY6Q29tbWl0MjA2MzY0OjM1ZWY5ZWZhZWNiMTc3ZDMyZDI0YTA2NGJjYmQ0MGFlMDU3OGY2ZDU=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-09-04T21:23:43Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-09-04T21:23:43Z"},"message":"fix MySQL test case problem.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@811557 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"3c87d9fa774d6895cbb45d19907ba92cb900fb65","url":"https://api.github.com/repos/apache/openjpa/git/trees/3c87d9fa774d6895cbb45d19907ba92cb900fb65"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/35ef9efaecb177d32d24a064bcbd40ae0578f6d5","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/35ef9efaecb177d32d24a064bcbd40ae0578f6d5","html_url":"https://github.com/apache/openjpa/commit/35ef9efaecb177d32d24a064bcbd40ae0578f6d5","comments_url":"https://api.github.com/repos/apache/openjpa/commits/35ef9efaecb177d32d24a064bcbd40ae0578f6d5/comments","author":null,"committer":null,"parents":[{"sha":"7bcdee7a609acbdf150ba5734f0400fed0905543","url":"https://api.github.com/repos/apache/openjpa/commits/7bcdee7a609acbdf150ba5734f0400fed0905543","html_url":"https://github.com/apache/openjpa/commit/7bcdee7a609acbdf150ba5734f0400fed0905543"}],"stats":{"total":15,"additions":15,"deletions":0},"files":[{"sha":"6f145e8bbf11ddd795f39ca34719d48a1df58c0f","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSubquery.java","status":"modified","additions":15,"deletions":0,"changes":15,"blob_url":"https://github.com/apache/openjpa/blob/35ef9efaecb177d32d24a064bcbd40ae0578f6d5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSubquery.java","raw_url":"https://github.com/apache/openjpa/raw/35ef9efaecb177d32d24a064bcbd40ae0578f6d5/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSubquery.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestSubquery.java?ref=35ef9efaecb177d32d24a064bcbd40ae0578f6d5","patch":"@@ -24,6 +24,10 @@\n import javax.persistence.EntityManager;\n import javax.persistence.Query;\n \n+import org.apache.openjpa.jdbc.conf.JDBCConfiguration;\n+import org.apache.openjpa.jdbc.sql.DBDictionary;\n+import org.apache.openjpa.jdbc.sql.DerbyDictionary;\n+import org.apache.openjpa.jdbc.sql.MySQLDictionary;\n import org.apache.openjpa.persistence.query.Customer.CreditRating;\n import org.apache.openjpa.persistence.test.SingleEMFTestCase;\n \n@@ -230,6 +234,9 @@ public void testSubquery2() {\n \n \n     public void testSubquery() {\n+        JDBCConfiguration conf = (JDBCConfiguration) emf.getConfiguration();\n+        DBDictionary dict = conf.getDBDictionaryInstance();\n+        \n         EntityManager em = emf.createEntityManager();\n         for (int i = 0; i < querys_jpa20.length; i++) {\n             String q = querys_jpa20[i];\n@@ -244,6 +251,14 @@ public void testSubquery() {\n             assertEquals(0, rs.size());\n         }\n \n+        // MySQL throws exception for the jpql in the updates:\n+        // \"You can't specify target table 'xxx' for update in FROM clause\". The MySQL manual mentions \n+        // this at the bottom of the UPDATE documentation(http://dev.mysql.com/doc/refman/5.0/en/update.html): \n+        // �Currently, you cannot update a table and select from the same table in a subquery.�\n+        \n+        if (dict instanceof MySQLDictionary)\n+            return;\n+        \n         em.getTransaction().begin();\n         for (int i = 0; i < updates.length; i++) {\n             int updateCount = em.createQuery(updates[i]).executeUpdate();"}]}

