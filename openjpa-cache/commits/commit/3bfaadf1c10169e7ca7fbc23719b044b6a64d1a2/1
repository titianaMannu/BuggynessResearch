{"sha":"3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2","node_id":"MDY6Q29tbWl0MjA2MzY0OjNiZmFhZGYxYzEwMTY5ZTdjYTdmYmMyMzcxOWIwNDRiNmE2NGQxYTI=","commit":{"author":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2012-04-10T22:33:08Z"},"committer":{"name":"Albert Lee","email":"allee8285@apache.org","date":"2012-04-10T22:33:08Z"},"message":"OPENJPA-2170 - Clear the batching cache regardless if the batch execution has succeeded or failed to avoid duplicated SQL updates.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1312030 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"b7d96b6576b17f4ef4d742cb3b20af88084d57c1","url":"https://api.github.com/repos/apache/openjpa/git/trees/b7d96b6576b17f4ef4d742cb3b20af88084d57c1"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2","html_url":"https://github.com/apache/openjpa/commit/3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2","comments_url":"https://api.github.com/repos/apache/openjpa/commits/3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2/comments","author":null,"committer":null,"parents":[{"sha":"08b0dd2913af1788046bab1681d2dc342c13f417","url":"https://api.github.com/repos/apache/openjpa/commits/08b0dd2913af1788046bab1681d2dc342c13f417","html_url":"https://github.com/apache/openjpa/commit/08b0dd2913af1788046bab1681d2dc342c13f417"}],"stats":{"total":8,"additions":6,"deletions":2},"files":[{"sha":"8e9fbabd3fe818dc130128a733c8a2650d360c0e","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/BatchingPreparedStatementManagerImpl.java","status":"modified","additions":6,"deletions":2,"changes":8,"blob_url":"https://github.com/apache/openjpa/blob/3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/BatchingPreparedStatementManagerImpl.java","raw_url":"https://github.com/apache/openjpa/raw/3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/BatchingPreparedStatementManagerImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/BatchingPreparedStatementManagerImpl.java?ref=3bfaadf1c10169e7ca7fbc23719b044b6a64d1a2","patch":"@@ -96,8 +96,12 @@ protected void batchOrExecuteRow(RowImpl row) throws SQLException {\n                 break;\n             case 1:\n                 // single entry in cache, direct SQL execution. \n-                super.flushAndUpdate((RowImpl) _batchedRows.get(0));\n-                _batchedRows.clear();\n+                try {\n+                    super.flushAndUpdate((RowImpl) _batchedRows.get(0));\n+                } finally {\n+                    _batchedSql = null;\n+                    _batchedRows.clear();\n+                }\n                 break;\n             default:\n                 // flush all entries in cache in batch."}]}

