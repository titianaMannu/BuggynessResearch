{"sha":"4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e","node_id":"MDY6Q29tbWl0MjA2MzY0OjRhNWY3NjZhMGNiMmNmOWEzZWRmNWMxZjUyNmIzZGNmMjc0NjkyOGU=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-11-29T19:05:27Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-11-29T19:05:27Z"},"message":"OPENJPA-1890: attach a test case\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@1040230 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"85ce1cef1fd4c123c70d71521f64f08cd9333132","url":"https://api.github.com/repos/apache/openjpa/git/trees/85ce1cef1fd4c123c70d71521f64f08cd9333132"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e","html_url":"https://github.com/apache/openjpa/commit/4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e","comments_url":"https://api.github.com/repos/apache/openjpa/commits/4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e/comments","author":null,"committer":null,"parents":[{"sha":"f4cbe39a6080ae3d8039a1c561dcee56462b1146","url":"https://api.github.com/repos/apache/openjpa/commits/f4cbe39a6080ae3d8039a1c561dcee56462b1146","html_url":"https://github.com/apache/openjpa/commit/f4cbe39a6080ae3d8039a1c561dcee56462b1146"}],"stats":{"total":46,"additions":40,"deletions":6},"files":[{"sha":"cbcf21576ac5f9a5b2fb7f6fceb23289d0ba6df7","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","status":"modified","additions":40,"deletions":6,"changes":46,"blob_url":"https://github.com/apache/openjpa/blob/4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","raw_url":"https://github.com/apache/openjpa/raw/4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/embed/TestEmbeddable.java?ref=4a5f766a0cb2cf9a3edf5c1f526b3dcf2746928e","patch":"@@ -193,6 +193,20 @@ public void testEntityA_Embed_Single_Coll() {\n         em.close();\n     }\n \n+    /**\n+     * Test for OJ-1890.\n+     */\n+    public void testSettingEmbeddableMultipleTimesOnManagedEntity() {\n+        createEntityA_Embed();\n+        EntityManager em = emf.createEntityManager();\n+        EntityA_Embed ee = em.find(EntityA_Embed.class, ID);\n+        Embed embed = createEmbed(ID, 0);\n+        ee.setEmbed(embed);\n+        Embed embed1 = createEmbed(ID, 1);\n+        ee.setEmbed(embed1);\n+        em.close();\n+    }\n+\n     public void queryEntityA_Embed_Coll_Map() {\n         EntityManager em = emf.createEntityManager();\n         String query[] = {\n@@ -637,12 +651,12 @@ public void createEntityA_Embed_Embed(EntityManager em, int id) {\n         a.setId(id);\n         a.setName(\"a\" + id);\n         a.setAge(id);\n-        Embed_Embed embed = createEmbed_Embed(em, id, 0);\n+        Embed_Embed embed = createEmbed_Embed(id, 0);\n         a.setEmbed(embed);\n         em.persist(a);\n     }\n \n-    public Embed_Embed createEmbed_Embed(EntityManager em, int id, int idx) {\n+    public Embed_Embed createEmbed_Embed(int id, int idx) {\n         Embed_Embed embed = new Embed_Embed();\n         embed.setIntVal1(id * 100 + idx * 10 + 1);\n         embed.setIntVal2(id * 100 + idx * 10 + 2);\n@@ -652,6 +666,26 @@ public Embed_Embed createEmbed_Embed(EntityManager em, int id, int idx) {\n         return embed;\n     }\n \n+    public void createEntityA_Embed() {\n+        EntityManager em = emf.createEntityManager();\n+        EntityTransaction tran = em.getTransaction();\n+        createEntityA_Embed(em, ID);\n+        tran.begin();\n+        em.flush();\n+        tran.commit();\n+        em.close();\n+    }\n+\n+    public void createEntityA_Embed(EntityManager em, int id) {\n+        EntityA_Embed a = new EntityA_Embed();\n+        a.setId(id);\n+        a.setName(\"a\" + id);\n+        a.setAge(id);\n+        Embed embed = createEmbed(id, 0);\n+        a.setEmbed(embed);\n+        em.persist(a);\n+    }\n+\n     public Embed createEmbed(int id, int idx) {\n         Embed embed = new Embed();\n         embed.setIntVal1(id * 100 + idx * 10 + 4);\n@@ -679,7 +713,7 @@ public void createEntityA_Coll_Embed_Embed(EntityManager em, int id) {\n         a.setName(\"a\" + id);\n         a.setAge(id);\n         for (int i = 0; i < numEmbeddables; i++) {\n-            Embed_Embed embed = createEmbed_Embed(em, id, i);\n+            Embed_Embed embed = createEmbed_Embed(id, i);\n             a.addEmbed(embed);\n         }\n         em.persist(a);\n@@ -1066,7 +1100,7 @@ public void findEntityA_Coll_Embed_Embed() {\n         \n         em.clear();\n         em.getTransaction().begin();\n-        Embed_Embed embed = createEmbed_Embed(em, ID, 100);\n+        Embed_Embed embed = createEmbed_Embed(ID, 100);\n         a.addEmbed(embed);\n         em.merge(a);\n         em.getTransaction().commit();\n@@ -2854,9 +2888,9 @@ public void createEntityA_Embed_Complex(EntityManager em, int id) {\n         a.addCreditRating(EntityA_Embed_Complex.CreditRating.POOR);\n         a.addTimestamp(new Timestamp(cal.getTimeInMillis()));\n         a.addLob(\"lob_0\");\n-        a.setEmbed(createEmbed_Embed(em, numEmbeddables, 0));\n+        a.setEmbed(createEmbed_Embed(numEmbeddables, 0));\n         for (int i = 0; i < numEmbeddables; i++) {\n-            Embed_Embed embed = createEmbed_Embed(em, id, i);\n+            Embed_Embed embed = createEmbed_Embed(id, i);\n             a.addEmbed(embed);\n         }\n         for (int i = 0; i < numEmbeddables; i++) {"}]}

