{"sha":"4b6bade66a47e01754817c20d3b01e907fa4fd62","node_id":"MDY6Q29tbWl0MjA2MzY0OjRiNmJhZGU2NmE0N2UwMTc1NDgxN2MyMGQzYjAxZTkwN2ZhNGZkNjI=","commit":{"author":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-04-07T02:10:20Z"},"committer":{"name":"Marc Prud'hommeaux","email":"mprudhom@apache.org","date":"2007-04-07T02:10:20Z"},"message":"Use the authoritative JPA API jar for running the TCK to get around incompatibilities with the Geronimo JPA API.\n\ngit-svn-id: https://svn.apache.org/repos/asf/incubator/openjpa/trunk@526347 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"745405e193745f1f68387a3e9d18b83b970a4bb0","url":"https://api.github.com/repos/apache/openjpa/git/trees/745405e193745f1f68387a3e9d18b83b970a4bb0"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/4b6bade66a47e01754817c20d3b01e907fa4fd62","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/4b6bade66a47e01754817c20d3b01e907fa4fd62","html_url":"https://github.com/apache/openjpa/commit/4b6bade66a47e01754817c20d3b01e907fa4fd62","comments_url":"https://api.github.com/repos/apache/openjpa/commits/4b6bade66a47e01754817c20d3b01e907fa4fd62/comments","author":null,"committer":null,"parents":[{"sha":"af2550bb054bc9ec79aa02d9fa1953765b930da0","url":"https://api.github.com/repos/apache/openjpa/commits/af2550bb054bc9ec79aa02d9fa1953765b930da0","html_url":"https://github.com/apache/openjpa/commit/af2550bb054bc9ec79aa02d9fa1953765b930da0"}],"stats":{"total":50,"additions":40,"deletions":10},"files":[{"sha":"358a6afcfc5d09e16cd1e13068a2f2d0ba62455f","filename":"openjpa-integration/tck/pom.xml","status":"modified","additions":40,"deletions":10,"changes":50,"blob_url":"https://github.com/apache/openjpa/blob/4b6bade66a47e01754817c20d3b01e907fa4fd62/openjpa-integration/tck/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/4b6bade66a47e01754817c20d3b01e907fa4fd62/openjpa-integration/tck/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-integration/tck/pom.xml?ref=4b6bade66a47e01754817c20d3b01e907fa4fd62","patch":"@@ -83,15 +83,21 @@\n                             value=\"${basedir}/target/tck\"/>\n                         <property name=\"tck.dir\" value=\"${tck.base}/jpatck\"/>\n \n+                        <unzip overwrite=\"false\"\n+                            src=\"${tck.zip}\" dest=\"${tck.base}\"/>\n+\n                         <path id=\"cp\">\n                             <path refid=\"maven.compile.classpath\"/>\n+\n+                            <!-- use official JPA API instead of GM's -->\n+                            <fileset dir=\"${tck.dir}/lib\">\n+                                <include name=\"**/*.jar\"/>\n+                                <exclude name=\"**/geronimo-jpa*\"/>\n+                            </fileset>\n                             <pathelement path=\"${java.class.path}\"/>\n                         </path>\n                         <pathconvert property=\"cp.property\" refid=\"cp\"/>\n \n-                        <unzip overwrite=\"false\"\n-                            src=\"${tck.zip}\" dest=\"${tck.base}\"/>\n-\n                         <property name=\"db.driver\"\n                             value=\"org.apache.derby.jdbc.EmbeddedDriver\"/>\n                         <property name=\"db.url\"\n@@ -103,6 +109,8 @@\n \n                         <property name=\"jpatck.work.dir\"\n                             value=\"${tck.dir}/../work\"/>\n+                        <property name=\"tck.log\"\n+                            value=\"${tck.base}/openjpa-tck.log\"/>\n \n                         <property name=\"openjpa.properties\"\n                             value=\"${tck.dir}/openjpa-provier.properties\"/>\n@@ -167,7 +175,6 @@ database.driver=${db.driver}\n                             <replacefilter token=\"-javaagent:${jpa.home}/lib/toplink-essentials-agent.jar\" value=\"-javaagent:${agent} -Dopenjpa.MetaDataFactory=jpa(DefaultAccessType=PROPERTY)\"/>\n                         </replace>\n \n-\n                         <!-- make a macro for the TCK harness launcher -->\n                         <macrodef name=\"tsant\">\n                             <attribute name=\"buildfile\"/>\n@@ -177,7 +184,8 @@ database.driver=${db.driver}\n                                     \"org.apache.tools.ant.launch.Launcher\"\n                                     fork=\"true\" failonerror=\"true\"\n                                     dir=\"${tck.dir}/src\"\n-                                    output=\"${tck.dir}/openjpa-tck.log\"\n+                                    append=\"true\"\n+                                    output=\"${tck.log}\"\n                                     timeout=\"7200000\">\n                                     <arg value=\"-emacs\"/>\n                                     <arg value=\"-buildfile\"/>\n@@ -200,18 +208,16 @@ database.driver=${db.driver}\n                                         value=\"${jpatck.pkg.dir}\"/>\n \n                                     <classpath>\n+                                        <path refid=\"cp\"/>\n                                         <fileset dir=\"${tck.dir}/tools/ant/lib\">\n                                             <include name=\"**/*.jar\"/>\n                                         </fileset>\n-                                        <fileset dir=\"${tck.dir}/lib\">\n-                                            <include name=\"**/*.jar\"/>\n-                                        </fileset>\n-                                        <path refid=\"cp\"/>\n                                     </classpath>\n                                 </java>\n                             </sequential>\n                         </macrodef>\n \n+                        <echo>Logging JPA TCK output to ${tck.log}</echo>\n \n                         <!-- first initialize the database -->\n                         <tsant buildfile=\"${tck.dir}/bin/initdb.xml\"\n@@ -233,6 +239,15 @@ database.driver=${db.driver}\n                                 substring=\"Completed test run: not ok\"/>\n                         </condition>\n                         <fail if=\"jpatck.failed\">Some tests failed</fail>\n+\n+                        <echo>JPA TCK Passed 100%!</echo>\n+\n+                        <property name=\"tck.results.archive\"\n+                            value=\"${tck.base}/openjpa-tck-results.zip\"/>\n+                        <zip destfile=\"${tck.results.archive}\"\n+                            basedir=\"${jpatck.work.dir}\"/>\n+                        <echo>Results archive at: ${tck.results.archive}</echo>\n+\n                         </tasks>\n                         </configuration>\n                         <goals>\n@@ -246,10 +261,25 @@ database.driver=${db.driver}\n     </profile>\n     </profiles>\n \n+    <repositories>\n+        <repository>\n+            <id>java.net</id>\n+            <name>Java.net Maven Repository</name>\n+            <url>https://maven-repository.dev.java.net/nonav/repository</url>\n+            <layout>legacy</layout>\n+        </repository>\n+    </repositories>\n+\n     <dependencies>\n+        <!-- use the authoritative javax.persistence API for testing -->\n+        <dependency>\n+            <groupId>javax.persistence</groupId>\n+            <artifactId>persistence-api</artifactId>\n+            <version>1.0b</version>\n+        </dependency>\n         <dependency>\n             <groupId>org.apache.openjpa</groupId>\n-            <artifactId>openjpa-all</artifactId>\n+            <artifactId>openjpa-kernel</artifactId>\n             <version>${pom.version}</version>\n         </dependency>\n         <dependency>"}]}

