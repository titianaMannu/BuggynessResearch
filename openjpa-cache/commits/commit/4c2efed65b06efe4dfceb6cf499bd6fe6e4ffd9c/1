{"sha":"4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c","node_id":"MDY6Q29tbWl0MjA2MzY0OjRjMmVmZWQ2NWIwNmVmZTRkZmNlYjZjZjQ5OWJkNmZlNmU0ZmZkOWM=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-11-20T13:46:03Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-11-20T13:46:03Z"},"message":"OPENJPA-447 -- improved test case\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@596661 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"150e31fe8e8f4607c132ee699f9077fd71aa24bf","url":"https://api.github.com/repos/apache/openjpa/git/trees/150e31fe8e8f4607c132ee699f9077fd71aa24bf"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c","html_url":"https://github.com/apache/openjpa/commit/4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c","comments_url":"https://api.github.com/repos/apache/openjpa/commits/4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c/comments","author":null,"committer":null,"parents":[{"sha":"d4e978f5aeb420aa295a166e0f35770e5b181932","url":"https://api.github.com/repos/apache/openjpa/commits/d4e978f5aeb420aa295a166e0f35770e5b181932","html_url":"https://github.com/apache/openjpa/commit/d4e978f5aeb420aa295a166e0f35770e5b181932"}],"stats":{"total":33,"additions":28,"deletions":5},"files":[{"sha":"d3d83dff31cae15ecdb1b0c18c5ac4a580a59201","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestQueryPagination.java","status":"modified","additions":28,"deletions":5,"changes":33,"blob_url":"https://github.com/apache/openjpa/blob/4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestQueryPagination.java","raw_url":"https://github.com/apache/openjpa/raw/4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestQueryPagination.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/query/TestQueryPagination.java?ref=4c2efed65b06efe4dfceb6cf499bd6fe6e4ffd9c","patch":"@@ -18,19 +18,23 @@\n  */\n package org.apache.openjpa.persistence.query;\n \n+import java.util.List;\n import javax.persistence.EntityManager;\n import javax.persistence.Query;\n \n-import org.apache.openjpa.persistence.test.SingleEMFTestCase;\n+import org.apache.openjpa.jdbc.conf.JDBCConfiguration;\n+import org.apache.openjpa.jdbc.sql.DBDictionary;\n+import org.apache.openjpa.jdbc.sql.DerbyDictionary;\n+import org.apache.openjpa.persistence.test.SQLListenerTestCase;\n \n /**\n  * Test that query pagination works properly.\n  */\n public class TestQueryPagination\n-    extends SingleEMFTestCase {\n+    extends SQLListenerTestCase {\n \n     public void setUp() {\n-        setUp(SimpleEntity.class, CLEAR_TABLES);\n+        setUp(SimpleEntity.class, CLEAR_TABLES, \"openjpa.Log\", \"SQL=TRACE\");\n \n         EntityManager em = emf.createEntityManager();\n         em.getTransaction().begin();\n@@ -70,12 +74,31 @@ public void testAllResultsFirstLast() {\n \n     private void helper(boolean firstFirst, int first, int max, int expected) {\n         EntityManager em = emf.createEntityManager();\n-        Query q = em.createQuery(\"select e from simple e\");\n+        Query q = em.createQuery(\"select e from simple e order by e.value\");\n+        sql.clear();\n+        List<SimpleEntity> fullList = q.getResultList();\n         if (firstFirst)\n             q.setFirstResult(first).setMaxResults(max);\n         else\n             q.setMaxResults(max).setFirstResult(first);\n-        assertEquals(expected, q.getResultList().size());\n+        List<SimpleEntity> list = q.getResultList();\n+        checkSQL();\n+        assertEquals(expected, list.size());\n+        for (int i = 0; i < list.size(); i++) {\n+            assertEquals(\"bar\" + (first + i), list.get(i).getValue());\n+        }\n         em.close();\n     }\n+\n+    private void checkSQL() {\n+        assertEquals(2, sql.size());\n+        String noRange = this.sql.get(0);\n+        String withRange = this.sql.get(1);\n+        DBDictionary dict = ((JDBCConfiguration) emf.getConfiguration())\n+            .getDBDictionaryInstance();\n+        if (dict.supportsSelectStartIndex || dict.supportsSelectEndIndex)\n+            assertNotEquals(noRange, withRange);\n+        else\n+            assertEquals(noRange, withRange);\n+    }\n }\n\\ No newline at end of file"}]}

