{"sha":"4d25d3fa214849ebce96db0fdaf8646070d7e505","node_id":"MDY6Q29tbWl0MjA2MzY0OjRkMjVkM2ZhMjE0ODQ5ZWJjZTk2ZGIwZmRhZjg2NDYwNzBkN2U1MDU=","commit":{"author":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-03-01T16:08:10Z"},"committer":{"name":"Donald Woods","email":"dwoods@apache.org","date":"2010-03-01T16:08:10Z"},"message":"OPENJPA-855 proper XML entity cleanup between test runs\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@917567 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"0f8b965c26ecd1bb4971cd5091f42d98612bbf64","url":"https://api.github.com/repos/apache/openjpa/git/trees/0f8b965c26ecd1bb4971cd5091f42d98612bbf64"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/4d25d3fa214849ebce96db0fdaf8646070d7e505","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/4d25d3fa214849ebce96db0fdaf8646070d7e505","html_url":"https://github.com/apache/openjpa/commit/4d25d3fa214849ebce96db0fdaf8646070d7e505","comments_url":"https://api.github.com/repos/apache/openjpa/commits/4d25d3fa214849ebce96db0fdaf8646070d7e505/comments","author":null,"committer":null,"parents":[{"sha":"ad4168b8d44ab037d3c29fe5598c895a73b693d2","url":"https://api.github.com/repos/apache/openjpa/commits/ad4168b8d44ab037d3c29fe5598c895a73b693d2","html_url":"https://github.com/apache/openjpa/commit/ad4168b8d44ab037d3c29fe5598c895a73b693d2"}],"stats":{"total":25,"additions":12,"deletions":13},"files":[{"sha":"1bef04b65a0df27f3faa05b7f779600b25cc4dbb","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/expressions/TestIndex.java","status":"modified","additions":11,"deletions":13,"changes":24,"blob_url":"https://github.com/apache/openjpa/blob/4d25d3fa214849ebce96db0fdaf8646070d7e505/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/expressions/TestIndex.java","raw_url":"https://github.com/apache/openjpa/raw/4d25d3fa214849ebce96db0fdaf8646070d7e505/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/expressions/TestIndex.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/jpql/expressions/TestIndex.java?ref=4d25d3fa214849ebce96db0fdaf8646070d7e505","patch":"@@ -51,7 +51,6 @@\n  */\n public class TestIndex extends SingleEMFTestCase {\n     \n-    private OpenJPAEntityManagerFactorySPI emf2 = null;\n     private Log log = null;\n     \n     private enum JPQLIndexEntityClasses implements JPAEntityClassEnum {\n@@ -91,6 +90,11 @@ public String getEntityName() {\n     private static final String[] Element_Names = { \"A_Element\", \"B_Element\",\n         \"C_Element\", \"D_Element\", \"E_Element\", \"F_Element\", };\n \n+    @Override\n+    protected String getPersistenceUnitName() {\n+        return \"JPQLIndex\";\n+    }\n+\n     @Override\n     public void setUp() {\n         super.setUp(CLEAR_TABLES, TreeNode.class, \n@@ -99,13 +103,7 @@ public void setUp() {\n             // XMLOrderedOneToManyEntity.class, XMLOrderedManyToManyEntity.class,\n             // XMLOrderedElementEntity.class, XMLUnorderedNameEntity.class);\n \n-        // create our EMF\n-        emf2 = (OpenJPAEntityManagerFactorySPI) OpenJPAPersistence.createEntityManagerFactory(\n-                \"JPQLIndex\",\n-                \"org/apache/openjpa/persistence/jpql/expressions/persistence.xml\");\n-        assertNotNull(emf2);\n-\n-        log =  emf2.getConfiguration().getLog(\"test\");\n+        log =  emf.getConfiguration().getLog(\"test\");\n     }\n         \n     public void testO2MTreeQueryIndex() {\n@@ -160,7 +158,7 @@ private TreeNode createTreeNodeEntities(int[] original) {\n         root.createTree(original);\n         assertArrayEquals(original, root.getFanOuts());\n         \n-        EntityManager em = emf2.createEntityManager();\n+        EntityManager em = emf.createEntityManager();\n         em.getTransaction().begin();\n         em.persist(root);\n         em.getTransaction().commit();\n@@ -222,7 +220,7 @@ private void createOrderedEntities(JPQLIndexEntityClasses entityType, Class<INam\n             \n             // add the entities\n             log.trace(\"Adding \" + newElements.size() + \" of \" + elementClassName + \" to \" + entityClassName);\n-            em = emf2.createEntityManager();\n+            em = emf.createEntityManager();\n             em.getTransaction().begin();\n             for (INameEntity newElement : newElements)\n             {\n@@ -283,7 +281,7 @@ private void createOrderedElements(JPQLIndexEntityClasses entityType)\n             }\n             newEntity.setListElements(namesList);\n             // add the entity\n-            em = emf2.createEntityManager();\n+            em = emf.createEntityManager();\n             em.getTransaction().begin();\n             em.persist(newEntity);\n             em.getTransaction().commit();\n@@ -345,7 +343,7 @@ private void createOrderedElements(JPQLIndexEntityClasses entityType)\n                     + Arrays.toString(Element_Names));\n             }\n             \n-            EntityManager em = emf2.createEntityManager();\n+            EntityManager em = emf.createEntityManager();\n             em.clear();\n             int idx = 0;\n             for (String expectedEntityName : Element_Names) {\n@@ -388,7 +386,7 @@ private void createOrderedElements(JPQLIndexEntityClasses entityType)\n                     + Arrays.toString(Element_Names));\n             }\n             \n-            EntityManager em = emf2.createEntityManager();\n+            EntityManager em = emf.createEntityManager();\n             em.clear();\n             int idx = 0;\n             for (String expectedEntityName : Element_Names) {"},{"sha":"afb8a90fd074896291fad298451ceb6120101301","filename":"openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/4d25d3fa214849ebce96db0fdaf8646070d7e505/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","raw_url":"https://github.com/apache/openjpa/raw/4d25d3fa214849ebce96db0fdaf8646070d7e505/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml?ref=4d25d3fa214849ebce96db0fdaf8646070d7e505","patch":"@@ -322,6 +322,7 @@\n     <persistence-unit name=\"JPQLIndex\">\n         <mapping-file>org/apache/openjpa/persistence/jpql/expressions/orm.xml</mapping-file>\n \n+        <class>org.apache.openjpa.persistence.proxy.TreeNode</class>\n         <class>org.apache.openjpa.persistence.jpql.entities.OrderedElementEntity</class>\n         <class>org.apache.openjpa.persistence.jpql.entities.XMLOrderedElementEntity</class>\n         <class>org.apache.openjpa.persistence.jpql.entities.OrderedManyToManyEntity</class>"}]}

