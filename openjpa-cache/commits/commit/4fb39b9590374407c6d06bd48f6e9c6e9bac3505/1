{"sha":"4fb39b9590374407c6d06bd48f6e9c6e9bac3505","node_id":"MDY6Q29tbWl0MjA2MzY0OjRmYjM5Yjk1OTAzNzQ0MDdjNmQwNmJkNDhmNmU5YzZlOWJhYzM1MDU=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-11-21T06:25:29Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-11-21T06:25:29Z"},"message":"Example of how to do dynamic class registration in OpenJPA.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@596954 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"c0faba6ac81398bf8345a8d29fc21d413c011f14","url":"https://api.github.com/repos/apache/openjpa/git/trees/c0faba6ac81398bf8345a8d29fc21d413c011f14"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/4fb39b9590374407c6d06bd48f6e9c6e9bac3505","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/4fb39b9590374407c6d06bd48f6e9c6e9bac3505","html_url":"https://github.com/apache/openjpa/commit/4fb39b9590374407c6d06bd48f6e9c6e9bac3505","comments_url":"https://api.github.com/repos/apache/openjpa/commits/4fb39b9590374407c6d06bd48f6e9c6e9bac3505/comments","author":null,"committer":null,"parents":[{"sha":"46ce1f5af7dea3fa25e037618779d6dc2d2f92bf","url":"https://api.github.com/repos/apache/openjpa/commits/46ce1f5af7dea3fa25e037618779d6dc2d2f92bf","html_url":"https://github.com/apache/openjpa/commit/46ce1f5af7dea3fa25e037618779d6dc2d2f92bf"}],"stats":{"total":81,"additions":81,"deletions":0},"files":[{"sha":"0aa88bd028225f2d13f79b26b79d71f44d461353","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/kernel/TestDynamicClassRegistration.java","status":"added","additions":78,"deletions":0,"changes":78,"blob_url":"https://github.com/apache/openjpa/blob/4fb39b9590374407c6d06bd48f6e9c6e9bac3505/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/kernel/TestDynamicClassRegistration.java","raw_url":"https://github.com/apache/openjpa/raw/4fb39b9590374407c6d06bd48f6e9c6e9bac3505/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/kernel/TestDynamicClassRegistration.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/kernel/TestDynamicClassRegistration.java?ref=4fb39b9590374407c6d06bd48f6e9c6e9bac3505","patch":"@@ -0,0 +1,78 @@\n+/*\r\n+ * Licensed to the Apache Software Foundation (ASF) under one\r\n+ * or more contributor license agreements.  See the NOTICE file\r\n+ * distributed with this work for additional information\r\n+ * regarding copyright ownership.  The ASF licenses this file\r\n+ * to you under the Apache License, Version 2.0 (the\r\n+ * \"License\"); you may not use this file except in compliance\r\n+ * with the License.  You may obtain a copy of the License at\r\n+ *\r\n+ * http://www.apache.org/licenses/LICENSE-2.0\r\n+ *\r\n+ * Unless required by applicable law or agreed to in writing,\r\n+ * software distributed under the License is distributed on an\r\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n+ * KIND, either express or implied.  See the License for the\r\n+ * specific language governing permissions and limitations\r\n+ * under the License.\r\n+ */\r\n+package org.apache.openjpa.kernel;\r\n+\r\n+import java.util.List;\r\n+import java.util.Collections;\r\n+import javax.persistence.EntityManager;\r\n+\r\n+import org.apache.openjpa.enhance.PersistenceCapable;\r\n+import org.apache.openjpa.enhance.UnenhancedFieldAccess;\r\n+import org.apache.openjpa.enhance.ManagedClassSubclasser;\r\n+import org.apache.openjpa.meta.ClassMetaData;\r\n+import org.apache.openjpa.persistence.JPAFacadeHelper;\r\n+import org.apache.openjpa.persistence.OpenJPAEntityManagerFactorySPI;\r\n+import org.apache.openjpa.persistence.query.SimpleEntity;\r\n+import org.apache.openjpa.persistence.test.PersistenceTestCase;\r\n+\r\n+public class TestDynamicClassRegistration\r\n+    extends PersistenceTestCase {\r\n+\r\n+    private OpenJPAEntityManagerFactorySPI emf;\r\n+\r\n+    public void setUp() throws Exception {\r\n+        super.setUp();\r\n+\r\n+        emf = createNamedEMF(\"empty-pu\");\r\n+    }\r\n+\r\n+    public void testEnhancedDynamicClassRegistration() {\r\n+        assertTrue(\r\n+            PersistenceCapable.class.isAssignableFrom(SimpleEntity.class));\r\n+\r\n+        // trigger class initialization\r\n+        new SimpleEntity();\r\n+\r\n+        ClassMetaData meta =\r\n+            JPAFacadeHelper.getMetaData(emf, SimpleEntity.class);\r\n+        assertNotNull(meta);\r\n+        EntityManager em = emf.createEntityManager();\r\n+        javax.persistence.Query q = em.createQuery(\"select o from simple o\");\r\n+        em.close();\r\n+    }\r\n+\r\n+    public void testUnenhancedDynamicClassRegistration() {\r\n+        assertFalse(PersistenceCapable.class.isAssignableFrom(\r\n+            UnenhancedFieldAccess.class));\r\n+\r\n+        // trigger class initialization\r\n+        ManagedClassSubclasser.prepareUnenhancedClasses(\r\n+            emf.getConfiguration(),\r\n+            Collections.singleton(UnenhancedFieldAccess.class),\r\n+            null);\r\n+\r\n+        ClassMetaData meta =\r\n+            JPAFacadeHelper.getMetaData(emf, UnenhancedFieldAccess.class);\r\n+        assertNotNull(meta);\r\n+        EntityManager em = emf.createEntityManager();\r\n+        javax.persistence.Query q = em.createQuery(\r\n+            \"select o from UnenhancedFieldAccess o\");\r\n+        em.close();\r\n+    }\r\n+}\n\\ No newline at end of file"},{"sha":"ab9b9024029e9cd28e449075225a9f084e2cbc9a","filename":"openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/4fb39b9590374407c6d06bd48f6e9c6e9bac3505/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","raw_url":"https://github.com/apache/openjpa/raw/4fb39b9590374407c6d06bd48f6e9c6e9bac3505/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/resources/META-INF/persistence.xml?ref=4fb39b9590374407c6d06bd48f6e9c6e9bac3505","patch":"@@ -71,4 +71,7 @@\n                 value=\"DriverClassName=not.a.real.Driver,Url=jdbc:notreal://\"/>\n         </properties>\n     </persistence-unit>\n+\n+    <persistence-unit name=\"empty-pu\">\n+    </persistence-unit>\n </persistence>"}]}

