{"sha":"547438ed18be883a33b5b8175ca0e72a8225c64c","node_id":"MDY6Q29tbWl0MjA2MzY0OjU0NzQzOGVkMThiZTg4M2EzM2I1YjgxNzVjYTBlNzJhODIyNWM2NGM=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-06-11T23:29:11Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2008-06-11T23:29:11Z"},"message":"OPENJPA-579, OPENJPA-585, OPENJPA-587, OPENJPA-588. Merge from ../active. svn merge -c 652987 ../active\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@666898 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"a033b3c64c707186af14a37c228375f66baeadce","url":"https://api.github.com/repos/apache/openjpa/git/trees/a033b3c64c707186af14a37c228375f66baeadce"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/547438ed18be883a33b5b8175ca0e72a8225c64c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/547438ed18be883a33b5b8175ca0e72a8225c64c","html_url":"https://github.com/apache/openjpa/commit/547438ed18be883a33b5b8175ca0e72a8225c64c","comments_url":"https://api.github.com/repos/apache/openjpa/commits/547438ed18be883a33b5b8175ca0e72a8225c64c/comments","author":null,"committer":null,"parents":[{"sha":"8db8e5302edd28abe8b5d324b43c9f89a273f3b7","url":"https://api.github.com/repos/apache/openjpa/commits/8db8e5302edd28abe8b5d324b43c9f89a273f3b7","html_url":"https://github.com/apache/openjpa/commit/8db8e5302edd28abe8b5d324b43c9f89a273f3b7"}],"stats":{"total":27,"additions":21,"deletions":6},"files":[{"sha":"e5cf3a6b335b2ffaa2a1807f5bf6e9642fd68600","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/MaxEmbeddedLobFieldStrategy.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/MaxEmbeddedLobFieldStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/MaxEmbeddedLobFieldStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/MaxEmbeddedLobFieldStrategy.java?ref=547438ed18be883a33b5b8175ca0e72a8225c64c","patch":"@@ -187,7 +187,8 @@ public int supportsSelect(Select sel, int type, OpenJPAStateManager sm,\n \n     public int select(Select sel, OpenJPAStateManager sm, JDBCStore store,\n         JDBCFetchConfiguration fetch, int eagerMode) {\n-        if (sel.isDistinct())\n+        if (sel.isDistinct() || \n+            eagerMode == JDBCFetchConfiguration.EAGER_NONE)\n             return -1;\n         sel.select(field.getColumns()[0], field.join(sel));\n         return 1;"},{"sha":"636a8f5c4cc3332ce98f4fedb7c2f81ab792d15a","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/SybaseDictionary.java?ref=547438ed18be883a33b5b8175ca0e72a8225c64c","patch":"@@ -82,6 +82,7 @@ public SybaseDictionary() {\n \n         supportsLockingWithDistinctClause = false;\n         supportsNullTableForGetColumns = false;\n+        requiresAliasForSubselect = true;\n         requiresAutoCommitForMetaData = true;\n \n         maxTableNameLength = 30;"},{"sha":"5d720cdaf4606d8088a94ca3731c3e707d958261","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AttachStrategy.java","status":"modified","additions":2,"deletions":1,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AttachStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AttachStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/AttachStrategy.java?ref=547438ed18be883a33b5b8175ca0e72a8225c64c","patch":"@@ -86,7 +86,8 @@ protected StateManagerImpl persist(AttachManager manager,\n         PersistenceCapable newInstance;\n         if (!manager.getCopyNew())\n             newInstance = pc;\n-        else if (appId == null) // datastore identity\n+        else if (appId == null)\n+            // datastore identity or application identity with generated keys\n             newInstance = pc.pcNewInstance(null, false);\n         else // application identity: use existing fields\n             newInstance = pc.pcNewInstance(null, appId, false);"},{"sha":"d9277e869e82c00d4b785ed38aba7b9f4690fa15","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java","status":"modified","additions":15,"deletions":2,"changes":17,"blob_url":"https://github.com/apache/openjpa/blob/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/VersionAttachStrategy.java?ref=547438ed18be883a33b5b8175ca0e72a8225c64c","patch":"@@ -29,6 +29,7 @@\n import org.apache.openjpa.meta.FieldMetaData;\n import org.apache.openjpa.meta.JavaTypes;\n import org.apache.openjpa.meta.ValueMetaData;\n+import org.apache.openjpa.meta.ValueStrategies;\n import org.apache.openjpa.util.ApplicationIds;\n import org.apache.openjpa.util.ObjectNotFoundException;\n import org.apache.openjpa.util.OptimisticException;\n@@ -92,8 +93,11 @@ public Object attach(AttachManager manager, Object toAttach,\n             sm = (StateManagerImpl) broker.embed(into, null, owner, ownerMeta);\n             into = sm.getPersistenceCapable();\n         } else if (isNew) {\n-            sm = persist(manager, pc, meta, ApplicationIds.create(pc, meta),\n-                explicit);\n+            Object oid = null;\n+            if (!isPrimaryKeysGenerated(meta))\n+                oid = ApplicationIds.create(pc, meta);\n+\n+            sm = persist(manager, pc, meta, oid, explicit);\n             into = sm.getPersistenceCapable();\n         } else if (!embedded && into == null) {\n             Object id = getDetachedObjectId(manager, toAttach);\n@@ -373,4 +377,13 @@ protected PersistenceCapable findFromDatabase(AttachManager manager,\n             return null;\n         }\n     }\n+\n+    private boolean isPrimaryKeysGenerated(ClassMetaData meta) {\n+        FieldMetaData[] pks = meta.getPrimaryKeyFields();\n+        for (int i = 0; i < pks.length; i++) {\n+            if (pks[i].getValueStrategy() != ValueStrategies.NONE)\n+                return true;\n+        }\n+        return false;\n+    }\n }"},{"sha":"264df7fe4416d7366e4bc997b6410d1687468299","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/meta/ClassMetaData.java","status":"modified","additions":1,"deletions":2,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-kernel/src/main/java/org/apache/openjpa/meta/ClassMetaData.java","raw_url":"https://github.com/apache/openjpa/raw/547438ed18be883a33b5b8175ca0e72a8225c64c/openjpa-kernel/src/main/java/org/apache/openjpa/meta/ClassMetaData.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/meta/ClassMetaData.java?ref=547438ed18be883a33b5b8175ca0e72a8225c64c","patch":"@@ -966,8 +966,7 @@ protected FieldMetaData getSuperclassField(FieldMetaData supField) {\n                 fmd = (FieldMetaData) itr.next();\n                 if (fmd.getManagement() != FieldMetaData.MANAGE_NONE) {\n                     fmd.setDeclaredIndex(fields.size());\n-                    if (fmd.getIndex() == -1)\n-                        fmd.setIndex(fmd.getDeclaredIndex());\n+                    fmd.setIndex(fmd.getDeclaredIndex());\n                     fields.add(fmd);\n                 }\n             }"}]}

