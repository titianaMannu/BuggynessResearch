{"sha":"5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","node_id":"MDY6Q29tbWl0MjA2MzY0OjU1NTBkOGRiYjUzZTJiNWJiZmY0ZGRkYWMwNjBhOTNjMzNkN2NlZmY=","commit":{"author":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-11-10T19:55:00Z"},"committer":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-11-10T19:55:00Z"},"message":"OPENJPA-755 Update to SingleFieldManager to permit detached related entities on a merge with cascade persist.\ncosmatic changes only - removed tabs.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@712817 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"2541af0f12fdc56922c6cb4ad0c51f910bc7b071","url":"https://api.github.com/repos/apache/openjpa/git/trees/2541af0f12fdc56922c6cb4ad0c51f910bc7b071"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","html_url":"https://github.com/apache/openjpa/commit/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","comments_url":"https://api.github.com/repos/apache/openjpa/commits/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/comments","author":null,"committer":null,"parents":[{"sha":"e11d0f7e12f8ee4e98860847a4901c59a48f8346","url":"https://api.github.com/repos/apache/openjpa/commits/e11d0f7e12f8ee4e98860847a4901c59a48f8346","html_url":"https://github.com/apache/openjpa/commit/e11d0f7e12f8ee4e98860847a4901c59a48f8346"}],"stats":{"total":184,"additions":92,"deletions":92},"files":[{"sha":"b2f4e4071442b7d1f95168124de5821ca95d57df","filename":"openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","status":"modified","additions":2,"deletions":2,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","raw_url":"https://github.com/apache/openjpa/raw/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-kernel/src/main/java/org/apache/openjpa/kernel/SingleFieldManager.java?ref=5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","patch":"@@ -744,7 +744,7 @@ private void preFlushPC(ValueMetaData vmd, Object obj, boolean logical,\n             return;\n \n         OpenJPAStateManager sm;        \n-        \n+\n         if (vmd.getCascadePersist() == ValueMetaData.CASCADE_NONE) {\n             if (!_broker.isDetachedNew() && _broker.isDetached(obj))\n                 return; // allow but ignore\n@@ -755,7 +755,7 @@ private void preFlushPC(ValueMetaData vmd, Object obj, boolean logical,\n                     _loc.get(\"cant-cascade-persist\", vmd))\n                     .setFailedObject(obj);\n         } else {\n-        \tif (vmd.getCascadePersist() == ValueMetaData.CASCADE_IMMEDIATE) {\n+            if (vmd.getCascadePersist() == ValueMetaData.CASCADE_IMMEDIATE) {\n                 if (!_broker.isDetachedNew() && _broker.isDetached(obj))\n                     return; // allow but ignore\n             }        \t"},{"sha":"dcada8c8675ffabf398814d3e5562896037b4f78","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/TestDetachedEntityCascadePersist.java","status":"modified","additions":10,"deletions":10,"changes":20,"blob_url":"https://github.com/apache/openjpa/blob/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/TestDetachedEntityCascadePersist.java","raw_url":"https://github.com/apache/openjpa/raw/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/TestDetachedEntityCascadePersist.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/TestDetachedEntityCascadePersist.java?ref=5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","patch":"@@ -27,18 +27,18 @@\n \n public class TestDetachedEntityCascadePersist extends SingleEMFTestCase {\n \n-\tpublic void setUp() {\t\t\n+    public void setUp() {\t\t\n         setUp(\n-        \tCLEAR_TABLES,\n-        \tDMCustomer.class, \n-        \tDMItem.class,\n-        \tDMCustomerInventory.class\n-        );        \n+            CLEAR_TABLES,\n+            DMCustomer.class,\n+            DMItem.class,\n+            DMCustomerInventory.class\n+        );\n     }\n-\t\n+\n     public void testDetachedEntityCascadePersist() {\n-    \t// Persist an item for finding later \n-    \tEntityManager em = emf.createEntityManager();\n+        // Persist an item for finding later \n+        EntityManager em = emf.createEntityManager();\n         DMItem item = new DMItem(); \n         item.setName(\"openjpa\");\n         item.setPrice(0.0);\n@@ -51,7 +51,7 @@ public void testDetachedEntityCascadePersist() {\n         em.persist(customer);\n         em.getTransaction().commit();\n         em.close();\n-        \n+\n         em = emf.createEntityManager();\n         DMItem itemDetached = em.find(DMItem.class, item.getId());\n         em.close();        "},{"sha":"94c216f4c964f789df41427aa2b435da1292f603","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomer.java","status":"modified","additions":28,"deletions":28,"changes":56,"blob_url":"https://github.com/apache/openjpa/blob/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomer.java","raw_url":"https://github.com/apache/openjpa/raw/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomer.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomer.java?ref=5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","patch":"@@ -29,49 +29,49 @@\n \n @Entity \n public class DMCustomer {\n-    \n-\tprivate static long idCounter = System.currentTimeMillis();\t\n+\n+    private static long idCounter = System.currentTimeMillis();\t\n     @Id private long id = idCounter++;    \n     private String firstName;    \n     private String lastName;    \n \n     @OneToMany(mappedBy=\"customer\", \n             fetch=FetchType.EAGER,\n             cascade=CascadeType.ALL)\n-    private List<DMCustomerInventory> customerInventories = new ArrayList<DMCustomerInventory>();\n-    \n+            private List<DMCustomerInventory> customerInventories = new ArrayList<DMCustomerInventory>();\n+\n     public DMCustomer() {\n     }\n \n-\tpublic long getId() {\n-\t\treturn id;\n-\t}\n+    public long getId() {\n+        return id;\n+    }\n \n-\tpublic void setId(long id) {\n-\t\tthis.id = id;\n-\t}\n+    public void setId(long id) {\n+        this.id = id;\n+    }\n \n-\tpublic String getFirstName() {\n-\t\treturn firstName;\n-\t}\n+    public String getFirstName() {\n+        return firstName;\n+    }\n \n-\tpublic void setFirstName(String firstName) {\n-\t\tthis.firstName = firstName;\n-\t}\n+    public void setFirstName(String firstName) {\n+        this.firstName = firstName;\n+    }\n \n-\tpublic String getLastName() {\n-\t\treturn lastName;\n-\t}\n+    public String getLastName() {\n+        return lastName;\n+    }\n \n-\tpublic void setLastName(String lastName) {\n-\t\tthis.lastName = lastName;\n-\t}\n+    public void setLastName(String lastName) {\n+        this.lastName = lastName;\n+    }\n \n-\tpublic List<DMCustomerInventory> getCustomerInventories() {\n-\t\treturn customerInventories;\n-\t}\n+    public List<DMCustomerInventory> getCustomerInventories() {\n+        return customerInventories;\n+    }\n \n-\tpublic void setCustomerInventories(List<DMCustomerInventory> customerInventories) {\n-\t\tthis.customerInventories = customerInventories;\n-\t}\n+    public void setCustomerInventories(List<DMCustomerInventory> customerInventories) {\n+        this.customerInventories = customerInventories;\n+    }\n }"},{"sha":"a3758efbffda0ad94b2f084840bd2ec805fc24fc","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomerInventory.java","status":"modified","additions":28,"deletions":28,"changes":56,"blob_url":"https://github.com/apache/openjpa/blob/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomerInventory.java","raw_url":"https://github.com/apache/openjpa/raw/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomerInventory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMCustomerInventory.java?ref=5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","patch":"@@ -26,50 +26,50 @@\n \n @Entity\n public class DMCustomerInventory  {\n-\tprivate static long idCounter = System.currentTimeMillis();\n+    private static long idCounter = System.currentTimeMillis();\n     @Id private long id = idCounter++;\n-    \n+\n     @ManyToOne(cascade=CascadeType.ALL)\n     @JoinColumn(name = \"CI_ITEMID\")\n     private DMItem  item;    \n     private int quantity;\n-    \n+\n     @ManyToOne(cascade=CascadeType.MERGE)\n     @JoinColumn(name=\"CI_CUSTOMERID\")\n     private DMCustomer customer;\n-    \n+\n     public DMCustomerInventory() {\n     }\n \n-\tpublic long getId() {\n-\t\treturn id;\n-\t}\n+    public long getId() {\n+        return id;\n+    }\n \n-\tpublic void setId(long id) {\n-\t\tthis.id = id;\n-\t}\n+    public void setId(long id) {\n+        this.id = id;\n+    }\n \n-\tpublic DMItem getItem() {\n-\t\treturn item;\n-\t}\n+    public DMItem getItem() {\n+        return item;\n+    }\n \n-\tpublic void setItem(DMItem item) {\n-\t\tthis.item = item;\n-\t}\n+    public void setItem(DMItem item) {\n+        this.item = item;\n+    }\n \n-\tpublic int getQuantity() {\n-\t\treturn quantity;\n-\t}\n+    public int getQuantity() {\n+        return quantity;\n+    }\n \n-\tpublic void setQuantity(int quantity) {\n-\t\tthis.quantity = quantity;\n-\t}\n+    public void setQuantity(int quantity) {\n+        this.quantity = quantity;\n+    }\n \n-\tpublic DMCustomer getCustomer() {\n-\t\treturn customer;\n-\t}\n+    public DMCustomer getCustomer() {\n+        return customer;\n+    }\n \n-\tpublic void setCustomer(DMCustomer customer) {\n-\t\tthis.customer = customer;\n-\t}    \n+    public void setCustomer(DMCustomer customer) {\n+        this.customer = customer;\n+    }    \n }"},{"sha":"5b153fb626c09b9ea775ac81caaef7cdd5103129","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMItem.java","status":"modified","additions":24,"deletions":24,"changes":48,"blob_url":"https://github.com/apache/openjpa/blob/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMItem.java","raw_url":"https://github.com/apache/openjpa/raw/5550d8dbb53e2b5bbff4dddac060a93c33d7ceff/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMItem.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/detachment/model/DMItem.java?ref=5550d8dbb53e2b5bbff4dddac060a93c33d7ceff","patch":"@@ -23,29 +23,29 @@\n \n @Entity\n public class DMItem {\n-\tprivate static long idCounter = System.currentTimeMillis();\t\n-\t@Id private long id = idCounter++;\n+    private static long idCounter = System.currentTimeMillis();\t\n+    @Id private long id = idCounter++;\n \n-\tprivate String name;\n-\tprivate double price;\n-\t\n-\t\n-\tpublic long getId() {\n-\t\treturn id;\n-\t}\n-\tpublic void setId(long id) {\n-\t\tthis.id = id;\n-\t}\n-\tpublic String getName() {\n-\t\treturn name;\n-\t}\n-\tpublic void setName(String name) {\n-\t\tthis.name = name;\n-\t}\n-\tpublic double getPrice() {\n-\t\treturn price;\n-\t}\n-\tpublic void setPrice(double price) {\n-\t\tthis.price = price;\n-\t}\n+    private String name;\n+    private double price;\n+\n+\n+    public long getId() {\n+        return id;\n+    }\n+    public void setId(long id) {\n+        this.id = id;\n+    }\n+    public String getName() {\n+        return name;\n+    }\n+    public void setName(String name) {\n+        this.name = name;\n+    }\n+    public double getPrice() {\n+        return price;\n+    }\n+    public void setPrice(double price) {\n+        this.price = price;\n+    }\n }"}]}

