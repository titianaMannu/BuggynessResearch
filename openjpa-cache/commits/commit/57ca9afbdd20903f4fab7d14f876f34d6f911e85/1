{"sha":"57ca9afbdd20903f4fab7d14f876f34d6f911e85","node_id":"MDY6Q29tbWl0MjA2MzY0OjU3Y2E5YWZiZGQyMDkwM2Y0ZmFiN2QxNGY4NzZmMzRkNmY5MTFlODU=","commit":{"author":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-03-21T18:23:19Z"},"committer":{"name":"Catalina Wei","email":"fancy@apache.org","date":"2008-03-21T18:23:19Z"},"message":"OPENJPA-539 Can't create a table with a field of java type \"Map\" in Derby\ncommit patch for Fay Wang. \ntestcases have been modified.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@639746 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"57d9eaaed528329b045b18f41d6df0e42d9eded1","url":"https://api.github.com/repos/apache/openjpa/git/trees/57d9eaaed528329b045b18f41d6df0e42d9eded1"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/57ca9afbdd20903f4fab7d14f876f34d6f911e85","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/57ca9afbdd20903f4fab7d14f876f34d6f911e85","html_url":"https://github.com/apache/openjpa/commit/57ca9afbdd20903f4fab7d14f876f34d6f911e85","comments_url":"https://api.github.com/repos/apache/openjpa/commits/57ca9afbdd20903f4fab7d14f876f34d6f911e85/comments","author":null,"committer":null,"parents":[{"sha":"831bd55051cccfaad51dde9923e19584d236062f","url":"https://api.github.com/repos/apache/openjpa/commits/831bd55051cccfaad51dde9923e19584d236062f","html_url":"https://github.com/apache/openjpa/commit/831bd55051cccfaad51dde9923e19584d236062f"}],"stats":{"total":15,"additions":7,"deletions":8},"files":[{"sha":"e7859a2c4dcf9600b45aebb58e0af1584b12b435","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java","status":"modified","additions":4,"deletions":1,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerHandlerMapTableFieldStrategy.java?ref=57ca9afbdd20903f4fab7d14f876f34d6f911e85","patch":"@@ -108,7 +108,10 @@ public void map(boolean adapt) {\n \r\n         field.mapJoin(adapt, true);\r\n         _kio = new ColumnIO();\r\n-        _kcols = HandlerStrategies.map(key, \"key\", _kio, adapt);\r\n+        DBDictionary dict = field.getMappingRepository().getDBDictionary();\r\n+        _kcols = HandlerStrategies.map(key, \r\n+            dict.getValidColumnName(\"key\", field.getTable()), _kio, adapt);\r\n+\r\n         _vio = new ColumnIO();\r\n         _vcols = HandlerStrategies.map(val, \"value\", _vio, adapt);\r\n         field.mapPrimaryKey(adapt);\r"},{"sha":"a931b4c0c85a92ea3551190ba2be7a1583c7670b","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerRelationMapTableFieldStrategy.java","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/apache/openjpa/blob/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerRelationMapTableFieldStrategy.java","raw_url":"https://github.com/apache/openjpa/raw/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerRelationMapTableFieldStrategy.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/meta/strats/HandlerRelationMapTableFieldStrategy.java?ref=57ca9afbdd20903f4fab7d14f876f34d6f911e85","patch":"@@ -133,7 +133,9 @@ public void map(boolean adapt) {\n \r\n         field.mapJoin(adapt, true);\r\n         _kio = new ColumnIO();\r\n-        _kcols = HandlerStrategies.map(key, \"key\", _kio, adapt);\r\n+        DBDictionary dict = field.getMappingRepository().getDBDictionary();\r\n+        _kcols = HandlerStrategies.map(key, \r\n+            dict.getValidColumnName(\"key\", field.getTable()), _kio, adapt);\r\n \r\n         if (val.getTypeMapping().isMapped()) {\r\n             ValueMappingInfo vinfo = val.getValueInfo();\r"},{"sha":"602a3431060efd8b0bb9964c7949d42ea3c41ee3","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToHandlerMapInstance.java","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToHandlerMapInstance.java","raw_url":"https://github.com/apache/openjpa/raw/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToHandlerMapInstance.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToHandlerMapInstance.java?ref=57ca9afbdd20903f4fab7d14f876f34d6f911e85","patch":"@@ -25,7 +25,6 @@\n \r\n import org.apache.openjpa.persistence.PersistentMap;\r\n import org.apache.openjpa.persistence.jdbc.ContainerTable;\r\n-import org.apache.openjpa.persistence.jdbc.KeyColumn;\r\n \r\n @Entity\r\n public class HandlerToHandlerMapInstance {\r\n@@ -34,8 +33,6 @@\n \r\n     @PersistentMap\r\n     @ContainerTable(name=\"NONSTD_MAPPING_MAP\")\r\n-    // needed because we hard-code 'key' in the handler FieldStrategies\r\n-    @KeyColumn(name=\"key_col\") \r\n     private Map<String,String> map = new HashMap<String,String>();\r\n \r\n     public Map<String,String> getMap() {\r"},{"sha":"6a7febc743a47726c5cb6ecf5b34edd46b0bb7c3","filename":"openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToRelationMapInstance.java","status":"modified","additions":0,"deletions":3,"changes":3,"blob_url":"https://github.com/apache/openjpa/blob/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToRelationMapInstance.java","raw_url":"https://github.com/apache/openjpa/raw/57ca9afbdd20903f4fab7d14f876f34d6f911e85/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToRelationMapInstance.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-persistence-jdbc/src/test/java/org/apache/openjpa/persistence/relations/HandlerToRelationMapInstance.java?ref=57ca9afbdd20903f4fab7d14f876f34d6f911e85","patch":"@@ -25,7 +25,6 @@\n import javax.persistence.Id;\r\n \r\n import org.apache.openjpa.persistence.PersistentMap;\r\n-import org.apache.openjpa.persistence.jdbc.KeyColumn;\r\n import org.apache.openjpa.persistence.simple.AllFieldTypes;\r\n \r\n @Entity\r\n@@ -34,8 +33,6 @@\n     private int id;\r\n \r\n     @PersistentMap(elementCascade = CascadeType.PERSIST)\r\n-    // needed because we hard-code 'key' in the handler FieldStrategies\r\n-    @KeyColumn(name=\"key_col\")\r\n     private Map<String,AllFieldTypes> map = new HashMap<String,AllFieldTypes>();\r\n \r\n     public Map<String,AllFieldTypes> getMap() {\r"}]}

