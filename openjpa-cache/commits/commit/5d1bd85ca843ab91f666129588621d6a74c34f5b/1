{"sha":"5d1bd85ca843ab91f666129588621d6a74c34f5b","node_id":"MDY6Q29tbWl0MjA2MzY0OjVkMWJkODVjYTg0M2FiOTFmNjY2MTI5NTg4NjIxZDZhNzRjMzRmNWI=","commit":{"author":{"name":"Milosz Tylenda","email":"mtylenda@apache.org","date":"2009-06-13T14:42:45Z"},"committer":{"name":"Milosz Tylenda","email":"mtylenda@apache.org","date":"2009-06-13T14:42:45Z"},"message":"OPENJPA-1132: Use MySQL-specific syntax for dropping foreign and primary keys.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@784402 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"021036b75f6c6d3c913f239ebcc29520479a7715","url":"https://api.github.com/repos/apache/openjpa/git/trees/021036b75f6c6d3c913f239ebcc29520479a7715"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/5d1bd85ca843ab91f666129588621d6a74c34f5b","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/5d1bd85ca843ab91f666129588621d6a74c34f5b","html_url":"https://github.com/apache/openjpa/commit/5d1bd85ca843ab91f666129588621d6a74c34f5b","comments_url":"https://api.github.com/repos/apache/openjpa/commits/5d1bd85ca843ab91f666129588621d6a74c34f5b/comments","author":null,"committer":null,"parents":[{"sha":"888ddb83c06405970b61e68d6731047478344260","url":"https://api.github.com/repos/apache/openjpa/commits/888ddb83c06405970b61e68d6731047478344260","html_url":"https://github.com/apache/openjpa/commit/888ddb83c06405970b61e68d6731047478344260"}],"stats":{"total":32,"additions":32,"deletions":0},"files":[{"sha":"616d8631850bb743d3df64601e97c519643bd68d","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","status":"modified","additions":32,"deletions":0,"changes":32,"blob_url":"https://github.com/apache/openjpa/blob/5d1bd85ca843ab91f666129588621d6a74c34f5b/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/5d1bd85ca843ab91f666129588621d6a74c34f5b/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/MySQLDictionary.java?ref=5d1bd85ca843ab91f666129588621d6a74c34f5b","patch":"@@ -30,6 +30,7 @@\n import org.apache.openjpa.jdbc.kernel.JDBCStore;\n import org.apache.openjpa.jdbc.kernel.exps.FilterValue;\n import org.apache.openjpa.jdbc.schema.Column;\n+import org.apache.openjpa.jdbc.schema.ForeignKey;\n import org.apache.openjpa.jdbc.schema.Index;\n import org.apache.openjpa.jdbc.schema.PrimaryKey;\n import org.apache.openjpa.jdbc.schema.Table;\n@@ -207,6 +208,37 @@ public Connection decorate(Connection conn)  throws SQLException {\n             + getFullName(index.getTable(), false) };\n     }\n \n+    /**\n+     * Return <code>ALTER TABLE &lt;table name&gt; DROP PRIMARY KEY</code>.\n+     */\n+    @Override\n+    public String[] getDropPrimaryKeySQL(PrimaryKey pk) {\n+        if (pk.getName() == null)\n+            return new String[0];\n+        return new String[]{ \"ALTER TABLE \"\n+            + getFullName(pk.getTable(), false)\n+            + \" DROP PRIMARY KEY\" };\n+    }\n+\n+    /**\n+     * Return <code>ALTER TABLE &lt;table name&gt; DROP FOREIGN KEY\n+     * &lt;fk name&gt;</code>.\n+     */\n+    @Override\n+    public String[] getDropForeignKeySQL(ForeignKey fk, Connection conn) {\n+        if (fk.getName() == null) {\n+            String fkName = fk.loadNameFromDB(this,conn);\n+            String[] retVal = (fkName == null) ?  new String[0] :\n+                new String[]{ \"ALTER TABLE \"\n+                + getFullName(fk.getTable(), false)\n+                + \" DROP FOREIGN KEY \" + fkName };\n+            return retVal;   \n+        }\n+        return new String[]{ \"ALTER TABLE \"\n+            + getFullName(fk.getTable(), false)\n+            + \" DROP FOREIGN KEY \" + fk.getName() };\n+    }\n+\n     public String[] getAddPrimaryKeySQL(PrimaryKey pk) {\n         String[] sql = super.getAddPrimaryKeySQL(pk);\n "}]}

