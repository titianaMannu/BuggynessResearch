{"sha":"5e5243f3961ab56e536b35509d7209eb605dd8cb","node_id":"MDY6Q29tbWl0MjA2MzY0OjVlNTI0M2YzOTYxYWI1NmU1MzZiMzU1MDlkNzIwOWViNjA1ZGQ4Y2I=","commit":{"author":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-07-29T15:23:05Z"},"committer":{"name":"Michael Dick","email":"mikedd@apache.org","date":"2009-07-29T15:23:05Z"},"message":"OPENJPA-622:\nMove check for isJDBC to DBDictionary class and prevent informix lock timeout\nSubmitted By : Jody Grassel based on Catalina's changes in trunk\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/1.0.x@798945 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"d9e3bd6679eae323a7ad5fe90d81099081910665","url":"https://api.github.com/repos/apache/openjpa/git/trees/d9e3bd6679eae323a7ad5fe90d81099081910665"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/5e5243f3961ab56e536b35509d7209eb605dd8cb","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/5e5243f3961ab56e536b35509d7209eb605dd8cb","html_url":"https://github.com/apache/openjpa/commit/5e5243f3961ab56e536b35509d7209eb605dd8cb","comments_url":"https://api.github.com/repos/apache/openjpa/commits/5e5243f3961ab56e536b35509d7209eb605dd8cb/comments","author":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"committer":{"login":"mikedd","id":669432,"node_id":"MDQ6VXNlcjY2OTQzMg==","avatar_url":"https://avatars.githubusercontent.com/u/669432?v=4","gravatar_id":"","url":"https://api.github.com/users/mikedd","html_url":"https://github.com/mikedd","followers_url":"https://api.github.com/users/mikedd/followers","following_url":"https://api.github.com/users/mikedd/following{/other_user}","gists_url":"https://api.github.com/users/mikedd/gists{/gist_id}","starred_url":"https://api.github.com/users/mikedd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikedd/subscriptions","organizations_url":"https://api.github.com/users/mikedd/orgs","repos_url":"https://api.github.com/users/mikedd/repos","events_url":"https://api.github.com/users/mikedd/events{/privacy}","received_events_url":"https://api.github.com/users/mikedd/received_events","type":"User","site_admin":false},"parents":[{"sha":"65ed7d997b6c2ce85a2fdb8eed55809af6872082","url":"https://api.github.com/repos/apache/openjpa/commits/65ed7d997b6c2ce85a2fdb8eed55809af6872082","html_url":"https://github.com/apache/openjpa/commit/65ed7d997b6c2ce85a2fdb8eed55809af6872082"}],"stats":{"total":50,"additions":32,"deletions":18},"files":[{"sha":"dd34f33113155b87fc8d3cf67a99295d9e0ed761","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":1,"deletions":10,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/5e5243f3961ab56e536b35509d7209eb605dd8cb/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/5e5243f3961ab56e536b35509d7209eb605dd8cb/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=5e5243f3961ab56e536b35509d7209eb605dd8cb","patch":"@@ -203,15 +203,6 @@ public Connection decorate(Connection conn)\n         return conn;\n     }\n \n-    private boolean isJDBC3(DatabaseMetaData meta) {\n-        try {\n-            // JDBC3-only method, so it might throw a AbstractMethodError\n-            return meta.getJDBCMajorVersion() >= 3;\n-        } catch (Throwable t) {\n-            return false;\n-        }\n-    }\n-\n     public void connectedConfiguration(Connection conn) throws SQLException {\n     \tsuper.connectedConfiguration(conn);\n \n@@ -231,7 +222,7 @@ else if (isDB2ISeriesV5R4OrLater())\n         }\n         \n     \tif (db2ServerType == 0) {\n-    \t    if (isJDBC3(metaData)) {\n+    \t    if (isJDBC3) {\n     \t        maj = metaData.getDatabaseMajorVersion();\n     \t        min = metaData.getDatabaseMinorVersion();\n     \t    }"},{"sha":"ae2bed2a395f4ea81e78e3fd51f6823acb2c3ecf","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":23,"deletions":7,"changes":30,"blob_url":"https://github.com/apache/openjpa/blob/5e5243f3961ab56e536b35509d7209eb605dd8cb/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/5e5243f3961ab56e536b35509d7209eb605dd8cb/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=5e5243f3961ab56e536b35509d7209eb605dd8cb","patch":"@@ -143,7 +143,7 @@\n     private static final String ZERO_TIMESTAMP_STR =\n         \"'\" + new Timestamp(0) + \"'\";\n \n-    private static final Localizer _loc = Localizer.forPackage\n+    protected static final Localizer _loc = Localizer.forPackage\n         (DBDictionary.class);\n \n     // schema data\n@@ -304,6 +304,7 @@\n     protected JDBCConfiguration conf = null;\n     protected Log log = null;\n     protected boolean connected = false;\n+    protected boolean isJDBC3 = false;\n     protected final Set reservedWordSet = new HashSet();\n     protected final Set systemSchemaSet = new HashSet();\n     protected final Set systemTableSet = new HashSet();\n@@ -355,15 +356,30 @@ public DBDictionary() {\n      */\n     public void connectedConfiguration(Connection conn)\n         throws SQLException {\n-        if (!connected) {\n+        DatabaseMetaData metaData = null;\n+        try {\n+            metaData = conn.getMetaData();\n+            // JDBC3-only method, so it might throw a\n+            // AbstractMethodError\n             try {\n-                if (log.isTraceEnabled())\n-                    log.trace(DBDictionaryFactory.toString\n-                        (conn.getMetaData()));\n-            } catch (Exception e) {\n-                log.trace(e.toString(), e);\n+                isJDBC3 = metaData.getJDBCMajorVersion() >= 3;\n+            } catch (Throwable t) {\n+                // ignore if not JDBC3\n             }\n+        } catch (Exception e) {\n+            if (log.isTraceEnabled())\n+                log.trace(e.toString(), e);\n+        }\n+        \n+        if (log.isTraceEnabled()) {\n+            log.trace(DBDictionaryFactory.toString(metaData));\n+            if (isJDBC3)\n+                log.trace(_loc.get(\"connection-defaults\", new Object[]{\n+                        new Boolean(conn.getAutoCommit()), \n+                        new Integer(conn.getHoldability()),\n+                        new Integer(conn.getTransactionIsolation())}));\n         }\n+        \n         connected = true;\n     }\n "},{"sha":"fdf4275f5c3ef757d46741d21f8728f666f6e003","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java","status":"modified","additions":8,"deletions":1,"changes":9,"blob_url":"https://github.com/apache/openjpa/blob/5e5243f3961ab56e536b35509d7209eb605dd8cb/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/5e5243f3961ab56e536b35509d7209eb605dd8cb/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/InformixDictionary.java?ref=5e5243f3961ab56e536b35509d7209eb605dd8cb","patch":"@@ -122,7 +122,6 @@ public InformixDictionary() {\n         }));\n \n         supportsQueryTimeout = false;\n-        supportsMultipleNontransactionalResultSets = false;\n         supportsLockingWithDistinctClause = false;\n         supportsLockingWithMultipleTables = false;\n         supportsLockingWithOrderClause = false;\n@@ -148,6 +147,14 @@ public void connectedConfiguration(Connection conn)\n             else\n                 driverVendor = VENDOR_OTHER;\n         }\n+        if (isJDBC3) {\n+            conn.setHoldability(ResultSet.HOLD_CURSORS_OVER_COMMIT);\n+            if (log.isTraceEnabled())\n+                log.trace(_loc.get(\"connection-defaults\", new Object[]{\n+                        new Boolean(conn.getAutoCommit()), \n+                        new Integer(conn.getHoldability()),\n+                        new Integer(conn.getTransactionIsolation())}));\n+        }\n     }\n \n     public Column[] getColumns(DatabaseMetaData meta, String catalog,"}]}

