{"sha":"5ef181ab94a302d439ef4e406fcdda7785a57048","node_id":"MDY6Q29tbWl0MjA2MzY0OjVlZjE4MWFiOTRhMzAyZDQzOWVmNGU0MDZmY2RkYTc3ODVhNTcwNDg=","commit":{"author":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-10-03T00:15:12Z"},"committer":{"name":"Patrick Linskey","email":"pcl@apache.org","date":"2007-10-03T00:15:12Z"},"message":"OPENJPA-368. Committing Vikram's patch.\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@581443 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"fd757d5c4691e7862971be090df46c600c630189","url":"https://api.github.com/repos/apache/openjpa/git/trees/fd757d5c4691e7862971be090df46c600c630189"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/5ef181ab94a302d439ef4e406fcdda7785a57048","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/5ef181ab94a302d439ef4e406fcdda7785a57048","html_url":"https://github.com/apache/openjpa/commit/5ef181ab94a302d439ef4e406fcdda7785a57048","comments_url":"https://api.github.com/repos/apache/openjpa/commits/5ef181ab94a302d439ef4e406fcdda7785a57048/comments","author":null,"committer":null,"parents":[{"sha":"fab1a92046f60999aa6428f2f27a9fdf1056bba4","url":"https://api.github.com/repos/apache/openjpa/commits/fab1a92046f60999aa6428f2f27a9fdf1056bba4","html_url":"https://github.com/apache/openjpa/commit/fab1a92046f60999aa6428f2f27a9fdf1056bba4"}],"stats":{"total":11,"additions":6,"deletions":5},"files":[{"sha":"93b2279a47ea49f036e7f8f71512df9c4bff6e31","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java","status":"modified","additions":6,"deletions":5,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/5ef181ab94a302d439ef4e406fcdda7785a57048/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java","raw_url":"https://github.com/apache/openjpa/raw/5ef181ab94a302d439ef4e406fcdda7785a57048/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/kernel/AbstractJDBCSeq.java?ref=5ef181ab94a302d439ef4e406fcdda7785a57048","patch":"@@ -45,7 +45,7 @@\n \n     protected int type = TYPE_DEFAULT;\n     protected Object current = null;\n-    private transient Transaction _outerTransaction;\n+    private static ThreadLocal _outerTransaction = new ThreadLocal();\n \n     /**\n      * Records the sequence type.\n@@ -155,7 +155,7 @@ else if (suspendInJTA()) {\n             try {\n                 TransactionManager tm = getConfiguration()\n                     .getManagedRuntimeInstance().getTransactionManager();\n-                _outerTransaction = tm.suspend();\n+                _outerTransaction.set(tm.suspend());\n                 tm.begin();\n                 return store.getConnection();\n             } catch (Exception e) {\n@@ -188,13 +188,14 @@ protected void closeConnection(Connection conn) {\n                 tm.commit();\n                 try { conn.close(); } catch (SQLException se) {}\n \n-                if (_outerTransaction != null)\n-                    tm.resume(_outerTransaction);\n+                Transaction outerTxn = (Transaction)_outerTransaction.get();\n+                if (outerTxn != null)\n+                    tm.resume(outerTxn);\n \n             } catch (Exception e) {\n                 throw new StoreException(e);\n             } finally {\n-                _outerTransaction = null;\n+                _outerTransaction.set(null);\n             }\n         } else {\n             try {"}]}

