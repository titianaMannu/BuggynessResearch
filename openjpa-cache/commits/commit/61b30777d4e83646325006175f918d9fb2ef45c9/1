{"sha":"61b30777d4e83646325006175f918d9fb2ef45c9","node_id":"MDY6Q29tbWl0MjA2MzY0OjYxYjMwNzc3ZDRlODM2NDYzMjUwMDYxNzVmOTE4ZDlmYjJlZjQ1Yzk=","commit":{"author":{"name":"Mark Struberg","email":"struberg@apache.org","date":"2020-12-01T10:35:29Z"},"committer":{"name":"Mark Struberg","email":"struberg@apache.org","date":"2020-12-01T10:35:29Z"},"message":"OPENJPA-2842 log4j vs log4j2 logging fixed\n\n* introduce new 'log4j2' LogFactory\n* switch back old 'log4j' LogFactory to log4j-1.x","tree":{"sha":"5816395bb57ae30fa3b805b5ecd5ca3884572090","url":"https://api.github.com/repos/apache/openjpa/git/trees/5816395bb57ae30fa3b805b5ecd5ca3884572090"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/61b30777d4e83646325006175f918d9fb2ef45c9","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/61b30777d4e83646325006175f918d9fb2ef45c9","html_url":"https://github.com/apache/openjpa/commit/61b30777d4e83646325006175f918d9fb2ef45c9","comments_url":"https://api.github.com/repos/apache/openjpa/commits/61b30777d4e83646325006175f918d9fb2ef45c9/comments","author":{"login":"struberg","id":79310,"node_id":"MDQ6VXNlcjc5MzEw","avatar_url":"https://avatars.githubusercontent.com/u/79310?v=4","gravatar_id":"","url":"https://api.github.com/users/struberg","html_url":"https://github.com/struberg","followers_url":"https://api.github.com/users/struberg/followers","following_url":"https://api.github.com/users/struberg/following{/other_user}","gists_url":"https://api.github.com/users/struberg/gists{/gist_id}","starred_url":"https://api.github.com/users/struberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/struberg/subscriptions","organizations_url":"https://api.github.com/users/struberg/orgs","repos_url":"https://api.github.com/users/struberg/repos","events_url":"https://api.github.com/users/struberg/events{/privacy}","received_events_url":"https://api.github.com/users/struberg/received_events","type":"User","site_admin":false},"committer":{"login":"struberg","id":79310,"node_id":"MDQ6VXNlcjc5MzEw","avatar_url":"https://avatars.githubusercontent.com/u/79310?v=4","gravatar_id":"","url":"https://api.github.com/users/struberg","html_url":"https://github.com/struberg","followers_url":"https://api.github.com/users/struberg/followers","following_url":"https://api.github.com/users/struberg/following{/other_user}","gists_url":"https://api.github.com/users/struberg/gists{/gist_id}","starred_url":"https://api.github.com/users/struberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/struberg/subscriptions","organizations_url":"https://api.github.com/users/struberg/orgs","repos_url":"https://api.github.com/users/struberg/repos","events_url":"https://api.github.com/users/struberg/events{/privacy}","received_events_url":"https://api.github.com/users/struberg/received_events","type":"User","site_admin":false},"parents":[{"sha":"0d7816290ea9950a8f1aa02dfe418d877481dc0a","url":"https://api.github.com/repos/apache/openjpa/commits/0d7816290ea9950a8f1aa02dfe418d877481dc0a","html_url":"https://github.com/apache/openjpa/commit/0d7816290ea9950a8f1aa02dfe418d877481dc0a"}],"stats":{"total":163,"additions":153,"deletions":10},"files":[{"sha":"3d6e85a30d066b05aa722644f162e03979365eb7","filename":"openjpa-lib/pom.xml","status":"modified","additions":5,"deletions":0,"changes":5,"blob_url":"https://github.com/apache/openjpa/blob/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/pom.xml?ref=61b30777d4e83646325006175f918d9fb2ef45c9","patch":"@@ -56,6 +56,11 @@\n             <artifactId>log4j-core</artifactId>\n             <scope>provided</scope>\n         </dependency>\n+        <dependency>\n+            <groupId>org.apache.logging.log4j</groupId>\n+            <artifactId>log4j-1.2-api</artifactId>\n+            <scope>provided</scope>\n+        </dependency>\n         <dependency>\n             <groupId>org.slf4j</groupId>\n             <artifactId>slf4j-api</artifactId>"},{"sha":"56b978b33e193c885cb59d7544b9c02c0bbd277c","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ConfigurationImpl.java","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/apache/openjpa/blob/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ConfigurationImpl.java","raw_url":"https://github.com/apache/openjpa/raw/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ConfigurationImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/conf/ConfigurationImpl.java?ref=61b30777d4e83646325006175f918d9fb2ef45c9","patch":"@@ -157,6 +157,7 @@ public ConfigurationImpl(boolean loadGlobals) {\n             \"openjpa\", LogFactoryImpl.class.getName(),\n             \"commons\", \"org.apache.openjpa.lib.log.CommonsLogFactory\",\n             \"log4j\", \"org.apache.openjpa.lib.log.Log4JLogFactory\",\n+            \"log4j2\", \"org.apache.openjpa.lib.log.Log4J2LogFactory\",\n             \"slf4j\", \"org.apache.openjpa.lib.log.SLF4JLogFactory\",\n             \"jul\", \"org.apache.openjpa.lib.log.JULLogFactory\",\n             \"none\", NoneLogFactory.class.getName(),"},{"sha":"72aa0698d67895d6a846759981dc843717cf9146","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4J2LogFactory.java","status":"added","additions":127,"deletions":0,"changes":127,"blob_url":"https://github.com/apache/openjpa/blob/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4J2LogFactory.java","raw_url":"https://github.com/apache/openjpa/raw/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4J2LogFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4J2LogFactory.java?ref=61b30777d4e83646325006175f918d9fb2ef45c9","patch":"@@ -0,0 +1,127 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.openjpa.lib.log;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+/**\n+ * {@link LogFactory} implementation that delegates to the Log4J-2.x framework.\n+ * It's configuration key is {@code openjpa.Log=log4j2}.\n+ *\n+ */\n+public class Log4J2LogFactory extends LogFactoryAdapter {\n+\n+    @Override\n+    protected Log newLogAdapter(String channel) {\n+        return new LogAdapter(LogManager.getLogger(channel));\n+    }\n+\n+    /**\n+     * Adapts a Log4J2 logger to the {@link Log}\n+     * interface.\n+     */\n+    public static class LogAdapter implements Log {\n+\n+        private Logger _log;\n+\n+        private LogAdapter(Logger wrapee) {\n+            _log = wrapee;\n+        }\n+\n+        public Logger getDelegate() {\n+            return _log;\n+        }\n+\n+        @Override\n+        public boolean isTraceEnabled() {\n+            return _log.isTraceEnabled();\n+        }\n+\n+        @Override\n+        public boolean isInfoEnabled() {\n+            return _log.isInfoEnabled();\n+        }\n+\n+        @Override\n+        public boolean isWarnEnabled() {\n+            return _log.isWarnEnabled();\n+        }\n+\n+        @Override\n+        public boolean isErrorEnabled() {\n+            return _log.isErrorEnabled();\n+        }\n+\n+        @Override\n+        public boolean isFatalEnabled() {\n+            return _log.isFatalEnabled();\n+        }\n+\n+        @Override\n+        public void trace(Object o) {\n+            _log.debug(o);\n+        }\n+\n+        @Override\n+        public void trace(Object o, Throwable t) {\n+            _log.debug(o, t);\n+        }\n+\n+        @Override\n+        public void info(Object o) {\n+            _log.info(o);\n+        }\n+\n+        @Override\n+        public void info(Object o, Throwable t) {\n+            _log.info(o, t);\n+        }\n+\n+        @Override\n+        public void warn(Object o) {\n+            _log.warn(o);\n+        }\n+\n+        @Override\n+        public void warn(Object o, Throwable t) {\n+            _log.warn(o, t);\n+        }\n+\n+        @Override\n+        public void error(Object o) {\n+            _log.error(o);\n+        }\n+\n+        @Override\n+        public void error(Object o, Throwable t) {\n+            _log.error(o, t);\n+        }\n+\n+        @Override\n+        public void fatal(Object o) {\n+            _log.fatal(o);\n+        }\n+\n+        @Override\n+        public void fatal(Object o, Throwable t) {\n+            _log.fatal(o, t);\n+        }\n+    }\n+}"},{"sha":"4bf377c44848b0aacff5ce8712c59f59e5d986cc","filename":"openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4JLogFactory.java","status":"modified","additions":10,"deletions":9,"changes":19,"blob_url":"https://github.com/apache/openjpa/blob/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4JLogFactory.java","raw_url":"https://github.com/apache/openjpa/raw/61b30777d4e83646325006175f918d9fb2ef45c9/openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4JLogFactory.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-lib/src/main/java/org/apache/openjpa/lib/log/Log4JLogFactory.java?ref=61b30777d4e83646325006175f918d9fb2ef45c9","patch":"@@ -18,19 +18,20 @@\n  */\n package org.apache.openjpa.lib.log;\n \n-import org.apache.logging.log4j.LogManager;\n-import org.apache.logging.log4j.Logger;\n+import org.apache.log4j.Level;\n+import org.apache.log4j.LogManager;\n+import org.apache.log4j.Logger;\n \n /**\n- * {@link LogFactory} implementation that delegates to the Log4J framework.\n+ * {@link LogFactory} implementation that delegates to the Log4J 1.x framework.\n  *\n  * @author Patrick Linskey\n  */\n public class Log4JLogFactory extends LogFactoryAdapter {\n \n     @Override\n     protected Log newLogAdapter(String channel) {\n-        return new LogAdapter(LogManager.getLogger(channel));\n+        return new LogAdapter((Logger) LogManager.getLogger(channel));\n     }\n \n     /**\n@@ -51,27 +52,27 @@ public Logger getDelegate() {\n \n         @Override\n         public boolean isTraceEnabled() {\n-            return _log.isTraceEnabled();\n+            return _log.isEnabledFor(Level.DEBUG);\n         }\n \n         @Override\n         public boolean isInfoEnabled() {\n-            return _log.isInfoEnabled();\n+            return _log.isEnabledFor(Level.INFO);\n         }\n \n         @Override\n         public boolean isWarnEnabled() {\n-            return _log.isWarnEnabled();\n+            return _log.isEnabledFor(Level.WARN);\n         }\n \n         @Override\n         public boolean isErrorEnabled() {\n-            return _log.isErrorEnabled();\n+            return _log.isEnabledFor(Level.ERROR);\n         }\n \n         @Override\n         public boolean isFatalEnabled() {\n-            return _log.isFatalEnabled();\n+            return _log.isEnabledFor(Level.FATAL);\n         }\n \n         @Override"},{"sha":"a03c6590f3e0ecc4eb5dfe7e57e1aba1b263446c","filename":"pom.xml","status":"modified","additions":10,"deletions":1,"changes":11,"blob_url":"https://github.com/apache/openjpa/blob/61b30777d4e83646325006175f918d9fb2ef45c9/pom.xml","raw_url":"https://github.com/apache/openjpa/raw/61b30777d4e83646325006175f918d9fb2ef45c9/pom.xml","contents_url":"https://api.github.com/repos/apache/openjpa/contents/pom.xml?ref=61b30777d4e83646325006175f918d9fb2ef45c9","patch":"@@ -96,6 +96,8 @@\n \n         <xbean.version>4.18</xbean.version>\n         <bval.version>1.1.2</bval.version>\n+        <log4j2.version>2.14.0</log4j2.version>\n+\n         <jmock.version>2.9.0</jmock.version>\n         <automatic-module-name>-SUBMODULES-NEED-TO-OVERRIDE-THIS-</automatic-module-name>\n     </properties>\n@@ -1782,8 +1784,15 @@\n             <dependency>\n                 <groupId>org.apache.logging.log4j</groupId>\n                 <artifactId>log4j-core</artifactId>\n-                <version>2.11.1</version>\n+                <version>${log4j2.version}</version>\n             </dependency>\n+            <dependency>\n+                <!-- for compiling against log4j-1.2.x we use the compat layer from log4j2 -->\n+                <groupId>org.apache.logging.log4j</groupId>\n+                <artifactId>log4j-1.2-api</artifactId>\n+                <version>${log4j2.version}</version>\n+            </dependency>\n+\n             <dependency>\n               <groupId>io.fabric8</groupId>\n               <artifactId>kubernetes-client</artifactId>"}]}

