{"sha":"65bf030d714675f3ce30e1f428ad5807543a6dd4","node_id":"MDY6Q29tbWl0MjA2MzY0OjY1YmYwMzBkNzE0Njc1ZjNjZTMwZTFmNDI4YWQ1ODA3NTQzYTZkZDQ=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-06-02T15:42:20Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2010-06-02T15:42:20Z"},"message":"OPENJPA-1596: port the change to 2.0\n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/branches/2.0.x@950604 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"1b071ddb8becea608e49a5a7d2f838cd66b7dd91","url":"https://api.github.com/repos/apache/openjpa/git/trees/1b071ddb8becea608e49a5a7d2f838cd66b7dd91"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/65bf030d714675f3ce30e1f428ad5807543a6dd4","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/65bf030d714675f3ce30e1f428ad5807543a6dd4","html_url":"https://github.com/apache/openjpa/commit/65bf030d714675f3ce30e1f428ad5807543a6dd4","comments_url":"https://api.github.com/repos/apache/openjpa/commits/65bf030d714675f3ce30e1f428ad5807543a6dd4/comments","author":null,"committer":null,"parents":[{"sha":"ebd07c943a3d8ad2bf88496d949a45b8cd33ae86","url":"https://api.github.com/repos/apache/openjpa/commits/ebd07c943a3d8ad2bf88496d949a45b8cd33ae86","html_url":"https://github.com/apache/openjpa/commit/ebd07c943a3d8ad2bf88496d949a45b8cd33ae86"}],"stats":{"total":14,"additions":11,"deletions":3},"files":[{"sha":"97906cea53a0941adbc1ffc6e6224137f63c2331","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","status":"modified","additions":5,"deletions":2,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/65bf030d714675f3ce30e1f428ad5807543a6dd4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","raw_url":"https://github.com/apache/openjpa/raw/65bf030d714675f3ce30e1f428ad5807543a6dd4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DB2Dictionary.java?ref=65bf030d714675f3ce30e1f428ad5807543a6dd4","patch":"@@ -33,6 +33,7 @@\n import java.util.StringTokenizer;\n \n import org.apache.openjpa.jdbc.identifier.DBIdentifier;\n+import org.apache.openjpa.jdbc.identifier.QualifiedDBIdentifier;\n import org.apache.openjpa.jdbc.kernel.JDBCFetchConfiguration;\n import org.apache.openjpa.jdbc.kernel.exps.FilterValue;\n import org.apache.openjpa.jdbc.kernel.exps.Lit;\n@@ -912,8 +913,10 @@ public void createIndexIfNecessary(Schema schema, DBIdentifier table,\n             // build the index for the sequence tables\n             // the index name will be the fully qualified table name + _IDX\n             Table tab = schema.getTable(table);\n-            DBIdentifier idxName = DBIdentifier.append(tab.getFullIdentifier(), \"IDX\");\n-            Index idx = tab.addIndex(getValidIndexName(idxName, tab));\n+            DBIdentifier fullIdxId = tab.getFullIdentifier().clone();\n+            DBIdentifier unQualifiedName = DBIdentifier.append(fullIdxId.getUnqualifiedName(), \"IDX\");\n+            fullIdxId.setName(getValidIndexName(unQualifiedName, tab));\n+            Index idx = tab.addIndex(fullIdxId);\n             idx.setUnique(true);\n             idx.addColumn(pkColumn);\n         }"},{"sha":"1bea4cd4cbe5d8cb6f94d38eed4168ca82687a15","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","status":"modified","additions":6,"deletions":1,"changes":7,"blob_url":"https://github.com/apache/openjpa/blob/65bf030d714675f3ce30e1f428ad5807543a6dd4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","raw_url":"https://github.com/apache/openjpa/raw/65bf030d714675f3ce30e1f428ad5807543a6dd4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/sql/DBDictionary.java?ref=65bf030d714675f3ce30e1f428ad5807543a6dd4","patch":"@@ -3408,8 +3408,13 @@ protected StringBuilder comment(StringBuilder buf, String comment) {\n         buf.append(\"CREATE \");\n         if (index.isUnique())\n             buf.append(\"UNIQUE \");\n-        String indexName = checkNameLength(toDBName(index.getIdentifier()), maxIndexNameLength, \n+        \n+        DBIdentifier fullIdxName = index.getIdentifier();\n+        DBIdentifier unQualifiedName = fullIdxName.getUnqualifiedName();\n+        checkNameLength(toDBName(unQualifiedName), maxIndexNameLength, \n                 \"long-index-name\");\n+        String indexName = toDBName(fullIdxName);\n+         \n         buf.append(\"INDEX \").append(indexName);\n         buf.append(\" ON \").append(getFullName(index.getTable(), false));\n         buf.append(\" (\").append(namingUtil.appendColumns(index.getColumns()))."}]}

