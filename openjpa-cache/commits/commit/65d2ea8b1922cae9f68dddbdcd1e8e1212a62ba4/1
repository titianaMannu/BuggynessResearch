{"sha":"65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4","node_id":"MDY6Q29tbWl0MjA2MzY0OjY1ZDJlYThiMTkyMmNhZTlmNjhkZGRiZGNkMWU4ZTEyMTJhNjJiYTQ=","commit":{"author":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-10-15T23:32:44Z"},"committer":{"name":"Fay Wang","email":"faywang@apache.org","date":"2009-10-15T23:32:44Z"},"message":"OPENJPA-1351: fix ClassCastException when downlevel jdbc driver is used. \n\ngit-svn-id: https://svn.apache.org/repos/asf/openjpa/trunk@825699 13f79535-47bb-0310-9956-ffa450edef68","tree":{"sha":"486613fec27e3fe975810156018008cce7073883","url":"https://api.github.com/repos/apache/openjpa/git/trees/486613fec27e3fe975810156018008cce7073883"},"url":"https://api.github.com/repos/apache/openjpa/git/commits/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/apache/openjpa/commits/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4","html_url":"https://github.com/apache/openjpa/commit/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4","comments_url":"https://api.github.com/repos/apache/openjpa/commits/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4/comments","author":null,"committer":null,"parents":[{"sha":"6d50e87a03ef41e5cf69b3aeb659284baba29dbb","url":"https://api.github.com/repos/apache/openjpa/commits/6d50e87a03ef41e5cf69b3aeb659284baba29dbb","html_url":"https://github.com/apache/openjpa/commit/6d50e87a03ef41e5cf69b3aeb659284baba29dbb"}],"stats":{"total":20,"additions":18,"deletions":2},"files":[{"sha":"fa9efd33c630d3543a8739239568df70531ec1d5","filename":"openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/conf/JDBCConfigurationImpl.java","status":"modified","additions":16,"deletions":2,"changes":18,"blob_url":"https://github.com/apache/openjpa/blob/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/conf/JDBCConfigurationImpl.java","raw_url":"https://github.com/apache/openjpa/raw/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/conf/JDBCConfigurationImpl.java","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/java/org/apache/openjpa/jdbc/conf/JDBCConfigurationImpl.java?ref=65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4","patch":"@@ -760,8 +760,22 @@ else if (factory2 && connectionFactory2.get() != ds)\n     public Object getConnectionFactory2() {\n         // override to configure data source\n         if (dataSource2 == null) {\n-            // superclass will lookup from JNDI. \n-            DataSource ds = (DataSource) super.getConnectionFactory2();\n+            // superclass will lookup from JNDI.\n+            Object obj = super.getConnectionFactory2();\n+            DataSource ds = null;\n+            if (obj != null) {\n+                if (obj instanceof DataSource) \n+                    ds = (DataSource) obj;\n+                else {\n+                    Log log = getLog(LOG_JDBC);\n+                    if (log.isTraceEnabled()) {\n+                        Localizer loc = Localizer.forPackage(JDBCConfigurationImpl.class);\n+                        log.trace(loc.get(\"unknown-datasource\", getConnectionFactory2Name(), \n+                            obj.getClass().getName()));\n+                    }\n+                }\n+            }\n+                \n             if (ds == null) {\n                 // the driver name is always required, so if not specified,\n                 // then no connection factory 2"},{"sha":"edddbfa898390783d4024af2c1535bfcf315aaf7","filename":"openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/conf/localizer.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/apache/openjpa/blob/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/conf/localizer.properties","raw_url":"https://github.com/apache/openjpa/raw/65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/conf/localizer.properties","contents_url":"https://api.github.com/repos/apache/openjpa/contents/openjpa-jdbc/src/main/resources/org/apache/openjpa/jdbc/conf/localizer.properties?ref=65d2ea8b1922cae9f68dddbdcd1e8e1212a62ba4","patch":"@@ -244,3 +244,5 @@ connecting-for-dictionary: OpenJPA will now connect to the database to attempt \\\n     the documentation for available values).\n map-factory: Using mapping factory \"{0}\".\n meta-factory: Using metadata factory \"{0}\".\n+unknown-datasource: JNDI lookup for \"{0}\" returned \"{1}\", which is not a  \\\n+\tjavax.sql.DataSource object. "}]}

